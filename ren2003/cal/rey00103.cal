|FICHEROS;
    rey00103 #0;
    rem00100 #1;    || datos contribuyentes
    rem00002 #2;    || inmuebles
    rem00004 #3;    || modelo 212
    rem00017 #17;    || inmuebles

    rew00009 #11;   || tmp.comprobacion

   reauxpai #100;
   &haciend@ #706;
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;

    &Temporal = "";
    &Cliente01 = 0;
    &Cliente02 = 0;
    &Cliente03 = 0;
    &Cliente04 = 0;
    &Cliente05 = 0;
    &Cliente06 = 0;
    &Cliente07 = 0;
    &Cliente08 = 0;
    &Cliente09 = 0;
    &Cliente10 = 0;
    &Cliente11 = 0;
    &Cliente12 = 0;
    &Cliente13 = 0;
    &Cliente14 = 0;
    &Cliente15 = 0;
    &Cliente16 = 0;
    &Cliente17 = 0;
    &Cliente18 = 0;

    &Firma = "";
    &Mes = "";  MesNum = 0;

    Empresa = 0;

    &enCodProv = 0;
    &enCodPobl = 0;

    nSwError = 0;
    nCont1   = 0;
    nCont11  = 0;
    Handle   = 0;
    Long     = 0;
    LongDec  = 0;
    nAdq     = 0;
    nTrn     = 0;
    nNegativo = 0;
    Calc1    = 0;
    Calc2    = 0;
    nLong    = 0;

    aLong    = "";
    aAlfa    = "";
    aAlfa1   = "";
    aAlfa2   = "";
    aAlfax   = "";
    Cadena   = "";
    TipoDato = "";
    Vacio1   = "";
    Vacio2   = "";
|FIN;

|INCLUYE i_consul;
____________________________________/
|PROCESO Fichero;
/*
|DDEFECTO #11;
    #11#0 = #3#0;
    #11#8 = 1;
|LEE 101#11=;
    FEstado = FSalida;

    #11#1 = "T";    || tipo TC1234 (siempre titular!)
    #11#2 = #3#7;   || NIF
    #11#3 = #3#9;   || nombre
    #11#6 = #3#79;  || cuota 212
    #11#11 = #3#84; || impreso S/N

|SI FEstado = 0;    |GRABA 020#11a;     |FINSI;
|SI FEstado ! 0;    |GRABA 020#11n;     |FINSI;
|LIBERA #11;
*/
|ABRE #rem00017;
#rem00017#0 = #rem00004#0;
#rem00017#1 = #rem00004#1;
|LEE 000#rem00017.=;
|SI FSalida ! 0; |DDEFECTO #rem00017; |FINSI;
|CIERRA #rem00017;

aAlfa = "C:\MODELOS\RENTA\212\"; |RMKDIR aAlfa;

aAlfa = aAlfa + "212" + (("00000" + #rem00004#0) % -105) + ".sec";
|XABRE "WCB", aAlfa, Handle;
|SI FSalida ] 0;
   Cadena = "212";
   TipoDato = "A"; LongDec = 0;
   Long = 16; aAlfa = #rem00100#71;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 20; aAlfa = #rem00100#72;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N";
   Long = 2;  aAlfa = #rem00100#69;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 3;  aAlfa = #rem00100#70;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   aAlfax = #rem00004#2; |QBF aAlfax;
   Long = 2;  aAlfa = aAlfax % 0102; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 2;  aAlfa = aAlfax % 0402; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 4;  aAlfa = aAlfax % 0704; |HAZ Formateo; Cadena = Cadena + aAlfa;

   TipoDato = "A";
   Long = 9;  aAlfa = #rem00004#7;   |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N";
   Long = 4;  aAlfa = aAlfax % 0704; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Cadena = Cadena + "0A";
   TipoDato = "A";
   Long = 40; aAlfa = #rem00004#9;   |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 1;  aAlfa = #rem00004#8;   |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N"; LongDec = 2;
   Long = 3;  aAlfa = #rem00004#10;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "A"; LongDec = 0;
   Long = 16; aAlfa = #rem00004#11;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 2;  aAlfa = #rem00004#86;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 25; aAlfa = #rem00004#12;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N";
   Long = 5;  aAlfa = #rem00004#87;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Cadena = Cadena + " ";
   Long = 2;  aAlfa = #rem00004#88;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 2;  aAlfa = #rem00004#89;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "A";
   Long = 2;  aAlfa = #rem00004#90;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N";
   Long = 20; aAlfa = #rem00004#91;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "A";
   Long = 20; aAlfa = #rem00004#15;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N";
   Long = 2;  aAlfa = #rem00004#13;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 2;  aAlfa = #rem00004#13;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 3;  aAlfa = #rem00004#14;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   |XGRABA Handle, Cadena; Cadena = "";

   |ABRE #reauxpai;
   #reauxpai#0 = #rem00004#17;
   |LEE 000#reauxpai.=;
   |SI FSalida ! 0; |DDEFECTO #reauxpai; |FINSI;
   |CIERRA #reauxpai;

   TipoDato = "A";
   Long = 14;  aAlfa = #reauxpai#1;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 3;   aAlfa = #rem00004#17; |HAZ Formateo; Cadena = Cadena + aAlfa;

   Long = 9;   aAlfa = #rem00004#18; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 40;  aAlfa = #rem00004#19; |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N"; LongDec = 2;
   Long = 3;  aAlfa = #rem00004#20;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   LongDec = 0;
   Long = 3;  aAlfa = #rem00004#21;  |HAZ Formateo; Cadena = Cadena + aAlfa;

   TipoDato = "A";
   Long = 9;  aAlfa = #rem00004#22;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 1;  aAlfa = #rem00004#23;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 40; aAlfa = #rem00004#24;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 2;  aAlfa = #rem00004#25;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 25; aAlfa = #rem00004#26;  |HAZ Formateo; Cadena = Cadena + aAlfa;

   TipoDato = "N";
   Long = 5;  aAlfa = #rem00004#27;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 2;  aAlfa = #rem00004#28;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 2;  aAlfa = #rem00004#29;  |HAZ Formateo; Cadena = Cadena + aAlfa;

   TipoDato = "A";
   Long = 2;  aAlfa = #rem00004#30;  |HAZ Formateo; Cadena = Cadena + aAlfa;

   TipoDato = "N";
   Long = 20; aAlfa = #rem00004#83;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 2;  aAlfa = #rem00004#31;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 3;  aAlfa = #rem00004#32;  |HAZ Formateo; Cadena = Cadena + aAlfa;

   TipoDato = "A";
   Long = 20; aAlfa = #rem00004#33;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N";
   Long = 2;  aAlfa = #rem00004#31;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   |XGRABA Handle, Cadena; Cadena = "";

   TipoDato = "A";
   Long = 9;  aAlfa = #rem00004#35;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 1;  aAlfa = #rem00004#36;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 40; aAlfa = #rem00004#37;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 2;  aAlfa = #rem00004#38;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 25; aAlfa = #rem00004#39;  |HAZ Formateo; Cadena = Cadena + aAlfa;

   TipoDato = "N";
   Long = 5;  aAlfa = #rem00004#40;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Cadena = Cadena + " ";
   Long = 2;  aAlfa = #rem00004#41;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 2;  aAlfa = #rem00004#42;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "A";
   Long = 2;  aAlfa = #rem00004#43;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N";
   Long = 2;  aAlfa = #rem00004#44;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 3;  aAlfa = #rem00004#45;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "A";
   Long = 20; aAlfa = #rem00004#46;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 14; aAlfa = #rem00004#47;  |HAZ Formateo; Cadena = Cadena + aAlfa;

   |ABRE #reauxpai;
   #reauxpai#0 = #rem00004#48;
   |LEE 000#reauxpai.=;
   |SI FSalida ! 0; |DDEFECTO #reauxpai; |FINSI;
   |CIERRA #reauxpai;

   Long = 14; aAlfa = #reauxpai#1;  |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 3;  aAlfa = #rem00004#48; |HAZ Formateo; Cadena = Cadena + aAlfa;
   |XGRABA Handle, Cadena; Cadena = "";

   Long = 2;  aAlfa = #rem00004#49; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 25; aAlfa = #rem00004#50; |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N";
   Long = 5;  aAlfa = #rem00004#51; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Cadena = Cadena + " ";
   Long = 2;  aAlfa = #rem00004#52; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 2;  aAlfa = #rem00004#53; |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "A";
   Long = 2;  aAlfa = #rem00004#54; |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N";
   Long = 2;  aAlfa = #rem00004#55; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 3;  aAlfa = #rem00004#56; |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "A";
   Long = 20; aAlfa = #rem00004#57; |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N";
   Long = 2;  aAlfa = #rem00004#55; |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "A";
   Long = 1;  aAlfa = #rem00004#55; |HAZ Formateo; Cadena = Cadena + aAlfa;

   |SI #rem00004#59 = "X"; Cadena = Cadena + "1"; |SINO; Cadena = Cadena + "0"; |FINSI;
   |SI #rem00004#60 = "X"; Cadena = Cadena + "1"; |SINO; Cadena = Cadena + "0"; |FINSI;

   Long = 40;  aAlfa = #rem00004#61; |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N";
   Long = 5;   aAlfa = #rem00004#62; |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "A";
   Long = 20;  aAlfa = #rem00004#63; |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N";
   Long = 12;  aAlfa = #rem00004#64; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 1;   aAlfa = #rem00004#65; |HAZ Formateo; Cadena = Cadena + aAlfa;
   |XGRABA Handle, Cadena; Cadena = "";

   LongDec = 2;
   Long = 11;  aAlfa = #rem00017#32; |HAZ Formateo; Cadena = Cadena + aAlfa;
   LongDec = 0;
   Long = 2;   aAlfa = #rem00017#34; |HAZ Formateo; Cadena = Cadena + aAlfa;
   LongDec = 2;
   Long = 11;  aAlfa = #rem00004#66; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 11;  aAlfa = #rem00004#67; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 11;  aAlfa = #rem00004#68; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 11;  aAlfa = #rem00004#69; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 11;  aAlfa = #rem00004#70; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 11;  aAlfa = #rem00004#71; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 11;  aAlfa = #rem00004#72; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 11;  aAlfa = #rem00004#73; |HAZ Formateo; Cadena = Cadena + aAlfa;
   |XGRABA Handle, Cadena; Cadena = "";

   Long = 11;  aAlfa = #rem00004#74; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 2;   aAlfa = #rem00004#75; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 11;  aAlfa = #rem00004#76; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 11;  aAlfa = #rem00004#77; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 11;  aAlfa = #rem00004#78; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 11;  aAlfa = #rem00004#79; |HAZ Formateo; Cadena = Cadena + aAlfa;
   LongDec = 0;

   aAlfax = #rem00004#80; |QBF aAlfax;
   aAlfa = (aAlfax % 0102) + (aAlfax % 0402) + (aAlfax % 0704);
   Cadena = Cadena + aAlfa;

   aAlfax = #rem00004#81; |QBF aAlfax;
   aAlfa = (aAlfax % 0102) + (aAlfax % 0402) + (aAlfax % 0704);
   Cadena = Cadena + aAlfa;

   TipoDato = "A";
   |SI #rem00004#79 > 0;
      |SI #rem00004#85 = "E"; aAlfa = "X "; |SINO;  aAlfa = " X"; |FINSI;
      Long = 2;                      |HAZ Formateo; Cadena = Cadena + aAlfa;
   |SINO;
      Cadena = Cadena + "  ";
   |FINSI;

   |SI #rem00004#79 < 0;
      Long = 9;  aAlfa = #rem00004#7;   |HAZ Formateo; Cadena = Cadena + aAlfa;
      aAlfax = #rem00004#2; |QBF aAlfax;
      aAlfa = (aAlfax % 0102) + (aAlfax % 0402) + (aAlfax % 0704);
      Cadena = Cadena + aAlfa;
      TipoDato = "N";
      Long = 20;  aAlfa = #rem00100#53; |HAZ Formateo; Cadena = Cadena + aAlfa;
   |SINO;
      Cadena = Cadena + "                 00000000000000000000";
   |FINSI;

   |SI #rem00004#79 = 0;
      Cadena = Cadena + "X ";
   |SINO;
      Cadena = Cadena + "  ";
   |FINSI;
   |XGRABA Handle, Cadena; Cadena = "";

   TipoDato = "A";
   Long = 50;  aAlfa = #rem00004#24; |HAZ Formateo; Cadena = Cadena + aAlfa;
   Long = 50;  aAlfa = "";           |HAZ Formateo; Cadena = Cadena + aAlfa;
   TipoDato = "N";
   Long = 20;  aAlfa = #rem00004#83; |HAZ Formateo; Cadena = Cadena + aAlfa;
   |XGRABA Handle, Cadena; Cadena = "";

   TipoDato = "A";
   Long = 60;  aAlfa = "";           |HAZ Formateo; Cadena = Cadena + aAlfa;
   |XGRABA Handle, Cadena; Cadena = "";
   Long = 60;  aAlfa = "";           |HAZ Formateo; Cadena = Cadena + aAlfa;
   |XGRABA Handle, Cadena; Cadena = "";
   Long = 60;  aAlfa = "";           |HAZ Formateo; Cadena = Cadena + aAlfa;
   |XGRABA Handle, Cadena; Cadena = "";
   Long = 60;  aAlfa = "";           |HAZ Formateo; Cadena = Cadena + aAlfa;
   |XGRABA Handle, Cadena; Cadena = "";
   Long = 60;  aAlfa = "";           |HAZ Formateo; Cadena = Cadena + aAlfa;
   |XGRABA Handle, Cadena; Cadena = "";
   Long = 50;  aAlfa = "";           |HAZ Formateo; Cadena = Cadena + aAlfa;
   |XGRABA Handle, Cadena; Cadena = "";
   aAlfa = &13 + &10; |XGRABA Handle, aAlfa;

   |XCIERRA Handle;
|SINO;
   aAlfa = "    No puedo generar el fichero para la empresa " + (("00000" + #rem00004#0) % -105);
   |MENAV aAlfa;
   nSwError = 1;
|FINSI;

|FPRC;

|PROCESO Impresora;
|SI #3#81 = "01.01.0000";  #3#81 = "          ";  |FINSI;

|INFOR "m212h001";   |PRINT;   |PIEINF;  |FININF;
|INFOR "m212h002";   |PRINT;   |PIEINF;  |FININF;
|FPRC;

|PROCESO Modelo;

    Firma = #3#15;  |QBT Firma;
    Firma = (#3#15 - Firma) + Firma;         || ajusta a la derecha
/*
|SI Temporal = "";
    |HAZ Impresora;
|SINO;
    |HAZ Fichero;
|FINSI;
*/
   |SI #rey00103#19 = "P";
      |HAZ Impresora;
   |SINO;
      |HAZ Fichero;
   |FINSI;
|FPRC;

|PROCESO Emite1;
    #3#0 = #2#0;
    #3#1 = #2#1;
|LEE 101#3=;                  || lee modelo 212 (rem00004)
|SI FSalida ! 0;
    |ACABA;
|SINO;
    |SI Temporal = "";
            #3#84 = "S";           || impreso SI
        |GRABA 020#3a;
    |FINSI;
|FINSI;
|LIBERA #3;

    seleccio = 1;

enCodProv = #1#69;
enCodPobl = #1#70;
|HAZ LeeHacienda;

|HAZ Modelo;
|FPRC;

|DEFBUCLE Emite;
 #2#1;
 ;
 #1#0,  1;
 #1#0, 99;
 ;
 NULL, Emite1;
|FIN;

|PROCESO Tipo3;
|ABRE #1;       || datos contribuyentes
|ABRE #3;       || modelo 212
nSwError = 0;
|PARA Empresa = 0; |SI Empresa [ 17; |HACIENDO Empresa = Empresa + 1;
    |SI #0Empresa ! 0;
            #1#0 = #0Empresa;
        |LEE 000#1=;
        |SI FSalida = 0;|Y #1#10 = "N";
            |BUCLE Emite;
        |FINSI;
    |FINSI;
|SIGUE;
|SI #rey00103#19 = "F";
   |SI nSwError = 0;
      |MENAV "    Ficheros generados correctamente";
   |SINO;
      |MENAV "    Se han encontrado errores en la emision de los modelos";
   |FINSI;
|FINSI;
|SI seleccio = 0;|Y Temporal = "";
    |MENAV "    Seleccion vacia ...";
|FINSI;
|CIERRA #1;
|CIERRA #3;
|FPRC;

|PROCESO MiraMes;
   Mes = #rey00103#18 % 0402; MesNum = Mes;
   |SI MesNum = 1;  Mes = " Enero ";      |FINSI;
   |SI MesNum = 2;  Mes = " Febrero ";    |FINSI;
   |SI MesNum = 3;  Mes = " Marzo ";      |FINSI;
   |SI MesNum = 4;  Mes = " Abril ";      |FINSI;
   |SI MesNum = 5;  Mes = " Mayo ";       |FINSI;
   |SI MesNum = 6;  Mes = " Junio ";      |FINSI;
   |SI MesNum = 7;  Mes = " Julio ";      |FINSI;
   |SI MesNum = 8;  Mes = " Agosto ";     |FINSI;
   |SI MesNum = 9;  Mes = " Septiembre "; |FINSI;
   |SI MesNum = 10; Mes = " Octubre ";    |FINSI;
   |SI MesNum = 11; Mes = " Noviembre ";  |FINSI;
   |SI MesNum = 12; Mes = " Diciembre ";  |FINSI;
|FPRC;

|PROGRAMA;
|HAZ PreparaInformes;

|SI Temporal = "";
    |CLS;
    |CABEZA "Impresion 212";
    |PINPA #0#0;
    |DDEFECTO #0;
    |PINDA #0#0; ||HAZ PintaMoneda;
    |ENDATOS #1#0;
    |SI FSalida = 0;
        |HAZ MiraMes;
        |SI #rey00103#19 = "P";
           |IMPRE 0;
           |SI FSalida = 0;
              |HAZ Tipo3;
           |SINO;
              |MENAV "    Proceso abortado ...";
           |FINSI;
           |FINIMP;
        |SINO;
           |HAZ Tipo3;
        |FINSI;
    |FINSI;
|SINO;
        #0#0 = Cliente01;     #0#1 = Cliente02;   #0#2 = Cliente03;
        #0#3 = Cliente04;     #0#4 = Cliente05;   #0#5 = Cliente06;
        #0#6 = Cliente07;     #0#7 = Cliente08;   #0#8 = Cliente09;
        #0#9 = Cliente10;     #0#10 = Cliente11;  #0#11 = Cliente12;
        #0#12 = Cliente13;    #0#13 = Cliente14;  #0#14 = Cliente15;
        #0#15 = Cliente16;    #0#16 = Cliente17;  #0#17 = Cliente18;
    |NOME_DAT #11 Temporal;
    |ABRE #11;
    |HAZ Tipo3;
    |CIERRA #11;
|FINSI;
|FPRO;

|PROCESO PintaMoneda;
|VARIABLES;
  {-1}aMoneda   = "";
      aMoneda1  = "LEER";
      aMoneda2  = "";
|FIN;
     aAlfa = " Moneda de emision : ";
     IaMoneda = aMoneda1<-;
     |ESPECIFICA "MODO_VER_EURO", aMoneda;
     |SI aMoneda2 = "0";
         aAlfa = aAlfa + "PESETAS";
     |SINO;
         aAlfa = aAlfa + "EUROS  ";
     |FINSI;
     |ATRI I; |PINTA 1622, aAlfa; |ATRI N;
|FPRC;

|PROCESO Formateo;
   |QBF aAlfa;
   |SI TipoDato = "F";
      aAlfa = aAlfa - "."; aAlfa = aAlfa - ".";
      |QBF aAlfa;
      |SI aAlfa = "";         aAlfa = "0" * 8; |FINSI;
      |SI aAlfa = "01010000"; aAlfa = "0" * 8; |FINSI;
      |ACABA;
   |FINSI;
   |SI TipoDato = "N";
      Vacio1 = "0" * Long;
      Vacio2 = "0" * LongDec;
      aAlfa = aAlfa - "-";
      |SI FSalida ! 0;
         nNegativo = 1;
      |SINO;
         nNegativo = 0;
      |FINSI;
   |SINO;
      Vacio1 = " " * Long;
   |FINSI;

   |SI TipoDato ! "N";
      Calc1 = 100 + Long; aAlfa = (aAlfa + Vacio1) % Calc1;
   |SINO;
      |SI LongDec = 0;
         Calc1 = 0 - (100 + Long);
         aAlfa = (Vacio1 + aAlfa) % Calc1;
      |SINO;
         aAlfa = aAlfa - ".";
         |SI FSalida = 0;
            Calc1 = 0 - (100 + Long);
            aAlfa = (Vacio1 + aAlfa) % Calc1;
            aAlfa1 = "0" * LongDec;
         |SINO;
            Calc1 = (((FSalida / 100) ! 0) - 1) + 100;
            Calc2 = (((FSalida / 100) ! 0) * 100) + 99;
            aAlfa1 = aAlfa % Calc2;
            aAlfa = aAlfa % Calc1;
            Calc1 = 0 - (100 + Long);
            aAlfa = (Vacio1 + aAlfa)  % Calc1;
            Calc1 = 100 + LongDec;
            aAlfa1 = (aAlfa1 + Vacio2) % Calc1;
         |FINSI;
         aAlfa = aAlfa + aAlfa1;
      |FINSI;
      |SI nNegativo = 1;
         Calc1 = 0 - (100 + (Long + LongDec)); Calc1 = Calc1 + 1;
         aAlfa = aAlfa % Calc1;
         aAlfa = "N" + aAlfa;
      |FINSI;
   |FINSI;

   aAlfa2 = "";

   |SI TipoDato = "A"; |O TipoDato = "An";
      aLong = aAlfa % 0; nLong = aLong;
      |PARA nCont1 = 1; |SI nCont1 [ nLong; |HACIENDO nCont1 = nCont1 + 1;
         Calc1 = (nCont1 * 100) + 1; aAlfa1  = aAlfa % Calc1;
         aAlfa1 = aAlfa1 > aAlfa1;
         |SI aAlfa1 = " ";                  |VETE Sigue1; |FINSI;
         |SI aAlfa1 ] "A"; |Y aAlfa1 [ "Z"; |VETE Sigue1; |FINSI;
         |SI aAlfa1 ] "0"; |Y aAlfa1 [ "9"; |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "¥"; aAlfa1 = &209;   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "¤"; aAlfa1 = &209;   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "ç"; aAlfa1 = &199;   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "Ç"; aAlfa1 = &199;   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "-"; aAlfa1 = &45;    |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "'"; aAlfa1 = &49;    |VETE Sigue1; |FINSI;
         |SI TipoDato = "An";
            |SI aAlfa1 = "&"; aAlfa1 = &38;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = ","; aAlfa1 = &44;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = "."; aAlfa1 = &46;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = ":"; aAlfa1 = &58;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = ";"; aAlfa1 = &59;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = "_"; aAlfa1 = &95;    |VETE Sigue1; |FINSI;
         |FINSI;
         aAlfa1 = " ";
|ET Sigue1;
         aAlfa2 = aAlfa2 + aAlfa1;
      |SIGUE;
      aAlfa = aAlfa2;
   |FINSI;
   Calc1 = aAlfa;
|FPRC;
