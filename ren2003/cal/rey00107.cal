|FICHEROS;
    rey00107 #0;
    rem00100 #1;    || datos contribuyentes
    rem00002 #2;    || inmuebles
    rem00010 #3;    || modelo 213
    rem00011 #4;    || modelo 213 Relacion inmuebles
    rem00012 #5;    || modelo 213 Relacion socios

    rew00009 #11;   || tmp.comprobacion
    rerenpre #13;

   &haciend@ #706;
|FIN;

|VARIABLES;
    nSwHay = 0;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;

    &enJustif = 0;
    &Temporal = "";
    &Cliente01 = 0;
    &Cliente02 = 0;
    &Cliente03 = 0;
    &Cliente04 = 0;
    &Cliente05 = 0;
    &Cliente06 = 0;
    &Cliente07 = 0;
    &Cliente08 = 0;
    &Cliente09 = 0;
    &Cliente10 = 0;
    &Cliente11 = 0;
    &Cliente12 = 0;
    &Cliente13 = 0;
    &Cliente14 = 0;
    &Cliente15 = 0;
    &Cliente16 = 0;
    &Cliente17 = 0;
    &Cliente18 = 0;

    &Firma = "";
    &Mes = "";  MesNum = 0;

    &enNumInm  = 0;
    &enNumPag  = 0;
    &enContPag = 0;
    &eaDel1    = "";
    &eaDel2    = "";
    &eaDel3    = "";
    &eaDel4    = "";
    &eaDel5    = "";

    nSw     = 0;
    aDeleg  = "";
    aAdmin  = "";
    aAlfa   = "";
    aAlfa1  = "";
    nCalc   = 0;
    nCalc1  = 0;
    nDel    = 0;
    nAdm    = 0;
    nInm    = 0;
    nDeleg  = 0;
    nAdmin  = 0;
    nNumDel = 0;
    nNumSocs = 0;
    aDeleg1 = ""; aDeleg2 = ""; aDeleg3 = "";
    aDeleg4 = ""; aDeleg5 = ""; aDeleg6 = "";
    aAdmin1 = ""; aAdmin2 = ""; aAdmin3 = "";
    aAdmin4 = ""; aAdmin5 = ""; aAdmin6 = "";
    nNumIn1 = 0;  nNumIn2 = 0;  nNumIn3 = 0;
    nNumIn4 = 0;  nNumIn5 = 0;  nNumIn6 = 0;

    Empresa = 0;

    &enCodProv = 0;
    &enCodPobl = 0;
     nSwError = 0;
     nCont1   = 0;
     nCont11  = 0;
     Handle   = 0;
     Long     = 0;
     LongDec  = 0;
     nNegativo = 0;
     Calc1     = 0;
     Calc2     = 0;
     nLong     = 0;
     nInmuebles = 0;
     nCont     = 0;

     aLong    = "";
     aAlfa2   = "";
     aAlfax   = "";
     Cadena   = "";
     TipoDato = "";
     Vacio1   = "";
     Vacio2   = "";
|FIN;

|INCLUYE i_consul;
____________________________________/

|PROCESO Entero;
   aAlfa = nCalc;
   aAlfa = aAlfa - ".";
   |SI FSalida ! 0;
      nCalc = ((FSalida / 100) ! 0) + 99;
      aAlfa = aAlfa % nCalc;
   |FINSI;
   nCalc = aAlfa;
|FPRC;

|PROCESO ImprimeDatos;
   |PUSHV 1010 1570;
   |BLANCO 1010 1570;
   |CUADRO 1010 1570;
   |PINTA 1111, "Cliente : ";
   |PINTA 1121, #rem00010#0; |PINTA 1127, #rem00100#5;
   |SI nSw = 1;
      aAlfa = "Coloque el papel de la portada del modelo";
      aAlfa1 = "";
   |FINSI;
   |SI nSw = 2;
      aAlfa = "Coloque el papel de la relacion de inmuebles del modelo";
      aAlfa1 = "Pagina " + enNumPag + " de " + enContPag;
   |FINSI;
   |SI nSw = 3;
      aAlfa = "Coloque el papel de la relacion de socios del modelo";
      aAlfa1 = "Pagina " + enNumPag + " de " + enContPag;
   |FINSI;
   |PINTA 1311, aAlfa;
   |PINTA 1411, aAlfa1;
   |PAUSA; |POPV;
|FPRC;

|PROCESO RevisaInm;
   nSwHay = 1;
   aAlfa  = #rem00011#14; |QBF aAlfa;  aAlfa  = ("00"  + aAlfa)  % -102;
   aAlfa1 = #rem00011#15; |QBF aAlfa1; aAlfa1 = ("000" + aAlfa1) % -103;
   |SI aDeleg1 = "";
      aDeleg1 = aAlfa; nNumIn1 = 1;
      aAdmin1 = aAlfa1;
   |SINO;
      |SI aAlfa ! aDeleg1;
         |SI aDeleg2 = "";
            aDeleg2 = aAlfa; nNumIn2 = 1;
            aAdmin2 = aAlfa1;
         |SINO;
            |SI aAlfa ! aDeleg2;
               |SI aDeleg3 = "";
                  aDeleg3 = aAlfa; nNumIn3 = 1;
                  aAdmin3 = aAlfa1;
               |SINO;
                  |SI aAlfa ! aDeleg3;
                     |SI aDeleg4 = "";
                        aDeleg4 = aAlfa; nNumIn4 = 1;
                        aAdmin4 = aAlfa1;
                     |SINO;
                        |SI aAlfa ! aDeleg4;
                           |SI aDeleg5 = "";
                              aDeleg5 = aAlfa; nNumIn5 = 1;
                              aAdmin5 = aAlfa1;
                           |SINO;
                              |SI aAlfa ! aDeleg5;
                                 |SI aDeleg6 = "";
                                    aDeleg6 = aAlfa; nNumIn6 = 1;
                                    aAdmin6 = aAlfa1;
                                 |SINO;
                                    |SI aAlfa = aDeleg6;
                                       nNumIn6 = nNumIn6 + 1;
                                    |FINSI;
                                 |FINSI;
                              |SINO;
                                 nNumIn5 = nNumIn5 + 1;
                              |FINSI;
                           |FINSI;
                        |SINO;
                           nNumIn4 = nNumIn4 + 1;
                        |FINSI;
                     |FINSI;
                  |SINO;
                     nNumIn3 = nNumIn3 + 1;
                  |FINSI;
               |FINSI;
            |SINO;
               nNumIn2 = nNumIn2 + 1;
            |FINSI;
         |FINSI;
      |SINO;
         nNumIn1 = nNumIn1 + 1;
      |FINSI;
   |FINSI;

|FPRC;

|DEFBUCLE RevisaInm;
#rem00011#1;
;
#rem00010#0, #rem00010#1, 01;
#rem00010#0, #rem00010#1, 99;
;
NULL,RevisaInm;
|FIN;

|PROCESO LeeFicHacienda;
   aDeleg = ""; aAdmin = "";

   enCodProv = nDel;
   enCodPobl = nAdm;
   |HAZ LeeHacienda;
   aDeleg = #706#2;
   aAdmin = #706#3;
|FPRC;

|PROCESO ModeloInm;
   enNumInm = enNumInm + 1; nCalc = enNumInm - 1;
   nCalc1 = nCalc / 7;   nCalc = nCalc / 7; |HAZ Entero;
   |SI nCalc = nCalc1;
      enNumPag = enNumPag + 1;
      nSw = 2; |HAZ ImprimeDatos;
   |FINSI;
   nAdm = 0;
   |SI nNumDel = 1;
      nDel = aDeleg2; |HAZ LeeFicHacienda; eaDel1 = aDeleg;
      nDel = aDeleg3; |HAZ LeeFicHacienda; eaDel2 = aDeleg;
      nDel = aDeleg4; |HAZ LeeFicHacienda; eaDel3 = aDeleg;
      nDel = aDeleg5; |HAZ LeeFicHacienda; eaDel4 = aDeleg;
      nDel = aDeleg6; |HAZ LeeFicHacienda; eaDel5 = aDeleg;
   |FINSI;
   |SI nNumDel = 2;
      nDel = aDeleg1; |HAZ LeeFicHacienda; eaDel1 = aDeleg;
      nDel = aDeleg3; |HAZ LeeFicHacienda; eaDel2 = aDeleg;
      nDel = aDeleg4; |HAZ LeeFicHacienda; eaDel3 = aDeleg;
      nDel = aDeleg5; |HAZ LeeFicHacienda; eaDel4 = aDeleg;
      nDel = aDeleg6; |HAZ LeeFicHacienda; eaDel5 = aDeleg;
   |FINSI;
   |SI nNumDel = 3;
      nDel = aDeleg1; |HAZ LeeFicHacienda; eaDel1 = aDeleg;
      nDel = aDeleg2; |HAZ LeeFicHacienda; eaDel2 = aDeleg;
      nDel = aDeleg4; |HAZ LeeFicHacienda; eaDel3 = aDeleg;
      nDel = aDeleg5; |HAZ LeeFicHacienda; eaDel4 = aDeleg;
      nDel = aDeleg6; |HAZ LeeFicHacienda; eaDel5 = aDeleg;
   |FINSI;
   |SI nNumDel = 4;
      nDel = aDeleg1; |HAZ LeeFicHacienda; eaDel1 = aDeleg;
      nDel = aDeleg2; |HAZ LeeFicHacienda; eaDel2 = aDeleg;
      nDel = aDeleg3; |HAZ LeeFicHacienda; eaDel3 = aDeleg;
      nDel = aDeleg5; |HAZ LeeFicHacienda; eaDel4 = aDeleg;
      nDel = aDeleg6; |HAZ LeeFicHacienda; eaDel5 = aDeleg;
   |FINSI;
   |SI nNumDel = 5;
      nDel = aDeleg1; |HAZ LeeFicHacienda; eaDel1 = aDeleg;
      nDel = aDeleg2; |HAZ LeeFicHacienda; eaDel2 = aDeleg;
      nDel = aDeleg3; |HAZ LeeFicHacienda; eaDel3 = aDeleg;
      nDel = aDeleg4; |HAZ LeeFicHacienda; eaDel4 = aDeleg;
      nDel = aDeleg6; |HAZ LeeFicHacienda; eaDel5 = aDeleg;
   |FINSI;
   |SI nNumDel = 6;
      nDel = aDeleg1; |HAZ LeeFicHacienda; eaDel1 = aDeleg;
      nDel = aDeleg2; |HAZ LeeFicHacienda; eaDel2 = aDeleg;
      nDel = aDeleg3; |HAZ LeeFicHacienda; eaDel3 = aDeleg;
      nDel = aDeleg4; |HAZ LeeFicHacienda; eaDel4 = aDeleg;
      nDel = aDeleg5; |HAZ LeeFicHacienda; eaDel5 = aDeleg;
   |FINSI;
   |SI #rey00107#20 = "P";
      |PRINT;
   |SINO;
      |SI nInmuebles < 14;
         TipoDato = "A"; LongDec = 0;
         Long = 2;  aAlfa = #rem00011#18; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 25; aAlfa = #rem00011#3;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "N";
         Long = 5;  aAlfa = #rem00011#4;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Cadena = Cadena + " "; TipoDato = "A";
         Long = 2;  aAlfa = #rem00011#5;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 2;  aAlfa = #rem00011#6;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 2;  aAlfa = #rem00011#7;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 20; aAlfa = #rem00011#11; |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "N";
         Long = 2;  aAlfa = #rem00011#9;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         aAlfa = (("00" + #rem00011#9) % -102) + (("000" + #rem00011#10) % -103);
         Long = 5;                        |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "A";
         Long = 20; aAlfa = #rem00011#8;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "N"; LongDec = 2;
         Long = 11; aAlfa = #rem00011#13; |HAZ Formateo; Cadena = Cadena + aAlfa;
         |XGRABA Handle, Cadena; Cadena = "";
         nInmuebles = nInmuebles + 1;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE ModeloInm;
#rem00011#1;
14;
#rem00010#0, #rem00010#1, 01, nDeleg;
#rem00010#0, #rem00010#1, 99, nDeleg;
;
NULL,ModeloInm;
|FIN;

|PROCESO RevisaSocios;
   nNumSocs = nNumSocs + 1;
|FPRC;

|DEFBUCLE RevisaSocios;
#rem00012#1;
;
#rem00010#0, #rem00010#1, 01;
#rem00010#0, #rem00010#1, 99;
;
NULL,RevisaSocios;
|FIN;

|PROCESO ModeloSoc;
   nNumSocs = nNumSocs + 1; nCalc = nNumSocs - 1;
   nCalc1 = nCalc / 7;   nCalc = nCalc / 7; |HAZ Entero;
   |SI nCalc = nCalc1;
      enNumPag = enNumPag + 1;
      nSw = 3; |HAZ ImprimeDatos;
   |FINSI;
   |PRINT;
|FPRC;

|DEFBUCLE ModeloSoc;
#rem00012#1;
;
#rem00010#0, #rem00010#1, 01;
#rem00010#0, #rem00010#1, 99;
;
NULL,ModeloSoc;
|FIN;

|PROCESO Modelo;

   nDeleg = 0; nAdmin = 0;
   |SI nNumDel = 1; |Y nNumIn1 ! 0; nDeleg = aDeleg1; nAdmin = aAdmin1; nInm = nNumIn1; |FINSI;
   |SI nNumDel = 2; |Y nNumIn2 ! 0; nDeleg = aDeleg2; nAdmin = aAdmin2; nInm = nNumIn2; |FINSI;
   |SI nNumDel = 3; |Y nNumIn3 ! 0; nDeleg = aDeleg3; nAdmin = aAdmin3; nInm = nNumIn3; |FINSI;
   |SI nNumDel = 4; |Y nNumIn4 ! 0; nDeleg = aDeleg4; nAdmin = aAdmin4; nInm = nNumIn4; |FINSI;
   |SI nNumDel = 5; |Y nNumIn5 ! 0; nDeleg = aDeleg5; nAdmin = aAdmin5; nInm = nNumIn5; |FINSI;
   |SI nNumDel = 6; |Y nNumIn6 ! 0; nDeleg = aDeleg6; nAdmin = aAdmin6; nInm = nNumIn6; |FINSI;
   nDel = nDeleg; nAdm = nAdmin;
   enJustif = #rem00010#12; enJustif = enJustif + (nNumDel - 1);

   #rem00100#69 = nDel;
   #rem00100#70 = nAdm;
   |HAZ LeeFicHacienda;
   #rem00100#71 = aDeleg;
   #rem00100#72 = aAdmin;

   |SI #rey00107#20 = "P";
      nSw = 1; |HAZ ImprimeDatos;
      |INFOR "m213h001";   |PRINT;   |PIEINF;  |FININF;
   |SINO;
      aAlfa = "C:\MODELOS\RENTA\213\"; |RMKDIR aAlfa;
      |QBF aAdmin;
      aAlfa = aAlfa + "213" + (("00000" + #rem00010#0) % -105) + "[" + aAdmin + "].sec";
      |XABRE "WCB", aAlfa, Handle;
      |SI FSalida ] 0;
         Cadena = "213";
         TipoDato = "A"; LongDec = 0;
         Long = 16; aAlfa = #rem00100#71; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 20; aAlfa = #rem00100#72; |HAZ Formateo; Cadena = Cadena + aAlfa;
         aAlfa = (("00" + #rem00100#69) % -102) + (("000" + #rem00100#70) % -103);
         TipoDato = "N";
         Long = 5;                        |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "A";
         Long = 9;  aAlfa = #rem00100#1;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 40; aAlfa = #rem00100#5;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 4;  aAlfa = #rey00107#19; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Cadena = Cadena + "0A";
         Long = 2;  aAlfa = #rem00100#14; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 25; aAlfa = #rem00100#15; |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "N";
         Long = 5;  aAlfa = #rem00100#16; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Cadena = Cadena + " "; TipoDato = "A";
         Long = 2;  aAlfa = #rem00100#17; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 2;  aAlfa = #rem00100#18; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 2;  aAlfa = #rem00100#19; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 20; aAlfa = #rem00100#12; |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "N";
         aAlfa = (("00" + #rem00100#20) % -102) + (("000" + #rem00100#21) % -103);
         Long = 5;                        |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "A";
         Long = 20; aAlfa = #rem00100#22; |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "N";
         Long = 2;  aAlfa = #rem00100#20; |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "A";
         Long = 2;  aAlfa = #rem00010#18; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 25; aAlfa = #rem00010#19; |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "N";
         Long = 5;  aAlfa = #rem00010#20; |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "A";
         Long = 1;  aAlfa = #rem00010#21; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 2;  aAlfa = #rem00010#22; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 2;  aAlfa = #rem00010#23; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 2;  aAlfa = #rem00010#24; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 20; aAlfa = #rem00010#25; |HAZ Formateo; Cadena = Cadena + aAlfa;
         |XGRABA Handle, Cadena; Cadena = "";

         Long = 16; aAlfa = #rem00010#14; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 14; aAlfa = #rem00010#15; |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "N";
         Long = 3;  aAlfa = #rem00010#16; |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "A";
         Long = 20; aAlfa = #rem00010#17; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 9;  aAlfa = #rerenpre#2;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 40; aAlfa = #rerenpre#1;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 2;  aAlfa = #rerenpre#11; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 25; aAlfa = #rerenpre#3;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "N";
         Long = 5;  aAlfa = #rerenpre#4;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Cadena = Cadena + " ";
         TipoDato = "A";
         Long = 2;  aAlfa = #rerenpre#12; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 2;  aAlfa = #rerenpre#13; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 2;  aAlfa = #rerenpre#14; |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 20; aAlfa = #rerenpre#9;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         |XGRABA Handle, Cadena; Cadena = "";

         aAlfa = (("00" + #rerenpre#5)  % -102) + (("000" + #rerenpre#6) % -103);
         TipoDato = "N";
         Long = 5;                        |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "A";
         Long = 20; aAlfa = #rerenpre#7;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "N";
         Long = 2;  aAlfa = #rerenpre#5;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         aAlfax = #rerenpre#10; |QBF aAlfax;
         Long = 2;  aAlfa = aAlfax % 0102;|HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 2;  aAlfa = aAlfax % 0402;|HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 4;  aAlfa = aAlfax % 0704;|HAZ Formateo; Cadena = Cadena + aAlfa;
         TipoDato = "A";
         |SI #rem00010#2 = "1";
            aAlfa = "S       ";
         |FINSI;
         |SI #rem00010#2 = "2";
            aAlfa = #rem00100#10;
            |QBF aAlfa; aAlfa = aAlfa % 0104;
            aAlfa = " S" + aAlfa + "  ";
         |FINSI;
         |SI #rem00010#2 = "3";
            aAlfa = "      S ";
         |FINSI;
         |SI #rem00010#2 = "4";
            aAlfa = "       S";
         |FINSI;
         Cadena = Cadena + aAlfa;
         TipoDato = "N"; LongDec = 2;
         Long = 11; aAlfa = #rem00010#3;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 11; aAlfa = #rem00010#5;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 3;  aAlfa = #rem00010#6;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 11; aAlfa = #rem00010#7;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 11; aAlfa = #rem00010#8;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         |XGRABA Handle, Cadena; Cadena = "";
      |SINO;
         nSwError = 1;
         aAlfa = "    Problemas para crear el fichero de la empresa " + (("00000" + #rem00010#0) % -105) + ".sec";
         |MENAV aAlfa;
      |FINSI;
   |FINSI;

   |SI nDeleg ! 0;
      |SI #rey00107#20 = "P";
         nCalc = nInm - 1; nCalc = nCalc / 7; |HAZ Entero; nCalc = nCalc + 1;
         enContPag = nCalc; enNumPag = 0; enNumInm = 0;
         |INFOR "m213h002";   |BUCLE ModeloInm;   |PIEINF;  |FININF;
      |SINO;
         nInmuebles = 0;
         |BUCLE ModeloInm;
         |PARA nCont = nInmuebles; |SI nCont [ 14; |HACIENDO nCont = nCont + 1;
            aAlfa = (" " * 86) + ("0" * 13);
            |XGRABA Handle, aAlfa;
         |SIGUE;

         Cadena = "";
         Long = 99; aAlfa = #rerenpre#1;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Cadena = Cadena + " ";
         Long = 9;  aAlfa = #rerenpre#9;  |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 60; aAlfa = "";           |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 60; aAlfa = "";           |HAZ Formateo; Cadena = Cadena + aAlfa;
         |XGRABA Handle, aAlfa; Cadena = "";

         Long = 60; aAlfa = "";           |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 60; aAlfa = "";           |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 60; aAlfa = "";           |HAZ Formateo; Cadena = Cadena + aAlfa;
         Long = 50; aAlfa = "";           |HAZ Formateo; Cadena = Cadena + aAlfa;
         |XGRABA Handle, aAlfa; Cadena = "";

         |XCIERRA Handle;
         |ACABA;
      |FINSI;
   |FINSI;

   |SI #rem00010#2 = "1";
      |SI #rey00107#20 = "P";
         nNumSocs = 0; |BUCLE RevisaSocios;
         nCalc = nNumSocs - 1; nCalc = nCalc / 6; |HAZ Entero; nCalc = nCalc + 1;
         enContPag = nCalc; enNumPag = 0; nNumSocs = 0;
         |INFOR "m213h003";   |BUCLE ModeloSoc;   |PIEINF;  |FININF;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Impresora;
   aDeleg1 = ""; aDeleg2 = ""; aDeleg3 = ""; aDeleg4 = ""; aDeleg5 = ""; aDeleg6 = "";
   nNumIn1 = 0;  nNumIn2 = 0;  nNumIn3 = 0;  nNumIn4 = 0;  nNumIn5 = 0;  nNumIn6 = 0;
   nSwHay = 0;
   |BUCLE RevisaInm;
   |SI nSwHay = 0;
      |MENAV "    Modelo sin relacion de inmuebles";
   |FINSI;
   |SI aDeleg1 ! ""; nNumDel = 1; |HAZ Modelo; |FINSI;
   |SI aDeleg2 ! ""; nNumDel = 2; |HAZ Modelo; |FINSI;
   |SI aDeleg3 ! ""; nNumDel = 3; |HAZ Modelo; |FINSI;
   |SI aDeleg4 ! ""; nNumDel = 4; |HAZ Modelo; |FINSI;
   |SI aDeleg5 ! ""; nNumDel = 5; |HAZ Modelo; |FINSI;
   |SI aDeleg6 ! ""; nNumDel = 6; |HAZ Modelo; |FINSI;
|FPRC;

|PROCESO Emite;
    #3#0 = #2#0;
    #3#1 = #2#1;
    |LEE 101#3=;                        || lee modelo 213 (rem00010)
    |SI FSalida ! 0;
       |ACABA;
    |SINO;
       #3#11 = "S"; |GRABA 020#3a;     || impreso SI
    |FINSI;
    |LIBERA #3;

    seleccio = 1;

    |DDEFECTO #4;
    #4#0 = #1#69;
    #4#1 = #1#70;
    |LEE 000#4=;        || datos hacienda

    |HAZ Impresora;
|FPRC;

|DEFBUCLE Emite;
 #2#1;
 ;
 #1#0,  1;
 #1#0, 99;
 ;
 NULL, Emite;
|FIN;

|PROCESO Tipo3;
|ABRE #1;       || datos contribuyentes
|ABRE #3;       || modelo 213
nSwError = 0;
|PARA Empresa = 0; |SI Empresa [ 17; |HACIENDO Empresa = Empresa + 1;
    |SI #0Empresa ! 0;
            #1#0 = #0Empresa;
        |LEE 000#1=;
        |SI FSalida = 0;|Y #1#10 = "N";
            |BUCLE Emite;
        |FINSI;
    |FINSI;
|SIGUE;
|SI seleccio = 0;|Y Temporal = "";
    |MENAV "    Seleccion vacia ...";
|FINSI;
|SI #rey00107#20 ! "P";
   |SI nSwError = 0;
      |MENAV "    Ficheros creados correctamente";
   |SINO;
      |MENAV "    Ha habido algunos problemas con la creacion de algunos ficheros";
   |FINSI;
|FINSI;
|CIERRA #1;
|CIERRA #3;
|FPRC;

|PROCESO MiraMes;
   Mes = #rey00107#18 % 0402; MesNum = Mes;
   |SI MesNum = 1;  Mes = " Enero ";      |FINSI;
   |SI MesNum = 2;  Mes = " Febrero ";    |FINSI;
   |SI MesNum = 3;  Mes = " Marzo ";      |FINSI;
   |SI MesNum = 4;  Mes = " Abril ";      |FINSI;
   |SI MesNum = 5;  Mes = " Mayo ";       |FINSI;
   |SI MesNum = 6;  Mes = " Junio ";      |FINSI;
   |SI MesNum = 7;  Mes = " Julio ";      |FINSI;
   |SI MesNum = 8;  Mes = " Agosto ";     |FINSI;
   |SI MesNum = 9;  Mes = " Septiembre "; |FINSI;
   |SI MesNum = 10; Mes = " Octubre ";    |FINSI;
   |SI MesNum = 11; Mes = " Noviembre ";  |FINSI;
   |SI MesNum = 12; Mes = " Diciembre ";  |FINSI;
|FPRC;

|PROGRAMA;
    |HAZ PreparaInformes;

    |CLS;
    |CABEZA "Impresion 213";
    |PINPA #0#0;
    |DDEFECTO #0;
    |PINDA #0#0; ||HAZ PintaMoneda;
    |ENDATOS #1#0;
    |SI FSalida = 0;
        |HAZ MiraMes;
        |SI #rey00107#20 = "P";
           |IMPRE 0;
        |SINO;
           FSalida = 0;
        |FINSI;
        |SI FSalida = 0;
            |HAZ Tipo3;
        |SINO;
            |MENAV "    Proceso abortado ...";
        |FINSI;
        |SI #rey00107#20 = "P"; |FINIMP; |FINSI;
    |FINSI;
|FPRO;

|PROCESO PintaMoneda;
|VARIABLES;
  {-1}aMoneda   = "";
      aMoneda1  = "LEER";
      aMoneda2  = "";
|FIN;
     aAlfa = " Moneda de emision : ";
     IaMoneda = aMoneda1<-;
     |ESPECIFICA "MODO_VER_EURO", aMoneda;
     |SI aMoneda2 = "0";
         aAlfa = aAlfa + "PESETAS";
     |SINO;
         aAlfa = aAlfa + "EUROS  ";
     |FINSI;
     |ATRI I; |PINTA 1622, aAlfa; |ATRI N;
|FPRC;

|PROCESO Formateo;
   |QBF aAlfa;
   |SI TipoDato = "F";
      aAlfa = aAlfa - "."; aAlfa = aAlfa - ".";
      |QBF aAlfa;
      |SI aAlfa = "";         aAlfa = "0" * 8; |FINSI;
      |SI aAlfa = "01010000"; aAlfa = "0" * 8; |FINSI;
      |ACABA;
   |FINSI;
   |SI TipoDato = "N";
      Vacio1 = "0" * Long;
      Vacio2 = "0" * LongDec;
      aAlfa = aAlfa - "-";
      |SI FSalida ! 0;
         nNegativo = 1;
      |SINO;
         nNegativo = 0;
      |FINSI;
   |SINO;
      Vacio1 = " " * Long;
   |FINSI;

   |SI TipoDato ! "N";
      Calc1 = 100 + Long; aAlfa = (aAlfa + Vacio1) % Calc1;
   |SINO;
      |SI LongDec = 0;
         Calc1 = 0 - (100 + Long);
         aAlfa = (Vacio1 + aAlfa) % Calc1;
      |SINO;
         aAlfa = aAlfa - ".";
         |SI FSalida = 0;
            Calc1 = 0 - (100 + Long);
            aAlfa = (Vacio1 + aAlfa) % Calc1;
            aAlfa1 = "0" * LongDec;
         |SINO;
            Calc1 = (((FSalida / 100) ! 0) - 1) + 100;
            Calc2 = (((FSalida / 100) ! 0) * 100) + 99;
            aAlfa1 = aAlfa % Calc2;
            aAlfa = aAlfa % Calc1;
            Calc1 = 0 - (100 + Long);
            aAlfa = (Vacio1 + aAlfa)  % Calc1;
            Calc1 = 100 + LongDec;
            aAlfa1 = (aAlfa1 + Vacio2) % Calc1;
         |FINSI;
         aAlfa = aAlfa + aAlfa1;
      |FINSI;
      |SI nNegativo = 1;
         Calc1 = 0 - (100 + (Long + LongDec)); Calc1 = Calc1 + 1;
         aAlfa = aAlfa % Calc1;
         aAlfa = "N" + aAlfa;
      |FINSI;
   |FINSI;

   aAlfa2 = "";

   |SI TipoDato = "A"; |O TipoDato = "An";
      aLong = aAlfa % 0; nLong = aLong;
      |PARA nCont1 = 1; |SI nCont1 [ nLong; |HACIENDO nCont1 = nCont1 + 1;
         Calc1 = (nCont1 * 100) + 1; aAlfa1  = aAlfa % Calc1;
         aAlfa1 = aAlfa1 > aAlfa1;
         |SI aAlfa1 = " ";                  |VETE Sigue1; |FINSI;
         |SI aAlfa1 ] "A"; |Y aAlfa1 [ "Z"; |VETE Sigue1; |FINSI;
         |SI aAlfa1 ] "0"; |Y aAlfa1 [ "9"; |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "¥"; aAlfa1 = &209;   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "¤"; aAlfa1 = &209;   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "ç"; aAlfa1 = &199;   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "Ç"; aAlfa1 = &199;   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "-"; aAlfa1 = &45;    |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "'"; aAlfa1 = &49;    |VETE Sigue1; |FINSI;
         |SI TipoDato = "An";
            |SI aAlfa1 = "&"; aAlfa1 = &38;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = ","; aAlfa1 = &44;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = "."; aAlfa1 = &46;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = ":"; aAlfa1 = &58;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = ";"; aAlfa1 = &59;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = "_"; aAlfa1 = &95;    |VETE Sigue1; |FINSI;
         |FINSI;
         aAlfa1 = " ";
|ET Sigue1;
         aAlfa2 = aAlfa2 + aAlfa1;
      |SIGUE;
      aAlfa = aAlfa2;
   |FINSI;
   Calc1 = aAlfa;
|FPRC;
