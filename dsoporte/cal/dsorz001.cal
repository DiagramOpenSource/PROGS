|FICHEROS;
     dsorw001 #1;
     dsorm001 #4;
     dsorm002 #2;
     dsorm003 #3;

     dsorw007 #97;
     dsorw008 #98;
     dsorw010 #99;

     dsorw001@ #999;
|FIN;

|VARIABLES;
     aCaracter = "";
     aDescri   = "";
     aPrograma = "";
     aAlfa     = "";
     aAlfa1    = "";
     aLong     = "";
     aFichero  = "";
     aBase     = "";
     aMenu     = "";
     aClave1   = "";
     aClave2   = "";
     aClave3   = "";
     aClave4   = "";
     aClave5   = "";
     aClave6   = "";
     aClave7   = "";
     aClave8   = "";
     aClave9   = "";
     aClave10  = "";
     aClave11  = "";
     aClave12  = "";
     aClave13  = "";
     aClave14  = "";
     aClave15  = "";
     aMarca    = "";
     aDClave   = "";
     aHClave   = "";
     aClaveMenu = "";
     aParametro = "";
     aNumero    = "";
     aMas       = "";

     nClave    = 0;
     nLong     = 0;
     nSw       = 0;
     nCaracter = 0;
     nPos      = 0;
     nHandle   = 0;
     nPasada   = 0;
     nCampo    = 0;
     nIde      = 0;
     nHayNO    = 0;
     nHaySI    = 0;
     nPasadaMen= 0;

     nD1  = 0;   nH1  = 99999;
     nD2  = 0;   nH2  = 99999;
     nD3  = 0;   nH3  = 99999;
     nD4  = 0;   nH4  = 99999;
     nD5  = 0;   nH5  = 99999;
     nD6  = 0;   nH6  = 99999;
     nD7  = 0;   nH7  = 99999;
     nD8  = 0;   nH8  = 99999;
     nD9  = 0;   nH9  = 99999;
     nD10 = 0;   nH10 = 99999;
     nD11 = 0;   nH11 = 99999;
     nD12 = 0;   nH12 = 99999;
     nD13 = 0;   nH13 = 99999;
     nD14 = 0;   nH14 = 99999;
     nD15 = 0;   nH15 = 99999;

     &enArea   = 0;
     &enNivel  = 0;
     &enGrupo  = 0;
     &eaAplica = "";
     &eaMenu   = "";
     &enPRM    = 0;
     &eaTitulo = "";
     &eaCab    = "";
     &enError  = 0;
|FIN;

|PROCESO Mensa07;  |TIPO 7;
     |MENSA "0000 Pulse <F2> Lineal Aplicaciones";
|FPRC;

|PROCESO Mensa08;  |TIPO 7;
     |MENSA "0000 <F2>Lineal Menus;  <F3>Restringir Menu General; <F4>Desactivar Menu General.";
|FPRC;

|PROCESO Mensa10;  |TIPO 7;
     |MENSA "0000 ";
|FPRC;

|| --------------------------------------------------------------------------
|| PROGRAMAS DE ACCESO A LOS MENUS
|| --------------------------------------------------------------------------

|PROCESO Tipo11w10;  |TIPO 11;
     eaCab = "GRUPO (" + (("0000" + #dsorw007#0) % -104) + "-" + #dsorw007#1;  |QBF eaCab;
     eaCab = eaCab + ")  (MENU " + #dsorw010#2;  |QBF eaCab;
     eaCab = eaCab + ")";

     enPRM = 0;
     |SI FSalida = 10;
         |SI #99#3 = "S";
             |MENAV "      El Menu esta Quitado Completamente. Pulse F4 para Reponer el Menu";
             |ACABA;
         |FINSI;

         |LEE 101#99=;
         #99#3 = "N";
         |GRABA 020#99a;
         |LIBERA #99;

         |HAZ Tipo3;
     |FINSI;

     |SI FSalida = 11;
         |LEE 101#99=;
         #99#3 = "S";
         |GRABA 020#99a;
         |LIBERA #99;

         |HAZ Tipo3;

         |SI enError = 1;
             |LEE 101#99=;
             #99#3 = "N";
             |GRABA 020#99a;
             |LIBERA #99;
         |FINSI;
     |FINSI;

     |SI FSalida = 12;
         |LEE 101#99=;
         #99#3 = "X";
         |HAZ Tipo3;

         #99#3 = "N";
         |GRABA 020#99a;
         |LIBERA #99;
     |FINSI;

     |SI FSalida = 13;
         |LEE 101#99=;
         |SI FSalida = 0;
             |SI #99#4 = "N";
                 #99#4 = "S";
             |SINO;
                 #99#4 = "N";
             |FINSI;
             |GRABA 020#99a;
             |LIBERA #99;

             |PINTA #99#4;

             enPRM = 1;
             |HAZ Tipo3;
         |FINSI;
     |FINSI;

     |SI FSalida = 14;
         |LEE 101#99=;
         |SI FSalida = 0; |Y #99#5 = "MENSAJE        ";
             #99#5 = "QUITAR ACCESO";
             |GRABA 020#99a;
             |LIBERA #99;

             |PINTA #99#5;

             enPRM = 1;
             |HAZ Tipo3;
         |FINSI;
     |FINSI;

     |SI FSalida = 15;
         |LEE 101#99=;
         |SI FSalida = 0; |Y #99#5 = "QUITAR ACCESO  ";
             #99#5 = "MENSAJE      ";
             |GRABA 020#99a;
             |LIBERA #99;

             |PINTA #99#5;

             enPRM = 1;
             |HAZ Tipo3;
         |FINSI;
     |FINSI;
|FPRC;

|RUTINA ClaveBaja98;
     #98#0 = #97#0;
     #98#1 = "        ";
|FRUT;

|RUTINA ClaveAlta98;
     #98#0 = #97#0;
     #98#1 = "zzzzzzzz";
|FRUT;

|RUTINA ClaveBaja99;
     #99#0 = #98#0;
     #99#1 = #98#1;
     #99#2 = "        ";
|FRUT;

|RUTINA ClaveAlta99;
     #99#0 = #98#0;
     #99#1 = #98#1;
     #99#2 = "zzzzzzzz";
|FRUT;

|PROCESO Saca98;  |TIPO 7;
     |ENTLINEAL #1#98, -2, 7, 15, 1, ClaveBaja98, ClaveAlta98;
     |ENTLINEAL #1#99, -3, 7, 22, 1, ClaveBaja99, ClaveAlta99;
|FPRC;

|PROCESO Entra98;  |TIPO 11;
     |SI FSalida ! 10;  |ACABA;  |FINSI;

     |ENTLINEAL #1#98, -2, 4, 15, 1, ClaveBaja98, ClaveAlta98;
|FPRC;

|PROCESO Saca99;  |TIPO 7;
     |ENTLINEAL #1#99, -3, 7, 22, 1, ClaveBaja99, ClaveAlta99;
|FPRC;

|PROCESO Entra99;  |TIPO 11;
     |SI FSalida = 10;
         |ATRI S;
         |PINTA 0659, "F2 Entrada manual    ";
         |PINTA 0759, "F3 Quitar el menu    ";
         |PINTA 0859, "   completamente     ";
         |PINTA 0959, "F4 Reponer el menu   ";
         |PINTA 1059, "   completamente     ";
         |PINTA 1159, "F5 Activar/Desactivar";
         |PINTA 1259, "   TAB en el PRM     ";
         |PINTA 1359, "F6 Quitar acceso     ";
         |PINTA 1459, "F7 Mensajes en acceso";
         |ATRI 0;

         |ENTLINEAL #1#99, -3, 4, 22, 1, ClaveBaja99, ClaveAlta99;

         |PINTA 0659, "                     ";
         |PINTA 0759, "                     ";
         |PINTA 0859, "                     ";
         |PINTA 0959, "                     ";
         |PINTA 1059, "                     ";
         |PINTA 1159, "                     ";
         |PINTA 1259, "                     ";
         |PINTA 1359, "                     ";
         |PINTA 1459, "                     ";
     |FINSI;

     |SI FSalida = 11;
         #98#0 = #97#0;
         #98#1 = "menugnrl";
         |LEE 101#98=;
         |SI FSalida = 0;  |ACABA;  |FINSI;

         |DDEFECTO #98;
         #98#0 = #97#0;
         #98#1 = "menugnrl";
         #98#2 = "Menu General";
         |GRABA 020#98n;
         |LIBERA #98;

         |ABRE #99;
         #99#0 = #98#0;
         #99#1 = #98#1;
         #99#2 = "ds";
         |LEE 101#99=;
         |SI FSalida ! 0;
             |DDEFECTO #99;
             #99#0 = #98#0;
             #99#1 = #98#1;
             #99#2 = "ds";

             |GRABA 020#99b;
         |FINSI;

         |ABRE #3;
         #3#0 = #99#0;
         #3#1 = #99#1;
         #3#2 = #99#2;
         #3#6 = "";
         |LEE 040#3];
         |SI FSalida = 0;  |Y #3#0 = #99#0; |Y #3#1 = #99#1; |Y #3#2 = #99#2;
             #99#3 = #3#4;
             #99#4 = #3#7;

                            #99#5 = "QUITAR ACCESO";
             |SI #3#8 = 2;  #99#5 = "MENSAJE        ";  |FINSI;
         |FINSI;
         |CIERRA #3;

         |GRABA 020#99a;
         |LIBERA #99;

         |CIERRA #99;

         |PONCONTROL 23, "SI";
         |PTEC 812;
     |FINSI;

     |SI FSalida = 12;
         #98#0 = #97#0;
         #98#1 = "menugnrl";
         |LEE 101#98=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |BORRA 020#98a;

         |ABRE #99;
         #99#0 = #98#0;
         #99#1 = #98#1;
         #99#2 = "ds";
         |LEE 101#99=;
         |SI FSalida = 0;
             |BORRA 020#99a;

             aDClave = " ";
             aHClave = "z" * 100;
             |HAZ Borra3;
         |FINSI;
         |CIERRA #99;

         |PONCONTROL 23, "SI";
         |PTEC 812;
     |FINSI;
|FPRC;

|PROCESO Graba97;
     #97#0 = #4#0;
     #97#1 = #4#1;
     |GRABA 020#97n;
     |LIBERA #97;
|FPRC;

|DEFBUCLE dsorm001;
     #4#1;
     ;
     0001;
     9999;
     ;
     NULL, Graba97;
|FIN;

|PROCESO PonMenuGeneral;
     |ABRE #3;
     #3#0 = #97#0;
     #3#1 = "menugnrl";
     #3#2 = "ds";
     #3#6 = "";
     |LEE 040#3];
     |SI FSalida = 0;  |Y #3#0 = #97#0; |Y #3#1 = "menugnrl"; |Y #3#2 = "ds      ";
         #98#0 = #97#0;
         #98#1 = "menugnrl";
         |LEE 101#98=;
         |SI FSalida ! 0;
             |DDEFECTO #98;
             #98#0 = #97#0;
             #98#1 = "menugnrl";
             #98#2 = "Menu General";
             |GRABA 020#98n;
             |LIBERA #98;

             |ABRE #99;
             #99#0 = #98#0;
             #99#1 = #98#1;
             #99#2 = "ds";
             |LEE 101#99=;
             |SI FSalida ! 0;
                 |DDEFECTO #99;
                 #99#0 = #98#0;
                 #99#1 = #98#1;
                 #99#2 = "ds";
                 |GRABA 020#99b;
             |FINSI;

             #99#3 = #3#4;
             #99#4 = #3#7;

                            #99#5 = "QUITAR ACCESO";
             |SI #3#8 = 2;  #99#5 = "MENSAJE        ";  |FINSI;

             |GRABA 020#99a;
             |LIBERA #99;
         |FINSI;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Graba98;
     |SI nPasada = 0;
         |HAZ PonMenuGeneral;
     |FINSI;

     #98#0 = #97#0;
     #98#1 = #2#0;
     |LEE 101#98=;
     |SI FSalida ! 0;
         |DDEFECTO #98;
         #98#0 = #97#0;
         #98#1 = #2#0;
         #98#2 = #2#2;
         |GRABA 020#98n;
     |FINSI;
     |LIBERA #98;

     #99#0 = #98#0;
     #99#1 = #98#1;
     #99#2 = #2#1;
     |LEE 101#99=;
     |SI FSalida ! 0;
         |DDEFECTO #99;
         #99#0 = #98#0;
         #99#1 = #98#1;
         #99#2 = #2#1;

         |GRABA 020#99b;
     |FINSI;

     |ABRE #3;
     #3#0 = #99#0;
     #3#1 = #99#1;
     #3#2 = #99#2;
     #3#6 = "";
     |LEE 040#3];
     |SI FSalida = 0;  |Y #3#0 = #99#0; |Y #3#1 = #99#1; |Y #3#2 = #99#2;
         #99#3 = #3#4;
         #99#4 = #3#7;

                        #99#5 = "QUITAR ACCESO";
         |SI #3#8 = 2;  #99#5 = "MENSAJE        ";  |FINSI;
     |FINSI;
     |CIERRA #3;

     |GRABA 020#99a;
     |LIBERA #99;
|FPRC;

|DEFBUCLE dsorw007;
     #97#1;
     ;
     0001;
     9999;
     ;
     NULL, Graba98;
|FIN;

|PROCESO Mira97;
     |BUCLE dsorw007;

     nPasada = 1;
|FPRC;

|DEFBUCLE dsorm002;
     #2#1;
     ;
     "        ", "        ";
     "zzzzzzzz", "zzzzzzzz";
     ;
     NULL, Mira97;
|FIN;

|RUTINA ClaveBaja97;
     #97#0 = 1;
|FRUT;

|RUTINA ClaveAlta97;
     #97#0 = 9999;
|FRUT;

|PROGRAMA;
     aParametro = PARAMETRO;  |QBF aParametro;

     |SI aParametro = "CREAMENU";
         |HAZ LoCreaDesdePerfiles;
         |ACABA;
     |FINSI;

     |CLS;
     |CABEZA "Asistente Restricciones Menu";

     aFichero = "dsorw007" + Usuario;
     |NOME_DAT #97 aFichero;
     |ABRE #97;  |CIERRA #97;  |DELINDEX #97;

     aFichero = "dsorw008" + Usuario;
     |NOME_DAT #98 aFichero;
     |ABRE #98;  |CIERRA #98;  |DELINDEX #98;

     aFichero = "dsorw010" + Usuario;
     |NOME_DAT #99 aFichero;
     |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

     |ABRE #97;
     |SI aParametro = "";
         |BUCLE dsorm001;
     |SINO;
         #97#0  = (enArea * 100) + enNivel;
         #97#1  = eaTitulo;
         |GRABA 020#97n;
         |LIBERA #97;
     |FINSI;
     |CIERRA #97;

     |ABRE #98;
     |ABRE #99;
     |BUCLE dsorm002;
     |CIERRA #98;
     |CIERRA #99;

     |ENTLINEAL #1#97, -1, 4, 15, 1, ClaveBaja97, ClaveAlta97;

     |DELINDEX #97;
     |DELINDEX #98;
     |DELINDEX #99;
|FPRO;
