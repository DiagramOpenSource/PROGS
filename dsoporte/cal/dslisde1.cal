|FICHEROS;
     dslisde1 #1;
     dslisde2 #2,MANTE;
     dslisde3 #3;
     dslisde4 #4;
     dslisde5 #5,MANTE;

     referen@ #900;
|FIN;

|VARIABLES;
     aAlfa        = "";
     aAlfa1       = "";
     aDirAplica   = "";
     aDirDef      = "";
     aBase        = "";
     aBaseDef     = "";
     aFichero     = "";
     aAplica      = "";
     aDef         = "";
     aMas         = "";
     aQueQuiero   = "";
     aBaseFich    = "";
     aTitulo      = "";
     aDSoporte    = "";
     aPassword    = "";
     aDDef        = "";
     aHDef        = "";
     aDAplica     = "";
     aHAplica     = "";

     nPos         = 0;
     nBusca       = 0;
     nTCampo      = 0;
     nTCompo      = 0;
     nCampo       = 0;
     nCampo1      = 0;
     nCompo       = 0;
     nNume        = 0;
     nPosi        = 0;
     nHandle      = 0;
     nMalo        = 0;
     nContador    = 0;
     nImpresion   = 0;

     &enSw        = 0;

     &eaA1        = "";
     &eaB1        = "";
     &eaC1        = "";
     &eaD1        = "";
     &eaE1        = "";
     &eaF1        = "";
     &eaA2        = "";
     &eaB2        = "";
     &eaC2        = "";
     &eaD2        = "";
     &eaE2        = "";
     &eaF2        = "";
     &eaA3        = "";
     &eaB3        = "";
     &eaC3        = "";
     &eaD3        = "";
     &eaE3        = "";
     &eaF3        = "";
|FIN;

|RUTINA ClaveBaja1;
    #1#0 = aDAplica;
|FRUT;

|RUTINA ClaveAlta1;
    #1#0 = aHAplica;
|FRUT;

|RUTINA ClaveBaja2;
    #2#0 = #1#0;
    #2#1 = "        ";
|FRUT;

|RUTINA ClaveAlta2;
    #2#0 = #1#0;
    #2#1 = "zzzzzzzz";
|FRUT;

|RUTINA ClaveBaja3;
    #3#0 = #2#0;
    #3#1 = #2#1;
    #3#2 = 000;
|FRUT;

|RUTINA ClaveAlta3;
    #3#0 = #2#0;
    #3#1 = #2#1;
    #3#2 = 999;
|FRUT;

|RUTINA ClaveBaja4;
    #4#0 = #2#0;
    #4#1 = #2#1;
    #4#2 = 01;
|FRUT;

|RUTINA ClaveAlta4;
    #4#0 = #2#0;
    #4#1 = #2#1;
    #4#2 = 99;
|FRUT;

|RUTINA ClaveBaja5;
    #5#0 = "        ";
|FRUT;

|RUTINA ClaveAlta5;
    #5#0 = "zzzzzzzz";
|FRUT;

|PROCESO Emite3;
     nContador = nContador + 1;

     |SI nContador = 1;
         eaA1 = ("000" + #3#2) % -103;
         eaB1 = #3#3;
         eaC1 = #3#4;
         eaD1 = #3#5;
         eaE1 = #3#6;
         eaF1 = #3#7;
     |FINSI;

     |SI nContador = 2;
         eaA2 = ("000" + #3#2) % -103;
         eaB2 = #3#3;
         eaC2 = #3#4;
         eaD2 = #3#5;
         eaE2 = #3#6;
         eaF2 = #3#7;
     |FINSI;

     |SI nContador = 3;
         eaA3 = ("000" + #3#2) % -103;
         eaB3 = #3#3;
         eaC3 = #3#4;
         eaD3 = #3#5;
         eaE3 = #3#6;
         eaF3 = #3#7;

         nContador = 0;
         |PRINT;

         eaA1 = ""; eaB1 = ""; eaC1 = ""; eaD1 = ""; eaE1 = ""; eaF1 = "";
         eaA2 = ""; eaB2 = ""; eaC2 = ""; eaD2 = ""; eaE2 = ""; eaF2 = "";
         eaA3 = ""; eaB3 = ""; eaC3 = ""; eaD3 = ""; eaE3 = ""; eaF3 = "";
     |FINSI;
|FPRC;

|DEFBUCLE dslisde3I;
     #3#1;
     ;
     #2#0, #2#1, 000;
     #2#0, #2#1, 999;
     ;
     NULL, Emite3;
|FIN;

|PROCESO Emite4;
     |PRINT;
|FPRC;

|DEFBUCLE dslisde4I;
     #4#1;
     ;
     #2#0, #2#1, 00;
     #2#0, #2#1, 99;
     be;
     NULL, Emite4;
|FIN;

|PROCESO Emite2;
     |SI nImpresion = 1;
         nContador = 0;
         enSw = 1;  |BUCLE dslisde4I;
         enSw = 2;  |BUCLE dslisde3I;
         |SI nContador ! 0;  |PRINT;  |FINSI;

        |PIEINF;
     |SINO;
        |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE dslisde2I;
     #2#1;
     ;
     #1#0, aDDef;
     #1#0, aHDef;
     ;
     NULL, Emite2;
|FIN;

|DEFBUCLE dslisde2R;
     #2#2;
     ;
     #1#0, "                    ";
     #1#0, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, Emite2;
|FIN;

|PROCESO Impresion;
     nImpresion = 1;

     |MENAV "0000 Recuerde seleccione impresora DS-LASER y formato HORIZONTAL";

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "dslisdef";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |BUCLE dslisde2I;

     |FININF;
     |FINIMP;
|FPRC;

|PROCESO ImpresionRes;
     nImpresion = 2;

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "dslisde1";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |BUCLE dslisde2R;

     |PIEINF;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO Borra3;
     |BORRA 020#3a;
     |LIBERA #3;
|FPRC;

|DEFBUCLE dslisde3B;
     #3#1;
     ;
     #2#0, #2#1, 000;
     #2#0, #2#1, 999;
     be;
     NULL, Borra3;
|FIN;

|PROCESO Borra4;
     |BORRA 020#4a;
     |LIBERA #4;
|FPRC;

|DEFBUCLE dslisde4B;
     #4#1;
     ;
     #2#0, #2#1, 00;
     #2#0, #2#1, 99;
     be;
     NULL, Borra4;
|FIN;

|PROCESO Tipo0lisde5;  |TIPO 0;
     aAplica = #5#0;
     |PTEC 807;
|FPRC;

|PROCESO Tipo7lisde2;  |TIPO 7;
     |ENTLINEAL #1#3, -3, 7, 22, 0, ClaveBaja3, ClaveAlta3;
|FPRC;

|PROCESO Tipo11lisde2;  |TIPO 11;
     |SI FSalida = 10;
         |ENTLINEAL #1#3, -3, 4, 22, 0, ClaveBaja3, ClaveAlta3;
     |FINSI;

     |SI FSalida = 11;
         |PUSHV 0501 2380;
         |ENTLINEAL #1#4, -3, 4, 21, 1, ClaveBaja4, ClaveAlta4;
         |POPV;
         |ERROR;
     |FINSI;

     |SI FSalida = 12;
         |CONFI "0000NEsta seguro de Excluir el Def ";
         |SI FSalida ! 0;  |ERROR;  |ACABA;  |FINSI;

         |DFICE aDSoporte;   |QBF aDSoporte;
         aDSoporte = aDSoporte + "dslisdef.txt";
         |XABRE "A", aDSoporte, nHandle;
         |SI FSalida ] 0;
             aAlfa = #2#0 + #2#1 + &13 + &10;
             |XGRABA nHandle, aAlfa;

             |LEE 101#2=;
             |BUCLE dslisde3B;
             |BUCLE dslisde4B;
             |BORRA 020#2a;
             |LIBERA #2;

             |PONCONTROL 23, "SI";
         |FINSI;
         |XCIERRA nHandle;
     |FINSI;

     |SI FSalida = 13;
         aDDef = #2#1;
         aHDef = #2#1;
         |HAZ Impresion;
         |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;

|PROCESO Tipo7lisde1;  |TIPO 7;
     |ENTLINEAL #1#2, -2, 7, 22, 0, ClaveBaja2, ClaveAlta2;

     |ABRE #2;
     #2#0 = #1#0;
     #2#1 = "        ";
     |LEE 040#2];
     |CIERRA #2;

     |ENTLINEAL #1#3, -3, 7, 22, 0, ClaveBaja3, ClaveAlta3;
|FPRC;

|PROCESO Tipo11lisde1;  |TIPO 11;
     |SI FSalida = 10;
         |ENTLINEAL #1#2, -2, 4, 22, 0, ClaveBaja2, ClaveAlta2;
     |FINSI;

     |SI FSalida = 11;
         aDDef = "        ";
         aHDef = "zzzzzzzz";
         |HAZ Impresion;
     |FINSI;

     |SI FSalida = 12;
         aDDef = "        ";
         aHDef = "zzzzzzzz";
         |HAZ ImpresionRes;
     |FINSI;
|FPRC;

|PROCESO GrabaDef;
     nMalo = 0;
     aAlfa = ((aAplica + "        ") % 108) + ((aDef + "        ") % 108);
     |DFICE aDSoporte;   |QBF aDSoporte;
     aDSoporte = aDSoporte + "dslisdef.txt";
     |XABRE "U", aDSoporte, nHandle;
     |SI FSalida ] 0;
         |PARA; |SI; |HACIENDO;
              |XLEE nHandle, 250, aAlfa1;
              |SI FSalida < 0;  |SAL;  |FINSI;

              |QBF aAlfa1;
              |SI aAlfa = aAlfa1;  nMalo = 1;  |SAL;  |FINSI;
         |SIGUE;
     |FINSI;
     |XCIERRA nHandle;

     |SI nMalo = 1;  |ACABA;  |FINSI;

     aMas = aDirDef;  |QBF aMas;
     |CARGA_DEF aMas, referen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aQueQuiero = "|NK";
     aAlfa      = #900#aQueQuiero#;
     nTCampo    = aAlfa;
     nTCampo    = nTCampo - 1;
     |SI nTCampo < 0;
         |DESCARGA_DEF #referen@;
         |ACABA;
     |FINSI;

     |PATH_DAT #900 aBaseFich;

     aQueQuiero = "|FICHERO";
     aFichero   = #900#aQueQuiero#;
     aFichero   = aFichero - aBaseFich;
     |SI aFichero ! aDef;
         |DESCARGA_DEF #referen@;
         |ACABA;
     |FINSI;

     aQueQuiero = "|TITULO";
     aTitulo    = #900#aQueQuiero#;

     aQueQuiero = "|NC";
     aFichero   = #900#aQueQuiero#;
     nTCampo    = aFichero;
     nTCampo    = nTCampo - 1;
     |PARA nCampo = 0;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           #3#0       = #1#0;
           #3#1       = aDef;
           #3#2       = nCampo;

           aQueQuiero = "|C" + (("000" + nCampo) % -103) + "NOMBRE";
           aFichero   = (#900#aQueQuiero# + (" " * 20)) % 120;
           #3#3       = aFichero;

           aQueQuiero = "|C" + (("000" + nCampo) % -103) + "TIPO";
           aFichero   = #900#aQueQuiero#;
           #3#4       = aFichero;

           aQueQuiero = "|C" + (("000" + nCampo) % -103) + "LONGITUD";
           aFichero   = ((#900#aQueQuiero# + (" " * 3)) % 103);
           #3#5       = aFichero;

           aQueQuiero = "|C" + (("000" + nCampo) % -103) + "MINIMO";
           aFichero   = ((#900#aQueQuiero# + (" " * 20)) % 120);
           #3#6       = aFichero;

           aQueQuiero = "|C" + (("000" + nCampo) % -103) + "MAXIMO";
           aFichero   = ((#900#aQueQuiero# + (" " * 20)) % 120);
           #3#7       = aFichero;

           |GRABA 020#3n;
           |LIBERA #3;
     |SIGUE;

     aQueQuiero = "|NK";
     aFichero   = #900#aQueQuiero#;
     nTCampo    = aFichero;
     nTCampo    = nTCampo - 1;
     |PARA nCampo = 0;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aQueQuiero = "|K" + (("000" + nCampo) % -103);
           aFichero   = (#900#aQueQuiero# % 103);
           nTCompo    = aFichero;

           |DDEFECTO #4;
           #4#0 = #1#0;
           #4#1 = aDef;
           #4#2 = nCampo + 1;
           |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
                 nCampo1   = nCompo + 2;
                 nPosi     = (nCompo * 300) + 103;
                 aAlfa     = #900#aQueQuiero# % nPosi;
                 #4nCampo1 = aAlfa;
           |SIGUE;
           |GRABA 020#4n;
           |LIBERA #4;
      |SIGUE;

     |DESCARGA_DEF #referen@;

     nBusca = 1;
     #2#0 = #1#0;
     #2#1 = aDef;
     #2#2 = aTitulo;
     |GRABA 020#2n;
     |LIBERA #2;
|FPRC;

|PROCESO BuscaDef;
     nBusca  = 0;
     aAplica = #1#0;  |QBF aAplica;
     aBaseDef  = aBase + aAplica + "/def/";
     aBaseFich = aBase + aAplica + "/fich/";
     aDirDef  = aBaseDef + "*.mas";
     |_PDIR aDirDef;
     |PARA;  |SI FSalida ] 0; |HACIENDO;
          aDef = aDirDef - aBaseDef;
          aDef = aDef - ".mas";
          |HAZ GrabaDef;
          |_SDIR aDirDef;
     |SIGUE;

     |SI nBusca = 0;
         |BORRA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE dslisde1;
     #1#1;
     ;
     aDAplica;
     aHAplica;
     be;
     NULL, BuscaDef;
|FIN;

|PROCESO GrabaEl1;
     #1#0 = aAlfa;
     aTitulo   = "";
     aDSoporte = aBase + #1#0 + "/" + #1#0 + ".men";  |QBT aDSoporte;
     |XABRE "U", aDSoporte, nHandle;
     |SI FSalida ] 0;
         |XLEE nHandle, 250, aAlfa1;
         |SI FSalida ] 0;
             aTitulo = aAlfa1 % 350;
         |FINSI;
     |FINSI;
     |XCIERRA nHandle;

     |SI aTitulo ! "";
         #1#1 = aTitulo;
         |GRABA 020#1n;

         #5#0 = #1#0;
         #5#1 = #1#1;
         |GRABA 020#5n;
     |FINSI;
|FPRC;

|PROCESO RecogeDatos;
     |ABRE #1;
     |ABRE #2;
     |ABRE #3;
     |ABRE #4;
     |ABRE #5;

     |DBASS aBase;  |QBF aBase;
     aDirAplica = aBase + "*";
     |_PDIR aDirAplica;
     |PARA;  |SI FSalida ] 0; |HACIENDO;
             aAlfa = aDirAplica - ".";
             |SI aAlfa = aDirAplica;
                 aAlfa = aDirAplica - aBase;
                 |HAZ GrabaEl1;
             |FINSI;
             |_SDIR aDirAplica;
     |SIGUE;

     #5#0 = "  TODAS ";
     #5#1 = "Listar Todas";
     |GRABA 020#5n;
     |LIBERA #5;
     |CIERRA #5;

     |PUSHV 0501 2380;
     |CLS;
     aAplica = "";
     |ENTLINEAL #1#5, -1, 4, 22, 1, ClaveBaja5, ClaveAlta5;
     |PULSATECLA;
     |POPV;

     |SI aAplica = "";  |ACABA;  |FINSI;

     aDAplica = aAplica;
     aHAplica = aAplica;
     |SI aAplica = "  TODAS ";
         aDAplica = "        ";
         aHAplica = "zzzzzzzz";
     |FINSI;

     |BUCLE dslisde1;

     |CIERRA #1;
     |CIERRA #2;
     |CIERRA #3;
     |CIERRA #4;
|FPRC;

|PROGRAMA;
     |CLS;
     |CUADRO 0501 2380;
     |BLANCO 0602 2279;
     |PINTA 1320, "Introduzca Password : ";
     E_inf = "";
     E_sup = "20";
     aPassword = 1342 ? -1;
     |SI aPassword ! "<MYPASWD>     ";
         |MENAV "     Permiso denegado.";
         |ACABA;
     |FINSI;

     |CLS;
     |CUADRO 1110 1570;
     |ATRI S;
     |PINTA 1325, "PROCESANDO, ESPERESE POR FAVOR";
     |ATRI s;

     aFichero = ("d1" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #1 aFichero;
     |ABRE #1;  |CIERRA #1;  |DELINDEX #1;

     aFichero = ("d2" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #2 aFichero;
     |ABRE #2;  |CIERRA #2;  |DELINDEX #2;

     aFichero = ("d3" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #3 aFichero;
     |ABRE #3;  |CIERRA #3;  |DELINDEX #3;

     aFichero = ("d4" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #4 aFichero;
     |ABRE #4;  |CIERRA #4;  |DELINDEX #4;

     aFichero = ("d5" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #5 aFichero;
     |ABRE #5;  |CIERRA #5;  |DELINDEX #5;

     |HAZ RecogeDatos;

     |CLS;
     |ENTLINEAL #1#1, -1, 4, 22, 1, ClaveBaja1, ClaveAlta1;

     |DELINDEX #1;
     |DELINDEX #2;
     |DELINDEX #3;
     |DELINDEX #4;
     |DELINDEX #5;
|FPRO;
