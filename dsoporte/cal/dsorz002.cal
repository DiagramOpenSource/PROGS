|FICHEROS;
     dsorm001 #1;
     dsorm002 #2;
     dsorm004 #4,MANTE;

     dsorw007 #97,MANTE;
     dsorw008 #98,MANTE;

     referen@ #900;
|FIN;

|VARIABLES;
     aBase       = "";
     aMas        = "";
     aQueQuiero  = "";
     aAlfa       = "";
     aTitulo     = "";
     aFichero    = "";
     aParametro  = "";
     aAlfa0      = "";
     aAlfa1      = "";
     aAlfa4      = "";
     aAlfa5      = "";
     aAlfa6      = "";
     aAlfa7      = "";
     aAplicacion = "";
     aAbre       = "";
     aInd        = "";

     nTCampo     = 0;
     nModo       = 0;
     nForma      = 0;
     nHandle     = 0;
     nContador   = 0;
     nCodGrupo   = 0;

     &enGrupo    = 0;
     &eaTitulo   = "";
     &enArea     = 0;
     &enNivel    = 0;
|FIN;

|PROCESO Mensa07;  |TIPO 7;
     |MENSA "0000 Pulse <F2> Lineal Aplicaciones ";
|FPRC;

|PROCESO Mensa08;  |TIPO 7;
     |MENSA "0000 Pulse <F2> Lineal Tablas ";
|FPRC;

|PROCESO CargaLineal;
     #4#1  =  aAlfa1;

     #dsorm002#0 = #4#1;
     #dsorm002#1 = "";
     |LEE 000#dsorm002.];
     |SI FSalida = 0;  |Y  #dsorm002#0 = #4#1;
         |SI aMas = #dsorm002#3;  |ACABA;  |FINSI;
         |SI aMas = #dsorm002#4;  |ACABA;  |FINSI;
     |FINSI;

     #4#0  =  aAlfa0;
     #4#1  =  aAlfa1;
     #4#2  =  aMas;
     |LEE 101#4=;
     |SI FSalida ! 0;
         |DDEFECTO #4;
         #4#0  =  aAlfa0;
         #4#1  =  aAlfa1;
         #4#2  =  aMas;
         |GRABA 020#4b;
     |FINSI;

     |HAZ Tabla;

     #4#3  =  aTitulo;
     #4#4  =  aAlfa4;
     #4#5  =  aAlfa5;
     #4#6  =  aAlfa6;
     #4#7  =  aAlfa7;
     |GRABA 020#4a;
     |LIBERA #4;
|FPRC;

|PROCESO dsorm004;
     |BORRA 020#4a;
     |LIBERA #4;
|FPRC;

|DEFBUCLE dsorm004;
     #4#1;
     ;
     nCodGrupo, aAlfa1, "        ";
     nCodGrupo, aAlfa1, "zzzzzzzz";
     be;
     NULL, dsorm004;
|FIN;

|PROCESO Tipo2;  |TIPO 2;
     nModo = (FEntrada / 100) ! 0;

     |SI #4#8 = "S";
         |MENAV "     Registro Generado desde otro asistente, no puede darse de baja ni Modificarse";
         |ERROR;
     |FINSI;

     nForma = 0 +. 1;
     |SI nForma ! 1;  |ACABA;  |FINSI;

     aAlfa0 = #4#0;
     aAlfa1 = #4#1;
     aAlfa4 = #4#4;
     aAlfa5 = #4#5;
     aAlfa6 = #4#6;
     aAlfa7 = #4#7;

     nCodGrupo = aAlfa0;

     |SI #4#2 = "borra   ";
         |BUCLE dsorm004;

         |PONCONTROL 23, "SI";
         |PTEC 812;
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #4#2 ! "todas   ";  |ACABA;  |FINSI;

     |BORRA 020#4a;
     |LIBERA #4;

     |DBASS aBase;
     aAplicacion = aBase + #4#1;  |QBF aAplicacion;

     aAbre = aAplicacion + "/fich/" + #4#1 + ".dir";  |QBT aAbre;
     |XABRE "U", aAbre, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     nContador = 0;
     |ABRE #dsorm002;
     |PARA;  |SI;  |HACIENDO;
          |XLEE nHandle, 250, aAlfa;
          |SI FSalida < 0;  |SAL;  |FINSI;

          nContador = nContador + 1;

          |SI nContador = 1;  aMas = aAlfa;        |FINSI;

          |SI nContador = 4;
              aInd = aAlfa % 101;

              |SI aInd = "1";  |O aInd = 2;
                  |HAZ CargaLineal;
              |FINSI;
          |FINSI;

          |SI nContador = 5;  nContador = 0;  |FINSI;
     |SIGUE;
     |CIERRA #dsorm002;

     |PONCONTROL 23, "SI";
     |PTEC 812;
|FPRC;

|PROCESO Tabla;
     |SI #4#2 = "todas   ";  |ACABA;  |FINSI;
     |SI #4#2 = "borra   ";  |ACABA;  |FINSI;

     |DBASS aBase;    |QBF aBase;
     aMas = aBase + #4#1 + "/def/" + #4#2 + ".mas";  |QBT aMas;
     |CARGA_DEF aMas, referen@;
     |SI FSalida ! 0;
         |MENAV "     No existe la Tabla";
         |ERROR;
         |ACABA;
     |FINSI;

     aQueQuiero = "|TITULO";
     aTitulo    = #900#aQueQuiero#;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO Titulo;  |TIPO 7;
     #4#3 = aTitulo;  |PINTA #4#3;
|FPRC;

|RUTINA ClaveBaja4;
     #4#0 = #98#0;
     #4#1 = #98#1;
     #4#2 = "        ";
|FRUT;

|RUTINA ClaveAlta4;
     #4#0 = #98#0;
     #4#1 = #98#1;
     #4#2 = "zzzzzzzz";
|FRUT;

|| --------------------------------------------------------------------------
|| PROGRAMAS DE ACCESO A LOS FILTROS
|| --------------------------------------------------------------------------

|RUTINA ClaveBaja98;
     #98#0 = #97#0;
     #98#1 = "        ";
|FRUT;

|RUTINA ClaveAlta98;
     #98#0 = #97#0;
     #98#1 = "zzzzzzzz";
|FRUT;

|PROCESO Saca99;
|FPRC;

|PROCESO Entra99;  |TIPO 11;
     |SI FSalida ! 10;  |ACABA;  |FINSI;

     |PUSHV 0501 2380;
     |ENTLINEAL #1#4, -3, 2, 22, 1, ClaveBaja4, ClaveAlta4;
     |POPV;
|FPRC;

|PROCESO Saca98;  |TIPO 7;
     |ENTLINEAL #1#98, -2, 7, 22, 1, ClaveBaja98, ClaveAlta98;
|FPRC;

|PROCESO Entra98;  |TIPO 11;
     |SI FSalida ! 10;  |ACABA;  |FINSI;

     |ENTLINEAL #1#98, -2, 4, 22, 1, ClaveBaja98, ClaveAlta98;
|FPRC;

|PROCESO Graba97;
     #97#0 = #1#0;
     #97#1 = #1#1;
     |GRABA 020#97n;
     |LIBERA #97;
|FPRC;

|DEFBUCLE dsorm001;
     #1#1;
     ;
     0001;
     9999;
     ;
     NULL, Graba97;
|FIN;

|PROCESO Graba98;
     #98#0 = #97#0;
     #98#1 = #2#0;
     |LEE 101#98=;
     |SI FSalida ! 0;
         |DDEFECTO #98;
         #98#0 = #97#0;
         #98#1 = #2#0;
         #98#2 = #2#2;
         |GRABA 020#98n;
     |FINSI;
     |LIBERA #98;
|FPRC;

|DEFBUCLE dsorw007;
     #97#1;
     ;
     0001;
     9999;
     ;
     NULL, Graba98;
|FIN;

|PROCESO Mira97;
     |BUCLE dsorw007;
|FPRC;

|DEFBUCLE dsorm002;
     #2#1;
     ;
     "        ", "        ";
     "zzzzzzzz", "zzzzzzzz";
     ;
     NULL, Mira97;
|FIN;

|RUTINA ClaveBaja97;
     #97#0 = 1;
|FRUT;

|RUTINA ClaveAlta97;
     #97#0 = 9999;
|FRUT;

|PROGRAMA;
     aParametro = PARAMETRO;  |QBF aParametro;

     |CLS;
     |CABEZA "Asistente Tablas de Ficheros";

     aFichero = "dsorw007" + Usuario;
     |NOME_DAT #97 aFichero;
     |ABRE #97;  |CIERRA #97;  |DELINDEX #97;

     aFichero = "dsorw008" + Usuario;
     |NOME_DAT #98 aFichero;
     |ABRE #98;  |CIERRA #98;  |DELINDEX #98;

     |ABRE #97;
     |SI aParametro = "";
         |BUCLE dsorm001;
     |SINO;
         #97#0  = (enArea * 100) + enNivel;
         #97#1  = eaTitulo;
         |GRABA 020#97n;
         |LIBERA #97;
     |FINSI;
     |CIERRA #97;

     |ABRE #98;
     |BUCLE dsorm002;
     |CIERRA #98;

     |ENTLINEAL #1#97, -1, 4, 22, 1, ClaveBaja97, ClaveAlta97;

     |DELINDEX #97;
     |DELINDEX #98;
|FPRO;
