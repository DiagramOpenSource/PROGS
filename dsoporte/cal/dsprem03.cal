|FICHEROS;
     dsprew01 #1,MANTE;
     dsprem02 #2,MANTE;
     dsprem08 #8,MANTE;
     dsprem03 #3;
     dsprem04 #4,MANTE;
     dsprem07 #7;
     dsprem99 #99;
     dsparam0 #100;

     dsorm001 #201;

     referen@  #900;
     dspvm100@;
     dspvm101@;
     maesm011@;

|FIN;

|VARIABLES;
     aParametro = "";
     aFicheroPara = "";
     nHandlePa = 0;
     aBusco = "";
     aBaseEx = "";
     aPathFich = "";
     aLaHora = "";
     aMinutos = "";
     aSegundos = "";
     aNombreShell = "";
     aResultado = "";
     aUrl = "";
     aBaseS = "";
     aFecha = "";
     aAnyo = "";
     aMes = "";
     aDia = "";
     aShell = "";
     nHandleS = 0;

     aFicheroAdjunto = "";
     nMeteAdjuntoPrevinet = 0;

     nSwAnulaGecoOff = 0;
     aNombrePython = "";
     aScriptPython = "";
     nHandlePy = 0;
     aCliente = "";
     aEmail = "";
     aPathPythonGeco = "";
     aProg = "";
     aEmpresa = "";
     aUsuario = "";

     aBase        = "";
     aMas         = "";
     aAlfa        = "";
     aMenu        = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAlfa3       = "";
     aAlfa4       = "";
     aAlfa5       = "";
     aAlfa6       = "";
     aAlfa7       = "";
     aAlfa8       = "";
     aAlfa9       = "";
     nSwMeteDsc   = 0;
     aDescripcion = "";
     aLong        = "";
     aOperacion   = "";
     aDOperacion  = "";
     aHora        = "";
     aTecla       = "";
     aFic         = "";
     aServidor    = "";
     aAbre        = "";
     aLinea       = "";
     aBaseDigital = "";
     aDirectorio  = "";
     aBaseMensaje = "";
     aTo          = "";
     aIP          = "";
     aSalida      = "";
     aFrom        = "";
     aAsunto      = "";
     aMensaje     = "";
     aAdjunto     = "";
     aReferencia  = "";
     aPassw       = "";
     aEjecuta     = "";
     aAbreTXT     = "";
     aAbreTXTD    = "";
     aAbreTXTO    = "";
     aAbreHTMO    = "";
     aAbreHTMD    = "";
     aAbreFIN     = "";
     aConten      = "";
     aCarac10     = "";
     aCarac       = "";
     aDirec       = "";
     aFrase       = "";
     aLogo        = "";
     aEmpre       = "";
     aFich        = "";
     aProducto    = "";

     nPosi     = 0;
     nCampo    = 0;
     nHandle   = 0;
     nHandle1  = 0;
     nHandle2  = 0;
     nForma    = 0;
     nModo     = 0;
     nCaracter = 0;
     nPos      = 0;
     nCamuf    = 0;
     nNum      = 0;
     nLong     = 0;
     nReg      = 0;
     nDSPreven = 0;
     nRegilla  = 0;
     nEnvio    = 0;
     nCorreo   = 0;
     nBotonDsArchi = 0;

     aDirSer     = "";
     aDirPues    = "";
     aCarpeta    = "";

     nOTP        = 0;
     nSinac      = 0;
     nPrevenzis  = 0;
     nPrevinet   = 0;
     nHandleINI  = 0;

     aBaseINI    = "";
     aFicheroINI = "";
     aCR         = "";
     aLF         = "";
     aCadena     = "";
     aRojo       = "255,80,80;255,255,255";

     fFecha         = @;

    {1}aLocal       = "";

     &eaPass        = "";
     &eaPassEnc     = "";
     &enChequeoUsu  = 0;
     &eaIPDSCorreo  = "";
     &enErrorCorreo = 0;
     &eaSPA         = "";
     &eaProd        = "";
     &eaFrom        = "";
     &enEsDSARCHI   = 0;
     &eaMailVDESK   = "";
     &eaTipoVDESK   = "";
     &eaDEmpVDESK   = "";
     &eaDCenVDESK   = "";
|FIN;

|PROCESO dsprem07;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = #2#2;
     #3#3 = #7#0;
     #3#4 = #7#1;
     |LEE 101#3=;
     |SI FSalida ! 0;
         |DDEFECTO #3;
         #3#0 = #2#0;
         #3#1 = #2#1;
         #3#2 = #2#2;
         #3#3 = #7#0;
         #3#4 = #7#1;
         |GRABA 020#3b;
     |FINSI;

     |SI #3#11 = 0;
         |DBASE aBase;  |QBF aBase;
         aMas = aBase + "def/dsprem03.mas";
         |CARGA_DEF aMas, referen@;
         |SI FSalida = 0;
             |ABRE #900;
             |SELECT #2#900;
             |LEE 040#900u;
             |SI FSalida ! 0;  |DDEFECTO #900;  |FINSI;
             |CIERRA #900;

             #3#11 = #900#11 + 1;
             |SI #3#11 = 8888;  #3#11 = #3#11 + 1;  |FINSI;

             |DESCARGA_DEF #referen@;
         |FINSI;
     |FINSI;

     #3#5  = #1#1;
     #3#6  = #8#2;
     #3#7  = #2#3;
     #3#8  = #7#2;
     #3#9  = #7#3;
     aAlfa = #3#8; |QBF aAlfa;
     aAlfa = aAlfa + "-" + #3#9;
     #3#10 = #2#0 + (("00" + #2#1) % -102) + (("000" + #2#2) % -102) + " " + aAlfa;
     |GRABA 020#3a;
     |LIBERA #3;

     #201#0 = #3#11;
     |LEE 101#201=;
     |SI FSalida ! 0;
         |DDEFECTO #201;
         #201#0 = #3#11;
         |GRABA 020#201b;
     |FINSI;
     #201#1 = #3#10;
     |GRABA 020#201a;
     |LIBERA #201;
|FPRC;

|DEFBUCLE dsprem07;
     #7#1;
     ;
     00, 00;
     99, 99;
     ;
     NULL, dsprem07;
|FIN;

|PROCESO dsprem02;
     #1#0 = #2#0;
     |LEE 000#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;

     #8#0 = #2#0;
     #8#1 = #2#1;
     |LEE 000#8=;
     |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;

     |BUCLE dsprem07;
|FPRC;

|DEFBUCLE dsprem02;
     #2#1;
     ;
     0, 00, 00;
     9, 99, 99;
     ;
     NULL, dsprem02;
|FIN;

|PROCESO CargaPerfiles;
     |ABRE #1;
     |ABRE #8;
     |ABRE #3;
     |ABRE #201;
     |BUCLE dsprem02;
     |CIERRA #1;
     |CIERRA #8;
     |CIERRA #3;
     |CIERRA #201;
|FPRC;

|RUTINA Baja01;
     #1#0 = 1;
|FRUT;

|RUTINA Alta01;
     #1#0 = 9;
|FRUT;

|RUTINA Baja08;
     #8#0 = #1#0;
     #8#1 = 1;
|FRUT;

|RUTINA Alta08;
     #8#0 = #1#0;
     #8#1 = 98;
|FRUT;

|RUTINA Baja02;
     #2#0 = #8#0;
     #2#1 = #8#1;
     #2#2 = 1;
|FRUT;

|RUTINA Alta02;
     #2#0 = #8#0;
     #2#1 = #8#1;
     #2#2 = 98;
|FRUT;

|RUTINA Baja03;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = #2#2;
     #3#3 = 01;
     #3#4 = 01;
|FRUT;

|RUTINA Alta03;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = #2#2;
     #3#3 = 99;
     #3#4 = 99;
|FRUT;

|RUTINA Baja04;
     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = #3#2;
     #4#3 = #3#3;
     #4#4 = #3#4;
     #4#5 = "";
|FRUT;

|RUTINA Alta04;
     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = #3#2;
     #4#3 = #3#3;
     #4#4 = #3#4;
     #4#5 = "zzzzzzzzzz";
|FRUT;

|| --------------------------------------------------------------------------
|| Procesos del dsprem04
|| --------------------------------------------------------------------------

|PROCESO CargaMAC;
     |DBASS aBaseDigital;  |QBF aBaseDigital;

     aServidor = aBaseDigital % -303;
     |QBF aServidor;

     aDirectorio = aBaseDigital % -201;
     |QBF aDirectorio;

     nNum = aServidor;
     |SI nNum        = 0;   aServidor   = "001";  |FINSI;
     |SI aServidor   = "";  aServidor   = "001";  |FINSI;
     |SI aDirectorio = "";  aDirectorio = "1";    |FINSI;

     eaPass = aDirectorio + (("00" + #4#1) % -102) + (("00" + #4#2) % -102) + aServidor + #4#5;
     |HAZ EncriptaMAC;

     #4#11 = eaPassEnc;
|FPRC;

|PROCESO MiraSiEsOTP;
     nOTP = 0;

     |DBASS aBaseINI;   |QBF aBaseINI;
     aFicheroINI = aBaseINI + "dspreven/dspreven.ini";
     |XABRE "AB", aFicheroINI, nHandleINI;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aCR        = &10;
     aLF        = &13;
     aCadena    = "";

     |XLEE nHandleINI, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            |SI aAlfa = aCR;
                |SI aCadena = "GrupoOTP";
                    nOTP = 1;
                    |SAL;
                |FINSI;

                aCadena = "";
            |SINO;
                |SI aAlfa ! aLF;
                    aCadena = aCadena + aAlfa;
                |FINSI;
            |FINSI;
            |XLEE nHandleINI, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandleINI;
|FPRC;

|PROCESO MiraSiEsSinac;
     nSinac = 0;

     |DBASS aBaseINI;   |QBF aBaseINI;
     aFicheroINI = aBaseINI + "dspreven/dspreven.ini";
     |XABRE "AB", aFicheroINI, nHandleINI;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aCR        = &10;
     aLF        = &13;
     aCadena    = "";

     |XLEE nHandleINI, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            |SI aAlfa = aCR;
                |SI aCadena = "Sinac";
                    nSinac = 1;
                    |SAL;
                |FINSI;

                aCadena = "";
            |SINO;
                |SI aAlfa ! aLF;
                    aCadena = aCadena + aAlfa;
                |FINSI;
            |FINSI;
            |XLEE nHandleINI, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandleINI;
|FPRC;

|PROCESO MiraSiEsPrevenzis;
     nPrevenzis = 0;

     |DBASS aBaseINI;   |QBF aBaseINI;
     aFicheroINI = aBaseINI + "dspreven/dspreven.ini";
     |XABRE "AB", aFicheroINI, nHandleINI;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aCR        = &10;
     aLF        = &13;
     aCadena    = "";

     |XLEE nHandleINI, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            |SI aAlfa = aCR;
                |SI aCadena = "Prevenzis";
                    nPrevenzis = 1;
                    |SAL;
                |FINSI;

                aCadena = "";
            |SINO;
                |SI aAlfa ! aLF;
                    aCadena = aCadena + aAlfa;
                |FINSI;
            |FINSI;
            |XLEE nHandleINI, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandleINI;
|FPRC;

|PROCESO PintaMAC;
     |PUSHV 0501 2380;
     |BLANCO 1125 1562;
     |CUADRO 1125 1562;

     |ATRI S;
     |PINTA 1226, "        CLAVE DE ACTIVACION         ";
     |ATRI s;
     |PINTA 1326, "____________________________________";

     |ATRI I;
     |PINTA 1426, #4#11;
     |ATRI i;

     |LEETECLA aTecla;
     |POPV;

     aTo = #4#15;  |QBF aTo;
     |SI aTo = "";  |ACABA;  |FINSI;

 ||--------------------/ Mandar el mail
     |CONFI "0000N Enviar correo electronico?";
     |SI FSalida = 0;
         |SI nDSPreven = 1;
             |HAZ MiraSiEsOTP;
             |SI nOTP = 1;
                 |HAZ CorreoOTP;
             |SINO;
                 |HAZ MiraSiEsSinac;
                 |SI nSinac = 1;
                     |HAZ CorreoSinac;
                 |SINO;
                      |HAZ MiraSiEsPrevenzis;
                      |SI nPrevenzis = 1;
                          |HAZ CorreoPrevenzis;
                      |SINO;
                           eaSPA = "DS, S.L.";
                           |HAZ Correo;
                      |FINSI;
                 |FINSI;
             |FINSI;
         |SINO;
             eaSPA = "DS, S.L.";
             |HAZ Correo;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo7C5F4;  |TIPO 7;
     |ESTADO_CONTROL nBotonDsArchi, "DISABLE";

     aAlfa = #4#5;  |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     |ESTADO_CONTROL nBotonDsArchi, "ENABLE";
|FPRC;

|PROCESO Tipo11C5F4;  |TIPO 11;
     |SI FSalida = 10;
         aAlfa = "0000 La clave es " + #4#7;
         |MENAV aAlfa;
         |ERROR;
         |ACABA;
     |FINSI;

     |SI FSalida = 11;
         |LEE 101#3=;
         |SI FSalida = 0;
             |HAZ CargaMAC;
             |GRABA 020#3a;
             |LIBERA #3;

             |HAZ PintaMAC;
             |ERROR;
         |FINSI;
     |FINSI;

     |SI FSalida = 12;
         |LEE 101#dsprem04.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |SI #dsprem04#19 = "S";
             |CONFI "0000NEsta seguro que quiere desactivar el usuario";
         |FINSI;

         |SI #dsprem04#19 = "N";
             |CONFI "0000NEsta seguro que quiere activar el usuario";
         |FINSI;

         |SI FSalida ! 0;
             |LIBERA #dsprem04;
             |ERROR;
             |ACABA;
         |FINSI;

         |SI #dsprem04#19 = "S";
             #dsprem04#19 = "N";
             #dsprem04#23 = aRojo;
         |SINO;
             #dsprem04#19 = "S";
             #dsprem04#23 = "";
         |FINSI;

         |HORA aHora;
         #dsprem04#20 = ~;
         #dsprem04#21 = aHora;
         #dsprem04#22 = Usuario % 810;

         |GRABA 020#dsprem04.a;
         |LIBERA #dsprem04;

         |PINTA #dsprem04#19;

         |ERROR;
         |ACABA;
     |FINSI;

     |SI FSalida = 15;
         |PUSHV 1229 1457;
        |BLANCO 1229 1457;
        |CUADRO 1230 1456;
        |PINTA 1331, "Recos.Candidatos (S/N)   ";
        |C_P #dsprem04#17, 1, 1354;
        |C_M #dsprem04#17, 1, "S"; |C_V #dsprem04#17, 1, "S";
        |ENCAMPO #17#dsprem04;
        |GRABA 020#4a;
        |C_M #dsprem04#17, 1, "N"; |C_V #dsprem04#17, 1, "N";
        |POPV;
        |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo0C5F4;  |TIPO 0;
     |SI #4#5 = "          ";
         |MENAV "0000 Usuario sin Contenido.";
         |ERROR;
         |ACABA;
     |FINSI;

     |ESTADO_CONTROL nBotonDsArchi, "DISABLE";

     aAlfa = #4#5 - "¥";
     |SI FSalida ! 0;
         aAlfa = "0000 Por favor no introduzca " + &0209;
         |MENAV aAlfa;
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa = #4#5 - "¤";
     |SI FSalida ! 0;
         aAlfa = "0000 Por favor no introduzca " + &0241;
         |MENAV aAlfa;
         |ERROR;
         |ACABA;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsprem04.mas";
     |CARGA_DEF aMas, referen@;
     |SI FSalida = 0;
         |ABRE #900;
         |SELECT #2#900;
         #900#5 = #4#5;
         |LEE 040#900=;
         |SI FSalida = 0;
             |SI #900#0 ! #4#0;  |O #900#1 ! #4#1;  |O #900#2 ! #4#2;
              |O #900#3 ! #4#3;  |O #900#4 ! #4#4;
                 |MENAV "0000 El Usuario ya esta definido en otro Perfil";
                 |ERROR;
             |FINSI;
         |FINSI;
         |CIERRA #900;

         |DESCARGA_DEF #referen@;
      |FINSI;

      |SI nDSPreven = 0;  |O nDSPreven = 2;
         |DBASS aBase;  |QBF aBase;
         aMas = aBase + "gecochek/def/gecom001.mas";
         aFic = aBase + "gecochek/fich/";
         |CARGA_DEF aMas, referen@;
         |SI FSalida = 0;
             |PATH_DAT #900 aFic;
             |ABRE #900;
             |SELECT #3#900;
             #900#4 = #4#5;
             |LEE 040#900=;
             |SI FSalida = 0;
                 |MENAV "0000 El Usuario ya esta definido en los Auditores";
                 |ERROR;
             |FINSI;
             |CIERRA #900;

             |DESCARGA_DEF #referen@;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo7C6F4;  |TIPO 7;
|ET Arriba;
     aPassw   = #4#7;
     E_inf    = "";
     E_sup    = "10";
     aPassw   = 1956 ? -1;

     |PINTA 1956, "**********";

     |SI #4#7 ! aPassw;  |Y #4#7 ! "          ";
         |CONFI "0000NHas cambiado la Clave de Acceso que teniamos antes, Desea Continuar";
         |SI FSalida ! 0;
             |VETE Arriba;
         |FINSI;

         #4#18 = "N";
     |FINSI;

     #4#7 = aPassw;

     aAlfa = #4#7 - "¥";
     |SI FSalida ! 0;
         aAlfa = "0000 Por favor no introduzca " + &0209;
         |MENAV aAlfa;
         |VETE Arriba;
     |FINSI;

     aAlfa = #4#7 - "¤";
     |SI FSalida ! 0;
         aAlfa = "0000 Por favor no introduzca " + &0241;
         |MENAV aAlfa;
         |VETE Arriba;
     |FINSI;
|FPRC;

|PROCESO Tipo0C7F4;  |TIPO 0;
     aAlfa = #4#7 - "¥";
     |SI FSalida ! 0;
         aAlfa = "0000 Por favor no introduzca " + &0209;
         |MENAV aAlfa;
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa = #4#7 - "¤";
     |SI FSalida ! 0;
         aAlfa = "0000 Por favor no introduzca " + &0241;
         |MENAV aAlfa;
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Tipo2F4;  |TIPO 2;
     nModo  = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;

     |SI nModo ! 3;  |Y nForma = 1;
         |SI #4#10 = "S";  |Y #4#16 = "S";
             |MENAV "0000ATENCION, al marcar como SOLO CONSULTA se generara PRM para este SUPERUSUARIO.";
         |FINSI;
     |FINSI;

     |SI nModo = 3;
         aOperacion  = "B";
         aDOperacion = "BAJA DEL USUARIO";
     |FINSI;

     |SI nModo = 1;
         aOperacion  = "A";
         aDOperacion = "ALTA DEL USUARIO";
     |FINSI;

     |SI nModo = 2;
         |SI nForma ! 1;
             aOperacion  = "M";
             aDOperacion = "ENTRADA MODIFICACION DEL USUARIO";
         |FINSI;

         |SI nForma = 1;
             aOperacion  = "M";
             aDOperacion = "SALIDA MODIFICACION DEL USUARIO";
         |FINSI;
     |FINSI;

     |SI nForma = 1;
         |HAZ CargaMAC;
         |SI nModo = 1;  |HAZ PintaMAC;  |FINSI;
     |FINSI;

     |HORA aHora;

     |ABRE #99;
     nReg = 1;
     |LEE 000#99u;
     |SI FSalida = 0;
         nReg = #99#0 + 1;
     |FINSI;

     #99#0  = nReg;
     |GRABA 020#99b;

     #99#1  = #4#5;
     #99#2  = ~;
     #99#3  = aHora;
     #99#4  = aOperacion;
     #99#5  = aDOperacion;
     #99#6  = #4#0 + (("00" + #4#1) % -102) + (("00" + #4#2) % -102);
     #99#7  = #4#3;
     #99#8  = #4#4;
     #99#9  = #3#5;
     #99#10 = #3#6;
     #99#11 = #3#7;
     #99#12 = #3#8;
     #99#13 = #3#9;
     #99#14 = #3#10;
     #99#15 = #4#9;
     #99#16 = #4#10;
     #99#17 = #4#11;
     #99#18 = #3#11;
     #99#19 = #4#8;
     #99#20 = Usuario % 810;
     |GRABA 020#99a;
     |LIBERA #99;
     |CIERRA #99;
|FPRC;

|| --------------------------------------------------------------------------
|| Procesos del dsprem03
|| --------------------------------------------------------------------------

|PROCESO Tipo0C3F3;  |TIPO 0;
     |ENTLINEAL #1#4, -6, 2, 22, 0, Baja04, Alta04;
|FPRC;

|PROCESO Tipo7C3F3;  |TIPO 7;
     |ESTADO_CONTROL nBotonDsArchi, "DISABLE";

     |ENTLINEAL #1#4, -6, 7, 22, 0, Baja04, Alta04;
|FPRC;

|| --------------------------------------------------------------------------
|| Procesos del dsprem02
|| --------------------------------------------------------------------------

|PROCESO Tipo2F2;  |TIPO 2;
|FPRC;

|PROCESO Tipo0C2F2;  |TIPO 0;
     |ENTLINEAL #1#3, -4, 4, 22, 0, Baja03, Alta03;
|FPRC;

|PROCESO Tipo7C2F2;  |TIPO 7;
     |ENTLINEAL #1#3, -4, 7, 22, 0, Baja03, Alta03;

     |ABRE #3;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = #2#2;
     #3#3 = 1;
     #3#4 = 1;
     |LEE 040#3];
     |SI FSalida ! 0;  |O  #3#0 ! #2#0; |O  #3#1 ! #2#1;  |O #3#2 ! #2#2;
         |DDEFECTO #3;
     |FINSI;
     |CIERRA #3;

     |ENTLINEAL #1#4, -6, 7, 22, 0, Baja04, Alta04;
|FPRC;

|PROCESO Tipo0C5F2;  |TIPO 0;
|FPRC;

|PROCESO Tipo0C6F2;  |TIPO 0;
|FPRC;

|PROCESO Tipo0C7F2;  |TIPO 0;
|FPRC;

|PROCESO Tipo0C8F2;  |TIPO 0;
|FPRC;

|| --------------------------------------------------------------------------
|| Procesos del dsprem08
|| --------------------------------------------------------------------------

|PROCESO Tipo2F8;  |TIPO 2;
|FPRC;

|PROCESO Tipo0C1F8;  |TIPO 0;
     |ENTLINEAL #1#2, -3, 4, 12, 0, Baja02, Alta02;
|FPRC;

|PROCESO Tipo7C1F8;  |TIPO 7;
     |ENTLINEAL #1#2, -3, 7, 12, 0, Baja02, Alta02;

     |ABRE #2;
     #2#0 = #8#0;
     #2#1 = #8#1;
     #2#2 = 1;
     |LEE 040#2];
     |SI FSalida ! 0;  |O  #2#0 ! #8#0;  |O #2#1 ! #8#1;
         |DDEFECTO #2;
     |FINSI;
     |CIERRA #2;

     |ENTLINEAL #1#3, -4, 7, 22, 0, Baja03, Alta03;

     |ABRE #3;
     #3#0 = #8#0;
     #3#1 = #8#1;
     #3#2 = #8#2;
     #3#3 = 1;
     #3#4 = 1;
     |LEE 040#3];
     |SI FSalida ! 0;  |O  #3#0 ! #8#0;  |O #3#1 ! #8#1;  |O #3#2 ! #8#2;
         |DDEFECTO #3;
     |FINSI;
     |CIERRA #3;

     |ENTLINEAL #1#4, -6, 7, 22, 0, Baja04, Alta04;
|FPRC;

|| --------------------------------------------------------------------------
|| Procesos del dsprem01
|| --------------------------------------------------------------------------

|PROCESO Tipo2F1;  |TIPO 2;
|FPRC;

|PROCESO Tipo0C0F1;  |TIPO 0;
     |ENTLINEAL #1#8, -2, 4, 12, 0, Baja08, Alta08;
|FPRC;

|PROCESO Tipo7C0F1;  |TIPO 7;
     |ENTLINEAL #1#8, -2, 7, 12, 0, Baja08, Alta08;

     |ABRE #8;
     #8#0 = #1#0;
     #8#1 = 1;
     |LEE 040#8];
     |SI FSalida ! 0;  |O  #8#0 ! #1#0;
         |DDEFECTO #8;
     |FINSI;
     |CIERRA #8;

     |ENTLINEAL #1#2, -3, 7, 12, 0, Baja02, Alta02;

     |ABRE #2;
     #2#0 = #1#0;
     #2#1 = 1;
     #2#2 = 1;
     |LEE 040#2];
     |SI FSalida ! 0;  |O  #2#0 ! #1#0;
         |DDEFECTO #2;
     |FINSI;
     |CIERRA #2;

     |ENTLINEAL #1#3, -4, 7, 22, 0, Baja03, Alta03;

     |ABRE #3;
     #3#0 = #1#0;
     #3#1 = 1;
     #3#2 = 1;
     #3#3 = 1;
     #3#4 = 1;
     |LEE 040#3];
     |SI FSalida ! 0;  |O  #3#0 ! #1#0;
         |DDEFECTO #3;
     |FINSI;
     |CIERRA #3;

     |ENTLINEAL #1#4, -6, 7, 22, 0, Baja04, Alta04;
|FPRC;

|PROCESO PonDirecciones;
     aLong  = aTo % 0;
     nLong  = aLong;
     aFrase = "";
     aDirec = "";
     |PARA nPosi = 1;  |SI nPosi [ nLong;  |HACIENDO nPosi = nPosi + 1;
           nPos   = (nPosi * 100) + 1;
           aCarac = aTo % nPos;

           |SI aCarac = ";";  |O aCarac = ",";
               aFrase = aFrase + "--to=" + &34 + aDirec + &34 + " ";
               aDirec = "";
           |SINO;
               aDirec = aDirec + aCarac;
           |FINSI;
     |SIGUE;

     |SI aDirec ! "";
         aFrase = aFrase + "--to=" + &34 + aDirec + &34;
     |FINSI;

     aConten = aFrase + " \" + &10;
|FPRC;

|PROCESO EsPrevinet;
     nPrevinet = 0;

     |SI nOTP = 0; |Y nSinac = 0; |Y nPrevenzis = 0;
         |ACABA;
     |FINSI;

     |DBASS aBase;  |QBF aBase;

     aEmpre = "";
     aMas   = aBase + "dspreven/def/visal000.mas";
     |CARGA_DEF aMas, referen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aFich = aBase + "dspreven/fich/";
     |PATH_DAT #referen@#aFich#;
     |ABRE #referen@;
     |LEE 000#referen@.p;
     |PARA; |SI;  |HACIENDO;
         |SI FSalida ! 0;  |SAL;  |FINSI;

         |SI #referen@#3 = "S";
             aEmpre = ("00000" + #referen@#0) % -105;
             |SAL;
         |FINSI;

         |LEE 000#referen@.s;
     |SIGUE;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;

     aMas = aBase + "dspreven/def/pvntm001.mas";
     |CARGA_DEF aMas, referen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa = #dsprem04#5 % 106;
     aFich = aBase + "dspreven/fich/" + aEmpre + "/";
     |PATH_DAT #referen@#aFich#;

     |ABRE #referen@;
     #referen@#0 = aAlfa;
     |LEE 000#referen@.=;
     |SI FSalida = 0;
         nPrevinet = 1;
     |FINSI;
     |CIERRA #referen@;
|FPRC;

|PROCESO GrabaHistEnvios;
     |DBASS aBase;  |QBF aBase;

     aMas = aBase + "dspreven/def/maesm011.mas";  |CARGA_DEF aMas, maesm011@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aMas = aBase + "dspreven/def/dspvm100.mas";  |CARGA_DEF aMas, dspvm100@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #maesm011@;
         |ACABA;
     |FINSI;

     aMas = aBase + "dspreven/def/dspvm101.mas";  |CARGA_DEF aMas, dspvm101@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #dspvm100@;
         |DESCARGA_DEF #maesm011@;
         |ACABA;
     |FINSI;

     |ABRE #maesm011@;
     aAlfa = Usuario % 810;
     #maesm011@#0 = aAlfa;
     |LEE 000#maesm011@.=;
     |SI FSalida ! 0;  |DDEFECTO #maesm011@;  |FINSI;
     |CIERRA #maesm011@;

     |ABRE #dspvm100@;
     |SELECT #2#dspvm100@;
     |LEE 000#dspvm100@.p;
     |SI FSalida ! 0;  |DDEFECTO #dspvm100@;  |FINSI;

     nEnvio = #dspvm100@#0 + 1;

     |SELECT #1#dspvm100@;
     |DDEFECTO #dspvm100@;
     #dspvm100@#0 = nEnvio;
     |GRABA 020#dspvm100@.b;

     |HORA aHora;

     #dspvm100@#1  = ~;
     #dspvm100@#2  = aHora;
     aAlfa         = Usuario % 810;
     #dspvm100@#3  = aAlfa;
     #dspvm100@#4  = #maesm011@#1;
     #dspvm100@#5  = "Acceso para el uso de las aplicaciones GECONET";
     #dspvm100@#6  = "";

     aAlfa         = "USUARIO: " + #4#5;
     #dspvm100@#7  = aAlfa;

     aAlfa         = "NOMBRE DEL USUARIO: " + #4#6;
     #dspvm100@#8  = aAlfa;

     |GRABA 020#dspvm100@.a;
     |LIBERA #dspvm100@;
     |CIERRA #dspvm100@;

     |ABRE #dspvm101@;
     #dspvm101@#0 = nEnvio;
     #dspvm101@#1 = 9999;
     |LEE 000#dspvm101@.];
     |SI FSalida = 0;
         |LEE 000#dspvm101@.a;
     |SINO;
         |LEE 000#dspvm101@.u;
     |FINSI;

     nCorreo = 1;
     |SI FSalida = 0;  |Y  #dspvm101@#0 = nEnvio;
         nCorreo = #dspvm101@#1 + 1;
     |FINSI;

     |HORA aHora;

     |DDEFECTO #dspvm101@;
     #dspvm101@#0 = nEnvio;
     #dspvm101@#1 = nCorreo;
     #dspvm101@#2  = ~;
     #dspvm101@#3  = aHora;
     #dspvm101@#4  = "";
     #dspvm101@#5  = aTo;

     |GRABA 020#dspvm101@.n;
     |LIBERA #dspvm101@;
     |CIERRA #dspvm101@;

     |DESCARGA_DEF #dspvm101@;
     |DESCARGA_DEF #dspvm100@;
     |DESCARGA_DEF #maesm011@;
|FPRC;

|PROCESO CorreoOTP;
     |DEBUG;

     aTo = #4#15;  |QBF aTo;
     |SI aTo = "";  |ACABA;  |FINSI;

     |DBASS aBaseMensaje;  |QBF aBase;
     aBaseMensaje = aBaseMensaje + "dspreven/documentos/dscorreo/";

     |SI eaFrom = "";
         eaFrom    = "soporte@diagram.es";
     |FINSI;

     aProducto = "GECONET";
     |SI eaProd ! "";
         aProducto = eaProd;
     |FINSI;

     |HAZ EsPrevinet;

     aFrom    = eaFrom;
     aAsunto  = "Acceso para el uso de las aplicaciones " + aProducto;
     |SI nPrevinet = 1;
         ||aAsunto  = aAsunto + " para " + aAlfa7;
         |||QBF aAsunto;
         aAsunto  = "Bienvenido al Portal Web Previnet";
     |FINSI;

     aAbreTXT  = aAbre;

     |SI nPrevinet = 1;
          aAbreHTMO = aBaseMensaje + "previnet.htm";
     |SINO;
          aAbreHTMO = aBaseMensaje + "dsoporte.htm";
     |FINSI;
     aAbreHTMD = aBaseMensaje + #4#5 + ".htm";  |QBT aAbreHTMD;
     |FBORRA aAbreHTMD;

     |XABRE "WB", aAbreHTMD, nHandle1;
     |XABRE "AB", aAbreHTMO, nHandle2;

     nSwAnulaGecoOff      = 0;
     nMeteAdjuntoPrevinet = 0;

     nRegilla = 0;
     |XLEE nHandle2, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            |SI nRegilla = 0;  |Y aAlfa ! "{";
                |XGRABA nHandle1, aAlfa;
            |FINSI;

            |SI aAlfa = "}";
                nSwMeteDsc = 0;

                aConten  = aConten + aAlfa;

                |SI aConten = "{NOMBRESPA}";
                    aAlfa = eaSPA;
                |FINSI;

                |SI aConten = "{USUARIO}";
                    aAlfa = #4#5;
                |FINSI;

                |SI aConten = "{NOMUSUARIO}";
                    aAlfa = #4#6;
                |FINSI;

                |SI aConten = "{GRUPO}";
                    aAlfa = aBaseMensaje - "ase1016";
                    |SI FSalida ! 0;
                        aAlfa = "EUROPREVEN";
                    |SINO;
                        aAlfa = aBaseMensaje - "ase1011";
                        |SI FSalida ! 0;
                            aAlfa = "FAECA";
                        |SINO;
                            aAlfa = "OTP";
                        |FINSI;
                    |FINSI;
                |FINSI;

                |SI aConten = "{PASSWORD}";
                    aAlfa = #4#7;
                |FINSI;

                |SI aConten = "{ACCESO}";
                    aAlfa = "http://www.geconet.net/portal/";

                    |SI nPrevinet = 1;
                         nMeteAdjuntoPrevinet = 1;
                         nSwAnulaGecoOff = 1;
                         aAlfa = aAlfa + "registroPrevinet.php?claveGeconet="
                    |SINO;
                         aAlfa = aAlfa + "crearAcceso.php?claveGeconet="
                    |FINSI;

                    aAlfa = aAlfa + #4#11;  |QBF aAlfa;

                    eaPass = #4#15;  |HAZ EncriptaMAC;
                    aAlfa  = aAlfa + "&email=" + eaPassEnc;  |QBF aAlfa;
                    eaPass    = "";
                    eaPassEnc = "";

                    |SI nPrevinet = 1;
                         nSwMeteDsc = 1;
                         eaPass = aAlfa7;  |HAZ EncriptaMAC;
                         aDescripcion = "&dsc=" + eaPassEnc;  |QBF aDescripcion;
                         eaPass    = "";
                         eaPassEnc = "";
                    |FINSI;
                |FINSI;

                |SI aConten = "{PRODUCTO}";
                    aAlfa = aProducto;
                |FINSI;

                |SI aConten = "{NOMEMP}";
                    aAlfa = aAlfa7;  |QBF aAlfa;
                |FINSI;

                |SI aConten = "{WEBPREVINET}";
                    |HAZ EsPrevinet;

                    aAlfa = "";
                    |SI nPrevinet = 1;
                        aAlfa = "<br>" + &13 + &10;
                        aAlfa = aAlfa + "Acceso Previnet Web: <a href=" + &34 + "http://clientes.grupotp-previnet.es/" + &34 + ">http://clientes.grupotp-previnet.es/</a>";
                        aAlfa = aAlfa + "<br>" + &13 + &10;
                        aAlfa = aAlfa + "<br>" + &13 + &10;
                        aAlfa = aAlfa + "<br>" + &13 + &10;
                    |FINSI;
                |FINSI;

                |XGRABA nHandle1, aAlfa;

                |SI nSwMeteDsc = 1;
                     |XGRABA nHandle1, aDescripcion;
                     nSwMeteDsc = 0;
                |FINSI;

                nRegilla = 0;
                aConten  = "";
            |SINO;
                |SI aAlfa = "{";  |O nRegilla = 1;
                    aConten  = aConten + aAlfa;
                    nRegilla = 1;
                |FINSI;
            |FINSI;

            |XLEE nHandle2, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandle1;
     |XCIERRA nHandle2;

     |SI nSwAnulaGecoOff = 1;
          |HAZ AnulaGeconetOff;
     |FINSI;

     aAbreTXTO = aBaseMensaje + "dscorreo.sh";
     aAbreTXTD = aBaseMensaje + #4#5 + ".sh";  |QBT aAbreTXTD;
     aAbreFIN  = aBaseMensaje + #4#5 + ".txt"; |QBT aAbreFIN;
     |FBORRA aAbreTXTD;
     |FBORRA aAbreFIN;

     aFicheroAdjunto = aBaseMensaje + "GuiaPrimerAccesoPrevinet.pdf";

     |XABRE "WB", aAbreTXTD, nHandle1;
     |XABRE "AB", aAbreTXTO, nHandle2;

     aCarac10 = &10;

     |XLEE nHandle2, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            aConten = aConten + aAlfa;

            |SI aAlfa = aCarac10;
                aAlfa1 = aConten - "DE=$1";
                |SI FSalida ! 0;
                    aConten = "DE=" + &34 + aFrom + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "$PARA";
                |SI FSalida ! 0;
                    |HAZ PonDirecciones;
                |FINSI;

                aAlfa1 = aConten - "ASUNTO=$3";
                |SI FSalida ! 0;
                    aConten = "ASUNTO=" + &34 + aAsunto + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "FICHTM=$4";
                |SI FSalida ! 0;
                    aConten = "FICHTM=" + &34 + aAbreHTMD + &34 + &10;
                |FINSI;

                |SI nPrevinet = 1;
                    || No hacemos nada, Ahora el logo va en el propio correo
                |SINO;
                     aAlfa1 = aConten - "FICAT1=$5";
                     |SI FSalida ! 0;
                         aConten = "FICAT1=" + &34 + aBaseMensaje + "logo_correo.bmp" + &34 + &10;
                     |FINSI;
                |FINSI;
                aAlfa1 = aConten - "FICFIN=$6";
                |SI FSalida ! 0;
                    aConten = "FICFIN=" + &34 + aAbreFIN + &34 + &10;  |QBT aConten;
                |FINSI;

                aAlfa1 = aConten - "$ADJUNTO";
                |SI FSalida ! 0;
                    aConten = "";
                    |SI nMeteAdjuntoPrevinet = 1;
                        aConten = "--attach " + aFicheroAdjunto + " \" + &10;
                    |FINSI;
                |FINSI;

                |XGRABA nHandle1, aConten;

                aConten = "";
            |FINSI;

            |XLEE nHandle2, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandle1;
     |XCIERRA nHandle2;

     aEjecuta = "/bin/sh " + aAbreTXTD;

     |SYSTEM aEjecuta;

     |PARA;  |SI;  |HACIENDO;
          |XABRE "E", aAbreFIN, nHandle;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |SLEEP 1;
          |PULSATECLA;
     |SIGUE;

     |FBORRA aAbreTXT;
     |FBORRA aAbreTXTD;
     |FBORRA aAbreHTMD;
     |FBORRA aAbreFIN;


     |SI nPrevinet = 1;
          ||La url la obtengo del nuevo Parametros DSOPORTE

/*
     No estaba funcionando porque tenia una copia antigua de dsoporte
     dentro de dsprevex. Ahora ya esta linkado

          |DBASS aBaseEx;  |QBF aBaseEx;
          aPathFich = aBaseEx + "dsoporte/fich/";
          |PATH_DAT #100aPathFich;

          |ABRE #100;
          |DDEFECTO #100;
          |LEE 000#100p;
          |LEE 000#dsparam0.p;
          aUrl = #100#1;
          |CIERRA #100;
*/

          |ABRE #dsparam0;
          |DDEFECTO #dsparam0;
          |LEE 000#dsparam0.p;
          aUrl = #dsparam0#1;
          |CIERRA #dsparam0;

          |QBF aUrl;
          |SI aUrl = "";
||               aMensaje = "0000Parametros DSoporte no configurados";
||               |MENAV aMensaje;
               |ACABA;
          |FINSI;

          |DBASE aBaseS;
          |QBF aBaseS;
          aBaseS = aBaseS + "shells/";
          |MKDIR aBaseS;

          fFecha = ~;
          aFecha = fFecha;
          aAnyo = aFecha % -104;
          aMes = aFecha % 402;
          aDia = aFecha % 102;

          |HORA aHora;
          |QBF aHora;
          aLaHora = aHora % 102;
          aMinutos = aHora % 402;
          aSegundos = aHora % 702;

          aBaseS = aBaseS + aAnyo + aMes + "/";
          |MKDIR aBaseS;

          aNombreShell = aAnyo + aMes + aDia + aLaHora + aMinutos + aSegundos + aUsuario;

          aResultado = aBaseS + aNombreShell + ".res";
          ||TODO
          ||ARA47
          ||Genero la shell con el CURL para hacer la peticion
          ||de registroPrevinet
          aShell = aBaseS + aNombreShell + ".sh";
          |XABRE "WB", aShell, nHandleS;
          |SI FSalida ] 0;
               ||ARA47
               aLinea = "/usr/bin/curl " + &34 + aUrl;
               |XGRABA nHandleS, aLinea;

               aLinea = "?claveGeconet=" + #4#11;  |QBF aLinea;
               |XGRABA nHandleS, aLinea;

               eaPass = #4#15;  |HAZ EncriptaMAC;
               aLinea = "&email=" + eaPassEnc;  |QBF aLinea;
               |XGRABA nHandleS, aLinea;

               eaPass = aAlfa7;  |HAZ EncriptaMAC;
               aLinea = "&dsc=" + eaPassEnc;  |QBF aLinea;
               |XGRABA nHandleS, aLinea;

               eaPass = aAlfa8;  |HAZ EncriptaMAC;
               aLinea = "&tel=" + eaPassEnc;  |QBF aLinea;
               |XGRABA nHandleS, aLinea;

               eaPass = aAlfa9;  |HAZ EncriptaMAC;
               aLinea = "&nombre=" + eaPassEnc;  |QBF aLinea;
               aLinea = aLinea + &34;
               |XGRABA nHandleS, aLinea;

               aLinea = " -o " + aResultado;
               |XGRABA nHandleS, aLinea;

|| http://0.0.0.0:8010/registroPrevinet/
|| ?claveGeconet=EEDSECDSECDUDSDUDSEAEEEEDSEEDSDSDSEC
|| &email=IKJIHQHMIUIIIOIWHQEYHSICHMHYIUHMIKDOHUIW
|| &dsc=GEGIGCGQFIGKFEFEFEFAFCGIFQFWDWDSDWDS
|| &tel=EEECEAEIEADUDWDYEA
|| &nombre=GKGCGWCMFEFAGIFWGCGKCMFEGCGIGMPMGK

          |FINSI;
          |XCIERRA nHandleS;

          ||Y ejecuto dicha shell.
          aEjecuta = "/bin/sh " + aShell;
          |SYSTEM aEjecuta;
     |FINSI;

     |HAZ GrabaHistEnvios;
|FPRC;

|PROCESO CorreoSinac;
     aTo = #4#15;  |QBF aTo;
     |SI aTo = "";  |ACABA;  |FINSI;

     |DBASS aBaseMensaje;  |QBF aBase;
     aBaseMensaje = aBaseMensaje + "dspreven/documentos/dscorreo/";

     |SI eaFrom = "";
         eaFrom    = "soporte@diagram.es";
     |FINSI;

     aProducto = "GECONET (SINAC)";

     aFrom    = eaFrom;
     aAsunto  = "Acceso para el uso de las aplicaciones " + aProducto;

     aAbreTXT  = aAbre;

     |HAZ EsPrevinet;
     aAbreHTMO = aBaseMensaje + "sinac.htm";
     aAbreHTMD = aBaseMensaje + #4#5 + ".htm";  |QBT aAbreHTMD;
     |FBORRA aAbreHTMD;

     |XABRE "WB", aAbreHTMD, nHandle1;
     |XABRE "AB", aAbreHTMO, nHandle2;

     nRegilla = 0;
     |XLEE nHandle2, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            |SI nRegilla = 0;  |Y aAlfa ! "{";
                |XGRABA nHandle1, aAlfa;
            |FINSI;

            |SI aAlfa = "}";
                aConten  = aConten + aAlfa;

                |SI aConten = "{NOMBRESPA}";
                    aAlfa = eaSPA;
                |FINSI;

                |SI aConten = "{USUARIO}";
                    aAlfa = #4#5;
                |FINSI;

                |SI aConten = "{NOMUSUARIO}";
                    aAlfa = #4#6;
                |FINSI;

                |SI aConten = "{PASSWORD}";
                    aAlfa = #4#7;
                |FINSI;

                |SI aConten = "{ACCESO}";

                    aAlfa = "http://www.geconet.net/portal/";
                    aAlfa = aAlfa + "crearAcceso.php?claveGeconet="
                    aAlfa = aAlfa + #4#11;  |QBF aAlfa;

                    eaPass = #4#15;  |HAZ EncriptaMAC;
                    aAlfa  = aAlfa + "&email=" + eaPassEnc;  |QBF aAlfa;
                    eaPass    = "";
                    eaPassEnc = "";
                |FINSI;

                |SI aConten = "{PRODUCTO}";
                    aAlfa = aProducto;
                |FINSI;

                |SI aConten = "{WEBPREVINET}";
                    |HAZ EsPrevinet;
                    aAlfa = "";
                    |SI nPrevinet = 1;
                        aAlfa = "<br>" + &13 + &10;
                        aAlfa = aAlfa + "Acceso Web: <a href=" + &34 + "https://sinac.diagram.net" + &34 + ">https://sinac.diagram.net</a>";
                        aAlfa = aAlfa + "<br>" + &13 + &10;
                        aAlfa = aAlfa + "<br>" + &13 + &10;
                        aAlfa = aAlfa + "<br>" + &13 + &10;
                    |FINSI;
                |FINSI;

                |XGRABA nHandle1, aAlfa;

                nRegilla = 0;
                aConten  = "";
            |SINO;
                |SI aAlfa = "{";  |O nRegilla = 1;
                    aConten  = aConten + aAlfa;
                    nRegilla = 1;
                |FINSI;
            |FINSI;

            |XLEE nHandle2, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandle1;
     |XCIERRA nHandle2;

     aAbreTXTO = aBaseMensaje + "dscorreo.sh";
     aAbreTXTD = aBaseMensaje + #4#5 + ".sh";  |QBT aAbreTXTD;
     aAbreFIN  = aBaseMensaje + #4#5 + ".txt"; |QBT aAbreFIN;
     |FBORRA aAbreTXTD;
     |FBORRA aAbreFIN;

     |XABRE "WB", aAbreTXTD, nHandle1;
     |XABRE "AB", aAbreTXTO, nHandle2;

     aCarac10 = &10;

     |XLEE nHandle2, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            aConten = aConten + aAlfa;

            |SI aAlfa = aCarac10;
                aAlfa1 = aConten - "DE=$1";
                |SI FSalida ! 0;
                    aConten = "DE=" + &34 + aFrom + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "$PARA";
                |SI FSalida ! 0;
                    |HAZ PonDirecciones;
                |FINSI;

                aAlfa1 = aConten - "ASUNTO=$3";
                |SI FSalida ! 0;
                    aConten = "ASUNTO=" + &34 + aAsunto + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "FICHTM=$4";
                |SI FSalida ! 0;
                    aConten = "FICHTM=" + &34 + aAbreHTMD + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "FICAT1=$5";
                |SI FSalida ! 0;
                    aConten = "FICAT1=" + &34 + aBaseMensaje + "logo_sinac.png" + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "FICFIN=$6";
                |SI FSalida ! 0;
                    aConten = "FICFIN=" + &34 + aAbreFIN + &34 + &10;  |QBT aConten;
                |FINSI;

                aAlfa1 = aConten - "$ADJUNTO";
                |SI FSalida ! 0;
                    aConten = "";
                |FINSI;

                |XGRABA nHandle1, aConten;

                aConten = "";
            |FINSI;

            |XLEE nHandle2, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandle1;
     |XCIERRA nHandle2;

     aEjecuta = "/bin/sh " + aAbreTXTD;

     |SYSTEM aEjecuta;

     |PARA;  |SI;  |HACIENDO;
          |XABRE "E", aAbreFIN, nHandle;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |SLEEP 1;
          |PULSATECLA;
     |SIGUE;

     |FBORRA aAbreTXT;
     |FBORRA aAbreTXTD;
     |FBORRA aAbreHTMD;
     |FBORRA aAbreFIN;
|FPRC;

|PROCESO CorreoPrevenzis;
     aTo = #4#15;  |QBF aTo;
     |SI aTo = "";  |ACABA;  |FINSI;

     |DBASS aBaseMensaje;  |QBF aBase;
     aBaseMensaje = aBaseMensaje + "dspreven/documentos/dscorreo/";

     |SI eaFrom = "";
         eaFrom    = "soporte@diagram.es";
     |FINSI;

     aProducto = "GECONET (PREVENZIS)";

     aFrom    = eaFrom;
     aAsunto  = "Acceso para el uso de las aplicaciones " + aProducto;

     aAbreTXT  = aAbre;

     |HAZ EsPrevinet;
     aAbreHTMO = aBaseMensaje + "prevenzis.htm";
     aAbreHTMD = aBaseMensaje + #4#5 + ".htm";  |QBT aAbreHTMD;
     |FBORRA aAbreHTMD;

     |XABRE "WB", aAbreHTMD, nHandle1;
     |XABRE "AB", aAbreHTMO, nHandle2;

     nRegilla = 0;
     |XLEE nHandle2, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            |SI nRegilla = 0;  |Y aAlfa ! "{";
                |XGRABA nHandle1, aAlfa;
            |FINSI;

            |SI aAlfa = "}";
                aConten  = aConten + aAlfa;

                |SI aConten = "{NOMBRESPA}";
                    aAlfa = eaSPA;
                |FINSI;

                |SI aConten = "{USUARIO}";
                    aAlfa = #4#5;
                |FINSI;

                |SI aConten = "{NOMUSUARIO}";
                    aAlfa = #4#6;
                |FINSI;

                |SI aConten = "{PASSWORD}";
                    aAlfa = #4#7;
                |FINSI;

                |SI aConten = "{ACCESO}";

                    aAlfa = "http://www.geconet.net/portal/";
                    aAlfa = aAlfa + "crearAcceso.php?claveGeconet="
                    aAlfa = aAlfa + #4#11;  |QBF aAlfa;

                    eaPass = #4#15;  |HAZ EncriptaMAC;
                    aAlfa  = aAlfa + "&email=" + eaPassEnc;  |QBF aAlfa;
                    eaPass    = "";
                    eaPassEnc = "";
                |FINSI;

                |SI aConten = "{PRODUCTO}";
                    aAlfa = aProducto;
                |FINSI;

                |SI aConten = "{WEBPREVINET}";
                    |HAZ EsPrevinet;
                    aAlfa = "";
                    |SI nPrevinet = 1;
                        aAlfa = "<br>" + &13 + &10;
                        aAlfa = aAlfa + "Acceso Web: <a href=" + &34 + "https://prevenzis.diagram.net" + &34 + ">https://prevenzis.diagram.net</a>";
                        aAlfa = aAlfa + "<br>" + &13 + &10;
                        aAlfa = aAlfa + "<br>" + &13 + &10;
                        aAlfa = aAlfa + "<br>" + &13 + &10;
                    |FINSI;
                |FINSI;

                |XGRABA nHandle1, aAlfa;

                nRegilla = 0;
                aConten  = "";
            |SINO;
                |SI aAlfa = "{";  |O nRegilla = 1;
                    aConten  = aConten + aAlfa;
                    nRegilla = 1;
                |FINSI;
            |FINSI;

            |XLEE nHandle2, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandle1;
     |XCIERRA nHandle2;

     aAbreTXTO = aBaseMensaje + "dscorreo.sh";
     aAbreTXTD = aBaseMensaje + #4#5 + ".sh";  |QBT aAbreTXTD;
     aAbreFIN  = aBaseMensaje + #4#5 + ".txt"; |QBT aAbreFIN;
     |FBORRA aAbreTXTD;
     |FBORRA aAbreFIN;

     |XABRE "WB", aAbreTXTD, nHandle1;
     |XABRE "AB", aAbreTXTO, nHandle2;

     aCarac10 = &10;

     |XLEE nHandle2, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            aConten = aConten + aAlfa;

            |SI aAlfa = aCarac10;
                aAlfa1 = aConten - "DE=$1";
                |SI FSalida ! 0;
                    aConten = "DE=" + &34 + aFrom + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "$PARA";
                |SI FSalida ! 0;
                    |HAZ PonDirecciones;
                |FINSI;

                aAlfa1 = aConten - "ASUNTO=$3";
                |SI FSalida ! 0;
                    aConten = "ASUNTO=" + &34 + aAsunto + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "FICHTM=$4";
                |SI FSalida ! 0;
                    aConten = "FICHTM=" + &34 + aAbreHTMD + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "FICAT1=$5";
                |SI FSalida ! 0;
                    aConten = "FICAT1=" + &34 + aBaseMensaje + "logo_prevenzis.png" + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "FICFIN=$6";
                |SI FSalida ! 0;
                    aConten = "FICFIN=" + &34 + aAbreFIN + &34 + &10;  |QBT aConten;
                |FINSI;

                aAlfa1 = aConten - "$ADJUNTO";
                |SI FSalida ! 0;
                    aConten = "";
                |FINSI;

                |XGRABA nHandle1, aConten;

                aConten = "";
            |FINSI;

            |XLEE nHandle2, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandle1;
     |XCIERRA nHandle2;

     aEjecuta = "/bin/sh " + aAbreTXTD;

     |SYSTEM aEjecuta;

     |PARA;  |SI;  |HACIENDO;
          |XABRE "E", aAbreFIN, nHandle;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |SLEEP 1;
          |PULSATECLA;
     |SIGUE;

     |FBORRA aAbreTXT;
     |FBORRA aAbreTXTD;
     |FBORRA aAbreHTMD;
     |FBORRA aAbreFIN;
|FPRC;



|PROCESO CorreoVDESK;
     aTo = eaMailVDESK;  |QBF aTo;
     |SI aTo = "";  |ACABA;  |FINSI;

     |DBASS aCarpeta;  |QBF aCarpeta;
     aBaseMensaje = aCarpeta + "dspreven/documentos/dscorreo/";

     |SI eaFrom = "";
         eaFrom    = "soporte@diagram.es";
     |FINSI;

     aFrom    = eaFrom;
     aAsunto  = eaSPA + ". Alta usuario VDESK.";

     |SI nOTP = 1;
         aAsunto  = "Grupo OTP. " + eaSPA + ". Alta usuario VDESK.";
     |FINSI;

     |SI nSinac = 1;
         aAsunto  = "Sinac. Alta usuario VDESK.";
     |FINSI;

     |SI nPrevenzis = 1;
         aAsunto  = "Prevenzis. Alta usuario VDESK.";
     |FINSI;

     aAbreTXT  = aAbre;
     aAbreHTMO = aBaseMensaje + "dsvdesk.htm";
     aAbreHTMD = aBaseMensaje + #4#5 + ".htm";  |QBT aAbreHTMD;
     |FBORRA aAbreHTMD;

     |XABRE "WB", aAbreHTMD, nHandle1;
     |XABRE "AB", aAbreHTMO, nHandle2;

     aProducto = "GECONET";
     |SI eaProd ! "";
         aProducto = eaProd;
     |FINSI;

     nRegilla = 0;
     |XLEE nHandle2, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            |SI nRegilla = 0;  |Y aAlfa ! "{";
                |XGRABA nHandle1, aAlfa;
            |FINSI;

            |SI aAlfa = "}";
                aConten  = aConten + aAlfa;

                |SI aConten = "{CARPETA}";
                    aAlfa = aCarpeta;
                |FINSI;

                |SI aConten = "{NOMBRESPA}";
                    aAlfa = eaSPA;
                |FINSI;

                |SI aConten = "{USUARIOPETICION}";
                    aAlfa = Usuario % 810;
                |FINSI;

                |SI aConten = "{FECHAPETICION}";
                    fFecha = ~;
                    aAlfa  = fFecha;
                |FINSI;

                |SI aConten = "{HORAPETICION}";
                    |HORA aAlfa;
                |FINSI;

                |SI aConten = "{TIPO}";
                    aAlfa = eaTipoVDESK;
                |FINSI;

                |SI aConten = "{DATOSEMPRESA}";
                    aAlfa = eaDEmpVDESK;
                |FINSI;

                |SI aConten = "{DATOSCENTRO}";
                    aAlfa = eaDCenVDESK;
                |FINSI;

                |SI aConten = "{USUARIO}";
                    aAlfa = #4#5;
                |FINSI;

                |SI aConten = "{PASSWORDENC}";
                    aAlfa = #4#11;
                |FINSI;

                |SI aConten = "{PASSWORD}";
                    aAlfa = #4#7;
                |FINSI;

                |XGRABA nHandle1, aAlfa;

                nRegilla = 0;
                aConten  = "";
            |SINO;
                |SI aAlfa = "{";  |O nRegilla = 1;
                    aConten  = aConten + aAlfa;
                    nRegilla = 1;
                |FINSI;
            |FINSI;

            |XLEE nHandle2, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandle1;
     |XCIERRA nHandle2;


     aAbreTXTO = aBaseMensaje + "dscorreo.sh";
     aAbreTXTD = aBaseMensaje + #4#5 + ".sh";  |QBT aAbreTXTD;
     aAbreFIN  = aBaseMensaje + #4#5 + ".txt"; |QBT aAbreFIN;
     |FBORRA aAbreTXTD;
     |FBORRA aAbreFIN;

     |XABRE "WB", aAbreTXTD, nHandle1;
     |XABRE "AB", aAbreTXTO, nHandle2;

     aCarac10 = &10;

     |XLEE nHandle2, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            aConten = aConten + aAlfa;

            |SI aAlfa = aCarac10;
                aAlfa1 = aConten - "DE=$1";
                |SI FSalida ! 0;
                    aConten = "DE=" + &34 + aFrom + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "$PARA";
                |SI FSalida ! 0;
                    |HAZ PonDirecciones;
                |FINSI;

                aAlfa1 = aConten - "ASUNTO=$3";
                |SI FSalida ! 0;
                    aConten = "ASUNTO=" + &34 + aAsunto + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "FICHTM=$4";
                |SI FSalida ! 0;
                    aConten = "FICHTM=" + &34 + aAbreHTMD + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "FICAT1=$5";
                |SI FSalida ! 0;
                    aConten = "FICAT1=" + &34 + aBaseMensaje + "logo_correo.bmp" + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "FICFIN=$6";
                |SI FSalida ! 0;
                    aConten = "FICFIN=" + &34 + aAbreFIN + &34 + &10;  |QBT aConten;
                |FINSI;

                aAlfa1 = aConten - "$ADJUNTO";
                |SI FSalida ! 0;
                    aConten = "";
                |FINSI;

                |XGRABA nHandle1, aConten;

                aConten = "";
            |FINSI;

            |XLEE nHandle2, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandle1;
     |XCIERRA nHandle2;

     aEjecuta = "/bin/sh " + aAbreTXTD;

     |SYSTEM aEjecuta;

     |PARA;  |SI;  |HACIENDO;
          |XABRE "E", aAbreFIN, nHandle;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |SLEEP 1;
          |PULSATECLA;
     |SIGUE;

     |FBORRA aAbreTXT;
     |FBORRA aAbreTXTD;
     |FBORRA aAbreHTMD;
     |FBORRA aAbreFIN;
|FPRC;

|PROCESO CorreoDSARCHI;
     aTo = #4#15;  |QBF aTo;
     |SI aTo = "";  |ACABA;  |FINSI;

     |DBASS aBaseMensaje;  |QBF aBase;

     aLogo    = aBaseMensaje + "dsarchi/logos/logodespanet.jpg";
     |XABRE "E", aLogo, nHandle;
     |SI FSalida < 0;
         aLogo    = aBaseMensaje + "dsarchi/logos/logodespanet.bmp";
         |SI FSalida < 0;
             aLogo = "";
         |FINSI;
     |FINSI;

     aBaseMensaje = aBaseMensaje + "dsarchi/dscorreo/";

     |SI eaFrom = "";
         eaFrom    = "soporte@diagram.es";
     |FINSI;

     aFrom    = eaFrom;
     aAsunto  = "Acceso para el uso de las aplicaciones DESPANET";

     aAbreTXT  = aAbre;
     aAbreHTMO = aBaseMensaje + "dsoporte.htm";
     aAbreHTMD = aBaseMensaje + #4#5 + ".htm";  |QBT aAbreHTMD;
     |FBORRA aAbreHTMD;

     |XABRE "WB", aAbreHTMD, nHandle1;
     |XABRE "AB", aAbreHTMO, nHandle2;

     nSwAnulaGecoOff = 0;

     nRegilla = 0;
     |XLEE nHandle2, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            |SI nRegilla = 0;  |Y aAlfa ! "{";
                |XGRABA nHandle1, aAlfa;
            |FINSI;

            |SI aAlfa = "}";
                aConten  = aConten + aAlfa;

                |SI aConten = "{NOMBREDESPA}";
                    aAlfa = eaSPA;
                |FINSI;

                |SI aConten = "{USUARIO}";
                    aAlfa = #4#5;
                |FINSI;

                |SI aConten = "{PASSWORD}";
                    aAlfa = #4#7;
                |FINSI;

                |SI aConten = "{ACCESO}";
                    |HAZ EsPrevinet;

                    aAlfa = "http://www.geconet.net/portal/";

                    |SI nPrevinet = 1;
                        nSwAnulaGecoOff = 1;
                        aAlfa = aAlfa + "registroPrevinet.php?claveGeconet="
                    |SINO;
                        aAlfa = aAlfa + "crearAcceso.php?claveGeconet="
                    |FINSI;

                    aAlfa = aAlfa + #4#11;  |QBF aAlfa;

                    eaPass = #4#15;  |HAZ EncriptaMAC;
                    aAlfa  = aAlfa + "&email=" + eaPassEnc;  |QBF aAlfa;
                    eaPass    = "";
                    eaPassEnc = "";
                |FINSI;

                |SI aConten = "{WEBPREVINET}";
                    |HAZ EsPrevinet;

                    aAlfa = "";
                    |SI nPrevinet = 1;
                        aAlfa = "<br>" + &13 + &10;
                        aAlfa = aAlfa + "Acceso Previnet Web: <a href=" + &34 + "http://clientes.grupotp-previnet.es/" + &34 + ">http://clientes.grupotp-previnet.es/</a>";
                        aAlfa = aAlfa + "<br>" + &13 + &10;
                        aAlfa = aAlfa + "<br>" + &13 + &10;
                        aAlfa = aAlfa + "<br>" + &13 + &10;
                    |FINSI;
                |FINSI;

                |XGRABA nHandle1, aAlfa;

                nRegilla = 0;
                aConten  = "";
            |SINO;
                |SI aAlfa = "{";  |O nRegilla = 1;
                    aConten  = aConten + aAlfa;
                    nRegilla = 1;
                |FINSI;
            |FINSI;

            |XLEE nHandle2, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandle1;
     |XCIERRA nHandle2;

     |SI nSwAnulaGecoOff = 1;
          |HAZ AnulaGeconetOff;
     |FINSI;

     aAbreTXTO = aBaseMensaje + "dscorreo.sh";
     aAbreTXTD = aBaseMensaje + #4#5 + ".sh";  |QBT aAbreTXTD;
     aAbreFIN  = aBaseMensaje + #4#5 + ".txt"; |QBT aAbreFIN;
     |FBORRA aAbreTXTD;
     |FBORRA aAbreFIN;

     |XABRE "WB", aAbreTXTD, nHandle1;
     |XABRE "AB", aAbreTXTO, nHandle2;

     aCarac10 = &10;

     |XLEE nHandle2, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            aConten = aConten + aAlfa;

            |SI aAlfa = aCarac10;
                aAlfa1 = aConten - "DE=$1";
                |SI FSalida ! 0;
                    aConten = "DE=" + &34 + aFrom + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "$PARA";
                |SI FSalida ! 0;
                    |HAZ PonDirecciones;
                |FINSI;

                aAlfa1 = aConten - "ASUNTO=$3";
                |SI FSalida ! 0;
                    aConten = "ASUNTO=" + &34 + aAsunto + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "FICHTM=$4";
                |SI FSalida ! 0;
                    aConten = "FICHTM=" + &34 + aAbreHTMD + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "FICAT1=$5";
                |SI FSalida ! 0;
                    aConten = "FICAT1=" + &34 + aLogo + &34 + &10;
                |FINSI;

                aAlfa1 = aConten - "FICFIN=$6";
                |SI FSalida ! 0;
                    aConten = "FICFIN=" + &34 + aAbreFIN + &34 + &10;  |QBT aConten;
                |FINSI;

                aAlfa1 = aConten - "$ADJUNTO";
                |SI FSalida ! 0;
                    aConten = "";
                |FINSI;

                |XGRABA nHandle1, aConten;

                aConten = "";
            |FINSI;

            |XLEE nHandle2, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandle1;
     |XCIERRA nHandle2;

     aEjecuta = "/bin/sh " + aAbreTXTD;

     |SYSTEM aEjecuta;

     |PARA;  |SI;  |HACIENDO;
          |XABRE "E", aAbreFIN, nHandle;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |SLEEP 1;
          |PULSATECLA;
     |SIGUE;

     |FBORRA aAbreTXT;
     |FBORRA aAbreTXTD;
     |FBORRA aAbreHTMD;
     |FBORRA aAbreFIN;
|FPRC;

|PROCESO CuerpoCorreo;
     |DBASS aBaseDigital;  |QBF aBaseDigital;

     aServidor   = aBaseDigital % -303;  |QBF aServidor;
     aDirectorio = aBaseDigital % -201;  |QBF aDirectorio;
     aReferencia = aBaseDigital % -207;

     nNum = aServidor;
     |SI nNum        = 0;   aServidor   = "001";  |FINSI;
     |SI aServidor   = "";  aServidor   = "001";  |FINSI;
     |SI aDirectorio = "";  aDirectorio = "1";    |FINSI;

     |DBASE aBaseMensaje;  |QBF aBase;
     aAbre    = aBaseMensaje + "correos";  |MKDIR aAbre;
     aAbre    = aAbre + "/adjunto.txt";
     |XABRE "WB", aAbre, nHandle;

     aAlfa = eaSPA + " le agradece la confianza depositada en nosotros." + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "A continuación se le indica el enlace para obtener acceso a las ";
     aAlfa = aAlfa + "aplicaciones GECONET a través del portal de acceso." + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;  |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "Usuario:                   " + #4#5 + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa =  "Password:                  " + #4#7 + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;  |XGRABA nHandle, aAlfa;

     eaPass = #4#15;  |HAZ EncriptaMAC;

     aAlfa = "Pinche en http  " + &13 + &10;
     |XGRABA nHandle, aAlfa;

     |HAZ EsPrevinet;

     aAlfa = "http://www.geconet.net/portal/";

     nSwAnulaGecoOff = 0;

     |SI nPrevinet = 1;
         nSwAnulaGecoOff = 1;
         aAlfa = aAlfa + "registroPrevinet.php?claveGeconet="
     |SINO;
         aAlfa = aAlfa + "crearAcceso.php?claveGeconet="
     |FINSI;

     aAlfa = aAlfa + #4#11;  |QBF aAlfa;

     aAlfa = aAlfa + "&email=" + eaPassEnc;  |QBF aAlfa;
     |XGRABA nHandle, aAlfa;

     eaPass    = "";
     eaPassEnc = "";

     aAlfa = &13 + &10;  |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;  |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "Para cualquier aclaración o duda no dude en ponerse en contacto con nosotros." + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;

     aAlfa = ("_" * 134) + &13 + &10;   |XGRABA nHandle, aAlfa;

     aAlfa =  "Este correo electrónico y, en su caso, cualquier fichero anexo al mismo, contiene";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "información de carácter confidencial exclusivamente dirigida a su destinatario o";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "destinatarios. Queda prohibida su divulgación, copia o distribución a terceros sin la";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "previa autorización escrita de la empresa. En el caso de haber recibido este correo";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "electrónico por error, se ruega  notifíquese inmediatamente esta circunstancia mediante";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "reenvío a la dirección electrónica del remitente y proceda a su destrucción.";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;

     aAlfa = "El consumo de papel es perjudicial para el medio ambiente. Por favor téngalo en cuenta";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "antes de imprimir este mensaje.";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = ("_" * 134) + &13 + &10;   |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;

     |XCIERRA nHandle;

     |SI nSwAnulaGecoOff = 1;
          |HAZ AnulaGeconetOff;
     |FINSI;
|FPRC;

|PROCESO Correo;
     aTo = #4#15;  |QBF aTo;
     |SI aTo = "";  |ACABA;  |FINSI;

     |HAZ CuerpoCorreo;
     |HAZ IPDSCorreo;

     |SI eaSPA = "";
         eaSPA = "DS, S.L.";
     |FINSI;

     |SI eaFrom = "";
         eaFrom    = "soporte@diagram.es";
     |FINSI;

     aIP      = eaIPDSCorreo;
     aSalida  = "asmtp.diagram.es";  |QBF aSalida;
     aFrom    = eaFrom;
     aAsunto  = "Acceso para el uso de las aplicaciones GECONET";
     aMensaje = "$$$$" + aAbre;
     aAdjunto = aAbre;

     |DSCORREO_ENVIA aIP, aSalida, aFrom, aTo, aAsunto, aMensaje, aAdjunto;
     enErrorCorreo = FSalida;
     |SI FSalida < 0;
         |MENAV "0000 Ha habido un error en el envio del correo, revise el e_mail del usuario.";
     |SINO;
         |MENAV "0000 Correo enviado.";
     |FINSI;
|FPRC;

|PROCESO EntradaDsArchi;
     |LEE 000#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa = "|:dsarchi/dsarz010;" + #4#5;  |QBF aAlfa;
     |SUB_EJECUTA aAlfa;

     |PONCONTROL 23, "SI";
     |PTEC 809;
|FPRC;

|PROCESO MandaCorreo;
     |SI eaMailVDESK  ! "";
         |HAZ CorreoVDESK;
         |ACABA;
     |FINSI;

     |SI nOTP = 1;  |O enEsDSARCHI = 1;
         |SI nOTP        = 1;  |HAZ CorreoOTP;      |FINSI;
         |SI enEsDSARCHI = 1;  |HAZ CorreoDSARCHI;  |FINSI;
     |SINO;
         |SI nSinac = 1;
              |HAZ CorreoSinac;
         |SINO;
              |SI nPrevenzis = 1;
                   |HAZ CorreoPrevenzis;
              |SINO;
                   |HAZ Correo;
                   |SI enErrorCorreo < 0;
                       |BORRA 020#4a;
                       |LIBERA #4;
                       |CIERRA #4;
                       |ACABA;
                   |FINSI;
              |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO AnulaGeconetOff;
     ||Esto se encarga de escribir en accesos anulados un registro
     ||para evitar que el usuario pueda entrar

     |DBASS aBaseDigital;  |QBF aBaseDigital;

     aServidor = aBaseDigital % -303;
     |QBF aServidor;

     aDirectorio = aBaseDigital % -201;
     |QBF aDirectorio;

     nNum = aServidor;
     |SI nNum        = 0;   aServidor   = "001";  |FINSI;
     |SI aServidor   = "";  aServidor   = "001";  |FINSI;
     |SI aDirectorio = "";  aDirectorio = "1";    |FINSI;

     eaPass = aDirectorio + (("00" + #4#1) % -102) + (("00" + #4#2) % -102) + aServidor + #4#5;

     aCarpeta = aDirectorio;
     aCliente = (("00" + #4#1) % -102);
     aEmpresa = (("00" + #4#2) % -102);
     aUsuario = #4#5;
     |QBF aUsuario;

     aEmail = #4#15;
     |QBF aEmail;

     aPathPythonGeco = "/u/accesoPrevinet";
     aNombrePython = "anularAccesoONOFF.py";

     aScriptPython = aPathPythonGeco + "/" + aNombrePython;
     |XABRE "E", aScriptPython, nHandlePy;
     |SI FSalida = 0;
          aProg = "python " + aScriptPython;
          aProg = aProg + " " + aEmail + " " + aServidor + " " + aCarpeta + " " + aCliente + " " + aEmpresa + " " + aUsuario + " off";
          |SYSTEM aProg;
     |FINSI;
|FPRC;

|PROGRAMA;
     |SI PARAMETRO ! "";
         aBusco = PARAMETRO % 104;
         |SI aBusco = "FILE";
              aParametro = "";
              aFicheroPara = PARAMETRO % 5;
              |QBF aFicheroPara;
              |XABRE "U", aFicheroPara, nHandlePa;
              |SI FSalida ] 0;
                    |XLEE nHandle, 250, aParametro;
              |FINSI;
              |XCIERRA nHandlePa;
              |FBORRA aFicheroPara;

              |SI aParametro = "";
                   aMensaje = "0000Error en los Parametros de la llamada";
                   |MENAV aMensaje;
                   |ACABA;
              |FINSI;
              aAlfa1 = aParametro % 101;
              aAlfa2 = aParametro % 202;
              aAlfa3 = aParametro % 402;
              aAlfa4 = aParametro % 602;
              aAlfa5 = aParametro % 802;
              aAlfa6 = aParametro % 1010;
              aAlfa7 = aParametro % 2060;
              aAlfa8 = aParametro % 8009;
              aAlfa9 = aParametro % 8960;
         |SINO;
              aAlfa1 = PARAMETRO % 101;
              aAlfa2 = PARAMETRO % 202;
              aAlfa3 = PARAMETRO % 402;
              aAlfa4 = PARAMETRO % 602;
              aAlfa5 = PARAMETRO % 802;
              aAlfa6 = PARAMETRO % 1010;
              ||aAlfa7 = PARAMETRO % 2060;
              ||aAlfa8 = PARAMETRO % 8009;
              ||aAlfa9 = PARAMETRO % 8930;          ||Limitado a 30, sino peta en ejecucion
         |FINSI;

         |HAZ MiraSiEsOTP;
         |HAZ MiraSiEsSinac;
         |HAZ MiraSiEsPrevenzis;

         |ABRE #3;
         #3#0 = aAlfa1;
         #3#1 = aAlfa2;
         #3#2 = aAlfa3;
         #3#3 = aAlfa4;
         #3#4 = aAlfa5;
         |LEE 101#3=;
         |SI FSalida ! 0;  |DDEFECTO #3;  |FINSI;
         |CIERRA #3;

         |ABRE #4;
         #4#0 = aAlfa1;
         #4#1 = aAlfa2;
         #4#2 = aAlfa3;
         #4#3 = aAlfa4;
         #4#4 = aAlfa5;
         #4#5 = aAlfa6;
         |LEE 101#4=;
         |SI FSalida = 0;
             |HAZ CargaMAC;
             |HAZ MandaCorreo;

             |HORA aHora;

             |ABRE #99;
             nReg = 1;
             |LEE 000#99u;
             |SI FSalida = 0;
                 nReg = #99#0 + 1;
             |FINSI;

             #99#0  = nReg;
             |GRABA 020#99b;

             #99#1  = #4#5;
             #99#2  = ~;
             #99#3  = aHora;
             #99#4  = "A";
             #99#5  = "ALTA DEL USUARIO";
             #99#6  = #4#0 + (("00" + #4#1) % -102) + (("00" + #4#2) % -102);
             #99#7  = #4#3;
             #99#8  = #4#4;
             #99#9  = #3#5;
             #99#10 = #3#6;
             #99#11 = #3#7;
             #99#12 = #3#8;
             #99#13 = #3#9;
             #99#14 = #3#10;
             #99#15 = #4#9;
             #99#16 = #4#10;
             #99#17 = #4#11;
             #99#18 = #3#11;
             #99#19 = #4#8;
             #99#20 = Usuario % 810;
             |GRABA 020#99a;
             |LIBERA #99;
             |CIERRA #99;

             |GRABA 020#4a;
             |LIBERA #4;
         |FINSI;
         |CIERRA #4;

         |HAZ CargaPerfiles;

         |ACABA;
     |FINSI;

     enChequeoUsu = 0;
     |HAZ RevisaUsuarios;

     |CLS;
     |CABEZA "Asistente Usuarios";

     |PINPA #0#3;

     |DBASS aBase;  |QBF aBase;
     aMenu = aBase + "dspreven/def/maesm011.mas";
     |XABRE "E", aMenu, nHandle;
     |SI FSalida ] 0;
         |ATRI R;
         |PINTA 0602, "Regiones      ";
         |PINTA 0626, "Delegaciones  ";
         |PINTA 0651, "Agencias      ";
         |ATRI r;

         |C_V #4#12, 1, "N";  |C_M #4#12, 1, "N";
         |C_V #4#13, 1, "N";  |C_M #4#13, 1, "N";
         |C_V #4#16, 1, "S";  |C_M #4#16, 1, "S";

         nDSPreven = 1;

         aEmpre = "";
         aMas   = aBase + "dspreven/def/visal000.mas";
         |CARGA_DEF aMas, referen@;
         |SI FSalida = 0;
             aFich = aBase + "dspreven/fich/";
             |PATH_DAT #900aFich;
             |ABRE #900;
             |LEE 000#900p;
             |PARA; |SI;  |HACIENDO;
                  |SI FSalida ! 0;  |SAL;  |FINSI;

                  |SI #900#3 = "S";
                      aEmpre = ("00000" + #900#0) % -105;
                      |SAL;
                  |FINSI;
                  |LEE 000#900s;
             |SIGUE;
             |CIERRA #900;
             |DESCARGA_DEF #referen@;

             aMas   = aBase + "dspreven/def/maesm011.mas";
             |CARGA_DEF aMas, referen@;
             |SI FSalida = 0;
                 |PATH_DAT #900aFich;
                 |ABRE #900;
                 #900#0 = Usuario % 810;
                 |LEE 000#900=;
                 |SI FSalida ! 0;  |DDEFECTO #900;  |FINSI;
                 |CIERRA #900;

                 eaFrom = #900#9;  |QBF eaFrom;

                 |DESCARGA_DEF #referen@;
             |FINSI;

             |SI aEmpre ! "";
                 aMas   = aBase + "dspreven/def/pycm0013.mas";
                 |CARGA_DEF aMas, referen@;
                 |SI FSalida = 0;
                     aFich = aBase + "dspreven/fich/" + aEmpre + "/";
                     |PATH_DAT #900aFich;
                     |ABRE #900;
                     #900#0 = "";
                     |LEE 000#900=;
                     |SI FSalida ! 0;  |DDEFECTO #900;  |FINSI;
                     |CIERRA #900;

                     eaSPA = #900#12;  |QBF eaSPA;

                     |DESCARGA_DEF #referen@;
                 |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         |DBASE aBase;  |QBF aBase;
         aMenu = aBase + "dscursos.men";
         |XABRE "E", aMenu, nHandle;
         |SI FSalida ] 0;
             |ATRI R;
             |PINTA 0602, "Curso Base    ";
             |PINTA 0626, "Curso         ";
             |PINTA 0651, "Usuarios      ";
             |PINTA 1867, "             ";
             |PINTA 1867, "GC";
             |PINTA 1870, "Conexion";
             |ATRI r;

             |PINTA 1869, " ";

             nDSPreven = 2;

             |C_P #4#12, 1, 1967;
             |C_P #4#13, 1, 1974;

             |C_V #4#9,  1, "N";  |C_M #4#9,  1, "N";
             |C_V #4#10, 1, "N";  |C_M #4#10, 1, "N";
         |SINO;
             |ATRI R;
             |PINTA 0602, "Asesores      ";
             |PINTA 0626, "Clientes      ";
             |PINTA 0651, "Delegaciones  ";
             |PINTA 1867, "G.Concurrenc.";
             |ATRI r;

             nDSPreven = 0;

             |C_V #4#9,  1, "N";  |C_M #4#9,  1, "N";
             |C_V #4#10, 1, "N";  |C_M #4#10, 1, "N";
             |C_V #4#13, 1, "N";  |C_M #4#13, 1, "N";
         |FINSI;
     |FINSI;

     |SI nDSPreven ! 1;
         |DBASS aAlfa;    |QBF aAlfa;
         aAlfa = aAlfa + "dsarchi/def/dsarz010.mas";
         |XABRE "E", aAlfa, nHandle;
         |SI FSalida ] 0;
             |CONTROL_SIMPLE 0, "BOTON,Conf.G.documental", 1464, 1479, EntradaDsArchi;
             nBotonDsArchi = FSalida;

             |ESTADO_CONTROL nBotonDsArchi, "DISABLE";
         |FINSI;
         |XCIERRA nHandle;
     |FINSI;

     |PARA nCampo = 5;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
           |C_V #2nCampo, 1, "N";
           |C_M #2nCampo, 1, "N";
     |SIGUE;

     |SI nDSPreven ! 2;
         |HAZ CargaPerfiles;
     |FINSI;

     |ENTLINEAL #1#1, -1, 4, 12, 0, Baja01, Alta01;

     |SI nBotonDsArchi ! -1;
         |FIN_CONTROL_WINDOWS nBotonDsArchi;
     |FINSI;
|FPRO;
