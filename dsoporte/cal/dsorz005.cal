|FICHEROS;
     dsorz999;

     dsorz005;
     dsorm001;
     dsorm003;
     dsorm004;
     dsorm005;
     dsorm006;
     dsorm007;
     dsorm008;
     dsorm009;
     dsorm010;
     dsorm011;
     dsprem03;

     dsorw003;
     dsorw004;
     dsorw008;
     dsorw015;

     referen@;
     preemes@;

     gecom001@;
     gecom004@;
     gecom011@;

||     dpntm001@;
     dsorm003@;

     dsprem03@;
     dsprem04@;
|FIN;

|VARIABLES;
     aBase          = "";
     aBaseAqui      = "";
     aBaseChek      = "";
     aBaseArchi     = "";
     aFich          = "";
     aFic           = "";
     aDirGrupo      = "";
     aDirFichero    = "";
     aDClave        = "";
     aHClave        = "";
     aOrigen        = "";
     aDestino       = "";
     aAplicacion    = "";
     aMenu          = "";
     aAlfa          = "";
     aAlfa1         = "";
     aAlfa2         = "";
     aAlfa3         = "";
     aFichero       = "";
     aLong          = "";
     aAbre          = "";
     aPrograma      = "";
     aCaracter      = "";
     aTabla         = "";
     aDCaracter     = "";
     aHCaracter     = "";
     aCondicion     = "";
     aCampo         = "";
     aClaveMenu     = "";
     aLongitud      = "";
     aMas           = "";
     aQueQuiero     = "";
     aTipo          = "";
     aDAplica       = "";
     aHAplica       = "";
     aDTabla        = "";
     aHTabla        = "";
     aParametro     = "";
     aCodDepar      = "";
     aCodSubDepar   = "";
     aCodSerie      = "";
     aCodAlmacen    = "";
     aCodZona       = "";
     aCodFactura    = "";
     aNumero        = "";
     aPRM           = "";
     aPunto         = "";
     aPredeter1     = "";
     aPredeter2     = "";

     nHandle        = 0;
     nContador90    = 0;
     nContador91    = 0;
     nLong          = 0;
     nPos           = 0;
     nCaracter      = 0;
     nPon           = 0;
     nLinea         = 0;
     nLineaPrime    = 0;
     nNumDef        = 0;
     nContaDef      = 0;
     nLongitud      = "";
     nMenu          = 0;
     nGeneracion    = 0;
     nCampo         = 0;
     nCodMenu       = 0;
     nCodResto      = 0;
     nCodRegion     = 0;
     nCodDele       = 0;
     nCodAgencia    = 0;
     nPasada        = 0;
     nEmpresas      = 0;
     nAuditor       = 0;
     nGrupo         = 0;
     nCod6          = 0;
     nDGrupo        = 0;
     nHGrupo        = 0;
     nHay           = 0;
     nFSalida       = 0;

     &eaAplica      = "";
     &eaMenu        = "";
     &enGrupo       = 0;
|FIN;

|PROCESO CreaMenu;
     aAlfa1 = #dsorw003#1;
     |XGRABA nHandle, aAlfa1;
|FPRC;

|DEFBUCLE dsorw003;
     #dsorw003#1;
     ;
     000001;
     999999;
     ;
     NULL, CreaMenu;
|FIN;

|PROCESO CreaPRM;
     aAlfa1 = #dsorw004#2;
     |XGRABA nHandle, aAlfa1;
|FPRC;

|DEFBUCLE dsorw004A;
     #dsorw004#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CreaPRM;
|FIN;

|| __________________________________________________________________________
||                        PROCESOS MENUS
|| __________________________________________________________________________

|PROCESO CogeHastaDosPuntos;
     aLong     = aAlfa1 % 0;
     nLong     = aLong;
     aPrograma = "";
     aNumero   = "";
     nPon      = 0;
     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (nCaracter * 100) + 1;
           aCaracter = aAlfa1 % nPos;
           |SI aCaracter = "\";  |Y nPon = 1;
               |SAL;
           |FINSI;

           |SI aCaracter = "\";  |Y nPon = 0;
               nPon = 1;
           |FINSI;

           |SI aCaracter ! "\";  |Y nPon = 1;
               aNumero = aNumero + aCaracter;
           |FINSI;
     |SIGUE;

     aAlfa2 = aAlfa1;

     |SI aNumero ! "";
         aAlfa2 = aAlfa1 - aNumero;
         aAlfa2 = aAlfa2 - "\";
         aAlfa2 = aAlfa2 - "\";
     |FINSI;

     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (nCaracter * 100) + 1;
           aCaracter = aAlfa2 % nPos;
           nPon      = 0;
           |SI aCaracter = ":";
               aClaveMenu = aClaveMenu + aCaracter;
               |SAL;
           |SINO;
               aClaveMenu = aClaveMenu + aCaracter;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO CogePrograma;
     aLong     = aAlfa3 % 0;
     nLong     = aLong;
     aPrograma = "";
     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos = (nCaracter * 100) + 1;
           aCaracter = aAlfa3 % nPos;
           nPon = 0;
           |SI aCaracter = "{";  aPrograma = "";  nPon = 1; |FINSI;
           |SI aCaracter = "/";  aPrograma = "";  nPon = 1; |FINSI;
           |SI aCaracter = ":";  aPrograma = "";  nPon = 1; |FINSI;
           |SI aCaracter = " ";  |SAL;            |FINSI;
           |SI aCaracter = "}";  |SAL;            |FINSI;
           |SI aCaracter = ".";  |SAL;            |FINSI;

           |SI nPon = 0;
               aPrograma = aPrograma + aCaracter;
           |FINSI;
     |SIGUE;

     |SI aPrograma = "";  |ACABA;  |FINSI;

     aLong = aPrograma % 0;
     nLong = aLong;
     |SI nLong > 8;  |ACABA;  |FINSI;
     |SI nLong < 5;  |ACABA;  |FINSI;

     nContador91 = nContador91 + 1;
     #dsorw004#0       = "";
     #dsorw004#1       = nContador91;
     #dsorw004#2       = aPrograma;
     |GRABA 020#dsorw004.n;
     |LIBERA #dsorw004;
|FPRC;

|PROCESO InsertaPredeterminado;
     aPredeter2 = aPredeter2 - ":";

     |LEE 101#dsorw003.p;
     |SI FSalida = 0;
         aAlfa = "#" + aPredeter2 + ",!" + (#dsorw003#1 % 299);
         #dsorw003#1 = aAlfa;
         |GRABA 020#dsorw003.a;
         |LIBERA #dsorw003;
     |FINSI;
|FPRC;

|PROCESO IndexaMenu;
     |SI #dsorm003#4 = "S";
         aAbre = aDirGrupo + "ds.txt";
         |XABRE "A", aAbre, nHandle;
         |SI FSalida ] 0;
             aAlfa = #dsorm003#2;
             |XGRABA nHandle, aAlfa;
         |FINSI;
         |XCIERRA nHandle;
         |ACABA;
     |FINSI;

     |ABRE #dsorw003;  |CIERRA #dsorw003;  |DELINDEX #dsorw003;

     nContador90 = 0;
     |SI #dsorm003#1 ! "menugnrl";
         aOrigen     = aBase     + #dsorm003#1 + "/" + #dsorm003#2 + ".men";  |QBT aOrigen;
     |SINO;
         aOrigen     = aBase     + #dsorm003#2 + ".men";  |QBT aOrigen;
     |FINSI;
     aDestino    = aDirGrupo + #dsorm003#2 + ".men";               |QBT aDestino;

     aPredeter1 = "";
     aPredeter2 = "";
     |DBASE aBaseAqui;    |QBF aBaseAqui;
     aMas = aBaseAqui + "def/dsorm003.mas";  |QBT aMas;
     |CARGA_DEF aMas, dsorm003@;

     |ABRE #dsorm003@;
     |SELECT #3#dsorm003@;
     #dsorm003@#0 = #dsorm003#0;
     #dsorm003@#1 = #dsorm003#1;
     #dsorm003@#2 = #dsorm003#2;
     #dsorm003@#4 = "P";
     |LEE 000#dsorm003@.=;
     |SI FSalida = 0;
         aPredeter1 = #dsorm003@#3;
     |FINSI;
     |CIERRA #dsorm003@;
     |DESCARGA_DEF #dsorm003@;

     |ABRE #dsorw003;
     |SELECT #1#dsorw003;
     |XABRE "U", aOrigen, nHandle;
     |SI FSalida ] 0;
         |PARA; |SI; |HACIENDO;
              |XLEE nHandle, 250, aAlfa1;
              |SI FSalida < 0;  |SAL;  |FINSI;

              nContador90 = nContador90 + 1;

              #dsorw003#0       = nContador90;
              #dsorw003#1       = aAlfa1;

              aClaveMenu  = "";
              aNumero     = "";
              aAlfa1      = #dsorw003#1;  |QBF aAlfa1;
              |HAZ CogeHastaDosPuntos;
              |SI aNumero ! "";
                  #dsorw003#2 = aNumero;
              |SINO;
                  #dsorw003#2 = aClaveMenu;
              |FINSI;

              |SI aPredeter1 ! "";
                  aAlfa2 = #dsorw003#1 - aPredeter1;
                  |SI FSalida ! 0;
                      aPredeter2 = aClaveMenu;
                  |FINSI;
              |FINSI;

              |GRABA 020#dsorw003.n;
              |LIBERA #dsorw003;
         |SIGUE;
     |FINSI;
     |XCIERRA nHandle;

     |SI aPredeter2 ! "";
         |HAZ InsertaPredeterminado;
     |FINSI;
|FPRC;

|PROCESO PonAcceso;
     aPrograma = aAlfa3 - "{{";
     |SI FSalida = 0;  aPrograma = "";  |ACABA;  |FINSI;

     aLong     = aAlfa3 % 0;
     nLong     = aLong;
     aPrograma = "";
     nPon      = 0;
     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos          = (nCaracter * 100) + 2;
           aCaracter     = aAlfa3 % nPos;
           |SI aCaracter = "{{";  nPon = 1; |FINSI;

           |SI nPon = 0;
               nPos      = (nCaracter * 100) + 1;
               aCaracter = aAlfa3 % nPos;
               aPrograma = aPrograma + aCaracter;
           |FINSI;
     |SIGUE;

     |SI aPrograma = "";  |ACABA;  |FINSI;

     #dsorw003#1 = aPrograma + " {{:dsoporte/dsorz015}}";
|FPRC;

|PROCESO GeneraMenu;
     |SI aAplicacion ! #dsorm003#1;  |O aMenu ! #dsorm003#2;
         |SI aDestino ! "";
             |XABRE "W", aDestino, nHandle;
             |BUCLE dsorw003;
             |XCIERRA nHandle;

             |SI aAplicacion ! "menugnrl";  |Y aPRM = "S";
                 aAbre   = aDirGrupo + aAplicacion + ".prm";   |QBT aAbre;
                 |XABRE "W", aAbre, nHandle;
                 |SI FSalida ] 0;
                     aAlfa = "-" + (("0000" + nContador91) % -104) + &13 + &10;
                     |XGRABA nHandle, aAlfa;
                     |BUCLE dsorw004A;

                     #dsorw008#0 = nCodResto;
                     #dsorw008#1 = aAplicacion;
                     |LEE 040#dsorw008.=;
                     |SI FSalida ! 0;
                         #dsorw008#0 = nCodResto;
                         #dsorw008#1 = aAplicacion;
                         |GRABA 020#dsorw008.b;
                     |FINSI;
                     #dsorw008#2 = "*";
                     |GRABA 020#dsorw008.a;
                     |LIBERA #dsorw008;
                 |FINSI;
                 |XCIERRA nHandle;
             |FINSI;

             |ABRE #dsorw004;  |CIERRA #dsorw004;  |DELINDEX #dsorw004;
             nContador91 = 0;
             aDestino    = "";
         |FINSI;

         aAplicacion = #dsorm003#1;
         aMenu       = #dsorm003#2;
         aPRM        = #dsorm003#7;
         |HAZ IndexaMenu;
     |FINSI;

     |ABRE #dsorw004;
     |ABRE #dsorw003;
     |SELECT #2#dsorw003;

     |SI #dsorm003#8 = 1;
         aAlfa3 = #dsorm003#3;   |QBF aAlfa3;
         aAlfa2 = #dsorm003#6;   |QBF aAlfa2;
         aAlfa2 = aAlfa2 + ":";
         #dsorw003#2  = aAlfa2;
         |LEE 101#dsorw003.=;
         |SI FSalida = 0;
             |SI #dsorm003#4 ! "P";
                 |BORRA 020#dsorw003.a;
                 |HAZ CogePrograma;
             |FINSI;
             |LIBERA #dsorw003;
         |SINO;
             aAlfa2 = #dsorm003#6;   |QBF aAlfa2;
             #dsorw003#2  = aAlfa2;
             |LEE 101#dsorw003.=;
             |SI FSalida = 0;
                 |SI #dsorm003#4 ! "P";
                     |BORRA 020#dsorw003.a;
                     |HAZ CogePrograma;
                 |FINSI;
             |FINSI;
             |LIBERA #dsorw003;
         |FINSI;
     |FINSI;

     |SI #dsorm003#8 = 2;
         aAlfa3 = #dsorm003#3;   |QBF aAlfa3;
         aAlfa2 = #dsorm003#6;   |QBF aAlfa2;
         aAlfa2 = aAlfa2 + ":";
         #dsorw003#2  = aAlfa2;
         |LEE 101#dsorw003.=;
         |SI FSalida = 0;
             |HAZ CogePrograma;

             aAlfa3 = #dsorw003#1;
             |HAZ PonAcceso;
             |GRABA 020#dsorw003.a;
             |LIBERA #dsorw003;
         |SINO;
             aAlfa2 = #dsorm003#6;   |QBF aAlfa2;
             #dsorw003#2  = aAlfa2;
             |LEE 101#dsorw003.=;
             |SI FSalida = 0;
                 |HAZ CogePrograma;

                 aAlfa3 = #dsorw003#1;
                 |HAZ PonAcceso;
                 |GRABA 020#dsorw003.a;
                 |LIBERA #dsorw003;
             |FINSI;
         |FINSI;
     |FINSI;

     |CIERRA #dsorw003;
     |CIERRA #dsorw004;
|FPRC;

|DEFBUCLE dsorm003;
     #dsorm003#1;
     ;
     nCodMenu, "        ", "        ", aDClave;
     nCodMenu, "zzzzzzzz", "zzzzzzzz", aHClave;
     ;
     NULL, GeneraMenu;
|FIN;

|PROCESO Menus;
     |MENSA "     Generando Menus de Usuarios";

     aOrigen  = "";
     aDestino = "";

     |BUCLE dsorm003;

     |SI aDestino ! "";
         |XABRE "W", aDestino, nHandle;
         |BUCLE dsorw003;
         |XCIERRA nHandle;

         |SI aAplicacion ! "menugnrl";  |Y aPRM = "S";
             aAbre   = aDirGrupo + aAplicacion + ".prm";   |QBT aAbre;
             |XABRE "W", aAbre, nHandle;
             |SI FSalida ] 0;
                 aAlfa = "-" + (("0000" + nContador91) % -104) + &13 + &10;
                 |XGRABA nHandle, aAlfa;

                 #dsorw008#0 = nCodResto;
                 #dsorw008#1 = aAplicacion;
                 |LEE 040#dsorw008.=;
                 |SI FSalida ! 0;
                     #dsorw008#0 = nCodResto;
                     #dsorw008#1 = aAplicacion;
                     |GRABA 020#dsorw008.b;
                 |FINSI;
                 #dsorw008#2 = "*";
                 |GRABA 020#dsorw008.a;
                 |LIBERA #dsorw008;

                 |BUCLE dsorw004A;
             |FINSI;
             |XCIERRA nHandle;
         |FINSI;

         |ABRE #dsorw004;  |CIERRA #dsorw004;  |DELINDEX #dsorw004;

         nContador91 = 0;
         aDestino    = "";
     |FINSI;

     |ABRE #dsorw003; |CIERRA #dsorw003; |DELINDEX #dsorw003;
     |ABRE #dsorw004; |CIERRA #dsorw004; |DELINDEX #dsorw004;
|FPRC;

|| __________________________________________________________________________
||                        PROCESOS TABLAS
|| __________________________________________________________________________

|PROCESO GeneraTabla;
     #dsorw004#0 = #dsorm004#1;
     #dsorw004#1 = 999999;
     |LEE 040#dsorw004.];
     |SI FSalida = 0;
         |LEE 040#dsorw004.a;
     |SINO;
         |LEE 040#dsorw004.u;
     |FINSI;

     nLinea  = 1;
     nNumDef = 1;
     |SI FSalida = 0;  |Y #dsorw004#0 = #dsorm004#1;
         nLinea   = #dsorw004#1 + 1;
         nNumDef  = #dsorw004#3 + 1;
     |FINSI;

     #dsorw004#0 = #dsorm004#1;
     #dsorw004#1 = nLinea;

     aCaracter = "#";

     |SI #dsorm004#4 = " ";  |Y #dsorm004#7 = " ";  |Y #dsorm004#6 = " ";  |Y #dsorm004#5 = "X";
         aCaracter = "@";
     |FINSI;

     |SI #dsorm004#4 = "X";  |Y #dsorm004#7 = " ";  |Y #dsorm004#6 = " ";
         aCaracter = "A";
     |FINSI;

     |SI #dsorm004#4 = " ";  |Y #dsorm004#7 = "X";  |Y #dsorm004#6 = " ";
         aCaracter = "B";
     |FINSI;

     |SI #dsorm004#4 = " ";  |Y #dsorm004#7 = " ";  |Y #dsorm004#6 = "X";
         aCaracter = "C";
     |FINSI;

     |SI #dsorm004#4 = "X";  |Y #dsorm004#7 = "X";  |Y #dsorm004#6 = " ";
         aCaracter = "D";
     |FINSI;

     |SI #dsorm004#4 = "X";  |Y #dsorm004#7 = " ";  |Y #dsorm004#6 = "X";
         aCaracter = "E";
     |FINSI;

     |SI #dsorm004#4 = " ";  |Y #dsorm004#7 = "X";  |Y #dsorm004#6 = "X";
         aCaracter = "F";
     |FINSI;

     aAlfa   = #dsorm004#2 + "-000" + aCaracter + "-000";

     #dsorw004#2 = aAlfa;
     #dsorw004#3 = nNumDef;
     #dsorw004#4 = #dsorm004#2;
     #dsorw004#5 = aCaracter;
     |GRABA 020#dsorw004.n;
     |LIBERA #dsorw004;
|FPRC;

|DEFBUCLE dsorm004;
     #dsorm004#1;
     ;
     nCodMenu, "        ", "        ";
     nCodMenu, "zzzzzzzz", "zzzzzzzz";
     ;
     NULL, GeneraTabla;
|FIN;

|PROCESO Tablas;
     |MENSA "     Generando Restricciones Tablas";

     |BUCLE dsorm004;
|FPRC;

|| __________________________________________________________________________
||                        PROCESOS OCULTACION DE CAMPOS
|| __________________________________________________________________________

|PROCESO GeneraOcultaCampos;
     aCaracter = "#";

     |SELECT #1#dsorw004;
     #dsorw004#0 = #dsorm005#1;
     #dsorw004#1 = 999999;
     |LEE 040#dsorw004.];
     |SI FSalida = 0;
         |LEE 040#dsorw004.a;
     |SINO;
         |LEE 040#dsorw004.u;
     |FINSI;

     nLinea  = 1;
     nNumDef = 0;
     |SI FSalida = 0;  |Y #dsorw004#0 = #dsorm005#1;
         nLinea  = #dsorw004#1 + 1;
         nNumDef = #dsorw004#3;
     |FINSI;

     |DDEFECTO #dsorw004;

     |SELECT #2#dsorw004;
     #dsorw004#0 = #dsorm005#1;
     #dsorw004#4 = #dsorm005#2;
     |LEE 000#dsorw004.=;
     |SI FSalida ! 0;
         |SI aTabla ! #dsorm005#2;  |O aAplicacion ! #dsorm005#1;
             nLineaPrime = nLinea;
             aTabla      = #dsorm005#2;
             aAplicacion = #dsorm005#1;
             nNumDef     = nNumDef + 1;
             aAlfa       = "";
             nContaDef   = 0;

             |SELECT #1#dsorw004;
             |DDEFECTO #dsorw004;
             #dsorw004#0 = #dsorm005#1;
             #dsorw004#1 = nLinea;
             #dsorw004#2 = aAlfa;
             #dsorw004#3 = nNumDef;
             #dsorw004#4 = #dsorm005#2;
             #dsorw004#5 = aCaracter;
             |GRABA 020#dsorw004.n;
             |LIBERA #dsorw004;

             nLinea = nLinea + 1;
        |FINSI;
     |SINO;
        |SI aTabla ! #dsorm005#2;  |O aAplicacion ! #dsorm005#1;
            aTabla      = #dsorm005#2;
            aAplicacion = #dsorm005#1;
            aAlfa       = "";
            nContaDef   = 0;
        |FINSI;

        nLineaPrime = #dsorw004#1;
        aCaracter   = #dsorw004#5;
     |FINSI;

     nContaDef = nContaDef + 1;

     |DDEFECTO #dsorw004;

     |SELECT #1#dsorw004;

     |SI #dsorm005#6 = " ";
         aAlfa     = ("000" + #dsorm005#3) % -103;
     |FINSI;

     |SI #dsorm005#6 = "A";
         aAlfa     = (("000" + #dsorm005#3) % -103) + "#";
     |FINSI;

     |SI #dsorm005#6 = "C";
         aAlfa     = (("000" + #dsorm005#3) % -103) + "@";
     |FINSI;

     #dsorw004#0     = #dsorm005#1;
     #dsorw004#1     = nLinea;
     #dsorw004#2     = aAlfa;
     #dsorw004#3     = nNumDef;
     #dsorw004#4     = #dsorm005#2;
     |GRABA 020#dsorw004.n;
     |LIBERA #dsorw004;

     #dsorw004#0     = #dsorm005#1;
     #dsorw004#1     = nLineaPrime;
     |LEE 101#dsorw004.=;
     |SI FSalida = 0;
         aAlfa = #dsorm005#2 + "-" + (("000" + nContaDef) % -103) + aCaracter + "-000";
         #dsorw004#2 = aAlfa;
         |GRABA 020#dsorw004.a;
     |FINSI;
     |LIBERA #dsorw004;
|FPRC;

|DEFBUCLE dsorm005;
     #dsorm005#1;
     ;
     nCodResto, "        ", "        ", 000;
     nCodResto, "zzzzzzzz", "zzzzzzzz", 999;
     ;
     NULL, GeneraOcultaCampos;
|FIN;

|PROCESO OcultaCampos;
     |MENSA "     Generando Ocultacion de Campos";

     aTabla      = "";
     aAplicacion = "";
     |BUCLE dsorm005;
|FPRC;

|| __________________________________________________________________________
||                        PROCESOS FILTROS CAMPOSO
|| __________________________________________________________________________

|PROCESO CampoCompuesto;
     aCampo = aCampo + (("000" + #dsorm007#4) % -103);
|FPRC;

|DEFBUCLE dsorm007;
     #dsorm007#1;
     ;
     #dsorm006#0, #dsorm006#1, #dsorm006#2, #dsorm006#3, 000;
     #dsorm006#0, #dsorm006#1, #dsorm006#2, #dsorm006#3, 999;
     ;
     NULL, CampoCompuesto;
|FIN;

|PROCESO GeneraRelacionCampos;
     |SI nGeneracion = 0;
         #dsorm008#10 = " ";
         |GRABA 020#dsorm008.a;
         |LIBERA #dsorm008;
         |ACABA;
     |FINSI;

     |SI #dsorm008#10 = "X";  |ACABA;  |FINSI;

     |SI aDTabla = "";
         aCaracter = "#";

         |SI #dsorm008#6 = " ";  |Y #dsorm008#9 = " ";  |Y #dsorm008#8 = " ";  |Y #dsorm008#7 = "X";
             aCaracter = "@";
         |FINSI;

         |SI #dsorm008#6 = "X";  |Y #dsorm008#9 = " ";  |Y #dsorm008#8 = " ";
             aCaracter = "A";
         |FINSI;

         |SI #dsorm008#6 = " ";  |Y #dsorm008#9 = "X";  |Y #dsorm008#8 = " ";
             aCaracter = "B";
         |FINSI;

         |SI #dsorm008#6 = " ";  |Y #dsorm008#9 = " ";  |Y #dsorm008#8 = "X";
             aCaracter = "C";
         |FINSI;

         |SI #dsorm008#6 = "X";  |Y #dsorm008#9 = "X";  |Y #dsorm008#8 = " ";
             aCaracter = "D";
         |FINSI;

         |SI #dsorm008#6 = "X";  |Y #dsorm008#9 = " ";  |Y #dsorm008#8 = "X";
             aCaracter = "E";
         |FINSI;

         |SI #dsorm008#6 = " ";  |Y #dsorm008#9 = "X";  |Y #dsorm008#8 = "X";
             aCaracter = "F";
         |FINSI;
     |FINSI;

     #dsorw004#0 = #dsorm008#1;
     #dsorw004#1 = 999999;
     |LEE 040#dsorw004.];
     |SI FSalida = 0;
         |LEE 040#dsorw004.a;
     |SINO;
         |LEE 040#dsorw004.u;
     |FINSI;

     nLinea  = 1;
     nNumDef = 0;
     |SI FSalida = 0;  |Y #dsorw004#0 = #dsorm008#1;
         nLinea  = #dsorw004#1;
         nNumDef = #dsorw004#3;
     |FINSI;

     |DDEFECTO #dsorw004;

     nLinea      = nLinea + 1;
     nNumDef     = nNumDef + 1;
     aAlfa       = #dsorm008#3 + "+001" + aCaracter + "-000";
     #dsorw004#0       = #dsorm008#1;
     #dsorw004#1       = nLinea;
     #dsorw004#2       = aAlfa;
     #dsorw004#3       = nNumDef;
     nLineaPrime = nLinea;
     nContaDef   = 1;
     |GRABA 020#dsorw004.n;
     |LIBERA #dsorw004;

     nLinea    = nLinea + 1;
     aAlfa     = "-" + (("00" + #dsorm008#5) % -102);
     #dsorw004#0     = #dsorm008#1;
     #dsorw004#1     = nLinea;
     #dsorw004#2     = aAlfa;
     #dsorw004#3     = nNumDef;
     |GRABA 020#dsorw004.n;
     |LIBERA #dsorw004;

     #dsorm008#10 = "X";
     |GRABA 020#dsorm008.a;
     |LIBERA #dsorm008;

     aTabla       = #dsorm008#3;
     aAplicacion  = #dsorm006#1;
     aCondicion   = #dsorm006#14;
|FPRC;

|DEFBUCLE dsorm008;
     #dsorm008#1;
     ;
     nCodResto, aDAplica, "        ", aDTabla;
     nCodResto, aHAplica, "zzzzzzzz", aHTabla;
     be;
     NULL, GeneraRelacionCampos;
|FIN;

|PROCESO LeeCampo;
     |DBASS aBase;    |QBF aBase;
     aMas = aBase + aAplicacion + "/def/" + aTabla + ".mas";  |QBT aMas;
     |CARGA_DEF aMas, referen@;
     |SI FSalida ! 0;
         |MENAV "     No existe la Tabla";
         |ERROR;
         |ACABA;
     |FINSI;

     aQueQuiero = "|C" + aCampo + "TIPO";
     aTipo      = #referen@#aQueQuiero#;

     aLongitud = "";

     |SI aTipo = "A";
         aQueQuiero = "|C" + aCampo + "LONGITUD";
         aLongitud  = #referen@#aQueQuiero#;
     |FINSI;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO DesgloseCampos;
     aAlfa1    = #dsorm006#12;  |QBF aAlfa1;
     aAlfa2    = #dsorm006#13;  |QBF aAlfa2;

     |SI #dsorm006#8 = "N";
         aCampo = ("000" + #dsorm006#9) % -103;
     |SINO;
         aCampo = "";
         |BUCLE dsorm007;
     |FINSI;

     |HAZ LeeCampo;
     |SI aLongitud ! "";
         nLongitud = aLongitud;
         nPos      = 100 + nLongitud;
         aAlfa1    = (aAlfa1 + (" " * nLongitud)) % nPos;
         aAlfa2    = (aAlfa2 + (" " * nLongitud)) % nPos;
     |FINSI;

     |SI #dsorm006#11 = "=";  |O #dsorm006#11 = "!";
         nLinea    = nLinea + 1;
         nContaDef = nContaDef + 1;
         aAlfa     = aCampo + #dsorm006#11 + &34 + aAlfa1 + &34;
         #dsorw004#0     = #dsorm006#1;
         #dsorw004#1     = nLinea;
         #dsorw004#2     = aAlfa;
         #dsorw004#3     = nNumDef;
         |GRABA 020#dsorw004.n;
         |LIBERA #dsorw004;
     |SINO;
         |SI #dsorm006#11 = "[";
             aDCaracter = "]";
             aHCaracter = "[";
         |SINO;
             aDCaracter = ">";
             aHCaracter = "<";
         |FINSI;

         nLinea    = nLinea + 1;
         nContaDef = nContaDef + 1;
         aAlfa     = aCampo + aDCaracter + &34 + aAlfa1 + &34;
         #dsorw004#0     = #dsorm006#1;
         #dsorw004#1     = nLinea;
         #dsorw004#2     = aAlfa;
         #dsorw004#3     = nNumDef;
         |GRABA 020#dsorw004.n;
         |LIBERA #dsorw004;

         nLinea    = nLinea + 1;
         nContaDef = nContaDef + 1;
         aAlfa     = aCampo + aHCaracter + &34 + aAlfa2 + &34;
         #dsorw004#0     = #dsorm006#1;
         #dsorw004#1     = nLinea;
         #dsorw004#2     = aAlfa;
         #dsorw004#3     = nNumDef;
         |GRABA 020#dsorw004.n;
         |LIBERA #dsorw004;
     |FINSI;
|FPRC;

|PROCESO GeneraFiltrosCampos;
     aAlfa = #dsorm006#12;  |QBF aAlfa;
     |SI aAlfa = "%1"; #dsorm006#12 = aCodDepar;     |FINSI;
     |SI aAlfa = "%2"; #dsorm006#12 = aCodSubDepar;  |FINSI;
     |SI aAlfa = "%3"; #dsorm006#12 = aCodSerie;     |FINSI;
     |SI aAlfa = "%4"; #dsorm006#12 = aCodAlmacen;   |FINSI;
     |SI aAlfa = "%5"; #dsorm006#12 = aCodZona;      |FINSI;
     |SI aAlfa = "%6"; #dsorm006#12 = aCodFactura;   |FINSI;

     aAlfa = #dsorm006#13;  |QBF aAlfa;
     |SI aAlfa = "%1"; #dsorm006#13 = aCodDepar;     |FINSI;
     |SI aAlfa = "%2"; #dsorm006#13 = aCodSubDepar;  |FINSI;
     |SI aAlfa = "%3"; #dsorm006#13 = aCodSerie;     |FINSI;
     |SI aAlfa = "%4"; #dsorm006#13 = aCodAlmacen;   |FINSI;
     |SI aAlfa = "%5"; #dsorm006#13 = aCodZona;      |FINSI;
     |SI aAlfa = "%6"; #dsorm006#13 = aCodFactura;   |FINSI;

     aCaracter = "#";

     |SI #dsorm006#15 = " ";  |Y #dsorm006#18 = " ";  |Y #dsorm006#17 = " ";  |Y #dsorm006#16 = "X";
         aCaracter = "@";
     |FINSI;

     |SI #dsorm006#15 = "X";  |Y #dsorm006#18 = " ";  |Y #dsorm006#17 = " ";
         aCaracter = "A";
     |FINSI;

     |SI #dsorm006#15 = " ";  |Y #dsorm006#18 = "X";  |Y #dsorm006#17 = " ";
         aCaracter = "B";
     |FINSI;

     |SI #dsorm006#15 = " ";  |Y #dsorm006#18 = " ";  |Y #dsorm006#17 = "X";
         aCaracter = "C";
     |FINSI;

     |SI #dsorm006#15 = "X";  |Y #dsorm006#18 = "X";  |Y #dsorm006#17 = " ";
         aCaracter = "D";
     |FINSI;

     |SI #dsorm006#15 = "X";  |Y #dsorm006#18 = " ";  |Y #dsorm006#17 = "X";
         aCaracter = "E";
     |FINSI;

     |SI #dsorm006#15 = " ";  |Y #dsorm006#18 = "X";  |Y #dsorm006#17 = "X";
         aCaracter = "F";
     |FINSI;

     |SI #dsorm006#14 = "S";  aCondicion = "";  |FINSI;

     aDTabla  = #dsorm006#2;
     aHTabla  = #dsorm006#2;
     aDAplica = #dsorm006#1;
     aHAplica = #dsorm006#1;
     |BUCLE dsorm008;

     #dsorw004#0 = #dsorm006#1;
     #dsorw004#1 = 999999;
     |LEE 040#dsorw004.];
     |SI FSalida = 0;
         |LEE 040#dsorw004.a;
     |SINO;
         |LEE 040#dsorw004.u;
     |FINSI;

     nLinea  = 1;
     nNumDef = 0;
     |SI FSalida = 0;  |Y #dsorw004#0 = #dsorm006#1;
         nLinea  = #dsorw004#1;
         nNumDef = #dsorw004#3;
     |FINSI;

     |DDEFECTO #dsorw004;
     |SI aTabla ! #dsorm006#2; |O aCondicion ! #dsorm006#14;  |O aAplicacion ! #dsorm006#1;
         nLineaPrime  = nLinea + 1;
         aTabla       = #dsorm006#2;
         aAplicacion  = #dsorm006#1;
         aCondicion   = #dsorm006#14;
         nLinea       = nLinea + 1;
         nNumDef      = nNumDef + 1;
         aAlfa        = "";
         nContaDef    = 0;

         #dsorw004#0 = #dsorm006#1;
         #dsorw004#1 = nLinea;
         #dsorw004#2 = aAlfa;
         #dsorw004#3 = nNumDef;
         |GRABA 020#dsorw004.n;
         |LIBERA #dsorw004;
     |FINSI;

     |HAZ DesgloseCampos;

     #dsorw004#0     = #dsorm006#1;
     #dsorw004#1     = nLineaPrime;
     |LEE 101#dsorw004.=;
     |SI FSalida = 0;
         aAlfa = #dsorm006#2 + "+" + (("000" + nContaDef) % -103) + aCaracter + "-000";
         #dsorw004#2 = aAlfa;
         |GRABA 020#dsorw004.a;
     |FINSI;
     |LIBERA #dsorw004;
|FPRC;

|DEFBUCLE dsorm006;
     #dsorm006#1;
     ;
     nCod6, "        ", "        ", 001;
     nCod6, "zzzzzzzz", "zzzzzzzz", 999;
     ;
     NULL, GeneraFiltrosCampos;
|FIN;

|PROCESO FiltrosCamposG;
     nCod6  = nCodResto;

     |ABRE #dsorm006;
     #dsorm006#0 = 1;
     #dsorm006#1 = "";
     #dsorm006#2 = "";
     #dsorm006#3 = 1;
     |LEE 000#dsorm006.];
     |SI FSalida = 0;  |Y #dsorm006#0 ! 8888;
         nCod6  = nCodMenu;
     |FINSI;
     |CIERRA #dsorm006;

     |MENSA "     Generando Filtracion de Campos General";

     nGeneracion = 0;
     aDAplica    = "";
     aHAplica    = "zzzzzzzz";
     aDTabla     = "";
     aHTabla     = "zzzzzzzz";
     |BUCLE dsorm008;

     nGeneracion = 1;
     aCondicion  = "";
     aTabla      = "";
     aAplicacion = "";
     |BUCLE dsorm006;

     aDAplica    = "";
     aHAplica    = "zzzzzzzz";
     aDTabla     = "";
     aHTabla     = "zzzzzzzz";
     aTabla      = "";
     aAplicacion = "";
     |BUCLE dsorm008;
|FPRC;

|PROCESO DesgloseCamposP;
     aAlfa1    = #dsorm010#7;  |QBF aAlfa1;
     aAlfa2    = #dsorm010#8;  |QBF aAlfa2;

     aCampo = ("000" + #dsorm010#3) % -103;

     |HAZ LeeCampo;
     |SI aLongitud ! "";
         nLongitud = aLongitud;
         nPos      = 100 + nLongitud;
         aAlfa1    = (aAlfa1 + (" " * nLongitud)) % nPos;
         aAlfa2    = (aAlfa2 + (" " * nLongitud)) % nPos;
     |FINSI;

     |SI #dsorm010#6 = "=";  |O #dsorm010#6 = "!";
         nLinea    = nLinea + 1;
         nContaDef = nContaDef + 1;
         aAlfa     = aCampo + #dsorm010#6 + &34 + aAlfa1 + &34;
         #dsorw004#0     = #dsorm010#1;
         #dsorw004#1     = nLinea;
         #dsorw004#2     = aAlfa;
         #dsorw004#3     = nNumDef;
         |GRABA 020#dsorw004.n;
         |LIBERA #dsorw004;
     |SINO;
         |SI #dsorm010#6 = "[";
             aDCaracter = "]";
             aHCaracter = "[";
         |SINO;
             aDCaracter = ">";
             aHCaracter = "<";
         |FINSI;

         nLinea    = nLinea + 1;
         nContaDef = nContaDef + 1;
         aAlfa     = aCampo + aDCaracter + &34 + aAlfa1 + &34;
         #dsorw004#0     = #dsorm010#1;
         #dsorw004#1     = nLinea;
         #dsorw004#2     = aAlfa;
         #dsorw004#3     = nNumDef;
         |GRABA 020#dsorw004.n;
         |LIBERA #dsorw004;

         nLinea    = nLinea + 1;
         nContaDef = nContaDef + 1;
         aAlfa     = aCampo + aHCaracter + &34 + aAlfa2 + &34;
         #dsorw004#0     = #dsorm010#1;
         #dsorw004#1     = nLinea;
         #dsorw004#2     = aAlfa;
         #dsorw004#3     = nNumDef;
         |GRABA 020#dsorw004.n;
         |LIBERA #dsorw004;
     |FINSI;
|FPRC;

|PROCESO GeneraFiltrosCamposP;
     aCaracter = "#";

     |SI #dsorm009#8 = " ";  |Y #dsorm009#11 = " ";  |Y #dsorm009#10 = " ";  |Y #dsorm009#9 = "X";
         aCaracter = "@";
     |FINSI;

     |SI #dsorm009#8 = "X";  |Y #dsorm009#11 = " ";  |Y #dsorm009#10 = " ";
         aCaracter = "A";
     |FINSI;

     |SI #dsorm009#8 = " ";  |Y #dsorm009#11 = "X";  |Y #dsorm009#10 = " ";
         aCaracter = "B";
     |FINSI;

     |SI #dsorm009#8 = " ";  |Y #dsorm009#11 = " ";  |Y #dsorm009#10 = "X";
         aCaracter = "C";
     |FINSI;

     |SI #dsorm009#8 = "X";  |Y #dsorm009#11 = "X";  |Y #dsorm009#10 = " ";
         aCaracter = "D";
     |FINSI;

     |SI #dsorm009#8 = "X";  |Y #dsorm009#11 = " ";  |Y #dsorm009#10 = "X";
         aCaracter = "E";
     |FINSI;

     |SI #dsorm009#8 = " ";  |Y #dsorm009#11 = "X";  |Y #dsorm009#10 = "X";
         aCaracter = "F";
     |FINSI;

     |SI #dsorm010#9 = "S";  aCondicion = "";  |FINSI;

     #dsorw004#0 = #dsorm009#1;
     #dsorw004#1 = 999999;
     |LEE 040#dsorw004.];
     |SI FSalida = 0;
         |LEE 040#dsorw004.a;
     |SINO;
         |LEE 040#dsorw004.u;
     |FINSI;

     nLinea  = 1;
     nNumDef = 0;
     |SI FSalida = 0;  |Y #dsorw004#0 = #dsorm009#1;
         nLinea  = #dsorw004#1;
         nNumDef = #dsorw004#3;
     |FINSI;

     |DDEFECTO #dsorw004;
     |SI aTabla ! #dsorm009#2; |O aCondicion ! #dsorm010#9;  |O aAplicacion ! #dsorm009#1;
      |O nCampo ! #dsorm009#3;
         nLineaPrime  = nLinea + 1;
         aTabla       = #dsorm009#2;
         aAplicacion  = #dsorm009#1;
         aCondicion   = #dsorm010#9;
         nCampo       = #dsorm009#3;
         nLinea       = nLinea + 1;
         nNumDef      = nNumDef + 1;
         aAlfa        = "";
         nContaDef    = 0;

         #dsorw004#0 = #dsorm009#1;
         #dsorw004#1 = nLinea;
         #dsorw004#2 = aAlfa;
         #dsorw004#3 = nNumDef;
         |GRABA 020#dsorw004.n;
         |LIBERA #dsorw004;
     |FINSI;

     |HAZ DesgloseCamposP;

     #dsorw004#0     = #dsorm009#1;
     #dsorw004#1     = nLineaPrime;
     |LEE 101#dsorw004.=;
     |SI FSalida = 0;
         aAlfa = #dsorm009#2 + "+" + (("000" + nContaDef) % -103) + aCaracter + "*" + (("000" + #dsorm009#3) % -103);
         #dsorw004#2 = aAlfa;
         |GRABA 020#dsorw004.a;
     |FINSI;
     |LIBERA #dsorw004;
|FPRC;

|DEFBUCLE dsorm010;
     #dsorm010#1;
     ;
     #dsorm009#0, #dsorm009#1, #dsorm009#2, #dsorm009#3, 001;
     #dsorm009#0, #dsorm009#1, #dsorm009#2, #dsorm009#3, 999;
     ;
     NULL, GeneraFiltrosCamposP;
|FIN;

|PROCESO GeneraFiltrosPrograma;
     aCondicion  = "";
     aTabla      = "";
     aAplicacion = "";
     nCampo      = 0;
     |BUCLE dsorm010;
|FPRC;

|DEFBUCLE dsorm009;
     #dsorm009#1;
     ;
     nCodResto, "        ", "        ", 000;
     nCodResto, "zzzzzzzz", "zzzzzzzz", 999;
     ;
     NULL, GeneraFiltrosPrograma;
|FIN;

|PROCESO FiltrosCamposP;
     |MENSA "     Generando Filtracion de Campos Programa";

     |BUCLE dsorm009;
|FPRC;

|| __________________________________________________________________________
||                        PROCESOS GRABAPRM
|| __________________________________________________________________________

|PROCESO MiraAplicacionesPRM;
     |SI aAplicacion ! #dsorw004#0;
         |SI aAbre ! "";
             |XCIERRA nHandle;
         |FINSI;

         |SALVA_DATOS #dsorw004;
         aAplicacion = #dsorw004#0;
         |SELECT #1#dsorw004;
         #dsorw004#0 = aAplicacion;
         #dsorw004#1 = 999999;
         |LEE 040#dsorw004.];
         |SI FSalida = 0;
             |LEE 040#dsorw004.a;
         |SINO;
             |LEE 040#dsorw004.u;
         |FINSI;
         |SI FSalida = 0;  |Y #dsorw004#0 = aAplicacion;
             nNumDef = #dsorw004#3;
         |FINSI;
         |REPON_DATOS #dsorw004;

         |SELECT #3#dsorw004;
         |LEE 040#dsorw004.=;

         aAbre       = aDirGrupo + aAplicacion + ".prm";   |QBT aAbre;
         |XABRE "A", aAbre, nHandle;

         #dsorw008#0 = nCodResto;
         #dsorw008#1 = aAplicacion;
         |LEE 101#dsorw008.=;
         |SI FSalida ! 0;
             aAlfa = "-0000" + &13 + &10;
             |XGRABA nHandle, aAlfa;

             #dsorw008#0 = nCodResto;
             #dsorw008#1 = aAplicacion;
             #dsorw008#2 = " *";
             |GRABA 020#dsorw008.n;
         |SINO;
             #dsorw008#2 = "**";
             |GRABA 020#dsorw008.a;
         |FINSI;
         |LIBERA #dsorw008;

         aAlfa = "-" + (("0000" + nNumDef) % -104) + &13 + &10;
         |XGRABA nHandle, aAlfa;
     |FINSI;

     aAlfa = #dsorw004#2;  |QBF aAlfa;
     |XGRABA nHandle, aAlfa;
|FPRC;

|DEFBUCLE dsorw004B;
     #dsorw004#3;
     ;
     INICIO;
     FINAL;
     ;
     NULL, MiraAplicacionesPRM;
|FIN;

|PROCESO GrabaPRM;
     aAplicacion = "";
     aAbre       = "";
     |BUCLE dsorw004B;
     |SI aAbre ! "";
         |XCIERRA nHandle;
     |FINSI;
|FPRC;

|PROCESO Filtros;
     |ABRE #dsorw004;
     |HAZ Tablas;
     |HAZ FiltrosCamposG;
     |HAZ FiltrosCamposP;
     |HAZ OcultaCampos;
     |CIERRA #dsorw004;

     |HAZ GrabaPRM;

     |ABRE #dsorw003;  |CIERRA #dsorw003;  |DELINDEX #dsorw003;
     |ABRE #dsorw004;  |CIERRA #dsorw004;  |DELINDEX #dsorw004;
|FPRC;

|PROCESO dsorm011;
     aCaracter = "#";

     |SI #dsorm011#6 = " ";  |Y #dsorm011#9 = " ";
      |Y #dsorm011#8 = " ";  |Y #dsorm011#7 = "X";
         aCaracter = "@";
     |FINSI;

     |SI #dsorm011#6 = "X";  |Y #dsorm011#9 = " ";  |Y #dsorm011#8 = " ";
         aCaracter = "A";
     |FINSI;

     |SI #dsorm011#6 = " ";  |Y #dsorm011#9 = "X";  |Y #dsorm011#8 = " ";
         aCaracter = "B";
     |FINSI;

     |SI #dsorm011#6 = " ";  |Y #dsorm011#9 = " ";  |Y #dsorm011#8 = "X";
         aCaracter = "C";
     |FINSI;

     |SI #dsorm011#6 = "X";  |Y #dsorm011#9 = "X";  |Y #dsorm011#8 = " ";
         aCaracter = "D";
     |FINSI;

     |SI #dsorm011#6 = "X";  |Y #dsorm011#9 = " ";  |Y #dsorm011#8 = "X";
         aCaracter = "E";
     |FINSI;

     |SI #dsorm011#6 = " ";  |Y #dsorm011#9 = "X";  |Y #dsorm011#8 = "X";
         aCaracter = "F";
     |FINSI;

     #dsorw004#0 = #dsorm011#1;
     #dsorw004#1 = 999999;
     |LEE 040#dsorw004.];
     |SI FSalida = 0;
         |LEE 040#dsorw004.a;
     |SINO;
         |LEE 040#dsorw004.u;
     |FINSI;

     nLinea  = 1;
     nNumDef = 0;
     |SI FSalida = 0;  |Y #dsorw004#0 = #dsorm011#1;
         nLinea  = #dsorw004#1;
         nNumDef = #dsorw004#3;
     |FINSI;

     |DDEFECTO #dsorw004;
     |SI aAplicacion ! #dsorm011#1;
         aAplicacion  = #dsorm011#1;
         nNumDef      = 0;
         nLinea       = 1;
         aAlfa        = "";

         #dsorw004#0 = #dsorm011#1;
         #dsorw004#1 = nLinea;
         #dsorw004#2 = aAlfa;
         #dsorw004#3 = nNumDef;
         |GRABA 020#dsorw004.n;
         |LIBERA #dsorw004;
     |FINSI;

     |DDEFECTO #dsorw004;
     #dsorw004#0  = #dsorm011#1;
     #dsorw004#1  = nLinea + 1;
     aAlfa  = aCaracter + #dsorm011#2;
     #dsorw004#2  = aAlfa;
     #dsorw004#3  = nNumDef + 1;
     |GRABA 020#dsorw004.n;
     |LIBERA #dsorw004;

     #dsorw004#0     = #dsorm011#1;
     #dsorw004#1     = 1;
     |LEE 101#dsorw004.=;
     |SI FSalida = 0;
         aAlfa = "-" + (("0000" + #dsorw004#3) % -104);
         #dsorw004#2 = aAlfa;
         |GRABA 020#dsorw004.a;
     |FINSI;
     |LIBERA #dsorw004;
|FPRC;

|DEFBUCLE dsorm011;
     #dsorm011#1;
     ;
     nCodResto, "        ", "               ";
     nCodResto, "zzzzzzzz", "zzzzzzzzzzzzzzz";
     ;
     NULL, dsorm011;
|FIN;

|PROCESO dsorw004C;
     |SI aAplicacion ! #dsorw004#0;
         |SI aAbre ! "";
             |XCIERRA nHandle;
         |FINSI;

         |SALVA_DATOS #dsorw004;
         aAplicacion = #dsorw004#0;
         #dsorw004#0 = aAplicacion;
         #dsorw004#1 = 999999;
         |LEE 040#dsorw004.];
         |SI FSalida = 0;
             |LEE 040#dsorw004.a;
         |SINO;
             |LEE 040#dsorw004.u;
         |FINSI;
         |SI FSalida = 0;  |Y #dsorw004#0 = aAplicacion;
             nNumDef = #dsorw004#3;
         |FINSI;

         |REPON_DATOS #dsorw004;
         |LEE 040#dsorw004.=;

         aAbre       = aDirGrupo + aAplicacion + ".prm";   |QBT aAbre;
         |XABRE "AB", aAbre, nHandle;

         #dsorw008#0 = nCodResto;
         #dsorw008#1 = aAplicacion;
         |LEE 000#dsorw008.=;
         |SI FSalida ! 0;
             aAlfa = "-0000" + &13 + &10;
             |XGRABA nHandle, aAlfa;

             aAlfa = "-0000" + &13 + &10;
             |XGRABA nHandle, aAlfa;
         |SINO;
             aAlfa = #dsorw008#2;  |QBF aAlfa;
             |SI aAlfa = "*";
                 aAlfa = "-0000" + &13 + &10;
                 |XGRABA nHandle, aAlfa;
             |FINSI;
         |FINSI;

         aAlfa = "-" + (("0000" + nNumDef) % -104) + &13 + &10;
         |XGRABA nHandle, aAlfa;
     |SINO;
         aAlfa = #dsorw004#2;  |QBF aAlfa;
         aAlfa = (aAlfa + (" " * 16)) % 116;
         aAlfa = aAlfa + &13 + &10;
         |XGRABA nHandle, aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE dsorw004C;
     #dsorw004#1;
     ;
     "        ", 000001;
     "zzzzzzzz", 999999;
     ;
     NULL, dsorw004C;
|FIN;

|PROCESO GrabaPRMEmpresas;
     aAplicacion = "";
     aAbre       = "";
     |BUCLE dsorw004C;
     |SI aAbre ! "";
         |XCIERRA nHandle;
     |FINSI;
|FPRC;

|PROCESO FiltrosEmpresas;
     |ABRE #dsorw004;
     aAplicacion = "";
     |BUCLE dsorm011;
     |CIERRA #dsorw004;

     |HAZ GrabaPRMEmpresas;

     |ABRE #dsorw004;  |CIERRA #dsorw004;  |DELINDEX #dsorw004;
|FPRC;

|| __________________________________________________________________________
||              PROCESO QUE REPARTE SE LLEVA LA MEJOR PARTE
|| __________________________________________________________________________

|PROCESO dsorm006B;
     |BORRA 020#dsorm006.a;
     |LIBERA #dsorm006;
|FPRC;

|DEFBUCLE dsorm006B;
     #dsorm006#1;
     ;
     8888, "        ", "        ", 001;
     8888, "zzzzzzzz", "zzzzzzzz", 999;
     ;
     NULL, dsorm006B;
|FIN;

|| ********************************
|| P E R F I L E S
|| ********************************

|PROCESO dsorm006M;
     |SALVA_DATOS #dsorm006;

     #dsorm006#0 = 8888;

     aAlfa = #dsorm006#12;  |QBF aAlfa;
     |SI aAlfa = "%1"; #dsorm006#12 = aCodDepar;     |FINSI;
     |SI aAlfa = "%2"; #dsorm006#12 = aCodSubDepar;  |FINSI;
     |SI aAlfa = "%3"; #dsorm006#12 = aCodSerie;     |FINSI;
     |SI aAlfa = "%4"; #dsorm006#12 = aCodAlmacen;   |FINSI;
     |SI aAlfa = "%5"; #dsorm006#12 = aCodZona;      |FINSI;
     |SI aAlfa = "%6"; #dsorm006#12 = aCodFactura;   |FINSI;

     aAlfa = #dsorm006#13;  |QBF aAlfa;
     |SI aAlfa = "%1"; #dsorm006#13 = aCodDepar;     |FINSI;
     |SI aAlfa = "%2"; #dsorm006#13 = aCodSubDepar;  |FINSI;
     |SI aAlfa = "%3"; #dsorm006#13 = aCodSerie;     |FINSI;
     |SI aAlfa = "%4"; #dsorm006#13 = aCodAlmacen;   |FINSI;
     |SI aAlfa = "%5"; #dsorm006#13 = aCodZona;      |FINSI;
     |SI aAlfa = "%6"; #dsorm006#13 = aCodFactura;   |FINSI;

     |GRABA 020#dsorm006.n;
     |LIBERA #dsorm006;

     |REPON_DATOS #dsorm006;
     |LEE 040#dsorm006.=;
|FPRC;

|DEFBUCLE dsorm006M;
     #dsorm006#1;
     ;
     0000, "        ", "        ", 001;
     0000, "zzzzzzzz", "zzzzzzzz", 999;
     ;
     NULL, dsorm006M;
|FIN;

|PROCESO Convierte;
     |BUCLE dsorm006B;
     |BUCLE dsorm006M;
|FPRC;

|PROCESO Perfiles;
     |DBASE aBaseAqui;    |QBF aBaseAqui;
     aMas = aBaseAqui + "def/dsprem03.mas";  |QBT aMas;
     |CARGA_DEF aMas, preemes@;

     |ABRE #preemes@;
     |SELECT #2#preemes@;
     #preemes@#11 = #dsorz005#0;
     |LEE 040#preemes@.=;
     |SI FSalida ! 0;
         |DESCARGA_DEF #preemes@;
         |ACABA;
     |FINSI;
     |CIERRA #preemes@;

     nCodMenu     = (#preemes@#3 * 100) + #preemes@#4;
     nCodRegion   = #preemes@#0;
     nCodDele     = #preemes@#1;
     nCodAgencia  = #preemes@#2;

     |DESCARGA_DEF #preemes@;

     |DBASE aBaseAqui;    |QBF aBaseAqui;
     aMas = aBaseAqui + "def/dsprem02.mas";  |QBT aMas;
     |CARGA_DEF aMas, preemes@;

     |ABRE #preemes@;
     #preemes@#0 = nCodRegion;
     #preemes@#1 = nCodDele;
     #preemes@#2 = nCodAgencia;
     |LEE 040#preemes@.=;
     |SI FSalida ! 0;
         |DESCARGA_DEF #preemes@;
         |ACABA;
     |FINSI;
     |CIERRA #preemes@;

     nCodResto    = #preemes@#4;
     aCodDepar    = #preemes@#13;
     aCodSubDepar = #preemes@#14;
     aCodSerie    = #preemes@#17;
     aCodAlmacen  = #preemes@#18;
     aCodZona     = #preemes@#19;
     aCodFactura  = ("00000" + #preemes@#16) % -105;

     |DESCARGA_DEF #preemes@;

     |DBASS aBaseChek;    |QBF aBaseChek;
     aBaseChek = aBaseChek + "gecochek/";
     aMas = aBaseChek + "def/gecom011.mas";  |QBT aMas;
     |CARGA_DEF aMas, gecom011@;
     |SI FSalida = 0;
         aFic = aBaseChek + "fich/";
         |PATH_DAT #gecom011@#aFic#;

         aAlfa   = aCodFactura % 202;

         |ABRE #gecom011@;
         |SELECT #3#gecom011@;
         #gecom011@#1 = aAlfa;
         |LEE 000#gecom011@.=;
         |SI FSalida = 0;  |Y #gecom011@#19 = "S";
             aCodFactura  = ("00000" + #gecom011@#0) % -105;
         |FINSI;
         |CIERRA #gecom011@;

         |DESCARGA_DEF #gecom011@;
     |FINSI;

     |HAZ Convierte;
|FPRC;

|| ********************************
|| A U D I T O R E S
|| ********************************

|PROCESO dsorm006F;
     |SI aAplicacion = #dsorm006#1;  |Y #dsorm006#2 = aTabla;
         |ACABA;
     |FINSI;

     aAlfa = #dsorm006#12;  |QBF aAlfa;
     |SI aAlfa = "%6";
         #dsorm006#12 = aCodFactura;
         |GRABA 020#dsorm006.a;
         |LIBERA #dsorm006;

         aAplicacion = #dsorm006#1;
         aTabla      = #dsorm006#2;
     |FINSI;
|FPRC;

|DEFBUCLE dsorm006F;
     #dsorm006#1;
     ;
     8888, "        ", "        ", 001;
     8888, "zzzzzzzz", "zzzzzzzz", 999;
     be;
     NULL, dsorm006F;
|FIN;

|PROCESO gecom004;
     |SI nPasada   = 0;
         nEmpresas = nEmpresas + 1;
         |ACABA;
     |FINSI;

     #gecom011@#0 = #gecom004@#1;
     |LEE 000#gecom011@.=;
     |SI FSalida ! 0;  |DDEFECTO #gecom011@;  |FINSI;

     aCodFactura  = nGrupo + (("00"  + #gecom011@#1) % -102) + "01";
     |SI #gecom011@#19 = "S";
         aCodFactura  = ("00000" + #gecom011@#0) % -105;
     |FINSI;

     aAplicacion  = "";
     aTabla       = "";
     |BUCLE dsorm006F;
|FPRC;

|DEFBUCLE gecom004;
     #gecom004@#1002;
     ;
     nAuditor, 00001;
     nAuditor, 99999;
     ;
     NULL, gecom004;
|FIN;

|PROCESO dsorm006A;
     aAlfa = #dsorm006#12;  |QBF aAlfa;  |SI aAlfa ! "%6";  |ACABA;  |FINSI;
     aAlfa = #dsorm006#13;  |QBF aAlfa;  |SI aAlfa ! "";    |ACABA;  |FINSI;

     |SALVA_DATOS #dsorm006;

     #dsorm006#0 = 8888;

     |PARA nCampo = 1;  |SI nCampo [ nEmpresas;  |HACIENDO nCampo = nCampo + 1;
           #dsorm006#3  = nCampo;
           #dsorm006#14 = "S";
           |GRABA 020#dsorm006.n;
           |LIBERA #dsorm006;
     |SIGUE;

     |REPON_DATOS #dsorm006;
     |LEE 040#dsorm006.=;
|FPRC;

|DEFBUCLE dsorm006A;
     #dsorm006#1;
     ;
     0000, "        ", "        ", 001;
     0000, "zzzzzzzz", "zzzzzzzz", 999;
     ;
     NULL, dsorm006A;
|FIN;

|PROCESO CogeEmpresaAuditor;
     |BUCLE gecom004;
|FPRC;

|PROCESO Auditores;
     |DBASS aBaseChek;    |QBF aBaseChek;
     aBaseChek = aBaseChek + "gecochek/";
     aMas      = aBaseChek + "def/gecom001.mas";  |QBT aMas;
     |CARGA_DEF aMas, gecom001@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aMas = aBaseChek + "def/gecom004.mas";  |QBT aMas;
     |CARGA_DEF aMas, gecom004@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #gecom001@;
         |ACABA;
     |FINSI;

     aMas = aBaseChek + "def/gecom011.mas";  |QBT aMas;
     |CARGA_DEF aMas, gecom011@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #gecom004@;
         |DESCARGA_DEF #gecom001@;
         |ACABA;
     |FINSI;

     aFic = aBaseChek + "fich/";

     |PATH_DAT #gecom001@#aFic#;
     |PATH_DAT #gecom004@#aFic#;
     |PATH_DAT #gecom011@#aFic#;

     |ABRE #gecom001@;
     |SELECT #4#gecom001@;
     #gecom001@#12 = #dsorz005#0;
     |LEE 000#gecom001@.=;
     |SI FSalida = 0;
         nCodMenu  = (#gecom001@#7 * 100) + #gecom001@#9;
         nCodResto = 8888;
     |FINSI;

     nPasada   = 0;
     nEmpresas = 0;
     nAuditor  = #gecom001@#0;
     |HAZ CogeEmpresaAuditor;

     |BUCLE dsorm006B;   || Preparacion de los filtros
     |BUCLE dsorm006A;

     |DBASS aBase;  |QBF aBase;
     aAlfa   = aBase % -201;
     nGrupo  = aAlfa;
     |SI nGrupo = 0;  nGrupo = 1;  |FINSI;

     nPasada   = 1;
     |ABRE #gecom011@;
     |HAZ CogeEmpresaAuditor;
     |CIERRA #gecom011@;

     |DESCARGA_DEF #gecom011@;
     |DESCARGA_DEF #gecom004@;
     |DESCARGA_DEF #gecom001@;
|FPRC;

|PROCESO dsorm003M;
     #dsorw015#0 = #dsorm003#0;
     #dsorw015#1 = #dsorm003#1;
     #dsorw015#2 = #dsorm003#2;
     |LEE 000#dsorw015.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #dsorw015#0 = #dsorm003#0;
     #dsorw015#1 = #dsorm003#1;
     #dsorw015#2 = #dsorm003#2;
     |GRABA 020#dsorw015.n;
     |LIBERA #dsorw015;
|FPRC;

|DEFBUCLE dsorm003M;
     #dsorm003#1;
     ;
     enGrupo, "        ", "        ", aDClave;
     enGrupo, "zzzzzzzz", "zzzzzzzz", aHClave;
     ;
     NULL, dsorm003M;
|FIN;

|PROCESO dsorw015;
     eaAplica = #dsorw015#1;
     eaMenu   = #dsorw015#2;
     |SUB_EJECUTA "dsorz001;CREAMENU";
|FPRC;

|DEFBUCLE dsorw015;
     #dsorw015#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsorw015;
|FIN;

|PROCESO CalculaMenus;
     enGrupo    = #dsorz005#0;
     eaAplica   = "";
     eaMenu     = "";

     aFichero = "dsorw015" + Usuario;
     |NOME_DAT #dsorw015#aFichero#;
     |ABRE #dsorw015;  |CIERRA #dsorw015;  |DELINDEX #dsorw015;

     |ABRE #dsorw015;
     |BUCLE dsorm003M;
     |CIERRA #dsorw015;

     |BUCLE dsorw015;

     |ABRE #dsorw015;  |CIERRA #dsorw015;  |DELINDEX #dsorw015;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     |SI #dsorz999#1 = "A";  |Y #dsorz005#0 [ 8999;
         nHay = 0;

         |DDEF aBaseAqui;    |QBF aBaseAqui;

         aMas = aBaseAqui + "dsprem03.mas";  |CARGA_DEF aMas, dsprem03@;
         aMas = aBaseAqui + "dsprem04.mas";  |CARGA_DEF aMas, dsprem04@;

         |ABRE #dsprem03@;
         |SELECT #2#dsprem03@;
         #dsprem03@#11 = #dsorz005#0;
         |LEE 000#dsprem03@.=;
         |SI FSalida ! 0;  |DDEFECTO #dsprem03@;  |FINSI;
         |CIERRA #dsprem03@;

         |ABRE #dsprem04@;
         |SELECT #1#dsprem04@;
         #dsprem04@#0 = #dsprem03@#0;
         #dsprem04@#1 = #dsprem03@#1;
         #dsprem04@#2 = #dsprem03@#2;
         #dsprem04@#3 = #dsprem03@#3;
         #dsprem04@#4 = #dsprem03@#4;
         #dsprem04@#5 = "";
         |LEE 000#dsprem04@.];
         |SI FSalida = 0;
             |Y  #dsprem04@#0 = #dsprem03@#0;
             |Y  #dsprem04@#1 = #dsprem03@#1;
             |Y  #dsprem04@#2 = #dsprem03@#2;
             |Y  #dsprem04@#3 = #dsprem03@#3;
             |Y  #dsprem04@#4 = #dsprem03@#4;
                 nHay = 1;
         |FINSI;
         |CIERRA #dsprem04@;

         |DESCARGA_DEF #dsprem04@;
         |DESCARGA_DEF #dsprem03@;

         |SI nHay = 0; |ACABA;  |FINSI;
     |FINSI;

     aDClave   = " ";
     aHClave   = "z" * 100;

     |HAZ CalculaMenus;

     aFichero = "dsorw003" + Usuario;
     |NOME_DAT #dsorw003#aFichero#;
     |ABRE #dsorw003;  |CIERRA #dsorw003;  |DELINDEX #dsorw003;

     aFichero = "dsorw004" + Usuario;
     |NOME_DAT #dsorw004#aFichero#;
     |ABRE #dsorw004;  |CIERRA #dsorw004;  |DELINDEX #dsorw004;

     aFichero = "dsorw008" + Usuario;
     |NOME_DAT #dsorw008#aFichero#;
     |ABRE #dsorw008;  |CIERRA #dsorw008;  |DELINDEX #dsorw008;

     |SI #dsorz999#1 = "A";
         |SI #dsorz005#0 [ 8999;
             |HAZ Perfiles;
         |SINO;
             |HAZ Auditores;
         |FINSI;
     |SINO;
          nCodMenu  = #dsorz005#0;
          nCodResto = #dsorz005#0;
     |FINSI;

     aDClave = " ";
     aHClave = "z" * 100;

     |DFICE aFich;   |QBF aFich;
     aDirGrupo = aFich + "grupos";           |MKDIR aDirGrupo;
     aDirGrupo = aDirGrupo + "/" + Usuario;  |MKDIR aDirGrupo;
     aDirGrupo = aDirGrupo + "/" + (("0000" + #dsorz005#0) % -104);    |MKDIR aDirGrupo;
     aDirGrupo = aDirGrupo + "/";

     |ABRE #dsorw008;
     |HAZ Menus;
     |HAZ Filtros;
     |HAZ FiltrosEmpresas;
     |CIERRA #dsorw008;

     |ABRE #dsorw003;  |CIERRA #dsorw003;  |DELINDEX #dsorw003;
     |ABRE #dsorw004;  |CIERRA #dsorw004;  |DELINDEX #dsorw004;
     |ABRE #dsorw008;  |CIERRA #dsorw008;  |DELINDEX #dsorw008;
|FPRC;

|PROCESO dsorm001;
     |SI #dsorm001#0 = 8888;  |ACABA;  |FINSI;

     #dsorz005#0 = #dsorm001#0;
     #dsorz005#1 = #dsorm001#1;

     |HAZ Tipo3;
|FPRC;

|DEFBUCLE dsorm001;
     #dsorm001#1;
     ;
     nDGrupo;
     nHGrupo;
     ;
     NULL, dsorm001;
|FIN;

|PROCESO LimpiaDirectorio;
     |DBASS aBase;   |QBF aBase;
     |DFICE aFich;   |QBF aFich;
     aDirGrupo = aFich + "grupos";           |MKDIR aDirGrupo;
     aDirGrupo = aDirGrupo + "/" + Usuario;  |MKDIR aDirGrupo;
     aDirGrupo = aDirGrupo + "/";

     aDirFichero = aDirGrupo + "*";
     |_PDIR aDirFichero;
     |PARA;  |SI FSalida ] 0; |HACIENDO;
         aAlfa   = aBase + "bin/agirm -r " + aDirFichero;
         |SYSTEM aAlfa;

         |_SDIR aDirFichero;
     |SIGUE;
|FPRC;

|PROGRAMA;
     |HAZ LimpiaDirectorio;

     |ABRE #dsorz999;
     |LEE 000#dsorz999.p;
     |SI FSalida ! 0;  |DDEFECTO #dsorz999;  |FINSI;
     |CIERRA #dsorz999;

     aParametro = PARAMETRO;  |QBF aParametro;
     |SI aParametro = "";
         |MANTE #dsorz005;
     |SINO;
         nDGrupo = 1;
         nHGrupo = 9999;

         aAlfa = PARAMETRO - "AUTOMATICO";  |QBT aAlfa;
         |SI FSalida ! 0;
             aParametro = "AUTOMATICO";
             |SI aAlfa ! "";
                 nDGrupo    = aAlfa;
                 nHGrupo    = aAlfa;
             |FINSI;
         |FINSI;

         |SI aParametro ! "AUTOMATICO";  |Y aParametro ! "0000";
             nDGrupo = aParametro;
             nHGrupo = aParametro;
         |FINSI;

         |BUCLE dsorm001;
     |FINSI;
|FPRO;
