|FICHEROS;
     dsprez01;
     dsprem01;
     dsprem03;
     dsprem04;
     dsorm015;
     dsprem99;

     dsprew02;

     agiuser1@;
     maesm011@;
     maesm037@;
     gecom001@;
|FIN;

|VARIABLES;
     aBase      = "";
     aMas       = "";
     aAlfa      = "";
     aAlfa1     = "";
     aDef       = "";
     aFich      = "";
     aAbre      = "";
     aParametro = "";
     aHora      = "";
     aDateUsuario = "";
     aDateSistema = "";
     aOrigen      = "";
     aDestino     = "";

     nCaracter    = 0;
     nPos         = 0;
     nCamuf       = 0;
     nNum         = 0;
     nMayor       = 0;
     nHandle      = 0;
     nHandleUsu   = 0;
     nDSPreven    = 0;
     nGecochek    = 0;
     nReg         = 0;

     fFecha    = @;

     &eaPass       = "";
     &eaPassEnc    = "";
     &enChequeoUsu = 0;
     &enErrorUsu   = 0;
|FIN;

|PROCESO ActivaTecnicosOTP;
     |SI #dsprem04#3 = 99;  |Y #dsprem04#4 < 50;
         |ACABA;
     |FINSI;

     |ABRE #maesm011@;
     #maesm011@#0 = #dsprem04#5;
     |LEE 101#maesm011@.=;
     |SI FSalida ! 0;
         |DDEFECTO #maesm011@;
         #maesm011@#0 = #dsprem04#5;
         #maesm011@#1 = #dsprem04#6;
         |GRABA 020#maesm011@.b;
     |FINSI;

     aAlfa   = #dsprem04#0 + (("00" + #dsprem04#1) % -102) + (("00" + #dsprem04#2) % -102);
     #maesm011@#11 = aAlfa;
     #maesm011@#10 = #dsprem04#9;
     #maesm011@#12 = #dsprem04#10;
     #maesm011@#28 = #dsprem04#16;
     #maesm011@#33 = #dsprem04#19;

     aAlfa   = #maesm011@#9;  |QBF aAlfa;
     |SI aAlfa = "";
         #maesm011@#9 = #dsprem04#15;
     |FINSI;

     |GRABA 020#maesm011@.a;
     |LIBERA #maesm011@;
     |CIERRA #maesm011@;

     |SI #dsprem04#3 = 99;  |Y #dsprem04#4 ] 50;
         |DBASS aBase;  |QBF aBase;
         aMas  = aBase + "dspreven/def/maesm037.mas";
         aFich = aBase + "dspreven/fich/";
         |CARGA_DEF aMas, maesm037@;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |PATH_DAT #maesm037@#aFich#;

         |ABRE #maesm037@;
         #maesm037@#0 = #maesm011@#0;
         #maesm037@#1 = #maesm011@#0;
         |LEE 101#maesm037@.=;
         |SI FSalida ! 0;
             |DDEFECTO #maesm037@;
             #maesm037@#0 = #maesm011@#0;
             #maesm037@#1 = #maesm011@#0;
             #maesm037@#2 = #dsprem04#6;
             |GRABA 020#maesm037@.n;
         |FINSI;
         |LIBERA #maesm037@;
         |CIERRA #maesm037@;

         |DESCARGA_DEF #maesm037@;
     |FINSI;
|FPRC;

|PROCESO dsprem04;
     aAlfa = #dsprem04#5;  |QBF aAlfa;
     |SI aAlfa = "";
         |GRABA 020#dsprem04.a;
         |LIBERA #dsprem04;

         |ACABA;
     |FINSI;

     |SI nDSPreven = 1;
         |SI #dsprem04#19 = "N";
             |HAZ ActivaTecnicosOTP;
             |ACABA;
         |FINSI;
     |FINSI;

     eaPass = #dsprem04#7;
     |HAZ EncriptaUsuario;

     |SI #dsprem04#8 = 0;
         |ABRE #dsprew02;
         |SELECT #2#dsprew02;
         |LEE 040#dsprew02.u;
         |SI FSalida = 0;
             nMayor = #dsprew02#1 + 1;
             |SI nMayor > 999;
                 |PARA nMayor = 1;  |SI nMayor [ 999;  |HACIENDO nMayor = nMayor + 1;
                       #dsprew02#1 = nMayor;
                       |LEE 000#dsprew02.=;
                       |SI FSalida ! 0;  |SAL;  |FINSI;
                 |SIGUE;
             |FINSI;
         |FINSI;
         |CIERRA #dsprew02;

         |SI nMayor > 999;
             |MENAV "     Mas de 1000 Usuarios, pongase en contacto con su distribuidor.";
             |ACABA;
         |FINSI;

         #dsprem04#8   = nMayor;

         #dsprem03#0   = #dsprem04#0;
         #dsprem03#1   = #dsprem04#1;
         #dsprem03#2   = #dsprem04#2;
         #dsprem03#3   = #dsprem04#3;
         #dsprem03#4   = #dsprem04#4;
         |LEE 040#dsprem03.=;
         |SI FSalida ! 0;  |DDEFECTO #dsprem03;  |FINSI;

         |HORA aHora;

         |ABRE #dsprem99;
         |SELECT #1#dsprem99;

         nReg = 1;
         |LEE 000#dsprem99.u;
         |SI FSalida = 0;
             nReg = #dsprem99#0 + 1;
         |FINSI;

         #dsprem99#0  = nReg;
         |GRABA 020#dsprem99.b;

         #dsprem99#1  = #dsprem04#5;
         #dsprem99#2  = ~;
         #dsprem99#3  = aHora;
         #dsprem99#4  = "M";
         #dsprem99#5  = "MODIFICACION DEL USUARIO DESDE CREACION DE USUARIOS";
         #dsprem99#6  = #dsprem04#0 + (("00" + #dsprem04#1) % -102) + (("00" + #dsprem04#2) % -102);
         #dsprem99#7  = #dsprem04#3;
         #dsprem99#8  = #dsprem04#4;
         #dsprem99#9  = #dsprem03#5;
         #dsprem99#10 = #dsprem03#6;
         #dsprem99#11 = #dsprem03#7;
         #dsprem99#12 = #dsprem03#8;
         #dsprem99#13 = #dsprem03#9;
         #dsprem99#14 = #dsprem03#10;
         #dsprem99#15 = #dsprem04#9;
         #dsprem99#16 = #dsprem04#10;
         #dsprem99#17 = #dsprem04#11;
         #dsprem99#18 = #dsprem03#11;
         #dsprem99#19 = #dsprem04#8;
         #dsprem99#20 = Usuario % 810;
         |GRABA 020#dsprem99.a;
         |LIBERA #dsprem99;
         |CIERRA #dsprem99;
     |FINSI;

     #dsprem04#18 = "S";
     |GRABA 020#dsprem04.a;
     |LIBERA #dsprem04;

     |ABRE #dsprew02;
     #dsprew02#0 = #dsprem04#5;
     |LEE 101#dsprew02.=;
     |SI FSalida ! 0;
         #dsprew02#0 = #dsprem04#5;
         |GRABA 020#dsprew02.b;
     |FINSI;

     #dsprew02#1 = #dsprem04#8;
     |GRABA 020#dsprew02.a;
     |LIBERA #dsprew02;
     |CIERRA #dsprew02;

     aAlfa = ("000" + #dsprem04#8) % -103;
     aAlfa = aAlfa  + #dsprem04#5;
     aAlfa = aAlfa  + eaPassEnc;
     aAlfa = aAlfa  + "N";
     |XGRABA nHandle, aAlfa;

     #agiuser1@#0 = #dsprem04#8;
     |LEE 101#agiuser1@.=;
     |SI FSalida ! 0;
         |DDEFECTO #agiuser1@;
         #agiuser1@#0 = #dsprem04#8;
         |GRABA 020#agiuser1@.b;
     |FINSI;

     #dsprem03#0   = #dsprem04#0;
     #dsprem03#1   = #dsprem04#1;
     #dsprem03#2   = #dsprem04#2;
     #dsprem03#3   = #dsprem04#3;
     #dsprem03#4   = #dsprem04#4;
     |LEE 040#dsprem03.=;
     |SI FSalida ! 0;  |DDEFECTO #dsprem03;  |FINSI;

     #agiuser1@#1 = #dsprem04#5;
     #agiuser1@#2 = #dsprem03#11;
     |SI #dsprem04#10 = "S";  |Y #dsprem04#16 = "N";
         #agiuser1@#2 = 0;
     |FINSI;
     |GRABA 020#agiuser1@.a;
     |LIBERA #agiuser1@;

     |SI nDSPreven = 1;
         |HAZ ActivaTecnicosOTP;
     |FINSI;

     |DBASS aBase; |QBF aBase;
     aAlfa  = aBase + "dev/usr/" + #dsprem04#5;  |QBF aAlfa;
     aAlfa  = aAlfa + ".ini";
     |XABRE "E", aAlfa, nHandleUsu;
     |SI FSalida ] 0;
         |FBORRA aAlfa;
     |FINSI;

     |SI #dsprem04#9 = "S";  |ACABA;  |FINSI;

     |XABRE "W", aAlfa, nHandleUsu;
     aAlfa = "NOBOTONUSUARIOS=1" + &13 + &10;
     |XGRABA nHandleUsu, aAlfa;
     |XCIERRA nHandleUsu;
|FPRC;

|DEFBUCLE dsprem04;
     #dsprem04#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dsprem04;
|FIN;

|PROCESO gecom001;
     #dsorm015#1 = #gecom001@#4;
     |LEE 000#dsorm015.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     aDateUsuario = (#gecom001@#13  % -104) + (#gecom001@#13  % 402) + (#gecom001@#13 % 102) + (("00" + #gecom001@#14) % -102) + (("00" + #gecom001@#14) % -102);
     |SI aDateSistema > aDateUsuario;  |ACABA;  |FINSI;

     eaPass = #gecom001@#5;
     |HAZ EncriptaUsuario;

     |SI #gecom001@#11 = 0;
         nMayor = 1;

         |ABRE #dsprew02;
         |SELECT #2#dsprew02;
         |LEE 040#dsprew02.u;
         |SI FSalida = 0;
             nMayor = #dsprew02#1 + 1;
             |SI nMayor > 999;
                 |PARA nMayor = 1;  |SI nMayor [ 999;  |HACIENDO nMayor = nMayor + 1;
                       #dsprew02#1 = nMayor;
                       |LEE 040#dsprew02.=;
                       |SI FSalida ! 0;  |SAL;  |FINSI;
                 |SIGUE;
             |FINSI;
         |FINSI;
         |CIERRA #dsprew02;

         |SI nMayor > 999;
             |MENAV "     Mas de 1000 Usuarios, pongase en contacto con su distribuidor.";
             |ACABA;
         |FINSI;

         #gecom001@#11 = nMayor;

         |HORA aHora;

         |ABRE #dsprem99;
         |SELECT #1#dsprem99;

         nReg = 1;
         |LEE 000#dsprem99.u;
         |SI FSalida = 0;
             nReg = #dsprem99#0 + 1;
         |FINSI;

         |DBASS aAlfa;  |QBF aAlfa;
         aAlfa = aAlfa % -201;

         |ABRE #dsprem01;
         #dsprem01#0 = aAlfa;
         |LEE 000#dsprem01.=;
         |SI FSalida ! 0;  |DDEFECTO #dsprem01;  |FINSI;
         |CIERRA #dsprem01;

         #dsprem99#0  = nReg;
         |GRABA 020#dsprem99.b;

         #dsprem99#1  = #gecom001@#4;
         #dsprem99#2  = ~;
         #dsprem99#3  = aHora;
         #dsprem99#4  = "M";
         #dsprem99#5  = "MODIFICACION DEL USUARIO DESDE CREACION DE USUARIOS";
         #dsprem99#6  = aAlfa + "0000";
         #dsprem99#7  = #gecom001@#7;
         #dsprem99#8  = #gecom001@#9;
         #dsprem99#9  = #dsprem01#1;
         #dsprem99#10 = "AUDITOR";
         #dsprem99#11 = "AUDITOR";
         #dsprem99#12 = #gecom001@#8;
         #dsprem99#13 = #gecom001@#10;
         aAlfa  = #dsprem99#6 + " " + #gecom001@#8;  |QBF aAlfa;
         aAlfa  = aAlfa + #gecom001@#10;
         #dsprem99#14 = aAlfa;
         #dsprem99#15 = "N";
         #dsprem99#16 = "N";
         #dsprem99#17 = #gecom001@#6;
         #dsprem99#18 = #gecom001@#12;
         #dsprem99#19 = #gecom001@#11;
         #dsprem99#20 = Usuario % 810;
         |GRABA 020#dsprem99.a;
         |LIBERA #dsprem99;
         |CIERRA #dsprem99;
     |FINSI;

     #gecom001@#17 = "S";

     |GRABA 020#gecom001@.a;
     |LIBERA #gecom001@;

     |ABRE #dsprew02;
     #dsprew02#0 = #gecom001@#4;
     |LEE 101#dsprew02.=;
     |SI FSalida ! 0;
         #dsprew02#0 = #gecom001@#4;
         |GRABA 020#dsprew02.b;
     |FINSI;

     #dsprew02#1 = #gecom001@#11;
     |GRABA 020#dsprew02.a;
     |LIBERA #dsprew02;
     |CIERRA #dsprew02;

     aAlfa = ("000" + #gecom001@#11) % -103;
     aAlfa = aAlfa  + #gecom001@#4;
     aAlfa = aAlfa  + eaPassEnc;
     aAlfa = aAlfa  + "N";
     |XGRABA nHandle, aAlfa;

     #agiuser1@#0 = #gecom001@#11;
     |LEE 101#agiuser1@.=;
     |SI FSalida ! 0;
         |DDEFECTO #agiuser1@;
         #agiuser1@#0 = #gecom001@#11;
         |GRABA 020#agiuser1@.b;
     |FINSI;

     #agiuser1@#1 = #gecom001@#4;
     #agiuser1@#2 = #gecom001@#12;
     |GRABA 020#agiuser1@.a;
     |LIBERA #agiuser1@;
|FPRC;

|DEFBUCLE gecom001;
     #gecom001@#1001;
     ;
     00001;
     99999;
     be;
     NULL, gecom001;
|FIN;

|PROCESO dsorm015;
     eaPass = #dsorm015#3;
     |HAZ EncriptaUsuario;

     |SI #dsorm015#4 = 0;
         |ABRE #dsprew02;
         |SELECT #2#dsprew02;
         |LEE 040#dsprew02.u;
         |SI FSalida = 0;
             nMayor = #dsprew02#1 + 1;
             |SI nMayor > 999;
                 |PARA nMayor = 1;  |SI nMayor [ 999;  |HACIENDO nMayor = nMayor + 1;
                       #dsprew02#1 = nMayor;
                       |LEE 040#dsprew02.=;
                       |SI FSalida ! 0;  |SAL;  |FINSI;
                 |SIGUE;
             |FINSI;
         |FINSI;
         |CIERRA #dsprew02;

         |SI nMayor > 999;
             |MENAV "     Mas de 1000 Usuarios, pongase en contacto con su distribuidor.";
             |ACABA;
         |FINSI;

         #dsorm015#4 = nMayor;

         |HORA aHora;

         |ABRE #dsprem99;
         |SELECT #1#dsprem99;

         nReg = 1;
         |LEE 000#dsprem99.u;
         |SI FSalida = 0;
             nReg = #dsprem99#0 + 1;
         |FINSI;

         #dsprem99#0  = nReg;
         |GRABA 020#dsprem99.b;

         #dsprem99#1  = #dsorm015#1;
         #dsprem99#2  = ~;
         #dsprem99#3  = aHora;
         #dsprem99#4  = "M";
         #dsprem99#5  = "MODIFICACION DEL USUARIO DESDE CREACION DE USUARIOS";
         #dsprem99#6  = "";
         #dsprem99#7  = 0;
         #dsprem99#8  = 0;
         #dsprem99#9  = "";
         #dsprem99#10 = "";
         #dsprem99#11 = "";
         #dsprem99#12 = "";
         #dsprem99#13 = "";
         #dsprem99#14 = "";
         #dsprem99#15 = "";
         #dsprem99#16 = "";
         #dsprem99#17 = #dsorm015#5;
         #dsprem99#18 = #dsorm015#0;
         #dsprem99#19 = #dsorm015#4;
         #dsprem99#20 = Usuario % 810;
         |GRABA 020#dsprem99.a;
         |LIBERA #dsprem99;
         |CIERRA #dsprem99;
     |FINSI;

     aAlfa = ("000" + #dsorm015#4) % -103;
     aAlfa = aAlfa  + #dsorm015#1;
     aAlfa = aAlfa  + eaPassEnc;
     aAlfa = aAlfa  + "N";
     |XGRABA nHandle, aAlfa;

     #agiuser1@#0 = #dsorm015#4;
     |LEE 101#agiuser1@.=;
     |SI FSalida ! 0;
         |DDEFECTO #agiuser1@;
         #agiuser1@#0 = #dsorm015#4;
         |GRABA 020#agiuser1@.b;
     |FINSI;

     #agiuser1@#1 = #dsorm015#1;
     #agiuser1@#2 = #dsorm015#0;
     |GRABA 020#agiuser1@.a;
     |LIBERA #agiuser1@;

     #dsorm015#7 = "S";
     |GRABA 020#dsorm015.a;
     |LIBERA #dsorm015;

     |ABRE #dsprew02;
     #dsprew02#0 = #dsorm015#1;
     |LEE 101#dsprew02.=;
     |SI FSalida ! 0;
         #dsprew02#0 = #dsorm015#1;
         |GRABA 020#dsprew02.b;
     |FINSI;

     #dsprew02#1 = #dsorm015#4;
     |GRABA 020#dsprew02.a;
     |LIBERA #dsprew02;
     |CIERRA #dsprew02;

     |DBASS aBase; |QBF aBase;
     aAlfa  = aBase + "dev/usr/" + #dsorm015#1;  |QBF aAlfa;
     aAlfa  = aAlfa + ".ini";
     |XABRE "E", aAlfa, nHandleUsu;
     |SI FSalida ] 0;
         |FBORRA aAlfa;
     |FINSI;

     |SI #dsorm015#8 = "S";  |ACABA;  |FINSI;

     |XABRE "W", aAlfa, nHandleUsu;
     aAlfa = "NOBOTONUSUARIOS=1" + &13 + &10;
     |XGRABA nHandleUsu, aAlfa;
     |XCIERRA nHandleUsu;
|FPRC;

|DEFBUCLE dsorm015;
     #dsorm015#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dsorm015;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |SI #dsprez01#0 ! "SI";  |ACABA;  |FINSI;

     |SI PARAMETRO = "";
         enChequeoUsu = 1;
         |HAZ RevisaUsuarios;
         |SI enErrorUsu = 1;
             enChequeoUsu = 0;
             |HAZ RevisaUsuarios;
         |FINSI;

         enChequeoUsu = 1;
         |HAZ RevisaUsuarios;
         |SI enErrorUsu = 1;
             |MENAV "0000 Proceso cancelado. Entre en la opcion Definicion de Usuarios, para actualizar usuarios";
             |ACABA;
         |FINSI;
     |FINSI;

     |DBASS aBase;  |QBF aBase;
     aMas  = aBase + "dspreven/def/maesm011.mas";
     aFich = aBase + "dspreven/fich/";
     |CARGA_DEF aMas, maesm011@;
     |SI FSalida = 0;
         |PATH_DAT #maesm011@#aFich#;
     |FINSI;

     |DBASS aBase; |QBF aBase;
     aDef = aBase + "agitool/def/agiuser1.mas";
     |CARGA_DEF aDef, agiuser1@;
     |SI FSalida ! 0;
         |SI nDSPreven = 1;  |DESCARGA_DEF #maesm011@;  |FINSI;

         |MENAV "    [agitool/def/agiuser1.mas] inaccesible";
         |ACABA;
     |FINSI;

     aFich = aBase + "agitool/fich/";
     |PATH_DAT #agiuser1@#aFich#;
     |ABRE #agiuser1@;  |CIERRA #agiuser1@;  |DELINDEX #agiuser1@;

     |DBASS aBase; |QBF aBase;
     aAbre = aBase + "dev/usr/ds_sys_tmp.psw";
     |XABRE "W", aAbre, nHandle;

     |ABRE #agiuser1@;
     |ABRE #dsprem03;
     |BUCLE dsprem04;
     |CIERRA #agiuser1@;
     |CIERRA #dsprem03;

     nGecochek = 0;
     |DBASS aBase;  |QBF aBase;
     aMas  = aBase + "gecochek/def/gecom001.mas";
     aFich = aBase + "gecochek/fich/";
     |CARGA_DEF aMas, gecom001@;
     |SI FSalida = 0;
         |PATH_DAT #gecom001@#aFich#;
         nGecochek = 1;

         fFecha = ~;
         |HORA aHora;

         aDateSistema = (fFecha % -104) + (fFecha % 402) + (fFecha % 102) + (aHora % 102) + (aHora % 402);

         |ABRE #dsorm015;
         |SELECT #2#dsorm015;
         |ABRE #agiuser1@;
         |BUCLE gecom001;
         |CIERRA #dsorm015;
         |CIERRA #agiuser1@;
         |SELECT #1#dsorm015;
     |FINSI;

     |ABRE #agiuser1@;
     |BUCLE dsorm015;
     |CIERRA #agiuser1@;

     |XCIERRA nHandle;

     aOrigen  = aBase + "dev/usr/ds_sys_tmp.psw";
     aDestino = aBase + "dev/usr/ds_sys.psw";
     |FBORRA aDestino;
     |RENOMBRA_FICHERO aOrigen, aDestino;

     |SI nGecochek = 1;  |DESCARGA_DEF #gecom001@;  |FINSI;

     |DESCARGA_DEF #agiuser1@;

     |SI nDSPreven = 1;  |DESCARGA_DEF #maesm011@;  |FINSI;
|FPRC;

|PROCESO dsprem04_10;
     aAlfa = #dsprem04#5;  |QBF aAlfa;
     |SI aAlfa = "";
         |GRABA 020#dsprem04.a;
         |LIBERA #dsprem04;
         |ACABA;
     |FINSI;

     |SI #dsprem04#8 = 0;  |ACABA;  |FINSI;

     |SI nDSPreven = 1;
         |SI #dsprem04#19 = "N";
             #dsprem04#8 = 0;

             |GRABA 020#dsprem04.a;
             |LIBERA #dsprem04;
             |ACABA;
         |FINSI;
     |FINSI;

     #dsprew02#0 = #dsprem04#5;
     |LEE 101#dsprew02.=;
     |SI FSalida ! 0;
         #dsprew02#0 = #dsprem04#5;
         |GRABA 020#dsprew02.b;
     |FINSI;

     #dsprew02#1 = #dsprem04#8;
     |GRABA 020#dsprew02.a;
     |LIBERA #dsprew02;
|FPRC;

|PROCESO gecom001_10;
     #dsorm015#1 = #gecom001@#4;
     |LEE 000#dsorm015.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |SI #gecom001@#11 = 0;  |ACABA;  |FINSI;

     #dsprew02#0 = #gecom001@#4;
     |LEE 101#dsprew02.=;
     |SI FSalida ! 0;
         #dsprew02#0 = #gecom001@#4;
         |GRABA 020#dsprew02.b;
     |FINSI;

     #dsprew02#1 = #gecom001@#11;
     |GRABA 020#dsprew02.a;
     |LIBERA #dsprew02;
|FPRC;

|DEFBUCLE gecom001_10;
     #gecom001@#1001;
     ;
     00001;
     99999;
     be;
     NULL, gecom001_10;
|FIN;

|PROCESO dsorm015_10;
     |SI #dsorm015#4 = 0;  |ACABA;  |FINSI;

     #dsprew02#0 = #dsorm015#1;
     |LEE 101#dsprew02.=;
     |SI FSalida ! 0;
         #dsprew02#0 = #dsorm015#1;
         |GRABA 020#dsprew02.b;
     |FINSI;

     #dsprew02#1 = #dsorm015#4;
     |GRABA 020#dsprew02.a;
     |LIBERA #dsprew02;
|FPRC;

|DEFBUCLE dsorm015_10;
     #dsorm015#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsorm015_10;
|FIN;

|DEFBUCLE dsprem04_10;
     #dsprem04#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dsprem04_10;
|FIN;

|PROGRAMA;
     nDSPreven = 0;
     |DBASS aBase;  |QBF aBase;
     aMas  = aBase + "dspreven/def/maesm011.mas";
     |XABRE "E", aMas, 0;
     |SI FSalida ] 0;
         nDSPreven = 1;
     |FINSI;

     |ABRE #dsprew02;  |CIERRA #dsprew02;  |DELINDEX #dsprew02;

     |ABRE #dsprew02;

     |BUCLE dsprem04_10;
     |BUCLE dsorm015_10;

     |DBASS aBase;  |QBF aBase;
     aMas  = aBase + "gecochek/def/gecom001.mas";
     aFich = aBase + "gecochek/fich/";
     |CARGA_DEF aMas, gecom001@;
     |SI FSalida = 0;
         |PATH_DAT #gecom001@#aFich#;
         |ABRE #dsorm015;
         |BUCLE gecom001_10;
         |CIERRA #dsorm015;

         |DESCARGA_DEF #gecom001@;
     |FINSI;

     |CIERRA #dsprew02;

     aParametro = PARAMETRO;  |QBF aParametro;
     |SI aParametro = "";
         |MANTE #dsprez01;
     |SINO;
         #dsprez01#0 = "SI";
         |HAZ Tipo3;
     |FINSI;

     |ABRE #dsprew02;  |CIERRA #dsprew02;  |DELINDEX #dsprew02;
|FPRO;
