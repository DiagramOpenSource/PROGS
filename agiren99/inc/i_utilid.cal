|FICHEROS;
     rew00005 #500,MANTE;
|FIN;

|VARIABLES;
       CampoDni   = "";
       LetrasNif  = "TRWAGMYFPDXBNJZSQVHLCKE";
       Letra1     = "";
       Letra2     = "";
       Letra3     = "";
       Letra4     = "";
       Letra5     = "";
       Letra6     = "";
       Letra7     = "";
       Letra8     = "";
       CantiAlfa  = "";
       Sistema    = "";
       Valfa      = "";
       Valfa1     = "";
       Valfa2     = "";
       Valfa3     = "";
       Carac1     = 0;
       Carac2     = 0;
       Carac3     = 0;
       Carac4     = 0;
       Carac5     = 0;
       Sesion     = "";
       CaracterU  = "";
       CadenaU    = "";
       XPara      = 0;
       Valfa0     = "";
       SwPunto    = 0;
       ParteEntera   = "";
       ParteDecimal  = "";
       ParteDecimal4 = "";
       PosiU = 0;
       CantiNum = 0;

    {211}Campos   = "";
|FIN;

|PROCESO LetraDni;
     |QBF CampoDni;
     Letra2 = CampoDni;
     |QBT Letra2;

         CaracterU = Letra2 % 101;
     |SI CaracterU!"A";|Y CaracterU!"B";|Y CaracterU!"C";|Y CaracterU!"D";
          |Y CaracterU!"E";|Y CaracterU!"F";
          |Y CaracterU!"G";|Y CaracterU!"P";|Y CaracterU!"Q";|Y CaracterU!"S";|Y CaracterU!"X";
             Letra4 = "";
             Letra3 = Letra2 % 0;
             Carac2 = Letra3;
         |PARA Carac5 = 1;  |SI Carac5 [ Carac2;  |HACIENDO Carac5 = Carac5 + 1;
                 Carac3 = (Carac5 * 100) + 1;
                 Letra3 = Letra2 % Carac3;
             |SI Letra3="0";|O Letra3="1";|O Letra3="2";|O Letra3="3";
                           |O Letra3="4";|O Letra3="5";|O Letra3="6";
                           |O Letra3="7";|O Letra3="8";|O Letra3="9";
                     Letra4 = Letra4 + Letra3;
             |FINSI;
         |SIGUE;
             Carac4 = Letra4;
         |SI Carac4 ! 0; |Y Letra4 ! "";
                 Carac1 = Carac4 $ 23;
                 Carac1 = Carac1 + 1;
                 Carac3 = (Carac1 * 100) + 1;
                 Letra1 = LetrasNif % Carac3;

                 Letra4 = "000000000000" + Letra4;
                 Letra7 = Letra4 % -103;
                 Letra6 = Letra4 % -403;
                 Letra5 = Letra4 % -703;

                 Letra8 = Letra5  % 101;
                 |SI Letra8 = "0"; Letra5 = Letra5 % 202; |FINSI;

                 Letra8 = Letra5  % 101;
                 |SI Letra8 = "0"; Letra5 = Letra5 % 201; |FINSI;

                 Letra8 = Letra5  % 101;
                 |SI Letra8 = "0"; Letra5 = ""; |FINSI;

                 |SI Letra5 ! "";
                     Letra4 = Letra5 + Letra6 + Letra7 + Letra1;
                 |SINO;
                     Letra4 = Letra6 + Letra7 + Letra1;
                 |FINSI;

                 CampoDni = Letra4;
                 CampoDni = ("000000000" + CampoDni) % -109;
         |FINSI;
     |SINO;
         CaracterU = "";
         CadenaU   = "";
         |PARA XPara = 1; |SI XPara [ 12; |HACIENDO XPara = XPara + 1;
               PosiU = (100 * XPara) + 1;
               CaracterU = CampoDni % PosiU;
               |SI CaracterU ! "."; |Y CaracterU ! "-"; |Y CaracterU ! " ";
                   CadenaU = CadenaU + CaracterU;
               |FINSI;
         |SIGUE;
          CampoDni = CadenaU % 109;
     |FINSI;
     CampoDni = (CampoDni + "         ") % 109;
|FPRC;

|PROCESO Decimales;
  Valfa   = (CantiNum + "          ") % 110;
  PosiU   = 0;
  Valfa0  = "";
  Valfa1  = "";
  Valfa2  = "";
  SwPunto = 0;
  |PARA XPara = 1;  |SI XPara [ 10;  |HACIENDO XPara = XPara + 1;
        PosiU  = (100 * XPara) + 1;
        Valfa0 = Valfa % PosiU;
        |SI Valfa0 = "."; SwPunto = 1;  |FINSI;
        |SI SwPunto = 0;
            |SI Valfa0 ! " "; |Y Valfa0 ! ".";
                Valfa1 = Valfa1 + Valfa0;
            |FINSI;
        |FINSI;

        |SI SwPunto = 1;
            |SI Valfa0 ! " "; |Y Valfa0 ! ".";
                Valfa2 = Valfa2 + Valfa0;
            |FINSI;
        |FINSI;
  |SIGUE;

  ParteEntera   = ("0000000" + Valfa1) % -107;
  ParteDecimal  = (Valfa2 + "00") % 102;
  ParteDecimal4 = (Valfa2 + "0000") % 104;
|FPRC;

|PROCESO CambiCantiD7;
  CantiNum = CantiNum ! 0;
  |SI CantiNum ] 0;
      CantiAlfa = CantiNum;
      CantiAlfa = ("0000000" + CantiAlfa) % -107;
  |SINO;
      CantiNum  = -CantiNum;
      CantiAlfa = CantiNum;
      CantiAlfa = "N" + (("000000" + CantiAlfa) % -106);
  |FINSI;
|FPRC;

|PROCESO CambiCantiD9;
  CantiNum = CantiNum ! 0;
  |SI CantiNum ] 0;
      CantiAlfa = CantiNum;
      CantiAlfa = ("000000000" + CantiAlfa) % -109;
  |SINO;
      CantiNum  = -CantiNum;
      CantiAlfa = CantiNum;
      CantiAlfa = "N" + (("00000000" + CantiAlfa) % -108);
  |FINSI;
|FPRC;

|PROCESO CambiCantiD10;
  CantiNum = CantiNum ! 0;
  |SI CantiNum ] 0;
      CantiAlfa = CantiNum;
      CantiAlfa = ("0000000000" + CantiAlfa) % -110;
  |SINO;
      CantiNum  = -CantiNum;
      CantiAlfa = CantiNum;
      CantiAlfa = "N" + (("000000000" + CantiAlfa) % -109);
  |FINSI;
|FPRC;

|PROCESO CambiCantiD12;
  CantiNum = CantiNum ! 0;
  |SI CantiNum ] 0;
      CantiAlfa = CantiNum;
      CantiAlfa = ("000000000000" + CantiAlfa) % -112;
  |SINO;
      CantiNum  = -CantiNum;
      CantiAlfa = CantiNum;
      CantiAlfa = "N" + (("00000000000" + CantiAlfa) % -111);
  |FINSI;
|FPRC;

|PROCESO BorraCampos;
  ICampos = Campos1 <-;
  |PARA XPara = 1; |SI XPara [ 200; |HACIENDO XPara = XPara + 1;
        Campos   = "";
        ICampos  = ICampos + 1;
  |SIGUE;
|FPRC;
