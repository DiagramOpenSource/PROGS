|FICHEROS;
   recapmod #0;
   activid@ #3;
   cliente@ #4;
   reeoscnc #5;

   rem00027 #8;
   modulo1@ #9;
   modulo2@ #10;
   comulin@ #11;

   refecat@ #13;
   regicat@ #14;
   mode130@ #15;
   mode131@ #16;
   contrab@ #17;

   rem00031 #18;
   reelea97 #12;
   reeleact #19;
|FIN;

|VARIABLES;
   TotImporte = 0;
   UniImporte = 0;
   Uni        = 0;
   Unidades   = 0;
   Elem       = 0;
   Calc       = 0;
   Calc2      = 0;
   Cont       = 0;
   Cont1      = 0;

   Path       = "";
   Comodin    = "";
   Comodin1   = "";
   Linea      = 0;
   Linea1     = 0;
   nImporte   = 0;
   FEstado    = 0;

   aAlfa         = "";

   nCampo        = 0;
   nCampo1       = 0;
   nCampo2       = 0;
   nTecla        = 0;
   nActi         = 0;

   nCampoRdto    = 0;
   nPorce        = 0;
   nPorceL1      = 0;
   nPorceL2      = 0;
   nPorce1       = 0;
   nPorce2       = 0;
   nDifer        = 0;
   nResto        = 0;
   nSwAsala2     = 0;
   nDife         = 0;
   nCanti        = 0;
   EsArrend      = 0;
   nActivid      = 0;
   ModulAct      = "";
   Comun         = 0;
   Salir         = 0;
   Comunidad     = 0;

   &eaPrograma = "";
   &eaPunto    = "";
   &enEmpresa   = 0;
   &enEmprEos  = 0;
   &enActiEos  = 0;
   &enEmprRen  = 0;
   &eaCaracter = "";
   &eaTitCony  = "";
|FIN;

|PROCESO Comunidad;
   #activid@#0 = #recapmod#0;
   #activid@#1 = #recapmod#1;
   #activid@#2 = 99;
   |LEE 010#activid@.=;
   |SI FSalida = 0;
      |SI #activid@#46 = "S";
         |C_M #recapmod#5,1,"S";
         |C_M #recapmod#6,1,"S";
      |SINO;
         |C_M #recapmod#5,1,"N";
         |C_M #recapmod#6,1,"N";
      |FINSI;
   |SINO;
      |C_M #recapmod#5,1,"N";
      |C_M #recapmod#6,1,"N";
   |FINSI;
|FPRC;

|PROCESO Prorrata;
   |SI Elem = 1; Unidades = 15; |FINSI;    || Campo Unidades
   |SI Elem = 2; Unidades = 26; |FINSI;
   |SI Elem = 3; Unidades = 37; |FINSI;
   |SI Elem = 4; Unidades = 48; |FINSI;
   |SI Elem = 5; Unidades = 59; |FINSI;
   |SI Elem = 6; Unidades = 70; |FINSI;
   |SI Elem = 7; Unidades = 81; |FINSI;
   UniImporte = Unidades - 3;              || Campo Importe unitario
   TotImporte = Unidades + 1;              || Campo Importe

   Calc = #modulo1@#Unidades# * #modulo1@#UniImporte#;
   |SI Calc ! #modulo1@#TotImporte#;
      Uni = #modulo1@#TotImporte# / #modulo1@#UniImporte#;
   |SINO;
      Uni = #modulo1@#Unidades#;
   |FINSI;
|FPRC;

|PROCESO PagosACuenta;

   |SI #activid@#22 ! "A"; |Y #activid@#42 = "N";
      nActivid = 9;
   |FINSI;

   Linea1 = 1;
   #rem00031#0 = #recapmod#2;
   #rem00031#1 = 1;
   |LEE 010#rem00031.];
   |PARA; |SI FSalida = 0; |Y #rem00031#0 = #recapmod#2; |HACIENDO;
      Comodin = #rem00031#2 % 0101;
      |SI nActivid = 0;
         nActivid = #recapmod#1;
      |FINSI;
      |SI #rem00031#16 = #recapmod#1; |Y Comodin = #recapmod#3;
         Linea1 = #rem00031#1;
         |BORRA 020#rem00031.a;
         |SAL;
      |SINO;
         Linea1 = #rem00031#1 + 1;
         |LEE 010#rem00031.s;
      |FINSI;
   |SIGUE;

   |DDEFECTO #rem00031;
   #rem00031#0 = #recapmod#2;
   #rem00031#1 = Linea1;
   #rem00031#16 = nActivid;
   |SI #recapmod#3 = "T";
      #rem00031#2 = "TITULAR";
   |SINO;
      #rem00031#2 = "CONYUGE";
   |FINSI;

   |PARA Cont = 1; |SI Cont [ 4; |HACIENDO Cont = Cont + 1;
      || Leo y guardo los datos del modelo 130
      |SI ModulAct ! "A";
         |SI #activid@#46 ! "S";
            #mode130@#0 = #recapmod#0;
            #mode130@#1 = #recapmod#1;
         |SINO;
            #mode130@#0 = #recapmod#5;
            #mode130@#1 = nActivid;
         |FINSI;
         #mode130@#2 = Cont;
         #mode130@#3 = 99;
         |LEE 010#mode130@.=;
         |SI FSalida = 0;
            nActi = #recapmod#1;
            |SI #mode130@#3 ! "          ";
               Calc = Cont + 10;
               #rem00031#Calc# = #rem00031#Calc# + #mode130@#29;
            |FINSI;
         |SINO;
            #mode130@#0 = #recapmod#0;
            #mode130@#1 = 9;
            #mode130@#2 = Cont;
            #mode130@#3 = 99;
            |LEE 010#mode130@.=;
            |SI FSalida = 0;
               nActi = 9;
               |SI #mode130@#3 ! "          ";
                  Calc = Cont + 10;
                  #rem00031#Calc# = #rem00031#Calc# + #mode130@#29;
               |FINSI;
            |FINSI;
         |FINSI;
      |SINO;
         || Leo y guardo los datos del modelo 131
         |SI Comunidad = 1;
            #mode131@#0 = #recapmod#5;
         |SINO;
            #mode131@#0 = #recapmod#0;
         |FINSI;
         #mode131@#1 = 99
         #mode131@#2 = Cont;
         |LEE 010#mode131@.=;
         |SI FSalida = 0; |Y #mode131@#4 ! "01.01.0000";
            |PARA Cont1 = 5; |SI Cont1 [ 40; |HACIENDO Cont1 = Cont1 + 1;
               Calc = Cont + 10;
               |SI #mode131@#Cont1# = nActivid;
                  Calc2 = Cont1 + 6;
                  #rem00031#Calc# = #rem00031#Calc# + #mode131@#Calc2#;
               |FINSI;
            |SIGUE;
         |FINSI;
      |FINSI;
   |SIGUE;
   |GRABA 020#rem00031.n;
   |LEE 010#rem00031.=;

   enEmpresa    = #recapmod#2;
   eaPrograma   = "rem00031";
   eaPunto      = "  ";
   |HAZ ProgramaActivo;

   |LIBERA #rem00031;
|FPRC;

|PROCESO Modulos;
      |SI ModulAct = "A";
         #rem00027#0 = #recapmod#2;
         #rem00027#1 = 1;
         |LEE 010#rem00027.];
         |SI FSalida = 0; |Y #rem00027#0 = #recapmod#2;
            |PARA; |SI FSalida = 0; |Y #rem00027#0 = #recapmod#2; |HACIENDO;
               Linea = #rem00027#1 + 1;
               |LEE 010#rem00027.s;
            |SIGUE;
         |SINO;
            Linea = 1;
         |FINSI;
         |DDEFECTO #rem00027;
         #rem00027#0  = #recapmod#2;
         #rem00027#1  = Linea;
         |SI #recapmod#3 = "T";
            #rem00027#2 = "TITULAR";
         |SINO;
            #rem00027#2 = "CONYUGE";
         |FINSI;
         #rem00027#14  = #activid@#14; || Actividad comunera S/N
         |SI #rem00027#14 = "S";
            #rem00027#15 = #comulin@#6;
         |FINSI;
         #rem00027#16  = #activid@#4;  || Letra epigrafe
         #rem00027#17  = #activid@#5;  || Codigo Epigrafe
         #rem00027#19  = #cliente@#1;  || Nif Entidad
         #rem00027#20  = #activid@#6;  || Descripcion de la actividad
         #rem00027#21  = #activid@#11; || Codigo Postal 1
         #rem00027#22  = #activid@#12; || Codigo Postal 2
         #rem00027#23  = #activid@#9;  || Domicilio

         #rem00027#24  = #modulo1@#11; || Definicion elemento 1
         #rem00027#25  = #modulo1@#22; || Definicion elemento 2
         #rem00027#26  = #modulo1@#33; || Definicion elemento 3
         #rem00027#27  = #modulo1@#44; || Definicion elemento 4
         #rem00027#28  = #modulo1@#55; || Definicion elemento 5
         #rem00027#29  = #modulo1@#66; || Definicion elemento 6
         #rem00027#30  = #modulo1@#77; || Definicion elemento 7

         Elem = 1; |HAZ Prorrata; #rem00027#31 = Uni; || Unidades elemento 1
         Elem = 2; |HAZ Prorrata; #rem00027#32 = Uni; || Unidades elemento 2
         Elem = 3; |HAZ Prorrata; #rem00027#33 = Uni; || Unidades elemento 3
         Elem = 4; |HAZ Prorrata; #rem00027#34 = Uni; || Unidades elemento 4
         Elem = 5; |HAZ Prorrata; #rem00027#35 = Uni; || Unidades elemento 5
         Elem = 6; |HAZ Prorrata; #rem00027#36 = Uni; || Unidades elemento 6
         Elem = 7; |HAZ Prorrata; #rem00027#37 = Uni; || Unidades elemento 7

         #rem00027#38  = #modulo1@#12;   || Importe modulo 1
         #rem00027#39  = #modulo1@#23;   || Importe modulo 2
         #rem00027#40  = #modulo1@#34;   || Importe modulo 3
         #rem00027#41  = #modulo1@#45;   || Importe modulo 4
         #rem00027#42  = #modulo1@#56;   || Importe modulo 5
         #rem00027#43  = #modulo1@#67;   || Importe modulo 6
         #rem00027#44  = #modulo1@#78;   || Importe modulo 7

         #rem00027#45  = #modulo1@#16;   || Rendimiento modulo 1
         #rem00027#46  = #modulo1@#27;   || Rendimiento modulo 2
         #rem00027#47  = #modulo1@#38;   || Rendimiento modulo 3
         #rem00027#48  = #modulo1@#49;   || Rendimiento modulo 4
         #rem00027#49  = #modulo1@#60;   || Rendimiento modulo 5
         #rem00027#50  = #modulo1@#71;   || Rendimiento modulo 6
         #rem00027#51  = #modulo1@#82;   || Rendimiento modulo 7

         Comodin = #rem00027#17; |QBF Comodin;
         |SI Comodin = "7211"; |O Comodin = "7213";
            #rem00027#40 = 22500;
            #rem00027#47 = #rem00027#33 * #rem00027#40;
         |FINSI;
         |SI Comodin = "7212";
            #rem00027#40 = 9;
            #rem00027#47 = #rem00027#33 * #rem00027#40;
         |FINSI;
         |SI Comodin = "722 ";
            #rem00027#39 = 2195000;
            #rem00027#40 = 39000;
            #rem00027#46 = #rem00027#32 * #rem00027#39;
            #rem00027#47 = #rem00027#33 * #rem00027#40;
         |FINSI;
         |SI Comodin = "757 ";
            #rem00027#39 = 2209000;
            #rem00027#40 = 26000;
            #rem00027#46 = #rem00027#32 * #rem00027#39;
            #rem00027#47 = #rem00027#33 * #rem00027#40;
         |FINSI;


         #rem00027#52  = #modulo1@#115;  || Rendimiento neto previo

         #rem00027#53  = #modulo2@#3;    || Incremento o porcentaje
         #rem00027#54  = #modulo2@#4;    || N§ Asalariados anterior 1
         #rem00027#55  = #modulo2@#6;    || N§ Asalariados actual 1

         #rem00027#57  = #modulo2@#9;    || Pesetas asalariado 1
         #rem00027#58  = #modulo2@#90;   || Total incentivo 1
         #rem00027#59  = #modulo2@#83;   || N§ Asalariados anterior 2
         #rem00027#60  = #modulo2@#85;   || N§ Asalariados actual 2

         #rem00027#62  = #modulo2@#88;   || Pesetas asalariado 2
         #rem00027#63  = #modulo2@#92;   || Total incentivo 2
         #rem00027#64  = #modulo2@#11;   || Casilla 504
         #rem00027#65  = #modulo2@#26;   || Elemento Nuevo
         #rem00027#66  = #modulo2@#27;   || Importe T1
         #rem00027#67  = #modulo2@#28;   || Coeficiente T1
         #rem00027#68  = #modulo2@#29;   || Amortizacion T1
         #rem00027#69  = #modulo2@#30;   || Importe T2
         #rem00027#70  = #modulo2@#31;   || Coeficiente T2
         #rem00027#71  = #modulo2@#32;   || Amortizacion T2
         #rem00027#72  = #modulo2@#33;   || Importe T3
         #rem00027#73  = #modulo2@#34;   || Coeficiente T3
         #rem00027#74  = #modulo2@#35;   || Amortizacion T3
         #rem00027#75  = #modulo2@#36;   || Importe T4
         #rem00027#76  = #modulo2@#37;   || Coeficiente T4
         #rem00027#77  = #modulo2@#38;   || Amortizacion T4
         #rem00027#78  = #modulo2@#39;   || Casilla 505
         #rem00027#79  = #modulo2@#41;   || Casilla 506
         #rem00027#80  = #modulo2@#44;   || Coeficiente Quiosco
         #rem00027#81  = #modulo2@#45;   || Importe Quiosco
         #rem00027#82  = #modulo2@#48;   || Coeficiente Taxis
         #rem00027#83  = #modulo2@#49;   || Importe Taxis
         #rem00027#84  = #modulo2@#52;   || Coeficiente Urbanos
         #rem00027#85  = #modulo2@#53;   || Importe Urbanos
         #rem00027#86  = #modulo2@#56;   || Coeficiente Mercancia
         #rem00027#87  = #modulo2@#57;   || Importe Mercancia
         #rem00027#88  = #modulo2@#60;   || Coeficiente peque¤a dimension
         #rem00027#89  = #modulo2@#61;   || Importe peque¤a dimension
         #rem00027#90  = #modulo2@#65;   || Dias temporada
         #rem00027#91  = #modulo2@#66;   || Coeficiente temporada
         #rem00027#92  = #modulo2@#67;   || Importe Temporada

         #rem00027#94  = #modulo2@#72;   || Importe exceso

         #rem00027#96  = #modulo2@#75;   || Coeficiente nueva actividad
         #rem00027#97  = #modulo2@#76;   || Importe nueva actividad
         #rem00027#98  = #modulo2@#82;   || Casilla 512

         #rem00027#100 = #modulo2@#99;   || Coeficiente General 97
         #rem00027#101 = #modulo2@#101;  || Coeficiente temporada 97
         #rem00027#102 = #modulo2@#103;  || Coeficiente exceso 97
         #rem00027#103 = #modulo2@#104;  || Importe exceso 97

         #rem00027#105 = #modulo2@#106;  || Rendimiento neto modulo 97
         #rem00027#106 = #modulo2@#113;  || Rendto.neto modulo +10% 97

         #rem00027#111 = #modulo2@#95;   || % Reduccion Ley 50/1998
         #rem00027#112 = #modulo2@#96;   || Reduccion Ley 50/1998
         #rem00027#113 = #modulo2@#78;   || Otras reducciones empresariales

         |HAZ Recalcula;

         |GRABA 020#rem00027.n;
         enEmpresa    = #recapmod#2;
         eaPrograma   = "rem00027";
         eaPunto      = "  ";
         |HAZ ProgramaActivo;
      |FINSI;
|FPRC;

|PROCESO Incentivo97;
     nPorce1 = 0;
     |SI nDifer > 0;  nPorce1 = nDifer * .60;  |FINSI;

     nPorce2 = 0;
     |SI #rem00027#53 = "I";
         |SI nResto > 8;
             nPorce  = nResto - 8;
             nPorce2 = nPorce2 + (nPorce * 0.70);
             nResto  = 8;
         |FINSI;

         |SI nResto > 5;
             nPorce  = nResto - 5;
             nPorce2 = nPorce2 + (nPorce * 0.75);
             nResto  = 5;
         |FINSI;

         |SI nResto > 3;
             nPorce  = nResto - 3;
             nPorce2 = nPorce2 + (nPorce * 0.80);
             nResto  = 3;
         |FINSI;

         |SI nResto > 1;
             nPorce  = nResto - 1;
             nPorce2 = nPorce2 + (nPorce * 0.85);
             nResto  = 1;
         |FINSI;

         |SI nResto > 0;
             nPorce2 = nPorce2 + (nResto * 0.90);
         |FINSI;
     |FINSI;

     |SI #rem00027#53 = "P";
         |SI nResto > 0;    |Y nResto [ 1;  nPorce2 = 0.90;  |FINSI;
         |SI nResto ] 1.01; |Y nResto [ 3;  nPorce2 = 0.85;  |FINSI;
         |SI nResto ] 3.01; |Y nResto [ 5;  nPorce2 = 0.80;  |FINSI;
         |SI nResto ] 5.01; |Y nResto [ 8;  nPorce2 = 0.75;  |FINSI;
         |SI nResto > 8;                    nPorce2 = 0.70;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Incentivo99;
     nPorce1 = 0;
     |SI nDifer > 0;  nPorce1 = nDifer * .40;  |FINSI;

     nPorce2 = 0;
     |SI #rem00027#53 = "I";
         |SI nResto > 8;
             nPorce  = nResto - 8;
             nPorce2 = nPorce2 + (nPorce * 0.30);
             nResto  = 8;
         |FINSI;

         |SI nResto > 5;
             nPorce  = nResto - 5;
             nPorce2 = nPorce2 + (nPorce * 0.25);
             nResto  = 5;
         |FINSI;

         |SI nResto > 3;
             nPorce  = nResto - 3;
             nPorce2 = nPorce2 + (nPorce * 0.20);
             nResto  = 3;
         |FINSI;

         |SI nResto > 1;
             nPorce  = nResto - 1;
             nPorce2 = nPorce2 + (nPorce * 0.15);
             nResto  = 1;
         |FINSI;

         |SI nResto > 0;
             nPorce2 = nPorce2 + (nResto * 0.10);
         |FINSI;
     |FINSI;

     |SI #rem00027#53 = "P";
         |SI nResto > 0;    |Y nResto [ 1;  nPorce2 = 0.10;  |FINSI;
         |SI nResto ] 1.01; |Y nResto [ 3;  nPorce2 = 0.15;  |FINSI;
         |SI nResto ] 3.01; |Y nResto [ 5;  nPorce2 = 0.20;  |FINSI;
         |SI nResto ] 5.01; |Y nResto [ 8;  nPorce2 = 0.25;  |FINSI;
         |SI nResto > 8;                    nPorce2 = 0.30;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Recalcula;
     nTecla = FSalida;

     || CALCULO DEL RDTO EN 1998

     |ABRE #reelea97;
     #reelea97#0 = #rem00027#16;
     #reelea97#1 = #rem00027#17;
     #reelea97#2 = #rem00027#18;
     |LEE 040#reelea97.=;
     |SI FSalida ! 0;  |DDEFECTO #reelea97;  |FINSI;
     |CIERRA #reelea97;

     nResto   = #rem00027#54 + #rem00027#59;
     nPorce1  = 0;
     nPorce2  = 0;
     nDifer   = (#rem00027#55 + #rem00027#60) - (#rem00027#54 + #rem00027#59);
     |SI nDifer < 0;  nResto = #rem00027#55 + #rem00027#60;  |FINSI;
     |HAZ Incentivo97;
     nPorceL1 = 0;
     nPorceL2 = 0;
     |SI #rem00027#55 ! 0;
         nPorceL1 = nPorce1 + (nPorce2 * (#rem00027#55 / (#rem00027#55 + #rem00027#60)));
     |FINSI;
     |SI #rem00027#60 ! 0;
         nPorceL2 = nPorce1 + (nPorce2 * (#rem00027#60 / (#rem00027#55 + #rem00027#60)));
     |FINSI;

     |SI #rem00027#59 = 0;  |Y #rem00027#60 =  0;
         #rem00027#99 = nPorceL1 * #reelea97#6;
         #rem00027#99 = #rem00027#99 + (#rem00027#32  * #reelea97#9);
     |SINO;
         #rem00027#99 = nPorceL1 * #reelea97#6;
         #rem00027#99 = #rem00027#99 + (nPorceL2 * #reelea97#9);
     |FINSI;

     #rem00027#99 = #rem00027#99 + (#rem00027#33  * #reelea97#12);
     #rem00027#99 = #rem00027#99 + (#rem00027#34  * #reelea97#15);
     #rem00027#99 = #rem00027#99 + (#rem00027#35  * #reelea97#18);
     #rem00027#99 = #rem00027#99 + (#rem00027#36  * #reelea97#21);
     #rem00027#99 = #rem00027#99 + (#rem00027#37  * #reelea97#24);

     #rem00027#104 = #reelea97#25;

     #rem00027#105 = #rem00027#99;
     |SI #rem00027#100 ! 0;  #rem00027#105 = #rem00027#105 * #rem00027#100;  |FINSI;
     |SI #rem00027#101 ! 0;  #rem00027#105 = #rem00027#105 * #rem00027#101;  |FINSI;

     #rem00027#102 = 0;
     nDife     = #rem00027#105 - #rem00027#104;
     nCanti    = #rem00027#104 + (nDife * 1.30);
     |SI nDife < 0;  nCanti = 0;  |FINSI;
     |SI #reelea97#25 = 0;  nCanti = 0;  |FINSI;
     |SI nCanti ! 0; #rem00027#105 = nCanti;  #rem00027#102 = 1.30;  |FINSI;

     #rem00027#106 = #rem00027#105 * 1.10;

     || CALCULO DEL RENDIMIENTO EN 1999

     #rem00027#52 = 0;
     |PARA nCampo = 45;  |SI nCampo [ 51;  |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo - 14;
           nCampo2 = nCampo - 7;
           #rem00027#nCampo# = #rem00027#nCampo1# * #rem00027#nCampo2#;
           #rem00027#52 = #rem00027#52 + #rem00027#nCampo#;
     |SIGUE;

     |ABRE #reeleact;
     #reeleact#0 = #rem00027#16;
     #reeleact#1 = #rem00027#17;
     #reeleact#2 = #rem00027#18;
     |LEE 040#reeleact.=;
     |SI FSalida ! 0;  |DDEFECTO #reeleact;  |FINSI;
     |CIERRA #reeleact;

     nSwAsala2 = 0;
     aAlfa     = #reeleact#1 % 103;
     |SI aAlfa = "644";  nSwAsala2 = 1;  |FINSI;

     #rem00027#55 = #rem00027#31;
     #rem00027#57 = #rem00027#38;
     #rem00027#60 = 0;
     #rem00027#62 = 0;
     |SI nSwAsala2 = 1;  #rem00027#60 = #rem00027#32;  #rem00027#62 = #rem00027#39;  |FINSI;

     || Minoracion de Empleo

     nResto   = #rem00027#54 + #rem00027#59;
     #rem00027#56 = 0;
     #rem00027#61 = 0;
     #rem00027#58 = 0;
     #rem00027#63 = 0;
     nPorce1  = 0;
     nPorce2  = 0;
     nDifer   = (#rem00027#55 + #rem00027#60) - (#rem00027#54 + #rem00027#59);
     |SI nDifer < 0;  nResto = #rem00027#55 + #rem00027#60;  |FINSI;
     |HAZ Incentivo99;
     #rem00027#56 = 0;
     #rem00027#61 = 0;
     |SI #rem00027#55 ! 0;
         #rem00027#56   = nPorce1 + (nPorce2 * (#rem00027#55 / (#rem00027#55 + #rem00027#60)));
     |FINSI;
     |SI #rem00027#60 ! 0;
         #rem00027#61   = nPorce1 + (nPorce2 * (#rem00027#60 / (#rem00027#55 + #rem00027#60)));
     |FINSI;

     #rem00027#58   = #rem00027#57 * #rem00027#56;
     #rem00027#63   = #rem00027#62 * #rem00027#61;
     #rem00027#64   = #rem00027#58 + #rem00027#63;

     || Minoracion Inversion

     #rem00027#78 = #rem00027#65 + #rem00027#68 + #rem00027#71 + #rem00027#74 + #rem00027#77;

     ||  Rdto Neto Minorado

     #rem00027#79 = #rem00027#52 - #rem00027#64 - #rem00027#78;

     ||  Quioscos

     #rem00027#81  = #rem00027#79 * #rem00027#80;
     |SI #reeleact#32 = "N";     #rem00027#81 = 0;  |FINSI;
     |SI #rem00027#81 < 0;    #rem00027#81 = 0;  |FINSI;

     ||  Taxis

     #rem00027#83  = #rem00027#79 * #rem00027#82;
     |SI #reeleact#33 = "N";     #rem00027#83 = 0;  |FINSI;
     |SI #rem00027#83 < 0;    #rem00027#83 = 0;  |FINSI;

     ||  Urbanos

     #rem00027#85  = #rem00027#79 * #rem00027#84;
     |SI #reeleact#35 = "N";     #rem00027#85 = 0;  |FINSI;
     |SI #rem00027#85 < 0;    #rem00027#85 = 0;  |FINSI;

     ||  Mercancias

     #rem00027#87  = #rem00027#79 * #rem00027#86;
     |SI #reeleact#34 = "N";     #rem00027#87 = 0;  |FINSI;
     |SI #rem00027#55 ! 0;    #rem00027#87 = 0;  |FINSI;
     |SI #rem00027#60 ! 0;    #rem00027#87 = 0;  |FINSI;
     |SI #rem00027#87 < 0;    #rem00027#87 = 0;  |FINSI;

     ||  Empresas Peque¤as dimensiones

     nCampoRdto = 79;
     |SI #rem00027#81 ! 0;  nCampoRdto = 81;  |FINSI;

     #rem00027#89 = #rem00027#nCampoRdto# * #rem00027#88;
     |SI #rem00027#83 ! 0; |O #rem00027#85 ! 0; |O #rem00027#87 ! 0;
         #rem00027#89 = 0;
     |FINSI;
     |SI #rem00027#88 = 0.8;  |Y #rem00027#100 = 0;
         #rem00027#100 = #rem00027#88;
     |FINSI;

     |SI #rem00027#89 < 0;  #rem00027#89 = 0;  |FINSI;

     ||  Temporada

     nCampoRdto = 79;
     |SI #rem00027#81 ! 0;  nCampoRdto = 81;  |FINSI;
     |SI #rem00027#83 ! 0;  nCampoRdto = 83;  |FINSI;
     |SI #rem00027#85 ! 0;  nCampoRdto = 85;  |FINSI;
     |SI #rem00027#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #rem00027#89 ! 0;  nCampoRdto = 89;  |FINSI;

     #rem00027#92 = #rem00027#nCampoRdto# * #rem00027#91;
     |SI #rem00027#92 < 0;  #rem00027#92 = 0;  |FINSI;

     || Exceso

     nCampoRdto = 79;
     |SI #rem00027#81 ! 0;  nCampoRdto = 81;  |FINSI;
     |SI #rem00027#83 ! 0;  nCampoRdto = 83;  |FINSI;
     |SI #rem00027#85 ! 0;  nCampoRdto = 85;  |FINSI;
     |SI #rem00027#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #rem00027#89 ! 0;  nCampoRdto = 89;  |FINSI;
     |SI #rem00027#92 ! 0;  nCampoRdto = 92;  |FINSI;

     #rem00027#95  = #reeleact#31;
     #rem00027#93  = #rem00027#nCampoRdto# - #rem00027#95;
     #rem00027#94  = #rem00027#95 + (#rem00027#93 * 1.30);
     |SI #rem00027#93 < 0;  #rem00027#94 = 0;  |FINSI;
     |SI #reeleact#31    = 0;  #rem00027#94 = 0;  |FINSI;
     |SI #rem00027#89 ! 0;  #rem00027#94 = 0;  |FINSI;

     || Nueva Actividad

     nCampoRdto = 79;
     |SI #rem00027#81 ! 0;  nCampoRdto = 81;  |FINSI;
     |SI #rem00027#83 ! 0;  nCampoRdto = 83;  |FINSI;
     |SI #rem00027#85 ! 0;  nCampoRdto = 85;  |FINSI;
     |SI #rem00027#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #rem00027#89 ! 0;  nCampoRdto = 89;  |FINSI;
     |SI #rem00027#92 ! 0;  nCampoRdto = 92;  |FINSI;
     |SI #rem00027#94 ! 0;  nCampoRdto = 94;  |FINSI;

     #rem00027#97 = #rem00027#nCampoRdto# * #rem00027#96;
     |SI #rem00027#92 ! 0;  #rem00027#97 = 0;  |FINSI;
     |SI #rem00027#97 < 0;  #rem00027#97 = 0;  |FINSI;


     || Rendimiento Neto Modulos Ajustado

     nCampoRdto = 79;
     |SI #rem00027#81 ! 0;  nCampoRdto = 81;  |FINSI;
     |SI #rem00027#83 ! 0;  nCampoRdto = 83;  |FINSI;
     |SI #rem00027#85 ! 0;  nCampoRdto = 85;  |FINSI;
     |SI #rem00027#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #rem00027#89 ! 0;  nCampoRdto = 89;  |FINSI;
     |SI #rem00027#92 ! 0;  nCampoRdto = 92;  |FINSI;
     |SI #rem00027#94 ! 0;  nCampoRdto = 94;  |FINSI;
     |SI #rem00027#97 ! 0;  nCampoRdto = 97;  |FINSI;

     #rem00027#98  = #rem00027#nCampoRdto#;

     #rem00027#108 = #rem00027#98;
     |SI #rem00027#106 < #rem00027#108;  |Y #rem00027#106 ! 0;
         #rem00027#108 = #rem00027#106;
     |FINSI;

     #rem00027#107 = #rem00027#98 - #rem00027#108;

     || Rendimiento Neto Calculado

     #rem00027#110 = #rem00027#108 - #rem00027#109;

     || Reduccion Ley 50/1998

     #rem00027#112 = 0;
     |SI #rem00027#110 > 0;
         #rem00027#112 = #rem00027#110 % #rem00027#111;
     |FINSI;

     || Rdto Neto

     #rem00027#114 = #rem00027#110 - #rem00027#112 + #rem00027#113;

     || Reduccion Articulo 30 Ley 40/1998

     #rem00027#116 = 0;
     |SI #rem00027#115 = "S";
          #rem00027#116 = #rem00027#114 % 30;
     |FINSI;

     || Rdto Neto Reducido

     #rem00027#117 = #rem00027#114 - #rem00027#116;

|FPRC;

|PROGRAMA;
   |HAZ QueVersion;

   || Revisar Paths de Agicli

   |DBASS Comodin; |QBF Comodin;
   Comodin1 = Comodin + "agicli/def/agicontr.mas";
   |CARGA_DEF Comodin1,contrab@;
   |PATH_DAT #17 Comodin;

   |ABRE #contrab@;
   |LEE 010#contrab@.p;
   |SI FSalida = 0;
      Path = #contrab@#3;
      |QBF Path;
      |SI Path = "*"; |O Path = "";
         |DBASS Comodin; |QBF Comodin;
         Path = Comodin + "agieos/fich/";
      |FINSI;
   |SINO;
      |DBASS Comodin; |QBF Comodin;
      Path = Comodin + "agieos/fich/";
   |FINSI;
   |CIERRA #contrab@;
   |DESCARGA_DEF #contrab@;

   |SI enEmpresa ! 0;
      #0#0 = enEmprEos;
      #0#1 = enActiEos;
      #0#2 = enEmprRen;
      #0#4 = eaCaracter;
      #0#3 = eaTitCony;
      FSalida = 0;
   |SINO;
      |CLS;
      |CABEZA "Captura datos Mod.130/131 y modulos de REO a renta"
      |PINPA #0#0;
      |PINDA #0#0;
      Comodin1 = Comodin + "agieos/def/eosactiv.mas";
      |CARGA_DEF Comodin1,activid@;
      |PATH_DAT #3 Path;
      |ABRE #activid@;

      |ENDATOS #1#0;
      FEstado = FSalida;
      |CIERRA #activid@;
      |DESCARGA_DEF #activid@;
      FSalida = FEstado;
   |FINSI;
   |SI FSalida = 0;
      Comodin = Comodin + "agieos/def/";
      Comodin1 = Comodin + "eosactiv.mas";
      |CARGA_DEF Comodin1,activid@;
      Comodin1 = Comodin + "eosclien.mas";
      |CARGA_DEF Comodin1,cliente@;
      Comodin1 = Comodin + "eosm0017.mas";
      |CARGA_DEF Comodin1,modulo1@;
      Comodin1 = Comodin + "eosm0018.mas";
      |CARGA_DEF Comodin1,modulo2@;
      Comodin1 = Comodin + "eoscomul.mas";
      |CARGA_DEF Comodin1,comulin@;
      Comodin1 = Comodin + "eosm0011.mas";
      |CARGA_DEF Comodin1,refecat@;
      Comodin1 = Comodin + "eosm0012.mas";
      |CARGA_DEF Comodin1,regicat@;
      Comodin1 = Comodin + "eosm0020.mas";
      |CARGA_DEF Comodin1,mode131@;
      Comodin1 = Comodin + "eosm3130.mas";
      |CARGA_DEF Comodin1,mode130@;
      Comodin1 = Comodin + "eosm0011.mas";
      |CARGA_DEF Comodin1,refecat@;
      Comodin1 = Comodin + "eosm0012.mas";
      |CARGA_DEF Comodin1,regicat@;

      |PATH_DAT #3  Path;
      |PATH_DAT #4  Path;
      |PATH_DAT #9  Path;
      |PATH_DAT #10 Path;
      |PATH_DAT #11 Path;
      |PATH_DAT #13 Path;
      |PATH_DAT #14 Path;
      |PATH_DAT #15 Path;
      |PATH_DAT #16 Path;
      |PATH_DAT #17 Path;

      |ABRE #reeoscnc;
      |ABRE #cliente@;
      |ABRE #comulin@;
      |ABRE #rem00031;
      |ABRE #rem00027;
      |ABRE #mode130@;
      |ABRE #mode131@;
      |ABRE #refecat@;
      |ABRE #regicat@;
      |ABRE #contrab@;
      |ABRE #reeoscnc;
      |ABRE #activid@;
      |ABRE #modulo1@;
      |ABRE #modulo2@;
      |SELECT #2#comulin@;
      Comun = 0;

      #cliente@#0 = #recapmod#0;
      |LEE 010#cliente@.=;
      #activid@#0 = #recapmod#0;
      #activid@#1 = #recapmod#1;
      #activid@#2 = 99;
      |LEE 010#activid@.=;
      |SI FSalida = 0;

         Comunidad = 0;
         Salir = 0;
         |SI #activid@#46 = "S";
            Comunidad = 1;
            #comulin@#3 = #recapmod#5;
            #comulin@#5 = #recapmod#6;
            #comulin@#7 = 99;
            |LEE 010#comulin@.=;
            |SI FSalida = 0;
               ModulAct = #activid@#22;
               nActivid = #recapmod#6;
               Comun = 1;
               #cliente@#0 = #recapmod#5;
               |LEE 010#cliente@.=;
               #activid@#0 = #recapmod#5;
               #activid@#1 = #recapmod#6;
               #activid@#2 = 99;
               |LEE 010#activid@.=;
            |SINO;
               Salir = 1;
            |FINSI;
         |SINO;
            Comun = 0;
            ModulAct = #activid@#22;
            nActivid = #recapmod#1;
         |FINSI;

         |SI Salir = 0;
            #modulo1@#0 = #recapmod#0;
            #modulo1@#5 = 99;
            #modulo1@#1 = #recapmod#1;
            |LEE 010#modulo1@.=;

            #modulo2@#0 = #recapmod#0;
            #modulo2@#2 = 99;
            #modulo2@#1 = #recapmod#1;
            |LEE 010#modulo2@.=;

            |HAZ Modulos;
            |HAZ PagosACuenta;
         |FINSI;
      |FINSI;

      |SELECT #1#comulin@;
      |CIERRA #activid@;
      |CIERRA #modulo2@;
      |CIERRA #modulo1@;
      |CIERRA #reeoscnc;
      |CIERRA #contrab@;
      |CIERRA #regicat@;
      |CIERRA #refecat@;
      |CIERRA #mode130@;
      |CIERRA #mode131@;
      |CIERRA #rem00027;
      |CIERRA #rem00031;
      |CIERRA #comulin@;
      |CIERRA #cliente@;
      |CIERRA #reeoscnc;

      |DESCARGA_DEF #regicat@;
      |DESCARGA_DEF #refecat@;
      |DESCARGA_DEF #cliente@;
      |DESCARGA_DEF #activid@;
      |DESCARGA_DEF #modulo1@;
      |DESCARGA_DEF #modulo2@;
      |DESCARGA_DEF #comulin@;
      |DESCARGA_DEF #mode130@;
      |DESCARGA_DEF #mode131@;

   |FINSI;
|FPRO;
