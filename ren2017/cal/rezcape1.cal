|FICHEROS;
     repobibi;
     rem00020;
     rem00021 #21;
     rem00042;
     rem00048;
     rem00056;
     rem00100;
     rem00101;
     rem00102;

     rem00020@;
     rem00021@ #121;
     rem00100@;
     rem00101@;
     rem00102@;
     rem01001@;
     rem01011@;
|FIN;

|INCLUYE capeac99;

|| REM00021 y REM00042

|PROCESO GrabaREM00042;
     |ABRE #rem00042;
     |SELECT #1#rem00042;
     #rem00042#0 = #rem00021@#0;
     #rem00042#1 = 99;
     |LEE 040#rem00042.];
     |SI FSalida = 0;
         |LEE 040#rem00042.a;
     |SINO;
         |LEE 040#rem00042.u;
     |FINSI;

     |SI FSalida = 0; |Y #rem00042#0 = #rem00021@#0;
         nLinea = #rem00042#1 + 1;
     |SINO;
         nLinea = 1;
     |FINSI;

     |DDEFECTO #rem00042;

     #rem00042#0   = #rem00021@#0;
     #rem00042#1   = nLinea;
     #rem00042#2   = #rem00021@#2;
     #rem00042#3 = "X";

     |SI eaCampo37 = "N";
         #rem00042#3 = #rem00021@#3;
     |FINSI;

     |SI #rem00042#3 = "A";
         #rem00042#3 = "R";
     |FINSI;

     #rem00042#4   = 0;
     #rem00042#5   = #rem00021@#5;
     #rem00042#6   = #rem00021@#6;
     #rem00042#7   = #rem00021@#7;
     #rem00042#8   = #rem00021@#8;
     #rem00042#9   = #rem00021@#9;
     #rem00042#10  = #rem00021@#10;
     #rem00042#11  = "G";
     #rem00042#14  = #rem00021@#68;
     #rem00042#15  = #rem00021@#13;
     #rem00042#16  = #rem00021@#69;
     #rem00042#17  = #rem00021@#75;
     #rem00042#18  = #rem00021@#75 - #rem00021@#76;
     #rem00042#19  = #rem00021@#108;
     #rem00042#20  = 0;
     #rem00042#13  = 0;
     #rem00042#21  = 1;
     #rem00042#22  = "T";

                              #rem00042#23 = "";
     |SI #rem00042#3  = "X";  #rem00042#23 = eaRojo;        |FINSI;

     |GRABA 020#rem00042.n;
     |LIBERA #rem00042;
     |CIERRA #rem00042;

     eaPrograma = "rem00042";
     eaPunto    = "";
     |HAZ ProgramaActivo;
|FPRC;

|PROCESO rem01011;
     nGastos1 = nGastos1 + #rem01011@#29;
     nGastos2 = nGastos2 + #rem01011@#30;
     nGastos3 = nGastos3 + #rem01011@#31;
     nGastos4 = nGastos4 + #rem01011@#15;
|FPRC;

|DEFBUCLE rem01011;
     #rem01011@#1004;
     9;
     enEmpresa, nComple, aContri, 001, aRefCast;
     enEmpresa, nComple, aContri, 999, aRefCast;
     ;
     NULL, rem01011;
|FIN;

|PROCESO rem01001;
     nComple  = #rem01001@#1;
     aContri  = #rem01001@#2;
     |BUCLE rem01011;
|FPRC;

|DEFBUCLE rem01001;
     #rem01001@#1003;
     5;
     enEmpresa, 00, "          ", "100";
     enEmpresa, 99, "zzzzzzzzzz", "101";
     ;
     NULL, rem01001;
|FIN;

|PROCESO RecogeGastos;
     aDef = eaCampo0 + "/def/rem01001.mas";  |QBT aDef;
     |CARGA_DEF aDef, rem01001@;
     |SI FSalida ! 0;

         |ACABA;
     |FINSI;

     aDef = eaCampo0 + "/def/rem01011.mas";  |QBT aDef;
     |CARGA_DEF aDef, rem01011@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def rem01011 A¤o 2016 ";
         |MENAV aAlfa;

         |DESCARGA_DEF #rem01001@;

         |ACABA;
     |FINSI;

     |PATH_DAT #rem01001@#eaPathRen2016#;
     |PATH_DAT #rem01011@#eaPathRen2016#;

     nGastos1 = 0;
     nGastos2 = 0;
     nGastos3 = 0;
     nGastos4 = 0;
     |BUCLE rem01001;

     |DESCARGA_DEF #rem01011@;
     |DESCARGA_DEF #rem01001@;
|FPRC;

|PROCESO Pasa021;
     |SI #rem00021@#24 = "S";
         |SI eaCampo39 = "S";
             |SI #rem00021@#75 = 0;
                 |ACABA;
             |FINSI;

             |SI #rem00021@#76 ] #rem00021@#75;
                 |ACABA;
             |FINSI;

             |HAZ GrabaREM00042;
         |FINSI;

         |ACABA;
     |FINSI;

     #rem00021#0 = #rem00021@#0;
     #rem00021#1 = #rem00021@#1;
     |LEE 101#rem00021.=;
     |SI FSalida = 0;
         |BORRA 020#rem00021.a;
         |LIBERA #rem00021;
     |FINSI;

     |DDEFECTO #rem00021;

     #rem00021#0   = #rem00021@#0;
     #rem00021#1   = #rem00021@#1;
     #rem00021#2   = #rem00021@#2;
     #rem00021#3   = "X";

     |SI eaCampo37 = "N";
         #rem00021#3 = #rem00021@#3;
     |FINSI;

     #rem00021#4   = 0;
     #rem00021#5   = #rem00021@#5;
     #rem00021#6   = #rem00021@#6;
     #rem00021#7   = #rem00021@#7;
     #rem00021#8   = #rem00021@#8;
     #rem00021#9   = #rem00021@#9;
     #rem00021#10  = #rem00021@#10;
     #rem00021#13  = #rem00021@#13;
     #rem00021#14  = #rem00021@#14;
     #rem00021#15  = #rem00021@#15;
     #rem00021#16  = #rem00021@#16;
     #rem00021#17  = #rem00021@#17;
     #rem00021#18  = #rem00021@#18;
     #rem00021#19  = #rem00021@#19;
     #rem00021#20  = #rem00021@#20;
     #rem00021#21  = #rem00021@#21;
     #rem00021#22  = #rem00021@#22;
     #rem00021#23  = #rem00021@#23;
     #rem00021#25  = #rem00021@#25;
     #rem00021#26  = #rem00021@#26;
     #rem00021#27  = #rem00021@#27;
     #rem00021#28  = #rem00021@#28;
     #rem00021#29  = #rem00021@#29;
     #rem00021#95  = #rem00021@#95;
     #rem00021#96  = #rem00021@#96;
     #rem00021#97  = #rem00021@#97;
     #rem00021#98  = #rem00021@#98;
     #rem00021#99  = #rem00021@#99;
     #rem00021#100 = #rem00021@#100;
     #rem00021#101 = #rem00021@#101;
     #rem00021#102 = #rem00021@#102;
     #rem00021#103 = #rem00021@#103;

     #rem00021#104 = #rem00021@#104;
     #rem00021#105 = #rem00021@#105;
     #rem00021#106 = #rem00021@#106;
     #rem00021#117 = "N";
     #rem00021#118 = #rem00021@#118;
     #rem00021#119 = #rem00021@#119;
     #rem00021#120 = #rem00021@#120;
     #rem00021#121 = #rem00021@#121;
     #rem00021#122 = #rem00021@#122;
     #rem00021#123 = #rem00021@#123;
     #rem00021#124 = #rem00021@#124;

     |PARA nCampoPase = 30;  |SI nCampoPase [ 61;  |HACIENDO nCampoPase = nCampoPase + 1;
           #rem00021#nCampoPase# = #rem00021@#nCampoPase#;
     |SIGUE;

     #rem00021#38  = #rem00021@#38;
     #rem00021#40  = #rem00021@#40;
     #rem00021#42  = #rem00021@#42;
     #rem00021#44  = #rem00021@#44;
     #rem00021#45  = #rem00021@#45;
     #rem00021#45  = #rem00021@#45;
     #rem00021#47  = #rem00021@#47;
     #rem00021#45  = #rem00021@#45;
     #rem00021#51  = #rem00021@#51;
     #rem00021#51  = #rem00021@#51;
     #rem00021#53  = #rem00021@#53;
     #rem00021#55  = #rem00021@#55;
     #rem00021#57  = #rem00021@#57;
     #rem00021#60  = #rem00021@#60;
     #rem00021#61  = #rem00021@#61;
     #rem00021#116 = #rem00021@#116;
     #rem00021#134 = #rem00021@#134;
     #rem00021#125 = #rem00021@#125;
     #rem00021#126 = #rem00021@#126;
     #rem00021#127 = #rem00021@#127;
     #rem00021#128 = #rem00021@#128;
     #rem00021#129 = #rem00021@#129;
     #rem00021#130 = #rem00021@#130;
     #rem00021#131 = #rem00021@#131;

     |SI #rem00021@#30 ! 0;  |Y  #rem00021@#33 ! 0;
         nSuma = #rem00021@#30 + #rem00021@#33;
         #rem00021#30 = nSuma;
         #rem00021#33 = 0;
     |FINSI;

     |SI #rem00021@#31 ! 0;  |Y  #rem00021@#34 ! 0;
         nSuma = #rem00021@#31 + #rem00021@#34;
         #rem00021#31 = nSuma;
         #rem00021#34 = 0;
     |FINSI;

     |SI #rem00021@#32 ! 0;  |Y  #rem00021@#35 ! 0;
         nSuma = #rem00021@#32 + #rem00021@#35;
         #rem00021#32 = nSuma;
         #rem00021#35 = 0;
     |FINSI;

     |SI eaCampo32 = "N";
         #rem00021#15  = 0;
         #rem00021#21  = 0;
         #rem00021#22  = 0;
         #rem00021#23  = 0;
         #rem00021#29  = 0;
         #rem00021#38  = 0;
         #rem00021#40  = 0;
         #rem00021#42  = 0;
         #rem00021#44  = 0;
         #rem00021#45  = 0;
         #rem00021#47  = 0;
         #rem00021#51  = 0;
         #rem00021#53  = 0;
         #rem00021#55  = 0;
         #rem00021#57  = 0;
         #rem00021#60  = 0;
         #rem00021#61  = 0;
         #rem00021#62  = 0;
         #rem00021#64  = 0;
         #rem00021#66  = 0;
         #rem00021#95  = 0;
         #rem00021#96  = 0;
         #rem00021#97  = 0;
         #rem00021#98  = 0;
         #rem00021#99  = 0;
         #rem00021#100 = 0;
         #rem00021#101 = 0;
         #rem00021#102 = 0;
         #rem00021#122 = 0;
         #rem00021#123 = 0;
         #rem00021#131 = 0;
         #rem00021#133 = 0;
     |FINSI;

     |SI eaCampo30 = "S";
         #rem00021#15 = (N\ #rem00021@#15 + (#rem00021@#15 % eaCampo31));
     |SINO;
         #rem00021#28  = 0;
         #rem00021#103 = 0;
     |FINSI;

     |SI eaCampo29 = "S";
         |ABRE #repobibi;
         #repobibi#0 = #rem00021@#105;
         #repobibi#1 = #rem00021@#106;
         |LEE 000#repobibi.=;
         |SI FSalida ! 0; |DDEFECTO #repobibi; |FINSI;
         |CIERRA #repobibi;

         nSuma  = ((#rem00021@#21 / #repobibi#2) * #repobibi#3);
         nSuma1 = ((#rem00021@#21 / #repobibi#2) * #repobibi#3) % eaCampo31;

         |SI #repobibi#3 ] #repobibi#2;
             #rem00021#21 = (N\ nSuma + nSuma1);
         |SINO;
             #rem00021#21 = (N\ nSuma - nSuma1);
         |FINSI;
     |FINSI;

     |SI #rem00021#30 ] 365;  #rem00021#30 = 365;  |FINSI;
     |SI #rem00021#31 ] 365;  #rem00021#31 = 365;  |FINSI;
     |SI #rem00021#32 ] 365;  #rem00021#32 = 365;  |FINSI;
     |SI #rem00021#33 ] 365;  #rem00021#33 = 365;  |FINSI;
     |SI #rem00021#34 ] 365;  #rem00021#34 = 365;  |FINSI;
     |SI #rem00021#35 ] 365;  #rem00021#35 = 365;  |FINSI;

     enEmpresa = #rem00021#0;
     aRefCast  = #rem00021#14;
     |HAZ RecogeGastos;

     nPorce = 100;

     |SI #rem00021#2 = "VARIOS    ";
         nPorce = #rem00021#5 + #rem00021#6 + #rem00021#7 + #rem00021#8;
         nPorce = nPorce      + #rem00021#9 + #rem00021#10;
     |FINSI;

     nGastos1 = (nGastos1 * 100) / nPorce;
     nGastos2 = (nGastos2 * 100) / nPorce;
     nGastos3 = (nGastos3 * 100) / nPorce;
     nGastos4 = (nGastos4 * 100) / nPorce;

     #rem00021#159 = nGastos1;  || 2013
     |SI #rem00021#159 < 0;  #rem00021#159 = 0;  |FINSI;

     #rem00021#158 = nGastos2;  || 2014
     |SI #rem00021#158 < 0;  #rem00021#158 = 0;  |FINSI;

     #rem00021#157 = nGastos3;  || 2015
     |SI #rem00021#157 < 0;  #rem00021#157 = 0;  |FINSI;

     #rem00021#156 = nGastos4;  || 2016
     |SI #rem00021#156 < 0;  #rem00021#156 = 0;  |FINSI;

     #rem00021#140 = #rem00021#156 + #rem00021#157 + #rem00021#158 + #rem00021#159;

                               #rem00021#143 = "";
     |SI #rem00021#117 = "S";  #rem00021#143 = eaAzul;  |FINSI;
     |SI #rem00021#3   = "X";  #rem00021#143 = eaRojo;  |FINSI;

     |GRABA 020#rem00021.n;
     |LIBERA #rem00021;

     eaPrograma = "rem00021";
     eaPunto    = "";
     |HAZ ProgramaActivo;
|FPRC;

|DEFBUCLE rem00021_2016;
     #rem00021@#1002;
     ;
     enEmpresa, 01;
     enEmpresa, 99;
     ;
     NULL, Pasa021;
|FIN;

|PROCESO PasaM00021;
     aDef = eaCampo0 + "/def/rem00021.mas";  |QBT aDef;
     |CARGA_DEF aDef, rem00021@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def rem00021 A¤o 2016 ";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |PATH_DAT #rem00021@#eaPathRen2016#;

     |ABRE #rem00021;
     |BUCLE rem00021_2016;
     |CIERRA #rem00021;

     |DESCARGA_DEF #rem00021@;
|FPRC;

|| REM00020

|PROCESO Pasa020;
     #rem00020#0 = #rem00020@#0;
     #rem00020#1 = #rem00020@#1;
     |LEE 101#rem00020.=;
     |SI FSalida ! 0;
         |DDEFECTO #rem00020;
         #rem00020#0 = #rem00020@#0;
         #rem00020#1 = #rem00020@#1;
         |GRABA 020#rem00020.b;
     |FINSI;

     #rem00020#2  = #rem00020@#2;
                           #rem00020#3 = "X";
     |SI eaCampo37 = "N";  #rem00020#3 = #rem00020@#3;  |FINSI;

     #rem00020#4  = 0;
     #rem00020#5  = #rem00020@#5;
     #rem00020#8  = #rem00020@#8;
     #rem00020#13 = #rem00020@#13;
     #rem00020#17 = #rem00020@#17;
     #rem00020#29 = #rem00020@#29;
     #rem00020#30 = #rem00020@#30;
     #rem00020#35 = #rem00020@#35;

                              #rem00020#38 = "";
     |SI #rem00020#31 = "S";  #rem00020#38 = eaAzul;  |FINSI;
     |SI #rem00020#3  = "X";  #rem00020#38 = eaRojo;  |FINSI;

     |GRABA 020#rem00020.a;
     |LIBERA #rem00020;
|FPRC;

|DEFBUCLE rem00020_2016;
     #rem00020@#1002;
     ;
     enEmpresa, 01;
     enEmpresa, 99;
     ;
     NULL, Pasa020;
|FIN;

|PROCESO PasaM00020;
     aDef = eaCampo0 + "/def/rem00020.mas";  |QBT aDef;
     |CARGA_DEF aDef, rem00020@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def rem00020 A¤o 2016 ";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |PATH_DAT #rem00020@#eaPathRen2016#;

     |ABRE #rem00020;
     |BUCLE rem00020_2016;
     |CIERRA #rem00020;

     |DESCARGA_DEF #rem00020@;

     eaPrograma = "rem00020";
     eaPunto    = "";
     |HAZ ProgramaActivo;
|FPRC;

|| DATOS VIVIENDA

|PROCESO Pasa102;
     #rem00021@#0  = #rem00102@#0;
     #rem00021@#1  = #rem00102@#12;
     |LEE 000#rem00021@.=;
     |SI FSalida = 0;
         |SI #rem00021@#24 = "S";  |ACABA;  |FINSI;
     |FINSI;


     #rem00102#0 = #rem00102@#0;
     #rem00102#1 = #rem00102@#1;
     |LEE 101#rem00102.=;
     |SI FSalida ! 0;
         |DDEFECTO #rem00102;
         #rem00102#0 = #rem00102@#0;
         #rem00102#1 = #rem00102@#1;
         |GRABA 020#rem00102.b;
     |FINSI;

     |PARA nCampoPase = 0;  |SI nCampoPase [ 16;  |HACIENDO nCampoPase = nCampoPase + 1;
           #rem00102#nCampoPase# = #rem00102@#nCampoPase#;
     |SIGUE;

     |GRABA 020#rem00102.a;
     |LIBERA #rem00102;
|FPRC;

|DEFBUCLE rem00102_2016;
     #rem00102@#1002;
     ;
     enEmpresa, 01;
     enEmpresa, 99;
     ;
     NULL, Pasa102;
|FIN;

|PROCESO DatosVivienda;
     aDef = eaCampo0 + "/def/rem00102.mas";  |QBT aDef;
     |CARGA_DEF aDef, rem00102@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def rem00102 A¤o 2016 ";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     aDef = eaCampo0 + "/def/rem00021.mas";  |QBT aDef;
     |CARGA_DEF aDef, rem00021@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def rem00021 A¤o 2016 ";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |PATH_DAT #rem00102@#eaPathRen2016#;
     |PATH_DAT #rem00021@#eaPathRen2016#;

     |ABRE #rem00102;
     |ABRE #rem00021@;
     |BUCLE rem00102_2016;
     |CIERRA #rem00102;
     |CIERRA #rem00021@;

     |DESCARGA_DEF #rem00021@;
     |DESCARGA_DEF #rem00102@;

     eaPrograma = "rem00102";
     eaPunto    = "";
     |HAZ ProgramaActivo;
|FPRC;

|| DATOS FAMILIARES

|PROCESO Pasa101;
     |SI #rem00101@#21 ] "01.01.2000";
         |ACABA;
     |FINSI;

     #rem00101#0 = #rem00101@#0;
     #rem00101#1 = #rem00101@#1;
     |LEE 101#rem00101.=;
     |SI FSalida ! 0;
         |DDEFECTO #rem00101;
         #rem00101#0 = #rem00101@#0;
         #rem00101#1 = #rem00101@#1;
         |GRABA 020#rem00101.b;
     |FINSI;

     |PARA nCampoPase = 0;  |SI nCampoPase [ 26;  |HACIENDO nCampoPase = nCampoPase + 1;
           #rem00101#nCampoPase# = #rem00101@#nCampoPase#;
     |SIGUE;

     |GRABA 020#rem00101.a;
     |LIBERA #rem00101;
|FPRC;

|DEFBUCLE rem00101_2016;
     #rem00101@#1002;
     ;
     enEmpresa, 01;
     enEmpresa, 99;
     ;
     NULL, Pasa101;
|FIN;

|PROCESO DatosFamiliares;
     aDef = eaCampo0 + "/def/rem00101.mas";  |QBT aDef;
     |CARGA_DEF aDef, rem00101@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def rem00101 A¤o 2016 ";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |PATH_DAT #rem00101@#eaPathRen2016#;

     |ABRE #rem00101;
     |BUCLE rem00101_2016;
     |CIERRA #rem00101;

     |DESCARGA_DEF #rem00101@;
|FPRC;

|| DATOS PERSONALES

|PROCESO DatosPersonales;
     aDef = eaCampo0 + "/def/rem00100.mas";  |QBT aDef;
     |CARGA_DEF aDef, rem00100@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def rem00100 A¤o 2016 ";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |PATH_DAT #rem00100@#eaPathRen2016#;

     |ABRE #rem00100@;
     #rem00100@#0 = enEmpresa;
     |LEE 040#rem00100@.=;
     |SI FSalida = 0;
         |ABRE #rem00100;
         #rem00100#0 = #rem00100@#0;
         |LEE 101#rem00100.=;
         |SI FSalida ! 0;
             |DDEFECTO #rem00100;
             #rem00100#0 = #rem00100@#0;
             |GRABA 020#rem00100.b;
         |FINSI;

         |PARA nCampoPase = 0;  |SI nCampoPase [ 160;  |HACIENDO nCampoPase = nCampoPase + 1;
               #rem00100#nCampoPase# = #rem00100@#nCampoPase#;
         |SIGUE;

         #rem00100#90 = "N";
         #rem00100#91 = " ";
         #rem00100#92 = "01.01.0000";
         #rem00100#97 = "1";

         |GRABA 020#rem00100.a;
         |LIBERA #rem00100;
         |CIERRA #rem00100;
     |FINSI;

     |CIERRA #rem00100@;
     |DESCARGA_DEF #rem00100@;

     eaPrograma = "rem00100";
     eaPunto    = "";
     |HAZ ProgramaActivo;
|FPRC;

|PROGRAMA;
     |SI eaCampo38 = "S";
         |HAZ DatosPersonales;
         |HAZ DatosFamiliares;
         |HAZ DatosVivienda;
     |FINSI;

     |SI eaCampo24 = "S";  |HAZ PasaM00020;       |FINSI;
     |SI eaCampo25 = "S";  |HAZ PasaM00021;       |FINSI;
|FPRO;
