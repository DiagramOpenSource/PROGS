|FICHEROS;
      retabla1 #1;
      retabla2 #2;

      rem00100 #10;

      rem01033@ #33;
      rem01041@ #41;
      rem01042@ #42;

     &refere1@ #101;
     &refere2@ #102;
     &refere3@ #103;
|FIN;

|VARIABLES;
|FIN;

|INCLUYE i_varcal;

|PROCESO EstatalGeneral;
     |ABRE #retabla2;
     #retabla2#0 = nCodAutonomico;
     |LEE 040#retabla2.=;
     |SI FSalida ! 0;
         #retabla2#0 = 0;
         |LEE 040#retabla2.=;
         |SI FSalida ! 0;  |DDEFECTO #retabla2;  |FINSI;
     |FINSI;
     |CIERRA #retabla2;

     |PARA nCampo4 = 81;  |SI nCampo4 ] 45;  |HACIENDO nCampo4 = nCampo4 - 4;
           |SI #retabla2#nCampo4# ! 0;
               nCampo1 = nCampo4 - 3;
               nCampo2 = nCampo4 - 2;
               |SI enLimite1 = 0;
                   nParte1 = #retabla2#nCampo2#;
                   nResta1 = #retabla2#nCampo1#;
                   nTipo1  = #retabla2#nCampo4#;
               |SINO;
                   enLimite2 = #retabla2#nCampo1#;
                   |SI nCuotaT [ enLimite1;  |Y nCuotaT > enLimite2;
                       nParte1 = #retabla2#nCampo2#;
                       nResta1 = #retabla2#nCampo1#;
                       nTipo1  = #retabla2#nCampo4#;
                   |FINSI;
               |FINSI;
               enLimite1 = #retabla2#nCampo1#;
           |FINSI;
     |SIGUE;

     |SI nCuotaT = 0;
         nParte1 = 0;
         nResta1 = 0;
         nTipo1  = #retabla2#45;
     |FINSI;
|FPRC;

|PROCESO AutonomicaGeneral
     |ABRE #retabla2;
     #retabla2#0 = nCodAutonomico;
     |LEE 040#retabla2.=;
     |SI FSalida ! 0;
         #retabla2#0 = 0;
         |LEE 040#retabla2.=;
         |SI FSalida ! 0;  |DDEFECTO #retabla2;  |FINSI;
     |FINSI;
     |CIERRA #retabla2;

     |PARA nCampo4 = 41;  |SI nCampo4 ] 5;  |HACIENDO nCampo4 = nCampo4 - 4;
           |SI #retabla2#nCampo4# ! 0;
               nCampo1 = nCampo4 - 3;
               nCampo2 = nCampo4 - 2;
               |SI enLimite1 = 0;
                   nParte2 = #retabla2#nCampo2#;
                   nResta2 = #retabla2#nCampo1#;
                   nTipo2  = #retabla2#nCampo4#;
               |SINO;
                   enLimite2 = #retabla2#nCampo1#;
                   |SI nCuotaT [ enLimite1;  |Y nCuotaT > enLimite2;
                       nParte2 = #retabla2#nCampo2#;
                       nResta2 = #retabla2#nCampo1#;
                       nTipo2  = #retabla2#nCampo4#;
                   |FINSI;
               |FINSI;
               enLimite1 = #retabla2#nCampo1#;
           |FINSI;
     |SIGUE;

     |SI nCuotaT = 0;
         nParte2 = 0;
         nResta2 = 0;
         nTipo2  = #retabla2#5;
     |FINSI;
|FPRC;

|PROCESO TablaGeneral;
     nParte1   = 0;
     nResta1   = 0;
     nTipo1    = 0;
     nParte2   = 0;
     nResta2   = 0;
     nTipo2    = 0;

                              nCodAutonomico = #rem00100#11;
     |SI enConta        = 2;  nCodAutonomico = #rem00100#43;  |FINSI;
     |SI nCodAutonomico = 0;  nCodAutonomico = #rem00100#11;  |FINSI;

     |SI #rem00100#94 = "N";
         enLimite1 = 0;   |HAZ EstatalGeneral;
         enLimite2 = 0;   |HAZ AutonomicaGeneral
     |SINO;
         nCodAutonomico = 99;
         enLimite2      = 0;
         enLimite1      = 0;   |HAZ EstatalGeneral;
     |FINSI;
|FPRC;

|PROCESO Calcula0502;
     nCuota1 = 0;
     nCuota2 = 0;
     nCuota3 = 0;
     nCuota4 = 0;

     eaCasilla = "35-0475"; |HAZ SacaImporte; nCuota = enImporte + nCas0495;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     |SI nAnuHijos = 0;  |O nAnuHijos > nCuota;
         nCuotaT = nCuota;
         |HAZ TablaGeneral;

         nCuota1   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
         |SI nCuota1 < 0;  nCuota1 = 0;  |FINSI;

         nCuota2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
         |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;

         eaCasilla = "37-0491"; |HAZ SacaImporte;
         nCuotaT  = enImporte;
         |HAZ TablaGeneral;

         nCuota3   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
         |SI nCuota3 < 0;  nCuota3 = 0;  |FINSI;

         nCuota4   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
         |SI nCuota4 < 0;  nCuota4 = 0;  |FINSI;

         enSwAcum  = 0;
         eaCasilla = "39-0502";
         enImporte = nCuota1 - nCuota3;
         |HAZ GrabaLineal;

         enSwAcum  = 0;
         eaCasilla = "40-0503";
         enImporte = nCuota2 - nCuota4;
         |HAZ GrabaLineal;

         |SI nAnuHijos ! 0;
             enSwAcum   = 0;
             eaCasilla  = "38-0497";  enImporte  = 0;  |HAZ GrabaLineal;
         |FINSI;
         nAnuHijos = 0;
     |SINO;
         |SI nCuota = 0;  |ACABA; |FINSI;

         enImporte  = nAnuHijos;

         nCuotaT  = enImporte;
         |HAZ TablaGeneral;

         nCuota1   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
         |SI nCuota1 < 0;  nCuota1 = 0;  |FINSI;

         nCuota2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
         |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;

         nCuotaT  = nCuota - nAnuHijos;
         |HAZ TablaGeneral;

         nCuota3   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
         |SI nCuota3 < 0;  nCuota3 = 0;  |FINSI;

         nCuota4   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
         |SI nCuota4 < 0;  nCuota4 = 0;  |FINSI;

         eaCasilla = "37-0491"; |HAZ SacaImporte;
         nCuotaT  = enImporte + 1980;
         |HAZ TablaGeneral;

         nCuota5   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
         |SI nCuota5 < 0;  nCuota5 = 0;  |FINSI;

         nCuota6   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
         |SI nCuota6 < 0;  nCuota6 = 0;  |FINSI;

         enSwAcum  = 0;
         eaCasilla = "39-0502";
         enImporte = nCuota1 + nCuota3 - nCuota5;
         |HAZ GrabaLineal;

         enSwAcum  = 0;
         eaCasilla = "40-0503";
         enImporte = nCuota2 + nCuota4 - nCuota6;
         |HAZ GrabaLineal;
     |FINSI;
|FPRC;

|PROCESO Calcula0498;
     eaCasilla = "35-0475"; |HAZ SacaImporte; nCuota = enImporte;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     |SI nAnuHijos = 0;  |O nAnuHijos > nCuota;
         nCuotaT = nCuota;

         |HAZ TablaGeneral;

         |SI nCuota < 0;  nCuota = 0;  |FINSI;

         enSwAcum  = 0;
         eaCasilla = "39-0498";

         nValor2   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
         enImporte = nValor2;
         |HAZ GrabaLineal;

         enSwAcum  = 0;
         eaCasilla = "40-0499";

         nValor2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
         enImporte = nValor2;
         |HAZ GrabaLineal;

         |SI nAnuHijos ! 0;
             enSwAcum   = 0;
             eaCasilla  = "38-0497"; enImporte  = 0;  |HAZ GrabaLineal;
         |FINSI;

         nAnuHijos = 0;
     |SINO;
         |SI nCuota = 0;  |ACABA; |FINSI;

         enImporte  = nAnuHijos;

         enSwAcum   = 0;
         eaCasilla  = "39-0498";
         enImporte  = nCuota - nAnuHijos;
         |SI enImporte < 0;  enImporte = 0;  |FINSI;
         |HAZ GrabaLineal;

         nCuota1   = enImporte;

         nCuota    = nAnuHijos;
         nCuotaT   = nAnuHijos;
         |HAZ TablaGeneral;

         || Calcula Cuota Estatal 1¦ Base

         nValor1   = (nParte1 + (((nCuota - nResta1) * nTipo1) / 100)) ! 2;
         nVEstatal1 = nValor1 ! 2;

         || Calcula Cuota Autonomica 1¦ Base

         nValor1   = (nParte2 + (((nCuota - nResta2) * nTipo2) / 100)) ! 2;
         nVAutonom1 = nValor1 ! 2;

         || Calcula Cuota Estatal 2¦ Base

         nCuota   = nCuota1;
         nCuotaT  = nCuota1;
         |HAZ TablaGeneral;

         nValor1  = (nParte1 + (((nCuota - nResta1) * nTipo1) / 100)) ! 2;
         nVEstatal2 = nValor1 ! 2;

         || Calcula Cuota Autonomica 2¦ Base

         nValor1   = (nParte2 + (((nCuota - nResta2) * nTipo2) / 100)) ! 2;
         nVAutonom2 = nValor1 ! 2;

         enSwAcum   = 0;
         eaCasilla  = "39-0498";
         enImporte  = (nVEstatal1 + nVEstatal2) ! 2;
         |HAZ GrabaLineal;

         enSwAcum   = 0;
         eaCasilla  = "40-0499";
         enImporte  = (nVAutonom1 + nVAutonom2) ! 2;
         |HAZ GrabaLineal;
     |FINSI;
|FPRC;

|PROCESO Calcula0500;
     eaCasilla = "35-0475"; |HAZ SacaImporte; nCuota2 = enImporte;
     eaCasilla = "37-0491"; |HAZ SacaImporte; nCuota  = enImporte;

     |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;
     |SI nCuota  < 0;  nCuota  = 0;  |FINSI;

     |SI nAnuHijos = 0;  |O nAnuHijos > nCuota2;
         nCuotaT = nCuota;
     |SINO;
         nCuotaT = nCuota + 1980;
     |FINSI;

     |HAZ TablaGeneral;

     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     eaCasilla = "39-0498"; |HAZ SacaImporte; nValor1 = enImporte;

     enSwAcum  = 0;
     eaCasilla = "39-0500";

     nValor2   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
     |SI nValor2 > nValor1;  nValor2 = nValor1;  |FINSI;

     enImporte = nValor2;
     |HAZ GrabaLineal;
|FPRC;

|PROCESO Calcula0501;
     eaCasilla = "35-0475"; |HAZ SacaImporte; nCuota2 = enImporte;
     eaCasilla = "37-0493"; |HAZ SacaImporte; nCuota  = enImporte;

     |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;
     |SI nCuota  < 0;  nCuota  = 0;   |FINSI;

     |SI nAnuHijos = 0;  |O nAnuHijos > nCuota2;
         nCuotaT = nCuota;
     |SINO;
         nCuotaT = nCuota + 1980;
     |FINSI;

     |HAZ TablaGeneral;

     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     eaCasilla = "40-0499"; |HAZ SacaImporte; nValor1 = enImporte;

     enSwAcum  = 0;
     eaCasilla = "40-0501";

     nValor2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
     |SI nValor2 > nValor1;  nValor2 = nValor1;  |FINSI;

     enImporte = nValor2;
     |HAZ GrabaLineal;
|FPRC;

|PROCESO Calcula0504;
     |SI nCas0495 ! 0;
         |HAZ Calcula0502;
     |SINO;
         |HAZ Calcula0498;
         |HAZ Calcula0500;
         |HAZ Calcula0501;
     |FINSI;

     |SI nCas0495 = 0;
         nValor = 0;
         eaCasilla = "39-0498"; |HAZ SacaImporte; nValor = enImporte;
         eaCasilla = "39-0500"; |HAZ SacaImporte; nValor = nValor - enImporte;
         |SI nValor < 0;  nValor = 0;  |FINSI;

         enSwAcum   = 0;
         eaCasilla  = "39-0502";
         enImporte  = nValor;
         |HAZ GrabaLineal;

         nValor = 0;
         eaCasilla = "40-0499"; |HAZ SacaImporte; nValor = enImporte;
         eaCasilla = "40-0501"; |HAZ SacaImporte; nValor = nValor - enImporte;
         |SI nValor < 0;  nValor = 0;  |FINSI;

         enSwAcum   = 0;
         eaCasilla  = "40-0503";
         enImporte  = nValor;
         |HAZ GrabaLineal;

         eaCasilla = "35-0475"; |HAZ SacaImporte; nValor2 = enImporte;
         eaCasilla = "39-0502"; |HAZ SacaImporte; nValor1 = enImporte;
     |SINO;
         eaCasilla = "35-0475"; |HAZ SacaImporte; nValor2 = enImporte + nCas0495;
         eaCasilla = "39-0502"; |HAZ SacaImporte; nValor1 = enImporte;
     |FINSI;

     enImporte  = (((nValor1 * 100) / nValor2) - 0.0049) ! 2;
     |SI enImporte < 0;  enImporte = 0;  |FINSI;

     enSwAcum   = 0;
     eaCasilla  = "39-0504";
     |HAZ GrabaLineal;

     |SI nCas0495 ! 0;
         nPorce     = enImporte;
         eaCasilla = "35-0475"; |HAZ SacaImporte; nValor1 = enImporte;
         enImporte  = (nValor1 % nPorce) ! 2;

         enSwAcum   = 0;
         eaCasilla  = "39-0502";
         |HAZ GrabaLineal;
     |FINSI;

     eaCasilla = "40-0503"; |HAZ SacaImporte; nValor1 = enImporte;

     enImporte  = (((nValor1 * 100) / nValor2) - 0.0049) ! 2;
     |SI enImporte < 0;  enImporte = 0;  |FINSI;

     enSwAcum   = 0;
     eaCasilla  = "40-0505";
     |HAZ GrabaLineal;

     |SI nCas0495 ! 0;
         nPorce     = enImporte;
         eaCasilla = "35-0475"; |HAZ SacaImporte; nValor1 = enImporte;
         enImporte  = (nValor1 % nPorce) ! 2;
         enSwAcum   = 0;
         eaCasilla  = "40-0503";
         |HAZ GrabaLineal;
     |FINSI;
|FPRC;

|PROCESO EstatalAhorro;
     enLimite1 = 0;
     enLimite2 = 0;

     |ABRE #retabla1;
     #retabla1#0 = nCodAutonomico;
     |LEE 040#retabla1.=;
     |SI FSalida ! 0;
         #retabla1#0 = 0;
         |LEE 040#retabla1.=;
         |SI FSalida ! 0;  |DDEFECTO #retabla1;  |FINSI;
     |FINSI;
     |CIERRA #retabla1;

     |PARA nCampo4 = 81;  |SI nCampo4 ] 45;  |HACIENDO nCampo4 = nCampo4 - 4;
           |SI #retabla1#nCampo4# ! 0;
               nCampo1 = nCampo4 - 3;
               nCampo2 = nCampo4 - 2;
               |SI enLimite1 = 0;
                   nParte1 = #retabla1#nCampo2#;
                   nResta1 = #retabla1#nCampo1#;
                   nTipo1  = #retabla1#nCampo4#;
               |SINO;
                   enLimite2 = #retabla1#nCampo1#;
                   |SI nCuotaT [ enLimite1;  |Y nCuotaT > enLimite2;
                       nParte1 = #retabla1#nCampo2#;
                       nResta1 = #retabla1#nCampo1#;
                       nTipo1  = #retabla1#nCampo4#;
                   |FINSI;
               |FINSI;
               enLimite1 = #retabla1#nCampo1#;
           |FINSI;
     |SIGUE;

     |SI nCuotaT = 0;
         nParte1 = 0;
         nResta1 = 0;
         nTipo1  = #retabla1#45;
     |FINSI;

     enLimite1 = 0;
     enLimite2 = 0;

     |PARA nCampo4 = 41;  |SI nCampo4 ] 5;  |HACIENDO nCampo4 = nCampo4 - 4;
           |SI #retabla1#nCampo4# ! 0;
               nCampo1 = nCampo4 - 3;
               nCampo2 = nCampo4 - 2;
               |SI enLimite1 = 0;
                   nParte2 = #retabla1#nCampo2#;
                   nResta2 = #retabla1#nCampo1#;
                   nTipo2  = #retabla1#nCampo4#;
               |SINO;
                   enLimite2 = #retabla1#nCampo1#;
                   |SI nCuotaT [ enLimite1;  |Y nCuotaT > enLimite2;
                       nParte2 = #retabla1#nCampo2#;
                       nResta2 = #retabla1#nCampo1#;
                       nTipo2  = #retabla1#nCampo4#;
                   |FINSI;
               |FINSI;
               enLimite1 = #retabla1#nCampo1#;
           |FINSI;
     |SIGUE;

     |SI nCuotaT = 0;
         nParte2 = 0;
         nResta2 = 0;
         nTipo2  = #retabla1#45;
     |FINSI;
|FPRC;

|PROCESO TablaAhorro;
     nParte1        = 0;
     nResta1        = 0;
     nTipo1         = 0;
     nParte2        = 0;
     nResta2        = 0;
     nTipo2         = 0;
     nCodAutonomico = 0;

     |SI #rem00100#94 ! "N";
         nCodAutonomico = 99;
     |FINSI;

     |HAZ EstatalAhorro;
|FPRC;

|PROCESO Calcula0510;
     nCuota1 = 0;
     nCuota2 = 0;
     nCuota3 = 0;
     nCuota4 = 0;

     eaCasilla = "36-0480"; |HAZ SacaImporte; nCuota = enImporte + nCas0496;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     nCuotaT = nCuota;
     |HAZ TablaAhorro;

     nCuota1   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
     |SI nCuota1 < 0;  nCuota1 = 0;  |FINSI;

     nCuota2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
     |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;

     eaCasilla = "37-0492"; |HAZ SacaImporte;
     nCuotaT  = enImporte;
     |HAZ TablaAhorro;

     nCuota3   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
     |SI nCuota3 < 0;  nCuota3 = 0;  |FINSI;

     nCuota4   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
     |SI nCuota4 < 0;  nCuota4 = 0;  |FINSI;

     enSwAcum  = 0;
     eaCasilla = "39-0510";
     enImporte = nCuota1 - nCuota3;
     |HAZ GrabaLineal;

     enSwAcum  = 0;
     eaCasilla = "40-0511";
     enImporte = nCuota2 - nCuota4;
     |HAZ GrabaLineal;
|FPRC;

|PROCESO Calcula0506;
     eaCasilla = "36-0480"; |HAZ SacaImporte; nCuota = enImporte;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     nCuotaT = nCuota;
     |HAZ TablaAhorro;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     enSwAcum  = 0;
     eaCasilla = "39-0506";

     nValor2   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
     enImporte = nValor2;
     |HAZ GrabaLineal;

     enSwAcum  = 0;
     eaCasilla = "40-0507";

     nValor2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
     enImporte = nValor2;
     |HAZ GrabaLineal;
|FPRC;

|PROCESO Calcula0508;
     eaCasilla = "36-0480"; |HAZ SacaImporte; nCuota2 = enImporte;
     eaCasilla = "37-0492"; |HAZ SacaImporte; nCuota  = enImporte;

     |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;
     |SI nCuota  < 0;  nCuota  = 0;  |FINSI;

     nCuotaT = nCuota;
     |HAZ TablaAhorro;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     eaCasilla = "39-0506"; |HAZ SacaImporte; nValor1 = enImporte;

     enSwAcum  = 0;
     eaCasilla = "39-0508";

     nValor2   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
     |SI nValor2 > nValor1;  nValor2 = nValor1;  |FINSI;

     enImporte = nValor2;
     |HAZ GrabaLineal;
|FPRC;

|PROCESO Calcula0509;
     eaCasilla = "36-0480"; |HAZ SacaImporte; nCuota2 = enImporte;
     eaCasilla = "37-0494"; |HAZ SacaImporte; nCuota  = enImporte;

     |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;
     |SI nCuota  < 0;  nCuota  = 0;   |FINSI;

     nCuotaT = nCuota;
     |HAZ TablaAhorro;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     eaCasilla = "40-0507"; |HAZ SacaImporte; nValor1 = enImporte;

     enSwAcum  = 0;
     eaCasilla = "40-0509";

     nValor2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
     |SI nValor2 > nValor1;  nValor2 = nValor1;  |FINSI;

     enImporte = nValor2;
     |HAZ GrabaLineal;
|FPRC;

|PROCESO Calcula0512;
     |SI nCas0496 ! 0;
         |HAZ Calcula0510;
     |SINO;
         |HAZ Calcula0506;
         |HAZ Calcula0508;
         |HAZ Calcula0509;
     |FINSI;

     |SI nCas0496 = 0;
         nValor = 0;
         eaCasilla = "39-0506"; |HAZ SacaImporte; nValor = enImporte;
         eaCasilla = "39-0508"; |HAZ SacaImporte; nValor = nValor - enImporte;
         |SI nValor < 0;  nValor = 0;  |FINSI;

         enSwAcum   = 0;
         eaCasilla  = "39-0510";
         enImporte  = nValor;
         |HAZ GrabaLineal;

         nValor = 0;
         eaCasilla = "40-0507"; |HAZ SacaImporte; nValor = enImporte;
         eaCasilla = "40-0509"; |HAZ SacaImporte; nValor = nValor - enImporte;
         |SI nValor < 0;  nValor = 0;  |FINSI;

         enSwAcum   = 0;
         eaCasilla  = "40-0511";
         enImporte  = nValor;
         |HAZ GrabaLineal;

         eaCasilla = "36-0480"; |HAZ SacaImporte; nValor2 = enImporte;
         eaCasilla = "39-0510"; |HAZ SacaImporte; nValor1 = enImporte;
     |SINO;
         eaCasilla = "36-0480"; |HAZ SacaImporte; nValor2 = enImporte + nCas0496;
         eaCasilla = "39-0510"; |HAZ SacaImporte; nValor1 = enImporte;
     |FINSI;

     enImporte  = (((nValor1 * 100) / nValor2) - 0.0049) ! 2;
     |SI enImporte < 0;  enImporte = 0;  |FINSI;

     enSwAcum   = 0;
     eaCasilla  = "39-0512";
     |HAZ GrabaLineal;

     |SI nCas0496 ! 0;
         nPorce     = enImporte;
         eaCasilla = "36-0480"; |HAZ SacaImporte; nValor1 = enImporte;
         enImporte  = (nValor1 % nPorce) ! 2;

         enSwAcum   = 0;
         eaCasilla  = "39-0510";
         |HAZ GrabaLineal;
     |FINSI;

     eaCasilla = "40-0511"; |HAZ SacaImporte; nValor1 = enImporte;

     enImporte  = (((nValor1 * 100) / nValor2) - 0.0049) ! 2;
     |SI enImporte < 0;  enImporte = 0;  |FINSI;

     enSwAcum   = 0;
     eaCasilla  = "40-0513";
     |HAZ GrabaLineal;

     |SI nCas0496 ! 0;
         nPorce    = enImporte;
         eaCasilla = "36-0480"; |HAZ SacaImporte; nValor1 = enImporte;
         enImporte  = (nValor1 % nPorce) ! 2;
         enSwAcum   = 0;
         eaCasilla  = "40-0511";
         |HAZ GrabaLineal;
     |FINSI;
|FPRC;

|PROCESO Ajusta1;
     |SI nAjuste = 0;  |ACABA;  |FINSI;

     nAcumLimite = nAcumLimite + nAjuste;
     |SI nLimite < nAcumLimite;
         nAjuste     = nAjuste - (nAcumLimite - nLimite);
         nAcumLimite = nLimite;
     |FINSI;
|FPRC;

|PROCESO Donaciones;
     eaCasilla = "35-0473"; |HAZ SacaImporte; nCuota = enImporte;
     eaCasilla = "36-0480"; |HAZ SacaImporte; nCuota = nCuota + enImporte;

     nAjuste10 = nCuota % 10;
     nAjuste15 = nCuota % 15;

     |SI #rem01041@#38 < 0;  #rem01041@#38 = 0;  |FINSI;
     |SI #rem01041@#40 < 0;  #rem01041@#40 = 0;  |FINSI;
     |SI #rem01041@#42 < 0;  #rem01041@#42 = 0;  |FINSI;
     |SI #rem01041@#44 < 0;  #rem01041@#44 = 0;  |FINSI;

     nValor    = #rem01041@#48;
     |SI nValor > nAjuste10;  |Y nValor > 0;
         #rem01041@#48 = nAjuste10;
         #rem01041@#49 = (N\ #rem01041@#48 % 15);
     |FINSI;

     #rem01041@#50 = (N\ #rem01041@#49 % 50);
     #rem01041@#51 = (N\ #rem01041@#49 - #rem01041@#50);

     nValor = #rem01041@#38 + #rem01041@#78;
     |SI nAjuste15 > 0;  |Y nValor > 0;
         |SI #rem01041@#38 > nAjuste15;
             #rem01041@#38 = nAjuste15;
             nAjuste15    = 0;
         |SINO;
             nAjuste15 = nAjuste15 - #rem01041@#38;
         |FINSI;

         |SI nAjuste15 > 0;
             |SI #rem01041@#78 > nAjuste15;
                 #rem01041@#78 = nAjuste15;
                 nAjuste15    = 0;
             |SINO;
                 nAjuste15 = nAjuste15 - #rem01041@#78;
             |FINSI;
         |SINO;
              #rem01041@#78 = 0;
         |FINSI;

         nBase1 = 0;
         nBase2 = 0;
         nBase3 = 0;
         nResto = #rem01041@#38 + #rem01041@#78;
         |SI nResto > 0;
             nBase1 = nResto;
             |SI nResto ] 150;  nBase1 = 150;  |FINSI;
             nResto = nResto - nBase1;

             |SI nResto [ 0;
                 #rem01041@#38 = 0;
                 #rem01041@#78 = 0;
             |FINSI;

             |SI #rem01041@#38 > 0;
                 |SI #rem01041@#38 > nBase1;
                     nBase2 = #rem01041@#38 - nBase1;
                 |FINSI;

                 nResto = nResto - nBase2;
             |FINSI;

             |SI nResto [ 0;
                 #rem01041@#78 = 0;
             |FINSI;

             |SI #rem01041@#78 > 0;
                 nBase3 = nResto;
             |FINSI;
         |FINSI;

         #rem01041@#38 = (N\ nBase1 + nBase2 + nBase3);
         #rem01041@#39 = (N\ nBase1 % 80) + (N\ nBase2 % 35) + (N\ nBase3 % 40);
     |SINO;
          #rem01041@#38 = 0;
          #rem01041@#39 = 0;
          #rem01041@#78 = 0;
     |FINSI;

     nAjuste10 = (nCuota % 10) - #rem01041@#38;
     |SI nAjuste10 < 0;  nAjuste10 = 0;  |FINSI;

     nValor = #rem01041@#40 + #rem01041@#79;
     |SI nAjuste10 > 0;  |Y nValor > 0;
         |SI #rem01041@#40 > nAjuste10;
             #rem01041@#40 = nAjuste10;
             nAjuste10    = 0;
         |SINO;
             nAjuste10 = nAjuste10 - #rem01041@#40;
         |FINSI;

         |SI nAjuste10 > 0;
             |SI #rem01041@#79 > nAjuste10;
                 #rem01041@#79 = nAjuste10;
                 nAjuste10    = 0;
             |SINO;
                 nAjuste10 = nAjuste10 - #rem01041@#79;
             |FINSI;
         |SINO;
              #rem01041@#79 = 0;
         |FINSI;

         nBase1 = 0;
         nBase2 = 0;
         nBase3 = 0;
         nResto = #rem01041@#40 + #rem01041@#79;
         |SI nResto > 0;
             nBase1 = nResto;
             |SI nResto ] 150;  nBase1 = 150;  |FINSI;
             nResto = nResto - nBase1;

             |SI nResto [ 0;
                 #rem01041@#40 = 0;
                 #rem01041@#79 = 0;
             |FINSI;

             |SI #rem01041@#40 > 0;
                 |SI #rem01041@#40 > nBase1;
                     nBase2 = #rem01041@#40 - nBase1;
                 |FINSI;

                 nResto = nResto - nBase2;
             |FINSI;

             |SI nResto [ 0;
                 #rem01041@#79 = 0;
             |FINSI;

             |SI #rem01041@#79 > 0;
                 nBase3 = nResto;
             |FINSI;
         |FINSI;

         #rem01041@#40 = (N\ nBase1 + nBase2 + nBase3);
         #rem01041@#41 = (N\ nBase1 % 75) + (N\ nBase2 % 30) + (N\ nBase3 % 35);
     |SINO;
          #rem01041@#40 = 0;
          #rem01041@#41 = 0;
          #rem01041@#79 = 0;
     |FINSI;

     |SI nAjuste10 > 0;  |Y #rem01041@#42 > 0;
         |SI #rem01041@#42 > nAjuste10;
             #rem01041@#42 = nAjuste10;
             nAjuste10    = 0;
         |SINO;
             nAjuste10 = nAjuste10 - #rem01041@#42;
         |FINSI;

          #rem01041@#43 = (N\ #rem01041@#42 % 10);
     |SINO;
          #rem01041@#42 = 0;
          #rem01041@#43 = 0;
     |FINSI;

     |SI nAjuste10 > 0;  |Y #rem01041@#44 > 0;
         |SI #rem01041@#44 > nAjuste10;
             #rem01041@#44 = nAjuste10;
             nAjuste10    = 0;
         |SINO;
             nAjuste10 = nAjuste10 - #rem01041@#44;
         |FINSI;

          #rem01041@#45 = (N\ #rem01041@#44 % 20);
     |SINO;
          #rem01041@#44 = 0;
          #rem01041@#45 = 0;
     |FINSI;

     #rem01041@#46 = 0;
     #rem01041@#47 = 0;

     nValor = (N\ (#rem01041@#39 + #rem01041@#41 + #rem01041@#43 + #rem01041@#45));
     |SI nValor > 0;
         #rem01041@#46 = (N\ (#rem01041@#39 + #rem01041@#41 + #rem01041@#43 + #rem01041@#45) % 50);
         #rem01041@#47 = (N\ (#rem01041@#39 + #rem01041@#41 + #rem01041@#43 + #rem01041@#45) - #rem01041@#46);
     |FINSI;
|FPRC;

|PROCESO Anexo1Punto1;
     nAcumLimite = 0;

     nLimite = 9040;
     nTope   = nLimite / 2;

     nAjuste = #rem01041@#55;  |HAZ Ajusta1;  #rem01041@#55  = nAjuste;
     nAjuste = #rem01041@#56;  |HAZ Ajusta1;  #rem01041@#56  = nAjuste;
     nAjuste = #rem01041@#57;  |HAZ Ajusta1;  #rem01041@#57  = nAjuste;
     nAjuste = #rem01041@#58;  |HAZ Ajusta1;  #rem01041@#58  = nAjuste;
     nAjuste = #rem01041@#61;  |HAZ Ajusta1;  #rem01041@#61  = nAjuste;

     nAjuste  = #rem01041@#55 + #rem01041@#56 + #rem01041@#57;
     nAjuste2 = 0;
     |SI nAjuste > nTope;
         nAjuste2 = nAjuste - nTope;
         nAjuste  = nTope;
     |FINSI;

     nPorce1 = 7.5;
     nPorce2 = 7.5;
     nPorce3 = 7.5;
     nPorce4 = 7.5;

     |SI #rem01041@#19 < "30.07.2011";   || No cambiar esto es fijo
         |SI nCatalunyaA ! 0;
             |SI enConta = 1;  |Y eaMuerto = "T";  |Y efFechaMuerto < "30.07.2011";
                 nPorce2 =  6;  nPorce4 =  6;
             |FINSI;
             |SI enConta = 2;  |Y eaMuerto = "C";  |Y efFechaMuerto < "30.07.2011";
                 nPorce2 =  6;  nPorce4 =  6;
             |FINSI;
         |FINSI;

         |SI nCatalunyaB ! 0;  nPorce2 =  9;  nPorce4 =  9;  |FINSI;
     |FINSI;

     nValor1 = ((nAjuste % nPorce1) + (nAjuste2 % nPorce3)) ! 2;
     nValor2 = ((nAjuste % nPorce2) + (nAjuste2 % nPorce4)) ! 2;
     #rem01041@#3    = nAjuste + nAjuste2;
     #rem01041@#4    = nValor1;
     #rem01041@#5    = nValor2;

     nAjuste  = #rem01041@#58;
     nAjuste2 = 0;
     nLimitee = nTope - #rem01041@#55 - #rem01041@#56 - #rem01041@#57;
     |SI nLimitee < 0;
         nLimitee = 0;
     |FINSI;

     |SI #rem01041@#58 > nLimitee;
         nAjuste  = nLimitee;
         nAjuste2 = #rem01041@#58 - nLimitee;
     |FINSI;

     nValor1 = ((nAjuste % nPorce1) + (nAjuste2 % nPorce3)) ! 2;
     nValor2 = ((nAjuste % nPorce2) + (nAjuste2 % nPorce4)) ! 2;
     #rem01041@#6    = nAjuste + nAjuste2;
     #rem01041@#7    = nValor1;
     #rem01041@#8    = nValor2;

     nAjuste  = #rem01041@#61;
     nAjuste2 = 0;
     nLimitee = nTope - #rem01041@#55 - #rem01041@#56 - #rem01041@#57 - #rem01041@#58;
     |SI nLimitee < 0;  nLimitee = 0;  |FINSI;

     |SI #rem01041@#61 > nLimitee;
         nAjuste  = nLimitee;
         nAjuste2 = #rem01041@#61 - nLimitee;
     |FINSI;

     nValor1 = ((nAjuste % nPorce1) + (nAjuste2 % nPorce3)) ! 2;
     nValor2 = ((nAjuste % nPorce2) + (nAjuste2 % nPorce4)) ! 2;
     #rem01041@#9    = nAjuste + nAjuste2;
     #rem01041@#10   = nValor1;
     #rem01041@#11   = nValor2;
|FPRC;

|PROCESO Anexo1Punto2;
     nAcumLimite = 0;

     nLimite = 12080;
     nTope   = nLimite / 2;

     nAjuste = #rem01041@#59;  |HAZ Ajusta1;  #rem01041@#59 = nAjuste;
     nAjuste = #rem01041@#60;  |HAZ Ajusta1;  #rem01041@#60 = nAjuste;
     nAjuste = #rem01041@#61;  |HAZ Ajusta1;  #rem01041@#61 = nAjuste;

     nAjuste  = #rem01041@#59 + #rem01041@#60 + #rem01041@#61;
     nAjuste2 = 0;
     |SI nAjuste > nTope;
         nAjuste2 = nAjuste - nTope;
         nAjuste  = nTope;
     |FINSI;

     nPorce1 = 10;
     nPorce2 = 10;
     nPorce3 = 10;
     nPorce4 = 10;

     |SI #rem01041@#19 < "30.07.2011";
         |SI nCatalunyaA ! 0;  nPorce2 =  15;  nPorce4 = 15;  |FINSI;
         |SI nCatalunyaB ! 0;  nPorce2 =  15;  nPorce4 = 15;  |FINSI;
     |SINO;
         |SI nCatalunyaA ! 0;  nPorce2 =  12;  nPorce4 = 12;  |FINSI;
         |SI nCatalunyaB ! 0;  nPorce2 =  12;  nPorce4 = 12;  |FINSI;
     |FINSI;

     nValor1 = ((nAjuste % nPorce1) + (nAjuste2 % nPorce3)) ! 2;
     nValor2 = ((nAjuste % nPorce2) + (nAjuste2 % nPorce4)) ! 2;

     #rem01041@#12   = nAjuste + nAjuste2;
     #rem01041@#13   = nValor1;
     #rem01041@#14   = nValor2;
|FPRC;

|PROCESO CalculaAnexoA1;
     aDef    = eaPathDef + "rem01041.mas";
     |CARGA_DEF aDef, rem01041@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #rem01041@#"zdat1041"#;  |FINSI;

     |ABRE #rem01041@;
     #rem01041@#0 = #refere1@#0;
     #rem01041@#1 = #refere1@#1;
     #rem01041@#2 = #refere1@#2;
     |LEE 101#rem01041@.=;
     |SI FSalida ! 0;
         |DDEFECTO #rem01041@;
         #rem01041@#0 = #refere1@#0;
         #rem01041@#1 = #refere1@#1;
         #rem01041@#2 = #refere1@#2;
         |GRABA 020#rem01041@.b;
     |FINSI;

     nLimiteGral = 0;
     eaCasilla = "27-0415"; |HAZ SacaImporte; nLimiteGral = nLimiteGral + enImporte;
     eaCasilla = "28-0435"; |HAZ SacaImporte; nLimiteGral = nLimiteGral + enImporte;

|| Vivienda habitual

     nCatalunyaA = 0;
     nCatalunyaB = 0;

     |SI #rem01041@#69 = "1";  nCatalunyaA = 1;  |FINSI;
     |SI #rem01041@#69 = "2";  nCatalunyaB = 1;  |FINSI;

     |HAZ Anexo1Punto1;
     |HAZ Anexo1Punto2;

     #rem01041@#15   = (N\ #rem01041@#4 + #rem01041@#7 + #rem01041@#10 + #rem01041@#13);
     #rem01041@#16   = (N\ #rem01041@#5 + #rem01041@#8 + #rem01041@#11 + #rem01041@#14);

|| Emresas de nueva creacion

     nValor = #rem01041@#26;
     |SI nValor > 50000;
         nValor = 50000;
     |FINSI;

     #rem01041@#26  = nValor;
     nValor = nValor % 20;
     #rem01041@#27  = nValor;

|| Alquiler de la vivienda habitual

     nValor = #rem01041@#34;

     |SI nLimiteGral < 24107.20;
         |SI nLimiteGral [ 17707.20;
             |SI nValor > 9040;
                 nValor = 9040;
             |FINSI;
         |FINSI;

         |SI nLimiteGral > 17707.20;
             nLimite = 9040 - ((nLimiteGral - 17707.20) * 1.4125);
             |SI nValor > nLimite;
                 nValor = nLimite;
             |FINSI;
         |FINSI;

         #rem01041@#34  = nValor;
         nValor = nValor % 10.05;
         #rem01041@#35  = nValor;

         nValor1 = nValor / 2;

         #rem01041@#36  = nValor1;
         #rem01041@#37  = (N\ (nValor - nValor1));
     |SINO;
         #rem01041@#28 = "";
         #rem01041@#29 = "";
         #rem01041@#30 = "";
         #rem01041@#31 = "";
         #rem01041@#32 = 0;
         #rem01041@#33 = 0;
         #rem01041@#34 = 0;
         #rem01041@#35 = 0;
         #rem01041@#36 = 0;
         #rem01041@#37 = 0;
     |FINSI;

|| Donaciones

     |HAZ Donaciones;

|| Ceuta y Melilla

     eaCasilla = "39-0514"; |HAZ SacaImporte; nCuotaIntegra = enImporte;
     eaCasilla = "40-0515"; |HAZ SacaImporte; nCuotaIntegra = nCuotaIntegra + enImporte;
     eaCasilla = "39-0529"; |HAZ SacaImporte; nValor2       = enImporte;
     eaCasilla = "40-0530"; |HAZ SacaImporte; nValor2       = nValor2 + enImporte;

     nValor1 = nCuotaIntegra % 50;

     |SI nValor2 > nValor1;
         #rem01041@#52   = nValor1;
     |SINO;
         #rem01041@#52   = nValor2;
     |FINSI;

     nValor  = #rem01041@#52;
     nValor1 = (nValor % 50) ! 2;
     nValor2 = nValor - nValor1;

     #rem01041@#53 = nValor1;
     #rem01041@#54 = nValor2;

     |GRABA 020#rem01041@.a;
     |LIBERA #rem01041@;
     |CIERRA #rem01041@;

     enSwAcum  = 0;

     eaCasilla = "39-0516";  enImporte = #rem01041@#15;  |HAZ GrabaLineal;
     eaCasilla = "39-0518";  enImporte = #rem01041@#27;  |HAZ GrabaLineal;
     eaCasilla = "39-0519";  enImporte = #rem01041@#50;  |HAZ GrabaLineal;
     eaCasilla = "39-0521";  enImporte = #rem01041@#46;  |HAZ GrabaLineal;
     eaCasilla = "39-0529";  enImporte = #rem01041@#53;  |HAZ GrabaLineal;
     eaCasilla = "39-0531";  enImporte = #rem01041@#36;  |HAZ GrabaLineal;

     eaCasilla = "40-0517";  enImporte = #rem01041@#16;  |HAZ GrabaLineal;
     eaCasilla = "40-0520";  enImporte = #rem01041@#51;  |HAZ GrabaLineal;
     eaCasilla = "40-0522";  enImporte = #rem01041@#47;  |HAZ GrabaLineal;
     eaCasilla = "40-0530";  enImporte = #rem01041@#54;  |HAZ GrabaLineal;
     eaCasilla = "40-0532";  enImporte = #rem01041@#37;  |HAZ GrabaLineal;

     |DESCARGA_DEF #rem01041@;
|FPRC;

|PROCESO Deduce;
     |SI nAcum = 0;     nAplicado = 0;  |ACABA;  |FINSI;
     |SI nLimiteT [ 0;  nAplicado = 0;  |ACABA;  |FINSI;

     nAcum = nAcum - nDeducido;
     |SI nAcum ] 0
         nAplicado = nDeducido;
     |SINO;
         nAplicado = nDeducido + nAcum;
         nAcum     = 0;
     |FINSI;

     nLimiteT = nLimiteT - nAplicado;
     |SI nLimiteT < 0;
         nAplicado = nAplicado + nLimiteT;
         nLimiteT  = 0;
     |FINSI;
|FPRC;

|PROCESO CalculaAnexoA3;
     aDef    = eaPathDef + "rem01042.mas";
     |CARGA_DEF aDef, rem01042@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #rem01042@#"zdat1042"#;  |FINSI;

     |ABRE #rem01042@;
     #rem01042@#0 = #refere1@#0;
     #rem01042@#1 = #refere1@#1;
     #rem01042@#2 = #refere1@#2;
     |LEE 101#rem01042@.=;
     |SI FSalida ! 0;
         |CIERRA #rem01042@;
         |DESCARGA_DEF #rem01042@;
         |ACABA;
     |FINSI;

     nValor   = 0;
     eaCasilla = "39-0514"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "40-0515"; |HAZ SacaImporte; nValor = nValor + enImporte;
     nLimiteT = nValor;

     eaCasilla = "39-0516"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "40-0517"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "39-0518"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "39-0519"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "40-0520"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "39-0521"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "40-0522"; |HAZ SacaImporte; nValor = nValor - enImporte;

     |SI nValor < 0;  nValor = 0;  |FINSI;

     nLimite25  = (nValor % 25) ! 2;
     nLimite35  = (nValor % 35) ! 2;
     nLimite50  = (nValor % 50) ! 2;
     nLimite60  = (nValor % 60) ! 2;
     nLimite70  = (nValor % 70) ! 2;
     nLimite90  = (nValor % 90) ! 2;
     nLimite100 = nValor;

                               nAcum = nLimite25;
     |SI #rem01042@#241 = 2;   nAcum = nLimite50;  |FINSI;

     |PARA nCampo1 = 4;  |SI nCampo1 [ 190;  |HACIENDO nCampo1 = nCampo1 + 3;
           nDeducido = #rem01042@#nCampo1#;
           |HAZ Deduce;
           #rem01042@#nCampo1# = nAplicado;
     |SIGUE;

     nAcum     = nLimite50;
     nDeducido = #rem01042@#244; |HAZ Deduce;  #rem01042@#244 = nAplicado;

     nAcum     = nLimite60;
     nDeducido = #rem01042@#200; |HAZ Deduce;  #rem01042@#200 = nAplicado;
     #rem01042@#199 = (N\ #rem01042@#199 + #rem01042@#243);
     #rem01042@#200 = (N\ #rem01042@#200 + #rem01042@#244);

                              nAcum = nLimite60;
     |SI #rem01042@#242 = 2;  nAcum = nLimite90;  |FINSI;

     |PARA nCampo1 = 203;  |SI nCampo1 [ 215;  |HACIENDO nCampo1 = nCampo1 + 3;
           nDeducido = #rem01042@#nCampo1#;
           |HAZ Deduce;
           #rem01042@#nCampo1# = nAplicado;
     |SIGUE;

     nAcum     = nLimite50;
     nDeducido = #rem01042@#218; |HAZ Deduce;  #rem01042@#218 = nAplicado;

     nAcum     = nLimite100;
     nDeducido = #rem01042@#224; |HAZ Deduce;  #rem01042@#224 = nAplicado;
     nDeducido = #rem01042@#225; |HAZ Deduce;  #rem01042@#225 = nAplicado;
     nDeducido = #rem01042@#228; |HAZ Deduce;  #rem01042@#228 = nAplicado;
     nDeducido = #rem01042@#229; |HAZ Deduce;  #rem01042@#229 = nAplicado;
     nDeducido = #rem01042@#232; |HAZ Deduce;  #rem01042@#232 = nAplicado;
     nDeducido = #rem01042@#233; |HAZ Deduce;  #rem01042@#233 = nAplicado;
     nDeducido = #rem01042@#236; |HAZ Deduce;  #rem01042@#236 = nAplicado;
     nDeducido = #rem01042@#237; |HAZ Deduce;  #rem01042@#237 = nAplicado;
     nDeducido = #rem01042@#239; |HAZ Deduce;  #rem01042@#239 = nAplicado;
     nDeducido = #rem01042@#240; |HAZ Deduce;  #rem01042@#240 = nAplicado;

     |PARA nCampo1 = 3;  |SI nCampo1 [ 189; |HACIENDO nCampo1 = nCampo1 + 3;
           nCampo2   = nCampo1 + 1;
           nCampo3   = nCampo1 + 2;
           #rem01042@#nCampo3# = (N\ #rem01042@#nCampo1# - #rem01042@#nCampo2#);
     |SIGUE;

     |PARA nCampo1 = 199;  |SI nCampo1 [ 217;  |HACIENDO nCampo1 = nCampo1 + 3;
           nCampo2   = nCampo1 + 1;
           nCampo3   = nCampo1 + 2;
           #rem01042@#nCampo3# = (N\ #rem01042@#nCampo1# - #rem01042@#nCampo2#);
     |SIGUE;

     #rem01042@#230 = (N\ #rem01042@#227 - #rem01042@#228 - #rem01042@#229);
     #rem01042@#234 = (N\ #rem01042@#231 - #rem01042@#232 - #rem01042@#233);
     #rem01042@#238 = (N\ #rem01042@#235 - #rem01042@#236 - #rem01042@#237);

     nSuma = #rem01042@#198;
     |PARA nCampo1 = 4;  |SI nCampo1 [ 190;   |HACIENDO nCampo1 = nCampo1 + 3;
           nSuma = nSuma + #rem01042@#nCampo1#;
     |SIGUE;

     |PARA nCampo1 = 200;  |SI nCampo1 [ 218; |HACIENDO nCampo1 = nCampo1 + 3;
           nSuma = nSuma + #rem01042@#nCampo1#;
     |SIGUE;

     #rem01042@#220 = nSuma;

     nValor1 = (nSuma % 50) ! 2;
     nValor2 = nSuma - nValor1;

     #rem01042@#221 = nValor1;
     #rem01042@#222 = nValor2;

     enSwAcum   = 0;
     eaCasilla  = "39-0523";  enImporte  = nValor1;  |HAZ GrabaLineal;
     eaCasilla  = "40-0524";  enImporte  = nValor2;  |HAZ GrabaLineal;

     |GRABA 020#rem01042@.a;
     |LIBERA #rem01042@;
     |CIERRA #rem01042@;

     |DESCARGA_DEF #rem01042@;
|FPRC;

|PROCESO AjustaDobleInternac;
     aDef    = eaPathDef + "rem01033.mas";
     |CARGA_DEF aDef, rem01033@;

     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #rem01033@#"zdat1033"#;  |FINSI;

     |ABRE #rem01033@;
     #rem01033@#0 = #refere1@#0;
     #rem01033@#1 = #refere1@#1;
     #rem01033@#2 = #refere1@#2;
     |LEE 040#rem01033@.=;
     |SI FSalida ! 0;  |DDEFECTO #rem01033@;  |FINSI;
     |CIERRA #rem01033@;

     |SI #rem01033@#132 ! 0;
         nValor1  = #rem01033@#132;
         eaCasilla = "01-0021"; |HAZ SacaImporte; nValor2 = enImporte;
         eaCasilla = "01-0022"; |HAZ SacaImporte; nValor3 = enImporte;

         |SI nValor2 > nValor1;
             nValor  = ((nValor1 * 100) / nValor2) ! 2;
             nValor  = (nValor3 % nValor) ! 2;
             nValor1 = nValor1 - nValor;
         |SINO;
             nValor1 = nValor1 - nValor3;
         |FINSI;

         #rem01033@#132 = nValor1;
     |FINSI;

     nValor = #rem01033@#128 + #rem01033@#132 + #rem01033@#129 + #rem01033@#130 + #rem01033@#131;
     |SI nValor ! 0;
         eaCasilla = "35-0475";  |HAZ SacaImporte; n415 = enImporte;
         eaCasilla = "36-0480";  |HAZ SacaImporte; n419 = enImporte;
         eaCasilla = "39-0502";  |HAZ SacaImporte; n454 = enImporte;
         eaCasilla = "40-0503";  |HAZ SacaImporte; n455 = enImporte;
         eaCasilla = "27-0412";  |HAZ SacaImporte; n363 = enImporte;
         eaCasilla = "28-0409";  |HAZ SacaImporte; n371 = enImporte;
         eaCasilla = "39-0510";  |HAZ SacaImporte; n463 = enImporte;
         eaCasilla = "40-0511";  |HAZ SacaImporte; n464 = enImporte;

         nDed  = 0;
         eaCasilla = "39-0516";  |HAZ SacaImporte; nDed = enImporte;
         eaCasilla = "39-0518";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "39-0519";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "39-0521";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "39-0523";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "39-0525";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "39-0527";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "39-0529";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "39-0531";  |HAZ SacaImporte; nDed = nDed  + enImporte;

         eaCasilla = "40-0517";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "40-0520";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "40-0522";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "40-0524";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "40-0526";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "40-0528";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "40-0530";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "40-0532";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         eaCasilla = "40-0534";  |HAZ SacaImporte; nDed = nDed  + enImporte;

         nVal1    = (n454 + n455) - nDed;
         nValorP1 = (((nVal1 * 100) / n415) - 0.0049) ! 2;

         nVal1    = n463 + n464;
         nValorP2 = (((nVal1 * 100) / n419) - 0.0049) ! 2;

         nValorB3 = (n415 * (#rem01033@#128 + #rem01033@#132)) / n363;
         nValorB4 = (n419 * #rem01033@#130) / n371;

         |SI nValorB3 > n415;  nValorB3 = n415;  |FINSI;
         |SI nValorB4 > n419;  nValorB4 = n419;  |FINSI;

         nValorC1 = #rem01033@#129;
         nValor   = ((nValorB3 % nValorP1) - 0.0049) ! 2;
         |SI nValor < 0;  nValor = 0;  |FINSI;
         |SI nValor < nValorC1;
             nValorC1 = nValor;
         |FINSI;

         nValorC2 = #rem01033@#131;
         nValor   = ((nValorB4 % nValorP2) - 0.0049) ! 2;
         |SI nValor < 0;  nValor = 0;  |FINSI;
         |SI nValor < nValorC2;
             nValorC2 = nValor;
         |FINSI;

         enImporte = (nValorC1 + nValorC2) ! 2;
         |SI enImporte < 0;  enImporte = 0;  |FINSI;

         enSwAcum   = 0;
         eaCasilla  = "41-0553";
         |HAZ GrabaLineal;
     |FINSI;

     |DESCARGA_DEF #rem01033@;
|FPRC;

|PROCESO CalculaM;
     |ABRE #rem00100;
     #rem00100#0 = #refere1@#0;
     |LEE 000#rem00100.=;
     |SI FSalida ! 0;  |DDEFECTO #rem00100;  |FINSI;
     |CIERRA #rem00100;

                              nCodAutonomico = #rem00100#11;
     |SI enConta        = 2;  nCodAutonomico = #rem00100#43;  |FINSI;
     |SI nCodAutonomico = 0;  nCodAutonomico = #rem00100#11;  |FINSI;

     eaCasilla = "38-0495"; |HAZ SacaImporte; nCas0495  = enImporte;
     eaCasilla = "38-0496"; |HAZ SacaImporte; nCas0496  = enImporte;
     eaCasilla = "38-0497"; |HAZ SacaImporte; nAnuHijos = enImporte;

     |HAZ Calcula0504;
     |HAZ Calcula0512;

     eaCasilla = "39-0502"; |HAZ SacaImporte; nValor1 = enImporte;
     eaCasilla = "39-0510"; |HAZ SacaImporte; nValor2 = enImporte;

     enImporte  = nValor1 + nValor2;
     enSwAcum   = 0;
     eaCasilla  = "39-0514";
     |HAZ GrabaLineal;

     eaCasilla = "40-0503"; |HAZ SacaImporte; nValor1 = enImporte;
     eaCasilla = "40-0511"; |HAZ SacaImporte; nValor2 = enImporte;

     enImporte  = nValor1 + nValor2;
     enSwAcum   = 0;
     eaCasilla  = "40-0515";
     |HAZ GrabaLineal;

     |HAZ CalculaAnexoA1;
     |HAZ CalculaAnexoA3;
     |HAZ CalculaAnexoB;   || rezcal08

     nValor    = 0;
     eaCasilla = "39-0514"; |HAZ SacaImporte; nValor = enImporte;
     eaCasilla = "39-0516"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "39-0518"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "39-0519"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "39-0521"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "39-0523"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "39-0525"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "39-0527"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "39-0529"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "39-0531"; |HAZ SacaImporte; nValor = nValor - enImporte;

     |SI nValor < 0;  nValor = 0;  |FINSI;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "39-0535";
     |HAZ GrabaLineal;

     nValor   = 0;
     eaCasilla = "40-0515"; |HAZ SacaImporte; nValor = enImporte;
     eaCasilla = "40-0517"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "40-0520"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "40-0522"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "40-0524"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "40-0526"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "40-0528"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "40-0530"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "40-0532"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "40-0534"; |HAZ SacaImporte; nValor = nValor - enImporte;

     |SI nValor < 0;  nValor = 0;  |FINSI;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "40-0536";
     |HAZ GrabaLineal;

     nValor    = 0;
     eaCasilla = "39-0535"; |HAZ SacaImporte; nValor = enImporte;
     eaCasilla = "39-0537"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "39-0538"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "39-0539"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "39-0541"; |HAZ SacaImporte; nValor = nValor + enImporte;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "39-0550";
     |HAZ GrabaLineal;

     nValor    = 0;
     eaCasilla = "40-0536"; |HAZ SacaImporte; nValor = enImporte;
     eaCasilla = "40-0542"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "40-0543"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "40-0544"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "40-0546"; |HAZ SacaImporte; nValor = nValor + enImporte;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "40-0551";
     |HAZ GrabaLineal;

     nValor   = 0;
     eaCasilla = "39-0550"; |HAZ SacaImporte; nValor = enImporte;
     eaCasilla = "40-0551"; |HAZ SacaImporte; nValor = nValor + enImporte;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "41-0552";
     |HAZ GrabaLineal;

     |HAZ AjustaDobleInternac;

     eaCasilla = "41-0552"; |HAZ SacaImporte; nValor = enImporte;
     eaCasilla = "41-0553"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "41-0554"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "41-0555"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "41-0556"; |HAZ SacaImporte; nValor = nValor - enImporte;
     |SI nValor < 0;  nValor = 0;  |FINSI;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "41-0557";
     |HAZ GrabaLineal;

     eaCasilla = "42-0558"; |HAZ SacaImporte; nValor = enImporte;
     eaCasilla = "42-0559"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "42-0560"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "42-0561"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "42-0562"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "42-0563"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "42-0564"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "42-0565"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "42-0566"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "42-0567"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "42-0568"; |HAZ SacaImporte; nValor = nValor + enImporte;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "42-0569";
     |HAZ GrabaLineal;
     nValor1 = enImporte;

     eaCasilla = "41-0557"; |HAZ SacaImporte; nValor = enImporte - nValor1;

     enSwAcum   = 0;
     eaCasilla  = "43-0570";
     |SI nValor < 0;
          nValor2 = -nValor;
          |SI nValor2 > nValor1;
               nValor = -nValor1;
          |FINSI;
     |FINSI;
     enImporte  = nValor;
     |HAZ GrabaLineal;

     eaCasilla = "43-0571"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "43-0572"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "43-0582"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "43-0583"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "43-0595"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "43-0596"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "43-0609"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "43-0610"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "43-0611"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "43-0612"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "43-0613"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "43-0615"; |HAZ SacaImporte; nValor = nValor + enImporte;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "43-0620";
     |HAZ GrabaLineal;

     |HAZ CalculaAnexoC;   || rezcal09
|FPRC;

|PROCESO CalculaN;
     |ABRE #rem00100;
     #rem00100#0 = #refere1@#0;
     |LEE 040#rem00100.=;
     |SI FSalida ! 0;  |DDEFECTO #rem00100;  |FINSI;
     |CIERRA #rem00100;

                              nCodAutonomico = #rem00100#11;
     |SI enConta        = 2;  nCodAutonomico = #rem00100#43;  |FINSI;
     |SI nCodAutonomico = 0;  nCodAutonomico = #rem00100#11;  |FINSI;

     |SI nCodAutonomico = 18;  |ACABA; |FINSI;
     |SI nCodAutonomico = 19;  |ACABA; |FINSI;
     |SI nCodAutonomico = 20;  |ACABA; |FINSI;

     nImporte = 0;
     eaCasilla = "40-0551"; |HAZ SacaImporte;
     eaCasilla = "44-0621"; |HAZ GrabaLineal;

     nImporte = 0;
     eaCasilla = "41-0553"; |HAZ SacaImporte;  nImporte = nImporte + enImporte;
     eaCasilla = "41-0554"; |HAZ SacaImporte;  nImporte = nImporte + enImporte;
     eaCasilla = "41-0555"; |HAZ SacaImporte;  nImporte = nImporte + enImporte;

     nImporte = (nImporte % 50) ! 2;
     eaCasilla = "44-0622"; enImporte = nImporte;  |HAZ GrabaLineal;

     nImporte = 0;
     eaCasilla = "44-0621"; |HAZ SacaImporte;  nImporte = enImporte;
     eaCasilla = "44-0622"; |HAZ SacaImporte;  nImporte = nImporte - enImporte;

     |SI nImporte < 0;  nImporte = 0;  |FINSI;

     eaCasilla = "44-0625"; enImporte = nImporte;  |HAZ GrabaLineal;
|FPRC;
