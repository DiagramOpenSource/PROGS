|FICHEROS;
     zaccesox;
     zw000001,MANTE;

     reacceso;
     reparame;
     rem99999;
     rem01001;
|FIN;

|VARIABLES;
     &efFechaPatrim  = @;

     nRango          = 0;
     nGrid           = 0;
     nCampo          = 0;
     nPanta100       = 0;
     nHandle         = 0;
     nError          = 0;
     nHandle1        = 0;
     nHandle2        = 0;
     nPos            = 0;
     nLLave          = 0;
     nBtn            = 0;
     nLabDes         = -1;
     nSwGrupo1       = 0;
     nSwGrupo2       = 0;
     nOpcion         = 0;
     nEsArrend       = 0;
     nSwRecoge       = 0;
     nSwActiv        = 0;
     nDCodigo        = 0;
     nHCodigo        = 0;
     nCampo1         = 0;
     nRegraba        = 0;
     nCompara        = 0;
     nPatrones       = 0;
     nContinuar      = 0;
     nLong           = 0;
     nCaracter       = 0;
     nPosi           = 0;
     nPtec           = 0;
     nTree           = 0;
     nPanta900       = 0;
     nLinea          = 0;
     nLiquida        = 0;
     nPatrim         = 0;
     nHayArrend      = 0;
     nVentana        = 0;

     nBtnAlta        = -1;
     nBtnModi        = -1;
     nBtnBaja        = -1;
     nBtnCons        = -1;
     nBtnReco        = -1;
     nBtnAnot        = -1;
     nBtnExpo        = -1;
     nBtnImpo        = -1;
     nBtnCRes        = -1;
     nBtnEmiRen      = -1;
     nBtnEmiPat      = -1;
     nBtnGad         = -1;
     nBtnMCli        = -1;
     nBtnDFam        = -1;
     nBtnDUsu        = -1;
     nBtnActi        = -1;
     nBtnDesa        = -1;
     nBtnCont        = -1;
     nBtnInci        = -1;
     nBtnResu        = -1;
     nBtnAyud        = -1;

     nEBtnAlta       = 0;
     nEBtnModi       = 0;
     nEBtnBaja       = 0;
     nEBtnCons       = 0;
     nEBtnReco       = 0;
     nEBtnAnot       = 0;
     nEBtnExpo       = 0;
     nEBtnImpo       = 0;
     nEBtnCRes       = 0;
     nEBtnEmiRen     = 0;
     nEBtnEmiPat     = 0;
     nEBtnGad        = 0;
     nEBtnMCli       = 0;
     nEBtnDFam       = 0;
     nEBtnDUsu       = 0;
     nEBtnActi       = 0;
     nEBtnDesa       = 0;
     nEBtnCont       = 0;
     nEBtnInci       = 0;
     nEBtnResu       = 0;

     aAlfa           = "";
     aEsc1           = "";
     aEsc2           = "";
     aRetu           = "";
     aTecla          = "";
     aBoton          = "";
     aLanza          = "";
     aUsuario1       = "";
     aUsuario2       = "";
     aBase           = "";
     aParametro      = "";
     aVariable       = "";
     aGrupo1         = "";
     aGrupo2         = "";
     aSiNo           = "";
     aTipo           = "";
     aPathRenta      = "";
     aDef            = "";
     aAlfa1          = "";
     aAlfa2          = "";
     aCadena         = "";
     aOrigen         = "";
     aDestino        = "";
     aIPRemoto       = "";
     aQueBoton       = "";
     aID             = "";
     aContenido      = "";
     aLineaMenu      = "";
     aCaracter       = "";
     aPrograma       = "";
     aTitulo         = "";
     aAbre           = "";
     aCap            = "";
     aFichero        = "";
     aHora           = "";

     fFecha          = @;

 {-1}aVent             = "";
     aVent1            = 0;
     aVent2            = 0;
     aVent3            = 0;
     aVent4            = 0;
     aVent5            = "";

 {-1}sTree             = 0;
     sT_nID            = 0;
     sT_nOper          = 0;
     sT_aData          = "";

     &eaExtr           = "";
     &enEmpresa        = 0;
     &eaNombre         = "";
     &eaNif            = "";
     &enModo           = 0;
     &eaVarDni         = "";
     &enCalcCif        = 0;
     &enComplementaria = 0;
     &eaLetra          = "";
     &eaPrograma       = "";
     &eaExtension      = "";
     &eaPunto          = "";
     &enCodCli         = 0;
     &enSwDeDonde      = 0;
     &enError          = 0;
     &enDesdeRenta     = 0;
     &eaUnidadBasico   = "";
     &enTipoEntrada    = 0;
     &enVentGnrl       = 0;
     &enVentTrab       = 0;
     &eaMensaCad       = "";
     &enErrorCad       = 0;
     &eaImpreso        = "";
     &eaModoMac        = "";
     &eaBloqueo        = "";

     &eaAzul           = "";
     &eaVerde          = "";
     &eaRojo           = "";
     &eaRosa           = "";
     &eaMarron         = "";
     &enBtnSalir       = 0;
|FIN;

|PROCESO Botones;
     nEBtnAlta       = 1;
     nEBtnModi       = 1;
     nEBtnBaja       = 1;
     nEBtnCons       = 1;
     nEBtnReco       = 1;
     nEBtnAnot       = 1;
     nEBtnExpo       = 1;
     nEBtnImpo       = 1;
     nEBtnCRes       = 1;
     nEBtnEmiRen     = 1;
     nEBtnEmiPat     = 1;
     nEBtnGad        = 1;
     nEBtnMCli       = 1;
     nEBtnDFam       = 1;
     nEBtnDUsu       = 1;
     nEBtnActi       = 1;
     nEBtnDesa       = 1;
     nEBtnCont       = 1;
     nEBtnInci       = 1;
     nEBtnResu       = 1;

     |SI nBtnAlta   ! -1;  |FIN_CONTROL_WINDOWS nBtnAlta;    |FINSI;
     |SI nBtnModi   ! -1;  |FIN_CONTROL_WINDOWS nBtnModi;    |FINSI;
     |SI nBtnBaja   ! -1;  |FIN_CONTROL_WINDOWS nBtnBaja;    |FINSI;
     |SI nBtnCons   ! -1;  |FIN_CONTROL_WINDOWS nBtnCons;    |FINSI;
     |SI nBtnReco   ! -1;  |FIN_CONTROL_WINDOWS nBtnReco;    |FINSI;
     |SI nBtnAnot   ! -1;  |FIN_CONTROL_WINDOWS nBtnAnot;    |FINSI;
     |SI nBtnMCli   ! -1;  |FIN_CONTROL_WINDOWS nBtnMCli;    |FINSI;
     |SI nBtnDFam   ! -1;  |FIN_CONTROL_WINDOWS nBtnDFam;    |FINSI;
     |SI nBtnCRes   ! -1;  |FIN_CONTROL_WINDOWS nBtnCRes;    |FINSI;
     |SI nBtnEmiRen ! -1;  |FIN_CONTROL_WINDOWS nBtnEmiRen;  |FINSI;
     |SI nBtnEmiPat ! -1;  |FIN_CONTROL_WINDOWS nBtnEmiPat;  |FINSI;
     |SI nBtnGad    ! -1;  |FIN_CONTROL_WINDOWS nBtnGad;     |FINSI;
     |SI nBtnDUsu   ! -1;  |FIN_CONTROL_WINDOWS nBtnDUsu;    |FINSI;
     |SI nBtnImpo   ! -1;  |FIN_CONTROL_WINDOWS nBtnImpo;    |FINSI;
     |SI nBtnExpo   ! -1;  |FIN_CONTROL_WINDOWS nBtnExpo;    |FINSI;
     |SI nBtnActi   ! -1;  |FIN_CONTROL_WINDOWS nBtnActi;    |FINSI;
     |SI nBtnDesa   ! -1;  |FIN_CONTROL_WINDOWS nBtnDesa;    |FINSI;
     |SI nBtnCont   ! -1;  |FIN_CONTROL_WINDOWS nBtnCont;    |FINSI;
     |SI nBtnInci   ! -1;  |FIN_CONTROL_WINDOWS nBtnInci;    |FINSI;
     |SI nBtnResu   ! -1;  |FIN_CONTROL_WINDOWS nBtnResu;    |FINSI;
     |SI nBtnAyud   ! -1;  |FIN_CONTROL_WINDOWS nBtnAyud;    |FINSI;

     |CONTROL_SIMPLE 0, "BOTON,{{193}}&Alta ", 3339, 3349, BtnAlta;
     nBtnAlta = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}&Modificar ", 3351, 3361, BtnModifica;
     nBtnModi = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}}&Baja ", 3363, 3373, BtnBaja;
     nBtnBaja = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}}&Consulta", 3327, 3337, BtnConsulta;
     nBtnCons = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,&Recoger 2016", 3302, 3312, BtnRecoger;
     nBtnReco = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,a&Notaciones", 3314, 3325, BtnAnotacion;
     nBtnAnot = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,consultar &Resultados", 2376, 2398, BtnCRes;
     nBtnCRes = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,&Gesti¢n cliente", 2576, 2598, BtnModCliente;
     nBtnMCli = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,datos &Familiares", 2676, 2698, BtnDFamiliares;
     nBtnDFam = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,em&Isi¢n renta", 2776, 2798, BtnEmisionRen;
     nBtnEmiRen = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,emisi¢n pa&Trimonio", 2876, 2898, BtnEmisionPat;
     nBtnEmiPat = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,consulta gesti¢n &Documental", 2976, 2998, BtnGAD;
     nBtnGad  = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,desactivar &Usuario", 3076, 3098, BtnDesacUsuario;
     nBtnDUsu = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,e&Xportaci¢n datos", 3176, 3198, BtnExportacion;
     nBtnExpo = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,im&Portaci¢n datos", 3276, 3298, BtnImportacion;
     nBtnImpo = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,contador&Es", 3376, 3398, BtnContador;
     nBtnCont = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,activar para el 20&18", 3476, 3498, BtnDesac2018;
     nBtnActi = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,desacti&Var incidencia", 3576, 3598, BtnIncidencia;
     nBtnInci = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,Informe re&Sumen", 2476, 2498, BtnResumen;
     nBtnResu = FSalida;

     |ESTADO_CONTROL nBtnActi, "HIDE";     nEBtnActi = 0;
     |ESTADO_CONTROL nBtnInci, "DISABLE";  nEBtnInci = 0;

     |CONTROL_SIMPLE nPanta100, "BOTON,desactivar para 2&018", 3476, 3498, BtnDesac2018;
     nBtnDesa = FSalida;

     |CONTROL_SIMPLE nPanta100, "BOTON,{{197}}a&Yuda colores", 0658, 0673,AyudaColores;
     nBtnAyud = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}&Hist¢rico incidencias", 3502, 3520, Incidencias;

     |CONTROL_SIMPLE 0, "BOTON,{{001}}sa&Lir", 3688, 3698, Ptec806;
     enBtnSalir = FSalida;
|FPRC;

|PROCESO CreaVentana;
     |ESTADO_CONTROL nGrid, "HIDE";

     |SI nBtnAlta   ! -1;  |ESTADO_CONTROL nBtnAlta, "HIDE";    |FINSI;
     |SI nBtnModi   ! -1;  |ESTADO_CONTROL nBtnModi, "HIDE";    |FINSI;
     |SI nBtnBaja   ! -1;  |ESTADO_CONTROL nBtnBaja, "HIDE";    |FINSI;
     |SI nBtnCons   ! -1;  |ESTADO_CONTROL nBtnCons, "HIDE";    |FINSI;
     |SI nBtnReco   ! -1;  |ESTADO_CONTROL nBtnReco, "HIDE";    |FINSI;
     |SI nBtnAnot   ! -1;  |ESTADO_CONTROL nBtnAnot, "HIDE";    |FINSI;
     |SI nBtnMCli   ! -1;  |ESTADO_CONTROL nBtnMCli, "HIDE";    |FINSI;
     |SI nBtnDFam   ! -1;  |ESTADO_CONTROL nBtnDFam, "HIDE";    |FINSI;
     |SI nBtnCRes   ! -1;  |ESTADO_CONTROL nBtnCRes, "HIDE";    |FINSI;
     |SI nBtnEmiRen ! -1;  |ESTADO_CONTROL nBtnEmiRen, "HIDE";  |FINSI;
     |SI nBtnEmiPat ! -1;  |ESTADO_CONTROL nBtnEmiPat, "HIDE";  |FINSI;
     |SI nBtnGad    ! -1;  |ESTADO_CONTROL nBtnGad, "HIDE";     |FINSI;
     |SI nBtnDUsu   ! -1;  |ESTADO_CONTROL nBtnDUsu, "HIDE";    |FINSI;
     |SI nBtnImpo   ! -1;  |ESTADO_CONTROL nBtnImpo, "HIDE";    |FINSI;
     |SI nBtnExpo   ! -1;  |ESTADO_CONTROL nBtnExpo, "HIDE";    |FINSI;
     |SI nBtnActi   ! -1;  |ESTADO_CONTROL nBtnActi, "HIDE";    |FINSI;
     |SI nBtnDesa   ! -1;  |ESTADO_CONTROL nBtnDesa, "HIDE";    |FINSI;
     |SI nBtnCont   ! -1;  |ESTADO_CONTROL nBtnCont, "HIDE";    |FINSI;
     |SI nBtnInci   ! -1;  |ESTADO_CONTROL nBtnInci, "HIDE";    |FINSI;
     |SI nBtnResu   ! -1;  |ESTADO_CONTROL nBtnResu, "HIDE";    |FINSI;
     |SI nBtnAyud   ! -1;  |ESTADO_CONTROL nBtnAyud, "HIDE";    |FINSI;

     |HAZ QuitaBtnSalir;

     |VENTANA 0501, 3499, -1, 16, aTitulo;
     enVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = enVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |PULSATECLA;
|FPRC;

|PROCESO DestruyeVentana;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = enVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA enVentTrab;

     |HAZ Botones;

     |ESTADO_CONTROL nGrid, "SHOW";

     |HAZ PonBtnSalir;

     |PULSATECLA;
|FPRC;

|PROCESO Lanzador;
     |DBASS aBase;
     aAbre = aBase + "integral/def/dsam0021.mas";
     |XABRE "E", aAbre, 0;
     |SI FSalida ] 0;
         aAlfa = ":integral/dsam0021;" + (("00000" + #reacceso#0) % -105);
         aAlfa = aAlfa + "CHEQUEO";
         |SUB_EJECUTA aAlfa;

         |SI eaBloqueo ! "1";
             aAlfa = "|:integral/dsam0021;" + (("00000" + #reacceso#0) % -105);
             aAlfa = aAlfa + "PANTALLA";
             |SUB_EJECUTA aAlfa;
         |FINSI;

         |SI eaBloqueo = "3";
             |ACABA;
         |FINSI;
     |FINSI;

     |SI aBoton = "MODCLIENTE";
         |SUB_EJECUTA ":integral/dsxz0001;MIRAMODO";
         |SI eaModoMac = "9";
             aLanza = "*:ren2017/zacceso9;" + (("00000" + #reacceso#0) % -105) + aBoton;
             |SUB_EJECUTA aLanza;
         |SINO;
             enEmpresa = #reacceso#0;
             |SUB_EJECUTA ":integral/dsxz0001;MODORENTA";
         |FINSI;

         |REFRESCACONTROL nGrid;
         |FOCOTECLADO nGrid;

         |ACABA;
     |FINSI;

     |ABRE #rem99999;
     #rem99999#0 = #reacceso#0;
     #rem99999#1 = "rem01001";
     #rem99999#2 = "";
     |LEE 000#rem99999.=;
     nLiquida = FSalida;
     |CIERRA #rem99999;

     |SI nLiquida ! 0;  |Y enModo ! 4;
         |LEE 101#reacceso.=;
         |SI FSalida = 0;
             |HAZ Modicli;

             enEmpresa = #reacceso#0;
             |GRABA 020#reacceso.a;
             |LIBERA #reacceso;
        |FINSI;
     |FINSI;

     aTitulo = "Renta 2017 - " + (("00000" + #reacceso#0) % -105);
     aTitulo = aTitulo + " - " + #reacceso#1;  |QBF aAlfa;
     |HAZ CreaVentana;

     enEmpresa = #reacceso#0;
     |SI aBoton = "MODIFICAR";    |HAZ Modificar;  |FINSI;
     |SI aBoton = "CONSULTAR";    |HAZ Consultar;  |FINSI;

     |HAZ DestruyeVentana;

     #reacceso#0 = enEmpresa;
     |LEE 000#reacceso.=;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnAlta;
     |SI nEBtnAlta = 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 1162, -1, 16, "Nuevo c¢digo de renta";
     enVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = enVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #zw000001;
     |PINPA #0#zw000001;
     |PINDA #0#zw000001;
     |ENDATOS #1#zw000001;
     |SI FSalida ! 0;
         aVent1 = -1;
         aVent2 = -1;
         aVent3 = 0;
         aVent4 = enVentTrab;
         aVent5 = "MODELESS";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         |FINVENTANA enVentTrab;

         |ACABA;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = enVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA enVentTrab;

     |DDEFECTO #reacceso;
     #reacceso#0   = #zw000001#0;
     #reacceso#1   = #zw000001#1;
     #reacceso#2   = #zw000001#2;
     |GRABA 020#reacceso.b;
     |LIBERA #reacceso;

     |HAZ AltaCliente;
     |SI enError = 0;
         enEmpresa = #reacceso#0;

         |GRABA 020#reacceso.a;
         |LIBERA #reacceso;

         |SELECT #1#reacceso;
         #reacceso#0   = #zw000001#0;
         |LEE 000#reacceso.=;
     |SINO;
         enEmpresa = #reacceso#0;

         |BORRA 020#reacceso.a;
         |LIBERA #reacceso;
     |FINSI;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnModifica;
     |SI nEBtnModi = 0;  |ACABA;  |FINSI;

     |LEE 000#reacceso.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     enModo = 2;
     aBoton = "MODIFICAR";
     |HAZ Lanzador;
|FPRC;

|PROCESO BtnBaja;
     |SI nEBtnBaja = 0;  |ACABA;  |FINSI;

     |CONFI "0000NEsta Seguro de dar de baja la Renta ";
     |SI FSalida ! 0; |ACABA;  |FINSI;

     |LEE 101#reacceso.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     enEmpresa = #reacceso#0;
     |HAZ BorraRenta;

     |BORRA 020#reacceso.a;
     |LIBERA #reacceso;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnConsulta;
     |SI nEBtnCons = 0;  |ACABA;  |FINSI;

     enModo = 4;
     aBoton = "CONSULTAR";
     |HAZ Lanzador;
|FPRC;

|PROCESO BtnRecoger;
     |SI nEBtnReco = 0; |ACABA;  |FINSI;

     |LEE 000#reacceso.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aUsuario1  = #reacceso#16;  |QBF aUsuario1;
     |SI #reparame#20 = "S";  |O aUsuario1 ! "";
         aUsuario2 = Usuario % 810;  |QBF aUsuario2;

         |SI aUsuario1 ! aUsuario2;  |Y aUsuario1 ! "";
             |MENAV "0000 No tiene permiso para operar en esta Renta.";
             |ACABA;
         |FINSI;
     |FINSI;

     |ABRE #rem99999;
     #rem99999#0 = #reacceso#0;
     #rem99999#1 = "rem01001";
     #rem99999#2 = "";
     |LEE 000#rem99999.=;
     nLiquida = FSalida;
     |CIERRA #rem99999;

     |SI nLiquida = 0;
         |MENAV "     Renta ya Calculada, no le puedo dejar hacer el Pase.";
         |ACABA;
     |FINSI;

     enEmpresa = #reacceso#0;
     |LEE 101#reacceso.=;
     |SI FSalida ! 0;
         |DDEFECTO #reacceso;
         #reacceso#0 = enEmpresa;
         |GRABA 020#reacceso.b;
     |FINSI;

     |LIBERA #reacceso;
     enCodCli = #reacceso#0;

     aTitulo = "Renta 2017 - " + (("00000" + #reacceso#0) % -105);
     aTitulo = aTitulo + " - " + #reacceso#1;  |QBF aAlfa;
     |HAZ CreaVentana;
     |SUB_EJECUTA_NP "rezcapea";
     |HAZ DestruyeVentana;

     #reacceso#0 = enEmpresa;
     |LEE 101#reacceso.=;
     |SI FSalida = 0;
         |GRABA 020#reacceso.a;
     |FINSI;
     |LIBERA #reacceso;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnAnotacion;
     |SI nEBtnAnot = 0;  |ACABA;  |FINSI;

     aAlfa    = "rem01005;" + (("00000" + #reacceso#0) % -105);
     |SUB_EJECUTA_NP aAlfa;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnExportacion;
     |SI nEBtnExpo = 0;  |ACABA;  |FINSI;

     |LEE 000#reacceso.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aTitulo = "Renta 2017 - " + (("00000" + #reacceso#0) % -105);
     aTitulo = aTitulo + " - " + #reacceso#1;  |QBF aAlfa;
     |HAZ CreaVentana;

     enEmpresa = #reacceso#0;
     eaNombre  = #reacceso#1;

     |SUB_EJECUTA "rez00300";

     |HAZ DestruyeVentana;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnImportacion;
     |SI nEBtnImpo = 0;  |ACABA;  |FINSI;

     aTitulo = "";
     |HAZ CreaVentana;
     |SUB_EJECUTA "rez00301";
     |HAZ DestruyeVentana;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnCRes;
     |SI nEBtnCRes = 0;  |ACABA;  |FINSI;

     |HAZ CreaVentana;
     enModo = 4;
     |SUB_EJECUTA "rem01001";
     |HAZ DestruyeVentana;
|FPRC;

|PROCESO BtnEmisionRen;
     |SI nEBtnEmiRen = 0;  |ACABA;  |FINSI;

     |ABRE #rem99999;
     #rem99999#0 = #reacceso#0;
     #rem99999#1 = "rem01001";
     #rem99999#2 = "";
     |LEE 000#rem99999.=;
     nLiquida = FSalida;
     |CIERRA #rem99999;

     |SI nLiquida ! 0;
         |MENAV "     Renta NO Calculada, no puedo EMITIR la RENTA";
         |ACABA;
     |FINSI;

     aTitulo = "Renta 2017 - " + (("00000" + #reacceso#0) % -105);
     aTitulo = aTitulo + " - " + #reacceso#1;  |QBF aAlfa;
     |HAZ CreaVentana;

     enEmpresa = #reacceso#0;
     aAlfa = "reemi100;EMP" + (("00000" + #reacceso#0) % -105) + "|MODELO100";
     |SUB_EJECUTA aAlfa;

     |SUB_EJECUTA "|zacceso9";

     |LEE 000#reacceso.c;

     |HAZ DatosPantalla;

     |HAZ DestruyeVentana;

     enEmpresa = #reacceso#0;

     |GRABA 020#reacceso.a;
     |LIBERA #reacceso;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnEmisionPat;
     |SI nEBtnEmiPat = 0;  |ACABA;  |FINSI;

     aTitulo = "Renta 2017 - " + (("00000" + #reacceso#0) % -105);
     aTitulo = aTitulo + " - " + #reacceso#1;  |QBF aAlfa;
     |HAZ CreaVentana;

     enEmpresa = #reacceso#0; efFechaPatrim  = #reacceso#18;
     aAlfa = "reemi100;EMP" + (("00000" + #reacceso#0) % -105) + "|MODELO714";
     |SUB_EJECUTA aAlfa;

     |SUB_EJECUTA "|zacceso9";

     |LEE 000#reacceso.c;

     |HAZ DatosPantalla;

     |HAZ DestruyeVentana;

     enEmpresa = #reacceso#0;

     |GRABA 020#reacceso.a;
     |LIBERA #reacceso;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnGAD;
     |SI nEBtnGad = 0;  |ACABA;  |FINSI;

     aAlfa = (("00000" + #reacceso#0) % -105) + "2017" + "99" + "100" + "00";
     aAlfa = aAlfa + #reacceso#1;
     aAlfa = ":dsarchi/dsarz017;" + aAlfa;
     |SUB_EJECUTA aAlfa;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnModCliente;
     |SI nEBtnMCli = 0;  |ACABA;  |FINSI;

     enModo = 2;
     aBoton = "MODCLIENTE";
     |HAZ Lanzador;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnDFamiliares;
     |SI nEBtnDFam = 0;  |ACABA;  |FINSI;

     aTitulo = "Renta 2017 - " + (("00000" + #reacceso#0) % -105);
     aTitulo = aTitulo + " - " + #reacceso#1;  |QBF aAlfa;
     |HAZ CreaVentana;

     enEmpresa = #reacceso#0;
     enModo    = 4;
     |SUB_EJECUTA "rem00101";

     |HAZ DestruyeVentana;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnDesacUsuario;
     |SI nEBtnDUsu = 0;  |ACABA;  |FINSI;

     aUsuario1 = #reacceso#16;  |QBF aUsuario1;
     aUsuario2 = Usuario % 810;  |QBF aUsuario2;

     |SI aUsuario1 = "";
         |MENAV "0000 Renta sin Usuario.";
         |ACABA;
     |FINSI;

     |SI aUsuario1 ! aUsuario2;
         |MENAV "0000 Usted no tiene permiso para Desactivar el Usuario de esta Renta.";
         |ACABA;
     |FINSI;

     |CONFI "0000NSeguro que quiere desactivar el usuario de esta Renta ";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SELECT #1#reacceso;
     |LEE 101#reacceso.=;
     |SI FSalida = 0;
         #reacceso#16   = "";  |PINTA #reacceso#16;

         enEmpresa = #reacceso#0;
         |GRABA 020#reacceso.a;
         |LIBERA #reacceso;
     |FINSI;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnContador;
     |SI nEBtnCont = 0;  |ACABA;  |FINSI;

     aTitulo = "";
     |HAZ CreaVentana;
     |SUB_EJECUTA "rez00012";
     |HAZ DestruyeVentana;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnDesac2018;
     |SI nEBtnDesa = 0;  |Y nEBtnActi = 0;
         |ACABA;
     |FINSI;

     |SI #reacceso#19 = "N";
         |CONFI "0000NSeguro que quiere DESACTIVAR la renta para el pase del 2018.";
     |SINO;
         |CONFI "0000NSeguro que quiere ACTIVAR la renta para el pase del 2018.";
     |FINSI;

     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SELECT #1#reacceso;
     |LEE 101#reacceso.=;
     |SI FSalida = 0;
         |SI #reacceso#19 = "N";
             #reacceso#20 = eaRosa;
             #reacceso#19 = "S";
         |SINO;
             #reacceso#20 = "";
             #reacceso#19 = "N";
         |FINSI;

         enEmpresa = #reacceso#0;

         |GRABA 020#reacceso.a;
         |LIBERA #reacceso;
     |FINSI;

     |SI #reacceso#19 = "N";
         |ESTADO_CONTROL nBtnDesa, "SHOW";  nEBtnDesa = 1;
         |ESTADO_CONTROL nBtnActi, "HIDE";  nEBtnActi = 0;
     |SINO;
         |ESTADO_CONTROL nBtnDesa, "HIDE";  nEBtnDesa = 0;
         |ESTADO_CONTROL nBtnActi, "SHOW";  nEBtnActi = 1;
     |FINSI;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnIncidencia;
     |SI nEBtnInci = 0;  |ACABA;  |FINSI;

     |CONFI "0000NSeguro que quiere DESACTIVAR la incidencia.";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SELECT #1#reacceso;
     |LEE 101#reacceso.=;
     |SI FSalida = 0;
         fFecha = ~;
         |HORA aHora;

         #reacceso#23 = "N";
         #reacceso#24 = "S";
         #reacceso#25 = Usuario % 810;
         #reacceso#26 = fFecha;
         #reacceso#27 = aHora;

                                           #reacceso#20 = "";
         |SI #reacceso#12 = "*";           #reacceso#20 = eaAzul;   |FINSI;
         |SI #reacceso#14 = "IMPRESO   ";  #reacceso#20 = eaVerde;  |FINSI;
         |SI #reacceso#19 = "S";           #reacceso#20 = eaRosa;   |FINSI;
         |SI #reacceso#23 = "S";           #reacceso#20 = eaRojo;   |FINSI;
         |SI #reacceso#24 = "S";           #reacceso#20 = eaMarron; |FINSI;

         eaImpreso = "N";
         aAlfa = #reacceso#20;  |QBF aAlfa;
         |SI aAlfa = eaVerde;
             eaImpreso = "S";      || Para la auditoria
         |FINSI;

         enEmpresa = #reacceso#0;

         |GRABA 020#reacceso.a;
         |LIBERA #reacceso;

         |ESTADO_CONTROL nBtnInci, "DISABLE";  nEBtnInci = 0;
     |FINSI;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnResumen;
     |SI nEBtnResu = 0;  |ACABA;  |FINSI;

     |HAZ CreaVentana;
     aAlfa = "rey00008;" + #reacceso#0;
     |SUB_EJECUTA aAlfa;
     |HAZ DestruyeVentana;
|FPRC;

|PROCESO ActivaDesactiva;
     |SI #reacceso#12 = "*";
         |ESTADO_CONTROL nBtnReco, "DISABLE";  nEBtnReco = 0;
     |SINO;
         |ESTADO_CONTROL nBtnReco, "ENABLE";  nEBtnReco = 1;
     |FINSI;

     aUsuario1 = #reacceso#16;  |QBF aUsuario1;
     aUsuario2 = Usuario % 810;  |QBF aUsuario2;

     |SI aUsuario1 = aUsuario2;
         |ESTADO_CONTROL nBtnDUsu, "ENABLE";  nEBtnDUsu = 1;
     |SINO;
         |ESTADO_CONTROL nBtnDUsu, "DISABLE"; nEBtnDUsu = 0;
     |FINSI;

     |DBASS aBase;  |QBF aBase;
     aAlfa = aBase + "dsarchi/def/dsarz017.mas";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida ] 0;
         |ESTADO_CONTROL nBtnGad, "ENABLE";  nEBtnGad = 1;
     |SINO;
         |ESTADO_CONTROL nBtnGad, "DISABLE";  nEBtnGad = 0;
     |FINSI;

     |SI #reacceso#19 = "N";
         |ESTADO_CONTROL nBtnDesa, "SHOW";  nEBtnDesa = 1;
         |ESTADO_CONTROL nBtnActi, "HIDE";  nEBtnActi = 0;
     |SINO;
         |ESTADO_CONTROL nBtnDesa, "HIDE";  nEBtnDesa = 0;
         |ESTADO_CONTROL nBtnActi, "SHOW";  nEBtnActi = 1;
     |FINSI;

     |SI #reacceso#23 = "S";
         |ESTADO_CONTROL nBtnInci, "ENABLE";  nEBtnInci = 1;
     |SINO;
         |ESTADO_CONTROL nBtnInci, "DISABLE";  nEBtnInci = 0;
     |FINSI;

     |ABRE #rem99999;
     #rem99999#0 = #reacceso#0;
     #rem99999#1 = "rem01001";
     #rem99999#2 = "";
     |LEE 000#rem99999.=;
     nLiquida = FSalida;
     |CIERRA #rem99999;

     |SI nLiquida ! 0;
         |ESTADO_CONTROL nBtnCRes,   "DISABLE";  nEBtnCRes   = 0;
         |ESTADO_CONTROL nBtnEmiRen, "DISABLE";  nEBtnEmiRen = 0;
         |ESTADO_CONTROL nBtnResu,   "DISABLE";  nEBtnResu   = 0;
     |SINO;
         |ESTADO_CONTROL nBtnCRes,   "ENABLE";   nEBtnCRes   = 1;
         |ESTADO_CONTROL nBtnEmiRen, "ENABLE";   nEBtnEmiRen = 1;
         |ESTADO_CONTROL nBtnResu,   "ENABLE";   nEBtnResu   = 1;
     |FINSI;

     nPatrim = 0;
     |ABRE #rem01001;
     #rem01001#0 = #reacceso#0;
     #rem01001#1 = "";
     #rem01001#2 = "ZPATRI   ";
     |LEE 000#rem01001.];
     |PARA; |SI FSalida = 0; |Y #rem01001#0 = #reacceso#0; |HACIENDO;
        |SI #rem01001#5 = "714"; nPatrim = 1; |SAL; |FINSI;
        |LEE 000#rem01001.s;
     |SIGUE;
     |CIERRA #rem01001;

     |SI nPatrim = 0;
         |ESTADO_CONTROL nBtnEmiPat, "DISABLE"; nEBtnEmiPat = 0;
     |SINO;
         |ESTADO_CONTROL nBtnEmiPat, "ENABLE";  nEBtnEmiPat = 1;
     |FINSI;

     |SI nLabDes ! -1;
         |DESTRUYECONTROL nLabDes;
         nLabDes = -1;
     |FINSI;

     |SI #reacceso#24 = "S";
         aAlfa = "LABEL,{{7}}";
         aAlfa = aAlfa + " Desactivada incidencia por " + #reacceso#25;  |QBF aAlfa;
         aAlfa = aAlfa + " el d¡a " + #reacceso#26;
         aAlfa = aAlfa + " a las " + #reacceso#27;

         |CONTROL_SIMPLE nPanta100, aAlfa, 0602, 0657, NULL;
         nLabDes = FSalida;
     |FINSI;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Incidencias;
     |SUB_EJECUTA "rem99998";

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO EventoGrid;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#reacceso.=;
         |SI FSalida ! 0;
             |ACABA;
         |FINSI;

         |PARA nCampo = 0;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
               #zaccesox#nCampo# = #reacceso#nCampo#;
               |SI #reacceso#nCampo# = "*";  #zaccesox#nCampo# = "S";  |FINSI;
               |SI #reacceso#nCampo# = " ";  #zaccesox#nCampo# = "N";  |FINSI;

               |C_V #zaccesox#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";
                   |PINTA #zaccesox#nCampo#;
               |FINSI;
         |SIGUE;

         |HAZ ActivaDesactiva;

         enEmpresa = #reacceso#0;
     |FINSI;

     |SI FSalida = 4;
         |HAZ BtnModifica;
     |FINSI;
|FPRC;

|PROCESO AyudaColores;
     |VENTANA 0602, 1373, -1, 17, "Ayuda colores GRID";
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "LABEL,{{16}}Negro", 0703, 0710, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Rentas sin liquidar", 0712, 0773, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Azul", 0803, 0810, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Rentas liquidadas", 0812, 0873, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Verde", 0903, 0910, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Rentas impresas", 0912, 0973, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Rojo", 1003, 1010, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Rentas con incidencias", 1012, 1073, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Marr¢n", 1103, 1110, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Rentas impresas con incidencias de la versi¢n desactivada", 1112, 1173, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Rosa", 1203, 1210, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Rentas baja a¤o siguiente", 1212, 1273, NULL;

     |PAUSA;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;
|FPRC;

|PROGRAMA;
     eaMensaCad = "X";
     |HAZ ControlCaducidad;
     |SI enErrorCad = 1;
         |ACABA;
     |FINSI;

     |HAZ CargaColores;

     |CLS;
     |CABEZA "Renta 2017";

     |VENTANA 0501, 3499, -1, 0, "";
     enVentGnrl = FSalida;

     |PTEC 802;  |PAUSA;

     |SUB_EJECUTA_NP "rezcalve;AUTOMATICO";
     |SI enError = 1;
         |FINVENTANA enVentGnrl;
         |ACABA;
     |FINSI;

     |SELECT #4#reacceso;
     #reacceso#23 = "S";
     |LEE 000#reacceso.=;
     |SI FSalida = 0;  |Y  #reacceso#23 = "S";
         |MENAV "0000Hay rentas impresas con incidencias. Por favor reviselas";
     |FINSI;

     |SELECT #1#reacceso;

     |ABRE #reparame;
     |LEE 000#reparame.p;
     |SI FSalida ! 0;  |DDEFECTO #reparame;  |FINSI;
     |CIERRA #reparame;

     |PINPA #0#zaccesox;
     nPanta100 = FSalida;

     aAlfa = #reparame#20;
     |C_V #zaccesox#16, 1, aAlfa;

     |SI aAlfa = "N";
         |CONTROL_SIMPLE nPanta100, "LABEL,{{12}}Desactivado", 0588, 0598, NULL;
     |FINSI;

     |HAZ Botones;

     nRango = 2 + 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#reacceso, nRango, 0702, 3573, NULL, NULL, EventoGrid;
     nGrid = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
           FSalida = "::," + nGrid;
           |LEETECLA aTecla;

           |SI aTecla = aEsc1; |SAL;  |FINSI;
           |SI aTecla = aEsc2; |SAL;  |FINSI;
           |SI aTecla = aRetu;
               |HAZ BtnModifica;
           |FINSI;
     |SIGUE;

     |FINVENTANA enVentGnrl;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     aParametro = PARAMETRO;

     |HAZ LeeUnidadBasico;

     |ABRET #reacceso;

     FSalida = 3499;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |CIERRAT #reacceso;

     |SI aParametro ! "PORMENURENTA";
         |DBASS aBase;
         aBase = aBase + "integral/def/dsaz9999.mas";
         |XABRE "E", aBase, nHandle;
         |SI FSalida ] 0;
             |SUB_EJECUTA_NP "|:integral/dsaz9999";
         |FINSI;
     |FINSI;
|FPRC;
