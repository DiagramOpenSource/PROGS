|FICHEROS;
     dsam0000 #0;
     :/integral/def/dsaw0015 #915,MANTE;
     :/basica/def/agicen14   #614;

     :/basica/def/agicen17   #617;
     :/modelos/def/dsmom033  #133;
|FIN;

|VARIABLES;
     aAlfa      = "";
     aAlfa1     = "";
     aAlfa2     = "";
     aAlfa3     = "";
     nNume      = 0;

     &eOpSub        = 0;
     &enConcepto    = 0;
     &eaCodSubdep   = "";
     &eswLect       = 0;
     &eaNomSubdep   = "";
     &enTipoTribut  = 0;
     &enCultivo     = 0;
     &eaTipoCultivo = "";
|FIN;

|PROCESO Mes; |TIPO 0;
     |SI #915#2 = 1;
         #915#3 = 12;
     |SINO;
         #915#3 = #915#2 - 1;
     |FINSI;
     |PINTA #915#3;
|FPRC;

|PROCESO Nivel;  |TIPO 7;
     |C_M #915#5,  1, "S";
     |C_M #915#6,  1, "S";
     |C_M #915#7,  1, "S";
     |C_M #915#8,  1, "S";
     |C_M #915#9,  1, "S";
     |C_M #915#10, 1, "S";

     |SI #915#4 < 6;
         |C_M #915#10, 1, "N";  #915#10 = 0;
         |SI #915#4 < 5;
             |C_M #915#9, 1, "N";  #915#9 = 0;
             |SI #915#4 < 4;
                 |C_M #915#8, 1, "N";  #915#8 = 0;
                 |SI #915#4 < 3;
                     |C_M #915#7, 1, "N";  #915#7 = 0;
                     |SI #915#4 < 2;
                         |C_M #915#6, 1, "N";  #915#6 = 0;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO NivelRep;  |TIPO 0;
  |SI Campo = 6;  |Y #915#6 = 0; |Y #915#4 ] 2;
      |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
      |ERROR;
      |ACABA;
  |FINSI;

  |SI Campo = 7;  |Y #915#7 = 0; |Y #915#4 ] 3;
      |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
      |ERROR;
      |ACABA;
  |FINSI;

  |SI Campo = 8;  |Y #915#8 = 0; |Y #915#4 ] 4;
      |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
      |ERROR;
      |ACABA;
  |FINSI;

  |SI Campo = 9;  |Y #915#9 = 0; |Y #915#4 ] 5;
      |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
      |ERROR;
      |ACABA;
  |FINSI;

  |SI Campo = 10;  |Y #915#10 = 0; |Y #915#4 ] 6;
      |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
      |ERROR;
      |ACABA;
  |FINSI;

  |SI Campo = 6; |Y #915#6 ! 0;    || Si hay dos niveles iguales o menor error
      |SI #915#6 [ #915#5;
          |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;

  |SI Campo = 7; |Y #915#7 ! 0; || Si hay dos niveles iguales o menor error
      |SI #915#7 [ #915#5; |O #915#7 [ #915#6;
          |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;

  |SI Campo = 17; |Y #915#8 ! 0; || Si hay dos niveles iguales o menor error
      |SI #915#8 [ #915#5; |O #915#8 [ #915#6; |O #915#8 [ #915#7;
         |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
         |ERROR;
         |ACABA;
      |FINSI;
  |FINSI;

  |SI Campo = 18; |Y #915#9 ! 0; || Si hay dos niveles iguales o menor error
      |SI #915#9 [ #915#5; |O #915#9 [ #915#6; |O #915#9 [ #915#7; |O #915#9 [ #915#8;
          |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;

  |SI Campo = 19; |Y #915#10 ! 0;    || Si hay dos niveles iguales o menor error
      |SI #915#10 [ #915#5; |O #915#10 [ #915#6; |O #915#10 [ #915#7; |O #915#10 [ #915#8; |O #915#10 [ #915#9;
          |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO Titulo;  |TIPO 0;
     |ABRE #614;
     #614#0 = #0#0;
     #614#1 = 1;
     |LEE 040#614];
     |SI FSalida ! 0;  |O #614#0 ! #0#0;
         |DDEFECTO #614;
     |FINSI;
     |CIERRA #614;

     aAlfa = #915#16;  |QBF aAlfa;
     |SI aAlfa = "";
         |SI #915#1 ] 80;
             nNume = 1900 + #915#1;
         |SINO;
             nNume = 2000 + #915#1;
         |FINSI;
         aAlfa1 = #0#1;     |QBF aAlfa1;
         aAlfa2 = #614#8;   |QBF aAlfa2;
         aAlfa3 = #614#10;  |QBF aAlfa3;
         aAlfa =  "[" + (("00000" + #0#0) % -105) + "/" + nNume + "] " + aAlfa1 + " " + aAlfa2 + " " + aAlfa3;
         #915#16 = aAlfa;
         |PINTA #915#16;
     |FINSI;
|FPRC;

|| ***********************************************************************
|| ..... Datos de Defecto Departamento y subdepartamento

|CALCULO defAct; |TIPO 0;
 aAlfa1 = #915#13; |C_M #915#18,1,aAlfa1;
|FCAL;

|RUTINA inferior2;
   #614#0 = #0#0;
   #614#1 = 01;
|FRUT;

|RUTINA superior2;
   #614#0 = #0#0;
   #614#1 = 99;
|FRUT;

|CALCULO MiraActiv; |TIPO 0;
   |C_M #915Campo, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI FSalida = 10;
       |ABRE #614;
       #614#1 = #915#18;
       |CONSULTA_F_CLAVE #1#614,inferior2,superior2;
       #915#18 = #614#1;
       |CIERRA #614;
   |FINSI;

   |ABRE #614;
   |DDEFECTO #614;
   #614#0 = #0#0;
   #614#1 = #915#18;
   |LEE 001#614=;
   |SI FSalida ! 0;
       |CONFI "    NError.! No Existe Actividad / Departamento. Continuar S/N ?";
       |SI FSalida ! 0;
           |ERROR;
       |FINSI;
       #915#20 = "";
   |SINO;
       enTipoTribut = #614#9;
       aAlfa1 = #614#1;
       aAlfa1 = ("00" + aAlfa1) % A02;
       #915#18 = aAlfa1; |PINTA #915#18;
       #915#20 = #614#4;
   |FINSI;
   |CIERRA #614;
|FCAL;

|CALCULO defSuba; |TIPO 0;
 aAlfa1 = "S";
 |SI #915#14 = "N"; aAlfa1 = "N"; |FINSI;

 |C_M #915#19,1,aAlfa1;
|FCAL;

|CALCULO TrasSub; |TIPO 0;
   |SI #915#14 = "N"; |ACABA; |FINSI;

   eOpSub = 0; || 1 = Consulta pantalla
   |SI FSalida = 10; eOpSub = 1;  |FINSI;
   enConcepto  = 1;
   eaCodSubdep = #915#19;
   |HAZ SubActividad;
   |SI eswLect = 1;
       |CONFI "    NError.! No Existe SubDepartamento. Continuar S/N ?";
       |SI FSalida ! 0;
           |ERROR;
       |FINSI;
       #915#21 = "";
   |SINO;
       #915#19 = eaCodSubdep; |PINTA #915#19;
       #915#21 = eaNomSubdep;
   |FINSI;
|FCAL;

|RUTINA inferior1;
   #617#0 = #0#0;
   #617#1 = #915#18;
   #617#2 = 001;
|FRUT;

|RUTINA superior1;
   #617#0 = #0#0;
   #617#1 = #915#18;
   #617#2 = 999;
|FRUT;


|PROCESO SubActividad;

   eswLect = 0;
   eaNomSubdep = "";
   |SI #915#14 = "O"; |ACABA; |FINSI;

   |SI enTipoTribut = 6;  |O enTipoTribut = 7;
    |O enTipoTribut = 11; |O enTipoTribut = 12;
    |O enTipoTribut = 16; |O enTipoTribut = 17;
       enCultivo     = eaCodSubdep;
       eaTipoCultivo = "A";
       |SI eOpSub = 1;
           |SUB_EJECUTA_NP ":modelos/dsmom033";
       |FINSI;

       |ABRE #133;
       #133#0 = enCultivo;
       |LEE 001#133=;
       |SI FSalida ! 0;
           eswLect = 1;
       |FINSI;
       |CIERRA #133;
       eaCodSubdep = ("000" + enCultivo) % -103;
       eaNomSubdep = #133#1 % 140;
   |SINO;

       |ABRE #617;
       |SI eOpSub = 1;
           |CONSULTA_F_CLAVE #1#617,inferior1,superior1;
           eaCodSubdep = #617#2; |QBF eaCodSubdep;
           eaCodSubdep = ("000" + eaCodSubdep) % -103;
       |FINSI;

 |ET LaLectura;
       #617#0 = #0#0;
       #617#1 = #915#18;
       #617#2 = eaCodSubdep;
       |LEE 040#617=;
       |SI FSalida ! 0; |Y eaCodSubdep ! "   ";
           eswLect = 1;
       |FINSI;
       eaNomSubdep = #617#3;
       eaCodSubdep = #617#2; |QBF eaCodSubdep;
       eaCodSubdep = ("000" + eaCodSubdep) % -103;
       |CIERRA #617;
   |FINSI;
|FPRC;
