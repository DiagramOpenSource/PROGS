|FICHEROS;
     trasz005 #0;
     trasm001 #1;
     trasm002 #2;
     trasm004 #4;
|FIN;

|VARIABLES;
     aAlfa        = "";
     aDirec       = "";
     aHoja        = "";
     aNombreHoja  = "";
     aValor       = "";
     aNombre      = "";
     aFich        = "";
     aFichero     = "";
     aCadena      = "";
     aCaracter    = "";
     aLen         = "";
     aCampo       = "";

     aCampoA      = "";
     aCampoB      = "";
     aCampoC      = "";
     aCampoD      = "";
     aCampoE      = "";
     aCampoF      = "";
     aCampoG      = "";
     aCampoH      = "";
     aCampoI      = "";
     aCampoJ      = "";
     aCampoK      = "";
     aCampoL      = "";
     aCampoM      = "";
     aCampoN      = "";
     aCampoO      = "";
     aCampoP      = "";
     aCampoQ      = "";
     aCampoR      = "";
     aCampoS      = "";
     aCampoT      = "";

     nHandle      = 0;
     nContaBlanco = 0;
     nRegistro    = 0;
     nExcel       = 0;
     nCampo       = 0;
     nCampoAnt    = 0;
     nCasilla     = 0;
     nEstoy       = 0;
     nLen         = 0;
     nCampos      = 0;
     nPos         = 0;
     nContaRegis  = 0;
|FIN;

|PROCESO Ubicacion7;  |TIPO 7;
||     #0#1 = "C:\TMP\RENTAA~1\";

     aAlfa = #0#1;  |QBF aAlfa;
     |SI aAlfa = "";
         |PTEC 802;
     |FINSI;
|FPRC;

|PROCESO Ubicacion0;  |TIPO 0;
     aAlfa = #0#1;  |QBF aAlfa;
     |SI aAlfa = "";
         aDirec = "D";
         |BROWSE aDirec;
         aDirec = aDirec % 275;  |QBF aDirec;
         |SI aDirec = "";
             |MENAV "0000 Necesito una Ubicacion.";
             |ERROR;
             |ACABA;
         |FINSI;

         aDirec = aDirec + "\";
         #0#1   = aDirec;  |PINTA #0#1;
     |FINSI;

     aAlfa = #0#1;  |QBF aAlfa;
     aAlfa = aAlfa + "renta01.xls";
     |XABRE "EC", aAlfa, nHandle;
     |SI FSalida < 0;
         |MENAV "0000 En la Carpeta no existe ninguna Hoja con formato requerido.";
         |ERROR;
         #0#1 = "";   |PINTA #0#1;
         |ACABA;
     |FINSI;

     |PINTA #0#1;
|FPRC;

|PROCESO QuitaRaros;
     |QBF aValor;

     aCadena = "";
     aLen    = aValor % 0;
     nLen    = aLen;
     |PARA nCampos = 1;  |SI nCampos [ nLen;  |HACIENDO nCampos = nCampos + 1;
           nPos = (100 * nCampos) + 1;
           aCaracter = aValor % nPos;

           |SI aCaracter = "Á";  aCaracter = "A";  |FINSI;
           |SI aCaracter = "É";  aCaracter = "E";  |FINSI;
           |SI aCaracter = "Í";  aCaracter = "I";  |FINSI;
           |SI aCaracter = "Ó";  aCaracter = "O";  |FINSI;
           |SI aCaracter = "Ú";  aCaracter = "U";  |FINSI;
           |SI aCaracter = "á";  aCaracter = "A";  |FINSI;
           |SI aCaracter = "é";  aCaracter = "E";  |FINSI;
           |SI aCaracter = "í";  aCaracter = "I";  |FINSI;
           |SI aCaracter = "ó";  aCaracter = "O";  |FINSI;
           |SI aCaracter = "ú";  aCaracter = "U";  |FINSI;
           |SI aCaracter = "º";  aCaracter = "§";  |FINSI;
           |SI aCaracter = "ª";  aCaracter = "¦";  |FINSI;
           |SI aCaracter = "ñ";  aCaracter = "¤";  |FINSI;
           |SI aCaracter = "Ñ";  aCaracter = "¥";  |FINSI;
           |SI aCaracter = "€";  aCaracter = "ç";  |FINSI;
           |SI aCaracter = "‡";  aCaracter = "Ç";  |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;

     aValor = aCadena;
|FPRC;

|PROCESO GrabaDos;
     |NOME_DAT #2 aFichero;

     |ABRE #2;

     |HAZ QuitaRaros;

     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = nCasilla;
     #2#3 = aValor;
     |GRABA 020#2n;
     |LIBERA #2;

     |CIERRA #2;
|FPRC;

|PROCESO LeeCasilla;
     #0#4  = "Fichero: " + aNombreHoja + "   Casilla: " + aCampo;
     |PINTA #0#4;

     |ALFACALLDLL "agixl97.dll", "peek_dato", aCampo;  |QBF aCampo;
|FPRC;

|PROCESO DatosHijos;
     |SALVA_DATOS #1;

     aFichero = "renta002";

     #1#0 = "RENTA002";
     #1#1 = nRegistro;
     |GRABA 020#1n;
     |LIBERA #1;

     nCasilla = 0;
     |PARA;  |SI;  |HACIENDO;
          aCampo  = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
          |SI aCampoA = "Trabajo";  nEstoy = 2;  |SAL;  |FINSI;
          |SI aCampoA = "Datos personales (  Ascendientes mayores de 65 años )";
              |SAL;
          |FINSI;

          aCampo  = "C" + nCampo;  |HAZ LeeCasilla;  aCampoC = aCampo;
          aCampo  = "G" + nCampo;  |HAZ LeeCasilla;  aCampoG = aCampo;
          aCampo  = "J" + nCampo;  |HAZ LeeCasilla;  aCampoJ = aCampo;

          nCasilla = nCasilla + 1;  aValor = aCampoA;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoC;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoG;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoJ;  |HAZ GrabaDos;

          nCampo = nCampo + 1;
     |SIGUE;

     |REPON_DATOS #1;
|FPRC;

|PROCESO DatosAscendientes;
     |SALVA_DATOS #1;

     aFichero = "renta003";

     #1#0 = "RENTA003";
     #1#1 = nRegistro;
     |GRABA 020#1n;
     |LIBERA #1;

     nCasilla = 0;
     |PARA;  |SI;  |HACIENDO;
          aCampo  = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
          |SI aCampoA = "Trabajo";  nEstoy = 2;  |SAL;  |FINSI;

          aCampo  = "C" + nCampo;  |HAZ LeeCasilla;  aCampoC = aCampo;
          aCampo  = "G" + nCampo;  |HAZ LeeCasilla;  aCampoG = aCampo;
          aCampo  = "J" + nCampo;  |HAZ LeeCasilla;  aCampoJ = aCampo;

          nCasilla = nCasilla + 1;  aValor = aCampoA;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoC;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoG;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoJ;  |HAZ GrabaDos;

          nCampo = nCampo + 1;
     |SIGUE;

     |REPON_DATOS #1;
|FPRC;

|PROCESO DatosPersonales;
     aCampo  = "C" + nCampo;  |HAZ LeeCasilla;  aCampoC = aCampo;
     aCampo  = "D" + nCampo;  |HAZ LeeCasilla;  aCampoD = aCampo;
     aCampo  = "G" + nCampo;  |HAZ LeeCasilla;  aCampoG = aCampo;
     aCampo  = "J" + nCampo;  |HAZ LeeCasilla;  aCampoJ = aCampo;
     aCampo  = "K" + nCampo;  |HAZ LeeCasilla;  aCampoK = aCampo;
     aCampo  = "L" + nCampo;  |HAZ LeeCasilla;  aCampoL = aCampo;

     #1#0 = "RENTA001";
     #1#1 = nRegistro;
     |GRABA 020#1n;
     |LIBERA #1;

     aFichero = "renta001";

     nCasilla =  1;   aValor = aCampoC;  |HAZ GrabaDos;
     nCasilla =  5;   aValor = aCampoD;  |HAZ GrabaDos;  aNombre = aValor;
     nCasilla = 15;   aValor = aCampoG;  |HAZ GrabaDos;
     nCasilla = 23;   aValor = aCampoJ;  |HAZ GrabaDos;
     nCasilla = 22;   aValor = aCampoK;  |HAZ GrabaDos;
     nCasilla = 20;   aValor = aCampoL;  |HAZ GrabaDos;

     #4#0 = #1#1;
     #4#1 = aNombre;
     #4#2 = aCampoC;
     |GRABA 020#4n;
     |LIBERA #4;


     nCampo = nCampo + 2;

     aCampo  = "C" + nCampo;  |HAZ LeeCasilla;  aCampoC = aCampo;
     aCampo  = "D" + nCampo;  |HAZ LeeCasilla;  aCampoD = aCampo;
     aCampo  = "G" + nCampo;  |HAZ LeeCasilla;  aCampoG = aCampo;

     nCasilla = 103;   aValor = aCampoC;  |HAZ GrabaDos;
     nCasilla =   8;   aValor = aCampoD;  |HAZ GrabaDos;
     nCasilla =   6;   aValor = aCampoG;  |HAZ GrabaDos;

     nCampoAnt = nCampo;

     nCampo = nCampoAnt + 2;
     aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;

     |SI aCampoA = "Datos personales ( Cónyuge )";
         nCampo = nCampoAnt + 5;

         aCampo  = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
         aCampo  = "C" + nCampo;  |HAZ LeeCasilla;  aCampoC = aCampo;
         aCampo  = "G" + nCampo;  |HAZ LeeCasilla;  aCampoG = aCampo;
         aCampo  = "J" + nCampo;  |HAZ LeeCasilla;  aCampoJ = aCampo;

         nCasilla =  35;  aValor = aCampoA;  |HAZ GrabaDos;
         nCasilla =  39;  aValor = aCampoC;  |HAZ GrabaDos;
         nCasilla =  41;  aValor = aCampoG;  |HAZ GrabaDos;
         nCasilla = 104;  aValor = aCampoJ;  |HAZ GrabaDos;

         nCampo = nCampoAnt + 7;
         aCampo  = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
         |SI aCampoA = "Datos personales ( Hijos y otros descendientes )";
             nCampo = nCampoAnt + 10;
             |HAZ DatosHijos;
         |FINSI;

         |SI aCampoA = "Datos personales (  Ascendientes mayores de 65 años )";
             nCampo = nCampo + 4;
             |HAZ DatosAscendientes;
         |FINSI;
     |FINSI;

     nCampo = nCampoAnt + 3;
     aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
     |SI aCampoA = "Trabajo";  nEstoy = 2;  |ACABA;  |FINSI;

     |SI aCampoA = "Datos personales ( Hijos y otros descendientes )";
         nCampo = nCampoAnt + 6;
         |HAZ DatosHijos;
     |FINSI;

     |SI aCampoA = "Datos personales (  Ascendientes mayores de 65 años )";
         nCampo = nCampo + 4;
         |HAZ DatosAscendientes;
     |FINSI;
|FPRC;

|PROCESO Trabajo;
     |SALVA_DATOS #1;

     nEstoy = 0;
     nCampo = nCampo + 3;
     aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
     |SI aCampoA = "";  |ACABA;  |FINSI;

     #1#0 = "RENTA004";
     #1#1 = nRegistro;
     |GRABA 020#1n;
     |LIBERA #1;

     aFichero = "renta004";
     nCasilla = 0;

     |PARA;  |SI;  |HACIENDO;
          aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
          |SI aCampoA = "";  |SAL;  |FINSI;

          aCampo = "B" + nCampo;  |HAZ LeeCasilla;  aCampoB = aCampo;
          aCampo = "D" + nCampo;  |HAZ LeeCasilla;  aCampoD = aCampo;

          nCasilla = nCasilla + 1;  aValor = aCampoA;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoB;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoD;  |HAZ GrabaDos;

          nCampo = nCampo + 2;
     |SIGUE;

     |REPON_DATOS #1;
|FPRC;

|PROCESO CtasCtes;
     |SALVA_DATOS #1;

     nEstoy = 0;
     nCampo = nCampo + 4;
     aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
     |SI aCampoA = "";  |ACABA;  |FINSI;

     #1#0 = "RENTA005";
     #1#1 = nRegistro;
     |GRABA 020#1n;
     |LIBERA #1;

     aFichero = "renta005";
     nCasilla = 0;

     |PARA;  |SI;  |HACIENDO;
          aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
          |SI aCampoA = "";  |SAL;  |FINSI;

          aAlfa = aCampoA % 101;
          |SI aAlfa < "0";  |O aAlfa > "9";  |SAL;  |FINSI;

          aCampo = "B" + nCampo;  |HAZ LeeCasilla;  aCampoB = aCampo;
          aCampo = "D" + nCampo;  |HAZ LeeCasilla;  aCampoD = aCampo;
          aCampo = "E" + nCampo;  |HAZ LeeCasilla;  aCampoE = aCampo;

          nCasilla = nCasilla + 1;  aValor = aCampoA;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoB;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoD;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoE;  |HAZ GrabaDos;

          nCampo = nCampo + 2;
     |SIGUE;

     |REPON_DATOS #1;
|FPRC;

|PROCESO InmobiliarioGnral;
     |SALVA_DATOS #1;

     nEstoy = 0;
     nCampo = nCampo + 6;
     aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
     |SI aCampoA = "";  |ACABA;  |FINSI;

     #1#0 = "RENTA006";
     #1#1 = nRegistro;
     |GRABA 020#1n;
     |LIBERA #1;

     aFichero = "renta006";
     nCasilla = 0;

     |PARA;  |SI;  |HACIENDO;
          aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
          |SI aCampoA = "";  |SAL;  |FINSI;

          aAlfa = aCampoA % 101;
          |SI aAlfa < "0";  |O aAlfa > "9";  |SAL;  |FINSI;

          aCampo = "B" + nCampo;  |HAZ LeeCasilla;  aCampoB = aCampo;
          aCampo = "D" + nCampo;  |HAZ LeeCasilla;  aCampoD = aCampo;
          aCampo = "E" + nCampo;  |HAZ LeeCasilla;  aCampoE = aCampo;
          aCampo = "F" + nCampo;  |HAZ LeeCasilla;  aCampoF = aCampo;
          aCampo = "G" + nCampo;  |HAZ LeeCasilla;  aCampoG = aCampo;
          aCampo = "H" + nCampo;  |HAZ LeeCasilla;  aCampoH = aCampo;
          aCampo = "P" + nCampo;  |HAZ LeeCasilla;  aCampoP = aCampo;
          aCampo = "Q" + nCampo;  |HAZ LeeCasilla;  aCampoQ = aCampo;
          aCampo = "R" + nCampo;  |HAZ LeeCasilla;  aCampoR = aCampo;

          nCasilla = nCasilla + 1;  aValor = aCampoA;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoB;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoD;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoE;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoF;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoG;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoH;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoP;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoQ;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoR;  |HAZ GrabaDos;

          nCampo = nCampo + 3;
     |SIGUE;

     |REPON_DATOS #1;
|FPRC;

|PROCESO InmobiliarioOtros;
     |SALVA_DATOS #1;

     nEstoy = 0;
     nCampo = nCampo + 2;
     aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
     |SI aCampoA = "";  |ACABA;  |FINSI;

     nCampo = nCampo + 3;
     aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
     |SI aCampoA = "";  |ACABA;  |FINSI;

     #1#0 = "RENTA007";
     #1#1 = nRegistro;
     |GRABA 020#1n;
     |LIBERA #1;

     aFichero = "renta007";
     nCasilla = 0;

     |PARA;  |SI;  |HACIENDO;
          aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
          |SI aCampoA = "";  |SAL;  |FINSI;

          aAlfa = aCampoA % 101;
          |SI aAlfa < "0";  |O aAlfa > "9";  |SAL;  |FINSI;

          aCampo = "B" + nCampo;  |HAZ LeeCasilla;  aCampoB = aCampo;
          aCampo = "D" + nCampo;  |HAZ LeeCasilla;  aCampoD = aCampo;
          aCampo = "E" + nCampo;  |HAZ LeeCasilla;  aCampoE = aCampo;
          aCampo = "F" + nCampo;  |HAZ LeeCasilla;  aCampoF = aCampo;
          aCampo = "K" + nCampo;  |HAZ LeeCasilla;  aCampoK = aCampo;

          nCasilla = nCasilla + 1;  aValor = aCampoA;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoB;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoD;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoE;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoF;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoK;  |HAZ GrabaDos;

          nCampo = nCampo + 2;
     |SIGUE;

     |REPON_DATOS #1;
|FPRC;

|PROCESO FondosPropios;
     |SALVA_DATOS #1;

     nEstoy = 0;
     nCampo = nCampo + 4;
     aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
     |SI aCampoA = "";  |ACABA;  |FINSI;

     #1#0 = "RENTA008";
     #1#1 = nRegistro;
     |GRABA 020#1n;
     |LIBERA #1;

     aFichero = "renta008";
     nCasilla = 0;

     |PARA;  |SI;  |HACIENDO;
          aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
          |SI aCampoA = "";  |SAL;  |FINSI;

          aAlfa = aCampoA % 101;
          |SI aAlfa < "0";  |O aAlfa > "9";  |SAL;  |FINSI;

          aCampo = "B" + nCampo;  |HAZ LeeCasilla;  aCampoB = aCampo;
          aCampo = "D" + nCampo;  |HAZ LeeCasilla;  aCampoD = aCampo;
          aCampo = "E" + nCampo;  |HAZ LeeCasilla;  aCampoE = aCampo;
          aCampo = "F" + nCampo;  |HAZ LeeCasilla;  aCampoF = aCampo;

          nCasilla = nCasilla + 1;  aValor = aCampoA;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoB;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoD;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoE;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoF;  |HAZ GrabaDos;

          nCampo = nCampo + 3;
     |SIGUE;

     |REPON_DATOS #1;
|FPRC;

|PROCESO ValoresMobiliarios;
     |SALVA_DATOS #1;

     nEstoy = 0;
     nCampo = nCampo + 4;
     aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
     |SI aCampoA = "";  |ACABA;  |FINSI;

     #1#0 = "RENTA009";
     #1#1 = nRegistro;
     |GRABA 020#1n;
     |LIBERA #1;

     aFichero = "renta009";
     nCasilla = 0;

     |PARA;  |SI;  |HACIENDO;
          aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
          |SI aCampoA = "";  |SAL;  |FINSI;

          aAlfa = aCampoA % 101;
          |SI aAlfa < "0";  |O aAlfa > "9";  |SAL;  |FINSI;

          aCampo = "B" + nCampo;  |HAZ LeeCasilla;  aCampoB = aCampo;
          aCampo = "D" + nCampo;  |HAZ LeeCasilla;  aCampoD = aCampo;
          aCampo = "T" + nCampo;  |HAZ LeeCasilla;  aCampoT = aCampo;

          nCasilla = nCasilla + 1;  aValor = aCampoA;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoB;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoD;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoT;  |HAZ GrabaDos;

          nCampo = nCampo + 3;
     |SIGUE;

     |REPON_DATOS #1;
|FPRC;

|PROCESO Patrimonio;
     |SALVA_DATOS #1;

     nEstoy = 0;
     nCampo = nCampo + 4;
     aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
     |SI aCampoA = "";  |ACABA;  |FINSI;

     #1#0 = "RENTA010";
     #1#1 = nRegistro;
     |GRABA 020#1n;
     |LIBERA #1;

     aFichero = "renta010";
     nCasilla = 0;

     |PARA;  |SI;  |HACIENDO;
          aCampo = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
          |SI aCampoA = "";  |SAL;  |FINSI;

          aAlfa = aCampoA % 101;
          |SI aAlfa < "0";  |O aAlfa > "9";  |SAL;  |FINSI;

          aCampo = "B" + nCampo;  |HAZ LeeCasilla;  aCampoB = aCampo;
          aCampo = "D" + nCampo;  |HAZ LeeCasilla;  aCampoD = aCampo;
          aCampo = "F" + nCampo;  |HAZ LeeCasilla;  aCampoF = aCampo;
          aCampo = "J" + nCampo;  |HAZ LeeCasilla;  aCampoJ = aCampo;

          nCasilla = nCasilla + 1;  aValor = aCampoA;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoB;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoD;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoF;  |HAZ GrabaDos;
          nCasilla = nCasilla + 1;  aValor = aCampoJ;  |HAZ GrabaDos;

          nCampo = nCampo + 2;
     |SIGUE;

     |REPON_DATOS #1;
|FPRC;

|PROCESO TrataFichero;
     |SI nEstoy = 1;  |HAZ DatosPersonales;     |FINSI;
     |SI nEstoy = 2;  |HAZ Trabajo;             |FINSI;
     |SI nEstoy = 3;  |HAZ CtasCtes;            |FINSI;
     |SI nEstoy = 4;  |HAZ InmobiliarioGnral;   |FINSI;
     |SI nEstoy = 5;  |HAZ InmobiliarioOtros;   |FINSI;
     |SI nEstoy = 6;  |HAZ FondosPropios;       |FINSI;
     |SI nEstoy = 7;  |HAZ ValoresMobiliarios;  |FINSI;
     |SI nEstoy = 8;  |HAZ Patrimonio;          |FINSI;
|FPRC;

|PROCESO LeeHoja;
     aHoja       = #0#1;  |QBF aHoja;
     aNombreHoja = "renta" + (("00" + nExcel) % -102) + ".xls";
     aHoja       = aHoja + aNombreHoja;

     |ALFACALLDLL "agixl97.dll", "carga_book", aHoja;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Hoja";

     nCampo       = 1;
     aNombre      = "";
     nContaBlanco = 0;
     |PARA; |SI; |HACIENDO;
           aCampo  = "A" + nCampo;  |HAZ LeeCasilla;  aCampoA = aCampo;
           |SI aCampoA = "";
               nContaBlanco = nContaBlanco + 1;
               nCampo       = nCampo + 1;
           |SINO;
               |SI nEstoy ! 0;  |HAZ TrataFichero;  |FINSI;

               nContaBlanco = 0;
               nEstoy       = 0;

               |SI aCampoA = "Datos personales ( Declarante )";
                   nRegistro = nRegistro + 1;
                   nCampo    = nCampo + 4;
                   nEstoy    = 1;
               |FINSI;

               |SI aCampoA = "Trabajo";
                   nEstoy = 2;
               |FINSI;

               |SI aCampoA = "Cuentas corrientes";
                   nEstoy = 3;
               |FINSI;

               |SI aCampoA = "Capital inmobiliario (Datos generales)";
                   nEstoy = 4;
               |FINSI;

               |SI aCampoA = "Capital inmobiliario (Otros datos)";
                   nEstoy = 5;
               |FINSI;

               |SI aCampoA = "Fondos Propios";
                   nEstoy = 6;
               |FINSI;

               |SI aCampoA = "Valores mobiliarios";
                   nEstoy = 7;
               |FINSI;

               |SI aCampoA = "Patrimonio";
                   nEstoy = 8;
               |FINSI;

               |SI nEstoy = 0;
                   nCampo  = nCampo + 1;
               |FINSI;
           |FINSI;

           #0#3  = "Registro: " + (("00000" + nRegistro) % -105) + "  Nombre Contribuyente: " + aNombre;
           |PINTA #0#3;

           |SI nContaBlanco > 10;  |SAL;  |FINSI;
     |SIGUE;

     |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
|FPRC;

|PROCESO trasm001;
     |BORRA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE trasm001;
     #1#1;
     ;
     "RENTA001            ",          1;
     "RENTA999            ", 9999999999;
     be;
     NULL, trasm001;
|FIN;

|PROCESO BorraFichero;
     aAlfa = aFichero + ".dat";  |FBORRA aAlfa;
     aAlfa = aFichero + ".ddx";  |FBORRA aAlfa;
     aAlfa = aFichero + ".ixx";  |FBORRA aAlfa;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
     |SI #0#2 ! "SI";  |ACABA;  |FINSI;

     aAlfa = #0#1;  |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     |CARGADLL "agixl97.dll";
     |SI FSalida < 0;
         |MENAV "0000No se puede usar agixl97.dll";
         |ACABA;
     |FINSI;

     |DFICE aFich;  |QBF aFich;
     aFichero   = aFich + "renta001";  |HAZ BorraFichero;
     aFichero   = aFich + "renta002";  |HAZ BorraFichero;
     aFichero   = aFich + "renta003";  |HAZ BorraFichero;
     aFichero   = aFich + "renta004";  |HAZ BorraFichero;
     aFichero   = aFich + "renta005";  |HAZ BorraFichero;
     aFichero   = aFich + "renta006";  |HAZ BorraFichero;
     aFichero   = aFich + "renta007";  |HAZ BorraFichero;
     aFichero   = aFich + "renta008";  |HAZ BorraFichero;
     aFichero   = aFich + "renta009";  |HAZ BorraFichero;
     aFichero   = aFich + "renta010";  |HAZ BorraFichero;

     |ABRE #4;  |CIERRA #4;  |DELINDEX #4;

     |BUCLE trasm001;

     |ABRE #1;
     |ABRE #4;
     |PARA nExcel = 1;  |SI nExcel [ #0#0;  |HACIENDO nExcel = nExcel + 1;
         |HAZ LeeHoja;
     |SIGUE;
     |CIERRA #1;
     |CIERRA #4;

     |DESCARGADLL "agixl97.dll";
|FPRC;
