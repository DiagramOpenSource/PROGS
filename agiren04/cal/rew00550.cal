|FICHEROS;
     rem00021 #20;
     rew00550 #550;
|FIN;

|VARIABLES;
     nCampo3    = 0;
     nCampo4    = 0;
     nCampo5    = 0;
     nCampo6    = 0;
     nCampo7    = 0;
     nCampo8    = 0;
     nCampo9    = 0;
     nCampo10   = 0;
     nCampo11   = 0;
     nCampo12   = 0;
     nCampo13   = 0;
     nCampo23   = 0;
     nImputa    = 0;
     nDiasAlq   = 0;
     nDiasUso   = 0;
     nSwHay     = 0;
     nCatastral = 0;
     nValor     = 0;
     nPorce     = 0;
     nRdto3     = 0;
     nRdto4     = 0;
     nRdto5     = 0;
     nRdto7     = 0;
     nRdto9     = 0;
     nRdto10    = 0;
     nRdto11    = 0;
     nRdto12    = 0;
     nRdto13    = 0;
     nRdto18    = 0;
     nRdto19    = 0;
     nRdto22    = 0;
     nRdto23    = 0;
     nTotal1    = 0;
     nTotal2    = 0;
     nTotal3    = 0;

     aFichero   = "";

     &enEmpresa = 0;
|FIN;

|PROCESO GrabaTempo;
     |SI #20#3 = "P";  |ACABA;  |FINSI;

     nCampo3  = 0;
     nCampo4  = 0;
     nCampo5  = 0;
     nCampo6  = 0;
     nCampo7  = 0;
     nCampo8  = 0;
     nCampo9  = 0;
     nCampo10 = 0;
     nCampo11 = 0;
     nCampo12 = 0;
     nCampo13 = 0;
     nImputa  = 0;

     nDiasAlq = #20#31 + #20#34;
     nDiasUso = #20#32 + #20#35;

     |SI #20#37 = "A";
         nCampo3  = #20#38 * (nDiasAlq / 366);
     |SINO;
         nCampo3  = #20#38;
     |FINSI;

     |SI #20#39 = "A";
         nCampo4  = #20#40 * (nDiasAlq / 366);
     |SINO;
         nCampo4  = #20#40;
     |FINSI;

     |SI #20#41 = "A";
         nCampo4  = nCampo4  + (#20#42 * (nDiasAlq / 366));
     |SINO;
         nCampo4  = nCampo4  + #20#42;
     |FINSI;

     |SI #20#43 = "A";
         nCampo3 = nCampo3 + (#20#44 * (nDiasAlq / 366));
     |SINO;
         nCampo3  = nCampo3  + #20#44;
     |FINSI;

     nCampo5  = nCampo3 + nCampo4;

     |SI nDiasAlq ! 0;
         |SI #20#48 = "A";
             nCampo9  = #20#22 * (nDiasAlq / 366);
         |SINO;
             nCampo9  = #20#22;
         |FINSI;
     |FINSI;

     nCampo7  = #20#60;

     |SI #20#54 = "A";
         nCampo9  = nCampo9  + (#20#55 * (nDiasAlq / 366));
     |SINO;
         nCampo9  = nCampo9  + #20#55;
     |FINSI;

     |SI nDiasAlq ! 0;
         |SI #20#49 = "A";
             nCampo9  = nCampo9  + (#20#21 * (nDiasAlq / 366));
         |SINO;
             nCampo9  = nCampo9  + #20#21;
         |FINSI;
     |FINSI;

     |SI #20#50 = "A";
         nCampo9  = nCampo9  + (#20#51 * (nDiasAlq / 366));
     |SINO;
         nCampo9  = nCampo9  + #20#51;
     |FINSI;

     |SI #20#52 = "A";
         nCampo9  = nCampo9  + (#20#53 * (nDiasAlq / 366));
     |SINO;
         nCampo9  = nCampo9  + #20#53;
     |FINSI;

     |SI #20#56 = "A";
         nCampo9  = nCampo9  + (#20#57 * (nDiasAlq / 366));
     |SINO;
         nCampo9  = nCampo9  + #20#57;
     |FINSI;

     nCampo10   = (nCampo7 + nCampo9);
     nCampo11   = (nCampo5 - nCampo10);
     nCatastral = 0;
     nCampo23   = 0;

     |SI #20#36 = "S";
         nValor = nCampo3 - (nCampo7 + nCampo9);

         nPorce = 2;
         |SI #20#17 = "S";  nPorce = 1.1;  |FINSI;

         |SI #20#15 > 0;
             nCatastral = (#20#15 % nPorce) * (nDiasAlq / 366);
         |SINO;
             nCatastral = #20#27;
             |SI nCatastral < #20#26;  nCatastral = #20#26;  |FINSI;
             nCatastral = ((nCatastral % 50) % 1.1) * (nDiasAlq / 366);
         |FINSI;

         |SI nCatastral > nValor;
             nCampo3   = 0;
             nCampo4   = 0;
             nCampo5   = 0;
             nCampo7   = 0;
             nCampo9   = 0;
             nCampo10  = 0;
             nCampo11  = 0;
             nCampo23  = nCatastral;
         |FINSI;
     |FINSI;

     |SI #20#43 = "A";
         nCampo12 = (#20#44 * 0.4) * (nDiasAlq / 366);
     |SINO;
         nCampo12 = #20#44 * 0.4;
     |FINSI;

     nRdto3  = nRdto3  + nCampo3;
     nRdto4  = nRdto4  + nCampo4;
     nRdto5  = nRdto5  + nCampo5;
     nRdto7  = nRdto7  + nCampo7;
     nRdto9  = nRdto9  + nCampo9;
     nRdto10 = nRdto10 + nCampo10;
     nRdto11 = nRdto11 + nCampo11;

     |SI #20#36 = "S";
         nRdto23 = (N\ nRdto23 + nCampo23);
     |FINSI;

     |SI nCampo23 = 0;
         nRdto19  = (N\ nRdto19 + nCampo12);
         |SI #20#18 = "U";
             nRdto22  = (N\ nRdto22 + (nCampo11 - nCampo12));
         |FINSI;
     |FINSI;

     |SI nDiasUso ! 0;  |O nDiasAlq ! 0;
         |SI #20#104 ! "N";
             |SI #20#18 = "U";  |O #20#18 = "L";  |O #20#18 = "O";
                 |SI #20#15 ! 0;
                     |SI #20#17 = "S";
                         nImputa = (#20#15 % 1.1) * (nDiasUso / 366);
                     |SINO;
                         nImputa = (#20#15 % 2) * (nDiasUso / 366);
                     |FINSI;
                 |SINO;
                     nValor     = #20#26;
                     |SI nValor < #20#27;  nValor = #20#27;  |FINSI;

                     nImputa  = ((nValor % 50) % 1.1) * (nDiasUso / 366);
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     nSwHay = 1;

     #550#0 = #20#1;
     #550#1 = #20#2;
     #550#2 = #20#13;
     #550#3 = nCampo11;
     #550#4 = nImputa;
     |GRABA 020#550n;
     |LIBERA #550;

     nTotal1 = nTotal1 + #550#3;
     nTotal2 = nTotal2 + #550#4;
|FPRC;

|DEFBUCLE rem00021;
     #20#1;
     ;
     enEmpresa, 01;
     enEmpresa, 99;
     ;
     NULL, GrabaTempo;
|FIN;

|RUTINA ClaveBaja550;
     #550#0 = 1;
|FRUT;

|RUTINA ClaveAlta550;
     #550#0 = 99;
|FRUT;

|PROCESO Rendimientos;
     aFichero = Usuario;  |QBT aFichero;
     aFichero = (aFichero + "zzzzzzzz") % -108;
     |NOME_DAT #550 aFichero;
     |ABRE #550;  |CIERRA #550;  |DELINDEX #550;

     |SALVA_DATOS #20;

     nSwHay  = 0;
     nTotal1 = 0;
     nTotal2 = 0;
     nRdto3  = 0;
     nRdto4  = 0;
     nRdto5  = 0;
     nRdto7  = 0;
     nRdto9  = 0;
     nRdto10 = 0;
     nRdto11 = 0;
     nRdto12 = 0;
     nRdto13 = 0;
     nRdto18 = 0;
     nRdto19 = 0;
     nRdto22 = 0;
     nRdto23 = 0;

     |ABRE #550;
     |BUCLE rem00021;
     |CIERRA #550;

     |SI nSwHay = 1;
         |SI nRdto11 < 0;  nRdto11 = 0;  |FINSI;
         |SI nRdto19 < 0;  nRdto19 = 0;  |FINSI;
         |SI nRdto22 < 0;  nRdto22 = 0;  |FINSI;

         nRdto12 = (N\ nRdto22 % 50);
         nRdto18 = nRdto19;

         |SI nRdto12 < 0;  nRdto12 = 0;  |FINSI;
         |SI nRdto18 < 0;  nRdto18 = 0;  |FINSI;

         nRdto13 = (N\ nRdto11 - nRdto12 - nRdto18 + nRdto23);

         |PINPA #0#550;

         #20#21 = nTotal1;
         #20#22 = nTotal2;
         #20#23 = nRdto13;

         |ATRI R;
         |PINTA 2156, #20#21;
         |PINTA 2170, #20#22;
         |PINTA 2256, #20#23;
         |ATRI r;

         |ENTLINEAL #1#550, -1, 4, 19, 0, ClaveBaja550, ClaveAlta550;
     |FINSI;

     |DELINDEX #550;
     |REPON_DATOS #20;

     |PTEC 802;
     |PTEC 807;
|FPRC;
