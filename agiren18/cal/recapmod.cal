|FICHEROS;
   recapmod #0;
   rem00027 #8;
   rem00058 #58;

   eosactiv@ #3;
   eosclien@ #4;
   eosm0017@ #9;
   eosm0018@ #10;
   eoscomul@ #11;

   eosm0011@ #13;
   eosm0012@ #14;
   eosm3130@ #15;
   eosm0020@ #16;
   agicontr@ #17;

   rem00031 #18;
   reeleact #19;

   retabla4;

   :/agitool/def/zmonedas #999;
|FIN;

|VARIABLES;
   TotImporte = 0;
   UniImporte = 0;
   Uni        = 0;
   Unidades   = 0;
   Elem       = 0;
   Calc       = 0;
   Calc2      = 0;
   Cont       = 0;
   Cont1      = 0;

   Path       = "";
   Comodin    = "";
   Comodin1   = "";
   Linea      = 0;
   Linea1     = 0;
   nImporte   = 0;
   FEstado    = 0;
   nLinea     = 0;

   aAlfa         = "";

   nCampo        = 0;
   nCampo1       = 0;
   nCampo2       = 0;
   nTecla        = 0;
   nActi         = 0;
   nAnyoRenta    = 0;

   nCampoRdto    = 0;
   nPorce        = 0;
   nPorceL1      = 0;
   nPorceL2      = 0;
   nPorce1       = 0;
   nPorce2       = 0;
   nDifer        = 0;
   nResto        = 0;
   nSwAsala2     = 0;
   nDife         = 0;
   nCanti        = 0;
   EsArrend      = 0;
   nActivid      = 0;
   ModulAct      = "";
   Comun         = 0;
   Salir         = 0;
   Comunidad     = 0;
   nPatrones     = 0;
   aNif          = "";
   aNombreEnt    = "";
   aAlfa1        = "";
   aAlfa2        = "";
   nOpera        = 0;
   aTipo         = "";

   &eaPrograma = "";
   &eaPunto    = "";
   &enEmpresa   = 0;
   &enEmprEos  = 0;
   &enActiEos  = 0;
   &enEmprRen  = 0;
   &eaCaracter = "";
   &eaTitCony  = "";
|FIN;

|PROCESO Comunidad;
   #eosactiv@#0 = #recapmod#0;
   #eosactiv@#1 = #recapmod#1;
   #eosactiv@#2 = nAnyoRenta;
   |LEE 010#eosactiv@.=;
   |SI FSalida = 0;
      |SI #eosactiv@#46 = "S";
         |C_M #recapmod#5,1,"S";
         |C_M #recapmod#6,1,"S";
      |SINO;
         |C_M #recapmod#5,1,"N";
         |C_M #recapmod#6,1,"N";
      |FINSI;
   |SINO;
      |C_M #recapmod#5,1,"N";
      |C_M #recapmod#6,1,"N";
   |FINSI;
|FPRC;

|PROCESO Prorrata;
   |SI Elem = 1; Unidades = 15; |FINSI;    || Campo Unidades
   |SI Elem = 2; Unidades = 26; |FINSI;
   |SI Elem = 3; Unidades = 37; |FINSI;
   |SI Elem = 4; Unidades = 48; |FINSI;
   |SI Elem = 5; Unidades = 59; |FINSI;
   |SI Elem = 6; Unidades = 70; |FINSI;
   |SI Elem = 7; Unidades = 81; |FINSI;
   UniImporte = Unidades - 3;              || Campo Importe unitario
   TotImporte = Unidades + 1;              || Campo Importe

   Calc = (#eosm0017@#Unidades# * #eosm0017@#UniImporte#) ! 2;
   |SI Calc ! #eosm0017@#TotImporte#;
      Uni = (#eosm0017@#TotImporte# / #eosm0017@#UniImporte#) ! 2;
   |SINO;
      Uni = #eosm0017@#Unidades#;
   |FINSI;
|FPRC;

|PROCESO rem00031;
     |BORRA 020#18a;
     |LIBERA #18;
|FPRC;

|DEFBUCLE rem00031;
     #18#2;
     2;
     #recapmod#2, 1, aTipo;
     #recapmod#2, 9, aTipo;
     be;
     NULL, rem00031;
|FIN;

|PROCESO PagosACuenta;
   || Se elimina el registro de renta que apunta a la actividad

   |SI #recapmod#3 = "T";
       aTipo = "TITULAR   ";
   |SINO;
       aTipo = "CONYUGE   ";
   |FINSI;

   |BUCLE rem00031;

   |SELECT #1#rem00031;
   Linea1 = 1;
   |PARA; |SI; |HACIENDO;
          #rem00031#0  = #recapmod#2;
          #rem00031#1  = Linea1;
          |LEE 000#18=;
          |SI FSalida ! 0;  |SAL;  |FINSI;
          Linea1 = Linea1 + 1;
   |SIGUE;

   || Se crea de nuevo el registro en vacio

   |DDEFECTO #rem00031;
   #rem00031#0  = #recapmod#2;
   #rem00031#1  = Linea1;
   |SI #eosactiv@#22 ! "A";
      |SI #eosactiv@#42 = "N";
         #rem00031#16 = 9;
      |SINO;
         |SI #eosactiv@#46 ! "S";
            #rem00031#16 = #eosactiv@#1;
         |SINO;
            #rem00031#16 = #eosactiv@#6;
         |FINSI;
      |FINSI;
   |SINO;
      #rem00031#16 = 0;
   |FINSI;
   |SI #recapmod#3 = "T";
       #rem00031#2 = "TITULAR";
   |SINO;
       #rem00031#2 = "CONYUGE";
   |FINSI;

   || Se leen los 4 periodos del modelo

   |PARA Cont = 1; |SI Cont [ 4; |HACIENDO Cont = Cont + 1;
      |SI #eosactiv@#22 ! "A";
         || El modelo 130 en caso de que la actividad no sea de modulos
         |SI #eosactiv@#42 = "N";
            |SI #eosactiv@#46 ! "S";
               #eosm3130@#0 = #recapmod#0;
            |SINO;
               #eosm3130@#0 = #recapmod#5;
            |FINSI;
            #eosm3130@#1 = 9;
         |SINO;
            |SI #eosactiv@#46 ! "S";
               #eosm3130@#0 = #recapmod#0;
               #eosm3130@#1 = #recapmod#1;
            |SINO;
               #eosm3130@#0 = #recapmod#5;
               #eosm3130@#1 = #recapmod#6;
            |FINSI;
         |FINSI;
         #eosm3130@#2 = Cont;
         #eosm3130@#3 = nAnyoRenta;
         |LEE 010#eosm3130@.=;
         |SI FSalida = 0;
            |SI #eosm3130@#4 ! "          ";
               Calc = Cont + 10;

               |SI #eosm3130@#46 > 0;
                   #rem00031#Calc# = #rem00031#Calc# + #eosm3130@#46;
               |FINSI;

               #rem00031#15 = #rem00031#15 + (#eosm3130@#23 + #eosm3130@#36);
            |FINSI;
         |FINSI;
      |SINO;
         || El modelo 131 en caso de que la actividad sea de modulos
         |SI Comunidad = 1;
            #eosm0020@#0 = #recapmod#5;
         |SINO;
            #eosm0020@#0 = #recapmod#0;
         |FINSI;
         #eosm0020@#1 = nAnyoRenta;
         #eosm0020@#2 = Cont;
         |LEE 010#eosm0020@.=;
         |SI FSalida = 0; |Y #eosm0020@#4 ! "01.01.0000";
            Calc = Cont + 10;
            |SI #eosm0020@#47 > 0;
                #rem00031#Calc# = #rem00031#Calc# + #eosm0020@#47;
            |FINSI;
            #rem00031#15    = #rem00031#15    + #eosm0020@#54;
         |FINSI;
      |FINSI;
   |SIGUE;

   |SI #rem00031#11 ! 0; |O #rem00031#12 ! 0; |O #rem00031#13 ! 0;
    |O #rem00031#14 ! 0; |O #rem00031#15 ! 0;
       #rem00031#17 = #eosactiv@#14;

       |GRABA 020#rem00031.n;

       |LEE 010#rem00031.=;
   |FINSI;

   enEmpresa    = #recapmod#2;
   eaPrograma   = "rem00031";
   eaPunto      = "  ";
   |HAZ ProgramaActivo;

   |LIBERA #rem00031;
|FPRC;

|PROCESO Graba58E3;
     |ABRE #58;
     |SELECT #1#58;
     #58#0 = #8#0;
     #58#1 = 99;
     |LEE 040#58];
     |SI FSalida = 0;
         |LEE 040#58a;
     |SINO;
         |LEE 040#58u;
     |FINSI;
     nLinea = 1;

     |SI FSalida = 0;  |Y #58#0 = #8#0;
         nLinea = #58#1 + 1;
     |FINSI;

     |DDEFECTO #58;
     #58#0  = #8#0;
     #58#1  = nLinea;
     #58#2  = #8#2;
     #58#3  = "R";
     #58#4  = #8#4;
     #58#5  = #8#5;
     #58#6  = #8#6;
     #58#7  = #8#7;
     #58#8  = #8#8;
     #58#9  = #8#9;
     #58#10 = #8#10;
     #58#11 = #8#15;
     #58#12 = #8#19;
     #58#13 = 3;
     #58#14 = "E3";
     #58#15 = #8#1;
     #58#27 = #8#114 % #58#11;
     #58#29 = #8#116 % #58#11;
     #58#30 = #58#27 - #58#28 - #58#29;
     |GRABA 020#58n;
     |LIBERA #58;
     |CIERRA #58;

     eaPrograma   = "rem00058";
     eaPunto      = #rem00058#13;
     |HAZ ProgramaActivo;
|FPRC;

|PROCESO Modulos;
      |SI ModulAct = "A";
         #rem00027#0 = #recapmod#2;
         #rem00027#1 = 1;
         |LEE 010#rem00027.];
         |SI FSalida = 0; |Y #rem00027#0 = #recapmod#2;
            |PARA; |SI FSalida = 0; |Y #rem00027#0 = #recapmod#2; |HACIENDO;
               Linea = #rem00027#1 + 1;
               |LEE 010#rem00027.s;
            |SIGUE;
         |SINO;
            Linea = 1;
         |FINSI;
         |DDEFECTO #rem00027;
         #rem00027#0  = #recapmod#2;
         #rem00027#1  = Linea;
         |SI #recapmod#3 = "T";
            #rem00027#2 = "TITULAR";
         |SINO;
            #rem00027#2 = "CONYUGE";
         |FINSI;
         #rem00027#14  = #eosactiv@#14; || Actividad comunera S/N
         |SI #rem00027#14 = "S";
            #rem00027#15 = #eoscomul@#6;
         |FINSI;
         #rem00027#16  = #eosactiv@#4;  || Letra epigrafe
         #rem00027#17  = #eosactiv@#5;  || Codigo Epigrafe
         #rem00027#18  = #eosm0017@#4;  || Tipo Epigrafe
         #rem00027#19  = aNif;          || Nif Entidad
         #rem00027#126 = aNombreEnt;    || Nombre Entidad
         #rem00027#20  = #eosactiv@#6;  || Descripcion de la actividad
         #rem00027#21  = #eosactiv@#11; || Codigo Postal 1
         #rem00027#22  = #eosactiv@#12; || Codigo Postal 2
         #rem00027#23  = #eosactiv@#9;  || Domicilio

         |ABRE #reeleact;
         #reeleact#0 = #rem00027#16;
         #reeleact#1 = #rem00027#17;
         #reeleact#2 = #rem00027#18;
         |LEE 040#reeleact.=;
         |SI FSalida ! 0;  |DDEFECTO #reeleact;  |FINSI;
         |CIERRA #reeleact;

         #rem00027#24  = #eosm0017@#11; || Definicion elemento 1
         #rem00027#25  = #eosm0017@#22; || Definicion elemento 2
         #rem00027#26  = #eosm0017@#33; || Definicion elemento 3
         #rem00027#27  = #eosm0017@#44; || Definicion elemento 4
         #rem00027#28  = #eosm0017@#55; || Definicion elemento 5
         #rem00027#29  = #eosm0017@#66; || Definicion elemento 6
         #rem00027#30  = #eosm0017@#77; || Definicion elemento 7

         Elem = 1; |HAZ Prorrata; #rem00027#31 = Uni; || Unidades elemento 1
         Elem = 2; |HAZ Prorrata; #rem00027#32 = Uni; || Unidades elemento 2
         Elem = 3; |HAZ Prorrata; #rem00027#33 = Uni; || Unidades elemento 3
         Elem = 4; |HAZ Prorrata; #rem00027#34 = Uni; || Unidades elemento 4
         Elem = 5; |HAZ Prorrata; #rem00027#35 = Uni; || Unidades elemento 5
         Elem = 6; |HAZ Prorrata; #rem00027#36 = Uni; || Unidades elemento 6
         Elem = 7; |HAZ Prorrata; #rem00027#37 = Uni; || Unidades elemento 7

         #rem00027#38  = #reeleact#6;   || Importe modulo 1
         #rem00027#39  = #reeleact#9;   || Importe modulo 2
         #rem00027#40  = #reeleact#12;  || Importe modulo 3
         #rem00027#41  = #reeleact#15;  || Importe modulo 4
         #rem00027#42  = #reeleact#18;  || Importe modulo 5
         #rem00027#43  = #reeleact#21;  || Importe modulo 6
         #rem00027#44  = #reeleact#24;  || Importe modulo 7

         #rem00027#45  = #eosm0017@#16;   || Rendimiento modulo 1
         #rem00027#46  = #eosm0017@#27;   || Rendimiento modulo 2
         #rem00027#47  = #eosm0017@#38;   || Rendimiento modulo 3
         #rem00027#48  = #eosm0017@#49;   || Rendimiento modulo 4
         #rem00027#49  = #eosm0017@#60;   || Rendimiento modulo 5
         #rem00027#50  = #eosm0017@#71;   || Rendimiento modulo 6
         #rem00027#51  = #eosm0017@#82;   || Rendimiento modulo 7

         #rem00027#52 = 0;
         |PARA nCampo = 45;  |SI nCampo [ 51;  |HACIENDO nCampo = nCampo + 1;
               nCampo1   = nCampo - 14;
               nCampo2   = nCampo - 7;
               #rem00027#nCampo# = #rem00027#nCampo1# * #rem00027#nCampo2#;
               #rem00027#52     = #rem00027#52 + #rem00027#nCampo#;
         |SIGUE;

         #rem00027#53  = #eosm0018@#3;    || Incremento o porcentaje
         #rem00027#54  = #eosm0018@#4;    || N§ Asalariados anterior 1
         #rem00027#55  = #eosm0018@#6;    || N§ Asalariados actual 1

         #rem00027#57  = #eosm0018@#9;    || Pesetas asalariado 1
         #rem00027#58  = #eosm0018@#90;   || Total incentivo 1
         #rem00027#59  = #eosm0018@#83;   || N§ Asalariados anterior 2
         #rem00027#60  = #eosm0018@#85;   || N§ Asalariados actual 2

         #rem00027#62  = #eosm0018@#88;   || Pesetas asalariado 2
         #rem00027#63  = #eosm0018@#92;   || Total incentivo 2
         #rem00027#64  = #eosm0018@#11;   || Casilla 504
         #rem00027#65  = #eosm0018@#26;   || Elemento Nuevo
         #rem00027#66  = #eosm0018@#27;   || Importe T1
         #rem00027#67  = #eosm0018@#28;   || Coeficiente T1
         #rem00027#68  = #eosm0018@#29;   || Amortizacion T1
         #rem00027#69  = #eosm0018@#30;   || Importe T2
         #rem00027#70  = #eosm0018@#31;   || Coeficiente T2
         #rem00027#71  = #eosm0018@#32;   || Amortizacion T2
         #rem00027#72  = #eosm0018@#33;   || Importe T3
         #rem00027#73  = #eosm0018@#34;   || Coeficiente T3
         #rem00027#74  = #eosm0018@#35;   || Amortizacion T3
         #rem00027#75  = #eosm0018@#36;   || Importe T4
         #rem00027#76  = #eosm0018@#37;   || Coeficiente T4
         #rem00027#77  = #eosm0018@#38;   || Amortizacion T4
         #rem00027#78  = #eosm0018@#39;   || Casilla 505
         #rem00027#79  = #eosm0018@#41;   || Casilla 506
         #rem00027#80  = #eosm0018@#44;   || Coeficiente Quiosco
         #rem00027#81  = #eosm0018@#45;   || Importe Quiosco
         #rem00027#82  = #eosm0018@#48;   || Coeficiente Taxis
         #rem00027#83  = #eosm0018@#49;   || Importe Taxis
         #rem00027#84  = #eosm0018@#52;   || Coeficiente Urbanos
         #rem00027#85  = #eosm0018@#53;   || Importe Urbanos
         #rem00027#86  = #eosm0018@#56;   || Coeficiente Mercancia
         #rem00027#87  = #eosm0018@#57;   || Importe Mercancia
         #rem00027#88  = #eosm0018@#60;   || Coeficiente peque¤a dimension
         #rem00027#89  = #eosm0018@#61;   || Importe peque¤a dimension
         #rem00027#90  = #eosm0018@#65;   || Dias temporada
         #rem00027#91  = #eosm0018@#66;   || Coeficiente temporada
         #rem00027#92  = #eosm0018@#67;   || Importe Temporada

         #rem00027#94  = #eosm0018@#72;   || Importe exceso

         #rem00027#96  = #eosm0018@#75;   || Coeficiente nueva actividad
         #rem00027#97  = #eosm0018@#76;   || Importe nueva actividad
         #rem00027#98  = #eosm0018@#82;   || Casilla 512

         #rem00027#109 = #eosm0018@#134;  || Gastos extraordinarios
         #rem00027#113 = #eosm0018@#135;  || Otras reducciones empresariales
         #rem00027#115 = #eosm0018@#136;  || Irregulares
         #rem00027#119 = "N";
         #rem00027#120 = 0;
         #rem00027#121 = 0;
         #rem00027#122 = #eosm0018@#126;
         #rem00027#125 = #eosm0018@#146;

         |SI #eosm0018@#139 = "S";
             #rem00027#119 = "F";
             #rem00027#121 = #eosm0018@#140;
         |FINSI;

         |HAZ Recalcula;

         #rem00027#127 = #eosactiv@#1;

         |GRABA 020#rem00027.n;
         |LIBERA #rem00027;

         enEmpresa    = #recapmod#2;
         eaPrograma   = "rem00027";
         eaPunto      = "  ";
         |HAZ ProgramaActivo;

         |SI #rem00027#14 = "S";  |HAZ Graba58E3;  |FINSI;
      |FINSI;
|FPRC;

|PROCESO Incentivo;
     nPorce1 = 0;
     |SI #rem00027#122 = "S";
         |SI nDifer > 0;
             nPorce1 = nDifer * .40;
         |FINSI;
     |FINSI;

     nPorce2 = 0;
     |SI #rem00027#53 = "I";
         |SI nResto > 8;
             nPorce  = nResto - 8;
             nPorce2 = nPorce2 + (nPorce * 0.30);
             nResto  = 8;
         |FINSI;

         |SI nResto > 5;
             nPorce  = nResto - 5;
             nPorce2 = nPorce2 + (nPorce * 0.25);
             nResto  = 5;
         |FINSI;

         |SI nResto > 3;
             nPorce  = nResto - 3;
             nPorce2 = nPorce2 + (nPorce * 0.20);
             nResto  = 3;
         |FINSI;

         |SI nResto > 1;
             nPorce  = nResto - 1;
             nPorce2 = nPorce2 + (nPorce * 0.15);
             nResto  = 1;
         |FINSI;

         |SI nResto > 0;
             nPorce2 = nPorce2 + (nResto * 0.10);
         |FINSI;
     |FINSI;

     |SI #rem00027#53 = "P";
         |SI nResto > 0;    |Y nResto [ 1;  nPorce2 = 0.10;  |FINSI;
         |SI nResto ] 1.01; |Y nResto [ 3;  nPorce2 = 0.15;  |FINSI;
         |SI nResto ] 3.01; |Y nResto [ 5;  nPorce2 = 0.20;  |FINSI;
         |SI nResto ] 5.01; |Y nResto [ 8;  nPorce2 = 0.25;  |FINSI;
         |SI nResto > 8;                    nPorce2 = 0.30;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Recalcula;
     nTecla = FSalida;

     #rem00027#52 = 0;
     |PARA nCampo = 45;  |SI nCampo [ 51;  |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo - 14;
           nCampo2 = nCampo - 7;
           #rem00027#nCampo# = #rem00027#nCampo1# * #rem00027#nCampo2#;
           #rem00027#52 = #rem00027#52 + #rem00027#nCampo#;
     |SIGUE;

     nSwAsala2 = 0;
     aAlfa     = #reeleact#1 % 103;
     |SI aAlfa = "644";  nSwAsala2 = 1;  |FINSI;

     #rem00027#55 = #rem00027#31;
     #rem00027#57 = #rem00027#38;
     #rem00027#60 = 0;
     #rem00027#62 = 0;
     |SI nSwAsala2 = 1;  #rem00027#60 = #rem00027#32;  #rem00027#62 = #rem00027#39;  |FINSI;

     || Minoracion de Empleo

     nResto   = #rem00027#54 + #rem00027#59;
     #rem00027#56 = 0;
     #rem00027#61 = 0;
     #rem00027#58 = 0;
     #rem00027#63 = 0;

     nPorce1  = 0;
     nPorce2  = 0;
     nDifer   = (#rem00027#55 + #rem00027#60) - (#rem00027#54 + #rem00027#59);
     |SI nDifer < 0;  nResto = #rem00027#55 + #rem00027#60;  |FINSI;

     |SI #rem00027#122 = "N";
         nDifer = 0;
         nResto = #rem00027#55 + #rem00027#60;
     |FINSI;

     |HAZ Incentivo;

     #rem00027#56 = 0;
     #rem00027#61 = 0;

     |SI #rem00027#55 ! 0;
         #rem00027#56   = ((nPorce1 + nPorce2) / (#rem00027#55 + #rem00027#60)) * #rem00027#55;
     |FINSI;

     |SI #rem00027#60 ! 0;
         #rem00027#61   = ((nPorce1 + nPorce2) / (#rem00027#55 + #rem00027#60)) * #rem00027#60;
     |FINSI;

     #rem00027#58   = #rem00027#57 * #rem00027#56;
     #rem00027#63   = #rem00027#62 * #rem00027#61;
     #rem00027#64   = #rem00027#58 + #rem00027#63;

     || Minoracion Inversion

     #rem00027#78 = #rem00027#65 + #rem00027#68 + #rem00027#71 + #rem00027#74 + #rem00027#77;

     ||  Rdto Neto Minorado

     #rem00027#79 = #rem00027#52 - #rem00027#64 - #rem00027#78;

     ||  Quioscos

     #rem00027#81  = #rem00027#79 * #rem00027#80;
     |SI #reeleact#32 = "N";     #rem00027#81 = 0;  |FINSI;
     |SI #rem00027#81 < 0;    #rem00027#81 = 0;  |FINSI;

     ||  Taxis

     #rem00027#83  = #rem00027#79 * #rem00027#82;
     |SI #reeleact#33 = "N";     #rem00027#83 = 0;  |FINSI;
     |SI #rem00027#83 < 0;    #rem00027#83 = 0;  |FINSI;

     ||  Urbanos

     #rem00027#85  = #rem00027#79 * #rem00027#84;
     |SI #reeleact#35 = "N";     #rem00027#85 = 0;  |FINSI;
     |SI #rem00027#85 < 0;    #rem00027#85 = 0;  |FINSI;

     ||  Mercancias

     #rem00027#87  = #rem00027#79 * #rem00027#86;
     |SI #reeleact#34 = "N";     #rem00027#87 = 0;  |FINSI;
     |SI #rem00027#87 < 0;    #rem00027#87 = 0;  |FINSI;

     ||  Empresas Peque¤as dimensiones

     nCampoRdto = 79;
     |SI #rem00027#81 ! 0;  nCampoRdto = 81;  |FINSI;

     #rem00027#89 = #rem00027#nCampoRdto# * #rem00027#88;
     |SI #rem00027#83 ! 0; |O #rem00027#85 ! 0; |O #rem00027#87 ! 0;
         #rem00027#89 = 0;
     |FINSI;

     |SI #rem00027#89 < 0;  #rem00027#89 = 0;  |FINSI;

     ||  Temporada

     nCampoRdto = 79;
     |SI #rem00027#81 ! 0;  nCampoRdto = 81;  |FINSI;
     |SI #rem00027#83 ! 0;  nCampoRdto = 83;  |FINSI;
     |SI #rem00027#85 ! 0;  nCampoRdto = 85;  |FINSI;
     |SI #rem00027#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #rem00027#89 ! 0;  nCampoRdto = 89;  |FINSI;

     #rem00027#92 = #rem00027#nCampoRdto# * #rem00027#91;
     |SI #rem00027#92 < 0;  #rem00027#92 = 0;  |FINSI;

     || Exceso

     nCampoRdto = 79;
     |SI #rem00027#81 ! 0;  nCampoRdto = 81;  |FINSI;
     |SI #rem00027#83 ! 0;  nCampoRdto = 83;  |FINSI;
     |SI #rem00027#85 ! 0;  nCampoRdto = 85;  |FINSI;
     |SI #rem00027#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #rem00027#89 ! 0;  nCampoRdto = 89;  |FINSI;
     |SI #rem00027#92 ! 0;  nCampoRdto = 92;  |FINSI;

     #rem00027#95  = #reeleact#31;
     #rem00027#93  = #rem00027#nCampoRdto# - #rem00027#95;
     #rem00027#94  = #rem00027#95 + (#rem00027#93 * 1.30);
     |SI #rem00027#93 < 0;  #rem00027#94 = 0;  |FINSI;
     |SI #reeleact#31    = 0;  #rem00027#94 = 0;  |FINSI;
     |SI #rem00027#89 ! 0;  #rem00027#94 = 0;  |FINSI;

     || Nueva Actividad

     nCampoRdto = 79;
     |SI #rem00027#81 ! 0;  nCampoRdto = 81;  |FINSI;
     |SI #rem00027#83 ! 0;  nCampoRdto = 83;  |FINSI;
     |SI #rem00027#85 ! 0;  nCampoRdto = 85;  |FINSI;
     |SI #rem00027#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #rem00027#89 ! 0;  nCampoRdto = 89;  |FINSI;
     |SI #rem00027#92 ! 0;  nCampoRdto = 92;  |FINSI;
     |SI #rem00027#94 ! 0;  nCampoRdto = 94;  |FINSI;

     #rem00027#97 = #rem00027#nCampoRdto# * #rem00027#96;
     |SI #rem00027#92 ! 0;  #rem00027#97 = 0;  |FINSI;
     |SI #rem00027#97 < 0;  #rem00027#97 = 0;  |FINSI;


     || Rendimiento Neto Modulos Ajustado

     nCampoRdto = 79;
     |SI #rem00027#81 ! 0;  nCampoRdto = 81;  |FINSI;
     |SI #rem00027#83 ! 0;  nCampoRdto = 83;  |FINSI;
     |SI #rem00027#85 ! 0;  nCampoRdto = 85;  |FINSI;
     |SI #rem00027#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #rem00027#89 ! 0;  nCampoRdto = 89;  |FINSI;
     |SI #rem00027#92 ! 0;  nCampoRdto = 92;  |FINSI;
     |SI #rem00027#94 ! 0;  nCampoRdto = 94;  |FINSI;
     |SI #rem00027#97 ! 0;  nCampoRdto = 97;  |FINSI;

     #rem00027#98  = #rem00027#nCampoRdto#;

     #rem00027#108 = 0;
     |SI #rem00027#98 > 0;
         #rem00027#108 = #rem00027#98 % 5;
     |FINSI;

     #rem00027#110 = 0;
     |SI #rem00027#125 = "S";
         #rem00027#110 = #rem00027#98 - #rem00027#108;
         |SI #rem00027#110 > 0;
             #rem00027#110 = #rem00027#110 % 20;
         |SINO;
             #rem00027#110 = 0;
         |FINSI;
     |FINSI;

     #rem00027#114 = #rem00027#98 - #rem00027#108 - #rem00027#110 - #rem00027#109 + #rem00027#113;

     #rem00027#116 = 0;
     |SI #rem00027#115 = "S";
          #rem00027#116 = #rem00027#113 % 30;
          |SI #rem00027#116 > 90000; #rem00027#116 = 90000;  |FINSI;
     |FINSI;

     #rem00027#117 = #rem00027#114 - #rem00027#116;
|FPRC;

|PROCESO DesglosaBien;
      Comodin1 = Comodin + "agieos/def/eoscomul.mas";
      |CARGA_DEF Comodin1,eoscomul@;

      |PATH_DAT #11 Path;

      |ABRE #eoscomul@;
      |SELECT #2#eoscomul@;
      #eoscomul@#3 = #0#0;
      #eoscomul@#5 = #0#1;
      #eoscomul@#7 = nAnyoRenta;
      |LEE 010#eoscomul@.=;
      |SI FSalida = 0;
          #0#0 = #eoscomul@#0;
          #0#1 = #eoscomul@#1;
          #0#5 = #eoscomul@#3;
          #0#6 = #eoscomul@#5;
      |FINSI;
      |CIERRA #eoscomul@;
      |DESCARGA_DEF #eoscomul@;
|FPRC;

|PROGRAMA;
   nAnyoRenta = 18;    || 2018

   |ABRE #retabla4;
   |LEE 000#retabla4.p;
   nPatrones = FSalida;
   |CIERRA #retabla4;

   |SI nPatrones ! 0;
       |SUB_EJECUTA_NP "rez00001;INSTALAR";
   |FINSI;

   || Revisar Paths de Agicli

   |DBASS Comodin; |QBF Comodin;
   Comodin1 = Comodin + "agicli/def/agicontr.mas";
   |CARGA_DEF Comodin1,agicontr@;
   |PATH_DAT #17 Comodin;

   |ABRE #agicontr@;
   |LEE 010#agicontr@.p;
   |SI FSalida = 0;
      Path = #agicontr@#3;
      |QBF Path;
      |SI Path = "*"; |O Path = "";
         |DBASS Comodin; |QBF Comodin;
         Path = Comodin + "agieos/fich/";
      |FINSI;
   |SINO;
      |DBASS Comodin; |QBF Comodin;
      Path = Comodin + "agieos/fich/";
   |FINSI;
   |CIERRA #agicontr@;
   |DESCARGA_DEF #agicontr@;

   |PATH_DAT #999 Path;
   |ABRE #999;
   |LEE 040#999p;
   |SI FSalida ! 0;  |O #999#1 ! "E";
       |CIERRA #999;
       |MENAV "    Para poder hacer el pase la REO debe estar en EUROS.";
       |ACABA;
   |FINSI;
   |CIERRA #999;

   |SI enEmpresa ! 0;
      #0#0 = enEmprEos;
      #0#1 = enActiEos;
      #0#2 = enEmprRen;
      #0#4 = eaCaracter;
      #0#3 = eaTitCony;
      |HAZ DesglosaBien;
      FSalida = 0;
   |SINO;
      |CLS;
      |CABEZA "Captura datos Mod.130/131 y modulos de REO a renta"
      |PINPA #0#0;
      |PINDA #0#0;

      Comodin1 = Comodin + "agieos/def/eosactiv.mas";
      |CARGA_DEF Comodin1,eosactiv@;
      |PATH_DAT #3 Path;
      |ABRE #eosactiv@;

      |ENDATOS #1#0;
      FEstado = FSalida;
      |CIERRA #eosactiv@;
      |DESCARGA_DEF #eosactiv@;
      FSalida = FEstado;
   |FINSI;

   |SI FSalida = 0;
      Comodin = Comodin + "agieos/def/";

      Comodin1 = Comodin + "eosactiv.mas"; |CARGA_DEF Comodin1,eosactiv@;
      Comodin1 = Comodin + "eosclien.mas"; |CARGA_DEF Comodin1,eosclien@;
      Comodin1 = Comodin + "eosm0017.mas"; |CARGA_DEF Comodin1,eosm0017@;
      Comodin1 = Comodin + "eosm0018.mas"; |CARGA_DEF Comodin1,eosm0018@;
      Comodin1 = Comodin + "eoscomul.mas"; |CARGA_DEF Comodin1,eoscomul@;
      Comodin1 = Comodin + "eosm0011.mas"; |CARGA_DEF Comodin1,eosm0011@;
      Comodin1 = Comodin + "eosm0012.mas"; |CARGA_DEF Comodin1,eosm0012@;
      Comodin1 = Comodin + "eosm0020.mas"; |CARGA_DEF Comodin1,eosm0020@;
      Comodin1 = Comodin + "eosm3130.mas"; |CARGA_DEF Comodin1,eosm3130@;

      |PATH_DAT #3  Path;
      |PATH_DAT #4  Path;
      |PATH_DAT #9  Path;
      |PATH_DAT #10 Path;
      |PATH_DAT #11 Path;
      |PATH_DAT #13 Path;
      |PATH_DAT #14 Path;
      |PATH_DAT #15 Path;
      |PATH_DAT #16 Path;
      |PATH_DAT #17 Path;

      |ABRE #eosclien@;
      |ABRE #eoscomul@;
      |ABRE #rem00031;
      |ABRE #rem00027;
      |ABRE #eosm3130@;
      |ABRE #eosm0020@;
      |ABRE #eosm0011@;
      |ABRE #eosm0012@;
      |ABRE #agicontr@;
      |ABRE #eosactiv@;
      |ABRE #eosm0017@;
      |ABRE #eosm0018@;
      |SELECT #2#eoscomul@;
      Comun = 0;

      aNif        = "";
      aNombreEnt  = "";
      #eosclien@#0 = #recapmod#0;
      |LEE 010#eosclien@.=;
      #eosactiv@#0 = #recapmod#0;
      #eosactiv@#1 = #recapmod#1;
      #eosactiv@#2 = nAnyoRenta;
      |LEE 010#eosactiv@.=;
      |SI FSalida = 0;
         Comunidad = 0;
         Salir = 0;
         |SI #eosactiv@#46 = "S";
            Comunidad = 1;
            #eoscomul@#3 = #recapmod#5;
            #eoscomul@#5 = #recapmod#6;
            #eoscomul@#7 = nAnyoRenta;
            |LEE 010#eoscomul@.=;
            |SI FSalida = 0;
               ModulAct = #eosactiv@#22;
               nActivid = #recapmod#6;
               Comun = 1;
               aNif        = #eosclien@#1;
               aNombreEnt  = #eosclien@#2;
               #eosclien@#0 = #recapmod#5;
               |LEE 010#eosclien@.=;
               #eosactiv@#0 = #recapmod#5;
               #eosactiv@#1 = #recapmod#6;
               #eosactiv@#2 = nAnyoRenta;
               |LEE 010#eosactiv@.=;
            |SINO;
               aNif       = "";
               aNombreEnt = "";
               Salir = 1;
            |FINSI;
         |SINO;
            Comun      = 0;
            aNif       = "";
            aNombreEnt = "";
            ModulAct = #eosactiv@#22;
            nActivid = #recapmod#1;
         |FINSI;

         |SI Salir = 0;
            #eosm0017@#0 = #recapmod#0;
            #eosm0017@#5 = nAnyoRenta;
            #eosm0017@#1 = #recapmod#1;
            |LEE 010#eosm0017@.=;

            #eosm0018@#0 = #recapmod#0;
            #eosm0018@#2 = nAnyoRenta;
            #eosm0018@#1 = #recapmod#1;
            |LEE 010#eosm0018@.=;

            |HAZ Modulos;
            |HAZ PagosACuenta;
         |FINSI;
      |FINSI;

      |SELECT #1#eoscomul@;
      |CIERRA #eosactiv@;
      |CIERRA #eosm0018@;
      |CIERRA #eosm0017@;
      |CIERRA #agicontr@;
      |CIERRA #eosm0012@;
      |CIERRA #eosm0011@;
      |CIERRA #eosm3130@;
      |CIERRA #eosm0020@;
      |CIERRA #rem00027;
      |CIERRA #rem00031;
      |CIERRA #eoscomul@;
      |CIERRA #eosclien@;

      |DESCARGA_DEF #eosm3130@;
      |DESCARGA_DEF #eosm0020@;
      |DESCARGA_DEF #eosm0012@;
      |DESCARGA_DEF #eosm0011@;
      |DESCARGA_DEF #eoscomul@;
      |DESCARGA_DEF #eosm0018@;
      |DESCARGA_DEF #eosm0017@;
      |DESCARGA_DEF #eosclien@;
      |DESCARGA_DEF #eosactiv@;
   |FINSI;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     FSalida = 2499;
|FPRC;
