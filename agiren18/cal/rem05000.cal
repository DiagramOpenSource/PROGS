|FICHEROS;
     rem05000;

     reacceso;
     rem00100;
     rem00101;
|FIN;

|VARIABLES;
     &Cadena     = "";
     &Cadena1    = "";

    {5}aPopup    = "";
|FIN;

|INCLUYE m5000c99;

|| -----------------------------------------------------------------------

|PROCESO Popup;
     aPopup1  = nBtnDes;
     aPopup2  = 3;
     aPopup3  = "Descarga fichero";
     aPopup4  = "Visualizar datos fiscales";
     aPopup5  = "Salir";

     |PARA;  |SI;  |HACIENDO;
          IaPopup  = aPopup1  <-;
          |ESPECIFICA "TRACKPOPUP", aPopup;
          |SI FSalida ! 0;
              IaPopup  = aPopup3  <-;
              IaPopup  = IaPopup + (FSalida - 1);

              aAlfa = aPopup % 101;

              |SI aAlfa = "D";  |HAZ Descarga;    |SAL;  |FINSI;
              |SI aAlfa = "V";  |HAZ Visualiza;   |SAL;  |FINSI;
              |SI aAlfa = "S";  |SAL;             |FINSI;

              |PULSATECLA;
          |FINSI;
     |SIGUE;

     |PULSATECLA;
|FPRC;

|PROCESO Leer1;
     enContri = 1;
     enCampo  = 1;
     |HAZ LeeFichero;
|FPRC;

|PROCESO Descarga1;
     enContri = 1;
     enCampo  = 1;
     nBtnDes = enBoton1_1;
     |HAZ Popup;
|FPRC;

|PROCESO Procesar1;
     enCampo  = 1;
     enContri = 1;
     eaContri = "TITULAR";

     |HAZ Procesar;
|FPRC;

|PROCESO Leer2;
     enContri = 2;
     enCampo  = 5;
     |HAZ LeeFichero;
|FPRC;

|PROCESO Descarga2;
     enContri = 2;
     enCampo  = 5;
     nBtnDes = enBoton2_1;
     |HAZ Popup;
|FPRC;

|PROCESO Procesar2;
     enCampo  = 5;
     enContri = 2;
     eaContri = "CONYUGE";

     |HAZ Procesar;
|FPRC;

|PROCESO Leer3;
     enContri = 3;
     enCampo  = 9;
     |HAZ LeeFichero;
|FPRC;

|PROCESO Descarga3;
     enContri = 3;
     enCampo  = 9;
     nBtnDes = enBoton3_1;
     |HAZ Popup;
|FPRC;

|PROCESO Procesar3;
     enCampo  = 9;
     enContri = 3;
     eaContri = "1 FAMILIAR";

     |HAZ Procesar;
|FPRC;

|PROCESO Leer4;
     enContri = 4;
     enCampo  = 13;
     |HAZ LeeFichero;
|FPRC;

|PROCESO Descarga4;
     enContri = 4;
     enCampo  = 13;
     nBtnDes = enBoton4_1;
     |HAZ Popup;
|FPRC;

|PROCESO Procesar4;
     enCampo  = 13;
     enContri = 4;
     eaContri = "2 FAMILIAR";

     |HAZ Procesar;
|FPRC;

|PROCESO Leer5;
     enContri = 5;
     enCampo  = 17;
     |HAZ LeeFichero;
|FPRC;

|PROCESO Descarga5;
     enContri = 5;
     enCampo  = 17;
     nBtnDes = enBoton5_1;
     |HAZ Popup;
|FPRC;

|PROCESO Procesar5;
     enCampo  = 17;
     enContri = 5;
     eaContri = "3 FAMILIAR";

     |HAZ Procesar;
|FPRC;

|PROCESO Leer6;
     enContri = 6;
     enCampo  = 21;
     |HAZ LeeFichero;
|FPRC;

|PROCESO Descarga6;
     enContri = 6;
     enCampo  = 21;
     nBtnDes = enBoton6_1;
     |HAZ Popup;
|FPRC;

|PROCESO Procesar6;
     enCampo  = 21;
     enContri = 6;
     eaContri = "4 FAMILIAR";

     |HAZ Procesar;
|FPRC;

|PROCESO  rem00101;
     nConta    = nConta + 1;
     |SI nConta > 4;  |ERROR10;  |ACABA;  |FINSI;

     Cadena   = #rem00101#3;   |HAZ SeparaNombre;

     enCampo   = nConta + (5 + (nConta * 3));
     #rem05000#enCampo# = #rem00101#2;

     enCampo   = enCampo + 1;
     #rem05000#enCampo# = Cadena1;
|FPRC;

|DEFBUCLE rem00101;
     #rem00101#1;
     13;
     #rem00100#0,  1, "S";
     #rem00100#0, 99, "S";
     ;
     NULL, rem00101;
|FIN;


|PROCESO CargaCampos;
     |ABRE #rem00100;
     #rem00100#0 = #rem05000#0;
     |LEE 000#rem00100.=;
     |SI FSalida ! 0;  |DDEFECTO #rem00100;  |FINSI;
     |CIERRA #rem00100;

     #rem05000#1  = #rem00100#1;
     #rem05000#2  = #rem00100#2;

     #rem05000#5  = #rem00100#35;
     #rem05000#6  = #rem00100#36;

     #rem05000#10 = "";
     #rem05000#11 = "";
     #rem05000#14 = "";
     #rem05000#15 = "";
     #rem05000#18 = "";
     #rem05000#19 = "";
     #rem05000#22 = "";
     #rem05000#23 = "";

     nConta = 0;
     |BUCLE rem00101;

     |PARA enCampo = 2;  |SI enCampo [ 22;  |HACIENDO enCampo = enCampo + 4;
           nCampo1 = enCampo + 1;
           |C_M #rem05000#nCampo1#, 1, "S";

           aAlfa = #rem05000#enCampo#;  |QBF aAlfa;
           |SI aAlfa = "";
               |C_M #rem05000#nCampo1#, 1, "N";

               nCampo1   = enCampo + 2;
               #rem05000#nCampo1# = "No existe";
           |FINSI;
     |SIGUE;

     |HAZ EnciendeBotones;
|FPRC;

|PROCESO Tipo12;   |TIPO 12;
|FPRC;

|PROCESO LeeUnidadAEAT;
     eaUnidadBasico = "";

     |PARA nCaracter = 67;  |SI nCaracter [ 90;  |HACIENDO nCaracter = nCaracter + 1;
           aUnidadSistema = &nCaracter + ":";
           aAbre   = aUnidadSistema + "\AEAT\PRUEBA.TXT";
           |XABRE "WC", aAbre, nHandle;
           |SI FSalida ] 0;
               aAlfa = "Prueba correcta.";
               |XGRABA nHandle, aAlfa;
           |FINSI;
           |XCIERRA nHandle;

           |XABRE "EC", aAbre, nHandle;
           |SI FSalida ] 0;
               |RFBORRA aAbre;
               eaUnidadBasico = aUnidadSistema;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI eaUnidadBasico = "";
         |HAZ LeeUnidadBasico;
     |FINSI;
|FPRC;

|PROCESO Pondsrentadatfisc;
     |HAZ LeeUnidadBasico;

     |DBASE eaBase;  |QBF eaBase;
     aFicOrigen = eaBase + "plugins/dsrentadatfisc.tgz";
     |XABRE "E", aFicOrigen, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aFicDestino  = eaDirLocal + "dsrentadatfisc.tgz";

     aContiene1 = aFicDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aFicOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     |SI aDocRemoto = aDocServidor;  |Y aDocRemoto ! "";
         |ACABA;
     |FINSI;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO aFicOrigen, aFicDestino;
     |SINO;
         |COPIA_FICHERO aFicOrigen, aFicDestino;
     |FINSI;

     |RDESCOMPRIME aFicDestino;
     |RDETAR aFicDestino, eaDirLocal;

     aAlfa = aFicDestino - ".tgz" + ".tar";  |RFBORRA aAlfa;
|FPRC;

|PROGRAMA;
||     |MENAV "0000Opci¢n todav¡a no disponible.";
||     |ACABA;

     |HAZ CargaColores;

     |VENTANA 0501, 3599, -1, 16, "Recogida datos fiscales";
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     aAlfa    = PARAMETRO % 105;
     nEmpresa = aAlfa;
     aAlfa    = PARAMETRO % 601;
     nModo    = aAlfa;

     |HAZ LeeUnidadAEAT;
     eaDirLocal = eaUnidadBasico + "\AEAT";   |RMKDIR  eaDirLocal;
     eaDirLocal = eaDirLocal + "\Renta2018";  |RMKDIR  eaDirLocal;
     eaDirLocal = eaDirLocal + "\";

     eaDirResp  = eaDirLocal + "Respuestas";  |RMKDIR  eaDirResp;
     eaDirResp  = eaDirResp  + "\";

     |DBASE eaBase;
     eaDirServidor = eaBase + "web";  |MKDIR eaDirServidor;
     eaDirServidor = eaDirServidor + "/";

     |HAZ Pondsrentadatfisc;

     |ABRE #rem05000;
     #rem05000#0 = nEmpresa;
     |LEE 101#rem05000.=;
     |SI FSalida ! 0;
         |DDEFECTO #rem05000;
         #rem05000#0 = nEmpresa;
         |GRABA 020#rem05000.b;
     |FINSI;

     |PINPA #0#rem05000;    nPanta = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{228}}Bajar de la web", 1002, 1017, Descarga1;
     enBoton1_1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Leer fichero", 1019, 1032, Leer1;
     enBoton1_2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Procesar", 1034, 1047, Procesar1;
     enBoton1_3 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{228}}Bajar de la web", 1050, 1065, Descarga2;
     enBoton2_1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Leer fichero", 1067, 1080, Leer2;
     enBoton2_2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Procesar", 1082, 1095, Procesar2;
     enBoton2_3 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{228}}Bajar de la web", 1702, 1717, Descarga3;
     enBoton3_1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Leer fichero", 1719, 1732, Leer3;
     enBoton3_2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Procesar", 1734, 1747, Procesar3;
     enBoton3_3 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{228}}Bajar de la web", 1750, 1765, Descarga4;
     enBoton4_1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Leer fichero", 1767, 1780, Leer4;
     enBoton4_2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Procesar", 1782, 1795, Procesar4;
     enBoton4_3 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{228}}Bajar de la web", 2402, 2417, Descarga5;
     enBoton5_1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Leer fichero", 2419, 2432, Leer5;
     enBoton5_2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Procesar", 2434, 2447, Procesar5;
     enBoton5_3 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{228}}Bajar de la web", 2450, 2465, Descarga6;
     enBoton6_1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Leer fichero", 2467, 2480, Leer6;
     enBoton6_2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Procesar", 2482, 2495, Procesar6;
     enBoton6_3 = FSalida;

     |ESTADO_CONTROL enBoton1_1, "DISABLE";
     |ESTADO_CONTROL enBoton1_2, "DISABLE";
     |ESTADO_CONTROL enBoton1_3, "DISABLE";

     |ESTADO_CONTROL enBoton2_1, "DISABLE";
     |ESTADO_CONTROL enBoton2_2, "DISABLE";
     |ESTADO_CONTROL enBoton2_3, "DISABLE";

     |ESTADO_CONTROL enBoton3_1, "DISABLE";
     |ESTADO_CONTROL enBoton3_2, "DISABLE";
     |ESTADO_CONTROL enBoton3_3, "DISABLE";

     |ESTADO_CONTROL enBoton4_1, "DISABLE";
     |ESTADO_CONTROL enBoton4_2, "DISABLE";
     |ESTADO_CONTROL enBoton4_3, "DISABLE";

     |ESTADO_CONTROL enBoton5_1, "DISABLE";
     |ESTADO_CONTROL enBoton5_2, "DISABLE";
     |ESTADO_CONTROL enBoton5_3, "DISABLE";

     |ESTADO_CONTROL enBoton6_1, "DISABLE";
     |ESTADO_CONTROL enBoton6_2, "DISABLE";
     |ESTADO_CONTROL enBoton6_3, "DISABLE";

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Configurar explorador web", 3502, 3525, BotonExplora;

     |HAZ CargaCampos;
     |PINDA #0#rem05000;

     |ENDATOS #1#rem05000;

     |GRABA 020#rem05000.a;
     |LIBERA #rem05000;
     |CIERRA #rem05000;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;

     |ABRE #rem00100;
     #rem00100#0 = #rem05000#0;
     |LEE 000#rem00100.=;
     |SI FSalida ! 0;  |DDEFECTO #rem00100;  |FINSI;
     |CIERRA #rem00100;

     |ABRE #reacceso;
     #reacceso#0 = #rem05000#0;
     |LEE 000#reacceso.=;
     |SI FSalida ! 0;  |DDEFECTO #reacceso;  |FINSI;
     |CIERRA #reacceso;

     enEmpresa = #reacceso#0;
     eaNombre  = #reacceso#1;
     eaNif     = #reacceso#2;
     eaLetra   = "CO";
     enModo    = 1;
     |SUB_EJECUTA "rew00200";
|FPRO;
