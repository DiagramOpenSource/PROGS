|INCLUYE i_varemi;
|INCLUYE i_ficher;
|INCLUYE i_ficpdo;

|| **************************************************************************
||                           PROCESOS DEL PROGRAMA
|| **************************************************************************

|PROCESO empresa; |TIPO 0;
|ABRE #1;
#1#0 = #0#0;
|LEE 040#1=;
|SI FSalida ! 0;  |MENAV "     No existe empresa";            |ERROR; |ACABA; |FINSI;
|SI #1#142 = "N"; |MENAV "     La empresa no esta calculada"; |ERROR; |ACABA; |FINSI;
|SI #1#143 = "N"; |MENAV "     La empresa no es partida";     |ERROR; |ACABA; |FINSI;
#0#1 = #1#1;
|PINTA #0#1;
|CIERRA #1;

|ABRE #8;
#8#0 = #0#0;
|LEE 040#8=;
|SI FSalida ! 0; |ACABA; |FINSI;
|CIERRA #8;

Tippar   = #8#3;
Muerto   = #8#5;
|SI #8#3 = 2; Fecpar = #8#4; |SINO; Fecpar = #8#6; |FINSI;
Feini    = "01.01.1995";
Fefin    = Fecpar;
Dias     = Fefin - Feini + 1;
Parte1   = ((100 * Dias) / 36500) ! 4;
Parte2   = 1 - Parte1;
|FPRC;

|| **************************************************************************
||                           PROCESOS DE LA IMPRESION
|| **************************************************************************

|PROCESO LeeFich;
|ABRE #1;
#1#0 = #99#0;
|LEE 040#1=;
|SI FSalida ! 0; |DDEFECTO #1; |FINSI;
|CIERRA #1;

|ABRE #2;
#2#0 = #1#40;
#2#1 = #1#41;
|LEE 040#2=;
|SI FSalida ! 0; |DDEFECTO #2; |FINSI;
|CIERRA #2;

|ABRE #3;
#3#0 = #1#44;
|LEE 040#3=;
|SI FSalida ! 0; |DDEFECTO #3; |FINSI;
|CIERRA #3;

|ABRE #4;
#4#0 = #1#12;
#4#1 = #1#13;
|LEE 040#4=;
|SI FSalida ! 0; |DDEFECTO #4; |FINSI;
|CIERRA #4;

|ABRE #5;
#5#0   = #99#0;
#5#141 = #99#1;
|LEE 040#5=;
|SI FSalida ! 0; |DDEFECTO #5; |FINSI;
|CIERRA #5;

|ABRE #6;
#6#0 = #99#0;
#6#1 = #99#1;
|LEE 040#6=;
|SI FSalida ! 0; |DDEFECTO #6; |FINSI;
|CIERRA #6;

|ABRE #37;
#37#0 = #1#12;
|LEE 040#37=;
|SI FSalida ! 0; |DDEFECTO #37; |FINSI;
|CIERRA #37;
|FPRC;

|PROCESO imprime_lo;
|PINPA #0#90;
#90#0 = #99#0;  |PINTA #90#0;
#90#1 = #99#3;  |PINTA #90#1;

|PARA xxx = 1; |SI xxx [ #99#4; |HACIENDO xxx = xxx + 1;
      |HAZ Defectos;
      #90#3 = xxx;  |PINTA #90#3;
      |HAZ LeeFich;
      |SI #0#8 = "S";  |HAZ hoja1;  |FINSI;   || REH10001
      |SI #0#9 = "S";  |HAZ hoja2;  |FINSI;   || REH10001
      |SI #0#10 = "S"; |HAZ hoja3;  |FINSI;   || REH10002
      |SI #0#11 = "S"; |HAZ hoja4;  |FINSI;   || REH10002
      |SI #0#12 = "S"; |HAZ hoja5;  |FINSI;   || REH10003
      |SI #0#13 = "S"; |HAZ hoja6;  |FINSI;   || REH10003
      |SI #0#14 = "S"; |HAZ hoja7;  |FINSI;   || REH10004
      |SI #0#15 = "S"; |HAZ hoja8;  |FINSI;   || REH10004
      |SI #0#16 = "S"; |HAZ hoja9;  |FINSI;   || REH10005
      |SI #0#17 = "S"; |HAZ hoja10; |FINSI;   || REH10005
      |SI #0#18 = "S"; |HAZ hoja11; |FINSI;   || REH10005
      |SI #0#19 = "S"; |HAZ hoja12; |FINSI;   || REH10005
      |SI #0#20 = "S"; |HAZ hoja13; |FINSI;   || REH10005
      |SI #0#21 = "S"; |HAZ hoja14; |FINSI;   || REH10005
|SIGUE;

|ABRE #1;
|LIBERA #1;
#1#0 = #99#0;
|LEE 140#1=;
|SI FSalida ! 0; |CIERRA #1; |ACABA; |FINSI;

|SI #83#25 = " "; |Y #5#139 > 0; |Y #0#3 = "S";
    #83#17 = #5#139;
    #83#19 = #5#139 % 60;
    #83#20 = #5#139 % 40;
    #83#21 = #5#139 % 40;

    |SI papel = 1;
        informe = "re102h01"; |HAZ continuo;
    |SINO;
        informe = "re102m01"; |HAZ manual;
    |FINSI;
|FINSI;

|SI #99#1 = "A";
    #1#124 = "S";
    |SI #0#3 = "S"; |Y #5#139 > 0;
       |SI #83#25 = " "; #1#131 = "S"; |FINSI;
    |FINSI;
|FINSI;

|SI #99#1 = "T";
    #1#125 = "S";
    |SI #0#3 = "S"; |Y #5#139 > 0;
       |SI #83#25 = " "; #1#132 = "S"; |FINSI;
    |FINSI;
|FINSI;

|SI #99#1 = "C";
    #1#126 = "S";
    |SI #0#3 = "S"; |Y #5#139 > 0;
       |SI #83#25 = " "; #1#133 = "S"; |FINSI;
    |FINSI;
|FINSI;

|GRABA 140#1a;
|LIBERA #1;
|CIERRA #1;
|FPRC;

|PROCESO Defectos;
|DDEFECTO #70;   |DDEFECTO #71;
|DDEFECTO #72;   |DDEFECTO #73;
|DDEFECTO #74;   |DDEFECTO #75;
|DDEFECTO #76;   |DDEFECTO #77;
|DDEFECTO #78;   |DDEFECTO #79;
|DDEFECTO #80;   |DDEFECTO #81;
|DDEFECTO #82;   |DDEFECTO #83;
|FPRC;

|DEFBUCLE rew00001;
#99#1;
5;
00000, " ", "S";
99999, "z", "S";
;
NULL, imprime_lo;
|FIN;

|PROCESO tipo_3; |TIPO 3;
|SI #0#4 ! "SI"; |ACABA; |FINSI;

|IMPRE 0;
|SI FSalida ! 0; |ACABA; |FINSI;

|HAZ tipo_impre;     |SI papel ! 1; |Y papel ! 2; |ACABA; |FINSI;
|HAZ carga_index;

|SI x = 0; |ACABA; |FINSI;

|BUCLE rew00001;
|FINIMP;
|ABRE #99; |CIERRA #99; |DELINDEX #99;
|FPRC;

|PROCESO tipo_impre;
|MENU hojas;
papel = FSalida;
|SI papel ! 1; |Y papel ! 2; |ACABA; |FINSI;

diainf  = #0#2 % 102;
mesinf  = #0#2 % 402;
anyoinf = #0#2 % -101;

|SI mesinf = "01"; mesinf = "Enero     "; |FINSI;
|SI mesinf = "02"; mesinf = "Febrero   "; |FINSI;
|SI mesinf = "03"; mesinf = "Marzo     "; |FINSI;
|SI mesinf = "04"; mesinf = "Abril     "; |FINSI;
|SI mesinf = "05"; mesinf = "Mayo      "; |FINSI;
|SI mesinf = "06"; mesinf = "Junio     "; |FINSI;
|SI mesinf = "07"; mesinf = "Julio     "; |FINSI;
|SI mesinf = "08"; mesinf = "Agosto    "; |FINSI;
|SI mesinf = "09"; mesinf = "Septiembre"; |FINSI;
|SI mesinf = "10"; mesinf = "Octubre   "; |FINSI;
|SI mesinf = "11"; mesinf = "Noviembre "; |FINSI;
|SI mesinf = "12"; mesinf = "Diciembre "; |FINSI;
|FPRC;

|PROCESO graba_index;
|SI #1#104 = "O"; |O #1#104 = "o";
    |SI #1#125 = #0#6;
        #99#0 = #1#0;
        #99#1 = "T";
        #99#2 = "TITULAR";
        #99#3 = #1#1;
        #99#4 = #0#7;
        #99#5 = "S";
        #99#6 = 1;
        #99#7 = #1#2;
        |GRABA 040#99n;
        x = 1;
    |FINSI;
|FINSI;

|SI #1#105 = "O"; |O #1#105 = "o";
    |SI #1#126 = #0#6;
        #99#0 = #1#0;
        #99#1 = "C";
        #99#2 = "CONYUGE";
        #99#3 = #1#28;
        #99#4 = #0#7;
        #99#5 = "S";
        #99#6 = 1;
        #99#7 = #1#29;
        |GRABA 040#99n;
        x = 1;
    |FINSI;
|FINSI;

|SI #1#103 = "O"; |O #1#103 = "o";
    |SI #1#124 = #0#6;
        #99#0 = #1#0;
        #99#1 = "A";
        #99#2 = "CONJUNTA";
        #99#3 = #1#1;
        #99#4 = #0#7;
        #99#5 = "S";
        #99#6 = 1;
        #99#7 = #1#2;
        |GRABA 040#99n;
        x = 1;
    |FINSI;
|FINSI;
|FPRC;

|RUTINA inferior;
#99#0 = 1;
#99#1 = " ";
|FRUT;

|RUTINA superior;
#99#0 = 99999;
#99#1 = "z";
|FRUT;

|PROCESO carga_index;
comienza = "OP";
|HAZ fichero;
|NOME_DAT #99 fichero;
|ABRE #99; |CIERRA #99; |DELINDEX #99;

|ABRE #99;
x = 0;

|ABRE #1;
#1#0 = #0#0;
|LEE 040#1=;
|SI FSalida = 0; |HAZ graba_index; |FINSI;
|CIERRA #1;
|CIERRA #99;

|SI x = 0; |ACABA; |FINSI;

|SI #0#5 = "N"; |ACABA; |FINSI;

|ENTLINEAL #1#99, 1, 4, 19, 1, inferior, superior;
|FPRC;

|PROCESO funcion1; |TIPO 11;
|SI FSalida ! 9; |ACABA; |FINSI;

|LIBERA #99;
|LEE 140#99=;

|SI #99#5 = "S"; #99#5 = "N"; |SINO; #99#5 = "S"; |FINSI;
|PINTA #99#5;
|GRABA 140#99a;
|FPRC;
