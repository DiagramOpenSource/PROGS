|FICHEROS;
    retransp #0;
    reproedi #1;
    reprofco #2;
    reempedi #3;
    reemprco #4;
    reincide #5;
    retotren #6;
    redatcon #7;
    repagret #55;
    retotrea #11;
|FIN;

|INCLUYE i_varcal;

|| **************************************************************************
||                   PROCESO DE LECTURA DE LOS DISTINTOS FICHEROS
|| **************************************************************************

|PROCESO fich_02_0;           || Trata Transparencia Fiscal
alfa1     = "TRANSPARENCIA FISCAL --------------------------------------------";
tipod     = #0#2;
tipore    = #0#4;
descri    = #0#13;
linea     = #0#1;
rendi     = #0#22;
perceptor = #0#3;
numero1   = #0#7;
numero2   = #0#8;
numero3   = #0#9;
numero4   = #0#10;
numero5   = #0#11;
numero6   = #0#12;
sw_fich   = 0;
empreac   = #0#0;

|SI #0#4 = "X"; |O #0#4 = "P"; |O #0#4 = "R";
    |HAZ incide_02;
|FINSI;

|SI #0#4 = "A"; |O #0#4 = "R";
    |SI #0#5 ! "N"; |HAZ tipode_02; |FINSI;
|FINSI;
|FPRC;

|PROCESO fich_02_1;            || Trata Profesional Directa
alfa1     = "ACTIVIDADES PROFESIONALES DIRECTAS ------------------------------";
tipod     = #1#2;
tipore    = #1#4;
descri    = #1#15;
linea     = #1#1;
rendi     = #1#28;
perceptor = #1#3;
numero1   = #1#7;
numero2   = #1#8;
numero3   = #1#9;
numero4   = #1#10;
numero5   = #1#11;
numero6   = #1#12;
sw_fich   = 1;
empreac   = #1#0;
tipoprop  = #1#5;
cantidad1 = 0;

|SI #1#4 = "X"; |O #1#4 = "P"; |O #1#4 = "R";
    |HAZ incide_02;
|FINSI;

|SI #1#4 = "A"; |O #1#4 = "R";
    |SI #1#5 ! "N"; |HAZ tipode_02; |FINSI;
|FINSI;
|FPRC;

|PROCESO fich_02_2;       || Trata  Profesional Coeficientes
alfa1     = "ACTIVIDADES PROFESIONALES COEFICIENTES --------------------------";
tipod     = #2#2;
tipore    = #2#4;
descri    = #2#15;
linea     = #2#1;
rendi     = #2#32;
perceptor = #2#3;
numero1   = #2#7;
numero2   = #2#8;
numero3   = #2#9;
numero4   = #2#10;
numero5   = #2#11;
numero6   = #2#12;
sw_fich   = 2;
empreac   = #2#0;
tipoprop  = #2#5;
cantidad1 = 0;

|SI #2#4 = "X"; |O #2#4 = "P"; |O #2#4 = "R";
    |HAZ incide_02;
|FINSI;

|SI #2#4 = "A"; |O #2#4 = "R";
    |SI #2#5 ! "N"; |HAZ tipode_02; |FINSI;
|FINSI;
|FPRC;

|PROCESO fich_02_3;            || Trata Empresarial Directa
alfa1     = "ACTIVIDADES EMPRESARIALES DIRECTAS ------------------------------";
tipod     = #3#2;
tipore    = #3#4;
descri    = #3#15;
linea     = #3#1;
rendi     = #3#49;
perceptor = #3#3;
numero1   = #3#7;
numero2   = #3#8;
numero3   = #3#9;
numero4   = #3#10;
numero5   = #3#11;
numero6   = #3#12;
sw_fich   = 3;
empreac   = #3#0;
tipoprop  = #3#5;
cantidad1 = 0;

|SI #3#4 = "X"; |O #3#4 = "P"; |O #3#4 = "R";
    |HAZ incide_02;
|FINSI;

|SI #3#4 = "A"; |O #3#4 = "R";
    |SI #3#5 ! "N"; |HAZ tipode_02; |FINSI;
|FINSI;
|FPRC;

|PROCESO fich_02_4;         || Trata Empresarial Coeficientes
alfa1 = "ACTIVIDADES EMPRESARIALES COEFICIENTES ------------------------------";
tipod     = #4#2;
tipore    = #4#4;
descri    = #4#15;
linea     = #4#1;
rendi     = #4#32;
perceptor = #4#3;
numero1   = #4#7;
numero2   = #4#8;
numero3   = #4#9;
numero4   = #4#10;
numero5   = #4#11;
numero6   = #4#12;
sw_fich   = 4;
empreac   = #4#0;
tipoprop  = #4#5;
cantidad1 = 0;
agricola  = 0;
|SI #4#47 = "N"; agricola  = 1; |FINSI;

|SI #4#4 = "X"; |O #4#4 = "P"; |O #4#4 = "R";
    |HAZ incide_02;
|FINSI;

|SI #4#4 = "A"; |O #4#4 = "R";
    |SI #4#5 ! "N"; |HAZ tipode_02; |FINSI;
|FINSI;
|FPRC;

|PROCESO fich_02_55;            || Trata Pagos a Cuentas y Retenciones
alfa1     = "PAGOS FRACCIONADOS Y RETENCIONES --------------------------------";
tipod     = #55#2;
linea     = #55#1;
perceptor = #55#3;
sw_fich   = 55;
empreac   = #55#0;
|HAZ tipode_02;
|FPRC;

|| **************************************************************************
                        TRATAMIENTO DE LA LIQUIDACION
|| **************************************************************************

|PROCESO tipode_02;
  |SI tipod = "G";                || Si es Ganancial
      coefi1 = 50;  coefi2 = 50;  tipod  = "T"; |HAZ leeliq_02;
      coefi1 = 50;  coefi2 = 50;  tipod  = "C"; |HAZ leeliq_02;
      coefi1 = 100; coefi2 = 100; tipod  = "A"; |HAZ leeliq_02;
      |ACABA;
  |FINSI;

  |SI tipod ! "V";         || SI ES TITULAR CONYUGE;
      coefi1 = 100; coefi2 = 100;                |HAZ leeliq_02;
      coefi1 = 100; coefi2 = 100; tipod  =  "A"; |HAZ leeliq_02;
      |ACABA;
  |FINSI;
                || Si es Varios
  coefi2 = 100;
  |SI numero1 ! 0; coefi1 = numero1; tipod = "T"; |HAZ leeliq_02; |FINSI;
  |SI numero2 ! 0; coefi1 = numero2; tipod = "C"; |HAZ leeliq_02; |FINSI;
  |SI numero3 ! 0; coefi1 = numero3; tipod = "1"; |HAZ leeliq_02; |FINSI;
  |SI numero4 ! 0; coefi1 = numero4; tipod = "2"; |HAZ leeliq_02; |FINSI;
  |SI numero5 ! 0; coefi1 = numero5; tipod = "3"; |HAZ leeliq_02; |FINSI;
  |SI numero6 ! 0; coefi1 = numero6; tipod = "4"; |HAZ leeliq_02; |FINSI;
  coefi1 = numero1 + numero2 + numero3 + numero4 + numero5 + numero6;
  tipod = "A"; |HAZ leeliq_02;
|FPRC;

|PROCESO leeliq_02;                 || Lee la Liquidacion
#6#0 = empreac;
#6#141 = tipod;
|LIBERA #6; |LEE 110#6=;
FEstado = FSalida;
|SI FSalida ! 0;
   |DDEFECTO #6;
   #6#000 = empreac;
   #6#141 = tipod;
|FINSI;
|SI sw_fich = 0;  |HAZ grabafi_02_0;  |FINSI;
|SI sw_fich = 1;  |HAZ grabafi_02_1;  |FINSI;
|SI sw_fich = 2;  |HAZ grabafi_02_2;  |FINSI;
|SI sw_fich = 3;  |HAZ grabafi_02_3;  |FINSI;
|SI sw_fich = 4;  |HAZ grabafi_02_4;  |FINSI;
|SI sw_fich = 55; |HAZ grabafi_02_55; |FINSI;
|SI FEstado = 0; |GRABA 121#6a; |SINO; |GRABA 121#6n; |FINSI;

|SI agricola = 1; |Y sw_fich = 4;
    |ABRE #11;
    #11#0 = empreac;
    #11#1 = tipod;
    |LIBERA #11; |LEE 110#11=;
    FEstado = FSalida;
    |SI FSalida ! 0;
        |DDEFECTO #11;
        #11#000 = empreac;
        #11#001 = tipod;
    |FINSI;
    #11#201 = 1;
    |SI FEstado = 0; |GRABA 021#11a; |SINO; |GRABA 021#11n; |FINSI;
    |CIERRA #11;
|FINSI;
|FPRC;

|PROCESO grabafi_02_0;
  |SI #0#14 = "***         ";
      #6#70 = #6#70 + (#0#18 % coefi1);
      |ACABA;
  |FINSI;

  pepe   = #0#16 % coefi1;  || Cambiado por Manolo
  #6#23 = #6#23 + pepe;
  #6#134 = #6#134 +  (#0#21 % coefi1);
|FPRC;

|PROCESO grabafi_02_1;
  #6#14 = #6#14 + (#1#16 % coefi1);
  #6#15 = #6#15 + (#1#28 % coefi1);
  |SI #6#141 = "T";
      #6#204 = #6#204 + (#1#28 % coefi1);
  |FINSI;
  |SI #6#141 = "C";
      #6#210 = #6#210 + (#1#28 % coefi1);
  |FINSI;
  |SI #6#141 = "A"; |Y #1#2 = "G";
      #6#204 = #6#204 + ((#1#28 % coefi1) / 2);
      #6#210 = #6#210 + ((#1#28 % coefi1) / 2);
  |FINSI;
  |SI #6#141 = "A"; |Y #1#2 = "T";
      #6#204 = #6#204 + (#1#28 % coefi1);
  |FINSI;
  |SI #6#141 = "A"; |Y #1#2 = "C";
      #6#210 = #6#210 + (#1#28 % coefi1);
  |FINSI;
  |SI #6#141 = "A"; |Y #1#2 = "V";
      #6#204 = #6#204 + (#1#28 % numero1);
      #6#210 = #6#210 + (#1#28 % numero2);
  |FINSI;
  #6#64 = #6#64 + ( #1#27 % coefi1);
|FPRC;

|PROCESO grabafi_02_2;
  #6#16 = #6#16 + (#2#17 % coefi1);
  #6#17 = #6#17 + (#2#32 % coefi1);
  |SI #6#141 = "T";
      #6#204 = #6#204 + (#2#32 % coefi1);
  |FINSI;
  |SI #6#141 = "C";
      #6#210 = #6#210 + (#2#32 % coefi1);
  |FINSI;
  |SI #6#141 = "A"; |Y #2#2 = "G";
      #6#204 = #6#204 + ((#2#32 % coefi1) / 2);
      #6#210 = #6#210 + ((#2#32 % coefi1) / 2);
  |FINSI;
  |SI #6#141 = "A"; |Y #2#2 = "T";
      #6#204 = #6#204 + (#2#32 % coefi1);
  |FINSI;
  |SI #6#141 = "A"; |Y #2#2 = "C";
      #6#210 = #6#210 + (#2#32 % coefi1);
  |FINSI;
  |SI #6#141 = "A"; |Y #2#2 = "V";
      #6#204 = #6#204 + (#2#32 % numero1);
      #6#210 = #6#210 + (#2#32 % numero2);
  |FINSI;
  #6#64 = #6#64 + (( #2#26 - #2#27 - #2#28) % coefi1);
|FPRC;

|PROCESO grabafi_02_3;
  #6#18 = #6#18 + (#3#23 % coefi1);
  #6#19 = #6#19 + (#3#49 % coefi1);
  |SI #6#141 = "T";
      #6#203 = #6#203 + (#3#49 % coefi1);
  |FINSI;
  |SI #6#141 = "C";
      #6#209 = #6#209 + (#3#49 % coefi1);
  |FINSI;
  |SI #6#141 = "A"; |Y #3#2 = "G";
      #6#203 = #6#203 + ((#3#49 % coefi1) / 2);
      #6#209 = #6#209 + ((#3#49 % coefi1) / 2);
  |FINSI;
  |SI #6#141 = "A"; |Y #3#2 = "T";
      #6#203 = #6#203 + (#3#49 % coefi1);
  |FINSI;
  |SI #6#141 = "A"; |Y #3#2 = "C";
      #6#209 = #6#209 + (#3#49 % coefi1);
  |FINSI;
  |SI #6#141 = "A"; |Y #3#2 = "V";
      #6#203 = #6#203 + (#3#49 % numero1);
      #6#209 = #6#209 + (#3#49 % numero2);
  |FINSI;
  #6#64 = #6#64 + ( #3#48 % coefi1 );
|FPRC;

|PROCESO grabafi_02_4;
  #6#20 = #6#20 + (#4#17 % coefi1);
  #6#21 = #6#21 + (#4#32 % coefi1);
  |SI #6#141 = "T";
      #6#203 = #6#203 + (#4#32 % coefi1);
  |FINSI;
  |SI #6#141 = "C";
      #6#209 = #6#209 + (#4#32 % coefi1);
  |FINSI;
  |SI #6#141 = "A"; |Y #4#2 = "G";
      #6#203 = #6#203 + ((#4#32 % coefi1) / 2);
      #6#209 = #6#209 + ((#4#32 % coefi1) / 2);
  |FINSI;
  |SI #6#141 = "A"; |Y #4#2 = "T";
      #6#203 = #6#203 + (#4#32 % coefi1);
  |FINSI;
  |SI #6#141 = "A"; |Y #4#2 = "C";
      #6#209 = #6#209 + (#4#32 % coefi1);
  |FINSI;
  |SI #6#141 = "A"; |Y #4#2 = "V";
      #6#203 = #6#203 + (#4#32 % numero1);
      #6#209 = #6#209 + (#4#32 % numero2);
  |FINSI;
  #6#64 = #6#64 + ((#4#26 - #4#27 - #4#28) % coefi1);
|FPRC;

|PROCESO grabafi_02_55;
  #6#133 = #6#133 + (#55#9  % coefi2);
  #6#71  = #6#71  + (#55#10 % coefi2);
  #6#137 = #6#137 + ((#55#5 + #55#6 + #55#7 + #55#8) % coefi2);
|FPRC;

|| **************************************************************************
                           PROCESO DE INCIDENCIAS
|| **************************************************************************

|PROCESO incide_02;
|SI incisino = "S";
   |SI sw = 0; |HAZ grabaci_02; sw = 1; |FINSI;

   linea = "00" + linea;
   linea = linea % -102;

   rendi = "          " + rendi;
   rendi = rendi % -110;

   |QBF descri;
   descri = descri + blanco;
   descri = descri % 130;

   alfa1 = "NO CALCULO ->  " + linea + " " + descri + "    " + rendi;

   |SI tipore = "R";
       alfa1 = "RENTA ------>  " + linea + " " + descri + "    " + rendi;
   |FINSI;
   |SI tipore = "P";
       alfa1 = "PATRIMONIO ->  " + linea + " " + descri + "    " + rendi;
   |FINSI;
   |HAZ grabaci_02;
|FINSI;
|FPRC;

|PROCESO grabaci_02;
swcalcu = 1;
lininci = lininci + 5;
#5#0 = empreac;
#5#1 = lininci;
#5#2 = alfa1;
#5#3 = "S";
|GRABA 020#5n;
|LIBERA #5;
|FPRC;

|| **************************************************************************
||                             PROCESO BUCLES
|| **************************************************************************

|DEFBUCLE leefic0;   || Bucle Transparencias Fiscal
#0#1;
;
empresa, 01;
emprefi, 99;
e;
NULL, fich_02_0;
|FIN;

|DEFBUCLE leefic1;   || Bucle Profesional Directa
#1#1;
;
empresa, 01;
emprefi, 99;
e;
NULL, fich_02_1;
|FIN;

|DEFBUCLE leefic2;    || Bucle Profesional Coeficiente
#2#1;
;
empresa, 01;
emprefi, 99;
e;
NULL, fich_02_2;
|FIN;

|DEFBUCLE leefic3;    || Bucle Empresarial Directa
#3#1;
;
empresa, 01;
emprefi, 99;
e;
NULL, fich_02_3;
|FIN;

|DEFBUCLE leefic4;    || Bucle Empresarial Coeficiente
#4#1;
;
empresa, 01;
emprefi, 99;
e;
NULL, fich_02_4;
|FIN;

|DEFBUCLE leefic55;   || Pagos a Cuenta y Retenciones
#55#1;
;
empresa, 01;
emprefi, 99;
e;
NULL, fich_02_55;
|FIN;

|| **************************************************************************
                              INICIO
|| **************************************************************************

|PROCESO recalcu2;
agricola = 0;
|ABRE #5;
|ABRE #6;
|SI progra_6  = 1; sw = 0; lininci = 1500; |BUCLE leefic0;  |FINSI;
|SI progra_7  = 1; sw = 0; lininci = 1800; |BUCLE leefic1;  |FINSI;
|SI progra_8  = 1; sw = 0; lininci = 2100; |BUCLE leefic2;  |FINSI;
|SI progra_9  = 1; sw = 0; lininci = 2400; |BUCLE leefic3;  |FINSI;
|SI progra_10 = 1; sw = 0; lininci = 2700; |BUCLE leefic4;  |FINSI;
|SI progra_51 = 1; sw = 0; lininci = 8600; |BUCLE leefic55; |FINSI;
|CIERRA #5;
|CIERRA #6;
|FPRC;
