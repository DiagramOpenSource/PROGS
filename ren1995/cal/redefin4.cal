|FICHEROS;
    redefin3 #0;
    redefin4 #1;
    regrinfv #2;
|FIN;

|VARIABLES;
    opcion = 0;
    &sw_salida = 0;
    existe_reg = 0;
    camant = 0;
    descr_grup = "";
    flag_imp = "";
    lin_imp = 0;
    lin_cam = 0;
    lin_txt = 0:
    num_ope = 0;
    opera = "";
    guarda5 = 0;
|FIN;

|PROCESO consulta; |TIPO 7;
         opcion = (FEntrada / 100) ! 0;
         |SI opcion = 4;
             |PTEC 806;  ||  Escape.
         |SINO;
             |SI opcion = 1; |Y FSalida ! 7;
                 #1#3 = #1#3 + 9;
                 |PINTA #1#3;
             |FINSI;
             #1#0 = #0#0;  ||  Programa.
             #1#1 = #0#1;  ||  Informe.
             #1#2 = #0#2;  ||  Linea de lineas de definicion de grupos.
             #1#4 = #0#3;  ||  Codigo agrupacion.
         |FINSI;
|FPRC;

|PROCESO entra_campo; |TIPO 7;
         |ATRI R;
         |SI #1#4 = 0;
             |MENSA "0000Introduzca la linea de agrupacion que corresponda.";
         |SINO;
             |MENSA "0000F10 = Consulta de lineas de agrupacion.";
         |FINSI;
         |ATRI r;
|FPRC;

|PROCESO campo; |TIPO 0;
         guarda5 = #1#5;
         opcion = FEntrada $ 100;
         |SI FSalida = 18; |Y #1#4 > 0;
             |PUSHV 0501 2380;
             sw_salida = 0;
             |ENTLINEAL #1#2,2,4,20,1,inf,sup;
             |POPV;
             |SI sw_salida = 0;
                 |ERROR;
                 |ACABA;
             |SINO;
                 #1#5 = sw_salida;
                 |PINTA #1#5;
             |FINSI;
         |FINSI;
         |CAMPO_MODIFICA #1#8,1,"S";  ||  Flag de impresion.
         |SI #1#5 > 0;
             |SI #1#4 > 0;
                 |HAZ lee_linagr;
             |SINO;
                 |SI #1#5 < #1#2;
                     |HAZ lee_lingrp;
                     |SI existe_reg = 0;
                         |CAMPO_MODIFICA #1#8,1,"N";  ||  Flag de impresion.
                         #1#8 = "N";
                         |PINTA #1#8;
                     |FINSI;
                 |SINO;
                     |MENAV "0000La linea a definir el total tiene que ser menor que la del propio total.";
                     |HAZ entra_campo;
                     |ERROR;
                     |ACABA;
                 |FINSI;
             |FINSI;
             |CAMPO_MODIFICA #1#7,1,"S";
             |SI existe_reg ! 0;
                 |ERROR;
                 |ACABA;
             |FINSI;
             |SI opcion = 1;
                 #1#7 = #0#10;
                 |PINTA #1#7;
             |FINSI;
         |SINO;
             #1#7 = " ";
             |PINTA #1#7;
             |CAMPO_MODIFICA #1#7,1,"N";
             |DDEFECTO #2;
         |FINSI;
         |SI opcion = 1;|O Contenido ! guarda5;
             #1#6 = #2#4;  ||  Descripcion de linea.
             |PINTA #1#6;
         |FINSI;
|FPRC;

|PROCESO lee_linagr;  ||  Lee el campo de grupo.
         |ABRE #2;
         |DDEFECTO #2;
         #2#0 = #1#4;  ||  Grupo.
         #2#1 = #1#5;  ||  Linea.
         |LEE 001#2=;
         existe_reg = FSalida;
         |SI FSalida ! 0;
             |DDEFECTO #2;
             |MENAV "0000Linea de agrupacion Inexistente.";
             |HAZ entra_campo;
         |FINSI;
         |CIERRA #2;
|FPRC;

|PROCESO lee_lingrp;  ||  Lee la linea de grupo correspondiente.
         descr_grup = #0#4;
         flag_imp   = #0#5;
         lin_imp    = #0#6;
         lin_cam    = #0#7;
         lin_txt    = #0#8;
         num_ope    = #0#9;
         opera      = #0#10;
         |DDEFECTO #0;
         #0#0 = #1#0;  ||  Programa.
         #0#1 = #1#1;  ||  Informe.
         #0#2 = #1#5;  ||  Linea de grupo.
         |LEE 001#0=;
         existe_reg = FSalida;
         |SI FSalida ! 0;
             |MENAV "0000Linea Inexistente.";
             |HAZ entra_campo;
         |SINO;
             #2#4 = #0#4;  ||  Descripcion.
         |FINSI;
         #0#0 = #1#0;  ||  Programa.
         #0#1 = #1#1;  ||  Informe.
         #0#2 = #1#2;  ||  Linea de grupo.
         |LEE 101#0=;
         #0#3 = #1#4;  ||  Grupo.
         #0#4 = descr_grup;
         #0#5 = flag_imp;
         #0#6 = lin_imp;
         #0#7 = lin_cam;
         #0#8 = lin_txt;
         #0#9 = num_ope;
         #0#10 = opera;
|FPRC;

|PROCESO inf;
    #2#0 = #1#4;
    #2#1 = 1;
|FPRC;

|PROCESO sup;
    #2#0 = #1#4;
    #2#1 = 999;
|FPRC;

|PROCESO contalin; |TIPO 2;
         opcion = (FEntrada / 100) ! 0;
         |SI #0#8 = "S"; #0#6 = #0#6 +. 1; |FINSI;  ||  Lineas a Imprimir.
         |SI #1#5 > 0;
             #0#7 = #0#7 +. 1;  ||  Lineas Campo.
             |SI #1#7 ! " ";
                 #0#9 = #0#9 +. 1;   ||  Numero de operaciones.
                 |SI #0#9 = 0; #0#10 = " ";  |FINSI;  ||  No operacion.
                 |SI #0#9 = 1; #0#10 = #1#7; |FINSI;  ||  Operacion.
             |FINSI;
         |SINO;
             #0#8 = #0#8 +. 1;  ||  Lineas Texto.
         |FINSI;
|FPRC;
