|FICHEROS;
    rededu07 #0;
    rededu08 #1;
    rededu09 #2;
    rededu10 #3;
    reincide #5;
    retotren #6;
|FIN;

|INCLUYE i_varcal;

|| **************************************************************************
||                   PROCESO DE LECTURA DE LOS DISTINTOS FICHEROS
|| **************************************************************************

|PROCESO fichero_06_0;         || Trata Enfermedad, Seguros, Alquileres y guarderia
alfa1 = "ENFERMEDAD, SEGUROS, ALQUILERES Y GUARDERIA ------------------------";
tipod     = #0#2;
tipore    = #0#9;
descri    = #0#5;
rendi     = #0#8;
linea     = #0#1;
perceptor = #0#3;
numero1   = #0#10;
numero2   = #0#11;
numero3   = #0#12;
numero4   = #0#13;
numero5   = #0#14;
numero6   = #0#15;
sw_fich   = 0;
empreac   = #0#0;

|SI #0#9 = "X"; |O #0#9 = "P"; |O #0#9 = "R";
    |HAZ incide_06;
|FINSI;
|SI #0#9 = "A"; |O #0#9 = "R"; |HAZ tipode_06; |FINSI;
|FPRC;

|PROCESO fichero_06_1;         || Trata Impuestos Municipales
alfa1 = "IMPUESTOS MUNICIPALES ----------------------------------------------";
tipod     = #1#2;
tipore    = #1#8;
descri    = #1#4;
rendi     = #1#7;
linea     = #1#1;
perceptor = #1#3;
numero1   = #1#9;
numero2   = #1#10;
numero3   = #1#11;
numero4   = #1#12;
numero5   = #1#13;
numero6   = #1#14;
sw_fich   = 1;
empreac   = #1#0;

|SI #1#8 = "X"; |O #1#8 = "P"; |O #1#8 = "R";
    |HAZ incide_06;
|FINSI;
|SI #1#8 = "A"; |O #1#8 = "R"; |HAZ tipode_06; |FINSI;
|FPRC;

|PROCESO fichero_06_2;   || Trata Ceuta y Melilla , Doble imposicion Internacional
alfa1 = "CEUTA Y MELILLA / DOBLE IMPOSICION INTERNACIONAL -------------------";
tipod     = #2#2;
tipore    = #2#7;
descri    = #2#5;
rendi     = #2#6;
linea     = #2#1;
perceptor = #2#3;
numero1   = #2#8;
numero2   = #2#9;
numero3   = #2#10;
numero4   = #2#11;
numero5   = #2#12;
numero6   = #2#13;
sw_fich   = 2;
empreac   = #2#0;

|SI #2#7 = "X"; |O #2#7 = "P"; |O #2#7 = "R";
    |HAZ incide_06;
|FINSI;
|SI #2#7 = "A"; |O #2#7 = "R"; |HAZ tipode_06; |FINSI;
|FPRC;

|PROCESO fichero_06_3;         || Trata Incrementos/Disminuciones Cta.Vivienda
alfa1 = "INCREMENTOS / DISMINUCIONES CUENTA VIVIENDA -------------------------";
tipod     = #3#2;
tipore    = #3#8;
descri    = #3#5;
rendi     = #3#6;
linea     = #3#1;
perceptor = #3#3;
numero1   = #3#9;
numero2   = #3#10;
numero3   = #3#11;
numero4   = #3#12;
numero5   = #3#13;
numero6   = #3#14;
sw_fich   = 3;
empreac   = #3#0;

|SI #3#8 = "X"; |O #3#8 = "P"; |O #3#8 = "R";
    |HAZ incide_06;
|FINSI;
|SI #3#8 = "A"; |O #3#8 = "R"; |HAZ tipode_06; |FINSI;
|FPRC;

|| **************************************************************************
                        TRATAMIENTO DE LA LIQUIDACION
|| **************************************************************************

|PROCESO tipode_06;
  |SI tipod = "G";                || Si es Ganancial
      coefi1 = 50;  tipod  = "T"; |HAZ leeliq_06;
      coefi1 = 50;  tipod  = "C"; |HAZ leeliq_06;
      coefi1 = 100; tipod  = "A"; |HAZ leeliq_06;
      |ACABA;
  |FINSI;
  |SI tipod ! "V";           || SI ES TITULAR O CONYUGE;
      coefi1 = 100; |HAZ leeliq_06;
      coefi1 = 100; tipod  =  "A"; |HAZ leeliq_06;
      |ACABA;
  |FINSI;
                || Si es Varios
  |SI numero1 ! 0; coefi1 = numero1; tipod = "T"; |HAZ leeliq_06; |FINSI;
  |SI numero2 ! 0; coefi1 = numero2; tipod = "C"; |HAZ leeliq_06; |FINSI;
  |SI numero3 ! 0; coefi1 = numero3; tipod = "1"; |HAZ leeliq_06; |FINSI;
  |SI numero4 ! 0; coefi1 = numero4; tipod = "2"; |HAZ leeliq_06; |FINSI;
  |SI numero5 ! 0; coefi1 = numero5; tipod = "3"; |HAZ leeliq_06; |FINSI;
  |SI numero6 ! 0; coefi1 = numero6; tipod = "4"; |HAZ leeliq_06; |FINSI;
  coefi1 = numero1 + numero2 + numero3 + numero4 + numero5 + numero6;
  tipod = "A"; |HAZ leeliq_06;
|FPRC;

|PROCESO leeliq_06;                 || Lee la Liquidacion
#6#0 = empreac;
#6#141 = tipod;
|LIBERA #6; |LEE 110#6=;
FEstado = FSalida;
|SI FSalida ! 0;
   |DDEFECTO #6;
   #6#000 = empreac;
   #6#141 = tipod;
|FINSI;
|SI sw_fich = 0; |HAZ grabafi_06_0; |FINSI;
|SI sw_fich = 1; |HAZ grabafi_06_1; |FINSI;
|SI sw_fich = 2; |HAZ grabafi_06_2; |FINSI;
|SI sw_fich = 3; |HAZ grabafi_06_3; |FINSI;
|SI FEstado = 0; |GRABA 121#6a; |SINO; |GRABA 121#6n; |FINSI;
|FPRC;

|PROCESO grabafi_06_0;
|SI #0#4 = "E"; #6#91 = #6#91 + ((#0#7 + #0#8) % coefi1); |FINSI;
|SI #0#4 = "E"; #6#164 = #6#164 + (#0#6 % coefi1); |FINSI;
|SI #0#4 = "A"; #6#92 = #6#92 + ((#0#7 + #0#8) % coefi1); |FINSI;
|SI #0#4 = "A"; #6#172 = #6#172 + (#0#6 % coefi1);  |FINSI;
|SI #0#4 = "G"; #6#93 = #6#93 + ((#0#7 + #0#8) % coefi1); |FINSI;
|SI #0#4 = "G"; #6#173 = #6#173 + (#0#6 % coefi1);  |FINSI;
|SI #0#4 = "S"; #6#94 = #6#94 + ((#0#7 + #0#8) % coefi1); |FINSI;
|SI #0#4 = "S"; #6#165 = #6#165 + (#0#6 % coefi1);  |FINSI;
|FPRC;

|PROCESO grabafi_06_1;
  #6#106 = #6#106 + (#1#006 % coefi1);
|FPRC;

|PROCESO grabafi_06_2;
  |SI #2#004 = "C"; #6#108 = #6#108 + (#2#006 % coefi1); |FINSI;
  |SI #2#004 = "D"; #6#122 = #6#122 + (#2#006 % coefi1); |FINSI;
  |SI #2#004 = "I"; #6#212 = #6#212 + (#2#006 % coefi1); |FINSI;
|FPRC;

|PROCESO grabafi_06_3;
  |SI #3#4 = "D"; #6#167 = #6#167 + (#3#6 % coefi1); |FINSI;
  |SI #3#4 = "D"; #6#96 = #6#96 + ((#3#6 % coefi1) * .15); |FINSI;
  |SI #3#004 = "I"; #6#123 = #6#123 + (#3#6 % coefi1); |FINSI;
  |SI #3#004 = "I"; #6#124 = #6#124 + (#3#7 % coefi1); |FINSI;
|FPRC;


|| **************************************************************************
||                            DILIGENCIAS
|| **************************************************************************

|PROCESO incide_06;
|SI incisino = "S";
   |SI sw = 0; |HAZ grabaci_06; sw = 1; |FINSI;
   linea = "00" + linea;
   linea = linea % -102;

   rendi = "          " + rendi;
   rendi = rendi % -110;

   |QBF descri;
   descri = descri + blanco;
   descri = descri % 130;

  alfa1 = "NO CALCULO ->  " + linea + " " + descri + "    " + rendi;

  |SI tipore = "R";
      alfa1 = "RENTA ------>  " + linea + " " + descri + "    " + rendi;
  |FINSI;
  |SI tipore = "P";
       alfa1 = "PATRIMONIO ->  " + linea + " " + descri + "    " + rendi;
  |FINSI;
  |HAZ grabaci_06;
|FINSI;
|FPRC;

|PROCESO grabaci_06;
swcalcu = 1;
lininci = lininci + 5;
#5#0 = empreac;
#5#1 = lininci;
#5#2 = alfa1;
#5#3 = "S";
|GRABA 020#5n;
|LIBERA #5;
|FPRC;


|| **************************************************************************
||                             PROCESO BUCLES
|| **************************************************************************

|DEFBUCLE leefic0;   || Bucle Transparencias Fiscal
#0#1;
;
empresa, 01;
emprefi, 99;
e;
NULL, fichero_06_0;
|FIN;

|DEFBUCLE leefic1;   || Bucle Profesional Directa
#1#1;
;
empresa, 01;
emprefi, 99;
e;
NULL, fichero_06_1;
|FIN;

|DEFBUCLE leefic2;    || Bucle Profesional Coeficiente
#2#1;
;
empresa, 01;
emprefi, 99;
e;
NULL, fichero_06_2;
|FIN;

|DEFBUCLE leefic3;    || Bucle Empresarial Directa
#3#1;
;
empresa, 01;
emprefi, 99;
e;
NULL, fichero_06_3;
|FIN;


|| **************************************************************************
                              INICIO
|| **************************************************************************

|PROCESO recalcu6;
|ABRE #5;
|ABRE #6;
|SI progra_26 = 1; sw = 0; lininci = 7500; |BUCLE leefic0; |FINSI;
|SI progra_27 = 1; sw = 0; lininci = 7800; |BUCLE leefic1; |FINSI;
|SI progra_28 = 1; sw = 0; lininci = 8100; |BUCLE leefic2; |FINSI;
|SI progra_29 = 1; sw = 0; lininci = 8300; |BUCLE leefic3; |FINSI;
|CIERRA #5;
|CIERRA #6;
|FPRC;
