|FICHEROS;
   finz0003 #0;

   finw0003 #10;
   finw0004 #11;

   finm0016 #20;
   finm0017 #21;
   finm0018 #22;
|FIN;

|VARIABLES;
   aAlfa   = "";
   aAlfa1  = "";
   aAlfa2  = "";
   aAlfa3  = "";
   aTamano = "";
   aTamanow3 = "";
   aTamanow4 = "";
   aOrden    = "";
   aOrdenw3  = "";
   aOrdenw4  = "";
   aFichero  = "";
   aEsc1     = "";
   aEsc2     = "";
   aRetu     = "";
   aTecla    = "";

   nSw     = 0;
   nLinea  = 0;
   nRango  = 0;
   nPos1   = 0;
   nPos2   = 0;
   nCont   = 0;
   nCalc   = 0;
   nCalc1  = 0;
   nCalc2  = 0;
   nColAc  = 0;
   nColPa  = 0;
   nHandle = 0;
   nSwGrid = 0;

   nPant  = 0;
   nGrid1 = 0;
   nGrid2 = 0;

{-1}PuntGrid = 0;
   GridId     = 0;
   GridCodigo = 0;
   GridCadena = "";
|FIN;

|PROCESO Tipo12; |TIPO 12;
|FPRC;

|PROCESO Final;
   |PTEC 801;
|FPRC;

|PROCESO Tipo80; |TIPO 80;
   FSalida = 3299;
|FPRC;

|PROCESO EvtoGrid1;
|FPRC;

|PROCESO EvtoGrid2;
|FPRC;

|PROCESO TamanoColumnas;
   aAlfa2 = "";
   aAlfa = "c:/documentos/";              |RMKDIR aAlfa;
   aAlfa = "c:/documentos/financia/";     |RMKDIR aAlfa;
   aAlfa = "c:/documentos/financia/tmp/"; |RMKDIR aAlfa;
   aAlfa = aAlfa + "fichero.reg";
   |XABRE "WC", aAlfa, nHandle;
   |SI FSalida ] 0;
      aAlfa  = "REGEDIT4" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa  = &13 + &10;              |XGRABA nHandle, aAlfa;
      aAlfa2 = "[-HKEY_CURRENT_USER\Software\Diagram Software S.L.\Diagramx\GridDefaultTaman";
      |DDEF aAlfa1; |QBF aAlfa1; aAlfa1 = " " + aAlfa1;
      aAlfa1 = aAlfa1 - "/";
      |PARA; |SI FSalida ! 0; |HACIENDO;
         nCalc  = ((FSalida / 100) ! 0) + 99;
         nCalc1 = FSalida + 98;
         aAlfa1 = (aAlfa1 % nCalc) + "_" + (aAlfa1 % nCalc1);
         aAlfa1 = aAlfa1 - "/";
      |SIGUE;
      aAlfa = &34 + aAlfa1 + aFichero + &34 + "=" + &34;
      aAlfa3 = aAlfa;
      aAlfa1 = aAlfa + aTamano + &34 + &13 + &10;

      aAlfa  = "[HKEY_CURRENT_USER\Software\Diagram Software S.L.\Diagramx\GridDefaultOrder]" + &13 + &10;
      |XGRABA nHandle, aAlfa;
      ||aAlfa3 = aAlfa3 + "000001002003004005006007008009010011012013014015016017018019020021022023024025026027028029030" + &34 + &13 + &10;
      aAlfa3 = aAlfa3 + aOrden + &34 + &13 + &10;
      |XGRABA nHandle, aAlfa3;

      aAlfa  = "[HKEY_CURRENT_USER\Software\Diagram Software S.L.\Diagramx\GridDefaultTaman]" + &13 + &10;
      |XGRABA nHandle, aAlfa;
      |XGRABA nHandle, aAlfa1;
   |FINSI;
   |XCIERRA nHandle;

   aAlfa  = "cmd " + &34 + "/c regedit /C /s c:/documentos/financia/tmp/fichero.reg" + &34;
   |RSYSTEM aAlfa;
|FPRC;

|PROCESO Periodos;
   nCalc2 = #finm0016#1 + 2;

   |SI #finm0016#3 = "A"; |O #finm0016#3 = "T";
      |SI nSw = 1;
         |C_M #finw0003#nCalc2#, 1, "S"; |C_V #finw0003#nCalc2#, 1, "S";

         aAlfa = nColAc; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
         aOrdenw3 = aOrdenw3 + aAlfa; nColAc = nColAc + 1;

         aAlfa = #finm0016#2; |QBF aAlfa;
         aAlfa = aAlfa % 0; nCalc = aAlfa;
         |SI nCalc > 20;
            nCalc = nCalc * 6;
         |SINO;
            nCalc = nCalc * 7;
         |FINSI;
         aAlfa = nCalc; aAlfa = ("0000" + aAlfa) % -104;
         aTamanow3 = aTamanow3 + aAlfa;
      |FINSI;

      |SI nSw = 2;
         GridId     = nGrid1;
         GridCodigo = 0;
         aAlfa      = #finm0016#2;
         GridCadena = "COLN:" + nColAc + "," + aAlfa; nColAc = nColAc + 1;
         |ESPECIFICA "COMMANDCONTROL", PuntGrid;
      |FINSI;
   |FINSI;

   |SI #finm0016#3 = "P"; |O #finm0016#3 = "T";
      |SI nSw = 1;
         |C_M #finw0004#nCalc2#, 1, "S"; |C_V #finw0004#nCalc2#, 1, "S";

         aAlfa = nColPa; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
         aOrdenw4 = aOrdenw4 + aAlfa; nColPa = nColPa + 1;

         aAlfa = #finm0016#2; |QBF aAlfa;
         aAlfa = aAlfa % 0; nCalc = aAlfa;
         nCalc = nCalc * 8; aAlfa = nCalc;
         aAlfa = ("0000" + aAlfa) % -104;
         aTamanow4 = aTamanow4 + aAlfa;
      |FINSI;

      |SI nSw = 2;
         GridId     = nGrid2;
         GridCodigo = 0;
         aAlfa      = #finm0016#2;
         GridCadena = "COLN:" + nColPa + "," + aAlfa; nColPa = nColPa + 1;
         |ESPECIFICA "COMMANDCONTROL", PuntGrid;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Periodos;
#finm0016#1;
;
#finz0003#2, 00;
#finz0003#2, 99;
;
NULL, Periodos;
|FIN;

|PROCESO ConceptosActivo;
   |DDEFECTO #finw0003;
   #finw0003#0 = nLinea; nLinea = nLinea + 1;
   #finw0003#1 = #finm0017#2;
   #finw0003#101 = #finm0017#1;
   |GRABA 020#finw0003.n;
|FPRC;

|DEFBUCLE ConceptosActivo;
#finm0017#1;
3;
#finz0003#2, 01, "A";
#finz0003#2, 99, "A";
;
NULL, ConceptosActivo;
|FIN;

|PROCESO ConceptosPasivo;
   |DDEFECTO #finw0004;
   #finw0004#0 = nLinea; nLinea = nLinea + 1;
   #finw0004#1 = #finm0017#2;
   #finw0004#101 = #finm0017#1;
   |GRABA 020#finw0004.n;
|FPRC;

|DEFBUCLE ConceptosPasivo;
#finm0017#1;
3;
#finz0003#2, 01, "P";
#finz0003#2, 99, "P";
;
NULL, ConceptosPasivo;
|FIN;

|PROCESO Activo;
   |PARA nCont = 2; |SI nCont < 100; |HACIENDO nCont = nCont + 1;
      |C_M #finw0003#nCont#,0,aAlfa;
      #finm0018#0 = #finz0003#0;
      #finm0018#1 = #finz0003#1;
      #finm0018#2 = #finz0003#2;
      #finm0018#3 = nCont - 2;
      #finm0018#4 = #finw0003#101;
      |LEE 101#finm0018.=;
      |SI aAlfa = "S";
         |SI FSalida ! 0;
            |DDEFECTO #finm0018;
            #finm0018#0 = #finz0003#0;
            #finm0018#1 = #finz0003#1;
            #finm0018#2 = #finz0003#2;
            #finm0018#3 = nCont - 2;
            #finm0018#4 = #finw0003#101;
            |GRABA 020#finm0018.b;
         |FINSI;
         #finm0018#5 = #finw0003#nCont#;
         |GRABA 020#finm0018.a;
      |SINO;
         |SI FSalida = 0;
            |BORRA 020#finm0018.a;
         |FINSI;
      |FINSI;
      |LIBERA #finm0018;
   |SIGUE;
|FPRC;

|DEFBUCLE Activo;
#finw0003#1;
;
INICIO;
FINAL;
;
NULL, Activo;
|FIN;

|PROCESO Pasivo;
   |PARA nCont = 2; |SI nCont < 100; |HACIENDO nCont = nCont + 1;
      |C_M #finw0004#nCont#,0,aAlfa;
      #finm0018#0 = #finz0003#0;
      #finm0018#1 = #finz0003#1;
      #finm0018#2 = #finz0003#2;
      #finm0018#3 = nCont - 2;
      #finm0018#4 = #finw0004#101;
      |LEE 101#finm0018.=;
      |SI aAlfa = "S";
         |SI FSalida ! 0;
            |DDEFECTO #finm0018;
            #finm0018#0 = #finz0003#0;
            #finm0018#1 = #finz0003#1;
            #finm0018#2 = #finz0003#2;
            #finm0018#3 = nCont - 2;
            #finm0018#4 = #finw0004#101;
            |GRABA 020#finm0018.b;
         |FINSI;
         #finm0018#5 = #finw0004#nCont#;
         |GRABA 020#finm0018.a;
      |SINO;
         |SI FSalida = 0;
            |BORRA 020#finm0018.a;
         |FINSI;
      |FINSI;
      |LIBERA #finm0018;
   |SIGUE;
|FPRC;

|DEFBUCLE Pasivo;
#finw0004#1;
;
INICIO;
FINAL;
;
NULL, Pasivo;
|FIN;

|PROCESO VuelcaDatos;
   |ABRE #finm0018;
   |BUCLE Activo; |BUCLE Pasivo;
   |CIERRA #finm0018;
|FPRC;

|PROCESO RecogeActPas;
   #finw0003#0 = 1;
   |LEE 000#finw0003.];
   |PARA; |SI FSalida = 0; |HACIENDO;
      |SI #finw0003#101 = #finm0018#4; |SAL; |FINSI;
      |LEE 000#finw0003.s;
   |SIGUE;

   |SI #finw0003#101 = #finm0018#4;
      nCalc = #finm0018#3 + 2;
      #finw0003#nCalc# = #finm0018#5;
      |GRABA 020#finw0003.a;
   |FINSI;

   #finw0004#0 = 1;
   |LEE 000#finw0004.];
   |PARA; |SI FSalida = 0; |HACIENDO;
      |SI #finw0004#101 = #finm0018#4; |SAL; |FINSI;
      |LEE 000#finw0004.s;
   |SIGUE;

   |SI #finw0004#101 = #finm0018#4;
      nCalc = #finm0018#3 + 2;
      #finw0004#nCalc# = #finm0018#5;
      |GRABA 020#finw0004.a;
   |FINSI;
|FPRC;

|DEFBUCLE RecogeActPas;
#finm0018#1;
;
#finz0003#0, #finz0003#1, #finz0003#2, 00, 00;
#finz0003#0, #finz0003#1, #finz0003#2, 99, 99;
;
NULL, RecogeActPas;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA "Asistente entrada porcentajes de previsión";

   |PINPA #0#0; nPant = 0;
   |PINDA #0#0;

   aAlfa = "p1" + Usuario; |NOME_DAT #finw0003#aAlfa#;
   aAlfa = "p2" + Usuario; |NOME_DAT #finw0004#aAlfa#;
   |DELINDEX #finw0003; |ABRE #finw0003;
   |DELINDEX #finw0004; |ABRE #finw0004;

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 1306; nPos2 = 2193;
   |LINEAL_SIMPLE #1#finw0003, nRango, nPos1, nPos2, NULL, NULL, EvtoGrid1;
   nGrid1 = FSalida;

   nPos1 = 2306; nPos2 = 3193;
   |LINEAL_SIMPLE #1#finw0004, nRango, nPos1, nPos2, NULL, NULL, EvtoGrid2;
   nGrid2 = FSalida;
   |PULSATECLA;

   nColAc = 2; nColPa = 2;
   nSw = 2; |BUCLE Periodos;
   |REFRESCACONTROL nGrid1; |REFRESCACONTROL nGrid2;

   |ENDATOS #1#0;
   |SI FSalida = 0;
      |DESTRUYECONTROL nGrid1; |DESTRUYECONTROL nGrid2;

      nColAc = 1; nColPa = 1;
      aTamanow3 = "0175"; aTamanow4 = "0175";
      aOrdenw3 = "000";   aOrdenw4 = "000";

      nSw = 1; |BUCLE Periodos;

      aFichero = "finw0003"; aTamano = aTamanow3; aOrden = aOrdenw3; |HAZ TamanoColumnas;
      aFichero = "finw0004"; aTamano = aTamanow4; aOrden = aOrdenw4; |HAZ TamanoColumnas;

      nLinea = 1; |BUCLE ConceptosActivo;
      nLinea = 1; |BUCLE ConceptosPasivo;
      |BUCLE RecogeActPas;

      nRango = 1 + 4 + 8 + 16 + 32;
      nPos1 = 1306; nPos2 = 2193;
      |LINEAL_SIMPLE #1#finw0003, nRango, nPos1, nPos2, NULL, NULL, EvtoGrid1;
      nGrid1 = FSalida;

      nPos1 = 2306; nPos2 = 3193;
      |LINEAL_SIMPLE #1#finw0004, nRango, nPos1, nPos2, NULL, NULL, EvtoGrid2;
      nGrid2 = FSalida;
      |PULSATECLA;

      nColAc = 2; nColPa = 2;
      nSw = 2; |BUCLE Periodos;

      |REFRESCACONTROL nGrid1; |REFRESCACONTROL nGrid2;

      aEsc1  = &255 + "806";
      aEsc2  = &255 + "807";
      aRetu  = &255 + "802";
      |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir";
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL; |FINSI;
         |SI aTecla = aEsc2; |SAL; |FINSI;
         |SI aTecla = aRetu; |SAL; |FINSI;
      |SIGUE;

      |HAZ VuelcaDatos;
   |FINSI;

   |CIERRA #finw0004; |DELINDEX #finw0004;
   |CIERRA #finw0003; |DELINDEX #finw0003;

   |DESTRUYECONTROL nGrid1;
   |DESTRUYECONTROL nGrid2;
|FPRO;
