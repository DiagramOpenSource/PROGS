|FICHEROS;
   asclient #0;
   agicontr #3;
   agifigen #4;
   asbancli #5;
   ascabmin #78; || Cabecera minutas.
   asquecla #333;
|FIN;

|VARIABLES;
   aAlfa   = "";
   aAlfa1  = "";
   aAlfa2  = "";
   aCadena = "";
   aChar   = "";
   swError = 0;
   i      = 0;
   nu1    = 0;
   nu2    = 0;
   alf1   = "";
   actual = "";
   alfa  = "";
   clave = "";
   mensa = "";
   nCalc = 0;
   con = 0;
   swmod = 0;
   nume1 = 0;
 nume2 = 0;
 lugar = 0;
 nifnum = 0;
 resto = 0;
 informe = "asclient";
 men1 = "    NO EXISTE INFORME.";
 men2 = "    NO EXISTE IMPRESORA.";

 men6 = "0000S Confirma el alta en Clientes General : ";
 men7 = "      D.N.I. del Cliente es distinto al D.N.I. del Cliente General";
 men8 = "      No existe Cliente General";
 aste = "";
 agi = "";
 agi1 = "";
 agi2 = "";
 longi = "";
 num   = 0;
 trabacod1 = "";
 trabacod2 = "";
 direc = "";
 numero = "";
 piso = "";

  vacio     = "";
  letra1 = "";
  letra2 = "";
  letra3 = "";
  letra4 = "";
  letra5  = "";
  letra6  = "";
  letra7  = "";
  letra8  = "";
  xx = "";
  xnumerica1 = 0;
  xnumerica2 = 0;
  xnumerica3 = 0;
  xnumerica4 = 0;
  xnumerica5 = 0;

   &ordena     = "Codigo."
   &que_progra = "asclient";
   &DCliente   = 0;
   &HCliente   = 0;

     aNifQbf1   = "";
     aNifQbf2   = "";

     &eaVarDni   = "";
     &enCalcCif  = 0;
     &eaCta      = "";
     &eaPais     = "";
     &eaIBAN     = "";
|FIN;

|PROCESO bajacli; |TIPO 1;
con = (FEntrada / 100) ! 0;

|SI aste  = "";  |HAZ tipo_8;  |FINSI;
|SI aste  = "*"; |ACABA;       |FINSI;
|SI con   ! 3;   |ACABA;       |FINSI;

|ABRE #4;
#4#0 = #0#0;
|LIBERA #4;
|LEE 110#4=;
|SI FSalida = 0;
    #4#17 = "N";
    |GRABA 020#4a;
|FINSI;
|LIBERA #4;
|CIERRA #4;
|FPRC;

|PROCESO modicli; |TIPO 3;
|SI con ! 2;    |ACABA; |FINSI;
|SI swmod ! 1;  |ACABA; |FINSI;

|ABRE #4;
#4#0 = #0#0;
|LEE 040#4=;
|SI FSalida = 0;
    |SI #0#8 ! #4#13;
         |MENAV men7;
    |FINSI;
|SINO;
    |MENAV men8;
|FINSI;
|CIERRA #4;
|FPRC;

|PROCESO altacli; |TIPO 0;
con   = (FEntrada / 100) ! 0;
swmod = 0;

|SI aste  = "";  |HAZ tipo_8; |FINSI;
|SI aste  = "*"; |ACABA;      |FINSI;

swmod = 1;

|SI con ! 1; |ACABA; |FINSI;

|ABRE #4;
#4#0 = #0#0;
|LIBERA #4;
|LEE 110#4=;
|SI FSalida = 0;                || Recoge variables del agicli
    #4#17 = "S";
    |GRABA 020#4a;                 || Graba el agicli
    |LIBERA #4;

    #0#1   = #4#1;   |PINTA #0#1;
    #0#2   = #4#2;   |PINTA #0#2;
    direc  = #4#4;  |QBF direc;
    numero = #4#5; |QBF numero;
    piso   = #4#7;   |QBF piso;
    #0#3   = direc + " " + numero + " " + piso;|PINTA #0#3;
    #0#4   = #4#9;   |PINTA #0#4;
    #0#5   = #4#10;  |PINTA #0#5;
    #0#6   = #4#11;  |PINTA #0#6;
    #0#7   = #4#12;  |PINTA #0#7;
    #0#8   = #4#13;  |PINTA #0#8;
    #0#9   = #4#14;  |PINTA #0#9;
    #0#10  = #4#15;  |PINTA #0#10;
    #0#53  = #4#79;  |PINTA #0#53;
    #0#11  = #4#80;  |PINTA #0#11;
    #0#13  = #4#81 + #4#82 + #4#83;    |PINTA #0#13;
    #0#14  = #4#84;  |PINTA #0#14;

    |ABRE #5;
    #5#0 = #4#79;
    |LEE 140#5=;
    |SI FSalida ! 0;
        #5#0 = #4#79;
        #5#1 = #4#80;
        #5#2 = "";
        #5#3 = #4#81 + #4#82;
        |GRABA 140#5n;
    |SINO;
        #0#12  = #5#2;  |PINTA #0#12;
    |FINSI;
    |CIERRA #5;


    |CONFI "2400SDesea dar de alta los conceptos : ";
    |SI FSalida = 0;
        DCliente = #0#0;
        HCliente = #0#0;
        |SUB_EJECUTA "aszp0003";
    |FINSI;
|SINO;
    |CONFI men6;
    |SI FSalida = 0;
        |PUSHV 0501 2380;
        |PINPA #0#4;
        |DDEFECTO #4;
        |PINDA #0#4;
        #4#0 = #0#0;
        |PINTA #4#0;
        |ENDATOS #1#4;
        |SI FSalida = 0;
            |POPV;
            |HAZ postal;
            #4#17 = "S";
            #4#40 = #48#0;
            |GRABA 020#4n;                 || Graba el agicli
            |LIBERA #4;
            #0#1  = #4#1;   |PINTA #0#1;
            #0#2  = #4#2;   |PINTA #0#2;
            direc = #4#4;  |QBF direc;
            numero = #4#5; |QBF numero;
            piso = #4#7;   |QBF piso;
            #0#3  = direc + " " + numero + " " + piso;|PINTA #0#3;
            #0#4  = #4#9;   |PINTA #0#4;
            #0#5  = #4#10;  |PINTA #0#5;
            #0#6  = #4#11;  |PINTA #0#6;
            #0#7  = #4#12;  |PINTA #0#7;
            #0#8  = #4#13;  |PINTA #0#8;
            #0#9  = #4#14;  |PINTA #0#9;
            #0#10 = #4#15;  |PINTA #0#10;
            #0#53  = #4#79;  |PINTA #0#53;
            #0#11  = #4#80;  |PINTA #0#11;
            #0#13  = #4#81 + #4#82 + #4#83;   |PINTA #0#13;
            #0#14  = #4#84;  |PINTA #0#14;

            |ABRE #5;
            #5#0 = #4#79;
            |LEE 140#5=;
            |SI FSalida ! 0;
                #5#0 = #4#79;
                #5#1 = #4#80;
                #5#2 = "";
                #5#3 = #4#81 + #4#82;
                |GRABA 140#5n;
            |SINO;
                #0#12  = #5#2;  |PINTA #0#12;
            |FINSI;
            |CIERRA #5;
        |SINO;
            |POPV;
            |ERROR;
        |FINSI;
    |FINSI;
|FINSI;
|LIBERA #4;
|CIERRA #4;
|FPRC;

|PROCESO coge_agicli; |TIPO 7;
|SI que_progra ! "asclient";
    |HAZ tipo_8;
    |HAZ altacli;
|FINSI;
|FPRC;

|PROCESO postal;
    #4#16 = "";
    trabacod1 = #4#9;
    trabacod1 = "00" + trabacod1;
    trabacod1 = trabacod1 % -102;
    trabacod2 = #4#10;
    trabacod2 = "000" + trabacod2;
    trabacod2 = trabacod2 % -103;
    #4#16 = trabacod1 + trabacod2;
|FPRC;

|PROCESO letranif;
     |SI FSalida = 9;
         eaVarDni   = #0Campo;
         enCalcCif  = 1;
         |HAZ CalculoDNI;
         #0Campo = eaVarDni;
         |PINTA #0Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO tipo_8; |TIPO 8;
|DBASS agi;
|PATH_DAT #3 agi;

|ABRE #3;
#3#0 = 1;
|LEE 040#3=;
|SI FSalida ! 0; aste = "*"; |CIERRA #3; |ACABA; |FINSI;
|CIERRA #3;

aste = #3#1;
|QBF aste;
|SI aste  = "*"; |ACABA; |FINSI;

agi1 = #3#8; |QBF agi1;

longi = agi1 % A0;
num   = longi;
num   = 100 + (num - 5);
longi = num;

agi2  = (agi1 % longi) + "pan/";

|PATH_DAT #4 agi1;
|PATH_PAN #4 agi2;
|FPRC;

||---------------------------------------------------------------------------
|PROCESO actu_cab;
     #78#10 = #0#15;     || Forma pago.
     #78#11 = #0#16;     || Banco.
     |GRABA 121#78a;
     |LIBERA #78;
|FPRC;

|DEFBUCLE lee_cab;
     #78#1;
     ;
     0,#0#0;
     9,#0#0;
     be;
     NULL,actu_cab;
|FIN;

|PROCESO actualiza; |TIPO 30;
     |SI con = 2;
          |BUCLE lee_cab;
     |FINSI;
|FPRC;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO clavecli; |TIPO 0;
                            || Proceso de entrada de clave.
|ABRE #333;
#333#0 = 1;
|LEE 101#333=;
|SI FSalida ! 0;
     |DDEFECTO #333;
     #333#0 = 1;
     #333#1 = "          ";
     |GRABA 020#333b;
|FINSI;
     |SI #333#1 = "          ";
          mensa = "Entre la CLAVE :";
          |HAZ Clavecli;
          clave = alfa;
          mensa = "Reentre la CLAVE :";
          |HAZ Clavecli;
          |SI alfa ! clave;
               |MENAV "0000Clave incorrecta";
               swError = 1;
          |SINO;
               #333#1 = clave;
               |GRABA 020#333a;
          |FINSI;
     |SINO;
          actual = #333#1; |QBF actual;
          mensa = "Entre la CLAVE :";
          |HAZ Clavecli;
          |SI alfa ! actual;
               |MENAV "0000Clave incorrecta...";
               swError = 1;
          |SINO;
               |CONFI "2400NModificar CLAVE (S/N).: ";
               |SI FSalida = 0;
                    mensa = "Entre la Nueva CLAVE : ";
                    |HAZ Clavecli;
                    clave = alfa;
                    mensa = "Reentre la CLAVE :";
                    |HAZ Clavecli;
                    |SI clave ! alfa;
                         |MENAV "0000Clave incorrecta, no se modifica...";
                         swError = 1;
                    |SINO;
                         #333#1 = clave;
                         |GRABA 020#333a;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |BLIN 4;
|LIBERA #333;
|CIERRA #333;
|FPRC;

|PROCESO Clavecli;
     |BLIN 24;
     |PINTA 2420, mensa;
     alfa = "";
     E_sup = 10;
     E_inf = "";
     alfa = 2444 ? -1;
     |BLIN 24;
     alf1 = alfa; |QBF alf1;
     |SI alf1 = ""; alfa = ""; |ACABA; |FINSI;

     nu2 = 0;
     |PARA i = 101; |SI i [ 1100; |HACIENDO i = i + 100;
          alf1 = alfa % i;
          nu1 = &alf1 * i;
          nu2 = nu2 + nu1;
     |SIGUE;
     alfa = nu2;
     |QBF alfa;
|FPRC;

|PROCESO boton; |TIPO 20;
     aAlfa1 = FSalida;
     |SI aAlfa1 = "OPCION";
         FSalida = "NOTAS";
         |ACABA;
     |FINSI;
     |SI #0#0 = 0; |ACABA; |FINSI;
     swError = 0;
     |HAZ clavecli;
     |SI swError = 1;
          |ACABA;
     |FINSI;
     |HAZ observacion;

|FPRC;

|PROCESO vernombre; |TIPO 0;
     aAlfa = #0#2;
     |QBF aAlfa;
     |SI aAlfa = "";
          #0#2 = #0#1;
          |PINTA #0#2;
     |FINSI;
|FPRC;

|PROCESO MCtaCli;
     eaCta = #0Campo;
     |HAZ MFiltraPtos;
     #0Campo = eaCta; |PINTA #0Campo;
|FPRC;

|PROCESO TrasPago;
   |ATRI I;
   |SI #asclient#67 = "R";
      |PINTA 1165, "Recurrente";
   |SINO;
      |PINTA 1165, "Unico     ";
   |FINSI;
   |ATRI N;
|FPRC;

|PROCESO Tipo7IBAN_Fclient;  |TIPO 7;
     aAlfa = #asclient#59;   |QBF aAlfa;

     |SI aAlfa ! "";  |ACABA;  |FINSI;

     eaCta = #asclient#13;  |QBF eaCta;
     eaCta = eaCta + #asclient#14;

     eaPais = #asclient#68;
     |HAZ CalcuIBAN;

     #asclient#59 = eaIBAN; |PINTA #asclient#59;

|FPRC;

|PROCESO Tipo0IBAN_Fclient;  |TIPO 0;
     eaCta = #asclient#13;  |QBF eaCta;
     eaCta = eaCta + #asclient#14;

     eaPais = #asclient#68;
     |HAZ CheqIBAN;

     aAlfa = #asclient#59;    |QBF aAlfa;
     |SI aAlfa ! eaIBAN;
         |CONFI "0000SEl codigo IBAN puede ser erroneo, quiere calcularlo.";
         |SI FSalida = 0;
             #asclient#59 = eaIBAN;
             |PINTA #asclient#59;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;
