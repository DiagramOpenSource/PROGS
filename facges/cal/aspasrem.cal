|FICHEROS;
   aspasrem #0;
   ashisrec #1;
   ascabrem #2;
   aslinrem #3;
   asbancos #4;
   asclient #5;
   asparcia #6;
   ashismic #90;
   asw00005 #99;
|FIN

|VARIABLES;
    men1       = "    YA EXISTE NUMERO DE REMESA    ";
    men2       = "    NO EXISTE EL REGISTRO DEL BANCO  ";
    men3       = "    NO EXISTE EL REGISTRO DEL CLIENTE ";
    importe    = 0;
    nombanc    = "";
    mes        = "";
    mes_num    = 0;
    campo      = 0;
    linea      = 0;
    he_grabado = 0;
    mas_uno    = 0;
     fFech = @;
     qFech = "";
     dFech = "";
     hFech = "";
|FIN;

|INCLUYE i_ficher;

|PROCESO clave1;|TIPO 0;
|ABRE #2;
#2#0 = #0#0;
|LEE 040#2=;
|SI FSalida = 0;
    |MENAV men1;
    |ERROR;
|FINSI;
|CIERRA #2;
|FPRC;

|PROCESO clave2;|TIPO 0;
|ABRE #4;
#4#0 = #0#1;
|LEE 040#4=;
|SI FSalida ! 0;
    |MENAV men2;
    |ERROR;
|FINSI;
nombanc = #4#1;
|CIERRA #4;
|FPRC;

|PROCESO graba_ind;
#99#10 = #1#6 - #1#9;
|SI #99#10 = 0; |ACABA; |FINSI;

|DDEFECTO #99;
#5#0 = #1#3;
|LEE 040#5=;
|SI FSalida ! 0; |DDEFECTO #5; |FINSI;

#4#0 = #1#7;
|LEE 040#4=;
|SI FSalida ! 0; |DDEFECTO #4; |FINSI;

linea  = linea + 1;
#99#0  = linea;
#99#1  = #1#0;
#99#2  = #1#1;
#99#3  = #1#3;
#99#4  = #5#2;
#99#5  = #1#7;
#99#6  = #4#1;
#99#7  = #1#2;
#99#8  = #1#5;
#99#9  = #1#6;
#99#10 = #1#6 - #1#9;

#99#11 = #0#13;
|GRABA 040#99n;
|FPRC;

|DEFBUCLE ashisrec;
#1#1;
2, 5, 7;
#0#3, #0#5, #0#7, #0#9,  #0#11;
#0#4, #0#6, #0#8, #0#10, #0#12;
;
NULL, graba_ind;
|FIN;

|PROCESO cobro;
mas_uno = 0;
|ET mas_uno;
    mas_uno = mas_uno + 1;
    #6#0 = #1#0;
    #6#1 = #1#1;
    #6#2 = mas_uno;
    |LIBERA #6;
    |LEE 140#6=;
    |SI FSalida = 0; |VETE mas_uno; |FINSI;
    |DDEFECTO #6;
    #6#0  = #1#0;
    #6#1  = #1#1;
    #6#2  = mas_uno;
    #6#3  = #0#2;
    #6#4  = #1#5;
    #6#5  = #1#6;
    #6#6  = #1#9;
    #6#7  = #1#6 - #1#9;
    #6#8  = #99#10;
    #6#9  = #1#3;
    #6#13 = #0#14;
    #6#14 = #3#0;
    #6#15 = #3#1;
    |GRABA 140#6n;
|FPRC;

|PROCESO pase;
#5#0 = #99#3;
|LEE 040#5=;
|SI FSalida ! 0; |DDEFECTO #5; |FINSI;

#1#0 = #99#1;
#1#1 = #99#2;
|LIBERA #1;
|LEE 140#1=;
|SI FSalida ! 0; |ACABA; |FINSI;

he_grabado = 1;
#3#0    = #0#0;
#3#1    = #3#1 + 1
#3#2    = #1#0;
#3#3    = #1#1;
#3#4    = #1#3;
#3#5    = #5#2;
#3#6    = #5#6;
||#1#15   = #1#15 + #99#10;|| linea anes de modificar por jose
#1#15   =  #99#10;
#3#7    = #1#15;
#3#8    = #1#2;
#3#9    = #1#5;
importe = importe + #1#15;
|GRABA 040#3n;
|LIBERA #3;

#1#8  = #0#2;
#1#9  = #1#9 + #1#15;
#1#10 = "S";
#1#12 = "R";
|GRABA 021#1a;
|LIBERA #1;

|ABRE #90;
#90#0 = #1#0;
#90#1 = #1#1;
|LIBERA #90;
|LEE 140#90=;
|SI FSalida = 0;
    #90#32 = #1#10;
    #90#33 = #1#12;
    |GRABA 140#90a;
|FINSI;
|CIERRA #90;

mes     = #90#29 % 402;
mes_num = mes;

#4#0 = #1#7;
|LIBERA #4;
|LEE 140#4=;
|SI FSalida = 0;
    #4#20 = #4#20 - #1#15;
    #4#22 = #4#22 - #1#15;
    campo = 7 + mes_num; #4campo = #4campo - #1#15;
    |GRABA 140#4a;
|FINSI;

#4#0 = #0#1;
|LIBERA #4;
|LEE 140#4=;
|SI FSalida = 0;
    #4#20 = #4#20 + #1#15;
    #4#22 = #4#22 + #1#15;
    campo = 7 + mes_num; #4campo = #4campo + #1#15;
    |GRABA 140#4a;
|FINSI;

|HAZ cobro;
|FPRC;

|DEFBUCLE asw00001;
#99#1;
11;
0000, "S";
9999, "S";
;
NULL, pase;
|FIN;

|RUTINA inferior;
#99#0 = 1;
|FRUT;

|RUTINA superior;
#99#0 = 999;
|FRUT;

|PROCESO proceso; |TIPO 3;
comienza = "05";
|HAZ fichero;
|NOME_DAT #99 fichero;

|ABRE #99; |CIERRA #99; |DELINDEX #99;

he_grabado = 0;
linea      = 0;

|ABRE #4;
|ABRE #5;
|ABRE #99;
|BUCLE ashisrec;
|CIERRA #99;

|SI linea = 0;
    |CIERRA #4;
    |CIERRA #5;
    |ABRE #99; |CIERRA #99; |DELINDEX #99;
    |ACABA;
|FINSI;

|ENTLINEAL #1#99, 1, 4, 20, 1, inferior, superior;
|CONFI "2400SDesea hacer la Remesa : ";
|SI FSalida ! 0;
    |CIERRA #4;
    |CIERRA #5;
    |ABRE #99; |CIERRA #99; |DELINDEX #99;
    |ACABA;
|FINSI;

|ABRE #1;
|ABRE #2;
|ABRE #3;
|ABRE #6;

|BUCLE asw00001;
|SI he_grabado = 1;
    #2#0 = #0#0;
    #2#1 = #0#1;
    #2#2 = nombanc;
    #2#3 = #0#2;
    #2#4 = importe;
    |GRABA 020#2n;
    |LIBERA #2;
|FINSI;

|CIERRA #1;
|CIERRA #2;
|CIERRA #3;
|CIERRA #4;
|CIERRA #5;
|CIERRA #6;
|ABRE #99; |CIERRA #99; |DELINDEX #99;
|FPRC;

|PROCESO funcion1; |TIPO 11;
|SI FSalida ! 9; |ACABA; |FINSI;

|LIBERA #99;
|LEE 140#99=;

|SI #99#11 = "S"; #99#11 = "N"; |SINO; #99#11 = "S"; |FINSI;
|PINTA #99#11;
|GRABA 140#99a;
|PTEC 809;
|FPRC;

||---------------------------------------------------------------------------

|PROCESO lee_ultimo; |TIPO 7;
     |ABRE #2;
     |LEE 000#2u;
     |SI FSalida = 0;
          #0#0 = #2#0 + 1;
     |SINO;
          |DDEFECTO #0;
     |FINSI;
     |CIERRA #2;
|FPRC;
|PROCESO sacaano; |TIPO 7;
     fFech = ~;
     qFech = fFech % -104;
     dFech = "01.01." + qFech;
     hFech = "31.12." + qFech;
     #0#7  = dFech;
     #0#8  = hFech;
     #0#9  = dFech;
     #0#10 = hFech;
     |PINTA #0#7;
     |PINTA #0#8;
     |PINTA #0#9;
     |PINTA #0#10;
|FPRC;
