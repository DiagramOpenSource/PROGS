|FICHEROS;
     aszp0002 #0;
     ashismic #1;
     ashismil #2;
     ashisfac #3;
     ashisrec #4;
     ashiscon #5;
     asparcia #6;
     aslinrem #7;
     asw00008 #99,MANTE;
|FIN;

|VARIABLES;
     NumeroFactura = 0;
     FacturaAnte   = 0;
     TeclaFuncion  = 0;
     SwBucle       = 0;
|FIN;

|INCLUYE i_ficher

|PROCESO MiraFactura;
|ET NumeroFactura;
    NumeroFactura = NumeroFactura + 1;
    #3#0 = #0#3;
    #3#1 = NumeroFactura
    |LEE 040#3=;
    |SI FSalida = 0; |VETE NumeroFactura; |FINSI;
|FPRC;

|PROCESO GrabaIndexado;
|HAZ MiraFactura;

#99#0 = #1#0;
#99#1 = #1#1;
#99#2 = #1#3;
#99#3 = #1#5;
#99#4 = #1#29;
#99#5 = #0#3;
#99#6 = NumeroFactura;
#99#7 = "S";
|GRABA 040#99n;
|FPRC;

|DEFBUCLE ashismic;
#1#1;
;
#0#0, #0#1;
#0#0, #0#2;
;
NULL, GrabaIndexado;
|FIN;

|RUTINA ClaveBaja;
#99#0 = #0#0;
#99#1 = #0#1;
|FRUT;

|RUTINA ClaveAlta;
#99#0 = #0#0;
#99#1 = #0#2;
|FRUT;

|PROCESO ashismil;
#2#0 = #99#5;
#2#1 = #99#6;
|GRABA 140#2n;
|LIBERA #2;
|FPRC;

|PROCESO CambiaConceptos;
|SI SwBucle = 0;
    #5#0 = #99#5;
    #5#1 = #99#6;
    |GRABA 140#5n;

    |LIBERA #5;
    #5#0 = #99#0;
    #5#1 = #99#1;
    |LEE 140#5=;
|SINO;
    |BORRA 140#5a;
    |LIBERA #5;
|FINSI;
|FPRC;

|DEFBUCLE ashiscon;
#5#1;
;
#99#0, #99#1, 000;
#99#0, #99#1, 999;
be;
NULL, CambiaConceptos;
|FIN;

|PROCESO CambiaCobros;
|SI SwBucle = 0;
    #6#0 = #99#5;
    #6#1 = #99#6;
    |GRABA 140#6n;

    |LIBERA #6;
    #6#0 = #99#0;
    #6#1 = #99#1;
    |LEE 140#6=;
|SINO;
    |BORRA 140#6a;
    |LIBERA #6;
|FINSI;
|FPRC;

|DEFBUCLE asparcia;
#6#1;
;
#99#0, #99#1, 000;
#99#0, #99#1, 999;
be;
NULL, CambiaCobros;
|FIN;

|PROCESO CambiaRemesa;
#7#2 = #99#5;
#7#3 = #99#6;
|GRABA 140#7a;
|LIBERA #7;
|FPRC;

|DEFBUCLE aslinrem;
#7#1;
2, 3;
000000, 000, #99#0, #99#1;
999999, 999, #99#0, #99#1;
;
NULL, Cambia Remesa;
|FIN;

|PROCESO ACambiar;
#1#0 = #99#0;
#1#1 = #99#1;
|LEE 040#1=;
|SI FSalida = 0;
    |BUCLELIN 0ashismil#1;
    #1#0 = #99#5;
    #1#1 = #99#6;
    |GRABA 040#1n;
|FINSI;

#1#0 = #99#0; #1#1 = #99#1; |BORRA 140#1c; |LIBERA #1;

#3#0 = #99#0;
#3#1 = #99#1;
|LEE 040#3=;
|SI FSalida = 0;
    #3#0 = #99#5;
    #3#1 = #99#6;
    |GRABA 040#3n;
|FINSI;

#3#0 = #99#0; #3#1 = #99#1; |BORRA 140#3c; |LIBERA #3;

#4#0 = #99#0;
#4#1 = #99#1;
|LEE 040#4=;
|SI FSalida = 0;
    #4#0 = #99#5;
    #4#1 = #99#6;
    |GRABA 040#4n;
|FINSI;

#4#0 = #99#0; #4#1 = #99#1; |BORRA 140#4c; |LIBERA #4;

SwBucle = 0; |BUCLE ashiscon;
SwBucle = 0; |BUCLE asparcia;
|BUCLE aslinrem;

SwBucle = 1; |BUCLE ashiscon;
SwBucle = 1; |BUCLE asparcia;
|FPRC;

|DEFBUCLE asw00008;
#99#1;
7;
#0#0, #0#1, "S";
#0#0, #0#2, "S";
;
NULL, ACambiar;
|FIN;

|PROCESO Tipo3; |TIPO 3;
comienza = "08"; |HAZ fichero;
|NOME_DAT #99 fichero;
|ABRE #99; |CIERRA #99; |DELINDEX #99;

|ABRE #3;
|ABRE #99;
NumeroFactura = #0#4 - 1;
|BUCLE ashismic;
|CIERRA #99;

FacturaAnte = #0#4 - 1;
|SI NumeroFactura = FacturaAnte; |CIERRA #3; |DELINDEX #99; |ACABA; |FINSI;

|PINPA #0#99;
|ENTLINEAL #1#99, 2, 4, 20, 0, ClaveBaja, ClaveAlta;
|CONFI "2400NConforme con lo seleccionado : ";
|SI FSalida ! 0; |CIERRA #3; |DELINDEX #99; |ACABA; |FINSI;

|ABRE #1;
|ABRE #3;
|ABRE #4;
|BUCLE asw00008;
|CIERRA #1;
|CIERRA #3;
|CIERRA #4;

|DELINDEX #99;
|FPRC;

|PROCESO TeclaFuncion; |TIPO 11;
TeclaFuncion = FSalida;

|LIBERA #99;
|LEE 140#99=;

|SI TeclaFuncion = 9;
    |SI #99#7 = "S"; #99#7 = "N"; |SINO; #99#7 = "S"; |FINSI;
|FINSI;

|SI TeclaFuncion = 10;
    |C_M #99#5, 1, "S"; |C_M #99#6, 1, "S";

    |ET PideOtro;
        |ENCAMPO #5#99;
        |ENCAMPO #6#99;

        #3#0 = #99#5;
        #3#1 = #99#6;
        |LEE 040#3=;
        |SI FSalida = 0;
            |MENAV "     FActura ya existente.";
            |VETE PideOtro;
        |FINSI;

        #99#7 = "S";
|FINSI;

|GRABA 140#99a;
|FPRC;
