|FICHEROS;
    ascuocab #0;
    asconcli #1;
    asconmen #2;
    ascuolin #3;
    asconcep #4;
|FIN;

|VARIABLES;
    cod        = 0;
    cta        = " ";
    FEvariable = 0;
    modo       = 0;
|FIN;

|CALCULO filtro;
cod     = #0Campo;
cta     = "00" + cod;
cta     = cta % -102;
#0Campo = cta;
|PINTA #0Campo;

|ABRE #4;
#4#0 = #0#3;
#4#1 = #0#4;
|LEE 040#4=;
|SI FSalida ! 0; |DDEFECTO #4; |FINSI;
|CIERRA #4;

#0#5 = #4#2;  |PINTA #0#5;
|FCAL;

|CALCULO tipo;|TIPO 0;
|SI #0#2 = "M"; #0#4 = "01"; |FINSI;
|SI #0#2 = "T"; #0#4 = "03"; |FINSI;
|SI #0#2 = "S"; #0#4 = "06"; |FINSI;
|SI #0#2 = "A"; #0#4 = "12"; |FINSI;
|PINTA #0#4;
|FCAL;

|PROCESO ascuolin;
#0#6 = #0#6 + #3#7;
|FPRC;

|PROCESO lineas;
#0#6 = 0;
#0#7 = 0;

|BUCLELIN 0ascuolin#0;

|SI #0#2 = "M"; #0#7 = #0#6 / 12; |FINSI;
|SI #0#2 = "T"; #0#7 = #0#6 / 4;  |FINSI;
|SI #0#2 = "S"; #0#7 = #0#6 / 2;  |FINSI;
|SI #0#2 = "A"; #0#7 = #0#6 / 1;  |FINSI;
|GRABA 140#0a;
|FPRC;

|DEFBUCLE ascuocab;
#0#1;
;
00000;
99999;
be;
NULL, lineas;
|FIN;

|PROCESO recal_tot; |TIPO 0;
|SI FSalida ! 9; |ACABA; |FINSI;
|BUCLE ascuocab;
|FPRC;

|PROCESO recalcu; |TIPO 3;
|CONFI "2400NDesea recalcular los importes de la cabecera : ";
|SI FSalida ! 0; |ACABA; |FINSI;
#0#6 = 0;
#0#7 = 0;

|BUCLELIN 0ascuolin#0;

|SI #0#2 = "M"; #0#7 = #0#6 / 12; |FINSI;
|SI #0#2 = "T"; #0#7 = #0#6 / 4;  |FINSI;
|SI #0#2 = "S"; #0#7 = #0#6 / 2;  |FINSI;
|SI #0#2 = "A"; #0#7 = #0#6 / 1;  |FINSI;

|PINTA #0#6;
|PINTA #0#7;
|FPRC;

|CALCULO final;|TIPO 30;
|ABRE #4;
#4#0 = #0#3;
#4#1 = #0#4;
|LEE 040#4=;
|SI FSalida ! 0; |DDEFECTO #4; |FINSI;
|CIERRA #4;

|ABRE #1;    ||Conceptos Clientes;
|ABRE #2;    ||Conceptos Variables;
#2#0 = #0#3;
#2#1 = #0#4;
|LEE 040#2=;
FEvariable = FSalida;

#1#0 = #0#0; ||Cliente;
#1#1 = #0#3; ||Seccion;
#1#2 = #0#4; ||Concepto;
|LIBERA #1;
|LEE 110#1=;
|SI FSalida ! 0;
    #1#3 = "H";     ||Tipo;
||    |SI FEvariable = 0;
||        #1#6 = #2#2;    ||Descrip.Abreviada de Concep. Variables;
||    |SINO;
        #1#6 = #4#2;    ||Descrip.Abreviada de Concep. Variables;
||    |FINSI;

     |SI #0#2 = "M"; #1#4 = 13; |FINSI;
     |SI #0#2 = "T"; #1#4 = 15; |FINSI;
     |SI #0#2 = "S"; #1#4 = 17; |FINSI;
     |SI #0#2 = "A"; #1#4 = 1;  |FINSI;

     #1#5 = "G";
     #1#7 = #1#6;
     #1#8 = #4#17;
     #1#9 = #4#18;

    #1#10 = #0#7;||Importe;
    |GRABA 020#1n;
    |LIBERA #1;
|SINO;
    #1#3 = "H";
    #1#6 = #2#2; ||Descrip.Abreviada de Concep. Variables;
    #1#10 = #0#7;
    |GRABA 040#1a;
    |LIBERA #1;
|FINSI;
|CIERRA #1;
|CIERRA #2;
|FCAL;

|CALCULO baja; |TIPO 1;
modo = (FEntrada / 100) ! 0;
|SI modo ! 3; |ACABA; |FINSI;

|ABRE #1;
#1#0 = #0#0;
#1#1 = #0#3;
#1#2 = #0#4;
|LEE 040#1=;
|SI FSalida = 0;
     |BORRA 040#1a;
|FINSI;
|CIERRA #1;
|FCAL;
