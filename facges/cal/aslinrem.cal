|FICHEROS;
    ascabrem #1;
    aslinrem #2;
    asbancos #3;
    ashisrec #4;
    ashismic #5;
    asparcia #6;
|FIN;

|VARIABLES;
     mensaje1 = "    ERROR NO ENCONTRADO EL RECIBO";
     mensaje2 = "    BANCO INEXISTENTE EN RECIBO";
     modo = 0;
     mes     = "";
     mes_num = 0;
     campo   = 0;
     cuenta_cob = "";
|FIN;

|PROCESO borrar;
|BORRA 140#6a;
|LIBERA #6;
|FPRC;

|DEFBUCLE asparcia;
#6#1;
;
#2#2, #2#3, 000;
#2#2, #2#3, 999;
be;
NULL, borrar;
|FIN;

|PROCESO refresca; |TIPO 2;
#1#4 = #1#4 +. #2#7;  |PINTA #1#4;

modo  = 0 +. 1;

|ABRE #4;
#4#0 = #2#2;
#4#1 = #2#3;
|LEE 101#4=;
|SI FSalida = 0;
    #4#9  = #4#9  +. #2#7;  ||Importe Cobrado
    #4#15 = #4#15 +. #2#7;  ||importe remesado

    |SI modo = 1;
        #4#10 = "S";   ||Cobrado Total
        #4#8  = #1#3;  ||Fecha Remesa
        #4#12 = "R";   ||Contabilizado
    |SINO;
        |SI #4#9 = 0;
            #4#12 = "N";
        |SINO;
            #4#12 = "M";
        |FINSI;
        #4#10 = "N";
    |FINSI;
    |GRABA 021#4a;
|FINSI;
|LIBERA #4;
|CIERRA #4;

|ABRE #5;
#5#0 = #2#2;
#5#1 = #2#3;
|LIBERA #5;
|LEE 140#5=;
|SI FSalida = 0;
    #5#32 = #4#10;   ||Cobrado Total
    #5#33 = #4#12;   ||Contabilizado
    |GRABA 021#5a;
|FINSI;
|CIERRA #5;

|ABRE #3;
#3#0 = #1#1;
|LEE 040#3=;
|SI FSalida ! 0; |DDEFECTO #3; |FINSI;

|SI modo ! 1;
    |BUCLE asparcia;
|SINO;
    cuenta_cob = #3#23;
    |PUSHV 0501 2380;
    |CUADRO 0728 0958;
    |ATRI R;
    |PINTA 0829, " Cuenta Cobro :              ";
    E_inf = "";
    E_sup = 12;
    cuenta_cob = 0846 ? 1;
    |POPV;

    |ABRE #6;
    |DDEFECTO #6;
    #6#0  = #2#2;
    #6#1  = #2#3;
    #6#2  = 1;
    #6#3  = #1#3;
    #6#4  = #2#8;
    #6#5  = #4#6;
    #6#6  = #4#9;
    #6#7  = #4#6 - #4#9;
    #6#8  = #2#7;
    #6#9  = #4#3;
    #6#13 = cuenta_cob;
    #6#14 = #2#0;
    #6#15 = #2#1;
    |GRABA 140#6n;
    |CIERRA #6;
|FINSI;

mes     = #5#29 % 402;
mes_num = mes;

#3#0 = #5#13;
|LIBERA #3;
|LEE 140#3=;
|SI FSalida = 0;
    #3#20 = #3#20 -. #2#7;
    #3#22 = #3#22 -. #2#7;
    campo = 7 + mes_num; #3campo = #3campo -. #2#7;
    |GRABA 020#3a;
|FINSI;

#3#0 = #1#1;
|LIBERA #3;
|LEE 140#3=;
|SI FSalida = 0;
    #3#20 = #3#20 +. #2#7;
    #3#22 = #3#22 +. #2#7;
    campo = 7 + mes_num; #3campo = #3campo +. #2#7;
    |GRABA 141#3a;
|FINSI;
|CIERRA #3;
|FPRC;

|PROCESO factu;
|ABRE #4;
#4#0 = #2#2;
#4#1 = #2#3;
|LEE 001#4=;
#2#7 = #4#6 - #4#9;
|SI #2#7 = 0;
    |CIERRA #4;
    |MENAV "0000Este Recibo ya esta cobrado";
    |CIERRA #4;
    |ERROR;
    |ACABA;
|FINSI;
|PINTA #2#7;
|CIERRA #4;
|FPRC;
