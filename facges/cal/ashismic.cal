|FICHEROS;
     ashismic #0;
     asclient #4;
     ascontro #5;
     asbancos #6;
     ashisfac #90;
     ashisrec #91;
     asfpagos #12;

     asm00003 #500;
|FIN;

|VARIABLES;
    modo    = 0;
    FEstado = 0;
    fechv   = @;
    em      = 0;
    j       = 0;
    mes_a   = "";
    mes_num = 0;
    campo   = 0;
    nModo   = 0;
    Modo    = 0;
|FIN;

|PROCESO alta_no; |TIPO 7;
modo = (FEntrada / 100) ! 0;
|SI modo = 1;
    |MENAV "     No se puede dar de alta, use programas correctos.";
    |PTEC 807;
|FINSI;
|FPRC;

|PROCESO actua_cab; |TIPO 2;
|SI #0#30 = "S"; |O #0#31 = "S"; |O #0#32 = "S"; |O #0#33 = "S";
    |MENAV "      Ficha ya contabilizada o cobrada.";
    |ERROR;
    |ACABA;
|FINSI;

mes_a   = #0#29 % 402;
mes_num = mes_a;

|ABRE #6;
#6#0 = #0#13;
|LIBERA #6;
|LEE 140#6=;
|SI FSalida = 0;
    #6#20 = #6#20 +. #0#28;
    #6#22 = #6#22 +. #0#28;
    campo = 7 + mes_num; #6campo = #6campo +. #0#28;
    |GRABA 140#6a;
|FINSI;
|CIERRA #6;

|ABRE #4;
#4#0 = #0#3;
|LIBERA #4;
|LEE 140#4=;
|SI FSalida = 0;
    #4#49 = #4#49 +. #0#19;
    #4#50 = #4#50 +. #0#20;
    #4#18 = #4#18 +. #0#19;
    #4#19 = #4#19 +. #0#20;

    campo = 24 + mes_num; #4campo = #4campo +. #0#19;
    campo = 36 + mes_num; #4campo = #4campo +. #0#20;

    #4#24 = #0#28;

    |GRABA 140#4a;
|FINSI;
|CIERRA #4;

modo = (FEntrada / 100) ! 0;
|SI modo = 3;
    |ABRE #90;
    #90#0 = #0#0; #90#1 = #0#1; |BORRA 140#90c; |LIBERA #90;
    |CIERRA #90;

    |ABRE #91;
    #91#0 = #0#0; #91#1 = #0#1; |BORRA 140#91c; |LIBERA #91;
    |CIERRA #91;
    |ACABA;
|FINSI;

|ABRE #90;
#90#0 = #0#0;
#90#1 = #0#1;
|LIBERA #90;
|LEE 140#90=;
FEstado = FSalida;

|DDEFECTO #90;
#90#0  = #0#0;
#90#1  = #0#1;
#90#2  = #0#29;
#90#3  = #0#3;
#90#4  = #0#2;
#90#5  = #0#19;
#90#6  = #0#20;
#90#7  = #0#45;
#90#8  = #0#25;
#90#9  = #0#46;
#90#10 = #0#27;
#90#11 = #0#26;
#90#12 = #0#30;
#90#13 = #0#31;
#90#14 = #0#21;
#90#15 = #0#22;
#90#16 = #0#23;
#90#17 = #0#24;
#90#18 = #0#28;
|SI FEstado ! 0; |GRABA 140#90n; |SINO; |GRABA 140#90a; |FINSI;
|CIERRA #90;

|ABRE #91;
#91#0 = #0#0;
#91#1 = #0#1;
|LIBERA #91;
|LEE 140#91=;
FEstado = FSalida;

|SI FEstado ! 0; |DDEFECTO #91; |FINSI;

#91#0  = #0#0;
#91#1  = #0#1;
#91#2  = #0#29;
#91#3  = #0#3;
#91#4  = #0#2;

|HAZ fecha_venci;
#91#5  = fechv;
#91#6  = #0#28;
#91#7  = #0#13;
#91#11 = #0#12;
|SI FEstado ! 0; |GRABA 140#91n; |SINO; |GRABA 140#91a; |FINSI;
|CIERRA #91;
|FPRC;

|PROCESO fecha_venci;
|ABRE #12;
#12#0 = #0#12;
|LEE 040#12=;
|SI FSalida ! 0;
    fechv = #0#29;
|SINO;
    |SI #12#2 = "D"; em = 1; |SINO; em = 1000; |FINSI;
    j = #12#5 / em;
    fechv = #0#29 + j;
|FINSI;
|CIERRA #12;
|FPRC;

|PROCESO ConsultaSi; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4;
          |C_M #0#3, 1, "S";
     |SINO;
          |C_M #0#3, 1, "N";
     |FINSI;
|FPRC;

|PROCESO BajaCuotCli;
   |BORRA 020#asm00003.a;
|FPRC;

|DEFBUCLE BajaCuotCli;
#asm00003#1;
;
0,#ashismic#3,#ashismic#0,#ashismic#1,"S",001,01;
9,#ashismic#3,#ashismic#0,#ashismic#1,"S",999,99;
be;
NULL,BajaCuotCli;
|FIN;

|PROCESO Baja; |TIPO 1;
   Modo = (FEntrada / 100) ! 0;
   |SI Modo = 3; |BUCLE BajaCuotCli; |FINSI;
|FPRC;

|PROCESO TotalCab;
     |ABRE #5;
     |LEE 000#5p;
     |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;
     |CIERRA #5;

     #0#23 = #0#19 % #0#22;
     #0#24 = #0#19 - #0#23;
     #0#25 = #0#24 % #0#45;
     #0#26 = #0#24 + #0#25 + #0#20;
     |SI #0#14 = "S";
         |SI #0#46 = 0;
             #0#46 = #5#31;
         |FINSI;

         #0#27 = #0#24 % #0#46;
     |SINO;
         #0#27 = 0;
         #0#46 = 0;
     |FINSI;
     #0#28 = #0#26 - #0#27 - #0#21;

     |PINTA #0#19;
     |PINTA #0#20;
     |PINTA #0#21;
     |PINTA #0#23;
     |PINTA #0#24;
     |PINTA #0#25;
     |PINTA #0#26;
     |PINTA #0#27;
     |PINTA #0#28;
     |PINTA #0#46;
|FPRC;
