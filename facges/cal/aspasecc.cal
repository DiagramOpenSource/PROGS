
|FICHEROS;
   aspasecc #0;
   asclient #1;
   asconcli #2;
   ascabmin #3;
   aslinmin #4;
   asconmen #5;
   ascontro #6;
   asconcep #7;
   asfpagos #8;     || forma pago (para el tipo)

   asenlcon #9;
   asempcon #10;
   asm00001 #11;
   asconmul #12;
   asw00001 #99;

   ascuocab #500;
   ascuolin #501;
   asm00003 #502;
|FIN;

|VARIABLES;
 NumLin    = 0;
 nCliente  = 0;
 nDivisor  = 0;
 aSeccion  = "";
 aConcepto = "";

 LineaFija = 0;
 c_clie  = "";
 fijo    = "";
 sw_pase = 0;
 i = 0;
 linea = 0;
 iva = 0;
 x   = 0;
 d_c = "  ";
 h_c = "zz";
 xxxxfiac = 0;
   sw1 = 0;
   nada = "  ";
   men1 = "ATENCION **** Cliente ";
   men2 = " inexistente en fichero !!";
   hache = "H";
   ese = "S";
   aaa = "A";
   ene = "N";
   lin = 0;
   xxxfiac = "  ";
   xxaponer = "  ";
   xrelleno = "                              ";
   alfa1 = "";
   alfa2 = "";
   alfa3 = "";
   alfa4 = "";
   el_tipo = 0;
   conver    = "";
   conver1   = "";
   conver2   = "";

   nSwHay    = 0;
|FIN;

|INCLUYE agicon_i;

|PROCESO inutil;        ||para posicionarse en la ultima linea
     |SI #4#2 < 900; linea = #4#2; |FINSI;
|FPRC;

|PROCESO lee_pago;
    |DDEFECTO #8;
    #8#0 = #1#15;
    |LEE 000#8=;
    el_tipo = #8#35;
|FPRC;

|PROCESO CuotasCli;
   #asm00003#0  = #4#0;
   #asm00003#1  = #4#1;
   #asm00003#2  = #3#27;
   #asm00003#3  = #3#28;
   #asm00003#4  = #4#2;
   #asm00003#5  = 1;
   #asm00003#10 = "N";
   |LEE 000#asm00003.];
   |SI FSalida = 0; |Y #asm00003#0 = #4#0; |Y #asm00003#1 = #4#1;
    |Y #asm00003#2 = #3#27; |Y #asm00003#3 = #3#28;
    |Y #asm00003#4 = #4#2; |Y #asm00003#10 = "N";
       |PARA; |SI FSalida = 0; |Y #asm00003#0 = #4#0; |Y #asm00003#1 = #4#1;
        |Y #asm00003#2 = #3#27; |Y #asm00003#3 = #3#28;
        |Y #asm00003#4 = #4#2; |Y #asm00003#10 = "N"; |HACIENDO;
          NumLin = #asm00003#5 + 1;
          |LEE 000#asm00003.s;
       |SIGUE;
   |SINO;
       NumLin = 1;
   |FINSI;

   |DDEFECTO #asm00003;
   #asm00003#0  = #4#0;
   #asm00003#1  = #4#1;
   #asm00003#2  = #3#27;
   #asm00003#3  = #3#28;
   #asm00003#4  = #4#2;
   #asm00003#5  = NumLin;
   #asm00003#6  = #ascuolin#2;
   #asm00003#7  = #ascuolin#3;
   #asm00003#9  = #ascuolin#4;
   #asm00003#10 = "N";
   #asm00003#11 = #ascuolin#6;
   |SI #ascuocab#2 = "M"; nDivisor = 12; |FINSI;
   |SI #ascuocab#2 = "T"; nDivisor = 4;  |FINSI;
   |SI #ascuocab#2 = "S"; nDivisor = 2;  |FINSI;
   |SI #ascuocab#2 = "A"; nDivisor = 1;  |FINSI;
   #asm00003#12 = #ascuolin#5 / nDivisor;
   #asm00003#8  = #ascuolin#7 / nDivisor;
   |GRABA 020#asm00003.n;
|FPRC;

|DEFBUCLE CuotasCli;
#ascuolin#1;
;
nCliente,001;
nCliente,999;
;
NULL,CuotasCli;
|FIN;

|PROCESO CuotasClientes;
   #ascuocab#0 = nCliente;
   |LEE 000#ascuocab.=;
   |SI FSalida = 0; |Y #ascuocab#3 = aSeccion; |Y #ascuocab#4 = aConcepto;
      |BUCLE CuotasCli;
   |FINSI;
|FPRC;

|PROCESO ConceptoFijo;

     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = LineaFija;
     |LIBERA #4;
     |LEE 140#4=;
     |SI FSalida = 0;
         |ERROR10;
         |ACABA;
     |FINSI;

     |DDEFECTO #4;
     #4#0  = #3#0;
     #4#1  = #3#1;
     #4#2  = LineaFija;
     #4#3  = 0;
     #4#4  = #11#0;
     #4#5  = #11#1;
     #4#6  = #11#2;
     #4#7  = #11#3;
     #4#8  = #11#4;
     #4#9  = #11#5;
     #4#15 = #0#17;
     |GRABA 140#4n;

     LineaFija = LineaFija + 1;

     nCliente = #4#1; aSeccion = #4#4; aConcepto = #4#5; |HAZ CuotasClientes;
|FPRC;

|DEFBUCLE asm00001;
     #11#1;
     ;
     "    ", "  ";
     "zzzz", "zz";
     ;
     NULL, ConceptoFijo;
|FIN;

|PROCESO graba_con;
     |ABRE #9;
     #9#0 = #4#4;
     #9#1 = #4#5;
     |LEE 040#9=;
     |SI FSalida ! 0; |CIERRA #9; |ACABA; |FINSI;
     |CIERRA #9;

     |ABRE #10;
     |LEE 040#10p;
     |SI FSalida ! 0; |DDEFECTO #10; |FINSI;
     |CIERRA #10;

     c_clie    = #4#1;
     c_clie    = ("00000" + c_clie) % -105;
     fijo    = #10#3; |QBF fijo;
     fijo    = fijo + c_clie;
     conver1 = #4#15 % 0102;
     conver2 = #4#15 % 0402;
     conver  = conver1 + conver2;
     c_fecha = conver;
     c_fecha = ("0000" + c_fecha) % -104;

     |ABRE #99;
     #99#0 = #4#0;
     #99#1 = #4#1;
     #99#2 = #4#2;
     |LIBERA #99;
     |LEE 140#99=;
     |SI FSalida = 0;
        #99#3  = #10#1;
        #99#4  = #10#2;
        #99#5  = c_fecha;
        #99#6  = fijo;
        #99#7  = #9#2;
        #99#8  = #9#6;
        #99#9  = #9#3;
        #99#10 = #9#4;
        #99#11 = #4#13;
        #99#12 = #9#5;
        #99#13 = 0;
        #99#14 = "";
        |GRABA 140#99a;
     |SINO;
        |DDEFECTO #99;
        #99#0  = #4#0;
        #99#1  = #4#1;
        #99#1  = #4#2;
        #99#3  = #10#1;
        #99#4  = #10#2;
        #99#5  = c_fecha;
        #99#6  = fijo;
        #99#7  = #9#2;
        #99#8  = #9#6;
        #99#9  = #9#3;
        #99#10 = #9#4;
        #99#11 = #4#13;
        #99#12 = #9#5;
        #99#13 = 0;
        #99#14 = "";
        |GRABA 140#99n;
     |FINSI;
     |CIERRA #99;
|FPRC;

|PROCESO pase;
     sw_pase = 0;
     |SI #0#6 = "N";
        sw_pase = 1;
     |SINO;
        |HAZ parrilla;
     |FINSI;

     |SI sw_pase = 0;  |ACABA;  |FINSI;

     #1#0 = #2#0;
     |LEE 040#1=;
     |SI FSalida ! 0;
         |PINTA 0415, men1;
         |PINTA 0437, #1#0;
         |PINTA 0442, men2;
         |AVISO;
         |PAUSA;
         |BLIN 4;
         |ACABA;
     |FINSI;

     el_tipo = #0#18;
     |SI #0#21 = "S";   |HAZ lee_pago;  |FINSI;

     #3#0 = el_tipo;
     #3#1 = #1#0;
     #4#2 = 0;
     |LIBERA #3;
     |LEE 101#3=;
     |SI FSalida ! 0;
         #3#0  = el_tipo;  #3#1 = #1#0;
         #3#2  = #1#1;     #3#3 = #1#2;
         #3#4  = #1#3;     #3#5 = #1#4;
         #3#6  = #1#5;     #3#7 = #1#6;
         #3#8  = #1#7;     #3#9 = #1#8;
         #3#10 = #1#15;    #3#11 = #1#16;
         #3#12 = #1#17;    #3#13 = #1#11;
         #3#14 = #1#12;    #3#15 = #1#13;
         #3#16 = #1#14;    #3#17 = 0;
         #3#18 = 0;        #3#19 = 0;
         #3#20 = #1#23;
         linea = 0;

         |SI #6#32 = "S";
             |SI #1#24 ! 0;
                 |ABRE #7;
                 #7#0 = #6#33;
                 #7#1 = #6#34;
                 |LEE 040#7=;
                 |SI FSalida = 0; |Y #7#3 = "A";
                     |ABRE #4;
                     #4#0  = #3#0;
                     #4#1  = #3#1;
                     #4#2  = 5;
                     #4#3  = 0;
                     #4#4  = #7#0;
                     #4#5  = #7#1;
                     #4#6  = #7#2;
                     #4#7  = #7#16;
                     #4#8  = #7#17;
                     #4#9  = #7#18;
                     #4#10 = #7#3;
                     #4#11 = 1;
                     #4#12 = -#1#24;
                     #4#13 = -#1#24;
                     #4#14 = "G";
                     #4#15 = "00.00.0000";            ||AQUI
                     |GRABA 040#4n;
                     |CIERRA #4;
                     |HAZ graba_con
                     nCliente = #4#1; aSeccion = #4#4; aConcepto = #4#5; |HAZ CuotasClientes;

                     #3#19 = #4#13;
                     #3#26 = #3#24 - #3#19 - #3#25;
                     linea = 5;
                 |FINSI;
                 |CIERRA #7;
             |FINSI;
         |FINSI;
         |GRABA 020#3b;

         |ABRE #4;
         LineaFija = 900;
         |BUCLE asm00001;
         |CIERRA #4;
     |SINO;
         linea = 0;
         |BUCLELIN 0inutil#3;
     |FINSI;
     linea = linea + 5;

     nSwHay = 0;
     |ABRE #12;
     #12#0 = #2#1;
     #12#1 = #2#2;
     |LEE 040#12=;
     |SI FSalida = 0;  nSwHay = 1;  |FINSI;
     |CIERRA #12;

     |ABRE #4;
     #4#0  = #3#0;     #4#1  = #3#1;
     #4#2  = linea;
     |HAZ conver_fec;  #4#3  = conver;
     #4#4  = #2#1;     #4#5  = #2#2;
     #4#6  = #2#6;     #4#7  = #2#7;
     #4#8  = #2#8;     #4#9  = #2#9;
     #4#10 = #2#3;
     #4#11 = 1;
     |SI #2#5 = "U";  #4#11 = #0#22;  |FINSI;
     |SI nSwHay = 0;
         #4#12 = #2#10;
     |SINO;
         #4#12 = #2#10 - (#2#10 < #12#3);
     |FINSI;

     #4#13 = #4#11 * #4#12;
     #4#14 = #2#5;     #4#15 = #0#17;

     #5#0 = #2#1;
     #5#1 = #2#2;
     |LEE 040#5=;
     |SI FSalida = 0;
         #4#6 = #5#2;
         #4#7 = #5#2;
         #4#8 = nada;
         #4#9 = nada;
     |FINSI;

     |SI #4#10 = "H"; #3#17 = #3#17 + #4#13; |FINSI;
     |SI #4#10 = "S"; #3#18 = #3#18 + #4#13; |FINSI;
     |SI #4#10 = "A"; #3#19 = #3#19 + #4#13; |FINSI;
     |SI #0#19 = "N"; #3#12 = "N";           |FINSI;

     |GRABA 020#4n;
     nCliente = #4#1; aSeccion = #4#4; aConcepto = #4#5; |HAZ CuotasClientes;

     |SI nSwHay = 1;
         |ABRE #7;
         #7#0 = #12#4;
         #7#1 = #12#5;
         |LEE 040#7=;
         |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;
         |CIERRA #7;

         linea = linea + 5;
         #4#2  = linea;
         #4#4  = #7#0;
         #4#5  = #7#1;
         #4#6  = #7#2;
         #4#7  = #7#16;
         #4#8  = #7#17;
         #4#9  = #7#18;
         #4#10 = #7#3;
         #4#12 = #2#10 - (#2#10 < #12#7);
         #4#13 = #4#11 * #4#12;

         |GRABA 020#4n;
         |LIBERA #4;
         nCliente = #4#1; aSeccion = #4#4; aConcepto = #4#5; |HAZ CuotasClientes;

         |SI #4#10 = "H"; #3#17 = #3#17 + #4#13; |FINSI;
         |SI #4#10 = "S"; #3#18 = #3#18 + #4#13; |FINSI;
         |SI #4#10 = "A"; #3#19 = #3#19 + #4#13; |FINSI;
         |SI #0#19 = "N"; #3#12 = "N";           |FINSI;
     |FINSI;

     |CIERRA #4;

     #3#21 = #3#17 % #3#20;
     #3#22 = #3#17 - #3#21;
     |HAZ iva;
     #3#23 = #3#22 % iva;
     #3#24 = #3#22 + #3#23 + #3#18;
     |SI #3#12 = "S"; #3#25 =  #3#22 % #6#31; |SINO; #3#25 = 0; |FINSI;
     #3#26 = #3#24 - #3#19 - #3#25;

     |GRABA 020#3a;
     |LIBERA #3;
     |HAZ graba_con
|FPRC;

|PROCESO conver_fec; |TIPO 0;
conver1 = #0#17 % 0102;
conver2 = #0#17 % 0402;
conver  = conver1 + conver2;
|FPRC;

|PROCESO iva;
|ABRE #6;
|LEE 040#6p;
|SI FSalida ! 0; |DDEFECTO #6; |FINSI;
|CIERRA #6;
iva = 0;
|SI #3#0 = 0; iva = #6#21; |FINSI;
|SI #3#0 = 1; iva = #6#22; |FINSI;
|SI #3#0 = 2; iva = #6#23; |FINSI;
|SI #3#0 = 3; iva = #6#24; |FINSI;
|SI #3#0 = 4; iva = #6#25; |FINSI;
|SI #3#0 = 5; iva = #6#26; |FINSI;
|SI #3#0 = 6; iva = #6#27; |FINSI;
|SI #3#0 = 7; iva = #6#28; |FINSI;
|SI #3#0 = 8; iva = #6#29; |FINSI;
|SI #3#0 = 9; iva = #6#30; |FINSI;
|FPRC;

|DEFBUCLE concecli;
#2#1;
4;
#0#0, #0#2, d_c, #0#4;
#0#1, #0#3, h_c, #0#5;
e;
NULL, pase;
|FIN;

|PROCESO impre; |TIPO 3;
|SI #0#20 = "SI";
    |ABRE #6;
    |LEE 040#6p;
    |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
    |CIERRA #6;

    |ABRE #1;
    |ABRE #3;
    |ABRE #5;
    |ABRE #8;
    |ABRE #asm00003; |ABRE #ascuocab; |ABRE #ascuolin;
    |BUCLE concecli;
    |LIBERA #1;
    |LIBERA #3;
    |LIBERA #5;
    |CIERRA #1;
    |CIERRA #3;
    |CIERRA #5;
    |CIERRA #8;
    |CIERRA #ascuolin; |CIERRA #ascuocab; |CIERRA #asm00003;
|FINSI;
|FPRC;


|PROCESO no_tipo; |TIPO 7;
|SI #0#21 = "S";
        alfa1 = "N";
|SINO;
        alfa1 = "S";
|FINSI;
|CAMPO_MODIFICA #0#18, 1, alfa1;
|FPRC;

|PROCESO mayus; |TIPO 0;
    #0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|PROCESO periodo; |TIPO 0;
|SI #0#6 = "S";
    #0#4 = 0; #0#5 = 99;
    |PINTA #0#4;
    |PINTA #0#5;
|SINO;
    |PARA x = 7; |SI x [ 16; |HACIENDO x = x + 1;
        #0x = 0;
        |PINTA #0x;
    |SIGUE;
|FINSI;
|FPRC;

|PROCESO parrilla;
|PARA i = 7; |SI i [ 16; |HACIENDO i = i + 1;
    |SI #2#4 = #0i;  sw_pase = 1;  |FINSI;
|SIGUE;
|FPRC;

|PROCESO nomodi; |TIPO 7;
|SI #0#6 = "N"; |HAZ nomodifi; |FINSI;
|FPRC;

|PROCESO nomodifi;             || RUTINA DE CONVERSION A NO MODIFICABLES
                               || VARIABLES: A_
    xxaponer = Anono;
    xxxxfiac = Control % A1001;
    Control = Control + xxxxfiac;
    Control = Control + xrelleno;
    Control = Control % A120;
    Control = Control + xxaponer;
|FPRC;
