|FICHEROS;
   visam012 #0;
   ashisrec #1;
   ascabrem #2;
   aslinrem #3;
   asclient #5;
   asparcia #6;
   ashismic #90;
   asw00005 #99;

   &bancosp@ #706;
|FIN

|VARIABLES;
     nHasta = 0;
     fHasta = @;
     aMes = "";
     fSistema = @;
     aSistema = "";
     aAnyo = "";
     aFecha = "";

     &eaCta = "";
     &enSwEstaPlan = 0;
     aMensaje = "";

    men1       = "    YA EXISTE NUMERO DE REMESA    ";
    men2       = "    NO EXISTE EL REGISTRO DEL BANCO  ";
    men3       = "    NO EXISTE EL REGISTRO DEL CLIENTE ";
    importe    = 0;
    nombanc    = "";
    mes        = "";
    mes_num    = 0;
    campo      = 0;
    linea      = 0;
    he_grabado = 0;
    mas_uno    = 0;
    fFech      = @;
    qFech      = "";
    dFech      = "";
    hFech      = "";
    aImprimir  = "";

   &enCodBanco  = 0;
   &enSwDeDonde = 0;
|FIN;

|INCLUYE i_ficher;

|PROCESO funcion1; |TIPO 11;
|SI FSalida ! 10; |ACABA; |FINSI;

|LIBERA #99;
|LEE 140#99=;

|SI #99#11 = "S"; #99#11 = "N"; |SINO; #99#11 = "S"; |FINSI;
|PINTA #99#11;
|GRABA 140#99a;
|PTEC 809;
|FPRC;

||---------------------------------------------------------------------------

|PROCESO lee_ultimo; |TIPO 7;
     |ABRE #2;
     |LEE 000#2u;
     |SI FSalida = 0;
          #0#0 = #2#0 + 1;
     |SINO;
          |DDEFECTO #0;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO sacaano; |TIPO 7;
/*
     fFech = ~;
     qFech = fFech % -104;
     dFech = "01.01." + qFech;
     hFech = "31.12." + qFech;
     #0#7  = dFech;
     #0#8  = hFech;
     #0#9  = dFech;
     #0#10 = hFech;
     |PINTA #0#7;
     |PINTA #0#8;
     |PINTA #0#9;
     |PINTA #0#10;
*/
|FPRC;

|PROCESO clave1;|TIPO 0;
|ABRE #2;
#2#0 = #0#0;
|LEE 040#2=;
|SI FSalida = 0;
    |MENAV men1;
    |ERROR;
|FINSI;
|CIERRA #2;
|FPRC;

|RUTINA inferior;
#99#0 = 1;
|FRUT;

|RUTINA superior;
#99#0 = 999;
|FRUT;

|PROCESO BancoPropio; |TIPO 0;
     enCodBanco = #0#1;
     |HAZ LeeBancoPropio;
     |SI enSwDeDonde = 1;
         nombanc = #706#1;
         #0#14   = #706#11;
     |SINO;
         nombanc = #706#1;
         #0#14   = #706#23;
     |FINSI;
     |PINTA #0#14;
|FPRC;

|PROCESO ashisrec;
     #99#10 = #1#6 - #1#9;
     |SI #99#10 = 0; |ACABA; |FINSI;

     #0#15 = #0#15 + #99#10;

     |DDEFECTO #99;
     #5#0 = #1#3;
     |LEE 040#5=;
     |SI FSalida ! 0; |DDEFECTO #5; |FINSI;

     enCodBanco = #1#7;
     |HAZ LeeBancoPropio;

     linea  = linea + 1;
     #99#0  = linea;
     #99#1  = #1#0;
     #99#2  = #1#1;
     #99#3  = #1#3;
     #99#4  = #5#2;
     #99#5  = #1#7;
     #99#6  = #706#1;
     #99#7  = #1#2;
     #99#8  = #1#5;
     #99#9  = #1#6;
     #99#10 = #1#6 - #1#9;
     #99#11 = #0#13;
     |GRABA 020#99n;
     |LIBERA #99;
|FPRC;

|DEFBUCLE ashisrec;
/*
     #1#1;
     2, 5, 7;
     #0#3, #0#5, #0#7, #0#9,  #0#11;
     #0#4, #0#6, #0#8, #0#10, #0#12;
     ;
     NULL, ashisrec;
*/

     #1#1;
     2, 7, 11;
     "  ", 00000, "01.01.0000", 10, 2;
     "zz", 99999, fHasta      , 10, 2;
     ;
     NULL, ashisrec;
|FIN;

|PROCESO Cobro;
     #6#0 = #1#0;
     #6#1 = #1#1;
     #6#2 = 999;
     |LEE 040#6];
     |SI FSalida = 0;
         |LEE 040#6a;
     |SINO;
         |LEE 040#6u;
     |FINSI;
     mas_uno = 1;
     |SI FSalida = 0;  |Y #6#0 = #1#0;  |Y #6#1 = #1#1;
         mas_uno = #6#2 + 1;
     |FINSI;

     |DDEFECTO #6;
     #6#0  = #1#0;
     #6#1  = #1#1;
     #6#2  = mas_uno;
     #6#3  = #0#2;
     #6#4  = #1#5;
     #6#5  = #1#6;
     #6#6  = #1#9;
     #6#7  = #1#6 - #1#9;
     #6#8  = #99#10;
     #6#9  = #1#3;
     #6#13 = #0#14;
     #6#14 = #3#0;
     #6#15 = #3#1;
     |GRABA 020#6n;
     |LIBERA #6;
|FPRC;

|PROCESO asw00005;
     #5#0 = #99#3;
     |LEE 040#5=;
     |SI FSalida ! 0; |DDEFECTO #5; |FINSI;

     #1#0 = #99#1;
     #1#1 = #99#2;
     |LIBERA #1;
     |LEE 140#1=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     he_grabado = 1;
     linea      = linea + 1;

     |DDEFECTO #3;
     #3#0    = #0#0;
     #3#1    = linea;
     #3#2    = #1#0;
     #3#3    = #1#1;
     #3#4    = #1#3;
     #3#5    = #5#2;
     #3#6    = #5#6;
     #1#15   = #99#10;
     #3#7    = #1#15;
     #3#8    = #1#2;
     #3#9    = #1#5;
     |GRABA 020#3n;
     |LIBERA #3;

     #0#16   = #0#16 + #1#15;
     #99#12  = #1#15;
     |GRABA 020#99a;
     |LIBERA #99;

     #1#8  = #0#2;
     #1#9  = #1#9 + #1#15;
     #1#10 = "S";
     #1#12 = "R";
     |GRABA 021#1a;
     |LIBERA #1;

     |ABRE #90;
     #90#0 = #1#0;
     #90#1 = #1#1;
     |LIBERA #90;
     |LEE 140#90=;
     |SI FSalida = 0;
         #90#32 = #1#10;
         #90#33 = #1#12;
         |GRABA 140#90a;
     |FINSI;
     |CIERRA #90;

     mes     = #90#29 % 402;
     mes_num = mes;

     enCodBanco = #1#7;
     |HAZ LeeBancoPropio;
     |SI enSwDeDonde = 0;
         #706#0 = #1#7;
         |LEE 101#706=;
         |SI FSalida = 0;
             #706#20 = #706#20 - #1#15;
             #706#22 = #706#22 - #1#15;
             campo = 7 + mes_num;
             #706campo = #706campo - #1#15;
             |GRABA 020#706a;
             |LIBERA #706;
         |FINSI;

         #706#0 = #0#1;
         |LEE 140#706=;
         |SI FSalida = 0;
             #706#20   = #706#20 + #1#15;
             #706#22   = #706#22 + #1#15;
             campo = 7 + mes_num;
             #706campo = #706campo + #1#15;
             |GRABA 020#706a;
             |LIBERA #706;
         |FINSI;
     |FINSI;

     |HAZ Cobro;
|FPRC;

|DEFBUCLE asw00005;
     #99#1;
     11;
     0000, "S";
     9999, "S";
     be;
     NULL, asw00005;
|FIN;

|PROCESO asw00005I;
     |PRINT;
|FPRC;

|DEFBUCLE asw00005I;
     #99#1;
     ;
     0000;
     9999;
     be;
     NULL, asw00005I;
|FIN;

|PROCESO Impresion;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "visam012";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |BUCLE asw00005I;

     |PIEINF;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO Tipo0C14; |TIPO 0;
     eaCta = #0#14;
     |HAZ MFiltraPtos;
     #0#14 = eaCta;
     |PINTA #0#14;

     |HAZ EstaPlanContable;
     |SI enSwEstaPlan = 0;
          aMensaje = "0000Cuenta no definida en Plan Contable";
          |MENAV aMensaje;
     |FINSI;
|FPRC;

|PROCESO Tipo0C18; |TIPO 0;
     |SI #visam012#18 = 1; #visam012#19 = "Enero"; |FINSI;
     |SI #visam012#18 = 2; #visam012#19 = "Febrero"; |FINSI;
     |SI #visam012#18 = 3; #visam012#19 = "Marzo"; |FINSI;
     |SI #visam012#18 = 4; #visam012#19 = "Abril"; |FINSI;
     |SI #visam012#18 = 5; #visam012#19 = "Mayo"; |FINSI;
     |SI #visam012#18 = 6; #visam012#19 = "Junio"; |FINSI;
     |SI #visam012#18 = 7; #visam012#19 = "Julio"; |FINSI;
     |SI #visam012#18 = 8; #visam012#19 = "Agosto"; |FINSI;
     |SI #visam012#18 = 9; #visam012#19 = "Septiembre"; |FINSI;
     |SI #visam012#18 = 10; #visam012#19 = "Octubre"; |FINSI;
     |SI #visam012#18 = 11; #visam012#19 = "Noviembre"; |FINSI;
     |SI #visam012#18 = 12; #visam012#19 = "Diciembre"; |FINSI;
     |PINTA #visam012#19;

     aMes = ("00" + #visam012#18) % -102;
     fSistema = ~;
     aSistema = fSistema;
     aAnyo = aSistema % -104;

     aFecha = "05." + aMes + "." + aAnyo;
     #visam012#2 = aFecha;
     |PINTA #visam012#2;
|FPRC;

|PROCESO temporal_negativo;
     |SI #99#10 < 0;
          aMensaje = "0000Importe total Remesa negativo. Cliente: " + #99#3;
          |QBF aMensaje;
          aMensaje = aMensaje + #99#4;
          |MENAV aMensaje;
          |BORRA 020#99.a;
     |FINSI;
|FPRC;


|DEFBUCLE temporal_negativo;
 #99#1;
 ;
 INICIO;
 FINAL;
 be;
 NULL, temporal_negativo;
|FIN;


|PROCESO proceso; |TIPO 3;
     comienza = "05";
     |HAZ fichero;
     |NOME_DAT #99 fichero;

     |ABRE #99; |CIERRA #99; |DELINDEX #99;

     he_grabado = 0;
     linea      = 0;

     nHasta = #visam012#2;
     nHasta = nHasta - 5;
     fHasta = nHasta;

     |ABRE #5;
     |ABRE #99;
     |BUCLE ashisrec;
     |CIERRA #99;

     |SI linea = 0;
         |CIERRA #5;
         |ABRE #99; |CIERRA #99; |DELINDEX #99;
         |ACABA;
     |FINSI;

     |BUCLE temporal_negativo;

     |ENTLINEAL #1#99, -1, 4, 20, 1, inferior, superior;
     |CONFI "2400SDesea hacer la Remesa : ";
     |SI FSalida ! 0;
         |CIERRA #5;
         |ABRE #99; |CIERRA #99; |DELINDEX #99;
         |ACABA;
     |FINSI;

     |ABRE #1;
     |ABRE #2;
     |ABRE #3;
     |ABRE #6;

     linea      = 0;
     |BUCLE asw00005;
     |SI he_grabado = 1;
         #2#0 = #0#0;
         #2#1 = #0#1;
         #2#2 = nombanc;
         #2#3 = #0#2;
         #2#4 = #0#16;
         |GRABA 020#2n;
         |LIBERA #2;
     |FINSI;

     |CIERRA #1;
     |CIERRA #2;
     |CIERRA #3;
     |CIERRA #5;
     |CIERRA #6;

     |BLANCO 0501 2380;
     |CUADRO 0812 2161;
     |ATRI R;
     |PINTA 0913, "                   INCIDENCIAS                  ";
     |ATRI r;

     |PINTA 1213, "   Total en Recibos ..: ";
     |PINTA 1313, "   Total en la Remesa : ";
     |PINTA 1413, "------------------------------------------------";
     |PINTA 1513, "   Diferencia ........: ";
     |PINTA 2013, "                                   Imprimir :   ";

     #0#17 = #0#15 - #0#16;

     |PINTA 1237, #0#15;
     |PINTA 1337, #0#16;
     |PINTA 1537, #0#17;

                     aImprimir = "N";
     |SI #0#17 ! 0;  aImprimir = "S";  |FINSI;

     E_inf = "SNsn";
     E_sup = "1";

     aImprimir = 2059 ? 1;
     aImprimir = aImprimir > " ";

     |SI aImprimir = "S";
         |HAZ Impresion;
     |FINSI;

     |ABRE #99; |CIERRA #99; |DELINDEX #99;
|FPRC;
