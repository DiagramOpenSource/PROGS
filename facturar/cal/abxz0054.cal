|FICHEROS;
     abxz0054 #954;
     abom0514 #514;
     abom0602 #602;
     abom0603 #603;
     abxw0004 #904,MANTE;
     abow0015 #98;

     referen@ #1000;
|FIN;

|VARIABLES;
     aAbre          = "";
     aBase          = "";
     aAlfaAnt       = "";
     aAlfa          = "";
     aAlfa1         = "";
     aAlfa2         = "";
     aAlfa3         = "";
     aEsc1          = "";
     aEsc2          = "";
     aRetu          = "";
     aTecla         = "";
     aFichero       = "";
     aCarga         = "";
     aQueQuiero     = "";
     aTexto         = "";
     aTexto1        = "";
     aTexto2        = "";
     aLong          = "";
     aCarac         = "";
     aRefresca      = "";
     aBusca         = "";
     aBusca1        = "";
     aBusca2        = "";
     aIPRemoto      = "";
     aNombreIP      = "";
     aRuta          = "";
     aFicheroActu   = "";
     aMas           = "";
     aTitulo        = "";
     aNumCampos     = "";
     aNombCampo     = "";
     aTipoCampo     = "";
     aLongCampo     = "";
     aRegilla       = "";
     aOrigen        = "";
     aDestino        = "";
     aTemporal       = "";
     aPathPlan       = "";
     aCadena1        = "";
     aCadena2        = "";
     aNombreFich     = "";

     nBotonLabel    = 0;
     nHandle        = 0;
     nCanal         = 0;
     nTree          = -1;
     nTree1         = -1;
     nTree2         = -1;
     nPanta         = 0;
     nSubPanta      = 0;
     nLong          = 0;
     nCargar        = 0;
     nPos           = 0;
     nPosi          = 0;
     nBoton1        = 0;
     nBoton2        = 0;
     nBoton3        = 0;
     nVent          = 0;
     nSubVent       = 0;
     nCampo         = 0;
     nTCampo        = 0;
     nCarpeta1      = 0;
     nCarpeta2      = 0;
     nSubBoton1     = 0;
     nSubBoton2     = 0;
     nSubBoton3     = 0;
     nSubBoton4     = 0;
     nContador      = 0;
     nSwNuest       = 0;
     nModo          = 0;
     nNumCampos     = 0;
     nCampos        = 0;
     nDCodigo       = 0;
     nHCodigo       = 0;
     nSwGraba       = 0;
     nSwAborto      = 0;
     nRango         = 0;

     {-1}sTree      = 0;
     sT_nID         = 0;
     sT_nOper       = 0;
     sT_aData       = "";

     {-1}sTree_1    = 0;
     sT_nID_1       = 0;
     sT_nOper_1     = 0;
     sT_aData_1     = "";

     {-1}sTree_2    = 0;
     sT_nID_2       = 0;
     sT_nOper_2     = 0;
     sT_aData_2     = "";

     {-1}aVent      = "";
         aVent1     = 0;
         aVent2     = 0;
         aVent3     = 0;
         aVent4     = 0;
         aVent5     = "";

     &eaFicheroRecog = "";
     &enFSalida        = 0;
     &efFechaDocu      = @;
     &enCodUbica       = 0;
     &enTipoDocumento  = 0;
     &eaRutaDocumento  = "";
     &eaNombrePrograma = "";
     &eaNombreRuta     = "";
     &eaRutaPlanilla   = "";
     &eaExtension      = "";
     &eaFicheroEdita   = "";
     &eaTipoMailing    = "";
     &eaPiePagina      = "";
     &eaCache          = "";
     &eaRuta           = "";
     &eaCadenaImpre    = "";

     &eaRutaOrigen  = "";
     &eaRutaDestino = "";
     &eaFicheroTxt  = "";
     &eaFicheroTgz  = "";
     &eaFicheroTar  = "";
     &eaAlfa        = "";
     &eaUnidadBasico = "";
|FIN;

||***************************************************************************

|PROCESO EventoPanta;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#98=;
         |SI FSalida ! 0;  |DDEFECTO #98;  |FINSI;
     |FINSI;

     |SI FSalida = 4;
         eaFicheroRecog = #98#0;
         efFechaDocu = #98#2;

         |QBF eaFicheroRecog;

         |PTEC 806;
     |FINSI;
|FPRC;

|PROCESO RecogePlanillas;
     nSwGraba = 0;

     aTemporal = ("c6" + Usuario + "zzzzzzzz") % 108;  |NOME_DAT #98 aTemporal;
     |ABRE #98;  |CIERRA #98;  |DELINDEX #98;

     |ABRE #98;

     |SI #514#21 ! "C";
         aPathPlan = eaRutaPlanilla;   |QBF aPathPlan;
         aPathPlan = aPathPlan - "\*" + "/";

         aOrigen   = aPathPlan;

         |R_PDIR aOrigen;
         |PARA; |SI FSalida = 0; |HACIENDO;
                aCadena1 = aOrigen     > " ";
                aCadena2 = eaExtension > " ";
                aCadena2 = "." + aCadena2;
                aAlfa    = aCadena1 - aCadena2;
                |SI aAlfa ! aCadena1;
                    aCadena1    = aOrigen    > " ";
                    aCadena2    = aPathPlan  > " ";  |QBF aCadena2
                    aNombreFich = aCadena1 - aCadena2;

                    #98#0 = aNombreFich;
                    #98#1 = aNombreFich;
                    |GRABA 020#98n;
                    |LIBERA #98;
                    nSwGraba = 1;
                |FINSI;

                |R_SDIR aOrigen;
         |SIGUE;
         |CIERRA #98;
     |SINO;
         aPathPlan = eaRutaPlanilla;   |QBF aPathPlan;
         aPathPlan = aPathPlan - "/*" + "/";

         aOrigen   = aPathPlan + "*." + (eaExtension < "");

         |_PDIR aOrigen;
         |PARA; |SI FSalida = 0; |HACIENDO;
                aNombreFich = aOrigen - aPathPlan;

                #98#0 = aNombreFich;
                #98#1 = aNombreFich;
                |GRABA 020#98n;
                |LIBERA #98;
                nSwGraba = 1;

                |_SDIR aOrigen;
         |SIGUE;
         |CIERRA #98;
     |FINSI;

     nSwAborto = 1;
     |SI nSwGraba = 1;
         |VENTANA 0530, 2470, -1, 17, "Planillas";
         nVent = FSalida;

         aVent1 = -1;
         aVent2 = -1;
         aVent3 = 0;
         aVent4 = nVent;
         aVent5 = "MODAL";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         nRango = 4 + 8 + 16 + 128;

         |ABRE #98;

         |LINEAL_SIMPLE #1#98, nRango, 0535, 2265, NULL, NULL, EventoPanta;
         |CIERRA #98;

         aVent1 = -1;
         aVent2 = -1;
         aVent3 = 0;
         aVent4 = nVent;
         aVent5 = "MODELESS";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         |FINVENTANA nVent;

         |SI eaFicheroRecog ! "";
             aOrigen = aPathPlan + eaFicheroRecog;
         |FINSI;
     |SINO;
         |MENAV "      Seleccion Vacia.";
     |FINSI;

     |DELINDEX #98;
|FPRC;

|PROCESO Editar;
     efFechaDocu = "00.00.0000";
     enCodUbica  = #904#2;  |HAZ LeeUbicaciones;
     eaRuta      = eaRutaDocumento;
     eaExtension = eaExtension < "";

     aOrigen  = eaRutaPlanilla;                   |QBF aOrigen;
     aDestino = eaRutaDocumento + "/" + #904#4;   |QBF aDestino;
     aDestino = aDestino + "." + eaExtension;     |QBF aDestino;

     |SI #514#21 ! "C";
         |XABRE "EC", aDestino, nCanal;
     |SINO;
         |XABRE "E", aDestino, nCanal;
     |FINSI;

     |SI FSalida ] 0;
         aOrigen  = "";
     |FINSI;
     |XCIERRA nCanal;

     |SI aOrigen ! "";
         aAlfa = aOrigen % -101;
         |SI aAlfa = "*";
             |HAZ RecogePlanillas;
             |QBF aOrigen;
         |FINSI;

         |SI aOrigen ! "";
             |SI #514#21 ! "C";
                 |RCOPIA_FICHERO aOrigen, aDestino;
             |SINO;
                 |COPIA_FICHERO aOrigen, aDestino;
             |FINSI;

             |SI FSalida ! 0;
                 |MENAV "         Ha habido un error al copiar la Plantilla.";
                 |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     eaCache        = "N";
     eaFicheroEdita = #904#4;                              |QBF eaFicheroEdita;
     eaFicheroEdita = eaFicheroEdita + "." + eaExtension;  |QBF eaFicheroEdita;
     |HAZ AbreDocumento;
|FPRC;

|PROCESO Imprime;
     aRegilla = "#";
     |SI nContador = 0;  aRegilla = " ";  |FINSI;
     aAlfa = ("00000" + #603#1) % -105;

     nContador     = nContador + 1;
     eaCadenaImpre = "#" + (aAlfa % 102) + "#" + "0" + (aAlfa % 303) + "   " + #603#2 + "   " + #603#3;
     |PRINT;
|FPRC;

|DEFBUCLE dsam0603C;
     #603#1;
     ;
     #904#0, nDCodigo;
     #904#0, nHCodigo;
     ;
     NULL, Imprime;
|FIN;

|PROCESO Plantilla;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "abom0603";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     efFechaDocu = "00.00.0000";
     enCodUbica  = #904#2;  |HAZ LeeUbicaciones;
     eaRuta      = eaRutaDocumento;

     #602#0 = #904#0;
     #602#1 = #904#1;
     #602#2 = #904#2;
     #602#3 = #904#3;
     #602#4 = #904#4;
     #602#5 = #904#5;
     #602#6 = #904#6;

     nContador = 0;
     nDCodigo  = 01000;  nHCodigo  = 01999;  |BUCLE dsam0603C;
     nDCodigo  = 02000;  nHCodigo  = 02999;  |BUCLE dsam0603C;
     nDCodigo  = 03000;  nHCodigo  = 03999;  |BUCLE dsam0603C;
     nDCodigo  = 04000;  nHCodigo  = 04999;  |BUCLE dsam0603C;
     nDCodigo  = 05000;  nHCodigo  = 05999;  |BUCLE dsam0603C;
     nDCodigo  = 06000;  nHCodigo  = 06999;  |BUCLE dsam0603C;
     nDCodigo  = 07000;  nHCodigo  = 07999;  |BUCLE dsam0603C;
     nDCodigo  = 08000;  nHCodigo  = 08999;  |BUCLE dsam0603C;
     nDCodigo  = 09000;  nHCodigo  = 09999;  |BUCLE dsam0603C;
     nDCodigo  = 10000;  nHCodigo  = 10999;  |BUCLE dsam0603C;
     nDCodigo  = 11000;  nHCodigo  = 11999;  |BUCLE dsam0603C;
     nDCodigo  = 12000;  nHCodigo  = 12999;  |BUCLE dsam0603C;
     nDCodigo  = 13000;  nHCodigo  = 13999;  |BUCLE dsam0603C;
     nDCodigo  = 14000;  nHCodigo  = 14999;  |BUCLE dsam0603C;
     nDCodigo  = 15000;  nHCodigo  = 15999;  |BUCLE dsam0603C;

     |SI nContador ! 0;  |PIEINF;  |FINSI;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO EventoTree1;
     |ESTADO_CONTROL nSubBoton1, "ENABLE";
     |ESTADO_CONTROL nSubBoton2, "DISABLE";

     aAlfa       = Contenido;  |QBF aAlfa;
     aTexto1     = "";
     aLong       = aAlfa % 0;
     nLong       = aLong;
     nCargar     = 0;
     |PARA nPosi = 1;  |SI nPosi [ nLong;  |HACIENDO nPosi = nPosi + 1;
           nPos = (nPosi * 100) + 1;
           aCarac = aAlfa % nPos;

           |SI nCargar = 1;
               aTexto1 = aTexto1 + aCarac;
           |FINSI;

           |SI aCarac = ":";  nCargar = 1; |FINSI;
     |SIGUE;

     |SI aTexto1 = "";
         |ESTADO_CONTROL nSubBoton1, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO EventoTree2;
     |ESTADO_CONTROL nSubBoton1, "DISABLE";
     |ESTADO_CONTROL nSubBoton2, "ENABLE";

     aAlfa       = Contenido;  |QBF aAlfa;
     aTexto2     = "";
     aLong       = aAlfa % 0;
     nLong       = aLong;
     nCargar     = 0;
     |PARA nPosi = 1;  |SI nPosi [ nLong;  |HACIENDO nPosi = nPosi + 1;
           nPos = (nPosi * 100) + 1;
           aCarac = aAlfa % nPos;

           |SI nCargar = 1;
               aTexto2 = aTexto2 + aCarac;
           |FINSI;

           |SI aCarac = ":";  nCargar = 1; |FINSI;
     |SIGUE;

     |SI aTexto2 = "";
         |ESTADO_CONTROL nSubBoton2, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO CargaArbol;
     |QBF aAlfa;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO abom0603A;
     nCarpeta2 = nCarpeta2  + 1;

     aAlfa1 = #603#2;   |QBF aAlfa1;
     aAlfa  = ("00000" + #603#1) % -105;
     aAlfa2 = aAlfa  % 102;
     aAlfa3 = aAlfa  % 303;

     |SI aAlfa2 ! aAlfaAnt;
         nCarpeta1 = nCarpeta1 + 1;
         aAlfa     = nCarpeta1 + ":" + aAlfa2 + " - " + #603#5 + " - " + #603#2;
         nCarpeta2 = 0;
         |HAZ CargaArbol;
     |FINSI;

     aAlfaAnt  = aAlfa2;
     nCarpeta2 = nCarpeta2 + 1;

     aAlfa = nCarpeta1 + "," + nCarpeta2 + ":" + aAlfa3 + " - " + #603#3;
     aAlfa     = aAlfa + "{{";
     aAlfa     = aAlfa + aAlfa2;
     aAlfa     = aAlfa + aAlfa3;
     aAlfa     = aAlfa + #603#3;
     aAlfa     = aAlfa + #603#8;
     aAlfa     = aAlfa + (#603#6 + "    ") % 104;
     aAlfa     = aAlfa +  "}}";
     |HAZ CargaArbol;
|FPRC;

|DEFBUCLE abom0603A;
     #603#1;
     ;
     #904#0, 00000;
     #904#0, 99999;
     ;
     NULL, abom0603A;
|FIN;

|PROCESO CargaTemporal;
     aMas  = aBase + "def/" + aFichero;
     |CARGA_DEF aMas, referen@;
     |SI FSalida ! 0;
         |MENAV  "         Error en cargar el Def ... Proceso Abortado.";
         |ACABA;
     |FINSI;

     nContador  = nContador + 1;
     aQueQuiero = "|TITULO";
     aTitulo    = #referen@#aQueQuiero#;  |QBF aTitulo;

     |SI aFichero ! "abom0505";
         |SI nSwNuest = 1;  aTitulo = aTitulo + " Nuestros";    |FINSI;
         |SI nSwNuest = 2;  aTitulo = aTitulo + " Contrarios";  |FINSI;
     |SINO;
         |SI nSwNuest = 1;  aTitulo = "Director Expediente";    |FINSI;
         |SI nSwNuest = 2;  aTitulo = "Prof.Apertura Expe.";    |FINSI;
     |FINSI;

     aTitulo = (aTitulo + (" " * 40)) % 140;

     nCarpeta1 = nCarpeta1 + 1;
     aAlfa     = nCarpeta1 + ":" + (("00" + nContador) % -102) + " - "  + aFichero + " - " + aTitulo;
     |HAZ CargaArbol;

     nCarpeta2  = 0;
     aQueQuiero = "|NC";
     aNumCampos = #referen@#aQueQuiero#;
     nNumCampos = aNumCampos;
     nNumCampos = nNumCampos - 1;
     |PARA nCampos = 0;  |SI nCampos [ nNumCampos;  |HACIENDO nCampos = nCampos + 1;
           aQueQuiero = "|C" + (("000" + nCampos) % -103) + "NOMBRE";
           aNombCampo = #referen@#aQueQuiero#;
           aNombCampo = (aNombCampo + (" " * 20)) % 120;

           aQueQuiero = "|C" + (("000" + nCampos) % -103) + "TIPO";
           aTipoCampo = #referen@#aQueQuiero#;

           aQueQuiero = "|C" + (("000" + nCampos) % -103) + "LONGITUD";
           aLongCampo = #referen@#aQueQuiero#;
           aLongCampo = (aLongCampo + (" " * 4)) % 104;

           nCarpeta2 = nCarpeta2 + 1;
           aAlfa     = nCarpeta1 + "," + nCarpeta2 + ":";
           aAlfa     = aAlfa + (("000" + nCampos) % -103) + " - "  + aNombCampo;
           aAlfa     = aAlfa + "{{";
           aAlfa     = aAlfa + (("00" + nContador) % -102);
           aAlfa     = aAlfa +  (("000" + nCampos) % -103);
           aAlfa     = aAlfa +  aNombCampo;
           aAlfa     = aAlfa +  aTipoCampo;
           aAlfa     = aAlfa +  aLongCampo;
           aAlfa     = aAlfa +  aLongCampo;
           aAlfa     = aAlfa +  aTitulo;
           aAlfa     = aAlfa +  aFichero;
           aAlfa     = aAlfa +  nSwNuest;

           aAlfa     = aAlfa +  "}}";
           |HAZ CargaArbol;
     |SIGUE;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO ParaAsignar;
     |SI nTree1 ! -1;
         |FIN_CONTROL_WINDOWS nTree1;
         nTree1 = -1;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aAlfa = aBase + "basura";          |MKDIR aAlfa;

     eaRutaOrigen  = aBase + "basura/";
     eaRutaDestino = eaUnidadBasico + "\documentos";           |RMKDIR eaRutaDestino;
     eaRutaDestino = eaUnidadBasico + "\documentos\tmp";       |RMKDIR eaRutaDestino;
     eaRutaDestino = eaUnidadBasico + "\documentos\tmp\";
     eaFicheroTxt  = "abxz005402" + Usuario + ".txt";
     eaFicheroTgz  = "abxz005402" + Usuario + ".tgz";
     eaFicheroTar  = "abxz005402" + Usuario + ".tar";

     aAbre = eaRutaOrigen + eaFicheroTxt;

     sT_nID_1   = nTree1;
     sT_nOper_1 = 0;

     |XABRE "WB", aAbre, nHandle;

     nContador = 0;
     nCarpeta1 = 0;
     |SI #904#5 = "E";
         nSwNuest = 0;   aFichero = "abom0001";  |HAZ CargaTemporal;
                         aFichero = "asclient";  |HAZ CargaTemporal;
                         aFichero = "abom0501";  |HAZ CargaTemporal;
         nSwNuest = 1;   aFichero = "abom0502";  |HAZ CargaTemporal;
         nSwNuest = 2;   aFichero = "abom0502";  |HAZ CargaTemporal;
         nSwNuest = 1;   aFichero = "abom0503";  |HAZ CargaTemporal;
         nSwNuest = 2;   aFichero = "abom0503";  |HAZ CargaTemporal;
         nSwNuest = 1;   aFichero = "abom0505";  |HAZ CargaTemporal;
         nSwNuest = 2;   aFichero = "abom0505";  |HAZ CargaTemporal;
         nSwNuest = 0;   aFichero = "abom0504";  |HAZ CargaTemporal;
                         aFichero = "abom0506";  |HAZ CargaTemporal;
                         aFichero = "asempres";  |HAZ CargaTemporal;
                         aFichero = "aboy0004";  |HAZ CargaTemporal;
                         aFichero = "abom0003";  |HAZ CargaTemporal;
                         aFichero = "abom0004";  |HAZ CargaTemporal;
     |SINO;
                         nContador = 1;
                         aFichero  = "asclient";  |HAZ CargaTemporal;
     |FINSI;

     |XCIERRA nHandle;

     |HAZ TraeTxtComprimido;
     aAlfa = eaRutaDestino + eaFicheroTxt;

     eaAlfa = "TREECTRL,Para asignar {{" + aAlfa + "}}";
     |CONTROL_SIMPLE nSubPanta, eaAlfa, 1102, 2645, EventoTree1;
     nTree1 = FSalida;

     eaFicheroTxt  = "abxz005402" + Usuario + ".txt";
     aAlfa         = eaRutaDestino + eaFicheroTxt;
     |RFBORRA aAlfa;

     aRefresca = "";
     |SI aBusca1 ! "";
         sT_nID_1   = nTree1;
         sT_nOper_1 = 3;
         sT_aData_1 = "[" + aBusca1;
         |ESPECIFICA "COMMANDCONTROL", sTree_1;
         aRefresca = ":" + FSalida;
     |FINSI;

     sT_nID_1   = nTree1;
     sT_nOper_1 = 2;
     |SI aRefresca = "";
         sT_aData_1 = "1:";
     |SINO;
         sT_aData_1 = aRefresca;
     |FINSI;
     |ESPECIFICA "COMMANDCONTROL", sTree_1;
|FPRC;

|PROCESO ParaAsignados;
     |SI nTree2 ! -1;
         |FIN_CONTROL_WINDOWS nTree2;
         nTree2 = -1;
     |FINSI;

     eaRutaOrigen  = aBase + "basura/";
     eaRutaDestino = eaUnidadBasico + "\documentos";           |RMKDIR eaRutaDestino;
     eaRutaDestino = eaUnidadBasico + "\documentos\tmp";       |RMKDIR eaRutaDestino;
     eaRutaDestino = eaUnidadBasico + "\documentos\tmp\";
     eaFicheroTxt  = "abxz005403" + Usuario + ".txt";
     eaFicheroTgz  = "abxz005403" + Usuario + ".tgz";
     eaFicheroTar  = "abxz005403" + Usuario + ".tar";

     aAbre = eaRutaOrigen + eaFicheroTxt;

     sT_nID_2   = nTree2;
     sT_nOper_2 = 0;

     |XABRE "WB", aAbre, nHandle;

     nContador = 0;
     nCarpeta1 = 0;
     nCarpeta2 = 0;
     aAlfaAnt  = "";
     |BUCLE abom0603A;

     |XCIERRA nHandle;

     |HAZ TraeTxtComprimido;
     aAlfa = eaRutaDestino + eaFicheroTxt;

     eaAlfa = "TREECTRL,Asignados {{" + aAlfa + "}}";
     |CONTROL_SIMPLE nSubPanta, eaAlfa, 1155, 2698, EventoTree2;
     nTree2 = FSalida;

     eaFicheroTxt  = "abxz005403" + Usuario + ".txt";
     aAlfa         = eaRutaDestino + eaFicheroTxt;
     |RFBORRA aAlfa;

     aRefresca = "";
     |SI aBusca2 ! "";
         sT_nID_2   = nTree2;
         sT_nOper_2 = 3;
         sT_aData_2 = "[" + aBusca2;
         |ESPECIFICA "COMMANDCONTROL", sTree_2;
         aRefresca = ":" + FSalida;
     |FINSI;

     sT_nID_2   = nTree2;
     sT_nOper_2 = 2;
     |SI aRefresca = "";
         sT_aData_2 = "1:";
     |SINO;
         sT_aData_2 = aRefresca;
     |FINSI;
     |ESPECIFICA "COMMANDCONTROL", sTree_2;
|FPRC;

|PROCESO MontaArbolCampos;
     |CONTROL_SIMPLE 0, "LABEL,{{5}}Cargando informaci¢n ...", 1315, 1680, NULL;
     nBotonLabel = FSalida;

     |PTEC 802;  |PAUSA;

     |HAZ ParaAsignar;
     |HAZ ParaAsignados;

     |FIN_CONTROL_WINDOWS nBotonLabel;
     |PULSATECLA;

     |FOCOTECLADO nTree1;

     |ESTADO_CONTROL nSubBoton1, "DISABLE";
     |ESTADO_CONTROL nSubBoton2, "DISABLE";
|FPRC;

|PROCESO Tipo12Fxw4;  |TIPO 12;
     |SI FSalida = 7;  |ACABA;  |FINSI;

     efFechaDocu = "00.00.0000";
     enCodUbica  = #904#2;  |HAZ LeeUbicaciones;
     eaExtension = eaExtension < "";

     aDestino = eaRutaDocumento + "/" + #904#4;   |QBF aDestino;
     aDestino = aDestino + "." + eaExtension;     |QBF aDestino;

     |SI #514#21 ! "C";
         |XABRE "EC", aDestino, nCanal;
     |SINO;
         |XABRE "E", aDestino, nCanal;
     |FINSI;

     |SI FSalida < 0;
         |MENAV "0000 No se ha creado el documento en word. Por favor pinche en la opci¢n Editar documento en word";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo0C2Fxw4;  |TIPO 0;
     efFechaDocu = "00.00.0000";
     enCodUbica  = #904#2;  |HAZ LeeUbicaciones;
     eaRuta      = eaRutaDocumento;

     |SI enTipoDocumento ! 1;
         |MENAV "     El programa externo debe ser Tipo WORD.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo0C4Fxw4;  |TIPO 0;
     #904#4 = #904#4 > " ";   |PINTA #904#4;

     aAlfa = #904#4;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "      Introduzca el Nombre del Documento.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo0C5Fxw4;  |TIPO 0;
     |SI nModo = 1;
         |HAZ MontaArbolCampos;
     |FINSI;
|FPRC;

|PROCESO Asignar;
     aAlfa  = aTexto1 % 105;

     #603#0 = #904#0;
     #603#1 = aAlfa;
     |LEE 000#603=;
     |SI FSalida = 0;
         |MENAV "0000 El campo ya estaba asignado de anterioridad.";
         |ACABA;
     |FINSI;

     |DDEFECTO #603;
     #603#0 = #904#0;
     #603#1 = aAlfa;
     aAlfa  = aTexto1 % 3540;  #603#2 = aAlfa;
     aAlfa  = aTexto1 % 0620;  #603#3 = aAlfa;
     aAlfa  = aTexto1 % 7508;  #603#5 = aAlfa;
     aAlfa  = aTexto1 % 2704;  #603#6 = aAlfa;
     aAlfa  = aTexto1 % 8301;  #603#7 = aAlfa;
     aAlfa  = aTexto1 % 2601;  #603#8 = aAlfa;
     |GRABA 020#603n;
     |LIBERA #603;

     aAlfa1 = #603#2;   |QBF aAlfa1;
     aAlfa  = ("00000" + #603#1) % -105;
     aAlfa2 = aAlfa  % 102;
     aAlfa3 = aAlfa  % 303;

     aAlfa     = aAlfa2;
     aAlfa     = aAlfa + aAlfa3;
     aAlfa     = aAlfa + #603#3;
     aAlfa     = aAlfa + #603#8;
     aAlfa     = aAlfa + (#603#6 + "    ") % 104;
     aBusca2   = aAlfa;

     |HAZ ParaAsignados;
|FPRC;

|PROCESO DesAsignar;
     aAlfa  = aTexto2 % 105;

     #603#0 = #904#0;
     #603#1 = aAlfa;
     |LEE 101#603=;
     |SI FSalida = 0;
         |BORRA 020#603a;
         |LIBERA #603;
     |FINSI;

     |LEE 000#603a;
     |SI FSalida ! 0;
         |LEE 000#603u;
     |FINSI;

     |SI FSalida ! 0;  |DDEFECTO #603;  |FINSI;

     aAlfa1 = #603#2;   |QBF aAlfa1;
     aAlfa  = ("00000" + #603#1) % -105;
     aAlfa2 = aAlfa  % 102;
     aAlfa3 = aAlfa  % 303;

     aAlfa     = aAlfa2;
     aAlfa     = aAlfa + aAlfa3;
     aAlfa     = aAlfa + #603#3;
     aAlfa     = aAlfa + #603#8;
     aAlfa     = aAlfa + (#603#6 + "    ") % 104;
     aBusca2   = aAlfa;

     |HAZ ParaAsignados;
|FPRC;

|| *************************************************************************

|PROCESO abom0603B;
     |BORRA 020#603a;
     |LIBERA #603;
|FPRC;

|DEFBUCLE abom0603B;
     #603#1;
     ;
     #602#0, 00000
     #602#0, 99999;
     be;
     NULL, abom0603B;
|FIN;

|PROCESO BorraDocumento;
     efFechaDocu = "00.00.0000";
     enCodUbica  = #602#2;  |HAZ LeeUbicaciones;
     eaExtension = eaExtension < "";

     aFicheroActu = #602#4;                              |QBF aFicheroActu;
     aFicheroActu = aFicheroActu + "." + eaExtension;    |QBF aFicheroActu;
     aAlfa        = eaRutaDocumento + "/" + aFicheroActu;
     |SI #514#21 ! "C";
         |RFBORRA aAlfa;
     |SINO;
         |FBORRA aAlfa;
     |FINSI;
|FPRC;

|PROCESO NuevoMailing;
     nModo = 1;
     |DDEFECTO #904;

     |LEE 000#602u;
     |SI FSalida ! 0;  |DDEFECTO #602;  |FINSI;

     |SI #602#0 > 999;
         |PARA nCampo = 1;  |SI nCampo [ 1000;  |HACIENDO nCampo = nCampo + 1;
               #602#0 = nCampo;
               |LEE 000#602=;
               |SI FSalida ! 0;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     #602#0 = #602#0 + 1;

     |SI #602#0 > 999;
         |MENAV "0000 Ya tenemos 999 mailing creados, borre alguno que no use.";
         |ACABA;
     |FINSI;

     #904#0 = #602#0;

     |VENTANA 0501, 2799, -1, 17, "Nuevo Mailing";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#904;
     nSubPanta = FSalida;

     |CONTROL_SIMPLE nSubPanta, "BOTON,{{202}}", 1549, 1751, Asignar;
     nSubBoton1 = FSalida;

     |CONTROL_SIMPLE nSubPanta, "BOTON,{{201}}", 2049, 2251, DesAsignar;
     nSubBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Editar documento en word", 2602, 2720, Editar;
     nSubBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{205}}Imprimir plantilla de variables", 2625, 2740, Plantilla;
     nSubBoton4 = FSalida;

     |C_M #904#5, 1, "S";

     |PINDA #0#904;

     aBusca1 = "";
     aBusca2 = "";
     |HAZ MontaArbolCampos;

     |ENDATOS #1#904;
     |SI FSalida = 0;
         #602#0 = #904#0;
         #602#1 = #904#1;
         #602#2 = #904#2;
         #602#3 = #904#3;
         #602#4 = #904#4;
         #602#5 = #904#5;
         #602#6 = #904#6;

         |GRABA 020#602n;
         |LIBERA #602;
     |SINO;
         #602#0 = #904#0;
         #602#2 = #904#2;
         #602#4 = #904#4;
         |BUCLE abom0603B;
         |HAZ BorraDocumento;

         |LEE 000#602u;
         #904#0 = #602#0;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FIN_CONTROL_WINDOWS nTree1;
     |FIN_CONTROL_WINDOWS nTree2;
     |FIN_CONTROL_WINDOWS nSubBoton1;
     |FIN_CONTROL_WINDOWS nSubBoton2;
     |FIN_CONTROL_WINDOWS nSubBoton3;
     |FIN_CONTROL_WINDOWS nSubBoton4;

     nTree1 = -1;
     nTree2 = -1;

     |FINVENTANA nSubVent;

     aBusca = #904#0;
     |HAZ MontaArbol;
|FPRC;

|PROCESO ModificarMailing;
     nModo = 2;

     #602#0 = aTexto;
     |LEE 101#602=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |DDEFECTO #904;

     #904#0  = #602#0;
     #904#1  = #602#1;
     #904#2  = #602#2;
     #904#3  = #602#3;
     #904#4  = #602#4;
     #904#5  = #602#5;
     #904#6  = #602#6;

     |VENTANA 0501, 2799, -1, 17, "Modificar Mailing";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#904;
     nSubPanta = FSalida;

     |CONTROL_SIMPLE nSubPanta, "BOTON,{{202}}", 1549, 1751, Asignar;
     nSubBoton1 = FSalida;

     |CONTROL_SIMPLE nSubPanta, "BOTON,{{201}}", 2049, 2251, DesAsignar;
     nSubBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Editar documento en word", 2602, 2720, Editar;
     nSubBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{205}}Imprimir plantilla de variables", 2625, 2740, Plantilla;
     nSubBoton4 = FSalida;

     |C_M #904#5, 1, "N";

     |PINDA #0#904;

     aBusca1 = "";
     aBusca2 = "";
     |HAZ MontaArbolCampos;

     |ENDATOS #1#904;
     |SI FSalida = 0;
         #602#1 = #904#1;
         #602#2 = #904#2;
         #602#3 = #904#3;
         #602#4 = #904#4;
         #602#5 = #904#5;
         #602#6 = #904#6;

         |GRABA 020#602a;
         |LIBERA #602;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FIN_CONTROL_WINDOWS nTree1;
     |FIN_CONTROL_WINDOWS nTree2;
     |FIN_CONTROL_WINDOWS nSubBoton1;
     |FIN_CONTROL_WINDOWS nSubBoton2;
     |FIN_CONTROL_WINDOWS nSubBoton3;
     |FIN_CONTROL_WINDOWS nSubBoton4;

     nTree1 = -1;
     nTree2 = -1;

     |FINVENTANA nSubVent;

     aBusca = #904#0;
     |HAZ MontaArbol;
|FPRC;


|PROCESO BorrarMailing;
     #602#0 = aTexto;
     |LEE 101#602=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CONFI "0000NSeguro que quiere borrar el mailing seleccionado";
     |SI FSalida ! 0;
         |LIBERA #602;
         |ACABA;
     |FINSI;

     |BUCLE abom0603B;

     |BORRA 020#602a;
     |LIBERA #602;

     |HAZ BorraDocumento;

     |LEE 000#602p;
     aBusca = #602#0;
     |HAZ MontaArbol;
|FPRC;

|PROCESO EventoTree;
     |SI FEntrada ! 0;  |ACABA;  |FINSI;

     aAlfa       = Contenido;  |QBF aAlfa;
     aTexto      = "";
     aLong       = aAlfa % 0;
     nLong       = aLong;
     nCargar     = 0;
     |PARA nPosi = 1;  |SI nPosi [ nLong;  |HACIENDO nPosi = nPosi + 1;
           nPos = (nPosi * 100) + 1;
           aCarac = aAlfa % nPos;

           |SI nCargar = 1;
               aTexto = aTexto + aCarac;
           |FINSI;

           |SI aCarac = ":";  nCargar = 1; |FINSI;
     |SIGUE;

     |ESTADO_CONTROL nBoton2, "ENABLE";
     |ESTADO_CONTROL nBoton3, "ENABLE";

     aAlfa = aTexto % 102;
     |SI aTexto = "";
         |ESTADO_CONTROL nBoton2, "DISABLE";
         |ESTADO_CONTROL nBoton3, "DISABLE";
     |FINSI;
|FPRC;


|PROCESO abom0603;
     nCarpeta2 = nCarpeta2  + 1;

     aAlfa1 = #603#2;   |QBF aAlfa1;
     aAlfa2 = ("00000" + #603#1) % -105;
     aAlfa2 = "#" + (aAlfa2 % 102) + "#" + "0" + (aAlfa2 % 303);
     aAlfa3 = #603#3;   |QBF aAlfa3;

     aAlfa = nCarpeta1 + "," + nCarpeta2 + ":" + aAlfa2 + " - " + aAlfa3 + " (" + aAlfa1 + ")";
     |HAZ CargaArbol;
|FPRC;

|DEFBUCLE abom0603;
     #603#1;
     ;
     #602#0, 00000;
     #602#0, 99999;
     ;
     NULL, abom0603;
|FIN;

|PROCESO abom0602;
     nCarpeta1 = nCarpeta1  + 1;

     aAlfa = nCarpeta1 + ":" + (("000" + #602#0) % -103) + " - " + #602#1;  |QBF aAlfa;
     aAlfa = aAlfa + " {{" + #602#0 + "}}";
     |HAZ CargaArbol;

     nCarpeta2 = 0;
     |BUCLE abom0603;
|FPRC;

|DEFBUCLE abom0602;
     #602#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, abom0602;
|FIN;

|PROCESO MontaArbol;
     |SI nTree ! -1;
         |FIN_CONTROL_WINDOWS nTree;
         nTree = -1;
     |FINSI;

     |CONTROL_SIMPLE 0, "LABEL,{{5}}Cargando informaci¢n ...", 1315, 1680, NULL;
     nBotonLabel = FSalida;

     |PTEC 802;  |PAUSA;

     |DBASE aBase;  |QBF aBase;
     aAlfa = aBase + "basura";          |MKDIR aAlfa;

     eaRutaOrigen  = aBase + "basura/";
     eaRutaDestino = eaUnidadBasico + "\documentos";           |RMKDIR eaRutaDestino;
     eaRutaDestino = eaUnidadBasico + "\documentos\tmp";       |RMKDIR eaRutaDestino;
     eaRutaDestino = eaUnidadBasico + "\documentos\tmp\";
     eaFicheroTxt  = "abxz005401" + Usuario + ".txt";
     eaFicheroTgz  = "abxz005401" + Usuario + ".tgz";
     eaFicheroTar  = "abxz005401" + Usuario + ".tar";

     aAbre = eaRutaOrigen + eaFicheroTxt;

     sT_nID   = nTree;
     sT_nOper = 0;

     |XABRE "WB", aAbre, nHandle;

     nCarpeta1 = 0;

     |BUCLE abom0602;

     |XCIERRA nHandle;

     |HAZ TraeTxtComprimido;
     aAlfa = eaRutaDestino + eaFicheroTxt;

     eaAlfa = "TREECTRL,Mailing {{" + aAlfa + "}}";
     |CONTROL_SIMPLE nPanta, eaAlfa, 0702, 2598, EventoTree;
     nTree = FSalida;

     eaFicheroTxt  = "abxz005401" + Usuario + ".txt";
     aAlfa         = eaRutaDestino + eaFicheroTxt;
     |RFBORRA aAlfa;

     |FIN_CONTROL_WINDOWS nBotonLabel;

     |SI aBusca ! "";
         sT_nID   = nTree;
         sT_nOper = 3;
         sT_aData = "[" + aBusca;
         |ESPECIFICA "COMMANDCONTROL", sTree;
         aRefresca = ":" + FSalida;
     |FINSI;

     sT_nID   = nTree;
     sT_nOper = 2;
     |SI aRefresca = "";
         sT_aData = "1:";
     |SINO;
         sT_aData = aRefresca;
     |FINSI;

     |ESPECIFICA "COMMANDCONTROL", sTree;
     |PULSATECLA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     |ABRE #514;
     |LEE 000#514p;
     |SI FSalida ! 0;  |DDEFECTO #514;  |FINSI;
     |CIERRA #514;

     FSalida = 2799;
|FPRC;

|PROGRAMA;
     |HAZ LeeUnidadBasico;

     |ABRET #602;
     |ABRET #603;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;   |QBT aIPRemoto;
     |SI aIPRemoto = "";
         aIPRemoto = "LOCAL";
         aNombreIP = "MAQUINA LOCAL";
     |SINO;
         |NOMBRE_IP aIPRemoto, aNombreIP;
     |FINSI;

     |CLS;
     |CABEZA "Mailing";

     |PINPA #0#954;
     nPanta = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{193}}Nuevo Mailing", 2634, 2654, NuevoMailing;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Modificar Mailing", 2656, 2676, ModificarMailing;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{199}}Borrar Mailing", 2678, 2698, BorrarMailing;
     nBoton3 = FSalida;

     |HAZ MontaArbol;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nTree;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nTree;
     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;

     |CIERRAT #602;
     |CIERRAT #603;
|FPRO;
