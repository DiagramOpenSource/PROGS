|FICHEROS;
     abxz0057 #957;

     abom0001 #1;
     abom0002 #2;
     abom0012 #12;
     abom0013 #13;
     abom0020 #20;

     abom0514 #514;
     abom0518 #518;
|FIN;

|VARIABLES;
     &enNumExpeCorreo = 0;

     nRango          = 0;
     nHandle         = 0;
     nLong           = 0;
     nCaracter       = 0;
     nPos            = 0;
     nVentana        = 0;
     nSubVent        = 0;
     nVent           = 0;
     nCampo          = 0;
     nBoton1         = -1;
     nBoton2         = -1;
     nBoton3         = -1;
     nBoton4         = -1;
     nBoton5         = -1;
     nBoton6         = -1;
     nSubBoton1      = 0;
     nDExpediente    = 0;
     nHExpediente    = 0;
     nSubPanta       = 0;
     nModo           = 0;
     nCont           = 0;
     nPasa           = 0;
     nError          = 0;
     nPosi           = 0;
     nLen            = 0;
     nSwEnvio        = 0;
     nSwMensaje      = 0;
     nDirecto        = 0;
     nNume1          = 0;
     nNume2          = 0;
     nTecla          = 0;
     nSwPon          = 0;
     nLinea          = 0;
     nGuardaExpe     = 0;

     fFecha          = @;

     aEsc1           = "";
     aEsc2           = "";
     aRetu           = "";
     aTecla          = "";
     aAlfa           = "";
     aHora           = "";
     aNumero         = "";
     aPersona        = "";
     aCadena         = "";
     aComodin        = "";
     aAbre           = "";
     aBase           = "";
     aMas            = "";
     aRutaCorreo     = "";
     aCorreo         = "";
     aEjecuta        = "";
     aEnviado        = "";
     aRef            = "";
     aFic            = "";
     aIncidencia     = "";
     aLen            = "";
     aCaracter       = "";
     aReferencia     = "";
     aFicheroActu    = "";
     aDSCorreo       = "";
     aProxy          = "";
     aUsu            = "";
     aPwd            = "";
     aNombre         = "";
     aAlfa1          = "";
     aDirOri         = "";
     aDirDes         = "";
     aTitulo         = "";
     aTexto          = "";
     aMenLog         = "";
     aOrigen         = "";
     aDestino        = "";

     {-1}aVent       = "";
         aVent1      = 0;
         aVent2      = 0;
         aVent3      = 0;
         aVent4      = 0;
         aVent5      = "";


     {1}aContiene    = "";

     &enGrid1         = 0;
     &enPanta0        = 0;
     &enSubPanta      = 0;
     &enExped         = 0;
     &enLabel1        = -1;
     &enLabel2        = -1;
     &enLabel3        = -1;
     &enExpediente    = 0;
     &enCodUbica      = 0;
     &eaRutaDocumento = "";
     &efFechaDocu     = @;
     &eaFicheroEdita  = "";
     &eaFichAdjunto   = "";
     &enCodExpe       = 0;
     &enCodPers       = 0;
     &enCuenta        = 0;
     &enFSalida       = 0;
|FIN;

|PROCESO Desaparecen;
     |ESTADO_CONTROL enGrid1, "DISABLE";

     |HAZ QuitaBotonSalir1;

     |SI nBoton1 ! -1;  |ESTADO_CONTROL nBoton1, "HIDE";  |FINSI;
     |SI nBoton2 ! -1;  |ESTADO_CONTROL nBoton2, "HIDE";  |FINSI;
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "HIDE";  |FINSI;
     |SI nBoton4 ! -1;  |ESTADO_CONTROL nBoton4, "HIDE";  |FINSI;
     |SI nBoton5 ! -1;  |ESTADO_CONTROL nBoton5, "HIDE";  |FINSI;
     |SI nBoton6 ! -1;  |ESTADO_CONTROL nBoton6, "HIDE";  |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO Aparecen;
     |ESTADO_CONTROL enGrid1, "ENABLE";

     |HAZ PonBotonSalir1;

     |SI nBoton1 ! -1;  |ESTADO_CONTROL nBoton1, "SHOW";  |FINSI;
     |SI nBoton2 ! -1;  |ESTADO_CONTROL nBoton2, "SHOW";  |FINSI;
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "SHOW";  |FINSI;
     |SI nBoton4 ! -1;  |ESTADO_CONTROL nBoton4, "SHOW";  |FINSI;
     |SI nBoton5 ! -1;  |ESTADO_CONTROL nBoton5, "SHOW";  |FINSI;
     |SI nBoton6 ! -1;  |ESTADO_CONTROL nBoton6, "SHOW";  |FINSI;
|FPRC;

|PROCESO Recoger;
     |HAZ Desaparecen;

     |SUB_EJECUTA "aboz0012;X";

     |HAZ Aparecen;

     |PULSATECLA;

     |REFRESCACONTROL enGrid1;
     |FOCOTECLADO enGrid1;
|FPRC;

|| **************************************************************************
|| PROCESO DE LA BANDEJA DE ENTRADA GENERAL
|| **************************************************************************

|PROCESO PonEnExpediente12;
     |LEE 101#12=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nLinea = 1;
     #13#0 = #12#1;
     #13#1 = 9999;
     |LEE 040#13];
     |SI FSalida = 0;
         |LEE 040#13a;
     |SINO;
         |LEE 040#13u;
     |FINSI;
     |SI FSalida = 0;  |Y #13#0 = #12#1;
         nLinea = #13#1 + 1;
     |FINSI;

     |DDEFECTO #13;
     #13#0 = #12#1;
     #13#1 = nLinea;
     #13#2 = #12#2;
     #13#3 = #12#3;
     #13#4 = #12#4;
     #13#5 = #12#5;
     #13#6 = #12#6;
     |GRABA 020#13n;
     |LIBERA #13;

     |BORRA 020#12a;
     |LIBERA #12;

     efFechaDocu    = #12#6;
     enCodUbica     = #514#9;  |HAZ LeeUbicaciones;
     eaFicheroEdita = (("00000000" + #12#0) % -108) + ".eml"; |QBF eaFicheroEdita;
     aOrigen        = eaRutaDocumento + "/" + eaFicheroEdita;
     eaFicheroEdita = (("00000000" + #13#0) % -108) + (("0000" + #13#1) % -104) + ".eml"; |QBF eaFicheroEdita;
     aDestino       = eaRutaDocumento + "/" + eaFicheroEdita;

     |SI #514#21 ! "C";
         |RCOPIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |ABRE #2;
     #2#0 = #12#1;
     #2#1 = 99999;
     |LEE 000#2];
     |SI FSalida = 0;
         |LEE 000#2a;
     |SINO;
         |LEE 000#2u;
     |FINSI;

     nLinea = 1;
     |SI FSalida = 0;  |Y #2#0 = #12#1;
         nLinea = #2#1 + 1;
     |FINSI;

     |DDEFECTO #2;
     #2#0 = #12#1;
     #2#1 = nLinea;
     |GRABA 020#2b;

     #2#2  = "CORREO RECIBIDO: " + #12#2;

     |SI #2#1 [ 999;
         #2#3 = "w" + (("00000000" + #2#0) % -108) + (("000" + #2#1) % -103) + ".eml";
     |SINO;
         #2#3 = "w" + (("00000000" + #2#0) % -108) + (("00000" + #2#1) % -105) + ".eml";
     |FINSI;

     #2#4  = #12#6;

     |HORA aHora;
     aAlfa = aHora % 102;  #2#5 = aAlfa;
     aAlfa = aHora % 402;  #2#6 = aAlfa;

     #2#7  = #2#4;
     #2#8  = #2#5;
     #2#9  = #2#6;
     #2#10 = #514#9;

     aDestino  = eaRutaDocumento + "/" + #2#3;  |QBF aDestino;

     |SI #514#21 ! "C";
         |RCOPIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
     |RFBORRA aOrigen;

     |GRABA 020#2a;
     |LIBERA #2;
     |CIERRA #2;

     |ABRE #1;
     #1#0 = #2#0;
     |LEE 000#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     |ABRE #20;
     #20#0 = #1#28;
     #20#1 = ~;
     #20#2 = aHora;
     #20#3 = #2#0;
     #20#4 = #1#29;
     #20#5 = #2#1;
     #20#6 = #2#2;
     #20#7 = "N";
     |GRABA 020#20n;
     |LIBERA #20;
     |CIERRA #20;
|FPRC;

|PROCESO EnviaEco12;
     |MENSA "0000 Enviando ECO";

     |VENTANA 0501, 2799, -1, 17, "Env¡o de ECO - Cuentas de correos - Pulse doble click sobre la cuenta por la que quiere enviar";
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SUB_EJECUTA_NP "abom0518;PIDECUENTAX";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;

     |ABRE #518;
     #518#0 = enCuenta;
     |LEE 040#518=;
     |SI FSalida ! 0;
         |MENAV "       No existe la Cuenta de Correo.";
         |ACABA;
     |FINSI;
     |CIERRA #518;

     |SI #518#8 ! "S";
         |MENAV "0000 No se envia ECO ya que la cuenta lo tiene desactivado.";
         |ACABA;
     |FINSI;

     aDirDes = "";
     aAlfa1  = #12#4;
     nSwPon  = 0;
     |PARA nCaracter = 1;  |SI nCaracter [ 50;  |HACIENDO nCaracter = nCaracter + 1;
          nPosi     = (100 * nCaracter) + 1;
          aCaracter = aAlfa1 % nPosi;

          |SI aCaracter = ">";  |SAL;        |FINSI;

          |SI nSwPon = 1;  aDirDes = aDirDes + aCaracter;  |FINSI;

          |SI aCaracter = "<";  nSwPon = 1;  |FINSI;
     |SIGUE;

     |SI nSwPon = 0;
         aDirDes = "";
         |PARA nCaracter = 1;  |SI nCaracter [ 50;  |HACIENDO nCaracter = nCaracter + 1;
               nPosi     = (100 * nCaracter) + 1;
               aCaracter = aAlfa1 % nPosi;
               |SI aCaracter = " ";  |Y nSwPon = 1;
                   |SAL;
               |FINSI;

               aDirDes   = aDirDes + aCaracter;

               |SI aCaracter = " ";  aDirDes   = "";  |FINSI;
               |SI aCaracter = "@";  nSwPon    = 1;   |FINSI;
         |SIGUE;
     |FINSI;

     aBase  = "";
     |DBASE aBase;  |QBF aBase;
     aBase  = aBase + "correos/";  |MKDIR aBase;
     aFic   = aBase + "ECO.TXT";
     |XABRE "BW", aDestino, nHandle;
     aAlfa1 = "Comprobacion de lectura realizada" + &13 + &10;
     |XGRABA nHandle, aAlfa1;
     |XCIERRA nHandle;

     aDSCorreo = #518#2;           |QBF aDSCorreo;   || Direccion IP
     aUsu      = #518#6;           |QBF aUsu;        || usuario
     aPwd      = #518#7;           |QBF aPwd;        || password
     aProxy    = #518#4;           |QBF aProxy;      || servidor proxy

     aTitulo   = #12#2;            |QBF aTitulo;     || Asunto
     aDirOri   = #518#5;           |QBF aDirOri;     || Direccion Origen
     aTexto    = "Comprobacion de lectura realizada";|| Cuerpo

     aNombre   = "";

     aAlfa1 = "0000Enviando Eco [" + aDSCorreo + "] ...";
     |MENSA aAlfa1;

     |DSCORREO_ENVIA aDSCorreo, aProxy, aDirOri, aDirDes, aTitulo, aTexto, aFic;
     nError = FSalida;
     |BLIN 4;

     |SI nError < 0;
          aMenLog = "    Problemas al enviar correo ..." + nError;
          |MENAV aMenLog;
     |FINSI;

     |FBORRA aFic;
|FPRC;

|PROCESO Consulta12;
     |VENTANA 0501, 0520, -1, 16, "Consultando correo ";
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |HAZ Desaparecen;

     efFechaDocu    = #12#6;
     enCodUbica     = #514#9;  |HAZ LeeUbicaciones;
     eaFicheroEdita = (("00000000" + #12#0) % -108) + ".eml";
     |QBF eaFicheroEdita;
     aFicheroActu   = eaRutaDocumento + "/" + eaFicheroEdita;
     |HAZ AbreDocumento;

     |SI #12#5 = "N";  |Y #514#10 = "S";
         nError = -1;
         |HAZ EnviaEco12;

         |SI nError ] 0;
             |LEE 101#12=;
             |SI FSalida = 0;
                 #12#5 = "S";
                 |GRABA 020#12a;
                 |LIBERA #12;
             |FINSI;
         |SINO;
             aVent1 = -1;
             aVent2 = -1;
             aVent3 = 0;
             aVent4 = nVentana;
             aVent5 = "MODELESS";
             |ESPECIFICA "ESTADO_VENTANA", aVent;
             |FINVENTANA nVentana;

             |HAZ Aparecen;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #12#1 ! 0;
         |CONFI "0000SCorreo con Expediente. Desea enviarlo a la Bandeja del Expediente ";
         |SI FSalida = 0;
             |HAZ PonEnExpediente12;
         |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana;

     |HAZ Aparecen;

     |PULSATECLA;
     |REFRESCACONTROL enGrid1;
     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO PonExpediente12;
     enCodExpe = #12#1;

     |VENTANA 1101, 2699, -1, 16, "Buscar Expedientes (Doble click en la linea para seleccionar)";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SUB_EJECUTA_NP "abxz0002";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |SI enCodExpe ! 0;
         aAlfa = "0000NConfirma asignar el correo al expediente n£mero: " + enCodExpe;
         |CONFI aAlfa;
         |SI FSalida = 0;
             #12#1 = enCodExpe;
         |FINSI;
     |FINSI;

     |GRABA 020#12a;
     |LIBERA #12;

     |SI #12#1 ! 0;
         |CONFI "0000SCorreo con Expediente. Desea enviarlo a la Bandeja del Expediente ";
         |SI FSalida = 0;
             |HAZ PonEnExpediente12;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Asignar12;
     |LEE 101#12=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ Desaparecen;

     |SI #12#1 = 0;
         |HAZ PonExpediente12;
     |SINO;
         |CONFI "0000NEl Correo ya tiene asignado un expediente. Desea cambiarlo ";
         |SI FSalida = 0;
             |HAZ PonExpediente12;
         |FINSI;
     |FINSI;

     |HAZ Aparecen;

     |PULSATECLA;
     |REFRESCACONTROL enGrid1;
     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO Reenviar12;
     |LEE 000#12=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ Desaparecen;

     |VENTANA 0501, 2799, -1, 17, "Reennvio de correo";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     efFechaDocu    = #12#6;
     enCodUbica     = #514#9;  |HAZ LeeUbicaciones;
     eaFicheroEdita = (("00000000" + #12#0) % -108) + ".eml";  |QBF eaFicheroEdita;
     eaFichAdjunto  = eaRutaDocumento + "/" + eaFicheroEdita;
     enExped        = #12#1;
     enNumExpeCorreo = #12#1;

     |SUB_EJECUTA_NP "abxz0001";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;

     |HAZ Aparecen;

     |REFRESCACONTROL enGrid1;
     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO Nuevo12;
     |HAZ Desaparecen;

     |VENTANA 0501, 2799, -1, 17, "Env¡o de correo nuevo";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     efFechaDocu    = ~;
     eaFichAdjunto  = "";
     |SI enExped = 0;
         enExped = #12#1;
         enNumExpeCorreo = enExped;
     |FINSI;

     |SUB_EJECUTA_NP "abxz0001";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;

     |HAZ Aparecen;

     |REFRESCACONTROL enGrid1;
     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO Borrar12;
     |LEE 101#12=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CONFI "0000NSeguro que quiere borrar el correo";
     |SI FSalida ! 0;
         |LIBERA #12;
         |ACABA;
     |FINSI;

     |HAZ Desaparecen;

     efFechaDocu  = #12#6;
     enCodUbica   = #514#9;  |HAZ LeeUbicaciones;
     aFicheroActu = eaRutaDocumento + "/" + (("00000000" + #12#0) % -108) + ".eml";
     |SI #514#21 ! "C";
         |RFBORRA aFicheroActu;
     |SINO;
         |FBORRA aFicheroActu;
     |FINSI;

     |BORRA 020#12a;
     |LIBERA #12;

     |HAZ Aparecen;

     |PULSATECLA;
     |REFRESCACONTROL enGrid1;
     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO EventoPanta12;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#12=;
         |SI FSalida = 0;
             |ESTADO_CONTROL nBoton1, "ENABLE";
             |ESTADO_CONTROL nBoton2, "ENABLE";
             |ESTADO_CONTROL nBoton3, "ENABLE";
             |ESTADO_CONTROL nBoton4, "ENABLE";
         |SINO;
             |ESTADO_CONTROL nBoton1, "DISABLE";
             |ESTADO_CONTROL nBoton2, "DISABLE";
             |ESTADO_CONTROL nBoton3, "DISABLE";
             |ESTADO_CONTROL nBoton4, "DISABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
         |HAZ Consulta12;
     |FINSI;
|FPRC;

|PROCESO EntradaGeneral;
     |CONTROL_SIMPLE 0, "BOTON,{{197}} Consulta correo", 2602, 2717, Consulta12;
     nBoton1  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}} Asignar a un expediente", 2619, 2732, Asignar12;
     nBoton2  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}} Borrar correo", 2634, 2747, Borrar12;
     nBoton3  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{157}} Reenviar correo", 2649, 2764, Reenviar12;
     nBoton4  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{193}} Nuevo correo", 2666, 2781, Nuevo12;
     nBoton5  = FSalida;

     |CONTROL_SIMPLE enPanta0, "BOTON,{{157}} Recoger correo", 0678, 0798, Recoger;
     nBoton6  = FSalida;

     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton3, "DISABLE";
     |ESTADO_CONTROL nBoton4, "DISABLE";

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#12, nRango, 0802, 2698, NULL, NULL, EventoPanta12;
     enGrid1  = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + enGrid1;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
         |PULSATECLA;
     |SIGUE;

     |PULSATECLA;

     |DESTRUYECONTROL enGrid1;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
|FPRC;

|| **************************************************************************
|| PROCESO DE LA BANDEJA DE ENTRADA EXPEDIENTES
|| **************************************************************************

|PROCESO EnviaEco13;
     |MENSA "0000 Enviando ECO";

     |VENTANA 0501, 2799, -1, 17, "Env¡o de ECO - Cuentas de correos - Pulse doble click sobre la cuenta por la que quiere enviar";
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SUB_EJECUTA_NP "abom0518;PIDECUENTAX";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;

     |ABRE #518;
     #518#0 = enCuenta;
     |LEE 040#518=;
     |SI FSalida ! 0;
         |MENAV "       No existe la Cuenta de Correo.";
         |ACABA;
     |FINSI;
     |CIERRA #518;

     |SI #518#8 ! "S";
         |MENAV "0000 No se envia ECO ya que la cuenta lo tiene desactivado.";
         |ACABA;
     |FINSI;

     aDirDes = "";
     aAlfa1  = #13#4;
     nSwPon  = 0;
     |PARA nCaracter = 1;  |SI nCaracter [ 50;  |HACIENDO nCaracter = nCaracter + 1;
          nPosi     = (100 * nCaracter) + 1;
          aCaracter = aAlfa1 % nPosi;

          |SI aCaracter = ">";  |SAL;        |FINSI;

          |SI nSwPon = 1;  aDirDes = aDirDes + aCaracter;  |FINSI;

          |SI aCaracter = "<";  nSwPon = 1;  |FINSI;
     |SIGUE;

     |SI nSwPon = 0;
         aDirDes = "";
         |PARA nCaracter = 1;  |SI nCaracter [ 50;  |HACIENDO nCaracter = nCaracter + 1;
               nPosi     = (100 * nCaracter) + 1;
               aCaracter = aAlfa1 % nPosi;
               |SI aCaracter = " ";  |Y nSwPon = 1;
                   |SAL;
               |FINSI;

               aDirDes   = aDirDes + aCaracter;

               |SI aCaracter = " ";  aDirDes   = "";  |FINSI;
               |SI aCaracter = "@";  nSwPon    = 1;   |FINSI;
         |SIGUE;
     |FINSI;

     aBase  = "";
     |DBASE aBase;  |QBF aBase;
     aBase  = aBase + "correos/";  |MKDIR aBase;
     aFic   = aBase + "ECO.TXT";
     |XABRE "BW", aDestino, nHandle;
     aAlfa1 = "Comprobacion de lectura realizada" + &13 + &10;
     |XGRABA nHandle, aAlfa1;
     |XCIERRA nHandle;

     aDSCorreo = #518#2;           |QBF aDSCorreo;   || Direccion IP
     aUsu      = #518#6;           |QBF aUsu;        || usuario
     aPwd      = #518#7;           |QBF aPwd;        || password
     aProxy    = #518#4;           |QBF aProxy;      || servidor proxy

     aTitulo   = #13#2;            |QBF aTitulo;     || Asunto
     aDirOri   = #518#5;           |QBF aDirOri;     || Direccion Origen
     aTexto    = "Comprobacion de lectura realizada";|| Cuerpo

     aNombre   = "";

     aAlfa1 = "0000Enviando Eco [" + aDSCorreo + "] ...";
     |MENSA aAlfa1;

     |DSCORREO_ENVIA aDSCorreo, aProxy, aDirOri, aDirDes, aTitulo, aTexto, aFic;
     nError = FSalida;
     |BLIN 4;

     |SI nError < 0;
          aMenLog = "    Problemas al enviar correo ..." + nError;
          |MENAV aMenLog;
     |FINSI;

     |FBORRA aFic;
|FPRC;

|PROCESO Consulta13;
     |VENTANA 0501, 0520, -1, 16, "Consultando correo ";
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |HAZ Desaparecen;

     efFechaDocu    = #13#6;
     enCodUbica     = #514#9;  |HAZ LeeUbicaciones;
     eaFicheroEdita = (("00000000" + #13#0) % -108) + (("0000" + #13#1) % -104) + ".eml";
     |QBF eaFicheroEdita;
     aFicheroActu   = eaRutaDocumento + "/" + eaFicheroEdita;
     |HAZ AbreDocumento;

     |SI #13#5 = "N";  |Y #514#10 = "S";
         nError = -1;
         |HAZ EnviaEco13;

         |SI nError ] 0;
             |LEE 101#13=;
             |SI FSalida = 0;
                 #13#5 = "S";
                 |GRABA 020#13a;
                 |LIBERA #13;
             |FINSI;
         |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana;

     |HAZ Aparecen;

     |PULSATECLA;
     |REFRESCACONTROL enGrid1;
     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO Reenviar13;
     |LEE 000#13=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ Desaparecen;

     |VENTANA 0501, 2799, -1, 17, "Reennvio de correo";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     efFechaDocu    = #13#6;
     enCodUbica     = #514#9;  |HAZ LeeUbicaciones;
     eaFicheroEdita = (("00000000" + #13#0) % -108) + (("0000" + #13#1) % -104) + ".eml";
     eaFichAdjunto  = eaRutaDocumento + "/" + eaFicheroEdita;
     enExped        = #13#0;
     enNumExpeCorreo = #13#1;

     |SUB_EJECUTA_NP "abxz0001";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;

     |HAZ Aparecen;

     |REFRESCACONTROL enGrid1;
     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO Nuevo13;
     |HAZ Desaparecen;

     |VENTANA 0501, 2799, -1, 17, "Env¡o de correo nuevo";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     efFechaDocu    = ~;
     eaFichAdjunto  = "";
     |SI enExped = 0;
         enExped = #13#0;
     |FINSI;
     enNumExpeCorreo = enExped;

     |SUB_EJECUTA_NP "abxz0001";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;

     |HAZ Aparecen;

     |REFRESCACONTROL enGrid1;
     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO Borrar13;
     |LEE 101#13=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CONFI "0000NSeguro que quiere borrar el correo";
     |SI FSalida ! 0;
         |LIBERA #13;
         |ACABA;
     |FINSI;

     |HAZ Desaparecen;

     efFechaDocu  = #13#6;
     enCodUbica   = #514#9;  |HAZ LeeUbicaciones;
     aFicheroActu = eaRutaDocumento + "/" + (("00000000" + #13#0) % -108) + (("0000" + #13#1) % -104) + ".eml";
     |SI #514#21 ! "C";
         |RFBORRA aFicheroActu;
     |SINO;
         |FBORRA aFicheroActu;
     |FINSI;

     |BORRA 020#13a;
     |LIBERA #13;

     |HAZ Aparecen;

     |REFRESCACONTROL enGrid1;
     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO EventoPanta13;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#13=;
         |SI FSalida = 0;
             |ESTADO_CONTROL nBoton1, "ENABLE";
             |ESTADO_CONTROL nBoton2, "ENABLE";
             |ESTADO_CONTROL nBoton3, "ENABLE";
         |SINO;
             |ESTADO_CONTROL nBoton1, "DISABLE";
             |ESTADO_CONTROL nBoton2, "DISABLE";
             |ESTADO_CONTROL nBoton3, "DISABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
         |HAZ Consulta13;
     |FINSI;
|FPRC;

|PROCESO Baja13;
     #13#0  = enExped;
     #13#1  = 1;
|FPRC;

|PROCESO Alta13;
     #13#0  = enExped;
     #13#1  = 9999;
|FPRC;

|PROCESO EntradaExpediente;
     |CONTROL_SIMPLE 0, "BOTON,{{197}} Consulta correo", 3202, 3317, Consulta13;
     nBoton1  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}} Borrar correo", 3219, 3332, Borrar13;
     nBoton2  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{157}} Reenviar correo", 3234, 3347, Reenviar13;
     nBoton3  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{193}} Nuevo correo", 3249, 3364, Nuevo13;
     nBoton4  = FSalida;

     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton3, "DISABLE";

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#13, nRango, 0602, 2698, Baja13, Alta13, EventoPanta13;
     enGrid1  = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + enGrid1;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
         |PULSATECLA;
     |SIGUE;

     |PULSATECLA;

     |DESTRUYECONTROL enGrid1;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
|FPRC;

|| **************************************************************************
|| PROCESO GENERAL
|| **************************************************************************

|PROCESO Tipo80Fxz57; |TIPO 80;
     |ABRE #514;
     |LEE 000#514p;
     |SI FSalida ! 0;  |DDEFECTO #514;  |FINSI;
     |CIERRA #514;

     |ABRET #12;
     |ABRET #13;

     |SI enExped = 0;
         FSalida = 2799;
     |SINO;
         FSalida = 3399;
     |FINSI;
|FPRC;

|PROCESO Tipo90Fxz57; |TIPO 90;
     |CIERRAT #12;
     |CIERRAT #13;
|FPRC;

|PROGRAMA;
     |PINPA #0#957;  enPanta0 = FSalida;

     |SI enExped = 0;
         |HAZ EntradaGeneral;
     |SINO;
         |HAZ EntradaExpediente;
     |FINSI;
|FPRO;
