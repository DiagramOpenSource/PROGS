|FICHEROS;
   visaz007 #0;

   visaw009 #10,MANTE;

   ashismic #11;
   ashismil #12;
   visam001 #13;
   visam002 #14;
   asclient #15;
   asconcep #16;
   asfpagos #17;
   visam018 #19;

   visam100 #100;
   visam009 #109;
|FIN;

|VARIABLES;

   {-1}aOpciones = "";
       aOpciones1 = "2400";
       aOpciones2 = "1";
       aOpciones3 = "Seleccione : ";
       aOpciones4 = "IC";
       aOpciones5 = "Impresora";
       aOpciones6 = "Correo electronico";

   aAlfa   = "";
   aAlfa1  = "";
   aAlfa2  = "";

   &EURO   = "";
   &EURODB = 0;
   &EURODV = 2;

   &enModVisados = 0;
   &eaParametro1 = "";
   &eaParametro2 = "";
   &eaParametro3 = "";
   &eaParametro5 = "";

   nAntCliente = 0;
   aNomAntCli  = "";
   nAntCli     = 0;
   nSwMedio  = 0;
   nNumSelec = 0;
   aSerie = "";
   aSerieImp = "";
   nFactu = 0;
   nLinea = 0;
   nCalc  = 0;
   nTotDto = 0;
   nDto    = 0;
   nSwRel  = 0;

   nImpHono = 0;
   nImpSupl = 0;
   nImpSegu = 0;
   nImpMens = 0;
   nImpNeto = 0;

   nOpcion = 0;
   nHandle = 0;

    aDocOrigen   = "";
    aDocDestino  = "";
    aDocRemoto   = "";
    aMD5Origen   = "";
    aMD5Remoto   = "";
    aIP          = "";
    nCopia       = 0;
    {1}aContiene = "";

    aIPServ     = "";
    aServidor   = "";
    aDirOrigen  = "";
    aDirDestino = "";
    aAsunto     = "";
    aTexto      = "";
    aFichero    = "";

     &eaUnidadBasico = "";
|FIN;

|PROCESO GrabaDatosCab;
   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#SERFA#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = #ashismic#0 + &13 + &10; |XGRABA nHandle, aAlfa;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#FACTURA#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = (("00000" + #ashismic#1) % -105) + &13 + &10; |XGRABA nHandle, aAlfa;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#FECHA#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = #ashismic#29 + &13 + &10; |XGRABA nHandle, aAlfa;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#CLIEN#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = (("00000" + #asclient#0) % -105) + &13 + &10; |XGRABA nHandle, aAlfa;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#NOMCLI#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = #asclient#2 + &13 + &10; |XGRABA nHandle, aAlfa;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#DIRCLI#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = #asclient#3 + &13 + &10; |XGRABA nHandle, aAlfa;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#CP#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = (("00" + #asclient#4) % -102) + (("000" + #asclient#4) % -103) + &13 + &10; |XGRABA nHandle, aAlfa;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#POBLA#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = #asclient#6 + &13 + &10; |XGRABA nHandle, aAlfa;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#PROVIN#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = #asclient#7 + &13 + &10; |XGRABA nHandle, aAlfa;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#CIF#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = #asclient#8 + &13 + &10; |XGRABA nHandle, aAlfa;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#DESEXP#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = #visam001#13 + &13 + &10; |XGRABA nHandle, aAlfa;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#DTO#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "% Dto." + &13 + &10; |XGRABA nHandle, aAlfa;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#TOTDTO#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "Total Dto." + &13 + &10; |XGRABA nHandle, aAlfa;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#ACTACA#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "A Cta." + &13 + &10; |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO GrabaDatosLin;
   #asconcep#0 = #ashismil#4;
   #asconcep#1 = #ashismil#5;
   |LEE 000#asconcep.=;
   |SI FSalida ! 0; |DDEFECTO #asconcep; |FINSI;

   aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "}3}" + nLinea + "}1}+G" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "" + &13 + &10; |XGRABA nHandle, aAlfa;
   nLinea = nLinea + 1;

   aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "}3}" + nLinea + "}1}+P" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "" + &13 + &10; |XGRABA nHandle, aAlfa;
   nLinea = nLinea - 1;

   aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "}3}" + nLinea + "}1}" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = #ashismil#7 + &13 + &10; |XGRABA nHandle, aAlfa;

   |SI #ashismil#11 ! 0; |O #ashismil#12 ! 0;
      aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "}3}" + nLinea + "}2}" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = #ashismil#11 + &13 + &10; |XGRABA nHandle, aAlfa;

      aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "}3}" + nLinea + "}3}" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = #ashismil#12; aAlfa1 = aAlfa % -301;
      |SI aAlfa1 ! ".";
         aAlfa1 = aAlfa % -201;
         |SI aAlfa1 ! ".";
            aAlfa = aAlfa + ".00";
         |SINO;
            aAlfa = aAlfa + "0";
         |FINSI;
      |FINSI;
      aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
   |FINSI;

   nDto = 0;
   |SI #asconcep#3 = "H";
      nCalc = #asclient#23; nCalc = (nCalc / 100) ! 2;
      nCalc = (#ashismil#13 * nCalc) ! 2;
      |SI nCalc > 0;
         nTotDto = (nTotDto + nCalc) ! 2;
         nDto = nCalc;

         aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
         aAlfa = "}3}" + nLinea + "}4}" + &13 + &10; |XGRABA nHandle, aAlfa;
         aAlfa = #asclient#23; aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = aAlfa + "0";
            |FINSI;
         |FINSI;
         aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;

         aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
         aAlfa = "}3}" + nLinea + "}5}" + &13 + &10; |XGRABA nHandle, aAlfa;
         aAlfa = nCalc; aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = aAlfa + "0";
            |FINSI;
         |FINSI;
         aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
      |FINSI;
   |FINSI;

   |SI #asconcep#3 = "A"; |Y #ashismil#13 ! 0;
      aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "}3}" + nLinea + "}6}" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = #ashismil#13; aAlfa1 = aAlfa % -301;
      |SI aAlfa1 ! ".";
         aAlfa1 = aAlfa % -201;
         |SI aAlfa1 ! ".";
            aAlfa = aAlfa + ".00";
         |SINO;
            aAlfa = aAlfa + "0";
         |FINSI;
      |FINSI;
      aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
   |FINSI;

   |SI nDto ! 0;
      aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "}3}" + nLinea + "}7}" + &13 + &10; |XGRABA nHandle, aAlfa;
      nCalc = #ashismil#13 - nDto;
      aAlfa = nCalc; aAlfa1 = aAlfa % -301;
      |SI aAlfa1 ! ".";
         aAlfa1 = aAlfa % -201;
         |SI aAlfa1 ! ".";
            aAlfa = aAlfa + ".00";
         |SINO;
            aAlfa = aAlfa + "0";
         |FINSI;
      |FINSI;
      aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
   |FINSI;

   |SI #asconcep#3 = "S";
      aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "}3}" + nLinea + "}8}" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = #ashismil#13; aAlfa1 = aAlfa % -301;
      |SI aAlfa1 ! ".";
         aAlfa1 = aAlfa % -201;
         |SI aAlfa1 ! ".";
            aAlfa = aAlfa + ".00";
         |SINO;
            aAlfa = aAlfa + "0";
         |FINSI;
      |FINSI;
      aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
   |FINSI;

   nLinea = nLinea + 1;

   aAlfa = #ashismil#8; |QBF aAlfa;
   |SI aAlfa ! "";
      aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "}3}" + nLinea + "}1}+G" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "" + &13 + &10; |XGRABA nHandle, aAlfa;
      nLinea = nLinea + 1;

      aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "}3}" + nLinea + "}1}+P" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "" + &13 + &10; |XGRABA nHandle, aAlfa;
      nLinea = nLinea - 1;

      aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "}3}" + nLinea + "}1}" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = #ashismil#8 + &13 + &10; |XGRABA nHandle, aAlfa;

      nLinea = nLinea + 1;
   |FINSI;

   aAlfa = #ashismil#9; |QBF aAlfa;
   |SI aAlfa ! "";
      aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "}3}" + nLinea + "}1}+G" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "" + &13 + &10; |XGRABA nHandle, aAlfa;
      nLinea = nLinea + 1;

      aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "}3}" + nLinea + "}1}+P" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "" + &13 + &10; |XGRABA nHandle, aAlfa;
      nLinea = nLinea - 1;

      aAlfa = "T" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = "}3}" + nLinea + "}1}" + &13 + &10; |XGRABA nHandle, aAlfa;
      aAlfa = #ashismil#8 + &13 + &10; |XGRABA nHandle, aAlfa;

      nLinea = nLinea + 1;
   |FINSI;
|FPRC;

|PROCESO GrabaDatosPie;
   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#IMACTA#" + &13 + &10; |XGRABA nHandle, aAlfa;
   |SI #ashismic#21 ! 0;
      aAlfa = #ashismil#21; aAlfa1 = aAlfa % -301;
      |SI aAlfa1 ! ".";
         aAlfa1 = aAlfa % -201;
         |SI aAlfa1 ! ".";
            aAlfa = aAlfa + ".00";
         |SINO;
            aAlfa = aAlfa + "0";
         |FINSI;
      |FINSI;
      aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
   |SINO;
      aAlfa = " " + &13 + &10; |XGRABA nHandle, aAlfa;
   |FINSI;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#GESTIO#" + &13 + &10; |XGRABA nHandle, aAlfa;
   |SI #ashismic#19 ! 0;
      aAlfa = #ashismic#19; aAlfa1 = aAlfa % -301;
      |SI aAlfa1 ! ".";
         aAlfa1 = aAlfa % -201;
         |SI aAlfa1 ! ".";
            aAlfa = aAlfa + ".00";
         |SINO;
            aAlfa = aAlfa + "0";
         |FINSI;
      |FINSI;
      aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
   |SINO;
      aAlfa = " " + &13 + &10; |XGRABA nHandle, aAlfa;
   |FINSI;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#DESCUE#" + &13 + &10; |XGRABA nHandle, aAlfa;
   |SI #asclient#23 ! 0;
      aAlfa = #asclient#23; aAlfa1 = aAlfa % -301;
      |SI aAlfa1 ! ".";
         aAlfa1 = aAlfa % -201;
         |SI aAlfa1 ! ".";
            aAlfa = aAlfa + ".00";
         |SINO;
            aAlfa = aAlfa + "0";
         |FINSI;
      |FINSI;
      aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
   |SINO;
      aAlfa = " " + &13 + &10; |XGRABA nHandle, aAlfa;
   |FINSI;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#IMPDTO#" + &13 + &10; |XGRABA nHandle, aAlfa;
   |SI nTotDto ! 0;
      aAlfa = nTotDto; aAlfa1 = aAlfa % -301;
      |SI aAlfa1 ! ".";
         aAlfa1 = aAlfa % -201;
         |SI aAlfa1 ! ".";
            aAlfa = aAlfa + ".00";
         |SINO;
            aAlfa = aAlfa + "0";
         |FINSI;
      |FINSI;
      aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
   |SINO;
      aAlfa = " " + &13 + &10; |XGRABA nHandle, aAlfa;
   |FINSI;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#BASEIMP#" + &13 + &10; |XGRABA nHandle, aAlfa;
   |SI #ashismic#24 ! 0;
      aAlfa = #ashismic#24; aAlfa1 = aAlfa % -301;
      |SI aAlfa1 ! ".";
         aAlfa1 = aAlfa % -201;
         |SI aAlfa1 ! ".";
            aAlfa = aAlfa + ".00";
         |SINO;
            aAlfa = aAlfa + "0";
         |FINSI;
      |FINSI;
      aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
   |SINO;
      aAlfa = " " + &13 + &10; |XGRABA nHandle, aAlfa;
   |FINSI;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#IVA#" + &13 + &10; |XGRABA nHandle, aAlfa;
   |SI #ashismic#45 ! 0;
      aAlfa = #ashismic#45; aAlfa1 = aAlfa % -301;
      |SI aAlfa1 ! ".";
         aAlfa1 = aAlfa % -201;
         |SI aAlfa1 ! ".";
            aAlfa = aAlfa + ".00";
         |SINO;
            aAlfa = aAlfa + "0";
         |FINSI;
      |FINSI;
      aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
   |SINO;
      aAlfa = " " + &13 + &10; |XGRABA nHandle, aAlfa;
   |FINSI;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#CUOTIVA#" + &13 + &10; |XGRABA nHandle, aAlfa;
   |SI #ashismic#25 ! 0;
      aAlfa = #ashismic#25; aAlfa1 = aAlfa % -301;
      |SI aAlfa1 ! ".";
         aAlfa1 = aAlfa % -201;
         |SI aAlfa1 ! ".";
            aAlfa = aAlfa + ".00";
         |SINO;
            aAlfa = aAlfa + "0";
         |FINSI;
      |FINSI;
      aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
   |SINO;
      aAlfa = " " + &13 + &10; |XGRABA nHandle, aAlfa;
   |FINSI;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#SUPLIDO#" + &13 + &10; |XGRABA nHandle, aAlfa;
   |SI #ashismic#20 ! 0;
      aAlfa = #ashismic#20; aAlfa1 = aAlfa % -301;
      |SI aAlfa1 ! ".";
         aAlfa1 = aAlfa % -201;
         |SI aAlfa1 ! ".";
            aAlfa = aAlfa + ".00";
         |SINO;
            aAlfa = aAlfa + "0";
         |FINSI;
      |FINSI;
      aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
   |SINO;
      aAlfa = " " + &13 + &10; |XGRABA nHandle, aAlfa;
   |FINSI;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#TOTFAC#" + &13 + &10; |XGRABA nHandle, aAlfa;
   |SI #ashismic#28 ! 0;
      aAlfa = #ashismic#28; aAlfa1 = aAlfa % -301;
      |SI aAlfa1 ! ".";
         aAlfa1 = aAlfa % -201;
         |SI aAlfa1 ! ".";
            aAlfa = aAlfa + ".00";
         |SINO;
            aAlfa = aAlfa + "0";
         |FINSI;
      |FINSI;
      aAlfa = aAlfa + &13 + &10; |XGRABA nHandle, aAlfa;
   |SINO;
      aAlfa = " " + &13 + &10; |XGRABA nHandle, aAlfa;
   |FINSI;

   aAlfa = "V" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = "#FP#" + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = #asfpagos#1 + &13 + &10; |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO LineasHis;
   |HAZ GrabaDatosLin;
|FPRC;

|DEFBUCLE LineasHis;
#ashismil#1;
;
#ashismic#0, #ashismic#1, 001;
#ashismic#0, #ashismic#1, 999;
;
NULL, LineasHis;
|FIN;

|PROCESO ImprimeFactura;
   nLinea = 1;

   |ABRE #ashismic; |ABRE #asclient;
   |ABRE #asconcep; |ABRE #asfpagos;

   #ashismic#0 = aSerie;
   #ashismic#1 = nFactu;
   |LEE 000#ashismic.=;
   |SI FSalida = 0;
      #asclient#0 = #ashismic#3;
      |LEE 000#asclient.=;
      |SI FSalida ! 0; |DDEFECTO #asclient; |FINSI;

      #asfpagos#0 = #ashismic#12;
      |LEE 000#asfpagos.=;
      |SI FSalida ! 0; |DDEFECTO #asfpagos; |FINSI;

      |SELECT #5#visam001;
      #visam001#24 = #ashismic#0;
      #visam001#25 = #ashismic#1;
      |LEE 000#visam001.=;
      |SI FSalida ! 0; |DDEFECTO #visam001; |FINSI;
      |SELECT #1#visam001;

      aAlfa = eaUnidadBasico + "/DOCUMENTOS";              |RMKDIR aAlfa;
      aAlfa = eaUnidadBasico + "/DOCUMENTOS/FACTURAR";     |RMKDIR aAlfa;
      aAlfa = eaUnidadBasico + "/DOCUMENTOS/FACTURAR/TMP"; |RMKDIR aAlfa;

      nCopia = 0;
      aDocRemoto = eaUnidadBasico + "/DOCUMENTOS/FACTURAR/TMP/factura.xml";
      |DBASE aDocOrigen; |QBF aDocOrigen;
      aDocOrigen = aDocOrigen + "plantillas/factura.xml";
      |XABRE "CE", aDocRemoto, nHandle;
      |SI FSalida < 0;
         nCopia = 1;
      |SINO;
         aContiene1 = aDocRemoto;
         |ESPECIFICA "REMOTOMD5", aContiene;
         aMD5Remoto = FSalida;  |QBF aMD5Remoto;

         aContiene1 = aDocOrigen;
         |ESPECIFICA "MD5", aContiene;
         aMD5Origen = FSalida;  |QBF aMD5Origen;
         |SI aMD5Remoto ! aMD5Origen;
            nCopia = 1;
         |FINSI;
      |FINSI;

      |SI nCopia = 1;
         aIP = ""; |IP_REMOTO aIP;
         |SI aIP ! "";
            |ENVIA_FICHERO aDocOrigen, aDocRemoto;
         |SINO;
            |COPIA_FICHERO aDocOrigen, aDocRemoto;
         |FINSI;
      |FINSI;

      aSerieImp = #ashismic#0;    |QBT aSerieImp;
      aSerieImp = (aSerieImp + "__") % 102;
      aAlfa = eaUnidadBasico + "/DOCUMENTOS/FACTURAR/TMP/xml" + aSerieImp + (("000000" + #ashismic#1) % -106) + ".txt";

      |XABRE "CW", aAlfa, nHandle;
      aAlfa = eaUnidadBasico + "/DOCUMENTOS/FACTURAR/TMP/xml" + aSerieImp + (("000000" + #ashismic#1) % -106) + ".xml";
      |RCOPIA_FICHERO aDocRemoto, aAlfa;

      aAlfa = "[FICHERO]#" + aAlfa + &13 + &10;
      |XGRABA nHandle, aAlfa;
      aAlfa = "[GRABA ORIGEN]" + &13 + &10;
      |XGRABA nHandle, aAlfa;

      |HAZ GrabaDatosCab;

      |BUCLE LineasHis;

      |HAZ GrabaDatosPie;

      aAlfa = "[LIMPIA FINAL]" + &13 + &10;
      |XGRABA nHandle, aAlfa;
      |SI nSwMedio = 1;
         aAlfa = "[IMPRESORA]#I" + &13 + &10;
      |SINO;
         aAlfa = "[IMPRESORA]#I#2#DSPDF#2" + &13 + &10;
      |FINSI;
      |XGRABA nHandle, aAlfa;

      |XCIERRA nHandle;

      nCopia = 0;
      aDocRemoto = eaUnidadBasico + "/DOCUMENTOS/FACTURAR/TMP/dsxml.exe";
      |DBASE aDocOrigen; |QBF aDocOrigen;
      aDocOrigen = aDocOrigen + "plantillas/dsxml.exe";
      |XABRE "CE", aDocRemoto, nHandle;
      |SI FSalida < 0;
         nCopia = 1;
      |SINO;
         aContiene1 = aDocRemoto;
         |ESPECIFICA "REMOTOMD5", aContiene;
         aMD5Remoto = FSalida;  |QBF aMD5Remoto;

         aContiene1 = aDocOrigen;
         |ESPECIFICA "MD5", aContiene;
         aMD5Origen = FSalida;  |QBF aMD5Origen;
         |SI aMD5Remoto ! aMD5Origen;
            nCopia = 1;
         |FINSI;
      |FINSI;

      |SI nCopia = 1;
         aIP = ""; |IP_REMOTO aIP;
         |SI aIP ! "";
            |ENVIA_FICHERO aDocOrigen, aDocRemoto;
         |SINO;
            |COPIA_FICHERO aDocOrigen, aDocRemoto;
         |FINSI;
      |FINSI;

      eaParametro1 = aDocRemoto;
      eaParametro2 = eaUnidadBasico + "/DOCUMENTOS/FACTURAR/TMP";
      eaParametro2 = eaParametro2 + "/xml" + aSerieImp + (("000000" + #ashismic#1) % -106) + ".txt";
      eaParametro5 = eaUnidadBasico + "/DOCUMENTOS/FACTURAR/TMP";
      eaParametro3 = eaParametro5 + "/~$l" + aSerieImp + (("000000" + #ashismic#1) % -106) + ".xml";
      |HAZ EjecutaDSXML;

      |SI nSwMedio = 2;
          aDocOrigen  = eaUnidadBasico + "/DOCUMENTOS/FACTURAR/TMP/xml" + aSerieImp + (("000000" + #ashismic#1) % -106) + ".pdf";
          |DFICE aDocDestino; |QBF aDocDestino;
          aDocDestino = aDocDestino + "xml" + aSerieImp + (("000000" + #ashismic#1) % -106) + ".pdf";
          |RECIBE_FICHERO aDocOrigen, aDocDestino;

          |ABRE #visam100;  |LEE 000#visam100.p;  |CIERRA #visam100;
          |ABRE #visam009;
          |DDEFECTO #visam009;
          #visam009#0 = #visam100#1;
          |LEE 000#visam009.=;
          |SI FSalida ! 0;
             aAlfa = "0000No existe Cuenta de Correo definida [" + #visam100#1 + "]";
             |MENAV aAlfa;
          |SINO;
             aIPServ     = #visam009#2;   |QBF aIPServ;
             aServidor   = #visam009#4;   |QBF aServidor;

             |SI #visam009#8 = "N";
                aDirOrigen = #visam009#5;   |QBF aDirOrigen;
             |SINO;
                aDirOrigen = #visam009#7;
                |QBF aDirOrigen;
                aDirOrigen = aDirOrigen + ":" + #visam009#5;
                |QBF aDirOrigen;
                aDirOrigen = aDirOrigen + ":" + #visam009#5;
                |QBF aDirOrigen;
             |FINSI;

             |ABRE #visam018;
             #visam018#0 = #asclient#0;
             |LEE 000#visam018.=;
             |SI FSalida ! 0;
                aAlfa = "    El cliente " + #asclient#1; |QBF aAlfa;
                aAlfa = aAlfa + " no tiene direccion de correo para el dpto.de contabilidad";
                |MENAV aAlfa;
                aDirDestino = "";
             |SINO;
                aDirDestino = #visam018#1; |QBF aDirDestino;
             |FINSI;
             |CIERRA #visam018;

             aAsunto     = "Emision factura n§ " + #ashismic#0 + "/" + (("000000" + #ashismic#1) % -106);  |QBF aAsunto;
             |DFICE aFichero; |QBF aFichero;
             aFichero    = aFichero + "xml" + aSerieImp + (("000000" + #ashismic#1) % -106) + ".pdf";
             aTexto      = "";

             |SI aServidor ! "";
                |SI aDirDestino ! "";
                   |DSCORREO_ENVIA aIPServ, aServidor, aDirOrigen, aDirDestino, aAsunto, aTexto, aFichero;
                |FINSI;
                |FBORRA aFichero;
             |SINO;
                |ERROR10;
             |FINSI;
          |FINSI;
          |CIERRA #visam009;
      |FINSI;
   |FINSI;
   |CIERRA #asconcep; |CIERRA #ashismic;
   |CIERRA #asclient; |CIERRA #asfpagos;
|FPRC;

|PROCESO Seleccion;
   |SI #visaw009#12 ! "*"; |ACABA; |FINSI;

   aSerie = #visaw009#0; nFactu = #visaw009#1;
   |HAZ ImprimeFactura;
|FPRC;

|DEFBUCLE Seleccion;
#visaw009#1;
;
INICIO;
FINAL;
;
NULL, Seleccion;
|FIN;

|PROCESO GrabaSec;
   aAlfa = "  " + #visaw009#0 + "/" + (("000000" + #visaw009#1) % -106) + "  " + #visaw009#4 + "     ";
   aAlfa1 = #visaw009#5; |QBF aAlfa1; aAlfa1 = (aAlfa1 + (" " * 40)) % 0140;
   aAlfa = aAlfa + aAlfa1 + "  ";
   aAlfa1 = #visaw009#6; |QBF aAlfa1; aAlfa1 = (aAlfa1 + (" " * 25)) % 0125;
   aAlfa = aAlfa + aAlfa1 + "   ";

   aAlfa1 = #visaw009#7; aAlfa2 = aAlfa1 % -301;
   |SI aAlfa2 ! ".";
      aAlfa2 = aAlfa1 % -201;
      |SI aAlfa2 ! ".";
         aAlfa1 = aAlfa1 + ".00";
      |SINO;
         aAlfa1 = aAlfa1 + "0";
      |FINSI;
   |FINSI;
   |QBF aAlfa1; aAlfa1 = ((" " * 12) + aAlfa1) % -112;
   aAlfa = aAlfa + aAlfa1 + "   ";

   aAlfa1 = #visaw009#8; aAlfa2 = aAlfa1 % -301;
   |SI aAlfa2 ! ".";
      aAlfa2 = aAlfa1 % -201;
      |SI aAlfa2 ! ".";
         aAlfa1 = aAlfa1 + ".00";
      |SINO;
         aAlfa1 = aAlfa1 + "0";
      |FINSI;
   |FINSI;
   |QBF aAlfa1; aAlfa1 = ((" " * 12) + aAlfa1) % -112;
   aAlfa = aAlfa + aAlfa1 + "  ";

   aAlfa1 = #visaw009#9; aAlfa2 = aAlfa1 % -301;
   |SI aAlfa2 ! ".";
      aAlfa2 = aAlfa1 % -201;
      |SI aAlfa2 ! ".";
         aAlfa1 = aAlfa1 + ".00";
      |SINO;
         aAlfa1 = aAlfa1 + "0";
      |FINSI;
   |FINSI;
   |QBF aAlfa1; aAlfa1 = ((" " * 12) + aAlfa1) % -112;
   aAlfa = aAlfa + aAlfa1 + "  ";

   aAlfa1 = #visaw009#10; aAlfa2 = aAlfa1 % -301;
   |SI aAlfa2 ! ".";
      aAlfa2 = aAlfa1 % -201;
      |SI aAlfa2 ! ".";
         aAlfa1 = aAlfa1 + ".00";
      |SINO;
         aAlfa1 = aAlfa1 + "0";
      |FINSI;
   |FINSI;
   |QBF aAlfa1; aAlfa1 = ((" " * 12) + aAlfa1) % -112;
   aAlfa = aAlfa + aAlfa1 + "   ";

   aAlfa1 = #visaw009#11; aAlfa2 = aAlfa1 % -301;
   |SI aAlfa2 ! ".";
      aAlfa2 = aAlfa1 % -201;
      |SI aAlfa2 ! ".";
         aAlfa1 = aAlfa1 + ".00";
      |SINO;
         aAlfa1 = aAlfa1 + "0";
      |FINSI;
   |FINSI;
   |QBF aAlfa1; aAlfa1 = ((" " * 14) + aAlfa1) % -114;
   aAlfa = aAlfa + aAlfa1;
   |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO Relacion;
   |SI #visaw009#12 ! "*"; |ACABA; |FINSI;

   |SI nAntCli ! #visaw009#2; |Y nSwRel = 1;
      |SI nAntCli ! -1;
         |SI nSwMedio = 1;
            |PIEINF; |FININF;
            |INFOR "visaz07a";
         |FINSI;
         |SI nSwMedio = 2;
            |HAZ PintaPie;
            |XCIERRA nHandle;

            |ABRE #asclient; |ABRE #visam018;
            #asclient#0 = nAntCli;
            |LEE 000#asclient.=;
            |SI FSalida ! 0; |DDEFECTO #asclient; |FINSI;

            #visam018#0 = nAntCli;
            |LEE 000#visam018.=;
            |SI FSalida ! 0;
               aAlfa = "    El cliente " + #asclient#1; |QBF aAlfa;
               aAlfa = aAlfa + " no tiene direccion de correo para el dpto.de contabilidad";
               |MENAV aAlfa;
               aDirDestino = "";
            |SINO;
               aDirDestino = #visam018#1; |QBF aDirDestino;
            |FINSI;
            |CIERRA #visam018; |CIERRA #asclient;

            |HAZ EnviaRelacion;

            |DFICE aAlfa; |QBF aAlfa;
            aAlfa = aAlfa + "rel" + Usuario + ".txt";
            |XABRE "W", aAlfa, nHandle;
            |HAZ PintaCab;
        |FINSI;
      |FINSI;
      nAntCli    = #visaw009#2;
      aNomAntCli = #visaw009#3;
      nImpHono = 0; nImpSupl = 0; nImpSegu = 0; nImpMens = 0; nImpNeto = 0;
   |FINSI;

   nImpHono = nImpHono + #visaw009#7;
   nImpSupl = nImpSupl + #visaw009#8;
   nImpSegu = nImpSegu + #visaw009#9;
   nImpMens = nImpMens + #visaw009#10;
   nImpNeto = nImpNeto + #visaw009#11;

   |SI nSwMedio = 1; |PRINT;        |FINSI;
   |SI nSwMedio = 2; |HAZ GrabaSec; |FINSI;
|FPRC;

|DEFBUCLE Relacion;
#visaw009#1;
;
INICIO;
FINAL;
;
NULL, Relacion;
|FIN;

|DEFBUCLE Relacion1;
#visaw009#2;
;
INICIO;
FINAL;
;
NULL, Relacion;
|FIN;

|PROCESO PintaCab;
   aAlfa = " *****************************************************************************"; |XGRABA nHandle, aAlfa;
   aAlfa = " ******                       RELACION DE FACTURAS                      ******"; |XGRABA nHandle, aAlfa;
   aAlfa = " *****************************************************************************"; |XGRABA nHandle, aAlfa;
   aAlfa = " "; |XGRABA nHandle, aAlfa;
   |SI nSwRel = 1;
      aAlfa = " Cliente : " + (("00000" + #visaw009#2) % -105) + " " + #visaw009#3; |XGRABA nHandle, aAlfa;
      aAlfa = " "; |XGRABA nHandle, aAlfa;
   |FINSI;
   aAlfa = " Acotaciones "; |XGRABA nHandle, aAlfa;
   |SI nSwRel = 0;
      aAlfa = " Cliente : Desde " + (("00000" + #visaz007#0) % -105) + "      hasta " + (("00000" + #visaz007#1) % -105);
   |SINO;
      aAlfa = "                                       ";
   |FINSI;
   aAlfa = aAlfa + "      Forma pago : Desde " + (("00" + #visaz007#4) % -102) + " hasta " + (("00" + #visaz007#5) % -102);
   |XGRABA nHandle, aAlfa;
   aAlfa = " Fecha   : Desde " + #visaz007#2 + " hasta " + #visaz007#3;
   aAlfa = aAlfa + " Tipo Fact. : Desde " + (("00" + #visaz007#6) % -102) + " hasta " + (("00" + #visaz007#7) % -102);
   |XGRABA nHandle, aAlfa;
   aAlfa = " "; |XGRABA nHandle, aAlfa;
   aAlfa = "  Factura    Fecha factura  Descripcion                               Codigo ";
   aAlfa = aAlfa + "propio              Imp.Honorarios  Imp.Suplidos  Imp.Seguros  Imp.Mensajeros  Imp.Total Neto";
   |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO FormatDec;
   |QBF aAlfa1;
   aAlfa2 = aAlfa1 % -301;
   |SI aAlfa2 ! ".";
      aAlfa2 = aAlfa1 % -201;
      |SI aAlfa2 ! ".";
         aAlfa1 = aAlfa1 + ".00";
      |SINO;
         aAlfa1 = aAlfa1 + "0";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO PintaPie;
   |SI nSwRel = 1;
      aAlfa = " "; |XGRABA nHandle, aAlfa;
      aAlfa = " TOTAL CLIENTE : " + (("00000" + nAntCli) % -105) + " " + aNomAntCli + "                                   ";
      aAlfa1 = nImpHono; |HAZ FormatDec;
      aAlfa = aAlfa + (("            " + aAlfa1) % -112) + "   ";
      aAlfa1 = nImpSupl; |HAZ FormatDec;
      aAlfa = aAlfa + (("            " + aAlfa1) % -112) + "  ";
      aAlfa1 = nImpSegu; |HAZ FormatDec;
      aAlfa = aAlfa + (("            " + aAlfa1) % -112) + "  ";
      aAlfa1 = nImpMens; |HAZ FormatDec;
      aAlfa = aAlfa + (("            " + aAlfa1) % -112) + "     ";
      aAlfa1 = nImpNeto; |HAZ FormatDec;
      aAlfa = aAlfa + (("            " + aAlfa1) % -112);
      |XGRABA nHandle, aAlfa;
      aAlfa = " "; |XGRABA nHandle, aAlfa;
   |FINSI;
|FPRC;

|PROCESO EnviaRelacion;
   |SI aDirDestino ! "";
      |ABRE #visam100;  |LEE 000#visam100.p;  |CIERRA #visam100;
      |ABRE #visam009;
      |DDEFECTO #visam009;
      #visam009#0 = #visam100#1;
      |LEE 000#visam009.=;
      |SI FSalida ! 0;
         aAlfa = "0000No existe Cuenta de Correo definida [" + #visam100#1 + "]";
         |MENAV aAlfa;
      |SINO;
         aIPServ     = #visam009#2;   |QBF aIPServ;
         aServidor   = #visam009#4;   |QBF aServidor;
         |SI #visam009#8 = "N";
            aDirOrigen = #visam009#5;   |QBF aDirOrigen;
         |SINO;
            aDirOrigen = #visam009#7;
            |QBF aDirOrigen;
            aDirOrigen = aDirOrigen + ":" + #visam009#5;
            |QBF aDirOrigen;
            aDirOrigen = aDirOrigen + ":" + #visam009#5;
            |QBF aDirOrigen;
         |FINSI;
         aAsunto     = "Emision relacion de facturas ";  |QBF aAsunto;
         |DFICE aFichero; |QBF aFichero;
         aFichero    = aFichero + "rel" + Usuario + ".txt";
         aTexto      = "$$$$" + aFichero; |QBF aTexto;
         |SI aServidor ! "";
            |DSCORREO_ENVIA aIPServ, aServidor, aDirOrigen, aDirDestino, aAsunto, aTexto, aFichero;
         |SINO;
            |ERROR10;
         |FINSI;
      |FINSI;
      |CIERRA #visam009;
   |FINSI;
|FPRC;

|PROCESO Marca; |TIPO 11;
   |SI FSalida = 10;
      |SI #visaw009#12 = " ";
         #visaw009#12 = "*";
         |SI nAntCliente = 0;
            nAntCliente = #visaw009#2;
         |SINO;
            |SI nAntCliente ! #visaw009#2;
               nAntCliente = -1;
            |FINSI;
         |FINSI;
         nNumSelec = nNumSelec + 1;
      |SINO;
         #visaw009#12 = " ";
         nNumSelec = nNumSelec - 1;
         |SI nNumSelec = 0; nAntCliente = 0; |FINSI;
      |FINSI;
      |GRABA 020#visaw009.a;
      |PINTA #visaw009#12;
      |ERROR;
   |FINSI;

   |SI FSalida = 11; || Imprimir facturas
      |SI nNumSelec ! 0;
         aAlfa = "    N" + &191 + " Conforme con emitir las facturas marcadas ? ";
         |CONFI aAlfa;
         |SI FSalida = 0;
            |MENU aOpciones;
            nOpcion = FSalida;
            |SI nOpcion = 1; nSwMedio = 1; |FINSI;
            |SI nOpcion = 2; nSwMedio = 2; |FINSI;

            |SALVA_FICHA #visaw009;
            |BUCLE Seleccion;
            |REPON_FICHA #visaw009;
         |FINSI;
      |SINO;
         |MENAV "    No hay registros seleccionados";
      |FINSI;
      |ERROR;
   |FINSI;

   |SI FSalida = 12; || Imprimir relacion
      |SI nNumSelec ! 0;
         aAlfa = "    N" + &191 + " Conforme con emitir las facturas marcadas ? ";
         |CONFI aAlfa;
         |SI FSalida = 0;
            |MENU aOpciones;
            nOpcion = FSalida;

            aAlfa = "    N" + &191 + " Emitir relacion por cliente ? ";
            |CONFI aAlfa;
            |SI FSalida = 0;
               nSwRel  = 1;
            |SINO;
               nSwRel  = 0;
            |FINSI;

            |SI nOpcion = 1;
               nSwMedio = 1;
               |IMPRE 0;
               |SI FSalida = 0;
                  |SI nSwRel  = 1;
                     |INFOR "visaz07a";
                  |SINO;
                     |INFOR "visaz007";
                  |FINSI;
                  |SI FSalida = 0;
                     |SALVA_FICHA #visaw009;
                     |SI nSwRel = 0;
                        |SELECT #1#visaw009;
                     |SINO;
                        |SELECT #2#visaw009;
                     |FINSI;
                     |LEE 000#visaw009.p;
                     |PARA; |SI FSalida = 0; |Y #visaw009#12 = " "; |HACIENDO;
                        |LEE 000#visaw009.s;
                     |SIGUE;
                     |SI nSwRel  = 0;
                        |BUCLE Relacion;
                     |SINO;
                        |BUCLE Relacion1;
                     |FINSI;
                     |REPON_FICHA #visaw009;
                     |PIEINF; |FININF;
                  |FINSI;
                  |FINIMP;
               |FINSI;
            |FINSI;

            |SI nOpcion = 2;
               nSwMedio = 2;

               |SI nSwRel  = 0;
                  |SI nAntCliente = -1;
                     aAlfa = "    NEn la seleccion hay facturas de varios clientes. " + &191 + " Continuar ?";
                     |CONFI aAlfa;
                     |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
                  |FINSI;
               |FINSI;
               |DFICE aAlfa; |QBF aAlfa;
               aAlfa = aAlfa + "rel" + Usuario + ".txt";
               |XABRE "W", aAlfa, nHandle;
               |SI FSalida ] 0;
                  |SALVA_FICHA #visaw009;
                  |SI nSwRel = 0;
                     |SELECT #1#visaw009;
                  |SINO;
                     |SELECT #2#visaw009;
                  |FINSI;
                  |LEE 000#visaw009.p;
                  |PARA; |SI FSalida = 0; |Y #visaw009#12 = " "; |HACIENDO;
                     |LEE 000#visaw009.s;
                  |SIGUE;
                  |HAZ PintaCab;
                  |SELECT #1#visaw009;
                  |SI nSwRel  = 0;
                     |BUCLE Relacion;
                  |SINO;
                     |BUCLE Relacion1;
                     nAntCliente = nAntCli;
                  |FINSI;
                  |REPON_FICHA #visaw009;
               |FINSI;
               |HAZ PintaPie;
               |XCIERRA nHandle;

               |SI nSwRel = 0;
                  |SI nAntCliente = -1;
                     |PUSHV 0501 2380;
                     |BLANCO 1415 1865;
                     |CUADRO 1516 1764;
                     |ATRI R;
                     |PINTA 1517, " Indique la direccion de correo destino ";
                     |ATRI N;
                     E_sup = 40; E_inf = "";
                     aDirDestino = 1617 ? 1;
                     |SI FSalida ! 0; aDirDestino = ""; |FINSI;
                     |PAUSA;
                     |POPV;
                  |SINO;
                     |ABRE #asclient;
                     #asclient#0 = nAntCliente;
                     |LEE 000#asclient.=;
                     |SI FSalida ! 0; |DDEFECTO #asclient; |FINSI;
                     |CIERRA #asclient;

                     aDirDestino = #asclient#57;
                  |FINSI;
               |SINO;
                  |SI nAntCliente = -1;
                     |PUSHV 0501 2380;
                     |BLANCO 1415 1865;
                     |CUADRO 1516 1764;
                     |ATRI R;
                     |PINTA 1517, " Indique la direccion de correo destino ";
                     |ATRI N;
                     E_sup = 40; E_inf = "";
                     aDirDestino = 1617 ? 1;
                     |SI FSalida ! 0; aDirDestino = ""; |FINSI;
                     |PAUSA;
                     |POPV;
                  |SINO;
                     |ABRE #asclient;
                     #asclient#0 = nAntCliente;
                     |LEE 000#asclient.=;
                     |SI FSalida ! 0; |DDEFECTO #asclient; |FINSI;
                     |CIERRA #asclient;

                     |ABRE #visam018;
                     #visam018#0 = nAntCliente;
                     |LEE 000#visam018.=;
                     |SI FSalida ! 0;
                        aAlfa = "    El cliente " + #asclient#1; |QBF aAlfa;
                        aAlfa = aAlfa + " no tiene direccion de correo para el dpto.de contabilidad";
                        |MENAV aAlfa;
                        aDirDestino = "";
                     |SINO;
                        aDirDestino = #visam018#1; |QBF aDirDestino;
                     |FINSI;
                     |CIERRA #visam018;
                  |FINSI;
               |FINSI;
               |QBF aDirDestino;

               |HAZ EnviaRelacion;
            |FINSI;
         |FINSI;
      |SINO;
         |MENAV "    No hay registros seleccionados";
      |FINSI;
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO SeparaConcep;
   |SI #ashismil#4 = "MENS";
      #visaw009#7  = #visaw009#7  - #ashismil#13;
      #visaw009#10 = #visaw009#10 + #ashismil#13;
   |FINSI;
   |SI #ashismil#4 = "SEG ";
      #visaw009#8 = #visaw009#8 - #ashismil#13;
      #visaw009#9 = #visaw009#9 + #ashismil#13;
   |FINSI;
|FPRC;

|DEFBUCLE SeparaConcep;
#ashismil#1;
;

#ashismic#0, #ashismic#1, 001;
#ashismic#0, #ashismic#1, 999;
;
NULL, SeparaConcep;
|FIN;

|PROCESO GrabaTemporal;
   |SELECT #5#visam001;
   #visam001#24 = #ashismic#0;
   #visam001#25 = #ashismic#1;
   |LEE 000#visam001.=;
   |SI FSalida ! 0; |DDEFECTO #visam001; |FINSI;
   |SELECT #1#visam001;

   |DDEFECTO #visaw009;
   #visaw009#0  = #ashismic#0;
   #visaw009#1  = #ashismic#1;
   #visaw009#2  = #ashismic#3;
   #visaw009#3  = #ashismic#5;
   #visaw009#4  = #ashismic#29;
   #visaw009#5  = #ashismic#34;
   #visaw009#6  = #visam001#29;
   #visaw009#7  = #ashismic#19;
   #visaw009#8  = #ashismic#20;
   #visaw009#9  = 0;
   #visaw009#10 = 0;
   #visaw009#11 = #ashismic#28;
   #visaw009#12 = #visaz007#8;
   |SI #visaz007#8 = "*"; nNumSelec = nNumSelec + 1; |FINSI;

   |BUCLE SeparaConcep;

   |GRABA 020#visaw009.n;
|FPRC;

|DEFBUCLE GrabaTemporal;
#ashismic#3;
2, 29, 12;
#visaz007#0, "  ", 000000, #visaz007#6, #visaz007#2, #visaz007#4;
#visaz007#1, "zz", 999999, #visaz007#7, #visaz007#3, #visaz007#5;
;
NULL, GrabaTemporal;
|FIN;

|PROCESO CreaTemporal;
   nAntCliente = 0;
   |BUCLE GrabaTemporal;
|FPRC;

|RUTINA inf;
   #visaw009#0 = "  ";
   #visaw009#1 = 000001;
|FRUT;

|RUTINA sup;
   #visaw009#0 = "zz";
   #visaw009#1 = 999999;
|FRUT;

|PROGRAMA;
   |HAZ LeeUnidadBasico;

   |CLS;
   |CABEZA "Emision masiva";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      aAlfa = "tm" + Usuario; |NOME_DAT #visaw009#aAlfa#;
      |DELINDEX #visaw009; |ABRE #visaw009; |ABRE #visam001;
      nNumSelec = 0; |HAZ CreaTemporal; nAntCli = -1;

      |ENTLINEAL #1#visaw009, -2, 4, 17, 1, inf, sup;
      |CIERRA #visaw009; |DELINDEX #visaw009; |CIERRA #visam001;
   |FINSI;
|FPRO;
