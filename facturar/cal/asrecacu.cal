|FICHEROS;
    asrecacu #0;
    asclient #1;
    asconcep #2;
    ashismic #4;
    ashismil #5;
    ascabrem #6;
    aslinrem #7;

    &bancosp@ #706;
|FIN;

|VARIABLES;
    fecha      = @;
    fecha_a    = "";
    anyo       = "";
    mes        = "";
    mes_num    = 0;
    sw_periodo = 0;
    xxx        = 0;
    campo      = 0;

    &vengo_de  = 0;
    &v_path    = "";
    &enCodBanco  = 0;
    &enSwDeDonde = 0;
|FIN;

|PROGRAMA;
|DDEFECTO #0;

fecha   = ~;
anyo    = fecha % -104;
fecha_a = "01.01." + anyo; #0#0 = fecha_a;
fecha_a = "31.12." + anyo; #0#1 = fecha_a;

|SI vengo_de = 0;
    |CLS;
    |CABEZA "Recalculo Acumulados";
    |PINPA #0#0;
    |PINDA #0#0;
    |ENDATOS #1#0;
    |SI FSalida = 0; |HAZ recalculo; |FINSI;
|SINO;
    |ATRI P;
    |ATRI R;
    |PINTA 1920, "Recalculando Acumulados";
    |ATRI 0;
    |HAZ recalculo;
|FINSI;
|FPRO;

|PROCESO graba_lins;
mes        = #5#3 % 402;
mes_num    = mes;
sw_periodo = 0;

|SI #5#3 ] #0#0; |Y #5#3 [ #0#1; sw_periodo = 1; |FINSI;

#2#0 = #5#4;
#2#1 = #5#5;
|LIBERA #2;
|LEE 140#2=;
|SI FSalida = 0;
    #2#31 = #2#31 + #5#13;

    |SI sw_periodo = 0;
        #2#7 = #2#7 + #5#13;
    |SINO;
        campo = 18 + mes_num; #2campo = #2campo +  #5#13;
        #2#6 = #2#6 + #5#13;
    |FINSI;
    |GRABA 140#2a;
|FINSI;
|FPRC;

|PROCESO graba_cabs;
mes        = #4#29 % 402;
mes_num    = mes;
sw_periodo = 0;

|SI #4#29 ] #0#0; |Y #4#29 [ #0#1; sw_periodo = 1; |FINSI;

#1#0 = #4#3;
|LIBERA #1;
|LEE 140#1=;
|SI FSalida = 0;
    #1#49 = #1#49 + #4#19;
    #1#50 = #1#50 + #4#20;

    |SI sw_periodo = 0;
        #1#20 = #1#20 + #4#19;
        #1#21 = #1#21 + #4#20;
    |SINO;
        campo = 24 + mes_num; #1campo = #1campo +  #4#19;
        campo = 36 + mes_num; #1campo = #1campo +  #4#20;
        #1#18 = #1#18 + #4#19;
        #1#19 = #1#19 + #4#20;
    |FINSI;
    |GRABA 140#1a;
|FINSI;

|SI enSwDeDonde = 0;
    #706#0 = #4#13;
    |LEE 140#706=;
    |SI FSalida = 0;
        #706#22 = #706#22 + #4#28;

        |SI sw_periodo = 0;
            #706#21 = #706#21 + #4#28;
        |SINO;
            campo = 7 + mes_num; #706campo = #706campo + #4#28;
            #706#20 = #706#20 + #4#28;
        |FINSI;
        |GRABA 140#706a;
        |LIBERA #706;
    |FINSI;
|FINSI;

|BUCLELIN 0graba_lins#4;
|FPRC;

|DEFBUCLE ashismic;
#4#1;
;
"  ", 00000;
"zz", 99999;
e;
NULL, graba_cabs;
|FIN;

|PROCESO bancos;
#6#0 = #7#0;
|LEE 040#6=;
|SI FSalida ! 0; |DDEFECTO #6; |FINSI;

#4#0 = #7#2;
#4#1 = #7#3;
|LEE 040#4=;
|SI FSalida = 0;
    mes     = #4#29 % 402;
    mes_num = mes;

    #706#0 = #4#13;
    |LIBERA #706;
    |LEE 140#706=;
    |SI FSalida = 0;
        #706#20 = #706#20 - #7#7;
        #706#22 = #706#22 - #7#7;
        campo = 7 + mes_num; #706campo = #706campo - #7#7;
        |GRABA 020#706a;
    |FINSI;

    #706#0 = #6#1;
    |LIBERA #706;
    |LEE 140#706=;
    |SI FSalida = 0;
        #706#20 = #706#20 + #7#7;
        #706#22 = #706#22 + #7#7;
        campo = 7 + mes_num; #706campo = #706campo + #7#7;
        |GRABA 020#706a;
    |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE aslinrem;
#7#1;
;
000000, 000;
999999, 999;
e;
NULL, bancos;
|FIN;

|PROCESO borra_01;
#1#18 = 0;
#1#19 = 0;
#1#20 = 0;
#1#21 = 0;
|PARA xxx = 25; |SI xxx [ 50; |HACIENDO xxx = xxx + 1;
      #1xxx = 0;
|SIGUE;

|GRABA 140#1a;
|LIBERA #1;
|FPRC;

|DEFBUCLE asclient;
#1#1;
;
00000;
99999;
be;
NULL, borra_01;
|FIN;

|PROCESO borra_02;
#2#6 = 0;
#2#7 = 0;
|PARA xxx = 19; |SI xxx [ 31; |HACIENDO xxx = xxx + 1;
      #2xxx = 0;
|SIGUE;

|GRABA 140#2a;
|LIBERA #2;
|FPRC;

|DEFBUCLE asconcep;
#2#1;
;
"    ", "  ";
"zzzz", "zz";
be;
NULL, borra_02;
|FIN;

|PROCESO borra_03;
     |PARA xxx = 8; |SI xxx [ 22; |HACIENDO xxx = xxx + 1;
           #706xxx = 0;
     |SIGUE;

     |GRABA 140#706a;
     |LIBERA #706;
|FPRC;

|DEFBUCLE bancospro;
     #706#1001;
     ;
     00;
     99;
     be;
     NULL, borra_03;
|FIN;

|PROCESO recalculo;
enCodBanco = 0;
|HAZ LeeBancoPropio;

|SI vengo_de = 0;
    |BUCLE asclient;
    |BUCLE asconcep;

    enCodBanco = 0;
    |SI enSwDeDonde = 0;
        |BUCLE bancospro;
    |FINSI;
|SINO;
    |PATH_DAT #1  v_path;
    |PATH_DAT #2  v_path;
    |PATH_DAT #4  v_path;
    |PATH_DAT #5  v_path;
    |PATH_DAT #6  v_path;
    |PATH_DAT #7  v_path;
    |SI enSwDeDonde = 0;  |PATH_DAT #706  v_path;  |FINSI;
|FINSI;

|ABRE #1;
|ABRE #2;
|ABRE #706;
|BUCLE ashismic;
|CIERRA #706;
|CIERRA #1;
|CIERRA #2;

|SI enSwDeDonde = 0;
    |ABRE #706;
    |ABRE #4;
    |ABRE #6;
    |BUCLE aslinrem;
    |CIERRA #706;
    |CIERRA #4;
    |CIERRA #6;
|FINSI;
|FPRC;
