|FICHEROS;
     abom0010 #10,MANTE;
     abom0001 #1;
     abom0005 #5;
     abom0011 #11;
     asconcep #21;
     abom0514 #514;
|FIN;

|VARIABLES;
     nDContador   = 0;
     nHContador   = 0;
     nCliente     = 0;
     nVariable    = 0;
     nSwPrint     = 0;
     nLinea       = 0;

     aAlfa        = "";
     aDTipo       = "";
     aHTipo       = "";
     aTipo        = "";

     &enSw        = 0;
     &enCliente   = 0;
     &enContador  = 0;
     &efFecha     = @;
     &eaRetencion = "";

     &eaNombreList  = "";
     &enCuadroIni   = 0;
     &enCuadroFin   = 0;
     &enCampoAncho  = 0;
     &enModoEdita   = 0;
     &enTotalVaria  = 0;
{100}&epPuntEdita   = "";
|FIN;

|PROCESO Tipo5M0010;  |TIPO 5;
     |LINEAS_BI_ATRI #10#1, N, I, 186;
|FPRC;

|PROCESO ActualEl5;
     #5#19 = #10#19;
     #5#23 = #10#0;
     #5#24 = 0;
     |GRABA 020#5a;
     |LIBERA #5;

     #21#0 = #5#5;
     #21#1 = #5#6;
     |LEE 040#21=;
     |SI FSalida ! 0;  |DDEFECTO #21;  |FINSI;

     |SI #21#3 = "H";  |O #21#3 = "S";
         nLinea = #5#1;
     |FINSI;
|FPRC;

|PROCESO GrabaUltimo;
     #5#0 = #10#4;
     #5#1 = nLinea;
     |LEE 101#5=;
     |SI FSalida = 0;
         #5#24 = #10#18;
         |GRABA 020#5a;
         |LIBERA #5;
     |FINSI;
|FPRC;

|DEFBUCLE abom0005_3;
     #5#1;
     23, 20;
     #10#4, 000, #10#0, "N";
     #10#4, 999, #10#0, "N";
     be;
     NULL, ActualEl5, NULL, NULL, GrabaUltimo;
|FIN;

|PROCESO Recalcula;
     #21#0 = #5#5;
     #21#1 = #5#6;
     |LEE 040#21=;
     |SI FSalida ! 0;  |DDEFECTO #21;  |FINSI;

     |SI #21#3 = "H";  |O #21#3 = "S";
         #1#33 = #1#33 + #5#18;
         |SI #5#19 = "S";
             #1#31 = #1#31 + #5#24;
         |FINSI;
         |SI #5#20 = "S";
             #1#10 = #1#10 + #5#25;
             #1#36 = #1#36 + #5#26;
         |FINSI;

         #1#11 = #1#31 - (#1#10 + #1#36);
         #1#32 = #1#10 - #1#33;
     |FINSI;

     |SI #21#3 = "A";
         |SI #5#20 ! "S";
             #1#37 = #1#37 + #5#18;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE abom0005R;
     #5#1;
     ;
     #10#4, 000;
     #10#4, 999;
     ;
     NULL, Recalcula;
|FIN;

|PROCESO Minutar;
     |SI #10#22 = "S";
         |MENAV "      Apunte ya Facturado. Borrelo por Minutas.";
         |ERROR;
         |ACABA;
     |FINSI;

     |LEE 101#10=;
     |SI #10#19 = "N";
         #10#19 = "S";
     |SINO;
         |CONFI "2300N Esta seguro de borrar la minuta realizada : ";
         |SI FSalida ! 0;  |ACABA;  |FINSI;
         #10#19 = "N";
     |FINSI;
     |PINTA #10#19;

     |SI #10#19 = "S";
         |ET Campo23;
             |ENCAMPO #23#10;

         |ET Campo16;
             |ENCAMPO #16#10;
             |SI FSalida = 2;  |VETE Campo23;  |FINSI;

             |ENCAMPO #17#10;
             |SI FSalida = 2;  |VETE Campo16;  |FINSI;

             #10#18 = #10#16 * #10#17;  |PINTA #10#18;
     |FINSI;

     |GRABA 020#10a;
     |LIBERA #10;

     |SI #10#4 ! 0;
         |SI #10#5 ! 99999;
             |ABRE #5;
             #5#0 = #10#4;
             #5#1 = #10#5;
             |LEE 101#5=;
             |SI FSalida = 0;
                 #5#24 = #10#18;
                 |GRABA 020#5a;
                 |LIBERA #5;
             |FINSI;
             |CIERRA #5;
         |SINO;
             |ABRE #21;
             |BUCLE abom0005_3;
             |CIERRA #21;
         |FINSI;

         #1#0 = #10#4;
         |LIBERA #1;
         |LEE 101#1=; ||mINUTAR
         |SI FSalida = 0;
             #1#10 = 0;
             #1#31 = 0;
             #1#32 = 0;
             #1#33 = 0;
             #1#36 = 0;
             #1#37 = 0;

             |ABRE #21;
             |BUCLE abom0005R;
             |CIERRA #21;

             |ABRE #514;
             |LEE 000#514p;
             |SI FSalida ! 0;  |DDEFECTO #514;  |FINSI;
             |CIERRA #514;

             |SI #514#19 = "S";
                 #1#33 = #1#33 - #1#37;
                 #1#32 = #1#10 - #1#33;
             |FINSI;

             |GRABA 020#1a;
         |FINSI;
     |FINSI;

     |PTEC 812;
|FPRC;

|PROCESO Facturar;
     |SI #10#19 = "N";
         |MENAV "      El Apunte no esta Minutado.";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #10#22 = "S";
         |MENAV "      El Apunte ya esta Facturado.";
         |ERROR;
         |ACABA;
     |FINSI;

     enCliente   = #10#1;
     enContador  = #10#0;
     efFecha     = #10#2;
     eaRetencion = "S";
     |SUB_EJECUTA "aspasecc;1";
|FPRC;

|PROCESO EditaAsuntoM010;
     |ABRE #11;

     enTotalVaria  = 99;
     eaNombreList  = "";
     enCuadroIni   = 1030;
     enCuadroFin   = 1879;
     enCampoAncho  = 50;
     enModoEdita   = 0;

     |PARA nVariable = 1;  |SI nVariable [ 100;  |HACIENDO nVariable = nVariable + 1;
           IepPuntEdita  = epPuntEdita1 <-;
           IepPuntEdita = IepPuntEdita + (nVariable - 1);

           #11#0 = #10#0;
           #11#1 = nVariable;
           |LIBERA #11;
           |LEE 101#11=;
           |SI FSalida ! 0;
               epPuntEdita  = "";
           |SINO;
               epPuntEdita  = #11#2;
               |BORRA 020#11a;
           |FINSI;
     |SIGUE;

     |PUSHV  0501 2380;
     |CUADRO 0829 2080;
     |BLANCO 0930 1979;
     |ATRI S;  |PINTA 0936, "Introduzca el Texto de la Minutacion";;  |ATRI s;

     |HAZ Edita;

     |POPV;

     |PARA nVariable = 1;  |SI nVariable [ 100;  |HACIENDO nVariable = nVariable + 1;
           IepPuntEdita = epPuntEdita1 <-;
           IepPuntEdita = IepPuntEdita + (nVariable - 1);

           |DDEFECTO #11;
           #11#0 = #10#0;
           #11#1 = nVariable;
           |LIBERA #11;
           |LEE 1010#11=;
           |SI FSalida ! 0;  |GRABA 020#11b;  |FINSI;
           #11#2 = epPuntEdita;
           |GRABA 020#11a;
     |SIGUE;

     |PARA nVariable = 100;  |SI nVariable ] 1;  |HACIENDO nVariable = nVariable - 1;
           #11#0 = #10#0;
           #11#1 = nVariable;
           |LIBERA #11;
           |LEE 101#11=;
           aAlfa = #11#2;  |QBF aAlfa;

           |SI aAlfa ! "";  |SAL;  |FINSI;

           |BORRA 020#11a;
     |SIGUE;

     |CIERRA #11;
|FPRC;

|PROCESO Impresion;
     |SI nCliente ! 0;  |Y nCliente ! #10#1;
         |PIEINF;
     |FINSI;

     nCliente = #10#1;
     nSwPrint = 1;
     enSw     = 0;  |PRINT;

     |ABRE #11;
     |PARA nVariable = 1;  |SI nVariable [ 100;  |HACIENDO nVariable = nVariable + 1;
           #11#0 = #10#0;
           #11#1 = nVariable;
           |LIBERA #11;
           |LEE 040#11=;
           |SI FSalida = 0;
               enSw = 1;  |PRINT;
           |FINSI;
     |SIGUE;
     |CIERRA #11;
|FPRC;

|PROCESO Modificar;
     |SI #10#22 = "S";
         |MENAV "      Apunte ya Facturado. Borrelo por Minutas.";
         |ERROR;
         |ACABA;
     |FINSI;

     |LEE 101#10=;

     |SI #10#19 ! "S";  |ACABA;  |FINSI;

     |SI #10#4 ! 0;
         #1#0 = #10#4;
         |LIBERA #1;
         |LEE 101#1=;  || MODIFICAR
         |SI FSalida = 0;
             #1#10 = 0;
             #1#31 = 0;
             #1#32 = 0;
             #1#33 = 0;
             #1#36 = 0;
             #1#37 = 0;

             |ABRE #21;
             |BUCLE abom0005R;
             |CIERRA #21;

             |ABRE #514;
             |LEE 000#514p;
             |SI FSalida ! 0;  |DDEFECTO #514;  |FINSI;
             |CIERRA #514;

             |SI #514#19 = "S";
                 #1#33 = #1#33 - #1#37;
                 #1#32 = #1#10 - #1#33;
             |FINSI;

             |GRABA 020#1a;
         |FINSI;
     |FINSI;

     |ET Campo23M;
         |ENCAMPO #23#10;

     |ET Campo16M;
         |ENCAMPO #16#10;
         |SI FSalida = 2;  |VETE Campo23M;  |FINSI;

     |ET Campo17M;
         |ENCAMPO #17#10;
         |SI FSalida = 2;  |VETE Campo16M;  |FINSI;

         |ENCAMPO #26#10;
         |SI FSalida = 2;  |VETE Campo17M;  |FINSI;


     #10#18 = #10#16 * #10#17;  |PINTA #10#18;

     |GRABA 020#10a;
     |LIBERA #10;

     |SI #10#4 ! 0;
         |SI #10#5 ! 99999;
             |ABRE #5;
             #5#0 = #10#4;
             #5#1 = #10#5;
             |LEE 101#5=;
             |SI FSalida = 0;
                 #5#24 = #10#18;
                 |GRABA 020#5a;
                 |LIBERA #5;
             |FINSI;
             |CIERRA #5;
         |SINO;
             |ABRE #21;
             |BUCLE abom0005_3;
             |CIERRA #21;
         |FINSI;

         #1#0 = #10#4;
         |LIBERA #1;
         |LEE 101#1=;  ||MODIFICAR
         |SI FSalida = 0;
             #1#10 = 0;
             #1#31 = 0;
             #1#32 = 0;
             #1#33 = 0;
             #1#36 = 0;
             #1#37 = 0;

             |ABRE #21;
             |BUCLE abom0005R;
             |CIERRA #21;

             |ABRE #514;
             |LEE 000#514p;
             |SI FSalida ! 0;  |DDEFECTO #514;  |FINSI;
             |CIERRA #514;

             |SI #514#19 = "S";
                 #1#33 = #1#33 - #1#37;
                 #1#32 = #1#10 - #1#33;
             |FINSI;

             |GRABA 020#1a;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE abom0010;
     #10#3;
     0;
     00000, "    ", "  ", aDTipo, nDContador;
     99999, "zzzz", "zz", aHTipo, nHContador;
     ;
     NULL, Impresion;
|FIN;

|PROCESO Imprime;
     |PUSHV  0501 2380;
     |CUADRO 1220 1843;
     |BLANCO 1321 1742;
     |PINTA 1321, "Tipo S/N/T :          ";
     |PINTA 1421, "----------------------";
     |PINTA 1521, "<S> Las Facturadas    ";
     |PINTA 1621, "<N> Las No Facturadas ";
     |PINTA 1721, "<T> Todas             ";

     E_inf = "SNTsnt";
     E_sup = 1;
     aTipo = 1334 ? 1;
     aTipo = aTipo > aTipo;
     |POPV;

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "aboz0006";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     nCliente   = 0;
     aDTipo     = aTipo;
     aHTipo     = aTipo;
     nDContador = 0;
     nHContador = 99999;

     |SI aTipo = "T";  aDTipo = " ";  aHTipo = "z";  |FINSI;
     |BUCLE abom0010;

     |SI nSwPrint = 1;  |PIEINF;  |FINSI;

     |FININF;
     |FINIMP;
|FPRC;

|PROCESO ImprimeLinea;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "aboz0006";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     nCliente   = 0;
     aDTipo     = " ";
     aHTipo     = "z";
     nDContador = #10#0;
     nHContador = #10#0;
     |BUCLE abom0010;

     |SI nSwPrint = 1;  |PIEINF;  |FINSI;

     |FININF;
     |FINIMP;
|FPRC;

|PROCESO Tipo11M0010;  |TIPO 11;
     |SI FSalida = 10;  |HAZ Minutar;          |FINSI;
     |SI FSalida = 11;  |HAZ Facturar;         |FINSI;
     |SI FSalida = 12;  |HAZ EditaAsuntoM010;  |FINSI;
     |SI FSalida = 13;  |HAZ Imprime;          |PTEC  812;  |FINSI;
     |SI FSalida = 14;  |HAZ Modificar;        |FINSI;
     |SI FSalida = 15;  |HAZ ImprimeLinea;     |PTEC 812;  |FINSI;
|FPRC;
