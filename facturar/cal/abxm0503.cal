|| Para activar DESPANET quitar la ultima linea del proceso CompruebaDSOPORTE

|FICHEROS;
     abxm0503 #503;

     abom0514 #514;
     abom0518 #518;

     abxw0022 #922,MANTE;

     :/gecochek/def/gecom001 #401;

     :/dsoporte/def/dsprem01 #301;
     :/dsoporte/def/dsprem05 #305;
     :/dsoporte/def/dsprem07 #307;
     :/dsoporte/def/dsprem99 #399;

     :/dsoporte/def/dsorm001 #300;
     :/dsoporte/def/dsorm015 #315;
|FIN;

|VARIABLES;
     nBoton1          = 0;
     nBoton2          = 0;
     nBoton3          = 0;
     nBotonDespanet   = -1;
     nCampo           = 0;
     nModo            = 0;
     nPanta           = 0;
     nRango           = 0;
     nVent922         = 0;
     nPant922         = 0;
     nReg             = 0;
     nGrupo           = 0;
     nLong            = 0;
     nCaracter        = 0;
     nPos             = 0;
     nCamuf           = 0;
     nNum             = 0;
     nCod             = 0;
     nHandle          = 0;
     nVent            = 0;

     aEsc1            = "";
     aEsc2            = "";
     aRetu            = "";
     aTecla           = "";
     aAlfa            = "";
     aBase            = "";
     aPathDSoporte    = "";
     aOperacion       = "";
     aDOperacion      = "";
     aHora            = "";
     aUsuario         = "";
     aNGrupo          = "";
     aLong            = "";
     aAlfa1           = "";
     aServidor        = "";
     aPathGecochek    = "";
     aAbreTXT         = "";
     aBaseMensaje     = "";
     aNomDes          = "";
     aIP              = "";
     aSalida          = "";
     aMensaje         = "";
     aAutenti         = "";
     aTo              = "";
     aAsunto          = "";
     aFrom            = "";
     aFecha           = "";
     aMac             = "";

     fFecha           = @;

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     &enCargaPerfiles = 0;
     &eaDsOporte      = "";
     &enGrid          = 0;
     &eaPassEnc       = "";
     &eaPass          = "";
     &enCuenta        = 0;
     &eaModoNet       = "";
     &eaUsuAfectado   = "";
     &eaBaseNet       = "";
     &eaFechaNet      = "";
     &eaUsuNet        = "";
|FIN;

|PROCESO CreaUsuarios;
     |CONFI "0000SHan habido cambios que ser  necesario guardar perfiles de usuarios. Desea hacerlo ahora";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 0530, -1, 16, "Realizando trabajo";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802; |PAUSA;

     |SI eaDsOporte = "A";
         |SUB_EJECUTA_NP ":dsoporte/dsprez02;AUTOMATICO";
     |FINSI;

     |SI eaDsOporte = "G";
         aAlfa = ":dsoporte/dsorz020;" + #514#43;
         |SUB_EJECUTA_NP aAlfa;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;
|FPRC;

|PROCESO GrabaHistorico;
     aOperacion  = "A";
     aDOperacion = "ALTA DEL USUARIO";

     |HORA aHora;

     |ABRE #399;
     nReg = 1;
     |LEE 000#399u;
     |SI FSalida = 0;
         nReg = #399#0 + 1;
     |FINSI;

     |DBASS aBase;  |QBF aBase;

     aAlfa = aBase % -201;

     |ABRE #301;
     #301#0 = aAlfa;
     |LEE 000#301=;
     |SI FSalida ! 0;  |DDEFECTO #301;  |FINSI;
     |CIERRA #301;

     #399#0  = nReg;
     |GRABA 020#399b;

     #399#1  = aUsuario;
     #399#2  = ~;
     #399#3  = aHora;
     #399#4  = aOperacion;
     #399#5  = aDOperacion;
     #399#6  = aAlfa + "0000";
     #399#7  = #514#32;
     #399#8  = #514#33;
     #399#9  = #301#1;
     #399#10 = "DESPANET";
     #399#11 = "DESPANET";
     #399#12 = #305#1;
     #399#13 = #307#3;
     aAlfa   = #399#6 + " " + #305#1;  |QBF aAlfa;
     aAlfa  = aAlfa + #307#3;
     #399#14 = aAlfa;
     #399#15 = "N";
     #399#16 = "N";
     #399#17 = eaPassEnc;
     #399#18 = 9999;
     #399#19 = 0;
     #399#20 = Usuario % 810;
     |GRABA 020#399a;
     |LIBERA #399;
     |CIERRA #399;

     |ABRE #300;
     |SI eaDsOporte = "A";
         |SI #401#12 = 0;
             #300#0 = 9999;
             |LEE 000#300];
             |SI FSalida = 0;
                 |LEE 000#300a;
             |SINO;
                 |LEE 000#300u;
             |FINSI;

             #401#12 = 9000;
             |SI FSalida = 0; |Y  #300#0 ] 9000;
                 #401#12 = #300#0 + 1;
             |FINSI;
         |FINSI;

         nGrupo  = #401#12;
         aNGrupo = #401#2;
     |SINO;
         nGrupo  = #514#43;
         aNGrupo = "DESPANET ABOGADOS";
     |FINSI;

     #300#0 = nGrupo;
     |LEE 101#300=;
     |SI FSalida ! 0;
         |DDEFECTO #300;
         #300#0 = nGrupo;
         |GRABA 020#300b;
     |FINSI;
     #300#1 = aNGrupo;
     |GRABA 020#300a;
     |LIBERA #300;
     |CIERRA #300;
|FPRC;

|PROCESO EncriptaMAC;
     |QBF eaPass;
     aLong   = eaPass % 0;
     nLong   = aLong;
     eaPassEnc = "";
     |PARA nCaracter = 1; |SI nCaracter [ nLong; |HACIENDO nCaracter = nCaracter + 1;
           nPos   = (nCaracter * 100) + 1;
           aAlfa1 = eaPass % nPos;

           nCamuf = &aAlfa1;
           nCamuf = nCamuf * 2;

           nNum      = ((nCamuf - (nCamuf $ 26)) / 26 ) + 65;
           eaPassEnc = eaPassEnc + &nNum;

           nNum      = (nCamuf $ 26) + 65;
           eaPassEnc = eaPassEnc + &nNum;
     |SIGUE;
|FPRC;

|PROCESO CargaMac;
     |DBASS aBase;  |QBF aBase;

     aAlfa     = aBase % -201;
     aServidor = aBase % -303;  |QBF aServidor;
     nNum      = aServidor;

     |SI nNum      = 0;   aServidor = "001";  |FINSI;
     |SI aServidor = "";  aServidor = "001";  |FINSI;

     eaPass = aAlfa + "0000" + aServidor + aUsuario;
     |HAZ EncriptaMAC;
|FPRC;

|PROCESO GrabaUsuAgrupacion;
     |DBASS aBase;  |QBF aBase;
     aPathDSoporte = aBase + "dsoporte/fich/";
     aPathGecochek = aBase + "gecochek/fich/";

     |PATH_DAT #300 aPathDSoporte;
     |PATH_DAT #301 aPathDSoporte;
     |PATH_DAT #305 aPathDSoporte;
     |PATH_DAT #307 aPathDSoporte;
     |PATH_DAT #399 aPathDSoporte;
     |PATH_DAT #401 aPathGecochek;

     |ABRE #305;
     #305#0 = #514#32;
     |LEE 000#305=;
     |SI FSalida ! 0;  |DDEFECTO #305;  |FINSI;
     |CIERRA #305;

     |ABRE #307;
     #307#0 = #514#32;
     #307#1 = #514#33;
     |LEE 000#307=;
     |SI FSalida ! 0;  |DDEFECTO #307;  |FINSI;
     |CIERRA #307;

     |ABRE #401;
     nCod   = #503#0;
     #401#0 = #503#0;
     |LEE 000#401=;
     |SI FSalida = 0;
         |PARA nCod = 1;  |SI nCod [ 99999;  |HACIENDO nCod = nCod + 1;
               #401#0 = nCod;
               |LEE 000#401=;
               |SI FSalida ! 0;  |SAL;  |FINSI;
         |SIGUE;
     |FINSI;

     |DDEFECTO #401;
     #401#0 = nCod;
     |GRABA 020#401b;

     #401#1  = #503#1;
     #401#2  = #503#19;
     #401#4  = aUsuario;
     #401#5  = #401#4;
     #401#7  = #514#32;
     #401#8  = #305#1;
     #401#9  = #514#33;
     #401#10 = #307#3;
     #401#16 = #503#10;

     |HAZ CargaMac;
     #401#6 = eaPassEnc;

     |HAZ GrabaHistorico;

     |GRABA 020#401a;
     |LIBERA #401;
     |CIERRA #401;
|FPRC;

|PROCESO GrabaUsuGrupos;
     |DBASS aBase;  |QBF aBase;
     aPathDSoporte = aBase + "dsoporte/fich/";

     |PATH_DAT #300 aPathDSoporte;
     |PATH_DAT #301 aPathDSoporte;
     |PATH_DAT #315 aPathDSoporte;
     |PATH_DAT #399 aPathDSoporte;

     |ABRE #315;
     #315#0 = #514#43;
     #315#1 = aUsuario;
     |LEE 101#315=;
     |SI FSalida ! 0;
         |DDEFECTO #315;
         #315#0 = #514#43;
         #315#1 = aUsuario;
         |GRABA 020#315b;
     |FINSI;

     #315#2  = #503#1;
     #315#3  = aUsuario;
     #315#4  = 0;

     |HAZ CargaMac;

     #315#5 = eaPassEnc;
     #315#6  = #503#19;

     |HAZ GrabaHistorico;

     |GRABA 020#315a;
     |LIBERA #315;
     |CIERRA #315;
|FPRC;

|PROCESO DsCorreo;
     aAbreTXT = aBaseMensaje + "adjunto.txt";
     |XABRE "WB", aAbreTXT, nHandle;

     aAlfa = aNomDes + " le agradece la confianza depositada en nosotros." + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = "A continuación se le indica el enlace para obtener acceso a las ";
     aAlfa = aAlfa + "aplicaciones DESPANET a través del portal de acceso." + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;  |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "Usuario:                   " + aUsuario + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa =  "Password:                  " + aUsuario + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "Pinche en http  " + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = "http://www.geconet.net/portal/";
     aAlfa = aAlfa + "crearAcceso.php?claveGeconet=" + eaPassEnc;  |QBF aAlfa;

     eaPass = #503#19;  |HAZ EncriptaMAC;
     aAlfa  = aAlfa + "&email=" + eaPassEnc;  |QBF aAlfa;
     |XGRABA nHandle, aAlfa;

     eaPass    = "";
     eaPassEnc = "";

     aAlfa = &13 + &10;  |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;  |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "Para cualquier aclaración o duda no dude en ponerse en contacto con nosotros." + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;

     aAlfa = ("_" * 134) + &13 + &10;   |XGRABA nHandle, aAlfa;

     aAlfa =  "Este correo electrónico y, en su caso, cualquier fichero anexo al mismo, contiene";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "información de carácter confidencial exclusivamente dirigida a su destinatario o";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "destinatarios. Queda prohibida su divulgación, copia o distribución a terceros sin la";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "previa autorización escrita de la empresa. En el caso de haber recibido este correo";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "electrónico por error, se ruega  notifíquese inmediatamente esta circunstancia mediante";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "reenvío a la dirección electrónica del remitente y proceda a su destrucción.";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;

     aAlfa = "El consumo de papel es perjudicial para el medio ambiente. Por favor téngalo en cuenta";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "antes de imprimir este mensaje.";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = ("_" * 134) + &13 + &10;   |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;

     |XCIERRA nHandle;

     aIP      = #518#2;           |QBF aIP;         || Direccion IP
     aSalida  = #518#4;           |QBF aSalida;     || servidor proxy

     aMensaje = "$$$$" + aAbreTXT;

     aAutenti = #518#5;

     |SI #514#20 = "S";
         aAutenti = "!" + aAutenti;
     |FINSI;

     |DSCORREO_ENVIA aIP, aSalida, aAutenti, aTo, aAsunto, aMensaje, aAbreTXT;
     |SI FSalida < 0;
         |MENAV "0000 Ha habido un error durante el envio.";
     |FINSI;
|FPRC;

|PROCESO CorreoAcceso;
     aNomDes = "DS, S.L.";

     aTo = #503#19;  |QBF aTo;
     |SI aTo = "";  |ACABA;  |FINSI;

     aFrom    = "soporte@diagram.es";  |QBF aFrom;
     aAsunto  = "Acceso para el uso de las aplicaciones DESPANET";

     |HAZ DsCorreo;

     |FBORRA aAbreTXT;
|FPRC;

|PROCESO NotificaDsCorreo;
     aAbreTXT = aBaseMensaje + "adjunto.txt";
     |XABRE "WB", aAbreTXT, nHandle;

     aAlfa = aAsunto;
     |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;
     |XGRABA nHandle, aAlfa;

     |XCIERRA nHandle;

     aIP      = #518#2;           |QBF aIP;         || Direccion IP
     aSalida  = #518#4;           |QBF aSalida;     || servidor proxy

     aMensaje = "$$$$" + aAbreTXT;

     aAutenti = #518#5;

     |SI #514#20 = "S";
         aAutenti = "!" + aAutenti;
     |FINSI;

     |DSCORREO_ENVIA aIP, aSalida, aAutenti, aTo, aAsunto, aMensaje, aAbreTXT;
     |SI FSalida < 0;
         |MENAV "0000 Ha habido un error durante el envio.";
     |FINSI;
|FPRC;

|PROCESO EnviaNotificacion;
     aTo      = " joaquin.ab@diagram.es";

     |DBASE aBaseMensaje;  |QBF aBase;
     aBaseMensaje = aBaseMensaje + "dscorreo/";
     aFrom = "no_reply@diagram.es";  |QBF aFrom;
     aAsunto = "DESPANET (abogados): " + eaModoNet + " " + eaUsuAfectado + " " + eaBaseNet + " " + eaFechaNet + " " + eaUsuNet;

     |HAZ NotificaDsCorreo;
|FPRC;

|PROCESO Habilitar;
     aUsuario = "PR" + (("00" + #48#0) % -102) + (("000000" + #503#0) % -106);

     |DBASS aBase;  |QBF aBase;
     aPathDSoporte = aBase + "dsoporte/fich/";

     |SI eaDsOporte = "A";
         |PATH_DAT #307 aPathDSoporte;

         |ABRE #307;
         #307#0 = #514#32;
         #307#1 = #514#33;
         |LEE 000#307=;
         |SI FSalida ! 0;
             |MENAV "0000No existe el Area/Nivel, por favor pongase en contacto con su distribuidor";
             |CIERRA #307;
             |ACABA;
         |FINSI;
         |CIERRA #307;
     |FINSI;

     |SI eaDsOporte = "G";
         |PATH_DAT #300 aPathDSoporte;

         |ABRE #300;
         #300#0 = #514#43;
         |LEE 000#300=;
         |SI FSalida ! 0;
             |MENAV "0000No existe el Grupo, por favor pongase en contacto con su distribuidor";
             |CIERRA #300;
             |ACABA;
         |FINSI;
         |CIERRA #300;
     |FINSI;

     aAlfa = #503#19;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000No est  introducido el e_mail del procurador.";
         |ACABA;
     |FINSI;

     |CONFI "0000NSeguro que quiere habilitar y mandar un acceso al procurador seleccionado";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 2799, -1, 16, "Selecci¢n de cuentas de correo";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |SUB_EJECUTA "abom0518;PIDECUENTAX";
     |ABRE #518;
     #518#0 = enCuenta;
     |LEE 000#518=;
     |SI FSalida ! 0;
        |CIERRA #518;
        |MENAV "       No existe la Cuenta de Correo.";
        |ACABA;
     |FINSI;
     |CIERRA #518;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;
     |FINVENTANA nVent;

     |VENTANA 0501, 0530, -1, 16, "Habilitando Procurador";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |SI eaDsOporte = "A";
         |HAZ GrabaUsuAgrupacion;
     |FINSI;

     |SI eaDsOporte = "G";
         |HAZ GrabaUsuGrupos;
     |FINSI;

     |HAZ CorreoAcceso;

     |HORA aHora;
     eaModoNet     = "Habilitar";
     eaUsuNet      = Usuario % 810; |QBF eaUsuNet;
     fFecha        = ~;
     aFecha        = fFecha;
     eaFechaNet    = aFecha + " " + aHora;
     eaUsuAfectado = aUsuario;
     |HAZ EnviaNotificacion;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;
     |FINVENTANA nVent;

     |PULSATECLA;
     |PULSATECLA;

     |LEE 101#503=;
     |SI FSalida = 0;
         #503#20 = "S";
         |GRABA 020#503a;
         |LIBERA #503;
     |FINSI;

     |REFRESCACONTROL enGrid;
     enCargaPerfiles = 1;

     |MENAV "0000Procurador habilitado.";
|FPRC;

|PROCESO Deshabilitar;
     |CONFI "0000NQuiere deshabilitar al procurador de DESPANET";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aUsuario = "PR" + (("00" + #48#0) % -102) + (("000000" + #503#0) % -106);

     |DBASS aBase;  |QBF aBase;
     aPathDSoporte = aBase + "dsoporte/fich/";
     aPathGecochek = aBase + "gecochek/fich/";

     |PATH_DAT #300 aPathDSoporte;
     |PATH_DAT #301 aPathDSoporte;
     |PATH_DAT #399 aPathDSoporte;

     |SI eaDsOporte = "A";
         |ABRE #305;
         #305#0 = #514#32;
         |LEE 000#305=;
         |SI FSalida ! 0;  |DDEFECTO #305;  |FINSI;
         |CIERRA #305;

         |ABRE #307;
         #307#0 = #514#32;
         #307#1 = #514#33;
         |LEE 000#307=;
         |SI FSalida ! 0;  |DDEFECTO #307;  |FINSI;
         |CIERRA #307;

         |PATH_DAT #401 aPathGecochek;

         |ABRE #401;
         |SELECT #3#401;
         #401#4 = aUsuario;
         |LEE 101#401=;
         |SI FSalida = 0;
             |BORRA 020#401a;
             |LIBERA #401;
         |FINSI;
         |CIERRA #401;

         aMac = #401#6;
     |FINSI;

     |SI eaDsOporte = "G";
         |PATH_DAT #315 aPathDSoporte;

         |ABRE #315;
         #315#0 = #514#43;
         #315#1 = aUsuario;
         |LEE 101#315=;
         |SI FSalida = 0;
             |BORRA 020#315a;
             |LIBERA #315;
         |FINSI;
         |CIERRA #315;

         aMac = #315#5;
     |FINSI;

     aOperacion  = "B";
     aDOperacion = "BAJA DEL USUARIO";

     |HORA aHora;

     |ABRE #399;
     nReg = 1;
     |LEE 000#399u;
     |SI FSalida = 0;
         nReg = #399#0 + 1;
     |FINSI;

     |DBASS aBase;  |QBF aBase;
     aAlfa = aBase % -201;

     |ABRE #301;
     #301#0 = aAlfa;
     |LEE 000#301=;
     |SI FSalida ! 0;  |DDEFECTO #301;  |FINSI;
     |CIERRA #301;

     #399#0  = nReg;
     |GRABA 020#399b;

     #399#1  = aUsuario;
     #399#2  = ~;
     #399#3  = aHora;
     #399#4  = aOperacion;
     #399#5  = aDOperacion;
     #399#6  = aAlfa + "0000";
     #399#7  = #514#32;
     #399#8  = #514#33;
     #399#9  = #301#1;
     #399#10 = "DESPANET";
     #399#11 = "DESPANET";
     #399#12 = #305#1;
     #399#13 = #307#3;
     aAlfa   = #399#6 + " " + #305#1;  |QBF aAlfa;
     aAlfa  = aAlfa + #307#3;
     #399#14 = aAlfa;
     #399#14 = aAlfa;
     #399#15 = "N";
     #399#16 = "N";
     #399#17 = aMac;
     #399#18 = 9999;
     #399#19 = 0;
     #399#20 = Usuario % 810;
     |GRABA 020#399a;
     |LIBERA #399;
     |CIERRA #399;

     |LEE 101#503=;
     |SI FSalida = 0;
         #503#20 = "N";
         |GRABA 020#503a;
         enCargaPerfiles = 1;
     |FINSI;
     |LIBERA #503;

     |VENTANA 0501, 2799, -1, 16, "Selecci¢n de cuentas de correo";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |SUB_EJECUTA "abom0518;PIDECUENTAX";
     |ABRE #518;
     #518#0 = enCuenta;
     |LEE 000#518=;
     |SI FSalida = 0;
         eaModoNet     = "Deshabilitar";
         eaUsuNet      = Usuario % 810; |QBF eaUsuNet;
         fFecha        = ~;
         aFecha        = fFecha;
         eaFechaNet    = aFecha + " " + aHora;
         eaUsuAfectado = aUsuario; |QBF eaUsuAfectado;
         |HAZ EnviaNotificacion;
     |FINSI;
     |CIERRA #518;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;
     |FINVENTANA nVent;

     |REFRESCACONTROL enGrid;
     enCargaPerfiles = 1;

     |MENAV "0000Procurador Deshabilitado.";
|FPRC;

|PROCESO Despanet;
     |SI #503#20 = "N";
         |HAZ Habilitar;
     |SINO;
         |HAZ Deshabilitar;
     |FINSI;
|FPRC;

|| -------------------------------------------------------------------------

|PROCESO PintaPantalla922;
     |VENTANA 0501, 2799, -1, 16, "Procuradores";
     nVent922 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent922;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SI nModo = 1;
         |DDEFECTO #503;
         |LEE 000#503u;

         |DDEFECTO #922;
         #922#0 = #503#0 + 1;
     |SINO;
         |SI nModo ! 4;
             |LEE 101#503=;
         |SINO;
             |LEE 000#503=;
         |FINSI;

         |PARA nCampo = 0;  |SI nCampo [ 21;  |HACIENDO nCampo = nCampo + 1;
               #922nCampo = #503nCampo;
         |SIGUE;
     |FINSI;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     |PINPA #0#922;
     nPant922 = FSalida;

     |PINDA #0#922;

     |SI nModo = 1;
         |C_M #922#0, 1, "S";
         |ENDATOS #1#922;
     |FINSI;

     |SI nModo = 2;
         |C_M #922#0, 1, "N";
         |ENDATOS #2#922;
     |FINSI;

     |SI nModo = 4;
         aEsc1  = &255 + "806";
         aEsc2  = &255 + "807";
         aRetu  = &255 + "802";
         |PARA; |SI;  |HACIENDO;
             FSalida = "::{{001}}Salir";
             |LEETECLA aTecla;
             |SI aTecla = aEsc1; |SAL;  |FINSI;
             |SI aTecla = aEsc2; |SAL;  |FINSI;
             |SI aTecla = aRetu; |SAL;  |FINSI;
         |SIGUE;

         FSalida = 1;
     |FINSI;

     |SI FSalida = 0;
         |SI nModo ! 4;
             |PARA nCampo = 0;  |SI nCampo [ 21;  |HACIENDO nCampo = nCampo + 1;
                   #503nCampo = #922nCampo;
             |SIGUE;

             |GRABA 020#503a;
             |LIBERA #503;
         |FINSI;
     |SINO;
         |SI nModo = 1;
             #503#0 = #922#0;
             |LEE 101#503=;
             |SI FSalida = 0;
                 |BORRA 020#503a;
                 |LIBERA #503;
             |FINSI;
         |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent922;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent922;
     |PULSATECLA;

     |REFRESCACONTROL enGrid;
|FPRC;

|PROCESO Alta;
     nModo = 1;   |HAZ PintaPantalla922;

     |FOCOTECLADO enGrid;
|FPRC;

|PROCESO Modificar;
     nModo = 2;   |HAZ PintaPantalla922;

     |FOCOTECLADO enGrid;
|FPRC;

|PROCESO Borrar;
     |CONFI "0000NSeguro que quiere BORRAR el registro";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#503=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BORRA 020#503a;
     |LIBERA #503;

     |REFRESCACONTROL enGrid;
|FPRC;

|PROCESO Evento503;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#503=;

         |SI eaDsOporte = "N";  |ACABA;  |FINSI;

         |SI nBotonDespanet ! -1;
             |FIN_CONTROL_WINDOWS nBotonDespanet;
         |FINSI;

         |SI #503#20 = "N";
             aAlfa = "BOTON,{{197}}Habilitar acceso DESPANET";
         |SINO;
             aAlfa = "BOTON,{{197}}Deshabilitar acceso DESPANET";
         |FINSI;

         |CONTROL_SIMPLE 0, aAlfa, 2702, 2730, Despanet;
         nBotonDespanet = FSalida;
     |FINSI;

     |SI FSalida = 4;
         |LEE 000#503=;
         |SI FSalida = 0;
             |HAZ Modificar;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo80Fxm503;  |TIPO 80;
     |ABRET #503;

     FSalida = 2999;
     |HAZ DesactivaTipo80;
|FPRC;

|PROCESO Tipo90Fxm503;  |TIPO 90;
     |CIERRAT #503;
|FPRC;

|PROGRAMA;
     |ABRE #514;
     |LEE 000#514p;
     |SI FSalida ! 0;  |DDEFECTO #514;   |FINSI;
     |CIERRA #514;

     |HAZ CompruebaDSOPORTE;

     enCargaPerfiles = 0;

     |CABEZA "Procuradores";

     |PINPA #0#503;
     nPanta = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}}Borrar", 2788, 2798, Borrar;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Modificar", 2776, 2786, Modificar;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{193}}Alta", 2764, 2774, Alta;
     nBoton3 = FSalida;

     nRango = 4 + 8 + 16 +  32 + 128;

     |LEE 040#503p;

     |LINEAL_SIMPLE #1#503, nRango, 0601, 2899, NULL, NULL, Evento503;
     enGrid = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + enGrid;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;

     |SI enCargaPerfiles = 1;
         |HAZ CreaUsuarios;
     |FINSI;

     |PULSATECLA;
|FPRO;
