|FICHEROS;
   asz00004 #0;

   asw00030 #11,MANTE;
   ashismic #12;
   ashismil #13;
   asm00006 #14;
   asw00031 #15,MANTE;

   camaasil@ #1000;
   camaasic@ #1001;
   canempre@ #1002;
   camandia@ #1003;
   cacuenta@ #1004;
|FIN;

|VARIABLES;
   fFecha = @;

   aAlfa  = "";
   aAlfa1 = "";
   aMarca = "";
   aDef   = "";
   aDirec = "";
|FIN;

|PROCESO LineasAsto;
   #cacuenta@#0 = #camaasil@#4;
   #cacuenta@#1 = #camaasil@#5;
   |LEE 000#cacuenta@.=;
   |SI FSalida ! 0; |DDEFECTO #cacuenta@; |FINSI;

   #camandia@#0 = #camaasil@#0;
   |LEE 000#camandia@.=;
   |SI FSalida ! 0; |DDEFECTO #camandia@; |FINSI;

   #asw00031#0 = #camaasil@#0;
   #asw00031#1 = #camaasil@#1;
   #asw00031#2 = #camaasil@#2;
   #asw00031#3 = #camaasil@#3;
   |LEE 000#asw00031.=;
   |SI FSalida ! 0;
      |DDEFECTO #asw00031;
      #asw00031#0 = #camaasil@#0;
      #asw00031#1 = #camaasil@#1;
      #asw00031#2 = #camaasil@#2;
      #asw00031#3 = #camaasil@#3;
      |SI #camaasil@#8 = "D";
         #asw00031#4 = #camaasil@#4;
         #asw00031#5 = "";
      |SINO;
         #asw00031#4 = "";
         #asw00031#5 = #camaasil@#4;
      |FINSI;
      #asw00031#6  = #camaasil@#6;
      #asw00031#7  = #camaasil@#7;
      #asw00031#8  = #camaasil@#9;
      #asw00031#9  = #camandia@#1;
      #asw00031#10 = #canempre@#2;
      #asw00031#11 = #canempre@#3;
      #asw00031#12 = #canempre@#1;
      #asw00031#13 = #cacuenta@#2;
      #asw00031#14 = #camaasic@#4;
      #asw00031#15 = #camaasic@#5;
      #asw00031#16 = #cacuenta@#53;
      |GRABA 020#asw00031.n;
   |FINSI;
|FPRC;

|DEFBUCLE LineasAsto;
#camaasil@#1004;
;
#ashismil#16, #ashismil#17, #ashismil#18, 0000;
#ashismil#16, #ashismil#17, #ashismil#18, 9999;
;
NULL, LineasAsto;
|FIN;

|PROCESO GrabaLineas;
   |DDEFECTO #asw00030;
   #asw00030#0 = #ashismil#0;
   #asw00030#1 = #ashismil#1;
   #asw00030#2 = #ashismil#2;
   #asw00030#3 = #ashismic#3;
   #asw00030#4 = #ashismic#4;
   #asw00030#5 = #ashismil#16;
   #asw00030#6 = #ashismil#17;
   #asw00030#7 = #ashismil#18;
   #asw00030#8 = #ashismil#19;
   #asw00030#9 = #ashismil#20;
   #asw00030#10 = #ashismil#21;
   #asw00030#13 = #ashismil#13;
   #asw00030#14 = aMarca;

   |SI aDef ! "";
      #canempre@#2 = #ashismil#20;
      #canempre@#3 = #ashismil#21;
      |LEE 000#canempre@.=;
      |SI FSalida ! 0; |DDEFECTO #canempre@; |FINSI;
      #asw00030#15 = #canempre@#1;

      |BUCLE LineasAsto;

      #camaasil@#0 = #ashismil#16;
      #camaasil@#1 = #ashismil#17;
      #camaasil@#2 = #ashismil#18;
      #camaasil@#3 = 1;
      |LEE 000#camaasil@.];
      |PARA; |SI FSalida = 0; |Y #camaasil@#0 = #ashismil#16; |Y #camaasil@#1 = #ashismil#17;
       |Y #camaasil@#2 = #ashismil#18; |HACIENDO;
         |SI #camaasil@#19 = "B";
            #asw00030#11 = #camaasil@#9;
         |FINSI;
         |SI #asw00030#13 = #camaasil@#9; |Y #camaasil@#19 = "B";
            #asw00030#11 = #camaasil@#9;
            #asw00030#12 = "*";
            |SAL;
         |FINSI;
         |LEE 000#camaasil@.s;
      |SIGUE;
   |FINSI;

   |GRABA 020#asw00030.c;
|FPRC;

|DEFBUCLE GrabaLineas;
#ashismil#1;
;
#ashismic#0, #ashismic#1, 001;
#ashismic#0, #ashismic#1, 999;
;
NULL, GrabaLineas;
|FIN;

|PROCESO CreaTempo;
   ||SI #ashismic#39 = 0; |Y #ashismic#41 = 1; |Y #ashismic#42 = 0; |ACABA; |FINSI;

   #asm00006#0 = #ashismic#43;
   |LEE 000#asm00006.=;
   |SI FSalida ! 0; |DDEFECTO #asm00006; |FINSI;
   aDirec = #asm00006#6; |QBF aDirec;
   aAlfa = aDirec + "def/camaasil.mas";
   |CARGA_DEF aAlfa, camaasil@;
   |SI FSalida ! 0;
      aDef = "";
   |SINO;
      aAlfa = aDirec + "def/canempre.mas";
      |CARGA_DEF aAlfa, canempre@;
      aAlfa = aDirec + "fich/"; |PATH_DAT #canempre@#aAlfa#;

      aAlfa = aDirec + "def/camandia.mas";
      |CARGA_DEF aAlfa, camandia@;

      aAlfa = aDirec + "def/camaasic.mas";
      |CARGA_DEF aAlfa, camaasic@;

      aAlfa = aDirec + "def/cacuenta.mas";
      |CARGA_DEF aAlfa, cacuenta@;

      aDef = aAlfa;
      aAlfa = aDirec + "fich/" + (("00000" + #ashismil#20) % -105) + #ashismil#21 + "/";
      |PATH_DAT #camaasic@#aAlfa#; |PATH_DAT #cacuenta@#aAlfa#;
      |PATH_DAT #camaasil@#aAlfa#; |PATH_DAT #camandia@#aAlfa#;
      |ABRE #canempre@; |ABRE #camaasil@; |ABRE #camaasic@;
      |ABRE #camandia@; |ABRE #cacuenta@;
   |FINSI;

   |SI aMarca = " "; aMarca = "*"; |SINO; aMarca = " "; |FINSI;
   |BUCLE GrabaLineas;

   |SI aDef ! "";
      |CIERRA #cacuenta@; |DESCARGA_DEF #cacuenta@;
      |CIERRA #camaasic@; |DESCARGA_DEF #camaasic@;
      |CIERRA #camandia@; |DESCARGA_DEF #camandia@;
      |CIERRA #canempre@; |DESCARGA_DEF #canempre@;
      |CIERRA #camaasil@; |DESCARGA_DEF #camaasil@;
   |FINSI;
|FPRC;

|DEFBUCLE CreaTempo;
#ashismic#1;
29;
#asz00004#0, #asz00004#1, #asz00004#2;
#asz00004#3, #asz00004#4, #asz00004#5;
;
NULL, CreaTempo;
|FIN;

|RUTINA inf;
   #asw00030#0 = 00;
   #asw00030#1 = 000000;
   #asw00030#2 = 000;
|FRUT;

|RUTINA sup;
   #asw00030#0 = "zz";
   #asw00030#1 = 999999;
   #asw00030#2 = 999;
|FRUT;

|PROCESO Tipo5; |TIPO 5;
   #asw00030#12 = "*";
   |LINEAS_BI_ATRI #asw00030#12,S,D,-1;
|FPRC;

|PROCESO MiraEjer;
   |SI FSalida = 10;
      fFecha = ~; aAlfa = fFecha;
      aAlfa = aAlfa % -104;
      aAlfa1 = "01.01." + aAlfa; #asz00004#2 = aAlfa1; |PINTA #asz00004#2;
      aAlfa1 = "31.12." + aAlfa; #asz00004#5 = aAlfa1; |PINTA #asz00004#5;
   |FINSI;
|FPRC;

|RUTINA infasw31;
   #asw00031#0 = #asw00030#5;
   #asw00031#1 = #asw00030#6;
   #asw00031#2 = #asw00030#7;
   #asw00031#3 = 0000;
|FRUT;

|RUTINA supasw31;
   #asw00031#0 = #asw00030#5;
   #asw00031#1 = #asw00030#6;
   #asw00031#2 = #asw00030#7;
   #asw00031#3 = 9999;
|FRUT;

|PROCESO MiraAsto; |TIPO 11;
   |SI FSalida = 10;
      |PUSHV 0501 2380;
      |ENTLINEAL #1#asw00031, -4, 4, 21, 1, infasw31, supasw31;
      |POPV;
   |FINSI;
   |SI FSalida = 11;
      aAlfa = "    NEsta opcion elimina el vinculo con el asiento de contabilidad. ¨ Continuar ?";
      |CONFI aAlfa;
      |SI FSalida = 0;
         |SI #asw00030#12 = "*";
            aAlfa = "    NHay un asiento en contabilidad que quedara desvinculado. ¨ Esta seguro ?";
            |CONFI aAlfa;
            |SI FSalida = 0;
               #ashismic#0 = #asw00030#0;
               #ashismic#1 = #asw00030#1;
               |LEE 000#ashismic.=;
               |SI FSalida = 0;
                  |PDEFECTO #ashismic, 37, 44;
                  |GRABA 020#ashismic.a;
               |FINSI;
               #asw00030#5 = 0;
               #asw00030#6 = "01.01.0000";
               #asw00030#7 = 0;
               #asw00030#8 = 0;
               #asw00030#9 = 0;
               #asw00030#10 = 0;
               #asw00030#11 = 0;
               #asw00030#12 = " ";
               #asw00030#15 = "";
               |GRABA 020#asw00030.a;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA "Cotejo enlace contable";

   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0; |Y #0#6 = "S";
      aAlfa = "tm" + Usuario; |NOME_DAT #asw00030#aAlfa#;
      aAlfa = "tl" + Usuario; |NOME_DAT #asw00031#aAlfa#;
      |DBASS aAlfa; |QBF aAlfa;
      |DELINDEX #asw00030; |ABRE #asw00030;
      |DELINDEX #asw00031; |ABRE #asw00031; |ABRE #asm00006;
      aMarca = " "; |BUCLE CreaTempo;

      |ENTLINEAL #1#asw00030, -3, 4, 18, 1, inf, sup;

      |CIERRA #asw00030; |DELINDEX #asw00030;
      |CIERRA #asw00031; |DELINDEX #asw00031;
      |CIERRA #asm00006;
   |FINSI;
|FPRO;
