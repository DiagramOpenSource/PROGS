|FICHEROS;
     abxz0100 #0;

     abom0001  #1;
     abom0002  #2;
     abom0020  #20;

     abom0503  #503;
     abom0511  #511;
     abom0514  #514;
     abom0518  #518;
|FIN;

|VARIABLES;
     aUsuario         = "";
     aAlfa            = "";
     aBase            = "";
     aPath            = "";
     aRuta            = "";
     aLong            = "";
     aQueBoton        = "";
     aID              = "";
     aHora            = "";
     aExtension       = "";
     aOrigen          = "";
     aDestino         = "";
     aTo              = "";
     aBaseMensaje     = "";
     aAsunto          = "";
     aAbreTXT         = "";
     aIP              = "";
     aSalida          = "";
     aMensaje         = "";
     aAutenti         = "";

     nBotonAceptar    = -1;
     nVent            = 0;
     nUbica           = 0;
     nLong            = 0;
     nCarac           = 0;
     nPos             = 0;
     nLinea           = 0;
     nHandle          = 0;

     &eaUnidadBasico  = "";
     &eaRutaDocumento = "";
     &eaEmpAcceso     = "";
     &enCodUbica      = 0;
     &efFechaDocu     = @;
|FIN;

|PROCESO NotificacionProcurador;
     |ABRE #518;
     #518#0 = #514#44;
     |LEE 000#518=;
     |SI FSalida ! 0;
         |CIERRA #518;
         |ACABA;
     |FINSI;
     |CIERRA #518;

     aTo = #503#19;  |QBF aTo;
     |SI aTo = "";  |ACABA;  |FINSI;

     |DBASE aBaseMensaje;  |QBF aBase;
     aBaseMensaje = aBaseMensaje + "dscorreo/";

     aAsunto  = "Entrada de documento en el expediente: " + #0#0;

     aAbreTXT = aBaseMensaje + "adjunto.txt";
     |XABRE "WB", aAbreTXT, nHandle;

     aAlfa = "Se ha incluido un documento nuevo por parte de usted en la gestión documental del expediente " + #0#0 + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa =  "Para cualquier aclaración o duda no dude en ponerse en contacto con nosotros." + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;

     aAlfa = ("_" * 134) + &13 + &10;   |XGRABA nHandle, aAlfa;

     aAlfa =  "Este correo electrónico y, en su caso, cualquier fichero anexo al mismo, contiene";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "información de carácter confidencial exclusivamente dirigida a su destinatario o";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "destinatarios. Queda prohibida su divulgación, copia o distribución a terceros sin la";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "previa autorización escrita de la empresa. En el caso de haber recibido este correo";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "electrónico por error, se ruega  notifíquese inmediatamente esta circunstancia mediante";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "reenvío a la dirección electrónica del remitente y proceda a su destrucción.";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;

     aAlfa = "El consumo de papel es perjudicial para el medio ambiente. Por favor téngalo en cuenta";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "antes de imprimir este mensaje.";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = ("_" * 134) + &13 + &10;   |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;

     |XCIERRA nHandle;

     aIP      = #518#2;           |QBF aIP;         || Direccion IP
     aSalida  = #518#4;           |QBF aSalida;     || servidor proxy

     aMensaje = "$$$$" + aAbreTXT;

     aAutenti = #518#5;

     |SI #514#20 = "S";
         aAutenti = "!" + aAutenti;
     |FINSI;

     |DSCORREO_ENVIA aIP, aSalida, aAutenti, aTo, aAsunto, aMensaje, aAbreTXT;

     |FBORRA aAbreTXT;
|FPRC;

|PROCESO abom0511;
     aTo = #511#2;  |QBF aTo;
     |SI aTo = "";  |ACABA;  |FINSI;

     |DBASE aBaseMensaje;  |QBF aBase;
     aBaseMensaje = aBaseMensaje + "dscorreo/";

     aAsunto  = "Entrada de documento PROCURADOR en el expediente: " + #0#0;

     aAbreTXT = aBaseMensaje + "adjunto.txt";
     |XABRE "WB", aAbreTXT, nHandle;

     aAlfa = "Se ha incluido un documento nuevo por parte del procurador " + #503#1;  |QBF aAlfa;
     aAlfa = aAlfa + " en la gestión documental del expediente " + #0#0 + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;

     aAlfa = ("_" * 134) + &13 + &10;   |XGRABA nHandle, aAlfa;

     aAlfa =  "Este correo electrónico y, en su caso, cualquier fichero anexo al mismo, contiene";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "información de carácter confidencial exclusivamente dirigida a su destinatario o";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "destinatarios. Queda prohibida su divulgación, copia o distribución a terceros sin la";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa =  "previa autorización escrita de la empresa. En el caso de haber recibido este correo";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "electrónico por error, se ruega  notifíquese inmediatamente esta circunstancia mediante";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "reenvío a la dirección electrónica del remitente y proceda a su destrucción.";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;
     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;

     aAlfa = "El consumo de papel es perjudicial para el medio ambiente. Por favor téngalo en cuenta";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = "antes de imprimir este mensaje.";
     aAlfa = aAlfa + &10;  |XGRABA nHandle, aAlfa;

     aAlfa = ("_" * 134) + &13 + &10;   |XGRABA nHandle, aAlfa;

     aAlfa = &13 + &10;    |XGRABA nHandle, aAlfa;

     |XCIERRA nHandle;

     aIP      = #518#2;           |QBF aIP;         || Direccion IP
     aSalida  = #518#4;           |QBF aSalida;     || servidor proxy

     aMensaje = "$$$$" + aAbreTXT;

     aAutenti = #518#5;

     |SI #514#20 = "S";
         aAutenti = "!" + aAutenti;
     |FINSI;

     |DSCORREO_ENVIA aIP, aSalida, aAutenti, aTo, aAsunto, aMensaje, aAbreTXT;

     |FBORRA aAbreTXT;
|FPRC;

|DEFBUCLE abom0511;
     #511#1;
     ;
     #1#28, "          ";
     #1#28, "zzzzzzzzzz";
     ;
     NULL, abom0511;
|FIN;

|PROCESO NotificacionTramitador;
     |ABRE #518;
     #518#0 = #514#44;
     |LEE 000#518=;
     |SI FSalida ! 0;
         |CIERRA #518;
         |ACABA;
     |FINSI;
     |CIERRA #518;

     |BUCLE abom0511;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
     |SI FSalida = 7;  |ACABA;  |FINSI;

     aAlfa = #0#1;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000Por favor introduzca una descripci¢n para le documento.";
         |ERROR;
         |ACABA;
     |FINSI;

     |HORA aHora;

     #2#0 = #0#0;
     #2#1 = 99999;
     |LEE 000#2];
     |SI FSalida = 0;
         |LEE 000#2a;
     |SINO;
         |LEE 000#2u;
     |FINSI;

     nLinea = 2;
     |SI FSalida = 0;  |Y #2#0 = #0#0;
         nLinea = #2#1 + 1;
     |FINSI;

     |DDEFECTO #2;
     #2#0 = #0#0;
     #2#1 = nLinea;
     #2#2 = #0#1;
     |GRABA 020#2b;

     aAlfa = "w";
     |SI aExtension ! "doc";
         |SI aExtension = "xls";  aAlfa = "e";  |FINSI;
         |SI aExtension = "tif";  aAlfa = "g";  |FINSI;
         |SI aExtension = "pdf";  aAlfa = "g";  |FINSI;
     |FINSI;

     |SI #2#1 [ 999;
         #2#3 = aAlfa + (("00000000" + #2#0) % -108) + (("000" + #2#1) % -103) + "." + aExtension;
     |SINO;
         #2#3 = aAlfa + (("00000000" + #2#0) % -108) + (("00000" + #2#1) % -105) + "." + aExtension;
     |FINSI;

     #2#4  = ~;
     #2#7  = ~;
     aAlfa = aHora % 102;  #2#5 = aAlfa;  #2#8 = aAlfa;
     aAlfa = aHora % 402;  #2#6 = aAlfa;  #2#9 = aAlfa;
     #2#10 = nUbica;

     efFechaDocu = #2#4;
     enCodUbica  = nUbica;  |HAZ LeeUbicaciones;
     aOrigen     = aRuta;
     aDestino    = eaRutaDocumento + "/" + #2#3;   |QBF aDestino;

     |SI #514#21 ! "C";
         |RCOPIA_FICHERO aOrigen, aDestino;
     |SINO;
         |RECIBE_FICHERO aOrigen, aDestino;
     |FINSI;

     |SI FSalida < 0;
         |MENAV "0000 Problemas al copiar fichero en la ubicaci¢n destino. Int‚ntelo de nuevo";

         |BORRA 020#2a;
         |LIBERA #2;

         |ERROR;
         |ACABA;
     |FINSI;

     |GRABA 020#2a;
     |LIBERA #2;

     |ABRE #20;
     #20#0 = #1#28;
     #20#1 = ~;
     #20#2 = aHora;
     #20#3 = #2#0;
     #20#4 = #1#29;
     #20#5 = #2#1;
     #20#6 = "DOCUMENTO PROCURADOR: " + #503#1;
     #20#7 = "N";
     |GRABA 020#20n;
     |LIBERA #20;
     |CIERRA #20;

     |HAZ NotificacionProcurador;
     |HAZ NotificacionTramitador;
|FPRC;

|PROCESO Baja1;
     #1#18 = #503#0;
     #1#2  = "01.01.0000";
     #1#0  = 1;
|FPRC;

|PROCESO Alta1;
     #1#18 = #503#0;
     #1#2  = "01.01.0000";
     #1#0  = 99999999;
|FPRC;

|PROCESO BotonValida;
     |PTEC 806;
|FPRC;

|PROCESO Tipo7;  |TIPO 7;
     |SI nBotonAceptar ! -1;  |ACABA;  |FINSI;

     aQueBoton     = "|X000";
     aID           = #0#aQueBoton#;
     nBotonAceptar = aID;
     |ESTADO_CONTROL nBotonAceptar, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,{{206}}Finalizar", 2770, 2783, BotonValida;
|FPRC;

|PROCESO Tipo66;  |TIPO 66;
     |ABRE #1;
     |CONSULTA_F_CLAVE #9#1, Baja1, Alta1;
     |SI FSalida = 0;
         #0#0 = #1#0;
         |PINTA #0#0;
     |FINSI;
     |CIERRA #1;
|FPRC;

|PROCESO Tipo0;  |TIPO 0;
     |ABRE #1;
     |SELECT #1#1
     #1#0 = #0#0;
     |LEE 000#1=;
     |SI FSalida ! 0;
         |CIERRA #1;
         |MENAV "0000El expediente no existe. Pulse F11 o la flechita para ver la lista de sus expedientes.";
         |ERROR;
         |ACABA;
     |FINSI;
     |CIERRA #1;

     |SI #1#18 ! #503#0;
         |MENAV "0000El expediente no lo tiene usted asignado. Pulse F11 o la flechita para ver la lista de sus expedientes.";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #1#2 ! "01.01.0000";
         |MENAV "0000El expediente est  cerrado. Pulse F11 o la flechita para ver la lista de sus expedientes.";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROGRAMA;
     aUsuario = Usuario % 810;
     aAlfa    = aUsuario % 102;
     |SI aAlfa ! "PR";
         |MENAV "0000Este usuario no tiene permiso para entrar en esta opci¢n. ";
         |ACABA;
     |FINSI;

     |HAZ LeeUnidadBasico;

     eaEmpAcceso = aUsuario % 302;
     |DBASE aBase;
     aPath = aBase + "fich/" + eaEmpAcceso + "/";

     |PATH_DAT #503 aPath;
     |PATH_DAT #1   aPath;
     |PATH_DAT #2   aPath;
     |PATH_DAT #20  aPath;
     |PATH_DAT #511 aPath;

     |ABRE #514;
     |LEE 000#514p;
     |SI FSalida ! 0;  |DDEFECTO #514;   |FINSI;
     |CIERRA #514;

     |VENTANA 0501, 2799, -1, 16, "Entrada de documentos a expedientes";
     nVent = FSalida;

     |MENAV "0000A continuaci¢n adjunte el documento a tratar.";

     aRuta = eaUnidadBasico + "\*.*";
     aRuta = "F" + aRuta;
     |BROWSE aRuta;

     aAlfa = aRuta;
     aRuta = "";
     aLong = aAlfa % 0;
     nLong = aLong;
     |PARA nCarac = 2;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos = (nCarac * 100) + 1;
           aRuta = aRuta + (aAlfa % nPos);
     |SIGUE;

     aExtension = (aRuta % -103) < "";
     nUbica     = 0;

     |SI aExtension = "doc";  nUbica = #514#34;  |FINSI;
     |SI aExtension = "xls";  nUbica = #514#35;  |FINSI;
     |SI aExtension = "tif";  nUbica = #514#36;  |FINSI;
     |SI aExtension = "jpg";  nUbica = #514#37;  |FINSI;
     |SI aExtension = "bmp";  nUbica = #514#38;  |FINSI;
     |SI aExtension = "txt";  nUbica = #514#39;  |FINSI;
     |SI aExtension = "rtf";  nUbica = #514#40;  |FINSI;
     |SI aExtension = "eml";  nUbica = #514#41;  |FINSI;
     |SI aExtension = "pdf";  nUbica = #514#42;  |FINSI;

     |SI nUbica = 0;
         |MENAV "0000Tipo de documento no soportado.";
         |FINVENTANA nVent;
         |ACABA;
     |FINSI;

     aAlfa = aUsuario % 506;
     |ABRE #503;
     #503#0 = aAlfa;
     |LEE 000#503=;
     |CIERRA #503;

     aAlfa = "LABEL,{{15}}Procurador: " + #503#1;  |QBF aAlfa;
     |CONTROL_SIMPLE 0, aAlfa, 1102, 1198, NULL;

     aAlfa = "LABEL,{{15}}Documento: " + aRuta;  |QBF aAlfa;
     |CONTROL_SIMPLE 0, aAlfa, 1302, 1498, NULL;

     |ABRE #2;

     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;

     |CIERRA #2;

     |FINVENTANA nVent;
|FPRO;
