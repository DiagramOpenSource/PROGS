|FICHEROS;
     :/integral/def/dsam0117 #117;
     :/integral/def/dsam0116 #116;
|FIN;

|VARIABLES;
     nInkey      = 0;
     aAlfa       = "";
     aAlfa1      = "";
     aMas        = "";
     aID         = "";
     aChar       = "";
     aCadena     = "";

     nID         = 0;
     nFSalida    = 0;
     nBanco      = 0;
     nCalc       = 0;

     &eaEntidad  = "";
     &eaSucursal = "";
     &eaCuenta   = "";
     &eaDC       = "";
     &eaCta      = "";
     &eaPais     = "";
     &eaIBAN     = "";
|FIN;

|PROCESO Tipo8Fm117; |TIPO 80;
     |ABRE #dsam0117;
     |SELECT #3#dsam0117;
     |LEE 000#dsam0117.u;
     |SI FSalida ! 0;  |DDEFECTO #dsam0117;  |FINSI;
     |CIERRA #dsam0117;

     aAlfa = #dsam0117#13;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000Se va a proceder a calcular el codigo IBAN en el fichero de Bancos Propios";

         |SUB_EJECUTA_NP ":basica/dspase33;dsam0117";
     |FINSI;
|FPRC;

|PROCESO ConsEntidadm117;  |TIPO 66;
     |PUSHV 0501 2380;
     |ABRE #116;
     |SELECT #2#116;
     #116#1 = "";
      #116#2 = #117#7;
     |LEE 040#116];
     |SI FSalida ! 0;
         |LEE 040#116p;
     |FINSI;
     |CONSULTA_CLAVE #2#116;
     |CIERRA #116;
     |POPV;

     #117#1 = #116#1;   |PINTA #117#1;
     #117#2 = #116#6;   |PINTA #117#2;
     #117#7 = #116#2;   |PINTA #117#7;
     #117#8 = #116#3;   |PINTA #117#8;
     #117#9 = #116#4;   |PINTA #117#9;
|FPRC;

|PROCESO ConsOficinam117;  |TIPO 66;
     |PUSHV 0501 2380;
     |ABRE #116;
     |SELECT #3#116;
     #116#2 = #117#7;
     #116#3 = #117#8;
     #116#4 = #117#9;
     |LEE 040#116];
     |SI FSalida ! 0;
         |LEE 040#116p;
     |FINSI;
     |CONSULTA_CLAVE #3#116;
     |CIERRA #116;
     |POPV;

     #117#1 = #116#1;   |PINTA #117#1;
     #117#2 = #116#6;   |PINTA #117#2;
     #117#7 = #116#2;   |PINTA #117#7;
     #117#8 = #116#3;   |PINTA #117#8;
     #117#9 = #116#4;   |PINTA #117#9;
|FPRC;

|PROCESO DCm117;
     eaEntidad  = #117#7; |QBF eaEntidad;
     eaSucursal = #117#8; |QBF eaSucursal;
     eaCuenta   = #117#10; |QBF eaCuenta;
     eaDC       = "";

     |SI eaEntidad = "";  |Y eaSucursal = "";  |Y eaCuenta = "";
         |ACABA;
     |FINSI;

     |HAZ CalculoDC;

     |SI FSalida ! 10;
         |SI #117#9 ! eaDC;
             aAlfa = "     El Digito de Control deberia ser " + eaDC;
             |MENAV aAlfa;
         |FINSI;
         |ACABA;
     |FINSI;

     #117#9 = eaDC;
     |PINTA #117#9;
|FPRC;

|PROCESO Tipo7IBAN_Fm117;  |TIPO 7;
     aAlfa = #117#13;   |QBF aAlfa;

     |SI aAlfa ! "";  |ACABA;  |FINSI;

     eaCta  = #117#7 + #117#8 + #117#9 + #117#10;
     eaPais = #117#14;
     |HAZ CalcuIBAN;

     #117#13 = eaIBAN;
     |PINTA #117#13;
|FPRC;

|PROCESO Tipo0IBAN_Fm117;  |TIPO 0;
     eaCta  = #117#7 + #117#8 + #117#9 + #117#10;
     eaPais = #117#14;
     |HAZ CheqIBAN;

     aAlfa = #117#13;    |QBF aAlfa;
     |SI aAlfa ! eaIBAN;
         |CONFI "0000SEl codigo IBAN puede ser erroneo, quiere calcularlo.";
         |SI FSalida = 0;
             #117#13 = eaIBAN;
             |PINTA #117#13;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo12Fm117;  |TIPO 12;
     eaCta  = #117#7 + #117#8 + #117#9 + #117#10;
     eaPais = #117#14;
     |HAZ CheqIBAN;

     aAlfa = #117#13;    |QBF aAlfa;
     |SI aAlfa ! eaIBAN;
         |MENAV "0000El codigo IBAN puede ser erroneo.";
     |FINSI;
|FPRC;
