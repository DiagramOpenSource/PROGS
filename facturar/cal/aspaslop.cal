          **** PASE DEL HISTORICO DE RECIBOS AL SECUENCIAL ****
|FICHEROS;
  aspaslop #0;
  ashisrec #1;
  asclient #2;
  indrecib #3;
  asempres #4;
  asbansec #5;
  ashisfac #6;

  ascabmin #7;
  aslinmin #8;
  asempcon #9;
  asenlcon #10;
  ascontro #11;
  ascontrt #450;
  asconcep #12;
  ascabrem #13;
  aslinrem #14;
  asw00001 #99;
|FIN;

|VARIABLES;
cabe1   = "0380";
indi1   = "0680";
conc1_1 = "0681";
conc1_2 = "0682";
conc1_3 = "0683";
conc1_4 = "0684";
conc1_5 = "0685";
tsuc1   = "0780";
tgen1   = "0880";

cabe2   = "";
cabe3   = "      ";
cabe5   = "";
cabe6   = "          ";
cabe7   = "03";
cabe8   = "                                          ";

indi2   = "";
indi3   = "";
indi4   = "";
indi5   = "";
indi6   = "";
indi7   = "";
indi8   = "";
indi9   = "                       .";

conc1   = "";
conc2   = "";
conc3 = "                                        ";
conc4 = "                                        ";
conc5 = "                                        ";

tsuc2   = "                                                    ";
tsuc3   = "";
tsuc4   = ""
tsuc5   = ""
tsuc6   = "      ";
tsuc7   = "";
tsuc8   = "                                                     .";

tgen2   = "                                                            ";
tgen3   = "";
tgen4   = "";
tgen5   = "      ";
tgen6   = "";
tgen7   = "                                                     .";
handle = "";
varalfa1 = "";
varalfa2 = "";
facalfa = "";
contenido = "";
longalf = "";
fiche = "";
espacio = " ";
dd = "";
mm = "";
aa = "";
fechalf = "";
impalf = "";
vacio = "          ";
banco = "";
ccc = "";
recibo = 0;
impsuc = 0;
regsuc = 0;
numsuc = 0;
trecibo = 0;
timpsuc = 0;
tnumsuc = 0;
serie = "";
factu = 0;
cont = 0;
contreg = 0;
empresa = "";
linea_c = "Procesando Factura: Serie:    Factura:";
linea   = 0;
final = "                   ."
l = 0;
valo = 0;
abc = 0;
cba = "";
cuarenta = "";
alfa1 = "";
alfa2 = "";
alfa3 = "";

sw_existe = 0;
varalf    = "";
iva       = 0;
c_clie    = "";
fijo      = "";
conver    = "";
conver1   = "";
conver2   = "";
sino      = "";
     fFech = @;
     qFech = "";
     dFech = "";
     hFech = "";

     &eaMoneda  = "";
     &enCanti   = 0;
     &enSwTrata = 0;
     aFichero   = "";
     &efFechaL    = @;
     &enImporte   = 0;
     &enDesRemesa = 0;
     &efFechaO    = @;
|FIN;

|INCLUYE agicon_i;

|PROCESO MiraVarMoneda;  |TIPO 7;
     |HAZ PintaMoneda;
     #0#20 = eaMoneda;

     |PINTA #0#20;
|FPRC;

|PROCESO sacaano; |TIPO 7;
     fFech = ~;
     qFech = fFech % -104;
     dFech = "01.01." + qFech;
     hFech = "31.12." + qFech;
     #0#4  = dFech;
     #0#5  = hFech;
     |PINTA #0#4;
     |PINTA #0#5;
|FPRC;

|PROCESO que_selec;
|SI #0#14 = "N";
    |CAMPO_MODIFICA #0#0,  1, "S"; |PINTA #0#0;
    |CAMPO_MODIFICA #0#1,  1, "S"; |PINTA #0#1;
    |CAMPO_MODIFICA #0#2,  1, "S"; |PINTA #0#2;
    |CAMPO_MODIFICA #0#3,  1, "S"; |PINTA #0#3;
    |CAMPO_MODIFICA #0#4,  1, "S"; |PINTA #0#4;
    |CAMPO_MODIFICA #0#5,  1, "S"; |PINTA #0#5;
    |CAMPO_MODIFICA #0#6,  1, "S"; |PINTA #0#6;
    |CAMPO_MODIFICA #0#7,  1, "S"; |PINTA #0#7;
    |CAMPO_MODIFICA #0#15, 1, "N"; |PINTA #0#15;
|SINO;
    |CAMPO_MODIFICA #0#0,  1, "N"; |PINTA #0#0;
    |CAMPO_MODIFICA #0#1,  1, "N"; |PINTA #0#1;
    |CAMPO_MODIFICA #0#2,  1, "N"; |PINTA #0#2;
    |CAMPO_MODIFICA #0#3,  1, "N"; |PINTA #0#3;
    |CAMPO_MODIFICA #0#4,  1, "N"; |PINTA #0#4;
    |CAMPO_MODIFICA #0#5,  1, "N"; |PINTA #0#5;
    |CAMPO_MODIFICA #0#6,  1, "N"; |PINTA #0#6;
    |CAMPO_MODIFICA #0#7,  1, "N"; |PINTA #0#7;
    |CAMPO_MODIFICA #0#15, 1, "S"; |PINTA #0#15;
|FINSI;
|FPRC;

|PROCESO hay_remesa; |TIPO 0;
   |SI #0#15 = 0; |ACABA; |FINSI;

   |ABRE #13;
   #13#0 = #0#15;
   |LEE 040#13=;
   |SI FSalida ! 0;
       |MENAV "      No existe Remesa";
       |ERROR;
   |SINO;
       |SI #13#5 = "X";
           |CONFI "0000NEsta Remesa ya ha sido pasada por el Banco. Volver a realizar el Proceso";
           |SI FSalida ! 0;
               |ERROR;
           |FINSI;
       |FINSI;
   |FINSI;
   |CIERRA #13;
|FPRC;

|PROCESO secuen_01;
  #2#0 = #1#3;              ||** Lee fichero de clientes;
  |LEE 040#2=;              ||** Ordena por Banco/Sucursal;
  |SI FSalida = 0;
      #3#0 = #1#0;  ||** Serie;
      #3#1 = #1#1;  ||** Factura;
      #3#2 = #2#2;  ||** Nom. Cliente;
      #3#3 = #2#8;  ||** Cif/Dni;
      #3#4 = #2#16; ||** Banco;
      #3#5 = #2#13; ||** C.C.C;
      #3#6 = #2#14; ||** Cta.Cte;
      #3#7 = #1#9;  ||** Importe Recibo;

      enImporte = #1#9;
      |SI #1#9 [ 0; |ACABA; |FINSI;
      #1#15 = enImporte;

     #3#8 = #1#5;  ||** Fecha Vencimiento;
     |SI #0#11 = "N";
         abc = 100000 + #2#0;
         cba = abc;
         #3#3 = #5#2 + cba;
     |FINSI;
     |GRABA 040#3n;||** Graba el fichero indexado;

     enDesRemesa = 0;
     efFechaL = #0#8;
     |HAZ eGraba_Min;
  |SINO;
     |AVISO;
     |PINTA 0418,"ATENCION Cliente Inexistente! CODIGO.:"
     |PINTA 0457,#1#3;
     |PAUSA;
  |FINSI;
|FPRC;

|DEFBUCLE ashisrec;
 #1#1;
 2,7;
 #0#0,#0#2,#0#4,#0#6;
 #0#1,#0#3,#0#5,#0#7;
 be;
 NULL,secuen_01;
|FIN;

|PROCESO secuen_02;
#1#0 = #14#2;
#1#1 = #14#3;
|LIBERA #1;
|LEE 140#1=;
|SI FSalida ! 0; |ACABA; |FINSI;

#2#0 = #1#3;              ||** Lee fichero de clientes;
|LEE 040#2=;              ||** Ordena por Banco/Sucursal;
|SI FSalida ! 0; |ACABA; |FINSI;

#3#0 = #1#0;  ||** Serie;
#3#1 = #1#1;  ||** Factura;
#3#2 = #2#2;  ||** Nom. Cliente;
#3#3 = #2#8;  ||** Cif/Dni;
#3#4 = #2#16; ||** Banco;
#3#5 = #2#13; ||** C.C.C;
#3#6 = #2#14; ||** Cta.Cte;
#3#7 = #14#7;  ||** Importe Recibo;
#3#8 = #1#5;  ||** Fecha Vencimiento;
|SI #0#11 = "N";
    abc = 100000 + #2#0;
    cba = abc;
    #3#3 = #5#2 + cba;
|FINSI;
|GRABA 040#3n;||** Graba el fichero indexado;
enDesRemesa = 1;
efFechaO = #13#6;
efFechaL = #0#8;
|HAZ eGraba_Min;
|FPRC;

|DEFBUCLE aslinrem;
#14#1;
;
#0#15, 000;
#0#15, 999;
;
NULL,secuen_02;
|FIN;

|PROCESO pase;|TIPO 3;
  eaMoneda = #0#20;

  |SI #0#20 = "PESETAS";
      cabe1   = "0380";
      indi1   = "0680";
      conc1_1 = "0681";
      conc1_2 = "0682";
      conc1_3 = "0683";
      conc1_4 = "0684";
      conc1_5 = "0685";
      tsuc1   = "0780";
      tgen1   = "0880";
  |SINO;
      cabe1   = "5380";
      indi1   = "5680";
      conc1_1 = "5681";
      conc1_2 = "5682";
      conc1_3 = "5683";
      conc1_4 = "5684";
      conc1_5 = "5685";
      tsuc1   = "5780";
      tgen1   = "5880";
  |FINSI;

  aFichero = ("21x" + Usuario) % 108;
  |NOME_DAT #3 aFichero;
  |ABRE #3; |CIERRA #3; |DELINDEX #3;

  |ABRE #2;
  |ABRE #3;

  |SI #0#14 = "N";
      |BUCLE ashisrec;
  |SINO;
      |ABRE #1;
      |BUCLE aslinrem;
      |CIERRA #1;
  |FINSI;

  |CIERRA #2;
  cuarenta = " " * 40;    || para rellenar

  |ABRE #5;
  #5#0 = #0#9;
  |LEE 040#5=;
  |DFICE empresa;
  fiche = "wt  " + empresa + "assecrec.seq";
  |QBF fiche;
  |FABRE fiche;
  handle = FSalida;
  |SI FSalida ] 0;
      |HAZ cabecera_p;
      |HAZ regindiv;
      |HAZ campo_sucursal;
      |HAZ campo_totales;
  |FINSI;
  FSalida = handle;
  |FCIERRA FSalida;

  |CIERRA #3; |DELINDEX #3;
  |CIERRA #5;

   |SI #0#14 = "S";
       |ABRE #13;
       #13#0 = #0#16;
       |LEE 141#13=;
       |SI FSalida = 0;
           #13#5 = "X";
           #13#6 = efFechaL;
           |GRABA 020#13a;
       |FINSI;
       |LIBERA #13;
       |CIERRA #13;
   |FINSI;

   E_sup = 1;
   E_inf = "SNsn";
   sino  = "S";
   sino  = 1769 ? 1;
   sino  = sino > " ";
   |SI sino = "S"; |SUB_EJECUTA_NP "ascopdis"; |FINSI;

|FPRC;

||***********************************************************;
||******************* REGISTRO DE CABECERA ******************;
||***********************************************************;
|PROCESO cabecera_p;
  fechalf = #0#8;
  dd = fechalf % A102;
  mm = fechalf % A402;
  aa = fechalf % A902;
  cabe2 = dd + mm + aa;             ||** Fecha por pantalla;
  cabe8 = cabe8 + final;            ||** 40 espacios en blanco+final;
  cabe5 = #5#4 + #5#5 + #5#6 + #5#7 + #5#8;
  varalfa1 = cabe1 + #5#2 + cabe2 + cabe3 + #5#3 + cabe5 + cabe6 + cabe7 + cabe8;
  contenido = handle + espacio + varalfa1;
  |FGRABA contenido;
  l = l + 1;
|FPRC;

||***********************************************************;
||******************* REGISTRO INDIVIDUAL *******************;
||***********************************************************;
|PROCESO regindiv;
  |SELECT #2#3;
  |LEE 040#3p;
  |SI FSalida ! 0;   |ACABA;  |FINSI;
  banco = #3#4;
  ccc = #3#5;
|ET compara;
  |SI #3#4 ! banco;|O ccc ! #3#5;
      |HAZ campo_sucursal;
      banco  = #3#4;
      ccc    = #3#5;
      recibo = 0;
      impsuc = 0;
      regsuc = 0;
  |FINSI;
  |HAZ campo_indiv;
  recibo = recibo + 1;

  enSwTrata = 1;
  enCanti   = #3#7;
  |HAZ ConverMoneda;
  impsuc = impsuc + enCanti;

  regsuc = regsuc + 1;
  trecibo = trecibo + 1;
  timpsuc = timpsuc + enCanti;

  |SI #5#10 = "S"; |HAZ conceptos; |FINSI;
  |LEE 040#3s;
  |SI FSalida = 0;
      |VETE compara;
  |FINSI;
|FPRC;

||***********************************************************;
||******************* REGISTRO CONCEPTOS ********************;
||***********************************************************;

|PROCESO lee_factura;
|ABRE #6;
    #6#0 = #3#0;
    #6#1 = #3#1;
|LEE 001#6=;
|SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;
|CIERRA #6;
|FPRC;

|PROCESO lee_cliente;
|ABRE #2;
    #2#0 = #6#3;
|LEE 001#2=;
|SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
|CIERRA #2;
|FPRC;

|PROCESO relleno;
  conc3 = conc3 + cuarenta;  conc3 = conc3 % 140;
  conc4 = conc4 + cuarenta;  conc4 = conc4 % 140;
  conc5 = conc5 + cuarenta;  conc5 = conc5 % 140;
|FPRC;

|PROCESO conceptos;
|HAZ lee_factura;
|HAZ lee_cliente;
  cont = 0; ||** Contador de campos maximo 3;
  contreg = 0; ||** Contador de registros maximo 5;
      alfa1 = #6#1; alfa1 = "00000" + alfa1;  alfa1 = alfa1 % -105;
  conc3 = "Factura: "+#6#0+"/"+alfa1+" Fecha ..: "+#6#2;    || campo 2
  conc4 = #4#2;                                             || campo 3
      alfa1 = #6#05; alfa1 = "         " + alfa1;  alfa1 = alfa1 % -109;
      alfa2 = #6#17; alfa2 = "         " + alfa2;  alfa2 = alfa2 % -109;
  conc5 = "HONOR. .: "+alfa1+" B.IMPON. :"+alfa2;            || campo 4
  |HAZ relleno;
  varalfa1 = conc1_1 + #5#2 + #3#3 + conc3 + conc4 + conc5 + final;
  contenido = handle + espacio + varalfa1;
  |FGRABA contenido;
  l = l + 1;
  regsuc = regsuc + 1;

      alfa1 = #4#4;  alfa1 = "00"  + alfa1;  alfa1 = alfa1 % -102;
      alfa2 = #4#5;  alfa2 = "000" + alfa2;  alfa2 = alfa2 % -103;
  conc3 = "("+alfa1+alfa2+") "+#4#3;                        || campo 5
      alfa1 = #6#06; alfa1 = "         " + alfa1;  alfa1 = alfa1 % -109;
      alfa2 = #6#07; alfa2 = "     "     + alfa2;  alfa2 = alfa2 % -105;
      alfa3 = #6#08; alfa3 = "         " + alfa3;  alfa3 = alfa3 % -109;
  conc4 = "SUPLIDOS: "+alfa1+" "+alfa2+"%IVA:"+alfa3;       || campo 6
  conc5 = " C.I.F. ..: "+#4#7;                              || campo 7
  |HAZ relleno;
  varalfa1 = conc1_2 + #5#2 + #3#3 + conc3 + conc4 + conc5 + final;
  contenido = handle + espacio + varalfa1;
  |FGRABA contenido;
  l = l + 1;
  regsuc = regsuc + 1;

  conc3 = "                     ===================";  || campo 8
  conc4 = "                                        ";  || campo 9
      alfa1 = #6#18; alfa1 = "         " + alfa1;  alfa1 = alfa1 % -109;
  conc5 = "                     TOTAL : "+alfa1;       || campo 10
  |HAZ relleno;
  varalfa1 = conc1_3 + #5#2 + #3#3 + conc3 + conc4 + conc5 + final;
  contenido = handle + espacio + varalfa1;
  |FGRABA contenido;
  l = l + 1;
  regsuc = regsuc + 1;

  conc3 = "                                        ";  || campo 11
  conc4 = #2#2;                                        || campo 12
  conc5 = "                                        ";  || campo 13
  |HAZ relleno;
  varalfa1 = conc1_4 + #5#2 + #3#3 + conc3 + conc4 + conc5 + final;
  contenido = handle + espacio + varalfa1;
  |FGRABA contenido;
  l = l + 1;
  regsuc = regsuc + 1;

  conc3 = #2#3;                                        || campo 14
  conc4 = "                                        ";  || campo 15
      alfa1 = #2#4;  alfa1 = "00"  + alfa1;  alfa1 = alfa1 % -102;
      alfa2 = #2#5;  alfa2 = "000" + alfa2;  alfa2 = alfa2 % -103;
  conc5 = "("+alfa1+alfa2+") "+#2#6+cuarenta;  conc5 = conc5 % 124;
  conc5 = conc5 + "CIF:"+#2#8;
  |HAZ relleno;
  varalfa1 = conc1_5 + #5#2 + #3#3 + conc3 + conc4 + conc5 + final;
  contenido = handle + espacio + varalfa1;
  |FGRABA contenido;
  l = l + 1;
  regsuc = regsuc + 1;
|FPRC;

            ||Calculo registros individuales;
|PROCESO campo_indiv;
  indi4 = #3#5 % 108;               ||** 8 primeras cifras del ccc;
  indi4 = indi4 + vacio;
  indi4 = indi4 % 108;

  indi5 = #3#6 % 110;               ||** 10 primeros de la cta.cte;
  indi5 = indi5 + vacio;
  indi5 = indi5 % 110;

  enCanti   = #3#7;
  enSwTrata = 0;
  |HAZ ConverMoneda;

  |SI #0#20 = "EUROS  ";
      indi6 = ("000000000000" + enCanti) % -112;
  |SINO;
      indi6 = (("0000000000" + enCanti) % -110) + "00";
  |FINSI;

  fechalf = #3#8;                   ||** Fecha de emision;
  dd = fechalf % A102;
  mm = fechalf % A402;
  aa = fechalf % A902;
  indi7 = dd + mm + aa;
  facalfa = #3#1;
  indi8 = #4#1;
  |QBF indi8;
  indi8 = indi8 + "                                                         ";
  indi8 = indi8 % A140;
  varalfa1 = indi1 + #5#2 + #3#3 + #3#2 + indi4 + indi5 + indi6 + indi7 + indi8 + indi9;
  contenido = handle + espacio + varalfa1;
  |FGRABA contenido;
  l = l + 1;
|FPRC;

||***********************************************************;
||******************* REGISTRO SUCURSAL *********************;
||***********************************************************;
|PROCESO campo_sucursal;
  tsuc3 = ccc % 108;                ||** c.c.c del banco;

  tsuc4 = recibo;                   ||** Num. recibos sucursal;
  tsuc4 = "0000000000" + tsuc4;
  tsuc4 = tsuc4 % -110;

                                   ||** Importe del recibo sucursal;
  |SI #0#20 = "EUROS  ";
      impsuc = impsuc * 100;
      tsuc5  = ("000000000000" + impsuc) % -112;
  |SINO;
      tsuc5  = (("0000000000" + impsuc) % -110) + "00";
  |FINSI;

  regsuc = regsuc + 1;              ||** Numero de sucursales + 1;

  tsuc7 = regsuc;
  tsuc7 = "0000000000" + tsuc7;
  tsuc7 = tsuc7 % -110;

 varalfa1 = tsuc1 + #5#2 + tsuc2 + tsuc3 + tsuc4 + tsuc5 + tsuc6 + tsuc7 + tsuc8;
 contenido = handle + espacio + varalfa1;
 |FGRABA contenido;
 l = l + 1;
|FPRC;

||***********************************************************;
||******************* REGISTRO TOTAL GENERAL ****************;
||***********************************************************;
|PROCESO campo_totales;
  tgen3 = trecibo;                ||** Total num recibos;
  tgen3 = "0000000000" + tgen3;
  tgen3 = tgen3 % -110;

  |SI #0#20 = "EUROS  ";
      timpsuc = timpsuc * 100;
      tgen4   = ("000000000000" + timpsuc) % -112;
  |SINO;
      tgen4   = (("0000000000" + timpsuc) % -110) + "00";
  |FINSI;

  l = l + 1;
  tnumsuc = l;
  tgen6  = tnumsuc;               ||** Total reg. sucursales;
  tgen6  = "0000000000" + tgen6;
  tgen6  = tgen6 % -110;

  varalfa1 = tgen1 + #5#2 + tgen2 + tgen3 + tgen4 + tgen5 + tgen6 + tgen7;
  contenido = handle + espacio + varalfa1;
  |FGRABA contenido;

  #0#16 = trecibo;  |PINTA #0#16;
  #0#17 = tnumsuc;  |PINTA #0#17;
  #0#18 = timpsuc;
  |SI #0#20 = "EUROS  ";
      #0#18 = #0#18 / 100;
  |FINSI;
  |PINTA #0#18;
|FPRC;

/*
|PROCESO aslinmin;
|SI #8#4 = #9#4; |Y  #8#5 = #9#5;
    sw_existe = 1;
    |ERROR10;
|FINSI;
linea = #8#2;
|FPRC;

|PROCESO graba_min;
|ABRE #11;
|LEE 040#11p;
|SI FSalida ! 0; |CIERRA #11; |ACABA; |FINSI;
|CIERRA #11;

|ABRE #9;
|LEE 040#9p;
|SI FSalida ! 0; |CIERRA #9; |ACABA; |FINSI;
|CIERRA #9;

|SI #11#32 ! "S"; |ACABA; |FINSI;
|SI #2#24 = 0;    |ACABA; |FINSI;

varalf = (#0#8 % 102) + (#0#8 % 402);
linea  = 0;

|ABRE #7;
#7#0 = #1#4;
#7#1 = #1#3;
|LEE 040#7=;
|SI FSalida ! 0;
    |DDEFECTO #7;
    #7#0 = #1#4;
    #7#1 = #1#3;
    #7#2 = #2#1;
    #7#3 = #2#2;
    #7#4 = #2#3;
    #7#5 = #2#4;
    #7#6 = #2#5;
    #7#7 = #2#6;
    #7#8 = #2#7;
    #7#9 = #2#8;
    #7#10 = #2#15;
    #7#11 = #2#16;
    #7#12 = #2#17;
    #7#13 = #2#11;
    #7#14 = #2#12;
    #7#15 = #2#13;
    #7#16 = #2#14;
    #7#20 = #2#23;

    |ABRE #12;
    #12#0 = #11#33;
    #12#1 = #11#34;
    |LEE 040#12=;
    |SI FSalida = 0; |Y #12#3 = "A";
        linea = linea + 5;
        |ABRE #8;
        #8#0  = #7#0;
        #8#1  = #7#1;
        #8#2  = linea;
        #8#3  = 0;
        #8#4  = #12#0;
        #8#5  = #12#1;
        #8#6  = #12#2;
        #8#7  = #12#16;
        #8#8  = #12#17;
        #8#9  = #12#18;
        #8#10 = #12#3;
        #8#11 = 1;
        #8#12 = -#2#24;
        #8#13 = -#2#24;
        #8#14 = "G";
        #8#15 = "00.00.0000";
        |GRABA 040#8n;
        |CIERRA #8;
        |HAZ graba_con;

        #7#19 = #7#19 + #8#13;
        #7#26 = #7#24 - #7#19 - #7#25;
    |FINSI;

    #12#0 = #9#4;
    #12#1 = #9#5;
    |LEE 040#12=;
    |SI FSalida = 0;
        linea = linea + 5;
        |ABRE #8;
        #8#0  = #7#0;
        #8#1  = #7#1;
        #8#2  = linea;
        #8#3  = varalf;
        #8#4  = #12#0;
        #8#5  = #12#1;
        #8#6  = #12#2;
        #8#7  = #12#16;
        #8#8  = #12#17;
        #8#9  = #12#18;
        #8#10 = #12#3;
        #8#11 = 1;
        #8#12 = #1#9;
        #8#13 = #1#9;
        |SI #2#22 = 1; #8#14 = #12#5;  |FINSI;
        |SI #2#22 = 2; #8#14 = #12#9;  |FINSI;
        |SI #2#22 = 3; #8#14 = #12#11; |FINSI;
        |SI #2#22 = 4; #8#14 = #12#13; |FINSI;
        |SI #2#22 = 5; #8#14 = #12#15; |FINSI;
        #8#15 = #0#8;
        |GRABA 040#8n;
        |CIERRA #8;
        |HAZ graba_con;

        |HAZ iva;
        |SI #8#10 = "H"; #7#17 = #7#17 + #8#13; |FINSI;
        |SI #8#10 = "S"; #7#18 = #7#18 + #8#13; |FINSI;
        |SI #8#10 = "A"; #7#19 = #7#19 + #8#13; |FINSI;

        #7#21 = #7#17 % #7#20;
        #7#22 = #7#17 - #7#21;
        #7#23 = #7#22 % iva;
        #7#24 = #7#22 + #7#23 + #7#18;
        |SI #7#12 = "S";
            #7#25 = #7#22 % #11#31;
        |SINO;
            #7#25 = 0;
        |FINSI;
        #7#26 = #7#24 - #7#19 - #7#25;
    |FINSI;
    |CIERRA #12;
    |GRABA 040#7n;
|SINO;
    |ABRE #12;
    sw_existe = 0;
    |BUCLELIN 0aslinmin#7;
    #12#0 = #9#4;
    #12#1 = #9#5;
    |LEE 040#12=;
    |SI FSalida = 0;
        linea = linea + 5;
        |ABRE #8;
         #8#0  = #7#0;
         #8#1  = #7#1;
         #8#2  = linea;
         #8#3  = varalf;
         #8#4  = #12#0;
         #8#5  = #12#1;
         #8#6  = #12#2;
         #8#7  = #12#16;
         #8#8  = #12#17;
         #8#9  = #12#18;
         #8#10 = #12#3;
         #8#11 = 1;
         #8#12 = #1#9;
         #8#13 = #1#9;
         |SI #2#22 = 1; #8#14 = #12#5;  |FINSI;
         |SI #2#22 = 2; #8#14 = #12#9;  |FINSI;
         |SI #2#22 = 3; #8#14 = #12#11; |FINSI;
         |SI #2#22 = 4; #8#14 = #12#13; |FINSI;
         |SI #2#22 = 5; #8#14 = #12#15; |FINSI;
         #8#15 = #0#8;
         |GRABA 040#8n;
         |CIERRA #8;
         |HAZ graba_con;

         |HAZ iva;
         |SI #8#10 = "H"; #7#17 = #7#17 + #8#13; |FINSI;
         |SI #8#10 = "S"; #7#18 = #7#18 + #8#13; |FINSI;
         |SI #8#10 = "A"; #7#19 = #7#19 + #8#13; |FINSI;
         #7#21 = #7#17 % #7#20;
         #7#22 = #7#17 - #7#21;
         #7#23 = #7#22 % iva;
         #7#24 = #7#22 + #7#23 + #7#18;

         |SI #7#12 = "S";
             #7#25 = #7#22 % #11#31;
         |SINO;
             #7#25 = 0;
         |FINSI;

         #7#26 = #7#24 - #7#19 - #7#25;
         |CIERRA #12;
         |GRABA 140#7a;
    |FINSI;
    |CIERRA #12;
|FINSI;
|CIERRA #7;
|FPRC;

|CALCULO iva;
|ABRE #450;
#450#0 = #7#0;
|LEE 000#450=;
|SI FSalida ! 0; |DDEFECTO #450; |FINSI;
|CIERRA #450;

iva = #450#3;
|FCAL;

|PROCESO graba_con;
|ABRE #10;
#10#0 = #8#4;
#10#1 = #8#5;
|LEE 040#10=;
|SI FSalida ! 0; |CIERRA #10; |ACABA; |FINSI;
|CIERRA #10;

|ABRE #9;
|LEE 040#9p;
|SI FSalida ! 0; |DDEFECTO #9; |FINSI;
|CIERRA #9;

c_clie    = #8#1;
c_clie    = ("00000" + c_clie) % -105;
fijo    = #9#3; |QBF fijo;
fijo    = fijo + c_clie;

conver1 = #8#15 % 0102;
conver2 = #8#15 % 0402;
conver  = conver1 + conver2;
c_fecha = conver;

c_fecha = ("0000" + c_fecha) % -104;

|ABRE #99;
#99#0 = #8#0;
#99#1 = #8#1;
#99#2 = #8#2;
|LIBERA #99;
|LEE 140#99=;
|SI FSalida = 0;
   #99#3  = #9#1;
   #99#4  = #9#2;
   #99#5  = c_fecha;
   #99#6  = fijo;
   #99#7  = #10#2;
   #99#8  = #10#6;
   #99#9  = #10#3;
   #99#10 = #10#4;
   #99#11 = #8#13;
   #99#12 = #10#5;
   #99#13 = 0;
   #99#14 = "";
   |GRABA 140#99a;
|SINO;
   |DDEFECTO #99;
   #99#0  = #8#0;
   #99#1  = #8#1;
   #99#2  = #8#2;
   #99#3  = #9#1;
   #99#4  = #9#2;
   #99#5  = c_fecha;
   #99#6  = fijo;
   #99#7  = #10#2;
   #99#8  = #10#6;
   #99#9  = #10#3;
   #99#10 = #10#4;
   #99#11 = #8#13;
   #99#12 = #10#5;
   #99#13 = 0;
   #99#14 = "";
   |GRABA 140#99n;
|FINSI;
|CIERRA #99;
|FPRC;
*/
