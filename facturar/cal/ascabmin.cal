|FICHEROS;
     ascabmin #0;                            || CALCULO PARA OPCION DE IM-
     asclient #1;                            || PRESION EN MANTENIMIENTOS
     asw00003 #2;
     ashismic #4;

     asm00013 #500;
     &fopagos@ #712;
|FIN;

|VARIABLES;
     aMensaje = "";
     aTecla = "";
     nModo = 0;
     aAlfa1 = "";

 {-1}aUtil  = "";
     aUtil1 = "2400";
     aUtil2 = "1";
     aUtil3 = "";
     aUtil4  = "IFT";
     aUtil5  = "Imprimir";
     aUtil6  = "Facturar minuta";
     aUtil7  = "Facturar Todas";

     vacio       = "                                        ";
     Modo        = 0;
     nBoton1     = -1;
     nBoton2     = -1;

     &enCodPago  = 0;
     &enTipo     = 0;
     &enCliente  = 0;
     nTipo       = 0;
     nCliente    = 0;
|FIN;

|INCLUYE agicon_i;  || enlace con agicont

-------------------------------------------------------------
|PROCESO lee_clien;
    |DDEFECTO #1;
    |ABRE #1;
    #1#0 = #2#0;
    |LEE 020#1=;
    |CIERRA #1;
|FPRC;

|PROCESO lee_forma;
   enCodPago = #1#15;
   |HAZ LeeFormaDePago;
|FPRC;

|PROCESO pulsaf1; |TIPO 0;
   Modo = (FEntrada / 100) ! 0;
   |SI Modo = 1;
       |ESTADO_CONTROL nBoton1, "DISABLE";
       |ESTADO_CONTROL nBoton2, "DISABLE";
   |FINSI;

|SI FSalida = 9;
    |PUSHV 08101571;
    |PINPA #0#2;
    |ENDATOS #1#2;
    |SI FSalida = 0;
        |HAZ lee_clien;
        |HAZ lee_forma;
            #0#0 = #712#35;     |PINTA #0#0;
            #0#1 = #2#0;      |PINTA #0#1;
        |PTEC 802;
    |FINSI;
    |POPV;
|FINSI;
|FPRC;

|PROCESO ttcabmin;
    |IMPRE 0;
    |SI FSalida ! 0; |ACABA; |FINSI;

    |INFOR "ascabmin";
    |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

    |LEE 040#0p;
    |SI FSalida = 0; |PRINT; |FINSI;

|ET leer;
    |LEE 040#0s;
    |SI FSalida = 0; |PRINT; |VETE leer; |FINSI;
    |PIEINF;
    |FININF;
    |FINIMP;
|FPRC;

|PROCESO cliente;|TIPO 7;
   |SI #0#3 = "                                        ";
       #0#3 = #0#2;
      |PINTA #0#3;
   |FINSI;
|FPRC;

|PROCESO pintacli;|TIPO 0;
|ABRE #1;
#1#0 = #0#1;
|LEE 040#1=;
|SI FSalida = 0;
    #0#2 = #1#1;
    #0#3 = #1#2; |PINTA #0#3;
    #0#4 = #1#3;
    #0#5 = #1#4;
    #0#6 = #1#5;
    #0#7 = #1#6;
    #0#8 = #1#7;
    #0#9 = #1#8;
    #0#10 = #1#15; |PINTA #0#10;
    #0#11 = #1#16; |PINTA #0#11;
    #0#12 = #1#17; |PINTA #0#12;
    #0#13 = #1#11;
    #0#14 = #1#12;
    #0#15 = #1#13;
    #0#16 = #1#14;
    #0#20 = #1#23; |PINTA #0#20;
|SINO;
   |MENAV "    No existe cliente ";
   |ERROR;
|FINSI;
|CIERRA #1;
|FPRC;

|PROCESO funcion; |TIPO 0;
|SI FSalida ! 9; |ACABA; |FINSI;

|CAMPO_MODIFICA #0#27, 1, "S";
|CAMPO_MODIFICA #0#28, 1, "S";
|CAMPO_MODIFICA #0#29, 1, "S";

|SI #0#29 = "01.01.1900";
    #0#29 = ~; |PINTA #0#29;
|FINSI;

|ET campo_27;
     |ENCAMPO #27#0;
     |SI FSalida = 1; |VETE no_campo; |FINSI;
     |SI FSalida = 7; |VETE no_campo; |FINSI;

|ET campo_28;
     |ENCAMPO #28#0;
     |SI FSalida = 2; |VETE campo_27; |FINSI;
     |SI FSalida = 1; |VETE no_campo; |FINSI;
     |SI FSalida = 7; |VETE no_campo; |FINSI;

|ET campo_29;
     |ENCAMPO #29#0;
     |SI FSalida = 2; |VETE campo_28; |FINSI;

|ET no_campo;
     |ABRE #4;
     #4#0 = #0#27;
     #4#1 = #0#28;
     |LEE 040#4=;
     |SI FSalida = 0;
         |MENAV "         La factura ya existe en el historico";
         |VETE campo_27;
     |FINSI;
     |CIERRA #4;

|CAMPO_MODIFICA #0#27, 1, "N";
|CAMPO_MODIFICA #0#28, 1, "N";
|CAMPO_MODIFICA #0#29, 1, "N";
|FPRC;

|PROCESO BajaCuotCli;
   |BORRA 020#asm00013.a;
|FPRC;

|DEFBUCLE BajaCuotCli;
#asm00013#1;
;
#ascabmin#0,#ascabmin#1,#ascabmin#27,#ascabmin#28,"N",001,01;
#ascabmin#0,#ascabmin#1,#ascabmin#27,#ascabmin#28,"N",999,99;
;
NULL,BajaCuotCli;
|FIN;

|PROCESO Tipo3; |TIPO 3;
   |ESTADO_CONTROL nBoton1, "ENABLE";
   |ESTADO_CONTROL nBoton2, "ENABLE";
|FPRC;

|PROCESO Tipo14; |TIPO 14;
   Modo = (FEntrada / 100) ! 0;
   |SI Modo = 1;
       |ESTADO_CONTROL nBoton1, "DISABLE";
       |ESTADO_CONTROL nBoton2, "DISABLE";
   |FINSI;

   |SI Modo = 4;
       |ESTADO_CONTROL nBoton1, "ENABLE";
       |ESTADO_CONTROL nBoton2, "ENABLE";
   |FINSI;

   |SI #0#17 = 0; |Y #0#18 = 0; |Y #0#19 = 0;
    |Y #0#24 = 0; |Y #0#26 = 0;
       |ESTADO_CONTROL nBoton2, "DISABLE";
   |FINSI;
|FPRC;

|PROCESO Baja; |TIPO 1;
   |ESTADO_CONTROL nBoton1, "DISABLE";
   |ESTADO_CONTROL nBoton2, "DISABLE";

   Modo = (FEntrada / 100) ! 0;
   |SI Modo = 3; |BUCLE BajaCuotCli; |FINSI;
|FPRC;

|PROCESO Boton1;
     |LIBERA #0;

     enTipo  = #0#0;
     |SUB_EJECUTA "asprofac";

     #0#0 = nTipo;
     #0#1 = nCliente;
     |LEE 101#0=;
|FPRC;

|PROCESO Boton2;
     |SI #0#17 = 0; |Y #0#18 = 0; |Y #0#19 = 0;
       |Y #0#24 = 0; |Y #0#26 = 0;
         aMensaje = "0000Importes a cero" + &13 + "No es posible facturar la minuta";
         |MENAV aMensaje;
         |ACABA;
     |FINSI;
     |CONFI "0000NSeguro que quiere facturar la minuta que esta en pantalla";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     enTipo    = #0#0;
     enCliente = #0#1;
     |LIBERA #0;

     |SUB_EJECUTA "asprofac;SOLOUNAMINUTA";

     enCliente = 0;
|FPRC;

|PROCESO Tipo80Cab;  |TIPO 80;
/*
     |SI nBoton1 ! -1;  |ACABA;  |FINSI;
     |SI nBoton2 ! -1;  |ACABA;  |FINSI;

     |CONTROL_SIMPLE 0, "BOTON,Proceso facturacion completa", 0560, 0579, Boton1;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Facturar esta minuta", 0539, 0558, Boton2;
     nBoton2 = FSalida;
*/
|FPRC;

|PROCESO Tipo90Cab;  |TIPO 90;
/*
     |FIN_CONTROL_WINDOWS  nBoton1;
     |FIN_CONTROL_WINDOWS  nBoton2;
*/
|FPRC;

|PROCESO Tipo20;  |TIPO 20;
     nModo = (FEntrada / 100) ! 0;
     aAlfa1 = FSalida;

     |SI aAlfa1 = "OPCION";
         FSalida = "Opciones";
         |ACABA;
     |FINSI;

     |LEE 101#0=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nTipo    = #0#0;
     nCliente = #0#1;

     |MENU aUtil;
     aUtil2 = FSalida;
     |SI aUtil2 = "1";  |HAZ ttcabmin; |FINSI;
     |SI aUtil2 = "2";  |HAZ Boton2;   |FINSI;
     |SI aUtil2 = "3";  |HAZ Boton1;   |FINSI;

     |LIBERA #0;
|FPRC;
