|FICHEROS;
     aboy0002 #0;
     abom0001 #1;
     abom0005 #5;
     abom0007 #7;
     abom0008 #8;
     abom0009 #9;
     abow0004 #100;
     asempres #102;
|FIN;

|VARIABLES;
     aFichero  = "";
     nContador = 0;
     nSwContinua = 0;
     nCampos     = 0;
     nDEmpresa   = 0;
     nHEmpresa   = 0;
|FIN;

|PROCESO Mayus;
     #0Campo = #0Campo > #0Campo;  |PINTA #0Campo;
|FPRC;

|PROCESO QueTipo;
     |C_M #0#2,  1, "S";
     |C_M #0#3,  1, "S";
     |C_M #0#12, 1, "S";
     |C_M #0#13, 1, "S";

     |SI #0#29 = "T";
         |C_M #0#12, 1, "N";  #0#12 = 0;  |PINTA #0#12;
         |C_M #0#13, 1, "N";  #0#13 = 0;  |PINTA #0#13;
     |FINSI;
|FPRC;

|PROCESO CargaW0004_1;
     nSwContinua = 1;
     |SI #0#16 ! 0;
         nSwContinua = 0;
         |PARA nCampos = 16;  |SI nCampos [ 27;  |HACIENDO nCampos = nCampos + 1;
               |SI #5#2 = #0nCampos;  nSwContinua = 1;  |SAL;  |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwContinua = 0;  |ACABA;  |FINSI;

     #1#0 = #5#0;
     |LEE 040#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;

     |SI #1#3  < #0#2;       |O #1#3  > #0#3;       |ACABA;  |FINSI;
     |SI #1#26 < nDEmpresa;  |O #1#26 > nHEmpresa;  |ACABA;  |FINSI;

     |SI #0#15 = "N";
         |SI #5#11 = "S";  |ACABA;  |FINSI;
     |FINSI;

     #102#0 = #0#28;
     |LEE 040#102=;
     |SI FSalida ! 0;  |DDEFECTO #102;  |FINSI;

     |SI #0#28 = 0;
         #102#1 = "TODAS LAS EMPRESAS";
     |FINSI;

     nContador = nContador + 1;
     #100#0    = nContador;
     #100#1    = #5#2;
     #100#2    = #1#3;
     #100#3    = #5#4;
     #100#4    = #5#0;
     #100#5    = #5#1;
     #100#6    = #5#5;
     #100#7    = #5#6;
     #100#8    = #5#7;
     #100#9    = #5#10;
     #100#10   = #5#19;
     #100#11   = #5#20;
     #100#12   = #5#16;
     #100#13   = #5#18;
     #100#14   = #0#28;
     #100#15   = #102#1;
     |GRABA 020#100n;
     |LIBERA #100;
|FPRC;

|DEFBUCLE abom0005;
     #5#2;
     6, 10;
     " ", " ", #0#12, #0#4, #0#0, #0#6, #0#8, #0#10;
     "z", "z", #0#13, #0#5, #0#1, #0#7, #0#9, #0#11;
     ;
     NULL, CargaW0004_1;
|FIN;

|PROCESO CargaW0004_2;
     |SI #0#15 = "N";
         |SI #8#11 = "S";  |ACABA;  |FINSI;
     |FINSI;

     nSwContinua = 1;
     |SI #0#16 ! 0;
         nSwContinua = 0;
         |PARA nCampos = 16;  |SI nCampos [ 27;  |HACIENDO nCampos = nCampos + 1;
               |SI #8#2 = #0nCampos;  nSwContinua = 1;  |SAL;  |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwContinua = 0;  |ACABA;  |FINSI;

     #102#0 = #0#28;
     |LEE 040#102=;
     |SI FSalida ! 0;  |DDEFECTO #102;  |FINSI;

     |SI #0#28 = 0;
         #102#1 = "TODAS LAS EMPRESAS";
     |FINSI;

     nContador = nContador + 1;
     #100#0    = nContador;
     #100#1    = #8#2;
     #100#2    = #8#0;
     #100#3    = #8#4;
     #100#4    = 0;
     #100#5    = #8#1;
     #100#6    = #8#5;
     #100#7    = #8#6;
     #100#8    = #8#7;
     #100#9    = #8#10;
     #100#10   = #8#19;
     #100#11   = #8#20;
     #100#12   = #8#16;
     #100#13   = #8#18;
     #100#14   = #0#28;
     #100#15   = #102#1;
     |GRABA 020#100n;
     |LIBERA #100;
|FPRC;

|DEFBUCLE abom0008;
     #8#2;
     6, 10;
     " ", " ", #0#2, #0#4, #0#0, #0#6, #0#8, #0#10;
     "z", "z", #0#3, #0#5, #0#1, #0#7, #0#9, #0#11;
     ;
     NULL, CargaW0004_2;
|FIN;

|RUTINA ClaveBaja100;
     #100#0 = 0;
     #100#1 = 0;
     #100#2 = 0;
     #100#3 = "01.01.0000";
|FRUT;

|RUTINA ClaveAlta100;
     #100#0 = 99999;
     #100#1 = 99;
     #100#2 = 99999;
     #100#3 = "31.12.2999";
|FRUT;

|PROCESO Tipo3;  |TIPO 3;
         nDEmpresa = #0#28;
         nHEmpresa = #0#28;

         |SI #0#28 = 0;
             nDEmpresa = 1;
             nHEmpresa = 99;
         |FINSI;

         aFichero = ("b1" + Usuario + "zzzzzzzz") % 108;  |NOME_DAT #100 aFichero;
         |ABRE #100;  |CIERRA #100;  |DELINDEX #100;

         nContador = 0;
         |ABRE #100;
         |ABRE #102;
         |ABRE #1;  |BUCLE abom0005;  |CIERRA #1;
         |SI #0#29 ! "E";
             |BUCLE abom0008;
         |FINSI;
         |CIERRA #100;
         |CIERRA #102;

         |SI nContador = 0;
             |MENAV "     Seleccion Vacia.";
             |ABRE #100;  |CIERRA #100;  |DELINDEX #100;
         |FINSI;

         |SI #0#14 [ 1;
             |C_M #100#2, 1, "N";
             |ENTLINEAL #2#100, -1, 4, 22, 1, ClaveBaja100, ClaveAlta100;
         |FINSI;

         |SI #0#14 = 2;
             |C_M #100#2, 1, "N";
             |ENTLINEAL #3#100, -1, 4, 22, 1, ClaveBaja100, ClaveAlta100;
         |FINSI;

         |SI #0#14 = 3;
             |C_M #100#1, 1, "N";
             |ENTLINEAL #4#100, -1, 4, 22, 1, ClaveBaja100, ClaveAlta100;
         |FINSI;

         |SI #0#14 = 4;
             |C_M #100#1, 1, "N";
             |ENTLINEAL #5#100, -1, 4, 22, 1, ClaveBaja100, ClaveAlta100;
         |FINSI;

         |ABRE #100;  |CIERRA #100;  |DELINDEX #100;
|FPRC;
