|FICHEROS;
     ashismic #0;

     asempres #3;
     asclient #4;
     ashisfac #90;
     ashisrec #91;
     ascontro #5;

     asm00013 #500;

     &bancosp@ #706;
     &fopagos@ #712;
|FIN;

|VARIABLES;
    &empresa = 0;

    modo    = 0;
    FEstado = 0;
    fechv   = @;
    em      = 0;
    j       = 0;
    mes_a   = "";
    mes_num = 0;
    campo   = 0;
    nModo   = 0;
    Modo    = 0;
    aAlfa   = "";

    &enCodBanco  = 0;
    &enCodPago   = 0;
    &enSwDeDonde = 0;
|FIN;

|PROCESO alta_no; |TIPO 7;
modo = (FEntrada / 100) ! 0;
|SI modo = 1;
    |MENAV "     No se puede dar de ALTA, use programas correctos.";
    |PTEC 807;
|FINSI;

|SI modo = 3;
    |MENAV "     No se puede dar de BAJA.";
    |PTEC 807;
|FINSI;
|FPRC;

|PROCESO TotalCab;
     |ABRE #5;
     |LEE 000#5p;
     |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;
     |CIERRA #5;

     #0#23 = #0#19 % #0#22;
     #0#24 = #0#19 - #0#23;
     #0#25 = #0#24 % #0#45;
     #0#26 = #0#24 + #0#25 + #0#20;
     |SI #0#14 = "S";
         |SI #0#46 = 0;
             #0#46 = #5#31;
         |FINSI;

         #0#27 = #0#24 % #0#46;
     |SINO;
         #0#27 = 0;
         #0#46 = 0;
     |FINSI;
     #0#28 = #0#26 - #0#27 - #0#21;

     |PINTA #0#19;
     |PINTA #0#20;
     |PINTA #0#21;
     |PINTA #0#23;
     |PINTA #0#24;
     |PINTA #0#25;
     |PINTA #0#26;
     |PINTA #0#27;
     |PINTA #0#28;
     |PINTA #0#46;
|FPRC;


|PROCESO actua_cab; |TIPO 2;
|SI #0#30 = "S"; |O #0#31 = "S"; |O #0#32 = "S"; |O #0#33 = "S";
    |MENAV "      Ficha ya contabilizada o cobrada.";
    |ERROR;
    |ACABA;
|FINSI;

mes_a   = #0#29 % 402;
mes_num = mes_a;

enCodBanco = #0#13;
|HAZ LeeBancoPropio;
|SI enSwDeDonde = 0;
    |ABRE #706;
    #706#0 = #0#13;
    |LEE 140#706=;
    |SI FSalida = 0;
        #706#20 = #706#20 +. #0#28;
        #706#22 = #706#22 +. #0#28;
        campo = 7 + mes_num; #706campo = #706campo +. #0#28;
        |GRABA 140#706a;
        |LIBERA #706;
    |FINSI;
    |CIERRA #706;
|FINSI;

|ABRE #4;
#4#0 = #0#3;
|LIBERA #4;
|LEE 140#4=;
|SI FSalida = 0;
    #4#49 = #4#49 +. #0#19;
    #4#50 = #4#50 +. #0#20;
    #4#18 = #4#18 +. #0#19;
    #4#19 = #4#19 +. #0#20;

    campo = 24 + mes_num; #4campo = #4campo +. #0#19;
    campo = 36 + mes_num; #4campo = #4campo +. #0#20;

    #4#24 = #0#28;

    |GRABA 140#4a;
|FINSI;
|CIERRA #4;

modo = (FEntrada / 100) ! 0;
|SI modo = 3;
    |ABRE #90;
    #90#0 = #0#0; #90#1 = #0#1; |BORRA 140#90c; |LIBERA #90;
    |CIERRA #90;

    |ABRE #91;
    #91#0 = #0#0; #91#1 = #0#1; |BORRA 140#91c; |LIBERA #91;
    |CIERRA #91;
    |ACABA;
|FINSI;

|ABRE #90;
#90#0 = #0#0;
#90#1 = #0#1;
|LIBERA #90;
|LEE 140#90=;
FEstado = FSalida;

|DDEFECTO #90;
#90#0  = #0#0;
#90#1  = #0#1;
#90#2  = #0#29;
#90#3  = #0#3;
#90#4  = #0#2;
#90#5  = #0#19;
#90#6  = #0#20;
#90#7  = #0#45;
#90#8  = #0#25;
#90#9  = #0#46;
#90#10 = #0#27;
#90#11 = #0#26;
#90#12 = #0#30;
#90#13 = #0#31;
#90#14 = #0#21;
#90#15 = #0#22;
#90#16 = #0#23;
#90#17 = #0#24;
#90#18 = #0#28;
|SI FEstado ! 0; |GRABA 140#90n; |SINO; |GRABA 140#90a; |FINSI;
|CIERRA #90;

|ABRE #91;
#91#0 = #0#0;
#91#1 = #0#1;
|LIBERA #91;
|LEE 140#91=;
FEstado = FSalida;

|SI FEstado ! 0; |DDEFECTO #91; |FINSI;

#91#0  = #0#0;
#91#1  = #0#1;
#91#2  = #0#29;
#91#3  = #0#3;
#91#4  = #0#2;

|HAZ fecha_venci;
#91#5  = fechv;
#91#6  = #0#28;
#91#7  = #0#13;
#91#11 = #0#12;
aAlfa  = #91#2 % -104;
#91#17 = aAlfa;
|SI FEstado ! 0; |GRABA 140#91n; |SINO; |GRABA 140#91a; |FINSI;
|CIERRA #91;
|FPRC;

|PROCESO fecha_venci;
fechv     = #0#29;
enCodPago = #0#12;
|HAZ LeeFormaDePago;
|SI #712#5 ! 0;
    |SI #712#2 = "D"; em = 1; |SINO; em = 1000; |FINSI;
    j = #712#5 / em;
    fechv = #0#29 + j;
|FINSI;
|FPRC;

|PROCESO ConsultaSi; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4;
          |C_M #0#3, 1, "S";
     |SINO;
          |C_M #0#3, 1, "N";
     |FINSI;
|FPRC;

|PROCESO BajaCuotCli;
   |BORRA 020#asm00013.a;
|FPRC;

|DEFBUCLE BajaCuotCli;
#asm00013#1;
;
0,#ashismic#3,#ashismic#0,#ashismic#1,"S",001,01;
9,#ashismic#3,#ashismic#0,#ashismic#1,"S",999,99;
be;
NULL,BajaCuotCli;
|FIN;

|PROCESO Baja; |TIPO 1;
   Modo = (FEntrada / 100) ! 0;

   |SI modo = 2;
       |ABRE #5;
       |LEE 000#5p;
       |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;
       |CIERRA #5;

       |SI #5#35 = "N";
           |MENAV "     No se puede MODIFICAR.";
           |ERROR;
       |FINSI;
   |FINSI;

   |SI Modo = 3; |BUCLE BajaCuotCli; |FINSI;
|FPRC;

|VARIABLES;
     &d_serie = "";
     &h_serie = "";
     &d_factu = 0;
     &h_factu = 0;
     &d_fecha = @;
     &h_fecha = @;
     &d_clien = 0;
     &h_clien = 0;
     &enDReme = 0;
     &enHReme = 0;
     &enDFPag = 0;
     &enHFPag = 0;
     &d_viene = 2;
     &cuotas  = "";
     &eaTipoDir = "";

     &eaSwNotasIFac = "";     ||Indica si imprimimos notas internas en Facturas
     &enModVisados = 0;       ||Indica que se llama desde Modulo VISADOS
     &enSwPDFVisados = 0;     ||Si el pdf de la factura se ha creado correctamente
     &enModDtos      = 0;     ||Desactiva en la facturacion automatica (visam010) el descuento de cliente

     nSwVisados      = 0;
|FIN;

|PROCESO ImpreDirecta; |TIPO 4;
     |HAZ EsVisados; nSwVisados = FSalida;

     d_serie = #ashismic#0;
     h_serie = #ashismic#0;
     d_factu = #ashismic#1;
     h_factu = #ashismic#1;
     d_fecha = "01.01.0000";
     h_fecha = "31.12.2999";
     d_clien = #ashismic#3;
     h_clien = #ashismic#3;
     enDReme = 00;
     enHReme = 99;
     enDFPag = 00;
     enHFPag = 99;
     cuotas  = "N";
     eaTipoDir = "";
     d_viene = 2;
     empresa = 1;
     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = empresa;
     |LEE 101#3=;
     |SI FSalida = 0;
         eaTipoDir = #3#15;
         cuotas    = #3#19;
         |GRABA 020#3a;
         |LIBERA #3;
     |FINSI;
     |CIERRA #3;


     |SI nSwVisados = 0;
        eaSwNotasIFac = "N";
        enModVisados = 1;
        enSwPDFVisados = 0;
     |SINO;
        enModVisados = 0;
     |FINSI;

     |SUB_EJECUTA_NP "asfacges";
|FPRC;
