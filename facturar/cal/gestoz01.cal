|FICHEROS;
    gestoz01 #0;
    gestom04 #1;
    gestom05 #2;
    ascabmin #3;
    aslinmin #4;
    asexpetr #5;
    asclient #6;
    ascontro #7;
    ascontrt #450;

    asconcep #8;
    asenlcon #9;
    asempcon #10;
    asw00001 #99;
|FIN;

|VARIABLES;
    c_clie    = "";
    fijo      = "";
    sw        = 0;
    x         = 0;
    y         = 0;
    linea     = 0;
    sw_cab    = 0;
    FEstado   = 0;
    iva       = 0;
    juan      = 0;
    refer     = 0;
    conver    = "";
    conver1   = "";
    conver2   = "";
|FIN;

|INCLUYE agicon_i;
|INCLUYE i_ficher;

|PROCESO linea_aut;
|HAZ grabamin;
#2#15 = "S";
|GRABA 140#2a;
|LIBERA #2;
|FPRC;

|PROCESO graba_ind;
refer = refer + 1;

#1#0  = #2#0;
#1#14 = #2#16;
|LEE 040#1=;
|SI FSalida ! 0; |DDEFECTO #1; |FINSI;

|DDEFECTO #5;
|PARA x = 0; |SI x [ 1; |HACIENDO x = x + 1;
      #5x = #2x;
      |PINTA #5x;
|SIGUE;
#5#2 = #1#2; |PINTA #5#2;
|PARA x = 2; |SI x [ 9; |HACIENDO x = x + 1;
      y = x + 1;
      #5y = #2x;
|SIGUE;
|PARA x = 11; |SI x [ 13; |HACIENDO x = x + 1;
      #5x = #2x;
|SIGUE;
#5#4  = #2#17;
#5#14 = #2#16; |PINTA #5#14;
#5#15 = refer;
#5#16 = "N";
#5#17 = #1#13;

|GRABA 040#5n;
|FPRC;

|PROCESO lineas;
|SI #0#6 = "M"; |HAZ graba_ind; |FINSI;

|SI #0#6 = "A";
    #1#0  = #2#0;
    #1#14 = #2#16;
    |LIBERA #1;
    |LEE 140#1=;
    |SI FSalida ! 0; |ACABA; |FINSI;
    |HAZ linea_aut;
    |GRABA 140#1a;
|FINSI;
|FPRC;

|DEFBUCLE asexpeli;
#2#1;
1, 17, 15;
#0#0, #0#7, 000, #0#2, #0#4, "N";
#0#1, #0#8, 999, #0#3, #0#5, "N";
be;
NULL, lineas;
|FIN;

|PROCESO manual;
#2#0  = #5#0;
#2#16 = #5#14;
#2#2  = #5#3;
|LIBERA #2;
|LEE 140#2=;
|SI FSalida ! 0; |ACABA; |FINSI;

#1#0  = #2#0;
#1#14 = #2#16;
|LIBERA #1;
|LEE 140#1=;
|SI FSalida ! 0; |ACABA; |FINSI;

|HAZ grabamin;

#2#15 = "S";
|GRABA 140#2a;
|GRABA 140#1a;
|FPRC;

|DEFBUCLE asexpetr;
#5#1;
16;
001, "S";
999, "S";
e;
NULL, manual;
|FIN;

|RUTINA min;
#5#15 = 1;
|FRUT;

|RUTINA max;
#5#15 = refer;
|FRUT;

|PROCESO impre; |TIPO 3;
|ABRE #7;
|LEE 040#7p;
|SI FSalida ! 0; |DDEFECTO #7; |FINSI;
|CIERRA #7;

|SI #0#6 = "M";
    comienza = "ex";
    |HAZ fichero;
    |NOME_DAT #5 fichero;
    |ABRE #5; |CIERRA #5; |DELINDEX #5;
    |ABRE #5;
|FINSI;

refer = 0;
|ABRE #1;
|BUCLE asexpeli;
|CIERRA #1;

|SI #0#6 = "M";
    |CIERRA #5;
    |SI refer ! 0;
        |PINPA #0#5;
        |ENTLINEAL #1#5, 1, 4, 21, 0, min, max;
        |CONFI "2400SConforme con lo seleccionado : ";
        |SI FSalida = 0;
            |ABRE #1;
            |ABRE #2;
            |BUCLE asexpetr;
            |CIERRA #1;
            |CIERRA #2;
        |FINSI;
        |DELINDEX #5;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO miralin;
    linea = #4#2;
|FPRC;

|PROCESO grabamin;
|ABRE #6;
#6#0 = #1#1;
|LEE 040#6=;
|SI FSalida ! 0; |DDEFECTO #6; |FINSI;
|CIERRA #6;

|ABRE #3;
sw_cab = 0;
#3#0 = #1#5;
#3#1 = #1#1;
|LIBERA #3;
|LEE 110#3=;
|SI FSalida ! 0;
    linea = 1;
    |DDEFECTO #3;
    #3#0 = #1#5;
    #3#1 = #1#1;
    #3#2 = #6#1;
    #3#3 = #6#2;
    #3#4 = #6#3;
    #3#5 = #6#4;
    #3#6 = #6#5;
    #3#7 = #6#6;
    #3#8 = #6#7;
    #3#9 = #6#8;
    #3#10 = #6#15;
    #3#11 = #6#16;
    #3#12 = #6#17;
    #3#13 = #6#11;
    #3#14 = #6#12;
    #3#15 = #6#13;
    #3#16 = #6#14;
    #3#20 = #6#23;
    linea = 5;

    |SI #7#32 = "S";
        |SI #6#24 ! 0;
             |ABRE #8;
             #8#0 = #7#33;
             #8#1 = #7#34;
             |LEE 040#8=;
             |SI FSalida = 0; |Y #8#3 = "A";
                 |ABRE #4;
                 #4#0  = #3#0;
                 #4#1  = #3#1;
                 #4#2  = linea;
                 #4#3  = 0;
                 #4#4  = #8#0;
                 #4#5  = #8#1;
                 #4#6  = #8#2;
                 #4#7  = #8#16;
                 #4#8  = #8#17;
                 #4#9  = #8#18;
                 #4#10 = #8#3;
                 #4#11 = 1;
                 #4#12 = -#6#24;
                 #4#13 = -#6#24;
                 #4#14 = "G";
                 #4#15 = "00.00.0000";
                 |GRABA 040#4n;
                 |CIERRA #4;
                 |HAZ graba_con;

                 #3#19 = #3#19 + #4#13;
                 #3#26 = #3#24 - #3#19 - #3#25;
                 linea = 5;
             |FINSI;
             |CIERRA #1;
        |FINSI;
    |FINSI;
    |GRABA 020#3b;
    linea = linea + 5;
|SINO;
    |BUCLELIN 0miralin#3;
    linea = linea + 5;
|FINSI;
|ABRE #4;
#4#0 = #3#0;
#4#1 = #3#1;
#4#2 = linea;
|PARA juan = 3; |SI juan [ 14; |HACIENDO juan = juan + 1;
    #4juan = #2juan;
|SIGUE;
#4#15 = #2#17;

|SI sw_cab = 0;
   |SI #2#10 = "H"; #3#17 = #3#17 + #2#13; #1#9  = #1#9  - #2#13; |FINSI;
   |SI #2#10 = "S"; #3#18 = #3#18 + #2#13; #1#10 = #1#10 - #2#13; |FINSI;
   |SI #2#10 = "A"; #3#19 = #3#19 + #2#13; #1#11 = #1#11 - #2#13; |FINSI;
|FINSI;

|HAZ iva;

#3#21 = #3#17 % #3#20;
#3#22 = #3#17 - #3#21;
#3#23 = #3#22 % iva;
#3#24 = #3#22 + #3#23 + #3#18;
|SI #3#12 = "S";
    #3#25 = #3#22 % #7#31;
|SINO;
    #3#25 = 0;
|FINSI;
#3#26 = #3#24 - #3#19 - #3#25;

|GRABA 020#3a;
|LIBERA #3;

|GRABA 020#4n;
|LIBERA #4;

|CIERRA #3;
|CIERRA #4;
|HAZ graba_con;
|FPRC;

|PROCESO iva;
|ABRE #450;
#450#0 = #3#0;
|LEE 000#450=;
|SI FSalida ! 0; |DDEFECTO #450; |FINSI;
|CIERRA #450;

iva = #450#3;
|FPRC;

|PROCESO graba_con;
|ABRE #9;
#9#0 = #4#4;
#9#1 = #4#5;
|LEE 040#9=;
|SI FSalida ! 0; |CIERRA #9; |ACABA; |FINSI;
|CIERRA #9;

|ABRE #10;
|LEE 040#10p;
|SI FSalida ! 0; |DDEFECTO #10; |FINSI;
|CIERRA #10;

c_clie    = #4#1;
c_clie    = ("00000" + c_clie) % -105;
fijo    = #10#3; |QBF fijo;
fijo    = fijo + c_clie;
conver1 = #4#15 % 0102;
conver2 = #4#15 % 0402;
conver  = conver1 + conver2;
c_fecha = conver;
c_fecha = ("0000" + c_fecha) % -104;

|ABRE #99;
#99#0 = #4#0;
#99#1 = #4#1;
#99#2 = #4#2;
|LIBERA #99;
|LEE 140#99=;
|SI FSalida = 0;
   #99#3  = #10#1;
   #99#4  = #10#2;
   #99#5  = c_fecha;
   #99#6  = fijo;
   #99#7  = #9#2;
   #99#8  = #9#6;
   #99#9  = #9#3;
   #99#10 = #9#4;
   #99#11 = #4#13;
   #99#12 = #9#5;
   #99#13 = 0;
   #99#14 = "";
   |GRABA 140#99a;
|SINO;
   |DDEFECTO #99;
   #99#0  = #4#0;
   #99#1  = #4#1;
   #99#2  = #4#2;
   #99#3  = #10#1;
   #99#4  = #10#2;
   #99#5  = c_fecha;
   #99#6  = fijo;
   #99#7  = #9#2;
   #99#8  = #9#6;
   #99#9  = #9#3;
   #99#10 = #9#4;
   #99#11 = #4#13;
   #99#12 = #9#5;
   #99#13 = 0;
   #99#14 = "";
   |GRABA 140#99n;
|FINSI;
|CIERRA #99;
|FPRC;


|PROCESO funcion; |TIPO 11;
|SI FSalida = 9;
    |LIBERA #5;
    |LEE 140#5=;
    #5#16 = "S";
    |GRABA 140#5a;
    |PINTA #5#16;
    |ERROR;
|FINSI;

|SI FSalida = 10;
    |LIBERA #5;
    |LEE 140#5=;
    #5#16 = "N";
    |GRABA 140#5a;
    |PINTA #5#16;
    |ERROR;
|FINSI;
|FPRC;
