|| PROCESO PARA RECOGER DATOS DE CONTABILIDAD

|INCLUYE i_varcof;

|FICHEROS;
   :/contagen/def/canempre #330;  || Empresas
   :/modelos/def/dsmom100 #1100;
|FIN;

|VARIABLES;
    aPath     = "";
    nume1     = 0;
    any       = 0;
    anyMas    = 0;
    period    = 0;
    i1        = 0;
    {-1}punt1 = 0;

    alfa1     = "";
    alfa2     = "";
    aLosDefs  = "";
    aElProgr  = "";
    nCanal    = 0;
|FIN;

|PROCESO LeeEmpConta;
   swerror = 0;
   cod_emp1 = enEmpresa;  cod_emp1 = "00000" + cod_emp1;
   cod_emp2 = enPerConta; cod_emp2 = "0" + cod_emp2;
   clave1 = cod_emp1 % -105;
   clave2 = cod_emp2 % -101;

   |DBASS aPath; |QBT aPath;
   aPathConta    = aPath + "contagen/fich/" + clave1 + clave2 + "/";
   aPathPanConta = aPath + "contagen/pan/";

   cod1 = clave1;   empre = cod1;
   cod2 = clave2;   ejerc = cod2;

   |ABRE #canempre;
   #canempre#2 = cod1;
   #canempre#3 = cod2;
   |LEE 000#canempre.=;
   |SI FSalida ! 0;
       swerror = 1;
       |SI enSwSinMen = 0; |MENAV "    NO EXISTE EMPRESA CONTABLE "; |FINSI;
       |CIERRA #canempre;
       |ACABA;
   |FINSI;
   |CIERRA #canempre;

   |HAZ CalDirectorio;
   |SI swerror = 1;
       |SI enSwSinMen = 0; |MENAV "    NO EXISTE DIRECTORIO DE EMPRESA "; |FINSI;
       |ACABA;
   |FINSI;

   dig1 = #canempre#11;       || desde mes
   dig3 = #canempre#13;       || nro. niveles
   dig4 = #canempre#14;       || 1 nivel
   dig5 = #canempre#15;       || 2 nivel
   dig6 = #canempre#16;       || 3 nivel
   dig7 = #canempre#17;       || 4 nivel
   dig8 = #canempre#18;       || 5 nivel
   dig9 = #canempre#19;       || 6 nivel
   eaMonedaCon = #canempre#28; ||Moneda
   eaNombreEmp = #canempre#1;  ||Nombre Empresa
   eaEstadoEmp = "S";
   |SI #canempre#21 = "I"; eaEstadoEmp = "N"; |FINSI;

   cod2 = #canempre#26;
   tra1 = 100 + cod2;
   clave2 = tra1 % -102;
   tra1 = 100 + #canempre#11;
   mes1 = tra1 % -102;
   |SI cod2 < 80;
      work1 = "01." + mes1 + ".20" + clave2;
      enEjer = 2000 + cod2;
   |SINO;
      work1 = "01." + mes1 + ".19" + clave2;
      enEjer = 1900 + cod2;
   |FINSI;
   fec1 = work1;
   tra1 = 100 + #canempre#12;
   mes1 = tra1 % -102;
   |SI #canempre#11 > #canempre#12;
      cod2 = cod2 + 1;
      |SI cod2 > 99; cod2 = cod2 - 100;    |FINSI;
   |FINSI;
   dia1 = "31";
   |SI #canempre#12 = 4; |O #canempre#12 = 6; |O #canempre#12 = 9; |O #canempre#12 = 11;
      dia1 = "30";
   |FINSI;
   |SI #canempre#12 = 2;
      dia1 = "28";
      |SI cod2 = 88; |O cod2 = 92; |O cod2 = 96; |O cod2 = 0; |O cod2 = 4;
         dia1 = "29";
      |FINSI;
   |FINSI;
   tra1 = 100 + cod2;
   clave2 = tra1 % -102;
   |SI cod2 < 80;
      work1 = dia1 + "." + mes1 + ".20" + clave2;
   |SINO;
      work1 = dia1 + "." + mes1 + ".19" + clave2;
   |FINSI;
   fec2 = work1;

   eaDepar = #canempre#24;
   eaSubde = #canempre#22;

  || Recoger informacion sobre los niveles ...
  Ipunt1 = dig3<-;
  Ipunt1 = Ipunt1 + dig3;
  MaximoDigitos = punt1;
  DigitosPaseDirecto = dig3;
|FPRC;

|PROCESO SituaMaestra;

  |ABRE #1100;
  |LEE 040#1100p;
  |SI FSalida ! 0;  |DDEFECTO #1100;  |FINSI;
  |CIERRA #1100;

  swerror = 0;
  alfa1 = #1100#1; alfa1 = ("00000" + alfa1) % -105;
  alfa2 = #1100#2; alfa2 = ("0"     + alfa2) % -101;

  |DBASS aPath; |QBT aPath;
  aPathConta    = aPath + "contagen/fich/" + alfa1 + alfa2 + "/";
  aPathPanConta = aPath + "contagen/pan/";

  |ABRE #canempre;
  #canempre#2 = #1100#1;
  #canempre#3 = #1100#2;
  |LEE 000#canempre.=;
  |SI FSalida ! 0;
      swerror = 1;
      |SI enSwSinMen = 0; |MENAV "    NO EXISTE LA EMPRESA MAESTRA DE CONTABILIDAD"; |FINSI;
      |CIERRA #canempre;
      |ACABA;
  |FINSI;
  |CIERRA #canempre;

   enEmpresa  = #1100#1;
   enPerConta = #1100#2;
   |HAZ CalDirectorio;
   |SI swerror = 1;
       |SI enSwSinMen = 0; |MENAV "    NO EXISTE DIRECTORIO DE EMPRESA "; |FINSI;
       |ACABA;
   |FINSI;

   dig1 = #canempre#11;       || desde mes
   dig3 = #canempre#13;       || nro. niveles
   dig4 = #canempre#14;       || 1 nivel
   dig5 = #canempre#15;       || 2 nivel
   dig6 = #canempre#16;       || 3 nivel
   dig7 = #canempre#17;       || 4 nivel
   dig8 = #canempre#18;       || 5 nivel
   dig9 = #canempre#19;       || 6 nivel
   eaMonedaCon = #canempre#28; ||Moneda

  || Recoger informacion sobre los niveles ...
  Ipunt1 = dig3<-;
  Ipunt1 = Ipunt1 + dig3;
  MaximoDigitos = punt1;
  DigitosPaseDirecto = dig3;
|FPRC;

|PROCESO inicio; |TIPO 8;
|HAZ LeeEmpConta;
|FPRC;

|PROCESO DirAplSt; ||Directorios Aplicaciones Standar

  |DBASS aPath; |QBT aPath;  || Directorio Base de las Aplaciones

  aPAcceso = aPath + "integral/"; || Directorio Acceso
  aPGenral = aPath + "basica/";   ||            Ficha Clientes General
  aPContag = aPath + "contagen/"; ||            Contabilidad General

  aLosDefs = aPGenral + "def/";
  aElProgr = aLosDefs + "agifigen.mas";
  |XABRE "E", aElProgr, nCanal;
  |SI FSalida ] 0;
      Haybasica = 1;
  |SINO;
      Haybasica = 0;
  |FINSI;
  |XCIERRA nCanal;
|FPRC;

|PROCESO CalDirectorio;
   cod_emp1 = enEmpresa;  cod_emp1 = "00000" + cod_emp1;
   cod_emp2 = enPerConta; cod_emp2 = "0" + cod_emp2;
   clave1 = cod_emp1 % -105;
   clave2 = cod_emp2 % -101;

   |DBASS aPath; |QBT aPath;
   aPathConta    = aPath + "contagen/fich/" + clave1 + clave2 + "/";

   swerror = 0;
   |MKDIR aPathConta;
   |SI FSalida = 0;
       swerror = 1;
       |RMDIR aPathConta;
   |FINSI;
|FPRC;
