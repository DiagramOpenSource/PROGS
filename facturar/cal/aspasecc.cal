|FICHEROS;
     aspasecc #0;
     asclient #1;
     asconcli #2;
     ascabmin #3;
     aslinmin #4;
     asconmen #5;
     ascontro #6;
     ascontrt #450;
     asconcep #7;

     asenlcon #9;
     asempcon #10;
     asm00001 #11;
     asconmul #12;
     asw00001 #99;

     aslinmil #107;
     asconlin #117;
     abom0010 #110;
     ascuolin #111;
     ascuocab #112;
     abom0005 #115;
     abom0011 #211;

    ascuocab #500;
    ascuolin #501;
    asm00013 #502;

    &fopagos@ #712;

    facemp    #30;
    :/integral/def/dsam0000 #1000;
   :/basica/def/agifigen #1001;
|FIN;

|VARIABLES;
     nFichero      = 0;
     nCliente      = 0;
     aSeccion      = "";
     aConcepto     = "";
     NumLin        = 0;
     nAnyo         = 0;
     nDivisor      = 0;

     aNombre     = "";
     nNoSeMinuta = 0;
     nSwPrint    = 0;
     nLineaFija  = 0;
     nSwPase     = 0;
     nLinea      = 0;
     nElTipo     = 0;
     nSwHay      = 0;
     nCampo      = 0;
     nCampoPer   = 0;
     nVariable   = 0;
     nDConta     = 0;
     nHConta     = 0;
     nContador   = 0;

     aCliente    = "";
     aAnyo       = "";
     aParametro  = "";
     aAlfa        = "";

     &enCliente   = 0;
     &enContador  = 0;
     &efFecha     = @;
     &eaRetencion = "";
     &enCodPago   = 0;

     fijo    = "";
     i = 0;
     iva = 0;
     x   = 0;
     d_c = "  ";
     h_c = "zz";
     sw1 = 0;
     lin = 0;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     conver    = "";
     conver1   = "";
     conver2   = "";

     aBase     = "";
     aPath     = "";
     aHora     = "";

     fFecha    = @;

     &EURODB         = 0;
     &eaPathIntegral = "";
     nSwIntegra = 0;
     nBaja      = 0;
     nCampoCliente = 0;
     nParrilla     = 0;

     &enSwLinea = 0;
     &eaCodCli  = "";
     &eaNomCli  = "";
|FIN;

|INCLUYE agicon_i;

|| **********************************************************************
|| PROCESOS DE LA PANTALLA
|| **********************************************************************

|PROCESO Nomodi; |TIPO 7;
     aAlfa = #0#6;
     |C_M #0Campo, 1, aAlfa;
|FPRC;


|PROCESO Periodo; |TIPO 0;
     |SI #0#6 = "S";
         |C_M #0#4, 1, "N";  #0#4 = 0;    |PINTA #0#4;
         |C_M #0#5, 1, "N";  #0#5 = 99;   |PINTA #0#5;

         |PARA nCampo = 7; |SI nCampo [ 16; |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |PARA nCampo = 7; |SI nCampo [ 16; |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;
               |PINTA #0nCampo;
         |SIGUE;
         |C_M #0#4, 1, "S";
         |C_M #0#5, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Inutil;        ||para posicionarse en la ultima linea
     |SI #4#2 < 900; nLinea = #4#2; |FINSI;
|FPRC;

|PROCESO RecogeTexto;
     |ABRE #107;
     |ABRE #117;
     |PARA nVariable = 1;  |SI nVariable [ 100;  |HACIENDO nVariable = nVariable + 1;
           #117#0 = nFichero;
           #117#1 = nCliente;
           #117#2 = aSeccion;
           #117#3 = aConcepto;
           #117#4 = nVariable;
           |LEE 040#117=;
           |SI FSalida = 0;
               #107#0 = #4#0;
               #107#1 = #4#1;
               #107#2 = #4#2;
               #107#3 = nVariable;
               |LEE 101#107=;
               |SI FSalida = 0;
                   #107#4 = #117#5;
                   |GRABA 020#107a;
               |SINO;
                   #107#0 = #4#0;
                   #107#1 = #4#1;
                   #107#2 = #4#2;
                   #107#3 = nVariable;
                   #107#4 = #117#5;
                   |GRABA 020#107n;
               |FINSI;
               |LIBERA #107;
           |FINSI;
     |SIGUE;

     |CIERRA #107;
     |CIERRA #117;
|FPRC;

|PROCESO GrabaTexto1;
     |ABRE #107;
     |ABRE #211;
     |PARA nVariable = 1;  |SI nVariable [ 100;  |HACIENDO nVariable = nVariable + 1;
           #211#0 = #110#0;
           #211#1 = nVariable;
           |LEE 040#211=;
           |SI FSalida = 0;
               #107#0 = #4#0;
               #107#1 = #4#1;
               #107#2 = #4#2;
               #107#3 = #211#1;
               |LEE 101#107=;
               |SI FSalida = 0;
                   #107#4 = #211#2;
                   |GRABA 020#107a;
               |SINO;
                   #107#0 = #4#0;
                   #107#1 = #4#1;
                   #107#2 = #4#2;
                   #107#3 = #211#1;
                   #107#4 = #211#2;
                   |GRABA 020#107n;
               |FINSI;
               |LIBERA #107;

               |SI nVariable = 1; #4#6 = #107#4;  |FINSI;
               |SI nVariable = 1; #4#7 = #107#4;  |FINSI;
               |SI nVariable = 2; #4#8 = #107#4;  |FINSI;
               |SI nVariable = 3; #4#9 = #107#4;  |FINSI;
           |FINSI;
     |SIGUE;
     |CIERRA #107;
     |CIERRA #211;
|FPRC;

|PROCESO GrabaTexto;
     |ABRE #107;

     #107#0 = #4#0;  #107#1 = #4#1;  #107#2 = #4#2;  #107#3 = 1;
     |LIBERA #107;
     |LEE 101#107=;
     |SI FSalida ! 0;
         #107#0 = #4#0;
         #107#1 = #4#1;
         #107#2 = #4#2;
         #107#3 = 1;
         #107#4 = #4#7;
         |GRABA 020#107n;
     |FINSI;

     #107#0 = #4#0;  #107#1 = #4#1;  #107#2 = #4#2;  #107#3 = 2;
     aAlfa  = #4#8;  |QBF aAlfa;
     |LIBERA #107;
     |LEE 101#107=;
     |SI FSalida ! 0;  |Y aAlfa ! "";
         #107#0 = #4#0;
         #107#1 = #4#1;
         #107#2 = #4#2;
         #107#3 = 2;
         #107#4 = #4#8;
         |GRABA 020#107n;
     |FINSI;

     #107#0 = #4#0;  #107#1 = #4#1;  #107#2 = #4#2;  #107#3 = 3;
     aAlfa  = #4#9;  |QBF aAlfa;
     |LIBERA #107;
     |LEE 101#107=;
     |SI FSalida ! 0;  |Y aAlfa ! "";
         #107#0 = #4#0;
         #107#1 = #4#1;
         #107#2 = #4#2;
         #107#3 = 3;
         #107#4 = #4#9;
         |GRABA 020#107n;
     |FINSI;

     |CIERRA #107;
|FPRC;

|PROCESO CuotasCli;
   #asm00013#0  = #4#0;
   #asm00013#1  = #4#1;
   #asm00013#2  = #3#27;
   #asm00013#3  = #3#28;
   #asm00013#4  = #4#2;
   #asm00013#5  = 1;
   #asm00013#10 = "N";
   |LEE 000#asm00013.];
   |SI FSalida = 0; |Y #asm00013#0 = #4#0; |Y #asm00013#1 = #4#1;
    |Y #asm00013#2 = #3#27; |Y #asm00013#3 = #3#28;
    |Y #asm00013#4 = #4#2; |Y #asm00013#10 = "N";
       |PARA; |SI FSalida = 0; |Y #asm00013#0 = #4#0; |Y #asm00013#1 = #4#1;
        |Y #asm00013#2 = #3#27; |Y #asm00013#3 = #3#28;
        |Y #asm00013#4 = #4#2; |Y #asm00013#10 = "N"; |HACIENDO;
          NumLin = #asm00013#5 + 1;
          |LEE 000#asm00013.s;
       |SIGUE;
   |SINO;
       NumLin = 1;
   |FINSI;

   |DDEFECTO #asm00013;
   #asm00013#0  = #4#0;
   #asm00013#1  = #4#1;
   #asm00013#2  = #3#27;
   #asm00013#3  = #3#28;
   #asm00013#4  = #4#2;
   #asm00013#5  = NumLin;
   #asm00013#6  = #ascuolin#2;
   #asm00013#7  = #ascuolin#3;
   #asm00013#9  = #ascuolin#4;
   #asm00013#10 = "N";
   #asm00013#11 = #ascuolin#6;
   |SI #ascuocab#2 = "M"; nDivisor = 12; |FINSI;
   |SI #ascuocab#2 = "T"; nDivisor = 4;  |FINSI;
   |SI #ascuocab#2 = "S"; nDivisor = 2;  |FINSI;
   |SI #ascuocab#2 = "A"; nDivisor = 1;  |FINSI;
   #asm00013#12 = #ascuolin#5 / nDivisor;
   #asm00013#8  = #ascuolin#7 / nDivisor;
   |GRABA 020#asm00013.n;
|FPRC;

|DEFBUCLE CuotasCli;
     #ascuolin#1;
     ;
     nCliente, nAnyo, 001;
     nCliente, nAnyo, 999;
     ;
     NULL,CuotasCli;
|FIN;

|PROCESO CuotasClientes;
   #ascuocab#0 = nCliente;
   #ascuocab#8 = nAnyo;
   |LEE 000#ascuocab.=;
   |SI FSalida = 0; |Y #ascuocab#3 = aSeccion;
      |BUCLE CuotasCli;
   |FINSI;
|FPRC;

|PROCESO ConceptoFijo;
     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = nLineaFija;
     |LIBERA #4;
     |LEE 140#4=;
     |SI FSalida = 0;
         |ERROR10;
         |ACABA;
     |FINSI;

     |DDEFECTO #4;
     #4#0  = #3#0;
     #4#1  = #3#1;
     #4#2  = nLineaFija;
     #4#3  = 0;
     #4#4  = #11#0;
     #4#5  = #11#1;
     #4#6  = #11#2;
     #4#7  = #11#3;
     #4#8  = #11#4;
     #4#9  = #11#5;
     #4#15 = #0#17;
     #4#16 = 0;

     nFichero  = 4;
     nCliente  = 0;
     aSeccion  = #4#4;
     aConcepto = #4#5;
     |HAZ RecogeTexto;
     |HAZ GrabaTexto;
     |GRABA 140#4n;

     nLineaFija = nLineaFija + 1;

     aAlfa = #4#15; |QBF aAlfa; aAlfa = aAlfa % -104; nAnyo = aAlfa;
     nCliente = #4#1; aSeccion = #4#4; aConcepto = #4#5; |HAZ CuotasClientes;
|FPRC;

|DEFBUCLE asm00001;
     #11#1;
     ;
     "    ", "  ";
     "zzzz", "zz";
     ;
     NULL, ConceptoFijo;
|FIN;

|PROCESO GrabaConta;
     |ABRE #9;
     #9#0 = #4#4;
     #9#1 = #4#5;
     |LEE 040#9=;
     |SI FSalida ! 0; |CIERRA #9; |ACABA; |FINSI;
     |CIERRA #9;

     |ABRE #10;
     |LEE 040#10p;
     |SI FSalida ! 0; |DDEFECTO #10; |FINSI;
     |CIERRA #10;

     aCliente = ("00000" + #4#1) % -105;
     fijo    = #10#3;   |QBF fijo;
     fijo    = fijo + aCliente;
     conver1 = #4#15 % 0102;
     conver2 = #4#15 % 0402;
     conver  = conver1 + conver2;
     c_fecha = conver;
     c_fecha = ("0000" + c_fecha) % -104;

     |ABRE #99;
     #99#0 = #4#0;
     #99#1 = #4#1;
     #99#2 = #4#2;
     |LIBERA #99;
     |LEE 140#99=;
     |SI FSalida = 0;
        #99#3  = #10#1;
        #99#4  = #10#2;
        #99#5  = c_fecha;
        #99#6  = fijo;
        #99#7  = #9#2;
        #99#8  = #9#6;
        #99#9  = #9#3;
        #99#10 = #9#4;
        #99#11 = #4#13;
        #99#12 = #9#5;
        #99#13 = 0;
        #99#14 = "";
        |GRABA 140#99a;
     |SINO;
        |DDEFECTO #99;
        #99#0  = #4#0;
        #99#1  = #4#1;
        #99#1  = #4#2;
        #99#3  = #10#1;
        #99#4  = #10#2;
        #99#5  = c_fecha;
        #99#6  = fijo;
        #99#7  = #9#2;
        #99#8  = #9#6;
        #99#9  = #9#3;
        #99#10 = #9#4;
        #99#11 = #4#13;
        #99#12 = #9#5;
        #99#13 = 0;
        #99#14 = "";
        |GRABA 140#99n;
     |FINSI;
     |CIERRA #99;
|FPRC;

|PROCESO ConverFecha; |TIPO 0;
     conver1 = #0#17 % 0102;
     conver2 = #0#17 % 0402;
     conver  = conver1 + conver2;
|FPRC;

|PROCESO Iva;
     |ABRE #6;
     |LEE 040#6p;
     |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
     |CIERRA #6;

     |ABRE #450;
     #450#0 = #3#0;
     |LEE 000#450=;
     |SI FSalida ! 0; |DDEFECTO #450; |FINSI;
     |CIERRA #450;

     iva = #450#3;
|FPRC;

|PROCESO PasaConceptos;
     |SI #ascontro#10 ! "SI";
         |SI #2#10 = 0;  |ACABA;  |FINSI;
     |FINSI;

     nSwPase = 1;
     |SI #0#6 = "S";
        nSwPase = 0;
        |PARA nCampoPer = 7; |SI nCampoPer [ 16; |HACIENDO nCampoPer = nCampoPer + 1;
              |SI #2#4 = #0nCampoPer;
                  nSwPase = 1;
                  |SAL;
              |FINSI;
        |SIGUE;
     |FINSI;

     |SI nSwPase = 0;  |ACABA;  |FINSI;

     |HAZ MiroBaja;
     |SI nBaja = 1;
         eaCodCli  = ("00000" + #2#0) % -105;
         eaNomCli  = #1000#1;
         enSwLinea = 1; |PRINT;
         nSwPrint = 1;
         |ACABA;
     |FINSI;

     #1#0 = #2#0;
     |LEE 040#1=;
     |SI FSalida ! 0;
         |PINTA 0415, "ATENCION **** Cliente ";
         |PINTA 0437, #1#0;
         |PINTA 0442, " inexistente en fichero !!";
         |AVISO;
         |PAUSA;
         |BLIN 4;
         |ACABA;
     |FINSI;

     |ABRE #7;
     #7#0 = #2#1;
     #7#1 = #2#2;
     |LEE 040#7=;
     |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;
     |CIERRA #7;

     enCodPago = #1#15;
     |HAZ LeeFormaDePago;

     nElTipo = #2#11;
     |SI nElTipo = 0;
         nElTipo = #7#32;
         |SI nElTipo = 0;  nElTipo = #1#68;    |FINSI;
         |SI nElTipo = 0;  nElTipo = #712#35;  |FINSI;
     |FINSI;

     |SI nElTipo < #0#23;  |O nElTipo > #0#24;  |ACABA;  |FINSI;

     #3#0 = nElTipo;
     #3#1 = #1#0;
     |LIBERA #3;
     |LEE 101#3=;
     |SI FSalida ! 0;
         #3#0  = nElTipo;  #3#1  = #1#0;
         #3#2  = #1#1;     #3#3  = #1#2;
         #3#4  = #1#3;     #3#5  = #1#4;
         #3#6  = #1#5;     #3#7  = #1#6;
         #3#8  = #1#7;     #3#9  = #1#8;
         #3#10 = #1#15;    #3#11 = #1#16;
         #3#12 = #1#17;    #3#13 = #1#11;
         #3#14 = #1#12;    #3#15 = #1#13;
         #3#16 = #1#14;    #3#17 = 0;
         #3#18 = 0;        #3#19 = 0;
         #3#20 = #1#23;
         nLinea = 0;

         |SI #6#32 = "S";
             |SI #1#24 ! 0;
                 |ABRE #7;
                 #7#0 = #6#33;
                 #7#1 = #6#34;
                 |LEE 040#7=;
                 |SI FSalida = 0; |Y #7#3 = "A";
                     |ABRE #4;
                     #4#0  = #3#0;
                     #4#1  = #3#1;
                     #4#2  = 5;
                     #4#3  = 0;
                     #4#4  = #7#0;
                     #4#5  = #7#1;
                     #4#6  = #7#2;
                     #4#7  = #7#16;
                     #4#8  = #7#17;
                     #4#9  = #7#18;
                     #4#10 = #7#3;
                     #4#11 = 1;
                     #4#12 = -#1#24;
                     #4#13 = -#1#24;
                     #4#14 = "G";
                     #4#15 = "00.00.0000";
                     #4#16 = 0;

                     nFichero  = 1;
                     nCliente  = 0;
                     aSeccion  = #4#4;
                     aConcepto = #4#5;
                     |HAZ RecogeTexto;
                     |HAZ GrabaTexto;
                     |GRABA 040#4n;
                     |CIERRA #4;
                     |HAZ GrabaConta;
                     aAlfa = #4#15; |QBF aAlfa; aAlfa = aAlfa % -104; nAnyo = aAlfa;
                     nCliente = #4#1; aSeccion = #4#4; aConcepto = #4#5; |HAZ CuotasClientes;

                     #3#19 = #4#13;
                     #3#26 = #3#24 - #3#19 - #3#25;
                     nLinea = 5;
                 |FINSI;
                 |CIERRA #7;
             |FINSI;
         |FINSI;
         |GRABA 020#3b;

         |ABRE #4;
         nLineaFija = 900;
         |BUCLE asm00001;
         |CIERRA #4;
     |SINO;
         nLinea = 0;
         |BUCLELIN 0 Inutil #3;
     |FINSI;
     nLinea = nLinea + 5;

     nSwHay = 0;
     |ABRE #12;
     #12#0 = #2#1;
     #12#1 = #2#2;
     |LEE 040#12=;
     |SI FSalida = 0;  nSwHay = 1;  |FINSI;
     |CIERRA #12;

     |ABRE #4;
     #4#0  = #3#0;     #4#1  = #3#1;
     #4#2  = nLinea;

     |HAZ ConverFecha;  #4#3  = conver;

     #4#4  = #2#1;     #4#5  = #2#2;
     #4#6  = #2#6;     #4#7  = #2#7;
     #4#8  = #2#8;     #4#9  = #2#9;
     #4#10 = #2#3;
     #4#11 = 1;
     |SI #2#5 = "U";  #4#11 = #0#22;  |FINSI;
     |SI nSwHay = 0;
         #4#12 = #2#10;
     |SINO;
         #4#12 = #2#10 - (#2#10 < #12#3);
     |FINSI;

     #4#13 = #4#11 * #4#12;
     #4#14 = #2#5;
     #4#15 = #0#17;

     nFichero  = 2;
     nCliente  = #4#1;

     #5#0 = #2#1;
     #5#1 = #2#2;
     |LEE 040#5=;
     |SI FSalida = 0;
         #4#6 = #5#2;
         #4#7 = #5#2;
         #4#8 = #5#3;
         #4#9 = #5#4;
         nFichero  = 3;
         nCliente  = 0;
     |FINSI;

     |SI #4#10 = "H"; #3#17 = #3#17 + #4#13; |FINSI;
     |SI #4#10 = "S"; #3#18 = #3#18 + #4#13; |FINSI;
     |SI #4#10 = "A"; #3#19 = #3#19 + #4#13; |FINSI;
     |SI #0#19 = "N"; #3#12 = "N";           |FINSI;
     #4#16 = 0;

     aSeccion  = #4#4;
     aConcepto = #4#5;
     |HAZ RecogeTexto;
     |HAZ GrabaTexto;

     |GRABA 020#4n;
     aAlfa = #4#15; |QBF aAlfa; aAlfa = aAlfa % -104; nAnyo = aAlfa;
     nCliente = #4#1; aSeccion = #4#4; aConcepto = #4#5; |HAZ CuotasClientes;

     |SI nSwHay = 1;
         |ABRE #7;
         #7#0 = #12#4;
         #7#1 = #12#5;
         |LEE 040#7=;
         |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;
         |CIERRA #7;

         nLinea = nLinea + 5;
         #4#2  = nLinea;
         #4#4  = #7#0;
         #4#5  = #7#1;
         #4#6  = #7#2;
         #4#7  = #7#16;
         #4#8  = #7#17;
         #4#9  = #7#18;
         #4#10 = #7#3;
         #4#12 = #2#10 - (#2#10 < #12#7);
         #4#13 = #4#11 * #4#12;
         #4#16 = 0;

         nFichero  = 1;
         nCliente  = 0;
         aSeccion  = #4#4;
         aConcepto = #4#5;
         |HAZ RecogeTexto;
         |HAZ GrabaTexto;

         |GRABA 020#4n;
         |LIBERA #4;
         aAlfa = #4#15; |QBF aAlfa; aAlfa = aAlfa % -104; nAnyo = aAlfa;
         nCliente = #4#1; aSeccion = #4#4; aConcepto = #4#5; |HAZ CuotasClientes;

         |SI #4#10 = "H"; #3#17 = #3#17 + #4#13; |FINSI;
         |SI #4#10 = "S"; #3#18 = #3#18 + #4#13; |FINSI;
         |SI #4#10 = "A"; #3#19 = #3#19 + #4#13; |FINSI;
         |SI #0#19 = "N"; #3#12 = "N";           |FINSI;
     |FINSI;

     |CIERRA #4;

     #3#21 = #3#17 % #3#20;
     #3#22 = #3#17 - #3#21;

     |HAZ Iva;

     #3#23 = #3#22 % iva;
     #3#24 = #3#22 + #3#23 + #3#18;
     |SI #3#12 = "S"; #3#25 =  #3#22 % #6#31; |SINO; #3#25 = 0; |FINSI;
     #3#26 = #3#24 - #3#19 - #3#25;

     |GRABA 020#3a;
     |LIBERA #3;
     |HAZ GrabaConta
|FPRC;

|DEFBUCLE asconcli;
     #2#1;
     4;
     #0#0, #0#2, d_c, #0#4;
     #0#1, #0#3, h_c, #0#5;
     ;
     NULL, PasaConceptos;
|FIN;

|PROCESO BuscaCuota;
     aAnyo  = #0#17 % -104;

     |SI #110#5 = 99999;  |ACABA;  |FINSI;

     #112#0 = #110#1;
     #112#8 = aAnyo;
     |LEE 040#112=;
     |SI FSalida ! 0;  |DDEFECTO #112;  |FINSI;

     #111#0 = #110#1;
     #111#9 = aAnyo;
     #111#2 = #110#6;
     #111#3 = #110#7;
     |LEE 101#111=;
     |SI FSalida = 0;
         |SI #111#6 > #111#8;
             nNoSeMinuta = 1;
             #110#20 = #112#3;
             #110#21 = #112#4;
         |SINO;
             enSwLinea = 0; |PRINT;
             nSwPrint = 1;
             #110#20 = #110#6;
             #110#21 = #110#7;
         |FINSI;
         #111#8 = #111#8 + 1;
         |GRABA 020#111a;
         |LIBERA #111;
    |SINO;
         #110#20 = "";
         #110#21 = "";
    |FINSI;
|FPRC;

|PROCESO PasaTrabajos;
     nNoSeMinuta = 0;
     |HAZ BuscaCuota;
     |SI nNoSeMinuta = 1;
         #110#22 = "S";
         |GRABA 020#110a;
         |LIBERA #110;
         |ACABA;
     |FINSI;

     #1#0 = #110#1;
     |LEE 040#1=;
     |SI FSalida ! 0;
         |PINTA 0415, "ATENCION **** Cliente ";
         |PINTA 0437, #1#0;
         |PINTA 0442, " inexistente en fichero !!";
         |AVISO;
         |PAUSA;
         |BLIN 4;
         |ACABA;
     |FINSI;

     nElTipo = #110#23;

     #3#0 = nElTipo;
     #3#1 = #110#1;
     |LIBERA #3;
     |LEE 101#3=;
     |SI FSalida ! 0;
         #3#0  = nElTipo;  #3#1  = #1#0;
         #3#2  = #1#1;     #3#3  = #1#2;
         #3#4  = #1#3;     #3#5  = #1#4;
         #3#6  = #1#5;     #3#7  = #1#6;
         #3#8  = #1#7;     #3#9  = #1#8;
         #3#10 = #1#15;    #3#11 = #1#16;
         #3#12 = #1#17;    #3#13 = #1#11;
         #3#14 = #1#12;    #3#15 = #1#13;
         #3#16 = #1#14;    #3#17 = 0;
         #3#18 = 0;        #3#19 = 0;
         #3#20 = #110#26;    #3#31 = #110#24;
         #3#32 = #110#25;
         nLinea = 0;

         |SI #6#32 = "S";
             |SI #1#24 ! 0;
                 |ABRE #7;
                 #7#0 = #6#33;
                 #7#1 = #6#34;
                 |LEE 040#7=;
                 |SI FSalida = 0; |Y #7#3 = "A";
                     |ABRE #4;
                     #4#0  = #3#0;
                     #4#1  = #3#1;
                     #4#2  = 5;
                     #4#3  = 0;
                     #4#4  = #7#0;
                     #4#5  = #7#1;
                     #4#6  = #7#2;
                     #4#7  = #7#16;
                     #4#8  = #7#17;
                     #4#9  = #7#18;
                     #4#10 = #7#3;
                     #4#11 = 1;
                     #4#12 = -#1#24;
                     #4#13 = -#1#24;
                     #4#14 = "G";
                     #4#15 = "00.00.0000";
                     #4#16 = 0;
                     |GRABA 040#4n;
                     aAlfa = #4#15; |QBF aAlfa; aAlfa = aAlfa % -104; nAnyo = aAlfa;
                     nCliente = #4#1; aSeccion = #4#4; aConcepto = #4#5; |HAZ CuotasClientes;
                     nFichero  = 1;
                     nCliente  = 0;
                     aSeccion  = #4#4;
                     aConcepto = #4#5;
                     |HAZ RecogeTexto;
                     |HAZ GrabaTexto;
                     |CIERRA #4;
                     |HAZ GrabaConta

                     #3#19 = #4#13;
                     #3#26 = #3#24 - #3#19 - #3#25;
                     nLinea = 5;
                 |FINSI;
                 |CIERRA #7;
             |FINSI;
         |FINSI;
         |GRABA 020#3b;

         |ABRE #4;
         nLineaFija = 900;
         |BUCLE asm00001;
         |CIERRA #4;
     |SINO;
         nLinea = 0;
         |BUCLELIN 0 Inutil #3;
     |FINSI;

     nLinea = nLinea + 5;

     nSwHay = 0;
     |ABRE #12;
     #12#0 = #110#6;
     #12#1 = #110#7;
     |LEE 040#12=;
     |SI FSalida = 0;  nSwHay = 1;  |FINSI;
     |CIERRA #12;

     |ABRE #7;
     #7#0 = #110#6;
     #7#1 = #110#7;
     |LEE 040#7=;
     |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;
     |CIERRA #7;

     |ABRE #4;
     #4#0  = #3#0;     #4#1  = #3#1;
     #4#2  = nLinea;

     |HAZ ConverFecha;  #4#3  = conver;

     #4#4  = #110#6;   #4#5  = #110#7;
     |HAZ GrabaTexto1;

     #4#10 = #7#3;
     #4#11 = #110#16;
     |SI nSwHay = 0;
         #4#12 = #110#17;
     |SINO;
         #4#12 = #110#17 - (#110#17 < #12#3);
     |FINSI;

     #4#13 = #4#11 * #4#12;
     #4#14 = "G";
     #4#15 = #0#17;

     |SI #4#10 = "H"; #3#17 = #3#17 + #4#13; |FINSI;
     |SI #4#10 = "S"; #3#18 = #3#18 + #4#13; |FINSI;
     |SI #4#10 = "A"; #3#19 = #3#19 + #4#13; |FINSI;
     |SI #0#19 = "N"; #3#12 = "N";           |FINSI;
     #4#16 = #110#0;
     #4#17 = #110#4;

     |GRABA 020#4n;
     aAlfa = #4#15; |QBF aAlfa; aAlfa = aAlfa % -104; nAnyo = aAlfa;
     nCliente = #4#1; aSeccion = #4#4; aConcepto = #4#5; |HAZ CuotasClientes;

     |SI nSwHay = 1;
         |ABRE #7;
         #7#0 = #12#4;
         #7#1 = #12#5;
         |LEE 040#7=;
         |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;
         |CIERRA #7;

         nLinea = nLinea + 5;
         #4#2  = nLinea;
         #4#4  = #7#0;
         #4#5  = #7#1;
         #4#6  = #7#2;
         #4#7  = #7#16;
         #4#8  = #7#17;
         #4#9  = #7#18;
         #4#10 = #7#3;
         #4#12 = #110#17 - (#110#17 < #12#7);
         #4#13 = #4#11 * #4#12;
         #4#16 = 0;
         nFichero  = 1;
         nCliente  = 0;
         aSeccion  = #4#4;
         aConcepto = #4#5;
         |HAZ RecogeTexto;
         |HAZ GrabaTexto;

         |GRABA 020#4n;
         |LIBERA #4;
         aAlfa = #4#15; |QBF aAlfa; aAlfa = aAlfa % -104; nAnyo = aAlfa;
         nCliente = #4#1; aSeccion = #4#4; aConcepto = #4#5; |HAZ CuotasClientes;

         |SI #4#10 = "H"; #3#17 = #3#17 + #4#13; |FINSI;
         |SI #4#10 = "S"; #3#18 = #3#18 + #4#13; |FINSI;
         |SI #4#10 = "A"; #3#19 = #3#19 + #4#13; |FINSI;
         |SI #0#19 = "N"; #3#12 = "N";           |FINSI;
     |FINSI;

     |CIERRA #4;

     #3#21 = #3#17 % #3#20;
     #3#22 = #3#17 - #3#21;

     |HAZ Iva;

     #3#23 = #3#22 % iva;
     #3#24 = #3#22 + #3#23 + #3#18;
     |SI #3#12 = "S"; #3#25 =  #3#22 % #6#31; |SINO; #3#25 = 0; |FINSI;
     #3#26 = #3#24 - #3#19 - #3#25;

     |GRABA 020#3a;
     |LIBERA #3;
     |HAZ GrabaConta

     #110#22 = "S";
     |GRABA 020#110a;
     |LIBERA #110;
|FPRC;

|DEFBUCLE abom0010;
     #110#2;
     6, 22, 23;
     "S", #0#0, "01.01.0000", nDConta, #0#2, "N", #0#23;
     "S", #0#1, "31.12.2999", nHConta, #0#3, "N", #0#24;
     be;
     NULL, PasaTrabajos;
|FIN;

|PROCESO Tipo12;  |TIPO 12;
     |SI #0#20 ! "SI";  |ACABA;  |FINSI;

     |SI EURODB = 0;
         |CONFI "     Empresa en Pesetas, Desea Continuar ";
         |SI FSalida ! 0;  |ACABA;  |FINSI;
     |FINSI;

     nSwIntegra = 0;
     |HAZ BusquedaApli;
     |SI eaPathIntegral ! "";
         |HAZ ChequeaEmpresas;

         |DBASS aBase;  |QBT aBase;
         aPath = aBase + "facturar/fich/" + (("00" + #48#0) % -102) + "/";

         |PATH_DAT #7 aPath;
         |PATH_DAT #2 aPath;
         |PATH_DAT #1 aPath;
         |HAZ MiraIntegra;
     |FINSI;

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "aspasecc";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |ABRE #6;
     |LEE 040#6p;
     |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
     |CIERRA #6;

     nParrilla = #0#0;

     |ABRE #1;
     |ABRE #3;
     |ABRE #5;
     |ABRE #ascuocab;
     |ABRE #ascuolin;
     |ABRE #asm00013;
     |SI #0#25 = "A";  |O #0#25 = "C";
         |SI nParrilla ! 0;
             |BUCLE asconcli;
         |SINO;
             |PARA nCampo = 28;  |SI nCampo [ 43;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo ! 0;
                       #0#0 = #0nCampo;
                       #0#1 = #0nCampo;
                       |BUCLE asconcli;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;

     |ABRE #112;
     |ABRE #111;
     |SELECT #2#111;
     |SI #0#25 = "A";  |O #0#25 = "T";
         |SI nParrilla ! 0;
             |BUCLE abom0010;
         |SINO;
             |PARA nCampo = 28;  |SI nCampo [ 43;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo ! 0;
                       #0#0 = #0nCampo;
                       #0#1 = #0nCampo;
                       |BUCLE abom0010;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;

     |LIBERA #1;
     |LIBERA #3;
     |LIBERA #5;
     |CIERRA #1;
     |CIERRA #ascuocab;
     |CIERRA #ascuolin;
     |CIERRA #asm00013;
     |CIERRA #3;
     |CIERRA #5;
     |CIERRA #111;
     |CIERRA #112;

     |SI nSwPrint = 1;  |PIEINF;  |FINSI;
     |FININF;
     |FINIMP;
|FPRC;

|PROGRAMA;
     aParametro = PARAMETRO;

     |ABRET #0;
     |LEE 000#0p;
     |SI FSalida = 0;
         fFecha = ~;
         |SI fFecha ! #0#45;
             |BORRA 020#0a;
             |LIBERA #0;
         |SINO;
             aAlfa = "0000Usuario " + #0#44; |QBF aAlfa;
             aAlfa = aAlfa + " dia " + #0#45 + " a las " + #0#46;
             aAlfa = aAlfa + ". Esta minutando o se le ha quedado bloqueada la tarea. ";
             |MENAV aAlfa;

             aAlfa = "0000NQuiere facturar usted porque se le ha bloqueado la tarea al usuario " + #0#44;
             |CONFI aAlfa;
             |SI FSalida = 0;
                 |CONFI "0000NPuede duplicar la facturacion, asegurese de que no esta facturando. Esta seguro.";
                 |SI FSalida = 0;
                     |BORRA 020#0a;
                     |LIBERA #0;
                 |SINO;
                     |CIERRAT #0;
                     |ACABA;
                 |FINSI;
             |SINO;
                 |CIERRAT #0;
                 |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     |HORA aHora;

     |DDEFECTO #0;
     #0#44 = Usuario % 810;
     #0#45 = ~;
     #0#46 = aHora;
     |GRABA 020#0n;
     |LIBERA #0;
     |CIERRAT #0;

     |SI aParametro = "";
         nDConta = 0;
         nHConta = 99999;
         |CLS;
         |PINPA #0#0;
         |PINDA #0#0;
         |ENDATOS #1#0;
     |FINSI;

     |SI aParametro = "1";
         #0#0  = enCliente;
         #0#1  = enCliente;
         #0#2  = "    ";
         #0#3  = "zzzz";
         #0#4  = 00;
         #0#5  = 99;
         #0#6  = "N";
         #0#17 = efFecha;
         #0#19 = eaRetencion;
         #0#20 = "SI";
         #0#23 = 0;
         #0#24 = 9;
         #0#25 = "T";
         nDConta = enContador;
         nHConta = enContador;

         |HAZ Tipo12;
     |FINSI;

     |DELINDEX #0;
|FPRO;

|PROCESO MiraIntegra;
     |DFICE aAlfa;  |QBF aAlfa;
     aAlfa = aAlfa % -202;

     |ABRE #30;
     #30#0 = aAlfa;
     |LEE 040#30=;
     |SI FSalida ! 0;  |DDEFECTO #30;  |FINSI;
     |CIERRA #30;
     |SI #30#3 = "S"; nSwIntegra = 1; |FINSI;
|FPRC;


|PROCESO MiroBaja;
  nBaja = 0;
  |SI nSwIntegra = 1;
      |ABRE #1000;
      #1000#0 = #2#0;
      |LEE 001#1000=;
      |SI FSalida = 0;
          |SI #1000#85 = "I";  nBaja = 1;  |FINSI;
      |FINSI;
      aNombre = #1000#1;
      |CIERRA #1000;
  |SINO;
      |DDEFECTO #1;
      #1#0 = #2#0;
      |LEE 040#1=;
      |SI #1#66 > "01.01.1900"; nBaja = 1; |FINSI;
      aNombre = #1#2;
  |FINSI;

  |SI nBaja = 1;
      nBaja = 0;
      |SI #0#27 = "S";  nBaja = 1;  |FINSI;
      |SI #0#27 = "P";
          aAlfa = "0000NCliente: " + (("00000" + #2#0) % -105) + " " + aNombre;  |QBF aAlfa;
          aAlfa = aAlfa + " esta INACTIVO. Lo facturamos.";
          |CONFI aAlfa;
          |SI FSalida ! 0;  nBaja = 1;  |FINSI;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO MensaCliente; |TIPO 7;
     |MENSA "      <F2> Consulta Clientes ";
|FPRC;

|PROCESO ConsuCliente; |TIPO 0;

     |ATRI R; |BLIN 04; |ATRI 0;
     |SI FSalida ! 10; |ACABA; |FINSI;

     |PUSHV 0501 2380;
     nCampoCliente  = Campo;
     |SI FSalida = 10;
         |ABRE #1001;
         #1001#0 = #0nCampoCliente;
         |LEE 040#1001=;

         |CONSULTA_CLAVE #2#1001;
         |CIERRA #1001;
         #0nCampoCliente = #1001#0;
     |FINSI;

     |POPV;
     |PINTA #0nCampoCliente;
|FPRC;

|CALCULO Parrilla; |TIPO 0;
     |SI #0#0 = 0;
         #0#0 = 0;  |PINTA #0#0;
         #0#1 = 0;  |PINTA #0#1;  |C_M #0#1, 1, "N";
         |PARA nCampo = 28;  |SI nCampo [ 43;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |C_M #0#1, 1, "S";
         |PARA nCampo = 28;  |SI nCampo [ 43;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO NoMasEmpresas; |TIPO 0;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 43;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 43;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;
