|FICHEROS;
     abom0001 #1;
     abom0002 #2;
     abom0514 #514;
     abow0003 #99;
     abow0015 #98,MANTE;
     abow0020 #920,MANTE;
     abow0021 #921;
     reflejo@ #1000;
|FIN;

|VARIABLES;
     aHora           = "";
     aAlfa           = "";
     aEjecuta        = "";
     aFicheroOrigen  = "";
     aFicheroDestino = "";
     aOrigen         = "";
     aDestino        = "";
     aCodExp         = "";
     aCodLin         = "";
     aNombreFich     = "";
     aCadena         = "";
     aCadena1        = "";
     aCadena2        = "";
     aFichero        = "";
     aTipoScaneo     = "";
     aTipoScaneoT    = "";
     aFicheroActu    = "";
     aPathPlan       = "";
     aBase           = "";
     aMas            = "";
     aFichEscan      = "";
     aBaseLocal        = "";
     aVersion1         = "";
     aVersion2         = "";
     aIPRemoto         = "";


     nTipoScaneoT    = 0;

     ExpAnt          = 0;
     LinAnt          = 0;
     nLinea          = 0;
     nExpediente     = 0;
     nAsignado       = 0;
     nSwGraba        = 0;
     nSwAborto       = 0;
     nSwVal          = 0;
     nCanal          = 0;
     nTecla          = 0;
     nTipo           = 0;
     nModo           = 0;
     nPregunta       = 0;
     nSwEdita        = 0;
     nErrorCampo     = 0;
     nGrabaFecha     = 0;
     nContaDocu      = 0;

     {1}aContiene      = "";
     {1}aLocal         = "";


     &eaFicheroRecog = "";

     &enFSalida        = 0;
     &efFechaDocu      = @;
     &enCodUbica       = 0;
     &enTipoDocumento  = 0;
     &eaRutaDocumento  = "";
     &eaNombrePrograma = "";
     &eaNombreRuta     = "";
     &eaRutaPlanilla   = "";
     &eaExtension      = "";
     &eaFicheroEdita   = "";
     &eaPiePagina      = "";
     &enSwPlanilla     = 0;
     &enExped          = 0;
     &eaFichAdjunto    = "";
     &enBoton2         = 0;
     &enBoton3         = 0;
     &enBoton4         = 0;
     &eaOrigen         = "";
     &eaDestino        = "";
     &eaUnidadBasico   = "";
|FIN;

|PROCESO PonFechaAlta;
     |SI nGrabaFecha = 0; |ACABA;  |FINSI;

     |HORA aHora;
     aAlfa = aHora % 102;  #2#5 = aAlfa;
     aAlfa = aHora % 402;  #2#6 = aAlfa;
|FPRC;

|PROCESO GrabaTemporal;
     #98#0 = #2#3;
     |LEE 000#98=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #98#0 = #2#3;
     #98#1 = #2#2;
     #98#2 = #2#4;
     |GRABA 020#98n;
     |LIBERA #98;
     nSwGraba = 1;
|FPRC;

|PROCESO LeeDocumento;
     nSwVal  = 0;
     aCodExp = aNombreFich % 208;
     aCodLin = aNombreFich % 1003;
     |SALVA_FICHA #2;

     #2#0 = aCodExp;
     #2#1 = aCodLin;
     |SI #2#0 = 0;  |Y #2#1 = 0;
         |REPON_FICHA #2;
         |ACABA;
     |FINSI;

     |LEE 040#2=;
     |SI FSalida = 0;
         |SI #99#2 = 1;
             nSwVal = 1;
         |SINO;
             aCadena = #99#3;  |QBF aCadena;
             |SI aCadena = "";
                 |HAZ GrabaTemporal;
             |SINO;
                 aCadena1 = #2#2 > " ";  |QBF aCadena1;
                 aCadena2 = #99#3 > " ";  |QBF aCadena2;

                 aCadena = aCadena1 - aCadena2;
                 |SI aCadena ! aCadena1;
                     |HAZ GrabaTemporal;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |REPON_FICHA #2;
|FPRC;

|RUTINA ClaveBaja98;
     #98#0 = " " * 30;
|FRUT;

|RUTINA ClaveAlta98;
     #98#0 = "z" * 30;
|FRUT;

|PROCESO GrabaTempo;
     |SI #1000#0 = #2#0;  |Y #1000#1 = #2#1;
         |ACABA;
     |FINSI;

     aCadena = #99#3;  |QBF aCadena;
     |SI aCadena ! "";
         aCadena1 = #1000#2  > " ";  |QBF aCadena1;
         aCadena2 = #99#3    > " ";  |QBF aCadena2;

         aCadena = aCadena1 - aCadena2;
         |SI aCadena = aCadena1;  |ACABA;  |FINSI;
     |FINSI;

     #98#0 = #1000#3;
     |LEE 000#98=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #98#0 = #1000#3;
     #98#1 = #1000#2;
     #98#2 = #1000#4;
     |GRABA 020#98n;
     |LIBERA #98;
     nSwGraba = 1;
|FPRC;

|DEFBUCLE reflejo;
     #1000#2003;
     ;
     #99#4, 00000000, 00001;
     #99#4, 99999999, 99999;
     ;
     NULL, GrabaTempo;
|FIN;

|PROCESO RecogeDeOtro;
     efFechaDocu = "00.00.0000";
     enCodUbica  = #99#4;  |HAZ LeeUbicaciones;
     nSwGraba    = 0;

     aFichero = ("a5" + Usuario + "zzzzzzzz") % 108;  |NOME_DAT #98 aFichero;
     |ABRE #98;  |CIERRA #98;  |DELINDEX #98;

     aOrigen = eaRutaDocumento; |QBF aOrigen;
     aOrigen = aOrigen + "/";   |QBF aOrigen;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/abom0002.mas";
     |CARGA_DEF aMas, reflejo@;
     |SI FSalida ! 0;
         |MENAV "      Error en Cargar el Def";
         |ACABA;
     |FINSI;

     |ABRE #98;
     |BUCLE reflejo;
     |CIERRA #98;

     |DESCARGA_DEF #reflejo@;

     nSwAborto = 1;
     |SI nSwGraba = 1;
         |HAZ PonFechaAlta;
         |PUSHV 0501 2380;
         eaFicheroRecog = "";
         enSwPlanilla   = 0;
         |ENTLINEAL #1#98, -1, 4, 22, 1, ClaveBaja98, ClaveAlta98;
         |POPV;

         |SI eaFicheroRecog ! "";
             ||enfFechaDocu ya viene cargada del Entlineal
             enCodUbica      = #99#4;  |HAZ LeeUbicaciones;
             aFicheroOrigen  = eaRutaDocumento + "/" + eaFicheroRecog;
             aFicheroDestino = aFicheroActu;

             |SI #514#21 ! "C";
                 |RCOPIA_FICHERO aFicheroOrigen, aFicheroDestino;
             |SINO;
                 |COPIA_FICHERO aFicheroOrigen, aFicheroDestino;
             |FINSI;

             |SI FSalida ! 0;
                 |MENAV "         Ha habido un error al copiar el Documento.";
             |SINO;
                 nSwAborto = 0;
                 |HAZ PonFechaAlta;
             |FINSI;
         |FINSI;
     |SINO;
         |MENAV "      Seleccion Vacia.";
     |FINSI;

     |DELINDEX #98;
|FPRC;

|PROCESO MiraDocu0;
     aCadena = #99#3;  |QBF aCadena;
     |SI aCadena = "";
         |HAZ GrabaTemporal;
     |SINO;
         aCadena1 = #2#2  > " ";  |QBF aCadena1;
         aCadena2 = #99#3 > " ";  |QBF aCadena2;

         aCadena = aCadena1 - aCadena2;
         |SI aCadena ! aCadena1;
             |HAZ GrabaTemporal;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE abom0002;
     #2#1;
     10;
     00000000, 00000, nTipo;
     00000000, 99999, nTipo;
     ;
     NULL, MiraDocu0;
|FIN;

|PROCESO RecogeDocuGeneral;
     aFichero = ("a5" + Usuario + "zzzzzzzz") % 108;  |NOME_DAT #98 aFichero;
     |ABRE #98;  |CIERRA #98;  |DELINDEX #98;

     |SALVA_FICHA #2;

     |ABRE #98;
     nTipo    = #99#0;
     nSwGraba = 0;
     |BUCLE abom0002;
     |REPON_FICHA #2;

     nSwAborto = 1;
     |SI nSwGraba = 1;
         |PUSHV 0501 2380;
         eaFicheroRecog = "";
         enSwPlanilla   = 0;
         |ENTLINEAL #1#98, -1, 4, 22, 1, ClaveBaja98, ClaveAlta98;
         |POPV;

         |SI eaFicheroRecog ! "";
             ||enfFechaDocu ya viene cargada del Entlineal
             enCodUbica      = #99#0;   |HAZ LeeUbicaciones;
             aFicheroOrigen  = eaRutaDocumento + "/" + eaFicheroRecog;
             aFicheroDestino = aFicheroActu;

             |SI #514#21 ! "C";
                 |RCOPIA_FICHERO aFicheroOrigen, aFicheroDestino;
             |SINO;
                 |COPIA_FICHERO aFicheroOrigen, aFicheroDestino;
             |FINSI;

             |SI FSalida ! 0;
                 |MENAV "         Ha habido un error al copiar el Documento.";
             |SINO;
                 nSwAborto = 0;
                 |HAZ PonFechaAlta;
             |FINSI;
         |FINSI;
     |SINO;
         |MENAV "      Seleccion Vacia.";
     |FINSI;

     |DELINDEX #98;

     |SI nSwAborto = 0;
         |CONFI "2400SBorro el Documento de la Entrada General : ";
         |SI FSalida = 0;
             |SALVA_FICHA #2;
             aCodExp = eaFicheroRecog % 208;
             aCodLin = eaFicheroRecog % 1003;
             #2#0 = aCodExp;
             #2#1 = aCodLin;
             |LEE 101#2=;
             |SI FSalida = 0;
                 |BORRA 020#2a;
                 |LIBERA #2;
                 aFicheroOrigen  = eaRutaDocumento + "/" + eaFicheroRecog;
                 |SI #514#21 ! "C";
                     |RFBORRA aFicheroOrigen;
                 |SINO;
                     |FBORRA aFicheroOrigen;
                 |FINSI;
             |FINSI;
             |REPON_FICHA #2;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO RecogePlanillas;
     nSwGraba   = 0;
     nContaDocu = 0;

     aFichero = ("a5" + Usuario + "zzzzzzzz") % 108;  |NOME_DAT #98 aFichero;
     |ABRE #98;  |CIERRA #98;  |DELINDEX #98;

     |ABRE #98;

     |SI #514#21 ! "C";
         aPathPlan = #99#6;   |QBF aPathPlan;
         |SI #99#4 = 0;
             aPathPlan = aPathPlan - "\*" + "/";
         |SINO;
             aPathPlan = aPathPlan + "/";
         |FINSI;

         aOrigen   = aPathPlan;

         |R_PDIR aOrigen;
         |PARA; |SI FSalida = 0; |HACIENDO;
                aCadena1 = aOrigen     > " ";
                aCadena2 = eaExtension > " ";
                aCadena2 = "." + aCadena2;
                aDestino = aCadena1 - aCadena2;
                |SI aDestino ! aCadena1;
                    aCadena1    = aOrigen    > " ";
                    aCadena2    = aPathPlan  > " ";  |QBF aCadena2
                    aNombreFich = aCadena1 - aCadena2;
                    |HAZ LeeDocumento;
                    |SI nSwVal = 0;
                        #98#0 = aNombreFich;
                        |LEE 000#98=;
                        |SI FSalida ! 0;
                            nContaDocu = nContaDocu + 1;

                            #98#0 = aNombreFich;
                            #98#1 = aNombreFich;
                            #98#2 = #2#4;
                            |GRABA 020#98n;
                            |LIBERA #98;
                        |FINSI;
                        nSwGraba = 1;
                    |FINSI;
                |FINSI;

                |R_SDIR aOrigen;
         |SIGUE;
         |CIERRA #98;
     |SINO;
         aPathPlan = #99#6;   |QBF aPathPlan;
         |SI #99#4 = 0;
             aPathPlan = aPathPlan - "/*" + "/";
         |SINO;
             aPathPlan = aPathPlan + "/";
         |FINSI;

         aOrigen   = aPathPlan + "*." + (eaExtension < "");

         |_PDIR aOrigen;
         |PARA; |SI FSalida = 0; |HACIENDO;
                aNombreFich = aOrigen - aPathPlan;
                |HAZ LeeDocumento;
                |SI nSwVal = 0;
                    #98#0 = aNombreFich;
                    |LEE 000#98=;
                    |SI FSalida ! 0;
                        nContaDocu = nContaDocu + 1;

                        #98#0 = aNombreFich;
                        #98#1 = aNombreFich;
                        #98#2 = #2#4;
                        |GRABA 020#98n;
                        |LIBERA #98;
                     |FINSI;
                     nSwGraba = 1;
                 |FINSI;
                 |_SDIR aOrigen;
         |SIGUE;
         |CIERRA #98;
     |FINSI;

     nSwAborto = 1;
     |SI nSwGraba = 1;
         |SI nContaDocu > 1;
             |PUSHV 0501 2380;
             eaFicheroRecog = "";
             enSwPlanilla   = 1;
             |ENTLINEAL #1#98, -1, 4, 22, 1, ClaveBaja98, ClaveAlta98;
             |POPV;
         |SINO;
             |SI enSwPlanilla = 0;  eaFicheroRecog = #98#0;  |FINSI;
             |SI enSwPlanilla = 1;  eaFicheroRecog = #98#1;  |FINSI;

             efFechaDocu    = #98#2;

             |QBF eaFicheroRecog;
         |FINSI;

         |SI eaFicheroRecog ! "";
             aFicheroOrigen  = aPathPlan + eaFicheroRecog;
             aFicheroDestino = aFicheroActu;
             |SI #514#21 ! "C";
                 |RCOPIA_FICHERO aFicheroOrigen, aFicheroDestino;
             |SINO;
                 |COPIA_FICHERO aFicheroOrigen, aFicheroDestino;
             |FINSI;

             |SI FSalida ! 0;
                 |MENAV "         Ha habido un error al copiar el Documento.";
             |SINO;
                 nSwAborto = 0;
                 |HAZ PonFechaAlta;
             |FINSI;
         |FINSI;
     |SINO;
         |MENAV "      Seleccion Vacia.";
     |FINSI;

     |DELINDEX #98;
|FPRC;

|PROCESO TrataDocumentos;
     |SI #99#2 = 1;
         |SI #99#4 = 0;
             aFicheroOrigen  = #99#6;  |QBF aFicheroOrigen;
             aAlfa = aFicheroOrigen % -101;
             |SI aAlfa ! "*";
                 |SI aFicheroOrigen ! "";
                     aFicheroDestino = aFicheroActu;
                     |SI #514#21 ! "C";
                         |RCOPIA_FICHERO aFicheroOrigen, aFicheroDestino;
                     |SINO;
                         |COPIA_FICHERO aFicheroOrigen, aFicheroDestino;
                     |FINSI;
                     |SI FSalida ! 0;
                         |MENAV "         Ha habido un error al copiar la Plantilla.";
                         nSwAborto = 1;
                         |ACABA;
                     |FINSI;
                 |FINSI;
                 |HAZ PonFechaAlta;
             |SINO;
                 |HAZ RecogePlanillas;
             |FINSI;
         |SINO;
             aFicheroOrigen  = #99#6;  |QBF aFicheroOrigen;
             |HAZ RecogePlanillas;
         |FINSI;
     |FINSI;

     |SI #99#2 = 2;   |HAZ RecogeDeOtro;        |FINSI;
     |SI #99#2 = 3;   |HAZ RecogeDocuGeneral;   |FINSI;
|FPRC;

|PROCESO CogeDocumento;
     |ABRE #abom0001;
     |SELECT #7#abom0001;

     nTipoScaneoT = aTipoScaneoT;
     aTipoScaneoT = nTipoScaneoT;

     #abom0001#38 = aTipoScaneoT;
     |LEE 000#abom0001.=;
     |SI FSalida = 0;
         nAsignado   = 1;
         nExpediente = #abom0001#0;
         ExpAnt      = #abom0002#0;
         LinAnt      = #abom0002#1;
         |LIBERA #abom0002;

         #abom0002#0 = #abom0001#0;
         #abom0002#1 = 99999;
         |LEE 000#abom0002.];
         |SI FSalida = 0;
             |LEE 000#abom0002.a;
         |SINO;
             |LEE 000#abom0002.u;
         |FINSI;

         |SI FSalida = 0; |Y #abom0002#0 = #abom0001#0;
             nLinea = #abom0002#1 + 1;
         |SINO;
             nLinea = 1;
         |FINSI;

         #abom0002#0 = ExpAnt;
         #abom0002#1 = LinAnt;
         |LEE 000#abom0002.=;
         |SELECT #1#abom0001;
         |CIERRA #abom0001;
     |FINSI;
|FPRC;

|PROCESO ActDllTwain;
     |ESPECIFICA "RBASS", aLocal;
     aBaseLocal = aLocal;

     eaDestino   = aBaseLocal + "bin/dstwain.dll";
     aContiene1 = eaDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aVersion1  = FSalida;  |QBF aVersion1;

     |DBASE aBase;  |QBF aBase;
     eaOrigen    = aBase + "plantillas/dstwain.dll";
     aContiene1 = eaOrigen;
     |ESPECIFICA "MD5", aContiene;
     aVersion2  = FSalida;  |QBF aVersion2;

     |SI aVersion1 ! aVersion2;
         aIPRemoto = "";
         |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaOrigen, eaDestino;
         |SINO;
             |COPIA_FICHERO eaOrigen, eaDestino;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Imagenes;
     |HAZ ActDllTwain;

     nAsignado = 0;
     nPregunta = 0;
     aTipoScaneo = "[SCANUI]";
     |CONFI "2400SDesea Configurar el Documento.";
     |SI FSalida ! 0;  nPregunta = 1;  aTipoScaneo = "[SCAN]";  |FINSI;

     |ET ArribaE;
         aTipoScaneoT = aTipoScaneo;
         nSwAborto = 1;
         |CARGADLL "dstwain.dll";
         |SI FSalida < 0;
             |MENAV "     No encuentro el driver : dstwain.dll";
             |ACABA;
         |FINSI;

         |ALFACALLDLL "dstwain.dll","DsTwainEntry", aTipoScaneoT;
         |SI FSalida < 0;
             |MENAV "     No encuentro el SCANNER";
             |ACABA;
         |FINSI;

         |SI aTipoScaneoT = "OK";
             aTipoScaneoT = "[BARRAS:]";
             |ALFACALLDLL "dstwain.dll","DsTwainEntry", aTipoScaneoT;
             |SI aTipoScaneoT ! "";
                aTipoScaneoT = aTipoScaneoT % 0112;

                |HAZ CogeDocumento;
             |FINSI;

             aFichEscan = aFicheroActu;
             |SI #514#21 = "C";
                 aFichEscan = eaUnidadBasico + "\DOCUMENTOS";            |RMKDIR aFichEscan;
                 aFichEscan = eaUnidadBasico + "\DOCUMENTOS\IPABOGAD";   |RMKDIR aFichEscan;
                 aFichEscan = eaUnidadBasico + "\DOCUMENTOS\IPABOGAD\" + eaFicheroEdita;
             |FINSI;

             aAlfa = "[SAVE:" + aFichEscan; |QBF aAlfa;
             |ALFACALLDLL "dstwain.dll", "DsTwainEntry", aAlfa;
             nSwAborto = 0;

             |SI #514#21 = "C";
                 aOrigen  = aFichEscan;
                 aDestino = aFicheroActu;
                 |RECIBE_FICHERO aOrigen, aDestino;

                 |RFBORRA aOrigen;
             |FINSI;
         |FINSI;

         |DESCARGADLL "dstwain.dll";

         |CONFI "2400SDesea otra hoja : ";
         |SI FSalida = 0;  |VETE ArribaE;  |FINSI;

         |SI nSwAborto = 1;  |ACABA;  |FINSI;

         |HAZ PonFechaAlta;

         |SI nAsignado = 1;
             ExpAnt = #abom0002#0;
             LinAnt = #abom0002#1;
             |LIBERA #abom0002;

             #abom0002#0 = nExpediente;
             #abom0002#1 = nLinea;
             |HORA aHora;
             aAlfa = aHora % 102;  #2#8 = aAlfa;
             aAlfa = aHora % 402;  #2#9 = aAlfa;
             aAlfa = "w";
             |SI eaExtension ! "doc";
                 |SI eaExtension = "xls";  aAlfa = "e";  |FINSI;
                 |SI eaExtension = "tif";  aAlfa = "g";  |FINSI;
             |FINSI;
             |SI #2#1 [ 999;
                 #2#3 = aAlfa + (("00000000" + #2#0) % -108) + (("000" + #2#1) % -103) + "." + eaExtension;
             |SINO;
                 #2#3 = aAlfa + (("00000000" + #2#0) % -108) + (("00000" + #2#1) % -105) + "." + eaExtension;
             |FINSI;
             #2#10 = #99#0;
             |GRABA 020#abom0002.n;
             |LIBERA #abom0002;
             aDestino = eaRutaDocumento + "/" + #2#3;  |QBF aDestino;

             #abom0002#0 = ExpAnt;
             #abom0002#1 = LinAnt;
             |LEE 101#abom0002.=;
             |SI FSalida = 0;
                 aOrigen = eaRutaDocumento + "/" + #2#3;  |QBF aOrigen;
                 |BORRA 020#abom0002.a;
                 |LIBERA #abom0002;

                 #abom0002#0 = nExpediente;
                 #abom0002#1 = nLinea;
                 |LEE 000#abom0002.=;
                 |PONCONTROL 23, "si";
                 nSwEdita = 1;

                 |RRENOMBRA_FICHERO aOrigen, aDestino;

                 |ACABA;
             |FINSI;
         |FINSI;

         |SI nPregunta = 0;
             |CONFI "2400SDesea editar el Documento ";
             |SI FSalida ! 0; nSwEdita = 1; |ACABA; |FINSI;
         |FINSI;
|FPRC;

|PROCESO EnviaCorreo;
     efFechaDocu    = #2#4;
     enCodUbica     = #2#10;  |HAZ LeeUbicaciones;
     eaFicheroEdita = #2#3;   |QBF eaFicheroEdita;
     eaFichAdjunto  = eaRutaDocumento + "/" + eaFicheroEdita;

     |PUSHV 0501 2380;
     |DDEFECTO #920;
     #920#4 = eaFichAdjunto;
     |C_M #920#4, 1, "N";
     |PINPA #0#920;
     |PINDA #0#920;
     |ENDATOS #1#920;
     |POPV;
|FPRC;

|RUTINA ClaveBaja1000N;
     #1000#0  = enExped;
     #1000#2  = "";
|FRUT;

|RUTINA ClaveAlta1000N;
     #1000#0  = enExped;
     aAlfa   = "z" * 60;
     #1000#2  = aAlfa;
|FRUT;

|PROCESO ConsultaNombre;
     |DBASE aBase;  |QBF aBase;
     |SI enExped = 0;
         aMas = aBase + "def/abor0002.mas";
     |SINO;
         aMas = aBase + "def/abom0002.mas";
     |FINSI;
     |CARGA_DEF aMas, reflejo@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def abom0002.mas";
         |MENAV aAlfa;
         |ERROR;
     |FINSI;

     |PUSHV 0501 2380;
     |ATRI P;
     |SI enExped = 0;
         |PINTA 0610, "MODO CONSULTA";
         |PINTA 0625, "ORDENADO POR NOMBRE";
     |SINO;
         |PINTA 0510, "MODO CONSULTA";
         |PINTA 0525, "ORDENADO POR NOMBRE";
     |FINSI;
     |MENSA "      Elija una Documento y pulse Esc";
     |ATRI p;

     |ENTLINEAL #3#1000, -2, 4, 22, 0, ClaveBaja1000N, ClaveAlta1000N;
     |POPV;

     #2#1 = #1000#1;
     |PONCONTROL 23, "SI";
     |PTEC 809;

     |DESCARGA_DEF #reflejo@;

     |ERROR;
|FPRC;

|PROCESO EditaDocumento;  |TIPO 11;
     nTecla = FSalida;
     |SI nTecla ! 10; |Y nTecla ! 11;  |Y nTecla ! 12;  |ACABA;  |FINSI;

     aAlfa       = #2#3;  |QBF aAlfa;
     |SI aAlfa   = "";    |ACABA;   |FINSI;

     |SI nTecla = 11;
         |HAZ ConsultaNombre;
         |ACABA;
     |FINSI;

     |SI nTecla = 12;
         |ESTADO_CONTROL enBoton2, "HIDE";
         |ESTADO_CONTROL enBoton3, "HIDE";
         |ESTADO_CONTROL enBoton4, "HIDE";
         |HAZ EnviaCorreo;
         |ESTADO_CONTROL enBoton2, "SHOW";
         |ESTADO_CONTROL enBoton3, "SHOW";
         |ESTADO_CONTROL enBoton4, "SHOW";
         |ERROR;
         |ACABA;
     |FINSI;

     |LIBERA #2;
     |LEE 101#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ESTADO_CONTROL enBoton2, "HIDE";
     |ESTADO_CONTROL enBoton3, "HIDE";
     |ESTADO_CONTROL enBoton4, "HIDE";

     efFechaDocu    = #2#4;
     enCodUbica     = #2#10;  |HAZ LeeUbicaciones;
     eaFicheroEdita = #2#3;   |QBF eaFicheroEdita;
     aFicheroActu   = eaRutaDocumento + "/" + eaFicheroEdita;

     nSwAborto = 0;
     nSwEdita  = 0;
     Pos       = -1;

     |SI #514#21 ! "C";
         |XABRE "EC", aFicheroActu, nCanal;
     |SINO;
         |XABRE "E", aFicheroActu, nCanal;
     |FINSI;

     |SI FSalida < 0;
         Pos = -1;
         |SI enTipoDocumento = 4;  |Y #99#2 = 1;
             |HAZ Imagenes;
         |SINO;
             |HAZ TrataDocumentos;
         |FINSI;

         |SI nSwAborto = 1;
             |ESTADO_CONTROL enBoton2, "SHOW";
             |ESTADO_CONTROL enBoton3, "SHOW";
             |ESTADO_CONTROL enBoton4, "SHOW";
             |ACABA;
         |FINSI;

         |SI nAsignado = 1;
            nAsignado = 0;
            |ESTADO_CONTROL enBoton2, "SHOW";
            |ESTADO_CONTROL enBoton3, "SHOW";
            |ESTADO_CONTROL enBoton4, "SHOW";
            |ACABA;
         |FINSI;
     |FINSI;

     |SI nSwEdita = 0;
         |QBF aFicheroActu;
         efFechaDocu    = #2#4;
         enCodUbica     = #2#10;  |HAZ LeeUbicaciones;
         eaFicheroEdita = #2#3;   |QBF eaFicheroEdita;
         |HAZ AbreDocumento;
     |FINSI;

     |HORA aHora;
     aAlfa = aHora % 102;  #2#8 = aAlfa;   |PINTA #2#8;
     aAlfa = aHora % 402;  #2#9 = aAlfa;   |PINTA #2#9;
                           #2#7 = ~;       |PINTA #2#7;
     |GRABA 120#2a;
     |LIBERA #2;

     |SI nErrorCampo = 0;  |ERROR;   |FINSI;

     |ESTADO_CONTROL enBoton2, "SHOW";
     |ESTADO_CONTROL enBoton3, "SHOW";
     |ESTADO_CONTROL enBoton4, "SHOW";
|FPRC;

|PROCESO Tipo2m0002;  |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 3;   |ACABA;  |FINSI;

     efFechaDocu  = #2#4;
     enCodUbica   = #2#10;  |HAZ LeeUbicaciones;
     aFicheroActu = eaRutaDocumento + "/" + #2#3;  |QBF aFicheroActu;

     |SI #514#21 ! "C";
         |RFBORRA aFicheroActu;
     |SINO;
         |FBORRA aFicheroActu;
     |FINSI;
|FPRC;

|PROCESO PonFichero;
     efFechaDocu  = #2#4;
     enCodUbica   = #99#0;  |HAZ LeeUbicaciones;

     eaExtension = eaExtension < "";
     aAlfa = "w";
     |SI eaExtension ! "doc";
         |SI eaExtension = "xls";  aAlfa = "e";  |FINSI;
         |SI eaExtension = "tif";  aAlfa = "g";  |FINSI;
     |FINSI;

     |SI #2#1 [ 999;
         #2#3 = aAlfa + (("00000000" + #2#0) % -108) + (("000" + #2#1) % -103) + "." + eaExtension;
     |SINO;
         #2#3 = aAlfa + (("00000000" + #2#0) % -108) + (("00000" + #2#1) % -105) + "." + eaExtension;
     |FINSI;

     |PINTA #2#3;

     #2#10 = #99#0;
     |GRABA 120#2a;
     |LIBERA #2;

     FSalida     = 10;
     nErrorCampo = 1;
     nGrabaFecha = 1;
     |HAZ EditaDocumento;
     nGrabaFecha = 0;
     nErrorCampo = 0;
|FPRC;

|PROCESO EligeDocumento;
     aAlfa = #2#3;  |QBF aAlfa;
     |SI aAlfa ! "";  |ACABA;  |FINSI;

     |ESTADO_CONTROL enBoton2, "HIDE";
     |ESTADO_CONTROL enBoton3, "HIDE";
     |ESTADO_CONTROL enBoton4, "HIDE";

     |DDEFECTO #99;

     |PUSHV 0501 2380;
     |DDEFECTO #99;
     |PINPA #0#99;
     |PINDA #0#99;
     |SI #2#0 ! 0;
         |ATRI R;
         |PINTA 1827, "-3- De la Entrada General de Documentos              ";
         |ATRI r;
     |FINSI;
     |ENDATOS #1#99;
     |SI FSalida ! 0;
         |POPV;
         |MENAV "2300 Proceso Abortado.";
         |ERROR;
         |ESTADO_CONTROL enBoton2, "SHOW";
         |ESTADO_CONTROL enBoton3, "SHOW";
         |ESTADO_CONTROL enBoton4, "SHOW";
         |ACABA;
     |FINSI;

     |POPV;

     nSwAborto   = 0;
     |HAZ PonFichero;

     |SI nSwAborto = 1;
         |MENAV "2300 Proceso Abortado.";
         #2#3 = "";
         |ERROR;
         |ESTADO_CONTROL enBoton2, "SHOW";
         |ESTADO_CONTROL enBoton3, "SHOW";
         |ESTADO_CONTROL enBoton4, "SHOW";
         |ACABA;
     |FINSI;
     |ESTADO_CONTROL enBoton2, "SHOW";
     |ESTADO_CONTROL enBoton3, "SHOW";
     |ESTADO_CONTROL enBoton4, "SHOW";
|FPRC;

|PROCESO Boton2;
     |PTEC 824;
|FPRC;

|PROCESO Boton3;
     |PTEC 825;
|FPRC;

|PROCESO Boton4;
     |PTEC 826;
|FPRC;
