|FICHEROS;
     aszp0006 #0;             || Este Def
     asconcli #1;             || Conceptos Clientes
     asclient #2;             || Clientes
     asw00012 #99,MANTE;      || Temporal

    :/basica/def/agim0001 #4;
    :/basica/def/agitab03 #3;
    :/integral/def/dsam0008 #44;
|FIN;

|VARIABLES;
     nConcepto = 0;

     Fichero = "";
     Tecla   = 0;
     SwGraba = 0;
     XPara   = 0;
     YPara   = 0;
     ZPara   = 0;

     &enCodCli = 0;
     &enSwDeDonde = 0;
|FIN;

|PROCESO Mayuscula;
  #0Campo = #0Campo > #0Campo;
  |PINTA #0Campo;
|FPRC;

|PROCESO Seleccion;  |TIPO 0;
  |SI #0#0 = "S";
      |PARA XPara = 5; |SI XPara [ 44;  |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "S";
      |SIGUE;
      |C_M #0#1, 1, "N";  #0#1 = "";          |PINTA #0#1;
      |C_M #0#2, 1, "N";  #0#2 = "";          |PINTA #0#2;
      |C_M #0#3, 1, "N";  #0#3 = "zzzz";      |PINTA #0#3;
      |C_M #0#4, 1, "N";  #0#4 = "zz";        |PINTA #0#4;
  |SINO;
      |PARA XPara = 5; |SI XPara [ 44;  |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "N";
            #0XPara = "zzzz";  |PINTA #0XPara;
      |SIGUE;
      |C_M #0#1, 1, "S";
      |C_M #0#2, 1, "S";
      |C_M #0#3, 1, "S";
      |C_M #0#4, 1, "S";
  |FINSI;

  |SI #0#45 = "S";
      |PARA XPara = 48; |SI XPara [ 67;  |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "S";
      |SIGUE;
      |C_M #0#46, 1, "N";  #0#46 = 1;          |PINTA #0#46;
      |C_M #0#47, 1, "N";  #0#47 = 99999;      |PINTA #0#47;
  |SINO;
      |PARA XPara = 48; |SI XPara [ 67;  |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "N";
            #0XPara = 0;    |PINTA #0XPara;
      |SIGUE;
      |C_M #0#46, 1, "S";
      |C_M #0#47, 1, "S";
  |FINSI;
|FPRC;

|PROCESO GrabaTempo;
  #2#0  = #1#0;
  |LEE 040#2=;
  |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;

  #99#0 = #1#0;
  #99#1 = #1#1;
  #99#2 = #1#2;
  #99#3 = #1#6;
  #99#4 = #2#1;
  #99#5 = #1#3;
  #99#6 = #1#10;
  |SI #0#68 = "+";  #99#7 = #1#10 > #0#69;  |FINSI;
  |SI #0#68 = "-";  #99#7 = #1#10 < #0#69;  |FINSI;
  #99#8 = "S";
  |GRABA 140#99n;
  |LIBERA #99;

  SwGraba = 1;
|FPRC;

|DEFBUCLE asconcli;
  #1#1;
  ;
  #0#46, #0#1, #0#2;
  #0#47, #0#3, #0#4;
  ;
  NULL, GrabaTempo;
|FIN;

|PROCESO BuscaConcepto;
     |SI #3#2 = "    "; |Y #3#3 = "  "; |ACABA; |FINSI;
     |SI #3#5 ! #48#0;  |Y #3#5 ! 0;    |ACABA; |FINSI;
     |SI #3#2 ! #1#1;   |O #3#3 ! #1#2; |ACABA; |FINSI;

     nConcepto = #3#0;
     |ERROR10;
|FPRC;

|DEFBUCLE agitab03;
     #3#1;
     ;
     00;
     99;
     ;
     NULL, BuscaConcepto;
|FIN;

|PROCESO GrabaContratacionI;
     #44#5  = #99#7;
     #44#10 = #44#5 + (#44#5 % #44#9);

     |GRABA 020#44a;
     |LIBERA #44;
|FPRC;

|DEFBUCLE dsam0008;
     #44#1;
     2;
     #1#0, 00, nConcepto;
     #1#0, 99, nConcepto;
     be;
     NULL, GrabaContratacionI;
|FIN;

|PROCESO GrabaContratacionB;
     #4#5  = #99#7;
     #4#10 = #4#5 + (#4#5 % #4#9);

     |GRABA 020#4a;
     |LIBERA #4;
|FPRC;

|DEFBUCLE agim0001;
     #4#1;
     2;
     #1#0, 00, nConcepto;
     #1#0, 99, nConcepto;
     be;
     NULL, GrabaContratacionB;
|FIN;

|PROCESO GrabaConcepto;
  #1#0 = #99#0;
  #1#1 = #99#1;
  #1#2 = #99#2;
  |LIBERA #1;
  |LEE 140#1=;
  |SI FSalida = 0;
      #1#10 = #99#7;
      |GRABA 140#1a;

      enCodCli = 0;
      |HAZ LeePersona;

      nConcepto = 0;
      |BUCLE agitab03;
      |SI nConcepto = 0;  |ACABA;  |FINSI;

      |SI enSwDeDonde = 1;
          |BUCLE dsam0008;
      |SINO;
          |BUCLE agim0001;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE asw00012;
  #99#1;
  8;
  00000, "    ", "  ", "S";
  99999, "zzzz", "zz", "S";
  ;
  NULL, GrabaConcepto;
|FIN;

|RUTINA ClaveBaja;
  #99#0 = 1;
  #99#1 = "    ";
  #99#2 = "  ";
|FRUT;

|RUTINA ClaveAlta;
  #99#0 = 9999;
  #99#1 = "zzzz";
  #99#2 = "zz";
|FRUT;

|PROCESO Tipo3;  |TIPO 3;
  Fichero = Usuario % 808;  |QBT Fichero;
  Fichero = ("P6" + Fichero + "zzzzzzzz") % 108;
  |NOME_DAT #99 Fichero;
  |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

  |ABRE #2;
  |ABRE #99;
  |SI #0#45 = "S";
      |PARA XPara = 48; |SI XPara [ 67;  |HACIENDO XPara = XPara + 1;
            |SI #0XPara ! 0;
                #0#46 = #0XPara;
                #0#47 = #0XPara;
                |SI #0#0 = "S";
                    |PARA YPara = 5; |SI YPara [ 43;  |HACIENDO YPara = YPara + 2;
                          ZPara = YPara + 1;
                          |SI #0YPara ! "    "; |O #0ZPara ! "  ";
                              #0#1 = #0YPara;
                              #0#2 = #0ZPara;
                              #0#3 = #0YPara;
                              #0#4 = #0ZPara;
                              |BUCLE asconcli;
                          |FINSI;
                    |SIGUE;
                |SINO;
                    |BUCLE asconcli;
                |FINSI;
            |FINSI;
      |SIGUE;
  |SINO;
      |SI #0#0 = "S";
          |PARA YPara = 5; |SI YPara [ 43;  |HACIENDO YPara = YPara + 2;
                ZPara = YPara + 1;
                |SI #0YPara ! "    "; |O #0ZPara ! "  ";
                    #0#1 = #0YPara;
                    #0#2 = #0ZPara;
                    #0#3 = #0YPara;
                    #0#4 = #0ZPara;
                    |BUCLE asconcli;
                |FINSI;
           |SIGUE;
       |SINO;
           |BUCLE asconcli;
       |FINSI;
  |FINSI;
  |CIERRA #2;
  |CIERRA #99;

  |SI SwGraba = 0;  |DELINDEX #99;  |ACABA;  |FINSI;

  |ENTLINEAL #1#99, -3, 4, 21, 1, ClaveBaja, ClaveAlta;

  |ABRE #1;
  |BUCLE asw00012;
  |CIERRA #1;

  |DELINDEX #99;
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
  |SI FSalida ! 9;  |Y FSalida ! 10;  |ACABA;  |FINSI;

  Tecla = FSalida;

  |LIBERA #99;
  |LEE 140#99=;

  |SI Tecla = 9;
        |SI #99#8 = "N";
            #99#8 = "S";
        |SINO;
            #99#8 = "N";
        |FINSI;
  |FINSI;

  |SI Tecla = 10;
      #99#8 = "S";
      |C_M #99#7, 1, "S";
      |ENCAMPO #7#99;
  |FINSI;

  |PINTA #99#7;
  |PINTA #99#8;

  |GRABA 140#99a;

  |C_M #99#7, 1, "N";
|FPRC;
