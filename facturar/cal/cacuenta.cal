|| Atencion, Calculo de MODELOS, no es el mismo que el de CONTAGEN

|FICHEROS;
   :/contagen/def/cacuenta #0,MANTE;    || cuentas

   :/contagen/def/cacuebal #5;    || cuentas de balance
   :/contagen/def/caparbal #6;    || partidas balances
   :/contagen/def/caparexp #7;    || partidas explotacion
   :/contagen/def/caagrupa #8;    || agrupaciones
   :/contagen/def/caepigra #9;    || epigrafes

   :/contagen/def/cactrlal #11;   || control altas en otras empresas.
   :/contagen/def/caclipro #21;   || Clientes y Proveedores
   :/contagen/def/canempre #30;
|FIN;

|INCLUYE i_varcof;

|VARIABLES;
   men1     = "     NO EXISTE EMPRESA !";
   men2     = "     LONGITUD DE CUENTA FUERA DE NIVEL !";
   men3     = "     CUENTA ERRONEA !!";
   error    = "     CLAVE EXISTENTE !";
   valida   = "     Conforme S/N.:";
   mascara  = "";
   digito2  = "  ";
   num      = 0;
   sw       = 0;
   mes      = "                ";
   me       = 0;
   cta      = "            ";
   ctanum   = 0;
   ctaalf   = " ";
   longalf  = " ";
   longnum  = " ";
   codcli   = 0;
   codpr    = 0;
   nompro   = "";
   mensa1   = "     No esta definida esta cuenta en Cuentas de Balance";
   uno = "";
   dos = "";
   nada = "";
   &entrada = 0;
   &relacionCta = 0;
   cuen1 = "";
   cuen2 = "";
   cuen3 = "";
   desdec = "";
   hastac = "";
   &raf_cue = "";
   &raf_dig = 0;
   &raf_des = "";
   &raf_sw = 0;
   &tipoalta = "";

   &raf_pase = "";
   &raf_blo = 0;
   &raf_tipo = "";
   &raf_agru = 0;
   &raf_epi = 0;
   &raf_par = 0;
   &raf_periodo = 0;
   mesdes = "";
   meshas = "";
   xx = 0;
   yy = 0;
   operac = 0;
   alfa1  = "";
   alfa2  = "";
   swaltas = 0;
   swraf = 0;
   &deCuenta = 0;
   existe = 0;
   Comodin = "";
   Tecla = 0;
   FEstado = 0;

   aCamp23 = "";
   aCamp10 = "";
   nCamp11 = 0;
|FIN;

||  ***************************************
|PROCESO ControlGrid;
|FPRC;

|PROCESO Tipo88C;
|FPRC;

|PROCESO bajano; |TIPO 1;
|FPRC;

|PROCESO bclipro;
|FPRC;

|PROCESO filtro_cta; |TIPO 0;
   |SI FSalida = 2; |ACABA; |FINSI;
   |SI #cacuenta#4 = 0;
      |SI #cacuenta#5 = "D"; |O #cacuenta#5 = "H";
         |ERROR;
      |FINSI;
   |SINO;
      |SI #cacuenta#5 = "A"; |O #cacuenta#5 = "P";
         |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO alentrar;  |TIPO 8;
   |HAZ inicio;

   |PARA num = 1;|SI num [ 12;|HACIENDO num = num + 1;
      |SI #canempre#11 = num;
          |HAZ pinta;
          mesdes = mes;
          |SAL;
      |FINSI;
   |SIGUE;
   |PARA num = 12;|SI num [ 1;|HACIENDO num = num - 1;
      |SI #canempre#12 = num;
         |HAZ pinta;
         meshas = mes;
         |SAL;
      |FINSI;
   |SIGUE;
   raf_periodo = #canempre#3;
   |ABRE #11;
   |DDEFECTO #11;
   |LEE 101#11p;
   |SI FSalida ! 0; swaltas = 1; |FINSI;
   |LIBERA #11;
   |CIERRA #11;
|FPRC;

|PROCESO pintas2;
   |ABRE #8;
   #caagrupa#0 = #cacuenta#5;    || tipo
   #caagrupa#1 = #cacuenta#6;    || agrupacion
   |LEE 001#8=;
   |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
   |ATRI I;
   |PINTA 1321, #caagrupa#2;
   |ATRI 0;
   |CIERRA #8;

   |ABRE #9;
   #caepigra#0 = #cacuenta#5;    || tipo
   #caepigra#1 = #cacuenta#6;    || agrupacion
   #caepigra#3 = #cacuenta#7;    || epigrafe
   |LEE 001#9=;
   |SI FSalida ! 0;  |DDEFECTO #9;  |FINSI;
   |ATRI I;
   |PINTA 1421, #caepigra#4;
   |ATRI 0;
   |CIERRA #9;
|FPRC;

|PROCESO pintas; |TIPO 14;
   |SI #cacuenta#4 = 0;
      |ABRE #6;
      #caparbal#0 = #cacuenta#5;     || tipo
      #caparbal#1 = #cacuenta#6;     || agrupacion
      #caparbal#3 = #cacuenta#7;     || epigrafe
      #caparbal#5 = #cacuenta#8;     || partida
      |LEE 001#6=;
      |SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;
      |ATRI I;
      |PINTA 1521, #caparbal#6;
      |ATRI 0;
      |CIERRA #6;
   |SINO;
      |ABRE #7;
      #caparexp#0 = #cacuenta#4;     || bloque
      #caparexp#1 = #cacuenta#5;     || tipo
      #caparexp#2 = #cacuenta#6;     || agrupacion
      #caparexp#4 = #cacuenta#7;     || epigrafe
      #caparexp#6 = #cacuenta#8;     || partida
      |LEE 001#7=;
      |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;
      |ATRI I;
      |PINTA 1521, #caparexp#7;
      |ATRI 0;
      |CIERRA #7;
   |FINSI;
   |HAZ pintas2;
|FPRC;

|PROCESO altas;|TIPO 0;
/*
   Tecla = FSalida;
   cta = #cacuenta#0;
   digito2 = cta % 102;

   |SI Tecla = 12;  |HAZ AltaNif; |FINSI;

   |SI Tecla ! 9; |ACABA; |FINSI;
   raf_cue = #cacuenta#0;
   raf_dig = #cacuenta#1;
   raf_des = #cacuenta#2;
   raf_sw = 0;
   |SI digito2 = "57";  |Y  #canempre#23 = "S";
      |SUB_EJECUTA_NP "camanba1.tab";
      |VETE salir;
   |FINSI;
   |SI digito2 = "43";  |O digito2 = "44";
         tipoalta = "C";
         |SUB_EJECUTA_NP "caclipr1.tab";
   |SINO;
      |SI digito2 = "40";  |O digito2 = "41";  |O digito2 = "52";
            tipoalta = "P";
            |SUB_EJECUTA_NP "caclipr1.tab";
      |SINO;
         tipoalta = "X";
         |SUB_EJECUTA_NP "caclipr1.tab";
      |FINSI;
   |FINSI;
   |ET salir;
   |SI raf_sw = 1;
      #cacuenta#2 = raf_des;
      |PINTA #cacuenta#2;
      raf_sw = 0;
   |FINSI;
*/
|FPRC;

|PROCESO eElAnterior; |TIPO 7;
 operac = (FEntrada / 100) ! 0;
 |SI operac !  1; |ACABA; |FINSI;

 |HAZ LeeCtaSup;
 #cacuenta#Campo# = eaNomCtaSup;
 |PINTA #cacuenta#Campo#;
 |PTEC 816;
|FPRC;

|PROCESO nivel; |TIPO 0;

   |SI #cacuenta#0 = doce;
       operac = (FEntrada / 100) ! 0;
       |SI operac = 4; |ACABA; |FINSI;
   |FINSI;

   eaCuenta = #cacuenta#Campo#;
   salidas  = FSalida;
   |HAZ FiltraPuntos;
   #cacuenta#Campo# = eaCuenta;
   |PINTA #cacuenta#Campo#;

   |SI entrada = 1;  |Y #cacuenta#0 = doce;  |ACABA;  |FINSI;
   |HAZ defect;

   cta = #0#0;
   |QBF cta;
   nada = cta % A101;
   |SI nada ! "0";
       ctanum = cta;
       ctaalf = ctanum;
       longnum = ctaalf % A0;
   |SINO;
       ctanum = 1;
       ctaalf = cta;
       longnum = ctaalf % A0;
   |FINSI;
   longalf = cta    % A0;
   |SI longnum ! longalf;|O ctanum = 0;
       |MENAV men3;
       |PINTA #0#0;
       |ERROR;
       |ACABA;
   |FINSI;

   emCta = 1;
   eaCuenta = #cacuenta#0;
   |HAZ SacaNivel;
   |SI eswCta = 1;
      |ACABA;
   |FINSI;

   ||***** 1a Clave;
   ||***** nivel = nivel de la cta;
   #cacuenta#1 = enNivel;
   || la 3a clave esta formada por la cta + zzzz y el campo fantasma del nivel;
   mascara = #cacuenta#0;
   |QBF mascara;
   mascara = mascara +"zzzzzzzzzzzz";
   mascara = mascara % 112;
   #cacuenta#54    = mascara;
   #cacuenta#55    = enNivel;
   #cacuenta#56 = mesdes;
   #cacuenta#57 = meshas;
   |SI #cacuenta#1 = #canempre#13; |O #cacuenta#0 = doce;
       #cacuenta#3 = "S";
   |SINO;
       #cacuenta#3 = "N";
   |FINSI;
   |PINTA #cacuenta#3;
|FPRC;


|PROCESO pinta;
   |SI num =  1; mes = "Enero";     |ACABA;  |FINSI;
   |SI num = 12; mes = "Diciembre"; |ACABA;  |FINSI;
   |SI num =  2; mes = "Febrero";   |ACABA;  |FINSI;
   |SI num =  3; mes = "Marzo";     |ACABA;  |FINSI;
   |SI num =  4; mes = "Abril";     |ACABA;  |FINSI;
   |SI num =  5; mes = "Mayo";      |ACABA;  |FINSI;
   |SI num =  6; mes = "Junio";     |ACABA;  |FINSI;
   |SI num =  7; mes = "Julio";     |ACABA;  |FINSI;
   |SI num =  8; mes = "Agosto";    |ACABA;  |FINSI;
   |SI num =  9; mes = "Septiembre";|ACABA;  |FINSI;
   |SI num = 10; mes = "Octubre";   |ACABA;  |FINSI;
   |SI num = 11; mes = "Noviembre"; |ACABA;  |FINSI;
|FPRC;

|PROCESO defect;
   |ABRE #5;
   uno = #cacuenta#0;
   |QBF uno;
   dos = uno + "000000000000";
   uno = dos % A101;
   #cacuebal#0 = uno;
   |LEE 040#5=;
   |SI FSalida = 0;  |HAZ saca;  |ACABA;  |FINSI;
   uno = dos % A102;
   #cacuebal#0 = uno;
   |LEE 040#5=;
   |SI FSalida = 0;  |HAZ saca;  |ACABA;  |FINSI;
   uno = dos % A103;
   #cacuebal#0 = uno;
   |LEE 040#5=;
   |SI FSalida = 0;  |HAZ saca;  |ACABA;  |FINSI;
   uno = dos % A104;
   #cacuebal#0 = uno;
   |LEE 040#5=;
   |SI FSalida = 0;
      |HAZ saca;
   |SINO;
      |MENAV mensa1;
      |CIERRA #5;
   |FINSI;
|FPRC;


|PROCESO saca;
   #cacuenta#4 = #cacuebal#1;
   #cacuenta#5 = #cacuebal#2;
   #cacuenta#6 = #cacuebal#3;
   #cacuenta#7 = #cacuebal#4;
   #cacuenta#8 = #cacuebal#5;
   |PINTA #cacuenta#4;
   |PINTA #cacuenta#5;
   |PINTA #cacuenta#6;
   |PINTA #cacuenta#7;
   |PINTA #cacuenta#8;
   |SI entrada = 0;
      |HAZ pintas;
      |HAZ pintas2;
   |FINSI;
   |CIERRA #5;            ||CIERRO AQUI el FICHERO PARA SALIRME
|FPRC;


|PROCESO al_emp; |TIPO 30;

   operac = (FEntrada / 100) ! 0;
   |SI operac ! 1; |ACABA; |FINSI;

   raf_periodo = #canempre#3;
   |ABRE #11;
   |DDEFECTO #11;
   |LEE 101#11p;
   |SI FSalida ! 0; swaltas = 1; |FINSI;
   |LIBERA #11;
   |CIERRA #11;

   |SI swaltas = 1; |ACABA; |FINSI;

   swraf = 1;
   alfa1 = #cactrlal#1; |QBF alfa1;
   alfa2 = #cactrlal#2; |QBF alfa2;
   |SI alfa1 ! ""; |O alfa2 ! ""; swraf = 0; |FINSI;
   alfa1 = #cactrlal#3; |QBF alfa1;
   alfa2 = #cactrlal#4; |QBF alfa2;
   |SI alfa1 ! ""; |O alfa2 ! ""; swraf = 0; |FINSI;
   alfa1 = #cactrlal#5; |QBF alfa1;
   alfa2 = #cactrlal#6; |QBF alfa2;
   |SI alfa1 ! ""; |O alfa2 ! ""; swraf = 0; |FINSI;

   |SI swraf = 1; |ACABA; |FINSI;

   swraf = 1;
   |SI #cacuenta#0 ] #cactrlal#1; |Y #cacuenta#0 [ #cactrlal#2; swraf = 0; |FINSI;
   |SI #cacuenta#0 ] #cactrlal#3; |Y #cacuenta#0 [ #cactrlal#4; swraf = 0; |FINSI;
   |SI #cacuenta#0 ] #cactrlal#5; |Y #cacuenta#0 [ #cactrlal#6; swraf = 0; |FINSI;

   |SI swraf = 1; |ACABA; |FINSI;

   |AVISO;
   |CONFI "2400S¨ Dar de Alta la Cuenta en las Otras Empresas ? ";
   |SI FSalida = 0;
      raf_cue  = #cacuenta#0;
      raf_dig  = #cacuenta#1;
      raf_des  = #cacuenta#2;
      raf_pase = #cacuenta#3;
      raf_blo  = #cacuenta#4;
      raf_tipo = #cacuenta#5;
      raf_agru = #cacuenta#6;
      raf_epi  = #cacuenta#7;
      raf_par  = #cacuenta#8;

      |CIERRAT #0;
      |SUB_EJECUTA_NP ":contagen/caltacta.tab";
      |ABRET #0;
   |FINSI;
|FPRC;

|PROCESO cuenta_tipo4; |TIPO 4;
|FPRC;

|| ********************** BuscoNIFS
|PROCESO AltaNif;
|FPRC;

|PROCESO EVENTOGRID;
|FPRC;
