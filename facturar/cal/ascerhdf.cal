|FICHEROS;
    ascerhdf #0;
    ashisfac #1;
    ashisrec #2;
    ashiscon #3;
    ashismic #4;
    ashismil #5;
    ashismit #7;
    asclient #14;

    referen@ #100;
    referet@ #101;

    &bancosp@ #706;
    &fopagos@ #712;
|FIN;

|VARIABLES;
     aMensaje = "";
     aAlfa = "";
     aMas = "";
     nSwVisados = 0;

     nVariable = 0;
     aPassword = "";

     fFech = @;
     qFech = "";
     dFech = "";
     hFech = "";

     nCampo = 0;
     nMes   = 0;
     aMes   = "";
     &enCodBanco  = 0;
     &enCodPago   = 0;
     &enSwDeDonde = 0;
|FIN;

|PROCESO sacaano; |TIPO 7;
     fFech = ~;
     qFech = fFech % -104;
     dFech = "01.01." + qFech;
     hFech = "31.12." + qFech;
     #0#4  = dFech;
     #0#5  = hFech;
     |PINTA #0#4;
     |PINTA #0#5;
|FPRC;

|PROCESO ashismil;
     #3#0 = #5#0;
     #3#1 = #5#1;
     #3#2 = #5#2;
     |BORRA 020#3c;
     |LIBERA #3;

     |ABRE #7;
     |PARA nVariable = 1;  |SI nVariable [ 100;  |HACIENDO nVariable = nVariable + 1;
           #7#0 = #5#0;
           #7#1 = #5#1;
           #7#2 = #5#2;
           #7#3 = nVariable;
           |LEE 101#7=;
           |SI FSalida = 0;
               |BORRA 020#7a;
               |LIBERA #7;
           |SINO;
               |SAL;
           |FINSI;
     |SIGUE;
     |CIERRA #7;

     |BORRA 020#5a;
     |LIBERA #5;
|FPRC;

|DEFBUCLE ashismil;
     #5#1;
     ;
     #4#0, #4#1, 000;
     #4#0, #4#1, 999;
     be;
     NULL, ashismil;
|FIN;

|PROCESO referet;
     #referet@#15 = "N";
     |GRABA 020#referet@.a;
     |LIBERA #referet@;
|FPRC;

|DEFBUCLE referet;
     #referet@#1003;
     ;
     #referen@#0, #referen@#14, 001;
     #referen@#0, #referen@#14, 999;
     be;
     NULL, referet;
|FIN;

|PROCESO ActualizaCli;
    aMes = #4#29 % 402;
    nMes = aMes;

    enCodBanco = #4#13;
    |HAZ LeeBancoPropio;
    |SI enSwDeDonde = 0;
        |ABRE #706;
        #706#0 = #4#13;
        |LEE 141#706=;
        |SI FSalida = 0;
            #706#20 = #706#20 - #4#28;
            #706#22 = #706#22 - #4#28;
            nCampo  = 7 + nMes;
            #706nCampo = #706nCampo - #4#28;
            |GRABA 020#706a;
       |FINSI;
       |LIBERA #706;
       |CIERRA #706;
   |FINSI;

   #14#0 = #4#3;
   |LEE 141#14=;
   |SI FSalida = 0;
       #14#49 = #14#49 - #4#19;
       #14#50 = #14#50 - #4#20;
       #14#18 = #14#18 - #4#19;
       #14#19 = #14#19 - #4#20;

       nCampo = 24 + nMes;
       #14nCampo = #14nCampo - #4#19;
       nCampo = 36 + nMes;
       #14nCampo = #14nCampo - #4#20;

       #14#24 = #4#28;

      |GRABA 020#14a;
   |FINSI;
   |LIBERA #14;
|FPRC;

|PROCESO Borrar;
     |SI nSwVisados = 0;
          |SELECT #5#referen@;
          #referen@#24 = #ashismic#0;
          #referen@#25 = #ashismic#1;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               aMensaje = "0000Atencion. Controle la numeracion de las facturas";
               |MENAV aMensaje;

               |BUCLE referet;

               #referen@#22 = "N";
               #referen@#24 = "";
               #referen@#25 = 0;
               |GRABA 020#referen@.a;
               |LIBERA #referen@;
          |FINSI;
          ||ARA
     |FINSI;

     |BUCLE ashismil;

     |HAZ ActualizaCli;

     #1#0 = #4#0; #1#1 = #4#1; |BORRA 020#1c; |LIBERA #1;
     #2#0 = #4#0; #2#1 = #4#1; |BORRA 020#2c; |LIBERA #2;

     |BORRA 020#4a;
     |LIBERA #4;
|FPRC;

|DEFBUCLE ashismic;
     #4#1;
     29, 3, 2;
     #0#0, #0#2, #0#4, #0#6, #0#8;
     #0#1, #0#3, #0#5, #0#7, #0#9;
     be;
     NULL, Borrar;
|FIN;

|PROCESO tipo_3; |TIPO 3;
     E_sup     = 10;
     E_inf     = "";
     aPassword = 1732 ? -1;
     |SI aPassword ! "<MYPASWD> ";  |ACABA;  |FINSI;

     |HAZ EsVisados;
     nSwVisados = FSalida;

     |SI nSwVisados = 0;
          |DBASE aAlfa; |QBF aAlfa;
          aMas = aAlfa + "def/visam001";
          |CARGA_DEF aMas, referen@;
          |SI FSalida ! 0;  |ACABA;  |FINSI;

          aMas = aAlfa + "def/visam002";
          |CARGA_DEF aMas, referet@;
          |SI FSalida ! 0;
               |DESCARGA_DEF #referen@;
               |ACABA;
          |FINSI;
          |ABRE #referen@;
     |FINSI;

     |ABRE #1;
     |ABRE #2;
     |ABRE #3;
     |ABRE #14;
     |BUCLE ashismic;
     |CIERRA #14;
     |CIERRA #3;
     |CIERRA #2;
     |CIERRA #1;

     |SI nSwVisados = 0;
          |CIERRA #referen@;
          |DESCARGA_DEF #referet@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
