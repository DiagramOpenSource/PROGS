|FICHEROS;
     abxz0058 #958;

     abom0016 #16;
     abom0514 #514;

     Referen@ #902;
|FIN;

|VARIABLES;
     aParametro = "";

     nRango          = 0;
     nHandle         = 0;
     nLong           = 0;
     nCaracter       = 0;
     nPos            = 0;
     nVentana        = 0;
     nSubVent        = 0;
     nVent           = 0;
     nCampo          = 0;
     nBoton1         = 0;
     nBoton2         = 0;
     nBoton3         = 0;
     nBoton4         = 0;
     nBoton5         = 0;
     nBoton6         = 0;
     nSubBoton1      = 0;
     nDExpediente    = 0;
     nHExpediente    = 0;
     nSubPanta       = 0;
     nModo           = 0;
     nCont           = 0;
     nPasa           = 0;
     nError          = 0;
     nPosi           = 0;
     nLen            = 0;
     nSwEnvio        = 0;
     nSwMensaje      = 0;
     nDirecto        = 0;
     nNume1          = 0;
     nNume2          = 0;
     nTecla          = 0;
     nSwPon          = 0;
     nLinea          = 0;

     fFecha          = @;

     aEsc1           = "";
     aEsc2           = "";
     aRetu           = "";
     aTecla          = "";
     aAlfa           = "";
     aHora           = "";
     aNumero         = "";
     aPersona        = "";
     aCadena         = "";
     aComodin        = "";
     aAbre           = "";
     aBase           = "";
     aMas            = "";
     aRutaCorreo     = "";
     aCorreo         = "";
     aEjecuta        = "";
     aEnviado        = "";
     aRef            = "";
     aFic            = "";
     aIncidencia     = "";
     aLen            = "";
     aCaracter       = "";
     aReferencia     = "";
     aFicheroActu    = "";
     aDSCorreo       = "";
     aProxy          = "";
     aUsu            = "";
     aPwd            = "";
     aNombre         = "";
     aAlfa1          = "";
     aDirOri         = "";
     aDirDes         = "";
     aTitulo         = "";
     aTexto          = "";
     aMenLog         = "";
     aOrigen         = "";
     aDestino        = "";
     aLong           = "";
     aRuta           = "";
     aNombreFichero  = "";

     {-1}aVent       = "";
         aVent1      = 0;
         aVent2      = 0;
         aVent3      = 0;
         aVent4      = 0;
         aVent5      = "";


     {1}aContiene    = "";

     &enGrid1         = 0;
     &enPanta0        = 0;
     &enSubPanta      = 0;
     &enExped         = 0;
     &enContador      = 0;
     &enLabel1        = -1;
     &enLabel2        = -1;
     &enLabel3        = -1;
     &enExpediente    = 0;
     &enCodUbica      = 0;
     &eaRutaDocumento = "";
     &efFechaDocu     = @;
     &eaFicheroEdita  = "";
     &eaFichAdjunto   = "";
     &enCodExpe       = 0;
     &enCodPers       = 0;
     &enCuenta        = 0;
     &enFSalida       = 0;
     &enError         = 0;
     &eaUnidadBasico = "";
|FIN;

|PROCESO abom0016;
     |VENTANA 0501, 2799, -1, 17, "Env¡o de correo";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enExped    = #902#0;
     enContador = #902#1;
     |SUB_EJECUTA_NP "abxz0001;ENVIO16";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;

     |SI enError ! 0;
         aAlfa = "0000 Error al enviar el correo: " + #16#1;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SELECT #1#16;
     #16#0 = #902#0;
     #16#1 = #902#1;
     |LEE 101#16=;
     |SI FSalida = 0;
         aAlfa = #abom0016#2 - "Situacion expedientes a dia";
         |SI FSalida ! 0;
             |BORRA 020#abom0016.a;
             |LIBERA #abom0016;
         |SINO;
             #16#11 = "S";
             |GRABA 020#16a;
             |LIBERA #16;
         |FINSI;
     |FINSI;

     |SELECT #2#16;
|FPRC;

|DEFBUCLE abom0016;
     #902#2003;
     ;
     "N", 000000000, 0001;
     "N", 999999999, 9999;
     ;
     NULL, abom0016;
|FIN;

|PROCESO Enviar;
     aAlfa = "    N" + &191 + " Desea enviar los correos pendientes ? ";
     |CONFI aAlfa;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "abom0016.mas";
     |CARGA_DEF aAlfa, Referen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BUCLE abom0016;

     |DESCARGA_DEF #Referen@;

     |REFRESCACONTROL enGrid1;
|FPRC;

|PROCESO Consultar;
     |VENTANA 0501, 2799, -1, 17, "Consulta del correo";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enExped    = #16#0;
     enContador = #16#1;
     |SUB_EJECUTA_NP "abxz0001;CONSULTA16";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;
|FPRC;

|PROCESO Editar;
     |SI #16#6 = 0;
         |MENAV "     No hay Fichero Adjunto";
         |ACABA;
     |FINSI;

     |VENTANA 0501, 2799, -1, 17, "Editando fichero adjunto";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "LABEL,{{5}}Editando fichero adjunto", 1320, 1498, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{2}}Espere por favor ...", 1640, 1698, NULL;

     |PTEC 802;
     |PAUSA;

     |SI #16#9 = "N";
         eaFicheroEdita = #16#5;  |QBF eaFicheroEdita;
         |SI eaFicheroEdita ! "";
             efFechaDocu    = #16#8;
             enCodUbica     = #16#6;  |HAZ LeeUbicaciones;
             eaFicheroEdita = #16#5;  |QBF eaFicheroEdita;
             aAlfa1 = eaRutaDocumento + "/";
             eaFicheroEdita = eaFicheroEdita - aAlfa1;
             |HAZ AbreDocumento;
         |SINO;
             |MENAV "     No hay Fichero Adjunto";
         |FINSI;
     |SINO;
         aAlfa = #16#5;  |QBF aAlfa;
         |SI aAlfa ! "";
             aLong          = aAlfa % 0;
             nLong          = aLong;
             aRuta          = "";
             aNombreFichero = "";

             |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
                   nPosi     = (100 * nCaracter) + 1;
                   aCaracter = aAlfa % nPosi;
                   |SI aCaracter = "/";  |O aCaracter = "\";
                       aNombreFichero = "";
                   |SINO;
                       aNombreFichero = aNombreFichero + aCaracter;
                   |FINSI;
             |SIGUE;

             efFechaDocu = #16#8;
             enCodUbica  = #16#6;  |HAZ LeeUbicaciones;
             aAlfa       = eaRutaDocumento + "/" + aNombreFichero;  |QBF aAlfa;

             |SI #514#21 ! "C";
                 aLong    = aAlfa % 0;
                 nLong    = aLong;
                 aRuta    = "";

                 |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
                       nPosi     = (100 * nCaracter) + 1;
                       aCaracter = aAlfa % nPosi;
                       |SI aCaracter = "/";
                           aCaracter = "\";
                       |FINSI;
                       aRuta = aRuta + aCaracter;
                 |SIGUE;
                 aAlfa = aRuta;
             |SINO;
                 aOrigen = aAlfa;
                 aDestino = eaUnidadBasico + "\DOCUMENTOS\IPABOGAD\" + aNombreFichero;  |QBF aDestino;
                 |ENVIA_FICHERO aOrigen, aDestino;

                 aAlfa = aDestino;
             |FINSI;

             aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
             |RSYSTEM aAlfa;

             |RFBORRA aDestino;
         |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;
|FPRC;

|PROCESO Borrar;
     |CONFI "0000NEsta Seguro de Borrar el Correo ";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#16=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;


     efFechaDocu = #16#7;
     enCodUbica  = #514#9;  |HAZ LeeUbicaciones;
     aAlfa       = eaRutaDocumento + "/" + (("00000000" + #16#0) % -108) + (("0000" + #16#1) % -104) + ".txt";
     |SI #514#21 ! "C";
         |RFBORRA aAlfa;
     |SINO;
         |FBORRA aAlfa;
     |FINSI;

     |BORRA 020#16a;
     |LIBERA #16;

     |REFRESCACONTROL enGrid1;
|FPRC;


|PROCESO EventoPanta;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#16=;
         |SI FSalida = 0;
             |ESTADO_CONTROL nBoton1, "ENABLE";
             |ESTADO_CONTROL nBoton2, "ENABLE";
             |ESTADO_CONTROL nBoton3, "ENABLE";
         |SINO;
             |ESTADO_CONTROL nBoton1, "DISABLE";
             |ESTADO_CONTROL nBoton2, "DISABLE";
             |ESTADO_CONTROL nBoton3, "DISABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
         |HAZ Consultar;
     |FINSI;
|FPRC;

|PROCESO Tipo80Fxz58; |TIPO 80;
     |ABRE #514;
     |LEE 000#514p;
     |SI FSalida ! 0;  |DDEFECTO #514;  |FINSI;
     |CIERRA #514;

     |ABRET #16;

     FSalida = 2799;
|FPRC;

|PROCESO Tipo90Fxz58; |TIPO 90;
     |CIERRAT #16;
|FPRC;

|PROCESO Baja16;
     #16#0  = 0;
     #16#1  = 1;
     #16#11 = "N";
|FPRC;

|PROCESO Alta16;
     #16#0  = 999999999;
     #16#1  = 9999;
     #16#11 = "N";
|FPRC;

|PROGRAMA;
     |HAZ LeeUnidadBasico;

     |PINPA #0#958;  enPanta0 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}} Consulta correo", 2602, 2717, Consultar;
     nBoton1  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}} Editar adjunto", 2619, 2732, Editar;
     nBoton2  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}} Borrar correo", 2634, 2747, Borrar;
     nBoton3  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{157}} Enviar todo", 2649, 2764, Enviar;
     nBoton4  = FSalida;

     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton3, "DISABLE";

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #2#16, nRango, 0602, 2698, Baja16, Alta16, EventoPanta;

     enGrid1  = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + enGrid1;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |PULSATECLA;

     |DESTRUYECONTROL enGrid1;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
|FPRO;
