|FICHEROS;
     asy00005 #0;
     asclient #1;
     asempres #4;

     :/modelos/def/dsmom001  #101;
     :/modelos/def/dsmom107  #107;

     :/basica/def/agim0019   #119;
     :/basica/def/agim0024   #124;
     :/basica/def/agim0026   #126;
     :/basica/def/agicen14   #114;
     :/basica/def/agicen15   #115;

     :/integral/def/dsam0000 #110;
     :/basica/def/agifigen   #109;
|FIN;

|VARIABLES;
     &linea1 = "";

     SwPrint = 0;
     Total   = 0;
     VAlfa1  = "";
     VAlfa2  = "";
     VAlfa3  = "";
     aAlfa   = "";
     aAlfa1  = "";
     aAlfa2  = "";
     aAlfa3  = "";

     aQuienFirma = "";

     &eaPathIntegral  = "";
     &eaPathDsmodelo  = "";
     &eaPathBasica    = "";

     nHandle  = 0;
     nEmpresa = 0;
     nEjer    = 0;

     &eaNombre = "";
     &eaNif = "";
     &eaDia = "";
     &eaMes = "";
     &eaAny = "";
     &eaFecha = "";
     &eaPobla = "";
     &eaCta   = "";
     &eaCta1  = "";
     &eaCta2  = "";
     &eaCta3  = "";
     &eaCta4  = "";
     &eaIBAN  = "";
     &eaIBAN1 = "";
     &eaIBAN2 = "";
     &eaIBAN3 = "";
     &eaIBAN4 = "";
     &eaIBAN5 = "";
     &eaIBAN6 = "";
     &eaIBAN7 = "";
     &eaIBAN8 = "";
     &eaIBAN9 = "";

     aNombreE = "";
     aNifE    = "";
     nSwSecre = 0;
     swExiste = 0;
     nRegis   = 0;
     fFecha   = @;
     aPath    = "";
     aCB      = "";
     aDef     = "";

     nPin1   = 0;
     nCampo  = 0;
     swSelec = 0;
     aEstado = "";
|FIN;

|PROCESO NoMeQuites; |TIPO 0;
     |HAZ BusquedaApli;   ||si lo quitas dara error de compilacion
|FPRC;

|PROCESO NoPide; |TIPO 0;
     aAlfa = #0#4;
     |C_M #0#3,1,aAlfa;
     |C_M #0#5,1,aAlfa;
     |SI aAlfa = "N";
         #0#3 = 01; |PINTA #0#3;
         #0#5 = ""; |PINTA #0#5;
     |FINSI;
|FPRC;

|PROCESO PintaFormato;
   |ATRI I;
   |SI #0#7 = "1"; |PINTA 1924, "Formato B2B   "; |FINSI;
   |SI #0#7 = "2"; |PINTA 1924, "Formato Basico"; |FINSI;
   |ATRI N;
|FPRC;

|PROCESO Tipo0C8;  |TIPO 0;
     |SI FSalida = 10;
         #0#8 = "asy00005"; |PINTA #0#8;
     |FINSI;

     |DDEF aDef;  |QBF aDef;
     aAlfa = aDef + #0#8 + ".rpt";  |QBT aAlfa;

     |XABRE "E", aAlfa, 0;
     |SI FSalida < 0;
         |MENAV "0000No existe el cuadre.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Seleccion_TE;
     |SI #0#10 = "D";
         |C_M #0#11, 1, "S";
         |C_M #0#12, 1, "S";
         |PARA nCampo = 13;  |SI nCampo [ 24;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";  #0nCampo = -1;  |PINTA #0nCampo;
         |SIGUE;
     |SINO;
         |C_M #0#11, 1, "N";  #0#11 = 0;      |PINTA #0#3;
         |C_M #0#12, 1, "N";  #0#12 = 99;     |PINTA #0#4;
         |PARA nCampo = 13;  |SI nCampo [ 24;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = -1;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 24;  |HACIENDO nCampo = nCampo + 1;
               #0Campo = -1;  |C_M #0nCampo, 1, "N";  |PINTA #0Campo;
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 24;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S"; |PINTA #0Campo;
         |SIGUE;
     |FINSI;
|FPRC;

|| *************************************************************************
|PROCESO FechaBonito;
     aAlfa1 = aAlfa % 102;
     aAlfa2 = aAlfa % 402;
     aAlfa3 = aAlfa % 704;

     |SI aAlfa2 = "01";  aAlfa2 = "ENERO     ";  |FINSI;
     |SI aAlfa2 = "02";  aAlfa2 = "FEBRERO   ";  |FINSI;
     |SI aAlfa2 = "03";  aAlfa2 = "MARZO     ";  |FINSI;
     |SI aAlfa2 = "04";  aAlfa2 = "ABRIL     ";  |FINSI;
     |SI aAlfa2 = "05";  aAlfa2 = "MAYO      ";  |FINSI;
     |SI aAlfa2 = "06";  aAlfa2 = "JUNIO     ";  |FINSI;
     |SI aAlfa2 = "07";  aAlfa2 = "JULIO     ";  |FINSI;
     |SI aAlfa2 = "08";  aAlfa2 = "AGOSTO    ";  |FINSI;
     |SI aAlfa2 = "09";  aAlfa2 = "SEPTIEMBRE";  |FINSI;
     |SI aAlfa2 = "10";  aAlfa2 = "OCTUBRE   ";  |FINSI;
     |SI aAlfa2 = "11";  aAlfa2 = "NOVIEMBRE ";  |FINSI;
     |SI aAlfa2 = "12";  aAlfa2 = "DICIEMBRE ";  |FINSI;

     |QBF aAlfa2;
     eaFecha = aAlfa1 + " de " + aAlfa2 + " de " + aAlfa3;
     eaDia   = aAlfa1;
     eaMes   = aAlfa2;
     eaAny   = aAlfa3;
     nEjer   = aAlfa3;
|FPRC;

|| *************************************************************************
|PROCESO BuscaComuneros;
     aAlfa = "01.01." + nEjer; fFecha = aAlfa;
     |SI #dsmom001#9 ! "01.01.0000";
         |SI #dsmom001#9 < fFecha;  |ACABA;  |FINSI;
     |FINSI;

     aAlfa = "31.12." + nEjer;  fFecha = aAlfa;
     #agicen14#0  = #dsmom001#0;  ||Compruebo si esta la actividad de alta
     #agicen14#1  = #dsmom001#1;
     |LEE 000#agicen14.=;
     |SI FSalida ! 0;  |DDEFECTO #agicen14;  |FINSI;
     |SI #agicen14#5 > "01.01.0000";
         |SI #agicen14#5 > fFecha;  |ACABA;  |FINSI;
     |FINSI;
     aAlfa = "01.01." + nEjer; fFecha = aAlfa;
     |SI #agicen14#6 > "01.01.0000";
         |SI #agicen14#6 < fFecha;  |ACABA;  |FINSI;
     |FINSI;

     nSwSecre = 1;

     |SI eaPathIntegral  ! "";
         |ABRE #dsam0000;
         #dsam0000#0 = #dsmom001#3;
         |LEE 041#dsam0000.=;
         |SI FSalida = 0;
             eaNombre = #dsam0000#2;
             eaNif    = #dsam0000#3;
         |FINSI;
         |CIERRA #dsam0000;
     |SINO;
         |ABRE #agifigen;
         #agifigen#0 = #dsmom001#3;
         |LEE 041#agifigen.=;
         |SI FSalida = 0;
             eaNombre = #agifigen#2;
             eaNif    = #agifigen#13;
         |FINSI;
         |CIERRA #agifigen;
     |FINSI;

     |ERROR10;
|FPRC;

|DEFBUCLE dsmom001;
     #dsmom001#1;
     ;
     nEmpresa, 01, 0001;
     nEmpresa, 99, 9999;
     ;
     NULL, BuscaComuneros;
|FIN;

|PROCESO agim0024;
     |SI #agim0024#15 ! "A";
          eaNombre = #agim0024#4;          || Nombre Remitente
          eaNif    = #agim0024#3;          || NIF Remitente
          nSwSecre = 1;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE agim0024;
     #agim0024#1;
     ;
     nEmpresa, nRegis, 01;
     nEmpresa, nRegis, 99;
     ;
     NULL, agim0024;
|FIN;

|PROCESO BuscaSecre;
  nSwSecre = 1;
  eaNombre = #agim0026#4;      || Nombre Remitente
  eaNif    = #agim0026#3;      || NIF Remitente
  |ERROR10;
|FPRC;

|DEFBUCLE agim0026;
  #agim0026#1;
  16;
  nEmpresa, nRegis, 01, 3;
  nEmpresa, nRegis, 99, 3;
  ;
  NULL, BuscaSecre;
|FIN;

|PROCESO SacaAdministrador;
   swSelec  = 0;
   aNombreE = "";
   aNifE    = "";
   eaNombre = "";
   eaNif    = "";
   nSwSecre = 0;
   aCB      = "";
   nPin1    = 0;
   aEstado  = "A";
   |SI #asclient#66 > "01.01.0000"; |Y #asclient#66 [ #0#2;
       aEstado = "I";
   |FINSI;

   |SI eaPathIntegral  ! "";
       |ABRE #dsam0000;
       #dsam0000#0 = nEmpresa;
       |LEE 041#dsam0000.=;
       |SI FSalida = 0;
           aNombreE = #dsam0000#2;
           aNifE    = #dsam0000#3;
           aCB      = #dsam0000#12;
           aEstado  = #dsam0000#85;
           nPin1    = #dsam0000#9;
       |FINSI;
       |CIERRA #dsam0000;
   |SINO;
       |ABRE #agifigen;
       #agifigen#0 = nEmpresa;
       |LEE 041#agifigen.=;
       |SI FSalida = 0;
           aNombreE = #agifigen#2;
           aNifE    = #agifigen#13;
           |SI #agifigen#94 > "01.01.0000"; |Y #agifigen#94 [ #0#2;
               aEstado = "I";
           |FINSI;
           nPin1 = #agifigen#87;
       |FINSI;
       |CIERRA #agifigen;
   |FINSI;

 || ...  Situacion Activa/Inactiva
    |SI aEstado ! #0#25; |Y #0#25 ! "X";
        swSelec = 1;
        |ACABA;
    |FINSI;

    swSelec = 1;
    |SI #0#10 = "D";
        |SI nPin1 ] #0#11; |Y nPin1 [ #0#12;
            swSelec = 0;
        |FINSI;
    |SINO;
        |SI nPin1 = #0#13;
            swSelec = 0;
        |SINO;
            |PARA nCampo = 14;  |SI nCampo [ 24;  |HACIENDO nCampo = nCampo + 1;
                  |SI nPin1 = #0nCampo; |Y nPin1 > 0;
                      swSelec = 0;
                      |SAL;
                  |FINSI;
            |SIGUE;
        |FINSI;
    |FINSI;
    |SI swSelec = 1; |ACABA; |FINSI;


 || Lee Ficha Sociedades
    swExiste = 0;
    nRegis   = 0;
    |ABRE #agim0019;
    #agim0019#0 = nEmpresa;
    #agim0019#1 = 99;
    |LEE 041#agim0019.];
    |SI FSalida = 0;
        |LEE 041#agim0019.a;
    |SINO;
        |LEE 041#agim0019.u;
    |FINSI;
    |SI FSalida = 0; |Y #agim0019#0 = nEmpresa;
        swExiste = 1;
    |FINSI;
    |SI swExiste = 1;
        nRegis = #agim0019#1;  ||Registre
    |FINSI;
    |CIERRA #agim0019;

    |SI nRegis ! 0;
       |SI aQuienFirma = "R";
           |BUCLE agim0024;
       |SINO;
           |BUCLE agim0026;
       |FINSI;
    |SINO;
       aAlfa = aNifE % 101;
       |SI aAlfa ] "0"; |Y aAlfa [ "9";
           nSwSecre = 1;
       |SINO;
           |SI aAlfa = "X"; |O aAlfa = "Y"; |O aAlfa = "Z";
               nSwSecre = 1;
           |FINSI;
       |FINSI;
       |SI nSwSecre = 1;
           eaNombre = aNombreE;
           eaNif    = aNifE;
       |FINSI;
    |FINSI;

    |SI nSwSecre = 0;
        |ABRE #agicen15;
        #agicen15#0 = nEmpresa;
        |LEE 041#agicen15.=;
        |SI FSalida = 0;
            eaNombre = #agicen15#5; |QBF eaNombre;
            eaNif    = #agicen15#4; |QBF eaNif;
            |SI eaNombre ! ""; |O eaNif ! "";
                nSwSecre = 1;
            |FINSI;
        |FINSI;
        |CIERRA #agicen15;
    |FINSI;

    |SI nSwSecre = 0;
        |ABRE #agicen14;
        |BUCLE dsmom001;
        |CIERRA #agicen14;
    |FINSI;

    |SI nSwSecre = 0;
        eaNombre = aNombreE;
        eaNif    = aNifE;
    |FINSI;
|FPRC;

|PROCESO Imprimir;
     SwPrint = 0;

     #4#0 = #0#3;
     |LEE 040#4=;
     |SI FSalida ! 0; |DDEFECTO #4;  |FINSI;

     nEmpresa = #asclient#0; |HAZ SacaAdministrador;
     |SI swSelec = 1; |ACABA; |FINSI;

     aAlfa1 = #asclient#13;                                |QBF aAlfa1;
     aAlfa2 = #asclient#71 + #asclient#72 + #asclient#73;  |QBF aAlfa2;

     |SI aAlfa1 ! "";
         eaCta = #asclient#13;  |QBF eaCta;
         eaCta = eaCta + #asclient#14;
     |FINSI;

     |SI aAlfa2 ! "";
         eaCta  = #asclient#71 + #asclient#72 + #asclient#73 + #asclient#14;
     |FINSI;

     eaCta1   = eaCta % 104;
     eaCta2   = eaCta % 504;
     eaCta3   = eaCta % 902;
     eaCta4   = eaCta % 1110;

     eaIBAN   = #asclient#77;  |QBF eaIBAN;
     eaIBAN1  = eaIBAN % 104;
     eaIBAN2  = eaIBAN % 504;
     eaIBAN3  = eaIBAN % 904;
     eaIBAN4  = eaIBAN % 1304;
     eaIBAN5  = eaIBAN % 1704;
     eaIBAN6  = eaIBAN % 2104;
     eaIBAN7  = eaIBAN % 2504;
     eaIBAN8  = eaIBAN % 2904;
     eaIBAN9  = eaIBAN % 3302;

     |SI #asy00005#6 = "N";
         eaCta   = "";
         eaCta1  = "";
         eaCta2  = "";
         eaCta3  = "";
         eaCta4  = "";
         eaIBAN  = "";
         eaIBAN1 = "";
         eaIBAN2 = "";
         eaIBAN3 = "";
         eaIBAN4 = "";
         eaIBAN5 = "";
         eaIBAN6 = "";
         eaIBAN7 = "";
         eaIBAN8 = "";
         eaIBAN9 = "";

         #asclient#76 = "";
     |FINSI;

     VAlfa1 = #4#4;  VAlfa1 = ("00"  + VAlfa1) % -102;
     VAlfa2 = #4#5;  VAlfa2 = ("000" + VAlfa2) % -103;
     VAlfa3 = #4#3;  |QBF VAlfa3;

     linea1 = (#4#2 % 115) + " " + VAlfa1 + VAlfa2 + " " + VAlfa3
     |QBF linea1;
     linea1 = ((" " * 45) + linea1) % -145;

     eaPobla = VAlfa3;

     |PRINT;

     |PIEINF;
|FPRC;

|DEFBUCLE asclient;
     #1#1;
     ;
     #0#0;
     #0#1;
     ;
     NULL, Imprimir;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |HAZ BusquedaApli;

     aQuienFirma = "R";
     |SI eaPathDsmodelo ! "";
         aPath = eaPathDsmodelo + "fich/";
         |PATH_DAT #107 aPath;
         |ABRE #dsmom107;
         |LEE 041#dsmom107.p;
         |SI FSalida = 0;
             aQuienFirma = #dsmom107#1;
         |FINSI;
         |CIERRA #dsmom107;
     |FINSI;

     aAlfa = #0#2;
     |HAZ FechaBonito;

     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida ! 0;
         |MENAV "    Error en Impresora Crystal Report";
         |ACABA;
     |FINSI;

     aAlfa = #asy00005#8;  |QBF aAlfa;
     |INFOR aAlfa;
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

     |ABRE #4;
     |BUCLE asclient;

     |FININF;
     |FINIMP;

     |CIERRA #4;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "Carta domiciliacion bancaria";

     |ABRE #asy00005;
     |LEE 101#asy00005.p;
     |SI FSalida ! 0;
         |DDEFECTO #asy00005;
         |GRABA 020#asy00005.n;
         |LIBERA #asy00005;
     |FINSI;

     |PDEFECTO #asy00005, 0, 9;

     |PINPA #0#asy00005;
     |PINDA #0#asy00005;
     |ENDATOS #1#asy00005;
     |SI FSalida = 0;
         aAlfa = #asy00005#8;

         |LEE 101#asy00005.p;
         |SI FSalida = 0;
             |PDEFECTO #asy00005, 0, 9;

             #asy00005#8 = aAlfa;

             |GRABA 020#asy00005.a;
             |LIBERA #asy00005;
         |FINSI;
     |FINSI;
     |CIERRA #asy00005;
|FPRO;

/*
|PROCESO SacaAdministrador;
   eaNombre = "";
   eaNif    = "";
   nSw      = 0;
   |DBASS aAlfa; |QBF aAlfa;
   aBasica = aAlfa + "basica/";
   aIntegr = aAlfa + "integral/";
   aModelo = aAlfa + "modelos/";
   aAlfa1 = aIntegr + "def/dsam0000.mas";
   |XABRE "E", aAlfa1, nHandle;
   |SI FSalida = 0;  || Hay integrada
      |CARGA_DEF aAlfa1, dsam0000@;
      |SI FSalida = 0;
         |ABRE #dsam0000@;
         #dsam0000@#0 = nEmpresa;
         |LEE 000#dsam0000@.=;
         |SI FSalida = 0;
            aAlfa = #dsam0000@#3; |QBF aAlfa;
            aAlfa = aAlfa % 0101;
            |SI aAlfa ] "A"; |Y aAlfa [ "Z"; || Es un CIF
               aAlfa1 = aBasica + "def/agim0024.mas";
               |CARGA_DEF aAlfa1, agim0024@;
               |SI FSalida = 0;
                  aAlfa1 = aBasica + "def/agim0026.mas";
                  |CARGA_DEF aAlfa1, agim0026@;
                  |SI FSalida = 0;
                     aAlfa1 = aModelo + "def/dsmom107.mas";
                     |CARGA_DEF aAlfa1, dsmom107@;
                     |SI FSalida = 0;
                        |ABRE #dsmom107@;
                        |LEE 000#dsmom107@.p;
                        |SI FSalida ! 0; |DDEFECTO #dsmom107@; |FINSI;
                        |CIERRA #dsmom107@;

                        |SI #dsmom107@#1 = "R";
                           |ABRE #agim0024@;
                           |DDEFECTO #agim0024@;
                           #agim0024@#0 = #dsam0000@#0;
                           |LEE 000#agim0024@.];
                           |PARA; |SI FSalida = 0; |Y #agim0024@#0 = #dsam0000@#0; |HACIENDO;
                              |SI #agim0024@#15 = "R"; |O #agim0024@#15 = "D"; |SAL; |FINSI;
                              |LEE 000#agim0024@.s;
                           |SIGUE;
                           |SI #agim0024@#15 = "R"; |O #agim0024@#15 = "D";
                               eaNombre = #agim0024@#4; eaNif = #agim0024@#3;
                           |FINSI;
                           |CIERRA #agim0024@;
                        |FINSI;

                        |SI #dsmom107@#1 = "S";
                           |ABRE #agim0026@;
                           |DDEFECTO #agim0026@;
                           #agim0026@#0 = #dsam0000@#0;
                           |LEE 000#agim0026@.];
                           |PARA; |SI FSalida = 0; |Y #agim0026@#0 = #dsam0000@#0; |HACIENDO;
                              |SI #agim0026@#16 = 3; |SAL; |FINSI;
                              |LEE 000#agim0026@.s;
                           |SIGUE;
                           |SI #agim0026@#16 = 3;
                               eaNombre = #agim0026@#4; eaNif = #agim0026@#3;
                           |FINSI;
                           |CIERRA #agim0026@;
                        |FINSI;
                        |DESCARGA_DEF #dsmom107@;
                     |FINSI;
                     |DESCARGA_DEF #agim0026@;
                  |FINSI;
                  |DESCARGA_DEF #agim0024@;
               |FINSI;
            |SINO;
               eaNombre = #dsam0000@#1; eaNif = #dsam0000@#3;
            |FINSI;
            |SI #dsam0000@#12 = "S"; || Es una CB ...
               aAlfa1 = aBasica + "def/agicen15.mas"
               |CARGA_DEF aAlfa1, agicen15@;
               |SI FSalida = 0;
                  |ABRE #agicen15@;
                  #agicen15@#0 = #dsam0000@#0;
                  |LEE 000#agicen15@.=;
                  |SI FSalida = 0;
                     eaNombre = #agicen15@#5; |QBF eaNombre;
                     eaNif = #agicen15@#4;    |QBF eaNif;
                     |SI eaNombre = ""; |Y eaNif = ""; || Si esta vacio, busco el primer comunero de alta ...
                        aAlfa1 = aBasica + "def/agicen14.mas";
                        |CARGA_DEF aAlfa1, agicen14@;
                        |SI FSalida = 0;
                           aAlfa1 = aModelo + "def/dsmom001.mas";
                           |CARGA_DEF aAlfa1, dsmom001@;
                           |SI FSalida = 0;
                              |ABRE #dsmom001@; |ABRE #agicen14@;
                              |DDEFECTO #agicen14@;
                              #agicen14@#0 = #dsam0000@#0;
                              |LEE 000#agicen14@.];
                              |PARA; |SI FSalida = 0; |Y #agicen14@#0 = #dsam0000@#0; |HACIENDO;
                                 |SI #agicen14@#13 = "S";
                                    |DDEFECTO #dsmom001@;
                                    #dsmom001@#0 = #agicen14@#0;
                                    #dsmom001@#1 = #agicen14@#1;
                                    |LEE 000#dsmom001@.];
                                    |PARA; |SI FSalida = 0; |Y #dsmom001@#0 = #agicen14@#0; |Y #dsmom001@#1 = #agicen14@#1; |HACIENDO;
                                       |SI #dsmom001@#9 = "01.01.0000";
                                          |SALVA_FICHA #dsam0000@;
                                          #dsam0000@#0 = #dsmom001@#3;
                                          |LEE 000#dsam0000@.=;
                                          |SI FSalida = 0;
                                             eaNombre = #dsam0000@#1; eaNif = #dsam0000@#3;
                                          |FINSI;
                                          |REPON_FICHA #dsam0000@;
                                          |SAL;
                                       |FINSI;
                                       |SI eaNombre ! ""; |O eaNif ! ""; |SAL; |FINSI;
                                       |LEE 000#dsmom001@.s;
                                    |SIGUE;
                                 |FINSI;
                                 |SI eaNombre ! ""; |O eaNif ! ""; |SAL; |FINSI;
                                 |LEE 000#agicen14@.s;
                              |SIGUE;
                              |CIERRA #dsmom001@; |DESCARGA_DEF #dsmom001@;
                           |FINSI;
                           |CIERRA #agicen14@; |DESCARGA_DEF #agicen14@;
                        |FINSI;
                     |FINSI;
                  |FINSI;
                  |CIERRA #agicen15@; |DESCARGA_DEF #agicen15@;
               |FINSI;
            |FINSI;
            |DESCARGA_DEF #dsam0000@;
         |FINSI;
      |FINSI;
   |SINO;            || No hay integrada
      aAlfa1 = aBasica + "def/agifigen.mas";
      |CARGA_DEF aAlfa1, agifigen@;
      |SI FSalida = 0;
         #agifigen@#0 = nEmpresa;
         |LEE 000#agifigen@.=;
         |SI FSalida = 0;
            aAlfa = #agifigen@#13; |QBF aAlfa;
            aAlfa = aAlfa % 0101;
            |SI aAlfa ] "A"; |Y aAlfa [ "Z"; || Es un CIF
               aAlfa1 = aBasica + "def/agim0004.mas";
               |CARGA_DEF aAlfa1, agim0004@;
               |SI FSalida = 0;
                  |DDEFECTO #agim0004@;
                  #agim0004@#0 = #agifigen@#0;
                  |LEE 000#agim0004@.];
                  |SI FSalida = 0; |Y #agim0004@#0 = #agifigen@#0;
                     eaNombre = #agim0004@#3; eaNif = #agim0004@#2;
                  |FINSI;
                  |DESCARGA_DEF #agim0004@;
               |FINSI;
            |SINO;
               eaNombre = #agifigen@#2; eaNif = #agifigen@#13;
            |FINSI;

            aAlfa1 = aBasica + "def/agicen14.mas"; || Miro si es CB ...
            |CARGA_DEF aAlfa1, agicen14@;
            |SI FSalida = 0;
               |ABRE #agicen14@;
               |DDEFECTO #agicen14@;
               #agicen14@#0 = #agifigen@#0;
               |LEE 000#agicen14@.];
               |PARA; |SI FSalida = 0; |Y #agicen14@#0 = #dsam0000@#0; |HACIENDO;
                  |SI #agicen14@#13 = "S";
                     aAlfa1 = aBasica + "def/agicen15.mas";
                     |CARGA_DEF aAlfa1, agicen15@;
                     |SI FSalida = 0;
                        |ABRE #agicen15@;
                        #agicen15@#0 = #agifigen@#0;
                        |LEE 000#agicen15@.=;
                        |SI FSalida = 0;
                           eaNombre = #agicen15@#5; |QBF eaNombre;
                           eaNif = #agicen15@#4;    |QBF eaNif;
                           |SI eaNombre = ""; |Y eaNif = ""; || Si esta vacio, busco el primer comunero de alta ...
                              aAlfa1 = aModelo + "def/dsmom001.mas";
                              |CARGA_DEF aAlfa1, dsmom001@;
                              |SI FSalida = 0;
                                 |ABRE #dsmom001@;
                                 |DDEFECTO #dsmom001@;
                                 #dsmom001@#0 = #agicen14@#0;
                                 #dsmom001@#1 = #agicen14@#1;
                                 |LEE 000#dsmom001@.];
                                 |PARA; |SI FSalida = 0; |Y #dsmom001@#0 = #agicen14@#0; |Y #dsmom001@#1 = #agicen14@#1; |HACIENDO;
                                    |SI #dsmom001@#9 = "01.01.0000";
                                       |SALVA_FICHA #dsam0000@;
                                       #dsam0000@#0 = #dsmom001@#3;
                                       |LEE 000#dsam0000@.=;
                                       |SI FSalida = 0;
                                          eaNombre = #dsam0000@#1; eaNif = #dsam0000@#3;
                                       |FINSI;
                                       |REPON_FICHA #dsam0000@;
                                       |SAL;
                                    |FINSI;
                                    |SI eaNombre ! ""; |O eaNif ! ""; |SAL; |FINSI;
                                    |LEE 000#dsmom001@.s;
                                 |SIGUE;
                                 |DESCARGA_DEF #dsmom001@;
                              |FINSI;
                           |FINSI;
                        |FINSI;
                        |DESCARGA_DEF #agicen15@;
                     |FINSI;
                  |FINSI;
               |SIGUE;
               |DESCARGA_DEF #agicen14@;
            |FINSI;
         |FINSI;
         |DESCARGA_DEF #agifigen@;
      |FINSI;
   |FINSI;
|FPRC;
*/
