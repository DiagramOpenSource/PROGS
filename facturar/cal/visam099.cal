|FICHEROS;
visam099 #0;
visam103 #1;
ashismic #2;
ashismil #3;
visam001 #4;
visam002 #5;
asclient #6;
asconcep #7;
asfpagos #8;
visam090 #9;
visam091 #10;
visam092 #11;
visam004 #12;
ashisrec #13;
asmanexp #14;
visam101 #101;
visam102 #102;
visam098 #98;
visam097 #97;
|FIN;

|VARIABLES;
camp = 0;
texta = "";
textb = "";
textc = "";
textd = "";
text1 = "";
text2 = "";
text3 = "";
text4 = "";
text5 = "";
text6 = "";
text7 = "";
c = 0;
d = 0;
e = 0;
col = "";
tcol = "";
ttcol = "";
fechaini = "";
fechafin = "";
anyoini = 0;
anyofin = 0;
periodoini = "";
periodofin = "";
anyo = "";
fichero = "fichero";
informe = "visam099";
fechareg = "";
mes = "";
nmes = 0;
campomes = 0;
campoanyo = 0;
{50}ccm="";
{50}cccm="";
{50}cm=0;
{50}p=0;
{50}t=0;
{50}tt=0;
{50}ttt=0;
{50}tttt=0;
{50}tp=0;
&cc1 = "";
&cc2 = "";
&cc3 = "";
&cc4 = "";
&cc5 = "";
&cc6 = "";
&cc7 = "";
&cc8 = "";
&cc9 = "";
&cc10 = "";
&cc11 = "";
&cc12 = "";
&cc13 = "";
&cc14 = "";
&cc15 = "";
&cc16 = "";
&cc17 = "";
&cc18 = "";
&cc19 = "";
&cc20 = "";
&cc21 = "";
&cc22 = "";
&cc23 = "";
&cc24 = "";
&cc25 = "";
&ccc1 = "";
&ccc2 = "";
&ccc3 = "";
&ccc4 = "";
&ccc5 = "";
&ccc6 = "";
&ccc7 = "";
&ccc8 = "";
&ccc9 = "";
&ccc10 = "";
&ccc11 = "";
&ccc12 = "";
&ccc13 = "";
&ccc14 = "";
&ccc15 = "";
&ccc16 = "";
&ccc17 = "";
&ccc18 = "";
&ccc19 = "";
&ccc20 = "";
&ccc21 = "";
&ccc22 = "";
&ccc23 = "";
&ccc24 = "";
&ccc25 = "";
&c1 = 0;
&c2 = 0;
&c3 = 0;
&c4 = 0;
&c5 = 0;
&c6 = 0;
&c7 = 0;
&c8 = 0;
&c9 = 0;
&c10 = 0;
&c11 = 0;
&c12 = 0;
&c13 = 0;
&c14 = 0;
&c15 = 0;
&c16 = 0;
&c17 = 0;
&c18 = 0;
&c19 = 0;
&c20 = 0;
&c21 = 0;
&c22 = 0;
&c23 = 0;
&c24 = 0;
&c25 = 0;
&pc1 = 0;
&pc2 = 0;
&pc3 = 0;
&pc4 = 0;
&pc5 = 0;
&pc6 = 0;
&pc7 = 0;
&pc8 = 0;
&pc9 = 0;
&pc10 = 0;
&pc11 = 0;
&pc12 = 0;
&pc13 = 0;
&pc14 = 0;
&pc15 = 0;
&pc16 = 0;
&pc17 = 0;
&pc18 = 0;
&pc19 = 0;
&pc20 = 0;
&pc21 = 0;
&pc22 = 0;
&pc23 = 0;
&pc24 = 0;
&pc25 = 0;
&fila = "";
&numcol = 0;
&numcolis = 0;
colant = 0;
nanyo = 0;
numanyo = 0;
numcoln = 0;
camtot = 0;
inicol = 0;
mensa = "";
fincol = 0;
finlin = 0;
fp = 0;
descu = 0;
nlinea = 0;
alfa = "";
alfa2 = "";
cantidad = 0;
cl53 = "";
cl54 = "";
cl55 = "";
cl56 = "";
cl57 = "";
cl58 = "";
cl53ant = "";
cl54ant = "";
cl55ant = "";
cl56ant = "";
cl57ant = "";
cl58ant = "";
prim = 0;
&blanco = 0;
nivel = "";
pais = "";
pais2 = "";
&pr = "";
campo = 0;
campo2 = 0;
numcol1 = 0;
numcol2 = 1;
campop = 0;
co = 0;
cols = 0;
campotot = 0;
i = 0;
impres = "";
salida = "";
repe = 0;
impr = 0;
ip = "";
serv = "MAPI";
from = "";
to = "";
subject = ""
mensaje = "";
ficheros = "";
&pintatot = 0;
lineasini = 0;
lineasfin = 0;
m1 = 0;
m2 = 0;
m3 = 0;
|FIN;

|PROCESO compa¤o;
  nanyo = #0#19 - #0#18;
  |SI #0#18 ] #0#19; |O nanyo > 8;
    mensa = "0000El periodo debe ser de 1 a 8";
    |MENAV mensa;
    |ERROR;
  |FINSI;
|FPRC;

|PROCESO Busqueda; |TIPO 7;
  |HAZ limpia;
|FPRC;

|PROCESO cambia;
  |SI #0Campo ! Contenido;
    camp = Campo + 1;
    #0camp = #0Campo;
    |PINTA #0camp;
  |FINSI;
|FPRC;

|PROCESO limpia; |TIPO 0;
  |SI #0#16 = 2;
    |C_V #0#18,1,"S";
    |C_V #0#19,1,"S";
    ||C_V #0#57,1,"S";
    |PINTA 2121, "A¥O PERIOD.                 (A¥O DE TOTAL:    )";
    |PINDA #0#0;
  |SINO;
    |C_V #0#18,1,"N";
    |C_V #0#19,1,"N";
    ||C_V #0#57,1,"N";
    |PINTA 2120, "                            ";
  |FINSI;
  |SI #0#14 [ 3 ; |PINTA 1427,"FACT"; |FINSI;
  |SI #0#14 ] 4 ; |PINTA 1427,"EXP."; |FINSI;
  text5 = "";
  |SI #0#2 ! "   "; |Y #0#3 ! "zzz";
    text5 = text5 + "GRUPO ";
    #11#0 = #0#2;
    |LEE 001#11=;
    |SI FSalida = 0;
      alfa = #11#1;
    |SINO;
      alfa = #0#2;
    |FINSI;
    text5 = text5 + alfa;
    |QBF text5;
    text5 = text5 + " ";
  |FINSI;
  |SI #0#4 ! 0; |Y #0#5 ! 99999;
    text5 = text5 + "AGENCIA ";
    #6#0 = #0#4;
    |LEE 001#6=;
    |SI FSalida = 0;
      alfa = #6#1;
    |SINO;
      alfa = #0#4;
    |FINSI;
    text5 = text5 + alfa;
    text5 = text5 + " ";
  |FINSI;
  |SI #0#6 ! 0; |Y #0#7 ! 9999;
    text5 = text5 + "SUCURSAL ";
    text5 = text5 + #0#6;
    text5 = text5 + " ";
  |FINSI;
  |SI #0#8 ! "     "; |Y #0#9 ! "zzzzz";
    text5 = text5 + "PAIS ";
    #9#0 = #0#8;
    |LEE 001#9=;
    |SI FSalida = 0;
      alfa = #9#1;
    |SINO;
      alfa = #0#8;
    |FINSI;
    text5 = text5 + alfa;
    |QBF text5;
    text5 = text5 + " ";
  |FINSI;
  |SI #0#10 ! 0; |Y #0#11 ! 99;
    text5 = text5 + "F. DE PAGO ";
    text5 = text5 + #0#10;
    text5 = text5 + " ";
  |FINSI;
  |SI #0#12 ! 0; |Y #0#13 ! 99;
    text5 = text5 + "TIPO DE EXP. ";
    text5 = text5 + #0#12;
    text5 = text5 + " ";
  |FINSI;
|HAZ text;
|FPRC;

|PROCESO text;
  text4 = "PERIODO " + #0#0;
  text4 = text4 + "-";
  text4 = text4 + #0#1;
  text4 = text4 + " ";
  texta = text1 + text2
  textb = text4;
  textc = text6 + text3;
  textd = text7;
  #0#40 = textb;
  |PINTA #0#40;
  #0#41 = text5;
  |PINTA #0#41;
|FPRC;

|PROCESO limpiar;
  |SI #0Campo ! Contenido;
    |HAZ limpia;
  |FINSI;
|FPRC;

|PROCESO llena;
  |PARA c = 0; |SI c < 65; |HACIENDO c = c + 1;
    #0c = #1c;
  |SIGUE;
|FPRC;

|PROCESO inicializa;
  |PARA c = 0; |SI c < 51; |HACIENDO c = c + 1;
    #101c = 0;
  |SIGUE;
|FPRC;

|PROCESO regmeses;
  |SI #0#14 [ 3;
    fechareg = #2#29;
  |SINO;
    fechareg = #4#3;
  |FINSI;
  mes = fechareg % 402;
  nmes = mes;
  campo = inicol + nmes - 1;
|FPRC;

|PROCESO reganyos;
  |SI #0#14 [ 3;
    fechareg = #2#29;
  |SINO;
    fechareg = #4#3;
  |FINSI;
  anyo = fechareg % 704;
  nanyo = anyo;
  numanyo = nanyo - #0#18;
  campo = numanyo + inicol;
|FPRC;

|PROCESO acumula;
  |SI #0#15 = 6;
    #101#51 = alfa2;
    |HAZ claves;
    |LEE 001#101=;
    |SI FSalida = 0;
    |SINO;
      c = 21;
      |ET inicomp;
      d = alfa2;
      e = #0c;
      |SI e = d;
        |VETE graba;
      |FINSI;
      c = c + 1;
      |SI c < 35;
        |VETE inicomp;
      |SINO;
        |VETE nograba;
      |FINSI;
      |ET graba;
      |HAZ inicializa;
      #101#51 = alfa2;
      #101#52 = alfa;
      |HAZ claves;
      |GRABA 001#101c;
      |ET nograba;
    |FINSI;
  |FINSI;

        campop = campo - inicol;
        campop = campop * numcol1;
        campo2 = inicol + campop + cols - 1;
        #101campo2 = #101campo2 + cantidad;
        Itp=tp1<-;Itp = Itp + campo2;
        tp = tp + cantidad;

       |SI #0#16 [ 4;
        campotot = fincol + cols - 1;
        #101campotot = #101campotot + cantidad;
        Itp=tp1<-;Itp = Itp + campotot;
        tp = tp + cantidad;
       |FINSI;

       |GRABA 001#101a;
|FPRC;

|PROCESO mirapaisl;
|SI #0#14 = 1;
  #7#0 = #3#4;
  #7#1 = #3#5;
|SINO;
  #7#0 = #5#4;
  #7#1 = #5#5;
|FINSI;
|LEE 001#7=;
|SI FSalida = 0;
  #10#0 = #7#0;
  |LEE 001#10=;
  |SI FSalida = 0;
    #9#0 = #10#1;
    |LEE 001#9=;
    |SI FSalida = 0;
      pais = #9#1;
      pais2 = #9#0;
    |SINO;
      mensa = "Falta el Pais " + #9#0;
      ||MENAV mensa;
      #102#0 = #102#0 + 1;
      #102#1 = mensa;
      |GRABA 001#102n;
    |FINSI;
  |FINSI;
|FINSI;
|FPRC;

|PROCESO expelineas;
pais = "*** SIN PAIS ***";
pais2 = "*** SIN PAIS ***";
|HAZ mirapaisl;
#9#0 = pais2;

#7#0 = #5#4;
#7#1 = #5#5;
|LEE 001#7=;
|SI FSalida ! 0;
  mensa = "No se encuentra el servicio " + #7#0;
  mensa = mensa + "/";
  mensa = mensa + #7#1;
  ||MENAV mensa;
  #102#0 = #102#0 + 1;
  #102#1 = mensa;
  |GRABA 001#102n;
|SINO;
  |SI #7#3 ] #0#62; |Y #7#3 [ #0#63; |Y #9#0 ] #0#8; |Y #9#0 [ #0#9;

    cols = 1;
    |ET colums;
    co = 20 + cols;

    |SI #0#15 ! 6;
      |HAZ claves;
      |LEE 001#101=;
      |SI FSalida ! 0;
        |HAZ inicializa;
        |HAZ claves;
        |GRABA 001#101c;
      |FINSI;
    |FINSI;

    |SI #7#3 = "H";  ||*********************HONORARIOS
      |SI #7#0 = "MENS"; ||mensajerias
        #101#6 = #101#6 + #5#13;
        tp7 = tp7 + #5#13;

        #101#15 = #101#15 + #5#11; ||unidades mensajeria
        tp16 = tp16 + #5#11; ||unidades mensajeria

        |SI #0co = 7; |O #0#15 = 6;
          alfa2 = "07";
          alfa = "Mensajeria";
          cantidad = #5#13;
          |HAZ acumula;
        |FINSI;
        |SI #0co = 16; |O #0#15 = 6;
          alfa2 = "16";
          alfa = "Num. de Mensajerias";
          cantidad = #5#11;
          |HAZ acumula;
        |FINSI;
      |SINO;
        descu = 0;
        |SI #0#64 = "S";
          descu = #7#4 * #5#11; ||descuentos
          descu = descu - #5#13;
        |FINSI;
        |SI #7#34 = "N";
          #101#0 = #101#0 + #5#13 + descu; ||honorarios normales
          tp1 = tp1 + #5#13 + descu; ||honorarios normales
          |SI #0co = 1; |O #0#15 = 6;
            alfa2 = "01";
            alfa = "Honorarios Normal";
            cantidad = #5#13 + descu;
            |HAZ acumula;
          |FINSI;
        |SINO;
          #101#1 = #101#1 + #5#13 + descu; ||honorarios urgentes
          tp2 = tp2 + #5#13 + descu; ||honorarios normales
          |SI #0co = 2; |O #0#15 = 6;
            alfa2 = "02";
            alfa = "Honorarios Urgente";
            cantidad = #5#13 + descu;
            |HAZ acumula;
          |FINSI;
        |FINSI;
        #101#2 = #101#2 + #5#13 + descu; ||honorarios totales
        tp3 = tp3 + #5#13 + descu; ||honorarios normales
        |SI #0co = 3; |O #0#15 = 6;
          alfa2 = "03";
          alfa = "Honorarios";
          cantidad = #5#13 + descu;
          |HAZ acumula;
        |FINSI;

        descu = #7#4 * #5#11; ||descuentos
        descu = descu - #5#13;
        #101#7 = #101#7 + descu;

        tp8 = tp8 + #5#13; ||honorarios normales
        |SI #0co = 8; |O #0#15 = 6;
          alfa2 = "08";
          alfa = "Descuentos";
          cantidad = descu;
          |HAZ acumula;
        |FINSI;
   || DESACTIVADO TEMPORALMENTE, SUBSTITUIDO POR SUPLIDOS VARIOS
        #101#14 = #101#14 + #5#11; || NUM DOCUMENTOS (HONOR)
        tp15 = tp15 + 1;
        |SI #0co = 15; |O #0#15 = 6;
          alfa2 = "15";
          alfa = "Num. honorarios";
          cantidad = #5#11;
          |HAZ acumula;
        |FINSI;
      |FINSI;
    |FINSI;

    |SI #7#3 = "S"; || ********************** SUPLIDOS
      |SI #7#0 ! "SEGU";
        |SI #7#0 = #97#9; |O #7#0 = #97#10; |O #7#0 = #97#11; |O #7#0 = #97#12;
        |O #7#0 = #97#13; |O #7#0 = #97#14; |O #7#0 = #97#15; |O #7#0 = #97#16;
        |O #7#1 = #97#17; |O #7#1 = #97#18; |O #7#1 = #97#19; |O #7#1 = #97#20;
        |O #7#1 = #97#21; |O #7#1 = #97#22; |O #7#1 = #97#23; |O #7#1 = #97#24;
        ||SI #7#1 = "VA"; ||** SUPLIDOS VARIOS
          #101#25 = #101#25 + #5#13; ||suplidos seguro
          tp26 = tp26 + #5#13; ||honorarios normales
          |SI #0co = 17; |O #0#15 = 6;
            alfa2 = "17";
            alfa = "Supl Varios";
            cantidad = #5#13;
            |HAZ acumula;
          |FINSI;
        |SINO;
          #101#3 = #101#3 + #5#13; ||suplidos consulado
          tp4 = tp4 + #5#13; ||honorarios normales

          |SI #7#0 ! #97#1; |Y #7#0 ! #97#2; |Y #7#0 ! #97#3; |Y #7#0 ! #97#4;
            |Y #7#1 ! #97#5; |Y #7#1 ! #97#6; |Y #7#1 ! #97#7; |Y #7#1 ! #97#8;
            #101#13 = #101#13 + #5#11; ||num visados
            tp14 = tp14 + #5#11; ||num visados
          |FINSI;

          |SI #0co = 4; |O #0#15 = 6;
            alfa2 = "04";
            alfa = "Suplidos Consulado";
            cantidad = #5#13;
            |HAZ acumula;
          |FINSI;
          |SI #0co = 14; |O #0#15 = 6;
            |SI #7#0 ! #97#1; |Y #7#0 ! #97#2; |Y #7#0 ! #97#3; |Y #7#0 ! #97#4;
            |Y #7#1 ! #97#5; |Y #7#1 ! #97#6; |Y #7#1 ! #97#7; |Y #7#1 ! #97#8;
            alfa2 = "14";
            alfa = "Num. de Visados";
            cantidad = #5#11;
              |HAZ acumula;
            |FINSI;
          |FINSI;
        |FINSI;
      |SINO;
        #101#4 = #101#4 + #5#13; ||suplidos seguro
        tp5 = tp5 + #5#13; ||honorarios normales
        |SI #0co = 5; |O #0#15 = 6;
          alfa2 = "05";
          alfa = "Seguros";
          cantidad = #5#13;
          |HAZ acumula;
        |FINSI;
      |FINSI;
      #101#5 = #101#5 + #5#13; ||suplidos totales
      tp6 = tp6 + #5#13; ||honorarios normales
      |SI #0co = 6; |O #0#15 = 6;
        alfa2 = "06";
        alfa = "Suplidos";
        cantidad = #5#13;
        |HAZ acumula;
      |FINSI;
    |FINSI;

    |SI #0#15 = 7;
      #101#8 = #101#8 + #5#13; || TOTAL
      tp9 = tp9 + #5#13; ||honorarios normales
      |SI #0co = 9;
        cantidad = #5#13;
        |HAZ acumula;
      |FINSI;
    |FINSI;
      ||*****************ANULADO DE MOMENTO NUMERO DE DOC, PISABA SUP. VARIOS
/*
      |SI #0co ] 14;
        cantidad = #5#11;
        |HAZ acumula;
      |FINSI;
*/
      ||****************************************************

    |SI #0#20 ! 0;
      |SI #0#15 = 6; |O #0#15 = 7; |O #0#15 = 8; |O #0#15 = 9; |O #0#15 = 4;
        c = #0#20 - 1;
        |SI #0#36 = 2;
          #101#50 = 99999999.99 - #101c;
        |SINO;
          #101#50 = #101c;
        |FINSI;
      |FINSI;
    |FINSI;
    |SI cols < numcol1;
      cols = cols + 1;
    |VETE colums;
    |FINSI;
  |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE expelin;
#5#1;
4,5;
#4#0,#4#14,000,#0#58,#0#60;
#4#0,#4#14,999,#0#59,#0#61;
e;
NULL,expelineas;
|FIN;

|PROCESO factlineas;
  #5#4 = #3#4;
  #5#5 = #3#5;
  #5#6 = #3#6;
  #5#7 = #3#7;
  #5#8 = #3#8;
  #5#9 = #3#9;
  #5#10 = #3#10;
  #5#11 = #3#11;
  #5#12 = #3#12;
  #5#13 = #3#13;
  |HAZ expelineas;
|FPRC;

|DEFBUCLE factlin;
#3#1;
4,5;
#2#0,#2#1,000,#0#58,#0#60;
#2#0,#2#1,999,#0#59,#0#61;
e;
NULL,factlineas;
|FIN;

|PROCESO registrar;
|SI #0#16 = 1;
    |HAZ regmeses;
|FINSI;
|SI #0#16 = 2;
  |HAZ reganyos;
|FINSI;
|SI #0#16 = 4;
  campo = #2#12 + inicol;
|FINSI;
|SI #0#16 = 5;
  campo = inicol;
|FINSI;

|SI #0#14 = 1;
  |BUCLE factlin;
|SINO;
  |BUCLE expelin;
|FINSI;

cols = 1;
|ET columsc;
co = 20 + cols;

|SI #0#14 = 1;
  #4#6 = #2#19;
  #4#7 = #2#20;
|FINSI;

|SI #0#15 ! 7;
  #101#8 = #101#8 + #4#6 + #4#7; || TOTAL
  tp9 = tp9 + #4#6 + #4#7; ||honorarios normales
  |SI #0co = 9; |O #0#15 = 6;
    alfa2 = "09";
    alfa = "TOTAL";
    cantidad = #4#6 + #4#7;
    |HAZ acumula;
  |FINSI;
  #101#9 = #101#9 + #2#25; ||IVA
  tp10 = tp10 + #2#25; ||honorarios normales
  |SI #0co = 10; |O #0#15 = 6;
    alfa2 = "10";
    alfa = "IVA ";
    cantidad = #2#25;
    |HAZ acumula;
  |FINSI;
  #101#10 = #101#10 + #2#26; || TOTAL + IVA
  tp11 = tp11 + #2#26; ||honorarios normales
  |SI #0co = 11; |O #0#15 = 6;
    alfa2 = "11";
    alfa = "TOTAL + IVA";
    cantidad = #2#26;
    |HAZ acumula;
  |FINSI;
  #101#11 = #101#11 + #13#9 + #2#21; || COBRADO
  tp12 = tp12 + #13#9 + #2#21; ||honorarios normales
  |SI #0co = 12; |O #0#15 = 6;
    alfa2 = "12";
    alfa = "COBRADO";
    cantidad = #13#9 + #2#21;
    |HAZ acumula;
  |FINSI;
  #101#12 = #101#12 + #13#6 - #13#9; || PENDIENTE COBRO
  tp13 = tp13 + #13#6 - #13#9; ||honorarios normales
  |SI #0co = 13; |O #0#15 = 6;
    alfa2 = "13";
    alfa = "PENDIENTE COBRO";
    cantidad = #13#6-#13#9;
    |HAZ acumula;
  |FINSI;

  |SI #0#20 ! 0;
    ||SI #0#15 = 1; |O #0#15 = 2; |O #0#15 = 3; |O #0#15 = 5;
      c = #0#20 - 1;
      |SI #0#36 = 2;
        #101#50 = 99999999.99 - #101c;
      |SINO;
        #101#50 = #101c;
      |FINSI;
    ||FINSI;
  |FINSI;
|FINSI;
|SI cols < numcol1;
  cols = cols + 1;
  |VETE columsc;
|FINSI;
|FPRC;

|PROCESO claves2;
|SI #0m1 = 1;
  #101m2 = #4#27; ||GRUPO;
  #11#0 = #4#27;
  |LEE 001#11=;
  |SI FSalida = 0;
    #101m3 = #11#1;
  |SINO;
    #101m3 = "GRUPO ERRONEO";
  |FINSI;
|FINSI;
|SI #0m1 = 2;
  alfa = "000000" + #6#0;
  alfa = alfa % -105;
  #101m2 = alfa; ||CLIENTE;
  #101m3 = #6#1;
|FINSI;
|SI #0m1 = 3;
  alfa = "000000" + #4#19;
  alfa = alfa % -104;
  #101m2 = alfa; ||DELE;
  #12#0 = #6#0;
  #12#1 = #4#19;
  |SI #12#1 = 0;
    #101m3 = "CENTRAL";
  |SINO;
    |LEE 001#12=;
    |SI FSalida = 0;
      #101m3 = #12#2;
    |SINO;
      mensa = "No se encuenta la sucursal " + #12#0;
      mensa = mensa + "/";
      mensa = mensa + #12#1;
      #102#0 = #102#0 + 1;
      #102#1 = mensa;
      |GRABA 001#102n;
    |FINSI;
  |FINSI;
|FINSI;
|SI #0m1 = 4;
  |HAZ mirapaisl;
  #101m2 = pais2;
  #101m3 = pais;
|FINSI;
|SI #0m1 = 5;
  #101m2 = #2#12;
  #8#0 = #101m2;
  |LEE 001#8=;
  |SI FSalida = 0;
    #101m3 = #8#1;
  |SINO;
    #101m3 = "FP ERRONEO";
  |FINSI;
|FINSI;
|SI #0m1 = 7;
  alfa = #7#0 + "/";
  alfa = alfa + #7#1;
  #101m2 = alfa;
  #101m3 = #7#2;
|FINSI;
|SI #0m1 = 8; || FACTURAS
  alfa =  #2#0;
  alfa = alfa + "/";
  alfa2 = "0000000" + #2#1;
  alfa2 = alfa2 % -105;
  alfa = alfa + alfa2;
  #101m2 = alfa;
|FINSI;
|SI #0m1 = 9; ||EXPEDIENTES
  alfa =  #4#0;
  |QBF alfa;
  alfa = "000" + alfa;
  alfa = alfa % -102;
  alfa = alfa + "/";
  alfa2 = "0000000" + #4#14;
  alfa2 = alfa2 % -106;
  alfa = alfa + alfa2;
  #101m2 = alfa;
|FINSI;
|FPRC;

|PROCESO claves;
m1 = 15; m2 = 51; m3 = 52; |HAZ claves2;
m1 = 46; m2 = 53; m3 = 54; |HAZ claves2;
m1 = 47; m2 = 55; m3 = 56; |HAZ claves2;
m1 = 48; m2 = 57; m3 = 58; |HAZ claves2;
|FPRC;

|PROCESO registro;
#6#0 = #4#1;
|LEE 001#6=;
|SI FSalida = 0;
 |SI #4#27 ] #0#2; |Y #4#27 [ #0#3;
   |HAZ registrar;
 |FINSI;
|SINO;
 mensa = "No se encuentra la agencia " + #6#0;
 ||MENAV mensa;
 #102#0 = #102#0 + 1;
 #102#1 = mensa;
 |GRABA 001#102n;
|FINSI;
|FPRC;

|PROCESO faclin;
#4#24 = #2#0;
#4#25 = #2#1;
|LEE 001#4=;
|SI FSalida ! 0;
  mensa = "No se encuentra expediente para la factura " + #2#0;
  mensa = mensa + "/";
  mensa = mensa + #2#1;
  mensa = mensa + " (datos relativos a sucursal y tipo exp. seran erroneos)";
  #102#0 = #102#0 + 1;
  #102#1 = mensa;
  |GRABA 001#102n;
  |VETE sinexp;
|FINSI;

|SI #4#19 ] #0#6; |Y #4#19 [ #0#7; |Y #4#16 ] #0#12; |Y #4#16 [ #0#13;
  |ET sinexp;
  #13#0 = #2#0;
  #13#1 = #2#1;
  |LEE 001#13=;
  |SI FSalida ! 0;
    mensa = "No se encuentra el recibo ";
    mensa = mensa + #13#0;
    mensa = mensa + "/"
    mensa = mensa + #13#1;
    #102#0 = #102#0 + 1;
    #102#1 = mensa;
    |GRABA 001#102n;
  |FINSI;
  |HAZ registro;
|FINSI;
|FPRC;

|DEFBUCLE facturas;
#2#4;
;
#0#4,fechaini,"  ",00000;
#0#5,fechafin,"zz",99999;
e;
NULL,faclin;
|FIN;

|DEFBUCLE expedientes;
#4#3;
3,19,16,24;
#0#4,00,000000,fechaini,#0#6,#0#12,"  ";
#0#5,99,999999,fechafin,#0#7,#0#13,"zz";
e;
NULL,registro;
|FIN;

|DEFBUCLE expedientesnofact;
#4#3;
3,19,16,24;
#0#4,00,000000,fechaini,#0#6,#0#12,"  ";
#0#5,99,999999,fechafin,#0#7,#0#13,"  ";
e;
NULL,registro;
|FIN;

|PROCESO porcen;
|SI #0#44 = 1;
  c = numcol1;
  colant = 0;
  |ET porc1l;
  Icm = cm1<-;
  Icm = Icm + c - numcol1;
  colant = cm;

  Icm = cm1<-;
  Icm = Icm + c;
  Ip = p1<-;
  Ip = Ip + c;

  p = cm - colant;
  p = p / colant * 100;
  c = c + 1;
  numcoln = numcol - numcol1;
  |SI c < numcoln;
    |VETE porc1l;
  |FINSI;
|FINSI;

|SI #0#44 = 2;
|PARA i = 0; |SI i < numcol1; |HACIENDO i = i + 1;
  Icm = cm1<-;
  Icm = Icm + numcol - numcol1 + i;
  |SI #0#16 = 5;;
    Icm = Icm + numcol - 1;
  |FINSI;
  camtot = cm;
  c = i;
  |ET porc2l;
  Icm = cm1<-;
  Ip = p1<-;
  Icm = Icm + c;
  Ip = Ip + c;
  p = cm / camtot * 100;
  c = c + numcol1;
  numcoln = numcol - numcol1;
  |SI #0#16 = 5;;
    numcoln = numcoln - 1;
  |FINSI;
  |SI c < numcoln;
    |VETE porc2l;
  |FINSI;
|SIGUE;
|FINSI;

|SI #0#44 = 3;
  |SI finlin = 1;
    p1 = 0; p2 = 0; p3 = 0; p4 = 0; p5 = 0; p6 = 0; p7 = 0; p8 = 0;
    p9 = 0; p10 = 0; p11 = 0; p12 = 0; p13 = 0;
    p14 = 0; p15 = 0; p16 = 0; p17 = 0; p18 = 0; p19 = 0; p20 = 0;
    p21 = 0; p22 = 0; p23 = 0; p24 = 0; p25 = 0;
  |SINO;
    c = 0;
    |ET porc3l;
    Icm = cm1<-;
    Ip = p1<-;
    Itp = tp1<-;
    Icm = Icm + c;
    Ip = Ip + c;
    Itp = Itp + inicol + c ;
    p = cm / tp * 100;
    c = c + 1;
    |SI c < numcol;
      |VETE porc3l;
    |FINSI;
 |FINSI;
|FINSI;

pc1 = p1; pc2 = p2; pc3 = p3; pc4 = p4; pc5 = p5; pc6 = p6; pc7 = p7; pc8 = p8;
pc9 = p9; pc10 = p10; pc11 = p11; pc12 = p12; pc13 = p13;
pc14 = p14; p15 = p15; pc16 = p16; pc17 = p17; pc18 = p18; pc19 = p19; pc20 = p20; pc21 = p21;
pc22 = p22; pc23 = p23; pc24 = p24; pc25 = p25;
|FPRC;

|PROCESO filaa;
|SI finlin = 0;
  fila = "";
  |SI #0#15 ] 8; |O #0#49 = 0;
    fila = #101#51;
    |QBF fila;
    fila = fila + " - ";
  |FINSI;
  |SI #0#15 [ 7;
    fila = fila + #101#52;
    |QBF fila;
  |FINSI;
  fila = fila + " ............................................";
  fila = nivel + fila;
|FINSI;
|FPRC;

|PROCESO iguala;
c1 = cm1; c2 = cm2; c3 = cm3; c4 = cm4; c5 = cm5; c6 = cm6; c7 = cm7;
c8 = cm8; c9 = cm9; c10 = cm10; c11 = cm11; c12 = cm12; c13 = cm13;
c14 = cm14; c15 = cm15; c16 = cm16; c17 = cm17; c18 = cm18; c19 = cm19; c20 = cm20;
c21 = cm21; c22 = cm22; c23 = cm23; c24 = cm24; c25 = cm25;
|FPRC;

|PROCESO subt3;
|SI #0#48 ! 0;
  |SI cl57 ! cl57ant; |O finlin = 1;
      Itttt = tttt1<-;
      Ittt = ttt1<-;
      Icm = cm1<-;
      |PARA c = 0; |SI c [ numcol; |HACIENDO c = c + 1;
        cm = ttt;
        tttt = tttt + ttt;
        ttt = 0;
        Itttt = Itttt + 1;
        Ittt = Ittt + 1;
        Icm = Icm + 1;
      |SIGUE;
      |HAZ iguala;
      |HAZ porcen;
      |SI prim = 1;
        nivel = nivel - "  ";
        fila = nivel + "TOTAL ";
        |SI #0#49 = 0;
          fila = fila + cl57ant; ||TOTAAAAAAAL
          |QBF fila;
          fila = fila + " - ";
        |FINSI;
        fila = fila + cl58ant;
        |QBF fila;
        fila = fila + " ....................";
        |PRINT;
        ||blanco = 1;
        |||PRINT;
        ||blanco = 0;
      |FINSI;
  |SI finlin = 1;
    Itttt = tttt1<-;
    Icm = cm1<-;
    |PARA c = 0; |SI c [ numcol; |HACIENDO c = c + 1;
      cm = tttt;
      Itttt = Itttt + 1;
      Icm = Icm + 1;
    |SIGUE;
    |HAZ iguala;
    |HAZ porcen;
    pintatot = 1;
    fila = "TOTAL ........................";
    |PRINT;
    pintatot = 0;
    finlin = 2;
  |FINSI;
  |FINSI;

|SINO;
  |SI finlin = 1;
    Ittt = ttt1<-;
    Icm = cm1<-;
    |PARA c = 0; |SI c [ numcol; |HACIENDO c = c + 1;
      cm = ttt;
      Ittt = Ittt + 1;
      Icm = Icm + 1;
    |SIGUE;
    |HAZ iguala;
    |HAZ porcen;
    pintatot = 1;
    fila = "TOTAL ........................";
    |PRINT;
    pintatot = 0;
    finlin = 2;
  |FINSI;
|FINSI;
|FPRC;


|PROCESO subt2;
|SI #0#47 ! 0;
  |SI cl55 ! cl55ant; |O cl57 ! cl57ant; |O finlin = 1;
      Ittt = ttt1<-;
      Itt = tt1<-;
      Icm = cm1<-;
      |PARA c = 0; |SI c [ numcol; |HACIENDO c = c + 1;
        cm = tt;
        ttt = ttt + tt;
        tt = 0;
        Ittt = Ittt + 1;
        Itt = Itt + 1;
        Icm = Icm + 1;
      |SIGUE;
      |HAZ iguala;
      |HAZ porcen;
      |SI prim = 1;
        nivel = nivel - "  ";
        fila = nivel + "TOTAL ";
        |SI #0#49 = 0;
          fila = fila + cl55ant; ||TOTAAAAAAAL
          |QBF fila;
          fila = fila + " - ";
        |FINSI;
        fila = fila + cl56ant;
        |QBF fila;
        fila = fila + " ....................";
        |PRINT;
        ||blanco = 1;
        |||PRINT;
        ||blanco = 0;
      |FINSI;
  |FINSI;
|SINO;
 |SI finlin = 1;
  Itt = tt1<-;
  Icm = cm1<-;
  |PARA c = 0; |SI c [ numcol; |HACIENDO c = c + 1;
    cm = tt;
    Itt = Itt + 1;
    Icm = Icm + 1;
  |SIGUE;
  |HAZ iguala;
  |HAZ porcen;
  pintatot = 1;
  fila = "TOTAL ........................";
  |PRINT;
  pintatot = 0;
  finlin = 2;
 |FINSI;
|FINSI;
|FPRC;

|PROCESO subt1;
|SI #0#46 ! 0;
  |SI cl53 ! cl53ant; |O cl55 ! cl55ant; |O cl57 ! cl57ant; |O finlin = 1;
      Itt = tt1<-;
      It = t1<-;
      Icm = cm1<-;
      |PARA c = 0; |SI c [ numcol; |HACIENDO c = c + 1;
        cm = t;
        tt = tt + t;
        t = 0;
        Itt = Itt + 1;
        It = It + 1;
        Icm = Icm + 1;
      |SIGUE;
      |HAZ iguala;
      |HAZ porcen;

    |SI prim = 1;
        nivel = nivel - "  ";
        fila = nivel + "TOTAL ";
        |SI #0#49 = 0;
          fila = fila + cl53ant; ||TOTAAAAAAAL
          |QBF fila;
          fila = fila + " - ";
        |FINSI;
        fila = fila + cl54ant;
        |QBF fila;
        fila = fila + " ....................";
        |PRINT;
        ||blanco = 1;
        |||PRINT;
        ||blanco = 0;
      |FINSI;
  |FINSI;
|SINO;
 |SI finlin = 1;
  It = t1<-;
  Icm = cm1<-;
  |PARA c = 0; |SI c [ numcol; |HACIENDO c = c + 1;
    cm = t;
    It = It + 1;
    Icm = Icm + 1;
  |SIGUE;
  |HAZ iguala;
  |HAZ porcen;
  pintatot = 1;
  fila = "TOTAL ........................";
  |PRINT;
  pintatot = 0;
  finlin = 2;
 |FINSI;
|FINSI;
|FPRC;

|PROCESO cab1;
|SI #0#46 ! 0;
  |SI cl53 ! cl53ant; |O cl55 ! cl55ant; |O cl57 ! cl57ant;
      |SI finlin = 0;

        fila = "";   ||CABECERAAAAAA
        |SI #0#49 = 0;
          fila = cl53; ||TOTAAAAAAAL
          |QBF fila;
          fila = fila + " - ";
        |FINSI;
        fila = fila + cl54;
        fila = nivel + fila;
        blanco = 2;
        |PRINT;
        blanco = 0;
        nivel = nivel + "  ";
    |FINSI;
  |FINSI;
|FINSI;
|FPRC;

|PROCESO cab2;
|SI #0#47 ! 0;
  |SI cl55 ! cl55ant; |O cl57 ! cl57ant;
      |SI finlin = 0;
        fila = "";   ||CABECERAAAAAA
        |SI #0#49 = 0;
          fila = cl55; ||TOTAAAAAAAL
          |QBF fila;
          fila = fila + " - ";
        |FINSI;
        fila = fila + cl56;
        fila = nivel + fila;
        blanco = 2;
        |PRINT;
        blanco = 0;
        nivel = nivel + "  ";
    |FINSI;
  |FINSI;
|FINSI;
|FPRC;

|PROCESO cab3;
|SI #0#48 ! 0;
  |SI cl57 ! cl57ant;
      |SI finlin = 0;
        fila = "";   ||CABECERAAAAAA
        |SI #0#49 = 0;
          fila = cl57; ||TOTAAAAAAAL
          |QBF fila;
          fila = fila + " - ";
        |FINSI;
        fila = fila + cl58;
        fila = nivel + fila;
        blanco = 2;
        |PRINT;
        blanco = 0;
        nivel = nivel + "  ";
      |FINSI;
  |FINSI;
|FINSI;
|FPRC;

|PROCESO listar;
cl53 = #101#53;
cl54 = #101#54;
cl55 = #101#55;
cl56 = #101#56;
cl57 = #101#57;
cl58 = #101#58;


|HAZ subt1;
|HAZ subt2;
|HAZ subt3;

|HAZ cab3;
|HAZ cab2;
|HAZ cab1;

   prim = 1;
  |SI #0#35 ! 0;
    nlinea = nlinea + 1;
    |SI nlinea > #0#35;
      nlinea = 0;
      |ERROR10;
      |VETE final;
    |FINSI;
  |FINSI;
  c =0;
  Icm=cm1<-;
  It=t1<-;
  It=It + inicol;
  |ET asiganyo;
  |SI finlin = 0;
      campoanyo = inicol + c;
      cm = #101campoanyo;
  |SINO;
    cm = t;
    It = It + 1;
  |FINSI;
  c = c + 1;
  Icm = Icm + 1;
  numcoln = c;

  |SI c < numcol;
    |VETE asiganyo;
  |FINSI;


|SI finlin = 0;
  It = t1<-;
  Icm = cm1<-;
  |PARA c = 0; |SI c [ numcol; |HACIENDO c = c + 1;
    t = t + cm;
    It = It + 1;
    Icm = Icm + 1;
  |SIGUE;
  |HAZ iguala;
  |HAZ porcen;
  |HAZ filaa;
  |PRINT;
|FINSI;
cl53ant = #101#53;
cl54ant = #101#54;
cl55ant = #101#55;
cl56ant = #101#56;
cl57ant = #101#57;
cl58ant = #101#58;
|ET final;
|FPRC;

|DEFBUCLE listado;
#101#1;
;
INICIO;
FINAL;
e;
NULL,listar;
|FIN;

|DEFBUCLE listadoord;
#101#2;
;
INICIO;
FINAL;
e;
NULL,listar;
|FIN;

|DEFBUCLE listado2;
#101#3;
;
INICIO;
FINAL;
e;
NULL,listar;
|FIN;

|PROCESO fpa;
numcol2 = numcol2 + 1;
ccm = #8#1;
Iccm = Iccm + numcol1;
|FPRC;

|DEFBUCLE fp;
#8#1;
;
INICIO;
FINAL;
e;
NULL,fpa;
|FIN;

|PROCESO erroress;
  |PRINT;
|FPRC;

|DEFBUCLE errores;
#102#1;
;
INICIO;
FINAL;
e;
NULL,erroress;
|FIN;

|PROCESO principal;
  |ABRE #4;
  |ABRE #3;
  |ABRE #5;
  |ABRE #12;
  |ABRE #6;
  |ABRE #7;
  |ABRE #8;
  |ABRE #9;
  |ABRE #10;
  |ABRE #11;
  |ABRE #13;
  fichero = Usuario;
  |NOME_DAT #101 fichero;
  |DELINDEX #101;
  |ABRE #101;
  fechaini = #0#0;
  fechafin = #0#1;
  inicol = 27;
  fincol = 39;

||||||||||||CUENTA columna
    Iccm = ccm1<-;
    c = 20;
    |ET conce;
    c = c + 1;
    |SI #0c ! 0;
      Iccm = Iccm + 1;
      numcol1 = numcol1 + 1;
      |VETE conce;
    |FINSI;

  |SI #0#16 = 1;
    numcol2 = 13;
    inicol = 27;
    Iccm = ccm1<-;
    ccm = "Enero";
    Iccm = Iccm + numcol1;
    ccm = "Febrero";
    Iccm = Iccm + numcol1;
    ccm = "Marzo";
    Iccm = Iccm + numcol1;
    ccm = "Abril";
    Iccm = Iccm + numcol1;
    ccm = "Mayo";
    Iccm = Iccm + numcol1;
    ccm = "Junio";
    Iccm = Iccm + numcol1;
    ccm = "Julio";
    Iccm = Iccm + numcol1;
    ccm = "Agosto";
    Iccm = Iccm + numcol1;
    ccm = "Septiembre";
    Iccm = Iccm + numcol1;
    ccm = "Octubre";
    Iccm = Iccm + numcol1;
    ccm = "Noviembre";
    Iccm = Iccm + numcol1;
    ccm = "Diciembre";
    Iccm = Iccm + numcol1;
    ccm = "TOTAL";
  |FINSI;

  |SI #0#16 = 2;
    inicol = 27;
    fincol = 39;
    numcol2 = #0#19-#0#18+2;
    anyoini = #0#18;
    anyofin = #0#19;
    |ET anyocab;
    campoanyo = anyoini - #0#18;
    campoanyo = campoanyo * numcol1;
    Iccm=ccm1<-;
    Iccm=Iccm + campoanyo;
    ccm = "A¥O " + anyoini;
    anyoini = anyoini + 1;
    |SI anyoini [ anyofin;
      |VETE anyocab;
    |FINSI;
    Iccm=ccm1<-;
    Iccm=Iccm + campoanyo + numcol1;
    ccm = "TOTAL "
    periodoini = #0#18;
    periodofin = #0#19;
    periodoini = periodoini % 302;
    periodofin = periodofin % 302;
    ccm = ccm + periodoini;
    ccm = ccm + "-";
    ccm = ccm + periodofin;
    numcol = campoanyo + 2;
    anyoini = #0#18;
    anyofin = #0#19;
    periodoini = fechaini % 105;
    periodofin = fechafin %105;
    fechaini = periodoini + ".";
    fechaini = fechaini + #0#18;
    fechafin = periodofin + ".";
    fechafin = fechafin + #0#18;
  |FINSI;

  |SI #0#16 = 4;
    inicol = 27;
    fincol = 39;
    numcol1 = 0;
    Iccm = ccm1<-;
    numcol2 = 0;
    |BUCLE fp;
    ccm = "TOTAL F.P."
    numcol2 = numcol2 + 1;
  |FINSI;

  |SI #0#16 = 5;
    numcol2 = 1;
    inicol = 27;
  |FINSI;

    Icccm = cccm1<-;
    c = 20;
    campo = 1;
    |ET conce3;
    c = c + 1;
    |SI #0c = 1;
      cccm = "Hon Normal";
    |FINSI;
    |SI #0c = 2;
      cccm = "Hon Urgente";
    |FINSI;
    |SI #0c = 3;
      cccm = "Honorarios";
    |FINSI;
    |SI #0c = 4;
      cccm = "Supl Consul.";
    |FINSI;
    |SI #0c = 5;
      cccm = "Seguros";
    |FINSI;
    |SI #0c = 6;
      cccm = "Suplidos";
    |FINSI;
    |SI #0c = 7;
      cccm = "Mensajeria";
    |FINSI;
    |SI #0c = 8;
      cccm = "Descuento";
    |FINSI;
    |SI #0c = 9;
      cccm = "Total ";
    |FINSI;
    |SI #0c = 10;
      cccm = "IVA ";
    |FINSI;
    |SI #0c = 11;
      cccm = "Total + IVA ";
    |FINSI;
    |SI #0c = 12;
      cccm = "Cobrado ";
    |FINSI;
    |SI #0c = 13;
      cccm = "Pendiente Cobro ";
    |FINSI;
    |SI #0c = 14;
      cccm = "N§ Visados";
    |FINSI;
    |SI #0c = 15;
      cccm = "N§ Honor";
    |FINSI;
    |SI #0c = 16;
      cccm = "N§ Mensa";
    |FINSI;
    |SI #0c = 17;
      cccm = "Supl Varios";
    |FINSI;
    |SI #0c ! 0;
      Icccm = Icccm + 1;
      |VETE conce3;
    |SINO;
      |SI campo < numcol2;
          c = 20;
          campo = campo + 1;
        |VETE conce3;
      |FINSI;
    |FINSI;

    numcol = numcol1 * numcol2;
    numcolis = numcol;
    |SI #0#44 = 1; |O #0#44 = 2;
      numcolis = numcol - numcol1;
    |FINSI;
    fincol = inicol + numcol - numcol1;

/* CONTROL DESACTIVADO
|SI numcol > 20;
  |MENAV "0000Se supera el limite de 20 columnas, redefina el listado"
  |VETE acabar;
|FINSI;
*/

|SI #0#16 ! 5;
  cc1 = ccm1; cc2 = ccm2; cc3 = ccm3; cc4 = ccm4; cc5 = ccm5; cc6 = ccm6; cc7 = ccm7;
  cc8 = ccm8; cc9 = ccm9; cc10 = ccm10; cc11 = ccm11; cc12 = ccm12; cc13 = ccm13;
  cc14 = ccm14; cc15 = ccm15; cc16 = ccm16; cc17 = ccm17; cc18 = ccm18; cc19 = ccm19; cc20 = ccm20;
  cc21 = ccm21; cc22=ccm22; cc23 = ccm23; cc24 = ccm24; cc25 = ccm25;
|FINSI;

  ccc1 = cccm1; ccc2 = cccm2; ccc3 = cccm3; ccc4 = cccm4; ccc5 = cccm5; ccc6 = cccm6; ccc7 = cccm7;
  ccc8 = cccm8; ccc9 = cccm9; ccc10 = cccm10; ccc11 = cccm11; ccc12 = cccm12; ccc13 = cccm13;
  ccc14 = cccm14; ccc15 = cccm15; ccc16 = cccm16; ccc17 = cccm17; ccc18 = cccm18; ccc19 = cccm19; ccc20 = cccm20;
  ccc21 = cccm21; ccc22 = cccm22; ccc23 = cccm23; ccc24 = cccm24; ccc25 = cccm25;

    blanco = 3;
    |PRINT;
    blanco = 0;

  |ET inicio;

  |SI #0#14 = 1;
    |SELECT #5#4;
    |BUCLE facturas;
  |FINSI;
  |SI #0#14 = 2;
  |FINSI;
  |SI #0#14 = 4;
    |BUCLE expedientes;
  |FINSI;
  |SI #0#14 = 5;
    |BUCLE expedientesnofact;
  |FINSI;

  |SI #0#16 = 2;
    anyoini = anyoini + 1;
    anyo = anyoini;
    |SI anyoini [ anyofin;
      fechaini = periodoini + "." + anyo;
      fechafin = periodofin + "." + anyo;
      |VETE inicio;
    |FINSI;
  |FINSI;

  prim = 0;
  |SI #0#20 = 0;
   |SI #0#49 < 2;
     |BUCLE listado;
   |SINO;
     |BUCLE listado2;
   |FINSI;
  |SINO;
    |BUCLE listadoord;
  |FINSI;

  |SI #0#15 ! 6;
    finlin = 1;
    |HAZ listar;
    finlin = 0;
  |FINSI;
  |PIEINF;
  |FININF;
  |FINIMP;
  |CIERRA #101;
  |DELINDEX #101;
|FPRC;

|PROCESO correo;
    |SLEEP 15;
    mensa = "0000SEnviar al grupo " + #11#0;
    mensa = mensa + " - ";
    mensa = mensa + #11#1;
    |QBF mensa;
    mensa = mensa + " (ANTES CERRAR ARCHIVO!)";
    |CONFI mensa;
    |SI FSalida = 0;
    |DBASS ficheros;
    ficheros = ficheros + "estadist/cap270.pdf";
    to = #11#2;
    |QBF to;
    |DSCORREO_ENVIA ip,serv,from,to,subject,mensaje,ficheros;
    |SI FSalida ! 0;
      mensa = "0000Error en el envio de correo";
      |MENAV mensa;
    |FINSI;
    |FINSI;
|FPRC;

|PROCESO inivariables;
camp = 0;
c = 0;
d = 0;
e = 0;
col = "";
tcol = "";
ttcol = "";
fechaini = "";
fechafin = "";
anyoini = 0;
anyofin = 0;
periodoini = "";
periodofin = "";
anyo = "";
fechareg = "";
mes = "";
nmes = 0;
campomes = 0;
campoanyo = 0;
numcol = 0;
numcolis = 0;
colant = 0;
nanyo = 0;
numanyo = 0;
numcoln = 0;
camtot = 0;
inicol = 0;
fincol = 0;
finlin = 0;
fp = 0;
descu = 0;
nlinea = 0;
alfa = "";
alfa2 = "";
cantidad = 0;
cl53 = "";
cl54 = "";
cl55 = "";
cl56 = "";
cl57 = "";
cl58 = "";
cl53ant = "";
cl54ant = "";
cl55ant = "";
cl56ant = "";
cl57ant = "";
cl58ant = "";
prim = 0;
blanco = 0;
nivel = "";
pais = "";
pais2 = "";
campo = 0;
campo2 = 0;
numcol1 = 0;
numcol2 = 1;
campop = 0;
co = 0;
cols = 0;
campotot = 0;
i = 0;
salida = "";
It=t1<-;
|PARA c = 0; |SI c < 49; |HACIENDO c = c + 1;
  It = It + 1;
  t = 0;
|SIGUE;
Itt=tt1<-;
|PARA c = 0; |SI c < 49; |HACIENDO c = c + 1;
  Itt = Itt + 1;
  tt = 0;
|SIGUE;
Ittt=ttt1<-;
|PARA c = 0; |SI c < 49; |HACIENDO c = c + 1;
  Ittt = Ittt + 1;
  ttt = 0;
|SIGUE;
Itttt=tttt1<-;
|PARA c = 0; |SI c < 49; |HACIENDO c = c + 1;
  Itttt = Itttt + 1;
  tttt = 0;
|SIGUE;
Itp=tp1<-;
|PARA c = 0; |SI c < 49; |HACIENDO c = c + 1;
  Itp = Itp + 1;
  tp = 0;
|SIGUE;
|FPRC;

|PROCESO gruposl;
alfa = #11#2;
|QBF alfa;
|SI alfa ! "";
  |SALVA_FICHA #11;
  #0#2 = #11#0;
  #0#3 = #11#0;
  |HAZ inivariables;
  |HAZ limpia;
  |SI repe = 1;
    |SI impr = 0;
      |IMPRE #0;
      |SI FSalida ! 0;
        |VETE acabar;
      |FINSI;
    |SINO;
      Impresora = impres;
      |IMPRE -1;
      |SI FSalida ! 0;
        mensa = "0000Impresora mal definida";
        |MENAV mensa;
        |VETE acabar;
    |FINSI;
    |FINSI;
    |INFOR informe;
  |FINSI;
  |HAZ principal;
  repe = 1;
  |REPON_FICHA #11;
  |HAZ correo;
|FINSI;
|FPRC;

|DEFBUCLE grupos;
#11#1;
;
INICIO;
FINAL;
e;
NULL,gruposl;
|FIN;

|PROGRAMA;
|CLS;
|ABRE #1;

|SI PARAMETRO > 0;
  #1#42 = PARAMETRO;
  |LEE 001#1=;
|SINO;
  |CONSULTA_CLAVE #1#1;
|FINSI;

|SI FSalida = 0;
|HAZ llena;
|SI #0#44 > 0;
  pr = "%";
|FINSI;
|PINPA #0#0;
|PINDA #0#0;
|HAZ limpia;
|ABRE #0;
|ENDATOS #2#0;
|SI FSalida = 0;
 impres = #0#55;
 |QBF impres;
 |SI impres = "";
   |IMPRE #0;
   salida = FSalida;
   impr = 0;
 |SINO;
   Impresora = impres;
   |IMPRE -1;
   salida = FSalida;
   impr = -1;
 |FINSI;
 |SI salida = 0;
  |ABRE #97;
  #97#0 = "A";
  |LEE 001#97=;
  |SI FSalida ! 0;
    |MENAV "0000Falta definir parametros";
  |FINSI;
  informe = #0#53;
  |INFOR informe;
  |SI FSalida = 0;
    |DELINDEX #102;
    |ABRE #102;
    |SI #0#56 = 0;
      |HAZ principal;
    |FINSI;
    |SI #0#56 = 1;
      |ABRE #98;
        #98#0 = "A";
        |LEE 001#98=;
        |SI FSalida = 0;
          |IP_REMOTO ip;
          from = #98#2;
          subject = #98#3;
          mensaje = #98#4;
          |QBF ip;
          |QBF from;
          |QBF subject;
          |QBF mensaje;
        |SINO;
          mensa = "0000Falta definir parametros envio";
          |MENAV mensa;
          |VETE acabar;
        |FINSI;
      |CIERRA #98;
      |BUCLE grupos;
    |FINSI;
  |SINO;
    mensa = "0000No se encuentra el informe " + informe;
    |MENAV mensa;
    |VETE acabar;
  |FINSI;
  |SI #102#0 > 0;
    mensa = "0000SSe han producido errores, desea imprimirlos?";
    |CONFI mensa;
    |SI FSalida = 0;
      informe = "visam102";
      |IMPRE #0;
      |SI FSalida = 0;
          |INFOR informe;
          |BUCLE errores;
        |FININF;
        |FINIMP;
      |FINSI;
    |FINSI;
    |CIERRA #102;
  |FINSI;
  |ET acabar;
  |CIERRA #97;
 |FINSI;
|FINSI;
|CIERRA #0;
|FINSI;
|CIERRA #1;
  |CIERRA #13;
  |CIERRA #11;
  |CIERRA #10;
  |CIERRA #9;
  |CIERRA #8;
  |CIERRA #7;
  |CIERRA #6;
  |CIERRA #12;
  |CIERRA #4;
  |CIERRA #3;
  |CIERRA #5;
|FPRO;
