|FICHEROS;
     asy00004 #0;
     ashismic #1;
     ashismil #2;
     asempres #6;
     :/basica/def/agitab03 #3;
     :/integral/def/dsam0008 #4;
     :/integral/def/dsam0105 #5;
     asw00026 #99;
|FIN;

|VARIABLES;
     nAgente     = 0;
     nConcepto   = 0;
     nSwHay      = 0;

     aFichero    = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aAlfa3      = "";

     &eaPathIntegral = "";
     &eaDescr        = "";
|FIN;

|PROCESO BuscaConcepto;
     |SI #3#2 = "    "; |Y #3#3 = "  "; |ACABA; |FINSI;
     |SI #3#5 ! #48#0;  |Y #3#5 ! 0;    |ACABA; |FINSI;
     |SI #3#2 ! #2#4;   |O #3#3 ! #2#5; |ACABA; |FINSI;

     nConcepto = #3#0;
     |ERROR10;
|FPRC;

|DEFBUCLE agitab03;
     #3#1;
     ;
     00;
     99;
     ;
     NULL, BuscaConcepto;
|FIN;

|PROCESO GrabaAgente;
     |SI #4#16 < #0#0;  |O #4#16 > #0#1;
         |ACABA;
     |FINSI;

     |SI #4#18 = 0;  |ACABA;  |FINSI;

     #5#0 = #4#16;
     |LEE 040#5=;
     |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;

     #99#0  = #5#0;
     #99#1  = #2#0;
     #99#2  = #2#1;
     #99#3  = #2#2;
     #99#4  = #5#2;
     #99#5  = #5#1;
     #99#6  = #5#3;
     #99#7  = #5#4;
     #99#8  = #5#5;
     #99#9  = #5#8;
     #99#10 = #5#9;
     #99#11 = #5#10;
     #99#12 = #5#11;
     #99#13 = #1#3;
     #99#14 = #1#4;
     #99#15 = #1#29;
     #99#16 = #2#13;
     #99#17 = #4#18;
     #99#18 = #99#16 % #99#17;
     |GRABA 020#99n;
     |LIBERA #99;

     nSwHay = 1;

     |ERROR10;
|FPRC;

|DEFBUCLE dsam0008;
     #4#1;
     2;
     #1#3, 00, nConcepto;
     #1#3, 99, nConcepto;
     ;
     NULL, GrabaAgente;
|FIN;

|PROCESO LineasFac;
     nConcepto = 0;
     |BUCLE agitab03;
     |SI nConcepto = 0;  |ACABA;  |FINSI;

     |BUCLE dsam0008;
|FPRC;

|DEFBUCLE ashismic;
     #1#2;
     ;
     #0#2, #0#4, #0#6;
     #0#3, #0#5, #0#7;
     ;
     NULL, NULL, LineasFac;
|FIN;

|PROCESO Imprime;
     |SI nAgente = 0;  nAgente = #99#0;  |FINSI;

     |SI nAgente ! #99#0;
         |PIEINF;
         nAgente = #99#0;
     |FINSI;

     |PRINT;
|FPRC;

|DEFBUCLE asw00026;
     #99#1;
     ;
     00, "  ", 00000, 000;
     99, "zz", 99999, 999;
     ;
     NULL, Imprime;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |HAZ BusquedaApli;
     |SI eaPathIntegral = "";
         |MENAV "      Solo se puede ejecutar con la Integrada.";
         |ACABA;
     |FINSI;

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aFichero = ("26" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #99 aFichero;
     |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

     |ABRE #99;
     |ABRE #5;
     |BUCLE ashismic;
     |CIERRA #5;
     |CIERRA #99;

     |SI nSwHay = 0;
         |MENAV "      Seleccion Vacia.";
         |FINIMP;
         |ACABA;
     |FINSI;

     |INFOR "asy00004";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |ABRE #6;
     #6#0 = #0#10;
     |LEE 040#6=;
     |SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;
     |CIERRA #6;

     aAlfa1 = #6#4;  aAlfa1 = ("00"  + aAlfa1) % -102;
     aAlfa2 = #6#5;  aAlfa2 = ("000" + aAlfa2) % -103;
     aAlfa3 = #6#3;  |QBF aAlfa3;

     eaDescr = (#6#2 % 115) + " " + aAlfa1 + aAlfa2 + " " + aAlfa3;
     |QBF eaDescr;
     eaDescr = ((" " * 40) + eaDescr) % -140;


     nAgente = 0;
     |BUCLE asw00026;

     |PIEINF;
     |FININF;
     |FINIMP;

     |ABRE #99;  |CIERRA #99;  |DELINDEX #99;
|FPRC;
