|FICHEROS;
     abxz0059 #959;

     abom0014 #14;
     abom0015 #15;
     abom0514 #514;
     abom0518 #518;
|FIN;

|VARIABLES;
     nRango          = 0;
     nHandle         = 0;
     nLong           = 0;
     nCaracter       = 0;
     nPos            = 0;
     nVentana        = 0;
     nSubVent        = 0;
     nVent           = 0;
     nCampo          = 0;
     nBoton1         = 0;
     nBoton2         = 0;
     nBoton3         = 0;
     nBoton4         = 0;
     nBoton5         = 0;
     nBoton6         = 0;
     nSubBoton1      = 0;
     nDExpediente    = 0;
     nHExpediente    = 0;
     nSubPanta       = 0;
     nModo           = 0;
     nCont           = 0;
     nPasa           = 0;
     nError          = 0;
     nPosi           = 0;
     nLen            = 0;
     nSwEnvio        = 0;
     nSwMensaje      = 0;
     nDirecto        = 0;
     nNume1          = 0;
     nNume2          = 0;
     nTecla          = 0;
     nSwPon          = 0;
     nLinea          = 0;
     nGuardaExpe     = 0;

     fFecha          = @;

     aEsc1           = "";
     aEsc2           = "";
     aRetu           = "";
     aTecla          = "";
     aAlfa           = "";
     aHora           = "";
     aNumero         = "";
     aPersona        = "";
     aCadena         = "";
     aComodin        = "";
     aAbre           = "";
     aBase           = "";
     aMas            = "";
     aRutaCorreo     = "";
     aCorreo         = "";
     aEjecuta        = "";
     aEnviado        = "";
     aRef            = "";
     aFic            = "";
     aIncidencia     = "";
     aLen            = "";
     aCaracter       = "";
     aReferencia     = "";
     aFicheroActu    = "";
     aDSCorreo       = "";
     aProxy          = "";
     aUsu            = "";
     aPwd            = "";
     aNombre         = "";
     aAlfa1          = "";
     aDirOri         = "";
     aDirDes         = "";
     aTitulo         = "";
     aTexto          = "";
     aMenLog         = "";
     aOrigen         = "";
     aDestino        = "";
     aLong           = "";
     aRuta           = "";
     aDBase          = "";
     aPathPaq        = "";

     {-1}aVent       = "";
         aVent1      = 0;
         aVent2      = 0;
         aVent3      = 0;
         aVent4      = 0;
         aVent5      = "";


     {1}aContiene    = "";

     &enGrid1         = 0;
     &enPanta0        = 0;
     &enSubPanta      = 0;
     &enExped         = 0;
     &enContador      = 0;
     &enLabel1        = -1;
     &enLabel2        = -1;
     &enLabel3        = -1;
     &enExpediente    = 0;
     &enCodUbica      = 0;
     &eaRutaDocumento = "";
     &efFechaDocu     = @;
     &eaFicheroEdita  = "";
     &eaFichAdjunto   = "";
     &enCodExpe       = 0;
     &enCodPers       = 0;
     &enCuenta        = 0;
     &enFSalida       = 0;
     &enError         = 0;
     &eaUnidadBasico = "";
|FIN;

|| **************************************************************************
|| PROCESO DE LA BANDEJA DE ENTRADA GENERAL
|| **************************************************************************

|PROCESO Consultar14;
     aAlfa = #abom0014#11;  |QBF aAlfa;
     |SI aAlfa ! "";
         aAlfa = "CONSULTA CORREO  (DE: " + #abom0014#11;  |QBF aAlfa;
         aAlfa = aAlfa + "   enviado el " + #abom0014#3;  |QBF aAlfa;
         aAlfa = aAlfa + ")";
     |SINO;
         aAlfa = "CONSULTA CORREO  (Correo enviado el " + #abom0014#3;  |QBF aAlfa;
         aAlfa = aAlfa + ")";
     |FINSI;

     |VENTANA 0501, 2799, -1, 17, aAlfa;
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enContador = #14#0;
     |SUB_EJECUTA_NP "abxz0001;CONSULTA14";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;
|FPRC;

|PROCESO Editar14;
     |SI #14#6 = 0;
         |MENAV "     No hay Fichero Adjunto";
         |ACABA;
     |FINSI;

     |VENTANA 0501, 2799, -1, 17, "Editando fichero adjunto";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "LABEL,{{5}}Editando fichero adjunto", 1320, 1498, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{2}}Espere por favor ...", 1640, 1698, NULL;

     |PTEC 802;
     |PAUSA;

     |SI #14#9 = "N";
         eaFicheroEdita = #14#5;  |QBF eaFicheroEdita;
         |SI eaFicheroEdita ! "";
             efFechaDocu    = #14#8;
             enCodUbica     = #14#6;  |HAZ LeeUbicaciones;
             eaFicheroEdita = #14#5;  |QBF eaFicheroEdita;
             aAlfa1 = eaRutaDocumento + "/";
             eaFicheroEdita = eaFicheroEdita - aAlfa1;
             |HAZ AbreDocumento;
         |SINO;
             |MENAV "     No hay Fichero Adjunto";
         |FINSI;
     |SINO;
         aAlfa = #14#5;  |QBF aAlfa;
         |SI aAlfa ! "";
             efFechaDocu = #14#8;
             enCodUbica  = #14#6;  |HAZ LeeUbicaciones;
             aAlfa       = eaRutaDocumento + "/" + #14#5;  |QBF aAlfa;

             |SI #514#21 ! "C";
                 aLong    = aAlfa % 0;
                 nLong    = aLong;
                 aRuta    = "";

                 |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
                       nPosi     = (100 * nCaracter) + 1;
                       aCaracter = aAlfa % nPosi;
                       |SI aCaracter = "/";
                           aCaracter = "\";
                       |FINSI;
                       aRuta = aRuta + aCaracter;
                 |SIGUE;
                 aAlfa = aRuta;
             |SINO;
                 aOrigen = aAlfa;
                 aDestino = eaUnidadBasico + "\DOCUMENTOS\IPABOGAD\" + #14#5;  |QBF aDestino;
                 |ENVIA_FICHERO aOrigen, aDestino;

                 aAlfa = aDestino;
             |FINSI;

             aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
             |RSYSTEM aAlfa;

             |RFBORRA aDestino;
         |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;
|FPRC;

|PROCESO Borrar14;
     |CONFI "0000NEsta Seguro de Borrar el Correo ";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#14=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     efFechaDocu = #14#7;
     enCodUbica  = #514#9;  |HAZ LeeUbicaciones;
     aAlfa       = eaRutaDocumento + "/" + (("00000000" + #14#0) % -108) + ".txt";
     |SI #514#21 ! "C";
         |RFBORRA aAlfa;
     |SINO;
         |FBORRA aAlfa;
     |FINSI;

     |BORRA 020#14a;
     |LIBERA #14;

     |REFRESCACONTROL enGrid1;
|FPRC;

|PROCESO EventoPanta14;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#14=;
         |SI FSalida = 0;
             |ESTADO_CONTROL nBoton1, "ENABLE";
             |ESTADO_CONTROL nBoton2, "ENABLE";
             |ESTADO_CONTROL nBoton3, "ENABLE";
         |SINO;
             |ESTADO_CONTROL nBoton1, "DISABLE";
             |ESTADO_CONTROL nBoton2, "DISABLE";
             |ESTADO_CONTROL nBoton3, "DISABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
         |HAZ Consultar14;
     |FINSI;
|FPRC;

|PROCESO EntradaGeneral;
     |CONTROL_SIMPLE 0, "BOTON,{{197}} Consulta correo", 2602, 2717, Consultar14;
     nBoton1  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}} Editar adjunto", 2619, 2732, Editar14;
     nBoton2  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}} Borrar correo", 2634, 2747, Borrar14;
     nBoton3  = FSalida;

     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton3, "DISABLE";

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#14, nRango, 0602, 2698, NULL, NULL, EventoPanta14;

     enGrid1  = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + enGrid1;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |PULSATECLA;

     |DESTRUYECONTROL enGrid1;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
|FPRC;

|| **************************************************************************
|| PROCESO DE LA BANDEJA DE ENTRADA EXPEDIENTE
|| **************************************************************************

|PROCESO Consultar15;
     aAlfa = #abom0015#11;  |QBF aAlfa;
     |SI aAlfa ! "";
         aAlfa = "CONSULTA CORREO  (DE: " + #abom0015#11;  |QBF aAlfa;
         aAlfa = aAlfa + "   enviado el " + #abom0015#3;  |QBF aAlfa;
         aAlfa = aAlfa + ")";
     |SINO;
         aAlfa = "CONSULTA CORREO  (Correo enviado el " + #abom0015#3;  |QBF aAlfa;
         aAlfa = aAlfa + ")";
     |FINSI;

     |VENTANA 0501, 2799, -1, 17, aAlfa;
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enExped    = #15#0;
     enContador = #15#1;
     |SUB_EJECUTA_NP "abxz0001;CONSULTA15";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;
|FPRC;

|PROCESO Editar15;
     |SI #abom0015#12 = "S";
         |DBASE aDBase;
         aPathPaq = aDBase + "documentos";
         aPathPaq = aPathPaq + "/correos";
         aPathPaq = aPathPaq + "/paquetes/";

         aOrigen = aPathPaq + #abom0015#5;  |QBF aOrigen;
         aDestino = eaUnidadBasico + "\DOCUMENTOS\IPABOGAD\" + #15#5;  |QBF aDestino;
         |ENVIA_FICHERO aOrigen, aDestino;

         aAlfa = aDestino;

         aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
         |RSYSTEM aAlfa;

         |RFBORRA aDestino;

         |ACABA;
     |FINSI;

     |SI #15#6 = 0;
         |MENAV "     No hay Fichero Adjunto";
         |ACABA;
     |FINSI;

     |VENTANA 0501, 2799, -1, 17, "Editando fichero adjunto";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "LABEL,{{5}}Editando fichero adjunto", 1320, 1498, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{2}}Espere por favor ...", 1640, 1698, NULL;

     |PTEC 802;
     |PAUSA;

     |SI #15#9 = "N";
         eaFicheroEdita = #15#5;  |QBF eaFicheroEdita;
         |SI eaFicheroEdita ! "";
             efFechaDocu    = #15#8;
             enCodUbica     = #15#6;  |HAZ LeeUbicaciones;
             eaFicheroEdita = #15#5;  |QBF eaFicheroEdita;
             aAlfa1 = eaRutaDocumento + "/";
             eaFicheroEdita = eaFicheroEdita - aAlfa1;
             |HAZ AbreDocumento;
         |SINO;
             |MENAV "     No hay Fichero Adjunto";
         |FINSI;
     |SINO;
         aAlfa = #15#5;  |QBF aAlfa;
         |SI aAlfa ! "";
             efFechaDocu = #15#8;
             enCodUbica  = #15#6;  |HAZ LeeUbicaciones;
             aAlfa       = eaRutaDocumento + "/" + #15#5;  |QBF aAlfa;

             |SI #514#21 ! "C";
                 aLong    = aAlfa % 0;
                 nLong    = aLong;
                 aRuta    = "";

                 |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
                       nPosi     = (100 * nCaracter) + 1;
                       aCaracter = aAlfa % nPosi;
                       |SI aCaracter = "/";
                           aCaracter = "\";
                       |FINSI;
                       aRuta = aRuta + aCaracter;
                 |SIGUE;
                 aAlfa = aRuta;
             |SINO;
                 aOrigen = aAlfa;
                 aDestino = eaUnidadBasico + "\DOCUMENTOS\IPABOGAD\" + #15#5;  |QBF aDestino;
                 |ENVIA_FICHERO aOrigen, aDestino;

                 aAlfa = aDestino;
             |FINSI;

             aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
             |RSYSTEM aAlfa;

             |RFBORRA aDestino;
         |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;
|FPRC;

|PROCESO Borrar15;
     |CONFI "0000NEsta Seguro de Borrar el Correo ";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#15=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     efFechaDocu = #15#7;
     enCodUbica  = #514#9;  |HAZ LeeUbicaciones;
     aAlfa       = eaRutaDocumento + "/" + (("00000000" + #15#0) % -108) + (("0000" + #15#1) % -104) + ".txt";
     |SI #514#21 ! "C";
         |RFBORRA aAlfa;
     |SINO;
         |FBORRA aAlfa;
     |FINSI;

     |BORRA 020#15a;
     |LIBERA #15;

     |REFRESCACONTROL enGrid1;
|FPRC;

|PROCESO EventoPanta15;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#15=;
         |SI FSalida = 0;
             |ESTADO_CONTROL nBoton1, "ENABLE";
             |ESTADO_CONTROL nBoton2, "ENABLE";
             |ESTADO_CONTROL nBoton3, "ENABLE";
         |SINO;
             |ESTADO_CONTROL nBoton1, "DISABLE";
             |ESTADO_CONTROL nBoton2, "DISABLE";
             |ESTADO_CONTROL nBoton3, "DISABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
         |HAZ Consultar15;
     |FINSI;
|FPRC;

|PROCESO Baja15;
     #15#0  = enExped;
     #15#1  = 1;
|FPRC;

|PROCESO Alta15;
     #15#0  = enExped;
     #15#1  = 9999;
|FPRC;

|PROCESO EntradaExpediente;
     |CONTROL_SIMPLE 0, "BOTON,{{197}} Consulta correo", 3202, 3317, Consultar15;
     nBoton1  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}} Editar adjunto", 3219, 3332, Editar15;
     nBoton2  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}} Borrar correo", 3234, 3347, Borrar15;
     nBoton3  = FSalida;

     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton3, "DISABLE";

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#15, nRango, 0602, 2698, Baja15, Alta15, EventoPanta15;

     enGrid1  = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + enGrid1;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |PULSATECLA;

     |DESTRUYECONTROL enGrid1;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
|FPRC;

|| **************************************************************************
|| PROCESO GENERAL
|| **************************************************************************

|PROCESO Tipo80Fxz59; |TIPO 80;
     |ABRE #514;
     |LEE 000#514p;
     |SI FSalida ! 0;  |DDEFECTO #514;  |FINSI;
     |CIERRA #514;

     |ABRET #14;
     |ABRET #15;

     |SI enExped = 0;
         FSalida = 2799;
     |SINO;
         FSalida = 3399;
     |FINSI;
|FPRC;

|PROCESO Tipo90Fxz59; |TIPO 90;
     |CIERRAT #14;
     |CIERRAT #15;
|FPRC;

|PROGRAMA;
     |HAZ LeeUnidadBasico;

     |PINPA #0#959;  enPanta0 = FSalida;

     |SI enExped = 0;
         |HAZ EntradaGeneral;
     |SINO;
         |HAZ EntradaExpediente;
     |FINSI;
|FPRO;
