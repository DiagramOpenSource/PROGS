|FICHEROS;
   asm00003 #0;
   asm00004 #1,MANTE;
   asm00005 #2,MANTE;
   asw00024 #3,MANTE;

   referen@ #4;
|FIN;

|VARIABLES;
   Comodin  = ""; Comodin1 = ""; ClaveAnt = "";
   ModoEntrada = 0; Modo = 0; Sw = 0;

   Cont = 0;

   NumCampos = 0;
   DefCargado = "";
   Linea = 0;

   Flag = 0;
|FIN;

|RUTINA inf2;
   #asm00005#0 = 0;
|FRUT;

|RUTINA sup2;
   #asm00005#0 = 999;
|FRUT;

|PROCESO EntraConcep; |TIPO 7;
   |SI FSalida = 10;
      |PUSHV 1905 2237;
      |BLANCO 1905 2237;
      |CUADRO 1905 2237;
      E_sup = 29;
      E_inf = "";
      |SI Comodin = ""; Comodin = " "; |FINSI;
      Comodin = 2007 ? 1; |QBF Comodin; Comodin = Comodin < "";
      ClaveAnt = #asm00003#0;
      Sw = 0;
      |LEE 000#asm00003.s;
      |PARA; |SI FSalida = 0; |HACIENDO;
         Comodin1 = #asm00003#0; |QBF Comodin1; Comodin1 = Comodin1 < "";
         Comodin1 = Comodin1 - Comodin;
         |SI FSalida ! 0; Sw = 1; |SAL; |FINSI;
         Comodin1 = #asm00003#1; |QBF Comodin1; Comodin1 = Comodin1 < "";
         Comodin1 = Comodin1 - Comodin;
         |SI FSalida ! 0; Sw = 1; |SAL; |FINSI;
         |LEE 000#asm00003.s;
      |SIGUE;
      |SI Sw = 0; #asm00003#0 = ClaveAnt; |LEE 000#asm00003.=; |FINSI;
      |PTEC 808; |PTEC 809;
      |POPV;
   |FINSI;

   |SI FSalida = 11;
      |ENTLINEAL #1#asm00005,-1,Modo,20,1,inf2,sup2;
      |ENTLINEAL #1#asm00005,-1,7,20,1,inf2,sup2;
      |ACABA;
   |FINSI;
|FPRC;

|PROCESO CogeCampo; |TIPO 7;

   |SI FSalida = 10;
      |PUSHV 1141 1379;
      |BLANCO 1141 1379;
      |CUADRO 1146 1367;
      E_sup = 20;
      E_inf = "";
      |SI Comodin = ""; Comodin = " "; |FINSI;
      Comodin = 1247 ? 1; |QBF Comodin; Comodin = Comodin < "";
      ClaveAnt = #asm00004#1;
      Sw = 0;
      |LEE 000#asm00004.s;
      |PARA; |SI FSalida = 0; |HACIENDO;
         Comodin1 = #asm00004#2; |QBF Comodin1; Comodin1 = Comodin1 < "";
         Comodin1 = Comodin1 - Comodin;
         |SI FSalida ! 0; Sw = 1; |SAL; |FINSI;
         |LEE 000#asm00004.s;
      |SIGUE;
      |SI Sw = 0; #asm00004#1 = ClaveAnt; |LEE 000#asm00004.=; |FINSI;
      |PTEC 808; |PTEC 809;
      |POPV;
   |FINSI;

   |SI FSalida = 11;
      |LEE 010#asm00005.u;
      |SI FSalida ! 0;
         Linea = 1;
      |SINO;
         Linea = #asm00005#0 + 1;
      |FINSI;
      |PUSHV 0817 1765;
      |PINPA #0#asw00024;
      |PINDA #0#asw00024;
      |ENDATOS #1#asw00024;
      |SI FSalida ! 0; |POPV; |ACABA; |FINSI;
      |DDEFECTO #asm00005;
      #asm00005#0 = Linea;    Linea = Linea + 1;
      #asm00005#1 = #asm00004#0;
      #asm00005#2 = #asm00004#1;
      #asm00005#3 = #asm00004#2;
      |SI #asw00024#0 = "X"; #asm00005#4 = "FC"; |FINSI;
      |SI #asw00024#1 = "X"; #asm00005#4 = "CB"; |FINSI;
      |SI #asw00024#5 = "X"; #asm00005#5 = "I"; |FINSI;
      |SI #asw00024#6 = "X"; #asm00005#5 = "D"; |FINSI;
      |SI #asw00024#7 = "X"; #asm00005#5 = "C"; |FINSI;
      |SI #asw00024#8 = "X"; #asm00005#5 = "A"; |FINSI;
      |GRABA 020#asm00005.n;
      |POPV;
      |ENTLINEAL #1#asm00005,-1,7,20,1,inf2,sup2;
   |FINSI;
|FPRC;

|RUTINA inf1;
   #asm00004#0 = "        ";
   #asm00004#1 = 0;
|FRUT;

|RUTINA sup1;
   #asm00004#0 = "zzzzzzzz";
   #asm00004#1 = 255;
|FRUT;

|PROCESO CargaDef;
   |DBASE Comodin; |QBF Comodin;
   Comodin = Comodin + "def/" + #asm00003#0; |QBF Comodin;
   Comodin = Comodin + ".mas";
   |CARGA_DEF Comodin, referen@;
   |SI FSalida ! 0;
     |MENAV "    Fichero inexistente";
     |ERROR; |ACABA;
   |FINSI;
|FPRC;

|PROCESO DescargaDef;
   |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO Datos; |TIPO 7;

   Comodin = "|NC";
   NumCampos = #referen@#Comodin# - 1;

   Comodin = "|TITULO";
   #asm00003#1 = #referen@#Comodin#;
   |PINTA #asm00003#1; Comodin = "";

   |ABRET #asm00005;
   |SI DefCargado ! #asm00003#0;
      DefCargado = #asm00003#0;
      |DELINDEX #asm00004;
      |ABRET #asm00004;

      |PARA Cont = 0; |SI Cont [ NumCampos; |HACIENDO Cont = Cont + 1;
         Comodin = ("000" + Cont) % -103;
         Comodin = "|C" + Comodin;
         Comodin1 = Comodin + "NOMBRE";
         |DDEFECTO #asm00004;
         #asm00004#0 = #asm00003#0;
         #asm00004#1 = Cont;
         #asm00004#2 = #referen@#Comodin1#;
         Comodin1 = Comodin + "TIPO"; |QBF Comodin1;
         Comodin1 = #referen@#Comodin1#;
         |SI Comodin1 = "F"; #asm00004#3 = "Fecha"; |FINSI;
         |SI Comodin1 = "A"; #asm00004#3 = "Alfa "; |FINSI;
         |SI Comodin1 = "N"; #asm00004#3 = "Num  "; |FINSI;
         Comodin1 = Comodin + "LONGITUD";
         Comodin1 = #referen@#Comodin1#; |QBF Comodin1;
         Comodin1 = ("000" + Comodin1) % -103;
         #asm00004#4 = Comodin1;
         |GRABA 020#asm00004.n;
      |SIGUE;
      |CIERRAT #asm00004;
   |FINSI;

   Comodin = "";
   |ENTLINEAL #1#asm00004,-1,4,12,1,inf1,sup1;

   |CIERRAT #asm00005;
|FPRC;

|RUTINA inf;
   #asm00003#0 = "                    ";
|FRUT;

|RUTINA sup;
   #asm00003#0 = "zzzzzzzzzzzzzzzzzzzz";
|FRUT;

|PROCESO BajaConc;
   |BORRA 020#asm00005.a;
|FPRC;

|DEFBUCLE BajaConc;
#asm00005#1;
1;
001,#asm00003#0;
999,#asm00003#0;
;
NULL,BajaConc;
|FIN;

|PROCESO Baja; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0
   |SI ModoEntrada ! 3; |ACABA; |FINSI;

   |ABRET #asm00005;
   |SELECT #2#asm00005;
   #asm00005#0 = 0;
   #asm00005#1 = #asm00003#0;
   |LEE 010#asm00005.];
   |SI FSalida = 0; |Y #asm00005#1 = #asm00003#0;
      |CONFI "    NSe daran de baja todos los conceptos definidos de ese fichero.¨Continuar?";
      |SI FSalida = 0;
         |CIERRAT #asm00005; |BUCLE BajaConc; |ABRET #asm00005;
         |ENTLINEAL #1#asm00005,-1,7,20,1,inf2,sup2;
      |FINSI;
   |FINSI;
   |SELECT #1#asm00005;
   |CIERRAT #asm00005;
|FPRC;

|PROCESO ModificaLinea;
   ModoEntrada = (FEntrada / 100) ! 0; |SI ModoEntrada ! 2; |ACABA; |FINSI;

   |PUSHV 0817 1765;

   |PARA Cont = 0; |SI Cont [ 8; |HACIENDO Cont = Cont + 1;
      #asw00024#Cont# = " ";
   |SIGUE;

   |SI #asm00005#4 = "FC"; #asw00024#0 = "X"; |FINSI;
   |SI #asm00005#4 = "CB"; #asw00024#1 = "X"; |FINSI;
   |SI #asm00005#5 = "I";  #asw00024#5 = "X"; |FINSI;
   |SI #asm00005#5 = "D";  #asw00024#6 = "X"; |FINSI;
   |SI #asm00005#5 = "C";  #asw00024#7 = "X"; |FINSI;
   |SI #asm00005#5 = "A";  #asw00024#8 = "X"; |FINSI;

   |PINPA #0#asw00024;
   |PINDA #0#asw00024;
   |ENDATOS #1#asw00024;
   |SI FSalida ! 0; |POPV; |ACABA; |FINSI;

   |SI #asw00024#0 = "X"; #asm00005#4 = "FC"; |FINSI;
   |SI #asw00024#1 = "X"; #asm00005#4 = "CB"; |FINSI;
   |SI #asw00024#5 = "X"; #asm00005#5 = "I"; |FINSI;
   |SI #asw00024#6 = "X"; #asm00005#5 = "D"; |FINSI;
   |SI #asw00024#7 = "X"; #asm00005#5 = "C"; |FINSI;
   |SI #asw00024#8 = "X"; #asm00005#5 = "A"; |FINSI;
   |GRABA 020#asm00005.a;
   |POPV;
|FPRC;

|PROCESO Rellena700;
     |ABRE #asm00003;
     |DBASE Comodin1;  |QBF Comodin1;  Comodin1 = Comodin1 + "def/*.mas";
     |_PDIR Comodin1;
     |PARA; |SI FSalida = 0; |HACIENDO;
        |CARGA_DEF Comodin1, referen@;
        |SI FSalida = 0;
           |DDEFECTO #asm00003;
           Comodin = Comodin1 % -112; Comodin = Comodin % 0108;
           Comodin = Comodin - "/";
           |PARA; |SI FSalida ! 0; |HACIENDO;
              Comodin = Comodin - "/";
           |SIGUE;
           #asm00003#0 = Comodin;
           Comodin ="|TITULO";
           #asm00003#1 = #referen@#Comodin#;
           |GRABA 020#asm00003.n;
           |DESCARGA_DEF #referen@;
           Comodin = "";
        |FINSI;
        |_SDIR Comodin1;
     |SIGUE;
     |CIERRA #asm00003;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA "Definicion conceptos enlace";

   |PINPA #0#0;
   |PINPA #0#1;
   |PINPA #0#2;
   |PINDA #0#0;

   E_sup = 10;
   E_inf = "";
   Comodin = " ";
   |MENSA "2405 Entre clave :           ";
   Comodin = 2420 ? -1;
   |MENSA "2405                         ";

   |SI Comodin = "ENLACES   "; Modo = 2; |SINO; Modo = 4; |FINSI;

   |DELINDEX #asm00003; |DELINDEX #asm00004;
   |HAZ Rellena700;

   |ENTLINEAL #1#asm00004,-1,7,12,1,inf1,sup1;
   |ENTLINEAL #1#asm00005,-1,7,20,1,inf2,sup2;
   |ENTLINEAL #1#asm00003,-1,Modo,20,1,inf,sup;
|FPRO;
