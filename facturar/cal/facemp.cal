|FICHEROS;
     facemp #1;
     facge280  #280;
     Ref0001@ #1000;
|FIN;

|VARIABLES;
    aMensaje = "";
    nSalida = 0;
    nArchi = 0;
    aAlfa = "";
    nHandle = 0;
    aAlfa1 = "";

    nume0 = 0;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    dire = "";

    &acceso   = 0;
    &nombre_a = "";
    &modo     = 0;
    &v_codigo = 0;
    &v_nombre = "";
    &eaExterno = "";
    aPath = "";
|FIN;

|CALCULO mkdir; |TIPO 30;
  nume0 = FEntrada / 100;  nume0 = nume0 ! 0;  || alta
  |SI nume0 = 1;
      |DFICE alfa2;
      alfa3 = #1#0;    alfa3 = "00" + #1#0;    alfa3 = alfa3 % -102;
      dire = "";
      |DIRECTORIO dire;
      alfa1 = alfa2 + alfa3;
      |MKDIR alfa1;

      |CONFI "    NRecoger Ficheros Maestros de Otra Empresa S/N";
      |SI FSalida = 0;
          |DFICB aPath;
          alfa1 = #1#0;
          alfa1 = ("00" + alfa1) % -102;
          eaExterno = aPath + alfa1 + "/";
          |SUB_EJECUTA_NP "aszp0013";
      |FINSI;
  |FINSI;
|FCAL;

|CALCULO rmdir; |TIPO 2;
modo     = 1;
acceso   = #1#0;
nombre_a = #1#1;
|SUB_EJECUTA "asw00002.run";

nume0 = FEntrada / 100;  nume0 = nume0 ! 0;  || baja
|SI nume0 = 3;
    modo = 3;  |SUB_EJECUTA "asw00002.run";

    |DFICE alfa2;
       alfa3 = #1#0;    alfa3 = "00" + #1#0;    alfa3 = alfa3 % -102;
        dire = "";
    |DIRECTORIO dire;
       alfa1 = dire + "/bin/agirm -r " + alfa2 + alfa3;
    |SYSTEM alfa1;
|FINSI;
|FCAL;

|CALCULO Tipo20; |TIPO 20;
     aAlfa1 = FSalida;
     |SI aAlfa1 = "OPCION";
          FSalida = "Datos FacturaE";
          |ACABA;
     |FINSI;

     |LEE 101#1=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ DatosFacturaE;
|FCAL;

|PROCESO DatosFacturaE;
     ||Mirar si tengo dsarchi y si tengo activo la FacturaE.
     nArchi = 0;
     |DBASS aPath; |QBF aPath;
     aPath = aPath + "dsarchi/def/dsarm001.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida = 0;
        |DBASS aAlfa; |QBF aAlfa;
        aAlfa = aAlfa + "dsarchi/def/dsarm001.mas";
        |CARGA_DEF aAlfa, Ref0001@;
        |SI FSalida = 0;
           |DBASS aAlfa; |QBF aAlfa;
           aAlfa = aAlfa + "dsarchi/fich/"; |PATH_DAT #1000 aAlfa;
           |ABRE #Ref0001@;
           |DDEFECTO #Ref0001@;
           |LEE 000#Ref0001@.p;
           |SI FSalida ! 0; |DDEFECTO #Ref0001@; |FINSI;

           |SI #Ref0001@#3 = "S";
              nArchi = 1;
           |FINSI;
           |CIERRA #Ref0001@; |DESCARGA_DEF #Ref0001@;
        |FINSI;
     |SINO;
          aMensaje = "0000Para usar la Factura Electronica, se necesita el DSARCHI";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;

     |SI nArchi = 0;
          aMensaje = "0000No esta conectada en el DSARCHI la FacturaE con FACTURAR";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;

     |ABRE #facge280;

     |PUSHV 0501 2380;
     |BLANCO 0501 2380;
     |CUADRO 0501 2380;

     |DDEFECTO #facge280;
     #facge280#0 = #facemp#0;
     |LEE 101#facge280.=;
     nSalida = FSalida;

     |PINPA #0#facge280;
     |PINDA #0#facge280;

     |ENDATOS #2#facge280;
     |SI FSalida = 0;
          |SI nSalida = 0;
               |GRABA 020#facge280.a;
          |SINO;
               |GRABA 020#facge280.n;
          |FINSI;
     |FINSI;
     |LIBERA #facge280;

     |POPV;
     |CIERRA #facge280;
|FPRC;
