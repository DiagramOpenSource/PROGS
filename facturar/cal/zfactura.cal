|FICHEROS;
     program@ #0;

     asclient;
     abxm0024;
     aspoblac;
     asempres;
     cmsocios;
     excontra;
     exletrad;
     exprocur;
     ascabfdi;
     ascabmin;
     ascabrem;
     ashismic;
     ashisrec;
     aspasrem;
     asinfban;
     abxfdica;
     ascaisec;

     facemp   #999;

     &paises@;
     :/basica/def/agim0016;
     :/integral/def/dsam0104;

     &provinc@ #700;
      asprovin #701;
     :/integral/def/dsam0100 #702;

     &poblaci@ #703;
      aspoblac #704;
     :/integral/def/dsam0101 #705;

     &bancosp@ #706;
      asbancos #707;
     :/integral/def/dsam0117 #708;

     &bancosc@ #709;
      asbancli #710;
     :/integral/def/dsam0116 #711;

     &fopagos@ #712;
      asfpagos #713;
     :/integral/def/dsam0118 #714;

     &clientes@ #715;
     :/basica/def/agifigen   #716;
     :/integral/def/dsam0000 #717;

     &usuarios@ #718;
     :/basica/def/agiusuar  #719;
     :/integral/def/dsam0108 #720;

|FIN;

|VARIABLES;
     nSalida = 0;
     aMensaje = "";

     aBase           = "";
     aProgAct        = "";
     aDef            = "";
     aPathReo        = "";
     aAlfa           = "";
     aVariable       = "";
     aFichero        = "";

     nCampoCodProv   = 0;
     nCampoCodPobl   = 0;
     nCampoNomProv   = 0;
     nCampoNomPobl   = 0;
     nCanal          = 0;
     nCampo          = 0;
     nCampo1         = 0;
     nCampo2         = 0;
     nCampo3         = 0;

     &eaPrograma     = "";
     &enSw           = 0;
     &enCodProv      = 0;
     &enCodPobl      = 0;
     &enModoPob      = 0;
     &eaPoblacion    = "";
     &eaPoblaParri   = "";
     &eaCodNif       = "";
     &eaCodUsu       = "";
     &enCodCli       = 0;
     &enCodBanco     = 0;
     &enCodPago      = 0;
     &enSwDeDonde    = 0;

     &eaIBANPropio   = "";
     &eaPathBasica   = "";
     &eaPathContagen = "";
     &eaPathContanex = "";
     &eaPathContasoc = "";
     &eaPathRen2012  = "";
     &eaPathRen2011  = "";
     &eaPathRen2010  = "";
     &eaPathRen2009  = "";
     &eaPathRen2008  = "";
     &eaPathRen2007  = "";
     &eaPathRen2006  = "";
     &eaPathFacturar = "";
     &eaPathLaboral  = "";
     &eaPathIntegral = "";
     &eaPathDsmodelo = "";
     &eaPathFiscal   = "";
||     &eaIBANPropio   = "";
|FIN;

|PROCESO Tipo88;  |TIPO 88;
     eaPrograma = FSalida % -108;
     enSw       = 0;

     |SI eaPrograma = "asclient";  enSw = 1;  |REFERENCIA_DEF program@, #asclient;  |FINSI;
     |SI eaPrograma = "aspoblac";  enSw = 1;  |REFERENCIA_DEF program@, #aspoblac;  |FINSI;
     |SI eaPrograma = "asempres";  enSw = 1;  |REFERENCIA_DEF program@, #asempres;  |FINSI;
     |SI eaPrograma = "cmsocios";  enSw = 1;  |REFERENCIA_DEF program@, #cmsocios;  |FINSI;
     |SI eaPrograma = "excontra";  enSw = 1;  |REFERENCIA_DEF program@, #excontra;  |FINSI;
     |SI eaPrograma = "exletrad";  enSw = 1;  |REFERENCIA_DEF program@, #exletrad;  |FINSI;
     |SI eaPrograma = "exprocur";  enSw = 1;  |REFERENCIA_DEF program@, #exprocur;  |FINSI;
     |SI eaPrograma = "ascabfdi";  enSw = 1;  |REFERENCIA_DEF program@, #ascabfdi;  |FINSI;
     |SI eaPrograma = "ascabmin";  enSw = 1;  |REFERENCIA_DEF program@, #ascabmin;  |FINSI;
     |SI eaPrograma = "ascabrem";  enSw = 1;  |REFERENCIA_DEF program@, #ascabrem;  |FINSI;
     |SI eaPrograma = "ashismic";  enSw = 1;  |REFERENCIA_DEF program@, #ashismic;  |FINSI;
     |SI eaPrograma = "ashisrec";  enSw = 1;  |REFERENCIA_DEF program@, #ashisrec;  |FINSI;
     |SI eaPrograma = "aspasrem";  enSw = 1;  |REFERENCIA_DEF program@, #aspasrem;  |FINSI;
     |SI eaPrograma = "asinfban";  enSw = 1;  |REFERENCIA_DEF program@, #asinfban;  |FINSI;
     |SI eaPrograma = "asbancos";  enSw = 1;  |REFERENCIA_DEF program@, #asbancos;  |FINSI;
     |SI eaPrograma = "abxm0024";  enSw = 1;  |REFERENCIA_DEF program@, #abxm0024;  |FINSI;
     |SI eaPrograma = "abxfdica";  enSw = 1;  |REFERENCIA_DEF program@, #abxfdica;  |FINSI;
     |SI eaPrograma = "ascaisec";  enSw = 1;  |REFERENCIA_DEF program@, #ascaisec;  |FINSI;

     |SI enSw = 0;  |ACABA;  |FINSI;

     |DBASS aBase;   |QBT aBase;

     ||ARA CCC. Ahora controlo si ademas de la integral instalada, esta activa
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |HAZ IntegralActiva;
     |SI FSalida ] 0;

         ||aMensaje = "0000INTEGRAL ACTIVA";
         ||MENAV aMensaje;

         ||Desactivado

         |MODO_RELACION #0, 1, "asprovin", "N", "N";
         |MODO_RELACION #0, 1, "aspoblac", "N", "N";
         |MODO_RELACION #0, 1, "asbancos", "N", "N";
         |MODO_RELACION #0, 1, "asbancli", "N", "N";
         |MODO_RELACION #0, 1, "asfpagos", "N", "N";
         |MODO_RELACION #0, 1, "agim0016", "N", "N";

         |MODO_RELACION #0, 1, "asprovin", "X", "X";
         |MODO_RELACION #0, 1, "aspoblac", "X", "X";
         |MODO_RELACION #0, 1, "asbancos", "X", "X";
         |MODO_RELACION #0, 1, "asbancli", "X", "X";
         |MODO_RELACION #0, 1, "asfpagos", "X", "X";
         |MODO_RELACION #0, 1, "agim0016", "X", "X";

         || Activado

         |MODO_RELACION #0, 0, "dsam0100", "X", "X";
         |MODO_RELACION #0, 0, "dsam0101", "X", "X";
         |MODO_RELACION #0, 0, "dsam0117", "X", "X";
         |MODO_RELACION #0, 0, "dsam0116", "X", "X";
         |MODO_RELACION #0, 0, "dsam0118", "X", "X";
         |MODO_RELACION #0, 0, "dsam0104", "X", "X";

         |MODO_RELACION #0, 1, "dsam0100", "S", "S";
         |MODO_RELACION #0, 1, "dsam0101", "S", "S";
         |MODO_RELACION #0, 1, "dsam0117", "S", "S";
         |MODO_RELACION #0, 1, "dsam0116", "S", "S";
         |MODO_RELACION #0, 1, "dsam0118", "S", "S";
         |MODO_RELACION #0, 1, "dsam0104", "N", "N";

         |REFERENCIA_DEF provinc@,  #702;
         |REFERENCIA_DEF poblaci@,  #705;
         |REFERENCIA_DEF bancosp@,  #708;
         |REFERENCIA_DEF bancosc@,  #711;
         |REFERENCIA_DEF fopagos@,  #714;
         |REFERENCIA_DEF paises@,  #dsam0104;
     |SINO;

         ||aMensaje = "0000MODULO VISADOS ACTIVA";
         ||MENAV aMensaje;

         |MODO_RELACION #0, 1, "dsam0100", "N", "N";
         |MODO_RELACION #0, 1, "dsam0101", "N", "N";
         |MODO_RELACION #0, 1, "dsam0117", "N", "N";
         |MODO_RELACION #0, 1, "dsam0116", "N", "N";
         |MODO_RELACION #0, 1, "dsam0118", "N", "N";
         |MODO_RELACION #0, 1, "dsam0104", "N", "N";

         |MODO_RELACION #0, 1, "dsam0100", "X", "X";
         |MODO_RELACION #0, 1, "dsam0101", "X", "X";
         |MODO_RELACION #0, 1, "dsam0117", "X", "X";
         |MODO_RELACION #0, 1, "dsam0116", "X", "X";
         |MODO_RELACION #0, 1, "dsam0118", "X", "X";
         |MODO_RELACION #0, 1, "dsam0104", "X", "X";

         |MODO_RELACION #0, 0, "asprovin", "X", "X";
         |MODO_RELACION #0, 0, "aspoblac", "X", "X";
         |MODO_RELACION #0, 0, "asbancos", "X", "X";
         |MODO_RELACION #0, 0, "asbancli", "X", "X";
         |MODO_RELACION #0, 0, "asfpagos", "X", "X";
         |MODO_RELACION #0, 0, "agim0016", "X", "X";

         |MODO_RELACION #0, 1, "asprovin", "S", "S";
         |MODO_RELACION #0, 1, "aspoblac", "S", "S";
         |MODO_RELACION #0, 1, "asbancos", "S", "S";
         |MODO_RELACION #0, 1, "asbancli", "S", "S";
         |MODO_RELACION #0, 1, "asfpagos", "S", "S";
         |MODO_RELACION #0, 1, "agim0016", "N", "N";

         |REFERENCIA_DEF provinc@,  #701;
         |REFERENCIA_DEF poblaci@,  #704;
         |REFERENCIA_DEF bancosp@,  #707;
         |REFERENCIA_DEF bancosc@,  #710;
         |REFERENCIA_DEF fopagos@,  #713;
         |REFERENCIA_DEF paises@,  #agim0016;
     |FINSI;
|FPRC;

|PROCESO ParrillaPobla;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |HAZ IntegralActiva;
     |SI FSalida ] 0;
         enSwDeDonde = 1;
         enCodProv   = #0nCampoCodProv;
         enCodPobl   = #0nCampoCodPobl;
         eaPoblacion = #0nCampoNomPobl;
         enModoPob   = 1;
         |SUB_EJECUTA_NP ":integral/dsaw9996";
         |SI eaPoblaParri ! "";
             #0nCampoNomPobl = eaPoblaParri;
         |SINO;
             #0nCampoNomPobl = #703#3;
         |FINSI;
         |PINTA #0nCampoNomPobl;
     |SINO;
         enSwDeDonde     = 0;
         #0nCampoNomPobl = #703#3;
     |FINSI;

     |PINTA #0nCampoNomPobl;
|FPRC;

|PROCESO LeeLocalidad;
     eaPrograma = Control;

     |SI eaPrograma = "asclient";
         |REFERENCIA_DEF program@, #asclient;
         nCampoCodProv = Campo - 1;
         nCampoCodPobl = Campo;
         nCampoNomPobl = Campo + 1;
         nCampoNomProv = Campo + 2;
     |FINSI;

     |SI eaPrograma = "asempres";
         |REFERENCIA_DEF program@, #asempres;
         nCampoCodProv = Campo - 1;
         nCampoCodPobl = Campo;
         nCampoNomPobl = 3;
         nCampoNomProv = 6;
     |FINSI;

     |SI eaPrograma = "asbancos";
         |REFERENCIA_DEF program@, #asbancos;
         nCampoCodProv = Campo - 1;
         nCampoCodPobl = Campo;
         nCampoNomPobl = 3;
         nCampoNomProv = 6;
     |FINSI;

     |SI eaPrograma = "cmsocios";
         |REFERENCIA_DEF program@, #cmsocios;
         nCampoCodProv = 25;
         nCampoCodPobl = 28;
         nCampoNomPobl = 6;
         nCampoNomProv = 7;
     |FINSI;

     |SI eaPrograma = "excontra";
         |REFERENCIA_DEF program@, #excontra;
         nCampoCodProv = Campo - 1;
         nCampoCodPobl = Campo;
         nCampoNomPobl = 4;
         nCampoNomProv = 9;
     |FINSI;

     |SI eaPrograma = "exletrad";
         |REFERENCIA_DEF program@, #exletrad;
         nCampoCodProv = Campo - 1;
         nCampoCodPobl = Campo;
         nCampoNomPobl = 4;
         nCampoNomProv = 11;
     |FINSI;

     |SI eaPrograma = "exprocur";
         |REFERENCIA_DEF program@, #exprocur;
         nCampoCodProv = Campo - 1;
         nCampoCodPobl = Campo;
         nCampoNomPobl = 4;
         nCampoNomProv = 9;
     |FINSI;

     |ABRE #703;
     #703#0 = #0nCampoCodProv;
     #703#1 = #0nCampoCodPobl;
     |LEE 040#703.=;
     |SI FSalida = 0;
         |HAZ ParrillaPobla;

         |SI nCampoNomProv ! -1;
             #0nCampoNomProv = #703#2;
             |PINTA #0nCampoNomProv;
         |FINSI;
     |SINO;
         |MENAV "    No existe Poblacion.";
         |ERROR;
     |FINSI;
     |CIERRA #703;
|FPRC;

|PROCESO PreparaInformes;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |HAZ IntegralActiva;
     |SI FSalida ] 0;
         enSwDeDonde = 1;
     |SINO;
         enSwDeDonde = 0;
     |FINSI;

     |DBASS aBase;   |QBT aBase;

     aFichero = aBase + "facturar/def/poblacion.ref";
     |XABRE "W", aFichero, nCanal;
     |SI enSwDeDonde = 1;
         aVariable = ":/integral/def/dsam0101" + &13 + &10;
     |SINO;
         aVariable = "aspoblac" + &13 + &10;
     |FINSI;
     |XGRABA nCanal, aVariable;
     |XCIERRA nCanal;
|FPRC;

|PROCESO LeeBancoPropio;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |HAZ IntegralActiva;
     |SI FSalida ] 0;
          enSwDeDonde = 1;
          |REFERENCIA_DEF bancosp@, #708;
     |SINO;
          enSwDeDonde = 0;
          |REFERENCIA_DEF bancosp@, #707;
     |FINSI;

     |ABRE #706;
     #706#0 = enCodBanco;
     |LEE 040#706.=;
     |SI FSalida ! 0; |DDEFECTO #706; |FINSI;
     |CIERRA #706;

     |SI enSwDeDonde = 1;
         #707#0  = #706#0;
         #707#1  = #706#1;
         #707#2  = #706#2;
         #707#3  = #706#3;
         #707#4  = #706#4;
         #707#5  = #706#5;
         #707#6  = #706#6;
         #707#7  = #706#7 + #706#8 + #706#9 + #706#10;
         #707#23 = #706#11;

         #707#24 = #706#12;
         #707#25 = #706#13;
         #707#31 = #706#14;
     |FINSI;
     |SI enSwDeDonde = 1;
         eaIBANPropio = #706#13;
     |SINO;
         eaIBANPropio = #706#25;
     |FINSI;
|FPRC;

|PROCESO LeeBancoCliente;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |HAZ IntegralActiva;
     |SI FSalida ] 0;
          enSwDeDonde = 1;
          |REFERENCIA_DEF bancosc@, #711;
     |SINO;
          enSwDeDonde = 0;
          |REFERENCIA_DEF bancosc@, #710;
     |FINSI;

     |ABRE #709;
     #709#0 = enCodBanco;
     |LEE 040#709.=;
     |SI FSalida ! 0; |DDEFECTO #709; |FINSI;
     |CIERRA #709;

     |SI enSwDeDonde = 1;
         #710#0  = #709#0;
         #710#1  = #709#1;
         #710#2  = #709#6;
         #710#3  = #709#2 + #709#3 + #709#4;
     |FINSI;
|FPRC;

|PROCESO LeeFormaDePago;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |HAZ IntegralActiva;
     |SI FSalida ] 0;
          enSwDeDonde = 1;
          |REFERENCIA_DEF fopagos@, #714;
     |SINO;
          enSwDeDonde = 0;
          |REFERENCIA_DEF fopagos@, #713;
     |FINSI;

     |ABRE #712;
     #712#0 = enCodPago;
     |LEE 040#712.=;
     |SI FSalida ! 0; |DDEFECTO #712; |FINSI;
     |CIERRA #712;

     |SI enSwDeDonde = 1;
         |PARA nCampo = 0;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
               #713nCampo = #712nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO LeePersona;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |HAZ IntegralActiva;
     |SI FSalida ] 0;
          enSwDeDonde = 1;
          |REFERENCIA_DEF clientes@, #717;
     |SINO;
          enSwDeDonde = 0;
         |REFERENCIA_DEF clientes@, #716;
     |FINSI;

     |ABRE #715;
     #715#0 = enCodCli;
     |LEE 040#715.=;
     |SI FSalida ! 0; |DDEFECTO #715; |FINSI;
     |CIERRA #715;
|FPRC;

|PROCESO SinBarra;  |TIPO 5;
     FSalida = "SINBARRA";
|FPRC;

|PROCESO BusquedaApli;
     eaPathBasica    = "";
     eaPathContagen  = "";
     eaPathContanex  = "";
     eaPathContasoc  = "";
     eaPathRen2012   = "";
     eaPathRen2011   = "";
     eaPathRen2010   = "";
     eaPathRen2009   = "";
     eaPathRen2008   = "";
     eaPathRen2007   = "";
     eaPathRen2006   = "";
     eaPathFacturar  = "";
     eaPathLaboral   = "";
     eaPathIntegral  = "";
     eaPathDsmodelo  = "";
     eaPathFiscal    = "";

     |DBASS aBase;   |QBF aBase;

     aAlfa = aBase + "basica/def/agifigen.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathBasica = aBase + "basica/";
     |FINSI;

     aAlfa = aBase + "contagen/def/canempre.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathContagen = aBase + "contagen/";
     |FINSI;

     aAlfa = aBase + "contanex/def/vamanpax.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathContanex = aBase + "contanex/";
     |FINSI;

     aAlfa = aBase + "contasoc/def/maempr10.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathContasoc = aBase + "contasoc/";
     |FINSI;

     aAlfa = aBase + "ren2012/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2012   = aBase + "ren2012/";  || Cambiar por Ren2012
     |FINSI;

     aAlfa = aBase + "ren2011/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2011   = aBase + "ren2011/";  || Cambiar por Ren2011
     |FINSI;

     aAlfa = aBase + "ren2010/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2010   = aBase + "ren2010/";  || Cambiar por Ren2010
     |FINSI;

     aAlfa = aBase + "ren2009/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2009   = aBase + "ren2009/";  || Cambiar por Ren2009
     |FINSI;

     aAlfa = aBase + "ren2008/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2008   = aBase + "ren2008/";  || Cambiar por Ren2008
     |FINSI;

     aAlfa = aBase + "ren2007/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2007   = aBase + "ren2007/";  || Cambiar por Ren2007
     |FINSI;

     aAlfa = aBase + "ren2006/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2006   = aBase + "ren2006/";  || Cambiar por Ren2006
     |FINSI;

     aAlfa = aBase + "facturar/def/asclient.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathFacturar  = aBase + "facturar/";    || Cambiar por facturar
     |FINSI;

     aAlfa = aBase + "laboral/def/labempre.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathLaboral   = aBase + "laboral/";
     |FINSI;

     aAlfa = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aAlfa, nCanal;
     |HAZ IntegralActiva;
     |SI FSalida ] 0;
         eaPathIntegral  = aBase + "integral/";
     |FINSI;

     aAlfa = aBase + "modelos/def/dsmom001.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathDsmodelo  = aBase + "modelos/";
     |FINSI;

     aAlfa = aBase + "fiscal/def/eosclien.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathFiscal = aBase + "fiscal/";
     |FINSI;
|FPRC;

|PROCESO LeeUsuario;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |HAZ IntegralActiva;
     |SI FSalida ] 0;
         enSwDeDonde = 1;
         |REFERENCIA_DEF usuarios@, #720;
     |SINO;
         enSwDeDonde = 0;
         |REFERENCIA_DEF usuarios@, #719;
     |FINSI;

     |ABRE #718;
     #718#0 = eaCodUsu;
     |LEE 040#718.=;
     |SI FSalida ! 0; |DDEFECTO #718; |FINSI;
     |CIERRA #718;
|FPRC;

|PROCESO IntegralActiva;
     nSalida = FSalida;

     |SI nSalida ] 0
          |DFICE aAlfa;  |QBF aAlfa;
          aAlfa = aAlfa % -202;

          |ABRE #999;
          #999#0 = aAlfa;
          |LEE 000#999.=;
          |SI FSalida ! 0;  |DDEFECTO #999;  |FINSI;
          |CIERRA #999;

          |SI #999#3 = "N";
               nSalida = -1;
          |FINSI;
     |FINSI;
     FSalida = nSalida;
|FPRC;
