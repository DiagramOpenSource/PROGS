|FICHEROS;
     retotren #5;
     retotrea #6;
     retotreb #84;
     rew00001 #99;
     rew00017 #608;
|FIN;

|VARIABLES;
      XCampos     = 0;
      NSecuencial = "";
      Field       = "";
      Suma        = 0;

     &VEmpresa   = 0;
     &VTipo      = "";
     &NCopia     = 0;
     &VSwCarga   = 0;
     &VTemporal0 = "";
     &VTemporal8 = "";

{200}&NEmpresas  = "";
|FIN;

|INCLUYE i_utilid;

|PROCESO LeeFicheros;
     |ABRE #99;
     #99#0 = VEmpresa;
     #99#1 = VTipo;
     |LEE 040#99=;
     |SI FSalida ! 0; |DDEFECTO #99; |FINSI;
     |CIERRA #99;

     |ABRE #5;
     #5#0   = #99#0;
     #5#141 = #99#1;
     |LEE 040#5=;
     |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
     |CIERRA #5;

     |ABRE #6;
     #6#0 = #99#0;
     #6#1 = #99#1;
     |LEE 040#6=;
     |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
     |CIERRA #6;

     |ABRE #84;
     #84#0 = #99#0;
     #84#1 = #99#1;
     |LEE 040#84=;
     |SI FSalida ! 0; |DDEFECTO #84; |FINSI;
     |CIERRA #84;
|FPRC;

|PROCESO CargaHoja8;
     |HAZ LeeFicheros;

     #608#0 = 0;
     |LIBERA #608;
     |LEE 140#608=;
     |SI FSalida ! 0;
         |DDEFECTO #608;
         #608#0 = 0;
         |GRABA 140#608b;
     |FINSI;

     #608#004 = #84#002;   #608#005 = #84#003;
     #608#006 = #84#004;   #608#007 = #84#005;  #608#008 = #608#006 - #608#007;
     #608#009 = #84#006;   #608#010 = #84#007;  #608#011 = #608#009 - #608#010;
     #608#012 = #84#008;   #608#013 = #84#009;  #608#014 = #608#012 - #608#013;
     #608#015 = #84#010;   #608#016 = #84#011;  #608#017 = #608#015 - #608#016;
     #608#018 = #84#012;   #608#019 = #84#013;  #608#020 = #608#018 - #608#019;
     #608#021 = #84#014;   #608#022 = #84#015;  #608#023 = #608#021 - #608#022;
     #608#024 = #84#016;   #608#025 = #84#017;  #608#026 = #608#024 - #608#025;
     #608#027 = #84#018;   #608#028 = #84#019;  #608#029 = #608#027 - #608#028;
     #608#030 = #84#020;   #608#031 = #84#021;  #608#032 = #608#030 - #608#031;
     #608#033 = #84#022;   #608#034 = #84#023;  #608#035 = #608#033 - #608#034;
     #608#036 = #84#024;   #608#037 = #84#025;  #608#038 = #608#036 - #608#037;
     #608#039 = #84#026;   #608#040 = #84#027;  #608#041 = #608#039 - #608#040;
     #608#042 = #84#028;   #608#043 = #84#029;  #608#044 = #608#042 - #608#043;
     #608#045 = #84#030;   #608#046 = #84#031;  #608#047 = #608#045 - #608#046;

     #608#48 = #608#4;
     |PARA XCampos = 6;  |SI XCampos [ 45;  |HACIENDO XCampos = XCampos + 3;
           #608#48 = #608#48 + #608XCampos;
     |SIGUE;

     #608#49 = #5#99;

     #608#50 = 0;
     |PARA XCampos = 8;  |SI XCampos [ 47;  |HACIENDO XCampos = XCampos + 3;
           #608#50 = #608#50 + #608XCampos;
     |SIGUE;

     #608#051 = #84#032;   #608#052 = #84#033;
     #608#053 = #84#034;   #608#054 = #84#035;  #608#055 = #608#053 - #608#054;
     #608#056 = #84#036;   #608#057 = #84#037;  #608#058 = #608#056 - #608#057;
     #608#059 = #84#038;   #608#060 = #84#039;  #608#061 = #608#059 - #608#060;
     #608#062 = #84#040;   #608#063 = #84#041;  #608#064 = #608#062 - #608#063;
     #608#065 = #84#042;   #608#066 = #84#043;  #608#067 = #608#065 - #608#066;
     #608#068 = #84#044;   #608#069 = #84#045;  #608#070 = #608#068 - #608#069;
     #608#071 = #84#046;   #608#072 = #84#047;  #608#073 = #608#071 - #608#072;
     #608#074 = #84#048;   #608#075 = #84#049;  #608#076 = #608#074 - #608#075;
     #608#077 = #84#050;   #608#078 = #84#051;  #608#079 = #608#077 - #608#078;
     #608#080 = #84#052;   #608#081 = #84#053;  #608#082 = #608#080 - #608#081;
     #608#083 = #84#054;   #608#084 = #84#055;  #608#085 = #608#083 - #608#084;
     #608#086 = #84#056;   #608#087 = #84#057;  #608#088 = #608#086 - #608#087;
     #608#089 = #84#058;   #608#090 = #84#059;  #608#091 = #608#089 - #608#090;

     #608#092 = #608#51;
     |PARA XCampos = 53;  |SI XCampos [ 89;  |HACIENDO XCampos = XCampos + 3;
           #608#92 = #608#92 + #608XCampos;
     |SIGUE;

     #608#93 = #5#100;

     #608#094 = 0;
     |PARA XCampos = 55;  |SI XCampos [ 91;  |HACIENDO XCampos = XCampos + 3;
           #608#94 = #608#94 + #608XCampos;
     |SIGUE;

     #608#095 = #84#060;   #608#096 = #84#061;
     #608#097 = #84#062;   #608#098 = #84#063;
     #608#099 = #84#064;   #608#100 = #84#065;  #608#101 = #608#099 - #608#100;
     #608#102 = #84#066;   #608#103 = #84#067;  #608#104 = #608#102 - #608#103;
     #608#105 = #84#068;   #608#106 = #84#069;
     #608#107 = #84#070;   #608#108 = #84#071;  #608#109 = #608#107 - #608#108;
     #608#110 = #84#072;   #608#111 = #84#073;  #608#112 = #608#110 - #608#111;
     #608#113 = #84#074;   #608#114 = #84#075;  #608#115 = #608#113 - #608#114;
     #608#116 = #84#076;   #608#117 = #84#077;  #608#118 = #608#116 - #608#117;

     #608#119 = #608#095 + #608#097 + #608#099 + #608#102 + #608#105 + #608#107;
     #608#119 = #608#119 + #608#110 + #608#113 + #608#116;

     #608#120 = #5#101;

     #608#121 = #608#101 + #608#104 + #608#109 + #608#112 + #608#115 + #608#118;

     #608#122 = #84#078;   #608#123 = #84#079;
     #608#124 = #84#080;   #608#125 = #84#081;  #608#126 = #608#124 - #608#125;

     #608#127 = #608#122 + #608#124;
     #608#128 = #5#102;
     #608#129 = #608#126;

     #608#131 = #99#7;
     #608#132 = #99#3;

     |GRABA 140#608a;
|FPRC;

|PROCESO GrabaH08M100;
     |HAZ BorraCampos;

     ICampos = Campos1 <-;
     |PARA XCampos = 1;  |SI XCampos [ 130;  |HACIENDO XCampos = XCampos + 1;
           Campos = #608XCampos;
           ICampos = ICampos + 1;
     |SIGUE;

     ICampos = Campos1   <-;                                    Campos = "100";
     ICampos = Campos2   <-;                                    Campos = "08";
     ICampos = Campos130 <-; Valfa = &13 + &10;                 Campos = Valfa;

     ICampos = Campos4 <-;
     |PARA XCampos = 4;  |SI XCampos [ 129;  |HACIENDO XCampos = XCampos + 1;
           CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
           ICampos = ICampos + 1;
     |SIGUE;

     INEmpresas = NEmpresas1 <-;
     INEmpresas = INEmpresas + NCopia;

     Pos = -1;
     NSecuencial = "r+b " + NEmpresas;
     |FABRE NSecuencial;
     |SI FSalida < 0;
         NSecuencial = "wb  " + NEmpresas;
         |FABRE NSecuencial;
     |FINSI;

     Handle = FSalida;
     |SI FSalida ] 0;
         |PARA; |SI; |HACIENDO;
              Field = Handle + " 255";
              |FLEE Field;
              |SI FSalida [ 0;  |SAL;  |FINSI;
         |SIGUE;
     |FINSI;

     ICampos = Campos1 <-;
     |PARA XPara = 1; |SI XPara [ 130; |HACIENDO XPara = XPara + 1;
           Variable = Handle + " " + Campos;
           |FGRABA Variable;
           ICampos  = ICampos + 1;
     |SIGUE;
     |FCIERRA Handle;
|FPRC;

|PROGRAMA;
     |NOME_DAT #99  VTemporal0;
     |NOME_DAT #608 VTemporal8;

     |SI VSwCarga = 0;  |O VSwCarga = 1;
         |ABRE #608;  |CIERRA #608;  |DELINDEX #608;
         |ABRE #608;
         |HAZ CargaHoja8;
         |CIERRA #608;
     |FINSI;

     |SI VSwCarga = 100;
         |ABRE #608;
         #608#0 = 0;
         |LEE 040#608=;
         |SI FSalida = 0;
             Suma = #608#44 + #608#82  + #608#110 + #608#14 + #608#118;
             Suma = Suma    + #608#4   + #608#5   + #608#6  + #608#7;
             |SI Suma ! 0;  |HAZ GrabaH08M100;  |FINSI;
         |FINSI;
         |CIERRA #608;
     |FINSI;
|FPRO;
