|FICHEROS;
     rez00100 #0;

     origen@ #100;
     destin@ #200;
|FIN;

|VARIABLES;
     aFichOrigen  = "";
     aFichDestino = "";
     aPathOrigen  = "";
     aPathDestino = "";
     aDirBase     = "";
     aAlfa        = "";
     aFichero     = "";
     aMas         = "";

     nCampos      = 0;
     nHastaCampos = 0;
     nTipo        = 0;

     &empresa     = 0;
|FIN;

|PROCESO Copialo;
     aAlfa = "    Copiando Fichero [" + aFichero + "]";
     |MENSA aAlfa;

     aFichOrigen  = aPathOrigen  + aFichero + ".dat";
     aFichDestino = aPathDestino + aFichero + ".dat";
     |COPIA_FICHERO aFichOrigen, aFichDestino;
     |SI FSalida ! 0;
         aAlfa = "      Error en Copiar Fichero [" + aFichero + ".dat] ";
         |MENAV aAlfa;
     |FINSI;

     aFichOrigen  = aPathOrigen  + aFichero + ".ddx";
     aFichDestino = aPathDestino + aFichero + ".ddx";
     |COPIA_FICHERO aFichOrigen, aFichDestino;
     |SI FSalida ! 0;
         aAlfa = "      Error en Copiar Fichero [" + aFichero + ".ddx] ";
         |MENAV aAlfa;
     |FINSI;

     aFichOrigen  = aPathOrigen  + aFichero + ".ixx";
     aFichDestino = aPathDestino + aFichero + ".ixx";
     |COPIA_FICHERO aFichOrigen, aFichDestino;
     |SI FSalida ! 0;
         aAlfa = "      Error en Copiar Fichero [" + aFichero + ".ixx] ";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO CopiaFicheros;
     aFichero = "reactafe";   |HAZ Copialo;
     aFichero = "reanuali";   |HAZ Copialo;
     aFichero = "rededu01";   |HAZ Copialo;
     aFichero = "rededu02";   |HAZ Copialo;
     aFichero = "rededu03";   |HAZ Copialo;
     aFichero = "rededu04";   |HAZ Copialo;
     aFichero = "rededu05";   |HAZ Copialo;
     aFichero = "rededu06";   |HAZ Copialo;
     aFichero = "rededu07";   |HAZ Copialo;
     aFichero = "rededu08";   |HAZ Copialo;
     aFichero = "rededu09";   |HAZ Copialo;
     aFichero = "rededu10";   |HAZ Copialo;
     aFichero = "redifrei";   |HAZ Copialo;
     aFichero = "repagret";   |HAZ Copialo;
     aFichero = "repartid";   |HAZ Copialo;
     aFichero = "reauxpai";   |HAZ Copialo;
     aFichero = "reauxval";   |HAZ Copialo;
     aFichero = "rebancos";   |HAZ Copialo;
     aFichero = "recofisc";   |HAZ Copialo;
     aFichero = "rehusuar";   |HAZ Copialo;
     aFichero = "repoblac";   |HAZ Copialo;
     aFichero = "rerenpre";   |HAZ Copialo;
|FPRC;

|PROCESO ElPara;
     |LEE 000#100p;
     |PARA;  |SI FSalida = 0; |HACIENDO;
          |PARA nCampos = 0;  |SI nCampos [ nHastaCampos;  |HACIENDO nCampos = nCampos + 1;
               #200nCampos = #100nCampos;
          |SIGUE;
          |GRABA 020#200n;
          |LIBERA #200;

          |LEE 000#100s;
     |SIGUE;
|FPRC;

|PROCESO Imagen;
     |LEE 000#100p;
     |PARA;  |SI FSalida = 0; |HACIENDO;
         |DDEFECTO #200;
         #200#0 = #100#0;
         #200#1 = #100#1;
         #200#2 = #100#13;
         #200#3 = #100#2;
         #200#4 = #100#3;
         #200#5 = #100#16;
         #200#6 = #100#18;
         #200#7 = #100#19;
         #200#8 = #100#20;
         #200#9 = #100#21;
         |GRABA 020#200n;
         |LIBERA #200;

         |LEE 000#100s;
     |SIGUE;
|FPRC;

|PROCESO Profesional;
     |LEE 000#100p;
     |PARA;  |SI FSalida = 0; |HACIENDO;
         |SI nTipo = 1;
             |SI #100#42 = "N";
                 |DDEFECTO #200;
                 #200#0  = #100#0;
                 #200#1  = #100#1;
                 #200#2  = #100#2;
                 #200#3  = #100#3;
                 #200#4  = #100#4;
                 #200#5  = #100#7;
                 #200#6  = #100#8;
                 #200#7  = #100#9;
                 #200#8  = #100#10;
                 #200#9  = #100#11;
                 #200#10 = #100#12;
                 #200#11 = #100#35;
                 #200#12 = #100#13;
                 #200#13 = #100#14;
                 #200#14 = #100#15;
                 #200#15 = #100#39;
                 #200#16 = #100#37;
                 #200#17 = #100#38;
                 #200#18 = #100#17;
                 #200#19 = #100#16;
                 #200#20 = #100#18;
                 #200#21 = #100#19;
                 #200#22 = #100#20;
                 #200#23 = #100#21;
                 #200#24 = #100#22;
                 #200#25 = #100#23;
                 #200#26 = #100#24;
                 #200#27 = #100#25;
                 #200#28 = #100#43;
                 #200#29 = #200#20 + #200#21 + #200#22 + #200#23 + #200#24 + #200#25 + #200#26 + #200#27 + #200#28;
                 #200#30 = #200#19 - #200#29;
                 #200#31 = #100#33;
                 #200#32 = #100#34;
                 #200#33 = #200#31 - #200#32;
                 #200#34 = #200#30 + #200#33;
                 #200#35 = #100#40;
                 #200#36 = #100#41;
                 |GRABA 020#200n;
                 |LIBERA #200;
            |FINSI;
         |FINSI;

         |SI nTipo = 2;
             |SI #100#42 = "S";
                 #200#0  = #100#0;
                 #200#1  = #100#1;
                 #200#2  = #100#2;
                 #200#3  = #100#3;
                 #200#4  = #100#4;
                 #200#5  = #100#7;
                 #200#6  = #100#8;
                 #200#7  = #100#9;
                 #200#8  = #100#10;
                 #200#9  = #100#11;
                 #200#10 = #100#12;
                 #200#11 = #100#35;
                 #200#12 = #100#13;
                 #200#13 = #100#14;
                 #200#14 = #100#15;
                 #200#15 = #100#39;
                 #200#16 = #100#37;
                 #200#17 = #100#38;
                 #200#18 = #100#17;
                 #200#19 = #100#16;
                 #200#20 = 0;
                 #200#21 = 0;
                 #200#22 = #100#18;
                 #200#23 = #100#19;
                 #200#24 = #100#20;
                 #200#25 = #100#21;
                 #200#26 = #100#22;
                 #200#27 = #100#23;
                 #200#28 = #100#24;
                 #200#29 = #100#25;
                 #200#30 = #200#21 + #200#22 + #200#23 + #200#24 + #200#25 + #200#26 + #200#27 + #200#28 + #200#29 - #200#20;
                 #200#31 = #200#19 - #200#30;
                 #200#32 = #200#31 % 5;      |SI #200#32 < 0;  #200#32 = 0;  |FINSI;
                 #200#33 = #200#31 - #200#32;
                 #200#34 = #100#33;
                 #200#35 = #100#34;
                 #200#36 = #200#34 - #200#35;
                 #200#37 = #200#33 + #200#36;
                 #200#38 = #100#40;
                 #200#39 = #100#41;
                 |GRABA 020#200n;
                 |LIBERA #200;
             |FINSI;
         |FINSI;

         |LEE 000#100s;
     |SIGUE;
|FPRC;

|PROCESO Empresarial;
     |LEE 000#100p;
     |PARA;  |SI FSalida = 0; |HACIENDO;
         |SI nTipo = 1;
             |SI #100#60 = "N";
                 |DDEFECTO #200;
                 #200#0  = #100#0;
                 #200#1  = #100#1;
                 #200#2  = #100#2;
                 #200#3  = #100#3;
                 #200#4  = #100#4;
                 #200#5  = #100#7;
                 #200#6  = #100#8;
                 #200#7  = #100#9;
                 #200#8  = #100#10;
                 #200#9  = #100#11;
                 #200#10 = #100#12;
                 #200#11 = #100#54;
                 #200#12 = #100#13;
                 #200#13 = #100#14;
                 #200#14 = #100#15;
                 #200#15 = #100#57;
                 #200#16 = #100#55;
                 #200#17 = #100#56;
                 #200#18 = #100#16;
                 #200#19 = #100#17;
                 #200#20 = #100#18;
                 #200#21 = #100#19;
                 #200#22 = #100#22;
                 #200#23 = #200#19 + #200#20 + #200#21 + #200#22;
                 #200#24 = #100#24;
                 #200#25 = #100#25;
                 #200#26 = #100#26;
                 #200#27 = #100#27;
                 #200#28 = #100#28;
                 #200#29 = #100#29;
                 #200#30 = #100#30;
                 #200#31 = #100#31;
                 #200#32 = #100#32;
                 #200#33 = #100#33;
                 #200#34 = #100#34;
                 #200#35 = #100#35;
                 #200#36 = #100#36;
                 #200#37 = #100#37;
                 #200#38 = #100#38;
                 #200#39 = #100#39;
                 #200#40 = #200#24 + #200#25 + #200#26 + #200#27 + #200#28 + #200#29 + #200#30 + #200#31;
                 #200#40 = #200#40 + #200#32 + #200#33 + #200#34 + #200#35 + #200#36 + #200#37 + #200#38 + #200#39;
                 #200#41 = #200#23 - #200#40;
                 #200#42 = #100#46;
                 #200#43 = #100#47;
                 #200#44 = #200#42 - #200#43;
                 #200#45 = #200#41 + #200#44;
                 #200#46 = #100#58;
                 #200#47 = #100#59;
                 |GRABA 020#200n;
                 |LIBERA #200;
            |FINSI;
         |FINSI;

         |SI nTipo = 2;
             |SI #100#60 = "S";
                 |DDEFECTO #200;
                 #200#0  = #100#0;
                 #200#1  = #100#1;
                 #200#2  = #100#2;
                 #200#3  = #100#3;
                 #200#4  = #100#4;
                 #200#5  = #100#7;
                 #200#6  = #100#8;
                 #200#7  = #100#9;
                 #200#8  = #100#10;
                 #200#9  = #100#11;
                 #200#10 = #100#12;
                 #200#11 = #100#54;
                 #200#12 = #100#13;
                 #200#13 = #100#14;
                 #200#14 = #100#15;
                 #200#15 = #100#57;
                 #200#16 = #100#55;
                 #200#17 = #100#56;
                 #200#18 = #100#16;
                 #200#19 = #100#17;
                 #200#20 = #100#18;
                 #200#21 = #100#19;
                 #200#22 = #100#22;
                 #200#23 = #200#19 + #200#20 + #200#21 + #200#22;
                 #200#24 = 0;
                 #200#25 = 0;
                 #200#26 = #100#24;
                 #200#27 = #100#25;
                 #200#28 = #100#26;
                 #200#29 = #100#27;
                 #200#30 = #100#28;
                 #200#31 = #100#29;
                 #200#32 = #100#30;
                 #200#33 = #100#31;
                 #200#34 = #100#32;
                 #200#35 = #100#33;
                 #200#36 = #100#34;
                 #200#37 = #100#35;
                 #200#38 = #100#39;
                 #200#39 = #200#25 + #200#26 + #200#27 + #200#28 + #200#29 + #200#30 + #200#31 + #200#32;
                 #200#39 = #200#39 + #200#33 + #200#34 + #200#35 + #200#36 + #200#37 + #200#38 - #200#24;
                 #200#40 = #200#23 - #200#39;
                 #200#41 = #200#40 % 5;      |SI #200#41 < 0;  #200#41 = 0;  |FINSI;
                 #200#42 = #200#40 - #200#41;
                 #200#43 = #100#46;
                 #200#44 = #100#47;
                 #200#45 = #200#43 - #200#44;
                 #200#46 = #200#42 + #200#45;
                 #200#47 = #100#58;
                 #200#48 = #100#59;

                 |GRABA 020#200n;
                 |LIBERA #200;
             |FINSI;
         |FINSI;

         |LEE 000#100s;
     |SIGUE;
|FPRC;

|PROCESO Modulos;
     |LEE 000#100p;
     |PARA;  |SI FSalida = 0; |HACIENDO;
           |DDEFECTO #200;
           #200#0   = #100#0;
           #200#1   = #100#1;
           #200#2   = #100#2;
           #200#3   = #100#3;
           #200#4   = #100#4;
           #200#5   = #100#7;
           #200#6   = #100#8;
           #200#7   = #100#9;
           #200#8   = #100#10;
           #200#9   = #100#11;
           #200#10  = #100#12;
           #200#11  = #100#54;
           #200#12  = #100#55;
           #200#13  = #100#56;
           #200#14  = #100#57;
           #200#15  = #100#58;
           #200#16  = #100#13;
           #200#17  = #100#14;
           #200#18  = #100#65;
           #200#19  = #100#15;
           #200#20  = #100#16;
           #200#21  = #100#17;
           #200#22  = #100#18;
           #200#23  = #100#19;
           #200#24  = #100#20;
           #200#25  = #100#21;
           #200#26  = #100#22;
           #200#29  = #100#23;
           #200#30  = #100#24;
           #200#31  = #100#25;
           #200#32  = #100#26;
           #200#33  = #100#27;
           #200#34  = #100#28;
           #200#35  = #100#29;
           #200#38  = #100#30;
           #200#39  = #100#31;
           #200#40  = #100#32;
           #200#41  = #100#33;
           #200#42  = #100#34;
           #200#43  = #100#35;
           #200#44  = #100#36;
           #200#47  = #100#37;
           #200#59  = #100#37;
           #200#73  = #100#72;
           #200#86  = #100#40;
           #200#90  = #100#73;
           #200#98  = #100#38;
           #200#100 = #100#40;
           #200#108 = #100#76;
           #200#96  = #100#79;
           |GRABA 020#200n;
           |LIBERA #200;

           |LEE 000#100s;
     |SIGUE;
|FPRC;

|PROCESO AgriCabecera;
     |LEE 000#100p;
     |PARA;  |SI FSalida = 0; |HACIENDO;
           |DDEFECTO #200;
           #200#0   = #100#0;
           #200#1   = #100#1;
           #200#2   = #100#2;
           #200#3   = #100#3;
           #200#4   = #100#4;
           #200#5   = #100#7;
           #200#6   = #100#8;
           #200#7   = #100#9;
           #200#8   = #100#10;
           #200#9   = #100#11;
           #200#10  = #100#12;
           #200#11  = #100#6;
           #200#12  = #100#13;
           #200#13  = #100#14;
           #200#14  = #100#15;
           #200#15  = #100#16;
           #200#16  = #100#17;
           #200#17  = #100#18;
           #200#42  = #100#35;
           #200#43  = #100#36;
           |GRABA 020#200n;
           |LIBERA #200;

           |LEE 000#100s;
     |SIGUE;
|FPRC;

|PROCESO PasaFicheros;
     aAlfa = "    Traspasando Fichero [re" + aFichero + "]";
     |MENSA aAlfa;

     aFichOrigen  = aPathOrigen + "re" + aFichero + ".dat";
     aFichDestino = aPathOrigen + "ba" + aFichero + ".dat";
     |COPIA_FICHERO aFichOrigen, aFichDestino;
     |SI FSalida ! 0;
         aAlfa = "      Error en Copiar Fichero [" + aFichero + ".dat] ";
         |MENAV aAlfa;
     |FINSI;

     aFichOrigen  = aPathOrigen + "re" + aFichero + ".ddx";
     aFichDestino = aPathOrigen + "ba" + aFichero + ".ddx";
     |COPIA_FICHERO aFichOrigen, aFichDestino;
     |SI FSalida ! 0;
         aAlfa = "      Error en Copiar Fichero [" + aFichero + ".ddx] ";
         |MENAV aAlfa;
     |FINSI;

     aFichOrigen  = aPathOrigen + "re" + aFichero + ".ixx";
     aFichDestino = aPathOrigen + "ba" + aFichero + ".ixx";
     |COPIA_FICHERO aFichOrigen, aFichDestino;
     |SI FSalida ! 0;
         aAlfa = "      Error en Copiar Fichero [" + aFichero + ".ixx] ";
         |MENAV aAlfa;
     |FINSI;

     aMas  = aDirBase + "def/" + "ba" + aFichero;
     |CARGA_DEF aMas, origen@;
     |SI FSalida ! 0;
         |MENAV  "         Error en cargar el Def ... Proceso Abortado.";
         |ACABA;
     |FINSI;
     |PATH_DAT #100 aPathOrigen;

     |SI nHastaCampos = 0;
         |SI aFichero = "imagen";  aMas  = aDirBase + "def/" + "rem00006";  |FINSI;

         |SI aFichero = "proedi";
             |SI nTipo = 1;  aMas  = aDirBase + "def/" + "rem00010";  |FINSI;
             |SI nTipo = 2;  aMas  = aDirBase + "def/" + "rem00011";  |FINSI;
         |FINSI;

         |SI aFichero = "empedi";
             |SI nTipo = 1;  aMas  = aDirBase + "def/" + "rem00012";  |FINSI;
             |SI nTipo = 2;  aMas  = aDirBase + "def/" + "rem00013";  |FINSI;
         |FINSI;

         |SI aFichero = "empmod";
             aMas  = aDirBase + "def/" + "reempmod";
         |FINSI;

         |SI aFichero = "empagr";
             aMas  = aDirBase + "def/" + "rem00014";
         |FINSI;
     |SINO;
         aMas  = aDirBase + "def/" + "re" + aFichero;
     |FINSI;

     |CARGA_DEF aMas, destin@;
     |SI FSalida ! 0;
         |MENAV  "         Error en cargar el Def ... Proceso Abortado.";
         |ACABA;
     |FINSI;

     |ABRE #100;
     |ABRE #200;

     |SI nHastaCampos = 0;
         |SI aFichero = "imagen";  |HAZ Imagen;        |FINSI;
         |SI aFichero = "proedi";  |HAZ Profesional;   |FINSI;
         |SI aFichero = "empedi";  |HAZ Empresarial;   |FINSI;
         |SI aFichero = "empmod";  |HAZ Modulos;       |FINSI;
         |SI aFichero = "empagr";  |HAZ AgriCabecera;  |FINSI;
     |SINO;
         |HAZ ElPara;
     |FINSI;

     |CIERRA #100;
     |CIERRA #200;

     |DESCARGA_DEF #origen@;
     |DESCARGA_DEF #destin@;
|FPRC;

|PROCESO TrataFicheros;
     aFichero = "acceso";  nHastaCampos = 2;               |HAZ PasaFicheros;
     aFichero = "datcon";  nHastaCampos = 214;             |HAZ PasaFicheros;
     aFichero = "capinm";  nHastaCampos = 74;              |HAZ PasaFicheros;
     aFichero = "jerant";  nHastaCampos = 8;               |HAZ PasaFicheros;
     aFichero = "rendtr";  nHastaCampos = 29;              |HAZ PasaFicheros;
     aFichero = "transp";  nHastaCampos = 23;              |HAZ PasaFicheros;
     aFichero = "valono";  nHastaCampos = 48;              |HAZ PasaFicheros;
     aFichero = "valore";  nHastaCampos = 45;              |HAZ PasaFicheros;
     aFichero = "ctacor";  nHastaCampos = 31;              |HAZ PasaFicheros;
     aFichero = "patrim";  nHastaCampos = 18;              |HAZ PasaFicheros;
     aFichero = "incpen";  nHastaCampos = 29;              |HAZ PasaFicheros;
     aFichero = "imagen";  nHastaCampos = 0;               |HAZ PasaFicheros;
     aFichero = "proedi";  nHastaCampos = 0;  nTipo = 1;   |HAZ PasaFicheros;
     aFichero = "proedi";  nHastaCampos = 0;  nTipo = 2;   |HAZ PasaFicheros;
     aFichero = "empedi";  nHastaCampos = 0;  nTipo = 1;   |HAZ PasaFicheros;
     aFichero = "empedi";  nHastaCampos = 0;  nTipo = 2;   |HAZ PasaFicheros;
     aFichero = "empmod";  nHastaCampos = 0;               |HAZ PasaFicheros;
     aFichero = "empagr";  nHastaCampos = 0;               |HAZ PasaFicheros;
|FPRC;

|PROCESO Tipo3;   |TIPO 3;
     |DBASE aDirBase;     |QBF aDirBase;
     |DFICE aPathDestino; |QBF aPathDestino;
     aPathOrigen = #0#0;  |QBF aPathOrigen;

     |SI aPathOrigen = "";  |ACABA;  |FINSI;

     aMas  = aDirBase + "def/reacceso";
     |CARGA_DEF aMas, destin@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #destin@;
         |MENAV  "         Error en cargar el Def ... Proceso Abortado.";
         |ACABA;
     |FINSI;

     |ABRE #200;
     |LEE 040#200p;
     |SI FSalida = 0;
         |CIERRA #200;
         |MENAV "     Ya hay datos generados en la Renta98";
         |ACABA;
     |FINSI;
     |CIERRA #200;
     |DESCARGA_DEF #destin@;

     |HAZ CopiaFicheros;
     |HAZ TrataFicheros;

     empresa = -1;
     |SUB_EJECUTA "rerecdat";
|FPRC;
