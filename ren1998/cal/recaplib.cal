|FICHEROS;
     recaplib #00;   || Captura
     rem00010 #01;   || Profesionales Modalidad Normal        (PC)
     rem00011 #02;   || Profesionales Modalidad Simplificada  (PB)
     rem00012 #03;   || Empresarios   Modalidad Normal        (EC)
     rem00013 #04;   || Empresarios   Modalidad Simplificada  (EB)
     redatcon #11;   || Datos Contribuyentes
     rem00500 #13;   || Planilla Pase desde Libros
     repagret #25;   || Retenciones y Pagos a Cuenta
     rem00014 #40;   || Agricolas Cabeceras
     rem00015 #41;   || Agricolas Lineas
     recapinm #42;   || Capital Inmobiliario
     rem00502 #43;   || Control Arrendamientos C2
     rem00503 #44;   || Control Arrendamientos C6

     eosclien #06;   || clientes REO
     eosactiv #07;   || actividades REO
     eoslinve #12;   || ventas lins.
     eoslinco #14;   || compras lins.
     eoscomul #16;   || Comuneros Lineas
     eosexist #17;   || Existencias
     eosm3130 #24;   || 130 REO
     eosm0020 #26;   || 131 REO
     eosconcd #27;   || Conceptos Agricolas
     eosconce #28;   || Conceptos
     eosm0011 #29;   || Maestros Referencias
     eosm0012 #30;   || Registros Arrendamientos
     eosconc6 #31;   || Conceptos 6 Digitos

     agicontr #20;
|FIN;

|VARIABLES;
     nCanti1    = 0;
     nCanti2    = 0;
     nRdto97    = 0;
     nCProducto = 0;
     nLProducto = 0;
     nCoefi98   = 0;
     nCoefi97   = 0;
     nCodInter  = 0;

     linea_p = 0;
     FEstado = 0;

     aPath  = "";
     aPathO = "";
     aPathD = "";
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     nume4 = 0;
     fech1 = @;
     fech2 = @;
     fech3 = @;
     fech4 = @;

     coef_gas = 0;
     agieos = "";
     retenci = 0;
     ultima = 0;
     tipo = "";
     perc = "";
     seleccio = 0;
     grabalo = 0;
     buscanif = "";
     control = 0;
     n_cont  = 0;
     n_cant  = 0;
     n_tipo  = "";
     n_esta  = 0;
     aConcepto  = "";
     campo_e = 0;
     campo_a = 0;

     empresa = 0;
     campo19 = 0;
     campo20 = 0;
     campo21 = 0;
     campo22 = 0;
     campo23 = 0;
     campo24 = 0;
     campo25 = 0;
     campo26 = 0;
     campo27 = 0;
     campo28 = 0;
     campo29 = 0;
     campo30 = 0;
     campo31 = 0;
     campo32 = 0;
     campo33 = 0;
     campo34 = 0;
     campo35 = 0;
     campo36 = 0;
     campo37 = 0;
     campo38 = 0;
     campo39 = 0;

     fichero = "";
     anyo = "";
     porce   = 0;
     nombre  = "";
     sw_estar = 0;
     LoHago   = 0;
     Nombre   = "";

     Total    = 0;
     Producto = 0;
     _Agri    = "";
     TipoT    = "";
     Porce    = 0;
     Bas      = 0;
     _Iv      = 0;
     Rec      = 0;
     Ret      = 0;
     Retencion= 0;
     Dto1     = 0;
     Dto2     = 0;
     Dto3     = 0;
     _Ingresos = 0;
     Campo01   = 0;
     Campo02   = 0;
     Campo03   = 0;
     Campo04   = 0;
     Campo05   = 0;
     RCatastral = "";
     LineaB     = 0;
     nTipoCon   = 0;

     &dni = "";
     &codigo = 0;
     &error = "";
     &empre_e = 0;
     &empre_r = 0;
     &activ_e = 0;
     &tipo_e  = "";
     &EsArrend = 0;
     &LineaArre = 0;
|FIN;

|INCLUYE i_husuar;
|INCLUYE i_activo;
|INCLUYE i_cambio;

     *********************************************************************
     LLAMADAS DESDE CAMPOS
     *********************************************************************

|PROCESO path;
     |DBASS alfa1;  |QBF alfa1;
     |PATH_DAT #20 alfa1;
     |ABRE #20;
     |LEE 040#20p;
     |SI FSalida ! 0; |DDEFECTO #20; |FINSI;
     |CIERRA #20;

     agieos = #20#3; |QBF agieos;

     |PATH_DAT #06 agieos;  || empresas
     |PATH_DAT #07 agieos;  || empresas/actividades
     |PATH_DAT #12 agieos;  || ventas lins.
     |PATH_DAT #14 agieos;  || compras lins.
     |PATH_DAT #16 agieos;  || Comuneros lineas
     |PATH_DAT #17 agieos;  || Existencias
     |PATH_DAT #24 agieos;  || 130
     |PATH_DAT #26 agieos;  || 131
     |PATH_DAT #27 agieos;  || Conceptos Agricolas
     |PATH_DAT #28 agieos;  || Conceptos
     |PATH_DAT #29 agieos;  || arrendamientos
     |PATH_DAT #30 agieos;  || arrendamientos
     |PATH_DAT #31 agieos;  || Conceptos 6 Digitos
|FPRC;

|PROCESO lee_eos1; |TIPO 0;        || lee empresa en R.E.O.
     |ABRE #6;
     #6#0 = #0#1;
     |LEE 001#6=;
     |SI FSalida ! 0;
          |DDEFECTO #6;
          |MENAV "    ATENCION!!! Empresa inexistente en R.E.O. ...";
          |ERROR;
     |FINSI;
     |ATRI I;
     |PINTA 1419, #6#2;
     |ATRI 0;
     |CIERRA #6;
|FPRC;

|PROCESO lee_eos2; |TIPO 0;   || lee actividad en R.E.O.
     |ABRE #7;
     #7#0 = #0#1;
     #7#1 = #0#2;
     #7#2 = 98;
     |LEE 001#7=;
     |SI FSalida ! 0;
         |DDEFECTO #7;
         |MENAV "    ATENCION!!! Actividad inexistente en R.E.O. ...";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #7#14 = "S";
         |MENAV "    ATENCION!!! Actividad Comunero, introduzca la Comunidad.";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #7#46 = "S";
         |CAMPO_MODIFICA #0#5, 1, "S";
         |CAMPO_MODIFICA #0#6, 1, "S";
     |SINO;
         |CAMPO_MODIFICA #0#5, 1, "N";
         |CAMPO_MODIFICA #0#6, 1, "N";
         #0#5 = 0;  |PINTA #0#5;
         #0#6 = 0;  |PINTA #0#6;
         |PINTA 1719, "                                       ";
     |FINSI;

     |ATRI I;
     |PINTA 1519, #7#6;
     |ATRI 0;
     |CIERRA #7;
|FPRC;

|PROCESO es_comuner;
     |SI #16#0 = #0#1; |Y #16#1 = #0#2;
         sw_estar = 1;
         porce    = #16#6;
         nombre   = #16#4;
     |FINSI;
|FPRC;

|DEFBUCLE eoscomul;
     #16#2;
     ;
     #0#5, #0#6, 98;
     #0#5, #0#6, 98;
     e;
     NULL, es_comuner;
|FIN;

|PROCESO mira_comu; |TIPO 0;
     |SI #7#46 = "N"; |ACABA; |FINSI;

     sw_estar = 0;
     |BUCLE eoscomul;
     |SI sw_estar = 0;
         |MENAV "    La empresa comunero no pertenece a la Comunidad de Bienes";
         |ERROR;
         |ACABA;
     |SINO;
         |PINTA 1719, nombre;
     |FINSI;
|FPRC;

|PROCESO lee_renta1; |TIPO 0;
     |ABRE #11;
     #11#0 = #0#3;
     |LEE 001#11=;
     |SI FSalida ! 0;
         |DDEFECTO #11;
         |MENAV "    ATENCION!!! Contribuyente inexistente en RENTA ...";
         |ERROR;
     |FINSI;
     |CIERRA #11;
     Nombre = #11#1;
|FPRC;

|PROCESO lee_renta2; |TIPO 0;
     |ATRI I;
     |SI #0#4 = "T";  |PINTA 1919, #11#01;  |FINSI;
     |SI #0#4 = "C";  |PINTA 1919, #11#28;  |FINSI;
     |ATRI 0;
|FPRC;

|PROCESO pide_otro;
     |PUSHV 10141464;
     |AVISO;
     |ATRI P;
     |CUADRO 10141464;
     |ATRI 0;
     |ATRI I;
     |PINTA 1115," Actividad con regimen 1998 diferente a 1998 !!! ";
     |PINTA 1315," Informe del regimen al que pertenecia en 1998 ..";
     |ATRI 0;
     |ATRI R;
     |PINTA 1215,"   (E)mpr./(P)rof.:    *  (B)Simp./(C)Normal:    ";
     |ATRI 0;
     E_sup = "1";
     E_inf = "EPX";
     |MENSA "0400Entre: (E) empresarial; (P) profesional; (X) fuera";
     alfa2 = 1235 ? 0;
     |BLIN 4;
     |SI alfa2 ! "X";
         E_sup = "1";
         E_inf = "BCX";
         |MENSA "0400Entre: (B) Simplificadas; (C) Normal; (X) fuera";
         alfa3 = 1261 ? 0;
         |BLIN 4;
     |FINSI;
     |POPV;
     alfa1 = alfa2 + alfa3;
     #7#23 = alfa2;
     #7#22 = alfa3;
|FPRC;

     *********************************************************************
     LECTURA ACTIVIDADES
     *********************************************************************

|PROCESO captura1;
     tipo = #0#4;
     |SI tipo = "T";  perc = "TITULAR";  |FINSI;
     |SI tipo = "C";  perc = "CONYUGE";  |FINSI;

     coef_gas = #7#25;
     |SI #7#46 = "S";
         |ABRE #7;
         #7#0 = #0#5;
         #7#1 = #0#6;
         #7#2 = 98;
         |LEE 040#7=;
         |SI FSalida ! 0; |DDEFECTO #7; |FINSI;
         |CIERRA #7;
     |SINO;
         porce = 100;
     |FINSI;

     |SI EsArrend = 1;
         |HAZ Arrendamientos;
         |ACABA;
     |FINSI;

     nTipoCon = #7#50;
     |SI #7#41 = "S";
         |HAZ pagos;
         |HAZ Agricolas;
     |SINO;
         |SI #7#23 = "V";
            alfa1    = #7#4 + #7#22;
         |SINO;
            alfa1    = #7#23 + #7#22;
         |FINSI;

         n_tipo   = alfa1;                               || variable conserva
         |SI alfa1 = "EA";   |HAZ pide_otro;  |FINSI;
         |SI alfa1 = "PC";   |HAZ ProfNormal1;  |FINSI;
         |SI alfa1 = "PB";   |HAZ ProfSimpli1;  |FINSI;
         |SI alfa1 = "EC";   |HAZ EmprNormal1;  |FINSI;
         |SI alfa1 = "EB";   |HAZ EmprSimpli1;  |FINSI;
         |HAZ pagos;
     |FINSI;
|FPRC;

*********************************************************************
LECTURA DEL 131 Y MODULOS
*********************************************************************

|PROCESO lee_131b;
     |SI #26#3 = "01.01.0000"; |ACABA; |FINSI;

     #25#0 = #0#3;
     #25#1 = linea_p;
     |LIBERA #25;
     |LEE 140#25=;
     FEstado = FSalida;
     |SI FEstado ! 0; |DDEFECTO #25; |FINSI;

     #25#0 = #0#3;
     #25#1 = linea_p;
     #25#2 = #0#4;
     #25#3 = perc;
     #25#4 = 0;

     |SI #26#47 > 0;
         |SI #26#2 = 1;  #25#5 = #26#47;  |FINSI;
         |SI #26#2 = 2;  #25#6 = #26#47;  |FINSI;
         |SI #26#2 = 3;  #25#7 = #26#47;  |FINSI;
         |SI #26#2 = 4;  #25#8 = #26#47;  |FINSI;
     |FINSI;

     #25#9 = #25#9 + #26#41 + #26#45;

     |SI #25#5 ! 0; |O #25#6 ! 0; |O #25#7 ! 0; |O #25#8 ! 0; |O #25#9 ! 0;
         |SI FEstado = 0; |GRABA 140#25a; |SINO; |GRABA 140#25n; |FINSI;
         npro = 51;  empresa = #0#3;  |HAZ sigrabo;
         HContribu  = #25#0;
         HNombre    = Nombre;
         HPrograma  = "(repagret) RETENCIONES Y PAGOS A CUENTA";
         HLinea     = #25#1;
         HPerceptor = #25#3;
         HRdto      = #25#5 + #25#6 + #25#7 + #25#8;
         HTipo      = "ALTA FICHA DESDE PASE REO";
         |HAZ AltaHistorico;
     |FINSI;
|FPRC;

|DEFBUCLE lee_131;
     #26#1;
     ;
     #7#0, 1, 98;
     #7#0, 4, 98;
     e;
     NULL, lee_131b;
|FIN;

|PROCESO lee_m3130b;
     |SI #24#4 = "          "; |ACABA; |FINSI;

     #25#0 = #0#3;
     #25#1 = linea_p;
     |LIBERA #25;
     |LEE 140#25=;
     FEstado = FSalida;
     |SI FEstado ! 0; |DDEFECTO #25; |FINSI;

     #25#0 = #0#3;
     #25#1 = linea_p;
     #25#2 = #0#4;
     #25#3 = perc;
     #25#4 = 0;

     |SI #24#29 > 0;
         |SI #24#2 = 1;  #25#5 = #24#29;  |FINSI;
         |SI #24#2 = 2;  #25#6 = #24#29;  |FINSI;
         |SI #24#2 = 3;  #25#7 = #24#29;  |FINSI;
         |SI #24#2 = 4;  #25#8 = #24#29;  |FINSI;
     |FINSI;

     |SI #7#41 ! "S";  #25#9 = #25#9 + #24#23 + #24#36;  |FINSI;

     |SI #25#5 ! 0; |O #25#6 ! 0; |O #25#7 ! 0; |O #25#8 ! 0; |O #25#9 ! 0;
         |SI FEstado = 0; |GRABA 140#25a; |SINO; |GRABA 140#25n; |FINSI;
         npro = 51;  empresa = #0#3;  |HAZ sigrabo;
         HContribu  = #25#0;
         HNombre    = Nombre;
         HPrograma  = "(repagret) RETENCIONES Y PAGOS A CUENTA";
         HLinea     = #25#1;
         HPerceptor = #25#3;
         HRdto      = #25#5 + #25#6 + #25#7 + #25#8;
         HTipo      = "ALTA FICHA DESDE PASE REO";
         |HAZ AltaHistorico;
     |FINSI;
|FPRC;

|DEFBUCLE lee_m3130;
     #24#1;
     ;
     #7#0, 0, 1, 98;
     #7#0, 9, 4, 98;
     e;
     NULL, lee_m3130b;
|FIN;

|PROCESO ChequeaPagos;
     |SI #25#2 = #0#4; linea_p = #25#1; LoHago = 1; |ERROR10; |ACABA; |FINSI;
     linea_p = #25#1;
|FPRC;

|DEFBUCLE repagret;
     #25#1;
     ;
     #0#3,  1;
     #0#3, 99;
     ;
     NULL, ChequeaPagos;
|FIN;

|PROCESO pagos;
     linea_p = 0;
     LoHago  = 0; |BUCLE repagret;
     |SI LoHago = 1; |ACABA; |FINSI;

     |ABRE #25;
     linea_p = linea_p + 1; |BUCLE lee_131;
     linea_p = linea_p + 1; |BUCLE lee_m3130;
     |CIERRA #25;
|FPRC;


     *********************************************************************
     LECTURA DE LIBROS Y CARGA DE CAMPOS
     *********************************************************************

|PROCESO TEmpNorm;
     |SI n_cont = 0;  |ACABA;  |FINSI;
     |SI n_cant = 0;  |ACABA;  |FINSI;

     |SI n_cont =  1;  campo24 = campo24 + n_cant;  |FINSI;
     |SI n_cont =  2;  campo25 = campo25 + n_cant;  |FINSI;
     |SI n_cont =  3;  campo26 = campo26 + n_cant;  |FINSI;
     |SI n_cont =  4;  campo27 = campo27 + n_cant;  |FINSI;
     |SI n_cont =  5;  campo28 = campo28 + n_cant;  |FINSI;
     |SI n_cont =  6;  campo29 = campo29 + n_cant;  |FINSI;
     |SI n_cont =  7;  campo30 = campo30 + n_cant;  |FINSI;
     |SI n_cont =  8;  campo31 = campo31 + n_cant;  |FINSI;
     |SI n_cont =  9;  campo32 = campo32 + n_cant;  |FINSI;
     |SI n_cont = 10;  campo33 = campo33 + n_cant;  |FINSI;
     |SI n_cont = 11;  campo34 = campo34 + n_cant;  |FINSI;
     |SI n_cont = 12;  campo35 = campo35 + n_cant;  |FINSI;
     |SI n_cont = 13;  campo36 = campo36 + n_cant;  |FINSI;
     |SI n_cont = 14;  campo37 = campo37 + n_cant;  |FINSI;
     |SI n_cont = 15;  campo38 = campo38 + n_cant;  |FINSI;
     |SI n_cont = 16;  campo39 = campo39 + n_cant;  |FINSI;
|FPRC;

|PROCESO TEmpSimp;
     |SI n_cont = 0;  |ACABA;  |FINSI;
     |SI n_cant = 0;  |ACABA;  |FINSI;

     |SI n_cont = 1;  campo26 = campo26 + n_cant;  |FINSI;
     |SI n_cont = 2;  campo27 = campo27 + n_cant;  |FINSI;   || coste pers.
     |SI n_cont = 3;  campo28 = campo28 + n_cant;  |FINSI;
     |SI n_cont = 4;  campo29 = campo29 + n_cant;  |FINSI;
     |SI n_cont = 5;  campo30 = campo30 + n_cant;  |FINSI;
     |SI n_cont = 6;  campo31 = campo31 + n_cant;  |FINSI;
     |SI n_cont = 7;  campo32 = campo32 + n_cant;  |FINSI;
     |SI n_cont = 8;  campo33 = campo33 + n_cant;  |FINSI;
     |SI n_cont = 9;  campo34 = campo34 + n_cant;  |FINSI;
     |SI n_cont = 10; campo35 = campo35 + n_cant;  |FINSI;
     |SI n_cont = 11; campo36 = campo36 + n_cant;  |FINSI;
     |SI n_cont = 12; campo37 = campo37 + n_cant;  |FINSI;
     |SI n_cont = 13; campo38 = campo38 + n_cant;  |FINSI;
|FPRC;

|PROCESO TProNorm;
     |SI n_cont = 0;  |ACABA;  |FINSI;
     |SI n_cant = 0;  |ACABA;  |FINSI;

     |SI n_cont = 1;  campo20 = campo20 + n_cant;  |FINSI;
     |SI n_cont = 2;  campo21 = campo21 + n_cant;  |FINSI;
     |SI n_cont = 3;  campo22 = campo22 + n_cant;  |FINSI;
     |SI n_cont = 4;  campo23 = campo23 + n_cant;  |FINSI;
     |SI n_cont = 5;  campo24 = campo24 + n_cant;  |FINSI;
     |SI n_cont = 6;  campo25 = campo25 + n_cant;  |FINSI;
     |SI n_cont = 7;  campo26 = campo26 + n_cant;  |FINSI;
     |SI n_cont = 8;  campo27 = campo27 + n_cant;  |FINSI;
     |SI n_cont = 9;  campo28 = campo28 + n_cant;  |FINSI;
|FPRC;

|PROCESO TProSimp;
     |SI n_cont = 0;  |ACABA;  |FINSI;
     |SI n_cant = 0;  |ACABA;  |FINSI;

     |SI n_cont = 1;  campo22 = campo22 + n_cant;  |FINSI;
     |SI n_cont = 2;  campo23 = campo23 + n_cant;  |FINSI;
     |SI n_cont = 3;  campo24 = campo24 + n_cant;  |FINSI;
     |SI n_cont = 4;  campo25 = campo25 + n_cant;  |FINSI;
     |SI n_cont = 5;  campo26 = campo26 + n_cant;  |FINSI;
     |SI n_cont = 6;  campo27 = campo27 + n_cant;  |FINSI;
     |SI n_cont = 7;  campo28 = campo28 + n_cant;  |FINSI;
     |SI n_cont = 8;  campo29 = campo29 + n_cant;  |FINSI;
|FPRC;

|PROCESO LeePlanilla;
     |DDEFECTO #13;
     |ABRE #13;
     #13#0 = aConcepto;
     |LEE 001#13=;
     |SI FSalida = 0;   n_esta = 1;  |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO busca_cto;
     n_esta = 0;
     |SI aConcepto = ""; |O n_cant = 0;  |ACABA;  |FINSI;

     |HAZ LeePlanilla;
     |SI n_esta ! 0;
         |SI n_tipo = "PC";  n_cont = #13#3;  |FINSI;
         |SI n_tipo = "EC";  n_cont = #13#4;  |FINSI;
         |SI n_tipo = "PB";  n_cont = #13#5;  |FINSI;
         |SI n_tipo = "EB";  n_cont = #13#6;  |FINSI;
         |SI n_cont ! 0;
             |SI #13#2 = "G";                      || compras
                 |SI n_tipo = "PC";  |HAZ TProNorm;  |FINSI;
                 |SI n_tipo = "EC";  |HAZ TEmpNorm;  |FINSI;
                 |SI n_tipo = "PB";  |HAZ TProSimp;  |FINSI;
                 |SI n_tipo = "EB";  |HAZ TEmpSimp;  |FINSI;
             |FINSI;

             |SI #13#2 = "I";                      || ingresos
                 |SI n_tipo = "PC";  campo19 = campo19 + n_cant;  |FINSI;
                 |SI n_tipo = "EC";
                     |SI n_cont = 1; campo19 = campo19 + n_cant;  |FINSI;
                     |SI n_cont = 2; campo20 = campo20 + n_cant;  |FINSI;
                     |SI n_cont = 3; campo21 = campo21 + n_cant;  |FINSI;
                     |SI n_cont = 4; campo22 = campo22 + n_cant;  |FINSI;
                 |FINSI;
                 |SI n_tipo = "PB";  campo19 = campo19 + n_cant;  |FINSI;
                 |SI n_tipo = "EB";
                     |SI n_cont = 1; campo19 = campo19 + n_cant;  |FINSI;
                     |SI n_cont = 2; campo20 = campo20 + n_cant;  |FINSI;
                     |SI n_cont = 3; campo21 = campo21 + n_cant;  |FINSI;
                     |SI n_cont = 4; campo22 = campo22 + n_cant;  |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO lee_librocb;
     grabalo = 1;

     aConcepto = ("------" + (("00" + #14#5) % -102)) % -106;                    || concepto 1
     |SI nTipoCon = 2;  aConcepto = #14#72;  |FINSI;
     n_cant    = #14#7 % porce;               || importe 1
     |HAZ busca_cto;

     aConcepto = ("------" + (("00" + #14#33) % -102)) % -106;
     |SI nTipoCon = 2;  aConcepto = #14#73;  |FINSI;
     n_cant = #14#23 % porce;              || importe 2
     |HAZ busca_cto;

     aConcepto = ("------" + (("00" + #14#34) % -102)) % -106;
     |SI nTipoCon = 2;  aConcepto = #14#74;  |FINSI;
     n_cant = #14#24 % porce;              || importe 3
     |HAZ busca_cto;
|FPRC;

|PROCESO lee_librovb;
     grabalo = 1;

     aConcepto = ("------" + (("00" + #12#5) % -102)) % -106;                    || concepto 1
     |SI nTipoCon = 2;  aConcepto = #12#72;  |FINSI;
     n_cant = #12#7 % porce;               || importe 1
     |HAZ busca_cto;

     aConcepto = ("------" + (("00" + #12#33) % -102)) % -106;
     |SI nTipoCon = 2;  aConcepto = #12#73;  |FINSI;
     n_cant = #12#23 % porce;              || importe 2
     |HAZ busca_cto;

     aConcepto = ("------" + (("00" + #12#34) % -102)) % -106;
     |SI nTipoCon = 2;  aConcepto = #12#74;  |FINSI;
     n_cant = #12#24 % porce;              || importe 3
     |HAZ busca_cto;

     aConcepto = ("------" + (("00" + #12#60) % -102)) % -106;
     |SI nTipoCon = 2;  aConcepto = #12#75;  |FINSI;
     n_cant = #12#45 % porce;              || importe 4
     |HAZ busca_cto;

     aConcepto = ("------" + (("00" + #12#61) % -102)) % -106;
     |SI nTipoCon = 2;  aConcepto = #12#76;  |FINSI;
     n_cant = #12#46 % porce;              || importe 5
     |HAZ busca_cto;

     aConcepto = ("------" + (("00" + #12#62) % -102)) % -106;
     |SI nTipoCon = 2;  aConcepto = #12#77;  |FINSI;
     n_cant = #12#47 % porce;              || importe 6
     |HAZ busca_cto;
|FPRC;

|PROCESO lee_libroa;
     retenci = 0;
     campo19 = 0;
     campo20 = 0;
     campo21 = 0;
     campo22 = 0;
     campo23 = 0;
     campo21 = 0;
     campo22 = 0;
     campo23 = 0;
     campo24 = 0;
     campo25 = 0;
     campo26 = 0;
     campo27 = 0;
     campo28 = 0;
     campo29 = 0;
     campo30 = 0;
     campo31 = 0;
     campo32 = 0;
     campo33 = 0;
     campo34 = 0;
     campo35 = 0;
     campo36 = 0;
     campo37 = 0;
     campo38 = 0;
     campo39 = 0;
|FPRC;

|DEFBUCLE lee_libroc;
     #14#1;
     19;
     #0#1, 98,    0, #0#2;
     #0#1, 98, 9999, #0#2;
     e;
     NULL, lee_librocb;
|FIN;

|DEFBUCLE lee_librov;
     #12#1;
     19;
     #0#1, 98,    0, #0#2;
     #0#1, 98, 9999, #0#2;
     e;
     NULL, lee_librovb;
|FIN;

|PROCESO LeeExist;
     |ABRE #17;
     #17#0 = #0#1;
     #17#1 = #0#2;
     #17#2 = 98;
     |LEE 040#17=;
     |SI FSalida ! 0;  |DDEFECTO #17;  |FINSI;
     |CIERRA #17;
|FPRC;

|PROCESO re_compras;
     fichero = #0#1;
     fichero = "00000" + fichero;
     fichero = fichero % -105;
     anyo    = "98";
     fichero = "c" + fichero + anyo;
     |NOME_DAT #14 fichero;
|FPRC;

|PROCESO re_ventas;
     fichero = #0#1;
     fichero = "00000" + fichero;
     fichero = fichero % -105;
     anyo    = "98";
     fichero = "v" + fichero + anyo;
     |NOME_DAT #12 fichero;
|FPRC;

|PROCESO comun;
     grabalo = 0;
     |HAZ LeeExist;
     |HAZ lee_libroa;
     |HAZ re_compras;  |BUCLE lee_libroc;
     |HAZ re_ventas;   |BUCLE lee_librov;
|FPRC;


     *********************************************************************
     GRABACION DE PROFESIONALES EN ESTIMACION DIRECTA
     *********************************************************************

|PROCESO ProfNormal3;
     #1#29 = #1#20 + #1#21 + #1#22 + #1#23 + #1#24 + #1#25 + #1#26 + #1#27 + #1#28;
     #1#30 = #1#19 - #1#29;
     #1#33 = #1#31 - #1#32;
     #1#34 = #1#30 + #1#33;
|FPRC;

|PROCESO ProfNormal2;
     |ABRE #1;
     |HAZ ultimo1;
     |DDEFECTO #1;
     #1#00 = #0#3;        || codigo
     #1#01 = ultima;      || linea
     #1#02 = tipo;        || tipo
     #1#03 = perc;        || perceptor
     #1#12 = #7#4;        || epigrafe -1-
     #1#13 = #7#5;        || epigrafe -2-
     #1#14 = #7#6;        || nombre actividad
     #1#15 = #7#9;        || Domicilio
     #1#16 = #7#11;       || Codigo Provincia
     #1#17 = #7#12;       || Codigo Poblacion
     #1#19 = campo19;
     #1#20 = campo20;
     #1#21 = campo21;
     #1#22 = campo22;
     #1#23 = campo23;
     #1#24 = campo24;
     #1#25 = campo25;
     #1#26 = campo26;
     #1#27 = campo27;
     #1#28 = campo28;

     |HAZ ProfNormal3;          || CALCULA ...

     |GRABA 020#1n;
     |SI FSalida=0; npro=7; empresa=#0#3; |HAZ sigrabo; |FINSI;      || marca (*)

     |CIERRA #1;

     HContribu  = #1#0;
     HNombre    = Nombre;
     HPrograma  = "(rem00010) PROFESIONALES MOD.NORMAL";
     HLinea     = #1#1;
     HPerceptor = #1#3;
     HRdto      = #1#34;
     HTipo      = "ALTA FICHA DESDE PASE REO";
     |HAZ AltaHistorico;
|FPRC;

|PROCESO ultimo1;
     #1#0 = #0#3;
     #1#1 = 99;
     |LEE 001#1];
     |SI FSalida = 0;
         |LEE 001#1a;
     |SINO;
         |LEE 001#1u;
     |FINSI;
     |SI FSalida = 0; |Y #1#0 = #0#3;
         ultima = #1#1 + 1;
     |SINO;
         ultima = 1;
     |FINSI;
|FPRC;

|PROCESO ProfNormal1;
     |HAZ comun;
     |SI grabalo ! 0;
         |HAZ ProfNormal2;
     |FINSI;
|FPRC;

     *********************************************************************
     GRABACION DE PROFESIONALES EN COEFICIENTES
     *********************************************************************

|PROCESO ProfSimpli3;
     #2#30 = #2#21 + #2#22 + #2#23 + #2#24 + #2#25 + #2#26 + #2#27 + #2#28 + #2#29 - #2#20;
     #2#31 = #2#19 - #2#30;
     #2#32 = #2#31 % 5;      |SI #2#32 < 0;  #2#32 = 0;  |FINSI;
     #2#33 = #2#31 - #2#32;
     #2#36 = #2#34 - #2#35;
     #2#37 = #2#33 + #2#36;
|FPRC;

|PROCESO ProfSimpli2;
     |ABRE #2;
     |HAZ ultimo2;
     |DDEFECTO #2;
     #2#00 = #0#3;        || codigo
     #2#01 = ultima;      || linea
     #2#02 = tipo;        || tipo
     #2#03 = perc;        || perceptor
     #2#12 = #7#4;        || epigrafe -1-
     #2#13 = #7#5;        || epigrafe -2-
     #2#14 = #7#6;        || nombre actividad
     #2#15 = #7#9;        || Domicilio
     #2#16 = #7#11;       || Codigo Provincia
     #2#17 = #7#12;       || Codigo Poblacion
     #2#19 = campo19;
     #2#20 = #17#10;
     #2#21 = #17#3;
     #2#22 = campo22;
     #2#23 = campo23;
     #2#24 = campo24;
     #2#25 = campo25;
     #2#26 = campo26;
     #2#27 = campo27;
     #2#28 = campo28;
     #2#29 = campo29;

     |HAZ ProfSimpli3;          || CALCULA ...

     |GRABA 020#2n;
     |SI FSalida=0; npro=8; empresa=#0#3; |HAZ sigrabo; |FINSI;      || marca (*)
     |CIERRA #2;

     HContribu  = #2#0;
     HNombre    = Nombre;
     HPrograma  = "(rem00011) PROFESIONALES MOD.SIMPLIFICADA";
     HLinea     = #2#1;
     HPerceptor = #2#3;
     HRdto      = #2#37;
     HTipo      = "ALTA FICHA DESDE PASE REO";
     |HAZ AltaHistorico;
|FPRC;

|PROCESO ultimo2;
     #2#0 = #0#3;
     #2#1 = 99;
     |LEE 001#2];
     |SI FSalida = 0;
         |LEE 001#2a;
     |SINO;
         |LEE 001#2u;
     |FINSI;
     |SI FSalida = 0; |Y #2#0 = #0#3;
         ultima = #2#1 + 1;
     |SINO;
         ultima = 1;
     |FINSI;
|FPRC;

|PROCESO ProfSimpli1;
     |HAZ comun;
     |SI grabalo ! 0;  |HAZ ProfSimpli2;  |FINSI;
|FPRC;

     *********************************************************************
     GRABACION DE EMPRESARIALES EN ESTIMACION DIRECTA
     *********************************************************************

|PROCESO EmprNormal3;
     #3#23 = #3#19 + #3#20 + #3#21 + #3#22;
     #3#40 = #3#24 + #3#25 + #3#26 + #3#27 + #3#28 + #3#29 + #3#30 + #3#31;
     #3#40 = #3#40 + #3#32 + #3#33 + #3#34 + #3#35 + #3#36 + #3#37 + #3#38 + #3#39;
     #3#41 = #3#23 - #3#40;
     #3#44 = #3#42 - #3#43;
     #3#45 = #3#41 + #3#44;
|FPRC;

|PROCESO EmprNormal2;
     |ABRE #3;
     |HAZ ultimo3;
     |DDEFECTO #3;
     #3#00 = #0#3;        || codigo
     #3#01 = ultima;      || linea
     #3#02 = tipo;        || tipo
     #3#03 = perc;        || perceptor
     #3#12 = #7#4;        || epigrafe -1-
     #3#13 = #7#5;        || epigrafe -2-
     #3#14 = #7#6;        || nombre actividad
     #3#15 = #7#9;        || Domicilio
     #3#16 = #7#11;       || Codigo Provincia
     #3#17 = #7#12;       || Codigo Poblacion
     #3#19 = campo19;
     #3#20 = campo20;
     #3#21 = campo21;
     #3#22 = campo22;
     #3#23 = campo23;
     #3#24 = campo24;
     #3#25 = campo25;
     #3#26 = campo26;
     #3#27 = campo27;
     #3#28 = campo28;
     #3#29 = campo29;
     #3#30 = campo30;
     #3#31 = campo31;
     #3#32 = campo32;
     #3#33 = campo33;
     #3#34 = campo34;
     #3#35 = campo35;
     #3#36 = campo36;
     #3#37 = campo37;
     #3#38 = campo38;
     #3#39 = campo39;

    |HAZ EmprNormal3;
    |GRABA 020#3n;
    |SI FSalida=0; npro=9; empresa=#0#3; |HAZ sigrabo; |FINSI;      || marca (*)
    |CIERRA #3;

    HContribu  = #3#0;
    HNombre    = Nombre;
    HPrograma  = "(rem00012) EMPRESARIALES MOD.NORMAL";
    HLinea     = #3#1;
    HPerceptor = #3#3;
    HRdto      = #3#45;
    HTipo      = "ALTA FICHA DESDE PASE REO";
    |HAZ AltaHistorico;
|FPRC;

|PROCESO ultimo3;
     #3#0 = #0#3;
     #3#1 = 99;
     |LEE 001#3];
     |SI FSalida = 0;
         |LEE 001#3a;
     |SINO;
         |LEE 001#3u;
     |FINSI;
     |SI FSalida = 0; |Y #3#0 = #0#3;
         ultima = #3#1 + 1;
     |SINO;
         ultima = 1;
     |FINSI;
|FPRC;

|PROCESO EmprNormal1;
     |HAZ comun;
     |SI grabalo ! 0;   |HAZ EmprNormal2;   |FINSI;
|FPRC;

     *********************************************************************
     GRABACION DE EMPRESARIALES EN COEFICIENTES
     *********************************************************************

|PROCESO EmprSimpli3;
     #4#23 = #4#19 + #4#20 + #4#21 + #4#22;
     #4#39 = #4#25 + #4#26 + #4#27 + #4#28 + #4#29 + #4#30 + #4#31 + #4#32;
     #4#39 = #4#39 + #4#33 + #4#34 + #4#35 + #4#36 + #4#37 + #4#38 - #4#24;
     #4#40 = #4#23 - #4#39;
     #4#41 = #4#40 % 5;      |SI #4#41 < 0;  #4#41 = 0;  |FINSI;
     #4#42 = #4#40 - #4#41;
     #4#45 = #4#43 - #4#44;
     #4#46 = #4#42 + #4#45;
|FPRC;

|PROCESO EmprSimpli2;
     |ABRE #4;
     |HAZ ultimo4;
     |DDEFECTO #4;
     #4#00 = #0#3;        || codigo
     #4#01 = ultima;      || linea
     #4#02 = tipo;        || tipo
     #4#03 = perc;        || perceptor
     #4#12 = #7#4;        || epigrafe -1-
     #4#13 = #7#5;        || epigrafe -2-
     #4#14 = #7#6;        || nombre actividad
     #4#15 = #7#9;        || Domicilio
     #4#16 = #7#11;       || Codigo Provincia
     #4#17 = #7#12;       || Codigo Poblacion
     #4#19 = campo19;
     #4#20 = campo20;
     #4#21 = campo21;
     #4#22 = campo22;
     #4#24 = #17#10;
     #4#25 = #17#3;
     #4#26 = campo26;
     #4#27 = campo27;
     #4#28 = campo28;
     #4#29 = campo29;
     #4#30 = campo30;
     #4#31 = campo31;
     #4#32 = campo32;
     #4#33 = campo33;
     #4#34 = campo34;
     #4#35 = campo35;
     #4#36 = campo36;
     #4#37 = campo37;
     #4#38 = campo38;

     |HAZ EmprSimpli3;          || CALCULA ...
     |GRABA 020#4n;
     |SI FSalida=0; npro=10; empresa=#0#3; |HAZ sigrabo; |FINSI;      || marca (*)
     |CIERRA #4;

     HContribu  = #4#0;
     HNombre    = Nombre;
     HPrograma  = "(rem00013) EMPRESARIALES MOD.SIMPLIFICADA";
     HLinea     = #4#1;
     HPerceptor = #4#3;
     HRdto      = #4#46;
     HTipo      = "ALTA FICHA DESDE PASE REO";
     |HAZ AltaHistorico;
|FPRC;

|PROCESO ultimo4;
     #4#0 = #0#3;
     #4#1 = 99;
     |LEE 001#4];
     |SI FSalida = 0;
         |LEE 001#4a;
     |SINO;
         |LEE 001#4u;
     |FINSI;
     |SI FSalida = 0; |Y #4#0 = #0#3;
         ultima = #4#1 + 1;
     |SINO;
         ultima = 1;
    |FINSI;
|FPRC;

|PROCESO EmprSimpli1;
     |HAZ comun;
     |SI grabalo ! 0;   |HAZ EmprSimpli2;  |FINSI;
|FPRC;

     *********************************************************************
     GRABACION DE LOS AGRICOLAS
     *********************************************************************

|PROCESO GrabaLinea;
     grabalo = 1;

     |LIBERA #41;
     |LEE 140#41=;
     |SI FSalida = 0;
         #40#18 = #40#18 - #41#6;
         |SI #41#8 = "N";
             #40#19 = #40#19 - #41#7;
             #40#44 = #40#44 - #41#11;
         |SINO;
             #40#20 = #40#20 - #41#7;
             #40#45 = #40#45 - #41#11;
         |FINSI;

         #41#6  = #41#6 + Total;
         #41#7  = #41#6 * #41#5;
         #41#11 = #41#6 * #41#10;

         |GRABA 140#41a;
     |SINO;
         #41#3  = nCProducto;
         #41#4  = nLProducto;
         #41#5  = nCoefi98;
         #41#6  = Total;
         #41#8  = #41#7 * #41#9;
         #41#9  = nCodInter;
         #41#7  = #41#6 * #41#5;
         #41#8  = "N";
         #41#10 = nCoefi97;
         #41#11 = #41#6 * #41#10;
         |GRABA 140#41n;
     |FINSI;

     #40#18 = #40#18 + #41#6;
     |SI #41#8 = "N";
         #40#19 = #40#19 + #41#7;
         #40#44 = #40#44 + #41#11;
     |SINO;
         #40#20 = #40#20 + #41#7;
         #40#45 = #40#45 + #41#11;
     |FINSI;
|FPRC;

|PROCESO LeeConce;
     |SI Bas = 0; |Y _Iv = 0; |Y Rec = 0; |Y Ret = 0; |ACABA; |FINSI;

     |SI nTipoCon = 1;
         #28#0 = aConcepto;
         |LEE 040#28=;
         |SI FSalida ! 0;    |ACABA;  |FINSI;
     |SINO;
         #31#0 = aConcepto;
         |LEE 040#31=;
         |SI FSalida ! 0;    |ACABA;  |FINSI;
     |FINSI;

     RCatastral = "";
     |SI EsArrend = 1;
         |SI nTipoCon = 1;
             |SI #28#9 = 1; _Ingresos = _Ingresos + Bas;               |FINSI;
             |SI #28#9 = 2; _Ingresos = _Ingresos + (Bas + _Iv + Rec); |FINSI;
         |SINO;
             |SI #31#9 = 1; _Ingresos = _Ingresos + Bas;               |FINSI;
             |SI #31#9 = 2; _Ingresos = _Ingresos + (Bas + _Iv + Rec); |FINSI;
         |FINSI;

         |ABRE #30;
         #30#0 = #12#0;
         #30#1 = #12#14;
         #30#2 = LineaB;
         #30#3 = #12#1;
         |LEE 040#30=;
         |SI FSalida = 0;
             |ABRE #29;
             #29#0 = #30#0;
             #29#1 = #30#4;
             |LEE 040#29=;
             |SI FSalida ! 0;  |DDEFECTO #29;  |FINSI;
             |CIERRA #29;
             RCatastral = #29#5;
         |FINSI;
         |CIERRA #30;
         |ACABA;
     |FINSI;

     |SI nTipoCon = 1;
         |SI #28#3   ! "I";  |ACABA;  |FINSI;
     |SINO;
         |SI #31#3   ! "I";  |ACABA;  |FINSI;
     |FINSI;

     #27#0 = aConcepto;
     |LEE 040#27=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI nTipoCon = 1;
         |SI #28#9 = 1; Total  = Bas;             |FINSI;
         |SI #28#9 = 2; Total  = Bas + _Iv + Rec; |FINSI;
     |SINO;
         |SI #31#9 = 1; Total  = Bas;             |FINSI;
         |SI #31#9 = 2; Total  = Bas + _Iv + Rec; |FINSI;
     |FINSI;

     Retencion = Retencion + Ret;

     |DDEFECTO #41; || PEPE
     |SI #27#7 = .13;
         #41#0      = #40#0;
         #41#1      = #40#1;
         #41#2      = 1;
         nCProducto = 1;
         nLProducto = 3;
         nCoefi98   = .13;
         nCoefi97   = .12;
         nCodInter  = 1;
         |HAZ GrabaLinea;
     |FINSI;

     |SI #27#7 = .26;
         #41#0      = #40#0;
         #41#1      = #40#1;
         #41#2      = 3;
         nCProducto = 3;
         nLProducto = 1;
         nCoefi98   = .26;
         nCoefi97   = .24;
         |HAZ GrabaLinea;
         nCodInter  = 3;
     |FINSI;


     |SI #27#7 = .32;
         #41#0      = #40#0;
         #41#1      = #40#1;
         #41#2      = 6;
         nCProducto = 6;
         nLProducto = 1;
         nCoefi98   = .32;
         nCoefi97   = .30;
         nCodInter  = 7;
         |HAZ GrabaLinea;
     |FINSI;

     |SI #27#7 = .37;
         #41#0      = #40#0;
         #41#1      = #40#1;
         #41#2      = 8;
         nCProducto = 8;
         nLProducto = 1;
         nCoefi98   = .37;
         nCoefi97   = .35;
         nCodInter  = 10;
         |HAZ GrabaLinea;
     |FINSI;

     |SI #27#7 = .42;
         #41#0      = #40#0;
         #41#1      = #40#1;
         #41#2      = 10;
         nCProducto = 10;
         nLProducto = 1;
         nCoefi98   = .42;
         nCoefi97   = .40;
         nCodInter  = 13;
         |HAZ GrabaLinea;
     |FINSI;

     |SI #27#7 = .56;
         #41#0      = #40#0;
         #41#1      = #40#1;
         #41#2      = 13;
         nCProducto = 13;
         nLProducto = 1;
         nCoefi98   = .56;
         nCoefi97   = .55;
         nCodInter  = 17;
         |HAZ GrabaLinea;
     |FINSI;
|FPRC;

|PROCESO PonCoef;
     |SI nTipoCon = 1;
         aConcepto = #12#5;  Bas = #12#07; _Iv = #12#09; Rec = #12#11; Ret = #12#42; LineaB = 1; |HAZ LeeConce;
         aConcepto = #12#33; Bas = #12#23; _Iv = #12#27; Rec = #12#31; Ret = #12#43; LineaB = 2; |HAZ LeeConce;
         aConcepto = #12#34; Bas = #12#24; _Iv = #12#28; Rec = #12#32; Ret = #12#44; LineaB = 3; |HAZ LeeConce;
         aConcepto = #12#60; Bas = #12#45; _Iv = #12#51; Rec = #12#57; Ret = #12#69; LineaB = 4; |HAZ LeeConce;
         aConcepto = #12#61; Bas = #12#46; _Iv = #12#52; Rec = #12#58; Ret = #12#70; LineaB = 5; |HAZ LeeConce;
         aConcepto = #12#62; Bas = #12#47; _Iv = #12#53; Rec = #12#59; Ret = #12#71; LineaB = 6; |HAZ LeeConce;
     |SINO;
         aConcepto = #12#72; Bas = #12#07; _Iv = #12#09; Rec = #12#11; Ret = #12#42; LineaB = 1; |HAZ LeeConce;
         aConcepto = #12#73; Bas = #12#23; _Iv = #12#27; Rec = #12#31; Ret = #12#43; LineaB = 2; |HAZ LeeConce;
         aConcepto = #12#74; Bas = #12#24; _Iv = #12#28; Rec = #12#32; Ret = #12#44; LineaB = 3; |HAZ LeeConce;
         aConcepto = #12#75; Bas = #12#45; _Iv = #12#51; Rec = #12#57; Ret = #12#69; LineaB = 4; |HAZ LeeConce;
         aConcepto = #12#76; Bas = #12#46; _Iv = #12#52; Rec = #12#58; Ret = #12#70; LineaB = 5; |HAZ LeeConce;
         aConcepto = #12#77; Bas = #12#47; _Iv = #12#53; Rec = #12#59; Ret = #12#71; LineaB = 6; |HAZ LeeConce;
     |FINSI;
|FPRC;

|DEFBUCLE eoslinve;
     #12#1;
     19;
     #0#1, 98,    0, #0#2;
     #0#1, 98, 9999, #0#2;
     e;
     NULL, PonCoef;
|FIN;

|PROCESO LeeConceC;
     |SI Bas = 0; |Y _Iv = 0; |Y Rec = 0; |ACABA; |FINSI;

     |SI nTipoCon = 1;
         #43#0 = aConcepto;
         |LEE 040#43=;
         |SI FSalida ! 0;  |ACABA; |FINSI;

         #28#0 = aConcepto;
         |LEE 040#28=;
         |SI FSalida ! 0;    |ACABA;  |FINSI;
     |SINO;
         #44#0 = aConcepto;
         |LEE 040#44=;
         |SI FSalida ! 0;  |ACABA; |FINSI;

         #31#0 = aConcepto;
         |LEE 040#31=;
         |SI FSalida ! 0;    |ACABA;  |FINSI;
     |FINSI;

     Total = 0;
     |SI nTipoCon = 1;
         |SI #28#9 = 1; Total = Bas;                   |FINSI;
         |SI #28#9 = 2; Total = Bas + _Iv + Rec;       |FINSI;
     |SINO;
         |SI #31#9 = 1; Total = Bas;                   |FINSI;
         |SI #31#9 = 2; Total = Bas + _Iv + Rec;       |FINSI;
     |FINSI;

     |SI #43#3 = 1;  Campo01 = Campo01 + Total;    |FINSI;
     |SI #43#3 = 2;  Campo02 = Campo02 + Total;    |FINSI;
     |SI #43#3 = 3;  Campo03 = Campo03 + Total;    |FINSI;
     |SI #43#3 = 4;  Campo04 = Campo04 + Total;    |FINSI;
     |SI #43#3 = 5;  Campo05 = Campo05 + Total;    |FINSI;
|FPRC;

|PROCESO PonArrend;
     |SI nTipoCon = 1;
         aConcepto = #14#5;  Bas = #14#07; _Iv = #14#09; Rec = #14#11; |HAZ LeeConceC;
         aConcepto = #14#33; Bas = #14#23; _Iv = #14#27; Rec = #14#31; |HAZ LeeConceC;
         aConcepto = #14#34; Bas = #14#24; _Iv = #14#28; Rec = #14#32; |HAZ LeeConceC;
     |SINO;
         aConcepto = #14#72;  Bas = #14#07; _Iv = #14#09; Rec = #14#11; |HAZ LeeConceC;
         aConcepto = #14#73;  Bas = #14#23; _Iv = #14#27; Rec = #14#31; |HAZ LeeConceC;
         aConcepto = #14#74;  Bas = #14#24; _Iv = #14#28; Rec = #14#32; |HAZ LeeConceC;
     |FINSI;
|FPRC;

|DEFBUCLE eoslinco;
     #14#1;
     19;
     #0#1, 98,    0, #0#2;
     #0#1, 98, 9999, #0#2;
     e;
     NULL, PonArrend;
|FIN;

|PROCESO PonLineas;
     |ABRE #27;
     |ABRE #28;
     |ABRE #31;
     |ABRE #41;
     |HAZ re_ventas;
     |BUCLE eoslinve;
     |CIERRA #27;
     |CIERRA #28;
     |CIERRA #31;
     |CIERRA #41;
|FPRC;

|PROCESO CalcuAgri;
     #40#21 = #40#19 + #40#20;
     #40#23 = #40#21 - #40#22;

     nCanti1 = #40#44;
     |SI #40#24 ! 0;  nCanti1 = nCanti1 * #40#24;  |FINSI;
     |SI #40#25 ! 0;  nCanti1 = nCanti1 * #40#25;  |FINSI;
     |SI #40#27 ! 0;  nCanti1 = nCanti1 * #40#27;  |FINSI;

     nCanti2 = #40#45;
     |SI #40#24 ! 0;  nCanti2 = nCanti2 * #40#24;  |FINSI;
     |SI #40#25 ! 0;  nCanti2 = nCanti2 * #40#25;  |FINSI;
     |SI #40#26 ! 0;  nCanti2 = nCanti2 * #40#26;  |FINSI;
     |SI #40#27 ! 0;  nCanti2 = nCanti2 * #40#27;  |FINSI;

     nRdto97 = (nCanti1 + nCanti2) * 1.05;

     nCanti1 = #40#19 - #40#46;
     |SI #40#24 ! 0;  nCanti1 = nCanti1 * #40#24;  |FINSI;
     |SI #40#25 ! 0;  nCanti1 = nCanti1 * #40#25;  |FINSI;
     |SI #40#27 ! 0;  nCanti1 = nCanti1 * #40#27;  |FINSI;
     |SI #40#28 ! 0;  nCanti1 = nCanti1 * #40#28;  |FINSI;

     nCanti2 = #40#20 - #40#47;
     |SI #40#24 ! 0;  nCanti2 = nCanti2 * #40#24;  |FINSI;
     |SI #40#25 ! 0;  nCanti2 = nCanti2 * #40#25;  |FINSI;
     |SI #40#26 ! 0;  nCanti2 = nCanti2 * #40#26;  |FINSI;
     |SI #40#27 ! 0;  nCanti2 = nCanti2 * #40#27;  |FINSI;
     |SI #40#28 ! 0;  nCanti2 = nCanti2 * #40#28;  |FINSI;

     #40#29 = nCanti1 + nCanti2;

     #40#31 = #40#29;
     |SI nRdto97 < #40#31;  |Y nRdto97 ! 0;
         #40#31 = nRdto97;
     |FINSI;
     #40#30 = #40#29 - #40#31;

     #40#34 = #40#31 + #40#32 - #40#33;
     |SI #40#34 < 0;  #40#34 = 0;  |FINSI;

     nCanti1 = #40#34 % #40#35;
     nCanti2 = #40#34 % #40#36;
     #40#37 = #40#34 - nCanti1 - nCanti2;
     |SI #40#37 < 0;  #40#37 = 0;  |FINSI;

     #40#40 = #40#37 + #40#38 - #40#39;
|FPRC;

|PROCESO GrabaRetencion;
     #25#0 = #0#3;
     #25#1 = linea_p;
     |LIBERA #25;
     |LEE 140#25=;
     FEstado = FSalida;
     |SI FEstado ! 0; |DDEFECTO #25; |FINSI;

     #25#0  = #0#3;
     #25#1  = linea_p;
     #25#2  = #0#4;
     #25#3  = perc;
     #25#4  = 0;
     #25#10 = Retencion;

     |SI FEstado = 0; |GRABA 140#25a; |SINO; |GRABA 140#25n; |FINSI;

     npro = 51;  empresa = #0#3;  |HAZ sigrabo;
     HContribu  = #25#0;
     HNombre    = Nombre;
     HPrograma  = "(repagret) RETENCIONES Y PAGOS A CUENTA";
     HLinea     = #25#1;
     HPerceptor = #25#3;
     HRdto      = #25#5 + #25#6 + #25#7 + #25#8;
     HTipo      = "ALTA FICHA DESDE PASE REO";
     |HAZ AltaHistorico;
|FPRC;

|PROCESO Agricolas;
     |ABRE #40;
     |HAZ ultimo40;
     |DDEFECTO #40;
     #40#00 = #0#3;        || codigo
     #40#01 = ultima;      || linea
     #40#02 = tipo;        || tipo
     #40#03 = perc;        || perceptor
     #40#12 = #7#4;        || epigrafe -1-
     #40#13 = #7#5;        || epigrafe -2-
     #40#14 = #7#6;        || nombre actividad
     #40#15 = #7#9;        || domicilio

     |HAZ PonLineas;

     |SI grabalo = 0;  |CIERRA #40;  |ACABA;  |FINSI;

     |HAZ CalcuAgri;
     |GRABA 020#40n;
     |SI FSalida=0; npro=52; empresa=#0#3; |HAZ sigrabo; |FINSI;      || marca (*)
     |CIERRA #40;

     HContribu  = #40#0;
     HNombre    = Nombre;
     HPrograma  = "(rem00014) AGRICOLAS Y GANADERAS";
     HLinea     = #40#1;
     HPerceptor = #40#3;
     HRdto      = #40#34;
     HTipo      = "ALTA FICHA DESDE PASE REO";
     |HAZ AltaHistorico;

     |SI Retencion = 0; |ACABA; |FINSI;

     linea_p = 0;
     LoHago  = 0; |BUCLE repagret;
     |SI LoHago = 0;  linea_p = linea_p + 1;  |FINSI;

     |ABRE #25;
     |HAZ GrabaRetencion;
     |CIERRA #25;
|FPRC;

|PROCESO ultimo40;
     #40#0 = #0#3;
     #40#1 = 99;
     |LEE 001#40];
     |SI FSalida = 0;
         |LEE 001#40a;
     |SINO;
         |LEE 001#40u;
     |FINSI;
     |SI FSalida = 0; |Y #40#0 = #0#3;
         ultima = #40#1 + 1;
     |SINO;
         ultima = 1;
     |FINSI;
|FPRC;

|PROCESO Arrendamientos;
     |ABRE #27;
     |ABRE #28;
     |ABRE #31;
     |ABRE #43;
     |ABRE #44;
     |ABRE #42;
     #42#00 = #0#3;        || codigo
     #42#01 = LineaArre;   || linea
     |BORRA 140#42c;
     |LIBERA #42;

     |HAZ re_ventas;    |BUCLE eoslinve;
     |HAZ re_compras;   |BUCLE eoslinco;

     |DDEFECTO #42;
     grabalo = 1;
     #42#00 = #0#3;        || codigo
     #42#01 = LineaArre;   || linea
     #42#02 = tipo;        || tipo
     #42#03 = perc;        || perceptor
     #42#4  = "U";         || Rustico o Urbano
     #42#5  = "ARRENDAMIENTOS";
     #42#13 = "O";
     #42#21 = "S";
     #42#22 = "N";
     #42#23 = _Ingresos;
     #42#26 = Campo02;
     #42#27 = Campo05;
     #42#28 = Campo01;
     #42#29 = Campo03;
     #42#30 = Campo04;
     #42#47 = #42#23 - (#42#26 + #42#27 + #42#28 + #42#29 + #42#30);
     #42#72 = RCatastral;
     |GRABA 020#42n;
     |SI FSalida=0; npro=2; empresa=#0#3; |HAZ sigrabo; |FINSI;      || marca (*)
     |CIERRA #42;
     |CIERRA #43;
     |CIERRA #44;
     |CIERRA #27;
     |CIERRA #28;
     |CIERRA #31;

     HContribu  = #42#0;
     HNombre    = Nombre;
     HPrograma  = "(recapinm) CAPITAL INMOBILIARIO";
     HLinea     = #42#1;
     HPerceptor = #42#3;
     HRdto      = #42#47;
     HTipo      = "ALTA FICHA DESDE PASE REO";
     |HAZ AltaHistorico;
|FPRC;

     *********************************************************************
     LLAMADAS DESDE CAMPOS
     *********************************************************************

|PROCESO que_matriz;
     campo_e  = #16#0;
     campo_a  = #16#1;
|FPRC;

|DEFBUCLE eoscomul_2;
     #16#2;
     ;
     #0#5, #0#6, 98;
     #0#5, #0#6, 98;
     e;
     NULL, que_matriz;
|FIN;

|PROCESO tipo_3; |TIPO 3;
     |SI #0#0 = "SI";
         |HAZ path;      || (por si acaso se le olvidan)
         |HAZ captura1;
         |SI grabalo = 0;
             |MENAV "    ATENCION!!! Empresa/Actividad sin Libros ni 130 ...";
         |FINSI;
     |FINSI;
|FPRC;

|PROGRAMA;
     |HAZ que_version;

     |ABRE #43;
     |LEE 040#43p;
     |SI FSalida ! 0;
         |CIERRA #43;
         |DFICE aPath;   |QBT aPath;
         aPathO = aPath + "recontdt.dat";
         aPathD = aPath + "rem00502.dat";
         |COPIA_FICHERO aPathO, aPathD;
     |SINO;
         |CIERRA #43;
     |FINSI;

     |ABRE #13;
     |LEE 040#13p;
     |SI FSalida ! 0;
         |MENAV "      No existe Planilla Pase Libro.";
         |CIERRA #13;
         |ACABA;
     |FINSI;
     |CIERRA #13;

     |HAZ path;

     |SI empre_r = 0;
         |CLS;
         |CABEZA "Captura R.E.O.";
         |DDEFECTO #0;
         |PINPA #0#0;
         |PINDA #0#0;
         |ENDATOS #1#0;
         |SI FSalida = 0; |HAZ tipo_3; |FINSI;
    |SINO;
         |ABRE #7;
         #7#0 = empre_e;
         #7#1 = activ_e;
         #7#2 = 98;
         |LEE 001#7=;
         |SI FSalida ! 0; |CIERRA #7; |ACABA; |FINSI;
         |CIERRA #7;

         #0#0 = "SI";
         #0#1 = empre_e;
         #0#2 = activ_e;
         #0#3 = empre_r;
         #0#4 = tipo_e;
         #0#5 = 0;
         #0#6 = 0;
         |PINPA #0#0;
         |PINDA #0#0;

         |ABRE #11;
         #11#0 = #0#3;
         |LEE 040#11=;
         |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
         |CIERRA #11;
         Nombre = #11#1;

         |SI #7#46 = "S";
             |PUSHV 2017  2366;
             |CUADRO 2017 2366;
             |ATRI R;
             |PINTA 2118, "  La Actividad es una Comunidad de Bienes intro-";
             |PINTA 2218, "duzca en la ficha general el codigo del comunero";
             |ATRI 0;
             |PAUSA;
             |POPV;
             |ACABA;
         |FINSI;

         |SI #7#14 = "S";
             #0#5    = #7#0;
             #0#6    = #7#1;
             campo_e = 0;
             campo_a = 0;
             |BUCLE eoscomul_2;
             #0#1    = campo_e;
             #0#2    = campo_a;
         |FINSI;

         |HAZ lee_eos1;
         |HAZ lee_eos2;
         |HAZ lee_renta1;
         |HAZ lee_renta2;
         |HAZ mira_comu;
         |PINDA #0#0;
         |HAZ tipo_3;
    |FINSI;
|FPRO;
