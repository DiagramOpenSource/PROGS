|FICHEROS;
   rez00050 #0;
   redatcon #1;
   recapinm #3;
   reliquid #4;
   reacceso #5;
   reremesa #10;
   rew00004 #99,MANTE;
   rew00009 #900;
|FIN;

|VARIABLES;
   FSestado    = 0;
   VarCampo    = 0;
   VarTraba    = 0;
   VarImpor    = 0;
   VarRenum    = 0;
   VarFraci    = 0;
   VarImpre    = 0;
   VarCuent    = 0;
   VarImpor1   = 0;
   VarImpor2   = 0;
   VarImpor3   = 0;
   VarImpor4   = 0;
   VarAlfa1    = "";
   VarAlfa2    = "";
   VarAlfa3    = "";
   VarAlfa4    = "";
   VarAlfa5    = "";
   VarTipo     = 0;
   Refer       = 0;
   Coefi       = 0;
   Tempo       = "";
   Valfa       = "";

    &Temporal = "";
    &Cliente01 = 0;
    &Cliente02 = 0;
    &Cliente03 = 0;
    &Cliente04 = 0;
    &Cliente05 = 0;
    &Cliente06 = 0;
    &Cliente07 = 0;
    &Cliente08 = 0;
    &Cliente09 = 0;
    &Cliente10 = 0;
    &Cliente11 = 0;
    &Cliente12 = 0;
    &Cliente13 = 0;
    &Cliente14 = 0;
    &Cliente15 = 0;
    &Cliente16 = 0;
    &Cliente17 = 0;
    &Cliente18 = 0;
|FIN;

|INCLUYE i_ficher;

|PROGRAMA;
  |CLS;
  |CABEZA "Adjudicacion de Remesas";

  |PARA; |SI FSestado = 0; |HACIENDO;
         |PINPA #0#0;
         |PINDA #0#0;
         |ENDATOS #1#0;

         |C_M #0#0, 1, "N"; |C_M #0#2, 1, "N";

         FSestado = FSalida;
         |SI FSalida = 0; |HAZ CargaIndex; |FINSI;
  |SIGUE;
|FPRO;

|PROCESO LeeLiqui;
  |ABRE #1;
  #1#0 = #0#3;
  |LEE 040#1=;
  |SI FSalida ! 0; |DDEFECTO #1; |FINSI;
  |CIERRA #1;

  |ABRE #4;
  #4#0 = #1#0;
  |LEE 040#4=;
  |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
  |CIERRA #4;

  |DDEFECTO #5;
  |ABRE #5;
  #5#0 = #1#0;
  |LEE 0401#5=;
  |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
  |CIERRA #5;
|FPRC;

|PROCESO MiraOtro;
  #99#7 = "N";
  #99#8 = "APUNTE YA REMESADO : " + #10#0 + " " + #10#1;
  #99#9 = 1;
|FPRC;

|DEFBUCLE reremesa;
  #10#1;
  ;
  "    ", "01.01.1900", #0#3, #99#1, #99#4;
  "zzzz", "31.12.2999", #0#3, #99#1, #99#4;
  ;
  NULL, MiraOtro;
|FIN;

|PROCESO ImporRenta;
  Refer = Refer + 1;
  |DDEFECTO #99;

  #99#0  = Refer;
  #99#7  = "S";
  #99#10 = #1VarCuent;

  |SI VarCampo = 103;
      #99#1 = "C";
      #99#2 = "CONJUNTA";
      #99#3 = #1#1;
  |FINSI;

  |SI VarCampo = 104;
      #99#1 = "T";
      #99#2 = "TITULAR ";
      #99#3 = #1#1;
  |FINSI;

  |SI VarCampo = 105;
      #99#1 = "C";
      #99#2 = "CONYUGE ";
      #99#3 = #1#28;
  |FINSI;

  |SI VarCampo = 106;
      #99#1 = "1";
      #99#2 = "1§.FAMI.";
      VarTraba = #1#98 + 57; #99#3 = #1VarTraba;
  |FINSI;

  |SI VarCampo = 107;
      #99#1 = "2";
      #99#2 = "2§.FAMI.";
      VarTraba = #1#99 + 57; #99#3 = #1VarTraba;
  |FINSI;

  |SI VarCampo = 108;
      #99#1 = "3";
      #99#2 = "3§.FAMI.";
      VarTraba = #1#100 + 57; #99#3 = #1VarTraba;
  |FINSI;

  |SI VarCampo = 109;
      #99#1 = "4";
      #99#2 = "4§.FAMI.";
      VarTraba = #1#101 + 57; #99#3 = #1VarTraba;
  |FINSI;

  |SI Coefi = 100;
      #99#4    = 1;
      |SI #4VarImpor > 0;
          #99#5   = "RENTA POSITIVA (NO FRACCIONA EL PAGO) ";
          #99#6   = #4VarImpor;
      |FINSI;

      |SI #4VarImpor < 0;
          #99#7 = "N";
          |SI #4VarRenum ! "S";
              #99#5 = "RENTA NEGATIVA : NO RENUNCIA ";
          |SINO;
              #99#5 = "RENTA NEGATIVA : SI RENUNCIA";
          |FINSI;
          #99#6   = #4VarImpor;
      |FINSI;
  |FINSI;

  |SI Coefi = 60;
      #99#4 = 1;
      |SI #4VarFraci = "S";
          #99#5 = "RENTA POSITIVA (1§ PAGO, SIN DOMICILIAR)";
      |SINO;
          #99#5 = "RENTA POSITIVA (1§ PAGO, DOMICILIADO)";
      |FINSI;

      #99#6 = #4VarImpor % Coefi;
  |FINSI;

  |SI Coefi = 40;
      #99#4 = 2;
      |SI #4VarFraci = "S";
          #99#5 = "RENTA POSITIVA (2§ PAGO, SIN DOMICILIAR)";
      |SINO;
          #99#5 = "RENTA POSITIVA (2§ PAGO, DOMICILIADO)";
      |FINSI;
      #99#6 = #4VarImpor % Coefi;
  |FINSI;

  |BUCLE reremesa;

  |SI #1VarImpre ! "S"; |Y #99#9 = 0;
      #99#7 = "N";
      #99#8 = "RENTA NO IMPRESA";
      #99#9 = 1;
  |FINSI;

  |GRABA 040#99n;
|FPRC;

|PROCESO ImporPatri;
Refer = Refer + 1;
|DDEFECTO #99;

#99#0 = Refer;
#99#7 = "S";

|SI VarCampo = 140;
    #99#1 = "T";
    #99#2 = "TITULAR ";
    #99#3 = #1#1;
|FINSI;

|SI VarCampo = 141;
    #99#1 = "C";
    #99#2 = "CONYUGE ";
    #99#3 = #1#28;
|FINSI;

|SI VarCampo = 194;
    #99#1 = "1";
    #99#2 = "1§.FAMI.";
    VarTraba = #1#98 + 57; #99#3 = #1VarTraba;
|FINSI;

|SI VarCampo = 195;
    #99#1 = "2";
    #99#2 = "2§.FAMI.";
    VarTraba = #1#99 + 57; #99#3 = #1VarTraba;
|FINSI;

|SI VarCampo = 196;
    #99#1 = "3";
    #99#2 = "3§.FAMI.";
    VarTraba = #1#100 + 57; #99#3 = #1VarTraba;
|FINSI;

|SI VarCampo = 197;
    #99#1 = "4";
    #99#2 = "4§.FAMI.";
    VarTraba = #1#101 + 57; #99#3 = #1VarTraba;
|FINSI;

#99#4 = 3;
#99#5 = "PATRIMONIO ";
#99#6   = #4VarImpor;

|BUCLE reremesa;

|SI #1VarImpre ! "S"; |Y #99#9 = 0;
    #99#7 = "N";
    #99#8 = "PATRIMONIO NO IMPRESO ";
    #99#9 = 1;
|FINSI;

|GRABA 040#99n;
|FPRC;

|PROCESO CargaSpanis;
|SI #1#103 ! " ";
    VarCampo  = 103;
    VarImpor  = 8;
    VarImpre  = 124;
    VarFraci  = 15;
    VarRenum  = 22;
    VarCuent  = 174;
    |SI #4VarFraci ! "N"; |Y #4VarImpor > 0;
        Coefi = 60;  |HAZ ImporRenta;
        Coefi = 40;  |HAZ ImporRenta;
    |SINO;
        Coefi = 100; |HAZ ImporRenta;
    |FINSI;
|FINSI;

|SI #1#104 ! " ";
    VarCampo  = 104;
    VarImpor  = 9;
    VarImpre  = 125;
    VarFraci  = 16;
    VarRenum  = 23;
    VarCuent  = 175;
    |SI #4VarFraci ! "N"; |Y #4VarImpor > 0;
        Coefi = 60;  |HAZ ImporRenta;
        Coefi = 40;  |HAZ ImporRenta;
    |SINO;
        Coefi = 100; |HAZ ImporRenta;
    |FINSI;
|FINSI;

|SI #1#105 ! " ";
    VarCampo  = 105;
    VarImpor  = 10;
    VarImpre  = 126;
    VarFraci  = 17;
    VarRenum  = 24;
    VarCuent  = 176;
    |SI #4VarFraci ! "N"; |Y #4VarImpor > 0;
        Coefi = 60;  |HAZ ImporRenta;
        Coefi = 40;  |HAZ ImporRenta;
    |SINO;
        Coefi = 100; |HAZ ImporRenta;
    |FINSI;
|FINSI;

|SI #1#106 ! " ";
    VarCampo  = 106;
    VarImpor  = 11;
    VarImpre  = 127;
    VarFraci  = 18;
    VarRenum  = 25;
    VarCuent  = 177;
    |SI #4VarFraci ! "N"; |Y #4VarImpor > 0;
        Coefi = 60;  |HAZ ImporRenta;
        Coefi = 40;  |HAZ ImporRenta;
    |SINO;
        Coefi = 100; |HAZ ImporRenta;
    |FINSI;
|FINSI;

|SI #1#107 ! " ";
    VarCampo  = 107;
    VarImpor  = 12;
    VarImpre  = 128;
    VarFraci  = 19;
    VarRenum  = 26;
    VarCuent  = 178;
    |SI #4VarFraci ! "N"; |Y #4VarImpor > 0;
        Coefi = 60;  |HAZ ImporRenta;
        Coefi = 40;  |HAZ ImporRenta;
    |SINO;
        Coefi = 100; |HAZ ImporRenta;
    |FINSI;
|FINSI;

|SI #1#108 ! " ";
    VarCampo  = 108;
    VarImpor  = 13;
    VarImpre  = 129;
    VarFraci  = 20;
    VarRenum  = 27;
    VarCuent  = 179;
    |SI #4VarFraci ! "N"; |Y #4VarImpor > 0;
        Coefi = 60;  |HAZ ImporRenta;
        Coefi = 40;  |HAZ ImporRenta;
    |SINO;
        Coefi = 100; |HAZ ImporRenta;
    |FINSI;
|FINSI;

|SI #1#109 ! " ";
    VarCampo  = 109;
    VarImpor  = 14;
    VarImpre  = 130;
    VarFraci  = 21;
    VarRenum  = 28;
    VarCuent  = 180;
    |SI #4VarFraci ! "N"; |Y #4VarImpor > 0;
        Coefi = 60;  |HAZ ImporRenta;
        Coefi = 40;  |HAZ ImporRenta;
    |SINO;
        Coefi = 100; |HAZ ImporRenta;
    |FINSI;
|FINSI;

|SI #1#140 = "S";
    VarCampo  = 140;
    VarImpre  = 138;
    VarImpor  = 35;
    VarCuent  = 175;
    |HAZ ImporPatri;
|FINSI;

|SI #1#141 = "S";
    VarCampo  = 141;
    VarImpre  = 139;
    VarImpor  = 36;
    VarCuent  = 176;
    |HAZ ImporPatri;
|FINSI;

|SI #1#194 = "S";
    VarCampo  = 194;
    VarImpre  = 198;
    VarImpor  = 37;
    VarCuent  = 177;
    |HAZ ImporPatri;
|FINSI;

|SI #1#195 = "S";
    VarCampo  = 195;
    VarImpre  = 199;
    VarImpor  = 38;
    VarCuent  = 178;
    |HAZ ImporPatri;
|FINSI;

|SI #1#196 = "S";
    VarCampo  = 196;
    VarImpre  = 200;
    VarImpor  = 39;
    VarCuent  = 179;
    |HAZ ImporPatri;
|FINSI;

|SI #1#197 = "S";
    VarCampo  = 197;
    VarImpre  = 201;
    VarImpor  = 40;
    VarCuent  = 180;
    |HAZ ImporPatri;
|FINSI;
|FPRC;

|PROCESO ImporExtra;
  Refer = Refer + 1;

  |DDEFECTO #99;
  #99#0 = Refer;
  #99#1 = VarAlfa1;
  #99#2 = VarAlfa2;
  #99#3 = VarAlfa4;
  #99#4 = VarTipo;
  #99#5 = VarAlfa3;
  #99#6 = VarImpor;

  |BUCLE reremesa;

  |SI VarAlfa5 ! "S"; |Y #99#9 = 0;
      #99#7 = "N";
      #99#8 = "RENTA NO IMPRESA";
      #99#9 = 1;
  |FINSI;

  |SI #99#1 = "T";  VarCuent = 174;  |FINSI;
  |SI #99#1 = "C";  VarCuent = 175;  |FINSI;
  |SI #99#1 = "1";  VarCuent = 176;  |FINSI;
  |SI #99#1 = "2";  VarCuent = 177;  |FINSI;
  |SI #99#1 = "3";  VarCuent = 178;  |FINSI;
  |SI #99#1 = "4";  VarCuent = 179;  |FINSI;

  #99#10 = #1VarCuent;
  |GRABA 040#99n;
|FPRC;

|PROCESO CargaFanta;
  VarAlfa1 = #900#1;
  |SI #900#1 = "T";  VarAlfa2 = "TITULAR";  |FINSI;
  |SI #900#1 = "C";  VarAlfa2 = "CONYUGE";  |FINSI;
  |SI #900#1 = "1";  VarAlfa2 = "1§.FAMI";  |FINSI;
  |SI #900#1 = "2";  VarAlfa2 = "2§.FAMI";  |FINSI;
  |SI #900#1 = "3";  VarAlfa2 = "3§.FAMI";  |FINSI;
  |SI #900#1 = "4";  VarAlfa2 = "4§.FAMI";  |FINSI;

  VarAlfa4 = #900#3;

  |SI #900#4 ! 0;
      VarTipo = 1;
      VarAlfa3 = "Modelo 210 " + #900#5;
      VarImpor = #900#4;
      VarAlfa5 = #900#10;
      |HAZ ImporExtra;
  |FINSI;

  |SI #900#6 ! 0;
      VarTipo  = 1;
      VarAlfa3 = "Modelo 212";
      VarImpor = #900#6;
      VarAlfa5 = #900#11;
      |HAZ ImporExtra;
  |FINSI;

  |SI #900#7 ! 0;
      VarTipo  = 3;
      VarAlfa3 = "Modelo 214 Patrimonio";
      VarImpor = #900#7;
      VarAlfa5 = #900#12;
      |HAZ ImporExtra;
  |FINSI;

  |SI #900#9 ! 0;
      VarTipo  = 3;
      VarAlfa3 = "Modelo 214 Renta";
      VarImpor = #900#9;
      VarAlfa5 = #900#12;
      |HAZ ImporExtra;
  |FINSI;
|FPRC;

|DEFBUCLE rew00009;
  #900#1;
  ;
  #1#0, 1;
  #1#0, 9;
  ;
  NULL, CargaFanta;
|FIN;

|PROCESO CargaGuiris;
  Valfa = "";
  Tempo = "";
  |DFICE Valfa;
  |TEMPO Tempo; Temporal = Tempo - Valfa; |NOME_DAT #900 Temporal; |FBORRA Temporal;
  |ABRE #900;  |CIERRA #900;  |DELINDEX #900;


  Cliente01 = #1#0;
  |SUB_EJECUTA "rey00102";       || modelo 210
  |SUB_EJECUTA "rey00103";       || modelo 212
  |SUB_EJECUTA "rey00104";       || modelo 214

  |BUCLE rew00009;

  |SI #1#140 = "S";
      VarAlfa1 = "T";
      VarAlfa2 = "TITULAR";
      VarAlfa3 = "Modelo 714";
      VarAlfa4 = #1#1;
      VarAlfa5 = "S";
      VarImpor = #4#35;
      VarTipo  = 3;
      |HAZ ImporExtra;
  |FINSI;

  |SI #1#141 = "S";
      VarAlfa1 = "C";
      VarAlfa2 = "CONYUGE";
      VarAlfa3 = "Modelo 714";
      VarAlfa4 = #1#28;
      VarAlfa5 = "S";
      VarImpor = #4#36;
      VarTipo  = 3;
      |HAZ ImporExtra;
  |FINSI;

  |SI #1#194 = "S";
      VarAlfa1 = "1";
      VarAlfa2 = "1§FAMIL.";
      VarAlfa3 = "Modelo 714";
      VarTraba = #1#98 + 57;  VarAlfa4 = #1VarTraba;
      VarAlfa5 = "S";
      VarImpor = #4#37;
      VarTipo  = 3;
      |HAZ ImporExtra;
  |FINSI;

  |SI #1#195 = "S";
      VarAlfa1 = "2";
      VarAlfa2 = "2§FAMIL.";
      VarAlfa3 = "Modelo 714";
      VarTraba = #1#99 + 57;  VarAlfa4 = #1VarTraba;
      VarAlfa5 = "S";
      VarImpor = #4#38;
      VarTipo  = 3;
      |HAZ ImporExtra;
  |FINSI;

  |SI #1#196 = "S";
      VarAlfa1 = "3";
      VarAlfa2 = "3§FAMIL.";
      VarAlfa3 = "Modelo 714";
      VarTraba = #1#100 + 57;  VarAlfa4 = #1VarTraba;
      VarAlfa5 = "S";
      VarImpor = #4#39;
      VarTipo  = 3;
      |HAZ ImporExtra;
  |FINSI;

  |SI #1#197 = "S";
      VarAlfa1 = "4";
      VarAlfa2 = "4§FAMIL.";
      VarAlfa3 = "Modelo 714";
      VarTraba = #1#101 + 57;  VarAlfa4 = #1VarTraba;
      VarAlfa5 = "S";
      VarImpor = #4#40;
      VarTipo  = 3;
      |HAZ ImporExtra;
  |FINSI;
|FPRC;

|RUTINA Inferior;
  #99#0 = 1;
|FRUT;

|RUTINA Superior;
  #99#0 = Refer;
|FRUT;

|PROCESO GrabaRemesa;
  #10#0  = #0#0;
  #10#1  = #0#2;
  #10#2  = #0#3;
  #10#3  = #99#1;
  #10#4  = #99#4;
  #10#5  = #99#2;
  #10#6  = #99#3;
  #10#7  = #99#10;
  #10#8  = #0#1;
  #10#9  = #99#6;
  #10#10 = #99#5;
  |GRABA 140#10n
  |LIBERA #10;
|FPRC;

|DEFBUCLE rew00004;
  #99#1;
  7;
      1, "S";
  Refer, "S";
  ;
  NULL, GrabaRemesa;
|FIN;

|PROCESO CargaIndex;
  comienza = "50";
  |HAZ fichero;
  |NOME_DAT #99 fichero;
  |ABRE #99; |CIERRA #99; |DELINDEX #99;

  |HAZ LeeLiqui;

  |ABRE #99;
  Refer = 0;
  |SI #1#4 = "S"; |HAZ CargaSpanis; |FINSI;
  |SI #1#4 = "N"; |HAZ CargaGuiris; |FINSI;
  |CIERRA #99;

  |SI Refer = 0; |DELINDEX #99; |ACABA; |FINSI;

  |ENTLINEAL #1#99, 1, 4, 20, 0, Inferior, Superior;
  |CONFI "2400SConforme con lo seleccionado : ";
  |SI FSalida ! 0; |DELINDEX #99; |ACABA; |FINSI;

  |ABRE #10;
  |BUCLE rew00004;
  |CIERRA #10;

  |DELINDEX #99;
|FPRC;

|PROCESO Funcion1; |TIPO 11;
  |SI FSalida ! 9; |ACABA; |FINSI;

  |SI #99#9 = 1;
      |PUSHV 0501 2380;
      |AVISO; |AVISO; |AVISO;
      |D_CUADRO 1121,1462;
      |ATRI R;
      |PINTA 1222, "NO SE PUEDE ADJUDICAR EL APUNTE MOTIVO :";
      |PINTA 1322, #99#8;
      |ATRI r;
      |PAUSA;
      |POPV;
      |ACABA;
  |FINSI;

  |LIBERA #99;
  |LEE 140#99=;

  |SI #99#7 = "N"; #99#7 = "S"; |SINO; #99#7 = "N"; |FINSI;
  |PINTA #99#7;

  |GRABA 140#99a;
|FPRC;
