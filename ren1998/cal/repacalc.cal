|FICHEROS
   retotren #0;
   repacalc #1;
   redatcon #3;
   retotpat #6;
   reincide #7;
   repartid #8;
   reliquid #10;
   retotrea #11;
   retotreb #13;
   retotrec #116;
|FIN;

|INCLUYE i_varcal;

|VARIABLES;
    &SwRecalculo = 0;

    aBase     = "";
    aPathDef  = "";
    aPathFich = "";

    aincisino = "";
    nModo     = 0;
    nempresa  = 0;
    nemprefi  = 0;
    anombre   = "";
    nlininci  = 0;
    nswcalcu  = 0;
    aminusva1 = "";
    aminusva2 = "";
    aminusva3 = "";
    aminusva4 = "";
    aminusva5 = "";
    aminusva6 = "";
    adeclara  = "";
    nindividu = 0;
    nacceso   = 0;
    nrecalcu  = 0;
    anif      = "";
    nprogra_1 = 0;
    nprogra_2 = 0;
    nprogra_3 = 0;
    nprogra_4 = 0;
    nprogra_5 = 0;
    nprogra_6 = 0;
    nprogra_7 = 0;
    nprogra_8 = 0;
    nprogra_9 = 0;
    nprogra_10 = 0;
    nprogra_11 = 0;
    nprogra_12 = 0;
    nprogra_13 = 0;
    nprogra_14 = 0;
    nprogra_15 = 0;
    nprogra_16 = 0;
    nprogra_17 = 0;
    nprogra_18 = 0;
    nprogra_19 = 0;
    nprogra_20 = 0;
    nprogra_21 = 0;
    nprogra_22 = 0;
    nprogra_23 = 0;
    nprogra_24 = 0;
    nprogra_25 = 0;
    nprogra_26 = 0;
    nprogra_27 = 0;
    nprogra_28 = 0;
    nprogra_29 = 0;
    nprogra_30 = 0;
    nprogra_51 = 0;
    nprogra_52 = 0;
    nprogra_60 = 0;
    nprogra_62 = 0;

    ntippar    = 0;
    nparte1    = 0;
    nparte2    = 0;
    amuerto    = "";
    ffecpar    = @;
    nnetot     = 0;
    nnetoc     = 0;
    nnetoa     = 0;
    ntrabat    = 0;
    ntrabac    = 0;
    ntrabaa    = 0;
    nobitus    = 0;
    nestoyempresa = 0;
|FIN;

|PROGRAMA;
     |DDEFECTO #10;
     #1#0 = empresa;
     #1#1 = nombre;

     |HAZ sacaimpo;

     SwPasada = 0;    |HAZ acalcula;

     |HAZ sacaimpo;

     |SI #8#3 = 2;
         SwPasada = 1;
         |PINPA #0#1;
         |PINPA #0#1;
         |ENDATOS #1#1;
     |SINO;
         |DDEFECTO #10;
         |PINPA #0#10;
         |PINDA #0#10;
         SwPasada = 1;    |HAZ acalcula;
     |FINSI;
|FPRO;

|PROCESO GuardaVariables;
    aincisino = incisino;
    nModo     = modo;
    nempresa  = empresa;
    nemprefi  = emprefi;
    anombre   = nombre;
    nlininci  = lininci;
    nswcalcu  = swcalcu;
    aminusva1 = minusva1;
    aminusva2 = minusva2;
    aminusva3 = minusva3;
    aminusva4 = minusva4;
    aminusva5 = minusva5;
    aminusva6 = minusva6;
    adeclara  = declara;
    nindividu = individu;
    nacceso   = acceso;
    nrecalcu  = recalcu;
    anif      = nif;
    nprogra_1 = progra_1;
    nprogra_2 = progra_2;
    nprogra_3 = progra_3;
    nprogra_4 = progra_4;
    nprogra_5 = progra_5;
    nprogra_6 = progra_6;
    nprogra_7 = progra_7;
    nprogra_8 = progra_8;
    nprogra_9 = progra_9;
    nprogra_10 = progra_10;
    nprogra_11 = progra_11;
    nprogra_12 = progra_12;
    nprogra_13 = progra_13;
    nprogra_14 = progra_14;
    nprogra_15 = progra_15;
    nprogra_16 = progra_16;
    nprogra_17 = progra_17;
    nprogra_18 = progra_18;
    nprogra_19 = progra_19;
    nprogra_20 = progra_20;
    nprogra_21 = progra_21;
    nprogra_22 = progra_22;
    nprogra_23 = progra_23;
    nprogra_24 = progra_24;
    nprogra_25 = progra_25;
    nprogra_26 = progra_26;
    nprogra_27 = progra_27;
    nprogra_28 = progra_28;
    nprogra_29 = progra_29;
    nprogra_30 = progra_30;
    nprogra_51 = progra_51;
    nprogra_52 = progra_52;
    nprogra_60 = progra_60;
    nprogra_62 = progra_62;

    ntippar    = tippar;
    nparte1    = parte1;
    nparte2    = parte2;
    amuerto    = muerto;
    ffecpar    = fecpar;
    nnetot     = netot;
    nnetoc     = netoc;
    nnetoa     = netoa;
    ntrabat    = trabat;
    ntrabac    = trabac;
    ntrabaa    = trabaa;
    nobitus    = obitus;
    nestoyempresa = estoyempresa;
|FPRC;

|PROCESO RecogeVariables;
    incisino  = aincisino;
    modo      = nModo;
    empresa   = nempresa;
    emprefi   = nemprefi;
    nombre    = anombre;
    lininci   = nlininci;
    swcalcu   = nswcalcu;
    minusva1  = aminusva1;
    minusva2  = aminusva2;
    minusva3  = aminusva3;
    minusva4  = aminusva4;
    minusva5  = aminusva5;
    minusva6  = aminusva6;
    declara   = adeclara;
    individu  = nindividu;
    acceso    = nacceso;
    recalcu   = nrecalcu;
    nif       = anif;
    progra_1  = nprogra_1;
    progra_2  = nprogra_2;
    progra_3  = nprogra_3;
    progra_4  = nprogra_4;
    progra_5  = nprogra_5;
    progra_6  = nprogra_6;
    progra_7  = nprogra_7;
    progra_8  = nprogra_8;
    progra_9  = nprogra_9;
    progra_10 = nprogra_10;
    progra_11 = nprogra_11;
    progra_12 = nprogra_12;
    progra_13 = nprogra_13;
    progra_14 = nprogra_14;
    progra_15 = nprogra_15;
    progra_16 = nprogra_16;
    progra_17 = nprogra_17;
    progra_18 = nprogra_18;
    progra_19 = nprogra_19;
    progra_20 = nprogra_20;
    progra_21 = nprogra_21;
    progra_22 = nprogra_22;
    progra_23 = nprogra_23;
    progra_24 = nprogra_24;
    progra_25 = nprogra_25;
    progra_26 = nprogra_26;
    progra_27 = nprogra_27;
    progra_28 = nprogra_28;
    progra_29 = nprogra_29;
    progra_30 = nprogra_30;
    progra_51 = nprogra_51;
    progra_52 = nprogra_52;
    progra_60 = nprogra_60;
    progra_62 = nprogra_62;

    tippar    = ntippar;
    parte1    = nparte1;
    parte2    = nparte2;
    muerto    = amuerto;
    fecpar    = ffecpar;
    netot     = nnetot;
    netoc     = nnetoc;
    netoa     = nnetoa;
    trabat    = ntrabat;
    trabac    = ntrabac;
    trabaa    = ntrabaa;
    obitus    = nobitus;
    estoyempresa = nestoyempresa;
|FPRC;

|PROCESO sacaimpo;
  |ABRE #8;
  #8#0 = #1#0;
  |LEE 010#8=;
  |SI FSalida ! 0; |DDEFECTO #8; |FINSI;
  |CIERRA #8;

  tippar  = #8#3;
  muerto  = #8#5;
  |SI #8#3 = 2;
      fecpar = #8#4;
  |SINO;
      fecpar = #8#6;
  |FINSI;

  |SI #8#3 ! 2;
      |CAMPO_MODIFICA #1#9, 1, "N"
  |FINSI;

  |ABRE #0;
  #0#0 = #1#0;
  #0#141 = "T";
  |LEE 010#0=;
  |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
  #1#3  = #0#5;
  #1#5  = #0#32 + #0#54;
  #1#10 = #0#27;
  |LIBERA #0;

  #0#0 = #1#0;
  #0#141 = "C";
  |LEE 010#0=;
  |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
  #1#4  = #0#5;
  #1#6  = #0#32 + #0#54;

  #0#0 = #1#0;
  #0#141 = "A";
  |LEE 010#0=;
  |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
  #1#7 = #0#5;

  |LIBERA #0;
  |CIERRA #0;

  SwRecalculo = 1;
  |HAZ GuardaVariables;
  modo        = 0;
  empresa     = #0#0;  |SUB_EJECUTA "recalcul";
  |HAZ RecogeVariables;
  SwRecalculo = 0;

  |ABRE #0;
  #0#0   = #1#0;
  #0#141 = "T";
  |LEE 010#0=;
  |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
  #1#10 = #0#27;

  #0#0   = #1#0;
  #0#141 = "C";
  |LEE 010#0=;
  |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
  #1#11 = #0#27;
  |CIERRA #0;
|FPRC;

|PROCESO liqborra;
 |BORRA 020#0a;
|FPRC;

|PROCESO recborra;
  |BORRA 020#116a;
  |LIBERA #116;
|FPRC;

|PROCESO patborra;
 |BORRA 020#6a;
 |LIBERA #6;
|FPRC;

|PROCESO adjborraa;
  |BORRA 020#11a;
  |LIBERA #11;
|FPRC;

|PROCESO adjborrab;
  |BORRA 020#13a;
  |LIBERA #13;
|FPRC;

|PROCESO borrainci;
  |BORRA 020#7a;
  |LIBERA #7;
|FPRC;

|PROCESO borrapant;
  |BORRA 020#10a;
  |LIBERA #10;
|FPRC;

|DEFBUCLE borraliq;
#0#1;
;
empresa," ";
emprefi,"z";
be;
NULL,liqborra;
|FIN;

|DEFBUCLE borrarec;
#116#1;
;
empresa, " ";
emprefi, "z";
be;
NULL,recborra;
|FIN;

|DEFBUCLE borrapat;
#6#1;
;
empresa," ";
emprefi,"z";
be;
NULL,patborra;
|FIN;

|DEFBUCLE borraadja;
#11#1;
;
empresa," ";
emprefi,"z";
be;
NULL,adjborraa;
|FIN;

|DEFBUCLE borraadjb;
#13#1;
;
empresa," ";
emprefi,"z";
be;
NULL,adjborrab;
|FIN;

|DEFBUCLE borrainc;
#7#1;
3;
empresa, 0001, "S";
emprefi, 9999, "S";
be;
NULL,borrainci;
|FIN;

|DEFBUCLE borrapan;
#10#1;
;
empresa;
emprefi;
be;
NULL,borrapant;
|FIN;

|PROCESO acalcula;  |TIPO 3;
incisino = "S";

|ATRI P;
|CUADRO 1926 2150;
|PINTA 2027, " ESTOY CALCULANDO .... ";
|ATRI 0;

empresa = #1#0;
emprefi = #1#0;
obitus  = #1#9;
feini   = "01.01.1998";
fefin   = fecpar;
dias    = fefin - feini + 1;
parte1  = (( 100 * dias ) / 36500) ! 4;
parte2  = 1 - parte1;
swcalcu = 0;
lininci = 0;
recalcu = 2;

|SUB_EJECUTA "rerecdat";

|HAZ programas;

|BUCLE borraliq;  || Borra la liquidacion si ya la hubiera
|BUCLE borrarec;  || Borra Inc Dis retotrec
|BUCLE borrapat;  || Borra patrimonio
|BUCLE borraadja; || Borra liquidacion adjunta
|BUCLE borraadjb; || Borra liquidacion adjunta
|BUCLE borrainc;  || Borra incidencias
|BUCLE borrapan;  || Borra Pantalla Liquidacion;

||ATENCION !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

|ABRE #3;
#3#0 = empresa;
|LEE 040#3=;
|SI FSalida ! 0; |DDEFECTO #3; |FINSI;
|CIERRA #3;

minusva1 = #3#5;
minusva2 = #3#31;
minusva3 = #3#88;
minusva4 = #3#89;
minusva5 = #3#90;
minusva6 = #3#91;
netot    = #1#3;
netoc    = #1#4;
netoa    = #1#7;
trabac   = #1#6;
trabat   = #1#5;
trabaa   = #1#8;
individu = 0;
|SI #3#34 = "X";  individu = 1;  |FINSI;

|SI progra_1=1;|O progra_2=1;|O progra_3=1;|O progra_4=1;|O progra_5=1;
    |HAZ recalpa1;
|FINSI;

|SI progra_6=1;|O progra_7=1;|O progra_8=1;|O progra_9=1;
 |O progra_10=1;|O progra_51=1;
    |HAZ recalpa2;
|FINSI;

|SI progra_11=1;|O progra_12=1;|O progra_13=1;|O progra_14=1;|O progra_15=1;
 |O progra_52=1;|O progra_60=1;
    |HAZ recalpa3;
|FINSI;

|SI progra_16=1;|O progra_17=1;|O progra_18=1;|O progra_19=1;|O progra_20=1;
    |HAZ recalpa4;
|FINSI;

|SI progra_21=1;|O progra_22=1;|O progra_23=1;|O progra_24=1;|O progra_25=1;
    |HAZ recalpa5;
|FINSI;

|SI progra_26=1;|O progra_27=1;|O progra_28=1; |O progra_29=1; |O progra_62=1;
    |HAZ recalpa6;
|FINSI;

|HAZ recalpa8;

|SI progra_30=1;
    |HAZ recalpa7;
|FINSI;

|SI SwRecalculo = 1;
    SwPasada = 0;
|FINSI;

|SI SwPasada = 1;
    |SUB_EJECUTA "reliquip";
|FINSI;
|FPRC;

|PROCESO programas;
  |DBASS aBase;   |QBT aBase;
  aPathDef  = aBase + "ren1998/def/reprogra";
  aPathFich = aBase + "ren1998/fich/reprogra";

  |LEEDEDEF aPathDef, aPathFich, 0, empresa, 1,  progra_1,  2,  progra_2,   3, progra_3;
  |LEEDEDEF aPathDef, aPathFich, 0, empresa, 4,  progra_4,  5,  progra_5,   6, progra_6;
  |LEEDEDEF aPathDef, aPathFich, 0, empresa, 7,  progra_7,  8,  progra_8,   9, progra_9;
  |LEEDEDEF aPathDef, aPathFich, 0, empresa, 10, progra_10, 11, progra_11, 12, progra_12;
  |LEEDEDEF aPathDef, aPathFich, 0, empresa, 13, progra_13, 14, progra_14, 15, progra_15;
  |LEEDEDEF aPathDef, aPathFich, 0, empresa, 16, progra_16, 17, progra_17, 18, progra_18;
  |LEEDEDEF aPathDef, aPathFich, 0, empresa, 19, progra_19, 20, progra_20, 21, progra_21
  |LEEDEDEF aPathDef, aPathFich, 0, empresa, 22, progra_22, 23, progra_23, 24, progra_24;
  |LEEDEDEF aPathDef, aPathFich, 0, empresa, 25, progra_25, 26, progra_26, 27, progra_27;
  |LEEDEDEF aPathDef, aPathFich, 0, empresa, 28, progra_28, 29, progra_29, 30, progra_30;
  |LEEDEDEF aPathDef, aPathFich, 0, empresa, 51, progra_51, 60, progra_60, 62, progra_62;
  |LEEDEDEF aPathDef, aPathFich, 0, empresa, 52, progra_52;
|FPRC;
