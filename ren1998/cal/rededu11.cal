|FICHEROS;
     rededu11 #0;
     reparame #1;
     rem00007 #2,MANTE;
     rem00008 #3;
     redatcon #4;
     recofisc #5;
     recapinm #6;
|FIN;

|VARIABLES;
      nModelito = 0;
      nForma    = 0;
      nTecla    = 0;
      nCampo3   = 0;
      nCampo4   = 0;
      nCampo5   = 0;
      nCampo7   = 0;

     nHijosAntT = 0;
     nHijosAntC = 0;
     nHijosDedT = 0;
     nHijosDedC = 0;
     nHijos     = 0;
     nPosi      = 0;
     nCoefi     = 0;

     nEdadMayorT = 0;
     nEdadMayorC = 0;
     nAscendT    = 0;
     nAscendC    = 0;
     nMinusvT    = 0;
     nMinusvC    = 0;

     aEdad        = "";
     aTPerceptor  = "";
     aTPerceptorI = "";
     nCantidad   = 0;
     nTipo       = 0;
     nDeduccion  = 0;
     nNumero     = 0;
     nInversion  = 0;
     nLinea      = 0;

    &aTipoGente = "";
     &empresa   = 0;
     &nombre      = "";
     &modo       = 0;
     &indivi     = "";
     &enTipoDedu = 0;
|FIN;

|INCLUYE i_husuar;
|INCLUYE i_activo;

|PROCESO CalcuHijos;
     || nCampo5 = tipo de parentesco
     || nCampo4 = A¤o Nacimiento
     || nCampo3 = De quien son los hijos

     nHijosAntT  = 0;   || Numero de Hijos nacidos antes de 1998
     nHijosAntC  = 0;   || Numero de Hijos nacidos antes de 1998
     nHijosDedT  = 0;   || Numero de Hijos nacidos en 1998
     nHijosDedC  = 0;   || Numero de Hijos nacidos en 1998
     nEdadMayorT = 0;   || Sujetos Pasivos de ....A¤os o mas
     nEdadMayorC = 0;   || Sujetos Pasivos de ... A¤os o mas
     nAscendT    = 0;   || Ascendientes de ... A¤os  o mas
     nAscendC    = 0;   || Ascendientes de ... A¤os  o mas
     nMinusvT    = 0;   || Minusvalidos
     nMinusvC    = 0;   || Minusvalidos

     |PARA nCampo5 = 164;  |SI nCampo5 [ 173;  |HACIENDO nCampo5 = nCampo5 + 1;
           nCampo3 = nCampo5 - 10;
           nCampo4 = nCampo5 - 96;
           nCampo7 = nCampo5 - 76;
           |SI #4nCampo5 = "H";
               |SI #4nCampo4 < "1998"; |Y #4nCampo4 ! "    ";
                   |SI #4nCampo3 = "A"; |O #4nCampo3 = "T";
                       nHijosAntT = nHijosAntT + 1;
                   |FINSI;

                   |SI #4nCampo3 = "A"; |O #4nCampo3 = "C";
                       nHijosAntC = nHijosAntC + 1;
                   |FINSI;
               |FINSI;
               |SI #4nCampo4 = "1998";
                   |SI #4nCampo3 = "A"; |O #4nCampo3 = "T";
                       nHijosDedT = nHijosDedT + 1;
                   |FINSI;

                   |SI #4nCampo3 = "A"; |O #4nCampo3 = "C";
                       nHijosDedC = nHijosDedC + 1;
                   |FINSI;
               |FINSI;
           |FINSI;

           |SI #4nCampo5 = "A";
               |SI #4nCampo4 [ aEdad;  |Y #4nCampo4 ! "    ";
                   |SI #4nCampo3 = "A"; |O #4nCampo3 = "T";
                       nAscendT = nAscendT + 1;
                   |FINSI;
                   |SI #4nCampo3 = "A"; |O #4nCampo3 = "C";
                       nAscendC = nAscendC + 1;
                   |FINSI;
               |FINSI;
           |FINSI;

           |SI #4nCampo7 = "S";
               |SI #4nCampo3 = "A"; |O #4nCampo3 = "T";
                   nMinusvT = nMinusvT + 1;
               |FINSI;
               |SI #4nCampo3 = "A"; |O #4nCampo3 = "C";
                   nMinusvC = nMinusvC + 1;
               |FINSI;
           |FINSI;
     |SIGUE;

     |SI #4#5  = "S";  nMinusvT = nMinusvT + 1;  |FINSI;
     |SI #4#31 = "S";  nMinusvC = nMinusvC + 1;  |FINSI;

     |SI #4#3  [ aEdad;  |Y #4#3  ! "    ";  nEdadMayorT = 1;  |FINSI;
     |SI #4#30 [ aEdad;  |Y #4#30 ! "    ";  nEdadMayorC = 1;  |FINSI;
|FPRC;

|PROCESO GrabaLinea;
     |DDEFECTO #0;
     nLinea = nLinea + 1;
     #0#0   = empresa;
     #0#1   = nLinea;
     #0#2   = aTPerceptor;

     |SI #0#2 = "T"; #0#3 = "TITULAR  "; |FINSI;
     |SI #0#2 = "C"; #0#3 = "CONYUGE  "; |FINSI;
     |SI #0#2 = "G"; #0#3 = "GANANCIAL"; |FINSI;
     |SI #0#2 = "1"; #0#3 = "FAMILIAR "; |FINSI;
     |SI #0#2 = "2"; #0#3 = "FAMILIAR "; |FINSI;
     |SI #0#2 = "3"; #0#3 = "FAMILIAR "; |FINSI;
     |SI #0#2 = "4"; #0#3 = "FAMILIAR "; |FINSI;
     |SI #0#2 = "V"; |Y #0#7 ! "X";
         #0#3 = "VARIOS   ";
     |FINSI;

     #0#4 = nTipo;

     |ABRE #2;
     #2#0 = #5#3;
     |LEE 040#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     |ABRE #3;
     #3#0 = #2#0;
     #3#1 = #0#4;
     |LEE 040#3=;
     |SI FSalida ! 0;  |DDEFECTO #3;  |FINSI;
     |CIERRA #3;

     #0#5  = #3#2;
     #0#6  = nDeduccion;
     #0#15 = nNumero;
     #0#16 = nInversion;

     |GRABA 020#0n;
     |LIBERA #0;
|FPRC;

|PROCESO MiraVivienda;
     aTPerceptorI = #6#2;
     nCantidad    = #6#14 % 3;

     |ERROR10;
|FPRC;

|DEFBUCLE recapinm;
     #6#1;
     13;
     empresa, 001, "H";
     empresa, 999, "H";
     ;
     NULL, MiraVivienda;
|FIN;

|PROCESO Aragon;
     aEdad = "1923";
     |HAZ CalcuHijos;

     |SI nEdadMayorT ] 1;
         aTPerceptor = "T";
         nTipo       = 7;
         nNumero     = nEdadMayorT;
         nDeduccion  = nNumero * 25000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI nEdadMayorC ] 1;
         aTPerceptor = "C";
         nTipo       = 7;
         nNumero     = nEdadMayorC;
         nDeduccion  = nNumero * 25000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI nAscendT ] 1;
         aTPerceptor = "T";
         nTipo       = 14;
         nNumero     = nAscendT;
         nDeduccion  = nNumero * 25000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI nAscendC ] 1;
         aTPerceptor = "C";
         nTipo       = 14;
         nNumero     = nAscendC;
         nDeduccion  = nNumero * 25000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI nMinusvT ] 1;
         aTPerceptor = "T";
         nTipo       = 13;
         nNumero     = nMinusvT;
         nDeduccion  = nNumero * 25000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI nMinusvC ] 1;
         aTPerceptor = "C";
         nTipo       = 13;
         nNumero     = nMinusvC;
         nDeduccion  = nNumero * 25000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;
|FPRC;

|PROCESO Baleares;
     aEdad = "1933";
     |HAZ CalcuHijos;

     |SI nEdadMayorT ] 1;
         aTPerceptor = "T";
         nTipo       = 5;
         nNumero     = nEdadMayorT;
         nDeduccion  = nNumero * 4000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI nEdadMayorC ] 1;
         aTPerceptor = "C";
         nTipo       = 5;
         nNumero     = nEdadMayorC;
         nDeduccion  = nNumero * 4000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI nMinusvT ] 1;
         aTPerceptor = "T";
         nTipo       = 12;
         nNumero     = nMinusvT;
         nDeduccion  = nNumero * 10000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI nMinusvC ] 1;
         aTPerceptor = "C";
         nTipo       = 12;
         nNumero     = nMinusvC;
         nDeduccion  = nNumero * 10000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;
|FPRC;

|PROCESO Catalunya;
     aEdad = "1933";
     |HAZ CalcuHijos;

     |SI nHijosDedT ! 0;
         nHijos = nHijosAntT + nHijosDedT;
         |SI nHijos ] 2;
             |SI nHijosAntT = 0;
                 aTPerceptor = "T";
                 nTipo       = 2;
                 nNumero     = nHijosDedT - 1;
                 nDeduccion  = nNumero * 12500;
                 nInversion  = 0;
                 |HAZ GrabaLinea;
             |FINSI;

             |SI nHijosAntT = 1;
                 aTPerceptor = "T";
                 nTipo       = 2;
                 nNumero     = nHijosDedT;
                 nDeduccion  = nNumero * 12500;
                 nInversion  = 0;
                 |HAZ GrabaLinea;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nHijosDedC ! 0;
         nHijos = nHijosAntC + nHijosDedC;
         |SI nHijos ] 2;
             |SI nHijosAntC = 0;
                 aTPerceptor = "C";
                 nTipo       = 2;
                 nNumero     = nHijosDedC - 1;
                 nDeduccion  = nNumero * 12500;
                 nInversion  = 0;
                 |HAZ GrabaLinea;
             |FINSI;

             |SI nHijosAntC = 1;
                 aTPerceptor = "C";
                 nTipo       = 2;
                 nNumero     = nHijosDedC;
                 nDeduccion  = nNumero * 12500;
                 nInversion  = 0;
                 |HAZ GrabaLinea;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Galicia;
     aEdad = "1933";
     |HAZ CalcuHijos;

     nCoefi = 100;
     |SI nHijosDedT = nHijosDedC;  nCoefi = 50;  |FINSI;

     nPosi       = nHijosAntT + 1;
     nDeduccion  = 0;
     |PARA nHijos = 1;  |SI nHijos [ nHijosDedT;  |HACIENDO nHijos = nHijos + 1;
           |SI nPosi = 1;  nDeduccion = nDeduccion + (20000 % nCoefi);  |FINSI;
           |SI nPosi = 2;  nDeduccion = nDeduccion + (20000 % nCoefi);  |FINSI;
           |SI nPosi = 3;  nDeduccion = nDeduccion + (30000 % nCoefi);  |FINSI;
           |SI nPosi = 4;  nDeduccion = nDeduccion + (40000 % nCoefi);  |FINSI;
           |SI nPosi ] 5;  nDeduccion = nDeduccion + (50000 % nCoefi);  |FINSI;
           nPosi = nPosi + 1;
     |SIGUE;

     |SI nDeduccion ! 0;
         aTPerceptor = "T";
         nTipo       = 4;
         nNumero     = 0;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     nPosi       = nHijosAntC + 1;
     nDeduccion  = 0;
     |PARA nHijos = 1;  |SI nHijos [ nHijosDedC;  |HACIENDO nHijos = nHijos + 1;
           |SI nPosi = 1;  nDeduccion = nDeduccion + (20000 % nCoefi);  |FINSI;
           |SI nPosi = 2;  nDeduccion = nDeduccion + (20000 % nCoefi);  |FINSI;
           |SI nPosi = 3;  nDeduccion = nDeduccion + (30000 % nCoefi);  |FINSI;
           |SI nPosi = 4;  nDeduccion = nDeduccion + (40000 % nCoefi);  |FINSI;
           |SI nPosi ] 5;  nDeduccion = nDeduccion + (50000 % nCoefi);  |FINSI;
           nPosi = nPosi + 1;
     |SIGUE;

     |SI nDeduccion ! 0;
         aTPerceptor = "C";
         nTipo       = 4;
         nNumero     = 0;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;
|FPRC;

|PROCESO Madrid;
     aEdad = "1933";
     |HAZ CalcuHijos;
     |SI nHijosDedT ] 1;
         aTPerceptor = "T";
         nTipo       = 23;
         nNumero     = nHijosDedT;
         nDeduccion  = nNumero * 25000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI nHijosDedC ] 1;
         aTPerceptor = "C";
         nTipo       = 23;
         nNumero     = nHijosDedC;
         nDeduccion  = nNumero * 25000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI nAscendT ] 1;
         aTPerceptor = "T";
         nTipo       = 24;
         nNumero     = nAscendT;
         nDeduccion  = nNumero * 10000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI nAscendC ] 1;
         aTPerceptor = "C";
         nTipo       = 24;
         nNumero     = nAscendC;
         nDeduccion  = nNumero * 10000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;
|FPRC;

|PROCESO Valencia;
     aEdad = "1933";
     |HAZ CalcuHijos;

     |SI nHijosDedT ! 0;
         nHijos = nHijosAntT + nHijosDedT;
         |SI nHijos ] 3;
             |SI nHijosAntT = 0;
                 aTPerceptor = "T";
                 nTipo       = 3;
                 nNumero     = nHijosDedT - 2;
                 nDeduccion  = nNumero * 25000;
                 nInversion  = 0;
                 |HAZ GrabaLinea;
             |FINSI;

             |SI nHijosAntT = 1;
                 aTPerceptor = "T";
                 nTipo       = 3;
                 nNumero     = nHijosDedT - 1;
                 nDeduccion  = nNumero * 25000;
                 nInversion  = 0;
                 |HAZ GrabaLinea;
             |FINSI;

             |SI nHijosAntT ] 2;
                 aTPerceptor = "T";
                 nTipo       = 3;
                 nNumero     = nHijosDedT;
                 nDeduccion  = nNumero * 25000;
                 nInversion  = 0;
                 |HAZ GrabaLinea;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nHijosDedC ! 0;
         nHijos = nHijosAntC + nHijosDedC;
         |SI nHijos ] 3;
             |SI nHijosAntC = 0;
                 aTPerceptor = "C";
                 nTipo       = 3;
                 nNumero     = nHijosDedC - 2;
                 nDeduccion  = nNumero * 25000;
                 nInversion  = 0;
                 |HAZ GrabaLinea;
             |FINSI;

             |SI nHijosAntC = 1;
                 aTPerceptor = "C";
                 nTipo       = 3;
                 nNumero     = nHijosDedC - 1;
                 nDeduccion  = nNumero * 25000;
                 nInversion  = 0;
                 |HAZ GrabaLinea;
             |FINSI;

             |SI nHijosAntC ] 2;
                 aTPerceptor = "C";
                 nTipo       = 3;
                 nNumero     = nHijosDedC;
                 nDeduccion  = nNumero * 25000;
                 nInversion  = 0;
                 |HAZ GrabaLinea;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nEdadMayorT ] 1;
         aTPerceptor = "T";
         nTipo       = 6;
         nNumero     = nEdadMayorT;
         nDeduccion  = nNumero * 10000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI nEdadMayorC ] 1;
         aTPerceptor = "C";
         nTipo       = 6;
         nNumero     = nEdadMayorC;
         nDeduccion  = nNumero * 10000;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     nCantidad = 0;
     |BUCLE recapinm;
     |SI nCantidad = 0;  |ACABA;  |FINSI;

     |SI aTPerceptorI = "T";  |Y #4#3 ] "1963";
         aTPerceptor = "T";
         nTipo       = 21;
         nNumero     = 0;
         nDeduccion  = nCantidad;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI aTPerceptorI = "C";  |Y #4#30 ] "1963";
         aTPerceptor = "C";
         nTipo       = 21;
         nNumero     = 0;
         nDeduccion  = nCantidad;
         nInversion  = 0;
         |HAZ GrabaLinea;
     |FINSI;

     |SI aTPerceptorI = "G";
         |SI #4#3 ] "1963";
             aTPerceptor = "T";
             nTipo       = 21;
             nNumero     = 0;
             nDeduccion  = nCantidad % 50;
             nInversion  = 0;
             |HAZ GrabaLinea;
         |FINSI;

         |SI #4#30 ] "1963";
             aTPerceptor = "C";
             nTipo       = 21;
             nNumero     = 0;
             nDeduccion  = nCantidad % 50;
             nInversion  = 0;
             |HAZ GrabaLinea;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
     |SI FSalida ! 10;  |ACABA;  |FINSI;

     #0#0 = empresa;
     #0#1 = 1;
     |LEE 040#0];
     |SI FSalida = 0;  |Y #0#0 = empresa;
         |MENAV "      Ya existen deducciones en esta empresa, debe estar sin deducciones.";
         |ERROR;
         |ACABA;
     |FINSI;

     |ABRE #4;
     #4#0 = empresa;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;

     |ABRE #5;
     #5#0 = #4#12;
     |LEE 040#5=;
     |SI FSalida ! 0;  |CIERRA #5;  |ACABA;  |FINSI;
     |CIERRA #5;

     nLinea = 0;

     |SI #5#3 = 2;   |HAZ Aragon;     |FINSI;
     |SI #5#3 = 4;   |HAZ Baleares;   |FINSI;
     |SI #5#3 = 9;   |HAZ Catalunya;  |FINSI;
     |SI #5#3 = 11;  |HAZ Galicia;    |FINSI;
     |SI #5#3 = 12;  |HAZ Madrid;     |FINSI;
     |SI #5#3 = 17;  |HAZ Valencia;   |FINSI;

     |ERROR;
     |PTEC 802;
     |PTEC 807;
|FPRC;

|PROCESO ConsuGente;
     |SI FSalida ! 13;  |ACABA;  |FINSI;

     aTipoGente = #0Campo;
     |SUB_EJECUTA "rez00003";
     #0Campo = aTipoGente;
     |PINTA #0Campo;
|FPRC;

|PROCESO Actualiza; |TIPO 2;
     nForma     = 0 +. 1;
     QueTipo    = (FEntrada / 100) ! 0;
     HContribu  = #0#0;
     HNombre    = nombre;
     HPrograma  = "(rededu11) DEDUCCIONES AUTONOMICAS";
     HLinea     = #0#1;
     HPerceptor = #0#3;
     HRdto      = #0#6;

     |SI QueTipo = 1; HTipo = "ALTA FICHA";         |FINSI;
     |SI QueTipo = 2; HTipo = "MODIFICACION FICHA"; |FINSI;
     |SI QueTipo = 3; HTipo = "BAJA FICHA";         |FINSI;

     |SI QueTipo = 3; |Y nForma ! 1; |HAZ AltaHistorico;  |FINSI;
     |SI QueTipo < 3; |Y nForma = 1; |HAZ AltaHistorico;  |FINSI;
|FPRC;

|PROCESO parametro; |TIPO 0;
     nModelito = (FEntrada / 100) ! 0;
     |SI nModelito = 1;
        |ABRE #1;
        |LEE 040#1=;
        |SI FSalida = 0;
           #0#2  = #1#6;
           #0#7  = #1#7;
           |PINTA #0#2;
           |PINTA #0#7;
        |FINSI;
        |CIERRA #1;
     |FINSI;
|FPRC;

|PROCESO TipoIndi; |TIPO 7;
     |SI indivi = "S"; |Y #0Campo ! "V";
         #0Campo = "T"; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO perceptor; |TIPO 0;
     |C_M #0#8, 1, "N";
     |C_M #0#9, 1, "N";
     |C_M #0#10, 1, "N";
     |C_M #0#11, 1, "N";
     |C_M #0#12, 1, "N";
     |C_M #0#13, 1, "N";

     |SI indivi = "S"; |Y #0#2 ! "T";
         |MENAV "      La renta es individual";
         |ERROR; |ACABA;
     |FINSI;

     npro = 62; |HAZ sigrabo;

     |SI #0#2 = "T"; #0#3 = "TITULAR  "; |FINSI;
     |SI #0#2 = "C"; #0#3 = "CONYUGE  "; |FINSI;
     |SI #0#2 = "G"; #0#3 = "GANANCIAL"; |FINSI;
     |SI #0#2 = "1"; #0#3 = "FAMILIAR "; |FINSI;
     |SI #0#2 = "2"; #0#3 = "FAMILIAR "; |FINSI;
     |SI #0#2 = "3"; #0#3 = "FAMILIAR "; |FINSI;
     |SI #0#2 = "4"; #0#3 = "FAMILIAR "; |FINSI;
     |SI #0#2 = "V"; |Y #0#7 ! "X";
         #0#3 = "VARIOS   ";
         |C_M #0#8, 1, "S";
         |C_M #0#9, 1, "S";
         |C_M #0#10, 1, "S";
         |C_M #0#11, 1, "S";
         |C_M #0#12, 1, "S";
         |C_M #0#13, 1, "S";
     |FINSI;
     |PINTA #0#3;
|FPRC;

|PROCESO nomodi; |TIPO 0;
     |SI #0#7 = "X";
         |C_M #0#2, 1, "N";
         |C_M #0#3, 1, "N";
         |C_M #0#4, 1, "N";
         |C_M #0#5, 1, "N";
         |C_M #0#6, 1, "N";
         |C_M #0#8, 1, "N";
         |C_M #0#9, 1, "N";
         |C_M #0#10, 1, "N";
         |C_M #0#11, 1, "N";
         |C_M #0#13, 1, "N";
     |SINO;
         |C_M #0#2, 1, "S";
         |C_M #0#3, 1, "S";
         |C_M #0#4, 1, "S";
         |C_M #0#5, 1, "S";
         |C_M #0#6, 1, "S";
         |C_M #0#8, 1, "S";
         |C_M #0#9, 1, "S";
         |C_M #0#10, 1, "S";
         |C_M #0#11, 1, "S";
         |C_M #0#13, 1, "S";
     |FINSI;
|FPRC;

|RUTINA ClaveBaja3;
     |SI FSalida = "POSICION";  |Y enTipoDedu ! 99;
         #3#1 = enTipoDedu;
         |ACABA;
     |FINSI;
     #3#0 = #2#0;
     #3#1 = 1;
|FRUT;

|RUTINA ClaveAlta3;
     #3#0 = #2#0;
     #3#1 = 99;
|FRUT;

|PROCESO Consulta;
     |PUSHV 0501 2380;

     |PINPA #0#2;
     |PINDA #0#2;
     |ENTLINEAL #1#3, 2, 4, 16, 0, ClaveBaja3, ClaveAlta3;
     #0#4 = #3#1;

     |POPV;
|FPRC;

|PROCESO ConsuTipo;
     nTecla     = FSalida;
     enTipoDedu = #0#4;
     |ABRE #4;
     #4#0 = #0#0;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;

     |ABRE #5;
     #5#0 = #4#12;
     |LEE 040#5=;
     |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;
     |CIERRA #5;

     |ABRE #2;
     #2#0 = #5#3;
     |LEE 040#2=;
     |SI FSalida = 0;
         |SI nTecla = 9;  |HAZ Consulta;  |FINSI;
     |FINSI;
     |CIERRA #2;

     #0#4 = enTipoDedu;

     |ABRE #3;
     #3#0 = #2#0;
     #3#1 = #0#4;
     |LEE 040#3=;
     |SI FSalida ! 0;
         |MENAV "        Deduccion inexistente en la Comunidad.";
         |ERROR;
         |CIERRA #3;
         |ACABA;
     |FINSI;
     |CIERRA #3;

     #0#5 = #3#2;

     |SI #3#5 = "S";
         |C_M #0#15, 1, "S";
         |C_M #0#16, 1, "N";   #0#16 = 0;  |PINTA #0#16;
     |FINSI;

     |SI #3#5 = "N";
         |C_M #0#15, 1, "N";   #0#15 = 0;  |PINTA #0#15;
         |C_M #0#16, 1, "N";   #0#16 = 0;  |PINTA #0#16;
     |FINSI;

     |SI #3#5 = "I";
         |C_M #0#15, 1, "N";   #0#15 = 0;  |PINTA #0#15;
     |FINSI;

     |SI #3#1 = 99;
         |MENAV "         La Comunidad no tiene deducciones";
         |PTEC  807;
         |ACABA;
     |FINSI;

     |PINTA #0#4;
     |PINTA #0#5;
|FPRC;

|PROCESO Deduccion;
     |SI #3#5 ! "I";  |ACABA;  |FINSI;

     |SI #0#4 = 9;   #0#6 = #0#16 % 10;  |FINSI;
     |SI #0#4 = 19;  #0#6 = #0#16 % 2;   |FINSI;
     |SI #0#4 = 20;  #0#6 = #0#16 % 10;  |FINSI;
     |SI #0#4 = 17;  #0#6 = #0#16 % 17;  |FINSI;
     |SI #0#4 = 18;  #0#6 = #0#16 % 18;  |FINSI;

     |PINTA #0#6;
|FPRC;

|RUTINA ClaveBaja;
     #0#0 = empresa;
     #0#1 = 1;
|FRUT;

|RUTINA ClaveAlta;
     #0#0 = empresa;
     #0#1 = 99;
|FRUT;

|PROGRAMA;
     |PINPA #0#0;
     |SI modo = 1;  |ENTLINEAL #1#0, 2, 1, 15, 0, ClaveBaja, ClaveAlta;  |FINSI;
     |SI modo = 2;  |ENTLINEAL #1#0, 2, 2, 15, 0, ClaveBaja, ClaveAlta;  |FINSI;
     |SI modo = 4;  |ENTLINEAL #1#0, 2, 4, 15, 0, ClaveBaja, ClaveAlta;  |FINSI;
|FPRO;
