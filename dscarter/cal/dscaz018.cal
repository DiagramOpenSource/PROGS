|FICHEROS;
   dscaz018 #0;

   dscam021 #1;
   dscam022 #2;

   dscam008 #3;
   dscam014 #4;

   dscam030 #5;
   dscaw013 #6;
   dscam009 #7;
   dscam051 #8;
   dscam072 #9;
   dscam067 #10;
   dscaw172 #11;

   dscaw185 #20;
   dscaw200 #21;
   dscaw201 #22;
   dscaw208 #28;

   &agif112@ #100;
   &caclipr@ #101;
   &canempr@ #102;

   gestr000@ #1000;
   gestr149@ #1001;
   gestr150@ #1002;
|FIN;

|VARIABLES;

   &prov   = "";
   &des    = "";
   &letra1 = "";
   &letra2 = "";

   &HayGestion  = 1;
   &HayConta    = 1;
   &Divisa      = "";
   &eaCodigo    = "";
   &eaTipoCod   = "";
   &aCuenta     = "";
   &eaNif       = "";
   &eaNombre    = "";
   &eaNomFisc   = "";
   &eaApCorreos = "";
   &eaDireccion = "";
   &eaPoblacion = "";
   &eaProvincia = "";
   &eaCP        = "";
   &eaCP1       = "";
   &eaCP2       = "";
   &eaTelefono  = "";
   &eaMesLetra  = "";
   &eaMesLetra1 = "";
   &eaImporte   = "";
   &EURO        = 0;
   &EURODB      = 0;
   &EURODV      = 0;
   &Fichero   = "";  &Cmp = "";   &Tipo = ""; &CmpNum = 0;
   &aInforme  = "";
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = "";
   &enDocumento = 0;

   nContPag    = 0;
   aAntCodProv = "";
   aCodProv    = "";

   nSwPrimero    = 0;
   aProvAnt      = "";
   nEmprCart     = 0;

   Cuenta = ""; Nivel = 0; aImp = ""; nSwImpre = 0;
   aAlfa1 = "";
   aAlfa2 = "";
   aSw    = "";

   nNumDoc  = 0;
   nSwInfor = 0;

   DReimp = ""; HReimp = "";
   SwCambia = 0;

   aImpresAnt = "";
   aAlfa = ""; aDecs = ""; nCalc = 0;
   Comodin = ""; Comodin1 = "";
   aLong = "";   nLong = 0; nNume = 0;
   LinPag = 0; Calc = 0; nCont = 0; SwCambio = 0;
   impletra = "";
   Long = ""; LongNum = 0;
   lleno = 0; traba = ""; traba1 = "";
   cincue = "--------------------------------------------------------------";
   nArriba = 0; aArriba = "146";
   nAbajo  = 0; aAbajo  = "153";
   nume = 0; nume1 = 0; nNum = 0;
   nSwHay = 0;

   Salir = 0; Opcion = 0;

   &CambioDivCm  = 0; &CambioDivVn  = 0;
   &CambioBaseCm = 0; &CambioBaseVn = 0;

{-1}Menu  = "";
    Menu1 = "2400";
    Menu2 = "1";
    Menu3 = "";
    Menu4 = "REC";
    Menu5 = " Revisar ";
    Menu6 = " Enlazar ";
    Menu7 = " Cancelar ";

   &enSwDesg = 0;
   &eaSerie   = "";
   &enFactura = 0;
   &efFecEmis = @;
   &efFecVto  = @;
   &eaRefere  = "";
   &eaEncab   = "";

   nSw185     = 0;
   nSwViuda   = 0;

   fFecha     = @;
|FIN;

|PROCESO ContPags;
   nContPag = nContPag + 1;

   |SI nContPag > 1; nSw185 = 1; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE ContPags;
#dscaw208#1;
;
aCodProv, 00000;
aCodProv, 99999;
;
NULL,ContPags;
|FIN;

|PROCESO ActualRecibo;
   Divisa = #dscam022#20; |HAZ TomaDecim;
   #dscam009#14 = #dscam022#13;
   #dscam009#3  = 1;
   |LEE 000#dscam009.=;
   |SI FSalida = 0;
      |PARA; |SI FSalida = 0; |Y #dscam009#14 = #dscam022#13; |HACIENDO;
         LinPag = #dscam009#3 + 1;
         |LEE 000#dscam009.s;
      |SIGUE;
   |SINO;
      LinPag = 1;
   |FINSI;

   #dscam008#40 = #dscam022#13;
   |LEE 101#dscam008.=;
   |SI FSalida = 0;
      |DDEFECTO #dscam009;
      #dscam009#14 = #dscam022#13;
      #dscam009#3  = LinPag;
      #dscam009#0  = #dscam008#0;
      #dscam009#1  = #dscam008#1;
      #dscam009#2  = #dscam008#2;
      |GRABA 020#dscam009.b;
      #dscam009#4  = #dscam021#10;
      #dscam009#5  = "PPA";
      #dscam009#6  = #dscam021#1;
      #dscam009#7  = #dscam008#23;
      #dscam009#8  = #dscam022#7;
      #dscam009#13 = #dscam008#27;
      #dscam009#20 = #dscam008#57;
      #dscam009#21 = #dscam022#19;
      #dscam009#25 = CambioDivCm;
      Calc = CambioDivCm - #dscam022#22;
      #dscam009#26 = #dscam009#8 * Calc;
      |GRABA 020#dscam009.a;
      |LIBERA #dscam009

      #dscam008#23 = #dscam008#23 + #dscam009#8;
      #dscam008#57 = #dscam008#57 + #dscam009#21;
      #dscam008#62 = #dscam008#62 + #dscam009#26;
      #dscam008#25 = #dscam008#22 + #dscam008#24 + #dscam008#38;
      #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55 + #dscam008#62;
      #dscam008#31 = #dscam008#25 - #dscam008#23;
      #dscam008#58 = #dscam008#56 - #dscam008#57;
      |SI #dscam008#23 = 0;
         #dscam008#39 = " "; #dscam008#47 = "";
         #dscam008#14 = "P";
         #dscam008#15 = "Pendiente de pago";
      |SINO;
         |SI #dscam008#17 = 0;
            #dscam008#14 = "E";
            |SI #dscam008#39 = "P"; #dscam008#15 = "Englobado en pagare  "; |FINSI;
            |SI #dscam008#39 = "C"; #dscam008#15 = "Englobado en confirme"; |FINSI;
            |SI #dscam008#39 = "T"; #dscam008#15 = "Englobado en talon   "; |FINSI;
         |FINSI;
         |SI #dscam008#31 = 0;
            #dscam008#14 = "L";
            #dscam008#15 = "Recibo liquidado";
         |SINO;
            #dscam008#14 = "C";
            #dscam008#15 = "Parcialmente pagado";
         |FINSI;
      |FINSI;

      |GRABA 020#dscam008.a; |LIBERA #dscam008;
   |FINSI;
|FPRC;

|PROCESO LeeProv;
   #dscam022#0 = #dscam021#0;
   #dscam022#1 = 1;
   |LEE 010#dscam022.];
   |SI FSalida = 0; |Y #dscam022#0 = #dscam021#0;
      des = #dscam022#10;

      #dscam008#40 = #dscam022#13;
      |LEE 000#dscam008.=;
      |SI FSalida ! 0; |DDEFECTO #dscam008; |FINSI;

      |HAZ LeeDatosProv;
   |FINSI;
|FPRC;

|PROCESO SacaNivel1;
   Comodin = Cuenta; |QBF Comodin;
   aLong = Comodin % 0; nLong = aLong;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 1"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; Nivel = 1; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 2"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; Nivel = 2; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 3"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; Nivel = 3; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 4"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; Nivel = 4; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 5"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; Nivel = 5; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 6"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; Nivel = 6; |FINSI;
|FPRC;

|PROCESO LeeDatosProv;
   enDocumento = #dscam008#40;
   eaCodigo = #dscam008#32; eaTipoCod = "P"; aCuenta = #dscam008#5; |HAZ LeeDatos;
|FPRC;

|PROCESO DesglosaLiq;
   |SALVA_DATOS #gestr149@; |REPON_DATOS #dscaw200;
   |SALVA_DATOS #gestr150@; |REPON_DATOS #dscaw201;

   |PRINT;
|FPRC;

|DEFBUCLE DesglosaLiq;
#gestr150@#1004;
;
#gestr149@#0, #gestr149@#1, #gestr149@#2, 001;
#gestr149@#0, #gestr149@#1, #gestr149@#2, 999;
;
NULL, DesglosaLiq;
|FIN;

|PROCESO PagareDet;
   #dscam008#40  = #dscam022#13;
   |LEE 101#dscam008.=;
   |SI FSalida = 0;
      Divisa = #dscam022#20; |HAZ TomaDecim;
      des = #dscam022#10;
      |HAZ LeeDatosProv;
      Comodin = #dscam021#2; |QBF Comodin;
      Comodin = Comodin % 0402; nNum = Comodin;
      |HAZ MesLetra; eaMesLetra = aAlfa;
      |SI #dscaz018#4 = "C"; |O #dscaz018#4 = "A";
         |HAZ EsViuda;
         |SI FSalida ! 0;
         ||SI nSwViuda ! 1;
            enSwDesg = 0; |PRINT;
         |SINO;
            || Primero tengo que ver si el pagare es de un recibo que proviene de
            ||    una liquidacion. Para ello busco en el fichero gestr149 de
            ||    gesenvia el registro que tenga el campo 9 = S, el campo 4 sea
            ||    la empresa de cartera y el campo 10 el documento que estamos
            ||    comprobando. Si lo encuentro es de una liquidacion.
            |DBASS aAlfa; |QBF aAlfa;
            aAlfa = aAlfa + "gesenvia/def/gestr149.mas";
            |CARGA_DEF aAlfa, gestr149@;
            |SI FSalida = 0;
               |DBASS aAlfa; |QBF aAlfa;
               aAlfa = aAlfa + "gesenvia/def/gestr150.mas";
               |CARGA_DEF aAlfa, gestr150@;

               |DBASS aAlfa; |QBF aAlfa;
               aAlfa = aAlfa + "gesenvia/fich/" + (("00000" + #48#15) % -105) + "/";
               |PATH_DAT #gestr149@#aAlfa#; |PATH_DAT #gestr150@#aAlfa#;
               |ABRE #gestr149@; |ABRE #gestr150@;

               |SI #dscam008#69 = "S";
                  nNumDoc = #dscam008#70;
               |SINO;
                  nNumDoc = #dscam008#40;
               |FINSI;
               |SELECT #2#gestr149@;
               #gestr149@#4  = nEmprCart;
               #gestr149@#9  = "S";
               #gestr149@#10 = nNumDoc;
               |LEE 000#gestr149@.=;
               |SI FSalida = 0;
                  enSwDesg  = 1;
                  || Si proviene de una liquidacion, leo el fichero de liquidaciones
                  ||    y saco todo lo que debo emitir desde ah¡
                  |SI nSwInfor < 0;
                     |ABRE #dscam072;
                     #dscam072#0 = #dscam021#6;
                     |LEE 000#dscam072.=;
                     |SI FSalida = 0
                        aInforme = #dscam072#3; |QBF aInforme;
                        |SI aInforme = "";
                           aInforme = "Carta emision de pagares"; |HAZ ObtenInforme;
                        |FINSI;
                     |SINO;
                        aInforme = "Carta emision de pagares"; |HAZ ObtenInforme;
                     |FINSI;
                     |CIERRA #dscam072;

                     nSwInfor = 1;
                     |INFOR aInforme;
                  |FINSI;

                  |BUCLE DesglosaLiq;
               |SINO;
                  enSwDesg  = 0;
                  |SI nSw185 = 1;
                     || Si no proviene de una liquidacion, en vez de la emision normal
                     ||    grabo en un temporal para emitir un listado por proveedor
                     ||    (no por pagar) que detalle los efectos que se han incluido
                     ||    en los pagars que se est n emitiendo y por cada efecto,
                     ||    que pagares se han emitido
                     #dscaw185#0 = #dscam022#8;
                     #dscaw185#1 = #dscam008#63;
                     #dscaw185#2 = #dscam022#0;
                     |LEE 101#dscaw185.=;
                     |SI FSalida ! 0;
                        |DDEFECTO #dscaw185;
                        #dscaw185#0 = #dscam022#8;
                        #dscaw185#1 = #dscam008#63;
                        #dscaw185#2 = #dscam022#0;
                        #dscaw185#3 = #dscam008#4;
                        #dscaw185#4 = #dscam021#1;
                        #dscaw185#5 = #dscam021#2;
                        #dscaw185#7 = #dscam021#16;
                        |GRABA 020#dscaw185.b;
                     |FINSI;
                     #dscaw185#6 = #dscaw185#6 + #dscam022#7;
                     #dscaw185#8 = #dscaw185#8 + #dscam008#25;
                     |GRABA 020#dscaw185.a; |LIBERA #dscaw185;
                  |SINO;
                     enSwDesg = 0; |PRINT;
                  |FINSI;
               |FINSI;
               |CIERRA #gestr150@; |DESCARGA_DEF #gestr150@;
               |CIERRA #gestr149@; |DESCARGA_DEF #gestr149@;
            |FINSI;
         |FINSI;
      |FINSI;

      |SI #dscam008#48 = "N";
         #dscam008#48 = "S";
         |GRABA 020#dscam008.a;
         ||HAZ ActualRecibo;
      |FINSI;
      ||SI #dscam021#7 = "N";
         ||HAZ ActualRecibo;
      ||FINSI;
      |SI #dscam051#71 = "E";
         |SI #dscam051#72 = "E"; #dscam008#26 = #dscam021#1; |FINSI;
         |SI #dscam051#72 = "V"; #dscam008#26 = #dscam021#2; |FINSI;
         |SI #dscam051#72 = " "; #dscam008#26 = ~;           |FINSI;
         |GRABA 020#dscam008.a;
      |FINSI;

      |LIBERA #dscam008;
   |FINSI;
|FPRC;

|DEFBUCLE PagareDet;
#dscam022#1;
;
#dscam021#0,001;
#dscam021#0,999;
;
NULL,PagareDet;
|FIN;

|PROCESO Pagares1;
   SwCambia = 0;
   |SI #dscaz018#8 = "S";
      |SI #dscam021#7 = "N"; |ACABA; |FINSI;
      |SI #dscam021#7 = "C"; |Y aSw = "P"; |ACABA; |FINSI;
      |SI #dscam021#7 = "P"; |Y aSw = "C"; |ACABA; |FINSI;
   |SINO;
      |SI #dscam021#7 ! "N";
         |SI aSw = "P"; |ACABA; |FINSI;
         |SI aSw = "C";
            #dscaw172#0 = #dscam021#0;
            |LEE 000#dscaw172.=;
            |SI FSalida ! 0; |ACABA; |FINSI;
         |FINSI;
      |SINO;
         |SI aSw = "P";
            |DDEFECTO #dscaw172;
            #dscaw172#0 = #dscam021#0;
            |GRABA 020#dscaw172.n;
         |FINSI;
      |FINSI;
   |FINSI;

   nSwHay = 1;

   |SI aSw = "C";
      |SI #dscam021#18 ! "EUR";
         EURO   = 166.386;
         EURODB = 2; EURODV = 0;
      |SINO;
         EURO   = 0.0061;
         EURODB = 0; EURODV = 2;
      |FINSI;
      #dscam021#23 = #dscam021#9;

      #dscam014#0 = #dscam021#3;
      |LEE 000#dscam014.=;

      Comodin = #dscam021#2; |QBF Comodin;
      Comodin = Comodin % 0402; nNum = Comodin; |HAZ MesLetra; eaMesLetra = aAlfa;
      Comodin = #dscam021#1; |QBF Comodin;
      Comodin = Comodin % 0402; nNum = Comodin; |HAZ MesLetra; eaMesLetra1 = aAlfa;

      Divisa = #dscam021#18; |HAZ TomaDecim;
      |HAZ pasaaletra; |HAZ LeeProv;

      |SI nSwViuda = 1;
         #dscam022#0 = #dscam021#0;
         #dscam022#1 = 1;
         |LEE 000#dscam022.];
         |SI FSalida ! 0; |DDEFECTO #dscam022; |FINSI;
         aCodProv = #dscam022#8;

         nSw185 = 0; nContPag = 0; |BUCLE ContPags;
         |SI nSw185 ! 1;
            |ABRE #dscam072;
            #dscam072#0 = #dscam021#6;
            |LEE 000#dscam072.=;
            |SI FSalida = 0
               aInforme = #dscam072#3; |QBF aInforme;
               |SI aInforme = "";
                  aInforme = "Carta emision de pagares"; |HAZ ObtenInforme;
               |FINSI;
            |SINO;
               aInforme = "Carta emision de pagares"; |HAZ ObtenInforme;
            |FINSI;
            |CIERRA #dscam072;

            |INFOR aInforme;
            |SI FSalida ! 0; |ACABA; |FINSI;
            nSwInfor = 1;
         |SINO;
            nSwInfor = -1;
         |FINSI;
      |SINO;
         |ABRE #dscam072;
         #dscam072#0 = #dscam021#6;
         |LEE 000#dscam072.=;
         |SI FSalida = 0
            aInforme = #dscam072#3; |QBF aInforme;
            |SI aInforme = "";
               aInforme = "Carta emision de pagares"; |HAZ ObtenInforme;
            |FINSI;
         |SINO;
            aInforme = "Carta emision de pagares"; |HAZ ObtenInforme;
         |FINSI;
         |CIERRA #dscam072;

         |INFOR aInforme;
         |SI FSalida ! 0; |ACABA; |FINSI;
         nSwInfor = 1;
      |FINSI;

      |BUCLE PagareDet;

      |SI nSwInfor = 1; |PIEINF; |FININF; |FINSI;
   |FINSI;

   |SI aSw = "P";
      |ABRE #dscam072;
      #dscam072#0 = #dscam021#6;
      |LEE 000#dscam072.=;
      |SI FSalida = 0
         aInforme = #dscam072#2; |QBF aInforme;
      |SINO;
         aInforme = "Emision de pagares"; |HAZ ObtenInforme;
      |FINSI;
      |CIERRA #dscam072;

      Comodin = #dscam021#2; |QBF Comodin;
      Comodin = Comodin % 0402; nNum = Comodin; |HAZ MesLetra; eaMesLetra = aAlfa;
      Comodin = #dscam021#1; |QBF Comodin;
      Comodin = Comodin % 0402; nNum = Comodin; |HAZ MesLetra; eaMesLetra1 = aAlfa;

      Divisa = #dscam021#18; |HAZ TomaDecim;
      |HAZ pasaaletra; |HAZ LeeProv;

      |INFOR aInforme;
      |SI FSalida = 0;
         |PRINT;
         |PIEINF; |FININF;
      |SINO;
         aAlfa = "    El informe " + aInforme + " no se encuentra";
         |MENAV aAlfa;
      |FINSI;
      |SI #dscaz018#8 = "N";
         |SI #dscam051#101 = "S";
            #dscam021#16 = (("0"*15) + #dscaz018#9) % -115;
         |FINSI;
         #dscaz018#9 = #dscaz018#9 + 1;
      |SINO;
         #dscaz018#9 = #dscam021#16;
      |FINSI;
   |FINSI;

   |SI SwCambia = 1; #dscaz018#4 = "A"; |FINSI;
   SwCambia = 0;

   |SI #dscaz018#8 = "N";
      aImpresAnt = #dscam021#7;
      |SI #dscam021#7 = "N";
         #dscam021#7 = aSw;
      |SINO;
         |SI #dscam021#7 = "C"; |Y aSw = "P"; #dscam021#7 = "A"; |FINSI;
         |SI #dscam021#7 = "P"; |Y aSw = "C"; #dscam021#7 = "A"; |FINSI;
      |FINSI;
   |FINSI;
   |GRABA 020#dscam021.a; |LIBERA #dscam021;

   eaUsuario = Usuario % 0810;
   eaDescr   = "EMISION PAGARE (" + (("00000" + #dscam021#0) % -105) + ")";
   eaTipoReg = "PA";  eaNumero = ("00000" + #dscam021#0) % -105;
   eaTipoOp  = "E";   enImpAct = #dscam021#9; enImpAnt = #dscam021#9;
   |HAZ GrabaAudit;

|FPRC;

|DEFBUCLE Pagares1;
#dscam021#1;
2,3;
#dscaz018#0,#dscaz018#2,#dscaz018#10;
#dscaz018#1,#dscaz018#3,#dscaz018#11;
be;
NULL,Pagares1;
|FIN;

|PROCESO Pagares;
   SwCambia = 0;
   |SI #dscaz018#8 = "S";
      |SI #dscam021#7 = "N";         |ACABA; |FINSI;
      |SI #dscaz018#4 ! "A"; |Y #dscaz018#4 ! "S";
         |SI #dscam021#7 ! "A";
            |SI #dscam021#7 ! #dscaz018#4; |ACABA; |FINSI;
         |FINSI;
      |FINSI;
   |SINO;
      |SI #dscaz018#4 = "A";
         |SI #dscam021#7 = "S"; |ACABA; |FINSI;
         |SI #dscam021#7 = "A"; |ACABA; |FINSI;
         |SI #dscam021#7 = "C"; SwCambia = 1; #dscaz018#4 = "P"; |FINSI;
         |SI #dscam021#7 = "P"; SwCambia = 1; #dscaz018#4 = "C"; |FINSI;
      |SINO;
         |SI #dscam021#7 = #dscaz018#4; |ACABA; |FINSI;
         |SI #dscam021#7 = "A"; |O #dscam021#7 = "S";         |ACABA; |FINSI;
      |FINSI;
   |FINSI;

   |SI #dscam021#18 ! "EUR";
      EURO   = 166.386;
      EURODB = 2; EURODV = 0;
   |SINO;
      EURO   = 0.0061;
      EURODB = 0; EURODV = 2;
   |FINSI;
   #dscam021#23 = #dscam021#9;

   #dscam014#0 = #dscam021#3;
   |LEE 000#dscam014.=;

   Comodin = #dscam021#2; |QBF Comodin;
   Comodin = Comodin % 0402; nNum = Comodin; |HAZ MesLetra; eaMesLetra = aAlfa;
   Comodin = #dscam021#1; |QBF Comodin;
   Comodin = Comodin % 0402; nNum = Comodin; |HAZ MesLetra; eaMesLetra1 = aAlfa;

   Divisa = #dscam021#18; |HAZ TomaDecim;
   |HAZ pasaaletra; |HAZ LeeProv;

   |SI #dscaz018#4 = "C"; |O #dscaz018#4 = "A";
      |ABRE #dscam072;
      #dscam072#0 = #dscam021#6;
      |LEE 000#dscam072.=;
      |SI FSalida = 0
         aInforme = #dscam072#3; |QBF aInforme;
         |SI aInforme = "";
            aInforme = "Carta emision de pagares"; |HAZ ObtenInforme;
         |FINSI;
      |SINO;
         aInforme = "Carta emision de pagares"; |HAZ ObtenInforme;
      |FINSI;
      |CIERRA #dscam072;

      |INFOR aInforme;
      |SI FSalida ! 0; |ACABA; |FINSI;
   |FINSI;

   |BUCLE PagareDet;

   |SI #dscaz018#4 = "C"; |O #dscaz018#4 = "A";
      |PIEINF; |FININF;
   |FINSI;
   |SI #dscaz018#4 = "P"; |O #dscaz018#4 = "A";
      |ABRE #dscam072;
      #dscam072#0 = #dscam021#6;
      |LEE 000#dscam072.=;
      |SI FSalida = 0
         aInforme = #dscam072#2; |QBF aInforme;
      |SINO;
         aInforme = "Emision de pagares"; |HAZ ObtenInforme;
      |FINSI;
      |CIERRA #dscam072;

      |INFOR aInforme;
      |SI FSalida = 0;
         |PRINT;
         |PIEINF;
         |FININF;
      |SINO;
         aAlfa = "    El informe " + aInforme + " no se encuentra";
         |MENAV aAlfa;
      |FINSI;
   |FINSI;
   |SI SwCambia = 1; #dscaz018#4 = "A"; |FINSI;
   SwCambia = 0;

   |SI #dscaz018#8 = "N";
      |SI #dscam051#101 = "S";
         #dscam021#16 = (("0"*15) + #dscaz018#9) % -115;
      |FINSI;
      #dscaz018#9 = #dscaz018#9 + 1;
   |SINO;
      #dscaz018#9 = #dscam021#16;
   |FINSI;
   |SI #dscaz018#8 = "N";
      aImpresAnt = #dscam021#7;
      |SI #dscam021#7 = "N";
         #dscam021#7 = #dscaz018#4;
      |SINO;
         |SI #dscaz018#4 = "A";                       #dscam021#7 = "A"; |FINSI;
         |SI #dscam021#7 = "C"; |Y #dscaz018#4 = "P"; #dscam021#7 = "A"; |FINSI;
         |SI #dscam021#7 = "P"; |Y #dscaz018#4 = "C"; #dscam021#7 = "A"; |FINSI;
      |FINSI;
   |FINSI;
   |GRABA 020#dscam021.a; |LIBERA #dscam021;

   eaUsuario = Usuario % 0810;
   eaDescr   = "EMISION PAGARE (" + (("00000" + #dscam021#0) % -105) + ")";
   eaTipoReg = "PA";  eaNumero = ("00000" + #dscam021#0) % -105;
   eaTipoOp  = "E";   enImpAct = #dscam021#9; enImpAnt = #dscam021#9;
   |HAZ GrabaAudit;

|FPRC;

|DEFBUCLE Pagares;
#dscam021#1;
2,3;
#dscaz018#0,#dscaz018#2,#dscaz018#10;
#dscaz018#1,#dscaz018#3,#dscaz018#11;
be;
NULL,Pagares;
|FIN;

|PROCESO ContPagares;
   |SI HayConta = 1; |Y #dscam051#1 = "S";
      |DDEFECTO #dscam067;
      #dscam067#0 = "PA";
      #dscam067#1 = #dscam021#0;
      #dscam067#2 = "1";
      #dscam067#3 = "E";
      |LEE 000#dscam067.];
      |SI FSalida = 0; |Y #dscam067#0 = "PA";
         aAlfa1 = #dscam067#1; |QBF aAlfa1;
         aAlfa2 = #dscam021#0; |QBF aAlfa2;
         |SI aAlfa1 = aAlfa2;
            aAlfa1  = #dscam067#3; |QBF aAlfa1;
            |SI aAlfa1 = "E";
               ||SI #dscam067#10 ! #dscaz018#5; |CIERRA #dscam067; |ACABA; |FINSI;
               |ACABA;
            |FINSI;
         |FINSI;
      |FINSI;

      #dscam030#0 = #dscaz018#5;
      |LEE 010#dscam030.=;
      |SI FSalida = 0;
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #6 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         |DDEFECTO #dscaw013;
         #dscaw013#0  = 1;            #dscaw013#15 = #dscaz018#5;
         #dscaw013#5  = #dscam021#0;  #dscaw013#6  = #dscam021#0;
         #dscaw013#11 = "N";          #dscaw013#12 = 5;
         #dscaw013#13 = "dscam022";   #dscaw013#14 = 0;
         |GRABA 020#dscaw013.n;
         |CIERRA #dscaw013;

         Comodin = #dscaz018#5;
         Comodin = "dscam033.tab;" + Comodin + ",E";
         |LIBERA #dscam021; |CIERRAT #dscam021;
         |LIBERA #dscam022; |CIERRAT #dscam022;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam021; |LEE 101#dscam021.=;
         |ABRET #dscam022; |LEE 101#dscam022.=;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE ContPagares;
#dscam021#1;
2,3;
#dscaz018#0,#dscaz018#2,#dscaz018#10;
#dscaz018#1,#dscaz018#3,#dscaz018#11;
be;
NULL,ContPagares;
|FIN;

|PROCESO PonComas;
   Comodin = eaImporte; |QBF Comodin;
   Comodin = Comodin - ".";
   |SI FSalida ! 0;
      nCalc = FSalida + 98;
      aDecs = Comodin % nCalc;
      nCalc = 100 + (((FSalida / 100) ! 0) - 1);
      Comodin = Comodin % nCalc;
   |SINO;
      aDecs = "00";
   |FINSI;

   Comodin1 = "";
   aLong = Comodin % 0; nLong = aLong;
   |PARA; |SI nLong > 3; |HACIENDO;
      Comodin1 = ("." + (Comodin % -103)) + Comodin1;
      Calc = 100 + (nLong - 3);
      Comodin = Comodin % Calc;
      aLong = Comodin % 0; nLong = aLong;
   |SIGUE;
   eaImporte = Comodin + Comodin1;
   aLong = aDecs % 0; nLong = aLong;
   |SI nLong = 1; aDecs = aDecs + "0"; |FINSI;
   |SI aDecs ! "";
      eaImporte = eaImporte + "," + aDecs;
   |FINSI;
|FPRC;

|PROCESO pasaaletra;
  eaImporte = #dscam021#9; |QBF eaImporte; |HAZ PonComas;
  eaImporte = "#" + eaImporte + "#";

  impletra = #dscam021#9;
  aAlfa = impletra - ".";
  |SI FSalida ! 0;
     nNume = FSalida + 98;
     aAlfa = aAlfa % nNume;
     aLong = aAlfa % 0; nLong = aLong;
     |SI nLong = 1; impletra = impletra + "0"; |FINSI;
  |FINSI;

  |SI #dscam021#18 = "EUR"; impletra = "E" + impletra; |FINSI;
  |LETRA impletra;
  Long = impletra % 0;  LongNum = Long;
  |SI LongNum > 48;
     |PARA nCont = 48; |SI nCont > 0; |HACIENDO nCont = nCont - 1;
        Calc = (nCont * 100) + 1;
        Comodin = impletra % Calc;
        |SI Comodin = " ";
           Calc = 100 + nCont;        letra1 = impletra % Calc; |QBF letra1;
           Long = letra1 % 0; LongNum = Long; LongNum = 48 - LongNum;
           letra1 = ("-" * LongNum) + " " + letra1
           Calc = (nCont * 100) + 99; letra2 = impletra % Calc; |QBF letra2;
           Long = letra2 % 0; LongNum = Long; LongNum = 48 - LongNum;
           letra2 = letra2 + " " + ("-" * LongNum);
           |SAL;
        |FINSI;
     |SIGUE;
  |SINO;
     letra1 = impletra;
     Long = letra1 % 0; LongNum = Long; LongNum = 48 - LongNum;
     letra1 = letra1 + " " + ("-" * LongNum);
     letra2 = "-" * 48;
  |FINSI;
|FPRC;

|RUTINA infe1;
   #dscaw013#0 = 001;
   #dscaw013#15 = #dscaz018#5;
   #dscaw013#17 = "S";
|FRUT;

|RUTINA supe1;
   #dscaw013#0 = 999;
   #dscaw013#15 = #dscaz018#5;
   #dscaw013#17 = "S";
|FRUT;

|PROCESO MesLetra;
   |SI nNum = 1;  aAlfa = "Enero     "; |FINSI;
   |SI nNum = 2;  aAlfa = "Febrero   "; |FINSI;
   |SI nNum = 3;  aAlfa = "Marzo     "; |FINSI;
   |SI nNum = 4;  aAlfa = "Abril     "; |FINSI;
   |SI nNum = 5;  aAlfa = "Mayo      "; |FINSI;
   |SI nNum = 6;  aAlfa = "Junio     "; |FINSI;
   |SI nNum = 7;  aAlfa = "Julio     "; |FINSI;
   |SI nNum = 8;  aAlfa = "Agosto    "; |FINSI;
   |SI nNum = 9;  aAlfa = "Septiembre"; |FINSI;
   |SI nNum = 10; aAlfa = "Octubre   "; |FINSI;
   |SI nNum = 11; aAlfa = "Noviembre "; |FINSI;
   |SI nNum = 12; aAlfa = "Diciembre "; |FINSI;
|FPRC;

|PROCESO MiraMarca;
   |SI #dscaz018#8 = "S"; |O #dscam051#101 = "N";
      #dscaz018#9 = 0; |PINTA #dscaz018#9;
      |C_M #dscaz018#9,1,"N";
   |SINO;
      |C_M #dscaz018#9,1,"S";
   |FINSI;
|FPRC;

|PROCESO MiraParam; |TIPO 7;
   |SI #dscam051#1 = "S";
      Comodin = #dscam051#61;
      |C_M #dscaz018#5,1,Comodin;
   |SINO;
      |C_M #dscaz018#5,1,"N";
   |FINSI;
|FPRC;

|PROCESO ListadoProv;
   |SI #dscaw185#0 ! aProvAnt;
      aProvAnt = #dscaw185#0;
      |SI nSwPrimero = 1;
         nSwPrimero = 0;
      |SINO;
         |PIEINF;
      |FINSI;
   |FINSI;

   enDocumento = 0;
   aAlfa = #dscaw185#0; |QBF aAlfa;
   aCuenta  = #dscaw185#0; eaCodigo = "";
   eaTipoCod = "P";|HAZ LeeDatos;

   |PRINT;
|FPRC;

|DEFBUCLE ListadoProv;
#dscaw185#1;
;
INICIO;
FINAL;
;
NULL, ListadoProv;
|FIN;

|PROCESO LineasPag;
   #dscaw208#0 = #dscam022#8;
   #dscaw208#1 = #dscam022#0;
   |LEE 000#dscaw208.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscaw208;
      #dscaw208#0 = #dscam022#8;
      #dscaw208#1 = #dscam022#0;
      |GRABA 020#dscaw208.n;
   |FINSI;
|FPRC;

|DEFBUCLE LineasPag;
#dscam022#1;
;
#dscam021#0, 000;
#dscam021#0, 999;
;
NULL, LineasPag;
|FIN;

|PROCESO TomaProvs;
   |BUCLE LineasPag;
|FPRC;

|DEFBUCLE TomaProvs;
#dscam021#1;
2,3;
#dscaz018#0,#dscaz018#2,#dscaz018#10;
#dscaz018#1,#dscaz018#3,#dscaz018#11;
;
NULL,TomaProvs;
|FIN;

|PROGRAMA;
   |DFICE aAlfa; |QBF aAlfa;
   aAlfa = aAlfa % -106; aAlfa = aAlfa % 0105;
   nEmprCart     = aAlfa;

   |CLS;
   |CABEZA "Emision de pagares";

   |HAZ Tipo8;

   |ABRE #dscam051;
   |LEE 101#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |SI #dscam051#101 = " "; #dscam051#101 = "S"; |FINSI;
      |GRABA 020#dscam051.n;
   |SINO;
      |SI #dscam051#101 = " ";
         #dscam051#101 = "S";
         |GRABA 020#dscam051.a;
      |FINSI;
   |FINSI;
   |LIBERA #dscam051; |CIERRA #dscam051;

   |DDEFECTO #dscaz018;
   |SI HayConta = 0; |O #dscam051#1 = "N";
      |C_M #dscaz018#5,1,"N";
      #dscaz018#5 = "    ";
   |SINO;
      |C_M #dscaz018#5,1,"S";
      #dscaz018#5 = #dscam051#26;
   |FINSI;

   |SI #dscam051#101 = "S";
      |C_M #dscaz018#9, 1, "S";
   |SINO;
      |C_M #dscaz018#9, 1, "N";
   |FINSI;

   |PINPA #0#0;
   |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |IMPRE 0;
      |SI FSalida ! 0; |ACABA; |FINSI;
      aImp = Impresora;

      aAlfa = "tp1" + Usuario; |NOME_DAT #dscaw185#aAlfa#;
      |DELINDEX #dscaw185; |ABRE #dscaw185;

      |ABRE #dscam008;
      |ABRE #dscam009;
      |ABRE #dscam014;
      |ABRE #dscam021;
      |ABRE #dscam022;

      |SI #dscaz018#4 = "S";
         |HAZ EsViuda;
         |SI FSalida = 0; nSwViuda = 1; |SINO; nSwViuda = 0; |FINSI;
         |SI nSwViuda = 1;
            aAlfa = "tcp" + Usuario; |NOME_DAT #dscaw208#aAlfa#;
            |DELINDEX #dscaw208; |ABRE #dscaw208;
            |BUCLE TomaProvs;
         |FINSI;

         aAlfa = "tmp" + Usuario; |NOME_DAT #dscaw172#aAlfa#;
         |DELINDEX #dscaw172; |ABRE #dscaw172;
         #dscaz018#4 = "A";
         aSw = "P"; |BUCLE Pagares1;
         |FINIMP;
         |SI nSwHay = 1;
            aAlfa = "    NEmitir las cartas de los pagares emitidos ?";
            |CONFI aAlfa;
            |SI FSalida = 0;
               Impresora = aImp;
               |IMPRE 0;
               |SI FSalida = 0;
                  aSw = "C"; |BUCLE Pagares1;
               |FINSI;
            |FINSI;
         |FINSI;
         |CIERRA #dscaw172; |DELINDEX #dscaw172;
         |SI nSwViuda = 1;
            |CIERRA #dscaw208; |DELINDEX #dscaw208;
         |FINSI;
      |SINO;
         |BUCLE Pagares;
      |FINSI;

      |SI nSwInfor ] 0;
         |PIEINF; |FININF;
      |FINSI;

      || Si hay registros en el dscaw185 es porque es el modulo de Viuda y
      ||    hay cartas de proveedores que emitir
      |LEE 000#dscaw185.p;
      |SI FSalida = 0;
         nSwPrimero = 1;
         aInforme = "Carta proveedores efectos"; |HAZ ObtenInforme;
         |SI aInforme = "Carta proveedores efectos";
            aInforme = "dscaw185";
         |FINSI;
         |INFOR aInforme;
         |SI FSalida = 0;
            aAlfa = #dscaz018#6; |QBF aAlfa;
            fFecha = #dscaz018#7; fFecha = fFecha % 2;
            aAlfa1 = fFecha % 1199; |QBF aAlfa1;
            eaEncab = aAlfa + ", " + aAlfa1;

            aProvAnt = "";
            |SI FSalida = 0; |BUCLE ListadoProv; |FINSI;
            |PIEINF; |FININF;
         |FINSI;
      |FINSI;

      |FINIMP;

      |CIERRA #dscaw185; |DELINDEX #dscaw185;

      |SI #dscaz018#8 = "N";
         |SI HayConta = 1;
            |SUB_EJECUTA_NP "dscaz169.tab;INICIO";

            |ABRE #dscam067; |ABRE #dscam030;
            |BUCLE ContPagares;
            |CIERRA #dscam067; |CIERRA #dscam030;

            |SUB_EJECUTA_NP "dscaz169.tab;FINAL";
         |FINSI;
      |FINSI;

      |CIERRA #dscam022;
      |CIERRA #dscam021;
      |CIERRA #dscam014;
      |CIERRA #dscam009;
      |CIERRA #dscam008;

   |FINSI;

   |HAZ Tipo9;
|FPRO;
