|FICHEROS;
   dscaz070 #0;

   dscam003 #10;
   dscam004 #11;
   dscam008 #20;
   dscam009 #21;
|FIN;

|VARIABLES;
   &Divisa     = "";
   &nDeci_Div  = 0;
   &nDeci_Base = 0;

   aChar    = "";
   aNombre  = "";
   aAlfa    = "";
   aAlfa1   = "";
   aIP      = "";
   aCadena1 = "";
   aCadena2 = "";

   Handle = 0;
   nDocum = 0;
|FIN;

|PROCESO MiraFichero;
   |SI FSalida = 10;
      aAlfa = "F";
      |BROWSE aAlfa;
      aAlfa = aAlfa % 0299;
      |SI aAlfa ! "";
         #dscaz070#Campo# = aAlfa;
      |FINSI;
      |ERROR;
   |FINSI;

   aAlfa = #dscaz070#Campo#; |QBF aAlfa;
   |SI aAlfa = ""; |ACABA; |FINSI;

   aIP = ""; |IP_REMOTO aIP;
   |SI aIP ! "";
      |XABRE "CE", aAlfa, Handle;
   |SINO;
      |XABRE "E", aAlfa, Handle;
   |FINSI;

   |SI FSalida < 0;
      |MENAV "    Fichero inexistente"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO ImpVta;
   |LEE 000#dscam003.u;
   |SI FSalida = 0;
      nDocum = #dscam003#40 + 1;
   |SINO;
      nDocum = 1;
   |FINSI;

   aAlfa = aCadena2 % 12503; Divisa = aAlfa; |HAZ TomaDecim;

   |DDEFECTO #dscam003;
   #dscam003#40 = nDocum; |GRABA 020#dscam003.b;

   aAlfa = aCadena1 % 0105;  #dscam003#0  = aAlfa;        || Serie
   aAlfa = aCadena1 % 0606;  #dscam003#1  = aAlfa;        || Factura
   aAlfa = aCadena1 % 1203;  #dscam003#2  = aAlfa;        || Nº Vencimiento
   aAlfa = aCadena1 % 1510;  #dscam003#3  = aAlfa;        || Fecha Vencimiento
   aAlfa = aCadena1 % 2510;  #dscam003#4  = aAlfa;        || Fecha emision
   aAlfa = aCadena1 % 3512;  #dscam003#5  = aAlfa;        || Cuenta contable cliente
   aAlfa = aCadena1 % 4730;  #dscam003#6  = aAlfa;        || Nombre Cliente
   aAlfa = aCadena1 % 7734;  #dscam003#7  = aAlfa;        || Nombre banco domiciliacion
   aAlfa = aCadena1 % 11104; #dscam003#8  = aAlfa;        || Entidad domiciliacion
   aAlfa = aCadena1 % 11504; #dscam003#9  = aAlfa;        || Oficina domiciliacion
   aAlfa = aCadena1 % 11902; #dscam003#10 = aAlfa;        || DC domiciliacion
   aAlfa = aCadena1 % 12110; #dscam003#11 = aAlfa;        || Cuenta domiciliacion
   aAlfa = aCadena1 % 13102; #dscam003#12 = aAlfa;        || Tipo recibo
   aAlfa = aCadena1 % 16302; #dscam003#13 = aAlfa;        || Departamento
   aAlfa = aCadena1 % 16511; #dscam003#22 = aAlfa;        || Importe original
   aAlfa = aCadena1 % 17611; #dscam003#23 = aAlfa;        || Importe liquidado
   aAlfa = aCadena1 % 18711; #dscam003#24 = aAlfa;        || Gastos negociacion
   aAlfa = aCadena1 % 19811; #dscam003#25 = aAlfa;        || Gastos devolucion
   aAlfa = aCadena1 % 20910; #dscam003#26 = aAlfa;        || Fecha de cobro

   aAlfa = aCadena2 % 0102;  #dscam003#27 = aAlfa;        || Libro contable
   aAlfa = aCadena2 % 0301;  #dscam003#28 = aAlfa;        || A aceptar
   aAlfa = aCadena2 % 0401;  #dscam003#29 = aAlfa;        || Aceptado
   aAlfa = aCadena2 % 0511;  #dscam003#30 = aAlfa;        || Importe total recibo
   aAlfa = aCadena2 % 1611;  #dscam003#31 = aAlfa;        || Importe Pendiente
   aAlfa = aCadena2 % 2706;  #dscam003#32 = aAlfa;        || Codigo Cliente Gestion comercial
   aAlfa = aCadena2 % 3302;  #dscam003#33 = aAlfa;        || Codigo Representante Gestion comercial
   aAlfa = aCadena2 % 3530;  #dscam003#34 = aAlfa;        || Nombre Representante
   aAlfa = aCadena2 % 6511;  #dscam003#38 = aAlfa;        || Otros gastos
   aAlfa = aCadena2 % 7603;  #dscam003#39 = aAlfa;        || Zona cliente
   aAlfa = aCadena2 % 7901;  |SI aAlfa = " "; aAlfa = "N"; |FINSI;
                             #dscam003#47 = aAlfa;        || Entrega a cuenta (S/N)
   aAlfa = aCadena2 % 8001;  #dscam003#48 = aAlfa;        || Impreso (S/N)
   aAlfa = aCadena2 % 8112;  #dscam003#50 = aAlfa;        || Cuenta de cobro
   aAlfa = aCadena2 % 9311;  #dscam003#54 = aAlfa;        || Importe Descuento
   aAlfa = aCadena2 % 10411; #dscam003#55 = aAlfa;        || Importe Desprecio
   aAlfa = aCadena2 % 11503; #dscam003#57 = aAlfa;        || Codigo Divisa
   aAlfa = aCadena2 % 11830; #dscam003#58 = aAlfa;        || Nombre Divisa
   aAlfa = aCadena2 % 14820; #dscam003#59 = aAlfa;        || Cambio Divisa
   aAlfa = aCadena2 % 16801; #dscam003#60 = aAlfa;        || Docum.Entr.a Cta.
   aAlfa = aCadena2 % 16902; #dscam003#75 = aAlfa;        || Campo uso multiple 1
   aAlfa = aCadena2 % 17102; #dscam003#76 = aAlfa;        || Campo uso multiple 2
   aAlfa = aCadena2 % 17302; #dscam003#77 = aAlfa;        || Campo uso multiple 3
   aAlfa = aCadena2 % 17502; #dscam003#80 = aAlfa;        || Forma de pago
   aAlfa = aCadena2 % 17720; #dscam003#85 = aAlfa;        || Referencia

   #dscam003#60 = #dscam003#22 * #dscam003#59;
   #dscam003#61 = #dscam003#23 * #dscam003#59;
   #dscam003#62 = #dscam003#24 * #dscam003#59;
   #dscam003#63 = #dscam003#25 * #dscam003#59;
   #dscam003#66 = #dscam003#38 * #dscam003#59;
   #dscam003#67 = #dscam003#54 * #dscam003#59;
   #dscam003#68 = #dscam003#55 * #dscam003#59;

   #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
   #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);

   #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
   #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);

   #dscam003#31 = #dscam003#30 - #dscam003#23; #dscam003#65 = #dscam003#64 - #dscam003#61;

   |SI #dscam003#31 = 0;
      #dscam003#14 = "L";
      #dscam003#15 = "Recibo Liquidado";
   |SINO;
      |SI #dscam003#23 = 0;
         |SI #dscam003#16 = 0;
            #dscam003#14 = "P";
            #dscam003#15 = "Pendiente de cobro";
         |SINO;
            #dscam003#14 = "I";
            #dscam003#15 = "Impagado";
         |FINSI;
      |SINO;
         #dscam003#14 = "C";
         #dscam003#15 = "Parcialmente cobrado";
      |FINSI;
   |FINSI;
   |GRABA 020#dscam003.a; |LIBERA #dscam003;

   |SI #dscam003#23 ! 0;
      |DDEFECTO #dscam004;
      #dscam004#17 = #dscam003#40;
      #dscam004#3  = 1;
      |GRABA 020#dscam004.b;
      #dscam004#0  = #dscam003#0;
      #dscam004#1  = #dscam003#1;
      #dscam004#2  = #dscam003#2;
      #dscam004#4  = #dscam003#50;
      |SI #dscam003#23 = #dscam003#30;
         #dscam004#5 = "COB";
      |SINO;
         #dscam004#5 = "COP";
      |FINSI;
      #dscam004#6  = #dscam003#26;
      #dscam004#8  = #dscam003#23;
      #dscam004#10 = #dscam003#24 + #dscam003#25;
      #dscam004#11 = #dscam003#13;
      #dscam004#12 = #dscam003#24;
      #dscam004#13 = #dscam003#25;
      #dscam004#14 = #dscam003#38;
      #dscam004#15 = #dscam003#27;
      |SI #dscam003#54 ! 0;
         #dscam004#22 = "D";
         #dscam004#23 = #dscam003#54;
      |FINSI;
      |SI #dscam003#55 ! 0;
         #dscam004#22 = "E";
         #dscam004#23 = #dscam003#55;
      |FINSI;
      #dscam004#33 = #dscam003#59;
      #dscam004#26 = #dscam004#8  * #dscam004#33;
      #dscam004#28 = #dscam004#10 * #dscam004#33;
      #dscam004#29 = #dscam004#12 * #dscam004#33;
      #dscam004#30 = #dscam004#13 * #dscam004#33;
      #dscam004#31 = #dscam004#14 * #dscam004#33;
      #dscam004#32 = #dscam004#23 * #dscam004#33;
      |GRABA 020#dscam004.a; |LIBERA #dscam004;
   |FINSI;
|FPRC;

|PROCESO ImportaVentas;
   |ABRE #dscam003;   |ABRE #dscam004;

   aAlfa = #dscaz070#0; |QBF aAlfa;
   |SI aIP ! "";
      FSalida = 1; aAlfa1 = "";
      |PARA; |SI FSalida ! 0; |HACIENDO;
         aChar = aAlfa % -101;
         |SI aChar = "/"; |O aChar = "\"; |SAL; |FINSI;
         aAlfa1 = aChar + aAlfa1;
         aAlfa = aAlfa % -299;
      |SIGUE;
      |DFICE aChar; |QBF aChar;
      aChar = aChar + "tmp/";
      |MKDIR aChar;
      aAlfa = aAlfa  + aAlfa1; |QBF aAlfa;
      aAlfa1 = aChar + aAlfa1; |QBF aAlfa1;
      |RECIBE_FICHERO aAlfa,aAlfa1;
      aAlfa = aAlfa1;
      aNombre = aAlfa1;
   |FINSI;

   aAlfa = "rb  " + aAlfa;
   |FABRE aAlfa;
   |SI FSalida ] 0;
      Handle  = FSalida; aCadena1 = ""; aCadena2 = "";
      |PARA; |SI; |HACIENDO;
         aAlfa = Handle + " 218"; |FLEE aAlfa; aCadena1 = aAlfa;
         |SI FSalida ! 218; |SAL; |FINSI;
         aAlfa = Handle + " 198"; |FLEE aAlfa; aCadena2 = aAlfa;
         |SI FSalida ! 198; |SAL; |FINSI;
         |HAZ ImpVta; aCadena1 = ""; aCadena2 = "";
      |SIGUE;
      FSalida = Handle; |FCIERRA FSalida;
   |FINSI;

   |SI aIP ! "";
      |FBORRA aNombre;
      |DFICE aChar; |QBF aChar;
      aChar = aChar + "tmp/"; |RMDIR aChar;
   |FINSI;

   |CIERRA #dscam003;   |CIERRA #dscam004;
|FPRC;

|PROCESO ImpCmp;
   |LEE 000#dscam008.u;
   |SI FSalida = 0;
      nDocum = #dscam008#40 + 1;
   |SINO;
      nDocum = 1;
   |FINSI;

   aAlfa = aCadena2 % 5003; Divisa =      aAlfa; |HAZ TomaDecim;

   |DDEFECTO #dscam008;
   #dscam008#40 = nDocum; |GRABA 020#dscam008.b;

   aAlfa = aCadena1 % 0105;  #dscam008#0  = aAlfa;        || Serie
   aAlfa = aCadena1 % 0606;  #dscam008#1  = aAlfa;        || Factura
   aAlfa = aCadena1 % 1203;  #dscam008#2  = aAlfa;        || Nº Vencimiento
   aAlfa = aCadena1 % 1510;  #dscam008#3  = aAlfa;        || Fecha Vencimiento
   aAlfa = aCadena1 % 2510;  #dscam008#4  = aAlfa;        || Fecha emision
   aAlfa = aCadena1 % 3512;  #dscam008#5  = aAlfa;        || Cuenta contable proveedor
   aAlfa = aCadena1 % 4730;  #dscam008#6  = aAlfa;        || Nombre Proveedor
   aAlfa = aCadena1 % 7734;  #dscam008#7  = aAlfa;        || Nombre banco domiciliacion
   aAlfa = aCadena1 % 11104; #dscam008#8  = aAlfa;        || Entidad domiciliacion
   aAlfa = aCadena1 % 11504; #dscam008#9  = aAlfa;        || Oficina domiciliacion
   aAlfa = aCadena1 % 11902; #dscam008#10 = aAlfa;        || DC domiciliacion
   aAlfa = aCadena1 % 12110; #dscam008#11 = aAlfa;        || Cuenta domiciliacion
   aAlfa = aCadena1 % 13102; #dscam008#12 = aAlfa;        || Tipo recibo
   aAlfa = aCadena1 % 16302; #dscam008#13 = aAlfa;        || Departamento
   aAlfa = aCadena1 % 16511; #dscam008#22 = aAlfa;        || Importe original
   aAlfa = aCadena1 % 17611; #dscam008#23 = aAlfa;        || Importe liquidado
   aAlfa = aCadena1 % 18711; #dscam008#24 = aAlfa;        || Gastos negociacion
   aAlfa = aCadena1 % 19810; #dscam008#26 = aAlfa;        || Fecha de pago

   aAlfa = aCadena2 % 0102;  #dscam008#27 = aAlfa;        || Libro contable
   aAlfa = aCadena2 % 0301;  #dscam008#28 = aAlfa;        || A aceptar
   aAlfa = aCadena2 % 0401;  #dscam008#29 = aAlfa;        || Aceptado
   aAlfa = aCadena2 % 0511; #dscam008#25 = aAlfa;        || Importe total recibo
   aAlfa = aCadena2 % 1611;  #dscam008#31 = aAlfa;        || Importe Pendiente
   aAlfa = aCadena2 % 2706;  #dscam008#32 = aAlfa;        || Codigo Proveedor Gestion comercial
   aAlfa = aCadena2 % 3311;  #dscam008#38 = aAlfa;        || Otros gastos
   aAlfa = aCadena2 % 4401;  #dscam008#48 = aAlfa;        || Impreso (S/N)
   aAlfa = aCadena2 % 4512;  #dscam008#50 = aAlfa;        || Cuenta de pago
   aAlfa = aCadena2 % 5703;  #dscam008#59 = aAlfa;        || Codigo Divisa
   aAlfa = aCadena2 % 6030;  #dscam008#60 = aAlfa;        || Nombre Divisa
   aAlfa = aCadena2 % 9020;  #dscam008#61 = aAlfa;        || Cambio Divisa
   aAlfa = aCadena2 % 11002;  #dscam008#64 = aAlfa;        || Campo uso multiple 1
   aAlfa = aCadena2 % 11202; #dscam008#65 = aAlfa;        || Campo uso multiple 2
   aAlfa = aCadena2 % 11402; #dscam008#66 = aAlfa;        || Campo uso multiple 3
   aAlfa = aCadena2 % 11602; #dscam008#67 = aAlfa;        || Forma de pago
   aAlfa = aCadena2 % 11820; #dscam008#63 = aAlfa;        || Referencia

   #dscam008#53 = #dscam008#22 * #dscam008#61;
   #dscam008#54 = #dscam008#24 * #dscam008#61;
   #dscam008#55 = #dscam008#38 * #dscam008#61;
   #dscam008#57 = #dscam008#23 * #dscam008#61;

   #dscam008#25 = #dscam008#22 + #dscam008#24 + #dscam008#38;
   #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55;

   #dscam008#31 = #dscam008#25 - #dscam008#23; #dscam008#58 = #dscam008#56 - #dscam008#57;

   |SI #dscam008#31 = 0;
      #dscam008#14 = "L";
      #dscam008#15 = "Recibo Liquidado";
   |SINO;
      |SI #dscam008#23 = 0;
         #dscam008#14 = "P";
         #dscam008#15 = "Pendiente de pago";
      |SINO;
         #dscam008#14 = "C";
         #dscam008#15 = "Parcialmente pagado";
      |FINSI;
   |FINSI;
   |GRABA 020#dscam008.a; |LIBERA #dscam008;

   |SI #dscam008#23 ! 0;
      |DDEFECTO #dscam009;
      #dscam009#14 = #dscam008#40;
      #dscam009#3  = 1;
      |GRABA 020#dscam009.b;
      #dscam009#0  = #dscam008#0;
      #dscam009#1  = #dscam008#1;
      #dscam009#2  = #dscam008#2;
      #dscam009#4  = #dscam008#50;
      |SI #dscam008#23 = #dscam008#25;
         #dscam009#5 = "PAG";
      |SINO;
         #dscam009#5 = "PAP";
      |FINSI;
      #dscam009#6  = #dscam008#26;
      #dscam009#8  = #dscam008#23;
      #dscam009#9  = #dscam008#24 + #dscam008#38;
      #dscam009#10 = #dscam008#13;
      #dscam009#11 = #dscam008#24;
      #dscam009#12 = #dscam008#38;
      #dscam009#13 = #dscam008#27;
      #dscam009#25 = #dscam008#61;
      #dscam009#21 = #dscam009#8  * #dscam009#25;
      #dscam009#23 = #dscam009#11 * #dscam009#25;
      #dscam009#24 = #dscam009#12 * #dscam009#25;
      |GRABA 020#dscam009.a; |LIBERA #dscam009;
   |FINSI;
|FPRC;

|PROCESO ImportaCompras;
   |ABRE #dscam008;   |ABRE #dscam009;

   aAlfa = #dscaz070#1; |QBF aAlfa;
   |SI aIP ! "";
      FSalida = 1; aAlfa1 = "";
      |PARA; |SI FSalida ! 0; |HACIENDO;
         aChar = aAlfa % -101;
         |SI aChar = "/"; |O aChar = "\"; |SAL; |FINSI;
         aAlfa1 = aChar + aAlfa1;
         aAlfa = aAlfa % -299;
      |SIGUE;
      |DFICE aChar; |QBF aChar;
      aChar = aChar + "tmp/";
      |MKDIR aChar;
      aAlfa = aAlfa  + aAlfa1; |QBF aAlfa;
      aAlfa1 = aChar + aAlfa1; |QBF aAlfa1;
      |RECIBE_FICHERO aAlfa,aAlfa1;
      aAlfa = aAlfa1;
      aNombre = aAlfa1;
   |FINSI;

   aAlfa = "rb  " + aAlfa;
   |FABRE aAlfa;
   |SI FSalida ] 0;
      Handle  = FSalida; aCadena1 = ""; aCadena2 = "";
      |PARA; |SI; |HACIENDO;
         aAlfa = Handle + " 207"; |FLEE aAlfa; aCadena1 = aAlfa;
         |SI FSalida ! 207; |SAL; |FINSI;
         aAlfa = Handle + " 139"; |FLEE aAlfa; aCadena2 = aAlfa;
         |SI FSalida ! 139; |SAL; |FINSI;
         |HAZ ImpCmp; aCadena1 = ""; aCadena2 = "";
      |SIGUE;
      FSalida = Handle; |FCIERRA FSalida;
   |FINSI;

   |SI aIP ! "";
      |FBORRA aNombre;
      |DFICE aChar; |QBF aChar;
      aChar = aChar + "tmp/"; |RMDIR aChar;
   |FINSI;

   |CIERRA #dscam008;   |CIERRA #dscam009;
|FPRC;

|PROCESO Importacion;
   aAlfa = #dscaz070#0; |QBF aAlfa;
   |SI aAlfa ! ""; |HAZ ImportaVentas;  |FINSI;

   aAlfa = #dscaz070#1; |QBF aAlfa;
   |SI aAlfa ! ""; |HAZ ImportaCompras; |FINSI;
|FPRC;

|PROGRAMA;
   |HAZ Tipo8;
   |CLS;
   |CABEZA " Importacion estandar ";

   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0; |Y #0#2 = "S";
      |HAZ Importacion;
   |FINSI;
   |HAZ Tipo9;
|FPRO;
