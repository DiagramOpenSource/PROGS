|FICHEROS;
   dscam049 #0;
   dscam050 #1;
   dscam014 #2;
   dscam008 #3;
   dscaw001 #4,MANTE;
   dscam009 #5;

   dscam051 #6;
   dscam067 #7;
   dscam030 #8;
   dscaw013 #13;
   dscaw207 #18;

   camasic@ #100;
|FINSI;

|VARIABLES;
   &eaFichClas = "";  &eaTipoClas = ""; &enSwClas = 0;
   &Divisa = ""; &NombreDiv = "";  &eaMBase = ""; &eaNombreMBase = "";
   &CambioDivCm = 0; &enRemesa = 1;
   &PosLibro = 0; &PosSerie = 0; &PosFactu = 0; &PosRecib = 0; &enDocum = 0;
   &eaTipoRecibo = ""; &enNumDocum = 0; &eaMensRet = ""; &enSwError = 0; &eaTOperacion = "";
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = ""; &eaLlamada = "";

   &CodProv = ""; &CtaProv = ""; &enTipoRec = 0;
   &enSwLineal = 0; &enClave = 0;

   &eaCliente = "";
   &enDocumento = 0;
   &efFechaVto = @;

   &eaCodigo   = ""; &eaCuenta   = ""; &enSwErr = 0;
   &enNumDocumento = 0;
   &enEmpGestion = 0; &enSwVisado = 0;

   &efFecha      = @;
   &eaEmpContab  = "";
   &eaDirConta   = "";

   nSwErrEnlNoAut = 0;

   fDFecha = @;   fHFecha = @;
   nDImporte = 0; nHImporte = 0;

   nModo    = 0; nFlag  = 0;
   nSwErr   = 0;
   nSwErr1  = 0;
   aFP      = "";
   aAlfa    = "";
   aAlfa1   = "";
   aAlfa2   = "";
   aVencido = "";
   aCuenta  = "";

   nEmpresa = 0;
   nPeriodo = 0;
   nDiario  = 0;
   fFecha   = @;
   nDocumto = 0;

   aEstadoEmi = "";
   aEstadoVto = "";
   aCodEnlVto = "";
   aCodEnlEmi = "";
   fFechVto   = @;
   nNumSecVto = 0;
   nNumSecEmi = 0;
   nBaja      = 0;
   nAutom     = 0;
   SwClave    = 0;
   Codigo     = 0;
   Linea      = 0;
   FEstado    = 0;
   SwError    = 0;
   aResp      = "";
   Clave1     = "";
   Clave2     = "";
   Clave3     = "";

   ModoEntrada = 0;
   Comodin = "";

   NumDias  = 0;
   nPorcInt = 0;
   nInteres = 0;
   Calc     = 0;
   Calc1    = 0;
   Calc2    = 0;

   LinCob   = 0;
|FIN;

|PROCESO Contador; |TIPO 7;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada ! 1; |ACABA; |FINSI;

   |ABRE #dscam049;
   |LEE 010#dscam049.u;
   |SI FSalida = 0;
      Codigo = #dscam049#0;
      |DDEFECTO #dscam049;
      #dscam049#0 = Codigo + 1;
      |PINTA #dscam049#0;
   |FINSI;
   |CIERRA #dscam049;
|FPRC;

|PROCESO EntregasPdtes;
   nSwErr1 = 1; |ERROR10;
|FPRC;

|DEFBUCLE EntregasPdtes;
#dscam008#5;
14;
aCuenta, 000000001, "e";
aCuenta, 999999999, "e";
;
NULL, EntregasPdtes;
|FIN;

|PROCESO RecogeRec;

   |SI nAutom = 0;
      enSwError = 0;
      eaTOperacion = "A"; eaTipoRecibo = "C"; enNumDocum = #dscam050#13; |HAZ ProcesaTempo;
      |SI enSwError = 1; |ERROR; |ACABA; |FINSI;
   |FINSI;

   |ABRE #dscam008;
   #dscam008#40 = #dscam050#13;
   |LEE 010#dscam008.=;
   |SI FSalida = 0;
      |SI #dscam051#121 = "N";
         eaCodigo = #dscam008#32; eaCuenta = #dscam008#5; |HAZ MiraSiBloq;
         |SI enSwErr ! 0;
            |MENAV "    Proveedor bloqueado";
            eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscam050#13; |HAZ ProcesaTempo;
            |ERROR; |ACABA;
         |FINSI;
      |SINO;
         eaCliente = #dscam008#32; eaCuenta = #dscam008#5;
         efFechaVto = #dscam049#2;
         enDocumento = #dscam008#40; |HAZ MiraCertContr;
         |SI enSwErr ! 0; |ERROR; |ACABA; |FINSI;
      |FINSI;

      enNumDocumento = #dscam008#40;
      enEmpGestion = #dscam008#46; |HAZ MiraSiVisado;
      |SI enSwVisado < 0;
         |MENAV "    Factura proveedor no visada, no se permite el pago";
         eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscam050#13; |HAZ ProcesaTempo;
         |ERROR; |ACABA;
      |FINSI;

      |SI #dscam008#3 > #dscam049#2;
         |MENAV "    La fecha de vto del documento es posterior a la maxima indicada";
         eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscam050#13; |HAZ ProcesaTempo;
         |ERROR; |ACABA;
      |FINSI;
      |SI #dscam008#16 ! #dscam049#3; |Y #dscam049#22 = "S";
         |MENAV "    El banco asociado al pago no coincide con el seleccionado";
         eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscam050#13; |HAZ ProcesaTempo;
         |ERROR; |ACABA;
      |FINSI;
      |SI #dscam008#14 = "A"; |O #dscam008#14 = "D";
         |SI #dscam008#14 = "A"; |MENAV "    El recibo está agrupado"; |FINSI;
         |SI #dscam008#14 = "D"; |MENAV "    El recibo está dividido"; |FINSI;
         |CIERRA #dscam008; |ERROR; |ACABA;
      |FINSI;

      |SI #dscam008#31 = 0;
         |MENAV "    Recibo liquidado";
         eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscam050#13; |HAZ ProcesaTempo;
         |ERROR;
         |ACABA;
      |SINO;
         |SI #dscam008#14 = "E"; ||Y ModoEntrada = 1;
            |MENAV "    Recibo en cartera";
            |ERROR;
            eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscam050#13; |HAZ ProcesaTempo;
            |ACABA;
         |SINO;
            #dscam050#2 = #dscam008#27;
            #dscam050#3 = #dscam008#1;
            #dscam050#4 = #dscam008#0;
            #dscam050#5 = #dscam008#2;
            #dscam050#6 = #dscam008#3;
            #dscam050#7 = #dscam008#31;
            #dscam050#20 = #dscam008#58;
            #dscam050#8 = #dscam008#5;
            #dscam050#10 = #dscam008#6;
            #dscam050#16 = #dscam008#72;
            #dscam050#12 = "N";
            #dscam050#35 = #dscam008#63;
            |PINDA #0#dscam050;
         |FINSI;
      |FINSI;
      enSwClas   = 1; eaFichClas = "dscam049"; eaTipoClas = #dscam008#12;
      |HAZ CompruebaClas;
      |SI eaFichClas = "ERROR";
         |MENAV "    Documento inoperable en el perfil actual ";
         eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscam050#13; |HAZ ProcesaTempo;
         |ERROR; |ACABA;
      |FINSI;
      |SI eaFichClas = "INFOR";
         |CONFI "    Documento inoperable en el perfil actual. Cambiar Tipo recibo ?";
         |SI FSalida = 0;
            eaFichClas = "dscam049";
            enNumDocum = #dscam008#40; enTipoRec = #dscam008#12; |HAZ CambiaTR;
         |SINO;
            |CIERRA #dscam008;
            eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscam008#40; |HAZ ProcesaTempo;
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;

      aCuenta = #dscam008#5;
      nSwErr1 = 0;
      |SALVA_FICHA #dscam008;
      |BUCLE EntregasPdtes;
      |REPON_FICHA #dscam008;
      |SI nSwErr1 = 1;
         aAlfa = "    NEste proveedor tiene entregas a cuenta pendientes de saldar. " + &191 + " Continuar ?";
         |CONFI aAlfa;
         |SI FSalida ! 0;
             |CIERRA #dscam008; |ERROR; |ACABA;
         |FINSI;
      |FINSI;

   |SINO;
      |MENAV "    Recibo inexistente";
      eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscam050#13; |HAZ ProcesaTempo;
      |ERROR; |ACABA;
   |FINSI;
   |CIERRA #dscam008;
|FPRC;

|PROCESO BorraHistEnl;
   |BORRA 020#dscam067.a;
|FPRC;

|DEFBUCLE BorraHistEnl;
#dscam067#2;
;
nEmpresa, nPeriodo, nDiario, fFecha,  nDocumto, 0000;
nEmpresa, nPeriodo, nDiario, fFecha,  nDocumto, 9999;
be;
NULL, BorraHistEnl;
|FIN;

|PROCESO BorraLin;
   |SI aEstadoVto = "S";
      |ABRE #dscam009;
      #dscam009#14 = #dscam050#13;
      #dscam009#3  = #dscam050#14;
      |LEE 101#dscam009.=;
      |SI FSalida = 0;
         |ABRE #dscam051;
         |LEE 000#dscam051.p;
         |SI FSalida ! 0;
            |DDEFECTO #dscam051;
            |GRABA 000#dscam051.c;
         |FINSI;
         |CIERRA #dscam051;
         |SI #dscam051#1 = "S";
            |ABRE #dscam067;
            #dscam067#8 = 0;
            #dscam067#9 = 0;
            #dscam067#0 = "CF";
            #dscam067#1 = #dscam049#0;
            #dscam067#2 = 1;
            #dscam067#3 = "V";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
            |PARA; |SI FEstado = 0; |Y Clave1 = #dscam049#0; |Y #dscam067#0 = "CF"; |HACIENDO;
               |SI FEstado = 0;  |Y Clave1 = #dscam049#0; |Y #dscam067#0 = "CF"; |Y Clave3 = "V";
                  |SAL;
               |FINSI;
               |LEE 000#dscam067.s;
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
            |SIGUE;
            |SI FEstado = 0; |Y Clave1 = #dscam049#0; |Y #dscam067#0 = "CF"; |Y Clave3 = "V";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;

               nNumSecVto = 0; nNumSecEmi = 0; fFechVto = "01.01.0000";
               |SI #dscam050#23 ! 0;
                  nNumSecVto = #dscam050#23; fFechVto = #dscam067#5;
                  #dscam050#23 = 0; |GRABA 020#dscam050.a;
               |FINSI;
               |SI #dscam050#25 ! 0;
                  nNumSecEmi = #dscam050#25;
                  #dscam050#25 = 0; |GRABA 020#dscam050.a;
               |FINSI;
               aCodEnlVto = #dscam067#10;

               |NOME_DAT #13 Comodin;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
               #dscaw013#13 = "dscam050";    #dscaw013#14 = 0;
               #dscaw013#11 = "N";           #dscaw013#12 = 5;
               #dscaw013#5 = #dscam049#0;    #dscaw013#6 = #dscam049#0;
               |GRABA 020#dscaw013.n;
               |CIERRA #dscaw013;
               Comodin = #dscam067#10; |QBF Comodin;
               Comodin = "dscam033.tab;" + Comodin + ",B,V" + #dscam067#5;
               |LIBERA #dscam049; |CIERRAT #dscam049;
               |LIBERA #dscam050; |CIERRAT #dscam050;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam049; |LEE 101#dscam049.=;
               |ABRET #dscam050; |LEE 101#dscam050.=;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;
            |CIERRA #dscam067;
         |SINO;
            |SI nSwErrEnlNoAut = 1;
               |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
               nSwErrEnlNoAut = 0;
            |FINSI;
         |FINSI;
         |BORRA 020#dscam009.a;
      |FINSI;
      |LIBERA #dscam009; |CIERRA #dscam009;
      aVencido = #dscam050#12;
      #dscam050#12 = "N"; |GRABA 020#dscam050.a;
   |FINSI;

   |SI aEstadoEmi ! "N";
      |ABRE #dscam051;
      |LEE 000#dscam051.p;
      |SI FSalida ! 0;
         |DDEFECTO #dscam051;
         |GRABA 000#dscam051.c;
      |FINSI;
      |CIERRA #dscam051;
      |SI #dscam051#1 = "S";
         |ABRE #dscam067;
         #dscam067#8 = 0;
         #dscam067#9 = 0;
         #dscam067#0 = "CF";
         #dscam067#1 = #dscam049#0;
         #dscam067#2 = 1;
         #dscam067#3 = "E";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |PARA; |SI FEstado = 0; |Y Clave1 = #dscam049#0; |Y #dscam067#0 = "CF"; |HACIENDO;
            |SI FEstado = 0;  |Y Clave1 = #dscam049#0; |Y #dscam067#0 = "CF"; |Y Clave3 = "E";
               |SAL;
            |FINSI;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
         |SIGUE;

         aCodEnlEmi = #dscam067#10;
         |SI FEstado = 0; |Y Clave1 = #dscam049#0; |Y #dscam067#0 = "CF"; |Y Clave3 = "E";
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #13 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
            #dscaw013#13 = "dscam050";    #dscaw013#14 = 0;
            #dscaw013#11 = "N";           #dscaw013#12 = 5;
            #dscaw013#5 = #dscam049#0;    #dscaw013#6 = #dscam049#0;
            |GRABA 020#dscaw013.n;
            Comodin = #dscam067#10; |QBF Comodin;
            Comodin = "dscam033.tab;" + Comodin + ",B,E";
            |LIBERA #dscam049; |CIERRAT #dscam049;
            |LIBERA #dscam050; |CIERRAT #dscam050;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam049; |LEE 101#dscam049.=;
            |ABRET #dscam050; |LEE 101#dscam050.=;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

            nEmpresa = #dscam067#8; nPeriodo = #dscam067#9;
            nDiario  = #dscam067#4; fFecha   = #dscam067#5;
            nDocumto = #dscam067#6;
            |BUCLE BorraHistEnl;
         |FINSI;
         |CIERRA #dscam067;
      |SINO;
         |SI nSwErrEnlNoAut = 1;
         |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
            nSwErrEnlNoAut = 0;
         |FINSI;
      |FINSI;
      #dscam050#25 = 0; |GRABA 020#dscam050.a;
   |FINSI;

   #dscam008#40 = #dscam050#13;
   |LEE 101#dscam008.=;
   |SI FSalida = 0;
      |SI ModoEntrada = 3;
         #dscam008#17 = "00000"; #dscam008#37 = 0; #dscam008#39 = ""; #dscam008#47 = "";
      |FINSI;
      #dscam008#26 = "";
      |SI aVencido = "S";
         #dscam008#23 = #dscam008#23 - #dscam050#7;  #dscam008#57 = #dscam008#57 - #dscam050#20;
         #dscam008#31 = #dscam008#25 - #dscam008#23; #dscam008#58 = #dscam008#56 - #dscam008#57;
      |FINSI;
      |SI #dscam008#23 = 0;
         |SI nBaja = 1;
            #dscam008#14 = "P";
            #dscam008#15 = "Pendiente de pago";
         |SINO;
            #dscam008#14 = "E";
            #dscam008#15 = "Englobado en confirme";
            |SI #dscam051#110 = "S";
               #dscam008#16 = #dscam049#3; #dscam008#52 = #dscam049#4;
            |FINSI;
         |FINSI;
      |SINO;
         |SI #dscam008#31 = 0;
            #dscam008#14 = "L";
            #dscam008#15 = "Recibo liquidado";
         |SINO;
            #dscam008#14 = "C";
            #dscam008#15 = "Parcialmente pagado";
         |FINSI;
      |FINSI;
      |GRABA 020#dscam008.a;
      |LIBERA #dscam008;
   |FINSI;

   |SI ModoEntrada = 3;
      |BORRA 020#dscam050.a;
      |ABRE #dscam067;
      #dscam067#8 = 0;
      #dscam067#9 = 0;
      #dscam067#0 = "CF";
      #dscam067#1 = #dscam050#0;
      #dscam067#2 = #dscam050#1;
      |LEE 101#dscam067.];
      |SI FSalida = 0; |Y #dscam067#0 = "CF"; |Y #dscam067#1 = #dscam050#0;
       |Y #dscam067#2 = #dscam050#1;
          |PARA; |SI FSalida = 0; |Y #dscam067#0 = "CF"; |Y #dscam067#1 = #dscam050#0;
           |Y #dscam067#2 = #dscam050#1; |HACIENDO;
              |BORRA 020#dscam067.a; |LIBERA #dscam067;
              |LEE 101#dscam067.s;
          |SIGUE;
      |FINSI;
      |LIBERA #dscam067;
      |CIERRA #dscam067;
   |FINSI;
|FPRC;

|DEFBUCLE BorraLin;
#dscam050#1;
;
#dscam049#0,001;
#dscam049#0,999;
;
NULL,BorraLin;
|FIN;

|PROCESO BuscaLin;
   |SI #dscam050#12 = "S";
      SwError = 1;
      |ERROR10;
   |FINSI;
|FPRC;

|DEFBUCLE BuscaLin;
#dscam050#1;
;
#dscam049#0,001;
#dscam049#0,999;
;
NULL,BuscaLin;
|FIN;

|PROCESO Baja; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;

   aEstadoEmi = #dscam049#7; aEstadoVto = #dscam049#8;
   |SI ModoEntrada = 2;
      |SI #dscam049#7 ! "N"; |O #dscam049#8 = "S";
         |ABRE #dscam051;
         |DDEFECTO #dscam051;
         |LEE 000#dscam051.p;
         |SI FSalida ! 0;
            |DDEFECTO #dscam051;
            |GRABA 020#dscam051.n;
         |FINSI;
         |CIERRA #dscam051;
         |SI #dscam051#1 = "N";
            |CONFI "    NVa a modificar una relacion ya emitida/contabilizada. ¨ Continuar ?";
         |SINO;
            |PUSHV 0820 1560;
            |BLANCO 0820 1560;
            |CUADRO 0921 1459;
            |ATRI R; |PINTA 1022, "Relacion de confirmes ya emitida o   "; |ATRI N;
            |ATRI R; |PINTA 1122, "contabilizada. Si continua se modifi-"; |ATRI N;
            |ATRI R; |PINTA 1222, "caran los asientos correspondientes  "; |ATRI N;
            |ATRI R; |PINTA 1322, "en contabilidad. ¨ Continuar ?       "; |ATRI N;
            E_sup = 1;
            E_inf = "";
            aResp = 1353 ? 1;
            |SI FSalida = 0; aResp = aResp > aResp; |FINSI;
            |POPV;
            |SI aResp = "S";
               FSalida = 0;
            |SINO;
               FSalida = 1;
            |FINSI;
         |FINSI;
         |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
         |HAZ BuscaCierre;
         |SI enSwError < 0;
               aAlfa = "0000Error al acceder a la empresa contable...";
               |SI enSwError = -1; aAlfa = "0000Error empresa contable cerrada..."; |FINSI;
               |SI enSwError = -2;
                    |MENAV "0000Error no se encuentran los ficheros de contabilidad...";
                    aAlfa = "0000Directorio:" + eaDirConta + " ...";
               |FINSI;
               |SI enSwError = -3; aAlfa = "0000Error no se encuentra la empresa de contabilidad:" + eaEmpContab + " ..."; |FINSI;
               |SI enSwError = -4; aAlfa = "0000Error empresa contabilidad bloqueada para la fecha:" + efFecha + " ..."; |FINSI;
               |MENAV aAlfa;
               |ERROR; |ACABA;
         |FINSI;

         eaUsuario = Usuario % 0810;
         eaDescr   = "MODIFICACION CONFIRME (" + (("00000" + #dscam049#0) % -105) + ")";
         eaTipoReg = "CF";  eaNumero = ("00000" + #dscam049#0) % -105;
         eaTipoOp  = "M";   enImpAnt = #dscam049#9; enImpAct = 0;
         |HAZ GrabaAudit;
         |ABRE #dscam008; |ABRE #dscam050;
         nSwErrEnlNoAut = 1;
         nBaja = 0; eaLlamada = "A"; |BUCLE BorraLin;
         |SI nNumSecEmi ! 0;
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #13 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = aCodEnlEmi; #dscaw013#0  = 1;
            #dscaw013#13 = "dscam050"; #dscaw013#14 = 25;
            #dscaw013#11 = "N";        #dscaw013#12 = 10;
            #dscaw013#5 = nNumSecEmi;  #dscaw013#6 = nNumSecEmi;
            |GRABA 020#dscaw013.n;
            Comodin = aCodEnlEmi; |QBF Comodin;
            Comodin = "dscam033.tab;" + Comodin + ",E";
            |LIBERA #dscam049; |CIERRAT #dscam049;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam049; |LEE 101#dscam049.=;
         |FINSI;
         |SI nNumSecVto ! 0;
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #13 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = aCodEnlVto; #dscaw013#0  = 1;
            #dscaw013#13 = "dscam050"; #dscaw013#14 = 23;
            #dscaw013#11 = "N";        #dscaw013#12 = 10;
            #dscaw013#5 = nNumSecVto;  #dscaw013#6 = nNumSecVto;
            |GRABA 020#dscaw013.n;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = aCodEnlVto; #dscaw013#0  = 2;
            #dscaw013#13 = "dscam050"; #dscaw013#14 = 12;
            #dscaw013#11 = "A";        #dscaw013#12 = 1;
            #dscaw013#3 = "S";         #dscaw013#4 = "S";
            |GRABA 020#dscaw013.n;
            Comodin = aCodEnlVto; |QBF Comodin;
            Comodin = "dscam033.tab;" + Comodin + ",V" + fFechVto;
            |LIBERA #dscam049; |CIERRAT #dscam049;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam049; |LEE 101#dscam049.=;
         |FINSI;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

         |CIERRA #dscam008; |CIERRA #dscam050;
         #dscam049#7 = "N"; |PINTA #dscam049#7;
         #dscam049#8 = "N"; |PINTA #dscam049#8;
         |GRABA 020#dscam049.a;
      |FINSI;
      eaUsuario = Usuario % 0810;
      eaTipoReg = "CF";  eaNumero = ("00000" + #dscam049#0) % -105;
      eaTipoOp  = "M";   enImpAnt = #dscam049#9;
      eaDescr   = "MODIFICACION CONFIRME (" + (("00000" + #dscam049#0) % -105) + ")";
      |HAZ GrabaAudit;
   |FINSI;

   |SI ModoEntrada = 3;
      |ABRE #dscam008;
      |ABRE #dscam050;
      SwError = 0; |BUCLE BuscaLin;
      |SI SwError = 0;
         nSwErrEnlNoAut = 1;
         nBaja = 1; eaLlamada = "A"; |BUCLE BorraLin;
      |FINSI;
      |CIERRA #dscam050;
      |CIERRA #dscam008;
      |SI SwError = 1;
         |MENAV "    Hay vencimientos ya contabilizados. No se dara de baja la ficha";
         |ERROR;
         |ACABA;
      |FINSI;

      eaUsuario = Usuario % 0810;
      eaDescr   = "BAJA CONFIRME (" + (("00000" + #dscam049#0) % -105) + ")";
      eaTipoReg = "CF";  eaNumero = ("00000" + #dscam049#0) % -105;
      eaTipoOp  = "B";   enImpAnt = #dscam049#9; enImpAct = 0;
      |HAZ GrabaAudit;
   |FINSI;
|FPRC;

|PROCESO Total; |TIPO 2;

   ModoEntrada = (FEntrada /100) ! 0; nFlag = 0 +. 1;

   |SI ModoEntrada = 1;
      eaUsuario = Usuario % 0810;
      eaTipoReg = "CF";  eaNumero = ("00000" + #dscam049#0) % -105;
      eaTipoOp  = "A"; enImpAnt = #dscam049#9; enImpAct = #dscam049#9 + #dscam050#7;
      eaDescr   = "ALTA LINEA CONFIRME (" + (("00000" + #dscam049#0) % -105) + "/" + (("000" + #dscam050#1)% -103) + ")";
      |HAZ GrabaAudit;
   |FINSI;

   |SI ModoEntrada = 3;
      eaUsuario = Usuario % 0810;
      eaTipoReg = "CF";  eaNumero = ("00000" + #dscam049#0) % -105;
      eaTipoOp  = "A"; enImpAnt = #dscam049#9; enImpAct = #dscam049#9 - #dscam050#7;
      eaDescr   = "BAJA LINEA CONFIRME (" + (("00000" + #dscam049#0) % -105) + "/" + (("000" + #dscam050#1)% -103) + ")";
      |HAZ GrabaAudit;
   |FINSI;

   |ABRE #dscam008;
   #dscam008#40 = #dscam050#13;
   |LEE 110#dscam008.=;
   |SI FSalida = 0;
      |SI ModoEntrada = 1; nModo = 1; |FINSI;
      |SI ModoEntrada = 3; nModo = 3; |FINSI;
      |SI ModoEntrada = 2; |Y nFlag < 0; nModo = 3; |FINSI;
      |SI ModoEntrada = 2; |Y nFlag > 0; nModo = 1; |FINSI;
      |SI nModo = 3;
         #dscam008#17 = "00000";
         #dscam008#37 = 0;
         #dscam008#39 = "";
         #dscam008#47 = "";
         #dscam008#26 = "";
         |SI #dscam008#23 = 0;
            #dscam008#14 = "P";
            #dscam008#15 = "Pendiente de pago";
         |SINO;
            |SI #dscam008#31 = 0;
               #dscam008#14 = "L";
               #dscam008#15 = "Recibo liquidado";
            |SINO;
               #dscam008#14 = "C";
               #dscam008#15 = "Parcialmente pagado";
            |FINSI;
         |FINSI;
         |GRABA 020#dscam008.a;
      |FINSI;
      |SI nModo = 1;
         #dscam050#14 = LinCob;

         #dscam008#17 = #dscam050#0;
         #dscam008#37 = #dscam050#1;
         #dscam008#39 = "C";
         #dscam008#47 = "Confirme";
         #dscam008#26 = #dscam049#1;
         #dscam008#14 = "E";
         #dscam008#15 = "Englobado en confirme";
         |SI #dscam051#110 = "S";
            #dscam008#16 = #dscam049#3; #dscam008#52 = #dscam049#4;
         |FINSI;
         |GRABA 020#dscam008.a;
      |FINSI;
   |FINSI;
   |LIBERA #dscam008;
   |CIERRA #dscam008;

   #dscam049#5  = #dscam049#5  +. 1;
   #dscam049#9  = #dscam049#9  +. #dscam050#7;
   #dscam049#19 = #dscam049#19 +. #dscam050#20;
   |SI #dscam050#6 < #dscam049#1;
      #dscam049#13 = #dscam049#13 +. #dscam050#7;
   |FINSI;
   |PINTA #dscam049#5;
   |PINTA #dscam049#9;
   |PINTA #dscam049#13;

   |SI nAutom = 0;
      eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscam050#13; |HAZ ProcesaTempo;
   |FINSI;
|FPRC;

|PROCESO RellenaTempo;
   |SI #dscam008#14 ! "P"; |Y #dscam008#14 ! "C"; |ACABA; |FINSI;
   |SI #dscam008#16 ! #dscam049#3; |Y #dscam049#22 = "S"; |ACABA; |FINSI;
   |SI #dscam008#3 > #dscam049#2;  |ACABA; |FINSI;

   |SI aFP ! "A";
      |SI #dscam008#72 ! aFP; |ACABA; |FINSI;
   |SINO;
      |SI #dscam008#72 = " "; |ACABA; |FINSI;
   |FINSI;

   enSwClas   = 1; eaFichClas = "dscam049"; eaTipoClas = #dscam008#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |ACABA; |FINSI;

   enNumDocumento = #dscam008#40;
   enEmpGestion = #dscam008#46; |HAZ MiraSiVisado;
   |SI enSwVisado < 0; |ERROR; |ACABA; |FINSI;

   Divisa = #dscam008#59; |HAZ TomaDecim;

   |DDEFECTO #dscaw001;
   #dscaw001#0 = Linea;
   Linea = Linea + 1;
   #dscaw001#1 = #dscam008#27;
   #dscaw001#2 = #dscam008#0;
   #dscaw001#3 = #dscam008#1;
   #dscaw001#4 = #dscam008#2;
   #dscaw001#5 = #dscam008#3;
   #dscaw001#6 = #dscam008#31;
   #dscaw001#7 = " ";
   #dscaw001#8 = #dscam008#40;
   #dscaw001#9 = #dscam008#59;
   #dscaw001#10 = #dscam008#5;
   #dscaw001#11 = #dscam008#32;
   #dscaw001#12 = #dscam008#6;
   #dscaw001#14 = #dscam008#35;
   #dscaw001#15 = #dscam008#36;
   |GRABA 010#dscaw001.n;
|FPRC;

|DEFBUCLE RellenaTempo;
#dscam008#2;
59,12,3,25;
00,"     ",000000,000,#dscam049#16, #dscam049#6, #dscaw207#0, #dscaw207#2;
99,"zzzzz",999999,999,#dscam049#16, #dscam049#6, #dscaw207#1, #dscaw207#3;
;
NULL,RellenaTempo;
|FIN;

|RUTINA inf;
   #dscaw001#0 = 00001;
   #dscaw001#10 = "";
   #dscaw001#11 = "";
|FRUT;

|RUTINA sup;
   #dscaw001#0 = 99999;
   #dscaw001#10 = "zzzzzzzzzzzz";
   #dscaw001#11 = "zzzzzz";
|FRUT;

|PROCESO VuelcaRecibos;
   |ABRE #dscam008;
   #dscam008#40 = #dscaw001#8;
   |LEE 010#dscam008.=;
   |CIERRA #dscam008;

   |DDEFECTO #dscam050;
   #dscam050#0 = #dscam049#0;
   #dscam050#1 = Linea;         Linea = Linea + 1;
   #dscam050#2 = #dscaw001#1;
   #dscam050#4 = #dscaw001#2;
   #dscam050#3 = #dscaw001#3;
   #dscam050#5 = #dscaw001#4;
   #dscam050#6 = #dscaw001#5;
   #dscam050#13 = #dscaw001#8;

   |SI #dscam051#121 = "N";
      eaCodigo = #dscam008#32; eaCuenta = #dscam008#5; |HAZ MiraSiBloq;
      |SI enSwErr ! 0; |MENAV "    Proveedor bloqueado"; |ERROR; |ACABA; |FINSI;
   |SINO;
      eaCliente = #dscam008#32;  eaCuenta = #dscam008#5;
      efFechaVto = #dscam049#2;
      enDocumento = #dscam008#40; |HAZ MiraCertContr;
      |SI enSwErr ! 0; |ERROR; |ACABA; |FINSI;
   |FINSI;

   |HAZ RecogeRec;
   |GRABA 020#dscam050.n;
   |LEE 010#dscam050.=;
   |HAZ Total;

   eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscam050#13; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE VuelcaRecibos;
#dscaw001#1;
7;
00001,"*";
99999,"*";
;
NULL,VuelcaRecibos;
|FIN;

|RUTINA inf01a;
   #dscaw001#0 = 1;
   #dscaw001#10 = "";
   #dscaw001#11 = "";
|FRUT;

|RUTINA sup01a;
   #dscaw001#0 = 99999;
   #dscaw001#10 = "zzzzzzzzzzzz";
   #dscaw001#11 = "zzzzzz";
|FRUT;

|RUTINA inf01b;
   #dscaw001#0 = 1;
   #dscaw001#5 = "01.01.0000";
|FRUT;

|RUTINA sup01b;
   #dscaw001#0 = 99999;
   #dscaw001#5 = "31.12.9999";
|FRUT;

|PROCESO PagAut;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0; |DDEFECTO #dscam051; |FINSI;
   |CIERRA #dscam051;
   nAutom = 0;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 1;
      Linea = 1;
      |CONFI "0400N Seleccion automatica ?";
      |SI FSalida = 0;
         |PUSHV 0501 2380;
         |PINPA #0#dscaw207; |PINDA #0#dscaw207;
         |ENDATOS #1#dscaw207;
         |SI FSalida = 0;
            |POPV;
            aFP = #dscaw207#4;
            nAutom = 1;
            Comodin = "cf" + Usuario; |NOME_DAT #4 Comodin;
            |DELINDEX #dscaw001;
            |ABRE #dscaw001;
            |ABRE #dscam050;
            Linea = 1;
            eaTipoRecibo = "C";
            |BUCLE RellenaTempo;

            |PUSHV 05012380;
            CodProv = ""; CtaProv = "";
            enSwLineal = 1; enClave = 1;
            |PARA; |SI enSwLineal ! 0; |HACIENDO;
               |SI enClave = 1; enSwLineal = 0; |ENTLINEAL #2#dscaw001,-3,4,17,1,inf01a,sup01a; |FINSI;
               |SI enClave = 2; enSwLineal = 0; |ENTLINEAL #3#dscaw001,-2,4,17,1,inf01b,sup01b; |FINSI;
            |SIGUE;
            FEstado = FSalida;
         |FINSI;
         |POPV;
         |SI FEstado = 0;
            Linea = 1;
            |BUCLE VuelcaRecibos;
         |FINSI;
         |CIERRA #dscam050;
         |CIERRA #dscaw001;
         nAutom = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO MiraDivisa;
   Divisa = #dscam049#16; |HAZ TomaDecim;
   |SI NombreDiv = "ERROR";
      |MENAV "    Divisa inexistente";
      |ERROR;
      |ACABA;
   |SINO;
      #dscam049#17 = NombreDiv; |PINTA #dscam049#17;
      #dscam049#18 = CambioDivCm;
   |FINSI;
|FPRC;

|PROCESO Decim1; |TIPO 13;
   Divisa = #dscaw001#9; |HAZ TomaDecim;
|FPRC;

|PROCESO Decim2; |TIPO 13;
   Divisa = #dscam049#16; |HAZ TomaDecim;
   |HAZ PintaTipo;
|FPRC;

|PROCESO Busca;
   |SI FSalida = 10;
      |ABRE #dscam008;
      PosLibro = 1414; PosSerie = 1417; PosFactu = 1423; PosRecib = 1430;
      |HAZ ConsultaCompras;
      |SI enDocum ! -1;
         #dscam050#13 = enDocum; |PINTA #dscam050#13;
      |SINO;
         |MENAV "    Ficha inexistente"; |ERROR;
      |FINSI;
      SwClave = 1;
      |CIERRA #dscam008;
   |FINSI;
|FPRC;

|PROCESO MiraSiCtrlC; |TIPO 7;
   eaTOperacion = "B"; eaTipoRecibo = "C"; |HAZ ProcesaTempo;
|FPRC;

|PROCESO TomaMBase;
   |HAZ TomaDecim;
   #dscam049#16 = eaMBase;       |PINTA #dscam049#16;
   #dscam049#17 = eaNombreMBase; |PINTA #dscam049#17;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 000#dscam051.c;
   |FINSI;
   |CIERRA #dscam051;
   #dscam049#22 = #dscam051#63;
|FPRC;

|PROCESO BuscaCierre;
     aAlfa = "";
     |ABRE #dscam030;
     |ABRE #dscam067;
     #dscam067#0  = "CF";
     #dscam067#1  = #dscam049#0;
     #dscam067#2  = 1;
     #dscam067#3  = "E";
     #dscam067#11 = 1;
     |LEE 000#dscam067.];
     aAlfa2 = #dscam067#3; |QBF aAlfa2;
     |SI FSalida = 0; |Y #dscam067#0  = "CF"; |Y #dscam067#1  = #dscam049#0;
               |Y #dscam067#2  = 1; |Y aAlfa2 = "E"; |Y #dscam067#11 = 1;
          #dscam030#0 = #dscam067#10;
          |LEE 000#dscam030.=
          |SI FSalida = 0;
               aAlfa = #dscam030#6;
          |FINSI;
     |SINO;
          #dscam067#0  = "CF";
          #dscam067#1  = #dscam049#0;
          #dscam067#2  = 1;
          #dscam067#3  = "V";
          #dscam067#11 = 1;
          |LEE 000#dscam067.];
          aAlfa2 = #dscam067#3; |QBF aAlfa2;
          |SI FSalida = 0; |Y #dscam067#0  = "CF"; |Y #dscam067#1  = #dscam049#0;
                    |Y #dscam067#2  = 1; |Y aAlfa2 = "V"; |Y #dscam067#11 = 1;
               #dscam030#0 = #dscam067#10;
               |LEE 000#dscam030.=;
               |SI FSalida = 0;
                    aAlfa = #dscam030#6;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #dscam067;
     |CIERRA #dscam030;

     |SI aAlfa = "";
          |MENAV "    El confirme debia tener movimientos contables, pero no se han encontrado";
          |ACABA;
     |FINSI;

     enSwError = 0;
     eaDirConta  = aAlfa; |QBF eaDirConta;
     eaEmpContab = (("00000" + #dscam067#8) % -105) + #dscam067#9;
     efFecha = #dscam067#5;
     |HAZ CompruebaEmpContable;
|FPRC;

|PROCESO PintaTipo;
   |SI #dscam049#23 = "C"; aAlfa = "CONFIRMING   "; |FINSI;
   |SI #dscam049#23 = "T"; aAlfa = "TRANSFERENCIA"; |FINSI;
   |ATRI I; |PINTA 0632, aAlfa; |ATRI N;
|FPRC;
