|FICHEROS;
   dscam051 #0;
   dscam093 #10,MANTE;
   dscam030 #11;
   dscam222 #12,MANTE;

   agif091@ #1000;
   Referen@ #1001;
|FIN;

|VARIABLES;
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = ""; &eaLlamada = "";
   &eaFicher  = ""; eaClave = "";

   &MaxDigit = 0;
   &PRMNT_enPerfil = 0;

   nPosRelat = 0;
   nPos1     = 0;
   nPos2     = 0;

   aAlfa   = "";
   nHayFPago = 0;
   aAntPerfil = "";
   Comodin = "";
   Parte   = "";
   Part1   = "";
   Part2   = "";
   Parte1  = 0;
   Parte2  = 0;
   Long    = 0;
   LongAlfa = "";
   aSerie = "";
   aDescSerie = "";
   aArticulo  = "";
   aDescArt   = "";
   nFPago     = 0;
   aDescFPago = "";

   &eaEntrada   = "";
   aClave     = "";
   &eaSalida    = "";

   nPos       = 0;
   nCont      = 0;
   nCalc      = 0;
   nNumChar   = 0;

   nTecla     = 0;
|FIN;

|PROCESO Cuenta; |TIPO 6;
   Comodin = #dscam051#Campo#;
   Comodin = Comodin - ".";
   |SI FSalida ! 0;
      Parte = FSalida;
      Parte1 = 100 + (((Parte / 100) ! 0) - 1);
      Parte2 = ((((Parte / 100) ! 0) + 1) * 100) + 99;
      Part1 = #dscam051#Campo# % Parte1;
      Part2 = #dscam051#Campo# % Parte2;
      |QBF Part2;
      Comodin = Part1 + Part2;
      LongAlfa = Comodin % 0;
      Long = MaxDigit - LongAlfa;
      LongAlfa = "0" * Long;
      Comodin = Part1 + LongAlfa + Part2;
      #dscam051#Campo# = Comodin;
      |PINTA #dscam051#Campo#;
   |FINSI;
|FPRC;

|PROCESO MiraDias;
   |SI #dscam051#34 = "N";
      #dscam051#35 = 0; |PINTA #dscam051#35;
      |C_M #dscam051#35,1,"N";
   |SINO;
      |C_M #dscam051#35,1,"S";
   |FINSI;
|FPRC;

|PROCESO ParamExtra; |TIPO 7;
   nPosRelat = 2002;

   |HAZ EsAgrogenil;
   |SI FSalida = 0;
      nPos1 = (nPosRelat * 10000) + (nPosRelat + 277);
      |CUADRO nPos1;
      nPos1 = nPosRelat + 1;
      |ATRI R; |PINTA nPos1, " INTERESES RETRASO COBRO "; |ATRI N;
      nPos1 = nPosRelat + 101;
      |PINTA nPos1, " Control retrasos (S/N) ";
      nPos1 = nPosRelat + 120; nPos2 = nPosRelat + 122;
      |ATRI I; |PINTA nPos1, "S"; |PINTA nPos2, "N"; |ATRI N;
      nPos1 = nPosRelat + 125;
      |C_P #dscam051#43,1,nPos1; |C_V #dscam051#43,1,"S";
      |C_M #dscam051#43,1,"S";  |PINTA #dscam051#43;
      |HAZ EsVilamino;
      |SI FSalida = 0;
         nPos1 = ((nPosRelat + 200) * 10000) + (nPosRelat + 477);
         |CUADRO nPos1;
         nPos1 = nPosRelat + 201;
         |ATRI R; |PINTA nPos1, " CONTROL VISADOS A PROVEEDORES"; |ATRI N;
         nPos1 = nPosRelat + 301;
         |PINTA nPos1, " Control visados a proveedores (S/N) ";
         nPos1 = nPosRelat + 333; nPos2 = nPosRelat + 335;
         |ATRI I; |PINTA nPos1, "S"; |PINTA nPos2, "N"; |ATRI N;
         nPos1 = nPosRelat + 339;
         |C_P #dscam051#109,1,nPos1; |C_V #dscam051#109,1,"S";
         |C_M #dscam051#109,1,"S";  |PINTA #dscam051#109;
      |SINO;
         nPos1 = ((nPosRelat + 200) * 10000) + (nPosRelat + 477);
         |BLANCO nPos1;
         aAlfa = "ศออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผ";
         nPos1 = nPosRelat + 200; |PINTA nPos1, aAlfa;
         |C_M #dscam051#109,1,"N"; |C_V #dscam051#109,1,"N";
      |FINSI;
   |SINO;
      |HAZ EsVilamino;
      |SI FSalida = 0;
         nPos1 = (nPosRelat * 10000) + (nPosRelat + 277);
         |CUADRO nPos1;
         nPos1 = nPosRelat + 1;
         |ATRI R; |PINTA nPos1, " CONTROL VISADOS A PROVEEDORES"; |ATRI N;
         nPos1 = nPosRelat + 101;
         |PINTA nPos1, " Control visados a proveedores (S/N) ";
         nPos1 = nPosRelat + 133; nPos2 = nPosRelat + 135;
         |ATRI I; |PINTA nPos1, "S"; |PINTA nPos2, "N"; |ATRI N;
         nPos1 = nPosRelat + 139;
         |C_P #dscam051#109,1,nPos1; |C_V #dscam051#109,1,"S";
         |C_M #dscam051#109,1,"S";  |PINTA #dscam051#109;
      |SINO;
         nPos1 = (nPosRelat * 10000) + (nPosRelat + 277);
         |BLANCO nPos1;
         aAlfa = "ศออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผ";
         |PINTA nPosRelat, aAlfa;
         |C_M #dscam051#43,1,"N"; |C_V #dscam051#43,1,"N";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO TomaDatos;
   |SI #dscam051#48 = "S";
      nHayFPago = 0;
      aAlfa = #48#17; |QBF aAlfa;
      aAlfa = aAlfa + "def/agifa091.mas";
      |CARGA_DEF aAlfa , agif091@;
      |SI FSalida = 0;
         nHayFPago = 1;
         aAlfa = #48#17; |QBF aAlfa;
         aAlfa = aAlfa + "fich/" + (("00000" + #48#15) % -105) + "/";
         |PATH_DAT #1000 aAlfa; |ABRE #agif091@;
      |FINSI;

      aSerie    = #dscam051#49; aDescSerie = #dscam051#50;
      aArticulo = #dscam051#51; aDescArt   = #dscam051#52;
      nFPago    = #dscam051#54; aDescFPago = #dscam051#55;

      |PUSHV 1741 2380;
      |BLANCO 1741 2380;
      |CUADRO 1741 2380;
      |ATRI R; |PINTA 1741 , "Datos para la factura "; |ATRI N;
      |PINTA 1842, "Serie                                ";
      |PINTA 1942, "Articulo                             ";
      |PINTA 2042, "                                     ";
      |PINTA 2142, "F.Pago                               ";
      |PINTA 1848, #dscam051#49; |PINTA 1854, #dscam051#50;
      |PINTA 1952, #dscam051#51; |PINTA 2042, #dscam051#52;
      |PINTA 2149, #dscam051#54; |PINTA 2152, #dscam051#55;

      |ET OtraSer;
      E_sup  = 5; E_inf  = "";
      aSerie = 1848 ? 1;
      |SI FSalida ! 0;
         |SI FSalida = 7;
            aSerie = ""; |VETE Final;
         |FINSI;
      |FINSI;

      |ET OtraDSer;
      E_sup = 26; E_inf = "";
      aDescSerie = 1854 ? 1;
      |SI FSalida ! 0;
         |SI FSalida = 2; |VETE OtraSer; |FINSI;
         |SI FSalida = 3; |VETE OtroArt; |FINSI;
         |SI FSalida = 7;
            aSerie = ""; aDescSerie = ""; |VETE Final;
         |FINSI;
      |FINSI;

      |ET OtroArt;
      E_sup = 20; E_inf = "";
      aArticulo = 1952 ? 1;
      |SI FSalida ! 0;
         |SI FSalida = 2; |VETE OtraDSer; |FINSI;
         |SI FSalida = 3; |VETE OtroDArt; |FINSI;
         |SI FSalida = 7;
            aSerie = ""; aDescSerie = ""; aArticulo = ""; |VETE Final;
            |VETE Final;
         |FINSI;
      |FINSI;

      |ET OtroDArt;
      E_sup = 38; E_inf = "";
      aDescArt = 2042 ? 1;
      |SI FSalida ! 0;
         |SI FSalida = 2; |VETE OtroArt;   |FINSI;
         |SI FSalida = 3; |VETE OtroFPago; |FINSI;
         |SI FSalida = 7;
            aSerie = ""; aDescSerie = ""; aArticulo = ""; aDescArt = ""; |VETE Final;
            |VETE Final;
         |FINSI;
      |FINSI;

      |MENSA "    <F2> Consulta formas de pago";
      |ET OtroFPago;
      E_sup = 99; E_inf = 0;
      nFPago = 2149 ? 1;
      |SI FSalida ! 0;
         |SI FSalida = 2; |VETE OtroDArt; |FINSI;
         |SI FSalida = 10;
            #agif091@#0 = nFPago;
            |LEE 000#agif091@.];
            |CONSULTA_CLAVE #1#agif091@;
            |SI FSalida = 0;
               nFPago = #agif091@#0; aDescFPago = #agif091@#1;
               |PINTA 2152, #agif091@#1;
            |FINSI;
            |VETE OtroFPago;
         |FINSI;
         |SI FSalida = 7;
            aSerie = ""; aDescSerie = ""; aArticulo = ""; aDescArt = "";
            nFPago = 0;  aDescFPago = ""; |VETE Final;
         |FINSI;
      |FINSI;
      |SI nHayFPago = 1;
         |CIERRA #agif091@; |DESCARGA_DEF #agif091@;
      |FINSI;
|ET Final;
      |MENSA "     ";
      |POPV;
      #dscam051#49 = aSerie;    #dscam051#50 = aDescSerie;
      #dscam051#51 = aArticulo; #dscam051#52 = aDescArt;
      #dscam051#54 = nFPago;    #dscam051#55 = aDescFPago;
   |SINO;
      #dscam051#49 = ""; #dscam051#50 = "";
      #dscam051#51 = ""; #dscam051#52 = "";
      #dscam051#54 = 0;  #dscam051#55 = "";
   |FINSI;
|FPRC;

|PROCESO EnlacesAcotados;
   |SI FSalida = 10;
      |PUSHV 0501 2380; |BLANCO 1111 1868;
      |ABRE #dscam222;
      |SI Campo = 21; #dscam222#0 = "C"; |FINSI;
      |SI Campo = 22; #dscam222#0 = "P"; |FINSI;
      |LEE 101#dscam222.=;
      |SI FSalida ! 0;
         |DDEFECTO #dscam222;
         |SI Campo = 21; #dscam222#0 = "C"; |FINSI;
         |SI Campo = 22; #dscam222#0 = "P"; |FINSI;
         |GRABA 020#dscam222.b;
      |FINSI;
      |PINPA #0#dscam222; |PINDA #0#dscam222;
      |ATRI R;
      |SI Campo = 21; |PINTA 1112, " Cod.Enlaces Cobros "; |FINSI;
      |SI Campo = 22; |PINTA 1112, " Cod.Enlaces Pagos  "; |FINSI;
      |ATRI N;

      |MENSA "    <F11> Consulta enlaces";
      |ENDATOS #1#dscam222;
      |SI FSalida = 0;
         |GRABA 020#dscam222.a;
         #dscam051#Campo# = "";
         |PINTA #dscam051#Campo#;
      |FINSI;
      |CIERRA #dscam222;
      |BLIN 4;
      |POPV;
      |PINTA #dscam051#Campo#;
   |FINSI;
|FPRC;

|PROCESO LinCodigos;
   |SI FSalida = 10;
      |PUSHV 0501 2380;
      |ABRE #dscam093;
      |SI Campo = 24; #dscam093#0 = "A"; |FINSI;
      |SI Campo = 25; #dscam093#0 = "V"; |FINSI;
      |SI Campo = 53; #dscam093#0 = "E"; |FINSI;
      |LEE 101#dscam093.=;
      |SI FSalida ! 0;
         |DDEFECTO #dscam093;
         |SI Campo = 24; #dscam093#0 = "A"; |FINSI;
         |SI Campo = 25; #dscam093#0 = "V"; |FINSI;
         |SI Campo = 53; #dscam093#0 = "E"; |FINSI;
         |GRABA 020#dscam093.b;
      |FINSI;
      |PINPA #0#dscam093; |PINDA #0#dscam093;
      |ATRI R;
      |SI Campo = 24; |PINTA 1342, " Cod.Enlaces Abono remesas          "; |FINSI;
      |SI Campo = 25; |PINTA 1342, " Cod.Enlaces Vencimto. remesas      "; |FINSI;
      |SI Campo = 53; |PINTA 1342, " Cod.Enlaces Emision remesas        "; |FINSI;
      |ATRI N;

      |MENSA "    <F11> Consulta enlaces";
      |ENDATOS #1#dscam093;
      |SI FSalida = 0;
         |GRABA 020#dscam093.a;
         #dscam051#Campo# = "";
         |PINTA #dscam051#Campo#;
      |FINSI;
      |CIERRA #dscam093;
      |BLIN 4;
      |POPV;
      |PINTA #dscam051#Campo#;
   |FINSI;
|FPRC;

|PROCESO PintaEnlace; |TIPO 7;
   |SI Campo = 53; |O Campo = 24; |O Campo = 25;
      |MENSA "    <F2> Enlaces por tipo de remesa, <F11> Consulta enlaces";
   |SINO;
      |SI Campo = 21; |O Campo = 22;
         |MENSA "    <F2> Enlaces acotados por cuenta, <F11> Consulta enlaces";
      |SINO;
         |MENSA "    <F11> Consulta enlaces";
      |FINSI;
   |FINSI;

   |ABRE #dscam030;
   #dscam030#0 = #dscam051#Campo#;
   |LEE 000#dscam030.=;
   |SI FSalida = 0;
      |ATRI R; |PINTA 0543, #dscam030#1; |ATRI N;
   |FINSI;
   |CIERRA #dscam030;
|FPRC;

|PROCESO BorraEnlace;
   ||PINTA 0642, " Empresa contable por serie ... ";
   |ATRI R; |PINTA 0543, "                                   "; |ATRI N;
   |BLIN 4;
|FPRC;

|PROCESO ConsultaEnlaces; |TIPO 66;
   |ABRE #dscam030;
   #dscam030#0 = #dscam051#Campo#;
   |LEE 000#dscam030.];
   |CONSULTA_CLAVE #1#dscam030;
   |SI FSalida = 0;
      #dscam051#Campo# = #dscam030#0; |PINTA #dscam051#Campo#;
   |FINSI;
   |CIERRA #dscam030;
   |HAZ PintaEnlace;
   |ERROR;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA "Parametros generales";

   |HAZ Tipo8;

   |ABRE #dscam051;
   |LEE 101#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 101#dscam051.p;
   |SINO;
      |SI #dscam051#101 = " ";
         #dscam051#101 = "S";
         |GRABA 020#dscam051.a;
      |FINSI;
   |FINSI;

   aAntPerfil = #dscam051#47;

   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |GRABA 020#dscam051.a;
      |SI #dscam051#47 = "S"; |Y aAntPerfil = "N";
         |CLS; |HAZ Entrada;
         eaUsuario = Usuario % 0810;
         eaTipoReg = "";  eaNumero = ""
         eaDescr   = "CAMBIO EN PARAMETROS GENERALES DE NO USAR PERFILES A PERFIL " + PRMNT_enPerfil;
         eaTipoOp  = ""; enImpAnt = 0;
         eaFicher = "dscam051"; eaClave = "";
         enImpAct  = 0; |HAZ GrabaAudit;
      |FINSI;
   |FINSI;
   |LIBERA #dscam051; |CIERRA #dscam051;

   |HAZ Tipo9;
|FPRO;

|PROCESO MiraVtos;
   |SI #dscam051#76 = "S";
      |C_M #dscam051#77,1,"S";
   |SINO;
      |C_M #dscam051#77,1,"N";
      #dscam051#77 = 0; |PINTA #dscam051#77;
   |FINSI;
|FPRC;

|PROCESO PideClave; |TIPO 0;
   eaEntrada = #dscam051#92;
   |HAZ Encriptado;
   aClave = eaSalida;
   |C_P #dscam051#87,0,nPos;

   E_sup = 20;
   E_inf = "";
   aClave = nPos ? -1;

   aAlfa = aClave; |QBF aAlfa;
   aAlfa = aAlfa % 0; nCalc = aAlfa;
   aAlfa = "*" * nCalc;
   #dscam051#87 = aAlfa; |PINTA #dscam051#87;
   eaEntrada = aClave;
   |HAZ Encriptado;
   #dscam051#92 = eaSalida;
|FPRC;

|PROCESO MiraCtaAn;
  nTecla = FSalida;

  aAlfa = #48#16; |QBF aAlfa;
  aAlfa = aAlfa + "def/anm00001.mas";
  |CARGA_DEF aAlfa, Referen@;
  |SI FSalida = 0;
     aAlfa = #48#16; |QBF aAlfa;
     aAlfa = aAlfa + "fich/" + (("00000" + #48#14) % -105) + #48#19 + "/";
     |PATH_DAT #Referen@#aAlfa#;
     |ABRE #Referen@;
     |SI nTecla = 10;
        |CONSULTA_CLAVE #1#Referen@;
        |SI FSalida = 0;
           #dscam051#99 = #Referen@#0; |PINTA #dscam051#99;
        |FINSI;
     |FINSI;
     #Referen@#0 = #dscam051#99;
     |LEE 000#Referen@.=;
     |SI FSalida ! 0; |Y #dscam051#99 ! "       ";
        |MENAV "    No existe la cuenta analitica indicada"; |ERROR;
     |FINSI;
     |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
  |FINSI;
|FPRC;

|PROCESO Analiticas; |TIPO 7;
|ACABA;
   |HAZ EsTaller;
   |SI FSalida = 0;
      |C_M #dscam051#99, 1, "S"; |C_V #dscam051#99, 1, "S";
      |PINTA 2104, "Cta.Analitica Gtos.Impagados"; |PINTA #dscam051#99;
   |SINO;
      |C_M #dscam051#99, 1, "N"; |C_V #dscam051#99, 1, "N";
      |PINTA 2104, "                                            ";
   |FINSI;
|FPRC;

|PROCESO CompruebaBloq;
   |SI #dscam051#121 ! "N";
      |DBASS aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "basica/def/tadm0001.mas";
      |CARGA_DEF aAlfa, Referen@;
      |SI FSalida = 0;
         |DESCARGA_DEF #Referen@;
      |SINO;
         |MENAV "    No se puede activar esta opcion. IPBASICA no esta instalada o esta desactualizada";
         #dscam051#121 = "N"; |PINTA #dscam051#121;
         |ERROR; |ACABA;
      |FINSI;
   |FINSI;

   |SI #dscam051#121 ! "N"; |Y #dscam051#96 = "S";
      |MENAV "    El bloqueo de proveedores esta activado. Recuerde que el parametro actual prevalecera sobre el bloqueo.";
   |FINSI;
|FPRC;

|PROCESO EscondePar; |TIPO 7;
   |HAZ EsLuxe;
   |SI FSalida ! 0;
      |C_V #dscam051#122, 1, "N";

      |C_V #dscam051#134, 1, "S";
      |C_P #dscam051#134, 1, 2277;
      |PINTA #dscam051#134;
      |PINTA 2241, "Contador por 'huecos'..............";
      |PINTA 2340, "ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ";
   |FINSI;
|FPRC;

|PROCESO Ayuda105;
   |SI FSalida ! 10; |ACABA; |FINSI;

   |PUSHV 0501 2380;
   |BLANCO 0840 1579;
   |CUADRO 0840 1579;
   |ATRI S;
   |PINTA 0942, " Acumula por serie la comprobaciขn";
   |PINTA 1042, " del aviso de riesgo superado. Si ";
   |PINTA 1142, " se activa, solo se tiene en cuenta";
   |PINTA 1242, " el riesgo de la empresa de cartera";
   |PINTA 1342, " vinculada ";
   |ATRI N;

   |PAUSA;
   |POPV;
|FPRC;

|PROCESO ComprobarRiesgos;
   |SI #dscam051#3 = "S";
      |C_M #dscam051#123, 1, "S";
      |C_M #dscam051#124, 1, "S";
   |SINO;
      #dscam051#123 = "N"; |PINTA #dscam051#123; |C_M #dscam051#123, 1, "N";
      #dscam051#124 = "N"; |PINTA #dscam051#124; |C_M #dscam051#124, 1, "N";
   |FINSI;
|FPRC;
