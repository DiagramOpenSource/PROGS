|FICHEROS;
   dscaz059 #0;

   agif041@ #8;
   agif024@ #9;
   agif025@ #10;
   agif112@ #11;

   agif134@ #12;
   agif084@ #13;
   agif079@ #14;

   caclipr@ #15;
   canempr@ #16;
   camaniv@ #17;

   dscam003 #20;
   dscam008 #22;
   dscaw044 #23;
|FIN;

|VARIABLES;
   Comodin = ""; Comodin1 = ""; Comodin2 = "";
   SwAbiertos = 0;

   SwHayDatos = 0;
   aAlfa   = "";
   aAlfa1  = "";
   aCuenta = "";

   nNivel  = 0;
   nNivel1 = 0; nNivel2 = 0;
   nNivel3 = 0; nNivel4 = 0;
   nNivel5 = 0; nNivel6 = 0;

   aLong = ""; nLong = 0;

|FIN;

|PROCESO SacaNivel1;
   |QBF aCuenta;
   aLong = aCuenta % 0; nLong = aLong;
   nNivel = 0;
   |SI nLong = nNivel1; nNivel = 1; |FINSI;
   |SI nLong = nNivel2; nNivel = 2; |FINSI;
   |SI nLong = nNivel3; nNivel = 3; |FINSI;
   |SI nLong = nNivel4; nNivel = 4; |FINSI;
   |SI nLong = nNivel5; nNivel = 5; |FINSI;
   |SI nLong = nNivel6; nNivel = 6; |FINSI;
|FPRC;

|PROCESO AbreFichs1;

   |SI FSalida = 10;
      |DBASS Comodin; |QBF Comodin;
      Comodin = Comodin + "dscomer9/";
      #dscaz059#0 = Comodin;
      |ERROR; |ACABA;
   |FINSI;

   Comodin = #dscaz059#0; |QBF Comodin;
   Comodin = Comodin % -101;
   |SI Comodin ! "/";
      Comodin = #dscaz059#0; |QBF Comodin;
      Comodin = Comodin + "/";
      #dscaz059#0 = Comodin;
      |PINTA #dscaz059#0;
   |FINSI;

   Comodin = #dscaz059#0; |QBF Comodin;
   Comodin1 = Comodin + "def/agifa041.mas";
   |CARGA_DEF Comodin1,agif041@;
   |SI FSalida = 0;
      Comodin1 = Comodin + "fich/"; |PATH_DAT #8 Comodin1;
      |ABRE #agif041@;
      SwAbiertos = 1;
      Comodin1 = Comodin + "def/agifa024.mas"; |CARGA_DEF Comodin1,agif024@;
      Comodin1 = Comodin + "def/agifa025.mas"; |CARGA_DEF Comodin1,agif025@;
      Comodin1 = Comodin + "def/agifa112.mas"; |CARGA_DEF Comodin1,agif112@;
      Comodin1 = Comodin + "def/agifa134.mas"; |CARGA_DEF Comodin1,agif134@;
      Comodin1 = Comodin + "def/agifa084.mas"; |CARGA_DEF Comodin1,agif084@;
      Comodin1 = Comodin + "def/agifa079.mas"; |CARGA_DEF Comodin1,agif079@;
   |SINO;
      |MENAV "    No encuentro el fichero de empresas";
      |ERROR; |ACABA;
   |FINSI;
|FPRC;

|PROCESO AbreFichs2;
   |SI FSalida = 10;
      |DBASS Comodin; |QBF Comodin;
      Comodin = Comodin + "contagen/";
      #dscaz059#4 = Comodin;
      |ERROR; |ACABA;
   |FINSI;

   Comodin = #dscaz059#4; |QBF Comodin;
   Comodin1 = Comodin + "def/canempre.mas";
   |CARGA_DEF Comodin1,canempr@;
   |SI FSalida = 0;
      Comodin1 = Comodin + "fich/"; |PATH_DAT #16 Comodin1;
      |ABRE #canempr@;
      SwAbiertos = 1;
      Comodin1 = Comodin + "def/caclipro.mas"; |CARGA_DEF Comodin1,caclipr@;
      Comodin1 = Comodin + "def/camaniva.mas"; |CARGA_DEF Comodin1,camaniv@;
   |SINO;
      |CIERRA #agif079@; |DESCARGA_DEF #agif079@;
      |CIERRA #agif084@; |DESCARGA_DEF #agif084@;
      |CIERRA #agif134@; |DESCARGA_DEF #agif134@;
      |CIERRA #agif112@; |DESCARGA_DEF #agif112@;
      |CIERRA #agif025@; |DESCARGA_DEF #agif025@;
      |CIERRA #agif024@; |DESCARGA_DEF #agif024@;
      |CIERRA #agif041@; |DESCARGA_DEF #agif041@;
      SwAbiertos = 0;
      |MENAV "    No encuentro el fichero de empresas de contabilidad";
      |ERROR; |ACABA;
   |FINSI;
|FPRC;

|PROCESO ConsultaEmpresa;
   |SI FSalida = 2; |ACABA; |FINSI;

   |SI Campo = 1;
      |SI FSalida = 10;
         |CONSULTA_CLAVE #1#agif041@;
         #dscaz059#1 = (("00000" + #agif041@#0) % -105);
         #dscaz059#2 = #agif041@#1;
         |PINTA #dscaz059#1; |PINTA #dscaz059#2;
      |SINO;
         #agif041@#0 = #dscaz059#1;
         |LEE 101#agif041@.=;
         |SI FSalida = 0;
            #dscaz059#1 = (("00000" + #agif041@#0) % -105);
            #dscaz059#2 = #agif041@#1;
            |PINTA #dscaz059#1; |PINTA #dscaz059#2;
         |SINO;
            |MENAV "    No existe empresa";
            |ERROR; |ACABA;
         |FINSI;
         |LIBERA #agif041@;
      |FINSI;
   |SINO;
      |SI FSalida = 10;
         |CONSULTA_CLAVE #1#canempr@;
         aAlfa = (("00000" + #canempr@#2) % -105);
         #dscaz059#5 = aAlfa;
         #dscaz059#6 = #canempr@#3;
         #dscaz059#7 = #canempr@#1;
         |PINTA #dscaz059#5; |PINTA #dscaz059#6; |PINTA #dscaz059#7;
      |SINO;
         #canempr@#2 = #dscaz059#5;
         #canempr@#3 = #dscaz059#6;
         |LEE 101#canempr@.=;
         |SI FSalida = 0;
            aAlfa = (("00000" + #canempr@#2) % -105);
            #dscaz059#5 = aAlfa;
            #dscaz059#6 = #canempr@#3;
            #dscaz059#7 = #canempr@#1;
            |PINTA #dscaz059#5; |PINTA #dscaz059#6; |PINTA #dscaz059#7;
            nNivel1 = #canempr@#14; nNivel2 = #canempr@#15;
            nNivel3 = #canempr@#16; nNivel4 = #canempr@#17;
            nNivel5 = #canempr@#18; nNivel6 = #canempr@#19;
         |SINO;
            |MENAV "    No existe empresa";
            |ERROR; |ACABA;
         |FINSI;
         |LIBERA #canempr@;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO RecibosVentaG;
   #agif025@#0 = #agif024@#25;
   |LEE 000#agif025@.=;
   |SI FSalida ! 0;
      #agif025@#0 = #agif024@#26;
      |LEE 000#agif025@.=;
      |SI FSalida ! 0; |DDEFECTO #agif025@; |FINSI;
   |FINSI;

   #dscam003#5  = #agif024@#16; || Cuenta contable
   #dscam003#6  = #agif024@#1;  || Nombre fiscal del cliente
   #dscam003#33 = #agif025@#0;  || Codigo del representante
   #dscam003#34 = #agif025@#1;  || Nombre del representante
   #dscam003#39 = #agif024@#3;  || Zona del cliente
   #dscam003#51 = #agif024@#203;|| Banco de remesas
   aAlfa = #dscam003#8; |QBF aAlfa; || Codigo Entidad
   |SI aAlfa = "";
      #dscam003#7  = #agif024@#29;
      #dscam003#8  = #agif024@#32;
      #dscam003#9  = #agif024@#33;
      #dscam003#10 = #agif024@#31;
      #dscam003#11 = #agif024@#30;
   |FINSI;
   |GRABA 020#dscam003.a; |LIBERA #dscam003;
|FPRC;

|PROCESO RecibosVentaC;

   #dscaw044#0 = "C";
   #dscaw044#1 = #caclipr@#10;
   #dscaw044#2 = #caclipr@#11;
   |LEE 000#dscaw044.=;
   |SI FSalida = 0;
      #dscam003#32 = #dscaw044#3;
   |FINSI;

   #dscam003#6  = #caclipr@#1;  || Nombre del cliente
   aAlfa = #dscam003#8; |QBF aAlfa; || Codigo Entidad
   |SI aAlfa = "";
      #dscam003#7  = #caclipr@#13;
      #dscam003#8  = #caclipr@#29;
      #dscam003#9  = #caclipr@#30;
      #dscam003#10 = #caclipr@#31;
      #dscam003#11 = #caclipr@#32;
   |FINSI;
   |GRABA 020#dscam003.a; |LIBERA #dscam003;
|FPRC;

|PROCESO RecibosVenta;
   |SI #dscam003#32 = "      "; |Y #dscam003#5 = "            ";
      #agif134@#49 = #dscam003#0;
      #agif134@#0  = #dscam003#1;
      |LEE 000#agif134@.=;
      |SI FSalida = 0;
         #dscam003#32 = #agif134@#2;
         |GRABA 020#dscam003.a;
      |SINO;
         #agif084@#48 = #dscam003#0;
         #agif084@#0  = #dscam003#1;
         |LEE 000#agif084@.=;
         |SI FSalida = 0;
            #dscam003#32 = #agif084@#3;
            |GRABA 020#dscam003.a;
         |SINO;
            |SELECT #3#camaniv@;
            #camaniv@#0 = #dscam003#27;
            #camaniv@#2 = #dscam003#0;
            #camaniv@#3 = #dscam003#1;
            |LEE 000#camaniv@.=;
            |SI FSalida = 0;
               #dscam003#5 = #camaniv@#12;
               |GRABA 020#dscam003.a;
            |FINSI;
            |SELECT #1#camaniv@;
         |FINSI;
      |FINSI;
   |FINSI;

   #agif024@#0 = #dscam003#32; |LEE 000#agif024@.=;
   |SI FSalida = 0; |Y #agif024@#0 ! "      "; |HAZ RecibosVentaG; |ACABA; |FINSI;

   #caclipr@#23 = "C";
   #caclipr@#10 = #dscam003#5;
   aCuenta = #dscam003#5; |HAZ SacaNivel1;
   #caclipr@#11 = nNivel;
   |LEE 000#caclipr@.=;
   |SI FSalida = 0; |HAZ RecibosVentaC; |FINSI;
|FPRC;

|DEFBUCLE RecibosVenta;
#dscam003#1;
;
000000001;
999999999;
be;
NULL,RecibosVenta;
|FIN;

|PROCESO RecibosCompraG;
   #dscam008#5  = #agif112@#10; || Cuenta de proveedor
   #dscam008#6  = #agif112@#1;  || Nombre de proveedor
   aAlfa = #dscam008#8; |QBF aAlfa; || Codigo Entidad
   |SI aAlfa = "";
      #dscam008#7  = #agif112@#11;
      #dscam008#8  = #agif112@#14;
      #dscam008#9  = #agif112@#15;
      #dscam008#10 = #agif112@#13;
      #dscam008#11 = #agif112@#12;
   |FINSI;
   |GRABA 020#dscam008.a; |LIBERA #dscam008;
|FPRC;

|PROCESO RecibosCompraC;
   #dscaw044#0 = "P";
   #dscaw044#1 = #caclipr@#10;
   #dscaw044#2 = #caclipr@#11;
   |LEE 000#dscaw044.=;
   |SI FSalida = 0;
      #dscam008#32 = #dscaw044#3;
   |FINSI;

   #dscam008#6  = #caclipr@#1;      || Nombre de proveedor
   aAlfa = #dscam008#8; |QBF aAlfa; || Codigo Entidad
   |SI aAlfa = "";
      #dscam008#7  = #caclipr@#13;
      #dscam008#8  = #caclipr@#29;
      #dscam008#9  = #caclipr@#30;
      #dscam008#10 = #caclipr@#31;
      #dscam008#11 = #caclipr@#32;
   |FINSI;
   |GRABA 020#dscam008.a; |LIBERA #dscam008;
|FPRC;

|PROCESO RecibosCompra;
   |SI #dscam008#32 = "      "; |Y #dscam008#5 = "            ";
      #agif079@#49 = #dscam008#0;
      #agif079@#0  = #dscam008#1;
      |LEE 000#agif079@.=;
      |SI FSalida = 0;
         #dscam008#32 = #agif079@#2;
         |GRABA 020#dscam008.a;
      |SINO;
         |SELECT #3#camaniv@;
         #camaniv@#0 = #dscam008#27;
         #camaniv@#2 = #dscam008#0;
         #camaniv@#3 = #dscam008#1;
         |LEE 000#camaniv@.=;
         |SI FSalida = 0;
            #dscam008#5 = #camaniv@#12;
            |GRABA 020#dscam008.a;
         |FINSI;
         |SELECT #1#camaniv@;
      |FINSI;
   |FINSI;

   #agif112@#0 = #dscam008#32; |LEE 000#agif112@.=;
   |SI FSalida = 0; |Y #dscam008#32 ! "      "; |HAZ RecibosCompraG; |ACABA; |FINSI;

   #caclipr@#23 = "P";
   #caclipr@#10 = #dscam008#5;
   aCuenta = #dscam008#5; |HAZ SacaNivel1;
   #caclipr@#11 = nNivel;
   |LEE 000#caclipr@.=;
   |SI FSalida = 0; |HAZ RecibosCompraC; |FINSI;
|FPRC;

|DEFBUCLE RecibosCompra;
#dscam008#1;
;
000000001;
999999999;
be;
NULL,RecibosCompra;
|FIN;

|PROCESO RellenaTempoC;
   |DDEFECTO #dscaw044;
   #dscaw044#0 = "C";
   #dscaw044#1 = #agif024@#16;
   aCuenta = #dscaw044#1; |HAZ SacaNivel1;
   #dscaw044#2 = nNivel;
   #dscaw044#3 = #agif024@#0;
   |GRABA 020#dscaw044.n;
|FPRC;

|DEFBUCLE RellenaTempoC;
#agif024@#1001;
;
"      ";
"zzzzzz";
;
NULL,RellenaTempoC;
|FIN;

|PROCESO RellenaTempoP;
   |DDEFECTO #dscaw044;
   #dscaw044#0 = "P";
   #dscaw044#1 = #agif112@#10;
   aCuenta = #dscaw044#1; |HAZ SacaNivel1;
   #dscaw044#2 = nNivel;
   #dscaw044#3 = #agif112@#0;
   |GRABA 020#dscaw044.n;
|FPRC;

|DEFBUCLE RellenaTempoP;
#agif112@#1001;
;
"      ";
"zzzzzz";
;
NULL,RellenaTempoP;
|FIN;

|PROGRAMA;
   |HAZ Tipo8;

   |CLS;
   |CABEZA "Importacion desde contabilidad";
   SwAbiertos = 0;

   |ABRE #dscaz059;
   |LEE 000#dscaz059.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscaz059;
      |GRABA 000#dscaz059.c;
   |FINSI;

   |PINPA #0#0; |PINDA #0#0;

   |ENDATOS #1#0;
   |SI FSalida = 0;
      |GRABA 020#dscaz059.a;

      Comodin = #dscaz059#0; |QBF Comodin;
      Comodin2 = ("00000" + #dscaz059#1) % -105;
      Comodin = Comodin + "fich/" + Comodin2 + "/";
      |PATH_DAT #9  Comodin; |ABRE #agif024@;
      |PATH_DAT #10 Comodin; |ABRE #agif025@;
      |PATH_DAT #11 Comodin; |ABRE #agif112@;
      |PATH_DAT #12 Comodin; |ABRE #agif134@;
      |PATH_DAT #13 Comodin; |ABRE #agif084@;
      |PATH_DAT #14 Comodin; |ABRE #agif079@;

      Comodin = #dscaz059#4; |QBF Comodin;
      Comodin2 = (("00000" + #dscaz059#5) % -105) + #dscaz059#6;
      Comodin = Comodin + "fich/" + Comodin2 + "/";
      |PATH_DAT #15 Comodin; |ABRE #caclipr@;
      |PATH_DAT #17 Comodin; |ABRE #camaniv@;

      |ABRE #dscam003;
      |ABRE #dscam008;
      |DELINDEX #dscaw044; |ABRE #dscaw044;

      |BUCLE RellenaTempoC; |BUCLE RellenaTempoP;
      |SELECT #2#dscaw044;
      |BUCLE RecibosVenta;
      |BUCLE RecibosCompra;
      |SELECT #1#dscaw044;

      |CIERRA #dscaw044;
      |CIERRA #dscam008;
      |CIERRA #dscam003;

      |CIERRA #camaniv@; |DESCARGA_DEF #camaniv@;
      |CIERRA #caclipr@; |DESCARGA_DEF #caclipr@;
      |CIERRA #canempr@; |DESCARGA_DEF #canempr@;
      |CIERRA #agif112@; |DESCARGA_DEF #agif079@;
      |CIERRA #agif112@; |DESCARGA_DEF #agif084@;
      |CIERRA #agif112@; |DESCARGA_DEF #agif134@;
      |CIERRA #agif112@; |DESCARGA_DEF #agif112@;
      |CIERRA #agif025@; |DESCARGA_DEF #agif025@;
      |CIERRA #agif024@; |DESCARGA_DEF #agif024@;
      |CIERRA #agif041@; |DESCARGA_DEF #agif041@;
   |FINSI;

   |CIERRA #dscaz059;
|FPRO;
