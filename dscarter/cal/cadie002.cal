|FICHEROS;
   cadie002 #0;
   cadie500 #1;
   cadie501 #2;

   dscam003 #10;
   dscam004 #11;
|FIN;

|VARIABLES;
   &Divisa    = "";
   DesdeRep   = "";
   HastaRep   = "";
   aAntRep    = "ZZZZ";

   Primero    = 0;
   nTotalPend = 0;
   nPendAnt   = 0;
   nComiDev   = 0;
|FIN;

|PROCESO Listado;
   |SI aAntRep ! #cadie501#13;
      |SI Primero = 0;
         Primero = 1;
      |SINO;
         |PIEINF;
      |FINSI;
      aAntRep = #cadie501#13;
   |FINSI;
   |PRINT;
|FPRC;

|DEFBUCLE Listado;
#cadie501#2;
;
#cadie002#0,"  ";
#cadie002#0,"zz";
;
NULL,Listado;
|FIN;

|PROCESO BuscaAnt;
   nPendAnt = nPendAnt + #cadie501#10;
   nComiDev = nComiDev + #cadie501#12;
|FPRC;

|DEFBUCLE BuscaAnt;
#cadie501#1;
;
#dscam003#40,"01.01.0000";
#dscam003#40,#cadie002#0;
;
NULL,BuscaAnt;
|FIN;

|PROCESO RecibosLin;
   nTotalPend = nTotalPend - (#dscam004#44 - #dscam004#46);
|FPRC;

|DEFBUCLE RecibosLin;
#dscam004#4;
;
"RPT", #dscam003#40;
"RPT", #dscam003#40;
;
NULL,RecibosLin;
|FIN;

|PROCESO Historico1;
   #dscam003#40 = #cadie500#0;
   |LEE 000#dscam003.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   nTotalPend = #dscam003#31;
   |SI #dscam003#14 = "A"; nTotalPend = 0; |FINSI;
   |SI #dscam003#14 = "D"; nTotalPend = 0; |FINSI;
   |SI #dscam003#14 = "T"; |BUCLE RecibosLin; |FINSI;
   |SI #cadie500#10 = nTotalPend;   |ACABA; |FINSI;
   |SI #cadie500#12 = #cadie500#13; |ACABA; |FINSI;

   |SI #cadie002#1 = "S";
      #cadie501#0  = #dscam003#40;
      #cadie501#8  = #cadie002#0;
      |LEE 000#cadie501.=;
      |SI FSalida = 0; |BORRA 020#cadie501.a; |FINSI;

      nPendAnt = 0; nComiDev = 0;
      |BUCLE BuscaAnt;

      |DDEFECTO #cadie501;
      #cadie501#0  = #cadie500#0;
      #cadie501#1  = #cadie500#1;
      #cadie501#2  = #cadie500#2;
      #cadie501#3  = #cadie500#3;
      #cadie501#4  = #cadie500#4;
      #cadie501#5  = #cadie500#5;
      #cadie501#6  = #cadie500#7;
      #cadie501#7  = #cadie500#8;
      #cadie501#8  = #cadie002#0;
      ||#cadie501#9  = #cadie500#10 - nPendAnt;
      |SI nPendAnt = 0;
         #cadie501#9 = #cadie500#10;
      |SINO;
         #cadie501#9 = nPendAnt;
      |FINSI;
      #cadie501#10 = nTotalPend;
      #cadie501#11 = #cadie500#12 - nComiDev;
      #cadie501#12 = ((#cadie501#9 - #cadie501#10) * #cadie500#12) / #cadie500#10;
      #cadie501#13 = #cadie500#14;
      #cadie501#14 = #cadie500#15;
      |GRABA 020#cadie501.c;

      #cadie500#13 = #cadie501#12;
      |GRABA 020#cadie500.a;
   |FINSI;
|FPRC;

|DEFBUCLE Historico1;
#cadie500#1;
;
INICIO;
FINAL;
;
NULL,Historico1;
|FIN;

|PROGRAMA;
   |HAZ Tipo8;

   |ABRE #cadie002;
   |LEE 000#cadie002.p;
   |SI FSalida ! 0;
      |DDEFECTO #cadie002;
      |GRABA 020#cadie002.c;
   |FINSI;

   |ABRE #dscam003; |ABRE #cadie501;
   |CLS;
   |CABEZA " Listado devolucion comisiones retrocedidas recibos vencidos";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |GRABA 020#cadie002.a;
      |IMPRE 0;
      |SI FSalida ! 0; |ACABA; |FINSI;
      |INFOR "cadie002";
      |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

      |SI #cadie002#1 = "S"; |BUCLE Historico1; |FINSI;
      |BUCLE Listado;

      |PIEINF; |FININF;
      |FINIMP;
   |FINSI;
   |CIERRA #cadie501; |CIERRA #dscam003;
   |CIERRA #cadie002;

   |HAZ Tipo9;
|FPRO;
