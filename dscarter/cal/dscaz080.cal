|FICHEROS;
   dscaz080 #0;

   dscaw058 #10,MANTE;
   dscam003 #11;
   dscam058 #12;
   dscam081 #13;
   dscam004 #14;
   dscaw017 #15,MANTE;
   dscam051 #16;
   dscaw013 #17;
   dscam030 #18;
   dscam001 #19;
   dscam002 #20;

   dscaw077 #77;
   dscam082 #82;
   dscam088 #88;

   cacuent@ #100;
   agifa133@ #101;

   Referen@ #1000;
|FIN;

|VARIABLES;
   &eaTOperacion = ""; &eaTipoRecibo = ""; &eaSesion = "";
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = ""; &HayConta = 0;

   &eaEntidad = ""; &eaSucursal = ""; &eaCuenta = ""; &eaDC = "";
   &enNumDocum = 0; &enTipoRec = 0; &eaResult = ""; &eaFiltro = "";
   &enSwError = 0;

   &eaFichClas = "";  &eaTipoClas = ""; &enSwClas = 0;
   &DCampoG = 0; &HCampoG = 0; &DCampoC = 0; &HCampoC = 0;
   &TipoCliente = ""; &CodCliente  = ""; &Nombre      = "";
   &Divisa = ""; &NombreDiv = ""; &CambioBaseVn = 0;
   &nDeci_Div = 0; &nDeci_Base = 0; &MaxDigit = 0;
   &Niv1 = 0; &Niv2 = 0; &Niv3 = 0; &Niv4 = 0; &Niv5 = 0; &Niv6 = 0;

   fFecha       = @; aCuenta       = ""; aCodEnl    = "";
   fFechaEnvio  = @; aCuentaEnvio  = ""; aEnlEnvio  = "";
   fFechaAcept  = @; aCuentaAcept  = ""; aEnlAcept  = "";
   fFechaPrepar = @; aCuentaPrepar = ""; aEnlPrepar = "";

   FEstado    = 0;
   nModo      = 0;
   nPos1      = 0;
   nPos2      = 0;
   nHayCtas = 0;
   nLong      = 0;
   nSwConta   = 0;
   nNumSec    = 0;
   nNumSel    = 0;
   nSwError   = 0;
   nSwCambia  = 0;
   LinCob     = 0;
   TotalSelec = 0;
   nTotalPag  = 0;
   nDocOrigen = 0;
   nUltCont   = 0;
   nLinea     = 0;

   nCalc      = 0;

   aTitulo    = "";
   aTipo      = "";
   aAlfa      = "";
   aAlfa1     = "";
   Comodin    = "";
   aParte1    = "";
   aParte2    = "";
   aLong      = "";

{1}&LaTecla = 0;
|FIN;

|PROCESO Codigo;
   |SI FSalida = 11;
      |SI Campo = 0;
         #dscaz080#0 = "      "; |PINTA #dscaz080#0;
         |C_M #dscaz080#0, 1, "N"; |C_M #dscaz080#1, 1, "S";
         |POSICIONATE #dscaz080#1;
      |SINO;
         #dscaz080#1 = "            "; |PINTA #dscaz080#1;
         |C_M #dscaz080#0, 1, "S"; |C_M #dscaz080#1, 1, "N";
         |POSICIONATE #dscaz080#0;
      |FINSI;
      |ACABA;
   |FINSI;

   |SI FSalida = 2; |ACABA; |FINSI;
   |SI Campo = 1; |Y #dscaz080#0 ! "      "; |ACABA; |FINSI;

   DCampoG = 0; HCampoG = 0;
   DCampoC = 1; HCampoC = 1;
   |SI Campo = 0;
      TipoCliente = "G"; CodCliente  = #dscaz080#0;
   |FINSI;
   |SI Campo = 1;
      TipoCliente = "C"; CodCliente  = #dscaz080#1;
   |FINSI;
   |HAZ ExisteCliente;
   |SI TipoCliente = "ERROR";
      |ERROR;
   |SINO;
      |SI TipoCliente = "G";
         #dscaz080#0 = CodCliente; |PINTA #dscaz080#0;
         #dscaz080#1 = "";         |PINTA #dscaz080#1;
      |SINO;
         #dscaz080#0 = "      ";   |PINTA #dscaz080#1;
         #dscaz080#1 = CodCliente; |PINTA #dscaz080#1;
      |FINSI;
      #dscaz080#2 = Nombre;     |PINTA #dscaz080#2;
   |FINSI;
|FPRC;

|RUTINA infw058;
   #dscaw058#0 = 0000000001;
|FRUT;

|RUTINA supw058;
   #dscaw058#0 = 9999999999;
|FRUT;

|PROCESO Documentos;
   |SI #dscam003#97 = "S"; |ACABA; |FINSI;
   |SI #dscaz080#3 = "A";
      |SI #dscam003#28 = "S";
         |SI #dscam003#29 = "S"; |ACABA; |FINSI;
         |SI #dscam003#14 ! "V"; |ACABA; |FINSI;
      |SINO;
         |ACABA;
      |FINSI;
   |SINO;
   |FINSI;

   |SI #dscaz080#3 = "P";
      |SI #dscam003#28 = "S";
         |SI #dscam003#29 = "S"; |ACABA; |FINSI;
      |FINSI;
   |FINSI;

   |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "C"; |Y #dscam003#14 ! "V";
     |Y #dscam003#14 ! "I";
        |ACABA;
   |FINSI;
   |SI #dscam003#31 = 0;   |ACABA; |FINSI;

   |ABRE #dscam088; |SELECT #2#dscam088;
   #dscam088#1 = "dscaz080";
   |LEE 000#dscam088.=;
   |SI FSalida = 0; |Y #dscam088#3 = "E";
      enSwClas = 1; eaFichClas = "dscaz080"; eaTipoClas = #dscam003#12;
      |HAZ CompruebaClas;
      |SI eaFichClas = "ERROR"; |ACABA; |FINSI;
   |SINO;
      eaTipoClas = #dscaz080#3;
   |FINSI;
   |CIERRA #dscam088;

   |QBF eaTipoClas;
   |SI eaTipoClas = "O"; eaTipoClas = "C"; |FINSI;
   |SI eaTipoClas ! #dscaz080#3; |ACABA; |FINSI;

   #dscam058#0 = #dscam003#12;
   |LEE 000#dscam058.=;
   |SI FSalida ! 0; |DDEFECTO #dscam058; |FINSI;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   |DDEFECTO #dscaw058;
   #dscaw058#0 = #dscam003#40;
   #dscaw058#1 = #dscam003#0;
   #dscaw058#2 = #dscam003#1;
   #dscaw058#3 = #dscam003#2;
   #dscaw058#4 = #dscam003#4;
   #dscaw058#5 = #dscam003#3;
   #dscaw058#6 = #dscam003#31;
   #dscaw058#7 = #dscam003#12;

   #dscaw058#8 = #dscam058#1;
   #dscaw058#9 = #dscam003#85;
   #dscaw058#10 = #dscam003#14;
   #dscaw058#11 = #dscam003#15;
   #dscaw058#12 = #dscam003#57;
   #dscaw058#13 = NombreDiv;
   |SI #dscaz080#3 = "C";
      #dscaw058#19 = #dscam003#97;
   |SINO;
      #dscaw058#19 = #dscam003#90;
   |FINSI;

   |ABRE #dscam001; |ABRE #dscam002;
   #dscam001#0 = #dscam003#8;
   |LEE 000#dscam001.=;
   |SI FSalida ! 0; |DDEFECTO #dscam001; |FINSI;

   #dscam002#0 = #dscam003#8;
   #dscam002#1 = #dscam003#9;
   |LEE 000#dscam002.=;
   |SI FSalida ! 0; |DDEFECTO #dscam002; |FINSI;
   |CIERRA #dscam002; |CIERRA #dscam001;

   #dscaw058#20 = #dscam003#8;
   #dscaw058#21 = #dscam001#1;
   #dscaw058#22 = #dscam003#9;
   #dscaw058#23 = #dscam002#2;
   #dscaw058#24 = #dscam003#11;
   #dscaw058#25 = #dscam003#10;

   |GRABA 020#dscaw058.n;
|FPRC;

|DEFBUCLE Documentos2;
#dscam003#11;
;
#dscaz080#0,"01.01.0000","   ";
#dscaz080#0,"31.12.9999","zzz";
;
NULL,Documentos;
|FIN;

|DEFBUCLE Documentos1;
#dscam003#4;
;
#dscaz080#1,000000001;
#dscaz080#1,999999999;
;
NULL,Documentos;
|FIN;

|PROCESO ComprSel;

|FPRC;

|DEFBUCLE ComprSel;
#dscaw058#1;
;
INICIO;
FINAL;
;
NULL,ComprSel;
|FIN;

|PROCESO Asignacion;
   #dscam003#40 = #dscaw058#0;
   |LEE 000#dscam003.=;
   Divisa = #dscam003#57; |HAZ TomaDecim;

   |SI nDocOrigen = 0;
      nDocOrigen = #dscaw058#0;
   |FINSI;
   nTotalPag = nTotalPag - #dscam003#30;
   nTotalPag = nTotalPag ! 2;

   #dscam004#17 = #dscaw058#0;
   #dscam004#3 = 99;
   |LEE 000#dscam004.];
   |SI FSalida ! 0;
      |LEE 000#dscam004.u;
      |SI FSalida = 0; |Y #dscam004#17 = #dscaw058#0;
         LinCob = #dscam004#3 + 1;
      |SINO;
         LinCob = 1;
      |FINSI;
   |SINO;
      |SI #dscam004#17 = #dscaw058#0;
         LinCob = #dscam004#3 + 1;
      |SINO;
         |LEE 000#dscam004.a;
         |SI FSalida = 0; |Y #dscam004#17 = #dscaw058#0;
            LinCob = #dscam004#3 + 1;
         |SINO;
            LinCob = 1;
         |FINSI;
      |FINSI;
   |FINSI;
   |DDEFECTO #dscam004;
   #dscam004#17 = #dscaw058#0;
   #dscam004#15 = #dscam003#27;
   #dscam004#0  = #dscam003#0;
   #dscam004#1  = #dscam003#1;
   #dscam004#2  = #dscam003#2;
   #dscam004#3  = LinCob;
   #dscam004#4  = #dscaw017#5;
   #dscam004#5  = "RPT";
   #dscam004#6  = #dscaw017#8;
   #dscam004#11 = #dscam003#13;
   aAlfa = "Docum. " + (("0000" + #dscaw017#0) % -104) + "/" + #dscaw017#2;
   #dscam004#16 = aAlfa;
   #dscam004#33 = CambioBaseVn;
   #dscam004#43 = nNumSec;
   #dscam004#44 = #dscam003#31;
   #dscam004#45 = #dscam004#44 * #dscam004#33;
   #dscam004#46 = 0;
   #dscam004#47 = 0;
   #dscam004#51 = #dscaw017#0;
   #dscam004#52 = #dscaw017#2;
   #dscam004#53 = #dscaw017#3;
   |GRABA 020#dscam004.n; |LEE 000#dscam004.=

   #dscam003#40 = #dscaw058#0;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      #dscam003#14 = "T";
      #dscam003#15 = "Pagare/talon de cliente";
      #dscam003#70 = #dscaw017#2;
      #dscam003#71 = #dscaw017#3;
      #dscam003#72 = #dscaw017#0;
      #dscam003#73 = #dscaw017#4;
      #dscam003#74 = #dscaw017#5;
      #dscam003#78 = #dscaw017#6;
      #dscam003#79 = #dscaw017#6 * CambioBaseVn;
      #dscam003#90 = "S";
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;
|FPRC;

|DEFBUCLE Asignacion;
#dscaw058#1;
14;
0000000001,"*";
9999999999,"*";
;
NULL,Asignacion;
|FIN;

|PROCESO MarcaSeq;
   #dscam004#51 = #dscam003#72;
   #dscam004#52 = #dscam003#70;
   |GRABA 020#dscam004.a; |LIBERA #dscam004;
|FPRC;

|DEFBUCLE MarcaSeq;
#dscam004#8;
;
#dscam003#72, #dscam003#70;
#dscam003#72, #dscam003#70;
be;
NULL, MarcaSeq;
|FIN;

|PROCESO CreaEntregaDif;
   |LEE 000#dscam003.u;
   nUltCont = #dscam003#40 + 1;
   #dscam003#40 = nDocOrigen;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      #dscam003#40 = nUltCont;
      |GRABA 020#dscam003.b;
      #dscam003#0  = "";
      #dscam003#1  = 0;
      #dscam003#2  = 0;
      #dscam003#3  = "";
      #dscam003#14 = "p";
      #dscam003#15 = "Entrega pdte.cobro";
      #dscam003#16 = 0;
      #dscam003#17 = 0;
      #dscam003#18 = 0;
      #dscam003#19 = "";
      #dscam003#20 = 0;
      #dscam003#21 = 0;
      #dscam003#22 = nTotalPag;
      #dscam003#23 = 0;
      #dscam003#24 = 0;
      #dscam003#25 = 0;
      #dscam003#26 = #dscaw017#8;
      #dscam003#27 = 0;
      #dscam003#30 = nTotalPag;
      #dscam003#31 = nTotalPag;
      #dscam003#37 = 0;
      #dscam003#38 = 0;
      #dscam003#41 = 0;
      #dscam003#47 = "S";
      #dscam003#48 = "N";
      #dscam003#49 = "N";
      #dscam003#50 = "";
      #dscam003#51 = "";
      #dscam003#52 = "";
      #dscam003#53 = "";
      #dscam003#54 = 0;
      #dscam003#55 = 0;
      #dscam003#56 = 0;
      #dscam003#60 = nTotalPag * #dscam003#59;
      #dscam003#61 = 0;
      #dscam003#62 = 0;
      #dscam003#63 = 0;
      #dscam003#64 = nTotalPag * #dscam003#59;
      #dscam003#65 = nTotalPag * #dscam003#59;
      #dscam003#66 = 0;
      #dscam003#67 = 0;
      #dscam003#68 = 0;
      #dscam003#69 = "";
      |GRABA 020#dscam003.a; |LIBERA #dscam003;

      eaUsuario = Usuario % 0810;
      eaDescr   = "ALTA ENTREGA A CUENTA ("+ (("000000000" + #dscam003#40) % -109) + ") POR PAGARE/TALON (";
      eaDescr   = eaDescr + (("0000" + #dscam003#72) % -104) + "/" + (("0000000000" + #dscam003#70) % -110) + ")";
      eaTipoReg = "EA";  eaNumero = ("0000000000" + #dscam003#40) % -109;
      eaTipoOp  = "A";   enImpAnt = 0; enImpAct = #dscam003#23;
      |HAZ GrabaAudit;

      #dscam004#17 = #dscam003#40;
      #dscam004#3 = 1;
      |LEE 000#dscam004.];
      |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
         |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
            nLinea = #dscam004#3 + 1;
            |LEE 000#dscam004.s;
         |SIGUE;
      |SINO;
         nLinea = 1;
      |FINSI;
      |DDEFECTO #dscam004;
      #dscam004#17 = #dscam003#40;
      #dscam004#3  = nLinea;
      |GRABA 020#dscam004.b;
      #dscam004#0 = #dscam003#0;
      #dscam004#1 = #dscam003#1;
      #dscam004#2 = #dscam003#2;
      #dscam004#4 = #dscam003#74;
      #dscam004#5 = "RAC";
      #dscam004#6 = #dscaw017#8;
      #dscam004#7 = 0;
      #dscam004#15 = #dscam003#27;
      Comodin = "Entrega a cuenta";
      #dscam004#16 = Comodin;
      #dscam004#25 = #dscam003#61;
      #dscam004#42 = #dscam003#74;
      #dscam004#43 = nNumSec;
      #dscam004#44 = nTotalPag;
      #dscam004#45 = nTotalPag * #dscam003#59;
      #dscam004#46 = 0; #dscam004#47 = 0;
      #dscam004#16 = "Doc.Automatico por pagare con valor exceso";
      #dscam004#51 = #dscam003#72;
      #dscam004#52 = #dscam003#70;
      |GRABA 020#dscam004.a; |LIBERA #dscam004;
   |FINSI;

   |BUCLE MarcaSeq;
|FPRC;

|PROCESO AsignaATalon;
   |PUSHV 0501 2380;
   |DDEFECTO #dscaw017;
   #dscaw017#6 = TotalSelec;
   #dscaw017#7 = #dscam051#40;
   |PINPA #0#dscaw017; |PINDA #0#dscaw017;
   |ENDATOS #1#dscaw017;
   FEstado = FSalida;
   |SI #dscaw017#0 = "    "; |O #dscaw017#2 = "          "; FEstado = -1; |FINSI;
   |SI FEstado = 0;
      |SALVA_FICHA #dscaw058; nTotalPag = #dscaw017#6 ! 2;
      nDocOrigen = 0;
      |BUCLE Asignacion;
      |SI nTotalPag > 0;
         |HAZ CreaEntregaDif;
      |FINSI;

      eaUsuario = Usuario % 0810;
      eaDescr   = "ALTA PAGARE/TALON ("+ (("0000" + #dscaw017#0) % -104) + "/" + (("0000000000" + #dscaw017#2) % -110) + ") DESDE ENTRADA GENERAL";
      eaTipoReg = "PT";  eaNumero = (("0000" + #dscaw017#0) % -104) + "/" + (("0000000000" + #dscaw017#2) % -110);
      eaTipoOp  = "A";   enImpAnt = 0; enImpAct = #dscaw017#6;
      |HAZ GrabaAudit;

      |LEE 000#dscaw058.p; |REPON_FICHA #dscaw058;
   |SINO;
      nSwError   = 1;
   |FINSI;
   |POPV;
|FPRC;

|PROCESO MiraImporte1;
   TotalSelec = TotalSelec ! 2;
   |SI #dscaw017#6 < TotalSelec;
      |MENAV "    Si quiere seleccionar un importe menor, deseleccione recibos o marque recibos con importes parciales";
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO CreaPagare;
   |SALVA_FICHA #dscam004;
   |SELECT #3#dscam004;
   |LEE 000#dscam004.u;
   |SI nNumSec [ #dscam004#43;
      nNumSec = #dscam004#43 + 1;
   |SINO;
      nNumSec = nNumSec + 1;
   |FINSI;
   |SELECT #1#dscam004;
   |LEE 000#dscam004.p; |REPON_FICHA #dscam004;

   nSwError = 0;
   |HAZ AsignaATalon;

   || Esto lo hago para que para los enlaces por sesion se usen SIEMPRE
   ||   asientos definidos por sesion

   nSwCambia = 0;
   |ABRE #dscam030;
   #dscam030#0 = #dscaw017#7;
   |LEE 101#dscam030.=;
   |SI FSalida = 0;
      |SI #dscam030#8 = "N";
         nSwCambia = 1;
         #dscam030#8 = "S";
         |GRABA 020#dscam030.a; |LIBERA #dscam030;
      |FINSI;
   |FINSI;
   |CIERRA #dscam030;

   |SI #dscam051#1 = "S"; |Y HayConta = 1; |Y #dscaw017#7 ! "    "; |Y nSwError = 0;
      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #17 Comodin;
      |DELINDEX #dscaw013; |ABRE #dscaw013;
      #dscaw013#15 = #dscaw017#7;  #dscaw013#0  = 1;
      #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
      #dscaw013#5 = nNumSec;       #dscaw013#6  = nNumSec;
      #dscaw013#11 = "N";          #dscaw013#12 = 10;
      |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
      #dscaw013#15 = #dscaw017#7;  #dscaw013#0  = 2;
      #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
      #dscaw013#3 = "RAC";         #dscaw013#4  = "RPT";
      #dscaw013#11 = "A";          #dscaw013#12 = 3;
      |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
      #dscaw013#15 = #dscaw017#7;  #dscaw013#0  = 3;
      #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
      #dscaw013#7 = #dscaw017#8;   #dscaw013#8  = #dscaw017#8;
      #dscaw013#11 = "F";          #dscaw013#12 = 10;
      |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
      Comodin = #dscaw017#7; |QBF Comodin;
      Comodin = "dscam033.tab;" + Comodin;
      |LIBERA #dscam003; |CIERRAT #dscam003;
      |LIBERA #dscam004; |CIERRAT #dscam004;
      |SUB_EJECUTA_NP Comodin; |DELINDEX #dscaw013;
      |ABRET #dscam003; |LEE 101#dscam003.=;
      |ABRET #dscam004; |LEE 101#dscam004.=;
   |FINSI;

   |SI nSwCambia ! 0;
      |ABRE #dscam030;
      #dscam030#0 = #dscaw017#7;
      |LEE 101#dscam030.=;
      |SI FSalida = 0;
         #dscam030#8 = "N";
         |GRABA 020#dscam030.a; |LIBERA #dscam030;
      |FINSI;
      |CIERRA #dscam030;
   |FINSI;
|FPRC;

|PROCESO PideAcept;
   aAlfa = #48#16; |QBF aAlfa;
   aAlfa1 = aAlfa + "def/cacuenta.mas";
   |XABRE "E", aAlfa1, nCalc;
   nHayCtas = FSalida;
   |SI nHayCtas = 0;
      |CARGA_DEF aAlfa1, cacuent@;
      |SI FSalida = 0;
         nSwConta = 1;
         aAlfa = aAlfa + "fich/" + (("00000" + #48#14) % -105) + #48#19 + "/";
         |PATH_DAT #100 aAlfa; |ABRE #cacuent@;
      |SINO;
         nSwConta = 0;
      |FINSI;
   |FINSI;

   |ABRE #dscam030;

   |PUSHV 1009 1371;
   |BLANCO 1009 1371;
   |CUADRO 1010 1370;
   |SI #dscam003#28 = "N";
      aAlfa = " Datos para la preparacion ";
   |SINO;
      |SI #dscam003#93 = "N";
         aAlfa = " Datos para el envio ";
      |SINO;
         aAlfa = " Datos para el aceptado ";
      |FINSI;
   |FINSI;
   |ATRI R; |PINTA 1011 , aAlfa; |ATRI N;
   |PINTA 1111, " Cuenta                                                 ";
   |PINTA 1211, " C.Enlace                                Fecha          ";
   |SI nHayCtas = 0;
      |PINTA 1121, #cacuent@#0; |PINTA 1134, #cacuent@#2;
   |SINO;
      |PINTA 1121, #dscaz080#1; |PINTA 1134, #dscam030#1;
   |FINSI;
   |PINTA 1221, #dscam030#0; |PINTA 1226, #dscam030#1;
   |PINTA 1258, #dscaw058#15;
   |ERROR;

   |SI #dscam051#61 = "N"; |VETE OtraFecha1; |FINSI;

|ET OtraCuenta1;
   |MENSA "    <F2> Consulta de cuentas ";
   E_sup  = 12; E_inf  = "";
   aCuenta = 1121 ? 1;
   |SI FSalida = 0;
      aCuenta = aCuenta - ".";
      |PARA; |SI FSalida ! 0; |HACIENDO;
         nCalc = ((FSalida / 100) ! 0) + 99; aParte1 = aCuenta % nCalc; |QBF aParte1;
         nCalc = FSalida + 98;               aParte2 = aCuenta % nCalc; |QBF aParte2;
         aCuenta = aParte1 + aParte2; |QBF aCuenta;
         aLong = aCuenta % 0; nLong = aLong;
         nCalc = MaxDigit - nLong;
         aCuenta = aParte1 + ("0" * nCalc) + aParte2;
         aCuenta = aCuenta - ".";
      |SIGUE;
      |QBF aCuenta;
      aLong = aCuenta % 0; nLong = aLong;
      |SI nHayCtas = 0;
         |DDEFECTO #cacuent@;
         #cacuent@#0 = aCuenta;
         |SI nLong = Niv1; #cacuent@#1 = 1; |FINSI;
         |SI nLong = Niv2; #cacuent@#1 = 2; |FINSI;
         |SI nLong = Niv3; #cacuent@#1 = 3; |FINSI;
         |SI nLong = Niv4; #cacuent@#1 = 4; |FINSI;
         |SI nLong = Niv5; #cacuent@#1 = 5; |FINSI;
         |SI nLong = Niv6; #cacuent@#1 = 6; |FINSI;
         |SI #cacuent@#1 = 0;
            |MENAV "    Cuenta fuera de nivel";
            |VETE OtraCuenta1;
         |SINO;
            |LEE 000#cacuent@.=;
            |SI FSalida = 0;
               |PINTA 1121, #cacuent@#0;  |PINTA 1134, #cacuent@#2;
            |SINO;
               |MENAV "    Cuenta inexistente";
               |VETE OtraCuenta1;
            |FINSI;
         |FINSI;
      |FINSI;
   |SINO;
      |SI FSalida = 10;
         aCuenta = aCuenta - ".";
         |PARA; |SI FSalida ! 0; |HACIENDO;
            nCalc = ((FSalida / 100) ! 0) + 99; aParte1 = aCuenta % nCalc; |QBF aParte1;
            nCalc = FSalida + 98;               aParte2 = aCuenta % nCalc; |QBF aParte2;
            aCuenta = aParte1 + aParte2; |QBF aCuenta;
            aLong = aCuenta % 0; nLong = aLong;
            nCalc = MaxDigit - nLong;
            aCuenta = aParte1 + ("0" * nCalc) + aParte2;
            aCuenta = aCuenta - ".";
         |SIGUE;
         |SI nHayCtas = 0;
            #cacuent@#0 = aCuenta;
            #cacuent@#1 = 1;
            |LEE 000#cacuent@.];
            |CONSULTA_CLAVE #1#cacuent@;
            |SI FSalida = 0;
               aCuenta = #cacuent@#0;
               |PINTA 1121, #cacuent@#0;  |PINTA 1134, #cacuent@#2;
            |FINSI;
            |VETE OtraCuenta1;
         |SINO;
            |MENSA "     ";
            nSwError = 1;
            aCuenta = ""; |VETE Final1;
         |FINSI;
      |FINSI;
   |FINSI;
   |MENSA "     ";

|ET OtroEnlace1;

   |SI #dscaz080#3 = "C"; aCodEnl = #dscam051#59; |FINSI;
   |SI #dscaz080#3 = "A"; aCodEnl = #dscam051#58; |FINSI;

   #dscam030#0 = aCodEnl;
   |LEE 000#dscam030.=;
   |SI FSalida ! 0;
      aCodEnl = ""; |DDEFECTO #dscam030;
   |FINSI;
   |PINTA 1221, #dscam030#0; |PINTA 1226, #dscam030#1;

   |MENSA "    <F2> Consulta de enlaces ";
   E_sup = 4; E_inf = "";
   aCodEnl = 1221 ? 1;
   |SI FSalida = 0;
      #dscam030#0 = aCodEnl;
      |LEE 000#dscam030.=;
      |SI FSalida = 0;
         |PINTA 1221, #dscam030#0; |PINTA 1226, #dscam030#1;
      |SINO;
         |MENAV "    Enlace inexistente";
         |VETE OtroEnlace1;
      |FINSI;
   |SINO;
      |SI FSalida = 2; |VETE OtraCuenta1; |FINSI;
      |SI FSalida = 10;
         #dscam030#0 = aCodEnl;
         |LEE 000#dscam030.];
         |CONSULTA_CLAVE #1#dscam030;
         |SI FSalida = 0;
            aCodEnl = #dscam030#0;
            |PINTA 1221, #dscam030#0; |PINTA 1226, #dscam030#1;
         |FINSI;
         |VETE OtroEnlace1;
      |SINO;
         |MENSA "     ";
         aCuenta = ""; aCodEnl = "";
         nSwError = 1;
         |VETE Final1;
      |FINSI;
   |FINSI;

|ET OtraFecha1;
   E_sup = 0; E_inf = 0; fFecha = ~;
   fFecha = 1258 ? 1;
   |SI FSalida = 0;
      |SI fFecha = "01.01.0000"; |O fFecha = "00.00.0000";
         |AVISO;
         |MENAV "    La fecha no puede estar vacia ";
         |VETE OtraFecha1;
      |FINSI;
      |SI #dscam003#28 = "N";
         fFechaPrepar = fFecha; aCuentaPrepar = aCuenta; aEnlPrepar = aCodEnl;
      |SINO;
         |SI #dscam003#93 = "N";
            fFechaEnvio = fFecha; aCuentaEnvio = aCuenta; aEnlEnvio = aCodEnl;
         |SINO;
            fFechaAcept = fFecha; aCuentaAcept = aCuenta; aEnlAcept = aCodEnl;
         |FINSI;
      |FINSI;
   |SINO;
      |SI #dscam051#61 = "S";
         |SI FSalida = 2; |VETE OtroEnlace1; |FINSI;
      |FINSI;
      aCuenta = ""; aCodEnl = ""; fFecha = "";
      nSwError = 1;
   |FINSI;

|ET Final1;

   |CIERRA #dscam030;

   |SI nSwConta = 1;
      |CIERRA #cacuent@; |DESCARGA_DEF #cacuent@;
   |FINSI;

   |POPV;
|FPRC;

|PROCESO PideDatos;
   aAlfa = #48#16; |QBF aAlfa;
   aAlfa1 = aAlfa + "def/cacuenta.mas";
   |XABRE "E", aAlfa1, nCalc;
   nHayCtas = FSalida;
   |SI nHayCtas = 0;
      |CARGA_DEF aAlfa1, cacuent@;
      |SI FSalida = 0;
         nSwConta = 1;
         aAlfa = aAlfa + "fich/" + (("00000" + #48#14) % -105) + #48#19 + "/";
         |PATH_DAT #100 aAlfa; |ABRE #cacuent@;
      |SINO;
         nSwConta = 0;
      |FINSI;
   |FINSI;

   |ABRE #dscam030;

   |PUSHV 1009 1371;
   |BLANCO 1009 1371;
   |CUADRO 1010 1370;
   |ATRI R; |PINTA 1011 , aTitulo; |ATRI N;
   |PINTA 1111, " Cuenta                                                 ";
   |PINTA 1211, " C.Enlace                                Fecha          ";
   |SI nHayCtas = 0;
      |PINTA 1121, #cacuent@#0; |PINTA 1134, #cacuent@#2;
   |SINO;
      |PINTA 1121, #dscaz080#1; |PINTA 1134, #dscam030#1;
   |FINSI;
   |PINTA 1221, #dscam030#0; |PINTA 1226, #dscam030#1;
   |PINTA 1258, #dscaw058#15;
   |ERROR;

   |SI #dscam051#61 = "N"; |VETE OtraFecha; |FINSI;

|ET OtraCuenta;
   |MENSA "    <F2> Consulta de cuentas ";
   E_sup  = 12; E_inf  = "";
   aCuenta = 1121 ? 1;
   |SI FSalida = 0;
      aCuenta = aCuenta - ".";
      |PARA; |SI FSalida ! 0; |HACIENDO;
         nCalc = ((FSalida / 100) ! 0) + 99; aParte1 = aCuenta % nCalc; |QBF aParte1;
         nCalc = FSalida + 98;               aParte2 = aCuenta % nCalc; |QBF aParte2;
         aCuenta = aParte1 + aParte2; |QBF aCuenta;
         aLong = aCuenta % 0; nLong = aLong;
         nCalc = MaxDigit - nLong;
         aCuenta = aParte1 + ("0" * nCalc) + aParte2;
         aCuenta = aCuenta - ".";
      |SIGUE;
      |QBF aCuenta;
      aLong = aCuenta % 0; nLong = aLong;
      |SI nHayCtas = 0;
         |DDEFECTO #cacuent@;
         #cacuent@#0 = aCuenta;
         |SI nLong = Niv1; #cacuent@#1 = 1; |FINSI;
         |SI nLong = Niv2; #cacuent@#1 = 2; |FINSI;
         |SI nLong = Niv3; #cacuent@#1 = 3; |FINSI;
         |SI nLong = Niv4; #cacuent@#1 = 4; |FINSI;
         |SI nLong = Niv5; #cacuent@#1 = 5; |FINSI;
         |SI nLong = Niv6; #cacuent@#1 = 6; |FINSI;
         |SI #cacuent@#1 = 0;
            |MENAV "    Cuenta fuera de nivel";
            |VETE OtraCuenta;
         |SINO;
            |LEE 000#cacuent@.=;
            |SI FSalida = 0;
               |PINTA 1121, #cacuent@#0;  |PINTA 1134, #cacuent@#2;
            |SINO;
               |MENAV "    Cuenta inexistente";
               |VETE OtraCuenta;
            |FINSI;
         |FINSI;
      |FINSI;
   |SINO;
      |SI FSalida = 10;
         aCuenta = aCuenta - ".";
         |PARA; |SI FSalida ! 0; |HACIENDO;
            nCalc = ((FSalida / 100) ! 0) + 99; aParte1 = aCuenta % nCalc; |QBF aParte1;
            nCalc = FSalida + 98;               aParte2 = aCuenta % nCalc; |QBF aParte2;
            aCuenta = aParte1 + aParte2; |QBF aCuenta;
            aLong = aCuenta % 0; nLong = aLong;
            nCalc = MaxDigit - nLong;
            aCuenta = aParte1 + ("0" * nCalc) + aParte2;
            aCuenta = aCuenta - ".";
         |SIGUE;
         |SI nHayCtas = 0;
            #cacuent@#0 = aCuenta;
            #cacuent@#1 = 1;
            |LEE 000#cacuent@.];
            |CONSULTA_CLAVE #1#cacuent@;
            |SI FSalida = 0;
               aCuenta = #cacuent@#0;
               |PINTA 1121, #cacuent@#0;  |PINTA 1134, #cacuent@#2;
            |FINSI;
            |VETE OtraCuenta;
         |SINO;
            |MENSA "     ";
            nSwError = 1;
            aCuenta = ""; |VETE Final;
         |FINSI;
      |FINSI;
   |FINSI;
   |MENSA "     ";

|ET OtroEnlace;
   |SI #dscaz080#3 = "C"; aCodEnl = #dscam051#59; |FINSI;
   |SI #dscaz080#3 = "A"; aCodEnl = #dscam051#58; |FINSI;

   #dscam030#0 = aCodEnl;
   |LEE 000#dscam030.=;
   |SI FSalida ! 0;
      aCodEnl = ""; |DDEFECTO #dscam030;
   |FINSI;
   |PINTA 1221, #dscam030#0; |PINTA 1226, #dscam030#1;

   |MENSA "    <F2> Consulta de enlaces ";
   E_sup = 4; E_inf = "";
   aCodEnl = 1221 ? 1;
   |SI FSalida = 0;
      #dscam030#0 = aCodEnl;
      |LEE 000#dscam030.=;
      |SI FSalida = 0;
         |PINTA 1221, #dscam030#0; |PINTA 1226, #dscam030#1;
      |SINO;
         |MENAV "    Enlace inexistente";
         |VETE OtroEnlace;
      |FINSI;
   |SINO;
      |SI FSalida = 2; |VETE OtraCuenta; |FINSI;
      |SI FSalida = 10;
         #dscam030#0 = aCodEnl;
         |LEE 000#dscam030.];
         |CONSULTA_CLAVE #1#dscam030;
         |SI FSalida = 0;
            aCodEnl = #dscam030#0;
            |PINTA 1221, #dscam030#0; |PINTA 1226, #dscam030#1;
         |FINSI;
         |VETE OtroEnlace;
      |SINO;
         |MENSA "     ";
         aCuenta = ""; aCodEnl = "";
         nSwError = 1;
         |VETE Final;
      |FINSI;
   |FINSI;

|ET OtraFecha;
   E_sup = 0; E_inf = 0; fFecha = ~;
   fFecha = 1258 ? 1;
   |SI FSalida = 0;
      |SI fFecha = "01.01.0000"; |O fFecha = "00.00.0000";
         |AVISO;
         |MENAV "    La fecha no puede estar vacia ";
         |VETE OtraFecha;
      |FINSI;
   |SINO;
      |SI #dscam051#61 = "S";
         |SI FSalida = 2; |VETE OtroEnlace; |FINSI;
      |FINSI;
      aCuenta = ""; aCodEnl = ""; fFecha = "01.01.0000";
      nSwError = 1;
   |FINSI;

|ET Final;

   |CIERRA #dscam030;

   |SI nSwConta = 1;
      |CIERRA #cacuent@; |DESCARGA_DEF #cacuent@;
   |FINSI;

   |POPV;
|FPRC;

|PROCESO AceptaRecs;
   #dscam003#40 = #dscaw058#0;
   |LEE 000#dscam003.=;
   Divisa = #dscam003#57; |HAZ TomaDecim;

   #dscam004#17 = #dscaw058#0;
   #dscam004#3 = 99;
   |LEE 000#dscam004.];
   |SI FSalida ! 0;
      |LEE 000#dscam004.u;
      |SI FSalida = 0; |Y #dscam004#17 = #dscaw058#0;
         LinCob = #dscam004#3 + 1;
      |SINO;
         LinCob = 1;
      |FINSI;
   |SINO;
      |SI #dscam004#17 = #dscaw058#0;
         LinCob = #dscam004#3 + 1;
      |SINO;
         |LEE 000#dscam004.a;
         |SI FSalida = 0; |Y #dscam004#17 = #dscaw058#0;
            LinCob = #dscam004#3 + 1;
         |SINO;
            LinCob = 1;
         |FINSI;
      |FINSI;
   |FINSI;

   |DDEFECTO #dscam004;
   #dscam004#17 = #dscaw058#0;
   #dscam004#15 = #dscam003#27;
   #dscam004#0  = #dscam003#0;
   #dscam004#1  = #dscam003#1;
   #dscam004#2  = #dscam003#2;
   #dscam004#3  = LinCob;
   |SI #dscam003#93 = "N";
      #dscam004#4  = aCuentaEnvio;
      #dscam004#5  = "ENV";
      #dscam004#6  = fFechaEnvio;
   |SINO;
      #dscam004#4  = aCuentaAcept;
      #dscam004#5  = "ACE";
      #dscam004#6  = fFechaAcept;
   |FINSI;
   #dscam004#7  = #dscam003#23;
   #dscam004#8  = #dscam003#31;
   #dscam004#25 = #dscam003#61;
   #dscam004#26 = #dscam003#65;
   #dscam004#11 = #dscam003#13;
   #dscam004#33 = CambioBaseVn;
   #dscam004#43 = nNumSec;
   #dscam004#44 = 0;
   #dscam004#45 = 0;
   #dscam004#46 = 0;
   #dscam004#47 = 0;
   |GRABA 020#dscam004.n; |LEE 000#dscam004.=

   #dscam003#40 = #dscaw058#0;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#93 = "N";
         #dscam003#14 = "V";
         #dscam003#15 = "Recibo enviado al cliente";
         #dscam003#93 = "S";
         #dscam003#95 = aCuentaEnvio;
         #dscam003#90 = "N";
      |SINO;
         #dscam003#14 = "P";
         #dscam003#15 = "Recibo aceptado";
         #dscam003#29 = "S";
         #dscam003#96 = aCuentaAcept;
         #dscam003#90 = "S";
      |FINSI;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;
|FPRC;

|DEFBUCLE AceptaRecs;
#dscaw058#1;
14;
0000000001,"*";
9999999999,"*";
;
NULL,AceptaRecs;
|FIN;

|PROCESO Acepta;
   fFechaEnvio = ""; aCuentaEnvio = ""; aEnlEnvio = "";
   fFechaAcept = ""; aCuentaAcept = ""; aEnlAcept = "";
   nSwError = 0;
   |HAZ PideAcept;

   |SI nSwError = 0;
      |SALVA_FICHA #dscam004;
      |SELECT #3#dscam004;
      |LEE 000#dscam004.u;
      |SI nNumSec [ #dscam004#43;
         nNumSec = #dscam004#43 + 1;
      |SINO;
         nNumSec = nNumSec + 1;
      |FINSI;
      |SELECT #1#dscam004;
      |LEE 000#dscam004.p; |REPON_FICHA #dscam004;

      |BUCLE AceptaRecs;

      |SI #dscam051#1 = "S"; |Y HayConta = 1; |Y aCodEnl ! "    ";
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #17 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         #dscaw013#15 = aCodEnl;      #dscaw013#0  = 1;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
         #dscaw013#5  = nNumSec;      #dscaw013#6  = nNumSec;
         #dscaw013#11 = "N";          #dscaw013#12 = 10;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         #dscaw013#15 = aCodEnl;      #dscaw013#0  = 2;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
         |SI aTipo = "E";
            #dscaw013#3 = "ENV";         #dscaw013#4  = "ENV";
         |SINO;
            #dscaw013#3 = "ACE";         #dscaw013#4  = "ACE";
         |FINSI;
         #dscaw013#11 = "A";          #dscaw013#12 = 3;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         |SI aTipo = "E";
            #dscaw013#7 = fFechaEnvio;   #dscaw013#8  = fFechaEnvio;
         |SINO;
            #dscaw013#7 = fFechaAcept;   #dscaw013#8  = fFechaAcept;
         |FINSI;
         #dscaw013#15 = aCodEnl;      #dscaw013#0  = 3;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
         #dscaw013#11 = "F";          #dscaw013#12 = 10;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;

         Comodin = aCodEnl;     |QBF Comodin;
         Comodin = "dscam033.tab;" + Comodin;
         |LIBERA #dscam003; |CIERRAT #dscam003;
         |LIBERA #dscam004; |CIERRAT #dscam004;
         |SUB_EJECUTA_NP Comodin; |DELINDEX #dscaw013;
         |ABRET #dscam003; |LEE 101#dscam003.=;
         |ABRET #dscam004; |LEE 101#dscam004.=;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO MarcaConf;
   #dscam003#40 = #dscaw058#0;
   |LEE 000#dscam003.=;
   Divisa = #dscam003#57; |HAZ TomaDecim;

   #dscam004#17 = #dscaw058#0;
   #dscam004#3 = 99;
   |LEE 000#dscam004.];
   |SI FSalida ! 0;
      |LEE 000#dscam004.u;
      |SI FSalida = 0; |Y #dscam004#17 = #dscaw058#0;
         LinCob = #dscam004#3 + 1;
      |SINO;
         LinCob = 1;
      |FINSI;
   |SINO;
      |SI #dscam004#17 = #dscaw058#0;
         LinCob = #dscam004#3 + 1;
      |SINO;
         |LEE 000#dscam004.a;
         |SI FSalida = 0; |Y #dscam004#17 = #dscaw058#0;
            LinCob = #dscam004#3 + 1;
         |SINO;
            LinCob = 1;
         |FINSI;
      |FINSI;
   |FINSI;

   |DDEFECTO #dscam004;
   #dscam004#17 = #dscaw058#0;
   #dscam004#15 = #dscam003#27;
   #dscam004#0  = #dscam003#0;
   #dscam004#1  = #dscam003#1;
   #dscam004#2  = #dscam003#2;
   #dscam004#3  = LinCob;
   #dscam004#4  = aCuenta;
   #dscam004#5  = "RCF";
   #dscam004#6  = fFecha;
   #dscam004#7  = #dscam003#23;
   #dscam004#8  = #dscam003#31;
   #dscam004#25 = #dscam003#61;
   #dscam004#26 = #dscam003#65;
   #dscam004#11 = #dscam003#13;
   #dscam004#33 = CambioBaseVn;
   #dscam004#43 = nNumSec;
   #dscam004#44 = 0;
   #dscam004#45 = 0;
   #dscam004#46 = 0;
   #dscam004#47 = 0;
   |GRABA 020#dscam004.n; |LEE 000#dscam004.=

   #dscam003#40 = #dscaw058#0;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      |SI #dscaw058#19 = "S";
         #dscam003#97 = "N"; #dscam003#90 = "N";
      |SINO;
         #dscam003#97 = "S"; #dscam003#90 = "S";
      |FINSI;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;
|FPRC;

|DEFBUCLE MarcaConf;
#dscaw058#1;
14;
0000000001,"*";
9999999999,"*";
;
NULL,MarcaConf;
|FIN;

|PROCESO MarcaConfirme;
   |CONFI "    NConforme con la seleccion ? ";
   |SI FSalida = 0;
      aTitulo = " Recepcion de confirme ";
      aCuenta = ""; aCodEnl = ""; fFecha = "00.00.0000";
      |HAZ PideDatos;
      |SI fFecha ! "01.01.0000"; |Y fFecha ! "00.00.0000";
         |SALVA_FICHA #dscam004;
         |SELECT #3#dscam004;
         |LEE 000#dscam004.u;
         |SI nNumSec [ #dscam004#43;
            nNumSec = #dscam004#43 + 1;
         |SINO;
            nNumSec = nNumSec + 1;
         |FINSI;
         |SELECT #1#dscam004;
         |LEE 000#dscam004.p; |REPON_FICHA #dscam004;

         |BUCLE MarcaConf; nSwError = 0;

         |SI #dscam051#1 = "S"; |Y HayConta = 1; |Y aCodEnl ! "    ";
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #17 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;
            #dscaw013#15 = aCodEnl;      #dscaw013#0  = 1;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
            #dscaw013#5 = nNumSec;       #dscaw013#6  = nNumSec;
            #dscaw013#11 = "N";          #dscaw013#12 = 10;
            |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
            #dscaw013#15 = aCodEnl;      #dscaw013#0  = 2;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
            #dscaw013#3 = "RCF";         #dscaw013#4  = "RCF";
            #dscaw013#11 = "A";          #dscaw013#12 = 3;
            |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
            #dscaw013#15 = aCodEnl;      #dscaw013#0  = 3;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
            #dscaw013#7 = fFecha;        #dscaw013#8  = fFecha;
            #dscaw013#11 = "F";          #dscaw013#12 = 10;
            |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
            Comodin = aCodEnl; |QBF Comodin;
            Comodin = "dscam033.tab;" + Comodin;
            |LIBERA #dscam003; |CIERRAT #dscam003;
            |LIBERA #dscam004; |CIERRAT #dscam004;
            |SUB_EJECUTA_NP Comodin; |DELINDEX #dscaw013;
            |ABRET #dscam003; |LEE 101#dscam003.=;
            |ABRET #dscam004; |LEE 101#dscam004.=;
         |FINSI;
      |FINSI;
   |SINO;
      nSwError = 1;
   |FINSI;
|FPRC;

|PROCESO MarcaRem;
|ACABA;
   #dscam003#40 = #dscaw058#0;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      |SI #dscaw058#19 = "S";
         #dscam003#90 = "N";
      |SINO;
         #dscam003#90 = "S";
      |FINSI;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;

   #dscam004#17 = #dscaw058#0;
   #dscam004#3 = 99;
   |LEE 000#dscam004.];
   |SI FSalida ! 0;
      |LEE 000#dscam004.u;
      |SI FSalida = 0; |Y #dscam004#17 = #dscaw058#0;
         LinCob = #dscam004#3 + 1;
      |SINO;
         LinCob = 1;
      |FINSI;
   |SINO;
      |SI #dscam004#17 = #dscaw058#0;
         LinCob = #dscam004#3 + 1;
      |SINO;
         |LEE 000#dscam004.a;
         |SI FSalida = 0; |Y #dscam004#17 = #dscaw058#0;
            LinCob = #dscam004#3 + 1;
         |SINO;
            LinCob = 1;
         |FINSI;
      |FINSI;
   |FINSI;
   |DDEFECTO #dscam004;
   #dscam004#17 = #dscaw058#0;
   #dscam004#15 = #dscam003#27;
   #dscam004#0  = #dscam003#0;
   #dscam004#1  = #dscam003#1;
   #dscam004#2  = #dscam003#2;
   #dscam004#3  = LinCob;
   #dscam004#4  = #dscaw017#5;
   #dscam004#5  = "PRE";
   #dscam004#6  = #dscaw017#8;
   #dscam004#7  = #dscam003#23;
   #dscam004#8  = #dscam003#31;
   #dscam004#25 = #dscam003#61;
   #dscam004#26 = #dscam003#65;
   #dscam004#11 = #dscam003#13;
   #dscam004#33 = CambioBaseVn;
   #dscam004#43 = nNumSec;
   #dscam004#44 = #dscam003#31;
   #dscam004#45 = #dscam004#44 * #dscam004#33;
   #dscam004#46 = 0;
   #dscam004#47 = 0;
   |GRABA 020#dscam004.n; |LEE 000#dscam004.=
|FPRC;

|DEFBUCLE MarcaRem;
#dscaw058#1;
14;
0000000001,"*";
9999999999,"*";
;
NULL,MarcaRem;
|FIN;

|PROCESO Remesables;
   |CONFI "    NConforme con la seleccion ? ";
   |SI FSalida = 0;
      |HAZ PideAcept;
      |SI nSwError = 0;
         |SALVA_FICHA #dscam004;
         |SELECT #3#dscam004;
         |LEE 000#dscam004.u;
         |SI nNumSec [ #dscam004#43;
            nNumSec = #dscam004#43 + 1;
         |SINO;
            nNumSec = nNumSec + 1;
         |FINSI;
         |SELECT #1#dscam004;
         |LEE 000#dscam004.p; |REPON_FICHA #dscam004;

         |BUCLE MarcaRem; nSwError = 0;

         |SI #dscam051#1 = "S"; |Y HayConta = 1;
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #17 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;
            #dscaw013#15 = aEnlPrepar;   #dscaw013#0  = 1;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
            #dscaw013#5 = nNumSec;       #dscaw013#6  = nNumSec;
            #dscaw013#11 = "N";          #dscaw013#12 = 10;
            |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
            #dscaw013#15 = aEnlPrepar;   #dscaw013#0  = 2;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
            #dscaw013#3 = "PRE";         #dscaw013#4  = "PRE";
            #dscaw013#11 = "A";          #dscaw013#12 = 3;
            |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
            #dscaw013#15 = aEnlPrepar;   #dscaw013#0  = 3;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
            #dscaw013#7 = #dscaw017#8;   #dscaw013#8  = #dscaw017#8;
            #dscaw013#11 = "F";          #dscaw013#12 = 10;
            |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
            Comodin = aEnlPrepar; |QBF Comodin;
            Comodin = "dscam033.tab;" + Comodin;
            |LIBERA #dscam003; |CIERRAT #dscam003;
            |LIBERA #dscam004; |CIERRAT #dscam004;
            |SUB_EJECUTA_NP Comodin; |DELINDEX #dscaw013;
            |ABRET #dscam003; |LEE 101#dscam003.=;
            |ABRET #dscam004; |LEE 101#dscam004.=;
         |FINSI;
      |SINO;
         |MENAV "    Proceso abortado";
      |FINSI;
   |SINO;
      nSwError = 1;
   |FINSI;
|FPRC;

|PROCESO Tipo13w058; |TIPO 13;
   |SI #dscaz080#3 = "P";
      |MENSA "    <F2>Marca.,<F3>Cambia F.Vto.,<F4>Cambia dom.,<F5>Cambia TR,<ESC>Actualizar ";
   |SINO;
      |MENSA "    <F2> Marca/Desmarca,<F3> Cambiar F.Vto.,<F4> Cambia domic.,<ESC> Actualizar";
   |FINSI;
   |SI #dscaz080#3 = "C";
      |SI #dscaw058#19 = "S";
         aAlfa = "Marca para cobro por confirme";
      |SINO;
         aAlfa = "                             ";
      |FINSI;
   |SINO;
      |SI #dscaw058#19 = "S";
         aAlfa = "Marca de recibo preparado    ";
      |SINO;
         aAlfa = "                             ";
      |FINSI;
   |FINSI;
   |ATRI I; |PINTA 1551, aAlfa; |ATRI N;
|FPRC;

|PROCESO TipoRecibo;
   #dscam081#0 = #dscam082#0;
   |LEE 000#dscam081.=;
   |SI FSalida = 0; |Y #dscam081#2 = "P";
      |DDEFECTO #dscaw077;
      #dscaw077#0 = #dscam082#1;
      #dscaw077#1 = #dscam082#2;
      |GRABA 020#dscaw077.n;
   |FINSI;
|FPRC;

|DEFBUCLE TipoRecibo;
#dscam082#1;
;
INICIO;
FINAL;
;
NULL,TipoRecibo;
|FIN;

|PROCESO Tipo11w058; |TIPO 11;
   |SI FSalida = 10;
      #dscam003#40 = #dscaw058#0;
      |LEE 000#dscam003.=;
      |SI #dscaw058#14 = " ";
         enSwClas   = 1; eaFichClas = "dscaz080"; eaTipoClas = #dscaw058#7;
         |HAZ CompruebaClas;
         |SI eaFichClas = "INFOR"; |O eaTipoClas ! #dscaz080#3;
            eaResult = "V"; enNumDocum = #dscaw058#0; enTipoRec = #dscaw058#7;
            eaFichClas = "dscaz080"; eaFiltro = #dscaz080#3;
            |HAZ CambiaTR;
            |SI eaResult = "ERROR"; |ERROR; |ACABA; |FINSI;
         |FINSI;
         |SI nNumSel = 0;
            |SI #dscam003#93 = "N";
               aTipo = "E";
            |SINO;
               aTipo = "A";
            |FINSI;
         |SINO;
            |SI #dscam003#93 = "N"; |Y aTipo = "A";
               |MENAV "    Se estan seleccionando recibos para aceptar";
               |ERROR; |ACABA;
            |FINSI;
            |SI #dscam003#93 = "S"; |Y aTipo = "E";
               |MENAV "    Se estan seleccionando recibos a enviar";
               |ERROR; |ACABA;
            |FINSI;
         |FINSI;
         eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscam003#40; |HAZ ProcesaTempo;
         |SI enSwError = 0;
            #dscaw058#14 = "*";
            nNumSel = nNumSel + 1;
            TotalSelec = TotalSelec + #dscaw058#6;
         |FINSI;
      |SINO;
         eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam003#40; |HAZ ProcesaTempo;
         #dscaw058#14 = " ";
         nNumSel = nNumSel - 1;
         |SI nNumSel = 0;
            aTipo = "";
         |FINSI;
         TotalSelec = TotalSelec - #dscaw058#6;
      |FINSI;
      |GRABA 020#dscaw058.a;
   |FINSI;
   |SI FSalida = 11;
      |ENCAMPO #5#dscaw058;
      |SI FSalida = 0;
         |SI #dscaw058#5 ] #dscaw058#4;
            |CONFI "    NEsta seguro de cambiar la fecha de vencimiento? ";
            |SI FSalida = 0;
               #dscam003#40 = #dscaw058#0;
               |LEE 101#dscam003.=;
               |SI FSalida = 0;
                  |SI #dscam003#4 [ #dscaw058#5;
                     aAlfa = #48#17; |QBF aAlfa;
                     aAlfa1 = aAlfa + "def/agifa133.mas";
                     |XABRE "E", aAlfa1, nCalc;
                     |SI FSalida = 0;
                        |CARGA_DEF aAlfa1, agifa133@;
                        |SI FSalida = 0;
                           aAlfa = aAlfa + "fich/" + (("00000" + #48#15) % -105) + "/";
                           |PATH_DAT #101 aAlfa; |ABRE #agifa133@;
                           #agifa133@#4 = #dscam003#0;
                           #agifa133@#0 = #dscam003#1;
                           #agifa133@#1 = #dscam003#2;
                           |LEE 101#agifa133@.=;
                           |SI FSalida = 0;
                              #agifa133@#3 = #dscaw058#5;
                              |GRABA 020#agifa133@.a; |LIBERA #agifa133@;
                           |FINSI;
                           |CIERRA #agifa133@; |DESCARGA_DEF #agifa133@;
                        |FINSI;
                     |FINSI;
                     #dscam003#3 = #dscaw058#5;
                     |GRABA 020#dscam003.a; |LIBERA #dscam003;
                     |GRABA 020#dscaw058.a;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            |MENAV "    No se puede indicar una fecha de vencimiento menor que la de emision";
            |LEE 000#dscaw058.=;
         |FINSI;
         |PINDA #0#dscaw058;
      |FINSI;
   |FINSI;
   |SI FSalida = 12;
      |C_M #dscaw058#5, 1, "N";
      |ENDATOS #1#dscaw058;
      |SI FSalida = 0;
         |GRABA 020#dscaw058.a;
         |ABRE #dscam003;
         #dscam003#40 = #dscaw058#0;
         |LEE 101#dscam003.=;
         |SI FSalida = 0;
            #dscam003#8  = #dscaw058#20;
            #dscam003#9  = #dscaw058#22;
            #dscam003#11 = #dscaw058#24;
            #dscam003#10 = #dscaw058#25;
            |GRABA 020#dscam003.a; |LIBERA #dscam003;
         |FINSI;
         |CIERRA #dscam003;
      |FINSI;
      |C_M #dscaw058#5, 1, "S";
   |FINSI;
   |SI FSalida = 13; |Y #dscaz080#3 = "P";
      aAlfa = "tm" + Usuario; |NOME_DAT #77 aAlfa;
      |DELINDEX #dscaw077; |ABRE #dscaw077;
      |ABRE #dscam081; |ABRE #dscam082;

      |BUCLE TipoRecibo;
      nModo = 2 + 4 + 8 + 16; nPos1 = 1050; nPos2 = 1880;
      |LINEAL_SIMPLE #1#dscaw077, nModo, nPos1, nPos2, NULL, NULL,NULL;
      |SI FSalida = 0;
         |CONFI "    NConforme con la seleccion ? ";
         |SI FSalida = 0;
            #dscaw058#7 = #dscaw077#0;
            #dscaw058#8 = #dscaw077#1;
            |GRABA 020#dscaw058.a;

            |ABRE #dscam003;
            #dscam003#40 = #dscaw058#0;
            |LEE 101#dscam003.=;
            |SI FSalida = 0;
               #dscam003#12 = #dscaw058#7;
               |GRABA 020#dscam003.a; |LIBERA #dscam003;
            |FINSI;
            |CIERRA #dscam003;
         |FINSI;
      |FINSI;

      |CIERRA #dscam082; |CIERRA #dscam081;
      |CIERRA #dscaw077; |DELINDEX #dscaw077;
   |FINSI;
|FPRC;

|PROCESO TipoDocumento;
   |SI #dscaz080#3 = "P"; #dscaz080#4 = "Talon/Pagare"; |FINSI;
   |SI #dscaz080#3 = "A"; #dscaz080#4 = "Aceptado    "; |FINSI;
   |SI #dscaz080#3 = "C"; #dscaz080#4 = "Confirming  "; |FINSI;
   |PINTA #dscaz080#4;
|FPRC;

|PROCESO Tipo5; |TIPO 5;
   #dscaw058#19 = "S";
   |LINEAS_BI_ATRI #dscaw058#19,S,D,-1;
|FPRC;

|PROCESO CalculaDC;
   eaEntidad  = #dscaw058#20;
   eaSucursal = #dscaw058#22;
   eaCuenta   = #dscaw058#24;
   |HAZ CalculoDC;
   #dscaw058#25 = eaDC; |PINTA #dscaw058#25;
|FPRC;

|PROCESO Desbloquea;
   eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw058#0; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE Desbloquea;
#dscaw058#1;
;
INICIO;
FINAL;
;
NULL,Desbloquea;
|FIN;

|PROGRAMA;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0; |DDEFECTO #dscam051; |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#47 = "N";
      |MENAV "    Opcion de uso exclusivo con perfiles";
      |ERROR; |ACABA;
   |FINSI;

   |HAZ Tipo8;

   aAlfa = "ed" + Usuario; |QBF aAlfa;
   |NOME_DAT #0 aAlfa;
   aAlfa = "el" + Usuario; |QBF aAlfa;
   |NOME_DAT #10 aAlfa;

   |ABRE #dscam003; |ABRE #dscam004;

   |CLS;
   |CABEZA " Entrada documentos cobro a clientes ";

|ET Nueva;
   |DELINDEX #dscaw058; |ABRE #dscaw058;
   |PINPA #0#0; |PINDA #0#0;
   |ENTLINEAL #1#dscaw058,-1,7,21,1,infw058,supw058;
   |ENDATOS #1#0;
   |SI FSalida = 0;
|ET Otra;
      TotalSelec = 0; nNumSel = 0; nSwError   = 0; aTipo = "";
      |ABRE #dscam058;

      |SI #dscaz080#0 = "      ";
         |BUCLE Documentos1;
      |SINO;
         |BUCLE Documentos2;
      |FINSI;
|ET Otra1;
      |ENTLINEAL #1#dscaw058,-1,4,21,1,infw058,supw058;

      |SI nNumSel ! 0;
         |SI #dscaz080#3 = "P";
            |HAZ CreaPagare;
            |SI nSwError = 0;
               |CIERRA #dscaw058;
               |BUCLE Desbloquea;
               |DELINDEX #dscaw058; |ABRE #dscaw058;
            |SINO;
               |MENAV "    Proceso abortado";
               |VETE Otra1;
            |FINSI;
         |FINSI;
         |SI #dscaz080#3 = "A";
            |HAZ Acepta;
            |SI nSwError = 0;
               |CIERRA #dscaw058;
               |BUCLE Desbloquea;
               |DELINDEX #dscaw058; |ABRE #dscaw058;
            |SINO;
               |MENAV "    Proceso abortado";
               |VETE Otra1;
            |FINSI;
         |FINSI;
         |SI #dscaz080#3 = "C";
            |HAZ MarcaConfirme;
            |SI nSwError = 0;
               |CIERRA #dscaw058;
               |BUCLE Desbloquea;
               |DELINDEX #dscaw058; |ABRE #dscaw058;
            |SINO;
               |MENAV "    Proceso abortado";
               |VETE Otra1;
            |FINSI;
         |FINSI;
         |SI #dscaz080#3 = "R";
            |HAZ Remesables;
            |SI nSwError = 0;
               |CIERRA #dscaw058;
               |BUCLE Desbloquea;
               |DELINDEX #dscaw058; |ABRE #dscaw058;
            |SINO;
               |MENAV "    Proceso abortado";
               |VETE Otra1;
            |FINSI;
         |FINSI;
         |VETE Otra;
      |FINSI;

      |CIERRA #dscam058;
      |DDEFECTO #dscaz080; |VETE Nueva;

   |FINSI;
   |CIERRA #dscaw058;

   |CIERRA #dscaz080;
   |CIERRA #dscam003; |CIERRA #dscam004;

   eaSesion   = Usuario; |HAZ LimpiaTempo;

   |HAZ Tipo9;
|FPRO;
