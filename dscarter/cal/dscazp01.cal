|FICHEROS;
   Program@ #1000;
   dscam023 #497,MANTE;
   dscam024 #498;
   dscam038 #499;

   &agif041@ #487;
   &agif321@ #496;
   &agif324@ #495;
   &agif325@ #483;
   &canempr@ #494;
   &camoned@ #486;
   &caclipr@ #484;

   &agif024@ #493;
   &agif112@ #488;
   &cacuent@ #492;
   dscam000 #490;
   dscam014 #489;
   dsfantas #500,MANTE;
   dscam003 #501;
   dscam008 #502;
   dscam051 #503;
   dscam063 #504;
   dscam064 #505;
   dscam065 #506;
   dscam004 #507;
   dscaw013 #508;
   dscam067 #509;
   dscam058 #512;

   &FichRef@ #510;
   dscam070  #511;
   dscam085 #5000;
   dscam083 #5001;
   dscam088 #5002;
   dscam087 #5003;
   dscam082 #5004;
   dscam084 #5005;
   dscam089 #5006;
   dscam081 #5007;
   dscam104 #5008;
   dscam042 #5009;
   dscam043 #5010;
   dscam044 #5011;
   dscam045 #5012;
   dscam030 #5013;

   RefPLB0@ #6000;
   RefDocu@ #6001;
   RefRecs@ #6002;
|FIN;

|VARIABLES;
     aLon = "";
     aDato = "";
     i = 0;
     aCar = "";
     &eaAlfa = "";
     &enAltaCta = 0;
     aEmp = "";
     aPeri = "";
     aParam = "";
     &eaInfDefecto = "";
     aSalida = "";
     aVersion = "";
     aAux = "";
     aEmpresa = "";

     &PRMNT_enPerfil = 0;

     &eaCodBLZ   = "";
     &eaCodSwift = "";
     &eaCPExt = "";
     &eaCodIBAN  = "";
     &eaCodBIC   = "";
     &eaFichClas = ""; &eaTipoClas = ""; &enSwClas = 0; &eaFiltro = "";
     &eaFiltroPag = "";

     &eaCliente       = "";
     &efFechaVto      = @;
     &enSwModo        = 0;

     &eaEntrada       = "";
     &eaSalida        = "";

     &enEmpresa       = 0;
     &enPeriodo       = 0;

     &enExistOblig = 0;

     &efFechaDiv   = @;

     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base
     &nDeci_DivF     = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivF  = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVisF  = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisF= 0;  || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisF  = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisF  = 0;   || Decimales en el Importe visual. (lineas)
     &nDeci_IVAImp   = 0;   || Decimales en el Total IVA visual. (lineas)

     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)

     &nDeci_BaseMxP  = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBasMxP= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_DivP     = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivP  = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVisP  = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisP = 0;  || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisP  = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisP  = 0;   || Decimales en el Importe visual. (lineas)

     &CmpDivisa = 0;  &MaxDigit = 0;    &UltNivel = 0;
     &Divisa = "";    &CambioDivVn = 0; &CambioDivCm = 0;
     &CambioBaseVn = 0; &CambioBaseCm = 0; &NombreDiv = "";
     &nDeci_Base = 0; &nDeci_Div = 0;   &nDeci_males = 0;
     &HayGestion = 0; &HayConta = 0;    &enDocum = 0;
     &enLibro = 0;    &enFactura = 0; &enRecibo = 0;
     &eaTipoRecibo = ""; &enNumDocum = 0; &eaMensRet = ""; &enSwError = 0;
     &enSwErr = 0;
     &MonedaConta = ""; &eaMBase = ""; &eaNombreMBase = "";

     &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
     &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = "";
     &aCuenta   = ""; &nNivel = 0;    &enDocumento = 0;

     &DCampoG = 0;  &HCampoG = 0;  &DCampoC = 0;  &HCampoC = 0;
     &PosLibro = 0; &PosSerie = 0; &PosFactu = 0; &PosRecib = 0;
     &Niv1 = 0; &Niv2 = 0; &Niv3 = 0; &Niv4 = 0; &Niv5 = 0; &Niv6 = 0;

     &eaFechaMand = "";
     &eaDireccion = "";
     &eaDirCobro  = "";
     &eaPoblacion = "";
     &eaPobCobro  = "";
     &eaProvincia = "";
     &eaProvCobro = "";
     &eaApCorreos = "";
     &eaCP       = "";
     &eaCPCobro  = "";
     &eaCP1      = "";
     &eaCP1Cobro = "";
     &eaCP2      = "";
     &eaCP2Cobro = "";
     &eaNif      = "";
     &eaNombre   = "";
     &eaNomFisc  = "";
     &eaTelefono = "";
     &eaTlfCobro = "";
     &eaFax      = "";
     &eaEmail    = "";
     &eaCodPais  = "";
     &eaPais     = "";
     &eaCodigo   = "";
     &eaTipoCod  = "";
     &eaCadena   = "";
     &enMayus    = 0;

     &enHandLog  = 0;
     &enSinConfi = 0;

     &enEmpCartera = 0; &enEmpGestion = 0; &enDocRiesgo = 0;
     &enRiesgoUsado = 0; &enRiesgoConced = 0; &enRiesgoFact = 0;
     &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = ""; &eaNomCli = "";
     &eaFicher = ""; &eaClave = "";
     &eaTipoR = "";
     &enBanco = 0;  &eaSinAlta = "N";
     &TipoCliente   = ""; &CodCliente   = ""; &NumDigito = 0;
     &TipoProveedor = ""; &CodProveedor = "";
     &Nombre    = ""; &Direccion = "";
     &CP1       = ""; &CP2       = "";
     &Poblacion = ""; &Provincia = "";
     &DNI       = ""; &Telefono  = "";
     &Fax       = "";

     &DirFactura = ""; &CPF1       = ""; &CPF2       = "";
     &PobFactura = ""; &ProFactura = "";

     &Fichero   = "";  &Cmp = "";   &Tipo = ""; &CmpNum = 0;
     &aInforme  = "";

     &enTipoRec = 0; nTipoRec = 0; aFichClas = ""; &eaClvUsuarios = "";

     &eaEntidad = ""; &eaSucursal = ""; &eaCuenta = ""; &eaDC = "";
     Comodin1 = ""; Comodin 2 = ""; Comod = ""; Comod1 = ""; nCalc = 0; nCalc1 = 0; nCalc2 = 0;
     Cont = 0; Digito1 = 0; Digito2 = 0; Calc = 0; Calc1 = 0; Calc2 = 0;
     nLinea = 0; FEstado = 0;
     Clave1 = 0; Clave2 = 0; Clave3 = "";
     fFechaTr  = @;
     nDocumento = 0;
     fFecha1  = @; fFecha2  = @;

     aAlfaPLB  = "";
     aAlfa1PLB = "";
     nCalcPLB  = 0;
     nNumChar  = 0;
     nContPLB  = 0;
     nDocAgrup = 0;
     &enBotonUsuarios = 0;

     aResp     = "";
     nPos1     = 0;
     nPos2     = 0;
     nEmpresa  = 0;

     aLen      = "";
     aRaya     = "";
     aMax      = "";
     aMin      = "";

     aDir      = "";
     nEmp      = 0;
     nPer      = 0;
     nCoefi    = 0;
     nEvalua   = 0;
     nDocumAnt = 0;
     nPrimero  = 0;

     nTotalReciD = 0;
     nTotalLiquD = 0;
     nTotalPdteD = 0;
     nTotalGtosND = 0;
     nTotalGtosDD = 0;
     nTotalGtosOD = 0;
     nTotalReciB = 0;
     nTotalLiquB = 0;
     nTotalPdteB = 0;
     nTotalGtosNB = 0;
     nTotalGtosDB = 0;
     nTotalGtosOB = 0;
     nTotalDesprD = 0;
     nTotalDesprB = 0;
     nTotalDescuD = 0;
     nTotalDescuB = 0;

     nSwError = 0; aOper = "";
     nCodigo = 0;  nCuentaCobs = 0; Modo1 = "";
     aClasif = ""; &eaResult = "";
     aSinAltaAnt = "";

     nLen    = 0;
     nPos    = 0;
     sw      = 0;
     nCampo  = 0;

     aLetra1 = ""; aLetra2 = ""; aLetra3 = ""; aLetra4 = ""; aLetra5 = "";
     aLetra6 = ""; aLetra7 = ""; aLetra8 = "";
     aCadena   = "";  aAlfa = ""; aAlfa4 = "";
     aCaracter = "";
     aCarac1 = 0; aCarac2 = 0; aCarac3 = 0; aCarac4 = 0; aCarac5 = 0;
     nCaracter   = 0;
     nPosi       = 0;
     Tecla       = 0;
     aAlfa1  = ""; TipoCons = "C";
     aPath   = "";

     nRels = 0;   nContRel = 0; aFichRel = ""; aCmpsRel = ""; nCmpsRel = 0;
                  nContKey = 0;                aCmpsKey = ""; nCmpsKey = 0;
     nCmpRel = 0; nCmpKey = 0;

     Comodin = ""; aLong = ""; nLong = 0; ComodNum = 0; NumRef = 0; aHora = "";
     SwHay = 0; RiesgoUtil = 0; nCont = 0; nSwErr = 0;
     nTotalRImApl = 0;
     nTotalRIm = 0;
     nTotalRie = 0;
     &enRiesgoImp = 0;

     &TipoDato  = "";
     Vacio1    = "";
     Vacio2    = "";
     aAlfa2    = "";
     aAlfa3    = "";
     nInd      = 0;
     &Long      = 0;
     &LongDec   = 0;
     nCont1    = 0;
     nNegativo = 0;

      &enSwCambioRem = 0;

     aFiltro     = "";
     aEstado     = "";
     aCliente    = "";
     aFicERP     = "";
     aDSERP      = "";
     aParaLee    = "";
     aLinea      = "";

     nPorcImp    = 0;
     nImpImp     = 0;
     nImpImp2    = 0;
     nSwSaltaRel = 0;
     nHandle     = 0;

     &enGrupoOTP  = 0;
     &enPrevenzis = 0;
     &enSinac     = 0;
     &enNoAltaCli = 0;

{200}nImpAgr   = 0;
{200}nDocAnt   = 0;
{200}nImpAnt   = 0;
|FIN;

|PROCESO CalculoDC;

   Digito1 = 0; Digito2 = 0;
   Comodin1 = ""; Comodin2 = "";

   |PARA Cont = 1; |SI Cont [ 4; |HACIENDO Cont = Cont + 1;
      Calc = 0 - ((100 * Cont) + 1);
      aCaracter = eaSucursal % Calc;
      |SI aCaracter = ""; aCaracter = "0"; |FINSI;
      Comodin1 = Comodin1 + aCaracter;
   |SIGUE;
   |PARA Cont = 1; |SI Cont [ 4; |HACIENDO Cont = Cont + 1;
      Calc = 0 - ((100 * Cont) + 1);
      aCaracter = eaEntidad % Calc;
      |SI aCaracter = ""; aCaracter = "0"; |FINSI;
      Comodin1 = Comodin1 + aCaracter;
   |SIGUE;

   |PARA Cont = 1; |SI Cont [ 8; |HACIENDO Cont = Cont + 1;
      Calc = (100 * Cont) + 1;
      aCaracter = Comodin1 % Calc; Calc = aCaracter;
      |SI Cont = 1; Digito1 = Digito1 + (Calc * 6);  |FINSI;
      |SI Cont = 2; Digito1 = Digito1 + (Calc * 3);  |FINSI;
      |SI Cont = 3; Digito1 = Digito1 + (Calc * 7);  |FINSI;
      |SI Cont = 4; Digito1 = Digito1 + (Calc * 9);  |FINSI;
      |SI Cont = 5; Digito1 = Digito1 + (Calc * 10); |FINSI;
      |SI Cont = 6; Digito1 = Digito1 + (Calc * 5);  |FINSI;
      |SI Cont = 7; Digito1 = Digito1 + (Calc * 8);  |FINSI;
      |SI Cont = 8; Digito1 = Digito1 + (Calc * 4);  |FINSI;
   |SIGUE;

   Digito1 = 11 - (Digito1 $ 11);
   |SI Digito1 = 10; Digito1 = 1; |FINSI;
   |SI Digito1 = 11; Digito1 = 0; |FINSI;

   |PARA Cont = 1; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
      Calc = 0 - ((100 * Cont) + 1);
      aCaracter = eaCuenta % Calc;
      |SI aCaracter = ""; aCaracter = "0"; |FINSI;
      Comodin2 = Comodin2 + aCaracter;
   |SIGUE;

   |PARA Cont = 1; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
      Calc = (100 * Cont) + 1;
      aCaracter = Comodin2 % Calc; Calc = aCaracter;
      |SI Cont = 1;  Digito2 = Digito2 + (Calc * 6);  |FINSI;
      |SI Cont = 2;  Digito2 = Digito2 + (Calc * 3);  |FINSI;
      |SI Cont = 3;  Digito2 = Digito2 + (Calc * 7);  |FINSI;
      |SI Cont = 4;  Digito2 = Digito2 + (Calc * 9);  |FINSI;
      |SI Cont = 5;  Digito2 = Digito2 + (Calc * 10); |FINSI;
      |SI Cont = 6;  Digito2 = Digito2 + (Calc * 5);  |FINSI;
      |SI Cont = 7;  Digito2 = Digito2 + (Calc * 8);  |FINSI;
      |SI Cont = 8;  Digito2 = Digito2 + (Calc * 4);  |FINSI;
      |SI Cont = 9;  Digito2 = Digito2 + (Calc * 2);  |FINSI;
      |SI Cont = 10; Digito2 = Digito2 + (Calc * 1);  |FINSI;
   |SIGUE;

   Digito2 = 11 - (Digito2 $ 11);
   |SI Digito2 = 10; Digito2 = 1; |FINSI;
   |SI Digito2 = 11; Digito2 = 0; |FINSI;

   eaDC = Digito1 + Digito2;

|FPRC;

|PROCESO SinBarra; |TIPO 5;
   FSalida = "SINBARRA";
|FPRC;

|PROCESO BucleTR;
   |SI #dscam038#2 = " "; aSinAltaAnt = eaSinAlta; eaSinAlta = "S"; |FINSI;
   |SI #dscam038#8 = "R";
      |SI #dscam038#2 ! eaTipoR; |ACABA; |FINSI;
   |FINSI;

   |SI #dscam051#123 = "S";
      |SALVA_FICHA #dscam038;
      #dscam023#0 = eaCliGest;
      |LEE 101#dscam023.=;
      |SI FSalida ! 0;
         |SI eaSinAlta = "N";
            |PUSHV 0501 2380;
            #dscam023#0 = eaCliGest; #dscam023#1 = eaNomCli;
            |PINPA #0#dscam023; |PINDA #0#dscam023;
            |CONFI "    NDar de alta ? ";
            |SI FSalida = 0;
               Nombre = eaNomCli;
               |DDEFECTO #dscam023;
               #dscam023#0 = eaCliGest;
               #dscam023#1 = eaNomCli;
               |GRABA 020#dscam023.b;
               |ENDATOS #1#dscam023;
               |SI FSalida = 0;
                  |GRABA 020#dscam023.a;
                  |DBASE Comodin;
                  Comodin = Comodin + "fich/" + (("00000" + enEmpCartera) % -105) + "/";
                  |PATH_DAT #498 Comodin; |ABRE #dscam024;
                  |POPV;
               |SINO;
                  |BORRA 020#dscam023.a;
                  Comodin = eaCliGest; |QBF Comodin;
                  Comodin = "    La ficha de riesgo del cliente " + Comodin + " no existe";
                  |MENAV Comodin; |LIBERA #dscam023;
                  |POPV; |ACABA;
               |FINSI;
            |SINO;
               Comodin = eaCliGest; |QBF Comodin;
               Comodin = "    La ficha de riesgo del cliente " + Comodin + " no existe";
               |MENAV Comodin;
               |POPV; eaSinAlta = "S";
               |ACABA;
            |FINSI;
         |SINO;
            |DDEFECTO #dscam023;
            #dscam023#0 = eaCliGest;
            #dscam023#1 = eaNomCli;
            |GRABA 020#dscam023.b;
         |FINSI;
      |FINSI;
      |REPON_FICHA #dscam038;
   |FINSI;

   |SI #dscam038#2 = " "; eaSinAlta = aSinAltaAnt; |FINSI;

   |SI eaSerie ] #dscam038#3; |Y eaSerie [ #dscam038#4;
      |SI #dscam051#123 = "S";
         #dscam024#0 = eaCliGest;
         #dscam024#1 = #dscam038#6;
         |LEE 101#dscam024.=;
         |SI FSalida ! 0;
            |DDEFECTO #dscam024;
            #dscam024#0 = eaCliGest;
            #dscam024#1 = #dscam038#6;
            |GRABA 020#dscam024.b;
         |FINSI;
      |FINSI;

      aLong = eaTipoOper % 0; nLong = aLong;
      |PARA Cont = 1; |SI Cont [ nLong; |HACIENDO Cont = Cont + 2;
         Calc = (Cont * 100) + 1;
         Comodin1 = eaTipoOper % Calc;
         Calc = Calc + 100;
         Comodin = eaTipoOper % Calc;
         Calc = Comodin;

         |SI Calc = 6;
            |SI #dscam051#124 = "S";
               |ABRE #dscam014;
               #dscam014#0 = enBanco;
               |LEE 101#dscam014.=;
               |SI FSalida = 0;
                  |SI Comodin1 = "-";
                     #dscam014#13 = #dscam014#13 - nImporte;
                  |SINO;
                     #dscam014#13 = #dscam014#13 + nImporte;
                  |FINSI;
                  |GRABA 020#dscam014.a; |LIBERA #dscam014;
               |FINSI;
               |CIERRA #dscam014;
            |FINSI;
         |FINSI;

         |SI #dscam051#123 = "S";
            |SI Comodin1 = "-";
               #dscam024#Calc# = #dscam024#Calc# - nImporte;
            |SINO;
               #dscam024#Calc# = #dscam024#Calc# + nImporte;
            |FINSI;
            |SI enRiesgoImp ! 0;
               |SI Calc = 7; |O Calc = 4;
                  |SI #dscam024#Calc# ] -0.01; |Y #dscam024#Calc# [ 0.01;
                     |SI Calc = 7;
                        |SI #dscam024#4 ! 0;
                           #dscam024#4 = #dscam024#4 + #dscam024#7;
                           #dscam024#7 = 0;
                        |FINSI;
                     |FINSI;
                     |SI Calc = 4;
                        |SI #dscam024#7 ! 0;
                           #dscam024#7 = #dscam024#7 + #dscam024#4;
                           #dscam024#4 = 0;
                        |FINSI;
                     |FINSI;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
      |SIGUE;

      |SI #dscam051#123 = "S";
         #dscam024#8 = #dscam024#2 + #dscam024#3 + #dscam024#4 + #dscam024#6 + #dscam024#7 - #dscam024#5;
         #dscam024#9 = #dscam023#19 - #dscam024#8;

         |SI #dscam024#2 = 0; |Y #dscam024#3 = 0; |Y #dscam024#4 = 0; |Y #dscam024#5 = 0;
         |Y  #dscam024#6 = 0; |Y #dscam024#7 = 0; |Y #dscam024#8 = 0;
            |BORRA 020#dscam024.a;
         |SINO;
            |GRABA 020#dscam024.a;
         |FINSI;
         |LIBERA #dscam024;
      |FINSI;
   |FINSI;
   |SI #dscam051#123 = "S"; |LIBERA #dscam023; |FINSI;
   SwHay = 1;
|FPRC;

|DEFBUCLE BucleTR;
#dscam038#2;
;
|| enEmpCartera,enEmpGestion,eaTipoR,001;
|| enEmpCartera,enEmpGestion,eaTipoR,999;
enEmpCartera,enEmpGestion," ", 001;
enEmpCartera,enEmpGestion,"z", 999;
;
NULL,BucleTR;
|FIN;

|PROCESO Recalcula;
   |SELECT #4#dscam038;
   #dscam038#5 = enEmpCartera;
   #dscam038#6 = #dscam024#1;
   #dscam038#0 = 0;
   #dscam038#1 = 1;
   |LEE 000#dscam038.];
   |SI FSalida = 0; |Y #dscam038#5 = enEmpCartera; |Y #dscam038#6 = #dscam024#1;
      |SI #dscam038#8 = "R";
         RiesgoUtil = RiesgoUtil + #dscam024#2 + #dscam024#3 + #dscam024#4;
         RiesgoUtil = RiesgoUtil + #dscam024#6 + #dscam024#7 - #dscam024#5;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Recalcula;
#dscam024#1;
;
eaCliGest,01;
eaCliGest,99;
;
NULL,Recalcula;
|FIN;

|PROCESO RiesgoDisp;
   #dscam024#9 = #dscam023#19 - #dscam023#20;
   |GRABA 020#dscam024.a; |LIBERA #dscam024;
|FPRC;

|DEFBUCLE RiesgoDisp;
#dscam024#1;
;
eaCliGest,01;
eaCliGest,99;
;
NULL,RiesgoDisp;
|FIN;

|PROCESO BuscaGest;
   |ABRE #dscam038;
   |SELECT #2#dscam038;
   #dscam038#5 = enEmpCartera;
   #dscam038#0 = 0;
   #dscam038#2 = eaTipoR; aAlfa = #dscam038#2;
   #dscam038#1 = 1;
   |LEE 000#dscam038.];
   |PARA; |SI FSalida = 0; |Y #dscam038#5 = enEmpCartera; |HACIENDO;
      |SI eaSerie ] #dscam038#3; |Y eaSerie [ #dscam038#4; |Y #dscam038#2 = aAlfa;
         enEmpGestion = #dscam038#0; |SAL;
      |FINSI;
      |LEE 000#dscam038.s;
   |SIGUE;
   |SELECT #1#dscam038;
   |CIERRA #dscam038;
|FPRC;

|PROCESO BucleRiesgo;

   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#114 = 1;
      |HAZ EjecutaRiesgo; |ACABA;
   |FINSI;

   enDocRiesgo = #dscam003#40;

   || Si estoy tocando riesgo de facturas, compruebo que realmente no hay que
   ||     tocar el riesgo de impagados
   aAlfa = eaTipoOper; |QBF aAlfa;
   aAlfa = aAlfa - "+4";
   |SI FSalida ! 0;
      |HAZ RevisaDatosRiesgo;
      |SI enRiesgoImp ! 0;
         ||  .... llegados aqui si que hay parte del riesgo de facturas
         ||          que corresponde al riesgo de impagados
         |SI enRiesgoImp = nImporte;
            aAlfa = eaTipoOper; |QBF aAlfa;
            aAlfa = aAlfa - "+4";
            nCalc = FSalida + 97;         aAlfa4 = aAlfa % nCalc;
            nCalc = (FSalida / 100) + 99; aAlfa  = aAlfa % nCalc;
            aAlfa = aAlfa + "+7" + aAlfa4;

            eaTipoOper = aAlfa;
            |HAZ EjecutaRiesgo;
         |SINO;
                               nImporte = nImporte - enRiesgoImp; |HAZ EjecutaRiesgo;
            eaTipoOper = "+7"; nImporte = enRiesgoImp;            |HAZ EjecutaRiesgo;
         |FINSI;
      |SINO;
         |HAZ EjecutaRiesgo;
      |FINSI;
   |SINO;
      aAlfa = aAlfa - "-4";
      |SI FSalida ! 0;
         |HAZ RevisaDatosRiesgo;
         |SI enRiesgoImp ! 0;
            ||  .... llegados aqui si que hay parte del riesgo de facturas
            ||          que corresponde al riesgo de impagados
            |SI enRiesgoImp = nImporte;
               aAlfa = eaTipoOper; |QBF aAlfa;
               aAlfa = aAlfa - "-4";
               nCalc = FSalida + 97;         aAlfa4 = aAlfa % nCalc;
               nCalc = (FSalida / 100) + 99; aAlfa  = aAlfa % nCalc;
               aAlfa = aAlfa + "-7" + aAlfa4;

               eaTipoOper = aAlfa;
               |HAZ EjecutaRiesgo;
            |SINO;
                                  nImporte = nImporte - enRiesgoImp; |HAZ EjecutaRiesgo;
               eaTipoOper = "-7"; nImporte = enRiesgoImp;            |HAZ EjecutaRiesgo;
            |FINSI;
         |SINO;
            |HAZ EjecutaRiesgo;
         |FINSI;
      |SINO;
         |HAZ EjecutaRiesgo;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO RecsPdtes;
   |SI #RefRecs@#14 ! "P"; |Y #RefRecs@#14 ! "C"; |Y #RefRecs@#14 ! "R"; |Y #RefRecs@#14 ! "I";
      |ACABA;
   |FINSI;

   |SI #RefRecs@#31 ! 0; #dscam023#21 = #dscam023#21 + 1; |FINSI;
|FPRC;

|DEFBUCLE RecsPdtes;
#RefRecs@#11003;
;
#dscam023#0, "01.01.0000", "     ";
#dscam023#0, "31.12.9999", "zzzzz";
;
NULL, RecsPdtes;
|FIN;

|PROCESO EjecutaRiesgo;
   eaTipoR = eaTipoR > eaTipoR;
   |DBASE Comodin;  Comodin = Comodin + "fich/"; |PATH_DAT #499 Comodin;
   |SI enEmpCartera = -1;
      |SI enEmpGestion ! -1;
         |ABRE #dscam038;
         #dscam038#0 = enEmpGestion;
         #dscam038#1 = 1;
         |LEE 000#dscam038.];
         |PARA; |SI FSalida = 0; |Y #dscam038#0 = enEmpGestion; |HACIENDO;
            |SI eaTipoR = "";
               aAlfa = "F";
            |SINO;
               aAlfa = eaTipoR;
            |FINSI;
            |SI #dscam038#2 = aAlfa;
               |SI eaSerie ] #dscam038#3; |Y eaSerie [ #dscam038#4;
                  enEmpCartera = #dscam038#5; |SAL;
               |FINSI;
            |SINO;
               |SI #dscam038#2 = " ";
                  |SI eaSerie ] #dscam038#3; |Y eaSerie [ #dscam038#4;
                     enEmpCartera = #dscam038#5; |SAL;
                  |FINSI;
               |FINSI;
            |FINSI;
            |LEE 000#dscam038.s;
         |SIGUE;
         |CIERRA #dscam038;
         |SI enEmpCartera = -1;
            |SI enSinConfi = 0;
               aAlfa = eaTipoR; |QBF aAlfa;
               |SI aAlfa = "";
                  aAlfa = "F";
               |FINSI;
               aAlfa = "    Empresa de cartera para riesgos imposible de determinar"+&13+"[TR:" + aAlfa + "][Se:";
               aAlfa = aAlfa + eaSerie + "]";
               |MENAV aAlfa;
               aAlfa = "0000Empresa gestion del recibo:" + enEmpGestion;
               |MENAV aAlfa;
            |SINO;
               aAlfa = eaTipoR; |QBF aAlfa;
               |SI aAlfa = "";
                  aAlfa = "F";
               |FINSI;
               aAlfa = " Empresa de cartera para riesgos imposible de determinar [TR:" + aAlfa + "][Se:";
               aAlfa = aAlfa + eaSerie + "]";
               |XGRABA enHandLog, aAlfa;
            |FINSI;
            |ACABA;
         |FINSI;
      |SINO;
         |SI eaTipoR = "";  eaTipoR = "F"; |FINSI;
         enEmpCartera = #48#0;
         |HAZ BuscaGest;
      |FINSI;
   |SINO;
      |SI enEmpGestion = -1;
         |SI eaTipoR = "";  eaTipoR = "F"; |FINSI;
         |HAZ BuscaGest;
      |FINSI;
   |FINSI;

   |DFICE Comodin; Comodin = Comodin % -106; Comodin = Comodin % 0105;
   ComodNum = Comodin;
   |SI ComodNum ! enEmpCartera;
      |DBASE Comodin;  Comodin = Comodin + "fich/" + (("00000" + enEmpCartera) % -105) + "/";
      |PATH_DAT #497 Comodin; |PATH_DAT #498 Comodin;
      |PATH_DAT #503 Comodin;
   |FINSI;
   |ABRE #dscam038; |ABRE #dscam023; |ABRE #dscam024;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#3 = "N";
      |CIERRA #dscam024; |CIERRA #dscam023; |CIERRA #dscam038;
      |ACABA;
   |FINSI;

   |SI eaTipoR = "";  eaTipoR = "F"; |FINSI;
   |SI eaTipoR = "R"; nCalc = nImporte; nImporte = 0; |FINSI;

   |BUCLE BucleTR;
   RiesgoUtil = 0;
   |SI #dscam051#123 = "S";
      |BUCLE Recalcula;
      #dscam023#0 = eaCliGest;
      |LEE 101#dscam023.=;
      |SI FSalida = 0;
         |DDEF aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscam003.mas";
         |CARGA_DEF aAlfa, RefRecs@;
         |SI FSalida = 0;
            |ABRE #RefRecs@;
            #dscam023#21 = 0;
            |BUCLE RecsPdtes;
            |CIERRA #RefRecs@; |DESCARGA_DEF #RefRecs@;
         |FINSI;
/*
         || Compruebo si sale o entra en riesgo para actualizar el campo
         ||     'N§ de recibos pendientes'
         aAlfa = eaTipoOper; |QBF aAlfa;
         aAlfa = aAlfa - "-";
         |SI FSalida ! 0;       || Sale de riesgo
            aAlfa = aAlfa - "+";
            |SI FSalida = 0;    || No entra en otro tipo de riesgo
               ||entrega cta o Fac Tiq:70000/6864
               |SI aAlfa = 5; |O aAlfa = 4;
                  #dscam023#21 = #dscam023#21 - 1;
               |FINSI;
            |FINSI;
         |SINO;                 || Compruebo si entra en riesgo
            aAlfa = aAlfa - "+";
            |SI FSalida ! 0;       || Entra en riesgo
               aAlfa = aAlfa - "-";
               |SI FSalida = 0;    || No sale de otro tipo de riesgo
                  ||solo entrega cta o Fac  Tiq:70000/6864
                  |SI aAlfa = 5; |O aAlfa = 4;
                     #dscam023#21 = #dscam023#21 + 1;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
*/
         #dscam023#20 = RiesgoUtil;
         |GRABA 020#dscam023.a;
         |LIBERA #dscam023;
         |LEE 000#dscam023.=;
      |FINSI;
      |BUCLE RiesgoDisp;
      |SI eaTipoR = "R"; nImporte = nCalc; |FINSI;
   |FINSI;
   |CIERRA #dscam024; |CIERRA #dscam023; |CIERRA #dscam038;
|FPRC;

|PROCESO Tipo8; |TIPO 8;
   |HAZ EsArtenvas;
   |SI FSalida = 0;
      enSwCambioRem = 1;
   |SINO;
      enSwCambioRem = 0;
   |FINSI;

   |HAZ EsLuxe;
   |SI FSalida = 0;
      |MODULO aAlfa; |QBF aAlfa;
      |SI aAlfa = "dscam012";
         |CONTROL_SIMPLE 0, "BOTON,{{137}}Usuarios", 1567, 1579, BotonUsuarios;
         enBotonUsuarios = FSalida;
         |ESTADO_CONTROL enBotonUsuarios, "DISABLE";
      |FINSI;
   |FINSI;

   |DFICB Comodin;
   |PATH_DAT #490 Comodin;

   |SI enEmpCartera = 0;
      |DFICE Comodin;
      Comodin = Comodin % -106;
      Comodin = Comodin % 0105;
      enEmpCartera = Comodin;
   |FINSI;

   |ABRE #dscam000;
   #dscam000#0 = enEmpCartera;
   |LEE 000#dscam000.=;
   |CIERRA #dscam000;

   Comodin = #490#17; |QBF Comodin;
   |SI Comodin = "";
      Comodin = #490#16; |QBF Comodin;
      |SI Comodin ! "";
         ||Comodin1 = Comodin + "def/canempre.mas";
         Fichero = "Empresas"; Tipo = "C"; Cmp = ""; |HAZ ObtenFich;
         Comodin1 = Comodin + "def/" + Fichero + ".mas";
         |CARGA_DEF Comodin1,canempr@;
         |SI FSalida ! 0;
            |MENAV "    Problemas al cargar el def de empresas de contabilidad";
            |ACABA;
         |FINSI;

         ||Comodin1 = Comodin + "def/cacuenta.mas";
         Fichero = "Plan Contable"; Tipo = "C"; Cmp = ""; |HAZ ObtenFich;
         Comodin1 = Comodin + "def/" + Fichero + ".mas";
         |CARGA_DEF Comodin1,cacuent@;
         |SI FSalida ! 0;
            |MENAV "    Problemas al cargar el def de plan de cuentas de contabilidad";
            |DESCARGA_DEF #canempr@;
            |ACABA;
         |FINSI;

         Fichero = "Moneda Empresas"; Tipo = "C"; Cmp = ""; |HAZ ObtenFich;
         Comodin1 = Comodin + "def/" + Fichero + ".mas";
         |CARGA_DEF Comodin1,camoned@;
         |SI FSalida ! 0;
            |MENAV "    Problemas al cargar el def de monedas de empresa de contabilidad";
            |DESCARGA_DEF #canempr@;
            |DESCARGA_DEF #cacuent@;
            |ACABA;
         |FINSI;

         Fichero = "Clientes/Proveedores "; Tipo = "C"; Cmp = ""; |HAZ ObtenFich;
         Comodin1 = Comodin + "def/" + Fichero + ".mas";
         |CARGA_DEF Comodin1,caclipr@;
         |SI FSalida ! 0;
            |MENAV "    Problemas al cargar el def de clientes/proveedores de contabilidad";
            |DESCARGA_DEF #canempr@;
            |DESCARGA_DEF #cacuent@;
            |DESCARGA_DEF #camoned@;
            |ACABA;
         |FINSI;

         Comodin1 = (("00000" + #490#14) % -105) + #490#19;
         Comodin1 = Comodin + "fich/" + Comodin1 + "/";
         |PATH_DAT #492 Comodin1; |PATH_DAT #486 Comodin1; |PATH_DAT #484 Comodin1;
         Comodin1 = Comodin + "fich/";
         |PATH_DAT #494 Comodin1;
         |ABRE #cacuent@;
         |ABRE #canempr@;
         |ABRE #camoned@;
         |ABRE #caclipr@;
         Fichero = "Empresas"; Tipo = "C"; Cmp = "Codigo Empresa"; |HAZ ObtenDato;
         #canempr@#CmpNum# = #490#14;
         Fichero = "Empresas"; Tipo = "C"; Cmp = "Periodo"; |HAZ ObtenDato;
         #canempr@#CmpNum# = #490#19;
         |LEE 000#canempr@.=;
         |SI FSalida = 0;
            Comodin = "|NC"; Calc = #canempr@#Comodin#;
            |SI Calc > 27;
               |SI #canempr@#28 = "P";
                  nDeci_Base = 0;
                  nDeci_Div  = 0;
               |SINO;
                  nDeci_Base = 2;
                  nDeci_Div  = 2;
               |FINSI;
            |SINO;
               Fichero = "Moneda Empresas"; Tipo = "C"; Cmp = "Codigo Empresa"; |HAZ ObtenDato;
               #camoned@#CmpNum# = #490#14;
               Fichero = "Moneda Empresas"; Tipo = "C"; Cmp = "Periodo";        |HAZ ObtenDato;
               #camoned@#CmpNum# = #490#19;
               |LEE 000#camoned@.=;
               |SI FSalida = 0;
                  Fichero = "Moneda Empresas"; Tipo = "C"; Cmp = "Moneda";      |HAZ ObtenDato;
                  MonedaConta = #camoned@#CmpNum#;
                  |SI MonedaConta = "P";
                     nDeci_Base = 0;
                     nDeci_Div  = 0;
                  |SINO;
                     nDeci_Base = 2;
                     nDeci_Div  = 2;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;

         |PARA Cont = 14; |SI Cont [ 19; |HACIENDO Cont = Cont + 1;
            Fichero = "Empresas"; Tipo = "C";
            |SI Cont = 14; Cmp = "Digitos Nivel 1"; Niv1 = #canempr@#Cont#; |FINSI;
            |SI Cont = 15; Cmp = "Digitos Nivel 2"; Niv2 = #canempr@#Cont#; |FINSI;
            |SI Cont = 16; Cmp = "Digitos Nivel 3"; Niv3 = #canempr@#Cont#; |FINSI;
            |SI Cont = 17; Cmp = "Digitos Nivel 4"; Niv4 = #canempr@#Cont#; |FINSI;
            |SI Cont = 18; Cmp = "Digitos Nivel 5"; Niv5 = #canempr@#Cont#; |FINSI;
            |SI Cont = 19; Cmp = "Digitos Nivel 6"; Niv6 = #canempr@#Cont#; |FINSI;
            |HAZ ObtenDato;
            |SI #canempr@#CmpNum# > MaxDigit;
               MaxDigit = #canempr@#CmpNum#;
               UltNivel = Cont - 13;
            |FINSI;
         |SIGUE;
         HayConta   = 1;
      |SINO;
         HayConta   = 0;
      |FINSI;
      HayGestion = 0;
   |SINO;
      ||Comodin1 = Comodin + "def/agifa324.mas";
      Fichero = "Empresas"; Tipo = "G"; Cmp = ""; |HAZ ObtenFich;
      Comodin1 = Comodin + "def/" + Fichero + ".mas";
      |CARGA_DEF Comodin1,agif041@;
      |SI FSalida ! 0;
         |MENAV "    Problemas al cargar el def de empresas de gestion";
         |ACABA;
      |FINSI;

      Comodin1 = Comodin + "def/agifa325.mas";
      |CARGA_DEF Comodin1,agif325@;
      |SI FSalida ! 0;
         |MENAV "    Problemas al cargar el def de actualizacion de divisas de gestion";
         |DESCARGA_DEF #agif041@;
         |ACABA;
      |FINSI;

      Fichero = "Divisas"; Tipo = "G"; Cmp = ""; |HAZ ObtenFich;
      Comodin1 = Comodin + "def/" + Fichero + ".mas";
      |CARGA_DEF Comodin1,agif324@;
      |SI FSalida ! 0;
         |MENAV "    Problemas al cargar el def de divisas de gestion";
         |DESCARGA_DEF #agif041@; |DESCARGA_DEF #agif325@;
         |ACABA;
      |FINSI;
      ||Comodin1 = Comodin + "def/agifa321.mas";
      Fichero = "Parametros Divisas"; Tipo = "G"; Cmp = ""; |HAZ ObtenFich;
      Comodin1 = Comodin + "def/" + Fichero + ".mas";
      |CARGA_DEF Comodin1,agif321@;
      |SI FSalida ! 0;
         |MENAV "    Problemas al cargar el def de parametros de divisas de gestion";
         |DESCARGA_DEF #agif041@; |DESCARGA_DEF #agif325@;
         |DESCARGA_DEF #agif324@;
         |ACABA;
      |FINSI;
      ||Comodin1 = Comodin + "def/agifa024.mas";
      Fichero = "Clientes"; Tipo = "G"; Cmp = ""; |HAZ ObtenFich;
      Comodin1 = Comodin + "def/" + Fichero + ".mas";
      |CARGA_DEF Comodin1,agif024@;
      |SI FSalida ! 0;
         |MENAV "    Problemas al cargar el def de clientes de gestion";
         |DESCARGA_DEF #agif041@; |DESCARGA_DEF #agif325@;
         |DESCARGA_DEF #agif324@; |DESCARGA_DEF #agif321@;
         |ACABA;
      |FINSI;
      ||Comodin1 = Comodin + "def/agifa112.mas";
      Fichero = "Proveedores"; Tipo = "G"; Cmp = ""; |HAZ ObtenFich;
      Comodin1 = Comodin + "def/" + Fichero + ".mas";
      |CARGA_DEF Comodin1,agif112@;
      |SI FSalida ! 0;
         |MENAV "    Problemas al cargar el def de proveedores de gestion";
         |DESCARGA_DEF #agif041@; |DESCARGA_DEF #agif325@;
         |DESCARGA_DEF #agif324@; |DESCARGA_DEF #agif321@;
         |DESCARGA_DEF #agif024@;
         |ACABA;
      |FINSI;

      Comodin1 = ("00000" + #490#15) % -105;
      Comodin = Comodin + "fich/";
      |PATH_DAT #487 Comodin;
      Comodin = Comodin + Comodin1 + "/";
      |PATH_DAT #496 Comodin;
      |PATH_DAT #495 Comodin;
      |PATH_DAT #493 Comodin;
      |PATH_DAT #488 Comodin;
      |PATH_DAT #483 Comodin;
      |ABRE #agif041@;
      |ABRE #agif325@; |SELECT #2#agif325@;
      |ABRE #agif324@;
      |ABRE #agif321@;
      |ABRE #agif024@;
      |ABRE #agif112@;
      HayGestion = 1;

      |LEE 000#agif321@.p;
      Fichero = "Parametros Divisas"; Cmp = "Moneda Base"; Tipo = "G";
      |HAZ ObtenDato;
      Comodin = #agif321@#CmpNum#;

      Fichero = "Divisas"; Tipo = "G"; Cmp = "Codigo Divisa"; |HAZ ObtenDato;
      #agif324@#CmpNum# = Comodin;
      |LEE 000#agif324@.=;
      |SI FSalida ! 0; |DDEFECTO #agif324@; |FINSI;
      Fichero = "Divisas"; Tipo = "G"; Cmp = "Num.Decimales"; |HAZ ObtenDato;
      nDeci_Div   = #agif324@#CmpNum#;
      nDeci_Base  = #agif324@#CmpNum#;
      nDeci_BaseMx= #agif324@#CmpNum#;
      nDeci_males = #agif324@#CmpNum#;
      Cmp = "Valor Venta"; |HAZ ObtenDato;
      CambioDivVn = #agif324@#CmpNum#;
      Cmp = "Valor Compra"; |HAZ ObtenDato;
      CambioDivCm = #agif324@#CmpNum#;
      Cmp = "Nombre Divisa"; |HAZ ObtenDato;
      NombreDiv   = #agif324@#CmpNum#;

      Comodin = #490#16; |QBF Comodin;
      |SI Comodin ! "";
         Comodin1 = Comodin + "def/canempre.mas";
         |CARGA_DEF Comodin1,canempr@;
         |SI FSalida ! 0;
            |MENAV "    Problemas al cargar el def de empresas de contabilidad";
            |DESCARGA_DEF #agif112@; |DESCARGA_DEF #agif024@;
            |DESCARGA_DEF #agif321@; |DESCARGA_DEF #agif324@;
            |DESCARGA_DEF #agif325@; |DESCARGA_DEF #agif041@;
            |ACABA;
         |FINSI;

         Comodin1 = Comodin + "def/cacuenta.mas";
         |CARGA_DEF Comodin1,cacuent@;
         |SI FSalida ! 0;
            |MENAV "    Problemas al cargar el def de plan de cuentas de contabilidad";
            |DESCARGA_DEF #canempr@;
            |DESCARGA_DEF #agif112@; |DESCARGA_DEF #agif024@;
            |DESCARGA_DEF #agif321@; |DESCARGA_DEF #agif324@;
            |DESCARGA_DEF #agif325@; |DESCARGA_DEF #agif041@;
            |ACABA;
         |FINSI;

         Fichero = "Moneda Empresas"; Tipo = "C"; Cmp = ""; |HAZ ObtenFich;
         Comodin1 = Comodin + "def/" + Fichero + ".mas";
         |CARGA_DEF Comodin1,camoned@;
         |SI FSalida ! 0;
            |MENAV "    Problemas al cargar el def de monedas de empresa de contabilidad";
            |DESCARGA_DEF #cacuent@; |DESCARGA_DEF #canempr@;
            |DESCARGA_DEF #agif112@; |DESCARGA_DEF #agif024@;
            |DESCARGA_DEF #agif321@; |DESCARGA_DEF #agif324@;
            |DESCARGA_DEF #agif325@; |DESCARGA_DEF #agif041@;
            |ACABA;
         |FINSI;

         Fichero = "Clientes/Proveedores "; Tipo = "C"; Cmp = ""; |HAZ ObtenFich;
         Comodin1 = Comodin + "def/" + Fichero + ".mas";
         |CARGA_DEF Comodin1,caclipr@;
         |SI FSalida ! 0;
            |MENAV "    Problemas al cargar el def de clientes/proveedores de contabilidad";
            |DESCARGA_DEF #camoned@;
            |DESCARGA_DEF #cacuent@; |DESCARGA_DEF #canempr@;
            |DESCARGA_DEF #agif112@; |DESCARGA_DEF #agif024@;
            |DESCARGA_DEF #agif321@; |DESCARGA_DEF #agif324@;
            |DESCARGA_DEF #agif325@; |DESCARGA_DEF #agif041@;
            |ACABA;
         |FINSI;

         Comodin1 = (("00000" + #490#14) % -105) + #490#19;
         Comodin1 = Comodin + "fich/" + Comodin1 + "/";
         |PATH_DAT #492 Comodin1; |PATH_DAT #486 Comodin1; |PATH_DAT #484 Comodin1;
         Comodin1 = Comodin + "fich/";
         |PATH_DAT #494 Comodin1;
         |ABRE #cacuent@;
         |ABRE #canempr@;
         |ABRE #camoned@;
         |ABRE #caclipr@;
         Fichero = "Empresas"; Tipo = "C"; Cmp = "Codigo Empresa"; |HAZ ObtenDato;
         #canempr@#CmpNum# = #490#14;
         Fichero = "Empresas"; Tipo = "C"; Cmp = "Periodo"; |HAZ ObtenDato;
         #canempr@#CmpNum# = #490#19;
         |LEE 000#canempr@.=;
         |PARA Cont = 14; |SI Cont [ 19; |HACIENDO Cont = Cont + 1;
            Fichero = "Empresas"; Tipo = "C";
            |SI Cont = 14; Cmp = "Digitos Nivel 1"; Niv1 = #canempr@#Cont#; |FINSI;
            |SI Cont = 15; Cmp = "Digitos Nivel 2"; Niv2 = #canempr@#Cont#; |FINSI;
            |SI Cont = 16; Cmp = "Digitos Nivel 3"; Niv3 = #canempr@#Cont#; |FINSI;
            |SI Cont = 17; Cmp = "Digitos Nivel 4"; Niv4 = #canempr@#Cont#; |FINSI;
            |SI Cont = 18; Cmp = "Digitos Nivel 5"; Niv5 = #canempr@#Cont#; |FINSI;
            |SI Cont = 19; Cmp = "Digitos Nivel 6"; Niv6 = #canempr@#Cont#; |FINSI;
            |HAZ ObtenDato;
            |SI #canempr@#CmpNum# > MaxDigit;
               MaxDigit = #canempr@#CmpNum#;
               UltNivel = Cont - 13;
            |FINSI;
         |SIGUE;
         HayConta = 1;
      |SINO;
         HayConta = 0;
      |FINSI;
   |FINSI;

   |SI nDeci_Base = 0;
        |HAZ CargaNDeci;
   |FINSI;
|FPRC;

|PROCESO Tipo9; |TIPO 9;
   |SI HayConta = 1;
      |CIERRA #caclipr@; |DESCARGA_DEF #caclipr@;
      |CIERRA #camoned@; |DESCARGA_DEF #camoned@;
      |CIERRA #cacuent@; |DESCARGA_DEF #cacuent@;
      |CIERRA #canempr@; |DESCARGA_DEF #canempr@;
   |FINSI;

   |SI HayGestion = 1;
      |CIERRA #agif112@; |DESCARGA_DEF #agif112@;
      |CIERRA #agif024@; |DESCARGA_DEF #agif024@;
      |CIERRA #agif321@; |DESCARGA_DEF #agif321@;
      |CIERRA #agif324@; |DESCARGA_DEF #agif324@;
      |CIERRA #agif325@; |DESCARGA_DEF #agif325@;
      |CIERRA #agif041@; |DESCARGA_DEF #agif041@;
   |FINSI;

   |SI enBotonUsuarios ! 0;
      |FIN_CONTROL_WINDOWS enBotonUsuarios;
      enBotonUsuarios = 0;
   |FINSI;
|FPRC;

|PROCESO Tipo13; ||TIPO 13;
   || Comodin = #Fichero@#CmpDivisa#;

   |SI HayGestion = 1;
      Fichero = "Divisas"; Tipo = "G"; Cmp = "Codigo Divisa"; |HAZ ObtenDato;
      #agif324@#CmpNum# = Divisa;
      |LEE 000#agif324@.=;
      |SI FSalida ! 0; |DDEFECTO #agif324@; |FINSI;
      Fichero = "Divisas"; Tipo = "G"; Cmp = "Num.Decimales"; |HAZ ObtenDato;
      nDeci_Div   = #agif324@#CmpNum#;
      nDeci_males = #agif324@#CmpNum#;
      Cmp = "Valor Venta"; |HAZ ObtenDato;
      CambioDivVn = #agif324@#CmpNum#;
      Cmp = "Valor Compra"; |HAZ ObtenDato;
      CambioDivCm = #agif324@#CmpNum#;
      Cmp = "Nombre Divisa"; |HAZ ObtenDato;
      NombreDiv   = #agif324@#CmpNum#;
   |SINO;
      |SI Divisa = "EUR";
         nDeci_Div   = 2;
         nDeci_males = 2;
         CambioDivVn = 1;
         CambioDivCm = 1;
         NombreDiv   = "EURO";
      |FINSI;
   |FINSI;

|FPRC;

|PROCESO TomaDecim;
   |SI HayGestion = 1;
      |LEE 000#agif321@.p;
      Fichero = "Parametros Divisas"; Cmp = "Moneda Base"; Tipo = "G";
      |HAZ ObtenDato;
      Comodin = #agif321@#CmpNum#; eaMBase = Comodin;

      Fichero = "Divisas"; Cmp = "Codigo Divisa"; Tipo = "G"; |HAZ ObtenDato;
      #agif324@#CmpNum# = Comodin;
      |LEE 000#agif324@.=;
      |SI FSalida = 0;
         Fichero = "Divisas"; Cmp = "Nombre Divisa"; Tipo = "G"; |HAZ ObtenDato;
         eaNombreMBase = #agif324@#CmpNum#;
         Fichero = "Divisas"; Cmp = "Num.Decimales"; Tipo = "G"; |HAZ ObtenDato;
         nDeci_Base = #agif324@#CmpNum#;
         Fichero = "Divisas"; Cmp = "Valor Venta"; Tipo = "G"; |HAZ ObtenDato;
         CambioBaseVn = #agif324@#CmpNum#;
         Fichero = "Divisas"; Cmp = "Valor Compra"; Tipo = "G"; |HAZ ObtenDato;
         CambioBaseCm = #agif324@#CmpNum#;
      |FINSI;

      |QBF Divisa;
      |SI Divisa ! "";
          Fichero = "Divisas"; Cmp = "Codigo Divisa"; Tipo = "G"; |HAZ ObtenDato;
          #agif324@#CmpNum# = Divisa;
          |LEE 000#agif324@.=;
          |SI FSalida = 0;
             Fichero = "Divisas"; Cmp = "Valor Venta";
             Tipo = "G"; |HAZ ObtenDato;
             CambioDivVn = CambioBaseVn * #agif324@#CmpNum#;
             Fichero = "Divisas"; Cmp = "Valor Compra";
             Tipo = "G"; |HAZ ObtenDato;
             CambioDivCm = CambioBaseCm * #agif324@#CmpNum#;
             Fichero = "Divisas"; Cmp = "Num.Decimales";
             Tipo = "G"; |HAZ ObtenDato;
             nDeci_Div   = #agif324@#CmpNum#;
             nDeci_males = #agif324@#CmpNum#;
             Fichero = "Divisas"; Cmp = "Nombre Divisa";
             Tipo = "G"; |HAZ ObtenDato;
             NombreDiv   = #agif324@#CmpNum#;

             |SI efFechaDiv ! "00.00.0000"; |Y efFechaDiv ! "01.01.0000";
                #agif325@#1 = Divisa;
                #agif325@#4 = efFechaDiv;
                #agif325@#0 = 1;
                |LEE 000#agif325@.];
                |SI FSalida = 0;
                   |SI #agif325@#1 = Divisa; |Y #agif325@#4 = efFechaDiv;
                      CambioDivVn = #agif325@#2; CambioDivCm = #agif325@#3;
                   |SINO;
                      |LEE 000#agif325@.a;
                      |SI FSalida = 0;
                         |SI #agif325@#1 = Divisa; |Y #agif325@#4 [ efFechaDiv;
                            CambioDivVn = #agif325@#2; CambioDivCm = #agif325@#3;
                         |FINSI;
                      |FINSI;
                   |FINSI;
                |SINO;
                   |LEE 000#agif325@.u;
                   |SI FSalida = 0;
                      |SI #agif325@#1 = Divisa; |Y #agif325@#4 [ efFechaDiv;
                         CambioDivVn = #agif325@#2; CambioDivCm = #agif325@#3;
                      |FINSI;
                   |FINSI;
                |FINSI;
                efFechaDiv = "00.00.0000";
             |FINSI;
          |SINO;
             NombreDiv   = "ERROR";
             CambioDivVn = 1; CambioDivCm = 1;
             nDeci_males = 0;
             nDeci_Div = 0;
          |FINSI;
      |FINSI;
   |SINO;
      |SI HayConta = 1;
         Comodin = "|NC"; Calc = #canempr@#Comodin#;
         |SI Calc > 27;
            |SI #canempr@#28 = "P";
               nDeci_Base = 0;
               CambioBaseVn = 1 / 166.386; CambioBaseCm = 1 / 166.386;
               Divisa = "ESP";
               NombreDiv = "PESETA";
            |SINO;
               nDeci_Base = 2;
               CambioBaseVn = 1; CambioBaseCm = 1;
               Divisa = "EUR";
               NombreDiv = "EURO";
            |FINSI;
         |SINO;
            Fichero = "Moneda Empresas"; Tipo = "C"; Cmp = "Codigo Empresa"; |HAZ ObtenDato;
            #camoned@#CmpNum# = #490#14;
            Fichero = "Moneda Empresas"; Tipo = "C"; Cmp = "Periodo";        |HAZ ObtenDato;
            #camoned@#CmpNum# = #490#19;
            |LEE 000#camoned@.=;
            |SI FSalida = 0;
               Fichero = "Moneda Empresas"; Tipo = "C"; Cmp = "Moneda";      |HAZ ObtenDato;
               MonedaConta = #camoned@#CmpNum#;
               |SI MonedaConta = "P";
                  nDeci_Base = 0;
                  CambioBaseVn = 1 / 166.386; CambioBaseCm = 1 / 166.386;
                  Divisa = "ESP";
                  NombreDiv = "PESETA";
               |SINO;
                  nDeci_Base = 2;
                  CambioBaseVn = 1; CambioBaseCm = 1;
                  Divisa = "EUR";
                  NombreDiv = "EURO";
               |FINSI;
            |FINSI;
         |FINSI;
         |QBF Divisa;
         |SI Divisa ! "";
            |SI Divisa = "EUR";
               nDeci_males = 2;
               nDeci_Div = 2;
               CambioDivVn = CambioBaseVn / 166.386;
               CambioDivCm = CambioBaseCm / 166.386;
               NombreDiv = "EURO";
            |SINO;
               nDeci_Div = 0;
               nDeci_males = 0;
               CambioDivVn = 1; CambioDivCm = 1;
               NombreDiv = "PESETA";
            |FINSI;
         |FINSI;
         eaMBase = Divisa;
         eaNombreMBase = NombreDiv;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO ExisteCliente;
   Tecla = FSalida;
   |SI TipoCliente = "G";
      |SI DCampoG > Campo; |O Campo > HCampoG; |ACABA; |FINSI;
      |SI HayGestion = 1;
         Fichero = "Clientes"; Cmp = "Codigo Cliente";
         Tipo = "G"; |HAZ ObtenDato;
         #agif024@#CmpNum# = CodCliente;
         |SI Tecla = 10;
            |LEE 000#agif024@.];
            |CONSULTA_CLAVE #1#493;
            |SI FSalida < 0;
               TipoCliente = "ERROR"; |ACABA;
            |SINO;
               Fichero = "Clientes"; Cmp = "Codigo Cliente";
               Tipo = "G"; |HAZ ObtenDato;
               CodCliente = #agif024@#CmpNum#;
               Fichero = "Clientes"; Cmp = "Nombre Cliente";
               Tipo = "G"; |HAZ ObtenDato;
               Nombre    = #agif024@#CmpNum#;
               Fichero = "Clientes"; Cmp = "Direccion Envio";
               Tipo = "G"; |HAZ ObtenDato;
               Direccion = #agif024@#CmpNum#;
               Fichero = "Clientes"; Cmp = "Codigo Postal 1";
               Tipo = "G"; |HAZ ObtenDato;
               CP1       = #agif024@#CmpNum#;
               Fichero = "Clientes"; Cmp = "Codigo Postal 2";
               Tipo = "G"; |HAZ ObtenDato;
               CP2       = #agif024@#CmpNum#;
               Fichero = "Clientes"; Cmp = "Poblacion Envio";
               Tipo = "G"; |HAZ ObtenDato;
               Poblacion = #agif024@#CmpNum#;
               Fichero = "Clientes"; Cmp = "Provincia Envio";
               Tipo = "G"; |HAZ ObtenDato;
               Provincia = #agif024@#CmpNum#;
               Fichero = "Clientes"; Cmp = "Direccion Factura";
               Tipo = "G"; |HAZ ObtenDato;
               DirFactura = #agif024@#CmpNum#;
               Fichero = "Clientes"; Cmp = "C.Postal 1 Factura";
               Tipo = "G"; |HAZ ObtenDato;
               CPF1       = #agif024@#CmpNum#;
               Fichero = "Clientes"; Cmp = "C.Postal 2 Factura";
               Tipo = "G"; |HAZ ObtenDato;
               CPF2       = #agif024@#CmpNum#;
               Fichero = "Clientes"; Cmp = "Poblacion Factura";
               Tipo = "G"; |HAZ ObtenDato;
               PobFactura = #agif024@#CmpNum#;
               Fichero = "Clientes"; Cmp = "Provincia Factura";
               Tipo = "G"; |HAZ ObtenDato;
               ProFactura = #agif024@#CmpNum#;
               Fichero = "Clientes"; Cmp = "Nif/Cif";
               Tipo = "G"; |HAZ ObtenDato;
               DNI       = #agif024@#CmpNum#;
               Fichero = "Clientes"; Cmp = "Telefono";
               Tipo = "G"; |HAZ ObtenDato;
               Telefono  = #agif024@#CmpNum#;  || Telefono Cliente
               Fichero = "Clientes"; Cmp = "Fax";
               Tipo = "G"; |HAZ ObtenDato;
               Fax       = #agif024@#CmpNum#;  || Fax Cliente

               Fichero = "Clientes"; Tipo = "G"; Cmp = "Codigo Pais";
               |HAZ ObtenDato; eaCodPais   = #agif024@#CmpNum#;
               aAlfa = "|NC"; aAlfa = #agif024@#aAlfa#; nCalc = aAlfa;

               eaCPExt = "";
               eaCodIBAN  = "";
               eaCodBIC   = "";
               eaFechaMand = "01.01.0000";
               |SI nCalc > 215
                  eaCPExt   =  #agif024@#211;
                  eaCodIBAN   = #agif024@#215;
                  eaCodBIC    = #agif024@#216;
                  eaFechaMand = #agif024@#217;
               |FINSI;
            |FINSI;
            Fichero = "Clientes"; Cmp = "Codigo Cliente"; Tipo = "G"; |HAZ ObtenDato;
         |FINSI;
         |LEE 000#agif024@.=;
         |SI FSalida ! 0; |O #agif024@#CmpNum# = "      ";
            |SI CodCliente ! "      ";
               |SI enExistOblig = 0;
                  |MENAV "    Cliente inexistente";
                  TipoCliente = "ERROR";
               |FINSI;
            |FINSI;
         |SINO;
            Fichero = "Clientes"; Cmp = "Codigo Cliente";
            Tipo = "G"; |HAZ ObtenDato;
            CodCliente = #agif024@#CmpNum#;
            Fichero = "Clientes"; Cmp = "Nombre Cliente";
            Tipo = "G"; |HAZ ObtenDato;
            Nombre    = #agif024@#CmpNum#;
            Fichero = "Clientes"; Cmp = "Direccion Envio";
            Tipo = "G"; |HAZ ObtenDato;
            Direccion = #agif024@#CmpNum#;
            Fichero = "Clientes"; Cmp = "Codigo Postal 1";
            Tipo = "G"; |HAZ ObtenDato;
            CP1       = #agif024@#CmpNum#;
            Fichero = "Clientes"; Cmp = "Codigo Postal 2";
            Tipo = "G"; |HAZ ObtenDato;
            CP2       = #agif024@#CmpNum#;
            Fichero = "Clientes"; Cmp = "Poblacion Envio";
            Tipo = "G"; |HAZ ObtenDato;
            Poblacion = #agif024@#CmpNum#;
            Fichero = "Clientes"; Cmp = "Provincia Envio";
            Tipo = "G"; |HAZ ObtenDato;
            Provincia = #agif024@#CmpNum#;
            Fichero = "Clientes"; Cmp = "Direccion Factura";
            Tipo = "G"; |HAZ ObtenDato;
            DirFactura = #agif024@#CmpNum#;
            Fichero = "Clientes"; Cmp = "C.Postal 1 Factura";
            Tipo = "G"; |HAZ ObtenDato;
            CPF1       = #agif024@#CmpNum#;
            Fichero = "Clientes"; Cmp = "C.Postal 2 Factura";
            Tipo = "G"; |HAZ ObtenDato;
            CPF2       = #agif024@#CmpNum#;
            Fichero = "Clientes"; Cmp = "Poblacion Factura";
            Tipo = "G"; |HAZ ObtenDato;
            PobFactura = #agif024@#CmpNum#;
            Fichero = "Clientes"; Cmp = "Provincia Factura";
            Tipo = "G"; |HAZ ObtenDato;
            ProFactura = #agif024@#CmpNum#;
            Fichero = "Clientes"; Cmp = "Nif/Cif";
            Tipo = "G"; |HAZ ObtenDato;
            DNI       = #agif024@#CmpNum#;
            Fichero = "Clientes"; Cmp = "Telefono";
            Tipo = "G"; |HAZ ObtenDato;
            Telefono  = #agif024@#CmpNum#;  || Telefono Cliente
            Fichero = "Clientes"; Cmp = "Fax";
            Tipo = "G"; |HAZ ObtenDato;
            Fax       = #agif024@#CmpNum#;  || Fax Cliente
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Codigo Pais";
            |HAZ ObtenDato; eaCodPais   = #agif024@#CmpNum#;
            aAlfa = "|NC"; aAlfa = #agif024@#aAlfa#; nCalc = aAlfa;

            eaCPExt = "";
            eaCodIBAN  = "";
            eaCodBIC   = "";
            eaFechaMand = "01.01.0000";
            |SI nCalc > 215
                eaCPExt   =  #agif024@#211;
                eaCodIBAN   = #agif024@#215;
                eaCodBIC    = #agif024@#216;
                eaFechaMand = #agif024@#217;
            |FINSI;
         |FINSI;
      |FINSI;
   |SINO;
      |SI DCampoC > Campo; |O Campo > HCampoC; |ACABA; |FINSI;
      |SI HayConta = 1;
         aAlfa1 = CodCliente - ".";
         |SI FSalida ! 0;
            |PARA; |SI FSalida ! 0; |HACIENDO;
               nCalc  = ((FSalida / 100) ! 0) + 99;
               nCalc1 = FSalida + 98;
               aAlfa2 = (aAlfa1 % nCalc) + (aAlfa1 % nCalc1); |QBF aAlfa2;
               aAlfa2 = aAlfa2 % 0;
               nCalc2 = aAlfa2; nCalc2 = MaxDigit - nCalc2;
               aAlfa1 = (aAlfa1 % nCalc) + ("0" * nCalc2) + (aAlfa1 % nCalc1);

               aAlfa1 = aAlfa1 - ".";
            |SIGUE;
            CodCliente = aAlfa1;
         |FINSI;
         aCuenta = CodCliente;
         |HAZ SacaNivel;
         |SI nNivel = 0;
             |MENAV "0000Error Cuenta Fuera de Nivel";
             TipoCliente = "ERROR";
             |ACABA;
         |FINSI;
         Fichero = "Clientes/Proveedores"; Cmp = "Cliente/Proveedor"; Tipo = "C"; |HAZ ObtenDato;
         #caclipr@#CmpNum# = "C";
         Fichero = "Clientes/Proveedores"; Cmp = "Cuenta Contable"; Tipo = "C"; |HAZ ObtenDato;
         #caclipr@#CmpNum# = CodCliente;
         Fichero = "Clientes/Proveedores"; Cmp = "Digito Contable"; Tipo = "C"; |HAZ ObtenDato;
         #caclipr@#CmpNum# = UltNivel;
         |SI Tecla = 10;
            |ET VuelveC;
            aFiltro = "C";
            |LEE 000#caclipr@.];
            |CONSULTA_F_CLAVE #1#484, Inf484, Sup484;
            |SI FSalida < 0;
               TipoCliente = "ERROR"; |ACABA;
            |SINO;
               Fichero = "Clientes/Proveedores"; Cmp = "Cliente/Proveedor"; Tipo = "C"; |HAZ ObtenDato;
               |SI #caclipr@#CmpNum# = "P"; |VETE VuelveC; |FINSI;
               Fichero = "Clientes/Proveedores"; Cmp = "Cuenta Contable"; Tipo = "C"; |HAZ ObtenDato;
               CodCliente = #caclipr@#CmpNum#;
               Fichero = "Clientes/Proveedores"; Cmp = "Digito Contable"; Tipo = "C"; |HAZ ObtenDato;
               NumDigito = #caclipr@#CmpNum#;
            |FINSI;
         |FINSI;
         |LEE 000#caclipr@.=;
         |SI FSalida ! 0;
            |SI CodCliente ! "            ";
               |SI enExistOblig = 0;
                  enNoAltaCli = 0;
                  |SI enAltaCta = 0;
                      |MENAV "    Cuenta de cliente inexistente en ficha de clientes/proveedores";
                      TipoCliente = "ERROR";
                  |SINO;
                      |HAZ AltaCtaCartera;
                      |LEE 000#caclipr@.=;
                      |SI FSalida ! 0; |Y enNoAltaCli = 1;
                          |MENAV "    Cuenta de cliente inexistente en ficha de clientes/proveedores";
                          TipoCliente = "ERROR";
                      |FINSI;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            Fichero = "Clientes/Proveedores"; Cmp = "Razon Social"; Tipo = "C"; |HAZ ObtenDato;
            Nombre = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Cmp = "Direccion";
            Tipo = "C"; |HAZ ObtenDato;
            Direccion = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Cmp = "Codigo Postal 1";
            Tipo = "C"; |HAZ ObtenDato;
            CP1       = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Cmp = "Codigo Postal 2";
            Tipo = "C"; |HAZ ObtenDato;
            CP2       = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Cmp = "Poblacion";
            Tipo = "C"; |HAZ ObtenDato;
            Poblacion = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Cmp = "Provincia";
            Tipo = "C"; |HAZ ObtenDato;
            Provincia = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Cmp = "Nif/Cif";
            Tipo = "C"; |HAZ ObtenDato;
            DNI       = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Cmp = "Telefono";
            Tipo = "C"; |HAZ ObtenDato;
            Telefono  = #caclipr@#CmpNum#;  || Telefono Cliente
            Fichero = "Clientes/Proveedores"; Cmp = "Fax";
            Tipo = "C"; |HAZ ObtenDato;
            Fax       = #caclipr@#CmpNum#;  || Fax Cliente
            Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Pais";
            |HAZ ObtenDato; eaPais      = #caclipr@#CmpNum#;
            eaCodPais = eaPais;
            aAlfa = "|NC"; aAlfa = #caclipr@#aAlfa#; nCalc = aAlfa;
            |SI nCalc > 37;
                eaCodBLZ   = #caclipr@#38;
                eaCodSwift = #caclipr@#39;
                eaCodIBAN  = #caclipr@#40;
                eaCodBIC   = #caclipr@#41;
            |SINO;
                eaCodBLZ   = "";
                eaCodSwift = "";
                eaCodIBAN  = "";
                eaCodBIC   = "";
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|RUTINA Inf484;
   #484#23 = aFiltro;
   #484#10 = "            ";
   #484#11 = 0;
|FRUT;

|RUTINA Sup484;
   #484#23 = aFiltro;
   #484#10 = "zzzzzzzzzzzz";
   #484#11 = 5;
|FRUT;

|PROCESO ExisteProveedor;
   Tecla = FSalida;
   |SI TipoProveedor = "G";
      |SI DCampoG > Campo; |O Campo > HCampoG; |ACABA; |FINSI;
      |SI HayGestion = 1;
         Fichero = "Proveedores"; Cmp = "Codigo Proveedor";
         Tipo = "G"; |HAZ ObtenDato;
         #agif112@#CmpNum# = CodProveedor;
         |SI Tecla = 10;
            |LEE 000#agif112@.];
            |CONSULTA_CLAVE #1#488;
            |SI FSalida < 0;
               TipoProveedor = "ERROR"; |ACABA;
            |SINO;
               Fichero = "Proveedores"; Cmp = "Codigo Proveedor";
               Tipo = "G"; |HAZ ObtenDato;
               CodProveedor = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Cmp = "Nombre Comercial";
               Tipo = "G"; |HAZ ObtenDato;
               Nombre    = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Cmp = "Direccion";
               Tipo = "G"; |HAZ ObtenDato;
               Direccion = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Cmp = "Codigo Postal 1";
               Tipo = "G"; |HAZ ObtenDato;
               CP1       = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Cmp = "Codigo Postal 2";
               Tipo = "G"; |HAZ ObtenDato;
               CP2       = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Cmp = "Poblacion";
               Tipo = "G"; |HAZ ObtenDato;
               Poblacion = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Cmp = "Provincia";
               Tipo = "G"; |HAZ ObtenDato;
               Provincia = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Cmp = "Nif/Cif";
               Tipo = "G"; |HAZ ObtenDato;
               DNI       = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Cmp = "Telefono";
               Tipo = "G"; |HAZ ObtenDato;
               Telefono  = #agif112@#CmpNum#;  || Telefono Cliente
               Fichero = "Proveedores"; Cmp = "Fax";
               Tipo = "G"; |HAZ ObtenDato;
               Fax       = #agif112@#CmpNum#;  || Fax Cliente
               Fichero = "Proveedores"; Tipo = "G"; Cmp = "Codigo Pais";
               |HAZ ObtenDato; eaCodPais = #agif112@#CmpNum#;
               aAlfa = "|NC"; aAlfa = #agif112@#aAlfa#; nCalc = aAlfa;
               |SI nCalc > 96
                   eaCPExt = #agif112@#108;
                   eaCodIBAN  = #agif112@#96;
                   eaCodBIC   = #agif112@#97;
               |SINO;
                  eaCPExt = "";
                  eaCodIBAN  = "";
                  eaCodBIC   = "";
               |FINSI;
            |FINSI;
            Fichero = "Proveedores"; Cmp = "Codigo Proveedor"; Tipo = "G"; |HAZ ObtenDato;
         |FINSI;
         |LEE 000#agif112@.=;
         |SI FSalida ! 0; |O #agif112@#CmpNum# = "      ";
            |SI CodProveedor ! "      ";
               |SI enExistOblig = 0;
                  |MENAV "    Proveedor inexistente";
                  TipoProveedor = "ERROR";
               |FINSI;
            |FINSI;
         |SINO;
            Fichero = "Proveedores"; Cmp = "Codigo Proveedor";
            Tipo = "G"; |HAZ ObtenDato;
            CodProveedor = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Cmp = "Nombre Comercial";
            Tipo = "G"; |HAZ ObtenDato;
            Nombre    = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Cmp = "Direccion";
            Tipo = "G"; |HAZ ObtenDato;
            Direccion = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Cmp = "Codigo Postal 1";
            Tipo = "G"; |HAZ ObtenDato;
            CP1       = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Cmp = "Codigo Postal 2";
            Tipo = "G"; |HAZ ObtenDato;
            CP2       = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Cmp = "Poblacion";
            Tipo = "G"; |HAZ ObtenDato;
            Poblacion = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Cmp = "Provincia";
            Tipo = "G"; |HAZ ObtenDato;
            Provincia = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Cmp = "Nif/Cif";
            Tipo = "G"; |HAZ ObtenDato;
            DNI       = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Cmp = "Telefono";
            Tipo = "G"; |HAZ ObtenDato;
            Telefono  = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Cmp = "Fax";
            Tipo = "G"; |HAZ ObtenDato;
            Fax       = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Tipo = "G"; Cmp = "Codigo Pais";
            |HAZ ObtenDato; eaCodPais = #agif112@#CmpNum#;
            aAlfa = "|NC"; aAlfa = #agif112@#aAlfa#; nCalc = aAlfa;
            |SI nCalc > 96
               eaCPExt = #agif112@#108;
               eaCodIBAN  = #agif112@#96;
               eaCodBIC   = #agif112@#97;
            |SINO;
               eaCPExt = "";
               eaCodIBAN  = "";
               eaCodBIC   = "";
            |FINSI;
         |FINSI;
      |FINSI;
   |SINO;
      |SI DCampoC > Campo; |O Campo > HCampoC; |ACABA; |FINSI;
      |SI HayConta = 1;
         aAlfa1 = CodProveedor - ".";
         |SI FSalida ! 0;
            |PARA; |SI FSalida ! 0; |HACIENDO;
               nCalc  = ((FSalida / 100) ! 0) + 99;
               nCalc1 = FSalida + 98;
               aAlfa2 = (aAlfa1 % nCalc) + (aAlfa1 % nCalc1); |QBF aAlfa2;
               aAlfa2 = aAlfa2 % 0;
               nCalc2 = aAlfa2; nCalc2 = MaxDigit - nCalc2;
               aAlfa1 = (aAlfa1 % nCalc) + ("0" * nCalc2) + (aAlfa1 % nCalc1);

               aAlfa1 = aAlfa1 - ".";
            |SIGUE;
            CodProveedor = aAlfa1;
         |FINSI;
         aCuenta = CodProveedor;
         |HAZ SacaNivel;
         |SI nNivel = 0;
             |MENAV "0000Error Cuenta Fuera de Nivel";
             TipoProveedor = "ERROR";
             |ACABA;
         |FINSI;

         Fichero = "Clientes/Proveedores"; Cmp = "Cliente/Proveedor"; Tipo = "C"; |HAZ ObtenDato;
         #caclipr@#CmpNum# = "P";
         Fichero = "Clientes/Proveedores"; Cmp = "Cuenta Contable"; Tipo = "C"; |HAZ ObtenDato;
         #caclipr@#CmpNum# = CodProveedor;
         Fichero = "Clientes/Proveedores"; Cmp = "Digito Contable"; Tipo = "C"; |HAZ ObtenDato;
         #caclipr@#CmpNum# = UltNivel;
         |SI Tecla = 10;
            |ET Vuelve;
            aFiltro = "P";
            |LEE 000#caclipr@.];
            |CONSULTA_F_CLAVE #1#484, Inf484, Sup484;
            |SI FSalida < 0;
               TipoProveedor = "ERROR"; |ACABA;
            |SINO;
               Fichero = "Clientes/Proveedores"; Cmp = "Cliente/Proveedor"; Tipo = "C"; |HAZ ObtenDato;
               |SI #caclipr@#CmpNum# = "C"; |VETE Vuelve; |FINSI;
               Fichero = "Clientes/Proveedores"; Cmp = "Cuenta Contable"; Tipo = "C"; |HAZ ObtenDato;
               CodProveedor = #caclipr@#CmpNum#;
               Fichero = "Clientes/Proveedores"; Cmp = "Digito Contable"; Tipo = "C"; |HAZ ObtenDato;
               NumDigito = #caclipr@#CmpNum#;
            |FINSI;
         |FINSI;
         |LEE 000#caclipr@.=;
         |SI FSalida ! 0;
            |SI CodProveedor ! "            ";
               |SI enExistOblig = 0;
                   enNoAltaCli = 0;
                   |SI enAltaCta = 0;
                       |MENAV "    Cuenta de proveedor inexistente en ficha de clientes/proveedores";
                       TipoProveedor = "ERROR";
                  |SINO;
                      |HAZ AltaCtaCartera;
                      |LEE 000#caclipr@.=;
                      |SI FSalida ! 0; |Y enNoAltaCli = 0;
                          |MENAV "    Cuenta de proveedor inexistente en ficha de clientes/proveedores";
                          TipoProveedor = "ERROR";
                      |FINSI;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            Fichero = "Clientes/Proveedores"; Cmp = "Razon Social"; Tipo = "C"; |HAZ ObtenDato;
            Nombre = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Pais";
            |HAZ ObtenDato; eaPais      = #caclipr@#CmpNum#;
            eaCodPais = eaPais;
            aAlfa = "|NC"; aAlfa = #caclipr@#aAlfa#; nCalc = aAlfa;
            |SI nCalc > 37;
                eaCodBLZ   = #caclipr@#38;
                eaCodSwift = #caclipr@#39;
                eaCodIBAN  = #caclipr@#40;
                eaCodBIC   = #caclipr@#41;
            |SINO;
                eaCodBLZ   = "";
                eaCodSwift = "";
                eaCodIBAN  = "";
                eaCodBIC   = "";
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO RiesgoFact;
   enRiesgoFact = enRiesgoFact + #dscam024#4;
|FPRC;

|DEFBUCLE RiesgoFact;
#dscam024#1;
;
#dscam023#0, 01;
#dscam023#0, 99;
;
NULL,RiesgoFact;
|FIN;

|PROCESO SacaRiesgo;
   |ABRE #dscam023;
   #dscam023#0 = eaCliGest;
   |LEE 000#dscam023.=;
   |SI FSalida = 0;
      enRiesgoUsado  = #dscam023#20;
      enRiesgoConced = #dscam023#19;
      enRiesgoFact   = 0; |BUCLE RiesgoFact;
   |SINO;
      enRiesgoUsado  = -1;
      enRiesgoConced = -1;
      enRiesgoFact   = -1;
   |FINSI;
   |CIERRA #dscam023;
|FPRC;

|PROCESO ConsultaVentas;
   |ABRE #dscam003;
   fFechaTr  = "01.01.0000";
   TipoCons = "V";
   |C_P #dsfantas#0,1,PosLibro;
   |C_P #dsfantas#1,1,PosSerie;
   |C_P #dsfantas#2,1,PosFactu;
   |C_P #dsfantas#3,1,PosRecib;
   #dsfantas#0 = #dscam003#27;
   #dsfantas#1 = #dscam003#0;
   #dsfantas#2 = #dscam003#1;
   #dsfantas#3 = #dscam003#2;
   |SI #dsfantas#3 = 0; #dsfantas#3 = 1; |FINSI;
   |PINDA #0#dsfantas;
   |ENDATOS #1#dsfantas;
   |SI FSalida = 0;
      |SELECT #6#dscam003;
      #dscam003#27 = #dsfantas#0;
      #dscam003#0  = #dsfantas#1;
      #dscam003#1  = #dsfantas#2;
      #dscam003#2  = #dsfantas#3;
      #dscam003#69 = " ";
      #dscam003#40 = 1;
      |LEE 000#dscam003.];
      |SI FSalida = 0;
         |PARA; |SI FSalida = 0; |Y #dscam003#27 = #dsfantas#0; |Y #dscam003#0  = #dsfantas#1;
          |Y #dscam003#1  = #dsfantas#2; |Y #dscam003#2  = #dsfantas#3; |Y #dscam003#69 = " ";
          |HACIENDO;
            |SI #dscam003#4 > fFechaTr;
               enDocum   = #dscam003#40;
               enLibro   = #dsfantas#0;
               eaSerie   = #dsfantas#1;
               enFactura = #dsfantas#2;
               enRecibo  = #dsfantas#3;
               fFechaTr = #dscam003#4;
            |FINSI;
            |LEE 000#dscam003.s;
         |SIGUE;
         |SI fFechaTr = "01.01.0000";
            enDocum = #dscam003#40;
            enFactura = -1;
         |FINSI;
      |SINO;
         enDocum = -1;
      |FINSI;
      |SELECT #1#dscam003;
   |FINSI;
   |CIERRA #dscam003;
|FPRC;

|PROCESO ConsultaCompras;
   |ABRE #dscam008;
   fFechaTr  = "01.01.0000";
   TipoCons = "C";
   |C_P #dsfantas#0,1,PosLibro;
   |C_P #dsfantas#1,1,PosSerie;
   |C_P #dsfantas#2,1,PosFactu;
   |C_P #dsfantas#3,1,PosRecib;
   |PINDA #0#dsfantas;
   |ENDATOS #1#dsfantas;
   |SI FSalida = 0;
      |PINTA #dsfantas#0; |PINTA #dsfantas#1; |PINTA #dsfantas#2;
      |SELECT #2#dscam008;
      #dscam008#27 = #dsfantas#0;
      #dscam008#0  = #dsfantas#1;
      #dscam008#1  = #dsfantas#2;
      #dscam008#2  = #dsfantas#3;
      |LEE 000#dscam008.=;
      |SI FSalida = 0;
         |PARA; |SI FSalida = 0; |Y #dscam008#27 = #dsfantas#0; |Y #dscam008#0  = #dsfantas#1;
          |Y #dscam008#1  = #dsfantas#2; |Y #dscam008#2  = #dsfantas#3;
          |HACIENDO;
             |SI #dscam008#4 > fFechaTr;
                enDocum = #dscam008#40;
                enLibro = #dsfantas#0;
                eaSerie = #dsfantas#1;
                enFactura = #dsfantas#2;
                enRecibo = #dsfantas#3;
                fFechaTr = #dscam008#4;
             |FINSI;
             |LEE 000#dscam008.s;
         |SIGUE;
      |SINO;
         enDocum = -1;
      |FINSI;
      |SELECT #1#dscam008;
   |FINSI;
   |CIERRA #dscam008;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
|FPRC;

/*
|PROCESO LimpiaClave;
   |PARA nCont = 0; |SI nCont < 20; |HACIENDO nCont = nCont + 1;
      ICmpClaveA = CmpClaveA1<-; ICmpClaveA = ICmpClaveA + nCont;
      ICmpClaveN = CmpClaveF1<-; ICmpClaveF = ICmpClaveF + nCont;
      ICmpClaveF = CmpClaveN1<-; ICmpClaveN = ICmpClaveN + nCont;
      CmpClaveN = -1;
      CmpClaveA = "";
      CmpClaveF = "01.01.0000";
   |SIGUE;
|FPRC;

|PROCESO LeeFichero;
   Comod = "|K000"; Comod = #FichRef@#Comod#;
   Comod1 = Comod % 0103; Calc = Comod1; Comod = Comod % 0499;
   |PARA nCont = 1; |SI nCont [ Calc; |HACIENDO nCont = nCont + 1;
      ICmpClaveA = CmpClaveA1<-; ICmpClaveA = ICmpClaveA + (nCont - 1);
      ICmpClaveN = CmpClaveN1<-; ICmpClaveN = ICmpClaveN + (nCont - 1);
      ICmpClaveF = CmpClaveF1<-; ICmpClaveF = ICmpClaveF + (nCont - 1);
      Comod1 = Comod % 0103; Calc1 = Comod1; Comod = Comod % 0499;
      Comod1 = "|C" + (("000" + Calc1)%-103) + "TIPO";
      Comod1 = #FichRef@#Comod1#;
      |SI Comod1 = "A"; #FichRef@#Calc1# = CmpClaveA; |FINSI;
      |SI Comod1 = "N"; #FichRef@#Calc1# = CmpClaveN; |FINSI;
      |SI Comod1 = "F"; #FichRef@#Calc1# = CmpClaveF; |FINSI;
   |SIGUE;
   |SI Bloq = 1;
      |SI ModoLee = "="; |LEE 101#FichRef@.=; |FINSI;
      |SI ModoLee = "p"; |LEE 101#FichRef@.p; |FINSI;
      |SI ModoLee = "u"; |LEE 101#FichRef@.u; |FINSI;
      |SI ModoLee = "a"; |LEE 101#FichRef@.a; |FINSI;
      |SI ModoLee = "s"; |LEE 101#FichRef@.s; |FINSI;
   |SINO;
      |SI ModoLee = "="; |LEE 000#FichRef@.=; |FINSI;
      |SI ModoLee = "p"; |LEE 000#FichRef@.p; |FINSI;
      |SI ModoLee = "u"; |LEE 000#FichRef@.u; |FINSI;
      |SI ModoLee = "a"; |LEE 000#FichRef@.a; |FINSI;
      |SI ModoLee = "s"; |LEE 000#FichRef@.s; |FINSI;
      |SI ModoLee = "]"; |LEE 000#FichRef@.]; |FINSI;
   |FINSI;
|FPRC;
*/

|PROCESO ObtenFich;
   |DBASE Comod; |QBF Comod; Comod = Comod + "fich/";
   |PATH_DAT #504 Comod; |PATH_DAT #505 Comod;
   |ABRE #dscam063;
   |SI FSalida ! 0;
      |MENAV "    Error al cargar el defecto de registros";
      |PTEC 807;
      |ACABA;
   |FINSI;
   |ABRE #dscam064;
   |SI FSalida ! 0;
      |MENAV "    Error al cargar el defecto de registros";
      |PTEC 807;
      |ACABA;
   |FINSI;
   Comod  = Fichero; |QBF Comod;
   |SI Fichero ! "";
      #dscam063#0 = Comod;
      #dscam063#2 = Tipo;
      |LEE 000#dscam063.=;
      |SI FSalida = 0;
         Fichero = #dscam063#1;
      |SINO;
         |SI Comod = "Empresas";     |Y Tipo = "G"; Fichero = "agifa041"; |FINSI;
         |SI Comod = "Clientes";     |Y Tipo = "G"; Fichero = "agifa024"; |FINSI;
         |SI Comod = "Proveedores";  |Y Tipo = "G"; Fichero = "agifa112"; |FINSI;
         |SI Comod = "Divisas";      |Y Tipo = "G"; Fichero = "agifa324"; |FINSI;
         |SI Comod = "Series";       |Y Tipo = "G"; Fichero = "agifa007"; |FINSI;
         |SI Comod = "Parametros Divisas"; |Y Tipo = "G"; Fichero = "agifa321"; |FINSI;
         |SI Comod = "Albaranes";    |Y Tipo = "G"; Fichero = "agifa010"; |FINSI;
         |SI Comod = "Pedidos";      |Y Tipo = "G"; Fichero = "agifa104"; |FINSI;
         |SI Comod = "Pedidos Lins.";|Y Tipo = "G"; Fichero = "agifa073"; |FINSI;

         |SI Comod = "Empresas";     |Y Tipo = "C"; Fichero = "canempre"; |FINSI;
         |SI Comod = "Plan Contable";|Y Tipo = "C"; Fichero = "cacuenta"; |FINSI;
         |SI Comod = "Clientes/Proveedores"; |Y Tipo = "C"; Fichero = "caclipro"; |FINSI;
         |SI Comod = "Conceptos Automaticos";|Y Tipo = "C"; Fichero = "caconcep"; |FINSI;
         |SI Comod = "Contador Asientos";|Y Tipo = "C"; Fichero = "caconasi"; |FINSI;
         |SI Comod = "Moneda Empresas";  |Y Tipo = "C"; Fichero = "camoneda"; |FINSI;
      |FINSI;
   |FINSI;
   |CIERRA #dscam063;
|FPRC;

|PROCESO ObtenDato;
   CmpNum = -1;
   |DBASE Comod; |QBF Comod; Comod = Comod + "fich/";
   |PATH_DAT #504 Comod; |PATH_DAT #505 Comod;
   |ABRE #dscam063; |ABRE #dscam064;
   Comod  = Fichero; |QBF Comod;
   Comod1 = Cmp;     |QBF Comod1;
   |SI Comod1 ! ""; |Y Comod ! "";
      |SI Comod = "Clientes"; |Y Comod1 = "Codigo Cliente";
         #dscam063#0 = Comod;
         #dscam063#2 = Tipo;
         |LEE 000#dscam063.=;
         |SI FSalida = 0;
            |SI #dscam063#3 = 1; |SELECT #1#agif024@; |FINSI;
            |SI #dscam063#3 = 2; |SELECT #2#agif024@; |FINSI;
            |SI #dscam063#3 = 3; |SELECT #3#agif024@; |FINSI;
            |SI #dscam063#3 = 4; |SELECT #4#agif024@; |FINSI;
            |SI #dscam063#3 = 5; |SELECT #5#agif024@; |FINSI;
            |SI #dscam063#3 = 6; |SELECT #6#agif024@; |FINSI;
            |SI #dscam063#3 = 7; |SELECT #7#agif024@; |FINSI;
            |SI #dscam063#3 = 8; |SELECT #8#agif024@; |FINSI;
            |SI #dscam063#3 = 9; |SELECT #9#agif024@; |FINSI;
         |FINSI;
      |FINSI;
      |SI Comod = "Proveedores"; |Y Comod1 = "Codigo Proveedor";
         #dscam063#0 = Comod;
         #dscam063#2 = Tipo;
         |LEE 000#dscam063.=;
         |SI FSalida = 0;
            |SI #dscam063#3 = 1; |SELECT #1#agif112@; |FINSI;
            |SI #dscam063#3 = 2; |SELECT #2#agif112@; |FINSI;
            |SI #dscam063#3 = 3; |SELECT #3#agif112@; |FINSI;
            |SI #dscam063#3 = 4; |SELECT #4#agif112@; |FINSI;
            |SI #dscam063#3 = 5; |SELECT #5#agif112@; |FINSI;
            |SI #dscam063#3 = 6; |SELECT #6#agif112@; |FINSI;
            |SI #dscam063#3 = 7; |SELECT #7#agif112@; |FINSI;
            |SI #dscam063#3 = 8; |SELECT #8#agif112@; |FINSI;
            |SI #dscam063#3 = 9; |SELECT #9#agif112@; |FINSI;
         |FINSI;
      |FINSI;
      #dscam064#0 = Comod;
      #dscam064#1 = Comod1;
      #dscam064#3 = Tipo;
      |LEE 000#dscam064.=;
      |SI FSalida = 0;
         CmpNum = #dscam064#2;
         || CmpNum = #FichRef@#Calc2#;
      |SINO;
         |SI Comod = "Empresas"; |Y Tipo = "C";
            |SI Comod1 = "Codigo Empresa"; CmpNum = 2; |FINSI;
            |SI Comod1 = "Periodo";        CmpNum = 3; |FINSI;
         |FINSI;
         |SI Comod = "Empresas"; |Y Tipo = "G";
            |SI Comod1 = "Codigo Empresa"; CmpNum = 0; |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
   |CIERRA #dscam064; |CIERRA #dscam063;
   |SI CmpNum = -1;
          aAlfa = "0000ERROR. No encuentro: [" + Tipo + "] [" + Comod + "] [" + Comod1 + "]";
          |MENAV aAlfa;
   |FINSI;
|FPRC;

|PROCESO ObtenInforme;
   |ABRE #dscam065;
   Comod  = aInforme; |QBF Comod;
   |SI Comod ! "";
      #dscam065#0 = Comod;
      |LEE 000#dscam065.=;
      |SI FSalida = 0;
         aInforme = #dscam065#1;
      |SINO;
         |SI eaInfDefecto = "";
               aAlfa = "    No se ha encontrado el informe de " + Comod;
               |MENAV aAlfa;
         |SINO;
               #dscam065#1 = eaInfDefecto;
               |GRABA 020#dscam065.n;
               aInforme = #dscam065#1;
         |FINSI;
      |FINSI;
   |FINSI;
   |CIERRA #dscam065;
|FPRC;

|PROCESO GrabaAudit;
   |ABRE #dscam070;
   |LEE 000#dscam070.u;
   |SI FSalida = 0;
      NumRef = #dscam070#0 + 1;
   |SINO;
      NumRef = 1;
   |FINSI;
   |DDEFECTO #dscam070;
   #dscam070#0 = NumRef;
   #dscam070#6 = eaNumero;
   #dscam070#5 = eaTipoReg;
   #dscam070#2 = ~;
   |GRABA 020#dscam070.b;
   #dscam070#1 = eaUsuario;
   |HORA aHora;
   #dscam070#3 = aHora;
   #dscam070#4 = eaDescr;
   #dscam070#7 = enImpAnt;
   #dscam070#8 = enImpAct;
   #dscam070#9 = eaTipoOp;
   #dscam070#10 = eaFicher;
   #dscam070#11 = eaClave;
   #dscam070#12 = PRMNT_enPerfil;
   #dscam070#13 = #dscam083#1;
   |GRABA 020#dscam070.a; |LIBERA #dscam070;
   |CIERRA #dscam070;
|FPRC;

|PROCESO BajaRem;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.c;
   |FINSI;
   |CIERRA #dscam051;
|FPRC;

|PROCESO ConsFanta;
   |SI FSalida = 10;
      |SI TipoCons = "V";
         #dscam003#1 = 1;
         |CONSULTA_CLAVE #6#dscam003;
         #dsfantas#0 = #dscam003#27; #dsfantas#1 = #dscam003#0;
         #dsfantas#2 = #dscam003#1;  #dsfantas#3 = #dscam003#2;
         |PINDA #0#dsfantas;
         |PINTA #dsfantas#0;  |PINTA #dsfantas#1;
         |PINTA #dsfantas#2;  |PINTA #dsfantas#3;
         |PINTA #dscam003#27; |PINTA #dscam003#0;
         |PINTA #dscam003#1;  |PINTA #dscam003#2;
         |ERROR;
      |FINSI;
      |SI TipoCons = "C";
         #dscam008#1 = 1; |LEE 000#dscam008.];
         |CONSULTA_CLAVE #2#dscam008;
         #dsfantas#0 = #dscam008#27; #dsfantas#1 = #dscam008#0;
         #dsfantas#2 = #dscam008#1;  #dsfantas#3 = #dscam008#2;
         |PINDA #0#dsfantas;
         |PINTA #dsfantas#0; |PINTA #dsfantas#1;
         |PINTA #dsfantas#2; |PINTA #dsfantas#3;
         |PINTA #dscam008#27; |PINTA #dscam008#0;
         |PINTA #dscam008#1;  |PINTA #dscam008#2;
         |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO CargaNDeci;
   |HAZ TomaDecim;
   nDeci_Base     = nDeci_Base;
   nDeci_PreBase  = nDeci_Base;
   nDeci_BaseMx   = nDeci_Base;
   nDeci_PreBaseMx= nDeci_Div;
   nDeci_DivF     = nDeci_Div;
   nDeci_PreDivF  = nDeci_Div;
   nDeci_TotVisF  = nDeci_Div;
   nDeci_TotNoVisF= nDeci_Div;
   nDeci_PreVisF  = nDeci_Div;
   nDeci_ImpVisF  = nDeci_Div;
   nDeci_IVAImp   = nDeci_Div;

   nDeci_Div      = nDeci_Div;
   nDeci_PreDiv   = nDeci_Div;
   nDeci_TotVis   = nDeci_Div;
   nDeci_TotNoVis = nDeci_Div;
   nDeci_PreVis   = nDeci_Div;
   nDeci_ImpVis   = nDeci_Div;

   nDeci_BaseMxP  = nDeci_Base;
   nDeci_PreBasMxP= nDeci_Base;
   nDeci_DivP     = nDeci_Div;
   nDeci_PreDivP  = nDeci_Div;
   nDeci_TotVisP  = nDeci_Div;
   nDeci_TotNoVisP = nDeci_Div;
   nDeci_PreVisP  = nDeci_Div;
   nDeci_ImpVisP  = nDeci_Div;
|FPRC;


|PROCESO SacaNivel;
   |SI HayConta = 0; nNivel = -1; |ACABA; |FINSI;
   |QBF aCuenta
   aLong = aCuenta % 0; nLong = aLong;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 1"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; nNivel = 1; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 2"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; nNivel = 2; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 3"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; nNivel = 3; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 4"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; nNivel = 4; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 5"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; nNivel = 5; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 6"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; nNivel = 6; |FINSI;
|FPRC;

|PROCESO BuscaEmpresa;
  |SI eaTipoCod = "C";
     |DDEF aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscam003.mas";
  |SINO;
     |DDEF aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscam008.mas";
  |FINSI;
  |CARGA_DEF aAlfa, RefDocu@;
  |SI FSalida = 0;
     |DFICE aAlfa; |QBF aAlfa; |PATH_DAT #RefDocu@#aAlfa#;
     |ABRE #RefDocu@;
     #RefDocu@#40 = enDocumento;
     |LEE 000#RefDocu@.=;
     |SI FSalida = 0;
        aDir = ""; nEmp = 0;
        |SI HayGestion = 1; |Y eaCodigo ! "      ";
           |DFICB aAlfa; |QBF aAlfa;
           |PATH_DAT #dscam044#aAlfa#; |PATH_DAT #dscam045#aAlfa#;
           |ABRE #dscam044; |ABRE #dscam045;
           |SELECT #2#dscam045;
           #dscam045#6 = #48#0;
           |LEE 000#dscam045.];
           |PARA; |SI FSalida = 0; |Y #dscam045#6 = #48#0; |HACIENDO;
              |SI eaTipoCod = "C";
                 |SI #dscam045#2 = "V";
                    |SI #dscam045#4 [ #RefDocu@#0; |Y #dscam045#5 ] #RefDocu@#0; |SAL; |FINSI;
                 |FINSI;
              |SINO;
                 |SI #dscam045#2 = "C";
                    |SI #dscam045#4 [ #RefDocu@#0; |Y #dscam045#5 ] #RefDocu@#0; |SAL; |FINSI;
                 |FINSI;
              |FINSI;
              |LEE 000#dscam045.s;
           |SIGUE;
           aAlfa = "";
           |SI eaTipoCod = "C";
              |SI #dscam045#2 = "V"; |Y #dscam045#4 [ #RefDocu@#0; |Y #dscam045#5 ] #RefDocu@#0;
                 aAlfa = "S";
              |FINSI;
           |SINO;
              |SI #dscam045#2 = "C"; |Y #dscam045#4 [ #RefDocu@#0; |Y #dscam045#5 ] #RefDocu@#0;
                 aAlfa = "S";
              |FINSI;
           |FINSI;
           |SI aAlfa = "S";
              #dscam044#0 = #dscam045#0;
              |LEE 000#dscam044.=;
              |SI FSalida = 0;
                 aDir = #dscam044#1; |QBF aDir;
                 nEmp = #RefDocu@#46;
              |FINSI;
           |FINSI;
           |SELECT #1#dscam045;
           |CIERRA #dscam044; |CIERRA #dscam045;
        |FINSI;
        |SI aDir ! "";
            |CIERRA #RefDocu@; |DESCARGA_DEF #RefDocu@;
            |ACABA;
        |FINSI;

        |SI HayConta = 1; |Y aCuenta ! "            ";
           |DFICB aAlfa; |QBF aAlfa;
           |PATH_DAT #dscam042#aAlfa#; |PATH_DAT #dscam043#aAlfa#;
           |ABRE #dscam042; |ABRE #dscam043;
           |SELECT #2#dscam043;
           #dscam043#9 = #48#0;
           |LEE 000#dscam043.];
           |PARA; |SI FSalida = 0; |Y #dscam043#9 = #48#0; |HACIENDO;
              |SI eaTipoCod = "C";
                 |SI #dscam043#3 = "V";
                    |SI #dscam043#5 [ #RefDocu@#27; |Y #dscam043#6 ] #RefDocu@#27;
                     |Y #dscam043#7 [ #RefDocu@#0;  |Y #dscam043#8 ] #RefDocu@#0;
                       |SAL;
                    |FINSI;
                 |FINSI;
              |SINO;
                 |SI #dscam043#3 = "C";
                    |SI #dscam043#5 [ #RefDocu@#27; |Y #dscam043#6 ] #RefDocu@#27;
                     |Y #dscam043#7 [ #RefDocu@#0;  |Y #dscam043#8 ] #RefDocu@#0;
                       |SAL;
                    |FINSI;
                 |FINSI;
              |FINSI;
              |LEE 000#dscam043.s;
           |SIGUE;
           aAlfa = "";
           |SI eaTipoCod = "C";
              |SI #dscam043#3 = "V"; |Y #dscam043#5 [ #RefDocu@#27; |Y #dscam043#6 ] #RefDocu@#27;
               |Y #dscam043#7 [ #RefDocu@#0;  |Y #dscam043#8 ] #RefDocu@#0;
                 aAlfa = "S";
              |FINSI;
           |SINO;
              |SI #dscam043#3 = "C"; |Y #dscam043#5 [ #RefDocu@#27; |Y #dscam043#6 ] #RefDocu@#27;
               |Y #dscam043#7 [ #RefDocu@#0;  |Y #dscam043#8 ] #RefDocu@#0;
                 aAlfa = "S";
              |FINSI;
           |FINSI;
           |SI aAlfa = "S";
              #dscam042#0 = #dscam043#0;
              #dscam042#1 = #dscam043#1;
              |LEE 000#dscam042.=;
              |SI FSalida = 0;
                 aDir = #dscam042#2; |QBF aDir;
                 nEmp = #RefDocu@#44; nPer = #RefDocu@#45;
              |FINSI;
           |FINSI;
           |SELECT #1#dscam043;
           |CIERRA #dscam042; |CIERRA #dscam043;
        |FINSI;
        |CIERRA #RefDocu@; |DESCARGA_DEF #RefDocu@;
     |FINSI;
  |FINSI;
|FPRC;

|PROCESO LeeDatos;
   eaEmail = "";

   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0; |DDEFECTO #dscam051; |FINSI;
   |CIERRA #dscam051;

   |SI HayGestion = 1; |Y eaCodigo ! "      ";
      |SI eaTipoCod = "C";
         |SI enDocumento ! 0;
            |HAZ BuscaEmpresa;
            aAlfa = aDir + "fich/" + (("00000" + nEmp) % -105) + "/";
            |CIERRA #agif024@; |PATH_DAT #agif024@#aAlfa#; |ABRE #agif024@;
            enDocumento = 0;
         |FINSI;

         Fichero = "Clientes"; Tipo = "G"; Cmp = "Codigo Cliente"; |HAZ ObtenDato;
         #agif024@#CmpNum# = eaCodigo;
         |LEE 000#agif024@.=;
         |SI FSalida = 0; |Y #agif024@#CmpNum# ! "      ";
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Direccion Cobro";
            |HAZ ObtenDato; eaDirCobro = #agif024@#CmpNum#;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Poblacion Cobro";
            |HAZ ObtenDato; eaPobCobro = #agif024@#CmpNum#;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Provincia Cobro";
            |HAZ ObtenDato; eaProvCobro = #agif024@#CmpNum#;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "C.Postal 1 Cobro";
            |HAZ ObtenDato; eaCP1Cobro  = #agif024@#CmpNum#;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "C.Postal 2 Cobro";
            |HAZ ObtenDato; eaCP2Cobro  = #agif024@#CmpNum#;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Telefono Cobro";
            |HAZ ObtenDato; eaTlfCobro  = #agif024@#CmpNum#;

            |SI #dscam051#95 = "E";
               Fichero = "Clientes"; Tipo = "G"; Cmp = "Direccion Envio";
               |HAZ ObtenDato; eaDireccion = #agif024@#CmpNum#;
               Fichero = "Clientes"; Tipo = "G"; Cmp = "Poblacion Envio";
               |HAZ ObtenDato; eaPoblacion = #agif024@#CmpNum#;
               Fichero = "Clientes"; Tipo = "G"; Cmp = "Provincia Envio";
               |HAZ ObtenDato; eaProvincia = #agif024@#CmpNum#;
               Fichero = "Clientes"; Tipo = "G"; Cmp = "Codigo Postal 1";
               |HAZ ObtenDato; eaCP1       = #agif024@#CmpNum#;
               Fichero = "Clientes"; Tipo = "G"; Cmp = "Codigo Postal 2";
               |HAZ ObtenDato; eaCP2       = #agif024@#CmpNum#;
            |FINSI;
            |SI #dscam051#95 = "C";
               Fichero = "Clientes"; Tipo = "G"; Cmp = "Direccion Cobro";
               |HAZ ObtenDato; eaDireccion = #agif024@#CmpNum#;
               Fichero = "Clientes"; Tipo = "G"; Cmp = "Poblacion Cobro";
               |HAZ ObtenDato; eaPoblacion = #agif024@#CmpNum#;
               Fichero = "Clientes"; Tipo = "G"; Cmp = "Provincia Cobro";
               |HAZ ObtenDato; eaProvincia = #agif024@#CmpNum#;
               Fichero = "Clientes"; Tipo = "G"; Cmp = "C.Postal 1 Cobro";
               |HAZ ObtenDato; eaCP1       = #agif024@#CmpNum#;
               Fichero = "Clientes"; Tipo = "G"; Cmp = "C.Postal 2 Cobro";
               |HAZ ObtenDato; eaCP2       = #agif024@#CmpNum#;
            |FINSI;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Nif/Cif";
            |HAZ ObtenDato; eaNif       = #agif024@#CmpNum#;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Nombre Cliente";
            |HAZ ObtenDato; eaNombre    = #agif024@#CmpNum#;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Telefono";
            |HAZ ObtenDato; eaTelefono  = #agif024@#CmpNum#;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Fax";
            |HAZ ObtenDato; eaFax       = #agif024@#CmpNum#;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Email";
            |HAZ ObtenDato; eaEmail     = #agif024@#CmpNum#;
            eaCP = (("00" + eaCP1) % -102) + (("000" + eaCP2) % -103);
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Codigo Pais";
            |HAZ ObtenDato; eaCodPais   = #agif024@#CmpNum#;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Nombre Pais";
            |HAZ ObtenDato; eaPais       = #agif024@#CmpNum#;
            aAlfa = "|NC"; aAlfa = #agif024@#aAlfa#; nCalc = aAlfa;
            eaCodBLZ   = "";
            eaCodSwift = "";

            eaCPExt = "";
            eaCodIBAN  = "";
            eaCodBIC   = "";
            eaFechaMand = "01.01.0000";
            |SI nCalc > 215
               eaCPExt = #agif024@#211;
               eaCodIBAN  = #agif024@#215;
               eaCodBIC   = #agif024@#216;
               eaFechaMand = #agif024@#217;
            |FINSI;

            |SI HayConta = 1; |Y aCuenta ! "            "; |Y aCuenta ! "";
               aAlfa = "|NC"; aAlfa = #caclipr@#aAlfa#; nCalc = aAlfa;

               Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Cliente/Proveedor"; |HAZ ObtenDato;
               #caclipr@#CmpNum# = eaTipoCod;
               Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Cuenta Contable"; |HAZ ObtenDato;
               #caclipr@#CmpNum# = aCuenta; |HAZ SacaNivel;
               Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Digito Contable"; |HAZ ObtenDato;
               #caclipr@#CmpNum# = nNivel;
               |LEE 000#caclipr@.=;
               |SI FSalida = 0; |Y nCalc > 37;
                  eaCodBLZ   = #caclipr@#38;
                  eaCodSwift = #caclipr@#39;
                  |SI eaCodIBAN = ""; eaCodIBAN  = #caclipr@#40; |FINSI;
                  |SI eaCodBIC  = ""; eaCodBIC   = #caclipr@#41; |FINSI;
               |SINO;
                  eaCodBLZ   = "";
                  eaCodSwift = "";
               ||   eaCodIBAN  = "";
               ||   eaCodBIC   = "";
               |FINSI;
            |FINSI;

            |ACABA;
         |SINO;
            eaDireccion = "";
            eaDirCobro  = "";
            eaPoblacion = "";
            eaProvincia = "";
            eaCP       = "";
            eaCP1      = "";
            eaCP2      = "";
            eaNif      = "";
            eaNombre   = "";
            eaTelefono = "";
            eaFax      = "";
            eaPais     = "";
         |FINSI;
      |SINO;
         |SI enDocumento ! 0;
            |HAZ BuscaEmpresa;
            aAlfa = aDir + "fich/" + (("00000" + nEmp) % -105) + "/";
            |CIERRA #agif112@; |PATH_DAT #agif112@#aAlfa#; |ABRE #agif112@;
            enDocumento = 0;
         |FINSI;

         Fichero = "Proveedores"; Tipo = "G"; Cmp = "Codigo Proveedor"; |HAZ ObtenDato;
         #agif112@#CmpNum# = eaCodigo;
         |LEE 000#agif112@.=;
         |SI FSalida = 0; |Y #agif112@#CmpNum# ! "      ";
            aAlfa = "|NC"; aAlfa = #agif112@#aAlfa#; nCalc = aAlfa; nCalc = nCalc - 1;
            Fichero = "Proveedores"; Tipo = "G"; Cmp = "Direccion envio doc.pago"; |HAZ ObtenDato;
            |SI nCalc ] CmpNum;
               eaDireccion = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Tipo = "G"; Cmp = "Poblacion envio doc.pago";
               |HAZ ObtenDato; eaPoblacion = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Tipo = "G"; Cmp = "Provincia envio doc.pago";
               |HAZ ObtenDato; eaProvincia = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Tipo = "G"; Cmp = "C.P.1 envio doc.pago";
               |HAZ ObtenDato; eaCP1       = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Tipo = "G"; Cmp = "C.P.2 envio doc.pago";
               |HAZ ObtenDato; eaCP2       = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Tipo = "G"; Cmp = "Ap.correos envio doc.pago";
               |HAZ ObtenDato; eaApCorreos = #agif112@#CmpNum#;
            |FINSI;
            |QBF eaDireccion;
            |SI eaDireccion = "";
               Fichero = "Proveedores"; Tipo = "G"; Cmp = "Direccion";
               |HAZ ObtenDato; eaDireccion = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Tipo = "G"; Cmp = "Poblacion";
               |HAZ ObtenDato; eaPoblacion = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Tipo = "G"; Cmp = "Provincia";
               |HAZ ObtenDato; eaProvincia = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Tipo = "G"; Cmp = "Codigo Postal 1";
               |HAZ ObtenDato; eaCP1       = #agif112@#CmpNum#;
               Fichero = "Proveedores"; Tipo = "G"; Cmp = "Codigo Postal 2";
               |HAZ ObtenDato; eaCP2       = #agif112@#CmpNum#;
               eaApCorreos = "";
            |FINSI;
            Fichero = "Proveedores"; Tipo = "G"; Cmp = "Nif/Cif";
            |HAZ ObtenDato; eaNif       = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Tipo = "G"; Cmp = "Nombre Comercial";
            |HAZ ObtenDato; eaNombre    = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Tipo = "G"; Cmp = "Nombre Fiscal";
            |HAZ ObtenDato; eaNomFisc   = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Tipo = "G"; Cmp = "Telefono";
            |HAZ ObtenDato; eaTelefono  = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Tipo = "G"; Cmp = "Fax";
            |HAZ ObtenDato; eaFax  = #agif112@#CmpNum#;
            Fichero = "Proveedores"; Tipo = "G"; Cmp = "Email";
            |HAZ ObtenDato; eaEmail     = #agif112@#CmpNum#;
            eaCP = (("00" + eaCP1) % -102) + (("000" + eaCP2) % -103);
            Fichero = "Proveedores"; Tipo = "G"; Cmp = "Codigo Pais";
            |HAZ ObtenDato; eaCodPais = #agif112@#CmpNum#;
            aAlfa = #48#17; |QBF aAlfa;
            aAlfa = aAlfa + "def/dsm00225.mas";
            |CARGA_DEF aAlfa, RefDocu@;
            |SI FSalida = 0;
               aAlfa = #48#17; |QBF aAlfa;
               aAlfa = aAlfa + "fich/" + (("00000" + #dscam008#46) % -105) + "/";
               |PATH_DAT #RefDocu@#aAlfa#;
               |ABRE #RefDocu@;
               #RefDocu@#0 = eaCodPais;
               |LEE 000#RefDocu@.=;
               |SI FSalida ! 0; |DDEFECTO #RefDocu@; |FINSI;
               eaPais = #RefDocu@#1; |QBF eaPais;
               |CIERRA #RefDocu@; |DESCARGA_DEF #RefDocu@;
            |FINSI;
            aAlfa = "|NC"; aAlfa = #agif112@#aAlfa#; nCalc = aAlfa;
            eaCodBLZ   = "";
            eaCodSwift = "";
            |SI nCalc > 96
               eaCPExt = #agif112@#108;
               eaCodIBAN  = #agif112@#96;
               eaCodBIC   = #agif112@#97;
               eaCodSwift = #agif112@#95;
            |SINO;
               eaCPExt = "";
               eaCodIBAN  = "";
               eaCodBIC   = "";
            |FINSI;

            |SI HayConta = 1; |Y aCuenta ! "            "; |Y aCuenta ! "";
               aAlfa = "|NC"; aAlfa = #caclipr@#aAlfa#; nCalc = aAlfa;

               Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Cliente/Proveedor"; |HAZ ObtenDato;
               #caclipr@#CmpNum# = eaTipoCod;
               Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Cuenta Contable"; |HAZ ObtenDato;
               #caclipr@#CmpNum# = aCuenta; |HAZ SacaNivel;
               Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Digito Contable"; |HAZ ObtenDato;
               #caclipr@#CmpNum# = nNivel;
               |LEE 000#caclipr@.=;
               |SI FSalida = 0; |Y nCalc > 37;
                  eaCodBLZ   = #caclipr@#38;
                  eaCodSwift = #caclipr@#39;
                  |SI eaCodIBAN = ""; eaCodIBAN  = #caclipr@#40; |FINSI;
                  |SI eaCodBIC  = ""; eaCodBIC   = #caclipr@#41; |FINSI;
               |FINSI;
            |FINSI;

            |ACABA;
         |SINO;
            eaDireccion = "";
            eaDirCobro  = "";
            eaPoblacion = "";
            eaProvincia = "";
            eaCP       = "";
            eaCP1      = "";
            eaCP2      = "";
            eaNif      = "";
            eaNombre   = "";
            eaTelefono = "";
            eaFax      = "";
            eaCodPais  = "";
            eaPais     = "";
            eaFechaMand = "01.01.0000";
         |FINSI;
      |FINSI;
   |FINSI;

   |SI HayConta = 1; |Y aCuenta ! "            ";
      |SI enDocumento ! 0;
         |HAZ BuscaEmpresa;
         aAlfa = aDir + "fich/" + (("00000" + nEmp) % -105) + nPer + "/";
         |CIERRA #caclipr@; |PATH_DAT #caclipr@#aAlfa#; |ABRE #caclipr@;
         enDocumento = 0;
      |FINSI;
      Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Cliente/Proveedor"; |HAZ ObtenDato;
      #caclipr@#CmpNum# = eaTipoCod;
      Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Cuenta Contable"; |HAZ ObtenDato;
      #caclipr@#CmpNum# = aCuenta; |HAZ SacaNivel;
      Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Digito Contable"; |HAZ ObtenDato;
      #caclipr@#CmpNum# = nNivel;
      |LEE 000#caclipr@.=;
      |SI FSalida = 0; |Y aCuenta ! "";
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Razon Social";
         |HAZ ObtenDato; eaNomFisc = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Direccion envio doc.pago";
         |HAZ ObtenDato; eaDireccion = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Poblacion envio doc.pago";
         |HAZ ObtenDato; eaPoblacion = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Provincia envio doc.pago";
         |HAZ ObtenDato; eaProvincia = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "C.P.1 envio doc.pago";
         |HAZ ObtenDato; eaCP1       = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "C.P.2 envio doc.pago";
         |HAZ ObtenDato; eaCP2       = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Ap.correos envio doc.pago";
         |HAZ ObtenDato; eaApCorreos = #caclipr@#CmpNum#;
         |QBF eaDireccion;
         |SI eaDireccion = "";
            Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Direccion";
            |HAZ ObtenDato; eaDireccion = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Poblacion";
            |HAZ ObtenDato; eaPoblacion = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Provincia";
            |HAZ ObtenDato; eaProvincia = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Codigo Postal 1";
            |HAZ ObtenDato; eaCP1       = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Codigo Postal 2";
            |HAZ ObtenDato; eaCP2       = #caclipr@#CmpNum#;
            eaApCorreos = "";
         |FINSI;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Nif/Cif";
         |HAZ ObtenDato; eaNif       = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Razon Social";
         |HAZ ObtenDato; eaNombre    = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Telefono";
         |HAZ ObtenDato; eaTelefono  = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Fax";
         |HAZ ObtenDato; eaFax  = #caclipr@#CmpNum#;
/*
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Email";
         |HAZ ObtenDato; eaEmail     = #caclipr@#CmpNum#;
*/
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Pais";
         |HAZ ObtenDato; eaPais      = #caclipr@#CmpNum#;
         eaCodPais = eaPais;

         aAlfa = #48#16; |QBF aAlfa;
         aAlfa = aAlfa - "contagen/";
         aAlfa = aAlfa + "basica/";  aPath = aAlfa;
         aAlfa = aAlfa + "def/agim0016.mas";
         |CARGA_DEF aAlfa, RefDocu@;
         |SI FSalida = 0;
            aAlfa = aPath + "fich/";
            |PATH_DAT #RefDocu@#aAlfa#;
            |ABRE #RefDocu@;
            #RefDocu@#0 = eaCodPais;
            |LEE 000#RefDocu@.=;
            |SI FSalida = 0;
                 eaPais = #RefDocu@#1; |QBF eaPais;
            |FINSI;
            |CIERRA #RefDocu@; |DESCARGA_DEF #RefDocu@;
         |FINSI;

         eaCP = (("00" + eaCP1) % -102) + (("000" + eaCP2) % -103);

         aAlfa = "|NC"; aAlfa = #caclipr@#aAlfa#; nCalc = aAlfa;
         |SI nCalc > 37;
            eaCodBLZ   = #caclipr@#38;
            eaCodSwift = #caclipr@#39;
            eaCodIBAN  = #caclipr@#40;
            eaCodBIC   = #caclipr@#41;
            |SI nCalc > 51;
               eaEmail    = #caclipr@#51;
            |FINSI;
         |SINO;
            eaCPExt = "";
            eaCodBLZ   = "";
            eaCodSwift = "";
            eaCodIBAN  = "";
            eaCodBIC   = "";
         |FINSI;
      |SINO;
         eaDireccion = "";
         eaDirCobro  = "";
         eaPoblacion = "";
         eaProvincia = "";
         eaCP       = "";
         eaCP1      = "";
         eaCP2      = "";
         eaNif      = "";
         eaNombre   = "";
         eaTelefono = "";
         eaFax      = "";
         eaPais     = "";
         eaCodBLZ   = "";
         eaCodSwift = "";
         eaCPExt = "";
         eaCodIBAN  = "";
         eaCodBIC   = "";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Formateo;
   |QBF eaCadena; aAlfa = eaCadena;
   |SI TipoDato = "N";
      Vacio1 = "0" * Long;
      Vacio2 = "0" * LongDec;
      aAlfa = aAlfa - "-";
      |SI FSalida ! 0;
         nNegativo = 1;
      |SINO;
         nNegativo = 0;
      |FINSI;
   |SINO;
      Vacio1 = " " * Long;
   |FINSI;

   |SI TipoDato ! "N";
      Calc1 = 100 + Long; aAlfa = (aAlfa + Vacio1) % Calc1;
   |SINO;
      |SI LongDec = 0;
         Calc1 = 0 - (100 + Long);
         aAlfa = (Vacio1 + aAlfa) % Calc1;
      |SINO;
         aAlfa = aAlfa - ".";
         |SI FSalida = 0;
            Calc1 = 0 - (100 + Long);
            aAlfa = (Vacio1 + aAlfa) % Calc1;
            aAlfa1 = "0" * LongDec;
         |SINO;
            Calc1 = (((FSalida / 100) ! 0) - 1) + 100;
            Calc2 = (((FSalida / 100) ! 0) * 100) + 99;
            aAlfa1 = aAlfa % Calc2;
            aAlfa = aAlfa % Calc1;
            Calc1 = 0 - (100 + Long);
            aAlfa = (Vacio1 + aAlfa)  % Calc1;
            Calc1 = 100 + LongDec;
            aAlfa1 = (aAlfa1 + Vacio2) % Calc1;
         |FINSI;
         aAlfa = aAlfa + aAlfa1;
      |FINSI;
      |SI nNegativo = 1;
         Calc1 = 0 - (100 + (Long + LongDec)); Calc1 = Calc1 + 1;
         aAlfa = aAlfa % Calc1;
         aAlfa = "N" + aAlfa;
      |FINSI;
   |FINSI;

   aAlfa2 = "";

   |SI TipoDato = "A"; |O TipoDato = "An";
      aLong = aAlfa % 0; nLong = aLong;
      |PARA nCont1 = 1; |SI nCont1 [ nLong; |HACIENDO nCont1 = nCont1 + 1;
         Calc1 = (nCont1 * 100) + 1; aAlfa1  = aAlfa % Calc1;
         aAlfa1 = aAlfa1 > aAlfa1;
         |SI aAlfa1 = " ";                  |VETE Sigue1; |FINSI;
         |SI aAlfa1 ] "A"; |Y aAlfa1 [ "Z"; |VETE Sigue1; |FINSI;
         |SI aAlfa1 ] "0"; |Y aAlfa1 [ "9"; |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "¥"; aAlfa1 = &209;   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "¤"; aAlfa1 = &209;   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "ç"; aAlfa1 = &199;   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "Ç"; aAlfa1 = &199;   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "-"; aAlfa1 = &45;    |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "'"; aAlfa1 = &49;    |VETE Sigue1; |FINSI;
         |SI TipoDato = "An";
            |SI aAlfa1 = "&"; aAlfa1 = &38;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = ","; aAlfa1 = &44;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = "."; aAlfa1 = &46;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = ":"; aAlfa1 = &58;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = ";"; aAlfa1 = &59;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = "_"; aAlfa1 = &95;    |VETE Sigue1; |FINSI;
         |FINSI;
         aAlfa1 = " ";
|ET Sigue1;
         aAlfa2 = aAlfa2 + aAlfa1;
      |SIGUE;
      aAlfa = aAlfa2;
   |FINSI;
   eaCadena = aAlfa;
|FPRC;

|PROCESO Entrada;
   |DFICB aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + (("00000" + #48#0) % -105) + "/";
   |PATH_DAT #5000 aAlfa; |PATH_DAT #5001 aAlfa; |PATH_DAT #503 aAlfa;

   |ABRE #dscam085; |ABRE #dscam083; |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
   |FINSI;

   |SI #dscam051#47 = "S";
      aAlfa = Usuario % 0810;
      #dscam085#0 = aAlfa;
      |LEE 000#dscam085.=;
      |SI FSalida = 0;
         |SI #dscam085#1 = "F";
            PRMNT_enPerfil = #dscam085#2;
         |SINO;
            |DDEFECTO #dscam083;
            |MENSA "    <F2> Consulta de perfiles ";
            |PUSHV 1120 1360;

|ET PidePerfil;
            |BLANCO 1113 1368; |CUADRO 1113 1368;
            |ATRI R; |PINTA 1114, " PERFIL VARIABLE : INTRODUZCA PERFIL "; |ATRI N;
            |PINTA 1214, " Perfil : "; |PINTA 1228, #dscam083#1;
            E_sup = 99; E_inf = 0;
            PRMNT_enPerfil = 1225 ? 1;
            |SI FSalida ! 0;
               |SI FSalida = 10;
                  #dscam083#0 = PRMNT_enPerfil;
                  |LEE 000#dscam083.];
                  |CONSULTA_CLAVE #1#dscam083;
                  |SI FSalida = 0;
                     PRMNT_enPerfil = #dscam083#0;
                  |FINSI;
                  |VETE PidePerfil;
               |FINSI;
            |FINSI;
            |POPV;
         |FINSI;
         #dscam083#0 = PRMNT_enPerfil;
         |LEE 000#dscam083.=;
         |SI FSalida = 0;
            |PUSHV 1112 1468;
            |BLANCO 1112 1468; |CUADRO 1112 1468;
            |ATRI P; |PINTA 1113, " ESTA USANDO EL SIGUIENTE PERFIL "; |ATRI N;
            |PINTA 1213, " Usuario : "; |PINTA 1224, #dscam085#0;
            |PINTA 1332 , "";
            #dscam085#2 = PRMNT_enPerfil;
            |PINTA 1313, " Perfil  : "; |PINTA 1324, #dscam085#2;
            |PINTA 1327, #dscam083#1;
            |PAUSA; |POPV;
         |SINO;
            |MENAV "    Perfil inexistente "; |VETE PidePerfil;
         |FINSI;
         |MENSA "     ";
      |SINO;
         |LEE 000#dscam085.p;
         |SI FSalida = 0;
            PRMNT_enPerfil = -1;
            |MENAV "    Usuario no encontrado"; |ERROR; |PTEC 807;
         |SINO;
            |MENAV "    No hay usuarios en el control. Acceso permitido";
         |FINSI;
      |FINSI;
      |CIERRA #dscam085;
   |SINO;
      PRMNT_enPerfil = 0;
   |FINSI;
|FPRC;

|PROCESO Perfil;
   nSwErr = 0;

   #dscam081#0 = #dscam084#1;
   |LEE 000#dscam081.=;
   |SI FSalida ! 0; |ACABA; |FINSI;
   |SI eaFiltroPag ! "";
      |SI #dscam081#2 ! eaFiltroPag;
         nSwErr = 1;
      |FINSI;
   |FINSI;

   #dscam082#0 = #dscam084#1;
   #dscam082#1 = eaTipoClas;
   |LEE 000#dscam082.=;
   |SI FSalida ! 0;
      nSwErr = 1;
   |SINO;
      #dscam089#0 = #dscam088#0;
      #dscam089#1 = #dscam084#0;
      #dscam089#2 = #dscam084#1;
      |LEE 000#dscam089.=;
      |SI FSalida = 0;
         |SI #dscam089#4 = " ";
            nSwErr = 1;
         |SINO;
            aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#; aAlfa = aAlfa % -108;
            |SI aAlfa = eaFichClas;
               nCalc = #dscam089#4;
               |SI #dscam089#5 = "A"; nCalc1 = 6; |FINSI;
               |SI #dscam089#5 = "N"; nCalc1 = 7; |FINSI;
               |SI #dscam089#5 = "F"; nCalc1 = 8; |FINSI;
               |SI #dscam089#nCalc1# = #Fichero@#nCalc#;
                  nSwErr = 1;
               |FINSI;
            |SINO;
               aAlfa = "|NR"; aAlfa = #Fichero@#aAlfa#;
               nRels = aAlfa; |SI nRels = 0; |ACABA; |FINSI;
               |PARA nContRel = 0; |SI nContRel < nRels; |HACIENDO nContRel = nContRel + 1;
                  aAlfa = "|R" + (("000" + nContRel) % -103);
                  aAlfa = #Fichero@#aAlfa#;
                  aFichRel = aAlfa % 0108; aCmpsRel = aAlfa % 1099;
                  |SI aFichRel = eaFichClas;
                     |DBASE aAlfa1; |QBF aAlfa1;
                     aAlfa1 = aAlfa1 + "def/" + eaFichClas + ".mas";
                     |CARGA_DEF aAlfa1, RefPLB0@;
                     |SI FSalida = 0;
                        |ABRE #RefPLB0@;
                        aAlfa = aCmpsRel % 0103; aCmpsRel = aCmpsRel % 0499;
                        nCmpsRel = aAlfa;
                        aAlfa = "|K000"; aCmpsKey = #RefPLB0@#aAlfa#;
                        aCmpsKey = aCmpsKey % 0499;
                        |PARA nContKey = 1; |SI nContKey [ nCmpsRel; |HACIENDO nContKey = nContKey + 1;
                           aAlfa  = aCmpsRel % 0103; aCmpsRel = aCmpsRel % 0499;
                           aAlfa1 = aCmpsKey % 0103; aCmpsKey = aCmpsKey % 0499;
                           #RefPLB0@#nCmpKey# = #Fichero@#nCmpRel#;
                        |SIGUE;
                        |LEE 000#RefPLB0@.=;
                        |SI FSalida = 0;
                            nCalc = #dscam089#4;
                            |SI #dscam089#5 = "A"; nCalc1 = 6; |FINSI;
                            |SI #dscam089#5 = "N"; nCalc1 = 7; |FINSI;
                            |SI #dscam089#5 = "F"; nCalc1 = 8; |FINSI;
                            |SI #dscam089#nCalc1# = #RefPLB0@#nCalc#;
                               nSwErr = 1;
                            |FINSI;
                        |FINSI;
                        |CIERRA #RefPLB0@; |DESCARGA_DEF #RefPLB0@;
                     |FINSI;
                  |FINSI;
               |SIGUE;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   |SI nSwErr = 0; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE Perfil;
#dscam084#1;
;
PRMNT_enPerfil,001;
PRMNT_enPerfil,999;
;
NULL,Perfil;
|FIN;

|PROCESO CompruebaClas;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#47 = "N"; eaFichClas = ""; |ACABA; |FINSI;

   |ABRE #dscam088; |ABRE #dscam087; |ABRE #dscam082;
   |ABRE #dscam089; |ABRE #dscam081;
   |SELECT #2#dscam088;
   #dscam088#1 = eaFichClas;
   |LEE 000#dscam088.=;
   |SI FSalida = 0;
      #dscam087#0 = #dscam088#0;
      #dscam087#1 = PRMNT_enPerfil;
      |LEE 000#dscam087.=;
      |SI FSalida = 0;
         |BUCLE Perfil;
         |SI nSwErr = 1;
            |SI enSwClas = 1;
               |SI #dscam088#3 = "E"; eaFichClas = "ERROR"; |SINO eaFichClas = "INFOR"; |FINSI;
            |FINSI;
         |SINO;
            eaTipoClas = #dscam081#2;
         |FINSI;
      |SINO;
         |SI enSwClas = 1;
            |SI #dscam088#3 = "E"; eaFichClas = "ERROR"; |SINO eaFichClas = "INFOR"; |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
   |SELECT #1#dscam088;
   |CIERRA #dscam088; |CIERRA #dscam087; |CIERRA #dscam082;
   |CIERRA #dscam089; |CIERRA #dscam081;
|FPRC;

|PROCESO QuitaRaros;
     aMax = &175;
     aMin = &223;
     aRaya = &196;

     aCadena = "";
     aLen    = eaCadena % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaCadena % nPos;
           sw = 0;
           |SI enMayus = 0;
              |SI aCaracter = "¥";  aCaracter = &209; sw = 1; |FINSI;
              |SI aCaracter = "¤";  aCaracter = &241; sw = 1; |FINSI;
              |SI aCaracter = " ";  aCaracter = &225; sw = 1; |FINSI;
              |SI aCaracter = "";  aCaracter = &233; sw = 1; |FINSI;
              |SI aCaracter = "¡";  aCaracter = &237; sw = 1; |FINSI;
              |SI aCaracter = "¢";  aCaracter = &243; sw = 1; |FINSI;
              |SI aCaracter = "£";  aCaracter = &250; sw = 1; |FINSI;
           |SINO;
              |SI aCaracter = "¥";  aCaracter = &209; sw = 1; |FINSI;
              |SI aCaracter = "¤";  aCaracter = &209; sw = 1; |FINSI;
              |SI aCaracter = " ";  aCaracter = &65;  sw = 1; |FINSI;
              |SI aCaracter = "";  aCaracter = &69;  sw = 1; |FINSI;
              |SI aCaracter = "¡";  aCaracter = &73;  sw = 1; |FINSI;
              |SI aCaracter = "¢";  aCaracter = &79;  sw = 1; |FINSI;
              |SI aCaracter = "£";  aCaracter = &85;  sw = 1; |FINSI;
           |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; sw = 1; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; sw = 1; |FINSI;
           |SI aCaracter > aMax; |Y aCaracter < aMin; |Y sw = 0;
               |SI aCaracter = aRaya;
                    aCaracter = "_";
               |SINO;
                    aCaracter = " ";
               |FINSI;
           |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaCadena = aCadena;
|FPRC;

|PROCESO CuentaCbs;
   nCuentaCobs = nCuentaCobs + 1;
|FPRC;

|DEFBUCLE CuentaCbs;
#dscam004#3;
5;
nCodigo,aOper;
nCodigo,aOper;
;
NULL,CuentaCbs;
|FIN;

|PROCESO BajaMov;
   nSwError = 0;
   |ABRE #dscam004;
   #dscam004#17 = enNumDocum;
   #dscam004#3  = 99;
   |LEE 000#dscam004.];
   |SI FSalida = 0;
      |SI #dscam004#17 ! enNumDocum;
         |LEE 000#dscam004.a;
         |SI FSalida = 0;
            |SI #dscam004#17 ! enNumDocum;
               |MENAV "    Movimiento no encontrado. Proceso abortado"; nSwError = 1;
            |SINO;
               |SI #dscam004#5 ! aOper;
                  |SI aOper = "PRE";
                     |SI #dscam004#5 ! "IMP"; |Y #dscam004#5 ! "RCE";
                        |MENAV "    Hay movimientos posteriores al que se pretende anular. Proceso abortado"; nSwError = 1;
                     |FINSI;
                  |SINO;
                     |MENAV "    Hay movimientos posteriores al que se pretende anular. Proceso abortado"; nSwError = 1;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            |MENAV "    Movimiento no encontrado. Proceso abortado"; nSwError = 1;
         |FINSI;
      |FINSI;
   |SINO;
      |LEE 000#dscam004.u;
      |SI FSalida = 0;
         |SI #dscam004#17 ! enNumDocum;
            |MENAV "    Movimiento no encontrado. Proceso abortado"; nSwError = 1;
         |SINO;
            |SI #dscam004#5 ! aOper;
               |MENAV "    Hay movimientos posteriores al que se pretende anular. Proceso abortado"; nSwError = 1;
            |FINSI;
         |FINSI;
      |SINO;
         |MENAV "    Movimiento no encontrado. Proceso abortado"; nSwError = 1;
      |FINSI;
   |FINSI;

   |SI nSwError = 1; eaResult = "ERROR"; |CIERRA #dscam004; |ACABA; |FINSI;

   |SI #dscam004#5 = "ENV";
      |ABRE #dscam067;
      #dscam067#8 = 0;
      #dscam067#9 = 0;
      #dscam067#0 = "CB";
      #dscam067#1 = #dscam004#17;
      #dscam067#2 = #dscam004#3;
      #dscam067#3 = "";
      #dscam067#11 = 1;
      |LEE 000#dscam067.];
      FEstado = FSalida;
      Clave1 = #dscam067#0; Clave2 = #dscam067#1; Clave3 = #dscam067#2;
      |PARA; |SI FEstado = 0; |Y Clave1  = "CB"; |Y Clave2 = #dscam004#17; |HACIENDO;
         |SI Clave3 = #dscam004#3; |SAL; |FINSI;
         |LEE 000#dscam067.s;
         FEstado = FSalida;
         Clave1 = #dscam067#0; Clave2 = #dscam067#1;
         Clave3 = #dscam067#2;
      |SIGUE;
      |SI FEstado = 0; |Y Clave1  = "CB"; |Y Clave2 = #dscam004#17; |Y Clave3 = #dscam004#3;
         nLinea  = #dscam004#3;
         nCodigo = #dscam004#43;
         aOper   = #dscam004#5;
         nCuentaCobs = 0;
         |SI nCodigo ! 0;
            |SALVA_FICHA #dscam004;
            |BUCLE CuentaCbs;
            |LEE 000#dscam004.p; |REPON_FICHA #dscam004;
            |SI nCuentaCobs = 1;
               Modo1 = ",B";
            |SINO;
               |SALVA_DATOS #dscam004; |BORRA 020#dscam004.a;
               Modo1 = "";
            |FINSI;
         |SINO;
            Modo1 = ",B";
         |FINSI;

         #dscam003#40 = enNumDocum;
         |LEE 101#dscam003.=;
         |SI FSalida = 0;
            #dscam003#12 = enTipoRec;
            #dscam003#93 = "N";
            #dscam003#14 = "P";
            #dscam003#15 = "Pendiente de cobro";
            #dscam003#95 = "";
            |GRABA 020#dscam003.a; |LIBERA #dscam003;
         |FINSI;

         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #508 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;

         |SI #dscam004#43 ! 0;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            #dscaw013#5 = #dscam004#43;  #dscaw013#6 = #dscam004#43;
            |GRABA 020#dscaw013.n;
         |SINO;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
            |GRABA 020#dscaw013.n;
         |FINSI;

         |DDEFECTO #dscaw013;
         #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
         #dscaw013#11 = "A";          #dscaw013#12 = 3;
         #dscaw013#3 = #dscam004#3;  #dscaw013#4 = #dscam004#3;
         |GRABA 020#dscaw013.n;

         |LIBERA #dscaw013; |CIERRA #dscaw013;
         |LIBERA #dscam004; |CIERRAT #dscam004;
         Comodin = #dscam067#10;
         Comodin = "dscam033.tab;" + Comodin + Modo1;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam004; |LEE 101#dscam004.=;
         |SI Modo1 = ",B";
            #dscam004#17 = enNumDocum;
            #dscam004#3  = nLinea;
            |LEE 000#dscam004.=;
            |SI FSalida = 0; |BORRA 020#dscam004.a; |FINSI;
         |FINSI;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
      |SINO;
         |BORRA 020#dscam004.a;
      |FINSI;
      |CIERRA #dscam067;
   |FINSI;
   |SI #dscam004#5 = "PRE"; |O #dscam004#5 = "RCF";
      |ABRE #dscam067;
      #dscam067#8 = 0;
      #dscam067#9 = 0;
      #dscam067#0 = "CB";
      #dscam067#1 = #dscam004#17;
      #dscam067#2 = #dscam004#3;
      #dscam067#3 = "";
      #dscam067#11 = 1;
      |LEE 000#dscam067.];
      FEstado = FSalida;
      Clave1 = #dscam067#0; Clave2 = #dscam067#1; Clave3 = #dscam067#2;
      |PARA; |SI FEstado = 0; |Y Clave2 = "CB"; |Y Clave2 = #dscam004#17; |HACIENDO;
         |SI Clave3 = #dscam004#3; |SAL; |FINSI;
         |LEE 000#dscam067.s;
         FEstado = FSalida;
         Clave1 = #dscam067#0; Clave2 = #dscam067#1; Clave3 = #dscam067#2;
      |SIGUE;
      |SI FEstado = 0; |Y Clave1 = "CB"; |Y Clave2 = #dscam004#17; |Y Clave3 = #dscam004#3;
         nLinea = #dscam004#3;
         #dscam003#40 = enNumDocum;
         |LEE 101#dscam003.=;
         |SI FSalida = 0;
            |SI #dscam004#5 = "PRE"; #dscam003#90 = "N"; |FINSI;
            |SI #dscam004#5 = "RCF"; #dscam003#97 = "N"; |FINSI;
            |GRABA 020#dscam003.a; |LIBERA #dscam003;
         |FINSI;

         nCodigo = #dscam004#43;
         aOper   = #dscam004#5;
         nCuentaCobs = 0;
         |SI nCodigo ! 0;
            |SALVA_FICHA #dscam004;
            |BUCLE CuentaCbs;
            |LEE 000#dscam004.p; |REPON_FICHA #dscam004;
            |SI nCuentaCobs = 1; |O #dscam004#43 = 0;
               Modo1 = ",B";
            |SINO;
               |SALVA_DATOS #dscam004; |BORRA 020#dscam004.a;
               Modo1 = "";
            |FINSI;
         |SINO;
            Modo1 = ",B";
         |FINSI;

         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #508 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;

         |DDEFECTO #dscaw013;
         #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
         #dscaw013#13 = "dscam004";
         |SI #dscam004#43 ! 0;
            #dscaw013#14 = 43; #dscaw013#11 = "N";
            #dscaw013#12 = 10;
            #dscaw013#5 = #dscam004#43;  #dscaw013#6 = #dscam004#43;
         |SINO;
            #dscaw013#14 = 17; #dscaw013#11 = "N";
            #dscaw013#12 = 9;
            #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
         |FINSI;
         |GRABA 020#dscaw013.n;

         |DDEFECTO #dscaw013;
         #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
         #dscaw013#11 = "A";          #dscaw013#12 = 3;
         #dscaw013#3 = #dscam004#5;  #dscaw013#4 = #dscam004#5;
         |GRABA 020#dscaw013.n;

         |LIBERA #dscaw013; |CIERRA #dscaw013;

         Comodin = #dscam067#10;
         Comodin = "dscam033.tab;" + Comodin + Modo1;
         |SUB_EJECUTA_NP Comodin;
         |SI Modo1 = ",B";
            |ABRE #dscam004;
            #dscam004#17 = enNumDocum;
            #dscam004#3  = nLinea;
            |LEE 000#dscam004.=;
            |SI FSalida = 0; |BORRA 020#dscam004.a; |FINSI;
         |FINSI;
         |BORRA 000#dscam067.a;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
      |SINO;
         |BORRA 020#dscam004.a;
      |FINSI;
      |CIERRA #dscam067; |ACABA;
   |FINSI;
   |CIERRA #dscam004;
|FPRC;

|PROCESO CambiaTR;
   |CONFI "    NDocumento inoperable en el perfil actual. Cambiar clasificacion ?";
   |SI FSalida ! 0;
      eaResult = "ERROR"; |ACABA;
   |FINSI;

   aFichClas = eaFichClas;

   |ABRE #dscam088; |SELECT #2#dscam088;
   |ABRE #dscam087; |ABRE #dscam089;
   |ABRE #dscam081; |ABRE #dscam082;
   #dscam088#1 = aFichClas;
   |LEE 000#dscam088.=;
   |SI FSalida = 0;
      #dscam087#0 = #dscam088#0;
      #dscam087#1 = PRMNT_enPerfil;
      |LEE 000#dscam087.=;
      |SI FSalida = 0;
         |LEE 000#dscam082.p;
         |PARA; |SI FSalida = 0; |HACIENDO;
            #dscam089#0 = #dscam087#0;
            #dscam089#1 = #dscam087#1;
            #dscam089#2 = #dscam082#0;
            |LEE 000#dscam089.=;
            |SI FSalida ! 0;
               nTipoRec = #dscam082#1;
               |SI eaFiltro = "";
                  |SAL;
               |SINO;
                  #dscam081#0 = #dscam082#0;
                  |LEE 000#dscam081.=;
                  |SI FSalida ! 0; |DDEFECTO #dscam081; |FINSI;
                  |SI eaFiltro = "P";
                     |SI #dscam081#2 = "P"; |SAL; |FINSI;
                  |FINSI;
                  |SI eaFiltro = "A";
                     |SI #dscam081#2 = "A"; |SAL; |FINSI;
                  |FINSI;
                  |SI eaFiltro = "C";
                     |SI #dscam081#2 = "O"; |SAL; |FINSI;
                  |FINSI;
               |FINSI;
            |FINSI;
            |LEE 000#dscam082.s;
         |SIGUE;
      |FINSI;
   |FINSI;
   |SELECT #1#dscam088;
   |CIERRA #dscam081; |CIERRA #dscam082;
   |CIERRA #dscam088; |CIERRA #dscam087; |CIERRA #dscam089;

   |MENSA "    <F2> Consulta tipos de recibo";
   |ABRE #dscam058;
   |PUSHV 0501 2380;
   |BLANCO 1120 1360;
   |CUADRO 1120 1360;
   |ATRI R; |PINTA 1121, " Indique el nuevo tipo de recibo "; |ATRI N;
   #dscam058#0 = nTipoRec; |LEE 000#dscam058.];
   |PINTA 1227, #dscam058#1;
   |ET TRec;
   E_sup = 99; E_inf = 0;
   nTipoRec = 1224 ? 1;
   |SI FSalida ! 10; |Y FSalida ! 0; |Y FSalida ! 7; |VETE TRec; |FINSI;
   |SI FSalida = 7; eaResult = "ERROR"; |POPV; |ACABA; |FINSI;
   |SI FSalida = 10;
      #dscam058#0 = nTipoRec;
      |LEE 000#dscam058.];
      |CONSULTA_CLAVE #1#dscam058;
      |SI FSalida = 0;
         nTipoRec = #dscam058#0; |PINTA 1227, #dscam058#1;
         |VETE TRec;
      |FINSI;
   |FINSI;
   |SI FSalida = 0;
      #dscam058#0 = nTipoRec;
      |LEE 000#dscam058.=;
      |SI FSalida = 0;
         |PINTA 1227, #dscam058#1;
      |SINO;
         |MENAV "    Tipo de recibo inexistente "; |VETE TRec;
      |FINSI;
      |CONFI "    N Es Correcto ? ";
      |SI FSalida ! 0; |VETE TRec; |FINSI;
   |FINSI;

   enSwClas = 1; eaFichClas = aFichClas; eaTipoClas = nTipoRec;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |O eaFichClas = "INFOR";
      |MENAV "    Tipo de recibo inoperable";
      |VETE TRec;
   |FINSI;
   |POPV;
   |CIERRA #dscam058;
   |MENSA "     ";

   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#47 = "N"; |ACABA; |FINSI;

   || Obtengo la clasificacion del documento en cuestion
   |SI eaResult = "V"; || Ventas
      |ABRE #dscam003;
      #dscam003#40 = enNumDocum;
      |LEE 000#dscam003.=;
      |SI FSalida ! 0;
         enTipoRec = -1;
         |CIERRA #dscam003; |ACABA;
      |FINSI;

      |ABRE #dscam081;   |ABRE #dscam082;
      |SELECT #2#dscam082;
      #dscam082#1 = #dscam003#12;
      |LEE 000#dscam082.=;
      |SI FSalida = 0;
         #dscam081#0 = #dscam082#0;
         |LEE 000#dscam081.=;
         |SI FSalida = 0;
            aClasif = #dscam081#2;
         |FINSI;
      |FINSI;
      |CIERRA #dscam081; |CIERRA #dscam082;

      || Compruebo el recibo y hago el cambio en caso de ser posible
      |SI aClasif = "C";                               || Contado
         |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "I"; |Y #dscam003#14 ! "M";
            aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
            |MENAV aAlfa; eaResult = "ERROR";
         |SINO;
            |SI eaTipoClas = "A"; #dscam003#28 = "S"; |SINO; #dscam003#28 = "N"; |FINSI;
            #dscam003#12 = nTipoRec; |GRABA 020#dscam003.a;
         |FINSI;
      |FINSI;
      |SI aClasif = "P";                               || Pagare
         |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "I";
            aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
            |MENAV aAlfa; eaResult = "ERROR";
         |SINO;
            |SI eaTipoClas = "A"; #dscam003#28 = "S"; |SINO; #dscam003#28 = "N"; |FINSI;
            #dscam003#12 = nTipoRec; |GRABA 020#dscam003.a;
         |FINSI;
      |FINSI;
      |SI aClasif = "R";                               || Remesable
         |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "I";
            aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
            |MENAV aAlfa; eaResult = "ERROR";
         |SINO;
            |SI #dscam003#90 = "S";
               aOper = "PRE"; |HAZ BajaMov;
               |SI nSwError = 0;
                  |ABRE #dscam003;
                  #dscam003#40 = enNumDocum;
                  |LEE 000#dscam003.=;
                  |SI FSalida = 0;
                     |SI eaTipoClas = "A"; #dscam003#28 = "S"; |SINO; #dscam003#28 = "N"; |FINSI;
                     #dscam003#90 = "N";
                     #dscam003#12 = nTipoRec;
                     |GRABA 020#dscam003.a;
                  |FINSI;
                  |CIERRA #dscam003;
               |FINSI;
            |SINO;
               |ABRE #dscam003;
               #dscam003#40 = enNumDocum;
               |LEE 000#dscam003.=;
               |SI FSalida = 0;
                  |SI eaTipoClas = "A"; #dscam003#28 = "S"; |SINO; #dscam003#28 = "N"; |FINSI;
                  #dscam003#90 = "N";
                  #dscam003#12 = nTipoRec;
                  |GRABA 020#dscam003.a;
               |FINSI;
               |CIERRA #dscam003;
            |FINSI;
         |FINSI;
      |FINSI;
      |SI aClasif = "A";                               || A aceptar
         |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "V"; |Y #dscam003#14 ! "I";
            aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
            |MENAV aAlfa; eaResult = "ERROR";
         |SINO;
            |SI #dscam003#93 = "S";
               |ABRE #dscam003;
               #dscam003#40 = enNumDocum;
               |LEE 000#dscam003.=;
               |SI FSalida = 0;
                  aOper = "ENV"; |HAZ BajaMov;
                  |SI nSwError = 0
                     #dscam003#93 = "N";
                     #dscam003#14 = "P";
                     #dscam003#15 = "Pendiente de cobro";
                     #dscam003#12 = nTipoRec;
                  |FINSI;
                  #dscam003#28 = "N";
                  |GRABA 020#dscam003.a;
               |FINSI;
               |CIERRA #dscam003;
            |SINO;
               #dscam003#28 = "N";
               |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "I";
                  #dscam003#14 = "P";
                  #dscam003#15 = "Pendiente de cobro";
               |FINSI;
               #dscam003#12 = nTipoRec;
               |GRABA 020#dscam003.a;
               |CIERRA #dscam003;
            |FINSI;
         |FINSI;
      |FINSI;
      |SI aClasif = "O";                               || A recibir Confirming
         |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "I";
            aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
            |MENAV aAlfa; eaResult = "ERROR";
         |SINO;
            |SI #dscam003#97 = "S";
               aOper = "RCF"; |HAZ BajaMov;
               |SI nSwError = 0
                  |ABRE #dscam003;
                  #dscam003#40 = enNumDocum;
                  |LEE 000#dscam003.=;
                  |SI FSalida = 0;
                     |SI eaTipoClas = "A"; #dscam003#28 = "S"; |SINO; #dscam003#28 = "N"; |FINSI;
                     #dscam003#97 = "N";
                     #dscam003#12 = nTipoRec;
                     |GRABA 020#dscam003.a;
                  |FINSI;
                  |CIERRA #dscam003;
               |FINSI;
            |SINO;
/*
               |ABRE #dscam003;
               #dscam003#40 = enNumDocum;
               |LEE 000#dscam003.=;
               |SI FSalida = 0;
                  |SI eaTipoClas = "A"; #dscam003#28 = "S"; |SINO; #dscam003#28 = "N"; |FINSI;
                  #dscam003#97 = "N";
                  #dscam003#12 = nTipoRec;
                  |GRABA 020#dscam003.a;
               |FINSI;
               |CIERRA #dscam003;
*/
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
   |SI eaResult = "C"; || Compras
      |ABRE #dscam008;
      #dscam008#40 = enNumDocum;
      |LEE 000#dscam008.=;
      |SI FSalida ! 0;
         enTipoRec = -1;
         |CIERRA #dscam008; |ACABA;
      |FINSI;

      |ABRE #dscam081;   |ABRE #dscam082;
      |SELECT #2#dscam082;
      #dscam082#1 = #dscam008#12;
      |LEE 000#dscam082.=;
      |SI FSalida = 0;
         #dscam081#0 = #dscam082#0;
         |LEE 000#dscam081.=;
         |SI FSalida = 0;
            aClasif = #dscam081#2;
         |FINSI;
      |FINSI;
      |CIERRA #dscam081; |CIERRA #dscam082;

      || Compruebo el recibo y hago el cambio en caso de ser posible
      |SI aClasif = "C";                               || Contado
         |SI #dscam008#14 ! "P";
            aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
            |MENAV aAlfa; eaResult = "ERROR";
         |SINO;
            #dscam008#12 = enTipoRec; |GRABA 020#dscam008.a;
         |FINSI;
      |FINSI;
      |SI aClasif = "P";                               || Pagare
         |SI #dscam008#14 ! "P";
            aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
            |MENAV aAlfa; eaResult = "ERROR";
         |SINO;
            #dscam008#12 = enTipoRec; |GRABA 020#dscam008.a;
         |FINSI;
      |FINSI;
      |SI aClasif = "R";                               || Remesable
         |SI #dscam008#14 ! "P";
            aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
            |MENAV aAlfa; eaResult = "ERROR";
         |SINO;
            |ABRE #dscam008;
            #dscam008#40 = enNumDocum;
            |LEE 000#dscam008.=;
            |SI FSalida = 0;
               #dscam008#12 = nTipoRec;
               |GRABA 020#dscam008.a;
            |FINSI;
            |CIERRA #dscam008;
         |FINSI;
      |FINSI;
      |SI aClasif = "A";                               || A aceptar
         |SI #dscam008#14 ! "P"; |Y #dscam008#14 ! "V";
            aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
            |MENAV aAlfa; eaResult = "ERROR";
         |SINO;
            |ABRE #dscam008;
            #dscam008#40 = enNumDocum;
            |LEE 000#dscam008.=;
            |SI FSalida = 0;
               #dscam008#12 = nTipoRec;
               |GRABA 020#dscam008.a;
            |FINSI;
            |CIERRA #dscam008;
         |FINSI;
      |FINSI;
      |SI aClasif = "O";                               || A recibir Confirming
         |SI #dscam008#14 ! "P";
            aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
            |MENAV aAlfa; eaResult = "ERROR";
         |SINO;
            |ABRE #dscam003;
            #dscam008#40 = enNumDocum;
            |LEE 000#dscam008.=;
            |SI FSalida = 0;
               #dscam008#12 = nTipoRec;
               |GRABA 020#dscam008.a;
            |FINSI;
            |CIERRA #dscam008;
         |FINSI;
      |FINSI;
      |CIERRA #dscam008;
   |FINSI;
|FPRC;

|FICHEROS;
     Referen@ #5000;
|FIN;

|VARIABLES;
     aRels  = "";
     aAlfa6 = "";

     nNumRels = 0;
     nOpcion  = 0;

     aParametro = "";
     nSalida = 0;
     aPrograma = "";
     aBase = "";
     aPathDef = "";
     aPathFic = "";
     aQueQuiero = "";
     aNomDef = "";
     aMensaje = "";

     aAlfa5 = "";
     aClaves = "";
     aTCompo = "";
     nTCompo = 0;
     aTCompo2 = "";
     nTCompo2 = 0;
     {16}clave = 0;      ||Array de 16 elementos para la clave.
     nCompo = 0;
     aTCampos = "";
     nTCampos = 0;
     aClave = "";
     nNumCam = 0;
     aAplica = "";

     &PRMNT_Def = "";

     nNumCmps    = 0;
   {2}nPuntero   = 0;
|FIN;

|PROCESO Relacionado;
     aAlfa5 = "|K000";
     aClaves = #Referen@#aAlfa5#;
     aTCompo = aClaves % 103;
     nTCompo = aTCompo;
     Iclave = clave1<-;
     |PARA nCampo = 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
          clave = 0;
          Iclave = Iclave + 1;
     |SIGUE;

     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nPosi = (nCompo * 300) + 103;
          aAlfa1 = aClaves % nPosi;
          clave = aAlfa1;
          Iclave = Iclave + 1;
     |SIGUE;

     aClave = "";
     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nNumCam = clave;
          Iclave = Iclave + 1;
          aAlfa2 = #Referen@#nNumCam#;

          aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "TIPO";
          aAlfa      = #Referen@#aQueQuiero#;
          |SI aAlfa = "N";
              aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "LONGITUD";
              aAlfa      = #Referen@#aQueQuiero#;
              nLong      = aAlfa;
              nPos       = -(100 + nLong);
              aAlfa2     = (("0" * aAlfa) + aAlfa2) % nPos;
          |FINSI;

          aClave = aClave + aAlfa2;
     |SIGUE;

     ||aMensaje = "0000Clave: " + aClave;

     aAlfa = (aClave + "                                                                                                    ") % 199;
     aClave = aAlfa;
     aAlfa = (aClave + "                                                                                                    ") % 10001;
     aClave = aClave + aAlfa;

     ||Tengo que a¤adir antes .. el nombre de la aplicacion y numero de empresa
     |NOMAP aAplica;
     |QBF aAplica
     aAplica = (aAplica + "        ") % 108;

     nEmpresa = #48#0;
     aEmpresa = ("00000" + nEmpresa) % -105;

     aParametro = aAplica + aEmpresa + aFichRel + aClave + aPathDef + "@" + aPathFic;
     aAlfa      = ":dserp/dserpm08;" + aParametro;

     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO ControlGrid; |TIPO 77;
     nSalida = FSalida;
     |SI nSalida ! 4;  |ACABA;  |FINSI;

     aCliente = #Fichero@#0;

     |DBASS aFicERP;
     |QBF aFicERP;
     aDSERP = aFicERP + "dserp/def/dserpm01.mas";
     |XABRE "E", aDSERP, 0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nCampo = Campo;

     |DBASE aBase;                      |QBF aBase;
     aPathDef = aBase + "def/";
     aQueQuiero = "|DEF";
     aNomDef = #Fichero@#aQueQuiero#;   |QBF aNomDef;
     aNomDef = aNomDef - aPathDef;      |QBF aNomDef;
     aNomDef = (aNomDef + "        ") % 108;
     |MODULO aPrograma;                 |QBF aPrograma;
     |DFICE aPathFic;                   |QBF aPathFic;

     |SI nSwSaltaRel = 0;
         aAlfa5 = "|NR"; aAlfa5 = #Fichero@#aAlfa5#;
         nNumRels = aAlfa5; nNumRels = nNumRels - 1;
         |PARA nCont = 0; |SI nCont [ nNumRels; |HACIENDO nCont = nCont + 1;
               aAlfa5 = "|R" + (("000" + nCont) % -103);
               aAlfa5 = #Fichero@#aAlfa5#;
               aAlfa5 = aAlfa5 - "|";
               |SI FSalida ! 0;
                   nCalc = ((FSalida / 100) ! 0) + 99;
                   aFichRel = aAlfa5 % nCalc;
                   nCalc = FSalida + 98;
                   aAlfa5 = aAlfa5 % nCalc; aAlfa5 = aAlfa5 % 0499; aRels = aAlfa5;
                   |PARA; |SI aAlfa5 ! ""; |HACIENDO;
                        aAlfa6 = aAlfa5 % 0103; aAlfa5 = aAlfa5 % 0499;
                        nCalc = aAlfa6; nCalc = nCalc - 1;
                        |SI nCalc = nCampo; |SAL; |FINSI;
                   |SIGUE;
                   |SI nCalc = nCampo; |SAL; |FINSI;
                |FINSI;
         |SIGUE;

         |SI nCalc = nCampo;
             aAlfa5 = aPathDef + aAlfa5; |QBF aAlfa5;
             aAlfa5 = aAlfa5 + aFichRel + ".mas";
             |CARGA_DEF aAlfa5, Referen@;
             |SI FSalida = 0;
                 |ENLAZA_PROCESO #Referen@#0,ControlGrid,77;
                 |PATH_DAT #1000 aPathFic;
                 |ABRE #Referen@;  aAlfa5 = "|K000";
                 aAlfa5 = #Referen@#aAlfa5#; aAlfa5 = aAlfa5 % 0499;

                 |PARA; |SI aAlfa5 ! ""; |HACIENDO;
                      aAlfa6 = aAlfa5 % 0103; aAlfa5 = aAlfa5 % 0499;
                      nCalc = aAlfa6;
                      aAlfa6 = aRels % 0103; aRels = aRels % 0499;
                      nCalc1 = aAlfa6; nCalc1 = nCalc1 - 1;
                      #Referen@#nCalc# = #Fichero@#nCalc1#;
                 |SIGUE;

                 |LEE 000#Referen@.];
                 |PUSHV 0501 2380;
                 |PINPA #0#Referen@; |PINDA #0#Referen@;
                 |PUSHV 0501 2380;
                 |HAZ Relacionado;
                 |POPV;
                 |POPV;
                 |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
                 |ACABA;
             |SINO;
                 aAlfa5 = "    No encuentro el def a cargar. [" + aAlfa5 + "," + FSalida + "]";
                 |MENAV aAlfa5;
             |FINSI;
         |FINSI;
     |FINSI;

     nSwSaltaRel = 1;

     aAlfa5 = "|K000";
     aClaves = #Fichero@#aAlfa5#;
     aTCompo = aClaves % 103;
     nTCompo = aTCompo;
     Iclave = clave1<-;
     |PARA nCampo = 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
           clave = 0;
           Iclave = Iclave + 1;
     |SIGUE;

     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nPosi = (nCompo * 300) + 103;
          aAlfa1 = aClaves % nPosi;
          clave = aAlfa1;
          Iclave = Iclave + 1;
     |SIGUE;

     aClave = "";
     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nNumCam = clave;
          Iclave = Iclave + 1;
          aAlfa2 = #Fichero@#nNumCam#;

          aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "TIPO";
          aAlfa      = #Fichero@#aQueQuiero#;
          |SI aAlfa = "N";
              aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "LONGITUD";
              aAlfa      = #Fichero@#aQueQuiero#;
              nLong      = aAlfa;
              nPos       = -(100 + nLong);
              aAlfa2     = (("0" * aAlfa) + aAlfa2) % nPos;
          |FINSI;

          aClave = aClave + aAlfa2;
     |SIGUE;

     ||aMensaje = "0000Clave: " + aClave;

     aAlfa = (aClave + "                                                                                                    ") % 199;
     aClave = aAlfa;
     aAlfa = (aClave + "                                                                                                    ") % 10001;
     aClave = aClave + aAlfa;

     ||Tengo que a¤adir antes .. el nombre de la aplicacion y numero de empresa
     |NOMAP aAplica;
     |QBF aAplica
     aAplica = (aAplica + "        ") % 108;

     |DFICE aEmpresa;
     aEmpresa = aEmpresa % -106;
     aEmpresa = aEmpresa % 105;
     nEmpresa = aEmpresa;
     aEmpresa = ("00000" + nEmpresa) % -105;

     aParametro = aAplica + aEmpresa + aNomDef + aClave + aPathDef + "@" + aPathFic;

     |SI aVersion = "9";
          aAlfa      = ":dserp/dserpm08;" + aParametro;
     |SINO;
          |DBASE aBase;
          |QBF aBase;
          aBase = aBase + "tmp/";
          |MKDIR aBase;
          aParaLee = aBase + Usuario + ".txt";
          |XABRE "W", aParaLee, nHandle;
          |SI FSalida ] 0;
               aLinea = aParametro;
               |XGRABA nHandle, aLinea;
          |FINSI;
          |XCIERRA nHandle;

          aParametro = "LEE" + aParaLee;
          aAlfa      = ":dserp/dserpx08;" + aParametro;
     |FINSI;
     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO &EVENTOGRID;
     |SI Campo = -1;
          nSwSaltaRel = 1;
     |SINO;
          nSwSaltaRel = 0;
     |FINSI;

     aSalida = FSalida;
     |QBF aSalida;

     |VERSIONRTME aVersion;
     |QBF aVersion;

     aAux = aVersion % 101;
     aVersion = aAux;
     |SI aVersion = "9";
          aMensaje = "0000Estoy en DIAGRAM9";

          |SI aSalida = "1771";
               aMensaje = "0000Esta opcion solo funciona estando dentro del campo. Codigo 1771";
               |MENAV aMensaje;
          |SINO;
               aSalida = aSalida % 104;
               |SI aSalida = "1771";
                    FSalida = 4;
                    |HAZ ControlGrid;
               |FINSI;
          |FINSI;
     |SINO;
          ||Version DiagramX.
          |SI aSalida = "1771";
               FSalida = 4;
               |HAZ ControlGrid;
          |SINO;
               aSalida = aSalida % 104;
               |SI aSalida = "1771";
                    FSalida = 4;
                    |HAZ ControlGrid;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO Encriptado;
   eaSalida = "";
   aAlfaPLB = eaEntrada; |QBF aAlfaPLB;
   aAlfaPLB = aAlfaPLB % 0; nNumChar = aAlfaPLB;
   |PARA nContPLB = 1; |SI nContPLB [ nNumChar; |HACIENDO nContPLB = nContPLB + 1;
      nCalcPLB = (nContPLB * 100) + 1; aAlfaPLB = eaEntrada % nCalcPLB;
      nCalcPLB = &aAlfaPLB;
      |SI nCalcPLB > 79;
         nCalcPLB = 79 - (nCalcPLB - 79);
      |SINO;
         nCalcPLB = 79 + (79 - nCalcPLB);
      |FINSI;
      eaSalida = eaSalida + &nCalcPLB;
   |SIGUE;
|FPRC;

|PROCESO MiraSiBloq;
   |ABRE #dscam051; |LEE 000#dscam051.p; |CIERRA #dscam051;

   |SI #dscam051#96 = "S";
      enSwErr = 1;
      |ABRE #dscam104;
      #dscam104#0 = eaCodigo;
      #dscam104#1 = "";
      |LEE 000#dscam104.];
      |SI FSalida = 0; |Y #dscam104#0 = eaCodigo; |Y eaCodigo ! "      ";
         |SI #dscam104#3 = "S";
            nCalc = 1/1000000;     || un a¤o
            fFecha1 = #dscam104#4;
            fFecha1 = fFecha1 + nCalc;
            fFecha2 = ~;
            |SI fFecha1 ] fFecha2;
               enSwErr = 0;
            |FINSI;
         |SINO;
            enSwErr = 0;
         |FINSI;
      |SINO;
         |SELECT #2#dscam104;
         #dscam104#0 = "";
         #dscam104#1 = eaCuenta
         |LEE 000#dscam104.];
         |SI FSalida = 0; |Y #dscam104#1 = eaCuenta
            |SI #dscam104#3 = "S";
               nCalc = 1/1000000;
               fFecha1 = #dscam104#4; fFecha1 = fFecha1 + nCalc;
               fFecha2 = ~;
               |SI fFecha1 ] fFecha2; enSwErr = 0; |FINSI;
            |SINO;
               enSwErr = 0;
            |FINSI;
         |FINSI;
         |SELECT #1#dscam104;
      |FINSI;
      |CIERRA #dscam104;
   |SINO;
      enSwErr = 0;
   |FINSI;
|FPRC;

|PROCESO BotonUsuarios;
   aAlfa = "dscaz157.tab;" + eaClvUsuarios + ",MTOUSU";
   |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO MiraEstado;
   ||ABRE #dscam004;
   |SELECT #4#dscam004;
   #dscam004#17 = #RefRecs@#40;
   #dscam004#5  = "IMP";
   |LEE 000#dscam004.=;
   |SI FSalida = 0;
      aAlfa = "I";
   |SINO;
      aAlfa = "P";
   |FINSI;
   |SELECT #1#dscam004;
   ||CIERRA #dscam004;
|FPRC;

|PROCESO ProcesaAgrup;
   nImpAnt = 0;
   |SALVA_FICHA #RefRecs@; nDocAgrup = #RefRecs@#40;
   |SELECT #13#RefRecs@;
   #RefRecs@#41 = nDocAgrup;
   #RefRecs@#40 = 1;
   |LEE 000#RefRecs@.];
   |PARA; |SI FSalida = 0; |Y #RefRecs@#41 = nDocAgrup; |HACIENDO;
      nDocumento = #RefRecs@#40; |HAZ BuscaOrigen;
      |SELECT #13#RefRecs@;
      |LEE 000#RefRecs@.=; nDocAgrup = #RefRecs@#41;
      |SI aEstado = "I"; nImpAgr = nImpAgr + nImpImp; |FINSI;
      |LEE 000#RefRecs@.s;
   |SIGUE;
   |REPON_FICHA #RefRecs@; nDocAgrup = #RefRecs@#40;
   nDocumento = #RefRecs@#40;
|FPRC;

|PROCESO BuscaOrigen;
   |SALVA_FICHA #RefRecs@;
   |SELECT #1#RefRecs@;
   #RefRecs@#40 = nDocumento;
   |LEE 000#RefRecs@.=;
   |SI FSalida = 0;
      #RefDocu@#0 = #RefRecs@#40;
      #RefDocu@#1 = nDocAnt;
      |LEE 000#RefDocu@.=;
      |SI FSalida ! 0;
         |DDEFECTO #RefDocu@;
         #RefDocu@#0 = #RefRecs@#40;
         #RefDocu@#1 = nDocAnt;
         aAlfa = ""; |HAZ MiraEstado;
         #RefDocu@#2 = aAlfa;
         #RefDocu@#3 = nImpAnt;
         |SI #RefDocu@#3 = 0;
            #RefDocu@#3 = #RefRecs@#31;
            |SI #RefDocu@#3 = 0; |Y nPrimero = 1;
               #RefDocu@#3 = #RefRecs@#30;
            |FINSI;
         |FINSI;
         |SI #RefRecs@#49 ! "S"; |Y #RefRecs@#83 = 0; #RefDocu@#4 = "S"; |FINSI;
         #RefDocu@#5 = #RefRecs@#31;
         |SI #RefDocu@#5 = 0; |Y nPrimero = 1;
            #RefDocu@#5 = #RefRecs@#30;
         |FINSI;
         |SI #RefDocu@#2 = "I"; #RefDocu@#6 = 100; |FINSI;
         |GRABA 020#RefDocu@.c;
      |FINSI;
      nPrimero = 0;

      |SI #RefDocu@#2 ! "I";
         aEstado = "";
         InDocAnt = InDocAnt + 1; nDocAnt = #RefRecs@#40;
         InImpAnt = InImpAnt + 1; nImpAnt = #RefRecs@#22;
         InImpAgr = InImpAgr + 1; nImpAgr = 0;

         |SI #RefRecs@#49 = "S";
            |HAZ ProcesaAgrup;
            nDocAnt = 0; nImpAnt = 0;
            InDocAnt = InDocAnt - 1; InImpAnt = InImpAnt - 1;
            |SI nImpAgr ! 0;
               #RefDocu@#0 = #RefRecs@#40;
               #RefDocu@#1 = nDocAnt;
               |LEE 000#RefDocu@.=;
               |SI FSalida = 0;
                  aEstado = "I";
                  #RefDocu@#2 = "I";
                  nCalc = (nImpAgr * 100) / #RefDocu@#5; nPorcImp = nCalc;
                  #RefDocu@#6 = nCalc;
                  |GRABA 020#RefDocu@.a;
               |FINSI;
               nImpImp = nImpAgr;
            |FINSI;
            InImpAgr = InImpAgr - 1;
         |FINSI;
         |SI #RefRecs@#83 ! 0;
            nDocumento = #RefRecs@#83; |HAZ BuscaOrigen;
            nDocAnt = 0; nImpAnt = 0;
            InDocAnt = InDocAnt - 1; InImpAnt = InImpAnt - 1;
            InImpAgr = InImpAgr - 1;
            |SI aEstado = "I";
               #RefDocu@#0 = #RefRecs@#40;
               #RefDocu@#1 = nDocAnt;
               |LEE 000#RefDocu@.=;
               |SI FSalida = 0;
                  #RefDocu@#2 = "I";
                  nCalc = nPorcImp / 100;
                  nCalc = nImpImp / nCalc;
                  nCalc = (nImpImp * #RefDocu@#3) / nCalc;
                  nCalc = (nCalc * 100) / #RefDocu@#3;
||                  nCalc = (#RefDocu@#3 * 100) / nImpImp;
                  #RefDocu@#6 = nCalc;
                  |GRABA 020#RefDocu@.a;
                  nImpImp = #RefDocu@#3 % #RefDocu@#6;
               |FINSI;
            |FINSI;
         |FINSI;
         |SI #RefRecs@#49 ! "S"; |Y #RefRecs@#83 = 0;
            nDocAnt = 0; nImpAnt = 0;
            InDocAnt = InDocAnt - 1; InImpAnt = InImpAnt - 1;
            InImpAgr = InImpAgr - 1;
         |FINSI;
      |SINO;
         ||aEstado = "I"; nImpImp = #RefRecs@#31; nPorcImp = #RefDocu@#6;
         aEstado = "I"; nPorcImp = #RefDocu@#6; nImpImp = #RefRecs@#31 % nPorcImp;
      |FINSI;
   |FINSI;
   |REPON_FICHA #RefRecs@;
   |SELECT #1#RefRecs@;
   |LEE 000#RefRecs@.=;

|FPRC;

|PROCESO RevisaDatosRiesgo;
   |SI enDocRiesgo ! 0;
      |SALVA_FICHA #dscam004;
      |DDEF aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "dscaw120.mas";
      |CARGA_DEF aAlfa, RefDocu@;
      |SI FSalida = 0;
         |DDEF aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "dscam003.mas";
         |CARGA_DEF aAlfa, RefRecs@;

         aAlfa = "tr" + Usuario;   |NOME_DAT #RefDocu@#aAlfa#;
         |DFICE aAlfa; |QBF aAlfa;
         |PATH_DAT #RefDocu@#aAlfa#; |PATH_DAT #RefRecs@#aAlfa#;
         |DELINDEX #RefDocu@; |ABRE #RefDocu@;

         InDocAnt = nDocAnt1<-; InImpAnt = nImpAnt1<-; InImpAgr = nImpAgr1<-;

         |ABRE #RefRecs@;
         #RefRecs@#40 = enDocRiesgo;
         |LEE 000#RefRecs@.=;
         |SI FSalida = 0;
            || Obtengo informacion de los recibos que estan implicados en la
            ||    obtencion del que nos interesa y me guardo sus importes y
            ||    sus estados a la hora de dividirlos/agruparlos

            nEvalua = 0; nPrimero = 1;
            |SI #RefRecs@#49 = "S";
               InDocAnt = InDocAnt + 1; nDocAnt = #RefRecs@#40;
               InImpAnt = InImpAnt + 1; nImpAnt = #RefRecs@#22;
               InImpAgr = InImpAgr + 1; nImpAgr = 0;

               |DDEFECTO #RefDocu@;
               #RefDocu@#0 = #RefRecs@#40;
               #RefDocu@#1 = 0;
               aAlfa = ""; |HAZ MiraEstado;
               #RefDocu@#2 = aAlfa;
               #RefDocu@#3 = nImpAnt;
               |SI #RefDocu@#3 = 0;
                  #RefDocu@#3 = #RefRecs@#31;
                  |SI #RefDocu@#3 = 0; |Y nPrimero = 1;
                      #RefDocu@#3 = #RefRecs@#30;
                  |FINSI;
               |FINSI;
               |SI #RefRecs@#49 ! "S"; |Y #RefRecs@#83 = 0; #RefDocu@#4 = "S"; |FINSI;
               #RefDocu@#5 = #RefRecs@#31;
               |SI #RefDocu@#5 = 0; |Y nPrimero = 1;
                  #RefDocu@#5 = #RefRecs@#30;
               |FINSI;
               |SI #RefDocu@#2 = "I"; #RefDocu@#6 = 100; |FINSI;
               |GRABA 020#RefDocu@.c;
               nPrimero = 0;

               |HAZ ProcesaAgrup;
               nDocAnt = 0; nImpAnt = 0;
               |SI nImpAgr ! 0;
                  #RefDocu@#0 = #RefRecs@#40;
                  #RefDocu@#1 = nDocAnt;
                  |LEE 000#RefDocu@.=;
                  |SI FSalida = 0;
                     aEstado = "I";
                     #RefDocu@#2 = "I";
                     nCalc = (nImpAgr * 100) / #RefDocu@#5; nPorcImp = nCalc;
                     #RefDocu@#6 = nCalc;
                     |GRABA 020#RefDocu@.a;
                  |FINSI;
                  nImpImp = nImpAgr;
               |FINSI;
            |FINSI;
            |SI #RefRecs@#83 ! 0;
               nDocumento = #RefRecs@#40; |HAZ BuscaOrigen;
            |FINSI;

            || Ahora tengo en el fichero temporal los recibos implicados en la
            ||    obtencion del que necesitamos. Ahora no tenemos mas que leer
            ||    el que nos ocupa y aplicar el coeficiente a la cantidad que
            ||    vamos a incluir en el riesgo.
            ||    De esta forma obtenemos el importe a eliminar del riesgo de
            ||    impagados y el resto del riesgo de facturas.

            enRiesgoImp = 0;
            |SELECT #1#RefRecs@;
            #RefDocu@#0 = enDocRiesgo;
            #RefDocu@#1 = 0;
            |LEE 000#RefDocu@.=;
            |SI FSalida = 0;
               nCalc = #RefDocu@#3 % #RefDocu@#6;
               enRiesgoImp = nCalc ! 2;
            |FINSI;

            |CIERRA #RefDocu@; |DELINDEX #RefDocu@;
         |FINSI;
         |CIERRA #RefRecs@; |DESCARGA_DEF #RefRecs@;
         |DESCARGA_DEF #RefDocu@;
      |FINSI;
      |REPON_FICHA #dscam004;
   |FINSI;
|FPRC;

|PROCESO LineasRec;
   nTotalGtosND = nTotalGtosND + #dscam004#12;
   nTotalGtosDD = nTotalGtosDD + #dscam004#13;
   nTotalGtosOD = nTotalGtosOD + #dscam004#14;
   nTotalGtosNB = nTotalGtosNB + #dscam004#29;
   nTotalGtosDB = nTotalGtosDB + #dscam004#30;
   nTotalGtosOB = nTotalGtosOB + #dscam004#31;
|FPRC;

|DEFBUCLE LineasRec;
#dscam004#1;
;
#dscam003#40, 01;
#dscam003#40, 99;
;
NULL, LineasRec;
|FIN;

|PROCESO ComprTotVta;
   |HAZ EsLuxe;
   |SI FSalida = 0; |ACABA; |FINSI;

   |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "C"; |Y #dscam003#14 ! "I"; |ACABA; |FINSI;
   Divisa = #dscam003#57; |HAZ TomaDecim;

   |DDEF aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "dscam003.mas";
   |CARGA_DEF aAlfa, RefRecs@;
   |SI FSalida = 0;
      |DFICE aAlfa; |QBF aAlfa; |PATH_DAT #RefRecs@#aAlfa#;
      |ABRE #RefRecs@;
      #RefRecs@#40 = #dscam003#40;
      |LEE 000#RefRecs@.=;
      |SI FSalida = 0;
         nTotalGtosND = 0;
         nTotalGtosDD = 0;
         nTotalGtosOD = 0;

         nTotalGtosNB = 0;
         nTotalGtosDB = 0;
         nTotalGtosOB = 0;

         |SALVA_FICHA #dscam004;
         |BUCLE LineasRec;
         |REPON_FICHA #dscam004;

         #RefRecs@#40 = #dscam003#40;
         |LEE 101#RefRecs@.=;
         |SI FSalida = 0;
            |SI #RefRecs@#24 ! nTotalGtosND; #RefRecs@#24 = nTotalGtosND; |FINSI;
            |SI #RefRecs@#25 ! nTotalGtosDD; #RefRecs@#25 = nTotalGtosDD; |FINSI;
            |SI #RefRecs@#38 ! nTotalGtosOD; #RefRecs@#38 = nTotalGtosOD; |FINSI;
            |SI #RefRecs@#62 ! nTotalGtosNB; #RefRecs@#62 = nTotalGtosNB; |FINSI;
            |SI #RefRecs@#63 ! nTotalGtosDB; #RefRecs@#63 = nTotalGtosDB; |FINSI;
            |SI #RefRecs@#66 ! nTotalGtosOB; #RefRecs@#66 = nTotalGtosOB; |FINSI;
            #RefRecs@#30 = #RefRecs@#22 + #RefRecs@#24 + #RefRecs@#25 + #RefRecs@#38;
            #RefRecs@#30 = #RefRecs@#30 - (#RefRecs@#54 + #RefRecs@#55);
            #RefRecs@#64 = #RefRecs@#60 + #RefRecs@#62 + #RefRecs@#63 + #RefRecs@#66 + #RefRecs@#56;
            #RefRecs@#64 = #RefRecs@#64 - (#RefRecs@#67 + #RefRecs@#68);
            #RefRecs@#31 = #RefRecs@#30 - #RefRecs@#23; #RefRecs@#65 = #RefRecs@#64 - #RefRecs@#61;
            |GRABA 020#RefRecs@.a; |LIBERA #RefRecs@;
         |FINSI;
      |FINSI;
      |DESCARGA_DEF #RefRecs@;
   |FINSI;
|FPRC;

|PROCESO MiraCertContr;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0; |DDEFECTO #dscam051; |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#121 = "N"; |ACABA; |FINSI;

   eaTipoCod = "P"; eaCodigo = eaCliente; aCuenta = eaCuenta; |HAZ LeeDatos;

   |DBASS aAlfaPLB; |QBF aAlfaPLB;
   aAlfaPLB = aAlfaPLB + "basica/def/tadm0001.mas";
   |CARGA_DEF aAlfaPLB, RefPLB0@;
   |SI FSalida = 0;
      |DBASS aAlfaPLB; |QBF aAlfaPLB;
      aAlfaPLB = aAlfaPLB + "basica/fich/";
      |PATH_DAT #RefPLB0@#aAlfaPLB#;
      |ABRE #RefPLB0@;
      #RefPLB0@#0 = #48#0;
      #RefPLB0@#1 = eaNif;
      |LEE 000#RefPLB0@.=;
      |SI FSalida = 0;
         |SI #RefPLB0@#3 = "S";
            |SI #RefPLB0@#4 < efFechaVto;
               |SI enSwModo = 0;
                  |HAZ VentanaPregunta;
                  || aAlfaPLB = "    NUn vencimiento del proveedor [" + #RefPLB0@#1; |QBF aAlfaPLB;
                  || aAlfaPLB = aAlfaPLB + "]" + #RefPLB0@#2; |QBF aAlfaPLB;
                  || aAlfaPLB = aAlfaPLB + " supera el certificado. " + &191 + " Consultar registro ? ";
                  || aAlfaPLB = "    NUn vencimiento del proveedor supera el certificado. " + &191 + " Consultar registro ? ";
                  ||CONFI aAlfaPLB;
                  |SI FSalida = 0;
                     aAlfaPLB = "|:basica/tadz0001.tab;" + (("00000" + #48#0) % -105) + "," + #48#2; |QBF aAlfaPLB;
                     aAlfaPLB = aAlfaPLB + "," + #48#1; |QBF aAlfaPLB;
                     aAlfaPLB = aAlfaPLB + "|" + eaNif; |QBF aAlfaPLB;
                     |SUB_EJECUTA aAlfaPLB;
                  |FINSI;
               |SINO;
                  enSwModo = 0;
               |FINSI;
               |SI #dscam051#121 = "X"; |ERROR; enSwErr = 1; |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
      |CIERRA #RefPLB0@; |DESCARGA_DEF #RefPLB0@;
   |FINSI;
|FPRC;

|PROCESO VentanaPregunta;
   nPos1 = 1009; nPos2 = 1571;

   |PUSHV 0501 2380;
   nCalcPLB = (nPos1 * 10000) + nPos2;
   |BLANCO nCalcPLB; |CUADRO nCalcPLB;

   nCalcPLB = nPos1 + 1;
   |ATRI R; |PINTA nCalcPLB, " CERTIFICADO SUPERADO "; |ATRI N;

   aAlfaPLB = #RefPLB0@#2; |QBF aAlfaPLB; aAlfaPLB = aAlfaPLB % 0130;
   aAlfaPLB = " Un vencimiento del proveedor " + aAlfaPLB;
   nCalcPLB = nPos1 + 101;
   |PINTA nCalcPLB, aAlfaPLB;

   nCalcPLB = nPos1 + 201;
   aAlfaPLB = " [" + #RefPLB0@#1; |QBF aAlfaPLB;
   aAlfaPLB = aAlfaPLB + "] supera el certificado.";
   |PINTA nCalcPLB, aAlfaPLB;

   nCalcPLB = nPos2 - 131;
   aAlfaPLB = "¨ Consultar registro ? (S/N)";
   |PINTA nCalcPLB, aAlfaPLB;

   E_inf = ""; E_sup = 1;
   nCalcPLB = nPos2 - 102;
   aResp = nCalcPLB ? 1;

   |SI aResp = "S";
      FSalida = 0;
   |SINO;
      nCalcPLB = -1; FSalida = nCalcPLB;
   |FINSI;

   |POPV;
|FPRC;

||------------------------------------------------------------------
||     CHEQUEO DE MODULOS
||------------------------------------------------------------------

|PROCESO EsClipresal;
   aAlfa = #48#17; |QBF aAlfa;
   aAlfa1 = aAlfa + "def/clipr001.mas";
   |XABRE "E", aAlfa1, 0;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "bin/iber0001.tab";
      |XABRE "E", aAlfa1, 0;
      |SI FSalida = 0;
         FSalida = 1;
      |SINO;
         FSalida = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO EsAgrogenil;
     |DBASE aPath;
     aPath = aPath + "def/dscagm01.mas";
     |XABRE "E", aPath, 0;
|FPRC;

|PROCESO EsMalpesa;
     aPath = #48#17; |QBF aPath;
     aPath = aPath + "def/malpe001.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida = 0;
        |DBASE aPath; |QBF aPath;
        aPath = aPath + "def/dscaz112.mas";
        |XABRE "E", aPath, 0;
        |SI FSalida = 0;
           FSalida = 1;
        |SINO;
           FSalida = 0;
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO EsTaller;
     aPath = #48#17; |QBF aPath;
     aPath = aPath + "def/con00650.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida = 0;
        aPath = #48#17; |QBF aPath;
        aAlfa1 = aPath + "bin/iber0001.tab";
        |XABRE "E", aAlfa1, 0;
        |SI FSalida = 0;
           FSalida = 1;
        |SINO;
           FSalida = 0;
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO EsArimesa;
FSalida = 1; |ACABA;  || Tiquet 003218/01116

     |DBASE aPath; |QBF aPath;
     aPath = aPath + "def/dscaz112.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida = 0;
        aPath = #48#17; |QBF aPath;
        aPath = aPath + "def/malpe001.mas";
        |XABRE "E", aPath, 0;
        |SI FSalida = 0;
           FSalida = 1;
        |SINO;
           FSalida = 0;
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO EsTagloma;
   aAlfa = #48#17; |QBF aAlfa;
   aAlfa1 = aAlfa + "def/tagm0001.mas";
   |XABRE "E", aAlfa1, 0;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "bin/iber0001.tab";
      |XABRE "E", aAlfa1, 0;
      |SI FSalida = 0;
         FSalida = 1;
      |SINO;
         FSalida = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO EsPrimicias;
   |DDEF aAlfa; |QBF aAlfa;
   aAlfa1 = aAlfa + "dscaz980.mas";
   |XABRE "E", aAlfa1, 0;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "taglw001.mas";
      |XABRE "E", aAlfa1, 0;
      |SI FSalida = 0;
         FSalida = 1;
      |SINO;
         FSalida = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO EsLuxe;
   |DDEF aAlfa; |QBF aAlfa;
   aAlfa1 = aAlfa + "luxem001.mas";
   |XABRE "E", aAlfa1, 0;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "taglw001.mas";
      |XABRE "E", aAlfa1, 0;
      |SI FSalida = 0;
         FSalida = 1;
      |SINO;
         FSalida = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO EsForest;
   aPath = #48#17; |QBF aPath;
   aPath = aPath + "def/goma0004.mas";
   |XABRE "E", aPath, 0;
   |SI FSalida ] 0;
      aPath = #48#17; |QBF aPath;
      aPath = aPath + "bin/iber0001.tab";
      |XABRE "E", aPath, 0;
      |SI FSalida ] 0;
         FSalida = 1;
      |SINO;
         FSalida = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO EsVilamino;
   aAlfa = #48#16; |QBF aAlfa;
   aAlfa1 = aAlfa + "def/cavilm01.mas";
   |XABRE "E", aAlfa1, 0;
   |SI FSalida = 0;
      aAlfa = #48#17; |QBF aAlfa;
      aAlfa1 = aAlfa + "bin/iber0001.tab";
      |XABRE "E", aAlfa1, 0;
      |SI FSalida = 0;
         FSalida = 1;
      |SINO;
         FSalida = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO EsPCEG;
   |DBASS aAlfa; |QBF aAlfa;
   aAlfa1 = aAlfa + "dscomer9/def/pcegm001.mas";
   |XABRE "E", aAlfa1, 0;
   |SI FSalida = 0;
      |DBASS aAlfa; |QBF aAlfa;
      aAlfa1 = aAlfa + "dscomer9/bin/iber0001.tab";
      |XABRE "E", aAlfa1, 0;
      |SI FSalida = 0;
         FSalida = 1;
      |SINO;
         FSalida = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO EsDiagram;
     aPath = #48#17; |QBF aPath;
     aPath = aPath + "def/diam0001.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida ] 0;
         |DDEF aAlfa; |QBF aAlfa;
         aAlfa1 = aAlfa + "taglw001.mas";
         |XABRE "E", aAlfa1, 0;
         |SI FSalida = 0;
            FSalida = 1;
         |SINO;
            FSalida = 0;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO DimeCliPrevencion;
     enGrupoOTP  = 0;
     enPrevenzis = 0;
     enSinac     = 0;

     |DBASS aAlfa;
     aAlfa1 = aAlfa + "dspreven/dspreven.ini";

     |XABRE "", aAlfa1, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |PARA;  |SI;  |HACIENDO;
             |XLEE nHandle, 250, aCadena;
             |SI FSalida < 0;  |SAL;  |FINSI;

             |SI aCadena = "GrupoOTP";
                 enGrupoOTP = 1;
                 |SAL;
             |FINSI;

             |SI aCadena = "Sinac";
                 enSinac = 1;
                 |SAL;
             |FINSI;

             |SI aCadena = "Prevenzis";
                 enPrevenzis = 1;
                 |SAL;
             |FINSI;
     |SIGUE;

     |XCIERRA nHandle;
|FPRC;

|PROCESO EsOTP;
   aAlfa = #48#17; |QBF aAlfa;
   aAlfa1 = aAlfa + "def/otpw0001.mas";
   |XABRE "E", aAlfa1, 0;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "bin/iber0001.tab";
      |XABRE "E", aAlfa1, 0;
      |SI FSalida = 0;
         FSalida = 1;
      |SINO;
         FSalida = 0;
      |FINSI;
   |FINSI;

   |SI FSalida = 0;
       |HAZ DimeCliPrevencion;
   |FINSI;
|FPRC;

|PROCESO EsInforpor;
   |DBASS aAlfa; |QBF aAlfa;
   aAlfa1 = aAlfa + "dscomer9/def/infom000.mas";
   |XABRE "E", aAlfa, 0;
   |SI FSalida ] 0;
      aAlfa1 = aAlfa + "dscomer9/bin/iber0001.tab";
      |XABRE "E", aAlfa1, 0;
      |SI FSalida = 0;
         FSalida = 1;
      |SINO;
         FSalida = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO EsViuda;
   |DDEF aAlfa; |QBF aAlfa;
   aAlfa1 = aAlfa + "dscam200.mas";
   |XABRE "E", aAlfa1, 0;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "taglw001.mas";
      |XABRE "E", aAlfa1, 0;
      |SI FSalida = 0;
         FSalida = 1;
      |SINO;
         FSalida = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO EsMOrts;
   |DDEF aAlfa; |QBF aAlfa;
   aAlfa1 = aAlfa + "dscam210.mas";
   |XABRE "E", aAlfa1, 0;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "taglw001.mas";
      |XABRE "E", aAlfa1, 0;
      |SI FSalida = 0;
         FSalida = 1;
      |SINO;
         FSalida = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO EsArtenvas;     || 0c0160
   |DDEF aAlfa; |QBF aAlfa;
   aAlfa1 = aAlfa + "dscam213.mas";
   |XABRE "E", aAlfa1, 0;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "taglw001.mas";
      |XABRE "E", aAlfa1, 0;
      |SI FSalida = 0;
         FSalida = 1;
      |SINO;
         FSalida = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO AltaCtaCartera;
     |DBASS aAlfa;
     aAlfa = aAlfa + "contagen/def/dsz00001.mas";
     |XABRE "E", aAlfa, 0;
     |SI FSalida ! 0;
          |MENAV "    Cuenta de cliente inexistente en ficha de clientes/proveedores";
     |SINO;
          |DFICE aAlfa;
          aAlfa = aAlfa % -205;
          |ABRE #dscam000;
          #dscam000#0 = aAlfa;
          |LEE 000#dscam000.=;
          |CIERRA #dscam000;

          aEmp = ("00000" + #dscam000#14) % -105;
          aPeri = #dscam000#19;
          aParam = #caclipr@#23 + #caclipr@#11 + #caclipr@#10;

          aAlfa = ":contagen/dsz00001 canempr1 " + aEmp + aPeri + ";" + aParam;
          |SUB_EJECUTA_NP aAlfa;
     |FINSI;
|FPRC;

|PROCESO QuitaRarosExp;
     |QBF eaAlfa;
     aAlfa = eaAlfa;
     aLon = aAlfa % A0;
     aDato = "";
     |PARA i = 0; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = (i + 1) * 100 + 1;
          aCar = aAlfa % nPos;
          |SI aCar = "¥"; aCar = &209; |FINSI;
          |SI aCar = "¤"; aCar = &241; |FINSI;
          |SI aCar = " "; aCar = &225; |FINSI;
          |SI aCar = ""; aCar = &233; |FINSI;
          |SI aCar = "¡"; aCar = &237; |FINSI;
          |SI aCar = "¢"; aCar = &243; |FINSI;
          |SI aCar = "£"; aCar = &250; |FINSI;
          |SI aCar = "§"; aCar = &176; |FINSI;
          |SI aCar = "¦"; aCar = &170; |FINSI;
          |SI aCar = "°"; aCar = &176; |FINSI;  ||Euro
          aDato = aDato + aCar;
     |SIGUE;
     eaAlfa = aDato;
|FPRC;
