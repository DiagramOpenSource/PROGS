|FICHEROS;
   dscaz085 #0;

   dscam081 #10;
   dscam082 #11;
   dscam030 #12;
   dscam003 #13;
   dscam004 #14;
   dscaw013 #17;
   dscaw001 #18,MANTE;
   dscam051 #20;

   &cacuent@ #492;
|FIN;

|VARIABLES;
   &eaTipo   = 1;
   &enRemesa = 1;
   &aCuenta = ""; &nNivel = 0; &HayConta = 0; &MaxDigit = 0;
   &Divisa  = ""; &nDeci_Div = 0; &nDeci_Base = 0;
   &CambioBaseVn = 0; &eaModulo = ""; &eaSesion = "";
   &eaFichClas = "";  &eaTipoClas = ""; &enSwClas = 0;
   &TotalSel = 0;
   &enSwLineal = 0; &enClave = 0;
   &eaTOperacion = ""; &enNumDocum   = 0; &efFechaExt = @;

   aMarca   = "";
   aAlfa    = "";
   aAlfa1   = "";
   aParte1  = "";
   aParte2  = "";
   aLong    = "";
   Comodin  = "";

   FEstado   = 0;
   Linea     = 1;
   nLong     = 0;
   LinCob    = 0;
   nTecla    = 0;
   nCalc     = 0;
   nHayCtas  = 0;
   nNumSec   = 0;
   nSwCambia = 0;
|FIN;

|PROCESO ConsCtas; |TIPO 6;
   nTecla = FSalida;
   |SI HayConta = 1; ||Y #dscaz085#6 ! "    ";
      |SI nTecla = 10;
         #cacuent@#0 = #dscaz085#7;
         |LEE 000#cacuent@.];
         |CONSULTA_CLAVE #1#cacuent@;
         |SI FSalida = 0;
            #dscaz085#7 = #cacuent@#0; |PINTA #dscaz085#0;
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;
      aCuenta = #dscaz085#7;
      aCuenta = aCuenta - ".";
      |PARA; |SI FSalida ! 0; |HACIENDO;
         nCalc = ((FSalida / 100) ! 0) + 99; aParte1 = aCuenta % nCalc; |QBF aParte1;
         nCalc = FSalida + 98;               aParte2 = aCuenta % nCalc; |QBF aParte2;
         aCuenta = aParte1 + aParte2; |QBF aCuenta;
         aLong = aCuenta % 0; nLong = aLong;
         nCalc = MaxDigit - nLong;
         aCuenta = aParte1 + ("0" * nCalc) + aParte2;
         aCuenta = aCuenta - ".";
      |SIGUE;
      #dscaz085#7 = aCuenta; |PINTA #dscaz085#7;
      #cacuent@#0 = #dscaz085#7;
      aCuenta = #dscaz085#7; |HAZ SacaNivel;
      #cacuent@#1 = nNivel;
      |LEE 000#cacuent@.=;
      |SI FSalida = 0;
         |PINTA 1735, #cacuent@#2;
      |SINO;
         |MENAV "    Cuenta inexistente"; |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO MiraParam; |TIPO 7;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#1 = "S";
      Comodin = #dscam051#61;
      |C_M #dscaz085#6,1,Comodin;
   |SINO;
      |C_M #dscaz085#6,1,"N";
   |FINSI;
|FPRC;

|PROCESO Documentos;
   |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "C";
    |Y #dscam003#14 ! "I"; |Y #dscam003#14 ! "V"; |ACABA; |FINSI;

   |SI #dscam003#14 = "I"; |Y #dscaz085#9 = "N"; |ACABA; |FINSI;

   ||SI #dscam051#101 = "N";
      |SI #dscam003#30 < 0; |ACABA; |FINSI;
   ||FINSI;

   |SI #dscam051#47 = "S";
      enSwClas   = 1; eaFichClas = "dscaz085"; eaTipoClas = #dscam003#12;
      |HAZ CompruebaClas;
      |SI eaFichClas = "ERROR"; |ACABA; |FINSI;
   |FINSI;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   |DDEFECTO #dscaw001;
   #dscaw001#0 = Linea;
   Linea = Linea + 1;
   #dscaw001#1 = #dscam003#27;
   #dscaw001#2 = #dscam003#0;
   #dscaw001#3 = #dscam003#1;
   #dscaw001#4 = #dscam003#2;
   #dscaw001#5 = #dscam003#3;
   #dscaw001#6 = #dscam003#65;
   |SI aMarca = "*";
      |SI eaFichClas = "INFOR";
         #dscaw001#7 = " ";
      |SINO;
         #dscaw001#7 = aMarca;
         TotalSel = TotalSel + #dscaw001#6;
      |FINSI;
   |SINO;
      #dscaw001#7 = aMarca;
   |FINSI;
   #dscaw001#8 = #dscam003#40;
   #dscaw001#9 = #dscam003#57;
   #dscaw001#10 = #dscam003#5;
   #dscaw001#11 = #dscam003#32;
   #dscaw001#12 = #dscam003#6;
   #dscaw001#13 = #dscam003#14;
   #dscaw001#14 = #dscam003#35;
   #dscaw001#15 = #dscam003#36;
   |GRABA 010#dscaw001.n;
|FPRC;

|DEFBUCLE Documentos;
#dscam003#11;
4,5,90;
#dscaz085#0,#dscaz085#2,"   ",#dscaz085#1,#dscaz085#10,"N";
#dscaz085#3,#dscaz085#5,"zzz",#dscaz085#4,#dscaz085#11,"N";
be;
NULL,Documentos;
|FIN;

|PROCESO VuelcaDocs;
   efFechaExt = #dscaz085#12;

   #dscam003#40 = #dscaw001#8; |LEE 000#dscam003.=;
   |SI FSalida ! 0;
      aAlfa = "    Problemas. No puedo encontrar el documento " + #dscam003#40;
      |MENSA aAlfa; |ACABA;
   |FINSI;

   |SI #dscam003#90 = "S"; |ACABA; |FINSI;

   |SI #dscam051#47 = "S";
      |SELECT #2#dscam082;
      #dscam082#1 = #dscam003#12;
      |LEE 000#dscam082.=;
      |SI FSalida ! 0; |DDEFECTO #dscam082; |FINSI;
      |SELECT #1#dscam082;
      |LEE 000#dscam082.=;
      |SI FSalida = 0;
         #dscam081#0 = #dscam082#0;
         |LEE 000#dscam081.=;
         |SI FSalida = 0;
            |SI #dscam081#2 = "R";
               Divisa = #dscam003#57; |HAZ TomaDecim;

               #dscam004#17 = #dscam003#40;
               #dscam004#3 = 99;
               |LEE 000#dscam004.];
               |SI FSalida ! 0;
                  |LEE 000#dscam004.u;
                  |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
                     LinCob = #dscam004#3 + 1;
                  |SINO;
                     LinCob = 1;
                  |FINSI;
               |SINO;
                  |SI #dscam004#17 = #dscam003#40;
                     LinCob = #dscam004#3 + 1;
                  |SINO;
                     |LEE 000#dscam004.a;
                     |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
                        LinCob = #dscam004#3 + 1;
                     |SINO;
                        LinCob = 1;
                     |FINSI;
                  |FINSI;
               |FINSI;
               |DDEFECTO #dscam004;
               #dscam004#0  = #dscam003#0;
               #dscam004#1  = #dscam003#1;
               #dscam004#2  = #dscam003#2;
               #dscam004#3  = LinCob;
               #dscam004#4  = #dscaz085#7;
               #dscam004#5  = "PRE";
               #dscam004#6  = #dscaz085#12;
               #dscam004#7  = #dscam003#23;
               #dscam004#8  = #dscam003#31;
               #dscam004#25 = #dscam003#61;
               #dscam004#26 = #dscam003#65;
               #dscam004#11 = #dscam003#13;
               #dscam004#15 = #dscam003#27;
               #dscam004#17 = #dscam003#40;
               #dscam004#33 = CambioBaseVn;
               #dscam004#43 = nNumSec;
               #dscam004#44 = #dscam003#31;
               #dscam004#45 = #dscam004#44 * #dscam004#33;
               #dscam004#46 = 0;
               #dscam004#47 = 0;
               |GRABA 020#dscam004.c;

               #dscam003#90 = "S"; |GRABA 020#dscam003.a;
            |FINSI;
         |FINSI;
      |FINSI;
   |SINO;
      Divisa = #dscam003#57; |HAZ TomaDecim;

      #dscam004#17 = #dscam003#40;
      #dscam004#3 = 99;
      |LEE 000#dscam004.];
      |SI FSalida ! 0;
         |LEE 000#dscam004.u;
         |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
            LinCob = #dscam004#3 + 1;
         |SINO;
            LinCob = 1;
         |FINSI;
      |SINO;
         |SI #dscam004#17 = #dscam003#40;
            LinCob = #dscam004#3 + 1;
         |SINO;
            |LEE 000#dscam004.a;
            |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
               LinCob = #dscam004#3 + 1;
            |SINO;
               LinCob = 1;
            |FINSI;
         |FINSI;
      |FINSI;

      |DDEFECTO #dscam004;
      #dscam004#0  = #dscam003#0;
      #dscam004#1  = #dscam003#1;
      #dscam004#2  = #dscam003#2;
      #dscam004#3  = LinCob;
      #dscam004#4  = #dscaz085#7;
      #dscam004#5  = "PRE";
      #dscam004#6  = #dscaz085#12;
      #dscam004#7  = #dscam003#23;
      #dscam004#8  = #dscam003#31;
      #dscam004#25 = #dscam003#61;
      #dscam004#26 = #dscam003#65;
      #dscam004#11 = #dscam003#13;
      #dscam004#15 = #dscam003#27;
      #dscam004#17 = #dscam003#40;
      #dscam004#33 = CambioBaseVn;
      #dscam004#43 = nNumSec;
      #dscam004#44 = #dscam003#31;
      #dscam004#45 = #dscam004#44 * #dscam004#33;
      #dscam004#46 = 0;
      #dscam004#47 = 0;
      |GRABA 020#dscam004.c;

      #dscam003#90 = "S"; |GRABA 020#dscam003.a;
   |FINSI;
   |SI HayConta = 1; |Y nNumSec = 0; |Y #dscaz085#6 ! "    ";
      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #17 Comodin;
      |DELINDEX #dscaw013; |ABRE #dscaw013;
      #dscaw013#15 = #dscaz085#6;  #dscaw013#0  = 1;
      #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
      #dscaw013#5 = #dscam003#40;  #dscaw013#6  = #dscam003#40;
      #dscaw013#11 = "N";          #dscaw013#12 = 9;
      |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
      #dscaw013#15 = #dscaz085#6;  #dscaw013#0  = 2;
      #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
      #dscaw013#3 = "PRE";         #dscaw013#4  = "PRE";
      #dscaw013#11 = "A";          #dscaw013#12 = 3;
      |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
      Comodin = #dscaz085#6; |QBF Comodin;
      Comodin = "dscam033.tab;" + Comodin;
      |CIERRAT #dscam003; |CIERRAT #dscam004;
      |SUB_EJECUTA_NP Comodin; |DELINDEX #dscaw013;
      |ABRET #dscam003; |ABRET #dscam004;
   |FINSI;
|FPRC;

|DEFBUCLE VuelcaDocs;
#dscaw001#1;
7;
00001,"*";
99999,"*";
;
NULL,VuelcaDocs;
|FIN;

|RUTINA inf001;
   #dscaw001#0 = 1;
   #dscaw001#10 = "";
   #dscaw001#11 = "";
|FRUT;

|RUTINA sup001;
   #dscaw001#0 = 99999;
   #dscaw001#10 = "zzzzzzzzzzzz";
   #dscaw001#11 = "zzzzzz";
|FRUT;

|RUTINA inf01a;
   #dscaw001#0 = 1;
   #dscaw001#10 = "";
   #dscaw001#11 = "";
|FRUT;

|RUTINA sup01a;
   #dscaw001#0 = 99999;
   #dscaw001#10 = "zzzzzzzzzzzz";
   #dscaw001#11 = "zzzzzz";
|FRUT;

|RUTINA inf01b;
   #dscaw001#0 = 1;
   #dscaw001#5 = "01.01.0000";
|FRUT;

|RUTINA sup01b;
   #dscaw001#0 = 99999;
   #dscaw001#5 = "31.12.9999";
|FRUT;

|PROCESO Desbloquea;
   eaTOperacion = "B"; enNumDocum = #dscaw001#8; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE Desbloquea;
#dscaw001#1;
;
INICIO;
FINAL;
;
NULL, Desbloquea;
|FIN;

|PROGRAMA;
   |HAZ Tipo8;

   |ABRE #dscam051;
   |LEE 000#dscam051.=;
   |SI FSalida = 0;
      |SI #dscam051#1 = "S";
         #dscaz085#6 = #dscam051#56;
         aAlfa = #dscam051#61; |QBF aAlfa;
         |C_M #dscaz085#6,1,aAlfa; |C_M #dscaz085#7, 1, aAlfa;
      |SINO;
         #dscaz085#6 = "    "; |C_M #dscaz085#6, 1, "N";
         aAlfa = #dscam051#61; |QBF aAlfa; |C_M #dscaz085#7,1, aAlfa;
      |FINSI;
   |FINSI;
   |CIERRA #dscam051;

   eaModulo = "dscaz085";

   |CLS;
   |CABEZA " Preparacion de documentos para remesar ";
   |PINPA #0#dscaz085; |PINDA #0#dscaz085;
   |ENDATOS #1#dscaz085;
   |SI FSalida = 0;
      |ABRE #dscam081; |ABRE #dscam082; |SELECT #2#dscam082;
      |ABRE #dscam004; |ABRE #dscam003; |ABRE #dscam030;
      aAlfa = "tm" + Usuario; |NOME_DAT #18 aAlfa;
      |DELINDEX #dscaw001; |ABRE #dscaw001;

      #dscam030#0 = #dscaz085#6;
      |LEE 000#dscam030.=;
      |SI FSalida ! 0; |DDEFECTO #dscam030; |FINSI;
      |SI #dscam030#8 = "S";
         |SELECT #3#dscam004;
         |LEE 000#dscam004.u;
         |SI nNumSec [ #dscam004#43;
            nNumSec = #dscam004#43 + 1;
         |SINO;
            nNumSec = nNumSec + 1;
         |FINSI;
         |SELECT #1#dscam004;
      |SINO;
         nNumSec = 0;
      |FINSI;

      |CONFI "    NMarcar todos los registros ?";
      |SI FSalida = 0;
         aMarca = "*";
      |SINO;
         aMarca = " ";
      |FINSI;
      |BUCLE Documentos;

      |PUSHV 05012380;
      enSwLineal = 1; enClave = 1;
      |PARA; |SI enSwLineal ! 0; |HACIENDO;
         |SI enClave = 1; enSwLineal = 0; |ENTLINEAL #2#dscaw001,-3,4,17,1,inf01a,sup01a; |FINSI;
         |SI enClave = 2; enSwLineal = 0; |ENTLINEAL #3#dscaw001,-2,4,17,1,inf01b,sup01b; |FINSI;
      |SIGUE;
      FEstado = FSalida;
      |POPV;
      |CONFI "    NConforme con el volcado de los datos ? ";
      |SI FSalida = 0;
         |BUCLE VuelcaDocs;
      |FINSI;
      |CIERRA #dscam003; |CIERRA #dscam004;

      |BUCLE Desbloquea;
      |CIERRA #dscaw001; |DELINDEX #dscaw001;

      |SI HayConta = 1; |Y nNumSec ! 0; |Y #dscaz085#6 ! "    ";
         || Esto lo hago para que para los enlaces por sesion se usen SIEMPRE
         ||   asientos definidos por sesion

         nSwCambia = 0;
         |ABRE #dscam030;
         #dscam030#0 = #dscaz085#6;
         |LEE 101#dscam030.=;
         |SI FSalida = 0;
            |SI #dscam030#8 = "N";
               nSwCambia = 1; #dscam030#8 = "S";
               |GRABA 020#dscam030.a; |LIBERA #dscam030;
            |FINSI;
         |FINSI;
         |CIERRA #dscam030;

         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #17 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         #dscaw013#15 = #dscaz085#6;  #dscaw013#0  = 1;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
         #dscaw013#5 = nNumSec;       #dscaw013#6  = nNumSec;
         #dscaw013#11 = "N";          #dscaw013#12 = 10;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         #dscaw013#15 = #dscaz085#6;  #dscaw013#0  = 2;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
         #dscaw013#3 = "PRE";         #dscaw013#4  = "PRE";
         #dscaw013#11 = "A";          #dscaw013#12 = 3;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         Comodin = #dscaz085#6; |QBF Comodin;
         Comodin = "dscam033.tab;" + Comodin;
         |SUB_EJECUTA_NP Comodin; |DELINDEX #dscaw013;

         |SI nSwCambia = 1;
            |ABRE #dscam030;
            #dscam030#0 = #dscaz085#6;
            |LEE 101#dscam030.=;
            |SI FSalida = 0;
               #dscam030#8 = "N";
               |GRABA 020#dscam030.a; |LIBERA #dscam030;
            |FINSI;
            |CIERRA #dscam030;
         |FINSI;
      |FINSI;
      |CIERRA #dscam030;
      |SELECT #1#dscam082; |ABRE #dscam082; |ABRE #dscam081;
   |FINSI;

   eaSesion   = Usuario; |HAZ LimpiaTempo;

   |HAZ Tipo9;
|FPRO;
