|FICHEROS;
   dscaz054 #0;

   dscam003 #1;
   dscam004 #2;

   dscam008 #3;
   dscam009 #4;

   dscam013 #5;
   dscam022 #6;
   dscam047 #7;
   dscam012 #8;
   dscam066 #9;

   agif133@ #100;
|FIN;

|VARIABLES;
   &Divisa = "";

   nRemesas  = 0;
   nNumCobro = 0;
   nPagares  = 0;
   nTalones  = 0;
   nNumPago  = 0;
   Total  = 0; nLin = 0; nCobro = 0; SwError = 0; LinCob = 0;

   nCobros = 0;
   nLins  = 0;
   Calc   = 0;
   nCalc  = 0;
   nCalc1 = 0;
   nCalc2 = 0;
   nImpDiv = 0; nImpBas = 0; nAgrupador = 0;
   aEntidad = ""; aAlfa = ""; Comodin = "";
   aNumero  = "";
   &nDeci_Base = 0;
   &nDeci_Div  = 0;
|FIN;

|PROCESO LinRecibos1;
   #dscam003#40 = #dscam004#17;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#72 ! "    ";
         nCalc = (#dscam003#78 - #dscam003#79) ! 2;
         nCalc2 = nCalc + 0.01; nCalc1 = nCalc - 0.01;
         |SI nCalc1 [ #dscam003#30; |Y #dscam003#30 [ nCalc2;
            |BORRA 020#dscam004.a; |LIBERA #dscam004;
         |SINO;
            nCalc = (#dscam003#78 / 166.386) ! 2;
            nCalc = #dscam003#78 - nCalc;
            |SI nCalc = #dscam003#30;
               |BORRA 020#dscam004.a; |LIBERA #dscam004;
            |SINO;
               nCalc = (#dscam003#78 - #dscam003#79) ! 2;
               nCalc = nCalc + #dscam003#64;
               |SI nCalc = #dscam003#30; |Y #dscam003#78 ! #dscam003#79;
                  |BORRA 020#dscam004.a; |LIBERA #dscam004;
               |SINO;
                  |SI #dscam003#57 = "EUR"; |Y #dscam003#47 = "S";
                     nCalc = #dscam003#78 ! 2;
                     nCalc1 = (nCalc - 0.5) ! 0;
                     nCalc1 = (nCalc - nCalc1) ! 2;
                     |SI nCalc1 = #dscam003#30;
                        |BORRA 020#dscam004.a; |LIBERA #dscam004;
                     |FINSI;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |SINO;
      |BORRA 020#dscam004.a; |LIBERA #dscam004;
   |FINSI;
|FPRC;

|DEFBUCLE LinRecibos1;
#dscam004#1;
;
INICIO;
FINAL;
be;
NULL,LinRecibos1;
|FIN;

|PROCESO LinRecibos2;
   #dscam003#40 = #dscam004#16;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#72 ! "    ";
         |SI #dscam003#78 ! #dscam003#79; |Y #dscam003#57 = "EUR";
            #dscam004#7 = #dscam004#25;
            #dscam004#8 = #dscam004#26;
            #dscam004#9 = #dscam004#27;
            |GRABA 020#dscam004.a; |LIBERA #dscam004;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE LinRecibos2;
#dscam004#1;
;
INICIO;
FINAL;
be;
NULL,LinRecibos2;
|FIN;

|PROCESO LinRecibos3;
   #dscam003#40 = #dscam004#16;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#72 ! "    ";
         nCalc = (#dscam003#64 /166.386) ! 2;
         |SI nCalc ! #dscam003#64;
            #dscam004#7 = #dscam004#25;
            #dscam004#8 = #dscam004#26;
            #dscam004#9 = #dscam004#27;
            |GRABA 020#dscam004.a; |LIBERA #dscam004;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE LinRecibos3;
#dscam004#1;
;
INICIO;
FINAL;
be;
NULL,LinRecibos3;
|FIN;

|PROCESO Agrupados;
   nImpDiv = nImpDiv + #dscam003#22;
   nImpBas = nImpBas + #dscam003#60;
|FPRC;

|DEFBUCLE Agrupados;
#dscam003#8;
;
000000001,nAgrupador;
999999999,nAgrupador;
be;
NULL,Agrupados;
|FIN;

|PROCESO LeeTalon;
   nImpDiv = nImpDiv + #dscam003#30;
   nImpBas = nImpBas + #dscam003#64;
|FPRC;

|DEFBUCLE LeeTalon;
#dscam003#7;
;
aEntidad,aNumero,000000001;
aEntidad,aNumero,999999999;
be;
NULL,LeeTalon;
|FIN;

|PROCESO CuadraTalon;
   |SI #dscam003#78 ! nImpDiv; |O #dscam003#79 ! nImpBas;
      #dscam003#78 = nImpDiv; #dscam003#79 = nImpBas;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;
|FPRC;

|DEFBUCLE CuadraTalon;
#dscam003#7;
;
aEntidad,aNumero,000000001;
aEntidad,aNumero,999999999;
be;
NULL,CuadraTalon;
|FIN;

|PROCESO RevisaRem;
   |SI #dscam004#5 = "REM"; nRemesas = nRemesas + 1; |SINO; nRemesas = 0; |FINSI;
|FPRC;

|DEFBUCLE RevisaRem;
#dscam004#1;
;
#dscam003#40,01;
#dscam003#40,99;
be;
NULL,RevisaRem;
|FIN;

|PROCESO BorraMovRemesas;
   |SI #dscam004#3 ! nNumCobro;
      |BORRA 020#dscam004.a;
   |SINO;
      #dscam004#7 = 0; #dscam004#25 = 0;
      |GRABA 020#dscam004.a; |LIBERA #dscam004;
   |FINSI;
|FPRC;

|DEFBUCLE BorraMovRemesas;
#dscam004#1;
;
#dscam003#40,01;
#dscam003#40,99;
be;
NULL,BorraMovRemesas;
|FIN;

|PROCESO RevisaPag;
   |SI #dscam009#5 = "PPA"; nPagares = nPagares + 1; |SINO; nPagares = 0; |FINSI;
|FPRC;

|DEFBUCLE RevisaPag;
#dscam009#1;
;
#dscam008#40,01;
#dscam008#40,99;
be;
NULL,RevisaPag;
|FIN;

|PROCESO BorraMovPagares;
   |SI #dscam009#3 ! nNumPago;
      |BORRA 020#dscam009.a;
   |SINO;
      #dscam009#7 = 0; #dscam009#20 = 0;
      |GRABA 020#dscam009.a; |LIBERA #dscam009;
   |FINSI;
|FPRC;

|DEFBUCLE BorraMovPagares;
#dscam009#1;
;
#dscam008#40,01;
#dscam008#40,99;
be;
NULL,BorraMovPagares;
|FIN;

|PROCESO RevisaTal;
   |SI #dscam009#5 = "PTA"; nTalones = nTalones + 1; |SINO; nTalones = 0; |FINSI;
|FPRC;

|DEFBUCLE RevisaTal;
#dscam009#1;
;
#dscam008#40,01;
#dscam008#40,99;
be;
NULL,RevisaTal;
|FIN;

|PROCESO BorraMovTalones;
   |SI #dscam009#3 ! nNumPago; |BORRA 020#dscam009.a; |FINSI;
|FPRC;

|DEFBUCLE BorraMovTalones;
#dscam009#1;
;
#dscam008#40,01;
#dscam008#40,99;
be;
NULL,BorraMovTalones;
|FIN;

|PROCESO RecibosCompra;
   |SI #dscam008#25 > 0;
      |SI #dscam008#23 > #dscam008#25;
         nPagares = 0; nTalones = 0;
         |BUCLE RevisaPag;
         |SI nPagares > 1;
            |ABRE #dscam022; |SELECT #2#dscam022;
            #dscam022#13 = #dscam008#40;
            #dscam022#14 = 1;
            |LEE 000#dscam022.];
            |SI FSalida = 0; |Y #dscam022#13 = #dscam008#40;
               nNumPago = #dscam022#14;
            |SINO;
               nNumPago = 0;
            |FINSI;
            |SELECT #1#dscam022; |CIERRA #dscam022;
            |SI nNumPago ! 0; |BUCLE BorraMovPagares; |FINSI;
            #dscam008#23 = #dscam008#25; #dscam008#57 = #dscam008#56;
            #dscam008#31 = 0;            #dscam008#58 = 0;
            |GRABA 020#dscam008.a;
         |FINSI;

         |BUCLE RevisaTal;
         |SI nTalones > 1;
            |ABRE #dscam047; |SELECT #2#dscam047;
            #dscam047#13 = #dscam008#40;
            #dscam047#14 = 1;
            |LEE 000#dscam047.];
            |SI FSalida = 0; |Y #dscam047#13 = #dscam008#40;
               nNumPago = #dscam047#14;
            |SINO;
               nNumPago = 0;
            |FINSI;
            |SELECT #1#dscam047; |CIERRA #dscam047;
            |SI nNumPago ! 0; |BUCLE BorraMovTalones; |FINSI;
            #dscam008#23 = #dscam008#25; #dscam008#57 = #dscam008#56;
            #dscam008#31 = 0;            #dscam008#58 = 0;
            |GRABA 020#dscam008.a;
         |FINSI;
      |FINSI;
   |SINO;
      |SI #dscam008#23 < #dscam008#25;
         nPagares = 0; nTalones = 0;
         |BUCLE RevisaPag;
         |SI nPagares > 1;
            |ABRE #dscam022; |SELECT #2#dscam022;
            #dscam022#13 = #dscam008#40;
            #dscam022#14 = 1;
            |LEE 000#dscam022.];
            |SI FSalida = 0; |Y #dscam022#13 = #dscam008#40;
               nNumPago = #dscam022#14;
            |SINO;
               nNumPago = 0;
            |FINSI;
            |SELECT #1#dscam022; |CIERRA #dscam022;
            |SI nNumPago ! 0; |BUCLE BorraMovPagares; |FINSI;
            #dscam008#23 = #dscam008#25; #dscam008#57 = #dscam008#56;
            #dscam008#31 = 0;            #dscam008#58 = 0;
            |GRABA 020#dscam008.a;
         |FINSI;

         |BUCLE RevisaTal;
         |SI nTalones > 1;
            |ABRE #dscam047; |SELECT #2#dscam047;
            #dscam047#13 = #dscam008#40;
            #dscam047#14 = 1;
            |LEE 000#dscam047.];
            |SI FSalida = 0; |Y #dscam047#13 = #dscam008#40;
               nNumPago = #dscam047#14;
            |SINO;
               nNumPago = 0;
            |FINSI;
            |SELECT #1#dscam047; |CIERRA #dscam047;
            |SI nNumPago ! 0; |BUCLE BorraMovTalones; |FINSI;
            #dscam008#23 = #dscam008#25; #dscam008#57 = #dscam008#56;
            #dscam008#31 = 0;            #dscam008#58 = 0;
            |GRABA 020#dscam008.a;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE RecibosCompra;
#dscam008#1;
;
INICIO;
FINAL;
;
NULL,RecibosCompra;
|FIN;

|PROCESO Recibos1;
   |SI #dscam003#49 = "S";
      nImpDiv = 0; nImpBas = 0;
      nAgrupador = #dscam003#40;
      |SALVA_FICHA #dscam003;
      |BUCLE Agrupados;
      |REPON_FICHA #dscam003;
      |SI nImpDiv ! #dscam003#22; |O nImpBas ! #dscam003#60;
         #dscam003#22 = nImpDiv;
         #dscam003#60 = nImpBas;
         #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
         #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
         #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
         #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
         #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;
         |GRABA 020#dscam003.a;
      |FINSI;
   |FINSI;

   |SI #dscam003#72 ! "    ";
      nCalc = (#dscam003#78 - #dscam003#79) ! 2;
      nCalc2 = (nCalc + 0.01) ! nDeci_Div; nCalc1 = (nCalc - 0.01) ! nDeci_Div;
      |SI nCalc1 [ #dscam003#30; |Y #dscam003#30 [ nCalc2;
         |BORRA 020#dscam003.a; |LIBERA #dscam003;
      |SINO;
         nCalc = (#dscam003#78 / 166.386) ! 2;
         nCalc = #dscam003#78 - nCalc;
         |SI nCalc = #dscam003#30;
            |BORRA 020#dscam003.a; |LIBERA #dscam003;
         |SINO;
            nCalc = (#dscam003#78 - #dscam003#79) ! 2;
            nCalc = nCalc + #dscam003#64;
            |SI nCalc = #dscam003#30; |Y #dscam003#78 ! #dscam003#79;
               |BORRA 020#dscam003.a; |LIBERA #dscam003;
            |SINO;
               |SI #dscam003#57 = "EUR"; |Y #dscam003#47 = "S";
                  nCalc = #dscam003#78 ! 2;
                  nCalc1 = (nCalc - 0.5) ! 0;
                  nCalc1 = (nCalc - nCalc1) ! 2;
                  |SI nCalc1 = #dscam003#30;
                     |BORRA 020#dscam003.a; |LIBERA #dscam003;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |SINO;
      |SI #dscam003#30 > 0;
         ||SI #dscam003#23 > #dscam003#30;
            nRemesas = 0;
            |BUCLE RevisaRem;
            |SI nRemesas > 1;
               |ABRE #dscam013; |SELECT #4#dscam013;
               #dscam013#16 = #dscam003#40;
               #dscam013#24 = 1;
               |LEE 000#dscam013.];
               |SI FSalida = 0; |Y #dscam013#16 = #dscam003#40;
                  nNumCobro = #dscam013#17;
               |SINO;
                  nNumCobro = 0;
               |FINSI;
               |SELECT #1#dscam013; |CIERRA #dscam013;
               |SI nNumCobro ! 0; |BUCLE BorraMovRemesas; |FINSI;
               #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
               #dscam003#31 = 0;            #dscam003#65 = 0;
               #dscam003#14 = "L"; #dscam003#15 = "Recibo liquidado";
               |GRABA 020#dscam003.a;
            |FINSI;
         ||FINSI;
      |SINO;
         |SI #dscam003#23 < #dscam003#30;
            nRemesas = 0;
            |BUCLE RevisaRem;
            |SI nRemesas > 1;
               |ABRE #dscam013; |SELECT #4#dscam013;
               #dscam013#16 = #dscam003#40;
               #dscam013#24 = 1;
               |LEE 000#dscam013.];
               |SI FSalida = 0; |Y #dscam013#16 = #dscam003#40;
                  nNumCobro = #dscam013#17;
               |SINO;
                  nNumCobro = 0;
               |FINSI;
               |SELECT #1#dscam013; |CIERRA #dscam013;
               |SI nNumCobro ! 0; |BUCLE BorraMovRemesas; |FINSI;
               #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
               #dscam003#31 = 0;            #dscam003#65 = 0;
               |GRABA 020#dscam003.a;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Recibos1;
#dscam003#1;
;
INICIO;
FINAL;
be;
NULL,Recibos1;
|FIN;

|PROCESO Recibos2;
   |SI #dscam003#72 ! "    ";
      |SI #dscam003#78 ! #dscam003#79; |Y #dscam003#57 = "EUR";
         #dscam003#78 = #dscam003#79; |GRABA 020#dscam003.a;
      |FINSI;
   |FINSI;

   |SI #dscam003#57 = "EUR"; |Y #dscam003#59 ! 1;
       #dscam003#59 = 1; |GRABA 020#dscam003.a;
   |FINSI;
   |LIBERA #dscam003;
|FPRC;

|DEFBUCLE Recibos2;
#dscam003#1;
;
INICIO;
FINAL;
be;
NULL,Recibos2;
|FIN;

|PROCESO Recibos3;
   |SI #dscam003#72 ! "    ";
      nCalc = (#dscam003#64 /166.386) ! 2;
      |SI nCalc = #dscam003#79;
         #dscam003#78 = #dscam003#30;
         #dscam003#79 = #dscam003#64;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Recibos3;
#dscam003#1;
;
INICIO;
FINAL;
be;
NULL,Recibos3;
|FIN;

|PROCESO Recibos4;
   |SI #dscam003#22 ! #dscam003#60; |Y #dscam003#49 = "N"; |Y #dscam003#41 = 0;
    |Y #dscam003#82 = "N"; |Y #dscam003#83 = 0;
      |SI #dscam003#22 ! #dscam003#60; #dscam003#22 = #dscam003#60; |FINSI;
      |SI #dscam003#24 ! #dscam003#62; #dscam003#24 = #dscam003#62; |FINSI;
      |SI #dscam003#25 ! #dscam003#63; #dscam003#25 = #dscam003#63; |FINSI;
      |SI #dscam003#38 ! #dscam003#66; #dscam003#38 = #dscam003#66; |FINSI;
      |SI #dscam003#54 ! #dscam003#67; #dscam003#54 = #dscam003#67; |FINSI;
      |SI #dscam003#55 ! #dscam003#68; #dscam003#55 = #dscam003#68; |FINSI;
      #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
      #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
      #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
      #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;
|FPRC;

|DEFBUCLE Recibos4;
#dscam003#1;
57;
000000001,"EUR";
999999999,"EUR";
be;
NULL,Recibos4;
|FIN;

|PROCESO Recibos41;

   nRemesas = 0;
   |SI #dscam003#31 < 0;
      #dscam004#17 = #dscam003#40;
      #dscam004#3  = 1;
      |LEE 000#dscam004.];
      |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
         |SI #dscam004#5 = "REM"; nRemesas = nRemesas + 1; |FINSI;
         |SI #dscam004#5 = "COB"; nCobros  = nCobros  + 1; |FINSI;
         |SI #dscam004#5 = "COP"; nCobros  = nCobros  + 1; |FINSI;
         |LEE 000#dscam004.s;
      |SIGUE;
      |LEE 000#dscam004.a;
      |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
         |SI nRemesas = 1;
            |SI #dscam004#5 = "REM";
               |SELECT #2#dscam013;
               #dscam013#16 = #dscam004#17;
               #dscam013#17 = #dscam004#3;
               |LEE 000#dscam013.=;
               |SI FSalida = 0;
                  #dscam004#17 = #dscam013#16;
                  #dscam004#3  = 1;
                  |LEE 000#dscam004.];
                  |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16; |HACIENDO;
                     |SI #dscam004#3 = #dscam013#17;
                        #dscam004#7 = 0; #dscam004#25 = 0;
                     |SINO;
                        |BORRA 020#dscam004.a;
                     |FINSI;
                     |LEE 000#dscam004.s;
                  |SIGUE;
				  |HAZ EsArtenvas;
				  |SI FSalida ! 0;
                      #dscam003#31 = 0;            #dscam003#65 = 0;
                      #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
                      #dscam003#14 = "L";          #dscam003#15 = "Recibo liquidado";
                      |GRABA 020#dscam003.a;
                  |FINSI;
               |FINSI;
               |SELECT #1#dscam013;
            |FINSI;
         |SINO;
            |SI nRemesas = 0;
               |SI nCobros = 1;
                  |SI #dscam004#8 = 0;
                     #dscam004#8  = #dscam003#30;
                     #dscam004#26 = #dscam003#64;
                     |GRABA 020#dscam004.a;
                     #dscam003#31 = 0;            #dscam003#65 = 0;
                     #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
                     #dscam003#14 = "L";          #dscam003#15 = "Recibo liquidado";
                     |GRABA 020#dscam003.a;
                  |FINSI;
               |SINO;
                  |SI nCobros = 0;
                  |SINO;
                     nCobros = 0;
                     #dscam004#17 = #dscam003#40;
                     #dscam004#3  = 1;
                     |LEE 000#dscam004.];
                     |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
                        |SI nCobros = 0;
                           #dscam004#8  = #dscam003#30;
                           #dscam004#26 = #dscam003#64;
                           |GRABA 020#dscam004.a;
                        |SINO;
                           |BORRA 020#dscam004.a;
                        |FINSI;
                        nCobros = nCobros + 1;
                        |LEE 000#dscam004.s;
                     |SIGUE;
                     #dscam003#31 = 0;            #dscam003#65 = 0;
                     #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
                     #dscam003#14 = "L";          #dscam003#15 = "Recibo liquidado";
                     |GRABA 020#dscam003.a;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
      |ACABA;
   |FINSI;

   |SI #dscam003#14 = "L"; |Y #dscam003#23 [ #dscam003#31;
      nLins = 0;
      #dscam004#17 = #dscam003#40;
      #dscam004#3  = 1;
      |LEE 000#dscam004.];
      |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
         nLins = nLins + 1; |LEE 000#dscam004.s;
      |SIGUE;
      |SI nLins = 0;
         #dscam003#14 = "P";
         #dscam003#15 = "Pendiente de cobro";
      |SINO;
         |LEE 000#dscam004.a;
         |SI nLins = 1;
            #dscam004#8  = #dscam003#30;
            #dscam004#26 = #dscam003#64;
            |GRABA 020#dscam004.a;
            #dscam003#31 = 0;            #dscam003#65 = 0;
            #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
            #dscam003#14 = "L";          #dscam003#15 = "Recibo liquidado";
            |GRABA 020#dscam003.a;
         |SINO;
            nLins = 0;
            #dscam004#17 = #dscam003#40;
            #dscam004#3  = 1;
            |LEE 000#dscam004.];
            |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
               |SI nLins = 0;
                  #dscam004#8  = #dscam003#30;
                  #dscam004#26 = #dscam003#64;
                  |GRABA 020#dscam004.a;
               |SINO;
                  |BORRA 020#dscam004.a;
               |FINSI;
               nLins = nLins + 1;
               |LEE 000#dscam004.s;
            |SIGUE;
            #dscam003#31 = 0;            #dscam003#65 = 0;
            #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
            #dscam003#14 = "L";          #dscam003#15 = "Recibo liquidado";
            |GRABA 020#dscam003.a;
         |FINSI;
      |FINSI;
   |FINSI;

   |SI #dscam003#14 = "C"; |Y #dscam003#23 = 0;
      nLins = 0;
      #dscam004#17 = #dscam003#40;
      #dscam004#3  = 1;
      |LEE 000#dscam004.];
      |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
         nLins = nLins + 1; |LEE 000#dscam004.s;
      |SIGUE;
      |SI nLins = 0;
         #dscam003#14 = "P";
         #dscam003#15 = "Pendiente de cobro";
      |SINO;
         |LEE 000#dscam004.a;
         |SI nLins = 1;
            |SI #dscam004#8 = 0; |Y #dscam004#26 = 0;
               #dscam004#24 = 0;
               nCalc = #dscam003#22 - #dscam003#30;
               |SI #dscam004#33 = 0; #dscam004#33 = #dscam003#59; |FINSI;
               #dscam004#8 = nCalc; #dscam004#26 = nCalc * #dscam004#33;
               #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
               #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
               #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66;
               #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
               #dscam003#23 = #dscam003#23 + #dscam004#8;
               #dscam003#61 = #dscam003#61 + #dscam004#26;
               #dscam003#31 = #dscam003#30 - #dscam003#23;
               #dscam003#65 = #dscam003#64 - #dscam003#61;
               |GRABA 020#dscam004.a; |GRABA 020#dscam003.a;
            |SINO;
               #dscam004#24 = 0; |GRABA 020#dscam004.a;
               #dscam003#23 = #dscam003#23 + #dscam004#8;
               #dscam003#61 = #dscam003#61 + #dscam004#26;
               #dscam003#31 = #dscam003#30 - #dscam003#23;
               #dscam003#65 = #dscam003#64 - #dscam003#61;
            |FINSI;
            #dscam003#56 = 0;
            |SI #dscam003#31 = 0;
               #dscam003#14 = "L";          #dscam003#15 = "Recibo liquidado";
            |SINO;
               |SI #dscam003#31 = #dscam003#30;
                  #dscam003#14 = "P";          #dscam003#15 = "Pendiente de cobro";
               |SINO;
                  #dscam003#14 = "C";          #dscam003#15 = "Parcialmente cobrado";
               |FINSI;
            |FINSI;
            |GRABA 020#dscam003.a;
         |SINO;
            nLins = 0;
            #dscam004#17 = #dscam003#40;
            #dscam004#3  = 1;
            |LEE 000#dscam004.];
            |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
               |SI nLins = 0;
                  #dscam004#8  = #dscam003#30;
                  #dscam004#26 = #dscam003#64;
                  |GRABA 020#dscam004.a;
               |SINO;
                  |BORRA 020#dscam004.a;
               |FINSI;
               nLins = nLins + 1;
               |LEE 000#dscam004.s;
            |SIGUE;
            #dscam003#31 = 0;            #dscam003#65 = 0;
            #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
            #dscam003#14 = "L";          #dscam003#15 = "Recibo liquidado";
            |GRABA 020#dscam003.a;
         |FINSI;
      |FINSI;
   |FINSI;

   |SI #dscam003#59 = 1; |Y #dscam003#56 ! 0;
      #dscam003#56 = 0;
      #dscam003#64 = #dscam003#30;
      #dscam003#61 = #dscam003#23;
      #dscam003#65 = #dscam003#31;
      |GRABA 020#dscam003.a;

      #dscam004#17 = #dscam003#40;
      #dscam004#3  = 1;
      |LEE 000#dscam004.];
      |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
         #dscam004#24 = 0; |GRABA 020#dscam004.a;
         |LEE 000#dscam004.s;
      |SIGUE;
   |FINSI;
|FPRC;

|DEFBUCLE Recibos41;
#dscam003#1;
;
INICIO;
FINAL;
be;
NULL,Recibos41;
|FIN;

|PROCESO Talones;
   aEntidad = #dscam003#72;
   aNumero  = #dscam003#70;
   |SALVA_FICHA #dscam003;
   nImpDiv = 0; nImpBas = 0;
   |BUCLE LeeTalon;
   |BUCLE CuadraTalon;
   |REPON_FICHA #dscam003;
|FPRC;

|DEFBUCLE Talones;
#dscam003#7;
;
"   !","          ",000000001;
"zzzz","zzzzzzzzzz",999999999;
be;
NULL,Talones;
|FIN;

|PROCESO RevisaRemMal;
   #dscam012#0 = #dscam013#0; |LEE 101#dscam012.=;

   #dscam003#40 = #dscam013#16; |LEE 000#dscam003.=;
   |SI FSalida ! 0;
      #dscam012#7  = "X"; |GRABA 020#dscam012.a; |LIBERA #dscam012;
      #dscam013#20 = "X"; |GRABA 020#dscam013.a; |LIBERA #dscam013;
   |FINSI;
|FPRC;

|DEFBUCLE RevisaRemMal;
#dscam013#1;
;
INICIO;
FINAL;
be;
NULL,RevisaRemMal;
|FIN;

|PROCESO LCobros;
   Total = Total + #dscam004#25;
   nLin = nLin + 1; nCobro = #dscam004#3;
|FPRC;

|DEFBUCLE LCobros;
#dscam004#1;
;
#dscam003#40,001;
#dscam003#40,999;
;
NULL,LCobros;
|FIN;

|PROCESO RevisaRecs;
   #agif133@#4 = #dscam003#0;
   #agif133@#0 = #dscam003#1;
   #agif133@#1 = #dscam003#2;
   |LEE 000#agif133@.=;
   |SI FSalida ! 0;
      #dscam003#35 = "X";
      #dscam003#36 = "Recibo inexistente en dscomer";
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |ACABA;
   |FINSI;

   |SI #dscam003#31 < 0;
      nLin = 0; Total = 0; nCobro = 0; |BUCLE LCobros;
      |SI nLin = 1;
         #dscam004#17 = #dscam003#40;
         #dscam004#3  = nCobro;
         |LEE 101#dscam004.=;
         |SI FSalida = 0;
            #dscam004#8  = #dscam003#31;
            #dscam004#26 = #dscam003#65;
            |GRABA 020#dscam004.a; |LIBERA #dscam004;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE RevisaRecs;
#dscam003#1;
;
INICIO;
FINAL;
be;
NULL,RevisaRecs;
|FIN;

|PROCESO LineasRem;
   #dscam003#40 = #dscam013#16;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam013#4 ! #dscam003#0; |O #dscam013#3 ! #dscam003#1; |O #dscam013#5 ! #dscam003#2;
          SwError = -1; |ACABA;
      |FINSI;
      #agif133@#4 = #dscam013#4;
      #agif133@#0 = #dscam013#3;
      #agif133@#1 = #dscam013#5;
      |LEE 000#agif133@.=;
      |SI FSalida ! 0; SwError = -1; |FINSI;
   |SINO;
      SwError = -1;
   |FINSI;
|FPRC;

|DEFBUCLE LineasRem;
#dscam013#1;
;
#dscam012#0,001;
#dscam012#0,999;
;
NULL,LineasRem;
|FIN;

|PROCESO MiraRem;
   SwError = 0;
   |BUCLE LineasRem;
   |SI SwError ! 0;
      #dscam012#8 = "X"; |GRABA 020#dscam012.a;
   |FINSI;
|FPRC;

|DEFBUCLE MiraRem;
#dscam012#1;
;
00001;
99999;
;
NULL,MiraRem;
|FIN;

|PROCESO EmiteLinRem;
   #dscam003#40 = #dscam013#16;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      Divisa = #dscam003#57; |HAZ TomaDecim;
   |SINO;
      |ACABA;
   |FINSI;

   |SI #dscam003#47 ! "S";
      || Actualizo  el historico de cobros
      #dscam004#17 = #dscam013#16;
      #dscam004#3 = 99;
      |LEE 000#dscam004.];
      |SI FSalida ! 0;
         |LEE 010#dscam004.u;
         |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
            LinCob = #dscam004#3 + 1;
         |SINO;
            LinCob = 1;
         |FINSI;
      |SINO;
         |SI #dscam004#17 = #dscam013#16;
            LinCob = #dscam004#3 + 1;
         |SINO;
            |LEE 010#dscam004.a;
            |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
               LinCob = #dscam004#3 + 1;
            |SINO;
               LinCob = 1;
            |FINSI;
         |FINSI;
      |FINSI;

      |DDEFECTO #dscam004;
      #dscam004#17 = #dscam013#16;
      #dscam004#15 = #dscam013#2;
      #dscam004#0  = #dscam013#4;
      #dscam004#1  = #dscam013#3;
      #dscam004#2  = #dscam013#5;
      #dscam004#3  = LinCob;
      #dscam004#4  = #dscam012#14;
      #dscam004#5  = "REM";
      #dscam004#6  = #dscam012#1;
      #dscam003#40 = #dscam013#16;
      |LEE 010#dscam003.=;
      |SI FSalida = 0;
         #dscam004#7  = #dscam003#23; #dscam004#25  = #dscam003#61;
      |FINSI;
      #dscam004#8  = #dscam013#22; #dscam004#26  = #dscam013#7;
      #dscam004#9  = 0;
      #dscam004#10 = 0;
      |GRABA 020#dscam004.n;
      #dscam013#17 = LinCob; |GRABA 020#dscam013.a;
   |FINSI;

   || Actualizo el recibo
   #dscam003#40 = #dscam013#16;
   |LEE 101#dscam003.=;
   |SI FSalida = 0; |Y #dscam003#47 ! "S";
      #dscam066#0 = #dscam003#40;
      |LEE 000#dscam066.=;
      |SI FSalida = 0; |BORRA 020#dscam066.a; |FINSI;
	  |HAZ EsArtenvas;
	  |SI FSalida ! 0;
          #dscam003#14 = "L";
          #dscam003#15 = "Recibo liquidado";
          #dscam003#26 = #dscam012#1;
          #dscam003#23 = #dscam003#23 + #dscam013#22; #dscam003#61 = #dscam003#61 + #dscam013#7;
	  |FINSI;
      #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
      #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
      #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
      Comodin = #dscam003#31; |QBF Comodin; Calc = Comodin;
      #dscam003#31 = #dscam003#30 - #dscam003#23;
      #dscam003#65 = #dscam003#64 - #dscam003#61;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;

|FPRC;

|DEFBUCLE EmiteLinRem;
#dscam013#1;
;
#dscam012#0,001;
#dscam012#0,999;
;
NULL,EmiteLinRem;
|FIN;

|PROCESO EmiteRem;
   |BUCLE EmiteLinRem;
   |SI #dscam012#8 ! "X"; #dscam012#8 = "S"; |FINSI;
|FPRC;

|DEFBUCLE EmiteRem;
#dscam012#1;
;
00001;
99999;
;
NULL,EmiteRem;
|FIN;

|PROGRAMA;
   |CONFI "    N¨ Esta seguro de ejecutar el proceso ?";
   |SI FSalida ! 0; |ACABA; |FINSI;

   |HAZ Tipo8;

   |ABRE #dscam003; |ABRE #dscam004;
   |ABRE #dscam008; |ABRE #dscam009;
   |ABRE #dscam013; |ABRE #dscam012;
/*
   nDeci_Base = 7; nDeci_Div = 7;
   |ABRE #dscam012; |BUCLE RevisaRemMal; |CIERRA #dscam012;
   aAlfa = #48#17; |QBF aAlfa; aAlfa = aAlfa + "def/agifa133.mas";
   |CARGA_DEF aAlfa, agif133@;
   |SI FSalida = 0;
      aAlfa = #48#17; |QBF aAlfa;
      aAlfa = aAlfa + "fich/" + (("00000" + #48#15) % -105) + "/";
      |PATH_DAT #100 aAlfa; |ABRE #agif133@;
      |BUCLE RevisaRecs;
      |CIERRA #agif133@; |DESCARGA_DEF #agif133@;
   |FINSI;
   |BUCLE LinRecibos1; |BUCLE Recibos1;
   |BUCLE LinRecibos2; |BUCLE Recibos2;
   |BUCLE LinRecibos3; |BUCLE Recibos3;
   |BUCLE Recibos4;    |BUCLE Talones;
   |BUCLE RecibosCompra;
*/

   aAlfa = #48#17; |QBF aAlfa; aAlfa = aAlfa + "def/agifa133.mas";
   |CARGA_DEF aAlfa, agif133@;
   |SI FSalida = 0;
      aAlfa = #48#17; |QBF aAlfa;
      aAlfa = aAlfa + "fich/" + (("00000" + #48#15) % -105) + "/";
      |PATH_DAT #100 aAlfa; |ABRE #agif133@;
      |BUCLE MiraRem; |BUCLE EmiteRem;
      |BUCLE LinRecibos1; |BUCLE Recibos1;
      |BUCLE LinRecibos2; |BUCLE Recibos2;
      |BUCLE LinRecibos3; |BUCLE Recibos3;
      |BUCLE Recibos41;
      |BUCLE Recibos4;    |BUCLE Talones;
      |BUCLE RecibosCompra;
      |CIERRA #agif133@; |DESCARGA_DEF #agif133@;
   |FINSI;
   |CIERRA #dscam012; |CIERRA #dscam013;
   |CIERRA #dscam009; |CIERRA #dscam008;
   |CIERRA #dscam004; |CIERRA #dscam003;
   |HAZ Tipo9;
|FPRO;
