|FICHEROS;
     dscaz146 #0;

     dscam003 #10;
     dscam004 #11;
     dscam008 #12;
     dscam009 #13;
     dscam067 #14;
     dscam013 #15;
     dscam050 #16;
     dscam047 #17;
     dscam022 #18;
     dscam017 #19;
|FIN;

|VARIABLES;
     swSi      = 0;
     aParam    = "";

     aD = "";
     aH = "";
     aTipo = "";
     aAlfarec = "";

     aNume1    = "";
     aNume2    = "";

     nCalc     = 0;
     nCont     = 0;
     aSerie    = "";
     aAlfa     = "";
     aAlfa1    = "";
     aAlfaX1    = "";
     aAlfaX2    = "";
     nCalcX1    = 0;
     nCalcX2    = 0;
     &aCPath    = "";
     &aCNome    = "";
     aConta     = "agicont";

     nEmpresa = 0;
     nPeriodo = 0;
|FIN;

|PROCESO dscam067;
   |BORRA 020#dscam067.a;
|FPRC;

|DEFBUCLE dscam067;
   #dscam067#1;
   ;
   aTipo, aNume1, aNume2, aD, 000000, 00000, 0;
   aTipo, aNume1, aNume2, aH, 999999, 99999, 9;
   be;
   NULL, dscam067;
|FIN;

|PROCESO Cobradores;
   |BORRA 020#dscam017.a;
|FPRC;

|DEFBUCLE Cobradores;
   #dscam017#3;
   ;
   01, aSerie, 000001, 001;
   99, aSerie, 999999, 999;
   be;
   NULL, Cobradores;
|FIN;

|PROCESO Remesas;
   aTipo = "RM";
   aNume1 = #dscam013#0; |QBF aNume1; aNume1 = (aNume1 + (" " * 50)) % 0150;
   aNume2 = #dscam013#1; |QBF aNume2; aNume2 = (aNume2 + (" " * 50)) % 0150;
   |BUCLE dscam067;

   |BORRA 020#dscam013.a;
|FPRC;

|DEFBUCLE Remesas;
   #dscam013#3;
   ;
   00, aSerie, 000000, 000, 000000001;
   99, aSerie, 999999, 999, 999999999;
   be;
   NULL, Remesas;
|FIN;

|PROCESO Pagares;
   aTipo = "PA";
   aNume1 = #dscam022#0; |QBF aNume1; aNume1 = (aNume1 + (" " * 50)) % 0150;
   aNume2 = #dscam022#1; |QBF aNume2; aNume2 = (aNume2 + (" " * 50)) % 0150;
   |BUCLE dscam067;

   |BORRA 020#dscam022.a;
|FPRC;

|DEFBUCLE Pagares;
   #dscam022#3005;
   ;
   00, aSerie, 000000, 000, 000000001;
   99, aSerie, 999999, 999, 999999999;
   be;
   NULL, Pagares;
|FIN;

|PROCESO Talones;
   aTipo = "TA";
   aNume1 = #dscam047#0; |QBF aNume1; aNume1 = (aNume1 + (" " * 50)) % 0150;
   aNume2 = #dscam047#1; |QBF aNume2; aNume2 = (aNume2 + (" " * 50)) % 0150;
   |BUCLE dscam067;

   |BORRA 020#dscam047.a;
|FPRC;

|DEFBUCLE Talones;
   #dscam047#3;
   ;
   00, aSerie, 000000, 000, 000000001;
   99, aSerie, 999999, 999, 999999999;
   be;
   NULL, Talones;
|FIN;

|PROCESO Confirmes;
   aTipo = "CF";
   aNume1 = #dscam050#0; |QBF aNume1; aNume1 = (aNume1 + (" " * 50)) % 0150;
   aNume2 = #dscam050#1; |QBF aNume2; aNume2 = (aNume2 + (" " * 50)) % 0150;
   |BUCLE dscam067;

   |BORRA 020#dscam050.a;
|FPRC;

|DEFBUCLE Confirmes;
   #dscam050#3;
   ;
   00, aSerie, 000000, 000, 000000001;
   99, aSerie, 999999, 999, 999999999;
   be;
   NULL, Confirmes;
|FIN;

|PROCESO HistorPagos;
   aTipo = "PG";
   aNume1 = #dscam009#14; |QBF aNume1; aNume1 = (aNume1 + (" " * 50)) % 0150;
   aNume2 = #dscam009#3;  |QBF aNume2; aNume2 = (aNume2 + (" " * 50)) % 0150;
   |BUCLE dscam067;

   |BORRA 020#dscam009.a;
|FPRC;

|DEFBUCLE HistorPagos;
   #dscam009#1;
   ;
   #dscam008#40, 001;
   #dscam008#40, 999;
   be;
   NULL,HistorPagos;
|FIN;

|PROCESO RecibosCompra;
   |BUCLE HistorPagos;
   |BORRA 020#dscam008.a;
|FPRC;

|DEFBUCLE RecibosCompra;
   #dscam008#2;
   ;
   00, aSerie, 000000, 000;
   99, aSerie, 999999, 999;
   ;
   NULL,RecibosCompra;
|FIN;

|PROCESO HistorCobros;
   aTipo = "CB";
   aNume1 = #dscam004#17; |QBF aNume1; aNume1 = (aNume1 + (" " * 50)) % 0150;
   aNume2 = #dscam004#3;  |QBF aNume2; aNume2 = (aNume2 + (" " * 50)) % 0150;
   |BUCLE dscam067;

   |BORRA 020#dscam004.a;
|FPRC;

|DEFBUCLE HistorCobros;
   #dscam004#1;
   ;
   #dscam003#40, 001;
   #dscam003#40, 999;
   be;
   NULL,HistorCobros;
|FIN;

|PROCESO RecibosVenta;
   |BUCLE HistorCobros;
   |BORRA 020#dscam003.a;
|FPRC;

|DEFBUCLE RecibosVenta;
   #dscam003#9;
   ;
   00, aSerie, 000000, 000, 000000001;
   99, aSerie, 999999, 999, 999999999;
   be;
   NULL, RecibosVenta;
|FIN;

|PROGRAMA;
   aParam = PARAMETRO; |QBF aParam;
   |ABRE #0;
   |LEE 101#0p;
   |SI FSalida ! 0; |GRABA 020#0b; |FINSI;

   |SI aParam = "";  || desde un programa externo
        #0#8 = "S";
        FSalida = 0;
   |SINO;            || desde el menu (SE LLAMA CON EL PARAMETRO 'NOPARAM')
        |SI aParam = "NOPARAM";
           |CLS;
           |CABEZA "Recalculo Historico";
           #0#9 = "";
           |ENCAMPO #9#0;
           |SI #0#9 ! "BORRATODO"; |ACABA; |FINSI; ||LA CLAVE

           |C_V #0#9, 1, "N";
           #0#8 = "N";
           |PINTA #0#8;
           |PINPA #0#0;
           |PINDA #0#0;
           |ENDATOS #1#0;
        |SINO;
           |DDEFECTO #dscaz146;
           nCalcX1 = 0;
           |PARA; |SI aParam ! ""; |HACIENDO;
              aAlfaX1 = aParam - ",";
              |SI FSalida ! 0;
                 nCalcX2 = ((FSalida / 100) ! 0) + 99; aAlfaX1 = aParam % nCalcX2;
                 nCalcX2 = FSalida + 198;              aParam  = aParam % nCalcX2;
                 |SI nCalcX1 [ 22; #0#nCalcX1# = aAlfaX1; |FINSI;
              |SINO;
                 #0#nCalcX1# = aParam; aParam = "";
              |FINSI;
              nCalcX1 = nCalcX1 + 1;
              |SI nCalcX1 = 8;
                  nCalcX1 = 11;
              |FINSI;
           |SIGUE;

           |SI #0#0 ! "-----"; |O #0#1 ! "-----"; |O #0#2 ! "-----"; |O #0#3 ! "-----";
            |O #0#4 ! "-----"; |O #0#5 ! "-----"; |O #0#6 ! "-----"; |O #0#7 ! "-----";
            |O #0#9 ! "-----"; |O #0#10 ! "-----"; |O #0#11 ! "-----"; |O #0#12 ! "-----";
            |O #0#13 ! "-----"; |O #0#14 ! "-----"; |O #0#15 ! "-----"; |O #0#16 ! "-----";
            |O #0#17 ! "-----"; |O #0#18 ! "-----"; |O #0#19 ! "-----"; |O #0#20 ! "-----";
            |O #0#21 ! "-----"; |O #0#22 ! "-----";
              FSalida = 0; #0#8 = "S";
           |SINO;
              FSalida = 1; #0#8 = "N";
           |FINSI;

        |FINSI;
   |FINSI;

   |SI FSalida = 0;
        |GRABA 020#0a;
   |FINSI;

   |SI #0#8 = "S";
      |PARA nCont = 0; |SI nCont [ 7; |HACIENDO nCont = nCont + 1;
         aD = " " * 50; aH = "z" * 50;
         aSerie = #dscaz146#nCont#;

         |BUCLE RecibosVenta;
         |BUCLE Remesas;
         |BUCLE RecibosCompra;
         |BUCLE Pagares;
         |BUCLE Talones;
         |BUCLE Confirmes;
         |BUCLE Cobradores;
      |SIGUE;
      |PARA nCont = 11; |SI nCont [ 22; |HACIENDO nCont = nCont + 1;
         aD = " " * 50; aH = "z" * 50;
         aSerie = #dscaz146#nCont#;

         |BUCLE RecibosVenta;
         |BUCLE Remesas;
         |BUCLE RecibosCompra;
         |BUCLE Pagares;
         |BUCLE Talones;
         |BUCLE Confirmes;
         |BUCLE Cobradores;
      |SIGUE;
   |FINSI;

   |LIBERA #0;
   |CIERRA #0;
|FPRO;
