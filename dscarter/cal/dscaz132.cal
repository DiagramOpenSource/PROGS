|FICHEROS;
   dscaz132 #0;

   dscam049 #10;
   dscam050 #11;
   dscaw096 #12,MANTE;
   dscam030 #13;
   dscaw013 #14;
   dscam067 #15;
   dscam051 #16;

   dscam008 #30;
   dscam009 #31;
|FIN;

|VARIABLES;
   &HayConta = 0;

   fFechaCob = @;

   nLinea  = 0;
   nLong   = 0;
   FEstado = 0;

   aLong = "";
   aAlfa = "";
   aCodEnlace = "";
   aCodEnlSCarga = "";
   aCodEnlNCarga = "";

   nTotSelec = 0;

|FIN;

|PROCESO Tipo12z132; |TIPO 12;
|FPRC;

|RUTINA Inf;
   #dscaw096#0 = 001;
|FRUT;

|RUTINA Sup;
   #dscaw096#0 = 999;
|FRUT;

|PROCESO PideEnlace;
      |ABRE #dscam051;
      |LEE 000#dscam051.p;
      |SI FSalida ! 0; |DDEFECTO #dscam051; |FINSI;
      |CIERRA #dscam051;

      |SI #dscam051#1 = "N"; aCodEnlace = "    "; |ACABA; |FINSI;

      |ABRE #dscam030;
      |MENSA "    <F2> Consulta de enlaces ";
      |PUSHV 2201 2280;
      |BLANCO 2208 2277;
      |PINTA 2215, " Codigo enlace ";

      |SI #dscam049#8 = "N";
         |SI aCodEnlNCarga = "";
            aCodEnlNCarga = #dscam051#97;
            aCodEnlace = #dscam051#97;
         |SINO;
            aCodEnlace = aCodEnlNCarga;
         |FINSI;
      |SINO;
         |SI aCodEnlSCarga = "";
            aCodEnlSCarga = #dscam051#98;
            aCodEnlace = #dscam051#98;
         |SINO;
            aCodEnlace = aCodEnlSCarga;
         |FINSI;
      |FINSI;

|ET OtroEnlace;
      |SI #dscam051#61 = "S";
         |PINTA 2236, #dscam030#1;
         E_sup  = 4; E_inf  = "";
         aCodEnlace = 2231 ? 1;
         |SI FSalida = 0;
            |QBF aCodEnlace;
            aLong = aCodEnlace % 0; nLong = aLong;
            #dscam030#0 = aCodEnlace;
            |LEE 000#dscam030.=;
            |SI FSalida = 0;
               |PINTA 2231, #dscam030#0;
               |PINTA 2236, #dscam030#1;
            |SINO;
               |MENAV "    Enlace inexistente";
               |VETE OtroEnlace;
            |FINSI;
            aAlfa = "    N" + &191 + " Es correcto ? ";
            |CONFI aAlfa;
            |SI FSalida ! 0;
               |VETE OtroEnlace;
            |FINSI;
         |SINO;
            |SI FSalida = 10;
               #dscam030#0 = aCodEnlace;
               |LEE 000#dscam030.];
               |CONSULTA_CLAVE #1#dscam030;
               |SI FSalida = 0;
                  aCodEnlace = #dscam030#0; |PINTA 2231, #dscam030#0;
                  |PINTA 2236, #dscam030#1;
               |FINSI;
               |VETE OtroEnlace;
            |SINO;
               aCodEnlace = "ERROR";
               |CIERRA #dscam030; |POPV;
               |ERROR; |ACABA;
            |FINSI;
         |FINSI;
         |SI aCodEnlace ! "ERROR";
            |SI #dscam049#8 = "N";
               aCodEnlNCarga = aCodEnlace;
            |SINO;
               aCodEnlSCarga = aCodEnlace;
            |FINSI;
         |FINSI;
         |POPV;
      |FINSI;
|FPRC;

|PROCESO Tipo05w096; |TIPO 5;
   #dscaw096#6 = " ";
   |LINEAS_BI_ATRI #dscaw096#6,D,S,-1;
|FPRC;

|PROCESO ActRecibo;
   #dscam049#0 = #dscaz132#0;
   |LEE 000#dscam049.=;
   |SI FSalida ! 0; |DDEFECTO #dscam049; |FINSI;

   #dscam050#0 = #dscaz132#0;
   #dscam050#1 = #dscaw096#0;
   |LEE 000#dscam050.=;
   |SI FSalida ! 0; |DDEFECTO #dscam050; |FINSI;

   #dscam008#40 = #dscaw096#1;
   |LEE 101#dscam008.=;
   |SI FSalida ! 0;
      |MENAV "    Documento inexistente. Proceso cancelado";
      FEstado = -1; |ERROR; |ACABA;
   |FINSI;

   |SI #dscaw096#6 ! " ";
      nLinea = 1;
      |SI FSalida = 0; |Y #dscam008#39 = "C"; |Y #dscam008#17 = #dscaz132#0;
         |SI #dscam008#14 = "L";
            #dscam009#14 = #dscam008#40;
            #dscam009#3  = 99;
            |LEE 000#dscam009.];
            |SI FSalida = 0;
               |SI #dscam009#14 ! #dscam008#40;
                  |LEE 000#dscam009.a;
                  |SI FSalida = 0;
                     |SI #dscam009#14 = #dscam008#40;
                        nLinea = #dscam009#3 + 1;
                     |FINSI;
                  |FINSI;
                  |LIBERA #dscam009;
               |FINSI;
            |SINO;
               |LEE 000#dscam009.u;
               |SI FSalida = 0;
                  |SI #dscam009#14 = #dscam008#40;
                     nLinea = #dscam009#3 + 1;
                  |FINSI;
               |FINSI;
            |FINSI;

            |DDEFECTO #dscam009;
            #dscam009#14 = #dscam008#40;
            #dscam009#3  = nLinea;
            |GRABA 020#dscam009.b;
            #dscam009#13 = #dscam050#2;         || Libro
            #dscam009#0  = #dscam050#4;         || Serie
            #dscam009#1  = #dscam050#3;         || Factura
            #dscam009#2  = #dscam050#5;         || Recibo
            #dscam009#4  = #dscam049#10;        || Cuenta de pago
            #dscam009#5  = "RCC";               || Tipo de movimiento
            #dscam009#6  = #dscam050#6;         || Fecha de vencimiento
            #dscam009#7  = #dscam008#23;        || Total liquidado DIVISA
            #dscam009#20 = #dscam008#57;        || Total liquidado BASE
            #dscam009#8  = #dscam050#7;         || Importe efecto DIVISA
            #dscam009#21 = #dscam050#20;        || Importe efecto BASE
            #dscam009#9  = 0;
            |GRABA 020#dscam009.a; |LIBERA #dscam009;
            #dscam008#23 = #dscam008#23 - #dscam009#8;
            #dscam008#57 = #dscam008#57 - #dscam009#21;
         |FINSI;
      |SINO;
         |MENAV "    Problemas con el documento seleccionado. Proceso cancelado";
         FEstado = -1;
         |ERROR; |ACABA;
      |FINSI;

      #dscam008#26 = "01.01.0000";
      #dscam008#14 = "P";
      #dscam008#15 = "Pendiente de pago";
      #dscam008#17 = 0;
      #dscam008#37 = 0;
      #dscam008#39 = "";
      #dscam008#47 = "";
   |SINO;
      #dscam009#14 = #dscam050#13;
      #dscam009#3  = #dscam050#14;
      |LEE 000#dscam009.=;
      |SI FSalida = 0; |Y #dscam009#5 = "PCF";
         |SI fFechaCob = "01.01.0000"; fFechaCob = #dscam009#6; |FINSI;

         |PARA; |SI FSalida = 0; |Y #dscam009#14 = #dscam050#13;
          |Y #dscam009#5 ! "RCC"; |HACIENDO;
            |LEE 000#dscam009.s;
         |SIGUE;
         |SI #dscam009#14 = #dscam050#13;
            |SI #dscam009#5 = "RCC";
               #dscam008#26 = fFechaCob;
               #dscam008#14 = "L";
               #dscam008#15 = "Recibo liquidado";
               #dscam008#17 = #dscaz132#0;
               #dscam008#37 = #dscaw096#0;
               #dscam008#39 = "C";
               #dscam008#47 = "Confirme";

               #dscam008#23 = #dscam008#23 + #dscam009#8;
               #dscam008#57 = #dscam008#57 + #dscam009#21;
               |BORRA 020#dscam009.a;
            |FINSI;
         |FINSI;
      |SINO;
         #dscam008#26 = #dscam049#1;
         #dscam008#14 = "E";
         #dscam008#15 = "Englobado en confirme";
         #dscam008#17 = #dscaz132#0;
         #dscam008#37 = #dscaw096#0;
         #dscam008#39 = "C";
         #dscam008#47 = "Confirme";
      |FINSI;
   |FINSI;

   #dscam008#25 = #dscam008#22 + #dscam008#24 + #dscam008#38;
   #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55;
   #dscam008#31 = #dscam008#25 - #dscam008#23;
   #dscam008#58 = #dscam008#56 - #dscam008#57;
   |GRABA 020#dscam008.a; |LIBERA #dscam008;
|FPRC;

|PROCESO Tipo11w096; |TIPO 11;
   |SI FSalida = 10;
      |SI #dscaw096#6 = " ";
         |HAZ PideEnlace;
         |SI aCodEnlace ! "ERROR";
            |SI aCodEnlace ! "    ";
               #dscaw096#12 = aCodEnlace;
               aAlfa = "ac" + Usuario; |NOME_DAT #14 aAlfa;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = aCodEnlace;    #dscaw013#0  = 1;
               #dscaw013#13 = "dscam050";    #dscaw013#14 = 0;
               #dscaw013#11 = "N";           #dscaw013#12 = 5;
               #dscaw013#5  = #dscaz132#0;   #dscaw013#6 = #dscaz132#0;
               |GRABA 020#dscaw013.n;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = aCodEnlace;    #dscaw013#0  = 2;
               #dscaw013#13 = "dscam050";    #dscaw013#14 = 1;
               #dscaw013#11 = "N";           #dscaw013#12 = 3;
               #dscaw013#5  = #dscaw096#0;   #dscaw013#6 = #dscaw096#0;
               |GRABA 020#dscaw013.n;
               |CIERRA #dscaw013;
               aAlfa = aCodEnlace; |QBF aAlfa;
               aAlfa = "dscam033.tab;" + aAlfa;
               |LIBERA #dscam049; |CIERRAT #dscam049;
               |LIBERA #dscam050; |CIERRAT #dscam050;
               |SUB_EJECUTA_NP aAlfa;
               |ABRET #dscam049; |LEE 101#dscam049.=;
               |ABRET #dscam050; |LEE 101#dscam050.=;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;

            #dscaw096#6   = "*";
            FEstado = 0; |HAZ ActRecibo;
            |SI FEstado = 0;
               nTotSelec = nTotSelec + 1;
               #dscaw096#12  = aCodEnlace;
               |GRABA 020#dscaw096.a; |PINTA #dscaw096#6;
            |FINSI;
         |SINO;
            aCodEnlace = "";
         |FINSI;
      |SINO;
         aAlfa = "    SSi desmarca esta linea, eliminara la reclamacion de este documento. " + &191 + " Continuar ? ";
         |CONFI aAlfa;
         |SI FSalida = 0;
            |SI #dscam051#1 = "S";
               aAlfa = "ac" + Usuario; |NOME_DAT #14 aAlfa;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscaw096#12;  #dscaw013#0  = 1;
               #dscaw013#13 = "dscam050";    #dscaw013#14 = 0;
               #dscaw013#11 = "N";           #dscaw013#12 = 5;
               #dscaw013#5  = #dscaz132#0;   #dscaw013#6 = #dscaz132#0;
               |GRABA 020#dscaw013.n;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscaw096#12;  #dscaw013#0  = 2;
               #dscaw013#13 = "dscam050";    #dscaw013#14 = 1;
               #dscaw013#11 = "N";           #dscaw013#12 = 3;
               #dscaw013#5  = #dscaw096#0;   #dscaw013#6 = #dscaw096#0;
               |GRABA 020#dscaw013.n;
               |CIERRA #dscaw013;
               aAlfa = #dscaw096#12; |QBF aAlfa;
               aAlfa = "dscam033.tab;" + aAlfa + ",B";
               |LIBERA #dscam049; |CIERRAT #dscam049;
               |LIBERA #dscam050; |CIERRAT #dscam050;
               |SUB_EJECUTA_NP aAlfa;
               |ABRET #dscam049; |LEE 101#dscam049.=;
               |ABRET #dscam050; |LEE 101#dscam050.=;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;

            nTotSelec = nTotSelec - 1;
            #dscaw096#6  = " ";
            FEstado = 0; |HAZ ActRecibo;
            |SI FEstado = 0;
               #dscaw096#12 = "";
               |GRABA 020#dscaw096.a; |PINTA #dscaw096#6;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO RellenaLin;
   #dscam008#40 = #dscam050#13;
   |LEE 000#dscam008.=;
   |SI FSalida ! 0; |DDEFECTO #dscam008; |FINSI;

   |DDEFECTO #dscaw096;
   #dscaw096#0  = #dscam050#1;
   #dscaw096#1  = #dscam050#13;
   #dscaw096#3  = #dscam050#10;
   #dscaw096#4  = #dscam050#6;
   #dscaw096#5  = #dscam050#7;
   |SI #dscam008#14 = "P";
      nTotSelec = nTotSelec + 1;
      #dscaw096#6 = "*"; aAlfa = " " * 50;
      |ABRE #dscam067; |DDEFECTO #dscam067;
      #dscam067#0 = "CF";
      #dscam067#1 = #dscam050#0;
      #dscam067#2 = #dscam050#1;
      #dscam067#3 = "";
      |LEE 000#dscam067.];
      |SI FSalida = 0; |Y #dscam067#0 = "CF"; |Y #dscam067#1 = #dscam050#0;
       |Y #dscam067#2 = #dscam050#1; |Y #dscam067#3 = aAlfa;
         #dscaw096#12 = #dscam067#10;
      |FINSI;
      |CIERRA #dscam067;
   |SINO;
      #dscaw096#6 = " ";
   |FINSI;
   #dscaw096#7  = #dscam050#4;
   #dscaw096#8  = #dscam050#3;
   #dscaw096#9  = #dscam050#5;
   #dscaw096#10 = #dscam050#35;
   #dscaw096#11 = #dscam050#2;
   |GRABA 020#dscaw096.n;
|FPRC;

|DEFBUCLE RellenaLin;
#dscam050#1;
;
#dscaz132#0, 001;
#dscaz132#0, 999;
;
NULL,RellenaLin;
|FIN;

|PROGRAMA;
   |HAZ Tipo8;

   |CLS;
   |CABEZA "Reclamacion confirme";
   |PINPA #0#0; |PINDA #0#0;
   |ENTLINEAL #1#dscaw096, -1, 7, 20, 1, Inf, Sup;

|ET PideDatos;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |ABRE #dscam049; |ABRE #dscam050;
      |ABRE #dscam008; |ABRE #dscam009;
      aAlfa = "tr" + Usuario; |NOME_DAT #dscaw096#aAlfa#;
      |DELINDEX #dscaw096; |ABRE #dscaw096;
      #dscam049#0 = #dscaz132#0;
      |LEE 101#dscam049.=;
      |SI FSalida ! 0;
         |MENAV "    Confirme inexistente"; |VETE PideDatos;
      |SINO;
         |SI #dscam049#7 = "N";
            |MENAV "    Confirme no emitido"; |VETE PideDatos;
         |FINSI;
      |FINSI;

      #dscaz132#1 = #dscam049#1;
      #dscaz132#2 = #dscam049#2;
      #dscaz132#3 = #dscam049#3;
      #dscaz132#4 = #dscam049#4;
      #dscaz132#5 = #dscam049#10;
      #dscaz132#6 = #dscam049#12;
      #dscaz132#7 = #dscam049#13;
      #dscaz132#8 = #dscam049#15;
      #dscaz132#9 = #dscam049#14;
      #dscaz132#10 = #dscam049#6;
      #dscaz132#11 = #dscam049#24;
      #dscaz132#12 = #dscam049#5;
      #dscaz132#13 = #dscam049#9;
      |PINDA #0#0;

      |BUCLE RellenaLin;

      |ENTLINEAL #1#dscaw096, -1, 4, 20, 1, Inf, Sup;

      |LIBERA #dscam049;
      |CIERRA #dscam009; |CIERRA #dscam008;
      |CIERRA #dscam049; |CIERRA #dscam050;
      |CIERRA #dscaw096; |DELINDEX #dscaw096;
   |SINO;
      aCodEnlace = "ERROR";
   |FINSI;

   |HAZ Tipo9;
|FPRO;
