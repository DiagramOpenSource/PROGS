|FICHEROS;
   dscaz109 #0;

   dscaw071 #10;
   dscam003 #11;
   dscam004 #12;
   dscam067 #13;
   dscam013 #14;

   camasil@ #100;
|FIN;

|VARIABLES;
   &aInforme = "";
   &eaDifer  = "";
   &HayConta = 0; &MaxDigit = 0;

   aAlfa   = "";
   aParte1 = "";
   aParte2 = "";
   aLong   = "";

   fFechaVto = @;

   nHandle  = 0;
   nImporte = 0;
   nParte1  = 0;
   nCalc    = 0;
   nLong    = 0;
   nParte2  = 0;
|FIN;

|PROCESO Cuenta;
   aAlfa = #dscaz109#Campo#; |QBF aAlfa;
   aAlfa = aAlfa - ".";
   |PARA; |SI FSalida ! 0; |HACIENDO;
      nParte1 = ((FSalida / 100) ! 0) + 99;
      nParte2 = FSalida + 98;
      aParte1 = aAlfa % nParte1; aParte2 = aAlfa % nParte2;
      aLong = aAlfa % 0; nLong = aLong;
      nCalc = MaxDigit - nLong;
      aAlfa = aParte1 + ("0" * nCalc) + aParte2;
      aAlfa = aAlfa - ".";
   |SIGUE;
   #dscaz109#Campo# = aAlfa; |PINTA #dscaz109#Campo#;
|FPRC;

|PROCESO Asientos;
   fFechaVto = "00.00.0000";
   |ABRE #dscam067;
   |SELECT #2#dscam067;
   #dscam067#8 = #48#14;
   #dscam067#9 = #48#19;
   #dscam067#4 = #camasil@#0;
   #dscam067#5 = #camasil@#1;
   #dscam067#6 = #camasil@#2;
   #dscam067#7 = #camasil@#3;
   |LEE 000#dscam067.=;
   |SI FSalida = 0;
      aAlfa = #dscam067#0; |QBF aAlfa;
      |SI aAlfa = "RM";
         |ABRE #dscam013; |ABRE #dscam003;
         #dscam013#0 = #dscam067#1;
         #dscam013#1 = #dscam067#2;
         |LEE 000#dscam013.=;
         |SI FSalida ! 0; |DDEFECTO #dscam013; |FINSI;
         #dscam003#40 = #dscam013#16;
         |LEE 000#dscam003.=;
         |SI FSalida ! 0; |DDEFECTO #dscam003; |FINSI;
         fFechaVto = #dscam003#3;
         |CIERRA #dscam013; |CIERRA #dscam003;
      |FINSI;
   |FINSI;
   |SELECT #1#dscam067;
   |CIERRA #dscam067;

   |SI fFechaVto ! "00.00.0000";
      |SI #dscaz109#8 > fFechaVto; |O fFechaVto > #dscaz109#9; |ACABA; |FINSI;
   |FINSI;

   |SI #camasil@#6 ] #dscaz109#2; |Y #camasil@#6 [ #dscaz109#3;
      #dscaw071#0 = #camasil@#4;
      |LEE 000#dscaw071.=;
      |SI FSalida ! 0;
         |DDEFECTO #dscaw071;
         #dscaw071#0 = #camasil@#4;
         |GRABA 020#dscaw071.c;
      |FINSI;
      |SI #camasil@#8 = "H";
         #dscaw071#1 = #dscaw071#1 - #camasil@#9;
      |SINO;
         #dscaw071#1 = #dscaw071#1 + #camasil@#9;
      |FINSI;
      |GRABA 020#dscaw071.a;
   |FINSI;
|FPRC;

|DEFBUCLE Asientos2;
#camasil@#3004;
;
#dscaz109#0, 0, "01.01.0000", 000000;
#dscaz109#1, 9, "31.12.9999", 999999;
;
NULL,Asientos;
|FIN;

|DEFBUCLE Asientos1;
#camasil@#3004;
;
#dscaz109#0, "01.01.0000", 000000, 0000;
#dscaz109#1, "31.12.9999", 999999, 9999;
;
NULL,Asientos;
|FIN;

|PROCESO Movtos;
   |SI #dscam004#5 = "IMP"; nImporte = nImporte - (#dscam004#9 + #dscam004#12 + #dscam004#13 + #dscam004#14); |FINSI;
   |SI #dscam004#5 = "RCE"; nImporte = nImporte - (#dscam004#8 + #dscam004#12 + #dscam004#13 + #dscam004#14); |FINSI;
   |SI #dscam004#5 = "REM"; nImporte = nImporte + #dscam004#8; |FINSI;
   |SI #dscam004#5 = "COB"; nImporte = nImporte + #dscam004#8; |FINSI;
   |SI #dscam004#5 = "RCB"; nImporte = nImporte + #dscam004#8; |FINSI;
   |SI #dscam004#5 = "CAC"; nImporte = nImporte + #dscam004#8; |FINSI;
   |SI #dscam004#5 = "COP"; nImporte = nImporte + #dscam004#8; |FINSI;
   |SI #dscam004#5 = "RTA"; nImporte = nImporte + #dscam004#8; |FINSI;

   |SI #dscam004#5 ! "IMP"; |Y #dscam004#5 ! "RCE"; |Y #dscam004#5 ! "REM";
    |Y #dscam004#5 ! "COB"; |Y #dscam004#5 ! "RCB"; |Y #dscam004#5 ! "CAC";
    |Y #dscam004#5 ! "COP"; |Y #dscam004#5 ! "RTA";
       nImporte = nImporte - (#dscam004#9 + #dscam004#12 + #dscam004#13 + #dscam004#14 + #dscam004#32);
       nImporte = nImporte + #dscam004#8;
   |FINSI;
|FPRC;

|DEFBUCLE Movtos;
#dscam004#1;
;
#dscam003#40, 01;
#dscam003#40, 99;
;
NULL,Movtos;
|FIN;

|PROCESO Recibos;
   |SI #dscam003#14 = "A"; |O #dscam003#14 = "D"; |ACABA; |FINSI;

   #dscaw071#0 = #dscam003#5;
   |LEE 000#dscaw071.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscaw071;
      #dscaw071#0 = #dscam003#5;
      |GRABA 020#dscaw071.c;
   |FINSI;

   |SI #dscaz109#4 = "S";
      nImporte = 0; |BUCLE Movtos;
   |SINO;
      nImporte = #dscam003#31;
   |FINSI;
   #dscaw071#2 = #dscaw071#2 + nImporte;
   |GRABA 020#dscaw071.a;
|FPRC;

|DEFBUCLE Recibos;
#dscam003#4;
47,69,3;
#dscaz109#0,0000000001,"N"," ",#dscaz109#8;
#dscaz109#1,9999999999,"N"," ",#dscaz109#9;
;
NULL,Recibos;
|FIN;

|PROCESO Temporal;
   nCalc = #dscaw071#1 - #dscaw071#2;
   |SI nCalc < 0; nCalc = -nCalc; |FINSI;
   |SI nCalc > #dscaz109#7;
      eaDifer = "<--";
   |SINO;
      eaDifer = "   ";
   |FINSI;
   |SI #dscaz109#6 = "T";
      |PRINT;
   |SINO;
      |SI nCalc > #dscaz109#7; |PRINT; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Temporal;
#dscaw071#1;
;
INICIO;
FINAL;
;
NULL,Temporal;
|FIN;

|PROGRAMA;
   |HAZ Tipo8;
   |ABRE #dscaz109;
   |LEE 000#dscaz109.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscaz109;
      |GRABA 020#dscaz109.c;
   |FINSI;

   |CLS;
   |CABEZA " Informe saldos contables ";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;

      |GRABA 020#dscaz109.a;

      |DELINDEX #dscaw071; |ABRE #dscaw071;
      aAlfa = #48#16; |QBF aAlfa;
      aAlfa = aAlfa + "def/camaasil.mas";
      |XABRE "E", aAlfa, nHandle;
      |SI FSalida < 0;
         |MENAV "    No encuentro el def de asientos contables ";
         |ERROR; |ACABA;
      |FINSI;
      |CARGA_DEF aAlfa, camasil@;
      |SI FSalida = 0;
         aAlfa = #48#16; |QBF aAlfa;
         aAlfa = aAlfa + "fich/" + (("00000" + #48#14) % -105) + #48#19 + "/";
         |PATH_DAT #100 aAlfa;
         aAlfa = aAlfa - "agicont";
         |SI FSalida ! 0;
            |BUCLE Asientos2;
         |SINO;
            |BUCLE Asientos1;
         |FINSI;
         |DESCARGA_DEF #camasil@;
      |FINSI;
      |BUCLE Recibos;

      |IMPRE 0;
      |SI FSalida ! 0; |ACABA; |FINSI;

      aInforme = "Informe cuadre saldos"; |HAZ ObtenInforme;
      |SI aInforme = "Informe cuadre saldos"; aInforme = "dscaz109"; |FINSI;
      |INFOR aInforme;
      |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

      |BUCLE Temporal;

      |PIEINF; |FININF; |FINIMP;
      |CIERRA #dscaw071;
   |FINSI;

   |CIERRA #dscaz109;
   |HAZ Tipo9;
|FPRO;
