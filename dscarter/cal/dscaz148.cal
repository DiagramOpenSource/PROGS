|FICHEROS;
   dscaz148 #0;

   dscaw110 #10,MANTE;
   dscam008 #11;

   cacuent@ #100;
   canempr@ #101;
|FIN;

|VARIABLES;
   aAlfa   = "";
   nAntTR  = "";
   aParte1 = "";
   aParte2 = "";

   nTecla  = 0;
   nCalc   = 0;
   nMaxDig = 0;
|FIN;

|PROCESO AntesTR; |TIPO 7;
   nAntTR = #dscaw110#10;
|FPRC;

|PROCESO TrasTR;
   |SI #dscaw110#10 ! nAntTR;
      #dscaw110#11 = "*";
   |FINSI;
|FPRC;

|PROCESO RecogeRecibos;
   |SI #dscam008#14 ! "P"; |Y #dscam008#14 ! "C"; |ACABA; |FINSI;

   |DDEFECTO #dscaw110;

   #dscaw110#0  = #dscam008#27;
   #dscaw110#1  = #dscam008#0;
   #dscaw110#2  = #dscam008#1;
   #dscaw110#3  = #dscam008#2;
   #dscaw110#4  = #dscam008#63;
   #dscaw110#5  = #dscam008#5;
   #dscaw110#6  = #dscam008#6;
   #dscaw110#7  = #dscam008#4;
   #dscaw110#8  = #dscam008#3;
   #dscaw110#9  = #dscam008#31;
   #dscaw110#10 = #dscaz148#2;
   #dscaw110#12 = #dscam008#40;
   |SI #dscaz148#18 = "S";
      #dscaw110#11 = "*";
   |SINO;
      #dscaw110#11 = " ";
   |FINSI;
   |GRABA 020#dscaw110.c;
|FPRC;

|DEFBUCLE RecogeRecibos;
#dscam008#2;
4,3,5,12;
#0#4,  #0#5,  #0#6,  #0#7,  #0#8,  #0#9,  #0#10, #0#0;
#0#11, #0#12, #0#13, #0#14, #0#15, #0#16, #0#17, #0#0;
;
NULL,RecogeRecibos;
|FIN;

|RUTINA inf;
   #dscaw110#0 = 0;
   #dscaw110#1 = "     ";
   #dscaw110#2 = 000000;
   #dscaw110#3 = 000;
   #dscaw110#12 = 0;
|FRUT;

|RUTINA sup;
   #dscaw110#0 = 99;
   #dscaw110#1 = "zzzzz";
   #dscaw110#2 = 999999;
   #dscaw110#3 = 999;
   #dscaw110#12 = 9999999999;
|FRUT;

|PROCESO CambiaTR;
   #dscam008#40 = #dscaw110#12;
   |LEE 101#dscam008.=;
   |SI FSalida = 0;
      #dscam008#12 = #dscaw110#10;
      |GRABA 020#dscam008.a; |LIBERA #dscam008;
   |FINSI;
|FPRC;

|DEFBUCLE CambiaTR;
#dscaw110#1;
11;
0000000000, 00, "     ", 000000, 000, "*";
9999999999, 99, "zzzzz", 999999, 999, "*";
;
NULL, CambiaTR;
|FIN;

|PROCESO Ctas;
   nTecla = FSalida;

   |SI nTecla = 10;
      aAlfa = #48#16; |QBF aAlfa;
      aAlfa = aAlfa + "def/canempre.mas";
      |CARGA_DEF aAlfa, canempr@;
      |SI FSalida = 0;
         aAlfa = #48#16; |QBF aAlfa;
         aAlfa = aAlfa + "def/cacuenta.mas";
         |CARGA_DEF aAlfa, cacuent@;
         |SI FSalida = 0;
            aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "fich/";
            |PATH_DAT #canempr@#aAlfa#;
            aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "fich/" + (("00000" + #48#14) % -105) + #48#19 + "/";
            |PATH_DAT #cacuent@#aAlfa#;
            |ABRE #canempr@; |ABRE #cacuent@;
            #canempr@#2 = #48#14;
            #canempr@#3 = #48#19;
            |LEE 000#canempr@.=;
            |SI FSalida = 0;
               #cacuent@#0 = #dscaz148#Campo#;
               |LEE 000#cacuent@.];
               |CONSULTA_CLAVE #1#cacuent@;
               |SI FSalida = 0;
                  #dscaz148#Campo# = #cacuent@#0; |PINTA #dscaz148#Campo#;
               |SINO;
                  |ERROR;
               |FINSI;
            |FINSI;
         |FINSI;
         |CIERRA #cacuent@; |DESCARGA_DEF #cacuent@;
      |FINSI;
      |CIERRA #canempr@; |DESCARGA_DEF #canempr@;
   |FINSI;

   aAlfa = #dscaz148#Campo#; |QBF aAlfa;
   aAlfa = aAlfa - ".";
   |SI FSalida ! 0;
      aAlfa = #48#16; |QBF aAlfa;
      aAlfa = aAlfa + "def/canempre.mas";
      |CARGA_DEF aAlfa, canempr@;
      |SI FSalida = 0;
         aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "fich/";
         |PATH_DAT #canempr@#aAlfa#;
         |ABRE #canempr@;
         #canempr@#2 = #48#14;
         #canempr@#3 = #48#19;
         |LEE 000#canempr@.=;
         |SI FSalida = 0;
            nMaxDig = #canempr@#14;
            |SI #canempr@#15 > nMaxDig; nMaxDig = #canempr@#15; |FINSI;
            |SI #canempr@#16 > nMaxDig; nMaxDig = #canempr@#16; |FINSI;
            |SI #canempr@#17 > nMaxDig; nMaxDig = #canempr@#17; |FINSI;
            |SI #canempr@#18 > nMaxDig; nMaxDig = #canempr@#18; |FINSI;
            |SI #canempr@#19 > nMaxDig; nMaxDig = #canempr@#19; |FINSI;

            aAlfa = #dscaz148#Campo#; |QBF aAlfa;
            aAlfa = aAlfa - ".";
            |PARA; |SI FSalida ! 0; |HACIENDO;
               nCalc = FSalida + 98;               aParte2 = aAlfa % nCalc;
               nCalc = ((FSalida / 100) ! 0) + 99; aParte1 = aAlfa % nCalc;
               aAlfa = aParte1 % 0; nCalc = aAlfa;
               aAlfa = aParte2 % 0; nCalc = nCalc + aAlfa;
               nCalc = nMaxDig - nCalc;
               aAlfa = aParte1 + ("0" * nCalc) + aParte2;
               #dscaz148#Campo# = aAlfa; |PINTA #dscaz148#Campo#;

               aAlfa = #dscaz148#Campo#; |QBF aAlfa;
               aAlfa = aAlfa - ".";
            |SIGUE;
         |FINSI;
         |CIERRA #canempr@; |DESCARGA_DEF #canempr@;
         |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA " Cambio tipo de recibo masivo ";

   aAlfa = "ct" + Usuario; |NOME_DAT #dscaw110#aAlfa#;
   |DELINDEX #dscaw110; |ABRE #dscaw110;
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |BUCLE RecogeRecibos;
      |ENTLINEAL #1#dscaw110, -5, 2, 18, 1, inf, sup;
      aAlfa = "    N" + &191 + " Conforme con volcar los cambios ? ";
      |CONFI aAlfa;
      |SI FSalida = 0;
         |ABRE #dscam008; |BUCLE CambiaTR; |CIERRA #dscam008;
      |FINSI;
   |FINSI;
   |CIERRA #dscaw110; |DELINDEX #dscaw110;
|FPRO;
