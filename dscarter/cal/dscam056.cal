|FICHEROS;
   dscam056 #0;
   dscam057 #1,MANTE;
   dscam003 #2;
   dscam004 #3;

   dscam048 #4;
   dscam016 #5;
   dscam017 #6;
   dscaw017 #7,MANTE;
   dscam051 #8;

   dscaw013 #12;
|FIN;

|VARIABLES;
   &eaFichClas = "";  &eaTipoClas = ""; &enSwClas = 0;
   &enNumDocum = 0;   &enTipoRec = 0;
   &HayConta   = 0;

   aAlfa = "";
   nSwError = 0;

   EntidadAnt   = "";
   DocumAnt     = "";

   nImpor       = 0;
   fFecha       = @;

   ModoEntrada  = 0;
   LinCob       = 0;
   Flag         = 0;
   NumLiqu      = 0;
   SwClave      = 0;
   nLinea       = 1;
   Parte        = 0;
   Parte1       = 0;
   Parte2       = 0;
   Long         = 0;
   SwError      = 0;

   CtaCliente   = "";
   CodCliente   = "";
   LongAlfa     = "";
   Comodin      = "";
   Part1        = "";
   Part2        = "";

   &CambioDivVn = 0;
   &CambioDivCm = 0;
   &CmpDivisa   = 0;
   &nDeci_Base  = 0;
   &nDeci_Div   = 0;
   &PosLibro    = 0;
   &PosSerie    = 0;
   &PosFactu    = 0;
   &PosRecib    = 0;
   &enDocum     = 0;
   &MaxDigit    = 0;
   &Divisa      = "";
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = "";

    &nEmpCartera = 0; &enEmpGestion = 0;
    &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = "";

|FIN;

|PROCESO Comienzo; |TIPO 7;
   CmpDivisa = 10;
|FPRC;

|PROCESO Decimales; |TIPO 13;
   Divisa = #dscam057#10; |HAZ Tipo13;
|FPRC;

|PROCESO TomaDatosRecibo;
   |ABRE #dscam003;
   #dscam003#40 = #dscam057#9;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#14 = "M";
         |SI #dscam003#33 = #dscam056#0;
            #dscam057#10 = #dscam003#57;
            #dscam057#11 = #dscam003#59; |HAZ Decimales;
            #dscam057#7  = #dscam003#31; |PINTA #dscam057#7;
            #dscam057#13 = #dscam003#65;
         |SINO;
            |MENAV "    Este recibo esta asignado a otro cobrador.";
            |ERROR;
         |FINSI;
      |SINO;
         |MENAV "    Este recibo no esta asignado a ningun cobrador";
         |ERROR;
      |FINSI;

      enSwClas   = 1; eaFichClas = "dscam056"; eaTipoClas = #dscam003#12;
      |HAZ CompruebaClas;
      |SI eaFichClas = "ERROR";
         |MENAV "    Documento inoperable en el perfil actual ";
         |ERROR;
      |FINSI;
      |SI eaFichClas = "INFOR";
         |CONFI "    Documento inoperable en el perfil actual. Cambiar Tipo recibo ?";
         |SI FSalida = 0;
            |CIERRA #dscam003;
            eaFichClas = "dscam056";
            enNumDocum = #dscam003#40; enTipoRec = #dscam003#12; |HAZ CambiaTR;
         |SINO;
            |CIERRA #dscam003; |ERROR; |ACABA;
         |FINSI;
      |FINSI;
   |SINO;
      |MENAV "    Recibo inexistente";
      |ERROR;
   |FINSI;
   |CIERRA #dscam003;
|FPRC;

|PROCESO ActRecibo; |TIPO 2;
   ModoEntrada = (FEntrada / 100) ! 0;

   |SI ModoEntrada = 1;
      #dscam003#40 = #dscam057#9;
      |LEE 101#dscam003.=;
      |SI FSalida ! 0;
         |MENAV "    Recibo inexistente";
         |CIERRA #dscam003; |LIBERA #dscam003;
         |ERROR;
         |ACABA;
      |FINSI;
      |LIBERA #dscam003;
   |FINSI;

   #dscam056#1 = #dscam056#1 -. 1;            |PINTA #dscam056#1;
   #dscam056#3 = #dscam056#3 -. #dscam057#7;  |PINTA #dscam056#3;
   #dscam056#5 = #dscam056#2 -  #dscam056#3;  |PINTA #dscam056#5;
   #dscam057#19 = "*";                        |PINTA #dscam057#19;
|FPRC;

|RUTINA inf056;
   #dscam057#1 = 1;
|FRUT;

|PROCESO Volcado;

   |SI #dscam057#19 = " "; |ACABA; |FINSI;

   #dscam048#0 = #dscam056#0;
   |LEE 000#dscam048.=;

   #dscam003#40 = #dscam057#9;
   |LEE 101#dscam003.=;

   |SI #dscam057#14 ! "          ";
      |ABRE #dscam004;
      #dscam004#17 = #dscam057#9;
      #dscam004#3  = 1;
      |LEE 000#dscam004.];
      |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
         |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
            LinCob = #dscam004#3 + 1;
            |LEE 000#dscam004.s;
         |SIGUE;
      |SINO;
         LinCob = 1;
      |FINSI;

      |DDEFECTO #dscam004;
      #dscam004#17 = #dscam057#9;
      #dscam004#15 = #dscam003#27;
      #dscam004#0  = #dscam003#0;
      #dscam004#1  = #dscam003#1;
      #dscam004#2  = #dscam003#2;
      #dscam004#3  = LinCob;
      #dscam004#4  = #dscam048#14;
      #dscam004#5  = "RPT";
      #dscam004#6  = #dscaw017#8;
      #dscam004#11 = #dscam057#12;
      aAlfa = "Docum. " + (("0000" + #dscaw017#0) % -104) + "/" + #dscaw017#2;
      #dscam004#16 = aAlfa;
      #dscam004#44 = #dscam057#22;
      #dscam004#45 = #dscam004#44 * #dscam003#59;
      #dscam004#51 = #dscam057#16;
      #dscam004#52 = #dscam057#14;
      #dscam004#53 = #dscam057#15;
      |GRABA 020#dscam004.c;
      |LIBERA #dscam004; |CIERRA #dscam004;

      |SI EntidadAnt ! #dscam057#16; |O DocumAnt ! #dscam057#14;
         eaUsuario = Usuario % 0810;
         eaDescr   = "ALTA PAGARE/TALON ("+ (("0000" + #dscam057#16) % -104) + "/" + (("0000000000" + #dscam057#14) % -110) + ") DESDE LIQUIDACION REPRESENTANTES";
         eaTipoReg = "PT";  eaNumero = (("0000" + #dscam057#16) % -104) + (("00000000000" + #dscam057#14) % -110);
         eaTipoOp  = "A";   enImpAnt = 0; enImpAct = #dscam057#7;
         |HAZ GrabaAudit;
         EntidadAnt = #dscam057#16; DocumAnt = #dscam057#14;
      |FINSI;

      #dscam003#14 = "T";
      #dscam003#15 = "Pagare/talon de cliente";
      #dscam003#70 = #dscam057#14;
      #dscam003#71 = #dscam057#15;
      #dscam003#72 = #dscam057#16;
      #dscam003#73 = #dscam057#17;
      #dscam003#74 = #dscam057#18;
      #dscam003#78 = #dscam057#22;
      #dscam003#79 = #dscam057#22 * #dscam003#59;
      #dscam003#90 = "S";
   |SINO;
      |ABRE #dscam004;
      #dscam004#17 = #dscam057#9;
      #dscam004#3  = 1;
      |LEE 000#dscam004.];
      |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
         |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
            LinCob = #dscam004#3 + 1;
            |LEE 000#dscam004.s;
         |SIGUE;
      |SINO;
         LinCob = 1;
      |FINSI;

      |DDEFECTO #dscam004;
      #dscam004#17 = #dscam057#9;
      #dscam004#3 = LinCob;
      |GRABA 020#dscam004.b;
      #dscam004#0  = #dscam003#0;
      #dscam004#1  = #dscam003#1;
      #dscam004#2  = #dscam003#2;
      #dscam004#4  = #dscam048#14;
      #dscam004#5  = "RCB";
      #dscam004#6  = ~;
      #dscam004#7  = #dscam003#23;
      #dscam004#8  = #dscam003#31;
      #dscam004#11 = #dscam057#12;
      #dscam004#15 = #dscam003#27;
      Comodin = "Cob. cobrador " + #dscam056#0;
      #dscam004#16 = Comodin;
      #dscam004#25 = #dscam003#61;
      #dscam004#26 = #dscam003#65;
      #dscam004#33 = #dscam057#11;
      |GRABA 020#dscam004.a;
      |LIBERA #dscam004; |CIERRA #dscam004;
      eaUsuario = Usuario % 0810;
      eaTipoReg = "CB";  eaNumero = ("000000000" + #dscam003#40) % -109;
      eaDescr   = "ALTA COBRO RECIBO (" + (("000000000" + #dscam004#17) % -109) + "/" + (("000" + #dscam004#3) % -103);
      eaDescr   = eaDescr + ") DESDE LIQUIDACION DE COBRADORES";
      eaTipoOp  = "A"; enImpAnt = #dscam003#23; enImpAct = #dscam003#30;
      |HAZ GrabaAudit;

      nImporte = #dscam003#65;
      #dscam003#31 = 0; #dscam003#65 = 0;
      #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
      #dscam003#14 = "L"; #dscam003#15 = "Recibo liquidado";
   |FINSI;

   |GRABA 020#dscam003.a; |LIBERA #dscam003;

   |SI #dscam051#3 = "S";
      || nEmpCartera = #48#0; enEmpGestion = #dscam003#46;
      nEmpCartera = -1;      enEmpGestion = #dscam003#46;
      eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
      |SI #dscam003#16 > 0;
         eaTipoOper = "-7";
      |SINO;
         eaTipoOper = "-4";
      |FINSI;
      |HAZ BucleRiesgo;
   |FINSI;

   |SELECT #2#dscam017;
   #dscam017#9 = #dscam057#9;
   |LEE 101#dscam017.=;
   |SI FSalida = 0;
      #dscam016#0 = #dscam017#0;
      |LEE 101#dscam016.=;
      |SI FSalida = 0;
         #dscam016#3 = #dscam016#3 - 1;
         #dscam016#4 = #dscam016#4 - #dscam057#13;
         |SI #dscam016#3 = 0;
            |BORRA 020#dscam016.a;
         |SINO;
            |GRABA 020#dscam016.a;
         |FINSI;
      |FINSI;
      |LIBERA #dscam016;

      |BORRA 020#dscam017.a;
   |FINSI;
   |SELECT #1#dscam017;

   |SI HayConta = 1;
      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #12 Comodin;
      |DELINDEX #dscaw013; |ABRE #dscaw013;

      |SI #dscam057#14 ! "          ";
         |DDEFECTO #dscaw013;
         #dscaw013#0  = 1;            #dscaw013#15 = #dscam056#4;
         #dscaw013#3  = #dscam057#16; #dscaw013#4  = #dscam057#16;
         #dscaw013#11 = "A";          #dscaw013#12 = 4;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 51;
         |GRABA 020#dscaw013.n;

         |DDEFECTO #dscaw013;
         #dscaw013#0  = 2;            #dscaw013#15 = #dscam056#4;
         #dscaw013#3  = #dscam057#14; #dscaw013#4  = #dscam057#14;
         #dscaw013#11 = "A";          #dscaw013#12 = 10;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 52;
         |GRABA 020#dscaw013.n;
      |SINO;
         |DDEFECTO #dscaw013;
         #dscaw013#0  = 1;            #dscaw013#15 = #dscam056#4;
         #dscaw013#5  = #dscam057#9;  #dscaw013#6  = #dscam057#9;
         #dscaw013#11 = "N";          #dscaw013#12 = 9;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
         |GRABA 020#dscaw013.n;

         |DDEFECTO #dscaw013;
         #dscaw013#0  = 2;            #dscaw013#15 = #dscam056#4;
         #dscaw013#3  = "RCB";        #dscaw013#4  = "RCB";
         #dscaw013#11 = "A";          #dscaw013#12 = 3;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
         |GRABA 020#dscaw013.n;
      |FINSI;
      |CIERRA #dscaw013;

      Comodin = "dscam033.tab;" + #dscam056#4;
      |LIBERA #dscam057; |CIERRAT #dscam057;
      |LIBERA #dscam056; |CIERRAT #dscam056;
      |SUB_EJECUTA_NP Comodin;
      |ABRET #dscam056; |LEE 101#dscam056.=;
      |ABRET #dscam057; |LEE 101#dscam057.=;

      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
   |FINSI;
|FPRC;

|DEFBUCLE Volcado;
#dscam057#1;
;
INICIO;
FINAL;
;
NULL,Volcado;
|FIN;

|RUTINA sup056;
   #dscam057#1 = 999;
|FRUT;

|PROCESO TomaDatos;
   #dscam056#1 = #dscam056#1 + #dscam016#3;
   #dscam056#2 = #dscam056#2 + #dscam016#4;
   #dscam056#3 = #dscam056#3 + #dscam016#4;
   #dscam056#5 = #dscam056#2 - #dscam056#3;
|FPRC;

|DEFBUCLE TomaDatos;
#dscam016#1;
1;
00001,#dscam056#0;
99999,#dscam056#0;
;
NULL,TomaDatos;
|FIN;

|PROCESO Busca;
   |SI FSalida ! 10; |ACABA; |FINSI;
   |PUSHV 1217 1463;
   |BLANCO 1217 1463;
   |CUADRO 1217 1463;
   |PINTA 1319, "Libro    Serie    Factura         Recibo    ";
   PosLibro = 1325; PosSerie = 1334; PosFactu = 1345; PosRecib = 1360;
   |HAZ ConsultaVentas;
   |SI enDocum ! -1;
      #dscam057#9 = enDocum;
   |SINO;
      |MENAV "    Ficha inexistente"; |ERROR;
   |FINSI;
   SwClave = 1;
   |POPV;
   |PINTA #dscam057#9;
|FPRC;

|PROCESO Volcar;
   |SELECT #2#dscam057;
   #dscam057#9 = #dscam017#9;
   |LEE 000#dscam057.=;
   |SI FSalida = 0;
      |MENAV "    Relacion ya incluida";
      |ERROR10;
      |ACABA;
   |FINSI;
   |SELECT #1#dscam057;

   Divisa = #dscam017#10; |HAZ TomaDecim;

   |DDEFECTO #dscam057;
   #dscam057#0  = #dscam056#0;
   #dscam057#1  = nLinea;            nLinea = nLinea + 1;
   #dscam057#2  = #dscam017#2;
   #dscam057#3  = #dscam017#3;
   #dscam057#4  = #dscam017#4;
   #dscam057#5  = #dscam017#5;
   #dscam057#6  = #dscam017#6;
   #dscam057#7  = #dscam017#7;
   #dscam057#8  = #dscam017#8;
   #dscam057#9  = #dscam017#9;
   #dscam057#10 = #dscam017#10;
   #dscam057#11 = #dscam017#11; |HAZ Decimales;
   #dscam057#13 = #dscam017#7;
   #dscam057#19 = "*";
   #dscam057#20 = #dscam017#12;
   #dscam057#21 = #dscam017#13;
   |GRABA 020#dscam057.n; |LEE 000#dscam057.=;

   #dscam056#1 = #dscam056#1 - 1;
   #dscam056#3 = #dscam056#3 - #dscam057#7;
   #dscam056#5 = #dscam056#2 - #dscam056#3;
   |PINTA #dscam056#1; |PINTA #dscam056#2;
   |PINTA #dscam056#3; |PINTA #dscam056#5;
|FPRC;

|DEFBUCLE Volcar;
#dscam017#1;
;
NumLiqu,001;
NumLiqu,999;
be;
NULL,Volcar;
|FIN;

|PROCESO Asignacion;
   |SI #dscam057#19 = " "; |ACABA; |FINSI;
   |SI #dscam057#14 ! "          "; |O #dscam057#16 ! "    "; |ACABA; |FINSI;

   #dscam057#14 = #dscaw017#2;
   #dscam057#15 = #dscaw017#3;
   #dscam057#16 = #dscaw017#0;
   #dscam057#17 = #dscaw017#4;
   #dscam057#18 = #dscaw017#5;
   #dscam057#22 = #dscaw017#6;
   |GRABA 020#dscam057.a;
|FPRC;

|DEFBUCLE Asignacion;
#dscam057#1;
;
INICIO;
FINAL;
;
NULL,Asignacion;
|FIN;

|PROCESO BuscaVto;
   |SI #dscam057#6 > #dscaw017#3; #dscaw017#3 = #dscam057#6; |FINSI;
   #dscaw017#6 = #dscaw017#6 + #dscam057#7;
|FPRC;

|DEFBUCLE BuscaVto;
#dscam057#1;
19;
001,"*";
999,"*";
;
NULL,BuscaVto;
|FIN;

|PROCESO MiraNumeracion;
   nSwError = 1; |ERROR10;
|FPRC;

|DEFBUCLE MiraNumeracion;
#dscam057#1;
16, 14;
001, #dscaw017#0, #dscaw017#2;
999, #dscaw017#0, #dscaw017#2;
;
NULL,MiraNumeracion;
|FIN;

|PROCESO AsignaATalon;
   |PUSHV 0501 2380;
   |DDEFECTO #dscaw017;
   |SALVA_FICHA #dscam057; |BUCLE BuscaVto; |REPON_FICHA #dscam057;
|ET DeNuevo;
   |PINPA #0#dscaw017; |PINDA #0#dscaw017;
   |ENDATOS #1#dscaw017;
   |SI FSalida = 0;
      |SALVA_FICHA #dscam057;
      nSwError = 0; |BUCLE MiraNumeracion;
      |SI nSwError = 1;
         |MENAV "    La numeracion del pagare indicada ya existe en esta relacion";
         |VETE DeNuevo;
      |FINSI;
      |BUCLE Asignacion;
      |REPON_FICHA #dscam057;
   |FINSI;
   |POPV;
|FPRC;

|PROCESO Marcados;
   #dscam003#40 = #dscam057#9;
   |LEE 000#dscam003.=;

   |SI CtaCliente ! "";
      |SI #dscam003#5 ! CtaCliente;
         SwError = 1; |ERROR10;
      |FINSI;
   |SINO;
      |SI CodCliente ! "";
         |SI #dscam003#32 ! CodCliente;
            SwError = 1; |ERROR10;
         |FINSI;
      |SINO;
         |SI #dscam003#5 ! "            ";
            CtaCliente = #dscam003#5;
         |SINO;
            CodCliente = #dscam003#32;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Marcados;
#dscam057#1;
19, 16, 14;
001,"*", "    ", "          ";
999,"*", "    ", "          ";
;
NULL,Marcados;
|FIN;

|PROCESO MiraTecla; |TIPO 11;
   |SI FSalida = 10;
      |LEE 040#dscam057.=;
      |SI FSalida = 0;
         |SI #dscam057#19 = " ";
            #dscam057#19 = "*";
            #dscam056#1 = #dscam056#1 - 1;           |PINTA #dscam056#1;
            #dscam056#3 = #dscam056#3 - #dscam057#7; |PINTA #dscam056#3;
         |SINO;
            #dscam057#19 = " ";
            #dscam056#1 = #dscam056#1 + 1;           |PINTA #dscam056#1;
            #dscam056#3 = #dscam056#3 + #dscam057#7; |PINTA #dscam056#3;
            #dscam057#14 = ""; #dscam057#15 = "01.01.0000";
            #dscam057#16 = ""; #dscam057#17 = "";
            #dscam057#18 = ""; #dscam057#22 = 0;
         |FINSI;
         #dscam056#5 = #dscam056#2 -  #dscam056#3;   |PINTA #dscam056#5;
         |GRABA 020#dscam057.a;
      |FINSI;
      |PONCONTROL 23,"si";
   |FINSI;
   |SI FSalida = 11;
      |ABRE #dscam016;
      |PUSHV 1201 1515;
      NumLiqu = 0;
|ET OtraVez;
      |MENSA "    <F2> Consulta asignaciones";
      |BLANCO 1201 1515;
      |CUADRO 1201 1515;
      |ATRI R; |PINTA 1302, " N§ Relacion "; |ATRI N;
      E_sup = 99999;
      E_inf = 0;
      NumLiqu = 1406 ? 2;
      |SI FSalida = 10;
         |BLIN 4;
         #dscam016#0 = NumLiqu;
         |LEE 000#dscam016.];
         |CONSULTA_CLAVE #1#dscam016;
         |SI FSalida = 0; NumLiqu = #dscam016#0; |FINSI;
         |VETE OtraVez;
      |FINSI;
      |BLIN 4;

      #dscam016#0 = NumLiqu;
      |LEE 000#dscam016.=;
      |SI FSalida = 0;
         |SI #dscam016#1 ! #dscam056#0;
            |MENAV "    Esta liquidacion no corresponde a este cobrador";
            |ERROR;
         |SINO;
            |SALVA_FICHA #dscam057;
            |LEE 000#dscam057.u;
            |SI FSalida = 0;
               nLinea = #dscam057#1 + 1;
            |SINO;
               nLinea = 1;
            |FINSI;
            |BUCLE Volcar;
            |REPON_FICHA #dscam057;
            |PONCONTROL 23,"si";
         |FINSI;
      |FINSI;
      |CIERRA #dscam016;
      |POPV;
   |FINSI;
   |SI FSalida = 12;
      SwError = 0;
      |SALVA_FICHA #dscam057;
      CtaCliente = "";
      CodCliente = "";
      |BUCLE Marcados;
      |REPON_FICHA #dscam057;
      |SI SwError = 0;
         |HAZ AsignaATalon;
         |PONCONTROL 23,"si";
      |SINO;
         |MENAV "    Hay recibos marcados de clientes distintos";
         |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO ActualizaRecibos;
   #dscam003#40 = #dscam017#9;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#31 = 0;
         #dscam003#14 = "L";
         #dscam003#15 = "Recibo Liquidado";
      |SINO;
         |SI #dscam003#23 = 0;
            |SI #dscam003#16 = 0;
               #dscam003#14 = "P";
               #dscam003#15 = "Pendiente de cobro";
            |SINO;
               #dscam003#14 = "I";
               #dscam003#15 = "Impagado";
            |FINSI;
         |SINO;
            #dscam003#14 = "C";
            #dscam003#15 = "Parcialmente cobrado";
         |FINSI;
      |FINSI;
      #dscam003#33 = ""; #dscam003#34 = "";
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;
|FPRC;

|PROCESO BorraLinRel;
   #dscam016#3 = #dscam016#3 - 1;
   #dscam016#4 = #dscam016#4 - #dscam017#7;
   |SI #dscam016#3 = 0;
      |BORRA 020#dscam016.a;
   |SINO;
      |GRABA 020#dscam016.a;
   |FINSI;
   |HAZ ActualizaRecibos;
   |BORRA 020#dscam017.a;
|FPRC;

|DEFBUCLE BorraLinRel;
#dscam017#1;
;
#dscam016#0,001;
#dscam016#0,999;
be;
NULL,BorraLinRel;
|FIN;

|PROCESO BorraRelacs;
   |BUCLE BorraLinRel;
|FPRC;

|DEFBUCLE BorraRelacs;
#dscam016#1;
1;
00001,#dscam056#0;
99999,#dscam056#0;
be;
NULL,BorraRelacs;
|FIN;

/*
|PROCESO SacaImporte;
   nImpor = nImpor + #dscam057#7;
   |SI fFecha < #dscam057#15; fFecha = #dscam057#15; |FINSI;
|FPRC;

|DEFBUCLE SacaImporte;
#dscam057#1;
19, 16, 14;
001, "*", "    ", "          ";
999, "*", "zzzz", "zzzzzzzzzz";
;
NULL,SacaImporte;
|FIN;

|PROCESO Reordenar;
   |SALVA_FICHA #dscam057;
   nImpor = 0; fFecha = "01.01.0000"; |BUCLE SacaImporte;
   |REPON_FICHA #dscam057;
   #dscam057#22 = nImpor; #dscam057#15 = fFecha;
   |GRABA 020#dscam057.a;
|FPRC;

|DEFBUCLE Reordenar;
#dscam057#1;
19, 16, 14;
001, "*", "    ", "          ";
999, "*", "zzzz", "zzzzzzzzzz";
be;
NULL,Reordenar;
|FIN;
*/

|PROCESO MiraImporte1;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA "Liquidacion de recibos de cobradores";

   |HAZ Tipo8; |HAZ TomaDecim;

   |DELINDEX #dscam057;
   |ABRE #dscam003;
   |ABRE #dscam056; |ABRE #dscam057;

   |PINPA #0#0; |PINDA #0#0;
   |ENTLINEAL #1#dscam057,-1,7,19,1,inf056,sup056;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |BUCLE TomaDatos;
      #dscam056#5 = #dscam056#2 - #dscam056#3;
      |PINTA #dscam056#1; |PINTA #dscam056#2; |PINTA #dscam056#3; |PINTA #dscam056#5;
      |ENTLINEAL #1#dscam057,-1,1,19,1,inf056,sup056;
      |CONFI "    NVolcar los datos editados ?";
      |SI FSalida = 0;
         |ABRE #dscam051;
         |LEE 000#dscam051.p;
         |SI FSalida ! 0; |DDEFECTO #dscam051; |FINSI;

         |ABRE #dscam004; |ABRE #dscam048; |ABRE #dscam016; |ABRE #dscam017;
         |BUCLE Volcado;
         |CIERRA #dscam051; |CIERRA #dscam017; |CIERRA #dscam016; |CIERRA #dscam048; |CIERRA #dscam004;
      |FINSI;
      |CONFI "    NLiberar los recibos pendientes ?";
      |SI FSalida = 0;
         |ABRE #dscam016; |ABRE #dscam017; |ABRE #dscam003;
         |BUCLE BorraRelacs;
         |CIERRA #dscam003; |CIERRA #dscam017; |CIERRA #dscam016;
      |FINSI;
   |FINSI;

   |CIERRA #dscam057; |CIERRA #dscam056;
   |CIERRA #dscam003;

   |HAZ Tipo9;
|FPRO;
