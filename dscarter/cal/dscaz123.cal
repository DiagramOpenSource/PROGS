|FICHEROS;
   dscaz123 #0;

   dscam103 #10;
   dscam067 #11;

   dscam004 #100;
   dscam013 #101;
   dscam030 #102;

   dscam009 #200;
   dscam022 #201;
   dscam047 #202;
   dscam050 #203;

   camasic@ #1000;
   camasil@ #1001;
|FIN;

|VARIABLES;
   aAlfa  = "";
   aPath  = "";
   aMovto = "";
   aTipo  = "";
   nSw    = 0;
   FEstado = 0;

   &eaTipoM   = "";
   &eaComent  = "";
   &eaOper    = "";
   &enDiario  = 0;
   &efFecha   = @;
   &enDocum   = 0;
   &enApunt   = 0;
   &enEmpresa = 0;
   &enPeriodo = 0;
   &enNumDoc  = 0;
   &enLinea   = 0;
|FIN;

|PROCESO CompruebaAsto;
   nSw = 1;
   aAlfa = aPath; |QBF aAlfa;
   aAlfa = aAlfa + "def/camaasil.mas";
   |CARGA_DEF aAlfa, camasil@;
   |SI FSalida = 0;
      aAlfa = aPath; |QBF aAlfa;
      aAlfa = aAlfa + "def/camaasic.mas";
      |CARGA_DEF aAlfa, camasic@;

      aAlfa = aPath; |QBF aAlfa;
      aAlfa = aAlfa + "fich/" + (("00000" + enEmpresa) % -105) + enPeriodo + "/";
      |PATH_DAT #camasil@#aAlfa#; |PATH_DAT #camasic@#aAlfa#;
      |ABRE #camasil@; |ABRE #camasic@;
      #camasil@#0 = enDiario;
      #camasil@#1 = efFecha;
      #camasil@#2 = enDocum;
      #camasil@#3 = enApunt;
      |LEE 000#camasil@.=;
      |SI FSalida = 0;
         #camasic@#0 = enDiario;
         #camasic@#1 = efFecha;
         #camasic@#2 = enDocum;
         |LEE 000#camasic@.=;
         |SI FSalida = 0;
            |SI #camasic@#6 ! 0;
               eaComent = " El asiento esta descuadrado"; |PRINT;
            |FINSI;
         |SINO;
            eaComent = " No se encuentra la cabecera del asiento"; |PRINT;
         |FINSI;
      |SINO;
         eaComent = " No se encuentra el asiento"; |PRINT;
      |FINSI;
      |CIERRA #camasic@; |DESCARGA_DEF #camasic@;
      |CIERRA #camasil@; |DESCARGA_DEF #camasil@;
   |FINSI;
|FPRC;

|PROCESO AstosCmp;
  #dscam103#1 = #dscam009#5;
   |LEE 000#dscam103.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   nSw = 0;
   |SI #dscam009#5 = "PPA";
      |SELECT #2#dscam022;
      #dscam022#13 = #dscam009#14;
      #dscam022#14 = #dscam009#3;
      |LEE 000#dscam022.=;
      |SI FSalida = 0;
         |DDEFECTO #dscam067;
         #dscam067#0 = "PA";
         #dscam067#1 = #dscam022#0;
         #dscam067#2 = #dscam022#1;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         #dscam067#8  = 00000;
         #dscam067#9  = 0;
         |LEE 000#dscam067.];
         |PARA; |SI FSalida = 0; |Y #dscam067#0 = "PA";
          |Y #dscam067#1 = #dscam022#0; |Y #dscam067#2 = #dscam022#1; |HACIENDO;
            enDiario = #dscam067#4;  efFecha = #dscam067#5;
            enDocum  = #dscam067#6;  enApunt = #dscam067#7;
            enEmpresa = #dscam067#8; enPeriodo = #dscam067#9;

            #dscam030#0 = #dscam067#10;
            |LEE 000#dscam030.=;
            |SI FSalida ! 0; |DDEFECTO #dscam030; |FINSI;
            aPath = #dscam030#6;

            enNumDoc = #dscam009#14; enLinea = #dscam009#3; eaOper = #dscam009#5;
            |HAZ CompruebaAsto;
            |LEE 000#dscam067.s;
         |SIGUE;
         |SI nSw = 0;
            enNumDoc = #dscam009#14; enLinea = #dscam009#3; eaOper = #dscam009#5;
            eaComent = " El movimiento no ha sido enlazado a contabilidad"; |PRINT;
         |FINSI;
      |FINSI;
      |SELECT #1#dscam022;
   |FINSI;
   |SI #dscam009#5 = "PTA";
      |SELECT #2#dscam047;
      #dscam047#13 = #dscam009#14;
      #dscam047#14 = #dscam009#3;
      |LEE 000#dscam047.=;
      |SI FSalida = 0;
         |DDEFECTO #dscam067;
         #dscam067#0 = "TA";
         #dscam067#1 = #dscam047#0;
         #dscam067#2 = #dscam047#1;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         #dscam067#8  = 00000;
         #dscam067#9  = 0;
         |LEE 000#dscam067.];
         |PARA; |SI FSalida = 0; |Y #dscam067#0 = "TA";
          |Y #dscam067#1 = #dscam047#0; |Y #dscam067#2 = #dscam047#1; |HACIENDO;
            enDiario = #dscam067#4;  efFecha = #dscam067#5;
            enDocum  = #dscam067#6;  enApunt = #dscam067#7;
            enEmpresa = #dscam067#8; enPeriodo = #dscam067#9;

            #dscam030#0 = #dscam067#10;
            |LEE 000#dscam030.=;
            |SI FSalida ! 0; |DDEFECTO #dscam030; |FINSI;
            aPath = #dscam030#6;

            enNumDoc = #dscam009#14; enLinea = #dscam009#3; eaOper = #dscam009#5;
            |HAZ CompruebaAsto;
            |LEE 000#dscam067.s;
         |SIGUE;
         |SI nSw = 0;
            enNumDoc = #dscam009#14; enLinea = #dscam009#3; eaOper = #dscam009#5;
            eaComent = " El movimiento no ha sido enlazado a contabilidad"; |PRINT;
         |FINSI;
      |FINSI;
      |SELECT #1#dscam047;
   |FINSI;
   |SI #dscam009#5 = "PCF";
      |SELECT #2#dscam050;
      #dscam050#13 = #dscam009#14;
      #dscam050#14 = #dscam009#3;
      |LEE 000#dscam050.=;
      |SI FSalida = 0;
         |DDEFECTO #dscam067;
         #dscam067#0 = "CF";
         #dscam067#1 = #dscam050#0;
         #dscam067#2 = #dscam050#1;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         #dscam067#8  = 00000;
         #dscam067#9  = 0;
         |LEE 000#dscam067.];
         |PARA; |SI FSalida = 0; |Y #dscam067#0 = "CF";
          |Y #dscam067#1 = #dscam050#0; |Y #dscam067#2 = #dscam050#1; |HACIENDO;
            enDiario = #dscam067#4;  efFecha = #dscam067#5;
            enDocum  = #dscam067#6;  enApunt = #dscam067#7;
            enEmpresa = #dscam067#8; enPeriodo = #dscam067#9;

            #dscam030#0 = #dscam067#10;
            |LEE 000#dscam030.=;
            |SI FSalida ! 0; |DDEFECTO #dscam030; |FINSI;
            aPath = #dscam030#6;

            enNumDoc = #dscam009#14; enLinea = #dscam009#3; eaOper = #dscam009#5;
            |HAZ CompruebaAsto;
            |LEE 000#dscam067.s;
         |SIGUE;
         |SI nSw = 0;
            enNumDoc = #dscam009#14; enLinea = #dscam009#3; eaOper = #dscam009#5;
            eaComent = " El movimiento no ha sido enlazado a contabilidad"; |PRINT;
         |FINSI;
      |FINSI;
      |SELECT #1#dscam050;
   |FINSI;

   |SI #dscam009#5 ! "PPA"; |Y #dscam009#5 ! "PTA"; |Y #dscam009#5 ! "PCF";
      |DDEFECTO #dscam067;
      #dscam067#0 = "PG";
      #dscam067#1 = #dscam009#14;
      #dscam067#2 = #dscam009#3;
      #dscam067#8  = 00000;
      #dscam067#9  = 0;
      |LEE 000#dscam067.];
      |PARA; |SI FSalida = 0; |Y #dscam067#0 = "PG"; |Y #dscam067#1 = #dscam009#14; |Y #dscam067#2 = #dscam009#3; |HACIENDO;
         enDiario = #dscam067#4;  efFecha = #dscam067#5;
         enDocum  = #dscam067#6;  enApunt = #dscam067#7;
         enEmpresa = #dscam067#8; enPeriodo = #dscam067#9;

         #dscam030#0 = #dscam067#10;
         |LEE 000#dscam030.=;
         |SI FSalida ! 0; |DDEFECTO #dscam030; |FINSI;
         aPath = #dscam030#6;

         enNumDoc = #dscam009#14; enLinea = #dscam009#3; eaOper = #dscam009#5;
         |HAZ CompruebaAsto;
         |LEE 000#dscam067.s;
      |SIGUE;
      |SI nSw = 0;
         enNumDoc = #dscam009#14; enLinea = #dscam009#3; eaOper = #dscam009#5;
         eaComent = " El movimiento no ha sido enlazado a contabilidad"; |PRINT;
      |FINSI;
   |FINSI;
   eaComent = "";
   enDiario  = 0;
   efFecha   = "00.00.0000";
   enDocum   = 0;
   enApunt   = 0;
|FPRC;

|DEFBUCLE AstosCmp;
#dscam009#4;
;
#dscaz123#2;
"31.12.9999";
;
NULL,AstosCmp;
|FIN;

|PROCESO AstosVta;
   #dscam103#1 = #dscam004#5;
   |LEE 000#dscam103.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   nSw = 0;
   |SI #dscam004#5 = "REM"; |O #dscam004#5 = "EMR";
      #dscam013#16 = #dscam004#17;
      |SI #dscam004#5 = "EMR";
         |SELECT #4#dscam013;
         #dscam013#24 = #dscam004#3;
      |FINSI;
      |SI #dscam004#5 = "REM";
         |SELECT #2#dscam013;
         #dscam013#17 = #dscam004#3;
      |FINSI;
      |LEE 000#dscam013.=;
      |SI FSalida = 0;
         |DDEFECTO #dscam067;
         #dscam067#0 = "RM";
         #dscam067#1 = #dscam013#0;
         #dscam067#2 = #dscam013#1;
         |SI #dscam004#5 = "EMR"; aTipo = "I"; |FINSI;
         |SI #dscam004#5 = "REM"; aTipo = "E"; |FINSI;
         #dscam067#3 = aTipo;
         #dscam067#11 = 1;
         #dscam067#8  = 00000;
         #dscam067#9  = 0;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         aAlfa = #dscam067#3; |QBF aAlfa;
         |PARA; |SI FEstado = 0; |Y #dscam067#0 = "RM"; |Y #dscam067#1 = #dscam013#0; |Y #dscam067#2 = #dscam013#1; |Y aAlfa = aTipo; |HACIENDO;
            enDiario = #dscam067#4;  efFecha = #dscam067#5;
            enDocum  = #dscam067#6;  enApunt = #dscam067#7;
            enEmpresa = #dscam067#8; enPeriodo = #dscam067#9;

            #dscam030#0 = #dscam067#10;
            |LEE 000#dscam030.=;
            |SI FSalida ! 0; |DDEFECTO #dscam030; |FINSI;
            aPath = #dscam030#6;

            enNumDoc = #dscam004#17; enLinea = #dscam004#3; eaOper = #dscam004#5;
            |HAZ CompruebaAsto;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            aAlfa = #dscam067#3; |QBF aAlfa;
         |SIGUE;
         |SI nSw = 0;
            enNumDoc = #dscam004#17; enLinea = #dscam004#3; eaOper = #dscam004#5;
            eaComent = " El movimiento no ha sido enlazado a contabilidad"; |PRINT;
         |FINSI;
      |FINSI;
      |SELECT #1#dscam013;
   |SINO;
      |DDEFECTO #dscam067;
      #dscam067#0 = "CB";
      #dscam067#1 = #dscam004#17;
      #dscam067#2 = #dscam004#3;
      #dscam067#8  = 00000;
      #dscam067#9  = 0;
      |LEE 000#dscam067.];
      |PARA; |SI FSalida = 0; |Y #dscam067#0 = "CB"; |Y #dscam067#1 = #dscam004#17; |Y #dscam067#2 = #dscam004#3; |HACIENDO;
         enDiario = #dscam067#4;  efFecha = #dscam067#5;
         enDocum  = #dscam067#6;  enApunt = #dscam067#7;
         enEmpresa = #dscam067#8; enPeriodo = #dscam067#9;

         #dscam030#0 = #dscam067#10;
         |LEE 000#dscam030.=;
         |SI FSalida ! 0; |DDEFECTO #dscam030; |FINSI;
         aPath = #dscam030#6;

         enNumDoc = #dscam004#17; enLinea = #dscam004#3; eaOper = #dscam004#5;
         |HAZ CompruebaAsto;
         |LEE 000#dscam067.s;
      |SIGUE;
      |SI nSw = 0;
         enNumDoc = #dscam004#17; enLinea = #dscam004#3; eaOper = #dscam004#5;
         eaComent = " El movimiento no ha sido enlazado a contabilidad"; |PRINT;
      |FINSI;
   |FINSI;
   eaComent = "";
   enDiario  = 0;
   efFecha   = "01.01.0000";
   enDocum   = 0;
   enApunt   = 0;
|FPRC;

|DEFBUCLE AstosVta;
#dscam004#7;
;
#dscaz123#2,  000000001;
"31.12.9999", 999999999;
;
NULL,AstosVta;
|FIN;

|PROCESO VtosRem;
   nSw = 0;

   #dscam004#17 = #dscam013#16;
   #dscam004#3 = #dscam013#17;
   |LEE 000#dscam004.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscam004;
      #dscam004#17 = #dscam013#16;
   |FINSI;

   |DDEFECTO #dscam067;
   #dscam067#0 = "RM";
   #dscam067#1 = #dscam013#0;
   #dscam067#2 = #dscam013#1;
   aTipo = "V";
   #dscam067#3 = aTipo;
   #dscam067#11 = 1;
   #dscam067#8  = 00000;
   #dscam067#9  = 0;
   |LEE 000#dscam067.];
   FEstado = FSalida;
   aAlfa = #dscam067#3; |QBF aAlfa;
   |PARA; |SI FEstado = 0; |Y #dscam067#0 = "RM"; |Y #dscam067#1 = #dscam013#0; |Y #dscam067#2 = #dscam013#1; |Y aAlfa = aTipo; |HACIENDO;
      enDiario = #dscam067#4;  efFecha = #dscam067#5;
      enDocum  = #dscam067#6;  enApunt = #dscam067#7;
      enEmpresa = #dscam067#8; enPeriodo = #dscam067#9;

      #dscam030#0 = #dscam067#10;
      |LEE 000#dscam030.=;
      |SI FSalida ! 0; |DDEFECTO #dscam030; |FINSI;
      aPath = #dscam030#6;

      enNumDoc = #dscam004#17; enLinea = #dscam004#3; eaOper = #dscam004#5;
      |HAZ CompruebaAsto;
      |LEE 000#dscam067.s;
      FEstado = FSalida;
      aAlfa = #dscam067#3; |QBF aAlfa;
   |SIGUE;
   |SI nSw = 0;
      enNumDoc = #dscam004#17; enLinea = #dscam004#3; eaOper = #dscam004#5;
      eaComent = " El movimiento no ha sido enlazado a contabilidad"; |PRINT;
   |FINSI;
|FPRC;

|DEFBUCLE VtosRem;
#dscam013#5;
6;
"S", 000000001, #dscaz123#2;
"S", 999999999, "31.12.9999";
;
NULL,VtosRem;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA "Verificacion de movimientos contables";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0; |Y #dscaz123#0 = "S";
      |IMPRE 0;
      |SI FSalida = 0;
         |INFOR "dscaz123";
         |SI FSalida = 0;
            |ABRE #dscam067; |ABRE #dscam013; |ABRE #dscam030;
            |ABRE #dscam103; |SELECT #2#dscam103;
            |ABRE #dscam022; |ABRE #dscam047; |ABRE #dscam050;
            eaTipoM = "V";
            |BUCLE AstosVta;
            eaTipoM = "C";
            |BUCLE AstosCmp;
            |ABRE #dscam004;
            |SI #dscaz123#1 = "S";
               |BUCLE VtosRem;
            |FINSI;
            |CIERRA #dscam004;
            |SELECT #1#dscam103; |CIERRA #dscam103;
            |CIERRA #dscam067;   |CIERRA #dscam013; |CIERRA #dscam030;
            |CIERRA #dscam022;   |CIERRA #dscam047; |CIERRA #dscam050;
            |PIEINF; |FININF;
         |FINSI;
         |FINIMP;
      |FINSI;
   |FINSI;
|FPRO;
