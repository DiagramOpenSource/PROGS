/*             calculo anterior del dscam003 16/5/2014
|FICHEROS;
   dscam003 #0;
   dscam004 #1,MANTE;
   dscam025 #2;
   dscam023 #3,MANTE;

   dscam012 #13;

   dscam044 #14;
   dscam045 #15;
   dscaw070 #16;
   dscam013 #3;
   dscaw013 #4;
   dscam051 #5;
   dscam001 #10;
   dscam164 #164;

   dscam058 #6;
   &agif024@ #7;
   &agif324@ #9;

   caclipr@  #11;
   &canempr@ #12;
   dscam067  #20;
   dscam017  #21;
   agif133@  #22;
   agif134@  #23;
   agif084@  #24;
   dscam075  #25,MANTE;
   agif069@  #26;

   dscam055 #8;

   dscam030 #30;

   dscam081 #30;
   dscam082 #31;

   dscam043 #40;

   camsic@ #101;
   camasil@ #100;
   cacuen@ #102;
   camadi@ #103;
   caempr@ #104;
   Replica@ #105;
   inciden@ #106;
   taglm01@ #107;
   dscam004@ #1000;

   dscam106 #506;        ||Aux. Trazabilidad

   referen@ #333;
   dscam052 #52;

   cajainca@ #6000;
   cajainli@ #6001;

   visalm00@ #2000;
   dspvm002@ #2001;
   maesm011@ #2002;
|FIN;

|VARIABLES;
   &eaEntPag     = "";
   &eaNumPag     = "";
   &enDocumento  = 0;
   &efFecha      = @;
   &eaEmpContab  = "";
   &enSwErr      = 0;
   &enSwError    = 0;
   &eaDirConta   = "";
   &enSwEsFinal = 0;
   &enSwLinea = 0;
   &efFechaImp = @;
   &enNumRecs  = 0;
   &enNumSec   = 0;
   &enNumRemesa = 0;
   &enNumDoc    = 0;

   nSwVertical = 0;
   nSwMiraSiFinal = 1;

   nSwCargaDef3 = 0;
   aMas = "";
   aBase = "";

   nImpoOri = 0;
   nDocOriDiv = 0;
   nDocOri = 0;
   aAux = "";
   nDesde = 0;
   nSwPie = 0;
   &aInforme = "";
   nSwMiraMas = 0;
   nDocDestino = 0;
   nAnyo       = 0;
   aMovOrig    = "";
   aCodEnlace  = "";
   aModo       = "";

   &eaOpcMenu  = "";

   nSwCerrada  = 0;
   nCont       = 0;
   nContSesion = 0;
   nCond       = 0;

   &efFechaEdit = @;
   &eaMovtoEdit = "";

   nSwImpTraza = 0;
   nSwImpCarta = 0;
   nBotonImp = 0;
   nBotonCarta = 0;
   nDif = 0;
   nTopeDiv = 0;
   nSwCompleto = 0;
   nSuma = 0;
   nSwCobConf = 0;

   nVoy = 0;
   aEstado = "";
   nDocAgrup = 0;
   nSwModoDiv = 0;       ||O -> Agrupacion; 1-> Division; 2-> Cobro
   aSwDire = "";
   nUltimoSubir = 0;
   nUltimoBajar = 0;
   nUltimo = 0;
   nEsConf = 0;
   aEstadoAnt = "";

   fFechaAnt = @;

   aMensaje = "";
   &PRMNT_enPerfil = 0;

   &enERP = 0;
   &CodCliente = "";
   &eaCliente  = "";

   &eaFichClas = "";  &eaTipoClas = ""; &enSwClas = 0;
   &enEmpCartera = 0; &enEmpGestion = 0; &enDocum = 0; &enTipoEntrada = 0;
   &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = ""; enBanco = 0;
   &enFactura = 0;
   &eaFicher = ""; &eaClave = ""; &HayConta = 0;
   &PosLibro = 0; &PosSerie = 0; &PosFactu = 0; &PosRecib = 0;
   &eaTipoRe = "V"; &enDoc  = 0; &enLin = 0; &enLinea = 0;

   &Fichero = ""; &Tipo = ""; &Cmp = ""; &CmpNum = 0;
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = ""; &eaLlamada = "";
   &DCampoG = 0;  &HCampoG = 0;  &DCampoC = 0;  &HCampoC = 0;

   &EURO = 0; &EURODB = 0; &EURODV = 0;
   &eaCodigo    = "";
   &eaTipoCod   = "";
   &aCuenta     = "";
   &eaNif       = "";
   &eaNombre    = "";
   &eaDirCobro  = "";
   &eaDireccion = "";
   &eaPoblacion = "";
   &eaProvincia = "";
   &eaCP        = "";
   &eaCP1       = "";
   &eaCP2       = "";
   &eaTelefono  = "";
   &enNume1     = 0;

   &eaResult    = "";
   &enNumDocum  = 0;
   &enTipoRec   = 0;

   nSwBloq       = 0;
   fFechaHoy     = @;
   &enFPago      = 0;
   &nCamFPago    = 0;
   &fFechaFac    = @;
   &fFecVto      = @;
   &enExistOblig = 0;

   &Opcion = 0;

   {1}nPuntero   = 0;
     || NO PONER NINGUNA VARIABLE ENTRE ESTAS DOS ..... SE USAN COMO PUNTEROS
      aNume      = "";

   aClv1 = "";
   aClv2 = "";
   aClv3 = "";
   aClv4 = "";

   nEmpres  = 0; nPeriod  = 0;
   nDiario  = 0; fFecAsto = @;
   nDocumto = 0; nSesion  = 0;
   nBoton   = -1;
   nBoton2  = -1;

   nNumCob  = 0;
   nNumRem  = 0;
   nNumLRem = 0;
   nSwIncid   = 0;
   nLinIncid  = 0;
   nContIncid = 0;
   nSwFuncion = 0;
   nSwPasa    = 0;

   nEmp = 0; nPer = 0; nDia = 0;
   fFec = @; nDoc = 0; nMovsEnt = 0;
   fFechaRem = @;
   fFechaRta = @;
   aClasif = "";
   nTipoRec = 0;
   nLinea   = 0;
   nCodSitAnt = "";
   aDesSitAnt = "";

   aDirec  = "";
   aNumPag = "";
   nImpD   = 0;
   nImpB   = 0;
   fFecPag = "00.00.0000";
   aObsPag = "";
   aCtaPag = "";
   aDepPag = "";
   aCodCli = "";
   aCtaCli = "";

   nModo        = 0;
   nModoEntrada = 0;

   aSerie    = "";
   nFactura  = 0;
   fFechaEm  = @;
   nLibro    = 0;
   nRemesa   = 0;
   nUltRem   = 0;
   nUltEmiRem  = 0;
   nCuentaLRem = 0;
   nCuentaLAsi = 0;
   nCuentaLSec = 0;

   aAntClas  = "";
   aDespClas = "";
   nAntTRec  = 0;

   aDirConta = "";
   aEntidad  = "";
   aNumero   = "";
   nHayAsto = 0;

   nCalc   = 0;
   nCalc1  = 0;
   nCalc2  = 0;
   nCalc3  = 0;
   nCalc4  = 0;
   nCalc5  = 0;
   nCalc6  = 0;
   nNumSec = 0;
   nNumSecuencia = 0;

   Tecla = ""; Salir = 0;
   SwError = 0;
   &Modo1 = "";
   Modo2 = "";
   HayVtos = 0; Respuesta = "";
   BajaPag = "          ";
   BajaEnt = "    ";
   BorraPag = 0; nRecEntrega = 0;
   aOperAnt = "";
   aOperac = "";
   aMovto = "";
   nImpOpAnt = 0;

   nNumDocum = 0; nNumDoc = 0; nNumLin = 0; nNumLinea = 0;

   nCodigo = 0; nCuentaCobs = 0; nEmpresa = 0;
   &aOper = "";
   aOper1 = "";
   aOper2 = "";

   nDocum    = 0;  nDocum1   = 0;
   Document  = 0;  NumLDoc   = 0;
   EmiAsto   = 0;  VtoAsto   = 0;
   EmiEnlace = ""; VtoEnlace = "";
   FechaVto  = ""; NumRemesa = 0;
   NumLinea  = 0;  NoHay     = 0;

   Clave1 = 0; Clave2 = 0; Clave3 = ""; aTipoOp = "";
   nSw    = 0; nSwError = 0; nSwErr = 0; nSwErr1 = 0;

   Marca = 0;
   Calc = 0;
   Cont = 0;
   Primero = 0; PrimerReg = 1;

   NumDoc   = 0; Flag    = 0;  MaxOpc = 0; SwClave = 0;
   NumClave = 0;

   &eaEntidad = ""; &eaSucursal = ""; &eaCuenta = ""; &eaDC = "";
   &DirCliente = ""; &Cp = ""; &PobCliente = ""; &ProvCliente = "";
   &TelCliente = "";

   &nDeci_Base = 0; &nDeci_Div = 0; &Divisa = "";

   Moneda = 0; BASE = 1; DIV = 0; FEstado = 0;
   &HayGestion = 0; Cuenta = ""; Nivel = 0;

   Entidad = ""; NumDocum = "";
   Documento = 0;
   Linea = 0;
   UltCobro = 0;
   UltFecCo = @;
   CobroAnt = 0;
   Campos   = 0;
   LineaRem = 0;
   &fAntVto = @;
   aAlfa  = "";
   aAlfa1 = "";
   aAlfa2 = "";
   aAlfa3 = "";
   aAlfa4 = "";

   DesAnt = 0; HasAnt = 0; Comodin = ""; Comodin1 = "";

   ModoEntrada = 0; LinBucle = 0;

   aLong = ""; nLong = 0;

   NumRec    = 0; NumLin   = 0;
   LiquDiv   = 0; LiquBase = 0;
   CobrDiv   = 0; CobrBase = 0;
   DespDiv   = 0; DespBase = 0;
   DifCamb   = 0;
   EnlDiario = 0; EnlFecha = @;
   EnlDocum  = 0; EnlAstos = 0;
   EnlEmpre  = 0; EnlPerio = 0;
   FechaOper = @; CtaCobro  = "";

   nDocSald  = 0;
   nLinRemesa = 0;

   aEntDocum = "";
   aNumDocum = "";
   aFecDocum = "";

   fFechaVto = @;
|FIN;

|PROCESO AjusteHoja;
     |VARIABLES;
                    || R.PRIEGO: IMPRESION ESPECIAL EN LASER
                    || Ajusta a numero de recibos por pagina.
          nAjuste = 0;   || nro.recibos p/pagina, viene de tipos de recibo
          nCuenta = 0;   || contador de los recibos ya impresos
          nPara1  = 0;
          nNume1  = 0;
     |FINSI;

     |SI nCuenta = 0;    |ACABA;   |FINSI;

     nAjuste = #dscam058#3;        || se queda con el ultimo TIPO utilizado
     |SI nAjuste = 0;    |ACABA;   |FINSI;

     |SALVA_FICHA #dscam003;

     |DDEFECTO #dscam003;
     DirCliente = "";
     Cp = "";
     PobCliente = "";
     ProvCliente = "";
     TelCliente = "";

     nNume1 = nCuenta $ nAjuste;
     |SI nNume1 ! 0;
          nNume1 = nNume1 + 1;
          |PARA nPara1 = nNume1; |SI nPara1 [ nAjuste; |HACIENDO nPara1 = nPara1 + 1;
               Comodin = #dscam058#2; |QBF Comodin;    || con el ultimo
               |INFOR Comodin;
               |PRINT;
               |PIEINF;
               |FININF;
          |SIGUE;
     |FINSI;

     |REPON_FICHA #dscam003;
|FPRC;

|PROCESO SacaNivel1;
   Comodin = Cuenta; |QBF Comodin;
   aLong = Comodin % 0; nLong = aLong;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 1"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; Nivel = 1; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 2"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; Nivel = 2; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 3"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; Nivel = 3; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 4"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; Nivel = 4; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 5"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; Nivel = 5; |FINSI;
   Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 6"; |HAZ ObtenDato;
   |SI #canempr@#CmpNum# = nLong; Nivel = 6; |FINSI;
|FPRC;

|PROCESO MiraSiVtos;
   HayVtos = HayVtos + 1;
|FPRC;

|DEFBUCLE MiraSiVtos;
#dscam013#1;
15;
#dscam012#0,001,"S";
#dscam012#0,999,"S";
;
NULL,MiraSiVtos;
|FIN;

|PROCESO BajaPagareCli;

      |SI #dscam003#14 = "A"; |O #dscam003#14 = "D"; |O #dscam003#14 = "V"; |ACABA; |FINSI;

      ModoEntrada = 3;

      NoHay = 0;
      |ABRE #dscam004;
      #dscam004#17 = #dscam003#40;
      #dscam004#3 = 99;
      |LEE 000#dscam004.];
      |SI FSalida = 0;
         |SI #dscam004#17 ! #dscam003#40;
            |LEE 000#dscam004.a;
            |SI FSalida ! 0; |O #dscam004#17 ! #dscam003#40;
               NoHay = 1;
            |FINSI;
         |FINSI;
      |SINO;
         |LEE 000#dscam004.u;
         |SI FSalida ! 0; |O #dscam004#17 ! #dscam003#40;
            NoHay = 1;
         |FINSI;
      |FINSI;
      |CIERRA #dscam004;

      |SI NoHay = 0;
         |SI #dscam004#5 ! "REM"; |ACABA; |FINSI;
      |FINSI;

      |ABRE #dscam012;
      |ABRE #dscam013;
      #dscam013#0 = #dscam003#17;
      #dscam013#1 = #dscam003#37;
      |LEE 101#dscam013.=;
      |SI FSalida = 0;
         |SI #dscam051#3 = "S";
            |SI #dscam013#15 = "S";
               eaTipoOper = "+4";
            |SINO;
               eaTipoOper = "-6+4";
            |FINSI;
            || enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
            enEmpCartera = -1;     enEmpGestion = #dscam003#46;
            eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
            nImporte = #dscam013#7;
            |HAZ BucleRiesgo;
         |FINSI;

         NumRemesa = #dscam013#0;  NumLinea  = #dscam013#1;
         #dscam012#0 = #dscam013#0;
         |LEE 101#dscam012.=;
         |SI FSalida = 0;
            #dscam012#5  = #dscam012#5 - 1;
            #dscam012#10 = #dscam012#10 - #dscam013#7;
            #dscam012#11 = #dscam012#6 * #dscam012#5;     || La comision solo sera en moneda base
            #dscam012#12 = #dscam012#12 - #dscam013#10;
            |SI #dscam013#6 < #dscam012#1;
               #dscam012#13 = #dscam012#13 - #dscam013#7;
            |FINSI;
            |SI #dscam012#5 = 0;
               Marca = 0;
               Modo1 = ",B";
               Modo2 = ",B";
            |SINO;
               |GRABA 020#dscam012.a;
               Marca = 1;
               Modo1 = "";
               Modo2 = "";
            |FINSI;
            |LIBERA #dscam012;
            |SI ModoEntrada = 2; |Y Flag > 0;
               eaFicher = "dscam012"; eaClave = #dscam012#0;
               enImpAct = #dscam012#10; |HAZ GrabaAudit;
            |FINSI;

            |SI Marca = 1;
               |BORRA 020#dscam013.a; |DDEFECTO #dscam013;
            |FINSI;

            #dscam003#17 = 0; #dscam003#53 = "01.01.0000"; #dscam003#37 = 0;
            |GRABA 020#dscam003.a;
         |FINSI;

         |SI #dscam051#1 = "S";
            |ABRE #dscam067;
            #dscam067#8 = 0;
            #dscam067#9 = 0;
            #dscam067#0  = "RM";
            #dscam067#1  = NumRemesa;
            #dscam067#2  = NumLinea;
            #dscam067#3  = "V";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1;
            Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
            |PARA; |SI FEstado = 0; |Y Clave1 = NumRemesa; |HACIENDO;
               |SI FEstado = 0; |Y Clave1 = NumRemesa; |Y Clave2 = NumLinea; |Y Clave3  = "V";
                  |SAL;
               |FINSI;
               |LEE 000#dscam067.s;
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
            |SIGUE;

            |SI FEstado = 0; |Y Clave1 = NumRemesa; |Y Clave2 = NumLinea;
             |Y Clave3  = "V";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #4 Comodin;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               VtoEnlace = #dscam067#10; VtoAsto   = #dscam067#6;
               FechaVto  = #dscam067#5;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = VtoEnlace;  #dscaw013#0 = 1;
               #dscaw013#13 = "dscam013"; #dscaw013#14 = 15;
               #dscaw013#11 = "A";
               #dscaw013#3  = "S";   #dscaw013#4 = "S";
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = VtoEnlace;  #dscaw013#0 = 2;
               #dscaw013#13 = "dscam013"; #dscaw013#14 = 0;
               #dscaw013#11 = "N";        #dscaw013#12 = 5;
               #dscaw013#5  = NumRemesa;  #dscaw013#6 = NumRemesa;
               |GRABA 020#dscaw013.n;

               Comodin = VtoEnlace;
               Comodin = "dscam033.tab;" + Comodin + Modo1 + ",V" + FechaVto;
               |LIBERA #dscam003; |CIERRAT #dscam003;
               |LIBERA #dscam004; |CIERRAT #dscam004;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam003; |LEE 101#dscam003.=;
               |ABRET #dscam004; |LEE 101#dscam004.=;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;

            #dscam067#8 = 0;
            #dscam067#9 = 0;
            #dscam067#0 = "RM";
            #dscam067#1 = NumRemesa;
            #dscam067#2 = NumLinea;
            #dscam067#3 = "E";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
            |PARA; |SI FEstado = 0; |Y Clave1 = NumRemesa; |HACIENDO;
               |SI FEstado = 0; |Y Clave1 = NumRemesa; |Y Clave2 = NumLinea; |Y Clave3  = "E";
                  |SAL;
               |FINSI;
               |LEE 000#dscam067.s;
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
            |SIGUE;

            |SI FEstado = 0; |Y Clave1 = NumRemesa; |Y Clave2 = NumLinea;
             |Y Clave3  = "E";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #4 Comodin;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
               #dscaw013#13 = "dscam013";    #dscaw013#14 = 0;
               #dscaw013#11 = "N";           #dscaw013#12 = 5;
               #dscaw013#5 = NumRemesa;      #dscaw013#6 = NumRemesa;
               |GRABA 020#dscaw013.n;

               Comodin = #dscam067#10;
               Comodin = "dscam033.tab;" + Comodin + Modo2 + ",E";
               |LIBERA #dscam003; |CIERRAT #dscam003;
               |LIBERA #dscam004; |CIERRAT #dscam004;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam003; |LEE 101#dscam003.=;
               |ABRET #dscam004; |LEE 101#dscam004.=;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;
            |CIERRA #dscam067;
         |SINO;
            |ABRE #dscam067;
            #dscam067#8 = 0;
            #dscam067#9 = 0;
            #dscam067#0  = "RM";
            #dscam067#1  = NumRemesa;
            #dscam067#2  = NumLinea;
            #dscam067#3  = "V";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
            |SI FEstado = 0; |Y Clave1 = NumRemesa; |Y Clave2 = NumLinea; |Y Clave3  = "V";
               |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
            |FINSI;
            #dscam067#8 = 0;
            #dscam067#9 = 0;
            #dscam067#0  = "RM";
            #dscam067#1  = NumRemesa;
            #dscam067#2  = NumLinea;
            #dscam067#3  = "E";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
            |SI FEstado = 0; |Y Clave1 = NumRemesa; |Y Clave2 = NumLinea; |Y Clave3  = "E";
               |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
            |FINSI;
            |CIERRA #dscam067;
         |FINSI;
         |SI Marca = 0;
            |BORRA 020#dscam012.a;
            |BORRA 020#dscam013.a; |DDEFECTO #dscam013;
         |FINSI;
      |FINSI;
      |CIERRA #dscam012;
      |LIBERA #dscam013; |CIERRA #dscam013;
      |SI #dscam003#47 = "S"; |ACABA; |FINSI;

      #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
      #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
      #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
      #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;

      #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
      #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
      #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);

      #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;
      || #dscam003#26 = #dscam004#6;

      |SI #dscam003#69 ! " ";
         |SI #dscam003#23 = 0;
            #dscam003#14 = "L";
            #dscam003#15 = "Recibo Compensado";
         |SINO;
            |SI #dscam003#23 = #dscam003#22;
               #dscam003#14 = "e";
               #dscam003#15 = "Pendiente de compensar";
            |SINO;
               #dscam003#14 = "E";
               #dscam003#15 = "Compensado parcialmente";
            |FINSI;
         |FINSI;
      |SINO;
         |SI #dscam003#31 = 0;
            #dscam003#14 = "L";
            #dscam003#15 = "Recibo Liquidado";
         |SINO;
            |SI #dscam003#23 = 0;
               |SI #dscam003#70 = "          ";
                  |SI #dscam003#16 = 0;
                     #dscam003#14 = "P";
                     #dscam003#15 = "Pendiente de cobro";
                  |SINO;
                     #dscam003#14 = "I";
                     #dscam003#15 = "Impagado";
                  |FINSI;
               |SINO;
                  #dscam003#14 = "T";
                  #dscam003#15 = "Pagare/Talon de cliente";
               |FINSI;
            |SINO;
               #dscam003#14 = "C";
               #dscam003#15 = "Parcialmente cobrado";
            |FINSI;
         |FINSI;
      |FINSI;
      #dscam003#17 = 0; #dscam003#53 = "01.01.0000"; #dscam003#37 = 0;
      |GRABA 020#dscam003.a;

      |SI ModoEntrada = 3;
         |LEE 000#dscam004.a;
         |SI FSalida = 0;
            |SI #dscam004#17 = #dscam003#40;
               #dscam003#26 = #dscam004#6;
            |SINO;
               #dscam003#26 = "01.01.0000";
            |FINSI;
         |SINO;
            #dscam003#26 = "01.01.0000";
         |FINSI;
         |LEE 000#dscam004.s;
      |SINO;
         #dscam003#26 = #dscam004#6;
      |FINSI;
      |BORRA 020#dscam004.a;
|FPRC;

|DEFBUCLE BajaPagareCli;
#dscam003#7;
;
BajaEnt,BajaPag,000000001;
BajaEnt,BajaPag,999999999;
;
NULL,BajaPagareCli;
|FIN;

|PROCESO Tipo7; |TIPO 7;
   |SI BajaPag ! "          "; |O BajaEnt ! "    ";
      |SALVA_FICHA #dscam003;
      |BUCLE BajaPagareCli;
      BajaPag = "          ";
      BajaEnt = "    ";
      |REPON_FICHA #dscam003;
   |FINSI;
   |SI Moneda = BASE;
      |ATRI R; |PINTA 2225, " Dif.Cambio "; |ATRI N;
   |FINSI;

   |SI #dscam004#5 = "RCE"; |O #dscam004#5 = "PRC";
    |O #dscam004#5 = "RCA"; |O #dscam004#5 = "PRA";
      |ATRI R; |PINTA 1725, " Reclamad."; |ATRI N;
   |SINO;
      |ATRI R; |PINTA 1725, " Impagado "; |ATRI N;
   |FINSI;
|FPRC;

|RUTINA inf;
   #dscam004#17 = #dscam003#40;
   #dscam004#3 = 1;
|FRUT;

|RUTINA sup;
   #dscam004#17 = #dscam003#40;
   #dscam004#3 = 99;
|FRUT;

|RUTINA inf1;
   #dscam025#0 = 1;
|FRUT;

|RUTINA sup1;
   #dscam025#0 = 99;
|FRUT;

|PROCESO PideClave;
  |ENCAMPO #40#dscam003;
  |SI SwClave = 1; FSalida = 0; |FINSI;
  |SI FSalida ! 0; |Y FSalida ! 6; |Y FSalida ! 11; SwError = 1; |ACABA; |FINSI;
|FPRC;

|PROCESO Baja;
   CobroAnt = #dscam004#3;
   |SALVA_FICHA #dscam004;
   #dscam004#17 = #dscam003#40;
   #dscam004#3 = 1;
   |LEE 000#dscam004.];
   |PARA; |SI FSalida = 0; |HACIENDO;
      |SI #dscam004#17 = #dscam003#40;
         |SI CobroAnt ! #dscam004#3;
            UltCobro = #dscam004#3;
            UltFecCo = #dscam004#6;
         |FINSI;
         |LEE 000#dscam004.s;
      |SINO;
         |SAL;
      |FINSI;
   |SIGUE;
   |LEE 000#dscam004.p;
   |REPON_FICHA #dscam004;
|FPRC;

|PROCESO BajaTalPag;
   |SI nSw = 1;
      |SI #dscam003#17 ! 0;
         nSwError = 1; |ERROR10;
      |FINSI;
   |FINSI;

   |SI nSw = 2;
      |SI #dscam003#40 ! nNumDocum;
         |SI #dscam003#14 ! "A"; |Y #dscam003#14 ! "D"; |Y #dscam003#14 ! "V";
            #Replica@#40 = #dscam003#40;
            |LEE 101#Replica@.=;
            |SI FSalida = 0;
               #dscam004#17 = #dscam003#40;
               #dscam004#3  = 99;
               |LEE 101#dscam004.];
               |SI FSalida = 0;
                  |SI #dscam004#17 = #dscam003#40;
                     |SI #dscam004#5 = "RPT";
                        Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
                        |NOME_DAT #4 Comodin;
                        |DELINDEX #dscaw013; |ABRE #dscaw013;
                        |DDEFECTO #dscaw013;
                        #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
                        #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
                        #dscaw013#11 = "N";          #dscaw013#12 = 9;
                        #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
                        |GRABA 020#dscaw013.n;
                        |DDEFECTO #dscaw013;
                        #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
                        #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
                        #dscaw013#11 = "N";          #dscaw013#12 = 3;
                        #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
                        |GRABA 020#dscaw013.n;
                        |DDEFECTO #dscaw013;
                        #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
                        #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
                        #dscaw013#11 = "F";          #dscaw013#12 = 10;
                        #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
                        |GRABA 020#dscaw013.n;

                        |LIBERA #dscaw013; |CIERRA #dscaw013;
                        Comodin = #dscam067#10;
                        Comodin = "dscam033.tab;" + Comodin + ",B";
                        |LIBERA #Replica@; |CIERRAT #Replica@;
                        |LIBERA #dscam003; |CIERRAT #dscam003;
                        |LIBERA #dscam004; |CIERRAT #dscam004;
                        |SUB_EJECUTA_NP Comodin;
                        |ABRET #Replica@; |LEE 101#Replica@.=;
                        |ABRET #dscam003; |LEE 000#dscam003.=;
                        |ABRET #dscam004; |LEE 101#dscam004.=;
                        |SELECT #7#dscam003;

                        |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
                        |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
                        |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

                        |SI #dscam004#54 ! 0; #Replica@#12 = #dscam004#54; |FINSI;
                        |BORRA 020#dscam004.a; |LIBERA #dscam004;
                     |FINSI;
                  |SINO;
                     |LIBERA #dscam004; |LEE 101#dscam004.a;
                     |SI FSalida = 0;
                        |SI #dscam004#17 = #dscam003#40;
                           |SI #dscam004#5 = "RPT"; |O #dscam004#5 = "RAC";
                              Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
                              |NOME_DAT #4 Comodin;
                              |DELINDEX #dscaw013; |ABRE #dscaw013;
                              |DDEFECTO #dscaw013;
                              #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
                              #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
                              #dscaw013#11 = "N";          #dscaw013#12 = 9;
                              #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
                              |GRABA 020#dscaw013.n;
                              |DDEFECTO #dscaw013;
                              #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
                              #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
                              #dscaw013#11 = "N";          #dscaw013#12 = 3;
                              #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
                              |GRABA 020#dscaw013.n;
                              |DDEFECTO #dscaw013;
                              #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
                              #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
                              #dscaw013#11 = "F";          #dscaw013#12 = 10;
                              #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
                              |GRABA 020#dscaw013.n;

                              |LIBERA #dscaw013; |CIERRA #dscaw013;
                              Comodin = #dscam067#10;
                              Comodin = "dscam033.tab;" + Comodin + ",B";
                              |LIBERA #Replica@; |CIERRAT #Replica@;
                              |LIBERA #dscam003; |CIERRAT #dscam003;
                              |LIBERA #dscam004; |CIERRAT #dscam004;
                              |SUB_EJECUTA_NP Comodin;
                              |ABRET #Replica@; |LEE 101#Replica@.=;
                              |ABRET #dscam003; |LEE 000#dscam003.=;
                              |ABRET #dscam004; |LEE 101#dscam004.=;
                              |SELECT #7#dscam003;

                              |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
                              |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
                              |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

                              |SI #dscam004#54 ! 0; #Replica@#12 = #dscam004#54; |FINSI;
                              |BORRA 020#dscam004.a; |LIBERA #dscam004;
                           |FINSI;
                        |FINSI;
                     |FINSI;
                  |FINSI;
               |SINO;
                  |LIBERA #dscam004; |LEE 101#dscam004.u;
                  |SI FSalida = 0;
                     |SI #dscam004#17 = #dscam003#40;
                        |SI #dscam004#5 = "RPT"; |O #dscam004#5 = "RAC";
                           Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
                           |NOME_DAT #4 Comodin;
                           |DELINDEX #dscaw013; |ABRE #dscaw013;
                           |DDEFECTO #dscaw013;
                           #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
                           #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
                           #dscaw013#11 = "N";          #dscaw013#12 = 9;
                           #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
                           |GRABA 020#dscaw013.n;
                           |DDEFECTO #dscaw013;
                           #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
                           #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
                           #dscaw013#11 = "N";          #dscaw013#12 = 3;
                           #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
                           |GRABA 020#dscaw013.n;
                           |DDEFECTO #dscaw013;
                           #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
                           #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
                           #dscaw013#11 = "F";          #dscaw013#12 = 10;
                           #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
                           |GRABA 020#dscaw013.n;

                           |LIBERA #dscaw013; |CIERRA #dscaw013;
                           Comodin = #dscam067#10;
                           Comodin = "dscam033.tab;" + Comodin + ",B";
                           |LIBERA #Replica@; |CIERRAT #Replica@;
                           |LIBERA #dscam003; |CIERRAT #dscam003;
                           |LIBERA #dscam004; |CIERRAT #dscam004;
                           |SUB_EJECUTA_NP Comodin;
                           |ABRET #Replica@; |LEE 101#Replica@.=;
                           |ABRET #dscam003; |LEE 000#dscam003.=;
                           |ABRET #dscam004; |LEE 101#dscam004.=;
                           |SELECT #7#dscam003;

                           |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
                           |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
                           |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

                           |SI #dscam004#54 ! 0; #Replica@#12 = #dscam004#54; |FINSI;
                           |BORRA 020#dscam004.a;
                        |FINSI;
                     |FINSI;
                  |FINSI;
               |FINSI;
               |LIBERA #dscam004;

               aAlfa = #dscam004#16; |QBF aAlfa;
               aAlfa = aAlfa - "Doc.Automatico";
               |SI FSalida = 0;
                  #Replica@#70 = ""; #Replica@#72 = "";
                  #Replica@#71 = ""; #Replica@#73 = ""; #Replica@#74 = "";
                  #Replica@#78 = 0;  #Replica@#79 = 0;  #Replica@#90 = "N";

                  #Replica@#24 = #Replica@#24 - #dscam004#12;
                  #Replica@#62 = #Replica@#62 - #dscam004#29;
                  #Replica@#25 = #Replica@#25 - #dscam004#13;
                  #Replica@#63 = #Replica@#63 - #dscam004#30;
                  #Replica@#38 = #Replica@#38 - #dscam004#14;
                  #Replica@#66 = #Replica@#66 - #dscam004#31;

                  #Replica@#30 = #Replica@#22 + #Replica@#24 + #Replica@#25 + #Replica@#38;
                  #Replica@#30 = #Replica@#30 - (#Replica@#54 + #Replica@#55);
                  #Replica@#64 = #Replica@#60 + #Replica@#62 + #Replica@#63 + #Replica@#66 + #Replica@#56;
                  #Replica@#64 = #Replica@#64 - (#Replica@#67 + #Replica@#68);

                  #Replica@#31 = #Replica@#30 - #Replica@#23;  #Replica@#65 = #Replica@#64 - #Replica@#61;
                  |SI #Replica@#69 ! " "; |O #Replica@#47 = "S";
                     |SI #Replica@#23 = 0;
                        #Replica@#14 = "L";
                        #Replica@#15 = "Recibo Compensado";
                     |SINO;
                        |SI #Replica@#23 = #Replica@#22;
                           #Replica@#14 = "e";
                           #Replica@#15 = "Pendiente de compensar";
                        |SINO;
                           #Replica@#14 = "E";
                           #Replica@#15 = "Compensado parcialmente";
                        |FINSI;
                     |FINSI;
                  |SINO;
                     |SI #Replica@#31 = 0;
                        #Replica@#14 = "L";
                        #Replica@#15 = "Recibo Liquidado";
                     |SINO;
                        |SI #Replica@#23 = 0;
                           |SI #Replica@#70 = "          ";
                              |SI #Replica@#16 = 0; |Y #dscam004#5 ! "IMP"; |Y #dscam004#5 ! "IMA";
                                 #Replica@#14 = "P";
                                 #Replica@#15 = "Pendiente de cobro";
                              |SINO;
                                 #Replica@#14 = "I";
                                 #Replica@#15 = "Impagado";
                              |FINSI;
                           |SINO;
                              |SI #Replica@#16 = 0; |Y #dscam004#5 ! "IMP";
                                 #Replica@#14 = "T";
                                 #Replica@#15 = "Pagare/Talon de cliente";
                              |SINO;
                                 #Replica@#14 = "I";
                                 #Replica@#15 = "Impagado";
                              |FINSI;
                           |FINSI;
                        |SINO;
                           #Replica@#14 = "C";
                           #Replica@#15 = "Parcialmente cobrado";
                        |FINSI;
                     |FINSI;
                  |FINSI;
                  |GRABA 020#Replica@.a;
               |SINO;
                  |BORRA 020#Replica@.a;
               |FINSI;
               |LIBERA #Replica@;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE BajaTalPag;
#dscam003#7;
;
Entidad,NumDocum,000000001;
Entidad,NumDocum,999999999;
e;
NULL,BajaTalPag;
|FIN;

|PROCESO CuentaLRems;
   nCuentaLRem = nCuentaLRem + 1;
|FPRC;

|DEFBUCLE CuentaLRems;
#dscam013#1;
15;
nRemesa,001,"S";
nRemesa,999,"S";
;
NULL,CuentaLRems;
|FIN;

|PROCESO CuentaLSecs;
   nCuentaLSec = nCuentaLSec + 1;
|FPRC;

|DEFBUCLE CuentaLSecs;
#dscam004#3;
;
nNumSecuencia;
nNumSecuencia;
;
NULL,CuentaLSecs;
|FIN;

|PROCESO CuentaLAsie;
   nCuentaLAsi = nCuentaLAsi + 1;
|FPRC;

|DEFBUCLE CuentaLAsie;
#dscam067#2;
;
nEmp,nPer,nDia,fFec,nDoc,0000;
nEmp,nPer,nDia,fFec,nDoc,9999;
;
NULL,CuentaLAsie;
|FIN;

|PROCESO CuentaCobs;
   nCuentaCobs = nCuentaCobs + 1;
|FPRC;

|DEFBUCLE CuentaCobs;
#dscam004#3;
5;
nCodigo,aOper1;
nCodigo,aOper2;
;
NULL,CuentaCobs;
|FIN;

|PROCESO MiraRecs;
   #dscam003#40 = #dscam004#17;
   |LEE 000#dscam003.=;

   |SI FSalida = 0; |Y #dscam003#4 = fFechaEm;
      nSwError = 1; |ERROR10;
   |FINSI;
|FPRC;

|DEFBUCLE MiraRecs;
#dscam004#2;
;
00, aSerie, nFactura, 001, 01;
00, aSerie, nFactura, 999, 99;
;
NULL,MiraRecs;
|FIN;

|PROCESO BajaRecs;
   |BORRA 020#dscam003.a;
|FPRC;

|DEFBUCLE BajaRecs;
#dscam003#6;
4;
nLibro, aSerie, nFactura, 001, " ", 000000001, fFechaEm;
nLibro, aSerie, nFactura, 999, " ", 999999999, fFechaEm;
be;
NULL,BajaRecs;
|FIN;

|PROCESO UltimaRem;
   |SI #dscam004#5 = "EMR"; nNumCob = #dscam004#3; |FINSI;
|FPRC;

|DEFBUCLE UltimaRem;
#dscam004#1;
;
#dscam003#40, 001;
#dscam003#40, 999;
;
NULL,UltimaRem;
|FIN;

|PROCESO BorraEmiRem;
   #dscam004#17 = #dscam003#40;
   #dscam004#3  = 99;
   |LEE 000#dscam004.];
   |SI FSalida = 0;
      |SI #dscam004#17 = #dscam003#40;
         |SI #dscam004#17 = nNumDocum; |Y #dscam004#3 = nNumLin; |ACABA; |FINSI;
         |SI #dscam004#5 = "EMR";
            |BORRA 020#dscam004.a;
         |FINSI;
      |SINO;
         |LEE 000#dscam004.a;
         |SI FSalida = 0;
            |SI #dscam004#17 = #dscam003#40;
               |SI #dscam004#17 = nNumDocum; |Y #dscam004#3 = nNumLin; |ACABA; |FINSI;
               |SI #dscam004#5 = "EMR";
                  |BORRA 020#dscam004.a;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |SINO;
      |LEE 000#dscam004.u;
      |SI FSalida = 0;
         |SI #dscam004#17 = #dscam003#40;
            |SI #dscam004#17 = nNumDocum; |Y #dscam004#3 = nNumLin; |ACABA; |FINSI;
            |SI #dscam004#5 = "EMR";
               |BORRA 020#dscam004.a;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE BorraEmiRem;
#dscam003#14;
;
nRemesa, "    ", "          ", 000000001;
nRemesa, "zzzz", "zzzzzzzzzz", 999999999;
be;
NULL,BorraEmiRem;
|FIN;

|PROCESO MiraEmiRem;
   #dscam004#17 = #dscam003#40;
   #dscam004#3  = 99;
   |LEE 000#dscam004.];
   |SI FSalida = 0;
      |SI #dscam004#17 = #dscam003#40;
         |SI #dscam004#5 ! "EMR";
            nSwError = 1; |ERROR10;
         |FINSI;
      |SINO;
         |LEE 000#dscam004.a;
         |SI FSalida = 0;
            |SI #dscam004#17 = #dscam003#40;
               |SI #dscam004#5 ! "EMR";
                  nSwError = 1; |ERROR10;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |SINO;
      |LEE 000#dscam004.u;
      |SI FSalida = 0;
         |SI #dscam004#17 = #dscam003#40;
            |SI #dscam004#5 ! "EMR";
               nSwError = 1; |ERROR10;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE MiraEmiRem;
#dscam003#1;
17;
000000001,nRemesa;
999999999,nRemesa;
;
NULL,MiraEmiRem;
|FIN;

|PROCESO Vencidos;
   nSwError = 1; |ERROR10;
|FPRC;

|DEFBUCLE Vencidos;
#dscam013#1;
15;
#dscam003#17,001,"S";
#dscam003#17,999,"S";
;
NULL,Vencidos;
|FIN;

|PROCESO BajaVtoPag;
   |SI #dscam004#17 = nNumDocum; |ACABA; |FINSI;

   |SALVA_FICHA #dscam004;
   fFechaAnt = "01.01.0000"; nCalc = #dscam004#17;
   |LEE 000#dscam004.a;
   |SI FSalida = 0; |Y #dscam004#17 = nCalc;
      |SI #dscam004#5 ! "RPT"; |Y #dscam004#5 ! "PRE"; fFechaAnt = #dscam004#6; |FINSI;
   |FINSI;
   |REPON_FICHA #dscam004;

   #dscam003#40 = #dscam004#17;
   |LEE 000#dscam003.=;
   |SI FSalida = 0; |Y #dscam003#72 = Entidad; |Y #dscam003#70 = NumDocum;
      #dscam003#23 = #dscam003#23 - #dscam004#8; #dscam003#61 = #dscam003#61 - #dscam004#26;
      #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
      #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
      #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);

      #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;
      #dscam003#26 = fFechaAnt;

      #dscam003#14 = "T";
      #dscam003#15 = "Pagare/Talon de cliente";
      #dscam003#90 = "S";
      |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
      |GRABA 020#dscam003.a;

      eaTipoOper = "+4";
      enEmpCartera = -1;      enEmpGestion = #dscam003#46;
      eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
      nImporte = #dscam004#8; |HAZ BucleRiesgo;
      || ABDON N§ tiquet 010028/00685
      ||     Antes se metia el vencimiento de solo un pagar‚ en una sesion.
      || Ahora en una misma sesion pueden estar los vencimientos de m s de
      || un pagar‚. Por eso antes la linea siguiente estaba fuera de la
      || condici¢n.
      |BORRA 020#dscam004.a;
   |FINSI;
   ||BORRA 020#dscam004.a;
|FPRC;

|DEFBUCLE BajaVtoPag;
#dscam004#3;
5;
nNumSec,"RTA";
nNumSec,"RTA";
;
NULL, BajaVtoPag;
|FIN;

|PROCESO ContMovSesion;
   |SI #dscam004#17 = #dscam003#40; |ACABA; |FINSI;
   nContSesion = nContSesion + 1;
|FPRC;

|DEFBUCLE ContMovSesion;
#dscam004#3;
5;
nNumSec,"RTA";
nNumSec,"RTA";
;
NULL, ContMovSesion;
|FIN;

|PROCESO MiraAsto;
   nMovsEnt = nMovsEnt + 1;
|FPRC;

|DEFBUCLE MiraAsto;
#dscam067#2;
;
nEmpres, nPeriod, nDiario, fFecAsto, nDocumto, 0001;
nEmpres, nPeriod, nDiario, fFecAsto, nDocumto, 9999;
;
NULL,MiraAsto;
|FIN;

|PROCESO ComprRemesa;
   |ABRE #dscam012;
   #dscam012#0 = #dscam013#0;
   |LEE 000#dscam012.=;
   |SI FSalida ! 0; |DDEFECTO #dscam012; |FINSI;
   |CIERRA #dscam012;

   |SI nSwFuncion = 1; |Y #dscam013#16 ! nDocum;
      #dscam003#40 = #dscam013#16;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
            |SI #dscam003#14 ! "p"; |O #dscam003#17 ! nRemesa;
               nSw = 1; |ERROR10;
            |FINSI;
         |SINO;
            |SI #dscam003#14 ! "I"; |O #dscam003#17 ! nRemesa;
               nSw = 1; |ERROR10;
            |FINSI;
         |FINSI;
      |SINO;
         nSw = 1; |ERROR10;
      |FINSI;
   |FINSI;

   |SI nSwFuncion = 2; |Y #dscam013#16 ! nDocum;
      #dscam003#40 = #dscam013#16;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         #dscam004#17 = #dscam003#40;
         #dscam004#3  = 99;
         |LEE 000#dscam004.];
         |SI FSalida = 0;
            |SI #dscam004#17 = #dscam003#40;
               |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "IMA";
                  |BORRA 020#dscam004.a;
                  |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
                     #dscam003#23 = #dscam003#23 + #dscam004#8;
                     #dscam003#61 = #dscam003#61 + #dscam004#26;
                     #dscam003#31 = #dscam003#31 - #dscam004#8;
                     #dscam003#65 = #dscam003#65 - #dscam004#26;
                     #dscam003#16 = #dscam003#16 - 1;
                     |SI #dscam003#31 = 0;
                        #dscam003#14 = "e";
                        #dscam003#15 = "Entrega pdte.compensar";
                     |FINSI;

                     nImporte = #dscam004#26; eaTipoOper = "+5-7"; |HAZ BucleRiesgo;
                  |SINO;
                     #dscam003#23 = #dscam003#23 + #dscam004#9;
                     #dscam003#61 = #dscam003#61 + #dscam004#27;
                     #dscam003#31 = #dscam003#31 - #dscam004#9;
                     #dscam003#65 = #dscam003#65 - #dscam004#27;
                     #dscam003#16 = #dscam003#16 - 1;
                     |SI #dscam003#84 = "N";
                        |SI #dscam012#22 ! 1; |Y #dscam012#22 ! 3;
                           |SI #dscam004#5 = "IMP"; nImporte = #dscam004#27; eaTipoOper = "+6"; |FINSI;
                           |SI #dscam004#5 = "IMA"; nImporte = #dscam003#30; eaTipoOper = "+4"; |FINSI;
                           |HAZ BucleRiesgo;
                        |FINSI;
                        nImporte = #dscam004#27 + #dscam004#29 + #dscam004#30 + #dscam004#31 + #dscam004#32;
                        eaTipoOper = "-7"; |HAZ BucleRiesgo;
                     |FINSI;

                     |SI #dscam003#31 = 0;
                        #dscam003#14 = "L";
                        #dscam003#15 = "Recibo liquidado";
                     |FINSI;
                  |FINSI;
                  #dscam003#26 = #dscam004#6; fFechaRem = #dscam004#6;
                  #dscam003#70 = aNumero;
                  #dscam003#72 = aEntidad;
                  #dscam003#100 = "N";
                  |GRABA 020#dscam003.a;

                  |SI #dscam004#5 = "IMA";
                     |ABRE #dscam013;
                     #dscam013#0 = #dscam003#17;
                     #dscam013#1 = #dscam003#37;
                     |LEE 101#dscam013.=;
                     |SI FSalida = 0;
                        |SI #dscam013#15 = "I";
                           #dscam013#15 = "N";
                           |GRABA 020#dscam013.a; |LIBERA #dscam013;
                        |FINSI;
                     |FINSI;
                     |CIERRA #dscam013;
                  |FINSI;
               |FINSI;
            |SINO;
               |LEE 000#dscam004.a;
               |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
                  |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "IMA";
                     |BORRA 020#dscam004.a;
                     |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
                        #dscam003#23 = #dscam003#23 + #dscam004#8;
                        #dscam003#61 = #dscam003#61 + #dscam004#26;
                        #dscam003#31 = #dscam003#31 - #dscam004#8;
                        #dscam003#65 = #dscam003#65 - #dscam004#26;
                        #dscam003#16 = #dscam003#16 - 1;
                        |SI #dscam003#31 = 0;
                           #dscam003#14 = "e";
                           #dscam003#15 = "Entrega pdte.compensar";
                        |FINSI;

                        nImporte = #dscam004#26; eaTipoOper = "+5-7"; |HAZ BucleRiesgo;
                     |SINO;
                        #dscam003#23 = #dscam003#23 + #dscam004#9;
                        #dscam003#61 = #dscam003#61 + #dscam004#27;
                        #dscam003#31 = #dscam003#31 - #dscam004#9;
                        #dscam003#65 = #dscam003#65 - #dscam004#27;
                        #dscam003#16 = #dscam003#16 - 1;

                        |SI #dscam003#31 = 0;
                           #dscam003#14 = "L";
                           #dscam003#15 = "Recibo liquidado";
                        |FINSI;
                        |SI #dscam003#84 = "N";
                           |SI #dscam012#22 ! 1; |Y #dscam012#22 ! 3;
                              |SI #dscam004#5 = "IMP"; nImporte = #dscam004#27; eaTipoOper = "+6"; |FINSI;
                              |SI #dscam004#5 = "IMA"; nImporte = #dscam003#30; eaTipoOper = "+4"; |FINSI;
                              |HAZ BucleRiesgo;
                           |FINSI;
                           nImporte = #dscam004#27 + #dscam004#29 + #dscam004#30 + #dscam004#31 + #dscam004#32;
                           eaTipoOper = "-7"; |HAZ BucleRiesgo;
                        |FINSI;
                     |FINSI;
                     #dscam003#26 = #dscam004#6; fFechaRem = #dscam004#6;
                     #dscam003#70 = aNumero;
                     #dscam003#72 = aEntidad;
                     #dscam003#100 = "N";
                     |GRABA 020#dscam003.a;

                     |SI #dscam004#5 = "IMA";
                        |ABRE #dscam013;
                        #dscam013#0 = #dscam003#17;
                        #dscam013#1 = #dscam003#37;
                        |LEE 101#dscam013.=;
                        |SI FSalida = 0;
                           |SI #dscam013#15 = "I";
                              #dscam013#15 = "N";
                              |GRABA 020#dscam013.a; |LIBERA #dscam013;
                           |FINSI;
                        |FINSI;
                        |CIERRA #dscam013;
                     |FINSI;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            |LEE 000#dscam004.u;
            |SI FSalida = 0;
               |SI #dscam004#17 = #dscam003#40;
                  |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "IMA";
                     |BORRA 020#dscam004.a;
                     |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
                        #dscam003#23 = #dscam003#23 + #dscam004#8;
                        #dscam003#61 = #dscam003#61 + #dscam004#26;
                        #dscam003#31 = #dscam003#31 - #dscam004#8;
                        #dscam003#65 = #dscam003#65 - #dscam004#26;
                        #dscam003#16 = #dscam003#16 - 1;
                        |SI #dscam003#31 = 0;
                           #dscam003#14 = "e";
                           #dscam003#15 = "Entrega pdte.compensar";
                        |FINSI;

                        nImporte = #dscam004#26; eaTipoOper = "+5-7"; |HAZ BucleRiesgo;
                     |SINO;
                        #dscam003#23 = #dscam003#23 + #dscam004#9;
                        #dscam003#61 = #dscam003#61 + #dscam004#27;
                        #dscam003#31 = #dscam003#31 - #dscam004#9;
                        #dscam003#65 = #dscam003#65 - #dscam004#27;
                        #dscam003#16 = #dscam003#16 - 1;

                        |SI #dscam003#31 = 0;
                           #dscam003#14 = "L";
                           #dscam003#15 = "Recibo liquidado";
                        |FINSI;

                        |SI #dscam003#84 = "N";
                           |SI #dscam012#22 ! 1; |Y #dscam012#22 ! 3;
                              |SI #dscam004#5 = "IMP"; nImporte = #dscam004#27; eaTipoOper = "+6"; |FINSI;
                              |SI #dscam004#5 = "IMA"; nImporte = #dscam003#30; eaTipoOper = "+4"; |FINSI;
                              |HAZ BucleRiesgo;
                           |FINSI;
                        |FINSI;
                        nImporte = #dscam004#27 + #dscam004#29 + #dscam004#30 + #dscam004#31 + #dscam004#32;
                        eaTipoOper = "-7"; |HAZ BucleRiesgo;
                     |FINSI;
                     #dscam003#26 = #dscam004#6; fFechaRem = #dscam004#6;
                     #dscam003#70 = aNumero;
                     #dscam003#72 = aEntidad;
                     #dscam003#100 = "N";
                     |GRABA 020#dscam003.a;

                     |SI #dscam004#5 = "IMA";
                        |ABRE #dscam013;
                        #dscam013#0 = #dscam003#17;
                        #dscam013#1 = #dscam003#37;
                        |LEE 101#dscam013.=;
                        |SI FSalida = 0;
                           |SI #dscam013#15 = "I";
                              #dscam013#15 = "N";
                             |GRABA 020#dscam013.a; |LIBERA #dscam013;
                           |FINSI;
                        |FINSI;
                        |CIERRA #dscam013;
                     |FINSI;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
      |LIBERA #dscam003;
   |FINSI;
|FPRC;

|DEFBUCLE ComprRemesa;
#dscam013#1;
37, 38;
nRemesa, 001, aEntidad, aNumero;
nRemesa, 999, aEntidad, aNumero;
;
NULL, ComprRemesa;
|FIN;

|PROCESO ComprRTA;
   |SI #dscam004#5 ! "IMP"; |O #dscam004#5 ! "IMA"; |ACABA; |FINSI;

   |SI nSwFuncion = 1; |Y #dscam004#17 ! nDocum;
      #dscam003#40 = #dscam004#17;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         |DDEF aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "dscam004.mas";
         |CARGA_DEF aAlfa, dscam004@;
         |SI FSalida = 0;
            |DFICE aAlfa; |QBF aAlfa; |PATH_DAT #dscam004@#aAlfa#;
            |ABRE #dscam004@;
            #dscam004@#17 = #dscam004#17;
            #dscam004@#3 = #dscam004#3;
            |LEE 000#dscam004@.=;
            |SI FSalida = 0;
               |LEE 000#dscam004@.s;
               |SI FSalida ! 0; |O #dscam004@#17 ! #dscam004#17;
                  |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
                     |SI #dscam003#14 ! "p"; |O #dscam003#16 = 0;
                        nSw = 1; |ERROR10;
                     |FINSI;
                  |SINO;
                     |SI #dscam003#14 ! "I"; |O #dscam003#16 = 0;
                        nSw = 1; |ERROR10;
                     |FINSI;
                  |FINSI;
               |SINO;
                  nSw = 1; |ERROR10;
               |FINSI;
            |FINSI;
            |CIERRA #dscam004@; |DESCARGA_DEF #dscam004@;
         |FINSI;
      |FINSI;
   |FINSI;

   |SI nSwFuncion = 2; |Y #dscam004#17 ! nDocum;
      #dscam003#40 = #dscam004#17;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "IMA";
            |SALVA_FICHA #dscam004; |SELECT #1#dscam004;
            |LEE 000#dscam004.s;
            |SI FSalida ! 0; |O #dscam004#17 ! #dscam003#40;
               |SELECT #8#dscam004; |REPON_FICHA #dscam004;
               |BORRA 020#dscam004.a;

               |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
                  #dscam003#23 = #dscam003#23 + #dscam004#8;
                  #dscam003#61 = #dscam003#61 + #dscam004#26;
                  #dscam003#31 = #dscam003#31 - #dscam004#8;
                  #dscam003#65 = #dscam003#65 - #dscam004#26;
                  #dscam003#16 = #dscam003#16 - 1;
                  |SI #dscam003#31 = 0;
                     #dscam003#14 = "e";
                     #dscam003#15 = "Entrega pdte.compensar";
                  |FINSI;

                  nImporte = #dscam004#26; eaTipoOper = "+5-7"; |HAZ BucleRiesgo;
               |SINO;
                  #dscam003#23 = #dscam003#23 + #dscam004#9;
                  #dscam003#61 = #dscam003#61 + #dscam004#27;
                  #dscam003#31 = #dscam003#31 - #dscam004#9;
                  #dscam003#65 = #dscam003#65 - #dscam004#27;
                  #dscam003#16 = #dscam003#16 - 1;
                  |SI #dscam004#5 = "IMP"; nImporte = #dscam004#27; |FINSI;
                  |SI #dscam004#5 = "IMA"; nImporte = #dscam003#30; |FINSI;
                  nImporte = nImporte + #dscam004#29 + #dscam004#30 + #dscam004#31 + #dscam004#32;
                  eaTipoOper = "-7"; |HAZ BucleRiesgo;

                  |SI #dscam003#31 = 0;
                     #dscam003#14 = "L";
                     #dscam003#15 = "Recibo liquidado";
                  |FINSI;
               |FINSI;
               #dscam003#26 = #dscam004#6;
               #dscam003#70 = aNumero;
               #dscam003#72 = aEntidad;
               #dscam003#71 = fFechaVto;
               |GRABA 020#dscam003.a;
            |SINO;
               |SELECT #8#dscam004; |REPON_FICHA #dscam004;
            |FINSI;

            |SI #dscam004#5 = "IMA";
               |ABRE #dscam013;
               #dscam013#0 = #dscam003#17;
               #dscam013#1 = #dscam003#37;
               |LEE 101#dscam013.=;
               |SI FSalida = 0;
                  |SI #dscam013#15 = "I";
                     #dscam013#15 = "N";
                    |GRABA 020#dscam013.a; |LIBERA #dscam013;
                  |FINSI;
               |FINSI;
               |CIERRA #dscam013;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE ComprRTA;
#dscam004#8;
5;
aEntidad, aNumero, "IMA";
aEntidad, aNumero, "IMP";
be;
NULL, ComprRTA;
|FIN;

|PROCESO Factoring;
   |SI aEntidad ! "    "; |Y aNumero ! "          ";
      #dscam004#17 = #dscam003#40;
      #dscam004#3 = 1;
      |LEE 000#dscam004.];
      |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
         nLinea = #dscam004#3;
         |LEE 000#dscam004.s;
      |SIGUE;

      #dscam004#17 = #dscam003#40;
      #dscam004#3 = nLinea;
      |LEE 101#dscam004.=;
      |SI FSalida ! 0; |O #dscam004#5 ! aOperac; |LIBERA #dscam004; |ACABA; |FINSI;
   |FINSI;

   |ABRE #dscam067;
   #dscam067#8 = 0;
   #dscam067#9 = 0;
   #dscam067#0  = "CB";
   #dscam067#1  = #dscam004#17;
   #dscam067#2  = #dscam004#3;
   #dscam067#3  = "";
   #dscam067#11 = 1;
   |LEE 000#dscam067.];
   FEstado = FSalida;
   Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
   |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
      |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3 = "";
         |SAL;
      |FINSI;
      |LEE 000#dscam067.s;
      FEstado = FSalida;
      Clave1 = #dscam067#1; Clave2 = #dscam067#2;
      Clave3 = #dscam067#3; |QBF Clave3;
   |SIGUE;

   |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
    |Y Clave3  = "";
      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #4 Comodin;
      |DELINDEX #dscaw013; |ABRE #dscaw013;
      aAlfa = #dscam067#10;

      |DDEFECTO #dscaw013;
      #dscaw013#15 = aAlfa;        #dscaw013#0 = 1;
      #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
      #dscaw013#11 = "N";          #dscaw013#12 = 9;
      #dscaw013#5  = #dscam004#17; #dscaw013#6 = #dscam004#17;
      |GRABA 020#dscaw013.n;

      |DDEFECTO #dscaw013;
      #dscaw013#15 = aAlfa;      #dscaw013#0 = 2;
      #dscaw013#13 = "dscam004"; #dscaw013#14 = 3;
      #dscaw013#11 = "N";        #dscaw013#12 = 2;
      #dscaw013#5  = #dscam004#3;  #dscaw013#6 = #dscam004#3;
      |GRABA 020#dscaw013.n;

      aAlfa = "dscam033.tab;" + aAlfa + ",B";
      |LIBERA #dscam003; |CIERRAT #dscam003;
      |LIBERA #dscam004; |CIERRAT #dscam004;
      |SUB_EJECUTA_NP aAlfa;
      |ABRET #dscam003; |LEE 101#dscam003.=;
      |ABRET #dscam004; |LEE 101#dscam004.=;

      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
   |FINSI;
   |CIERRA #dscam067;

   |ABRE #dscam013;
   #dscam013#0 = #dscam003#17;
   #dscam013#1 = #dscam003#37;
   |LEE 101#dscam013.=;
   |SI FSalida = 0; |Y #dscam013#16 = #dscam003#40;
      #dscam013#15 = "N";
      |GRABA 020#dscam013.a; |LIBERA #dscam013;
   |FINSI;
   |CIERRA #dscam013;

   |SI aEntidad ! "    "; |Y aNumero ! "          ";
      |SI nNumDocum ! #dscam004#17;
         #dscam003#30 = #dscam003#30 - #dscam004#8; #dscam003#64 = #dscam003#64 - #dscam004#26;
         #dscam003#23 = #dscam003#23 - #dscam004#8; #dscam003#61 = #dscam003#61 - #dscam004#26;
         #dscam003#55 = #dscam003#55 + #dscam004#8; #dscam003#68 = #dscam003#68 + #dscam004#26;
         |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
         |GRABA 020#dscam003.a;
      |FINSI;
   |SINO;
      #dscam003#30 = #dscam003#30 - #dscam004#8; #dscam003#64 = #dscam003#64 - #dscam004#26;
      #dscam003#23 = #dscam003#23 - #dscam004#8; #dscam003#61 = #dscam003#61 - #dscam004#26;
      #dscam003#55 = #dscam003#55 + #dscam004#8; #dscam003#68 = #dscam003#68 + #dscam004#26;
      |GRABA 020#dscam003.a;
   |FINSI;

   enEmpCartera = -1;     enEmpGestion = #dscam003#46;
   eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
   nImporte = #dscam003#30 + #dscam003#55; eaTipoOper = "+6";
   |HAZ BucleRiesgo;

   |SI nNumDocum ! #dscam004#17; |Y aEntidad ! "    "; |Y aNumero ! "          ";
      |BORRA 020#dscam004.a;
   |FINSI;
|FPRC;

|DEFBUCLE BucleFactoring;
#dscam003#7;
;
aEntidad, aNumero, 000000001;
aEntidad, aNumero, 999999999;
be;
NULL,Factoring;
|FIN;

|PROCESO Documentos;
   #dscam067#8 = 0;
   #dscam067#9 = 0;
   #dscam067#0 = "CB";
   #dscam067#1 = #dscam004#17;
   #dscam067#2 = #dscam004#3;
   #dscam067#3 = "";
   #dscam067#11 = 1;
   |LEE 000#dscam067.];
   nCalc2 = #dscam067#1;
   nCalc3 = #dscam067#2;
   Clave3 = #dscam067#3; |QBF Clave3;
   |SI FSalida = 0; |Y nCalc2 = #dscam004#17; |Y nCalc3 = #dscam004#3; |Y Clave3  = "";
      |SI nDocum ! #dscam067#6; nDocum = -1; |ERROR10; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Documentos;
#dscam004#3;
;
nSesion;
nSesion;
;
NULL, Documentos;
|FIN;

|PROCESO CajaEfectivo;
  |DBASS aAlfa; |QBF aAlfa;
  aAlfa = aAlfa + "contagen/def/cajainca.mas";
  |CARGA_DEF aAlfa, cajainca@;
  |SI FSalida = 0;
     |DBASS aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "contagen/def/cajainli.mas";
     |CARGA_DEF aAlfa, cajainli@;
     |SI FSalida = 0;
        |DBASS aAlfa; |QBF aAlfa;
        aAlfa = aAlfa + "contagen/def/canempre.mas";
        |CARGA_DEF aAlfa, caempr@;
        |SI FSalida = 0;
           |DBASS aAlfa; |QBF aAlfa;
           aAlfa = aAlfa + "contagen/fich/"; |PATH_DAT #caempr@#aAlfa#;
           |ABRE #caempr@;
           |DFICB aAlfa; |QBF aAlfa; |PATH_DAT #dscam043#aAlfa#;
           |ABRE #dscam043;
           |SELECT #2#dscam043;
           #dscam043#9 = #48#0;
           |LEE 000#dscam043.];
           |PARA; |SI FSalida = 0; |HACIENDO;
              #caempr@#2 = #dscam043#0;
              #caempr@#3 = #dscam043#1;
              |LEE 000#caempr@.=;
              |SI FSalida = 0;
                 nAnyo = #caempr@#26;
                 |SI nAnyo > 80;
                    nAnyo = nAnyo + 1900;
                 |SINO;
                    nAnyo = nAnyo + 2000;
                 |FINSI;
                 aAlfa = #dscam004#6; |QBF aAlfa;
                 aAlfa = aAlfa % -104; nCalc4 = aAlfa;
                 |SI nCalc4 = nAnyo; |Y #dscam004#0 ] #dscam043#7; |Y #dscam004#0 [ #dscam043#8;
                  |Y #dscam043#3 = "V";
                    |DBASS eaDirConta; |QBF eaDirConta;
                    enSwError   = 0;
                    eaDirConta = eaDirConta + "contagen/";
                    efFecha = #dscam004#6;
                    eaEmpContab = (("00000" + #dscam043#0) % -105) + #dscam043#1;
                    |HAZ CompruebaEmpContable;
                    |SI enSwError < 0;
                       |SI enSwError = -1;
                          |MENAV "    Empresa cerrada. Proceso cancelado.";
                       |FINSI;
                       |SI enSwError = -2;
                          |MENAV "    No se encuentran los ficheros de contabilidad. Proceso cancelado.";
                       |FINSI;
                       |SI enSwError = -3;
                          |MENAV "    No se encuentra la empresa de contabilidad. Proceso cancelado.";
                       |FINSI;
                       |SI enSwError = -4;
                          aAlfa = "    Empresa contable bloqueada a fecha " + #caempr@#34;
                          |MENAV aAlfa;
                       |FINSI;
                       |CIERRA #caempr@; |DESCARGA_DEF #caempr@;
                       |CIERRA #cajainli@; |DESCARGA_DEF #cajainli@;
                       |CIERRA #cajainca@; |DESCARGA_DEF #cajainca@;
                       nSwErr1 = -1;
                       |ERROR; |ACABA;
                    |FINSI;
                    |SAL;
                 |FINSI;
              |FINSI;
              |LEE 000#dscam043.s;
           |SIGUE;
           |SI FSalida = 0; |Y nCalc4 = nAnyo; |Y #dscam004#0 ] #dscam043#7; |Y #dscam004#0 [ #dscam043#8;
            |Y #caempr@#34 > #dscam004#6; |O #caempr@#34 = "01.01.0000";
              |DBASS aAlfa; |QBF aAlfa;
              aAlfa = aAlfa + "contagen/fich/" + (("00000" + #dscam043#0) % -105) + #dscam043#1 + "/";
              |PATH_DAT #cajainca@#aAlfa#; |PATH_DAT #cajainli@#aAlfa#;
              |ABRE #cajainca@; |ABRE #cajainli@;
              #cajainca@#1 = #dscam004#6;
              |LEE 101#cajainca@.=;
              |SI FSalida = 0;
                 #cajainli@#1 = #cajainca@#1;
                 #cajainli@#3 = #dscam004#56;
                 |LEE 101#cajainli@.=;
                 |SI FSalida = 0;
                    |BORRA 020#cajainli@.a;
                 |SINO;
                    |MENAV "    Diario de caja actualizado";
                    |LIBERA #cajainca@;
                    |CIERRA #caempr@;   |DESCARGA_DEF #caempr@;
                    |CIERRA #cajainli@; |DESCARGA_DEF #cajainli@;
                    |CIERRA #cajainca@; |DESCARGA_DEF #cajainca@;
                    nSwErr1 = -1;
                    |ERROR; |ACABA;
                 |FINSI;
                 #cajainli@#1 = #cajainca@#1;
                 #cajainli@#3 = 1;
                 |LEE 101#cajainli@.];
                 |SI FSalida ! 0; |O #cajainli@#1 ! #cajainca@#1;
                    |BORRA 020#cajainca@.a;
                 |SINO;
                    #cajainca@#3 = #cajainca@#3 - #dscam004#8;
                    |GRABA 020#cajainca@.a;
                 |FINSI;
                 |LIBERA #cajainca@;
              |SINO;
                 |MENAV "    Diario de caja actualizado";
                 |CIERRA #caempr@; |DESCARGA_DEF #caempr@;
                 |CIERRA #cajainli@; |DESCARGA_DEF #cajainli@;
                 |CIERRA #cajainca@; |DESCARGA_DEF #cajainca@;
                 nSwErr1 = -1;
                 |ERROR; |ACABA;
              |FINSI;
           |FINSI;
           |CIERRA #cajainca@; |CIERRA #cajainli@;
           |CIERRA #caempr@; |DESCARGA_DEF #caempr@;
        |FINSI;
        |CIERRA #dscam043;
        |DESCARGA_DEF #cajainli@;
     |FINSI;
     |DESCARGA_DEF #cajainca@;
  |FINSI;
|FPRC;

|PROCESO BuscaACAs;
   aAlfa = #dscam004#16; |QBF aAlfa; aAlfa = aAlfa % -109;
   nCalc = aAlfa;

   |SI nSw = 1;
      |SI nCalc = nDocSald;
         nCalc = #dscam004#17;

         |SALVA_FICHA #dscam004;
         |LEE 000#dscam004.s;
         |SI #dscam004#17 = nCalc; nSwError = 1; |FINSI;
         |REPON_FICHA #dscam004;
         |SI nSwError = 1; |ERROR10; |FINSI;
      |SINO;
         nSwError = 1; |ERROR10;
      |FINSI;
   |FINSI;
   |SI nSw = 2;
      |SI nCalc = nDocSald;
         #dscam003#40 = #dscam004#17;
         |LEE 101#dscam003.=;
         |SI FSalida = 0;
            #dscam003#23 = #dscam003#23 + #dscam004#9; #dscam003#61 = #dscam003#61 + #dscam004#27;
            #dscam003#31 = #dscam003#31 - #dscam004#9; #dscam003#65 = #dscam003#65 - #dscam004#27;
            |SI #dscam003#31 = 0;
               #dscam003#14 = "L";
               #dscam003#15 = "Recibo liquidado";
            |SINO;
               #dscam003#14 = "C";
               #dscam003#15 = "Parcialmente cobrado";
            |FINSI;
            |GRABA 020#dscam003.a; |LIBERA #dscam003;

            |BORRA 020#dscam004.a; |LIBERA #dscam004;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE BuscaACAs;
#dscam004#4;
;
"ACA", 000000001;
"ACA", 999999999;
be;
NULL, BuscaACAs;
|FIN;

|PROCESO Actual; |TIPO 2;
   |SI #dscam003#14 = "D"; |O #dscam003#14 = "A";
      |SI #dscam003#14 = "D"; |MENAV "    Recibo dividido. No se puede rectificar."; |FINSI;
      |SI #dscam003#14 = "A"; |MENAV "    Recibo agrupado. No se puede rectificar."; |FINSI;
      |ERROR; |ACABA;
   |FINSI;

   |SI #dscam004#57 = 1;
      Flag = 0 +. 1;
      |SI Flag < 0;
         |MENAV "    Movimiento externo marcado para no modificar ni eliminar";
      |FINSI;
      |ERROR; |ACABA;
   |FINSI;

   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 1;
      |HAZ EntradaManual; |ACABA;
   |FINSI;

   nDocum = #dscam004#17;
   NumRemesa = #dscam003#17;
   NumLinea  = #dscam003#37;
   |SALVA_FICHA #dscam004;
   |LEE 000#dscam004.a;
   |SI FSalida = 0; |Y #dscam004#17 = nDocum;
      aOperAnt = #dscam004#5;
      UltFecCo = #dscam004#6;
      nImpOpAnt = #dscam004#8;
      |SI aOperAnt = "CFR";
         aEntDocum = #dscam004#51;
         aNumDocum = #dscam004#52;
         aFecDocum = #dscam004#53;
      |FINSI;
   |SINO;
      aOperAnt = "";
      UltFecCo = #dscam003#4;
      aEntDocum = "";
      aNumDocum = "";
      aFecDocum = "";
      nImpOpAnt = 0;
   |FINSI;
   |PARA; |SI FSalida = 0; |Y #dscam004#17 = nDocum; |HACIENDO;
      UltCobro = #dscam004#3;
      |LEE 000#dscam004.s;
   |SIGUE;
   |REPON_FICHA #dscam004;

   ModoEntrada = (FEntrada / 100) ! 0; Flag = 0 +. 1;
   |SI ModoEntrada = 2;
      |HAZ BloqueaCambios;
      |SI enSwErr = 1; |ACABA; |FINSI;
   |FINSI;

   |SI ModoEntrada = 3;
      |SI Flag = 1; |ACABA; |FINSI;
   |SINO;
      |SI Flag < 0;
         efFechaEdit = #dscam004#6;
         eaMovtoEdit = #dscam004#5;
      |FINSI;
   |FINSI;

   |SI #dscam004#3 ! UltCobro;
      |SI Flag = -1;
         |MENAV "    Las modificaciones deben hacerse por orden cronologico";
      |FINSI;
      |ERROR; |ACABA;
   |FINSI;

   || Si lo que estamos haciendo es una modificacion o una baja lo que
   || debemos hacer es  comprobar que la contabilidad no va a dar problemas
   || a la hora de ejecutarla.

   nSwError = 0; enSwError = 0;
   |SI ModoEntrada = 3; |O ModoEntrada = 2;
      |ABRE #dscam067; |DDEFECTO #dscam067;
      aAlfa = "CB";
      |SI #dscam004#5 = "REM";
         #dscam067#0  = "RM";
         #dscam067#1  = NumRemesa;
         #dscam067#2  = NumLinea;
         |LEE 000#dscam067.];
         |SI FSalida = 0; |Y #dscam067#0  = "RM"; |Y #dscam067#1  = NumRemesa; |Y #dscam067#2  = NumLinea;
            nHayAsto = 1;
         |SINO;
            nHayAsto = 0;
         |FINSI;
      |SINO;
         |SI #dscam004#5 = "EMR";
            nHayAsto = 0;
            #dscam067#0  = "RM";
            #dscam067#1  = NumRemesa;
            #dscam067#2  = 1;
            #dscam067#3  = "I";
            |LEE 000#dscam067.];
            |PARA; |SI FSalida = 0; |Y #dscam067#0  = "RM"; |Y #dscam067#1  = NumRemesa; |HACIENDO;
               |SI #dscam067#3  = "I"; nHayAsto = 1; |SAL; |FINSI;
               |LEE 000#dscam067.s;
            |SIGUE;
         |SINO;
            #dscam067#0  = "CB";
            #dscam067#1 = #dscam004#17;
            #dscam067#2 = #dscam004#3;
            |LEE 000#dscam067.];
            |SI FSalida = 0; |Y #dscam067#0 = "CB"; |Y #dscam067#1 = #dscam004#17; |Y #dscam067#2 = #dscam004#3;
               nHayAsto = 1;
            |SINO;
               nHayAsto = 0;
            |FINSI;
         |FINSI;
      |FINSI;

      |SI nHayAsto = 1;
         |ABRE #dscam030;
         #dscam030#0 = #dscam067#10;
         |LEE 000#dscam030.=;
         |SI FSalida = 0;
            eaDirConta  = #dscam030#6; |QBF eaDirConta;
            eaEmpContab = (("00000" + #dscam067#8) % -105) + #dscam067#9;
            efFecha     = #dscam067#5; |HAZ CompruebaEmpContable;
            || enSwError   = 0;
         |FINSI;
         |CIERRA #dscam030;
      |FINSI;

      |SI enSwError ! 0;
         |SI enSwError = -1;
            |SI ModoEntrada ! 2; |O Flag < 0;
               |MENAV "    Error. Empresa contable cerrada o inexistente. No se efectuara la operacion";
            |FINSI;
            |ERROR; |ACABA;
         |FINSI;
         |SI enSwError = -2;
            |SI ModoEntrada ! 2; |O Flag < 0;
               |MENAV "    No se encuentra el fichero de asientos de contabilidad.";
            |FINSI;
            |ERROR; |ACABA;
         |FINSI;
         |SI enSwError = -3;
            |SI ModoEntrada ! 2; |O Flag < 0;
               |MENAV "    Error. No se encuentra el fichero de empresas contables. No se efectuara la operacion";
            |FINSI;
            |ERROR; |ACABA;
         |FINSI;
         |SI enSwError = -4;
            |SI ModoEntrada ! 2; |O Flag < 0;
               aAlfa = "    Error. La empresa contable tiene bloqueo con fecha " + efFecha + ". No se efectuara la operacion";
            |FINSI;
            |MENAV aAlfa;
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;
   |FINSI;

   eaLlamada = "A";
   |SI ModoEntrada = 3; |HAZ BorraAnota; |FINSI;

   |HAZ OtrosMovtos;
   |SI enSwErr = -1; |ACABA; |FINSI;
   |SI enSwErr = -2; |ERROR; |ACABA; |FINSI;

   |SI #dscam004#5 = "EMR";
      |SI ModoEntrada = 2;
         |MENAV "    No se puede modificar este movimiento"; |ERROR; |ACABA;
      |FINSI;
      |SI ModoEntrada = 3; |Y Flag < 1;
         || Primero miramos si algun documento de esa remesa tiene movimientos.
         ||    Si es asi , no dejamos dar de baja
         |ABRE #dscam012;
         #dscam012#0 = #dscam003#17;
         |LEE 000#dscam012.=;
         |SI FSalida = 0; |Y #dscam012#8 = "S"; |O #dscam012#9 = "S";
            |CIERRA #dscam012;
            |MENAV "    Remesa con movimientos en otros documentos. No se dara de baja la emision";
            |ERROR; |ACABA;
         |FINSI;
         |CIERRA #dscam012;

         nRemesa = #dscam003#17;
         nNumDoc = #dscam004#17; nNumLin = #dscam004#3;
         |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
         |BUCLE BorraEmiRem;
         |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;

         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #4 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;

         |DDEFECTO #dscaw013;
         #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
         #dscaw013#13 = "dscam013";   #dscaw013#14 = 0;
         #dscaw013#11 = "N";          #dscaw013#12 = 5;
         #dscaw013#5 = nRemesa;       #dscaw013#6 = nRemesa;
         |GRABA 020#dscaw013.n;
         |LIBERA #dscaw013; |CIERRA #dscaw013;

         Comodin = #dscam067#10;
         Comodin = "dscam033.tab;" + Comodin + ",B,I";
         |LIBERA #dscam003; |CIERRAT #dscam003;
         |LIBERA #dscam004; |CIERRAT #dscam004;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam003; |LEE 101#dscam003.=;
         |ABRET #dscam004; |LEE 101#dscam004.=;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

         |ABRE #dscam012;
         #dscam012#0 = nRemesa;
         |LEE 101#dscam012.=;
         |SI FSalida = 0;
            #dscam012#23 = "N"; |GRABA 020#dscam012.a;
            |LIBERA #dscam012;
         |FINSI;
         |CIERRA #dscam012;
         |ACABA;
      |FINSI;
   |FINSI;

   |SI #dscam004#5 = "PRC"; |O #dscam004#5 = "PRA";
      |SI ModoEntrada = 2; |O ModoEntrada = 3;
         |SI ModoEntrada = 2;
            |SI Flag < 1;
               |ACABA;
            |SINO;
               eaDescr   = "MODIFICACION PETICION RECLAMACION RECIBO (" + #dscam003#0 + "/";
               eaDescr   = eaDescr + #dscam003#1 + "/" + #dscam003#2 + ") DESDE LINEAS DE RECIBOS";
               eaTipoOp  = "M";   enImpAnt = #dscam003#23;
               eaFicher = "dscam003"; eaClave = #dscam003#40;
               enImpAct  = #dscam003#23 - #dscam004#8; |HAZ GrabaAudit;
               |GRABA 020#dscam004.a;
            |FINSI;
         |FINSI;
         |SI ModoEntrada = 3; |Y Flag < 1;
            eaDescr   = "BAJA PETICION RECLAMACION RECIBO (" + #dscam003#0 + "/";
            eaDescr   = eaDescr + #dscam003#1 + "/" + #dscam003#2 + ") DESDE LINEAS DE RECIBOS";
            eaTipoOp  = "M";   enImpAnt = #dscam003#23;
            eaFicher = "dscam003"; eaClave = #dscam003#40;
            enImpAct  = #dscam003#23 - #dscam004#8; |HAZ GrabaAudit;
            |SI #dscam003#72 ! "    ";
               |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
               nNumDocum = #dscam004#17; nNumLin   = #dscam004#3;
               eaEntPag = #dscam003#72;  eaNumPag = #dscam003#70;
               ||BUCLE PetRecl;
               |HAZ PetReclam;
               |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;
            |SINO;
               #dscam003#98 = "N";
               |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
               |GRABA 020#dscam003.a; |LIBERA #dscam003;
            |FINSI;
         |FINSI;

         |ABRE #dscam067;
         #dscam067#8 = 0;
         #dscam067#9 = 0;
         #dscam067#0 = "CB";
         #dscam067#1 = #dscam004#17;
         #dscam067#2 = #dscam004#3;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
            |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
               |SAL;
            |FINSI;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
         |SIGUE;

         |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
          |Y Clave3  = "";
            |SI Flag < 1;
               |SALVA_FICHA #dscam004;
               nCodigo = #dscam004#43;
               aOper1  = #dscam004#5; aOper2  = #dscam004#5;
               nCuentaCobs = 0;
               |BUCLE CuentaCobs;
               |LEE 000#dscam004.p;
               |REPON_FICHA #dscam004;
               |SI nCuentaCobs = 1;
                  Modo1 = ",B";
               |SINO;
                  |SALVA_DATOS #dscam004; |BORRA 020#dscam004.a;
                  Modo1 = "";
               |FINSI;
            |SINO;
               Modo1 = "";
            |FINSI;

            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #dscaw013#Comodin#;
            |DELINDEX #dscaw013; |ABRE #dscaw013;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            #dscaw013#5 = #dscam004#43;  #dscaw013#6 = #dscam004#43;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
            #dscaw013#11 = "A";          #dscaw013#12 = 3;
            #dscaw013#3 = #dscam004#5;  #dscaw013#4 = #dscam004#5;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
            #dscaw013#11 = "F";          #dscaw013#12 = 10;
            #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
            |GRABA 020#dscaw013.n;

            |LIBERA #dscaw013; |CIERRA #dscaw013;

            Comodin = #dscam067#10;
            Comodin = "dscam033.tab;" + Comodin + Modo1;
            |LIBERA #dscam003; |CIERRAT #dscam003;
            |LIBERA #dscam004; |CIERRAT #dscam004;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam003; |LEE 101#dscam003.=;
            |ABRET #dscam004; |LEE 101#dscam004.=;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
      |FINSI;
      |ACABA;
   |FINSI;
   |SI #dscam004#5 = "ENV";
      |SI ModoEntrada = 2;
         |MENAV "    No se puede modificar este movimiento"; |ERROR; |ACABA;
      |FINSI;
      |SI ModoEntrada = 3; |Y Flag < 1;
         #dscam003#93 = "N";
         #dscam003#14 = "P";
         #dscam003#15 = "Pendiente de cobro";
         #dscam003#95 = "";
         |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
         |ABRE #dscam067;
         #dscam067#8 = 0;
         #dscam067#9 = 0;
         #dscam067#0 = "CB";
         #dscam067#1 = #dscam004#17;
         #dscam067#2 = #dscam004#3;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
            |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
               |SAL;
            |FINSI;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
         |SIGUE;
         |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
          |Y Clave3  = "";
            |SALVA_FICHA #dscam004;
            nCodigo = #dscam004#43;
            aOper1  = #dscam004#5; aOper2  = #dscam004#5;
            nCuentaCobs = 0;
            |BUCLE CuentaCobs;
            |LEE 000#dscam004.p; |REPON_FICHA #dscam004;
            |SI nCuentaCobs = 1;
               Modo1 = ",B";
            |SINO;
               |SALVA_DATOS #dscam004; |BORRA 020#dscam004.a;
               Modo1 = "";
            |FINSI;
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #4 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            #dscaw013#5 = #dscam004#43;  #dscaw013#6 = #dscam004#43;
            |GRABA 020#dscaw013.n;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
            #dscaw013#11 = "A";          #dscaw013#12 = 3;
            #dscaw013#3 = #dscam004#5;  #dscaw013#4 = #dscam004#5;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
            #dscaw013#11 = "F";          #dscaw013#12 = 10;
            #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
            |GRABA 020#dscaw013.n;

            |LIBERA #dscaw013; |CIERRA #dscaw013;

            Comodin = #dscam067#10;
            Comodin = "dscam033.tab;" + Comodin + Modo1;
            |LIBERA #dscam003; |CIERRAT #dscam003;
            |LIBERA #dscam004; |CIERRAT #dscam004;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam003; |LEE 101#dscam003.=;
            |ABRET #dscam004; |LEE 101#dscam004.=;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
      |FINSI;
      |ACABA;
   |FINSI;

   |SI #dscam004#5 = "PRE"; |O #dscam004#5 = "RCF";
      |SI #dscam003#17 ! 0; |Y #dscam003#14 = "R";
         |MENAV "    El documento esta remesado. No se puede tocar la preparacion"; |ERROR; |ACABA;
      |FINSI;
      |SI ModoEntrada = 2;
         |MENAV "    No se puede modificar este movimiento"; |ERROR; |ACABA;
      |FINSI;

      |SI ModoEntrada = 3; |Y Flag < 1;
         |SI #dscam004#5 = "PRE"; #dscam003#90 = "N"; |FINSI;
         |SI #dscam004#5 = "RCF"; #dscam003#97 = "N"; |FINSI;
         |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;

         |ABRE #dscam067;
         #dscam067#8 = 0;
         #dscam067#9 = 0;
         #dscam067#0 = "CB";
         #dscam067#1 = #dscam004#17;
         #dscam067#2 = #dscam004#3;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
            |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
               |SAL;
            |FINSI;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
         |SIGUE;

         |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
          |Y Clave3  = "";
            |SALVA_FICHA #dscam004;
            nCodigo = #dscam004#43;
            aOper1  = #dscam004#5; aOper2  = #dscam004#5;
            |SI nCodigo ! 0;
               nCuentaCobs = 0; |BUCLE CuentaCobs;
            |SINO;
               nCuentaCobs = 1;
            |FINSI;
            |LEE 000#dscam004.p; |REPON_FICHA #dscam004;
            |SI nCuentaCobs = 1; |O #dscam004#43 = 0;
               Modo1 = ",B";
            |SINO;
               |SALVA_DATOS #dscam004; |BORRA 020#dscam004.a;
               Modo1 = "";
            |FINSI;
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #4 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
            #dscaw013#13 = "dscam004";
            |SI #dscam004#43 ! 0;
               #dscaw013#14 = 43; #dscaw013#11 = "N";
               #dscaw013#12 = 10;
               #dscaw013#5 = #dscam004#43;  #dscaw013#6 = #dscam004#43;
            |SINO;
               #dscaw013#14 = 17; #dscaw013#11 = "N";
               #dscaw013#12 = 9;
               #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
            |FINSI;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
            #dscaw013#11 = "A";          #dscaw013#12 = 3;
            #dscaw013#3 = #dscam004#5;  #dscaw013#4 = #dscam004#5;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
            #dscaw013#11 = "F";          #dscaw013#12 = 10;
            #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
            |GRABA 020#dscaw013.n;

            |LIBERA #dscaw013; |CIERRA #dscaw013;

            Comodin = #dscam067#10;
            Comodin = "dscam033.tab;" + Comodin + Modo1;
            |LIBERA #dscam003; |CIERRAT #dscam003;
            |LIBERA #dscam004; |CIERRAT #dscam004;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam003; |LEE 101#dscam003.=;
            |ABRET #dscam004; |LEE 101#dscam004.=;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
      |FINSI;
      |ACABA;
   |FINSI;
   |SI #dscam004#5 = "ACE"; |Y ModoEntrada = 3;
      |SI ModoEntrada = 2;
         |MENAV "    No se puede modificar este movimiento"; |ERROR; |ACABA;
      |FINSI;

      |SI ModoEntrada = 3; |Y Flag < 1;
         #dscam003#29 = "N";
         #dscam003#14 = "V";
         #dscam003#15 = "Recibo enviado al cliente";
         #dscam003#96 = "";
         #dscam003#90 = "N";
         |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;

         |ABRE #dscam067;
         #dscam067#8 = 0;
         #dscam067#9 = 0;
         #dscam067#0 = "CB";
         #dscam067#1 = #dscam004#17;
         #dscam067#2 = #dscam004#3;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
            |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
               |SAL;
            |FINSI;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
         |SIGUE;

         |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
          |Y Clave3  = "";

            |SALVA_FICHA #dscam004;
            nCodigo = #dscam004#43;
            aOper1  = #dscam004#5; aOper2  = #dscam004#5;
            nCuentaCobs = 0;
            |BUCLE CuentaCobs;
            |LEE 000#dscam004.p; |REPON_FICHA #dscam004;
            |SI nCuentaCobs = 1;
               Modo1 = ",B";
            |SINO;
               |SALVA_DATOS #dscam004; |BORRA 020#dscam004.a;
               Modo1 = "";
            |FINSI;

            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #4 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            #dscaw013#5 = #dscam004#43;  #dscaw013#6 = #dscam004#43;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
            #dscaw013#11 = "A";          #dscaw013#12 = 3;
            #dscaw013#3 = #dscam004#5;  #dscaw013#4 = #dscam004#5;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
            #dscaw013#11 = "F";          #dscaw013#12 = 10;
            #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
            |GRABA 020#dscaw013.n;

            |LIBERA #dscaw013; |CIERRA #dscaw013;

            Comodin = #dscam067#10;
            Comodin = "dscam033.tab;" + Comodin + Modo1;
            |LIBERA #dscam003; |CIERRAT #dscam003;
            |LIBERA #dscam004; |CIERRAT #dscam004;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam003; |LEE 101#dscam003.=;
            |ABRET #dscam004; |LEE 101#dscam004.=;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
      |FINSI;
      |ACABA;
   |FINSI;

   |SI #dscam004#5 = "FAR"; |O #dscam004#5 = "FAP";
      |SI ModoEntrada = 3; || Recuperacion factoring
         aEntidad = #dscam003#72; aNumero = #dscam003#70;
         |SI #dscam003#70 = "          "; |Y #dscam003#72 = "    ";
            |HAZ Factoring;
         |SINO;
            nNumDocum = #dscam004#17; aOperac = #dscam004#5; nNumLinea = #dscam004#3;
            |LIBERA #dscam003; |LIBERA #dscam004;
            |BUCLE BucleFactoring;
            #dscam003#40 = nNumDocum; |LEE 101#dscam003.=;
            #dscam004#17 = nNumDocum; #dscam004#3 = nNumLinea; |LEE 101#dscam004.=;
            |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;

            #dscam003#30 = #dscam003#30 - #dscam004#8; #dscam003#64 = #dscam003#64 - #dscam004#26;
            #dscam003#23 = #dscam003#23 - #dscam004#8; #dscam003#61 = #dscam003#61 - #dscam004#26;
            #dscam003#55 = #dscam003#55 + #dscam004#8; #dscam003#68 = #dscam003#68 + #dscam004#26;
            |GRABA 020#dscam003.a;
         |FINSI;
         |ACABA;
      |FINSI;
   |FINSI;

   |SI #dscam004#5 = "REM"; |Y ModoEntrada = 3;
      |SI Flag < 0;
         |ABRE #dscam012;
         #dscam012#0 = #dscam003#17;
         |LEE 101#dscam012.=;
         |SI FSalida = 0;
            |SI #dscam012#22 ! 1; |Y #dscam012#22 ! 3;
               || Compruebo que si es una remesa al descuento, no haya recibos
               ||   descontados de riesgo. Si es asi , salgo
               nSwError = 0; |BUCLE Vencidos;
               |SI nSwError ! 0;
                  |MENAV "    Esta remesa ya tiene lineas vencidas. No se dara de baja el abono";
                  |LIBERA #dscam012; |ERROR; |ACABA;
               |FINSI;

               || Borro todos los movimientos de la remesa y rebajo el riesgo
               |SI #dscam012#22 = 3; |O #dscam012#22 = 4; |O #dscam012#22 = 7;
                  BorraPag = 0;
                  BajaPag = #dscam003#70; BajaEnt = #dscam003#72; BorraPag = 1;
                  eaUsuario = Usuario % 0810;
                  eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
                  |SI ModoEntrada = 3;
                     eaDescr   = "BAJA ABONO REMESA (" + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam003#37) % -103);
                     eaDescr   = eaDescr + ") CON PAGARE/TALON (" + #dscam003#72 + "/" + #dscam003#70 + ") DESDE LINEAS DE RECIBOS";
                     eaTipoOp  = "B"; enImpAnt = #dscam012#10;
                     eaFicher = "dscam012"; eaClave = #dscam012#0;
                     enImpAct  = #dscam012#10 - #dscam003#79; |HAZ GrabaAudit;
                  |FINSI;
               |SINO;
                  eaUsuario = Usuario % 0810;
                  eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
                  |SI ModoEntrada = 3;
                     eaDescr   = "BAJA ABONO REMESA (" + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam003#37) % -103);
                     eaDescr   = eaDescr + ") CON RECIBO (" + #dscam003#0 + "/" + #dscam003#1 + "/" + #dscam003#2 + ") DESDE LINEAS DE RECIBOS";
                     eaTipoOp  = "B";   enImpAnt = #dscam012#10;
                     eaFicher = "dscam012"; eaClave = #dscam012#0;
                     enImpAct  = #dscam012#10 - #dscam004#26; |HAZ GrabaAudit;
                  |FINSI;
               |FINSI;

               NumRemesa = #dscam003#17; NumLinea = #dscam003#37;
               nNumDoc = #dscam003#40;   nNumLin = #dscam004#3;
               nSwCobConf = 0;
               |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
               |LEE 000#dscam004.a;
               |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |Y #dscam004#5 = "EMR";
                  |LEE 000#dscam004.a;
                  |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |Y #dscam004#5 = "CFR";
                     nSwCobConf = 1;
                  |FINSI;
               |FINSI;

               enNumRemesa = NumRemesa; enNumDoc = nNumDoc; |HAZ MovRemesas;

               |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;

               || Actualiza la cabecera del recibo .....
               #dscam003#26 = "01.01.0000";
               |HAZ EsArtenvas;
               |SI FSalida ! 0;
                    #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
                    #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
                    #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
                    #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
                    #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;
                |SINO;
                    |SI #dscam012#22 ! 2; |Y #dscam012#22 ! 4;
                        #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
                        #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
                        #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
                        #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
                        #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;
                    |FINSI;
               |FINSI;

               #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
               #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
               #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
               #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
               #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;

               #dscam003#14 = "R";
               #dscam003#15 = "Remesado";
               |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
               |GRABA 020#dscam003.a;

               |SI #dscam051#3 = "S"; |Y nSwCobConf = 0;
                  |SI #dscam013#15 = "S";
                     eaTipoOper = "+4";
                  |SINO;
                     eaTipoOper = "-6+4";
                  |FINSI;
                  || enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
                  enBanco = #dscam012#2;
                  enEmpCartera = -1;     enEmpGestion = #dscam003#46;
                  eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
                  nImporte = #dscam013#7;
                  |HAZ BucleRiesgo;
               |FINSI;

               || ..... borro el movimiento del abono .....
               |BORRA 020#dscam004.a; |LIBERA #dscam004; |ERROR;

               || Deshago el posible asiento de abono
               |SI #dscam051#1 = "S";
                  |ABRE #dscam067;
                  #dscam067#8 = 0;
                  #dscam067#9 = 0;
                  #dscam067#0  = "RM";
                  #dscam067#1  = NumRemesa;
                  #dscam067#2  = NumLinea;
                  #dscam067#3  = "E";
                  #dscam067#11 = 1;
                  |LEE 000#dscam067.];
                  FEstado = FSalida;
                  Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
                  |PARA; |SI FEstado = 0; |Y Clave1 = NumRemesa; |HACIENDO;
                     |SI FEstado = 0; |Y Clave1 = NumRemesa; |Y Clave2 = NumLinea; |Y Clave3  = "E";
                        |SAL;
                     |FINSI;
                     |LEE 000#dscam067.s;
                     FEstado = FSalida;
                     Clave1 = #dscam067#1; Clave2 = #dscam067#2;
                     Clave3 = #dscam067#3; |QBF Clave3;
                  |SIGUE;

                  |SI FEstado = 0; |Y Clave1 = NumRemesa; |Y Clave2 = NumLinea;
                   |Y Clave3  = "E";
                     Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
                     |NOME_DAT #4 Comodin;
                     |DELINDEX #dscaw013; |ABRE #dscaw013;
                     aAlfa = #dscam067#10;

                     |DDEFECTO #dscaw013;
                     #dscaw013#15 = aAlfa;      #dscaw013#0 = 1;
                     #dscaw013#13 = "dscam013"; #dscaw013#14 = 15;
                     #dscaw013#11 = "A";
                     #dscaw013#3  = "N";   #dscaw013#4 = "N";
                     |GRABA 020#dscaw013.n;

                     |DDEFECTO #dscaw013;
                     #dscaw013#15 = aAlfa;      #dscaw013#0 = 2;
                     #dscaw013#13 = "dscam013"; #dscaw013#14 = 0;
                     #dscaw013#11 = "N";        #dscaw013#12 = 5;
                     #dscaw013#5  = NumRemesa;  #dscaw013#6 = NumRemesa;
                     |GRABA 020#dscaw013.n;

                     aAlfa = "dscam033.tab;" + aAlfa + ",B,E";
                     |LIBERA #dscam003; |CIERRAT #dscam003;
                     |LIBERA #dscam004; |CIERRAT #dscam004;
                     |LIBERA #dscam012; |CIERRAT #dscam012;
                     |SUB_EJECUTA_NP aAlfa;
                     |ABRET #dscam012; |LEE 101#dscam012.=;
                     |ABRET #dscam003; |LEE 101#dscam003.=;
                     |ABRET #dscam004; |LEE 101#dscam004.=;

                     |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
                     |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
                     |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
                  |FINSI;
                  |CIERRA #dscam067;
               |SINO;
                  |ABRE #dscam067;
                  #dscam067#8 = 0;
                  #dscam067#9 = 0;
                  #dscam067#0  = "RM";
                  #dscam067#1  = NumRemesa;
                  #dscam067#2  = NumLinea;
                  #dscam067#3  = "E";
                  #dscam067#11 = 1;
                  |LEE 000#dscam067.];
                  FEstado = FSalida;
                  Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
                  |SI FEstado = 0; |Y Clave1 = NumRemesa; |Y Clave2 = NumLinea; |Y Clave3  = "E";
                     |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
                  |FINSI;
                  |CIERRA #dscam067;
               |FINSI;
               #dscam012#8 = "N"; |GRABA 020#dscam012.a; |LIBERA #dscam012;
            |SINO;
               |ABRE #dscam013; |SELECT #2#dscam013;
               #dscam013#16 = #dscam004#17;
               #dscam013#17 = #dscam004#3;
               |LEE 101#dscam013.=;
               |SI FSalida = 0;
                  || Incluyo el riesgo en el banco
                  |SI #dscam051#3 = "S";
                     eaTipoOper = "+6";
                     || enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
                     enEmpCartera = -1;     enEmpGestion = #dscam003#46;
                     eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
                     nImporte = #dscam013#7;
                     |HAZ BucleRiesgo;
                  |FINSI;

                  || Pongo la linea de la remesa como no vencida
                  #dscam013#15 = "N"; |GRABA 020#dscam013.a;
                  #dscam003#84 = "N";

                  || Elimino la linea de la remesa del asiento .....
                  |SI #dscam051#1 = "S";
                     |ABRE #dscam067;
                     #dscam067#8 = 0;
                     #dscam067#9 = 0;
                     #dscam067#0  = "RM";
                     #dscam067#1  = #dscam003#17;
                     #dscam067#2  = #dscam003#37;
                     #dscam067#3  = "V";
                     #dscam067#11 = 1;
                     |LEE 000#dscam067.];
                     FEstado = FSalida;
                     Clave1 = #dscam067#1;
                     Clave2 = #dscam067#2;
                     Clave3 = #dscam067#3; |QBF Clave3;
                     |PARA; |SI FEstado = 0; |Y Clave1 = #dscam003#17; |HACIENDO;
                        |SI FEstado = 0; |Y Clave1 = #dscam003#17; |Y Clave2 = #dscam003#37; |Y Clave3  = "V";
                           |SAL;
                        |FINSI;
                        |LEE 000#dscam067.s;
                        FEstado = FSalida;
                        Clave1 = #dscam067#1; Clave2 = #dscam067#2;
                        Clave3 = #dscam067#3; |QBF Clave3;
                     |SIGUE;

                     |SI FEstado = 0; |Y Clave1 = #dscam003#17; |Y Clave2 = #dscam003#37; |Y Clave3  = "V";
                        Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
                        |NOME_DAT #4 Comodin;
                        |DELINDEX #dscaw013; |ABRE #dscaw013;
                        aAlfa = #dscam067#10;

                        nCuentaLRem = 0; nCuentaLAsi = 0; nRemesa = #dscam013#0;
                        nEmp = #dscam067#8; nPer = #dscam067#9;
                        nDia = #dscam067#4; fFec = #dscam067#5;
                        nDoc = #dscam067#6;
                        |SALVA_FICHA #dscam013; |SALVA_FICHA #dscam067;
                        |BUCLE CuentaLRems; |BUCLE CuentaLAsie;
                        |REPON_FICHA #dscam067; |REPON_FICHA #dscam013;

                        Modo1 = ",B";
                        |DDEFECTO #dscaw013;
                        #dscaw013#15 = aAlfa;       #dscaw013#0 = 1;
                        #dscaw013#13 = "dscam013";  #dscaw013#14 = 0;
                        #dscaw013#11 = "N";         #dscaw013#12 = 5;
                        #dscaw013#5  = #dscam013#0; #dscaw013#6  = #dscam013#0;
                        |GRABA 020#dscaw013.n;

                        |SI nCuentaLRem > 0;
                           |SI nCuentaLAsi > 1; Modo1 = ""; |FINSI;

                           |DDEFECTO #dscaw013;
                           #dscaw013#15 = aAlfa;      #dscaw013#0 = 2;
                           #dscaw013#13 = "dscam013"; #dscaw013#14 = 15;
                           #dscaw013#11 = "A";        #dscaw013#12 = 1;
                           #dscaw013#3  = "S";        #dscaw013#4  = "S";
                           |GRABA 020#dscaw013.n;
                        |SINO;
                           #dscam012#8 = "N"; #dscam012#9 = "N";
                        |FINSI;

                        aAlfa = "dscam033.tab;" + aAlfa + Modo1 + ",V" + #dscam067#5;
                        |LIBERA #dscam012; |CIERRAT #dscam012;
                        |LIBERA #dscam003; |CIERRAT #dscam003;
                        |LIBERA #dscam004; |CIERRAT #dscam004;
                        |SUB_EJECUTA_NP aAlfa;
                        |ABRET #dscam003; |LEE 101#dscam003.=;
                        |ABRET #dscam004; |LEE 101#dscam004.=;
                        |ABRET #dscam012; |LEE 101#dscam012.=;

                        |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
                        |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
                        |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
                     |FINSI;
                  |FINSI;
                  || Actualiza la cabecera del recibo .....
                  #dscam003#26 = "01.01.0000";
                  #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
                  #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
                  #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
                  #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
                  #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;

                  #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
                  #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
                  #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
                  #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
                  #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;

                  #dscam003#14 = "R";
                  #dscam003#15 = "Remesado";
                  |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
                  |GRABA 020#dscam003.a;

                  || Compruebo que hay mas lineas vencidas. Si no es asi,
                  ||     pongo la remesa como no contabilizada y como no
                  ||     abonada.
                  nSwError = 0; |BUCLE Vencidos;
                  |SI nSwError = 0;
                     #dscam012#8 = "N"; #dscam012#9 = "N";
                     |GRABA 020#dscam012.a; |LIBERA #dscam012;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
         |LIBERA #dscam012;
      |FINSI;
      |ACABA;
   |FINSI;

   |SI #dscam004#5 = "CAC"; |Y ModoEntrada = 3;
      NumRec  = #dscam004#40; NumLin   = #dscam004#41;
      LiquDiv = #dscam004#7;  LiquBase = #dscam004#25;
      CobrDiv = #dscam004#8;  CobrBase = #dscam004#26;
      DespDiv = #dscam004#23; DespBase = #dscam004#32;
      DifCamb = #dscam004#24;
      EnlDiario = #dscam004#34; EnlFecha = #dscam004#35;
      EnlDocum  = #dscam004#36; EnlAstos = #dscam004#37;
      EnlEmpre  = #dscam004#38; EnlPerio = #dscam004#39;
      CtaCobro  = #dscam004#4;  FechaOper = #dscam004#6;

      Document = #dscam004#17; NumLDoc = #dscam004#3;

      #dscam004#17 = NumRec;
      #dscam004#3 = NumLin;
      |LEE 101#dscam004.=;
      |SI FSalida = 0;
         #dscam003#40 = NumRec;
         |LEE 101#dscam003.=;
         |SI FSalida = 0;
            |SI Flag < 0;
               eaUsuario = Usuario % 0810;
               eaTipoReg = "CB";  eaNumero = ("000000000" + #dscam003#40) % -109;
               |SI ModoEntrada = 3;
                  eaDescr   = "BAJA COMPENSACION ENTREGA A CUENTA (";
                  eaDescr   = eaDescr + #dscam003#40 + ") DESDE LINEAS DE RECIBOS";
                  eaTipoOp  = "B";   enImpAnt = #dscam003#61;
                  eaFicher = "dscam003"; eaClave = #dscam003#40;
                  enImpAct  = #dscam003#23 - #dscam004#8; |HAZ GrabaAudit;
                  Modo1 = ",B";
               |FINSI;
               |SI ModoEntrada = 2;
                  eaDescr   = "MODIFICACION COMPENSACION ENTREGA A CUENTA (";
                  eaDescr   = eaDescr + #dscam003#40 + ") DESDE LINEAS DE RECIBOS";
                  eaTipoOp  = "M";   enImpAnt = #dscam003#23;
                  Modo1 = "";
               |FINSI;
               #dscam003#56 = #dscam003#56 - #dscam004#24;
               #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
               #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;

               #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
               #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
               #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
               #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
               #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;
               #dscam003#26 = #dscam004#6;
               |SI #dscam003#23 = 0;
                  #dscam003#14 = "L";
                  #dscam003#15 = "Recibo compensado";
               |SINO;
                  |SI #dscam003#23 = #dscam003#22;
                     #dscam003#14 = "e";
                     #dscam003#15 = "Pendiente de compensar";
                  |SINO;
                     #dscam003#14 = "E";
                     #dscam003#15 = "Compensado parcialmente";
                  |FINSI;
               |FINSI;
               |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
               |GRABA 020#dscam003.a;

               |SI #dscam051#1 = "S";
                  |ABRE #dscam067;
                  #dscam067#8 = 0;
                  #dscam067#9 = 0;
                  #dscam067#0 = "CB";
                  #dscam067#1 = #dscam004#17;
                  #dscam067#2 = #dscam004#3;
                  #dscam067#3 = "";
                  #dscam067#11 = 1;
                  |LEE 000#dscam067.];
                  FEstado = FSalida;
                  Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
                  |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
                     |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
                        |SAL;
                     |FINSI;
                     |LEE 000#dscam067.s;
                     FEstado = FSalida;
                     Clave1 = #dscam067#1; Clave2 = #dscam067#2;
                     Clave3 = #dscam067#3; |QBF Clave3;
                  |SIGUE;

                  |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
                   |Y Clave3  = "";
                     Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
                     |NOME_DAT #4 Comodin;
                     |DELINDEX #dscaw013; |ABRE #dscaw013;
                     |DDEFECTO #dscaw013;
                     #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
                     #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
                     #dscaw013#11 = "N";          #dscaw013#12 = 9;
                     #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
                     |GRABA 020#dscaw013.n;

                     |DDEFECTO #dscaw013;
                     #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
                     #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
                     #dscaw013#11 = "N";          #dscaw013#12 = 3;
                     #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
                     |GRABA 020#dscaw013.n;

                     |DDEFECTO #dscaw013;
                     #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
                     #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
                     #dscaw013#11 = "F";          #dscaw013#12 = 10;
                     #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
                     |GRABA 020#dscaw013.n;

                     |LIBERA #dscaw013; |CIERRA #dscaw013;
                     Comodin = #dscam067#10;
                     Comodin = "dscam033.tab;" + Comodin + ",B";
                     |LIBERA #dscam003; |CIERRAT #dscam003;
                     |LIBERA #dscam004; |CIERRAT #dscam004;
                     |SUB_EJECUTA_NP Comodin;
                     |ABRET #dscam003; |LEE 101#dscam003.=;
                     |ABRET #dscam004; |LEE 101#dscam004.=;

                     |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
                     |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
                     |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
                  |FINSI;
                  |CIERRA #dscam067;
               |SINO;
                  |ABRE #dscam067;
                  #dscam067#8 = 0;
                  #dscam067#9 = 0;
                  #dscam067#0 = "CB";
                  #dscam067#1 = #dscam004#17;
                  #dscam067#2 = #dscam004#3;
                  #dscam067#3 = "";
                  #dscam067#11 = 1;
                  |LEE 000#dscam067.];
                  FEstado = FSalida;
                  Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
                  |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
                     |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
                  |FINSI;
                  |CIERRA #dscam067;
               |FINSI;
               |BORRA 020#dscam004.a; |LIBERA #dscam004;
            |SINO;
               |DDEFECTO #dscam004;
               #dscam004#17 = NumRec;
               #dscam004#3 = NumLin;
               |GRABA 020#dscam004.b;
               #dscam004#0 = #dscam003#0;
               #dscam004#1 = #dscam003#1;
               #dscam004#2 = #dscam003#2;
               #dscam004#4 = CtaCobro;
               #dscam004#5 = "REC";
               #dscam004#6 = FechaOper;
               #dscam004#7 = LiquDiv;  #dscam004#25 = LiquBase;
               #dscam004#8 = CobrDiv;  #dscam004#26 = CobrBase;
               #dscam004#22 = "E";
               #dscam004#23 = DespDiv; #dscam004#32 = DespBase;
               #dscam004#24 = DifCamb;
               #dscam004#34 = EnlDiario; #dscam004#35 = EnlFecha;
               #dscam004#36 = EnlDocum;  #dscam004#37 = EnlAstos;
               #dscam004#38 = EnlEmpre;  #dscam004#39 = EnlPerio;
               |GRABA 020#dscam004.a; |LIBERA #dscam004;

               #dscam003#56 = #dscam003#56 - #dscam004#24;
               #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
               #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;

               #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
               #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
               #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
               #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
               #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;
               #dscam003#26 = #dscam004#6;
               |SI #dscam003#23 = 0;
                  #dscam003#14 = "L";
                  #dscam003#15 = "Recibo Compensado";
               |SINO;
                  |SI #dscam003#23 = #dscam003#22;
                     #dscam003#14 = "e";
                     #dscam003#15 = "Pendiente de compensar";
                  |SINO;
                     #dscam003#14 = "E";
                     #dscam003#15 = "Compensado parcialmente";
                  |FINSI;
               |FINSI;

               |GRABA 020#dscam003.a;
               eaFicher = "dscam003"; eaClave = #dscam003#40;
               enImpAct  = #dscam003#23; |HAZ GrabaAudit;

               |ABRE #dscam067;
               #dscam067#8 = 0;
               #dscam067#9 = 0;
               #dscam067#0 = "CB";
               #dscam067#1 = #dscam004#17;
               #dscam067#2 = #dscam004#3;
               #dscam067#3 = "";
               #dscam067#11 = 1;
               |LEE 000#dscam067.];
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
               |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
                  |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
                    |SAL;
                  |FINSI;
                  |LEE 000#dscam067.s;
                  FEstado = FSalida;
                  Clave1 = #dscam067#1; Clave2 = #dscam067#2;
                  Clave3 = #dscam067#3; |QBF Clave3;
               |SIGUE;

               |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
                |Y Clave3  = "";
                  Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
                  |NOME_DAT #4 Comodin;
                  |DELINDEX #dscaw013; |ABRE #dscaw013;
                  |DDEFECTO #dscaw013;
                  #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
                  #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
                  #dscaw013#11 = "N";          #dscaw013#12 = 9;
                  #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
                  |GRABA 020#dscaw013.n;

                  |DDEFECTO #dscaw013;
                  #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
                  #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
                  #dscaw013#11 = "N";          #dscaw013#12 = 3;
                  #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
                  |GRABA 020#dscaw013.n;

                  |DDEFECTO #dscaw013;
                  #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
                  #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
                  #dscaw013#11 = "F";          #dscaw013#12 = 10;
                  #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
                  |GRABA 020#dscaw013.n;

                  |LIBERA #dscaw013; |CIERRA #dscaw013;
                  Comodin = #dscam067#10;
                  Comodin = "dscam033.tab;" + Comodin;
                  |LIBERA #dscam004; |CIERRAT #dscam004;
                  |LIBERA #dscam003; |CIERRAT #dscam003;
                  |SUB_EJECUTA_NP Comodin;
                  |ABRET #dscam003; |LEE 101#dscam003.=;
                  |ABRET #dscam004; |LEE 101#dscam004.=;

                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
               |FINSI;
               |CIERRA #dscam067;
            |FINSI;
            |LIBERA #dscam003;
         |FINSI;
         |LIBERA #dscam004;
      |FINSI;

      |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
         eaTipoOper = "+5";
      |FINSI;

      #dscam003#40 = Document; |LEE 101#dscam003.=;
      #dscam004#17 = Document; #dscam004#3 = NumLDoc; |LEE 101#dscam004.=;
      |SI #dscam051#3 = "S"; |Y ModoEntrada = 3;
         || enEmpCartera = #48#0;  enEmpGestion = #dscam003#46;
         enEmpCartera = -1;      enEmpGestion = #dscam003#46;
         eaSerie  = #dscam003#0; eaCliGest = #dscam003#32;
         nImporte = #dscam004#8; eaTipoOper = eaTipoOper + "+4";
         |HAZ BucleRiesgo;
      |FINSI;
      |SI #dscam051#1 = "S";
         |ABRE #dscam067;
         #dscam067#8 = 0;
         #dscam067#9 = 0;
         #dscam067#0 = "CB";
         #dscam067#1 = #dscam004#17;
         #dscam067#2 = #dscam004#3;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
         |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
            |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
               |SAL;
            |FINSI;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
         |SIGUE;

         |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
          |Y Clave3  = "";

            nEmpres  = #dscam067#8; nPeriod  = #dscam067#9;
            nDiario  = #dscam067#4; fFecAsto = #dscam067#5;
            nDocumto = #dscam067#6; nMovsEnt = 0;
            aCodEnlace = #dscam067#10;

            |BUCLE MiraAsto;

            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #4 Comodin;

            |SI nMovsEnt [ 1;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = aCodEnlace; #dscaw013#0 = 1;
               #dscaw013#13 = "dscam004";  #dscaw013#14 = 17;
               #dscaw013#11 = "N";         #dscaw013#12 = 9;
               #dscaw013#5 = #dscam004#17; #dscaw013#6 = #dscam004#17;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = aCodEnlace; #dscaw013#0 = 2;
               #dscaw013#13 = "dscam004"; #dscaw013#14 = 3;
               #dscaw013#11 = "N";        #dscaw013#12 = 3;
               #dscaw013#5 = #dscam004#3; #dscaw013#6 = #dscam004#3;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = aCodEnlace; #dscaw013#0 = 3;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
               #dscaw013#11 = "F";          #dscaw013#12 = 10;
               #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
               |GRABA 020#dscaw013.n;

               |LIBERA #dscaw013;
               |CIERRA #dscaw013;
               Comodin = aCodEnlace;
               Comodin = "dscam033.tab;" + Comodin + ",B";
            |SINO;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = aCodEnlace;   #dscaw013#0 = 1;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 40;
               #dscaw013#11 = "N";          #dscaw013#12 = 9;
               #dscaw013#5 = #dscam004#40;  #dscaw013#6 = #dscam004#40;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = aCodEnlace;   #dscaw013#0 = 2;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
               #dscaw013#11 = "A";          #dscaw013#12 = 3;
               #dscaw013#3 = "CAC";         #dscaw013#4 = "CAC";
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = aCodEnlace;   #dscaw013#0 = 3;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
               #dscaw013#11 = "F";          #dscaw013#12 = 10;
               #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
               |GRABA 020#dscaw013.n;

               |LIBERA #dscaw013; |CIERRA #dscaw013;
               Comodin = aCodEnlace;
               Comodin = "dscam033.tab;" + Comodin + ",M";
               #dscam067#8 = nEmpres;
               #dscam067#9 = nPeriod;
               #dscam067#0 = "CB";
               #dscam067#1 = #dscam004#17;
               #dscam067#2 = #dscam004#3;
               #dscam067#3 = "";
               #dscam067#11 = 1;
               |LEE 000#dscam067.];
               |SI #dscam067#8 = nEmpres; |Y #dscam067#9 = nPeriod; |Y #dscam067#0 = "CB";
               |Y #dscam067#1 = #dscam004#17; |Y #dscam067#2 = #dscam004#3;
                  |BORRA 020#dscam067.a;
               |FINSI;
               |SALVA_DATOS #dscam004; |BORRA 020#dscam004.a;
            |FINSI;

            |LIBERA #dscam003; |CIERRAT #dscam003;
            |LIBERA #dscam004; |CIERRAT #dscam004;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam003; |LEE 101#dscam003.=;
            |ABRET #dscam004;
            |SI nMovsEnt [ 1;
               |LEE 101#dscam004.=;
            |SINO;
               |REPON_DATOS #dscam004; |GRABA 020#dscam004.c;
            |FINSI;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
         |CIERRA #dscam067;
      |SINO;
         |ABRE #dscam067;
         #dscam067#8 = 0;
         #dscam067#9 = 0;
         #dscam067#0 = "CB";
         #dscam067#1 = #dscam004#17;
         #dscam067#2 = #dscam004#3;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
         |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
            |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
         |FINSI;
         |CIERRA #dscam067;
      |FINSI;

      #dscam003#56 = #dscam003#56 +. #dscam004#24;
      #dscam003#23 = #dscam003#23 +. #dscam004#8; #dscam003#61 = #dscam003#61 +. #dscam004#26;
      |SI #dscam004#22 = "D";
          #dscam003#54 = #dscam003#54 +. #dscam004#23; #dscam003#67 = #dscam003#67 +. #dscam004#32;
      |SINO;
         #dscam003#55 = #dscam003#55 +. #dscam004#23; #dscam003#68 = #dscam003#68 +. #dscam004#32;
      |FINSI;
      #dscam003#24 = #dscam003#24 +. #dscam004#12; #dscam003#62 = #dscam003#62 +. #dscam004#29;
      #dscam003#25 = #dscam003#25 +. #dscam004#13; #dscam003#63 = #dscam003#63 +. #dscam004#30;
      #dscam003#38 = #dscam003#38 +. #dscam004#14; #dscam003#66 = #dscam003#66 +. #dscam004#31;
      |SI ModoEntrada = 3;
         aAlfa = #dscam003#36; |QBF aAlfa;
         |SI #dscam003#1 = 0; |Y aAlfa ! ""; |Y #dscam003#35 = "   ";
            #dscam003#36 = "";
         |FINSI;

         |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
         |SALVA_FICHA #dscam004;
         |LEE 000#dscam004.a;
         |SI FSalida = 0;
            |SI #dscam004#17 = #dscam003#40;
               #dscam003#26 = #dscam004#6;
            |SINO;
               #dscam003#26 = "01.01.0000";
            |FINSI;
            |LEE 000#dscam004.s;
         |SINO;
            #dscam003#26 = "01.01.0000";
         |FINSI;
         |REPON_FICHA #dscam004;
      |SINO;
         #dscam003#26 = #dscam004#6;
      |FINSI;
   |FINSI;

   |SI #dscam004#5 = "RPT";
      |SI ModoEntrada = 3;
         Entidad = #dscam003#72; NumDocum = #dscam003#70;
         |SI Entidad = "    "; |Y NumDocum = "          ";
            eaUsuario = Usuario % 0810;
            eaTipoReg = "CB";  eaNumero = ("000000000" + #dscam003#40) % -109;
            eaDescr   = "INCONGRUENCIA. LINEA 'RPT' EN RECIBO NO ASIGNADO A TALON (" + #dscam003#40 + ")";
            eaTipoOp  = "B";   enImpAnt = 0; enImpAct  = 0;
            eaFicher = "dscam003"; eaClave = #dscam003#40;
            |HAZ GrabaAudit;
         |SINO;
            nSwError = 0; nNumDocum = #dscam003#40;
            |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
            nSw = 1; |BUCLE BajaTalPag;
            |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;
            |SI nSwError = 1; |Y #dscam003#14 = "R";
               |MENAV "    Talon remesado. No se dara de baja.";
               |ERROR; |ACABA;
            |SINO;
               nSwError = 0;
            |FINSI;

            |DDEF aAlfa; |QBF aAlfa;
            aAlfa = aAlfa + "dscam003.mas";
            |CARGA_DEF aAlfa, Replica@;
            |SI FSalida = 0;
               |DFICE aAlfa; |QBF aAlfa; |PATH_DAT #Replica@#aAlfa#;
               |ABRE #Replica@;
               |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
               nSw = 2; |BUCLE BajaTalPag;
               |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;
               |CIERRA #Replica@; |DESCARGA_DEF #Replica@;
            |FINSI;

            |SI nSwError = 0;
               #dscam003#72 = ""; #dscam003#70 = "";
               #dscam003#71 = ""; #dscam003#73 = ""; #dscam003#74 = "";
               #dscam003#78 = 0;  #dscam003#79 = 0;  #dscam003#90 = "N";
               #dscam003#24 = #dscam003#24 - #dscam004#12;
               #dscam003#62 = #dscam003#62 - #dscam004#29;
               #dscam003#25 = #dscam003#25 - #dscam004#13;
               #dscam003#63 = #dscam003#63 - #dscam004#30;
               #dscam003#38 = #dscam003#38 - #dscam004#14;
               #dscam003#66 = #dscam003#66 - #dscam004#31;
               |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
               |GRABA 020#dscam003.a;

               |ABRE #dscam067;
               #dscam067#8 = 0;
               #dscam067#9 = 0;
               #dscam067#0 = "CB";
               #dscam067#1 = #dscam004#17;
               #dscam067#2 = #dscam004#3;
               #dscam067#3 = "";
               #dscam067#11 = 1;
               |LEE 000#dscam067.];
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
               |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
                  |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
                     |SAL;
                  |FINSI;
                  |LEE 000#dscam067.s;
                  FEstado = FSalida;
                  Clave1 = #dscam067#1; Clave2 = #dscam067#2;
                  Clave3 = #dscam067#3; |QBF Clave3;
               |SIGUE;

               |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
                |Y Clave3  = "";
                  Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
                  |NOME_DAT #4 Comodin;
                  |DELINDEX #dscaw013; |ABRE #dscaw013;
                  |DDEFECTO #dscaw013;
                  #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
                  #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
                  #dscaw013#11 = "N";          #dscaw013#12 = 9;
                  #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
                  |GRABA 020#dscaw013.n;
                  |DDEFECTO #dscaw013;
                  #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
                  #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
                  #dscaw013#11 = "N";          #dscaw013#12 = 3;
                  #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
                  |GRABA 020#dscaw013.n;
                  |DDEFECTO #dscaw013;
                  #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
                  #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
                  #dscaw013#11 = "F";          #dscaw013#12 = 10;
                  #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
                  |GRABA 020#dscaw013.n;

                  |LIBERA #dscaw013; |CIERRA #dscaw013;
                  Comodin = #dscam067#10;
                  Comodin = "dscam033.tab;" + Comodin + ",B";
                  |LIBERA #dscam003; |CIERRAT #dscam003;
                  |LIBERA #dscam004; |CIERRAT #dscam004;
                  |SUB_EJECUTA_NP Comodin;
                  |ABRET #dscam003; |LEE 101#dscam003.=;
                  |ABRET #dscam004; |LEE 101#dscam004.=;

                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
               |FINSI;
               |CIERRA #dscam067;
            |FINSI;
         |FINSI;
      |FINSI;
      |SI ModoEntrada = 2;
         |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
         nSw = 1; |BUCLE BajaTalPag;
         |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;
         |SI nSwError = 1; |Y #dscam003#14 = "R";
            |SI Flag < 0;
               |MENAV "    Talon remesado. No se dara de baja.";
            |FINSI;
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;
   |FINSI;

   |SI #dscam004#5 = "CFR"; |Y ModoEntrada = 3;
      |SI #dscam003#17 ! 0; |Y #dscam003#14 = "R";
         |MENAV "    El documento esta remesado. Borrelo de la remesa y vuelva a intentarlo"; |ERROR; |ACABA;
      |FINSI;
      Entidad = #dscam003#72; NumDocum = #dscam003#70;
      |SI Entidad = "    "; |Y NumDocum = "          ";
         eaUsuario = Usuario % 0810;
         eaTipoReg = "CB";  eaNumero = ("000000000" + #dscam003#40) % -109;
         eaDescr   = "INCONGRUENCIA. LINEA 'RPT' EN RECIBO NO ASIGNADO A TALON (" + #dscam003#40 + ")";
         eaTipoOp  = "B";   enImpAnt = 0; enImpAct  = 0;
         eaFicher = "dscam003"; eaClave = #dscam003#40;
         |HAZ GrabaAudit;
      |SINO;
         #dscam003#72 = ""; #dscam003#70 = ""; #dscam003#97 = "N";
         #dscam003#71 = ""; #dscam003#73 = ""; #dscam003#74 = "";
         #dscam003#78 = 0;  #dscam003#79 = 0;  #dscam003#90 = "N";
         #dscam003#24 = #dscam003#24 - #dscam004#12;
         #dscam003#62 = #dscam003#62 - #dscam004#29;
         #dscam003#25 = #dscam003#25 - #dscam004#13;
         #dscam003#63 = #dscam003#63 - #dscam004#30;
         #dscam003#38 = #dscam003#38 - #dscam004#14;
         #dscam003#66 = #dscam003#66 - #dscam004#31;
         |SI #dscam003#103 ! 0;
            #dscam003#51 = #dscam003#103;
            #dscam003#52 = #dscam003#104;
            #dscam003#103 = "";
            #dscam003#104 = "";
         |FINSI;
         |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
         |GRABA 020#dscam003.a;

         |SI #dscam051#3 = "S"; |Y #dscam051#130 = "S";
            enEmpCartera = -1;       enEmpGestion = #dscam003#46;
            eaSerie  = #dscam003#0;  eaCliGest = #dscam003#32;
            nImporte = #dscam003#30; eaTipoOper = eaTipoOper + "+4";
            |HAZ BucleRiesgo;
         |FINSI;

         |ABRE #dscam067;
         #dscam067#8 = 0;
         #dscam067#9 = 0;
         #dscam067#0 = "CB";
         #dscam067#1 = #dscam004#17;
         #dscam067#2 = #dscam004#3;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
            |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
               |SAL;
            |FINSI;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
         |SIGUE;

         |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
          |Y Clave3  = "";
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #4 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
            #dscaw013#11 = "N";          #dscaw013#12 = 3;
            #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
            #dscaw013#11 = "F";          #dscaw013#12 = 10;
            #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
            |GRABA 020#dscaw013.n;

            |LIBERA #dscaw013; |CIERRA #dscaw013;
            Comodin = #dscam067#10;
            Comodin = "dscam033.tab;" + Comodin + ",B";
            |LIBERA #dscam003; |CIERRAT #dscam003;
            |LIBERA #dscam004; |CIERRAT #dscam004;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam003; |LEE 101#dscam003.=;
            |ABRET #dscam004; |LEE 101#dscam004.=;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
         |CIERRA #dscam067;
      |FINSI;
   |FINSI;

   |SI #dscam004#5 = "RTA"; |Y ModoEntrada = 3;
      || Primero elimino los movimientos ....
      Entidad = #dscam003#72; NumDocum = #dscam003#70;
      nSwError = 0; nNumDocum = #dscam003#40;
      nNumSec  = #dscam004#43;
      |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
      |BUCLE BajaVtoPag;
      |REPON_FICHA #dscam004;

      |SALVA_FICHA #dscam004;
      fFechaAnt = "01.01.0000"; nCalc = #dscam004#17;
      |LEE 000#dscam004.a;
      |SI FSalida = 0; |Y #dscam004#17 = nCalc;
         |SI #dscam004#5 ! "RPT"; |Y #dscam004#5 ! "PRE"; fFechaAnt = #dscam004#6; |FINSI;
      |FINSI;
      |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;

      |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
      #dscam003#26 = fFechaAnt;
      #dscam003#23 = #dscam003#23 - #dscam004#8; #dscam003#61 = #dscam003#61 - #dscam004#26;
      #dscam003#56 = #dscam003#56 - #dscam004#24;
      #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
      |GRABA 020#dscam003.a;

      || ... sumo el riesgo a facturas, a no ser que sea una entrega en talon
      |SI aOperAnt ! "RAC"; |O nImpOpAnt ! 0;
         eaTipoOper = "+4";
         enEmpCartera = -1;      enEmpGestion = #dscam003#46;
         eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
         nImporte = #dscam004#8; |HAZ BucleRiesgo;
      |FINSI;

      || .... luego cuento el n§ de movimientos que quedan con esa sesion ....
      |SALVA_FICHA #dscam004;
      nContSesion = 0; |BUCLE ContMovSesion;
      |REPON_FICHA #dscam004;
      || .... si no queda ninguno, elimino el asiento y el historico de enlaces ....
      |ABRE #dscam067;
      #dscam067#8 = 0;
      #dscam067#9 = 0;
      #dscam067#0 = "CB";
      #dscam067#1 = #dscam004#17;
      #dscam067#2 = #dscam004#3;
      #dscam067#3 = "";
      #dscam067#11 = 1;
      |LEE 000#dscam067.];
      FEstado = FSalida;
      Clave1 = #dscam067#1; Clave2 = #dscam067#2;
      Clave3 = #dscam067#3; |QBF Clave3;
      |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
         |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
            |SAL;
         |FINSI;
         |LEE 000#dscam067.s;
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
      |SIGUE;

      |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
       |Y Clave3  = "";
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #4 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         |SI #dscam004#43 ! 0;
            nSesion = #dscam004#43;
            |SALVA_FICHA #dscam004; |SALVA_FICHA #dscam067;
            nDocum = #dscam067#6; |BUCLE Documentos;
            |REPON_FICHA #dscam067; |REPON_FICHA #dscam004;

            |SI nDocum ] 0;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
               #dscaw013#11 = "N";          #dscaw013#12 = 10;
               #dscaw013#5 = #dscam004#43;  #dscaw013#6 = #dscam004#43;
               |GRABA 020#dscaw013.n;
            |SINO;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
               #dscaw013#11 = "N";          #dscaw013#12 = 9;
               #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
               #dscaw013#11 = "N";          #dscaw013#12 = 3;
               #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
               #dscaw013#11 = "F";          #dscaw013#12 = 10;
               #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
               |GRABA 020#dscaw013.n;
            |FINSI;
         |SINO;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
            #dscaw013#11 = "N";          #dscaw013#12 = 3;
            #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
            #dscaw013#11 = "F";          #dscaw013#12 = 10;
            #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
            |GRABA 020#dscaw013.n;
            nContSesion = 0;
         |FINSI;
         |LIBERA #dscaw013; |CIERRA #dscaw013;
         Comodin = #dscam067#10;
         Comodin = "dscam033.tab;" + Comodin;
         |SI nContSesion = 0;
            Comodin = Comodin + ",B";
         |FINSI;
         |LIBERA #dscam003; |CIERRAT #dscam003;
         |LIBERA #dscam004; |CIERRAT #dscam004;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam003; |LEE 101#dscam003.=;
         |ABRET #dscam004; |LEE 101#dscam004.=;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
      |FINSI;
      |CIERRA #dscam067;
   |FINSI;

   |SI #dscam004#5 = "RAC";
      |MENAV "    No se puede borrar/modificar la recepcion de una entrega a cuenta.";
      |ERROR; |ACABA;
   |FINSI;

   |SI #dscam004#5 = "COB"; |O #dscam004#5 = "COP"; |O #dscam004#5 = "RCB";
    |O #dscam004#5 = "RAC"; |O #dscam004#5 = "REC"; |O #dscam004#5 = "CSI";
      |SI #dscam004#5 = "CSI";
         |SI ModoEntrada = 3; |HAZ BorraCambioSit; |FINSI;
         |SI ModoEntrada = 2;
            |MENAV "    No se puede modificar un cambio de situacion.";
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;

      aTipoOp = #dscam004#5; nNumSec = #dscam004#43;
      |SI aTipoOp = "REC";
         Comodin = #dscam004#16; |QBF Comodin; Comodin = Comodin % -109;
         nRecEntrega = Comodin;
      |FINSI;
      eaUsuario = Usuario % 0810;
      eaTipoReg = "CB";  eaNumero = ("000000000" + #dscam003#40) % -109;
      |SI ModoEntrada = 3;
         |SI #dscam004#5 = "COB"; |O #dscam004#5 = "COP";
            |HAZ EsLuxe;
            |SI FSalida = 0; |Y #dscam004#55 = "S";
               nSwErr1 = 0;
               |HAZ CajaEfectivo;
               |SI nSwErr1 ! 0; |ERROR; |ACABA; |FINSI;
            |FINSI;
         |FINSI;

         |SI #dscam004#5 = "REC";
            || Compruebo primero que el ultimo movimiento del recibo compensado
            ||    sea el CAC correspondiente. Si no es as¡ , doy un aviso y
            ||    salgo
            aAlfa = #dscam004#16; |QBF aAlfa; aAlfa = aAlfa % -110; nCalc6 = aAlfa;
            |SALVA_FICHA #dscam004;
            #dscam004#17 = nCalc6;
            #dscam004#3  = 99;
            |LEE 000#dscam004.];
            |SI FSalida = 0;
               |LEE 000#dscam004.a;
            |SINO;
               |LEE 000#dscam004.u;
            |FINSI;
            |SI FSalida = 0;
               |SI #dscam004#17 = nCalc6;
                  |SI #dscam004#5 ! "CAC";
                     aAlfa = "    Hay movimientos posteriores a la compensacion del recibo " + nCalc6 + ". Proceso cancelado.";
                     |MENAV aAlfa;
                     |REPON_FICHA #dscam004; |ERROR; |ACABA;
                  |FINSI;
               |SINO;
                  aAlfa = "    ATENCION !!! Falta el movimiento de CAC en el recibo " + nCalc6;
                  |MENAV aAlfa;
                  |REPON_FICHA #dscam004; |ERROR; |ACABA;
               |FINSI;
            |SINO;
               aAlfa = "    ATENCION !!! Falta el movimiento de CAC en el recibo " + nCalc6;
               |MENAV aAlfa;
               |REPON_FICHA #dscam004; |ERROR; |ACABA;
            |FINSI;
            |REPON_FICHA #dscam004;
            eaDescr   = "BAJA COMP.ENTREGA";
         |SINO;
            |SI #dscam004#5 = "CSI";
               eaDescr   = "BAJA CAMBIO SITUACION RECIBO";
            |SINO;
               eaDescr   = "BAJA COBRO RECIBO";
            |FINSI;
         |FINSI;
         eaDescr   = eaDescr + " (" + #dscam003#0 + "/";
         eaDescr   = eaDescr + #dscam003#1 + "/" + #dscam003#2 + ") DESDE LINEAS DE RECIBOS";
         eaTipoOp  = "B";   enImpAnt = #dscam003#61;
         eaFicher = "dscam003"; eaClave = #dscam003#40;
         enImpAct  = #dscam003#23 - #dscam004#8; |HAZ GrabaAudit;
      |FINSI;
      |SI ModoEntrada = 2;
         |SI #dscam004#5 = "COB"; |O #dscam004#5 = "COP";
            |HAZ EsLuxe;
            |SI FSalida = 0; |Y #dscam004#55 = "S";
               |SI Flag < 0;
                  |MENAV "    Apunte reflejado en el diario contable de caja. Dar de baja y volver a introducir.";
               |FINSI;
               |ERROR; |ACABA;
            |FINSI;
         |FINSI;
         |SI #dscam004#5 = "REC";
            eaDescr   = "MODIFICACION COMP.ENTREGA";
         |SINO;
            eaDescr   = "MODIFICACION COBRO RECIBO";
         |FINSI;
         eaDescr   = eaDescr + " (" + #dscam003#0 + "/";
         eaDescr   = eaDescr + #dscam003#1 + "/" + #dscam003#2 + ") DESDE LINEAS DE RECIBOS";
         eaTipoOp  = "M";   enImpAnt = #dscam003#23;
      |FINSI;
      |HAZ EsAgrogenil;
      |SI FSalida = 0;
         enDocum = #dscam004#17; enLinea = #dscam004#3;
         enTipoEntrada = 3;
         |SUB_EJECUTA_NP "dscagm01.tab";
      |FINSI;

      #dscam004#21 = "*"; |GRABA 020#dscam004.a;
      |SI #dscam051#3 = "S";
         |SI aTipoOp ! "REC"; |Y aOperAnt ! "CFR";
            |SI aOperAnt = "IMP"; |O aOperAnt = "IMA";
               eaTipoOper = "7";
            |SINO;
               eaTipoOper = "4";
            |FINSI;
            |SI ModoEntrada = 1; eaTipoOper = "-" + eaTipoOper; |FINSI;
            |SI ModoEntrada = 3; eaTipoOper = "+" + eaTipoOper; |FINSI;
            |SI ModoEntrada = 2;
               |SI Flag < 0;
                  eaTipoOper = "-" + eaTipoOper;
               |SINO;
                  eaTipoOper = "+" + eaTipoOper;
               |FINSI;
            |FINSI;
            |SI #dscam004#5 = "CSI"; |Y #dscam003#14 = "P"; |Y #dscam004#9 ! 0;
               |SI ModoEntrada = 1; eaTipoOper = "+7-4"; |FINSI;
               |SI ModoEntrada = 3; eaTipoOper = "-7+4"; |FINSI;
               |SI ModoEntrada = 2;
                  |SI Flag < 0;
                     eaTipoOper = "-7+4";
                  |SINO;
                     eaTipoOper = "+7-4";
                  |FINSI;
               |FINSI;
            |FINSI;

            || enEmpCartera = #48#0;  enEmpGestion = #dscam003#46;
            enEmpCartera = -1;     enEmpGestion = #dscam003#46;
            eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
            |SI #dscam004#5 = "CSI"; |Y #dscam003#14 = "P"; |Y #dscam004#9 ! 0;
               nImporte = #dscam004#9;
            |SINO;
               nImporte = #dscam004#8;
            |FINSI;
            |HAZ BucleRiesgo;
         |FINSI;
      |FINSI;
      |SI #dscam051#1 = "S";
         |ABRE #dscam067;
         #dscam067#8 = 0;
         #dscam067#9 = 0;
         #dscam067#0 = "CB";
         #dscam067#1 = #dscam004#17;
         #dscam067#2 = #dscam004#3;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
            |SI Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
               |SAL;
            |FINSI;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
         |SIGUE;

         |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
          |Y Clave3  = "";
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #4 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;

            |SI ModoEntrada ! 3; |Y Flag > 0;
               |SI efFechaEdit ! #dscam004#6; |O eaMovtoEdit ! #dscam004#5;
                  || Si es parte de una sesion y se ha cambiado o la fecha
                  ||    o el tipo de movimiento, si Flag es mayor de cero
                  ||    tengo que eliminar este movimiento de la sesion y
                  ||    volver a enlazarla, ya que se ha quedado desconta-
                  ||    bilizada y el nuevo enlace no se sabe si la conta-
                  ||    bilizar  por lo que debemos hacerlo por separado.
                  |SI #dscam004#43 ! 0;
                     || Primero compruebo si en la sesion solo hay un registro.
                     || Si es asi el enlace que hara en 'TrataSecuencia' debera
                     ||    ser de borrado. En caso contrario debe enlazar lo que
                     ||    haya asociado a la sesion
                     |HAZ TrataSecuencia;
                  |FINSI;
               |FINSI;
            |FINSI;

            |SI #dscam004#43 = 0;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
               #dscaw013#11 = "N";          #dscaw013#12 = 9;
               #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
               #dscaw013#11 = "N";          #dscaw013#12 = 3;
               #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
               #dscaw013#11 = "F";          #dscaw013#12 = 10;
               #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
               |GRABA 020#dscaw013.n;

               |LIBERA #dscaw013; |CIERRA #dscaw013;
               Comodin = #dscam067#10;
               |SI ModoEntrada = 3; |Y nNumSec = 0; Modo1 = ",B"; |SINO; Modo1 = ""; |FINSI;
               Comodin = "dscam033.tab;" + Comodin + Modo1;
               |LIBERA #dscam003; |CIERRAT #dscam003;
               |LIBERA #dscam004; |CIERRAT #dscam004;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam003; |LEE 101#dscam003.=;
               |ABRET #dscam004; |LEE 101#dscam004.=;
            |SINO;
               |SI ModoEntrada = 3;
                  |SALVA_FICHA #dscam004;
                  nCodigo = #dscam004#43;
                  aOper1  = #dscam004#5; aOper2  = #dscam004#5;
                  |SI aOper1 = "COB"; |O aOper1 = "COP";
                     aOper1 = "COB"; aOper2 = "COP";
                  |FINSI;
                  nCuentaCobs = 0;
                  |BUCLE CuentaCobs;
                  |LEE 000#dscam004.p; |REPON_FICHA #dscam004;
                  |SI nCuentaCobs = 1;
                     Modo1 = ",B";
                  |SINO;
                     |SALVA_DATOS #dscam004; |BORRA 020#dscam004.a;
                     Modo1 = "";
                  |FINSI;
               |FINSI;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
               #dscaw013#11 = "N";          #dscaw013#12 = 9;
               #dscaw013#5 = #dscam004#43;  #dscaw013#6 = #dscam004#43;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
               #dscaw013#11 = "A";          #dscaw013#12 = 3;
               |SI #dscam004#5 = "COB"; |O #dscam004#5 = "COP";
                  #dscaw013#3 = "COB";  #dscaw013#4 = "COP";
               |SINO;
                  #dscaw013#3 = #dscam004#5;  #dscaw013#4 = #dscam004#5;
               |FINSI;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
               #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
               #dscaw013#11 = "F";          #dscaw013#12 = 10;
               #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
               |GRABA 020#dscaw013.n;
               |LIBERA #dscaw013; |CIERRA #dscaw013;

               Comodin = #dscam067#10;
               Comodin = "dscam033.tab;" + Comodin + Modo1;
               |SI aOper = "RTA"; Comodin = Comodin + ",V"; |FINSI;
               |LIBERA #dscam003; |CIERRAT #dscam003;
               |LIBERA #dscam004; |CIERRAT #dscam004;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam003; |LEE 101#dscam003.=;
               |ABRET #dscam004; |LEE 101#dscam004.=;

               |SI ModoEntrada = 3; |Y Modo1 = "";
                  |REPON_DATOS #dscam004;
                  |GRABA 020#dscam004.c;
                  |BORRA 020#dscam067.a;
               |FINSI;
            |FINSI;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
         |CIERRA #dscam067;
      |SINO;
         |ABRE #dscam067;
         #dscam067#8 = 0;
         #dscam067#9 = 0;
         #dscam067#0 = "CB";
         #dscam067#1 = #dscam004#17;
         #dscam067#2 = #dscam004#3;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |SI Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
            |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
         |FINSI;
         |CIERRA #dscam067;
      |FINSI;

      #dscam003#56 = #dscam003#56 +. #dscam004#24;
      #dscam003#23 = #dscam003#23 +. #dscam004#8; #dscam003#61 = #dscam003#61 +. #dscam004#26;
      |SI #dscam004#22 = "D";
          #dscam003#54 = #dscam003#54 +. #dscam004#23; #dscam003#67 = #dscam003#67 +. #dscam004#32;
      |SINO;
         #dscam003#55 = #dscam003#55 +. #dscam004#23; #dscam003#68 = #dscam003#68 +. #dscam004#32;
      |FINSI;
      #dscam003#24 = #dscam003#24 +. #dscam004#12; #dscam003#62 = #dscam003#62 +. #dscam004#29;
      #dscam003#25 = #dscam003#25 +. #dscam004#13; #dscam003#63 = #dscam003#63 +. #dscam004#30;
      #dscam003#38 = #dscam003#38 +. #dscam004#14; #dscam003#66 = #dscam003#66 +. #dscam004#31;
      |SI ModoEntrada = 3;
         |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
         |SALVA_FICHA #dscam004;
         |LEE 000#dscam004.a;
         |SI FSalida = 0;
            |SI #dscam004#17 = #dscam003#40;
               #dscam003#26 = #dscam004#6;
            |SINO;
               #dscam003#26 = "01.01.0000";
            |FINSI;
            |LEE 000#dscam004.s;
         |SINO;
            #dscam003#26 = "01.01.0000";
         |FINSI;
         |REPON_FICHA #dscam004;

         |SI Flag > 0;
            || enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
            enEmpCartera = -1;     enEmpGestion = #dscam003#46;
            eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
            nImporte = #dscam004#8; eaTipoOper = "+4";
            |HAZ BucleRiesgo;
         |FINSI;
      |SINO;
         #dscam003#26 = #dscam004#6;
      |FINSI;

      |SI ModoEntrada = 2; |Y Flag > 0;
         eaFicher = "dscam003"; eaClave = #dscam003#40;
         enImpAct  = #dscam003#61; |HAZ GrabaAudit;
      |FINSI;
   |FINSI;

   |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "IME"; |O #dscam004#5 = "IMA";
    |O #dscam004#5 = "RCE"; |O #dscam004#5 = "RCA";
      |SI #dscam004#5 = "IME";
         |SI ModoEntrada = 2;
            |MENAV "    No se puede modificar un impagado de entregas a cuenta";
            |ERROR; |ACABA;
         |FINSI;
         || Si los recibos que en su momento se compensaron y luego se anularon
         ||    con este IME tiene movimientos posteriores, no se puede dar de
         ||    baja
         |SI ModoEntrada = 3;
            nDocSald = #dscam004#17;
            |SALVA_FICHA #dscam004;
            nSwError = -1;
            nSw = 1; |BUCLE BuscaACAs;
            |REPON_FICHA #dscam004;

            |SI nSwError > 0;
               |MENAV "    El recibo cuya compensacion se anulo con el impagado tiene movimientos posteriores";
               |MENAV "    No se puede eliminar el impagado de la entrega. Proceso cancelado.";
               |ERROR; |ACABA;
            |SINO;
               || Si no, busco los movimientos "ACA" de este "IME" para anularlos
               |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
               nSw = 2; |BUCLE BuscaACAs;
               |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;

               #dscam003#100 = "N";
               #dscam003#23 = #dscam003#23 - #dscam004#9; #dscam003#61 = #dscam003#61 - #dscam004#27;
               #dscam003#30 = #dscam003#30 - #dscam004#9; #dscam003#64 = #dscam003#64 - #dscam004#27;
               #dscam003#55 = #dscam003#55 + #dscam004#9; #dscam003#68 = #dscam003#68 + #dscam004#27;
               |GRABA 020#dscam003.a;
            |FINSI;
         |FINSI;
      |FINSI;
      |SI ModoEntrada = 3;
         |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "IMA";
            #dscam003#100 = "N";
            |SI #dscam004#48 ! "     "; |O #dscam004#49 ! 000000; |O #dscam004#50 ! "01.01.0000";
               || Compruebo que los recibos de la factura de gastos no tienen
               ||     movimientos. Si es asi, cancelo la baja. Si no ......
               aSerie = #dscam004#48; nFactura = #dscam004#49; fFechaEm = #dscam004#50;
               nLibro = #dscam004#15; nDocum = #dscam004#17;
               aEntidad = ""; aNumero = "";
               |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
               |LEE 000#dscam004.a;
               |SI nDocum = #dscam004#17;
                  |SI #dscam004#5 = "EMR"; |O #dscam004#5 = "REM";
                     |ABRE #dscam013;
                     |SI #dscam004#5 = "EMR"; |SELECT #4#dscam013; #dscam013#24 = #dscam004#3; |FINSI;
                     |SI #dscam004#5 = "REM"; |SELECT #2#dscam013; #dscam013#17 = #dscam004#3; |FINSI;
                     #dscam013#16 = #dscam004#17;
                     |LEE 000#dscam013.=;
                     |SI FSalida = 0;
                        aEntidad = #dscam013#37;
                        aNumero  = #dscam013#38;
                     |FINSI;
                     |SELECT #1#dscam013;
                     |CIERRA #dscam013;
                     #dscam003#90 = "S";
                  |FINSI;
               |FINSI;
               nSwError = 0; |BUCLE MiraRecs;
               |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;
               |SI nSwError ! 0;
                  |MENAV "    Los recibos resultantes de los gastos de este impagado tienen movimientos. No se efectuara la baja.";
                  |ERROR; |ACABA;
               |FINSI;
               #dscam003#72 = aEntidad;
               #dscam003#70 = aNumero;
               |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
               |GRABA 020#dscam003.a;

               |SALVA_FICHA #dscam003;
               |SI HayGestion ! 0;
                  || ...... borro la factura directa ......
                  eaSerie = aSerie; enFactura = nFactura;
                  |HAZ BorraFactura;
               |FINSI;
               || ...... y borro los recibos correspondientes
               |BUCLE BajaRecs;
               |REPON_FICHA #dscam003;
            |SINO;
               || Si el impagado del que estamos borrando la linea es de un
               ||   talon/pagare de cliente, lo que tengo que mirar primero
               ||   ver si el resto de recibos del pagare estan en disposicion
               ||   de ser borrados, y si es asi, borrar las lineas de impagado
               ||   de esos otros recibos y reponer los datos del n§ de talon
               nDocum = #dscam004#17;
               |SALVA_FICHA #dscam004;
               |LEE 000#dscam004.a;
               |SI FSalida = 0; |Y nDocum = #dscam004#17;
                  |SI #dscam004#5 = "EMR"; |O #dscam004#5 = "REM";
                     |ABRE #dscam013;
                     |SI #dscam004#5 = "EMR"; |SELECT #4#dscam013; #dscam013#24 = #dscam004#3; |FINSI;
                     |SI #dscam004#5 = "REM"; |SELECT #2#dscam013; #dscam013#17 = #dscam004#3; |FINSI;
                     #dscam013#16 = #dscam004#17;
                     |LEE 000#dscam013.=;
                     |SI FSalida = 0;
                        nRemesa  = #dscam013#0; nLinRemesa = #dscam013#1;
                        aEntidad = #dscam013#37; |QBF aEntidad;
                        aNumero  = #dscam013#38; |QBF aNumero;
                     |SINO;
                        nRemesa = -1; nLinRemesa = -1;
                        aEntidad = ""; aNumero = "";
                     |FINSI;
                     |SELECT #1#dscam013;
                     |CIERRA #dscam013;
                     |SI nRemesa ] 0;
                        fFechaRem = "01.01.0000";
                        |SI aEntidad ! ""; |O aNumero ! "";
                           |SALVA_FICHA #dscam003;
                           nSw = 0; nSwFuncion = 1; |BUCLE ComprRemesa;
                           |REPON_FICHA #dscam003;
                           |SI nSw ! 0;
                              |MENAV "    Hay recibos asociados al pagare/talon con movimientos. Proceso cancelado.";
                              |REPON_FICHA #dscam004;
                              |ERROR; |ACABA;
                           |SINO;
                              |SALVA_FICHA #dscam003;
                              nSw = 0; nSwFuncion = 2; |BUCLE ComprRemesa;
                              |REPON_FICHA #dscam003;
                              |REPON_FICHA #dscam004; |SALVA_FICHA #dscam004;
                           |FINSI;
                        |SINO;
                           |SI #dscam003#17 = 0; |Y #dscam003#37 = 0;
                              #dscam003#17 = nRemesa;
                              #dscam003#37 = nLinRemesa;
                           |FINSI;
                        |FINSI;
                        |HAZ EsArtenvas;
                        |SI FSalida ! 0;
                           #dscam003#26 = fFechaRem;
                        |FINSI;
                        #dscam003#70 = aNumero;
                        #dscam003#72 = aEntidad;
                        |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
                        |SI #dscam003#14 = "p";
                           #dscam003#31 = #dscam003#31 - #dscam004#9; #dscam003#65 = #dscam003#65 - #dscam004#27;
                           #dscam003#23 = #dscam003#23 + #dscam004#9; #dscam003#61 = #dscam003#61 + #dscam004#27;
                        |FINSI;
                        |GRABA 020#dscam003.a;
                     |FINSI;
                  |FINSI;
                  |SI #dscam004#5 = "RTA";
                     |SI #dscam004#51 ! "    "; |O #dscam004#52 ! "          ";
                        aEntidad = #dscam004#51;
                        aNumero  = #dscam004#52;
                              fFechaVto = #dscam004#53;
                        nDocum   = #dscam004#17;
                        |SALVA_FICHA #dscam003;
                        nSw = 0; nSwFuncion = 1; |BUCLE ComprRTA;
                        |REPON_FICHA #dscam003;
                        |SI nSw ! 0;
                           |MENAV "    Hay recibos que asociados al pagare/talon con movimientos. Proceso cancelado.";
                           |REPON_FICHA #dscam004;
                           |ERROR; |ACABA;
                        |SINO;
                           |SALVA_FICHA #dscam003;
                           nSw = 0; nSwFuncion = 2; |BUCLE ComprRTA;
                           |REPON_FICHA #dscam003;
                           |REPON_FICHA #dscam004; |SALVA_FICHA #dscam004;
                        |FINSI;
                        #dscam003#26 = fFechaRta;
                              #dscam003#70 = aNumero;
                        #dscam003#72 = aEntidad;
                        #dscam003#71 = fFechaVto;

                        |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
                        |GRABA 020#dscam003.a;
                     |SINO;
                        aAlfa2 = #dscam004#16; |QBF aAlfa2;
                        aAlfa2 = aAlfa2 - "Cob.Talon n§";
                        |SI FSalida ! 0;
                           aAlfa3 = aAlfa2 % 0104; #dscam003#72 = aAlfa3;
                           aAlfa3 = aAlfa2 % 0610; #dscam003#70 = aAlfa3;
                           |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
                              #dscam003#23 = #dscam003#23 + #dscam004#8;
                              #dscam003#61 = #dscam003#61 + #dscam004#26;
                              #dscam003#31 = #dscam003#31 - #dscam004#8;
                              #dscam003#65 = #dscam003#65 - #dscam004#26;
                              |SI #dscam003#31 = 0;
                                 #dscam003#14 = "e";
                                 #dscam003#15 = "Entrega pdte.compensar";
                              |FINSI;
                           |FINSI;
                           #dscam003#26 = fFechaRta;
                           |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
                           |GRABA 020#dscam003.a;
                        |FINSI;
                     |FINSI;
                  |FINSI;
               |FINSI;
               |REPON_FICHA #dscam004;
            |FINSI;

            |SI #dscam004#5 = "IMA";
               |ABRE #dscam013;
               #dscam013#0 = #dscam003#17;
               #dscam013#1 = #dscam003#37;
               |LEE 101#dscam013.=;
               |SI FSalida = 0;
                  |SI #dscam013#15 = "I";
                     #dscam013#15 = "N";
                     |GRABA 020#dscam013.a; |LIBERA #dscam013;
                  |FINSI;
               |FINSI;
               |CIERRA #dscam013;
            |FINSI;
         |FINSI;
      |FINSI;
      |LIBERA #dscam013;
      |ABRE #dscam012;
      #dscam012#0 = #dscam013#0;
      |LEE 000#dscam012.=;
      |SI FSalida ! 0; |DDEFECTO #dscam012; |FINSI;
      |CIERRA #dscam012;

      #dscam004#21 = "*"; |GRABA 020#dscam004.a;
      eaUsuario = Usuario % 0810;
      eaTipoReg = "CB";  eaNumero = ("000000000" + #dscam003#40) % -109;
      |SI ModoEntrada = 3;
         |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "IME"; |O #dscam004#5 = "IMA";
            |SI #dscam004#5 ! "IME";
               eaDescr   = "BAJA IMPAGADO RECIBO (" + #dscam003#0 + "/";
            |SINO;
               eaDescr   = "BAJA IMPAGADO ENTREGA (" + #dscam003#0 + "/";
            |FINSI;
         |SINO;
            eaDescr   = "BAJA RECLAMACION RECIBO (" + #dscam003#0 + "/";
         |FINSI;
         eaDescr   = eaDescr + #dscam003#1 + "/" + #dscam003#2 + ") DESDE LINEAS DE RECIBOS";
         eaTipoOp  = "B";   enImpAnt = #dscam003#23;
         eaFicher = "dscam003"; eaClave = #dscam003#40;
         enImpAct  = #dscam003#23 - #dscam004#8; |HAZ GrabaAudit;
      |FINSI;
      |SI ModoEntrada = 2; |Y Flag < 0;
         |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "IME"; |O #dscam004#5 = "IMA";
            |SI #dscam004#5 ! "IME";
               eaDescr   = "MODIFICACION IMPAGADO RECIBO (" + #dscam003#0 + "/";
            |SINO;
               eaDescr   = "MODIFICACION IMPAGADO ENTREGA (" + #dscam003#0 + "/";
            |FINSI;
         |SINO;
            eaDescr   = "MODIFICACION RECLAMACION RECIBO (" + #dscam003#0 + "/";
         |FINSI;
         eaDescr   = eaDescr + #dscam003#1 + "/" + #dscam003#2 + ") DESDE LINEAS DE RECIBOS";
         eaTipoOp  = "M";   enImpAnt = #dscam003#23;
         eaFicher = "dscam003"; eaClave = #dscam003#40;
         enImpAct  = #dscam003#23 - #dscam004#8; |HAZ GrabaAudit;
      |FINSI;

      |SI #dscam003#72 = "    ";
         nSwPasa = 1;
         |SI ModoEntrada = 2; |Y Flag < 0; nSwPasa = 0; |FINSI;

         |SI nSwPasa = 1;
            |SI #dscam051#1 = "S";
               |ABRE #dscam067;
               #dscam067#8 = 0;
               #dscam067#9 = 0;
               #dscam067#0 = "CB";
               #dscam067#1 = #dscam004#17;
               #dscam067#2 = #dscam004#3;
               #dscam067#3 = "";
               #dscam067#11 = 1;
               |LEE 000#dscam067.];
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
               |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
                  |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
                     |SAL;
                  |FINSI;
                  |LEE 000#dscam067.s;
                  FEstado = FSalida;
                  Clave1 = #dscam067#1; Clave2 = #dscam067#2;
                  Clave3 = #dscam067#3; |QBF Clave3;
               |SIGUE;

               |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
                |Y Clave3  = "";
                  Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
                  |NOME_DAT #4 Comodin;
                  |DELINDEX #dscaw013; |ABRE #dscaw013;
                  |SI #dscam004#43 = 0;
                     |DDEFECTO #dscaw013;
                     #dscaw013#0  = 1;            #dscaw013#5  = #dscam004#17;
                     #dscaw013#6  = #dscam004#17; #dscaw013#11 = "N";
                     #dscaw013#12 = 9;            #dscaw013#13 = "dscam004";
                     #dscaw013#14 = 17;           #dscaw013#15 = #dscam067#10;
                     |GRABA 020#dscaw013.n;

                     |DDEFECTO #dscaw013;
                     #dscaw013#0  = 2;            #dscaw013#5  = #dscam004#3;
                     #dscaw013#6  = #dscam004#3;  #dscaw013#11 = "N";
                     #dscaw013#12 = 3;            #dscaw013#13 = "dscam004";
                     #dscaw013#14 = 3;            #dscaw013#15 = #dscam067#10;
                     |GRABA 020#dscaw013.n;

                     |DDEFECTO #dscaw013;
                     #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
                     #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
                     #dscaw013#11 = "F";          #dscaw013#12 = 10;
                     #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
                     |GRABA 020#dscaw013.n;

                     |LIBERA #dscaw013; |CIERRA #dscaw013;

                     |SI ModoEntrada = 3; Modo1 = ",B"; |SINO; Modo1 = ""; |FINSI;
                     Comodin = #dscam067#10;
                     Comodin = "dscam033.tab;" + Comodin + Modo1;
                     |LIBERA #dscam004; |CIERRAT #dscam004;
                     |LIBERA #dscam003; |CIERRAT #dscam003;
                     |SUB_EJECUTA_NP Comodin;
                     |ABRET #dscam003; |LEE 101#dscam003.=;
                     |ABRET #dscam004; |LEE 101#dscam004.=;
                  |SINO;
                     |SI ModoEntrada = 3;
                        |SALVA_FICHA #dscam004;
                        nCodigo = #dscam004#43;
                        aOper1  = #dscam004#5; aOper2  = #dscam004#5;
                        nCuentaCobs = 0;
                        |BUCLE CuentaCobs;
                        |LEE 000#dscam004.p; |REPON_FICHA #dscam004;
                        |SI nCuentaCobs = 1;
                           Modo1 = ",B";
                        |SINO;
                           |SALVA_DATOS #dscam004; |BORRA 020#dscam004.a;
                           Modo1 = "";
                        |FINSI;
                     |FINSI;
                     |DDEFECTO #dscaw013;
                     #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
                     #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
                     #dscaw013#11 = "N";          #dscaw013#12 = 9;
                     #dscaw013#5 = #dscam004#43;  #dscaw013#6 = #dscam004#43;
                     |GRABA 020#dscaw013.n;

                     |DDEFECTO #dscaw013;
                     #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
                     #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
                     #dscaw013#11 = "A";          #dscaw013#12 = 3;
                     #dscaw013#3 = #dscam004#5;  #dscaw013#4 = #dscam004#5;
                     |GRABA 020#dscaw013.n;

                     |DDEFECTO #dscaw013;
                     #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
                     #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
                     #dscaw013#11 = "F";          #dscaw013#12 = 10;
                     #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
                     |GRABA 020#dscaw013.n;

                     |LIBERA #dscaw013; |CIERRA #dscaw013;

                     Comodin = #dscam067#10;
                     Comodin = "dscam033.tab;" + Comodin + Modo1;
                     |LIBERA #dscam004; |CIERRAT #dscam004;
                     |LIBERA #dscam003; |CIERRAT #dscam003;
                     |SUB_EJECUTA_NP Comodin;
                     |ABRET #dscam003; |LEE 101#dscam003.=;
                     |ABRET #dscam004; |LEE 101#dscam004.=;

                     |SI ModoEntrada = 3; |Y Modo1 = "";
                        |REPON_DATOS #dscam004;
                        |GRABA 020#dscam004.c;
                     |FINSI;
                  |FINSI;
                  |CIERRA #dscaw013;

                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
               |FINSI;
               |CIERRA #dscam067;
            |SINO;
               |ABRE #dscam067;
               #dscam067#8 = 0;
               #dscam067#9 = 0;
               #dscam067#0 = "CB";
               #dscam067#1 = #dscam004#17;
               #dscam067#2 = #dscam004#3;
               #dscam067#3 = "";
               #dscam067#11 = 1;
               |LEE 000#dscam067.];
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
               |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
                  |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
               |FINSI;
               |CIERRA #dscam067;
            |FINSI;
         |FINSI;

         |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "IME"; |O #dscam004#5 = "IMA";
            #dscam003#16 = #dscam003#16 +. 1;
         |FINSI;
         aOperac = #dscam004#5;
         #dscam003#23 = #dscam003#23 -. #dscam004#9;  #dscam003#61 = #dscam003#61 -. (#dscam004#27 - #dscam004#24);
         #dscam003#24 = #dscam003#24 +. #dscam004#12; #dscam003#62 = #dscam003#62 +. #dscam004#29;
         #dscam003#25 = #dscam003#25 +. #dscam004#13; #dscam003#63 = #dscam003#63 +. #dscam004#30;
         #dscam003#38 = #dscam003#38 +. #dscam004#14; #dscam003#66 = #dscam003#66 +. #dscam004#31;
         #dscam003#56 = #dscam003#56 +. #dscam004#24;
         |SI ModoEntrada = 3;
            aMovto = #dscam004#5;
            |LEE 000#dscam004.a;
            |SI FSalida = 0;
               |SI #dscam004#17 = #dscam003#40;
                  |SI aMovto = "IMA";
                     |HAZ EsArtenvas;
                     |SI FSalida ! 0;
                        #dscam003#26 = #dscam004#6;
                     |FINSI;
                  |SINO;
                     #dscam003#26 = #dscam004#6;
                  |FINSI;
                  |SI #dscam004#5 = "PRC"; |O #dscam004#5 = "PRA";
                     nUltRem = 0; nUltEmiRem  = 0;
                     |ABRE #dscam013; |SELECT #2#dscam013;
                     #dscam013#16 = #dscam004#17;
                     #dscam013#17 = 1;
                     |LEE 000#dscam013.];
                     |PARA; |SI FSalida = 0; |Y #dscam013#16 = #dscam004#17; |HACIENDO;
                        nUltRem = #dscam013#17;
                        nUltEmiRem = #dscam013#24;
                        |LEE 000#dscam013.s;
                     |SIGUE;
                     |SI nUltEmiRem = 0;
                        |SELECT #4#dscam013;
                        #dscam013#16 = #dscam004#17;
                        #dscam013#24 = 1;
                        |LEE 000#dscam013.];
                        |PARA; |SI FSalida = 0; |Y #dscam013#16 = #dscam004#17; |HACIENDO;
                           nUltEmiRem = #dscam013#24;
                           |LEE 000#dscam013.s;
                        |SIGUE;
                     |FINSI;

                     |SI #dscam004#5 = "PRC";
                        |SI nUltRem ! 0;
                           #dscam013#16 = #dscam004#17;
                           #dscam013#17 = nUltRem;
                           |LEE 101#dscam013.=;
                           |SI FSalida = 0;
                              |SI #dscam013#15 = "S"; #dscam003#84 = "S"; |FINSI;
                              |SI aOperac = "RCE";
                                 |SI #dscam013#15 = "R";
                                    |ABRE #dscam012;
                                    #dscam012#0 = #dscam013#0;
                                    |LEE 000#dscam012.=;
                                    |SI FSalida ! 0; |DDEFECTO #dscam012; |FINSI;
                                    |CIERRA #dscam012;
                                    #dscam013#15 = "N"; |GRABA 020#dscam013.a;
                                    #dscam003#17 = #dscam012#0;
                                    #dscam003#53 = #dscam012#1;
                                    #dscam003#37 = #dscam013#1;
                                    #dscam003#98 = "S";
                                 |FINSI;
                              |FINSI;
                           |FINSI;
                           |LIBERA #dscam013;
                        |FINSI;
                     |FINSI;
                     |SI #dscam004#5 = "PRA";
                        |SI nUltEmiRem ! 0;
                           |SELECT #4#dscam013;
                           #dscam013#16 = #dscam004#17;
                           #dscam013#24 = nUltEmiRem;
                           |LEE 101#dscam013.=;
                           |SI FSalida = 0;
                              |SI #dscam013#15 = "S"; #dscam003#84 = "S"; |FINSI;
                              |SI aOperac = "RCA";
                                 |SI #dscam013#15 = "R";
                                    |ABRE #dscam012;
                                    #dscam012#0 = #dscam013#0;
                                    |LEE 000#dscam012.=;
                                    |SI FSalida ! 0; |DDEFECTO #dscam012; |FINSI;
                                    |CIERRA #dscam012;
                                    #dscam013#15 = "N"; |GRABA 020#dscam013.a;
                                    #dscam003#98 = "S";
                                    #dscam003#17 = #dscam012#0;
                                    #dscam003#53 = #dscam012#1;
                                    #dscam003#37 = #dscam013#1;
                                 |FINSI;
                              |FINSI;
                           |FINSI;
                           |LIBERA #dscam013;
                        |FINSI;
                     |FINSI;
                     |CIERRA #dscam013;
                  |FINSI;
               |SINO;
                  #dscam003#26 = "01.01.0000";
               |FINSI;
               |LEE 000#dscam004.s;
            |SINO;
               #dscam003#26 = "01.01.0000";
            |FINSI;
         |SINO;
            #dscam003#26 = #dscam004#6;
         |FINSI;
         |SI ModoEntrada = 2; |Y Flag > 0;
            eaFicher = "dscam003"; eaClave = #dscam003#40;
            enImpAct  = #dscam003#23; |HAZ GrabaAudit;
         |FINSI;
         ||enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
         enEmpCartera = -1;     enEmpGestion = #dscam003#46;
         eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
         |SI ModoEntrada = 3;
            |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "IME"; |O #dscam004#5 = "IMA";
               |SI #dscam003#84 = "N";
                  |SI #dscam012#22 ! 1; |Y #dscam012#22 ! 3;
                     |SI #dscam004#5 ! "IMA";
                        #dscam013#0 = #dscam003#17;
                        #dscam013#1 = #dscam003#37;
                        |LEE 000#dscam013.=;
                        |SI FSalida = 0; |Y #dscam013#15 = "N";
                           nImporte = #dscam004#27; eaTipoOper = "+6";
                        |FINSI;
                     |SINO;
                        nImporte = #dscam003#30 - (#dscam004#29 + #dscam004#30 + #dscam004#31 + #dscam004#32);
                        eaTipoOper = "+4";
                     |FINSI;
                     |HAZ BucleRiesgo;
                  |FINSI;
               |FINSI;
               nImporte = #dscam004#27;
               |SI #dscam004#5 = "IMA";
                  nImporte = #dscam003#30 - (#dscam004#29 + #dscam004#30 + #dscam004#31 + #dscam004#32);
               |FINSI;
               nImporte = nImporte + #dscam004#29 + #dscam004#30 + #dscam004#31 + #dscam004#32;
               eaTipoOper = "-7"; |HAZ BucleRiesgo;

               |HAZ EsOTP;
               |SI FSalida = 0;
                  aAlfa = "    N" + &191 + " Eliminar la incidencia ?";
                  |CONFI aAlfa;
                  |SI FSalida = 0;
                     |DBASS aAlfa; |QBF aAlfa;
                     aAlfa = aAlfa + "dspreven/def/visalm00.mas";
                     |CARGA_DEF aAlfa, visalm00@;
                     |SI FSalida = 0;
                        |DBASS aAlfa; |QBF aAlfa;
                        aAlfa = aAlfa + "dspreven/fich/"; |PATH_DAT #visalm00@#aAlfa#;

                        |ABRE #visalm00@;
                        |LEE 000#visalm00@.p;
                        |PARA; |SI FSalida = 0; |HACIENDO;
                           |SI #visalm00@#3 = "S"; |SAL; |FINSI;
                           |LEE 000#visalm00@.s;
                        |SIGUE;

                        |SI #visalm00@#3 = "S";
                           |DBASS aAlfa; |QBF aAlfa;
                           aAlfa = aAlfa + "dspreven/def/dspvm002.mas";
                           |CARGA_DEF aAlfa, dspvm002@;

                           |DBASS aAlfa; |QBF aAlfa;
                           aAlfa = aAlfa + "dspreven/def/maesm011.mas";
                           |CARGA_DEF aAlfa, maesm011@;

                           |DBASS aAlfa; |QBF aAlfa;
                           aAlfa = aAlfa + "dspreven/fich/"; |PATH_DAT #maesm011@#aAlfa#;
                           aAlfa = aAlfa + (("00000" + #visalm00@#0) % -105) + "/";
                           |PATH_DAT #dspvm002@#aAlfa#;
                           |ABRE #dspvm002@;
                           |SELECT #2#dspvm002@;
                           |LEE 000#dspvm002@.p;

                           nSwCerrada = -1;
                           #dspvm002@#8 = #dscam003#32;
                           |LEE 000#dspvm002@.];
                           |PARA; |SI FSalida = 0; |Y #dspvm002@#8 = #dscam003#32; |HACIENDO;
                              |SI #dspvm002@#129 = #dscam003#0; |Y #dspvm002@#130 = #dscam003#1;
                               |Y #dspvm002@#131 = #dscam003#2;
                                 |SI #dspvm002@#1   = "A";
                                    nSwCerrada = -1; |SAL;
                                 |SINO;
                                    nSwCerrada = #dspvm002@#0;
                                 |FINSI;
                              |FINSI;
                              |LEE 000#dspvm002@.s;
                           |SIGUE;
                           |SI #dspvm002@#8 ! #dscam003#32; |O FSalida ! 0;
                              #dspvm002@#0 = -1;
                           |FINSI;
                           |SELECT #1#dspvm002@;
                           |SI nSwCerrada ] 0;
                              |MENAV "    La incidencia no se cambiara porque esta cerrada.";
                           |FINSI;

                           |LEE 101#dspvm002@.=;
                           |SI FSalida = 0;
                              |SI #dspvm002@#121 = "S"; |Y #dspvm002@#129 = #dscam003#0;
                               |Y #dspvm002@#130 = #dscam003#1; |Y #dspvm002@#131 = #dscam003#2;
                               |Y #dspvm002@#1 ! "C";
                                 |SI #dspvm002@#23 = "S"; |O #dspvm002@#71 = "S";
                                    #dspvm002@#121 = "N";
                                    #dspvm002@#122 = "01.01.0000";
                                    |PARA nCont = 123; |SI nCont [ 171; |HACIENDO nCont = nCont + 1;
                                       |SI nCont = 130; |O nCont = 131;
                                          #dspvm002@#nCont# = 0;
                                       |SINO;
                                          #dspvm002@#nCont# = "";
                                       |FINSI;
                                    |SIGUE;
                                    #dspvm002@#201 = "N";
                                    |GRABA 020#dspvm002@.a;
                                 |SINO;
                                    |BORRA 020#dspvm002@.a;
                                 |FINSI;
                              |FINSI;
                              |LIBERA #dspvm002@;
                           |FINSI;
                           |SELECT #1#dspvm002@;

                           |CIERRA #maesm011@; |DESCARGA_DEF #maesm011@;
                           |CIERRA #dspvm002@; |DESCARGA_DEF #dspvm002@;
                        |FINSI;
                        |CIERRA #visalm00@; |DESCARGA_DEF #visalm00@;
                     |FINSI;
                  |FINSI;
               |FINSI;
            |SINO;
               nImporte = #dscam004#27 + #dscam004#29 + #dscam004#30 + #dscam004#31 + #dscam004#32;
               |SI #dscam012#22 ! 1; |Y #dscam012#22 ! 3;
                  eaTipoOper = "-4+6"; |HAZ BucleRiesgo;
               |SINO;
                  eaTipoOper = "-4"; |HAZ BucleRiesgo;
               |FINSI;
            |FINSI;
         |FINSI;
         |SI ModoEntrada = 2;
            |SI Flag < 0;
               |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "IME"; |O #dscam004#5 = "IMA";
                  |SI #dscam003#84 = "N";
                     nImporte = #dscam004#27;
                     eaTipoOper = "+6";
                     |SI #dscam004#5 = "IMA"; eaTipoOper = "+4"; |FINSI;
                     |HAZ BucleRiesgo;
                  |FINSI;
                  nImporte = #dscam004#27 + #dscam004#29 + #dscam004#30 + #dscam004#31 + #dscam004#32;
                  eaTipoOper = "-7"; |HAZ BucleRiesgo;
               |SINO;
                  nImporte = #dscam004#27 + #dscam004#29 + #dscam004#30 + #dscam004#31 + #dscam004#32;
                  |SI #dscam012#22 ! 1; |Y #dscam012#22 ! 3;
                     eaTipoOper = "-4+6"; |HAZ BucleRiesgo;
                  |SINO;
                     eaTipoOper = "-4"; |HAZ BucleRiesgo;
                  |FINSI;
               |FINSI;
            |SINO;
               |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "IME"; |O #dscam004#5 = "IMA";
                  |SI #dscam003#84 = "N";
                     nImporte = #dscam004#27;
                     eaTipoOper = "-6";
                     |SI #dscam004#5 = "IMA"; eaTipoOper = "-4"; |FINSI;
                     |HAZ BucleRiesgo;
                  |FINSI;
                  nImporte = #dscam004#27 + #dscam004#29 + #dscam004#30 + #dscam004#31 + #dscam004#32;
                  eaTipoOper = "+7"; |HAZ BucleRiesgo;
               |SINO;
                  nImporte = #dscam004#27 + #dscam004#29 + #dscam004#30 + #dscam004#31 + #dscam004#32;
                  |SI #dscam012#22 ! 1; |Y #dscam012#22 ! 3;
                     eaTipoOper = "+4-6"; |HAZ BucleRiesgo;
                  |SINO;
                     eaTipoOper = "+4"; |HAZ BucleRiesgo;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
      |SINO;
         |SI Flag < 0;
            |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
            |SI #dscam051#1 = "S";
               |ABRE #dscam067;
               #dscam067#8 = 0;
               #dscam067#9 = 0;
               #dscam067#0 = "CB";
               #dscam067#1 = #dscam004#17;
               #dscam067#2 = #dscam004#3;
               #dscam067#3 = "";
               #dscam067#11 = 1;
               |LEE 000#dscam067.];
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
               |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
                  |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
                     |SAL;
                  |FINSI;
                  |LEE 000#dscam067.s;
                  FEstado = FSalida;
                  Clave1 = #dscam067#1; Clave2 = #dscam067#2;
                  Clave3 = #dscam067#3; |QBF Clave3;
               |SIGUE;

               |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
                |Y Clave3  = "";
                  Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
                  |NOME_DAT #4 Comodin;
                  |DELINDEX #dscaw013; |ABRE #dscaw013;
                  aModo = ",B";

                  nCond = 0;
                  |SI #dscam004#5 = "IMP"; |Y ModoEntrada = 3; nCond = 1; |FINSI;
                  |SI #dscam004#5 = "IMA"; |Y ModoEntrada = 3; nCond = 1; |FINSI;
                  |SI nCond = 1;
                     |SI #dscam004#43 = 0;
                        |DDEFECTO #dscaw013;
                        #dscaw013#0  = 1;            #dscaw013#5  = #dscam004#17;
                        #dscaw013#6  = #dscam004#17; #dscaw013#11 = "N";
                        #dscaw013#12 = 9;            #dscaw013#13 = "dscam004";
                        #dscaw013#14 = 17;           #dscaw013#15 = #dscam067#10;
                        |GRABA 020#dscaw013.n;

                        |DDEFECTO #dscaw013;
                        #dscaw013#0  = 2;            #dscaw013#5  = #dscam004#3;
                        #dscaw013#6  = #dscam004#3;  #dscaw013#11 = "N";
                        #dscaw013#12 = 3;            #dscaw013#13 = "dscam004";
                        #dscaw013#14 = 3;            #dscaw013#15 = #dscam067#10;
                        |GRABA 020#dscaw013.n;

                        |DDEFECTO #dscaw013;
                        #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
                        #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
                        #dscaw013#11 = "F";          #dscaw013#12 = 10;
                        #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
                        |GRABA 020#dscaw013.n;
                     |SINO;
                        nNumSecuencia = #dscam004#43;
                        nCuentaLSec = 0; |BUCLE CuentaLSecs;
                        |SI nCuentaLSec > 1;
                            aModo = "";

                            |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;

                            |LIBERA #dscam004;
                            |LIBERA #dscam003; nNumDocum = #dscam003#40;
                            eaEntPag = #dscam003#72; eaNumPag = #dscam003#70;
                            |SALVA_FICHA #dscam004;
                            ||BUCLE Recl;
                            |HAZ Reclam;
                            |REPON_FICHA #dscam004;
                            #dscam003#40 = nNumDocum; |LEE 101#dscam003.=;
                        |FINSI;

                        |DDEFECTO #dscaw013;
                        #dscaw013#0  = 1;            #dscaw013#5  = #dscam004#43;
                        #dscaw013#6  = #dscam004#43; #dscaw013#11 = "N";
                        #dscaw013#12 = 9;            #dscaw013#13 = "dscam004";
                        #dscaw013#14 = 43;           #dscaw013#15 = #dscam067#10;
                        |GRABA 020#dscaw013.n;

                        |DDEFECTO #dscaw013;
                        #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
                        #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
                        #dscaw013#11 = "F";          #dscaw013#12 = 10;
                        #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
                        |GRABA 020#dscaw013.n;
                     |FINSI;
                  |SINO;
                     |SI #dscam004#43 ! 0;
                        || Cuento el n§ de recibos con el mismo n§ de secuencia
                        ||    y si no hay mas, el modo es "B"
                        enNumRecs = 0; enNumSec = #dscam004#43; |HAZ BuscaSec;
                        |SI enNumRecs = 0;
                           aModo = ",B";
                        |SINO;
                           aModo = "";
                           #dscam004#21 = "*"; |GRABA 020#dscam004.a;
                        |FINSI;
                        |DDEFECTO #dscaw013;
                        #dscaw013#0  = 1;            #dscaw013#5  = #dscam004#43;
                        #dscaw013#6  = #dscam004#43; #dscaw013#11 = "N";
                        #dscaw013#12 = 4;            #dscaw013#13 = "dscam004";
                        #dscaw013#14 = 43;           #dscaw013#15 = #dscam067#10;
                        |GRABA 020#dscaw013.n;

                        |DDEFECTO #dscaw013;
                        #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
                        #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
                        #dscaw013#11 = "F";          #dscaw013#12 = 10;
                        #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
                        |GRABA 020#dscaw013.n;

                        |DDEFECTO #dscaw013;
                        #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
                        #dscaw013#13 = "dscam004";   #dscaw013#14 = 21;
                        #dscaw013#11 = "A";          #dscaw013#12 = 1;
                        #dscaw013#3 = " ";           #dscaw013#4 = " ";
                        |GRABA 020#dscaw013.n;
                     |SINO;
                        |DDEFECTO #dscaw013;
                        #dscaw013#0  = 1;            #dscaw013#5  = #dscam004#17;
                        #dscaw013#6  = #dscam004#17; #dscaw013#11 = "N";
                        #dscaw013#12 = 9;            #dscaw013#13 = "dscam004";
                        #dscaw013#14 = 17;           #dscaw013#15 = #dscam067#10;
                        |GRABA 020#dscaw013.n;

                        |DDEFECTO #dscaw013;
                        #dscaw013#0  = 2;            #dscaw013#5  = #dscam004#3;
                        #dscaw013#6  = #dscam004#3;  #dscaw013#11 = "N";
                        #dscaw013#12 = 3;            #dscaw013#13 = "dscam004";
                        #dscaw013#14 = 3;            #dscaw013#15 = #dscam067#10;
                        |GRABA 020#dscaw013.n;

                        |DDEFECTO #dscaw013;
                        #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
                        #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
                        #dscaw013#11 = "F";          #dscaw013#12 = 10;
                        #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
                        |GRABA 020#dscaw013.n;
                     |FINSI;
                  |FINSI;

                  |CIERRA #dscaw013;

                  Comodin = #dscam067#10;
                  Comodin = "dscam033.tab;" + Comodin + aModo;
                  |LIBERA #dscam003; |CIERRAT #dscam003;
                  |SUB_EJECUTA_NP Comodin;
                  |ABRET #dscam003; |LEE 101#dscam003.=;

                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

                  |SI #dscam004#5 = "IMP"; |Y ModoEntrada = 3; |Y #dscam004#43 ! 0; |Y nCuentaLSec > 1; |ACABA; |FINSI;
               |FINSI;
               |CIERRA #dscam067;
            |FINSI;
            |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;

            |LIBERA #dscam004;
            |LIBERA #dscam003; nNumDocum = #dscam003#40;
            eaEntPag = #dscam003#72; eaNumPag = #dscam003#70;
            |SALVA_FICHA #dscam004;
            ||BUCLE Recl;
            |HAZ Reclam;
            |REPON_FICHA #dscam004;
            #dscam003#40 = nNumDocum; |LEE 101#dscam003.=;
         |FINSI;
         |ACABA;
      |FINSI;
   |FINSI;

   || Calculo de totales

   #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
   #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
   #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
   #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);

   #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;
   || #dscam003#26 = #dscam004#6;

   |SI #dscam003#69 ! " "; |O #dscam003#47 = "S";
      |SI #dscam003#23 = 0;
         |SI #dscam003#31 = 0;
            #dscam003#14 = "L";
            #dscam003#15 = "Recibo Compensado";
         |SINO;
            #dscam003#14 = "p";
            #dscam003#15 = "Entrega pdte.cobro";
         |FINSI;
      |SINO;
         |SI #dscam003#23 = #dscam003#22;
            #dscam003#14 = "e";
            #dscam003#15 = "Pendiente de compensar";
         |SINO;
            #dscam003#14 = "E";
            #dscam003#15 = "Compensado parcialmente";
         |FINSI;
      |FINSI;
   |SINO;
      |SI #dscam003#31 = 0;
         #dscam003#14 = "L";
         #dscam003#15 = "Recibo Liquidado";
      |SINO;
         |SI #dscam003#23 = 0;
            |SI #dscam003#70 = "          ";
               |SI #dscam004#5 ! "IMP"; |Y #dscam004#5 ! "IMA";
                  |SI #dscam004#5 = "RCE"; |O #dscam004#5 = "RCA";
                     |SI #dscam003#17 ! 0;
                        #dscam003#14 = "R";
                        #dscam003#15 = "Remesado";
                     |SINO;
                        #dscam003#14 = "P";
                        #dscam003#15 = "Recibo reclamado";
                     |FINSI;
                  |SINO;
                     |SI #dscam003#16 = 0;
                        nEsConf = 0;
                        |SI aOperAnt = "CFR";    |Y ModoEntrada = 3; nEsConf = 1; |FINSI;
                        |SI #dscam004#5 = "CFR"; |Y ModoEntrada = 2;
                           aEntDocum = #dscam004#51;
                           aNumDocum = #dscam004#52;
                           aFecDocum = #dscam004#53;
                           nEsConf = 1;
                        |FINSI;
                        |SI nEsConf = 1;
                           #dscam003#14 = "F";
                           #dscam003#15 = "Recepcionado Confirme";
                           #dscam003#72 = aEntDocum;
                           #dscam003#70 = aNumDocum;
                           #dscam003#71 = aFecDocum;
                        |SINO;
                           #dscam003#14 = "P";
                           #dscam003#15 = "Pendiente de cobro";
                        |FINSI;
                     |SINO;
                        #dscam003#14 = "I";
                        #dscam003#15 = "Impagado";
                     |FINSI;
                  |FINSI;
               |SINO;
                  |SI #dscam004#5 = "IMP";
                     #dscam003#14 = "I"; #dscam003#15 = "Impagado";
                  |FINSI;
                  |SI #dscam004#5 = "IMA";
                     #dscam003#14 = "R"; #dscam003#15 = "Remesado";
                  |FINSI;
               |FINSI;
            |SINO;
               |SI #dscam003#16 = 0; |Y #dscam004#5 ! "IMP"; |Y #dscam004#5 ! "IMA";
                  nEsConf = 0;
                  |SI aOperAnt = "CFR";    |Y ModoEntrada = 3; nEsConf = 1; |FINSI;
                  |SI #dscam004#5 = "CFR"; |Y ModoEntrada = 2; nEsConf = 1; |FINSI;
                  |SI nEsConf = 1;
                     #dscam003#14 = "F";
                     #dscam003#15 = "Recepcionado Confirme";
                  |SINO;
                     || Miro si est  en alguna remesa ...
                     |SI #dscam003#17 = 0;
                        || ... si no, lo pongo pendiente ...
                        #dscam003#14 = "T";
                        #dscam003#15 = "Pagare/Talon de cliente";
                     |SINO;
                        || ... pero si lo est , lo dejo remesado
                        #dscam003#14 = "R";
                        #dscam003#15 = "Remesado";
                     |FINSI;
                  |FINSI;
               |SINO;
                  |SI #dscam004#5 = "RTA";
                     #dscam003#14 = "T"; #dscam003#15 = "Pagare/Talon de cliente";
                  |FINSI;
                  |SI #dscam004#5 = "IMP";
                     #dscam003#14 = "I"; #dscam003#15 = "Impagado";
                  |FINSI;
                  |SI #dscam004#5 = "IMA";
                     #dscam003#14 = "R"; #dscam003#15 = "Remesado";
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            #dscam003#14 = "C";
            #dscam003#15 = "Parcialmente cobrado";
         |FINSI;
      |FINSI;
   |FINSI;
   |GRABA 020#dscam003.a;

   #dscam004#0  = #dscam003#0;
   #dscam004#1  = #dscam003#1;
   #dscam004#2  = #dscam003#2;
   #dscam004#15 = #dscam003#27;

   |SI ModoEntrada = 3; |HAZ Baja; |FINSI;
   |SI ModoEntrada = 1; UltCobro = #dscam004#3; |FINSI;

   |SI aTipoOp = "REC"; |Y ModoEntrada = 3;
      |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
      #dscam003#40 = nRecEntrega;
      |LEE 000#dscam003.=;
      #dscam004#17 = nRecEntrega;
      #dscam004#3  = 1;
      |LEE 000#dscam004.];
      |SI FSalida = 0; |Y #dscam004#17 = nRecEntrega;
         |PARA; |SI FSalida = 0; |Y #dscam004#17 = nRecEntrega; |HACIENDO;
            |LEE 000#dscam004.s;
         |SIGUE;
         |SI #dscam004#17 ! nRecEntrega; |LEE 000#dscam004.a; |FINSI;
      |FINSI;
      |SI #dscam051#1 = "S";
         |SI #dscam051#3 = "S";
            || enEmpCartera = #48#0;  enEmpGestion = #dscam003#46;
            enEmpCartera = -1;     enEmpGestion = #dscam003#46;
            eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
            nImporte = #dscam004#8; eaTipoOper = "+4+5";
            |HAZ BucleRiesgo;
         |FINSI;
         |ABRE #dscam067;
         #dscam067#8 = 0;
         #dscam067#9 = 0;
         #dscam067#0 = "CB";
         #dscam067#1 = #dscam004#17;
         #dscam067#2 = #dscam004#3;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
            |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3  = "";
               |SAL;
            |FINSI;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
         |SIGUE;

         |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
          |Y Clave3  = "";
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #4 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
            |GRABA 020#dscaw013.n;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
            #dscaw013#11 = "N";          #dscaw013#12 = 3;
            #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
            |GRABA 020#dscaw013.n;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10; #dscaw013#0 = 3;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
            #dscaw013#11 = "F";          #dscaw013#12 = 10;
            #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
            |GRABA 020#dscaw013.n;

            |LIBERA #dscaw013; |CIERRA #dscaw013;
            |SI ModoEntrada = 3; Modo1 = ",B"; |SINO; Modo1 = ""; |FINSI;
            Comodin = #dscam067#10;
            Comodin = "dscam033.tab;" + Comodin + Modo1;
            |LIBERA #dscam003; |CIERRAT #dscam003;
            |LIBERA #dscam004; |CIERRAT #dscam004;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam003; |LEE 101#dscam003.=;
            |ABRET #dscam004; |LEE 101#dscam004.=;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
         |CIERRA #dscam067;
      |FINSI;
      #dscam003#56 = #dscam003#56 - #dscam004#24;
      #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
      #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
      #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
      #dscam003#23 = #dscam003#23 - #dscam004#8; #dscam003#61 = #dscam003#61 - #dscam004#26;
      #dscam003#31 = #dscam003#30 - #dscam003#23; #dscam003#65 = #dscam003#64 - #dscam003#61;
      |SI #dscam004#22 = "D";
          #dscam003#54 = #dscam003#54 - #dscam004#23; #dscam003#67 = #dscam003#67 - #dscam004#32;
      |SINO;
         #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;
      |FINSI;
      #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
      #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
      #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;

      |SI #dscam003#69 ! " "; |O #dscam003#47 = "S";
         |SI #dscam003#23 = 0;
            #dscam003#14 = "L";
            #dscam003#15 = "Recibo Compensado";
         |SINO;
            |SI #dscam003#23 = #dscam003#22;
               #dscam003#14 = "e";
               #dscam003#15 = "Pendiente de compensar";
            |SINO;
               #dscam003#14 = "E";
               #dscam003#15 = "Compensado parcialmente";
            |FINSI;
         |FINSI;
      |SINO;
         |SI #dscam003#31 = 0;
            #dscam003#14 = "L";
            #dscam003#15 = "Recibo Liquidado";
         |SINO;
            |SI #dscam003#23 = 0;
               |SI #dscam003#70 = "          ";
                  |SI #dscam003#16 = 0;
                     #dscam003#14 = "P";
                     #dscam003#15 = "Pendiente de cobro";
                  |SINO;
                     #dscam003#14 = "I";
                     #dscam003#15 = "Impagado";
                  |FINSI;
               |SINO;
                  #dscam003#14 = "T";
                  #dscam003#15 = "Pagare/Talon de cliente";
               |FINSI;
            |SINO;
               #dscam003#14 = "C";
               #dscam003#15 = "Parcialmente cobrado";
            |FINSI;
         |FINSI;
      |FINSI;
      |GRABA 020#dscam003.a;
      |BORRA 020#dscam004.a;
      |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;
   |FINSI;

|FPRC;

|PROCESO Convierte;
    |SI #dscam004#33 = 0; #dscam004#33 = #dscam003#59; |FINSI;
    |SI Campo = 7;  #dscam004#25 = #dscam004#7  * #dscam004#33; |FINSI;
    |SI Campo = 8;  #dscam004#26 = #dscam004#8  * #dscam004#33; |FINSI;
    |SI Campo = 9;  #dscam004#27 = #dscam004#9  * #dscam004#33; |FINSI;
    |SI Campo = 12; #dscam004#29 = #dscam004#12 * #dscam004#33; |FINSI;
    |SI Campo = 13; #dscam004#30 = #dscam004#13 * #dscam004#33; |FINSI;
    |SI Campo = 14; #dscam004#31 = #dscam004#14 * #dscam004#33; |FINSI;
    |SI Campo = 23; #dscam004#32 = #dscam004#23 * #dscam004#33; |FINSI;
|FPRC;

|PROCESO MiraRegistro;
   eaFichClas = "dscam003"; eaTipoClas = #dscam003#12; |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |ACABA; |FINSI;
   |SI eaFichClas = "INFOR";
       eaFichClas = "dscam003";
       eaResult = "V"; enNumDocum = #dscam003#40; enTipoRec = #dscam003#12;
       |SALVA_FICHA #dscam003;
       |HAZ CambiaTR;
       |REPON_FICHA #dscam003;
       |PINTA #dscam003#12;
       |SI eaResult = "ERROR"; eaFichClas = "ERROR"; |ERROR; |ACABA; |FINSI;
   |FINSI;

   |SI #dscam051#104 = "S"; |Y #dscam003#72 ! "    ";
      |C_M #dscam003#3,  1, "N";  |C_V #dscam003#3,  1, "N";
      |C_P #dscam003#71, 1, 1069; |C_V #dscam003#71, 1, "S";
      |PINTA #dscam003#71;
   |SINO;
      |C_M #dscam003#3,  1, "S"; |C_V #dscam003#3,  1, "S";
      |C_V #dscam003#71, 1, "N"; |PINTA #dscam003#3;
   |FINSI;

   |HAZ EsMalpesa;
   |SI FSalida = 0;
      |DFICB aDirec; |QBF aDirec; |PATH_DAT #dscam044#aDirec#;
      |ABRE #dscam044;
      #dscam044#0 = #dscam003#46;
      |LEE 000#dscam044.=;
      |SI FSalida = 0;
         aDirec = #dscam044#1;
      |SINO;
         aDirec = #48#17;
      |FINSI;
      |QBF aDirec;
      |CIERRA #dscam044;

      aAlfa4 = aDirec + "def/malpe185.mas";
      |CARGA_DEF aAlfa4, inciden@;
      |SI FSalida = 0;
         nSwIncid = 0; nLinIncid = 2;
         aAlfa4 = aDirec + "fich/" + (("00000" + #dscam003#46) % -105) + "/";
         |PATH_DAT #inciden@#aAlfa4#;
         |ABRE #inciden@;
         #inciden@#0 = #dscam003#32;
         #inciden@#1 = #dscam003#91;
         #inciden@#2 = 0;
         |LEE 000#inciden@.];
         |PARA; |SI FSalida = 0; |Y #inciden@#0 = #dscam003#32; |Y #inciden@#1 = #dscam003#91; |HACIENDO;
            nSwIncid = 1; |SAL;
         |SIGUE;

         |SI nSwIncid = 1;
            |SI nBoton = -1;
               |CONTROL_SIMPLE 0, "BOTON, Incidencias obra", 0562, 0579, MalpeCom;
               nBoton = FSalida; |PULSATECLA;
            |FINSI;
         |SINO;
            |SI nBoton ! -1; |FIN_CONTROL_WINDOWS nBoton; nBoton = -1; |FINSI;
            |PULSATECLA;
         |FINSI;
         |CIERRA #inciden@; |DESCARGA_DEF #inciden@;
      |SINO;
         |SI nBoton ! -1; |FIN_CONTROL_WINDOWS nBoton; nBoton = -1; |FINSI;
         |PULSATECLA;
      |FINSI;
   |FINSI;

   |HAZ EsArtenvas;
   |SI FSalida = 0;
      |PINTA 2238, "Dias C.";
      |C_V #dscam003#105,1,"S";
   |SINO;
      |PINTA 2238, "       ";
      |C_V #dscam003#105,1,"N";
   |FINSI;

   Divisa = #dscam003#57; |HAZ TomaDecim;
   |SI #dscam003#99 = "01.01.0000"; #dscam003#99 = #dscam003#4; |FINSI;
   |PINDA #0#0;
   |CUADRO 05250550;

   |ATRI I; Comodin = " Recibo en " + #dscam003#58; |QBF Comodin;
   Comodin = Comodin + " "; |PINTA 0525, Comodin; |ATRI N;
   |HAZ PintaFechaVisita;

   #dscam055#0 = #dscam003#40;
   #dscam055#1 = 1;
   #dscam055#3 = 0;
   |LEE 000#dscam055.];
   |SI FSalida = 0; |Y #dscam055#0 = #dscam003#40; |Y #dscam055#3 = 0;
      |ATRI I; |PINTA 0703, "Con texto agrupado"; |ATRI N;
   |SINO;
      |ATRI I; |PINTA 0703, "                  "; |ATRI N;
   |FINSI;
   |SI #dscam003#90 = "S";
      |ATRI I; |PINTA 1937, " Preparado "; |ATRI N;
   |SINO;
      |PINTA 1937, "           ";
   |FINSI;

   |ATRI R;
   |SI #dscam003#69 ! " "; |O #dscam003#47 = "S";
      |PINTA 1850 , " Compensado       ";
   |SINO;
      |PINTA 1850 , " Desprecios       ";
   |FINSI;
   |ATRI N;

   |SI #dscam051#68 = "S";
      |SI #dscam003#4 ! #dscam003#99;
         |ATRI R; aAlfa = #dscam003#99;
         |PINTA 0969, aAlfa;
         |ATRI N;
      |FINSI;
   |FINSI;

   |HAZ OtrosCalculos;
|FPRC;

|PROCESO Busca;
   |SI FSalida = 10;
      PosLibro = 632;
      PosSerie = 641;
      PosFactu = 655;
      PosRecib = 669;
      |HAZ ConsultaVentas;
      |SI enDocum ! -1;
         #dscam003#40 = enDocum;
      |SINO;
         |MENAV "    Ficha inexistente"; |ERROR;
      |FINSI;
      SwClave = 1;
      NumClave = 1;
   |SINO;
      NumClave = 0;
   |FINSI;
|FPRC;

|RUTINA inf2;
   #dscam075#12 = #dscam004#17;
   #dscam075#13 = #dscam004#3;
   #dscam075#14 = "V";
   #dscam075#0 = 1;
|FRUT;

|RUTINA sup2;
   #dscam075#12 = #dscam004#17;
   #dscam075#13 = #dscam004#3;
   #dscam075#14 = "V";
   #dscam075#0 = 99;
|FRUT;

|RUTINA infw70;
   #dscaw070#0 = 00;
   #dscaw070#1 = "01.01.0000";
   #dscaw070#2 = 000000;
   #dscaw070#3 = 0000;
|FRUT;

|RUTINA supw70;
   #dscaw070#0 = 99;
   #dscaw070#1 = "31.12.9999";
   #dscaw070#2 = 999999;
   #dscaw070#3 = 9999;
|FRUT;

|PROCESO LineasAsto;
   #cacuen@#0 = #camasil@#4;
   #cacuen@#1 = #camasil@#5;
   |LEE 000#cacuen@.=;
   |SI FSalida ! 0; |DDEFECTO #cacuen@; |FINSI;

   #camadi@#0 = #camasil@#0;
   |LEE 000#camadi@.=;
   |SI FSalida ! 0; |DDEFECTO #camadi@; |FINSI;

   |DDEFECTO #dscaw070;
   #dscaw070#0 = #camasil@#0;
   #dscaw070#1 = #camasil@#1;
   #dscaw070#2 = #camasil@#2;
   #dscaw070#3 = #camasil@#3;
   |SI #camasil@#8 = "D";
      #dscaw070#4 = #camasil@#4;
      #dscaw070#5 = "";
   |SINO;
      #dscaw070#4 = "";
      #dscaw070#5 = #camasil@#4;
   |FINSI;
   #dscaw070#6  = #camasil@#6;
   #dscaw070#7  = #camasil@#7;
   #dscaw070#8  = #camasil@#9;
   #dscaw070#9  = #camadi@#1;
   #dscaw070#10 = #caempr@#2;
   #dscaw070#11 = #caempr@#3;
   #dscaw070#12 = #caempr@#1;
   #dscaw070#13 = #cacuen@#2;
   #dscaw070#14 = #camsic@#4;
   #dscaw070#15 = #camsic@#5;
   #dscaw070#16 = #cacuen@#53;
   |GRABA 020#dscaw070.n;
|FPRC;

|DEFBUCLE LineasAsto;
#camasil@#1004;
;
#camsic@#0, #camsic@#1, #camsic@#2, 0000;
#camsic@#0, #camsic@#1, #camsic@#2, 9999;
;
NULL,LineasAsto;
|FIN;

|PROCESO TablaMov; |TIPO 11;
   |SI FSalida = 10;
      |HAZ PintaTablas;
   |FINSI;
   |SI FSalida = 11;
      |SI #dscam004#5 ! "   ";
         |PUSHV 0849 2380;
         eaTipoRe = "V"; enDoc = #dscam004#17; enLin = #dscam004#3;
         |ENTLINEAL #1#dscam075, -4, 1, 13, 1, inf2, sup2;
         |POPV;
      |FINSI;
      |ERROR;
   |FINSI;
   |SI FSalida = 12;
      aAlfa = "co" + Usuario; |NOME_DAT #16 aAlfa;
      |DELINDEX #dscaw070; |ABRE #dscaw070;
      |ABRE #dscam067; |DDEFECTO #dscam067;
      aClv1 = "CB";
      aClv2 = #dscam004#17; aClv2 = (aClv2 + (" " * 50))% 0150;
      aClv3 = #dscam004#3;  aClv3 = (aClv3 + (" " * 50))% 0150;
      aClv4 = "";           aClv4 = (aClv4 + (" " * 50))% 0150;
      |SI #dscam004#5 = "REM";
         |ABRE #dscam013; |SELECT #2#dscam013;
         #dscam013#16 = #dscam004#17;
         #dscam013#17 = #dscam004#3;
         |LEE 000#dscam013.=;
         |SI FSalida ! 0;
            |MENAV "    No puedo encontrar el vinculo a la linea de remesa";
            |CIERRA #dscam013; |CIERRA #dscam067; |ERROR; |ACABA;
         |FINSI;
         |CIERRA #dscam013;
         aClv1 = "RM";
         aClv2 = #dscam013#0; aClv2 = (aClv2 + (" " * 50))% 0150;
         aClv3 = #dscam013#1; aClv3 = (aClv3 + (" " * 50))% 0150;
         aClv4 = "E"; aClv4 = (aClv4 + (" " * 50))% 0150;
         #dscam067#0 = aClv1;
         #dscam067#1 = aClv2;
         #dscam067#2 = aClv3;
         #dscam067#3 = aClv4;
         |LEE 000#dscam067.];
         |SI FSalida ! 0; |O #dscam067#0 ! aClv1;  |O #dscam067#1 ! aClv2;
          |O #dscam067#2 ! aClv3;  |O #dscam067#3 ! aClv4;
            aClv1 = "RM";
            aClv2 = #dscam013#0; aClv2 = (aClv2 + (" " * 50))% 0150;
            aClv3 = #dscam013#1; aClv3 = (aClv3 + (" " * 50))% 0150;
            aClv4 = "V"; aClv4 = (aClv4 + (" " * 50))% 0150;
         |FINSI;
      |FINSI;
      |SI #dscam004#5 = "EMR";
         |ABRE #dscam013; |SELECT #4#dscam013;
         #dscam013#16 = #dscam004#17;
         #dscam013#24 = #dscam004#3;
         |LEE 000#dscam013.=;
         |SI FSalida ! 0;
            |MENAV "    No puedo encontrar el vinculo a la linea de remesa";
            |CIERRA #dscam013; |CIERRA #dscam067; |ERROR; |ACABA;
         |FINSI;
         |CIERRA #dscam013;
         aClv1 = "RM";
         aClv2 = #dscam013#0; aClv2 = (aClv2 + (" " * 50))% 0150;
         aClv3 = #dscam013#1; aClv3 = (aClv3 + (" " * 50))% 0150;
         aClv4 = "I"; aClv4 = (aClv4 + (" " * 50))% 0150;
      |FINSI;
      |SI #dscam004#5 = "REC";
         aClv1 = "CB";
         aClv2 = #dscam004#16; |QBF aClv2; aClv2 = aClv2 % -109;
         aMovOrig = ("000000000" + #dscam004#17) % -109;
         |SALVA_FICHA #dscam004;
         #dscam004#17 = aClv2; aClv2 = #dscam004#17;
         #dscam004#3  = 1;
         |LEE 000#dscam004.];
         |PARA; |SI FSalida = 0; |Y #dscam004#17 = aClv2; |HACIENDO;
            |SI #dscam004#5 = "CAC";
               aAlfa = #dscam004#16; |QBF aAlfa;
               aAlfa = aAlfa - aMovOrig;
               |SI FSalida ! 0;
                  aClv3 = #dscam004#3; |SAL;
               |FINSI;
            |FINSI;
            |LEE 000#dscam004.s;
         |SIGUE;
         |REPON_FICHA #dscam004;
         aClv4 = " " * 50;
      |FINSI;
      nCalc5 = aClv2; aClv2 = nCalc5;
      aClv2 = (aClv2 + (" " * 50)) % 0150;
      aClv3 = (aClv3 + (" " * 50)) % 0150;
      #dscam067#0 = aClv1;
      #dscam067#1 = aClv2;
      #dscam067#2 = aClv3;
      #dscam067#3 = aClv4;
      |LEE 000#dscam067.];
      |SI FSalida ! 0; |O #dscam067#0 ! aClv1;  |O #dscam067#1 ! aClv2;
       |O #dscam067#2 ! aClv3;  |O #dscam067#3 ! aClv4;
         |HAZ EsViuda;
         |SI FSalida ! 0;
            |MENAV "    No se refleja que el movimiento haya sido enlazado a contabilidad";
            |CIERRA #dscam067; |CIERRA #dscaw070; |ERROR; |ACABA;
         |SINO;
            |SI #dscam004#5 = "COB"; |O #dscam004#5 = "PAG"; |Y #dscam004#57 = 1;
               |HAZ ConsAstoViuda;
               |SI enSwErr < 0;
                  |MENAV "    No se refleja que el movimiento haya sido enlazado a contabilidad";
                  |CIERRA #dscam067; |CIERRA #dscaw070; |ERROR; |ACABA;
               |FINSI;
            |SINO;
               |MENAV "    No se refleja que el movimiento haya sido enlazado a contabilidad";
               |CIERRA #dscam067; |CIERRA #dscaw070; |ERROR; |ACABA;
            |FINSI;
         |FINSI;
      |FINSI;
      |CIERRA #dscam067;

      aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "def/camaasic.mas";
      |CARGA_DEF aAlfa, camsic@;
      |SI FSalida ! 0;
         |MENAV "    No hay acceso a los datos contables. Compruebe el path de la ficha de empresas";
         |CIERRA #dscaw070; |ERROR; |ACABA;
      |FINSI;
      aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "def/camaasil.mas";
      |CARGA_DEF aAlfa, camasil@;
      aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "def/cacuenta.mas";
      |CARGA_DEF aAlfa, cacuen@;
      aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "def/camandia.mas";
      |CARGA_DEF aAlfa, camadi@;
      aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "def/canempre.mas";
      |CARGA_DEF aAlfa, caempr@;

      aAlfa = #48#16; |QBF aAlfa;
      aAlfa = aAlfa + "fich/" + (("00000" + #dscam067#8) % -105) + #dscam067#9 + "/";
      |PATH_DAT #100 aAlfa; |PATH_DAT #101 aAlfa;
      |PATH_DAT #102 aAlfa; |PATH_DAT #103 aAlfa;
      aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "fich/";
      |PATH_DAT #104 aAlfa;

      |ABRE #camsic@; |ABRE #camasil@; |ABRE #cacuen@;
      |ABRE #camadi@; |ABRE #caempr@;

      #caempr@#2 = #dscam067#8;
      #caempr@#3 = #dscam067#9;
      |LEE 000#caempr@.=;
      |SI FSalida ! 0;
         aAlfa = "    No encuentro la empresa contable. Empresa " + #dscam067#8 + ", Periodo " + #dscam067#9;
         |MENAV aAlfa;
         |CIERRA #caempr@; |DESCARGA_DEF #caempr@;
         |CIERRA #camadi@; |DESCARGA_DEF #camadi@;
         |CIERRA #cacuen@; |DESCARGA_DEF #cacuen@;
         |CIERRA #camasil@; |DESCARGA_DEF #camasil@;
         |CIERRA #camsic@; |DESCARGA_DEF #camsic@;
         |CIERRA #dscaw070;
         |ERROR; |ACABA;
      |FINSI;

      #camsic@#0 = #dscam067#4;
      #camsic@#1 = #dscam067#5;
      #camsic@#2 = #dscam067#6;
      |LEE 000#camsic@.=;
      |SI FSalida ! 0;
         aAlfa = "    No encuentro el asiento. Diario " + #dscam067#4 + ", Fecha " + #dscam067#5;
         aAlfa = aAlfa + ", documento " + #dscam067#6;
         |MENAV aAlfa;
         |CIERRA #caempr@; |DESCARGA_DEF #caempr@;
         |CIERRA #camadi@; |DESCARGA_DEF #camadi@;
         |CIERRA #cacuen@; |DESCARGA_DEF #cacuen@;
         |CIERRA #camasil@; |DESCARGA_DEF #camasil@;
         |CIERRA #camsic@; |DESCARGA_DEF #camsic@;
         |CIERRA #dscaw070;
         |ERROR; |ACABA;
      |FINSI;

      |BUCLE LineasAsto;

      |CIERRA #caempr@; |DESCARGA_DEF #caempr@;
      |CIERRA #camadi@; |DESCARGA_DEF #camadi@;
      |CIERRA #cacuen@; |DESCARGA_DEF #cacuen@;
      |CIERRA #camasil@; |DESCARGA_DEF #camasil@;
      |CIERRA #camsic@; |DESCARGA_DEF #camsic@;

      |PUSHV 1201 2380;
      |ENTLINEAL #1#dscaw070,-4,4,21,1,infw70,supw70;

      |POPV; |ERROR;
      |CIERRA #dscaw070;
   |FINSI;
|FPRC;

|PROCESO MiraCuenta;
   CodCliente = #dscam003#Campo#;
   DCampoC = 5; HCampoC = 5;
   |HAZ ExisteCliente;
   #dscam003#Campo# = CodCliente; |PINTA #dscam003#Campo#;
|FPRC;

|PROCESO MiraCodigo;
   CodCliente = #dscam003#Campo#;
   DCampoC = 32; HCampoC = 32;
   |HAZ ExisteCliente;
   #dscam003#Campo# = CodCliente; |PINTA #dscam003#Campo#;
|FPRC;

|PROCESO BorraLin;
   |BORRA 020#dscam004.a;
|FPRC;

|DEFBUCLE BorraLin;
#dscam004#1;
;
#dscam003#40,001;
#dscam003#40,999;
be;
NULL,BorraLin;
|FIN;

|PROCESO AntComprueba; |TIPO 7;
   |C_M #dscam003#12,0,aAlfa;
   ||SI aAlfa = "S";
   |SI #dscam051#47 = "S";
      eaFichClas = "dscam003"; eaTipoClas = #dscam003#12; |HAZ CompruebaClas;
      aAntClas = eaTipoClas;
      nAntTRec = #dscam003#12;
   |FINSI;
|FPRC;

|PROCESO DespComprueba;
   |SI FSalida = 2; |ACABA; |FINSI;

   |C_M #dscam003#12,0,aAlfa;
   ||SI aAlfa = "S";
   |SI #dscam051#47 = "S";
      eaFichClas = "dscam003"; eaTipoClas = #dscam003#12; |HAZ CompruebaClas;
      aDespClas = eaTipoClas;
      |SI aAntClas = aDespClas; |ACABA; |FINSI;

      nSwError = 1;

      |SI aAntClas = "C";
         |SI aDespClas = "R"; |O aDespClas = "F"; |O aDespClas = "P";
          |O aDespClas = "A"; |O aDespClas = "O";
            nSwError = 0;
            |SI aDespClas = "A"; #dscam003#28 = "S"; |PINTA #dscam003#28; |FINSI;
         |FINSI;
      |FINSI;
      |SI aAntClas = "F";
         |SI aDespClas = "C"; |O aDespClas = "P"; |O aDespClas = "A";
            |O aDespClas = "R";
            |SI #dscam003#90 = "N"; nSwError = 0; |FINSI;
            |SI aDespClas = "A"; #dscam003#28 = "S"; |PINTA #dscam003#28; |FINSI;
         |FINSI;
      |FINSI;
      |SI aAntClas = "R";
         |SI aDespClas = "C"; |O aDespClas = "P"; |O aDespClas = "A";
            |O aDespClas = "F";
            |SI #dscam003#90 = "N"; nSwError = 0; |FINSI;
            |SI aDespClas = "A"; #dscam003#28 = "S"; |PINTA #dscam003#28; |FINSI;
         |FINSI;
      |FINSI;
      |SI aAntClas = "P";
         |SI aDespClas = "C"; |O aDespClas = "R"; |O aDespClas = "F";
          |O aDespClas = "O"; |O aDespClas = "A";
            |SI #dscam003#14 = "I";
               nSwError = 0;
            |SINO;
               |SI #dscam003#70 = "          "; |Y #dscam003#72 = "    ";
                  nSwError = 0;
               |FINSI;
            |FINSI;
            |SI aDespClas = "A"; #dscam003#28 = "S"; |PINTA #dscam003#28; |FINSI;
         |FINSI;
      |FINSI;
      |SI aAntClas = "A";
         |SI aDespClas = "C"; |O aDespClas = "R"; |O aDespClas = "F";
          |O aDespClas = "O"; |O aDespClas = "P";
            |SI #dscam003#29 = "N"; nSwError = 0; |FINSI;
            #dscam003#28 = "N"; |PINTA #dscam003#28;
         |FINSI;
      |FINSI;
      |SI aAntClas = "O";
         |SI aDespClas = "C"; |O aDespClas = "R"; |O aDespClas = "F";
          |O aDespClas = "A"; |O aDespClas = "P";
            |SI #dscam003#97 = "N"; nSwError = 0; |FINSI;
            |SI aDespClas = "A"; #dscam003#28 = "S"; |PINTA #dscam003#28; |FINSI;
         |FINSI;
      |FINSI;

      |SI nSwError ! 0;
         |MENAV "    No es posible el cambio de tipo de recibo";
         |ERROR;
         #dscam003#12 = nAntTRec;
      |FINSI;
   |FINSI;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA "Recibos de venta";
   enSwClas = 1;

   |HAZ Tipo8;

   |SI enERP ! 0;
      |ABRE #dscam003;

      InPuntero = nPuntero1<-;
      |REFERENCIA_DEF nPuntero1, #0;
      |ESPECIFICA "X_POP_ERP", nPuntero;

      |LEE 000#dscam003.=;
      ||Divisa = #dscam003#59; |HAZ TomaDecim;

      |PINPA #0#0; |PINDA #0#0;
      |PUSHV 0501 2380;
      |ENTLINEAL #1#dscam004,-2,1,20,1,inf,sup;
      |POPV;
      |PAUSA;
      |CIERRA #dscam003;
      |HAZ Tipo9;
      |ACABA;
   |FINSI;

   |PINPA #0#0;
   |PINDA #0#0;

   |HAZ EsLuxe;
   |SI FSalida = 0;
      |CONTROL_SIMPLE 0, "BOTON,{{137}}Aplazamiento", 1269, 1279, BotonAplaza;
      nBoton2 = FSalida;

      |ESTADO_CONTROL nBoton2, "DISABLE";
   |FINSI;

   |ABRET #dscam003; |LEE 000#dscam003.p;
   |ABRET #dscam004; |LEE 000#dscam004.p;
   |ABRE #dscam051;
   |ABRE #dscam055;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;

   |SI #dscam051#68 = "S";
      |C_V #dscam003#4,1,"N";
      |C_M #dscam003#99,1,"S"; |C_V #dscam003#99,1,"S";
   |SINO;
      |C_V #dscam003#4,1,"S";
      |C_M #dscam003#99,1,"N"; |C_V #dscam003#99,1,"N";
   |FINSI;

   |DDEFECTO #dscam003;

|ET Clave;
   SwClave = 0;
   |HAZ PideClave;
   |SI SwError = 1;
      |SI nBoton2 ! -1; |FIN_CONTROL_WINDOWS nBoton2; nBoton2 = -1; |FINSI;
      |ACABA;
   |FINSI;

   |HAZ EsLuxe;
   |SI FSalida = 0;
      |ESTADO_CONTROL nBoton2, "ENABLE";
   |FINSI;

   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      enSwClas = 0; |HAZ MiraRegistro; enSwClas = 1;
      |SI eaFichClas = "ERROR";
         |MENAV "    Documento inoperable en el perfil actual ";
         |VETE Clave;
      |FINSI;
   |SINO;
      |SI PrimerReg = 1;
         PrimerReg = 0;
         |LEE 000#dscam003.p;
         |SI FSalida = 0;
            |HAZ MiraRegistro;
         |SINO;
            |MENAV "    Clave inexistente"; |VETE Clave;
         |FINSI;
      |SINO;
         |MENAV "    Clave inexistente"; |VETE Clave;
      |FINSI;
   |FINSI;

   Opcion = 1;
   |PARA; |SI Salir = 0; |HACIENDO;
      |HAZ MenuOpciones;
      |SI Opcion < 1; |SAL; |FINSI;

      |SI Opcion = 1; |VETE Clave; |FINSI;   ||CLAVE
      |SI Opcion = 2;                || SIGUIENTE
         |SI NumClave = 1; |SELECT #9#dscam003; |LEE 000#dscam003.=; |FINSI;
         |ET Siguiente;
         |LEE 000#dscam003.s;
         |SI FSalida ! 0; |MENAV "    Ultima ficha"; |FINSI;
         enSwClas = 0; |HAZ MiraRegistro; enSwClas = 1;
         |SI NumClave = 1; |SELECT #1#dscam003; |FINSI;
      |FINSI;
      |SI Opcion = 3;                || ANTERIOR
         |LIBERA #dscam003;
         |SI NumClave = 1; |SELECT #9#dscam003; |LEE 000#dscam003.=; |FINSI;
         |ET Anterior;
         |LEE 000#dscam003.a;
         |SI FSalida ! 0;
            |MENAV "    Primera ficha";
         |FINSI;
         enSwClas = 0; |HAZ MiraRegistro; enSwClas = 1;
         |SI NumClave = 1; |SELECT #1#dscam003; |FINSI;
      |FINSI;
      |SI Opcion = 4;                || PRIMERO
         |LIBERA #dscam003;
         |SI NumClave = 1; |SELECT #9#dscam003; |LEE 000#dscam003.=; |FINSI;
         |LEE 000#dscam003.p;
         enSwClas = 0; |HAZ MiraRegistro; enSwClas = 1;
         |SI NumClave = 1; |SELECT #1#dscam003; |FINSI;
      |FINSI;
      |SI Opcion = 5;                || ULTIMO
         |SI NumClave = 1; |SELECT #9#dscam003; |LEE 000#dscam003.=; |FINSI;
         |LEE 000#dscam003.u;
         enSwClas = 0; |HAZ MiraRegistro; enSwClas = 1;
         |SI NumClave = 1; |SELECT #1#dscam003; |FINSI;
      |FINSI;
      |SI Opcion = 6;                || MODIFICAR
         enSwClas = 1; |HAZ MiraRegistro;
         |SI eaFichClas = "ERROR";
            |MENAV "    Documento inoperable en el perfil actual ";
         |SINO;
            |LEE 101#dscam003.=;
            fAntVto = #dscam003#3;
            |SI #dscam003#99 = "01.01.0000"; #dscam003#99 = #dscam003#4; |FINSI;
            Comodin = "|NC";
            Campos = #dscam003#Comodin# - 1;
            |PARA Cont = 0; |SI Cont [ Campos; |HACIENDO Cont = Cont + 1;
               |C_M #dscam003#Cont#,1,"N";
            |SIGUE;

            |HAZ EsArtenvas;
            |SI FSalida ! 0;
               |SI #dscam051#39 = "S"; |C_M #dscam003#3,1,"S"; |FINSI;
            |FINSI;
            |SI #dscam051#68 = "S";
               |C_M #dscam003#99,1,"S"; |C_V #dscam003#99,1,"S";
            |SINO;
               |C_M #dscam003#99,1,"N"; |C_V #dscam003#99,1,"N";
            |FINSI;

            nCodSitAnt = #dscam003#35; aDesSitAnt = #dscam003#36;

            |C_M #dscam003#8,1,"S";  |C_M #dscam003#9,1,"S";
            |C_M #dscam003#11,1,"S";
            ||SI #dscam051#47 = "S";  || Abdon Tiquet 002264/01129
               |SI #dscam003#14 ! "L"; |Y #dscam003#14 ! "A"; |Y #dscam003#14 ! "D";
                  |C_M #dscam003#12,1,"S";
               |SINO;
                  |C_M #dscam003#12,1,"N";
               |FINSI;
            ||SINO;
               ||C_M #dscam003#12,1,"N";
            ||FINSI;
            |C_M #dscam003#51,1,"S"; |C_M #dscam003#35,1,"S";
            |C_M #dscam003#13,1,"S"; |C_M #dscam003#28,1,"S";
            |C_M #dscam003#29,1,"S"; |C_M #dscam003#33,1,"S";
            |C_M #dscam003#39,1,"S"; |C_M #dscam003#75,1,"S";
            |C_M #dscam003#76,1,"S"; |C_M #dscam003#40,1,"S";
            |SI #dscam003#46 ! 0;
               |C_M #dscam003#5,1,"S";
            |SINO;
               |C_M #dscam003#5,1,"N";
            |FINSI;
            |ENDATOS #2#dscam003;
            |SI FSalida = 0;
               eaUsuario = Usuario % 0810;
               eaTipoReg = "CB";  eaNumero = ("000000000" + #dscam003#40) % -109;
               eaDescr   = "MODIFICACION RECIBO (" + (("000000000" + #dscam003#40) % -109);
               eaDescr   = eaDescr + ") DESDE MANTENIMIENTO DE RECIBOS";
               eaTipoOp  = "M"; enImpAnt = #dscam003#30; enImpAct = #dscam003#30;
               eaFicher = "dscam003"; eaClave = #dscam003#40;
               |HAZ GrabaAudit;
               |SI fAntVto ! #dscam003#3; |Y #dscam051#39 = "S"; |HAZ CambiaVto; |FINSI;
               |SI #dscam003#35 ! nCodSitAnt;
                  |ABRE #dscam164;
                  |DDEFECTO #dscam164;
                  #dscam164#0 = #dscam003#40;
                  #dscam164#1 = ~;
                  |HORA aAlfa; #dscam164#2 = aAlfa;
                  #dscam164#3 = nCodSitAnt;
                  #dscam164#4 = aDesSitAnt;
                  #dscam164#5 = #dscam003#35;
                  #dscam164#6 = #dscam003#36;
                  #dscam164#7 = Usuario % 0810;
                  |GRABA 020#dscam164.n;
                  |CIERRA #dscam164;
                  aAlfa = #dscam003#36; aAlfa = aAlfa % 0120;
                  aAlfa = aAlfa + #dscam164#1;
                  #dscam003#36 = aAlfa; |PINTA #dscam003#36;
               |FINSI;
               |GRABA 020#dscam003.a;
            |FINSI;
            |LIBERA #dscam003;
         |FINSI;
      |FINSI;
      |SI Opcion = 7;                || IMPRIMIR
         enSwClas = 1; |HAZ MiraRegistro;
         |SI eaFichClas = "ERROR";
            |MENAV "    Documento inoperable en el perfil actual ";
         |SINO;
            |ABRE #dscam058;
            Comodin = ("00" + #dscam003#12) % -102;
            #dscam058#0 = Comodin;
            |LEE 000#dscam058.=;
            |CIERRA #dscam058;

            |IMPRE 0;
            |SI FSalida = 0;
               |SI #dscam003#57 = "EUR"; EURODB = 2; |SINO; EURODB = 0; |FINSI;
               |SI EURODB = 2;
                  EURO = 166.386;     EURODV = 0;
               |SINO;
                  EURO = 1 / 166.386; EURODV = 2;
               |FINSI;
               #dscam003#86 = #dscam003#30;
               Comodin = #dscam058#2;
               |INFOR Comodin;
               |SI FSalida = 0;
                  DirCliente = ""; Cp = ""; PobCliente = ""; ProvCliente = ""; TelCliente = "";
                  eaCodigo = #dscam003#32; eaTipoCod = "C"; aCuenta = #dscam003#5; |HAZ LeeDatos;
                  DirCliente = eaDireccion;
                  Cp = eaCP;
                  PobCliente = eaPoblacion;
                  ProvCliente = eaProvincia;
                  TelCliente = eaTelefono;
                  |SI HayGestion ! 0; enNume1 = #agif024@#167; |FINSI;
                  |PRINT; |PIEINF;
               |FINSI;
               |FININF;
               |SI Impresora ! "CrystalReport";
                  nCuenta = 1; |HAZ AjusteHoja;
               |FINSI;
               |FINIMP;
            |FINSI;

            eaUsuario = Usuario % 0810;
            eaTipoReg = "CB";  eaNumero = ("000000000" + #dscam003#40) % -109;
            eaDescr   = "EMISION RECIBO (" + (("000000000" + #dscam003#40) % -109);
            eaDescr   = eaDescr + ") DESDE MANTENIMIENTO DE RECIBOS";
            eaTipoOp  = "E"; enImpAnt = #dscam003#30; enImpAct = #dscam003#30;
            eaFicher = "dscam003"; eaClave = #dscam003#40;
            |HAZ GrabaAudit;
            #dscam003#48 = "S"; |GRABA 020#dscam003.a;
         |FINSI;
      |FINSI;
      |SI Opcion = 8;                || LINEAL DE COBROS
         enSwClas = 1; |HAZ MiraRegistro;
         |SI eaFichClas = "ERROR";
            |MENAV "    Documento inoperable en el perfil actual ";
         |SINO;
            |LEE 101#dscam003.=;
            UltCobro = 1;
            UltFecCo = "00.00.0000";
            #dscam004#17 = #dscam003#40;
            #dscam004#3 = 1;
            |LEE 000#dscam004.];
            |PARA; |SI FSalida = 0; |HACIENDO;
               |SI #dscam004#17 = #dscam003#40;
                  UltCobro = #dscam004#3;
                  UltFecCo = #dscam004#6;
                  |LEE 000#dscam004.s;
               |SINO;
                  |SAL;
               |FINSI;
            |SIGUE;
            |PUSHV 05012380;
            |ENTLINEAL #1#dscam004,-2,1,20,1,inf,sup;
            |POPV;
            |PINDA #0#dscam003;
            |GRABA 020#dscam003.a;
            ||LIBERA #dscam003;
            |SI #dscam051#104 = "S"; |Y #dscam003#72 ! "    ";
               |C_M #dscam003#3,  1, "N";  |C_V #dscam003#3,  1, "N";
               |C_P #dscam003#71, 1, 1069; |C_V #dscam003#71, 1, "S";
               |PINTA #dscam003#71;
            |SINO;
               |C_M #dscam003#3,  1, "S"; |C_V #dscam003#3,  1, "S";
               |C_V #dscam003#71, 1, "N"; |PINTA #dscam003#3;
            |FINSI;

            |ATRI I; Comodin = " Recibo en " + #dscam003#58; |QBF Comodin;
            Comodin = Comodin + " "; |PINTA 0525, Comodin; |ATRI N;
            |SI #dscam003#90 = "S";
               |ATRI I; |PINTA 1937, " Preparado "; |ATRI N;
            |SINO;
               |PINTA 1937, "           ";
            |FINSI;
            #dscam055#0 = #dscam003#40;
            #dscam055#1 = 1;
            #dscam055#3 = 0;
            |LEE 000#dscam055.];
            |SI FSalida = 0; |Y #dscam055#0 = #dscam003#40; |Y #dscam055#3 = 0;
               |ATRI I; |PINTA 0703, "Con texto agrupado"; |ATRI N;
            |SINO;
               |ATRI I; |PINTA 0703, "                  "; |ATRI N;
            |FINSI;
            |LIBERA #dscam003;
            |HAZ OtrosCalculos;
         |FINSI;
      |FINSI;
      |SI Opcion = 9;                || TEXTO ANEXO
         enSwClas = 1; |HAZ MiraRegistro;
         |SI eaFichClas = "ERROR";
            |MENAV "    Documento inoperable en el perfil actual ";
         |SINO;
            Comodin = #dscam003#40; |QBF Comodin; Comodin = Comodin + "/000";
            Comodin = "dscaz030;" + Comodin;
            |SUB_EJECUTA_NP Comodin;
         |FINSI;
      |FINSI;
      |SI Opcion = 10;               || MONEDA
         |SI Moneda = DIV;
            Moneda = BASE;
            |ATRI I; |PINTA 0555 , " Importes en moneda base "; |ATRI N;
            |C_V #dscam004#7,1,"N";  |C_V #dscam004#25,1,"S";
            |C_V #dscam004#8,1,"N";  |C_V #dscam004#26,1,"S";
            |C_V #dscam004#9,1,"N";  |C_V #dscam004#27,1,"S";
            |C_V #dscam004#12,1,"N"; |C_V #dscam004#29,1,"S";
            |C_V #dscam004#13,1,"N"; |C_V #dscam004#30,1,"S";
            |C_V #dscam004#14,1,"N"; |C_V #dscam004#31,1,"S";
            |C_V #dscam004#23,1,"N"; |C_V #dscam004#32,1,"S";
            |C_V #dscam004#24,1,"S";

            |C_V #dscam003#22,1,"N"; |C_V #dscam003#60,1,"S";
            |C_V #dscam003#24,1,"N"; |C_V #dscam003#62,1,"S";
            |C_V #dscam003#25,1,"N"; |C_V #dscam003#63,1,"S";
            |C_V #dscam003#38,1,"N"; |C_V #dscam003#66,1,"S";
            |C_V #dscam003#54,1,"N"; |C_V #dscam003#67,1,"S";
            |C_V #dscam003#55,1,"N"; |C_V #dscam003#68,1,"S";
            |C_V #dscam003#30,1,"N"; |C_V #dscam003#64,1,"S";
            |C_V #dscam003#23,1,"N"; |C_V #dscam003#61,1,"S";
            |C_V #dscam003#31,1,"N"; |C_V #dscam003#65,1,"S";
            |ATRI R; |PINTA 1950," Dif.Cambio       "; |ATRI N;
            |C_V #dscam003#56,1,"S";
            |PINDA #0#dscam003;
         |SINO;
            Moneda = DIV;
            |CUADRO 05550579;

            |C_V #dscam004#7,1,"S";  |C_V #dscam004#25,1,"N";
            |C_V #dscam004#8,1,"S";  |C_V #dscam004#26,1,"N";
            |C_V #dscam004#9,1,"S";  |C_V #dscam004#27,1,"N";
            |C_V #dscam004#12,1,"S"; |C_V #dscam004#29,1,"N";
            |C_V #dscam004#13,1,"S"; |C_V #dscam004#30,1,"N";
            |C_V #dscam004#14,1,"S"; |C_V #dscam004#31,1,"N";
            |C_V #dscam004#23,1,"S"; |C_V #dscam004#32,1,"N";
            |C_V #dscam004#24,1,"N";

            |C_V #dscam003#22,1,"S"; |C_V #dscam003#60,1,"N";
            |C_V #dscam003#24,1,"S"; |C_V #dscam003#62,1,"N";
            |C_V #dscam003#25,1,"S"; |C_V #dscam003#63,1,"N";
            |C_V #dscam003#38,1,"S"; |C_V #dscam003#66,1,"N";
            |C_V #dscam003#54,1,"S"; |C_V #dscam003#67,1,"N";
            |C_V #dscam003#55,1,"S"; |C_V #dscam003#68,1,"N";
            |C_V #dscam003#30,1,"S"; |C_V #dscam003#64,1,"N";
            |C_V #dscam003#23,1,"S"; |C_V #dscam003#61,1,"N";
            |C_V #dscam003#31,1,"S"; |C_V #dscam003#65,1,"N";
            |ATRI R; |PINTA 1950,"                   "; |ATRI N;
            |PINTA 1968,"            ";
            |C_V #dscam003#56,1,"N";
            |PINDA #0#dscam003;
         |FINSI;
         |SI #dscam003#90 = "S";
            |ATRI I; |PINTA 1937, " Preparado "; |ATRI N;
         |FINSI;
         |HAZ OtrosCalculos;
      |FINSI;
      |SI Opcion = 11;               || TRAZABILIDAD
         enSwClas = 1; |HAZ MiraRegistro;
         |SI eaFichClas = "ERROR";
            |MENAV "    Documento inoperable en el perfil actual ";
         |SINO;
            |HAZ Trazabilidad;
         |FINSI;
      |FINSI;

      ||SI Opcion = 12;               || LINEAL DE AGRUPADOS
      |SI eaOpcMenu = "G";               || LINEAL DE AGRUPADOS
         enSwClas = 1; |HAZ MiraRegistro;
         |SI eaFichClas = "ERROR";
            |MENAV "    Documento inoperable en el perfil actual ";
         |SINO;
            |LEE 101#dscam003.=;
            |PUSHV 1402 2248;
            enDocumento = #dscam003#40;
            Documento = #dscam003#40;

            |SALVA_FICHA #dscam003;
            |HAZ BucleAgrupados;
            |REPON_FICHA #dscam003;
            |ENTLINEAL #1#dscam025,-1,4,21,1,inf1,sup1;
            |POPV;
            |LIBERA #dscam003;
         |FINSI;
      |FINSI;
      ||SI Opcion = 13;               || LINEAL DE DIVISIONES
      |SI eaOpcMenu = "D";               || LINEAL DE DIVISIONES
         enSwClas = 1; |HAZ MiraRegistro;
         |SI eaFichClas = "ERROR";
            |MENAV "    Documento inoperable en el perfil actual ";
         |SINO;
            |LEE 101#dscam003.=;
            |PUSHV 1402 2248;
            enDocumento = #dscam003#40;
            Documento = #dscam003#40;

            |SALVA_FICHA #dscam003;
            |HAZ BucleDivididos;
            |REPON_FICHA #dscam003;

            |ENTLINEAL #1#dscam025,-1,4,21,1,inf1,sup1;
            |POPV;
            |LIBERA #dscam003;
         |FINSI;
      |FINSI;
      ||SI Opcion = 14;                 || CARTA AGRUPACION
      |SI eaOpcMenu = "g";               || CARTA AGRUPACION
         |HAZ SacaCarta;
      |FINSI;
      ||SI Opcion = 15;               || CARTA DIVISION
      |SI eaOpcMenu = "d";               || CARTA DIVISION
         |HAZ SacaCarta;
      |FINSI;
      ||SI Opcion = 16;               || LINEAL DE LIQUIDACIONES
      |SI eaOpcMenu = "Q";               || LINEAL DE LIQUIDACIONES
         |HAZ LinLiquidaciones;
      |FINSI;
      |SI eaOpcMenu = "N";               || Historico cambio de situaciones
         |HAZ HistCambioSit;
      |FINSI;
      |SI eaOpcMenu = "V";               || Vto.Original
         |HAZ VtoOriginal;
      |FINSI;

      |LIBERA #dscam003;
   |SIGUE;

   |SI nBoton ! -1; |FIN_CONTROL_WINDOWS nBoton; nBoton = -1; |FINSI;
   |CIERRA #dscam055;
   |CIERRA #dscam051;
   |CIERRAT #dscam003;
   |CIERRAT #dscam004;

   |SI nBoton2 ! -1; |FIN_CONTROL_WINDOWS nBoton2; nBoton2 = -1; |FINSI;

   |HAZ Tipo9;
|FPRO;

|PROCESO BloquCampos;
   nModo = (FEntrada / 100) ! 0;
   |SI nModo ! 1; |ACABA; |FINSI;

   |SI #dscam004#5 ! "PRE"; |Y #dscam004#5 ! "COB"; |Y #dscam004#5 ! "COP";
    |Y #dscam004#5 ! "IMP"; |Y #dscam004#5 ! "ENV"; |Y #dscam004#5 ! "ACE";
    |Y #dscam004#5 ! "RFC"; |Y #dscam004#5 ! "PRC"; |Y #dscam004#5 ! "PRA";
    |Y #dscam004#5 ! "RCE"; |Y #dscam004#5 ! "RCA";
    |Y #dscam004#5 ! "RPT"; |Y #dscam004#5 ! "RTA"; |Y #dscam004#5 ! "CFR";
      |MENAV "    El movimiento indicado no existe o no se puede dar de alta manualmente ";
      |ERROR; |ACABA;
   |FINSI;

   |SI #dscam004#5 = "IMP";
      |SI #dscam003#17 = 0; |O #dscam003#14 ! "L";
         |MENAV "    El recibo no ha sido negociado con el banco";
         |ERROR; |ACABA;
      |FINSI;
      |C_M #dscam004#8,1,"N";  |C_M #dscam004#9,1,"S";
      |C_M #dscam004#12,1,"S"; |C_M #dscam004#13,1,"S";
      |C_M #dscam004#14,1,"S"; |C_M #dscam004#23,1,"S";
   |FINSI;

   |SI #dscam004#5 = "PRC";
      |SI #dscam003#17 = 0; |O #dscam003#14 ! "L";
         |MENAV "    El recibo no pertenece a una remesa o esta no esta abonada";
         |ERROR; |ACABA;
      |FINSI;
      |SI #dscam003#98 = "S";
         |MENAV "    El recibo ya tiene peticion de reclamacion";
         |ERROR; |ACABA;
      |FINSI;
      |C_M #dscam004#8,1,"N";  |C_M #dscam004#9,1,"N";
      |C_M #dscam004#12,1,"N"; |C_M #dscam004#13,1,"N";
      |C_M #dscam004#14,1,"N"; |C_M #dscam004#23,1,"N";
   |FINSI;
   |SI #dscam004#5 = "PRA";
      |SI #dscam003#17 = 0;
         |MENAV "    El recibo no pertenece a una remesa";
         |ERROR; |ACABA;
      |FINSI;
      |SI #dscam003#98 = "S";
         |MENAV "    El recibo ya tiene peticion de reclamacion";
         |ERROR; |ACABA;
      |FINSI;
      |C_M #dscam004#8,1,"N";  |C_M #dscam004#9,1,"N";
      |C_M #dscam004#12,1,"N"; |C_M #dscam004#13,1,"N";
      |C_M #dscam004#14,1,"N"; |C_M #dscam004#23,1,"N";
   |FINSI;

   |SI #dscam004#5 = "RCE";
      |SALVA_FICHA #dscam004;
      |LEE 000#dscam004.a;
      |SI #dscam004#5 ! "PRC"
         |MENAV "    El recibo no tiene peticion de reclamacion";
         |REPON_FICHA #dscam004;
         |ERROR; |ACABA;
      |FINSI;
      |REPON_FICHA #dscam004;
      |SI #dscam003#14 ! "P";
         |MENAV "    El recibo no est  pendiente despues de la reclamacion";
         |ERROR; |ACABA;
      |FINSI;
      |C_M #dscam004#8,1,"N";  |C_M #dscam004#9,1,"N";
      |C_M #dscam004#12,1,"N"; |C_M #dscam004#13,1,"N";
      |C_M #dscam004#14,1,"N"; |C_M #dscam004#23,1,"N";
      |C_M #dscam004#26,1,"N"; |C_M #dscam004#27,1,"N";
      |C_M #dscam004#29,1,"N"; |C_M #dscam004#30,1,"N";
      |C_M #dscam004#31,1,"N"; |C_M #dscam004#32,1,"N";
   |FINSI;

   |SI #dscam004#5 = "RCA";
      |SALVA_FICHA #dscam004;
      |LEE 000#dscam004.a;
      |SI #dscam004#5 ! "PRA"
         |MENAV "    El recibo no tiene peticion de reclamacion";
         |REPON_FICHA #dscam004;
         |ERROR; |ACABA;
      |FINSI;
      |REPON_FICHA #dscam004;
      |SI #dscam003#14 ! "P";
         |MENAV "    El recibo no est  pendiente despues de la reclamacion";
         |ERROR; |ACABA;
      |FINSI;
      |C_M #dscam004#8,1,"N";  |C_M #dscam004#9,1,"N";
      |C_M #dscam004#12,1,"N"; |C_M #dscam004#13,1,"N";
      |C_M #dscam004#14,1,"N"; |C_M #dscam004#23,1,"N";
      |C_M #dscam004#26,1,"N"; |C_M #dscam004#27,1,"N";
      |C_M #dscam004#29,1,"N"; |C_M #dscam004#30,1,"N";
      |C_M #dscam004#31,1,"N"; |C_M #dscam004#32,1,"N";
   |FINSI;

   |C_M #dscam004#7,1,"N"; |C_M #dscam004#16,1,"S";
   |SI #dscam004#5 = "PRE";
      |SI #dscam003#14 ! "P";
         |MENAV "    El recibo no esta pendiente";
         |ERROR; |ACABA;
      |FINSI;
      aClasif = "R"; |HAZ MiraClasif;
      |SI eaResult = "ERROR"; |ERROR; |ACABA; |FINSI;
      |SI #dscam003#12 ! nTipoRec;
         #dscam003#12 = nTipoRec; |GRABA 020#dscam003.a;
      |FINSI;

      |C_M #dscam004#8,1,"N";  |C_M #dscam004#9,1,"N";
      |C_M #dscam004#12,1,"N"; |C_M #dscam004#13,1,"N";
      |C_M #dscam004#14,1,"N"; |C_M #dscam004#23,1,"N";
   |FINSI;
   |SI #dscam004#5 = "RTA";
      |SI #dscam003#70 = "          "; |Y #dscam003#72 = "    ";
         |MENAV "    El recibo no forma parte de un talon/pagare";
         |ERROR; |ACABA;
      |FINSI;
      |C_M #dscam004#8 ,1,"N"; |C_M #dscam004#9 ,1,"N";
      |C_M #dscam004#12,1,"N"; |C_M #dscam004#13,1,"N";
      |C_M #dscam004#14,1,"N"; |C_M #dscam004#23,1,"N";
      |C_M #dscam004#16,1,"N";
      |C_M #dscam004#4 ,1,"S"; |C_M #dscam004#6 ,1,"S";
   |FINSI;
   |SI #dscam004#5 = "RPT"; |O #dscam004#5 = "CFR";
      |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "C"; |Y #dscam003#14 ! "F";
         |MENAV "    El recibo no esta pendiente";
         |ERROR; |ACABA;
      |FINSI;
      aClasif = "P"; |HAZ MiraClasif;
      |SI eaResult = "ERROR"; |ERROR; |ACABA; |FINSI;
      |SI #dscam003#12 ! nTipoRec;
         #dscam003#12 = nTipoRec; |GRABA 020#dscam003.a;
      |FINSI;

      |PUSHV 0501 2380;
      |BLANCO 1719 2061;
      |CUADRO 1820 2060;
      |SI #dscam004#5 = "RPT";
         |ATRI R; |PINTA 1821, " Introduzca los datos del pagare/talon "; |ATRI N;
      |SINO;
         |ATRI R; |PINTA 1821, " Introduzca datos del cobro confirmado "; |ATRI N;
      |FINSI;
      |PINTA 1922, " Entidad       Numero           ";

      |PINTA 1931, #dscam003#72;  |PINTA 1944, #dscam003#70;

      |ABRE #dscam001;
      |ET OtraEntidad;
      |MENSA "    <F2> Consulta de entidades ";
      E_sup  = 4; E_inf  = "";
      aEntidad = 1931 ? 1;
      |SI FSalida = 0;
         |QBF aEntidad;
         aLong = aEntidad % 0; nLong = aLong;
         #dscam001#0 = aEntidad;
         |LEE 000#dscam001.=;
         |SI FSalida = 0;
            |PINTA 1931, #dscam001#0;
         |SINO;
            |MENAV "    Entidad inexistente";
            |VETE OtraEntidad;
         |FINSI;
      |SINO;
         |SI FSalida = 10;
            #dscam001#0 = aEntidad;
            |LEE 000#dscam001.];
            |CONSULTA_CLAVE #1#dscam001;
            |SI FSalida = 0;
               aEntidad = #dscam001#0; |PINTA 1931, #dscam001#0;
            |FINSI;
            |VETE OtraEntidad;
         |SINO;
            |CIERRA #dscam001; |POPV;
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;
      |MENSA "     ";

      E_sup = 10; E_inf = "";
      aNumPag = 1944 ? 1;
      |SI FSalida ! 0;
         |SI FSalida = 2;
            |VETE OtraEntidad;
         |SINO;
            |CIERRA #dscam001; |POPV;
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;

      |C_M #dscam004#8 ,1,"N"; |C_M #dscam004#9 ,1,"N";
      |C_M #dscam004#12,1,"N"; |C_M #dscam004#13,1,"N";
      |C_M #dscam004#14,1,"N"; |C_M #dscam004#23,1,"N";
      |C_M #dscam004#4 ,1,"S"; |C_M #dscam004#6 ,1,"S";
      |C_M #dscam004#16,1,"S";

      aCodCli = #dscam003#32; aCtaCli = #dscam003#5;
      |SALVA_FICHA #dscam003;
      |SELECT #7#dscam003;
      #dscam003#72 = aEntidad;
      #dscam003#70 = aNumPag;
      #dscam003#40 = 1;
      |LEE 000#dscam003.];
      |SI FSalida = 0; |Y #dscam003#72 = aEntidad; |Y #dscam003#70 = aNumPag;
         nSwErr = 0;
         |SI #dscam051#33 = "N";
            |SI #dscam003#32 ! "      ";
               |SI #dscam003#32 ! aCodCli;
                  |MENAV "    El documento no se puede incorporar al pagare por ser de clientes distintos";
                  |ERROR; nSwErr = 1;
               |FINSI;
            |FINSI;
            |SI #dscam003#5 ! "            ";
               |SI #dscam003#5 ! aCtaCli;
                  |MENAV "    El documento no se puede incorporar al pagare por ser de clientes distintos";
                  |ERROR; nSwErr = 1;
               |FINSI;
            |FINSI;
         |FINSI;
         |SI nSwErr = 0;
            |SI #dscam004#5 = "RPT";
               |CONFI "    NEl pagare indicado ya existe. Desea a¤adir el recibo a este documento ?";
               |SI FSalida = 0;
                  nImpD = #dscam003#78;   nImpB = #dscam003#79;
                  fFecPag = #dscam003#71; aObsPag = #dscam003#73;
                  aCtaPag = #dscam003#74;

                  #dscam004#4 = aCtaPag; #dscam004#6 = fFecPag; #dscam004#16 = aObsPag;
                  |C_M #dscam004#4 ,1,"N"; |C_M #dscam004#6 ,1,"N"; |C_M #dscam004#16,1,"N";
               |SINO;
                  nImpD = 0; nImpB = 0;
                  fFecPag = "00.00.0000"; aObsPag = "";
                  aCtaPag = "";
                  |SELECT #1#dscam003;
                  |REPON_FICHA #dscam003; |VETE OtraEntidad;
               |FINSI;
            |SINO;
               |MENAV "    NEl cobro confirmado indicado ya existe.";
               |ERROR; nSwErr = 1;
            |FINSI;
         |FINSI;
      |FINSI;
      |SELECT #1#dscam003;
      |REPON_FICHA #dscam003;

      |CIERRA #dscam001; |POPV;
      |PINTA #dscam004#4; |PINTA #dscam004#6; |PINTA #dscam004#16;
   |FINSI;
   |SI #dscam004#5 = "RCF";
      |SI #dscam003#14 ! "P";
         |MENAV "    El recibo no esta pendiente";
         |ERROR; |ACABA;
      |FINSI;
      aClasif = "O"; |HAZ MiraClasif;
      |SI eaResult = "ERROR"; |ERROR; |ACABA; |FINSI;
      |SI #dscam003#12 ! nTipoRec;
         #dscam003#12 = nTipoRec; |GRABA 020#dscam003.a;
      |FINSI;
      |C_M #dscam004#8,1,"N";  |C_M #dscam004#9,1,"N";
      |C_M #dscam004#12,1,"N"; |C_M #dscam004#13,1,"N";
      |C_M #dscam004#14,1,"N"; |C_M #dscam004#23,1,"N";
   |FINSI;
   |SI #dscam004#5 = "ENV";
      |SI #dscam003#14 ! "P";
         |MENAV "    El recibo no esta pendiente";
         |ERROR; |ACABA;
      |FINSI;
      aClasif = "A"; |HAZ MiraClasif;
      |SI eaResult = "ERROR"; |ERROR; |ACABA; |FINSI;
      |SI #dscam003#12 ! nTipoRec;
         #dscam003#12 = nTipoRec; |GRABA 020#dscam003.a;
      |FINSI;
      |C_M #dscam004#8,1,"N";  |C_M #dscam004#9,1,"N";
      |C_M #dscam004#12,1,"N"; |C_M #dscam004#13,1,"N";
      |C_M #dscam004#14,1,"N"; |C_M #dscam004#23,1,"N";
   |FINSI;
   |SI #dscam004#5 = "ACE";
      |SI #dscam003#14 ! "P";
         |MENAV "    El recibo no esta pendiente";
         |ERROR; |ACABA;
      |FINSI;
      |SI #dscam003#14 ! "V";
         |MENAV "    El recibo no ha sido enviado para su aceptado";
         |ERROR; |ACABA;
      |FINSI;
      aClasif = "A"; |HAZ MiraClasif;
      |SI eaResult = "ERROR"; |ERROR; |ACABA; |FINSI;
      |SI #dscam003#12 ! nTipoRec;
         #dscam003#12 = nTipoRec; |GRABA 020#dscam003.a;
      |FINSI;
      |C_M #dscam004#8,1,"N";  |C_M #dscam004#9,1,"N";
      |C_M #dscam004#12,1,"N"; |C_M #dscam004#13,1,"N";
      |C_M #dscam004#14,1,"N"; |C_M #dscam004#23,1,"N";
   |FINSI;
   |SI #dscam004#5 = "COB"; |O #dscam004#5 = "COP";
      |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "C"; |Y #dscam003#14 ! "F";
       |Y #dscam003#14 ! "I";
         |MENAV "    El recibo no esta pendiente";
         |ERROR; |ACABA;
      |FINSI;
      aClasif = "C"; |HAZ MiraClasif;
      |SI eaResult = "ERROR"; |ERROR; |ACABA; |FINSI;
      |SI #dscam003#12 ! nTipoRec;
         #dscam003#12 = nTipoRec; |GRABA 020#dscam003.a;
      |FINSI;
      |C_M #dscam004#8,1,"S";  |C_M #dscam004#9,1,"N";
      |C_M #dscam004#12,1,"N"; |C_M #dscam004#13,1,"N";
      |C_M #dscam004#14,1,"N"; |C_M #dscam004#23,1,"N";
   |FINSI;
|FPRC;

|PROCESO PagMovs;
   #dscam004#17 = #dscam003#40;
   #dscam004#3 = 1;
   |LEE 000#dscam004.];
   |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
      nLinea = #dscam004#3 + 1;
      |LEE 000#dscam004.s;
   |SIGUE;

   |REPON_DATOS #dscam004;
   |SALVA_DATOS #dscam004;
   #dscam004#17 = #dscam003#40;
   #dscam004#3 = nLinea;
   |GRABA 020#dscam004.c;

   |SI #dscam004#5 = "PRC"; |O #dscam004#5 = "PRA";
      #dscam003#98 = "S";
   |FINSI;
   |SI #dscam004#5 = "RCE"; |O #dscam004#5 = "RCA";
      #dscam013#16 = #dscam003#40;
      #dscam013#17 = 1;
      |LEE 000#dscam013.];
      |PARA; |SI FSalida = 0; |Y #dscam013#16 = #dscam003#40; |HACIENDO;
         |SI #dscam013#0 = #dscam003#17; |SAL; |FINSI;
      |SIGUE;
      |SI FSalida = 0; |Y #dscam013#16 = #dscam003#40; |Y #dscam013#0 = #dscam003#17;
         #dscam013#15 = "R"; |GRABA 020#dscam013.a;
      |FINSI;

      #dscam003#38 = #dscam003#38 + #dscam004#14; #dscam003#66 = #dscam003#66 + #dscam004#31;
      #dscam003#23 = #dscam003#23 - #dscam004#9;  #dscam003#61 = #dscam003#61 - #dscam004#27;
      #dscam003#26 = "01.01.0000";
      #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
      #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
      #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
      #dscam003#31 = #dscam003#30 - #dscam003#23; #dscam003#65 = #dscam003#64 - #dscam003#61;
      #dscam003#17 = 0; #dscam003#37 = 0; #dscam003#53 = "01.01.0000";
      |SI #dscam003#70 ! "          "; |O #dscam003#72 ! "    ";
         #dscam003#14 = "T";
         #dscam003#15 = "Talon/Pagare reclamado";
      |SINO;
         #dscam003#14 = "P";
         #dscam003#15 = "Recibo reclamado";
      |FINSI;
      #dscam003#84 = "N"; #dscam003#98 = "N";
   |FINSI;
   |GRABA 020#dscam003.a;
|FPRC;

|DEFBUCLE PagMovs;
#dscam003#7;
;
aEntidad, aNumero, 00000000001;
aEntidad, aNumero, 99999999999;
be;
NULL,PagMovs;
|FIN;

|PROCESO ReponImportes;
   #dscam003#78 = nImpD; #dscam003#79 = nImpB;
   |GRABA 020#dscam003.a;
|FPRC;

|DEFBUCLE ReponImportes;
#dscam003#7;
;
aEntidad, aNumPag, 0000000001;
aEntidad, aNumPag, 9999999999;
be;
NULL,ReponImportes;
|FIN;

|PROCESO LiquTalon;
   |SI nNumDoc = #dscam003#40; |ACABA; |FINSI;

   #dscam004#17 = #dscam003#40;
   #dscam004#3 = 1;
   |LEE 000#dscam004.];
   |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
      nLinea = #dscam004#3 + 1;
      |LEE 000#dscam004.s;
   |SIGUE;

   |REPON_FICHA #dscam004; |SALVA_FICHA #dscam004;
   #dscam004#43 = nNumSec;
   #dscam004#7 = #dscam003#23; #dscam004#25 = #dscam003#61;
   #dscam004#8 = #dscam003#30; #dscam004#26 = #dscam003#64;
   #dscam004#17 = #dscam003#40;
   #dscam004#3 = nLinea;
   |GRABA 020#dscam004.c;

   #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
   #dscam003#31 = 0; #dscam003#65 = 0;
   #dscam003#14 = "L";
   #dscam003#15 = "Recibo Liquidado";
   #dscam003#84 = "S";
   |GRABA 020#dscam003.a;

|FPRC;

|DEFBUCLE LiquTalon;
#dscam003#7;
;
aEntidad, aNumPag, 0000000001;
aEntidad, aNumPag, 9999999999;
be;
NULL,LiquTalon;
|FIN;

|PROCESO VigilaFecha;
   nDocum1 = #dscam004#17;
   |SALVA_FICHA #dscam004;
   |LEE 000#dscam004.a;
   |SI FSalida ! 0; |O #dscam004#17 ! nDocum1;
      UltFecCo = #dscam003#4;
   |FINSI;
   |REPON_FICHA #dscam004;

   |SI #dscam004#6 < UltFecCo;
      aAlfa = "    La fecha del ultimo movto. es " + UltFecCo + " y la indicada es menor";
      |MENAV aAlfa;
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO EntradaManual;
   UltCobro = #dscam004#3;
   UltFecCo = #dscam004#6;

   |SI #dscam004#5 = "PRE";
      #dscam003#94 = #dscam004#4;
      #dscam003#90 = "S"; |GRABA 020#dscam003.a;
   |FINSI;
   |SI #dscam004#5 = "RTA";
      nNumDoc = #dscam003#40; aEntidad = #dscam003#72; aNumPag = #dscam003#70;
      #dscam004#16 = "Cob.Talon n§" + #dscam003#72 + "/" + #dscam003#70;
      #dscam004#7 = #dscam003#23; #dscam004#25 = #dscam003#61;
      #dscam004#8 = #dscam003#30; #dscam004#26 = #dscam003#64;

      |SALVA_DATOS #dscam004; |SALVA_FICHA #dscam004;
      |SELECT #3#dscam004;
      |LEE 000#dscam004.u;
      nNumSec = #dscam004#43 + 1;
      |SELECT #1#dscam004;
      |LEE 000#dscam004.p;
      |REPON_FICHA #dscam004; |REPON_DATOS #dscam004;
      #dscam004#43 = nNumSec;
      |GRABA 020#dscam004.a;

      |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
      |BUCLE LiquTalon;
      |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;

      #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
      #dscam003#31 = 0; #dscam003#65 = 0;
      #dscam003#14 = "L";
      #dscam003#15 = "Recibo Liquidado";
      #dscam003#84 = "S";
      |GRABA 020#dscam003.a;

      eaTipoOper = "-4";           enEmpCartera = -1;
      enEmpGestion = #dscam003#46; eaSerie = #dscam003#0;
      eaCliGest = #dscam003#32;    nImporte = #dscam003#78;
      |HAZ BucleRiesgo;
   |FINSI;
   |SI #dscam004#5 = "RPT"; |O #dscam004#5 = "CFR";
      |SI fFecPag = "00.00.0000";
         aCtaPag = #dscam004#4;  fFecPag = #dscam004#6;
         aObsPag = #dscam004#16;
      |FINSI;
      |SI #dscam004#5 = "RPT";
         nImpD = nImpD + #dscam003#30;
         nImpB = nImpB + #dscam003#64;
         |SALVA_DATOS #dscam004; |SALVA_FICHA #dscam004;
         |SALVA_FICHA #dscam003;
         |BUCLE ReponImportes;
         |REPON_FICHA #dscam003;
         |REPON_FICHA #dscam004; |REPON_DATOS #dscam004;
         #dscam003#14 = "T";
         #dscam003#15 = "Pagare/talon de cliente";
      |SINO;
         #dscam003#14 = "F";
         #dscam003#15 = "Recepcionado Confirme";
         #dscam003#97 = "S";
      |FINSI;
      #dscam003#72 = aEntidad;
      #dscam003#70 = aNumPag;
      #dscam003#71 = fFecPag;
      #dscam003#73 = aObsPag;
      #dscam003#74 = aCtaPag;
      #dscam003#78 = nImpD; #dscam003#79 = nImpB;
      #dscam003#90 = "S";
      |GRABA 020#dscam003.a;
      |SI #dscam051#3 = "S"; |Y #dscam051#130 = "S"; |Y #dscam004#5 = "CFR";
         enEmpCartera = -1;     enEmpGestion = #dscam003#46;
         eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
         nImporte = #dscam003#30;
         |SI #dscam003#16 ! 0;
            eaTipoOper = "-7";
         |SINO;
            eaTipoOper = "-4";
         |FINSI;
         |HAZ BucleRiesgo;
      |FINSI;
   |FINSI;
   |SI #dscam004#5 = "RCF";
      #dscam003#90 = "S";
      #dscam003#97 = "S"; |GRABA 020#dscam003.a;
   |FINSI;
   |SI #dscam004#5 = "ENV";
      #dscam003#95 = #dscam004#4;
      #dscam003#28 = "S"; #dscam003#14 = "V";
      #dscam003#15 = "Recibo enviado al cliente";
      #dscam003#93 = "S"; |GRABA 020#dscam003.a;
   |FINSI;
   |SI #dscam004#5 = "ACE";
      #dscam003#90 = "S";
      #dscam003#96 = #dscam004#4;
      #dscam003#29 = "S"; #dscam003#14 = "P";
      #dscam003#15 = "Recibo aceptado";
      |GRABA 020#dscam003.a;
   |FINSI;
   |SI #dscam004#5 = "PRC"; |O #dscam004#5 = "PRA";
      |SALVA_DATOS #dscam004;
      |SALVA_FICHA #dscam004;
      |SELECT #3#dscam004;
      |LEE 000#dscam004.u;
      nNumSec = #dscam004#43 + 1;
      |SELECT #1#dscam004;
      |REPON_FICHA #dscam004;
      |REPON_DATOS #dscam004;

      #dscam004#7  = #dscam003#23; #dscam004#25 = #dscam003#61;
      #dscam004#43 = nNumSec;
      |SI #dscam003#70 ! "          "; |O #dscam003#72 ! "    ";
         aEntidad = #dscam003#72; aNumero = #dscam003#70;
         |SALVA_FICHA #dscam003; |SALVA_DATOS #dscam004;
         |BUCLE PagMovs;
         |REPON_DATOS #dscam004; |REPON_FICHA #dscam003;
      |FINSI;
      #dscam003#98 = "S"; |GRABA 020#dscam003.a;
   |FINSI;
   |SI #dscam004#5 = "RCE"; |O #dscam004#5 = "RCA";
      #dscam004#7  = #dscam003#23; #dscam004#25 = #dscam003#61;
      #dscam004#9  = #dscam003#30; #dscam004#27 = #dscam003#64;
      |ABRE #dscam013; |SELECT #4#dscam013;
      #dscam013#16 = #dscam003#40;
      #dscam013#24 = 1;
      |LEE 000#dscam013.];
      |PARA; |SI FSalida = 0; |Y #dscam013#16 = #dscam003#40; |HACIENDO;
         |SI #dscam013#0 = #dscam003#17; |SAL; |FINSI;
      |SIGUE;
      |SI FSalida = 0; |Y #dscam013#16 = #dscam003#40; |Y #dscam013#0 = #dscam003#17;
         #dscam013#15 = "R"; |GRABA 020#dscam013.a;
      |FINSI;
      |SI #dscam003#70 ! "          "; |O #dscam003#72 ! "    ";
         aEntidad = #dscam003#72; aNumero = #dscam003#70;
         |SALVA_FICHA #dscam003; |SALVA_DATOS #dscam004;
         |BUCLE PagMovs;
         |REPON_DATOS #dscam004; |REPON_FICHA #dscam003;
      |FINSI;
      |CIERRA #dscam013;
      #dscam003#38 = #dscam003#38 + #dscam004#14; #dscam003#66 = #dscam003#66 + #dscam004#31;
      #dscam003#23 = #dscam003#23 - #dscam004#9;  #dscam003#61 = #dscam003#61 - #dscam004#27;
      #dscam003#26 = "01.01.0000";
      #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
      #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
      #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
      #dscam003#31 = #dscam003#30 - #dscam003#23; #dscam003#65 = #dscam003#64 - #dscam003#61;
      #dscam003#17 = 0; #dscam003#37 = 0; #dscam003#53 = "01.01.0000";
      |SI #dscam003#70 ! "          "; |O #dscam003#72 ! "    ";
         #dscam003#14 = "T";
         #dscam003#15 = "Talon/Pagare reclamado";
      |SINO;
         #dscam003#14 = "P";
         #dscam003#15 = "Recibo reclamado";
      |FINSI;
      #dscam003#84 = "N"; #dscam003#98 = "N";
      #dscam003#90 = "N";
      |GRABA 020#dscam003.a;
   |FINSI;
   |SI #dscam004#5 = "IMP";
      #dscam004#7 = #dscam003#23; #dscam004#25 = #dscam003#61;
      #dscam004#33 = #dscam003#59;
      #dscam004#27 = #dscam004#9 * #dscam004#33;
      #dscam003#16 = #dscam003#16 + 1;
      #dscam003#23 = #dscam003#23 - #dscam004#8;
      #dscam003#61 = #dscam003#61 - #dscam004#26;
      #dscam003#31 = #dscam003#31 + #dscam004#8;
      #dscam003#65 = #dscam003#65 + #dscam004#26;
      #dscam003#14 = "I";
      #dscam003#15 = "Impagado";
      #dscam003#23 = #dscam003#23 - #dscam004#9;  #dscam003#61 = #dscam003#61 - #dscam004#27;
      #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
      #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
      #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
      #dscam003#31 = #dscam003#30 - #dscam003#23; #dscam003#65 = #dscam003#64 - #dscam003#61;
      |GRABA 020#dscam003.a;
      |SI #dscam051#3 = "S";
         enEmpCartera = -1;       enEmpGestion = #dscam003#46;
         eaSerie = #dscam003#0;   eaCliGest = #dscam003#32;
         nImporte = #dscam004#27; eaTipoOper ="+7-6"; |HAZ BucleRiesgo;
      |FINSI;
   |FINSI;
   |SI #dscam004#5 = "COB"; |O #dscam004#5 = "COP";
      #dscam004#7 = #dscam003#23;
      #dscam004#25 = #dscam003#61;
      #dscam004#33 = #dscam003#59;
      #dscam004#26 = #dscam004#8 * #dscam004#33;
      #dscam003#23 = #dscam003#23 + #dscam004#8;
      #dscam003#61 = #dscam003#61 + #dscam004#26;
      #dscam003#31 = #dscam003#31 - #dscam004#8;
      #dscam003#65 = #dscam003#65 - #dscam004#26;
      || #dscam003#56 = #dscam003#56 + #dscam004#24;
      aEstadoAnt = #dscam003#14;
      |SI #dscam003#31 = 0;
         #dscam003#14 = "L";
         #dscam003#15 = "Recibo Liquidado";
      |SINO;
         |SI #dscam003#23 = 0;
            |SI #dscam003#70 = "          ";
               |SI #dscam003#16 = 0;
                  #dscam003#14 = "P";
                  #dscam003#15 = "Pendiente de cobro";
               |SINO;
                  #dscam003#14 = "I";
                  #dscam003#15 = "Impagado";
               |FINSI;
            |SINO;
               #dscam003#14 = "T";
               #dscam003#15 = "Pagare/Talon de cliente";
            |FINSI;
         |SINO;
            #dscam003#14 = "C";
            #dscam003#15 = "Parcialmente cobrado";
         |FINSI;
      |FINSI;
      |GRABA 020#dscam003.a;
      |SI #dscam051#3 = "S"; |Y aEstadoAnt ! "F";
         enEmpCartera = -1;     enEmpGestion = #dscam003#46;
         eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
         nImporte = #dscam004#26;
         |SI #dscam003#16 ! 0;
            eaTipoOper = "-7";
         |SINO;
            eaTipoOper = "-4";
         |FINSI;
         |HAZ BucleRiesgo;
      |FINSI;

      eaCliente = #dscam003#32; |HAZ MiraBloqueoRiesgo;
   |FINSI;
   |C_M #dscam004#16,1,"N";
|FPRC;

|PROCESO MiraClasif;
   |ABRE #dscam081; |ABRE #dscam082;
   |SELECT #2#dscam082;
   #dscam082#1 = #dscam003#12;
   |LEE 000#dscam082.=;
   |SI FSalida = 0;
      #dscam081#0 = #dscam082#0;
      |LEE 000#dscam081.=;
      |SI FSalida ! 0; |DDEFECTO #dscam081; |FINSI;
      |SELECT #1#dscam082;
      |CIERRA #dscam081; |CIERRA #dscam082;

      |SI #dscam081#2 ! aClasif;
         |CIERRA #dscam003; |HAZ Cambia;
         |ABRE #dscam003; |LEE 000#dscam003.=;
      |SINO;
         nTipoRec = #dscam003#12;
      |FINSI;
   |SINO;
      nTipoRec = #dscam003#12;
   |FINSI;
|FPRC;

|PROCESO Cambia;
   |CONFI "    NDocumento inoperable en el perfil actual. Cambiar clasificacion ?";
   |SI FSalida ! 0;
      eaResult = "ERROR"; |ACABA;
   |FINSI;

   |MENSA "    <F2> Consulta tipos de recibo";
   |ABRE #dscam058;
   |PUSHV 0501 2380;
   |BLANCO 1120 1360;
   |CUADRO 1120 1360;
   |ATRI R; |PINTA 1121, " Indique el nuevo tipo de recibo "; |ATRI N;
   #dscam058#0 = nTipoRec; |LEE 000#dscam058.];
   |PINTA 1227, #dscam058#1;
   |ET TRec;
   E_sup = 99; E_inf = 0;
   nTipoRec = 1224 ? 1;
   |SI FSalida ! 10; |Y FSalida ! 0; |Y FSalida ! 7; |VETE TRec; |FINSI;
   |SI FSalida = 7; eaResult = "ERROR"; |POPV; |ACABA; |FINSI;
   |SI FSalida = 10;
      #dscam058#0 = nTipoRec;
      |LEE 000#dscam058.];
      |CONSULTA_CLAVE #1#dscam058;
      |SI FSalida = 0;
         nTipoRec = #dscam058#0; |PINTA 1227, #dscam058#1;
         |VETE TRec;
      |FINSI;
   |FINSI;
   |SI FSalida = 0;
      #dscam058#0 = nTipoRec;
      |LEE 000#dscam058.=;
      |SI FSalida = 0;
         |PINTA 1227, #dscam058#1;
      |SINO;
         |MENAV "    Tipo de recibo inexistente "; |VETE TRec;
      |FINSI;
      |CONFI "    N Es Correcto ? ";
      |SI FSalida ! 0; |VETE TRec; |FINSI;
   |FINSI;

   |ABRE #dscam081; |ABRE #dscam082;
   |SELECT #2#dscam082;
   #dscam082#1 = nTipoRec;
   |LEE 000#dscam082.=;
   |SI FSalida = 0;
      #dscam081#0 = #dscam082#0;
      |LEE 000#dscam081.=;
      |SI FSalida = 0;
         |SI #dscam081#2 ! aClasif;
            |MENAV "    Tipo de recibo inoperable";
            |VETE TRec;
         |FINSI;
      |FINSI;
   |FINSI;
   #dscam082#1 = #dscam003#12;
   |LEE 000#dscam082.=;
   |SI FSalida = 0;
      #dscam081#0 = #dscam082#0;
      |LEE 000#dscam081.=;
      |SI FSalida ! 0; |DDEFECTO #dscam081; |FINSI;
   |FINSI;
   |SELECT #1#dscam082;
   |CIERRA #dscam081; |CIERRA #dscam082;

   |POPV;
   |CIERRA #dscam058;
   |MENSA "     ";

   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#47 = "N"; |ACABA; |FINSI;

|| Compruebo el recibo y hago el cambio en caso de ser posible
   |SI #dscam081#2 = "C";                               || Contado
      |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "I";
         aAlfa = "    El documento " + #dscam003#40 + " no esta en condiciones de hacer el cambio.";
         |MENAV aAlfa; eaResult = "ERROR";
      |SINO;
         |SI aClasif = "A"; #dscam003#28 = "S"; |SINO; #dscam003#28 = "N"; |FINSI;
         #dscam003#12 = nTipoRec; |GRABA 020#dscam003.a;
      |FINSI;
   |FINSI;
   |SI #dscam081#2 = "P";                               || Pagare
      |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "I";
         aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
         |MENAV aAlfa; eaResult = "ERROR";
      |SINO;
         |SI aClasif = "A"; #dscam003#28 = "S"; |SINO; #dscam003#28 = "N"; |FINSI;
         #dscam003#12 = nTipoRec; |GRABA 020#dscam003.a;
      |FINSI;
   |FINSI;
   |SI #dscam081#2 = "R";                               || Remesable
      |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "I";
         aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
         |MENAV aAlfa; eaResult = "ERROR";
      |SINO;
         |SI #dscam003#90 = "N";
            |SI aClasif = "A"; #dscam003#28 = "S"; |SINO; #dscam003#28 = "N"; |FINSI;
            #dscam003#12 = nTipoRec;
            |GRABA 020#dscam003.a;
         |SINO;
            |MENAV "    Existen movimientos para la clasificacion actual";
            eaResult = "ERROR"; |ACABA;
         |FINSI;
      |FINSI;
   |FINSI;
   |SI #dscam081#2 = "A";                               || A aceptar
      |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "V"; |Y #dscam003#14 ! "I";
         aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
         |MENAV aAlfa; eaResult = "ERROR";
      |SINO;
         |SI #dscam003#93 = "N";
            |SI aClasif = "A"; #dscam003#28 = "S"; |SINO; #dscam003#28 = "N"; |FINSI;
            #dscam003#14 = "P"; #dscam003#15 = "Pendiente de cobro";
            #dscam003#12 = nTipoRec;
            |GRABA 020#dscam003.a;
         |SINO;
            |MENAV "    Existen movimientos para la clasificacion actual";
            eaResult = "ERROR"; |ACABA;
         |FINSI;
      |FINSI;
   |FINSI;
   |SI #dscam081#2 = "O";                               || A recibir Confirming
      |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "I";
         aAlfa = "    El documento " + enNumDocum + " no esta en condiciones de hacer el cambio.";
         |MENAV aAlfa; eaResult = "ERROR";
      |SINO;
         |SI #dscam003#97 = "N";
            |SI aClasif = "A"; #dscam003#28 = "S"; |SINO; #dscam003#28 = "N"; |FINSI;
            #dscam003#12 = nTipoRec;
            |GRABA 020#dscam003.a;
         |SINO;
            |MENAV "    Existen movimientos para la clasificacion actual";
            eaResult = "ERROR"; |ACABA;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Min4;
     #dscam004#17 = #dscam003#40;
     #dscam004#3 = 00;
|FPRC;

|PROCESO Max4;
     #dscam004#17 = #dscam003#40;
     #dscam004#3 = 99;
|FPRC;

|PROCESO Consu66; |TIPO 66;
     |CONSULTA_F_CLAVE #1#dscam004, Min4, Max4;
|FPRC;
*/
