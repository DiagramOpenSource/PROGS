|VARIABLES;
     aCta   = "";
     aIban  = "";
     aLon   = "";
     aPais  = "";
     aNuevo = "";
     aCar   = "";
     nPos   = 0;
     aAlfa  = "";
     i      = 0;
     iy     = 0;
     nNume  = 0;
     nResto = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     nCalc  = 0;
     aDC    = "";

     &eaPais    = "";
     &eaCta     = "";
     &eaIBAN    = "";
     &eaIBANant = "";
|FIN;

|PROCESO CalcuIBAN;

     |QBF eaIBANant;
     eaIBAN = "";
     aPais  = eaPais % 102; |QBF aPais;
     aCta   = eaCta; |QBF aCta;
     |SI eaIBANant ! "";
         aPais  = eaIBANant % 102; |QBF aPais;
         aCta   = eaIBANant % 530; |QBF aCta;
     |FINSI;

     nNume = aCta;
     aLon  = aCta % A0;
     |SI aLon ! 20; |Y aPais = "ES";
         |ACABA;
     |FINSI;  ||si es Espa¤a siempre 20

     |SI aLon ! 0; |Y aPais ! "";
          aPais = aPais > "";
          aIban = aCta + aPais + "00";
          |HAZ CambiaLetra;
          |HAZ Mod9710;
          eaIBAN = aPais + aDC + aCta;
     |FINSI;
|FPRC;

|PROCESO CheqIBAN;
     |QBF eaIBANant;
     eaIBAN = "";
     aPais  = eaPais % 102; |QBF aPais;
     aCta   = eaCta; |QBF aCta;
     |SI eaIBANant ! "";
         aPais  = eaIBANant % 102; |QBF aPais;
         aCta   = eaIBANant % 530; |QBF aCta;
     |FINSI;

     nNume  = aCta;
     aLon   = aCta % A0;

     |SI aLon ! 20; |Y aPais = "ES";
         |ACABA;
     |FINSI;  ||si es Espa¤a siempre 20

||      (aLon = 20)
     |SI aLon ! 0; |Y aPais ! "";
          aPais = aPais > "";
          aIban = aCta + aPais + "00";

          |HAZ CambiaLetra;
          |HAZ Mod9710;

          eaIBAN = aPais + aDC + aCta;
     |FINSI;

     |QBF eaIBAN;
|FPRC;

|PROCESO Mod9710;
   aAlfa = aIban;
   aAlfa2 = aAlfa % 0101;
   |PARA; |SI aAlfa2 = "0"; |HACIENDO;
      aAlfa = aAlfa % 0299; aAlfa2 = aAlfa % 0101;
   |SIGUE;

   aAlfa1 = "";
   |PARA; |SI aAlfa ! ""; |HACIENDO;
      aAlfa2 = aAlfa % 0; nCalc = aAlfa2;
      |SI nCalc > 5;
         aAlfa2 = aAlfa % 0105; aAlfa = aAlfa % 0699;
      |SINO;
         aAlfa2 = aAlfa; aAlfa = "";
      |FINSI;
      aAlfa1 = aAlfa1 + aAlfa2;
      nCalc = aAlfa1;
      nCalc = nCalc / 97;
      aAlfa2 = nCalc;
      aAlfa2 = aAlfa2 - ".";
      |SI FSalida ! 0;
         nCalc = FSalida + 98;
         aAlfa2 = aAlfa2 % nCalc;
         aAlfa2 = "0." + aAlfa2; nCalc = aAlfa2;
      |SINO;
         nCalc = 0;
      |FINSI;
      nCalc = (nCalc * 97) ! 0;
      aAlfa1 = nCalc;
   |SIGUE;
   nCalc  = aAlfa1;
   nCalc = 98 - nCalc;
   aDC = ("00" + nCalc) % -102;
|FPRC;

|PROCESO CambiaLetra;
     aNuevo = "";
     iy     = aLon; iy = iy + 4;  || (antes 24.)
     |PARA i = 1; |SI i [ iy; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aCar = aIban % nPos;
          |SI aCar ] "0"; |Y aCar [ "9";
               aNuevo = aNuevo + aCar;
          |SINO;
               nNume = &aCar; nNume = nNume - 55; aCar = nNume;
               aNuevo = aNuevo + aCar;
          |FINSI;
     |SIGUE;
     aIban = aNuevo;
|FPRC;
