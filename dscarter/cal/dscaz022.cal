|FICHEROS;
   dscaz022 #0;

   dscam049 #1;
   dscam050 #2;

   dscam030 #3;
   dscaw013 #4;

   dscam008 #5;
   dscam009 #6;
   dscam051 #7;

   &caclipr@;
|FIN;

|VARIABLES;
   &fecha = @;
   &fp = "";
   &HayConta = 0;
   &aInforme = "";
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = "";
   &aCuenta = "";   &nNivel = 0;
   &eaDirProv = ""; &eaNifProv = "";
   &eaCodigo = "";  &eaTipoCod = "";

   &eaNif       = "";
   &eaNombre    = "";
   &eaApCorreos = "";
   &eaDireccion = "";
   &eaPoblacion = "";
   &eaProvincia = "";
   &eaCP        = "";

   aAlfa = "";

   nSwImpre = 0;
   aImp = "";
   alfa1 = ""; Comodin = ""; LinPag = 0;
|FIN;

/*
|PROCESO ActualizaRecibo;
   #dscam009#14 = #dscam050#13;
   #dscam009#3 = 99;
   |LEE 000#dscam009.];
   |SI FSalida ! 0;
      |LEE 000#dscam009.u;
      |SI FSalida = 0; |Y #dscam009#14 = #dscam050#13;
         LinPag = #dscam009#3 + 1;
      |SINO;
         LinPag = 1;
      |FINSI;
   |SINO;
      |SI #dscam009#14 = #dscam050#13;
         LinPag = #dscam009#3 + 1;
      |SINO;
         |LEE 000#dscam009.a;
         |SI FSalida = 0; |Y #dscam009#14 = #dscam050#13;
            LinPag = #dscam009#3 + 1;
         |SINO;
            LinPag = 1;
         |FINSI;
      |FINSI;
   |FINSI;

   |DDEFECTO #dscam009;
   #dscam009#14 = #dscam050#13;        || N§ documento
   #dscam009#13 = #dscam050#2;         || Libro
   #dscam009#0  = #dscam050#4;         || Serie
   #dscam009#1  = #dscam050#3;         || Factura
   #dscam009#2  = #dscam050#5;         || Recibo
   #dscam009#3  = LinPag;              || N§ de pago
   #dscam009#4  = #dscam049#10;        || Cuenta de pago
   #dscam009#5  = "PCF";
   #dscam009#6  = #dscam050#6;         || Fecha de vencimiento
   #dscam009#7  = #dscam008#23;        || Total liquidado DIVISA
   #dscam009#20 = #dscam008#57;        || Total liquidado BASE
   #dscam009#8  = #dscam050#7;         || Importe efecto DIVISA
   #dscam009#21 = #dscam050#20;        || Importe efecto BASE
   #dscam009#9  = 0;
   |GRABA 020#dscam009.n;

   || Actualizo el recibo
   || #dscam008#14 = "L"; #dscam008#15 = "Recibo liquidado";
   #dscam008#26 = #dscam049#1;
   #dscam008#23 = #dscam008#23 + #dscam050#7;
   #dscam008#57 = #dscam008#57 + #dscam050#20;
   #dscam008#25 = #dscam008#22 + #dscam008#24 + #dscam008#38;
   #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55 + #dscam008#62;
   #dscam008#31 = #dscam008#25 - #dscam008#23;
   #dscam008#58 = #dscam008#56 - #dscam008#57;
   #dscam008#48 = "S";
   |GRABA 020#dscam008.a;
|FPRC;
*/

|PROCESO EmisionLin;
   |SI #dscam050#16 = "T";
      fp = "TRANS.";
   |SINO;
      fp = "CHEQUE";
   |FINSI;

   #dscam008#40 = #dscam050#13;
   |LEE 000#dscam008.=;
   |SI FSalida = 0;
      eaCodigo = #dscam008#32; eaTipoCod = "P"; aCuenta = #dscam008#5; |HAZ LeeDatos;
   |FINSI;

   |SI HayConta = 1;
      #caclipr@#23 = "P";
      #caclipr@#10 = #dscam050#8;
      aCuenta = #dscam050#8; nNivel = 0; |HAZ SacaNivel;
      #caclipr@#11 = nNivel;
      |LEE 000#caclipr@.=;
      |SI FSalida ! 0; |DDEFECTO #caclipr@; |FINSI;

      |QBF eaDireccion;
      |SI eaDireccion = "";
         eaDirProv = #caclipr@#2;
         eaNifProv = #caclipr@#9;
      |SINO;
         eaDirProv = eaDireccion;
         eaNifProv = eaNif;
      |FINSI;
   |SINO;
      eaDirProv = eaDireccion;
      eaNifProv = eaNif;
   |FINSI;

   |PRINT;
|FPRC;

|DEFBUCLE EmisionLin;
#dscam050#1;
;
#dscam049#0,001;
#dscam049#0,999;
be;
NULL,EmisionLin;
|FIN;

|PROCESO Emision;

   |SI #dscaz022#8 = "N";
      |SI #dscam049#7 = "S"; |O #dscam049#7 = "D"; |ACABA; |FINSI;
   |SINO;
      |SI #dscam049#7 = "N"; |ACABA; |FINSI;
   |FINSI;

   aInforme = "Carta emision de confirmes"; |HAZ ObtenInforme;
   |INFOR aInforme;

   eaUsuario = Usuario % 0810;
   eaDescr   = "EMISION CONFIRME (" + (("00000" + #dscam049#0) % -105) + ")";
   eaTipoReg = "CF";  eaNumero = ("00000" + #dscam049#0) % -105;
   eaTipoOp  = "E";   enImpAnt = #dscam049#9; enImpAct = #dscam049#9;
   |HAZ GrabaAudit;

   fecha = #1#1;
   |SI #0#9 = "S"; fecha = #0#2; |FINSI;
   |BUCLE EmisionLin;
   #dscam049#7 = "S"; |GRABA 020#dscam049.a;

   |SI #dscam051#1 = "S";
      |SI #dscam051#61 = "N";
         |SI #dscam049#23 = "C"; #dscaz022#13 = #dscam051#29; |FINSI;
         |SI #dscam049#23 = "T"; #dscaz022#13 = #dscam051#65; |FINSI;
      |FINSI;
   |SINO;
      |C_M #dscaz022#13, 1, "N"; #dscaz022#13 = ""; |PINTA #dscaz022#13;
   |FINSI;

   |SI HayConta = 1; |Y #0#8 = "N"; |Y #dscam051#1 = "S";
      |ABRE #dscam030;
      #dscam030#0 = #dscaz022#13;
      |LEE 010#dscam030.=;
      |SI FSalida = 0;
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #4 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         |DDEFECTO #dscaw013;
         #dscaw013#0  = 1;            #dscaw013#15 = #dscaz022#13;
         #dscaw013#5  = #dscam049#0;  #dscaw013#6  = #dscam049#0;
         #dscaw013#11 = "N";          #dscaw013#12 = 5;
         #dscaw013#13 = "dscam050";   #dscaw013#14 = 0;
         |GRABA 020#dscaw013.n;
         |CIERRA #dscaw013;
         Comodin = #dscaz022#13;
         Comodin = "dscam033.tab;" + Comodin + ",E";
         |LIBERA #dscam049; |CIERRAT #dscam049;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam049; |LEE 101#dscam049.=;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
      |FINSI;
      |CIERRA #dscam030;
   |FINSI;

   nSwImpre = 0;
   |SALVA_FICHA #dscam049;
   |LEE 000#dscam049.s;
   |PARA; |SI FSalida = 0; |HACIENDO;
      |SI #dscam049#0 ] #dscaz022#0; |Y #dscam049#0 [ #dscaz022#1;
       |Y #dscam049#2 ] #dscaz022#11; |Y #dscam049#2 [ #dscaz022#12;
       |Y #dscam049#3 ] #dscaz022#4; |Y #dscam049#3 [ #dscaz022#5;
       |Y #dscam049#6 ] #dscaz022#6; |Y #dscam049#6 [ #dscaz022#7;
       |Y #dscam049#7 = #dscaz022#8;
          nSwImpre = 1; |SAL;
      |FINSI;
      |LEE 000#dscam049.s;
   |SIGUE;
   |REPON_FICHA #dscam049;
|FPRC;

|DEFBUCLE Emision;
#dscam049#1;
2,3,6;
#dscaz022#0,#dscaz022#11,#dscaz022#4,#dscaz022#6;
#dscaz022#1,#dscaz022#12,#dscaz022#5,#dscaz022#7;
be;
NULL,Emision;
|FIN;

|PROCESO mayus;
  alfa1   = #0Campo > " ";
  #0Campo = alfa1;
  |PINTA #0Campo;
  |SI Campo = 9;
      alfa1 = #0Campo;
      |C_M #0#2,1,alfa1;
  |FINSI;
|FPRC;

|PROCESO TomaValores;
   #dscaz022#1 = #dscaz022#0;
   |ABRE #dscam049;
   #dscam049#0 = #dscaz022#0;
   |LEE 000#dscam049.=;
   |SI FSalida = 0;
      |SI #dscam049#23 = "C";
         |ATRI I; |PINTA 1237, " CONFIRMING    "; |ATRI N;
         |SI #dscam051#1 = "S"; #dscaz022#13 = #dscam051#29; |FINSI;
      |SINO;
         |ATRI I; |PINTA 1237, " TRANSFERENCIA "; |ATRI N;
         |SI #dscam051#1 = "S"; #dscaz022#13 = #dscam051#65; |FINSI;
      |FINSI;
      |PINTA #dscaz022#13;
   |SINO;
      |MENAV "    No se encuentra la relacion";
      |ERROR;
   |FINSI;
   |CIERRA #dscam049;
|FPRC;

|PROCESO Reimp;
   |SI #dscaz022#8 = "S";
      |C_M #dscaz022#13,1,"N";
      #dscaz022#13 = ""; |PINTA #dscaz022#13;
   |FINSI;
|FPRC;

|PROCESO MiraParam; |TIPO 7;
   |SI #dscam051#1 = "S";
      Comodin = #dscam051#61;
      |C_M #dscaz022#13,1,Comodin;
   |FINSI;
|FPRC;

|PROGRAMA;
   |CLS;
   |HAZ Tipo8;
   |CABEZA "Emision papel confirming";

   |ABRE #dscam051;
   |LEE 010#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
   |FINSI;
   |CIERRA #dscam051;

   |SI HayConta = 1; |Y #dscam051#1 = "S";
      |C_M #dscaz022#13,1,"S";
      |DDEFECTO #dscaz022;
      #dscaz022#13 = #dscam051#29;
   |SINO;
      |C_M #dscaz022#13,1,"N";
   |FINSI;

   |PINPA #0#0;
   |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |IMPRE 0; |SI FSalida < 0; |ACABA; |FINSI;
      aImp = Impresora;
      aInforme = "Carta emision de confirmes"; |HAZ ObtenInforme;
      |INFOR aInforme;
      |SI FSalida < 0; |FINIMP; |ACABA; |FINSI;
      |ABRE #dscam049; |ABRE #dscam050;
      |ABRE #dscam008; |ABRE #dscam009;
      |BUCLE Emision;
      |CIERRA #dscam009; |CIERRA #dscam008;
      |CIERRA #dscam049; |CIERRA #dscam050;
      |PIEINF; |FININF;
      |FINIMP;
   |FINSI;


   |HAZ Tipo9;
|FPRO;
