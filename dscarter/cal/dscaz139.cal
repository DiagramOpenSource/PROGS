|FICHEROS;
   dscaz139 #0;

   dscam012 #10;
   dscam013 #11;
   dscam003 #12;
   dscam004 #13;
   dscam014 #14;
   dscam051 #15;
   dscam030 #16;
   dscam031 #17;

   dscaw068 #100,MANTE;
   dscaw076 #101;
   dscaw013 #102;
   dscam093 #103,MANTE;
|FIN;

|VARIABLES;
   &HayConta = 0;
   &enSwClas = 0;
   &eaFichClas = "";
   &eaTipoClas = "";
   &eaUsuario  = "";
   &enImpAnt   = 0;
   &enImpAct   = 0;
   &eaDescr    = "";
   &eaTipoReg  = "";
   &eaNumero   = "";
   &eaTipoOp   = "";
   &eaSesion = "";

   &eaTOperacion = "";
   &eaTipoRecibo = "";
   &enNumDocum   = 0;

   &enEmpCartera = 0;
   &enEmpGestion = 0;
   &Divisa       = "";
   &eaSerie      = "";
   &eaCliGest    = "";
   &nImporte     = 0;
   &eaTipoOper   = "";
   &enBanco      = 0;
   &nDeci_Div    = 0;
   &nDeci_Base   = 0;

   nLinea = 0;
   aEntidad = "";
   aNumero  = "";
   aMarca   = "";
   aAlfa    = "";
   Comodin  = "";
   EmpreAnt = 0;
   PerioAnt = 0;

   aSerDiv  = "";
   nFacDiv  = 0;

   nGtosArrastradosD = 0;
   nGtosArrastradosB = 0;

   aDatoSesion = "";
   fFechaEnlac = @;
   aEnlace     = "";

   nNume    = 0;
   nNumero  = 0;
   nMarca   = 0;
   nRemesa  = 0;

   nTotLiquid = 0;
   nTotPdte   = 0;
   NuevoDoc   = 0;

   Calc1    = 0;
   Calc2    = 0;
   NumDias  = 0;

   fFechaC  = 0;
   &enSwError = 0;
|FIN;

|PROCESO MiraHisCobro;
     enSwError = 0;
|FPRC;

|PROCESO BorraMarcas;
   #dscam013#20 = " "; |GRABA 020#dscam013.a;
|FPRC;

|DEFBUCLE BorraMarcas;
#dscam013#1;
;
#dscaz139#0,001;
#dscaz139#1,999;
be;
NULL,BorraMarcas;
|FIN;

|PROCESO DivideRec;
   #dscam003#40 = #dscaw068#5;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      nGtosArrastradosD = #dscam003#101 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      nGtosArrastradosB = #dscam003#102 + #dscam003#62 + #dscam003#63 + #dscam003#66;
   |SINO;
      nGtosArrastradosD = 0;
      nGtosArrastradosB = 0;
   |FINSI;

   |LEE 000#dscam003.u;
   |SI  FSalida = 0;
      NuevoDoc = #dscam003#40 + 1;
   |SINO;
      NuevoDoc = 1;
   |FINSI;

   |DDEFECTO #dscam003;
   #dscam003#40 = #dscaw068#5;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      aSerDiv = #dscam003#0;
      nFacDiv = #dscam003#1;
      fFechaC = #dscam003#26;

      #dscam003#40 = NuevoDoc;
      |GRABA 020#dscam003.b;
      #dscam003#1 = 0;
      #dscam003#2 = 0;
      #dscam003#14 = "I"; #dscam003#15 = "Impagado por division";
      #dscam003#16 = 1;
      #dscam003#23 = 0; #dscam003#61 = 0;
      #dscam003#17 = 0; #dscam003#37 = 0;
      #dscam003#24 = 0; #dscam003#25 = 0; #dscam003#38 = 0;
      #dscam003#62 = 0; #dscam003#63 = 0; #dscam003#66 = 0;
      #dscam003#26 = "01.01.0000";
      #dscam003#22 = nTotPdte; #dscam003#60 = #dscam003#22 / #dscam003#59;
      #dscam003#30 = nTotPdte; #dscam003#64 = #dscam003#30 / #dscam003#59;
      #dscam003#31 = nTotPdte; #dscam003#65 = #dscam003#31 / #dscam003#59;
      #dscam003#41 = 0;  #dscam003#49 = "N";
      #dscam003#70 = ""; #dscam003#72 = "";
      #dscam003#82 = "S";
      #dscam003#83 = #dscaw068#5;
      #dscam003#87 = aSerDiv;
      #dscam003#88 = nFacDiv;
      #dscam003#90 = "N";
      #dscam003#101 = nGtosArrastradosD;
      #dscam003#102 = nGtosArrastradosB;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;

      #dscam003#40 = NuevoDoc + 1;
      |GRABA 020#dscam003.b;
      #dscam003#16 = 0;
      #dscam003#26 = fFechaC;
      #dscam003#22 = nTotLiquid; #dscam003#60 = #dscam003#22 / #dscam003#59;
      #dscam003#30 = nTotLiquid; #dscam003#64 = #dscam003#30 / #dscam003#59;
      #dscam003#23 = nTotLiquid; #dscam003#61 = #dscam003#23 / #dscam003#59;
      #dscam003#31 = 0;          #dscam003#65 = 0;
      #dscam003#14 = "L"; #dscam003#15 = "Liquidado por division";
      |GRABA 020#dscam003.a; |LIBERA #dscam003;

      #dscam003#40 = #dscaw068#5;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         #dscam003#14 = "D"; #dscam003#15 = "Dividido";
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO PasaRecibo;
   #dscam012#0 = nRemesa;
   |LEE 000#dscam012.=;
   |SI FSalida ! 0; |DDEFECTO #dscam012; |FINSI;

   |SI #dscam051#122 = "D";
      #dscam003#40 = #dscaw068#5;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         |DDEFECTO #dscam004;
         #dscam004#17 = #dscaw068#5;
         #dscam004#3 = 99;
         |LEE 000#dscam004.];
         |SI FSalida ! 0;
            |LEE 000#dscam004.u;
            |SI FSalida = 0; |Y #dscam004#17 = #dscaw068#5;
               nLinea = #dscam004#3 + 1;
            |SINO;
               nLinea = 1;
            |FINSI;
         |SINO;
            |SI #dscam004#17 = #dscaw068#5;
               nLinea = #dscam004#3 + 1;
            |SINO;
               |LEE 000#dscam004.a;
               |SI FSalida = 0; |Y #dscam004#17 = #dscaw068#5;
                  nLinea = #dscam004#3 + 1;
               |SINO;
                  nLinea = 1;
               |FINSI;
            |FINSI;
         |FINSI;

         |DDEFECTO #dscam004;
         #dscam004#17 = #dscaw068#5;
         #dscam004#3  = nLinea;
         |GRABA 020#dscam004.b;
         #dscam004#15 = #dscam003#27;
         #dscam004#0  = #dscam003#0;
         #dscam004#1  = #dscam003#1;
         #dscam004#2  = #dscam003#2;
         #dscam004#4  = #dscam012#14;
         |SI PARAMETRO = "RECUPERA";
            #dscam004#5  = "FAR";
            #dscam004#8  = #dscam013#41;
            #dscam004#26 = #dscam013#41;
         |SINO;
            #dscam004#5  = "FAP";
         |FINSI;
         #dscam004#6  = #dscaz139#6;
         #dscam004#7  = #dscam003#23;
         #dscam004#25 = #dscam003#61;
         #dscam004#11 = #dscam003#13;
         #dscam004#33 = #dscam003#59;
         #dscam004#43 = 0;
         #dscam004#44 = #dscam003#78;
         #dscam004#45 = #dscam003#79;
         #dscam004#46 = 0;
         #dscam004#47 = 0;
         |GRABA 020#dscam004.a; |LIBERA #dscam004;

         |SI PARAMETRO = "RECUPERA";
            #dscam003#55 = #dscam003#55 - #dscam013#41; #dscam003#68 = #dscam003#68 - #dscam013#41;
            #dscam003#23 = #dscam003#23 + #dscam013#41; #dscam003#61 = #dscam003#61 + #dscam013#41;
            #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
            #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
            #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
            #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
            |GRABA 020#dscam003.a; |LIBERA #dscam003;
         |FINSI;

         |SI #dscaz139#5 ! "    "; |Y HayConta = 1;
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #dscaw013#Comodin#;
            |DELINDEX #dscaw013; |ABRE #dscaw013;

            Comodin = #dscaz139#5;
            |SI Comodin = "    ";
               |ABRE #dscam093;
               #dscam093#0 = "V";
               |LEE 000#dscam093.=;
               |SI FSalida = 0;
                  |SI #dscam012#22 = 6; Comodin = #dscam093#11; |FINSI;
                  |SI #dscam012#22 = 7; Comodin = #dscam093#13; |FINSI;
               |FINSI;
               |CIERRA #dscam093;
            |FINSI;

            aDatoSesion = ""; aEnlace = "";
            |ABRE #dscam030; |ABRE #dscam031;
            #dscam030#0 = Comodin;
            |LEE 101#dscam030.=;
            |SI FSalida = 0;
               |SI #dscam030#8 ! "N";
                  aDatoSesion = #dscam030#8; #dscam030#8 = "N";
                  |GRABA 020#dscam030.a;
               |FINSI;
               |LIBERA #dscam030;

               |DDEFECTO #dscam031;
               #dscam031#0 = #dscam030#0;
               |LEE 101#dscam031.];
               |SI FSalida = 0; |Y #dscam031#0 = #dscam030#0;
                  fFechaEnlac = #dscam031#4;
                  #dscam031#4 = #dscaz139#6;
                  |GRABA 020#dscam031.a; |LIBERA #dscam031;
               |FINSI;
            |FINSI;
            |CIERRA #dscam030; |CIERRA #dscam031;

            |DDEFECTO #dscaw013;
            #dscaw013#0  = 1;            #dscaw013#5  = #dscam004#17;
            #dscaw013#6  = #dscam004#17; #dscaw013#11 = "N";
            #dscaw013#12 = 10;           #dscaw013#13 = "dscam004";
            #dscaw013#14 = 17;           #dscaw013#15 = Comodin;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#0  = 2;            #dscaw013#5  = #dscam004#3;
            #dscaw013#6  = #dscam004#3;  #dscaw013#11 = "N";
            #dscaw013#12 = 3;            #dscaw013#13 = "dscam004";
            #dscaw013#14 = 3;            #dscaw013#15 = Comodin;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#0  = 3;            #dscaw013#7  = #dscam004#6;
            #dscaw013#8  = #dscam004#6;  #dscaw013#11 = "F";
            #dscaw013#12 = 10;           #dscaw013#13 = "dscam004";
            #dscaw013#14 = 6;            #dscaw013#15 = Comodin;
            |GRABA 020#dscaw013.n;

            aEnlace = Comodin;
            Comodin = "dscam033.tab;" + Comodin;

            |LIBERA #dscam004; |CIERRAT #dscam004;
            |LIBERA #dscam003; |CIERRAT #dscam003;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam003; |LEE 101#dscam003.=;
            |ABRET #dscam004; |LEE 101#dscam004.=;

            |ABRE #dscam030; |ABRE #dscam031;
            #dscam030#0 = aEnlace;
            |LEE 101#dscam030.=;
            |SI FSalida = 0;
               |SI aDatoSesion ! "";
                  #dscam030#8 = aDatoSesion;
                  |GRABA 020#dscam031.a;
               |FINSI;
               |LIBERA #dscam030;

               |DDEFECTO #dscam031;
               #dscam031#0 = aEnlace;
               |LEE 101#dscam031.];
               |SI FSalida = 0; |Y #dscam031#0 = aEnlace;
                  #dscam031#4 = fFechaEnlac;
                  |GRABA 020#dscam031.a; |LIBERA #dscam031;
               |FINSI;
            |FINSI;
            |CIERRA #dscam030; |CIERRA #dscam031;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
      |FINSI;
   |SINO;
      |SI PARAMETRO ! "RECUPERA";
         #dscam003#40 = #dscaw068#5;
         |LEE 101#dscam003.=;
         |SI FSalida = 0;
            |DDEFECTO #dscam004;
            #dscam004#17 = #dscaw068#5;
            #dscam004#3 = 99;
            |LEE 000#dscam004.];
            |SI FSalida ! 0;
               |LEE 000#dscam004.u;
               |SI FSalida = 0; |Y #dscam004#17 = #dscaw068#5;
                  nLinea = #dscam004#3 + 1;
               |SINO;
                  nLinea = 1;
               |FINSI;
            |SINO;
               |SI #dscam004#17 = #dscaw068#5;
                  nLinea = #dscam004#3 + 1;
               |SINO;
                  |LEE 000#dscam004.a;
                  |SI FSalida = 0; |Y #dscam004#17 = #dscaw068#5;
                     nLinea = #dscam004#3 + 1;
                  |SINO;
                     nLinea = 1;
                  |FINSI;
               |FINSI;
            |FINSI;

            |DDEFECTO #dscam004;
            #dscam004#17 = #dscaw068#5;
            #dscam004#3  = nLinea;
            |GRABA 020#dscam004.b;
            #dscam004#15 = #dscam003#27;
            #dscam004#0  = #dscam003#0;
            #dscam004#1  = #dscam003#1;
            #dscam004#2  = #dscam003#2;
            #dscam004#4  = #dscam012#14;
            #dscam004#5  = "FAP";
            #dscam004#6  = #dscaz139#6;
            #dscam004#7  = #dscam003#23;
            #dscam004#25 = #dscam003#61;
            #dscam004#11 = #dscam003#13;
            #dscam004#33 = #dscam003#59;
            #dscam004#43 = 0;
            #dscam004#44 = #dscam003#78;
            #dscam004#45 = #dscam003#79;
            #dscam004#46 = 0;
            #dscam004#47 = 0;
            |GRABA 020#dscam004.a; |LIBERA #dscam004;

            nTotLiquid = #dscam003#23; nTotPdte = #dscam003#55;
            #dscam003#55 = #dscam003#55 - #dscam013#41; #dscam003#68 = #dscam003#68 - #dscam013#41;
            #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
            #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
            #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
            #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
            #dscam003#31 = #dscam003#30;  #dscam003#65 = #dscam003#64;
            #dscam003#23 = 0;             #dscam003#61 = 0;
            |GRABA 020#dscam003.a; |LIBERA #dscam003;

            |HAZ DivideRec;

            |SI #dscaz139#5 ! "    "; |Y HayConta = 1;
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #dscaw013#Comodin#;
               |DELINDEX #dscaw013; |ABRE #dscaw013;

               Comodin = #dscaz139#5;
               |SI Comodin = "    ";
                  |ABRE #dscam093;
                  #dscam093#0 = "V";
                  |LEE 000#dscam093.=;
                  |SI FSalida = 0;
                     |SI #dscam012#22 = 6; Comodin = #dscam093#11; |FINSI;
                     |SI #dscam012#22 = 7; Comodin = #dscam093#13; |FINSI;
                  |FINSI;
                  |CIERRA #dscam093;
               |FINSI;

               aDatoSesion = ""; aEnlace = "";
               |ABRE #dscam030; |ABRE #dscam031;
               #dscam030#0 = Comodin;
               |LEE 101#dscam030.=;
               |SI FSalida = 0;
                  |SI #dscam030#8 ! "N";
                     aDatoSesion = #dscam030#8; #dscam030#8 = "N";
                     |GRABA 020#dscam030.a;
                  |FINSI;
                  |LIBERA #dscam030;

                  |DDEFECTO #dscam031;
                  #dscam031#0 = #dscam030#0;
                  |LEE 101#dscam031.];
                  |SI FSalida = 0; |Y #dscam031#0 = #dscam030#0;
                     fFechaEnlac = #dscam031#4;
                     #dscam031#4 = #dscaz139#6;
                     |GRABA 020#dscam031.a; |LIBERA #dscam031;
                  |FINSI;
               |FINSI;
               |CIERRA #dscam030; |CIERRA #dscam031;

               |DDEFECTO #dscaw013;
               #dscaw013#0  = 1;            #dscaw013#5  = #dscam004#17;
               #dscaw013#6  = #dscam004#17; #dscaw013#11 = "N";
               #dscaw013#12 = 10;           #dscaw013#13 = "dscam004";
               #dscaw013#14 = 17;           #dscaw013#15 = Comodin;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#0  = 2;            #dscaw013#5  = #dscam004#3;
               #dscaw013#6  = #dscam004#3;  #dscaw013#11 = "N";
               #dscaw013#12 = 3;            #dscaw013#13 = "dscam004";
               #dscaw013#14 = 3;            #dscaw013#15 = Comodin;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#0  = 3;            #dscaw013#7  = #dscam004#6;
               #dscaw013#8  = #dscam004#6;  #dscaw013#11 = "F";
               #dscaw013#12 = 10;           #dscaw013#13 = "dscam004";
               #dscaw013#14 = 6;            #dscaw013#15 = Comodin;
               |GRABA 020#dscaw013.n;

               aEnlace = Comodin;
               Comodin = "dscam033.tab;" + Comodin;

               |LIBERA #dscam004; |CIERRAT #dscam004;
               |LIBERA #dscam003; |CIERRAT #dscam003;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam003; |LEE 101#dscam003.=;
               |ABRET #dscam004; |LEE 101#dscam004.=;

               |ABRE #dscam030; |ABRE #dscam031;
               #dscam030#0 = aEnlace;
               |LEE 101#dscam030.=;
               |SI FSalida = 0;
                  |SI aDatoSesion ! "";
                     #dscam030#8 = aDatoSesion;
                     |GRABA 020#dscam031.a;
                  |FINSI;
                  |LIBERA #dscam030;

                  |DDEFECTO #dscam031;
                  #dscam031#0 = aEnlace;
                  |LEE 101#dscam031.];
                  |SI FSalida = 0; |Y #dscam031#0 = aEnlace;
                     #dscam031#4 = fFechaEnlac;
                     |GRABA 020#dscam031.a; |LIBERA #dscam031;
                  |FINSI;
               |FINSI;
               |CIERRA #dscam030; |CIERRA #dscam031;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;
         |FINSI;
      |SINO;
         #dscam003#40 = #dscaw068#5;
         |LEE 101#dscam003.=;
         |SI FSalida = 0;
            |DDEFECTO #dscam004;
            #dscam004#17 = #dscaw068#5;
            #dscam004#3 = 99;
            |LEE 000#dscam004.];
            |SI FSalida ! 0;
               |LEE 000#dscam004.u;
               |SI FSalida = 0; |Y #dscam004#17 = #dscaw068#5;
                  nLinea = #dscam004#3 + 1;
               |SINO;
                  nLinea = 1;
               |FINSI;
            |SINO;
               |SI #dscam004#17 = #dscaw068#5;
                  nLinea = #dscam004#3 + 1;
               |SINO;
                  |LEE 000#dscam004.a;
                  |SI FSalida = 0; |Y #dscam004#17 = #dscaw068#5;
                     nLinea = #dscam004#3 + 1;
                  |SINO;
                     nLinea = 1;
                  |FINSI;
               |FINSI;
            |FINSI;

            |DDEFECTO #dscam004;
            #dscam004#17 = #dscaw068#5;
            #dscam004#3  = nLinea;
            |GRABA 020#dscam004.b;
            #dscam004#15 = #dscam003#27;
            #dscam004#0  = #dscam003#0;
            #dscam004#1  = #dscam003#1;
            #dscam004#2  = #dscam003#2;
            #dscam004#4  = #dscam012#14;
            #dscam004#5  = "FAR";
            #dscam004#8  = #dscam013#41;
            #dscam004#26 = #dscam013#41;
            #dscam004#6  = #dscaz139#6;
            #dscam004#7  = #dscam003#23;
            #dscam004#25 = #dscam003#61;
            #dscam004#11 = #dscam003#13;
            #dscam004#33 = #dscam003#59;
            #dscam004#43 = 0;
            #dscam004#44 = #dscam003#78;
            #dscam004#45 = #dscam003#79;
            #dscam004#46 = 0;
            #dscam004#47 = 0;
            |GRABA 020#dscam004.a; |LIBERA #dscam004;

            #dscam003#55 = #dscam003#55 - #dscam013#41; #dscam003#68 = #dscam003#68 - #dscam013#41;
            #dscam003#23 = #dscam003#23 + #dscam013#41; #dscam003#61 = #dscam003#61 + #dscam013#41;
            #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
            #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
            #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
            #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
            |GRABA 020#dscam003.a; |LIBERA #dscam003;

            |SI #dscaz139#5 ! "    "; |Y HayConta = 1;
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #dscaw013#Comodin#;
               |DELINDEX #dscaw013; |ABRE #dscaw013;

               Comodin = #dscaz139#5;
               |SI Comodin = "    ";
                  |ABRE #dscam093;
                  #dscam093#0 = "V";
                  |LEE 000#dscam093.=;
                  |SI FSalida = 0;
                     |SI #dscam012#22 = 6; Comodin = #dscam093#11; |FINSI;
                     |SI #dscam012#22 = 7; Comodin = #dscam093#13; |FINSI;
                  |FINSI;
                  |CIERRA #dscam093;
               |FINSI;

               aDatoSesion = ""; aEnlace = "";
               |ABRE #dscam030; |ABRE #dscam031;
               #dscam030#0 = Comodin;
               |LEE 101#dscam030.=;
               |SI FSalida = 0;
                  |SI #dscam030#8 ! "N";
                     aDatoSesion = #dscam030#8; #dscam030#8 = "N";
                     |GRABA 020#dscam030.a;
                  |FINSI;
                  |LIBERA #dscam030;

                  |DDEFECTO #dscam031;
                  #dscam031#0 = #dscam030#0;
                  |LEE 101#dscam031.];
                  |SI FSalida = 0; |Y #dscam031#0 = #dscam030#0;
                     fFechaEnlac = #dscam031#4;
                     #dscam031#4 = #dscaz139#6;
                     |GRABA 020#dscam031.a; |LIBERA #dscam031;
                  |FINSI;
               |FINSI;
               |CIERRA #dscam030; |CIERRA #dscam031;

               |DDEFECTO #dscaw013;
               #dscaw013#0  = 1;            #dscaw013#5  = #dscam004#17;
               #dscaw013#6  = #dscam004#17; #dscaw013#11 = "N";
               #dscaw013#12 = 10;           #dscaw013#13 = "dscam004";
               #dscaw013#14 = 17;           #dscaw013#15 = Comodin;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#0  = 2;            #dscaw013#5  = #dscam004#3;
               #dscaw013#6  = #dscam004#3;  #dscaw013#11 = "N";
               #dscaw013#12 = 3;            #dscaw013#13 = "dscam004";
               #dscaw013#14 = 3;            #dscaw013#15 = Comodin;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#0  = 3;            #dscaw013#7  = #dscam004#6;
               #dscaw013#8  = #dscam004#6;  #dscaw013#11 = "F";
               #dscaw013#12 = 10;           #dscaw013#13 = "dscam004";
               #dscaw013#14 = 6;            #dscaw013#15 = Comodin;
               |GRABA 020#dscaw013.n;

               aEnlace = Comodin;
               Comodin = "dscam033.tab;" + Comodin;

               |LIBERA #dscam004; |CIERRAT #dscam004;
               |LIBERA #dscam003; |CIERRAT #dscam003;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam003; |LEE 101#dscam003.=;
               |ABRET #dscam004; |LEE 101#dscam004.=;

               |ABRE #dscam030; |ABRE #dscam031;
               #dscam030#0 = aEnlace;
               |LEE 101#dscam030.=;
               |SI FSalida = 0;
                  |SI aDatoSesion ! "";
                     #dscam030#8 = aDatoSesion;
                     |GRABA 020#dscam031.a;
                  |FINSI;
                  |LIBERA #dscam030;

                  |DDEFECTO #dscam031;
                  #dscam031#0 = aEnlace;
                  |LEE 101#dscam031.];
                  |SI FSalida = 0; |Y #dscam031#0 = aEnlace;
                     #dscam031#4 = fFechaEnlac;
                     |GRABA 020#dscam031.a; |LIBERA #dscam031;
                  |FINSI;
               |FINSI;
               |CIERRA #dscam030; |CIERRA #dscam031;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Pagare;
   #dscam013#0 = #dscam003#17;
   #dscam013#1 = #dscam003#37;
   |LEE 000#dscam013.=;
   |SI FSalida = 0;
       #dscam012#0 = #dscam003#17;
       |LEE 000#dscam012.=;
       |SI FSalida ! 0; |DDEFECTO #dscam012; |FINSI;

       enBanco = #dscam012#2;
       enEmpCartera = -1;      enEmpGestion = #dscam003#46;
       eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
       nImporte = #dscam013#7;
       eaTipoOper = "-6";
       |HAZ BucleRiesgo;

       eaUsuario = Usuario % 0810;
       |SI PARAMETRO = "RECUPERA";
          eaDescr   = "RECUPERACION FACTORING LINEA REMESA (";
       |SINO;
          eaDescr   = "PERDIDA FACTORING LINEA REMESA (";
       |FINSI;
       eaDescr   = eaDescr + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam013#1) % -103) + ") CON PAGARE ";
       eaDescr   = eaDescr + "(" + #dscam003#72 + "/" + #dscam003#70 + ")";
       eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
       eaTipoOp  = "V";   enImpAct = #dscam012#10; enImpAnt = #dscam012#10;
       |HAZ GrabaAudit;

       #dscam013#20 = "*"; #dscam013#15 = "S";
       |GRABA 020#dscam013.a;
   |FINSI;

   |SALVA_FICHA #dscam003;
   nRemesa = #dscam003#17; #dscaw068#5 = #dscam003#40; |HAZ PasaRecibo;
   |REPON_FICHA #dscam003;

   #dscaw076#0 = #dscam003#17;
   |LEE 000#dscaw076.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscaw076;
      #dscaw076#0 = #dscam003#17;
      |GRABA 020#dscaw076.n;
   |FINSI;
|FPRC;

|DEFBUCLE Pagare;
#dscam003#7;
;
#dscaw068#6, #dscaw068#7, 000000001;
#dscaw068#6, #dscaw068#7, 999999999;
;
NULL,Pagare;
|FIN;

|PROCESO VuelcaRecibos;
   |SI #dscaw068#6 ! "    "; |O #dscaw068#7 ! "          ";
      |BUCLE Pagare;
   |SINO;
      #dscaw076#0 = #dscaw068#0;
      |LEE 000#dscaw076.=;
      |SI FSalida ! 0;
         |DDEFECTO #dscaw076;
         #dscaw076#0 = #dscaw068#0;
         |GRABA 020#dscaw076.n;
      |FINSI;

      #dscam013#0 = #dscaw068#0;
      #dscam013#1 = #dscaw068#1;
      |LEE 000#dscam013.=;
      |SI FSalida ! 0; |DDEFECTO #dscam013; |FINSI;
      nRemesa = #dscaw068#0; |HAZ PasaRecibo;

      #dscam013#0 = #dscaw068#0;
      #dscam013#1 = #dscaw068#1;
      |LEE 101#dscam013.=;
      |SI FSalida = 0;
         #dscam012#0 = #dscaw068#0;
         |LEE 000#dscam012.=;
         |SI FSalida ! 0; |DDEFECTO #dscam012; |FINSI;

         enBanco = #dscam012#2;
         enEmpCartera = -1;      enEmpGestion = #dscam003#46;
         eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
         nImporte = #dscam013#7;
         eaTipoOper = "-6";
         |HAZ BucleRiesgo;

         eaUsuario = Usuario % 0810;
         |SI PARAMETRO = "RECUPERA";
            eaDescr   = "RECUPERACION FACTORING LINEA REMESA (";
         |SINO;
            eaDescr   = "PERDIDA FACTORING LINEA REMESA (";
         |FINSI;
         eaDescr   = eaDescr + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam013#1) % -103) + ") CON RECIBO ";
         eaDescr   = eaDescr + #dscam003#0 + "/" + #dscam003#1 + "/" + #dscam003#2;
         eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
         eaTipoOp  = "V";   enImpAct = #dscam012#10; enImpAnt = #dscam012#10;
         |HAZ GrabaAudit;

         #dscam013#20 = "*"; #dscam013#15 = "S";
         |GRABA 020#dscam013.a; |LIBERA #dscam013;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE VuelcaRecibos;
#dscaw068#1;
4;
00001,001,"*";
99999,999,"*";
;
NULL,VuelcaRecibos;
|FIN;

|PROCESO VuelcaDatos;
   aAlfa = "z9" + Usuario; |NOME_DAT #dscaw076#aAlfa#;
   |DELINDEX #dscaw076; |ABRE #dscaw076;
   |BUCLE BorraMarcas;
   |BUCLE VuelcaRecibos;
   |BUCLE BorraMarcas;
   |CIERRA #dscaw076;   |DELINDEX #dscaw076;
|FPRC;

|PROCESO RellenaTempo;
   |SI aEntidad ! "    "; |O aNumero ! "          ";
      |SI aEntidad = #dscam003#72; |Y aNumero = #dscam003#70; |ACABA; |FINSI;
      |SI #dscam003#71 > #dscaz139#4; |ACABA; |FINSI;
   |FINSI;

   |SI #dscam003#72 = "    "; |Y #dscam003#70 = "          ";
      |SI #dscam003#3 > #dscaz139#4; |ACABA; |FINSI;
   |FINSI;

   aEntidad = #dscam003#72; aNumero = #dscam003#70;

   #dscam012#0 = #dscam003#17;
   |LEE 000#dscam012.=;
   |SI FSalida ! 0; |ACABA; |FINSI;
   |SI #dscaz139#2 > #dscam012#1; |O #dscam012#1 > #dscaz139#3; |ACABA; |FINSI;
   |SI #dscam012#22 ! 6; |Y #dscam012#22 ! 7; |ACABA; |FINSI;
   |SI #dscam012#23 = "N"; |O #dscam012#8  = "N"; |ACABA; |FINSI;
   |SI #dscam012#2  ! #dscaz139#7; |ACABA; |FINSI;

   #dscam013#0 = #dscam003#17;
   #dscam013#1 = #dscam003#37;
   |LEE 000#dscam013.=;
   |SI FSalida ! 0; |ACABA; |FINSI;
   |SI #dscam013#15 ! "N"; |ACABA; |FINSI;

   |SI #dscam013#6 > #dscaz139#4; |ACABA; |FINSI;

   |SI #dscam012#0 ! nNumero;
      |SI nMarca = 1;
         nMarca = 2;
      |SINO;
         nMarca = 1;
      |FINSI;
      nNumero = #dscam012#0;
   |FINSI;

   |SI #dscam003#97 = "S"; |ACABA; |FINSI;
   |SI #dscam003#90 = "N"; |ACABA; |FINSI;

   enSwClas   = 1; eaFichClas = "dscam012"; eaTipoClas = #dscam003#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |ACABA; |FINSI;

   #dscam014#0 = #dscam012#2;
   |LEE 000#dscam014.=;
   |SI FSalida = 0;
      |SI #dscam014#40 = "N";
         |SI #dscam014#0 ! #dscam003#51; |Y #dscam051#7 = "S"; |ACABA; |FINSI;
      |FINSI;
   |FINSI;

   |SI #dscam051#2 = "N";
      Calc1 = #dscam012#1;
      Calc2 = #dscam003#3;
      NumDias = Calc2 - Calc1;
      |SI NumDias < 0; |ACABA; |FINSI;
   |FINSI;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   |DDEFECTO #dscaw068;
   #dscaw068#0 = #dscam003#17;
   #dscaw068#1 = #dscam003#37;
   #dscaw068#2 = #dscam003#3;
   |SI #dscam003#72 ! "    "; |O #dscam003#70 ! "          ";
      #dscaw068#3 = #dscam003#78 - ((#dscam003#78 % #dscam012#29) ! 2);
   |SINO;
      #dscaw068#5 = #dscam003#40;
      #dscaw068#3 = #dscam003#55;
   |FINSI;
   #dscaw068#4 = aMarca;
   #dscaw068#6 = #dscam003#72;
   #dscaw068#7 = #dscam003#70;
   #dscaw068#8 = nMarca;
   #dscaw068#9 = #dscam003#57;
   |GRABA 010#dscaw068.n;
|FPRC;

|DEFBUCLE RellenaTempo;
#dscam003#14;
;
#dscaz139#0,"    ", "          ",0000000001;
#dscaz139#1,"zzzz", "zzzzzzzzzz",9999999999;
;
NULL,RellenaTempo;
|FIN;

|RUTINA infw068;
   #dscaw068#0 = 1;
   #dscaw068#1 = 1;
|FRUT;

|RUTINA supw068;
   #dscaw068#0 = 99999;
   #dscaw068#1 = 999;
|FRUT;

|PROCESO LiberaPag;
   eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam003#40; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE LiberaPag;
#dscam003#7;
;
#dscaw068#6, #dscaw068#7, 000000001;
#dscaw068#6, #dscaw068#7, 999999999;
;
NULL, LiberaPag;
|FIN;

|PROCESO LiberaRecs;
   |SI #dscaw068#6 = "    "; |Y #dscaw068#7 = "          ";
      eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw068#5; |HAZ ProcesaTempo;
   |SINO;
      |BUCLE LiberaPag;
   |FINSI;
|FPRC;

|DEFBUCLE LiberaRecs;
#dscaw068#1;
;
INICIO;
FINAL;
;
NULL,LiberaRecs;
|FIN;

|PROCESO MiraParam; |TIPO 7;
   |SI #dscam051#1 = "S";
      Comodin = #dscam051#61;
      |C_M #dscaz139#5,1,Comodin;
   |SINO;
      |C_M #dscaz139#5,1,"N";
   |FINSI;
|FPRC;

|PROGRAMA;
   |HAZ Tipo8;

   |ABRE #dscam051;
   |LEE 010#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
   |FINSI;
   |CIERRA #dscam051;

   |CLS;
   |SI PARAMETRO = "RECUPERA";
      |CABEZA "Recuperacion retenciones factoring";
      |SI #dscam051#1 = "S"; #dscaz139#5 = #dscam051#102; |SINO; #dscaz139#5 = "    "; |FINSI;
   |SINO;
      |CABEZA "Perdida retenciones factoring";
      |SI #dscam051#1 = "S"; #dscaz139#5 = #dscam051#103; |SINO; #dscaz139#5 = "    "; |FINSI;
   |FINSI;
   |PINPA #0#0; |PINDA #0#0;
   |SI PARAMETRO = "RECUPERA";
      |ATRI R; |PINTA 0705, " RECUPERACION RETENCIONES FACTORING "; |ATRI N;
   |SINO;
      |ATRI R; |PINTA 0705, " PERDIDA RETENCIONES FACTORING "; |ATRI N;
   |FINSI;

   |ENDATOS #1#0;
   |SI FSalida = 0;
      |ABRE #dscam012; |ABRE #dscam013; |ABRE #dscam014;
      |ABRE #dscam004; |ABRE #dscam003;
      aAlfa = "rr" + Usuario; |NOME_DAT #dscaw068#aAlfa#;
      |DELINDEX #dscaw068; |ABRE #dscaw068;

      aMarca = " ";
      |BUCLE RellenaTempo;
      |PUSHV 0501 2380;
      |ENTLINEAL #1#dscaw068,-2,4,19,1,infw068,supw068;
      |POPV;
      |CONFI "    NConforme con los datos editados ?";
      |SI FSalida = 0;
         nLinea = 1; |HAZ VuelcaDatos;
      |FINSI;

      |BUCLE LiberaRecs;

      |CIERRA #dscam012; |CIERRA #dscam013; |CIERRA #dscam014;
      |CIERRA #dscam004; |CIERRA #dscam003;

      |CIERRA #dscaw068; |DELINDEX #dscaw068;
   |FINSI;

   eaSesion   = Usuario; |HAZ LimpiaTempo;

   |HAZ Tipo9;
|FPRO;
