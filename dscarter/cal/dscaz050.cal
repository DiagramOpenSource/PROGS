|FICHEROS;
   dscaz050 #0;
   dscam000 #1;

   dscam003 #2;
   dscam004 #3;

   dscam008 #14;
   dscam009 #15;

   dscam012 #4;
   dscam013 #5;

   dscam021 #6;
   dscam022 #7;

   dscam046 #8;
   dscam047 #9;

   dscam049 #10;
   dscam050 #11;

   dscam023 #12,MANTE;
   dscam024 #13;

   dscam016 #16;
   dscam017 #17;

   dscam020 #18,MANTE;
   dscaw039 #100;
|FIN;

|VARIABLES;
   &enEmpCartera = 0; &nDeci_Base  = 0; &nDeci_Div = 0;
   &HayConta = 0;     &HayGestion = 0;

   fFechaLim = @;
   aAlfa = "";
   Moneda = "P";
   TInteres = "";

   Sw = 0;

   nBaseAnt = 0;
   nNumero = 0;
   Redond  = 0;
   nCalc   = 0;
   nCont   = 0;
   nValor  = 0;
   nResult = 0;
   nEmpresa = 0;
|FIN;

|PROCESO MiraDatos;
   nCalc = #dscam003#60 ! 0;
   |SI nCalc ! #dscam003#60;
      |PARA nCont = 7; |SI nCont ] 0; |HACIENDO nCont = nCont - 1;
         |SI #dscam003#4 < fFechaLim;
            nCalc = #dscam003#60 ! nCont;
            |SI nCalc ! #dscam003#60; Redond = nCont + 1; |SAL; |FINSI;
         |FINSI;
      |SIGUE;
      |ERROR10;
   |SINO;
      Redond = 0;
   |FINSI;
|FPRC;

|DEFBUCLE MiraDatos;
#dscam003#1;
;
000000001;
999999999;
;
NULL,MiraDatos;
|FIN;

|PROCESO Marca; |TIPO 11;
   |SI FSalida = 10;
      |SI #dscaz050#3 = " ";
         |SI #dscaz050#2 = "   ";
            |HAZ MiraMoneda;
            |SI Moneda = ""; |ACABA; |FINSI;
            |SI Moneda = "P"; #dscaz050#2 = "PTA"; |FINSI;
            |SI Moneda = "E"; #dscaz050#2 = "EUR"; |FINSI;
         |FINSI;
         #dscaz050#3 = "*";
         nNumero = nNumero + 1;
      |SINO;
         #dscaz050#3 = " ";
         nNumero = nNumero - 1;
         |SI #dscaz050#4 = "N"; #dscaz050#2 = "   "; |PINTA #dscaz050#2; |FINSI;
      |FINSI;
      |GRABA 020#dscaz050.a; |PINTA #dscaz050#3;
   |FINSI;
|FPRC;

|PROCESO RellenaDatos;
   enEmpCartera = #dscam000#0; |HAZ Tipo8;

   nDeci_Base = 7; nDeci_Div = 7; Redond = -1;
   |DFICB aAlfa; |QBF aAlfa;
   aAlfa = aAlfa  + (("00000" + #dscam000#0) % -105) + "/";
   |PATH_DAT #2 aAlfa;

   |ABRE #dscam003; |BUCLE MiraDatos; |CIERRA #dscam003;

   |DDEFECTO #dscaz050;
   #dscaz050#0 = #dscam000#0;
   #dscaz050#1 = #dscam000#1;
   |SI Redond = 0; #dscaz050#2 = "PTA"; #dscaz050#4 = "S"; |FINSI;
   |SI Redond = 2; #dscaz050#2 = "EUR"; #dscaz050#4 = "S"; |FINSI;
   |GRABA 020#dscaz050.n;

   |HAZ Tipo9;
|FPRC;

|DEFBUCLE RellenaDatos;
#1#1;
;
INICIO;
FINAL;
;
NULL,RellenaDatos;
|FIN;

|RUTINA inf;
   #dscaz050#0 = 00000;
|FRUT;

|RUTINA sup;
   #dscaz050#0 = 99999;
|FRUT;

|PROCESO MiraMoneda;
   |PUSHV 1951 2179;
   |BLANCO 1951 2179;
   |CUADRO 1951 2179;
   |ATRI R; |PINTA 1952 , " Indique moneda base empresa "; |ATRI N;
   |PINTA 2057, "(Pesetas/Euros)";
   |ATRI I; |PINTA 2058, "P"; |PINTA 2066, "E"; |ATRI N;
   E_sup  = 1;
   E_inf  = "EP";
   Moneda = "P";
   Moneda = 2073 ? 0;
   |SI FSalida ! 0;
      Moneda = "";
   |FINSI;
   |POPV;
|FPRC;

|PROCESO Cambio;
   |SI Sw = 1; nResult = nValor; |ACABA; |FINSI;

   |SI #dscaz050#2 = "EUR"; nResult = (nValor * 166.386) ! 0; |FINSI;
   |SI #dscaz050#2 = "PTA"; nResult = (nValor / 166.386) ! 2; |FINSI;
|FPRC;

|PROCESO LRecsVenta;
   nValor = #dscam004#25; |HAZ Cambio; #dscam004#25 = nResult;
   nValor = #dscam004#26; |HAZ Cambio; #dscam004#26 = nResult;
   nValor = #dscam004#27; |HAZ Cambio; #dscam004#27 = nResult;
   nValor = #dscam004#28; |HAZ Cambio; #dscam004#28 = nResult;
   nValor = #dscam004#29; |HAZ Cambio; #dscam004#29 = nResult;
   nValor = #dscam004#30; |HAZ Cambio; #dscam004#30 = nResult;
   nValor = #dscam004#31; |HAZ Cambio; #dscam004#31 = nResult;
   nValor = #dscam004#32; |HAZ Cambio; #dscam004#32 = nResult;
   |SI #dscam003#57 = "ESP"; |Y #dscaz050#2 = "PTA";
       #dscam004#7  = #dscam004#25;
       #dscam004#8  = #dscam004#26;
       #dscam004#9  = #dscam004#27;
       #dscam004#10 = #dscam004#28;
       #dscam004#12 = #dscam004#29;
       #dscam004#13 = #dscam004#30;
       #dscam004#14 = #dscam004#31;
       #dscam004#23 = #dscam004#32;
   |FINSI;
   |GRABA 020#dscam004.a;
   #dscam003#61 = #dscam003#61 + #dscam004#26 - #dscam004#27;
|FPRC;

|DEFBUCLE LRecsVenta;
#dscam004#1;
;
#dscam003#40,01;
#dscam003#40,99;
be;
NULL,LRecsVenta;
|FIN;

|PROCESO RecsVenta;
   |SI #dscam003#4 ] fFechaLim; Sw = 1; |SINO; Sw = 0; |FINSI;
   nValor = #dscam003#56; |HAZ Cambio; #dscam003#56 = nResult;
   nValor = #dscam003#60; |HAZ Cambio; #dscam003#60 = nResult;
   nValor = #dscam003#61; |HAZ Cambio; #dscam003#61 = nResult;
   nValor = #dscam003#62; |HAZ Cambio; #dscam003#62 = nResult;
   nValor = #dscam003#63; |HAZ Cambio; #dscam003#63 = nResult;
   nValor = #dscam003#64; |HAZ Cambio; #dscam003#64 = nResult;
   nValor = #dscam003#65; |HAZ Cambio; #dscam003#65 = nResult;
   nValor = #dscam003#66; |HAZ Cambio; #dscam003#66 = nResult;
   nValor = #dscam003#67; |HAZ Cambio; #dscam003#67 = nResult;
   nValor = #dscam003#68; |HAZ Cambio; #dscam003#68 = nResult;
   nValor = #dscam003#79; |HAZ Cambio; #dscam003#79 = nResult;

   #dscam003#61 = 0;
   |BUCLE LRecsVenta;
   #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
   #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
   #dscam003#65 = #dscam003#64 - #dscam003#61;
   |SI #dscam003#57 = "ESP"; |Y #dscaz050#2 = "PTA";
      #dscam003#22 = #dscam003#60;
      #dscam003#23 = #dscam003#61;
      #dscam003#24 = #dscam003#62;
      #dscam003#25 = #dscam003#63;
      #dscam003#30 = #dscam003#64;
      #dscam003#31 = #dscam003#65;
      #dscam003#38 = #dscam003#66;
      #dscam003#54 = #dscam003#67;
      #dscam003#55 = #dscam003#68;
      #dscam003#79 = #dscam003#78;
      #dscam003#57 = "EUR";
      #dscam003#58 = "EURO";
   |FINSI;
   #dscam003#59 = #dscam003#64 / #dscam003#30;

   |GRABA 020#dscam003.a;
|FPRC;

|DEFBUCLE RecsVenta;
#dscam003#1;
;
000000001;
999999999;
be;
NULL,RecsVenta;
|FIN;

|PROCESO LRecsCompra;
   nValor = #dscam009#20; |HAZ Cambio; #dscam009#20 = nResult;
   nValor = #dscam009#21; |HAZ Cambio; #dscam009#21 = nResult;
   nValor = #dscam009#22; |HAZ Cambio; #dscam009#22 = nResult;
   nValor = #dscam009#23; |HAZ Cambio; #dscam009#23 = nResult;
   nValor = #dscam009#24; |HAZ Cambio; #dscam009#24 = nResult;

   |SI #dscam008#59 = "ESP"; |Y #dscaz050#2 = "PTA";
      #dscam009#7  = #dscam009#20;
      #dscam009#8  = #dscam009#21;
      #dscam009#11 = #dscam009#23;
      #dscam009#12 = #dscam009#24;
   |FINSI;
   #dscam009#25 = #dscam009#21 / #dscam009#8;

   |GRABA 020#dscam009.a;
   #dscam008#57 = #dscam008#57 + #dscam009#21 + #dscam009#23 + #dscam009#24;
|FPRC;

|DEFBUCLE LRecsCompra;
#dscam009#1;
;
#dscam008#40,01;
#dscam008#40,99;
be;
NULL,LRecsCompra;
|FIN;

|PROCESO RecsCompra;
   |SI #dscam008#4 ] fFechaLim; Sw = 1; |SINO; Sw = 0; |FINSI;
   nValor = #dscam008#53; |HAZ Cambio; #dscam008#53 = nResult;
   nValor = #dscam008#54; |HAZ Cambio; #dscam008#54 = nResult;
   nValor = #dscam008#55; |HAZ Cambio; #dscam008#55 = nResult;
   #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55;
   #dscam008#57 = 0;
   |BUCLE LRecsCompra;

   #dscam008#58 = #dscam008#56 - #dscam008#57;
   |SI #dscam008#59 = "ESP"; |Y #dscaz050#2 = "PTA";
      #dscam008#59 = "EUR";
      #dscam008#60 = "EURO";
      #dscam008#22 = #dscam008#53;
      #dscam008#24 = #dscam008#54;
      #dscam008#38 = #dscam008#55;
      #dscam008#25 = #dscam008#56;
      #dscam008#23 = #dscam008#57;
      #dscam008#31 = #dscam008#58;
   |FINSI;
   #dscam008#61 = #dscam008#58 / #dscam008#31;
   |GRABA 020#dscam008.a;
|FPRC;

|DEFBUCLE RecsCompra;
#dscam008#1;
;
000000001;
999999999;
be;
NULL,RecsCompra;
|FIN;

|PROCESO LinRemesas;
   #dscam003#40 = #dscam013#16;
   |LEE 000#dscam003.=;
   |SI #dscam003#4 ] fFechaLim; Sw = 1; |SINO; Sw = 0; |FINSI;

   || Calculo si el interes como anual y si no es igual, es que es diario
   |SI #dscam013#10 ! 0;
      nCalc = ((#dscam013#7 %  #dscam013#9)/365) * #dscam013#8;
      |SI nCalc = #dscam013#10;
         TInteres = "A";
      |SINO;
         nCalc = (#dscam013#7 %  #dscam013#9) * #dscam013#8;
         |SI nCalc = #dscam013#10;
            TInteres = "D";
         |SINO;
            TInteres = "?";
         |FINSI;
      |FINSI;
   |FINSI;

   nBaseAnt = #dscam013#22 * #dscam013#23;
   nValor = #dscam013#7;  |HAZ Cambio; #dscam013#7  = nResult;
   nValor = #dscam013#22; |HAZ Cambio; #dscam013#22 = nResult;
   #dscam012#10 = #dscam012#10 + #dscam013#7;
   |SI #dscam013#12 = "S";
      #dscam012#13 = #dscam012#13 + #dscam013#7;
   |FINSI;

   |SI TInteres = "A"; #dscam013#10 = ((#dscam013#7 % #dscam013#9)/365) * #dscam013#8; |FINSI;
   |SI TInteres = "D"; #dscam013#10 = (#dscam013#7 % #dscam013#9) * #dscam013#8;       |FINSI;
   |SI TInteres = "?"; nValor = #dscam013#10; |HAZ Cambio; #dscam013#10 = nResult;     |FINSI;

   #dscam013#21 = #dscam013#22 / #dscam013#7;
   #dscam013#23 = #dscam013#22 / nBaseAnt;
   |GRABA 020#dscam013.a;

   #dscam012#12 = #dscam012#12 + #dscam013#10;
|FPRC;

|DEFBUCLE LinRemesas;
#dscam013#1;
;
#dscam012#0,001;
#dscam012#0,999;
be;
NULL,LinRemesas;
|FIN;

|PROCESO Remesas;
   #dscam012#10 = 0; #dscam012#12 = 0; #dscam012#13 = 0;
   |BUCLE LinRemesas;
   nValor = #dscam012#6; |HAZ Cambio; #dscam012#6 = nResult;
   #dscam012#11 = #dscam012#5 * #dscam012#6;
   |GRABA 020#dscam012.a;
|FPRC;

|DEFBUCLE Remesas;
#dscam012#1;
;
00001;
99999;
be;
NULL,Remesas;
|FIN;

|PROCESO LinPagares;
   nBaseAnt = #dscam022#7 * #dscam022#22;
   #dscam008#40 = #dscam022#13;
   |LEE 000#dscam008.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscam008;
      #dscam008#22 = #dscam008#53 - 1;
   |SINO;
      |SI #dscam008#4 ] fFechaLim; Sw = 1; |SINO; Sw = 0; |FINSI;
   |FINSI;

   nValor = #dscam022#19; |HAZ Cambio; #dscam022#19 = nResult;
   |SI #dscam008#22 = #dscam008#53; #dscam022#7 = #dscam022#19; |FINSI;

   #dscam022#22 = nBaseAnt / #dscam022#7;
   #dscam022#23 = #dscam022#19 / #dscam022#7;
   |GRABA 020#dscam022.a;

   #dscam021#9  = #dscam021#9  + #dscam022#7;
   #dscam021#17 = #dscam021#17 + #dscam022#19;
|FPRC;

|DEFBUCLE LinPagares;
#dscam022#1;
;
#dscam021#0,001;
#dscam021#0,999;
;
NULL,LinPagares;
|FIN;

|PROCESO Pagares;
   #dscam021#9  = 0;
   #dscam021#17 = 0;
   |BUCLE LinPagares;
   #dscam021#20 = #dscam021#17 / #dscam021#9;
   #dscam021#18 = #dscam008#59; #dscam021#19 = #dscam008#60;
   |GRABA 020#dscam021.a;
|FPRC;

|DEFBUCLE Pagares;
#dscam021#1;
;
00001;
99999;
be;
NULL,Pagares;
|FIN;

|PROCESO LinTalones;
   #dscam008#40 = #dscam047#13;
   |LEE 000#dscam008.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscam008;
      #dscam008#22 = #dscam008#53 - 1;
   |SINO;
      |SI #dscam008#4 ] fFechaLim; Sw = 1; |SINO; Sw = 0; |FINSI;
   |FINSI;

   nValor = #dscam047#18; |HAZ Cambio; #dscam047#18 = nResult;
   |SI #dscam008#22 = #dscam008#53; #dscam047#7 = #dscam047#18; |FINSI;
   |GRABA 020#dscam047.a;

   #dscam046#9  = #dscam046#9  + #dscam047#7;
   #dscam046#17 = #dscam046#17 + #dscam047#18;
   #dscam046#18 = #dscam008#59; #dscam046#19 = #dscam008#60;
|FPRC;

|DEFBUCLE LinTalones;
#dscam047#1;
;
#dscam046#0,001;
#dscam046#0,999;
;
NULL,LinTalones;
|FIN;

|PROCESO Talones;
   #dscam046#9  = 0;
   #dscam046#17 = 0;
   |BUCLE LinTalones;
   #dscam046#20 = #dscam046#17 / #dscam046#9;
   |GRABA 020#dscam046.a;
|FPRC;

|DEFBUCLE Talones;
#dscam046#1;
;
00001;
99999;
be;
NULL,Talones;
|FIN;

|PROCESO LinConfirmes;
   #dscam008#40 = #dscam050#13;
   |LEE 000#dscam008.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscam008;
      #dscam008#22 = #dscam008#53 - 1;
   |SINO;
      |SI #dscam008#4 ] fFechaLim; Sw = 1; |SINO; Sw = 0; |FINSI;
   |FINSI;

   nValor = #dscam050#20; |HAZ Cambio; #dscam050#20 = nResult;
   |SI #dscam008#22 = #dscam008#53; #dscam050#7 = #dscam050#20; |FINSI;
   |GRABA 020#dscam050.a;

   #dscam049#9  = #dscam049#9  + #dscam050#7;
   #dscam049#19 = #dscam049#19 + #dscam050#20;
|FPRC;

|DEFBUCLE LinConfirmes;
#dscam050#1;
;
#dscam049#0,001;
#dscam049#0,999;
;
NULL,LinConfirmes;
|FIN;

|PROCESO Confirmes;
   #dscam049#9  = 0;
   #dscam049#19 = 0;
   |BUCLE LinConfirmes;
   #dscam049#18 = #dscam049#19 / #dscam049#9;
   #dscam049#16 = #dscam008#59; #dscam049#17 = #dscam008#60;
   |GRABA 020#dscam049.a;
|FPRC;

|DEFBUCLE Confirmes;
#dscam049#1;
;
00001;
99999;
be;
NULL,Confirmes;
|FIN;

|PROCESO LinAsigna;
   #dscam003#40 = #dscam017#9;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      #dscam017#7  = #dscam003#31;
      #dscam017#10 = #dscam003#57;
      #dscam017#11 = #dscam003#59;
      #dscam016#4 = #dscam016#4 + #dscam017#7;
      |GRABA 020#dscam017.a;
   |FINSI;
|FPRC;

|DEFBUCLE LinAsigna;
#dscam017#1;
;
#dscam016#0,001;
#dscam016#0,999;
be;
NULL,LinAsigna;
|FIN;

|PROCESO Asigna;
   |ABRE #dscam003;
   #dscam016#4 = 0;
   |BUCLE LinAsigna;
   |GRABA 020#dscam016.a;
   |CIERRA #dscam003;
|FPRC;

|DEFBUCLE Asigna;
#dscam016#1;
;
00001;
99999;
be;
NULL,Asigna;
|FIN;

|PROCESO ConvLRiesgo;
   nValor = #dscam024#2; |HAZ Cambio; #dscam024#2 = nResult;
   nValor = #dscam024#3; |HAZ Cambio; #dscam024#3 = nResult;
   nValor = #dscam024#4; |HAZ Cambio; #dscam024#4 = nResult;
   nValor = #dscam024#5; |HAZ Cambio; #dscam024#5 = nResult;
   nValor = #dscam024#6; |HAZ Cambio; #dscam024#6 = nResult;
   nValor = #dscam024#7; |HAZ Cambio; #dscam024#7 = nResult;
   nValor = #dscam024#8; |HAZ Cambio; #dscam024#8 = nResult;
   nValor = #dscam024#9; |HAZ Cambio; #dscam024#9 = nResult;
   #dscam023#20 = #dscam023#20 + #dscam023#8;
|FPRC;

|DEFBUCLE ConvLRiesgo;
#dscam024#1;
;
#dscam023#0,01;
#dscam023#0,99;
be;
NULL,ConvLRiesgo;
|FIN;

|PROCESO ActLRiesgo;
   #dscam024#9 = #dscam023#19 - #dscam023#20; |GRABA 020#dscam024.a;
|FPRC;

|DEFBUCLE ActLRiesgo;
#dscam024#1;
;
#dscam023#0,01;
#dscam023#0,99;
be;
NULL,ActLRiesgo;
|FIN;

|PROCESO ConvRiesgo;
   aAlfa = " Procesando Riesgo Cliente " + #dscam023#0 + " Empresa " + (("00000" + enEmpCartera) % -105) + " ";
   |ATRI R; |PINTA 2310, aAlfa; |ATRI N;

   #dscam023#20 = 0;
   |BUCLE ConvLRiesgo;

   nValor = #dscam023#11; |HAZ Cambio; #dscam023#11 = nResult;
   nValor = #dscam023#13; |HAZ Cambio; #dscam023#13 = nResult;
   nValor = #dscam023#15; |HAZ Cambio; #dscam023#15 = nResult;
   nValor = #dscam023#17; |HAZ Cambio; #dscam023#17 = nResult;
   nValor = #dscam023#19; |HAZ Cambio; #dscam023#19 = nResult;
   |GRABA 020#dscam023.a; |LIBERA #dscam023;

   |BUCLE ActLRiesgo;
|FPRC;

|DEFBUCLE ConvRiesgo;
#dscam023#1;
;
"      ";
"zzzzzz";
be;
NULL,ConvRiesgo;
|FIN;

|PROCESO ConvMantRie;
   nValor = #dscam020#15; |HAZ Cambio; #dscam020#15 = nResult;
   nValor = #dscam020#17; |HAZ Cambio; #dscam020#17 = nResult;
   |GRABA 020#dscam020.a; |LIBERA #dscam020;
|FPRC;

|DEFBUCLE ConvMantRie;
#dscam020#1;
;
000,"                    ";
999,"zzzzzzzzzzzzzzzzzzzz";
be;
NULL,ConvMantRie;
|FIN;

|PROCESO Convierte;

   enEmpCartera = #dscaz050#0; |HAZ Tipo8;

   |DFICB aAlfa; |QBF aAlfa;
   aAlfa = aAlfa  + (("00000" + #dscam000#0) % -105) + "/";
   |PATH_DAT #2  aAlfa; |PATH_DAT #3  aAlfa;
   |PATH_DAT #4  aAlfa; |PATH_DAT #5  aAlfa;
   |PATH_DAT #6  aAlfa; |PATH_DAT #7  aAlfa;
   |PATH_DAT #8  aAlfa; |PATH_DAT #9  aAlfa;
   |PATH_DAT #10 aAlfa; |PATH_DAT #11 aAlfa;
   |PATH_DAT #12 aAlfa; |PATH_DAT #13 aAlfa;
   |PATH_DAT #14 aAlfa; |PATH_DAT #15 aAlfa;

   |ABRE #dscam003; |ABRE #dscam004;
   |ABRE #dscam008; |ABRE #dscam009;

|| Conversion de los recibos de venta y las lineas del recibo
||        Importes Base, Importes divisa (si cabe), recalculo del cambio de la divisa
   aAlfa = " Procesando recibos venta Empresa " + (("00000" + enEmpCartera) % -105) + "         ";
   |ATRI R; |PINTA 2310, aAlfa; |ATRI N;
   |SI #dscaw039#0 = "S"; |BUCLE RecsVenta; |FINSI;

|| Conversion de los recibos de compra y las lineas del recibo
||        Importes Base, Importes divisa (si cabe), recalculo del cambio de la divisa

   aAlfa = " Procesando recibos compra Empresa " + (("00000" + enEmpCartera) % -105) + "        ";
   |ATRI R; |PINTA 2310, aAlfa; |ATRI N;
   |SI #dscaw039#1 = "S"; |BUCLE RecsCompra; |FINSI;

|| Conversion de remesas (se busca el importe en el recibo y si este
||    no existe, convierte los importes)

   aAlfa = " Procesando Remesas Empresa " + (("00000" + enEmpCartera) % -105) + "               ";
   |ATRI R; |PINTA 2310, aAlfa; |ATRI N;
   |SI #dscaw039#2 = "S"; |BUCLE Remesas; |FINSI;

|| Conversion de pagares, talones y confirmes (Importes base, Importes divisa (si cabe), cambio divisa)

   aAlfa = " Procesando Pagares Empresa " + (("00000" + enEmpCartera) % -105) + "               ";
   |ATRI R; |PINTA 2310, aAlfa; |ATRI N;
   |SI #dscaw039#3 = "S"; |BUCLE Pagares; |FINSI;
   aAlfa = " Procesando Talones Empresa " + (("00000" + enEmpCartera) % -105) + "               ";
   |ATRI R; |PINTA 2310, aAlfa; |ATRI N;
   |SI #dscaw039#4 = "S"; |BUCLE Talones; |FINSI;
   aAlfa = " Procesando Confirmes Empresa " + (("00000" + enEmpCartera) % -105) + "             ";
   |ATRI R; |PINTA 2310, aAlfa; |ATRI N;
   |SI #dscaw039#5 = "S"; |BUCLE Confirmes; |FINSI;

|| Conversion de Asignaciones a cobradores (Mantenimiento)
   Sw = 0;
   aAlfa = " Procesando Asign.Cobradores Empresa " + (("00000" + enEmpCartera) % -105) + "      ";
   |ATRI R; |PINTA 2310, aAlfa; |ATRI N;
   |SI #dscaw039#7 = "S"; |BUCLE Asigna; |FINSI;

|| Conversion de riesgo de cliente (Clasificacion de riesgo y mantenimiento)

   |SI #dscaw039#6 = "S";
      |BUCLE ConvMantRie; |BUCLE ConvRiesgo;

      aAlfa = " Recalculando riesgos Empresa " + (("00000" + enEmpCartera) % -105) + "             ";
      |ATRI R; |PINTA 2310, aAlfa; |ATRI N;
      |SUB_EJECUTA_NP "dscaz034.tab;ext";
   |FINSI;
   |CIERRA #dscam009; |CIERRA #dscam008;
   |CIERRA #dscam004; |CIERRA #dscam003;

|SI #dscaz050#2 = "EUR"; #dscaz050#2 = "PTA"; |FINSI;
|SI #dscaz050#2 = "PTA"; #dscaz050#2 = "EUR"; |FINSI;
|GRABA 020#dscaz050.a;
|FPRC;

|DEFBUCLE Convierte;
#dscaz050#1;
3;
00000,"*";
99999,"*";
;
NULL,Convierte;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA "Conversion de moneda";
   |ATRI R; |PINTA 0503, "CONVERSION DE MONEDA"; |ATRI N;
   |PINPA #0#dscaz050; |PINDA #0#dscaz050;

   nEmpresa = #48#0;
   |DFICB aAlfa; |QBF aAlfa; |PATH_DAT #1 aAlfa;
   |DELINDEX #dscaz050; |ABRE #dscaz050;

   |ENCAMPO #5#dscaz050; fFechaLim = #dscaz050#5;
   |SI FSalida ! 0; |CIERRA #dscaz050; |ACABA; |FINSI;

   |ATRI I; |PINTA 2330, " Procesando empresas "; |ATRI N;
   nNumero = 0;
   |BUCLE RellenaDatos;
   |ENTLINEAL #1#dscaz050,-1,4,21,1,inf,sup;
   |SI nNumero > 0;
      |CONFI "    NContinuar con la conversion de moneda ? ";
      |SI FSalida = 0;
         |BUCLE Convierte;
      |FINSI;
      |POPV;
   |FINSI;

   |CIERRA #dscaz050;

   #48#0 = nEmpresa; |LEE 000#48=;

   |DFICB aAlfa; |QBF aAlfa;
   aAlfa = aAlfa  + (("00000" + #48#0) % -105) + "/";
   |PATH_DAT #2  aAlfa; |PATH_DAT #3  aAlfa;
   |PATH_DAT #4  aAlfa; |PATH_DAT #5  aAlfa;
   |PATH_DAT #6  aAlfa; |PATH_DAT #7  aAlfa;
   |PATH_DAT #8  aAlfa; |PATH_DAT #9  aAlfa;
   |PATH_DAT #10 aAlfa; |PATH_DAT #11 aAlfa;
   |PATH_DAT #12 aAlfa; |PATH_DAT #13 aAlfa;
   |PATH_DAT #14 aAlfa; |PATH_DAT #15 aAlfa;
   |PATH_DAT #16 aAlfa; |PATH_DAT #17 aAlfa;
|FPRO;
