|FICHEROS;
   dscaz147 #0;

   dscam030 #10;
   dscam067 #11;

   canempr@ #100;
   camasic@ #101;
|FIN;

|VARIABLES;
   aAlfa  = "";
   aAlfa1 = "";

   nCalc1 = 0;
   nCalc2 = 0;
   nCont  = 0;
   nPeriodo = 0;
|FIN;

|PROCESO Depuracion;
   #dscam030#0 = #dscam067#10;
   |LEE 000#dscam030.=;
   |SI FSalida = 0;
      aAlfa  = #dscam030#6; |QBF aAlfa;
      aAlfa1 = aAlfa + "def/camaasic.mas";
      |CARGA_DEF aAlfa1, camasic@;
      |SI FSalida = 0;
         aAlfa1 = aAlfa + "def/canempre.mas";
         |CARGA_DEF aAlfa1, canempr@;
         aAlfa1 = aAlfa + "fich/"; |PATH_DAT #canempr@#aAlfa1#;

         nPeriodo = #dscam067#9;
         |ABRE #canempr@;
         #canempr@#2 = #dscam067#8;
         #canempr@#3 = #dscam067#9;
         |LEE 000#canempr@.=;
         |SI FSalida = 0;
            aAlfa1 = #dscam067#5; |QBF aAlfa1;
            aAlfa1 = aAlfa1 % 0704; nCalc1 = aAlfa1;
            nCalc2 = #canempr@#26;
            |SI nCalc2 ] 80;
               nCalc2 = nCalc2 + 1900;
            |SINO;
               nCalc2 = nCalc2 + 2000;
            |FINSI;
            |SI nCalc1 ! nCalc2;
               nPeriodo = -1;
               |PARA nCont = 0; |SI nCont [ 9; |HACIENDO nCont = nCont + 1;
                  #canempr@#2 = #dscam067#8;
                  #canempr@#3 = nCont;
                  |LEE 000#canempr@.=;
                  |SI FSalida = 0;
                     nCalc2 = #canempr@#26;
                     |SI nCalc2 ] 80;
                        nCalc2 = nCalc2 + 1900;
                     |SINO;
                        nCalc2 = nCalc2 + 2000;
                     |FINSI;
                     |SI nCalc1 = nCalc2; nPeriodo = nCont; |SAL; |FINSI;
                  |FINSI;
               |SIGUE;
            |FINSI;
         |FINSI;
         |CIERRA #canempr@; |DESCARGA_DEF #canempr@;

         |SI nPeriodo ! -1;
            aAlfa1 = aAlfa + "fich/" + (("00000" + #dscam067#8) % -105) + nPeriodo + "/";
            |PATH_DAT #camasic@#aAlfa1#; |ABRE #camasic@;
            #camasic@#0 = #dscam067#4;
            #camasic@#1 = #dscam067#5;
            #camasic@#2 = #dscam067#6;
            |LEE 000#camasic@.=;
            |SI FSalida ! 0;
               |BORRA 020#dscam067.a;
            |FINSI;
            |CIERRA #camasic@; |DESCARGA_DEF #camasic@;
         |SINO;
            |BORRA 020#dscam067.a;
         |FINSI;
      |FINSI;
   |SINO;
      aAlfa = "    No se encuentra el enlace (" + #dscam067#10 + ") para obtener el camino de la contabilidad. Proceso cancelado.";
      |MENAV aAlfa; |ERROR10;
   |FINSI;
|FPRC;

|DEFBUCLE Depuracion;
#dscam067#1;
;
INICIO;
FINAL;
be;
NULL, Depuracion;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA "Depuracion historico enlaces";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0; |Y #0#0 = "S";
      |ABRE #dscam030;
      |BUCLE Depuracion;
      |CIERRA #dscam030;
   |FINSI;
|FPRO;
