|FICHEROS;
   cadie004 #0;
   cadie502 #1;
   cadie503 #2;

   dscam003 #10;
   dscam004 #11;
|FIN;

|VARIABLES;
   &Divisa    = "";
   DesdeRep   = "";
   HastaRep   = "";
   aAntRep    = "ZZZZ";

   Primero    = 0;
   nTotalPend = 0;
   nPendAnt   = 0;
   nComiDev   = 0;
|FIN;

|PROCESO Listado;
   |SI aAntRep ! #cadie503#13;
      |SI Primero = 0;
         Primero = 1;
      |SINO;
         |PIEINF;
      |FINSI;
      aAntRep = #cadie503#13;
   |FINSI;
   |PRINT;
|FPRC;

|DEFBUCLE Listado;
#cadie503#2;
;
#cadie004#0,"  ";
#cadie004#0,"zz";
;
NULL,Listado;
|FIN;

|PROCESO BuscaAnt;
   nPendAnt = nPendAnt + #cadie503#10;
   nComiDev = nComiDev + #cadie503#12;
|FPRC;

|DEFBUCLE BuscaAnt;
#cadie503#1;
;
#dscam003#40,"01.01.0000";
#dscam003#40,#cadie004#0;
;
NULL,BuscaAnt;
|FIN;

|PROCESO RecibosLin;
   nTotalPend = nTotalPend - (#dscam004#44 - #dscam004#46);
|FPRC;

|DEFBUCLE RecibosLin;
#dscam004#4;
;
"RPT",#dscam003#40;
"RPT",#dscam003#40;
;
NULL,RecibosLin;
|FIN;

|PROCESO Historico1;
   #dscam003#40 = #cadie502#0;
   |LEE 000#dscam003.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   nTotalPend = #dscam003#31;
   |SI #dscam003#14 = "T"; |BUCLE RecibosLin; |FINSI;
   |SI #dscam003#14 = "A"; |O #dscam003#14 = "D"; nTotalPend = 0; |FINSI;
   |SI #cadie502#13 = nTotalPend; |ACABA; |FINSI;

   |SI #cadie004#1 = "S";
      |DDEFECTO #cadie503;
      #cadie503#0 = #dscam003#40;
      #cadie503#8 = "01.01.0000";
      |LEE 000#cadie503.];
      |SI FSalida = 0; |Y #cadie503#0 = #dscam003#40;
         |SI #cadie503#8  = #cadie004#0;
            |BORRA 020#cadie503.a;
         |SINO;
            |ACABA;
         |FINSI;
      |FINSI;

      nPendAnt = 0; nComiDev = 0;
      |BUCLE BuscaAnt;

      |DDEFECTO #cadie503;
      #cadie503#0  = #cadie502#0;
      #cadie503#1  = #cadie502#1;
      #cadie503#2  = #cadie502#2;
      #cadie503#3  = #cadie502#3;
      #cadie503#4  = #cadie502#4;
      #cadie503#5  = #cadie502#5;
      #cadie503#6  = #cadie502#6;
      #cadie503#7  = #cadie502#8;
      #cadie503#8  = #cadie004#0;
      || #cadie503#9  = #cadie502#13 - nPendAnt;
      |SI nPendAnt = 0;
         #cadie503#9 = #cadie502#13;
      |SINO;
         #cadie503#9 = nPendAnt;
      |FINSI;
      #cadie503#10 = nTotalPend;
      #cadie503#11 = #cadie502#10;
      #cadie503#12 = ((#cadie503#9 - #cadie503#10) * #cadie502#10) / #cadie502#9;
      #cadie503#13 = #dscam003#33;
      #cadie503#14 = #dscam003#34;
      |GRABA 020#cadie503.c;
   |FINSI;
|FPRC;

|DEFBUCLE Historico1;
#cadie502#1;
;
INICIO;
FINAL;
;
NULL,Historico1;
|FIN;

|PROGRAMA;
   |HAZ Tipo8;

   |ABRE #cadie004;
   |LEE 000#cadie004.p;
   |SI FSalida ! 0;
      |DDEFECTO #cadie004;
      |GRABA 020#cadie004.c;
   |FINSI;

   |ABRE #dscam003; |ABRE #cadie503;
   |CLS;
   |CABEZA " Listado devolucion comisiones retrocedidas recibos vencidos";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |IMPRE 0;
      |SI FSalida ! 0; |ACABA; |FINSI;
      |INFOR "cadie004";
      |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

      |SI #cadie004#1 = "S"; |BUCLE Historico1; |FINSI;
      |BUCLE Listado;

      |PIEINF; |FININF;
      |FINIMP;
   |FINSI;
   |CIERRA #cadie503; |CIERRA #dscam003;
   |CIERRA #cadie004;

   |HAZ Tipo9;
|FPRO;
