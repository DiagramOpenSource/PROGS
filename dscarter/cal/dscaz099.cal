|FICHEROS;
   dscaz099 #0;

   dscam003 #10;
   dscam004 #11;

   dscam044 #12;
   dscam045 #13;

   dscam012 #16;
   dscam013 #14;
   dscam051 #15;

   dscam017 #20;

   dscaw072 #100,MANTE;

   agifa134@ #1000;
   agifa084@ #1001;

   dscaw027 #27; ||TMP
|FIN;

|VARIABLES;
   nNume = 0;
   nNumeB = 0;
   &eaFichero = "";

   &eaDocum  = "";
   &eaComent = "";
   &eaEntrada = "";
   &eaSalida = "";
   &Divisa   = ""; &nDeci_Div = 0; &nDeci_Base = 0;

   nPendteD = 0; nPendteB = 0;
   nGtosDevD = 0; nGtosNegD = 0; nOtrosGtosD = 0;
   nGtosDevB = 0; nGtosNegB = 0; nOtrosGtosB = 0;
   nDesctoD = 0; nDesctoB = 0;
   nDespreD = 0; nDespreB = 0;
   nCompD   = 0; nCompB   = 0;
   aEstado = "";
   nSwRecDiv = 0;
   nHandle   = 0;
   nSwError  = 0;
   nSwError1 = 0;
   nLinea    = 0;
   fFechaHoy = @;
   aAlfa     = "";

   aFichero    = "";
   aDsCorreoIP = "";
   aDirOrigen  = "";
   aDirDestino = "";
   aServidor   = "";
   aAsunto     = "";
   aTexto      = "";
|FIN;

|PROCESO MovtosEntregas;
   |SI #dscam004#5 = "RAC";
      nCompD = nCompD + #dscam004#8; nCompB = nCompB + #dscam004#26;
      nCompD = nCompD ! 2; nCompB = nCompB ! 2;
      aEstado = "e";
   |FINSI;
   |SI #dscam004#5 = "REC";
      nCompD = nCompD + #dscam004#8; nCompB = nCompB + #dscam004#26;
      nCompD = nCompD ! 2; nCompB = nCompB ! 2;
      |SI nCompD = 0; aEstado = "L"; |SINO; aEstado = "E"; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE MovtosEntregas;
#dscam004#1;
;
#dscam003#40,01;
#dscam003#40,99;
be;
NULL,MovtosEntregas;
|FIN;

|PROCESO Movimientos;
     |SI #dscam004#5 = "RAC";
          aEstado = "p";
     |FINSI;

     |SI #dscam004#5 = "RPT";
          nGtosDevD   = nGtosDevD   + #dscam004#13; nGtosDevB   = nGtosDevB   + #dscam004#30;
          nGtosNegD   = nGtosNegD   + #dscam004#12; nGtosNegB   = nGtosNegB   + #dscam004#29;
          nOtrosGtosD = nOtrosGtosD + #dscam004#14; nOtrosGtosB = nOtrosGtosB + #dscam004#31;
          nPendteD = nPendteD + (#dscam004#9  + #dscam004#12 + #dscam004#13 + #dscam004#14);
          nPendteB = nPendteB + (#dscam004#27 + #dscam004#29 + #dscam004#30 + #dscam004#31);
          aEstado = "T";
          |SI #dscam003#17 ! 0;
               |ABRE #dscam013;
               #dscam013#0 = #dscam003#17;
               #dscam013#1 = 0;
               |LEE 000#dscam013.];
               |PARA; |SI FSalida = 0; |HACIENDO;
                    |SI #dscam013#16 = #dscam003#40; |Y #dscam013#15 ! "R";
                         |SAL;
                    |FINSI;
                    |LEE 000#dscam013.s;
               |SIGUE;
               |CIERRA #dscam013;
               |SI #dscam013#16 = #dscam003#40; |Y #dscam013#15 ! "R";
                    aEstado = "R";
               |FINSI;
          |FINSI;
     |FINSI;

     |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "RCE"; |O #dscam004#5 = "IMA";
          nGtosDevD   = nGtosDevD   + #dscam004#13;
          nGtosNegD   = nGtosNegD   + #dscam004#12;
          nOtrosGtosD = nOtrosGtosD + #dscam004#14;
          nGtosDevB   = nGtosDevB   + #dscam004#30;
          nGtosNegB   = nGtosNegB   + #dscam004#29;
          nOtrosGtosB = nOtrosGtosB + #dscam004#31;
          nPendteD = nPendteD + (#dscam004#9  + #dscam004#12 + #dscam004#13 + #dscam004#14);
          nPendteB = nPendteB + (#dscam004#27 + #dscam004#29 + #dscam004#30 + #dscam004#31);
          |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "IMA";
               aEstado = "I";
          |SINO;
               nPendteD = nPendteD ! 2; nPendteB = nPendteB ! 2;
               |SI nPendteD = #dscam003#30; aEstado = "L"; |SINO; aEstado = "C"; |FINSI;
          |FINSI;
     |FINSI;

     |SI #dscam004#5 = "COB"; |O #dscam004#5 = "CAC"; |O #dscam004#5 = "COP";
               |O #dscam004#5 = "RTA";
          |SI #dscam004#23 ! 0; |Y #dscam004#32 = 0;
               #dscam004#32 = #dscam004#23 * #dscam004#33;
               |GRABA 020#dscam004.a;
          |FINSI;
          |SI #dscam004#22 = "D";
               nDesctoD = nDesctoD + #dscam004#23; nDesctoB = nDesctoB + #dscam004#32;
          |FINSI;
          |SI #dscam004#22 = "E";
               nDespreD = nDespreD + #dscam004#23; nDespreB = nDespreB + #dscam004#32;
          |FINSI;
          ||*** T14331  29/05/2019
          nGtosDevD   = nGtosDevD   + #dscam004#13;
          nGtosNegD   = nGtosNegD   + #dscam004#12;
          nOtrosGtosD = nOtrosGtosD + #dscam004#14;
          nGtosDevB   = nGtosDevB   + #dscam004#30;
          nGtosNegB   = nGtosNegB   + #dscam004#29;
          nOtrosGtosB = nOtrosGtosB + #dscam004#31;
          nNume = #dscam004#13 + #dscam004#12 + #dscam004#14;
          nNumeB = #dscam004#30 + #dscam004#29 + #dscam004#31;
          ||***
          nPendteD = nPendteD - (#dscam004#8 + #dscam004#23) + nNume;
          nPendteB = nPendteB - (#dscam004#26 + #dscam004#32) + nNumeB;
          nPendteD = nPendteD ! 2; nPendteB = nPendteB ! 2;
          |SI nPendteD = 0; aEstado = "L"; |SINO; aEstado = "C"; |FINSI;
     |FINSI;

     |SI #dscam004#5 = "EMR";
          aEstado = "R";
     |FINSI;

     |SI #dscam004#5 = "REM"; |O #dscam004#5 = "RCB";
          |HAZ EsArtenvas;
          |SI FSalida ! 0;
               |SI #dscam004#9 ! 0;
                    #dscam004#9 = 0; #dscam004#27 = 0;
                    |GRABA 020#dscam004.a;
               |FINSI;
               nPendteD = nPendteD - #dscam004#8;
               nPendteB = nPendteB - #dscam004#26;
               |SI #dscam003#47 = "S"; |Y #dscam004#5 = "REM";
                    aEstado = "e";
               |SINO;
                    aEstado = "L";
               |FINSI;
         |SINO;
               |SI #dscam004#5 = "REM";
                    |SI #dscam003#47 = "S";
                         |SI #dscam004#9 ! 0;
                              #dscam004#9 = 0; #dscam004#27 = 0;
                              |GRABA 020#dscam004.a;
                         |FINSI;
                         aEstado = "R";

                         |ABRE #dscam013; |SELECT #2#dscam013;
                         #dscam013#16 = #dscam004#17;
                         #dscam013#17 = #dscam004#3;
                         |LEE 000#dscam013.=;
                         |SI FSalida = 0;
                              |SI #dscam013#15 = "S";
                                   aEstado = "e";
                                   nPendteD = nPendteD - #dscam004#8;
                                   nPendteB = nPendteB - #dscam004#26;
                              |FINSI;
                         |FINSI;
                         |SELECT #1#dscam013; |CIERRA #dscam013;
                    |SINO;
                         aEstado = "R";

                         |ABRE #dscam013; |SELECT #2#dscam013;
                         #dscam013#16 = #dscam004#17;
                         #dscam013#17 = #dscam004#3;
                         |LEE 000#dscam013.=;
                         |SI FSalida = 0;
                              |SI #dscam013#15 = "S";
                                   aEstado = "L";
                                   nPendteD = nPendteD - #dscam004#8;
                                   nPendteB = nPendteB - #dscam004#26;
                               |FINSI;
                         |FINSI;
                         |SELECT #1#dscam013; |CIERRA #dscam013;
                    |FINSI;
               |SINO;
                    |SI #dscam004#9 ! 0;
                         #dscam004#9 = 0; #dscam004#27 = 0;
                         |GRABA 020#dscam004.a;
                    |FINSI;
                    nPendteD = nPendteD - #dscam004#8;
                    nPendteB = nPendteB - #dscam004#26;
                    |SI #dscam003#47 = "S";
                         aEstado = "e";
                    |SINO;
                         aEstado = "L";
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Movimientos;
     #dscam004#1;
     ;
     #dscam003#40,01;
     #dscam003#40,99;
     be;
     NULL,Movimientos;
|FIN;

|PROCESO RevisaMovs;
   |SI #dscam004#5 ! "RAC"; |Y #dscam004#5 ! "EMR"; |Y #dscam004#5 ! "REM";
      nSwError1 = -1; |ERROR10;
  |FINSI;
|FPRC;

|DEFBUCLE RevisaMovs;
#dscam004#1;
;
#dscam003#40,01;
#dscam003#40,99;
be;
NULL,RevisaMovs;
|FIN;

|PROCESO RevisaMovsEnt;
   |SI #dscam004#5 ! "RAC"; |Y #dscam004#5 ! "REC";
      nSwError1 = -1; |ERROR10;
  |FINSI;
|FPRC;

|DEFBUCLE RevisaMovsEnt;
#dscam004#1;
;
#dscam003#40,01;
#dscam003#40,99;
be;
NULL,RevisaMovsEnt;
|FIN;

|PROCESO Recibos;
   |SI #dscam003#69 = " ";
      |SI #dscam003#47 = "S";
         nSwError1 = 0;
         |BUCLE RevisaMovs;
         |SI nSwError1 ! 0; |ACABA; |FINSI;
      |FINSI;
      |SI #dscam003#14 = "A"; |O #dscam003#14 = "D"; |ACABA; |FINSI;

      aEstado = "P"; nPendteD = #dscam003#22; nPendteB = #dscam003#60;
      nGtosDevD = 0; nGtosNegD = 0; nOtrosGtosD = 0;
      nGtosDevB = 0; nGtosNegB = 0; nOtrosGtosB = 0;
      nDesctoD = 0; nDesctoB = 0;
      nDespreD = 0; nDespreB = 0;

      |SI #dscam003#17 ! 0; |O #dscam003#37 ! 0;
         |ABRE #dscam013;
         #dscam013#0 = #dscam003#17;
         #dscam013#1 = #dscam003#37;
         |LEE 000#dscam013.=;
         |SI FSalida = 0; aEstado = "R"; |FINSI;
         |CIERRA #dscam013;
      |FINSI;

      Divisa = #dscam003#57; |HAZ TomaDecim;

      |BUCLE Movimientos;
      nPendteD = nPendteD ! 2; nPendteB = nPendteB ! 2;
      |SI #dscaz099#2 ! "E";
         |SI aEstado ! #dscam003#14; |O nPendteD ! #dscam003#31;
            |SI #dscam003#14 = "N"; |Y aEstado = "P";
               |SI #dscam003#22 = 0; |Y #dscam003#30 = 0; |Y #dscam003#23 = 0;
                |Y #dscam003#31 = 0;
                  |VETE Salir;
               |FINSI;
            |FINSI;
            |SI #dscam003#14 = "M"; |Y aEstado = "P";
               |ABRE #dscam017; |SELECT #2#dscam017;
               #dscam017#9 = #dscam003#40;
               |LEE 000#dscam017.=;
               |SI FSalida = 0;
                  |SELECT #2#dscam017; |CIERRA #dscam017;
                  |VETE Salir;
               |FINSI;
               |SELECT #2#dscam017; |CIERRA #dscam017;
            |FINSI;
            eaDocum = ("0000000000" + #dscam003#40) % -110;
            |SI aEstado ! #dscam003#14;
               eaComent = " El estado del recibo no era correcto. (";
               eaComent = eaComent + #dscam003#14 + "/" + aEstado + ")";
            |FINSI;
            |SI nPendteD ! #dscam003#31;
               eaComent = " Los totales no eran correctos. (Pdte.";
               eaComent = eaComent + #dscam003#31 + "/" + nPendteD + ")";
            |FINSI;
            |PRINT;
         |FINSI;
      |SINO;
         |DDEFECTO #dscaw072;
         #dscaw072#0  = #dscam003#40;
         #dscaw072#1  = #dscam003#0;
         #dscaw072#2  = #dscam003#1;
         #dscaw072#3  = #dscam003#2;
         #dscaw072#4  = #dscam003#32;
         #dscaw072#5  = #dscam003#6;
         #dscaw072#6  = #dscam003#4;
         #dscaw072#7  = #dscam003#14;
         |SI #dscam003#14 = "L"; #dscaw072#8  = "Liquidado"; |FINSI;
         |SI #dscam003#14 = "P"; #dscaw072#8  = "Pendiente"; |FINSI;
         |SI #dscam003#14 = "I"; #dscaw072#8  = "Impagado "; |FINSI;
         |SI #dscam003#14 = "R"; #dscaw072#8  = "Remesado "; |FINSI;
         #dscaw072#10 = #dscam003#22;
         |GRABA 020#dscaw072.n;
      |FINSI;

      |SI #dscaz099#2 = "R";
         nSwRecDiv = 0;
         #dscam044#0 = #dscam003#46;
         |LEE 000#dscam044.=;
         |SI FSalida = 0;
            aAlfa = #dscam044#1; |QBF aAlfa;
            aAlfa = aAlfa + "def/agifa134.mas";
            |CARGA_DEF aAlfa, agifa134@;
            |SI FSalida = 0;
               nSwRecDiv = 1;

               aAlfa = #dscam044#1; |QBF aAlfa;
               aAlfa = aAlfa + "def/agifa084.mas";
               |CARGA_DEF aAlfa, agifa084@;

               aAlfa = #dscam044#1; |QBF aAlfa;
               aAlfa = aAlfa + "fich/" + (("00000" + #dscam044#0) % -105) + "/";
               |PATH_DAT #agifa134@#aAlfa#; |ABRE #agifa134@;
               |PATH_DAT #agifa084@#aAlfa#; |ABRE #agifa084@;

               #agifa134@#49 = #dscam003#0;
               #agifa134@#0  = #dscam003#1;
               |LEE 000#agifa134@.=;
               |SI FSalida = 0; |Y #agifa134@#1 = #dscam003#4; |Y #agifa134@#2 = #dscam003#32;
                  |SI #dscam003#57 = #agifa134@#58;
                     #dscam003#59 = #agifa134@#62 / #agifa134@#59;

                     #dscam003#60 = (#dscam003#22 * #dscam003#59) ! 2;
                     #dscam003#64 = (#dscam003#30 * #dscam003#59) ! 2;
                     #dscam003#65 = (#dscam003#31 * #dscam003#59) ! 2;
                     #dscam003#61 = (#dscam003#23 * #dscam003#59) ! 2;

                     nPendteB = (nPendteD * #dscam003#59) ! 2;
                  |FINSI;
               |SINO;
                  #agifa084@#48 = #dscam003#0;
                  #agifa084@#0  = #dscam003#1;
                  |LEE 000#agifa084@.=;
                  |SI FSalida = 0; |Y #agifa084@#1 = #dscam003#4; |Y #agifa084@#3 = #dscam003#32;
                     |SI #dscam003#57 = #agifa084@#65;
                        #dscam003#59 = #agifa084@#69 / #agifa084@#66;

                        #dscam003#60 = #dscam003#22 * #dscam003#59;
                        #dscam003#64 = #dscam003#30 * #dscam003#59;
                        #dscam003#65 = #dscam003#31 * #dscam003#59;
                        #dscam003#61 = #dscam003#23 * #dscam003#59;

                        nPendteB = (nPendteD * #dscam003#59) ! 2;
                     |FINSI;
                  |FINSI;
               |FINSI;

               |CIERRA #agifa084@; |DESCARGA_DEF #agifa084@;
               |CIERRA #agifa134@; |DESCARGA_DEF #agifa134@;
            |FINSI;
         |FINSI;

         #dscam003#24 = nGtosNegD; #dscam003#25 = nGtosDevD;
         #dscam003#38 = nOtrosGtosD;
         #dscam003#54 = nDesctoD;  #dscam003#55 = nDespreD;
         #dscam003#62 = nGtosNegB; #dscam003#63 = nGtosDevB;
         #dscam003#66 = nOtrosGtosB;
         #dscam003#67 = nDesctoB;  #dscam003#68 = nDespreB;
         #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
         #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
         #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
         #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
         #dscam003#31 = nPendteD ! 2;
         #dscam003#65 = nPendteB ! 2;
         #dscam003#23 = #dscam003#30 - #dscam003#31;
         #dscam003#61 = #dscam003#64 - #dscam003#65;
         #dscam003#14 = aEstado;
         |SI aEstado = "I"; #dscam003#15 = "Impagado";                |FINSI;
         |SI aEstado = "L"; #dscam003#15 = "Recibo liquidado";        |FINSI;
         |SI aEstado = "C"; #dscam003#15 = "Cobrado parcialmente";    |FINSI;
         |SI aEstado = "p"; #dscam003#15 = "Entrega pdte.cobro";      |FINSI;
         |SI aEstado = "e"; #dscam003#15 = "Pendiente de compensar";  |FINSI;
         |SI aEstado = "P";
            |SI #dscam003#17 ! 0;
               |ABRE #dscam013;
               #dscam013#0 = #dscam003#17;
               #dscam013#1 = 0;
               |LEE 000#dscam013.];
               |PARA; |SI FSalida = 0; |HACIENDO;
                  |SI #dscam013#16 = #dscam003#40; |Y #dscam013#15 ! "R";
                     |SAL;
                  |FINSI;
                  |LEE 000#dscam013.s;
               |SIGUE;
               |CIERRA #dscam013;
               |SI #dscam013#16 = #dscam003#40; |Y #dscam013#15 ! "R";
                  #dscam003#14 = "R";
                  #dscam003#15 = "Remesado";
               |FINSI;
            |SINO;
               #dscam003#15 = "Pendiente de cobro";
            |FINSI;
         |FINSI;
         |SI aEstado = "T"; #dscam003#15 = "Pagare/talon de cliente"; |FINSI;
         |SI aEstado = "R"; #dscam003#15 = "Remesado";                |FINSI;
         |GRABA 020#dscam003.a;
      |FINSI;
      |ET Salir;
   |SINO;
      nSwError1 = 0;
      |BUCLE RevisaMovsEnt;
      |SI nSwError1 ! 0; |ACABA; |FINSI;
      |SI #dscam003#14 = "A"; |O #dscam003#14 = "D"; |ACABA; |FINSI;

      aEstado = "p"; nCompD = 0; nCompB = 0;
      Divisa = #dscam003#57; |HAZ TomaDecim;

      |BUCLE MovtosEntregas;
      nCompD = nCompD ! 2; nCompB = nCompB ! 2;

      |SI #dscaz099#2 ! "E";
         |SI aEstado ! #dscam003#14; |O nPendteD ! #dscam003#31;
            eaDocum = ("0000000000" + #dscam003#40) % -110;
            |SI aEstado ! #dscam003#14;
               eaComent = " El estado del recibo no era correcto. (";
               eaComent = eaComent + #dscam003#14 + "/" + aEstado + ")";
            |FINSI;
            |SI nCompD ! #dscam003#30;
               eaComent = " Los totales no eran correctos. (Pdte.";
               eaComent = eaComent + #dscam003#30 + "/" + nCompD + ")";
            |FINSI;
            |PRINT;
         |FINSI;
      |SINO;
         |DDEFECTO #dscaw072;
         #dscaw072#0  = #dscam003#40;
         #dscaw072#1  = #dscam003#0;
         #dscaw072#2  = #dscam003#1;
         #dscaw072#3  = #dscam003#2;
         #dscaw072#4  = #dscam003#32;
         #dscaw072#5  = #dscam003#6;
         #dscaw072#6  = #dscam003#4;
         #dscaw072#7  = #dscam003#14;
         |SI #dscam003#14 = "L"; #dscaw072#8  = "Liquidado"; |FINSI;
         |SI #dscam003#14 = "P"; #dscaw072#8  = "Pendiente"; |FINSI;
         |SI #dscam003#14 = "I"; #dscaw072#8  = "Impagado "; |FINSI;
         |SI #dscam003#14 = "R"; #dscaw072#8  = "Remesado "; |FINSI;
         #dscaw072#10 = #dscam003#22;
         |GRABA 020#dscaw072.n;
      |FINSI;

      |SI #dscaz099#2 = "R";
         #dscam003#55 = #dscam003#22 - nCompD; #dscam003#68 = #dscam003#60 - nCompB;
         #dscam003#23 = nCompD; #dscam003#61 = nCompB;
         #dscam003#30 = nCompD; #dscam003#64 = nCompB;
         #dscam003#31 = 0; #dscam003#65 = 0;

         #dscam003#14 = aEstado;
         |SI aEstado = "p"; #dscam003#15 = "Entrega pdte.cobro     "; |FINSI;
         |SI aEstado = "e"; #dscam003#15 = "Pendiente de compensar "; |FINSI;
         |SI aEstado = "E"; #dscam003#15 = "Compensado parcialmente"; |FINSI;
         |SI aEstado = "L"; #dscam003#15 = "Recibo compensado";       |FINSI;
         |GRABA 020#dscam003.a;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Recibos;
#dscam003#3;
0,1,17;
#dscaz099#3,#dscaz099#0,#dscaz099#5,#dscaz099#7,#dscaz099#9;
#dscaz099#4,#dscaz099#1,#dscaz099#6,#dscaz099#8,#dscaz099#10;
be;
NULL,Recibos;
|FIN;

|RUTINA infw072;
   #dscaw072#0 = 0;
|FRUT;

|RUTINA supw072;
   #dscaw072#0 = 9999999999;
|FRUT;

|RUTINA inf;
   #dscam004#17 = #dscam003#40;
   #dscam004#3 = 1;
|FRUT;

|RUTINA sup;
   #dscam004#17 = #dscam003#40;
   #dscam004#3 = 99;
|FRUT;

|PROCESO MarcaTodos;
   |SI #dscaw072#7 = "P"; |O #dscaw072#7 = "L";
      #dscaw072#9 = "*"; |GRABA 020#dscaw072.a;
   |FINSI;
|FPRC;

|DEFBUCLE MarcaTodos;
#dscaw072#1;
;
INICIO;
FINAL;
;
NULL,MarcaTodos;
|FIN;

|PROCESO DesmarcaTodos;
   #dscaw072#9 = " "; |GRABA 020#dscaw072.a;
|FPRC;

|DEFBUCLE DesmarcaTodos;
#dscaw072#1;
;
INICIO;
FINAL;
;
NULL,DesmarcaTodos;
|FIN;

|PROCESO Tipo11; |TIPO 11;
   |SI FSalida = 10;
      |SI #dscaw072#9 = " ";
         #dscaw072#9 = "*"; |GRABA 020#dscaw072.a;
      |SINO;
         #dscaw072#9 = " "; |GRABA 020#dscaw072.a;
      |FINSI;
   |FINSI;
   |SI FSalida = 11;
      |SALVA_FICHA #dscaw072;
      |BUCLE MarcaTodos;
      |REPON_FICHA #dscaw072;
      |PONCONTROL 23, "si";
   |FINSI;
   |SI FSalida = 12;
      |SALVA_FICHA #dscaw072;
      |BUCLE DesmarcaTodos;
      |REPON_FICHA #dscaw072;
      |PONCONTROL 23, "si";
   |FINSI;
   |SI FSalida = 13;
      |SI #dscaw072#7 = "L";
         #dscaw072#7 = "P"; #dscaw072#8 = "Pendiente ";
      |SINO;
         #dscaw072#7 = "L"; #dscaw072#8 = "Liquidado ";
      |FINSI;
      |SI #dscaw072#9 = " "; #dscaw072#9 = "*"; |FINSI;
      |GRABA 020#dscaw072.a;
      |PONCONTROL 23, "si";
   |FINSI;
   |SI FSalida = 9;
      |PUSHV 05012380;
      |ABRE #dscam003;
      #dscam003#40 = #dscaw072#0;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         Divisa = #dscam003#57; |HAZ TomaDecim;
         |PINPA #0#dscam003; |PINDA #0#dscam003;
         |ENTLINEAL #1#dscam004,-2,1,20,1,inf,sup;
         |PINPA #0#dscam003; |PINDA #0#dscam003;
         |PAUSA;
      |FINSI;
      |CIERRA #dscam003;
      |POPV;
   |FINSI;
|FPRC;

|PROCESO BorraMovtos;
   |BORRA 020#dscam004.a;
|FPRC;

|DEFBUCLE BorraMovtos;
#dscam004#1;
;
#dscam003#40,001;
#dscam003#40,999;
;
NULL,BorraMovtos;
|FIN;

|PROCESO InicializaRec;
   |BUCLE BorraMovtos;
   #dscam003#24 = 0; #dscam003#25 = 0; #dscam003#38 = 0;
   #dscam003#62 = 0; #dscam003#63 = 0; #dscam003#66 = 0;
   #dscam003#30 = #dscam003#22; #dscam003#64 = #dscam003#60;
   #dscam003#23 = 0;            #dscam003#31 = #dscam003#30;
   #dscam003#61 = 0;            #dscam003#65 = #dscam003#64;
   #dscam003#26 = "01.01.0000";
   #dscam003#14 = "P";
   #dscam003#15 = "Pendiente de cobro";
|FPRC;

|PROCESO Regenera;
   |SI #dscaw072#7 = " "; |ACABA; |FINSI;

   #dscam003#40 = #dscaw072#0;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      Divisa = #dscam003#57; |HAZ TomaDecim;
      |SI #dscaw072#7 = "L";
         |SI #dscam003#31 = 0;
            |HAZ InicializaRec;
         |FINSI;
      |SINO;
         |HAZ InicializaRec;
      |FINSI;
      |SI #dscaw072#7 = "L";
         nLinea = 1;

         #dscam004#17 = #dscam003#40;
         #dscam004#3 = 99;
         |LEE 000#dscam004.];
         |SI FSalida = 0;
            |SI #dscam004#17 ! #dscam003#40;
               |LEE 000#dscam004.a;
               |SI FSalida = 0;
                  |SI #dscam004#17 = #dscam003#40;
                     nLinea = #dscam004#3 + 1;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            |LEE 000#dscam004.u;
            |SI FSalida = 0;
               |SI #dscam004#17 = #dscam003#40;
                  nLinea = #dscam004#3 + 1;
               |FINSI;
            |FINSI;
         |FINSI;

         |DDEFECTO #dscam004;
         #dscam004#0 = #dscam003#0;
         #dscam004#1 = #dscam003#1;
         #dscam004#2 = #dscam003#2;
         #dscam004#3 = nLinea;
         #dscam004#5 = "COB";
         aAlfa = #dscam003#3; |QBF aAlfa;
         |SI aAlfa = "01.01.1900";
            aAlfa = #dscam003#4; |QBF aAlfa;
         |FINSI;
         #dscam004#6 = aAlfa;
         #dscam004#7 = 0;            #dscam004#25 = 0;
         #dscam004#8 = #dscam003#30; #dscam004#26 = #dscam003#64;
         #dscam004#15 = #dscam003#27;
         #dscam004#17 = #dscam003#40;
         #dscam004#33 = 1;
         |GRABA 020#dscam004.n;

         #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
         #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66;
         #dscam003#23 = #dscam003#30; #dscam003#31 = 0;
         #dscam003#61 = #dscam003#64; #dscam003#65 = 0;
         #dscam003#14 = "L";
         #dscam003#15 = "Recibo liquidado";
         #dscam003#26 = aAlfa;
      |FINSI;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;
|FPRC;

|DEFBUCLE Regenera;
#dscaw072#1;
9,7;
0000000001,"*","!";
9999999999,"*","z";
;
NULL,Regenera;
|FIN;

|PROCESO PonDesc;
   |SI #dscaw072#7 = " "; #dscaw072#8 = "          "; |FINSI;
   |SI #dscaw072#7 = "L"; #dscaw072#8 = "Liquidado "; |FINSI;
   |SI #dscaw072#7 = "P"; #dscaw072#8 = "Pendiente "; |FINSI;
   |PINTA #dscaw072#8;
|FPRC;

|PROCESO EnviaCorreo;
   |DFICE aAlfa; |QBF aAlfa;
   aFichero = aAlfa + "estado.txt";

   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |CIERRA #dscam051;

   aAlfa = #dscam051#81; |QBF aAlfa;
   aAlfa = aAlfa + "." + #dscam051#82; |QBF aAlfa;
   aAlfa = aAlfa + "." + #dscam051#83; |QBF aAlfa;
   aAlfa = aAlfa + "." + #dscam051#84; |QBF aAlfa;
   |SI aAlfa = "0.0.0.0"; |ACABA; |FINSI;

   aDsCorreoIP = aAlfa;
   aDirOrigen  = #dscam051#90;
   aDirDestino = #dscam051#91;
   aServidor   = #dscam051#88; |QBF aServidor;
   aAsunto     = " Resultado chequeo totales recibos venta ";
   aTexto      = "$$$$" + aFichero;
   |SI #dscam051#89 = "S";
      eaEntrada = #dscam051#92; |HAZ Encriptado;
      aAlfa = eaSalida;             |QBF aAlfa; aAlfa = aAlfa + ":";
      aAlfa = aAlfa + #dscam051#86; |QBF aAlfa; aAlfa = aAlfa + ":";
      aDirOrigen = aAlfa + aDirOrigen;
   |FINSI;

   |DSCORREO_ENVIA aDsCorreoIP, aServidor, aDirOrigen, aDirDestino, aAsunto, aTexto, aFichero;
   |SI FSalida < 0;
      |MENAV "    Problemas al enviar correo";
   |FINSI;
|FPRC;

|PROCESO MovtosRemoto;
   |SI #dscam004#5 = "RPT";
      nGtosDevD   = nGtosDevD   + #dscam004#13; nGtosDevB   = nGtosDevB   + #dscam004#30;
      nGtosNegD   = nGtosNegD   + #dscam004#12; nGtosNegB   = nGtosNegB   + #dscam004#29;
      nOtrosGtosD = nOtrosGtosD + #dscam004#14; nOtrosGtosB = nOtrosGtosB + #dscam004#31;
      nPendteD = nPendteD + (#dscam004#9  + #dscam004#12 + #dscam004#13 + #dscam004#14);
      nPendteB = nPendteB + (#dscam004#27 + #dscam004#29 + #dscam004#30 + #dscam004#31);
      aEstado = "T";

      |SI #dscam003#17 ! 0;
         |ABRE #dscam013;
         #dscam013#0 = #dscam003#17;
         #dscam013#1 = 0;
         |LEE 000#dscam013.];
         |PARA; |SI FSalida = 0; |HACIENDO;
            |SI #dscam013#16 = #dscam003#40; |Y #dscam013#15 ! "R";
               |SAL;
            |FINSI;
            |LEE 000#dscam013.s;
         |SIGUE;
         |CIERRA #dscam013;
         |SI #dscam013#16 = #dscam003#40; |Y #dscam013#15 ! "R";
            aEstado = "R";
         |FINSI;
      |FINSI;
   |FINSI;
   |SI #dscam004#5 = "IMP"; |O #dscam004#5 = "RCE";
      nGtosDevD   = nGtosDevD   + #dscam004#13;
      nGtosNegD   = nGtosNegD   + #dscam004#12;
      nOtrosGtosD = nOtrosGtosD + #dscam004#14;
      nGtosDevB   = nGtosDevB   + #dscam004#30;
      nGtosNegB   = nGtosNegB   + #dscam004#29;
      nOtrosGtosB = nOtrosGtosB + #dscam004#31;
      nPendteD = nPendteD + (#dscam004#9  + #dscam004#12 + #dscam004#13 + #dscam004#14);
      nPendteB = nPendteB + (#dscam004#27 + #dscam004#29 + #dscam004#30 + #dscam004#31);
      |SI #dscam004#5 = "IMP";
          aEstado = "I";
      |SINO;
         nPendteD = nPendteD ! 2; nPendteB = nPendteB ! 2;
         |SI nPendteD = #dscam003#30; aEstado = "L"; |SINO; aEstado = "C"; |FINSI;
      |FINSI;
   |FINSI;
   |SI #dscam004#5 = "COB"; |O #dscam004#5 = "CAC"; |O #dscam004#5 = "COP";
    |O #dscam004#5 = "RTA";
      |SI #dscam004#23 ! 0; |Y #dscam004#32 = 0;
         #dscam004#32 = #dscam004#23 * #dscam004#33;
         |GRABA 020#dscam004.a;
      |FINSI;
      nPendteD = nPendteD - (#dscam004#8 + #dscam004#23);
      nPendteB = nPendteB - (#dscam004#26 + #dscam004#32);
      nPendteD = nPendteD ! 2; nPendteB = nPendteB ! 2;
      |SI nPendteD = 0; aEstado = "L"; |SINO; aEstado = "C"; |FINSI;
   |FINSI;
   |SI #dscam004#5 = "EMR";
      aEstado = "R";
   |FINSI;
   |SI #dscam004#5 = "REM"; |O #dscam004#5 = "RCB";
      nPendteD = nPendteD - #dscam004#8;
      nPendteB = nPendteB - #dscam004#26;
      |SI #dscam004#9 ! 0;
         #dscam004#9 = 0; #dscam004#27 = 0;
         |GRABA 020#dscam004.a;
      |FINSI;
      |SI #dscam003#47 = "S"; |Y #dscam004#5 = "REM";
         aEstado = "e";
      |SINO;
         aEstado = "L";
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE MovtosRemoto;
#dscam004#1;
;
#dscam003#40,01;
#dscam003#40,99;
be;
NULL,MovtosRemoto;
|FIN;

|PROCESO RecsRemoto;
   |SI #dscam003#14 = "A"; |O #dscam003#14 = "D"; |ACABA; |FINSI;

   aEstado = "P"; nPendteD = #dscam003#22; nPendteB = #dscam003#60;
   nGtosDevD = 0; nGtosNegD = 0; nOtrosGtosD = 0;
   nGtosDevB = 0; nGtosNegB = 0; nOtrosGtosB = 0;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   |BUCLE MovtosRemoto;
   nPendteD = nPendteD ! 2; nPendteB = nPendteB ! 2;

   |SI aEstado ! #dscam003#14; |O nPendteD ! #dscam003#31;
      |SI #dscam003#14 = "N"; |Y aEstado = "P";
         |SI #dscam003#22 = 0; |Y #dscam003#30 = 0; |Y #dscam003#23 = 0;
          |Y #dscam003#31 = 0;
            |ACABA;
         |FINSI;
      |FINSI;
      eaDocum = ("0000000000" + #dscam003#40) % -110;
      |SI aEstado ! #dscam003#14;
         eaComent = " El estado del recibo no es correcto. (";
         eaComent = eaComent + #dscam003#14 + "/" + aEstado + ")";
      |FINSI;
      |SI nPendteD ! #dscam003#31;
         eaComent = " Los totales no son correctos. (Pdte.";
         eaComent = eaComent + #dscam003#31 + "/" + nPendteD + ")";
      |FINSI;
      aAlfa = "   " + eaDocum + "  " + eaComent; |XGRABA nHandle, aAlfa;
      nSwError = 1;
   |FINSI;
|FPRC;

|DEFBUCLE RecsRemoto;
#dscam003#3;
47,69,0,1,17;
#dscaz099#3,#dscaz099#0,"N"," ",#dscaz099#5,#dscaz099#7,#dscaz099#9;
#dscaz099#4,#dscaz099#1,"N"," ",#dscaz099#6,#dscaz099#8,#dscaz099#10;
be;
NULL,RecsRemoto;
|FIN;

|PROCESO Tmp;
     #dscam003#40 = #27#0;
     |LEE 121#dscam003.=;
     |SI FSalida = 0;
          |HAZ Recibos;
          |LIBERA #dscam003;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp;
     #27#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROGRAMA;
   |HAZ Tipo8;
   |SI PARAMETRO = "";
      |SI eaFichero ! "";
         |NOME_DAT #27 eaFichero;
         |DDEFECTO #0;
         #0#2 = "R";
         FSalida = 0;
      |SINO;
         |CLS;
         |CABEZA " Recalculo recibos ";
         |PINPA #0#0; |PINDA #0#0;
         |ENDATOS #1#0;
      |FINSI;
      |SI FSalida = 0;
         |DFICB aAlfa; |QBF aAlfa;
         |PATH_DAT #dscam044#aAlfa#; |ABRE #dscam044;
         |PATH_DAT #dscam045#aAlfa#; |ABRE #dscam045;

         |DELINDEX #dscaw072; |ABRE #dscaw072;
         |SI #dscaz099#2 ! "E";
            |IMPRE 0;
            |SI FSalida ! 0; |ACABA; |FINSI;
            |INFOR "dscaz099";
            |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;
         |FINSI;
         |SI eaFichero ! "";
              |ABRE #dscam003;
              |BUCLE Tmp;
              |CIERRA #dscam003;
         |SINO;
              |BUCLE Recibos;
         |FINSI;
         |SI #dscaz099#2 ! "E";
            |PIEINF; |FININF;
            |FINIMP;
         |FINSI;
         |SI #dscaz099#2 = "E";
            |ENTLINEAL #1#dscaw072,-1, 2, 20, 1, infw072, supw072;
            |CONFI "    NConforme con actualizar los datos editados ?";
            |SI FSalida = 0;
               |ABRE #dscam003; |ABRE #dscam004;
               |BUCLE Regenera;
               |CIERRA #dscam003; |CIERRA #dscam004;
            |FINSI;
         |FINSI;
         |CIERRA #dscaw072; |DELINDEX #dscaw072;
         |CIERRA #dscam044; |CIERRA #dscam045;
      |FINSI;
   |SINO;
      |DDEFECTO #dscaz099;
      fFechaHoy = ~;

      |DFICB aAlfa; |QBF aAlfa;
      |PATH_DAT #dscam044#aAlfa#; |ABRE #dscam044;
      |PATH_DAT #dscam045#aAlfa#; |ABRE #dscam045;

      |DELINDEX #dscaw072; |ABRE #dscaw072;

      |DFICE aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "estado.txt";
      |XABRE "W", aAlfa, nHandle;
      |SI FSalida = 0;
         aAlfa = " **************************************************************************** ";  |XGRABA nHandle, aAlfa;
         aAlfa = " ******                  INFORME CHEQUEO RECIBOS VENTA                 ****** ";  |XGRABA nHandle, aAlfa;
         aAlfa = " **************************************************************************** ";  |XGRABA nHandle, aAlfa;
         aAlfa = "";                                                                                |XGRABA nHandle, aAlfa;
         aAlfa = "   Fecha : " + fFechaHoy;                                                         |XGRABA nHandle, aAlfa;
         aAlfa = "";                                                                                |XGRABA nHandle, aAlfa;
         aAlfa = "   Documento   Comentario";                                                       |XGRABA nHandle, aAlfa;
         aAlfa = "   -------------------------------------------------------------------------- ";  |XGRABA nHandle, aAlfa;
         nSwError = 0;
         |BUCLE RecsRemoto;
         |SI nSwError = 0;
            aAlfa = "       Sin errores encontrados";                                               |XGRABA nHandle, aAlfa;
         |FINSI;
         |XCIERRA nHandle;

         |HAZ EnviaCorreo;
      |FINSI;

      |CIERRA #dscaw072; |DELINDEX #dscaw072;
      |CIERRA #dscam044; |CIERRA #dscam045;
   |FINSI;
   |HAZ Tipo9;
|FPRO;
