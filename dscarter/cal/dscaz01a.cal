|FICHEROS;
   dscaz001 #0;

   dscam001;
   dscam014 #101;

   dscam222 #1000;

   Referen@ #1001;

   dscam051;
   dscam221@;
   dscam004;
   dscam003;
   &agif024@;
   &caclipr@;
   dscaw013;
|FIN;

|VARIABLES;
     nSw = 0;
     &eaAlfa = "";
     &enDocumto = 0;
     aAlfa   = "";

     &eaSerie    = "";
     &eaCliGest  = "";
     &nImporte   = 0;
     &eaTipoOper = "";
     &Fichero    = "";
     &Cmp        = "";
     &Tipo       = "";
     &CmpNum     = 0;

     &enImpExceso   = 0;
     &CodProveedor  = "";
     &TipoProveedor = "";
     &CtaProveedor  = "";
     &UltNivel      = 0;

     &HayGestion    = 0;
     &HayConta      = 0;

     &enEmpCartera  = 0;
     &enEmpGestion  = 0;

     NumDoc      = 0;
     Comodin     = "";
     Linea       = 0;
     SwError     = 0;
     aCodEnl     = "";
|FIN;

|PROCESO RevisaEnlaces;
   |SI #dscaz001#10 = " "; |ACABA; |FINSI;

   |SI #dscaz001#30 = "    ";
      |SI #dscam222#1  [ #dscaz001#13; |Y #dscaz001#13 [ #dscam222#2;  #dscaz001#30 = #dscam222#3; |FINSI;
      |SI #dscam222#4  [ #dscaz001#13; |Y #dscaz001#13 [ #dscam222#5;  #dscaz001#30 = #dscam222#6; |FINSI;
      |SI #dscam222#7  [ #dscaz001#13; |Y #dscaz001#13 [ #dscam222#8;  #dscaz001#30 = #dscam222#9; |FINSI;
      |SI #dscam222#10 [ #dscaz001#13; |Y #dscaz001#13 [ #dscam222#11; #dscaz001#30 = #dscam222#12;|FINSI;
      |SI #dscam222#13 [ #dscaz001#13; |Y #dscaz001#13 [ #dscam222#14; #dscaz001#30 = #dscam222#15;|FINSI;
      |GRABA 020#dscaz001.a;
   |FINSI;
|FPRC;

|DEFBUCLE RevisaEnlaces;
#dscaz001#1;
;
INICIO;
FINAL;
be;
NULL, RevisaEnlaces;
|FIN;

|PROCESO RepasaEnlaces;
   |ABRE #dscam222;
   #dscam222#0 = "C";
   |LEE 000#dscam222.=;
   |SI FSalida ! 0; |CIERRA #dscam222; |ACABA; |FINSI;

   |BUCLE RevisaEnlaces;

   |CIERRA #dscam222;
|FPRC;

|PROCESO MiraEntidad;
   |ABRE #dscam001;
   #dscam001#0 = eaAlfa;
   |LEE 000#dscam001.=;
   |SI FSalida = 0;
      eaAlfa = #dscam001#1;
   |SINO;
      eaAlfa = "";
   |FINSI;
   |CIERRA #dscam001;
|FPRC;

|PROCESO MiraCtaBcoRemesas;
   |ABRE #dscam014;
   #dscam014#0 = eaAlfa;
   |LEE 000#dscam014.=;
   |SI FSalida = 0;
      eaAlfa = #dscam014#10;
   |SINO;
      eaAlfa = "";
   |FINSI;
   |CIERRA #dscam014;
|FPRC;

|PROCESO BajaFechaVisita;
   |HAZ EsArtenvas;
   |SI FSalida = 0;
      |DDEF aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "dscam223.mas";
      |CARGA_DEF aAlfa, Referen@;
      |SI FSalida = 0;
         |DFICE aAlfa; |QBF aAlfa; |PATH_DAT #Referen@#aAlfa#;
         |ABRE #Referen@;
         #Referen@#0 = enDocumto;
         |LEE 101#Referen@.=;
         |SI FSalida = 0;
            |BORRA 020#Referen@.a; |LIBERA #Referen@;
         |FINSI;
         |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
      |FINSI;
   |FINSI;
|FPRC;


|PROCESO CreaEntrega;
   |ABRE #dscam051; |LEE 000#dscam051.p; |CIERRA #dscam051;
   aCodEnl = #dscam051#73; |QBT aCodEnl;

  |DDEF aAlfa; aAlfa = aAlfa + "dscam221";
  |CARGA_DEF aAlfa, dscam221@;
  nSw = FSalida;
  |SI FSalida = 0;
        |ABRE #dscam221@;
        |DDEFECTO #dscam221@;
        #dscam221@#0 = #dscam004#17;
        #dscam221@#1 = #dscam004#3;
  |FINSI;


   |LEE 000#dscam003.u;
   NumDoc = #dscam003#40 + 1;
   |DDEFECTO #dscam003;
   #dscam003#40 = NumDoc;
   |GRABA 020#dscam003.b;

   Fichero = "Clientes"; Cmp = "Codigo Cliente"; Tipo = "G"; |HAZ ObtenDato;
   #agif024@#CmpNum# = #dscaz001#5;
   |LEE 000#agif024@.=;
   |SI FSalida = 0; |Y #agif024@#CmpNum# ! "      ";
      Fichero = "Clientes"; Cmp = "Cuenta Contable"; Tipo = "G"; |HAZ ObtenDato;
      #dscam003#5  = #agif024@#CmpNum#;
      Fichero = "Clientes"; Cmp = "Nombre Cliente";  Tipo = "G"; |HAZ ObtenDato;
      #dscam003#6  = #agif024@#CmpNum#;
      Fichero = "Clientes"; Cmp = "Banco Domiciliacion";  Tipo = "G"; |HAZ ObtenDato;
      #dscam003#7  = #agif024@#CmpNum#;
      Fichero = "Clientes"; Cmp = "Entidad Bancaria"; Tipo = "G"; |HAZ ObtenDato;
      #dscam003#8  = #agif024@#CmpNum#;
      Fichero = "Clientes"; Cmp = "Sucursal Bancaria"; Tipo = "G"; |HAZ ObtenDato;
      #dscam003#9  = #agif024@#CmpNum#;
      Fichero = "Clientes"; Cmp = "DC Cuenta Bancaria"; Tipo = "G"; |HAZ ObtenDato;
      #dscam003#10 = #agif024@#CmpNum#;
      Fichero = "Clientes"; Cmp = "Num.Cuenta Bancaria"; Tipo = "G"; |HAZ ObtenDato;
      #dscam003#11 = #agif024@#CmpNum#;
   |SINO;
      Fichero = "Clientes/Proveedores"; Cmp = "Cliente/Proveedor"; Tipo = "C"; |HAZ ObtenDato;
      #caclipr@#CmpNum# = "C";
      Fichero = "Clientes/Proveedores"; Cmp = "Cuenta Contable"; Tipo = "C"; |HAZ ObtenDato;
      #caclipr@#CmpNum# = #dscaz001#4;
      Fichero = "Clientes/Proveedores"; Cmp = "Digito Contable"; Tipo = "C"; |HAZ ObtenDato;
      #caclipr@#CmpNum# = UltNivel;
      |LEE 000#caclipr@.=;
      |SI FSalida = 0;
         Fichero = "Clientes/Proveedores"; Cmp = "Cuenta Contable"; Tipo = "C"; |HAZ ObtenDato;
         #dscam003#5 = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Cmp = "Razon Social"; Tipo = "C"; |HAZ ObtenDato;
         #dscam003#6 = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Cmp = "Banco Domiciliacion"; Tipo = "C"; |HAZ ObtenDato;
         #dscam003#7  = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Cmp = "Entidad Bancaria"; Tipo = "C"; |HAZ ObtenDato;
         #dscam003#8  = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Cmp = "Sucursal Bancaria"; Tipo = "C"; |HAZ ObtenDato;
         #dscam003#9  = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Cmp = "DC Cuenta Bancaria"; Tipo = "C"; |HAZ ObtenDato;
         #dscam003#10 = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Cmp = "Num.Cuenta Bancaria"; Tipo = "C"; |HAZ ObtenDato;
         #dscam003#11 = #caclipr@#CmpNum#;
      |FINSI;
   |FINSI;
   #dscam003#12 = #dscaz001#17;    || Tipo recibo
   #dscam003#22 = enImpExceso;                 || Importe Recibo (Divisa)
   #dscam003#60 = #dscam003#22 / #dscaz001#28; || Importe Recibo (Base)
   #dscam003#30 = #dscam003#22;                || Total Recibo (Divisa)
   #dscam003#64 = #dscam003#60;                || Total Recibo (Base)
   #dscam003#23 = #dscam003#30;                || Total Liquidado (Divisa)
   #dscam003#61 = #dscam003#64;                || Total Liquidado (Base)
   #dscam003#0  = #dscaz001#1;
   #dscam003#57 = #dscaz001#26;
   #dscam003#58 = #dscaz001#27;
   #dscam003#50 = #dscaz001#13;    || Cuenta Entrega
   #dscam003#44 = #48#14;          || Empresa Contable
   #dscam003#45 = #48#19;          || Periodo Contable
   #dscam003#46 = #48#15;          || Empresa Gestion
   #dscam003#32 = #dscaz001#5;     || Codigo Cliente
   #dscam003#4  = #dscaz001#12;    || Fecha de emision
   #dscam003#47 = "S";             || Entrega a cuenta S/N
   #dscam003#59 = #dscaz001#28;     || Cambio Actual Divisa
   #dscam003#14 = "e";
   #dscam003#15 = "Pendiente de compensar";
   |GRABA 020#dscam003.a; |LIBERA #dscam003;

   #dscam004#17 = #dscam003#40;
   #dscam004#3 = 1;
   |LEE 000#dscam004.];
   |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
      |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
         Linea = #dscam004#3 + 1;
         |LEE 000#dscam004.s;
      |SIGUE;
   |SINO;
      Linea = 1;
   |FINSI;

   |DDEFECTO #dscam004;
   #dscam004#17 = #dscam003#40;
   #dscam004#3  = Linea;
   |GRABA 020#dscam004.b;
   #dscam004#0 = #dscam003#0;
   #dscam004#1 = #dscam003#1;
   #dscam004#2 = #dscam003#2;
   #dscam004#4 = #dscaz001#13;
   #dscam004#5 = "RAC";
   #dscam004#6 = #dscaz001#14;
   #dscam004#7 = 0; #dscam004#25 = 0;
   #dscam004#8 = enImpExceso;
   #dscam004#26 = #dscam004#8 / #dscaz001#28;
   #dscam004#15 = #dscam003#27;
   Comodin = "Entrega a cuenta";
   #dscam004#16 = Comodin;
   #dscam004#42 = #dscaz001#13;
   |GRABA 020#dscam004.a; |LIBERA #dscam004;

   |SI nSw = 0;
          #dscam221@#2 = #dscam004#17;
          #dscam221@#3 = #dscam004#3;
          |GRABA 020#dscam221@.n;
          |CIERRA #dscam221@;
          |DESCARGA_DEF #dscam221@;
   |FINSI;

   eaTipoOper = "+5";     nImporte = #dscam003#64;
   enEmpCartera = -1;     enEmpGestion = -1;
   eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
   |HAZ BucleRiesgo;

   |SI #dscam051#1 = "S"; |Y HayConta = 1; |Y aCodEnl ! "";
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #dscaw013#Comodin#;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         #dscaw013#15 = aCodEnl;      #dscaw013#0  = 1;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
         #dscaw013#5 = #dscam004#17;  #dscaw013#6  = #dscam004#17;
         #dscaw013#11 = "N";          #dscaw013#12 = 10;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         #dscaw013#15 = aCodEnl;      #dscaw013#0  = 2;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
         #dscaw013#5  = #dscam004#3;  #dscaw013#6  = #dscam004#3;
         #dscaw013#11 = "N";          #dscaw013#12 = 3;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         Comodin = aCodEnl; |QBF Comodin;
         Comodin = "dscam033.tab;" + Comodin;
         |LIBERA #dscam003; |CIERRAT #dscam003;
         |LIBERA #dscam004; |CIERRAT #dscam004;
         |SUB_EJECUTA_NP Comodin;
         |CIERRA #dscaw013; |DELINDEX #dscaw013;
         |ABRET #dscam003;  |LEE 101#dscam003.=;
         |ABRET #dscam004;  |LEE 101#dscam004.=;
   |FINSI;
|FPRC;
