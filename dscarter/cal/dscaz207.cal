|FICHEROS;
   dscaz207 #0;

   dscam003 #10;
   dscam004 #11;
   dscam051 #12;
   dscam030 #13;

   dscaw222 #100,MANTE;

   dscaw013 #200;
|FIN;

|VARIABLES;
   aAlfa = "";
   Comodin  = "";

   nLinea = 0;
   &HayConta = 0;

   aTipoEnl = "";
   nNumSec  = 0;
|FIN;

|RUTINA inf;
   #dscaz207#0 = 0;
|FRUT;

|RUTINA sup;
   #dscaz207#0 = 9999999999;
|FRUT;

|PROCESO Lineas;
   |SI #dscaz207#3 ! #dscaz207#4;
      nLinea = 1;
      |DDEFECTO #dscam004;
      #dscam004#17 = #dscaz207#0;
      #dscam004#3  = 99;
      |LEE 000#dscam004.];
      |SI FSalida = 0;
         |LEE 000#dscam004.a;
         |SI FSalida = 0; |Y #dscam004#17 = #dscaz207#0;
            nLinea = #dscam004#3 + 1;
         |FINSI;
      |SINO;
         |LEE 000#dscam004.u;
         |SI FSalida = 0; |Y #dscam004#17 = #dscaz207#0;
            nLinea = #dscam004#3 + 1;
         |FINSI;
      |FINSI;

      |DDEFECTO #dscam004;
      #dscam004#17 = #dscaz207#0;
      #dscam004#3  = nLinea;
      |GRABA 020#dscam004.b;

      #dscam004#0  = #dscam003#0;
      #dscam004#1  = #dscam003#1;
      #dscam004#2  = #dscam003#2;
      #dscam004#4  = #dscaz207#4;
      #dscam004#5  = "CCT";
      #dscam004#6  = #dscaw222#1; || ~; tique 10028 _ 1253
      #dscam004#15 = #dscam003#27;
      #dscam004#43 = nNumSec;
      |GRABA 020#dscam004.a; |LIBERA #dscam004;

      #dscam003#40 = #dscaz207#0;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         #dscam003#5 = #dscaz207#3;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |FINSI;

      |SI #dscam051#1 = "S"; |Y #dscaw222#0 ! "    "; |Y aTipoEnl = "N";
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #dscaw013#Comodin#;
         |DELINDEX #dscaw013; |ABRE #dscaw013;

         nLinea = 1;
         #dscaw013#15 = #dscaw222#0; #dscaw013#0  = nLinea;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
         #dscaw013#5 = #dscam004#17;  #dscaw013#6  = #dscam004#17;
         #dscaw013#11 = "N";          #dscaw013#12 = 9;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         nLinea = nLinea + 1;
         #dscaw013#15 = #dscaw222#0; #dscaw013#0 = nLinea;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
         #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
         #dscaw013#11 = "N";          #dscaw013#12 = 3;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         nLinea = nLinea + 1;
         #dscaw013#15 = #dscaw222#0; #dscaw013#0 = nLinea;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
         #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
         #dscaw013#11 = "F";          #dscaw013#12 = 10;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         |CIERRA #dscaw013;
         Comodin = #dscaw222#0; |QBF Comodin;

         Comodin = "dscam033.tab;" + Comodin;
         |LIBERA #dscam003; |CIERRAT #dscam003;
         |LIBERA #dscam004; |CIERRAT #dscam004;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam003; |LEE 101#dscam003.=;
         |ABRET #dscam004; |LEE 101#dscam004.=;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |DELINDEX #dscaw013;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Lineas;
#dscaz207#1;
;
INICIO;
FINAL;
;
NULL, Lineas;
|FIN;

|PROCESO MiraRecibo;
   #dscam003#40 = #dscaz207#0;
   |LEE 000#dscam003.=;
   |SI FSalida ! 0; |MENAV "    Recibo inexistente"; |ERROR; |ACABA; |FINSI;

   |SI #dscam003#47 ! "N"; |O #dscam003#69 ! " "; |MENAV "    Este recibo es una entrega a cuenta."; |ERROR; |ACABA; |FINSI;
|FPRC;

|PROGRAMA;
   |ABRET #dscam003; |ABRET #dscam004;

   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0; |DDEFECTO #dscam051; |FINSI;
   |CIERRA #dscam051;

   |CLS;
   |CABEZA "Cambio cuenta contable contabilizado";
   |PINPA #0#0; |PINDA #0#0;

   aAlfa = "tcc" + Usuario; |NOME_DAT #dscaz207#aAlfa#;
   |DELINDEX #dscaz207; |ABRE #dscaz207;

   |ENTLINEAL #1#dscaz207, -1, 2, 21, 1, inf, sup;
   |LEE 000#dscaz207.p;
   |SI FSalida = 0;
      aAlfa = "    " + &191 + " Está seguro de volcar los cambios ? ";
      |CONFI aAlfa;
      |SI FSalida = 0;
         |PUSHV 1116 1567;
         |PINPA #0#dscaw222; |PINDA #0#dscaw222;
         |ENDATOS #1#dscaw222;
         |SI FSalida = 0;
            |ABRE #dscam030;
            #dscam030#0 = #dscaw222#0;
            |LEE 000#dscam030.=;
            |SI FSalida ! 0; |DDEFECTO #dscam030; |FINSI;
            |CIERRA #dscam030;
            aTipoEnl = #dscam030#8;

            |SI aTipoEnl = "S";
               |SELECT #3#dscam004;
               |LEE 000#dscam004.u;
               |SI FSalida ! 0; |DDEFECTO #dscam004; |FINSI;
               nNumSec = #dscam004#43 + 1;
               |SELECT #1#dscam004;
            |SINO;
               nNumSec = 0;
            |FINSI;

            |BUCLE Lineas;

            |SI #dscam051#1 = "S"; |Y #dscaw222#0 ! "    "; |Y aTipoEnl = "S";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #dscaw013#Comodin#;
               |DELINDEX #dscaw013; |ABRE #dscaw013;

               #dscaw013#15 = #dscaw222#0; #dscaw013#0  = 1;
               #dscaw013#13 = "dscam004";  #dscaw013#14 = 43;
               #dscaw013#5 = nNumSec;      #dscaw013#6  = nNumSec;
               #dscaw013#11 = "N";         #dscaw013#12 = 10;
               |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
               |CIERRA #dscaw013;
               Comodin = #dscaw222#0; |QBF Comodin;

               Comodin = "dscam033.tab;" + Comodin;
               |LIBERA #dscam003; |CIERRAT #dscam003;
               |LIBERA #dscam004; |CIERRAT #dscam004;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam003; |LEE 101#dscam003.=;
               |ABRET #dscam004; |LEE 101#dscam004.=;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
               |DELINDEX #dscaw013;
            |FINSI;
         |SINO;
            |MENAV "    Proceso cancelado";
         |FINSI;
         |POPV;
      |FINSI;
   |FINSI;

   |CIERRAT #dscam003; |CIERRAT #dscam004;
   |CIERRA #dscaz207; |DELINDEX #dscaz207;
|FPRO;
