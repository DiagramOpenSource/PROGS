|FICHEROS;
   dscaz012 #0;
   dscam012 #1;
   dscaw002 #2,MANTE;
   dscaw003 #3,MANTE;
   dscaw004 #4;
   dscam003 #5;
   dscam014 #6;
   dscaw005 #7;
   dscam013 #8;
   dscaw045 #9;
   dscam004 #10;
   dscam061 #50;
   dscam062 #51;
   dscam051 #52;
   dscaw116 #53;

   &agif321@ #9;
   &agif324@ #10;

   &canempr@ #11;

   dscaw018 #12,MANTE;

   dscam044  #900;
   dscam045  #901;
   FactVta@  #1000;
   FactDir@  #1001;
|FIN;

|VARIABLES;
   &eaFichClas = "";  &eaTipoClas = ""; &enSwClas = 0;

   &Fichero   = "";  &Cmp = "";   &Tipo = ""; &CmpNum = 0; &eaSesion = "";
   &eaEntidad  = "";
   &eaSucursal = "";
   &eaDC       = "";
   &eaCuenta   = "";

   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = ""; &enAviso = 0;
   &eaTipoRecibo = ""; &enNumDocum = 0; &eaMensRet = ""; &enSwError = 0; &eaTOperacion = "";
   &Divisa = ""; &nDeci_Div = 0; &nDeci_Base = 0;

   nSwErr   = 0;
   nEmpresa = 0;
   aDirApp  = "";
   aAlfa    = "";

   MinImp = 0;
   MaxImp = 9999999999;
   Codigo = 0;
   Cont = 0;
   Calc  = 0;
   Calc1 = 0;
   Calc2 = 0;
   Clave = 1;
   Salir = 0;
   Linea = 1;
   Tecla = 0;
   Campo1 = 0;
   Primero = 1;

   nBancoAnt = 0;
   nInteres = 0;
   nPorcInt = 0;
   NumDias  = 0;
   nLinea  = 0;
   LinCob  = 0;
   nSwLuxe = 0;

   SwDatos1 = 0;
   SwDatos  = 0;
   Comodin  = ""; Comodin1 = "";
   Flag     = 0;
   BancoAnt = 0;
   BancoAnter = 0;
   NumRemesa = 0;

   TotRemesado = 0;

   HayGestion = 0; CambioBase = 0;

   aDSerie = "";
   aHSerie = "";

   &eaTipoCod   = "";
   &ewErrorIBAN = 0;
|FIN;

|PROCESO GrabaError;
   |LEE 000#dscaw116.u;
   nLinea = #dscaw116#0 + 1;

   |DDEFECTO #dscaw116;
   #dscaw116#0 = nLinea;
   #dscaw116#1 = aAlfa;
   |GRABA 020#dscaw116.n;
|FPRC;

|PROCESO LinsInforme;
   |PRINT;
|FPRC;

|DEFBUCLE LinsInforme;
#dscaw116#1;
;
INICIO;
FINAL;
;
NULL, LinsInforme;
|FIN;

|PROCESO MiraSiFactConta;
   nSwErr = 0;
   |SI #dscam003#1  = 0;   |ACABA; |FINSI;
   |SI #dscam051#94 = "N"; |ACABA; |FINSI;

   |DFICE aAlfa; |QBF aAlfa; aAlfa = aAlfa % -106; aAlfa = aAlfa % 0105;
   nEmpresa = aAlfa;

   |DFICB aAlfa; |QBF aAlfa;
   |PATH_DAT #dscam044#aAlfa#; |PATH_DAT #dscam045#aAlfa#;
   |ABRE #dscam045; |ABRE #dscam044;
   |DDEFECTO #dscam045;
   |SELECT #2#dscam045;
   #dscam045#6 = nEmpresa;
   |LEE 000#dscam045.];
   |PARA; |SI FSalida = 0; |Y #dscam045#6 = nEmpresa; |HACIENDO;
      |SI #dscam045#2 = "V"; |Y #dscam045#0 = #dscam003#46;
         |SAL;
      |FINSI;
      |LEE 000#dscam045.s;
   |SIGUE;
   |SI #dscam045#2 ! "V"; |O #dscam045#0 ! #dscam003#46;
      |ACABA;
   |FINSI;

   #dscam044#0 = #dscam045#0;
   |LEE 000#dscam044.=;
   |SI FSalida = 0;
      aDirApp = #dscam044#1; |QBF aDirApp;
      aAlfa = aDirApp + "def/agifa134.mas";
      |CARGA_DEF aAlfa, FactVta@;
      |SI FSalida = 0;
         aAlfa = aDirApp + "def/agifa084.mas";
         |CARGA_DEF aAlfa, FactDir@;
         |SI FSalida = 0;
            aAlfa = aDirApp + "fich/" + (("00000" + #dscam045#0) % -105) + "/";
            |PATH_DAT #FactVta@#aAlfa#; |PATH_DAT #FactDir@#aAlfa#;
            |ABRE #FactVta@; |ABRE #FactDir@;
            #FactVta@#49 = #dscam003#0;
            #FactVta@#0  = #dscam003#1;
            |LEE 000#FactVta@.=;
            |SI FSalida = 0;
               |SI #FactVta@#48 = "N"; nSwErr = 1; |FINSI;
            |SINO;
               #FactDir@#48 = #dscam003#0;
               #FactDir@#0  = #dscam003#1;
               |LEE 000#FactDir@.=;
               |SI FSalida = 0;
                  |SI #FactVta@#39 = "N"; nSwErr = 1; |FINSI;
               |SINO;
                  aAlfa = "    La factura " + #dscam003#0 + "/" + #dscam003#1 + " no se encuentra en la empresa " + #dscam045#0 + " de gestion comercial";
                  |MENAV aAlfa;
               |FINSI;
            |FINSI;
            |CIERRA #FactVta@; |CIERRA #FactDir@;
            |DESCARGA_DEF #FactDir@;
         |FINSI;
         |DESCARGA_DEF #FactVta@;
      |FINSI;
   |FINSI;

   |SELECT #1#dscam045;
   |CIERRA #dscam045; |CIERRA #dscam044;
|FPRC;

|PROCESO CodigoCero; |TIPO 7;
     |DDEFECTO #dscam061;
     |ABRE #dscam061;              || para que la existencia obligatoria de
     #dscam061#0 = 0;              ||/la relacion no nos moleste en el codigo
     |LEE 000#dscam061.=;          ||/igual a cero
     |SI FSalida ! 0;
          |GRABA 020#dscam061.n;
     |FINSI;
     |CIERRA #dscam061;
|FPRC;

|PROCESO CodigoNoCero; |TIPO 0;
     |SI #dscaz012#42 ! 0;
          |C_M #dscaz012#22, 1, "N";
          |C_M #dscaz012#23, 1, "N";
     |SINO;
          |C_M #dscaz012#22, 1, "S";
          |C_M #dscaz012#23, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Contador; |TIPO 7;
   |ABRE #dscam012;
   /*
   |LEE 010#dscam012.u;
   |SI FSalida = 0;
      Codigo = #dscam012#0;
      |DDEFECTO #dscam012;
      #dscaz012#0 = Codigo + 1;
      |PINTA #dscaz012#0;
   |FINSI;
   */
   |HAZ ContaRemesa;
   #dscaz012#0 = #dscam012#0;

   |CIERRA #dscam012;
|FPRC;

|PROCESO Seleccion;
   |SI Campo = 2;
      |SI #dscaz012#Campo# = "S";
         |PARA Cont = 3; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
            |C_M #dscaz012#Cont#,1,"S";
         |SIGUE;
         |C_M #dscaz012#30,1,"N";
         |C_M #dscaz012#31,1,"N";
      |SINO;
         |PARA Cont = 3; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
            |C_M #dscaz012#Cont#,1,"N";
         |SIGUE;
         |C_M #dscaz012#30,1,"S";
         |C_M #dscaz012#31,1,"S";
      |FINSI;
   |FINSI;
   |SI Campo = 11
      |SI #dscaz012#Campo# = "S";
         |PARA Cont = 12; |SI Cont [ 19; |HACIENDO Cont = Cont + 1;
            |C_M #dscaz012#Cont#,1,"S";
         |SIGUE;
         |C_M #dscaz012#34,1,"N";
         |C_M #dscaz012#35,1,"N";
      |SINO;
         |PARA Cont = 12; |SI Cont [ 19; |HACIENDO Cont = Cont + 1;
            |C_M #dscaz012#Cont#,1,"N";
         |SIGUE;
         |C_M #dscaz012#34,1,"S";
         |C_M #dscaz012#35,1,"S";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Recibos;
   |SI nSwLuxe = 1; |Y #dscam003#100 = "S"; |ACABA; |FINSI;

   |HAZ MiraSiFactConta;
   |SI nSwErr ! 0; |ACABA; |FINSI;

   |SI #dscam003#90 = "N"; |Y #dscam051#75 = "N";
      aAlfa = "Recibo " + #dscam003#40 + " no preparado y preparacion automatica desactivada"; |HAZ GrabaError;
      |ACABA;
   |FINSI;

   enSwClas   = 1; eaFichClas = "dscaz012"; eaTipoClas = #dscam003#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR";
      aAlfa = "Recibo " + #dscam003#40 + " fuera de clasificacion"; |HAZ GrabaError;
      |ACABA;
   |FINSI;

   |SI #dscaz012#42 ! 0;
        #dscam062#0 = #dscaz012#42;
        #dscam062#1 = #dscam003#0;
        |LEE 000#dscam062.=;
        |SI FSalida ! 0;
             aAlfa = "Recibo " + #dscam003#40 + " con serie fuera de la agrupacion de series"; |HAZ GrabaError;
             |ACABA;
        |FINSI;
   |FINSI;

   |SI #dscam051#111 = "S";
       eaTipoCod = "C";
       |HAZ ChequeoIBAN;
       |SI ewErrorIBAN = 1;
           aAlfa = "Recibo " + #dscam003#40 + " con Codigo IBAN vacio y control de errores activado"; |HAZ GrabaError;
           |ACABA;
       |FINSI;
       |SI ewErrorIBAN = 2;
           aAlfa = "Recibo " + #dscam003#40 + " con Codigo IBAN erroneo y control de errores activado"; |HAZ GrabaError;
           |ACABA;
       |FINSI;
/*
      eaEntidad = #dscam003#8;
      eaSucursal = #dscam003#9;
      eaCuenta = #dscam003#11;
      eaDC = "";
      |HAZ CalculoDC;
      |SI #dscam003#10 = "  ";
         aAlfa = "Recibo " + #dscam003#40 + " con digito de control vacio y control de errores activado"; |HAZ GrabaError;
         |ACABA;
      |SINO;
         |SI #dscam003#8 = "    "; |O #dscam003#9 = "    "; |O #dscam003#11 = "          ";
            aAlfa = "Recibo " + #dscam003#40 + " con cuenta bancaria vacia y control de errores activado"; |HAZ GrabaError;
            |ACABA;
         |SINO;
            |SI eaDC ! #dscam003#10;
               aAlfa = "Recibo " + #dscam003#40 + " con digito de control erroneo y control de errores activado"; |HAZ GrabaError;
               |ACABA;
            |SINO;
               |SI #dscam003#8 = "0000"; |O #dscam003#11 = "0000000000";
                  aAlfa = "Recibo " + #dscam003#40 + " con cuenta bancaria vacia y control de errores activado"; |HAZ GrabaError;
                  |ACABA;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
*/
   |FINSI;

   |SI #dscam051#42 = "S";
       |SI #dscam003#28 = "S"; |Y #dscam003#29 = "N";
          aAlfa = "Recibo " + #dscam003#40 + " no aceptado por el cliente"; |HAZ GrabaError;
          |ACABA;
       |FINSI;
   |FINSI;
   |SI #dscam003#14 = "I";
      |SI #dscaz012#43 = "N";
         aAlfa = "Recibo " + #dscam003#40 + " impagado y filtrado por proceso automatico"; |HAZ GrabaError;
         |ACABA;
      |FINSI;
   |SINO;
      |SI #dscam003#14 ! "C"; |Y #dscam003#14 ! "P"; |ACABA; |FINSI;
   |FINSI;

   |DDEFECTO #dscaw005;
   #dscaw005#0 = #dscam003#27;
   #dscaw005#1 = #dscam003#0;
   #dscaw005#2 = #dscam003#1;
   #dscaw005#3 = #dscam003#2;
   #dscaw005#4 = #dscam003#8;
   #dscaw005#5 = #dscam003#3;
   #dscaw005#6 = #dscam003#65;
   #dscaw005#8 = #dscam003#40;
   #dscaw005#10 = #dscam003#32;
   #dscaw005#11 = #dscam003#51;
   |GRABA 020#dscaw005.n;
|FPRC;

|DEFBUCLE Recibos;
#dscam003#6;
4,12,5,32,33,35,65;
#0#20,aDSerie,#0#24,000," ",#0#38,#0#26,#0#30,#0#32,#0#36,#0#34,#0#40,MinImp;
#0#21,aHSerie,#0#25,999,"z",#0#39,#0#27,#0#31,#0#33,#0#37,#0#35,#0#41,MaxImp;
;
NULL,Recibos;
|FIN;

|PROCESO Orden;
   #dscaw003#Campo1# = Cont;
   Cont = Cont + 1;
   |GRABA 020#dscaw003.a;
|FPRC;

|DEFBUCLE Orden1;
#dscaw003#1;
;
INICIO;
FINAL;
;
NULL,NULL,NULL,NULL,NULL,Orden;
#dscaw003#7,#dscaw003#0;
|FIN;

|DEFBUCLE Orden2;
#dscaw003#1;
;
INICIO;
FINAL;
;
NULL,NULL,NULL,NULL,NULL,Orden;
#dscaw003#8,#dscaw003#0;
|FIN;

|DEFBUCLE Orden3;
#dscaw003#1;
;
INICIO;
FINAL;
;
NULL,NULL,NULL,NULL,NULL,Orden;
#dscaw003#6,#dscaw003#0;
|FIN;

|PROCESO Ordena;
   |ABRE #dscaw003;
   Cont = 1; Campo1 = 10; |BUCLE Orden1;
   Cont = 1; Campo1 = 11; |BUCLE Orden2;
   Cont = 1; Campo1 = 12; |BUCLE Orden3;
   |CIERRA #dscaw003;
|FPRC;

|PROCESO BucleRecibos;
   #dscam003#40 = #dscaw005#8;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      Divisa = #dscam003#57; |HAZ TomaDecim;
      |HAZ ComprTotVta;
   |FINSI;

   |SI nSwLuxe = 1; |Y #dscam003#100 = "S"; |ACABA; |FINSI;

   |SI #dscaw002#13 = "N";
      #dscaw018#0 = #dscaw002#0;
      #dscaw018#1 = #dscam003#8;
      |LEE 000#dscaw018.=;
      |SI FSalida ! 0; |ACABA; |FINSI;
   |FINSI;

   |SELECT #5#dscaw003;
   #dscaw003#9 = #dscam003#40;
   |LEE 000#dscaw003.=;
   |SI FSalida = 0;
      nLinea = #dscaw003#0;
   |SINO;
      nLinea = -1;
   |FINSI;
   |SELECT #1#dscaw003;

   #dscaw003#0 = nLinea;
   |LEE 000#dscaw003.=;
   |SI FSalida ! 0;
      enSwError = 0; enAviso = 1;
      eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscam003#40; |HAZ ProcesaTempo;
      |SI enSwError = 1; |ERROR; |ACABA; |FINSI;
      SwDatos1 = 1;
      |DDEFECTO #dscaw003;
      #dscaw003#0 = Linea;     Linea = Linea + 1;
      #dscaw003#1 = #dscam003#27;
      #dscaw003#2 = #dscam003#0;
      #dscaw003#3 = #dscam003#1;
      #dscaw003#4 = #dscam003#2;
      #dscaw003#5 = #dscam003#6;
      #dscaw003#6 = #dscam003#3;
      #dscaw003#8 = #dscam003#65;
      #dscaw003#9 = #dscam003#40;
      |GRABA 020#dscaw003.c;
   |SINO;
      |SI #dscaw003#7 ! "   "; |ERROR; |ACABA; |FINSI;
   |FINSI;

   Calc = (#dscaw002#5 + #dscam003#65) ! nDeci_Base;
   ||SI Calc < #dscaw002#4;
   |SI Calc [ #dscaw002#4;
      |SI #dscam051#7 = "S";
         |SI #dscaw002#0 = #dscam003#51;
            Comodin = #dscaw002#0; |QBF Comodin;
            Comodin = ("000" + Comodin) % -103;
            #dscaw003#7 = Comodin;
            |GRABA 020#dscaw003.a;

            #dscaw002#5 = #dscaw002#5 + #dscam003#65;
            TotRemesado = TotRemesado + #dscam003#65;
            #dscaw005#7 = "*";
            |GRABA 020#dscaw005.a;
         |FINSI;
      |SINO;
         Comodin = #dscaw002#0; |QBF Comodin;
         Comodin = ("000" + Comodin) % -103;
         #dscaw003#7 = Comodin;
         |GRABA 020#dscaw003.a;

         #dscaw002#5 = #dscaw002#5 + #dscam003#65;
         TotRemesado = TotRemesado + #dscam003#65;
         #dscaw005#7 = "*";
         |GRABA 020#dscaw005.a;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE BucleRecibos;
#dscaw005#2;
4,5,6,7,11;
00,"     ",000000,000,#dscaw002#6,#dscaw002#8,#dscaw002#10," ",#dscaw045#0;
99,"zzzzz",999999,999,#dscaw002#7,#dscaw002#9,#dscaw002#11," ",#dscaw045#1;
;
NULL,NULL,NULL,NULL,NULL,BucleRecibos;
#dscaw005#5,#dscaw005#10;
|FIN;

|PROCESO BucleBancos;
   |SI #dscaw002#4 ! 0;
      |BUCLE BucleRecibos;
      |GRABA 020#dscaw002.a;
   |FINSI;
|FPRC;

|DEFBUCLE BucleBancos;
#dscaw002#1;
;
INICIO;
FINAL;
;
NULL,BucleBancos;
|FIN;

|PROCESO PresentaBancos;
   |DDEFECTO #dscaw002;
   #dscaw002#0 = #dscam014#0;
   #dscaw002#1 = #dscam014#34;
   #dscaw002#2 = #dscam014#1;
   |SI #dscam014#12 > #dscam014#13;
      #dscaw002#3 = #dscam014#12 - #dscam014#13;
   |SINO;
      #dscaw002#3 = 0;
   |FINSI;
   #dscaw002#4 = #dscaw002#3;
   #dscaw002#5 = 0;
   #dscaw002#8 = #dscaz012#28;
   #dscaw002#9 = #dscaz012#29;
   #dscaw002#12 = #dscam014#0;
   |GRABA 020#dscaw002.n;
|FPRC;

|DEFBUCLE PresentaBancos;
#dscam014#1;
;
INICIO;
FINAL;
;
NULL,PresentaBancos;
|FIN;

|RUTINA inf1;
   #dscaw002#0 = 1;
|FRUT;

|RUTINA sup1;
   #dscaw002#0 = 999;
   #dscaw002#6 = "01.01.1900";
|FRUT;

|RUTINA inf2;
   #dscaw003#0 = 1;
   #dscaw003#10 = 1;
   #dscaw003#11 = 1;
   #dscaw003#12 = 1;
|FRUT;

|RUTINA sup2;
   #dscaw003#0 = Linea;
   #dscaw003#10 = Linea;
   #dscaw003#11 = Linea;
   #dscaw003#12 = Linea;
|FRUT;

|PROCESO CreaRemesa;
   aAlfa = "le" + Usuario; |NOME_DAT #dscaw116#aAlfa#;
   Comodin = "bc" + Usuario; |NOME_DAT #2 Comodin;
   Comodin = "ra" + Usuario; |NOME_DAT #3 Comodin;
   |DELINDEX #dscaw116; |ABRE #dscaw116;
   |DELINDEX #dscaw002;
   |DELINDEX #dscaw003;
   |DELINDEX #dscaw005;
   |DELINDEX #dscaw018;
   |ABRE #dscaw002;
   |ABRE #dscaw003;
   |ABRE #dscam003;
   |LEE 000#dscam003.p; Divisa = #dscam003#57; |HAZ TomaDecim;
   |ABRE #dscaw005; |SELECT #2#dscaw005;
   |ABRE #dscaw018;
   |ABRE #dscam062;
   |BUCLE PresentaBancos;
   |PUSHV 05012380;
   |CLS;
   |CABEZA "Creac.Multiple remes";
   |PINPA #0#2;
   |PINDA #0#2;
   |PINPA #0#3;
   |ENTLINEAL #1#dscaw002,-1,2,11,1,inf1,sup1;
   Linea = 1;
   |SI #dscaz012#42 = 0;
        aDSerie = #dscaz012#22;
        aHSerie = #dscaz012#23;
   |SINO;
        aDSerie = "     ";
        aHSerie = "zzzzz";
   |FINSI;
   |BUCLE Recibos;
   |BUCLE BucleBancos;
   #dscaw002#0 = 0;
   #dscaw002#6 = "    ";       #dscaw002#7  = "zzzz";
   #dscaw002#8 = "01.01.1900"; #dscaw002#7  = "31.12.2099";
   #dscaw002#9 = "-999999999"; #dscaw002#10 = "9999999999";
   |BUCLE BucleRecibos;
   |HAZ Ordena;

   |PTEC 814;
   |PARA; |SI Salir = 0; |HACIENDO;
      |MENSA "    <F2> Cambio de clave";
      |SI Clave = 1;
         |ATRI R; |PINTA 1303, " Ordenado por Banco      "; |ATRI N;
         |C_V #dscaw003#0 ,1,"N"; |C_V #dscaw003#10,1,"S";
         |C_V #dscaw003#11,1,"N"; |C_V #dscaw003#12,1,"N";
         |ENTLINEAL #2#dscaw003,-1,2,20,1,inf2,sup2;
      |FINSI;
      |SI Clave = 2;
         |ATRI R; |PINTA 1303, " Ordenado por Importe    "; |ATRI N;
         |C_V #dscaw003#0 ,1,"N"; |C_V #dscaw003#10,1,"N";
         |C_V #dscaw003#11,1,"S"; |C_V #dscaw003#12,1,"N";
         |ENTLINEAL #3#dscaw003,-1,2,20,1,inf2,sup2;
      |FINSI;
      |SI Clave = 3;
         |ATRI R; |PINTA 1303, " Ordenado por Fecha Vto. "; |ATRI N;
         |C_V #dscaw003#0 ,1,"N"; |C_V #dscaw003#10,1,"N";
         |C_V #dscaw003#11,1,"N"; |C_V #dscaw003#12,1,"S";
         |ENTLINEAL #4#dscaw003,-1,2,20,1,inf2,sup2;
      |FINSI;
      |SI FSalida < 0; |SAL; |FINSI;
   |SIGUE;
   |MENSA "                        ";
   |POPV;
   |CIERRA #dscaw018;
   |SELECT #1#dscaw005; |CIERRA #dscaw005;

   |LEE 000#dscaw116.p;
   |SI FSalida = 0;
      aAlfa = "    NHan habido documentos que no han entrado en la selecci¢n. " + &191 + " Ver informe ?";
      |CONFI aAlfa;
      |SI FSalida = 0;
         |IMPRE 0;
         |SI FSalida = 0;
            |INFOR "dscaw116";
            |SI FSalida = 0;
               |BUCLE LinsInforme;
               |PIEINF; |FININF;
            |FINSI;
            |FINIMP;
         |FINSI;
      |FINSI;
   |FINSI;

   |CIERRA #dscaw116; |DELINDEX #dscaw116;
   |CIERRA #dscaw003;
   |CIERRA #dscam003;
   |CIERRA #dscaw002;
   |CIERRA #dscam062;
|FPRC;

|RUTINA infz012;
   #dscaw018#0 = #dscaw002#0;
   #dscaw018#1 = "    ";
|FRUT;

|RUTINA supz012;
   #dscaw018#0 = #dscaw002#0;
   #dscaw018#1 = "zzzz";
|FRUT;

|PROCESO HazSelec; |TIPO 11;
   |SI FSalida = 10;
      |PUSHV 0818 1762;
      |CONFI "    NBanco nulo (S/N)";
      |SI FSalida = 0;
         #dscaw002#13 = "S";
      |SINO;
         #dscaw002#13 = "N";
      |FINSI;
      |SI #dscaw002#13 = "N";
         |ENTLINEAL #1#dscaw018,-2,1,15,1,infz012,supz012;
      |SINO;
         |PUSHV 0501 2380;
         |DDEFECTO #dscaw045;
         |PINPA #0#dscaw045; |PINDA #0#dscaw045;
         |ENDATOS #1#dscaw045;
         |POPV;
      |FINSI;
      |POPV;
      |PUSHV 1121 1661;
      #dscaw004#0 = #dscaw002#6;
      #dscaw004#1 = #dscaw002#7;
      #dscaw004#2 = #dscaw002#8;
      #dscaw004#3 = #dscaw002#9;
      #dscaw004#4 = #dscaw002#10;
      #dscaw004#5 = #dscaw002#11;
      |PINPA #0#4
      |PINDA #0#4
      |ENDATOS #1#4;
      |SI FSalida = 0;
         #dscaw002#6  = #dscaw004#0;
         #dscaw002#7  = #dscaw004#1;
         #dscaw002#8  = #dscaw004#2;
         #dscaw002#9  = #dscaw004#3;
         #dscaw002#10 = #dscaw004#4;
         #dscaw002#11 = #dscaw004#5;
         |GRABA 020#dscaw002.a;
      |FINSI;
      |POPV;
   |FINSI;
|FPRC;

|PROCESO ActBancos; |TIPO 13;
   Tecla = FSalida;
   Campo1 = Campo;
   |SI Tecla = 2; |O Tecla = 3; |ACABA; |FINSI;
   |ENTLINEAL #1#dscaw002,-1,7,11,1,inf1,sup1;

   |SI Campo1 = 7; |Y Clave ! 1; |ACABA; |FINSI;
   |SI Campo1 = 8; |Y Clave ! 2; |ACABA; |FINSI;
   |SI Campo1 = 6; |Y Clave ! 3; |ACABA; |FINSI;

   |SI Tecla = 10;
      Salir = 0;
      Clave = Clave + 1;
      |SI Clave = 4; Clave = 1; |FINSI;
      |SI Clave = 1;
         |C_M #dscaw003#6,1,"N";
         |C_M #dscaw003#8,1,"N";
      |SINO;
         |C_M #dscaw003#6,1,"S";
         |C_M #dscaw003#8,1,"S";
      |FINSI;
      |PTEC 807;
   |SINO;
      Salir = 1;
   |FINSI;

   |ATRI I;
   |PINTA 0865, TotRemesado;
   |ATRI N;

|FPRC;

|PROCESO VigilaLimite;
   |SI #dscaw002#4 > #dscaw002#3;
      Comodin = "    Solo hay " + #dscaw002#3 + " de riesgo disponible";
      |MENAV Comodin;
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO Actualiza; |TIPO 2;

   Flag = 0 +. 1;

   |SI Flag < 0;
      eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw003#9; |HAZ ProcesaTempo;
      |SI Primero = 1; Primero = 0; |SINO; |ACABA; |FINSI;
      BancoAnt = #dscaw003#7;
      #dscaw002#0 = #dscaw003#7;
      |LEE 010#dscaw002.=;
      |SI FSalida = 0;
         #dscaw002#5 = #dscaw002#5 - #dscaw003#8;
         TotRemesado = TotRemesado - #dscaw003#8;
         |GRABA 020#dscaw002.a;
         |ENTLINEAL #1#dscaw002,-1,7,11,1,inf1,sup1;
      |FINSI;
   |SINO;
      |SI Primero = 0; Primero = 1; |SINO; |ACABA; |FINSI;
      #dscaw002#0 = #dscaw003#7;
      |LEE 010#dscaw002.=;
      |SI FSalida = 0;
         Calc = #dscaw002#5 + #dscaw003#8;
         |SI Calc [ #dscaw002#3; |Y Calc [ #dscaw002#4;
            TotRemesado = TotRemesado + #dscaw003#8;
            #dscaw002#5 = #dscaw002#5 + #dscaw003#8;
            |GRABA 020#dscaw002.a;
            |ENTLINEAL #1#dscaw002,-1,7,11,1,inf1,sup1;
         |SINO;
            |SI Calc > #dscaw002#5;
               |CONFI "    NLimite prefijado superado. ¨ Continuar ?";
               |SI FSalida = 0;
                  TotRemesado = TotRemesado + #dscaw003#8;
                  #dscaw002#5 = #dscaw002#5 + #dscaw003#8;
                  |GRABA 020#dscaw002.a;
                  |ENTLINEAL #1#dscaw002,-1,7,11,1,inf1,sup1;
               |SINO;
                  #dscaw002#0 = BancoAnt;
                  |LEE 010#dscaw002.=;
                  |SI FSalida = 0;
                     TotRemesado = TotRemesado + #dscaw003#8;
                     #dscaw002#5 = #dscaw002#5 + #dscaw003#8;
                     |GRABA 020#dscaw002.a;
                  |FINSI;
                  |ERROR;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
      eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscaw003#9; |HAZ ProcesaTempo;
   |FINSI;

   |ATRI I;
   |PINTA 0865, TotRemesado;
   |ATRI N;
|FPRC;

|PROCESO VuelcaRemesas;
   eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw003#9; |HAZ ProcesaTempo;

   |SI #dscaw003#7 = "   "; |ACABA; |FINSI;
   SwDatos = 1;

   #dscaw002#0 = #dscaw003#7;
   |LEE 010#dscaw002.=;

   #dscam014#0 = #dscaw002#12;
   |LEE 010#dscam014.=;

   #dscam003#40 = #dscaw003#9;
   |LEE 101#dscam003.=;
   Divisa = #dscam003#57; |HAZ TomaDecim;

   |SI nBancoAnt ! #dscaw003#7;
      /*
      |DDEFECTO #dscam012;
      |LEE 000#dscam012.u;
      |SI FSalida = 0
         NumRemesa = #dscam012#0 + 1;
      |SINO;
         NumRemesa = 1;
      |FINSI;
      */
      |HAZ ContaRemesa;
      NumRemesa = #dscam012#0;

      nBancoAnt = #dscaw003#7;
   |FINSI;

   #dscam012#0 = NumRemesa;
   |LEE 010#dscam012.=;
   |SI FSalida ! 0;
      Linea = 1;
      |DDEFECTO #dscam012;
      #dscam012#0  = NumRemesa;
      #dscam012#1  = #dscaz012#1;
      #dscam012#2  = #dscaw002#12;
      #dscam012#3  = #dscaw002#2;
      #dscam012#5  = 0;
      #dscam012#6  = #dscam014#16;
      #dscam012#7  = #dscam003#12;
      #dscam012#8  = "N";
      #dscam012#9  = "N";
      #dscam012#10 = 0;
      #dscam012#11 = 0;
      #dscam012#12 = 0;
      #dscam012#13 = 0;
      #dscam012#14 = #dscam014#10;
      #dscam012#15 = #dscam014#11;
      #dscam012#16 = #dscam014#34;
      #dscam012#17 = #dscam014#35;
      #dscam012#18 = #dscam014#37;
      #dscam012#19 = #dscam014#36;
      #dscam012#22 = 2;
      |GRABA 020#dscam012.n;
      |LEE 020#dscam012.=;
   |FINSI;

   |DDEFECTO #dscam013;
   #dscam013#0  = #dscam012#0;
   #dscam013#1  = Linea;          Linea = Linea + 1;
   #dscam013#2  = #dscam003#27;
   #dscam013#3  = #dscam003#1;
   #dscam013#4  = #dscam003#0;
   #dscam013#5  = #dscam003#2;
   #dscam013#6  = #dscam003#3;
   #dscam013#7  = #dscam003#65;
   Calc1 = #dscaz012#1;
   Calc2 = #dscam013#6;
   NumDias = Calc2 - Calc1;
   |SI NumDias < 0;
      NumDias = 0;
      #dscam013#12 = "S";
      nInteres = 0;
      nPorcInt = 0;
   |SINO;
      #dscam013#12 = "N";
      |SI #dscam014#28 ! 0; |O #dscam014#29 ! 0; |O #dscam014#30 ! 0; |O #dscam014#31 ! 0;
         |SI NumDias ] #dscam014#20; |Y NumDias [ #dscam014#24;
            nInteres = ((#dscam013#7 * #dscam014#28) / 36000) * NumDias;
            nPorcInt = #dscam014#28;
         |FINSI;
         |SI NumDias ] #dscam014#21; |Y NumDias [ #dscam014#25;
            nInteres = ((#dscam013#7 * #dscam014#29) / 36000) * NumDias;
            nPorcInt = #dscam014#29;
         |FINSI;
         |SI NumDias ] #dscam014#22; |Y NumDias [ #dscam014#26;
            nInteres = ((#dscam013#7 * #dscam014#30) / 36000) * NumDias;
            nPorcInt = #dscam014#30;
         |FINSI;
         |SI NumDias ] #dscam014#23; |Y NumDias [ #dscam014#27;
            nInteres = ((#dscam013#7 * #dscam014#31) / 36000) * NumDias;
            nPorcInt = #dscam014#31;
         |FINSI;
      |SINO;
         |SI #dscam014#32 ! 0;
            nInteres = (#dscam013#7 % #dscam014#32) * NumDias;
            nPorcInt = #dscam014#32;
         |SINO;
            nInteres = ((#dscam013#7 * #dscam014#17) / 36000) * NumDias;
            nPorcInt = #dscam014#17;
         |FINSI;
      |FINSI;
   |FINSI;
   #dscam013#8  = NumDias;
   #dscam013#9  = nPorcInt;
   #dscam013#10 = nInteres;
   #dscam013#11 = #dscam003#5;
   #dscam013#16 = #dscam003#40;

   |SI HayGestion = 1;
      Fichero = "Divisas"; Tipo = "G"; Cmp = "Codigo Divisa"; |HAZ ObtenDato;
      #agif324@#CmpNum# = #dscam003#57;
      |LEE 000#agif324@.=;
      |SI FSalida = 0;
         Fichero = "Divisas"; Tipo = "G"; Cmp = "Valor Venta"; |HAZ ObtenDato;
         #dscam013#21 = CambioBase / #agif324@#CmpNum#;
         #dscam013#23 = #dscam003#59;
      |FINSI;
   |SINO;
      |SI #dscam003#57 = "EUR";
         #dscam013#21 = CambioBase;
         #dscam013#23 = CambioBase;
      |FINSI;
   |FINSI;
   #dscam013#22 = #dscam003#31;

   |GRABA 020#dscam013.n; |LEE 010#dscam013.=;
   eaUsuario = Usuario % 0810;
   eaDescr   = "ALTA LINEA REMESA (" + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam013#1) % -103);
   eaDescr   = eaDescr + ") CON RECIBO (" + #dscam003#0 + "/" + #dscam003#1 + "/" + #dscam003#2 + ") DESDE MANTENIMIENTO";
   eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
   eaTipoOp  = "A";   enImpAnt = #dscam012#10;
   enImpAct = #dscam012#10 + #dscam013#7;
   |HAZ GrabaAudit;

   #dscam012#5 = #dscam012#5 + 1;
   #dscam012#10 = #dscam012#10 + #dscaw003#8;
   #dscam012#11 = #dscam012#5 * #dscam012#6;
   #dscam012#12 = #dscam012#12 + #dscam013#10;
   |SI NumDias [ 0;
      #dscam012#13 = #dscam012#13 + #dscam013#7;
   |FINSI;
   |GRABA 020#dscam012.a;

   #dscam003#14 = "R";
   #dscam003#26 = #dscam012#1;
   #dscam003#15 = "Remesado";
   #dscam003#17 = #dscam012#0;
   #dscam003#37 = #dscam013#1;
   |SI #dscam051#75 = "S"; |Y #dscam003#90 = "N";
      #dscam003#90 = "S";

      |ABRE #dscam004;
      #dscam004#17 = #dscam013#16;
      #dscam004#3 = 99;
      |LEE 000#dscam004.];
      |SI FSalida ! 0;
         |LEE 000#dscam004.u;
         |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
            LinCob = #dscam004#3 + 1;
         |SINO;
            LinCob = 1;
         |FINSI;
      |SINO;
         |SI #dscam004#17 = #dscam013#16;
            LinCob = #dscam004#3 + 1;
         |SINO;
            |LEE 000#dscam004.a;
            |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
               LinCob = #dscam004#3 + 1;
            |SINO;
               LinCob = 1;
            |FINSI;
         |FINSI;
      |FINSI;
      |DDEFECTO #dscam004;
      #dscam004#17 = #dscam013#16;
      #dscam004#15 = #dscam003#27;
      #dscam004#0  = #dscam003#0;
      #dscam004#1  = #dscam003#1;
      #dscam004#2  = #dscam003#2;
      #dscam004#3  = LinCob;
      #dscam004#4  = #dscam013#6;
      #dscam004#5  = "PRE";
      #dscam004#6  = ~;
      #dscam004#7  = #dscam003#23;
      #dscam004#8  = #dscam003#31;
      #dscam004#25 = #dscam003#61;
      #dscam004#26 = #dscam003#65;
      #dscam004#11 = #dscam003#13;
      #dscam004#33 = #dscam003#59;
      #dscam004#43 = 0;
      #dscam004#44 = #dscam003#31;
      #dscam004#45 = #dscam004#44 * #dscam004#33;
      #dscam004#46 = 0;
      #dscam004#47 = 0;
      |GRABA 020#dscam004.n; |LEE 000#dscam004.=
      |CIERRA #dscam004;
   |FINSI;
   |SI #dscam051#133 = "S";
       #dscam003#51 = #dscam012#2;
       #dscam003#52 = #dscam012#3;
   |FINSI;

   |GRABA 020#dscam003.a; |LIBERA #dscam003;

   |SI Linea > 999; nBancoAnt = -1; |FINSI;
|FPRC;

|DEFBUCLE VuelcaRemesas;
#dscaw003#1;
;
INICIO;
FINAL;
;
NULL,VuelcaRemesas;
|FIN;

|PROCESO LiberaRecs;
   eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw003#9; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE LiberaRecs;
#dscaw003#1;
;
INICIO;
FINAL;
;
NULL,LiberaRecs;
|FIN;

|PROCESO Volcado; |TIPO 3;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;

   nSwLuxe = 0;
   |HAZ EsLuxe;
   |SI FSalida = 0; nSwLuxe = 1; |FINSI;

   SwDatos1 = 0;
   |HAZ CreaRemesa;
   |SI SwDatos1 = 0; |ACABA; |FINSI;
   |CONFI "0000NVolcar los datos seleccionados ?";
   |SI FSalida ! 0;
      eaSesion   = Usuario; |HAZ LimpiaTempo; |ACABA;
   |FINSI;

   SwDatos = 0;

   |ABRE #dscaw002;
   |ABRE #dscaw003;
   |ABRE #dscam012;
   |ABRE #dscam013;
   |ABRE #dscam014;
   |ABRE #dscam003;
   Linea = 0;
   |BUCLE VuelcaRemesas;
   |CIERRA #dscam003;
   |CIERRA #dscam014;
   |CIERRA #dscam013;
   |CIERRA #dscam012;
   |CIERRA #dscaw003;
   |CIERRA #dscaw002;

   eaSesion   = Usuario; |HAZ LimpiaTempo;

   |SI SwDatos = 0;
      |MENAV "    Seleccion vacia";
   |FINSI;
|FPRC;

|PROCESO AntesBanco; |TIPO 7;
   BancoAnter = #dscaw003#7;
|FPRC;

|PROCESO TrasBanco;
   |SI #dscaw003#7 ! BancoAnter;
      |GRABA 020#dscaw003.a;
      |CIERRA #dscaw003;
      |SALVA_FICHA #dscaw003;
      Cont = 1; Campo1 = 10; |BUCLE Orden1;
      |PONCONTROL 23,"si";
      |REPON_FICHA #dscaw003;
      |ABRE #dscaw003;
      |PINDA #0#dscaw003;
   |FINSI;
|FPRC;
