|FICHEROS;
   dscaz198 #0;

   dscam003 #10;
   dscam004 #11;
   dscam055 #12;
   dscam164 #13;
   dscam051 #14;

   dscam217 #15;
   dscam221 #16;

   dscaw206 #100,MANTE;
   dscaw218 #101,MANTE;

   dscam219 #219;
|FIN;

|VARIABLES;
   &enCuadroIni = 0;
   &enCuadroFin = 0;
   &eaTitulo    = "";

   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = ""; &eaFicher = ""; &eaClave = "";
   &enEmpCartera = 0; &enEmpGestion = 0; &enDocum = 0; &enTipoEntrada = 0;
   &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = ""; enBanco = 0;

   &enDocumto = 0; &efFechaMov = @; &eaHoraMov = "";
   &eaSituRec = ""; &eaObs = "";

   fVtoAnt = @;
   nModo   = 0;
   nFlag   = 0;
   nLinea  = 0;

   aAlfa = "";
|FIN;

|PROCESO Tipo02z198; |TIPO 2;
   aAlfa = #dscaz198#13; |QBF aAlfa;
   |SI aAlfa = "";
      #dscaz198#12 = ~;
      aAlfa = ""; |HORA aAlfa;
      #dscaz198#13 = aAlfa;
   |FINSI;

   nModo = (FEntrada / 100) ! 0;
   nFlag = 0 +. 1;
   |SI nFlag > 0;
      enCuadroIni  = 1210;
      enCuadroFin  = 2270;
      eaTitulo     = " Observaciones al cambio de situacion";
      aAlfa = (("0000000000" + #dscaz198#1) % -110) + "/" + #dscaz198#12 + "/" + #dscaz198#13;
      aAlfa = "dscaz200.tab;" + aAlfa;
      |SUB_EJECUTA aAlfa;
   |FINSI;
|FPRC;

|PROCESO RecogeDatos;
   #dscam003#40 = #dscaz198#1;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#14 = "D"; |O #dscam003#14 = "A";
         aAlfa = "    El documento indicado esta "
         |SI #dscam003#14 = "D";
            aAlfa = aAlfa + "dividido. No se cambiara la situacion.";
         |FINSI;
         |SI #dscam003#14 = "A";
            aAlfa = aAlfa + "agrupado en el doc." + #dscam003#41;
            aAlfa = aAlfa + ". No se cambiara la situacion.";
         |FINSI;
         |MENAV aAlfa;
         |ERROR;
      |FINSI;

      #dscaz198#2 = #dscam003#0;  |PINTA #dscaz198#2;
      #dscaz198#3 = #dscam003#1;  |PINTA #dscaz198#3;
      #dscaz198#4 = #dscam003#2;  |PINTA #dscaz198#4;
      #dscaz198#5 = #dscam003#32; |PINTA #dscaz198#5;
      #dscaz198#6 = #dscam003#6;  |PINTA #dscaz198#6;
      #dscaz198#7 = #dscam003#30; |PINTA #dscaz198#7;
      #dscaz198#8 = #dscam003#35; |PINTA #dscaz198#8;
      #dscaz198#9 = #dscam003#36; |PINTA #dscaz198#9;
      #dscaz198#12 = ~;
      #dscaz198#15 = #dscam003#14;
      aAlfa = ""; |HORA aAlfa; #dscaz198#13 = aAlfa;
   |FINSI;
|FPRC;

|PROCESO MiraConsulta; |TIPO 6;
   |SI FSalida = 10;
      |C_M #dscaz198#2, 1, "S"; |C_M #dscaz198#3, 1, "S";
      |C_M #dscaz198#4, 1, "S";
   |ET PideSerie;
      |ENCAMPO #2#dscaz198;
      |SI FSalida = 0;
      |ET PideFactura;
         |ENCAMPO #3#dscaz198;
         |SI FSalida = 0;
            |ENCAMPO #4#dscaz198;
            |SI FSalida = 0;
               |SELECT #9#dscam003;
               #dscam003#40 = 0;
               #dscam003#27 = 0;
               #dscam003#0  = #dscaz198#2;
               #dscam003#1  = #dscaz198#3;
               #dscam003#2  = #dscaz198#4;
               |LEE 000#dscam003.];
               |SI FSalida = 0; |Y #dscam003#27 = 0; |Y #dscam003#0  = #dscaz198#2;
                                |Y #dscam003#1  = #dscaz198#3; |Y #dscam003#2  = #dscaz198#4;
                  #dscaz198#1 = #dscam003#40; |PINTA #dscaz198#1;
               |SINO;
                  |MENAV "    Recibo inexistente";
               |FINSI;
               |SELECT #1#dscam003;
            |SINO;
               |SI FSalida = 2; |VETE PideFactura; |FINSI;
            |FINSI;
         |SINO;
            |SI FSalida = 2; |VETE PideSerie; |FINSI;
         |FINSI;
      |FINSI;
      |C_M #dscaz198#2, 1, "N"; |C_M #dscaz198#3, 1, "N";
      |C_M #dscaz198#4, 1, "N";
      |ERROR;
   |SINO;
      #dscam003#40 = #dscaz198#1;
      |LEE 000#dscam003.=;
      |SI FSalida ! 0;
         |MENAV "    Recibo inexistente"; |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO VuelcaCambios;
   fVtoAnt = "01.01.0000";

   #dscam003#40 = #dscaz198#1;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      |SI #dscaz198#14 ! "01.01.0000";
         #dscam221#0 = #dscaz198#1;
         |LEE 101#dscam221.=;
         |SI FSalida ! 0;
            |DDEFECTO #dscam221;
            #dscam221#0 = #dscaz198#1;
            #dscam221#1 = #dscam003#3;
            |GRABA 020#dscam221.b;
         |FINSI;
         #dscam221#2 = #dscam221#3;
         #dscam221#3 = #dscaz198#14;
         |GRABA 020#dscam221.a; |LIBERA #dscam221;

         fVtoAnt = #dscam003#3;
         #dscam003#3 = #dscaz198#14;
      |FINSI;

      nLinea = 1;
      #dscam164#0 = #dscam003#40;
      |LEE 000#dscam164.];
      |PARA; |SI FSalida = 0; |Y #dscam164#0 = #dscam003#40; |HACIENDO;
         nLinea = nLinea + 1;
         |LEE 000#dscam164.s;
      |SIGUE;

      |DDEFECTO #dscam164;
      #dscam164#0 = #dscam003#40;
      #dscam164#1 = #dscaz198#12;
      #dscam164#2 = #dscaz198#13;
      #dscam164#3 = #dscam003#35;
      #dscam164#4 = #dscam003#36;
      #dscam164#5 = #dscaz198#10;
      #dscam164#6 = #dscaz198#11;
      #dscam164#7 = Usuario % 0810;
      #dscam164#8 = nLinea;
      #dscam164#9 = #dscam003#14;
      #dscam164#10 = #dscam003#15;
      #dscam164#11 = fVtoAnt;
      |GRABA 020#dscam164.c;

      #dscam003#35 = #dscaz198#10;
      #dscam003#36 = #dscaz198#11;
/*
      aAlfa = #dscam003#36;
      aAlfa = aAlfa % 0119; aAlfa = aAlfa + " " + #dscam164#1;
      #dscam003#36 = aAlfa;
*/
      eaUsuario = Usuario % 0810;
      eaTipoReg = "CB";  eaNumero = ("000000000" + #dscam003#40) % -109;
      eaDescr   = "MODIFICACION SITUACION RECIBO (" + (("000000000" + #dscam003#40) % -109);
      eaDescr   = eaDescr + ") DESDE CAMBIO SITUACION";
      eaTipoOp  = "M"; enImpAnt = #dscam003#30; enImpAct = #dscam003#30;
      eaFicher = "dscam003"; eaClave = #dscam003#40;
      |HAZ GrabaAudit;

      #dscam217#0 = #dscaz198#10;
      |LEE 000#dscam217.=;
      |SI FSalida = 0;
         |SI #dscam217#2 = "S";
            |ABRE #dscam004;
            |SI #dscam217#3 = "L";
               |SI #dscam003#14 = "I"; |O #dscam003#14 = "P";
                  nLinea = 1;
                  #dscam004#17 = #dscam003#40;
                  #dscam004#3 = 99;
                  |LEE 000#dscam004.];
                  |SI FSalida = 0;
                     |LEE 000#dscam004.a;
                  |SINO;
                     |LEE 000#dscam004.u;
                  |FINSI;
                  |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
                     nLinea = #dscam004#3 + 1;
                  |FINSI;

                  |DDEFECTO #dscam004;
                  #dscam004#17 = #dscam003#40;
                  #dscam004#3  = nLinea;
                  |GRABA 020#dscam004.b;

                  #dscam004#0  = #dscam003#0;
                  #dscam004#1  = #dscam003#1;
                  #dscam004#2  = #dscam003#2;
                  #dscam004#5  = "CSI";   || Cambio de situacion
                  #dscam004#6  = ~;
                  #dscam004#7  = #dscam003#23;
                  #dscam004#8  = #dscam003#31;
                  #dscam004#11 = #dscam003#13;
                  #dscam004#15 = #dscam003#27;
                  #dscam004#16 = "Cambio situacion " + #dscam164#8;
                  #dscam004#25 = #dscam003#61;
                  #dscam004#26 = #dscam003#65;
                  #dscam004#33 = 1;
                  #dscam004#40 = #dscam003#47;
                  |GRABA 020#dscam004.a; |LIBERA #dscam004;

                  |SI #dscam051#3 = "S";
                     |SI #dscam003#14 = "I";
                        eaTipoOper = "-7";
                     |SINO;
                        eaTipoOper = "-4";
                     |FINSI;
                     enEmpCartera = -1;     enEmpGestion = #dscam003#46;
                     eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
                     nImporte = #dscam004#8;
                     |HAZ BucleRiesgo;
                  |FINSI;

                  #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
                  #dscam003#31 = 0;            #dscam003#65 = 0;

                  #dscam003#14 = #dscam217#3;
                  #dscam003#15 = #dscam217#4;
               |FINSI;
            |FINSI;
            |SI #dscam217#3 = "I";
               |SI #dscam003#14 = "P"; |O #dscam003#14 = "I";
                  nLinea = 1;
                  #dscam004#17 = #dscam003#40;
                  #dscam004#3 = 99;
                  |LEE 000#dscam004.];
                  |SI FSalida = 0;
                     |LEE 000#dscam004.a;
                  |SINO;
                     |LEE 000#dscam004.u;
                  |FINSI;
                  |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
                     nLinea = #dscam004#3 + 1;
                  |FINSI;

                  |DDEFECTO #dscam004;
                  #dscam004#17 = #dscam003#40;
                  #dscam004#3  = nLinea;
                  |GRABA 020#dscam004.b;

                  #dscam004#0  = #dscam003#0;
                  #dscam004#1  = #dscam003#1;
                  #dscam004#2  = #dscam003#2;
                  #dscam004#5  = "CSI";   || Cambio de situacion
                  #dscam004#6  = ~;
                  #dscam004#7  = #dscam003#23;
                  #dscam004#9  = #dscam003#31;
                  #dscam004#11 = #dscam003#13;
                  #dscam004#15 = #dscam003#27;
                  #dscam004#16 = "Cambio situacion " + #dscam164#8;
                  #dscam004#25 = #dscam003#61;
                  #dscam004#27 = #dscam003#65;
                  #dscam004#33 = 1;
                  #dscam004#40 = #dscam003#47;
                  |GRABA 020#dscam004.a; |LIBERA #dscam004;

                  |SI #dscam051#3 = "S"; |Y #dscam003#14 = "P";
                     eaTipoOper = "-4+7";
                     enEmpCartera = -1;     enEmpGestion = #dscam003#46;
                     eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
                     nImporte = #dscam004#9;
                     |HAZ BucleRiesgo;
                  |FINSI;

                  #dscam003#31 = #dscam003#30; #dscam003#65 = #dscam003#64;
                  #dscam003#23 = 0;            #dscam003#61 = 0;
                  |SI #dscam003#14 = "P";
                     #dscam003#16 = #dscam003#16 + 1;
                  |FINSI;
                  #dscam003#14 = #dscam217#3;
                  #dscam003#15 = #dscam217#4;
               |FINSI;
            |FINSI;
            |SI #dscam217#3 = "P";
               |SI #dscam003#14 = "L";
                  nLinea = 1;
                  #dscam004#17 = #dscam003#40;
                  #dscam004#3 = 99;
                  |LEE 000#dscam004.];
                  |SI FSalida = 0;
                     |LEE 000#dscam004.a;
                  |SINO;
                     |LEE 000#dscam004.u;
                  |FINSI;
                  |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
                     nLinea = #dscam004#3 + 1;
                  |FINSI;

                  |DDEFECTO #dscam004;
                  #dscam004#17 = #dscam003#40;
                  #dscam004#3  = nLinea;
                  |GRABA 020#dscam004.b;

                  #dscam004#0  = #dscam003#0;
                  #dscam004#1  = #dscam003#1;
                  #dscam004#2  = #dscam003#2;
                  #dscam004#5  = "CSI";   || Cambio de situacion
                  #dscam004#6  = ~;
                  #dscam004#7  = #dscam003#23;
                  #dscam004#8  = -#dscam003#23;
                  #dscam004#11 = #dscam003#13;
                  #dscam004#15 = #dscam003#27;
                  #dscam004#16 = "Cambio situacion " + #dscam164#8;
                  #dscam004#25 = #dscam003#61;
                  #dscam004#26 = #dscam003#65;
                  #dscam004#33 = 1;
                  #dscam004#40 = #dscam003#47;
                  |GRABA 020#dscam004.a; |LIBERA #dscam004;

                  |SI #dscam051#3 = "S";
                     eaTipoOper = "+4";
                     enEmpCartera = -1;     enEmpGestion = #dscam003#46;
                     eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
                     nImporte = #dscam004#8;
                     |HAZ BucleRiesgo;
                  |FINSI;

                  #dscam003#31 = #dscam003#30; #dscam003#65 = #dscam003#64;
                  #dscam003#23 = 0;            #dscam003#61 = 0;
                  #dscam003#14 = #dscam217#3;
                  #dscam003#15 = #dscam217#4;
               |FINSI;
            |FINSI;
            |CIERRA #dscam004;
         |FINSI;
      |FINSI;

      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;
|FPRC;

|DEFBUCLE VuelcaCambios;
#dscaz198#1;
;
INICIO;
FINAL;
;
NULL, VuelcaCambios;
|FIN;

|RUTINA inf;
   #dscaz198#0 = 1;
|FRUT;

|RUTINA sup;
   #dscaz198#0 = 99999;
|FRUT;

|PROCESO MiraVto;
   |ABRE #dscam217;
   #dscam217#0 = #dscaz198#10;
   |LEE 000#dscam217.=;
   |SI FSalida = 0;
      #dscaz198#11 = #dscam217#1; |PINTA #dscaz198#11;

      |SI #dscam217#2 = "S"; |Y #dscam217#3 = "I";
         |SI #dscaz198#15 ! "P"; |Y #dscaz198#15 ! "I";
             |SI PARAMETRO = "";
                  |MENAV "    El recibo no está pendiente. No se cambiará la situacion a impagado.";
                  |ERROR;
             |FINSI;
         |FINSI;
      |FINSI;
      |SI #dscam217#5 = "N"; |ACABA; |FINSI;
   |SINO;
      |ACABA;
   |FINSI;

   |PUSHV 0501 2380;

   #dscaw218#0 = #dscaz198#14;

   #dscam221#0 = #dscaz198#1;
   |LEE 000#dscam221.=;
   |SI FSalida = 0;
      #dscaw218#1 = #dscam221#1;
      #dscaw218#2 = #dscam221#3;
   |SINO;
      #dscam003#40 = #dscaz198#1;
      |LEE 000#dscam003.=;
      |SI FSalida ! 0; |DDEFECTO #dscam003; |FINSI;

      #dscaw218#1 = #dscam003#3;
      #dscaw218#2 = #dscam003#3;
   |FINSI;

   |PINPA #0#dscaw218; |PINDA #0#dscaw218;
   |ENDATOS #1#dscaw218;
   |SI FSalida = 0;
      #dscaz198#14 = #dscaw218#0;
   |SINO;
      |ERROR;
   |FINSI;

   |POPV;
|FPRC;

|PROCESO MiraSitNueva;
     |SI PARAMETRO ! ""; |Y #dscaw206#2 = "   ";
        |MENAV "    No se puede dejar la situacion vacia";
        |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO CopiaObs;
     #219#0 = aAlfa;
     |GRABA 020#219n;
|FPRC;

|DEFBUCLE CopiaObs;
     #219#1;
     ;
     eaObs, 000;
     eaObs, 999;
     ;
     NULL, CopiaObs;
|FIN;

|PROGRAMA;
     |HAZ Tipo8;

     |SI PARAMETRO = ""; |CLS; |CABEZA "Gesti¢n de morosos"; |FINSI;

     |ABRE #dscam051;
     |LEE 000#dscam051.p;
     |SI FSalida ! 0; |DDEFECTO #dscam051; |FINSI;
     |CIERRA #dscam051;

     |DELINDEX #dscaz198;
     |ABRE #dscam003; |ABRE #dscam164; |ABRE #dscam217; |ABRE #dscam221;

     |SI PARAMETRO ! "";
          |ABRE #dscaz198;
          |DDEFECTO #dscaz198;
          #dscaz198#0 = 1;
          #dscaz198#1 = PARAMETRO;
          |HAZ RecogeDatos;
          |GRABA 020#dscaz198.c;

          |SI eaSituRec = "";
               #dscaw206#0 = #dscaz198#8;
               #dscaw206#1 = #dscaz198#9;
               |PUSHV 0501 2380;
               |BLANCO 1113 1769;
               |PINPA #0#dscaw206; |PINDA #0#dscaw206;
               |ENDATOS #1#dscaw206;
               |SI FSalida = 0;
                    #dscaz198#10 = #dscaw206#2; |HAZ MiraVto;
                    #dscaz198#11 = #dscaw206#3;
                    |GRABA 020#dscaz198.a;

                    enDocumto  = #dscaz198#1;
                    efFechaMov = #dscaz198#12;
                    eaHoraMov = #dscaz198#13;
                    eaSituRec = #dscaw206#2;

                    enCuadroIni  = 1210;
                    enCuadroFin  = 2270;
                    eaTitulo     = " Observaciones cambio situacion recibo " + #dscaz198#1 + " ";
                    eaObs = (("0000000000" + #dscaz198#1) % -110) + "/" + #dscaz198#12 + "/" + #dscaz198#13;
                    aAlfa = "dscaz200.tab;" + eaObs;
                    |SUB_EJECUTA aAlfa;
                    |BUCLE VuelcaCambios;
               |SINO;
                    |MENAV "    Proceso anulado";
                    enDocumto  = -1;
                    efFechaMov = "01.01.0000";
                    eaHoraMov  = "";
                    eaSituRec = "";
                    eaObs = "";
               |FINSI;
               |POPV;
          |SINO;
               #dscaw206#0 = #dscaz198#8;
               #dscaw206#1 = #dscaz198#9;

               #dscaw206#2 = eaSituRec;
               |ABRE #dscam217;
               #dscam217#0 = #dscaw206#2;
               |LEE 000#dscam217.=;
               |SI FSalida ! 0; |DDEFECTO #dscam217; |FINSI;
               |CIERRA #dscam217;
               #dscaw206#3 = #dscam217#1;

               #dscaz198#10 = #dscaw206#2; |HAZ MiraVto;
               #dscaz198#11 = #dscaw206#3;
               |GRABA 020#dscaz198.a;

               enDocumto  = #dscaz198#1;
               efFechaMov = #dscaz198#12;
               eaHoraMov = #dscaz198#13;
               eaSituRec = #dscaw206#2;

               aAlfa = (("0000000000" + #dscaz198#1) % -110) + "/" + #dscaz198#12 + "/" + #dscaz198#13;
               |BUCLE CopiaObs;
               |BUCLE VuelcaCambios;
          |FINSI;
          |CIERRA #dscaz198;
     |SINO;
          |PINPA #0#dscaz198; |PINDA #0#dscaz198;
          |ABRE #dscaz198;

          |ENTLINEAL #1#dscaz198, 1, 1, 17, 1, inf, sup;

          |LEE 000#dscaz198.p;
          |SI FSalida = 0;
               aAlfa = "    " + &191 + " Conforme con la selecci¢n ? ";
               |CONFI aAlfa;
               |SI FSalida = 0;
                    |BUCLE VuelcaCambios;
               |FINSI;
          |FINSI;
          |CIERRA #dscaz198;
     |FINSI;
     |CIERRA #dscam003; |CIERRA #dscam164;
     |CIERRA #dscam217; |CIERRA #dscam221;

     |DELINDEX #dscaz198;

     |SI PARAMETRO ! ""; |HAZ Tipo9; |FINSI;
|FPRO;
