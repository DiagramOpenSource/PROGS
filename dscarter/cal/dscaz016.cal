|| Parece que hay algun tipo de problema con algunos bancos que devuelven el
||   ficherito generado. El problema parece estar en el n§ de registros de
||   la linea del total ordenante.

|| Esta norma la utilizan Tecatel y Ciagan

|FICHEROS;
   dscaz016 #0;
   dscam015 #1;

   dscam012 #2;
   dscam013 #3;
   dscam003 #4;
   dscam014 #5;
   dscam030 #6;
   dscaw013 #7;
   dscam004 #8;
   dscam051 #9;
   dscaw038 #10;
   dscam093 #11,MANTE;

   &agif024@ #150;
   &agif321@ #151;
   &caclipr@ #152;
|FIN;

|VARIABLES;
   &HayGestion = 0;
   &Fichero = ""; &Tipo = ""; &Cmp = ""; &CmpNum = 0;
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = "";
   &nDeci_Base = 0; &nDeci_Div = 0; &eaNombre1   = "";
   &aCuenta    = ""; &nNivel = 0;
   &eaCodigo    = "";
   &eaTipoCod   = "";
   &eaNif       = "";
   &eaNombre    = "";
   &eaDireccion = "";
   &eaDirCobro  = "";
   &eaPoblacion = "";
   &eaPobCobro  = "";
   &eaProvincia = "";
   &eaProvCobro = "";
   &eaCP        = "";
   &eaCPCobro   = "";
   &eaCP1       = "";
   &eaCP1Cobro  = "";
   &eaCP2       = "";
   &eaCP2Cobro  = "";
   &eaTelefono  = "";
   &eaTlfCobro  = "";

   aAlfa = "";

   nSwLuxe = 0;
   nCalc = 0;
   nPos1 = 0;
   nPos2 = 0;
   nModo = 0;
   aFinLin = ""; aFinFic = "";
   VAlfa   = "";
   VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = ""; VAlfa06 = "";
   VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = ""; VAlfa11 = ""; VAlfa12 = "";
   VAlfa13 = ""; VAlfa14 = ""; VAlfa15 = "";

   Field = ""; Tipo1 = ""; Fecha = ""; Comodin = ""; Comodin1 = "";
   NumDig = 0; Calc = 0;  Handle = 0; LinCob  = 0;

   NumOrd = 0; TotalOrd = 0;
   NumInd = 0; TotalInd = 0;
   NumRegs = 0;
   NumDomics = 0;
   EmpreAnt = 0; PerioAnt = 0;
   aDir = ""; aPob = ""; aCP1 = ""; aCP2 = "";

   handle = 0;
   SwEmit  = 0; SwHayNoEmit  = 0; SwHay  = 0;

   &eaOrigen = "";
   &HayConta = 0;
   &Divisa   = "";
   &enEmpCartera = 0; &enEmpGestion = 0; &enBanco = 0;
   &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = "";

   Moneda = "";
   Cambio = 0;
   Redond = 0;
   Prefijo = "";

   n870 = 0;

|FIN;

|PROCESO IniVars;
   VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = ""; VAlfa06 = "";
   VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = ""; VAlfa11 = ""; VAlfa12 = "";
   Field = ""; Tipo1 = ""; Fecha = ""; Comodin = "";
   NumDig = 0; Calc = 0;
|FPRC;

|PROCESO Presentador;
   |HAZ IniVars;

   VAlfa01 = Prefijo + "170";
   Field = #dscam014#47; Tipo1 = "N"; NumDig = 9; |HAZ Formato ; VAlfa02 = Field;
   Field = #dscaz016#8;  Tipo1 = "N"; NumDig = 3; |HAZ Formato ; VAlfa03 = Field;
   Fecha = #dscaz016#6;  |HAZ RetocaFecha; VAlfa04 = Fecha;
   VAlfa05 = "      ";
   Field = #dscam014#46; Tipo1 = "A"; NumDig = 40; |HAZ Formato ; VAlfa06 = Field;
   VAlfa07 = " " * 20;
   Field = #dscam014#48; Tipo1 = "N"; NumDig = 4;  |HAZ Formato ; VAlfa08 = Field;
   Field = #dscam014#49; Tipo1 = "N"; NumDig = 4;  |HAZ Formato ; VAlfa09 = Field;
   VAlfa10 = " " * 12;
   Field = #dscam014#72; Tipo1 = "A"; NumDig = 11;  |HAZ Formato ; VAlfa11 = Field;

/* || ABDON Tiquet 001980/00584  06/07/2011
   || ABDON Tiquet 001655/00826  05/11/2009
   |QBF VAlfa11; VAlfa11 = (("0" * 11) + VAlfa11) % -111;
*/

   VAlfa12 = (" " * 43);
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa   + VAlfa08 + VAlfa09 + VAlfa10 + VAlfa11 + VAlfa12;

   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
   n870 = n870 + 1;

   TotalOrd = 0;
   NumOrd = 0;
|FPRC;

|PROCESO Ordenante;
   |HAZ IniVars;

   VAlfa01 = Prefijo + "370";
   Field = #dscam014#47; Tipo1 = "N"; NumDig = 9; |HAZ Formato ; VAlfa02  = Field;
   Field = #dscaz016#16; Tipo1 = "N"; NumDig = 3; |HAZ Formato ; VAlfa03  = Field;
   Fecha = #dscaz016#6;  |HAZ RetocaFecha; VAlfa04 = Fecha;
   VAlfa05 = "      ";
   Field = #dscam014#52; Tipo1 = "A"; NumDig = 40; |HAZ Formato ; VAlfa06  = Field;

   Field = #dscam014#55; Tipo1 = "N"; NumDig = 4;  |HAZ Formato ; VAlfa07  = Field;
   Field = #dscam014#56; Tipo1 = "N"; NumDig = 4;  |HAZ Formato ; VAlfa08  = Field;
   Field = #dscam014#58; Tipo1 = "N"; NumDig = 2;  |HAZ Formato ; VAlfa09  = Field;
   Field = #dscam014#57; Tipo1 = "N"; NumDig = 10; |HAZ Formato ; VAlfa10 = Field;
   VAlfa11 = "        ";
   VAlfa12 = "06";
   VAlfa13 = " " * 10;
   Field = #dscam014#72; Tipo1 = "A"; NumDig = 11;  |HAZ Formato ; VAlfa14 = Field;

/* || ABDON Tiquet 001980/00584  06/07/2011
   || ABDON Tiquet 001655/00826  05/11/2009
   |QBF VAlfa14; VAlfa14 = (("0" * 11) + VAlfa14) % -111;
*/

   VAlfa15 = (" " * 43);
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa   + VAlfa08 + VAlfa09 + VAlfa10 + VAlfa11 + VAlfa12 + VAlfa13;
   VAlfa = VAlfa   + VAlfa14 + VAlfa15;

   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
   n870 = n870 + 1;

   TotalInd = 0;
   NumInd = 2;
   NumOrd = NumOrd + 1;
|FPRC;

|PROCESO Individual;

   #dscam003#40 = #dscam013#16;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      Divisa = #dscam003#57; |HAZ TomaDecim;
   |FINSI;

   aDir = ""; aPob = ""; aCP1 = ""; aCP2 = "";
   eaCodigo = #dscam003#32; eaTipoCod = "C"; aCuenta = #dscam003#5; |HAZ LeeDatos;
   aDir = eaDirCobro; aPob = eaPobCobro; aCP1 = eaCP1Cobro; aCP2 = eaCP2Cobro;

   VAlfa01 = Prefijo + "670";
   Field = #dscam014#47; Tipo1 = "N"; NumDig = 9; |HAZ Formato ; VAlfa02  = Field;
   Field = #dscaz016#16; Tipo1 = "N"; NumDig = 3; |HAZ Formato ; VAlfa03  = Field;
   |SI #dscam014#71 = "C";
      VAlfa04 = "0" * 6;
      Field = #dscam003#32; Tipo1 = "A"; NumDig = 6;  |HAZ Formato ; VAlfa04  = VAlfa04 + Field;
   |SINO;
      Field = eaNif; Tipo1 = "A"; NumDig = 12;  |HAZ Formato ; VAlfa04  = Field;
   |FINSI;
   Field = #dscam003#6;  Tipo1 = "A"; NumDig = 40; |HAZ Formato ; VAlfa05  = Field;
   Field = #dscam003#8;  Tipo1 = "N"; NumDig = 4;  |HAZ Formato ; VAlfa06  = Field;
   Field = #dscam003#9;  Tipo1 = "N"; NumDig = 4;  |HAZ Formato ; VAlfa07  = Field;
   Field = #dscam003#10; Tipo1 = "N"; NumDig = 2;  |HAZ Formato ; VAlfa08  = Field;
   Field = #dscam003#11; Tipo1 = "N"; NumDig = 10; |HAZ Formato ; VAlfa09  = Field;
   Field = #dscam013#7;  Tipo1 = "I"; NumDig = 10; |HAZ Formato ; VAlfa10  = Field;
   VAlfa11 = " " * 6;
   VAlfa11 = VAlfa11 + ((("0" * 10) + #dscam003#40) % -110);
   VAlfa12 = #dscam014#59; |QBF VAlfa12;
   |SI #dscam014#60 = "S";
      Field = #dscam003#0;  Tipo1 = "N"; NumDig = 5; |HAZ Formato; VAlfa12 = VAlfa12 + " " + Field;
   |FINSI;
   |SI #dscam014#61 = "S";
      Field = #dscam003#1;  Tipo1 = "N"; NumDig = 6; |HAZ Formato; VAlfa12 = VAlfa12 + "/" + Field;
   |FINSI;
   |SI #dscam014#62 = "S";
      Field = #dscam003#2;  Tipo1 = "N"; NumDig = 3; |HAZ Formato; VAlfa12 = VAlfa12 + "/" + Field;
   |FINSI;
   Field = VAlfa12;         Tipo1 = "A"; NumDig = 40; |HAZ Formato; VAlfa12  = Field;
   Fecha = #dscam003#3;  |HAZ RetocaFecha; VAlfa13 = Fecha;
   VAlfa14 = (" " * 2);
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa   + VAlfa08 + VAlfa09 + VAlfa10 + VAlfa11 + VAlfa12 + VAlfa13 + VAlfa14;

   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
   n870 = n870 + 1;

   VAlfa01 = Prefijo + "676";
   Field = #dscam014#47; Tipo1 = "N"; NumDig = 9;  |HAZ Formato ; VAlfa02  = Field;
   Field = #dscaz016#16; Tipo1 = "N"; NumDig = 3;  |HAZ Formato ; VAlfa03  = Field;
   |SI #dscam014#71 = "C";
      VAlfa04 = "0" * 6;
      Field = #dscam003#32; Tipo1 = "A"; NumDig = 6;  |HAZ Formato ; VAlfa04  = VAlfa04 + Field;
   |SINO;
      Field = eaNif; Tipo1 = "A"; NumDig = 12;  |HAZ Formato ; VAlfa04  = Field;
   |FINSI;
   Field = aDir;  Tipo1 = "A"; NumDig = 40; |HAZ Formato ; VAlfa05  = Field;
   Field = aPob;  Tipo1 = "A"; NumDig = 35; |HAZ Formato ; VAlfa06  = Field;
   Field = aCP1;  Tipo1 = "N"; NumDig = 2;  |HAZ Formato ; VAlfa07  = Field;
   Field = aCP2;  Tipo1 = "N"; NumDig = 3;  |HAZ Formato ; VAlfa08  = Field;
   Field = aPob;  Tipo1 = "A"; NumDig = 38; |HAZ Formato ; VAlfa09  = Field;
   Field = #dscam014#51; Tipo1 = "N"; NumDig = 2;  |HAZ Formato ; VAlfa10  = Field;
   Comodin = #dscaz016#6; Field = (Comodin % 0102) + (Comodin % 0402) + (Comodin % -102);
   Tipo1 = "A"; NumDig = 6;  |HAZ Formato ; VAlfa11  = Field;
   VAlfa12 = (" " * 8);
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa   + VAlfa08 + VAlfa09 + VAlfa10 + VAlfa11 + VAlfa12;

   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
   n870 = n870 + 1;

   TotalInd = TotalInd + #dscam013#7;
   TotalOrd = TotalOrd + #dscam013#7;
   NumInd = NumInd + 1;
   NumDomics = NumDomics + 1;

   |SI #dscam012#23 = "N";
      |HAZ ActRecibo;
   |FINSI;
   |LIBERA #dscam003;
|FPRC;

|PROCESO TotalOrden;

   VAlfa01 = Prefijo + "870";
   Field = #dscam014#47; Tipo1 = "N"; NumDig = 9; |HAZ Formato ; VAlfa02  = Field;
   Field = #dscaz016#16; Tipo1 = "N"; NumDig = 3; |HAZ Formato ; VAlfa03  = Field;
   VAlfa04 = " " * 72;
   Field = TotalInd;     Tipo1 = "I"; NumDig = 10;|HAZ Formato ; VAlfa05  = Field;
   VAlfa06 = "      ";
   Field = NumDomics; Tipo1 = "N"; NumDig = 10;|HAZ Formato ; VAlfa07  = Field;
   Field = n870;      Tipo1 = "N"; NumDig = 10;|HAZ Formato ; VAlfa08  = Field;
   VAlfa09 = (" " * 38);
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa   + VAlfa08 + VAlfa09;

   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
|FPRC;

|PROCESO TotalGeneral;
   VAlfa01 = Prefijo + "970";
   Field = #dscam014#47; Tipo1 = "N"; NumDig = 9; |HAZ Formato ; VAlfa02  = Field;
   Field = #dscaz016#8;  Tipo1 = "N"; NumDig = 3; |HAZ Formato ; VAlfa03  = Field;
   VAlfa04 = " " * 52;
   Field = NumOrd;       Tipo1 = "N"; NumDig = 4; |HAZ Formato ; VAlfa05  = Field;
   VAlfa06 = " " * 16;
   Field = TotalOrd;     Tipo1 = "I"; NumDig = 10;|HAZ Formato ; VAlfa07  = Field;
   VAlfa08 = "      ";
   ||Field = NumOrd;       Tipo1 = "N"; NumDig = 10;|HAZ Formato ; VAlfa09  = Field;
   Field = NumDomics;    Tipo1 = "N"; NumDig = 10;|HAZ Formato ; VAlfa09  = Field;
   ||Calc = NumInd + 2;
   Calc = n870 + 2;
   Field = Calc;         Tipo1 = "N"; NumDig = 10;|HAZ Formato ; VAlfa10  = Field;
   VAlfa11 = (" " * 38);
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa   + VAlfa08 + VAlfa09 + VAlfa10 + VAlfa11;

   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
|FPRC;

|PROCESO ActRecibo;
   || Actualizo  el historico de cobros
   #dscam004#17 = #dscam013#16;
   #dscam004#3 = 99;
   |LEE 000#dscam004.];
   |SI FSalida ! 0;
      |LEE 010#dscam004.u;
      |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
         LinCob = #dscam004#3 + 1;
      |SINO;
         LinCob = 1;
      |FINSI;
   |SINO;
      |SI #dscam004#17 = #dscam013#16;
         LinCob = #dscam004#3 + 1;
      |SINO;
         |LEE 010#dscam004.a;
         |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
            LinCob = #dscam004#3 + 1;
         |SINO;
            LinCob = 1;
         |FINSI;
      |FINSI;
   |FINSI;

   |DDEFECTO #dscam004;
   #dscam004#17 = #dscam013#16;
   #dscam004#15 = #dscam013#2;
   #dscam004#0  = #dscam013#4;
   #dscam004#1  = #dscam013#3;
   #dscam004#2  = #dscam013#5;
   #dscam004#3  = LinCob;
   #dscam004#4  = #dscam012#14;
   #dscam004#5  = "EMR";
   #dscam004#6  = #dscaz016#6;
   #dscam003#40 = #dscam013#16;
   |LEE 010#dscam003.=;
   |SI FSalida = 0;
      #dscam004#7  = #dscam003#23; #dscam004#25  = #dscam003#61;
   |FINSI;
   #dscam004#8  = 0;
   #dscam004#9  = 0;
   #dscam004#10 = 0;
   #dscam004#26 = 0;
   |GRABA 020#dscam004.n;

   #dscam013#24 = LinCob; |GRABA 020#dscam013.a;
/*
   #dscam013#17 = LinCob; |GRABA 020#dscam013.a;
   || Actualizo el riesgo de cliente

   |SI #dscam051#3 = "S";
      enBanco = #dscam012#2;
      || enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
      enEmpCartera = -1;      enEmpGestion = #dscam003#46;
      eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
      nImporte = #dscam013#7; eaTipoOper = "+6-4";
      |HAZ BucleRiesgo;
   |FINSI;

   || Actualizo el recibo
   #dscam003#40 = #dscam013#16;
   |LEE 010#dscam003.=;
   |SI FSalida = 0;
      #dscam003#14 = "L";
      #dscam003#15 = "Recibo liquidado";
      #dscam003#26 = #dscam012#1;
      #dscam003#23 = #dscam003#23 + #dscam013#22; #dscam003#61 = #dscam003#61 + #dscam013#7;
      #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
      #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
      #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
      Comodin = #dscam003#31; |QBF Comodin; Calc = Comodin;
      #dscam003#31 = #dscam003#30 - #dscam003#23; #dscam003#65 = #dscam003#64 - #dscam003#61;
      |GRABA 020#dscam003.a;
   |FINSI;
*/
|FPRC;

|DEFBUCLE Recibos;
#dscam013#1;
;
#dscam012#0,001;
#dscam012#0,999;
;
NULL,Individual;
|FIN;

|PROCESO Remesas;

   #dscam012#0 = #dscaw038#0;
   |LEE 101#dscam012.=;
   |SI FSalida = 0;
      SwEmit = #dscam012#23;
   |FINSI;

   eaUsuario = Usuario % 0810;
   eaDescr   = "EMISION REMESA (" + (("00000" + #dscam012#0) % -105);
   eaDescr   = eaDescr + ") EN DISKETTE DESDE NORMA 58";
   eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
   eaTipoOp  = "E";   enImpAnt = #dscam012#10; enImpAct = #dscam012#10;
   |HAZ GrabaAudit;

   |BUCLE Recibos;
   |SI #dscam012#23 = "N";
      #dscam012#23 = "S"; |GRABA 020#dscam012.a;
   |FINSI;
   |LIBERA #dscam012;

   |SI HayConta = 1; |Y SwEmit = "N"; |Y #dscam051#1 = "S";
      |ABRE #dscam030;
      #dscam030#0 = #dscaz016#14;
      |LEE 010#dscam030.=;
      |SI FSalida = 0;
         |SI #dscam030#4 ! #dscaw038#3; |O #dscam030#5 ! #dscaw038#4;
            EmpreAnt = #dscam030#4; PerioAnt = #dscam030#5;
            #dscam030#4 = #dscaw038#3; #dscam030#5 = #dscaw038#4;
            |GRABA 020#dscam030.a;
         |SINO;
            EmpreAnt = -1;
         |FINSI;
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #7 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         Comodin = #dscaz016#14;
         |SI Comodin = "    ";
            |ABRE #dscam093;
            #dscam093#0 = "E";
            |LEE 000#dscam093.=;
            |SI FSalida = 0;
               |SI #dscam012#22 = 1; Comodin = #dscam093#1; |FINSI;
               |SI #dscam012#22 = 2; Comodin = #dscam093#3; |FINSI;
               |SI #dscam012#22 = 3; Comodin = #dscam093#5; |FINSI;
               |SI #dscam012#22 = 4; Comodin = #dscam093#7; |FINSI;
               |SI #dscam012#22 = 5; Comodin = #dscam093#9; |FINSI;
            |FINSI;
            |CIERRA #dscam093;
         |FINSI;
         |DDEFECTO #dscaw013;
         #dscaw013#0  = 1;            #dscaw013#15 = Comodin;
         #dscaw013#5  = #dscam012#0;  #dscaw013#6  = #dscam012#0;
         #dscaw013#11 = "N";          #dscaw013#12 = 5;
         #dscaw013#13 = "dscam013";   #dscaw013#14 = 0;
         |GRABA 020#dscaw013.n;
         |CIERRA #dscaw013;

         Comodin = "dscam033.tab;" + Comodin + ",I";
         |LIBERA #dscam012; |CIERRAT #dscam012;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam012; |LEE 101#dscam012.=;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

         |SI EmpreAnt ! -1;
            #dscam030#4 = EmpreAnt; #dscam030#5 = PerioAnt;
            |GRABA 020#dscam030.a;
         |FINSI;
      |FINSI;
      |CIERRA #dscam030;
   |FINSI;

|FPRC;

|DEFBUCLE Remesas;
#dscaw038#1;
;
INICIO;
FINAL;
;
NULL,Remesas;
|FIN;

|PROCESO MiraRemesas;
   SwHay = 1;
   |DDEFECTO #dscaw038;
   #dscaw038#0 = #dscam012#0;
   #dscaw038#1 = #dscam012#10;
   #dscaw038#2 = #dscaz016#14;
   #dscaw038#5 = #dscam012#23;
   |SI #dscaw038#5 = "N";
      SwHayNoEmit = 1;
   |FINSI;

   |ABRE #dscam030;
   #dscam030#0 = #dscaz016#14;
   |LEE 000#dscam030.=;
   |SI FSalida = 0;
      #dscaw038#3 = #dscam030#4;
      #dscaw038#4 = #dscam030#5;
   |FINSI;
   |CIERRA #dscam030;
   |GRABA 020#dscaw038.n;
|FPRC;

|DEFBUCLE MiraRemesas;
#dscam012#1;
1,2;
#0#0,#0#2,#dscam014#0;
#0#1,#0#3,#dscam014#0;
;
NULL,MiraRemesas;
|FIN;

|RUTINA infw038;
   #dscaw038#0 = 00001;
   #dscaw038#5 = "N";
|FRUT;

|RUTINA supw038;
   #dscaw038#0 = 99999;
   #dscaw038#5 = "N";
|FRUT;

|PROCESO Secuencial;

   |DELINDEX #dscaw038;
   SwHayNoEmit = 0; SwHay = 0;
   |ABRE #dscaw038; |BUCLE MiraRemesas; |CIERRA #dscaw038;
   |SI SwHay = 0; |ACABA; |FINSI;

   |SI #dscaz016#15 = "N";
      |SI SwHayNoEmit = 1;
         |PUSHV 0501 2380;
         |ENTLINEAL #1#dscaw038,1,2,19,1,infw038,supw038;
         |POPV;
      |SINO;
         |MENAV "    No hay remesas sin emitir para redireccionar";
      |FINSI;
   |FINSI;

   aAlfa = #dscam014#46; |QBF aAlfa;
   |SI aAlfa = "";
      aAlfa = #dscam014#47; |QBF aAlfa;
      |SI aAlfa = "";
         aAlfa = #dscam014#53; |QBF aAlfa;
         |SI aAlfa = "";
            aAlfa = #dscam014#54; |QBF aAlfa;
            |SI aAlfa = "";
               aAlfa = #dscam014#72; |QBF aAlfa;
               |SI aAlfa = "";
                  |PUSHV 0910 1970; |BLANCO 0910 1970;
                  |CUADRO 0910 1970;
                  |ATRI R;
                  |PINTA 1012, "Los datos para la emision de remesas en soporte magnetico";
                  |PINTA 1112, "estan vacios. Seleccione un registro del fichero anterior";
                  |PINTA 1212, "del cual importar los datos necesarios.                  ";
                  |ATRI N;
                  nPos1 = 1312; nPos2 = 1868; nModo = 2 + 4 + 8 + 16;
                  |ABRE #dscam015;
                  |ET OtraVez;
                  |LINEAL_SIMPLE #1#dscam015,nModo, nPos1, nPos2, NULL, NULL, NULL;
                  |SI FSalida < 0;
                     |CONFI "    SSin datos para emitir remesas en soporte magnetico no podra emitir dichas normas. Continuar ? ";
                     |SI FSalida ! 0;
                        |VETE OtraVez;
                     |SINO;
                        |ACABA;
                     |FINSI;
                  |SINO;
                     #dscam014#46 = #dscam015#2;
                     #dscam014#47 = #dscam015#3;
                     #dscam014#48 = #dscam015#12;
                     #dscam014#49 = #dscam015#13;
                     #dscam014#72 = #dscam015#19;
                     #dscam014#51 = #dscam015#20;
                     #dscam014#52 = #dscam015#6;
                     #dscam014#53 = #dscam015#7;
                     #dscam014#54 = #dscam015#21;
                     #dscam014#55 = #dscam015#8;
                     #dscam014#56 = #dscam015#9;
                     #dscam014#57 = #dscam015#11;
                     #dscam014#58 = #dscam015#10;
                     #dscam014#59 = #dscam015#14;
                     #dscam014#60 = #dscam015#15;
                     #dscam014#61 = #dscam015#16;
                     #dscam014#62 = #dscam015#17;
                     |GRABA 020#dscam014.a;
                  |FINSI;
                  |CIERRA #dscam015;
                  |POPV;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   #dscaz016#8 = #dscam014#79;
   #dscaz016#16 = #dscam014#81;
/* Quitado segun Tiquet 778:462
   |SI nSwLuxe = 0;
      |SI #dscaz016#8 ! 0; |Y #dscaz016#16 = 0;
         #dscaz016#16 = #dscaz016#8;
      |FINSI;
      |SI #dscaz016#8 = 0; |Y #dscaz016#16 ! 0;
         #dscaz016#8 = #dscaz016#16;
      |FINSI;
   |FINSI;
*/
   Comodin1 = ("000" + #dscam014#0) % -103;
   Comodin1 = "n5800" + Comodin1 + ".seq";
   |DFICB Comodin;
   eaOrigen = Comodin;
   eaNombre1 = Comodin1;
   Comodin = "wb  " + Comodin + Comodin1;
   |QBF Comodin;
   |FABRE Comodin;
   handle = FSalida;
   |SI FSalida ] 0;
      |ABRE #dscam004;
      |ABRE #dscam003;
      |ABRE #dscam012;
      |ABRE #dscam013;
      |HAZ Presentador;  NumRegs = NumRegs + 1;
      |HAZ Ordenante;    NumRegs = NumRegs + 1;
      |BUCLE Remesas;    NumRegs = NumRegs + NumInd;
      |HAZ TotalOrden;   NumRegs = NumRegs + 1;
      |HAZ TotalGeneral; NumRegs = NumRegs + 1;
      #0#9 = NumDomics;
      #0#10 = NumRegs;
      #0#11 = TotalOrd;
      |PINTA #0#9; |PINTA #0#10; |PINTA #0#11;
      |PAUSA;
      |CIERRA #dscam013;
      |CIERRA #dscam012;
      |CIERRA #dscam003;
      |CIERRA #dscam004;
   |FINSI;
   VAlfa = Handle + " " + aFinFic; |FGRABA VAlfa;
   FSalida = handle; |FCIERRA FSalida;

   |SUB_EJECUTA_NP "dscaz032.tab";
|FPRC;

|DEFBUCLE Secuencial;
#dscam014#1;
;
#0#4;
#0#5;
be;
NULL,Secuencial;
|FIN;

|PROGRAMA;
   |HAZ Tipo8;
   |CLS;
   |CABEZA "Emision diskette norma 58";
   |PINPA #0#0;

   |HAZ EsLuxe;
   |SI FSalida = 0;
      nSwLuxe = 1;
      |CUADRO 0920 1461;
      |PINTA 0935, "Ë    DESDE   Ë    HASTA   »";
      |ATRI R; |PINTA 0936, "    DESDE   ";
      |PINTA 0949, "    HASTA   "; |ATRI N;
      |PINTA 0961, "»";
      |PINTA 1335, "º            º            º";
      |PINTA 1435, "ÊÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÍÍÍÍÍ¼";
      |PINTA 1221, " Tipo remesa  ";
      |PINTA 1321, " Banco ...... ";
      |C_P #dscaz016#17, 1, 1237; |C_P #dscaz016#18, 1, 1250;
      |C_P #dscaz016#4, 1, 1337;  |C_P #dscaz016#5, 1, 1350;
      |C_M #dscaz016#17, 1, "S"; |C_V #dscaz016#17, 1, "S";
      |C_M #dscaz016#18, 1, "S"; |C_V #dscaz016#18, 1, "S";
      #dscaz016#4 = 0; #dscaz016#5 = 0;
   |SINO;
      nSwLuxe = 0;
   |FINSI;

   |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;

      aFinLin = ""; aFinFic = "";
      nCalc = 13; aFinLin = aFinLin + &nCalc;
      nCalc = 10; aFinLin = aFinLin + &nCalc;

      |HAZ MiraMoneda;
      |SI Cambio ! -1; |BUCLE Secuencial; |FINSI;
   |FINSI;
   |HAZ Tipo9;
|FPRO;

|PROCESO RetocaFecha;
   |QBF Fecha;
   Comodin = Fecha % 0102;  || Dia
   Comodin = Comodin + (Fecha % 0402);  || Mes
   Comodin = Comodin + (Fecha % 0902);  || A¤o
   Fecha = Comodin;
|FPRC;

|PROCESO Formato;
   |SI Tipo1 = "I";
      Calc = Field;
      Calc = (Calc * Cambio) ! Redond;
      |SI Moneda = "E"; Calc = Calc * 100; |FINSI;
      Field = Calc;
   |FINSI;
   |SI Tipo1 = "A";
      Comodin = " " * NumDig;
      Comodin = Field + Comodin;
      Calc = 100 + NumDig;
   |SINO;
      Comodin = "0" * NumDig;
      Comodin = Comodin + Field; |QBF Comodin;
      Calc = 0 - (100 + NumDig);
   |FINSI;

   |QBF Field;
   Field = Comodin % Calc;

|FPRC;

|PROCESO CampoEnlace; |TIPO 7;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;
   |SI HayConta = 1; |Y #dscam051#1 = "S";
      |ABRE #dscam030;
      #dscam030#0 = #dscam051#53;
      |LEE 000#dscam030.=;
      |SI FSalida = 0;
         |PINTA 2020, #dscam030#1;
      |FINSI;
      |CIERRA #dscam030;
      #dscaz016#14 = #dscam051#53; |PINTA #dscaz016#14;
      aAlfa = #dscam051#61; |QBF aAlfa;
      |C_M #dscaz016#14,1,aAlfa;
   |SINO;
      #dscaz016#14 = ""; |PINTA #dscaz016#14;
      |C_M #dscaz016#14,1,"N";
   |FINSI;
|FPRC;

|PROCESO MiraMoneda;
     |SI HayGestion = 0; |ACABA; |FINSI;

      Moneda = "E";
      ||POPV;
      |SI #agif321@#9 = "ESP";
         |SI Moneda = "P";
            Cambio = 1;
            Redond = 0;
            Prefijo = "0";
         |SINO;
            Cambio = 1/166.386;
            Redond = 2;
            Prefijo = "5";
         |FINSI;
      |FINSI;
      |SI #agif321@#9 = "EUR";
         |SI Moneda = "P";
            Cambio = 166.386;
            Redond = 0;
            Prefijo = "0";
         |SINO;
            Cambio = 1;
            Redond = 2;
            Prefijo = "5";
         |FINSI;
      |FINSI;
|FPRC;

|PROCESO MiraBancoTR;
   |SI nSwLuxe = 0; |ACABA; |FINSI;

   |SI #dscaz016#17 = 6; |Y #dscaz016#18 = 6;
      #dscaz016#4 = 0; |PINTA #dscaz016#4;
      #dscaz016#5 = 0; |PINTA #dscaz016#5;
      |C_M #dscaz016#4, 1, "S"; |C_M #dscaz016#5, 1, "S";
   |SINO;
      #dscaz016#4 = 1;   |PINTA #dscaz016#4;
      #dscaz016#5 = 999; |PINTA #dscaz016#5;
      |C_M #dscaz016#4, 1, "N"; |C_M #dscaz016#5, 1, "N";
   |FINSI;
|FPRC;
