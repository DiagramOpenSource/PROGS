|FICHEROS;
   dscam030 #0;
   dscam031 #1,MANTE;
   dscam032 #2,MANTE;
   dscaw009 #4,MANTE;
   dscaw010 #5,MANTE;

   dscam029 #6;
   dscam027 #7;

   dscam036 #8,MANTE;
   referen@ #10;
   caconce@ #11;

   canempr@ #12;
   dscaw014 #13;
   dscam068 #14;
   calibro@ #15;
   caivase@ #16;

   dscam172 #20,MANTE;
   dscam173 #21,MANTE;
   dscam174 #22,MANTE;
   dscaw132 #23,MANTE;
   dscaw133 #24,MANTE;

   RefDato@ #100;
   refere1@ #101;
|FIN;

|VARIABLES;
   &eaExpre = "";

   &nDeci_nDec = 0;

   &HayConta = 0;
   &Fichero = ""; &Tipo = ""; &Cmp = ""; &CmpNum = 0;
   aAlfa = ""; aAlfa1 = "";
   aCuenta = ""; aDescri = ""; aImport = ""; aDepart = ""; SwDep = 0;

   nTecla = 0; nNumIvas = 0; nLibro = 0; aSerie = ""; nFlag = 0;
   ConcepAntes = 0;
   Cont = 0;
   nCalc = 0;
   nCalc1 = 0;
   ComodNum = 0;
   Comodin = "";
   Comodin1 = "";
   Comodin2 = "";
   Salir = 0;
   NumCampos = 0;
   DefCargado = "";
   Direc = "";

   aCmpClv = "";
   aFichP  = "";
   aFichC  = "";

   ModoEntrada = 0;
   TipoDato = ""; LongDato = 0;

   Linea = 0; LinCmps = 0;
   TipoCampo1 = "";
   TipoCampo2 = "";
   Fich = "";  NumCampo = 0; NomFich = "";

   aLong = ""; nLong = 0; Calc = 0; nPosic = 0;
   Tecla = 0; acota = 0; LinAcot = 0; Parte1 = ""; Parte2 = "";

   MaxDig = 0; Nivel = 0;

   nCampo = 0; nLinCondi = 0; nLinValor = 0;
   aMemoria = ""; aTipoMemo = "";
|FIN;

|PROCESO CuentaIva;
   |SI #dscam032#14 = "S";
      nNumIvas = nNumIvas + 1;
      nLibro = #dscam032#15;
      aSerie = #dscam032#16;
   |FINSI;
|FPRC;

|DEFBUCLE CuentaIva;
#dscam032#1;
;
#dscam031#0, #dscam031#2, 0001;
#dscam031#0, #dscam031#2, 9999;
;
NULL,CuentaIva;
|FIN;

|PROCESO PintaTipo;
   |SI #dscam030#2 = "CB"; #dscam030#3 = "COBROS    "; |FINSI;
   |SI #dscam030#2 = "PG"; #dscam030#3 = "PAGOS     "; |FINSI;
   |SI #dscam030#2 = "RM"; #dscam030#3 = "REMESAS   "; |FINSI;
   |SI #dscam030#2 = "TA"; #dscam030#3 = "TALONES   "; |FINSI;
   |SI #dscam030#2 = "PA"; #dscam030#3 = "PAGARES   "; |FINSI;
   |SI #dscam030#2 = "CF"; #dscam030#3 = "CONFIRMES "; |FINSI;
   |SI #dscam030#2 = "PD"; #dscam030#3 = "PAGOS DOM."; |FINSI;
   |PINTA #dscam030#3;

   |SI #dscam030#2 = "CB"; |O #dscam030#2 = "PG"; |O #dscam030#2 = "CF";
      |C_M #dscam030#8,1,"S";
   |SINO;
      #dscam030#8 = "N"; |PINTA #dscam030#8; |C_M #dscam030#8,1,"N";
   |FINSI;
|FPRC;

|RUTINA inf;
   #dscam031#0 = #dscam030#0;
   #dscam031#2 = 000001;
|FRUT;

|RUTINA sup;
   #dscam031#0 = #dscam030#0;
   #dscam031#2 = 999999;
|FRUT;

|PROCESO EntraLineas;
   |ENTLINEAL #1#dscam031,-2,1,15,1,inf,sup;
   |PUSHV 0501 2380;
   |PINTA 1015, aCmpClv; |PTEC 809; |PTEC 808;
   |ENTLINEAL #1#dscam036,-2,1,22,1,inf4,sup4;
   |POPV;
|FPRC;

|RUTINA inf1;
   #dscam032#0 = #dscam030#0;
   #dscam032#1 = #dscam031#2;
   #dscam032#2 = 0001;
|FRUT;

|RUTINA sup1;
   #dscam032#0 = #dscam030#0;
   #dscam032#1 = #dscam031#2;
   #dscam032#2 = 9999;
|FRUT;

|RUTINA inf2;
   #dscaw009#0 = 001;
   #dscaw009#6 = TipoCampo1;
|FRUT;

|RUTINA sup2;
   #dscaw009#0 = 999;
   #dscaw009#6 = TipoCampo2;
|FRUT;

|RUTINA inf3;
   #dscaw010#3 = #dscam030#0;
   #dscaw010#4 = #dscam031#2;
   #dscaw010#5 = #dscam032#2;
   |SI acota = 0;
      |SI TipoCampo1 = "A";
         #dscaw010#6 = "E";
      |SINO;
         #dscaw010#6 = TipoCampo1;
      |FINSI;
   |SINO;
      #dscaw010#6 = TipoCampo1;
   |FINSI;
   #dscaw010#0 = 1;
|FRUT;

|RUTINA sup3;
   #dscaw010#3 = #dscam030#0;
   #dscaw010#4 = #dscam031#2;
   #dscaw010#5 = #dscam032#2;
   |SI acota = 0;
      |SI TipoCampo2 = "A";
         #dscaw010#6 = "E";
      |SINO;
         #dscaw010#6 = TipoCampo2;
      |FINSI;
   |SINO;
      #dscaw010#6 = TipoCampo2;
   |FINSI;
   #dscaw010#0 = 999;
|FRUT;

|RUTINA inf4;
   #dscam036#0 = 001;
   #dscam036#15 = #dscam030#0;
|FRUT;

|RUTINA sup4;
   #dscam036#0 = 999;
   #dscam036#15 = #dscam030#0;
|FRUT;

|RUTINA InfAcota;
   #dscaw010#3 = #dscam030#0;
   #dscaw010#4 = #dscam031#2;
   #dscaw010#5 = #dscam032#2;
   #dscaw010#6 = "A";
   #dscaw010#0 = 1;
|FRUT;

|RUTINA SupAcota;
   #dscaw010#3 = #dscam030#0;
   #dscaw010#4 = #dscam031#2;
   #dscaw010#5 = #dscam032#2;
   #dscaw010#6 = "A";
   #dscaw010#0 = 999;
|FRUT;

|PROCESO DefineLinea; |TIPO 3;
   nNumIvas = 0; |BUCLE CuentaIva;
   #dscam031#1 = #dscam032#2;
   |ENTLINEAL #1#dscam032,-3,1,22,1,inf1,sup1;
|FPRC;

|PROCESO PresentaLineas; |TIPO 13;
   |ENTLINEAL #1#dscam031,-2,7,15,1,inf,sup;
   |ENTLINEAL #1#dscam032,-3,7,22,1,inf1,sup1;
   |HAZ PintaDatos;
   |SI #dscam030#10 ! 999;
      aCmpClv = &196 * 60;
      |DDEF aAlfa; |QBF aAlfa; aAlfa = aAlfa + #dscam030#9 + ".mas";
      |CARGA_DEF aAlfa, refere1@;
      |SI FSalida = 0;
         aCmpClv = " Campo clave enlace : ["; aAlfa1 = "|TITULO";
         aAlfa1 = #refere1@#aAlfa1#; aCmpClv = aCmpClv + aAlfa1 + "][";
         aAlfa1 = "|C" + (("000" + #dscam030#10) % -103) + "NOMBRE";
         aAlfa1 = #refere1@#aAlfa1#; aCmpClv = aCmpClv + aAlfa1 + "]";
      |FINSI;
   |SINO;
      aCmpClv = &196 * 60;
   |FINSI;

   |PINTA 1015, aCmpClv;
|FPRC;

|PROCESO Borra3;
   |BORRA 020#dscam036.a;
|FPRC;

|DEFBUCLE Borra3;
#dscam036#1;
;
#dscam030#0,001;
#dscam030#0,999;
be;
NULL,Borra3;
|FIN;

|PROCESO BorraLins;
   |BORRA 020#dscaw010.a;
|FPRC;

|DEFBUCLE BorraLins;
#dscaw010#1;
;
#dscam032#0,#dscam032#1,0001," ",001;
#dscam032#0,#dscam032#1,9999,"z",999;
be;
NULL,BorraLins;
|FIN

|PROCESO Borra2;
   |BUCLE BorraLins;
   |BORRA 020#dscam032.a;
|FPRC;

|DEFBUCLE Borra2;
#dscam032#1;
;
#dscam031#0,#dscam031#2,0001;
#dscam031#0,#dscam031#2,9999;
be;
NULL,Borra2;
|FIN;

|PROCESO Borra1;
   |BUCLE Borra2;
   |BORRA 020#dscam031.a;
|FPRC;

|DEFBUCLE Borra1;
#dscam031#1;
;
#dscam030#0,000001;
#dscam030#0,999999;
be;
NULL,Borra1;
|FIN;

|PROCESO BorraLineas; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3;
      |ABRE #dscam031;
      |ABRE #dscam032;
      |BUCLE Borra3;
      |BUCLE Borra2;
      |BUCLE Borra1;
      |CIERRA #dscam032;
      |CIERRA #dscam031;
   |SINO;
      Comodin = #dscam030#6; |QBF Comodin;
      |SI Comodin ! "";
         ||Comodin1 = Comodin + "def/canempre.mas";
         Fichero = "Empresas"; Tipo = "C"; Cmp = ""; |HAZ ObtenFich;
         Comodin1 = Comodin + "def/" + Fichero + ".mas";
         |CARGA_DEF Comodin1 , canempr@;
         |SI FSalida = 0;
            Comodin1 = Comodin + "fich/";
            |PATH_DAT #12 Comodin1;
            |ABRE #canempr@;
            Fichero = "Empresas"; Tipo = "C"; Cmp = "Codigo Empresa"; |HAZ ObtenDato;
            #canempr@#CmpNum# = #dscam030#4;
            Fichero = "Empresas"; Tipo = "C"; Cmp = "Periodo"; |HAZ ObtenDato;
            #canempr@#CmpNum# = #dscam030#5;
            |LEE 000#canempr@.=;
            |SI FSalida = 0;
               Fichero = "Empresas"; Tipo = "C"; Cmp = "Nombre Comercial"; |HAZ ObtenDato;
               |PINTA 0838, #canempr@#CmpNum#;
            |FINSI;
            |CIERRA #canempr@;
            |DESCARGA_DEF #canempr@;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Campos;
   #dscam027#0 = #dscam029#1;
   |LEE 000#dscam027.=

   |DDEFECTO #dscaw009;

   #dscaw009#0 = Linea;  Linea = Linea + 1;
   #dscaw009#1 = #dscam029#1;
   #dscaw009#2 = #dscam027#1;
   #dscaw009#3 = #dscam029#4;
   #dscaw009#4 = #dscam029#2;
   #dscaw009#5 = #dscam029#3;
   #dscaw009#6 = #dscam029#5;
   |GRABA 020#dscaw009.n;
|FPRC;

|DEFBUCLE Ficheros;
#dscam029#1;
4,5;
001,#dscam030#2,TipoCampo1;
999,#dscam030#2,TipoCampo2;
;
NULL,Campos;
|FIN;

|PROCESO Interpreta;
   Comodin1 = #dscaw010#1 % 0102;
   |SI Comodin1 = "[%";
      Comodin1 = #dscaw010#1 % 0105; |QBF Comodin1;
   |SINO;
      Comodin1 = #dscaw010#2 % 0101;
   |FINSI;

   Comodin2 = #dscaw010#2 % 0299; |QBF Comodin2;
   Comodin1 = Comodin1 + Comodin2; |QBF Comodin1;
   |SI Comodin1 = "";
      Comodin1 = #dscaw010#1; |QBF Comodin1;
   |FINSI;
   Comodin = Comodin + Comodin1;
|FPRC;

|DEFBUCLE Interpreta;
#dscaw010#1;
;
#dscam030#0,#dscam031#2,#dscam032#2,TipoCampo1,001;
#dscam030#0,#dscam031#2,#dscam032#2,TipoCampo1,999;
;
NULL,Interpreta;
|FIN;

|PROCESO EditaLineas; |TIPO 13;
   |SI FSalida = 10;
      |SI acota = 0;
         |ENTLINEAL #1#dscaw010,-5,1,22,1,inf3,sup3;
         |ENTLINEAL #1#dscaw010,5,7,22,1,inf3,sup3;
      |SINO;
         |ENTLINEAL #1#dscaw010,-5,1,22,1,InfAcota,SupAcota;
         |ENTLINEAL #1#dscaw010,5,7,22,1,InfAcota,SupAcota;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO LinFichero; |TIPO 0;
   LinCmps = 0;
   |SALVA_FICHA #dscaw010;
   #dscaw010#3 = #dscam030#0;
   #dscaw010#4 = #dscam031#2;
   #dscaw010#5 = #dscam032#2;
   |SI acota = 1;
      #dscaw010#6 = "A";
   |SINO;
      |SI TipoCampo1 = "A";
         #dscaw010#6 = "E";
      |SINO;
         #dscaw010#6 = TipoCampo1;
      |FINSI;
   |FINSI;
   #dscaw010#0 = 1;
   |LEE 000#dscaw010.];
   |SI FSalida ! 0; LinCmps = 10; |FINSI;
   |PARA; |SI FSalida = 0; |HACIENDO;
      |SI acota = 0;
         |SI #dscaw010#3 = #dscam030#0; |Y #dscaw010#4 = #dscam031#2;
         |Y #dscaw010#5 = #dscam032#2;  |Y #dscaw010#6 = TipoCampo1;
            LinCmps = #dscaw010#0 + 10;
            |LEE 000#dscaw010.s;
         |SINO;
            |SI LinCmps = 0; LinCmps = 10; |FINSI;
            |SAL;
         |FINSI;
      |SINO;
         |SI #dscaw010#3 = #dscam030#0; |Y #dscaw010#4 = #dscam031#2;
         |Y #dscaw010#5 = #dscam032#2;  |Y #dscaw010#6 = "A";
            LinCmps = #dscaw010#0 + 10;
            |LEE 000#dscaw010.s;
         |SINO;
            |SI LinCmps = 0; LinCmps = 10; |FINSI;
            |SAL;
         |FINSI;
      |FINSI;
   |SIGUE;
   |REPON_FICHA #dscaw010;

   |DDEFECTO #dscaw010;
   #dscaw010#0 = LinCmps;
   Comodin = "[" + #dscaw009#2; |QBF Comodin;
   Comodin = Comodin + "][" + #dscaw009#5; |QBF Comodin;
   Comodin = Comodin + "]";
   #dscaw010#1 = Comodin;
   Comodin = "[" + #dscaw009#1; |QBF Comodin;
   Comodin1 = ("000" + #dscaw009#4) % -103;
   Comodin = Comodin + "][" + Comodin1 + "]";
   #dscaw010#2 = Comodin;
   #dscaw010#3 = #dscam030#0;
   #dscaw010#4 = #dscam031#2;
   #dscaw010#5 = #dscam032#2;
   |SI acota = 0;
      |SI TipoCampo1 = "A";
         #dscaw010#6 = "E";
      |SINO;
         #dscaw010#6 = TipoCampo1;
      |FINSI;
   |SINO;
      #dscaw010#6 = "A";
   |FINSI;

   |GRABA 020#dscaw010.n;
   |SI acota = 0;
      |ENTLINEAL #1#dscaw010,-5,7,22,1,inf3,sup3;
   |SINO;
      |ENTLINEAL #1#dscaw010,-5,7,22,1,InfAcota,SupAcota;
   |FINSI;
|FPRC;

|PROCESO Selec;

   |SI FSalida ! 10; |Y FSalida ! 11; |ACABA; |FINSI;

   |SI FSalida = 11;
      |SI Campo ! 12;
         nCampo = Campo;
         |HAZ Memorias; |QBF aMemoria;
         |SI aMemoria ! ""; #dscam032#nCampo# = aMemoria; |PINTA #dscam032#nCampo#; |FINSI;
      |FINSI;
      |ACABA;
   |FINSI;

   |DELINDEX #dscaw009;

   |ABRE #dscam027;
   |ABRE #dscam029;
   |ABRE #dscaw009;
   |ABRE #dscaw010;

   SwDep = 0;
   |SI Campo = 3;  TipoCampo1 = "C"; TipoCampo2 = "C"; |FINSI;
   |SI Campo = 6;  TipoCampo1 = "D"; TipoCampo2 = "D"; |FINSI;
   |SI Campo = 8;  TipoCampo1 = "I"; TipoCampo2 = "I"; |FINSI;
   |SI Campo = 12; TipoCampo1 = "A"; TipoCampo2 = "A"; SwDep = 1; |FINSI;
   Linea = 1;
   |BUCLE Ficheros;

   |PUSHV 0501 2380;
   |PINPA #0#0;
   |PINPA #0#1;
   Salir = 0;
   |ENTLINEAL #1#dscaw010,-5,7,22,1,inf3,sup3;
   |ENTLINEAL #2#dscaw009,-1,4,13,1,inf2,sup2;

   |POPV;
   ||PINDA #0#dscam032;

   |CIERRA #dscaw010;
   |CIERRA #dscaw009;
   |CIERRA #dscam029;
   |CIERRA #dscam027;

   Comodin = "";
   |SI SwDep = 1; SwDep = 0; TipoCampo1 = "E"; TipoCampo2 = "E"; |FINSI;
   |BUCLE Interpreta;
   |SI TipoCampo1 = "C"; #dscam032#3 = Comodin; |PINTA #dscam032#3; |FINSI;
   |SI TipoCampo1 = "D"; #dscam032#6 = Comodin; |PINTA #dscam032#6; |FINSI;
   |SI TipoCampo1 = "I"; #dscam032#8 = Comodin; |PINTA #dscam032#8; |FINSI;
   |SI TipoCampo1 = "E"; #dscam032#12 = Comodin; |PINTA #dscam032#12; |FINSI;

   |SI Comodin = ""; |ERROR; |FINSI;
   |PTEC 808; |PTEC 809;

|FPRC;

|PROCESO Acotacion;
   Comodin = #dscaw010#2; |QBF Comodin;
   |SI Comodin ! "";
      Comodin1 = #dscaw010#2; |QBF Comodin1;
      Comodin1 = Comodin1 - "][";
      |SI FSalida ! 0;
         nPosic = FSalida;
         #dscam036#15 = #dscam030#0;
         #dscam036#0  = 1;
         |LEE 000#dscam036.=;
         |SI FSalida ! 0;
            LinAcot = 1;
         |SINO;
            |PARA; |SI FSalida = 0; |Y #dscam036#15 = #dscam030#0; |HACIENDO;
               LinAcot = #dscam036#0 + 1;
               |LEE 000#dscam036.s;
            |SIGUE;
         |FINSI;

         |DDEFECTO #dscam036;
         #dscam036#15 = #dscam030#0;
         #dscam036#16 = #dscaw010#0;
         #dscam036#0 = LinAcot;
         Calc = ((nPosic / 100) ! 0) + 99;
         Comodin2 = Comodin1 % Calc; Comodin2 = Comodin2 - "[";
         #dscam036#13 = Comodin2; Comodin1 = Comodin1 - Comodin2;
         Comodin2 = Comodin1 - "[";
         Comodin2 = Comodin2 - "]";
         #dscam036#14 = Comodin2;

         |DBASE Direc; |QBF Direc;
         Direc = Direc + "def/" + #dscam036#13; |QBF Direc;
         Direc = Direc + ".mas"; |QBF Direc;
         |CARGA_DEF Direc, referen@;
         |SI FSalida = 0;
            |ABRE #referen@;
            Comodin1 = "|TITULO";
            #dscam036#1 = #referen@#Comodin1#;
            Comodin1 = #dscam036#14; |QBF Comodin1;
            Comodin1 = ("000" + Comodin1) % -103;
            Comodin2 = "|C" + Comodin1 + "TIPO";
            #dscam036#11 = #referen@#Comodin2#;
            Comodin2 = "|C" + Comodin1 + "LONGITUD";
            #dscam036#12 = #referen@#Comodin2#;
            Calc = #referen@#Comodin2#;
            Comodin2 = "|C" + Comodin1 + "NOMBRE";
            #dscam036#2 = #referen@#Comodin2#;
            Comodin2 = "|C" + Comodin1 + "MINIMO";
            |SI #dscam036#11 = "A"; #dscam036#3 = " " * Calc; |FINSI;
            |SI #dscam036#11 = "N"; #dscam036#5 = #referen@#Comodin2#; |FINSI;
            |SI #dscam036#11 = "F"; #dscam036#7 = #referen@#Comodin2#; |FINSI;
            Comodin2 = "|C" + Comodin1 + "MAXIMO";
            |SI #dscam036#11 = "A"; #dscam036#4 = "z" * Calc; |FINSI;
            |SI #dscam036#11 = "N"; #dscam036#6 = #referen@#Comodin2#; |FINSI;
            |SI #dscam036#11 = "F"; #dscam036#8 = #referen@#Comodin2#; |FINSI;

            |SI #dscam036#11 = "A";
               Comodin = " " * #dscam036#12;
               Comodin1 = #dscam036#3; |QBF Comodin1;
               Comodin2 = #dscam036#4; |QBF Comodin2;
            |FINSI;

            |SI #dscam036#11 = "N";
               Comodin = "";
               Comodin1 = #dscam036#5; |QBF Comodin1;
               Comodin2 = #dscam036#6; |QBF Comodin2;
            |FINSI;

            ||TODO CCC
            |SI #dscam036#11 = "F";
               Comodin = "";
               Comodin1 = #dscam036#7; |QBF Comodin1;
               Comodin2 = #dscam036#8; |QBF Comodin2;
            |FINSI;

            Calc = 0 - (#dscam036#12 + 100);
            Comodin1 = (Comodin + Comodin1) % Calc;
            Comodin2 = (Comodin + Comodin2) % Calc;
            #dscam036#9  = Comodin1;
            #dscam036#10 = Comodin2;

            |GRABA 020#dscam036.n;
            |CIERRA #referen@;
            |DESCARGA_DEF #referen@;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Acotacion;
#dscaw010#1;
;
#dscam030#0,#dscam031#2,#dscam032#2,"A",001;
#dscam030#0,#dscam031#2,#dscam032#2,"A",999;
;
NULL,Acotacion;
|FIN;

|PROCESO BorraAcot;
   |BORRA 020#dscam036.a;
|FPRC;

|DEFBUCLE BorraAcot;
#dscam036#1;
;
#dscam030#0,001;
#dscam030#0,999;
;
NULL,BorraAcot;
|FIN;

|PROCESO EscogeFich;

      ModoEntrada = (FEntrada / 100) ! 0;
      |SI ModoEntrada = 1;

         |DELINDEX #dscaw009;

         |ABRE #dscam027;
         |ABRE #dscam029;
         |ABRE #dscaw009;
         |ABRE #dscaw010;

         |BUCLE BorraAcot;
         Linea = 1;
         TipoCampo1 = " "; TipoCampo2 = "z";
         |BUCLE Ficheros;
         acota = 1; TipoCampo1 = "A"; TipoCampo2 = "A";
         #dscam031#2 = 1; #dscam032#2 = 1;

         |PUSHV 0501 2380;
         |PINPA #0#0;
         |PINPA #0#1;
         |ENTLINEAL #1#dscaw010,-5,7,22,1,InfAcota,SupAcota;
         |ENTLINEAL #2#dscaw009,-1,4,13,1,inf2,sup2;

         acota = 0;
         |PINDA #0#dscam036;
         |POPV;

         |CIERRA #dscaw010;
         |CIERRA #dscaw009;
         |CIERRA #dscam027;

         |BUCLE Acotacion;

      |SINO;
         TipoDato = #dscam036#11; LongDato = #dscam036#12;
         |SI TipoDato = "A";
            |CAMPO_ANCHO #dscam036#3,1,LongDato;
            |CAMPO_MAXIMO #dscam036#3,1,"#";
            |CAMPO_ANCHO #dscam036#4,1,LongDato;
            |CAMPO_MAXIMO #dscam036#4,1,"#";
            |C_M #dscam036#3,1,"S"; |C_V #dscam036#3,1,"S"; |PINTA #dscam036#3;
            |C_M #dscam036#4,1,"S"; |C_V #dscam036#4,1,"S"; |PINTA #dscam036#4;
            |C_M #dscam036#5,1,"N"; |C_V #dscam036#5,1,"N";
            |C_M #dscam036#6,1,"N"; |C_V #dscam036#6,1,"N";
            |C_M #dscam036#7,1,"N"; |C_V #dscam036#7,1,"N";
            |C_M #dscam036#8,1,"N"; |C_V #dscam036#8,1,"N";
         |FINSI;
         |SI TipoDato = "N";
            |CAMPO_MAXIMO #dscam036#3,0,aAlfa;
            |C_M #dscam036#3,1,"N"; |C_V #dscam036#3,1,"N";
            |C_M #dscam036#4,1,"N"; |C_V #dscam036#4,1,"N";
            |C_M #dscam036#5,1,"S"; |C_V #dscam036#5,1,"S"; |PINTA #dscam036#5;
            |C_M #dscam036#6,1,"S"; |C_V #dscam036#6,1,"S"; |PINTA #dscam036#6;
            |C_M #dscam036#7,1,"N"; |C_V #dscam036#7,1,"N";
            |C_M #dscam036#8,1,"N"; |C_V #dscam036#8,1,"N";
         |FINSI;
         |SI TipoDato = "F";
            |C_M #dscam036#3,1,"N"; |C_V #dscam036#3,1,"N";
            |C_M #dscam036#4,1,"N"; |C_V #dscam036#4,1,"N";
            |C_M #dscam036#5,1,"N"; |C_V #dscam036#5,1,"N";
            |C_M #dscam036#6,1,"N"; |C_V #dscam036#6,1,"N";
            |C_M #dscam036#7,1,"S"; |C_V #dscam036#7,1,"S"; |PINTA #dscam036#7;
            |C_M #dscam036#8,1,"S"; |C_V #dscam036#8,1,"S"; |PINTA #dscam036#8;
         |FINSI;
      |FINSI;
|FPRC;

|PROCESO TomaValor;
   ||PINDA #0#dscam036;
   |SI TipoDato = "A"; #dscam036#9 = #dscam036#3; #dscam036#10 = #dscam036#4; |FINSI;
   |SI TipoDato = "N"; #dscam036#9 = #dscam036#5; #dscam036#10 = #dscam036#6; |FINSI;
   |SI TipoDato = "F"; #dscam036#9 = "   " + #dscam036#7; #dscam036#10 = "   "+ #dscam036#8; |FINSI;

   |SI Campo = 4; |O Campo = 6; |O Campo = 8;
      |C_M #dscam036#3,1,"N"; |C_V #dscam036#3,1,"N";
      |C_M #dscam036#4,1,"N"; |C_V #dscam036#4,1,"N";
      |C_M #dscam036#5,1,"N"; |C_V #dscam036#5,1,"N";
      |C_M #dscam036#6,1,"N"; |C_V #dscam036#6,1,"N";
      |C_M #dscam036#7,1,"N"; |C_V #dscam036#7,1,"N";
      |C_M #dscam036#8,1,"N"; |C_V #dscam036#8,1,"N";
                              |C_V #dscam036#9,1,"S";
                              |C_V #dscam036#10,1,"S";
   |FINSI;
|FPRC;

|PROCESO MiraPath;

   |SI FSalida = 10; #dscam030#6 = #48#16; |PINTA #dscam030#6; |FINSI;

   Comodin = #dscam030#6; |QBF Comodin;
   aLong = Comodin % 0; nLong = aLong;
   Calc = (nLong * 100) + 1;
   Comodin1 = Comodin % Calc;
   |SI Comodin1 ! "/";
      Comodin = Comodin + "/";
      #dscam030#6 = Comodin; |PINTA #dscam030#6;
   |FINSI;
|FPRC;

|PROCESO MiraEmpresas;
   Tecla = FSalida;
   |SI Tecla = 2; |ACABA; |FINSI;
   ||Comodin1 = Comodin + "def/canempre.mas";
   Fichero = "Empresas"; Tipo = "C"; Cmp = ""; |HAZ ObtenFich;
   Comodin1 = Comodin + "def/" + Fichero + ".mas";
   |CARGA_DEF Comodin1 , canempr@;
   |SI FSalida = 0;
      Comodin1 = Comodin + "fich/";
      |PATH_DAT #12 Comodin1;
      |ABRE #canempr@;
      |SI Tecla = 10;
         |CONSULTA_CLAVE #1#canempr@;
         |SI FSalida ] 0;
            Fichero = "Empresas"; Tipo = "C"; Cmp = "Codigo Empresa"; |HAZ ObtenDato;
            #dscam030#4 = #canempr@#CmpNum#; |PINTA #dscam030#4;
            Fichero = "Empresas"; Tipo = "C"; Cmp = "Periodo"; |HAZ ObtenDato;
            #dscam030#5 = #canempr@#CmpNum#; |PINTA #dscam030#5;
         |FINSI;
      |SINO;
         Fichero = "Empresas"; Tipo = "C"; Cmp = "Codigo Empresa"; |HAZ ObtenDato;
         #canempr@#CmpNum# = #dscam030#4;
         Fichero = "Empresas"; Tipo = "C"; Cmp = "Periodo"; |HAZ ObtenDato;
         #canempr@#CmpNum# = #dscam030#5;
         |LEE 000#canempr@.=;
         |SI FSalida ! 0;
            |MENAV "    No existe empresa";
            |ERROR;
         |FINSI;
      |FINSI;
      MaxDig = 0;
      Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 1"; |HAZ ObtenDato;
      |SI MaxDig < #canempr@#CmpNum#; MaxDig = #canempr@#CmpNum#; Nivel = 1; |FINSI;
      Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 2"; |HAZ ObtenDato;
      |SI MaxDig < #canempr@#CmpNum#; MaxDig = #canempr@#CmpNum#; Nivel = 2; |FINSI;
      Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 3"; |HAZ ObtenDato;
      |SI MaxDig < #canempr@#CmpNum#; MaxDig = #canempr@#CmpNum#; Nivel = 3; |FINSI;
      Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 4"; |HAZ ObtenDato;
      |SI MaxDig < #canempr@#CmpNum#; MaxDig = #canempr@#CmpNum#; Nivel = 4; |FINSI;
      Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 5"; |HAZ ObtenDato;
      |SI MaxDig < #canempr@#CmpNum#; MaxDig = #canempr@#CmpNum#; Nivel = 5; |FINSI;
      Fichero = "Empresas"; Tipo = "C"; Cmp = "Digitos Nivel 6"; |HAZ ObtenDato;
      |SI MaxDig < #canempr@#CmpNum#; MaxDig = #canempr@#CmpNum#; Nivel = 6; |FINSI;
      Fichero = "Empresas"; Tipo = "C"; Cmp = "Nombre Comercial"; |HAZ ObtenDato;
      |PINTA 0838, #canempr@#CmpNum#;
      |CIERRA #canempr@;
      |DESCARGA_DEF #canempr@;
   |SINO;
      |MENAV "    No puedo abrir el fichero de empresas";
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO Comprueba;
   |SI FSalida = 0;
      |HAZ EntraLineas;
   |FINSI;
|FPRC;

|PROCESO Mayus; |TIPO 0;
    #Fichero@#Campo# = #Fichero@#Campo# > #Fichero@#Campo#;
    |PINTA #Fichero@#Campo#;
|FPRC;

|PROCESO BajaL;
   |BUCLE BorraLins;
   |BORRA 020#dscam032.a;
|FPRC;

|DEFBUCLE BajaL;
#dscam032#1;
;
#dscam031#0,#dscam031#2,0001;
#dscam031#0,#dscam031#2,9999;
be;
NULL,BajaL;
|FIN;

|PROCESO BajaLin; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3; |BUCLE BajaL; |FINSI;
|FPRC;

|PROCESO BorraExclus;
   |BORRA 020#dscam068.a;
|FPRC;

|DEFBUCLE BorraExclus;
#dscam068#1;
;
#dscam036#15,#dscam036#0,001;
#dscam036#15,#dscam036#0,999;
;
NULL,BorraExclus;
|FIN;

|PROCESO BajaAcota; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3;
      |ABRE #dscaw010; |ABRE #dscam068;
      #dscaw010#3 = #dscam036#15;
      #dscaw010#4 = 1;
      #dscaw010#5 = 1;
      #dscaw010#6 = "A";
      #dscaw010#0 = #dscam036#16;
      |LEE 101#dscaw010.=;
      |SI FSalida = 0;
         |BORRA 020#dscaw010.a; |LIBERA #dscaw010;
      |FINSI;
      |CIERRA #dscaw010;
      |BUCLE BorraExclus;
      |CIERRA #dscam068;
   |FINSI;
|FPRC;

|PROCESO MontaCuenta;
   Comodin = #dscam032#3; |QBF Comodin;
   Comodin = Comodin - ".";
   |SI FSalida ! 0;
      aLong = Comodin % 0; nLong = aLong;
      Calc = ((FSalida / 100) ! 0) + 99;
      Parte1 = Comodin % Calc;
      Parte2 = Comodin - Parte1;
      Calc = MaxDig - nLong;
      Comodin = "0" * Calc;
      #dscam032#3 = Parte1 + Comodin + Parte2;
      |PINTA #dscam032#3;
   |FINSI;
|FPRC;

|PROCESO dscam068;
   |SALVA_FICHA #dscam068;
   #dscam068#0 = #dscaw014#0;
   |GRABA 020#dscam068.n;
   |REPON_FICHA #dscam068;
|FPRC;

|DEFBUCLE dscam068;
#dscam068#1;
;
#dscam068#0,001,001;
#dscam068#0,999,999;
be;
NULL,dscam068;
|FIN;

|PROCESO dscaw010;
   |SALVA_FICHA #dscaw010;
   #dscaw010#3 = #dscaw014#0;
   |GRABA 020#dscaw010.n;
   |REPON_FICHA #dscaw010;
|FPRC;

|DEFBUCLE dscaw010;
#dscaw010#1;
;
#dscam030#0,000001,0001," ",001;
#dscam030#0,999999,9999,"z",999;
be;
NULL,dscaw010;
|FIN;

|PROCESO dscam036;
   |SALVA_FICHA #dscam036;
   #dscam036#15 = #dscaw014#0;
   |GRABA 020#dscam036.n;
   |REPON_FICHA #dscam036;
|FPRC;

|DEFBUCLE dscam036;
#dscam036#1;
;
#dscam030#0,001;
#dscam030#0,999;
be;
NULL,dscam036;
|FIN;

|PROCESO dscam032;
   |SALVA_FICHA #dscam032;
   #dscam032#0 = #dscaw014#0;
   |GRABA 020#dscam032.n;
   |REPON_FICHA #dscam032;
|FPRC;

|DEFBUCLE dscam032;
#dscam032#1;
;
#dscam030#0,#dscam031#2,0001;
#dscam030#0,#dscam031#2,9999;
be;
NULL,dscam032;
|FIN;

|PROCESO dscam031;
   |SALVA_FICHA #dscam031;
   #dscam031#0 = #dscaw014#0;
   |GRABA 020#dscam031.n;
   |REPON_FICHA #dscam031;
   |BUCLE dscam032;
|FPRC;

|DEFBUCLE dscam031;
#dscam031#1;
;
#dscam030#0,000001;
#dscam030#0,999999;
be;
NULL,dscam031;
|FIN;

|PROCESO Copia;
   |SALVA_FICHA #dscam030;
   #dscam030#0 = #dscaw014#0;
   #dscam030#1 = #dscaw014#1;
   |GRABA 020#dscam030.n;
   |REPON_FICHA #dscam030;
   |BUCLE dscam031;
   |BUCLE dscam036;
   |BUCLE dscaw010;
   |BUCLE dscam068;
|FPRC;

|PROCESO MiraCopia;
   |SI FSalida = 10;
      |PUSHV 1032 1360;
      |PINPA #0#dscaw014;
      |PINDA #0#dscaw014;
      |ENDATOS #1#dscaw014;
      |SI FSalida = 0;
         |HAZ Copia;
         #dscam030#0 = #dscaw014#0;
         |LEE 000#dscam030.=;
         |SI FSalida = 0;
            |PINPA #0#0;
            |PINDA #0#0;
         |FINSI;
      |FINSI;
      |POPV;
   |FINSI;
|FPRC;

|PROCESO PintaApu; |TIPO 13;
   |ENTLINEAL #1#dscam032,-3,7,22,1,inf1,sup1;
   |HAZ PintaDatos;
|FPRC;

|PROCESO AntesConcepto; |TIPO 7;
   ConcepAntes = #dscam032#5;
   |SI HayConta = 1;
      |MENSA "    <F2> Consulta de conceptos automaticos";
   |FINSI;
|FPRC;

|PROCESO BorraTempo;
   |BORRA 020#dscaw010.a;
|FPRC;

|DEFBUCLE BorraTempo;
#dscaw010#1;
;
#dscam032#0,#dscam032#1,#dscam032#2,"D",001;
#dscam032#0,#dscam032#1,#dscam032#2,"D",999;
;
NULL,BorraTempo;
|FIN;

|PROCESO TraeteConcepto;
   Tecla = FSalida;
   |SI HayConta = 1;
      |SI ConcepAntes ! #dscam032#5; |O Tecla = 10;
         |ABRE #dscaw010;
         |BUCLE BorraTempo;
         Comodin = #dscam030#6; |QBF Comodin;
         Comodin1 = Comodin - "contagen/";
         |SI FSalida ! 0;
            Comodin = Comodin1 + "modelos/";
            Comodin1 = Comodin + "def/dsmom030.mas";
            Comodin2 = Comodin + "fich/";
         |SINO;
            ||Comodin1 = Comodin + "def/caconcep.mas";
            Fichero = "Conceptos Automaticos"; Tipo = "C"; Cmp = ""; |HAZ ObtenFich;
            Comodin1 = Comodin + "def/" + Fichero + ".mas";
            Comodin2 = Comodin + "fich/" + (("00000" + #dscam030#4) % -105) + #dscam030#5 + "/";
         |FINSI;
         |CARGA_DEF Comodin1, caconce@;
         |SI FSalida = 0;
            |PATH_DAT #11 Comodin2;
            |ABRE #caconce@;
            |SI ConcepAntes ! #dscam032#5;
               Fichero = "Conceptos Automaticos"; Tipo = "C"; Cmp = "Codigo Concepto"; |HAZ ObtenDato;
               #caconce@#CmpNum# = #dscam032#5;
               |LEE 000#caconce@.=;
               |SI FSalida = 0;
                  Fichero = "Conceptos Automaticos"; Tipo = "C"; Cmp = "Descripcion"; |HAZ ObtenDato;
                  #dscam032#6 = #caconce@#CmpNum#; |PINTA #dscam032#6;
               |FINSI;
               ConcepAntes = #dscam032#5;
            |FINSI;
            |SI Tecla = 10;
               |CONSULTA_CLAVE #1#caconce@;
               Fichero = "Conceptos Automaticos"; Tipo = "C"; Cmp = "Codigo Concepto"; |HAZ ObtenDato;
               #dscam032#5 = #caconce@#CmpNum#;
               Fichero = "Conceptos Automaticos"; Tipo = "C"; Cmp = "Descripcion"; |HAZ ObtenDato;
               #dscam032#6 = #caconce@#CmpNum#; |PINTA #dscam032#6;
               |ERROR;
            |FINSI;
            |CIERRA #caconce@; |DESCARGA_DEF #caconce@;
         |FINSI;
         |DDEFECTO #dscaw010;
         #dscaw010#0 = 10;
         #dscaw010#1 = #dscam032#6;
         #dscaw010#2 = #dscam032#6;
         #dscaw010#3 = #dscam032#0;
         #dscaw010#4 = #dscam032#1;
         #dscaw010#5 = #dscam032#2;
         #dscaw010#6 = "D";
         |GRABA 020#dscaw010.n;
         |CIERRA #dscaw010;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO RecCampos;
   #dscam030#0 = #dscam036#15;
   |LEE 000#dscam030.=;
   |SI FSalida = 0;
      |DBASE Comodin; |QBF Comodin;
      Comodin = Comodin + "def/" + #dscam036#13 + ".mas";
      |CARGA_DEF Comodin, referen@;
      |SI FSalida = 0;
         Comodin  = ("000" + #dscam036#14) % -103;
         Comodin1 = "|C" + Comodin + "LONGITUD";
         Comodin1 = #referen@#Comodin1#;
         |SI Comodin1 ! #dscam036#12;
            #dscam036#12 = Comodin1; |GRABA 020#dscam036.a;
         |FINSI;
         |DESCARGA_DEF #referen@;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE RecCampos;
#dscam036#1;
;
INICIO;
FINAL;
be;
NULL,RecCampos;
|FIN;

|PROCESO RecalcCampos; |TIPO 8;
   |ABRE #dscam030; |ABRE #dscam036;
   |BUCLE RecCampos;
   |CIERRA #dscam036; |CIERRA #dscam030;

   |HAZ Tipo8;
|FPRC;

|RUTINA inf723;
   #dscam068#0 = #dscam036#15;
   #dscam068#1 = #dscam036#0;
   #dscam068#2 = 1;
|FRUT;

|RUTINA sup723;
   #dscam068#0 = #dscam036#15;
   #dscam068#1 = #dscam036#0;
   #dscam068#2 = 999;
|FRUT;

|PROCESO Exclus; |TIPO 3;
   |HAZ TomaValor;
   |PUSHV 0959 1979;
   |SI #dscam036#11 = "A";
      |C_V #dscam068#3,1,"S"; |C_M #dscam068#3,1,"S";
   |SINO;
      |C_V #dscam068#3,1,"N"; |C_M #dscam068#3,1,"N";
   |FINSI;
   |SI #dscam036#11 = "N";
      |C_V #dscam068#4,1,"S"; |C_M #dscam068#4,1,"S";
   |SINO;
      |C_V #dscam068#4,1,"N"; |C_M #dscam068#4,1,"N";
   |FINSI;
   |SI #dscam036#11 = "F";
      |C_V #dscam068#5,1,"S"; |C_M #dscam068#5,1,"S";
   |SINO;
      |C_V #dscam068#5,1,"N"; |C_M #dscam068#5,1,"N";
   |FINSI;
   |C_V #dscam068#6,1,"N";
   |ENTLINEAL #1#dscam068,-3,1,18,1,inf723,sup723;
   |C_V #dscam068#3,1,"N"; |C_M #dscam068#3,1,"N";
   |C_V #dscam068#4,1,"N"; |C_M #dscam068#4,1,"N";
   |C_V #dscam068#5,1,"N"; |C_M #dscam068#5,1,"N";
   |C_V #dscam068#6,1,"S";
   |POPV;
|FPRC;

|PROCESO CogeDatos;
   Comodin = #dscaw010#1; |QBF Comodin;
   |SI #dscaw010#6 = "C"; aCuenta = aCuenta + Comodin; |FINSI;
   |SI #dscaw010#6 = "D"; aDescri = aDescri + Comodin; |FINSI;
   |SI #dscaw010#6 = "I"; aImport = aImport + Comodin; |FINSI;
   |SI #dscaw010#6 = "E"; aDepart = aDepart + Comodin; |FINSI;
|FPRC;

|DEFBUCLE CogeDatos;
#dscaw010#1;
;
#dscam032#0, #dscam032#1, #dscam032#2, " ", 001;
#dscam032#0, #dscam032#1, #dscam032#2, "z", 999;
;
NULL,CogeDatos;
|FIN;

|PROCESO PintaDatos; |TIPO 13;
   aCuenta = ""; aDescri = ""; aImport = ""; aDepart = "";
   |BUCLE CogeDatos;
   |BLANCO 1133 1676;
   |ATRI R; |PINTA 1033, " Cuenta .... "; |ATRI N;
   aCuenta = aCuenta % 0144; |PINTA 1133, aCuenta;
   |ATRI R; |PINTA 1233, " Descripcion "; |ATRI N;
   aDescri = aDescri % 0144; |PINTA 1333, aDescri;
   |ATRI R; |PINTA 1433, " Importe ... "; |ATRI N;
   aImport = aImport % 0144; |PINTA 1533, aImport;
   |ATRI R; |PINTA 1633, " Dp "; |ATRI N;
   aDepart = aDepart % 0140; |PINTA 1637, aDepart;
|FPRC;

|PROCESO MiraDep; |TIPO 7;
   |CAMPO_ANCHO #dscam032#12,1,2;
   |CAMPO_MAXIMO #dscam032#12,1,"#";
|FPRC;

|PROCESO MiraAgrup;
   |SI #dscam030#2 = "RM"; |O #dscam030#2 = "CB";
      |SI #dscam032#7 = "S";
         |C_M #dscam032#13,1,"S";
      |SINO;
         #dscam032#13 = "N"; |PINTA #dscam032#13;
         |C_M #dscam032#13,1,"N";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO MiraIva;
   aAlfa = "N";
   |SI #dscam032#14 = "S";
      ||SI nNumIvas > 0; #dscam032#15 = nLibro; #dscam032#16 = aSerie; |FINSI;
      |SI Campo ! 8;
         |SI FSalida ! 2;
            |PUSHV 1030 1678;
            |CUADRO 1031 1677;
            |BLANCO 1132 1576;
            |ATRI R; |PINTA 1132,   " REGISTRO DE IVA                              "; |ATRI N;
            |PINTA 1235, " Libro ";
            |PINTA 1335, " Serie ";
            |PINTA 1435, " Tipo acumulador     Nro.acumulador ";
            |PINTA 1535, " Fecha factura  ";
            aAlfa = #dscam032#14; |QBF aAlfa;
         |FINSI;
      |FINSI;
      |SI Campo = 8;
         |SI FSalida = 2;
            |PUSHV 1031 1677;
            |CUADRO 1031 1677;
            |BLANCO 1132 1576;
            |ATRI R; |PINTA 1132,   " REGISTRO DE IVA                              "; |ATRI N;
            |PINTA 1235, " Libro ";
            |PINTA 1335, " Serie ";
            |PINTA 1435, " Tipo acumulador     Nro.acumulador ";
            |PINTA 1535, " Fecha factura  ";
            aAlfa = #dscam032#14; |QBF aAlfa;
         |FINSI;
      |FINSI;
   |FINSI;
/*
   |SI nNumIvas > 0;
      |C_M #dscam032#15,1,"N"; |C_M #dscam032#16,1,"N";
   |SINO;
      |C_M #dscam032#15,1,aAlfa; |C_M #dscam032#16,1,aAlfa;
   |FINSI;
*/
   |C_M #dscam032#15,1,aAlfa; |C_M #dscam032#16,1,aAlfa;
   |C_V #dscam032#15,1,aAlfa; |C_V #dscam032#16,1,aAlfa;
   |C_M #dscam032#17,1,aAlfa; |C_V #dscam032#17,1,aAlfa;
   |C_M #dscam032#18,1,aAlfa; |C_V #dscam032#18,1,aAlfa;
   |C_M #dscam032#19,1,aAlfa; |C_V #dscam032#19,1,aAlfa;
   |SI aAlfa = "S";
      |PINTA #dscam032#15; |PINTA #dscam032#16; |PINTA #dscam032#17;
      |PINTA #dscam032#18; |PINTA #dscam032#19;
   |FINSI;
/*
   |SI #dscam032#14 = "S";
      |SI nLibro ! 0; |HAZ MiraLibro; |HAZ MiraSerie; |FINSI;
   |FINSI;
*/
|FPRC;

|PROCESO BorraIva;
   |SI #dscam032#14 = "S";
      |SI Campo = 15;
         |SI FSalida = 2;
            |C_M #dscam032#15,1,"N"; |C_V #dscam032#15,1,"N";
            |C_M #dscam032#16,1,"N"; |C_V #dscam032#16,1,"N";
            |C_M #dscam032#17,1,"N"; |C_V #dscam032#17,1,"N";
            |C_M #dscam032#18,1,"N"; |C_V #dscam032#18,1,"N";
            |C_M #dscam032#19,1,"N"; |C_V #dscam032#19,1,"N";
            |POPV;
         |FINSI;
      |FINSI;
      |SI Campo = 19;
         |SI FSalida ! 2;
            |C_M #dscam032#15,1,"N"; |C_V #dscam032#15,1,"N";
            |C_M #dscam032#16,1,"N"; |C_V #dscam032#16,1,"N";
            |C_M #dscam032#17,1,"N"; |C_V #dscam032#17,1,"N";
            |C_M #dscam032#18,1,"N"; |C_V #dscam032#18,1,"N";
            |C_M #dscam032#19,1,"N"; |C_V #dscam032#19,1,"N";
            |POPV;
         |FINSI;
      |FINSI;
      |SI Campo ! 15; |Y Campo ! 19;
         |C_M #dscam032#15,1,"N"; |C_V #dscam032#15,1,"N";
         |C_M #dscam032#16,1,"N"; |C_V #dscam032#16,1,"N";
         |C_M #dscam032#17,1,"N"; |C_V #dscam032#17,1,"N";
         |C_M #dscam032#18,1,"N"; |C_V #dscam032#18,1,"N";
         |C_M #dscam032#19,1,"N"; |C_V #dscam032#19,1,"N";
         |POPV;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO MiraLibro;
   |SI #dscam032#14 = "N"; |ACABA; |FINSI;
   nTecla = FSalida;
   aAlfa = #dscam030#6; |QBF aAlfa; aAlfa = aAlfa + "def/calibros.mas";
   |CARGA_DEF aAlfa, calibro@;
   |SI FSalida = 0;
      aAlfa1 = #dscam030#4; |QBF aAlfa1; aAlfa1 = (("00000" + aAlfa1) % -105) + #dscam030#5;
      aAlfa = #dscam030#6; |QBF aAlfa; aAlfa = aAlfa + "fich/" + aAlfa1 + "/";
      |PATH_DAT #15 aAlfa;

      |ABRE #calibro@;
      |SI nTecla = 10;
         #calibro@#0 = #dscam032#15; |LEE 000#calibro@.];
         |CONSULTA_CLAVE #1#calibro@;
      |FINSI;

      #calibro@#0 = #dscam032#15;
      |LEE 000#calibro@.=;
      |SI FSalida = 0;
         |PINTA 1245, #calibro@#1;
      |SINO;
         |MENAV "    Libro inexistente"; |ERROR;
      |FINSI;

      |CIERRA #calibro@; |DESCARGA_DEF #calibro@;
   |FINSI;
|FPRC;

|PROCESO MiraSerie;
   |SI #dscam032#14 = "N"; |ACABA; |FINSI;
   nTecla = FSalida;
   aAlfa = #dscam030#6; |QBF aAlfa; aAlfa = aAlfa + "def/caivases.mas";
   |CARGA_DEF aAlfa, caivase@;
   |SI FSalida = 0;
      aAlfa1 = #dscam030#4; |QBF aAlfa1; aAlfa1 = (("00000" + aAlfa1) % -105) + #dscam030#5;
      aAlfa = #dscam030#6; |QBF aAlfa; aAlfa = aAlfa + "fich/" + aAlfa1 + "/";
      |PATH_DAT #16 aAlfa;

      |ABRE #caivase@;
      |SI nTecla = 10;
         #caivase@#0 = #dscam032#16; #caivase@#1 = #dscam032#20;
         |LEE 000#caivase@.];
         |CONSULTA_CLAVE #1#caivase@;
      |FINSI;

      #caivase@#0 = #dscam032#16; #caivase@#1 = #dscam032#20;
      |LEE 000#caivase@.=;
      |SI FSalida = 0;
         |PINTA 1345, #caivase@#2;
      |SINO;
         |MENAV "    Serie inexistente"; |ERROR;
      |FINSI;

      |CIERRA #caivase@; |DESCARGA_DEF #caivase@;
   |FINSI;
|FPRC;

|PROCESO TomaDecs; |TIPO 13;
   |SI #dscam036#11 ! "N"; |ACABA; |FINSI;
   nLong = 0;

   |DBASE aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "def/" + #dscam036#13;
   |CARGA_DEF aAlfa, RefDato@;
   |SI FSalida = 0;
      aAlfa = "|C" + (("000" + #dscam036#14) % -103) + "MINIMO";
      aAlfa = #RefDato@#aAlfa#;
      aAlfa = aAlfa - ".";
      |SI FSalida ! 0;
         nCalc = FSalida; nCalc1 = nCalc + 98; aAlfa = aAlfa % nCalc1; |QBF aAlfa;
         aLong = aAlfa % 0; nLong = aLong;
         aAlfa1 = "9" * nLong;
         |SI aAlfa ! aAlfa1;
            nCalc1 = (nCalc / 100) ! 0; nLong = 15 - nCalc1;
         |FINSI;
      |FINSI;
      |DESCARGA_DEF #RefDato@;
   |FINSI;
   nDeci_nDec = nLong;
|FPRC;

|PROCESO CuentaIvas; |TIPO 2;
   |SI #dscam032#14 = "S";
      |SI FSalida = 7; |O FSalida = 1; |HAZ BorraIva; |FINSI;
   |FINSI;

   nFlag = 0 +. 1;
   ModoEntrada = (FEntrada / 100) ! 0;

   |SI nFlag < 0;
      |SI #dscam032#14 = "S"; nNumIvas = nNumIvas - 1; |FINSI;
   |SINO;
      |SI #dscam032#14 = "S"; nNumIvas = nNumIvas + 1; |FINSI;
      |SI nNumIvas = 0; nLibro = 0; aSerie = ""; |FINSI;
      |SI nNumIvas = 1; nLibro = #dscam032#15; aSerie = #dscam032#16; |FINSI;
   |FINSI;
|FPRC;

|RUTINA infm172;
   #dscam172#0 = #dscam030#0;
   #dscam172#1 = "               ";
|FRUT;

|RUTINA supm172;
   #dscam172#0 = #dscam030#0;
   #dscam172#1 = "zzzzzzzzzzzzzzz";
|FRUT;

|RUTINA infm173;
   #dscam173#0 = #dscam172#0;
   #dscam173#1 = #dscam172#1;
   #dscam173#2 = 001;
|FRUT;

|RUTINA supm173;
   #dscam173#0 = #dscam172#0;
   #dscam173#1 = #dscam172#1;
   #dscam173#2 = 999;
|FRUT;

|RUTINA infm174;
   #dscam174#0 = #dscam173#0;
   #dscam174#1 = #dscam173#1;
   #dscam174#2 = #dscam173#2;
   #dscam174#3 = 001;
|FRUT;

|RUTINA supm174;
   #dscam174#0 = #dscam173#0;
   #dscam174#1 = #dscam173#1;
   #dscam174#2 = #dscam173#2;
   #dscam174#3 = 999;
|FRUT;

|PROCESO Tipo13m172; |TIPO 13;
   |ENTLINEAL #1#dscam173, -3, 7, 15, 1, infm173, supm173;
   |ENTLINEAL #1#dscam174, -3, 7, 21, 1, infm174, supm174;
|FPRC;

|PROCESO Tipo03m172; |TIPO 3;
   |ENTLINEAL #1#dscam174, -4, 7, 21, 1, infm174, supm174;
   |ENTLINEAL #1#dscam173, -3, 2, 15, 1, infm173, supm173;
|FPRC;

|PROCESO Tipo11m172; |TIPO 11;
   |SI FSalida = 10;
      aMemoria = "{" + #dscam172#1; |QBF aMemoria;
      aMemoria = aMemoria + "}";
      |ERROR; |PTEC 807;
   |FINSI;
|FPRC;

|PROCESO Tipo13m173; |TIPO 13;
   |ENTLINEAL #1#dscam174, -4, 7, 21, 1, infm174, supm174;
|FPRC;

|PROCESO Tipo03m173; |TIPO 3;
   |ENTLINEAL #1#dscam174, -4, 2, 21, 1, infm174, supm174;
|FPRC;

|PROCESO Memorias;
   aMemoria = "";
   |PUSHV 0501 2380;

   |PINPA #0#dscam172; |PINDA #0#dscam172;

   |ENTLINEAL #1#dscam173, -3, 7, 15, 1, infm173, supm173;
   |ENTLINEAL #1#dscam174, -4, 7, 21, 1, infm174, supm174;

   |PTEC 808;
   |ENTLINEAL #1#dscam172, -2, 2, 21, 1, infm172, supm172;

   |POPV;
|FPRC;

|RUTINA inf2a;
   #dscaw132#0 = 001;
   #dscaw132#6 = TipoCampo1;
|FRUT;

|RUTINA sup2a;
   #dscaw132#0 = 999;
   #dscaw132#6 = TipoCampo2;
|FRUT;

|RUTINA inf3a;
   #dscaw133#3 = #dscam030#0;
   #dscaw133#4 = #dscam031#2;
   #dscaw133#5 = #dscam032#2;
   #dscaw133#6 = nLinCondi;
   #dscaw133#7 = nLinValor;
   #dscaw133#8 = aTipoMemo;
   #dscaw133#9 = aMemoria;
   #dscaw133#0 = 1;
|FRUT;

|RUTINA sup3a;
   #dscaw133#3 = #dscam030#0;
   #dscaw133#4 = #dscam031#2;
   #dscaw133#5 = #dscam032#2;
   #dscaw133#6 = nLinCondi;
   #dscaw133#7 = nLinValor;
   #dscaw133#8 = aTipoMemo;
   #dscaw133#9 = aMemoria;
   #dscaw133#0 = 999;
|FRUT;

|PROCESO EditaLineas1; |TIPO 13;
   |SI FSalida = 10;
      |ENTLINEAL #1#dscaw133,-8,1,22,1,inf3a,sup3a;
      |ENTLINEAL #1#dscaw133,8,7,22,1,inf3a,sup3a;
   |FINSI;
|FPRC;

|PROCESO LinFichero1; |TIPO 0;
   LinCmps = 0;
   |SALVA_FICHA #dscaw133;
   #dscaw133#3 = #dscam030#0;
   #dscaw133#4 = #dscam031#2;
   #dscaw133#5 = #dscam032#2;
   #dscaw133#6 = nLinCondi;
   #dscaw133#7 = nLinValor;
   #dscaw133#8 = aTipoMemo;
   #dscaw133#9 = aMemoria;
   #dscaw133#0 = 1;
   |LEE 000#dscaw133.];
   |SI FSalida ! 0; LinCmps = 10; |FINSI;
   |PARA; |SI FSalida = 0; |HACIENDO;
      |SI #dscaw133#3 = #dscam030#0; |Y #dscaw133#4 = #dscam031#2;
      |Y #dscaw133#5 = #dscam032#2;  |Y #dscaw133#6 = nLinCondi;
      |Y #dscaw133#7 = nLinValor;    |Y #dscaw133#8 = aTipoMemo;
      |Y #dscaw133#9 = aMemoria;
         LinCmps = #dscaw133#0 + 10;
         |LEE 000#dscaw133.s;
      |SINO;
         |SI LinCmps = 0; LinCmps = 10; |FINSI;
         |SAL;
      |FINSI;
   |SIGUE;
   |REPON_FICHA #dscaw133;

   |DDEFECTO #dscaw133;
   #dscaw133#0 = LinCmps;
   Comodin = "[" + #dscaw132#2; |QBF Comodin;
   Comodin = Comodin + "][" + #dscaw132#5; |QBF Comodin;
   Comodin = Comodin + "]";
   #dscaw133#1 = Comodin;
   Comodin = "[" + #dscaw132#1; |QBF Comodin;
   Comodin1 = ("000" + #dscaw132#4) % -103;
   Comodin = Comodin + "][" + Comodin1 + "]";
   #dscaw133#2 = Comodin;
   #dscaw133#3 = #dscam030#0;
   #dscaw133#4 = #dscam031#2;
   #dscaw133#5 = #dscam032#2;
   #dscaw133#6 = nLinCondi;
   #dscaw133#7 = nLinValor;
   #dscaw133#8 = aTipoMemo;
   #dscaw133#9 = aMemoria;

   |GRABA 020#dscaw133.n;
   |ENTLINEAL #1#dscaw133,-8,7,22,1,inf3a,sup3a;
|FPRC;

|PROCESO MiraCmpClave; |TIPO 11;
   |PINTA 0915, aCmpClv;

   |SI FSalida = 12;
      |SI #dscam030#2 = "CB";
         aFichP = "dscam004"; aFichC = "dscam003";
      |FINSI;
      |SI #dscam030#2 = "PG";
         aFichP = "dscam009"; aFichC = "dscam008";
      |FINSI;
      |SI #dscam030#2 = "RM";
         aFichP = "dscam013"; aFichC = "dscam012";
      |FINSI;
      |SI #dscam030#2 = "PA";
         aFichP = "agifa022"; aFichC = "dscam021";
      |FINSI;
      |SI #dscam030#2 = "TA";
         aFichP = "dscam047"; aFichC = "dscam046";
      |FINSI;
      |SI #dscam030#2 = "CF";
         aFichP = "dscam050"; aFichC = "dscam049";
      |FINSI;
      aAlfa = #dscam036#13; |QBF aAlfa;
      |SI aAlfa = aFichP; |O aAlfa = aFichC;
         |SI #dscam030#10 ! 999;
            aAlfa = "    N" + &191 + " Desea cambiar el campo clave del enlace ? ";
            |CONFI aAlfa;
            |SI FSalida = 0;
               aAlfa = " Campo clave enlace : [" + #dscam036#1; |QBF aAlfa;
               aAlfa = aAlfa + "][" + #dscam036#2; |QBF aAlfa;
               aCmpClv = aAlfa + "]";
               |PINTA 0915, aCmpClv;
               #dscam030#9 = #dscam036#13; #dscam030#10 = #dscam036#14;
            |FINSI;
         |SINO;
            aAlfa = " Campo clave enlace : [" + #dscam036#1; |QBF aAlfa;
            aAlfa = aAlfa + "][" + #dscam036#2; |QBF aAlfa;
            aCmpClv = aAlfa + "]";
            |PINTA 0915, aCmpClv;
            #dscam030#9 = #dscam036#13; #dscam030#10 = #dscam036#14;
         |FINSI;
         |ERROR;
      |FINSI;
   |FINSI;
   |SI FSalida = 13; |Y #dscam030#10 ! 999;
      aAlfa = "    N" + &191 + " Desea vaciar el campo clave del enlace ? ";
      |CONFI aAlfa;
      |SI FSalida = 0;
         #dscam030#9 = ""; #dscam030#10 = 999;
         |GRABA 020#dscam030.a;
      |FINSI;
      aCmpClv = &196 * 60; |PINTA 0915, aCmpClv;
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO Campos1;
   #dscam027#0 = #dscam029#1;
   |LEE 000#dscam027.=

   |DDEFECTO #dscaw132;

   #dscaw132#0 = Linea;  Linea = Linea + 1;
   #dscaw132#1 = #dscam029#1;
   #dscaw132#2 = #dscam027#1;
   #dscaw132#3 = #dscam029#4;
   #dscaw132#4 = #dscam029#2;
   #dscaw132#5 = #dscam029#3;
   #dscaw132#6 = #dscam029#5;
   |GRABA 020#dscaw132.n;
|FPRC;

|DEFBUCLE Ficheros1;
#dscam029#1;
4,5;
001,#dscam030#2,TipoCampo1;
999,#dscam030#2,TipoCampo2;
;
NULL,Campos1;
|FIN;

|PROCESO Interpreta1;
   Comodin1 = #dscaw133#1 % 0102;
   |SI Comodin1 = "[%";
      Comodin1 = #dscaw133#1 % 0105; |QBF Comodin1;
   |SINO;
      Comodin1 = #dscaw133#2 % 0101;
   |FINSI;

   Comodin2 = #dscaw133#2 % 0299; |QBF Comodin2;
   Comodin1 = Comodin1 + Comodin2; |QBF Comodin1;
   |SI Comodin1 = "";
      Comodin1 = #dscaw133#1; |QBF Comodin1;
   |FINSI;
   Comodin = Comodin + Comodin1;
|FPRC;

|DEFBUCLE Interpreta1;
#dscaw133#1;
;
#dscam032#0,#dscam032#1,#dscam032#2,aMemoria,nLinCondi,nLinValor,aTipoMemo,001;
#dscam032#0,#dscam032#1,#dscam032#2,aMemoria,nLinCondi,nLinValor,aTipoMemo,999;
;
NULL,Interpreta1;
|FIN;

|PROCESO SelecMemo1;
   |SI FSalida ! 10; |ACABA; |FINSI;

   |DELINDEX #dscaw132;

   |ABRE #dscam027;
   |ABRE #dscam029;
   |ABRE #dscaw132;
   |ABRE #dscaw133;

   SwDep = 0; Linea = 1;
   TipoCampo1 = "C"; TipoCampo2 = "I"; aTipoMemo = "Z";
   |BUCLE Ficheros1;
   nLinCondi = #dscam173#2; nLinValor = 0; aMemoria = #dscam173#1;

   |DDEFECTO #dscaw133;
   #dscaw133#3 = #dscam030#0;
   #dscaw133#4 = #dscam031#2;
   #dscaw133#5 = #dscam032#2;
   |LEE 000#dscaw133.];
   |PARA; |SI FSalida = 0; |Y #dscaw133#3 = #dscam030#0; |Y #dscaw133#4 = #dscam031#2;
    |Y #dscaw133#5 = #dscam032#2; |HACIENDO;
      |SI #dscaw133#6 = nLinCondi; |Y #dscaw133#7 = nLinValor; |Y #dscaw133#8 = aTipoMemo;
         |SI #dscaw133#9 ! aMemoria;
            Comodin = #dscaw133#9; |QBF Comodin;
            |SI Comodin = "";
               |SALVA_FICHA #dscaw133;
               #dscaw133#9 = aMemoria;
               |GRABA 020#dscaw133.n;
               |REPON_FICHA #dscaw133;

               |BORRA 020#dscaw133.a;
            |FINSI;
         |FINSI;
      |FINSI;
      |LEE 000#dscaw133.s;
   |SIGUE;

   |PUSHV 0501 2380;
   |ENTLINEAL #1#dscaw133,-8,7,22,1,inf3a,sup3a;
   |ENTLINEAL #2#dscaw132,-1,4,13,1,inf2a,sup2a;
   |POPV;

   |CIERRA #dscaw133;
   |CIERRA #dscaw132;
   |CIERRA #dscam029;
   |CIERRA #dscam027;

   Comodin = "";
   |BUCLE Interpreta1;
   #dscam173#3 = Comodin; eaExpre = Comodin;

   |ERROR;
|FPRC;

|PROCESO SelecMemo2;
   |SI FSalida ! 10; |ACABA; |FINSI;

   |DELINDEX #dscaw132;

   |ABRE #dscam027;
   |ABRE #dscam029;
   |ABRE #dscaw132;
   |ABRE #dscaw133;

   SwDep = 0;
   TipoCampo1 = "C"; TipoCampo2 = "I"; aTipoMemo = "z";
   Linea = 1;
   |BUCLE Ficheros1;
   nLinCondi = #dscam174#2; nLinValor = #dscam174#3; aMemoria = #dscam174#1;

   |PUSHV 0501 2380;
   |ENTLINEAL #1#dscaw133,-8,7,22,1,inf3a,sup3a;
   |ENTLINEAL #2#dscaw132,-1,4,13,1,inf2a,sup2a;
   |POPV;

   |CIERRA #dscaw133;
   |CIERRA #dscaw132;
   |CIERRA #dscam029;
   |CIERRA #dscam027;

   Comodin = "";
   |SI SwDep = 1; SwDep = 0; TipoCampo1 = "E"; TipoCampo2 = "E"; |FINSI;
   |BUCLE Interpreta1;
   #dscam174#4 = Comodin;

   |ERROR;
|FPRC;
