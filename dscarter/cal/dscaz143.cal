|FICHEROS;
   dscaz143 #0;
   dscam015 #1;

   dscam012 #2;
   dscam013 #3;
   dscam003 #4;
   dscam014 #5;
   dscam051 #6;
   dscam030 #7;
   dscam004 #8;
   dscaw013 #9;
   dscaw038 #10;
   dscam002 #11;
   dscam044 #12;
   dscam093 #13,MANTE;
   dscam160 #14;

   agif069@ #52;
   agif084@ #53;
   agif071@ #54;
   agif010@ #55;
   agif059@ #56;
   agif134@ #57;
   dsm0053@ #58;

   &agif024@ #50;
   &caclipr@ #51;
   &agif321@ #100;
|FIN;

|VARIABLES;
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = "";
   &HayGestion = 0; &HayConta = 0; &nDeci_Base = 0; &nDeci_Div = 0;
   &Fichero   = ""; &Cmp = "";      &Tipo = "";     &CmpNum = 0;
   &Niv1 = 0; &Niv2 = 0; &Niv3 = 0; &Niv4 = 0;  &Niv5 = 0; &Niv6 = 0;
   &eaCodigo    = "";
   &eaTipoCod   = "";
   &aCuenta     = "";
   &eaNif       = "";
   &eaNombre    = "";
   &eaDireccion = "";
   &eaPoblacion = "";
   &eaProvincia = "";
   &eaCP        = "";
   &eaCP1       = "";
   &eaCP2       = "";
   &eaTelefono  = "";
   &eaNombre1   = "";

   nCont   = 0;
   nCalc2  = 0;
   nCalc3  = 0;
   aChar1  = "";
   aChar2  = "";

   nBase  = 0;
   nIVA   = 0;
   nTotal = 0;
   nPos1  = 0;
   nPos2  = 0;
   nModo  = 0;
   nAntRem = 0;
   nSwError = 0;

   nNumFac = 0;
   nImpFac = 0;
   nNumAbo = 0;
   nImpAbo = 0;
   nNumRem = 0;

   aConcepto = ""; nLinea = 0;
   fFecha = @;
   nCalc  = 0;
   nCalc1 = 0;
   nNumConcepto = 0; aAlfa = ""; aAlfa1 = "";
   aParte1 = ""; aParte2 = ""; aParte3 = "";
   EmpreAnt = 0; PerioAnt = 0;
   aFinLin = ""; aFinFic = "";
   VAlfa   = ""; CIF = "";
   VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = ""; VAlfa06 = "";
   VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = ""; VAlfa11 = ""; VAlfa12 = "";
   VAlfa13 = ""; VAlfa14 = ""; VAlfa15 = ""; VAlfa16 = ""; VAlfa17 = ""; VAlfa18 = "";
   VAlfa19 = ""; VAlfa20 = ""; VAlfa21 = ""; VAlfa22 = ""; VAlfa23 = ""; VAlfa24 = "";

   Field = ""; aTipo = ""; Fecha = ""; Comodin = ""; Comodin1 = "";
   NumDig = 0; Calc = 0;  Handle = 0; LinCob  = 0; Tipo1 = "";

   nSw = 0;

   aConcepto1 = ""; aConcepto2 = ""; aConcepto3 = "";
   aConcepto4 = ""; aConcepto5 = ""; aConcepto6 = "";

   NumOrd = 0; TotalOrd = 0;
   NumInd = 0; TotalInd = 0;
   nNumero = 0;
   NumRegs = 0;
   NumDomics = 0;
   SwHayNoEmit = 0;
   aLong = ""; nLong = 0;
   SwEmit = "";

   handle = 0;
   SwHay  = 0;

   Cambio = 1;
   Redond = 0;
   Moneda = "P";
   Prefijo = "";

   &eaOrigen = "";
   &Divisa   = "";
   &enEmpCartera = 0; &enEmpGestion = 0; &enBanco = 0;
   &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = "";
|FIN;

|PROCESO IniVars;
   VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = ""; VAlfa06 = "";
   VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = ""; VAlfa11 = ""; VAlfa12 = "";
   VAlfa13 = ""; VAlfa14 = ""; VAlfa15 = ""; VAlfa16 = ""; VAlfa17 = ""; VAlfa18 = "";
   VAlfa19 = ""; VAlfa20 = ""; VAlfa21 = ""; VAlfa22 = ""; VAlfa23 = ""; VAlfa24 = "";
   Field = ""; aTipo = ""; Fecha = ""; Comodin = "";
   NumDig = 0; Calc = 0;
   aLong = ""; nLong = 0;
|FPRC;

|PROCESO RegControl;
   |HAZ IniVars;

   VAlfa01 = #dscaz143#8; |QBF VAlfa01; VAlfa01 = ("0000000000" + VAlfa01) % -110;
   VAlfa02 = #48#1; |QBF VAlfa02; VAlfa02 = (VAlfa02 + (" " * 30)) % 0130;
   VAlfa03 = #dscaz143#6; |QBF VAlfa03; VAlfa03 = (VAlfa03 % 0902) + (VAlfa03 % 0402) + (VAlfa03 % 0102);
   VAlfa  = "03" + VAlfa01 + VAlfa02 + VAlfa03;
   VAlfa  = VAlfa + (" " * 189);
   VAlfa  = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;

   TotalOrd = 0;
   NumOrd = 0;
   nNumero = 0; nNumRem = 0;
|FPRC;

|PROCESO RegCabecera;
   |HAZ IniVars;

   VAlfa01 = ("00000" + #dscaz143#17) % -105; #dscaz143#17 = #dscaz143#17 + 1;
   VAlfa02 = #dscam012#1; |QBF VAlfa02; VAlfa02 = (VAlfa02 % 0902) + (VAlfa02 % 0402) + (VAlfa02 % 0102);
   VAlfa = "06" + VAlfa01 + VAlfa02;
   VAlfa = VAlfa + " " * 224;
   VAlfa  = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;

   nNumFac = 0; nImpFac = 0;
   nNumAbo = 0; nImpAbo = 0;
|FPRC;

|PROCESO RegDatos;
   #dscam003#40 = #dscam013#16;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      Divisa = #dscam003#57; |HAZ TomaDecim;
   |FINSI;

   #dscam160#0 = #dscam003#12;
   |LEE 000#dscam160.=;
   |SI FSalida ! 0; |DDEFECTO #dscam160; |FINSI;

   |HAZ IniVars;

   eaCodigo = #dscam003#32; eaTipoCod = "C"; aCuenta = #dscam003#5; |HAZ LeeDatos;
   Field = eaNif; aTipo = "A"; NumDig = 12; |HAZ Formato ; CIF = Field;

   |HAZ IniVars;

   VAlfa01 = "          "; || FALTA
   VAlfa02 = #dscam003#6; |QBF VAlfa02; VAlfa02 = (VAlfa02 + (" " * 30)) % 0130;
   VAlfa03 = CIF; |QBF VAlfa03; VAlfa03 = (VAlfa03 + (" " * 14)) % 0114;
   Field = eaDireccion;  aTipo = "A"; NumDig = 30; |HAZ Formato ; VAlfa04  = Field;
   Field = eaPoblacion;  aTipo = "A"; NumDig = 30; |HAZ Formato ; VAlfa05  = Field;
   Field = eaCP;         aTipo = "A"; NumDig = 5;  |HAZ Formato ; VAlfa06  = Field;
   nCalc = #dscam003#30;
   |SI nCalc ] 0;
      VAlfa07 = "F";
      nCalc = 0; VAlfa08 = #dscam003#0;  |QBF VAlfa08;
      VAlfa08 = VAlfa08 % 0; nCalc = VAlfa08; nCalc = 10 - nCalc; nCalc1 = -(100 + nCalc);
      VAlfa08 = #dscam003#0;  |QBF VAlfa08;
      |SI #dscam003#1 ! 0;
         VAlfa09 = #dscam003#1;  |QBF VAlfa09; VAlfa09 = (("0" * nCalc) + VAlfa09) % nCalc1;
      |SINO;
         VAlfa09 = VAlfa09 + #dscam003#40; |QBF VAlfa09;
         VAlfa09 = (("0" * nCalc) + VAlfa09) % nCalc1;
      |FINSI;
      VAlfa08 = VAlfa08 + VAlfa09;
      VAlfa08 = ((" " * 10) + VAlfa08) % -110;
      VAlfa09 = "          ";
      nNumFac = nNumFac + 1; nImpFac = nImpFac + #dscam013#7;
   |SINO;
      VAlfa07 = "A";
      nCalc = 0; VAlfa08 = #dscam003#0;  |QBF VAlfa08;
      VAlfa08 = VAlfa08 % 0; nCalc = VAlfa08; nCalc = 10 - nCalc; nCalc1 = -(100 + nCalc);
      VAlfa08 = #dscam003#0;  |QBF VAlfa08;
      |SI #dscam003#1 ! 0;
         VAlfa09 = #dscam003#1;  |QBF VAlfa09; VAlfa09 = (("0" * nCalc) + VAlfa09) % nCalc1;
      |SINO;
         VAlfa09 = VAlfa09 + #dscam003#40; |QBF VAlfa09;
         VAlfa09 = (("0" * nCalc) + VAlfa09) % nCalc1;
      |FINSI;
      VAlfa09 = VAlfa08 + VAlfa09;
      VAlfa09 = ((" " * 10) + VAlfa09) % -110;
      VAlfa08 = "          ";
      nNumAbo = nNumAbo + 1; nImpAbo = nImpAbo + #dscam013#7;
   |FINSI;
   VAlfa10 = #dscam003#4; |QBF VAlfa10; VAlfa10 = (VAlfa10 % 0902) + (VAlfa10 % 0402) + (VAlfa10 % 0102);
   VAlfa11 = #dscam003#3; |QBF VAlfa11; VAlfa11 = (VAlfa11 % 0902) + (VAlfa11 % 0402) + (VAlfa11 % 0102);
   nCalc = #dscam013#7; nCalc = nCalc * 100;
   VAlfa12 = nCalc; |QBF VAlfa12; VAlfa12 = (("0" * 15) + VAlfa12) % -115;
   VAlfa13 = ("00" + #dscam160#1) % -102;
   VAlfa14 = "00";
   VAlfa15 = "00";
   VAlfa16 = #dscam003#8;  |QBF VAlfa16; VAlfa16 = (("0000" + VAlfa16) % -104);
   VAlfa17 = #dscam003#9;  |QBF VAlfa17; VAlfa17 = (("0000" + VAlfa17) % -104);
   VAlfa18 = #dscam003#11; |QBF VAlfa18; VAlfa18 = (("0000000000" + VAlfa18) % -110);
   VAlfa19 = #dscam160#2;
   VAlfa20 = #dscam003#32; |QBF VAlfa20; VAlfa20 = ((VAlfa20 + "          ") % 0110) + "     ";
   VAlfa21 = #dscam003#10; |QBF VAlfa21; VAlfa21 = (("00" + VAlfa21) % -102);
   VAlfa22 = "ES";
   VAlfa23 = "EUR";
   VAlfa = "09";
   VAlfa = VAlfa   + VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05;
   VAlfa = VAlfa   + VAlfa06 + VAlfa07 + VAlfa08 + VAlfa09 + VAlfa10;
   VAlfa = VAlfa   + VAlfa11 + VAlfa12 + VAlfa13 + VAlfa14 + VAlfa15;
   VAlfa = VAlfa   + VAlfa16 + VAlfa17 + VAlfa18 + VAlfa19 + VAlfa20;
   VAlfa = VAlfa   + VAlfa21 + VAlfa22 + VAlfa23 + (" " * 21);
   VAlfa = Handle + " " + VAlfa + aFinLin;
   |FGRABA VAlfa;

   NumRegs = NumRegs + 1;
   NumInd = NumInd + 1;
   TotalInd = TotalInd + #dscam013#7;
   NumOrd = NumOrd + 1;
   TotalOrd = TotalOrd + #dscam013#7;
   NumDomics = NumDomics + 1;

   #dscam012#0 = #dscam013#0;
   |LEE 000#dscam012.=;
   |SI FSalida ! 0; |DDEFECTO #dscam012; |FINSI;
   |SI #dscam012#23 = "N"; |HAZ ActRecibo; |FINSI;

   |SI nAntRem ! #dscam013#0;
      |SI nAntRem > 0;
         #dscam012#0 = nAntRem;
         |LEE 101#dscam012.=;
         |SI FSalida = 0;
            #dscam012#23 = "S";
            |GRABA 020#dscam012.a; |LIBERA #dscam012;
         |FINSI;
      |FINSI;
      nAntRem = #dscam013#0;
   |FINSI;

   |LIBERA #dscam003;
|FPRC;

|PROCESO ActRecibo;
   || Actualizo  el historico de cobros
   #dscam004#17 = #dscam013#16;
   #dscam004#3 = 99;
   |LEE 000#dscam004.];
   |SI FSalida ! 0;
      |LEE 010#dscam004.u;
      |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
         LinCob = #dscam004#3 + 1;
      |SINO;
         LinCob = 1;
      |FINSI;
   |SINO;
      |SI #dscam004#17 = #dscam013#16;
         LinCob = #dscam004#3 + 1;
      |SINO;
         |LEE 010#dscam004.a;
         |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
            LinCob = #dscam004#3 + 1;
         |SINO;
            LinCob = 1;
         |FINSI;
      |FINSI;
   |FINSI;

   |DDEFECTO #dscam004;
   #dscam004#17 = #dscam013#16;
   #dscam004#15 = #dscam013#2;
   #dscam004#0  = #dscam013#4;
   #dscam004#1  = #dscam013#3;
   #dscam004#2  = #dscam013#5;
   #dscam004#3  = LinCob;
   #dscam004#4  = #dscam012#14;
   #dscam004#5  = "EMR";
   #dscam004#6  = #dscaz143#6;
   #dscam003#40 = #dscam013#16;
   |LEE 010#dscam003.=;
   |SI FSalida = 0;
      #dscam004#7  = #dscam003#23; #dscam004#25  = #dscam003#61;
   |FINSI;
   #dscam004#8  = 0;
   #dscam004#9  = 0;
   #dscam004#10 = 0;
   #dscam004#26 = 0;
   |GRABA 020#dscam004.n;

   #dscam013#24 = LinCob;
   |GRABA 020#dscam013.a;
|FPRC;

|PROCESO RegPie;
   |HAZ IniVars;

   VAlfa01 = nNumFac; VAlfa01 = ("0000" + VAlfa01) % -104;
   VAlfa02 = nNumAbo; VAlfa02 = ("0000" + VAlfa02) % -104;
   nCalc = nImpFac * 100; VAlfa03 = nCalc;
   VAlfa03 = (("0" * 15) + VAlfa03) % -115;
   nCalc = nImpAbo * 100; VAlfa04 = nCalc;
   VAlfa04 = (("0" * 15) + VAlfa04) % -115;
   VAlfa   = "66" + VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04;
   VAlfa   = VAlfa + (" " * 197);
   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
|FPRC;

|PROCESO RegFinal;
   |HAZ IniVars;

   VAlfa = "99" + (("0000" + nNumRem) % -104);
   VAlfa = VAlfa + (" " * 231);
   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
|FPRC;

|DEFBUCLE Recibos;
#dscam013#1;
;
#dscam012#0,001;
#dscam012#0,999;
be;
NULL,RegDatos;
|FIN;

|PROCESO CompruebaRecs;
   #dscam003#40 = #dscam013#16;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      #dscam160#0 = #dscam003#12;
      |LEE 000#dscam160.=;
      |SI FSalida ! 0;
         aAlfa = "    El tipo de recibo " + (("00" + #dscam003#12) % -102) + " no tiene asociado documento de acompa¤amiento. Proceso cancelado.";
         |MENAV aAlfa;
         nSwError = 1; |ERROR10;
      |FINSI;
   |SINO;
      aAlfa = "    No encuentro el recibo " + #dscam013#16 + ". Proceso cancelado";
      |MENAV aAlfa;
      nSwError = 1; |ERROR10;
   |FINSI;
|FPRC;

|DEFBUCLE CompruebaRecs;
#dscam013#1;
;
#dscam012#0,001;
#dscam012#0,999;
;
NULL,CompruebaRecs;
|FIN;

|PROCESO CompruebaRem;
   #dscam012#0 = #dscaw038#0;
   |LEE 000#dscam012.=;
   |SI FSalida = 0;
      nSwError = 0;
      |BUCLE CompruebaRecs;
      |SI nSwError = 1; |ERROR10; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE CompruebaRem;
#dscaw038#1;
;
INICIO;
FINAL;
;
NULL,CompruebaRem;
|FIN;

|PROCESO Remesas;
   #dscam012#0 = #dscaw038#0;
   |LEE 101#dscam012.=;
   |SI FSalida = 0;
      SwEmit = #dscam012#23;
   |FINSI;

   eaUsuario = Usuario % 0810;
   eaDescr   = "EMISION REMESA (" + (("00000" + #dscam012#0) % -105);
   eaDescr   = eaDescr + ") EN DISKETTE DESDE FACTORING BANESTO";
   eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
   eaTipoOp  = "E";   enImpAnt = #dscam012#10; enImpAct = #dscam012#10;
   |HAZ GrabaAudit;

   |HAZ RegCabecera;
   |BUCLE Recibos;
   |HAZ RegPie;
   nNumRem = nNumRem + 1;

   |SI HayConta = 1; |Y SwEmit = "N"; |Y #dscam051#1 = "S";
      |ABRE #dscam030;
      #dscam030#0 = #dscaz143#14;
      |LEE 010#dscam030.=;
      |SI FSalida = 0;
         |SI #dscam030#4 ! #dscaw038#3; |O #dscam030#5 ! #dscaw038#4;
            EmpreAnt = #dscam030#4; PerioAnt = #dscam030#5;
            #dscam030#4 = #dscaw038#3; #dscam030#5 = #dscaw038#4;
            |GRABA 020#dscam030.a;
         |SINO;
            EmpreAnt = -1;
         |FINSI;
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #9 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         Comodin = #dscaz143#14;
         |SI Comodin = "    ";
            |ABRE #dscam093;
            #dscam093#0 = "E";
            |LEE 000#dscam093.=;
            |SI FSalida = 0;
               |SI #dscam012#22 = 1; Comodin = #dscam093#1; |FINSI;
               |SI #dscam012#22 = 2; Comodin = #dscam093#3; |FINSI;
               |SI #dscam012#22 = 3; Comodin = #dscam093#5; |FINSI;
               |SI #dscam012#22 = 4; Comodin = #dscam093#7; |FINSI;
               |SI #dscam012#22 = 5; Comodin = #dscam093#9; |FINSI;
               |SI #dscam012#22 = 6; Comodin = #dscam093#11; |FINSI;
               |SI #dscam012#22 = 7; Comodin = #dscam093#13; |FINSI;
            |FINSI;
            |CIERRA #dscam093;
         |FINSI;

         |DDEFECTO #dscaw013;
         #dscaw013#0  = 1;            #dscaw013#15 = Comodin;
         #dscaw013#5  = #dscam012#0;  #dscaw013#6  = #dscam012#0;
         #dscaw013#11 = "N";          #dscaw013#12 = 5;
         #dscaw013#13 = "dscam013";   #dscaw013#14 = 0;
         |GRABA 020#dscaw013.n;
         |CIERRA #dscaw013;
         |LIBERA #dscam012;

         Comodin = "dscam033.tab;" + Comodin + ",I";
         |LIBERA #dscam012; |CIERRAT #dscam012;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam012; |LEE 101#dscam012.=;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

         |SI EmpreAnt ! -1;
            #dscam030#4 = EmpreAnt; #dscam030#5 = PerioAnt;
            |GRABA 020#dscam030.a;
         |FINSI;
      |FINSI;
      |CIERRA #dscam030;
   |FINSI;

   |SI #dscam012#23 = "N";
      #dscam012#23 = "S"; |GRABA 020#dscam012.a;
   |FINSI;
   |LIBERA #dscam012;
|FPRC;

|DEFBUCLE Remesas;
#dscaw038#1;
;
INICIO;
FINAL;
;
NULL,Remesas;
|FIN;

|PROCESO MiraRemesas;
   SwHay = 1;
   |DDEFECTO #dscaw038;
   #dscaw038#0 = #dscam012#0;
   #dscaw038#1 = #dscam012#10;
   #dscaw038#2 = #dscaz143#14;
   #dscaw038#5 = #dscam012#23;
   |SI #dscaw038#5 = "N";
      SwHayNoEmit = 1;
   |FINSI;

   |ABRE #dscam030;
   #dscam030#0 = #dscaz143#14;
   |LEE 000#dscam030.=;
   |SI FSalida = 0;
      #dscaw038#3 = #dscam030#4;
      #dscaw038#4 = #dscam030#5;
   |FINSI;
   |CIERRA #dscam030;
   |GRABA 020#dscaw038.n;
|FPRC;

|DEFBUCLE MiraRemesas;
#dscam012#1;
1,2,22;
#0#0,#0#2,#dscam014#0, 6;
#0#1,#0#3,#dscam014#0, 7;
;
NULL,MiraRemesas;
|FIN;

|RUTINA infw038;
   #dscaw038#0 = 00001;
   #dscaw038#5 = "N";
|FRUT;

|RUTINA supw038;
   #dscaw038#0 = 99999;
   #dscaw038#5 = "N";
|FRUT;

|PROCESO Secuencial;

   |DELINDEX #dscaw038;
   SwHayNoEmit = 0; SwHay = 0;
   |ABRE #dscaw038; |BUCLE MiraRemesas; |CIERRA #dscaw038;
   |SI SwHay = 0; |ACABA; |FINSI;

   #dscaz143#8 = #dscam014#67;
   |SI #dscaz143#8 = "       ";
      aAlfa = "    NEl numero cedente indicado est  vac¡o. Continuar? ";
      |CONFI aAlfa;
      |SI FSalida ! 0;
         |MENAV "    Rellene el numero cedente correctamente";
         |ACABA;
      |FINSI;
   |FINSI;

   |SI #dscaz143#15 = "N";
      |SI SwHayNoEmit = 1;
         |PUSHV 0501 2380;
         |ENTLINEAL #1#dscaw038,1,2,19,1,infw038,supw038;
         |POPV;
      |SINO;
         |MENAV "    No hay remesas sin emitir para redireccionar";
      |FINSI;
   |FINSI;

   |ABRE #dscam012; |ABRE #dscam013; |ABRE #dscam003; |ABRE #dscam160;
   nSwError = 0;
   |BUCLE CompruebaRem;
   |SI nSwError = 1; |ERROR10; |ACABA; |FINSI;
   |CIERRA #dscam012; |CIERRA #dscam013; |CIERRA #dscam003; |CIERRA #dscam160;

   |DFICB Comodin;
   Comodin1 = ("000" + #dscam014#0) % -103;
   Comodin1 = "factoring.seq";
   eaOrigen = Comodin; eaNombre1 = Comodin1;
   Comodin = "wb  " + Comodin + Comodin1;
   |QBF Comodin;
   |FABRE Comodin;
   handle = FSalida;
   |SI FSalida ] 0;
      |ABRE #dscam004;
      |ABRE #dscam003;
      |ABRE #dscam012;
      |ABRE #dscam013;
      |ABRE #dscam160;

      nCalc = 13; aFinLin = &nCalc;
      nCalc = 10; aFinLin = aFinLin + &nCalc;
      aFinFic = "";

      |HAZ RegControl; NumRegs = NumRegs + 1;
      |BUCLE Remesas;
      |HAZ RegFinal;   NumRegs = NumRegs + 1;
      #0#9 = NumDomics;
      #0#10 = NumRegs;
      #0#11 = TotalOrd;
      |PINTA #0#9; |PINTA #0#10; |PINTA #0#11;
      |PAUSA;
      |CIERRA #dscam160;
      |CIERRA #dscam013;
      |CIERRA #dscam012;
      |CIERRA #dscam003;
      |CIERRA #dscam004;
   |FINSI;
   VAlfa = Handle + " " + aFinFic; |FGRABA VAlfa;

   FSalida = handle; |FCIERRA FSalida;

   |SUB_EJECUTA_NP "dscaz032.tab";
|FPRC;

|DEFBUCLE Secuencial;
#dscam014#1;
;
#0#4;
#0#5;
be;
NULL,Secuencial;
|FIN;

|PROGRAMA;
   |HAZ Tipo8;

   |ABRE #dscaz143;
   |LEE 000#dscaz143.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscaz143;
      |GRABA 020#dscaz143.n;
   |FINSI;
   |PDEFECTO #dscaz143, 0, 8;

   |CLS;
   |CABEZA "Emision diskette factoring Banesto";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |GRABA 020#dscaz143.a;
      |HAZ MiraMoneda;
      |SI Cambio ! -1; |BUCLE Secuencial; |FINSI;
   |FINSI;
   |CIERRA #dscaz143;

   |HAZ Tipo9;
|FPRO;

|PROCESO RetocaFecha;
   |QBF Fecha;
   Comodin = Fecha % 0102;  || Dia
   Comodin = Comodin + (Fecha % 0402);  || Mes
   Comodin = Comodin + (Fecha % 0902);  || A¤o
   Fecha = Comodin;
|FPRC;

|PROCESO Formato;
   |SI aTipo = "I";
      Calc = Field;
      Calc = (Calc * Cambio) ! Redond;
      |SI Moneda = "E"; Calc = Calc * 100; |FINSI;
      Field = Calc;
   |FINSI;
   |SI aTipo = "A";
      Comodin = Field;        || faltaba, Juan
      |QBF Comodin;
      aChar1 = Comodin % 0; nCalc1 = aChar1;
      |PARA nCont = 1; |SI nCont [ nCalc1; |HACIENDO nCont = nCont + 1;
         nCalc2 = (nCont * 100) + 1;
         aChar1 = Comodin % nCalc2; aChar2 = "";
         |SI aChar1 = "§"; aChar2 = "º"; |FINSI;
         |SI aChar1 = "¦"; aChar2 = "ª"; |FINSI;
         |SI aChar1 = "¤"; aChar2 = "ñ"; |FINSI;
         |SI aChar1 = "¥"; aChar2 = "Ñ"; |FINSI;
         |SI aChar1 = " "; aChar2 = "á"; |FINSI;
         |SI aChar1 = "‚"; aChar2 = "é"; |FINSI;
         |SI aChar1 = "¡"; aChar2 = "í"; |FINSI;
         |SI aChar1 = "¢"; aChar2 = "ó"; |FINSI;
         |SI aChar1 = "£"; aChar2 = "ú"; |FINSI;

         |SI aChar2 ! "";
            nCalc2 = 99 + nCont; aParte1 = Comodin % nCalc2;
            aChar1 = aParte1 + aChar1;  aParte2 = Comodin - aChar1;
            Comodin = aParte1 + aChar2 + aParte2;
         |FINSI;
      |SIGUE;

      aParte2 = " " * NumDig;
      aParte1 = Comodin + aParte2;
      Calc = 100 + NumDig;
      Comodin = aParte1 % Calc;
   |SINO;
      Comodin = "0" * NumDig;
      Comodin = Comodin + Field;
      Calc = 0 - (100 + NumDig);
   |FINSI;

   |QBF Field;
   Field = Comodin % Calc;
|FPRC;

|PROCESO CampoEnlace; |TIPO 7;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;
   |SI HayConta = 1; |Y #dscam051#1 = "S";
      |ABRE #dscam030;
      #dscam030#0 = #dscam051#53;
      |LEE 000#dscam030.=;
      |SI FSalida = 0;
         ||PINTA 2120, #dscam030#1;
      |FINSI;
      |CIERRA #dscam030;
      #dscaz143#14 = #dscam051#53; |PINTA #dscaz143#14;
      aAlfa = #dscam051#61; |QBF aAlfa;
      |C_M #dscaz143#14,1,aAlfa;
   |SINO;
      #dscaz143#14 = ""; |PINTA #dscaz143#14;
      |C_M #dscaz143#14,1,"N";
   |FINSI;
|FPRC;

|PROCESO MiraMoneda;
      Moneda = "E";
      ||POPV;
      |SI #agif321@#9 = "ESP";
         |SI Moneda = "P";
            Cambio = 1;
            Redond = 0;
            Prefijo = "01";
         |SINO;
            Cambio = 1/166.386;
            Redond = 2;
            Prefijo = "01";
         |FINSI;
      |FINSI;
      |SI #agif321@#9 = "EUR";
         |SI Moneda = "P";
            Cambio = 166.386;
            Redond = 0;
            Prefijo = "0";
         |SINO;
            Cambio = 1;
            Redond = 2;
            Prefijo = "5";
         |FINSI;
      |FINSI;
|FPRC;
