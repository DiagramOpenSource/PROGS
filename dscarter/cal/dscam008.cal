|FICHEROS;
   dscam008 #0;
   dscam009 #1,MANTE;
   dscam025 #2;

   dscaw013 #3;
   dscam051 #4;

   dscam021 #5;
   dscam022 #6;

   dscam046 #7;
   dscam047 #8;

   dscam049 #9;
   dscam050 #10;

   dscaw012 #11;
   dscaw013 #12;

   &agif324@ #13;
   dscam067 #14;

   dscam044 #15;
   dscam045 #16;

   dscam095 #17;
   dscam096 #18;
   dscam058 #19;
   dscam043 #20;
   dscam029 #50;
   dscam030 #30;

   agif079@ #32;
   &agif112@ #33;

   camsic@ #101;
   camasil@ #100;
   cacuen@ #102;
   camadi@ #103;
   caempr@ #104;
   dscaw070 #200;

   RecibCmp@ #1000;
   cajainca@ #1001;
   cajainli@ #1002;
|FIN;

|VARIABLES;
   &enHayAsto = 0;
   nSwNoSigue = 0;
   nErroBuscaEnlace = 0;
   &enERP = 0;
   &HayConta = 0;
   &eaDirConta  = "";
   &eaEmpContab = "";
   &enSwError   = 0;
   &enSwErr     = 0;
   &efFecha     = @;
   nAnyo        = 0;
   nCalc4       = 0;
   nCalc1       = 0;

   &eaFichClas = "";  &eaTipoClas = ""; &enSwClas = 0;

   &Fichero = ""; &Tipo = ""; &Cmp = ""; &CmpNum = 0;
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = ""; &eaLlamada = "";
   &eaFicher = ""; &eaClave = "";
   &DCampoG = 0;  &HCampoG = 0;  &DCampoC = 0;  &HCampoC = 0;
   &TipoProveedor = "";
   &CodProveedor = "";

   &EURO = 0; &EURODB = 0; &EURODV = 0;
   &eaCodigo    = "";
   &eaTipoCod   = "";
   &aCuenta     = "";
   &eaNif       = "";
   &eaNombre    = "";
   &eaDireccion = "";
   &eaPoblacion = "";
   &eaProvincia = "";
   &eaCP        = "";
   &eaCP1       = "";
   &eaCP2       = "";
   &eaCodPais   = "";
   &eaCodIBAN   = "";
   &eaCodBIC    = "";
   &eaTelefono  = "";
   &enNume1     = 0;

   &DirCliente = ""; &Cp = ""; &PobCliente = ""; &ProvCliente = "";
   &TelCliente = "";

   &enErp = 0;
   {1}nPuntero   = 0;
     || NO PONER NINGUNA VARIABLE ENTRE ESTAS DOS ..... SE USAN COMO PUNTEROS
      aNume      = "";

   aAntClas  = "";
   aDespClas = "";
   nAntTRec  = 0;
   nSwError  = 0;
   nCuenta   = 0;
   nLinMov   = 0;
   fFechaCob = 0;
   nSw       = 0;

   aClv1 = "";
   aClv2 = "";
   aClv3 = "";
   aClv4 = "";

   nNumDocum = 0;
   nNumLinea = 0;

   Tecla = ""; Salir = 0; Opcion = 0; Campos = 0; SwError = 0; Modo = "";
   nCuentaPags = 0; nCodigo = 0; aOper = ""; nModo = 0;

   Calc = 0; PrimerReg = 1; nEmpresa = 0;
   Marca = 1; Cont = 0; Primero = 0; UltPago = 0; PagoAnt = 0; UltFPago = @;
   ModoEntrada = 0; aMarca = "";
   &eaEntidad = ""; &eaSucursal = ""; &eaCuenta = ""; &eaDC = "";
   &nDeci_Div = 0; &nDeci_Base = 0;
   &Divisa = "";
   &HayGestion = 0; &enDocum = 0;
   &PosLibro = 0; &PosSerie = 0; &PosFactu = 0; &PosRecib = 0;

   &eaResult    = "";
   &enNumDocum  = 0;
   &enTipoRec   = 0;

   VtoEnlace = ""; VtoAsto = 0; FechaVto = "";

   Documento = 0;
   SwClave = 0; NumClave = 0; nCalc = 0;
   LinBucle = 0;
   fFecha = @;
   nNumSec = 0;

   MaxOpc = 0; Linea = 0; FEstado = 0;
   Clave1 = 0; Clave2 = 0; Clave3 = "";

   Moneda = 0; BASE = 1; DIV = 0;
   DesAnt = 0; HasAnt = 0;
   Comodin = ""; Comodin1 = "";
   Modo1 = ""; Modo2 = ""; nReg = 0;

   nPeriodo = 0;
   nDiario  = 0;
   nDocum   = 0;

   aAlfa = ""; aAlfa1 = "";

   fAntVto = @;
   Flag = 0;

   nSecuenciaAnt = 0;

{-1}menu  = "";
    menu1 = "2400";
    menu2 = "1";
    menu3 = "";
    menu4 = "CSAPUILMOZ";
    menu5 = " Clave ";
    menu6 = " Sig. ";
    menu7 = " Ant. ";
    menu8 = " Primera ";
    menu9 = " Ultima ";
    menu10 = " Imprimir ";
    menu11 = " Lineas ";
    menu12 = " Modificar ";
    menu13 = " mOneda ";
    menu14 = " traZabil ";

{-1}menul  = "";
    menul1 = "2400";
    menul2 = "1";
    menul3 = "";
    menul4 = "CSAPUILMOZg";
    menul5 = " Clave ";
    menul6 = " Sig. ";
    menul7 = " Ant. ";
    menul8 = " Primera ";
    menul9 = " Ultima ";
    menul10 = " Imprimir ";
    menul11 = " Lineas ";
    menul12 = " Modificar ";
    menul13 = " mOneda ";
    menul14 = " traZabil ";
    menul15 = " Agrupados ";

    nDocEnt = 0; nLinEnt = 0;
    nDocRec = 0; nLinRec = 0;

    nSwCont = 0;
    nSwPasa = 0;
    fFechaMovAnt = @;
    nNumDoc = 0;
    nSwReEnlaza = 0;

    &eaCta     = "";
    &eaPais    = "";
    &eaIBAN    = "";
    &eaIBANant = "";
    &enAltaCli = 0;
|FIN;

|RUTINA inf;
   #dscam009#14 = #dscam008#40;
   #dscam009#3 = 1;
|FRUT;

|RUTINA sup;
   #dscam009#14 = #dscam008#40;
   #dscam009#3 = 99;
|FRUT;

|RUTINA inf1;
   #dscam025#0 = 1;
|FRUT;

|RUTINA sup1;
   #dscam025#0 = 99;
|FRUT;

|PROCESO PideClave;
  |ENCAMPO #40#dscam008;
  |SI SwClave = 1; FSalida = 0; |FINSI;
  |SI FSalida ! 0; |Y FSalida ! 6; |Y FSalida ! 11; SwError = 1; |ACABA; |FINSI;
|FPRC;

|PROCESO CuentaPags;
   nCuentaPags = nCuentaPags + 1;
|FPRC;

|DEFBUCLE CuentaPags;
#dscam009#3;
5;
nCodigo,aOper;
nCodigo,aOper;
;
NULL,CuentaPags;
|FIN;

|PROCESO Agrupados;
   |DDEFECTO #dscam025;
   #dscam025#0 = Linea;  Linea = Linea + 1;
   #dscam025#1 = #dscam008#40;
   #dscam025#2 = #dscam008#31;
   #dscam025#3 = #dscam008#3;
   |GRABA 020#dscam025.n;
|FPRC;

|DEFBUCLE Agrupados;
#dscam008#1;
41;
000000001,Documento;
999999999,Documento;
;
NULL,Agrupados;
|FIN;

|PROCESO MiraVtosConf;
   nReg = nReg + 1;
|FPRC;

|DEFBUCLE MiraVtosConf;
#dscam050#1;
34;
#dscam049#0,001,fFecha;
#dscam049#0,999,fFecha;
;
NULL,MiraVtosConf;
|FIN;

|PROCESO TieneEnlace;
     nSwNoSigue = 0;

     |ABRE #dscam030;
     #dscam030#0 = #dscam067#10;
     |LEE 000#dscam030.=;
     |SI FSalida = 0;
          eaDirConta  = #dscam030#6; |QBF eaDirConta;
          eaEmpContab = (("00000" + #dscam067#8) % -105) + #dscam067#9;
          efFecha     = #dscam067#5; |HAZ CompruebaEmpContable;
          |SI enSwError = -1;
             |SI ModoEntrada ! 2; |O Flag < 0;
                |MENAV "    Error. Empresa contable cerrada o inexistente. No se efectuara la operacion";
             |FINSI;
             nSwNoSigue = 1;
          |FINSI;
          |SI enSwError = -2; |Y nSwNoSigue = 0;
             |SI ModoEntrada ! 2; |O Flag < 0;
                |MENAV "    No se encuentra el fichero de asientos de contabilidad.";
             |FINSI;
             nSwNoSigue = 1;
          |FINSI;
          |SI enSwError = -3; |Y nSwNoSigue = 0;
             |SI ModoEntrada ! 2; |O Flag < 0;
                |MENAV "    Error. No se encuentra el fichero de empresas contables. No se efectuara la operacion";
             |FINSI;
             nSwNoSigue = 1;
          |FINSI;
          |SI enSwError = -4; |Y nSwNoSigue = 0;
             |SI ModoEntrada ! 2; |O Flag < 0;
                aAlfa = "    Error. La empresa contable tiene bloqueo con fecha " + efFecha + ". No se efectuara la operacion";
             |FINSI;
             |MENAV aAlfa;
             nSwNoSigue = 1;
          |FINSI;
     |FINSI;
     |CIERRA #dscam030;
|FPRC;

|PROCESO Actual; |TIPO 2;
    Flag = 0 +. 1;
   |SI #dscam009#39 = 1;
      |SI Flag < 0;
         |MENAV "    Movimiento externo marcado para no modificar ni eliminar";
      |FINSI;
      |ERROR; |ACABA;
   |FINSI;

   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 1;
      |HAZ EntradaManual; |ACABA;
   |FINSI;

   |SI #dscam009#3 ! UltPago;
      |SI Flag = -1;
         |MENAV "    Las modificaciones deben hacerse por orden cronologico";
      |FINSI;
      |ERROR;
      |ACABA;
   |FINSI;

   enSwError = 0;
   |SI ModoEntrada = 2; |O ModoEntrada = 3;
      |HAZ CheqConta;
      |SI enHayAsto ! 0;
          |HAZ TieneEnlace;
          |SI nSwNoSigue ! 0; |ERROR; |ACABA; |FINSI;
      |FINSI;
   |FINSI;

   eaLlamada = "A";
   |SI #dscam009#5 = "PPA";
      |SI ModoEntrada = 3; |Y #dscam008#74 = "S";
         |MENAV "    No se puede modificar ni borrar el vto.de un pagare de una entrega a cuenta";
         |ERROR; |ACABA;
      |FINSI;

      |ABRE #dscam021; |ABRE #dscam022;
      #dscam021#0 = #dscam008#17;
      |LEE 000#dscam021.=;

      #dscam022#0 = #dscam008#17;
      #dscam022#1 = #dscam008#37;
      |LEE 101#dscam022.=;
      |SI FSalida = 0;
         |SI ModoEntrada = 3;
            eaUsuario = Usuario % 0810;
            eaDescr   = "BAJA PAGO POR PAGARE (" + (("00000" + #dscam008#17) % -105) + "/" + (("000" + #dscam008#37) % -103) + ") DESDE LINEAS DE RECIBOS";
            eaTipoReg = "PA";  eaNumero = ("00000" + #dscam021#0) % -105;
            eaTipoOp  = "B";   enImpAnt = #dscam021#9; enImpAct = #dscam021#9 - #dscam009#8;
            eaFicher  = "dscam021"; eaClave = #dscam021#0;
            |HAZ GrabaAudit;
         |FINSI;
         |SI ModoEntrada = 2; |Y Flag < 0;
            eaUsuario = Usuario % 0810;
            eaDescr   = "MODIFICACION PAGO POR PAGARE (" + (("00000" + #dscam008#17) % -105) + "/" + (("000" + #dscam008#37) % -103) + ") DESDE LINEAS DE RECIBOS";
            eaTipoReg = "PA";  eaNumero = ("00000" + #dscam021#0) % -105;
            eaTipoOp  = "M";   enImpAnt = #dscam021#9;
         |FINSI;

         #dscam008#23 = #dscam008#23 +. #dscam022#7; #dscam008#57 = #dscam008#57 +. #dscam022#19;
         #dscam008#31 = #dscam008#25 - #dscam008#23; #dscam008#58 = #dscam008#56 - #dscam008#57;
         |GRABA 020#dscam008.a;

         #dscam021#5  = #dscam021#5  +. 1;
         #dscam021#9  = #dscam021#9  +. #dscam022#7;
         #dscam021#17 = #dscam021#17 +. #dscam022#19;
         |SI #dscam021#5 = 0;
            |SI ModoEntrada = 3;
               Marca = 0;
               Modo1 = ",B";
               Modo2 = ",B";
            |SINO;
               Marca = 1;
               Modo1 = "";
               Modo2 = "";
            |FINSI;
         |SINO;
            |SI ModoEntrada = 3;
               |BORRA 020#dscam022.a; |LIBERA #dscam022;
            |FINSI;
            |GRABA 020#dscam021.a;
            Marca = 1;
            Modo1 = "";
            Modo2 = "";
         |FINSI;
         |LIBERA #dscam021;

         |SI #dscam051#1 = "S";
            |ABRE #dscam067;
            #dscam067#8 = 0;
            #dscam067#9 = 0;
            #dscam067#0 = "PA";
            #dscam067#1 = #dscam008#17;
            #dscam067#2 = #dscam008#37;
            #dscam067#3 = "V";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
            |PARA; |SI FEstado = 0; |Y Clave1 = #dscam008#17; |HACIENDO;
               |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37; |Y Clave3  = "V";
                  |SAL;
               |FINSI;
               |LEE 000#dscam067.s;
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
            |SIGUE;

            |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37;
             |Y Clave3 = "V";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #3 Comodin;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
               #dscaw013#13 = "dscam022";    #dscaw013#14 = 0;
               #dscaw013#11 = "N";           #dscaw013#12 = 5;
               #dscaw013#5  = #dscam008#17;  #dscaw013#6 = #dscam008#17;
               |GRABA 020#dscaw013.n;

               Comodin = #dscam067#10;
               Comodin = "dscam033.tab;" + Comodin + Modo2 + ",V";
               |LIBERA #dscam008; |CIERRAT #dscam008;
               |LIBERA #dscam009; |CIERRAT #dscam009;
               |LIBERA #dscam022; |CIERRAT #dscam022;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam008; |LEE 101#dscam008.=;
               |ABRET #dscam009; |LEE 101#dscam009.=;
               |ABRET #dscam022; |LEE 101#dscam022.=;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;

            #dscam067#8 = 0;
            #dscam067#9 = 0;
            #dscam067#0 = "PA";
            #dscam067#1 = #dscam008#17;
            #dscam067#2 = #dscam008#37;
            #dscam067#3 = "E";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
            |PARA; |SI FEstado = 0; |Y Clave1 = #dscam008#17; |HACIENDO;
               |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37; |Y Clave3  = "E";
                  |SAL;
               |FINSI;
               |LEE 000#dscam067.s;
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
            |SIGUE;

            |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37;
             |Y Clave3 = "E";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #3 Comodin;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
               #dscaw013#13 = "dscam022";    #dscaw013#14 = 0;
               #dscaw013#11 = "N";           #dscaw013#12 = 5;
               #dscaw013#5  = #dscam008#17;  #dscaw013#6 = #dscam008#17;
               |GRABA 020#dscaw013.n;

               Comodin = #dscam067#10;
               Comodin = "dscam033.tab;" + Comodin + Modo2 + ",E";
               |LIBERA #dscam008; |CIERRAT #dscam008;
               |LIBERA #dscam009; |CIERRAT #dscam009;
               |LIBERA #dscam022; |CIERRAT #dscam022;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam008; |LEE 101#dscam008.=;
               |ABRET #dscam009; |LEE 101#dscam009.=;
               |ABRET #dscam022; |LEE 101#dscam022.=;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;

            |CIERRA #dscam067;
         |SINO;
            |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
         |FINSI;
         |SI ModoEntrada = 2; |Y Flag > 0;
            eaFicher  = "dscam021"; eaClave = #dscam021#0;
            enImpAct = #dscam021#9; |HAZ GrabaAudit;
         |FINSI;
         |SI Marca = 0;
            |BORRA 020#dscam021.a;
            |BORRA 020#dscam022.a; |LIBERA #dscam022;
         |FINSI;
      |FINSI;

      |LIBERA #dscam022; |CIERRA #dscam022;
      |CIERRA #dscam021;
      |SI ModoEntrada = 3;
         |SALVA_FICHA #dscam009;
         |LEE 000#dscam009.a;
         |SI FSalida = 0;
            |SI #dscam009#14 = #dscam008#40;
               #dscam008#26 = #dscam009#6;
            |SINO;
            #dscam008#26 = "01.01.0000";
            |FINSI;
            |LEE 000#dscam009.s;
         |SINO;
            #dscam008#26 = "01.01.0000";
         |FINSI;
         |REPON_FICHA #dscam009;
         #dscam008#73 = "01.01.0000";
      |SINO;
         #dscam008#26 = #dscam009#6;
      |FINSI;
   |FINSI;

   |SI #dscam009#5 = "CAC"; |O #dscam009#5 = "REC";
      |SI ModoEntrada = 2; |Y Flag < 0;
         |MENAV "    No se puede modificar una compensacion de una entrega a cuenta. Proceso cancelado.";
         |ERROR; |ACABA;
      |FINSI;
      |SI #dscam009#5 = "CAC";
         nDocEnt = #dscam009#35; nLinEnt = #dscam009#36;
         nDocRec = #dscam009#14; nLinRec = #dscam009#3;
      |FINSI;
      |SI #dscam009#5 = "REC";
         nDocEnt = #dscam009#14; nLinEnt = #dscam009#3;
         aAlfa = #dscam009#17; |QBF aAlfa;
         aAlfa = aAlfa - "Pago Doc. ";
         nDocRec = aAlfa; nLinRec = -1;

         |SALVA_FICHA #dscam009;
         #dscam009#14 = nDocRec;
         #dscam009#3  = 1;
         |LEE 000#dscam009.];
         |PARA; |SI FSalida = 0; |Y #dscam009#14 = nDocRec; |HACIENDO;
            |SI #dscam009#35 = nDocEnt; |Y #dscam009#36 = nLinEnt;
               nLinRec = #dscam009#3; |SAL;
            |FINSI;
            |LEE 000#dscam009.s;
         |SIGUE;
         |REPON_FICHA #dscam009;
      |FINSI;

      |SALVA_FICHA #dscam009;
      #dscam008#40 = nDocEnt;
      |LEE 101#dscam008.=;
      |SI FSalida = 0;
         #dscam009#14 = nDocEnt;
         #dscam009#3  = nLinEnt;
         |LEE 101#dscam009.=;
         |SI FSalida = 0;
            |SI #dscam051#1 = "S";
               |ABRE #dscam067;
               #dscam067#8 = 0;
               #dscam067#9 = 0;
               #dscam067#0 = "PG";
               #dscam067#1 = nDocEnt;
               #dscam067#2 = nLinEnt;
               #dscam067#3 = "";
               #dscam067#11 = 1;
               |LEE 000#dscam067.];
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
               |PARA; |SI FEstado = 0; |Y Clave1 = nDocEnt; |HACIENDO;
                  |SI FEstado = 0; |Y Clave1 = nDocEnt; |Y Clave2 = nLinEnt; |Y Clave3  = "";
                     |SAL;
                  |FINSI;
                  |LEE 000#dscam067.s;
                  FEstado = FSalida;
                  Clave1 = #dscam067#1; Clave2 = #dscam067#2;
                  Clave3 = #dscam067#3; |QBF Clave3;
               |SIGUE;

               |SI FEstado = 0; |Y Clave1 = nDocEnt; |Y Clave2 = nLinEnt;
                |Y Clave3  = "";
                  Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
                  |NOME_DAT #3 Comodin;
                  |DELINDEX #dscaw013; |ABRE #dscaw013;
                  |DDEFECTO #dscaw013;
                  #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
                  #dscaw013#13 = "dscam009";    #dscaw013#14 = 14;
                  #dscaw013#11 = "N";           #dscaw013#12 = 9;
                  #dscaw013#5  = nDocEnt;       #dscaw013#6 = nDocEnt;
                  |GRABA 020#dscaw013.n;

                  |DDEFECTO #dscaw013;
                  #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 2;
                  #dscaw013#13 = "dscam009";    #dscaw013#14 = 3;
                  #dscaw013#11 = "N";           #dscaw013#12 = 2;
                  #dscaw013#5  = nLinEnt;       #dscaw013#6 = nLinEnt;
                  |GRABA 020#dscaw013.n;

                  Comodin = #dscam067#10;
                  Comodin = "dscam033.tab;" + Comodin + ",B";
                  |LIBERA #dscam008; |CIERRAT #dscam008;
                  |LIBERA #dscam009; |CIERRAT #dscam009;
                  |LIBERA #dscam047; |CIERRAT #dscam047;
                  |SUB_EJECUTA_NP Comodin;
                  |ABRET #dscam008; |LEE 101#dscam008.=;
                  |ABRET #dscam009; |LEE 101#dscam009.=;
                  |ABRET #dscam047; |LEE 101#dscam047.=;
                  |BORRA 020#dscam067.a;

                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
               |FINSI;
               |CIERRA #dscam067;
            |FINSI;

            #dscam008#23 = #dscam008#23 - #dscam009#8; #dscam008#57 = #dscam008#57 - #dscam009#21;
            #dscam008#31 = #dscam008#31 + #dscam009#8; #dscam008#58 = #dscam008#58 + #dscam009#21;
            |SI #dscam008#23 = #dscam008#25;
               #dscam008#14 = "e";
               #dscam008#15 = "Pendiente de compensar";
            |SINO;
               #dscam008#14 = "H";
               #dscam008#15 = "Parcialmente compensada";
            |FINSI;
            |GRABA 020#dscam008.a; |LIBERA #dscam008;
            |BORRA 020#dscam009.a; |LIBERA #dscam009;
         |FINSI;
      |FINSI;

      #dscam008#40 = nDocRec;
      |LEE 101#dscam008.=;
      |SI FSalida = 0;
         #dscam009#14 = nDocRec;
         #dscam009#3  = nLinRec;
         |LEE 101#dscam009.=;
         |SI FSalida = 0;
            |SI #dscam051#1 = "S";
               |ABRE #dscam067;
               #dscam067#8 = 0;
               #dscam067#9 = 0;
               #dscam067#0 = "PG";
               #dscam067#1 = nDocRec;
               #dscam067#2 = nLinRec;
               #dscam067#3 = "";
               #dscam067#11 = 1;
               |LEE 000#dscam067.];
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
               |PARA; |SI FEstado = 0; |Y Clave1 = nDocRec; |HACIENDO;
                  |SI FEstado = 0; |Y Clave1 = nDocRec; |Y Clave2 = nLinRec; |Y Clave3  = "";
                     |SAL;
                  |FINSI;
                  |LEE 000#dscam067.s;
                  FEstado = FSalida;
                  Clave1 = #dscam067#1; Clave2 = #dscam067#2;
                  Clave3 = #dscam067#3; |QBF Clave3;
               |SIGUE;

               |SI FEstado = 0; |Y Clave1 = nDocRec; |Y Clave2 = nLinRec;
                |Y Clave3  = "";
                  Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
                  |NOME_DAT #3 Comodin;
                  |DELINDEX #dscaw013; |ABRE #dscaw013;
                  |DDEFECTO #dscaw013;
                  #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
                  #dscaw013#13 = "dscam009";    #dscaw013#14 = 14;
                  #dscaw013#11 = "N";           #dscaw013#12 = 9;
                  #dscaw013#5  = nDocRec;       #dscaw013#6 = nDocRec;
                  |GRABA 020#dscaw013.n;

                  |DDEFECTO #dscaw013;
                  #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 2;
                  #dscaw013#13 = "dscam009";    #dscaw013#14 = 3;
                  #dscaw013#11 = "N";           #dscaw013#12 = 2;
                  #dscaw013#5  = nLinRec;       #dscaw013#6 = nLinRec;
                  |GRABA 020#dscaw013.n;

                  Comodin = #dscam067#10;
                  Comodin = "dscam033.tab;" + Comodin + ",B";
                  |LIBERA #dscam008; |CIERRAT #dscam008;
                  |LIBERA #dscam009; |CIERRAT #dscam009;
                  |LIBERA #dscam047; |CIERRAT #dscam047;
                  |SUB_EJECUTA_NP Comodin;
                  |ABRET #dscam008; |LEE 101#dscam008.=;
                  |ABRET #dscam009; |LEE 101#dscam009.=;
                  |ABRET #dscam047; |LEE 101#dscam047.=;
                  |BORRA 020#dscam067.a;

                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
                  |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
               |FINSI;
               |CIERRA #dscam067;
            |FINSI;

            #dscam008#62 = #dscam008#62 - #dscam009#26;
            #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55 + #dscam008#62;
            #dscam008#23 = #dscam008#23 - #dscam009#8; #dscam008#57 = #dscam008#57 - #dscam009#21;
            #dscam008#31 = #dscam008#25 - #dscam008#23; #dscam008#58 = #dscam008#56 - #dscam008#57;
            |SI #dscam008#31 = 0;
               #dscam008#14 = "L";
               #dscam008#15 = "Recibo liquidado";
            |SINO;
               |SI #dscam008#23 = 0;
                  #dscam008#14 = "P";
                  #dscam008#15 = "Pendiente de pago";
               |SINO;
                  #dscam008#14 = "C";
                  #dscam008#15 = "Parcialmente pagado";
               |FINSI;
            |FINSI;
            |GRABA 020#dscam008.a; |LIBERA #dscam008;
            |BORRA 020#dscam009.a; |LIBERA #dscam009;
         |FINSI;
      |FINSI;
      |REPON_FICHA #dscam009;
      |SI #dscam009#5 = "REC";
         #dscam008#40 = nDocEnt;
         |LEE 000#dscam008.=;
      |FINSI;
      |ACABA;
   |FINSI;

   |SI #dscam009#5 = "RAC";
      |SI ModoEntrada = 2;
         |SI Flag < 0;
            |MENAV "    No se puede modificar la entrada de una entrega a cuenta. Proceso cancelado.";
         |FINSI;
         |ERROR; |ACABA;
      |FINSI;

      |SALVA_FICHA #dscam009;
      |LEE 000#dscam009.s;
      |SI FSalida = 0; |Y #dscam009#14 = #dscam008#40;
         |MENAV "    No se puede dar de baja la entrega porque hay movimientos ademas de la entrada";
         |REPON_FICHA #dscam009;
         |ERROR; |ACABA;
      |FINSI;
      |REPON_FICHA #dscam009;

      |SI #dscam008#14 ! "e";
         |MENAV "    La entrega a cuenta no está pendiente de compensar. Proceso cancelado.";
         |ERROR; |ACABA;
      |FINSI;
      |SI #dscam008#17 ! 0;
         |MENAV "    La entrega a cuenta no es en efectivo. Proceso cancelado.";
         |ERROR; |ACABA;
      |FINSI;
      aAlfa = "    NLa entrega a cuenta se dará de baja por completo. " + &191 + " Conforme ?";
      |CONFI aAlfa;
      |SI FSalida = 0;
         |SI #dscam051#1 = "S";
            |ABRE #dscam067;
            #dscam067#8 = 0;
            #dscam067#9 = 0;
            #dscam067#0 = "PG";
            #dscam067#1 = #dscam009#14;
            #dscam067#2 = #dscam009#3;
            #dscam067#3 = "";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
            |PARA; |SI FEstado = 0; |Y Clave1 = #dscam009#14; |HACIENDO;
               |SI FEstado = 0; |Y Clave1 = #dscam009#14; |Y Clave2 = #dscam009#3; |Y Clave3  = "";
                  |SAL;
               |FINSI;
               |LEE 000#dscam067.s;
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
            |SIGUE;

            |SI FEstado = 0; |Y Clave1 = #dscam009#14; |Y Clave2 = #dscam009#3;
             |Y Clave3  = "";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #3 Comodin;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
               #dscaw013#13 = "dscam009";    #dscaw013#14 = 14;
               #dscaw013#11 = "N";           #dscaw013#12 = 9;
               #dscaw013#5  = #dscam009#14;  #dscaw013#6 = #dscam009#14;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 2;
               #dscaw013#13 = "dscam009";    #dscaw013#14 = 3;
               #dscaw013#11 = "N";           #dscaw013#12 = 2;
               #dscaw013#5  = #dscam009#3;   #dscaw013#6 = #dscam009#3;
               |GRABA 020#dscaw013.n;

               Comodin = #dscam067#10;
               Comodin = "dscam033.tab;" + Comodin + ",B";
               |LIBERA #dscam008; |CIERRAT #dscam008;
               |LIBERA #dscam009; |CIERRAT #dscam009;
               |LIBERA #dscam047; |CIERRAT #dscam047;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam008; |LEE 101#dscam008.=;
               |ABRET #dscam009; |LEE 101#dscam009.=;
               |ABRET #dscam047; |LEE 101#dscam047.=;
               |BORRA 020#dscam067.a;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;
            |CIERRA #dscam067;
         |SINO;
            |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
         |FINSI;

         |LIBERA #dscam008;
         |DDEF aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "dscam008.mas";
         |CARGA_DEF aAlfa, RecibCmp@;
         |SI FSalida = 0;
            |ABRE #RecibCmp@;
            #RecibCmp@#40 = #dscam008#40;
            |LEE 101#RecibCmp@.=;
            |SI FSalida = 0;
               |BORRA 020#RecibCmp@.a; |LIBERA #RecibCmp@;
            |FINSI;
            |CIERRA #RecibCmp@; |DESCARGA_DEF #RecibCmp@;
         |FINSI;
         |LEE 000#dscam008.s;
         |SI FSalida ! 0;
            |LEE 000#dscam008.u;
         |FINSI;
         |SI ModoEntrada = 3;
              aAlfa = #dscam009#4; |QBF aAlfa; aAlfa = aAlfa % 0103;
              |HAZ EsLuxe;
              |SI FSalida = 0; |Y #dscam009#37 = "S"; |Y aAlfa = "570";
                  |HAZ BajaCajaLuxe;
              |FINSI;
         |FINSI;
         |ACABA;
      |SINO;
         |MENAV "    Proceso cancelado.";
         |ERROR; |ACABA;
      |FINSI;
   |FINSI;

   |SI #dscam009#5 = "PDM";
      |SI ModoEntrada = 2;
         |SI Flag < 0;
            |MENAV "    No se puede modificar el vencimiento de un pago domiciliado.";
         |FINSI;
         |ERROR; |ACABA;
      |FINSI;

      nSw = 0;
      |SI #dscam009#33 = 1;
         || Busco el ultimo n§ de secuencia y dependiendo del apunte en el
         ||    que este este movimiento, marco este y el resto con el n§ de
         ||    secuencia recogido. En caso de que tenga asiento. Si no lo
         ||    tiene, no hay que hacer las comprobaciones de rehacer/borrar
         ||    el asiento ni los mecanismos que conlleva
         |SALVA_FICHA #dscam009;
         |SELECT #3#dscam009;
         |LEE 000#dscam009.u;
         nNumSec = #dscam009#33 + 1;
         |SELECT #1#dscam009;
         |REPON_FICHA #dscam009;

         |SALVA_FICHA #dscam009;
         |ABRE #dscam067; |ABRE #dscam096;
         #dscam067#8 = 0;
         #dscam067#9 = 0;
         #dscam067#0 = "PD";
         #dscam067#1 = #dscam008#17;
         #dscam067#2 = #dscam008#37;
         #dscam067#3 = "V";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |PARA; |SI FEstado = 0; |Y Clave1 = #dscam008#17; |HACIENDO;
            |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37; |Y Clave3  = "V";
               |SAL;
            |FINSI;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
         |SIGUE;
         |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37;
          |Y Clave3 = "V";
            nEmpresa = #dscam067#8; nPeriodo = #dscam067#9; nDiario  = #dscam067#4;
            fFecha   = #dscam067#5; nDocum   = #dscam067#6;
            |SELECT #2#dscam067;
            #dscam067#7 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            |PARA; |SI FEstado = 0; |Y nEmpresa = #dscam067#8; |Y nPeriodo = #dscam067#9;
             |Y nDiario = #dscam067#4; |Y fFecha = #dscam067#5; |Y nDocum = #dscam067#6; |HACIENDO;
               #dscam096#0 = #dscam067#1;
               #dscam096#1 = #dscam067#2;
               |LEE 101#dscam096.=;
               |SI FSalida = 0;
                  #dscam096#35 = nNumSec;
                  |GRABA 020#dscam096.a; |LIBERA #dscam096;

                  #dscam009#14 = #dscam096#16;
                  #dscam009#3 = #dscam096#17;
                  |LEE 101#dscam009.=;
                  |SI FSalida = 0;
                     #dscam009#33 = nNumSec;
                     |GRABA 020#dscam009.a; |LIBERA #dscam009;
                  |FINSI;
               |FINSI;
               |LEE 000#dscam067.s;
               FEstado = FSalida;
            |SIGUE;
            |SELECT #1#dscam067;
         |FINSI;
         |CIERRA #dscam067; |CIERRA #dscam096;
         |REPON_FICHA #dscam009;
         |LEE 000#dscam009.=;
      |FINSI;

      |ABRE #dscam029;
      |SELECT #3#dscam029;
      #dscam029#1 = "dscam096";
      #dscam029#2 = 35;
      #dscam029#4 = "PD";
      |LEE 000#dscam029.=;
      |SI FSalida ! 0;
         |SELECT #1#dscam029;
         |LEE 000#dscam029.u;
         nSw = #dscam029#0 + 1;
         |DDEFECTO #dscam029;
         #dscam029#0 = nSw;
         #dscam029#1 = "dscam096";
         #dscam029#2 = 35;
         #dscam029#3 = "Numero de secuencia";
         #dscam029#4 = "PD";
         #dscam029#5 = "D";
         |GRABA 020#dscam029.n;
      |FINSI;

      #dscam029#1 = "dscam096";
      #dscam029#2 = 16;
      #dscam029#4 = "PD";
      |LEE 000#dscam029.=;
      |SI FSalida ! 0;
         |SELECT #1#dscam029;
         |LEE 000#dscam029.u;
         nSw = #dscam029#0 + 1;
         |DDEFECTO #dscam029;
         #dscam029#0 = nSw;
         #dscam029#1 = "dscam096";
         #dscam029#2 = 16;
         #dscam029#3 = "Numero documento";
         #dscam029#4 = "PD";
         #dscam029#5 = "D";
         |GRABA 020#dscam029.n;
      |FINSI;
      |SELECT #1#dscam029;
      |CIERRA #dscam029;

      |ABRE #dscam095; |ABRE #dscam096;
      #dscam095#0 = #dscam008#17;
      |LEE 101#dscam095.=;
      |SI FSalida = 0;
         #dscam096#0 = #dscam008#17;
         #dscam096#1 = #dscam008#37;
         |LEE 101#dscam096.=;
         |SI FSalida = 0;
            eaUsuario = Usuario % 0810;
            eaDescr   = "BAJA PAGO DOMICILIADO (" + (("00000" + #dscam008#17) % -105) + "/" + (("000" + #dscam008#37) % -103) + ") DESDE LINEAS DE RECIBOS";
            eaTipoReg = "PD";  eaNumero = ("00000" + #dscam021#0) % -105;
            eaTipoOp  = "B";   enImpAnt = #dscam021#9; enImpAct = #dscam021#9 - #dscam009#8;
            |HAZ GrabaAudit;

            #dscam008#23 = #dscam008#23 +. #dscam096#22; #dscam008#57 = #dscam008#57 +. #dscam096#7;
            #dscam008#31 = #dscam008#25 - #dscam008#23; #dscam008#58 = #dscam008#56 - #dscam008#57;
            #dscam008#14 = "E";
            #dscam008#15 = "Englobado Rel.Pagos Domiciliados";
            |GRABA 020#dscam008.a;

            nNumSec = #dscam096#35;
            #dscam096#15 = "N"; #dscam096#35 = 0;
            #dscam096#17 = 0;
            |GRABA 020#dscam096.a; |LIBERA #dscam096;

            nSw = 0;
            #dscam096#0 = #dscam095#0;
            #dscam096#1 = 1;
            |LEE 000#dscam096.];
            |PARA; |SI FSalida = 0; |Y #dscam096#0 = #dscam095#0; |HACIENDO;
               |SI #dscam096#15 = "S"; nSw = 1; |FINSI;
               |LEE 000#dscam096.s;
            |SIGUE;
            |SI nSw = 0;
               #dscam095#9 = "N"; |GRABA 020#dscam095.a;
            |FINSI;

            |SALVA_FICHA #dscam009;
            |SELECT #3#dscam009;
            nSw = 0;
            #dscam009#33 = nNumSec;
            |LEE 000#dscam009.=;
            |PARA; |SI FSalida = 0; |Y #dscam009#33 = nNumSec; |HACIENDO;
               nSw = nSw + 1;
               |LEE 000#dscam009.s;
            |SIGUE;
            |SELECT #1#dscam009;
            |REPON_FICHA #dscam009;

            |SI nSw > 1;
               aMarca = "";
            |SINO;
               aMarca = ",B";
            |FINSI;
         |FINSI;

         |SI #dscam051#1 = "S";
            |ABRE #dscam067;
            #dscam067#8 = 0;
            #dscam067#9 = 0;
            #dscam067#0 = "PD";
            #dscam067#1 = #dscam008#17;
            #dscam067#2 = #dscam008#37;
            #dscam067#3 = "V";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
            |PARA; |SI FEstado = 0; |Y Clave1 = #dscam008#17; |HACIENDO;
               |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37; |Y Clave3  = "V";
                  |SAL;
               |FINSI;
               |LEE 000#dscam067.s;
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
            |SIGUE;

            |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37;
             |Y Clave3 = "V";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #3 Comodin;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
               #dscaw013#13 = "dscam096";    #dscaw013#14 = 0;
               #dscaw013#11 = "N";           #dscaw013#12 = 5;
               #dscaw013#5  = #dscam008#17;  #dscaw013#6 = #dscam008#17;
               |GRABA 020#dscaw013.n;

               |SI aMarca = "";
                  |DDEFECTO #dscaw013;
                  #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 2;
                  #dscaw013#13 = "dscam096";    #dscaw013#14 = 35;
                  #dscaw013#11 = "N";           #dscaw013#12 = 5;
                  #dscaw013#5  = #dscam009#33;  #dscaw013#6 = #dscam009#33;
                  |GRABA 020#dscaw013.n;
               |SINO;
                  |DDEFECTO #dscaw013;
                  #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 2;
                  #dscaw013#13 = "dscam096";    #dscaw013#14 = 16;
                  #dscaw013#11 = "N";           #dscaw013#12 = 9;
                  #dscaw013#5  = #dscam009#14;  #dscaw013#6 = #dscam009#14;
                  |GRABA 020#dscaw013.n;
               |FINSI;

               |SI ModoEntrada = 3; |Y nSw > 1;
                  |SALVA_DATOS #dscam009;
                  |BORRA 020#dscam009.a;
                  |BORRA 020#dscam067.a;
               |FINSI;

               Comodin = #dscam067#10;
               Comodin = "dscam033.tab;" + Comodin + aMarca + ",V" + #dscam067#5;
               |LIBERA #dscam008; |CIERRAT #dscam008;
               |LIBERA #dscam009; |CIERRAT #dscam009;
               |LIBERA #dscam095; |CIERRAT #dscam095;
               |LIBERA #dscam096; |CIERRAT #dscam096;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam008; |LEE 101#dscam008.=;
               |ABRET #dscam009; |LEE 101#dscam009.=;
               |ABRET #dscam095; |LEE 101#dscam095.=;
               |ABRET #dscam096; |LEE 101#dscam096.=;

               |SI ModoEntrada = 3; |Y nSw > 1;
                  |REPON_DATOS #dscam009;
                  |GRABA 020#dscam009.c;
               |FINSI;
            |FINSI;

            |CIERRA #dscam067;
         |SINO;
            |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
         |FINSI;
      |FINSI;

      |LIBERA #dscam096; |CIERRA #dscam096;
      |LIBERA #dscam095; |CIERRA #dscam095;
      |SI ModoEntrada = 3;
         |SALVA_FICHA #dscam009;
         |LEE 000#dscam009.a;
         |SI FSalida = 0;
            |SI #dscam009#14 = #dscam008#40;
               #dscam008#26 = #dscam009#6;
            |SINO;
            #dscam008#26 = "01.01.0000";
            |FINSI;
            |LEE 000#dscam009.s;
         |SINO;
            #dscam008#26 = "01.01.0000";
         |FINSI;
         |REPON_FICHA #dscam009;
      |SINO;
         #dscam008#26 = #dscam009#6;
      |FINSI;
      |ACABA;
   |FINSI;

   |SI #dscam009#5 = "PTA";
      |ABRE #dscam047; |ABRE #dscam046;
      #dscam046#0 = #dscam008#17;
      |LEE 101#dscam046.=;

      #dscam047#0 = #dscam008#17;
      #dscam047#1 = #dscam008#37;
      |LEE 101#dscam047.=;
      |SI FSalida = 0;
         |SI ModoEntrada = 3;
            eaUsuario = Usuario % 0810;
            eaDescr   = "BAJA PAGO POR TALON (" + (("00000" + #dscam008#17) % -105) + "/" + (("000" + #dscam008#37) % -103) + ") DESDE LINEAS DE RECIBOS";
            eaTipoReg = "TA";  eaNumero = ("00000" + #dscam046#0) % -105;
            eaTipoOp  = "B";   enImpAnt = #dscam046#9; enImpAct = #dscam046#9 - #dscam009#8;
            eaFicher  = "dscam046"; eaClave = #dscam046#0;
            |HAZ GrabaAudit;
         |FINSI;
         |SI ModoEntrada = 2; |Y Flag < 0;
            eaUsuario = Usuario % 0810;
            eaDescr   = "MODIFICACION PAGO POR TALON (" + (("00000" + #dscam008#17) % -105) + "/" + (("000" + #dscam008#37) % -103) + ") DESDE LINEAS DE RECIBOS";
            eaTipoReg = "TA";  eaNumero = ("00000" + #dscam046#0) % -105;
            eaTipoOp  = "M";   enImpAnt = #dscam046#9;
         |FINSI;

         #dscam046#5  = #dscam046#5  +. 1;
         #dscam046#9  = #dscam046#9  +. #dscam047#7;
         #dscam046#17 = #dscam046#17 +. #dscam047#19;
         |SI #dscam046#5 = 0;
            Marca = 0;
            Modo1 = ",B";
            Modo2 = ",B";
         |SINO;
            |GRABA 020#dscam046.a;
            |SI ModoEntrada = 3; |BORRA 020#dscam047.a; |DDEFECTO #dscam047; |FINSI;
            Marca = 1;
            Modo1 = "";
            Modo2 = "";
         |FINSI;
         |LIBERA #dscam046

         |SI #dscam051#1 = "S";
            |ABRE #dscam067;
            #dscam067#8 = 0;
            #dscam067#9 = 0;
            #dscam067#0 = "TA";
            #dscam067#1 = #dscam008#17;
            #dscam067#2 = #dscam008#37;
            #dscam067#3 = "";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
            |PARA; |SI FEstado = 0; |Y Clave1 = #dscam008#17; |HACIENDO;
               |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37; |Y Clave3  = "";
                  |SAL;
               |FINSI;
               |LEE 000#dscam067.s;
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
            |SIGUE;

            |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37;
             |Y Clave3  = "";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #3 Comodin;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
               #dscaw013#13 = "dscam047";    #dscaw013#14 = 0;
               #dscaw013#11 = "N";           #dscaw013#12 = 5;
               #dscaw013#5  = #dscam008#17;  #dscaw013#6 = #dscam008#17;
               |GRABA 020#dscaw013.n;

               Comodin = #dscam067#10;
               Comodin = "dscam033.tab;" + Comodin + Modo2 + ",E";
               |LIBERA #dscam008; |CIERRAT #dscam008;
               |LIBERA #dscam009; |CIERRAT #dscam009;
               |LIBERA #dscam047; |CIERRAT #dscam047;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam008; |LEE 101#dscam008.=;
               |ABRET #dscam009; |LEE 101#dscam009.=;
               |ABRET #dscam047; |LEE 101#dscam047.=;
               |SI Modo2 = ",B"; |BORRA 020#dscam067.a; |FINSI;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;
            |CIERRA #dscam067;
         |SINO;
            |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
         |FINSI;
         |SI ModoEntrada = 2; |Y Flag > 0;
            eaFicher  = "dscam046"; eaClave = #dscam046#0;
            enImpAct = #dscam046#9; |HAZ GrabaAudit;
         |FINSI;
         |SI Marca = 0;
            |BORRA 020#dscam046.a;
            |BORRA 020#dscam047.a; |DDEFECTO #dscam047;
         |FINSI;
      |FINSI;

      |LIBERA #dscam047;
      |CIERRA #dscam047;
      #dscam008#23 = #dscam008#23 +. #dscam009#8;  #dscam008#57 = #dscam008#57 +. #dscam009#21;
      #dscam008#24 = #dscam008#24 +. #dscam009#11; #dscam008#54 = #dscam008#54 +. #dscam009#23;
      #dscam008#38 = #dscam008#38 +. #dscam009#12; #dscam008#55 = #dscam008#55 +. #dscam009#24;
      #dscam008#62 = #dscam008#62 +. #dscam009#26;
      #dscam008#31 = #dscam008#25 - #dscam008#23;  #dscam008#58 = #dscam008#56 - #dscam008#57;
      |PINTA #dscam008#23; |PINTA #dscam008#24; |PINTA #dscam008#38;
      |PINTA #dscam008#57; |PINTA #dscam008#54; |PINTA #dscam008#55;
      |PINTA #dscam008#62; |PINTA #dscam008#58;
      |SI ModoEntrada = 3;
         |LEE 000#dscam009.a;
         |SI FSalida = 0;
            |SI #dscam009#14 = #dscam008#40;
               #dscam008#26 = #dscam009#6;
            |SINO;
            #dscam008#26 = "01.01.0000";
            |FINSI;
            |LEE 000#dscam009.s;
         |SINO;
            #dscam008#26 = "01.01.0000";
         |FINSI;
      |SINO;
         #dscam008#26 = #dscam009#6;
      |FINSI;
   |FINSI;

   |SI #dscam009#5 = "RCC";
      |SI ModoEntrada = 3;
         |SALVA_FICHA #dscam009;
         |LEE 000#dscam009.a;
         |SI FSalida = 0; |Y #dscam009#14 = #dscam008#40; |Y #dscam009#5 = "PCF";
            fFechaCob = #dscam009#6;
            nLinMov   = #dscam009#3;
         |FINSI;
         |REPON_FICHA #dscam009;

         |ABRE #dscam050; |SELECT #2#dscam050;
         #dscam050#13 = #dscam008#40;
         #dscam050#14 = nLinMov;
         |LEE 000#dscam050.=;
         |SI FSalida ! 0;
            |MENAV "    No se encuentra la linea de confirming correspondiente a este movimiento";
            |CIERRA #dscam050;
            |ERROR; |ACABA;
         |FINSI;
         |CIERRA #dscam050;

         #dscam008#26 = fFechaCob;
         #dscam008#14 = "L";
         #dscam008#15 = "Recibo liquidado";
         #dscam008#17 = #dscam050#0;
         #dscam008#37 = #dscam050#1;
         #dscam008#39 = "C";
         #dscam008#47 = "Confirme";

         #dscam008#23 = #dscam008#23 + #dscam009#8;
         #dscam008#57 = #dscam008#57 + #dscam009#21;
         |GRABA 020#dscam008.a;

         |SI HayConta = 1;
            |ABRE #dscam067;
            |DDEFECTO #dscam067;
            #dscam067#0 = "CF";
            #dscam067#1 = #dscam008#17;
            #dscam067#2 = #dscam008#37;
            #dscam067#3 = " ";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
            |PARA; |SI FEstado = 0; |Y Clave1 = #dscam008#17; |HACIENDO;
               |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37; |Y Clave3  = "";
                  |SAL;
               |FINSI;
               |LEE 000#dscam067.s;
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
            |SIGUE;

            |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37;
             |Y Clave3 = "";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #3 Comodin;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
               #dscaw013#13 = "dscam050";    #dscaw013#14 = 0;
               #dscaw013#11 = "N";           #dscaw013#12 = 5;
               #dscaw013#5  = #dscam008#17;  #dscaw013#6 = #dscam008#17;
               |GRABA 020#dscaw013.n;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 2;
               #dscaw013#13 = "dscam050";    #dscaw013#14 = 1;
               #dscaw013#11 = "N";           #dscaw013#12 = 3;
               #dscaw013#5  = #dscam008#37;  #dscaw013#6 = #dscam008#37;
               |GRABA 020#dscaw013.n;

               Comodin = #dscam067#10;
               Comodin = "dscam033.tab;" + Comodin + ",B";
               |CIERRAT #dscam008; |LIBERA #dscam008;
               |CIERRAT #dscam009; |LIBERA #dscam009;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam008; |LEE 101#dscam008.=;
               |ABRET #dscam009; |LEE 101#dscam009.=;
               |LEE 000#dscam067.=;
               |SI FSalida = 0; |BORRA 020#dscam067.a; |FINSI;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;
            |CIERRA #dscam067;
         |FINSI;
      |SINO;
          |ERROR;
      |FINSI;
   |FINSI;

   |SI #dscam009#5 = "PCF";
      |ABRE #dscam050; |ABRE #dscam049;
      #dscam050#0 = #dscam008#17;
      #dscam050#1 = #dscam008#37;
      |LEE 101#dscam050.=;
      |SI FSalida = 0;
         fFecha = #dscam050#34;
         #dscam049#0 = #dscam008#17;
         |LEE 101#dscam049.=;
         #dscam050#12 = "N";
         |GRABA 020#dscam050.a;
      |FINSI;
      #dscam008#23 = #dscam008#23 +. #dscam009#8;  #dscam008#57 = #dscam008#57 +. #dscam009#21;
      #dscam008#24 = #dscam008#24 +. #dscam009#11; #dscam008#54 = #dscam008#54 +. #dscam009#23;
      #dscam008#38 = #dscam008#38 +. #dscam009#12; #dscam008#55 = #dscam008#55 +. #dscam009#24;
      #dscam008#62 = #dscam008#62 +. #dscam009#26;
      #dscam008#31 = #dscam008#25 - #dscam008#23;  #dscam008#58 = #dscam008#56 - #dscam008#57;
      |PINTA #dscam008#23; |PINTA #dscam008#24; |PINTA #dscam008#38;
      |PINTA #dscam008#57; |PINTA #dscam008#54; |PINTA #dscam008#55;
      |PINTA #dscam008#62; |PINTA #dscam008#58;
      |SI #dscam008#48 = "S";
         #dscam008#48 = "N";
      |FINSI;
      |GRABA 020#dscam008.a;

      #dscam049#9  = #dscam049#9  +. #dscam050#7;
      #dscam049#19 = #dscam049#19 +. #dscam050#20;
      |SI #dscam049#9 = 0; |Y #dscam049#19 = 0;
         |SI ModoEntrada = 3;
            Modo1 = ",B";
         |SINO;
            |GRABA 020#dscam049.a;
            Modo1 = ",M";
         |FINSI;
      |SINO;
         |GRABA 020#dscam049.a;
         Modo1 = ",M";
      |FINSI;
      |SI ModoEntrada = 3; |Y Modo1 ! ",B";
         |SALVA_FICHA #dscam050;
         nReg = 0; |BUCLE MiraVtosConf;
         |REPON_FICHA #dscam050;
         |SI nReg = 1;
            |ABRE #dscam067;
            |DDEFECTO #dscam067;
            #dscam067#0 = "CF";
            #dscam067#1 = #dscam008#17;
            #dscam067#2 = #dscam008#37;
            #dscam067#3 = "V";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
            |PARA; |SI FEstado = 0; |Y Clave1 = #dscam008#17; |HACIENDO;
               |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37; |Y Clave3  = "V";
                  |SAL;
               |FINSI;
               |LEE 000#dscam067.s;
               FEstado = FSalida;
               Clave1 = #dscam067#1; Clave2 = #dscam067#2;
               Clave3 = #dscam067#3; |QBF Clave3;
            |SIGUE;

            |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37;
             |Y Clave3 = "V";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #3 Comodin;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
               #dscaw013#13 = "dscam050";    #dscaw013#14 = 0;
               #dscaw013#11 = "N";           #dscaw013#12 = 5;
               #dscaw013#5  = #dscam008#17;  #dscaw013#6 = #dscam008#17;
               |GRABA 020#dscaw013.n;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 2;
               #dscaw013#13 = "dscam050";    #dscaw013#14 = 34;
               #dscaw013#11 = "F";           #dscaw013#12 = 10;
               #dscaw013#7  = fFecha;        #dscaw013#8 = fFecha;
               |GRABA 020#dscaw013.n;

               Comodin = #dscam067#10;
               Comodin = "dscam033.tab;" + Comodin + ",B,V" + fFecha;
               |CIERRAT #dscam008; |LIBERA #dscam008;
               |CIERRAT #dscam009; |LIBERA #dscam009;
               |CIERRAT #dscam050; |LIBERA #dscam050;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam008; |LEE 101#dscam008.=;
               |ABRET #dscam009; |LEE 101#dscam009.=;
               |ABRET #dscam050; |LEE 101#dscam050.=;
               |LEE 000#dscam067.=;
               |SI FSalida = 0; |BORRA 020#dscam067.a; |FINSI;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;
            |CIERRA #dscam067;
         |FINSI;
         |BORRA 020#dscam050.a; |LIBERA #dscam050;
      |FINSI;
|| INICIO
      |SI #dscam051#1 = "S";
         |ABRE #dscam067;
         |DDEFECTO #dscam067;
         #dscam067#0 = "CF";
         #dscam067#1 = #dscam008#17;
         #dscam067#2 = #dscam008#37;
         #dscam067#3 = "E";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
         |PARA; |SI FEstado = 0; |Y Clave1 = #dscam008#17; |HACIENDO;
            |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37; |Y Clave3  = "E";
               |SAL;
            |FINSI;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
         |SIGUE;

         |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37;
         |Y Clave3 = "E";
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #3 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
            #dscaw013#13 = "dscam050";    #dscaw013#14 = 0;
            #dscaw013#11 = "N";           #dscaw013#12 = 5;
            #dscaw013#5  = #dscam008#17;  #dscaw013#6 = #dscam008#17;
            |GRABA 020#dscaw013.n;

            Comodin = #dscam067#10;
            Comodin = "dscam033.tab;" + Comodin + Modo1 + ",E";
            |LIBERA #dscam008; |CIERRAT #dscam008;
            |LIBERA #dscam009; |CIERRAT #dscam009;
            |LIBERA #dscam050; |CIERRAT #dscam050;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam008; |LEE 101#dscam008.=;
            |ABRET #dscam009; |LEE 101#dscam009.=;
            |ABRET #dscam050; |LEE 101#dscam050.=;
            |SI Modo2 = ",B"; |BORRA 020#dscam067.a; |FINSI;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;

         |DDEFECTO #dscam067;
         #dscam067#0 = "CF";
         #dscam067#1 = #dscam008#17;
         #dscam067#2 = #dscam008#37;
         #dscam067#3 = "V";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
         |PARA; |SI FEstado = 0; |Y Clave1 = #dscam008#17; |HACIENDO;
            |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37; |Y Clave3  = "V";
               |SAL;
            |FINSI;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
         |SIGUE;

         |SI FEstado = 0; |Y Clave1 = #dscam008#17; |Y Clave2 = #dscam008#37;
          |Y Clave3 = "V";
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #3 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
            #dscaw013#13 = "dscam050";    #dscaw013#14 = 0;
            #dscaw013#11 = "N";           #dscaw013#12 = 5;
            #dscaw013#5  = #dscam008#17;  #dscaw013#6 = #dscam008#17;
            |GRABA 020#dscaw013.n;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 2;
            #dscaw013#13 = "dscam050";    #dscaw013#14 = 34;
            #dscaw013#11 = "F";           #dscaw013#12 = 10;
            #dscaw013#7  = fFecha;        #dscaw013#8 = fFecha;
            |GRABA 020#dscaw013.n;

            Comodin = #dscam067#10;
            Comodin = "dscam033.tab;" + Comodin + Modo1 + ",V" + fFecha;
            |LIBERA #dscam008; |CIERRAT #dscam008;
            |LIBERA #dscam009; |CIERRAT #dscam009;
            |LIBERA #dscam049; |CIERRAT #dscam049;
            |LIBERA #dscam050; |CIERRAT #dscam050;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam008; |LEE 101#dscam008.=;
            |ABRET #dscam009; |LEE 101#dscam009.=;
            |ABRET #dscam049; |LEE 101#dscam049.=;
            |ABRET #dscam050; |LEE 101#dscam050.=;
            |SI Modo2 = ",B"; |BORRA 020#dscam067.a; |FINSI;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
      |SINO;
         |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
      |FINSI;
|| FINAL

      |SI ModoEntrada = 3; |Y Modo1 = ",B";
         |BORRA 020#dscam049.a;
         |BORRA 020#dscam050.a;
      |FINSI;

      |LIBERA #dscam049; |LIBERA #dscam050;
      |CIERRA #dscam049; |CIERRA #dscam050;

      |SI ModoEntrada = 3;
         |LEE 000#dscam009.a;
         |SI FSalida = 0;
            |SI #dscam009#14 = #dscam008#40;
               #dscam008#26 = #dscam009#6;
            |SINO;
            #dscam008#26 = "01.01.0000";
            |FINSI;
            |LEE 000#dscam009.s;
         |SINO;
            #dscam008#26 = "01.01.0000";
         |FINSI;
      |SINO;
         #dscam008#26 = #dscam009#6;
      |FINSI;
   |FINSI;

   |SI #dscam009#5 = "PAG"; |O #dscam009#5 = "PAP";
      #dscam009#19 = "*"; |GRABA 020#dscam009.a;
      |SI ModoEntrada = 3;
         aAlfa = #dscam009#4; |QBF aAlfa; aAlfa = aAlfa % 0103;
         |HAZ EsLuxe;
         |SI FSalida = 0; |Y #dscam009#37 = "S"; |Y aAlfa = "570";
             |HAZ BajaCajaLuxe;
         |FINSI;
      |FINSI;
      |SI #dscam051#1 = "S";
         |ABRE #dscam067;
         |DDEFECTO #dscam067;
         #dscam067#0 = "PG";
         #dscam067#1 = #dscam009#14;
         #dscam067#2 = #dscam009#3;
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         |PARA; |SI FEstado = 0; |Y Clave1 = #dscam009#14; |HACIENDO;
            |SI FEstado = 0; |Y Clave1 = #dscam009#14; |Y Clave2 = #dscam009#3;
               |SAL;
            |FINSI;
            |LEE 000#dscam067.s;
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
         |SIGUE;

         ||SI FEstado = 0; |Y Clave1 = #dscam009#14; |Y Clave2 = #dscam009#3;
         nSwPasa = 0;
         |SI FEstado = 0; |Y Clave1 = #dscam009#14; |Y Clave2 = #dscam009#3; nSwPasa = 1; |FINSI;
         |SI nSwReEnlaza = 1;
            nSwPasa = 1; nSwReEnlaza = 0;
         |FINSI;
         |SI nSwCont = 1;
            nSwPasa = 1; nSwCont = 0;
            |SI fFechaMovAnt ! #dscam009#6;
               |SI FEstado = 0; |Y Clave1 = #dscam009#14; |Y Clave2 = #dscam009#3;
                  |BORRA 020#dscam067.a;
               |FINSI;
               #dscam009#33 = 0;
            |FINSI;
         |FINSI;
         |SI nSwPasa = 1;
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #3 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;
            |SI #dscam009#33 = 0;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
               #dscaw013#13 = "dscam009";   #dscaw013#14 = 14;
               #dscaw013#11 = "N";          #dscaw013#12 = 9;
               #dscaw013#5 = #dscam009#14; #dscaw013#6 = #dscam009#14;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
               #dscaw013#13 = "dscam009";   #dscaw013#14 = 3;
               #dscaw013#11 = "N";          #dscaw013#12 = 3;
               #dscaw013#5 = #dscam009#3; #dscaw013#6 = #dscam009#3;
               |GRABA 020#dscaw013.n;

               |LIBERA #dscaw013; |CIERRA #dscaw013;

               Comodin = #dscam067#10;
               Modo = "";
               |SI ModoEntrada = 3; Modo = ",B"; |FINSI;
               || ABDON 20/05/2013   Tiquet 010028/00808
               || Si no ponia la linea siguiente y para cuando se saliera de
               ||    la modificaci¢n no hubiera puesto el que nSwPasa sea 1
               ||    cuando sea 1 nSwReEnlaza, en caso de cambiar la fecha
               ||    el programa no eliminaba el asiento anterior.
               |SI ModoEntrada = 2; |Y Flag < 0; nSwReEnlaza = 1; Modo = ",B"; |FINSI;

               Comodin = "dscam033.tab;" + Comodin + Modo;
               |GRABA 020#dscam008.a; |GRABA 020#dscam009.a;
               |LIBERA #dscam008; |CIERRAT #dscam008;
               |LIBERA #dscam009; |CIERRAT #dscam009;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam008; |LEE 101#dscam008.=;
               |ABRET #dscam009; |LEE 101#dscam009.=;
            |SINO;
               |SI ModoEntrada = 3;
                  |SALVA_FICHA #dscam009;
                  nCodigo = #dscam009#33;
                  aOper   = #dscam009#5;
                  nCuentaPags = 0;
                  |BUCLE CuentaPags;
                  |LEE 000#dscam009.p; |REPON_FICHA #dscam009;
                  |SI nCuentaPags = 1;
                     Modo = ",B";
                  |SINO;
                     || PUNTO 1
                     || Esto se hace porque si no se borra la linea actual,
                     ||    al hacer el enlace para que las otras lineas de la
                     ||    sesion queden enlazadas, no desaparece este recibo
                     |SALVA_DATOS #dscam009; |BORRA 020#dscam009.a;
                     Modo = "";
                  |FINSI;
               |FINSI;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
               #dscaw013#13 = "dscam009";   #dscaw013#14 = 33;
               #dscaw013#11 = "N";          #dscaw013#12 = 9;
               #dscaw013#5 = #dscam009#33;  #dscaw013#6 = #dscam009#33;
               |GRABA 020#dscaw013.n;

               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
               #dscaw013#13 = "dscam009";   #dscaw013#14 = 5;
               #dscaw013#11 = "A";          #dscaw013#12 = 3;
               #dscaw013#3 = #dscam009#5;  #dscaw013#4 = #dscam009#5;
               |GRABA 020#dscaw013.n;
               |LIBERA #dscaw013; |CIERRA #dscaw013;

               || Si no hago esto el movimiento que estoy modificando no se
               ||     elimina del asiento de secuencia
               |SI Flag < 0; |Y ModoEntrada = 2;
                  nSecuenciaAnt = #dscam009#33;
                  #dscam009#33 = 0; nSwCont = 1;
                  fFechaMovAnt = #dscam009#6;
               |FINSI;
               |GRABA 020#dscam008.a; |LIBERA #dscam008;
               || PUNTO 1
               |SI ModoEntrada ! 3; |O Modo ! "";
                  |GRABA 020#dscam009.a; |LIBERA #dscam009;
               |FINSI;

               Comodin = #dscam067#10;
               Comodin = "dscam033.tab;" + Comodin + Modo;
               |CIERRAT #dscam008; |CIERRAT #dscam009;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam008; |LEE 101#dscam008.=;
               |ABRET #dscam009; |LEE 101#dscam009.=;

               |SI Flag < 0; |Y ModoEntrada = 2;
                  #dscam009#33 = nSecuenciaAnt;
                  |GRABA 020#dscam009.a;
               |FINSI;

               || PUNTO 1
               |SI ModoEntrada = 3; |Y Modo = "";
                  |REPON_DATOS #dscam009;
                  |GRABA 020#dscam009.c;
               |FINSI;

            |FINSI;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
         |CIERRA #dscam067;
      |SINO;
         |MENAV "    Ha modificado un efecto contabilizado. Debera volver a ejecutar el enlace ";
      |FINSI;

      #dscam008#23 = #dscam008#23 +. #dscam009#8;  #dscam008#57 = #dscam008#57 +. #dscam009#21;
      #dscam008#24 = #dscam008#24 +. #dscam009#11; #dscam008#54 = #dscam008#54 +. #dscam009#23;
      #dscam008#38 = #dscam008#38 +. #dscam009#12; #dscam008#55 = #dscam008#55 +. #dscam009#24;
      #dscam008#62 = #dscam008#62 +. #dscam009#26;
      #dscam008#25 = #dscam008#22 + #dscam008#24 + #dscam008#38; #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55;
      #dscam008#31 = #dscam008#25 - #dscam008#23;  #dscam008#58 = #dscam008#56 - #dscam008#57;
      |PINTA #dscam008#23; |PINTA #dscam008#24; |PINTA #dscam008#38;
      |PINTA #dscam008#57; |PINTA #dscam008#54; |PINTA #dscam008#55;
      |PINTA #dscam008#62; |PINTA #dscam008#58; |PINTA #dscam008#31;
      |PINTA #dscam008#25;
      |SI ModoEntrada = 3;
         |LEE 000#dscam009.a;
         |SI FSalida = 0;
            |SI #dscam009#14 = #dscam008#40;
               #dscam008#26 = #dscam009#6;
            |SINO;
            #dscam008#26 = "01.01.0000";
            |FINSI;
            |LEE 000#dscam009.s;
         |SINO;
            #dscam008#26 = "01.01.0000";
         |FINSI;
      |SINO;
         #dscam008#26 = #dscam009#6;
      |FINSI;
   |FINSI;
   #dscam008#25 = #dscam008#22 + #dscam008#24 + #dscam008#38; #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55;
   #dscam008#31 = #dscam008#25 - #dscam008#23; #dscam008#58 = #dscam008#56 - #dscam008#57;
   ||#dscam008#26 = #dscam009#6;
   |SI #dscam008#23 = 0;
      #dscam008#39 = " "; #dscam008#47 = ""; #dscam008#17 = 0; #dscam008#37 = 0;
      #dscam008#14 = "P";
      #dscam008#15 = "Pendiente de pago";
   |SINO;
      |SI #dscam008#17 = 0;
         #dscam008#14 = "E";
         |SI #dscam008#39 = "P"; #dscam008#15 = "Englobado en pagare  "; |FINSI;
         |SI #dscam008#39 = "C"; #dscam008#15 = "Englobado en confirme"; |FINSI;
         |SI #dscam008#39 = "T"; #dscam008#15 = "Englobado en talon   "; |FINSI;
      |FINSI;
      |SI #dscam008#31 = 0;
         #dscam008#14 = "L";
         #dscam008#15 = "Recibo liquidado";
      |SINO;
         #dscam008#14 = "C";
         #dscam008#15 = "Parcialmente pagado";
      |FINSI;
   |FINSI;
   ||PINDA #0#dscam008;

   #dscam009#0  = #dscam008#0;
   #dscam009#1  = #dscam008#1;
   #dscam009#2  = #dscam008#2;
   #dscam009#13 = #dscam008#27;

   |SI ModoEntrada = 3; |HAZ Baja; |FINSI;
   |SI ModoEntrada = 1; UltPago = #dscam009#3; UltFPago = #dscam009#6; |FINSI;

   Divisa = #dscam008#59; |HAZ TomaDecim;
|FPRC;

|PROCESO CalcuRec;
   #dscam008#25 = #dscam008#22 + #dscam008#24 + #dscam008#38; #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55;
   #dscam008#31 = #dscam008#25 - #dscam008#23; #dscam008#58 = #dscam008#56 - #dscam008#57;

   |PINTA #dscam008#25; |PINTA #dscam008#31;
   |PINTA #dscam008#56; |PINTA #dscam008#58;
|FPRC;

|PROCESO Baja;
   PagoAnt = #dscam009#3;
   |SALVA_FICHA #dscam009;
   #dscam009#14 = #dscam008#40;
   #dscam009#3 = 1;
   |LEE 000#dscam009.];
   |PARA; |SI FSalida = 0; |HACIENDO;
      |SI #dscam009#14 = #dscam008#40;
         |SI PagoAnt ! #dscam009#3;
            UltPago = #dscam009#3;
            UltFPago = #dscam009#6;
         |FINSI;
         |LEE 000#dscam009.s;
      |SINO;
         |SAL;
      |FINSI;
   |SIGUE;
   |LEE 000#dscam009.p;
   |REPON_FICHA #dscam009;
|FPRC;

|PROCESO CalcDC;
   eaEntidad = #dscam008#8;
   eaSucursal = #dscam008#9;
   eaCuenta = #dscam008#11;
   eaDC = "";
   |HAZ CalculoDC;
   #dscam008#10 = eaDC;
   |PINTA #dscam008#10;
|FPRC;

|PROCESO Tipo7IBAN_m8;  |TIPO 7;

     aAlfa = #dscam008#75;   |QBF aAlfa;

     |SI aAlfa ! "";  |ACABA;  |FINSI;

     eaIBANant = "";
     |SI eaCodIBAN ! "";
         eaIBANant = eaCodIBAN;
     |FINSI;
     eaCta     = #dscam008#8 + #dscam008#9 + #dscam008#10 + #dscam008#11;
     eaPais    = eaCodPais;
     |HAZ CalcuIBAN;
     |SI eaIBAN = "";
         eaIBAN = eaCodIBAN;
     |FINSI;

     #dscam008#75 = eaIBAN;
     |PINTA #dscam008#75;
|FPRC;

|PROCESO Tipo0IBAN_m8;  |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;

     eaCta     = #dscam008#8 + #dscam008#8 + #dscam008#10 + #dscam008#11;
     eaPais    = eaCodPais;
     eaIBANant = #dscam008#75;
     |HAZ CheqIBAN;

     aAlfa = eaIBANant; |QBF aAlfa;
     |SI aAlfa ! eaIBAN;
         |SI aAlfa = "";
             #dscam008#75 = eaIBAN;
             |PINTA #dscam008#75;
         |SINO;
             |CONFI "0000SEl codigo IBAN puede ser erroneo, quiere calcularlo.";
             |SI FSalida = 0;
                 #dscam008#75 = eaIBAN;
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo7BIC_m8;  |TIPO 7;
     aAlfa = #dscam008#76;   |QBF aAlfa;
     |SI aAlfa = "";
         #dscam008#76 = eaCodBIC;
         |PINTA #dscam008#76;
     |FINSI;
|FPRC;

|PROCESO MiraCodigo;
|SI HayConta = 0; |O #dscam008#44 = 0;
   TipoProveedor = "G";
   CodProveedor = #dscam008#Campo#;
   DCampoG = 32; HCampoG = 32;
   |HAZ ExisteProveedor;
   #dscam008#Campo# = CodProveedor; |PINTA #dscam008#Campo#;
|FINSI;
|FPRC;

|PROCESO MiraCuenta;
   CodProveedor = #dscam008#5;
   TipoProveedor = "C"; DCampoC = 5; HCampoC = 5;
   enAltaCli = 1;
   |HAZ ExisteProveedor;
   enAltaCli = 0;
   |SI TipoProveedor ! "ERROR";
       #dscam008#5 = CodProveedor; |PINTA #dscam008#5;
   |SINO;
       #dscam008#5 = CodProveedor; |PINTA #dscam008#5;
       |ERROR;
   |FINSI;
|FPRC;

|PROCESO mayus;
  #0Campo = #0Campo > " ";
  |PINTA #0Campo;
|FPRC;

|PROCESO Tipo7; |TIPO 7;
   |SI Moneda = BASE;
      |ATRI R; |PINTA 1925, " Dif.Cambio "; |ATRI N;
   |FINSI;
|FPRC;

|PROCESO Busca;
   |SI FSalida = 10;
      PosLibro = 0634; PosSerie = 0644; PosFactu = 0659; PosRecib = 0674;
      |HAZ ConsultaCompras;
      |SI enDocum ! -1;
         #dscam008#40 = enDocum;
      |SINO;
         |MENAV "    Ficha inexistente"; |ERROR;
      |FINSI;
      SwClave = 1; NumClave = 1;
   |SINO;
      NumClave = 0;
   |FINSI;
|FPRC;

|RUTINA infw70;
   #dscaw070#0 = 00;
   #dscaw070#1 = "01.01.0000";
   #dscaw070#2 = 000000;
   #dscaw070#3 = 0000;
|FRUT;

|RUTINA supw70;
   #dscaw070#0 = 99;
   #dscaw070#1 = "31.12.9999";
   #dscaw070#2 = 999999;
   #dscaw070#3 = 9999;
|FRUT;

|PROCESO LineasAsto;
   #cacuen@#0 = #camasil@#4;
   #cacuen@#1 = #camasil@#5;
   |LEE 000#cacuen@.=;
   |SI FSalida ! 0; |DDEFECTO #cacuen@; |FINSI;

   #camadi@#0 = #camasil@#0;
   |LEE 000#camadi@.=;
   |SI FSalida ! 0; |DDEFECTO #camadi@; |FINSI;

   |DDEFECTO #dscaw070;
   #dscaw070#0 = #camasil@#0;
   #dscaw070#1 = #camasil@#1;
   #dscaw070#2 = #camasil@#2;
   #dscaw070#3 = #camasil@#3;
   |SI #camasil@#8 = "D";
      #dscaw070#4 = #camasil@#4;
      #dscaw070#5 = "";
   |SINO;
      #dscaw070#4 = "";
      #dscaw070#5 = #camasil@#4;
   |FINSI;
   #dscaw070#6  = #camasil@#6;
   #dscaw070#7  = #camasil@#7;
   #dscaw070#8  = #camasil@#9;
   #dscaw070#9  = #camadi@#1;
   #dscaw070#10 = #caempr@#2;
   #dscaw070#11 = #caempr@#3;
   #dscaw070#12 = #caempr@#1;
   #dscaw070#13 = #cacuen@#2;
   #dscaw070#14 = #camsic@#4;
   #dscaw070#15 = #camsic@#5;
   #dscaw070#16 = #cacuen@#53;
   |GRABA 020#dscaw070.n;
|FPRC;

|DEFBUCLE LineasAsto;
#camasil@#1004;
;
#camsic@#0, #camsic@#1, #camsic@#2, 0000;
#camsic@#0, #camsic@#1, #camsic@#2, 9999;
;
NULL,LineasAsto;
|FIN;

|PROCESO TablaMov; |TIPO 11;
   |SI FSalida = 10;
      |PUSHV 1349 2380;
      |CUADRO 1349 2380;
      |ATRI R; |BLANCO 1450 2279;
      |PINTA 1450,      " PAG Pago normal            ";
      |PINTA 1550,      " PAP Pago parcial           ";
      |PINTA 1650,      " PCF Pago por confirme      ";
      |PINTA 1750,      " PDM Pago por pago domicil. ";
      |PINTA 1850,      " PPA Pago a traves de pagare";
      |PINTA 1950,      " PTA Pago a traves de talon ";
      |PINTA 2050,      " RCC Reclam.pago confirme   ";
      |ATRI N;
      |PAUSA; |ERROR;
      |POPV;
   |FINSI;
   |SI FSalida = 12;

      |HAZ BuscaEnlace;
      |SI nErroBuscaEnlace ! 0; |ERROR; |ACABA; |FINSI;

      aAlfa = "co" + Usuario; |NOME_DAT #200 aAlfa;
      |DELINDEX #dscaw070; |ABRE #dscaw070;

      aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "def/camaasic.mas";
      |CARGA_DEF aAlfa, camsic@;
      |SI FSalida ! 0;
         |MENAV "    No hay acceso a los datos contables. Compruebe el path de la ficha de empresas";
         |CIERRA #dscaw070; |DELINDEX #dscaw070; |ERROR; |ACABA;
      |FINSI;
      aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "def/camaasil.mas";
      |CARGA_DEF aAlfa, camasil@;
      aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "def/cacuenta.mas";
      |CARGA_DEF aAlfa, cacuen@;
      aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "def/camandia.mas";
      |CARGA_DEF aAlfa, camadi@;
      aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "def/canempre.mas";
      |CARGA_DEF aAlfa, caempr@;

      aAlfa = #48#16; |QBF aAlfa;
      aAlfa = aAlfa + "fich/" + (("00000" + #dscam067#8) % -105) + #dscam067#9 + "/";
      |PATH_DAT #100 aAlfa; |PATH_DAT #101 aAlfa;
      |PATH_DAT #102 aAlfa; |PATH_DAT #103 aAlfa;
      aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "fich/";
      |PATH_DAT #104 aAlfa;

      |ABRE #camsic@; |ABRE #camasil@; |ABRE #cacuen@;
      |ABRE #camadi@; |ABRE #caempr@;

      #caempr@#2 = #dscam067#8;
      #caempr@#3 = #dscam067#9;
      |LEE 000#caempr@.=;
      |SI FSalida ! 0;
         aAlfa = "    No encuentro la empresa contable. Empresa " + #dscam067#8 + ", Periodo " + #dscam067#9;
         |MENAV aAlfa;
         |CIERRA #caempr@; |DESCARGA_DEF #caempr@;
         |CIERRA #camadi@; |DESCARGA_DEF #camadi@;
         |CIERRA #cacuen@; |DESCARGA_DEF #cacuen@;
         |CIERRA #camasil@; |DESCARGA_DEF #camasil@;
         |CIERRA #camsic@; |DESCARGA_DEF #camsic@;
         |CIERRA #dscaw070; |DELINDEX #dscaw070;
         |ERROR; |ACABA;
      |FINSI;

      #camsic@#0 = #dscam067#4;
      #camsic@#1 = #dscam067#5;
      #camsic@#2 = #dscam067#6;
      |LEE 000#camsic@.=;
      |SI FSalida ! 0;
         aAlfa = "    No encuentro el asiento. Diario " + #dscam067#4 + ", Fecha " + #dscam067#5;
         aAlfa = aAlfa + ", documento " + #dscam067#6;
         |MENAV aAlfa;
         |CIERRA #caempr@; |DESCARGA_DEF #caempr@;
         |CIERRA #camadi@; |DESCARGA_DEF #camadi@;
         |CIERRA #cacuen@; |DESCARGA_DEF #cacuen@;
         |CIERRA #camasil@; |DESCARGA_DEF #camasil@;
         |CIERRA #camsic@; |DESCARGA_DEF #camsic@;
         |CIERRA #dscaw070; |DELINDEX #dscaw070;
         |ERROR; |ACABA;
      |FINSI;

      |BUCLE LineasAsto;

      |CIERRA #caempr@; |DESCARGA_DEF #caempr@;
      |CIERRA #camadi@; |DESCARGA_DEF #camadi@;
      |CIERRA #cacuen@; |DESCARGA_DEF #cacuen@;
      |CIERRA #camasil@; |DESCARGA_DEF #camasil@;
      |CIERRA #camsic@; |DESCARGA_DEF #camsic@;

      |PUSHV 1201 2380;
      |ENTLINEAL #1#dscaw070,-4,4,21,1,infw70,supw70;

      |POPV; |ERROR;
      |CIERRA #dscaw070; |DELINDEX #dscaw070;
   |FINSI;
|FPRC;

|PROCESO BorraLin;
   |BORRA 020#dscam009.a;
|FPRC;

|DEFBUCLE BorraLin;
#dscam009#1;
;
#dscam008#40,001;
#dscam008#40,999;
be;
NULL,BorraLin;
|FIN;

|PROCESO Eliminacion;
   |SI FSalida = 27;
      eaUsuario = Usuario % 0810;
      eaTipoReg = "PG";  eaNumero = ("000000000" + #dscam008#40) % -109;
      eaDescr   = "ELIMINACION REC.PAGO (" + (("000000000" + #dscam008#40) % -109);
      eaDescr   = eaDescr + ") DESDE MANTENIMIENTO DE RECIBOS";
      eaTipoOp  = "B"; enImpAnt = #dscam008#25; enImpAct = #dscam008#25;
      eaFicher  = "dscam008"; eaClave = #dscam008#40;
      |HAZ GrabaAudit; |BUCLE BorraLin;
      |BORRA 020#dscam008.a; |DDEFECTO #dscam008;
   |FINSI;
|FPRC;

|PROCESO LPag;
   #dscam021#0 = #dscam022#0;
   |LEE 000#dscam021.=;
   |SI FSalida = 0;
      |SI #dscam022#6 ! #dscam008#3; |Y #dscam021#7 = "N";
         #dscam022#6 = #dscam008#3; |GRABA 020#dscam022.a;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE LPag;
   #dscam022#2;
   ;
   #dscam008#40,001;
   #dscam008#40,999;
   be;
   NULL,LPag;
|FIN;

|PROCESO LTalon;
   #dscam046#0 = #dscam047#0;
   |LEE 000#dscam046.=;
   |SI FSalida = 0;
      |SI #dscam047#6 ! #dscam008#3; |Y #dscam046#7 = "N";
         #dscam047#6 = #dscam008#3; |GRABA 020#dscam047.a;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE LTalon;
   #dscam047#2;
   ;
   #dscam008#40,001;
   #dscam008#40,999;
   be;
   NULL,LTalon;
|FIN;

|PROCESO LConf;
   #dscam049#0 = #dscam050#0;
   |LEE 000#dscam049.=;
   |SI FSalida = 0;
      |SI #dscam050#6 ! #dscam008#3; |Y #dscam049#7 = "N";
         #dscam050#6 = #dscam008#3; |GRABA 020#dscam050.a;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE LConf;
   #dscam050#2;
   ;
   #dscam008#40,001;
   #dscam008#40,999;
   be;
   NULL,LConf;
|FIN;

|PROCESO Facturas;
   #agif079@#66 = #dscam008#0;
   #agif079@#0  = #dscam008#1;
   |LEE 101#agif079@.=;
   |PARA; |SI FSalida = 0; |Y #agif079@#66 = #dscam008#0; |Y #agif079@#0 = #dscam008#1; |HACIENDO;
      |SI #agif079@#1 = #dscam008#4; |SAL; |FINSI;
      |LEE 000#agif079@.s;
   |SIGUE;
   |SI #agif079@#1 ! #dscam008#4; |O #agif079@#66 ! #dscam008#0; |O #agif079@#0 ! #dscam008#1;
      |LIBERA #agif079@; |ACABA;
   |FINSI;

   nCalc = #dscam008#2 + 67;
   |SI nCalc > 73; nCalc = #dscam008#2 + 128; |FINSI;
   |SI #agif079@#nCalc# ! #dscam008#3;
      #agif079@#nCalc# = #dscam008#3; |GRABA 020#agif079@.a; |LIBERA #agif079@;
   |FINSI;

|FPRC;

|PROCESO Control;
   #dscam044#0 = #dscam045#0;
   |LEE 000#dscam044.=;
   |SI FSalida = 0;
      aAlfa = #dscam044#1; |QBF aAlfa;
      aAlfa1 = aAlfa + "def/agifa079.mas";
      |CARGA_DEF aAlfa1, agif079@;
      |SI FSalida ! 0;
         |MENAV "    Fallo al cargar el def de vencimientos";
         |ERROR; |ACABA;
      |FINSI;
      aAlfa1 = aAlfa + "fich/" + (("00000" + #dscam044#0) % -105) + "/";
      |PATH_DAT #32 aAlfa1; |ABRE #agif079@;
      |BUCLE LPag; |BUCLE LTalon; |BUCLE LConf; |HAZ Facturas;
      |CIERRA #agif079@; |DESCARGA_DEF #agif079@;
   |FINSI;
|FPRC;

|DEFBUCLE Control;
#dscam045#1;
2,6;
00001,001,"C",nEmpresa;
99999,999,"C",nEmpresa;
;
NULL,Control;
|FIN;

|PROCESO MiraFecha;
   |SI #dscam008#3 < #dscam008#4; |Y #dscam051#39 = "S";
      |MENAV "    La fecha de vto.nunca puede ser menor a la de emision";
      |ERROR; |ACABA;
   |FINSI;
|FPRC;

|PROCESO CambiaVto;
   |CONFI "    NEsta seguro de cambiar el vencimiento ? ";
   |SI FSalida = 0; |Y #dscam008#23 = 0; |Y #dscam008#31 = #dscam008#25;
      nEmpresa = #48#0;
      |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "fich/";
      |PATH_DAT #15 aAlfa; |PATH_DAT #16 aAlfa;
      |ABRE #dscam044; |ABRE #dscam045;
      |ABRE #dscam021; |ABRE #dscam046; |ABRE #dscam049;
      |BUCLE Control;
      |CIERRA #dscam021; |CIERRA #dscam046; |CIERRA #dscam049;
      |CIERRA #dscam045; |CIERRA #dscam044;
   |SINO;
      #dscam008#3 = fAntVto;
   |FINSI;
|FPRC;

|PROCESO MiraRegistro;
   eaFichClas = "dscam008"; eaTipoClas = #dscam008#12; |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |ACABA; |FINSI;
   |SI eaFichClas = "INFOR";
       eaFichClas = "dscam008";
       eaResult = "C"; enNumDocum = #dscam008#40; enTipoRec = #dscam008#12;
       |SALVA_FICHA #dscam008;
       |HAZ CambiaTR;
       |REPON_FICHA #dscam008; |PINTA #dscam008#12;
       |SI eaResult = "ERROR"; eaFichClas = "ERROR"; |ERROR; |ACABA; |FINSI;
   |FINSI;

   Divisa = #dscam008#59; |HAZ TomaDecim;
   |PINDA #0#0;
   |CUADRO 05250550;
   |ATRI I; Comodin = " Recibo en " + #dscam008#60; |QBF Comodin;
   Comodin = Comodin + " "; |PINTA 0525, Comodin; |ATRI N;

   |SI #dscam008#74 = "S";
      |ATRI R; |PINTA 2051, "TOTAL COMPENSADO"; |ATRI N;
   |SINO;
      |ATRI R; |PINTA 2051, "TOTAL PENDIENTE "; |ATRI N;
   |FINSI;

   |SI #dscam051#108 = "S"; |Y #dscam008#73 ! "01.01.0000";
      |C_M #dscam008#3,  1, "N";  |C_V #dscam008#3,  1, "N";
      |C_P #dscam008#73, 1, 1069; |C_V #dscam008#73, 1, "S";
      |PINTA #dscam008#73;
   |SINO;
      |C_M #dscam008#3,  1, "S";  |C_V #dscam008#3,  1, "S";
      |C_V #dscam008#73, 1, "N";  |PINTA #dscam008#73;
   |FINSI;
|FPRC;

|PROCESO AntComprueba; |TIPO 7;
   |C_M #dscam008#12,0,aAlfa;
   |SI aAlfa = "S";
      eaFichClas = "dscam008"; eaTipoClas = #dscam008#12; |HAZ CompruebaClas;
      aAntClas = eaTipoClas;
      nAntTRec = #dscam008#12;
   |FINSI;
|FPRC;

|PROCESO DespComprueba;
   |SI FSalida = 2; |ACABA; |FINSI;

   |C_M #dscam008#12,0,aAlfa;
   |SI aAlfa = "S";
      eaFichClas = "dscam008"; eaTipoClas = #dscam008#12; |HAZ CompruebaClas;
      aDespClas = eaTipoClas;
      |SI aAntClas = aDespClas; |ACABA; |FINSI;
   |FINSI;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA "Recibos de compra";
   enSwClas = 1;

   |HAZ Tipo8;

   |SI enERP ! 0;
      |ABRE #dscam008;

      InPuntero = nPuntero1<-;
      |REFERENCIA_DEF nPuntero1, #0;
      |ESPECIFICA "X_POP_ERP", nPuntero;

      |LEE 000#dscam008.=;

      |PINPA #0#0; |PINDA #0#0;
      |PUSHV 0501 2380;
      |ENTLINEAL #1#dscam009,-2,1,20,1,inf,sup;
      |POPV;
      |PAUSA;
      |CIERRA #dscam008;
      |HAZ Tipo9;
      |ACABA;
   |FINSI;

   PrimerReg = 1;

   |PINPA #0#0;|PINDA #0#0;

   |ABRET #dscam008; |LEE 000#dscam008.p;
   |ABRET #dscam009; |LEE 000#dscam009.p;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.a;
      |LEE 000#dscam051.p;
   |FINSI;

      |DDEFECTO #dscam008;
|ET Clave;
      SwClave = 0;

      |SI enErp = 0;
          |HAZ PideClave;
          |SI SwError = 1; |ACABA; |FINSI;
      |SINO;
          #dscam008#40 = enErp;
      |FINSI;

      |LEE 000#dscam008.=;
      |SI FSalida = 0;
         Divisa = #dscam008#59; |HAZ TomaDecim;
         |PINDA #0#0;
         |CUADRO 05250550;
         |ATRI I; Comodin = " Recibo en " + #dscam008#60; |QBF Comodin;
         Comodin = Comodin + " "; |PINTA 0525, Comodin; |ATRI N;
         enSwClas = 0; |HAZ MiraRegistro; enSwClas = 1;
      |SINO;
         |SI PrimerReg = 1;
            PrimerReg = 0;
            |LEE 000#dscam008.p;
            |SI FSalida = 0;
               Divisa = #dscam008#59; |HAZ TomaDecim;
               |PINDA #0#0;
               |CUADRO 05250550;
               |ATRI I; Comodin = " Recibo en " + #dscam008#60; |QBF Comodin;
               Comodin = Comodin + " "; |PINTA 0525, Comodin; |ATRI N;
            |SINO;
               |MENAV "    Clave inexistente"; |VETE Clave;
            |FINSI;
         |SINO;
            |MENAV "    Clave inexistente";
            |VETE Clave;
         |FINSI;
      |FINSI;
      ||HAZ RellenaPagos;

   |PARA; |SI Salir = 0; |HACIENDO;

      |SI #dscam008#49 = "S";
         |MENU menul;
         MaxOpc = 11;
      |SINO;
         |MENU menu;
         MaxOpc = 10;
      |FINSI;
      Opcion = FSalida;
      |SI Opcion < 1; |O Opcion > MaxOpc; |SAL; |FINSI;

      |SI Opcion = 1; |VETE Clave; |FINSI;
      |SI Opcion = 2;
         |SI NumClave = 1; |SELECT #7#dscam008; |LEE 000#dscam008.=; |FINSI;
         |LEE 000#dscam008.s;
         |SI FSalida ! 0;
            |MENAV "    Ultima ficha";
         |FINSI;
         |SI NumClave = 1; |SELECT #1#dscam008; |FINSI;
         enSwClas = 0; |HAZ MiraRegistro; enSwClas = 1;
         |PINDA #0#dscam008;
      |FINSI;
      |SI Opcion = 3;
         |SI NumClave = 1; |SELECT #7#dscam008; |LEE 000#dscam008.=; |FINSI;
         |LEE 000#dscam008.a;
         |SI FSalida ! 0;
            |MENAV "    Primera ficha";
         |FINSI;
         |SI NumClave = 1; |SELECT #1#dscam008; |FINSI;
         enSwClas = 0; |HAZ MiraRegistro; enSwClas = 1;
         |PINDA #0#dscam008;
      |FINSI;
      |SI Opcion = 4;
         |SI NumClave = 1; |SELECT #7#dscam008; |LEE 000#dscam008.=; |FINSI;
         |LEE 000#dscam008.p;
         |SI NumClave = 1; |SELECT #1#dscam008; |FINSI;
         enSwClas = 0; |HAZ MiraRegistro; enSwClas = 1;
      |FINSI;
      |SI Opcion = 5;
         |SI NumClave = 1; |SELECT #7#dscam008; |LEE 000#dscam008.=; |FINSI;
         |LEE 000#dscam008.u;
         |SI NumClave = 1; |SELECT #1#dscam008; |FINSI;
         enSwClas = 0; |HAZ MiraRegistro; enSwClas = 1;
      |FINSI;
      |SI Opcion = 6; || IMPRESION
         |ABRE #dscam058;
         Comodin = ("00" + #dscam008#12) % -102;
         #dscam058#0 = Comodin;
         |LEE 000#dscam058.=;
         |CIERRA #dscam058;

         |IMPRE 0;
         |SI FSalida = 0;
            |SI #dscam008#59 = "EUR"; EURODB = 2; |SINO; EURODB = 0; |FINSI;
               |SI EURODB = 2;
                  EURO = 166.386;     EURODV = 0;
               |SINO;
                  EURO = 1 / 166.386; EURODV = 2;
               |FINSI;
               Comodin = #dscam058#2;
               |INFOR Comodin;
               |SI FSalida = 0;
                  DirCliente = ""; Cp = ""; PobCliente = ""; ProvCliente = ""; TelCliente = "";
                  eaCodigo = #dscam008#32; eaTipoCod = "P"; aCuenta = #dscam008#5; |HAZ LeeDatos;
                  DirCliente = eaDireccion;
                  Cp = eaCP;
                  PobCliente = eaPoblacion;
                  ProvCliente = eaProvincia;
                  TelCliente = eaTelefono;
                  |SI HayGestion ! 0; enNume1 = #agif112@#63; |FINSI;
                  |PRINT; |PIEINF;
               |FINSI;
               |FININF;
               nCuenta = 1; |HAZ AjusteHoja;
               |FINIMP;
            |FINSI;

            eaUsuario = Usuario % 0810;
            eaTipoReg = "PG";  eaNumero = ("000000000" + #dscam008#40) % -109;
            eaDescr   = "EMISION RECIBO (" + (("000000000" + #dscam008#40) % -109);
            eaDescr   = eaDescr + ") DESDE MANTENIMIENTO DE RECIBOS";
            eaTipoOp  = "E"; enImpAnt = #dscam008#30; enImpAct = #dscam008#30;
            eaFicher = "dscam008"; eaClave = #dscam008#40;
            |HAZ GrabaAudit;
            #dscam008#48 = "S"; |GRABA 020#dscam008.a;
      |FINSI;
      |SI Opcion = 7;
         enSwClas = 1; |HAZ MiraRegistro;
         |SI eaFichClas = "ERROR";
            |MENAV "    Documento inoperable en el perfil actual ";
         |SINO;
            |LEE 101#dscam008.=;
            |SI FSalida = 0;
               UltPago = 1;
               UltFPago = "00.00.0000";
               |HAZ Baja;
               |PUSHV 13012349;
               |ENTLINEAL #1#dscam009,-2,1,22,1,inf,sup;
               |POPV;
               |GRABA 020#dscam008.a;
               |LIBERA #dscam008;
               |PINDA #0#dscam008;
            |FINSI;
            |LIBERA #dscam008;
         |FINSI;
      |FINSI;
      |SI Opcion = 8;
         enSwClas = 1; |HAZ MiraRegistro;
         |SI eaFichClas = "ERROR";
            |MENAV "    Documento inoperable en el perfil actual ";
         |SINO;
            |LEE 101#dscam008.=;
            fAntVto = #dscam008#3;
            Comodin = "|NC";
            Campos = #dscam008#Comodin# - 1;
            |PARA Cont = 0; |SI Cont [ Campos; |HACIENDO Cont = Cont + 1;
               |C_M #dscam008#Cont#,1,"N";
            |SIGUE;
            |SI #dscam051#39 = "S"; |C_M #dscam008#3,1,"S"; |FINSI;
            |C_M #dscam008#8,1,"S";  |C_M #dscam008#9,1,"S";
            |C_M #dscam008#11,1,"S";
            |C_M #dscam008#51,1,"S";
            |C_M #dscam008#13,1,"S"; |C_M #dscam008#28,1,"S";
            |C_M #dscam008#29,1,"S"; |C_M #dscam008#16,1,"S";
            |C_M #dscam008#63,1,"S"; |C_M #dscam008#12,1,"S";
            |C_M #dscam008#64,1,"S"; |C_M #dscam008#65,1,"S";
            |C_M #dscam008#66,1,"S"; |C_M #dscam008#40,1,"S";
            |C_M #dscam008#16,1,"S"; |C_M #dscam008#72,1,"S";
            |C_M #dscam008#75,1,"S"; |C_M #dscam008#76,1,"S";
            |SI #dscam008#46 ! 0;
               |C_M #dscam008#5,1,"S";
            |SINO;
               |C_M #dscam008#5,1,"N";
            |FINSI;
            |ENDATOS #2#dscam008;
            |SI FSalida = 0;
               |SI fAntVto ! #dscam008#3; |Y #dscam051#39 = "S"; |HAZ CambiaVto; |FINSI;
               |GRABA 020#dscam008.a;
            |FINSI;
            |LIBERA #dscam008;
            |C_M #dscam008#40,1,"S";
         |FINSI;
      |FINSI;
      |SI Opcion = 9;
         |SI Moneda = DIV;
            Moneda = BASE;
            |ATRI I; |PINTA 0555 , " Importes en moneda base "; |ATRI N;
            |C_V #dscam009#20,1,"S"; |C_V #dscam009#7 ,1,"N";
            |C_V #dscam009#21,1,"S"; |C_V #dscam009#8 ,1,"N";
            |C_V #dscam009#23,1,"S"; |C_V #dscam009#11,1,"N";
            |C_V #dscam009#24,1,"S"; |C_V #dscam009#12,1,"N";
            |C_V #dscam009#26,1,"S";

            |C_V #dscam008#53,1,"S"; |C_V #dscam008#22,1,"N";
            |C_V #dscam008#54,1,"S"; |C_V #dscam008#24,1,"N";
            |C_V #dscam008#55,1,"S"; |C_V #dscam008#38,1,"N";
            |C_V #dscam008#56,1,"S"; |C_V #dscam008#25,1,"N";
            |C_V #dscam008#57,1,"S"; |C_V #dscam008#23,1,"N";
            |C_V #dscam008#58,1,"S"; |C_V #dscam008#31,1,"N";
            |C_V #dscam008#62,1,"S";
            |ATRI R; |PINTA 1750, " Dif.Cambio "; |ATRI N;
            |PINDA #0#dscam008;
         |SINO;
            Moneda = DIV;
            |CUADRO 05550579;

            |C_V #dscam009#20,1,"N"; |C_V #dscam009#7 ,1,"S";
            |C_V #dscam009#21,1,"N"; |C_V #dscam009#8 ,1,"S";
            |C_V #dscam009#23,1,"N"; |C_V #dscam009#11,1,"S";
            |C_V #dscam009#24,1,"N"; |C_V #dscam009#12,1,"S";
            |C_V #dscam009#26,1,"N";

            |C_V #dscam008#53,1,"N"; |C_V #dscam008#22,1,"S";
            |C_V #dscam008#54,1,"N"; |C_V #dscam008#24,1,"S";
            |C_V #dscam008#55,1,"N"; |C_V #dscam008#38,1,"S";
            |C_V #dscam008#56,1,"N"; |C_V #dscam008#25,1,"S";
            |C_V #dscam008#57,1,"N"; |C_V #dscam008#23,1,"S";
            |C_V #dscam008#58,1,"N"; |C_V #dscam008#31,1,"S";
            |C_V #dscam008#62,1,"N";
            |ATRI R; |PINTA 1750, "            "; |ATRI N;
            |PINTA 1769,"            ";
            |PINDA #0#dscam008;
         |FINSI;
      |FINSI;
      |SI Opcion = 10;               || TRAZABILIDAD
         enSwClas = 1; |HAZ MiraRegistro;
         |SI eaFichClas = "ERROR";
            |MENAV "    Documento inoperable en el perfil actual ";
         |SINO;
            |HAZ Trazabilidad;
         |FINSI;
      |FINSI;
      |SI Opcion = 11;
         enSwClas = 1; |HAZ MiraRegistro;
         |SI eaFichClas = "ERROR";
            |MENAV "    Documento inoperable en el perfil actual ";
         |SINO;
            |LEE 101#dscam008.=;
            |PUSHV 1301 2349;
            Documento = #dscam008#40;
            Linea = 1;
            |SALVA_FICHA #dscam008;
            |DELINDEX #dscam025;
            |ABRE #dscam025;
            |BUCLE Agrupados;
            |CIERRA #dscam025;
            |REPON_FICHA #dscam008;
            |ENTLINEAL #1#dscam025,-1,4,22,1,inf1,sup1;
            |POPV;
            |PINDA #0#dscam008;
            |LIBERA #dscam008;
         |FINSI;
      |FINSI;
      menu2 = Opcion; menul2 = Opcion;
   |SIGUE;

   |CIERRA #dscam051;
   |CIERRAT #dscam008;
   |CIERRAT #dscam009;

   |HAZ Tipo9;

|FPRO;

|PROCESO BloquCampos;
   nModo = (FEntrada / 100) ! 0;
   |SI nModo ! 1; |ACABA; |FINSI;

   |SI #dscam009#5 ! "PAG"; |Y #dscam009#5 ! "PAP";
      |MENAV "    El movimiento indicado no existe o no se puede dar de alta manualmente ";
      |ERROR; |ACABA;
   |FINSI;
|FPRC;

|PROCESO MiraImporte;
   |SI #dscam009#5 = "PAG"; |O #dscam009#5 = "PAP";
      ||Tiquet 10028/939
      ||nCalc1 = #dscam009#8 - (#dscam009#11 + #dscam009#12);
      nCalc1 = #dscam009#8;
      |SI #dscam008#22 < 0;
         |SI nCalc1 < #dscam008#31;
            |MENAV "    Importe maximo sobrepasado "; |ERROR;
         |FINSI;
      |SINO;
         |SI nCalc1 > #dscam008#31;
            |MENAV "    Importe maximo sobrepasado "; |ERROR;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO VigilaFecha;
   |SI #dscam009#6 < UltFPago;
      aAlfa = "    La fecha del ultimo movto. es " + UltFPago + " y la indicada es menor";
      |MENAV aAlfa;
      |ERROR; |ACABA;
   |FINSI;
|FPRC;

|PROCESO EntradaManual;
   UltPago = #dscam009#3;
   UltFPago = #dscam009#6;

   |SI #dscam009#5 = "PAG"; |O #dscam009#5 = "PAP";
      #dscam009#7 = #dscam008#23;
      #dscam009#20 = #dscam008#57;
      #dscam008#23 = #dscam008#23 + #dscam009#8;
      #dscam008#57 = #dscam008#57 + #dscam009#21;
      #dscam008#31 = #dscam008#31 - #dscam009#8;
      #dscam008#58 = #dscam008#58 - #dscam009#21;
      |SI #dscam008#31 = 0;
         #dscam008#14 = "L";
         #dscam008#15 = "Recibo Liquidado";
      |SINO;
         |SI #dscam008#23 = 0;
            #dscam008#14 = "P";
            #dscam008#15 = "Pendiente de pago";
         |SINO;
            #dscam008#14 = "C";
            #dscam008#15 = "Parcialmente pagado";
         |FINSI;
      |FINSI;
      |GRABA 020#dscam008.a;
   |FINSI;
|FPRC;

|PROCESO AjusteHoja;
     |VARIABLES;
                    || R.PRIEGO: IMPRESION ESPECIAL EN LASER
                    || Ajusta a numero de recibos por pagina.
          nAjuste = 0;   || nro.recibos p/pagina, viene de tipos de recibo
          nPara1  = 0;
          nNume1  = 0;
     |FINSI;

     |SI nCuenta = 0;    |ACABA;   |FINSI;

     nAjuste = #dscam058#3;        || se queda con el ultimo TIPO utilizado
     |SI nAjuste = 0;    |ACABA;   |FINSI;

     |SALVA_FICHA #dscam008;

     |DDEFECTO #dscam008;
     DirCliente = "";
     Cp = "";
     PobCliente = "";
     ProvCliente = "";
     TelCliente = "";

     nNume1 = nCuenta $ nAjuste;
     |SI nNume1 ! 0;
          nNume1 = nNume1 + 1;
          |PARA nPara1 = nNume1; |SI nPara1 [ nAjuste; |HACIENDO nPara1 = nPara1 + 1;
               Comodin = #dscam058#2; |QBF Comodin;    || con el ultimo
               |INFOR Comodin;
               |PRINT;
               |PIEINF;
               |FININF;
          |SIGUE;
     |FINSI;

     |REPON_FICHA #dscam008;
|FPRC;

|PROCESO BajaCajaLuxe;
     |DBASS aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "contagen/def/cajainca.mas";
     |CARGA_DEF aAlfa, cajainca@;
     |SI FSalida = 0;
        |DBASS aAlfa; |QBF aAlfa;
        aAlfa = aAlfa + "contagen/def/cajainli.mas";
        |CARGA_DEF aAlfa, cajainli@;
        |SI FSalida = 0;
           |DBASS aAlfa; |QBF aAlfa;
           aAlfa = aAlfa + "contagen/def/canempre.mas";
           |CARGA_DEF aAlfa, caempr@;
           |SI FSalida = 0;
              |DBASS aAlfa; |QBF aAlfa;
              aAlfa = aAlfa + "contagen/fich/"; |PATH_DAT #caempr@#aAlfa#;
              |ABRE #caempr@;
              |DFICB aAlfa; |QBF aAlfa; |PATH_DAT #dscam043#aAlfa#;
              |ABRE #dscam043;
              |SELECT #2#dscam043;
              #dscam043#9 = #48#0;
              |LEE 000#dscam043.];
              |PARA; |SI FSalida = 0; |HACIENDO;
                 #caempr@#2 = #dscam043#0;
                 #caempr@#3 = #dscam043#1;
                 |LEE 000#caempr@.=;
                 |SI FSalida = 0;
                    nAnyo = #caempr@#26;
                    |SI nAnyo > 80;
                       nAnyo = nAnyo + 1900;
                    |SINO;
                       nAnyo = nAnyo + 2000;
                    |FINSI;
                    aAlfa = #dscam009#6; |QBF aAlfa;
                    aAlfa = aAlfa % -104; nCalc4 = aAlfa;
                    |SI nCalc4 = nAnyo; |Y #dscam009#0 ] #dscam043#7; |Y #dscam009#0 [ #dscam043#8;
                     |Y #dscam043#3 = "C";
                       |DBASS eaDirConta; |QBF eaDirConta;
                       enSwError   = 0;
                       eaDirConta = eaDirConta + "contagen/";
                       efFecha = #dscam009#6;
                       eaEmpContab = (("00000" + #dscam043#0) % -105) + #dscam043#1;
                       |HAZ CompruebaEmpContable;
                       |SI enSwError < 0;
                          |SI enSwError = -1;
                             |MENAV "    Empresa cerrada. Proceso cancelado.";
                          |FINSI;
                          |SI enSwError = -2;
                             |MENAV "    No se encuentran los ficheros de contabilidad. Proceso cancelado.";
                          |FINSI;
                          |SI enSwError = -3;
                             |MENAV "    No se encuentra la empresa de contabilidad. Proceso cancelado.";
                          |FINSI;
                          |SI enSwError = -4;
                             aAlfa = "    Empresa contable bloqueada a fecha " + #caempr@#34;
                             |MENAV aAlfa;
                          |FINSI;
                          |CIERRA #caempr@; |DESCARGA_DEF #caempr@;
                          |CIERRA #cajainli@; |DESCARGA_DEF #cajainli@;
                          |CIERRA #cajainca@; |DESCARGA_DEF #cajainca@;
                          |ERROR; |ACABA;
                       |FINSI;
                       |SAL;
                    |FINSI;
                 |FINSI;
                 |LEE 000#dscam043.s;
              |SIGUE;
              |SI FSalida = 0; |Y nCalc4 = nAnyo; |Y #dscam009#0 ] #dscam043#7; |Y #dscam009#0 [ #dscam043#8;
               |Y #dscam043#3 = "C"; |Y #caempr@#34 > #dscam009#6; |O #caempr@#34 = "01.01.0000";
                 |DBASS aAlfa; |QBF aAlfa;
                 aAlfa = aAlfa + "contagen/fich/" + (("00000" + #dscam043#0) % -105) + #dscam043#1 + "/";
                 |PATH_DAT #cajainca@#aAlfa#; |PATH_DAT #cajainli@#aAlfa#;
                 |ABRE #cajainca@; |ABRE #cajainli@;
                 #cajainca@#1 = #dscam009#6;
                 |LEE 101#cajainca@.=;
                 |SI FSalida = 0;
                    #cajainli@#1 = #cajainca@#1;
                    #cajainli@#3 = #dscam009#38;
                    |LEE 101#cajainli@.=;
                    |SI FSalida = 0;
                       |BORRA 020#cajainli@.a;
                    |SINO;
                       |MENAV "    Diario de caja actualizado";
                       |LIBERA #cajainca@;
                       |CIERRA #caempr@;   |DESCARGA_DEF #caempr@;
                       |CIERRA #cajainli@; |DESCARGA_DEF #cajainli@;
                       |CIERRA #cajainca@; |DESCARGA_DEF #cajainca@;
                       |ERROR; |ACABA;
                    |FINSI;
                    #cajainli@#1 = #cajainca@#1;
                    #cajainli@#3 = 1;
                    |LEE 101#cajainli@.];
                    |SI FSalida ! 0; |O #cajainli@#1 ! #cajainca@#1;
                       |BORRA 020#cajainca@.a;
                    |SINO;
                       #cajainca@#2 = #cajainca@#2 - #dscam009#8;
                       |GRABA 020#cajainca@.a;
                    |FINSI;
                    |LIBERA #cajainca@;
                 |SINO;
                    |MENAV "    Diario de caja actualizado";
                    |CIERRA #caempr@; |DESCARGA_DEF #caempr@;
                    |CIERRA #cajainli@; |DESCARGA_DEF #cajainli@;
                    |CIERRA #cajainca@; |DESCARGA_DEF #cajainca@;
                    |ERROR; |ACABA;
                 |FINSI;
              |FINSI;
              |CIERRA #cajainca@; |CIERRA #cajainli@;
              |CIERRA #caempr@; |DESCARGA_DEF #caempr@;
           |FINSI;
           |CIERRA #dscam043;
           |DESCARGA_DEF #cajainli@;
        |FINSI;
        |DESCARGA_DEF #cajainca@;
     |FINSI;
|FPRC;

|PROCESO BuscaEnlace;
     nErroBuscaEnlace = 1;

     |ABRE #dscam067; |DDEFECTO #dscam067;
     aClv1 = "PG";
     aClv2 = #dscam009#14; aClv2 = (aClv2 + (" " * 50))% 0150;
     aClv3 = #dscam009#3;  aClv3 = (aClv3 + (" " * 50))% 0150;
     aClv4 = "";           aClv4 = (aClv4 + (" " * 50))% 0150;

     |SI #dscam009#5 = "PPA";
         |ABRE #dscam022; |SELECT #2#dscam022;
         #dscam022#13 = #dscam009#14;
         #dscam022#14 = #dscam009#3;
         |LEE 000#dscam022.=;
         |SI FSalida ! 0;
            |MENAV "    No puedo encontrar el vinculo a la linea del pagare";
            |CIERRA #dscam022; |VETE FinBuscaEnlace;
         |FINSI;
         |CIERRA #dscam022;

         aClv1 = "PA";
         aClv2 = #dscam022#0; aClv2 = (aClv2 + (" " * 50))% 0150;
         aClv3 = #dscam022#1; aClv3 = (aClv3 + (" " * 50))% 0150;
         aClv4 = "I"; aClv4 = (aClv4 + (" " * 50))% 0150;
         #dscam067#0 = aClv1;
         #dscam067#1 = aClv2;
         #dscam067#2 = aClv3;
         #dscam067#3 = aClv4;
         |LEE 000#dscam067.];
         |SI FSalida ! 0; |O #dscam067#0 ! aClv1;  |O #dscam067#1 ! aClv2;
          |O #dscam067#2 ! aClv3;  |O #dscam067#3 ! aClv4;
            aClv4 = "V"; aClv4 = (aClv4 + (" " * 50))% 0150;
         |FINSI;
      |FINSI;
      |SI #dscam009#5 = "PTA";
         |ABRE #dscam047; |SELECT #2#dscam047;
         #dscam047#13 = #dscam009#14;
         #dscam047#14 = #dscam009#3;
         |LEE 000#dscam047.=;
         |SI FSalida ! 0;
            |MENAV "    No puedo encontrar el vinculo a la linea del talon";
            |CIERRA #dscam047; |VETE FinBuscaEnlace;
         |FINSI;
         |CIERRA #dscam047;

         aClv1 = "TA";
         aClv2 = #dscam047#0; aClv2 = (aClv2 + (" " * 50))% 0150;
         aClv3 = #dscam047#1; aClv3 = (aClv3 + (" " * 50))% 0150;
         aClv4 = ""; aClv4 = (aClv4 + (" " * 50))% 0150;
      |FINSI;
      |SI #dscam009#5 = "PCF";
         |ABRE #dscam050; |SELECT #2#dscam050;
         #dscam050#13 = #dscam009#14;
         #dscam050#14 = #dscam009#3;
         |LEE 000#dscam050.=;
         |SI FSalida ! 0;
            |MENAV "    No puedo encontrar el vinculo a la linea del confirme";
            |CIERRA #dscam050; |VETE FinBuscaEnlace;
         |FINSI;
         |CIERRA #dscam050;
         aClv1 = "CF";
         aClv2 = #dscam050#0; aClv2 = (aClv2 + (" " * 50))% 0150;
         aClv3 = #dscam050#1; aClv3 = (aClv3 + (" " * 50))% 0150;
         aClv4 = "V"; aClv4 = (aClv4 + (" " * 50))% 0150;
      |FINSI;
      |SI #dscam009#5 = "PDM";
         nSw = 0;
         |ABRE #dscam096; |SELECT #2#dscam096;
         #dscam096#16 = #dscam009#14;
         #dscam096#17 = #dscam009#3;
         |LEE 000#dscam096.];
         |PARA; |SI FSalida = 0; |Y #dscam096#16 = #dscam009#14; |Y #dscam096#17 = #dscam009#3; |HACIENDO;
            |SI #dscam096#15 = "S"; nSw = 1; |SAL; |FINSI;
            |LEE 000#dscam096.s;
         |SIGUE;
         |SI nSw = 0;
            |MENAV "    No puedo encontrar el vinculo a la linea del pago domiciliado";
            |CIERRA #dscam096; |VETE FinBuscaEnlace;
         |FINSI;
         |CIERRA #dscam096;
         aClv1 = "PD";
         aClv2 = #dscam096#0; aClv2 = (aClv2 + (" " * 50))% 0150;
         aClv3 = #dscam096#1; aClv3 = (aClv3 + (" " * 50))% 0150;
         aClv4 = "V"; aClv4 = (aClv4 + (" " * 50))% 0150;
      |FINSI;
      |SI #dscam009#5 = "RCC";

         || Tengo que buscar el movimiento, dado que en la linea del confirming no se queda registrada el
         ||     vinculo al movimiento de reclamacion ...
         || En primer lugar, busco el movimiento anterior a este que corresponda al vencimiento del confirming ...
         nNumDocum = 0;
         nNumLinea = 0;
         |SALVA_FICHA #dscam009;
         |LEE 000#dscam009.a;
         |PARA; |SI FSalida = 0; |Y #dscam009#14 = #dscam008#40; |HACIENDO;
            |SI #dscam009#5 = "PCF";
               nNumDocum = #dscam009#14;
               nNumLinea = #dscam009#3;
               |SAL;
            |FINSI;
            |LEE 000#dscam009.a;
         |SIGUE;
         |REPON_FICHA #dscam009;

         || ... hecho esto busco entre las lineas de confirming la clave de ese movimiento. Si no lo encuentro, lo
         ||     sigo haciendo como lo ha hecho hasta ahora ...

         |ABRE #dscam050; |SELECT #2#dscam050;
         |SI nNumDocum = 0; |Y nNumLinea = 0;
            nNumDoc = -1;
            #dscam050#13 = #dscam009#14;
            #dscam050#14 = 0;
            |LEE 000#dscam050.];
            |PARA; |SI FSalida = 0; |Y #dscam050#13 = #dscam009#14; |HACIENDO;
               nNumDoc = #dscam050#1;
               |LEE 000#dscam050.s;
            |SIGUE;
         |SINO;
            #dscam050#13 = nNumDocum;
            #dscam050#14 = nNumLinea;
            |LEE 000#dscam050.=;
            |SI FSalida = 0;
               nNumDoc = #dscam050#1;
            |SINO;
               nNumDoc = -1;
               #dscam050#13 = #dscam009#14;
               #dscam050#14 = 0;
               |LEE 000#dscam050.];
               |PARA; |SI FSalida = 0; |Y #dscam050#13 = #dscam009#14; |HACIENDO;
                  nNumDoc = #dscam050#1;
                  |LEE 000#dscam050.s;
               |SIGUE;
            |FINSI;
         |FINSI;

         |SI nNumDoc < 0;
            |MENAV "    No puedo encontrar el vinculo a la linea del confirming";
            |CIERRA #dscam050; |VETE FinBuscaEnlace;
         |FINSI;
         |CIERRA #dscam096;
         aClv1 = "CF";
         aClv2 = #dscam050#0; aClv2 = (aClv2 + (" " * 50))% 0150;
         aClv3 = nNumDoc;     aClv3 = (aClv3 + (" " * 50))% 0150;
         aClv4 = " "; aClv4 = (aClv4 + (" " * 50))% 0150;
      |FINSI;

      #dscam067#0 = aClv1;
      #dscam067#1 = aClv2;
      #dscam067#2 = aClv3;
      #dscam067#3 = aClv4;
      |LEE 000#dscam067.];
      |SI FSalida ! 0; |O #dscam067#0 ! aClv1;  |O #dscam067#1 ! aClv2;
       |O #dscam067#2 ! aClv3;  |O #dscam067#3 ! aClv4;
         |HAZ EsViuda;
         |SI FSalida ! 0;
            |MENAV "    No se refleja que el movimiento haya sido enlazado a contabilidad";
            |CIERRA #dscam067; |VETE FinBuscaEnlace;
         |SINO;
            |HAZ ConsAstoViuda;
            |SI enSwErr < 0;
               |MENAV "    No se refleja que el movimiento haya sido enlazado a contabilidad";
               |CIERRA #dscam067; |VETE FinBuscaEnlace;
            |FINSI;
         |FINSI;
      |FINSI;

     nErroBuscaEnlace = 0;
     |ET FinBuscaEnlace;
     |CIERRA #dscam067;
|FPRC;
