|FICHEROS;
   dscaz212 #0;

   dscam067 #10;
   dscam013 #11;
   dscam003 #12;
   dscam004 #13;
   dscaw013 #14;
   dscam012 #15;
   dscam093 #16;

   dscaw997 #100,MANTE;
|FIN;

|VARIABLES;
   &eaMensaPrint = "";
   &eaUsuario  = "";
   &enImpAnt   = 0;
   &enImpAct   = 0;
   &eaDescr    = "";
   &eaTipoReg  = "";
   &eaNumero   = "";
   &eaTipoOp   = "";
   &eaTOperacion = "";
   &enNumDocum = 0;

   &enEmpCartera = 0;
   &enEmpGestion = 0;
   &Divisa       = "";
   &eaSerie      = "";
   &eaCliGest    = "";
   &nImporte     = 0;
   &eaTipoOper   = "";
   &enBanco      = 0;
   &nDeci_Div    = 0;
   &nDeci_Base   = 0;
   &eaSesion     = "";

   aEntidad      = "";
   aNumero       = "";
   aMarca        = "";
   aAlfa         = "";
   aAlfa1        = "";
   Comodin       = "";
   nMarca        = 0;
   nLinea        = 0;
   FEstado       = 0;
   Clave1        = 0;
   Clave2        = 0;
   Clave3        = "";

   nNumTotal     = 0;
   nNumSelec     = 0;
   nSwMensa      = 0;
   nHayAsto      = 0;
   nSwNuevo      = 0;
   nAntRem       = -1;

   nSwIncidencia = 0;

   nEmpresa      = 0; nPeriodo = 0;
   nDiario       = 0; fFecha   = @;
   nDocumto      = 0;
   nCalc  = 0;
   nCalc1 = 0;

   nSwArtenvas = 0;

   nSw    = 0;
   nNumRecSel = 0;
|FIN;

|PROCESO LeeLineas;
   |SI #dscam004#51 = "    "; |Y #dscam004#52 = "          ";
      |SI #dscam004#17 = #dscam003#40;
         |SI #dscam004#5 = "REM";
            |BORRA 020#dscam004.a; |LIBERA #dscam004;
         |FINSI;
      |FINSI;
   |SINO;
      |SI #dscam004#17 = #dscam003#40; |Y #dscam004#51 = #dscaw997#12; |Y #dscam004#52 = #dscaw997#13;
         |BORRA 020#dscam004.a; |LIBERA #dscam004;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE LeeLineas;
#dscam004#1;
;
#dscam003#40, 01;
#dscam003#40, 99;
be;
NULL, LeeLineas;
|FIN;

|PROCESO EliminaMovtos;
   #dscam004#17 = #dscam003#40;
   #dscam004#3  = 99;
   |LEE 000#dscam004.];
   |SI FSalida = 0;
      |SI #dscam004#17 = #dscam003#40;
         |SI #dscam004#5 = "REM";
             |SI nSwArtenvas = 0;
                 || Actualiza la cabecera del recibo .....
                 #dscam003#26 = "01.01.0000";
                 #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
                 #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
                 #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
                 #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
                 #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;
             |SINO;
                 |SI #dscam012#22 = 2; |O #dscam012#22 = 4;
                         |SI #dscam013#15 = "S";
                         #dscam003#26 = "01.01.0000";
                         #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
                         #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
                         #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
                         #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
                         #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;
                         |FINSI;
                     |SINO;
                     #dscam003#26 = "01.01.0000";
                     #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
                     #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
                     #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
                     #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
                     #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;
                 |FINSI;
             |FINSI;

            #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
            #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
            #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
            #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
            #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;

            #dscam003#84 = "N";

            #dscam003#14 = "R";
            #dscam003#15 = "Remesado";
            |GRABA 020#dscam003.a;

            |LEE 101#dscam004.=;
            |BORRA 020#dscam004.a; |LIBERA #dscam004;
         |FINSI;
      |SINO;
         |LEE 000#dscam004.a;
         |SI FSalida = 0;
            |SI #dscam004#17 = #dscam003#40;
               |SI #dscam004#5 = "REM";
                  || Actualiza la cabecera del recibo .....
                  #dscam003#26 = "01.01.0000";
                  #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
                  #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
                  #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
                  #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
                  #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;

                  #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
                  #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
                  #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
                  #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
                  #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;

                  #dscam003#84 = "N";

                  #dscam003#14 = "R";
                  #dscam003#15 = "Remesado";
                  |GRABA 020#dscam003.a;

                  |LEE 101#dscam004.=;
                  |BORRA 020#dscam004.a; |LIBERA #dscam004;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE EliminaMovtos;
#dscam003#7;
;
#dscaw997#12, #dscaw997#13, 000000001;
#dscaw997#12, #dscaw997#13, 999999999;
;
NULL,EliminaMovtos;
|FIN;

|PROCESO BorraAsto;
   |ABRE #dscam067; |DDEFECTO #dscam067;
   #dscam067#8 = 0;
   #dscam067#9 = 0;
   #dscam067#0  = "RM";
   #dscam067#1  = #dscam013#0;
   #dscam067#2  = #dscam013#1;
   #dscam067#3  = "V";
   #dscam067#11 = 0;
   |LEE 000#dscam067.];
   FEstado = FSalida;
   Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
   |PARA; |SI FEstado = 0; |Y #dscam067#0  = "RM"; |Y Clave1 = #dscam013#0;
    |Y Clave2 = #dscam013#1; |Y Clave3 = "V"; |HACIENDO;

      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #dscaw013#Comodin#;
      |DELINDEX #dscaw013; |ABRE #dscaw013;
      aAlfa = #dscam067#10;

      |DDEFECTO #dscaw013;
      #dscaw013#15 = aAlfa;        #dscaw013#0 = 1;
      #dscaw013#13 = "dscam013";   #dscaw013#14 = 0;
      #dscaw013#11 = "N";          #dscaw013#12 = 5;
      #dscaw013#5  = #dscam013#0; #dscaw013#6 = #dscam013#0;
      |GRABA 020#dscaw013.n;

      |DDEFECTO #dscaw013;
      #dscaw013#15 = aAlfa;      #dscaw013#0 = 2;
      #dscaw013#13 = "dscam013"; #dscaw013#14 = 1;
      #dscaw013#11 = "N";        #dscaw013#12 = 3;
      #dscaw013#5  = #dscam013#1;  #dscaw013#6 = #dscam013#1;
      |GRABA 020#dscaw013.n;

      nHayAsto      = 1;
      aAlfa = "dscam033.tab;" + aAlfa + ",B,V" + #dscam067#5;
      |LIBERA #dscam003; |CIERRAT #dscam003;
      |LIBERA #dscam004; |CIERRAT #dscam004;
      |LIBERA #dscam067; |CIERRAT #dscam067;
      |SUB_EJECUTA_NP aAlfa;
      |ABRET #dscam067; |LEE 101#dscam067.=;
      |ABRET #dscam003; |LEE 101#dscam003.=;
      |ABRET #dscam004; |LEE 101#dscam004.=;

      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

      |LEE 000#dscam067.s;
      FEstado = FSalida;
      Clave1 = #dscam067#1; Clave2 = #dscam067#2;
      Clave3 = #dscam067#3; |QBF Clave3;
   |SIGUE;

   |CIERRA #dscam067;
|FPRC;

|PROCESO DeshazRecup;
   |ABRE #dscam067; |DDEFECTO #dscam067;
   #dscam067#8 = 0;
   #dscam067#9 = 0;
   #dscam067#0  = "CB";
   #dscam067#1  = #dscam004#17;
   #dscam067#2  = #dscam004#3;
   #dscam067#3  = "";
   #dscam067#11 = 1;
   |LEE 000#dscam067.];
   FEstado = FSalida;
   Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
   |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
      |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3 = "";
         |SAL;
      |FINSI;
      |LEE 000#dscam067.s;
      FEstado = FSalida;
      Clave1 = #dscam067#1; Clave2 = #dscam067#2;
      Clave3 = #dscam067#3; |QBF Clave3;
   |SIGUE;

   |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
    |Y Clave3  = "";
      |LEE 000#dscam067.=;

      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #dscaw013#Comodin#;
      |DELINDEX #dscaw013; |ABRE #dscaw013;
      aAlfa = #dscam067#10;

      |DDEFECTO #dscaw013;
      #dscaw013#15 = aAlfa;        #dscaw013#0 = 1;
      #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
      #dscaw013#11 = "N";          #dscaw013#12 = 9;
      #dscaw013#5  = #dscam004#17; #dscaw013#6 = #dscam004#17;
      |GRABA 020#dscaw013.n;

      |DDEFECTO #dscaw013;
      #dscaw013#15 = aAlfa;      #dscaw013#0 = 2;
      #dscaw013#13 = "dscam004"; #dscaw013#14 = 3;
      #dscaw013#11 = "N";        #dscaw013#12 = 2;
      #dscaw013#5  = #dscam004#3;  #dscaw013#6 = #dscam004#3;
      |GRABA 020#dscaw013.n;

      aAlfa = "dscam033.tab;" + aAlfa + ",B";
      |LIBERA #dscam003; |CIERRAT #dscam003;
      |LIBERA #dscam004; |CIERRAT #dscam004;
      |LIBERA #dscam067; |CIERRAT #dscam067;
      |SUB_EJECUTA_NP aAlfa;
      |ABRET #dscam067; |LEE 101#dscam067.=;
      |ABRET #dscam003; |LEE 101#dscam003.=;
      |ABRET #dscam004; |LEE 101#dscam004.=;

      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
   |FINSI;
   |CIERRA #dscam067;

   #dscam003#40 = #dscam004#17;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      #dscam003#30 = #dscam003#30 - #dscam004#8; #dscam003#64 = #dscam003#64 - #dscam004#26;
      #dscam003#23 = #dscam003#23 - #dscam004#8; #dscam003#61 = #dscam003#61 - #dscam004#26;
      #dscam003#55 = #dscam003#55 + #dscam004#8; #dscam003#68 = #dscam003#68 + #dscam004#26;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;

   |BORRA 020#dscam004.a;
|FPRC;

|PROCESO ActualizaRec;
   eaTOperacion = "B"; enNumDocum = #dscaw997#11; |HAZ ProcesaTempo;

   |SALVA_FICHA #dscam003;
   #dscam012#0 = #dscaw997#0;
   |LEE 000#dscam012.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   #dscam013#0 = #dscaw997#0;
   #dscam013#1 = #dscaw997#1;
   |LEE 000#dscam013.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   |SI #dscam012#22 = 2; |O #dscam012#22 = 4;
      #dscam003#84 = "N";
      |GRABA 020#dscam003.a;
   |FINSI;

   |SI #dscam012#22 = 1;
      #dscam004#17 = #dscam013#16;
      #dscam004#3  = #dscam013#17;
      |LEE 101#dscam004.=;
      |SI FSalida = 0; |Y #dscam004#5 = "REM";
         || Actualiza la cabecera del recibo .....
         #dscam003#26 = "01.01.0000";
         #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
         #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
         #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
         #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
         #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;

         #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
         #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
         #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
         #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
         #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;

         #dscam003#84 = "N";

         #dscam003#14 = "R";
         #dscam003#15 = "Remesado";
         |GRABA 020#dscam003.a;

         |BORRA 020#dscam004.a; |LIBERA #dscam004;
      |FINSI;

      #dscam012#0 = #dscam013#0;
      |LEE 101#dscam012.=;
      |SI FSalida = 0;
         #dscam012#8 = "N";
         |GRABA 020#dscam012.a; |LIBERA #dscam012;
      |FINSI;
   |FINSI;
   |SI #dscam012#22 = 3;
      |SALVA_FICHA #dscam003;
      |BUCLE EliminaMovtos;
      |REPON_FICHA #dscam003;

      #dscam012#0 = #dscam013#0;
      |LEE 101#dscam012.=;
      |SI FSalida = 0;
         #dscam012#8 = "N";
         |GRABA 020#dscam012.a; |LIBERA #dscam012;
      |FINSI;
   |FINSI;
   |SI #dscam012#22 = 6; |O #dscam012#22 = 7;
      #dscam004#17 = #dscam013#16;
      #dscam004#3  = 99;
      |LEE 000#dscam004.];
      |SI FSalida = 0;
         |SI #dscam004#17 = #dscam013#16;
            |SI #dscam004#5 = "FAR"; |O #dscam004#5 = "FAP";
               |HAZ DeshazRecup;
            |FINSI;
         |SINO;
            |LEE 000#dscam004.a;
            |SI FSalida = 0;
               |SI #dscam004#17 = #dscam013#16;
                  |SI #dscam004#5 = "FAR"; |O #dscam004#5 = "FAP";
                     |HAZ DeshazRecup;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   enBanco = #dscam012#2;
   enEmpCartera = -1;      enEmpGestion = #dscam003#46;
   eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
   nImporte = #dscam013#7;
   |SI #dscam012#22 = 1; |O #dscam012#22 = 3;
      eaTipoOper = "+4";
   |SINO;
      eaTipoOper = "+6";
   |FINSI;
   |HAZ BucleRiesgo;

   eaUsuario = Usuario % 0810;
   eaDescr   = "DESHACIENDO DESCUENTO RIESGO LINEA REMESA (";
   eaDescr   = eaDescr + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam013#1) % -103) + ") CON ";
   |SI #dscaw997#12 ! "    "; |O #dscaw997#13 ! "          ";
      eaDescr   = eaDescr + " PAGARE (" + #dscaw997#12 + "/" + #dscaw997#13 + ")";
   |SINO;
      eaDescr   = eaDescr + " RECIBO (" + #dscam003#40 + ")";
   |FINSI;
   eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
   eaTipoOp  = "V";   enImpAct = #dscam012#10; enImpAnt = #dscam012#10;
   |HAZ GrabaAudit;

   #dscam013#0 = #dscam003#17;
   #dscam013#1 = #dscam003#37;
   |LEE 101#dscam013.=;
   |SI FSalida = 0;
      #dscam013#15 = "N";    #dscam013#20 = "";
      |GRABA 020#dscam013.a; |LIBERA #dscam013;
      |SI #dscam012#22 ! 6; |Y #dscam012#22 ! 7; |HAZ BorraAsto; |FINSI;

      #dscam012#0 = #dscam013#0;
      |LEE 101#dscam012.=;
      |SI FSalida = 0;
         #dscam012#9 = "N";
         |GRABA 020#dscam012.a; |LIBERA #dscam012;
      |FINSI;
   |FINSI;
   |REPON_FICHA #dscam003;
|FPRC;

|DEFBUCLE ActualizaPag;
#dscam003#7;
;
#dscaw997#12, #dscaw997#13, 000000001;
#dscaw997#12, #dscaw997#13, 999999999;
;
NULL,ActualizaRec;
|FIN;

|PROCESO LinRemesas;
   #dscam012#0 = #dscam013#0;
   |LEE 000#dscam012.=;
   |SI FSalida = 0;
      nCalc = #dscam012#22; nCalc = ((nCalc - 1) * 2) + 1;
      aAlfa = #dscam093#nCalc#; |QBF aAlfa;
      |SI aAlfa = ""; |ACABA; |FINSI;
   |FINSI;

   #dscam003#40 = #dscam013#16;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      |SI #dscaz212#2 [ #dscam003#32; |Y #dscaz212#5 ] #dscam003#32;
         nSw = 0;
         |DDEFECTO #dscam067;
         #dscam067#0 = "RM";
         #dscam067#1 = #dscam013#0;
         #dscam067#2 = #dscam013#1;
         #dscam067#3 = "V";
         |LEE 000 #dscam067.];
         |PARA; |SI FSalida = 0; |Y #dscam067#0 = "RM"; |HACIENDO;
            nCalc = #dscam067#1; nCalc1 = #dscam067#2; aAlfa = #dscam067#3; |QBF aAlfa;
            |SI nCalc > #dscam013#0; |SAL; |FINSI;
            |SI #dscam013#0 = nCalc; |Y #dscam013#1 = nCalc1; |Y aAlfa = "V";
               nSw = 1; |SAL;
            |FINSI;
            |LEE 000 #dscam067.s;
         |SIGUE;
         |SI nSw = 0;
            |DDEFECTO #dscaw997;
            #dscaw997#0 = #dscam013#0;
            #dscaw997#1 = #dscam013#1;
            #dscaw997#2 = #dscam013#6;
            #dscaw997#3 = #dscam003#32;
            #dscaw997#4 = #dscam013#13;
            #dscaw997#5 = #dscam013#2;
            #dscaw997#6 = #dscam013#4;
            #dscaw997#7 = #dscam013#3;
            #dscaw997#8 = #dscam013#5;
            #dscaw997#9 = #dscam013#7;
            #dscaw997#10 = aMarca;
            #dscaw997#11 = #dscam013#16;
            #dscaw997#12 = #dscam013#37;
            #dscaw997#13 = #dscam013#38;

            #dscam004#17 = #dscam013#16;
            #dscam004#3  = #dscam013#17;
            |LEE 000#dscam004.];
            |SI FSalida = 0;
               |LEE 000#dscam004.s;
               |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
                  #dscaw997#14 = "N";
                  #dscaw997#10 = " ";
                  nSwIncidencia = 1;
               |SINO;
                  #dscaw997#14 = "S";
               |FINSI;
            |FINSI;

            |SI #dscaw997#10 = "*"; nNumRecSel = nNumRecSel + 1; |FINSI;
            |GRABA 020#dscaw997.n;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE LinRemesas;
#dscam013#1;
6, 15;
#dscaz212#0, 001, #dscaz212#1, "S";
#dscaz212#3, 999, #dscaz212#4, "S";
;
NULL, LinRemesas;
|FIN;

|RUTINA inf;
   #dscaw997#0 = 00001;
   #dscaw997#1 = 001;
|FRUT;

|RUTINA sup;
   #dscaw997#0 = 99999;
   #dscaw997#1 = 999;
|FRUT;

|PROCESO Tipo11; |TIPO 11;
   |SI FSalida = 10; |Y #dscaw997#14 = "S";
      |SI #dscaw997#10 = " ";
         #dscaw997#10 = "*";
         nNumRecSel = nNumRecSel + 1;
      |SINO;
         #dscaw997#10 = " ";
         nNumRecSel = nNumRecSel - 1;
      |FINSI;
      |GRABA 020#dscaw997.a;
   |FINSI;
|FPRC;

|PROCESO RecibosNoCont;
   |SI #dscaw997#12 = "    "; |Y #dscaw997#13 = "          ";
      #dscam003#40 = #dscaw997#11;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         |HAZ ActualizaRec;
         |LIBERA #dscam003;
      |FINSI;
   |SINO;
      |BUCLE ActualizaPag;
   |FINSI;
|FPRC;

|DEFBUCLE RecibosNoCont;
#dscaw997#1;
10;
00001, 001, "*";
99999, 999, "*";
;
NULL, RecibosNoCont;
|FIN;

|PROCESO Tipo5w997; |TIPO 5;
   |LINEAS_BI_ATRI #dscaw997#14,S,D,-1;
|FPRC;

|PROCESO PrintIncid;
   eaMensaPrint = " - El recibo " + #dscaw997#11 + " tiene movtos.posteriores al vto.no contabilizado.";
   |PRINT;
   eaMensaPrint = "      Introduzca el asiento manualmente.";
   |PRINT;
|FPRC;

|DEFBUCLE PrintIncid;
#dscaw997#1;
14;
00001, 001, "N";
99999, 999, "N";
;
NULL, PrintIncid;
|FIN;

|PROGRAMA;
   |CLS;

   nSwArtenvas = 0;
   |HAZ EsArtenvas;
   |SI FSalida = 0; nSwArtenvas = 1; |FINSI;

   |CABEZA "";
   |PINPA #0#dscaz212; |PINDA #0#dscaz212;
   |ENDATOS #1#dscaz212;
   |SI FSalida = 0;
      aAlfa = "tmp" + Usuario; |NOME_DAT #dscaw997#aAlfa#;
      |DELINDEX #dscaw997; |ABRE #dscaw997;
      aAlfa = "    N" + &191 + " Marcar todas las lineas resultantes ?";
      |CONFI aAlfa;
      |SI FSalida = 0;
         aMarca = "*";
      |SINO;
         aMarca = " ";
      |FINSI;
      nNumRecSel = 0;
      |ABRE #dscam003; |ABRE #dscam004; |ABRE #dscam067;
      |ABRE #dscam012; |ABRE #dscam093;

      #dscam093#0 = "V";
      |LEE 000#dscam093.=;
      |SI FSalida ! 0; |DDEFECTO #dscam093; |FINSI;

      nSwIncidencia = 0;
      |BUCLE LinRemesas;
      |CIERRA #dscam012; |CIERRA #dscam093;
      |CIERRA #dscam003; |CIERRA #dscam004; |CIERRA #dscam067;
      |ENTLINEAL #1#dscaw997, 2, 4, 20, 1, inf, sup;

      |SI nNumRecSel > 0;
         aAlfa = "    N" + &191 + " Desea volcar los datos editados ? ";
         |CONFI aAlfa;
         |SI FSalida = 0;
            |ABRE #dscam013; |ABRE #dscam003; |ABRE #dscam012; |ABRE #dscam004;
            |BUCLE RecibosNoCont;
            |CIERRA #dscam013; |CIERRA #dscam003; |CIERRA #dscam012; |CIERRA #dscam004;
         |FINSI;
      |FINSI;
      |SI nSwIncidencia = 1;
         aAlfa = "    SSe han encontrado incidencias. " + &191 + " Desea imprimirlas ?";
         |CONFI aAlfa;
         |SI FSalida = 0;
            |IMPRE 0;
            |SI FSalida = 0;
               |INFOR "dscaz212";
               |SI FSalida = 0;
                  |BUCLE PrintIncid;
                  |PIEINF; |FININF;
               |FINSI;
               |FINIMP;
            |FINSI;
         |FINSI;
      |FINSI;

      |CIERRA #dscaw997; |DELINDEX #dscaw997;
   |FINSI;
|FPRO;
