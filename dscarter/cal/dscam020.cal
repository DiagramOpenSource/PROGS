|FICHEROS;
     dscam020 #0;
     dscam018 #1,MANTE;
     dscam023 #2,MANTE;
     dscam024 #3;
     dscam038 #4;

     dscam105 #105;     ||Historico Clas. Riesgos.
     dscam120;          ||Historico importaciones
|FIN;

|VARIABLES;
     nUltimo  = 0;
     nOpcion  = 0;

     aMensaje = "";

     RiesgoUtil = 0;
     ModoEntrada = 0;
     Comodin = "";
     Cont  = 0;
     nModo = 0;
     aAlfa = "";

     aNifQbf1   = "";
     aNifQbf2   = "";

 {-1}aMenu  = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = "";
     aMenu4 = "CI";
     aMenu5 = "historico Clasificaciones";
     aMenu6 = "historico Importaciones";

     &enSwPonBoton       = 0;
     &enCuadroIni        = 0;
     &enCuadroFin        = 0;
     &eaTitulo           = "";
     &eaVarDni           = "";
     &enCalcCif          = 0;
     &TipoCliente        = "";
     &CodCliente         = "";
     &DCampoG            = 0;
     &HCampoG            = 0;
     &DCampoC            = 0;
     &HCampoC            = 0;
     &Nombre             = "";
     &Direccion          = "";
     &CP1       = "";
     &CP2       = "";
     &Poblacion = "";
     &Provincia = "";
     &DNI       = "";
     &Telefono  = "";
     &Fax       = "";

     &eaUsuario = "";
     &enImpAnt = 0;
     &enImpAct = 0;
     &eaDescr = "";
     &eaTipoReg = "";
     &eaNumero = "";
     &eaTipoOp = "";
     &eaFicher = "";
     &eaClave = "";
|FIN;

|PROCESO ExistClient;
   |SI FSalida = 2; |ACABA; |FINSI;

   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 1; |O #dscam020#4 ! Contenido;
      TipoCliente = "G";
      CodCliente  = #dscam020#Campo#; DCampoG = 0; HCampoG = 999;
      |HAZ ExisteCliente;
      |SI TipoCliente = "ERROR";
         |PARA Cont = 5; |SI Cont [ 13; |HACIENDO Cont = Cont + 1;
            #dscam020#Cont# = "";
            |PINTA #dscam020#Cont#;
         |SIGUE;
         |ERROR;
      |SINO;
         #dscam020#Campo# = CodCliente;
         |PINTA #dscam020#Campo#;
         #dscam020#5  = Nombre;      || Nombre Cliente
         #dscam020#6  = Direccion;   || Direccion Cliente
         #dscam020#7  = CP1;         || C.P.1 Cliente
         #dscam020#8  = CP2;         || C.P.2 Cliente
         #dscam020#9  = Poblacion;   || Poblacion Cliente
         #dscam020#10 = Provincia;   || Provincia Cliente
         #dscam020#11 = DNI;         || DNI Cliente
         #dscam020#12 = Telefono;    || Telefono Cliente
         #dscam020#13 = Fax;         || Fax Cliente
         |PARA Cont = 5; |SI Cont [ 13; |HACIENDO Cont = Cont + 1;
            |PINTA #dscam020#Cont#;
         |SIGUE;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO CalcDNI;
     |SI FSalida = 10;
          eaVarDni  = #dscam020#11;
          |HAZ CalculoDNI;
          #dscam020#11 = eaVarDni;
          |PINTA #dscam020#11;
          |ERROR; |ACABA;
     |FINSI;

     eaVarDni  = #dscam020#11;
     |HAZ CalculoDNI;

     aNifQbf1 = #dscam020#11;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
          aAlfa = "0000NEl NIF puede ser erróneo."+&13+"¿Desea calcularlo?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               #dscam020#11 = eaVarDni; |PINTA #dscam020#11;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Recalcula1;
   |SELECT #4#dscam038;
   #dscam038#5 = #48#0;
   #dscam038#6 = #dscam024#1;
   #dscam038#0 = 0;
   #dscam038#1 = 1;
   |LEE 000#dscam038.];
   |SI FSalida = 0; |Y #dscam038#5 = #48#0; |Y #dscam038#6 = #dscam024#1;
      |SI #dscam038#8 = "R";
         RiesgoUtil = RiesgoUtil + #dscam024#2 + #dscam024#3 + #dscam024#4;
         RiesgoUtil = RiesgoUtil + #dscam024#6 + #dscam024#7 - #dscam024#5;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Recalcula1;
#dscam024#1;
;
#dscam023#0,01;
#dscam023#0,99;
;
NULL,Recalcula1;
|FIN;

|PROCESO RiesgoDisp1;
   #dscam024#9 = #dscam023#19 - #dscam023#20;
   |GRABA 020#dscam024.a; |LIBERA #dscam024;
|FPRC;

|DEFBUCLE RiesgoDisp1;
#dscam024#1;
;
#dscam023#0,01;
#dscam023#0,99;
;
NULL,RiesgoDisp1;
|FIN;

|PROCESO Baja020; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;

   |SI ModoEntrada = 3;
      |HAZ GrabaHistorico;

      |HAZ ModExped;

      eaUsuario = Usuario % 0810;
      eaDescr   = "BAJA CLASIFICACION RIESGO (" + (("000" + #dscam020#0) % -103) + "/" + #dscam020#2;
      eaDescr   = eaDescr + ") DESDE MANTENIMIENTO";
      eaTipoReg = "CR";  eaNumero = ("000" + #dscam020#0) % -103;
      eaTipoOp  = "B";   enImpAnt = 0; enImpAct = 0;
      eaFicher = "dscam020"; eaClave = #dscam020#0 + "/" + #dscam020#2;
      |HAZ GrabaAudit;
   |FINSI;
|FPRC;

|PROCESO Alta020; |TIPO 3;
   ModoEntrada = (FEntrada / 100) ! 0;

   |SI ModoEntrada = 1;
      |HAZ GrabaHistorico;

      eaUsuario = Usuario % 0810;
      eaDescr   = "ALTA CLASIFICACION RIESGO (" + (("000" + #dscam020#0) % -103) + "/" + #dscam020#2;
      eaDescr   = eaDescr + ") DESDE MANTENIMIENTO";
      eaTipoReg = "CR";  eaNumero = ("000" + #dscam020#0) % -103;
      eaTipoOp  = "A";   enImpAnt = 0; enImpAct = 0;
      eaFicher = "dscam020"; eaClave = #dscam020#0 + "/" + #dscam020#2;
      |HAZ GrabaAudit;
   |FINSI;

   |SI ModoEntrada = 2;
      |HAZ GrabaHistorico;

      |HAZ ModExped;
      eaUsuario = Usuario % 0810;
      eaDescr   = "MODIFICACION CLASIFICACION RIESGO (" + (("000" + #dscam020#0) % -103) + "/" + #dscam020#2;
      eaDescr   = eaDescr + ") DESDE MANTENIMIENTO";
      eaTipoReg = "CR";  eaNumero = ("000" + #dscam020#0) % -103;
      eaTipoOp  = "M";   enImpAnt = 0; enImpAct = 0;
      eaFicher = "dscam020"; eaClave = #dscam020#0 + "/" + #dscam020#2;
      |HAZ GrabaAudit;
   |FINSI;
|FPRC;

|PROCESO ModExped;
      |ABRE #dscam023;   |ABRE #dscam024;
      |DBASE aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "fich/"; |PATH_DAT #4 aAlfa;
      |ABRE #dscam038;
      #dscam023#0 = #dscam020#4;
      |LEE 101#dscam023.=;
      |SI FSalida = 0;
         |SI #dscam023#2 = #dscam020#0; |Y #dscam023#5 = #dscam020#2;
            |SI ModoEntrada = 3;
               #dscam023#2 = 0; #dscam023#5 = "";
               #dscam023#11 = #dscam023#11 - #dscam020#15;
               #dscam023#13 = #dscam023#13 - #dscam020#17;
            |SINO;
               #dscam023#11 = #dscam020#15;
               #dscam023#13 = #dscam020#17;
            |FINSI;
            #dscam023#7  = #dscam020#18;
            #dscam023#8  = #dscam020#19;
            #dscam023#12 = #dscam020#14;
            #dscam023#14 = #dscam020#16;
            #dscam023#19 = #dscam023#13 + #dscam023#15 + #dscam023#17;

            RiesgoUtil = 0;
            |BUCLE Recalcula1;
            #dscam023#20 = RiesgoUtil;
            |GRABA 020#dscam023.a; |LIBERA #dscam023;
            |LEE 000#dscam023.=;

            |BUCLE RiesgoDisp1;
         |FINSI;
      |FINSI;
      |CIERRA #dscam024; |CIERRA #dscam023; |CIERRA #dscam038;
|FPRC;

|PROCESO GrabaHistorico;
     ||TODO CCC
     |ABRE #dscam105;
     #dscam105#0 = #dscam020#0;
     #dscam105#1 = #dscam020#2;
     #dscam105#2 = 999;
     |LEE 000#dscam105.];
     |SI FSalida = 0;
          |LEE 000#dscam105.a;
     |SINO;
          |LEE 000#dscam105.u;
     |FINSI;
     |SI FSalida = 0; |Y #dscam105#0 = #dscam020#0; |Y #dscam105#1 = #dscam020#2;
          nUltimo = #dscam105#2 + 1;
     |SINO;
          nUltimo = 1;
     |FINSI;
     |DDEFECTO #dscam105;
     #dscam105#0 = #dscam020#0;
     #dscam105#1 = #dscam020#2;
     #dscam105#2 = nUltimo;
     |LEE 101#dscam105.=;
     |SI FSalida ! 0;
          #dscam105#3 = #dscam020#4;
          #dscam105#4 = #dscam020#14;
          |SI ModoEntrada = 3;
               #dscam105#5 = 0;
          |SINO;
               #dscam105#5 = #dscam020#15;
          |FINSI;
          #dscam105#6 = #dscam020#16;
          |SI ModoEntrada = 3;
               #dscam105#7 = 0;
          |SINO;
               #dscam105#7 = #dscam020#17;
          |FINSI;
          |GRABA 020#dscam105.n
          |LIBERA #dscam105;
     |FINSI;
     |CIERRA #dscam105;
|FPRC;

|PROCESO Dat020; |TIPO 13;
     |HAZ TomaDecim;
|FPRC;

|PROCESO ObserLin; |TIPO 11;
   |SI FSalida = 10;
      enCuadroIni  = 1805;
      enCuadroFin  = 2275;
      eaTitulo     = " Observaciones ";
      aAlfa = (("000" + #dscam105#0) % -103) + "/" + #dscam105#1 + "/" + (("000" + #dscam105#2) % -103);
      aAlfa = "dscaz200.tab;" + aAlfa;
      |SUB_EJECUTA aAlfa;
   |FINSI;
|FPRC;

|PROCESO inferior105;
     #dscam105#0 = #dscam020#0;
     #dscam105#1 = #dscam020#2;
     #dscam105#2 = 001;
|FPRC;

|PROCESO superior105;
     #dscam105#0 = #dscam020#0;
     #dscam105#1 = #dscam020#2;
     #dscam105#2 = 999;
|FPRC;

|PROCESO Historico;
     |LEE 000#dscam020.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |PUSHV 0501 2380;
     |ENTLINEAL #1#dscam105,3,4,20,1,inferior105,superior105;
     |POPV;
|FPRC;

|PROCESO inferior120;
     #dscam120#0 = #dscam020#0;
     #dscam120#1 = #dscam020#2;
     #dscam120#2 = 00001;
|FPRC;

|PROCESO superior120;
     #dscam120#0 = #dscam020#0;
     #dscam120#1 = #dscam020#2;
     #dscam120#2 = 99999;
|FPRC;

|PROCESO HistImporta;
     |LEE 000#dscam020.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |PUSHV 0501 2380;
     |ENTLINEAL #1#dscam120, 3, 4, 20, 1, inferior120, superior120;
     |POPV;
|FPRC;

|PROCESO T20; |TIPO 20;
     |SI FSalida = "OPCION";
         FSalida = "Historicos";
         |ACABA;
     |FINSI;

     nOpcion = 1;
     |PARA;  |SI;  |HACIENDO;
         aMenu2 = nOpcion;
         |MENU aMenu;
         nOpcion = FSalida;
         |SI nOpcion ! 1;  |Y nOpcion ! 2;
             |SAL;
         |FINSI;

         |SI nOpcion = 1;
             |HAZ Historico;
         |FINSI;

         |SI nOpcion = 2;
             |HAZ HistImporta;
         |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Tip80; |TIPO 80;
     |SUB_EJECUTA_NP "dscaz155";        ||Recalculo del historico si vacio
|FPRC;
