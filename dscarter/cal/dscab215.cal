|FICHEROS;
     dscam003 #3;
     dscam224 #224;

     &canempr@;
     &caclipr@;
     &camoned@;
     &cacuent@;

     &agif041@;
     &agif112@;
     &agif024@;
     &agif321@;
     &agif324@;
     &agif325@;
     &dsm00289@;
|FIN;

|VARIABLES;
     &enError = 0;
     &HayConta = 0;
     &HayGestion = 0;
     aBase = "";
     aAlfa = "";
     aEmp = "";
     &enDsm00289 = 1;
     &eaRefMand = "";
     &eaCodIBAN = "";
     &eaCodBIC = "";
     &eaFechaMand = "";
     &eaNif = "";
     &eaCodigo = "";
|FIN;

|PROCESO CargaContaGes;
     enError = 1;
     |SI #3#46 = 0;
          |DBASS aBase;
          aBase = aBase + "contagen/";
          aAlfa = aBase + "def/canempre"; |CARGA_DEF aAlfa, canempr@;
          |SI FSalida ! 0;
               |DBASS aBase;
               aBase = aBase + "agicont/";
               aAlfa = aBase + "def/canempre"; |CARGA_DEF aAlfa, canempr@;
               |SI FSalida ! 0;
                    |MENAV "0000Error al cargar 'canempre'..."; |ACABA;
               |FINSI;
          |FINSI;
          aAlfa = aBase + "def/cacuenta"; |CARGA_DEF aAlfa, cacuent@;
          aAlfa = aBase + "def/camoneda"; |CARGA_DEF aAlfa, camoned@;
          aAlfa = aBase + "def/caclipro"; |CARGA_DEF aAlfa, caclipr@;

          aAlfa = aBase + "fich/";
          |PATH_DAT #canempr@#aAlfa#;
          |ABRE #canempr@;
          #canempr@#2 = #3#44;
          #canempr@#3 = #3#45;
          |LEE 020#canempr@.=;
          |SI FSalida = 0;
               aEmp = (("00000" + #3#44) % -105) + #3#45;
               aAlfa = aBase + "fich/" + aEmp + "/";
               |PATH_DAT #cacuent@#aAlfa#;
               |PATH_DAT #camoned@#aAlfa#;
               |PATH_DAT #caclipr@#aAlfa#;
               |ABRE #cacuent@;
               |ABRE #camoned@;
               |ABRE #caclipr@;
               HayConta = 1;
          |FINSI;
     |SINO;
          |DBASS aBase;
          aBase = aBase + "dscomer9/";
          aAlfa = aBase + "def/agifa041"; |CARGA_DEF aAlfa, agif041@;
          |SI FSalida ! 0;
               |MENAV "0000Error al cargar 'agifa041'..."; |ACABA;
          |FINSI;
          aAlfa = aBase + "def/agifa325"; |CARGA_DEF aAlfa, agif325@;
          aAlfa = aBase + "def/agifa324"; |CARGA_DEF aAlfa, agif324@;
          aAlfa = aBase + "def/agifa321"; |CARGA_DEF aAlfa, agif321@;
          aAlfa = aBase + "def/agifa024"; |CARGA_DEF aAlfa, agif024@;
          aAlfa = aBase + "def/agifa112"; |CARGA_DEF aAlfa, agif112@;
          aAlfa = aBase + "def/dsm00289"; |CARGA_DEF aAlfa, dsm00289@;
          enDsm00289 = FSalida;

          aAlfa = aBase + "fich/";
          |PATH_DAT #agif041@#aAlfa#;
          |ABRE #agif041@;
          #agif041@#0 = #3#46;
          |LEE 020#agif041@.=;
          |SI FSalida = 0;
               aEmp = (("00000" + #3#46) % -105);
               aAlfa = aBase + "fich/" + aEmp + "/";
               |PATH_DAT #agif325@#aAlfa#;
               |PATH_DAT #agif324@#aAlfa#;
               |PATH_DAT #agif321@#aAlfa#;
               |PATH_DAT #agif024@#aAlfa#;
               |PATH_DAT #agif112@#aAlfa#;
               |ABRE #agif325@;
               |ABRE #agif324@;
               |ABRE #agif321@;
               |ABRE #agif321@;
               |ABRE #agif024@;
               |ABRE #agif112@;
               |SI enDsm00289 = 0;
                    |PATH_DAT #dsm00289@#aAlfa#;
                    |ABRE #dsm00289@;
               |FINSI;
               HayGestion = 1;
          |FINSI;
     |FINSI;
     enError = 0;
|FPRC;

|PROCESO DescargaContaGes;
     |SI HayConta = 1;
          |CIERRA #caclipr@; |DESCARGA_DEF #caclipr@;
          |CIERRA #camoned@; |DESCARGA_DEF #camoned@;
          |CIERRA #cacuent@; |DESCARGA_DEF #cacuent@;
          |CIERRA #canempr@; |DESCARGA_DEF #canempr@;
     |FINSI;

     |SI HayGestion = 1;
          |SI enDsm00289 = 0;
               |CIERRA #dsm00289@; |DESCARGA_DEF #dsm00289@;
          |FINSI;
          |CIERRA #agif112@; |DESCARGA_DEF #agif112@;
          |CIERRA #agif024@; |DESCARGA_DEF #agif024@;
          |CIERRA #agif321@; |DESCARGA_DEF #agif321@;
          |CIERRA #agif324@; |DESCARGA_DEF #agif324@;
          |CIERRA #agif325@; |DESCARGA_DEF #agif325@;
          |CIERRA #agif041@; |DESCARGA_DEF #agif041@;
     |FINSI;
|FPRC;

|PROCESO RefMandato;
     |QBF eaNif;
     eaRefMand = eaNif + "CLI" + eaCodigo;
     |SI enDsm00289 = 0;
          #dsm00289@#0 = eaCodigo;
          |LEE 101#dsm00289@.=;
          |SI FSalida ! 0;
               #dsm00289@#1 = eaRefMand;
               |GRABA 020#dsm00289@.n;
          |SINO;
               aAlfa = #dsm00289@#1; |QBF aAlfa;
               |SI aAlfa = "";
                    #dsm00289@#1 = eaRefMand;
                    |GRABA 020#dsm00289@.a;
               |SINO;
                    eaRefMand = aAlfa;
               |FINSI;
          |FINSI;
     |FINSI;

     |DDEFECTO #224;

     |ABRE #224;
     #224#0 = #3#40;
     |LEE 101#224=;
     |SI FSalida ! 0; |GRABA 020#224b; |FINSI;

     aAlfa = #224#1; |QBF aAlfa;
     |SI aAlfa = ""; #224#1 = eaCodIBAN; |FINSI;

     aAlfa = #224#2; |QBF aAlfa;
     |SI aAlfa = ""; #224#2 = eaCodBIC; |FINSI;

     |SI #224#3 = "01.01.0000"; #224#3 = eaFechaMand; |FINSI;

     aAlfa = #224#4; |QBF aAlfa;
     |SI aAlfa = ""; #224#4 = eaRefMand; |FINSI;

     |GRABA 020#224a;
     |CIERRA #224;

     eaCodIBAN = #224#1;
     eaCodBIC = #224#2;
     eaFechaMand = #224#3;
     eaRefMand = #224#4;
|FPRC;
