|FICHEROS;
   dscam012 #0;
   dscam013 #1;
   dscam014 #2,MANTE;
   dscam003 #3;
   dscaw001 #4,MANTE;
   dscam004 #7;
   dscaw028 #8,MANTE;
   dscam051 #9;
   dscam030 #10;
   dscam044 #11;
   dscam045 #12;

   &agif324@ #10;
   &agif321@ #11;
   &canempr@ #12;
   dscaw013  #13;
   dscam067  #14;
   &camasic@ #15;
   dscam042  #16;
   dscam090  #17;
   dscam081  #18;
   dscam082  #19;
   dscaw111  #20,MANTE;
   dscam224;

   FactVta@  #1000;
   FactDir@  #1001;

   referen@ #100;
|FINSI;

|VARIABLES;
     fFecRem = @;
     fFecEmi = @;
     nSwIn = 0;
     nImpRec = 0; nImpFac = 0; nImpVto = 0;
     aPath = "";
     nSal134 = 0;
     nSal84 = 0;
   nSwRemeAuto = 0;
   &PRMNT_enError = 0;
   &eaFichClas = "";  &eaTipoClas = ""; &enSwClas = 0;
   &Divisa = ""; &NombreDiv = ""; &enRemesa = 0;
   &enEmpCartera = 0; &enEmpGestion = 0;
   &eaClvUsuarios = ""; &enBotonUsuarios = 0;
   &enRiesgoUsado = 0; &enRiesgoConced = 0; &enRiesgoFact = 0;
   &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = ""; &enBanco = 0;
   &PosLibro = 0; &PosSerie = 0; &PosFactu = 0; &PosRecib = 0; &enDocum = 0;
   &enLibro = 0;  &enFactura = 0; &enRecibo = 0; &eaLlamada = ""; &eaFicher = ""; &eaClave = "";
   &enTipoRec = 0;
   &eaSesion  = "";
   &TotalSel  = 0;

   &eaEntidad  = "";
   &eaSucursal = "";
   &eaDC       = "";
   &eaCuenta   = "";

   &efFecha      = @;
   &eaEmpContab  = "";
   &eaDirConta   = "";
   &enTipoRem    = 0;

   SwClave     = 0; nDocAnt = 0;
   nSwLuxe     = 0;
   nSwHay      = 0;
   nSwRec      = 0;
   nSwCartel   = 0;
   nEmpresa    = 0;
   nTotalInt   = 0;
   nFlag       = 0;
   nSwMiraGesEnvia = 0;
   nSwGesEnvia = 0;

   &Fichero   = ""; &Cmp = "";      &Tipo = "";     &CmpNum = 0;
   &eaTipoRecibo = ""; &enNumDocum = 0; &eaMensRet = ""; &enSwError = 0; &eaTOperacion = "";

   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = "";
   &enSwLineal = 0; &enClave = 0;

   nDTRecibo = 0;
   nHTRecibo = 0;
   nSwBorra  = 0;
   nSwError  = 0;
   nSwBucle  = 0;
   nLineaRem = 0;

   nHandle   = 0;

   nCont     = 0;
   nCalc1    = 0;
   nCalc2    = 0;
   nTimbre   = 0;
   nLinea    = 0;
   nSwArtenvas = 0;

   nModo     = 0;

   fDFechaVto  = @;
   fHFechaVto  = @;
   aDSituacion = "";
   aHSituacion = "";
   nDImporte   = 0;
   nHImporte   = 0;
   nSwCobConf  = 0;
   aDomicil    = "";

   nSw       = 0;
   nSwErr    = 0;
   nImporteB = 0;
   nImporteD = 0;
   aConfirmacion = "";
   aNumEntid  = "";
   aNumDocum  = "";
   aResp      = "";
   aDirApp    = "";
   nAutom     = 0;
   Clave1     = 0;
   Clave2     = 0;
   Clave3     = "";
   NumRemesa  = 0;
   VtoAsto    = 0;
   EmiAsto    = 0;
   HayVtos    = 0;
   NumDocum   = 0;
   NumLinea   = 0;
   Codigo     = 0;
   Linea      = 0;
   FEstado = 0;
   LinBucle = 0;
   SwError = 0; SwSalir = 0;

   Marca   = 0;
   Mensaje = 0;
   Mensaje1 = 0;
   ModoEntrada = 0;

   aAlfa = ""; aAlfa1 = ""; aAlfa2 = "";

   NumDias  = 0;
   nPorcInt = 0;
   nInteres = 0;
   Calc     = 0;
   Calc1    = 0;
   Calc2    = 0;

   LinCob = 0;
   Flag = 0;
   DVen = "N"; HVen = "N";
   CambioBase = 0;
   nNumCob  = 0;
   nNumRem  = 0;
   nNumLRem = 0;

   UltimaOper = ""; Empresa = 0;

   Modo1    = "";
   Modo2    = "";
   FechaVto = "";
   VtoEnlace = "";
   EmiEnlace = "";
   EntPagAnt = "";
   NumPagAnt = "";
   Comodin = ""; Comodin1 = "";
   &HayGestion = 0;
   &nDeci_Base = 0; &nDeci_Div = 0; &nDeci_BaseMx = 0;

   &enSwCambioRem = 0;
   &eaTipoCod     = "";
   &ewErrorIBAN   = 0;
   &enGrupoOTP    = 0;
|FIN;

|PROCESO MiraSiFactConta;
   nSwErr = 0;
   |SI #dscam003#1  = 0;   |ACABA; |FINSI;
   |SI #dscam051#94 = "N"; |ACABA; |FINSI;

   |DFICE aAlfa; |QBF aAlfa; aAlfa = aAlfa % -106; aAlfa = aAlfa % 0105;
   nEmpresa = aAlfa;

   |DFICB aAlfa; |QBF aAlfa;
   |PATH_DAT #dscam044#aAlfa#; |PATH_DAT #dscam045#aAlfa#;
   |ABRE #dscam045; |ABRE #dscam044;
   |DDEFECTO #dscam045;
   |SELECT #2#dscam045;
   #dscam045#6 = nEmpresa;
   |LEE 000#dscam045.];
   |PARA; |SI FSalida = 0; |Y #dscam045#6 = nEmpresa; |HACIENDO;
      |SI #dscam045#2 = "V"; |Y #dscam045#0 = #dscam003#46;
         |SAL;
      |FINSI;
      |LEE 000#dscam045.s;
   |SIGUE;
   |SI #dscam045#2 ! "V"; |O #dscam045#0 ! #dscam003#46;
      |ACABA;
   |FINSI;

   #dscam044#0 = #dscam045#0;
   |LEE 000#dscam044.=;
   |SI FSalida = 0;
      aDirApp = #dscam044#1; |QBF aDirApp;
      aAlfa = aDirApp + "def/agifa134.mas";
      |CARGA_DEF aAlfa, FactVta@;
      |SI FSalida = 0;
         aAlfa = aDirApp + "def/agifa084.mas";
         |CARGA_DEF aAlfa, FactDir@;
         |SI FSalida = 0;
            aAlfa = aDirApp + "fich/" + (("00000" + #dscam045#0) % -105) + "/";
            |PATH_DAT #FactVta@#aAlfa#; |PATH_DAT #FactDir@#aAlfa#;
            |ABRE #FactVta@; |ABRE #FactDir@;
            #FactVta@#49 = #dscam003#0;
            #FactVta@#0  = #dscam003#1;
            |LEE 000#FactVta@.=;
            |SI FSalida = 0;
               |SI #FactVta@#48 = "N"; nSwErr = 1; |FINSI;
            |SINO;
               #FactDir@#48 = #dscam003#0;
               #FactDir@#0  = #dscam003#1;
               |LEE 000#FactDir@.=;
               |SI FSalida = 0;
                  |SI #FactVta@#39 = "N"; nSwErr = 1; |FINSI;
               |SINO;
                  aAlfa = "    La factura " + #dscam003#0 + "/" + #dscam003#1 + " no se encuentra en la empresa " + #dscam045#0 + " de gestion comercial";
                  |MENAV aAlfa;
               |FINSI;
            |FINSI;
            |CIERRA #FactVta@; |CIERRA #FactDir@;
            |DESCARGA_DEF #FactDir@;
         |FINSI;
         |DESCARGA_DEF #FactVta@;
      |FINSI;
   |FINSI;

   |SELECT #1#dscam045;
   |CIERRA #dscam045; |CIERRA #dscam044;
|FPRC;

|PROCESO UltimaRem;
   |SI #dscam004#5 = "EMR"; nNumCob = #dscam004#3; |FINSI;
|FPRC;

|DEFBUCLE UltimaRem;
#dscam004#1;
;
#dscam003#40, 001;
#dscam003#40, 999;
;
NULL,UltimaRem;
|FIN;

|PROCESO BuscaRemesaAnt;
     nNumRem = 0;
     nNumLRem = 0;
     fFecRem = "01.01.0000";
     |SALVA_FICHA #dscam013;
     |SELECT #4#dscam013;
     #dscam013#16 = #dscam003#40;
     #dscam013#24 = 1;
     |LEE 000#dscam013.];
     |PARA; |SI FSalida = 0; |Y #dscam013#16 = #dscam003#40; |HACIENDO;
          |SI #dscam013#0 ! #dscam012#0;
               nNumRem = #dscam013#0;
               nNumLRem = #dscam013#1;
          |FINSI;
          |LEE 000#dscam013.s;
     |SIGUE;
     |SELECT #1#dscam013;
     |REPON_FICHA #dscam013;

     |SI nNumRem ! 0;
          |SALVA_FICHA #dscam012;
          #dscam012#0 = nNumRem;
          |LEE 020#dscam012.=;
          fFecRem = #dscam012#1;
          |REPON_FICHA #dscam012;
     |FINSI;
|FPRC;

|PROCESO Contador; |TIPO 7;
   |SI nSwCartel = 1; |POPV; |FINSI;
   Empresa = #48#0;

   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada ! 1; |ACABA; |FINSI;

    |HAZ ContaRemesa;
    /*
   |ABRE #dscam012;
   |LEE 000#dscam012.u;
   |SI FSalida = 0;
      Codigo = #dscam012#0;
      |DDEFECTO #dscam012;
      #dscam012#0 = Codigo + 1;
      |PINTA #dscam012#0;
   |FINSI;
   |CIERRA #dscam012;
   |PINDA #0#dscam012;
   */
|FPRC;

|PROCESO ImprimeCobros;
   |PINTA 2257, #dscam004#4;
   |PINTA 1557, #dscam004#16;
   |PINTA 1667, #dscam004#7;
   |PINTA 1767, #dscam004#8;
   |PINTA 1867, #dscam004#9;
   |PINTA 1967, #dscam004#10;
   |PINTA 2274, #dscam004#11;
   |PINTA Calc, #dscam004#3;
   Calc = Calc + 4;
   |PINTA Calc, #dscam004#5;
   Calc = Calc + 6;
   |PINTA Calc, #dscam004#6;
   Calc = Calc + 90;
   |SI Calc > 1178; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE ImprimeCobros;
   #dscam004#1;
   ;
   #dscam003#40,LinBucle;
   #dscam003#40,99;
   ;
   NULL,ImprimeCobros;
|FIN;

|PROCESO RecogeRec;
   |HAZ ComprTotVta;
   |SI #dscam012#22 = 3; |O #dscam012#22 = 4; |O #dscam012#22 = 7; |ACABA; |FINSI;

   |SI nAutom = 0;
      enSwError = 0;
      eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
      |SI enSwError = 1; |ERROR; |ACABA; |FINSI;
   |FINSI;

/*   Aqui no entra nunca, cambiado a proceso "Busca"

   |SI FSalida = 10;
      |ABRE #dscam003;
      |ABRE #dscam004;
      #dscam003#40 = #dscam013#16;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         Divisa = #dscam003#57; |HAZ TomaDecim;
         |PUSHV 0501 2380;
         |PINPA #0#dscam003;
         |PINDA #0#dscam003;
         #dscam004#17 = #dscam003#40;
         #dscam004#3  = 99;
         |LEE 000#dscam004.];
         |SI FSalida = 0;
            |SI #dscam004#17 = #dscam003#40;
               |LEE 000#dscam004.a; |LEE 000#dscam004.a; |LEE 000#dscam004.a;
               |LEE 000#dscam004.a;
               LinBucle = #dscam004#3;
            |SINO;
               |LEE 000#dscam004.a;
               |SI FSalida = 0;
                  |SI #dscam004#17 = #dscam003#40;
                     |LEE 000#dscam004.a; |LEE 000#dscam004.a; |LEE 000#dscam004.a;
                     |LEE 000#dscam004.a;
                     LinBucle = #dscam004#3;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            |SI FSalida ! 111;
               |LEE 000#dscam004.u;
               |LEE 000#dscam004.a; |LEE 000#dscam004.a; |LEE 000#dscam004.a;
               |LEE 000#dscam004.a;
               LinBucle = #dscam004#3;
            |SINO;
               LinBucle = 1;
            |FINSI;
         |FINSI;
         |BUCLE ImprimeCobros;
         |PAUSA;
         |POPV;
      |SINO;
         |MENAV "    Recibo inexistente";
      |FINSI;
      |CIERRA #dscam004;
      |CIERRA #dscam003;
      eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
      |ERROR;
      |ACABA;
   |FINSI;
*/
   ModoEntrada = (FEntrada / 100) ! 0;

   |ABRE #dscam003;
   |ABRE #dscam004;

   NumDocum = #dscam013#16;
   NumLinea = #dscam013#1;
   SwError  = 0;

   |SALVA_FICHA #dscam013;
   #dscam013#0 = #dscam012#0;
   #dscam013#1 = 1;
   |LEE 000#dscam013.];
   |SI FSalida = 0; |Y #dscam013#0 = #dscam012#0;
      |PARA; |SI FSalida = 0; |Y #dscam013#0 = #dscam012#0; |HACIENDO;
         |SI #dscam013#16 = NumDocum; |Y NumLinea ! #dscam013#1;
            SwError = 1;
            |SAL;
         |SINO;
            |LEE 000#dscam013.s;
         |FINSI;
      |SIGUE;
   |FINSI;
   |LEE 000#dscam013.p;
   |REPON_FICHA #dscam013;
   |SI SwError = 1;
      |MENAV "    Recibo ya incluido";
      eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
      |ERROR;
      |ACABA;
   |FINSI;

   #dscam003#40 = #dscam013#16;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      |SI nSwLuxe = 1; |Y #dscam003#100 = "S";
         |MENAV "    Recibo no remesable";
         |CIERRA #dscam003;
         eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
         |ERROR; |ACABA;
      |FINSI;

      |SI #dscam051#111 = "S"; |Y #dscam003#72 = "    "; |Y #dscam003#70 = "          ";

              |Y nSwRemeAuto = 0; ||este chequeo ya se ha hecho al marcar los
                                  ||recibos en la seleccion de la automatica
              |Y #dscam012#22 [ 2;

          eaTipoCod = "C";
          |HAZ ChequeoIBAN;
          |SI ewErrorIBAN = 1;
             |MENAV "0000El documento indicado tiene vacio el Codigo IBAN";
             |CIERRA #dscam003;
             eaTOperacion = "B";
             eaTipoRecibo = "V";
             enNumDocum = #dscam013#16;
             |HAZ ProcesaTempo;
             |ERROR;
             |ACABA;
          |FINSI;
          |SI ewErrorIBAN = 2;
              |CONFI "0000NEl Codigo IBAN del documento indicado puede ser erroneo. Continuar";
              |SI FSalida ! 0;
                  |CIERRA #dscam003;
                  eaTOperacion = "B";
                  eaTipoRecibo = "V";
                  enNumDocum = #dscam013#16;
                  |HAZ ProcesaTempo;
                  |ERROR;
                  |ACABA;
              |FINSI;
          |FINSI;
/*
         eaEntidad  = #dscam003#8;
         eaSucursal = #dscam003#9;
         eaCuenta   = #dscam003#11;
         eaDC = "";
         |HAZ CalculoDC;
         |SI #dscam003#10 = "  ";
             |MENAV "    El documento indicado tiene vacio el DC de la cuenta bancaria";
             |CIERRA #dscam003;
             eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
             |ERROR; |ACABA;
         |SINO;
             |SI #dscam003#8 = "    "; |O #dscam003#9 = "    "; |O #dscam003#11 = "          ";
                 |MENAV "    El documento indicado tiene la cuenta bancaria con datos vacios.";
                 |CIERRA #dscam003;
                 eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
                 |ERROR; |ACABA;
             |SINO;
                 |SI eaDC ! #dscam003#10;
                     |MENAV "    El documento indicado tiene un DC incorrecto informado en la cuenta bancaria";
                     |CIERRA #dscam003;
                     eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
                     |ERROR; |ACABA;
                 |SINO;
                     |SI #dscam003#8 ! "0000"; |Y #dscam003#9 = "0000"; |Y #dscam003#11 ! "0000000000";
                         aAlfa = "    NEl documento " + #dscam003#40 + " tiene la cuenta bancaria con datos vacios. Sucursal:" + #dscam003#9;
                         |CONFI aAlfa;
                         |SI FSalida ! 0;
                             eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
                             |ERROR; |CIERRA #dscam003; |ACABA;
                         |FINSI;
                     |SINO;
                          |SI #dscam003#8 = "0000"; |O #dscam003#9 = "0000"; |O #dscam003#11 = "0000000000";
                              |MENAV "    El documento indicado tiene la cuenta bancaria con datos vacios.";
                              |CIERRA #dscam003;
                              eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
                              |ERROR; |ACABA;
                          |FINSI;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
*/
      |FINSI;

      #dscam013#2  = #dscam003#27; |PINTA #dscam013#2;
      #dscam013#3  = #dscam003#1;  |PINTA #dscam013#3;
      #dscam013#4  = #dscam003#0;  |PINTA #dscam013#4;
      #dscam013#5  = #dscam003#2;  |PINTA #dscam013#5;
      |SI #dscam003#14 = "F";
         #dscam013#6  = #dscam003#71;
      |SINO;
         #dscam013#6  = #dscam003#3;
      |FINSI;
      |PINTA #dscam013#6;
      #dscam013#11 = #dscam003#5;  |PINTA #dscam013#11;
      #dscam013#13 = #dscam003#6;  |PINTA #dscam013#13;
      #dscam013#31 = #dscam003#12;

      |SI #dscam012#22 = 5;
         |SI #dscam003#97 = "N"; aAlfa = "N"; |SINO; aAlfa = "S"; |FINSI;
      |SINO;
         |SI #dscam003#97 = "S"; aAlfa = "N"; |SINO; aAlfa = "S"; |FINSI;
      |FINSI;

      |SI aAlfa = "N";
         |MENAV "    El documento seleccionado no puede entrar en este tipo de remesa ";
         |CIERRA #dscam003;
         eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
         |ERROR; |ACABA;
      |FINSI;

      enSwClas   = 1; eaFichClas = "dscam012"; eaTipoClas = #dscam003#12;
      |HAZ CompruebaClas;
      |SI eaFichClas = "ERROR";
         |MENAV "    Documento inoperable en el perfil actual ";
         |CIERRA #dscam003;
         eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
         |ERROR; |ACABA;
      |FINSI;
      |SI eaFichClas = "INFOR";
         |CONFI "    Documento inoperable en el perfil actual. Cambiar Tipo recibo ?";
         |SI FSalida = 0;
            |CIERRA #dscam003;
            eaFichClas = "dscam012";
            enNumDocum = #dscam003#40; enTipoRec = #dscam003#12; |HAZ CambiaTR;
         |SINO;
            |CIERRA #dscam003;
            eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam003#40; |HAZ ProcesaTempo;
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;

      |SI #dscam003#90 = "N"; |Y #dscam051#75 = "N";
         |MENAV "    El documento seleccionado no ha sido preparado ";
         |CIERRA #dscam003;
         eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
         nSwRec = 1;
         |ERROR; |ACABA;
      |FINSI;

      Divisa = #dscam003#57; |HAZ TomaDecim;
      |SI #dscam003#22 [ 0;
         |CIERRA #dscam003;
         eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
         |ERROR;
         |ACABA;
      |FINSI;

      |SI ModoEntrada = 1; |O #dscam013#16 ! Contenido;
         |SI #dscam051#2 = "N";
            Calc1 = #dscam012#1;
            Calc2 = #dscam003#3;
            NumDias = Calc2 - Calc1;
            |SI NumDias < 0;
               |MENAV "    Recibo vencido";
               |CIERRA #dscam003;
               eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
               |ERROR;
               |ACABA;
            |FINSI;
         |FINSI;

         |SI #dscam051#112 = "N";
            |SI #dscam003#14 = "I";
               |MENAV "    Recibo impagado";
               |CIERRA #dscam003;
               eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
               |ERROR; |ACABA;
            |FINSI;
         |FINSI;

         |SI nSwGesEnvia = 1; |Y #dscam012#22 = 5;
            |SI #dscam003#51 ! #dscam012#2;
               |MENAV "    El banco del recibo no coincide con el de la remesa";
               |CIERRA #dscam003;
               eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
               |ERROR; |ACABA;
            |FINSI;
         |SINO;
            |SI #dscam003#51 ! #dscam012#2; |Y #dscam051#7 = "S";
               |SI #dscam014#40 = "N";
                  |MENAV "    El banco del recibo no coincide con el de la remesa";
                  |CIERRA #dscam003;
                  eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
                  |ERROR;
                  |ACABA;
               |FINSI;
            |FINSI;
         |FINSI;

         |SI #dscam012#22 = 1; |O #dscam012#22 = 2; |O #dscam012#22 = 5; |O #dscam012#22 = 6;
            |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
               |MENAV "    Este recibo es una entrega a cuenta";
               |CIERRA #dscam003;
               eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
               nSwRec = 1;
               |ERROR; |ACABA;
            |FINSI;
         |FINSI;

         |SI #dscam003#14 = "L";
            |MENAV "    Recibo liquidado";
            |CIERRA #dscam003;
            eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
            |ERROR;
            |ACABA;
         |FINSI;
         |SI #dscam003#14 = "A";
            |MENAV "    Recibo anulado o agrupado";
            |CIERRA #dscam003;
            eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
            |ERROR;
            |ACABA;
         |FINSI;
         |SI #dscam003#14 = "D";
            |MENAV "    Recibo anulado o dividido";
            |CIERRA #dscam003;
            eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
            |ERROR;
            |ACABA;
         |FINSI;
         |SI #dscam051#42 = "S";
            |SI #dscam003#28 = "S"; |Y #dscam003#29 = "N";
               |MENAV "    Recibo no aceptado";
               |CIERRA #dscam003;
               eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
               |ERROR;
               |ACABA;
            |FINSI;
         |FINSI;
         |SI #dscam003#14 = "R";
            |MENAV "    Recibo remesado";
            |CIERRA #dscam003;
            eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
            |ERROR;
            |ACABA;
         |FINSI;
         |SI #dscam003#14 = "T"; |Y #dscam012#22 ! 3; |Y #dscam012#22 ! 4;
            |MENAV "    Recibo agrupado en un talon/pagare";
            |CIERRA #dscam003;
            eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
            |ERROR;
            |ACABA;
         |FINSI;
      |FINSI;
   |SINO;
      |MENAV "    Recibo inexistente";
      |CIERRA #dscam003;
      eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
      |ERROR;
      |ACABA;
   |FINSI;

   |SI #dscam051#124 = "S"; |Y ModoEntrada = 1; |Y #dscam012#22 ! 5;
      Calc = #dscam014#13 + #dscam003#65;
      |SI Calc > #dscam014#12; |Y Mensaje = 0;
         Mensaje = 1;
         |CONFI "0400NRiesgo del banco superado.¨Continuar?";
         |SI FSalida ! 0;
            eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
            nSwRec = 1;
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;
   |FINSI;

   |SI #dscam051#123 = "S"; |Y ModoEntrada = 1;
      eaCliGest = #dscam003#32; |HAZ SacaRiesgo;
      Calc = enRiesgoUsado + #dscam003#65 - enRiesgoFact;
      |SI Calc > enRiesgoConced;
         |CONFI "0400NRiesgo de cliente superado.¨ Continuar ?";
         |SI FSalida ! 0;
            eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
            nSwRec = 1;
            |ERROR; |ACABA;
         |FINSI;
      |SINO;
         |SI enRiesgoUsado < 0;
            |SI Mensaje = 0;
               |MENAV "    Riesgo de cliente no definido";
               Mensaje = 1;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   #dscam013#22 = #dscam003#31;
   #dscam013#7  = #dscam003#65;
   |SI #dscam003#14 = "F";
      #dscam013#6  = #dscam003#71;
   |SINO;
      #dscam013#6  = #dscam003#3;
   |FINSI;
   #dscam013#11 = #dscam003#5;
   #dscam013#31 = #dscam003#12;

   |SI #dscam012#22 = 6; |O #dscam012#22 = 7;
      #dscam013#40 = (#dscam003#65 % #dscam012#29) ! nDeci_Base;
      #dscam013#41 = #dscam003#65 - #dscam013#40;
   |FINSI;

   |SI HayGestion = 1;
      Fichero = "Divisas"; Tipo = "G"; Cmp = "Codigo Divisa"; |HAZ ObtenDato;
      #agif324@#CmpNum# = #dscam003#57;
      |LEE 000#agif324@.=;
      |SI FSalida = 0;
         Fichero = "Divisas"; Tipo = "G"; Cmp = "Valor Venta"; |HAZ ObtenDato;
         #dscam013#21 = CambioBase / #agif324@#CmpNum#;
         #dscam013#23 = #dscam003#59;
         Fichero = "Divisas"; Tipo = "G"; Cmp = "Num.Decimales"; |HAZ ObtenDato;
         nDeci_Div = #agif324@#CmpNum#;
      |FINSI;
   |SINO;
      |SI #dscam003#57 ! "EUR";
         #dscam013#21 = 1; #dscam013#23 = 1; nDeci_Div = 2;
      |FINSI;
   |FINSI;

   || Calcula importes de timbre
   |ABRE #dscam090;
   |LEE 000#dscam090.p;
   |SI FSalida = 0;
      |PARA nCont = 1; |SI nCont [ 60; |HACIENDO nCont = nCont + 3;
         nCalc1 = #dscam090#nCont#;  nCont = nCont + 1;
         nCalc2 = #dscam090#nCont#;  nCont = nCont + 1;
         nTimbre = #dscam090#nCont#; nCont = nCont - 2;
         |SI nCalc1 [ #dscam013#7; |Y nCalc2 ] #dscam013#7;
            #dscam013#39 = nTimbre;
         |FINSI;
      |SIGUE;
   |FINSI;
   |CIERRA #dscam090;

   |ABRE #dscam014;
   #dscam014#0 = #dscam012#2;
   |LEE 000#dscam014.=;
   |SI FSalida ! 0; |DDEFECTO #dscam014; |FINSI;
   |CIERRA #dscam014;

   Calc1 = #dscam012#1;
   Calc2 = #dscam013#6;
   NumDias = Calc2 - Calc1;
   |SI NumDias < 0;
      NumDias = 0;
      #dscam013#12 = "S";
      nInteres = 0;
      nPorcInt = 0;
   |SINO;
      #dscam013#12 = "N";
      |SI #dscam014#28 ! 0; |O #dscam014#29 ! 0; |O #dscam014#30 ! 0; |O #dscam014#31 ! 0;
         |SI NumDias ] #dscam014#20; |Y NumDias [ #dscam014#24;
            nInteres = ((#dscam013#7 * #dscam014#28) / 36000) * NumDias;
            nPorcInt = #dscam014#28;
         |FINSI;
         |SI NumDias ] #dscam014#21; |Y NumDias [ #dscam014#25;
            nInteres = ((#dscam013#7 * #dscam014#29) / 36000) * NumDias;
            nPorcInt = #dscam014#29;
         |FINSI;
         |SI NumDias ] #dscam014#22; |Y NumDias [ #dscam014#26;
            nInteres = ((#dscam013#7 * #dscam014#30) / 36000) * NumDias;
            nPorcInt = #dscam014#30;
         |FINSI;
         |SI NumDias ] #dscam014#23; |Y NumDias [ #dscam014#27;
            nInteres = ((#dscam013#7 * #dscam014#31) / 36000) * NumDias;
            nPorcInt = #dscam014#31;
         |FINSI;
      |SINO;
         |SI #dscam014#32 ! 0;
            nInteres = (#dscam013#7 % #dscam014#32) * NumDias ;
            nPorcInt = #dscam014#32;
         |SINO;
            nInteres = ((#dscam013#7 * #dscam014#17)/36000) * NumDias;
            nPorcInt = #dscam014#17;
         |FINSI;
      |FINSI;
   |FINSI;
   #dscam013#8  = NumDias;
   |SI #dscam012#22 = 2; |O #dscam012#22 = 4;
      #dscam013#9  = nPorcInt;
      #dscam013#10 = nInteres;
   |SINO;
      #dscam013#9  = 0;
      #dscam013#10 = 0;
   |FINSI;

   |SI HayGestion = 1; |Y #dscam003#49 = "N";
          |HAZ CheqImpRecibos;
   |FINSI;

   |SI nDocAnt ! 0; |Y nDocAnt ! #dscam013#16;
      #dscam003#40 = nDocAnt;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         |SI #dscam003#14 = "R"; |Y #dscam003#17 = #dscam013#0; |Y #dscam003#37 = #dscam013#1;
            |SI #dscam003#70 = "          ";
               |SI #dscam003#31 = 0;
                  #dscam003#14 = "L";
                  #dscam003#15 = "Recibo Liquidado";
               |SINO;
                  |SI #dscam003#23 = 0;
                     |SI #dscam003#16 = 0;
                        #dscam003#14 = "P";
                        #dscam003#15 = "Pendiente de cobro";
                     |SINO;
                        #dscam003#14 = "I";
                        #dscam003#15 = "Impagado";
                        nNumRem = 0; nNumLRem = 0; |HAZ BuscaRemesaAnt;
                        #dscam003#17 = nNumRem;
                        #dscam003#37 = nNumLRem;
                        #dscam003#53 = fFecRem;
                     |FINSI;
                  |SINO;
                     #dscam003#14 = "C";
                     #dscam003#15 = "Parcialmente cobrado";
                  |FINSI;
               |FINSI;
            |SINO;
               |SI #dscam003#47 ! "S";
                  #dscam003#14 = "T";
                  #dscam003#15 = "Pagare/talon de cliente";
               |SINO;
                  #dscam003#14 = "e";
                  #dscam003#15 = "Pendiente de compensar ";
               |FINSI;
            |FINSI;
            #dscam003#17 = 0;
            #dscam003#53 = "01.01.0000";
            #dscam003#37 = 0;
            |GRABA 020#dscam003.a;
         |FINSI;
         |LIBERA #dscam003;
      |FINSI;
      nDocAnt = 0;
   |FINSI;

   eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = nDocAnt; |HAZ ProcesaTempo;

   |CIERRA #dscam003;
   |CIERRA #dscam004;

   eaUsuario = Usuario % 0810;
   eaDescr   = "ALTA LINEA REMESA (" + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam013#1) % -103);
   eaDescr   = eaDescr + ") CON RECIBO (" + #dscam003#0 + "/" + #dscam003#1 + "/" + #dscam003#2 + ") DESDE MANTENIMIENTO";
   eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
   eaTipoOp  = "A";   enImpAnt = #dscam012#10;
   enImpAct = #dscam012#10 + #dscam013#7;
   eaFicher = "dscam012"; eaClave = #dscam012#0;
   |HAZ GrabaAudit;

|FPRC;

|PROCESO MiraSiVtos;
   HayVtos = HayVtos + 1;
|FPRC;

|DEFBUCLE MiraSiVtos;
#dscam013#1;
15;
#dscam012#0,001,"S";
#dscam012#0,999,"S";
;
NULL,MiraSiVtos;
|FIN;

|PROCESO ActualRec;
   |SI #dscam013#15 = "R"; |ACABA; |FINSI;

   nSwBorra = 0;
   #dscam003#40 = #dscam013#16;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam012#8 = "S";
         |SI #dscam012#22 ! 1; |O #dscam012#22 ! 3;
            nSwBorra = 1;
         |SINO;
            nSwBorra = 0;
         |FINSI;
      |FINSI;
      |SI #dscam012#9 = "S";
         |SI #dscam012#22 = 1; |O #dscam012#22 = 3;
            nSwBorra = 1;
         |SINO;
            nSwBorra = 0;
         |FINSI;
      |FINSI;

      |SI nSwBorra = 1;
         |SI #dscam051#3 = "S";
            nSwCobConf = 0;
            #dscam004#17 = #dscam013#16;
            #dscam004#3  = #dscam013#17;
            |LEE 000#dscam004.=;
            |SI FSalida = 0;
               |SI #dscam004#5 = "REM"; |O #dscam004#5 = "EMR";
                  |LEE 000#dscam004.a;
                  |SI FSalida = 0;
                     |SI #dscam004#5 = "EMR";
                        |LEE 000#dscam004.a;
                        |SI FSalida = 0; |Y #dscam004#5 = "CFR"; nSwCobConf = 1; |FINSI;
                     |FINSI;
                  |FINSI;
               |FINSI;
            |FINSI;

            |SI nSwCobConf = 0;
               enBanco = #dscam012#2;
               ||enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
               enEmpCartera = -1;     enEmpGestion = #dscam003#46;
               eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
               nImporte = #dscam013#7;
               |SI #dscam003#16 = 0;
                  eaTipoOper = "+4";
               |SINO;
                  eaTipoOper = "+7";
               |FINSI;
               eaTipoOper = eaTipoOper + "-6";
               |HAZ BucleRiesgo;
            |FINSI;
         |FINSI;

         #dscam004#17 = #dscam013#16;
         #dscam004#3  = #dscam013#17;
         |LEE 101#dscam004.=;
         |SI FSalida = 0;
            |SI enSwCambioRem = 1;
                |SI nSwArtenvas = 1;
                    |SI #dscam012#22 ! 2; |Y #dscam012#22 ! 4;
                        |SI #dscam004#5 = "REM";
                            |SI #dscam004#23 ! 0;
                                #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;
                                #dscam003#30 = #dscam003#30 + #dscam004#23;  #dscam003#64 = #dscam003#64 + #dscam004#32;
                                #dscam003#31 = #dscam003#31 + #dscam004#23;  #dscam003#65 = #dscam003#65 + #dscam004#32;
                            |FINSI;
                            #dscam003#31 = #dscam003#31 + #dscam004#8;  #dscam003#65 = #dscam003#65 + #dscam004#26;
                            #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
                            #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
                            #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
                            #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
                            #dscam003#17 = 0; #dscam003#37 = 0;
                        |FINSI;
                    |FINSI;
                |SINO;
                    |SI #dscam004#5 = "REM";
                        |SI #dscam004#23 ! 0;
                            #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;
                            #dscam003#30 = #dscam003#30 + #dscam004#23;  #dscam003#64 = #dscam003#64 + #dscam004#32;
                            #dscam003#31 = #dscam003#31 + #dscam004#23;  #dscam003#65 = #dscam003#65 + #dscam004#32;
                        |FINSI;
                        #dscam003#31 = #dscam003#31 + #dscam004#8;  #dscam003#65 = #dscam003#65 + #dscam004#26;
                        #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
                        #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
                        #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
                        #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
                        #dscam003#17 = 0; #dscam003#37 = 0;
                    |FINSI;
                |FINSI;
            |SINO;
                |SI #dscam004#5 = "REM";
                    |SI #dscam004#23 ! 0;
                        #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;
                        #dscam003#30 = #dscam003#30 + #dscam004#23;  #dscam003#64 = #dscam003#64 + #dscam004#32;
                        #dscam003#31 = #dscam003#31 + #dscam004#23;  #dscam003#65 = #dscam003#65 + #dscam004#32;
                    |FINSI;
                    #dscam003#31 = #dscam003#31 + #dscam004#8;  #dscam003#65 = #dscam003#65 + #dscam004#26;
                    #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
                    #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
                    #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
                    #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
                    #dscam003#17 = 0; #dscam003#37 = 0;
                |FINSI;
            |FINSI;
            |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
            |BORRA 020#dscam004.a; |LIBERA #dscam004;

            |ABRE #dscam067;
            #dscam067#0 = "RM";
            #dscam067#1 = #dscam012#0;
            #dscam067#2 = 1;
            #dscam067#3 = "E";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
            |SI FEstado = 0; |Y Clave1 = #dscam012#0; |Y Clave3  = "E";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #13 Comodin;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
               #dscaw013#13 = "dscam013";   #dscaw013#14 = 0;
               #dscaw013#11 = "N";          #dscaw013#12 = 5;
               #dscaw013#5  = #dscam012#0;  #dscaw013#6 = #dscam012#0;
               |GRABA 020#dscaw013.n;

               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
               #dscaw013#13 = "dscam013";   #dscaw013#14 = 1;
               #dscaw013#11 = "N";          #dscaw013#12 = 3;
               #dscaw013#5  = #dscam013#1;  #dscaw013#6 = #dscam013#1;
               |GRABA 020#dscaw013.n;

               Comodin = #dscam067#10;
               Comodin = "dscam033.tab;" + Comodin + ",B,E";
               |LIBERA #dscam012; |CIERRAT #dscam012;
               |LIBERA #dscam013; |CIERRAT #dscam013;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam012; |LEE 101#dscam012.=;
               |ABRET #dscam013; |LEE 101#dscam013.=;
               |CIERRA #dscaw013;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;
            |CIERRA #dscam067;
         |FINSI;
      |FINSI;

      #dscam003#17 = 0;
      #dscam003#37 = 0;
      |SI #dscam012#23 = "S";
         nSwHay = 0;
         #dscam004#17 = #dscam003#40;
         #dscam004#3 = 99;
         |LEE 000#dscam004.];
         |SI FSalida = 0;
            |SI #dscam004#17 = #dscam003#40;
               |SI #dscam004#5 = "EMR"; nSwHay = 1; |FINSI;
            |SINO;
               |LEE 000#dscam004.a;
               |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
                  |SI #dscam004#5 = "EMR"; nSwHay = 1; |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            |LEE 000#dscam004.u;
            |SI FSalida = 0;
               |SI #dscam004#17 = #dscam003#40;
                  |SI #dscam004#5 = "EMR"; nSwHay = 1; |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
         |SI nSwHay = 1;
            |ABRE #dscam067;
            #dscam067#0 = "RM";
            #dscam067#1 = #dscam012#0;
            #dscam067#2 = 1;
            #dscam067#3 = "I";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
            |SI FEstado = 0; |Y Clave1 = #dscam012#0; |Y Clave3  = "I";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #13 Comodin;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
               #dscaw013#13 = "dscam013";   #dscaw013#14 = 0;
               #dscaw013#11 = "N";          #dscaw013#12 = 5;
               #dscaw013#5  = #dscam012#0;  #dscaw013#6 = #dscam012#0;
               |GRABA 020#dscaw013.n;

               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
               #dscaw013#13 = "dscam013";   #dscaw013#14 = 1;
               #dscaw013#11 = "N";          #dscaw013#12 = 3;
               #dscaw013#5  = #dscam013#1;  #dscaw013#6 = #dscam013#1;
               |GRABA 020#dscaw013.n;

               Comodin  = #dscam067#10;
               Comodin = "dscam033.tab;" + Comodin + ",B,I";
               |LIBERA #dscam012; |CIERRAT #dscam012;
               |LIBERA #dscam013; |CIERRAT #dscam013;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam012; |LEE 101#dscam012.=;
               |ABRET #dscam013; |LEE 101#dscam013.=;
               |CIERRA #dscaw013;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;
            |CIERRA #dscam067;
            |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
            |BORRA 020#dscam004.a; |LIBERA #dscam004;
         |FINSI;
      |FINSI;

      #dscam003#26 = "01.01.0000";
      #dscam003#53 = "01.01.0000";

      |SI #dscam003#70 = "          ";
         |SI #dscam003#31 = 0;
            #dscam003#14 = "L";
            #dscam003#15 = "Recibo Liquidado";
         |SINO;
            |SI #dscam003#23 = 0;
               |SI #dscam003#16 = 0;
                  #dscam003#14 = "P";
                  #dscam003#15 = "Pendiente de cobro";
               |SINO;
                  #dscam003#14 = "I";
                  #dscam003#15 = "Impagado";
                  nNumRem = 0; nNumLRem = 0; |HAZ BuscaRemesaAnt;
                  #dscam003#17 = nNumRem;
                  #dscam003#37 = nNumLRem;
                  #dscam003#53 = fFecRem;
               |FINSI;
            |SINO;
               #dscam004#17 = #dscam003#40;
               #dscam004#3 = 99;
               |LEE 000#dscam004.];
               |SI FSalida = 0;
                  |SI #dscam004#17 ! #dscam003#40;
                     |LEE 000#dscam004.a;
                     |SI FSalida ! 0; |O #dscam004#17 ! #dscam003#40;
                        |DDEFECTO #dscam004;
                     |FINSI;
                  |FINSI;
               |SINO;
                  |LEE 000#dscam004.u;
                  |SI FSalida ! 0; |O #dscam004#17 ! #dscam003#40;
                     |DDEFECTO #dscam004;
                  |FINSI;
               |FINSI;

               |SALVA_FICHA #dscam004;
               |LEE 000#dscam004.a;
               |SI #dscam004#17 = #dscam003#40; |Y #dscam004#5 = "IMP";
                  nNumRem = 0; nNumLRem = 0; |HAZ BuscaRemesaAnt;
                  #dscam003#17 = nNumRem;
                  #dscam003#37 = nNumLRem;
                  #dscam003#53 = fFecRem;
               |FINSI;
               |REPON_FICHA #dscam004;
               #dscam003#14 = "C";
               #dscam003#15 = "Parcialmente cobrado";
            |FINSI;
         |FINSI;
      |SINO;
         nSwCobConf = 0;
         #dscam004#17 = #dscam003#40;
         #dscam004#3 = 99;
         |LEE 000#dscam004.];
         |SI FSalida = 0;
            |LEE 000#dscam004.a;
         |SINO;
            |LEE 000#dscam004.u;
         |FINSI;
         |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
            |SI #dscam004#5 = "CFR"; nSwCobConf = 1; |FINSI;
         |FINSI;

         |SI #dscam003#47 ! "S";
            |SI #dscam003#23 = 0;
               |SI nSwCobConf = 1;
                  #dscam003#14 = "F";
                  #dscam003#15 = "Recepcionado Confirme";
               |SINO;
                  #dscam003#14 = "T";
                  #dscam003#15 = "Pagare/talon de cliente";
               |FINSI;
            |SINO;
               |SI #dscam003#31 = 0;
                  #dscam003#14 = "L";
                  #dscam003#15 = "Recibo Liquidado";
               |SINO;
                  #dscam003#14 = "C";
                  #dscam003#15 = "Parcialmente cobrado";
               |FINSI;
            |FINSI;
         |SINO;
            |SI #dscam003#23 = 0;
               #dscam003#14 = "p";
               #dscam003#15 = "Entrega pdte.cobro";
            |SINO;
               #dscam003#14 = "e";
               #dscam003#15 = "Pendiente de compensar ";
            |FINSI;
         |FINSI;
      |FINSI;
      || #dscam003#26 = "01.01.0000";
      || #dscam003#53 = "01.01.0000";
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;
|FPRC;

|PROCESO BorraLin;
   |HAZ ActualRec;
   |SI #dscam012#22 = 1; |O #dscam012#22 = 2;
      |SI #dscam051#75 = "S";
         #dscam004#17 = #dscam013#16;
         #dscam004#3 = 99;
         |LEE 000#dscam004.];
         |SI FSalida ! 0;
            |LEE 000#dscam004.u;
            |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
               LinCob = #dscam004#3;
            |SINO;
               LinCob = 1;
            |FINSI;
         |SINO;
            |SI #dscam004#17 = #dscam013#16;
               LinCob = #dscam004#3;
            |SINO;
               |LEE 000#dscam004.a;
               |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
                  LinCob = #dscam004#3;
               |SINO;
                  LinCob = 1;
               |FINSI;
            |FINSI;
         |FINSI;
         #dscam004#17 = #dscam013#16;
         #dscam004#3 = LinCob;
         |LEE 101#dscam004.=;
         |SI FSalida = 0; |Y #dscam004#5 = "PRE";
            |BORRA 020#dscam004.a; |LIBERA #dscam004;

            #dscam003#40 = #dscam013#16;
            |LEE 101#dscam003.=;
            |SI FSalida = 0;
               #dscam003#90 = "N";
               |SI #dscam013#31 ! #dscam003#12; |Y #dscam004#54 ! 0;
                  #dscam003#12 = #dscam004#54;
               |FINSI;
               |GRABA 020#dscam003.a; |LIBERA #dscam003;
            |FINSI;
         |SINO;
            |MENAV "    No se ha podido eliminar el movimiento de preparacion";
         |FINSI;
      |FINSI;
   |FINSI;

   |HAZ EsLuxe;
   |SI FSalida = 0;
      #dscam003#40 = #dscam013#16;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         |SI #dscam013#31 ! #dscam003#12;
            #dscam003#12 = #dscam004#54;
            |GRABA 020#dscam003.a;
         |FINSI;
         |LIBERA #dscam003;
      |FINSI;
   |FINSI;

   |SI nSwArtenvas = 1;
      #dscam003#40 = #dscam013#16;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         #dscam003#51 = 0;
         #dscam003#52 = "";
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |FINSI;
   |FINSI;

   |BORRA 020#dscam013.a;
|FPRC;

|DEFBUCLE BorraLin;
#dscam013#1;
;
#dscam012#0,001;
#dscam012#0,999;
be;
NULL,BorraLin;
|FIN;

|PROCESO BuscaLin;
   #dscam003#40 = #dscam013#16;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#98 = "S"; SwError = 3; |ERROR10; |FINSI;
   |FINSI;

   |SI #dscam013#15 = "R"; SwError = 2; |ERROR10; |FINSI;
   VtoEnlace = #dscam013#30; VtoAsto   = #dscam013#33;
   EmiEnlace = #dscam013#19; EmiAsto   = #dscam013#26;
   NumRemesa = #dscam013#0;  FechaVto  = #dscam013#32;
   |SI #dscam013#15 = "S"; SwError = 1; |ERROR10; |FINSI;

   |SI #dscam012#8 = "S";
      #dscam004#17 = #dscam013#16;
      #dscam004#3  = #dscam013#17;
      |LEE 000#dscam004.=;
      |SI FSalida = 0;
         |LEE 000#dscam004.s;
         |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
            SwError = 5; |ERROR10;
         |FINSI;
      |SINO;
         SwError = 5; |ERROR10;
      |FINSI;
   |FINSI;

   |SI #dscam012#23 = "S"; |Y #dscam012#8 = "N";
      #dscam004#17 = #dscam013#16;
      #dscam004#3  = #dscam013#24;
      |LEE 000#dscam004.=;
      |SI FSalida = 0;
         |LEE 000#dscam004.s;
         |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
            SwError = 4; |ERROR10;
         |FINSI;
      |SINO;
         SwError = 4; |ERROR10;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE BuscaLin;
#dscam013#1;
;
#dscam012#0,001;
#dscam012#0,999;
;
NULL,BuscaLin;
|FIN;

|PROCESO InitRecibos;
   |HAZ ActualRec;
|FPRC;

|DEFBUCLE InitRecibos;
#dscam013#1;
;
#dscam012#0,001;
#dscam012#0,999;
;
NULL,InitRecibos;
|FIN;

|PROCESO InitEmision;
   #dscam003#40 = #dscam013#16;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      nLinea = 0;
      #dscam004#17 = #dscam013#16;
      #dscam004#3  = 99;
      |LEE 000#dscam004.];
      |SI FSalida = 0;
         |SI #dscam004#17 = #dscam013#16;
            nLinea = #dscam004#3;
         |SINO;
            |LEE 000#dscam004.a;
            |SI FSalida = 0;
               |SI #dscam004#17 = #dscam013#16;
                  nLinea = #dscam004#3;
               |SINO;
                  nLinea = 0;
               |FINSI;
            |SINO;
               nLinea = 0;
            |FINSI;
         |FINSI;
      |SINO;
         |LEE 000#dscam004.u;
         |SI FSalida = 0;
            |SI #dscam004#17 = #dscam013#16;
               nLinea = #dscam004#3;
            |SINO;
               nLinea = 0;
            |FINSI;
         |SINO;
            nLinea = 0;
         |FINSI;
      |FINSI;

      |SI nLinea ! 0;
         #dscam004#17 = #dscam013#16;
         #dscam004#3  = nLinea;
         |LEE 101#dscam004.=;
         |SI FSalida = 0; |Y #dscam004#5 = "EMR";
            |ABRE #dscam067;
            #dscam067#0 = "RM";
            #dscam067#1 = #dscam012#0;
            #dscam067#2 = 1;
            #dscam067#3 = "I";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
            |SI FEstado = 0; |Y Clave1 = #dscam012#0; |Y Clave3  = "I";
               Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
               |NOME_DAT #13 Comodin;
               |DELINDEX #dscaw013; |ABRE #dscaw013;
               |DDEFECTO #dscaw013;
               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
               #dscaw013#13 = "dscam013";   #dscaw013#14 = 0;
               #dscaw013#11 = "N";          #dscaw013#12 = 5;
               #dscaw013#5  = #dscam012#0;  #dscaw013#6 = #dscam012#0;
               |GRABA 020#dscaw013.n;

               #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
               #dscaw013#13 = "dscam013";   #dscaw013#14 = 1;
               #dscaw013#11 = "N";          #dscaw013#12 = 3;
               #dscaw013#5  = #dscam013#1;  #dscaw013#6 = #dscam013#1;
               |GRABA 020#dscaw013.n;

               Comodin = #dscam067#10;
               Comodin = "dscam033.tab;" + Comodin + ",B,I";
               |LIBERA #dscam012; |CIERRAT #dscam012;
               |LIBERA #dscam013; |CIERRAT #dscam013;
               |SUB_EJECUTA_NP Comodin;
               |ABRET #dscam012; |LEE 101#dscam012.=;
               |ABRET #dscam013; |LEE 101#dscam013.=;
               |CIERRA #dscaw013;

               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
               |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;
            |CIERRA #dscam067;

            |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
            |SI #dscam051#133 = "S";
                 #dscam003#51 = #dscam012#2;
                 #dscam003#52 = #dscam012#3;
            |FINSI;
            |GRABA 020#dscam003.a; |LIBERA #dscam003;

            |BORRA 020#dscam004.a; |LIBERA #dscam004;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE InitEmision;
#dscam013#1;
;
#dscam012#0,001;
#dscam012#0,999;
;
NULL,InitEmision;
|FIN;

|PROCESO Baja; |TIPO 1;
   |ABRE #dscam051; |ABRE #dscam003; |ABRE #dscam004;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 000#dscam051.c;
   |FINSI;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 2;
      SwSalir = 0; SwError = 0; |BUCLE BuscaLin;
      |SI SwError = 1;
         |MENAV "    Hay recibos ya vencidos contabilizados. No se modificar  la remesa";
         SwSalir = 1;
         |CIERRA #dscam003; |CIERRA #dscam051;
         |ERROR; |ACABA;
      |FINSI;
      |SI SwError = 2;
         |MENAV "    Hay recibos reclamados. No se modificar  la remesa";
         SwSalir = 1;
         |CIERRA #dscam003; |CIERRA #dscam051;
         |ERROR; |ACABA;
      |FINSI;
      |SI SwError = 3;
         |MENAV "    Hay recibos que se han reclamado al banco. No se modificar  la remesa";
         SwSalir = 1;
         |CIERRA #dscam003; |CIERRA #dscam051;
         |ERROR; |ACABA;
      |FINSI;
      |SI SwError = 4;
         |MENAV "    Hay recibos que tienen movimientos posteriores a la emision de la remesa. No se modificar  la remesa";
         SwSalir = 1;
         |CIERRA #dscam003; |CIERRA #dscam051;
         |ERROR; |ACABA;
      |FINSI;
      |SI SwError = 5;
         |MENAV "    Hay recibos que tienen movimientos posteriores al abono de la remesa. No se modificar  la remesa";
         SwSalir = 1;
         |CIERRA #dscam003; |CIERRA #dscam051;
         |ERROR; |ACABA;
      |FINSI;
      aConfirmacion = "N";
      |SI #dscam012#8 = "S";
         |SI #dscam051#1 = "N";
            |CONFI "    NVa a modificar una remesa ya abonada/contabilizada. ¨ Continuar ?";
         |SINO;
            |PUSHV 0820 1460;
            |BLANCO 0820 1460;
            |CUADRO 0921 1359;
            |ATRI R; |PINTA 1022, "Remesa ya abonada o contabilizada. Si"; |ATRI N;
            |ATRI R; |PINTA 1122, "continua se modificaran los asientos "; |ATRI N;
            |ATRI R; |PINTA 1222, "en contabilidad. ¨ Continuar ?       "; |ATRI N;
            E_sup = 1;
            E_inf = "";
            aResp = 1253 ? 1;
            |POPV;
            |SI aResp = "S";
               FSalida = 0;
            |SINO;
               FSalida = 1;
            |FINSI;
         |FINSI;
         |SI FSalida = 0;
            aConfirmacion = "S";
            |HAZ BuscaCierre;
            |SI nSwErr ! 0;
               |MENAV "    La empresa contable esta cerrada. No se puede modificar";
               SwSalir = 1;
               |CIERRA #dscam004; |CIERRA #dscam003; |CIERRA #dscam051;
               |ERROR; |ACABA;
            |FINSI;
            eaLlamada = "A";
            |BUCLE InitRecibos;
            #dscam012#8 = "N"; |PINTA #dscam012#8; |GRABA 020#dscam012.a;
            eaDescr   = "MODIFICACION REMESA ABONADA/CONTABILIZADA (" + (("00000" + #dscam012#0) % -105) + ")";
            eaUsuario = Usuario % 0810;
            eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
            eaTipoOp  = "A";   enImpAnt = #dscam012#10;
            enImpAct = #dscam012#10 + #dscam013#7;
            eaFicher = "dscam012"; eaClave = #dscam012#0;
            |HAZ GrabaAudit;
         |SINO;
            SwSalir = 1;
            |CIERRA #dscam004; |CIERRA #dscam003; |CIERRA #dscam051;
            |ERROR; |ACABA;
         |FINSI;
      |SINO;
         eaDescr   = "MODIFICACION REMESA (" + (("00000" + #dscam012#0) % -105) + ")";
      |FINSI;
      |SI #dscam012#23 = "S";
         |SI aConfirmacion = "N";
            |SI #dscam051#1 = "N";
               |CONFI "    NVa a modificar una remesa ya emitida. ¨ Continuar ?"
            |SINO;
               |PUSHV 0820 1460;
               |BLANCO 0820 1460;
               |CUADRO 0921 1359;
               |ATRI R; |PINTA 1022, "Remesa ya emitida. Si continua se    "; |ATRI N;
               |ATRI R; |PINTA 1122, "modificaran los asientos ya enlazados"; |ATRI N;
               |ATRI R; |PINTA 1222, "en contabilidad. ¨ Continuar ?       "; |ATRI N;
               E_sup = 1;
               E_inf = "";
               aResp = 1253 ? 1;
               |POPV;
               |SI aResp = "S";
                  FSalida = 0;
               |SINO;
                  FSalida = 1;
               |FINSI;
            |FINSI;
         |SINO;
            FSalida = 0;
         |FINSI;
         |SI FSalida = 0;
            |HAZ BuscaCierre;
            |SI nSwErr ! 0;
               |MENAV "    La empresa contable esta cerrada. No se puede modificar";
               SwSalir = 1; |ERROR; |ACABA;
            |FINSI;
            |ABRE #dscam004;
            eaLlamada = "A";
            |BUCLE InitEmision;
            |CIERRA #dscam004;
            #dscam012#23 = "N"; |PINTA #dscam012#23; |GRABA 020#dscam012.a;
            eaDescr   = "MODIFICACION REMESA EMITIDA (" + (("00000" + #dscam012#0) % -105) + ")";
            eaUsuario = Usuario % 0810;
            eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
            eaTipoOp  = "A";   enImpAnt = #dscam012#10;
            enImpAct = #dscam012#10 + #dscam013#7;
            eaFicher = "dscam012"; eaClave = #dscam012#0;
            |HAZ GrabaAudit;
         |SINO;
            |CIERRA #dscam004; |CIERRA #dscam003; |CIERRA #dscam051;
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;
      eaUsuario = Usuario % 0810;
      eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
      eaTipoOp  = "M";   enImpAnt = #dscam012#10;
   |FINSI;

   |SI ModoEntrada ! 3; |ACABA; |FINSI;

   SwError = 0; |BUCLE BuscaLin;
   |SI SwError = 1;
      |MENAV "    Hay recibos ya vencidos contabilizados. No se dara de baja la remesa";
      |CIERRA #dscam004; |CIERRA #dscam003; |CIERRA #dscam051;
      |ERROR; |ACABA;
   |FINSI;
   |SI SwError = 2;
      |MENAV "    Hay recibos reclamados. No se dara de baja la remesa";
      |CIERRA #dscam004; |CIERRA #dscam003; |CIERRA #dscam051;
      |ERROR; |ACABA;
   |FINSI;
   |SI SwError = 3;
      |MENAV "    Hay recibos que se han reclamado al banco. No se modificar  la remesa";
      |CIERRA #dscam004; |CIERRA #dscam003; |CIERRA #dscam051;
      |ERROR; |ACABA;
   |FINSI;
   |SI SwError = 4;
      |MENAV "    Hay recibos que tienen movimientos posteriores al abono de la remesa. No se modificar  la remesa";
      SwSalir = 1;
      |CIERRA #dscam003; |CIERRA #dscam051;
      |ERROR; |ACABA;
   |FINSI;

   eaUsuario = Usuario % 0810;
   eaDescr   = "BAJA REMESA (" + (("00000" + #dscam012#0) % -105) + ")";
   eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
   eaTipoOp  = "B";   enImpAnt = #dscam012#10; enImpAct = 0;
   eaFicher = "dscam012"; eaClave = #dscam012#0;
   |HAZ GrabaAudit;

   |SI #dscam051#1 = "S";
      |ABRE #dscam067;
      |SI #dscam012#9 = "S";
         #dscam067#0  = "RM";
         #dscam067#1  = #dscam012#0;
         #dscam067#2  = 1;
         #dscam067#3  = "V";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1;
         Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |SI FEstado = 0; |Y Clave1 = #dscam012#0; |Y Clave3  = "V";
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #13 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;
            VtoEnlace = #dscam067#10; VtoAsto   = #dscam067#6;
            FechaVto  = #dscam067#5;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = VtoEnlace;  #dscaw013#0 = 1;
            #dscaw013#13 = "dscam013"; #dscaw013#14 = 15;
            #dscaw013#11 = "A";
            #dscaw013#3  = "S";   #dscaw013#4 = "S";
            |GRABA 020#dscaw013.n;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = VtoEnlace;  #dscaw013#0 = 2;
            #dscaw013#13 = "dscam013"; #dscaw013#14 = 0;
            #dscaw013#11 = "N";        #dscaw013#12 = 5;
            #dscaw013#3  = #dscam012#0;#dscaw013#4 = #dscam012#0;
            |GRABA 020#dscaw013.n;
            Comodin = VtoEnlace;
            Comodin = "dscam033.tab;" + Comodin + ",V,B" + FechaVto;
            |LIBERA #dscam012; |CIERRAT #dscam012;
            |LIBERA #dscam013; |CIERRAT #dscam013;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam012; |LEE 101#dscam012.=;
            |ABRET #dscam013; |LEE 101#dscam013.=;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
      |FINSI;
      |SI #dscam012#8 = "S";
         #dscam067#0 = "RM";
         #dscam067#1 = #dscam012#0;
         #dscam067#2 = 1;
         #dscam067#3 = "E";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |SI FEstado = 0; |Y Clave1 = #dscam012#0; |Y Clave3  = "E";
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #13 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
            #dscaw013#13 = "dscam013";    #dscaw013#14 = 0;
            #dscaw013#11 = "N";           #dscaw013#12 = 5;
            #dscaw013#5 = #dscam012#0;    #dscaw013#6 = #dscam012#0;
            |GRABA 020#dscaw013.n;
            Comodin = #dscam067#10;
            Comodin = "dscam033.tab;" + Comodin + ",E,B";
            |LIBERA #dscam012; |CIERRAT #dscam012;
            |LIBERA #dscam013; |CIERRAT #dscam013;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam012; |LEE 101#dscam012.=;
            |ABRET #dscam013; |LEE 101#dscam013.=;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
      |FINSI;
      |SI #dscam012#23 = "S";
         #dscam067#0 = "RM";
         #dscam067#1 = #dscam012#0;
         #dscam067#2 = 1;
         #dscam067#3 = "I";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |SI FEstado = 0; |Y Clave1 = #dscam012#0; |Y Clave3  = "I";
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #13 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;
            |DDEFECTO #dscaw013;
            #dscaw013#15 = #dscam067#10;  #dscaw013#0  = 1;
            #dscaw013#13 = "dscam013";    #dscaw013#14 = 0;
            #dscaw013#11 = "N";           #dscaw013#12 = 5;
            #dscaw013#5 = #dscam012#0;    #dscaw013#6 = #dscam012#0;
            |GRABA 020#dscaw013.n;
            Comodin = #dscam067#10;
            Comodin = "dscam033.tab;" + Comodin + ",I,B";
            |LIBERA #dscam012; |CIERRAT #dscam012;
            |LIBERA #dscam013; |CIERRAT #dscam013;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam012; |LEE 101#dscam012.=;
            |ABRET #dscam013; |LEE 101#dscam013.=;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
         |FINSI;
      |FINSI;
      |CIERRA #dscam067;
   |SINO;
/*
      |ABRE #dscam067;
      #dscam067#0  = "RM";
      #dscam067#1  = #dscam012#0;
      #dscam067#2  = 1;
      #dscam067#3  = " ";
      #dscam067#11 = 1;
      |LEE 000#dscam067.];
      |SI FSalida = 0; |Y #dscam067#0  = "RM"; |Y #dscam067#1  = #dscam012#0;
         |MENAV "    Ha modificado un efecto contabilizado. Revise contabilidad.";
      |FINSI;
      |CIERRA #dscam067;
*/
   |FINSI;
   eaLlamada = "A";
   |BUCLE BorraLin;
   |CIERRA #dscam004; |CIERRA #dscam003; |CIERRA #dscam051;
|FPRC;

|PROCESO Tipo11m13; |TIPO 11;
     nSwRemeAuto = 0;
     |SI FSalida = 10;
          aAlfa = "dscaz225;" + #dscam013#16;
          |SUB_EJECUTA_NP aAlfa;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO InfoLinea; |TIPO 13;
   Comodin = #dscam013#13; |QBF Comodin;
   |SI Comodin = "";
      |ABRE #dscam003;
      #dscam003#40 = #dscam013#16;
      |LEE 000#dscam003.=;
      |SI FSalida ! 0; |DDEFECTO #dscam003; |FINSI;
      |CIERRA #dscam003;

      #dscam013#13 = #dscam003#6; |PINTA #dscam013#13;
   |FINSI;
   |SI #dscam013#37 ! "    ";
      Comodin = " Efecto englobado en pagare n§ " + #dscam013#37 + "/" + #dscam013#38;
   |SINO;
      Comodin = &196 * 46;
   |FINSI;
   |PINTA 1509, Comodin;
|FPRC;

|PROCESO BorraPag;
   #dscam012#5 = #dscam012#5 - 1;
   #dscam012#10 = #dscam012#10 - #dscam013#7;
   #dscam012#11 = #dscam012#6 * #dscam012#5;   || La comision solo sera en moneda base
   #dscam012#12 = #dscam012#12 + #dscam013#10;
   |SI #dscam013#6 < #dscam012#1;
      #dscam012#13 = #dscam012#13 - #dscam013#7;
   |FINSI;
   |SI #dscam012#24 = "S";
      #dscam012#25 = #dscam012#25 - #dscam013#39;
   |FINSI;
   |SI #dscam012#22 = 6; |O #dscam012#22 = 7;
      #dscam012#26 = #dscam012#26 - #dscam013#40;
      #dscam012#27 = #dscam012#27 - #dscam013#41;
      #dscam012#30 = #dscam012#30 - ((#dscam013#7 % #dscam012#28) ! nDeci_Base);
   |FINSI;
   |GRABA 020#dscam012.a;
   |PINTA #dscam012#5;  |PINTA #dscam012#10; |PINTA #dscam012#11;
   |PINTA #dscam012#12; |PINTA #dscam012#13; |PINTA #dscam012#25;
   |PINTA #dscam012#26; |PINTA #dscam012#27;
   |ABRE #dscam003; |ABRE #dscam004; |HAZ ActualRec; |CIERRA #dscam004; |CIERRA #dscam003;
   |SI #dscam013#1 ! nLineaRem; |BORRA 020#dscam013.a; |FINSI;
|FPRC;

|DEFBUCLE BorraPag;
#dscam013#1;
37,38;
#dscam012#0,001,EntPagAnt,NumPagAnt;
#dscam012#0,999,EntPagAnt,NumPagAnt;
;
NULL,BorraPag;
|FIN;

|PROCESO Total; |TIPO 2;
   ModoEntrada = (FEntrada / 100) ! 0; Flag = 0 +. 1;

   |SI Flag > 0;
      |HAZ MiraSiFactConta;
      |SI nSwErr = 1;
         |MENAV "    Error. Factura no contabilizada"; |ERROR; |ACABA;
      |FINSI;
   |FINSI;

   |SI Flag < 0; |Y #dscam051#75 = "S";
      |SI #dscam012#22 = 1; |O #dscam012#22 = 2;
         |ABRE #dscam004; |ABRE #dscam003;
         #dscam004#17 = #dscam013#16;
         #dscam004#3 = 99;
         |LEE 000#dscam004.];
         |SI FSalida ! 0;
            |LEE 000#dscam004.u;
            |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
               LinCob = #dscam004#3;
            |SINO;
               LinCob = 1;
            |FINSI;
         |SINO;
            |SI #dscam004#17 = #dscam013#16;
               LinCob = #dscam004#3;
            |SINO;
               |LEE 000#dscam004.a;
               |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
                  LinCob = #dscam004#3;
               |SINO;
                  LinCob = 1;
               |FINSI;
            |FINSI;
         |FINSI;
         #dscam004#17 = #dscam013#16;
         #dscam004#3 = LinCob;
         |LEE 101#dscam004.=;
         |SI FSalida = 0; |Y #dscam004#5 = "PRE";
            |BORRA 020#dscam004.a; |LIBERA #dscam004;

            #dscam003#40 = #dscam013#16;
            |LEE 101#dscam003.=;
            |SI FSalida = 0;
               #dscam003#90 = "N";
               |SI #dscam004#54 ! 0; #dscam003#12 = #dscam004#54; |FINSI;
               |GRABA 020#dscam003.a; |LIBERA #dscam003;
            |FINSI;
         |SINO;
            |MENAV "    No se ha podido eliminar el movimiento de preparacion";
         |FINSI;
         |CIERRA #dscam004; |CIERRA #dscam003;
      |FINSI;
   |FINSI;

   |SI #dscam012#22 = 3; |O #dscam012#22 = 4; |O #dscam012#22 = 7;
      |SI ModoEntrada ! 3;
         |SI Flag < 0;
            |MENAV "    No se pueden modificar lineas de remesas de pagares";
         |FINSI;
         |ERROR;
      |SINO;
         EntPagAnt = #dscam013#37;
         NumPagAnt = #dscam013#38;
         enImpAnt  = #dscam012#10;
         ||#dscam012#5  = #dscam012#5 - 1;
         nLineaRem = #dscam013#1; |SALVA_FICHA #dscam013;
         |BUCLE BorraPag;
         |REPON_FICHA #dscam013;
         |SI #dscam012#5 = 0;
            aAlfa = "    N Remesa vacia. " + &191 + " Eliminar ? ";
            |CONFI aAlfa;
            |SI FSalida = 0; |BORRA 020#dscam012.a; |PTEC 807; |FINSI;
         |FINSI;

         eaUsuario = Usuario % 0810;
         eaDescr   = "BAJA LINEA REMESA (" + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam013#1) % -103);
         eaDescr   = eaDescr + ") CON PAGARE/TALON (" + #dscam013#37 + "/" + #dscam013#38 + ") DESDE MANTENIMIENTO";
         eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
         eaTipoOp  = "B";   enImpAct = #dscam012#10;
         eaFicher = "dscam012"; eaClave = #dscam012#0;
         |HAZ GrabaAudit;
      |FINSI;
      |ACABA;
   |SINO;
      |SI ModoEntrada = 3;
         eaUsuario = Usuario % 0810;
         eaDescr   = "BAJA LINEA REMESA (" + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam013#1) % -103);
         eaDescr   = eaDescr + ") CON RECIBO (" + #dscam003#0 + "/" + #dscam003#1 + "/" + #dscam003#2 + ") DESDE MANTENIMIENTO";
         eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
         eaTipoOp  = "B";   enImpAct = #dscam012#10;
         eaFicher = "dscam012"; eaClave = #dscam012#0;
         |HAZ GrabaAudit;
      |FINSI;
   |FINSI;

   |HAZ EsLuxe;
   |SI FSalida = 0; |Y ModoEntrada = 3; |Y Flag < 0;
      #dscam003#40 = #dscam013#16;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         |SI #dscam013#31 ! #dscam003#12;
            #dscam003#12 = #dscam013#31;
            |GRABA 020#dscam003.a;
         |FINSI;
         |LIBERA #dscam003;
      |FINSI;
   |FINSI;

   #dscam012#5  = #dscam012#5 +. 1;
   #dscam012#10 = #dscam012#10 +. #dscam013#7;
   #dscam012#11 = #dscam012#6 * #dscam012#5;   || La comision solo sera en moneda base
   #dscam012#12 = #dscam012#12 +. #dscam013#10;
   |SI #dscam013#6 < #dscam012#1;
      #dscam012#13 = #dscam012#13 +. #dscam013#7;
   |FINSI;
   |SI #dscam012#24 = "S";
      #dscam012#25 = #dscam012#25 +. #dscam013#39;
   |FINSI;
   |SI #dscam012#22 = 6; |O #dscam012#22 = 7;
      #dscam012#26 = #dscam012#26 +. #dscam013#40;
      #dscam012#27 = #dscam012#27 +. #dscam013#41;
      #dscam012#30 = #dscam012#30 +. ((#dscam013#7 % #dscam012#28) ! nDeci_Base);
   |FINSI;
   |PINTA #dscam012#5;
   |PINTA #dscam012#10;
   |PINTA #dscam012#11;
   |PINTA #dscam012#12;
   |PINTA #dscam012#13;
   |PINTA #dscam012#25;
   |PINTA #dscam012#26;
   |PINTA #dscam012#27;
   |PINTA #dscam012#30;

   |SI Flag < 0;
      nDocAnt = #dscam013#16;
   |SINO;
      nDocAnt = 0;
      |SI #dscam051#75 = "S";
         |ABRE #dscam004; |ABRE #dscam003;
         #dscam003#40 = #dscam013#16;
         |LEE 101#dscam003.=;
         |SI FSalida = 0; |Y #dscam003#90 = "N";
            #dscam003#90 = "S";
            |SI #dscam051#133 = "S";
                 #dscam003#51 = #dscam012#2;
                 #dscam003#52 = #dscam012#3;
            |FINSI;
            |GRABA 020#dscam003.a;

            #dscam004#17 = #dscam013#16;
            #dscam004#3 = 99;
            |LEE 000#dscam004.];
            |SI FSalida ! 0;
               |LEE 000#dscam004.u;
               |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
                  LinCob = #dscam004#3 + 1;
               |SINO;
                  LinCob = 1;
               |FINSI;
            |SINO;
               |SI #dscam004#17 = #dscam013#16;
                  LinCob = #dscam004#3 + 1;
               |SINO;
                  |LEE 000#dscam004.a;
                  |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
                     LinCob = #dscam004#3 + 1;
                  |SINO;
                     LinCob = 1;
                  |FINSI;
               |FINSI;
            |FINSI;
            |DDEFECTO #dscam004;
            #dscam004#17 = #dscam013#16;
            #dscam004#15 = #dscam003#27;
            #dscam004#0  = #dscam003#0;
            #dscam004#1  = #dscam003#1;
            #dscam004#2  = #dscam003#2;
            #dscam004#3  = LinCob;
            #dscam004#4  = #dscam012#14;
            #dscam004#5  = "PRE";
            #dscam004#6  = ~;
            #dscam004#7  = #dscam003#23;
            #dscam004#8  = #dscam003#31;
            #dscam004#25 = #dscam003#61;
            #dscam004#26 = #dscam003#65;
            #dscam004#11 = #dscam003#13;
            #dscam004#33 = #dscam003#59;
            #dscam004#43 = 0;
            #dscam004#44 = #dscam003#31;
            #dscam004#45 = #dscam004#44 * #dscam004#33;
            #dscam004#46 = 0;
            #dscam004#47 = 0;
            |GRABA 020#dscam004.n; |LEE 000#dscam004.=
            |CIERRA #dscam004; |CIERRA #dscam003;
         |FINSI;
         |LIBERA #dscam003;
      |FINSI;
   |FINSI;
   |SI ModoEntrada ! 3; |O Flag > 0; |ACABA; |FINSI;
   |ABRE #dscam003; |ABRE #dscam004; |HAZ ActualRec; |CIERRA #dscam004; |CIERRA #dscam003;
   eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
|FPRC;

|PROCESO RellenaTempo;
   |SI nSwLuxe = 1; |Y #dscam003#100 = "S"; |ACABA; |FINSI;

   |HAZ MiraSiFactConta;
   |SI nSwErr = 1; |ACABA; |FINSI;


   |SI aDomicil ! "T";
      #dscam224#0 = #dscam003#40;
      |LEE 000#dscam224.=;
      |SI FSalida ! 0; |DDEFECTO #dscam224; |FINSI;

      aAlfa = #dscam224#1; |QBF aAlfa;

      |SI aDomicil = "N"; |Y aAlfa ! ""; |ACABA; |FINSI;
      |SI aDomicil = "S"; |Y aAlfa = ""; |ACABA; |FINSI;
   |FINSI;

   |SI #dscam051#112 = "N";
      |SI #dscam003#14 = "I"; |ACABA; |FINSI;
   |FINSI;

   |SI #dscam012#22 = 5;
      |SI #dscam003#97 = "N"; |ACABA; |FINSI;
   |SINO;
      |SI #dscam003#97 = "S"; |ACABA; |FINSI;
   |FINSI;
   |SI #dscam051#75 = "N";
      |SI #dscam003#90 = "N"; |ACABA; |FINSI;
   |FINSI;

   #dscam014#0 = #dscam012#2;
   |LEE 000#dscam014.=;
   |SI FSalida = 0;
      |SI nSwGesEnvia = 1; |Y #dscam012#22 = 5;
         |SI #dscam014#0 ! #dscam003#51; |ACABA; |FINSI;
      |SINO;
         |SI #dscam014#40 = "N";
            |SI #dscam014#0 ! #dscam003#51; |Y #dscam051#7 = "S"; |ACABA; |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   |SI #dscam051#2 = "N";
      Calc1 = #dscam012#1;
      Calc2 = #dscam003#3;
      NumDias = Calc2 - Calc1;
      |SI NumDias < 0; |ACABA; |FINSI;
   |FINSI;

   |SI #dscam051#42 = "S";
      |SI #dscam003#28 = "S"; |Y #dscam003#29 = "N"; |ACABA; |FINSI;
   |FINSI;
   |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "C"; |Y #dscam003#14 ! "I"; |Y #dscam003#14 ! "F";
      |ACABA;
   |FINSI;

   ||SI #dscam051#75 = "N";
   |SI #dscam051#47 = "S";
      enSwClas   = 1; eaFichClas = "dscam012"; eaTipoClas = #dscam003#12;
      |HAZ CompruebaClas;
      |SI eaFichClas = "ERROR"; |ACABA; |FINSI;
   |FINSI;

   |SI #dscam012#22 = 6; |O #dscam012#22 = 7;
      nSwError = 0;
      |ABRE #dscam081; |ABRE #dscam082;
      |SELECT #2#dscam082;
      #dscam082#1 = #dscam003#12;
      |LEE 000#dscam082.=;
      |PARA; |SI FSalida = 0; |Y #dscam082#1 = #dscam003#12; |HACIENDO;
         #dscam081#0 = #dscam082#0;
         |LEE 000#dscam081.=;
         |SI FSalida = 0;
            |SI #dscam081#2 ! "F"; nSwError = 1; |SAL; |FINSI;
         |SINO;
            nSwError = 1;
         |FINSI;
         |LEE 000#dscam082.s;
      |SIGUE;
      |SELECT #1#dscam082;
      |CIERRA #dscam082; |CIERRA #dscam081;

      |SI nSwError = 1; |ACABA; |FINSI;
   |FINSI;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   |DDEFECTO #dscaw001;
   #dscaw001#0 = Linea;
   Linea = Linea + 1;
   #dscaw001#1 = #dscam003#27;
   #dscaw001#2 = #dscam003#0;
   #dscaw001#3 = #dscam003#1;
   #dscaw001#4 = #dscam003#2;
   |SI #dscam003#14 ! "F";
      #dscaw001#5 = #dscam003#3;
   |SINO;
      #dscaw001#5 = #dscam003#71;
   |FINSI;
   #dscaw001#6 = #dscam003#65;
   #dscaw001#7 = " ";
   #dscaw001#8 = #dscam003#40;
   #dscaw001#9 = #dscam003#57;
   #dscaw001#10 = #dscam003#5;
   #dscaw001#11 = #dscam003#32;
   #dscaw001#12 = #dscam003#6;
   #dscaw001#13 = #dscam003#14;
   #dscaw001#14 = #dscam003#35;
   #dscaw001#15 = #dscam003#36;
   |GRABA 010#dscaw001.n;
|FPRC;

|DEFBUCLE RellenaTempo;
#dscam003#2;
12,65,35;
fDFechaVto,000000001,nDTRecibo,nDImporte,aDSituacion;
fHFechaVto,999999999,nHTRecibo,nHImporte,aHSituacion;
;
NULL,RellenaTempo;
|FIN;

|PROCESO RellenaTempo1;
   |SI nSwLuxe = 1; |Y #dscam003#100 = "S"; |ACABA; |FINSI;
   |SI #dscam003#90 = "N"; |ACABA; |FINSI;

   |SI fDFechaVto ! "01.01.1900"; |O fHFechaVto ! "31.12.2099";
      |SI #dscam003#71 < fDFechaVto; |O #dscam003#71 > fHFechaVto;
         |ACABA;
      |FINSI;
   |FINSI;

   enSwClas   = 1; eaFichClas = "dscam012"; eaTipoClas = #dscam003#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |ACABA; |FINSI;

   #dscam014#0 = #dscam012#2;
   |LEE 000#dscam014.=;
   |SI FSalida = 0;
      |SI nSwGesEnvia = 1; |Y #dscam012#22 = 5;
         |SI #dscam014#0 ! #dscam003#51; |ACABA; |FINSI;
      |SINO;
         |SI #dscam014#40 = "N";
            |SI #dscam014#0 ! #dscam003#51; |Y #dscam051#7 = "S"; |ACABA; |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   |SI #dscam051#2 = "N";
      Calc1 = #dscam012#1;
      Calc2 = #dscam003#3;
      NumDias = Calc2 - Calc1;
      |SI NumDias < 0; |ACABA; |FINSI;
   |FINSI;

   |SI #dscam003#14 ! "T"; |Y #dscam003#14 ! "p";
      |ACABA;
   |FINSI;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   |SELECT #2#dscaw028;
   |DDEFECTO #dscaw028;
   #dscaw028#1 = #dscam003#72;
   #dscaw028#2 = #dscam003#70;
   |LEE 000#dscaw028.];
   |SI FSalida ! 0; |O #dscaw028#1 ! #dscam003#72; |O #dscaw028#2 ! #dscam003#70;
      |DDEFECTO #dscaw028;
      #dscaw028#0 = Linea; Linea = Linea + 1;
      #dscaw028#1 = #dscam003#72;
      #dscaw028#2 = #dscam003#70;
      #dscaw028#3 = #dscam003#79;
      #dscaw028#4 = " ";
      #dscaw028#5 = #dscam003#32;
      #dscaw028#6 = #dscam003#5;
      #dscaw028#7 = #dscam003#6;
      #dscaw028#8 = #dscam003#71;
      ||#dscaw028#9 = #dscam003#;
      |GRABA 010#dscaw028.n;
   |FINSI;
   |SELECT #1#dscaw028;
|FPRC;

|DEFBUCLE RellenaTempo1;
#dscam003#2;
12,65;
"01.01.0000",000000001,nDTRecibo,nDImporte;
"31.12.9999",999999999,nHTRecibo,nHImporte;
;
NULL,RellenaTempo1;
|FIN;

|RUTINA inf01a;
   #dscaw001#0 = 1;
   #dscaw001#10 = "";
   #dscaw001#11 = "";
|FRUT;

|RUTINA sup01a;
   #dscaw001#0 = 99999;
   #dscaw001#10 = "zzzzzzzzzzzz";
   #dscaw001#11 = "zzzzzz";
|FRUT;

|RUTINA inf01b;
   #dscaw001#0 = 1;
   #dscaw001#5 = "01.01.0000";
|FRUT;

|RUTINA sup01b;
   #dscaw001#0 = 99999;
   #dscaw001#5 = "31.12.9999";
|FRUT;

|RUTINA inf028;
   #dscaw028#0 = 1;
|FRUT;

|RUTINA sup028;
   #dscaw028#0 = 999;
|FRUT;

|RUTINA inf028a;
   #dscaw028#0 = 1;
   #dscaw028#1 = "    ";
   #dscaw028#2 = "          ";
|FRUT;

|RUTINA sup028a;
   #dscaw028#0 = 999;
   #dscaw028#1 = "zzzz";
   #dscaw028#2 = "zzzzzzzzzz";
|FRUT;

|RUTINA inf028b;
   #dscaw028#0 = 1;
   #dscaw028#5 = "      ";
|FRUT;

|RUTINA sup028b;
   #dscaw028#0 = 999;
   #dscaw028#5 = "zzzzzz";
|FRUT;

|RUTINA inf028c;
   #dscaw028#0 = 1;
   #dscaw028#8 = "01.01.0000";
|FRUT;

|RUTINA sup028c;
   #dscaw028#0 = 999;
   #dscaw028#8 = "31.12.9999";
|FRUT;

|PROCESO VuelcaRecibos;
   |SI Linea > 999; |ACABA; |FINSI;

   |ABRE #dscam003;
   #dscam003#40 = #dscaw001#8;
   |LEE 000#dscam003.=;
   |CIERRA #dscam003;

   |DDEFECTO #dscam013;
   #dscam013#0 = #dscam012#0;
   #dscam013#1 = Linea;         Linea = Linea + 1;
   #dscam013#2 = #dscaw001#1;
   #dscam013#4 = #dscaw001#2;
   #dscam013#3 = #dscaw001#3;
   #dscam013#5 = #dscaw001#4;
   #dscam013#6 = #dscaw001#5;
   #dscam013#11 = #dscam003#5;
   #dscam013#16 = #dscaw001#8;
   #dscam013#31 = #dscam003#12;

   |ABRE #dscam003;
   nSwRec = 0;
   |SI #dscam012#22 = 1; |O #dscam012#22 = 2; |O #dscam012#22 = 5; |O #dscam012#22 = 6;
      #dscam013#40 = (#dscam003#65 % #dscam012#29) ! nDeci_Base;
      #dscam013#41 = #dscam003#65 - #dscam013#40;
      |HAZ RecogeRec;
   |SINO;
      |HAZ RecogePag;
   |FINSI;
   |CIERRA #dscam003;
   |SI nSwRec = 0;
      |GRABA 020#dscam013.n;
      |LEE 000#dscam013.=;
      |HAZ Total;
   |FINSI;
|FPRC;

|DEFBUCLE VuelcaRecibos;
#dscaw001#1;
7;
00001,"*";
99999,"*";
;
NULL,VuelcaRecibos;
|FIN;

|PROCESO RecibosPag;
   |SI Linea > 999; |ACABA; |FINSI;

   |DDEFECTO #dscam013;
   #dscam013#0 = #dscam012#0;
   #dscam013#1 = Linea;         Linea = Linea + 1;
   #dscam013#2 = #dscam003#27;
   #dscam013#4 = #dscam003#0;
   #dscam013#3 = #dscam003#1;
   #dscam013#5 = #dscam003#2;
   #dscam013#6 = #dscam003#71;
   #dscam013#11 = #dscam003#5;
   #dscam013#16 = #dscam003#40;
   |SI #dscam003#47 ! "S";
      #dscam013#7 = #dscam003#65;
      #dscam013#22 = #dscam003#31;
   |SINO;
      |SI #dscam003#23 = 0; || Entrega a cuenta pdte.cobro
         ||#dscam013#7 = #dscam003#78;
         ||#dscam013#22 = #dscam003#79;
         #dscam013#7 = #dscam003#65;
         #dscam013#22 = #dscam003#31;
      |SINO;                || Entrega a cuenta normal
         #dscam013#7 = #dscam003#61;
         #dscam013#22 = #dscam003#23;
      |FINSI;
   |FINSI;
   #dscam013#37 = #dscam003#72;
   #dscam013#38 = #dscam003#70;
   #dscam013#31 = #dscam003#12;
   |SI #dscam012#22 = 6; |O #dscam012#22 = 7;
      #dscam013#40 = (#dscam013#7 % #dscam012#29) ! nDeci_Base;
      #dscam013#41 = #dscam013#7 - #dscam013#40;
   |FINSI;
   |ABRE #dscam090;
   |LEE 000#dscam090.p;
   |SI FSalida = 0;
      |PARA nCont = 1; |SI nCont [ 60; |HACIENDO nCont = nCont + 3;
         nCalc1 = #dscam090#nCont#;  nCont = nCont + 1;
         nCalc2 = #dscam090#nCont#;  nCont = nCont + 1;
         nTimbre = #dscam090#nCont#; nCont = nCont - 2;
         |SI nCalc1 [ #dscam013#7; |Y nCalc2 ] #dscam013#7;
            #dscam013#39 = nTimbre;
         |FINSI;
      |SIGUE;
   |FINSI;
   |CIERRA #dscam090;

   |GRABA 020#dscam013.n; |LEE 000#dscam013.=;

   #dscam012#5 = #dscam012#5 +. 1;
   #dscam012#10 = #dscam012#10 +. #dscam013#7;
   #dscam012#11 = #dscam012#6 * #dscam012#5;   || La comision solo sera en moneda base
   #dscam012#12 = #dscam012#12 +. #dscam013#10;
   |SI #dscam013#6 < #dscam012#1;
      #dscam012#13 = #dscam012#13 +. #dscam013#7;
   |FINSI;
   |SI #dscam012#24 = "S";
      #dscam012#25 = #dscam012#25 +. #dscam013#39;
   |FINSI;
   |SI #dscam012#22 = 6; |O #dscam012#22 = 7;
      #dscam012#26 = #dscam012#26 +. #dscam013#40;
      #dscam012#27 = #dscam012#27 +. #dscam013#41;
      #dscam012#30 = #dscam012#30 +. ((#dscam013#7 % #dscam012#28) ! nDeci_Base);
   |FINSI;
   |PINTA #dscam012#5;
   |PINTA #dscam012#10;
   |PINTA #dscam012#11;
   |PINTA #dscam012#12;
   |PINTA #dscam012#13;
   |PINTA #dscam012#25;
   |PINTA #dscam012#26;
   |PINTA #dscam012#27;
   |PINTA #dscam012#30;

   eaUsuario = Usuario % 0810;
   eaDescr   = "ALTA LINEA REMESA (" + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam013#1) % -103);
   eaDescr   = eaDescr + ") CON PAGARE/TALON (" + #dscam003#72 + "/" + #dscam003#70 + ") DESDE MANTENIMIENTO";
   eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
   eaTipoOp  = "A";   enImpAnt = #dscam012#10 - #dscam013#7; enImpAct = #dscam012#10;
   eaFicher = "dscam012"; eaClave = #dscam012#0;
   |HAZ GrabaAudit;

|FPRC;

|DEFBUCLE RecibosPag;
#dscam003#7;
;
#dscaw028#1,#dscaw028#2,000000001;
#dscaw028#1,#dscaw028#2,999999999;
be;
NULL,RecibosPag;
|FIN;

|PROCESO VuelcaRecibos1;
   ||#dscam012#5  = #dscam012#5 + 1;
   |BUCLE RecibosPag;
|FPRC;

|DEFBUCLE VuelcaRecibos1;
#dscaw028#1;
4;
001,"*";
999,"*";
;
NULL,VuelcaRecibos1;
|FIN;

|PROCESO PideAcot;
   |PUSHV 1015 1860;
   |BLANCO 1015 1860;

   || #dscaw111#6 = nDTRecibo; #dscaw111#7 = nHTRecibo;
   |PINPA #0#dscaw111; |PINDA #0#dscaw111;

   |SI #dscam012#22 = 3; |O #dscam012#22 = 4; |O #dscam012#22 = 5; |O #dscam012#22 = 7;
      |C_M #dscaw111#2, 1, "N"; |C_V #dscaw111#2, 1, "N";
      |C_M #dscaw111#3, 1, "N"; |C_V #dscaw111#3, 1, "N";
      |C_M #dscaw111#8, 1, "N"; |C_V #dscaw111#8, 1, "N";
      |PINTA 1716, "ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";
      |PINTA 1816, "                                            ";
   |SINO;
      |C_M #dscaw111#2, 1, "S"; |C_V #dscaw111#2, 1, "S"; |PINTA #dscaw111#2;
      |C_M #dscaw111#3, 1, "S"; |C_V #dscaw111#3, 1, "S"; |PINTA #dscaw111#2;
      |C_M #dscaw111#8, 1, "S"; |C_V #dscaw111#8, 1, "S"; |PINTA #dscaw111#8;
   |FINSI;

   |ENDATOS #1#dscaw111;
   |SI FSalida = 0;
      fDFechaVto  = #dscaw111#0; fHFechaVto  = #dscaw111#1;
      aDSituacion = #dscaw111#2; aHSituacion = #dscaw111#3;
      nDImporte   = #dscaw111#4; nHImporte   = #dscaw111#5;
      nDTRecibo   = #dscaw111#6; nHTRecibo   = #dscaw111#7;
      aDomicil    = #dscaw111#8;
   |FINSI;
   |POPV;
|FPRC;

|PROCESO RemAut;
   nSwLuxe = 0; |HAZ EsLuxe;
   |SI FSalida = 0; nSwLuxe = 1; |FINSI;

   nSwArtenvas = 0; |HAZ EsArtenvas;
   |SI FSalida = 0; nSwArtenvas = 1; |FINSI;

   enTipoRem = #dscam012#22;

   |SI nSwLuxe = 1;
      aAlfa = "0400N" + &191 + " Editar usuarios avisos ?";
      |CONFI aAlfa;
      |SI FSalida = 0;
         aAlfa = "dscaz157.tab;dscam012" + (("00000" + #dscam012#0) % -105) + ",MTOUSU";
         |SUB_EJECUTA aAlfa;
      |FINSI;
   |FINSI;

   |SI #dscam051#75 = "S";
      nDTRecibo = #dscam012#7; nHTRecibo = #dscam012#7;
   |SINO;
      nDTRecibo = 0; nHTRecibo = 99;
   |FINSI;

   nAutom = 0;
   |SI FSalida = 2; |ACABA; |FINSI;
   ModoEntrada = (FEntrada / 100) ! 0;

   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
   |FINSI;
   |CIERRA #dscam051;

   |SI ModoEntrada = 1; Linea = 1; |FINSI;
   |SI ModoEntrada = 2;
      |ABRE #dscam013;
      #dscam013#0 = #dscam012#0;
      #dscam013#1 = 1;
      |LEE 000#dscam013.];
      |PARA; |SI FSalida = 0; |Y #dscam013#0 = #dscam012#0; |HACIENDO;
         Linea = #dscam013#1 + 1;
         |LEE 000#dscam013.s;
      |SIGUE;
      |CIERRA #dscam013;
   |FINSI;
   |CONFI "0400N¨ Remesas automaticas ?";
   |SI FSalida = 0;
      nSwRemeAuto = 1;
      fDFechaVto = "01.01.1900"; fHFechaVto = "31.12.2099";
      aDSituacion = "   "; aHSituacion = "zzz";
      nDImporte   = -999999999999.99; nHImporte   = 9999999999999.99;
      nDTRecibo = #dscam012#7; nHTRecibo = #dscam012#7;
      aDomicil = "T";
      |HAZ PideAcot;

      nAutom = 1; enRemesa = 1;
      Comodin = "rr" + Usuario; |NOME_DAT #4 Comodin;
      Comodin = "rp" + Usuario; |NOME_DAT #8 Comodin;
      |DELINDEX #dscaw001;
      |DELINDEX #dscaw028;
      |ABRE #dscaw001;
      |ABRE #dscaw028;
      |ABRE #dscam013;
      |ABRE #dscam014;
      eaTipoRecibo = "V";

      |ABRE #dscam224;
      |SI #dscam012#22 = 1; |O #dscam012#22 = 2; |O #dscam012#22 = 5; |O #dscam012#22 = 6;
         |BUCLE RellenaTempo;
      |SINO;
         |BUCLE RellenaTempo1;
      |FINSI;
      |CIERRA #dscam224;

      TotalSel = 0;
      |PUSHV 05012380;
      |SI #dscam012#22 = 1; |O #dscam012#22 = 2; |O #dscam012#22 = 5; |O #dscam012#22 = 6;
         enSwLineal = 1; enClave = 1;
         |PARA; |SI enSwLineal ! 0; |HACIENDO;
            |SI enClave = 1; enSwLineal = 0; |ENTLINEAL #2#dscaw001,-3,4,17,1,inf01a,sup01a; |FINSI;
            |SI enClave = 2; enSwLineal = 0; |ENTLINEAL #3#dscaw001,-2,4,17,1,inf01b,sup01b; |FINSI;
         |SIGUE;
      |SINO;
         enSwLineal = 1; enClave = 1;
         |PARA; |SI enSwLineal ! 0; |HACIENDO;
            |SI enClave = 1; enSwLineal = 0; |ENTLINEAL #2#dscaw028,-3,4,19,1,inf028a,sup028a; |FINSI;
            |SI enClave = 2; enSwLineal = 0; |ENTLINEAL #3#dscaw028,-2,4,19,1,inf028b,sup028b; |FINSI;
            |SI enClave = 3; enSwLineal = 0; |ENTLINEAL #4#dscaw028,-2,4,19,1,inf028c,sup028c; |FINSI;
         |SIGUE;
      |FINSI;
      FEstado = FSalida;
      |POPV;
      |SI FEstado = 0;
         |SI ModoEntrada = 1; Linea = 1; |FINSI;
         |SI ModoEntrada = 2;
            |ABRE #dscam013;
            #dscam013#0 = #dscam012#0;
            #dscam013#1 = 1;
            |LEE 000#dscam013.];
            |PARA; |SI FSalida = 0; |Y #dscam013#0 = #dscam012#0; |HACIENDO;
               Linea = #dscam013#1 + 1;
               |LEE 000#dscam013.s;
            |SIGUE;
            |CIERRA #dscam013;
         |FINSI;
         |SI #dscam012#22 = 1; |O #dscam012#22 = 2; |O #dscam012#22 = 5; |O #dscam012#22 = 6;
            nSwBucle  = 1;
            |BUCLE VuelcaRecibos;
            nSwBucle  = 0;
         |SINO;
            |BUCLE VuelcaRecibos1;
         |FINSI;
      |FINSI;

      eaSesion   = Usuario; |HAZ LimpiaTempo;

      |CIERRA #dscam014;
      |CIERRA #dscam013;
      |CIERRA #dscaw028;
      |CIERRA #dscaw001;
      |PTEC 808; |PTEC 808;
      nAutom = 0;

      |DDEFECTO #dscaw111;
   |FINSI;
|FPRC;

|PROCESO ActRecibos;

   |SI #dscam013#15 = "R"; |ACABA; |FINSI;
   |ABRE #dscam014;
   |ABRE #dscam003;
   |ABRE #dscam004;

   #dscam003#40 = #dscam013#16;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#47 ! "S";
         #dscam003#14 = "R";
         #dscam003#15 = "Remesado";
         ||HAZ CambioTipoRec;
      |SINO;
         |SI #dscam003#23 = 0;  || Entrega a cuenta no cobrada
            #dscam003#14 = "R";
            #dscam003#15 = "Remesado";
         |FINSI;
      |FINSI;
      #dscam003#17 = #dscam012#0;
      #dscam003#37 = #dscam013#1;
      #dscam003#53 = #dscam012#1;
      |SI nSwArtenvas = 0;
         #dscam003#26 = #dscam012#1;
      |SINO;
         |SI #dscam051#133 = "S";
              #dscam003#51 = #dscam012#2;
              #dscam003#52 = #dscam012#3;
         |FINSI;
      |FINSI;
      |GRABA 020#dscam003.a;
      |LIBERA #dscam003;
      |LEE 000#dscam003.=;
   |FINSI;

   |CIERRA #dscam004;
   |CIERRA #dscam003;
   |CIERRA #dscam014;

|FPRC;

|PROCESO ActRecibos1;
   |HAZ ActRecibos;
   eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam013#16; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE ActRecibos;
#dscam013#1;
;
#dscam012#0,001;
#dscam012#0,999;
;
NULL,ActRecibos1;
|FIN;

|PROCESO HazRemesa; |TIPO 3;
   |SI #dscam012#22 = 0; |POSICIONATE #dscam012#22; |FINSI;
   |SI SwSalir = 1; SwSalir = 0; |ACABA; |FINSI;
   |BUCLE ActRecibos;
|FPRC;

|PROCESO MiraDivisa;
   |SI FSalida = 2; |ACABA; |FINSI;
   |SI HayGestion = 1;
      Fichero = "Parametros Divisas"; Tipo = "G"; Cmp = "Moneda Base"; |HAZ ObtenDato;
      |LEE 000#agif321@.p; Calc = CmpNum;
      |SI FSalida = 0;
         Fichero = "Divisas"; Tipo = "G"; Cmp = "Codigo Divisa"; |HAZ ObtenDato;
         #agif324@#CmpNum# = #agif321@#Calc#;
         |LEE 000#agif324@.=;
         |SI FSalida = 0;
            Fichero = "Divisas"; Tipo = "G"; Cmp = "Num.Decimales"; |HAZ ObtenDato;
            nDeci_Base = #agif324@#CmpNum#;
            Fichero = "Divisas"; Tipo = "G"; Cmp = "Valor Venta"; |HAZ ObtenDato;
            CambioBase = #agif324@#CmpNum#;
         |FINSI;
      |FINSI;
   |SINO;
      nDeci_Base = 0;
   |FINSI;
|FPRC;

|PROCESO Busca;
     |SI FSalida = 10;
          aAlfa = "dscaz225;" + #dscam013#16;
          |SUB_EJECUTA_NP aAlfa;
          |ERROR;
     |FINSI;
     |SI FSalida = 11;
          PosLibro = 1616; PosSerie = 1626; PosFactu = 1641; PosRecib = 1659;
         |HAZ ConsultaVentas;
         |SI enDocum ! -1; |Y enFactura ! -1;
               #dscam013#16 = enDocum;  |PINTA #dscam013#16;
               #dscam013#2 = enLibro;   |PINTA #dscam013#2;
               #dscam013#4 = eaSerie;   |PINTA #dscam013#4;
               #dscam013#3 = enFactura; |PINTA #dscam013#3;
               #dscam013#5 = enRecibo;  |PINTA #dscam013#5;
         |SINO;
               |MENAV "    Ficha inexistente"; |ERROR;
         |FINSI;
         SwClave = 1;
     |FINSI;
|FPRC;

|PROCESO MiraTipo;
   |POPV;
   nSwCartel = 0;

   |SI #dscam012#22 = 0; |ERROR; |ACABA; |FINSI;
   |SI #dscam012#22 = 1; Comodin = "Recibos al cobro     "; |FINSI;
   |SI #dscam012#22 = 2; Comodin = "Recibos al descuento "; |FINSI;
   |SI #dscam012#22 = 3; Comodin = "Pagares al cobro     "; |FINSI;
   |SI #dscam012#22 = 4; Comodin = "Pagares al descuento "; |FINSI;
   |SI #dscam012#22 = 5; Comodin = "Rec.cobro confirming "; |FINSI;
   |SI #dscam012#22 = 6; Comodin = "Recibos factoring    "; |FINSI;
   |SI #dscam012#22 = 7; Comodin = "Pagars factoring    "; |FINSI;
   |ATRI I; |PINTA 0651, Comodin; |ATRI N;
   |SI #dscam012#22 = 1; |O #dscam012#22 = 2; |O #dscam012#22 = 5; |O #dscam012#22 = 6;
      |PINTA 1610, "Libro     Serie        Factura         N§ Recibo              ";

      |C_V #dscam013#37,1,"N";  |C_V #dscam013#38,1,"N";
      |C_V #dscam013#2,1,"S";   |C_V #dscam013#3 ,1,"S";
      |C_V #dscam013#4,1,"S";   |C_V #dscam013#5 ,1,"S";

      |C_P #dscam013#37,1,1010; |C_P #dscam013#38,1,1110;
      |C_P #dscam013#2,1,1616;  |C_P #dscam013#4,1,1626;
      |C_P #dscam013#3,1,1641;  |C_P #dscam013#5,1,1659;

      |C_M #dscam013#37,1,"N";  |C_M #dscam013#38,1,"N";
      |C_M #dscam013#16,1,"S";
   |SINO;
      |PINTA 1610, "Entidad       N§ Documento                                    ";
      |C_V #dscam013#37,1,"S";  |C_V #dscam013#38,1,"S";
      |C_V #dscam013#2,1,"N";   |C_V #dscam013#3 ,1,"N";
      |C_V #dscam013#4,1,"N";   |C_V #dscam013#5 ,1,"N";

      |C_P #dscam013#37,1,1618; |C_P #dscam013#38,1,1637;
      |C_P #dscam013#2,1,0501;  |C_P #dscam013#4,1,0601;
      |C_P #dscam013#3,1,0701;  |C_P #dscam013#5,1,0801;

      |C_M #dscam013#37,1,"S";  |C_M #dscam013#38,1,"S";
      |C_M #dscam013#16,1,"N";
   |FINSI;
|FPRC;

|PROCESO TrasBanco;
   |ABRE #dscam014;
   #dscam014#0 = #dscam012#2;
   |LEE 000#dscam014.=;
   |SI FSalida ! 0; |DDEFECTO #dscam014; |FINSI;
   |CIERRA #dscam014;

   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 1;
      #dscam012#3 = #dscam014#1;   |PINTA #dscam012#3;
      #dscam012#14 = #dscam014#10; |PINTA #dscam012#14;
      #dscam012#16 = #dscam014#34; |PINTA #dscam012#16;
      #dscam012#17 = #dscam014#35; |PINTA #dscam012#17;
      #dscam012#18 = #dscam014#37; |PINTA #dscam012#18;
      #dscam012#19 = #dscam014#36; |PINTA #dscam012#19;
   |FINSI;

   |SI #dscam012#22 = 6; |O #dscam012#22 = 7;
      |SI #dscam014#66 = 0;
         |MENAV "    No puede hacer una remesa de factoring al 0% de retencion";
         |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO VuelcaPag;
   |SI nSw = 0;
      || Bloque de comprobacion de los recibos del pagare

      enSwClas   = 1; eaFichClas = "dscam012"; eaTipoClas = #dscam003#12;
      |HAZ CompruebaClas;
      |SI eaFichClas = "ERROR";
         |MENAV "    Documento inoperable en el perfil actual ";
         nSw = -1; |ERROR10; |ACABA;
      |FINSI;

      |SI #dscam051#111 = "S"; |Y #dscam012#22 [ 2;
          eaTipoCod = "C";
          |HAZ ChequeoIBAN;
          |SI ewErrorIBAN = 1;
             |MENAV "0000El documento indicado tiene vacio el Codigo IBAN";
             nSw = -1;
             |ERROR10;
             |ACABA;
          |FINSI;
          |SI ewErrorIBAN = 2;
              |MENAV "0000NEl Codigo IBAN del documento indicado puede ser erroneo. Continuar";
              nSw = -1;
              |ERROR10;
              |ACABA;
          |FINSI;

/*
         eaEntidad = #dscam003#8;
         eaSucursal = #dscam003#9;
         eaCuenta = #dscam003#11;
         eaDC = "";
         |HAZ CalculoDC;
         |SI #dscam003#10 = "  ";
            aAlfa = "    El documento " + #dscam003#40 + " tiene vacio el DC de la cuenta bancaria. Proceso cancelado.";
            |MENAV aAlfa;
             nSw = -1; |ERROR10; |ACABA;
         |SINO;
            |SI #dscam003#8 = "    "; |O #dscam003#9 = "    "; |O #dscam003#11 = "          ";
               aAlfa = "    El documento " + #dscam003#40 + " tiene la cuenta bancaria con datos vacios.";
               |MENAV aAlfa;
               nSw = -1; |ERROR10; |ACABA;
            |SINO;
               |SI eaDC ! #dscam003#10;
                  aAlfa = "    El documento " + #dscam003#40 + " tiene mal informado el DC de la cuenta bancaria. Proceso cancelado.";
                  |MENAV aAlfa;
                  nSw = -1; |ERROR10; |ACABA;
               |FINSI;
            |FINSI;
         |FINSI;
*/

      |FINSI;

      |SI #dscam003#14 = "L";
         aAlfa = "    El documento " + #dscam003#40 + " esta liquidado. ";
         |MENAV aAlfa;
         nSw = -1; |ERROR10; |ACABA;
      |FINSI;

      |ACABA;   || Fin del bloque de comprobacion
   |FINSI;

   |SI #dscam003#47 ! "S"; |Y #dscam003#69 = " ";
      NumLinea = 0;
      #dscam004#17 = #dscam003#40;
      #dscam004#3 = 1;
      |LEE 000#dscam004.];
      |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
         |SI #dscam004#5 = "RPT"; NumLinea = #dscam004#3; |FINSI;
         |LEE 000#dscam004.s;
      |SIGUE;
      |SI NumLinea ! 0;
         #dscam004#17 = #dscam003#40;
         #dscam004#3  = NumLinea;
         |LEE 000#dscam004.=;
      |FINSI;

      |SI #dscam004#17 = #dscam003#40;
         nImporteB = #dscam003#31 * #dscam004#33;
         nImporteD = #dscam003#31;
      |SINO;
         nImporteB = #dscam003#65;
         nImporteD = #dscam003#31;
      |FINSI;
   |SINO;
      nImporteB = #dscam003#64;
      nImporteD = #dscam003#30;
   |FINSI;

   eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscam003#40; |HAZ ProcesaTempo;

   |DDEFECTO #dscam013;
   #dscam013#0  = #dscam012#0;
   #dscam013#1  = Linea;        Linea = Linea + 1;
   #dscam013#6  = #dscam003#71;
   #dscam013#16 = #dscam003#40;
   |GRABA 020#dscam013.b;

   |SI HayGestion = 1;
      Fichero = "Divisas"; Tipo = "G"; Cmp = "Codigo Divisa"; |HAZ ObtenDato;
      #agif324@#CmpNum# = #dscam003#57;
      |LEE 000#agif324@.=;
      |SI FSalida = 0;
         Fichero = "Divisas"; Tipo = "G"; Cmp = "Valor Venta"; |HAZ ObtenDato;
         #dscam013#21 = CambioBase / #agif324@#CmpNum#;
         #dscam013#23 = #dscam003#59;
         Fichero = "Divisas"; Tipo = "G"; Cmp = "Num.Decimales"; |HAZ ObtenDato;
         nDeci_Div = #agif324@#CmpNum#;
      |FINSI;
   |SINO;
      |SI #dscam003#57 ! "EUR";
         #dscam013#21 = 1;
         #dscam013#23 = 1;
         nDeci_Div = 0;
      |SINO;
         #dscam013#21 = 1;
         #dscam013#23 = 1;
         nDeci_Div = 2;
      |FINSI;
   |FINSI;

   #dscam013#22 = nImporteD;
   #dscam013#7  = nImporteB;
   |SI #dscam012#22 = 6; |O #dscam012#22 = 7;
      #dscam013#40 = (nImporteD % #dscam012#29) ! nDeci_Base;
      #dscam013#41 = nImporteD - #dscam013#40;
   |FINSI;

   Calc1 = #dscam012#1;
   Calc2 = #dscam013#6;
   NumDias = Calc2 - Calc1;
   |SI NumDias < 0;
      NumDias = 0;
      #dscam013#12 = "S";
      nInteres = 0;
      nPorcInt = 0;
   |SINO;
      #dscam013#12 = "N";
      |SI #dscam014#28 ! 0; |O #dscam014#29 ! 0; |O #dscam014#30 ! 0; |O #dscam014#31 ! 0;
         |SI NumDias ] #dscam014#20; |Y NumDias [ #dscam014#24;
            nInteres = ((#dscam013#7 * #dscam014#28) / 36000) * NumDias;
            nPorcInt = #dscam014#28;
         |FINSI;
         |SI NumDias ] #dscam014#21; |Y NumDias [ #dscam014#25;
            nInteres = ((#dscam013#7 * #dscam014#29) / 36000) * NumDias;
            nPorcInt = #dscam014#29;
         |FINSI;
         |SI NumDias ] #dscam014#22; |Y NumDias [ #dscam014#26;
            nInteres = ((#dscam013#7 * #dscam014#30) / 36000) * NumDias;
            nPorcInt = #dscam014#30;
         |FINSI;
         |SI NumDias ] #dscam014#23; |Y NumDias [ #dscam014#27;
            nInteres = ((#dscam013#7 * #dscam014#31) / 36000) * NumDias;
            nPorcInt = #dscam014#31;
         |FINSI;
      |SINO;
         |SI #dscam014#32 ! 0;
            nInteres = (#dscam013#7 * #dscam014#32) * NumDias;
            nPorcInt = #dscam014#32;
         |SINO;
            nInteres = ((#dscam013#7 * #dscam014#17) / 36000) * NumDias;
            nPorcInt = #dscam014#17;
         |FINSI;
      |FINSI;
   |FINSI;
   #dscam013#8  = NumDias;
   |SI #dscam012#22 = 2; |O #dscam012#22 = 4;
      #dscam013#9  = nPorcInt;
      #dscam013#10 = nInteres;
   |SINO;
      #dscam013#9  = 0;
      #dscam013#10 = 0;
   |FINSI;
   #dscam013#11 = #dscam003#5;
   #dscam013#37 = #dscam003#72;
   #dscam013#38 = #dscam003#70;
   #dscam013#2  = #dscam003#27;
   #dscam013#3  = #dscam003#1;
   #dscam013#4  = #dscam003#0;
   #dscam013#5  = #dscam003#2;
   #dscam013#31 = #dscam003#12;

   |ABRE #dscam090;
   |LEE 000#dscam090.p;
   |SI FSalida = 0;
      |PARA nCont = 1; |SI nCont [ 60; |HACIENDO nCont = nCont + 3;
         nCalc1 = #dscam090#nCont#;  nCont = nCont + 1;
         nCalc2 = #dscam090#nCont#;  nCont = nCont + 1;
         nTimbre = #dscam090#nCont#; nCont = nCont - 2;
         |SI nCalc1 [ #dscam013#7; |Y nCalc2 ] #dscam013#7;
            #dscam013#39 = nTimbre;
         |FINSI;
      |SIGUE;
   |FINSI;
   |CIERRA #dscam090;

   |GRABA 020#dscam013.a; |LIBERA #dscam013;

   #dscam012#5 = #dscam012#5 + 1;
   #dscam012#10 = #dscam012#10 + #dscam013#7;
   #dscam012#11 = #dscam012#6 * #dscam012#5;   || La comision solo sera en moneda base
   #dscam012#12 = #dscam012#12 + #dscam013#10;
   |SI #dscam013#6 < #dscam012#1;
      #dscam012#13 = #dscam012#13 + #dscam013#7;
   |FINSI;
   |SI #dscam012#24 = "S";
      #dscam012#25 = #dscam012#25 + #dscam013#39;
   |FINSI;
   |SI #dscam012#22 = 6; |O #dscam012#22 = 7;
      #dscam012#26 = #dscam012#26 + #dscam013#40;
      #dscam012#27 = #dscam012#27 + #dscam013#41;
      #dscam012#30 = #dscam012#30 + ((#dscam013#7 % #dscam012#28) ! nDeci_Base);
   |FINSI;
   |GRABA 020#dscam012.a;
   |PINTA #dscam012#5;
   |PINTA #dscam012#10;
   |PINTA #dscam012#11;
   |PINTA #dscam012#12;
   |PINTA #dscam012#13;
   |PINTA #dscam012#25;
   |PINTA #dscam012#26;
   |PINTA #dscam012#27;
   |PINTA #dscam012#30;

   eaUsuario = Usuario % 0810;
   eaDescr   = "ALTA LINEA REMESA (" + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam013#1) % -103);
   eaDescr   = eaDescr + ") CON PAGARE/TALON (" + #dscam003#72 + "/" + #dscam003#70 + ") DESDE MANTENIMIENTO";
   eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
   eaTipoOp  = "A";   enImpAnt = #dscam012#10 - #dscam013#7; enImpAct = #dscam012#10;
   eaFicher = "dscam012"; eaClave = #dscam012#0;
   |HAZ GrabaAudit;

   eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam003#40; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE VuelcaPag;
#dscam003#7;
;
#dscam013#37,#dscam013#38,000000001;
#dscam013#37,#dscam013#38,999999999;
;
NULL,VuelcaPag;
|FIN;

|PROCESO RecogePag;
   |SI #dscam012#22 ! 3; |Y #dscam012#22 ! 4; |Y #dscam012#22 ! 7; |ACABA; |FINSI;

   |SI nSwBucle  = 0;
      |SI FSalida = 2; |ACABA; |FINSI;

      aAlfa = #dscam013#37; |QBF aAlfa;
      |SI aAlfa = "";
         aAlfa = #dscam013#38; |QBF aAlfa;
         |SI aAlfa = "";
            |MENAV "    Debe indicar el numero del pagare";
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;
   |FINSI;

   ModoEntrada = (FEntrada / 100) ! 0;

   |ABRE #dscam003; |SELECT #7#dscam003;
   |ABRE #dscam004;

   aNumEntid = #dscam013#37;
   aNumDocum = #dscam013#38;
   NumLinea = #dscam013#1;
   SwError  = 0;

   |SALVA_FICHA #dscam013;
   #dscam013#0 = #dscam012#0;
   #dscam013#1 = 1;
   |LEE 000#dscam013.];
   |SI FSalida = 0; |Y #dscam013#0 = #dscam012#0;
      |PARA; |SI FSalida = 0; |Y #dscam013#0 = #dscam012#0; |HACIENDO;
         |SI #dscam013#37 = aNumEntid; |Y #dscam013#38 = aNumDocum; |Y NumLinea ! #dscam013#1;
            SwError = 1;
            |SAL;
         |SINO;
            |LEE 000#dscam013.s;
         |FINSI;
      |SIGUE;
   |FINSI;
   |REPON_FICHA #dscam013;
   |SI SwError = 1;
      |MENAV "    Pagare ya incluido";
      |ERROR;
      |ACABA;
   |FINSI;

   nSw = 0; |BUCLE VuelcaPag;
   |SI nSw < 0; |ACABA; |FINSI;

   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;

   |SELECT #7#dscam003;
   #dscam003#72 = #dscam013#37;
   #dscam003#70 = #dscam013#38;
   #dscam003#40 = 1;
   |LEE 000#dscam003.];
   |SI FSalida = 0; |Y #dscam003#72 = #dscam013#37; |Y #dscam003#70 = #dscam013#38;
      |SI ModoEntrada = 1; |O #dscam013#37 ! Contenido; |O #dscam013#38 ! Contenido;
         |SI #dscam051#2 = "N";
            Calc1 = #dscam012#1;
            Calc2 = #dscam003#71;
            NumDias = Calc2 - Calc1;
            |SI NumDias < 0;
               |MENAV "    Pagare vencido";
               |SELECT #1#dscam003; |CIERRA #dscam003;
               |ERROR;
               |ACABA;
            |FINSI;
         |FINSI;

         |SI #dscam003#14 ! "T";
            |SI #dscam003#47 ! "S"; |Y #dscam003#69 = " ";
               |MENAV "    No es un pagare/talon dispuesto para remesar";
               |SELECT #1#dscam003; |CIERRA #dscam003;
               |ERROR; |ACABA;
            |FINSI;
         |FINSI;

         |SI #dscam003#90 = "N";
            |MENAV "    El pagare/talon contiene documentos no preparados";
            |SELECT #1#dscam003; |CIERRA #dscam003;
            |ERROR; |ACABA;
         |FINSI;

      |FINSI;
   |FINSI;

   |SI #dscam051#3 = "S"; |Y ModoEntrada = 1;
      Calc = #dscam014#13 + #dscam003#79;
      |SI Calc > #dscam014#12; |Y Mensaje = 0;
         Mensaje = 1;
         |CONFI "0400NRiesgo del banco superado.¨Continuar?";
         |SI FSalida ! 0;
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;

      eaCliGest = #dscam003#32; |HAZ SacaRiesgo;
      Calc = enRiesgoUsado + #dscam003#79 - enRiesgoFact;
      |SI Calc > enRiesgoConced;
         |CONFI "0400NRiesgo de cliente superado.¨ Continuar ?";
         |SI FSalida ! 0;
            |SELECT #1#dscam003; |CIERRA #dscam003;
            |ERROR; |ACABA;
         |FINSI;
      |SINO;
         |SI enRiesgoUsado < 0;
            |SI Mensaje = 0;
               |MENAV "    Riesgo de cliente no definido";
               Mensaje = 1;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   ||#dscam012#5  = #dscam012#5 + 1;
   Linea = #dscam013#1; nSw = 1; |BUCLE VuelcaPag;

   |PONCONTROL 23, "si"; |PTEC 814; |PTEC 815;
   |CIERRA #dscam004;
   |SELECT #1#dscam003; |CIERRA #dscam003;
|FPRC;

|PROCESO TomaTipo; |TIPO 7;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada ! 1;
      |C_M #dscam012#22,1,"N";
   |SINO;
      |C_M #dscam012#22,1,"S";
   |FINSI;

   nSwCartel = 1;
   |PUSHV 0551 1379;
   |BLANCO 0551 1379; |CUADRO 0551 1379;
   |ATRI R;
   |PINTA 0652, "<1> Recibos al cobro       ";
   |PINTA 0752, "<2> Recibos al descuento   ";
   |PINTA 0852, "<3> Pagars al cobro       ";
   |PINTA 0952, "<4> Pagars al descuento   ";
   |PINTA 1052, "<5> Confirmings            ";
   |PINTA 1152, "<6> Recibos factoring      ";
   |PINTA 1252, "<7> Pagars factoring      ";
   |ATRI N;
|FPRC;

|PROCESO PintaTipo; |TIPO 13;
   eaClvUsuarios = "dscam012" + (("00000" + #dscam012#0) % -105);
   nSwLuxe = 0; |HAZ EsLuxe;
   |SI FSalida = 0; nSwLuxe = 1; |FINSI;

   nSwArtenvas = 0; |HAZ EsArtenvas;
   |SI FSalida = 0; nSwArtenvas = 1; |FINSI;

   |HAZ TomaDecim;

   Comodin = "";
   |SI #dscam012#22 = 1; Comodin = "Recibos al cobro     "; |FINSI;
   |SI #dscam012#22 = 2; Comodin = "Recibos al descuento "; |FINSI;
   |SI #dscam012#22 = 3; Comodin = "Pagares al cobro     "; |FINSI;
   |SI #dscam012#22 = 4; Comodin = "Pagares al descuento "; |FINSI;
   |SI #dscam012#22 = 5; Comodin = "Rec.cobro confirming "; |FINSI;
   |SI #dscam012#22 = 6; Comodin = "Recibos factoring    "; |FINSI;
   |SI #dscam012#22 = 7; Comodin = "Pagars factoring    "; |FINSI;
   |ATRI I; |PINTA 0651, Comodin; |ATRI N;
   |SI #dscam012#22 ! 1; |Y #dscam012#22 ! 3;
      |PINTA 1232, "Abonada ...... "; |C_V #dscam012#8,1,"S"; |PINTA #dscam012#8;
   |SINO;
      |PINTA 1232, "                  "; |C_V #dscam012#8,1,"N";
   |FINSI;

  nModo = (FEntrada / 100) ! 0;
  |SI nModo = 4;
     nSwIn = 1;
     |HAZ Intereses;
     nSwIn = 0;
     |LIBERA #dscam012;
  |FINSI;

   |SI nSwMiraGesEnvia = 0;
      |DBASS aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "gesenvia/def/gestr000.mas";
      |XABRE "E", aAlfa, nHandle;
      |SI FSalida ] 0;
         nSwGesEnvia = 1;
      |SINO;
         nSwGesEnvia = 0;
      |FINSI;
      nSwMiraGesEnvia = 1;
   |FINSI;
   |ABRE #dscam051; |LEE 000#dscam051.p; |CIERRA #dscam051;
|FPRC;

|PROCESO BuscaCierre;
   |DFICB aAlfa; |QBF aAlfa;
   |PATH_DAT #16 aAlfa;
   aAlfa = "";

   |ABRE #dscam067; |ABRE #dscam042;
   #dscam067#0  = "RM";
   #dscam067#1  = #dscam012#0;
   #dscam067#2  = 1;
   #dscam067#3  = "E";
   #dscam067#11 = 1;
   |LEE 000#dscam067.];
   aAlfa2 = #dscam067#3; |QBF aAlfa2;
   |SI FSalida = 0; |Y #dscam067#0  = "RM"; |Y #dscam067#1  = #dscam012#0;
    |Y #dscam067#2  = 1; |Y aAlfa2 = "E"; |Y #dscam067#11 = 1;
      #dscam042#0 = #dscam067#8;
      #dscam042#1 = #dscam067#9;
      |LEE 000#dscam042.=;
      |SI FSalida = 0;
         aAlfa = #dscam042#2; |QBF aAlfa;
      |FINSI;
   |SINO;
      |DDEFECTO #dscam067;
      #dscam067#0  = "RM";
      #dscam067#1  = #dscam012#0;
      #dscam067#2  = 1;
      #dscam067#3  = "V";
      #dscam067#11 = 1;
      |LEE 000#dscam067.];
      aAlfa2 = #dscam067#3; |QBF aAlfa2;
      |SI FSalida = 0; |Y #dscam067#0  = "RM"; |Y #dscam067#1  = #dscam012#0;
       |Y #dscam067#2  = 1; |Y aAlfa2 = "V"; |Y #dscam067#11 = 1;
         #dscam042#0 = #dscam067#8;
         #dscam042#1 = #dscam067#9;
         |LEE 000#dscam042.=;
         |SI FSalida = 0;
            aAlfa = #dscam042#2; |QBF aAlfa;
         |FINSI;
      |SINO;
         |DDEFECTO #dscam067;
         #dscam067#0  = "RM";
         #dscam067#1  = #dscam012#0;
         #dscam067#2  = 1;
         #dscam067#3  = "I";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         aAlfa2 = #dscam067#3; |QBF aAlfa2;
         |SI FSalida = 0; |Y #dscam067#0  = "RM"; |Y #dscam067#1  = #dscam012#0;
          |Y #dscam067#2  = 1; |Y aAlfa2 = "I"; |Y #dscam067#11 = 1;
            #dscam042#0 = #dscam067#8;
            #dscam042#1 = #dscam067#9;
            |LEE 000#dscam042.=;
            |SI FSalida = 0;
               aAlfa = #dscam042#2; |QBF aAlfa;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
   |CIERRA #dscam067; |CIERRA #dscam042;
   efFecha = #dscam067#5;
   |DDEFECTO #dscam067;

   |SI aAlfa = "";
      |MENAV "    La remesa debia tener movimientos contables, pero no se han encontrado";
      |ACABA;
   |FINSI;

   enSwError   = 0;
   eaDirConta  = aAlfa; |QBF eaDirConta;
   eaEmpContab = (("00000" + #dscam042#0) % -105) + #dscam042#1;
   |HAZ CompruebaEmpContable;
   |SI enSwError < 0; |Y enSwError > -3;
      nSwErr = -1;
   |SINO;
      nSwErr = 0;
   |FINSI;
|FPRC;

|PROCESO MiraSiTabla;
   |ABRE #dscam090;
   |LEE 000#dscam090.p;
   |SI FSalida ! 0;
      |PUSHV 0501 2380;
      |CLS;
      |CABEZA " Tabla importes de timbre ";
      |PINPA #0#dscam090; |PINDA #0#dscam090;
      |ENDATOS #1#dscam090;
      |SI FSalida = 0;
         |GRABA 020#dscam090.a;
      |SINO;
         |MENAV "    No hay tabla de importes de timbre. No se calcularan los timbres.";
         #dscam012#24 = "N"; |PINTA #dscam012#24;
      |FINSI;
      |POPV;
   |FINSI;
   |CIERRA #dscam090;
|FPRC;

|PROCESO MiraSiAv;
   ModoEntrada = (FEntrada / 100) ! 0;

   |SI FSalida = 1; |O FSalida = 5; |Y #dscam012#22 = 0;
      |POSICIONATE #dscam012#22;
   |FINSI;
   |SI #dscam012#1 ! Contenido; |Y ModoEntrada = 2;
      |CONFI "    NSe van a recalcular los dias hasta el vto. y los intereses. Continuar ?";
      |SI FSalida = 0;
         |GRABA 020#dscam012.a;
         |HAZ Intereses;
      |SINO;
         |ERROR;
      |FINSI;
   |FINSI;

   |HAZ EsOTP;
   |SI enGrupoOTP = 1;
      #dscam012#22 = 1; |PINTA #dscam012#22;
   |FINSI;
|FPRC;

|PROCESO MiraSiClas; |TIPO 7;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
   |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#75 = "N";
      |C_M #dscam012#7,1,"N"; #dscam012#7 = 0; |PINTA #dscam012#7;
      nDTRecibo = 00; nHTRecibo = 99;
   |SINO;
      |C_M #dscam012#7,1,"S";
   |FINSI;
|FPRC;

|PROCESO RecalcInt;
   Calc1 = #dscam012#1;
   Calc2 = #dscam013#6;
   NumDias = Calc2 - Calc1;
   |SI NumDias < 0;
      NumDias = 0;
      #dscam013#12 = "S";
      nInteres = 0;
      nPorcInt = 0;
   |SINO;
      #dscam013#12 = "N";
      |SI #dscam014#28 ! 0; |O #dscam014#29 ! 0; |O #dscam014#30 ! 0; |O #dscam014#31 ! 0;
         |SI NumDias ] #dscam014#20; |Y NumDias [ #dscam014#24;
            nInteres = ((#dscam013#7 * #dscam014#28) / 36000) * NumDias;
            nPorcInt = #dscam014#28;
         |FINSI;
         |SI NumDias ] #dscam014#21; |Y NumDias [ #dscam014#25;
            nInteres = ((#dscam013#7 * #dscam014#29) / 36000) * NumDias;
            nPorcInt = #dscam014#29;
         |FINSI;
         |SI NumDias ] #dscam014#22; |Y NumDias [ #dscam014#26;
            nInteres = ((#dscam013#7 * #dscam014#30) / 36000) * NumDias;
            nPorcInt = #dscam014#30;
         |FINSI;
         |SI NumDias ] #dscam014#23; |Y NumDias [ #dscam014#27;
            nInteres = ((#dscam013#7 * #dscam014#31) / 36000) * NumDias;
            nPorcInt = #dscam014#31;
         |FINSI;
      |SINO;
         |SI #dscam014#32 ! 0;
            nInteres = (#dscam013#7 % #dscam014#32) * NumDias ;
            nPorcInt = #dscam014#32;
         |SINO;
            nInteres = ((#dscam013#7 * #dscam014#17)/36000) * NumDias;
            nPorcInt = #dscam014#17;
         |FINSI;
      |FINSI;
   |FINSI;
   #dscam013#8  = NumDias;
   |SI #dscam012#22 = 2; |O #dscam012#22 = 4;
      #dscam013#9  = nPorcInt;
      #dscam013#10 = nInteres;
   |SINO;
      #dscam013#9  = 0;
      #dscam013#10 = 0;
   |FINSI;

   |GRABA 020#dscam013.a;
   nTotalInt = nTotalInt + #dscam013#10;
|FPRC;

|DEFBUCLE RecalcInt;
#dscam013#1;
;
#dscam012#0, 001;
#dscam012#0, 999;
be;
NULL,RecalcInt;
|FIN;

|PROCESO Intereses;
   |ABRE #dscam014;
   #dscam014#0 = #dscam012#2;
   |LEE 000#dscam014.=;
   |SI FSalida ! 0; |DDEFECTO #dscam014; |FINSI;
   |CIERRA #dscam014;

   nTotalInt = 0;
   |ABRE #dscam013;
   #dscam013#0 = #dscam012#0;
   #dscam013#1 = 1;
   |LEE 000#dscam013.];
   FEstado = FSalida;
   |CIERRA #dscam013;

   |SI FEstado = 0; |Y #dscam013#0 = #dscam012#0;
      Calc1 = #dscam012#1; Calc2 = #dscam013#6;
      Calc1 = Calc2 - Calc1;
      |SI Calc1 ! #dscam013#8;
         |BUCLE RecalcInt;
      |SINO;
         nTotalInt = #dscam012#12;
      |FINSI;
   |SINO;
      |BUCLE RecalcInt;
   |FINSI;

   |SI nSwIn = 0; |PONCONTROL 23, "si"; |FINSI;

   |SI nSwIn = 1;
      |LEE 101#dscam012.=;
      |SI FSalida = 0;
         #dscam012#12 = nTotalInt; |PINTA #dscam012#12;
         |GRABA 020#dscam012.a;
         |LIBERA #dscam012;
      |FINSI;
   |SINO;
      #dscam012#12 = nTotalInt; |PINTA #dscam012#12;
      |GRABA 020#dscam012.a;
   |FINSI;
|FPRC;

|PROCESO CambioTipoRec;
   |HAZ EsLuxe;
   |SI FSalida = 0;
      |SI #dscam003#12 ! 4; |Y #dscam003#12 ! 8; #dscam003#12 = 2; |FINSI;
   |FINSI;
|FPRC;

|PROCESO Tipo2m012; |TIPO 2;
   nFlag = 0 +. 1;

   |SI enBotonUsuarios ! 0;
      |SI #dscam012#22 = 2; |Y nFlag < 0;
         |ESTADO_CONTROL enBotonUsuarios, "ENABLE";
      |SINO;
         |ESTADO_CONTROL enBotonUsuarios, "DISABLE";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO CheqImpRecibos;
     |SI #3#27 ! 0; |O #3#46 = 0; |ACABA; |FINSI;

     |ABRE #dscam051; |LEE 000#dscam051.p; |CIERRA #dscam051;

     |SI #dscam051#131 = "N"; |ACABA; |FINSI;

     nDeci_BaseMx = nDeci_Base;
     nImpRec = 0; nImpFac = 0; nImpVto = 0;

     aPath = #48#17; |QBF aPath;
     aAlfa = aPath + "def/agifa134";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          aAlfa = aPath + "fich/" + (("00000" + #3#46) % -105) + "/";
          |PATH_DAT #referen@#aAlfa#;
          |ABRE #referen@;
          #referen@#49 = #3#0;
          #referen@#0 = #3#1;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               fFecEmi = #referen@#1;
          |FINSI;
          nSal134 = FSalida;
          |CIERRA #referen@;
          nImpFac = #referen@#31 ! nDeci_Base;
          |DESCARGA_DEF #referen@;
     |FINSI;

     |SI nSal134 ! 0;
          aPath = #48#17; |QBF aPath;
          aAlfa = aPath + "def/agifa084";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               aAlfa = aPath + "fich/" + (("00000" + #3#46) % -105) + "/";
               |PATH_DAT #referen@#aAlfa#;
               |ABRE #referen@;
               #referen@#48 = #3#0;
               #referen@#0 = #3#1;
               |LEE 000#referen@.=;
               |SI FSalida = 0;
                    fFecEmi = #referen@#1;
               |FINSI;
               nSal84 = FSalida;
               |CIERRA #referen@;
               nImpFac = #referen@#41 ! nDeci_Base;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;

     aPath = #48#17; |QBF aPath;
     aAlfa = aPath + "def/agifa133";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          aAlfa = aPath + "fich/" + (("00000" + #3#46) % -105) + "/";
          |PATH_DAT #referen@#aAlfa#;
          |ABRE #referen@;
          #referen@#4 = #3#0;
          #referen@#0 = #3#1;
          #referen@#1 = 1;
          |LEE 000#referen@.];
          |PARA; |SI FSalida = 0; |Y #referen@#4 = #3#0; |Y #referen@#0 = #3#1;
                    |HACIENDO;
               nImpVto = nImpVto + (#referen@#2 ! nDeci_Base);
               |LEE 000#referen@.s;
          |SIGUE;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "dscam003";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |SELECT #12#referen@;
          #referen@#0 = #3#0;
          #referen@#1 = #3#1;
          #referen@#2 = 0;
          #referen@#4 = "01.01.0000";
          #referen@#5 = "";
          #referen@#32 = "";
          |LEE 000#referen@.];
          |PARA; |SI FSalida = 0; |Y #referen@#0 = #3#0; |Y #referen@#1 = #3#1;
                    |HACIENDO;
               |SI #referen@#46 = #3#46; |Y #referen@#4 = fFecEmi;
                    nImpRec = nImpRec + (#referen@#64 ! nDeci_Base);
               |FINSI;
               |LEE 000#referen@.s;
          |SIGUE;
          |DESCARGA_DEF #referen@;
     |FINSI;

     nImpRec = (nImpRec + .49) ! 0;
     nImpFac = (nImpFac + .49) ! 0;
     nImpVto = (nImpVto + .49) ! 0;

     |SI nSal134 = 0; |O nSal84 = 0;
          |SI nImpRec ! nImpFac; |O nImpRec ! nImpVto;
               aAlfa = "0000Revise el importe de los recibos de la factura: " + #3#0; |QBF aAlfa;
               aAlfa = aAlfa + "." + (("000000"+#3#1)%-106) + " se detectan diferencias.";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;
