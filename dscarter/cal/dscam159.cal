|FICHEROS;
   dscam159 #0;

   dscam044 #10;
   dscam045 #11;

   Referen@ #100;
|FIN;

|VARIABLES;
   aAlfa   = "";

   &Fichero = "";
   &Tipo    = "";
   &Cmp     = "";
   &CmpNum  = 0;

   nTecla  = 0;
   nLinea  = 0;
   nSwError = 0;
   aSerie  = "";
|FIN;

|PROCESO Tipo00C02Fm159; |TIPO 0;
   nTecla = FSalida;
   |SI nTecla ! 10; |Y nTecla ! 0; |ACABA; |FINSI;

   aAlfa = #48#16; |QBF aAlfa; aAlfa = aAlfa + "def/anm00001.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      aAlfa = #48#16; |QBF aAlfa;
      aAlfa = aAlfa + "fich/" + (("00000" + #48#14) % -105) + #48#19 + "/";
      |PATH_DAT #Referen@#aAlfa#;
      |ABRE #Referen@;
      |SI nTecla = 10;
         |CONSULTA_CLAVE #1#Referen@;
         |SI FSalida = 0;
            #dscam159#2 = #Referen@#0; |PINTA #dscam159#2;
         |FINSI;
      |FINSI;
      #Referen@#0 = #dscam159#2;
      |LEE 000#Referen@.=;
      |SI FSalida = 0;
         #dscam159#2 = #Referen@#0;
      |SINO;
         |MENAV "    Cuenta analitica inexistente"; |ERROR;
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;

   |PONCONTROL 23, "si";
|FPRC;

|PROCESO Tipo00C01Fm159; |TIPO 0;
   nTecla = FSalida;
   |SI nTecla ! 10; |Y nTecla ! 0; |ACABA; |FINSI;

   nSwError = 0;
   aSerie = #dscam159#1; nLinea = #dscam159#0;
   |SALVA_FICHA #dscam159;
   |SELECT #2#dscam159;
   #dscam159#1 = aSerie;
   |LEE 000#dscam159.];
   |PARA; |SI FSalida = 0; |HACIENDO;
      |SI #dscam159#1 = aSerie; |Y #dscam159#0 ! nLinea;
         |MENAV "    La serie indicada ya existe ";
         nSwError = 1; |SAL;
      |FINSI;
      |LEE 000#dscam159.s;
   |SIGUE;
   |SELECT #1#dscam159;
   |REPON_FICHA #dscam159;

   |SI nSwError ! 0; |ERROR; |ACABA; |FINSI;

   |DFICB aAlfa; |QBF aAlfa;
   |PATH_DAT #dscam044#aAlfa#; |PATH_DAT #dscam045#aAlfa#;
   |ABRE #dscam044;            |ABRE #dscam045;

   |SELECT #2#dscam045;
   #dscam045#6 = #48#0;
   |LEE 000#dscam045.=;
   |PARA; |SI FSalida = 0; |HACIENDO;
      |SI #dscam045#2 = "V";
         |SI #dscam045#4 [ #dscam159#1; |Y #dscam045#5 ] #dscam159#1; |SAL; |FINSI;
      |FINSI;
      |LEE 000#dscam045.s;
   |SIGUE;

   |SI #dscam045#2 = "V"; |Y #dscam045#4 [ #dscam159#1; |Y #dscam045#5 ] #dscam159#1;
      #dscam044#0 = #dscam045#0;
      |LEE 000#dscam044.=;
      |SI FSalida = 0;
         aAlfa = #dscam044#1; |QBF aAlfa;
         Fichero = "Series"; Tipo = "G"; Cmp = ""; |HAZ ObtenFich;
         aAlfa = aAlfa + "def/" + Fichero + ".mas";
         |CARGA_DEF aAlfa, Referen@;
         |SI FSalida = 0;
            aAlfa = #dscam044#1; |QBF aAlfa;
            aAlfa = aAlfa + "fich/" + (("00000" + #dscam045#0) % -105) + "/";
            |PATH_DAT #Referen@#aAlfa#;
            |ABRE #Referen@;
            Fichero = "Series"; Tipo = "G"; Cmp = "Codigo Serie"; |HAZ ObtenDato;
            |SI nTecla = 10;
               |CONSULTA_CLAVE #1#Referen@;
               |SI FSalida = 0;
                  #dscam159#1 = #Referen@#CmpNum#; |PINTA #dscam159#1;
               |FINSI;
            |FINSI;
            #Referen@#CmpNum# = #dscam159#1;
            |LEE 000#Referen@.=;
            |SI FSalida = 0;
               #dscam159#2 = #Referen@#43;
            |SINO;
               |MENAV "    Serie inexistente"; |ERROR;
            |FINSI;
            |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
         |FINSI;
      |FINSI;
   |FINSI;

   |SELECT #1#dscam045;
   |CIERRA #dscam045;
   |PONCONTROL 23, "si";
|FPRC;

|RUTINA Inf;
   #dscam159#0 = 1;
|FRUT;

|RUTINA Sup;
   #dscam159#0 = 999;
|FRUT;

|PROGRAMA;
   |CLS;
   |CABEZA "Correspondencia serie - cuenta analitica";

   |ENTLINEAL #1#0, -1, 1, 21, 1, Inf, Sup;
|FPRO;
