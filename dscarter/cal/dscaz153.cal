|FICHEROS;
   dscaz153 #0;

   dscaw114 #10,MANTE;
   dscaw115 #11,MANTE;

   dscam003 #20;
   dscam008 #21;

   canempr@ #100;
   cacuent@ #101;
|FIN;

|VARIABLES;

   aAlfa    = "";
   aAlfa1   = "";

   aDCodigo = "";
   aHCodigo = "";
   aDCuenta = "";
   aHCuenta = "";
   aParte1  = "";
   aParte2  = "";

   nCalc    = 0;
   nCalc1   = 0;
   nMaxDig  = 0;
   nTecla   = 0;
   nCont    = 0;
   nSwHay   = 0;

   fFecha   = @;
|FIN;

|PROCESO MiraCodigo;
   aAlfa = #dscaz153#Campo#; |QBF aAlfa;
   |SI aAlfa ! "";
      aAlfa = ("000000" + aAlfa) % -106;
      #dscaz153#Campo# = aAlfa; |PINTA #dscaz153#Campo#;
   |FINSI;
|FPRC;

|PROCESO MiraCuenta;
   nTecla = FSalida;

   aAlfa = #48#16; |QBF aAlfa;
   aAlfa = aAlfa + "def/canempre.mas";
   |CARGA_DEF aAlfa, canempr@;
   |SI FSalida = 0;
      aAlfa = #48#16; |QBF aAlfa;
      aAlfa = aAlfa + "def/cacuenta.mas";
      |CARGA_DEF aAlfa, cacuent@;

      aAlfa = #48#16; |QBF aAlfa;
      aAlfa = aAlfa + "fich/";
      |PATH_DAT #canempr@#aAlfa#;
      aAlfa = aAlfa + (("00000" + #48#14) % -105) + #48#19 + "/";
      |PATH_DAT #cacuent@#aAlfa#;

      nMaxDig = 0;
      |ABRE #canempr@;
      #canempr@#2 = #48#14;
      #canempr@#3 = #48#19;
      |LEE 000#canempr@.=;
      |SI FSalida = 0;
         |PARA nCont = 14; |SI nCont [ 19; |HACIENDO nCont = nCont + 1;
            |SI nMaxDig [ #canempr@#nCont#;
               nMaxDig = #canempr@#nCont#;
            |FINSI;
         |SIGUE;
      |FINSI;

      aAlfa = #dscaz153#Campo#; |QBF aAlfa;
      aAlfa = aAlfa - ".";
      |PARA; |SI FSalida ! 0; |HACIENDO;
         nCalc = FSalida + 98;               aParte2 = aAlfa % nCalc;
         nCalc = ((FSalida / 100) ! 0) + 99; aParte1 = aAlfa % nCalc;
         aAlfa1 = aParte1 % 0; nCalc = aAlfa1;
         aAlfa1 = aParte2 % 0; nCalc1 = aAlfa1; nCalc = nCalc + nCalc1;
         nCalc = nMaxDig - nCalc;

         aAlfa = aParte1 + ("0" * nCalc) + aParte2;

         aAlfa = aAlfa - ".";
      |SIGUE;
      #dscaz153#Campo# = aAlfa; |PINTA #dscaz153#Campo#;

      |ABRE #cacuent@;
      |SI nTecla = 10;
         #cacuent@#0 = #dscaz153#Campo#;
         |LEE 000#cacuent@.];
         |CONSULTA_CLAVE #1#cacuent@;
         |SI FSalida = 0;
            #dscaz153#Campo# = #cacuent@#0; |PINTA #dscaz153#Campo#;
            |ERROR;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Desmarca;
   |SI #dscaz153#0 = "C";
      fFecha = #dscaw114#6;
      |ENCAMPO #6#dscaw114;
      |SI #dscaw114#6 ! fFecha;
         |SI #dscaw114#13 = "01.01.0000"; #dscaw114#13 = fFecha; |FINSI;
         #dscaw114#12 = "*"; |PINTA #dscaw114#12;
         |GRABA 020#dscaw114.a;
      |FINSI;
      |ERROR;
   |SINO;
      fFecha = #dscaw115#5;
      |ENCAMPO #5#dscaw115;
      |SI #dscaw115#5 ! fFecha;
         |SI #dscaw115#12 = "01.01.0000"; #dscaw115#12 = fFecha; |FINSI;
         #dscaw115#11 = "*"; |PINTA #dscaw115#11;
         |GRABA 020#dscaw115.a;
      |FINSI;
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO ControlNuevo; |TIPO 7;
   |SI #dscaz153#0 = "V";
      |LEE 000#dscaw115.=;
      |SI FSalida ! 0; |ERROR; |LEE 000#dscaw115.u; |FINSI;
   |FINSI;
   |SI #dscaz153#0 = "C";
      |LEE 000#dscaw114.=;
      |SI FSalida ! 0; |ERROR; |LEE 000#dscaw114.u; |FINSI;
   |FINSI;
|FPRC;

|PROCESO Tipo11; |TIPO 11;
   |SI FSalida = 10;
      |SI #dscaz153#0 = "C";
         |SI #dscaw114#12 = "*";
            #dscaw114#6  = #dscaw114#13; |PINTA #dscaw114#6;
            #dscaw114#12 = " ";          |PINTA #dscaw114#12;
            #dscaw114#13 = "01.01.0000"; |PINTA #dscaw114#13;
            |GRABA 020#dscaw114.a;
         |FINSI;
      |SINO;
         |SI #dscaw115#11 = "*";
            #dscaw115#5  = #dscaw115#12; |PINTA #dscaw115#5;
            #dscaw115#11 = " ";          |PINTA #dscaw115#11;
            #dscaw115#12 = "01.01.0000"; |PINTA #dscaw115#12;
            |GRABA 020#dscaw115.a;
         |FINSI;
      |FINSI;
      |ERROR;
   |FINSI;
|FPRC;
*/
|PROCESO GestionContab;
   |SI #dscaz153#1 = "G";
      #dscaz153#18 = "            "; |PINTA #dscaz153#18;
      #dscaz153#19 = "zzzzzzzzzzzz"; |PINTA #dscaz153#19;
      |C_M #dscaz153#16, 1, "S"; |C_M #dscaz153#17, 1, "S";
      |C_M #dscaz153#18, 1, "N"; |C_M #dscaz153#19, 1, "N";
   |SINO;
      #dscaz153#16 = "            "; |PINTA #dscaz153#16;
      #dscaz153#17 = "zzzzzzzzzzzz"; |PINTA #dscaz153#17;
      |C_M #dscaz153#16, 1, "N"; |C_M #dscaz153#17, 1, "N";
      |C_M #dscaz153#18, 1, "S"; |C_M #dscaz153#19, 1, "S";
   |FINSI;
|FPRC;

|PROCESO RellenaTmpVnt;
   |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "C"; |ACABA; |FINSI;

   |DDEFECTO #dscaw115;
   #dscaw115#0  = #dscam003#27;
   #dscaw115#1  = #dscam003#0;
   #dscaw115#2  = #dscam003#1;
   #dscaw115#3  = #dscam003#2;
   #dscaw115#4  = #dscam003#4;
   #dscaw115#5  = #dscam003#3;
   #dscaw115#6  = #dscam003#30;
   #dscaw115#7  = #dscam003#12;
   #dscaw115#8  = #dscam003#32;
   #dscaw115#9  = #dscam003#5;
   #dscaw115#10 = #dscam003#6;
   #dscaw115#13 = #dscam003#40;
   |GRABA 020#dscaw115.n;

   nSwHay = 1;
|FPRC;

|DEFBUCLE RellenaTmpVnt;
#dscam003#9;
12, 4, 3, 32, 5;
#0#2, #0#4, #0#6, #0#8, 0000000001, #0#10, #0#12, #0#14, aDCodigo, aDCuenta;
#0#3, #0#5, #0#7, #0#9, 9999999999, #0#11, #0#13, #0#15, aHCodigo, aHCuenta;
;
NULL, RellenaTmpVnt;
|FIN;

|RUTINA infvnt;
   #dscaw115#0 = 00;
   #dscaw115#1 = "     ";
   #dscaw115#2 = 000000;
   #dscaw115#3 = 000;
   #dscaw115#13 = 0;
|FRUT;

|RUTINA supvnt;
   #dscaw115#0 = 99;
   #dscaw115#1 = "zzzzz";
   #dscaw115#2 = 999999;
   #dscaw115#3 = 999;
   #dscaw115#13 = 999999999;
|FRUT;

|PROCESO RellenaTmpCmp;
   |SI #dscam008#14 ! "P"; |Y #dscam008#14 ! "C"; |ACABA; |FINSI;

   |DDEFECTO #dscaw114;
   #dscaw114#0  = #dscam008#27;
   #dscaw114#1  = #dscam008#0;
   #dscaw114#2  = #dscam008#1;
   #dscaw114#3  = #dscam008#2;
   #dscaw114#4  = #dscam008#63;
   #dscaw114#5  = #dscam008#4;
   #dscaw114#6  = #dscam008#3;
   #dscaw114#7  = #dscam008#25;
   #dscaw114#8  = #dscam008#12;
   #dscaw114#9  = #dscam008#32;
   #dscaw114#10 = #dscam008#5;
   #dscaw114#11 = #dscam008#6;
   #dscaw114#14 = #dscam008#40;
   |GRABA 020#dscaw114.n;
   nSwHay = 1;
|FPRC;

|DEFBUCLE RellenaTmpCmp;
#dscam008#2;
12, 4, 3, 32, 5;
#0#2, #0#4, #0#6, #0#8, #0#10, #0#12, #0#14, aDCodigo, aDCuenta;
#0#3, #0#5, #0#7, #0#9, #0#11, #0#13, #0#15, aHCodigo, aHCuenta;
;
NULL, RellenaTmpCmp;
|FIN;

|RUTINA infcmp;
   #dscaw114#0 = 00;
   #dscaw114#1 = "     ";
   #dscaw114#2 = 000000;
   #dscaw114#3 = 000;
   #dscaw114#14 = 0;
|FRUT;

|RUTINA supcmp;
   #dscaw114#0 = 99;
   #dscaw114#1 = "zzzzz";
   #dscaw114#2 = 999999;
   #dscaw114#3 = 999;
   #dscaw114#14 = 999999999;
|FRUT;

|PROCESO VuelcaCompras;
   #dscam008#40 = #dscaw114#14;
   |LEE 101#dscam008.=;
   |SI FSalida = 0;
      #dscam008#3 = #dscaw114#6;
      |GRABA 020#dscam008.a; |LIBERA #dscam008;
   |FINSI;
|FPRC;

|DEFBUCLE VuelcaCompras;
#dscaw114#1;
12;
0000000000, "*";
9999999999, "*";
;
NULL,VuelcaCompras;
|FIN;

|PROCESO VuelcaVentas;
   #dscam003#40 = #dscaw115#13;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      #dscam003#3 = #dscaw115#5;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;
|FPRC;

|DEFBUCLE VuelcaVentas;
#dscaw115#1;
11;
0000000000, "*";
9999999999, "*";
;
NULL,VuelcaVentas;
|FIN;

|PROGRAMA;
   |ABRE #dscaz153;

   |LEE 000#dscaz153.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscaz153;
      |GRABA 020#dscaz153.c;
   |FINSI;

   |CLS;
   |CABEZA "Cambio masivo de fecha de vencimiento";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |GRABA 020#dscaz153.a;

      |SI #dscaz153#1 = "G";
         |SI #dscaz153#0 = "C";
            |C_V #dscaw114#9, 1, "S"; |C_V #dscaw114#10, 1, "N";
         |SINO;
            |C_V #dscaw115#8, 1, "S"; |C_V #dscaw115#9, 1, "N";
         |FINSI;
      |SINO;
         |SI #dscaz153#0 = "C";
            |C_V #dscaw114#9, 1, "N"; |C_V #dscaw114#10, 1, "S";
         |SINO;
            |C_V #dscaw115#8, 1, "N"; |C_V #dscaw115#9, 1, "S";
         |FINSI;
      |FINSI;

      aAlfa = "tm" + Usuario;
      aDCodigo = #dscaz153#16;   aHCodigo = #dscaz153#17;
      aDCuenta = #dscaz153#18;   aHCuenta = #dscaz153#19;

      |SI #dscaz153#0 = "C";
         |NOME_DAT #dscaw114#aAlfa#;
         |DELINDEX #dscaw114; |ABRE #dscaw114;
         nSwHay = 0;
         |BUCLE RellenaTmpCmp;
         |SI nSwHay ! 0;
            |ENTLINEAL #2#dscaw114, -5, 2, 19, 1, infcmp, supcmp;
         |SINO;
            |MENAV "    Seleccion vacia";
            |SI #dscaz153#0 = "C";
               |CIERRA #dscaw114; |DELINDEX #dscaw114;
            |SINO;
               |CIERRA #dscaw115; |DELINDEX #dscaw115;
            |FINSI;
            |CIERRA #dscaz153; |ACABA;
         |FINSI;
      |SINO;
         |NOME_DAT #dscaw115#aAlfa#;
         |DELINDEX #dscaw115; |ABRE #dscaw115;
         nSwHay = 0;
         |BUCLE RellenaTmpVnt;
         |SI nSwHay ! 0;
            |ENTLINEAL #2#dscaw115, -5, 2, 20, 1, infvnt, supvnt;
         |SINO;
            |MENAV "    Seleccion vacia";
            |SI #dscaz153#0 = "C";
               |CIERRA #dscaw114; |DELINDEX #dscaw114;
            |SINO;
               |CIERRA #dscaw115; |DELINDEX #dscaw115;
            |FINSI;
            |CIERRA #dscaz153; |ACABA;
         |FINSI;
      |FINSI;

      aAlfa = "    N" + &191 + " Conforme con los datos editados ? ";
      |CONFI aAlfa;
      |SI FSalida = 0;
         |SI #dscaz153#0 = "C";
            |ABRE #dscam008;
            |BUCLE VuelcaCompras;
            |CIERRA #dscaw114; |DELINDEX #dscaw114;
            |CIERRA #dscam008;
         |SINO;
            |ABRE #dscam003;
            |BUCLE VuelcaVentas;
            |CIERRA #dscaw115; |DELINDEX #dscaw115;
            |CIERRA #dscam003;
         |FINSI;
      |SINO;
         |SI #dscaz153#0 = "C";
            |CIERRA #dscaw114; |DELINDEX #dscaw114;
         |SINO;
            |CIERRA #dscaw115; |DELINDEX #dscaw115;
         |FINSI;
      |FINSI;
   |FINSI;

   |CIERRA #dscaz153;
|FPRO;
