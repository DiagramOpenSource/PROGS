|FICHEROS;
   dscaz113 #0;

   dscaw087 #10,MANTE;
   dscam008 #11;
   dscam095 #12;
   dscam096 #13;
   dscam014 #14;
   dscaw088 #15,MANTE;
   dscam065 #16;
|FIN;

|VARIABLES;
   fVto = @;
   aPrv = "";
   aRompe = "";
   &eaTipoRecibo = "";   &enNumDocum = 0;
   &enSwError = 0;       &eaTOperacion = "";    &aInforme = "";
   &enNumDocumento = 0;  &eaSesion = "";
   &enEmpGestion = 0;    &enSwVisado = 0;

   aAlfa = "";

   fFechaVto1 = @; fFechaVto2 = @;
   fDFecVto   = @; fHFecVto   = @;

   nTotal = 0;
   nTecla = 0;
   nMarca = 0;
   nLinea = 0;
   nCalc  = 0;

   nAntBanco = 0;
   nBanco    = 0;
   nHayFP    = 0;
   nSwErr    = 0;
   aBanco    = "";
   aCuenta   = "";
|FIN;

|PROCESO EntregasPdtes;
   nSwErr = 1; |ERROR10;
|FPRC;

|DEFBUCLE EntregasPdtes;
#dscam008#5;
14;
aCuenta, 000000001, "e";
aCuenta, 999999999, "e";
;
NULL, EntregasPdtes;
|FIN;

|PROCESO CreaCab;
   |LEE 000#dscam095.u;
   |SI FSalida = 0;
      nCalc = #dscam095#0 + 1;
   |SINO;
      nCalc = 1;
   |FINSI;
   |DDEFECTO #dscam095;
   #dscam095#0 = nCalc;
   #dscam095#1 = ~;
   #dscam095#2 = nBanco;

   |ABRE #dscam014;
   #dscam014#0 = nBanco;
   |LEE 000#dscam014.=;
   |SI FSalida ! 0; |DDEFECTO #dscam014; |FINSI;
   |CIERRA #dscam014;

   #dscam095#3  = #dscam014#1;
   #dscam095#14 = #dscam014#10;
   #dscam095#15 = 0;
   #dscam095#16 = #dscam014#34;
   #dscam095#17 = #dscam014#35;
   #dscam095#18 = #dscam014#37;
   #dscam095#19 = #dscam014#36;
   |GRABA 020#dscam095.b;
|FPRC;

|PROCESO CreaLin;
   #dscam008#40 = #dscaw087#0;
   |LEE 000#dscam008.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   #dscam096#0 = #dscam095#0;
   #dscam096#1 = 999;
   |LEE 000#dscam096.];
   |SI FSalida = 0;
      |SI #dscam096#0 = #dscam095#0;
         nCalc = #dscam096#1 + 1;
      |SINO;
         |LEE 000#dscam096.a;
         |SI FSalida = 0;
            |SI #dscam096#0 = #dscam095#0;
               nCalc = #dscam096#1 + 1;
            |SINO;
               nCalc = 1;
            |FINSI;
         |SINO;
            nCalc = 1;
         |FINSI;
      |FINSI;
   |SINO;
      |LEE 000#dscam096.u;
      |SI FSalida = 0;
         |SI #dscam096#0 = #dscam095#0;
            nCalc = #dscam096#1 + 1;
         |SINO;
            nCalc = 1;
         |FINSI;
      |SINO;
         nCalc = 1;
      |FINSI;
   |FINSI;

   |DDEFECTO #dscam096;
   #dscam096#0  = #dscam095#0;
   #dscam096#1  = nCalc;
   |GRABA 020#dscam096.b;

   #dscam096#2  = #dscam008#27;
   #dscam096#3  = #dscam008#1;
   #dscam096#4  = #dscam008#0;
   #dscam096#5  = #dscam008#2;
   #dscam096#6  = #dscam008#3;
   #dscam096#7  = #dscam008#25;
   #dscam096#11 = #dscam008#5;
   #dscam096#13 = #dscam008#6;
   #dscam096#16 = #dscam008#40;
   #dscam096#22 = #dscam008#56;
   |GRABA 020#dscam096.a; |LIBERA #dscam096;

   #dscam095#5  = #dscam095#5 + 1;
   #dscam095#10 = #dscam095#10 + #dscam096#7;
   |GRABA 020#dscam095.a;

   #dscam008#40 = #dscaw087#0;
   |LEE 101#dscam008.=;
   |SI FSalida = 0;
      #dscam008#14 = "E";
      #dscam008#15 = "Englobado Rel.Pagos Domic";
      #dscam008#39 = "D";
      #dscam008#47 = "Pagos Dom.";
      #dscam008#17 = #dscam095#0;
      |GRABA 020#dscam008.a; |LIBERA #dscam008;
   |FINSI;
|FPRC;

|PROCESO Recibos;
   |SI nHayFP ! 0;
      #dscaw088#0 = #dscam008#12;
      |LEE 000#dscaw088.=;
      |SI FSalida ! 0; |ACABA; |FINSI;
   |FINSI;

   enNumDocumento = #dscam008#40;
   enEmpGestion = #dscam008#46; |HAZ MiraSiVisado;
   |SI enSwVisado < 0; |ERROR; |ACABA; |FINSI;

   enSwError = 0;
   eaTOperacion = "A"; eaTipoRecibo = "C"; enNumDocum = #dscam008#40; |HAZ ProcesaTempo;
   |SI enSwError = 1; |ERROR; |ACABA; |FINSI;

   nTotal = nTotal + #dscam008#25;

   |DDEFECTO #dscaw087;
   #dscaw087#0 = #dscam008#40;
   #dscaw087#1 = #dscam008#0;
   #dscaw087#2 = #dscam008#1;
   #dscaw087#3 = #dscam008#32;
   #dscaw087#4 = #dscam008#5;
   #dscaw087#5 = #dscam008#6;
   #dscaw087#6 = #dscam008#4;
   #dscaw087#7 = #dscam008#3;
   #dscaw087#8 = #dscam008#25;
   #dscaw087#9 = nTotal ! 2;
   |GRABA 020#dscaw087.n;
|FPRC;

|DEFBUCLE Recibos;
#dscam008#8;
14;
#dscaz113#0, #dscaz113#1, #dscaz113#2, #dscaz113#3, "P";
#dscaz113#4, #dscaz113#5, #dscaz113#6, #dscaz113#7, "P";
;
NULL,NULL,NULL,NULL,NULL,Recibos;
#dscam008#3, #dscam008#32, #dscam008#5;
|FIN;

|RUTINA infw087;
   #dscaw087#7 = "01.01.0000";
   #dscaw087#3 = "      ";
   #dscaw087#4 = "            ";
   #dscaw087#0 = 000000001;
|FRUT;

|RUTINA supw087;
   #dscaw087#7 = "31.12.9999";
   #dscaw087#3 = "zzzzzz";
   #dscaw087#4 = "zzzzzzzzzzzz";
   #dscaw087#0 = 999999999;
|FRUT;

|RUTINA infw088;
   #dscaw088#0 = 01;
|FRUT;

|RUTINA supw088;
   #dscaw088#0 = 99;
|FRUT;

|PROCESO FinRel;
   |LIBERA #dscam095;
|FPRC;

|PROCESO Volcado;
     |SI #dscaw087#10 = 0; |ACABA; |FINSI;

     aRompe = "N";
     |SI #0#9 = "A";     ||Vto+Prov
          |SI fVto ! #dscaw087#7; |O aPrv ! #dscaw087#3;
               aRompe = "S";
          |FINSI;
     |FINSI;
     |SI #0#9 = "M";     ||Prov
          |SI aPrv ! #dscaw087#3;
               aRompe = "S";
          |FINSI;
     |FINSI;
     |SI #0#9 = "U";     ||Unico
     |FINSI;

     |SI #dscaw087#10 ! nAntBanco; |O aRompe = "S";
          |SI nAntBanco ! -1; |HAZ FinRel; |FINSI;
          nBanco = #dscaw087#10; |HAZ CreaCab;
          nAntBanco = #dscaw087#10;
     |FINSI;
     |HAZ CreaLin;

     fVto = #dscaw087#7;
     aPrv = #dscaw087#3;
|FPRC;

|DEFBUCLE Volcado;
   #dscaw087#3;
   ;
   INICIO;
   FINAL;
   ;
   NULL,Volcado;
|FIN;

|PROCESO Imprime;
   |PRINT;
|FPRC;

|DEFBUCLE Imprime;
#dscaw087#2;
;
fFechaVto1, "      ", "            ", 000000001;
fFechaVto2, "zzzzzz", "zzzzzzzzzzzz", 999999999;
;
NULL,Imprime;
|FIN;

|PROCESO MarcaBanco; |TIPO 11;
   nTecla = FSalida;
   |SI nMarca = -1;
      |SALVA_FICHA #dscaw087;
      |LEE 000#dscaw087.a;
      |SI FSalida = 0;
         nMarca = #dscaw087#10;
      |FINSI;
   |FINSI;
   |REPON_FICHA #dscaw087;

   |SI nTecla = 10;
      aCuenta = #dscaw087#4;
      nSwErr = 0;
      |BUCLE EntregasPdtes;
      |SI nSwErr = 1;
         aAlfa = "    NEste proveedor tiene entregas a cuenta pendientes de saldar. " + &191 + " Continuar ?";
         |CONFI aAlfa;
         |SI FSalida ! 0;
             |ERROR; |ACABA;
         |FINSI;
      |FINSI;

      #dscaw087#10 = nMarca; |PINTA #dscaw087#10;
      |GRABA 020#dscaw087.a;
      |ERROR;
   |FINSI;

   |SI nTecla = 11;
      |PUSHV 0501 2380;
      |BLANCO 1110 1470; |CUADRO 1110 1470;
      |PINTA 1211, " Desde Fecha Vto.             hasta Fecha Vto.            ";

      fDFecVto = #dscaz113#3;   fHFecVto = #dscaz113#7;
      #dscaz113#3 = "01.01.2000"; #dscaz113#7 = "31.12.2099";
      fFechaVto1  = "01.01.2000"; fFechaVto2  = "31.12.2099";
      |PINTA 1229, #dscaz113#3; |PINTA 1258, #dscaz113#7;
      #dscaz113#3 = fDFecVto;   #dscaz113#7 = fHFecVto;

      fFechaVto1 = 1229 ? 1;
      |SI FSalida = 0;
         fFechaVto2 = 1258 ? 1;
         |SALVA_FICHA #dscaw087;
         |IMPRE 0;
         |SI FSalida = 0;
            aInforme = "Listado Pagos Domiciliados"; |HAZ ObtenInforme;
            |SI aInforme = "Listado Pagos Domiciliados";
               |ABRE #dscam065; |DDEFECTO #dscam065;
               #dscam065#0 = aInforme;
               #dscam065#1 = "dscaz113";
               |GRABA 020#dscam065.n;
               |CIERRA #dscam065;
               aInforme = "dscaz113";
            |FINSI;
            |INFOR aInforme;
            |SI FSalida = 0;
               |BUCLE Imprime;
               |PIEINF; |FININF;
            |FINSI;
            |FINIMP;
         |FINSI;
         |REPON_FICHA #dscaw087;
      |FINSI;
      |POPV; |ERROR;
   |FINSI;
|FPRC;

|PROCESO MiraBanco;
   nMarca = #dscaw087#10;
|FPRC;

|PROCESO AntesMod;
   aCuenta = #dscaw087#4;
   nSwErr = 0;
   |BUCLE EntregasPdtes;
   |SI nSwErr = 1;
      aAlfa = "    NEste proveedor tiene entregas a cuenta pendientes de saldar. " + &191 + " Continuar ?";
      |CONFI aAlfa;
      |SI FSalida ! 0;
          |ERROR; |ACABA;
      |FINSI;
   |FINSI;
|FPRC;

|PROGRAMA;
   |ABRE #dscaz113;
   |LEE 000#dscaz113.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscaz113;
      |GRABA 020#dscaz113.c;
   |FINSI;

   |CLS;
   |CABEZA "Creacion automatica de relaciones de pagos domiciliados";
   |PINPA #0#dscaz113; |PINDA #0#dscaz113;
   |ENDATOS #1#dscaz113;
   |SI FSalida = 0;
      |GRABA 020#dscaz113.a;
      nMarca = -1; nAntBanco = -1;

      aAlfa = "87" + Usuario; |NOME_DAT #dscaw087#aAlfa#;
      aAlfa = Usuario; |QBF aAlfa; aAlfa = aAlfa % 0103;
      aAlfa = "88000" + aAlfa; |NOME_DAT #dscaw088#aAlfa#;
      |DELINDEX #dscaw087; |ABRE #dscaw087;

      |PUSHV 1421 2359;
      |ENTLINEAL #1#dscaw088, -1, 1, 21, 1, infw088, supw088;
      |POPV;

      |ABRE #dscaw088;
      nHayFP = 0;
      |LEE 000#dscaw088.p;
      |SI FSalida = 0;
         nHayFP = 1;
      |FINSI;
      |BUCLE Recibos;
      |CIERRA #dscaw087; |CIERRA #dscaw088;

      |PINPA #0#dscaw087;
      |ENTLINEAL #2#dscaw087, -4, 2, 21, 0, infw087, supw087;

      |CONFI "    NConforme con volcar los datos editados ? ";
      |SI FSalida = 0;
         |ABRE #dscam008; |ABRE #dscam095; |ABRE #dscam096;
         |BUCLE Volcado;
         |CIERRA #dscam008; |CIERRA #dscam095; |CIERRA #dscam096;
      |FINSI;
   |FINSI;

   eaSesion   = Usuario; |HAZ LimpiaTempo;

   |CIERRA #dscaz113;
|FPRO;
