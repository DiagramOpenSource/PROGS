|FICHEROS;
   dscaz014 #0;
   dscam012 #1;     || remesas cabs.
   dscam013 #2;     || remesas lins.
   dscam003 #3;     || Recibos de venta
   dscam002 #4;     || Sucursales bancarias
   dscam004 #5;
   dscam066 #6;
   dscaw038 #7,MANTE;

   dscam051 #10;
   dscam030 #11;
   dscaw013 #12;
   dscam093 #13,MANTE;
   &agif024@ #14;
   &taglm01@ #15;
   dscam023 #16,MANTE;
|FIN;

|VARIABLES;
    &enEmpCartera = 0; &enEmpGestion = 0; &enBanco = 0;
    &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = "";
    &HayGestion = 0; &HayConta = 0;
    &aInforme = "";
    &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
    &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = "";
    &nDeci_Base = 0; &nDeci_Div = 0;
    &Fichero   = "";  &Cmp = "";   &Tipo = ""; &CmpNum = 0;

    &eaCodigo    = "";
    &eaTipoCod   = "";
    &aCuenta     = "";
    &eaNif       = "";
    &eaNombre    = "";
    &eaDireccion = "";
    &eaPoblacion = "";
    &eaProvincia = "";
    &eaCP        = "";
    &eaCP1       = "";
    &eaCP2       = "";
    &eaTelefono  = "";

    &Divisa = "";
    &DirCli = "";
    &PobCli = "";
    &CPCli  = "";
    &ProCli = "";

    &enFPago      = 0;
    &nCamFPago    = 0;
    &fFechaFac    = @;
    &fFecVto      = @;
    &eaCliente    = "";

    &entrada = 1;
    alfa1    = "";
    alfa2    = "";
    aAlfa    = "";
    aAlfa1   = "";
    sw       = 0;
    aImpre   = "";

    nSwTagl  = 0;
    fFechaHoy = @;

    EmpreAnt = 0; PerioAnt = 0;
    Entidad = ""; Numero = "";
    Calc = 0;
    Empresa = 0;
    LinCob = 0;
    Comodin = "";
    Mensaje = 0;
    SwHay = 0;
    SwHayNoEmit = 0;
    nSwBloq  = 0;

    nSwLuxe = 0;
    nSwArtenvas = 0;
|FIN;

|PROCESO mayus;
  #0Campo = #0Campo > " ";
  |PINTA #0Campo;
|FPRC;

|PROCESO lee_cobro;
    |DDEFECTO #dscam003;
    #dscam003#40 = #2#16;
    |LEE 021#dscam003.=;

    Divisa = #dscam003#57; |HAZ TomaDecim;   || esto faltaba
|FPRC;

|PROCESO lee_banco;
    |DDEFECTO #dscam002;
    #dscam002#0 = #dscam003#8;
    #dscam002#1 = #dscam003#9;
    |LEE 010#dscam002.=;
|FPRC;

|PROCESO lee_cliente;
    Fichero = "Clientes"; Tipo = "G"; Cmp = "Codigo Cliente"; |HAZ ObtenDato;
    #agif024@#CmpNum# = #dscam003#32;
    |LEE 000#agif024@.=;
    |SI FSalida = 0; |Y #agif024@#CmpNum# ! "      ";
       Fichero = "Clientes"; Tipo = "G"; Cmp = "Direccion Envio"; |HAZ ObtenDato;
       DirCli = #agif024@#CmpNum#;
       Fichero = "Clientes"; Tipo = "G"; Cmp = "Poblacion Envio"; |HAZ ObtenDato;
       PobCli = #agif024@#CmpNum#;
       Fichero = "Clientes"; Tipo = "G"; Cmp = "Codigo Postal 1"; |HAZ ObtenDato;
       aAlfa = #agif024@#CmpNum#;
       Fichero = "Clientes"; Tipo = "G"; Cmp = "Codigo Postal 2"; |HAZ ObtenDato;
       aAlfa1 = #agif024@#CmpNum#;
       |QBF aAlfa; |QBF aAlfa1;
       CPCli  = (("00" + aAlfa)%-102) + (("000" + aAlfa1)%-103);
       Fichero = "Clientes"; Tipo = "G"; Cmp = "Provincia Envio"; |HAZ ObtenDato;
       ProCli = #agif024@#CmpNum#;
    |FINSI;
|FPRC;
/*
|PROCESO MiraSiBloq1;
   |DDEF aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "taglm001.mas";
   |CARGA_DEF aAlfa, taglm01@;
   |SI FSalida = 0;
      |ABRE #taglm01@;
      aAlfa = #dscam003#80; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
      #taglm01@#0 = aAlfa;
      |LEE 000#taglm01@.=;
      |SI FSalida ! 0;
         |CIERRA #taglm01@; |DESCARGA_DEF #taglm01@;
         |ACABA;
      |FINSI;

      enFPago = #dscam003#80; eaCliente = #dscam003#32;
      nCamFPago = #dscam003#2 + 5;
      fFechaFac = #dscam003#4;
      |HAZ Vencimientos;
      |CIERRA #taglm01@; |DESCARGA_DEF #taglm01@;

      |SI #dscam003#14 = "P"; |O #dscam003#14 = "C";
         |SI fFecVto [ fFechaHoy; nSwBloq = 1; |ERROR10; |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE MiraSiBloq1;
#dscam003#15;
;
eaCliente, "            ", " ";
eaCliente, "zzzzzzzzzzzz", "z";
;
NULL,MiraSiBloq1;
|FIN;
*/
|PROCESO lineaspri;
    sw = 1;
|HAZ lee_cobro;
|HAZ lee_banco;
||HAZ lee_cliente;
   eaCodigo = #dscam003#32; eaTipoCod = "C"; aCuenta = #dscam003#5; |HAZ LeeDatos;
   DirCli = eaDireccion;
   PobCli = eaPoblacion;
   ProCli = eaProvincia;
   CPCli  = eaCP;

   |SI #dscam012#22 = 3; |O #dscam012#22 = 4; |O #dscam012#22 = 7;
      #dscam003#40 = #dscam013#16; |LEE 000#dscam003.=;
      |SI Entidad ! #dscam013#37; |O Numero ! #dscam013#38;
         Entidad = #dscam013#37; Numero = #dscam013#38;
         |PRINT;
      |FINSI;
   |SINO;
      |PRINT;
   |FINSI;


   |SI #dscaz014#2 = "S"; |ACABA; |FINSI;

   || Actualizo  el historico de cobros
   #dscam004#17 = #dscam013#16;
   #dscam004#3  = 99;
   |LEE 000#dscam004.];
   |SI FSalida ! 0;
      |LEE 010#dscam004.u;
      |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
         LinCob = #dscam004#3 + 1;
      |SINO;
         LinCob = 1;
      |FINSI;
   |SINO;
      |SI #dscam004#17 = #dscam013#16;
         LinCob = #dscam004#3 + 1;
      |SINO;
         |LEE 010#dscam004.a;
         |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
            LinCob = #dscam004#3 + 1;
         |SINO;
            LinCob = 1;
         |FINSI;
      |FINSI;
   |FINSI;

   |DDEFECTO #dscam004;
   #dscam004#17 = #dscam013#16;
   #dscam004#15 = #dscam013#2;
   #dscam004#0  = #dscam013#4;
   #dscam004#1  = #dscam013#3;
   #dscam004#2  = #dscam013#5;
   #dscam004#3  = LinCob;
   #dscam004#4  = #dscam012#14;
   #dscam004#5  = "EMR";
   #dscam004#6  = #dscam012#1;
   #dscam003#40 = #dscam013#16;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      #dscam004#7  = #dscam003#23; #dscam004#25  = #dscam003#61;
   |FINSI;
   #dscam004#8  = 0;
   #dscam004#9  = 0;
   #dscam004#10 = 0;
   #dscam004#26 = 0;
   #dscam004#33 = #dscam003#59;
   |GRABA 020#dscam004.n;

   #dscam013#24 = LinCob; |GRABA 020#dscam013.a;
/*
   || Actualizo el riesgo de cliente
   |SI #dscam051#3 = "S";
      enBanco = #dscam012#2;
      || enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
      enEmpCartera = -1;     enEmpGestion = #dscam003#46;
      eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
      nImporte = #dscam013#7;
      |SI #dscam003#16 > 0;
         eaTipoOper = "+6-7";
      |SINO;
         eaTipoOper = "+6-4";
      |FINSI;
      |HAZ BucleRiesgo;
   |FINSI;
   || Actualizo el recibo
   #dscam003#40 = #dscam013#16;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      #dscam066#0 = #dscam003#40;
      |LEE 000#dscam066.=;
      |SI FSalida = 0; |BORRA 020#dscam066.a; |FINSI;
      |SI nSwArtenvas;
         |SI #dscam012#22 ! 1; |Y #dscam012#22 ! 3;
            #dscam003#26 = #dscam012#1;
         |FINSI;
      |SINO;
         #dscam003#26 = #dscam012#1;
      |FINSI;
      #dscam003#23 = #dscam003#23 + #dscam013#7; #dscam003#61 = #dscam003#61 + #dscam013#7;
      #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
      #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
      #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
      Comodin = #dscam003#31; |QBF Comodin; Calc = Comodin;
      #dscam003#31 = #dscam003#30 - #dscam003#23;
      #dscam003#65 = #dscam003#64 - #dscam003#61;
      |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
         |SI #dscam003#31 = 0;
            #dscam003#14 = "e"; #dscam003#15 = "Pendiente de compensar";
         |FINSI;
      |SINO;
         |SI #dscam003#31 = 0;
            #dscam003#14 = "L"; #dscam003#15 = "Recibo liquidado";
         |SINO;
            #dscam003#14 = "C"; #dscam003#15 = "Parcialmente cobrado";
         |FINSI;
      |FINSI;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;

   |SI nSwTagl = 1;
      |ABRE #dscam023;
      #dscam023#0 = #dscam003#32;
      |LEE 000#dscam023.=;
      |SI FSalida = 0; |Y #dscam023#9 = "S";
         nSwBloq = 0; fFechaHoy = ~;
         eaCliente = #dscam003#32; |BUCLE MiraSiBloq1;
         |SI nSwBloq = 0;
            #dscam023#0 = eaCliente;
            |LEE 101#dscam023.=;
            |SI FSalida = 0;
               #dscam023#9 = "A";
               #dscam023#10 = "AUTOMATICO";
               |GRABA 020#dscam023.a; |LIBERA #dscam023;
            |FINSI;
         |FINSI;
      |FINSI;
      |CIERRA #dscam023;
   |FINSI;
*/
   eaCliente = #dscam003#32; |HAZ MiraBloqueoRiesgo;
|FPRC;

|DEFBUCLE lineas;
 #2#1;
 ;
 #1#0,   1;
 #1#0, 999;
 e;
 NULL, NULL, NULL, NULL, NULL, lineaspri;
 #2#0, #2#6, #2#37, #2#38, #2#1;
|FIN;

|PROCESO cabecera;

   |SI aImpre = "";
      |IMPRE 0;
      aImpre = Impresora;
   |SINO;
      Impresora = aImpre; |IMPRE -1;
   |FINSI;

   |ABRE #dscam012;

   #dscam012#0 = #dscaw038#0;
   |LEE 101#dscam012.=;

    nDeci_Base = 0;
    |SI #dscam012#22 = 3; |O #dscam012#22 = 4; |O #dscam012#22 = 7;
       aInforme = "Carta emision remesas Pag/Tal";
    |SINO;
       aInforme = "Carta emision de remesas";
    |FINSI;
    |HAZ ObtenInforme; |INFOR aInforme;
    |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

    sw = 0;
||BUCLELIN 0lineaspri#1;
|BUCLE lineas;
|SI sw = 1; |PIEINF; |FINSI;
|SI #0#2 = "N";
    #dscam012#23 = "S";
    |GRABA 020#dscam012.a;
|FINSI;
|LIBERA #dscam012;
|FININF; |FINIMP;

|SI HayConta = 1; |Y #0#2 = "N";
   |ABRE #dscam030;
   #dscam030#0 = #dscaw038#2;
   |LEE 010#dscam030.=;
   |SI FSalida = 0;
      |SI #dscam030#4 ! #dscaw038#3; |O #dscam030#5 ! #dscaw038#4;
         EmpreAnt = #dscam030#4; PerioAnt = #dscam030#5;
         #dscam030#4 = #dscaw038#3; #dscam030#5 = #dscaw038#4;
         |GRABA 020#dscam030.a;
      |SINO;
         EmpreAnt = -1;
      |FINSI;
      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #12 Comodin;
      |DELINDEX #dscaw013; |ABRE #dscaw013;

      |SI #dscam051#1 = "S";
         Comodin = #dscaz014#4;
         |SI Comodin = "    ";
            |ABRE #dscam093;
            #dscam093#0 = "E";
            |LEE 000#dscam093.=;
            |SI FSalida = 0;
               |SI #dscam012#22 = 1; Comodin = #dscam093#1;  |FINSI;
               |SI #dscam012#22 = 2; Comodin = #dscam093#3;  |FINSI;
               |SI #dscam012#22 = 3; Comodin = #dscam093#5;  |FINSI;
               |SI #dscam012#22 = 4; Comodin = #dscam093#7;  |FINSI;
               |SI #dscam012#22 = 5; Comodin = #dscam093#9;  |FINSI;
               |SI #dscam012#22 = 6; Comodin = #dscam093#11; |FINSI;
               |SI #dscam012#22 = 7; Comodin = #dscam093#13; |FINSI;
            |FINSI;
            |CIERRA #dscam093;
         |FINSI;
      |SINO;
         Comodin = "    ";
      |FINSI;

      |SI Comodin ! "    ";
         |DDEFECTO #dscaw013;
         #dscaw013#0  = 1;            #dscaw013#15 = Comodin;
         #dscaw013#5  = #dscam013#0;  #dscaw013#6  = #dscam013#0;
         #dscaw013#11 = "N";          #dscaw013#12 = 5;
         #dscaw013#13 = "dscam013";   #dscaw013#14 = 0;
         |GRABA 020#dscaw013.n;
         |CIERRA #dscaw013;

         Comodin = "dscam033.tab;" + Comodin + ",I";
         |LIBERA #dscam012; |CIERRAT #dscam012;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam012; |LEE 101#dscam012.=;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

         |SI EmpreAnt ! -1;
            #dscam030#4 = EmpreAnt; #dscam030#5 = PerioAnt;
            |GRABA 020#dscam030.a;
         |FINSI;
      |FINSI;
   |FINSI;
   |CIERRA #dscam030;
|FINSI;

eaUsuario = Usuario % 0810;
eaDescr   = "EMISION REMESA (" + (("00000" + #dscam012#0) % -105) + ") DESDE EMISION NORMAL";
eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
eaTipoOp  = "A";   enImpAct = #dscam012#10; enImpAnt = #dscam012#10;
|HAZ GrabaAudit;

|FPRC;

|DEFBUCLE dscam012;
 #dscaw038#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, cabecera;
|FIN;

|PROCESO TempRemesas;
   |SI nSwLuxe = 1;
      |SI #dscam012#22 < #dscaz014#6; |O #dscam012#22 > #dscaz014#7; |ACABA; |FINSI;
      |SI #dscaz014#6 = 6; |Y #dscaz014#7 = 6;
         |SI #dscam012#2 < #dscaz014#8; |O #dscam012#2 > #dscaz014#9; |ACABA; |FINSI;
      |FINSI;
   |FINSI;

   |SI #dscaz014#2 = "S";
      |SI #dscam012#23 = "N"; |ACABA; |FINSI;
   |SINO;
      |SI #dscam012#23 ! "N"; |ACABA; |FINSI;
   |FINSI;

   |DDEFECTO #dscaw038;
   #dscaw038#0 = #dscam012#0;
   #dscaw038#1 = #dscam012#10;
   #dscaw038#2 = #dscaz014#4;
   #dscaw038#5 = #dscam012#23;
   |SI #dscaw038#5 = "N";
      SwHayNoEmit = 1;
   |FINSI;

   |ABRE #dscam030;
   #dscam030#0 = #dscaz014#4;
   |LEE 000#dscam030.=;
   |SI FSalida = 0;
      #dscaw038#3 = #dscam030#4;
      #dscaw038#4 = #dscam030#5;
   |FINSI;
   |CIERRA #dscam030;
   |GRABA 020#dscaw038.n;
|FPRC;

|DEFBUCLE TempRemesas;
 #1#1;
 ;
 #0#0;
 #0#1;
 be;
 NULL, TempRemesas;
|FIN;

|RUTINA infw038;
   #dscaw038#0 = 00001;
   #dscaw038#5 = "N";
|FRUT;

|RUTINA supw038;
   #dscaw038#0 = 99999;
   #dscaw038#5 = "N";
|FRUT;

|PROGRAMA;
   |CLS;

   |HAZ Tipo8;
   |ABRE #dscam051;
   |LEE 010#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
   |FINSI;

   |DDEFECTO #dscaz014;
   |SI #dscam051#1 = "S";
      #dscaz014#4 = #dscam051#53;
      aAlfa = #dscam051#61; |QBF aAlfa;
      |C_M #dscaz014#4,1,aAlfa;
   |SINO;
      #dscaz014#4 = "    ";
      |C_M #dscaz014#4,1,"N";
   |FINSI;

   Comodin = "te" + Usuario; |QBF Comodin;
   |NOME_DAT #7 Comodin; |DELINDEX #dscaw038;

   |CABEZA "Emision de remesas";
   |PINPA #0#0;

   |HAZ EsArtenvas;
   |SI FSalida = 0;
      nSwArtenvas = 1;
   |SINO;
      nSwArtenvas = 0;
   |FINSI;

   |HAZ EsLuxe;
   |SI FSalida = 0;
      nSwLuxe = 1;
      |CUADRO 1625 1955;
      |PINTA 1727, "Tipo remesa";
      |PINTA 1827, "Banco";

      |C_M #dscaz014#6, 1, "S"; |C_V #dscaz014#6, 1, "S";
      |C_M #dscaz014#7, 1, "S"; |C_V #dscaz014#7, 1, "S";
      |C_M #dscaz014#8, 1, "S"; |C_V #dscaz014#8, 1, "S";
      |C_M #dscaz014#9, 1, "S"; |C_V #dscaz014#9, 1, "S";

      |C_P #dscaz014#6, 1, 1740; |PINTA #dscaz014#6;
      |C_P #dscaz014#7, 1, 1749; |PINTA #dscaz014#7;
      |C_P #dscaz014#8, 1, 1840; |PINTA #dscaz014#8;
      |C_P #dscaz014#9, 1, 1849; |PINTA #dscaz014#9;
   |SINO;
      nSwLuxe = 0;
      |C_M #dscaz014#6, 1, "N"; |C_M #dscaz014#7, 1, "N";
      |C_M #dscaz014#8, 1, "N"; |C_M #dscaz014#9, 1, "N";
   |FINSI;

   |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      SwHayNoEmit = 0;
      |ABRE #dscaw038; |BUCLE TempRemesas; |CIERRA #dscaw038;
      |SI #dscaz014#5 = "N";
         |SI SwHayNoEmit = 1;
            |ENTLINEAL #1#dscaw038,1,2,19,1,infw038,supw038;
         |SINO;
            |MENAV "    No hay remesas sin emitir para redireccionar";
         |FINSI;
      |FINSI;

      Empresa = #48#0;

      |ABRE #dscam003;
      |ABRE #dscam002;
      |ABRE #dscam004;
      |ABRE #dscam066;

      |BUCLE dscam012;

      |CIERRA #dscam066;
      |CIERRA #dscam004;
      |CIERRA #dscam002;
      |CIERRA #dscam003;
   |FINSI;

   |CIERRA #dscam051;
   |HAZ Tipo9;
|FPRO;

|PROCESO Reimpre;
   |SI #dscaz014#2 = "S";
      |C_M #dscaz014#4,1,"N"; |C_M #dscaz014#5,1,"N";
   |SINO;
      |SI #dscam051#1 = "S";
         aAlfa = #dscam051#61; |QBF aAlfa;
         |C_M #dscaz014#4,1,aAlfa;
      |SINO;
         |C_M #dscaz014#4,1,"N";
      |FINSI;
      |C_M #dscaz014#5,1,"S";
   |FINSI;
|FPRC;

|PROCESO MiraEnlace;
   |SI #dscam051#53 = "    "; |Y #dscaz014#4 ! "    ";
      |ABRE #dscam093;
      #dscam093#0 = "E";
      |LEE 000#dscam093.=;
      |SI FSalida = 0;
         |SI #dscam093#1 ! "    "; |O #dscam093#3 ! "    "; |O #dscam093#5 ! "    ";
          |O #dscam093#7 ! "    "; |O #dscam093#9 ! "    "; |O #dscam093#11 ! "    ";
          |O #dscam093#13 ! "    ";
             aAlfa = "    NLos enlaces de emision estan parametrizados por tipo de remesa." + &191 + " Continuar ?";
             |CONFI aAlfa;
             |SI FSalida ! 0; |ERROR; |FINSI;
         |FINSI;
      |FINSI;
      |CIERRA #dscam093;
   |FINSI;
|FPRC;

|PROCESO MiraAcotTR;
   |SI nSwLuxe = 1;
      |SI #dscaz014#6 = 6; |Y #dscaz014#7 = 6;
         #dscaz014#8 = 0;   |PINTA #dscaz014#8;
         #dscaz014#9 = 0;   |PINTA #dscaz014#9;
         |C_M #dscaz014#8, 1, "S"; |C_M #dscaz014#9, 1, "S";
      |SINO;
         #dscaz014#8 = 1;   |PINTA #dscaz014#8;
         #dscaz014#9 = 999; |PINTA #dscaz014#9;
         |C_M #dscaz014#8, 1, "N"; |C_M #dscaz014#9, 1, "N";
      |FINSI;
   |FINSI;
|FPRC;
