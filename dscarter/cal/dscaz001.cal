|FICHEROS;
   dscaz001 #0;
   dscaz002 #2,MANTE;
   dscam003 #3;
   dscam004 #4;
   dscaw007 #7,MANTE;
   dscam051 #8;
   dscaw017 #11,MANTE;
   dscam051 #12;
   dscaw013 #13;
   dscam066 #14;
   dscaw025 #15;
   dscam030 #16;
   dscaw043 #17;
   dscam048 #18;
   dscaw079 #19;

   dscam016 #20;
   dscam017 #21;
   dscam014 #22;
   dscaw173 #23,MANTE;

   dscam043 #29;
   dscam044 #30;
   dscam045 #31;
   dscam023 #32,MANTE;
   dscam094 #33;
   dscaw118 #34;
   dscam052 #35;
   dscaw171 #36,MANTE;

   dscaz006 #50,MANTE;
   dscaz019 #51,MANTE;
   dscaw117 #52,MANTE;
   dscam165 #53;
   dscaw175 #54;

   &agif325@ #37;
   &agif324@ #9;
   &agif321@ #10;
   &agif024@ #36;

   dscagm01@ #1000;
   &taglm01@ #1002;
   agifa091@ #1003;

   Referen@  #5000;
   cajainca@ #5001;
   cajainli@ #5002;
   caconasi@ #5003;
   canempre@ #5004;
   dscam170  #5005;
   cajasald@ #5006;
   Referen2@ #5007;

   dscam067  #7000;
|FIN;

|VARIABLES;
    nSwExceso    = 0;
    &enImpExceso = 0;

   &eaFichClas = ""; &eaTipoClas = ""; &enSwClas = 0; &eaClasif = "";
   &eaResult   = ""; &enTipoRec   = 0; &eaFiltroPag = "";
   &enBanco    = 0;
   &eaVarLog   = "";

   &efFechaDoc = @;
   &efFechaUlt = @;
   &eaSesion   = "";
   &efFechaOri  = @;
   &efFechaApl  = @;
   &efFechaAgr   = @;
   &enSwAplazAgr = 0;
   &enTimbre     = 0;
   &eaEntidad    = "";
   &efFVtoPag    = @;
   &enImpPag     = 0;
   &efFechaDiv   = @;
   &enDocumto    = 0;

   &eaAlfa = "";

{-1}menu  = "";
    menu1 = "2400";
    menu2 = "5";
    menu3 = "";
    menu4 = "VFCTAMOR";
    menu5 = "Aut.Vto.";
    menu6 = "Aut.Fecha";
    menu7 = "Aut.Cliente";
    menu8 = "Aut.Factura";
    menu9 = "Acotado";
    menu10 = "Manual";
    menu11 = "Cobrador";
    menu12 = "Repr.";

    aAlfa1   = "";
    aAlfa2   = "";

    aAlfaEnl1 = "";
    aAlfaEnl2 = "";

    aSerie   = "";
    nFactura = 0;
    nRecibo  = 0;
    aCtaCob  = "";
    fFecCob  = @;
    nEmpGest = 0;
    nSwBloq  = 0;
    nContLin = 0;
    nSwSal   = 0;
    nClave   = 0;
    nHandle  = 0;
    nConfirmes = 0;

    nGtosArrastradosD = 0;
    nGtosArrastradosB = 0;
    nTotalRep  = 0;
    nTotPagTal = 0;
    nTotEfect  = 0;
    nTotIngBco = 0;
    aAntRep    = "";
    fAntFec    = @;
    aEstadoAnt = "";

    nDocMarcado = 0;

    aCtaCble   = "";
    aCuentaCob = "";

    nSwitch    = 0;
    nTotal     = 0;
    nSwViuda   = 0;
    nSwArtenvas = 0;

    nDiasVto   = 0;
    nImpPdte   = 0;
    nTotDifCm  = 0;

    NuevoDoc = 0;
    aSerDiv  = "";
    nSwCambia = 0;
    nTecla    = 0;
    nSwLuxe   = 0;
    nBucleAcotado = 0;

    aCobrad = "";
    aNomCob = "";
    aCuenta1 = "";
    nAsign  = 0;
    nTotalPdt = 0; nTotalLiq = 0;
    nTotalEfe = 0; nTotalPag = 0;
    nAsignacion = 0;
    nTotalAsig = 0;
    nCalc   = 0;
    nCalc1  = 0;
    nCalc2  = 0;
    nCalc3  = 0;
    nCalcF1 = 0;
    nCalcF2 = 0;
    nSwRepre = 0;
    nAnyo  = 0;

    Flag       = 0;
    SwNeg      = 0;
    nDecimales = 0;
    aDecimales = "";
    Cadena     = "";

    nSwLineas = 0;
    Mensaje = 0;
    Opcion = 0;
    Linea  = 0;
    nLinea = 0;
    nLinPos= 0;
    LinCob = 0;
    Cont   = 0;
    Tecla  = 0;
    nSwImp = 0;
    nSwError = 0;
    nSwTagl  = 0;
    nTotLiquD = 0;
    nTotLiquB = 0;
    nTotPdteD = 0;
    nTotPdteB = 0;

    nNumSeq = 0;
    nImpD   = 0;
    nImpB   = 0;
    nDtoD   = 0;
    nDtoB   = 0;

    aDivisa   = "";
    aNomDiv   = "";
    nCambioDiv= 0;

    nSwCobConf = 0;

    nBotonCancel = 0;
    nBotonOk     = 0;

    aAlfa   = "";
    aCtaAnt = "";
    nNumSec = 0;
    &CambioBaseVn = 0; &CambioBaseCm = 0; DifCambio = 0;
    &CambioDivVn  = 0; &CambioDivCm  = 0;
    &DCampoG = 0;  &HCampoG = 0;  &DCampoC = 0;  &HCampoC = 0;
    &PosLibro = 0; &PosSerie = 0; &PosFactu = 0; &PosRecib = 0;
    &enFactura = 0; &enDocum = 0; &enTipoEntrada = 0;
    &Fichero   = "";  &Cmp = "";   &Tipo = ""; &CmpNum = 0;
    &eaTipoRecibo = ""; &enNumDocum = 0; &eaMensRet = ""; &enSwError = 0; &eaTOperacion = "";

    SwClave = 0; UltCont = 0; SwPagTal = 0;
    aNumPag = ""; aEntPag = "";
    nSwCobrArtenvas = 0;

    Total    = 0;
    TotalDiv = 0;
    aDomic   = "";
    aEntidad = "";
    aOficina = "";
    aDC      = "";
    aCta     = "";

    fFechaHoy  = @;
    fFechaVto  = @;
    fFechaVto1 = @;
    nSumaLuxe  = 0;
    nTotalLuxe = 0;
    &enFPago      = 0;
    &nCamFPago    = 0;
    &fFechaFac    = @;
    &fFecVto      = @;
    &eaCliente    = "";
    &enExistOblig = 0;
    &eaSerieDiv  = "";
    &eaFactuDiv  = "";

    LinBucle = 0; Calc = 0; Comodin1 = "";
    CtaCliente = "";
    EntidadAnt = ""; DocumAnt = "";
    Entidad    = ""; NumDocum = "";

    aParte1 = ""; nParte1 = 0;
    aParte2 = ""; nParte2 = 0;

    &TipoCliente = ""; &CodCliente = "";
    &nDeci_males = 0; &nDeci_Div = 0; &nDeci_Base = 0;
    &Divisa = "";
    &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
    &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = "";

    nContz01 = 0;
    nTotalRec = 0;
    TotAgrup = 0;
    nFacDiv  = 0;
    nCont    = 0;
    nLong    = 0;
    nApunte   = 0;
    aLong    = "";

    TotalSelec = 0;
    TotalSelPg = 0;
    NumDoc = 0;
    NumDocumAnt = 0;
    NumLin = 0;
    Libro  = 0;
    Serie  = "";
    Factura = 0;
    Recibo  = 0;
    Empresa = 0;
    fFecha = @;
    &HayGestion = 0;
    &HayConta   = 0;

    DCliente = "";
    HCliente = "";
    aCodCliAgr = "";
    aCtaCliAgr = "";
    fVtoMasAlto = @;
    aCodCli    = "";
    nTR        = 0;

    Parte1 = 0; Parte2 = 0; Parte = 0;
    Part1 = ""; Part2 = "";

    LongAlfa = ""; Long = 0;
    Comodin = "";
    LineaClave = 0;
    nLinAgrup  = 0;
    nSwOpcion  = 0;
    nDocSel    = 0;

    ModoEntrada = 0;
    nSw      = 0;
    SwError  = 0;
    SwError1 = 0;
    SwError2 = 0;
    Manual = 0;
    FEstado = 0;
    HaySelec = 0;
    HaySelecPag = 0;
    HaySelCobCf = 0;

    &MaxDigit = 0;
    &UltNivel = 0;

    &enEmpCartera = 0; &enEmpGestion = 0;
    &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = "";

    fFechaEmi = @;
    DocAgrupador = 0;
    &DocDividido = 0;
    aSwAgrDiv    = "";
    &TAgrup      = 0;
    &DDividido    = 0;
    &TotDividido  = 0;
    &FecEmision   = "";
    &FecAgrup     = "";
    &FecDividido  = "";
    &FecVtoAgr    = "";
    &FecVtoDiv    = "";
    &DAgrupador   = "";
    &aInforme     = "";
    &eaCodigo     = "";
    &eaTipoCod    = "";
    &aCuenta      = "";
    &eaSwCmpVta   = "";

    Dia      = "";
    Mes      = "";
    anyo     = "";

    fFechaA  = @;
    fFechaB  = @;
    nCalcA   = 0;
    nCalcB   = 0;

    nSwAplaza  = 0;
    &enDocumento = 0;
    &efFecVto    = @;
    &enImporte   = 0;

{-1}get  = 0;
    get1 = 0;
    get2 = 0;
    nHay = 0;
|FIN;

|PROCESO CheqCtaCobro;
     aAlfa = #0#31; |QBF aAlfa;    ||Pagare/Talon
     |SI aAlfa = "";
          aAlfa = #0#13; |QBF aAlfa;
     |SINO;
          ||aAlfa = #0#35; |QBF aAlfa;
          |ACABA;
     |FINSI;

     |SI aAlfa = ""; |Y HayConta ! 0;
          nHay = 1;
          aAlfa = ("000000000" + #0#21) % -109;
          aAlfa = "0000Documento " + aAlfa + " sin cuenta de cobro";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE CheqCtaCobro;
     #dscaz001#1;
     10;
     00001, "*";
     99999, "*";
     ;
     NULL, CheqCtaCobro;
|FIN;

|PROCESO Tipo02Lin; |TIPO 2;
   |SI #dscaz001#10 = "*";
      HaySelec = HaySelec +. 1;
      TotalSelec = TotalSelec +. #dscaz001#8;
      || nTotalPdt = nTotalPdt -. #dscaz001#8;
      nTotalPdt = nTotalPdt -. (#dscaz001#8 - (#dscaz001#15 + #dscaz001#18 + #dscaz001#19));
      nTotalLiq = nTotalLiq +. #dscaz001#8;
      |SI #dscaz001#31 = "          "; |Y #dscaz001#33 = "    ";
         nTotalEfe = nTotalEfe +. #dscaz001#8;
      |SINO;
         nTotalPag = nTotalPag +. #dscaz001#8;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO MiraRecs;
   #dscam003#40 = #dscaz001#21;
   |LEE 000#dscam003.=;
   |SI FSalida ! 0; |DDEFECTO #dscam003; |FINSI;

   #dscam004#17 = #dscam003#40;
   #dscam004#3  = 99;
   |LEE 000#dscam004.];
   |SI FSalida = 0;
      |LEE 000#dscam004.a;
   |SINO;
      |LEE 000#dscam004.u;
   |FINSI;
   |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
      |SI #dscam004#5 ! "CFR"; |DDEFECTO #dscam004; |FINSI;
   |SINO;
      |DDEFECTO #dscam004;
   |FINSI;

   |SI fFechaVto1 ! "01.01.0000";
      |SI fFechaVto1 ! #dscam003#71; SwError2 = -1; |FINSI;
   |FINSI;

   fFechaVto1 = #dscam003#71;

   |SI aCuenta1 = "";
      aCuenta1 = #dscam004#4; |QBF aCuenta1;
   |SINO;
      aAlfa = #dscam004#4; |QBF aAlfa;
      |SI aAlfa ! aCuenta1; SwError2 = -2; |ERROR10; |FINSI;
   |FINSI;
   aCuentaCob = #dscam004#4; |QBF aCuentaCob;
|FPRC;

|DEFBUCLE MiraRecs;
#dscaz001#1;
10;
00001,"*";
99999,"*";
;
NULL, MiraRecs;
|FIN;

|PROCESO RevisaRecs;
   |SALVA_FICHA #dscaz001;
   |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
   fFechaVto1 = "01.01.0000"; aCuenta1 = "";
   |BUCLE MiraRecs;
   |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;
   |REPON_FICHA #dscaz001;
   |SI SwError2 < 0;
      |SI SwError2 = -1;
         aAlfa = "    NLos recibos seleccionados no tienen la misma fecha de vencimiento. " + &191 + " Continuar ? ";
         |CONFI aAlfa;
         |SI FSalida = 0; SwError2 = 0; |FINSI;
      |FINSI;
      |SI SwError2 = -2;
         |MENAV "    Los recibos seleccionados no tienen la misma cuenta de cobro.";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO HazCobro;
   || A¤adido CCC.  27.01.2009. Tiquet 1483/658
   || Para que encuentre correctamente si se repite mas de 1 vez el mismo recibo.
   enNumDocum = #dscaz001#21;

   enSwClas   = 1; eaFichClas = "dscaz001"; eaTipoClas = #dscam003#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR";
      |MENAV "    Documento inoperable en el perfil actual "; |ERROR; |ACABA;
   |FINSI;
   |SI eaFichClas = "INFOR";
      |CIERRA #dscam003;
      eaResult = "V"; enNumDocum = #dscam003#40;
      eaFichClas = "dscaz001"; enTipoRec = #dscam003#12; |HAZ CambiaTR;
      |ABRE #dscam003; |LEE 000#dscam003.=;
      |SI eaResult = "ERROR"; |ERROR; |ACABA; |FINSI;
   |FINSI;

   nSwError = 0; nLinea = #dscaz001#0;
   |SALVA_FICHA #dscaz001;
   |SELECT #2#dscaz001;
   #dscaz001#21 = enNumDocum;
   #dscaz001#0 = 1;
   |LEE 000#dscaz001.];
   |PARA; |SI FSalida = 0; |Y #dscaz001#21 = enNumDocum; |HACIENDO;
      |SI #dscaz001#0 ! nLinea; nSwError = 1; |SAL; |FINSI;
      |LEE 000#dscaz001.s;
   |SIGUE;
   |SELECT #1#dscaz001;
   |REPON_FICHA #dscaz001;
   |SI nSwError = 1;
      |MENAV "    Recibo ya incluido"; |ERROR; |ACABA;
   |FINSI;

   enSwError = 0;
   eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscaz001#21; |HAZ ProcesaTempo;
   |SI enSwError = 1; |ERROR; |ACABA; |FINSI;

   |SI #dscaz001#10 = "P";
      nTotalPag = nTotalPag - #dscaz001#9;
       HaySelecPag  = HaySelecPag - 1;
      #dscaw079#1 = nTotalPag; |PINTA 0967, #dscaw079#1;

      #dscaz001#10 = " "; |PINTA #dscaz001#10;
   |FINSI;

   |SI HayConta = 1; |Y #dscam051#1 = "S";
      |C_M #dscaz002#11,1,"S";
   |SINO;
      |C_M #dscaz002#11,1,"N";
   |FINSI;

   |SI #dscam003#14 = "F";
      |C_M #dscaz002#4,1,"N";
      |C_M #dscaz002#5,1,"N";
      |C_M #dscaz002#9,1,"N";
   |SINO;
      |C_M #dscaz002#4,1,"S";
      |C_M #dscaz002#5,1,"S";
      |C_M #dscaz002#9,1,"S";
   |FINSI;

   |DDEFECTO #dscaz002;
   #dscaz002#0  = #dscaz001#13;
   |SI nConfirmes = 0;
      |SI #dscam051#37 = "S";
         fFecha = ~;
      |SINO;
         fFecha = #dscaz001#11;
      |FINSI;
      #dscaz002#1  = fFecha;
   |SINO;
      |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
      #dscam003#40 = #dscaz001#21;
      |LEE 000#dscam003.=;
      |SI FSalida ! 0; |DDEFECTO #dscam003; |FINSI;
      |SI #dscam051#104 = "S";
         #dscaz002#1 = #dscam003#71;
      |SINO;
         #dscaz002#1 = #dscam003#3;
      |FINSI;

      #dscam004#17 = #dscam003#40;
      #dscam004#3  = 99;
      |LEE 000#dscam004.];
      |SI FSalida = 0;
         |LEE 000#dscam004.a;
      |SINO;
         |LEE 000#dscam004.u;
      |FINSI;
      |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
         |SI #dscam004#5 = "CFR"; #dscaz002#0 = #dscam004#4; |FINSI;
      |FINSI;
      |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;
   |FINSI;
   #dscaz002#2  = #dscaz001#9;
   #dscaz002#3  = #dscaz001#7;
   #dscaz002#4  = #dscaz001#8; || juan, antes  #dscaz001#7
   #dscaz002#5  = #dscaz001#15;
   #dscaz002#6  = #dscaz001#16;
   #dscaz002#7  = #dscaz001#17;
   #dscaz002#9  = #dscaz001#19; ||juan, antes no se asignaba
   |SI #dscam051#1 = "S";
      #dscaz002#11 = #dscaz001#30;
   |SINO;
      #dscaz002#11 = "    ";
   |FINSI;
   #dscaz002#12 = #dscaz001#38;

|ET OtraVez;
   enDocum = #dscaz001#21; eaSerie = #dscaz001#1;
   |PUSHV 0501 2380;
   |PINPA #0#dscaz002; |PINDA #0#dscaz002;
   |ENDATOS #2#dscaz002;
   FEstado = FSalida;
   |POPV;

   |SI FEstado = 0; |Y #dscaz002#8 = "S";
      #dscaz001#13 = #dscaz002#0;
      #dscaz001#14 = #dscaz002#1;
      #dscaz001#8  = #dscaz002#4;
      #dscaz001#7  = #dscaz002#3;
      #dscaz001#15 = #dscaz002#5;
      #dscaz001#16 = #dscaz002#6;
      #dscaz001#17 = #dscaz002#7;
      #dscaz001#19 = #dscaz002#9;
      #dscaz001#25 = #dscaz002#10;
      #dscaz001#10 = "*";
      #dscaz001#30 = #dscaz002#11;
      #dscaz001#38 = #dscaz002#12;

      eaVarLog = "Marcado para el cobro el documento n§ " + #dscaz001#21; |HAZ AnyadeLog;

      |SI HayGestion = 1;
         Fichero = "Divisas"; Tipo = "G"; Cmp = "Codigo Divisa"; |HAZ ObtenDato;
         #agif324@#CmpNum# = #dscaz001#26;
         |LEE 000#agif324@.=;
         |SI FSalida = 0;
            Fichero = "Divisas"; Tipo = "G"; Cmp = "Valor Venta"; |HAZ ObtenDato;
            #dscaz001#28 = #agif324@#CmpNum#;
         |SINO;
            #dscaz001#28 = #dscaz001#29;
         |FINSI;
         #agif325@#1 = #dscaz001#26;
         #agif325@#4 = #dscaz001#14;
         #agif325@#0 = 1;
         |LEE 000#agif325@.];
         |SI FSalida = 0;
            |SI #agif325@#1 = #dscaz001#26; |Y #agif325@#4 = #dscaz001#14;
               #dscaz001#28 = #agif325@#2;
            |SINO;
               |LEE 000#agif325@.a;
               |SI FSalida = 0;
                  |SI #agif325@#1 = #dscaz001#26; |Y #agif325@#4 [ #dscaz001#14;
                     #dscaz001#28 = #agif325@#2;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            |LEE 000#agif325@.u;
            |SI FSalida = 0;
               |SI #agif325@#1 = #dscaz001#26; |Y #agif325@#4 [ #dscaz001#14;
                  #dscaz001#28 = #agif325@#2;
               |FINSI;
            |FINSI;
         |FINSI;
      |SINO;
         |SI #dscaz001#26 = "EUR"; #dscaz001#28 = 1; |FINSI;
      |FINSI;

      |GRABA 020#dscaz001.a;
   |SINO;
      |SI nSwLuxe = 1;
         |MENAV "    Proceso cancelado";
      |FINSI;

      eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaz001#21; |HAZ ProcesaTempo;
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO ImprimeCobros;
|ACABA;
   |PINTA 2257, #dscam004#4;
   |PINTA 1557, #dscam004#16;
   |PINTA 1667, #dscam004#7;
   |PINTA 1767, #dscam004#8;
   |PINTA 1867, #dscam004#9;
   |PINTA 1967, #dscam004#10;
   |PINTA 2274, #dscam004#11;
   |PINTA Calc, #dscam004#3;
   Calc = Calc + 4;
   |PINTA Calc, #dscam004#5;
   Calc = Calc + 6;
   |PINTA Calc, #dscam004#6;
   Calc = Calc + 90;
   |SI Calc > 1178; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE ImprimeCobros;
   #dscam004#1;
   ;
   #dscam003#40,LinBucle;
   #dscam003#40,99;
   ;
   NULL,ImprimeCobros;
|FIN;

|PROCESO Aplazamiento;
   |SALVA_FICHA #dscam003;
   |HAZ Tipo9;
   enDocumento = #dscaz001#21;
   efFechaOri  = #dscaz001#11;
   enImporte   = #dscaz001#7;
   eaEntidad   = #dscaw017#0;
   eaNumero    = #dscaw017#2;
   efFVtoPag   = #dscaw017#3;
   enImpPag    = #dscaw017#6;
   |SI enTimbre ! 0;
      efFechaApl  = #dscaw017#3;
   |SINO;
      efFechaApl  = #dscaz019#2;
   |FINSI;
   |HAZ Aplaza;

   |HAZ Tipo8;
   |REPON_FICHA #dscam003;
|FPRC;

|PROCESO MiraRecibo;
   |SI FSalida = 10;
      #dscam003#40 = #dscaz001#21;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         Divisa = #dscam003#57; |HAZ TomaDecim;
         |PUSHV 0501 2380;
         |PINPA #0#dscam003;
         |PINDA #0#dscam003;
         #dscam004#17 = #dscam003#40;
         #dscam004#3  = 99;
         |LEE 000#dscam004.];
         |SI FSalida = 0;
            |SI #dscam004#17 = #dscam003#40;
               |LEE 000#dscam004.a; |LEE 000#dscam004.a; |LEE 000#dscam004.a;
               |LEE 000#dscam004.a;
               LinBucle = #dscam004#3;
            |SINO;
               |LEE 000#dscam004.a;
               |SI FSalida = 0;
                  |SI #dscam004#17 = #dscam003#40;
                     |LEE 000#dscam004.a; |LEE 000#dscam004.a; |LEE 000#dscam004.a;
                     |LEE 000#dscam004.a;
                     LinBucle = #dscam004#3;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            |SI FSalida ! 111;
               |LEE 000#dscam004.u;
               |LEE 000#dscam004.a; |LEE 000#dscam004.a; |LEE 000#dscam004.a;
               |LEE 000#dscam004.a;
               LinBucle = #dscam004#3;
            |SINO;
               LinBucle = 1;
            |FINSI;
         |FINSI;
         |BUCLE ImprimeCobros;
         |PAUSA;
         |POPV;
      |SINO;
         |MENAV "    Recibo inexistente";
      |FINSI;
      |ERROR;
      |ACABA;
   |FINSI;
   |SI FSalida = 11;
      PosLibro = 2209; PosSerie = 2218; PosFactu = 2232; PosRecib = 2249;
      |HAZ ConsultaVentas;
      |SI enDocum ! -1; |Y enFactura ! -1;
         #dscaz001#21 = enDocum; |PINTA #dscaz001#21;
      |SINO;
         |MENAV "    Ficha inexistente"; |ERROR;
      |FINSI;
      SwClave = 1;
   |FINSI;

   |SI FSalida = 2; |ERROR; |ACABA; |FINSI;

   #dscam003#40 = #dscaz001#21;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      |HAZ ComprTotVta;
      efFechaDoc = #dscam003#4;
      efFechaUlt = "01.01.0000";
      #dscam004#17 = #dscam003#40;
      #dscam004#3 = 99;
      |LEE 000#dscam004.];
      |SI FSalida = 0;
         |SI #dscam004#17 = #dscam003#40;
            efFechaUlt = #dscam004#6;
         |SINO;
            |LEE 000#dscam004.a;
            |SI FSalida = 0;
               |SI #dscam004#17 = #dscam003#40;
                  efFechaUlt = #dscam004#6;
               |FINSI;
            |FINSI;
         |FINSI;
      |SINO;
         |LEE 000#dscam004.u;
         |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
            efFechaUlt = #dscam004#6;
         |FINSI;
      |FINSI;
   |FINSI;

   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada ! 1; |Y #dscaz001#21 = NumDocumAnt;
      #dscam003#40 = #dscaz001#21;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         |SI nSwArtenvas = 1;
            |SI #dscam003#14 = "M"; |Y aCobrad = "";
               |AVISO;
               aAlfa = "    SRecibo gestionado por cobrador. " + &191 + " Continuar ? ";
               |CONFI aAlfa;
               |SI FSalida = 0;
                   #dscaz001#43 = "S";
                  nSwCobrArtenvas = 1;
               |SINO;
                  nSwCobrArtenvas = 0;
                  |ERROR; SwError = 1;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
      |ACABA;
   |FINSI;

   |SELECT #2#dscaz001;

   NumDoc  = #dscaz001#21;
   Libro   = #dscaz001#20;
   Serie   = #dscaz001#1;
   Factura = #dscaz001#2;
   Recibo  = #dscaz001#3;
   NumLin  = #dscaz001#0;
   SwError = 0;

   |LEE 000#dscaz001.=;
   |SI FSalida = 0;
      |SI NumLin ! #dscaz001#0;
         |AVISO;
         |MENAV "    Recibo ya introducido";
         |ERROR;
         SwError = 1;
      |FINSI;
   |FINSI;

   #dscam003#40 = NumDoc;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      |HAZ ComprTotVta;

      efFechaDoc = #dscam003#4;
      efFechaUlt = "01.01.0000";
      #dscam004#17 = #dscam003#40;
      #dscam004#3 = 99;
      |LEE 000#dscam004.];
      |SI FSalida = 0;
         |SI #dscam004#17 = #dscam003#40;
            efFechaUlt = #dscam004#6;
         |SINO;
            |LEE 000#dscam004.a;
            |SI FSalida = 0;
               |SI #dscam004#17 = #dscam003#40;
                  efFechaUlt = #dscam004#6;
               |FINSI;
            |FINSI;
         |FINSI;
      |SINO;
         |LEE 000#dscam004.u;
         |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
            efFechaUlt = #dscam004#6;
         |FINSI;
      |FINSI;

      enSwClas   = 1; eaFichClas = "dscaz001"; eaTipoClas = #dscam003#12;
      |HAZ CompruebaClas;
      |SI eaFichClas = "ERROR";
         |MENAV "    Documento inoperable en el perfil actual ";
         |SELECT #1#dscaz001;
         |ERROR; |ACABA;
      |FINSI;
      |SI eaFichClas = "INFOR";
         |CIERRA #dscam003;
         eaResult = "V"; enNumDocum = #dscam003#40;
         eaFichClas = "dscaz001"; enTipoRec = #dscam003#12; |HAZ CambiaTR;
         |ABRE #dscam003; |LEE 000#dscam003.=;
         |SI eaResult = "ERROR"; |ERROR; |ACABA; |FINSI;
      |FINSI;

      Divisa = #dscam003#57; |HAZ TomaDecim;
      nSwCobrArtenvas = 0;

      |SI #dscam051#42 = "S";
          |SI #dscam003#28 = "S"; |Y #dscam003#29 = "N";
             |AVISO; |MENAV "    Recibo no aceptado"; |ERROR; SwError = 1;
          |FINSI;
      |FINSI;
      |SI #dscam003#14 = "A";
         |AVISO; |MENAV "    Recibo anulado o agrupado"; |ERROR; SwError = 1;
      |FINSI;
      |SI #dscam003#14 = "D";
         |AVISO; |MENAV "    Recibo anulado o dividido"; |ERROR; SwError = 1;
      |FINSI;
      |SI #dscam003#14 = "R";
         |AVISO; |MENAV "    Recibo remesado"; |ERROR; SwError = 1;
      |FINSI;
      |SI #dscam003#14 = "M"; |Y aCobrad = "";
         |SI nSwArtenvas = 0;
            |AVISO; |MENAV "    Recibo gestionado por cobrador"; |ERROR; SwError = 1;
         |SINO;
            |AVISO;
            aAlfa = "    SRecibo gestionado por cobrador. " + &191 + " Continuar ? ";
            |CONFI aAlfa;
            |SI FSalida = 0;
               #dscaz001#43 = "S";
               nSwCobrArtenvas = 1;
            |SINO;
               nSwCobrArtenvas = 0;
               |ERROR; SwError = 1;
            |FINSI;
         |FINSI;
      |FINSI;
      |SI #dscam003#14 = "T";
         |AVISO; |MENAV "    Recibo englobado en talon/pagare"; |ERROR; SwError = 1;
      |FINSI;

      |SI aCobrad ! "";
         |ABRE #dscam016; |ABRE #dscam017;
         |SELECT #2#dscam017;
         #dscam017#9 = #dscam003#40;
         |LEE 000#dscam017.=;
         |SI FSalida = 0;
            #dscam016#0 = #dscam017#0;
            |LEE 000#dscam016.=;
            |SI FSalida ! 0; |DDEFECTO #dscam016; |FINSI;
            |SI #dscam016#1 ! aCobrad;
               |AVISO; |MENAV "    Recibo asignado a un cobrador distinto"; |ERROR; SwError = 1;
            |FINSI;
         |SINO;
            |AVISO; |MENAV "    Recibo no asignado a cobrador"; |ERROR; SwError = 1;
         |FINSI;
         |SELECT #1#dscam017;
         |CIERRA #dscam016; |CIERRA #dscam017;
      |FINSI;

      |SI #dscam003#31 = 0;
         |AVISO;
         |MENAV "    Recibo ya liquidado";
         |ERROR;
         SwError = 1;
      |FINSI;
      #dscaz001#29 = #dscam003#59;
   |SINO;
      |AVISO;
      |MENAV "    Recibo inexistente";
      |ERROR;
      SwError = 1;
   |FINSI;

   |SELECT #1#dscaz001;

   |SI SwError = 0;
      Manual = 1;
      #dscam003#40 = NumDoc;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         Divisa = #dscam003#57; |HAZ Tipo13;
         |HAZ GrabaRecibo;
         |SI enSwError = 1; |ACABA; |FINSI;
      |FINSI;
      Manual = 0;
   |SINO;
      #dscaz001#0 = NumLin;
      |LEE 000#dscaz001.=;
   |FINSI;

   |SI HayGestion = 1;
      Fichero = "Divisas"; Tipo = "G"; Cmp = "Codigo Divisa"; |HAZ ObtenDato;
      #agif324@#CmpNum# = #dscaz001#26;
      |LEE 000#agif324@.=;
      |SI FSalida = 0;
         Fichero = "Divisas"; Tipo = "G"; Cmp = "Num.Decimales"; |HAZ ObtenDato;
         nDeci_males = #agif324@#CmpNum#;
         nDeci_Div = #agif324@#CmpNum#;
      |FINSI;
   |SINO;
      |SI #dscaz001#26 = "EUR";
         nDeci_males = 2;
         nDeci_Div = 2;
      |SINO;
         nDeci_males = 0;
         nDeci_Div = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO GrabaRecibo;
   |HAZ ComprTotVta;

   |SI nSwRepre = 1;
      || Filtro por ruta de cliente
      #dscam052#0 = #dscam003#32;
      |LEE 000#dscam052.=;
      |SI FSalida ! 0; |DDEFECTO #dscam052; |FINSI;
      |SI #dscam052#189 < #dscaw117#4; |O #dscam052#189 > #dscaw117#5; |ACABA; |FINSI;
   |FINSI;

   |SI #dscam003#31 = 0; |ACABA; |FINSI;
   |SI #dscam003#14 = "A"; |O #dscam003#14 = "R";
    |O #dscam003#14 = "T"; |O #dscam003#14 = "D"; |O #dscam003#14 = "p";
       |ACABA;
   |FINSI;

   |SI nSwCobrArtenvas = 0;
      |SI nBucleAcotado = 1; |Y nSwArtenvas = 1;
      |SINO;
         |SI #dscam003#14 = "M"; |Y aCobrad = ""; |ACABA; |FINSI;
      |FINSI;
   |FINSI;

   |SI #dscam003#93 = "S"; |ACABA; |FINSI;

   || Entrada cobros confirmados para Viuda de Tadeo Juan. Tiquet 004182/00487
   |SI nConfirmes = 1;
      |SI #dscam003#14 ! "F"; |ACABA; |FINSI;
   |SINO;
      |SI #dscam003#14 = "F"; |ACABA; |FINSI;
   |FINSI;

   || ABDON : Tiquet 001483/01000
   || Se quita este control ya que si no se ha confirmado la reclamacion el
   ||    programa permite hacer el impagado, por lo que puede estar el recibo
   ||    fuera de la remesa seguir marcado con una peticion de reclamacion
   || Puesto que no se permite cobrar recibos remesados o liquidados, que son
   ||    los unicos estados en los que se puede tener en cuenta una solicitud
   ||    de reclamacion, este control es redundante.
   ||SI #dscam003#98 = "S"; |ACABA; |FINSI;

   |SI #dscam003#29 = "S"; |ACABA; |FINSI;

   enSwClas   = 1; eaFichClas = "dscaz001"; eaTipoClas = #dscam003#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |ACABA; |FINSI;

   |SI nBucleAcotado = 1;
      enNumDocum = #dscam003#40;
   |SINO;
      enNumDocum = #dscaz001#21;
   |FINSI;

   |SI Manual = 0; Linea = Linea + 1; |FINSI;
   |DDEFECTO #dscaz001;
   |SI Manual = 0;
      #dscaz001#0  = Linea;
   |SINO;
      #dscaz001#0  = NumLin;
      |LEE 000#dscaz001.=;
   |FINSI;

   eaTOperacion = "A"; eaTipoRecibo = "V";
   |HAZ ProcesaTempo;

   efFechaDiv = #dscaz001#14;
   Divisa = #dscam003#57; |HAZ Tipo13;

   #dscaz001#1  = #dscam003#0;
   #dscaz001#2  = #dscam003#1;
   #dscaz001#3  = #dscam003#2;
   #dscaz001#4  = #dscam003#5;
   #dscaz001#5  = #dscam003#32;
   #dscaz001#6  = #dscam003#6;
   #dscaz001#7  = #dscam003#31;
   #dscaz001#8  = #dscam003#23;
   #dscaz001#9  = #dscam003#30;
   #dscaz001#10 = " ";
   |SI nConfirmes = 0;
      #dscaz001#11 = #dscam003#3;
   |SINO;
      #dscaz001#11 = #dscam003#71;
   |FINSI;
   #dscaz001#12 = #dscam003#4;
   #dscaz001#13 = #dscam051#4;
   #dscaz001#14 = ~;
   #dscaz001#15 = 0;
   #dscaz001#16 = #dscam003#13;
   #dscaz001#17 = #dscam003#12;
   #dscaz001#20 = #dscam003#27;
   #dscaz001#21 = #dscam003#40;
   #dscaz001#22 = #dscam003#44;
   #dscaz001#23 = #dscam003#45;
   #dscaz001#24 = #dscam003#46;
   #dscaz001#26 = #dscam003#57;
   #dscaz001#27 = #dscam003#58;
   || #dscaz001#28 = 0;
   #dscaz001#28 = CambioDivVn;
   #dscaz001#29 = #dscam003#59;
   #dscaz001#30 = #dscam051#21;
   #dscaz001#40 = #dscam003#33;
   #dscaz001#41 = #dscam003#34;
   nTotalPdt = nTotalPdt + (#dscaz001#9 - (#dscaz001#8 + #dscaz001#15));

   |SI aCobrad ! ""; |Y nSwArtenvas = 1;
          #dscaz001#43 = "S";
   |FINSI;

   |SI Manual = 0;
      |GRABA 020#dscaz001.c;
   |SINO;
      |GRABA 020#dscaz001.a;
   |FINSI;
|FPRC;

|DEFBUCLE Vencimiento;
#dscam003#2;
;
"01.01.1900",0000000001;
"31.12.2999",9999999999
;
NULL,GrabaRecibo;
|FIN;

|DEFBUCLE Emision;
#dscam003#3;
;
"01.01.1900",0000000001;
"31.12.2999",9999999999;
;
NULL,GrabaRecibo;
|FIN;

|DEFBUCLE Cliente;
#dscam003#4;
;
"            ",0000000001;
"zzzzzzzzzzzz",9999999999;
;
NULL,GrabaRecibo;
|FIN;

|DEFBUCLE Factura;
#dscam003#6;
;
00, "     ", 000000, 000, " ", 000000001;
99, "zzzzz", 999999, 999, " ", 999999999;
;
NULL,GrabaRecibo;
|FIN;

|RUTINA infer;
   #dscaz001#40 = "  ";
   #dscaz001#11 = "01.01.1900";
   #dscaz001#0 = 00001;
|FRUT;

|RUTINA super;
   #dscaz001#40 = "zz";
   #dscaz001#11 = "31.12.2999";
   #dscaz001#0 = 99999;
|FRUT;

|PROCESO MarcaTodos;
     |SI #dscaz001#10 = "*"; |O #dscaz001#10 = "P"; |ACABA; |FINSI;

     #dscam003#40 = #dscaz001#21;
     |LEE 020#dscam003.=;

     |SI nSwArtenvas = 1; |Y #dscam003#14 = "M"; |Y aCobrad = "";
          |AVISO;
          aAlfa = "    SRecibo [" + #dscam003#40 + "] gestionado por cobrador. " + &191 + " Continuar ? ";
          |CONFI aAlfa;
          |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;

     eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscaz001#21;
     |HAZ ProcesaTempo;

     #dscaz001#8  = #dscaz001#7;
     #dscaz001#13 = #dscam051#4;
     #dscaz001#16 = #dscam051#8;
     #dscaz001#30 = #dscam051#21;
     #dscaz001#25 = "P";
     #dscaz001#10 = "*";
     HaySelec = HaySelec + 1;
     TotalSelec = TotalSelec + #dscaz001#8;
     nTotalPdt = nTotalPdt - #dscaz001#8;
     nTotalLiq = nTotalLiq + #dscaz001#8;
     |SI #dscaz001#31 = "          "; |Y #dscaz001#33 = "    ";
        nTotalEfe = nTotalEfe + #dscaz001#8;
     |SINO;
        nTotalPag = nTotalPag + #dscaz001#8;
     |FINSI;
     |GRABA 020#dscaz001.a;
|FPRC;

|DEFBUCLE MarcaTodos;
#dscaz001#1;
;
INICIO;
FINAL;
;
NULL,MarcaTodos;
|FIN;

|PROCESO DesmarcaTodos;
   |SI #dscaz001#10 = " "; |ACABA; |FINSI;
   eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaz001#21; |HAZ ProcesaTempo;

   #dscam003#40 = #dscaz001#21;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      TotalSelec = TotalSelec - #dscaz001#8;

      |SI #dscaz001#10 = "*";
         |SI #dscaz001#31 = "          "; |Y #dscaz001#33 = "    ";
            nTotalEfe = nTotalEfe - #dscaz001#8;
         |SINO;
            nTotalPag = nTotalPag - #dscaz001#8;
         |FINSI;
      |FINSI;
      |SI #dscaz001#10 = "P"; nTotalPag = nTotalPag - #dscaz001#8; |FINSI;

      #dscaz001#8 = #dscam003#23;
      #dscaz001#13 = "";
      #dscaz001#16 = "";
      #dscaz001#10 = " ";
      #dscaz001#31 = "";
      #dscaz001#32 = "";
      #dscaz001#33 = "";
      #dscaz001#34 = "";
      #dscaz001#35 = "";
      #dscaz001#36 = 0;
      |GRABA 020#dscaz001.a;
      HaySelec = HaySelec - 1;
   |FINSI;
|FPRC;

|DEFBUCLE DesmarcaTodos;
#dscaz001#1;
;
INICIO;
FINAL;
;
NULL,DesmarcaTodos;
|FIN;

|PROCESO MarcaDesm;
   |SI #dscaz001#10 = " ";
      enSwClas   = 1; eaFichClas = "dscaz001"; eaTipoClas = #dscaz001#17;
      |HAZ CompruebaClas;
      |SI eaFichClas = "ERROR";
         |MENAV "    Documento inoperable en el perfil actual ";
         |SELECT #1#dscaz001;
         |ERROR; |ACABA;
      |FINSI;
      |SI eaFichClas = "INFOR";
         |CIERRA #dscam003;
         eaResult = "V"; enNumDocum = #dscaz001#21;
         eaFichClas = "dscaz001"; enTipoRec = #dscam003#12; |HAZ CambiaTR;
         |ABRE #dscam003; |LEE 000#dscam003.=;
         |SI eaResult = "ERROR"; |ERROR; |ACABA; |FINSI;
      |FINSI;

      |SI nSwArtenvas = 1;
         |SI #dscam003#14 = "M"; |Y aCobrad = "";
            |AVISO;
            aAlfa = "    SRecibo gestionado por cobrador. " + &191 + " Continuar ? ";
            |CONFI aAlfa;
            |SI FSalida = 0;
               #dscaz001#43 = "S";
               nSwCobrArtenvas = 1;
            |SINO;
               nSwCobrArtenvas = 0;
               |ERROR; SwError = 1; |ACABA;
            |FINSI;
         |FINSI;
      |FINSI;

      eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscaz001#21; |HAZ ProcesaTempo;
      Divisa = #dscam003#57; |HAZ TomaDecim;
      #dscaz001#8 = #dscaz001#7 + (#dscaz001#15 + #dscaz001#18 + #dscaz001#19);
      #dscaz001#13 = #dscam051#4;
      #dscaz001#16 = #dscam051#8;
      #dscaz001#25 = "P";
      #dscaz001#28 = CambioDivVn;
      #dscaz001#29 = #dscam003#59;
      #dscaz001#30 = #dscam051#21;
      #dscaz001#10 = "*";
      HaySelec = HaySelec + 1;
      TotalSelec = TotalSelec + #dscaz001#8;
      nTotalPdt = nTotalPdt - #dscaz001#8;
      nTotalLiq = nTotalLiq + #dscaz001#8;
      |SI #dscaz001#31 = "          "; |Y #dscaz001#33 = "    ";
         nTotalEfe = nTotalEfe + #dscaz001#8;
      |SINO;
         nTotalPag = nTotalPag + #dscaz001#8;
      |FINSI;
      |GRABA 020#dscaz001.a;
      |ACABA;
   |FINSI;
   |SI #dscaz001#10 = "*";
      eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaz001#21; |HAZ ProcesaTempo;
      #dscam003#40 = #dscaz001#21;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         nTotalPdt = nTotalPdt + #dscaz001#8;
         nTotalLiq = nTotalLiq - #dscaz001#8;
         |SI #dscaz001#31 = "          "; |Y #dscaz001#33 = "    ";
            nTotalEfe = nTotalEfe - #dscaz001#8;
         |SINO;
            nTotalPag = nTotalPag - #dscaz001#8;
         |FINSI;
         TotalSelec = TotalSelec - #dscaz001#8;
         #dscaz001#13 = "";
         #dscaz001#16 = "";
         #dscaz001#25 = "P";
         #dscaz001#8 = #dscam003#23;
         #dscaz001#10 = " ";
         #dscaz001#28 = 0;
         #dscaz001#29 = 0;
         #dscaz001#31 = "";
         #dscaz001#32 = "";
         #dscaz001#33 = "";
         #dscaz001#34 = "";
         #dscaz001#35 = "";
         #dscaz001#36 = 0;
         |GRABA 020#dscaz001.a;

         |ABRE #dscam170;
         #dscam170#0 = #dscaz001#21;
         #dscam170#3 = #dscaz001#11;
         |LEE 000#dscam170.=;
         |SI FSalida = 0; |BORRA 020#dscam170.a; |FINSI;
         |CIERRA #dscam170;

         HaySelec = HaySelec - 1;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO MarcaDesmPag;
   nSw = 0;
   |SI #dscaz001#10 = " "; nSw = 1; |FINSI;
   |SI #dscaz001#10 = "*";
      |SI #dscaz001#31 = "          "; |Y #dscaz001#33 = "    ";
         nSw = 1;
      |FINSI;
   |FINSI;

   |SI nSw = 1;
      #dscam003#40 = #dscaz001#21;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         |SI #dscam003#14 = "F"; |Y nConfirmes = 0;
            |MENAV "    El documento es un cobro confirmado"; |ERROR; |ACABA;
         |FINSI;
      |FINSI;

      |SI #dscaz001#10 = "*"; |HAZ MarcaDesm; |FINSI;
      enSwClas   = 1; eaFichClas = "dscaz001"; eaTipoClas = #dscaz001#17;
      eaFiltroPag = "P";
      |HAZ CompruebaClas;
      eaFiltroPag = "";
      |SI eaFichClas = "ERROR";
         |MENAV "    Documento inoperable en el perfil actual ";
         |SELECT #1#dscaz001; |ERROR; |ACABA;
      |FINSI;
      |SI eaFichClas = "INFOR";
         |CIERRA #dscam003;
         eaResult = "V"; enNumDocum = #dscaz001#21;
         eaFichClas = "dscaz001"; enTipoRec = #dscam003#12; |HAZ CambiaTR;
         |ABRE #dscam003; |LEE 000#dscam003.=;
         |SI eaResult = "ERROR"; |ERROR; |ACABA; |FINSI;
      |FINSI;
      eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscaz001#21; |HAZ ProcesaTempo;
      Divisa = #dscam003#57; |HAZ TomaDecim;

      #dscaz001#8  = #dscaz001#7 + #dscaz001#15 + #dscaz001#18;
      #dscaz001#13 = #dscam051#4;
      #dscaz001#16 = #dscam051#8;
      #dscaz001#25 = "P";
      #dscaz001#28 = CambioDivVn;
      #dscaz001#29 = #dscam003#59;
      #dscaz001#30 = #dscam051#21;
      #dscaz001#10 = "P";
      HaySelecPag  = HaySelecPag + 1;

     HaySelCobCf = HaySelCobCf + 1;     || Tarea T6276
     /*
     |SI HaySelCobCf = 0;
         HaySelCobCf = 1;
      |SINO;
         HaySelCobCf = -1;
      |FINSI;
      */
      TotalSelec   = TotalSelec + #dscaz001#8;
      TotalSelPg   = TotalSelPg + #dscaz001#8;
      nTotalPdt    = nTotalPdt - #dscaz001#8;
      nTotalLiq    = nTotalLiq + #dscaz001#8;
      nTotalPag = nTotalPag + #dscaz001#8;
      |GRABA 020#dscaz001.a;
      |ACABA;
   |FINSI;
   |SI #dscaz001#10 = "P";
      eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaz001#21; |HAZ ProcesaTempo;
      #dscam003#40 = #dscaz001#21;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         nTotalPdt = nTotalPdt + #dscaz001#8;
         nTotalLiq = nTotalLiq - #dscaz001#8;
         nTotalPag = nTotalPag - #dscaz001#8;
         TotalSelec = TotalSelec - #dscaz001#8;
         TotalSelPg = TotalSelPg - #dscaz001#8;
         #dscaz001#13 = "";
         #dscaz001#16 = "";
         #dscaz001#25 = "P";
         #dscaz001#8 = #dscam003#23;
         #dscaz001#10 = " ";
         #dscaz001#28 = 0;
         #dscaz001#29 = 0;
         #dscaz001#31 = "";
         #dscaz001#32 = "";
         #dscaz001#33 = "";
         #dscaz001#34 = "";
         #dscaz001#35 = "";
         #dscaz001#36 = 0;
         |GRABA 020#dscaz001.a;
         HaySelecPag = HaySelecPag - 1;

         HaySelCobCf = HaySelCobCf - 1;      || Tarea T6276
/*
         |SI HaySelCobCf = -1;
            HaySelCobCf = 1;
         |SINO;
            HaySelCobCf = 0;
         |FINSI;
*/
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO RevisaClientes;
   enSwClas   = 1; eaFichClas = "dscaz001"; eaTipoClas = #dscam003#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; SwError = 2; |FINSI;

   |SI CtaCliente = "";
      CtaCliente = #dscaz001#4; |QBF CtaCliente;
   |SINO;
      Comodin = #dscaz001#4; |QBF Comodin;
      |SI CtaCliente ! Comodin;
         SwError1 = 1; |ERROR10;
      |FINSI;
   |FINSI;

   |SI CodCliente = "";
      CodCliente = #dscaz001#5; |QBF CodCliente;
   |SINO;
      Comodin = #dscaz001#5; |QBF Comodin;
      |SI CodCliente ! Comodin;
         SwError1 = 1; |ERROR10;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE RevisaClientes;
#dscaz001#1;
10,33;
00001,"P","    ";
99999,"P","    ";
;
NULL,RevisaClientes;
|FIN;

|PROCESO Baja; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3;
      HaySelec = HaySelec - 1;
      |SI #dscaz001#10 = "P";
         nTotalPag = nTotalPag - #dscaz001#8;
         TotalSelPg = TotalSelPg - #dscaz001#8;
         HaySelecPag  = HaySelecPag - 1;
      |FINSI;
      |SI #dscaz001#10 = "*";
         TotalSelec = TotalSelec - #dscaz001#8;
         HaySelec  = HaySelec - 1;
      |FINSI;

      eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaz001#21; |HAZ ProcesaTempo;
      |HAZ EsAgrogenil;
      |SI FSalida = 0;
         enTipoEntrada = 3; enDocum = #dscaz001#21; |SUB_EJECUTA_NP "dscagm01.tab";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO LineasAsigna;
   |SALVA_FICHA #dscaz001;
   |SELECT #2#dscaz001;
   #dscaz001#0  = 1;
   #dscaz001#21 = #dscam017#9;
   |LEE 000#dscaz001.];
   |SI FSalida = 0; |Y #dscaz001#21 = #dscam017#9;
      nSwError = 1;
   |SINO;
      nSwError = 0;
   |FINSI;
   |SELECT #1#dscaz001;
   |REPON_FICHA #dscaz001;

   |SI nSwError = 1; |ACABA; |FINSI;

   #dscam003#40 = #dscam017#9;
   |LEE 000#dscam003.=;
   |HAZ GrabaRecibo;
   HaySelec = HaySelec + 1;

   nTotalPdt = nTotalPdt + (#dscam003#30 - #dscam003#23);
   ||nTotalLiq = nTotalLiq + #dscam003#23;
|FPRC;

|DEFBUCLE LineasAsigna;
#dscam017#1;
;
nAsignacion, 001;
nAsignacion, 999;
;
NULL,LineasAsigna;
|FIN;

|PROCESO Asignaciones;
   nAsignacion = #Referen@#0;
   |BUCLE LineasAsigna;
|FPRC;

|DEFBUCLE Asignaciones;
#Referen@#1001;
;
00001;
99999;
;
NULL,Asignaciones;
|FIN;

|PROCESO MiraCuantosz01;
   |SI #dscaz001#10 = "A";
      |SI nDocSel = -1; nDocSel = #dscaz001#21; |FINSI;
      |SI fVtoMasAlto [ #dscaz001#11; fVtoMasAlto = #dscaz001#11; |FINSI;
      nContz01 = nContz01 + 1;
      nLinAgrup = #dscaz001#0 + 1;
   |FINSI;
|FPRC;

|DEFBUCLE MiraCuantosz01;
#dscaz001#1;
;
INICIO;
FINAL;
;
NULL, MiraCuantosz01;
|FIN;

|PROCESO MarcaDesmAgr;
   |SI #dscaz001#10 = " ";
      |SI #dscaz001#5 = "      ";   || Comprobar cuenta
         |SI aCtaCliAgr = ""; |Y aCodCliAgr = "";
            aCtaCliAgr = #dscaz001#4;
            |SI fVtoMasAlto [ #dscaz001#11; fVtoMasAlto = #dscaz001#11; |FINSI;
            #dscaz001#10 = "A"; |GRABA 020#dscaz001.a;

            fFechaHoy = ~; fFechaVto = #dscaz001#11;
            nCalcF1 = fFechaVto; nCalcF2 = fFechaHoy;
            nCalcF1 = nCalcF1 - nCalcF2;
            nSumaLuxe = nSumaLuxe + (nCalcF1*#dscaz001#7);
            nTotalLuxe = nTotalLuxe + #dscaz001#7;
         |SINO;
            |SI aCtaCliAgr ! #dscaz001#4;
               |MENAV "    Los documentos seleccionados anteriormente no son del mismo cliente";
            |SINO;
               |SI fVtoMasAlto [ #dscaz001#11; fVtoMasAlto = #dscaz001#11; |FINSI;
               #dscaz001#10 = "A"; |GRABA 020#dscaz001.a;

               fFechaHoy = ~; fFechaVto = #dscaz001#11;
               nCalcF1 = fFechaVto; nCalcF2 = fFechaHoy;
               nCalcF1 = nCalcF1 - nCalcF2;
               nSumaLuxe = nSumaLuxe + (nCalcF1*#dscaz001#7);
               nTotalLuxe = nTotalLuxe + #dscaz001#7;
            |FINSI;
         |FINSI;
      |SINO;
         |SI aCodCliAgr = ""; |Y aCtaCliAgr = "";
            |SI fVtoMasAlto [ #dscaz001#11; fVtoMasAlto = #dscaz001#11; |FINSI;
            aCodCliAgr = #dscaz001#5;
            aCtaCliAgr = #dscaz001#4;
            #dscaz001#10 = "A"; |GRABA 020#dscaz001.a;

            fFechaHoy = ~; fFechaVto = #dscaz001#11;
            nCalcF1 = fFechaVto; nCalcF2 = fFechaHoy;
            nCalcF1 = nCalcF1 - nCalcF2;
            nSumaLuxe = nSumaLuxe + (nCalcF1*#dscaz001#7);
            nTotalLuxe = nTotalLuxe + #dscaz001#7;
         |SINO;
            ||
            ||SI aCodCliAgr ! #dscaz001#5;
            ||MENAV "    Los documentos seleccionados anteriormente no son del mismo cliente";
            || se cambia por la cuenta contable

            |SI aCtaCliAgr ! #dscaz001#4;
               |MENAV "    Los documentos seleccionados anteriormente no tienen la misma cuenta contable";
            |SINO;
               |SI fVtoMasAlto [ #dscaz001#11; fVtoMasAlto = #dscaz001#11; |FINSI;
               #dscaz001#10 = "A"; |GRABA 020#dscaz001.a;
               fFechaHoy = ~; fFechaVto = #dscaz001#11;
               nCalcF1 = fFechaVto; nCalcF2 = fFechaHoy;
               nCalcF1 = nCalcF1 - nCalcF2;
               nSumaLuxe = nSumaLuxe + (nCalcF1*#dscaz001#7);
               nTotalLuxe = nTotalLuxe + #dscaz001#7;
            |FINSI;
         |FINSI;
      |FINSI;
      |ACABA;
   |FINSI;
   |SI #dscaz001#10 = "A";
      #dscaz001#10 = " "; |GRABA 020#dscaz001.a;

      fFechaHoy = ~; fFechaVto = #dscaz001#11;
      nCalcF1 = fFechaVto; nCalcF2 = fFechaHoy;
      nCalcF1 = nCalcF1 - nCalcF2;
      nSumaLuxe = nSumaLuxe - (nCalcF1*#dscaz001#7);
      nTotalLuxe = nTotalLuxe - #dscaz001#7;

      |SALVA_FICHA #dscaz001;
      fVtoMasAlto = "01.01.0000";
      nLinAgrup   = 0; nDocSel = 0;
      nContz01 = 0; |BUCLE MiraCuantosz01;
      |SI nContz01 = 0;
         aCodCliAgr = ""; aCtaCliAgr = "";
      |FINSI;
      |REPON_FICHA #dscaz001;
   |FINSI;
   |PONCONTROL 23, "si";
|FPRC;

|RUTINA infz019;
   #dscaz019#0 = 00001;
|FRUT;

|RUTINA supz019;
   #dscaz019#0 = 99999;
|FRUT;

|PROCESO PonComas;
   Calc = Comodin;
   |SI Calc < 0;
      Calc = 0 - Calc;
      Comodin = Calc;
      SwNeg = 1;
   |SINO;
      SwNeg = 0;
   |FINSI;

   Comodin1 = Comodin;
   Comodin1 = Comodin1 - ".";
   |SI FSalida ! 0;
      Calc = FSalida + 98;
      Comodin1 = Comodin1 % Calc;
      nDecimales = Comodin1;
      aDecimales = Comodin1; |QBF aDecimales;

      LongAlfa = aDecimales % 0; Long = LongAlfa;
      |SI Long < 2;
         Long = 2 - Long;
         aDecimales = aDecimales + ("0" * Long);
      |FINSI;
      || Comodin = Comodin - Comodin1; Comodin = Comodin - ".";
      Calc = Calc - 199; Calc = 100 + ((Calc / 100) ! 0);
      Comodin = Comodin % Calc;
   |SINO;
      nDecimales = 0;
      aDecimales = "00";
   |FINSI;

   Comodin1 = Comodin;
   Comodin = "";
   |PARA; |SI Comodin1 ! ""; |HACIENDO;
      LongAlfa = Comodin1 % 0;
      Long = LongAlfa;
      |SI Long [ 3;
         Cadena = Comodin1;
         Comodin1 = "";
         |QBF Cadena;
         Comodin = Cadena + Comodin;
      |SINO;
         Cadena = Comodin1 % -103;
         Comodin1 = Comodin1 - Cadena;
         Comodin  = "." + Cadena + Comodin;
      |FINSI;
   |SIGUE;
   |SI SwNeg = 1;
      Comodin = "-" + Comodin;
   |FINSI;
   |SI nDecimales ] 0;
      Comodin = Comodin + ",";
      ||SI nDecimales < 10; Comodin = Comodin + "0"; |FINSI;
      Comodin = Comodin + aDecimales;
      ||Comodin = Comodin + nDecimales;
   |FINSI;
|FPRC;

|PROCESO TomaNuevoDoc;
    #dscaz019#2 = #dscaz001#11;
    #dscaz019#4 = #dscaz001#12;
|FPRC;

|PROCESO ActualNuevoDoc; |TIPO 2;
   Flag = 0 +. 1;

   TotAgrup = TotAgrup -. #dscaz019#3;
   TotAgrup = TotAgrup ! nDeci_Div;

   |CUADRO 0559 0779;
   |PINTA 0660, "                   ";
   |ATRI R; |PINTA 0660, " Total "; |ATRI N;
   Comodin = TotAgrup; |HAZ PonComas;
   |PINTA 0668,Comodin;

   |SI Flag < 0;
      #dscam003#40 = #dscaz019#1;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         |BORRA 020#dscam003.a;
      |FINSI;
      |ABRE #dscam170;
      #dscam170#0 = #dscam003#40;
      #dscam170#3 = #dscam003#3;
      |LEE 101#dscam170.=;
      |SI FSalida = 0;
         |BORRA 020#dscam170.a;
      |FINSI;
      |LIBERA #dscam170; |CIERRA #dscam170;
   |SINO;
      |LEE 000#dscam003.u;
      |SI  FSalida = 0;
         NuevoDoc = #dscam003#40 + 1;
      |SINO;
         NuevoDoc = 1;
      |FINSI;
      #dscaz019#1 = NuevoDoc; |PINTA #dscaz019#1;
      |DDEFECTO #dscam003;
      #dscam003#40 = #dscaz001#21;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         |SI #dscam003#16 ! 0;
            |SI #dscam051#3 = "S"; |Y #dscam051#114 = 1;
               |SALVA_FICHA #dscam003;
               enBanco = -1;
               || enEmpCartera = #48#0;   enEmpGestion = #dscam003#46;
               enEmpCartera = -1;      enEmpGestion = #dscam003#46;
               eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
               nImporte = #dscaz019#3; nImporte = (nImporte / #dscam003#59) ! nDeci_Div;
               eaTipoOper = "-7+4";
               |HAZ BucleRiesgo;
               |REPON_FICHA #dscam003;
            |FINSI;
         |FINSI;
         #dscam003#40 = #dscaz019#1; |GRABA 020#dscam003.b;
         ||#dscam003#1 = 0;
         ||#dscam003#2 = 0;
         #dscam003#3 = #dscaz019#2;
         #dscam003#4 = #dscaz019#4;
         #dscam003#14 = "P"; #dscam003#15 = "Pendiente de cobro";
         #dscam003#16 = 0;
         #dscam003#23 = 0; #dscam003#61 = 0;
         #dscam003#17 = 0; #dscam003#37 = 0;
         #dscam003#24 = 0; #dscam003#25 = 0; #dscam003#38 = 0;
         #dscam003#62 = 0; #dscam003#63 = 0; #dscam003#66 = 0;
         #dscam003#26 = "01.01.0000";
         #dscam003#41 = 0;    #dscam003#49 = "N";
         #dscam003#70 = "";   #dscam003#72 = "";
         #dscam003#82 = "S";  #dscam003#83 = #dscaz001#21;
         #dscam003#87 = aSerDiv; #dscam003#88 = nFacDiv;
         #dscam003#22 = #dscaz019#3; #dscam003#60 = #dscam003#22 / #dscam003#59;
         #dscam003#30 = #dscam003#22 + (#dscam003#24 + #dscam003#25 + #dscam003#38);
         #dscam003#64 = #dscam003#60 + (#dscam003#62 + #dscam003#63 + #dscam003#66);
         #dscam003#31 = #dscam003#30;
         #dscam003#65 = #dscam003#64;
         |SI TotAgrup = 0;
            #dscam003#101 = nGtosArrastradosD;
            #dscam003#102 = nGtosArrastradosB;
         |SINO;
            |SI #dscam003#30 ] nGtosArrastradosD;
               #dscam003#101 = nGtosArrastradosD; nGtosArrastradosD = 0;
               #dscam003#102 = nGtosArrastradosB; nGtosArrastradosB = 0;
            |SINO;
               #dscam003#101 = #dscam003#30; nGtosArrastradosD = nGtosArrastradosD - #dscam003#30;
               #dscam003#102 = #dscam003#64; nGtosArrastradosB = nGtosArrastradosB - #dscam003#64;
            |FINSI;
         |FINSI;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
         |SI nSwAplaza = 1; |HAZ Aplazamiento; |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO MiraFecha;
   |SI #dscaz019#2 < #dscaz019#4;
      |MENAV "    Fecha incorrecta."; |ERROR;
   |FINSI;

   |SI nSwLuxe = 1;
      nSwAplaza = 0;
      |SI #dscaz019#2 > #dscaz001#11;
         aAlfa = "    SNuevo vencimiento posterior al original, " + &191 + " Calcular coste aplazamiento ?";
         |CONFI aAlfa;
         |SI FSalida = 0; nSwAplaza = 1; |FINSI;
      |FINSI;
   |SINO;
      nSwAplaza = 0;
   |FINSI;
|FPRC;

|PROCESO AnadeResult;
   #dscam003#40 = #dscaz019#1;
   |LEE 000#dscam003.=;
   |HAZ GrabaRecibo;
|FPRC;

|DEFBUCLE AnadeResult;
#dscaz019#1;
;
INICIO;
FINAL;
;
NULL, AnadeResult;
|FIN;

|PROCESO CartaGtosAp;
   |SI #dscaz019#2 [ #dscaz001#11; |ACABA; |FINSI;

   #dscam003#40 = #dscaz019#1;
   |LEE 000#dscam003.=;
   |SI FSalida ! 0; |DDEFECTO #dscam003; |FINSI;

   Dia  = #dscam003#4 % 0102; Dia = ("00" + Dia) % -102;
   Mes  = #dscam003#4 % 0402; Mes = ("00" + Mes) % -102; |HAZ MesLetra; |QBF Mes;
   anyo = #dscam003#4 % -104;
   FecEmision = Dia + " de " + Mes + " de " + anyo;

   eaCodigo = #dscam003#32; eaTipoCod = "C"; aCuenta = #dscam003#5; |HAZ LeeDatos;
   enDocumento = #dscaz001#21; efFecVto = #dscaz001#11;

   |PRINT;
|FPRC;

|DEFBUCLE CartaGtosAp;
#dscaz019#1;
;
INICIO;
FINAL;
;
NULL, CartaGtosAp;
|FIN;

|PROCESO Divide;
   |DDEFECTO #dscam003;
   #dscam003#40 = #dscaz001#21;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#14 = "M";
         |MENAV "    No se pueden dividir recibos asignados a cobrador"; |ACABA;
      |FINSI;
   |FINSI;

   |SALVA_FICHA #dscaz001;
   |BUCLE DesmarcaTodos;
   |REPON_FICHA #dscaz001;
   #dscaw079#0 = nTotalEfe; #dscaw079#1 = nTotalPag;
   |PINTA 0947, #dscaw079#0; |PINTA 0967, #dscaw079#1;

   #dscam003#40 = #dscaz001#21;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      nGtosArrastradosD = #dscam003#101 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      nGtosArrastradosB = #dscam003#102 + #dscam003#62 + #dscam003#63 + #dscam003#66;
   |SINO;
      nGtosArrastradosD = 0;
      nGtosArrastradosB = 0;
   |FINSI;

   TotAgrup = #dscaz001#7 ! nDeci_Div;
   |PUSHV 0501 2380;
   |C_M #dscaz019#1,1,"N";
   aAlfa = "div" + Usuario; |NOME_DAT #dscaz019#aAlfa#; || PEPE
   |DELINDEX #dscaz019;
   |BLANCO 0501 1380;
   |CUADRO 0606 1356;
   |ATRI R; |PINTA 607, " DIVISION DOCUMENTO ";                       |ATRI N;
   |ATRI R; |PINTA 707, "Linea Documento Fecha Emi. Fecha Vto.   Importe  "; |ATRI N;
   |CUADRO 0559 0779;
   |PINTA 0660, "                   ";
   |ATRI R; |PINTA 0660, " Total "; |ATRI N;
   Comodin = TotAgrup; |HAZ PonComas;
   |PINTA 0668,Comodin;
   nTotalRec = #dscaz001#9;
   aSerDiv = #dscaz001#1;
   nFacDiv = #dscaz001#2;
   |ENTLINEAL #1#dscaz019,-1,1,12,1,infz019,supz019;

   |SALVA_FICHA #dscaz001;
   |LEE 000#dscaz001.u; Linea = #dscaz001#0;
   |REPON_FICHA #dscaz001;

   |SI TotAgrup ! #dscaz001#9;
      |SI TotAgrup ! 0;
         |LEE 000#dscam003.u;
         |SI  FSalida = 0;
            NuevoDoc = #dscam003#40 + 1;
         |SINO;
            NuevoDoc = 1;
         |FINSI;

         |DDEFECTO #dscam003;
         #dscam003#40 = #dscaz001#21;
         |LEE 000#dscam003.=;
         |SI FSalida = 0;
            |SI #dscam003#16 ! 0;
               |SI #dscam051#3 = "S"; |Y #dscam051#114 = 1;
                  |SALVA_FICHA #dscam003;
                  enBanco = -1;
                  || enEmpCartera = #48#0;   enEmpGestion = #dscam003#46;
                  enEmpCartera = -1;   enEmpGestion = #dscam003#46;
                  eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
                  nImporte = TotAgrup; nImporte = (nImporte / #dscam003#59) ! nDeci_Div;
                  eaTipoOper = "-7+4";
                  |HAZ BucleRiesgo;
                  |REPON_FICHA #dscam003;
               |FINSI;
            |FINSI;
            #dscam003#40 = NuevoDoc;
            |GRABA 020#dscam003.b;
            ||#dscam003#1 = 0;
            ||#dscam003#2 = 0;
            #dscam003#14 = "P"; #dscam003#15 = "Pendiente de cobro";
            #dscam003#16 = 0;
            #dscam003#23 = 0; #dscam003#61 = 0;
            #dscam003#17 = 0; #dscam003#37 = 0;
            #dscam003#26 = "01.01.0000";
            #dscam003#22 = TotAgrup; #dscam003#60 = #dscam003#22 / #dscam003#59;
            #dscam003#30 = TotAgrup; #dscam003#64 = #dscam003#30 / #dscam003#59;
            #dscam003#31 = TotAgrup; #dscam003#65 = #dscam003#31 / #dscam003#59;
            #dscam003#41 = 0;  #dscam003#49 = "N";
            #dscam003#70 = ""; #dscam003#72 = "";
            #dscam003#82 = "S";
            #dscam003#83 = #dscaz001#21;
            #dscam003#87 = aSerDiv;
            #dscam003#88 = nFacDiv;
            #dscam003#101 = nGtosArrastradosD;
            #dscam003#102 = nGtosArrastradosB;
            |GRABA 020#dscam003.a; |LIBERA #dscam003;

            |SALVA_FICHA #dscaz001;
            |HAZ GrabaRecibo;
            |REPON_FICHA #dscaz001;

            eaUsuario = Usuario % 0810;
            eaDescr   = "DIVISION DOCUMENTO VENTA (" + (("000000000" + #dscaz001#21) % -109) + ")";
            eaTipoReg = "DV";  eaNumero = ("000000000" + #dscaz001#21) % -109;
            eaTipoOp  = "A";   enImpAnt = #dscam003#30; enImpAct = 0;
            |HAZ GrabaAudit;
         |FINSI;
      |FINSI;

      #dscam003#40 = #dscaz001#21;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         #dscam003#14 = "D"; #dscam003#15 = "Dividido";
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |FINSI;
   |FINSI;

   |POPV;

   |BORRA 020#dscaz001.a;

   |LEE 000#dscaz001.u;
   nLinea = #dscaz001#0;

   || A¤ado los recibos resultantes del dividido
   |BUCLE AnadeResult;
   |PONCONTROL 23, "si";
|FPRC;

|PROCESO LineasAgrupa;
   |SI #dscaz001#10 ! "A"; |ACABA; |FINSI;

   |SI nSwOpcion = 1;
      |BORRA 020#dscaz001.a;
   |FINSI;
   |SI nSwOpcion = 2;
      #dscaz001#10 = " "; |GRABA 020#dscaz001.a;
   |FINSI;
   |SI nSwOpcion = 3;
      #dscam003#40 = #dscaz001#21;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         |SI #dscam003#16 ! 0;
            |SI #dscam051#3 = "S"; |Y #dscam051#114 = 1;
               |SALVA_FICHA #dscam003;
               enBanco = -1;
               enEmpCartera = -1;       enEmpGestion = #dscam003#46;
               eaSerie = #dscam003#0;   eaCliGest = #dscam003#32;
               nImporte = #dscam003#65; eaTipoOper = "-7+4";
               |HAZ BucleRiesgo;
               |REPON_FICHA #dscam003;
            |FINSI;
         |FINSI;
         #dscam003#14 = "A";
         #dscam003#15 = "Agrupado";
         #dscam003#41 = #dscaz006#7;
         #dscam003#12 = #dscaz001#17;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;

         nGtosArrastradosD = nGtosArrastradosD + #dscam003#101;
         nGtosArrastradosB = nGtosArrastradosB + #dscam003#102;
         |SI #dscam003#24 ! 0; |O #dscam003#25 ! 0; |O #dscam003#38 ! 0;
            |SI #dscam003#22 ! #dscam003#30;
               nGtosArrastradosD = nGtosArrastradosD + #dscam003#24 + #dscam003#25 + #dscam003#38;
               nGtosArrastradosB = nGtosArrastradosB + #dscam003#62 + #dscam003#63 + #dscam003#66;
            |FINSI;
         |FINSI;

         |SI #dscam003#47 = "S";
            Total    = Total    - #dscam003#23;
            TotalDiv = TotalDiv - #dscam003#61;
         |SINO;
            Total    = Total    + #dscam003#31;
            TotalDiv = TotalDiv + #dscam003#65;
         |FINSI;
         aDomic   = #dscam003#7;
         aEntidad = #dscam003#8;
         aOficina = #dscam003#9;
         aDC      = #dscam003#10;
         aCta     = #dscam003#11;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE LineasAgrupa;
#dscaz001#1;
;
INICIO;
FINAL;
;
NULL, LineasAgrupa;
|FIN;

|PROCESO CompruebaTR;
   |SI #dscaz001#10 = " "; |ACABA; |FINSI;

   aCodCli = #dscaz001#5;

   |SI nTR = 0;
      nTR = #dscaz001#17;
   |SINO;
      |SI nTR ! #dscaz001#17;
         nTR = -1; |ERROR10;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE CompruebaTR;
#dscaz001#1;
;
INICIO;
FINAL;
;
NULL,  CompruebaTR;
|FIN;

|PROCESO Agrupa;
   |ABRE #dscam003;
   #dscam003#40 = #dscaz001#21;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#14 = "M";
         |MENAV "    No se pueden dividir recibos asignados a cobrador";
         |CIERRA #dscam003;
         |ACABA;
      |FINSI;
   |FINSI;
   |CIERRA #dscam003;

   |SALVA_FICHA #dscaz001;

   nLinAgrup = 0; nContz01 = 0; nDocSel = -1; |BUCLE MiraCuantosz01;
   |SI nContz01 = 0;
      |MENAV "    No hay recibos seleccionados para agrupar";
      |REPON_FICHA #dscaz001;
      |ACABA;
   |FINSI;

   |SI nSwLuxe = 1;
      |SALVA_FICHA #dscaz001;
      nTR = 0; |BUCLE CompruebaTR;
      |REPON_FICHA #dscaz001;
      |SI nTR < 0;
         #agif024@#0 = aCodCli;
         |LEE 000#agif024@.=;
         |SI FSalida ! 0; |DDEFECTO #agif024@; |FINSI;

         aAlfa = #48#17; |QBF aAlfa;
         aAlfa = aAlfa + "def/agifa091.mas";
         |CARGA_DEF aAlfa, agifa091@;
         |SI FSalida = 0;
            aAlfa = #48#17; |QBF aAlfa;
            aAlfa = aAlfa + "fich/" + (("00000" + #48#15) % -105);
            |PATH_DAT #agifa091@#aAlfa#;
            |ABRE #agifa091@;
            #agifa091@#0 = #agif024@#20;
            |LEE 000#agifa091@.=;
            |SI FSalida ! 0; |DDEFECTO #agifa091@; |FINSI;
            nTR = #agifa091@#69;
            |CIERRA #agifa091@; |DESCARGA_DEF #agifa091@;
         |FINSI;
         |MENSA "    Tipo de recibo procedente de la forma de pago del cliente";
      |SINO;
         |MENSA "    Tipo de recibo asignado por ser todos los recibos agrupados del mismo tipo";
      |FINSI;
      #dscaz006#4 = nTR;
   |SINO;
      #dscaz006#4 = #dscam051#10;
   |FINSI;

   |PUSHV 05011480;
   |BLANCO 05011480;
   |SI nSwLuxe = 1;
      fFechaHoy = ~; nCalc = fFechaHoy; nCalc = nCalc + (nSumaLuxe/nTotalLuxe);
      |SI nCalc < 0; nCalc = 0; |FINSI;
      nCalc = nCalc ! 0;
      fFechaVto = nCalc; #dscaz006#3 = fFechaVto;
      efFechaAgr = nCalc; enSwAplazAgr = 0;
   |SINO;
      #dscaz006#3 = fVtoMasAlto;
   |FINSI;
   #dscaz006#8 = ~; eaClasif = "C";
   |SI #dscam051#69 = "S";
      |C_M #dscaz006#8,1,"N";
   |SINO;
      |C_M #dscaz006#8,1,"S";
   |FINSI;

   |PINPA #0#dscaz006;
   |PINDA #0#dscaz006;
   |ENDATOS #1#dscaz006;
   |SI FSalida = 0;
      |ABRE #dscam003;
      |LEE 000#dscam003.u; #dscaz006#7 = #dscam003#40 + 1;
      #dscam003#40 = nDocSel;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         #dscam003#40 = #dscaz006#7;
         |GRABA 020#dscam003.b;

         #dscam003#0 = #dscaz006#0;
         #dscam003#27 = 0;
         #dscam003#1  = 0;
         #dscam003#2  = 0;
         #dscam003#49 = "S";
         #dscam003#14 = "P";
         #dscam003#15 = "Pendiente de cobro";
         #dscam003#26 = "01.01.0000";
         #dscam003#17 = 0; #dscam003#37 = 0;
         #dscam003#48 = "N";
         #dscam003#82 = "N";
         #dscam003#83 = 0;
         #dscam003#90 = "N";
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |FINSI;

      Total = 0; TotalDiv = 0;
      aEntidad = ""; aOficina = ""; aDC = ""; aCta = "";
      nGtosArrastradosD = 0; nGtosArrastradosB = 0;
      nSwOpcion = 3; |BUCLE LineasAgrupa;

      #dscam003#40 = #dscaz006#7;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         #dscam003#7  = aDomic;
         #dscam003#8  = aEntidad;
         #dscam003#9  = aOficina;
         #dscam003#10 = aDC;
         #dscam003#11 = aCta;
         #dscam003#3  = #dscaz006#3;
         #dscam003#12 = #dscaz006#4;
         #dscam003#13 = #dscaz006#5;
         #dscam003#4  = #dscaz006#8;
         #dscam003#47 = "N";
         #dscam003#22 = Total; #dscam003#60 = TotalDiv;
         #dscam003#30 = Total; #dscam003#64 = TotalDiv;
         #dscam003#31 = Total; #dscam003#65 = TotalDiv;
         #dscam003#23 = 0;     #dscam003#61 = 0;
         #dscam003#24 = 0;
         #dscam003#25 = 0;
         #dscam003#38 = 0;
         #dscam003#54 = 0;
         #dscam003#55 = 0;
         |SI #dscam003#60 = 0; |Y #dscam003#22 = 0;
          |Y #dscam003#30 = 0; |Y #dscam003#64 = 0;
            #dscam003#14 = "N";
            #dscam003#15 = "Recibo cancelado";
         |SINO;
            #dscam003#14 = "P";
            #dscam003#15 = "Pendiente de cobro";
         |FINSI;
         #dscam003#101 = nGtosArrastradosD;
         #dscam003#102 = nGtosArrastradosB;

         eaUsuario = Usuario % 0810;
         eaDescr   = "AGRUPACION DOCUMENTO VENTA (" + (("000000000" + #dscam003#40) % -109) + ")";
         eaTipoReg = "AV";  eaNumero = ("000000000" + #dscam003#40) % -109;
         eaTipoOp  = "A";   enImpAnt = 0; enImpAct = Total;
         |HAZ GrabaAudit;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;

         |SALVA_FICHA #dscaz001;
         |LEE 000#dscaz001.u; Linea = #dscaz001#0;
         |REPON_FICHA #dscaz001;
         |HAZ GrabaRecibo;
      |FINSI;
      |CIERRA #dscam003;

      |SI enSwAplazAgr = 1;
         |HAZ Tipo9;
         enDocumento = #dscaz006#7;
         efFechaOri  = fVtoMasAlto;
         efFechaApl  = #dscaz006#3; |HAZ Aplaza;
         |HAZ Tipo8;
      |FINSI;

      |REPON_FICHA #dscaz001;
      nSwOpcion = 1; |BUCLE LineasAgrupa;

      |POPV;
      |PONCONTROL 23, "si";
   |SINO;
      enSwAplazAgr = 0;
      || nSwOpcion = 2; |BUCLE LineasAgrupa;
      |REPON_FICHA #dscaz001;
      |POPV;
      ||PONCONTROL 23, "si";
   |FINSI;
|FPRC;

|PROCESO Puntos; |TIPO 6;
   nTecla = FSalida;
   aAlfa = #Fichero@#Campo#; |QBF aAlfa;
   aAlfa = aAlfa - ".";
   |PARA; |SI FSalida ! 0; |HACIENDO;
      nCalc = ((FSalida / 100) ! 0) + 99; aAlfa1 = aAlfa % nCalc;
      nCalc = FSalida + 98;               aAlfa2 = aAlfa % nCalc;
      aAlfa = aAlfa1 + aAlfa2; |QBF aAlfa;
      aAlfa = aAlfa % 0; nCalc = aAlfa;
      nCalc = MaxDigit - nCalc; |SI nCalc < 0; nCalc = 0; |FINSI;
      aAlfa = "0" * nCalc;
      aAlfa = aAlfa1 + aAlfa + aAlfa2;

      aAlfa = aAlfa - ".";
   |SIGUE;

   #Fichero@#Campo# = aAlfa; |PINTA #Fichero@#Campo#;
   FSalida = nTecla;
|FPRC;

|PROCESO ConsultaCtas;
   #Referen@#0 = #dscaw171#0;
   |LEE 000#Referen@.];
   |CONSULTA_CLAVE #1#Referen@;
   |SI FSalida = 0;
      #dscaw171#0 = #Referen@#0; |PINTA #dscaw171#0;
      |PINTA 2031, #Referen@#2;
   |FINSI;
|FPRC;

|PROCESO CompruebaCta;
   |SI FSalida = 10; |HAZ ConsultaCtas; |ERROR; |ACABA; |FINSI;

   #Referen@#0 = #dscaw171#0;
   |LEE 000#Referen@.=;
   |SI FSalida ! 0;
      |MENAV "    Cuenta inexistente"; |ERROR;
   |SINO;
      #dscaw171#0 = #Referen@#0; |PINTA #dscaw171#0;
      |PINTA 2031, #Referen@#2;
   |FINSI;
|FPRC;

|PROCESO MarcaLin;
   |SI #dscaz001#31 ! "          "; |O #dscaz001#33 ! "    "; |ACABA; |FINSI;

   #dscaz001#13 = #dscaw171#0;
   #dscaz001#14 = #dscaw171#1;
   #dscaz001#38 = #dscaw171#2;
   #dscaz001#30 = #dscaw171#3;
   |GRABA 020#dscaz001.a;
|FPRC;

|DEFBUCLE MarcaLin;
#dscaz001#1;
10;
00001, "*";
99999, "*";
be;
NULL, MarcaLin;
|FIN;

|PROCESO PideCtaYVto;
   |SI nTotalEfe = 0;
      |MENAV "    No hay recibos marcados";
      |ACABA;
   |FINSI;

   |SI nConfirmes = 1;
      SwError2 = 0;
      |HAZ RevisaRecs;
      |SI SwError2 < 0; |ACABA; |FINSI;

      nSwCambia = 0;
      |SI aCuentaCob = "";
         #dscaw171#0 = #dscaz001#13;
      |SINO;
         #dscaw171#0 = aCuentaCob;
      |FINSI;
      #dscaw171#1 = fFechaVto1;
   |SINO;
      nSwCambia = 0;
      #dscaw171#0 = #dscaz001#13;
      #dscaw171#1 = #dscaz001#14;
   |FINSI;

   |SI #dscam051#1 = "S";
        |C_M #dscaw171#3, 1, "S";
        #dscaw171#3 = #dscam051#21;
   |SINO;
        |C_M #dscaw171#3, 1, "N";
   |FINSI;


   |PUSHV 0501 2380;
   |PINPA #0#dscaw171;
   |PINDA #0#dscaw171;

   aAlfa = #48#16; |QBF aAlfa;
   aAlfa = aAlfa + "def/cacuenta.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      aAlfa = #48#16; |QBF aAlfa;
      aAlfa = aAlfa + "fich/" + (("00000" + #48#14) % -105) + #48#19 + "/";
      |PATH_DAT #Referen@#aAlfa#;
      |ABRE #Referen@;

      #Referen@#0 = #dscaw171#0;
      |LEE 000#Referen@.=;
      |SI FSalida ! 0; |DDEFECTO #Referen@; |FINSI;
      |PINTA 2031, #Referen@#2;

      |ENDATOS #1#dscaw171;
      |SI FSalida = 0;
         |PINTA 2031, #Referen@#2;

         nSwCambia = 1;
         |SALVA_FICHA #dscaz001;
         |BUCLE MarcaLin;
         |REPON_FICHA #dscaz001;
      |SINO;
         |MENAV "    Proceso cancelado";
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
   |POPV;

   |SI nSwCambia = 1; |PONCONTROL 23, "si"; |FINSI;
|FPRC;

|PROCESO CobroConfirmado;
   |PUSHV 0501 2380;
   |DDEFECTO #dscaw173;
   #dscaw173#3 = #dscaz001#11;
   #dscaw173#5 = #dscam051#127;
   #dscaw173#8 = #dscaz001#17;
   |PINPA #0#dscaw173; |PINDA #0#dscaw173;
   |ENDATOS #1#dscaw173;
   |SI FSalida = 0;
      |SI #dscaz001#33 ! "    "; |O #dscaz001#10 ! "P"; |ACABA; |FINSI;
      #dscaz001#10 = "*";
      HaySelec     = HaySelec    + 1;
      HaySelCobCf  = 0;

      |ABRE #dscam014;
      #dscam014#0 = #dscaw173#6;
      |LEE 000#dscam014.=;
      |SI FSalida ! 0; |DDEFECTO #dscam014; |FINSI;
      |CIERRA #dscam014;

      #dscaz001#13 = #dscam014#10;
      #dscaz001#14 = #dscaw173#3;
      #dscaz001#31 = #dscaw173#2;
      #dscaz001#32 = #dscaw173#3;
      #dscaz001#33 = #dscaw173#0;
      #dscaz001#34 = #dscaw173#4;
      #dscaz001#35 = "COBROCONFIRM";
      #dscaz001#36 = #dscaz001#9;
      #dscaz001#30 = #dscaw173#5;
      efFechaDiv = #dscaz001#14; Divisa = #dscaz001#26; |HAZ TomaDecim;
      #dscaz001#28 = CambioDivVn;
      #dscaz001#42 = #dscaw173#6;
      #dscaz001#14 = #dscaw173#7;
      |SI nSwArtenvas = 1; #dscaz001#17 = #dscaw173#8; |FINSI;
      |GRABA 020#dscaz001.a;

      eaVarLog = "Agregado el documento n§ " + #dscaz001#21 + " al cobro confirmado " + #dscaz001#33 + "/" + #dscaz001#34; |HAZ AnyadeLog;
   |FINSI;
   |POPV;
|FPRC;

|PROCESO MarcaDesmarca; |TIPO 11;
   |SI nSwRepre = 1;
      |MENSA "    <F10> Cambio de clave";
   |SINO;
      |BLIN 4;
   |FINSI;

   |SI aCobrad ! "";
      |ATRI R; |PINTA 0744, "<F6> Volcar asignacion ";
               |PINTA 0567, "             "; |ATRI N;
   |FINSI;
   nSwLineas = 0;
   |SI FSalida = 11;
      |SALVA_FICHA #dscaz001;
      |PONCONTROL 23,"si";
      |BUCLE MarcaTodos;
      |LEE 000#dscaz001.p; |REPON_FICHA #dscaz001;
      nSwLineas = 1;
   |FINSI;
   |SI FSalida = 12;
      |SALVA_FICHA #dscaz001;
      |PONCONTROL 23,"si";
      |BUCLE DesmarcaTodos;
      |LEE 000#dscaz001.p; |REPON_FICHA #dscaz001;
      nSwLineas = 1; HaySelCobCf = 0;
      #dscaw079#0 = nTotalEfe; #dscaw079#1 = nTotalPag;
      |PINTA 0947, #dscaw079#0; |PINTA 0967, #dscaw079#1;
   |FINSI;
   |SI FSalida = 13;
      |SI HaySelecPag = 0; |O nTotalPag = 0;
         |MENAV "    Debe haber seleccionado algun recibo";
         |ERROR;
      |SINO;
         |SI HaySelCobCf ] 1;
            |SI #dscam051#126 = "S";
               |SI nConfirmes = 0;
                  aAlfa = "    N" + &191 + "Es un cobro confirmado ?";
                  |CONFI aAlfa;
                  |SI FSalida = 0;
                     nSwCobConf = 1;
                  |SINO;
                     nSwCobConf = 0;
                  |FINSI;
               |SINO;
                  nSwCobConf = 1;
               |FINSI;
            |SINO;
               nSwCobConf = 0;
            |FINSI;
         |SINO;
            nSwCobConf = 0;
         |FINSI;

         |SI nSwCobConf = 0;
            SwError1 = 0; CtaCliente = ""; CodCliente = "";
            |SALVA_FICHA #dscaz001;
            |BUCLE RevisaClientes;
            |LEE 000#dscaz001.p; |REPON_FICHA #dscaz001;
            |SI #dscam051#33 = "N";
               |SI SwError1 = 0;
                  |HAZ AsignaATalon;
               |SINO;
                  |SI SwError1 = 1;
                     |MENAV "    Se esta intentando hacer un talon/pagare de varios clientes";
                     |ERROR;
                  |FINSI;
                  |SI SwError = 2;
                     |MENAV "    Existen documentos con tipos de recibo no permitidos para talones/pagares de clientes";
                     |ERROR;
                  |FINSI;
               |FINSI;
            |SINO;
               |HAZ AsignaATalon;
            |FINSI;
         |SINO;
            eaTipoClas = "";
            || Busco el documento marcado con la P
            |SALVA_FICHA #dscaz001;
            |LEE 000#dscaz001.p;
            |PARA; |SI FSalida = 0; |HACIENDO;
               |SI #dscaz001#10 = "P"; eaTipoClas = #dscaz001#17; |SAL; |FINSI;
               |LEE 000#dscaz001.s;
            |SIGUE;
            |REPON_FICHA #dscaz001;

            || Compruebo si el tipo de recibo puede ser talon/pagare ...
            |SI eaTipoClas ! "";
               enSwClas   = 1; eaFichClas = "dscaz001"; |HAZ CompruebaClas;
               |SI eaFichClas = "ERROR";
                  |MENAV "    El documento tiene un tipo de recibo no permitidos para cobros confirmados";
                  |ERROR;
               |SINO;
                  |SI nConfirmes = 0;
                     |HAZ CobroConfirmado;
                  |SINO;
                     |HAZ AsignaATalon;
                  |FINSI;
               |FINSI;
            |SINO;
               |SI nConfirmes = 0;
                  |HAZ CobroConfirmado;
               |SINO;
                  |HAZ AsignaATalon;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   |SI FSalida = 14; |Y aCobrad ! "";
      |PUSHV  0929 1251;
      |BLANCO 0929 1251;
      |CUADRO 1030 1250;
      |ATRI R; |PINTA 1035, " Asignacion "; |ATRI N;
      |ABRE #dscam016;
      |DDEFECTO #dscam016; |PINTA 1139, #dscam016#0;
      aAlfa = "    <F2> Consulta asignaciones cobrador '" + aCobrad + "'";
      |MENSA aAlfa;
|ET Vuelta1;
      E_sup = 99999; E_inf = "";
      nAsign = 1139 ? 1;
      |SI FSalida = 0;
         |CONFI "    SEs correcto ? ";
         |SI FSalida = 0;
            |ABRE #dscam016;
            #dscam016#0 = nAsign;
            |LEE 000#dscam016.=;
            |SI FSalida = 0;
               |SI #dscam016#1 = aCobrad;
                  nAsignacion = #dscam016#0;
                  |SALVA_FICHA #dscaz001;
                  |BUCLE LineasAsigna;
                  |REPON_FICHA #dscaz001;
                  |PONCONTROL 23, "si";
               |SINO;
                  aAlfa = "    Esta asignacion no es del cobrador '" + aCobrad + "'";
                  |MENAV aAlfa;
                  |VETE Vuelta1;
               |FINSI;
            |FINSI;
            |DDEFECTO #dscaw079;
            |HAZ PintaTotales;
            |CIERRA #dscam016;
         |FINSI;
      |SINO;
         |SI FSalida = 10;
            #dscam016#0 = nAsign;
            |LEE 000#dscam016.];
            |CONSULTA_CLAVE #1#dscam016;
            |SI FSalida = 0;
               nAsign = #dscam016#0;
            |FINSI;
            |VETE Vuelta1;
         |SINO;
            |SI FSalida ! 7;
               |VETE Vuelta1;
            |FINSI;
         |FINSI;
      |FINSI;
      |POPV;
      |BLIN 4;
      |CIERRA #dscam016;
   |FINSI;

   |SI FSalida = 9;
         #dscam003#40 = #dscaz001#21;
         |LEE 020#dscam003.=;

         |HAZ MarcaDesm;
   |FINSI;

   |SI FSalida = 10;
      |SI nConfirmes = 0;
         |SALVA_FICHA #dscaz001;
         |HAZ MarcaDesmPag;
         |REPON_FICHA #dscaz001;
         |LEE 000#dscaz001.c;
      |SINO;
         |SALVA_FICHA #dscaz001;
         |HAZ MarcaDesmPag;
         |REPON_FICHA #dscaz001;
         |LEE 000#dscaz001.c;
      |FINSI;
   |FINSI;
   |SI FSalida = 14; |Y nConfirmes = 0; |HAZ MarcaDesmAgr; |FINSI;
   |SI FSalida = 15; |Y nConfirmes = 0; |Y aCobrad = "";   |HAZ Agrupa;       |FINSI;
   |SI FSalida = 16; |Y nConfirmes = 0; |HAZ Divide; |FINSI;
   |SI FSalida = 17; |Y nConfirmes = 0;
      |SALVA_FICHA #dscam003;
      #dscam003#40 = #dscaz001#21;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         |SI #dscam003#49 = "S"; |O #dscam003#82 = "S";
            |HAZ SacaCarta;
         |SINO;
            |MENAV "    El recibo seleccionado no est  ni agrupado ni dividido";
         |FINSI;
      |FINSI;
      |REPON_FICHA #dscam003;
   |FINSI;
   |SI FSalida = 18;
      |SI nSwRepre = 1;
         nSwSal = 0; |ERROR; |PTEC 807; |ACABA;
      |SINO;
         |HAZ PideCtaYVto;
      |FINSI;
   |FINSI;
   Divisa = #dscaz001#26; |HAZ Tipo13;

   |HAZ PintaTotales;

   |SI nSwLineas = 1; |PONCONTROL 23, "SI"; |FINSI;
|FPRC;

|PROCESO MarcaSec;
   #dscaw043#6 = -1; |GRABA 020#dscaw043.a;
|FPRC;

|DEFBUCLE MarcaSec;
#dscaw043#1;
6;
00001,nNumSec;
99999,nNumSec;
;
NULL,MarcaSec;
|FIN;

|PROCESO LineaCaja;
   || Determino la empresa de contabilidad
   |DBASS aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "contagen/def/canempre.mas";
   |CARGA_DEF aAlfa, canempre@;
   |SI FSalida = 0;
      |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "contagen/fich/";
      |PATH_DAT #canempre@#aAlfa#;
      |ABRE #canempre@;

      |DFICB aAlfa; |QBF aAlfa; |PATH_DAT #dscam043#aAlfa#;
      |ABRE #dscam043;
      |SELECT #2#dscam043;
      #dscam043#9 = #48#0;
      |LEE 000#dscam043.];
      |PARA; |SI FSalida = 0; |HACIENDO;
         #canempre@#2 = #dscam043#0;
         #canempre@#3 = #dscam043#1;
         |LEE 000#canempre@.=;
         |SI FSalida = 0;
            nAnyo = #canempre@#26;
            |SI nAnyo > 80;
               nAnyo = nAnyo + 1900;
            |SINO;
               nAnyo = nAnyo + 2000;
            |FINSI;
            aAlfa = #dscam004#6; |QBF aAlfa;
            aAlfa = aAlfa % -104; nCalc = aAlfa;
            |SI nAnyo = nCalc; |Y #dscam004#0 ] #dscam043#7;
             |Y #dscam004#0 [ #dscam043#8; |Y #dscam043#3 = "V";
               |SI #canempre@#34 > #dscam004#6; |Y #canempre@#34 ! "01.01.0000";
                  aAlfa = "    Empresa contable bloqueada a fecha " + #canempre@#34;
                  |MENAV aAlfa;
               |SINO;
                  |SAL;
               |FINSI;
            |FINSI;
         |FINSI;
         |LEE 000#dscam043.s;
      |SIGUE;

      |SI FSalida ! 0; |O nAnyo ! nCalc; |O #dscam004#0 < #dscam043#7; |O #dscam004#0 > #dscam043#8;
         |MENAV "    No encuentro la empresa contable asociada a esta empresa de cartera.";
         |SELECT #1#dscam043; |CIERRA #dscam043;
         |CIERRA #canempre@; |DESCARGA_DEF #canempre@;
         |ACABA;
      |SINO;
         |SI #canempre@#34 > #dscam004#6; |Y #canempre@#34 ! "01.01.0000";
            |MENAV "    No encuentro la empresa contable asociada a esta empresa de cartera.";
            |SELECT #1#dscam043; |CIERRA #dscam043;
            |CIERRA #canempre@; |DESCARGA_DEF #canempre@;
            |ACABA;
         |FINSI;
      |FINSI;
      |SELECT #1#dscam043;
      |CIERRA #dscam043;

      |ABRE #dscam165;
      |LEE 000#dscam165.p;
      |SI FSalida ! 0; |DDEFECTO #dscam165; |FINSI;
      |CIERRA #dscam165;

      |DBASS aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "contagen/def/cajainca.mas";
      |CARGA_DEF aAlfa, cajainca@;
      |SI FSalida = 0;
         |DBASS aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "contagen/def/cajainli.mas";
         |CARGA_DEF aAlfa, cajainli@;
         |SI FSalida = 0;
            |DBASS aAlfa; |QBF aAlfa;
            aAlfa = aAlfa + "contagen/def/caconasi.mas";
            |CARGA_DEF aAlfa, caconasi@;
            |SI FSalida = 0;
               |DBASS aAlfa; |QBF aAlfa;
               aAlfa = aAlfa + "contagen/fich/" + (("00000" + #dscam043#0) % -105) + #dscam043#1 + "/";
               |PATH_DAT #cajainca@#aAlfa#; |PATH_DAT #cajainli@#aAlfa#; |PATH_DAT #caconasi@#aAlfa#;

               |ABRE #cajainca@; |ABRE #cajainli@;
               |ABRE #caconasi@;

               #canempre@#2 = #dscam043#0;
               #canempre@#3 = #dscam043#1;
               |LEE 000#canempre@.=;
               |SI FSalida ! 0; |DDEFECTO #canempre@; |FINSI;

               #cajainca@#1 = #dscam004#6;
               |LEE 101#cajainca@.=;
               |SI FSalida ! 0;
                  |DDEFECTO #cajainca@;
                  #cajainca@#0 = #dscam165#1;
                  #cajainca@#1 = #dscam004#6;

                  |DDEFECTO #caconasi@;
                  |LEE 101#caconasi@.p;
                  |SI FSalida = 0;
                     #caconasi@#1 = #caconasi@#1 + 1;
                     #cajainca@#4 = #caconasi@#1;
                     |GRABA 020#caconasi@.a; |LIBERA #caconasi@;
                  |FINSI;

                  |GRABA 020#cajainca@.b;
               |FINSI;

               nApunte = 1;
               #cajainli@#1 = #cajainca@#1;
               #cajainli@#3 = 1;
               |LEE 000#cajainli@.];
               |PARA; |SI FSalida = 0; |Y #cajainli@#1 = #cajainca@#1; |HACIENDO;
                  nApunte = #cajainli@#3 + 1;
                  |LEE 000#cajainli@.s;
               |SIGUE;
               |DDEFECTO #cajainli@;
               #cajainli@#0 = #cajainca@#0;
               #cajainli@#1 = #cajainca@#1;
               #cajainli@#2 = #cajainca@#4;
               #cajainli@#3 = nApunte;
               #cajainli@#4 = #dscam003#5; || Cuenta Cliente
               aAlfa = #dscam004#4; |QBF aAlfa;
               aLong = aAlfa % 0; nLong = aLong;
               #cajainli@#5 = 0;
               |PARA nCont = 14; |SI nCont [ 19; |HACIENDO nCont = nCont + 1;
                  |SI nLong = #canempre@#nCont#;
                     #cajainli@#5 = nCont - 13; |SAL;
                  |FINSI;
               |SIGUE;
               #cajainli@#6  = #dscam165#2;
               aAlfa = #dscam165#3; |QBF aAlfa; aAlfa = aAlfa + " DOCUMENTO N§ " + #dscam004#17;
               #cajainli@#7  = aAlfa;
               #cajainli@#8  = "C";
               #cajainli@#9  = #dscam004#8;
               #cajainli@#13 = "C";
               #cajainli@#14 = #dscam003#27;
               #cajainli@#15 = #dscam003#1;
               #cajainli@#16 = #dscam003#0;
               #cajainli@#17 = #dscam003#2;
               |GRABA 020#cajainli@.n;

               aAlfa = "Grabando desde cartera en el diario de caja de fecha " + #cajainli@#1 + " de la contabilidad [" + (("00000" + #canempre@#2) % -105) + "/" + #canempre@#3 + "] la linea numero " + nApunte;
               aAlfa = aAlfa + " [" + #cajainli@#7; |QBF aAlfa;
               aAlfa = aAlfa + "]";
               |HAZ IncorporaLog;

               #cajainca@#3 = #cajainca@#3 + #cajainli@#9;
               |GRABA 020#cajainca@.a; |LIBERA #cajainca@;

               |CIERRA #cajainli@; |CIERRA #cajainca@;
               |CIERRA #caconasi@; |DESCARGA_DEF #caconasi@;

               #dscam004#56 = nApunte;
            |FINSI;
            |DESCARGA_DEF #cajainli@;
         |FINSI;
         |DESCARGA_DEF #cajainca@;
      |FINSI;
      |CIERRA #canempre@; |DESCARGA_DEF #canempre@;
   |FINSI;
|FPRC;

|PROCESO Volcado;
   nNumSec = #dscaz001#37;

   Divisa = #dscaz001#26; |HAZ Tipo13;
   DifCambio = (1/#dscaz001#28) - (1/#dscaz001#29);

   |SI #dscaz001#31 = "          ";
      #dscam004#17 = #dscaz001#21;
      #dscam004#3 = 99;
      |LEE 000#dscam004.];
      |SI FSalida ! 0;
         |LEE 000#dscam004.u;
         |SI FSalida = 0; |Y #dscam004#17 = #dscaz001#21;
            LinCob = #dscam004#3 + 1;
         |SINO;
            LinCob = 1;
         |FINSI;
      |SINO;
         |SI #dscam004#17 = #dscaz001#21;
            LinCob = #dscam004#3 + 1;
         |SINO;
            |LEE 000#dscam004.a;
            |SI FSalida = 0; |Y #dscam004#17 = #dscaz001#21;
               LinCob = #dscam004#3 + 1;
            |SINO;
               LinCob = 1;
            |FINSI;
         |FINSI;
      |FINSI;

      |DDEFECTO #dscaw175;
      #dscaw175#0 = #dscaz001#21;
      #dscaw175#1 = LinCob;
      |GRABA 020#dscaw175.n;

      #dscam003#40 = #dscaz001#21;
      |LEE 020#dscam003.=;
      |SI FSalida ! 0; |DDEFECTO #dscam003; |FINSI;

      |DDEFECTO #dscam004;
      #dscam004#17 = #dscaz001#21;
      #dscam004#3  = LinCob;
      |GRABA 020#dscam004.b;

      #dscam004#15 = #dscaz001#20;
      #dscam004#0  = #dscaz001#1;
      #dscam004#1  = #dscaz001#2;
      #dscam004#2  = #dscaz001#3;
      #dscam004#4  = #dscaz001#13;

      |SI nSwArtenvas = 1; #dscam003#14 = "M"; |Y #dscaz001#43 = "S";
         #dscam004#5  = "RCB";

         |ABRE #dscam016; |ABRE #dscam017;
         |SELECT #2#dscam017;
         #dscam017#9 = #dscaz001#21;
         |LEE 101#dscam017.=;
         |SI FSalida = 0;
            #dscam016#0 = #dscam017#0;
            |LEE 101#dscam016.=;
            |SI FSalida = 0;
               enDocumto = #dscam017#9; |HAZ BajaFechaVisita;

               #dscam016#3 = #dscam016#3 - 1;
               #dscam016#4 = #dscam016#4 - #dscam017#7;
               |SI #dscam016#3 = 0;
                  |BORRA 020#dscam016.a;
               |SINO;
                  |GRABA 020#dscam016.a; |LIBERA #dscam016;
               |FINSI;

               |BORRA 020#dscam017.a; |LIBERA #dscam017;
            |FINSI;
         |FINSI;
         |SELECT #1#dscam017;
         |CIERRA #dscam016; |CIERRA #dscam017;
      |SINO;
         |SI aCobrad = "";
            |SI #dscam003#14 = "p";
               #dscam004#5  = "RAC";
               #dscaz001#38 = "Entrega a cuenta"; || Para que luego se grabe en
                                                  ||   el campo observaciones de
                                                  ||   la linea
            |SINO;
               |SI #dscaz001#7 [ #dscaz001#8;
                  #dscam004#5  = "COB";
               |SINO;
                  #dscam004#5  = "COP";
               |FINSI;
            |FINSI;
         |SINO;
            #dscam004#5  = "RCB";
         |FINSI;
      |FINSI;

      #dscam004#6  = #dscaz001#14;

/**************** no se para que esta esto JUAN
      #dscam003#40 = #dscaz001#21;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         #dscam004#7  = #dscam003#23;
         #dscam004#25 = #dscam003#61;
      |FINSI;
*****************************************/
      nSwExceso = 0;
      |SI #dscaz001#7 > 0;
            |SI #dscaz001#8 > #dscaz001#7; ||Y nSwArtenvas = 1;
               nSwExceso = 1;
               enImpExceso = #dscaz001#8 - #dscaz001#7;
               #dscaz001#8 = #dscaz001#7;
            |FINSI;

            || Tiquet 1254-2122
            || cobrado < pendiente, le restos los gastos si son negativos
            |SI #dscaz001#8 < #dscaz001#7;
               |SI #dscaz001#15 < 0;
                    #dscaz001#8 = #dscaz001#8 - #dscaz001#15;
               |FINSI;
               |SI #dscaz001#19 < 0;
                    #dscaz001#8 = #dscaz001#8 - #dscaz001#19;
               |FINSI;
            |FINSI;

      |SINO;         || Tiquet 4120/72
           |SI #dscaz001#8 < #dscaz001#7; ||Y nSwArtenvas = 1;
               nSwExceso = 1;
               enImpExceso = #dscaz001#8 - #dscaz001#7;
               #dscaz001#8 = #dscaz001#7;
            |FINSI;
      |FINSI;

      #dscam004#8  = #dscaz001#8;
      #dscam004#26 = #dscaz001#8 / #dscaz001#28;

      #dscam004#11 = #dscaz001#16;

      #dscam004#12 = #dscaz001#15;
      #dscam004#29 = #dscaz001#15 / #dscaz001#28;

      #dscam004#14 = #dscaz001#19;
      #dscam004#31 = #dscaz001#19 / #dscaz001#28;

      #dscam004#15 = #dscaz001#20;
      |SI #dscaz001#25 = "D";
         #dscam004#23 = #dscaz001#7 - #dscaz001#8;
         #dscam004#32 = #dscam004#23 / #dscaz001#28;
         #dscam004#22 = "D";
      |FINSI;
      |SI #dscaz001#25 = "E";
         #dscam004#23 = #dscaz001#7 - #dscaz001#8;
         #dscam004#32 = #dscam004#23 / #dscaz001#28;
         #dscam004#22 = "E";
      |FINSI;

      || #dscam004#24 = #dscaz001#8 * DifCambio;
      #dscam004#24 = #dscam004#26 - #dscam004#29 - #dscam004#31;
      #dscam004#24 = #dscam004#24 - ((#dscam004#8 - #dscam004#12 - #dscam004#14) / #dscaz001#29);
      #dscam004#33 = #dscaz001#28;     ||Cambio Actual
      #dscam004#43 = nNumSec;
      #dscam004#16 = #dscaz001#38;
      |SI #dscaz001#39 ! " "; #dscam004#54 = #dscaz001#17; |FINSI;
/*
   Corregido Tiquet: 1254-2122 (subtiquet:25)
      #dscam004#7  = #dscam004#26 + #dscam004#29 + #dscam004#31;
      #dscam004#25 = #dscam004#8 + #dscam004#12 + #dscam004#29 + #dscam004#14;
*/
      #dscam004#7  = #dscam004#8 + #dscam004#12 + #dscam004#14;
      #dscam004#25  = #dscam004#26 + #dscam004#29 + #dscam004#31;


      |GRABA 020#dscam004.a; |LIBERA #dscam004;

      |SI nSwLuxe = 1;
         |LEE 101#dscam004.=;
         |SI FSalida = 0;
            aAlfa = #dscam004#4; |QBF aAlfa;
            aAlfa = aAlfa % 0103;
            |SI aAlfa = "570";
               #dscam003#40 = #dscaz001#21;
               |LEE 000#dscam003.=;
               |SI FSalida ! 0; |DDEFECTO #dscam003; |FINSI;

               |HAZ LineaCaja;
               #dscam004#55 = "S";
               #dscam004#56 = nApunte;
               |GRABA 020#dscam004.a;
            |FINSI;
            |LIBERA #dscam004;
         |FINSI;
      |FINSI;

      |HAZ EsAgrogenil;
      |SI FSalida = 0;
         |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/dscagm01.mas";
         |CARGA_DEF aAlfa, dscagm01@
         |SI FSalida = 0;
            |DFICE aAlfa; |PATH_DAT #1000 aAlfa;
            |ABRE #dscagm01@;
            #dscagm01@#7 = #dscaz001#21;
            #dscagm01@#8 = 0;
            |LEE 000#dscagm01@.=;
            |SI FSalida = 0;
               |SALVA_DATOS #dscagm01@; |BORRA 020#dscagm01@.a; |REPON_DATOS #dscagm01@;
               #dscagm01@#8 = LinCob;
               |GRABA 020#dscagm01@.n;
            |FINSI;
            |CIERRA #dscagm01@; |DESCARGA_DEF #dscagm01@;
         |FINSI;
      |FINSI;

      eaUsuario = Usuario % 0810;
      |SI #dscaz001#7 = #dscaz001#8;
         eaDescr   = "ALTA COBRO (" + (("000000000" + #dscam004#17) % -109) + "/" + (("000" + #dscam004#3) % -103);
      |SINO;
         eaDescr   = "ALTA COBRO PARCIAL (" + (("000000000" + #dscam004#17) % -109) + "/" + (("000" + #dscam004#3) % -103);
      |FINSI;
      eaDescr   = eaDescr + ") DESDE CONTROL DE COBROS";
      eaTipoReg = "CB";  eaNumero = ("000000000" + #dscam004#17) % -109;
      eaTipoOp  = "A";   enImpAnt = #dscam004#7; enImpAct = #dscam004#8;
      |HAZ GrabaAudit;

      #dscam003#40 = #dscaz001#21;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         |SI #dscam003#14 = "I";
            nSwImp = 1;
         |SINO;
            nSwImp = 0;
         |FINSI;
         #dscam003#56 = #dscam003#56 + #dscam004#24;
         #dscam003#26 = #dscaz001#14;

         || Liquidado
         #dscam003#23 = #dscam003#23 + #dscaz001#8 + #dscaz001#19 + #dscaz001#15;
         #dscam003#61 = #dscam003#61 + ((#dscaz001#8+#dscaz001#19+#dscaz001#15) / #dscaz001#28);


         || G.Negociacion
         #dscam003#24 = #dscam003#24 + #dscaz001#15;
         #dscam003#62 = #dscam003#62 + (#dscaz001#15 / #dscaz001#28);

         || G.Otros
         #dscam003#38 = #dscam003#38 + #dscaz001#19;
         #dscam003#66 = #dscam003#66 + (#dscaz001#19 / #dscaz001#28);

         |SI #dscaz001#25 = "D";
            || Imp.Dto
            #dscam003#54 = #dscam003#54 + (#dscaz001#7 - #dscaz001#8);
            #dscam003#67 = #dscam003#67 + ((#dscaz001#7 - #dscaz001#8) / #dscaz001#28);
         |FINSI;
         |SI #dscaz001#25 = "E";
            ||Imp.Desprecio
            #dscam003#55 = #dscam003#55 + (#dscaz001#7 - #dscaz001#8);
            #dscam003#68 = #dscam003#68 + ((#dscaz001#7 - #dscaz001#8) / #dscaz001#28);
         |FINSI;

         ||Total Recibo
         #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
         #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);

         #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
         #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);

         ||Total Pendiente
         #dscam003#31 = #dscam003#30 - #dscam003#23;
         #dscam003#65 = #dscam003#64 - #dscam003#61;

         aEstadoAnt = #dscam003#14;

         |SI #dscam003#31 = 0;
            |SI aEstadoAnt = "p";
               #dscam003#14 = "e";
               #dscam003#15 = "Pendiente de compensar";
            |SINO;
               #dscam003#14 = "L";
               #dscam003#15 = "Recibo Liquidado";
            |FINSI;
         |SINO;
            |SI #dscam003#23 = 0;
               |SI #dscam003#16 = 0;
                  #dscam003#14 = "P";
                  #dscam003#15 = "Pendiente de cobro";
               |SINO;
                  #dscam003#14 = "I";
                  #dscam003#15 = "Impagado";
               |FINSI;
            |SINO;
               |SI aCobrad = "";
                  #dscam003#14 = "C";
                  #dscam003#15 = "Parcialmente cobrado";
               |FINSI;
            |FINSI;
         |FINSI;
         #dscam003#50 = #dscaz001#13;
         #dscam003#12 = #dscaz001#17;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |FINSI;

      |SI #dscam051#3 = "S"; |Y aEstadoAnt ! "F";
         || enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
         |SI PARAMETRO = "";
            enEmpCartera = -1;     enEmpGestion = #dscam003#46;
         |FINSI;
         eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
         nImporte = #dscaz001#8 / #dscaz001#28;

         /* Tiquet 1245/1968 */
         nImporte = nImporte - #dscaz001#19;
         /* */

         |SI nSwImp = 1;
            eaTipoOper = "-7";
         |SINO;
            eaTipoOper = "-4";
         |FINSI;
         |HAZ BucleRiesgo;
      |FINSI;

      |ABRE #dscam051;
      |LEE 000#dscam051.p;
      |SI FSalida ! 0;
         |DDEFECTO #dscam051;
         |GRABA 020#dscam051.n;
         |LEE 000#dscam051.p;
      |FINSI;
      |CIERRA #dscam051;

      |SI #dscam051#1 = "S"; |Y HayConta = 1; |Y #dscaz001#30 ! "    ";
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #13 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         |SI #dscaz001#37 = 0;
            Linea = 1;
            #dscaw013#15 = #dscaz001#30; #dscaw013#0  = Linea;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
            #dscaw013#5 = #dscam004#17;  #dscaw013#6  = #dscam004#17;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
            Linea = Linea + 1;
            #dscaw013#15 = #dscaz001#30; #dscaw013#0 = Linea;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
            #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
            #dscaw013#11 = "N";          #dscaw013#12 = 3;
            |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
            Linea = Linea + 1;
            #dscaw013#15 = #dscaz001#30; #dscaw013#0 = Linea;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
            #dscaw013#7 = #dscam004#6;   #dscaw013#8 = #dscam004#6;
            #dscaw013#11 = "F";          #dscaw013#12 = 10;
            |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
            |CIERRA #dscaw013;
            Comodin = #dscaz001#30; |QBF Comodin;

            Comodin = "dscam033.tab;" + Comodin;
            |LIBERA #dscam003; |CIERRAT #dscam003;
            |LIBERA #dscam004; |CIERRAT #dscam004;
            |SUB_EJECUTA_NP Comodin;
            |ABRET #dscam003; |LEE 101#dscam003.=;
            |ABRET #dscam004; |LEE 101#dscam004.=;

            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
            |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |DELINDEX #dscaw013;
         |FINSI;
      |FINSI;
      eaCliente = #dscam003#32; |HAZ MiraBloqueoRiesgo;

      |SI nSwExceso = 1; |Y nSwArtenvas = 1;
          |HAZ CreaEntrega;
      |FINSI;
   |SINO;
      |SI #dscaz001#35 ! "COBROCONFIRM";
         nCalc = #dscaz001#9 + #dscaz001#15 + #dscaz001#18;
         nSwitch = 0;
         |SI #dscaz001#8 > 0;
            |SI nCalc > #dscaz001#8; nSwitch = 1; |FINSI;
         |SINO;
            |SI nCalc < #dscaz001#8; nSwitch = 1; |FINSI;
         |FINSI;
         |SI nSwitch = 1;
            |HAZ DivideRecibo;
            #dscaz001#21 = NuevoDoc;
         |FINSI;
         #dscam004#17 = #dscaz001#21;
         #dscam004#3 = 99;
         |LEE 000#dscam004.];
         |SI FSalida ! 0;
            |LEE 000#dscam004.u;
            |SI FSalida = 0; |Y #dscam004#17 = #dscaz001#21;
               LinCob = #dscam004#3 + 1;
            |SINO;
               LinCob = 1;
            |FINSI;
         |SINO;
            |SI #dscam004#17 = #dscaz001#21;
               LinCob = #dscam004#3 + 1;
            |SINO;
               |LEE 000#dscam004.a;
               |SI FSalida = 0; |Y #dscam004#17 = #dscaz001#21;
                  LinCob = #dscam004#3 + 1;
               |SINO;
                  LinCob = 1;
               |FINSI;
            |FINSI;
         |FINSI;

         |DDEFECTO #dscam004;
         #dscam004#17 = #dscaz001#21;
         #dscam004#15 = #dscaz001#20;
         #dscam004#0  = #dscaz001#1;
         #dscam004#1  = #dscaz001#2;
         #dscam004#2  = #dscaz001#3;
         #dscam004#3  = LinCob;
         #dscam004#4  = #dscaz001#35;
         #dscam004#5  = "RPT";
         #dscam004#6  = #dscaz001#14;
         #dscam004#11 = #dscaz001#16;
         #dscam004#15 = #dscaz001#20;
         aAlfa = "Docum. " + (("0000" + #dscaz001#33) % -104) + "/" + #dscaz001#31;
         #dscam004#16 = aAlfa;
         #dscam004#33 = #dscaz001#28;
         #dscam004#43 = nNumSec;
         || #dscam004#44 = #dscaz001#8;
         #dscam004#44 = #dscaz001#36;
         #dscam004#45 = #dscam004#44 / #dscaz001#28;
         |SI #dscaz001#25 = "D"; |O #dscaz001#25 = "E";
            #dscam004#46 = #dscaz001#7 - #dscaz001#8;
         |SINO;
            #dscam004#46 = 0;
         |FINSI;
         #dscam004#47 = #dscam004#46 / #dscaz001#28;
         #dscam004#51 = #dscaz001#33;
         #dscam004#52 = #dscaz001#31;
         #dscam004#53 = #dscaz001#32;
         #dscam004#16 = #dscaz001#34;

         #dscam004#12 = #dscaz001#15;
         #dscam004#29 = #dscaz001#15 / #dscaz001#28;
         #dscam004#13 = #dscaz001#18;
         #dscam004#30 = #dscaz001#18 / #dscaz001#28;
         #dscam004#14 = #dscaz001#19;
         #dscam004#31 = #dscaz001#19 / #dscaz001#28;
         |SI #dscaz001#39 ! " "; #dscam004#54 = #dscaz001#17; |FINSI;
         |SI nSwArtenvas = 1;
            #dscam003#40 = #dscaz001#21;
            |LEE 000#dscam003.=;
            |SI FSalida = 0; #dscam004#54 = #dscam003#12; |FINSI;
         |FINSI;

         |GRABA 020#dscam004.n; |LEE 000#dscam004.=
         |SI EntidadAnt ! #dscaz001#33; |O DocumAnt ! #dscaz001#31;
            eaUsuario = Usuario % 0810;
            eaDescr   = "ALTA PAGARE/TALON ("+ (("0000" + #dscaz001#33) % -104) + "/" + (("0000000000" + #dscaz001#31) % -110) + ") DESDE CONTROL DE COBROS";
            eaTipoReg = "PT";  eaNumero = (("0000" + #dscaz001#33) % -104) + (("00000000000" + #dscaz001#31) % -110);
            eaTipoOp  = "A";   enImpAnt = 0; enImpAct = #dscaz001#36;
            |HAZ GrabaAudit;
            EntidadAnt = #dscaz001#33; DocumAnt = #dscaz001#31;
         |FINSI;

         #dscam003#40 = #dscaz001#21;
         |LEE 101#dscam003.=;
         |SI FSalida = 0;
            |SI #dscam003#14 = "M";
               |ABRE #dscam016; |ABRE #dscam017;
               |SELECT #2#dscam017;
               #dscam017#9 = #dscaz001#21;
               |LEE 101#dscam017.=;
               |SI FSalida = 0;
                  #dscam016#0 = #dscam017#0;
                  |LEE 101#dscam016.=;
                  |SI FSalida = 0;
                     enDocumto = #dscam017#9; |HAZ BajaFechaVisita;
                     #dscam016#3 = #dscam016#3 - 1;
                     #dscam016#4 = #dscam016#4 - #dscam017#7;
                     |SI #dscam016#3 = 0;
                        |BORRA 020#dscam016.a;
                     |SINO;
                        |GRABA 020#dscam016.a; |LIBERA #dscam016;
                     |FINSI;
                     |BORRA 020#dscam017.a; |LIBERA #dscam017;
                  |FINSI;
               |FINSI;
               |SELECT #1#dscam017;
               |CIERRA #dscam016; |CIERRA #dscam017;
            |FINSI;

            |SI #dscam003#12 ! #dscaz001#17;
               |SI nSwArtenvas = 1; #dscam003#12 = #dscaz001#17; |FINSI;
            |FINSI;
            #dscam003#14 = "T";
            #dscam003#15 = "Pagare/talon de cliente";
            |SI #dscaz001#25 = "D";
               #dscam003#54 = #dscam003#54 + ((#dscaz001#15 + #dscaz001#18 + #dscaz001#19 + #dscaz001#7) - #dscaz001#8);
               #dscam003#67 = #dscam003#67 + (((#dscaz001#15 + #dscaz001#18 + #dscaz001#19 + #dscaz001#7) - #dscaz001#8) / #dscaz001#28);
            |FINSI;
            |SI #dscaz001#25 = "E";
               #dscam003#55 = #dscam003#55 + ((#dscaz001#15 + #dscaz001#18 + #dscaz001#19 + #dscaz001#7) - #dscaz001#8);
               #dscam003#68 = #dscam003#68 + (((#dscaz001#15 + #dscaz001#18 + #dscaz001#19 + #dscaz001#7) - #dscaz001#8) / #dscaz001#28);
            |FINSI;
            #dscam003#25 = #dscam003#25 + #dscaz001#18;
            #dscam003#63 = #dscam003#63 + (#dscaz001#18 / #dscaz001#28);
            #dscam003#24 = #dscam003#24 + #dscaz001#15;
            #dscam003#62 = #dscam003#62 + (#dscaz001#15 / #dscaz001#28);
            #dscam003#38 = #dscam003#38 + #dscaz001#19;
            #dscam003#66 = #dscam003#66 + (#dscaz001#19 / #dscaz001#28);
            #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
            #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
            #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
            #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
            #dscam003#31 = #dscam003#30 - #dscam003#23; #dscam003#65 = #dscam003#64 - #dscam003#61;
            #dscam003#70 = #dscaz001#31;
            #dscam003#71 = #dscaz001#32;
            #dscam003#72 = #dscaz001#33;
            #dscam003#73 = #dscaz001#34;
            #dscam003#74 = #dscaz001#35;
            #dscam003#78 = #dscaz001#36;
            #dscam003#79 = #dscaz001#36 / #dscaz001#28;
            |SI #dscaz001#31 ! "          "; |O #dscaz001#33 ! "    ";
               #dscam003#90 = "S";
            |FINSI;

            #dscam003#12 = #dscaz001#17;
            |HAZ CambiaTipoRec; || Modulo LUXE
            |GRABA 020#dscam003.a; |LIBERA #dscam003;
         |FINSI;
/* Tiquet 001928-00401  ABDON
    Esta parte creaba una entrega a cuenta despues de hacer el recibo
         |SI #dscaz001#9 ! #dscaz001#8;
            #dscam066#0 = #dscaz001#21;
            |LEE 101#dscam066.=;
            |SI FSalida = 0;
               #dscam066#1 = #dscam066#1 + #dscaz001#8;
               #dscam066#2 = #dscam066#2 + (#dscaz001#8 / #dscaz001#28);
               |GRABA 020#dscam066.a; |LIBERA #dscam066;
            |SINO;
               |DDEFECTO #dscam066;
               #dscam066#0 = #dscaz001#21;
               #dscam066#1 = #dscaz001#8;
               #dscam066#2 = #dscaz001#8 / #dscaz001#28;
               |GRABA 020#dscam066.n;
            |FINSI;
         |FINSI;
*/
         SwPagTal = 1;
         eaCliente = #dscam003#32; |HAZ MiraBloqueoRiesgo;
      |SINO;
         LinCob = 1;
         #dscam004#17 = #dscaz001#21;
         #dscam004#3 = 99;
         |LEE 000#dscam004.];
         |SI FSalida ! 0;
            |LEE 000#dscam004.u;
            |SI FSalida = 0; |Y #dscam004#17 = #dscaz001#21;
               LinCob = #dscam004#3 + 1;
            |FINSI;
         |SINO;
            |SI #dscam004#17 = #dscaz001#21;
               LinCob = #dscam004#3 + 1;
            |SINO;
               |LEE 000#dscam004.a;
               |SI FSalida = 0; |Y #dscam004#17 = #dscaz001#21;
                  LinCob = #dscam004#3 + 1;
               |FINSI;
            |FINSI;
         |FINSI;

         |DDEFECTO #dscam004;
         #dscam004#17 = #dscaz001#21;
         #dscam004#15 = #dscaz001#20;
         #dscam004#0  = #dscaz001#1;
         #dscam004#1  = #dscaz001#2;
         #dscam004#2  = #dscaz001#3;
         #dscam004#3  = LinCob;
         #dscam004#4  = #dscaz001#13;
         #dscam004#5  = "CFR";
         #dscam004#6  = #dscaz001#14;
         #dscam004#11 = #dscaz001#16;
         #dscam004#15 = #dscaz001#20;
         aAlfa = "Docum. " + (("0000" + #dscaz001#33) % -104) + "/" + #dscaz001#31;
         #dscam004#16 = aAlfa;
         #dscam004#33 = #dscaz001#28;
         #dscam004#43 = nNumSec;
         #dscam004#44 = #dscaz001#36;
         #dscam004#45 = #dscam004#44 / #dscaz001#28;
         |SI #dscaz001#25 = "D"; |O #dscaz001#25 = "E";
            #dscam004#46 = #dscaz001#7 - #dscaz001#8;
         |SINO;
            #dscam004#46 = 0;
         |FINSI;
         #dscam004#47 = #dscam004#46 / #dscaz001#28;
         #dscam004#51 = #dscaz001#33;
         #dscam004#52 = #dscaz001#31;
         #dscam004#53 = #dscaz001#32;
         #dscam004#16 = #dscaz001#34;

         #dscam004#12 = #dscaz001#15;
         #dscam004#29 = #dscaz001#15 / #dscaz001#28;
         #dscam004#13 = #dscaz001#18;
         #dscam004#30 = #dscaz001#18 / #dscaz001#28;
         #dscam004#14 = #dscaz001#19;
         #dscam004#31 = #dscaz001#19 / #dscaz001#28;
         |SI #dscaz001#39 ! " "; #dscam004#54 = #dscaz001#17; |FINSI;
         |SI nSwArtenvas = 1;
            #dscam003#40 = #dscaz001#21;
            |LEE 000#dscam003.=;
            |SI FSalida = 0; #dscam004#54 = #dscam003#12; |FINSI;
         |FINSI;

         |GRABA 020#dscam004.n; |LEE 000#dscam004.=
         |SI EntidadAnt ! #dscaz001#33; |O DocumAnt ! #dscaz001#31;
            eaUsuario = Usuario % 0810;
            eaDescr   = "ALTA COBRO CONFIRMADO ("+ (("0000" + #dscaz001#33) % -104) + "/" + (("0000000000" + #dscaz001#31) % -110) + ") DESDE CONTROL DE COBROS";
            eaTipoReg = "PT";  eaNumero = (("0000" + #dscaz001#33) % -104) + (("00000000000" + #dscaz001#31) % -110);
            eaTipoOp  = "A";   enImpAnt = 0; enImpAct = #dscaz001#36;
            |HAZ GrabaAudit;
            EntidadAnt = #dscaz001#33; DocumAnt = #dscaz001#31;
         |FINSI;

         #dscam003#40 = #dscaz001#21;
         |LEE 101#dscam003.=;
         |SI FSalida = 0;
            |SI #dscam003#12 ! #dscaz001#17;
               |SI nSwArtenvas = 1; #dscam003#12 = #dscaz001#17; |FINSI;
            |FINSI;
            #dscam003#14 = "F";
            #dscam003#15 = "Recepcionado confirme";
            #dscam003#97 = "S";
            |SI #dscaz001#25 = "D";
               #dscam003#54 = #dscam003#54 + ((#dscaz001#15 + #dscaz001#18 + #dscaz001#19 + #dscaz001#7) - #dscaz001#8);
               #dscam003#67 = #dscam003#67 + (((#dscaz001#15 + #dscaz001#18 + #dscaz001#19 + #dscaz001#7) - #dscaz001#8) / #dscaz001#28);
            |FINSI;
            |SI #dscaz001#25 = "E";
               #dscam003#55 = #dscam003#55 + ((#dscaz001#15 + #dscaz001#18 + #dscaz001#19 + #dscaz001#7) - #dscaz001#8);
               #dscam003#68 = #dscam003#68 + (((#dscaz001#15 + #dscaz001#18 + #dscaz001#19 + #dscaz001#7) - #dscaz001#8) / #dscaz001#28);
            |FINSI;
            #dscam003#25 = #dscam003#25 + #dscaz001#18;
            #dscam003#63 = #dscam003#63 + (#dscaz001#18 / #dscaz001#28);
            #dscam003#24 = #dscam003#24 + #dscaz001#15;
            #dscam003#62 = #dscam003#62 + (#dscaz001#15 / #dscaz001#28);
            #dscam003#38 = #dscam003#38 + #dscaz001#19;
            #dscam003#66 = #dscam003#66 + (#dscaz001#19 / #dscaz001#28);
            #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
            #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
            #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
            #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
            #dscam003#31 = #dscam003#30 - #dscam003#23; #dscam003#65 = #dscam003#64 - #dscam003#61;
            #dscam003#70 = #dscaz001#31;
            #dscam003#71 = #dscaz001#32;
            #dscam003#72 = #dscaz001#33;
            #dscam003#73 = #dscaz001#34;
            #dscam003#74 = #dscaz001#35;
            #dscam003#78 = #dscaz001#36;
            #dscam003#79 = #dscaz001#36 / #dscaz001#28;
            |SI #dscaz001#31 ! "          "; |O #dscaz001#33 ! "    ";
               #dscam003#90 = "S";
            |FINSI;
            |SI #dscaz001#42 ! 0;
               |ABRE #dscam014;
               #dscam014#0 = #dscaz001#42;
               |LEE 000#dscam014.=;
               |SI FSalida ! 0; |DDEFECTO #dscam014; |FINSI;
               |CIERRA #dscam014;

               #dscam003#103 = #dscam003#51;
               #dscam003#104 = #dscam003#52;
               #dscam003#51 = #dscaz001#42;
               #dscam003#52 = #dscam014#1;
            |FINSI;

            #dscam003#12 = #dscaz001#17;
            |HAZ CambiaTipoRec; || Modulo LUXE
            |GRABA 020#dscam003.a; |LIBERA #dscam003;
         |FINSI;
         |SI #dscam051#3 = "S"; |Y #dscam051#130 = "S";
            enEmpCartera = -1;       enEmpGestion = #dscam003#46;
            eaSerie  = #dscam003#0;  eaCliGest = #dscam003#32;
            nImporte = #dscam003#30;
            |SI #dscam003#16 ! 0;
               eaTipoOper = eaTipoOper + "-7";
            |SINO;
               eaTipoOper = eaTipoOper + "-4";
            |FINSI;
            |HAZ BucleRiesgo;
         |FINSI;

         SwPagTal = 1;
         eaCliente = #dscam003#32; |HAZ MiraBloqueoRiesgo;
      |FINSI;
   |FINSI;

   eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaz001#21; |HAZ ProcesaTempo;
   |ERROR;
|FPRC;

|DEFBUCLE Volcado;
#dscaz001#1;
10;
00001,"*";
99999,"*";
;
NULL,Volcado;
|FIN;

|PROCESO MiraSec;
   |SI #dscam051#62 = "S";
      |ABRE #dscam094;
      #dscam094#0 = "V";
      #dscam094#1 = #dscaz001#1;
      |LEE 000#dscam094.=;
      |SI FSalida = 0;
         #dscaw043#8 = #dscam094#2;
      |SINO;
         #dscaw043#8 = 0;
      |FINSI;
      |CIERRA #dscam094;
   |SINO;
      #dscaw043#8 = 0;
   |FINSI;

   |SI #dscaz001#31 ! "          ";
      |SELECT #2#dscaw043;
      #dscaw043#3 = #dscaz001#33;
      #dscaw043#4 = #dscaz001#31;
      #dscaw043#5 = #dscaz001#30;
      |LEE 000#dscaw043.=;
      FEstado = FSalida;
      |SELECT #1#dscaw043;
   |SINO;
      |SELECT #3#dscaw043;
      #dscaw043#2 = #dscaz001#13;
      #dscaw043#3 = "    ";
      #dscaw043#4 = "          ";
      #dscaw043#5 = #dscaz001#30;
      #dscaw043#7 = #dscaz001#14;
      |LEE 000#dscaw043.=;
      FEstado = FSalida;
      |SELECT #1#dscaw043;
   |FINSI;

   |SI FEstado = 0;
      nNumSec = #dscaw043#6;
   |SINO;
      |SI nNumSec = 0;
         |SALVA_FICHA #dscam004;
         |SELECT #3#dscam004;
         |LEE 000#dscam004.u;
         |SI nNumSec [ #dscam004#43;
            nNumSec = #dscam004#43 + 1;
         |SINO;
            nNumSec = nNumSec + 1;
         |FINSI;
         |SELECT #1#dscam004;
         |LEE 000#dscam004.p; |REPON_FICHA #dscam004;
      |SINO;
         nNumSec = nNumSec + 1;
      |FINSI;
   |FINSI;

   |SI #dscaz001#31 = "          ";
      #dscam030#0 = #dscaz001#30;
      |LEE 000#dscam030.=;
      |SI FSalida = 0;
         |SI #dscam030#8 = "N"; |Y #dscam030#0 ! "    "; nNumSec = 0; |FINSI;
      |SINO;
         nNumSec = 0;
      |FINSI;
   |FINSI;

   |DDEFECTO #dscaw043;
   #dscaw043#0 = #dscaz001#0;
   #dscaw043#1 = #dscaz001#21;
   #dscaw043#2 = #dscaz001#13;
   #dscaw043#3 = #dscaz001#33;
   #dscaw043#4 = #dscaz001#31;
   #dscaw043#5 = #dscaz001#30;
   #dscaw043#6 = nNumSec;
   #dscaw043#7 = #dscaz001#14;
   |SI #dscam051#62 = "S";
      |ABRE #dscam094;
      #dscam094#0 = "V";
      #dscam094#1 = #dscaz001#1;
      |LEE 000#dscam094.=;
      |SI FSalida = 0;
         #dscaw043#8 = #dscam094#2;
      |SINO;
         #dscaw043#8 = 0;
      |FINSI;
      |CIERRA #dscam094;
   |SINO;
      #dscaw043#8 = 0;
   |FINSI;

   |GRABA 020#dscaw043.n;

   #dscaz001#37 = nNumSec; |GRABA 020#dscaz001.a;
|FPRC;

|DEFBUCLE MiraSec;
#dscaz001#1;
10;
00001,"*";
99999,"*";
;
NULL,MiraSec;
|FIN;

|PROCESO LiberaFichas;
   eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaz001#21; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE LiberaFichas;
#dscaz001#1;
;
00001;
99999;
;
NULL,LiberaFichas;
|FIN;

|DEFBUCLE Acota1;
#dscam003#1;
32,3,4,12;
000000001,DCliente,#dscaw007#3,#dscaw007#5,#dscaw007#46;
999999999,HCliente,#dscaw007#4,#dscaw007#6,#dscaw007#47;
;
NULL,GrabaRecibo;
|FIN;

|DEFBUCLE Acota2;
#dscam003#1;
5,3,4,12;
000000001,DCliente,#dscaw007#3,#dscaw007#5,#dscaw007#46;
999999999,HCliente,#dscaw007#4,#dscaw007#6,#dscaw007#47;
;
NULL,GrabaRecibo;
|FIN;

|PROCESO BucleAcotado;
   nBucleAcotado = 1;
   |PUSHV 0501 2380;
   #dscaw007#31 = #dscam051#100;

   |HAZ Seleccion;
   |PINPA #0#dscaw007; |PINDA #0#dscaw007;
   |ENDATOS #1#dscaw007;
   |SI FSalida = 0;
      |SI #dscaw007#31 = "G";
         |SI #dscaw007#0 = "S";
            DCliente = #dscaw007#1;
            HCliente = #dscaw007#2;
            |BUCLE Acota1;
         |SINO;
            |PARA Cont = 7; |SI Cont [ 30; |HACIENDO Cont = Cont + 1;
               |SI #dscaw007#Cont# ! 0;
                  DCliente = #dscaw007#Cont#;
                  HCliente = #dscaw007#Cont#;
                  |BUCLE Acota1;
               |FINSI;
            |SIGUE;
         |FINSI;
      |SINO;
         |SI #dscaw007#0 = "S";
            DCliente = #dscaw007#32;
            HCliente = #dscaw007#33;
            |BUCLE Acota2;
         |SINO;
            |PARA Cont = 34; |SI Cont [ 45; |HACIENDO Cont = Cont + 1;
               |SI #dscaw007#Cont# ! 0;
                  DCliente = #dscaw007#Cont#;
                  HCliente = #dscaw007#Cont#;
                  |BUCLE Acota2;
               |FINSI;
            |SIGUE;
         |FINSI;
      |FINSI;
   |FINSI;
   |POPV;
   nBucleAcotado = 0;
|FPRC;

|PROCESO Seleccion;
   |SI HayConta = 0; |Y #dscaw007#31 = "C";
      |MENAV "    La contabilidad no esta instalada";
      |ERROR; |ACABA;
   |FINSI;

   |SI HayGestion = 0; |Y #dscaw007#31 = "G";
      |MENAV "    La gestion comercial no esta instalada";
      |ERROR; |ACABA;
   |FINSI;

   |SI #dscaw007#31 = "C";
      |C_M #dscaw007#1,1,"N"; |C_V #dscaw007#1,1,"N";
      |C_M #dscaw007#2,1,"N"; |C_V #dscaw007#2,1,"N";
      |PARA Cont = 7; |SI Cont [ 30; |HACIENDO Cont = Cont + 1;
         |C_M #dscaw007#Cont#,1,"N"; |C_V #dscaw007#Cont#,1,"N";
      |SIGUE;
      |SI #dscaw007#0 = "S";
         |C_M #dscaw007#32,1,"S"; |C_V #dscaw007#32,1,"S";
         |C_M #dscaw007#33,1,"S"; |C_V #dscaw007#33,1,"S";
      |SINO;
         |C_M #dscaw007#32,1,"N"; |C_V #dscaw007#32,1,"S";
         |C_M #dscaw007#33,1,"N"; |C_V #dscaw007#33,1,"S";
      |FINSI;
      |PINTA #dscaw007#32; |PINTA #dscaw007#33;
      |PARA Cont = 34; |SI Cont [ 45; |HACIENDO Cont = Cont + 1;
         |SI #dscaw007#0 = "S";
            |C_M #dscaw007#Cont#,1,"N"; |C_V #dscaw007#Cont#,1,"S";
         |SINO;
            |C_M #dscaw007#Cont#,1,"S"; |C_V #dscaw007#Cont#,1,"S";
         |FINSI;
         |PINTA #dscaw007#Cont#;
      |SIGUE;
   |SINO;
      |C_M #dscaw007#32,1,"N"; |C_V #dscaw007#32,1,"N";
      |C_M #dscaw007#33,1,"N"; |C_V #dscaw007#33,1,"N";
      |PARA Cont = 34; |SI Cont [ 45; |HACIENDO Cont = Cont + 1;
         |C_M #dscaw007#Cont#,1,"N"; |C_V #dscaw007#Cont#,1,"N";
      |SIGUE;
      |SI #dscaw007#0 = "S";
         |C_M #dscaw007#1,1,"S"; |C_V #dscaw007#1,1,"S";
         |C_M #dscaw007#2,1,"S"; |C_V #dscaw007#2,1,"S";
      |SINO;
         |C_M #dscaw007#1,1,"N"; |C_V #dscaw007#1,1,"S";
         |C_M #dscaw007#2,1,"N"; |C_V #dscaw007#2,1,"S";
      |FINSI;
      |PINTA #dscaw007#1; |PINTA #dscaw007#2;
      |PARA Cont = 7; |SI Cont [ 30; |HACIENDO Cont = Cont + 1;
         |SI #dscaw007#0 = "S";
            |C_M #dscaw007#Cont#,1,"N"; |C_V #dscaw007#Cont#,1,"S";
         |SINO;
            |C_M #dscaw007#Cont#,1,"S"; |C_V #dscaw007#Cont#,1,"S";
         |FINSI;
         |PINTA #dscaw007#Cont#;
      |SIGUE;
   |FINSI;
   |PINPA #0#dscaw007;
   |PINDA #0#dscaw007;
|FPRC;

|PROCESO Cta; |TIPO 6;
   nTecla = FSalida;
   Comodin = #Fichero@#Campo#; |QBF Comodin;
   Comodin = Comodin - ".";

   |SI FSalida ! 0;
      nParte1 = (FSalida / 100) ! 0 + 99; aParte1 = Comodin % nParte1;
      nParte2 = FSalida + 98;            aParte2 = Comodin % nParte2;
      |PARA; |SI FSalida ! 0; |HACIENDO; aParte1 = aParte1 - "."; |SIGUE;
      FSalida = 1;
      |PARA; |SI FSalida ! 0; |HACIENDO; aParte2 = aParte2 - "."; |SIGUE;
      Comodin = aParte1 % 0; Calc = Comodin;
      Comodin = aParte2 % 0; Calc = Calc + Comodin;
      Calc = MaxDigit - Calc; Comodin = "0" * Calc;
      Comodin = aParte1 + Comodin + aParte2;
      #Fichero@#Campo# = Comodin; |PINTA #Fichero@#Campo#;
   |FINSI;
   FSalida = nTecla;
|FPRC;

|PROCESO ExistClient2;
   |SI FSalida = 2; |ACABA; |FINSI;
   |SI #dscaw007#0 = "S"; |ACABA; |FINSI;

   DCampoG = 7;  HCampoG = 30;
   DCampoC = 34; HCampoC = 45;

   TipoCliente = #dscaw007#31;
   CodCliente  = #dscaw007#Campo#;
   |HAZ ExisteCliente;
   |SI TipoCliente = "ERROR";
      |ERROR;
   |SINO;
      #dscaw007#Campo# = CodCliente;
      |PINTA #dscaw007#Campo#;
   |FINSI;
|FPRC;

|PROCESO RevisaCuentas;
   |PARA Cont = 34; |SI Cont [ 45; |HACIENDO Cont = Cont + 1;
      |SI Cont ! Campo;
         |SI #dscaw007#Cont# = #dscaw007#Campo#; |Y #dscaw007#Cont# ! "            ";
            |MENAV "    Cuenta repetida";
            |ERROR;
            |ACABA;
         |FINSI;
      |FINSI;
   |SIGUE;
|FPRC;

|PROCESO Decimales; |TIPO 13;
   |SI aCobrad ! "";
      |ATRI R; |PINTA 0744, "<F6> Volcar asignacion ";
               |PINTA 0567, "             "; |ATRI N;
   |FINSI;
   |SI Opcion = 2; |ATRI R; |PINTA 1152, "Emi"; |ATRI N; |FINSI;

   |HAZ PintaTotales;

   |SI #dscaz001#33 ! "    "; |Y #dscaz001#10 = "*";
      |SI #dscaz001#35 = "COBROCONFIRM";
         Comodin = "Cobro confirmado n§ " + #dscaz001#33 + "/" + #dscaz001#31;
      |SINO;
         Comodin = "Recibo asignado al pagare n§ " + #dscaz001#33 + "/" + #dscaz001#31;
      |FINSI;
   |SINO;
      Comodin = "                                              ";
   |FINSI;
   |ATRI I; |PINTA 2303, Comodin; |ATRI N;
   Divisa = #dscaz001#26; |HAZ Tipo13;
|FPRC;

|PROCESO Asignacion;
   |SI #dscaz001#33 ! "    "; |O #dscaz001#10 ! "P"; |ACABA; |FINSI;
   #dscaz001#10 = "*";
   HaySelecPag  = HaySelecPag - 1;
   HaySelec     = HaySelec    + 1;

   nTotalAsig = nTotalAsig + #dscaz001#8;
   |SI nTotalAsig > #dscaw017#6;
      nCalc = nTotalAsig - #dscaw017#6;
      #dscaz001#8 = #dscaz001#9 - nCalc;
      nTotalAsig = nTotalAsig + #dscaz001#8;
      nTotalPag = nTotalPag - #dscaz001#9;
      nTotalPdt = nTotalPdt + #dscaz001#9;
      nTotalPag = nTotalPag + #dscaz001#8;
      nTotalPdt = nTotalPdt - #dscaz001#8;
   |FINSI;
   #dscaz001#14 = #dscaw017#8;
   #dscaz001#31 = #dscaw017#2;
   #dscaz001#32 = #dscaw017#3;
   #dscaz001#33 = #dscaw017#0;
   #dscaz001#34 = #dscaw017#4;
   #dscaz001#35 = #dscaw017#5;
   #dscaz001#36 = #dscaw017#6;
   #dscaz001#39 = #dscaw017#9;
   #dscaz001#30 = #dscaw017#7;
   efFechaDiv = #dscaz001#14; Divisa = #dscaz001#26; |HAZ TomaDecim;
   #dscaz001#28 = CambioDivVn;

   |SI nSwArtenvas = 1; #dscaz001#17 = #dscaw017#10; |FINSI;
   |GRABA 020#dscaz001.a;

   eaVarLog = "Agregado el documento n§ " + #dscaz001#21 + " al pagare " + #dscaz001#33 + "/" + #dscaz001#34; |HAZ AnyadeLog;
|FPRC;

|DEFBUCLE Asignacion;
#dscaz001#3;
;
INICIO;
FINAL;
;
NULL,Asignacion;
|FIN;

|PROCESO CuentaVtos;
   |SI #dscaz001#10 ! "P"; |ACABA; |FINSI;

   nCalc2 = #dscaz001#11; nCalc3 = #dscaw017#8;
   nDiasVto = nDiasVto + ((nCalc2 - nCalc3) * #dscaz001#7);
   nImpPdte = nImpPdte + #dscaz001#7;

   |SI fFechaVto = "00.00.0000";
      fFechaVto = #dscaz001#11;
   |SINO;
      fFechaVto = "00.00.0000";
      |ERROR10;
   |FINSI;
|FPRC;

|DEFBUCLE CuentaVtos;
#dscaz001#3;
;
INICIO;
FINAL;
;
NULL,CuentaVtos;
|FIN;

|PROCESO AsignaATalon;
   |SI #dscaz001#33 ! "    ";
      |MENAV "    El/Los recibo/s ya forma/n parte de un talon";
      |ACABA;
   |FINSI;

   |DDEFECTO #dscaw017;
   |SI nSwArtenvas = 1;
      |SI nTotalPag < 0;
         aAlfa = "    NResultado del pagaré negativo. " + &191 + " Continuar ?";
         |CONFI aAlfa;
         |SI FSalida ! 0;
            |MENAV "    Proceso cancelado";
            |ACABA;
         |FINSI;
      |FINSI;

      nTR = #dscaz001#17;
      |SALVA_FICHA #dscaz001;
      |LEE 000#dscaz001.p;
      |PARA; |SI FSalida = 0; |HACIENDO;
         |SI #dscaz001#10 = "P"; nTR = #dscaz001#17; |FINSI;
         |LEE 000#dscaz001.s;
      |SIGUE;
      |REPON_FICHA #dscaz001;

      |SI nConfirmes = 1;
         eaAlfa = #dscam003#72; |HAZ MiraEntidad;
         #dscaw017#0 = #dscam003#72;
         #dscaw017#1 = eaAlfa;
         #dscaw017#3 = #dscam003#71;
         eaAlfa = #dscam003#51; |HAZ MiraCtaBcoRemesas;
         #dscaw017#5 = eaAlfa;
      |FINSI;
   |FINSI;

   |PUSHV 0501 2380;
   |SI nSwLuxe = 1;
      |SALVA_FICHA #dscaz001;
      fFechaVto = "00.00.0000";
      nDiasVto = 0; nImpPdte = 0;
      |BUCLE CuentaVtos;
      |SI fFechaVto ! "00.00.0000";
         #dscaw017#3 = fFechaVto;
      |SINO;
         nCalc2 = (nDiasVto / nImpPdte) ! 2;
         nCalc3 = #dscaw017#8 + nCalc2;
         fFechaVto = nCalc3;
         #dscaw017#3 = fFechaVto;
      |FINSI;
      |REPON_FICHA #dscaz001;
   |FINSI;
   #dscaw017#6  = TotalSelPg;
   #dscaw017#7  = #dscam051#40;
   |SI nSwArtenvas = 1; #dscaw017#10 = nTR; |FINSI;

   |HAZ EsViuda;
   |SI FSalida = 0;
      |DDEF aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "dscam209.mas";
      |CARGA_DEF aAlfa, Referen2@;
      |SI FSalida = 0;
         |ABRE #Referen2@;
         |LEE 000#Referen2@.p;
         |SI FSalida ! 0;
            |DDEFECTO #Referen2@;
         |FINSI;
         #dscaw017#5 = #Referen2@#4;
         |CIERRA #Referen2@; |DESCARGA_DEF #Referen2@;
      |FINSI;
   |FINSI;

   |SI #dscam051#61 = "N";              ||juan
        |C_M #dscaw017#7, 1, "N";
   |FINSI;

   |PINPA #0#dscaw017; |PINDA #0#dscaw017;
   |ENDATOS #1#dscaw017;
   |SI FSalida = 0;
      HaySelCobCf  = 0;

      |SI nSwLuxe = 1;
         |SI #dscaw017#3 ! fFechaVto;
            aAlfa = "    SNuevo vencimiento posterior al original, " + &191 + " Calcular coste aplazamiento ?";
            |CONFI aAlfa;
            |SI FSalida = 0;
               enTimbre = #dscaw017#6; |HAZ Aplazamiento; enTimbre = 0;
            |FINSI;
         |FINSI;
      |FINSI;

      nLinPos =  #dscaz001#0;
      nTotalAsig = 0;
      |BUCLE Asignacion;
      #dscaz001#0 = nLinPos;
      |LEE 000#dscaz001.=;
      TotalSelPg = 0;
   |FINSI;
   |POPV;

   |PONCONTROL 23,"si";
|FPRC;

|PROCESO MiraImporte1;
     TotalSelPg = TotalSelPg ! 2;
     |SI TotalSelPg ] 0;
          |SI #dscaw017#6 < TotalSelPg;
               |MENAV "    Se han seleccionado recibos por importe distinto al del pagare. Se ajustara la seleccion";
          |FINSI;
          |SI #dscaw017#6 > TotalSelPg;
               |CONFI "0000NPagaré por importe superior al total. Se generará una entrega a cuenta pdte compensar.Continuar?";
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |SINO;
          |SI #dscaw017#6 > TotalSelPg;
               |MENAV "    Se han seleccionado recibos por importe distinto al del pagare. Se ajustara la seleccion";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO TomaDocum; |TIPO 7;
   |SI #dscaz001#10 = "*";
      #dscam003#40 = #dscaz001#21;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         || TotalSelec = TotalSelec - #dscaz001#8;
         eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaz001#21; |HAZ ProcesaTempo;
         || #dscaz001#13 = "";
         || #dscaz001#16 = "";
         || #dscaz001#25 = "P";
         || #dscaz001#8 = #dscam003#23;
         #dscaz001#10 = " ";
         || #dscaz001#28 = 0;
         || #dscaz001#29 = 0;
         || #dscaz001#31 = "";
         || #dscaz001#32 = "";
         || #dscaz001#33 = "";
         || #dscaz001#34 = "";
         || #dscaz001#35 = "";
         || #dscaz001#36 = 0;
         |GRABA 020#dscaz001.a;
         || HaySelec = HaySelec - 1;
      |FINSI;
   |FINSI;
   NumDocumAnt = #dscaz001#21;
|FPRC;

|PROCESO BuscaPagTal;
   |SI #dscam004#43 ! 0; nNumSeq = #dscam004#43; |FINSI;
   nImpD = #dscam004#44; nImpB = #dscam004#45;
   nDtoD = #dscam004#46; nDtoB = #dscam004#47;
|FPRC;

|DEFBUCLE BuscaPagTal;
#dscam004#1;
5;
#dscam003#40,01,"RPT";
#dscam003#40,99,"RPT";
;
NULL,BuscaPagTal;
|FIN;

|PROCESO Recalcula2;
  |SI #dscaw025#1 < #dscaw025#2;
     |LEE 000#dscam003.u;
     UltCont = #dscam003#40 + 1;
     #dscam003#40 = #dscaw025#5;
     |LEE 000#dscam003.=;
     |SI FSalida = 0;
        nNumSeq = 0; |BUCLE BuscaPagTal;
        #dscam003#40 = UltCont;
        |GRABA 020#dscam003.b;
        #dscam003#0  = "";
        #dscam003#1  = 0;
        #dscam003#2  = 0;
        #dscam003#14 = "p";
        #dscam003#15 = "Entrega pdte.cobro";
        #dscam003#16 = 0;
        #dscam003#17 = 0;
        #dscam003#18 = 0;
        #dscam003#19 = "";
        #dscam003#20 = 0;
        #dscam003#21 = 0;
        #dscam003#22 = #dscaw025#2 - #dscaw025#1;
        ||#dscam003#23 = #dscaw025#2 - #dscaw025#1;
        #dscam003#23 = 0;
        #dscam003#24 = 0;
        #dscam003#25 = 0;
        #dscam003#26 = #dscaz001#14;
        #dscam003#27 = 0;
        #dscam003#30 = #dscaw025#2 - #dscaw025#1;
        ||#dscam003#31 = 0;
        #dscam003#31 = #dscaw025#2 - #dscaw025#1;
        #dscam003#37 = 0;
        #dscam003#38 = 0;
        #dscam003#41 = 0;
        #dscam003#47 = "S";
        #dscam003#48 = "N";
        #dscam003#49 = "N";
        #dscam003#50 = "";
        #dscam003#51 = "";
        #dscam003#52 = "";
        #dscam003#53 = "";
        #dscam003#54 = 0;
        #dscam003#55 = 0;
        #dscam003#56 = 0;
        #dscam003#60 = #dscaw025#4 - #dscaw025#3;
        ||#dscam003#61 = #dscaw025#4 - #dscaw025#3;
        #dscam003#61 = 0;
        #dscam003#62 = 0;
        #dscam003#63 = 0;
        #dscam003#64 = #dscaw025#4 - #dscaw025#3;
        ||#dscam003#65 = 0;
        #dscam003#65 = #dscaw025#4 - #dscaw025#3;
        #dscam003#66 = 0;
        #dscam003#67 = 0;
        #dscam003#68 = 0;
        #dscam003#69 = "";
        |GRABA 020#dscam003.a; |LIBERA #dscam003;
        eaUsuario = Usuario % 0810;
        eaDescr   = "ALTA ENTREGA A CUENTA ("+ (("000000000" + #dscam003#40) % -109) + ") POR PAGARE/TALON (";
        eaDescr   = eaDescr + (("0000" + #dscam003#72) % -104) + "/" + (("0000000000" + #dscam003#70) % -110) + ")";
        eaTipoReg = "EA";  eaNumero = ("0000000000" + #dscam003#40) % -109;
        eaTipoOp  = "A";   enImpAnt = 0; enImpAct = #dscam003#23;
        |HAZ GrabaAudit;

        #dscam004#17 = #dscam003#40;
        #dscam004#3 = 1;
        |LEE 000#dscam004.];
        |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
           |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
              Linea = #dscam004#3 + 1;
              |LEE 000#dscam004.s;
           |SIGUE;
        |SINO;
           Linea = 1;
        |FINSI;
        |DDEFECTO #dscam004;
        #dscam004#17 = #dscam003#40;
        #dscam004#3  = Linea;
        |GRABA 020#dscam004.b;
        #dscam004#0 = #dscam003#0;
        #dscam004#1 = #dscam003#1;
        #dscam004#2 = #dscam003#2;
        #dscam004#4 = #dscam003#74;
        #dscam004#5 = "RAC";
        #dscam004#6 = #dscaw025#7;
        #dscam004#7 = 0;
        ||#dscam004#8 = #dscam003#23; #dscam004#26 = #dscam003#61;
        #dscam004#15 = #dscam003#27;
        Comodin = "Entrega a cuenta"; #dscam004#16 = Comodin;
        #dscam004#16 = "Doc.Automatico por pagare con valor exceso";
        #dscam004#25 = #dscam003#61;
        #dscam004#42 = #dscam003#74;
        #dscam004#43 = nNumSeq;
        #dscam004#44 = #dscaw025#2 - #dscaw025#1;
        #dscam004#45 = #dscaw025#4 - #dscaw025#3;
        #dscam004#46 = 0; #dscam004#47 = 0;
        #dscam004#51 = #dscam003#72;
        #dscam004#52 = #dscam003#70;
        |GRABA 020#dscam004.a; |LIBERA #dscam004;
     |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE Recalcula2;
#dscaw025#1;
;
INICIO;
FINAL;
;
NULL,Recalcula2;
|FIN;

|PROCESO RellPagares;
   |SI #dscam003#72 = "    "; |Y #dscam003#70 = "          "; |ACABA; |FINSI;

   |SELECT #2#dscaz001;
   #dscaz001#21 = #dscam003#40;
   #dscaz001#0  = 1;
   |LEE 000#dscaz001.];
   |SI FSalida ! 0; |O #dscaz001#21 ! #dscam003#40;
      |LEE 000#dscaz001.u;
      #dscaz001#14 = "01.01.0000";
   |FINSI;
   |SELECT #1#dscaz001;

   #dscaw025#0 = #dscam003#70;
   #dscaw025#6 = #dscam003#72;
   |LEE 000#dscaw025.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscaw025;
      #dscaw025#0 = #dscam003#70;
      #dscaw025#2 = #dscam003#78;
      #dscaw025#4 = #dscam003#79;
      #dscaw025#5 = #dscam003#40;
      #dscaw025#6 = #dscam003#72;
      #dscaw025#7 = #dscaz001#14;
      |GRABA 020#dscaw025.n;
      |LEE 000#dscaw025.=;
   |FINSI;
   |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
      #dscaw025#1 = #dscaw025#1 + #dscam003#22;
   |SINO;
      #dscaw025#1 = #dscaw025#1 + #dscam003#30;
   |FINSI;
   #dscaw025#3 = #dscaw025#3 + #dscam003#64;
   |GRABA 020#dscaw025.a;
|FPRC;

|DEFBUCLE RellPagares;
#dscam003#1;
;
000000001;
999999999;
;
NULL,RellPagares;
|FIN;

|PROCESO RevisaPagares;
   |DELINDEX #dscaw025;
   |ABRE #dscaw025;
   |BUCLE RellPagares; |BUCLE Recalcula2;
   |CIERRA #dscaw025;
|FPRC;

|PROCESO VuelcaSec;
   |SI #dscaw043#6 ] 0;
      |SI #dscam051#1 = "S"; |Y HayConta = 1; |Y #dscaw043#5 ! "    ";
         || Esto lo hago para que para los enlaces por sesion se usen SIEMPRE
         ||   asientos definidos por sesion

         nSwCambia = 0;
         |ABRE #dscam030;
         #dscam030#0 = #dscaw043#5;
         |LEE 101#dscam030.=;
         |SI FSalida = 0;
            |SI #dscam030#8 = "N";
               nSwCambia = 1;
               #dscam030#8 = "S";
               |GRABA 020#dscam030.a; |LIBERA #dscam030;
            |FINSI;
         |FINSI;
         |CIERRA #dscam030;

         |SI #dscaw043#0 ! #dscaz001#0;
            #dscaz001#0 = #dscaw043#0;
            |LEE 000#dscaz001.=;
         |FINSI;

         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #13 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         #dscaw013#15 = #dscaw043#5;  #dscaw013#0  = 1;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
         #dscaw013#5 = #dscaw043#6;   #dscaw013#6  = #dscaw043#6;
         #dscaw013#11 = "N";          #dscaw013#12 = 10;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         |SI #dscaw043#4 ! "          ";
            |SI #dscaz001#35 = "COBROCONFIRM";
               #dscaw013#3 = "CFR";         #dscaw013#4  = "CFR";
            |SINO;
               #dscaw013#3 = "RAC";         #dscaw013#4  = "RPT";
            |FINSI;
            #dscaw013#15 = #dscaw043#5;  #dscaw013#0  = 2;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
            #dscaw013#11 = "A";          #dscaw013#12 = 3;
            |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         |FINSI;

         Comodin = #dscaw043#5; |QBF Comodin;
         Comodin = "dscam033.tab;" + Comodin;
         |LIBERA #dscam003; |CIERRAT #dscam003;
         |LIBERA #dscam004; |CIERRAT #dscam004;
         |SUB_EJECUTA_NP Comodin; |DELINDEX #dscaw013;
         |ABRET #dscam003; |LEE 101#dscam003.=;
         |ABRET #dscam004; |LEE 101#dscam004.=;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

         |SI nSwCambia = 1;
            |ABRE #dscam030;
            #dscam030#0 = #dscaw043#5;
            |LEE 101#dscam030.=;
            |SI FSalida = 0;
               #dscam030#8 = "N";
               |GRABA 020#dscam030.a; |LIBERA #dscam030;
            |FINSI;
            |CIERRA #dscam030;
         |FINSI;
      |FINSI;

      nNumSec = #dscaw043#6;
      |SALVA_FICHA #dscaw043;
      |BUCLE MarcaSec;
      |LEE 000#dscaw043.p; |REPON_FICHA #dscaw043;
      |CIERRA #dscaw013;
   |FINSI;
|FPRC;

|DEFBUCLE VuelcaSec;
#dscaw043#1;
6;
00001,0000000001;
99999,9999999999;
;
NULL,VuelcaSec;
|FIN;

|PROCESO LiberaRets;
   |BORRA 020#dscagm01@.a;
|FPRC;

|DEFBUCLE LiberaRets;
#dscagm01@#1002;
;
000000001,000;
999999999,000;
;
NULL,LiberaRets;
|FIN;

|PROCESO LiberaRet;
      |HAZ EsAgrogenil;
      |SI FSalida = 0;
         |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/dscagm01.mas";
         |CARGA_DEF aAlfa, dscagm01@
         |SI FSalida = 0;
            |DFICE aAlfa; |PATH_DAT #1000 aAlfa;
            |BUCLE LiberaRets;
            |CIERRA #dscagm01@; |DESCARGA_DEF #dscagm01@;
         |FINSI;
      |FINSI;
|FPRC;

|DEFBUCLE RecsRepre;
#dscam003#11;
33, 0;
"      ", "01.01.0000", "     ", #dscaw117#0, #dscaw117#2;
"zzzzzz", "31.12.9999", "zzzzz", #dscaw117#1, #dscaw117#3;
;
NULL, GrabaRecibo;
|FIN;

|PROCESO Representante;
   nSwRepre = 1;
   |PUSHV  1124 1560;
   |BLANCO 1124 1560;
   |PINPA #0#dscaw117; |PINDA #0#dscaw117;
   |ENDATOS #1#dscaw117;
   |SI FSalida = 0;
      |ABRE #dscam052;
      |BUCLE RecsRepre;
      |CIERRA #dscam052;
   |FINSI;
   |POPV;
|FPRC;

|PROCESO Cobrador;
   |ATRI R; |PINTA 0744, "<F6> Volcar asignacion ";
            |PINTA 0567, "             "; |ATRI N;

   aCobrad = "";
   |ABRE #dscam048;
   |PUSHV  0919 1261;
   |BLANCO 0919 1261;
   |CUADRO 1020 1260;
   |ATRI R; |PINTA 1021, " Seleccione cobrador/representante "; |ATRI N;
   |DDEFECTO #dscam048; |PINTA 1122, #dscam048#0; |PINTA 1125, #dscam048#1;
   |MENSA "    <F2> Consulta cobradores/representantes";
|ET Vuelta;
   E_sup = 2; E_inf = "";
   aCobrad = 1122 ? 1;
   |SI FSalida = 0;
      #dscam048#0 = aCobrad;
      |LEE 000#dscam048.=;
      |SI FSalida = 0;
         |PINTA 1125, #dscam048#1; aNomCob = #dscam048#1;
         |CONFI "    SEs correcto ? ";
         |SI FSalida = 0;
            |CONFI "    N Volcar todas las asignaciones ? ";
            |SI FSalida = 0;
               aAlfa = "SELECT * FROM dscam016 INTO tm" + Usuario + ".def WHERE 1 == '" + aCobrad + "'";
               |SQL aAlfa;
               |SI FSalida = 0;
                  aAlfa = FSalida % -102;
                  |SI aAlfa = ":0";
                     |MENAV "    Seleccion vacia";
                  |SINO;
                     |DDEF aAlfa; |QBF aAlfa;
                     aAlfa = aAlfa + "tm" + Usuario + ".mas";
                     |CARGA_DEF aAlfa, Referen@;
                     |SI FSalida = 0;
                        nTotalPdt = 0; nTotalLiq = 0;
                        |ABRE #dscam003;
                        |BUCLE Asignaciones;
                        |CIERRA #dscam003;
                        |DESCARGA_DEF #Referen@;
                     |FINSI;
                     |DDEFECTO #dscaw079;
                     |HAZ PintaTotales;
                  |FINSI;
               |FINSI;
               |DDEF aAlfa; |QBF aAlfa;
               aAlfa = aAlfa + "tm" + Usuario + ".mas"; |FBORRA aAlfa;
            |FINSI;
            |DDEFECTO #dscaw079;
            |HAZ PintaTotales;
         |FINSI;
         |DDEF aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "tm" + Usuario + ".mas"; |FBORRA aAlfa;
      |SINO;
         |MENAV "    Cobrador inexistente";
         |VETE Vuelta;
      |FINSI;
   |SINO;
      |SI FSalida = 10;
         #dscam048#0 = aCobrad;
         |LEE 000#dscam048.];
         |CONSULTA_CLAVE #1#dscam048;
         |SI FSalida = 0;
            aCobrad = #dscam048#0;
            |PINTA 1122, #dscam048#0; |PINTA 1125, #dscam048#1;
         |FINSI;
         |VETE Vuelta;
      |SINO;
         |SI FSalida ! 7;
            |VETE Vuelta;
         |FINSI;
      |FINSI;
   |FINSI;
   |POPV;
   |BLIN 4;
   |CIERRA #dscam048;
|FPRC;

|PROCESO ActualizaRecibos;
   #dscam003#40 = #dscam017#9;
   |LEE 101#dscam003.=;
   |SI FSalida = 0; |Y #dscam003#14 = "M";
      |SI #dscam003#31 = 0;
         #dscam003#14 = "L";
         #dscam003#15 = "Recibo Liquidado";
      |SINO;
         |SI #dscam003#23 = 0;
            |SI #dscam003#16 = 0;
               #dscam003#14 = "P";
               #dscam003#15 = "Pendiente de cobro";
            |SINO;
               #dscam003#14 = "I";
               #dscam003#15 = "Impagado";
            |FINSI;
         |SINO;
            #dscam003#14 = "C";
            #dscam003#15 = "Parcialmente cobrado";
         |FINSI;
      |FINSI;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;
|FPRC;

|PROCESO BorraLinRel;
   #dscam016#3 = #dscam016#3 - 1;
   #dscam016#4 = #dscam016#4 - #dscam017#7;
   |SI #dscam016#3 = 0;
      |BORRA 020#dscam016.a;
   |SINO;
      |GRABA 020#dscam016.a;
   |FINSI;
   |HAZ ActualizaRecibos;

   enDocumto = #dscam017#9; |HAZ BajaFechaVisita;

   |BORRA 020#dscam017.a;
|FPRC;

|DEFBUCLE BorraLinRel;
#dscam017#1;
;
#dscam016#0,001;
#dscam016#0,999;
be;
NULL,BorraLinRel;
|FIN;

|PROCESO BorraRelacs;
   |BUCLE BorraLinRel;
|FPRC;

|DEFBUCLE BorraRelacs;
#dscam016#1;
1;
00001,aCobrad;
99999,aCobrad;
be;
NULL,BorraRelacs;
|FIN;

|PROCESO EliminaLinLiq;
   #dscam003#40 = #dscam017#9;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#14 = "L";
         |BORRA 020#dscam017.a;
      |SINO;
         |SI #dscam003#14 = "M";
            #dscam016#3 = #dscam016#3 + 1;
            #dscam016#4 = #dscam016#4 + #dscam003#31;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE EliminaLinLiq;
#dscam017#1;
;
#dscam016#0,001;
#dscam016#0,999;
be;
NULL, EliminaLinLiq;
|FIN;

|PROCESO EliminaLiq;
   #dscam016#3 = 0; #dscam016#4 = 0;

   |BUCLE EliminaLinLiq;

   |SI #dscam016#3 = 0;
      |BORRA 020#dscam016.a;
   |SINO;
      |GRABA 020#dscam016.a;
   |FINSI;
|FPRC;

|DEFBUCLE EliminaLiq;
#dscam016#1;
1;
00001,aCobrad;
99999,aCobrad;
be;
NULL, EliminaLiq;
|FIN;

|PROCESO Pintas; |TIPO 7;
   |SI aCobrad ! "";
      |ATRI R; |PINTA 0744, "<F6> Volcar asignacion ";
               |PINTA 0567, "             "; |ATRI N;
   |FINSI;
   |HAZ PintaTotales;
|FPRC;

|PROCESO dscaw118;
   #dscaw118#11 = nTotEfect;
   #dscaw118#12 = nTotIngBco;
   #dscaw118#13 = nTotPagTal;
   #dscaw118#14 = nTotalRep;
   |GRABA 020#dscaw118.a;
|FPRC;

|DEFBUCLE dscaw118;
#dscaw118#2;
;
aAntRep, fAntFec, 1;
aAntRep, fAntFec, 3;
;
NULL, dscaw118;
|FIN;

|PROCESO Revisaw118;
   |SI aAntRep ! "XX";
      |SI #dscaw118#9 ! aAntRep; |O #dscaw118#8 ! fAntFec;
         |SALVA_FICHA #dscaw118;
         |BUCLE dscaw118;
         |REPON_FICHA #dscaw118;
         nTotPagTal = 0; nTotEfect  = 0;
         nTotIngBco = 0; nTotalRep  = 0;
      |FINSI;
   |FINSI;

   aAntRep = #dscaw118#9;
   fAntFec = #dscaw118#8;
   |SI #dscaw118#15 = 1;
      nTotEfect = nTotEfect + #dscaw118#4;
   |FINSI;
   |SI #dscaw118#15 = 2;
      nTotIngBco = nTotIngBco + #dscaw118#4;
   |FINSI;
   |SI #dscaw118#15 = 3;
      nTotPagTal = nTotPagTal + #dscaw118#4;
   |FINSI;
   nTotalRep = nTotalRep + #dscaw118#4;
|FPRC;

|DEFBUCLE Revisaw118;
#dscaw118#2;
;
INICIO;
FINAL;
;
NULL, Revisaw118;
|FIN;

|PROCESO GrabaTempo;
   |SI #dscaz001#10 ! "*"; |ACABA; |FINSI;

   |DDEFECTO #dscaw118;
   #dscaw118#0  = #dscaz001#21;
   #dscaw118#1  = #dscaz001#1;
   #dscaw118#2  = #dscaz001#2;
   #dscaw118#3  = #dscaz001#3;
   #dscaw118#4  = #dscaz001#8;
   #dscaw118#5  = #dscaz001#13;
   #dscaw118#6  = #dscaz001#33;
   #dscaw118#7  = #dscaz001#31;
   #dscaw118#8  = ~;
   #dscaw118#9  = #dscaz001#40;
   #dscaw118#10 = #dscaz001#41;

   aAlfa = #dscaz001#33 + #dscaz001#31; |QBT aAlfa;
   |SI aAlfa ! "";
      #dscaw118#8  = #dscaz001#14;
      #dscaw118#15 = 3;
   |SINO;
      aAlfa = #dscaz001#13; |QBF aAlfa;
      aAlfa = aAlfa % 0103;
      |SI aAlfa = "570"; #dscaw118#15 = 1; |FINSI;
      |SI aAlfa ! "570"; #dscaw118#15 = 2; |FINSI;
   |FINSI;

   |GRABA 020#dscaw118.n;
|FPRC;

|DEFBUCLE GrabaTempo;
#dscaz001#1;
;
INICIO;
FINAL;
;
NULL, GrabaTempo;
|FIN;

|PROCESO Imprime;
   |SI Impresora ! "CrystalReport";
      |PRINT;
   |SINO;
      |PRINT;
   |FINSI;
|FPRC;

|DEFBUCLE Imprime;
#dscaw118#2;
;
INICIO;
FINAL;
;
NULL, Imprime;
|FIN;

|PROCESO LiquRepres;

   aAlfa = "rp" + Usuario; |NOME_DAT #dscaw118#aAlfa#;
   |DELINDEX #dscaw118; |ABRE #dscaw118;
   |BUCLE GrabaTempo;
   aAntRep = "XX"; |BUCLE Revisaw118;
   |BUCLE dscaw118;

   |IMPRE 0;
   |SI FSalida = 0;
      |SI Impresora ! "CrystalReport";
         |INFOR "dscaw118";
         |SI FSalida = 0;
            |CIMPR nNumLins; nContLin = 4;
            |BUCLE Imprime;
            |PIEINF; |FININF;
         |FINSI;
         |FINIMP;
      |SINO;
         |INFOR "dscw118a";
         |SI FSalida = 0;
            |BUCLE Imprime;
            |PIEINF; |FININF;
         |FINSI;
         |FINIMP;
      |FINSI;
   |FINSI;
   |CIERRA #dscaw118;   |DELINDEX #dscaw118;
|FPRC;

|PROCESO PintaTotales;
   ||ATRI I; |PINTA 0805, " Total pendiente "; |PINTA 0835, " Total liquidado "; |ATRI N;
   ||#dscaw079#0 = nTotalPdt; #dscaw079#1 = nTotalLiq;
   ||PINTA 0822, #dscaw079#0; |PINTA 0852, #dscaw079#1;

   |HAZ CambiosPantalla;

   |ATRI I; |PINTA 0901, " Pendiente "; |PINTA 0925, " Liquidado : Efectivo             Pagares"; |ATRI N;
   |DDEFECTO #dscaw079;
   #dscaw079#0 = nTotalPdt; #dscaw079#1 = nTotalLiq;
   |PINTA 0912, #dscaw079#0;
   #dscaw079#0 = nTotalEfe; #dscaw079#1 = nTotalPag;
   |PINTA 0947, #dscaw079#0; |PINTA 0967, #dscaw079#1;
|FPRC;

|PROCESO TotalPagare;
   nTotalPag = nTotalPag + #dscaz001#8;
|FPRC;

|DEFBUCLE TotalPagare;
#dscaz001#1;
33,31;
00001, aEntPag, aNumPag;
99999, aEntPag, aNumPag;
;
NULL, TotalPagare;
|FIN;

|PROCESO DivideRecibo;
   || Si hay algo liquidado, hay que crear un recibo por lo liquidado, otro
   ||    por el importe del pagare y otro por lo que resta pendiente (en
   ||    caso de que lo haya).
   || Si no hay nada liquidado, hay que crear un recibo por el importe del
   ||    pagare y otro por lo que resta pendiente (en caso de que lo haya)

   |LEE 000#dscam003.u;
   |SI  FSalida = 0;
      NuevoDoc = #dscam003#40 + 1;
   |SINO;
      NuevoDoc = 1;
   |FINSI;

   |DDEFECTO #dscam003;
   #dscam003#40 = #dscaz001#21;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#16 ! 0;
         |SI #dscam051#3 = "S";
            |SALVA_FICHA #dscam003;
            enBanco = -1;
            enEmpCartera = -1;   enEmpGestion = #dscam003#46;
            eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
            nImporte = #dscaz001#8; nImporte = (nImporte / #dscam003#59) ! nDeci_Div;
            eaTipoOper = "-7+4";
            |HAZ BucleRiesgo;
            |REPON_FICHA #dscam003;
         |FINSI;
      |FINSI;

      aSerDiv = #dscam003#0;
      #dscam003#14 = "D";
      #dscam003#15 = "Dividido";
      nTotLiquD = #dscam003#23;
      nTotLiquB = #dscam003#61;
      nTotPdteD = #dscam003#31;
      nTotPdteB = #dscam003#65;
      nTotDifCm = #dscam003#56;
      aDivisa   = #dscam003#57;
      aNomDiv   = #dscam003#58;
      nCambioDiv= #dscam003#59;
      nGtosArrastradosD = #dscam003#101 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      nGtosArrastradosB = #dscam003#102 + #dscam003#62 + #dscam003#63 + #dscam003#66;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;

      |SI #dscam003#23 ! 0;
         #dscam003#40 = NuevoDoc;
         |GRABA 020#dscam003.b;
         || #dscam003#1 = 0;  Tiquet: 10028/1113 (Hasta el |FPRC !!!)
         || #dscam003#2 = 0;
         #dscam003#14 = "L"; #dscam003#15 = "Liquidado por division";
         #dscam003#16 = 0;
         #dscam003#31 = 0; #dscam003#65 = 0;
         #dscam003#17 = 0; #dscam003#37 = 0;
         #dscam003#26 = "01.01.0000";
         #dscam003#56 = nTotDifCm;
         #dscam003#22 = nTotLiquD; #dscam003#60 = nTotLiquB - nTotDifCm;
         #dscam003#30 = nTotLiquD; #dscam003#64 = nTotLiquB;
         #dscam003#23 = nTotLiquD; #dscam003#61 = nTotLiquB;
         #dscam003#41 = 0;  #dscam003#49 = "N";
         #dscam003#57 = aDivisa;
         #dscam003#58 = aNomDiv;
         #dscam003#59 = nCambioDiv;
         #dscam003#70 = ""; #dscam003#72 = "";
         #dscam003#82 = "S";
         #dscam003#83 = #dscaz001#21;
         #dscam003#87 = aSerDiv;
         #dscam003#88 = 0;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;

         #dscam004#17 = #dscaz001#21;
         #dscam004#3  = 1;
         |LEE 000#dscam004.];
         |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscaz001#21; |HACIENDO;
            |SALVA_FICHA #dscam004;

            || Antes de marcarlo como enlazable, debo ver si el antiguo ya esta
            ||   enlazado o tambien esta como no enlazable. Si lo esta, lo marco
            ||   como no enlazable, pero si no esta en contabilidad ni marcado
            ||   como no enlazable, debo permitir enlazar el nuevo.
            |SI #dscam004#55 ! "S";
               |ABRE #dscam067;
               |SI #dscam004#5 = "COB"; |O #dscam004#5 = "COP"; |O #dscam004#5 = "IMP";
                  #dscam004#55 = "N";

                  |DDEFECTO #dscam067;
                  #dscam067#0 = "CB";
                  #dscam067#1 = #dscam004#17; aAlfaEnl1 = #dscam067#1;
                  #dscam067#2 = #dscam004#3;  aAlfaEnl2 = #dscam067#2;
                  |LEE 000#dscam067.];
                  |SI FSalida = 0; |Y #dscam067#0 = "CB"; |Y #dscam067#1 = aAlfaEnl1; |Y #dscam067#2 = aAlfaEnl2;
                     #dscam004#55 = "S";
                  |FINSI;
               |SINO;
                  #dscam004#55 = "S";
               |FINSI;
               |CIERRA #dscam067;
            |FINSI;

            #dscam004#17 = NuevoDoc;
            |GRABA 020#dscam004.n;
            |REPON_FICHA #dscam004;
            |LEE 000#dscam004.s;
         |SIGUE;

         |SALVA_DATOS #dscam003;
         |LEE 000#dscam003.u;
         |SI FSalida = 0;
            NuevoDoc = #dscam003#40 + 1;
         |SINO;
            NuevoDoc = 1;
         |FINSI;
         |REPON_DATOS #dscam003;
         #dscam003#56 = 0;
      |FINSI;

      ||SI #dscaz001#36 < nTotPdteD; || Tiquet 001928-00401  ABDON
      |SI #dscaz001#8 < nTotPdteD;
         #dscam003#40 = NuevoDoc;
         |GRABA 020#dscam003.b;
         || #dscam003#1 = 0;
         || #dscam003#2 = 0;
         #dscam003#16 = 0;
         #dscam003#17 = 0; #dscam003#37 = 0;
         #dscam003#26 = "01.01.0000";
         #dscam003#22 = nTotPdteD - #dscaz001#8; #dscam003#60 = #dscam003#22 / nCambioDiv;
         #dscam003#30 = nTotPdteD - #dscaz001#8; #dscam003#64 = #dscam003#30 / nCambioDiv;
         #dscam003#31 = nTotPdteD - #dscaz001#8; #dscam003#65 = #dscam003#31 / nCambioDiv;
         #dscam003#23 = #dscam003#30 - #dscam003#31; #dscam003#61 = #dscam003#64 - #dscam003#65;
         #dscam003#24 = 0; #dscam003#25 = 0; #dscam003#38 = 0;
         #dscam003#62 = 0; #dscam003#63 = 0; #dscam003#66 = 0;
         #dscam003#41 = 0;  #dscam003#49 = "N";
         #dscam003#57 = aDivisa;
         #dscam003#58 = aNomDiv;
         #dscam003#59 = nCambioDiv;
         #dscam003#70 = ""; #dscam003#72 = "";
         #dscam003#78 = 0;  #dscam003#79 = 0;
         #dscam003#82 = "S";
         #dscam003#83 = #dscaz001#21;
         #dscam003#87 = aSerDiv;
         #dscam003#88 = 0;
         #dscam003#14 = "P"; #dscam003#15 = "Pendiente de cobro";
         |SI #dscam003#30 ] nGtosArrastradosD;
            #dscam003#101 = nGtosArrastradosD; nGtosArrastradosD = 0;
            #dscam003#102 = nGtosArrastradosB; nGtosArrastradosB = 0;
         |SINO;
            #dscam003#101 = #dscam003#30; nGtosArrastradosD = nGtosArrastradosD - #dscam003#30;
            #dscam003#102 = #dscam003#64; nGtosArrastradosB = nGtosArrastradosB - #dscam003#64;
         |FINSI;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;

         |SALVA_DATOS #dscam003;
         |LEE 000#dscam003.u;
         |SI FSalida = 0;
            NuevoDoc = #dscam003#40 + 1;
         |SINO;
            NuevoDoc = 1;
         |FINSI;
         |REPON_DATOS #dscam003;
         #dscam003#56 = 0;

         #dscam003#40 = NuevoDoc;
         |GRABA 020#dscam003.b;
         || #dscam003#1 = 0;
         || #dscam003#2 = 0;
         #dscam003#16 = 0;
         #dscam003#17 = 0; #dscam003#37 = 0;
         #dscam003#26 = "01.01.0000";
         #dscam003#22 = #dscaz001#8; #dscam003#60 = #dscam003#22 / nCambioDiv;
         #dscam003#30 = #dscaz001#36; #dscam003#64 = #dscam003#30 / nCambioDiv;
         #dscam003#31 = #dscaz001#36; #dscam003#65 = #dscam003#31 / nCambioDiv;
         #dscam003#23 = #dscam003#30 - #dscam003#31; #dscam003#61 = #dscam003#64 - #dscam003#65;
         #dscam003#24 = 0; #dscam003#25 = 0; #dscam003#38 = 0;
         #dscam003#62 = 0; #dscam003#63 = 0; #dscam003#66 = 0;
         #dscam003#41 = 0;  #dscam003#49 = "N";
         #dscam003#57 = aDivisa;
         #dscam003#58 = aNomDiv;
         #dscam003#59 = nCambioDiv;
         #dscam003#70 = ""; #dscam003#72 = "";
         #dscam003#82 = "S";
         #dscam003#83 = #dscaz001#21;
         #dscam003#87 = aSerDiv;
         #dscam003#88 = 0;
         #dscam003#14 = "P"; #dscam003#15 = "Pendiente de cobro";
         #dscam003#101 = nGtosArrastradosD;
         #dscam003#102 = nGtosArrastradosB;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |SINO;
         #dscam003#40 = NuevoDoc;
         |GRABA 020#dscam003.b;
         || #dscam003#1 = 0;
         || #dscam003#2 = 0;
         #dscam003#16 = 0;
         #dscam003#17 = 0; #dscam003#37 = 0;
         #dscam003#26 = "01.01.0000";
         #dscam003#22 = nTotPdteD; #dscam003#60 = #dscam003#22 / nCambioDiv;
         #dscam003#30 = nTotPdteD; #dscam003#64 = #dscam003#30 / nCambioDiv;
         #dscam003#31 = nTotPdteD; #dscam003#65 = #dscam003#31 / nCambioDiv;
         #dscam003#23 = #dscam003#30 - #dscam003#31; #dscam003#61 = #dscam003#64 - #dscam003#65;
         #dscam003#24 = 0; #dscam003#25 = 0; #dscam003#38 = 0;
         #dscam003#62 = 0; #dscam003#63 = 0; #dscam003#66 = 0;
         #dscam003#41 = 0;  #dscam003#49 = "N";
         #dscam003#57 = aDivisa;
         #dscam003#58 = aNomDiv;
         #dscam003#59 = nCambioDiv;
         #dscam003#70 = ""; #dscam003#72 = "";
         #dscam003#82 = "S";
         #dscam003#83 = #dscaz001#21;
         #dscam003#87 = aSerDiv;
         #dscam003#88 = 0;
         #dscam003#14 = "P"; #dscam003#15 = "Pendiente de cobro";
         #dscam003#101 = nGtosArrastradosD;
         #dscam003#102 = nGtosArrastradosB;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |FINSI;

      eaUsuario = Usuario % 0810;
      eaDescr   = "DIVISION DOCUMENTO VENTA (" + (("000000000" + #dscaz001#21) % -109) + ")";
      eaTipoReg = "DV";  eaNumero = ("000000000" + #dscaz001#21) % -109;
      eaTipoOp  = "A";   enImpAnt = #dscam003#30; enImpAct = 0;
      |HAZ GrabaAudit;
   |FINSI;
|FPRC;

|PROCESO MensaAntes; |TIPO 7;
   |SI #dscaw007#31 = "G";
      |MENSA "    <F2> Consulta clientes";
   |SINO;
      |MENSA "    <F2> Consulta cuentas contables";
   |FINSI;
|FPRC;

|PROCESO MensaDespues;
   |SI #dscaw007#31 = "G";
      |SI Campo = 1; |O Campo = 2;  |BLIN 4; |FINSI;
   |SINO;
      |SI Campo = 32; |O Campo = 33; |BLIN 4; |FINSI;
   |FINSI;
|FPRC;

|PROCESO MiraCliente;
   TipoCliente = #dscaw007#31;
   enExistOblig = 1;
   CodCliente = #dscaw007#Campo#;

   DCampoG = Campo; HCampoG = Campo;
   DCampoC = Campo; HCampoC = Campo;
   |HAZ ExisteCliente;
   #dscaw007#Campo# = CodCliente; |PINTA #dscaw007#Campo#;
|FPRC;

|PROCESO GrabaExt;
   aAlfa = PARAMETRO;
   aAlfa1 = aAlfa - ":";
   nCalc = ((FSalida / 100) ! 0) + 99; aSerie    = aAlfa % nCalc;
   nCalc = FSalida + 198;               aAlfa    = aAlfa % nCalc;
   aAlfa1 = aAlfa - ":";
   nCalc = ((FSalida / 100) ! 0) + 99; aAlfa2    = aAlfa % nCalc; nFactura = aAlfa2;
   nCalc = FSalida + 198;               aAlfa    = aAlfa % nCalc;
   aAlfa1 = aAlfa - ":";
   nCalc = ((FSalida / 100) ! 0) + 99; aAlfa2    = aAlfa % nCalc; nRecibo  = aAlfa2;
   nCalc = FSalida + 198;               aAlfa    = aAlfa % nCalc;
   aAlfa1 = aAlfa - ":";
   nCalc = ((FSalida / 100) ! 0) + 99; aAlfa2    = aAlfa % nCalc; fFecha = aAlfa2;
   nCalc = FSalida + 198;               aAlfa    = aAlfa % nCalc;
   aAlfa1 = aAlfa - ":";
   nCalc = ((FSalida / 100) ! 0) + 99; aAlfa2    = aAlfa % nCalc; nImporte = aAlfa2;
   nCalc = FSalida + 198;               aAlfa    = aAlfa % nCalc;
   aAlfa1 = aAlfa - ":";
   nCalc = ((FSalida / 100) ! 0) + 99; aAlfa2    = aAlfa % nCalc; fFecCob = aAlfa2;
   nCalc = FSalida + 198;               aAlfa    = aAlfa % nCalc;
   aAlfa1 = aAlfa - ":";
   nCalc = ((FSalida / 100) ! 0) + 99; aAlfa2    = aAlfa % nCalc; aCtaCob  = aAlfa2;
   nCalc = FSalida + 198;               aAlfa2 = aAlfa % nCalc;   nEmpGest = aAlfa2;

   |DFICB aAlfa; |QBF aAlfa;
   |PATH_DAT #dscam045#aAlfa#; |ABRE #dscam045;
   #dscam045#0 = nEmpGest;
   #dscam045#1 = 1;
   |LEE 000#dscam045.];
   |PARA; |SI FSalida = 0; |Y #dscam045#0 = nEmpGest; |HACIENDO;
      |SI #dscam045#4 [ aSerie; |Y #dscam045#5 ] aSerie; Empresa = #dscam045#6; |SAL; |FINSI;
      |LEE 000#dscam045.s;
   |SIGUE;
   |CIERRA #dscam045;
   enEmpCartera = Empresa;
   |HAZ Tipo8; |HAZ TomaDecim;

   |DFICB aAlfa; |QBF aAlfa; aAlfa = aAlfa + (("00000" + Empresa) % -105) + "/";

   |PATH_DAT #dscaz001#aAlfa#; |PATH_DAT #dscam003#aAlfa#;
   |PATH_DAT #dscam004#aAlfa#; |PATH_DAT #dscam066#aAlfa#;
   |PATH_DAT #dscam051#aAlfa#;

   Comodin = "cc" + Usuario; |NOME_DAT #0 Comodin;
   |DELINDEX #dscaz001;

   Comodin = "ti" + Usuario; |NOME_DAT #dscaw175#Comodin#;
   |DELINDEX #dscaw175; |ABRE #dscaw175;

   |ABRE #dscaz001;
   |ABRE #dscam003;
   |ABRE #dscam004;
   |ABRE #dscam066;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
   |FINSI;

   aSerie = ((aSerie + "     ") % 0105);

   |SELECT #6#dscam003;
   |DDEFECTO #dscam003;
   #dscam003#0 = aSerie;
   #dscam003#1 = nFactura;
   #dscam003#2 = nRecibo;
   |LEE 000#dscam003.];
   |PARA; |SI FSalida = 0; |Y #dscam003#0 = aSerie; |Y #dscam003#1 = nFactura; |Y #dscam003#2 = nRecibo; |HACIENDO;
      |SI fFecha = #dscam003#4; |SAL; |FINSI;
      |LEE 000#dscam003.s;
   |SIGUE;
   |SI FSalida = 0; |Y #dscam003#0 = aSerie; |Y #dscam003#1 = nFactura;
    |Y #dscam003#2 = nRecibo; |Y fFecha = #dscam003#4;
      |DDEFECTO #dscaz001;
      #dscaz001#0  = 1;
      #dscaz001#1  = aSerie;
      #dscaz001#2  = nFactura;
      #dscaz001#3  = nRecibo;
      #dscaz001#4  = #dscam003#5;
      #dscaz001#5  = #dscam003#32;
      #dscaz001#6  = #dscam003#6;
      #dscaz001#7  = #dscam003#31;
      #dscaz001#8  = nImporte;
      #dscaz001#9  = #dscam003#30;
      #dscaz001#10 = "*";
      |SI nConfirmes = 0;
         #dscaz001#11 = #dscam003#3;
      |SINO;
         #dscaz001#11 = #dscam003#71;
      |FINSI;
      #dscaz001#12 = #dscam003#4;
      #dscaz001#13 = aCtaCob; aAlfa = #dscaz001#13; |QBF aAlfa;
      |SI aAlfa = ""; #dscaz001#13 = #dscam051#4; |FINSI;
      #dscaz001#14 = fFecCob;
      #dscaz001#15 = 0;
      #dscaz001#16 = #dscam003#13;
      #dscaz001#17 = #dscam003#12;
      #dscaz001#20 = #dscam003#27;
      #dscaz001#21 = #dscam003#40;
      #dscaz001#22 = #dscam003#44;
      #dscaz001#23 = #dscam003#45;
      #dscaz001#24 = #dscam003#46;
      #dscaz001#26 = #dscam003#57;
      #dscaz001#27 = #dscam003#58;
      #dscaz001#28 = #dscam003#59;
      #dscaz001#29 = #dscam003#59;
      #dscaz001#30 = #dscam051#21;
      #dscaz001#31 = "";
      |GRABA 020#dscaz001.c;

      eaVarLog = "Marcado para el cobro el documento n§ " + #dscam003#40; |HAZ AnyadeLog;

      SwPagTal = 0;
      |ABRE #dscam030;
      aAlfa = ("43" + Usuario + "zzzzzzzz") % 0108; |NOME_DAT #dscaw043#aAlfa#;
      |DELINDEX #dscaw043; |ABRE #dscaw043;
      |HAZ Volcado;
      |CIERRA #dscaw043; |CIERRA #dscam030;
   |FINSI;
   |HAZ LiberaRet;

   eaSesion   = Usuario; |HAZ LimpiaTempo;
/*
   |LEE 000#dscaw175.p;
   |SI FSalida = 0;
      aAlfa = "dscaz190.tab;ti" + Usuario; |SUB_EJECUTA aAlfa;
   |FINSI;
*/
   |CIERRA #dscaw175; |DELINDEX #dscaw175;
   |CIERRA #dscam051;
   |CIERRA #dscam066;
   |CIERRA #dscam004;
   |CIERRA #dscam003;
   |CIERRA #dscaz001;

   |HAZ Tipo9;
|FPRC;

|PROCESO CambiaTipoRec;
   |SI nSwLuxe = 1;
      |DDEF aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "luxem001.mas";
      |CARGA_DEF aAlfa, Referen@;
      |SI FSalida = 0;
         |DFICE aAlfa; |QBF aAlfa; |PATH_DAT #Referen@#aAlfa#;
         |ABRE #Referen@;
         #Referen@#0 = #dscaz001#39;
         |LEE 000#Referen@.=;
         |SI FSalida = 0;
            #dscam003#12 = #Referen@#2;
         |FINSI;
         |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
      |FINSI;
   |FINSI;
|FPRC;

/***************************************************************************
****************************************************************************
****************************************************************************/

|PROCESO MesLetra;
   |SI Mes = "01"; Mes = "Enero     "; |FINSI;
   |SI Mes = "02"; Mes = "Febrero   "; |FINSI;
   |SI Mes = "03"; Mes = "Marzo     "; |FINSI;
   |SI Mes = "04"; Mes = "Abril     "; |FINSI;
   |SI Mes = "05"; Mes = "Mayo      "; |FINSI;
   |SI Mes = "06"; Mes = "Junio     "; |FINSI;
   |SI Mes = "07"; Mes = "Julio     "; |FINSI;
   |SI Mes = "08"; Mes = "Agosto    "; |FINSI;
   |SI Mes = "09"; Mes = "Septiembre"; |FINSI;
   |SI Mes = "10"; Mes = "Octubre   "; |FINSI;
   |SI Mes = "11"; Mes = "Noviembre "; |FINSI;
   |SI Mes = "12"; Mes = "Diciembre "; |FINSI;
|FPRC;

|PROCESO CalcImpDivV;
   TotDividido = TotDividido + #dscam003#30;
|FPRC;

|DEFBUCLE CalcImpDivV;
#dscam003#1;
82, 83;
000000001, "S", DocDividido;
999999999, "S", DocDividido;
;
NULL, CalcImpDivV;
|FIN;

|PROCESO RecibosCarta;
   |PRINT;
|FPRC;

|DEFBUCLE RecibosCarta;
#dscam003#8;
;
000000001,DocAgrupador;
999999999,DocAgrupador;
be;
NULL,RecibosCarta;
|FIN;

|DEFBUCLE RecibosCartaDiv;
#dscam003#1;
82,83;
000000001,"S",DocDividido;
999999999,"S",DocDividido;
be;
NULL,RecibosCarta;
|FIN;

|PROCESO GeneraCarta;
   |IMPRE 0;
   |SI FSalida ! 0; |ACABA; |FINSI;

   |SI aSwAgrDiv = "A";
      aInforme = "Carta de agrupacion"; |HAZ ObtenInforme;
   |FINSI;
   |SI aSwAgrDiv = "D";
      aInforme = "Carta de division"; |HAZ ObtenInforme;
      |SI aInforme = "Carta de division"; aInforme = "cartaex2"; |FINSI;
   |FINSI;

   |INFOR aInforme;
   |SI FSalida ! 0; |ACABA; |FINSI;

   eaCodigo = #dscam003#32; eaTipoCod = "C"; aCuenta = #dscam003#5; |HAZ LeeDatos;
   eaSwCmpVta  = "V";
   |SI aSwAgrDiv = "A"; |BUCLE RecibosCarta;    |FINSI;
   |SI aSwAgrDiv = "D"; |BUCLE RecibosCartaDiv; |FINSI;

   |PIEINF;
   |FININF;
   |FINIMP;
|FPRC;

|PROCESO SacaCartaDiv;
   DocDividido = #dscam003#83; fFechaEmi = #dscam003#4;
   DDividido = ("000000000" + DocDividido) % -109;
   #dscam003#40 = DocDividido; |LEE 000#dscam003.=;
   FecDividido  = #dscam003#4; FecVtoDiv  = #dscam003#3;
   eaSerieDiv   = #dscam003#0; eaFactuDiv = ("000000" + #dscam003#1) % -106;
   TotDividido = 0; |BUCLE CalcImpDivV;
   Dia  = fFechaEmi % 0102; Dia = ("00" + Dia) % -102;
   Mes  = fFechaEmi % 0402; Mes = ("00" + Mes) % -102; |HAZ MesLetra; |QBF Mes;
   anyo = fFechaEmi % -104;
   FecEmision = Dia + " de " + Mes + " de " + anyo;
   |HAZ GeneraCarta;
|FPRC;

|PROCESO SacaCarta;
   |SI #dscam003#49 = "S"; aSwAgrDiv = "A"; |HAZ SacaCartaAgr; |FINSI;
   |SI #dscam003#82 = "S"; aSwAgrDiv = "D"; |HAZ SacaCartaDiv; |FINSI;
|FPRC;

|PROCESO SacaCartaAgr;
   DocAgrupador = #dscam003#40;
   DAgrupador = ("000000000" + DocAgrupador) % -109;
   #dscam003#40 = DocAgrupador; |LEE 000#dscam003.=;
   FecAgrup  = #dscam003#4; FecVtoAgr = #dscam003#3;
   TAgrup   = #dscam003#30;
   Dia  = FecAgrup % 0102; Dia = ("00" + Dia) % -102;
   Mes  = FecAgrup % 0402; Mes = ("00" + Mes) % -102; |HAZ MesLetra; |QBF Mes;
   anyo = FecAgrup % -104;
   FecEmision = Dia + " de " + Mes + " de " + anyo;
   |HAZ GeneraCarta;
|FPRC;

|PROCESO MiraLim;
|FPRC;

|PROCESO CambiosPantalla;
   |SI nConfirmes = 1;
      |ATRI R; |PINTA 0601, " COBRO/RECEPCION DE ";
      |ATRI R; |PINTA 0701, "  TALONES/CONFIRMES ";

      |ATRI R; |PINTA 0568, "             ";
      |ATRI R; |PINTA 0668, "             ";
      |ATRI R; |PINTA 0743, " <F10> Asignar cta./vto. a marcados ";
      |ATRI N; |PINTA 0822, "                                                           ";
   |FINSI;
|FPRC;

|PROCESO IncorporaLog;
   |DBASS aAlfa1; |QBF aAlfa1;
   aAlfa1 = aAlfa1 + "contagen/log/"; |MKDIR aAlfa1;

   fFecha = ~; aAlfa2 = fFecha; |QBF aAlfa2;
   aAlfa2 = (aAlfa2 % 0102) + (aAlfa2 % 0402) + (aAlfa2 % 0704);
   |DBASS aAlfa1; |QBF aAlfa1;
   aAlfa1 = aAlfa1 + "contagen/log/" + aAlfa2 + ".log";
   |XABRE "A", aAlfa1, nHandle;
   |SI FSalida ] 0;
      aAlfa1 = "";
      aAlfa2 = Usuario % 0810; |QBF aAlfa2;
      aAlfa2 = (aAlfa2 + "          ") % 0110;
      aAlfa1 = aAlfa1 + aAlfa2;
      aAlfa2 = fFecha; |QBF aAlfa2; aAlfa1 = aAlfa1 + " " + aAlfa2;
      |HORA aAlfa2; |QBF aAlfa2; aAlfa1 = aAlfa1 + " " + aAlfa2;
      |MODULO aAlfa2; |QBF aAlfa2;
      aAlfa1 = aAlfa1 + " " + aAlfa2;
      aAlfa = aAlfa1 + " " + aAlfa;
      |XGRABA nHandle, aAlfa;
      |XCIERRA nHandle;
   |FINSI;
|FPRC;

|PROCESO RelRecibo; |TIPO 66;
   |CONSULTA_CLAVE #1#dscam003;
   |SI FSalida = 0;
      #dscaz001#21 = #dscam003#40; |PINTA #dscaz001#21;
   |FINSI;
   |ERROR; |ACABA;
|FPRC;

|PROGRAMA;
   |HAZ EsLuxe;
   |SI FSalida = 0;
      nSwLuxe = 1;
   |SINO;
      nSwLuxe = 0;
   |FINSI;

   |HAZ EsViuda;
   |SI FSalida = 0; nSwViuda = 1; |SINO; nSwViuda = 0; |FINSI;
   |HAZ EsArtenvas;
   |SI FSalida = 0; nSwArtenvas = 1; |SINO; nSwArtenvas = 0; |FINSI;

|| ABDON   17/10/2012   N§ tiquet 000160/00647
||     Esta opcion solo existia para los modulos de Viuda y de Artenvas.
||     Se determina de que debe estar en la estandar
||   |SI nSwViuda = 0; |Y nSwArtenvas = 0;
||      |SI PARAMETRO ! ""; |Y PARAMETRO ! "CF";
||         |HAZ GrabaExt; |ACABA;
||      |FINSI;
||   |SINO;
||      |SI PARAMETRO = "CF";
||         nConfirmes = 1;
||      |SINO;
||         nConfirmes = 0;
||      |FINSI;
||   |FINSI;

   |SI PARAMETRO ! ""; |Y PARAMETRO ! "CF";
      |HAZ GrabaExt; |ACABA;
   |FINSI;
   |SI PARAMETRO = "CF";
      nConfirmes = 1;
   |SINO;
      nConfirmes = 0;
   |FINSI;

   |CLS;
   |SI nConfirmes = 1;
      aAlfa = "Cobro y recepcion de talones/confirmes";
   |SINO;
      aAlfa = "Control de cobros";
   |FINSI;
   |CABEZA aAlfa;

   |HAZ Tipo8; |HAZ TomaDecim;

   eaVarLog = "Usuario " + (Usuario % 0810) + " [" + Usuario + "] entrando al control de cobros"; |HAZ AnyadeLog;

   |PINPA #0#0;
   ||PINDA #0#0;
   |ENTLINEAL #4#dscaz001,-1,7,19,0,infer,super;

   |HAZ CambiosPantalla;

   Empresa = #48#0;

   |MENU menu;
   Opcion = FSalida;
   |SI Opcion < 1; |O Opcion > 8; |ACABA; |FINSI;

   Comodin = "ti" + Usuario; |NOME_DAT #dscaw175#Comodin#;
   |DELINDEX #dscaw175; |ABRE #dscaw175;

   Comodin = "cc" + Usuario; |NOME_DAT #0 Comodin;
   |DELINDEX #dscaz001;
   |ABRE #dscaz001;
   |ABRE #dscam003;
   |ABRE #dscam004;
   |ABRE #dscam066;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
   |FINSI;

   eaVarLog = "";
   |SI Opcion = 1; eaVarLog = "Entrando al orden por vencimiento "; |FINSI;
   |SI Opcion = 2; eaVarLog = "Entrando al orden por emision ";     |FINSI;
   |SI Opcion = 3; eaVarLog = "Entrando al orden por cliente ";     |FINSI;
   |SI Opcion = 4; eaVarLog = "Entrando al orden por factura ";     |FINSI;
   |SI Opcion = 5; eaVarLog = "Entrando al orden acotado ";         |FINSI;
   |SI Opcion = 6; eaVarLog = "Entrando a la entrada manual ";      |FINSI;
   |SI Opcion = 7; eaVarLog = "Entrando al orden por cobrador ";    |FINSI;
   |SI Opcion = 8; eaVarLog = "Entrando al orden por representante";|FINSI;
   |HAZ AnyadeLog;

   |SI Opcion = 1;
      |C_V #dscaz001#11,1,"S";
      |C_V #dscaz001#12,1,"N";
      |C_P #dscaz001#11,1,1346;
      |C_P #dscaz001#12,1,1348;
      |ATRI R;
      |PINTA 1152, "Vto";
      |ATRI N;
      |BUCLE Vencimiento;
   |FINSI;
   |SI Opcion = 2;
      |C_V #dscaz001#11,1,"N";
      |C_V #dscaz001#12,1,"S";
      |C_P #dscaz001#11,1,1348;
      |C_P #dscaz001#12,1,1346;
      |ATRI R;
      |PINTA 1152, "Emi";
      |ATRI N;
      |BUCLE Emision;
   |FINSI;
   |SI Opcion = 3; |BUCLE Cliente;     |FINSI;
   |SI Opcion = 4; |BUCLE Factura;     |FINSI;
   |SI Opcion = 5; |HAZ BucleAcotado;  |FINSI;
   |SI Opcion = 7; |HAZ Cobrador;      |FINSI;
   |SI Opcion = 8; |HAZ Representante; |FINSI;

/*
   |SI Opcion ] 1; |Y Opcion [ 4;
      |PTEC 815; |PTEC 814;
      |PTEC 809; |PTEC 809; |PTEC 809; |PTEC 809;
      |PTEC 809; |PTEC 809; |PTEC 809; |PTEC 809;
      |PTEC 814;
   |FINSI;
*/
   |ET Continua;

   |PINPA #0#0;
   |SI nSwRepre = 1;
      |ENTLINEAL #4#dscaz001,-1,7,19,0,infer,super;
      nSwSal = 0; nClave = 1;
      |PARA; |SI nSwSal = 0; |HACIENDO;
         nSwSal = 1;
         |PINPA #0#0;
         |SI nClave = 1; |ENTLINEAL #4#dscaz001,-3,1,19,0,infer,super; |FINSI;
         |SI nClave = 2; |ENTLINEAL #1#dscaz001,-1,1,19,0,infer,super; |FINSI;
         |SI nSwSal = 0;
            |SI nClave = 1;
               nClave = 2;
            |SINO;
               nClave = 1;
            |FINSI;
         |FINSI;
      |SIGUE;
   |SINO;
      |ENTLINEAL #1#dscaz001,-1,7,19,0,infer,super;
      |ENTLINEAL #1#dscaz001,-1,1,19,0,infer,super;
   |FINSI;


   |SI HaySelec > 0; |O HaySelecPag > 0;
      ||ATRI R;
      |CONFI "0400N¿ Conforme con los datos introducidos ? ";
      |SI FSalida = 0; |Y HaySelec > 0;
          nHay = 0;
          |BUCLE CheqCtaCobro;
          |SI nHay = 0;
               FSalida = 0;
          |SINO;
               |CONFI "0000N¿Volver a la entrada de cobros?. Indicando 'No' se anularán los cobros realizados";
               |SI FSalida = 0;
                    |VETE Continua;
               |SINO;
                    FSalida = "1";
               |FINSI;
          |FINSI;
      |FINSI;
      |SI FSalida = 0;
         SwPagTal = 0;
         nSwTagl  = 0;
         |HAZ EsTagloma;
         |SI FSalida = 0; nSwTagl = 1; |SINO; nSwTagl = 0; |FINSI;

         |SI nSwRepre = 1; |Y nSwLuxe = 1;
            aAlfa = "    " + &191 + " Emitir liquidaciones para representantes ?";
            |CONFI aAlfa;
            |SI FSalida = 0; |HAZ LiquRepres; |FINSI;
         |FINSI;

         |HAZ RepasaEnlaces;

         |SUB_EJECUTA_NP "dscaz169.tab;INICIO";

         |ABRE #dscam030;
         aAlfa = ("43" + Usuario + "zzzzzzzz") % 0108; |NOME_DAT #dscaw043#aAlfa#;
         |DELINDEX #dscaw043; |ABRE #dscaw043;
         |BUCLE MiraSec;

         |BUCLE Volcado;
         |SI SwPagTal = 1; |HAZ RevisaPagares; |FINSI;
         |BUCLE VuelcaSec;
         |CIERRA #dscaw043; |CIERRA #dscam030;

         |SUB_EJECUTA_NP "dscaz169.tab;FINAL";

      |FINSI;
      |SI aCobrad ! "";
         |CONFI "    NLiberar las asignaciones pendientes del cobrador ?";
         |SI FSalida = 0; |BUCLE BorraRelacs; |FINSI;

         |BUCLE EliminaLiq;
      |FINSI;
      ||ATRI N;
   |FINSI;
   |HAZ LiberaRet;

   eaSesion   = Usuario; |HAZ LimpiaTempo;

   |LEE 000#dscaw175.p;
   |SI FSalida = 0;
      aAlfa = "dscaz190.tab;ti" + Usuario; |SUB_EJECUTA aAlfa;
   |FINSI;
   |CIERRA #dscaw175; |DELINDEX #dscaw175;
   |CIERRA #dscam051;
   |CIERRA #dscam066;
   |CIERRA #dscam004;
   |CIERRA #dscam003;
   |CIERRA #dscaz001;

   |HAZ Tipo9;
|FPRO;
