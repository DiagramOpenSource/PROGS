|FICHEROS;
 dscaz216 #0;
 dscam073 #1;
 dscam049 #2;  || Confirming Cabeceras
 dscam050 #3;  || Confirming Lineas
 dscam008 #4;  || Mantenimiento pagos
 dscam030 #5;  || Mantenimiento enlaces
 dscaw013 #6;  || Temporal enlaces
 dscam051 #7;  || Parametros generales
 dscam014 #8;  || Bancos..............
 dscam040 #9;  || Provincias

 caclipro@ #100;
 dsam0104@;
 agim0016@;
 agifa112@;
 dsm00225@;

 dscaw225 #225; ||Tmp
|FIN;

|VARIABLES;
     &enConfirme = 0;
     &eaRefeCli = "";
     &efFecSop = @;
     &efFecPro = @;
     &eaEnlace = "";
     &eaCheq = "";

 aLon = "";
 nLon = 0;
 aConce = "";
 aConce1 = "";
 aConce2 = "";
 &eaEntidad    = "";
 &eaSucursal   = "";
 &eaCuenta     = "";
 &eaDC         = "";

 aPath = "";
 nSwIntegral = 0;
 nSwBasica = 0;
 nSwGestion = 0;
 nAvisa = 0;
 &fecha = @;
 &fp = "";
 &eaDirProv = "";
 &eaNifProv = "";
 &HayConta = 0;
 &eaCadena = "";

 &eaCodigo  = "";
 &eaTipoCod = "";
 &aCuenta   = "";

 &eaNif       = "";
 &eaNombre    = "";
 &eaApCorreos = "";
 &eaDireccion = "";
 &eaPoblacion = "";
 &eaProvincia = "";
 &eaCP        = "";
 &eaTelefono  = "";
 &eaFax       = "";
 &eaCodPais   = "";
 &eaPais      = "";
 &eaCodIBAN   = "";
 &eaCodBIC    = "";

 nCalc      = 0;
 nImporte   = 0;
 Prefijo    = "";
 aRef       = "";
 aDirec1    = "";
 aDirec2    = "";
 fFechaEmis = @;

 &aInforme = "";
 &eaNombre1 = "";
 &eaOrigen  = "";
 aDestino = "";
 Comodin  = "";
 nSwImpre = 0;

 &Niv1 = 0;
 &Niv2 = 0;
 &Niv3 = 0;
 &Niv4 = 0;
 &Niv5 = 0;
 &Niv6 = 0;
 &Divisa = "";

 aCuentaCt = ""; nNivel = 0;

 alfa1 = "";
 alfa2 = "";
 alfa3 = "";
 alfa4 = "";
 nume1 = 0;
 nume2 = 0;
 nume3 = 0;
 nume4 = 0;

 mens     = "";
 swErrorR = 0;
 swErrorP = 0;
 menR1    = "    No Existe Confirme !!!";
 menR2    = "    Confirme YA contabilizado ";
 menR3    = "2400SConfirme YA Emitido en Papel. Aceptar S/N ";
 menR4    = "2400NConfirme YA lanzado en Diskette. Aceptar S/N ";

 Nombre  = "";
 CodCli  = "";
 sino     = "";
 ceros    = "000000000000000";
 fechapre = "      ";
 dd       = "";
 mm       = "";
 aa       = "";
 cabe1    = "0406";  || Registro Cabecera
 cabe2    = "2";  || Registro Detalle Pagos
 cabe3    = "3";  || Registro Total
 aPaisSEPA = "";

 libre    = " ";
 libre40  = "";
 ca1  = "";
 ca2  = "";
 ca3  = "";
 ca4  = "";
 ca5  = "";
 ca6  = "";
 ca7  = "";
 ca8  = "";
 ca9  = "";
 ca10 = "";
 ca11 = "";
 ca12 = "";
 ca13 = "";
 ca14 = "";
 ca15 = "";
 ca115 = "";
 ca16 = "";
 ca17 = "";
 ca18 = "";
 ca19 = "";
 ca20 = "";
 ca21 = "";
 l          = 0;
 trecibos   = 0;
 timporte   = 0;

 NifProv    = "";
 NombreProv = "";
 DirecProv  = "";
 PoblaProv  = "";
 ProviProv  = "";
 Cp1Prov    = "";
 Cp2Prov    = "";
 TelefProv  = "";
 FaxProv    = "";
 PaisProv   = "";
 Entidad    = "";
 Sucursal   = "";
 DC         = "";
 Cuenta     = "";
 varios     = 0;

 handle     = "";
 fiche      = "";
 dirempr    = "";
 varalfa1   = "";
 varalfa2   = "";
 contenido  = "";
 swERROR    = 0;
 CampoDni   = "";
 Letra1     = "";
 Letra2     = "";
 Letra3     = "";
 Letra4     = "";
 Letra5     = "";
 Letra6     = "";
 Letra7     = "";
 Letra8     = "";
 Caracter   = "";
 Carac1     = 0;
 Carac2     = 0;
 Carac3     = 0;
 Carac4     = 0;
 Carac5     = 0;
 XPara      = 0;

 ccc        = "";
 c_alfa1    = "";
 c_alfa2    = "";
 c_nume1    = 0;
 c_nume2    = 0;
 c_nume3    = 0;

 direcc = "";
 numero = 0;
 longi  = 0;
 concepto = "";

 &programa = "";
 &ficcopia = "";
 aAlfa  = "";
 aAlfa1 = "";
 aAlfa2 = "";

     &eaVarDni  = "";
     &enCalcCif = 0;

  nTF = 0;
  nSwError = 0;
  aErrTit = "";

  aCountry = "";

  aChar1  = "";
  aCadena = "";

  nTotGeneral    = 0;
  nTotalGeneral  = 0;
  nRegsIndiv     = 0;
  nRegsGeneral   = 0;
  nRegTrSEPA     = 0;
  nTotTrSEPA     = 0;
  nSituacionSEPA = 0;
  nCont  = 0;
  nSwCab = 0;
|FIN;

|| *************************************************************************
|PROCESO Tiene;
     |SI nAvisa = 0;
          |QBF aAlfa;
          |SI aAlfa = "";
               nAvisa = 1;
               aAlfa = #caclipro@#10; |QBF aAlfa;
               |SI #caclipro@#23 = "C";
                    aAlfa = "0000Cliente: [" + aAlfa + "] con datos incompletos en contabilidad...";
               |SINO;
                    aAlfa = "0000Proveedor: [" + aAlfa + "] con datos incompletos en contabilidad...";
               |FINSI;
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CheqDatosPrv;
     #225#0 = #caclipro@#23;
     #225#1 = #caclipro@#10;
     |LEE 000#225=;
     |SI FSalida = 0;
          |ACABA;
     |SINO;
          |GRABA 020#225n;
     |FINSI;

     nAvisa = 0;
     aAlfa = #caclipro@#29; |HAZ Tiene;
     aAlfa = #caclipro@#30; |HAZ Tiene;
     aAlfa = #caclipro@#31; |HAZ Tiene;
     aAlfa = #caclipro@#32; |HAZ Tiene;
     aAlfa = #caclipro@#13; |HAZ Tiene;
     aAlfa = #caclipro@#14; |HAZ Tiene;
     aAlfa = #caclipro@#19; |HAZ Tiene;

     |SI #0#16 = "S";
         |SI nSwIntegral = 1;
            #dsam0104@#0 = #caclipro@#24;
            |LEE 000#dsam0104@.=;
            |SI FSalida = 0; |Y #dsam0104@#5 = "S";
               aAlfa = #caclipro@#38; |HAZ Tiene;
               aAlfa = #caclipro@#39; |HAZ Tiene;
               aAlfa = #caclipro@#40; |HAZ Tiene;
               aAlfa = #caclipro@#41; |HAZ Tiene;
            |FINSI;
         |FINSI;
         |SI nSwBasica = 1;
            #agim0016@#0 = #caclipro@#24;
            |LEE 000#agim0016@.=;
            |SI FSalida = 0; |Y #agim0016@#5 = "S";
               aAlfa = #caclipro@#38; |HAZ Tiene;
               aAlfa = #caclipro@#39; |HAZ Tiene;
               aAlfa = #caclipro@#40; |HAZ Tiene;
               aAlfa = #caclipro@#41; |HAZ Tiene;
            |FINSI;
         |FINSI;
     |FINSI;

     aAlfa = "";
     |SI #caclipro@#15 = 0; |HAZ Tiene; |FINSI;
     |SI #caclipro@#16 = 0; |HAZ Tiene; |FINSI;
|FPRC;

|PROCESO SacaNivel1;
   |QBF aCuentaCt;
   aAlfa = aCuentaCt % 0; nNivel = aAlfa;
   |SI nNivel = Niv1; nNivel = 1; |FINSI;
   |SI nNivel = Niv2; nNivel = 2; |FINSI;
   |SI nNivel = Niv3; nNivel = 3; |FINSI;
   |SI nNivel = Niv4; nNivel = 4; |FINSI;
   |SI nNivel = Niv5; nNivel = 5; |FINSI;
   |SI nNivel = Niv6; nNivel = 6; |FINSI;
|FPRC;

|PROCESO MiraParam; |TIPO 7;
   |SI #dscam051#1 = "S";
      Comodin = #dscam051#61;
      |C_M #dscaz216#14,1,Comodin;
   |SINO;
      |C_M #dscaz216#14,1,"N";
   |FINSI;
|FPRC;

|PROCESO ver_confirming; |TIPO 6;
 |SI FSalida = 2; |ACABA; |FINSI;
 |ABRE #dscam049;
 |HAZ leerem;
 |CIERRA #dscam049;
 |SI swErrorR ! 0;
     |SI swErrorR < 3;
         |MENAV mens;
         |ERROR;
         |ACABA;
     |SINO;
         |CONFI mens;
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;
 |FINSI;
 #dscaz216#2 = #dscam049#3; || Banco
 |HAZ TomaDatos;

 |PINTA 0935, #dscam049#2;   || Vto.
 |PINTA 0958, #dscam049#5;   || N§ Efectos
 |PINTA 1035, #dscam049#3;   || Banco
 |PINTA 1049, #dscam049#19;  || Importe Total
|FPRC;

|PROCESO TomaDatos;
   |ABRE #dscam073;
   #dscam073#0 = #dscaz216#2;
   |LEE 000#dscam073.=;
   |SI FSalida ! 0;
     |DDEFECTO #dscam073;
   |FINSI;
   |CIERRA #dscam073;

   #dscaz216#5 = #dscam073#23; |PINTA #dscaz216#5;
   #dscaz216#13 = #dscam073#24; |PINTA #dscaz216#13;
|FPRC;

|PROCESO leerem;
 swErrorR = 0;
 |DDEFECTO #dscam049;
 #dscam049#0 = #dscaz216#1;
 |LEE 001#dscam049.=;
 |SI FSalida ! 0;
     swErrorR = 1; mens = menR1;
 |SINO;
     Divisa = #dscam049#16; |HAZ TomaDecim;
     |SI #dscam049#8 = "S";
         swErrorR = 2; mens = menR2;
     |SINO;
         |SI #dscam049#7 = "S"; swErrorR = 3; mens = menR3; |FINSI;
         |SI #dscam049#7 = "D"; swErrorR = 4; mens = menR4; |FINSI;
     |FINSI;
     |ABRE #dscam014;
     #dscam014#0 = #dscam049#3;
     |LEE 000#dscam014.=;
     |CIERRA #dscam014;
 |FINSI;
|FPRC;

||...................................................................................
||***********************************************************
||****************** REGISTROS DE CABECERA ******************
||***********************************************************

|PROCESO CabeceraGeneral;
  ca1  = "01ORD34145001";
  aAlfa  = #dscam073#2; |QBF aAlfa;
  ca2  = (aAlfa + (" " * 9)) % 0109;
  ca3  = #dscam073#26;
  ca4  = #dscaz216#3;                 || Fecha creacion fichero
  ca4  = (ca4 % 0704) + (ca4 % 0402) + (ca4 % 0102);
  ca5  = #dscaz216#15;                || Fecha proceso soporte
  ca5  = (ca5 % 0704) + (ca5 % 0402) + (ca5 % 0102);
  ca6  = "A";
  aAlfa = (("0000" + #dscam073#4) % -104) + (("0000" + #dscam073#5) % -104) + (("00" + #dscam073#22) % -102);
  aAlfa = aAlfa + (("0000000000" + #dscam073#6) % -110) + #dscam073#27 + "00";

  aAlfa = aAlfa > aAlfa;
  aChar1 = ""; aCadena = "";
  |PARA; |SI aAlfa ! ""; |HACIENDO;
     aChar1 = aAlfa % 0101; aAlfa = aAlfa % 0299;
     |SI aChar1 ] "0"; |Y aChar1 [ "9";
         aCadena = aCadena + aChar1;
     |SINO;
        |SI aChar1 ] "A"; |Y aChar1 [ "Z"; |Y aChar1 ! "Ñ";
           nCalc = &aChar1; nCalc = nCalc - 55; aChar1 = nCalc;
           aCadena = aCadena + aChar1;
        |FINSI;
     |FINSI;
  |SIGUE;
  aAlfa = aCadena;
  |HAZ Mod9710; || Calculo el codigo IBAN

  aAlfa = #dscam073#27 + aAlfa + (("0000" + #dscam073#4) % -104) + (("0000" + #dscam073#5) % -104) + (("00" + #dscam073#22) % -102);
  aAlfa = aAlfa + (("0000000000" + #dscam073#6) % -110); |QBF aAlfa;
  aAlfa = (aAlfa + (" " * 34)) % 0134;
  ca7 = aAlfa;
  ca8 = "0"
  aAlfa = #dscam073#3; |QBF aAlfa;
  aAlfa = (aAlfa + (" " * 70)) % 0170;
  ca9 = aAlfa;
  aAlfa = #dscam073#7;
  aAlfa = (aAlfa + (" " * 50)) % 0150;
  ca10 = aAlfa;
  aAlfa = "C.P. " + (("00" + #dscam073#8) % -102) + (("000" + #dscam073#9) % -103);
  aAlfa = aAlfa + " " + #dscam073#10; |QBF aAlfa;
  aAlfa = (aAlfa + (" " * 50)) % 0150;
  ca11 = aAlfa;

  |ABRE #dscam040;
  #dscam040#0 = #dscam073#8;
  |LEE 000#dscam040.=;
  |SI FSalida ! 0; |DDEFECTO #dscam040; |FINSI;
  |CIERRA #dscam040;

  aAlfa = #dscam040#1; aAlfa = (aAlfa + (" " * 40)) % 0140; ca12 = aAlfa;
  ca13 = #dscam073#27;
  ca14 = " " * 200;
  ca15 = " " * 111;

  varalfa1 = Prefijo + ca1 + ca2 + ca3 + ca4 + ca5 + ca6 + ca7 + ca8 + ca9;
  eaCadena = varalfa1; |HAZ QuitaRaros; varalfa1 = eaCadena;
  contenido = handle + " " + varalfa1;
  |FGRABA contenido;

  varalfa1 = Prefijo + ca10 + ca11 + ca12 + ca13;
  eaCadena = varalfa1; |HAZ QuitaRaros; varalfa1 = eaCadena;
  contenido = handle + " " + varalfa1;
  |FGRABA contenido;

  contenido = handle + " " + ca14;
  |FGRABA contenido;

  contenido = handle + " " + ca15 + &#0#7 + &#0#8;
  |FGRABA contenido;
  l = l + 1;

  nTotGeneral = 0;
  nRegsGeneral = 1; ||Este
  nRegsIndiv  = 0;
|FPRC;

|PROCESO CabeceraSEPA;
   nSwCab = 1;
   |SI nCont = 1; ca1 = "02SCT34145"; |FINSI;
   |SI nCont = 2; ca1 = "02OTR34145"; |FINSI;
   |SI nCont = 3; ca1 = "02CHQ34145"; |FINSI;
   ca2  = #dscam073#2;
   ca3  = #dscam073#26;
   ca4 = " " * 200;
   ca5 = " " * 200;
   ca6 = " " * 178;

   contenido = handle + " " + ca1 + ca2 + ca3;
   |FGRABA contenido;

   contenido = handle + " " + ca4;
   |FGRABA contenido;

   contenido = handle + " " + ca5;
   |FGRABA contenido;

   contenido = handle + " " + ca6 + &#0#7 + &#0#8;
   |FGRABA contenido;
   nTotTrSEPA   = 0;
   nRegTrSEPA   = 0;

   l = l + 1;
   nRegsGeneral = nRegsGeneral + 1;
|FPRC;

||...................................................................................
||***********************************************************
||****************** REGISTROS INDIVIDUALES *****************
||***********************************************************

|PROCESO leecl_y_cobro;
 || .............. Lee la ficha del Cliente para obtener los datos necesarios

 NombreProv = "";
 DirecProv  = "";
 PoblaProv  = "";
 ProviProv  = "";
 Cp1Prov    = "";
 Cp2Prov    = "";
 TelefProv  = "";
 FaxProv    = "";
 PaisProv   = "";
 Entidad    = "";
 Sucursal   = "";
 DC         = "";
 Cuenta     = "";

 aRef = " " * 12;

 |DDEFECTO #dscam008;
 #dscam008#40 = #dscam050#13;
 |LEE 001#dscam008.=;

 fFechaEmis = #dscam008#4;

 eaCodigo = #dscam008#32; eaTipoCod = "P"; aCuenta = #dscam008#5; |HAZ LeeDatos;
 PaisProv = eaCodPais; |QBF PaisProv;

 #caclipro@#23 = "P";
 #caclipro@#10 = #dscam008#5;
 aCuentaCt = #dscam008#5; |HAZ SacaNivel1; #caclipro@#11 = nNivel;
 |LEE 000#caclipro@.=;
 |SI FSalida = 0;
    |SI #0#16 = "S";
          |HAZ CheqDatosPrv;
    |FINSI;
    NifProv    = eaNif;
    NombreProv = eaNombre;
    DirecProv  = eaDireccion;
    PoblaProv  = eaPoblacion;
    ProviProv  = eaProvincia;
    Cp1Prov    = eaCP % 0102;
    Cp2Prov    = eaCP % 0303;
    TelefProv  = eaTelefono;
    FaxProv    = eaFax;
    |SI PaisProv = "";
       PaisProv   = #caclipro@#24;
       |QBF PaisProv;
    |FINSI;
    |SI #dscaz216#4 = "1"; aRef = #caclipro@#10; |FINSI;
    |SI #dscaz216#4 = "2"; aRef = #caclipro@#0;  |FINSI;
    |QBF aRef; aRef = ((" " * 12) + aRef) % -112;

    aAlfa = "|NC"; nCalc = #caclipro@#aAlfa#;
    |SI nCalc > 29;
       Entidad  = #caclipro@#29;
       Sucursal = #caclipro@#30;
       DC       = #caclipro@#31;
       Cuenta   = #caclipro@#32;
    |SINO;
       aAlfa    = #caclipro@#18; |QBF aAlfa;
       Entidad  = aAlfa % 0104;
       Sucursal = aAlfa % 0504;
       DC       = aAlfa % 0902;
       Cuenta = #caclipro@#17; |QBF Cuenta;
       Cuenta = ("0000000000" + Cuenta) % -110;
    |FINSI;
 |SINO;
    aAlfa = "    No se encuentran los datos del proveedor " + #dscam008#6; |QBF aAlfa;
    aAlfa = aAlfa + " en la ficha de contabilidad";
    ||MENAV aAlfa;
 |FINSI;

 aAlfa = PaisProv; |QBF aAlfa;
 nSituacionSEPA = 0;
 |SI nSwIntegral = 1;
     #dsam0104@#0 = PaisProv;
     |LEE 000#dsam0104@.=;
     |SI FSalida = 0;
        |SI aAlfa = "ES";
           nSituacionSEPA = 1;
        |SINO;
           |SI #dsam0104@#7 = "S";
              nSituacionSEPA = 2;
           |SINO;
              nSituacionSEPA = 3;
           |FINSI;
        |FINSI;
     |FINSI;
 |FINSI;

 |SI nSwBasica = 1;
     #agim0016@#0 = PaisProv;
     |LEE 000#agim0016@.=;
     |SI FSalida = 0;
         #agim0016@#0 = #caclipro@#24;
         |LEE 000#agim0016@.=;
         |SI FSalida = 0;
            |SI aAlfa = "ES";
               nSituacionSEPA = 1;
            |SINO;
               |SI #agim0016@#7 = "S";
                  nSituacionSEPA = 2;
               |SINO;
                  nSituacionSEPA = 3;
               |FINSI;
            |FINSI;
         |FINSI;
     |FINSI;
 |FINSI;

 |SI nSituacionSEPA = 0; |Y nSwGestion = 1;
     #dsm00225@#0 = PaisProv;
     |LEE 000#dsm00225@.=;
     |SI FSalida = 0;
        |SI aAlfa = "ES";
           nSituacionSEPA = 1;
        |SINO;
           |SI #dsm00225@#7 = "S";
              nSituacionSEPA = 2;
           |SINO;
              nSituacionSEPA = 3;
           |FINSI;
        |FINSI;
     |FINSI;
 |FINSI;
 |SI nSituacionSEPA = 0;
     |SI aAlfa = "ES";
          nSituacionSEPA = 1;
     |SINO;
          nSituacionSEPA = 3;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO Concepto;
     aConce1 = "";
     aAlfa = #dscam073#11; |QBF aAlfa;
     |SI aAlfa ! ""; |Y #dscam073#21 = "S";
          aConce1 = aAlfa;
          |SI #dscam073#12 = "S";
               aConce1 = aConce1 + #dscam008#63; |QBF aConce1;
          |FINSI;
          |SI #dscam073#13 = "S";
               aConce1 = aConce1 + (("000"+#dscam050#5)%-103);
          |FINSI;
          |SI #dscam073#14 = "S";
               aConce1 = aConce1 + (#dscam008#4%102)+(#dscam008#4%402)+(#dscam008#4%704);
          |FINSI;
     |FINSI;

     aConce2 = "";
     aAlfa = #dscam073#16; |QBF aAlfa;
     |SI aAlfa ! ""; |Y #dscam073#21 = "S";
          aConce2 = aAlfa;
          |SI #dscam073#17 = "S";
               aConce2 = aConce2 + #dscam008#63; |QBF aConce2;
          |FINSI;
          |SI #dscam073#18 = "S";
               aConce2 = aConce2 + (("000"+#dscam050#5)%-103);
          |FINSI;
          |SI #dscam073#19 = "S";
               aConce2 = aConce2 + (#dscam008#4%102)+(#dscam008#4%402)+(#dscam008#4%704);
          |FINSI;
     |FINSI;

     aAlfa = aConce1 + " " + aConce2;
     aLon = aAlfa % A0; nLon = aLon; nLon = 140 - nLon;
     aConce = aAlfa + (" " * nLon);       || aqui tenemos 140 como maximo

     |SI nCont = 1; || long=140
         ||los que trae
     |FINSI;
     |SI nCont = 2; || long=72
          aConce = aConce % 172;
     |FINSI;
|FPRC;

|PROCESO IndividualSEPA;
   trecibos = trecibos + 1;
   |SI nCont = 1;
      ca1 = "03SCT34145002";
      ca2 = #dscaz216#13; |QBF ca2;
      aAlfa = ca2; |QBF aAlfa; ca2 = (aAlfa + (" " * 35)) % 0135;
      ca3 = "A";
      aAlfa = eaCodIBAN; |QBF aAlfa; ca4 = (aAlfa + (" " * 34)) % 0134;
   |FINSI;
   |SI nCont = 2;
      ca1 = "03OTR34145006";
      aAlfa = #dscam073#3; |QBF aAlfa; ca2 = (aAlfa + (" " * 35)) % 0135;
      ca3 = "A";
      aAlfa = eaCodIBAN; |QBF aAlfa; ca4 = (aAlfa + (" " * 34)) % 0134;
   |FINSI;
   |SI nCont = 3;
      ca1 = "03CHQ34145008";
      aAlfa = #dscam073#2; |QBF aAlfa; ca2 = (aAlfa + (" " * 35)) % 0135;
      aAlfa = #dscam073#3; |QBF aAlfa; aAlfa = (aAlfa + (" " * 70)) % 0170;
      ca2 = ca2 + aAlfa;
      ca3 = "";
      ca4 = "";
   |FINSI;
   nCalc = #dscam050#20;
   nCalc = (nCalc * 100) ! 0;
   |SI nCalc ] 0;
     ca5 = (("0" * 11) + nCalc) % -111;
   |SINO;
     nCalc = -nCalc;
     ca5 = "-" + ((("0" * 10) + nCalc) % -110);
   |FINSI;

   nTotTrSEPA = nTotTrSEPA + #dscam050#20;
   nTotGeneral = nTotGeneral + #dscam050#20;

   |SI nCont = 1; |O nCont = 2;
      ca6 = "3";
      ca7 = (eaCodBIC + (" " * 11)) % 111;
   |FINSI;
   |SI nCont = 3;
      ca6 = "";
      ca7 = "";
   |FINSI;
   contenido = handle + " " + ca1 + ca2 + ca3 + ca4 + ca5 + ca6 + ca7;
   |FGRABA contenido;

   |SI nCont = 1; |O nCont = 3;
      aAlfa = #dscam008#6; |QBF aAlfa; aAlfa = (aAlfa + (" " * 70)) % 0170;
      ca8 = aAlfa;
      aAlfa = eaDireccion; |QBF aAlfa; aAlfa = (aAlfa + (" " * 50)) % 0150;
      ca9 = aAlfa;
      aAlfa = eaCP + " " + eaPoblacion; |QBF aAlfa; aAlfa = (aAlfa + (" " * 50)) % 0150;
      ca10 = aAlfa;
      aAlfa = eaProvincia; |QBF aAlfa; aAlfa = (aAlfa + (" " * 40)) % 0140;
      ca11 = aAlfa;
      ca12 = eaCodPais; |QBF ca12; ca12 = (ca12 + "  ") % 0102;
      contenido = handle + " " + ca8 + ca9 + ca10 + ca11 + ca12;
      |FGRABA contenido;

      |SI nCont = 1;
         |HAZ Concepto;
         ca13 = aConce;
         ca14 = " " * 35;
         ca15 = "SUPP";
         ca16 = "SUPP";
         contenido = handle + " " + ca13 + ca14 + ca15 + ca16;
         |FGRABA contenido;

         ca17 = " " * 99;
         contenido = handle + " " + ca17 + &#0#7 + &#0#8;
         |FGRABA contenido;
      |FINSI;
      |SI nCont = 3;
         ca13 = "3";
         ca14 = " " * 200;
         contenido = handle + " " + ca13 + ca14;
         |FGRABA contenido;

         ca14 = " " * 58;  || se a¤ade los otros 58
         contenido = handle + " " + ca14 + &#0#7 + &#0#8;
         |FGRABA contenido;
      |FINSI;
   |FINSI;
   |SI nCont = 2;
      aAlfa = #dscam008#6; |QBF aAlfa; aAlfa = (aAlfa + (" " * 35)) % 0135;
      ca8 = aAlfa;
      aAlfa = eaDireccion; |QBF aAlfa;
      aAlfa = aAlfa + ", " + eaCP + " - " + eaPoblacion; |QBF aAlfa;
      aAlfa = aAlfa + " (" + eaProvincia; |QBF aAlfa;
      aAlfa = aAlfa + ", " + eaPais; |QBF aAlfa;
      aAlfa = aAlfa + ") "
      aAlfa = (aAlfa + (" " * 99)) % 0199;
      aAlfa = aAlfa + "      ";
      ca9 = aAlfa;
      |HAZ Concepto;
      ca10 = aConce;
      ca11 = #dscam008#63; |QBF ca11; ca11 = ((" " * 13) + ca11) % 0113;
      ca12 = "3";
      contenido = handle + " " + ca8 + ca9 + ca10 + ca11 + ca12;
      |FGRABA contenido;

      ca13 = " " * 200;
      contenido = handle + " " + ca13;
      |FGRABA contenido;

      ca14 = " " * 68;
      contenido = handle + " " + ca14 + &#0#7 + &#0#8;
      |FGRABA contenido;
   |FINSI;

   nRegTrSEPA   = nRegTrSEPA   + 1;
   nRegsIndiv   = nRegsIndiv   + 1;
   nRegsGeneral = nRegsGeneral + 1;
   l = l + 1;
   nTotalGeneral = nTotalGeneral + #dscam050#20;
|FPRC;

||...................................................................................
||***********************************************************
||****************** REGISTROS DE TOTALES *******************
||***********************************************************
|PROCESO TotalSEPA;
   |SI nCont = 1; ca1 = "04SCT"; |FINSI;
   |SI nCont = 2; ca1 = "04OTR"; |FINSI;
   |SI nCont = 3; ca1 = "04CHQ"; |FINSI;

   nTotTrSEPA = nTotTrSEPA * 100;
   ca2 = nTotTrSEPA;
   ca2 = (("0" * 17) + ca2) % -117;
   ca3 = nRegTrSEPA;
   ca3 = (("0" * 8) + ca3) % -108;
   nRegTrSEPA = nRegTrSEPA + 2;
   ca4 = nRegTrSEPA;
   ca4 = (("0" * 10) + ca4) % -110;

   ca5 = " " * 200;
   ca6 = " " * 200;
   ca7 = " " * 160;
   contenido = handle + " " + ca1 + ca2 + ca3 + ca4;
   |FGRABA contenido;

   contenido = handle + " " + ca5;
   |FGRABA contenido;

   contenido = handle + " " + ca6;
   |FGRABA contenido;

   contenido = handle + " " + ca7 + &#0#7 + &#0#8;
   |FGRABA contenido;

   nRegsGeneral = nRegsGeneral + 1;
   l = l + 1;
|FPRC;

|PROCESO TotalGeneral;
   nRegsGeneral = nRegsGeneral + 1;
   l = l + 1;

   ca1 = "99ORD";
   nCalc = nTotalGeneral;
   nCalc = (nCalc * 100) ! 0;
   ca2 = nCalc;
   ca2 = (("0" * 17) + ca2) % -117;

   aAlfa = nRegsIndiv;
   ca3 = (("0" * 8) + aAlfa) % -108;

   aAlfa = nRegsGeneral;
   ca4 = (("0" * 10) + aAlfa) % -110;

   ca5 = " " * 200;
   ca6 = " " * 200;
   ca7 = " " * 160;
   contenido = handle + " " + ca1 + ca2 + ca3 + ca4;
   |FGRABA contenido;

   contenido = handle + " " + ca5;
   |FGRABA contenido;

   contenido = handle + " " + ca6;
   |FGRABA contenido;

   contenido = handle + " " + ca7 + &#0#7 + &#0#8;
   |FGRABA contenido;
|FPRC;

|PROCESO ProcesaRec;
   |SI nSwGestion = 1;
          aAlfa = #48#17; |QBF aAlfa;
          aAlfa1 = aAlfa + "fich/" + (("00000" + #dscam008#46) % -105) + "/";
          |PATH_DAT #dsm00225@#aAlfa1#; |ABRE #dsm00225@;
   |FINSI;

   swERROR = 0;

   |HAZ leecl_y_cobro;

   eaNifProv = NifProv; eaDirProv = DirecProv;
   |SI nSwImpre = 1; |PRINT; |FINSI;
   |SI swERROR = 1; |ACABA; |FINSI;   || Salta este Cobro. NO el resto

   || Primero compruebo si pertenece al grupo que estoy pasando ...
   |SI nCont = 1; || Transferencias SEPA
      |SI nSituacionSEPA = 1; |O nSituacionSEPA = 2;
         |SI #dscam050#16 = "T";
            |SI nSwCab = 0; |HAZ CabeceraSEPA; |FINSI;
            |HAZ IndividualSEPA;
         |FINSI;
      |FINSI;
   |FINSI;
   |SI nCont = 2; || Transferencias No SEPA
      |SI #dscam050#16 = "T"; |Y nSituacionSEPA = 3;
         |SI nSwCab = 0; |HAZ CabeceraSEPA; |FINSI;
         |HAZ IndividualSEPA;
      |FINSI;
   |FINSI;
   |SI nCont = 3; || Cheques
      |SI #dscam050#16 = "C";
         |SI nSwCab = 0; |HAZ CabeceraSEPA; |FINSI;
         |HAZ IndividualSEPA;
      |FINSI;
   |FINSI;

   |SI nSwGestion = 1; |CIERRA #dsm00225@; |FINSI;
|FPRC;

|PROCESO ProcesaRecibos;
   |HAZ CabeceraGeneral;

   |PARA nCont = 1; |SI nCont [ 3; |HACIENDO nCont = nCont + 1;
      nSwCab = 0;
      |BUCLELIN 0ProcesaRec#2;
      |SI nSwCab ! 0;
         |HAZ TotalSEPA;
      |FINSI;
   |SIGUE;

   |HAZ TotalGeneral;
|FPRC;

|PROCESO Mod9710;
   aAlfa2 = aAlfa % 0101;
   |PARA; |SI aAlfa2 = "0"; |HACIENDO;
      aAlfa = aAlfa % 0299; aAlfa2 = aAlfa % 0101;
   |SIGUE;

   aAlfa1 = "";
   |PARA; |SI aAlfa ! ""; |HACIENDO;
      aAlfa2 = aAlfa % 0; nCalc = aAlfa2;
      |SI nCalc > 5;
         aAlfa2 = aAlfa % 0105; aAlfa = aAlfa % 0699;
      |SINO;
         aAlfa2 = aAlfa; aAlfa = "";
      |FINSI;
      aAlfa1 = aAlfa1 + aAlfa2;
      nCalc = aAlfa1;
      nCalc = nCalc / 97;
      aAlfa2 = nCalc;
      aAlfa2 = aAlfa2 - ".";
      |SI FSalida ! 0;
         nCalc = FSalida + 98;
         aAlfa2 = aAlfa2 % nCalc;
         aAlfa2 = "0." + aAlfa2; nCalc = aAlfa2;
      |SINO;
         nCalc = 0;
      |FINSI;
      nCalc = (nCalc * 97) ! 0;
      aAlfa1 = nCalc;
   |SIGUE;
   nCalc  = aAlfa1;
   nCalc = 98 - nCalc;
   aAlfa = ("00" + nCalc) % -102;
|| nCalc  = 98 - (nCalc - (((nCalc / 97) ! 0) * 97)); || MOD 97-10  ISO 7604
|FPRC;

|PROCESO varia_fich;
|| .......... Variables del Presentador, del Ordenante y comunes

  CodCli = #dscaz216#5; |QBF CodCli;
  CodCli = CodCli + "  "; CodCli = CodCli % 102;

  libre40 = libre * 40;
  || Nombre = #48#1 + libre40;     Nombre = Nombre % 140;
  Nombre = #dscam073#3 + libre40;     Nombre = Nombre % 140;

  alfa1 = #dscaz216#3;
  dd = alfa1 % A102;
  mm = alfa1 % A402;
  aa = alfa1 % A902;
  fechapre = aa + mm + dd;   || Fecha Formato a¤o + mes + dia
|FPRC;

|| **************************************************************************

|PROCESO pasecuencial; ||TIPO 3;
  |ABRE #dscam073;
  #dscam073#0 = #dscaz216#2;
  |LEE 000#dscam073.=;
  |SI FSalida ! 0;
     |DDEFECTO #dscam073;
  |FINSI;
  |CIERRA #dscam073;

  |ABRE #dscam049;
  |HAZ varia_fich;

  |CAMPO_VISUAL #dscaz216#10,1,"S"; #dscaz216#10 = 0;
  |CAMPO_VISUAL #dscaz216#11,1,"S"; #dscaz216#11 = 0;
  |CAMPO_VISUAL #dscaz216#12,1,"S"; #dscaz216#12 = 0;

|| ...................................................
  aAlfa = #48#17; |QBF aAlfa;
  aAlfa1 = aAlfa + "def/dsm00225.mas";
  |CARGA_DEF aAlfa1, dsm00225@;
  |SI FSalida = 0;
     nSwGestion = 1;
  |FINSI;

|| ...................................................
  aAlfa = #48#16; |QBF aAlfa;
  aAlfa1 = aAlfa + "def/caclipro.mas";
  |CARGA_DEF aAlfa1, caclipro@;
  |SI FSalida ! 0;
     |DESCARGA_DEF #dsm00225@;
     |MENAV "    Problemas para abrir el fichero de clientes/proveedores de contabilidad";
     |ERROR; |ACABA;
  |FINSI;

  aAlfa1 = aAlfa + "fich/" + (("00000" + #48#14) % -105) + #48#19 + "/";
  |PATH_DAT #100 aAlfa1; |ABRE #caclipro@;

  |ABRE #dscam008;         || Abre Mantenimiento de efectos

   aAlfa = aAlfa - "contagen/";
   aAlfa = aAlfa - "contagen\";
   aPath = aAlfa;
   aAlfa = aPath + "integral/";
   aAlfa1 = aAlfa + "def/dsam0104.mas";
   |CARGA_DEF aAlfa1, dsam0104@;
   |SI FSalida ! 0;
      aAlfa = aPath + "basica/";
      aAlfa1 = aAlfa + "def/agim0016.mas";
      |CARGA_DEF aAlfa1, agim0016@;
      |SI FSalida = 0;
         nSwBasica = 1;
         aAlfa1 = aPath + "basica/fich/";
         |PATH_DAT #agim0016@#aAlfa1#; |ABRE #agim0016@;
      |FINSI;
   |SINO;
      nSwIntegral = 1;
      aAlfa1 = aPath + "integral/fich/";
      |PATH_DAT #dsam0104@#aAlfa1#; |ABRE #dsam0104@;
   |FINSI;

|| Abrir Fichero Secuencial

  |DFICE dirempr;
  fiche = "wb  " + dirempr + "casecmin.seq";  || "nomfiche.ext";
  |QBF fiche;
  |FABRE fiche;
  handle = FSalida;
  |SI FSalida ] 0;
      |HAZ ProcesaRecibos;
  |FINSI;
  contenido = handle + " " + &#0#9;
  |FGRABA contenido;

  FSalida = handle;
  |FCIERRA FSalida;

  Pos = -1; |CIERRA #dscam008;
  |SI nSwIntegral = 1; |CIERRA #dsam0104@; |DESCARGA_DEF #dsam0104@; |FINSI;
  |SI nSwBasica = 1; |CIERRA #agim0016@; |DESCARGA_DEF #agim0016@; |FINSI;
  |DESCARGA_DEF #caclipro@;

  |SI nSwGestion = 1; |DESCARGA_DEF #dsm00225@; |FINSI;

  |SI HayConta = 1; |Y #dscam049#7 = "N"; |Y #dscaz216#14 ! "    ";
      |ABRE #dscam030;
      #dscam030#0 = #dscaz216#14;
      |LEE 010#dscam030.=;
      |SI FSalida = 0;
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #6 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         |DDEFECTO #dscaw013;
         #dscaw013#0  = 1;            #dscaw013#15 = #dscaz216#14;
         #dscaw013#5  = #dscam049#0;  #dscaw013#6  = #dscam049#0;
         #dscaw013#11 = "N";          #dscaw013#12 = 5;
         #dscaw013#13 = "dscam050";   #dscaw013#14 = 0;
         |GRABA 020#dscaw013.n;
         |CIERRA #dscaw013;
         Comodin = #dscaz216#14;
         Comodin = "dscam033.tab;" + Comodin + ",E";
         |LIBERA #dscam049; |CIERRAT #dscam049;
         |LIBERA #dscam050; |CIERRAT #dscam050;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam049; |LEE 101#dscam049.=;
         |ABRET #dscam050; |LEE 101#dscam050.=;
      |FINSI;
      |CIERRA #dscam030;
  |FINSI;

  |SI trecibos ! 0;
      #dscam049#0 = #dscaz216#1;
      |LEE 101#dscam049.=;

      #dscam049#7 = "D";
      |GRABA 020#dscam049.a; |LIBERA #dscam049;
  |FINSI;
  |CIERRA #dscam049;

/*
  |D_CUADRO 1261, 2280;
  |ATRI R;
  |PINTA 1362, " Numero Recibos   ";
  |PINTA 1562, " Numero Registros ";
  |PINTA 1762, " Importe Total    ";
  |ATRI 0;
  |PINTA 1462, "                  ";
  |PINTA 1662, "                  ";
  |PINTA 1862, "                  ";
  |ATRI 0;

  #dscaz216#10 = trecibos;  |PINTA #dscaz216#10;
  #dscaz216#11 = l;         |PINTA #dscaz216#11;
  #dscaz216#12 = timporte;  |PINTA #dscaz216#12;
*/
  |DFICE eaOrigen; |QBF eaOrigen;
  eaNombre1 = "casecmin.seq";
  |SUB_EJECUTA "dscaz032.tab";
|FPRC;

|PROGRAMA;
   |HAZ Tipo8;

   aAlfa = Usuario; |NOME_DAT #225 aAlfa; |DELINDEX #225;
   |ABRE #225;

   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.c;
   |FINSI;
   |CIERRA #dscam051;
   |SI #dscam051#1 = "S";
      #dscaz216#14 = #dscam051#29;
   |SINO;
      #dscaz216#14 = "";
   |FINSI;

   |SI enConfirme = 0;
         |CLS;
         |CABEZA " Emision normas SEPA: Norma 34.14";
         |PINPA #0#0; |PINDA #0#0;
         |ENDATOS #1#0;
   |SINO;
         #0#1 = enConfirme;
         #0#13 = eaRefeCli;
         #0#3 = efFecSop;
         #0#15 = efFecPro;
         #0#14 = eaEnlace;
         #0#16 = eaCheq;
         |HAZ ver_confirming;
         FSalida = 0;
   |FINSI;
   |SI FSalida = 0;
      nSwImpre = 0;
      |HAZ pasecuencial;
      |SI nSwImpre = 1; |PIEINF; |FININF; |FINIMP; nSwImpre = 0; |FINSI;
   |FINSI;

   |CIERRA #225; |DELINDEX #225;

   |HAZ Tipo9;
|FPRO;
