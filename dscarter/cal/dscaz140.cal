|FICHEROS;
   dscaz140 #0;

   dscam012 #10;
   dscam013 #11;
   dscam014 #12;

   dscam003 #20;
   dscam004 #21;
   dscaw068 #22,MANTE;
   dscam067 #23;
   dscaw013 #24;
|FIN;

|VARIABLES;
   &enSwError = 0;
   &eaUsuario  = "";
   &enImpAnt   = 0;
   &enImpAct   = 0;
   &eaDescr    = "";
   &eaTipoReg  = "";
   &eaNumero   = "";
   &eaTipoOp   = "";
   &eaTOperacion = "";
   &enNumDocum = 0;

   &enEmpCartera = 0;
   &enEmpGestion = 0;
   &Divisa       = "";
   &eaSerie      = "";
   &eaCliGest    = "";
   &nImporte     = 0;
   &eaTipoOper   = "";
   &enBanco      = 0;
   &nDeci_Div    = 0;
   &nDeci_Base   = 0;
   &eaSesion     = "";

   aEntidad      = "";
   aNumero       = "";
   aMarca        = "";
   aAlfa         = "";
   Comodin       = "";
   nMarca        = 0;
   nLinea        = 0;
   FEstado       = 0;
   Clave1        = 0;
   Clave2        = 0;
   Clave3        = "";

   nNumTotal     = 0;
   nNumSelec     = 0;
   nSwMensa      = 0;
   nHayAsto      = 0;
   nSwNuevo      = 0;
   nAntRem       = -1;

   nEmpresa      = 0; nPeriodo = 0;
   nDiario       = 0; fFecha   = @;
   nDocumto      = 0;

   nSwArtenvas   = 0;
|FIN;

|PROCESO MiraHisCobro;   ||Tiquet: 4741/159
     enSwError = 0;
     |ABRE #dscam004;
     #dscam004#17 = #dscaw068#5;
     #dscam004#3 = 99;
     |LEE 000#dscam004.];
     |SI FSalida = 0;
          |LEE 000#dscam004.a;
     |SINO;
          |LEE 000#dscam004.u;
     |FINSI;
     |SI FSalida = 0; |Y #dscam004#17 = #dscaw068#5;
          |SI #dscam004#5 ! "REM";
               enSwError = 1;
          |FINSI;
     |FINSI;
     |CIERRA #dscam004;
|FPRC;


|PROCESO MeteNuevos;
   |SI nMarca = 1; nMarca = 2; |SINO; nMarca = 1; |FINSI;

   #dscaw068#0 = #dscam067#1;
   #dscaw068#1 = #dscam067#2;
   |LEE 000#dscaw068.=;
   |SI FSalida = 0;
      |HAZ MiraHisCobro
      |SI enSwError = 0;
           |SI #dscaw068#4 = " ";
              #dscaw068#4 = "*"; |GRABA 020#dscaw068.a;
              nSwNuevo = 1;
           |FINSI;
      |FINSI;
   |SINO;
      |ABRE #dscam013;
      #dscam013#0 = #dscam067#1;
      #dscam013#1 = #dscam067#2;
      |LEE 000#dscam013.=;
      |SI FSalida ! 0; |DDEFECTO #dscam013; |FINSI;
      |CIERRA #dscam013;

      |ABRE #dscam003;
      #dscam003#40 = #dscam013#16;
      |LEE 000#dscam003.=;
      |SI FSalida ! 0; |DDEFECTO #dscam003; |FINSI;
      |CIERRA #dscam003;

      |DDEFECTO #dscaw068;
      #dscaw068#0 = #dscam067#1;
      #dscaw068#1 = #dscam067#2;
      #dscaw068#2 = #dscam003#3;
      |SI #dscam003#72 ! "    "; |O #dscam003#70 ! "          ";
         #dscaw068#3 = #dscam003#78;
      |SINO;
         #dscaw068#3 = #dscam003#30;
      |FINSI;
      #dscaw068#4 = "*";
      #dscaw068#5 = #dscam003#40;
      #dscaw068#6 = #dscam003#72;
      #dscaw068#7 = #dscam003#70;
      #dscaw068#8 = nMarca;
      #dscaw068#9 = #dscam003#57;
      |GRABA 020#dscaw068.n;
      nSwNuevo = 1;
   |FINSI;
|FPRC;

|DEFBUCLE MeteNuevos;
#dscam067#2;
;
nEmpresa, nPeriodo, nDiario, fFecha, nDocumto, 0000;
nEmpresa, nPeriodo, nDiario, fFecha, nDocumto, 9999;
;
NULL,MeteNuevos;
|FIN;

|PROCESO CompletaDatos;
   |ABRE #dscam003;
   #dscam003#40 = #dscaw068#5;
   |LEE 000#dscam003.=;
   |SI FSalida ! 0; |DDEFECTO #dscam003; |FINSI;
   |CIERRA #dscam003;

   |ABRE #dscam067; |DDEFECTO #dscam067;
   #dscam067#8 = 0;
   #dscam067#9 = 0;
   #dscam067#0  = "RM";
   #dscam067#1  = #dscam003#17;
   #dscam067#2  = #dscam003#37;
   #dscam067#3  = "V";
   #dscam067#11 = 0;
   |LEE 000#dscam067.];
   FEstado = FSalida;
   Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
   |PARA; |SI FEstado = 0; |Y #dscam067#0  = "RM"; |Y Clave1 = #dscam003#17;
    |Y Clave2 = #dscam003#37; |Y Clave3 = "V"; |HACIENDO;
      nEmpresa      = #dscam067#8; nPeriodo = #dscam067#9;
      nDiario       = #dscam067#4; fFecha   = #dscam067#5;
      nDocumto      = #dscam067#6;

      |SALVA_FICHA #dscaw068; |SALVA_FICHA #dscam067;
      |BUCLE MeteNuevos;
      |REPON_FICHA #dscam067; |REPON_FICHA #dscaw068;

      |LEE 000#dscam067.s;
      FEstado = FSalida;
      Clave1 = #dscam067#1; Clave2 = #dscam067#2;
      Clave3 = #dscam067#3; |QBF Clave3;
   |SIGUE;
   |CIERRA #dscam067;
|FPRC;

|DEFBUCLE CompletaDatos;
#dscaw068#1;
4;
00001,001,"*";
99999,999,"*";
;
NULL,CompletaDatos;
|FIN;

|PROCESO EliminaMovtos;
   #dscam004#17 = #dscam003#40;
   #dscam004#3  = 99;
   |LEE 000#dscam004.];
   |SI FSalida ! 0;
      |LEE 000#dscam004.u;
   |FINSI;

   |SI FSalida = 0;
      |SI #dscam004#17 = #dscam003#40;
         |SI #dscam004#5 = "REM";
            || Actualiza la cabecera del recibo .....
            #dscam003#26 = "01.01.0000";
            #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
            #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
            #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
            #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
            #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;

            #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
            #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
            #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
            #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
            #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;

            #dscam003#84 = "N";

            #dscam003#14 = "R";
            #dscam003#15 = "Remesado";
            |GRABA 020#dscam003.a;

            |LEE 101#dscam004.=;
            |BORRA 020#dscam004.a; |LIBERA #dscam004;
         |FINSI;
      |SINO;
         |LEE 000#dscam004.a;
         |SI FSalida = 0;
            |SI #dscam004#17 = #dscam003#40;
               |SI #dscam004#5 = "REM";
                  || Actualiza la cabecera del recibo .....
                  #dscam003#26 = "01.01.0000";
                  #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
                  #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
                  #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
                  #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
                  #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;

                  #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
                  #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
                  #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
                  #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
                  #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;

                  #dscam003#84 = "N";

                  #dscam003#14 = "R";
                  #dscam003#15 = "Remesado";
                  |GRABA 020#dscam003.a;

                  |LEE 101#dscam004.=;
                  |BORRA 020#dscam004.a; |LIBERA #dscam004;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE EliminaMovtos;
#dscam003#7;
;
#dscaw068#6, #dscaw068#7, 000000001;
#dscaw068#6, #dscaw068#7, 999999999;
;
NULL,EliminaMovtos;
|FIN;

|PROCESO BorraAsto;
   |ABRE #dscam067; |DDEFECTO #dscam067;
   #dscam067#8 = 0;
   #dscam067#9 = 0;
   #dscam067#0  = "RM";
   #dscam067#1  = #dscam013#0;
   #dscam067#2  = #dscam013#1;
   #dscam067#3  = "V";
   #dscam067#11 = 0;
   |LEE 000#dscam067.];
   FEstado = FSalida;
   Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
   |PARA; |SI FEstado = 0; |Y #dscam067#0  = "RM"; |Y Clave1 = #dscam013#0;
    |Y Clave2 = #dscam013#1; |Y Clave3 = "V"; |HACIENDO;

      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #dscaw013#Comodin#;
      |DELINDEX #dscaw013; |ABRE #dscaw013;
      aAlfa = #dscam067#10;

      |DDEFECTO #dscaw013;
      #dscaw013#15 = aAlfa;        #dscaw013#0 = 1;
      #dscaw013#13 = "dscam013";   #dscaw013#14 = 0;
      #dscaw013#11 = "N";          #dscaw013#12 = 5;
      #dscaw013#5  = #dscam013#0; #dscaw013#6 = #dscam013#0;
      |GRABA 020#dscaw013.n;

      |DDEFECTO #dscaw013;
      #dscaw013#15 = aAlfa;      #dscaw013#0 = 2;
      #dscaw013#13 = "dscam013"; #dscaw013#14 = 1;
      #dscaw013#11 = "N";        #dscaw013#12 = 3;
      #dscaw013#5  = #dscam013#1;  #dscaw013#6 = #dscam013#1;
      |GRABA 020#dscaw013.n;

      nHayAsto      = 1;
      aAlfa = "dscam033.tab;" + aAlfa + ",B,V" + #dscam067#5;
      |LIBERA #dscam003; |CIERRAT #dscam003;
      |LIBERA #dscam004; |CIERRAT #dscam004;
      |LIBERA #dscam067; |CIERRAT #dscam067;
      |SUB_EJECUTA_NP aAlfa;
      |ABRET #dscam067; |LEE 101#dscam067.=;
      |ABRET #dscam003; |LEE 101#dscam003.=;
      |ABRET #dscam004; |LEE 101#dscam004.=;

      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

      |LEE 000#dscam067.s;
      FEstado = FSalida;
      Clave1 = #dscam067#1; Clave2 = #dscam067#2;
      Clave3 = #dscam067#3; |QBF Clave3;
   |SIGUE;

   |CIERRA #dscam067;
|FPRC;

|PROCESO DeshazRecup;
   |ABRE #dscam067; |DDEFECTO #dscam067;
   #dscam067#8 = 0;
   #dscam067#9 = 0;
   #dscam067#0  = "CB";
   #dscam067#1  = #dscam004#17;
   #dscam067#2  = #dscam004#3;
   #dscam067#3  = "";
   #dscam067#11 = 1;
   |LEE 000#dscam067.];
   FEstado = FSalida;
   Clave1 = #dscam067#1; Clave2 = #dscam067#2; Clave3 = #dscam067#3; |QBF Clave3;
   |PARA; |SI FEstado = 0; |Y Clave1 = #dscam004#17; |HACIENDO;
      |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3; |Y Clave3 = "";
         |SAL;
      |FINSI;
      |LEE 000#dscam067.s;
      FEstado = FSalida;
      Clave1 = #dscam067#1; Clave2 = #dscam067#2;
      Clave3 = #dscam067#3; |QBF Clave3;
   |SIGUE;

   |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
    |Y Clave3  = "";
      |LEE 000#dscam067.=;

      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #dscaw013#Comodin#;
      |DELINDEX #dscaw013; |ABRE #dscaw013;
      aAlfa = #dscam067#10;

      |DDEFECTO #dscaw013;
      #dscaw013#15 = aAlfa;        #dscaw013#0 = 1;
      #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
      #dscaw013#11 = "N";          #dscaw013#12 = 9;
      #dscaw013#5  = #dscam004#17; #dscaw013#6 = #dscam004#17;
      |GRABA 020#dscaw013.n;

      |DDEFECTO #dscaw013;
      #dscaw013#15 = aAlfa;      #dscaw013#0 = 2;
      #dscaw013#13 = "dscam004"; #dscaw013#14 = 3;
      #dscaw013#11 = "N";        #dscaw013#12 = 2;
      #dscaw013#5  = #dscam004#3;  #dscaw013#6 = #dscam004#3;
      |GRABA 020#dscaw013.n;

      aAlfa = "dscam033.tab;" + aAlfa + ",B";
      |LIBERA #dscam003; |CIERRAT #dscam003;
      |LIBERA #dscam004; |CIERRAT #dscam004;
      |LIBERA #dscam067; |CIERRAT #dscam067;
      |SUB_EJECUTA_NP aAlfa;
      |ABRET #dscam067; |LEE 101#dscam067.=;
      |ABRET #dscam003; |LEE 101#dscam003.=;
      |ABRET #dscam004; |LEE 101#dscam004.=;

      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
   |FINSI;
   |CIERRA #dscam067;

   #dscam003#40 = #dscam004#17;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      #dscam003#30 = #dscam003#30 - #dscam004#8; #dscam003#64 = #dscam003#64 - #dscam004#26;
      #dscam003#23 = #dscam003#23 - #dscam004#8; #dscam003#61 = #dscam003#61 - #dscam004#26;
      #dscam003#55 = #dscam003#55 + #dscam004#8; #dscam003#68 = #dscam003#68 + #dscam004#26;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;

   |BORRA 020#dscam004.a;
|FPRC;

|PROCESO ActualizaRec;
   eaTOperacion = "B"; enNumDocum = #dscaw068#5; |HAZ ProcesaTempo;

   |SALVA_FICHA #dscam003;
   #dscam012#0 = #dscam003#17;
   |LEE 000#dscam012.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   #dscam013#0 = #dscam003#17;
   #dscam013#1 = #dscam003#37;
   |LEE 000#dscam013.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   |SI #dscam012#22 = 2; |O #dscam012#22 = 4;
      #dscam003#84 = "N";
      |SI nSwArtenvas = 1;
           #dscam003#26 = "01.01.0000";
           #dscam003#23 = 0; #dscam003#61 = 0;
           #dscam003#31 = #dscam003#30; #dscam003#65 = #dscam003#64;
           #dscam003#14 = "R"; #dscam003#15 = "Remesado";
       |FINSI;
      |GRABA 020#dscam003.a;
   |FINSI;
   |SI #dscam012#22 = 1;
      #dscam004#17 = #dscam013#16;
      #dscam004#3  = #dscam013#17;
      |LEE 101#dscam004.=;
      |SI FSalida = 0; |Y #dscam004#5 = "REM";
         || Actualiza la cabecera del recibo .....
         #dscam003#26 = "01.01.0000";
         #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
         #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
         #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
         #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;
         #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;

         #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
         #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
         #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
         #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
         #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;

         #dscam003#84 = "N";
         |SI nSwArtenvas = 1; #dscam003#26 = "01.01.0000"; |FINSI;

         #dscam003#14 = "R";
         #dscam003#15 = "Remesado";
         |GRABA 020#dscam003.a;

         |BORRA 020#dscam004.a; |LIBERA #dscam004;
      |FINSI;

      #dscam012#0 = #dscam013#0;
      |LEE 101#dscam012.=;
      |SI FSalida = 0;
         #dscam012#8 = "N";
         |GRABA 020#dscam012.a; |LIBERA #dscam012;
      |FINSI;
   |FINSI;
   |SI #dscam012#22 = 3;
      |SALVA_FICHA #dscam003;
      |BUCLE EliminaMovtos;
      |REPON_FICHA #dscam003;

      #dscam012#0 = #dscam013#0;
      |LEE 101#dscam012.=;
      |SI FSalida = 0;
         #dscam012#8 = "N";
         |GRABA 020#dscam012.a; |LIBERA #dscam012;
      |FINSI;
   |FINSI;
   |SI #dscam012#22 = 6; |O #dscam012#22 = 7;
      #dscam004#17 = #dscam013#16;
      #dscam004#3  = 99;
      |LEE 000#dscam004.];
      |SI FSalida = 0;
         |SI #dscam004#17 = #dscam013#16;
            |SI #dscam004#5 = "FAR"; |O #dscam004#5 = "FAP";
               |HAZ DeshazRecup;
            |FINSI;
         |SINO;
            |LEE 000#dscam004.a;
            |SI FSalida = 0;
               |SI #dscam004#17 = #dscam013#16;
                  |SI #dscam004#5 = "FAR"; |O #dscam004#5 = "FAP";
                     |HAZ DeshazRecup;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   enBanco = #dscam012#2;
   enEmpCartera = -1;      enEmpGestion = #dscam003#46;
   eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
   nImporte = #dscam013#7;
   |SI #dscam012#22 = 1; |O #dscam012#22 = 3;
      eaTipoOper = "+4";
   |SINO;
      eaTipoOper = "+6";
   |FINSI;
   |HAZ BucleRiesgo;

   eaUsuario = Usuario % 0810;
   eaDescr   = "DESHACIENDO DESCUENTO RIESGO LINEA REMESA (";
   eaDescr   = eaDescr + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam013#1) % -103) + ") CON ";
   |SI #dscaw068#6 ! "    "; |O #dscaw068#7 ! "          ";
      eaDescr   = eaDescr + " PAGARE (" + #dscaw068#6 + "/" + #dscaw068#7 + ")";
   |SINO;
      eaDescr   = eaDescr + " RECIBO (" + #dscam003#40 + ")";
   |FINSI;
   eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
   eaTipoOp  = "V";   enImpAct = #dscam012#10; enImpAnt = #dscam012#10;
   |HAZ GrabaAudit;

   #dscam013#0 = #dscam003#17;
   #dscam013#1 = #dscam003#37;
   |LEE 101#dscam013.=;
   |SI FSalida = 0;
      #dscam013#15 = "N";    #dscam013#20 = "";
      |GRABA 020#dscam013.a; |LIBERA #dscam013;
      |SI #dscam012#22 ! 6; |Y #dscam012#22 ! 7; |HAZ BorraAsto; |FINSI;

      #dscam012#0 = #dscam013#0;
      |LEE 101#dscam012.=;
      |SI FSalida = 0;
         #dscam012#9 = "N";
         |GRABA 020#dscam012.a; |LIBERA #dscam012;
      |FINSI;
   |FINSI;
   |REPON_FICHA #dscam003;
|FPRC;

|DEFBUCLE ActualizaPag;
#dscam003#7;
;
#dscaw068#6, #dscaw068#7, 000000001;
#dscaw068#6, #dscaw068#7, 999999999;
;
NULL,ActualizaRec;
|FIN;

|PROCESO VuelcaDatos;
   |SI #dscaw068#6 = "    "; |Y #dscaw068#7 = "          ";
      #dscam003#40 = #dscaw068#5;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         |HAZ ActualizaRec;
         |LIBERA #dscam003;
      |FINSI;
   |SINO;
      |BUCLE ActualizaPag;
   |FINSI;
|FPRC;

|DEFBUCLE VuelcaDatos;
#dscaw068#1;
4;
00001,001,"*";
99999,999,"*";
;
NULL,VuelcaDatos;
|FIN;

|PROCESO RevisaDatos;
   |SI #dscaw068#4 ! "*"; nSwMensa = 1; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE RevisaDatos;
#dscaw068#1;
;
00001,001;
99999,999;
;
NULL,RevisaDatos;
|FIN;

|PROCESO RellenaTempo;
   |SI aEntidad ! "    "; |O aNumero ! "          ";
      |SI aEntidad = #dscam013#37; |Y aNumero = #dscam013#38; |ACABA; |FINSI;
   |FINSI;
   aEntidad = #dscam013#37; aNumero = #dscam013#38;

   #dscam012#0 = #dscam013#0;
   |LEE 000#dscam012.=;
   |SI FSalida ! 0; |ACABA; |FINSI;
   |SI #dscaz140#2 > #dscam012#1; |O #dscam012#1 > #dscaz140#3; |ACABA; |FINSI;

   |SI #dscaz140#4 ! 0;
      |SI #dscam012#22 ! #dscaz140#4; |ACABA; |FINSI;
   |FINSI;

   |SI nAntRem < 0;
      nMarca = 1;
      nAntRem = #dscam013#0;
   |SINO;
      |SI nAntRem ! #dscam013#0;
         |SI nMarca = 1; nMarca = 2; |SINO; nMarca = 1; |FINSI;
         nAntRem = #dscam013#0;
      |FINSI;
   |FINSI;

   #dscam003#40 = #dscam013#16;
   |LEE 000#dscam003.=;
   |SI FSalida ! 0; |DDEFECTO #dscam003; |FINSI;
   Divisa = #dscam003#57; |HAZ TomaDecim;

   |DDEFECTO #dscaw068;
   #dscaw068#0 = #dscam013#0;
   #dscaw068#1 = #dscam013#1;
   #dscaw068#2 = #dscam003#3;
   |SI #dscam003#72 ! "    "; |O #dscam003#70 ! "          ";
      #dscaw068#3 = #dscam003#78;
   |SINO;
      #dscaw068#3 = #dscam003#30;
   |FINSI;
   #dscaw068#4 = aMarca;
   #dscaw068#5 = #dscam003#40;
   #dscaw068#6 = #dscam003#72;
   #dscaw068#7 = #dscam003#70;
   #dscaw068#8 = nMarca;
   #dscaw068#9 = #dscam003#57;
   |GRABA 010#dscaw068.n;
|FPRC;

|DEFBUCLE RellenaTempo;
#dscam013#1;
15;
#dscaz140#0, 001, "S";
#dscaz140#1, 999, "S";
;
NULL,RellenaTempo;
|FIN;

|RUTINA infw068;
   #dscaw068#0 = 1;
   #dscaw068#1 = 1;
|FRUT;

|RUTINA supw068;
   #dscaw068#0 = 99999;
   #dscaw068#1 = 999;
|FRUT;

|PROGRAMA;
   |HAZ Tipo8;

   |CLS;
   |CABEZA "Deshacer vencimiento de remesas";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |HAZ EsArtenvas;
      |SI FSalida = 0; nSwArtenvas = 1; |FINSI;

      |ABRE #dscam012; |ABRE #dscam013;
      |ABRE #dscam004; |ABRE #dscam003;
      aAlfa = "rr" + Usuario; |NOME_DAT #dscaw068#aAlfa#;
      |DELINDEX #dscaw068; |ABRE #dscaw068;

      aMarca = " "; nMarca = 1;
      |BUCLE RellenaTempo;
      |PUSHV 0501 2380;
      |ENTLINEAL #1#dscaw068,-2,4,19,1,infw068,supw068;
      |POPV;
      |CONFI "    NConforme con los datos editados ?";
      |SI FSalida = 0;

         nLinea = 1; |BUCLE CompletaDatos;
         |SI nSwNuevo = 1;
            |MENAV "    Hay recibos marcados agrupados en su asiento con otros no marcados. Se anularan todos.";
            aAlfa = "    N" + &191 + " Continuar ?";
            |CONFI aAlfa;
            |SI FSalida ! 0; |VETE Final; |FINSI;
         |FINSI;
         nLinea = 1; |BUCLE VuelcaDatos;
         nSwMensa = 0;
         |BUCLE RevisaDatos;
         |SI nSwMensa = 1; |Y nHayAsto = 1;
            |MENAV "    Revise el asiento asociado. Puede haber descuadres";
         |FINSI;
      |FINSI;

|ET Final;
      |CIERRA #dscam012; |CIERRA #dscam013; |CIERRA #dscam014;
      |CIERRA #dscam004; |CIERRA #dscam003;

      |CIERRA #dscaw068; |DELINDEX #dscaw068;
   |FINSI;

   eaSesion   = Usuario; |HAZ LimpiaTempo;

   |HAZ Tipo9;
|FPRO;
