|FICHEROS;
   dscaz156 #0;

   dscam003 #10;
   dscam004 #11;
|FIN;

|VARIABLES;
   nUltMov = 0;

   aMovto = "";
|FIN;

|PROCESO CreaMovimiento;
   #dscam004#5 = aMovto;
   #dscam004#17 = #dscam003#40;
   |LEE 000#dscam004.=;
   |SI FSalida = 0; |ACABA; |FINSI;

   |SELECT #1#dscam004;
   #dscam004#17 = #dscam003#40;
   #dscam004#4  = 99;
   |LEE 000#dscam004.];
   |SI FSalida = 0;
      |LEE 000#dscam004.a;
   |SINO;
      |LEE 000#dscam004.u;
   |FINSI;
   |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
      nUltMov = #dscam004#3 + 1;
   |FINSI;
   |SELECT #4#dscam004;

   |DDEFECTO #dscam004;
   #dscam004#0  = #dscam003#0;
   #dscam004#1  = #dscam003#1;
   #dscam004#2  = #dscam003#2;
   #dscam004#3  = nUltMov;
   #dscam004#5  = aMovto;
   #dscam004#6  = ~;
   #dscam004#7  = 0;
   #dscam004#17 = #dscam003#40;
   #dscam004#33 = 1;
   #dscam004#15 = #dscam003#27;
   |SI aMovto = "PRE";
      #dscam004#8  = #dscam003#30;
      #dscam004#26 = #dscam003#64;
      |GRABA 020#dscam004.n;
   |FINSI;
|FPRC;

|PROCESO Recibos;
   |SI #dscam003#14 = "R";
      || Si est  remesado necesitar  un movimiento PRE (con importes),
      ||    otro EMR (sin importes) y otro REM (con importes)
      aMovto = "PRE"; |HAZ CreaMovimiento;
      aMovto = "EMR"; |HAZ CreaMovimiento;
   |FINSI;
   |SI #dscam003#14 = "I";
      || Si est  impagado necesitar  un movimiento PRE (con importes),
      ||    otro EMR (sin importes) y otro REM (con importes) para dejarlo
      ||    remesado y necesitar  un movimiento IMP (con importes) para
      ||    quedar impagado
   |FINSI;
   |SI #dscam003#14 = "T";
      || Si est  en talon necesitar  un movimiento RPT (sin importes)
   |FINSI;
   |SI #dscam003#14 = "L";
      || Si est  liquidado necesitar  un movimiento COB (con importes y en
      ||    caso claro que no tenga movimientos)
   |FINSI;
|FPRC;

|DEFBUCLE Recibos;
#dscam003#1;
;
INICIO;
FINAL;
;
NULL, Recibos;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA "Recalculo movimientos recibos";

   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |ABRE #dscam004; |SELECT #4#dscam004;
      |BUCLE Recibos;
      |SELECT #1#dscam004; |CIERRA #dscam004;
   |FINSI;
|FPRO;
