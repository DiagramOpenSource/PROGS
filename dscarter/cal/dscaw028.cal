|FICHEROS;
   dscaw028 #0;
   dscam014 #1;
   dscam051 #2;

   dscam003 #10;
|FIN;

|VARIABLES;
   &eaEntidad  = "";
   &eaSucursal = "";
   &eaDC       = "";
   &eaCuenta   = "";

   &eaTipoRecibo = ""; &enNumDocum = 0; &eaMensRet = ""; &enSwError = 0; &eaTOperacion = "";
   &Pagos = 0; &enRemesa = 0;
   &enSwLineal = 0; &enClave = 0;
   &TotalSel = 0;

   CodClie = ""; CtaClie = "";
   Comodin = "";
   aTitClv = "";

   aMarca  = ""; aAlfa = "";

   aEntidad = ""; aNumPag = "";
   aSw = "";
   nSw = 0;
|FIN;

|PROCESO Lineasw028; |TIPO 13;
   Comodin = ("          " + TotalSel) % -110;
   Comodin = " Total seleccion : " + Comodin;
   |ATRI I; |PINTA 2111, Comodin; |ATRI N;

   |SI enClave = 1; aTitClv = " Ordenacion : Numeracion pagare "; |FINSI;
   |SI enClave = 2; aTitClv = "様様様様様 Ordenacion : Cliente "; |FINSI;
   |SI enClave = 3; aTitClv = " Ordenacion : Fecha vencimiento "; |FINSI;
   |ATRI I; |PINTA 0638, aTitClv; |ATRI N;
|FPRC;

|PROCESO Bloquea;
   eaTOperacion = aSw; enNumDocum = #dscam003#40; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE Bloquea;
#dscam003#7;
;
aEntidad, aNumPag, 0000000001;
aEntidad, aNumPag, 9999999999;
;
NULL,Bloquea;
|FIN;

|PROCESO Comprueba;
|ACABA;
   eaEntidad = #dscam003#8;
   eaSucursal = #dscam003#9;
   eaCuenta = #dscam003#11;
   eaDC = "";
   |HAZ CalculoDC;
   |SI #dscam003#10 = "  ";
      aAlfa = "    El documento " + #dscam003#40 + " tiene vacio el DC de la cuenta bancaria. Proceso cancelado.";
      |SI nSw = 0; |MENAV aAlfa; |FINSI;
      nSw = -1;
      |ERROR10; |ACABA;
   |SINO;
      |SI #dscam003#8 = "    "; |O #dscam003#9 = "    "; |O #dscam003#11 = "          ";
         aAlfa = "    El documento " + #dscam003#40 + " tiene la cuenta bancaria con datos vacios.";
         |SI nSw = 0; |MENAV aAlfa; |FINSI;
         nSw = -1;
         |ERROR10; |ACABA;
      |SINO;
         |SI eaDC ! #dscam003#10;
            aAlfa = "    El documento " + #dscam003#40 + " tiene mal informado el DC de la cuenta bancaria. Proceso cancelado.";
            |SI nSw = 0; |MENAV aAlfa; |FINSI;
            nSw = -1;
            |ERROR10; |ACABA;
         |SINO;
            |SI #dscam003#8 ! "0000"; |Y #dscam003#9 = "0000"; |Y #dscam003#11 ! "0000000000";
                aAlfa = "    NEl documento " + #dscam003#40 + " tiene la cuenta bancaria con datos vacios. Sucursal:" + #dscam003#9;
                |CONFI aAlfa;
                |SI FSalida ! 0; |ERROR10; nSw = -1; |ACABA; |FINSI;
            |SINO;
                 |SI #dscam003#8 = "0000"; |O #dscam003#9 = "0000"; |O #dscam003#11 = "0000000000";
                    aAlfa = "    El documento " + #dscam003#40 + " tiene la cuenta bancaria con datos vacios.";
                    |SI nSw = 0; |MENAV aAlfa; |FINSI;
                    nSw = -1;
                    |ERROR10; |ACABA;
                 |FINSI;
             |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Comprueba;
#dscam003#7;
;
aEntidad, aNumPag, 0000000001;
aEntidad, aNumPag, 9999999999;
;
NULL,Comprueba;
|FIN;

|PROCESO MarcaTodos1;
   |SI #dscam051#111 = "S";
      nSw = 2; aEntidad = #dscaw028#1; aNumPag = #dscaw028#2; |BUCLE Comprueba;
      |SI nSw < 0; |ACABA; |FINSI;
   |FINSI;

   enSwError = 0;
   aSw = "A"; aEntidad = #dscaw028#1; aNumPag = #dscaw028#2; |BUCLE Bloquea;
   |SI enSwError = 0;
      |SI CodClie ! ""; |Y CtaClie ! ""; |Y enRemesa = 0;
         |SI #dscaw028#5 ! "      "; |Y CodClie ! "      ";
          |Y #dscaw028#5 ! CodClie; |ACABA; |FINSI;
         |SI #dscaw028#6 ! "            "; |Y CtaClie ! "            ";
          |Y #dscaw028#6 ! CtaClie; |ACABA; |FINSI;
      |FINSI;

      CodClie = #dscaw028#5; CtaClie = #dscaw028#6;
      |SI aMarca = " ";
         #dscaw028#4 = "*";
         TotalSel = (TotalSel + #dscaw028#3) ! 2;
         |MODULO Comodin;
         |SI #dscam051#3 = "S"; |Y Comodin = "dscam012";
            |SI TotalSel > #dscam014#12; |Y Pagos = 0;
               |MENAV "    Sobrepasado el riesgo bancario concedido";
            |FINSI;
         |FINSI;
      |SINO;
         #dscaw028#4 = " ";
         TotalSel = (TotalSel - #dscaw028#3) ! 2;
      |FINSI;
      |GRABA 020#dscaw028.a;
      |PONCONTROL 23, "si";
   |FINSI;
|FPRC;

|DEFBUCLE MarcaTodos1;
#dscaw028#1;
4;
00001,aMarca;
99999,aMarca;
be;
NULL,MarcaTodos1;
|FIN;

|PROCESO Marcalo; |TIPO 11;
   |SI FSalida = 9; |Y enRemesa ! 0;
      |SI TotalSel = 0;
         aMarca = " ";
      |SINO;
         aMarca = "*";
      |FINSI;

      |ABRE #dscam051;
      |LEE 000#dscam051.p;
      |SI FSalida ! 0;
         |DDEFECTO #dscam051;
         |GRABA 020#dscam051.n;
      |FINSI;
      |CIERRA #dscam051;

      |SALVA_FICHA #dscaw028;
      |BUCLE MarcaTodos1;
      |REPON_FICHA #dscaw028;
      Comodin = ("          " + TotalSel) % -110;
      Comodin = " Total seleccion : " + Comodin;
      |ATRI I; |PINTA 2111, Comodin; |ATRI N;
      |PTEC 808; |PTEC 809;
      |ERROR;
      |PONCONTROL 23, "si";
   |FINSI;

   |SI FSalida = 10;
      |SI #dscaw028#4 = " ";
         |SI #dscam051#111 = "S";
            nSw = 0; aEntidad = #dscaw028#1; aNumPag = #dscaw028#2; |BUCLE Comprueba;
            |SI nSw < 0; |ERROR; |ACABA; |FINSI;
         |FINSI;

         |SI CodClie ! ""; |Y CtaClie ! ""; |Y enRemesa = 0;
            |SI #dscaw028#6 ! CtaClie; |O #dscaw028#5 ! CodClie;
               |MENAV "    El proveedor del documento marcado no coincide con el de los anteriores";
               |ERROR; |ACABA;
            |FINSI;
         |SINO;
            CodClie = #dscaw028#5; CtaClie = #dscaw028#6;
         |FINSI;
         |ABRE #dscam051;
         |LEE 000#dscam051.p;
         |SI FSalida ! 0;
            |DDEFECTO #dscam051;
            |GRABA 020#dscam051.n;
         |FINSI;
         |CIERRA #dscam051;

         aSw = "A"; aEntidad = #dscaw028#1; aNumPag = #dscaw028#2; |BUCLE Bloquea;

         #dscaw028#4 = "*";
         TotalSel = (TotalSel + #dscaw028#3) ! 2;
         |MODULO Comodin;
         |SI #dscam051#3 = "S"; |Y Comodin = "dscam012";
            |SI TotalSel > #dscam014#12; |Y Pagos = 0;
               |MENAV "    Sobrepasado el riesgo bancario concedido";
            |FINSI;
         |FINSI;
      |SINO;
         aSw = "B"; aEntidad = #dscaw028#1; aNumPag = #dscaw028#2; |BUCLE Bloquea;

         #dscaw028#4 = " ";
         TotalSel = (TotalSel - #dscaw028#3) ! 2;
         |SI TotalSel = 0;
            CodClie = ""; CtaClie = "";
         |FINSI;
      |FINSI;
      |GRABA 020#dscaw028.a;
      Comodin = ("          " + TotalSel) % -110;
      Comodin = " Total seleccion : " + Comodin;
      |ATRI I;
      |PINTA 2111, Comodin;
      |ATRI N;
      |PTEC 808; |PTEC 809;
      |ERROR;
   |FINSI;

   |SI FSalida = 11; |Y enRemesa ! 0;
      aMarca = "*";
      |SALVA_FICHA #dscaw028;
      |BUCLE MarcaTodos1;
      |REPON_FICHA #dscaw028;
      Comodin = ("          " + TotalSel) % -110;
      Comodin = " Total seleccion : " + Comodin;
      |ATRI I; |PINTA 2111, Comodin; |ATRI N;
      |PTEC 808; |PTEC 809;
      |ERROR;
      |PONCONTROL 23, "si";
   |FINSI;

   |SI FSalida = 12;
      |SI enClave = 1;
         enClave = 2;
      |SINO;
         |SI enClave = 2;
            enClave = 3;
         |SINO;
            enClave = 1;
         |FINSI;
      |FINSI;
      enSwLineal = 1;
      |PTEC 807;
   |FINSI;

   |SI enClave = 1; aTitClv = " Ordenacion : Numeracion pagare "; |FINSI;
   |SI enClave = 2; aTitClv = "様様様様 Ordenacion : Proveedor "; |FINSI;
   |SI enClave = 3; aTitClv = " Ordenacion : Fecha vencimiento "; |FINSI;
   |ATRI I; |PINTA 0638, aTitClv; |ATRI N;
|FPRC;
