|FICHEROS;
     taglz004 #0;
     taglm001;
     taglm003;
     taglm002 #2;
     dscam003 #3;
     dscam023 #23;
     referen@;
|FIN;

|VARIABLES;
     nSwCond = 0;
     fFechaCalc = @;
     nCalc = 0;
     fFechaHoy = @;

     nFecha = 0;
     fHFecha = @;
     aSwBloq = "";
     aAlfa = "";
     aCli = "";
     aNom = "";
|FIN;

|PROCESO Cliente;
     |SI aCli ! "";
          |SI aSwBloq = "S";
               #23#0 = aCli;
               |LEE 101#23=;
               |SI FSalida = 0;
                    |SI #23#9 = "N"; |O #23#9 = "A";
                         #23#9 = "S";
                         aAlfa = #0#0; |QBF aAlfa;
                         aAlfa = (aAlfa % 0102) + (aAlfa % 0402) + (aAlfa % 0902);
                         aAlfa = "BLOQ.AUTO.(" + aAlfa + ")";
                         #23#10 = aAlfa;
                         |GRABA 020#23a;

                         #2#0 = #0#0;
                         #2#1 = aCli;
                         #2#2 = aNom;
                         |GRABA 000#2n;
                    |FINSI;
                    |LIBERA #23;
               |FINSI;
          |SINO;
               #23#0 = aCli;
               |LEE 101#23=;
               |SI FSalida = 0;
                    |SI #23#9 = "S";;
                         #23#9 = "N";
                         #23#10 = "";
                         |GRABA 020#23a;
                    |FINSI;
               |FINSI;
               |LIBERA #23;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Chequea2;
     |SI #3#13 = "I";
          aSwBloq = "S";
     |SINO;
          |SI #3#13 = "C"; |O #3#13 = "R"; |O #3#13 = "T";
               |SI #3#16 > 0;
                    aSwBloq = "S";
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #3#82 = "S";
          |SI #3#13 = "P"; |O #3#13 = "R"; |O #3#13 = "C"; |O #3#13 = "T";
               #referen@#40 = #3#83;
               |LEE 000#referen@.=;
               |SI FSalida = 0; |Y #referen@#16 > 0;
                    aSwBloq = "S";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Chequea1;
   nSwCond = 0;
   |SI #dscam003#30 < 0; |ACABA; |FINSI;
   |SI #dscam003#31 = 0; |ACABA; |FINSI;
   |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "C"; |Y #dscam003#14 ! "I"; |ACABA; |FINSI;

   aAlfa = #dscam003#80; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
   #taglm003#0 = aAlfa;
   |LEE 000#taglm003.=;
   |SI FSalida ! 0;
      #taglm001#0 = aAlfa;
      |LEE 000#taglm001.=;
      |SI FSalida ! 0;
         |ACABA;
      |SINO;
         nSwCond = 1;
      |FINSI;
   |SINO;
      nSwCond = 2;
      #taglm001#0 = aAlfa;
      |LEE 000#taglm001.=;
      |SI FSalida = 0; nSwCond = 3; |FINSI;
   |FINSI;

   fFechaHoy = #taglz004#0;

   fFechaCalc = #dscam003#4; nCalc = fFechaCalc;
   nCalc = nCalc + #taglm003#2; fFechaCalc = nCalc;

   |SI nSwCond = 1;
      nSwCond = 0;
      |SI #dscam003#3 < fFechaHoy; nSwCond = 1; |FINSI;
   |FINSI;
   |SI nSwCond = 2;
      nSwCond = 0;
      |SI fFechaCalc < fFechaHoy; nSwCond = 1; |FINSI;
   |FINSI;
   |SI nSwCond = 3;
      nSwCond = 0;
      |SI #dscam003#3 < fFechaHoy; |O fFechaCalc < fFechaHoy; nSwCond = 1; |FINSI;
   |FINSI;
|FPRC;

|PROCESO Recibos;
     |SI aCli ! #3#32;
          |HAZ Cliente;
          aCli = #3#32;
          aNom = #3#6;
          aSwBloq = "N";
     |FINSI;
     |HAZ Chequea1;
     |SI nSwCond = 1; aSwBloq = "S"; |FINSI;
     |HAZ Chequea2;
|FPRC;

|DEFBUCLE Recibos;
     #3#3;
     ;
     "01.01.0000", 000000001;
     fHFecha,      999999999;
     ;
     NULL, NULL, NULL, NULL, NULL, Recibos;
     #3#32;
|FIN;

|PROCESO T3; |TIPO 3;
     nFecha = #0#0 - 1;
     fHFecha = nFecha;

     |DDEF aAlfa;
     aAlfa = aAlfa + "dscam003";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |ABRE #23;
          |ABRE #2;
          |ABRE #taglm003;
          |ABRE #taglm001;
          |BUCLE Recibos;
          |HAZ Cliente;
          |CIERRA #taglm001;
          |CIERRA #taglm003;
          |CIERRA #2;
          |CIERRA #23;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROGRAMA;
     |SI PARAMETRO ! "";
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
     |SINO;
          |HAZ T3;
     |FINSI;
|FPRO;
