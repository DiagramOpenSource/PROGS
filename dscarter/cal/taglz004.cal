/*
|FICHEROS;
   taglz004 #0;
   taglm001 #1;
   taglm002 #2;
   taglm003 #3;

   dscam003 #10;
   dscam023 #23,MANTE;

   agif091@ #100;
   dsm0130@ #130;
|FIN;

|VARIABLES;
   &nCamFPago = 0;
   &enFPago   = 0;
   &fFechaFac = @;
   &fFecVto   = @;
   &eaCliente   = "";
   fFecha     = @;
   HFecha     = @;
   fFechaHoy  = @;
   fFechaCalc = @;

   nSwCond    = 0;

   nCalc      = 0;
   nCalc1     = 0;
   &nFPago    = 0;

   aAlfa      = "";
   aAntCli    = "zzzzz";
   nHay = 0;
|FIN;

|PROCESO Comprueba1;
   |SI aAntCli = #dscam003#32; |ACABA; |FINSI;
   |SI #dscam003#30 < 0; |ACABA; |FINSI;
   |SI #dscam003#31 = 0; |ACABA; |FINSI;
   |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "C"; |ACABA; |FINSI;

   aAlfa = #dscam003#80; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
   #taglm001#0 = aAlfa;
   |LEE 000#taglm001.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   enFPago = #dscam003#80; eaCliente = #dscam003#32;
   nCamFPago = #dscam003#2 + 5;
   fFechaFac = #dscam003#4;
   ||HAZ Vencimientos;

   ||SI fFecVto < fFechaHoy; |Y fFecVto > #dscam003#3;
   |SI #dscam003#3 < fFechaHoy;
      #dscam023#0 = #dscam003#32;
      |LEE 000#dscam023.=;
      |SI FSalida = 0;
         |SI #dscam023#9 = "N"; |O #dscam023#9 = "A";
            aAntCli    = #dscam003#32;
            #dscam023#9 = "S";
            aAlfa = #0#0; |QBF aAlfa;
            aAlfa = (aAlfa % 0102) + (aAlfa % 0402) + (aAlfa % 0902);
            aAlfa = "BLOQ.AUTO.(" + aAlfa + ")";
            #dscam023#10 = aAlfa;
            |GRABA 020#dscam023.a;

            #taglm002#0 = #0#0;
            #taglm002#1 = #dscam003#32;
            |LEE 000#taglm002.=;
            |SI FSalida ! 0;
               |DDEFECTO #taglm002;
               #taglm002#0 = #0#0;
               #taglm002#1 = #dscam003#32;
               #taglm002#2 = #dscam003#6;
               |GRABA 020#taglm002.n;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Comprueba2;
   |SI aAntCli = #dscam003#32; |ACABA; |FINSI;
   |SI #dscam003#30 < 0; |ACABA; |FINSI;
   |SI #dscam003#31 = 0; |ACABA; |FINSI;
   |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "C"; |Y #dscam003#14 ! "I"; |ACABA; |FINSI;

   aAlfa = #dscam003#80; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
   #taglm003#0 = aAlfa;
   |LEE 000#taglm003.=;
   |SI FSalida ! 0;
      #taglm001#0 = aAlfa;
      |LEE 000#taglm001.=;
      |SI FSalida ! 0;
         |ACABA;
      |SINO;
         nSwCond = 1;
      |FINSI;
   |SINO;
      nSwCond = 2;
      #taglm001#0 = aAlfa;
      |LEE 000#taglm001.=;
      |SI FSalida = 0; nSwCond = 3; |FINSI;
   |FINSI;

   enFPago = #dscam003#80; eaCliente = #dscam003#32;
   nCamFPago = #dscam003#2 + 5;
   fFechaFac = #dscam003#4;
   fFechaCalc = #dscam003#4; nCalc = fFechaCalc;
   nCalc = nCalc + #taglm003#2; fFechaCalc = nCalc;

   |SI nSwCond = 1;
      nSwCond = 0;
      |SI #dscam003#3 < fFechaHoy; nSwCond = 1; |FINSI;
   |FINSI;
   |SI nSwCond = 2;
      nSwCond = 0;
      |SI fFechaCalc < fFechaHoy; nSwCond = 1; |FINSI;
   |FINSI;
   |SI nSwCond = 3;
      nSwCond = 0;
      |SI #dscam003#3 < fFechaHoy; |O fFechaCalc < fFechaHoy; nSwCond = 1; |FINSI;
   |FINSI;

   nSwCond = 1;

   |SI nSwCond = 1;
      #dscam023#0 = #dscam003#32;
      |LEE 000#dscam023.=;
      |SI FSalida = 0;
         |SI #dscam023#9 = "N"; |O #dscam023#9 = "A";
            aAntCli    = #dscam003#32;
            #dscam023#9 = "S";
            aAlfa = #0#0; |QBF aAlfa;
            aAlfa = (aAlfa % 0102) + (aAlfa % 0402) + (aAlfa % 0902);
            aAlfa = "BLOQ.AUTO.(" + aAlfa + ")";
            #dscam023#10 = aAlfa;
            |GRABA 020#dscam023.a;

            #taglm002#0 = #0#0;
            #taglm002#1 = #dscam003#32;
            |LEE 000#taglm002.=;
            |SI FSalida ! 0;
               |DDEFECTO #taglm002;
               #taglm002#0 = #0#0;
               #taglm002#1 = #dscam003#32;
               #taglm002#2 = #dscam003#6;
               |GRABA 020#taglm002.n;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Comprueba;
   |SI aAntCli = #dscam003#32; |ACABA; |FINSI;
   |SI #dscam003#30 < 0; |ACABA; |FINSI;
   |SI #dscam003#31 = 0; |ACABA; |FINSI;
   |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "C"; |Y #dscam003#14 ! "I"; |ACABA; |FINSI;
   nSwCond = 1;

   |SI nSwCond = 1;
      #dscam023#0 = #dscam003#32;
      |LEE 000#dscam023.=;
      |SI FSalida = 0;
         |SI #dscam023#9 = "N"; |O #dscam023#9 = "A";
            aAntCli    = #dscam003#32;
            #dscam023#9 = "S";
            aAlfa = #0#0; |QBF aAlfa;
            aAlfa = (aAlfa % 0102) + (aAlfa % 0402) + (aAlfa % 0902);
            aAlfa = "BLOQ.AUTO.(" + aAlfa + ")";
            #dscam023#10 = aAlfa;
            |GRABA 020#dscam023.a;

            #taglm002#0 = #0#0;
            #taglm002#1 = #dscam003#32;
            |LEE 000#taglm002.=;
            |SI FSalida ! 0;
               |DDEFECTO #taglm002;
               #taglm002#0 = #0#0;
               #taglm002#1 = #dscam003#32;
               #taglm002#2 = #dscam003#6;
               |GRABA 020#taglm002.n;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Comprueba;
#dscam003#3;
;
"01.01.0000", 000000001;
HFecha, 999999999;
;
NULL,Comprueba;
|FIN;

|PROCESO RecibosImpa;
     nHay = 1;
|FPRC;

|DEFBUCLE RecibosImpa;
     #10#11;
     4, 14;
     #23#0, "01.01.0000", "     ", "01.01.0000", "I";
     #23#0, "31.12.9999", "zzzzz", HFecha, "I";
     ;
     NULL, RecibosImpa;
|FIN;

|PROCESO DesBloquea;
     nHay = 0;
     |BUCLE RecibosImpa;
     |SI nHay = 0;
          #23#9 = "N";
          #23#10 = "";
          |GRABA 020#23a;
     |FINSI;
|FPRC;

|DEFBUCLE DesBloquea;
     #23#1;
     9;
     "      ", "S";
     "zzzzzz", "S";
     be;
     NULL, DesBloquea;
|FIN;

|PROGRAMA;
   #0#0 = ~;
   |SI PARAMETRO ! "";
      |CLS;
      |CABEZA " BLOQUEO AUTOMATICO DE RIESGOS DE CLIENTE ";
      |PINPA #0#0; |PINDA #0#0;
      |ENDATOS #1#0;
      |SI FSalida ! 0; |ACABA; |FINSI;
   |FINSI;

   |ABRE #dscam023; |ABRE #taglm001; |ABRE #taglm002; |ABRE #taglm003;
   HFecha = #taglz004#0; nCalc = HFecha;
   nCalc = nCalc - 1; HFecha = nCalc; fFechaHoy = #taglz004#0;
   |BUCLE Comprueba;
   |CIERRA #taglm003; |CIERRA #taglm002; |CIERRA #taglm001; |CIERRA #dscam023;

   |BUCLE DesBloquea;
|FPRO;
*/
