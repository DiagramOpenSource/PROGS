|FICHEROS;
   dscaz126 #0;

   dscam003 #10;
   dscam004 #11;

   agis002@ #100;
|FIN;

|VARIABLES;
   aAlfa    = "";

   nEntrega = 0;
   nRecibo  = 0;
   nLinea   = 0;
   nCalc    = 0;
|FIN;

|PROCESO LineasRec;
   |SI #dscam004#5 ! "REC"; |ACABA; |FINSI;

   #dscam003#56 = #dscam003#56 - #dscam004#24;
   #dscam003#23 = #dscam003#23 - #dscam004#8; #dscam003#61 = #dscam003#61 - #dscam004#26;
   #dscam003#30 = #dscam003#30 - #dscam004#8; #dscam003#64 = #dscam003#64 - #dscam004#26;
   |SI #dscam004#22 = "D";
       #dscam003#54 = #dscam003#54 - #dscam004#23; #dscam003#67 = #dscam003#67 - #dscam004#32;
   |SINO;
      #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;
   |FINSI;
   #dscam003#24 = #dscam003#24 - #dscam004#12; #dscam003#62 = #dscam003#62 - #dscam004#29;
   #dscam003#25 = #dscam003#25 - #dscam004#13; #dscam003#63 = #dscam003#63 - #dscam004#30;
   #dscam003#38 = #dscam003#38 - #dscam004#14; #dscam003#66 = #dscam003#66 - #dscam004#31;

   |SI #dscam003#23 = 0;
      #dscam003#14 = "L";
      #dscam003#15 = "Recibo Compensado";
   |SINO;
      |SI #dscam003#23 = #dscam003#22;
         #dscam003#14 = "e";
         #dscam003#15 = "Pendiente de compensar";
      |SINO;
         #dscam003#14 = "E";
         #dscam003#15 = "Compensado parcialmente";
      |FINSI;
   |FINSI;
   |GRABA 020#dscam003.a;
   aAlfa = #dscam004#16; |QBF aAlfa;
   aAlfa = aAlfa % -109;
   nRecibo = aAlfa; nEntrega = #dscam003#40; nLinea = #dscam004#3;
   |BORRA 020#dscam004.a;

   |SALVA_FICHA #dscam003; |SALVA_FICHA #dscam004;
   #dscam003#40 = nRecibo;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      #dscam004#17 = nRecibo;
      #dscam004#3  = 1;
      |LEE 000#dscam004.=;
      |PARA; |SI FSalida = 0; |Y #dscam004#17 = nRecibo; |HACIENDO;
         |SI #dscam004#40 = nEntrega; |Y #dscam004#41 = nLinea;
            #dscam003#56 = #dscam003#56 - #dscam004#24;
            #dscam003#23 = #dscam003#23 - #dscam004#8;  #dscam003#61 = #dscam003#61 - #dscam004#26;
            #dscam003#55 = #dscam003#55 - #dscam004#23; #dscam003#68 = #dscam003#68 - #dscam004#32;

            #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
            #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
            #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
            #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
            #dscam003#31 = #dscam003#30 - #dscam003#23;  #dscam003#65 = #dscam003#64 - #dscam003#61;
            #dscam003#26 = #dscam004#6;
            |SI #dscam003#23 = 0;
               #dscam003#14 = "P";
               #dscam003#15 = "Pendiente de cobro";
               #dscam003#26 = "01.01.0000";
            |SINO;
               |SI #dscam003#23 = #dscam003#30;
                  #dscam003#14 = "L";
                  #dscam003#15 = "Recibo liquidado";
               |SINO;
                  #dscam003#14 = "C";
                  #dscam003#15 = "Cobrado parcialmente";
               |FINSI;
            |FINSI;
            |GRABA 020#dscam003.a; |BORRA 020#dscam004.a;
            |SAL;
         |SINO;
            |LEE 000#dscam004.s;
         |FINSI;
      |SIGUE;
      |LIBERA #dscam003;
   |FINSI;
   |REPON_FICHA #dscam004; |REPON_FICHA #dscam003;
|FPRC;

|DEFBUCLE LineasRec;
#dscam004#1;
;
#dscam003#40, 001;
#dscam003#40, 999;
;
NULL,LineasRec;
|FIN;

|PROCESO Recibos;
   aAlfa = #48#17; |QBF aAlfa;
   aAlfa = aAlfa + "def/agis0002.mas";
   |CARGA_DEF aAlfa, agis002@;
   |SI FSalida = 0;
      aAlfa = #48#17; |QBF aAlfa;
      aAlfa = aAlfa + "fich/" + (("00000" + #dscam003#46) % -105) + "/";
      |PATH_DAT #agis002@#aAlfa#;

      |ABRE #agis002@;
      #agis002@#30 = #dscam003#69;
      #agis002@#20 = #dscam003#0;
      #agis002@#17 = #dscam003#1;
      #agis002@#18 = #dscam003#2;
      |LEE 101#agis002@.=;
      |SI FSalida = 0;
         #agis002@#13 = "N";
         #agis002@#32 = "N";
         |GRABA 020#agis002@.a; |LIBERA #agis002@;
      |FINSI;
      |CIERRA #agis002@; |DESCARGA_DEF #agis002@;
   |FINSI;

   |SI #dscam003#23 = 0; |Y #dscam003#55 ! 0; |BUCLE LineasRec; |FINSI;
|FPRC;

|DEFBUCLE Recibos;
#dscam003#3;
69,12;
#0#0, #0#2, "!", #0#4;
#0#1, #0#3, "z", #0#5;
be;
NULL,Recibos;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA " Desaldado de entregas a cuenta";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |BUCLE Recibos;
   |FINSI;
|FPRO;
