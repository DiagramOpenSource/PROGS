|FICHEROS;
   dscaz057 #0;

   dscam003 #1;
   dscam004 #2;

   dscam008 #3;
   dscam009 #4;

   dscam066 #6;

   dscam014 #10;
   dscam012 #11;
   dscam013 #12;
   dscam021 #13;
   dscam022 #14;
   dscam046 #15;
   dscam047 #16;
   dscam049 #17;
   dscam050 #18;

   agif134@ #100;
   agif133@ #101;
   agif079@ #102;
   agif024@ #103;
   agif091@ #104;
   agif025@ #105;
   agif324@ #106;
   agif321@ #107;
   agif112@ #108;
   agif084@ #109;
   agif184@ #184;

   camaniva@ #200;
   caclipro@ #201;
   caforpag@ #202;
   camoneda@ #203;
   referen@ #300;
|FIN;

|VARIABLES;
   aPath = "";
   aIncre1 = "";
   nIncre1 = "";
   nume1   = 0;
   alfa1 = "";
   fectra1 = @;

   nSwExiste = 0;
   &EURO = 0;
   &EURODB = 0;
   &EURODV = 0;
   &Divisa = ""; &nDeci_Div = 0; &nDeci_Base = 0;
   &Niv1 = 0; &Niv2 = 0; &Niv3 = 0; &Niv4 = 0; &Niv5 = 0; &Niv6 = 0;

   SwDirecta = 0;
   aSerFac = "";
   nNumFac = 0;

   aAlfa  = "";
   aAlfa1 = "";
   DEjer = "";   HEjer = "";
   TipoDoc = ""; NumDoc = 0; LinDoc = 0; NumRemesa = 0; Nivel = 0;

   SwFind   = 0;
   nCalc    = 0;
   nUltImp  = 0;
   nImporte = 0;
   TotImp   = 0;
   Cuenta   = "";
   aLong    = ""; nLong = 0;
   FechaVto = @;

   LinCob    = 0;
   nCont     = 0;
   nFecVto   = 0;
   nImpVto   = 0;
   Documento = 0;
   DocumHno  = 0;
   HayMovs   = 0;
   SwRemesado = 0;
   HayLineaRem = 0;
|FIN;

|PROCESO ExisteRecCom;
     nSwExiste = 0;
     |SELECT #2#referen@;
     #referen@#27 = #camaniva@#0;
     #referen@#0 = #camaniva@#2;
     #referen@#1 = #camaniva@#3;
     #referen@#2 = 0;
     |LEE 000#referen@.];
     |PARA; |SI FSalida = 0;
               |Y #referen@#27 = #camaniva@#0;
               |Y #referen@#0 = #camaniva@#2;
               |Y #referen@#1 = #camaniva@#3; |HACIENDO;

          |SI #referen@#4 = #camaniva@#4; |Y #referen@#44 = #48#14;
                    |Y #referen@#45 = #48#19;
                    |Y #referen@#3 = FechaVto;
               nSwExiste = 1;
               |SAL;
          |FINSI;

          |LEE 000#referen@.s;
     |SIGUE;
|FPRC;

|PROCESO ExisteRecVta;
     nSwExiste = 0;
     |SELECT #6#referen@;
     #referen@#27 = #camaniva@#0;
     #referen@#0 = #camaniva@#2;
     #referen@#1 = #camaniva@#3;
     #referen@#2 = 0;
     #referen@#69 = "";
     #referen@#40 = 0;
     |LEE 000#referen@.];
     |PARA; |SI FSalida = 0;
               |Y #referen@#27 = #camaniva@#0;
               |Y #referen@#0 = #camaniva@#2;
               |Y #referen@#1 = #camaniva@#3; |HACIENDO;

          |SI #referen@#4 = #camaniva@#4; |Y #referen@#44 = #48#14;
                    |Y #referen@#45 = #48#19;
                    |Y #referen@#3 = FechaVto;
               nSwExiste = 1;
               |SAL;
          |FINSI;

          |LEE 000#referen@.s;
     |SIGUE;
|FPRC;

|PROCESO Remesas;
   |SELECT #1#dscam003;
   #dscam003#40 = #dscam013#16;
   |LEE 000#dscam003.=;
   |SI FSalida = 0; |Y #dscam003#14 = "R";
      |SI #dscam013#15 ! "S"; |ACABA; |FINSI;

      #dscam012#0 = #dscam013#0;
      |LEE 000#dscam012.=;
      |SI FSalida = 0;
         |SI #dscam012#8 = "N"; |Y #dscam012#9 = "S";
            #dscam012#8 = "S"; |GRABA 020#dscam012.a;
         |FINSI;
      |SINO;
         |ACABA;
      |FINSI;

      LinCob = #dscam013#17;
      |SI #dscam003#47 ! "S";
         || Actualizo  el historico de cobros
         |DDEFECTO #dscam004;
         #dscam004#17 = #dscam013#16;
         #dscam004#15 = #dscam013#2;
         #dscam004#0  = #dscam013#4;
         #dscam004#1  = #dscam013#3;
         #dscam004#2  = #dscam013#5;
         #dscam004#3  = LinCob;
         #dscam004#4  = #dscam012#14;
         #dscam004#5  = "REM";
         #dscam004#6  = #dscam012#1;
         #dscam003#40 = #dscam013#16;
         |LEE 010#dscam003.=;
         |SI FSalida = 0;
            #dscam004#7  = #dscam003#23; #dscam004#25  = #dscam003#61;
         |FINSI;
         #dscam004#8  = #dscam013#22; #dscam004#26  = #dscam013#7;
         #dscam004#9  = 0;
         #dscam004#10 = 0;
         |GRABA 020#dscam004.n;
      |FINSI;

      |SI #dscam003#47 ! "S";
         #dscam066#0 = #dscam003#40;
         |LEE 000#dscam066.=;
         |SI FSalida = 0; |BORRA 020#dscam066.a; |FINSI;

           |HAZ EsArtenvas;
           |SI FSalida ! 0;
             #dscam003#14 = "L";
             #dscam003#15 = "Recibo liquidado";
             #dscam003#26 = #dscam012#1;
             #dscam003#23 = #dscam003#23 + #dscam013#22; #dscam003#61 = #dscam003#61 + #dscam013#7;
          |FINSI;
         #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
         #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
         #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
         #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
         #dscam003#31 = #dscam003#30 - #dscam003#23;
         #dscam003#65 = #dscam003#64 - #dscam003#61;
         |GRABA 020#dscam003.a;
      |FINSI;
   |FINSI;
   |SELECT #6#dscam003;
|FPRC;

|DEFBUCLE Remesas;
#dscam013#1;
;
NumRemesa,001;
NumRemesa,999;
;
NULL,Remesas;
|FIN;

|PROCESO LinRecibosVenta;
   |SI #dscam004#5 = "REM"; HayLineaRem = 1; |FINSI;

   |SI #dscam004#5 = "REM"; |O #dscam004#5 = "COB";
    |O #dscam004#5 = "RCB"; |O #dscam004#5 = "CAC";
    |O #dscam004#5 = "RTA"; |O #dscam004#5 = "COP";
      |SI #dscam004#22 = "D";
         #dscam003#54 = #dscam003#54 + #dscam004#23;
         #dscam003#67 = #dscam003#67 + #dscam004#32;
      |FINSI;
      |SI #dscam004#22 = "E";
         #dscam003#55 = #dscam003#55 + #dscam004#23;
         #dscam003#68 = #dscam003#68 + #dscam004#32;
      |FINSI;
      #dscam003#56 = #dscam003#56 + #dscam004#24;
      #dscam003#31 = #dscam003#31 - #dscam004#8;
      #dscam003#65 = #dscam003#65 - #dscam004#26;
      #dscam003#23 = #dscam003#23 + #dscam004#8;
      #dscam003#61 = #dscam003#61 + #dscam004#26;
   |FINSI;

   |SI #dscam004#5 = "IMP";
      #dscam003#23 = #dscam003#23 - #dscam004#9;
      #dscam003#61 = #dscam003#61 - #dscam004#27;
      #dscam003#31 = #dscam003#31 + #dscam004#9;
      #dscam003#65 = #dscam003#65 + #dscam004#27;
      #dscam003#16 = #dscam003#16 + 1;
   |FINSI;

   #dscam003#26 = #dscam004#6;

   #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
   #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
   #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
   #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
   #dscam003#31 = #dscam003#30 - #dscam003#23; #dscam003#65 = #dscam003#64 - #dscam003#61;
   |SI #dscam003#31 = 0;
      #dscam003#14 = "L";
      #dscam003#15 = "Recibo Liquidado";
   |SINO;
      |SI #dscam003#23 = 0;
         |SI #dscam003#16 = 0;
            #dscam003#14 = "P";
            #dscam003#15 = "Pendiente de cobro";
         |SINO;
            #dscam003#14 = "I";
            #dscam003#15 = "Impagado";
         |FINSI;
      |SINO;
         #dscam003#14 = "C";
         #dscam003#15 = "Parcialmente cobrado";
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE LinRecibosVenta;
#dscam004#1;
;
#dscam003#40,01;
#dscam003#40,99;
;
NULL,LinRecibosVenta;
|FIN;

|PROCESO RecibosVenta;

   |SI SwDirecta = 0;
      aAlfa = #agif134@#1 % -104;
   |SINO;
      aAlfa = #agif084@#1 % -104;
   |FINSI;
   DEjer = "01.01." + aAlfa; HEjer = "31.12." + aAlfa;

   |SI SwDirecta = 0;
      #agif024@#0 = #agif134@#2;
   |SINO;
      #agif024@#0 = #agif084@#3;
   |FINSI;
   |LEE 000#agif024@.=;
   |SI FSalida ! 0; |O #agif024@#0 = "      ";
      |DDEFECTO #agif024@;
   |FINSI;

   |SI SwDirecta = 0;
      #agif091@#0 = #agif134@#11;
   |SINO;
      #agif091@#0 = #agif084@#8;
   |FINSI;
   |LEE 000#agif091@.=;
   |SI FSalida ! 0;
      |DDEFECTO #agif091@;
   |FINSI;

   |SI SwDirecta = 0;
      #agif025@#0 = #agif134@#7;
   |SINO;
      #agif025@#0 = #agif084@#6;
   |FINSI;
   |LEE 000#agif025@.=;
   |SI FSalida ! 0;
      |DDEFECTO #agif025@;
   |FINSI;

   |SI SwDirecta = 0;
      #agif324@#0 = #agif134@#58;
   |SINO;
      #agif324@#0 = #agif084@#65;
   |FINSI;
   |LEE 000#agif324@.=;
   |SI FSalida ! 0;
      |DDEFECTO #agif324@;
   |FINSI;

   |LEE 000#agif321@.p;
   |SI FSalida ! 0;
      |DDEFECTO #agif321@;
   |FINSI;

   |SI SwDirecta = 0;
      Divisa = #agif134@#58; |HAZ TomaDecim;
   |SINO;
      Divisa = #agif084@#65; |HAZ TomaDecim;
   |FINSI;

   #dscam014#0 = #agif024@#203;
   |LEE 000#dscam014.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscam014;
   |FINSI;

   |SELECT #6#dscam003;

   #dscam003#69 = " ";
   #dscam003#40 = 1;
   #dscam003#0 = #agif133@#4;
   #dscam003#1 = #agif133@#0;
   #dscam003#2 = #agif133@#1;
   |LEE 000#dscam003.];
   |PARA; |SI FSalida = 0; |Y #dscam003#0 = #agif133@#4; |Y #dscam003#1 = #agif133@#0;
    |Y #dscam003#2 = #agif133@#1; |Y #dscam003#69 = " "; |HACIENDO;
      |SI #dscam003#4 ] DEjer; |Y #dscam003#4 [ HEjer;
         |HAZ MiraSiRemesa;
         NumRemesa = #dscam003#17; |BUCLE Remesas;
         |SI #dscam003#30 = 0; |Y #dscam003#22 = 0; |Y NumRemesa = 0;
            |SI #dscam003#22 = 0; #dscam003#22 = #agif084@#73; |FINSI;
            |SI #dscam003#60 = 0; #dscam003#60 = (#agif084@#73 * #dscam003#59) ! nDeci_Base; |FINSI;
            |SI #dscam003#30 = 0; #dscam003#30 = #agif084@#73; |FINSI;
            |SI #dscam003#64 = 0; #dscam003#64 = (#agif084@#73 * #dscam003#59) ! nDeci_Base; |FINSI;
            |SI #dscam003#31 = 0; |Y #dscam003#23 = 0;
                #dscam003#31 = #agif084@#73;
                #dscam003#65 = (#agif084@#73 * #dscam003#59) ! nDeci_Base;
                #dscam003#23 = 0;
                #dscam003#61 = 0;
                #dscam003#14 = "P";
                #dscam003#15 = "Pendiente de cobro";
            |FINSI;
            |GRABA 020#dscam003.a;
         |FINSI;
         |ACABA;
      |SINO;
         |LEE 000#dscam003.s;
      |FINSI;
   |SIGUE;

   || Si no existe, busco alguno de sus 'hermanos' para crearlo a partir de
   ||    uno de ellos y si no encuentro ninguno , miro por si encuentro alguna
   ||    linea del historico de cobros que la pueda recoger. Si no encuentro
   ||    nada, entonces lo doy de alta desde cero

   Documento = -1; HayMovs = 0;
   #dscam004#15 = 0;
   #dscam004#0 = aSerFac;
   #dscam004#1 = nNumFac;
   #dscam004#2  = #agif133@#1;
   #dscam004#3  = 1;
   |LEE 000#dscam004.];
   |PARA; |SI FSalida = 0; |Y #dscam004#0 = aSerFac; |Y #dscam004#1 = nNumFac;
    |Y #dscam004#2 = #agif133@#1; |HACIENDO;
      |SI #dscam004#6 ] DEjer; |Y #dscam004#6 [ HEjer;
         Documento = #dscam004#17; HayMovs = 1; |SAL;
      |SINO;
         |LEE 000#dscam004.s;
      |FINSI;
   |SIGUE;
   |SI Documento < 0;
      |SELECT #3#dscam013;
      #dscam013#2 = 0;
      #dscam013#4 = aSerFac;
      #dscam013#3 = nNumFac;
      #dscam013#5 = #agif133@#1;
      #dscam013#16 = 1;
      |LEE 000#dscam013.];
      |PARA; |SI FSalida = 0; |Y #dscam013#4 = aSerFac; |Y #dscam013#3 = nNumFac;
       |Y #dscam013#5 = #agif133@#1; |HACIENDO;
         #dscam012#0 = #dscam013#0;
         |LEE 000#dscam012.=;
         |SI FSalida = 0;
            |SI #dscam012#1 ] DEjer; |Y #dscam012#1 [ HEjer;
               Documento = #dscam013#16; |SAL;
            |SINO;
               |LEE 000#dscam013.s;
            |FINSI;
         |FINSI;
      |SIGUE;
      |SELECT #4#dscam013;
   |FINSI;

   |SELECT #1#dscam003;
   |SI Documento < 0;
      |LEE 000#dscam003.u;
      |SI FSalida = 0;
         Documento = #dscam003#40 + 1;
      |SINO;
         Documento = 1;
      |FINSI;
   |FINSI;

   |DDEFECTO #dscam003;
   #dscam003#40 = Documento;
   |GRABA 020#dscam003.b;
   #dscam003#0  = aSerFac;
   #dscam003#1  = nNumFac;
   #dscam003#2  = #agif133@#1;
   #dscam003#3  = #agif133@#3;
   |SI SwDirecta = 0;
      #dscam003#4  = #agif134@#1;
   |SINO;
      #dscam003#4  = #agif084@#1;
   |FINSI;
   #dscam003#5  = #agif024@#16;
   #dscam003#6  = #agif024@#1;
   #dscam003#7  = #agif024@#29;
   #dscam003#8  = #agif024@#32;
   #dscam003#9  = #agif024@#33;
   #dscam003#10 = #agif024@#31;
   #dscam003#11 = #agif024@#30;
   #dscam003#12 = #agif091@#69;
   #dscam003#13 = "01";  || Departamento
   #dscam003#14 = "P";
   #dscam003#15 = "Pendiente de cobro";
   #dscam003#23 = 0;
   #dscam003#24 = 0;
   #dscam003#25 = 0;
   #dscam003#26 = "01.01.0000";
   |SI SwDirecta = 0;
      #dscam003#32 = #agif134@#2;
      #dscam003#33 = #agif134@#7;
   |SINO;
      #dscam003#32 = #agif084@#3;
      #dscam003#33 = #agif084@#6;
   |FINSI;
   #dscam003#34 = #agif025@#1;
   #dscam003#35 = "";
   #dscam003#36 = "";
   #dscam003#37 = 0;
   #dscam003#38 = 0;
   #dscam003#39 = #agif024@#3;
   #dscam003#46 = #48#15;
   #dscam003#48 = "N";
   #dscam003#51 = #agif024@#203;
   #dscam003#52 = #dscam014#1;
   #dscam003#53 = "01.01.0000";
   #dscam003#54 = 0;
   #dscam003#55 = 0;
   #dscam003#56 = 0;
   |SI SwDirecta = 0;
      #dscam003#57 = #agif134@#58;
   |SINO;
      #dscam003#57 = #agif084@#65;
   |FINSI;
   #dscam003#58 = #agif324@#1;
   #agif324@#0 = #agif321@#9;
   |LEE 000#agif324@.=;
   |SI FSalida ! 0;
      |SI SwDirecta = 0;
         #agif324@#2 = #agif134@#62;
      |SINO;
         #agif324@#2 = #agif084@#69;
      |FINSI;
   |FINSI;
   |SI SwDirecta = 0;
      #dscam003#59 = #agif134@#59 / #agif324@#2;
   |SINO;
      #dscam003#59 = #agif084@#66 / #agif324@#2;
   |FINSI;
   #dscam003#60 = #agif133@#2;
   #dscam003#22 = #dscam003#60 * #dscam003#59;
   #dscam003#61 = 0;
   #dscam003#62 = 0;
   #dscam003#63 = 0;
   #dscam003#64 = #agif133@#2;
   #dscam003#30 = #dscam003#64 * #dscam003#59;
   #dscam003#65 = #agif133@#2;
   #dscam003#31 = #dscam003#65 * #dscam003#59;
   #dscam003#66 = 0;
   #dscam003#67 = 0;
   #dscam003#69 = " ";
   #dscam003#70 = "";
   #dscam003#71 = "01.01.0000";
   #dscam003#72 = "";
   #dscam003#73 = "";
   #dscam003#74 = "";
   #dscam003#75 = "";
   #dscam003#76 = "";
   #dscam003#77 = "";
   #dscam003#78 = 0;
   #dscam003#79 = 0;

   |SELECT #4#dscam013;
   #dscam013#16 = #dscam003#40;
   #dscam013#24 = 1;
   |LEE 000#dscam013.];
   |SI FSalida = 0; |Y #dscam013#16 = #dscam003#40;
      #dscam003#17 = #dscam013#0;
      #dscam003#37 = #dscam013#1;
      #dscam003#14 = "R";
      #dscam003#15 = "Remesado";
   |FINSI;
   |SI HayMovs = 1;
      |BUCLE LinRecibosVenta;
   |FINSI;
   |GRABA 020#dscam003.a; |LIBERA #dscam003;
|FPRC;

|DEFBUCLE RecibosVenta;
#agif133@#1003;
;
aSerFac,nNumFac,001;
aSerFac,nNumFac,999;
;
NULL,RecibosVenta;
|FIN;

|PROCESO FacturasDirecta;
   SwDirecta = 1;
   Divisa = #agif084@#65; |HAZ CargaNDeci;
   aAlfa = #agif084@#1; |QBF aAlfa;
   aSerFac = #agif084@#48;
   nNumFac = #agif084@#0;
   |BUCLE RecibosVenta;
|FPRC;

|DEFBUCLE FacturasDirecta;
#agif084@#1002;
;
#dscaz057#1, #dscaz057#3;
#dscaz057#2, #dscaz057#4;
;
NULL,FacturasDirecta;
|FIN;

|PROCESO FacturasVenta;
   SwDirecta = 0;
   Divisa = #agif134@#58; |HAZ CargaNDeci;
   aAlfa = #agif134@#1; |QBF aAlfa;
   aSerFac = #agif134@#49;
   nNumFac = #agif134@#0;
   |BUCLE RecibosVenta;
|FPRC;

|DEFBUCLE FacturasVenta;
#agif134@#1002;
;
#dscaz057#1, #dscaz057#3;
#dscaz057#2, #dscaz057#4;
;
NULL,FacturasVenta;
|FIN;

|PROCESO LinRecibosCompra;
   TipoDoc = "";
   |SI #dscam009#5 = "PPA";
      |SELECT #3#dscam022;
      #dscam022#2 = 0;
      #dscam022#4 = #dscam008#0;
      #dscam022#3 = #dscam008#1;
      #dscam022#5 = nCont;
      #dscam022#13 = 1;
      |LEE 000#dscam022.];
      |SI FSalida = 0; |Y #dscam022#4 = #dscam008#0; |Y #dscam022#3 = #dscam008#1;
       |Y #dscam022#5 = nCont;
         TipoDoc = "P"; NumDoc = #dscam022#0; LinDoc = #dscam022#1;
      |FINSI;
      |SELECT #2#dscam022;
   |FINSI;
   |SI #dscam009#5 = "PTA";
      |SELECT #3#dscam047;
      #dscam047#2 = 0;
      #dscam047#4 = #dscam008#0;
      #dscam047#3 = #dscam008#1;
      #dscam047#5 = nCont;
      #dscam047#13 = 1;
      |LEE 000#dscam047.];
      |SI FSalida = 0; |Y #dscam047#4 = #dscam008#0; |Y #dscam047#3 = #dscam008#1;
       |Y #dscam047#5 = nCont;
         TipoDoc = "T"; NumDoc = #dscam047#0; LinDoc = #dscam047#1;
      |FINSI;
      |SELECT #2#dscam047;
   |FINSI;
   |SI #dscam009#5 = "PCF";
      |SELECT #3#dscam050;
      #dscam050#2 = 0;
      #dscam050#4 = #dscam008#0;
      #dscam050#3 = #dscam008#1;
      #dscam050#5 = nCont;
      #dscam050#13 = 1;
      |LEE 000#dscam050.];
      |SI FSalida = 0; |Y #dscam050#4 = #dscam008#0; |Y #dscam050#3 = #dscam008#1;
       |Y #dscam050#5 = nCont;
         Documento = #dscam050#13;
         TipoDoc = "C"; NumDoc = #dscam050#0; LinDoc = #dscam050#1;
      |FINSI;
      |SELECT #2#dscam050;
   |FINSI;

   |SI #dscam009#5 = "PAG"; |O #dscam004#9 = "PAP";
    |O #dscam009#5 = "PPA"; |O #dscam004#9 = "PTA";
    |O #dscam009#5 = "PCF";
      #dscam008#62 = #dscam008#62 + #dscam009#26;
      #dscam008#31 = #dscam008#31 - #dscam009#8;
      #dscam008#58 = #dscam008#58 - #dscam009#21;
      #dscam008#23 = #dscam008#23 + #dscam009#8;
      #dscam008#57 = #dscam008#57 + #dscam009#21;
   |FINSI;
   #dscam008#25 = #dscam008#22 + #dscam008#24 + #dscam008#38;
   #dscam008#64 = #dscam008#53 + #dscam008#54 + #dscam008#55;
   #dscam008#31 = #dscam008#25 - #dscam008#23; #dscam008#58 = #dscam008#56 - #dscam008#57;
   |SI #dscam008#31 = 0;
      #dscam008#14 = "L";
      #dscam008#15 = "Recibo Liquidado";
   |SINO;
      |SI #dscam008#23 ! 0;
         #dscam008#14 = "C";
         #dscam008#15 = "Parcialmente pagado";
      |SINO;
         |SI TipoDoc ! "";
            #dscam008#14 = "E";
            aAlfa = "Englobado en ";
            |SI TipoDoc = "P"; aAlfa = aAlfa + "pagare";   |FINSI;
            |SI TipoDoc = "T"; aAlfa = aAlfa + "talon";    |FINSI;
            |SI TipoDoc = "C"; aAlfa = aAlfa + "confirme"; |FINSI;
            #dscam008#15 = aAlfa;
         |FINSI;
      |FINSI;
   |FINSI;
   |SI TipoDoc ! "";
      |SI TipoDoc = "P"; #dscam008#47 = "Pagare";   |FINSI;
      |SI TipoDoc = "T"; #dscam008#47 = "Talon";    |FINSI;
      |SI TipoDoc = "C"; #dscam008#47 = "Confirme"; |FINSI;
      #dscam008#17 = NumDoc;
      #dscam008#37 = LinDoc;
      #dscam008#39 = TipoDoc;
   |FINSI;
|FPRC;

|DEFBUCLE LinRecibosCompra;
#dscam009#1;
;
#dscam008#40,01;
#dscam008#40,99;
;
NULL,LinRecibosCompra;
|FIN;

|PROCESO RecibosCompra;

   aAlfa = #agif079@#1 % -104;
   DEjer = "01.01." + aAlfa; HEjer = "31.12." + aAlfa;

   #agif112@#0 = #agif079@#2;
   |LEE 000#agif112@.=;
   |SI FSalida ! 0;
      |DDEFECTO #agif112@;
   |FINSI;

   #agif184@#0 = #agif112@#98;
   |LEE 000#agif184@.=;
   |SI FSalida ! 0; |DDEFECTO #agif184@; |FINSI;

   #agif091@#0 = #agif079@#11;
   |LEE 000#agif091@.=;
   |SI FSalida ! 0;
      |DDEFECTO #agif091@;
   |FINSI;

   #agif324@#0 = #agif079@#75;
   |LEE 000#agif324@.=;
   |SI FSalida ! 0;
      |DDEFECTO #agif324@;
   |FINSI;

   |LEE 000#agif321@.p;
   |SI FSalida ! 0;
      |DDEFECTO #agif321@;
   |FINSI;

   Divisa = #agif079@#75; |HAZ TomaDecim;
   |SELECT #2#dscam008;

   |PARA nCont = 1; |SI nCont [ 12; |HACIENDO nCont = nCont + 1;
      |SI nCont < 6;
         nFecVto = nCont + 67;
         nImpVto = nCont + 32;
      |SINO;
         nFecVto = nCont + 128;
         nImpVto = nCont + 32;
      |FINSI;
      |SI #agif079@#nImpVto# = 0; |VETE Sigue2; |FINSI;

      SwFind = 0;
      #dscam008#0 = #agif079@#66;
      #dscam008#1 = #agif079@#0;
      #dscam008#2 = nCont;
      |LEE 000#dscam008.=;
      |PARA; |SI FSalida = 0; |Y #dscam008#0 = #agif079@#66; |Y #dscam008#1 = #agif079@#0; |Y #dscam008#2 = nCont; |HACIENDO;
         |SI #dscam008#4 ] DEjer; |Y #dscam008#4 [ HEjer;
            SwFind = 1; |SAL;
         |SINO;
            |LEE 000#dscam008.s;
         |FINSI;
      |SIGUE;
      |SI SwFind ! 1;

         || Si no existe, busco alguno de sus 'hermanos' para crearlo a partir de
         ||    uno de ellos y si no encuentro ninguno , miro por si encuentro alguna
         ||    linea del historico de cobros que la pueda recoger. Si no encuentro
         ||    nada, entonces lo doy de alta desde cero

         Documento = -1; HayMovs = 0;
         #dscam009#13 = 0;
         #dscam009#0  = #agif079@#66;
         #dscam009#1  = #agif079@#0;
         #dscam009#2  = nCont;
         #dscam009#3  = 1;
         |LEE 000#dscam009.];
         |SI FSalida = 0; |Y #dscam009#0 = #agif079@#66; |Y #dscam009#1 = #agif079@#0;
          |Y #dscam009#2 = nCont; |Y #dscam009#6 ] DEjer; |Y #dscam009#6 [ HEjer;
            Documento = #dscam009#14; HayMovs = 1; |SAL;
         |FINSI;
         TipoDoc = ""; NumDoc = 0; LinDoc = 0;
         |SI Documento < 0;
            |SELECT #3#dscam022;
            #dscam022#2 = 0;
            #dscam022#4 = #agif079@#66;
            #dscam022#3 = #agif079@#0;
            #dscam022#5 = nCont;
            #dscam022#13 = 1;
            |LEE 000#dscam022.];
            |PARA; |SI FSalida = 0; |Y #dscam022#4 = #agif079@#66; |Y #dscam022#3 = #agif079@#0;
             |Y #dscam022#5 = nCont; |HACIENDO;
               #dscam021#0 = #dscam022#0;
               |LEE 000#dscam021.=;
               |SI FSalida = 0;
                  |SI #dscam021#1 ] DEjer; |Y #dscam021#1 [ HEjer;
                     Documento = #dscam022#13;
                     TipoDoc = "P"; NumDoc = #dscam022#0; LinDoc = #dscam022#1;
                     |SAL;
                  |SINO;
                     |LEE 000#dscam022.s;
                  |FINSI;
               |FINSI;
            |SIGUE;
            |SELECT #2#dscam022;
         |FINSI;

         |SI Documento < 0;
            |SELECT #3#dscam047;
            #dscam047#2 = 0;
            #dscam047#4 = #agif079@#66;
            #dscam047#3 = #agif079@#0;
            #dscam047#5 = nCont;
            #dscam047#13 = 1;
            |LEE 000#dscam047.];
            |PARA; |SI FSalida = 0; |Y #dscam047#4 = #agif079@#66; |Y #dscam047#3 = #agif079@#0;
             |Y #dscam047#5 = nCont; |HACIENDO;
               #dscam046#0 = #dscam047#0;
               |LEE 000#dscam046.=;
               |SI FSalida = 0;
                  |SI #dscam046#1 ] DEjer; |Y #dscam046#1 [ HEjer;
                     Documento = #dscam047#13;
                     TipoDoc = "T"; NumDoc = #dscam047#0; LinDoc = #dscam047#1;
                     |SAL;
                  |SINO;
                     |LEE 000#dscam047.s;
                  |FINSI;
               |FINSI;
            |SIGUE;
            |SELECT #2#dscam047;
         |FINSI;

         |SI Documento < 0;
            |SELECT #3#dscam050;
            #dscam050#2 = 0;
            #dscam050#4 = #agif079@#66;
            #dscam050#3 = #agif079@#0;
            #dscam050#5 = nCont;
            #dscam050#13 = 1;
            |LEE 000#dscam050.];
            |PARA; |SI FSalida = 0; |Y #dscam050#4 = #agif079@#66; |Y #dscam050#3 = #agif079@#0;
             |Y #dscam050#5 = nCont; |HACIENDO;
               #dscam049#0 = #dscam050#0;
               |LEE 000#dscam049.=;
               |SI FSalida = 0;
                  |SI #dscam049#1 ] DEjer; |Y #dscam049#1 [ HEjer;
                     Documento = #dscam050#13;
                     TipoDoc = "C"; NumDoc = #dscam050#0; LinDoc = #dscam050#1;
                     |SAL;
                  |SINO;
                     |LEE 000#dscam050.s;
                  |FINSI;
               |FINSI;
            |SIGUE;
            |SELECT #2#dscam050;
         |FINSI;

         |SELECT #1#dscam008;
         |SI Documento < 0;
            |LEE 000#dscam008.u;
            |SI FSalida = 0;
               Documento = #dscam008#40 + 1;
            |SINO;
               Documento = 1;
            |FINSI;
         |FINSI;

         |DDEFECTO #dscam008;
         #dscam008#40 = Documento;
         |GRABA 020#dscam008.b;
         #dscam008#0  = #agif079@#66;
         #dscam008#1  = #agif079@#0;
         #dscam008#2  = nCont;
         #dscam008#3  = #agif079@#nFecVto#;
         #dscam008#4  = #agif079@#1;
         #dscam008#5  = #agif112@#10;
         #dscam008#6  = #agif112@#1;
         #dscam008#7  = #agif112@#11;
         #dscam008#8  = #agif112@#14;
         #dscam008#9  = #agif112@#15;
         #dscam008#10 = #agif112@#13;
         #dscam008#11 = #agif112@#12;
         #dscam008#12 = #agif091@#69;
         #dscam008#13 = "01";  || Departamento
         #dscam008#14 = "P";
         #dscam008#15 = "Pendiente de pago";
         #dscam008#16 = #agif112@#98;
         #dscam008#22 = #agif079@#nImpVto#;
         #dscam008#23 = 0;
         #dscam008#24 = 0;
         #dscam008#25 = #agif079@#nImpVto#;
         #dscam008#26 = "01.01.0000";
         #dscam008#31 = #agif079@#nImpVto#;
         #dscam008#32 = #agif079@#2;
         #dscam008#35 = "";
         #dscam008#36 = "";
         #dscam008#37 = 0;
         #dscam008#38 = 0;
         #dscam008#46 = #48#15;
         #dscam008#48 = "N";
         #dscam008#51 = "N";
         #dscam008#52 = #agif184@#1;
         #dscam008#59 = #agif079@#75;
         #dscam008#63 = #agif079@#74;
         #dscam008#60 = #agif324@#1;
         #agif324@#0 = #agif321@#9;
         |LEE 000#agif324@.=;
         |SI FSalida ! 0;
            #agif324@#2 = #agif079@#79;
         |FINSI;
         #dscam008#61 = #agif079@#76 / #agif324@#3;
         #dscam008#53 = #dscam008#22 * #dscam008#61;
         #dscam008#54 = 0;
         #dscam008#55 = 0;
         #dscam008#56 = #dscam008#25 * #dscam008#61;
         #dscam008#57 = 0;
         #dscam008#58 = #dscam008#31 * #dscam008#61;
         #dscam008#62 = 0;
         #dscam008#67 = #agif079@#11;
         #dscam008#68 = #agif091@#1;

         |SI TipoDoc ! "";
            #dscam008#17 = NumDoc;
            #dscam008#37 = LinDoc;
            #dscam008#14 = "E";
            aAlfa = "Englobado en ";
            |SI TipoDoc = "P"; aAlfa = aAlfa + "pagare";   #dscam008#47 = "Pagare";   |FINSI;
            |SI TipoDoc = "T"; aAlfa = aAlfa + "talon";    #dscam008#47 = "Talon";    |FINSI;
            |SI TipoDoc = "C"; aAlfa = aAlfa + "confirme"; #dscam008#47 = "Confirme"; |FINSI;
            #dscam008#15 = aAlfa;
            #dscam008#39 = TipoDoc;
         |FINSI;
         |SI HayMovs = 1;
            |BUCLE LinRecibosCompra;
         |FINSI;
         |GRABA 020#dscam008.a; |LIBERA #dscam008;
|ET Sigue2;
      |FINSI;
   |SIGUE;
|FPRC;

|PROCESO FacturasCompra;
   Divisa = #agif079@#75; |HAZ CargaNDeci;
   aAlfa = #agif079@#1; |QBF aAlfa;
   |HAZ RecibosCompra;
|FPRC;

|DEFBUCLE FacturasCompra;
#agif079@#1002;
;
#dscaz057#1, #dscaz057#3;
#dscaz057#2, #dscaz057#4;
;
NULL,FacturasCompra;
|FIN;

|PROCESO MiraSiRemesa;
      |SELECT #3#dscam013;
      #dscam013#2 = 0;
      #dscam013#4 = #dscam003#0;
      #dscam013#3 = #dscam003#1;
      #dscam013#5 = #dscam003#2;
      #dscam013#16 = 1;
      |LEE 000#dscam013.];
      |SI FSalida ! 0; |O #dscam013#4 ! #dscam003#0; |O #dscam013#3 ! #dscam003#1;
       |O #dscam013#5 ! #dscam003#2; |O #dscam013#2 ! 0;
         |SELECT #4#dscam013;
         |ACABA;
      |FINSI;
      |SELECT #4#dscam013;

      |SI #dscam013#15 ! "S"; |ACABA; |FINSI;

      #dscam012#0 = #dscam013#0;
      |LEE 000#dscam012.=;
      |SI FSalida = 0;
         |SI #dscam012#8 = "N"; |Y #dscam012#9 = "S";
            #dscam012#8 = "S"; |GRABA 020#dscam012.a;
         |FINSI;
      |SINO;
         |ACABA;
      |FINSI;

      LinCob = #dscam013#17;
      |SI #dscam003#47 ! "S";
         || Actualizo  el historico de cobros
         |DDEFECTO #dscam004;
         #dscam004#17 = #dscam013#16;
         #dscam004#15 = #dscam013#2;
         #dscam004#0  = #dscam013#4;
         #dscam004#1  = #dscam013#3;
         #dscam004#2  = #dscam013#5;
         #dscam004#3  = LinCob;
         #dscam004#4  = #dscam012#14;
         #dscam004#5  = "REM";
         #dscam004#6  = #dscam012#1;
         #dscam003#40 = #dscam013#16;
         |LEE 010#dscam003.=;
         |SI FSalida = 0;
            #dscam004#7  = #dscam003#23; #dscam004#25  = #dscam003#61;
         |FINSI;
         #dscam004#8  = #dscam013#22; #dscam004#26  = #dscam013#7;
         #dscam004#9  = 0;
         #dscam004#10 = 0;
         |GRABA 020#dscam004.n;
      |FINSI;

      |SI #dscam003#47 ! "S";
         #dscam066#0 = #dscam003#40;
         |LEE 000#dscam066.=;
         |SI FSalida = 0; |BORRA 020#dscam066.a; |FINSI;

           |HAZ EsArtenvas;
           |SI FSalida ! 0;
             #dscam003#14 = "L";
             #dscam003#15 = "Recibo liquidado";
             #dscam003#26 = #dscam012#1;
             #dscam003#23 = #dscam003#23 + #dscam013#22; #dscam003#61 = #dscam003#61 + #dscam013#7;
          |FINSI;
         #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
         #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
         #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
         #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
         #dscam003#31 = #dscam003#30 - #dscam003#23;
         #dscam003#65 = #dscam003#64 - #dscam003#61;
         |GRABA 020#dscam003.a;
      |FINSI;
|FPRC;

|PROCESO MiraNivel;
   aAlfa = Cuenta; |QBF aAlfa;
   aLong = aAlfa % 0; nLong = aLong;
   Nivel = 0;
   |SI nLong = Niv1; Nivel = 1; |FINSI;
   |SI nLong = Niv2; Nivel = 2; |FINSI;
   |SI nLong = Niv3; Nivel = 3; |FINSI;
   |SI nLong = Niv4; Nivel = 4; |FINSI;
   |SI nLong = Niv5; Nivel = 5; |FINSI;
   |SI nLong = Niv6; Nivel = 6; |FINSI;
|FPRC;

|PROCESO FacturasVentaC;

   aAlfa = #camaniva@#4; |QBF aAlfa;
   DEjer = "01.01." + aAlfa; HEjer = "31.12." + aAlfa;

   #caclipro@#23 = "C";
   #caclipro@#10 = #camaniva@#12;
   Cuenta = #camaniva@#12; |HAZ MiraNivel;
   #caclipro@#11 = Nivel;
   |LEE 000#caclipro@.=;
   |SI FSalida ! 0;
      |DDEFECTO #caclipro@;
   |FINSI;

   #caforpag@#0 = #caclipro@#20;
   |LEE 000#caforpag@.=;
   |SI FSalida ! 0;
      |DDEFECTO #caforpag@;
   |FINSI;

   |SI #camoneda@#2 = "E";
      nDeci_Base = 2;
      nDeci_Div  = 2;
   |SINO;
      nDeci_Base = 0;
      nDeci_Div  = 0;
   |FINSI;

   #dscam014#0 = #caclipro@#28;
   |LEE 000#dscam014.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscam014;
   |FINSI;

   TotImp = #camaniva@#21;
   nImporte = 0;
   nUltImp = 0;
/*
   nCalc = #camaniva@#4 + #caforpag@#3; FechaVto = nCalc;
*/
   fectra1 = #camaniva@#4; nIncre1 = #caforpag@#3; |HAZ CalIncre;
   FechaVto = fectra1;

   |SI #camoneda@#2 = "E"; TotImp = (TotImp * 100) ! 0; |FINSI;

   |PARA nCont = 1; |SI nCont [ #caforpag@#2; |HACIENDO nCont = nCont + 1;
      |SI #caforpag@#2 = 1;
         nImporte = 0;
         nUltImp  = TotImp;
      |SINO;
         nImporte = ((TotImp / #caforpag@#2) - .5) ! 0;
         nCalc = nImporte * (#caforpag@#2 - 1);
         nUltImp = TotImp - nCalc;
         |SI nCont > 1;
/*
            nCalc = FechaVto;
            nCalc = nCalc + #caforpag@#4;
            FechaVto = nCalc;
*/
            nIncre1 = #caforpag@#4; |HAZ CalIncre;
            FechaVto = fectra1;

         |FINSI;
      |FINSI;

      |SI nCont = #caforpag@#2; nImporte = nUltImp; |FINSI;
      |SI #camoneda@#2 = "E"; nImporte = (nImporte / 100) ! 2; |FINSI;
      |SELECT #6#dscam003;

      #dscam003#69 = " ";
      #dscam003#40 = 1;
      #dscam003#27 = #camaniva@#0;
      #dscam003#0 = #camaniva@#2;
      #dscam003#1 = #camaniva@#3;
      #dscam003#2 = nCont;
      |LEE 000#dscam003.];
      |PARA; |SI FSalida = 0; |Y #dscam003#69 = " "; |Y #dscam003#27 = #camaniva@#0;
       |Y #dscam003#0 = #camaniva@#2; |Y #dscam003#1 = #camaniva@#3; |Y #dscam003#2 = nCont; |HACIENDO;
         |SI #dscam003#4 ] DEjer; |Y #dscam003#4 [ HEjer;
            |HAZ MiraSiRemesa;
            NumRemesa = #dscam003#17; |BUCLE Remesas;
            |VETE Sigue1;
         |SINO;
            |LEE 000#dscam003.s;
         |FINSI;
      |SIGUE;

      || Si no existe, busco alguno de sus 'hermanos' para crearlo a partir de
      ||    uno de ellos y si no encuentro ninguno , miro por si encuentro alguna
      ||    linea del historico de cobros que la pueda recoger. Si no encuentro
      ||    nada, entonces lo doy de alta desde cero

      Documento = -1; HayMovs = 0;
      #dscam004#15 = #camaniva@#0;
      #dscam004#0  = #camaniva@#2;
      #dscam004#1  = #camaniva@#3;
      #dscam004#2  = nCont;
      #dscam004#3  = 1;
      |LEE 000#dscam004.];
      nCalc = FSalida;
      aAlfa = #dscam004#0; aAlfa = aAlfa % 0102;
      FSalida = nCalc;
      |PARA; |SI FSalida = 0; |Y #dscam004#15 = #camaniva@#0; |Y aAlfa = #camaniva@#2;
       |Y #dscam004#1 = #camaniva@#3; |Y #dscam004#2 = nCont; |HACIENDO;
          |SI #dscam004#6 ] DEjer; |Y #dscam004#6 [ HEjer;
             Documento = #dscam004#17; HayMovs = 1; |SAL;
          |SINO;
             |LEE 000#dscam004.s;
          |FINSI;
      |SIGUE;
      |SI Documento < 0;
         |SELECT #3#dscam013;
         #dscam013#2 = #camaniva@#0;
         #dscam013#4 = #camaniva@#2;
         #dscam013#3 = #camaniva@#3;
         #dscam013#5 = nCont;
         #dscam013#16 = 1;
         |LEE 000#dscam013.];
         nCalc = FSalida;
         aAlfa = #dscam013#4; aAlfa = aAlfa % 0102;
         FSalida = nCalc;
         |PARA; |SI FSalida = 0; |Y aAlfa = #camaniva@#2; |Y #dscam013#3 = #camaniva@#3;
          |Y #dscam013#5 = nCont; |Y #dscam013#2 = #camaniva@#0; |HACIENDO;
             #dscam012#0 = #dscam013#0;
             |LEE 000#dscam012.=;
             |SI FSalida = 0;
                |SI #dscam012#1 ] DEjer; |Y #dscam012#1 [ HEjer;
                   Documento = #dscam013#16; |SAL;
                |SINO;
                   |LEE 000#dscam013.s;
                |FINSI;
             |FINSI;
         |SIGUE;
         |SELECT #4#dscam013;
      |FINSI;
      |SELECT #1#dscam003;

      |HAZ ExisteRecVta;
      |SI nSwExiste ! 0; |VETE Sigue1; |FINSI;

      |SI Documento < 0;
         |LEE 000#dscam003.u;
         |SI FSalida = 0;
            Documento = #dscam003#40 + 1;
         |SINO;
            Documento = 1;
         |FINSI;
      |FINSI;
      |DDEFECTO #dscam003;
      #dscam003#40 = Documento;
      |GRABA 020#dscam003.b;
      #dscam003#0  = #camaniva@#2;
      #dscam003#1  = #camaniva@#3;
      #dscam003#2  = nCont;
      #dscam003#3  = FechaVto;
      #dscam003#4  = #camaniva@#4;
      #dscam003#5  = #camaniva@#12;
      #dscam003#6  = #camaniva@#13;
      #dscam003#7  = #caclipro@#13;
      #dscam003#8  = #caclipro@#29;
      #dscam003#9  = #caclipro@#30;
      #dscam003#10 = #caclipro@#31;
      #dscam003#11 = #caclipro@#32;
      #dscam003#12 = #caforpag@#5;
      #dscam003#13 = "01";  || Departamento
      #dscam003#14 = "P";
      #dscam003#15 = "Pendiente de cobro";
      #dscam003#22 = nImporte;
      #dscam003#23 = 0;
      #dscam003#24 = 0;
      #dscam003#25 = 0;
      #dscam003#26 = "01.01.0000";
      #dscam003#27 = #camaniva@#0;
      #dscam003#30 = nImporte;
      #dscam003#31 = nImporte;
      #dscam003#32 = "000000";
      #dscam003#33 = "00";
      #dscam003#34 = "";
      #dscam003#35 = "";
      #dscam003#36 = "";
      #dscam003#37 = 0;
      #dscam003#38 = 0;
      #dscam003#39 = "";
      #dscam003#44 = #48#14;
      #dscam003#45 = #48#19;
      #dscam003#48 = "N";
      #dscam003#51 = #caclipro@#28;
      #dscam003#52 = #dscam014#1;
      #dscam003#53 = "01.01.0000";
      #dscam003#54 = 0;
      #dscam003#55 = 0;
      #dscam003#56 = 0;
      |SI #camoneda@#2 = "E";
         #dscam003#57 = "EUR";
         #dscam003#58 = "EURO";
         #dscam003#59 = 1;
      |SINO;
         #dscam003#57 = "ESP";
         #dscam003#58 = "PESETA ESPA¥OLA";
         #dscam003#59 = 1;
      |FINSI;
      #dscam003#60 = #dscam003#22 * #dscam003#59;
      #dscam003#61 = 0;
      #dscam003#62 = 0;
      #dscam003#63 = 0;
      #dscam003#64 = #dscam003#30 * #dscam003#59;
      #dscam003#65 = #dscam003#31 * #dscam003#59;
      #dscam003#66 = 0;
      #dscam003#67 = 0;
      #dscam003#69 = " ";
      #dscam003#70 = "";
      #dscam003#71 = "01.01.0000";
      #dscam003#72 = "";
      #dscam003#73 = "";
      #dscam003#74 = "";
      #dscam003#75 = "";
      #dscam003#76 = "";
      #dscam003#77 = "";
      #dscam003#78 = 0;
      #dscam003#79 = 0;
      #dscam003#85 = #camaniva@#22;

      #dscam013#16 = #dscam003#40;
      #dscam013#24 = 1;
      |LEE 000#dscam013.];
      |SI FSalida = 0; |Y #dscam013#16 = #dscam003#40;
         #dscam003#17 = #dscam013#0;
         #dscam003#37 = #dscam013#1;
         #dscam003#14 = "R";
         #dscam003#15 = "Remesado";
      |FINSI;
      |SI HayMovs = 1;
         |BUCLE LinRecibosVenta;
      |FINSI;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
|ET Sigue1;
   |SIGUE;
|FPRC;

|DEFBUCLE FacturasVentaC;
#camaniva@#3003;
36, 4;
00, #dscaz057#1, #dscaz057#3, "R", #dscaz057#6;
99, #dscaz057#2, #dscaz057#4, "R", #dscaz057#7;
;
NULL,FacturasVentaC;
|FIN;

|PROCESO CalIncre;
 aIncre1 = "";
 nume1   =  (nIncre1 / 30) - ((nIncre1 / 30) ! 0);
 |SI nume1 = 0;

     nume1 = nIncre1 / 30;
     alfa1 = nume1;
     alfa1 = ("000" + alfa1) % -103;
     aIncre1 = "0." + alfa1 + "0000";

     fectra1 = fectra1 + aIncre1;
 |SINO;
     fectra1 = fectra1 + nIncre1;
 |FINSI;

|FPRC;

|PROCESO FacturasCompraC;
   aAlfa = #camaniva@#4; |QBF aAlfa;
   DEjer = "01.01." + aAlfa; HEjer = "31.12." + aAlfa;

   #caclipro@#23 = "P";
   #caclipro@#10 = #camaniva@#12;
   Cuenta = #camaniva@#12; |HAZ MiraNivel;
   #caclipro@#11 = Nivel;
   |LEE 000#caclipro@.=;
   |SI FSalida ! 0;
      |DDEFECTO #caclipro@;
   |FINSI;

   #caforpag@#0 = #caclipro@#20;
   |LEE 000#caforpag@.=;
   |SI FSalida ! 0;
      |DDEFECTO #caforpag@;
   |FINSI;

   |SI #camoneda@#2 = "E";
      nDeci_Base = 2;
      nDeci_Div  = 2;
   |SINO;
      nDeci_Base = 0;
      nDeci_Div  = 0;
   |FINSI;

   #dscam014#0 = #caclipro@#28;
   |LEE 000#dscam014.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscam014;
   |FINSI;

   TotImp = #camaniva@#21;
   nImporte = 0;
   nUltImp = 0;
/*
   nCalc = #camaniva@#4 + #caforpag@#3; FechaVto = nCalc;
*/

   fectra1 = #camaniva@#4; nIncre1 = #caforpag@#3; |HAZ CalIncre;
   FechaVto = fectra1;

   |SI #camoneda@#2 = "E"; TotImp = (TotImp * 100) ! 0; |FINSI;

   |PARA nCont = 1; |SI nCont [ #caforpag@#2; |HACIENDO nCont = nCont + 1;
      |SI #caforpag@#2 = 1;
         nImporte = 0;
         nUltImp  = TotImp;
      |SINO;
         nImporte = ((TotImp / #caforpag@#2) - .5) ! 0;
         nCalc = nImporte * (#caforpag@#2 - 1);
         nUltImp = TotImp - nCalc;
         |SI nCont > 1;
/*
            nCalc = FechaVto;
            nCalc = nCalc + #caforpag@#4;
            FechaVto = nCalc;
*/
            nIncre1 = #caforpag@#4; |HAZ CalIncre;
            FechaVto = fectra1;
         |FINSI;
      |FINSI;

      |SI nCont = #caforpag@#2; nImporte = nUltImp; |FINSI;
      |SI #camoneda@#2 = "E"; nImporte = (nImporte / 100) ! 2; |FINSI;

      SwFind = 0;
      #dscam008#27 = #camaniva@#0;
      #dscam008#0 = #camaniva@#2;
      #dscam008#1 = #camaniva@#3;
      #dscam008#2 = nCont;
      |LEE 000#dscam008.=;
      |PARA; |SI FSalida = 0; |Y #dscam008#0 = #camaniva@#2; |Y #dscam008#1 = #camaniva@#3; |Y #dscam008#2 = nCont;
       |Y #dscam008#27 = #camaniva@#0; |HACIENDO;
         |SI #dscam008#4 ] DEjer; |Y #dscam008#4 [ HEjer;
            SwFind = 1; |SAL;
         |SINO;
            |LEE 000#dscam008.s;
         |FINSI;
      |SIGUE;
      |SI SwFind ! 1;

         || Si no existe, busco alguno de sus 'hermanos' para crearlo a partir de
         ||    uno de ellos y si no encuentro ninguno , miro por si encuentro alguna
         ||    linea del historico de cobros que la pueda recoger. Si no encuentro
         ||    nada, entonces lo doy de alta desde cero

         Documento = -1; HayMovs = 0;
         #dscam009#13 = #camaniva@#0;
         #dscam009#0  = #camaniva@#2;
         #dscam009#1  = #camaniva@#3;
         #dscam009#2  = nCont;
         #dscam009#3  = 1;
         |LEE 000#dscam009.];
         nCalc = FSalida;
         aAlfa = #dscam009#0; aAlfa = aAlfa % 0102;
         |PARA; |SI FSalida = 0; |Y aAlfa = #camaniva@#2; |Y #dscam009#1 = #camaniva@#3;
          |Y #dscam009#2 = nCont; |Y #dscam009#13 = #camaniva@#0; |HACIENDO;
             |SI #dscam009#6 ] DEjer; |Y #dscam009#6 [ HEjer;
                Documento = #dscam009#14; HayMovs = 1; |SAL;
             |SINO;
                |LEE 000#dscam009.s;
             |FINSI;
         |SIGUE;
         TipoDoc = ""; NumDoc = 0; LinDoc = 0;
         |SI Documento < 0;
            |SELECT #3#dscam022;
            #dscam022#2 = #camaniva@#0;
            #dscam022#4 = #camaniva@#2;
            #dscam022#3 = #camaniva@#3;
            #dscam022#5 = nCont;
            #dscam022#13 = 1;
            |LEE 000#dscam022.];
            nCalc = FSalida;
            aAlfa = #dscam022#4; aAlfa = aAlfa % 0102;
            FSalida = nCalc;
            |PARA; |SI FSalida = 0; |Y aAlfa = #camaniva@#2; |Y #dscam022#3 = #camaniva@#3;
             |Y #dscam022#5 = nCont; |Y #dscam022#2 = #camaniva@#0; |HACIENDO;
                #dscam021#0 = #dscam022#0;
                |LEE 000#dscam021.=;
                |SI FSalida = 0;
                   |SI #dscam021#1 ] DEjer; |Y #dscam021#1 [ HEjer;
                      Documento = #dscam022#13;
                      TipoDoc = "P"; NumDoc = #dscam022#0; LinDoc = #dscam022#1;
                      |SAL;
                   |SINO;
                      |LEE 000#dscam022.s;
                   |FINSI;
                |FINSI;
            |SIGUE;
            |SELECT #2#dscam022;
         |FINSI;

         |SI Documento < 0;
            |SELECT #3#dscam047;
            #dscam047#2 = #camaniva@#0;
            #dscam047#4 = #camaniva@#2;
            #dscam047#3 = #camaniva@#3;
            #dscam047#5 = nCont;
            #dscam047#13 = 1;
            |LEE 000#dscam047.];
            nCalc = FSalida;
            aAlfa = #dscam047#4; aAlfa = aAlfa % 0102;
            FSalida = nCalc;
            |PARA; |SI FSalida = 0; |Y aAlfa = #camaniva@#2; |Y #dscam047#3 = #camaniva@#3;
             |Y #dscam047#5 = nCont; |HACIENDO;
                #dscam046#0 = #dscam047#0;
                |LEE 000#dscam046.=;
                |SI FSalida = 0;
                   |SI #dscam046#1 ] DEjer; |Y #dscam046#1 [ HEjer;
                      Documento = #dscam047#13;
                      TipoDoc = "T"; NumDoc = #dscam047#0; LinDoc = #dscam047#1;
                      |SAL;
                   |SINO;
                      |LEE 000#dscam047.s;
                   |FINSI;
                |FINSI;
            |SIGUE;
            |SELECT #2#dscam047;
         |FINSI;

         |SI Documento < 0;
            |SELECT #3#dscam050;
            #dscam050#2 = #camaniva@#0;
            #dscam050#4 = #camaniva@#2;
            #dscam050#3 = #camaniva@#3;
            #dscam050#5 = nCont;
            #dscam050#13 = 1;
            |LEE 000#dscam050.];
            nCalc = FSalida;
            aAlfa = #dscam050#4; aAlfa = aAlfa % 0102;
            FSalida = nCalc;
            |PARA; |SI FSalida = 0; |Y aAlfa = #camaniva@#2; |Y #dscam050#3 = #camaniva@#3;
             |Y #dscam050#5 = nCont; |Y #dscam050#2 = #camaniva@#0; |HACIENDO;
                #dscam049#0 = #dscam050#0;
                |LEE 000#dscam049.=;
                |SI FSalida = 0;
                   |SI #dscam049#1 ] DEjer; |Y #dscam049#1 [ HEjer;
                      Documento = #dscam050#13;
                      TipoDoc = "C"; NumDoc = #dscam050#0; LinDoc = #dscam050#1;
                      |SAL;
                   |SINO;
                      |LEE 000#dscam050.s;
                   |FINSI;
                |FINSI;
            |SIGUE;
            |SELECT #2#dscam050;
         |FINSI;

         |HAZ ExisteRecCom;
         |SI nSwExiste ! 0; |VETE Sigue3; |FINSI;

         |SELECT #1#dscam008;
         |SI Documento < 0;
            |LEE 000#dscam008.u;
            |SI FSalida = 0;
               Documento = #dscam008#40 + 1;
            |SINO;
               Documento = 1;
            |FINSI;
         |FINSI;

         |DDEFECTO #dscam008;
         #dscam008#40 = Documento;
         |GRABA 020#dscam008.b;
         #dscam008#0  = #camaniva@#2;
         #dscam008#1  = #camaniva@#3;
         #dscam008#2  = nCont;
         #dscam008#3  = FechaVto;
         #dscam008#4  = #camaniva@#4;
         #dscam008#5  = #camaniva@#12;
         #dscam008#6  = #camaniva@#13;
         #dscam008#7  = #caclipro@#13;
         #dscam008#8  = #caclipro@#29;
         #dscam008#9  = #caclipro@#30;
         #dscam008#10 = #caclipro@#31;
         #dscam008#11 = #caclipro@#32;
         #dscam008#12 = #caforpag@#5;
         #dscam008#13 = "01";  || Departamento
         #dscam008#14 = "P";
         #dscam008#15 = "Pendiente de pago";
         #dscam008#22 = nImporte;
         #dscam008#23 = 0;
         #dscam008#24 = 0;
         #dscam008#25 = nImporte;
         #dscam008#26 = "01.01.0000";
         #dscam008#27 = #camaniva@#0;
         #dscam008#31 = nImporte;
         #dscam008#32 = "000000";
         #dscam008#35 = "";
         #dscam008#36 = "";
         #dscam008#37 = 0;
         #dscam008#38 = 0;
         #dscam008#44 = #48#14;
         #dscam008#45 = #48#19;
         #dscam008#48 = "N";
         #dscam008#51 = "N";
         #dscam008#52 = #caclipro@#13;
         |SI #camoneda@#2 = "E";
            #dscam008#59 = "EUR";
            #dscam008#60 = "EURO";
            #dscam008#61 = 1;
         |SINO;
            #dscam008#59 = "ESP";
            #dscam008#60 = "PESETA ESPA¥OLA";
            #dscam008#61 = 1;
         |FINSI;
         #dscam008#53 = #dscam008#22 * #dscam008#61;
         #dscam008#54 = 0;
         #dscam008#55 = 0;
         #dscam008#56 = #dscam008#25 * #dscam008#61;
         #dscam008#57 = 0;
         #dscam008#58 = #dscam008#31 * #dscam008#61;
         #dscam008#62 = 0;
         #dscam008#63 = #camaniva@#22;
         #dscam008#67 = #caforpag@#0;
         #dscam008#68 = #caforpag@#1;

         |SI TipoDoc ! "";
            #dscam008#17 = NumDoc;
            #dscam008#37 = LinDoc;
            #dscam008#14 = "E";
            aAlfa = "Englobado en ";
            |SI TipoDoc = "P"; aAlfa = aAlfa + "pagare";   #dscam008#47 = "Pagare";   |FINSI;
            |SI TipoDoc = "T"; aAlfa = aAlfa + "talon";    #dscam008#47 = "Talon";    |FINSI;
            |SI TipoDoc = "C"; aAlfa = aAlfa + "confirme"; #dscam008#47 = "Confirme"; |FINSI;
            #dscam008#15 = aAlfa;
            #dscam008#39 = TipoDoc;
         |FINSI;
         |SI HayMovs = 1;
            |BUCLE LinRecibosCompra;
         |FINSI;
         |GRABA 020#dscam008.a; |LIBERA #dscam008;
        |ET Sigue3;
         |SELECT #2#dscam008;
      |FINSI;
   |SIGUE;
|FPRC;

|DEFBUCLE FacturasCompraC;
#camaniva@#3003;
36, 4;
00, #dscaz057#1, #dscaz057#3, "S", #dscaz057#6;
99, #dscaz057#2, #dscaz057#4, "S", #dscaz057#7;
;
NULL,FacturasCompraC;
|FIN;

|PROCESO RecibosV;
   |SI #dscam003#17 ! 0;
      |SALVA_FICHA #dscam003;
      NumRemesa = #dscam003#17; |BUCLE Remesas;
      |REPON_FICHA #dscam003;
   |FINSI;
|FPRC;

|DEFBUCLE RecibosV;
#dscam003#6;
;
00,#dscaz057#1,#dscaz057#3,001, " ", 000000001;
99,#dscaz057#2,#dscaz057#4,999, " ", 999999999;
;
NULL,RecibosV;
|FIN;

|PROCESO Aplica; |TIPO 0;
     |SI #0#5 = "C";
          |C_M #0#6, 1, "S";
          |C_M #0#7, 1, "S";
     |SINO;
          |C_M #0#6, 1, "N";
          |C_M #0#7, 1, "N";
     |FINSI;
|FPRC;

|PROGRAMA;
   |HAZ Tipo8;

   |CLS;
   |CABEZA "Recalculo integridad cartera";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |SI #0#5 = "G";
          aAlfa = #48#17; |QBF aAlfa;
          aAlfa1 = aAlfa + "def/agifa024.mas"; |CARGA_DEF aAlfa1, agif024@;
          |SI FSalida ! 0;
             |MENAV "0000Problemas al cargar la referencia de clientes";
             |HAZ Tipo9; |ERROR; |ACABA;
          |FINSI;
          aAlfa1 = aAlfa + "def/agifa091.mas"; |CARGA_DEF aAlfa1, agif091@;
          |SI FSalida ! 0;
             |MENAV "0000Problemas al cargar la referencia de formas de pago";
             |DESCARGA_DEF #agif024@;
             |HAZ Tipo9; |ERROR; |ACABA;
          |FINSI;
          aAlfa1 = aAlfa + "def/agifa025.mas"; |CARGA_DEF aAlfa1, agif025@;
          |SI FSalida ! 0;
             |MENAV "0000Problemas al cargar la referencia de representantes";
             |DESCARGA_DEF #agif091@; |DESCARGA_DEF #agif024@;
             |HAZ Tipo9; |ERROR; |ACABA;
          |FINSI;
          aAlfa1 = aAlfa + "def/agifa324.mas"; |CARGA_DEF aAlfa1, agif324@;
          |SI FSalida ! 0;
             |MENAV "0000Problemas al cargar la referencia de Divisas";
             |DESCARGA_DEF #agif025@; |DESCARGA_DEF #agif091@; |DESCARGA_DEF #agif024@;
             |HAZ Tipo9; |ERROR; |ACABA;
          |FINSI;
          aAlfa1 = aAlfa + "def/agifa321.mas"; |CARGA_DEF aAlfa1, agif321@;
          |SI FSalida ! 0;
             |MENAV "0000Problemas al cargar la referencia de Parametros de Divisas";
             |DESCARGA_DEF #agif324@; |DESCARGA_DEF #agif025@;
             |DESCARGA_DEF #agif091@; |DESCARGA_DEF #agif024@;
             |HAZ Tipo9; |ERROR; |ACABA;
          |FINSI;
          aAlfa1 = aAlfa + "def/agifa112.mas"; |CARGA_DEF aAlfa1, agif112@;
          |SI FSalida ! 0;
             |MENAV "0000Problemas al cargar la referencia de proveedores";
             |DESCARGA_DEF #agif321@;
             |DESCARGA_DEF #agif324@; |DESCARGA_DEF #agif025@;
             |DESCARGA_DEF #agif091@; |DESCARGA_DEF #agif024@;
             |HAZ Tipo9; |ERROR; |ACABA;
          |FINSI;
          |SI #dscaz057#0 = "V"; |O #dscaz057#0 = "A";
             aAlfa1 = aAlfa + "def/agifa134.mas"; |CARGA_DEF aAlfa1, agif134@;
             |SI FSalida ! 0;
                |MENAV "0000Problemas al cargar la referencia de facturas de venta";
                |DESCARGA_DEF #agif112@;
                |DESCARGA_DEF #agif321@; |DESCARGA_DEF #agif324@;
                |DESCARGA_DEF #agif025@; |DESCARGA_DEF #agif091@; |DESCARGA_DEF #agif024@;
                |HAZ Tipo9; |ERROR; |ACABA;
             |FINSI;
             aAlfa1 = aAlfa + "def/agifa133.mas"; |CARGA_DEF aAlfa1, agif133@;
             |SI FSalida ! 0;
                |MENAV "0000Problemas al cargar la referencia de vtos. de facturas de venta";
                |DESCARGA_DEF #agif134@; |DESCARGA_DEF #agif112@;
                |DESCARGA_DEF #agif324@; |DESCARGA_DEF #agif025@;
                |DESCARGA_DEF #agif091@; |DESCARGA_DEF #agif024@;
                |HAZ Tipo9; |ERROR; |ACABA;
             |FINSI;
             aAlfa1 = aAlfa + "def/agifa084.mas"; |CARGA_DEF aAlfa1, agif084@;
             |SI FSalida ! 0;
                |MENAV "0000Problemas al cargar la referencia de vtos. de facturas directas";
                |DESCARGA_DEF #agif133@;
                |DESCARGA_DEF #agif134@; |DESCARGA_DEF #agif112@;
                |DESCARGA_DEF #agif324@; |DESCARGA_DEF #agif025@;
                |DESCARGA_DEF #agif091@; |DESCARGA_DEF #agif024@;
                |HAZ Tipo9; |ERROR; |ACABA;
             |FINSI;
          |FINSI;
          |SI #dscaz057#0 = "C"; |O #dscaz057#0 = "A";
             aAlfa1 = aAlfa + "def/agifa079.mas"; |CARGA_DEF aAlfa1, agif079@;
             |SI FSalida ! 0;
                |MENAV "0000Problemas al cargar la referencia de facturas de compra";
                |SI #dscaz057#0 = "A"; |DESCARGA_DEF #agif133@; |DESCARGA_DEF #agif134@; |FINSI;
                |DESCARGA_DEF #agif321@;
                |DESCARGA_DEF #agif324@; |DESCARGA_DEF #agif025@;
                |DESCARGA_DEF #agif091@; |DESCARGA_DEF #agif024@;
                |HAZ Tipo9; |ERROR; |ACABA;
             |FINSI;
          |FINSI;
          aAlfa = #48#17; |QBF aAlfa;
          aAlfa = aAlfa + "fich/" + (("00000" + #48#15) % -105) + "/";
          |SI #dscaz057#0 = "V"; |O #dscaz057#0 = "A";
             |PATH_DAT #100 aAlfa; |PATH_DAT #101 aAlfa;
             |PATH_DAT #109 aAlfa;
          |FINSI;
          |SI #dscaz057#0 = "C"; |O #dscaz057#0 = "A";
             |PATH_DAT #102 aAlfa;
          |FINSI;
          aPath = aAlfa;
          |PATH_DAT #103 aAlfa; |PATH_DAT #104 aAlfa;
          |PATH_DAT #105 aAlfa; |PATH_DAT #106 aAlfa;
          |PATH_DAT #107 aAlfa; |PATH_DAT #108 aAlfa;
          |ABRE #agif024@; |ABRE #agif091@; |ABRE #agif025@;
          |ABRE #agif321@; |ABRE #agif324@; |ABRE #agif112@;
          |SI #dscaz057#0 = "V"; |O #dscaz057#0 = "A";
             |ABRE #agif133@; |ABRE #agif134@;
          |FINSI;
          |SI #dscaz057#0 = "C"; |O #dscaz057#0 = "A";
             |ABRE #agif079@;
          |FINSI;
          |SI #dscaz057#0 = "V"; |O #dscaz057#0 = "A";
             |ABRE #agif133@; |ABRE #agif134@; |ABRE #agif084@;
          |FINSI;
          |SI #dscaz057#0 = "C"; |O #dscaz057#0 = "A";
             |ABRE #agif079@;
          |FINSI;

          |SI #dscaz057#0 = "V"; |O #dscaz057#0 = "A";
             |ABRE #dscam003;   |ABRE #dscam004;   |ABRE #dscam014;
             |ABRE #dscam012;   |ABRE #dscam013;   |ABRE #dscam066;
             |SELECT #2#dscam004; |SELECT #4#dscam013;
             |BUCLE FacturasVenta;
             |BUCLE FacturasDirecta;
             |BUCLE RecibosV;
             |SELECT #1#dscam013; |SELECT #1#dscam004;
             |CIERRA #dscam013; |CIERRA #dscam012; |CIERRA #dscam066;
             |CIERRA #dscam014; |CIERRA #dscam004; |CIERRA #dscam003;
         |FINSI;

         |SI #dscaz057#0 = "C"; |O #dscaz057#0 = "A";
             |ABRE #dscam008;   |ABRE #dscam009;
             |ABRE #dscam021;   |ABRE #dscam022;
             |ABRE #dscam046;   |ABRE #dscam047;
             |ABRE #dscam049;   |ABRE #dscam050;
             |SELECT #2#dscam009; |SELECT #2#dscam022;
             |SELECT #2#dscam047; |SELECT #2#dscam050;
             aAlfa = #48#17; |QBF aAlfa;
             aAlfa1 = aAlfa + "def/agifa184.mas"; |CARGA_DEF aAlfa1, agif184@;
             |SI FSalida = 0;
                  |PATH_DAT #agif184@#aPath#;
                  |ABRE #agif184@;
                  |BUCLE FacturasCompra;
                  |CIERRA #agif184@;
                  |DESCARGA_DEF #agif184@;
             |SINO;
                  |MENAV "0000Problemas al cargar bancos...";
             |FINSI;

             |SELECT #1#dscam047; |SELECT #1#dscam050;
             |SELECT #1#dscam009; |SELECT #1#dscam022;
             |CIERRA #dscam049;   |CIERRA #dscam050;
             |CIERRA #dscam046;   |CIERRA #dscam047;
             |CIERRA #dscam021;   |CIERRA #dscam022;
             |CIERRA #dscam008;   |CIERRA #dscam009;
          |FINSI;

          |SI #dscaz057#0 = "C"; |O #dscaz057#0 = "A";
             |CIERRA #agif079@; |DESCARGA_DEF #agif079@;
          |FINSI;
          |SI #dscaz057#0 = "V"; |O #dscaz057#0 = "A";
             |CIERRA #agif084@; |DESCARGA_DEF #agif084@;
             |CIERRA #agif133@; |DESCARGA_DEF #agif133@;
             |CIERRA #agif134@; |DESCARGA_DEF #agif134@;
          |FINSI;
          |CIERRA #agif112@; |DESCARGA_DEF #agif112@;
          |CIERRA #agif321@; |DESCARGA_DEF #agif321@;
          |CIERRA #agif324@; |DESCARGA_DEF #agif324@;
          |CIERRA #agif025@; |DESCARGA_DEF #agif025@;
          |CIERRA #agif091@; |DESCARGA_DEF #agif091@;
          |CIERRA #agif024@; |DESCARGA_DEF #agif024@;
      |FINSI;

      |SI #0#5 = "C";
          aAlfa = #48#16; |QBF aAlfa;
          aAlfa1 = aAlfa + "def/camaniva.mas"; |CARGA_DEF aAlfa1, camaniva@;
          |SI FSalida ! 0;
             |MENAV "0000Problemas al cargar la referencia del registro de IVA";
             |HAZ Tipo9; |ERROR; |ACABA;
          |FINSI;
          aAlfa1 = aAlfa + "def/caclipro.mas"; |CARGA_DEF aAlfa1, caclipro@;
          |SI FSalida ! 0;
             |MENAV "0000Problemas al cargar la referencia de clientes/Proveedores";
             |DESCARGA_DEF #camaniva@;
             |HAZ Tipo9; |ERROR; |ACABA;
          |FINSI;
          aAlfa1 = aAlfa + "def/caforpag.mas"; |CARGA_DEF aAlfa1, caforpag@;
          |SI FSalida ! 0;
             |MENAV "0000Problemas al cargar la referencia de formas de pago";
             |DESCARGA_DEF #caclipro@; |DESCARGA_DEF #camaniva@;
             |HAZ Tipo9; |ERROR; |ACABA;
          |FINSI;
          aAlfa1 = aAlfa + "def/camoneda.mas"; |CARGA_DEF aAlfa1, camoneda@;
          |SI FSalida ! 0;
             |MENAV "0000Problemas al cargar la referencia de formas de pago";
             |DESCARGA_DEF #caforpag@;
             |DESCARGA_DEF #caclipro@; |DESCARGA_DEF #camaniva@;
             |HAZ Tipo9; |ERROR; |ACABA;
          |FINSI;

          aAlfa = #48#16; |QBF aAlfa;
          aAlfa = aAlfa + "fich/" + ((("00000" + #48#14) % -105) + #48#19) + "/";
          |PATH_DAT #200 aAlfa; |PATH_DAT #201 aAlfa;
          |PATH_DAT #202 aAlfa; |PATH_DAT #203 aAlfa;
          |ABRE #camaniva@; |ABRE #caforpag@;
          |ABRE #caclipro@; |ABRE #camoneda@;

          #camoneda@#0 = #48#14;
          #camoneda@#1 = #48#19;
          |LEE 000#camoneda@.=;
          |SI FSalida ! 0;
             |DDEFECTO #camoneda@;
          |FINSI;
          |SI #camoneda@#2 = "P"
             EURO = 1 / 166.386;
             EURODB = 0;
             EURODV = 2;
          |SINO;
             EURO = 166.386;
             EURODB = 2;
             EURODV = 0;
          |FINSI;

          |SI #dscaz057#0 = "V"; |O #dscaz057#0 = "A";
             |DDEF aAlfa;
             aAlfa = aAlfa + "dscam003";
             |CARGA_DEF aAlfa, referen@;
             |SI FSalida = 0;
                  |ABRE #referen@;
                  |ABRE #dscam003;   |ABRE #dscam004;   |ABRE #dscam014;
                  |ABRE #dscam012;   |ABRE #dscam013;
                  |SELECT #2#dscam004; |SELECT #4#dscam013;
                  |BUCLE FacturasVentaC;
                  |SELECT #1#dscam013; |SELECT #1#dscam004;
                  |CIERRA #dscam013; |CIERRA #dscam012;
                  |CIERRA #dscam014; |CIERRA #dscam004; |CIERRA #dscam003;
                  |CIERRA #referen@;
                  |DESCARGA_DEF #referen@;
             |FINSI;
          |FINSI;

          |SI #dscaz057#0 = "C"; |O #dscaz057#0 = "A";
             |DDEF aAlfa;
             aAlfa = aAlfa + "dscam008";
             |CARGA_DEF aAlfa, referen@;
             |SI FSalida = 0;
                  |ABRE #referen@;
                  |ABRE #dscam008;   |ABRE #dscam009;
                  |ABRE #dscam021;   |ABRE #dscam022;
                  |ABRE #dscam046;   |ABRE #dscam047;
                  |ABRE #dscam049;   |ABRE #dscam050;
                  |SELECT #2#dscam009; |SELECT #2#dscam022;
                  |SELECT #2#dscam047; |SELECT #2#dscam050;
                  |SELECT #2#dscam008;
                  |BUCLE FacturasCompraC;
                  |SELECT #1#dscam008;
                  |SELECT #1#dscam047; |SELECT #1#dscam050;
                  |SELECT #1#dscam009; |SELECT #1#dscam022;
                  |CIERRA #dscam049;   |CIERRA #dscam050;
                  |CIERRA #dscam046;   |CIERRA #dscam047;
                  |CIERRA #dscam021;   |CIERRA #dscam022;
                  |CIERRA #dscam008;   |CIERRA #dscam009;
                  |CIERRA #referen@;
                  |DESCARGA_DEF #referen@;
             |FINSI;
          |FINSI;
          |CIERRA #camoneda@; |DESCARGA_DEF #camoneda@;
          |CIERRA #caforpag@; |DESCARGA_DEF #caforpag@;
          |CIERRA #caclipro@; |DESCARGA_DEF #caclipro@;
          |CIERRA #camaniva@; |DESCARGA_DEF #camaniva@;
      |FINSI;

   |FINSI;
   |HAZ Tipo9;
|FPRO;
