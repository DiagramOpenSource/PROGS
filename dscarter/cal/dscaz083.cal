|FICHEROS;
   dscaz083 #0;

   dscam003 #10;
   dscam090 #11;
   dscaw067 #12;
|FIN;

|VARIABLES;
   &Divisa = ""; &nDeci_Div = 0; &nDeci_Base = 0;
   &enTDocums = 0;

   nLinea  = 0;
   nCont   = 0;
   nCont1  = 0;
   nCalc   = 0;
   nCalc1  = 0;
   nCalc2  = 0;
   nTimbre = 0;

   nNumTotal = 0;
|FIN;

|PROCESO dscaz083;
   |SI #dscam003#30 = 0; |ACABA; |FINSI;
   |SI #dscam003#14 = "A"; |O #dscam003#14 = "D"; |ACABA; |FINSI;

   Divisa = #dscam003#57; |HAZ TomaDecim;
   |SI FSalida = 0;
      |PARA nCont = 1; |SI nCont [ 60; |HACIENDO nCont = nCont + 3;
         nCalc1 = #dscam090#nCont#;  nCont = nCont + 1;
         nCalc2 = #dscam090#nCont#;  nCont = nCont + 1;
         nTimbre = #dscam090#nCont#; nCont = nCont - 2;
         |SI nCalc1 [ #dscam003#30; |Y nCalc2 ] #dscam003#30;
            nCalc = ((nCont + 2) / 3) + 3;  #dscaz083#nCalc# = #dscaz083#nCalc# + 1;
            nCalc = ((nCont + 2) / 3) + 23; #dscaz083#nCalc# = #dscaz083#nCalc# + nTimbre;
            enTDocums = enTDocums + #dscam003#30; |SAL;
         |FINSI;
      |SIGUE;
   |FINSI;
|FPRC;

|DEFBUCLE dscaz083;
#dscam003#3;
0,12;
#dscaz083#0, 000000001, #dscaz083#3, #dscaz083#1;
#dscaz083#0, 999999999, #dscaz083#3, #dscaz083#2;
;
NULL,dscaz083;
|FIN;

|PROCESO Informe;
   |SI #dscaw067#3 ! 0;
      |PRINT;
   |FINSI;
|FPRC;

|DEFBUCLE Informe;
#dscaw067#1;
;
INICIO;
FINAL;
;
NULL,Informe;
|FIN;

|PROGRAMA;
   |DDEFECTO #dscaz083;
   |CLS;
   |CABEZA " Informe calculo de timbres ";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |ABRE #dscam090;
      |LEE 000#dscam090.p;
      |SI FSalida ! 0;
         |MENAV "    No existe la tabla de importes de timbres. Proceso abortado";
         |CIERRA #dscam090; |ACABA;
      |FINSI;
      |BUCLE dscaz083;
      |CIERRA #dscam090;

      |DELINDEX #dscaw067; |ABRE #dscaw067; nLinea = 1; nNumTotal = 0;
      |PARA nCont = 1; |SI nCont [ 58; |HACIENDO nCont = nCont + 3;
         |DDEFECTO #dscaw067;
         #dscaw067#0 = nLinea;
         nCalc = nCont;       #dscaw067#1 = #dscam090#nCalc#;
         nCalc = nCont + 1;   #dscaw067#2 = #dscam090#nCalc#;
         nCalc = nLinea + 3;  #dscaw067#3 = #dscaz083#nCalc#;
         nCalc = nLinea + 23; #dscaw067#4 = #dscaz083#nCalc#;
         nCalc = nCont + 2;   #dscaw067#5 = #dscam090#nCalc#;
         |GRABA 020#dscaw067.n;
         nLinea = nLinea + 1; nNumTotal = nNumTotal + #dscaw067#4;
      |SIGUE;
      |CIERRA #dscaw067;

      |IMPRE 0;
      |SI FSalida ! 0; |ACABA; |FINSI;
      |INFOR "dscaz083";
      |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

      |SI nNumTotal ! 0;
         |BUCLE Informe; |PIEINF;
      |FINSI;
      |FININF; |FINIMP;
   |FINSI;
|FPRO;
