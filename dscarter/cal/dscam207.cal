|FICHEROS;
  dscam207 #0;
  dscam208 #1;
|FIN;

|VARIABLES;
    &enCalen       = 0;
    &eSwNoCrea     = 0;

    aEjer          = "";
    nCalc          = 0;
    DiasEnero      = 31;
    DiasFebrero    = 28;
    DiasMarzo      = 31;
    DiasAbril      = 30;
    DiasMayo       = 31;
    DiasJunio      = 30;
    DiasJulio      = 31;
    DiasAgosto     = 31;
    DiasSeptiembre = 30;
    DiasOctubre    = 31;
    DiasNoviembre  = 30;
    DiasDiciembre  = 31;
    aAlfa1         = "";
    aAlfa2         = "";
    aAlfa21        = "";
    fFech1         = @;
    fFech2         = @;
    sdia           = 0;
    nCoMes         = 0;
    NumDias        = 0;
    Cont           = 0;
    ContDias       = 0;
    Desde          = "";
    Hasta          = "";
    Peso           = 0;
    PesoAnt        = 0;
    DDia           = 0;
    DMes           = 0;
    HDia           = 0;
    HMes           = 0;

    Calc  = 0;
    nume1 = 0;
    trab1 = "";
    varalfa = "";
    varalfa1 = "";
    varalfa2  = "";
    vardia = 0;
    varmes = 0;
    fechadesde = "";
    fechadesde1 = "";
    fechadesde2 = "";
    fechahasta = "";
    fechahasta1 = "";
    fechahasta2 = "";
    camp = 0;
    procesa = "     Estoy procesando espere un poco Por Favor";
    modifi = "2330S  Modificar el calendario S/N : ";
    alta = "2330S     Dar el alta al calendario S/N : ";
    errorfec1 = "     Fecha erronea DD/MM";
    errorfec2 = "     Fecha Hasta menor que la Fecha Desde";
    errorfec3 = "     No existe ese dia el a¤o no es bisiesto";
    bisiesto = "";
    swbis = 1;
    anyo = "";  year = 0;

    alfa1 = ""; fech1 = @; fech2 = @;

    ContMes = 0;
    ModoEntrada = 0; Comodin = ""; Comodin1 = "";

    fFecha = @;
|FIN;

|PROCESO CreaCalend;
  |PINTA 2330, "Creando Calendario ";

  aEjer = #dscam207#1; |QBF aEjer;

  |ABRE #dscam208;
  #dscam208#0  = enCalen;
  #dscam208#13 = aEjer;
  |LEE 110#dscam208.=;
  |SI FSalida ! 0;
      |DDEFECTO #dscam208;
      #dscam208#0 = enCalen;
      #dscam208#13 = aEjer;
      |GRABA 020#dscam208.b;
  |SINO;
      |SI eSwNoCrea = 1;
          |CIERRA #dscam208;
          |PINTA 2330, "                   ";
          |ACABA;
      |FINSI;
  |FINSI;

|| ... Bisiesto
  DiasFebrero = 28;
  nCalc = #dscam207#1 $ 4;
  |SI nCalc = 0;
      nCalc = #dscam207#1 $ 100;
      |SI nCalc = 0;
          nCalc = #dscam207#1 $ 400;
          |SI nCalc = 0;   DiasFebrero = 29;  |FINSI;
      |SINO;
          DiasFebrero = 29;
      |FINSI;
  |FINSI;
||...........................

|| ...  MiraDiaUno;
    aAlfa1 = #dscam207#1;
    aAlfa1 = "01.01." + aAlfa1;
    fFech1 = aAlfa1;            || primero saca el dia de la semana
    fFech2 = fFech1 % 1;        || que fue el uno de enero
    aAlfa1 = fFech2 % 1199;

    |SI aAlfa1 = "Lunes";     sdia=1; |FINSI;
    |SI aAlfa1 = "Martes";    sdia=2; |FINSI;
    |SI aAlfa1 = "Miercoles"; sdia=3; |FINSI;
    |SI aAlfa1 = "Jueves";    sdia=4; |FINSI;
    |SI aAlfa1 = "Viernes";   sdia=5; |FINSI;
    |SI aAlfa1 = "Sabado";    sdia=6; |FINSI;
    |SI aAlfa1 = "Domingo";   sdia=7; |FINSI;
||...........................

|| .................... Rellena el a¤o entero
  nCalc = sdia + 1;
  |PARA nCoMes = 1; |SI nCoMes [ 12; |HACIENDO nCoMes = nCoMes + 1;
        |HAZ LosDiasMes;

        aAlfa2 = "";
        |PARA ContDias = 1; |SI ContDias [ 31; |HACIENDO ContDias = ContDias + 1;
              |SI ContDias [ NumDias;
                  aAlfa2 = aAlfa2 + #dscam207#nCalc#;
                  nCalc = nCalc + 1; |SI nCalc > 8; nCalc = nCalc - 7; |FINSI;
             |SINO;
                 aAlfa2 = aAlfa2 + "0";
            |FINSI;
        |SIGUE;
        #dscam208#nCoMes# = aAlfa2;
  |SIGUE;


|| .............. relleno fecha

   || Primero los intervalos entre fechas .......

   |PARA Cont = 9; |SI Cont [ 96; |HACIENDO Cont = Cont + 3;

      Desde = #dscam207#Cont#;  nCalc = Cont + 1;
      Hasta = #dscam207#nCalc#; nCalc = Cont + 2;
      Peso  = #dscam207#nCalc#;

      |SI Desde ! "    "; |Y Hasta ! "    ";
          aAlfa2 = Desde % 0102; DDia = aAlfa2;
          aAlfa2 = Desde % 0302; DMes = aAlfa2;
          aAlfa2 = Hasta % 0102; HDia = aAlfa2;
          aAlfa2 = Hasta % 0302; HMes = aAlfa2;

          |PARA nCoMes = DMes; |SI nCoMes [ HMes; |HACIENDO nCoMes = nCoMes + 1;

                |HAZ LosDiasMes;
                aAlfa2 = #dscam208#nCoMes#;

                |SI DMes = HMes;
                    |PARA ContDias = DDia; |SI ContDias [ HDia; |HACIENDO ContDias = ContDias + 1;
                          |HAZ CambiaValor;
                    |SIGUE;
                |SINO;
                    |SI nCoMes = DMes;
                        |PARA ContDias = DDia; |SI ContDias [ 31; |HACIENDO ContDias = ContDias + 1;
                              |SI ContDias [ NumDias;
                                  |HAZ CambiaValor;
                              |SINO;
                                  PesoAnt = Peso;
                                  Peso = 0;
                                  |HAZ CambiaValor;
                                  Peso = PesoAnt;
                              |FINSI;
                        |SIGUE;
                    |SINO;
                        |SI nCoMes = HMes;
                            |PARA ContDias = 1; |SI ContDias [ HDia; |HACIENDO ContDias = ContDias + 1;
                                  |SI ContDias [ NumDias;
                                       |HAZ CambiaValor;
                                  |SINO;
                                        PesoAnt = Peso;
                                        Peso = 0;
                                        |HAZ CambiaValor;
                                        Peso = PesoAnt;
                                  |FINSI;
                            |SIGUE;
                        |SINO;
                            |PARA ContDias = 1; |SI ContDias [ 31; |HACIENDO ContDias = ContDias + 1;
                                  |SI ContDias [ NumDias;
                                      |HAZ CambiaValor;
                                  |SINO;
                                       PesoAnt = Peso;
                                       Peso = 0;
                                       |HAZ CambiaValor;
                                       Peso = PesoAnt;
                                  |FINSI;
                            |SIGUE;
                        |FINSI;
                     |FINSI;
               |FINSI;
               #dscam208#nCoMes# = aAlfa2;
         |SIGUE;
      |FINSI;
   |SIGUE;

   |PARA Cont = 99; |SI Cont [ 157; |HACIENDO Cont = Cont + 2;

         |SI #dscam207#Cont# = "    "; |SAL; |FINSI;

         aAlfa1 = #dscam207#Cont# % 102; DDia = aAlfa1;
         aAlfa1 = #dscam207#Cont# % 302; DMes = aAlfa1;
         nCalc  = Cont + 1;
         Peso   = #dscam207#nCalc#;

         aAlfa2    = #dscam208#DMes#;
         ContDias = DDia;
         |HAZ CambiaValor;
         #dscam208#DMes# = aAlfa2;
   |SIGUE;
|| ...........................................

  |PINTA 2330, "                   ";

  |GRABA 020#dscam208.a;
  |LIBERA #dscam208;
  |CIERRA #dscam208;

|FPRC;

|PROCESO CambiaValor;
   nCalc = 100 + (ContDias - 1);
   aAlfa21 = aAlfa2 % nCalc;
   aAlfa21 = aAlfa21 + Peso;
   nCalc = ((ContDias + 1) * 100) + 31;
   aAlfa21 = aAlfa21 + (aAlfa2 % nCalc);
   aAlfa2 = aAlfa21;
|FPRC;

|PROCESO LosDiasMes;
             |SI nCoMes = 1;  NumDias = DiasEnero;      |FINSI;
             |SI nCoMes = 2;  NumDias = DiasFebrero;    |FINSI;
             |SI nCoMes = 3;  NumDias = DiasMarzo;      |FINSI;
             |SI nCoMes = 4;  NumDias = DiasAbril;      |FINSI;
             |SI nCoMes = 5;  NumDias = DiasMayo;       |FINSI;
             |SI nCoMes = 6;  NumDias = DiasJunio;      |FINSI;
             |SI nCoMes = 7;  NumDias = DiasJulio;      |FINSI;
             |SI nCoMes = 8;  NumDias = DiasAgosto;     |FINSI;
             |SI nCoMes = 9;  NumDias = DiasSeptiembre; |FINSI;
             |SI nCoMes = 10; NumDias = DiasOctubre;    |FINSI;
             |SI nCoMes = 11; NumDias = DiasNoviembre;  |FINSI;
             |SI nCoMes = 12; NumDias = DiasDiciembre;  |FINSI;
|FPRC;


|PROCESO calanyo;  |TIPO 7;
  fFecha = ~;
  trab1 = fFecha % 704;
  nume1 = trab1;
  #dscam207#1 = nume1; |PINTA #dscam207#1;
|FPRC;

|PROCESO anyo;
  year = #dscam207#1; |HAZ Bisiesto;
|FPRC;

|PROCESO  fechbien;  |TIPO 0;        ||Calcula si la fecha es correcta
  varalfa = #0Campo;
  |SI varalfa = "    ";  |ACABA;  |FINSI;
  |SI varalfa = "2902";|Y swbis = 1;
      |MENAV errorfec3;
      |ERROR;
      |ACABA;
  |FINSI;
  varalfa1 = varalfa / 2;
  varalfa2 = varalfa % A302;
  vardia = varalfa1;
  varmes = varalfa2;
  |SI varmes [ 0;|O varmes > 12;
       |MENAV errorfec1;
       |ERROR;
       |ACABA;
  |FINSI;
  |SI varmes = 1;  |O varmes = 3;  |O varmes = 5;  |O varmes = 7;
                   |O varmes = 8;  |O varmes = 10; |O varmes = 12;
      |SI vardia > 31; |O vardia [ 0;
          |MENAV errorfec1;
          |ERROR;
      |FINSI;
  |SINO;
      |SI varmes = 2;
          |SI vardia > 29;  |O vardia [ 0;
              |MENAV errorfec1;
              |ERROR;
          |FINSI;
      |SINO;
          |SI vardia > 30; |O vardia [ 0;
              |MENAV errorfec1;
              |ERROR;
          |FINSI;
      |FINSI;
  |FINSI;
|FPRC;

                    ||Calcula si la fecha desde es mayor a la fecha desde
|PROCESO desdefec;|TIPO 0;
  camp = Campo - 1;
  fechadesde = #0camp;
  fechadesde1 = fechadesde % A302;
  fechadesde2 = fechadesde % A102;
  fechadesde = fechadesde1 + fechadesde2;
  fechahasta = #0Campo;
  fechahasta1 = fechahasta % A302;
  fechahasta2 = fechahasta % A102;
  fechahasta = fechahasta1 + fechahasta2
  |SI fechadesde > fechahasta;
      |MENAV errorfec2;
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO peso;|TIPO 3;

  ModoEntrada = (FEntrada / 100) ! 0;
  |SI ModoEntrada ! 1;  |Y ModoEntrada ! 2;
      |ACABA;
  |FINSI;
  enCalen  = #0#0;

  |HAZ CreaCalend;
|FPRC;

|PROCESO Bisiesto;
   Calc = year $ 4;

   |SI Calc = 0;
      Calc = year $ 100;
      |SI Calc = 0;
         swbis = 0;
         Calc = year $ 400;
         |SI Calc = 0;
            swbis = 1;
         |FINSI;
      |SINO;
         swbis = 1;
      |FINSI;
   |SINO;
      swbis = 0
   |FINSI;
|FPRC;
