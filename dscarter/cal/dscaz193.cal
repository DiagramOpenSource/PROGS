
|| Parece que hay alg£n tipo de problema con algunos bancos, ya que hay
||   clientes a los que se les devuelve el diskette. Todo viene por el n§ de
||   registros del total ordenante.

|FICHEROS;
   dscaz193 #0;
   dscam015 #1;

   dscam012 #2;
   dscam013 #3;
   dscam003 #4;
   dscam014 #5;
   dscam051 #6;
   dscam030 #7;
   dscam004 #8;
   dscaw013 #9;
   dscaw038 #10;
   dscam002 #11;
   dscam044 #12;
   dscam093 #13,MANTE;
   dscam161 #14,MANTE;

   agif069@ #52;
   agif084@ #53;
   agif071@ #54;
   agif010@ #55;
   agif059@ #56;
   agif134@ #57;
   dsm0053@ #58;

   &agif024@ #50;
   &caclipr@ #51;
   &agif321@ #100;
|FIN;

|VARIABLES;
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = "";
   &HayGestion = 0; &HayConta = 0; &nDeci_Base = 0; &nDeci_Div = 0;
   &Fichero   = ""; &Cmp = "";      &Tipo = "";     &CmpNum = 0;
   &Niv1 = 0; &Niv2 = 0; &Niv3 = 0; &Niv4 = 0;  &Niv5 = 0; &Niv6 = 0;
   &eaCodigo    = "";
   &eaTipoCod   = "";
   &aCuenta     = "";
   &eaNif       = "";
   &eaNombre    = "";
   &eaDireccion = "";
   &eaPoblacion = "";
   &eaProvincia = "";
   &eaCP        = "";
   &eaCP1       = "";
   &eaCP2       = "";
   &eaTelefono  = "";
   &eaNombre1   = "";
   &eaPais      = "";
   &eaCodBIC    = "";
   &eaCodIBAN   = "";

   nBase  = 0;
   nIVA   = 0;
   nTotal = 0;
   nPos1  = 0;
   nPos2  = 0;
   nModo  = 0;
   nBoton = 0;

   aConcepto = ""; nLinea = 0;
   fFecha = @;
   nCalc = 0;        nCalc1 = 0;
   nNumConcepto = 0; aAlfa = ""; aAlfa1 = "";
   aParte1 = ""; aParte2 = ""; aParte3 = "";
   EmpreAnt = 0; PerioAnt = 0;
   aFinLin = ""; aFinFic = "";
   VAlfa   = ""; CIF = "";
   VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = ""; VAlfa06 = "";
   VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = ""; VAlfa11 = ""; VAlfa12 = "";
   VAlfa13 = ""; VAlfa14 = ""; VAlfa15 = ""; VAlfa16 = ""; VAlfa17 = ""; VAlfa18 = "";
   VAlfa19 = ""; VAlfa20 = ""; VAlfa21 = ""; VAlfa22 = "";

   Field = ""; aTipo = ""; Fecha = ""; Comodin = ""; Comodin1 = "";
   NumDig = 0; Calc = 0;  Handle = 0; LinCob  = 0; Tipo1 = "";

   nSw = 0;

   aConcepto1 = ""; aConcepto2 = ""; aConcepto3 = "";
   aConcepto4 = ""; aConcepto5 = ""; aConcepto6 = "";

   NumOrd = 0; TotalOrd = 0;
   NumOrdDet = 0;
   NumInd = 0; NumIndDet = 0; TotalInd = 0;
   nTotal003Ord = 0;
   nTotal003    = 0;
   nTotalRegs   = 0;
   nNumero = 0;
   NumRegs = 0;
   NumDomics = 0;
   SwHayNoEmit = 0;
   aLong = ""; nLong = 0;
   SwEmit = "";

   handle = 0;
   SwHay  = 0;

   Cambio = 1;
   Redond = 0;
   Moneda = "P";
   Prefijo = "";

   &eaOrigen = "";
   &Divisa   = "";
   &enEmpCartera = 0; &enEmpGestion = 0; &enBanco = 0;
   &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = "";

   aPais   = "";
   aSufijo = "";
   aDC     = "";
   aNif    = "";
   aIdent  = "";
   aCadena = "";
   aChar1  = "";
   aChar2  = "";
|FIN;

|PROCESO IniVars;
   VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = ""; VAlfa06 = "";
   VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = ""; VAlfa11 = ""; VAlfa12 = "";
   VAlfa13 = ""; VAlfa14 = ""; VAlfa15 = ""; VAlfa16 = ""; VAlfa17 = ""; VAlfa18 = "";
   VAlfa19 = ""; VAlfa20 = ""; VAlfa21 = ""; VAlfa22 = "";
   Field = ""; aTipo = ""; Fecha = ""; Comodin = "";
   NumDig = 0; Calc = 0;
   aLong = ""; nLong = 0;
|FPRC;

|PROCESO ReemplazaStr;
   aAlfa = aCadena - aChar1;
   |PARA; |SI FSalida ! 0; |HACIENDO;
      nCalc = FSalida + 98; aParte2 = aAlfa % nCalc;
      aParte1 = aAlfa - aParte2;
      aCadena = aParte1 + aChar2 + aParte2;

      aAlfa = aCadena - aChar1;
   |SIGUE;
|FPRC;

|PROCESO ObtenId;
   aPais = "ES";

   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aNif = aNif - "/"; |SIGUE;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aNif = aNif - "-"; |SIGUE;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aNif = aNif - "?"; |SIGUE;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aNif = aNif - ":"; |SIGUE;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aNif = aNif - "("; |SIGUE;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aNif = aNif - ")"; |SIGUE;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aNif = aNif - "."; |SIGUE;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aNif = aNif - ","; |SIGUE;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aNif = aNif - "'"; |SIGUE;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aNif = aNif - "+"; |SIGUE;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aNif = aNif - &34; |SIGUE;

   aCadena = aNif;
   aChar1 = "A"; aChar2 = "10"; |HAZ ReemplazaStr;
   aChar1 = "B"; aChar2 = "11"; |HAZ ReemplazaStr;
   aChar1 = "C"; aChar2 = "12"; |HAZ ReemplazaStr;
   aChar1 = "D"; aChar2 = "13"; |HAZ ReemplazaStr;
   aChar1 = "E"; aChar2 = "14"; |HAZ ReemplazaStr;
   aChar1 = "F"; aChar2 = "15"; |HAZ ReemplazaStr;
   aChar1 = "G"; aChar2 = "16"; |HAZ ReemplazaStr;
   aChar1 = "H"; aChar2 = "17"; |HAZ ReemplazaStr;
   aChar1 = "I"; aChar2 = "18"; |HAZ ReemplazaStr;
   aChar1 = "J"; aChar2 = "19"; |HAZ ReemplazaStr;
   aChar1 = "K"; aChar2 = "20"; |HAZ ReemplazaStr;
   aChar1 = "L"; aChar2 = "21"; |HAZ ReemplazaStr;
   aChar1 = "M"; aChar2 = "22"; |HAZ ReemplazaStr;
   aChar1 = "N"; aChar2 = "23"; |HAZ ReemplazaStr;
   aChar1 = "O"; aChar2 = "24"; |HAZ ReemplazaStr;
   aChar1 = "P"; aChar2 = "25"; |HAZ ReemplazaStr;
   aChar1 = "Q"; aChar2 = "26"; |HAZ ReemplazaStr;
   aChar1 = "R"; aChar2 = "27"; |HAZ ReemplazaStr;
   aChar1 = "S"; aChar2 = "28"; |HAZ ReemplazaStr;
   aChar1 = "T"; aChar2 = "29"; |HAZ ReemplazaStr;
   aChar1 = "U"; aChar2 = "30"; |HAZ ReemplazaStr;
   aChar1 = "V"; aChar2 = "31"; |HAZ ReemplazaStr;
   aChar1 = "W"; aChar2 = "32"; |HAZ ReemplazaStr;
   aChar1 = "X"; aChar2 = "33"; |HAZ ReemplazaStr;
   aChar1 = "Y"; aChar2 = "34"; |HAZ ReemplazaStr;
   aChar1 = "Z"; aChar2 = "35"; |HAZ ReemplazaStr;
   aNif = aCadena;

   aAlfa  = "142800" + aNif;                          || Cadena 'ES00'
   nCalc  = aAlfa;
   nCalc1 = nCalc / 97;
   aAlfa = nCalc1; |QBF aAlfa;
   aAlfa = aAlfa - ".";
   nCalc1 = ((FSalida / 100) ! 0) + 99; aAlfa = aAlfa % nCalc1; nCalc1 = aAlfa;
   nCalc1 = nCalc1 ! 0;
   nCalc1 = nCalc1 * 97;
   nCalc  = nCalc - nCalc1;
   nCalc1 = 98 - nCalc;
   aDC = ("00" + nCalc) % -102;
   aIdent = aPais + aDC + aSufijo + aNif;

|| nCalc  = 98 - (nCalc - (((nCalc / 97) ! 0) * 97)); || MOD 97-10  ISO 7604
|FPRC;

|PROCESO Presentador;
   |HAZ IniVars;

   VAlfa01 = "0119445001";
   aSufijo = #dscam014#78; aNif = #dscam014#47; |HAZ ObtenId;
   Field = aIdent;       aTipo = "A"; NumDig = 35; |HAZ Formato ; VAlfa02 = Field;
   Field = #dscam014#46; aTipo = "A"; NumDig = 70; |HAZ Formato ; VAlfa03 = Field;
   Fecha = #dscaz193#6;  |HAZ RetocaFecha; VAlfa04 = Fecha;
   fFecha = ~; aAlfa = fFecha; |HORA aAlfa1;
   aAlfa  = (aAlfa % 0704)  + (aAlfa % 0402)  + (aAlfa % 0102);
   aAlfa1 = (aAlfa1 % 0102) + (aAlfa1 % 0402) + (aAlfa1 % 0702) + "00000";
   VAlfa05 = "PRE" + aAlfa + aAlfa1;
   Field = VAlfa05;      aTipo = "A"; NumDig = 35; |HAZ Formato ; VAlfa05 = Field;
   Field = #dscam014#48; aTipo = "N"; NumDig = 4;  |HAZ Formato ; VAlfa06 = Field;
   Field = #dscam014#49; aTipo = "N"; NumDig = 4;  |HAZ Formato ; VAlfa07 = Field;
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = Handle + " " + VAlfa; |FGRABA VAlfa;

   VAlfa08 = (" " * 200);
   VAlfa = Handle + " " + VAlfa08; |FGRABA VAlfa;
   VAlfa09 = (" " * 234);
   VAlfa = Handle + " " + VAlfa09 + aFinLin; |FGRABA VAlfa;

   nTotalRegs   = nTotalRegs   + 1;
   TotalOrd = 0;
   NumOrd = 0; NumOrdDet = 0;
   nNumero = 0;
|FPRC;

|PROCESO Ordenante;
   |HAZ IniVars;

   VAlfa01 = "0219445002";
   aSufijo = #dscam014#80; aNif = #dscam014#47; |HAZ ObtenId;
   Field = aIdent;       aTipo = "A"; NumDig = 35; |HAZ Formato ; VAlfa02 = Field;
   Fecha = #dscaz193#7;  |HAZ RetocaFecha; VAlfa03 = Fecha;
   Field = #dscam014#52; aTipo = "A"; NumDig = 70; |HAZ Formato ; VAlfa04  = Field;

   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04;
   VAlfa = Handle + " " + VAlfa; |FGRABA VAlfa;

   Field = #dscam014#74;  aTipo = "A"; NumDig = 50; |HAZ Formato ; VAlfa05 = Field;
   Field = #dscam014#54;  aTipo = "A"; NumDig = 50; |HAZ Formato ; VAlfa06 = Field;
   Field = #dscam014#75;  aTipo = "A"; NumDig = 40; |HAZ Formato ; VAlfa07 = Field;
   VAlfa08 = "ES";
   VAlfa09 = #dscam014#42;

   VAlfa = VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa   + VAlfa08 + VAlfa09;
   VAlfa = Handle + " " + VAlfa; |FGRABA VAlfa;

   VAlfa10 = " " * 200;
   VAlfa = Handle + " " + VAlfa10; |FGRABA VAlfa;
   VAlfa11 = " " * 101;
   VAlfa = Handle + " " + VAlfa11 + aFinLin; |FGRABA VAlfa;

   TotalInd = 0;
   NumInd = 0; NumIndDet = 0;
   nTotal003Ord = 0;
   nNumero = nNumero + 1;
   nTotalRegs   = nTotalRegs   + 1;
|FPRC;

|PROCESO Conceptos;
/*  El formato de los conceptos de detalle sera el siguiente :

    PARA CLIPRESAL :

       "Factura XXXXX/XXXXXX   Recibo XXX       " " F.Cargo XXXXXXXXXX   F.Vto. XXXXXXXXXX "
       "Conceptos                               " "             Importe Rec... XXXXXXXX.XX "
       "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" "XXXXXXXXXX   Base imponible XXXXXXXX.XX "
       "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" "XXXXXXXXXX   Cuota iva .... XXXXXXXX.XX "
       "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" "XXXXXXXXXX   TOTAL FACTURA  XXXXXXXX.XX "
       "Cliente XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  " "(XXXXXX)     CIF XXXXXXXXXXXX           "
       "Banco   XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  " " XXXXXXXXXXXX   XXXX XXXX XX XXXXXXXXXX "
       "        XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  " " XXXXX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX "

    Para el resto de clientes :

       "Factura XXXXX/XXXXXX   Recibo XXX       " " F.Cargo XXXXXXXXXX   F.Vto. XXXXXXXXXX "
       "Conceptos                               " "             Importe Rec... XXXXXXXX.XX "
       "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" "XXXXXXXXXX   Base imponible XXXXXXXX.XX "
       "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" "XXXXXXXXXX   Cuota iva .... XXXXXXXX.XX "
       "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" "XXXXXXXXXX                              "
       "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" "XXXXXXXXXX   TOTAL FACTURA  XXXXXXXX.XX "
       "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" "XXXXXXXXXX                              "
       "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" "XXXXXXXXXX                              "

*/

   aParte1 = ""; aParte2 = ""; aParte3 = "";
   nSw = 0;
   |HAZ EsClipresal;
   |SI FSalida = 0;
      nSw = 1;
      || *********** CONCEPTO 1 ************
      |SI nNumConcepto = 1;
         aAlfa = #dscam003#30; |QBF aAlfa;
         aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = #dscam003#30; aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = #dscam003#30; aAlfa = aAlfa + "0";
            |FINSI;
         |SINO;
            aAlfa = #dscam003#30;
         |FINSI;
         aParte1 = " F.Cargo " + #dscaz193#7 + "   F.Vto. " + #dscam003#3;
         aParte1 = (aParte1 + (" " * 40)) % 0140;
         aParte2 = "Conceptos ";
         aParte2 = (aParte2 + (" " * 40)) % 0140;
         aParte3 = " " * 13;
         aParte3 = aParte3 + "Importe ...... " + aAlfa;
         aParte3 = (aParte3 + (" " * 40)) % 0140;
      |FINSI;
      || *********** CONCEPTO 2 ************
      |SI nNumConcepto = 2;
         aAlfa = nBase; |QBF aAlfa;
         aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = nBase; aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = nBase; aAlfa = aAlfa + "0";
            |FINSI;
         |SINO;
            aAlfa = nBase;
         |FINSI;
         aParte1 = aConcepto1 % 0140;
         aParte2 = aConcepto1 % 4110;
         aParte2 = aParte2 + "   Base imponible " + aAlfa;
         aParte2 = (aParte2 + (" " * 40)) % 0140;
         aParte3 = aConcepto2 % 0140;
      |FINSI;
      || *********** CONCEPTO 3 ************
      |SI nNumConcepto = 3;
         aAlfa = nIVA; |QBF aAlfa;
         aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = nIVA; aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = nIVA; aAlfa = aAlfa + "0";
            |FINSI;
         |SINO;
            aAlfa = nIVA;
         |FINSI;
         aParte1 = aConcepto2 % 4110;
         aParte1 = aParte1 + "   Cuota iva .... " + aAlfa;
         aParte1 = (aParte1 + (" " * 40)) % 0140;
         aParte2 = aConcepto3 % 0140;
         aAlfa = nTotal; |QBF aAlfa;
         aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = nTotal; aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = nTotal; aAlfa = aAlfa + "0";
            |FINSI;
         |SINO;
            aAlfa = nTotal;
         |FINSI;
         aParte3 = aConcepto3 % 4110;
         aParte3 = aParte3 + "   TOTAL FACTURA  " + aAlfa;
         aParte3 = (aParte3 + (" " * 40)) % 0140;
      |FINSI;
      || *********** CONCEPTO 4 ************
      |SI nNumConcepto = 4;
         aParte1 = "Cliente " + ((#dscam003#6 + (" " * 32)) % 0132) + "  ";
         aParte2 = "(" + #dscam003#32 + ")     CIF " + CIF;
         aParte2 = (aParte2 + (" " * 40)) % 0140;
         aParte3 = "Domic.  " + #dscam003#7;
         aParte3 = (aParte3 + (" " * 40)) % 0140;
      |FINSI;
      || *********** CONCEPTO 5 ************
      |SI nNumConcepto = 5;
         |ABRE #dscam002;
         #dscam002#0 = #dscam003#8;
         #dscam002#1 = #dscam003#9;
         |LEE 000#dscam002.=;
         |SI FSalida ! 0; |DDEFECTO #dscam002; |FINSI;
         |CIERRA #dscam002;

         aParte1 = "             CIF " + #dscam002#3;
         aParte1 = (aParte1 + (" " * 40)) % 0140;
         aParte2 = " Cuenta nro. " + (("0000" + #dscam003#8)  % -104);
         aParte2 = aParte2 + " " + (("0000" + #dscam003#9)  % -104);
         aParte2 = aParte2 + " " + (("00"   + #dscam003#10) % -102);
         aParte2 = aParte2 + " " + ((("0" * 10) + #dscam003#11) % -110);
         aParte2 = (aParte2 + (" " * 40)) % 0140;
         aParte3 = " " * 40;
      |FINSI;
   |FINSI;

   |HAZ EsOTP;
   |SI FSalida = 0;
      nSw    = 1;
      || *********** CONCEPTO 1 ************
      |SI nNumConcepto = 1;
         aAlfa = #dscam003#30; |QBF aAlfa;
         aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = #dscam003#30; aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = #dscam003#30; aAlfa = aAlfa + "0";
            |FINSI;
         |SINO;
            aAlfa = #dscam003#30;
         |FINSI;
         aParte1 = " F.Cargo " + #dscaz193#7 + "   F.Vto. " + #dscam003#3;
         aParte1 = (aParte1 + (" " * 40)) % 0140;
         aParte2 = "Conceptos ";
         aParte2 = (aParte2 + (" " * 40)) % 0140;
         aParte3 = " " * 13;
         aParte3 = aParte3 + "Importe ...... " + aAlfa;
         aParte3 = (aParte3 + (" " * 40)) % 0140;
      |FINSI;
      || *********** CONCEPTO 2 ************
      |SI nNumConcepto = 2;
         aAlfa = nBase; |QBF aAlfa;
         aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = nBase; aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = nBase; aAlfa = aAlfa + "0";
            |FINSI;
         |SINO;
            aAlfa = nBase;
         |FINSI;
         aParte1 = aConcepto1 % 0140;
         aParte2 = aConcepto1 % 4110;
         aParte2 = aParte2 + "   Bases imponibles " + aAlfa;
         aParte2 = (aParte2 + (" " * 40)) % 0140;
         aParte3 = aConcepto2 % 0140;
      |FINSI;
      || *********** CONCEPTO 3 ************
      |SI nNumConcepto = 3;
         aAlfa = nIVA; |QBF aAlfa;
         aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = nIVA; aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = nIVA; aAlfa = aAlfa + "0";
            |FINSI;
         |SINO;
            aAlfa = nIVA;
         |FINSI;
         aParte1 = aConcepto2 % 4110;
         aParte1 = aParte1 + "   Cuotas iva ..... " + aAlfa;
         aParte1 = (aParte1 + (" " * 40)) % 0140;
         aParte2 = aConcepto3 % 0140;
         aAlfa = nTotal; |QBF aAlfa;
         aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = nTotal; aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = nTotal; aAlfa = aAlfa + "0";
            |FINSI;
         |SINO;
            aAlfa = nTotal;
         |FINSI;
         aParte3 = aConcepto3 % 4110;
         aParte3 = aParte3 + "   TOTAL FACTURA .. " + aAlfa;
         aParte3 = (aParte3 + (" " * 40)) % 0140;
      |FINSI;
      || *********** CONCEPTO 4 ************
      |SI nNumConcepto = 4;
         aParte1 = "Cliente " + ((#dscam003#6 + (" " * 32)) % 0132) + "  ";
         aParte2 = "(" + #dscam003#32 + ")     CIF " + CIF;
         aParte2 = (aParte2 + (" " * 40)) % 0140;
         aParte3 = "Domic.  " + #dscam003#7;
         aParte3 = (aParte3 + (" " * 40)) % 0140;
      |FINSI;
      || *********** CONCEPTO 5 ************
      |SI nNumConcepto = 5;
         |ABRE #dscam002;
         #dscam002#0 = #dscam003#8;
         #dscam002#1 = #dscam003#9;
         |LEE 000#dscam002.=;
         |SI FSalida ! 0; |DDEFECTO #dscam002; |FINSI;
         |CIERRA #dscam002;

         aParte1 = "             CIF " + #dscam002#3;
         aParte1 = (aParte1 + (" " * 40)) % 0140;
         aParte2 = " Cuenta nro. " + (("0000" + #dscam003#8)  % -104);
         aParte2 = aParte2 + " " + (("0000" + #dscam003#9)  % -104);
         aParte2 = aParte2 + " " + (("00"   + #dscam003#10) % -102);
         aParte2 = aParte2 + " " + ((("0" * 10) + #dscam003#11) % -110);
         aParte2 = (aParte2 + (" " * 40)) % 0140;
         aParte3 = " " * 40;
      |FINSI;
   |FINSI;

   |SI nSw = 0;
      || *********** CONCEPTO 1 ************
      |SI nNumConcepto = 1;
         aAlfa = #dscam003#30; |QBF aAlfa;
         aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = #dscam003#30; aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = #dscam003#30; aAlfa = aAlfa + "0";
            |FINSI;
         |SINO;
            aAlfa = #dscam003#30;
         |FINSI;
         aParte1 = " F.Cargo " + #dscaz193#7 + "   F.Vto. " + #dscam003#3;
         aParte2 = "Conceptos ";
         aParte2 = (aParte2 + (" " * 40)) % 0140;
         aParte3 = " " * 13;
         aParte3 = aParte3 + "Importe ...... " + aAlfa;
         aParte3 = (aParte3 + (" " * 40)) % 0140;
      |FINSI;
      || *********** CONCEPTO 2 ************
      |SI nNumConcepto = 2;
         aAlfa = nBase; |QBF aAlfa;
         aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = nBase; aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = nBase; aAlfa = aAlfa + "0";
            |FINSI;
         |SINO;
            aAlfa = nBase;
         |FINSI;
         aParte1 = aConcepto1 % 0140;
         aParte2 = aConcepto1 % 4110;
         aParte2 = aParte2 + "   Base imponible " + aAlfa;
         aParte2 = (aParte2 + (" " * 40)) % 0140;
         aParte3 = aConcepto2 % 0140;
      |FINSI;
      || *********** CONCEPTO 3 ************
      |SI nNumConcepto = 3;
         aAlfa = nIVA; |QBF aAlfa;
         aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = nIVA; aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = nIVA; aAlfa = aAlfa + "0";
            |FINSI;
         |SINO;
            aAlfa = nIVA;
         |FINSI;
         aParte1 = aConcepto2 % 4110;
         aParte1 = aParte1 + "   Cuota iva .... " + aAlfa;
         aParte1 = (aParte1 + (" " * 40)) % 0140;
         aParte2 = aConcepto3 % 0140;
         aParte3 = aConcepto3 % 4110;
         aParte3 = (aParte3 + (" " * 40)) % 0140;
      |FINSI;
      || *********** CONCEPTO 4 ************
      |SI nNumConcepto = 4;
         aAlfa = nTotal; |QBF aAlfa;
         aAlfa1 = aAlfa % -301;
         |SI aAlfa1 ! ".";
            aAlfa1 = aAlfa % -201;
            |SI aAlfa1 ! ".";
               aAlfa = nTotal; aAlfa = aAlfa + ".00";
            |SINO;
               aAlfa = nTotal; aAlfa = aAlfa + "0";
            |FINSI;
         |SINO;
            aAlfa = nTotal;
         |FINSI;
         aParte1 = aConcepto4 % 0140;
         aParte2 = aConcepto4 % 4110;
         aParte2 = aParte2 + "   TOTAL FACTURA  " + aAlfa;
         aParte3 = aConcepto5 % 0140;
      |FINSI;

      || *********** CONCEPTO 5 ************
      |SI nNumConcepto = 5;
         aParte1 = aConcepto5 % 4110;
         aParte1 = (aParte1 + (" " * 40)) % 0140;
         aParte2 = aConcepto6 % 0140;
         aParte3 = aConcepto6 % 4110;
         aParte3 = (aParte3 + (" " * 40)) % 0140;
      |FINSI;
   |FINSI;

   VAlfa01 = Prefijo + "68" + nNumConcepto;
   Field = #dscam014#47; aTipo = "A"; NumDig = 9; |HAZ Formato ; VAlfa02  = Field;
   Field = #dscaz193#17; aTipo = "N"; NumDig = 3; |HAZ Formato ; VAlfa03  = Field;
   Field = #dscam161#5;  aTipo = "A"; NumDig = 12; |HAZ Formato; VAlfa04  = Field;

   Field = aParte1;  aTipo = "A"; NumDig = 40; |HAZ Formato ; VAlfa05  = Field;
   Field = aParte2;  aTipo = "A"; NumDig = 40; |HAZ Formato ; VAlfa06  = Field;
   Field = aParte3;  aTipo = "A"; NumDig = 40; |HAZ Formato ; VAlfa07  = Field;
   VAlfa08 = (" " * 14);

   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05;
   VAlfa = VAlfa   + VAlfa06 + VAlfa07 + VAlfa08 + aFinLin;
   VAlfa = Handle + " " + VAlfa; |FGRABA VAlfa;
|FPRC;

|PROCESO TomaDatos;
   || Si el recibo no viene de una agrupacion y no forma parte de una division .....
   ||   .... tomamos la empresa de gestion y la buscamos en el dscam044, y .........
   ||   .... cogemos el path.
   |DFICB aAlfa; |PATH_DAT #12 aAlfa;
   aAlfa = "";
   |ABRE #dscam044;
   #dscam044#0 = #dscam003#46;
   |LEE 000#dscam044.=;
   |SI FSalida = 0;
      aAlfa = #dscam044#1; |QBF aAlfa;
   |FINSI;
   |CIERRA #dscam044;

   aConcepto1 = ""; aConcepto2 = ""; aConcepto3 = "";
   aConcepto4 = ""; aConcepto5 = ""; aConcepto6 = "";
   nLinea = 1; nBase = 0; nIVA = 0; nTotal = 0;

   aAlfa1 = aAlfa + "def/agifa069.mas";
   |CARGA_DEF aAlfa1, agif069@;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "def/agifa084.mas";
      |CARGA_DEF aAlfa1, agif084@;

      aAlfa1 = aAlfa + "def/agifa071.mas";
      |CARGA_DEF aAlfa1, agif071@;

      aAlfa1 = aAlfa + "def/agifa010.mas";
      |CARGA_DEF aAlfa1, agif010@;

      aAlfa1 = aAlfa + "def/agifa059.mas";
      |CARGA_DEF aAlfa1, agif059@;

      aAlfa1 = aAlfa + "def/agifa134.mas";
      |CARGA_DEF aAlfa1, agif134@;

      aAlfa1 = aAlfa + "def/dsm00053.mas";
      |CARGA_DEF aAlfa1, dsm0053@;

      aAlfa1 = #dscam003#46; aAlfa1 = ("00000" + aAlfa1) % -105;
      aAlfa1 = aAlfa + "fich/" + aAlfa1 + "/";
      |PATH_DAT #52 aAlfa1; |PATH_DAT #53 aAlfa1;
      |PATH_DAT #54 aAlfa1; |PATH_DAT #55 aAlfa1;
      |PATH_DAT #56 aAlfa1; |PATH_DAT #57 aAlfa1;
      |PATH_DAT #58 aAlfa1;

      |ABRE #agif069@; |ABRE #agif084@;
      |ABRE #agif071@; |ABRE #agif010@;
      |ABRE #agif059@; |ABRE #agif134@; |ABRE #dsm0053@;
      |HAZ CargaNDeci;
/*
      nLinea = 1;
      |HAZ EsClipresal;
      |SI FSalida = 0;
         #agif069@#20 = #dscam003#0;
         #agif069@#0  = #dscam003#1;
         #agif069@#1  = 0;
         |LEE 000#agif069@.];
         |PARA; |SI FSalida = 0; |Y #agif069@#20 = #dscam003#0;
          |Y #agif069@#0 = #dscam003#1; |Y nLinea [ 3; |HACIENDO;
            |SI nLinea = 1; aConcepto1 = #agif069@#4; |FINSI;
            |SI nLinea = 2; aConcepto2 = #agif069@#4; |FINSI;
            |SI nLinea = 3; aConcepto3 = #agif069@#4; |FINSI;
            nLinea = nLinea + 1; |LEE 000#agif069@.s;
         |SIGUE;
         #agif084@#48 = #dscam003#0;
         #agif084@#0  = #dscam003#1;
         |LEE 000#agif084@.=;
         |SI FSalida = 0;
            nBase = #agif084@#72; nIVA = #agif084@#24; nTotal = #agif084@#73;
         |SINO;
            nBase = 0; nIVA = 0; nTotal = 0;
         |FINSI;
      |SINO;
         aConcepto1 = ""; aConcepto2 = ""; aConcepto3 = "";
         aConcepto4 = ""; aConcepto5 = ""; aConcepto6 = "";
         #agif134@#49 = #dscam003#0;
         #agif134@#0  = #dscam003#1;
         |LEE 000#agif134@.=;
         |SI FSalida = 0;
            #agif059@#14 = #agif134@#49;
            #agif059@#0  = #agif134@#0;
            #agif059@#1  = 1;
            |LEE 000#agif059@.];
            |PARA; |SI FSalida = 0; |Y #agif059@#14 = #agif134@#49; |Y #agif059@#0 = #agif134@#0; |HACIENDO;
               #agif010@#52 = #agif059@#14;
               #agif010@#0  = #agif059@#2;
               |LEE 000#agif010@.];
               |PARA; |SI FSalida = 0; |Y #agif010@#52 = #agif059@#14; |Y #agif010@#0 = #agif059@#2; |HACIENDO;
                  #agif071@#29 = #agif010@#52;
                  #agif071@#0  = #agif010@#0;
                  #agif071@#1  = 1;
                  |LEE 000#agif071@.];
                  |PARA; |SI FSalida = 0; |Y #agif071@#29 = #agif010@#52; |Y #agif071@#0 = #agif010@#0; |Y nLinea [ 6; |HACIENDO;
                     |SI nLinea = 1; aConcepto1 = #agif071@#4; |FINSI;
                     |SI nLinea = 2; aConcepto2 = #agif071@#4; |FINSI;
                     |SI nLinea = 3; aConcepto3 = #agif071@#4; |FINSI;
                     |SI nLinea = 4; aConcepto4 = #agif071@#4; |FINSI;
                     |SI nLinea = 5; aConcepto5 = #agif071@#4; |FINSI;
                     |SI nLinea = 6; aConcepto6 = #agif071@#4; |FINSI;
                     nLinea = nLinea + 1; |LEE 000#agif071@.s;
                  |SIGUE;
                  |LEE 000#agif010@.s;
               |SIGUE;
               |LEE 000#agif059@.s;
            |SIGUE;
            nBase = #agif134@#88; nIVA = #agif134@#99; nTotal = #agif134@#101;
         |SINO;
            #agif069@#20 = #dscam003#0;
            #agif069@#0  = #dscam003#1;
            #agif069@#1  = 0;
            |LEE 000#agif069@.];
            |PARA; |SI FSalida = 0; |Y #agif069@#20 = #dscam003#0;
             |Y #agif069@#0 = #dscam003#1; |Y nLinea [ 6; |HACIENDO;
               |SI nLinea = 1; aConcepto1 = #agif069@#4; |FINSI;
               |SI nLinea = 2; aConcepto2 = #agif069@#4; |FINSI;
               |SI nLinea = 3; aConcepto3 = #agif069@#4; |FINSI;
               |SI nLinea = 4; aConcepto4 = #agif069@#4; |FINSI;
               |SI nLinea = 5; aConcepto5 = #agif069@#4; |FINSI;
               |SI nLinea = 6; aConcepto6 = #agif069@#4; |FINSI;
               nLinea = nLinea + 1; |LEE 000#agif069@.s;
            |SIGUE;
            #agif084@#48 = #dscam003#0;
            #agif084@#0  = #dscam003#1;
            |LEE 000#agif084@.=;
            |SI FSalida = 0;
               nBase = #agif084@#72; nIVA = #agif084@#24; nTotal = #agif084@#73;
            |SINO;
               nBase = 0; nIVA = 0; nTotal = 0;
            |FINSI;
         |FINSI;
      |FINSI;
*/
      nLinea = 1;
      |HAZ EsClipresal;
      |SI FSalida = 0;
         #agif069@#20 = #dscam003#0;
         #agif069@#0  = #dscam003#1;
         #agif069@#1  = 0;
         |LEE 000#agif069@.];
         |SI FSalida = 0; |Y #agif069@#20 = #dscam003#0;
          |Y #agif069@#0 = #dscam003#1; |Y nLinea [ 3;
            aConcepto1 = #agif069@#4; nLinea = nLinea + 1;
         |FINSI;

         #dsm0053@#0 = "F";
         #dsm0053@#1 = #dscam003#0;
         #dsm0053@#2 = #dscam003#1;
         #dsm0053@#3 = 0;
         #dsm0053@#4 = 0;
         |LEE 000#dsm0053@.];
         |SI FSalida = 0; |Y #dsm0053@#0 = "F"; |Y #dsm0053@#1 = #dscam003#0;
          |Y #dsm0053@#2 = #dscam003#1;
            |PARA; |SI FSalida = 0; |Y #dsm0053@#0 = "F"; |Y #dsm0053@#1 = #dscam003#0;
                    |Y #dsm0053@#2 = #dscam003#1; |Y nLinea [3; |HACIENDO;
               |SI nLinea = 1; aConcepto1 = #dsm0053@#5; |FINSI;
               |SI nLinea = 2; aConcepto2 = #dsm0053@#5; |FINSI;
               |SI nLinea = 3; aConcepto3 = #dsm0053@#5; |FINSI;
               nLinea = nLinea + 1; |LEE 000#dsm0053@.s;
            |SIGUE;
         |SINO;
            #agif069@#20 = #dscam003#0;
            #agif069@#0  = #dscam003#1;
            #agif069@#1  = 0;
            |LEE 000#agif069@.];
            |PARA; |SI FSalida = 0; |Y #agif069@#20 = #dscam003#0;
             |Y #agif069@#0 = #dscam003#1; |Y nLinea [ 3; |HACIENDO;
               |SI nLinea = 1; aConcepto1 = #agif069@#4; |FINSI;
               |SI nLinea = 2; aConcepto2 = #agif069@#4; |FINSI;
               |SI nLinea = 3; aConcepto3 = #agif069@#4; |FINSI;
               nLinea = nLinea + 1; |LEE 000#agif069@.s;
            |SIGUE;
         |FINSI;
         #agif084@#48 = #dscam003#0;
         #agif084@#0  = #dscam003#1;
         |LEE 000#agif084@.=;
         |SI FSalida = 0;
            nBase = #agif084@#72; nIVA = #agif084@#24; nTotal = #agif084@#73;
         |SINO;
            nBase = 0; nIVA = 0; nTotal = 0;
         |FINSI;
      |SINO;
         aConcepto1 = ""; aConcepto2 = ""; aConcepto3 = "";
         aConcepto4 = ""; aConcepto5 = ""; aConcepto6 = "";
         #agif134@#49 = #dscam003#0;
         #agif134@#0  = #dscam003#1;
         |LEE 000#agif134@.=;
         |SI FSalida = 0;
            #agif059@#14 = #agif134@#49;
            #agif059@#0  = #agif134@#0;
            #agif059@#1  = 1;
            |LEE 000#agif059@.];
            |PARA; |SI FSalida = 0; |Y #agif059@#14 = #agif134@#49; |Y #agif059@#0 = #agif134@#0; |HACIENDO;
               #agif010@#52 = #agif059@#14;
               #agif010@#0  = #agif059@#2;
               |LEE 000#agif010@.];
               |PARA; |SI FSalida = 0; |Y #agif010@#52 = #agif059@#14; |Y #agif010@#0 = #agif059@#2; |HACIENDO;
                  #dsm0053@#0 = "A";
                  #dsm0053@#1 = #agif010@#52;
                  #dsm0053@#2 = #agif010@#0;
                  #dsm0053@#3 = 0;
                  #dsm0053@#4 = 0;
                  |LEE 000#dsm0053@.];
                  |SI FSalida = 0; |Y #dsm0053@#0 = "D"; |Y #dsm0053@#1 = #agif010@#52;
                   |Y #dsm0053@#2 = #agif010@#0;
                     |PARA; |SI FSalida = 0; |Y #dsm0053@#0 = "D"; |Y #dsm0053@#1 = #agif010@#52;
                             |Y #dsm0053@#2 = #agif010@#0; |Y nLinea [6; |HACIENDO;
                        |SI nLinea = 1; aConcepto1 = #dsm0053@#5; |FINSI;
                        |SI nLinea = 2; aConcepto2 = #dsm0053@#5; |FINSI;
                        |SI nLinea = 3; aConcepto3 = #dsm0053@#5; |FINSI;
                        |SI nLinea = 4; aConcepto4 = #dsm0053@#5; |FINSI;
                        |SI nLinea = 5; aConcepto5 = #dsm0053@#5; |FINSI;
                        |SI nLinea = 6; aConcepto6 = #dsm0053@#5; |FINSI;
                        nLinea = nLinea + 1; |LEE 000#dsm0053@.s;
                     |SIGUE;
                  |SINO;
                     #agif071@#29 = #agif010@#52;
                     #agif071@#0  = #agif010@#0;
                     #agif071@#1  = 1;
                     |LEE 000#agif071@.];
                     |PARA; |SI FSalida = 0; |Y #agif071@#29 = #agif010@#52; |Y #agif071@#0 = #agif010@#0; |Y nLinea [ 6; |HACIENDO;
                        |SI nLinea = 1; aConcepto1 = #agif071@#4; |FINSI;
                        |SI nLinea = 2; aConcepto2 = #agif071@#4; |FINSI;
                        |SI nLinea = 3; aConcepto3 = #agif071@#4; |FINSI;
                        |SI nLinea = 4; aConcepto4 = #agif071@#4; |FINSI;
                        |SI nLinea = 5; aConcepto5 = #agif071@#4; |FINSI;
                        |SI nLinea = 6; aConcepto6 = #agif071@#4; |FINSI;
                        nLinea = nLinea + 1; |LEE 000#agif071@.s;
                     |SIGUE;
                     |LEE 000#agif010@.s;
                  |FINSI;
               |SIGUE;
               |LEE 000#agif059@.s;
            |SIGUE;
            nBase = #agif134@#88; nIVA = #agif134@#99; nTotal = #agif134@#101;
         |SINO;
            #dsm0053@#0 = "D";
            #dsm0053@#1 = #dscam003#0;
            #dsm0053@#2 = #dscam003#1;
            #dsm0053@#3 = 0;
            #dsm0053@#4 = 0;
            |LEE 000#dsm0053@.];
            |SI FSalida = 0; |Y #dsm0053@#0 = "D"; |Y #dsm0053@#1 = #dscam003#0;
             |Y #dsm0053@#2 = #dscam003#1;
               |PARA; |SI FSalida = 0; |Y #dsm0053@#0 = "D"; |Y #dsm0053@#1 = #dscam003#0;
                       |Y #dsm0053@#2 = #dscam003#1; |Y nLinea [6; |HACIENDO;
                  |SI nLinea = 1; aConcepto1 = #dsm0053@#5; |FINSI;
                  |SI nLinea = 2; aConcepto2 = #dsm0053@#5; |FINSI;
                  |SI nLinea = 3; aConcepto3 = #dsm0053@#5; |FINSI;
                  |SI nLinea = 4; aConcepto4 = #dsm0053@#5; |FINSI;
                  |SI nLinea = 5; aConcepto5 = #dsm0053@#5; |FINSI;
                  |SI nLinea = 6; aConcepto6 = #dsm0053@#5; |FINSI;
                  nLinea = nLinea + 1; |LEE 000#dsm0053@.s;
               |SIGUE;
            |SINO;
               #agif069@#20 = #dscam003#0;
               #agif069@#0  = #dscam003#1;
               #agif069@#1  = 0;
               |LEE 000#agif069@.];
               |PARA; |SI FSalida = 0; |Y #agif069@#20 = #dscam003#0;
                |Y #agif069@#0 = #dscam003#1; |Y nLinea [ 6; |HACIENDO;
                  |SI nLinea = 1; aConcepto1 = #agif069@#4; |FINSI;
                  |SI nLinea = 2; aConcepto2 = #agif069@#4; |FINSI;
                  |SI nLinea = 3; aConcepto3 = #agif069@#4; |FINSI;
                  |SI nLinea = 4; aConcepto4 = #agif069@#4; |FINSI;
                  |SI nLinea = 5; aConcepto5 = #agif069@#4; |FINSI;
                  |SI nLinea = 6; aConcepto6 = #agif069@#4; |FINSI;
                  nLinea = nLinea + 1; |LEE 000#agif069@.s;
               |SIGUE;
               #agif084@#48 = #dscam003#0;
               #agif084@#0  = #dscam003#1;
               |LEE 000#agif084@.=;
               |SI FSalida = 0;
                  nBase = #agif084@#72; nIVA = #agif084@#24; nTotal = #agif084@#73;
               |SINO;
                  nBase = 0; nIVA = 0; nTotal = 0;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;

      |CIERRA #dsm0053@; |DESCARGA_DEF #dsm0053@;
      |CIERRA #agif134@; |DESCARGA_DEF #agif134@;
      |CIERRA #agif059@; |DESCARGA_DEF #agif059@;
      |CIERRA #agif010@; |DESCARGA_DEF #agif010@;
      |CIERRA #agif071@; |DESCARGA_DEF #agif071@;
      |CIERRA #agif084@; |DESCARGA_DEF #agif084@;
      |CIERRA #agif069@; |DESCARGA_DEF #agif069@;
   |FINSI;

   || Si el recibo viene de una agrupacion o forma parte de una division tomamos ...
   ||   .... la serie del recibo, la buscamos en el dscam045 filtrando la empresa ..
   ||   .... de cartera y tomamos el path del dscam044.

|FPRC;

|PROCESO Individual;
   #dscam003#40 = #dscam013#16;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      Divisa = #dscam003#57; |HAZ TomaDecim;
   |FINSI;

   |HAZ IniVars;

   eaCodigo = #dscam003#32; eaTipoCod = "C"; aCuenta = #dscam003#5; |HAZ LeeDatos;
   eaNif = eaNif > eaNif;
   Field = eaNif; aTipo = "A"; NumDig = 12; |HAZ Formato ; CIF = Field;

   |HAZ IniVars;

   VAlfa01 = "0319445003";
   |SI #dscaz193#16 = "N";
      nCalc = 135;
      |SI #dscam014#60 = "S"; nCalc = nCalc - 6; |FINSI;
      |SI #dscam014#61 = "S"; nCalc = nCalc - 7; |FINSI;
      |SI #dscam014#62 = "S"; nCalc = nCalc - 4; |FINSI;

      VAlfa02 = #dscam014#59; |QBF VAlfa02;
      VAlfa02 = VAlfa02 % nCalc;

      |SI #dscam014#60 = "S";
         Field = #dscam013#4;  aTipo = "A"; NumDig = 5; |HAZ Formato; VAlfa02 = VAlfa02 + " " + Field;
      |FINSI;
      |SI #dscam014#61 = "S";
         Field = #dscam013#3;  aTipo = "N"; NumDig = 6; |HAZ Formato; VAlfa02 = VAlfa02 + "/" + Field;
      |FINSI;
      |SI #dscam014#62 = "S";
         Field = #dscam013#5;  aTipo = "N"; NumDig = 3; |HAZ Formato; VAlfa02 = VAlfa02 + "/" + Field;
      |FINSI;
      VAlfa02 = (VAlfa02 + (" " * 35)) % 0135;
   |SINO;
      VAlfa02 = "Factura " + (("     " + #dscam003#0) % -105) + "/";
      VAlfa02 = VAlfa02 + (("000000" + #dscam003#1) % -106) + "   Recibo ";
      VAlfa02 = VAlfa02 + (("000" + #dscam003#2) % -103);
      VAlfa02 = (VAlfa02 + (" " * 35)) % 0135;
   |FINSI;

   |ABRE #dscam161;
   |SELECT #2#dscam161;
   #dscam161#1 = #dscam003#32;
   |LEE 000#dscam161.=;
   |SI FSalida ! 0;
      Field = CIF;  aTipo = "A"; NumDig = 9; |HAZ Formato ; aAlfa = Field;
      aAlfa = aAlfa + "000"; #dscam161#5 = aAlfa;
   |FINSI;
   |SELECT #1#dscam161;
   |CIERRA #dscam161;

   VAlfa03 = #dscam161#5;
   VAlfa03 = (VAlfa03 + (" " * 35)) % 0135;
   ||VAlfa04 = "FRST";
   VAlfa04 = "OOFF";
   VAlfa05 = "SUPP";
   Field = #dscam013#7;  aTipo = "I"; NumDig = 11; |HAZ Formato; VAlfa06  = Field;
   aAlfa = #dscam161#6; |QBF aAlfa;
   VAlfa07 = (aAlfa % 0704) + (aAlfa % 0402) + (aAlfa % 0102);
   ||VAlfa08 = #dscam014#45;
   Field = eaCodBIC;     aTipo = "A"; NumDig = 11; |HAZ Formato; VAlfa08  = Field;
   Field = #dscam003#6;  aTipo = "A"; NumDig = 70; |HAZ Formato; VAlfa09  = Field;

   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa   + VAlfa08 + VAlfa09;
   VAlfa = Handle + " " + VAlfa; |FGRABA VAlfa;

   Field = eaDireccion;  aTipo = "A"; NumDig = 50; |HAZ Formato; VAlfa10  = Field;
   Field = eaCP + " " + eaPoblacion; aTipo = "A"; NumDig = 50; |HAZ Formato; VAlfa11  = Field;
   Field = eaProvincia;  aTipo = "A"; NumDig = 40; |HAZ Formato; VAlfa12  = Field;
   VAlfa13 = "ES";
   VAlfa14 = "1"; || Persona juridica

   VAlfa15 = "I" + eaNif;
   Field = VAlfa15;  aTipo = "A"; NumDig = 36; |HAZ Formato; VAlfa15  = Field;
   VAlfa = VAlfa10 + VAlfa11 + VAlfa12 + VAlfa13 + VAlfa14 + VAlfa15;
   VAlfa = Handle + " " + VAlfa; |FGRABA VAlfa;

   VAlfa16 = " " * 35;
   VAlfa17 = #dscaz193#18;
   |SI VAlfa17 = "A";
      VAlfa18 = eaCodIBAN;
      VAlfa19 = "SUPP";
   |SINO;
      Field = #dscam003#8;  aTipo = "N"; NumDig = 4;  |HAZ Formato; VAlfa18  = Field;
      Field = #dscam003#9;  aTipo = "N"; NumDig = 4;  |HAZ Formato; VAlfa18  = VAlfa18 + Field;
      Field = #dscam003#10; aTipo = "N"; NumDig = 2;  |HAZ Formato; VAlfa18  = VAlfa18 + Field;
      Field = #dscam003#11; aTipo = "N"; NumDig = 10; |HAZ Formato; VAlfa18  = VAlfa18 + Field;
      VAlfa19 = (" " * 14) + "SUPP";
   |FINSI;

   VAlfa20 = #dscam014#59; |QBF VAlfa20;
   |SI VAlfa20 ! ""; VAlfa20 = VAlfa20 + " "; |FINSI;
   |SI #dscam014#60 = "S"; VAlfa20 = VAlfa20 + #dscam003#0; |FINSI;
   |SI #dscam014#61 = "S"; VAlfa20 = VAlfa20 + "/" + (("000000" + #dscam003#1) % -106); |FINSI;
   |SI #dscam014#62 = "S"; VAlfa20 = VAlfa20 + "/" + (("000" + #dscam003#2) % -103); |FINSI;
   Field = VAlfa20;  aTipo = "A"; NumDig = 90; |HAZ Formato; VAlfa20 = Field;
   VAlfa21 = " " * 50;
   VAlfa22 = " " * 19;

   VAlfa = VAlfa16 + VAlfa17 + VAlfa18 + VAlfa19 + VAlfa20 + VAlfa21 + VAlfa22;
   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;

   NumInd = NumInd + 1; NumIndDet = NumIndDet + 1;
   nTotal003Ord = nTotal003Ord + 1; nTotal003 = nTotal003 + 1;
   nTotalRegs   = nTotalRegs   + 1;
   TotalInd = TotalInd + #dscam013#7;
   TotalOrd = TotalOrd + #dscam013#7;
   NumDomics = NumDomics + 1;

/*
   |SI #dscaz193#16 = "S";
      |HAZ TomaDatos;
      nNumConcepto = 1; |HAZ Conceptos;
      nNumConcepto = 2; |HAZ Conceptos;
      nNumConcepto = 3; |HAZ Conceptos;
      nNumConcepto = 4; |HAZ Conceptos;
      nNumConcepto = 5; |HAZ Conceptos;
      NumIndDet = NumIndDet + 5;
   |FINSI;
*/
   |SI #dscam012#23 = "N"; |HAZ ActRecibo; |FINSI;
   |LIBERA #dscam003;
|FPRC;

|PROCESO ActRecibo;
   || Actualizo  el historico de cobros
   #dscam004#17 = #dscam013#16;
   #dscam004#3 = 99;
   |LEE 000#dscam004.];
   |SI FSalida ! 0;
      |LEE 010#dscam004.u;
      |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
         LinCob = #dscam004#3 + 1;
      |SINO;
         LinCob = 1;
      |FINSI;
   |SINO;
      |SI #dscam004#17 = #dscam013#16;
         LinCob = #dscam004#3 + 1;
      |SINO;
         |LEE 010#dscam004.a;
         |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
            LinCob = #dscam004#3 + 1;
         |SINO;
            LinCob = 1;
         |FINSI;
      |FINSI;
   |FINSI;

   |DDEFECTO #dscam004;
   #dscam004#17 = #dscam013#16;
   #dscam004#15 = #dscam013#2;
   #dscam004#0  = #dscam013#4;
   #dscam004#1  = #dscam013#3;
   #dscam004#2  = #dscam013#5;
   #dscam004#3  = LinCob;
   #dscam004#4  = #dscam012#14;
   #dscam004#5  = "EMR";
   #dscam004#6  = #dscaz193#6;
   #dscam003#40 = #dscam013#16;
   |LEE 010#dscam003.=;
   |SI FSalida = 0;
      #dscam004#7  = #dscam003#23; #dscam004#25  = #dscam003#61;
   |FINSI;
   #dscam004#8  = 0;
   #dscam004#9  = 0;
   #dscam004#10 = 0;
   #dscam004#26 = 0;
   |GRABA 020#dscam004.n;

   #dscam013#24 = LinCob; |GRABA 020#dscam013.a;
/*
   || Actualizo el riesgo de cliente

   |SI #dscam051#3 = "S";
      enBanco = #dscam012#2;
      || enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
      enEmpCartera = -1;      enEmpGestion = #dscam003#46;
      eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
      nImporte = #dscam013#7; eaTipoOper = "+6-4";
      |HAZ BucleRiesgo;
   |FINSI;

   || Actualizo el recibo
   #dscam003#40 = #dscam013#16;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      #dscam003#14 = "L";
      #dscam003#15 = "Recibo liquidado";
      #dscam003#26 = #dscam012#1;
      #dscam003#23 = #dscam003#23 + #dscam013#22; #dscam003#61 = #dscam003#61 + #dscam013#7;
      #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
      #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
      #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
      Comodin = #dscam003#31; |QBF Comodin; Calc = Comodin;
      #dscam003#31 = #dscam003#30 - #dscam003#23; #dscam003#65 = #dscam003#64 - #dscam003#61;
      |GRABA 020#dscam003.a; |LIBERA #dscam003;
   |FINSI;
*/
|FPRC;

|PROCESO TotalOrden;
   VAlfa01 = "04";
   aSufijo = #dscam014#80; aNif = #dscam014#47; |HAZ ObtenId;
   Field = aIdent;       aTipo = "A"; NumDig = 35; |HAZ Formato; VAlfa02 = Field;
   Fecha = #dscaz193#7;  |HAZ RetocaFecha;                       VAlfa03 = Fecha;
   Field = TotalInd;     aTipo = "I"; NumDig = 17; |HAZ Formato; VAlfa04  = Field;
   Field = NumInd;       aTipo = "N"; NumDig = 8;  |HAZ Formato; VAlfa05  = Field;
   Calc = NumIndDet + 2;  || Las lineas contadas mas la linea del ordenante
                          ||     y esta misma
   Field = Calc;         aTipo = "N"; NumDig = 10;|HAZ Formato ; VAlfa06  = Field;
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06;
   VAlfa = Handle + " " + VAlfa; |FGRABA VAlfa;

   VAlfa07 = " " * 120;
   VAlfa = Handle + " " + VAlfa07; |FGRABA VAlfa;

   VAlfa08 = " " * 200;
   VAlfa = Handle + " " + VAlfa08;           |FGRABA VAlfa;
   VAlfa = Handle + " " + VAlfa08 + aFinLin; |FGRABA VAlfa;

   nTotalRegs   = nTotalRegs   + 1;

   VAlfa01 = "05";
   VAlfa = VAlfa01 + VAlfa02 + VAlfa04 + VAlfa05 + VAlfa06;
   VAlfa = Handle + " " + VAlfa;             |FGRABA VAlfa;

   VAlfa07 = " " * 128;
   VAlfa = Handle + " " + VAlfa07;           |FGRABA VAlfa;

   VAlfa08 = " " * 200;
   VAlfa = Handle + " " + VAlfa08;           |FGRABA VAlfa;
   VAlfa = Handle + " " + VAlfa08 + aFinLin; |FGRABA VAlfa;

   NumOrd = NumOrd + NumInd; NumOrdDet = NumOrdDet + NumIndDet + 2;
   nTotalRegs   = nTotalRegs   + 1;
|FPRC;

|PROCESO TotalGeneral;
   VAlfa01 = "99";
   Field = TotalOrd;     aTipo = "I"; NumDig = 17;|HAZ Formato ; VAlfa02 = Field;
   Field = nTotal003;    aTipo = "N"; NumDig = 8; |HAZ Formato ; VAlfa03  = Field;
   Calc = nTotalRegs   + 1;
   Field = Calc;         aTipo = "N"; NumDig = 10;|HAZ Formato ; VAlfa04  = Field;
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04;
   VAlfa = Handle + " " + VAlfa; |FGRABA VAlfa;

   VAlfa05 = " " * 163;
   VAlfa = Handle + " " + VAlfa05; |FGRABA VAlfa;

   VAlfa06 = " " * 200;
   VAlfa = Handle + " " + VAlfa06; |FGRABA VAlfa;
   VAlfa = Handle + " " + VAlfa06 + aFinLin; |FGRABA VAlfa;
|FPRC;

|DEFBUCLE Recibos;
#dscam013#1;
;
#dscam012#0,001;
#dscam012#0,999;
be;
NULL,Individual;
|FIN;

|PROCESO Remesas;

   #dscam012#0 = #dscaw038#0;
   |LEE 101#dscam012.=;
   |SI FSalida = 0; SwEmit = #dscam012#23; |FINSI;

   eaUsuario = Usuario % 0810;
   eaDescr   = "EMISION REMESA (" + (("00000" + #dscam012#0) % -105);
   eaDescr   = eaDescr + ") EN DISKETTE DESDE NORMA 19.44";
   eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
   eaTipoOp  = "E";   enImpAnt = #dscam012#10; enImpAct = #dscam012#10;
   |HAZ GrabaAudit;

   #dscam015#0 = #dscam012#2;
   |LEE 000#dscam015.=;
   |SI FSalida = 0; |DDEFECTO #dscam015; |FINSI;

   |BUCLE Recibos;
   |SI #dscam012#23 = "N";
      #dscam012#23 = "S"; |GRABA 020#dscam012.a;
   |FINSI;

   |SI HayConta = 1; |Y SwEmit = "N"; |Y #dscam051#1 = "S";
      |ABRE #dscam030;
      #dscam030#0 = #dscaz193#14;
      |LEE 010#dscam030.=;
      |SI FSalida = 0;
         |SI #dscam030#4 ! #dscaw038#3; |O #dscam030#5 ! #dscaw038#4;
            EmpreAnt = #dscam030#4; PerioAnt = #dscam030#5;
            #dscam030#4 = #dscaw038#3; #dscam030#5 = #dscaw038#4;
            |GRABA 020#dscam030.a;
         |SINO;
            EmpreAnt = -1;
         |FINSI;
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #9 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         Comodin = #dscaz193#14;
         |SI Comodin = "    ";
            |ABRE #dscam093;
            #dscam093#0 = "E";
            |LEE 000#dscam093.=;
            |SI FSalida = 0;
               |SI #dscam012#22 = 1; Comodin = #dscam093#1; |FINSI;
               |SI #dscam012#22 = 2; Comodin = #dscam093#3; |FINSI;
               |SI #dscam012#22 = 3; Comodin = #dscam093#5; |FINSI;
               |SI #dscam012#22 = 4; Comodin = #dscam093#7; |FINSI;
               |SI #dscam012#22 = 5; Comodin = #dscam093#9; |FINSI;
            |FINSI;
            |CIERRA #dscam093;
         |FINSI;

         |DDEFECTO #dscaw013;
         #dscaw013#0  = 1;            #dscaw013#15 = Comodin;
         #dscaw013#5  = #dscam012#0;  #dscaw013#6  = #dscam012#0;
         #dscaw013#11 = "N";          #dscaw013#12 = 5;
         #dscaw013#13 = "dscam013";   #dscaw013#14 = 0;
         |GRABA 020#dscaw013.n;
         |CIERRA #dscaw013;
         |LIBERA #dscam012;

         Comodin = "dscam033.tab;" + Comodin + ",I";
         |LIBERA #dscam012; |CIERRAT #dscam012;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam012; |LEE 101#dscam012.=;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

         |SI EmpreAnt ! -1;
            #dscam030#4 = EmpreAnt; #dscam030#5 = PerioAnt;
            |GRABA 020#dscam030.a;
         |FINSI;
      |FINSI;
      |CIERRA #dscam030;
   |FINSI;

   |LIBERA #dscam012;
|FPRC;

|DEFBUCLE Remesas;
#dscaw038#1;
;
INICIO;
FINAL;
;
NULL,Remesas;
|FIN;

|PROCESO MiraRemesas;
   SwHay = 1;
   |DDEFECTO #dscaw038;
   #dscaw038#0 = #dscam012#0;
   #dscaw038#1 = #dscam012#10;
   #dscaw038#2 = #dscaz193#14;
   #dscaw038#5 = #dscam012#23;
   |SI #dscaw038#5 = "N";
      SwHayNoEmit = 1;
   |FINSI;

   |ABRE #dscam030;
   #dscam030#0 = #dscaz193#14;
   |LEE 000#dscam030.=;
   |SI FSalida = 0;
      #dscaw038#3 = #dscam030#4;
      #dscaw038#4 = #dscam030#5;
   |FINSI;
   |CIERRA #dscam030;
   |GRABA 020#dscaw038.n;
|FPRC;

|DEFBUCLE MiraRemesas;
#dscam012#1;
1,2;
#0#0,#0#2,#dscam014#0;
#0#1,#0#3,#dscam014#0;
;
NULL,MiraRemesas;
|FIN;

|RUTINA infw038;
   #dscaw038#0 = 00001;
   #dscaw038#5 = "N";
|FRUT;

|RUTINA supw038;
   #dscaw038#0 = 99999;
   #dscaw038#5 = "N";
|FRUT;

|PROCESO Secuencial;

   |DELINDEX #dscaw038;
   SwHayNoEmit = 0; SwHay = 0;
   |ABRE #dscaw038; |BUCLE MiraRemesas; |CIERRA #dscaw038;
   |SI SwHay = 0; |ACABA; |FINSI;

   |SI #dscaz193#15 = "N";
      |SI SwHayNoEmit = 1;
         |PUSHV 0501 2380;
         |ENTLINEAL #1#dscaw038,1,2,19,1,infw038,supw038;
         |POPV;
      |SINO;
         |MENAV "    No hay remesas sin emitir para redireccionar";
      |FINSI;
   |FINSI;

   aAlfa = #dscam014#46; |QBF aAlfa;
   |SI aAlfa = "";
      aAlfa = #dscam014#47; |QBF aAlfa;
      |SI aAlfa = "";
         aAlfa = #dscam014#53; |QBF aAlfa;
         |SI aAlfa = "";
            aAlfa = #dscam014#54; |QBF aAlfa;
            |SI aAlfa = "";
               aAlfa = #dscam014#72; |QBF aAlfa;
               |SI aAlfa = "";
                  |PUSHV 0910 1970; |BLANCO 0910 1970;
                  |CUADRO 0910 1970;
                  |ATRI R;
                  |PINTA 1012, "Los datos para la emision de remesas en soporte magnetico";
                  |PINTA 1112, "estan vacios. Seleccione un registro del fichero anterior";
                  |PINTA 1212, "del cual importar los datos necesarios.                  ";
                  |ATRI N;
                  nPos1 = 1312; nPos2 = 1868; nModo = 2 + 4 + 8 + 16;
                  |ABRE #dscam015;
                  |ET OtraVez;
                  |LINEAL_SIMPLE #1#dscam015,nModo, nPos1, nPos2, NULL, NULL, NULL;
                  |SI FSalida < 0;
                     |CONFI "    SSin datos para emitir remesas en soporte magnetico no podra emitir dichas normas. Continuar ? ";
                     |SI FSalida ! 0;
                        |VETE OtraVez;
                     |SINO;
                        |ACABA;
                     |FINSI;
                  |SINO;
                     #dscam014#46 = #dscam015#2;
                     #dscam014#47 = #dscam015#3;
                     #dscam014#48 = #dscam015#12;
                     #dscam014#49 = #dscam015#13;
                     #dscam014#72 = #dscam015#19;
                     #dscam014#51 = #dscam015#20;
                     #dscam014#52 = #dscam015#6;
                     #dscam014#53 = #dscam015#7;
                     #dscam014#54 = #dscam015#21;
                     #dscam014#55 = #dscam015#8;
                     #dscam014#56 = #dscam015#9;
                     #dscam014#57 = #dscam015#11;
                     #dscam014#58 = #dscam015#10;
                     #dscam014#59 = #dscam015#14;
                     #dscam014#60 = #dscam015#15;
                     #dscam014#61 = #dscam015#16;
                     #dscam014#62 = #dscam015#17;
                     |GRABA 020#dscam014.a;
                  |FINSI;
                  |CIERRA #dscam015;
                  |POPV;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   #dscaz193#8  = #dscam014#78;
   #dscaz193#17 = #dscam014#80;
   |SI #dscaz193#8 ! "   "; |Y #dscaz193#17 = 0;
      #dscaz193#17 = #dscaz193#8;
   |FINSI;
   |SI #dscaz193#8 = "   "; |Y #dscaz193#17 ! 0;
      #dscaz193#8 = #dscaz193#17;
   |FINSI;

   |DFICB Comodin;
   Comodin1 = ("000" + #dscam014#0) % -103;
   Comodin1 = "n1900" + Comodin1 + ".seq";
   eaOrigen = Comodin; eaNombre1 = Comodin1;
   Comodin = "wb  " + Comodin + Comodin1;
   |QBF Comodin;
   |FABRE Comodin;
   handle = FSalida;
   |SI FSalida ] 0;
      |ABRE #dscam004;
      |ABRE #dscam003;
      |ABRE #dscam012;
      |ABRE #dscam013;
      |ABRE #dscam015;

      nCalc = 13; aFinLin = &nCalc;
      nCalc = 10; aFinLin = aFinLin + &nCalc;
      aFinFic = "";

      |HAZ Presentador;  NumRegs = NumRegs + 1;
      |HAZ Ordenante;    NumRegs = NumRegs + 1;
      |BUCLE Remesas;    NumRegs = NumRegs + NumInd;
      |HAZ TotalOrden;   NumRegs = NumRegs + 1;
      |HAZ TotalGeneral; NumRegs = NumRegs + 1;
      #0#9 = NumDomics;
      #0#10 = NumRegs;
      #0#11 = TotalOrd;
      |PINTA #0#9; |PINTA #0#10; |PINTA #0#11;
      |PAUSA;
      |CIERRA #dscam015;
      |CIERRA #dscam013;
      |CIERRA #dscam012;
      |CIERRA #dscam003;
      |CIERRA #dscam004;
   |FINSI;
   VAlfa = Handle + " " + aFinFic; |FGRABA VAlfa;

   FSalida = handle; |FCIERRA FSalida;

   |SUB_EJECUTA_NP "dscaz032.tab";
|FPRC;

|DEFBUCLE Secuencial;
#dscam014#1;
;
#0#4;
#0#5;
be;
NULL,Secuencial;
|FIN;

|RUTINA infm161;
   #dscam161#0 = 000001;
|FRUT;

|RUTINA supm161;
   #dscam161#0 = 999999;
|FRUT;

|PROCESO Boton;
   |PUSHV 1501 2380;
   |ENTLINEAL #1#dscam161, -1, 1, 22, 1, infm161, supm161;
   |POPV;
|FPRC;

|PROGRAMA;
   |HAZ Tipo8;
   |CLS;
   |CABEZA "Emision diskette norma 19";
   |PINPA #0#0; |PINDA #0#0;
   |CONTROL_SIMPLE 0, "BOTON,{{137}}Control entrada referencias", 2360, 2379, Boton;
   nBoton = FSalida;

   |ENDATOS #1#0;
   |SI FSalida = 0;
      |HAZ MiraMoneda;
      nTotal003 = 0; nTotalRegs   = 0;
      |SI Cambio ! -1; |BUCLE Secuencial; |FINSI;
   |FINSI;
   |FIN_CONTROL_WINDOWS nBoton;

   |HAZ Tipo9;
|FPRO;

|PROCESO RetocaFecha;
   |QBF Fecha;
   Comodin = Fecha % 0704;  || A¤o
   Comodin = Comodin + (Fecha % 0402);  || Mes
   Comodin = Comodin + (Fecha % 0102);  || Dia
   Fecha = Comodin;
|FPRC;

|PROCESO Formato;
   |SI aTipo = "I";
      Calc = Field;
      Calc = (Calc * Cambio) ! Redond;
      |SI Moneda = "E"; Calc = Calc * 100; |FINSI;
      Field = Calc;
   |FINSI;
   |SI aTipo = "A";
      Comodin = " " * NumDig;
      Comodin = Field + Comodin;
      Calc = 100 + NumDig;
   |SINO;
      Comodin = "0" * NumDig;
      Comodin = Comodin + Field;
      Calc = 0 - (100 + NumDig);
   |FINSI;

   |QBF Field;
   Field = Comodin % Calc;
|FPRC;

|PROCESO CampoEnlace; |TIPO 7;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;
   |SI HayConta = 1; |Y #dscam051#1 = "S";
      |ABRE #dscam030;
      #dscam030#0 = #dscam051#53;
      |LEE 000#dscam030.=;
      |SI FSalida = 0;
         ||PINTA 2120, #dscam030#1;
      |FINSI;
      |CIERRA #dscam030;
      #dscaz193#14 = #dscam051#53; |PINTA #dscaz193#14;
      aAlfa = #dscam051#61; |QBF aAlfa;
      |C_M #dscaz193#14,1,aAlfa;
   |SINO;
      #dscaz193#14 = ""; |PINTA #dscaz193#14;
      |C_M #dscaz193#14,1,"N";
   |FINSI;
|FPRC;

|PROCESO MiraMoneda;
/*
   |PUSHV 1921 2155;
   |BLANCO 1921 2155;
   |CUADRO 1923 2153;
   |ATRI R; |PINTA 1924 , " Seleccione moneda de emision "; |ATRI N;
   |PINTA 2031, "(Pesetas/Euros)";
   |ATRI I; |PINTA 2032, "P"; |PINTA 2040, "E"; |ATRI N;
   E_sup  = 1;
   E_inf  = "EP";
   Moneda = "P";
   Moneda = 2047 ? 0;
   |SI FSalida = 0;
*/
      Moneda = "E";
      Cambio = 1;
      Redond = 2;
      Prefijo = "5";
      ||POPV;
      |SI HayGestion = 1;
         |SI #agif321@#9 = "ESP";
            |SI Moneda = "P";
               Cambio = 1;
               Redond = 0;
               Prefijo = "0";
            |SINO;
               Cambio = 1/166.386;
               Redond = 2;
               Prefijo = "5";
            |FINSI;
         |FINSI;
         |SI #agif321@#9 = "EUR";
            |SI Moneda = "P";
               Cambio = 166.386;
               Redond = 0;
               Prefijo = "0";
            |SINO;
               Cambio = 1;
               Redond = 2;
               Prefijo = "5";
            |FINSI;
         |FINSI;
      |SINO;
      |FINSI;
/*
   |SINO;
      Cambio = -1;
   |FINSI;
*/
|FPRC;
