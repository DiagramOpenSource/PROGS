|FICHEROS;
   dscaz011 #0;
   dscam014 #1;
   dscam012 #2;
   dscam013 #3;
   dscam003 #4;
   dscam004 #5;
   dscam061 #50;
   dscam062 #51;
   dscam051 #52;
   dscaw116 #53;

   &agif321@ #5;
   &agif324@ #6;
   &canempr@ #7;

   dscam044  #900;
   dscam045  #901;
   FactVta@  #1000;
   FactDir@  #1001;
|FIN;

|VARIABLES;
   nSwOTP = 0;
   &eaFichClas = "";  &eaTipoClas = ""; &enSwClas = 0;

   &eaEntidad  = "";
   &eaSucursal = "";
   &eaDC       = "";
   &eaCuenta   = "";

   &eaSesion   = "";

   &Fichero   = "";  &Cmp = "";   &Tipo = ""; &CmpNum = 0;
   &nDeci_males = 0; &nDeci_Div = 0; &Divisa = "";

   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = "";

   &eaTipoRecibo = ""; &enNumDocum = 0; &eaMensRet = ""; &enSwError = 0; &eaTOperacion = "";

   DBanco = 0; HBanco = 0; nCalc = 0; nLinea = 0;
   nTecla = 0;

   aEntidad = "";
   aNumPag  = "";

   nSwErr   = 0;
   nEmpresa = 0;
   nDImpor  = 0;
   nHImpor  = 0;
   aDirApp  = "";
   aAlfa    = "";
   aAlfa1   = "";

   nSwLuxe  = 0;

   Codigo = 0;
   NumBanco = 0;
   TotRem1 = 0; TotRem2 = 0; TotRem3 = 0; TotRem4 = 0;
   TotRem5 = 0; TotRem6 = 0; TotRem7 = 0; TotRem8 = 0;
   TotalRemesa = 0;
   LimiteRemesa = 0;
   SwError  = 0;
   Linea = 0;
   LinCob = 0;
   nInteres = 0;
   nPorcInt = 0;
   NumDias = 0;
   HayGestion = 0; CambioBase = 0;

   nNumRemesa = 0;

   Campo1 = 0;
   Contador = 0;
   Comodin = ""; Comodin1 = "";
   Calc = 0;
   Calc1 = 0;
   Calc2 = 0;
   Cont = 0;
   Par  = 0;

   aDSerie = "";
   aHSerie = "";

   nCont   = 0;

   &eaTipoCod   = "";
   &ewErrorIBAN = 0;
   &enSinac     = 0;
|FIN;

|PROCESO GrabaError;
   |LEE 000#dscaw116.u;
   nLinea = #dscaw116#0 + 1;

   |DDEFECTO #dscaw116;
   #dscaw116#0 = nLinea;
   #dscaw116#1 = aAlfa;
   |GRABA 020#dscaw116.n;
|FPRC;

|PROCESO LinsInforme;
   |PRINT;
|FPRC;

|DEFBUCLE LinsInforme;
#dscaw116#1;
;
INICIO;
FINAL;
;
NULL, LinsInforme;
|FIN;

|PROCESO MiraSiFactConta;
   nSwErr = 0;
   |SI #dscam003#1  = 0;   |ACABA; |FINSI;
   |SI #dscam051#94 = "N"; |ACABA; |FINSI;

   |DFICE aAlfa; |QBF aAlfa; aAlfa = aAlfa % -106; aAlfa = aAlfa % 0105;
   nEmpresa = aAlfa;

   |DFICB aAlfa; |QBF aAlfa;
   |PATH_DAT #dscam044#aAlfa#; |PATH_DAT #dscam045#aAlfa#;
   |ABRE #dscam045; |ABRE #dscam044;
   |DDEFECTO #dscam045;
   |SELECT #2#dscam045;
   #dscam045#6 = nEmpresa;
   |LEE 000#dscam045.];
   |PARA; |SI FSalida = 0; |Y #dscam045#6 = nEmpresa; |HACIENDO;
      |SI #dscam045#2 = "V"; |Y #dscam045#0 = #dscam003#46;
         |SAL;
      |FINSI;
      |LEE 000#dscam045.s;
   |SIGUE;
   |SI #dscam045#2 ! "V"; |O #dscam045#0 ! #dscam003#46;
      |ACABA;
   |FINSI;

   #dscam044#0 = #dscam045#0;
   |LEE 000#dscam044.=;
   |SI FSalida = 0;
      aDirApp = #dscam044#1; |QBF aDirApp;
      aAlfa = aDirApp + "def/agifa134.mas";
      |CARGA_DEF aAlfa, FactVta@;
      |SI FSalida = 0;
         aAlfa = aDirApp + "def/agifa084.mas";
         |CARGA_DEF aAlfa, FactDir@;
         |SI FSalida = 0;
            aAlfa = aDirApp + "fich/" + (("00000" + #dscam045#0) % -105) + "/";
            |PATH_DAT #FactVta@#aAlfa#; |PATH_DAT #FactDir@#aAlfa#;
            |ABRE #FactVta@; |ABRE #FactDir@;
            #FactVta@#49 = #dscam003#0;
            #FactVta@#0  = #dscam003#1;
            |LEE 000#FactVta@.=;
            |SI FSalida = 0;
               |SI #FactVta@#48 = "N"; nSwErr = 1; |FINSI;
            |SINO;
               #FactDir@#48 = #dscam003#0;
               #FactDir@#0  = #dscam003#1;
               |LEE 000#FactDir@.=;
               |SI FSalida = 0;
                  |SI #FactVta@#39 = "N"; nSwErr = 1; |FINSI;
               |SINO;
                  aAlfa = "    La factura " + #dscam003#0 + "/" + #dscam003#1 + " no se encuentra en la empresa " + #dscam045#0 + " de gestion comercial";
                  |MENAV aAlfa;
               |FINSI;
            |FINSI;
            |CIERRA #FactVta@; |CIERRA #FactDir@;
            |DESCARGA_DEF #FactDir@;
         |FINSI;
         |DESCARGA_DEF #FactVta@;
      |FINSI;
   |FINSI;

   |SELECT #1#dscam045;
   |CIERRA #dscam045; |CIERRA #dscam044;
|FPRC;

|PROCESO CodigoCero; |TIPO 7;
     |DDEFECTO #dscam061;
     |ABRE #dscam061;              || para que la existencia obligatoria de
     #dscam061#0 = 0;              ||/la relacion no nos moleste en el codigo
     |LEE 000#dscam061.=;          ||/igual a cero
     |SI FSalida ! 0;
          |GRABA 020#dscam061.n;
     |FINSI;
     |CIERRA #dscam061;
|FPRC;

|PROCESO CodigoNoCero; |TIPO 0;
     |SI #dscaz011#59 ! 0;
          |C_M #dscaz011#22, 1, "N";
          |C_M #dscaz011#23, 1, "N";
     |SINO;
          |C_M #dscaz011#22, 1, "S";
          |C_M #dscaz011#23, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Seleccion;
   |SI Campo = 2;
      |SI #dscaz011#Campo# = "S";
         |PARA Cont = 3; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
            |C_M #dscaz011#Cont#,1,"S";
         |SIGUE;
         #dscaz011#30 = 1;  |C_M #dscaz011#30,1,"N"; |PINTA #dscaz011#30;
         #dscaz011#31 = 99; |C_M #dscaz011#31,1,"N"; |PINTA #dscaz011#31;
      |SINO;
         |PARA Cont = 3; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
            #dscaz011#Cont# = 0; |C_M #dscaz011#Cont#,1,"N";  |PINTA #dscaz011#Cont#;
         |SIGUE;
         |C_M #dscaz011#30,1,"S";
         |C_M #dscaz011#31,1,"S";
      |FINSI;
   |FINSI;
   |SI Campo = 11
      |SI #dscaz011#Campo# = "S";
         |PARA Cont = 12; |SI Cont [ 19; |HACIENDO Cont = Cont + 1;
            |C_M #dscaz011#Cont#,1,"S";
         |SIGUE;
         #dscaz011#34 = "  "; |C_M #dscaz011#34,1,"N"; |PINTA #dscaz011#34;
         #dscaz011#35 = "zz"; |C_M #dscaz011#35,1,"N"; |PINTA #dscaz011#35;
      |SINO;
         |PARA Cont = 12; |SI Cont [ 19; |HACIENDO Cont = Cont + 1;
            #dscaz011#Cont# = "  "; |C_M #dscaz011#Cont#,1,"N"; |PINTA #dscaz011#Cont#;
         |SIGUE;
         |C_M #dscaz011#34,1,"S";
         |C_M #dscaz011#35,1,"S";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO PintaBanco1; |TIPO 7;
   |HAZ PintaBanco;
|FPRC;

|PROCESO PintaBanco;
   nTecla = FSalida;
   Calc = Campo / 2;
   Comodin = Calc; |QBF Comodin;
   Comodin = Comodin % -102;
   |SI Comodin = ".5";
      Par = 0;
   |SINO;
      Par = 1;
   |FINSI;

   |SI Par = 1;
      Calc1 = Campo + 1;
      Calc2 = Campo;
   |SINO;
      Calc1 = Campo;
      Calc2 = Campo - 1;
   |FINSI;

   |SI #dscaz011#Calc2# = 0;
      |C_M #dscaz011#Calc1#,1,"N";
      Comodin = " " * 22;
      |PINTA 1154, Comodin;
      |ACABA;
   |SINO;
      |C_M #dscaz011#Calc1#,1,"S";
   |FINSI;
   |ABRE #dscam014;
   #dscam014#0 = #dscaz011#Calc2#;
   |LEE 000#dscam014.=;
   |SI FSalida = 0;
      |SI Par = 1;
         #dscaz011#Calc1# = #dscam014#12 - #dscam014#13; |PINTA #dscaz011#Calc1#;
      |FINSI;
      Comodin = #dscam014#1 % 0122;
   |SINO;
      Comodin = " " * 22;
   |FINSI;
   |PINTA 1154, Comodin;
   |CIERRA #dscam014;

|FPRC;
|PROCESO Contador; |TIPO 7;
|FPRC;

|PROCESO Comprueba;
   eaTipoCod = "C";
   |HAZ ChequeoIBAN;
   |SI ewErrorIBAN = 1;
       aAlfa = "Recibo " + #dscam003#40 + " con Codigo de IBAN vacio y control de errores activado"; |HAZ GrabaError;
       nSwErr = -1;
       |ERROR10;
   |FINSI;
   |SI ewErrorIBAN = 2;
       aAlfa = "Recibo " + #dscam003#40 + " con Codigo de IBAN erroneo y control de errores activado"; |HAZ GrabaError;
       nSwErr = -1;
       |ERROR10;
   |FINSI;
|FPRC;

|DEFBUCLE Comprueba;
#dscam003#7;
;
aEntidad, aNumPag, 0000000001;
aEntidad, aNumPag, 9999999999;
;
NULL,Comprueba;
|FIN;

|PROCESO BucleRecibos;
   |SI nSwLuxe = 1; |Y #dscam003#100 = "S"; |ACABA; |FINSI;

   |LIBERA #dscam003;
   |HAZ ComprTotVta;
   |LEE 101#dscam003.=;

   |HAZ MiraSiFactConta;
   |SI nSwErr ! 0; |ACABA; |FINSI;

   |SI #dscam003#90 = "N"; |Y #dscam051#75 = "N";
      aAlfa = "Recibo no preparado y preparacion automatica no activada"; |HAZ GrabaError;
      |ACABA;
   |FINSI;

   |SI #dscaz011#61 = "R"; |Y #dscam051#111 = "S";
       eaTipoCod = "C";
       |HAZ ChequeoIBAN;
       |SI ewErrorIBAN = 1;
           aAlfa = "Recibo " + #dscam003#40 + " con Codigo IBAN vacio y control de errores activado"; |HAZ GrabaError;
           |ACABA;
       |FINSI;
       |SI ewErrorIBAN = 2;
           aAlfa = "Recibo " + #dscam003#40 + " con Codigo IBAN erroneo y control de errores activado"; |HAZ GrabaError;
           |ACABA;
       |FINSI;

   |FINSI;

   |SI #dscaz011#61 = "P";
      |SI #dscam003#78 < 0;
         aAlfa = "Pagare [" + #dscam003#72 + "/" + #dscam003#70 + "] con importe pendiente negativo"; |HAZ GrabaError;
         |ACABA;
      |FINSI;
      aEntidad = #dscam003#72; aNumPag = #dscam003#70;
/* Tiquet: 700000/9866
      |SI #dscam051#111 = "S";
         |SALVA_FICHA #dscam003;
         nSwErr = 0; |BUCLE Comprueba;
         |REPON_FICHA #dscam003;
         |SI nSwErr < 0;
            |ACABA;
         |FINSI;
      |FINSI;
*/
   |FINSI;

   enSwClas   = 1; eaFichClas = "dscaz011"; eaTipoClas = #dscam003#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR";
      aAlfa = "Recibo " + #dscam003#40 + " con error de tipo de clasificacion"; |HAZ GrabaError;
      |ACABA;
   |FINSI;

   aAlfa = #dscaz011#63; |QBF aAlfa;
   |SI aAlfa ! "";
      aAlfa1 = #dscam003#7; |QBF aAlfa1;
      aAlfa  = aAlfa1 - aAlfa;
      |SI aAlfa = aAlfa1;
         aAlfa = "El banco de domiciliacion del recibo " + #dscam003#40 + " no coincide con el patr¢n de banco " + #dscaz011#63;
         |QBF aAlfa; |HAZ GrabaError;
         |ACABA;
      |FINSI;
   |FINSI;

   Divisa = #dscam003#57; |HAZ TomaDecim;

||Juan


   nCalc = 36 + (NumBanco * 2);

   |SALVA_FICHA #dscam014;
   #dscam014#0 = #dscam003#51;
   |LEE 000#dscam014.=;
   |SI FSalida = 0;
      |SI #dscam014#40 = "N"; |O #dscam051#7 = "S";
         nCalc = 36 + (NumBanco * 2)
         |SI #dscam003#51 ! #dscaz011#nCalc#;
            aAlfa = "El banco de remesas del recibo " + #dscam003#40 + " no est  incluido en las acotaciones "; |HAZ GrabaError;
            |REPON_FICHA #dscam014; |ACABA;
         |FINSI;
      |FINSI;
   |FINSI;
   |REPON_FICHA #dscam014;

   |SI #dscaz011#59 ! 0;
        #dscam062#0 = #dscaz011#59;
        #dscam062#1 = #dscam003#0;
        |LEE 000#dscam062.=;
        |SI FSalida ! 0;
             aAlfa = "La serie del recibo " + #dscam003#40 + " no se encuentra en la agrupacion de series"; |HAZ GrabaError;
             |ACABA;
        |FINSI;
   |FINSI;

   |SI #dscaz011#2 = "S";
      SwError = 1;
      |PARA Cont = 3; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
         |SI #dscaz011#Cont# = #dscam003#12; SwError = 0; |SAL; |FINSI;
      |SIGUE;
      |SI SwError = 1;
         aAlfa = "El recibo " + #dscam003#40 + " tiene un tipo de recibo fuera de la acotacion"; |HAZ GrabaError;
         |ACABA;
      |FINSI;
   |SINO;
      |SI #dscaz011#30 > #dscam003#12; |O #dscaz011#31 < #dscam003#12;
         aAlfa = "El recibo " + #dscam003#40 + " tiene un tipo de recibo fuera de la acotacion"; |HAZ GrabaError;
         |ACABA;
      |FINSI;
   |FINSI;

   |SI #dscaz011#11 = "S";
      SwError = 1;
      |PARA Cont = 12; |SI Cont [ 19; |HACIENDO Cont = Cont + 1;
         |SI #dscaz011#Cont# = #dscam003#33; SwError = 0; |SAL; |FINSI;
      |SIGUE;
      |SI SwError = 1;
         aAlfa = "El recibo " + #dscam003#40 + " tiene un representante fuera de la acotacion"; |HAZ GrabaError;
         |ACABA;
      |FINSI;
   |SINO;
      |SI #dscaz011#34 > #dscam003#33; |O #dscaz011#35 < #dscam003#33;
         aAlfa = "El recibo " + #dscam003#40 + " tiene un representante fuera de la acotacion"; |HAZ GrabaError;
         |ACABA;
      |FINSI;
   |FINSI;

   |SI #dscam051#42 = "S";
      |SI #dscam003#28 = "S"; |Y #dscam003#29 = "N";
         aAlfa = "El recibo " + #dscam003#40 + " no est  aceptado"; |HAZ GrabaError;
         |ACABA;
      |FINSI;
   |FINSI;

   |SI #dscam003#14 = "I";
      |SI #dscaz011#60 = "N";
         aAlfa = "El recibo " + #dscam003#40 + " est  impagado"; |HAZ GrabaError;
         |ACABA;
      |FINSI;
   |SINO;
      |SI #dscaz011#61 = "R";
         |SI #dscam003#14 ! "C"; |Y #dscam003#14 ! "P";
            |ACABA;
         |FINSI;
      |SINO;
         |SI #dscam003#47 = "N";
            |SI #dscam003#14 ! "T"; |ACABA; |FINSI;
         |SINO;
            |SI #dscam003#14 ! "p"; |ACABA; |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   Calc = TotalRemesa + #dscam003#65;

   |SI Calc [ LimiteRemesa;
      enSwError = -1;
      eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscam003#40; |HAZ ProcesaTempo;
      |SI enSwError = 0;
         TotalRemesa = TotalRemesa + #dscam003#65;
         |DDEFECTO #dscam013;
         #dscam013#0  = #dscam012#0;
         #dscam013#1  = Linea;    Linea = Linea + 1;
         #dscam013#2  = #dscam003#27;
         #dscam013#3  = #dscam003#1;
         #dscam013#4  = #dscam003#0;
         #dscam013#5  = #dscam003#2;
         |SI #dscaz011#61 = "R";
            #dscam013#6  = #dscam003#3;
         |SINO;
            #dscam013#6 = #dscam003#71;
            #dscam013#37 = #dscam003#72;
            #dscam013#38 = #dscam003#70;
         |FINSI;
         |SI #dscam003#47 ! "S";
            #dscam013#7 = #dscam003#65;
            #dscam013#22 = #dscam003#31;
         |SINO;
            |SI #dscam003#14 = "p";
               #dscam013#7 = #dscam003#65;
               #dscam013#22 = #dscam003#31;
            |SINO;
               #dscam013#7 = #dscam003#61;
               #dscam013#22 = #dscam003#23;
            |FINSI;
         |FINSI;
         #dscam013#11 = #dscam003#5;
         Calc1 = #dscam012#1;
         Calc2 = #dscam013#6;
         NumDias = Calc2 - Calc1;
         |SI NumDias < 0;
            NumDias = 0;
            #dscam013#12 = "S";
            nInteres = 0;
            nPorcInt = 0;
         |SINO;
            #dscam013#12 = "N";
            |SI #dscam014#28 ! 0; |O #dscam014#29 ! 0; |O #dscam014#30 ! 0; |O #dscam014#31 ! 0;
               |SI NumDias ] #dscam014#20; |Y NumDias [ #dscam014#24;
                  nInteres = ((#dscam013#7 * #dscam014#28) / 36000) * NumDias;
                  nPorcInt = #dscam014#28;
               |FINSI;
               |SI NumDias ] #dscam014#21; |Y NumDias [ #dscam014#25;
                  nInteres = ((#dscam013#7 * #dscam014#29) / 36000) * NumDias;
                  nPorcInt = #dscam014#29;
               |FINSI;
               |SI NumDias ] #dscam014#22; |Y NumDias [ #dscam014#26;
                  nInteres = ((#dscam013#7 * #dscam014#30) / 36000) * NumDias;
                  nPorcInt = #dscam014#30;
               |FINSI;
               |SI NumDias ] #dscam014#23; |Y NumDias [ #dscam014#27;
                  nInteres = ((#dscam013#7 * #dscam014#31) / 36000) * NumDias;
                  nPorcInt = #dscam014#31;
               |FINSI;
            |SINO;
               |SI #dscam014#32 ! 0;
                  nInteres = (#dscam013#7 % #dscam014#32) * NumDias;
                  nPorcInt = #dscam014#32;
               |SINO;
                  nInteres = ((#dscam013#7 * #dscam014#17) / 36000) * NumDias;
                  nPorcInt = #dscam014#17;
               |FINSI;
            |FINSI;
         |FINSI;
         #dscam013#8  = NumDias;
         #dscam013#9  = nPorcInt;
         #dscam013#10 = nInteres;
         #dscam013#16 = #dscam003#40;

         |SI HayGestion = 1;
            Fichero = "Divisas"; Tipo = "G"; Cmp = "Codigo Divisa"; |HAZ ObtenDato;
            #agif324@#CmpNum# = #dscam003#57;
            |LEE 000#agif324@.=;
            |SI FSalida = 0;
               Fichero = "Divisas"; Tipo = "G"; Cmp = "Valor Venta"; |HAZ ObtenDato;
               #dscam013#21 = CambioBase / #agif324@#CmpNum#;
               #dscam013#23 = #dscam003#59;
               Fichero = "Divisas"; Tipo = "G"; Cmp = "Num.Decimales"; |HAZ ObtenDato;
               nDeci_Div = #agif324@#CmpNum#;
            |FINSI;
         |SINO;
            |SI #dscam003#57 = "EUR";
               #dscam013#21 = CambioBase;
               #dscam013#23 = CambioBase;
               nDeci_Div = 2;
            |FINSI;
         |FINSI;
         #dscam013#22 = #dscam003#31;

         |GRABA 020#dscam013.n; |LEE 000#dscam013.=;
         eaUsuario = Usuario % 0810;
         eaDescr   = "ALTA LINEA REMESA (" + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam013#1) % -103);
         eaDescr   = eaDescr + ") CON RECIBO (" + #dscam003#0 + "/" + #dscam003#1 + "/" + #dscam003#2 + ") DESDE MANTENIMIENTO";
         eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
         eaTipoOp  = "A";   enImpAnt = #dscam012#10;
         enImpAct = #dscam012#10 + #dscam013#7;
         |HAZ GrabaAudit;

         #dscam012#5 = #dscam012#5 + 1;
         #dscam012#10 = #dscam012#10 + #dscam003#65;
         #dscam012#11 = #dscam012#5 * #dscam012#6;
         #dscam012#12 = #dscam012#12 + #dscam013#10;
         |SI NumDias [ 0;
            #dscam012#13 = #dscam012#13 + #dscam003#65;
         |FINSI;
         |GRABA 020#dscam012.a;

         #dscam003#17 = #dscam013#0;
         #dscam003#37 = #dscam013#1;
         #dscam003#7  = #dscam014#1;
         #dscam003#26 = #dscam012#1;
         #dscam003#14 = "R";
         #dscam003#15 = "Remesado";
         #dscam003#53 = #dscam012#1;
         |SI #dscam051#75 = "S"; |Y #dscam003#90 = "N";
            #dscam003#90 = "S";

            |ABRE #dscam004;
            #dscam004#17 = #dscam013#16;
            #dscam004#3 = 99;
            |LEE 000#dscam004.];
            |SI FSalida ! 0;
               |LEE 000#dscam004.u;
               |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
                  LinCob = #dscam004#3 + 1;
               |SINO;
                  LinCob = 1;
               |FINSI;
            |SINO;
               |SI #dscam004#17 = #dscam013#16;
                  LinCob = #dscam004#3 + 1;
               |SINO;
                  |LEE 000#dscam004.a;
                  |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16;
                     LinCob = #dscam004#3 + 1;
                  |SINO;
                     LinCob = 1;
                  |FINSI;
               |FINSI;
            |FINSI;
            |DDEFECTO #dscam004;
            #dscam004#17 = #dscam013#16;
            #dscam004#15 = #dscam003#27;
            #dscam004#0  = #dscam003#0;
            #dscam004#1  = #dscam003#1;
            #dscam004#2  = #dscam003#2;
            #dscam004#3  = LinCob;
            #dscam004#4  = #dscam013#6;
            #dscam004#5  = "PRE";
            #dscam004#6  = ~;
            #dscam004#7  = #dscam003#23;
            #dscam004#8  = #dscam003#31;
            #dscam004#25 = #dscam003#61;
            #dscam004#26 = #dscam003#65;
            #dscam004#11 = #dscam003#13;
            #dscam004#33 = #dscam003#59;
            #dscam004#43 = 0;
            #dscam004#44 = #dscam003#31;
            #dscam004#45 = #dscam004#44 * #dscam004#33;
            #dscam004#46 = 0;
            #dscam004#47 = 0;
            |GRABA 020#dscam004.n; |LEE 000#dscam004.=
            |CIERRA #dscam004;
         |FINSI;
         |SI #dscam051#133 = "S";
              #dscam003#51 = #dscam012#2;
              #dscam003#52 = #dscam012#3;
         |FINSI;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |FINSI;
      eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscam003#40; |HAZ ProcesaTempo;
   |FINSI;

   |SI Linea > 999;
      |MENAV "    La remesa creada ha llegado al maximo de lineas. No se crearan mas lineas.";
      |ERROR10;
   |FINSI;
|FPRC;
/* JUAN
|DEFBUCLE BucleRecibos;
#dscam003#2;
27, 0, 1, 4, 5, 32, 35, 65;
#0#28, #0#55, #0#20, aDSerie, #0#24, #0#26, #0#32, #0#52, #0#57, nDImpor;
#0#29, #0#56, #0#21, aHSerie, #0#25, #0#27, #0#33, #0#53, #0#58, nHImpor;
be;
NULL,BucleRecibos;
|FIN;

|DEFBUCLE BucleRecibos1;
#dscam003#2;
72, 27, 0, 1, 71, 5, 32, 35;
#0#26, #0#55,  "   !", #0#20, aDSerie, #0#24, #0#28, #0#32, #0#52, #0#57;
#0#27, #0#56,  "zzzz", #0#21, aHSerie, #0#25, #0#29, #0#33, #0#53, #0#58;
be;
NULL,BucleRecibos;
|FIN;
*/
|DEFBUCLE BucleRecibos;
#dscam003#6;
4,3,5,32,35,65;
#0#20,aDSerie,#0#24,000," ",#0#55,#0#26,#0#28,#0#32,#0#52,#0#57, nDImpor;
#0#21,aHSerie,#0#25,999,"z",#0#56,#0#27,#0#29,#0#33,#0#53,#0#58, nHImpor;
be;
NULL,NULL,NULL,NULL,NULL,BucleRecibos;
#dscam003#3;
|FIN;

|DEFBUCLE BucleRecibos1;
#dscam003#7;
27,0,1,69,4,71,5,32,35;
"   !","          ",#0#55,#0#20,aDSerie,#0#24," ",#0#26,#0#28,#0#32,#0#52,#0#57;
"zzzz","zzzzzzzzzz",#0#56,#0#21,aHSerie,#0#25," ",#0#27,#0#29,#0#33,#0#53,#0#58;
be;
NULL,NULL,NULL,NULL,NULL,BucleRecibos;
#dscam003#3;
|FIN;


|PROCESO PasaDatosBanco;
   #dscam014#0 = #dscaz011#Contador#;
   |LEE 000#dscam014.=;
   |SI FSalida = 0;
      #dscam012#2  = #dscaz011#Contador#; || Codigo Banco
      #dscam012#3  = #dscam014#1;         || Nombre Banco
      #dscam012#6  = #dscam014#16;        || Comision por efecto
      #dscam012#14 = #dscam014#10;        || Cuenta Contable Banco
      #dscam012#15 = #dscam014#11;        || Digito Banco
      #dscam012#16 = #dscam014#34;        || Entidad Banco
      #dscam012#17 = #dscam014#35;        || Sucursal Banco
      #dscam012#18 = #dscam014#37;        || Cuenta Banco
      #dscam012#19 = #dscam014#36;        || Digito Control Banco
   |FINSI;
|FPRC;

|PROCESO CreaRemesas; |TIPO 3;
   |HAZ EsOTP; nSwOTP = FSalida;

   nSwLuxe = 0;
   |HAZ EsLuxe;
   |SI FSalida = 0; nSwLuxe = 1; |FINSI;

   aAlfa = "le" + Usuario; |NOME_DAT #dscaw116#aAlfa#;
   |DELINDEX #dscaw116; |ABRE #dscaw116;

   |ABRE #dscam014;
   |ABRE #dscam012;
   |ABRE #dscam013;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 000#dscam051.c;
   |FINSI;
   |CIERRA #dscam051;

   |ABRE #dscam062;
   NumBanco = 0;
   |PARA Contador = 36; |SI Contador [ 50; |HACIENDO Contador = Contador + 2;
      TotalRemesa = 0;
      Campo1 = Contador + 1;
      LimiteRemesa = #dscaz011#Campo1#;
      |SI LimiteRemesa ! 0;
         /*
         |DDEFECTO #dscam012;
         |LEE 000#dscam012.u;
         |SI FSalida = 0;
            #dscaz011#0 = #dscam012#0 + 1;
         |SINO;
            #dscaz011#0 = 1;
         |FINSI;
         |SI nNumRemesa = 0; nNumRemesa = #dscaz011#0; |FINSI;
         |DDEFECTO #dscam012;
         #dscam012#0 = #dscaz011#0;
         */

         |HAZ ContaRemesa;
         #dscaz011#0 = #dscam012#0;
         |SI nNumRemesa = 0; nNumRemesa = #dscaz011#0; |FINSI;

         |GRABA 020#dscam012.b;
         #dscam012#1 = #dscaz011#1;
         |SI #dscaz011#61 = "R";
            #dscam012#22 = 2;
         |SINO;
            #dscam012#22 = 4;
         |FINSI;
         |SI nSwOTP = 0; #dscam012#22 = 1; |FINSI;
         |SI enSinac= 1; #dscam012#22 = 2; |FINSI;

         |HAZ PasaDatosBanco;
         Linea = 1;
         |SI #dscaz011#59 = 0;
              aDSerie = #dscaz011#22;
              aHSerie = #dscaz011#23;
         |SINO;
              aDSerie = "     ";
              aHSerie = "zzzzz";
         |FINSI;
         nDImpor = 0; nHImpor = 999999999999;
         |SI #dscaz011#61 = "R"; |BUCLE BucleRecibos;  |FINSI;
         |SI #dscaz011#61 = "P"; |BUCLE BucleRecibos1; |FINSI;
         |SI #dscam012#5 = 0;
            |BORRA 020#dscam012.a;
            aAlfa = "    Seleccion vacia. No se creara la remesa"; |MENAV aAlfa;
            |LEE 000#dscaw116.p;
            |SI FSalida = 0;
               aAlfa = "    NHan habido documentos que no han entrado en la selecci¢n. " + &191 + " Ver informe ?";
               |CONFI aAlfa;
               |SI FSalida = 0;
                  |IMPRE 0;
                  |SI FSalida = 0;
                     |INFOR "dscaw116";
                     |SI FSalida = 0;
                        |BUCLE LinsInforme;
                        |PIEINF; |FININF;
                     |FINSI;
                     |FINIMP;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            aAlfa = "    Remesa " + nNumRemesa + " creada satisfactoriamente"; |MENAV aAlfa;

            |LEE 000#dscaw116.p;
            |SI FSalida = 0;
               aAlfa = "    NHan habido documentos que no han entrado en la nueva remesa. " + &191 + " Ver informe ?";
               |CONFI aAlfa;
               |SI FSalida = 0;
                  |IMPRE 0;
                  |SI FSalida = 0;
                     |INFOR "dscaw116";
                     |SI FSalida = 0;
                        |BUCLE LinsInforme;
                        |PIEINF; |FININF;
                     |FINSI;
                     |FINIMP;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
         |LIBERA #dscam012;
      |FINSI;
      NumBanco = NumBanco + 1;
   |SIGUE;
   |CIERRA #dscam012;
   |CIERRA #dscam013;
   |CIERRA #dscam062;
   |CIERRA #dscam014;

   |CIERRA #dscaw116; |DELINDEX #dscaw116;
   eaSesion   = Usuario; |HAZ LimpiaTempo;
|FPRC;

|PROCESO Avanza;
   |SI FSalida = 5;
      |POSICIONATE  #dscaz011#36;
   |FINSI;
|FPRC;

|PROCESO TomaDatos;
   |SI #dscaz011#62 = "N";
      #dscaz011#28 = #dscaz011#1;
      |C_M #dscaz011#28, 1, "N";
   |SINO;
      |C_M #dscaz011#28, 1, "S";
   |FINSI;
   |PINTA #dscaz011#28;
|FPRC;
