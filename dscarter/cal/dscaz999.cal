|FICHEROS;
   dscaz999 #0;

   dscam003 #1;
   dscamrec #2;

   dscam044 #20;
   dscam045 #21;

   agifa010@ #1000;
   agis0002@ #1001;
   agifa024@ #1002;
   agifa025@ #1003;
   agifa324@ #1004;
   dsm00003@ #1005;
|FIN;

|VARIABLES;
   &aCPath  = "";
   &aCNome  = "";

   nSwErr = 0;
   nLinea = 0;
   nEmpresa = 0;

   aAlfa  = "";
   nSwJamaica = 0;
|FIN;

|PROCESO EsJamaica;
     aAlfa = #dscam044#1; |QBF aAlfa;
     aAlfa = aAlfa + "def/cafe0001.mas";
     |XABRE "E", aAlfa, 0;
|FPRC;

|PROCESO GrabaTmp;
      |DDEFECTO #dscamrec;
      #dscamrec#1  = #agifa010@#52;
      #dscamrec#2  = #agifa010@#0;
      #dscamrec#3  = #agis0002@#18;
      #dscamrec#4  = #agis0002@#8;
      #dscamrec#5  = #agis0002@#7;
      #dscamrec#6  = #agis0002@#12;
      #dscamrec#7  = #agis0002@#3;
      #dscamrec#8  = #agis0002@#4;
      #dscamrec#9  = #agifa024@#32;
      #dscamrec#10 = #agifa024@#33;
      #dscamrec#11 = #agifa024@#31;
      #dscamrec#12 = #agifa024@#30;
      #dscamrec#13 = #agis0002@#22;
      #dscamrec#15 = #agis0002@#9;
      #dscamrec#16 = #agis0002@#15;
      #dscamrec#17 = #agis0002@#6;
      #dscamrec#18 = #agis0002@#2;
      #dscamrec#19 = #agifa025@#0;
      #dscamrec#20 = #agifa025@#1;
      #dscamrec#21 = #agifa024@#3;
      #dscamrec#22 = nLinea; nLinea = nLinea + 1;
      #dscamrec#25 = #dscam045#0;
      #dscamrec#27 = "V";
      #dscamrec#28 = "A";
      #dscamrec#29 = #agifa324@#0;
      #dscamrec#30 = #agifa324@#1;
      #dscamrec#31 = #agifa010@#74;
      #dscamrec#32 = #agifa010@#69;
      #dscamrec#33 = #agifa024@#203;
      #dscamrec#34 = 0;
      #dscamrec#35 = "A";
      #dscamrec#36 = #agis0002@#28;
      #dscamrec#37 = #agis0002@#31;
      #dscamrec#38 = #agis0002@#16;
      #dscamrec#39 = #agis0002@#10;
      #dscamrec#42 = #dsm00003@#1;
      #dscamrec#43 = #dsm00003@#10;
      |GRABA 020#dscamrec.n;
|FPRC;

|PROCESO AlbaranesVta;
   |SI #agifa010@#52 < #dscaz999#0; |O #agifa010@#52 > #dscaz999#3; |ACABA; |FINSI;


   |SI nSwJamaica = 0;

   |SINO;
      |SI #agifa010@#61 [ 0; |ACABA; |FINSI;
   |FINSI;

   nSwErr = 1;
/*
   #dscam003#27 = 0;
   #dscam003#0  = #agifa010@#52;
   #dscam003#1  = #agifa010@#0;
   #dscam003#2  = 0;
   #dscam003#69 = "A";
   #dscam003#40 = 1;
   |LEE 000#dscam003.];
   |PARA; |SI FSalida = 0; |Y #dscam003#27 = 0; |Y #dscam003#0  = #agifa010@#52;
      |Y #dscam003#1  = #agifa010@#0; |Y #dscam003#69 = "A"; |HACIENDO;
      |SI #dscam003#4 = #agifa010@#1; nSwErr = 0; |SAL; |FINSI;
      |LEE 000#dscam003.s;
   |SIGUE;
*/

   #dscam003#27 = 0;
   #dscam003#0  = #agifa010@#52;
   #dscam003#1  = #agifa010@#0;
   #dscam003#2  = 0;
   #dscam003#69 = "A";
   #dscam003#40 = 1;
   |LEE 000#dscam003.];
   |PARA; |SI FSalida = 0;
          |Y #dscam003#27 = 0;
          |Y #dscam003#0  = #agifa010@#52;
          |Y #dscam003#1  = #agifa010@#0; |HACIENDO;

      |SI #dscam003#69 = "A";
          |SI nSwJamaica = 0;
               nSwErr = 0; |SAL;
          |SINO;
               |SI #dscam003#4 = #agifa010@#1;
                     nSwErr = 0; |SAL;
               |FINSI;
          |FINSI;
      |FINSI;
      |LEE 000#dscam003.s;
   |SIGUE;


   |SI nSwErr = 0; |ACABA; |FINSI;

   #agifa024@#0 = #agifa010@#3;
   |LEE 000#agifa024@.=;
   |SI FSalida ! 0; |DDEFECTO #agifa024@; |FINSI;

   #agifa025@#0 = #agifa010@#6;
   |LEE 000#agifa025@.=;
   |SI FSalida ! 0; |DDEFECTO #agifa025@; |FINSI;

   #agifa324@#0 = #agifa010@#68;
   |LEE 000#agifa324@.=;
   |SI FSalida ! 0; |DDEFECTO #agifa324@; |FINSI;

   #dsm00003@#0 = #agifa010@#3;
   #dsm00003@#1 = #agifa010@#84;
   |LEE 000#dsm00003@.=;
   |SI FSalida ! 0; |DDEFECTO #dsm00003@; |FINSI;

   #agis0002@#30 = "A";
   #agis0002@#20 = #agifa010@#52;
   #agis0002@#17 = #agifa010@#0;
   #agis0002@#18 = 0;
   |LEE 000#agis0002@.];
   |PARA; |SI FSalida = 0; |Y #agis0002@#30 = "A";
           |Y #agis0002@#20 = #agifa010@#52;
           |Y #agis0002@#17 = #agifa010@#0; |HACIENDO;

      |SI nSwJamaica = 0;
          |SI #agis0002@#32 = "S";
               |HAZ GrabaTmp;
          |FINSI;
      |SINO;
          |HAZ GrabaTmp;
      |FINSI;

      |LEE 000#agis0002@.s;
   |SIGUE;
|FPRC;

|DEFBUCLE AlbaranesVta;
#agifa010@#4003;
;
#dscam045#4, #dscaz999#2, #dscaz999#1;
#dscam045#5, #dscaz999#5, #dscaz999#4;
;
NULL, AlbaranesVta;
|FIN;

|PROCESO RevisaAlba;
   #dscam044#0 = #dscam045#0;
   |LEE 000#dscam044.=;
   |SI FSalida = 0;
      aAlfa = #dscam044#1; |QBF aAlfa;
      aAlfa = aAlfa + "def/agifa010.mas";
      |CARGA_DEF aAlfa, agifa010@;
      |SI FSalida = 0;
         aAlfa = #dscam044#1; |QBF aAlfa;
         aAlfa = aAlfa + "def/agis0002.mas";
         |CARGA_DEF aAlfa, agis0002@;
         |SI FSalida = 0;
            aAlfa = #dscam044#1; |QBF aAlfa;
            aAlfa = aAlfa + "def/agifa024.mas";
            |CARGA_DEF aAlfa, agifa024@;
            |SI FSalida = 0;
               aAlfa = #dscam044#1; |QBF aAlfa;
               aAlfa = aAlfa + "def/agifa025.mas";
               |CARGA_DEF aAlfa, agifa025@;
               |SI FSalida = 0;
                  aAlfa = #dscam044#1; |QBF aAlfa;
                  aAlfa = aAlfa + "def/agifa324.mas";
                  |CARGA_DEF aAlfa, agifa324@;
                  |SI FSalida = 0;
                     aAlfa = #dscam044#1; |QBF aAlfa;
                     aAlfa = aAlfa + "def/dsm00003.mas";
                     |CARGA_DEF aAlfa, dsm00003@;
                     |SI FSalida = 0;
                        aAlfa = #dscam044#1; |QBF aAlfa;
                        aAlfa = aAlfa + "fich/" + (("00000" + #dscam044#0) % -105) + "/";
                        |PATH_DAT #agifa010@#aAlfa#; |ABRE #agifa010@;
                        |PATH_DAT #agis0002@#aAlfa#; |ABRE #agis0002@;
                        |PATH_DAT #agifa024@#aAlfa#; |ABRE #agifa024@;
                        |PATH_DAT #agifa025@#aAlfa#; |ABRE #agifa025@;
                        |PATH_DAT #agifa324@#aAlfa#; |ABRE #agifa324@;
                        |PATH_DAT #dsm00003@#aAlfa#; |ABRE #dsm00003@;

                        |HAZ EsJamaica; nSwJamaica = FSalida;

                        nLinea = 1; |BUCLE AlbaranesVta;

                        |CIERRA #dsm00003@; |DESCARGA_DEF #dsm00003@;
                        |CIERRA #agifa324@; |DESCARGA_DEF #agifa324@;
                        |CIERRA #agifa025@; |DESCARGA_DEF #agifa025@;
                        |CIERRA #agifa024@; |DESCARGA_DEF #agifa024@;
                        |CIERRA #agis0002@; |DESCARGA_DEF #agis0002@;
                        |CIERRA #agifa010@; |DESCARGA_DEF #agifa010@;
                     |FINSI;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE RevisaAlba;
#dscam045#2;
2;
nEmpresa,"V";
nEmpresa,"V";
;
NULL, RevisaAlba;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA "Cotejo/recuperacion entregas a cuenta";

   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0; |Y #dscaz999#6 = "S";
      |DFICB aAlfa; |QBF aAlfa;
      |PATH_DAT #dscam044#aAlfa#; |PATH_DAT #dscam045#aAlfa#;
      |ABRE #dscam044; |ABRE #dscam003; |SELECT #6#dscam003;
      aAlfa = "te" + Usuario; |NOME_DAT #dscamrec#aAlfa#; aCNome = aAlfa;
      |DFICE aCPath; |QBF aCPath;
      |DELINDEX #dscamrec; |ABRE #dscamrec;

      nEmpresa = #48#0;
      |BUCLE RevisaAlba;

      |CIERRA #dscamrec;

      |SUB_EJECUTA "dsrecibo.tab";

      |DELINDEX #dscamrec;
      |CIERRA #dscam044; |SELECT #1#dscam003; |CIERRA #dscam003;
   |FINSI;
|FPRO;
