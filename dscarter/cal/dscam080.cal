|FICHEROS;
   dscam080 #0;

   dscaw054 #11;
   dscam077 #12;
   dscam038 #13;
   dscam037 #14;
   dscaw055 #15;
   dscam018 #16;
   dscam020 #17,MANTE;
   dscam078 #18;
   dscam003 #19;
   dscam097 #20;
   dscam051 #21;

   Referen@ #100;
|FIN;

|VARIABLES;
   nTecla = 0;
   nModo  = 0;
   nCalc  = 0;
   nCalc1 = 0;

   aAlfa    = "";
   &nDeci_Base = 0;
   &Divisa  = "";
   &NombreDiv = "";
|FIN;

|PROCESO VuelcaAlOtro;
   #dscaw055#0 = #Referen@#0;
   |LEE 000#dscaw055.=;
   |SI FSalida ! 0;
      #dscam037#0 = #Referen@#0;
      |LEE 000#dscam037.=;
      |SI FSalida ! 0; |DDEFECTO #dscam037; |FINSI;
      |DDEFECTO #dscaw055;
      #dscaw055#0 = #dscam037#0;
      #dscaw055#1 = #dscam037#1;
      |GRABA 020#dscaw055.n;
   |FINSI;
|FPRC;

|DEFBUCLE VuelcaAlOtro;
#Referen@#1002;
;
00000,000;
99999,999;
;
NULL,VuelcaAlOtro;
|FIN;

|PROCESO MiraEmpresa;
   nTecla = FSalida;
   nModo = (FEntrada / 100) ! 0;
   |SI nTecla = 2; |ACABA; |FINSI;

   |DFICB aAlfa; |QBF aAlfa;
   |PATH_DAT #13 aAlfa; |PATH_DAT #14 aAlfa;
   |ABRE #dscam037; |ABRE #dscam038;
   |DFICE aAlfa; |QBF aAlfa; aAlfa = aAlfa % -106; aAlfa = aAlfa % 105;
   nCalc = aAlfa; aAlfa = nCalc;
   aAlfa = "SELECT * FROM dscam038 INTO em" + Usuario + ".def WHERE dscam038.5 == " + aAlfa;
   |SQL aAlfa;
   |SI FSalida = 0;
      aAlfa = FSalida; |QBF aAlfa; aAlfa = aAlfa % -102;
      |SI aAlfa ! ":0";
         |DBASE aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "def/em" + Usuario + ".mas";
         |CARGA_DEF aAlfa, Referen@;
         |SI FSalida = 0;
            aAlfa = "ec" + Usuario; |NOME_DAT #15 aAlfa;
            |DELINDEX #dscaw055; |ABRE #dscaw055;
            |BUCLE VuelcaAlOtro;

            #dscaw055#0 = #dscam080#3;
            |SI nModo = 4;
               |LEE 000#dscaw055.];
            |SINO;
               |SI nTecla = 10;
                  |LEE 000#dscaw055.];
                  |CONSULTA_CLAVE #1#dscaw055;
                  |SI FSalida = 0;
                     #dscam080#3 = #dscaw055#0; |PINTA #dscam080#3;
                     |PINTA 0725, #dscaw055#1; |ERROR;
                  |FINSI;
               |FINSI;
               |LEE 000#dscaw055.=;
            |FINSI;
            |SI FSalida = 0;
               #dscam080#3 = #dscaw055#0; |PINTA #dscam080#3;
               |PINTA 0725, #dscaw055#1;
            |SINO;
               |MENAV "    Cliente inexistente"; |ERROR;
            |FINSI;
            |CIERRA #dscaw055;
            |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
         |FINSI;
         |DBASE aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "def/em" + Usuario + ".mas";
         |FBORRA aAlfa;
      |SINO;
         |MENAV "    Ninguna empresa de gestion relacionada con riesgos de cartera";
         |ERROR;
      |FINSI;
   |SINO;
      |MENAV "    No se encuentran los ficheros de configuracion de empresas";
      |ERROR; |ACABA;
   |FINSI;
   |CIERRA #dscam037; |CIERRA #dscam038;

|FPRC;

|PROCESO CalcTotal;
   #dscam080#17 =         #0#04 + #0#05;
   #dscam080#17 = #0#17 + #0#06 + #0#07 + #0#08 + #0#09 + #0#10;
   #dscam080#17 = #0#17 + #0#11 + #0#12 + #0#13 + #0#14 + #0#15;
   #dscam080#17 = #0#17 + #0#16; |PINTA #dscam080#17;

   #dscam080#25 =         #0#18 + #0#19 + #0#20 + #0#21 + #0#22;
   #dscam080#25 = #0#25 + #0#23 + #0#24; |PINTA #dscam080#25;

   #dscam080#26 = #dscam080#17 + #dscam080#25; |PINTA #dscam080#26;
|FPRC;

|PROCESO Dias;
   nCalc = #dscam077#5;
   nCalc = ((nCalc / 30) ! 0) + 4;
   |SI nCalc > 15; nCalc = 16; |FINSI;
   #dscam080#nCalc# = #dscam077#6;

   nCalc = #dscam077#7;
   nCalc = ((nCalc / 30) ! 0) + 4;
   |SI nCalc > 15; nCalc = 16; |FINSI;
   #dscam080#nCalc# = #dscam077#8;

   nCalc = #dscam077#9;
   nCalc = ((nCalc / 30) ! 0) + 4;
   |SI nCalc > 15; nCalc = 16; |FINSI;
   #dscam080#nCalc# = #dscam077#10;

   #dscam080#16 = #dscam077#16;
|FPRC;

|DEFBUCLE Dias;
#dscam077#1;
;
#dscam080#0, #dscam080#1, #dscam080#2, "      ";
#dscam080#0, #dscam080#1, #dscam080#2, "zzzzzz";
;
NULL,Dias;
|FIN;

|PROCESO TomaDatos;
   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 1;
      |ABRE #dscaw054;
      |LEE 000#dscaw054.p;
      |SI FSalida = 0;
         |DDEFECTO #dscaw054; |GRABA 020#dscaw054.c;
      |FINSI;

      |PUSHV 0501 2380;
      |PINPA #0#dscaw054; |PINDA #0#dscaw054;
      |ENDATOS #1#dscaw054;
      |SI FSalida = 0;
         |GRABA 020#dscaw054.a;
         |PDEFECTO #dscam080,4,18;
         |BUCLE Dias;
      |FINSI;
      |POPV;
   |FINSI;
|FPRC;

|PROCESO Tipo8m80; |TIPO 8;
  |HAZ Tipo8;
  Divisa = NombreDiv; |HAZ TomaDecim;
|FPRC;

|PROCESO Imprime; |TIPO 4;
   |ABRE #dscam018; |ABRE #dscam020;

   #dscam018#0 = #dscam080#0;
   |LEE 000#dscam018.=;
   |SI FSalida ! 0; |DDEFECTO #dscam018; |FINSI;

   |IMPRE 0;
   |SI FSalida = 0;
      |INFOR "dscam080";
      |SI FSalida = 0;
         |PRINT;
         |PIEINF;
      |FINSI;
      |FININF;
   |FINSI;
   |FINIMP;

   |CIERRA #dscam018; |CIERRA #dscam020;
|FPRC;

|PROCESO Tipo13m80; |TIPO 13;
   |ABRE #dscam037;
   #dscam037#0 = #dscam080#3;
   |LEE 000#dscam037.=;
   |SI FSalida = 0;
      |PINTA 0725, #dscam037#1;
   |FINSI;
   |CIERRA #dscam037;
|FPRC;

|PROCESO Tipo3m80; |TIPO 3;
   |CONFI "0000S ¨Imprimir?";
   |SI FSalida = 0;
      |HAZ Imprime;
   |FINSI;
|FPRC;

|PROCESO RecogeMto;
   #dscam003#40 = #dscam078#14;
   |LEE 000#dscam003.=;
   |SI FSalida = 0; |Y #dscam003#46 = #dscam080#3;
      |SI #dscam051#76 = "N";
         nCalc  = #dscam078#9 - #dscam078#8;
      |SINO;
         nCalc = #dscam051#77;
      |FINSI;
      nCalc1 = (((((nCalc - 1) / 30) ! 0) - 0.49) ! 0) + 4;
      #dscam080#nCalc1# = #dscam080#nCalc1# + #dscam078#10;
   |FINSI;
|FPRC;

|DEFBUCLE RecogeMto;
#dscam078#1;
;
#dscam080#0, #dscam080#1, #dscam080#2, "      ",   1;
#dscam080#0, #dscam080#1, #dscam080#2, "zzzzzz", 999;
;
NULL,RecogeMto;
|FIN;

|PROCESO RecogeDatos;
   |SI FSalida = 2; |ACABA; |FINSI;

   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 1;
      |CONFI "    NRecoger datos del mantenimiento ? ";
      |SI FSalida = 0;
         |PDEFECTO #dscam080, 4, 17;
         |ABRE #dscam003;

         |ABRE #dscam051;
         |LEE 000#dscam051.p;
         |SI FSalida ! 0; |DDEFECTO #dscam051; |FINSI;
         |CIERRA #dscam051;

         |BUCLE RecogeMto;
         |HAZ CalcTotal;
         |PINDA #0#dscam080;
         |CIERRA #dscam003;
      |FINSI;
      |CONFI "    NRecoger datos de importes no asegurados ? ";
      |SI FSalida = 0;
         |PDEFECTO #dscam080, 18, 25;
         |ABRE #dscam097;
         #dscam097#0 = #dscam080#1;
         #dscam097#1 = #dscam080#2;
         |LEE 000#dscam097.=;
         |SI FSalida ! 0; |DDEFECTO #dscam097; |FINSI;
         #dscam080#18 = #dscam097#2;
         #dscam080#19 = #dscam097#3;
         #dscam080#20 = #dscam097#4;
         #dscam080#21 = #dscam097#5;
         #dscam080#22 = #dscam097#6;
         #dscam080#23 = #dscam097#7;
         #dscam080#24 = #dscam097#8;
         #dscam080#25 = #dscam097#9;
         |PINDA #0#dscam080;
         |CIERRA #dscam097;
      |FINSI;
   |FINSI;
|FPRC;
