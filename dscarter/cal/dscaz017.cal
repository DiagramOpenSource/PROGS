/* ***************************************************************************
 ****************************************************************************
 ***** ESTE  FICHERO ESTA  REPRODUCIDO  PARA  FUNCIONAR  EN  LUXE EN EL *****
 ***** FICHERO  LUXEZ001 PREPARADO PARA  EL MODULO DEL CLIENTE. EN CASO *****
 ***** DE TOCAR CUALQUIER COSA HAY QUE RETOCARLA TAMBIEN EN ESE PROCESO *****
 ****************************************************************************
 ****************************************************************************/

|FICHEROS;
   dscaz017 #0;

   dscam012 #1;
   dscam013 #2;
   dscam014 #3;
   dscam003 #4;
   dscam004 #5;

   dscaw013 #9,MANTE;
   dscam030 #10;
   dscam036 #11,MANTE;
   dscam051 #12;
   dscam068 #13;
   dscam067 #14;
   dscam093 #15,MANTE;
   dscam023 #16,MANTE;

   dscaw068 #100,MANTE;
   dscam066 #101;
   dscaw076 #102;

   Referen@ #1000;
   taglm01@ #1001;
|FIN;

|VARIABLES;
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = ""; &eaSesion = "";
   &eaFichClas = "";  &eaTipoClas = ""; &enSwClas = 0;
   &enRemesa = 1; &eaTipoRecibo = ""; &enBiAtri = 1;
   &eaTOperacion = ""; &enNumDocum = 0;

   nSwBloq       = 0;
   fFechaHoy     = @;
   &enFPago      = 0;
   &nCamFPago    = 0;
   &fFechaFac    = @;
   &fFecVto      = @;
   &eaCliente    = "";
   &enExistOblig = 0;

   SwDatos = 0; SwSerie = 0; nCont = 0;
   nNume = 0; fFecha = @; aAlfa = ""; aAlfa1 = ""; aAlfa2 = "";
   SwImp = 0;
   nCampo = 0; nContador = 0; nCampo1 = 0;
   aEntidad = ""; aNumero = "";

   Calc1 = 0; Calc2 = 0; NumDias = 0; Linea = 0;
   nMarca = 0; nNumero = 0; aMarca = "";
   nRemesa = 0; nCalc = 0;
   nRemExt = 0; nLinExt = 0; fFecExt = @;

   EmpreAnt = 0; PerioAnt = 0;
   Mensaje = 0; LinCob = 0; NumLinea = 0;

   fFechaAnt  = @; nRemesaAnt = 0;

   aCodEnlace = "";
   UltOp = ""; Opcion = 0;
   TipoDato = ""; LongDato = 0; &HayConta = 0;
   nSwDesdeFuera = 0;

   Empresa = 0;
   Salir = 0; Cont = 0;
   nSwErr = 0;

   nSwArtenvas = 0;

   nSwFVto = 0;

   nAgrupFecha = 0;

   Comodin = "";
   &enEmpCartera = 0;  &enEmpGestion = 0; &Divisa = "";
   &eaSerie      = ""; &eaCliGest    = "";
   &nImporte     = 0;  &eaTipoOper   = ""; &enBanco = 0;
   &nDeci_Div    = 0;  &nDeci_Base   = 0;

   &enSwCambioRem = 0;

{-1}Menu  = "";
    Menu1 = "2400";
    Menu2 = "1";
    Menu3 = "";
    Menu4 = "REC";
    Menu5 = " Revisar ";
    Menu6 = " Enlazar ";
    Menu7 = " Cancelar ";
    &enSwError = 0;
|FIN;

|PROCESO MiraHisCobro;
     enSwError = 0;
|FPRC;

|PROCESO LineasRem;
   |SI #dscam013#15 ! "S"; nSwErr = 1; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE LineasRem;
#dscam013#1;
;
#dscam012#0, 001;
#dscam012#0, 999;
;
NULL, LineasRem;
|FIN;

|PROCESO MarcaAbonada;
   #dscam012#0 = #dscaw076#0;
   |LEE 101#dscam012.=;
   |SI FSalida = 0;
      |SI #dscam012#22 = 1; |O #dscam012#22 = 3;
         nSwErr = 0; |BUCLE LineasRem;
         |SI nSwErr = 0;
            #dscam012#8 = "S"; |GRABA 020#dscam012.a;
         |FINSI;
      |FINSI;
      |LIBERA #dscam012;
   |FINSI;
|FPRC;

|DEFBUCLE MarcaAbonada;
#dscaw076#1;
;
INICIO;
FINAL;
;
NULL, MarcaAbonada;
|FIN;

|PROCESO EscogeFic;

         TipoDato = #dscaw013#11; LongDato = #dscaw013#12;
         |SI TipoDato = "A";
            |CAMPO_ANCHO #dscaw013#3,1,LongDato;
            |CAMPO_MAXIMO #dscaw013#3,1,"\ +#";
            |CAMPO_ANCHO #dscaw013#4,1,LongDato;
            |CAMPO_MAXIMO #dscaw013#4,1,"\ +#";
            |C_M #dscaw013#3,1,"S"; |C_V #dscaw013#3,1,"S"; |PINTA #dscaw013#3;
            |C_M #dscaw013#4,1,"S"; |C_V #dscaw013#4,1,"S"; |PINTA #dscaw013#4;
            |C_M #dscaw013#5,1,"N"; |C_V #dscaw013#5,1,"N";
            |C_M #dscaw013#6,1,"N"; |C_V #dscaw013#6,1,"N";
            |C_M #dscaw013#7,1,"N"; |C_V #dscaw013#7,1,"N";
            |C_M #dscaw013#8,1,"N"; |C_V #dscaw013#8,1,"N";
         |FINSI;
         |SI TipoDato = "N";
            |C_M #dscaw013#3,1,"N"; |C_V #dscaw013#3,1,"N";
            |C_M #dscaw013#4,1,"N"; |C_V #dscaw013#4,1,"N";
            |C_M #dscaw013#5,1,"S"; |C_V #dscaw013#5,1,"S"; |PINTA #dscaw013#5;
            |C_M #dscaw013#6,1,"S"; |C_V #dscaw013#6,1,"S"; |PINTA #dscaw013#6;
            |C_M #dscaw013#7,1,"N"; |C_V #dscaw013#7,1,"N";
            |C_M #dscaw013#8,1,"N"; |C_V #dscaw013#8,1,"N";
         |FINSI;
         |SI TipoDato = "F";
            |C_M #dscaw013#3,1,"N"; |C_V #dscaw013#3,1,"N";
            |C_M #dscaw013#4,1,"N"; |C_V #dscaw013#4,1,"N";
            |C_M #dscaw013#5,1,"N"; |C_V #dscaw013#5,1,"N";
            |C_M #dscaw013#6,1,"N"; |C_V #dscaw013#6,1,"N";
            |C_M #dscaw013#7,1,"S"; |C_V #dscaw013#7,1,"S"; |PINTA #dscaw013#7;
            |C_M #dscaw013#8,1,"S"; |C_V #dscaw013#8,1,"S"; |PINTA #dscaw013#8;
         |FINSI;
|FPRC;

|PROCESO TomaVal;
   |SI TipoDato = "A"; #dscaw013#9 = #dscaw013#3; #dscaw013#10 = #dscaw013#4; |FINSI;
   |SI TipoDato = "N"; #dscaw013#9 = #dscaw013#5; #dscaw013#10 = #dscaw013#6; |FINSI;
   |SI TipoDato = "F"; #dscaw013#9 = "   " + #dscaw013#7; #dscaw013#10 = "   "+ #dscaw013#8; |FINSI;

   |C_M #dscaw013#3,1,"N"; |C_V #dscaw013#3,1,"N";
   |C_M #dscaw013#4,1,"N"; |C_V #dscaw013#4,1,"N";
   |C_M #dscaw013#5,1,"N"; |C_V #dscaw013#5,1,"N";
   |C_M #dscaw013#6,1,"N"; |C_V #dscaw013#6,1,"N";
   |C_M #dscaw013#7,1,"N"; |C_V #dscaw013#7,1,"N";
   |C_M #dscaw013#8,1,"N"; |C_V #dscaw013#8,1,"N";
                           |C_V #dscaw013#9,1,"S";
                           |C_V #dscaw013#10,1,"S";
|FPRC;

|RUTINA infe1;
   #dscaw013#0 = 001;
   #dscaw013#15 = #dscaz017#5;
   #dscaw013#17 = "S";
|FRUT;

|RUTINA supe1;
   #dscaw013#0 = 999;
   #dscaw013#15 = #dscaz017#5;
   #dscaw013#17 = "S";
|FRUT;

|PROCESO RellenaAcot;
   |DDEFECTO #dscaw013;
   |PARA Cont = 0; |SI Cont [ 17; |HACIENDO Cont = Cont + 1;
      #dscaw013#Cont# = #dscam036#Cont#;
   |SIGUE;
   |GRABA 020#dscaw013.n;
|FPRC;

|DEFBUCLE RellenaAcot;
#dscam036#2;
;
#dscaz017#5,"S",001;
#dscaz017#5,"S",999;
;
NULL,RellenaAcot;
|FIN;
/*
|PROCESO MiraSiBloq1;
   |DDEF aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "taglm001.mas";
   |CARGA_DEF aAlfa, taglm01@;
   |SI FSalida = 0;
      |ABRE #taglm01@;
      aAlfa = #dscam003#80; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
      #taglm01@#0 = aAlfa;
      |LEE 000#taglm01@.=;
      |SI FSalida ! 0;
         |CIERRA #taglm01@; |DESCARGA_DEF #taglm01@;
         |ACABA;
      |FINSI;
      enFPago = #dscam003#80; eaCliente = #dscam003#32;
      nCamFPago = #dscam003#2 + 5;
      fFechaFac = #dscam003#4;
      |HAZ Vencimientos;
      |CIERRA #taglm01@; |DESCARGA_DEF #taglm01@;
      |SI #dscam003#14 = "P"; |O #dscam003#14 = "C";
         |SI fFecVto [ fFechaHoy; nSwBloq = 1; |ERROR10; |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE MiraSiBloq1;
#dscam003#15;
;
eaCliente, "            ", " ";
eaCliente, "zzzzzzzzzzzz", "z";
;
NULL,MiraSiBloq1;
|FIN;
*/
|PROCESO LineasRemesa;
   |SI #dscam013#6 > #dscaz017#4; |ACABA; |FINSI;

   |SI nLinExt ! 0;
      |SI #dscam013#1 ! nLinExt; |ACABA; |FINSI;
   |FINSI;

   |SI #dscaz017#6 = "S";
      SwSerie = 0;
      |PARA nCont = 7; |SI nCont [ 18; |HACIENDO nCont = nCont + 1;
         |SI #dscam013#4 = #dscaz017#nCont#; SwSerie = 1; |SAL; |FINSI;
      |SIGUE;
      |SI SwSerie = 0; |ACABA; |FINSI;
   |FINSI;

   #dscam003#40 = #dscam013#16;
   |LEE 101#dscam003.=;
   |SI FSalida ! 0;
      |ACABA;
   |SINO;
      |SI #dscam003#14 = "L";
         #dscam003#84 = "S"; |GRABA 020#dscam003.a;
      |FINSI;
      |LIBERA #dscam003;
   |FINSI;

   |SI #dscam013#15 = "S"; |O #dscam013#15 = "R"; |O #dscam013#15 = "I"; |ACABA; |FINSI;

   |SI #dscam051#3 = "S";
      #dscam004#17 = #dscam013#16;
      #dscam004#3 = #dscam013#17;
      |LEE 000#dscam004.=;
      |SI FSalida = 0; |Y #dscam004#5 = "REM";
         |LEE 000#dscam004.s;
         |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16; |Y #dscam004#5 = "IMP";
            SwImp = 1;
         |SINO;
            SwImp = 0;
         |FINSI;
      |FINSI;
      |SI SwImp = 0;
         enBanco = #dscam012#2;
         || enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
         enEmpCartera = -1;      enEmpGestion = #dscam003#46;
         eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
         nImporte = #dscam013#7;
         |SI #dscam012#22 = "1"; |O #dscam012#22 = "3";
            eaTipoOper = "-4";
         |SINO;
            eaTipoOper = "-6";
         |FINSI;
         |HAZ BucleRiesgo;
      |FINSI;
   |FINSI;

   |SI #dscam012#22 = 1; |O #dscam012#22 = 3;
      #dscam003#40 = #dscam013#16;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         #dscam004#17 = #dscam003#40;
         #dscam004#3 = 1;
         |LEE 000#dscam004.];
         |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
            LinCob = #dscam004#3 + 1;
            |LEE 000#dscam004.s;
         |SIGUE;
      |SINO;
         LinCob = 1;
      |FINSI;

      |DDEFECTO #dscam004;
      #dscam004#17 = #dscam003#40;
      #dscam004#15 = #dscam013#2;
      #dscam004#0  = #dscam013#4;
      #dscam004#1  = #dscam013#3;
      #dscam004#2  = #dscam013#5;
      #dscam004#3  = LinCob;
      #dscam004#4  = #dscam012#14;
      #dscam004#5  = "REM";
      ||ABDON   14/06/2013     Tiquet 000160/00851
      ||#dscam004#6  = #dscam012#1;
      |SI nSwArtenvas = 1;
         |SI #dscaz017#20 ! "01.01.0000";
            #dscam004#6 = #dscaz017#20;
         |SINO;
            #dscam004#6 = #dscam003#3;
         |FINSI;
      |SINO;
         #dscam004#6  = #dscam012#1;
      |FINSI;
      #dscam004#7  = #dscam003#23; #dscam004#25  = #dscam003#61;
      #dscam004#8  = #dscam013#22; #dscam004#26  = #dscam013#7;
      #dscam004#9  = 0;
      #dscam004#10 = 0;
      #dscam004#33 = #dscam003#59;
      |GRABA 020#dscam004.n;
      #dscam013#17 = LinCob; |GRABA 020#dscam013.a;
      || Actualizo el recibo
      #dscam003#40 = #dscam013#16;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         #dscam066#0 = #dscam003#40;
         |LEE 000#dscam066.=;
         |SI FSalida = 0; |BORRA 020#dscam066.a; |FINSI;
         ||ABDON   14/06/2013     Tiquet 000160/00851
         ||#dscam003#26 = #dscam012#1;
         |SI nSwArtenvas = 1;
            |SI #dscam012#22 ] 1; |Y #dscam012#22 [ 4;
               |SI #dscam012#22 = 1; |O #dscam012#22 = 3;
                  |SI #dscaz017#20 ! "01.01.0000";
                     #dscam003#26 = #dscaz017#20;
                  |SINO;
                     #dscam003#26 = #dscam003#3;
                  |FINSI;
               |SINO;
                  #dscam003#26 = #dscam003#3;
               |FINSI;
            |SINO;
               #dscam003#26 = #dscam012#1;
            |FINSI;
         |SINO;
            #dscam003#26 = #dscam012#1;
         |FINSI;
         #dscam003#23 = #dscam003#23 + #dscam013#22; #dscam003#61 = #dscam003#61 + #dscam013#7;
         #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
         #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
         #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
         #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
         aAlfa = #dscam003#31; |QBF aAlfa; nCalc = aAlfa;
         #dscam003#31 = #dscam003#30 - #dscam003#23;
         #dscam003#65 = #dscam003#64 - #dscam003#61;
         |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
            |SI #dscam003#31 = 0;
               #dscam003#14 = "e"; #dscam003#15 = "Pendiente de compensar";
            |FINSI;
         |SINO;
            |SI #dscam003#31 = 0;
               #dscam003#14 = "L"; #dscam003#15 = "Recibo liquidado";
            |SINO;
               #dscam003#14 = "C"; #dscam003#15 = "Parcialmente cobrado";
            |FINSI;
         |FINSI;
         #dscam003#84 = "S";
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |FINSI;
/*
      |HAZ EsTagloma;
      |SI FSalida = 0;
         nSwBloq = 0; fFechaHoy = ~;
         |ABRE #dscam023;
         #dscam023#0 = #dscam003#32;
         |LEE 000#dscam023.=;
         |SI FSalida = 0; |Y #dscam023#9 = "S";
            eaCliente = #dscam003#32; |BUCLE MiraSiBloq1;
            |SI nSwBloq = 0;
               #dscam023#0 = eaCliente;
               |LEE 101#dscam023.=;
               |SI FSalida = 0;
                  #dscam023#9 = "A";
                  #dscam023#10 = "AUTOMATICO";
                  |GRABA 020#dscam023.a; |LIBERA #dscam023;
               |FINSI;
            |FINSI;
         |FINSI;
         |CIERRA #dscam023;
      |FINSI;
*/
      eaCliente = #dscam003#32; |HAZ MiraBloqueoRiesgo;
   |FINSI;

   |SI enSwCambioRem = 1;
      #dscam013#17 = LinCob; |GRABA 020#dscam013.a;

      || Actualizo el recibo
      #dscam003#40 = #dscam013#16;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         #dscam066#0 = #dscam003#40;
         |LEE 000#dscam066.=;
         |SI FSalida = 0; |BORRA 020#dscam066.a; |FINSI;
         ||ABDON   14/06/2013     Tiquet 000160/00851
         ||#dscam003#26 = #dscam012#1;
         |SI #dscam012#22 ] 1; |Y #dscam012#22 [ 4;
            |SI #dscam012#22 = 1; |O #dscam012#22 = 3;
               |SI #dscaz017#20 ! "01.01.0000";
                  #dscam003#26 = #dscaz017#20;
               |SINO;
                  #dscam003#26 = #dscam003#3;
               |FINSI;
            |SINO;
               #dscam003#26 = #dscam003#3;
            |FINSI;
         |SINO;
            #dscam003#26 = #dscam012#1;
         |FINSI;
         #dscam003#23 = #dscam003#23 + #dscam013#22; #dscam003#61 = #dscam003#61 + #dscam013#7;
         #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
         #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
         #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
         #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
         aAlfa = #dscam003#31; |QBF aAlfa; nCalc = aAlfa;
         #dscam003#31 = #dscam003#30 - #dscam003#23;
         #dscam003#65 = #dscam003#64 - #dscam003#61;
         |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
            |SI #dscam003#31 = 0;
               #dscam003#14 = "e"; #dscam003#15 = "Pendiente de compensar";
            |FINSI;
         |SINO;
            |SI #dscam003#31 = 0;
               #dscam003#14 = "L"; #dscam003#15 = "Recibo liquidado";
            |SINO;
               #dscam003#14 = "C"; #dscam003#15 = "Parcialmente cobrado";
            |FINSI;
         |FINSI;
         #dscam003#84 = "S";
         |GRABA 020#dscam003.a; |LIBERA #dscam003;

         eaCliente = #dscam003#32; |HAZ MiraBloqueoRiesgo;
      |FINSI;
   |FINSI;

   |SI nSwArtenvas = 1;
      |SI #dscam012#22 = 2; |O #dscam012#22 = 4;
         #dscam003#40 = #dscam013#16;
         |LEE 101#dscam003.=;
         |SI FSalida = 0;
            #dscam003#26 = #dscam003#3;
            |GRABA 020#dscam003.a; |LIBERA #dscam003;
         |FINSI;
      |FINSI;
   |FINSI;

   #dscam013#15 = "S"; |GRABA 020#dscam013.a;

   eaUsuario = Usuario % 0810;
   eaDescr   = "VENCIMIENTO LINEA REMESA (" + (("00000" + #dscam012#0) % -105) + "/" + (("000" + #dscam013#1) % -103) + ") CON RECIBO ";
   eaDescr   = eaDescr + #dscam003#0 + "/" + #dscam003#1 + "/" + #dscam003#2;
   eaTipoReg = "RE";  eaNumero = ("00000" + #dscam012#0) % -105;
   eaTipoOp  = "V";   enImpAct = #dscam012#10; enImpAnt = #dscam012#10;
   |HAZ GrabaAudit;

|FPRC;

|DEFBUCLE LineasRemesa;
#dscam013#1;
;
#dscam012#0,001;
#dscam012#0,999;
be;
NULL,LineasRemesa;
|FIN;

|PROCESO MiraSeries;
   |PARA nCampo1 = 7; |SI nCampo1 [ 18; |HACIENDO nCampo1 = nCampo1 + 1;
      nContador = 0; aAlfa1 = #dscaz017#nCampo1#;
      |PARA nCampo = 7; |SI nCampo [ 18; |HACIENDO nCampo = nCampo + 1;
         aAlfa  = #dscaz017#nCampo#;
         |SI aAlfa = aAlfa1; nContador = nContador + 1; |FINSI;
      |SIGUE;
      |SI nContador > 1; |Y aAlfa1 ! "zzzzz"; |ERROR; |SAL; |FINSI;
   |SIGUE;
|FPRC;

|PROCESO BajaRemesa;
   #dscam012#0 = #dscaw076#0;
   |LEE 000#dscam012.=;
   |SI FSalida ! 0; |ACABA; |FINSI;
   |SI #dscam012#1 < #dscaz017#2; |O #dscam012#1 > #dscaz017#3; |ACABA; |FINSI;
   |SI #dscam012#22 = 6; |O #dscam012#22 = 7; |ACABA; |FINSI;

   |SI #dscam012#22 = 2; |O #dscam012#22 = 4; |O #dscam012#22 = 5;
      |SI #dscam012#8 = "N"; |ACABA; |FINSI;
   |SINO;
      |SI #dscam012#23 = "N"; |ACABA; |FINSI;
   |FINSI;

   Divisa = "EUR"; |HAZ TomaDecim;

   |SI HayConta = 1; |Y #dscam051#1 = "S";
      |ABRE #dscam067;
      #dscam067#0 = "RM";
      #dscam067#1 = #dscam012#0;
      #dscam067#2 = 1;
      #dscam067#3 = "E";
      |LEE 000#dscam067.];
      nNume = #dscam067#1;
      |SI FSalida = 0; |Y #dscam067#0 = "RM"; |Y nNume = #dscam012#0;
       |Y #dscam067#3 = "E";
         #dscam030#0 = #dscaz017#5;
         |LEE 000#dscam030.=;
         |SI FSalida = 0;
            EmpreAnt = #dscam030#4; PerioAnt = #dscam030#5;
            #dscam030#4 = #dscam067#8; #dscam030#5 = #dscam067#9;
            |GRABA 020#dscam030.a;
         |FINSI;
      |SINO;
         #dscam030#0 = #dscaz017#5;
         |LEE 000#dscam030.=; EmpreAnt = -1;
      |FINSI;
      |CIERRA #dscam067;

      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #9 Comodin;
      |DELINDEX #dscaw013; |ABRE #dscaw013;
      Comodin = #dscaz017#5;
      |SI Comodin = "    ";
         |ABRE #dscam093;
         #dscam093#0 = "V";
         |LEE 000#dscam093.=;
         |SI FSalida = 0;
            |SI #dscam012#22 = 1; Comodin = #dscam093#1; |FINSI;
            |SI #dscam012#22 = 2; Comodin = #dscam093#3; |FINSI;
            |SI #dscam012#22 = 3; Comodin = #dscam093#5; |FINSI;
            |SI #dscam012#22 = 4; Comodin = #dscam093#7; |FINSI;
            |SI #dscam012#22 = 5; Comodin = #dscam093#9; |FINSI;
         |FINSI;
         |CIERRA #dscam093;
      |FINSI;

      |DDEFECTO #dscaw013;
      #dscaw013#0  = 1;            #dscaw013#5  = #dscam012#0;
      #dscaw013#6  = #dscam012#0;  #dscaw013#11 = "N";
      #dscaw013#12 = 5;            #dscaw013#13 = "dscam013";
      #dscaw013#14 = 0;            #dscaw013#15 = Comodin;
      |GRABA 020#dscaw013.n;

      |DDEFECTO #dscaw013;
      #dscaw013#0  = 2;            #dscaw013#7  = "01.01.1900";
      #dscaw013#8  = #dscaz017#4;  #dscaw013#11 = "F";
      #dscaw013#12 = 10;           #dscaw013#13 = "dscam013";
      #dscaw013#14 = 6;            #dscaw013#15 = Comodin;
      |GRABA 020#dscaw013.n;

      |SI nSwDesdeFuera = 0;
         |DDEFECTO #dscaw013;
         #dscaw013#0  = 3;            #dscaw013#3  = "N";
         #dscaw013#4  = "N";          #dscaw013#11 = "A";
         #dscaw013#12 = 1;            #dscaw013#13 = "dscam013";
         #dscaw013#14 = 15;           #dscaw013#15 = Comodin;
         |GRABA 020#dscaw013.n; NumLinea = NumLinea + 1;
      |SINO;
         |DDEFECTO #dscaw013;
         #dscaw013#0  = 3;            #dscaw013#5  = nLinExt;
         #dscaw013#6  = nLinExt;      #dscaw013#11 = "N";
         #dscaw013#12 = 3;            #dscaw013#13 = "dscam013";
         #dscaw013#14 = 1;            #dscaw013#15 = Comodin;
         |GRABA 020#dscaw013.n; NumLinea = NumLinea + 1;
      |FINSI;

      |SI #dscaz017#6 = "S";
         |PARA nCont = 7; |SI nCont [ 18; |HACIENDO nCont = nCont + 1;
            |SI #dscaz017#nCont# ! "zzzzz";
               |DDEFECTO #dscaw013;
               #dscaw013#0  = nCont - 3;    #dscaw013#3  = "";
               #dscaw013#3 = #dscaz017#nCont#; #dscaw013#4 = #dscaz017#nCont#;
               #dscaw013#11 = "A";
               #dscaw013#12 = 5;            #dscaw013#13 = "dscam013";
               #dscaw013#14 = 4;            #dscaw013#15 = Comodin;
               #dscaw013#18 = "C";
               |GRABA 020#dscaw013.c;
            |FINSI;
         |SIGUE;
      |FINSI;
      |CIERRA #dscaw013;

      Comodin = #dscaz017#5;
      |SI Comodin = "    ";
         |ABRE #dscam093;
         #dscam093#0 = "V";
         |LEE 000#dscam093.=;
         |SI FSalida = 0;
            |SI #dscam012#22 = 1; Comodin = #dscam093#1; |FINSI;
            |SI #dscam012#22 = 2; Comodin = #dscam093#3; |FINSI;
            |SI #dscam012#22 = 3; Comodin = #dscam093#5; |FINSI;
            |SI #dscam012#22 = 4; Comodin = #dscam093#7; |FINSI;
            |SI #dscam012#22 = 5; Comodin = #dscam093#9; |FINSI;
         |FINSI;
         |CIERRA #dscam093;
      |FINSI;
      |SI #dscaz017#20 ! "01.01.0000";
         Comodin = "dscam033.tab;" + Comodin + ",V" + #dscaz017#20;
      |SINO;
         Comodin = "dscam033.tab;" + Comodin + ",V" + #dscaz017#4;
      |FINSI;
      |SI PARAMETRO ! "";
         Comodin = Comodin + "|" + aAlfa;
         |PUSHV 1227 1453;
         |BLANCO 1227 1453;
         |CUADRO 1227 1453;
         aAlfa1 = " Procesando remesa " + (("00000" + #dscam012#0) % -105) + " ";
         |ATRI R; |PINTA 1328, aAlfa1; |ATRI N;
      |FINSI;

      |LIBERA #dscam012; |CIERRAT #dscam012;
      |SUB_EJECUTA_NP "dscaz169.tab;INICIO";
      |SUB_EJECUTA_NP Comodin;
      |SUB_EJECUTA_NP "dscaz169.tab;FINAL";
      |ABRET #dscam012; |LEE 101#dscam012.=;

      aAlfa1 = aAlfa; |QBF aAlfa1; aAlfa1 = aAlfa1 + "ac" + Usuario + ".dat"; |FBORRA aAlfa1;
      aAlfa1 = aAlfa; |QBF aAlfa1; aAlfa1 = aAlfa1 + "ac" + Usuario + ".ddx"; |FBORRA aAlfa1;
      aAlfa1 = aAlfa; |QBF aAlfa1; aAlfa1 = aAlfa1 + "ac" + Usuario + ".ixx"; |FBORRA aAlfa1;

      |SI PARAMETRO ! "";
         |POPV;
      |FINSI;
      |SI EmpreAnt ! -1;
         #dscam030#4 = EmpreAnt; #dscam030#5 = PerioAnt;
         |GRABA 020#dscam030.a;
      |FINSI;
   |FINSI;

   |BUCLE LineasRemesa;
|FPRC;

|DEFBUCLE BajaRemesa;
#dscaw076#1;
;
INICIO;
FINAL;
be;
NULL,BajaRemesa;
|FIN;

|PROCESO BorraMarcas;
   #dscam013#20 = " "; |GRABA 020#dscam013.a;
|FPRC;

|DEFBUCLE BorraMarcas;
#dscam013#1;
;
#dscaz017#0,001;
#dscaz017#1,999;
be;
NULL,BorraMarcas;
|FIN;

|PROCESO RellenaTempo;
   |SI aEntidad ! "    "; |O aNumero ! "          ";
      |SI aEntidad = #dscam003#72; |Y aNumero = #dscam003#70; |ACABA; |FINSI;
      |SI #dscam003#71 > #dscaz017#4; |ACABA; |FINSI;
   |FINSI;

   |SI #dscam003#72 = "    "; |Y #dscam003#70 = "          ";
      |SI #dscam003#3 > #dscaz017#4; |ACABA; |FINSI;
   |FINSI;

   aEntidad = #dscam003#72; aNumero = #dscam003#70;

   #dscam012#0 = #dscam003#17;
   |LEE 000#dscam012.=;
   |SI FSalida ! 0; |ACABA; |FINSI;
   |SI #dscam012#22 = 6; |O #dscam012#22 = 7; |ACABA; |FINSI;
   |SI #dscaz017#2 > #dscam012#1; |O #dscam012#1 > #dscaz017#3; |ACABA; |FINSI;
   |SI #dscam012#22 = 2; |O #dscam012#22 = 4; |O #dscam012#22 = 5;
      |SI #dscam012#8 = "N"; |ACABA; |FINSI;
   |SINO;
      |SI #dscam012#23 = "N"; |ACABA; |FINSI;
   |FINSI;

   |SI #dscaz017#21 = "C";
      |SI #dscam012#22 ! 1; |Y #dscam012#22 ! 3; |ACABA; |FINSI;
   |FINSI;
   |SI #dscaz017#21 = "D";
      |SI #dscam012#22 ! 2; |Y #dscam012#22 < 4; |ACABA; |FINSI;
   |FINSI;

   #dscam013#0 = #dscam003#17;
   #dscam013#1 = #dscam003#37;
   |LEE 000#dscam013.=;
   |SI FSalida ! 0; |ACABA; |FINSI;
   |SI #dscam013#15 = "S"; |O #dscam013#15 = "I"; |ACABA; |FINSI;

   |SI #dscam013#6 > #dscaz017#4; |ACABA; |FINSI;

   |SI #dscam012#0 ! nNumero;
      |SI nMarca = 1;
         nMarca = 2;
      |SINO;
         nMarca = 1;
      |FINSI;
      nNumero = #dscam012#0;
   |FINSI;

   |SI #dscam012#22 = 5;
      |SI #dscam003#97 = "N"; |ACABA; |FINSI;
   |SINO;
      |SI #dscam003#97 = "S"; |ACABA; |FINSI;
   |FINSI;
   ||SI #dscam003#90 = "N"; |ACABA; |FINSI;

   enSwClas   = 1; eaFichClas = "dscam012"; eaTipoClas = #dscam003#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |ACABA; |FINSI;

   #dscam014#0 = #dscam012#2;
   |LEE 000#dscam014.=;
   |SI FSalida = 0;
      |SI #dscam014#40 = "N";
         |SI #dscam014#0 ! #dscam003#51; |Y #dscam051#7 = "S"; |ACABA; |FINSI;
      |FINSI;
   |FINSI;
/*                          Tiquet: 678/1188
   |SI #dscam051#2 = "N";
      Calc1 = #dscam012#1;
      Calc2 = #dscam003#3;
      NumDias = Calc2 - Calc1;
      |SI NumDias < 0; |ACABA; |FINSI;
   |FINSI;
*/
   eaTOperacion = "A"; enNumDocum = #dscam003#40; |HAZ ProcesaTempo;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   |DDEFECTO #dscaw068;
   #dscaw068#0 = #dscam003#17;
   #dscaw068#1 = #dscam003#37;
   |SI #dscam003#72 ! "    "; |O #dscam003#70 ! "          ";
      #dscaw068#3 = #dscam003#78;
      #dscaw068#2 = #dscam003#71;
   |SINO;
      || #dscaw068#3 = #dscam003#30;
      #dscaw068#3 = #dscam013#7;
      #dscaw068#2 = #dscam003#3;
   |FINSI;
   #dscaw068#4 = aMarca;
   #dscaw068#5 = #dscam003#40;
   #dscaw068#6 = #dscam003#72;
   #dscaw068#7 = #dscam003#70;
   #dscaw068#8 = nMarca;
   #dscaw068#9 = #dscam003#57;
   |GRABA 010#dscaw068.n;
|FPRC;

|DEFBUCLE RellenaTempo;
#dscam003#14;
;
#dscaz017#0,"    ", "          ",0000000001;
#dscaz017#1,"zzzz", "zzzzzzzzzz",9999999999;
;
NULL,RellenaTempo;
|FIN;

|PROCESO PasaRecibo;
   #dscam012#0 = nRemesa;
   |LEE 000#dscam012.=;
   |SI #dscam012#22 = 1; |O #dscam012#22 = 3;
      #dscam003#40 = #dscaw068#5;
      |LEE 000#dscam003.=;
      |SI FSalida = 0;
         #dscam004#17 = #dscam003#40;
         #dscam004#3 = 1;
         |LEE 000#dscam004.];
         |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
            LinCob = #dscam004#3 + 1;
            |LEE 000#dscam004.s;
         |SIGUE;
      |SINO;
         LinCob = 1;
      |FINSI;

      |DDEFECTO #dscam004;
      #dscam004#17 = #dscam003#40;
      #dscam004#15 = #dscam013#2;
      #dscam004#0  = #dscam013#4;
      #dscam004#1  = #dscam013#3;
      #dscam004#2  = #dscam013#5;
      #dscam004#3  = LinCob;
      #dscam004#4  = #dscam012#14;
      #dscam004#5  = "REM";
      ||ABDON   14/06/2013     Tiquet 000160/00851
      ||#dscam004#6  = #dscam012#1;
      |SI nSwArtenvas = 1;
         |SI #dscam012#22 ] 1; |Y #dscam012#22 [ 4;
            |SI #dscam012#22 = 1; |O #dscam012#22 = 3;
               |SI #dscaz017#20 ! "01.01.0000";
                 #dscam004#6 = #dscaz017#20;
               |SINO;
                  #dscam004#6 = #dscam003#3;
               |FINSI;
            |SINO;
               #dscam004#6 = #dscam003#3;
            |FINSI;
         |SINO;
            #dscam004#6  = #dscam012#1;
         |FINSI;
      |SINO;
         #dscam004#6  = #dscam012#1;
      |FINSI;
      #dscam004#7  = #dscam003#23; #dscam004#25  = #dscam003#61;
      #dscam004#8  = #dscam013#22; #dscam004#26  = #dscam013#7;
      #dscam004#9  = 0;
      #dscam004#10 = 0;
      #dscam004#33 = #dscam003#59;
      |GRABA 020#dscam004.n;
      #dscam013#17 = LinCob; |GRABA 020#dscam013.a;
      || Actualizo el riesgo de cliente
      |SI #dscam051#3 = "S";
         enBanco = #dscam012#2;
         || enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
         enEmpCartera = -1;     enEmpGestion = #dscam003#46;
         eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
         nImporte = #dscam013#7;
         |SI #dscam003#16 > 0;
            eaTipoOper = "-7";
         |SINO;
            eaTipoOper = "-4";
         |FINSI;
         |HAZ BucleRiesgo;
      |FINSI;
      || Actualizo el recibo
      #dscam003#40 = #dscam013#16;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         #dscam066#0 = #dscam003#40;
         |LEE 000#dscam066.=;
         |SI FSalida = 0; |BORRA 020#dscam066.a; |FINSI;
         ||ABDON   14/06/2013     Tiquet 000160/00851
         ||#dscam003#26 = #dscam012#1;
         |SI nSwArtenvas = 1;
            |SI #dscam012#22 ] 1; |Y #dscam012#22 [ 4;
               |SI #dscam012#22 = 1; |O #dscam012#22 = 3;
                  |SI #dscaz017#20 ! "01.01.0000";
                     #dscam003#26 = #dscaz017#20;
                  |SINO;
                     #dscam003#26 = #dscam003#3;
                  |FINSI;
               |SINO;
                  #dscam003#26 = #dscam003#3;
               |FINSI;
            |SINO;
               #dscam003#26 = #dscam012#1;
            |FINSI;
         |SINO;
            #dscam003#26 = #dscam012#1;
         |FINSI;
           |SI enSwCambioRem = 0;
            #dscam003#23 = #dscam003#23 + #dscam013#22; #dscam003#61 = #dscam003#61 + #dscam013#7;
           |SINO;
              |SI #dscam012#22 ! 2; |Y #dscam012#22 ! 4;
               #dscam003#23 = #dscam003#23 + #dscam013#22; #dscam003#61 = #dscam003#61 + #dscam013#7;
             |FINSI;
          |FINSI;
         #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
         #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
         #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
         #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
         aAlfa = #dscam003#31; |QBF aAlfa; nCalc = aAlfa;
         #dscam003#31 = #dscam003#30 - #dscam003#23;
         #dscam003#65 = #dscam003#64 - #dscam003#61;
         |SI #dscam003#47 = "S"; |O #dscam003#69 ! " ";
            |SI #dscam003#31 = 0;
               #dscam003#14 = "e"; #dscam003#15 = "Pendiente de compensar";
            |FINSI;
         |SINO;
            |SI #dscam003#31 = 0;
               #dscam003#14 = "L"; #dscam003#15 = "Recibo liquidado";
            |SINO;
               #dscam003#14 = "C"; #dscam003#15 = "Parcialmente cobrado";
            |FINSI;
         |FINSI;
         #dscam003#84 = "S";
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |FINSI;
/*
      |HAZ EsTagloma;
      |SI FSalida = 0;
         nSwBloq = 0; fFechaHoy = ~;
         |ABRE #dscam023;
         #dscam023#0 = #dscam003#32;
         |LEE 000#dscam023.=;
         |SI FSalida = 0; |Y #dscam023#9 = "S";
            eaCliente = #dscam003#32; |BUCLE MiraSiBloq1;
            |SI nSwBloq = 0;
               #dscam023#0 = eaCliente;
               |LEE 101#dscam023.=;
               |SI FSalida = 0;
                  #dscam023#9 = "A";
                  #dscam023#10 = "AUTOMATICO";
                  |GRABA 020#dscam023.a; |LIBERA #dscam023;
               |FINSI;
            |FINSI;
         |FINSI;
         |CIERRA #dscam023;
      |FINSI;
*/
      eaCliente = #dscam003#32; |HAZ MiraBloqueoRiesgo;
   |SINO;
      || Actualizo el recibo
      #dscam003#40 = #dscam013#16;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         |SI nSwArtenvas = 1;
            #dscam003#26 = #dscam003#3;
         |FINSI;
         #dscam003#84 = "S";
           |SI enSwCambioRem = 1;
              |SI #dscam012#22 = 2; |O #dscam012#22 = 4;
                   #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
                   #dscam003#31 = 0;            #dscam003#65 = 0;
                       |SI #dscam003#47 = "N";
                       #dscam003#14 = "L";            #dscam003#15 = "Recibo liquidado";
                       |SINO;
                           #dscam003#14 = "e";            #dscam003#15 = "Pendiente de compensar";
                       |FINSI;
              |FINSI;
           |FINSI;
         |GRABA 020#dscam003.a; |LIBERA #dscam003;
      |FINSI;

      || Actualizo el recibo en caso de usar la fecha vto. como fecha contable
      |SI #dscam051#3 = "S"; |Y nSwFVto = 1;
         #dscam004#17 = #dscam013#16;
         #dscam004#3 = #dscam013#17;
         |LEE 000#dscam004.=;
         |SI FSalida = 0; |Y #dscam004#5 = "REM";
            |LEE 000#dscam004.s;
            |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16; |Y #dscam004#5 = "IMP";
               SwImp = 1;
            |SINO;
               SwImp = 0;
            |FINSI;
         |FINSI;
         |SI SwImp = 0;
            #dscam003#40 = #dscam013#16;
            |LEE 000#dscam003.=;
            |SI FSalida ! 0; |DDEFECTO #dscam003; |FINSI;
            enBanco = #dscam012#2;
            || enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
            enEmpCartera = -1;      enEmpGestion = #dscam003#46;
            eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
            nImporte = #dscam013#7;
            |SI #dscam012#22 = "1"; |O #dscam012#22 = "3";
               eaTipoOper = "-4";
            |SINO;
               eaTipoOper = "-6";
            |FINSI;
            |HAZ BucleRiesgo;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Pagare;
   #dscam013#0 = #dscam003#17;
   #dscam013#1 = #dscam003#37;
   |LEE 000#dscam013.=;
   |SI FSalida = 0;
       #dscam013#20 = "*"; #dscam013#15 = "S";
       |GRABA 020#dscam013.a;
   |FINSI;

   |SALVA_FICHA #dscam003;
   nRemesa = #dscam003#17; #dscaw068#5 = #dscam003#40; |HAZ PasaRecibo;
   |REPON_FICHA #dscam003;

   #dscaw076#0 = #dscam003#17;
   |LEE 000#dscaw076.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscaw076;
      #dscaw076#0 = #dscam003#17;
      |GRABA 020#dscaw076.n;
   |FINSI;
|FPRC;

|DEFBUCLE Pagare;
#dscam003#7;
;
#dscaw068#6, #dscaw068#7, 000000001;
#dscaw068#6, #dscaw068#7, 999999999;
;
NULL,Pagare;
|FIN;

|PROCESO VuelcaRecibos;
   eaTOperacion = "B"; enNumDocum = #dscaw068#5; |HAZ ProcesaTempo;

   aCodEnlace = #dscaz017#5;
   |SI aCodEnlace = "    ";
      |ABRE #dscam093;
      #dscam093#0 = "V";
      |LEE 000#dscam093.=;
      |SI FSalida = 0;
         |SI #dscam012#22 = 1; aCodEnlace = #dscam093#1; |FINSI;
         |SI #dscam012#22 = 2; aCodEnlace = #dscam093#3; |FINSI;
         |SI #dscam012#22 = 3; aCodEnlace = #dscam093#5; |FINSI;
         |SI #dscam012#22 = 4; aCodEnlace = #dscam093#7; |FINSI;
         |SI #dscam012#22 = 5; aCodEnlace = #dscam093#9; |FINSI;
      |FINSI;
      |CIERRA #dscam093;

      |ABRE #dscam030;
      #dscam030#0 = aCodEnlace;
      |LEE 000#dscam030.=;
      |SI FSalida = 0;
         |SI #dscam030#7 = "S"; nAgrupFecha = 1; |FINSI;
      |FINSI;
      |CIERRA #dscam030;
   |FINSI;

   |SI nSwFVto = 1; |Y nAgrupFecha = 1;
      |SI fFechaAnt ! #dscaw068#2; |O nRemesaAnt ! #dscaw068#0;
         |SI fFechaAnt ! "01.01.0000";
            Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
            |NOME_DAT #9 Comodin;
            |DELINDEX #dscaw013; |ABRE #dscaw013;

            |DDEFECTO #dscaw013;
            ||#dscaw013#0  = 1;            #dscaw013#5  = #dscaw068#0;
            ||#dscaw013#6  = #dscaw068#0;  #dscaw013#11 = "N";
            #dscaw013#0  = 1;            #dscaw013#5  = nRemesaAnt;
            #dscaw013#6  = nRemesaAnt;   #dscaw013#11 = "N";
            #dscaw013#12 = 5;            #dscaw013#13 = "dscam013";
            #dscaw013#14 = 0;            #dscaw013#15 = aCodEnlace;
            |GRABA 020#dscaw013.n;
            |DDEFECTO #dscaw013;
            #dscaw013#0  = 2;            #dscaw013#3  = "*";
            #dscaw013#4  = "*";          #dscaw013#11 = "A";
            #dscaw013#12 = 1;            #dscaw013#13 = "dscam013";
            #dscaw013#14 = 20;           #dscaw013#15 = aCodEnlace;
            |GRABA 020#dscaw013.n; NumLinea = NumLinea + 1;
            |CIERRA #dscaw013;

            Comodin = "dscam033.tab;" + aCodEnlace + ",V" + fFechaAnt;
            |LIBERA #dscam012; |CIERRAT #dscam012;
            |SUB_EJECUTA_NP "dscaz169.tab;INICIO";
            |SUB_EJECUTA_NP Comodin;
            |SUB_EJECUTA_NP "dscaz169.tab;FINAL";
            |ABRET #dscam012; |LEE 101#dscam012.=;
            |DELINDEX #dscaw013;

            |BUCLE BorraMarcas;
         |FINSI;
         fFechaAnt = #dscaw068#2; nRemesaAnt = #dscaw068#0;
      |FINSI;
   |FINSI;

   |SI #dscaw068#6 ! "    "; |O #dscaw068#7 ! "          ";
      |BUCLE Pagare;
   |SINO;
      #dscaw076#0 = #dscaw068#0;
      |LEE 000#dscaw076.=;
      |SI FSalida ! 0;
         |DDEFECTO #dscaw076;
         #dscaw076#0 = #dscaw068#0;
         |GRABA 020#dscaw076.n;
      |FINSI;

      #dscam013#0 = #dscaw068#0;
      #dscam013#1 = #dscaw068#1;
      |LEE 000#dscam013.=;
      |SI FSalida = 0;
          #dscam013#20 = "*"; #dscam013#15 = "S";
          |GRABA 020#dscam013.a;
      |FINSI;

      nRemesa = #dscaw068#0; |HAZ PasaRecibo;
   |FINSI;

   |SI nSwFVto = 1; |Y nAgrupFecha = 0;
      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #9 Comodin;
      |DELINDEX #dscaw013; |ABRE #dscaw013;

      |DDEFECTO #dscaw013;
      #dscaw013#0  = 1;            #dscaw013#5  = #dscaw068#0;
      #dscaw013#6  = #dscaw068#0;  #dscaw013#11 = "N";
      #dscaw013#12 = 5;            #dscaw013#13 = "dscam013";
      #dscaw013#14 = 0;            #dscaw013#15 = aCodEnlace;
      |GRABA 020#dscaw013.n;

      |DDEFECTO #dscaw013;
      #dscaw013#0  = 2;
      #dscaw013#13 = "dscam013";   #dscaw013#15 = aCodEnlace;
      |SI #dscaw068#6 ! "    "; |O #dscaw068#7 ! "          ";
         #dscaw013#3  = "*";          #dscaw013#4  = "*";
         #dscaw013#11 = "A";
         #dscaw013#12 = 1;            #dscaw013#14 = 20;
      |SINO;
         #dscaw013#5  = #dscaw068#5;  #dscaw013#6  = #dscaw068#5;
         #dscaw013#11 = "N";
         #dscaw013#12 = 9;            #dscaw013#14 = 16;
      |FINSI;
      |GRABA 020#dscaw013.n; NumLinea = NumLinea + 1;
      |CIERRA #dscaw013;

      Comodin = "dscam033.tab;" + aCodEnlace + ",V" + #dscaw068#2;
      |LIBERA #dscam012; |CIERRAT #dscam012;
      |SUB_EJECUTA_NP "dscaz169.tab;INICIO";
      |SUB_EJECUTA_NP Comodin;
      |SUB_EJECUTA_NP "dscaz169.tab;FINAL";
      |ABRET #dscam012; |LEE 101#dscam012.=;
      |DELINDEX #dscaw013;
   |FINSI;
|FPRC;

|DEFBUCLE VuelcaRecibos;
#dscaw068#2;
;
00001,"*","01.01.0000",001;
99999,"*","31,12,9999",999;
;
NULL,VuelcaRecibos;
|FIN;

|PROCESO Riesgos;
      |SI #dscam051#3 = "S"; |Y #dscam013#20 = "*";
         #dscam004#17 = #dscam013#16;
         #dscam004#3 = #dscam013#17;
         |LEE 000#dscam004.=;
         |SI FSalida = 0; |Y #dscam004#5 = "REM";
            |LEE 000#dscam004.s;
            |SI FSalida = 0; |Y #dscam004#17 = #dscam013#16; |Y #dscam004#5 = "IMP";
               SwImp = 1;
            |SINO;
               SwImp = 0;
            |FINSI;
         |FINSI;
         |SI SwImp = 0;
            #dscam003#40 = #dscam013#16;
            |LEE 000#dscam003.=;
            |SI FSalida ! 0; |DDEFECTO #dscam003; |FINSI;
            enBanco = #dscam012#2;
            || enEmpCartera = #48#0; enEmpGestion = #dscam003#46;
            enEmpCartera = -1;      enEmpGestion = #dscam003#46;
            eaSerie = #dscam003#0;  eaCliGest = #dscam003#32;
            nImporte = #dscam013#7;
            |SI #dscam012#22 = "1"; |O #dscam012#22 = "3";
               eaTipoOper = "-4";
            |SINO;
               eaTipoOper = "-6";
            |FINSI;
            |HAZ BucleRiesgo;
         |FINSI;
      |FINSI;
|FPRC;

|DEFBUCLE Riesgos;
#dscam013#1;
;
#dscaw076#0, 001;
#dscaw076#0, 999;
;
NULL, Riesgos;
|FIN;

|PROCESO HazAsiento;
      #dscam012#0 = #dscaw076#0;
      |LEE 101#dscam012.=;
      |SI FSalida ! 0; |ACABA; |FINSI;

      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #9 Comodin;
      |DELINDEX #dscaw013; |ABRE #dscaw013;

      Comodin = #dscaz017#5;
      |SI Comodin = "    "; |Y #dscam051#1 = "S";
         |ABRE #dscam093;
         #dscam093#0 = "V";
         |LEE 000#dscam093.=;
         |SI FSalida = 0;
            |SI #dscam012#22 = 1; Comodin = #dscam093#1; |FINSI;
            |SI #dscam012#22 = 2; Comodin = #dscam093#3; |FINSI;
            |SI #dscam012#22 = 3; Comodin = #dscam093#5; |FINSI;
            |SI #dscam012#22 = 4; Comodin = #dscam093#7; |FINSI;
            |SI #dscam012#22 = 5; Comodin = #dscam093#9; |FINSI;
         |FINSI;
         |CIERRA #dscam093;
      |FINSI;

      |DDEFECTO #dscaw013;
      #dscaw013#0  = 1;            #dscaw013#5  = #dscam012#0;
      #dscaw013#6  = #dscam012#0;  #dscaw013#11 = "N";
      #dscaw013#12 = 5;            #dscaw013#13 = "dscam013";
      #dscaw013#14 = 0;            #dscaw013#15 = Comodin;
      |GRABA 020#dscaw013.n;
      |DDEFECTO #dscaw013;
      #dscaw013#0  = 2;            #dscaw013#3  = "*";
      #dscaw013#4  = "*";          #dscaw013#11 = "A";
      #dscaw013#12 = 1;            #dscaw013#13 = "dscam013";
      #dscaw013#14 = 20;           #dscaw013#15 = Comodin;
      |GRABA 020#dscaw013.n; NumLinea = NumLinea + 1;
      |CIERRA #dscaw013;

      |SI #dscaz017#20 ! "01.01.0000";
         Comodin = "dscam033.tab;" + Comodin + ",V" + #dscaz017#20;
      |SINO;
         Comodin = "dscam033.tab;" + Comodin + ",V" + #dscaz017#4;
      |FINSI;
      |LIBERA #dscam012; |CIERRAT #dscam012;
      |SUB_EJECUTA_NP "dscaz169.tab;INICIO";
      |SUB_EJECUTA_NP Comodin;
      |SUB_EJECUTA_NP "dscaz169.tab;FINAL";
      |ABRET #dscam012; |LEE 101#dscam012.=;

      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

      #dscam012#8 = "S"; #dscam012#9 = "S";
      |GRABA 020#dscam012.a; |LIBERA #dscam012;

      |SI #dscam012#22 = 2; |O #dscam012#22 = 4; |BUCLE Riesgos; |FINSI;
|FPRC;

|DEFBUCLE EnlazaRemesas;
#dscaw076#1;
;
#dscaz017#0;
#dscaz017#1;
be;
NULL,HazAsiento;
|FIN;

|PROCESO VuelcaDatos;
   fFechaAnt = "01.01.0000";
   |DELINDEX #dscaw076; |ABRE #dscaw076;
   |BUCLE BorraMarcas;
   |BUCLE VuelcaRecibos;
   |SI nSwFVto = 0;
      |BUCLE EnlazaRemesas;
   |SINO;
      |SI fFechaAnt ! "01.01.0000"; |Y nAgrupFecha = 1;
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #9 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         |DDEFECTO #dscaw013;
         #dscaw013#0  = 1;            #dscaw013#5  = #dscaw068#0;
         #dscaw013#6  = #dscaw068#0;  #dscaw013#11 = "N";
         #dscaw013#12 = 5;            #dscaw013#13 = "dscam013";
         #dscaw013#14 = 0;            #dscaw013#15 = aCodEnlace;
         |GRABA 020#dscaw013.n;
         |DDEFECTO #dscaw013;
         #dscaw013#0  = 2;            #dscaw013#3  = "*";
         #dscaw013#4  = "*";          #dscaw013#11 = "A";
         #dscaw013#12 = 1;            #dscaw013#13 = "dscam013";
         #dscaw013#14 = 20;           #dscaw013#15 = aCodEnlace;
         |GRABA 020#dscaw013.n; NumLinea = NumLinea + 1;
         |CIERRA #dscaw013;
         Comodin = "dscam033.tab;" + aCodEnlace + ",V" + fFechaAnt;
         |LIBERA #dscam012; |CIERRAT #dscam012;
         |SUB_EJECUTA_NP "dscaz169.tab;INICIO";
         |SUB_EJECUTA_NP Comodin;
         |SUB_EJECUTA_NP "dscaz169.tab;FINAL";
         |ABRET #dscam012; |LEE 101#dscam012.=;
         |DELINDEX #dscaw013;
      |FINSI;
   |FINSI;
   |BUCLE BorraMarcas;
   |CIERRA #dscaw076;
|FPRC;

|RUTINA inf068;
   #dscaw068#0 = 1;
   #dscaw068#1 = 1;
|FRUT;

|RUTINA sup068;
   #dscaw068#0 = 99999;
   #dscaw068#1 = 999;
|FRUT;

|PROCESO Base;
   #dscaw076#0 = #Referen@#0;
   |LEE 000#dscaw076.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscaw076;
      #dscaw076#0 = #Referen@#0;
      |GRABA 020#dscaw076.n;
   |FINSI;
|FPRC;

|DEFBUCLE Base;
#Referen@#1002;
;
000001, 001;
999999, 999;
;
NULL, Base;
|FIN;

|PROCESO Desbloquea;
   eaTOperacion = "B"; enNumDocum = #dscaw068#5; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE Desbloquea;
#dscaw068#1;
;
INICIO;
FINAL;
;
NULL,Desbloquea;
|FIN;

|PROGRAMA;
   |HAZ EsArtenvas;
   |SI FSalida = 0;
      nSwArtenvas = 1;
   |SINO;
      nSwArtenvas = 0;
   |FINSI;

   |SI PARAMETRO = "";
      |HAZ Tipo8;
      |CLS;
      |CABEZA "Baja de remesas";

      |ABRE #dscaz017; |ABRE #dscam030;
      |ABRE #dscam051;
      |LEE 010#dscam051.p;
      |SI FSalida ! 0;
         |DDEFECTO #dscam051;
         |GRABA 020#dscam051.n;
      |FINSI;
      |CIERRA #dscam051;

      |LEE 000#dscaz017.p;
      |SI FSalida ! 0;
         |DDEFECTO #dscaz017;
         |GRABA 020#dscaz017.c;
      |FINSI;

      Comodin = #48#16; |QBF Comodin;
      |SI Comodin = "";
         HayConta = 0;
         |C_M #dscaz017#5,1,"N";
         #dscaz017#5 = "    ";
      |SINO;
         HayConta = 1;
         |SI #dscam051#1 = "S";
            |C_M #dscaz017#5,1,"S";
            #dscaz017#5 = #dscam051#25;
         |SINO;
            |C_M #dscaz017#5,1,"N";
            #dscaz017#5 = "    ";
         |FINSI;
      |FINSI;

      |PINPA #0#0; |PINDA #0#0;
      Empresa = #48#0;
      |ENDATOS #1#0;
      |SI FSalida = 0;
         nAgrupFecha = 0;
         |SI HayConta = 1; |Y #dscam051#1 = "S";
            |ABRE #dscam030;
            #dscam030#0 = #dscaz017#5;
            |LEE 000#dscam030.=;
            |SI FSalida = 0;
               |SI #dscam030#7 = "S"; nAgrupFecha = 1; |FINSI;
            |FINSI;
            |CIERRA #dscam030;
         |FINSI;

         ||#dscaz017#6 = "N";
         |GRABA 020#dscaz017.a;
         |ABRE #dscam012;
         |ABRE #dscam013;
         |ABRE #dscam014;
         |ABRE #dscam004;
         |ABRE #dscam003;
         |DELINDEX #dscaw076; |ABRE #dscaw076;

         Linea = 1;
         |SI #dscaz017#22 = "S";
            Comodin = "rr" + Usuario; |NOME_DAT #100 Comodin;
            |DELINDEX #dscaw068; |ABRE #dscaw068;
            |ABRE #dscam013;
            |ABRE #dscam014;
            Linea = 1; nMarca = 1;
            eaTipoRecibo = "V"; aEntidad = "    "; aNumero = "          ";
            |BUCLE RellenaTempo;
            |PUSHV 05012380;
            |ENTLINEAL #1#dscaw068,-2,4,19,1,inf068,sup068;
            |POPV;
            |CONFI "    NConforme con los datos editados ?";
            |SI FSalida = 0;
               Linea = 1; |HAZ VuelcaDatos;
            |FINSI;
            |CIERRA #dscam014;
            |CIERRA #dscam013;
            |CIERRA #dscaw068;
            |BUCLE Desbloquea;
         |SINO;
            aAlfa = "SELECT * FROM dscam013 INTO tm" + Usuario + ".def";
            aAlfa = aAlfa + " WHERE 0 BETWEEN " + #dscaz017#0 + "," + #dscaz017#1;
            aAlfa = aAlfa + " AND 15 == 'N' AND 6 BETWEEN '01.01.1900','" + #dscaz017#4 + "'";
            |SQL aAlfa;
            |SI FSalida = 0;
               |DBASE aAlfa; |QBF aAlfa;
               aAlfa = aAlfa + "def/tm" + Usuario + ".mas";
               |CARGA_DEF aAlfa, Referen@;
               |SI FSalida = 0;
                  |DFICE aAlfa; |QBF aAlfa;
                  |PATH_DAT #1000 aAlfa;
                  |ABRE #Referen@;
                  |DELINDEX #dscaw076; |ABRE #dscaw076;
                  |BUCLE Base;
                  |CIERRA #dscaw076;
                  |CIERRA #Referen@; |DELINDEX #Referen@; |DESCARGA_DEF #Referen@;
               |FINSI;
            |FINSI;
            NumLinea = 1; |BUCLE BajaRemesa;
         |FINSI;

         |CIERRA #dscam003;
         |CIERRA #dscam004;
         |CIERRA #dscam014;

         |BUCLE MarcaAbonada;
         |CIERRA #dscam013;
         |CIERRA #dscam012;
         |CIERRA #dscaw076; |DELINDEX #dscaw076;
      |FINSI;
      |CIERRA #dscam030; |CIERRA #dscaz017;
      |HAZ Tipo9;
   |SINO;
      nSwDesdeFuera = 0;
      aAlfa = PARAMETRO; |QBF aAlfa;
      aAlfa1 = aAlfa % 0101;
      |SI aAlfa1 = "#";
         nSwDesdeFuera = 1;
         |HAZ Tipo8;
      |FINSI;

      |SI nSwDesdeFuera = 0;
         |DFICE aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + (("00000" + #48#0) % -105) + "/";
         aAlfa2 = aAlfa + "*";
         |_PDIR aAlfa2;
         |SI FSalida ] 0;
            |PATH_DAT #15 aAlfa;
            |PATH_DAT #12 aAlfa; |PATH_DAT #2 aAlfa;
            |PATH_DAT #3 aAlfa;  |PATH_DAT #4 aAlfa;
            |PATH_DAT #1 aAlfa;  |PATH_DAT #5 aAlfa;
            |ABRE #dscam051;
            |LEE 010#dscam051.p;
            |SI FSalida ! 0;
               |DDEFECTO #dscam051;
               |GRABA 020#dscam051.n;
            |FINSI;

            |SI #dscam051#34 = "S";
               fFecha = ~;
               |SI #dscam051#36 ! fFecha;
                  #dscam051#36 = fFecha; |GRABA 020#dscam051.a;
                  nNume = fFecha;
                  nNume = nNume - #dscam051#35;
                  fFecha = nNume; #dscaz017#4 = fFecha;

                  #dscaz017#5 = #dscam051#25;
                  enEmpCartera = #48#0;
                  |HAZ Tipo8;
                  |ABRE #dscam012;
                  |ABRE #dscam013;
                  |ABRE #dscam014;
                  |ABRE #dscam004;
                  |ABRE #dscam003;
                  |DELINDEX #dscaw076; |ABRE #dscaw076;

                  aAlfa = "SELECT * FROM dscam013 INTO tm" + Usuario + ".def";
                  aAlfa = aAlfa + " WHERE 0 BETWEEN " + #dscaz017#0 + "," + #dscaz017#1;
                  aAlfa = aAlfa + " AND 15 == 'N' AND 6 BETWEEN '01.01.1900','" + #dscaz017#4 + "'";
                  |SQL aAlfa;
                  |SI FSalida = 0;
                     |DBASE aAlfa; |QBF aAlfa;
                     aAlfa = aAlfa + "def/tm" + Usuario + ".mas";
                     |CARGA_DEF aAlfa, Referen@;
                     |SI FSalida = 0;
                        |DFICE aAlfa; |QBF aAlfa;
                        |PATH_DAT #1000 aAlfa;
                        aAlfa = aAlfa + (("00000" + #48#0) % -105) + "/";
                        |ABRE #Referen@;
                        |DELINDEX #dscaw076; |ABRE #dscaw076;
                        |BUCLE Base;
                        |CIERRA #dscaw076;
                        |CIERRA #Referen@; |DELINDEX #Referen@; |DESCARGA_DEF #Referen@;
                     |FINSI;
                  |FINSI;

                  NumLinea = 1; |BUCLE BajaRemesa;

                  |CIERRA #dscam003;
                  |CIERRA #dscam004;
                  |CIERRA #dscam014;

                  |BUCLE MarcaAbonada;
                  |CIERRA #dscam013;
                  |CIERRA #dscam012;
                  |CIERRA #dscaw076; |DELINDEX #dscaw076;
                  |HAZ Tipo9;
               |FINSI;
            |FINSI;
         |FINSI;
         |CIERRA #dscam030;
         |CIERRA #dscam051;
         |CIERRA #dscaz017;
      |SINO;
         aAlfa = PARAMETRO; |QBF aAlfa;
         aAlfa1 = aAlfa % 0205;
         nRemExt = aAlfa1;
         #dscaz017#0 = aAlfa1; #dscaz017#1 = aAlfa1;
         aAlfa1 = aAlfa % 0703;
         nLinExt = aAlfa1;
         aAlfa1 = aAlfa % 1010;
         fFecExt = aAlfa1; #dscaz017#4 = fFecExt;

         |DFICE aAlfa; |QBF aAlfa;
         |PATH_DAT #15 aAlfa;
         |PATH_DAT #12 aAlfa; |PATH_DAT #2 aAlfa;
         |PATH_DAT #3 aAlfa;  |PATH_DAT #4 aAlfa;
         |PATH_DAT #1 aAlfa;  |PATH_DAT #5 aAlfa;

         |ABRE #dscam051;
         |LEE 010#dscam051.p;
         |SI FSalida ! 0;
            |DDEFECTO #dscam051;
            |GRABA 020#dscam051.n;
         |FINSI;

         #dscaz017#5 = #dscam051#25;
         enEmpCartera = #48#0;
         |ABRE #dscam012;
         |ABRE #dscam013;
         |ABRE #dscam014;
         |ABRE #dscam004;
         |ABRE #dscam003;
         |DELINDEX #dscaw076; |ABRE #dscaw076;

         aAlfa = "SELECT * FROM dscam013 INTO tm" + Usuario + ".def";
         aAlfa = aAlfa + " WHERE 0 == " + nRemExt + " AND 1 == " + nLinExt;
         |SQL aAlfa;
         |SI FSalida = 0;
            |DBASE aAlfa; |QBF aAlfa;
            aAlfa = aAlfa + "def/tm" + Usuario + ".mas";
            |CARGA_DEF aAlfa, Referen@;
            |SI FSalida = 0;
               |DFICE aAlfa; |QBF aAlfa;
               |PATH_DAT #1000 aAlfa;
               |ABRE #Referen@;
               |DELINDEX #dscaw076; |ABRE #dscaw076;
               |BUCLE Base;
               |CIERRA #dscaw076;
               |CIERRA #Referen@; |DELINDEX #Referen@; |DESCARGA_DEF #Referen@;
            |FINSI;
         |FINSI;

         NumLinea = 1; |BUCLE BajaRemesa;

         |CIERRA #dscam003;
         |CIERRA #dscam004;
         |CIERRA #dscam014;

         |BUCLE MarcaAbonada;
         |CIERRA #dscam013;
         |CIERRA #dscam012;
         |CIERRA #dscaw076; |DELINDEX #dscaw076;

         |HAZ Tipo9;
      |FINSI;
      |CIERRA #dscam030;
      |CIERRA #dscam051;
      |CIERRA #dscaz017;
   |FINSI;

   eaSesion   = Usuario; |HAZ LimpiaTempo;
|FPRO;

|RUTINA infer068;
   #dscam068#0 = #dscam036#15;
   #dscam068#1 = #dscam036#0;
   #dscam068#2 = 1;
|FRUT;

|RUTINA super068;
   #dscam068#0 = #dscam036#15;
   #dscam068#1 = #dscam036#0;
   #dscam068#2 = 999;
|FRUT;

|PROCESO Exclusion; |TIPO 3;
   |PUSHV 0959 1979;
   |SI #dscam036#11 = "A";
      LongDato = #dscam036#12;
      |CAMPO_ANCHO #dscam068#3,1,LongDato;
      |CAMPO_MAXIMO #dscam068#3,1,"#";
      |C_V #dscam068#3,1,"S"; |C_M #dscam068#3,1,"S";
   |SINO;
      |C_V #dscam068#3,1,"N"; |C_M #dscam068#3,1,"N";
   |FINSI;
   |SI #dscam036#11 = "N";
      |C_V #dscam068#4,1,"S"; |C_M #dscam068#4,1,"S";
   |SINO;
      |C_V #dscam068#4,1,"N"; |C_M #dscam068#4,1,"N";
   |FINSI;
   |SI #dscam036#11 = "F";
      |C_V #dscam068#5,1,"S"; |C_M #dscam068#5,1,"S";
   |SINO;
      |C_V #dscam068#5,1,"N"; |C_M #dscam068#5,1,"N";
   |FINSI;
   |C_V #dscam068#6,1,"N";
   |ENTLINEAL #1#dscam068,-3,1,18,1,infer068,super068;
   |C_V #dscam068#3,1,"N"; |C_M #dscam068#3,1,"N";
   |C_V #dscam068#4,1,"N"; |C_M #dscam068#4,1,"N";
   |C_V #dscam068#5,1,"N"; |C_M #dscam068#5,1,"N";
   |C_V #dscam068#6,1,"S";
   |POPV;
|FPRC;

|PROCESO Select;
   |SI #dscaz017#6 = "N";
      |PARA nCont = 7; |SI nCont [ 18; |HACIENDO nCont = nCont + 1;
         #dscaz017#nCont# = "zzzzz"; |PINTA #dscaz017#nCont#;
         |C_M #dscaz017#nCont#,1,"N";
      |SIGUE;
   |SINO;
      |PARA nCont = 7; |SI nCont [ 18; |HACIENDO nCont = nCont + 1;
         |C_M #dscaz017#nCont#,1,"S";
      |SIGUE;
   |FINSI;
|FPRC;

|PROCESO MiraFecha; |TIPO 7;
   |SI FSalida = 2; |ACABA; |FINSI;
   |CONFI "    NUsar como fecha contable la fecha de Vto.? ";
   |SI FSalida = 0;
      nSwFVto = 1;
      #dscaz017#20 = "01.01.0000"; |PINTA #dscaz017#20;
      |C_M #dscaz017#20, 1, "N";
   |SINO;
      nSwFVto = 0;
      #dscaz017#20 = ~; |PINTA #dscaz017#20;
      |C_M #dscaz017#20, 1, "S";
   |FINSI;
|FPRC;

|PROCESO MiraParam; |TIPO 7;
   |SI #dscam051#1 = "S";
      aAlfa = #dscam051#61; |QBF aAlfa;
      |C_M #dscaz017#5, 1, aAlfa;
   |SINO;
      |C_M #dscaz017#5, 1, "N";
   |FINSI;
|FPRC;
