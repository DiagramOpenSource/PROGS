|FICHEROS;
     dscam098 #0;
     dscam003 #3;
     referen@ #10;
|FIN;

|VARIABLES;
     aTipo = "";
     aModulo = "";
     aUsuario = "";
     aHora = "";
     aBass = "";
     aAlfa = "";
     aConte = "";
     nHay = 0;
|FIN;

|PROCESO &Tipo003_15; |TIPO 15;
     aTipo = "A";
     |HAZ Log;
|FPRC;

|PROCESO &Tipo003_16; |TIPO 16;
     aTipo = "M";
     |HAZ Log;

     |HAZ VigorCtrl;
|FPRC;

|PROCESO &Tipo003_17; |TIPO 17;
     aTipo = "B";
     |HAZ Log;
|FPRC;

|PROCESO Log;
     |MODULO aModulo;
     aUsuario = Usuario % 810;
     |HORA aHora;

     |ABRE #0;
     |LEE 000#0u;
     #0#0 = #0#0 + 1;
     #0#1 = ~;
     #0#2 = aHora;
     #0#3 = aUsuario;
     #0#4 = #dscam003#40;
     #0#5 = aModulo;
     #0#6 = aTipo;
     #0#7 = #dscam003#14;
     |GRABA 020#0n;
     |CIERRA #0;
|FPRC;

|PROCESO VigorCtrl;
     |DBASS aBass;
     aAlfa = aBass + "dscarter/def/vig00001.mas";
     |XABRE "E", aAlfa, 0;
     |SI FSalida ] 0;                                  || si existe el modulo
          aConte = "";
          aAlfa = aBass + "dscarter/def/dscam003.mas";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#40 = #dscam003#40;
               |LEE 000#referen@.=;
               |SI FSalida = 0;
                    aConte = #referen@#14;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |SI aConte = "L"; |Y aConte ! #dscam003#14;  || si cambia el estado
               nHay = -1;
               aAlfa = aBass + "dscomer9/def/vigm0050.mas";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0
                    aAlfa = ("00000" + #dscam003#46) % -105;
                    aAlfa = aBass + "dscomer9/fich/" + aAlfa + "/";
                    |PATH_DAT #referen@#aAlfa#;
                    |ABRE #referen@;
                    #referen@#3 = #dscam003#0;
                    #referen@#4 = #dscam003#1;
                    |LEE 000#referen@.=;
                    nHay = FSalida;
                    |CIERRA #referen@;
                    |DESCARGA_DEF #referen@;
               |FINSI;
               |SI nHay = 0;                                || si existe gestion
                    aAlfa = aBass + "dscarter/def/vig00001.mas";
                    |CARGA_DEF aAlfa, referen@;
                    |SI FSalida = 0;
                         |ABRE #referen@;
                         #referen@#0 = #dscam003#0;
                         #referen@#1 = #dscam003#1;
                         |LEE 000#referen@.=;
                         |SI FSalida ! 0;                   || no existe cartera
                              #referen@#2 = 0;
                              #referen@#3 = #dscam003#33;
                              |GRABA 020#referen@.n;
                         |FINSI;
                         |CIERRA #referen@;
                         |DESCARGA_DEF #referen@;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;
