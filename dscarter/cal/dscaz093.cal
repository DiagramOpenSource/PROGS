|FICHEROS;
   dscaz093 #0;
   dscam045 #10;
   dscam003 #11;

   agifa010@ #100;
   dsm00003@ #101;
   agifa059@ #102;
   malpe001@ #103;
|FIN;

|VARIABLES;
   aAlfa  = "";
   aAlfa1 = "";
   nEsMalpe = 0;

   nCalc = 0;
|FIN;

|PROCESO Recalculo;
   |DFICE aAlfa; |QBF aAlfa;
   aAlfa = aAlfa % -106; aAlfa = aAlfa % 0105; nCalc = aAlfa;
   #dscam045#6 = nCalc;
   |LEE 000#dscam045.];
   |PARA; |SI FSalida = 0; |Y #dscam045#6 = nCalc; |HACIENDO;
      |SI #dscam003#0 ] #dscam045#4; |Y #dscam003#0 [ #dscam045#5;
         |SAL;
      |FINSI;
      |LEE 000#dscam045.s;
   |SIGUE;
   aAlfa = #48#17; |QBF aAlfa;
   aAlfa = aAlfa + "fich/" + (("00000" + #dscam045#0) % -105) + "/";
   |PATH_DAT #100 aAlfa; |PATH_DAT #101 aAlfa; |PATH_DAT #102 aAlfa;
   |SI nEsMalpe = 0; |PATH_DAT #103 aAlfa; |FINSI;
   |ABRE #agifa010@; |ABRE #dsm00003@; |ABRE #agifa059@;
   |SI nEsMalpe = 0; |ABRE #malpe001@; |FINSI;
   #agifa059@#14 = #dscam003#0;
   #agifa059@#0  = #dscam003#1;
   #agifa059@#1  = 1;
   |LEE 000#agifa059@.];
   |SI FSalida = 0; |Y #agifa059@#14 = #dscam003#0; |Y #agifa059@#0  = #dscam003#1;
      #agifa010@#52 = #agifa059@#15;
      #agifa010@#0 = #agifa059@#2;
      |LEE 000#agifa010@.=;
      |SI FSalida = 0;
         |SI nEsMalpe ! 0;
            #dsm00003@#0 = #agifa010@#3;
            #dsm00003@#1 = #agifa010@#84;
            |LEE 000#dsm00003@.=;
            |SI FSalida = 0;
               #dscam003#91 = #dsm00003@#1;
               #dscam003#92 = #dsm00003@#10;
               |GRABA 020#dscam003.a;
            |FINSI;
         |SINO;
            #malpe001@#0 = #agifa010@#3;
            #malpe001@#1 = #agifa010@#84;
            |LEE 000#malpe001@.=;
            |SI FSalida = 0;
               #dscam003#91 = #malpe001@#1;
               #dscam003#92 = #malpe001@#2;
               |GRABA 020#dscam003.a;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
   |CIERRA #agifa059@; |CIERRA #dsm00003@; |CIERRA #agifa010@;
|FPRC;

|DEFBUCLE Recalculo;
#dscam003#1;
;
INICIO;
FINAL;
be;
NULL,Recalculo;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA " Recalculo direcciones de entrega ";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0; |Y #0#0 = "S";

      |DFICB aAlfa; |QBF aAlfa; |PATH_DAT #10 aAlfa;
      |ABRE #dscam045; |SELECT #2#dscam045;

      aAlfa = #48#17; |QBF aAlfa;
      aAlfa1 = aAlfa + "def/agifa010.mas";
      |CARGA_DEF aAlfa1, agifa010@;
      |SI FSalida = 0;
         |HAZ EsMalpesa; nEsMalpe = FSalida;
         |SI nEsMalpe = 0;
            aAlfa1 = aAlfa + "def/malpe001.mas"; |CARGA_DEF aAlfa1, malpe001@;
         |FINSI;
         aAlfa1 = aAlfa + "def/dsm00003.mas"; |CARGA_DEF aAlfa1, dsm00003@;
         aAlfa1 = aAlfa + "def/agifa059.mas"; |CARGA_DEF aAlfa1, agifa059@;
         |BUCLE Recalculo;
         |DESCARGA_DEF #agifa059@; |DESCARGA_DEF #dsm00003@; |DESCARGA_DEF #agifa010@;
      |SINO;
         |MENAV "    Problemas al acceder al fichero de albaranes";
      |FINSI;
      |CIERRA #dscam045;
   |FINSI;
|FPRO;
