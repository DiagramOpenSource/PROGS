|FICHEROS;
   dscaz039 #0;
   dscam003 #1;
   dscam004 #2;
   &agif024@ #3;
   dscam008 #4;
   dscam009 #5;
   &agif112@ #6;
   &caclipr@ #7;
   dscam030 #10;
   dscam051 #11;
   dscaw013 #12;

   dscam038 #50;

   cacuenta@ #100;
   taglm01@  #101;
   dscam023  #102,MANTE;

   dscaw026 #11,MANTE;
   dscaw027 #12,MANTE;
|FIN;

|VARIABLES;
   &eaFichClas = "";  &eaTipoClas = ""; &enSwClas = 0;
   &HayGestion = 0;   &eaSesion   = "";

   &enEmpCartera = 0; &enEmpGestion = 0;
   &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = "";
   &nDeci_Base = 0; &nDeci_Div = 0; &Divisa = "";
   &CambioDivVn = 0; &CambioDivCm = 0; &NombreDiv = "";
   &Fichero   = "";  &Cmp = "";   &Tipo = ""; &CmpNum = 0;
   &eaTipoRecibo = ""; &enNumDocum = 0; &eaMensRet = ""; &enSwError = 0; &eaTOperacion = "";
   &MaxDigit = 0; &HayConta = 0;
   &efFechaDiv = @;

   fFechaEmision = @;
   aFiltro       = "";
   aAlfa         = "";
   aSerie        = "";
   nEmpGestion   = 0;
   nEmpRiesgo    = 0;

   Salir = 0;
   nCalc = 0;
   aLong = ""; nLong = 0;
   aParte1 = "";
   aParte2 = "";
   CodEnl  = "";
   aObserv = "";

   &enFPago      = 0;
   &nCamFPago    = 0;
   &fFechaFac    = @;
   &fFecVto      = @;
   &eaCliente    = "";
   fFechaHoy     = @;
   nSwBloq       = 0;
   nSwTagl       = 0;
   nCambio       = 0;
   nLiqAntesD    = 0;
   nLiqAntesB    = 0;
   nNumDoc       = 0;

   CuentaPreg = "";
   NumEntregas = 0;
   NumSelec    = 0;
   TotalSelec  = 0;
   Calc        = 0;
   nImpDiv     = 0;
   nImpBase    = 0;
   nNumEntrega = 0;
   Linea       = 0;
   LinCob      = 0;

   CtaCobro    = "";
   Comodin     = "";

   aResp       = "";
   aResp1      = "";

   nParte1     = 0;
   nParte2     = 0;
   nSalida     = 0;

   nSwSaldAutom = 0;

   aDCodCli    = "";
   aHCodCli    = "";
   aDCtaCli    = "";
   aHCtaCli    = "";
|FIN;

|PROCESO PuntoCuenta; |TIPO 6;
   nSalida = FSalida;

   Comodin = #dscaz039#Campo#;
   Comodin = Comodin - ".";
   |PARA; |SI FSalida ! 0; |HACIENDO;
      nParte1 = 100 + (((FSalida / 100) ! 0) - 1);
      nParte2 = ((((FSalida / 100) ! 0) + 1) * 100) + 99;
      aParte1 = #dscaz039#Campo# % nParte1;
      aParte2 = #dscaz039#Campo# % nParte2;
      |QBF aParte1; |QBF aParte2;
      Comodin = aParte1 + aParte2;
      aLong = Comodin % 0; nLong = aLong;
      nLong = MaxDigit - nLong;
      aLong = "0" * nLong;
      Comodin = aParte1 + aLong + aParte2;
      #dscaz039#Campo# = Comodin;
      |PINTA #dscaz039#Campo#;
      Comodin = Comodin - ".";
   |SIGUE;
   Comodin = #dscaz039#Campo#; |QBF Comodin;
   aLong = Comodin % 0; nLong = aLong;
   |SI nLong ! MaxDigit; |Y nLong ! 0;
      |MENAV "    Cuenta fuera de nivel";
      |ERROR;
   |FINSI;

   FSalida = nSalida;
|FPRC;

|PROCESO AntesCod; |TIPO 7;
   |SI aResp = "C";
      |MENSA "    <F2> Consulta de clientes";
   |SINO;
      |MENSA "    <F2> Consulta de proveedores";
   |FINSI;
|FPRC;

|RUTINA infw026;
   #dscaw026#0 = 000000001;
|FRUT;

|RUTINA supw026;
   #dscaw026#0 = 999999999;
|FRUT;

|RUTINA infw027;
   #dscaw027#0 = 000000001;
|FRUT;

|RUTINA supw027;
   #dscaw027#0 = 999999999;
|FRUT;

|PROCESO SaldaEntregaC;

   #dscam003#40 = #dscaw026#0;
   |LEE 101#dscam003.=;
   |SI FSalida = 0;
      |SI #dscam003#14 = "e"; |O #dscam003#14 = "E";   || Entrega a cuenta por compensar o compensada parcialmente
          #dscam004#17 = #dscam003#40;
          #dscam004#3 = 1;
          |LEE 000#dscam004.];
          |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
              CtaCobro = #dscam003#74; |QBF CtaCobro;
          |FINSI;

          |SI #dscam003#23 ! #dscam003#31;

             nImpDiv  = #dscam003#23;
            nImpBase = #dscam003#61; nNumEntrega = #dscam003#40;

            #dscam004#17 = #dscam003#40;
            #dscam004#3  = 1;
            |LEE 000#dscam004.];
            |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
               |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
                  Linea = #dscam004#3 + 1;
                  |LEE 000#dscam004.s;
               |SIGUE;
            |SINO;
               Linea = 1;
            |FINSI;

            |LIBERA #dscam003;
            fFechaEmision = ~;
            |SALVA_FICHA #dscam003;
            #dscam003#40 = #dscaw027#0;
            |LEE 101#dscam003.=;
            |SI FSalida = 0;
               fFechaEmision = #dscam003#4;
               efFechaDiv = #dscaw026#7;
               Divisa = #dscam003#57; |HAZ TomaDecim;
               nImpBase = (nImpDiv / CambioDivVn) ! 2;
               #dscam004#17 = #dscam003#40;
               #dscam004#3 = 1;
               |LEE 000#dscam004.];
               |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
                  |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
                     LinCob = #dscam004#3 + 1;
                     |LEE 000#dscam004.s;
                  |SIGUE;
               |SINO;
                  LinCob = 1;
               |FINSI;
               |DDEFECTO #dscam004;
               #dscam004#17 = #dscam003#40;
               #dscam004#3  = LinCob; LinCob = LinCob + 1;
               |GRABA 020#dscam004.b;
               #dscam004#0 = #dscam003#0;
               #dscam004#1 = #dscam003#1;
               #dscam004#2 = #dscam003#2;
               |SI CtaCobro = "";
                  #dscam004#4 = CuentaPreg;
               |SINO;
                  #dscam004#4 = CtaCobro;
               |FINSI;
               #dscam004#5 = "CAC";
               #dscam004#6 = fFechaEmision; ||fecha emision T10143;
               #dscam004#7 = #dscam003#23;
               |SI #dscam003#31 < nImpDiv;
                  nImpDiv = #dscam003#31;
                  nImpBase = (nImpDiv / CambioDivVn) ! 2;
               |FINSI;
               #dscam004#8  = nImpDiv; #dscam004#26 = nImpBase;
               #dscam004#15 = #dscam003#27;
               Comodin = ("000000000" + nNumEntrega) % -109;
               Comodin = "Cobro entr. " + Comodin;
               #dscam004#16 = Comodin;
               #dscam004#25 = #dscam003#61;
               #dscam004#40 = nNumEntrega;
               #dscam004#41 = Linea;
               #dscam004#33 = CambioDivVn;
               nCalc   = (nImpDiv / #dscam003#59) ! 2;
               #dscam004#24 = nImpBase - nCalc;
               |GRABA 020#dscam004.a; |LIBERA #dscam004;

               #dscam003#56 = #dscam003#56 + #dscam004#24;
               |SI #dscam003#31 ] nImpDiv;
                  #dscam003#23 = #dscam003#23 + nImpDiv;
                  #dscam003#61 = #dscam003#61 + nImpBase;
                  #dscam003#31 = #dscam003#31 - nImpDiv;
                  #dscam003#65 = #dscam003#31 - nImpBase;
               |SINO;
                  #dscam003#23 = #dscam003#31; nImpDiv = #dscam003#31;
                  #dscam003#61 = #dscam003#65; nImpBase = #dscam003#65;
                  #dscam003#31 = 0; #dscam003#65 = 0;
               |FINSI;
               |SI #dscam003#31 = 0;
                  #dscam003#14 = "L";
                  #dscam003#15 = "Recibo Liquidado";
               |SINO;
                  |SI #dscam003#23 = 0;
                     |SI #dscam003#16 = 0;
                        #dscam003#14 = "P";
                        #dscam003#15 = "Pendiente de cobro";
                     |SINO;
                        #dscam003#14 = "I";
                        #dscam003#15 = "Impagado";
                     |FINSI;
                  |SINO;
                     #dscam003#14 = "C";
                     #dscam003#15 = "Parcialmente cobrado";
                  |FINSI;
               |FINSI;
               #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
               #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
               #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
               #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
               #dscam003#31 = #dscam003#30 - #dscam003#23; #dscam003#65 = #dscam003#64 - #dscam003#61;
               |GRABA 020#dscam003.a; |LIBERA #dscam003;
               |SI #dscam003#31 = 0;
                  |BORRA 020#dscaw027.a;
               |SINO;
                  |SI #dscam003#31 ] nImpDiv;
                     #dscaw027#1 = #dscaw027#1 - nImpDiv;
                     #dscaw027#3 = #dscaw027#3 - nImpBase;
                  |SINO;
                     #dscaw027#1 = #dscaw027#1 - #dscam003#31;
                     #dscaw027#3 = #dscaw027#3 - #dscam003#65;
                  |FINSI;
                  #dscaw027#2 = " "; |GRABA 020#dscaw027.a;
                  |SI #dscaw027#1 = 0; |BORRA 020#dscaw027.a; |FINSI;
               |FINSI;
               eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw027#0; |HAZ ProcesaTempo;
            |FINSI;
|| Rebajo el riesgo de cliente y de su saldo a cuenta

            eaTipoOper = "-4-5";     nImporte = nImpBase;
            || enEmpCartera = #48#0;  enEmpGestion = #dscam003#46;
            enEmpCartera = -1;     enEmpGestion = #dscam003#46;
            eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
            |HAZ BucleRiesgo;
            |REPON_FICHA #dscam003;
            |LEE 101#dscam003.=;

||  Escribo el movimiento del recibo a cuenta y actualizo el recibo a cuenta
            efFechaDiv = #dscaw026#7;
            Divisa = #dscam003#57; |HAZ TomaDecim;

            |DDEFECTO #dscam004;
            #dscam004#17 = #dscam003#40;
            #dscam004#3  = Linea;
            |GRABA 020#dscam004.b;
            #dscam004#0 = #dscam003#0;
            #dscam004#1 = #dscam003#1;
            #dscam004#2 = #dscam003#2;
            aAlfa = #dscam003#74; |QBF aAlfa;
            |SI aAlfa = ""; aAlfa = CuentaPreg; |FINSI;
            #dscam004#4 = aAlfa;
            #dscam004#5 = "REC";
            #dscam004#6 =  fFechaEmision; ||fecha emision T10143;
            #dscam004#7 = #dscam003#23;
            |SI #dscam003#23 ] nImpDiv;
               #dscam004#8  = -nImpDiv; #dscam004#26 = -nImpBase;
               #dscam004#23 = nImpDiv;  #dscam004#32 = nImpBase;
            |SINO;
               #dscam004#8  = -#dscam003#31; #dscam004#26 = -#dscam003#65;
               #dscam004#23 = #dscam003#31;  #dscam004#32 = #dscam003#65;
            |FINSI;
            #dscam004#15 = #dscam003#27;
            Comodin = ("0000000000" + #dscaw027#0) % -110;
            Comodin = "Cobro Doc. " + Comodin;
            #dscam004#16 = Comodin;
            #dscam004#25 = #dscam003#61;
            #dscam004#33 = #dscam003#59;
            |GRABA 020#dscam004.a;
            |LIBERA #dscam004;

            nLiqAntesD = #dscam003#23;
            nLiqAntesB = #dscam003#61;
            |SI #dscam003#23 ] nImpDiv;
               #dscam003#23 = #dscam003#23 - nImpDiv;
               #dscam003#61 = #dscam003#61 - nImpBase;
               #dscam003#55 = #dscam003#55 + nImpDiv;
               #dscam003#68 = #dscam003#68 + nImpBase;
            |SINO;
               #dscam003#23 = -#dscam003#31; nImpDiv = #dscam003#31;
               #dscam003#61 = -#dscam003#65; nImpBase = #dscam003#65;
               #dscam003#55 = #dscam003#55 + #dscam003#31;
               #dscam003#68 = #dscam003#68 + #dscam003#65;
               #dscam003#31 = 0; #dscam003#65 = 0;
            |FINSI;
            |SI #dscam003#31 = #dscam003#23;
               #dscam003#14 = "L";
               #dscam003#15 = "Recibo Compensado";
            |SINO;
               |SI #dscam003#23 = 0;
                  #dscam003#14 = "e";
                  #dscam003#15 = "Pendiente de compensar";
               |SINO;
                  #dscam003#14 = "E";
                  #dscam003#15 = "Compensado parcialmente";
               |FINSI;
            |FINSI;
            #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
            #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
            #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
            #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
            #dscam003#31 = #dscam003#30 - #dscam003#23; #dscam003#65 = #dscam003#64 - #dscam003#61;
            |GRABA 020#dscam003.a;
            |SI #dscam003#23 = 0;
               |BORRA 020#dscaw026.a;
               NumEntregas = NumEntregas - 1;
            |SINO;
               |SI nLiqAntesD ] nImpDiv;
                  #dscaw026#1 = #dscaw026#1 - nImpDiv;
                  #dscaw026#3 = #dscaw026#3 - nImpBase;
               |SINO;
                  #dscaw026#1 = #dscaw026#1 - nLiqAntesD;
                  #dscaw026#3 = #dscaw026#3 - nLiqAntesB;
               |FINSI;
               #dscaw026#2 = " "; |GRABA 020#dscaw026.a;
            |FINSI;
            eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
            |GRABA 020#dscam003.a; |LIBERA #dscam003;
         |FINSI;
      |FINSI;
      |LIBERA #dscam003;
   |FINSI;

   |SI HayConta = 1; |Y #dscaz039#4 ! "    ";
      |ABRE #dscam030;
      #dscam030#0 = #dscaz039#4;
      |LEE 000#dscam030.=;
      |SI FSalida = 0;
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #12 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         Comodin = #dscaz039#4;
         |SI nSwSaldAutom = 0;
            |DDEFECTO #dscaw013;
            #dscaw013#0  = 1;            #dscaw013#15 = Comodin;
            #dscaw013#5  = nNumEntrega;  #dscaw013#6  = nNumEntrega;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 40;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#0  = 2;            #dscaw013#15 = Comodin;
            #dscaw013#3  = "CAC";        #dscaw013#4  = "CAC";
            #dscaw013#11 = "A";          #dscaw013#12 = 3;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
            |GRABA 020#dscaw013.n;
         |SINO;
            |DDEFECTO #dscaw013;
            #dscaw013#0  = 1;            #dscaw013#15 = Comodin;
            #dscaw013#5  = #dscaw027#0;  #dscaw013#6  = #dscaw027#0;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#0  = 2;            #dscaw013#15 = Comodin;
            #dscaw013#5  = LinCob - 1;   #dscaw013#6  = LinCob - 1;
            #dscaw013#11 = "N";          #dscaw013#12 = 3;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
            |GRABA 020#dscaw013.n;
         |FINSI;

         |CIERRA #dscaw013;
         Comodin = "dscam033.tab;" + Comodin;
         |LIBERA #dscam003; |CIERRAT #dscam003;
         |LIBERA #dscam004; |CIERRAT #dscam004;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam003; |LEE 000#dscam003.=;
         |ABRET #dscam004; |LEE 000#dscam004.=;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
      |FINSI;
      |CIERRA #dscam030;
   |FINSI;
   eaCliente = #dscam003#32; |HAZ MiraBloqueoRiesgo;

   |PONCONTROL 23, "si";
|FPRC;

|PROCESO SaldaEntregaP;
   #dscam008#40 = #dscaw026#0;
   |LEE 101#dscam008.=;
   |SI FSalida = 0;
      |SI #dscam008#14 = "e"; |O #dscam008#14 = "H";   || Entrega a cuenta por compensar o compensada parcialmente
         #dscam009#14 = #dscam008#40; #dscam009#3 = 1;
         |LEE 000#dscam009.];
         |SI FSalida = 0; |Y #dscam009#14 = #dscam008#40;
            CtaCobro = "";
            || CtaCobro = #dscam003#74; |QBF CtaCobro;
         |FINSI;

     ||    |SI #dscam008#23 ! #dscam008#31; Tiquet: 1483/2168
         |SI #dscam008#25 ! #dscam008#31;

            nImpBase = #dscam008#57; nNumEntrega = #dscam008#40;
            nImpDiv  = #dscam008#23; nCambio = #dscam008#61;

            #dscam009#14 = #dscam008#40;
            #dscam009#3  = 1;
            |LEE 000#dscam009.];
            |SI FSalida = 0; |Y #dscam009#14 = #dscam008#40;
               |PARA; |SI FSalida = 0; |Y #dscam009#14 = #dscam008#40; |HACIENDO;
                  Linea = #dscam009#3 + 1;
                  |LEE 000#dscam009.s;
               |SIGUE;
            |SINO;
               Linea = 1;
            |FINSI;

            |LIBERA #dscam008;
            |SALVA_FICHA #dscam008;
            #dscam008#40 = #dscaw027#0;
            |LEE 101#dscam008.=;
            |SI FSalida = 0;
               fFechaEmision = #dscam008#4;
               efFechaDiv = #dscaw026#7;
               Divisa = #dscam008#59; |HAZ TomaDecim;
               |SI nImpDiv > #dscaw027#1;
                  nImpDiv = #dscaw027#1;
                  nImpBase = nImpDiv / nCambio;
               |FINSI;

               #dscam009#14 = #dscam008#40;
               #dscam009#3 = 1;
               |LEE 000#dscam009.];
               |SI FSalida = 0; |Y #dscam009#14 = #dscam008#40;
                  |PARA; |SI FSalida = 0; |Y #dscam009#14 = #dscam008#40; |HACIENDO;
                     LinCob = #dscam009#3 + 1;
                     |LEE 000#dscam009.s;
                  |SIGUE;
               |SINO;
                  LinCob = 1;
               |FINSI;
               |DDEFECTO #dscam009;
               #dscam009#14 = #dscam008#40;
               #dscam009#3  = LinCob; LinCob = LinCob + 1;
               |GRABA 020#dscam009.b;
               #dscam009#0 = #dscam008#0;
               #dscam009#1 = #dscam008#1;
               #dscam009#2 = #dscam008#2;
               #dscam009#4 = CuentaPreg;
               #dscam009#5 = "CAC";
               #dscam009#6 = fFechaEmision;
               #dscam009#7 = #dscam008#23;
               #dscam009#8  = nImpDiv;
               #dscam009#21 = nImpBase;
               #dscam009#13 = #dscam008#27;
               Comodin = ("000000000" + nNumEntrega) % -109;
               Comodin = "Pago entr. " + Comodin;
               #dscam009#17 = Comodin;
               #dscam009#20 = #dscam008#57;
               #dscam009#35 = nNumEntrega;
               #dscam009#36 = Linea;
               #dscam009#25 = nCambio;
               nCalc   = nImpDiv / #dscam008#61;
               #dscam009#26 = nImpBase - nCalc;
               |GRABA 020#dscam009.a; |LIBERA #dscam009;

               #dscam008#62 = #dscam008#62 + #dscam009#26;
               #dscam008#25 = #dscam008#22 + #dscam008#24 + #dscam008#38;
               #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55 + #dscam008#62;

               #dscam008#23 = #dscam008#23 + nImpDiv;
               #dscam008#57 = #dscam008#57 + nImpBase;
               #dscam008#31 = #dscam008#25 - #dscam008#23; #dscam008#58 = #dscam008#56 - #dscam008#57;

               |SI #dscam008#31 = 0;
                  #dscam008#14 = "L";
                  #dscam008#15 = "Recibo Liquidado";
               |SINO;
                  |SI #dscam008#23 = 0;
                     #dscam008#14 = "P";
                     #dscam008#15 = "Pendiente de pago";
                  |SINO;
                     #dscam008#14 = "C";
                     #dscam008#15 = "Parcialmente pagado";
                  |FINSI;
               |FINSI;
               |GRABA 020#dscam008.a; |LIBERA #dscam008;
               |SI #dscam008#31 = 0;
                  |BORRA 020#dscaw027.a;
               |SINO;
                  #dscaw027#1 = #dscaw027#1 - nImpDiv;
                  #dscaw027#3 = #dscaw027#3 - nImpBase;
                  #dscaw027#2 = " "; |GRABA 020#dscaw027.a;
                  |SI #dscaw027#1 = 0; |BORRA 020#dscaw027.a; |FINSI;
               |FINSI;
               eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaw027#0; |HAZ ProcesaTempo;
            |FINSI;

            |REPON_FICHA #dscam008;
            |LEE 101#dscam008.=;

||  Escribo el movimiento del recibo a cuenta y actualizo el recibo a cuenta
            efFechaDiv = #dscaw026#7;
            Divisa = #dscam008#59; |HAZ TomaDecim;

            |DDEFECTO #dscam009;
            #dscam009#14 = #dscam008#40;
            #dscam009#3  = Linea;
            |GRABA 020#dscam009.b;
            #dscam009#0 = #dscam008#0;
            #dscam009#1 = #dscam008#1;
            #dscam009#2 = #dscam008#2;
            |SI CtaCobro = "";
               #dscam004#4 = CuentaPreg;
            |SINO;
               #dscam004#4 = CtaCobro;
            |FINSI;
            #dscam009#5 = "REC";
            #dscam009#6 = fFechaEmision;
            #dscam009#7 = #dscam008#23;
            #dscam009#8  = -nImpDiv; #dscam009#21 = -nImpBase;
            #dscam009#13 = #dscam008#27;
            Comodin = ("0000000000" + #dscaw027#0) % -110;
            Comodin = "Pago Doc. " + Comodin;
            #dscam009#17 = Comodin;
            #dscam009#20 = #dscam008#57;
            #dscam009#25 = #dscam008#61;
            |GRABA 020#dscam009.a; |LIBERA #dscam009;

            #dscam008#23 = #dscam008#23 - nImpDiv;
            #dscam008#57 = #dscam008#57 - nImpBase;
            #dscam008#25 = #dscam008#22 + #dscam008#24 + #dscam008#38;
            #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55 + #dscam008#62;
            #dscam008#31 = #dscam008#25 - #dscam008#23;
            #dscam008#58 = #dscam008#56 - #dscam008#57;

           || Tiquet:1483/2160
            |SI #dscam008#31 = #dscam008#25;
               #dscam008#14 = "L";
               #dscam008#15 = "Recibo Compensado";
            |SINO;
               |SI #dscam008#23 = 0;
                  #dscam008#14 = "e";
                  #dscam008#15 = "Pendiente de compensar";
               |SINO;
                  #dscam008#14 = "H";
                  #dscam008#15 = "Compensado parcialmente";
               |FINSI;
            |FINSI;
            |GRABA 020#dscam008.a;

            |SI #dscam008#23 = 0;
               |BORRA 020#dscaw026.a;
               NumEntregas = NumEntregas - 1;
            |SINO;
               |SI #dscam008#23 ] nImpDiv;
                  #dscaw026#1 = #dscaw026#1 - nImpDiv;
                  #dscaw026#3 = #dscaw026#3 - nImpBase;
               |SINO;
                  #dscaw026#1 = #dscaw026#1 - #dscam008#23;
                  #dscaw026#3 = #dscaw026#3 - #dscam008#57;
               |FINSI;
               #dscaw026#2 = " "; |GRABA 020#dscaw026.a;
            |FINSI;
            eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
            |GRABA 020#dscam008.a; |LIBERA #dscam008;
         |FINSI;
      |FINSI;
      |LIBERA #dscam008;
   |FINSI;

   |SI HayConta = 1; |Y #dscaz039#4 ! "    ";
      |ABRE #dscam030;
      #dscam030#0 = #dscaz039#4;
      |LEE 000#dscam030.=;
      |SI FSalida = 0;
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #12 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         Comodin = #dscaz039#4;
         |SI nSwSaldAutom = 0;
            |DDEFECTO #dscaw013;
            #dscaw013#0  = 1;            #dscaw013#15 = Comodin;
            #dscaw013#5  = nNumEntrega;  #dscaw013#6  = nNumEntrega;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            #dscaw013#13 = "dscam009";   #dscaw013#14 = 35;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#0  = 2;            #dscaw013#15 = Comodin;
            #dscaw013#3  = "CAC";        #dscaw013#4  = "CAC";
            #dscaw013#11 = "A";          #dscaw013#12 = 3;
            #dscaw013#13 = "dscam009";   #dscaw013#14 = 5;
            |GRABA 020#dscaw013.n;
         |SINO;
            |DDEFECTO #dscaw013;
            #dscaw013#0  = 1;            #dscaw013#15 = Comodin;
            #dscaw013#5  = #dscaw027#0;  #dscaw013#6  = #dscaw027#0;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            #dscaw013#13 = "dscam009";   #dscaw013#14 = 14;
            |GRABA 020#dscaw013.n;

            |DDEFECTO #dscaw013;
            #dscaw013#0  = 2;            #dscaw013#15 = Comodin;
            #dscaw013#5  = LinCob - 1;   #dscaw013#6  = LinCob - 1;
            #dscaw013#11 = "N";          #dscaw013#12 = 3;
            #dscaw013#13 = "dscam009";   #dscaw013#14 = 3;
            |GRABA 020#dscaw013.n;
         |FINSI;

         |CIERRA #dscaw013;
         Comodin = "dscam033.tab;" + Comodin;
         |LIBERA #dscam008; |CIERRAT #dscam008;
         |LIBERA #dscam009; |CIERRAT #dscam009;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam008; |LEE 000#dscam008.=;
         |ABRET #dscam009; |LEE 000#dscam009.=;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
      |FINSI;
      |CIERRA #dscam030;
   |FINSI;
   |PONCONTROL 23, "si";
|FPRC;

|PROCESO SaldaEntrega;
   #dscaz039#4 = CodEnl;
   |SI aResp = "C";
      |HAZ SaldaEntregaC;
   |SINO;
      |HAZ SaldaEntregaP;
   |FINSI;
|FPRC;

|DEFBUCLE SaldaEntrega;
#dscaw027#1;
2;
000000001,"*";
999999999,"*";
;
NULL,SaldaEntrega;
|FIN;

|PROCESO DesmarcaTodo;
   #dscaw027#2 = " "; |GRABA 020#dscaw027.a;
   |SI aResp = "C";
      eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw027#0; |HAZ ProcesaTempo;
   |SINO;
      eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaw027#0; |HAZ ProcesaTempo;
   |FINSI;
|FPRC;

|DEFBUCLE DesmarcaTodo;
#dscaw027#1;
;
INICIO;
FINAL;
be;
NULL,DesmarcaTodo;
|FIN;

|PROCESO Intro;
   |SI #dscaw026#2 = " ";
      enSwError = 0;
      |SI aResp = "C";
         eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
      |SINO;
         eaTOperacion = "A"; eaTipoRecibo = "C"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
      |FINSI;
      |SI enSwError = 0;
         |SI aResp = "C";
            nEmpRiesgo = 0; nEmpGestion = #dscaw026#6;
            aSerie = #dscaw026#5; nEmpGestion = #dscaw026#6; |HAZ MiraEmpRiesgo;
         |SINO;
            nEmpRiesgo = 0; nEmpGestion = #dscaw026#6;
            aSerie = #dscaw026#5; nEmpGestion = #dscaw026#6;
         |FINSI;

         #dscaw026#2 = "*"; |PINTA #dscaw026#2; |GRABA 020#dscaw026.a;
         NumSelec = 0;
         |ENTLINEAL #1#dscaw027,-1,4,21,1,infw027,supw027;
         |SI NumSelec ! 0;

            |ABRE #dscam051;
            |LEE 000#dscam051.p;
            |SI FSalida ! 0;
               |DDEFECTO #dscam051;
            |FINSI;
            |CIERRA #dscam051;

            |PARA Salir = 1; |SI Salir = 1; |HACIENDO;
               |SI aResp = "C"; #dscaz039#4 = #dscam051#70;  |FINSI;
               |SI aResp = "P"; #dscaz039#4 = #dscam051#116; |FINSI;
               E_sup = 12; E_inf = ""; CuentaPreg = "";
               |PUSHV 2128 2352; |BLANCO 2128 2352; |CUADRO 2128 2352;
               |ATRI R; |PINTA 2129, " Cuenta cobro  Cod.Enl."; |ATRI N;
               |PINTA 2230, #dscaz039#3; |PINTA 2246, #dscaz039#4;
               |MENSA "    <F2> Consulta cuentas contables";
               |ET OtraCta;
               CuentaPreg = 2230 ? 0;
               |SI FSalida = 0;
                  Comodin = CuentaPreg;
                  Comodin = Comodin - ".";
                  |SI FSalida ! 0;
                     Calc = (((FSalida / 100) ! 0) - 1) + 100;
                     aParte1 = Comodin % Calc;
                     Calc = FSalida + 98;
                     aParte2 = Comodin % Calc; |QBF aParte2;
                     aLong = aParte1 % 0; nLong = aLong;
                     aLong = aParte2 % 0; Calc = aLong; nLong = nLong + Calc;
                     nLong = MaxDigit - nLong;
                     Comodin = "0" * nLong;
                     CuentaPreg = aParte1 + Comodin + aParte2;
                     #0#3 = CuentaPreg; |PINTA 2230,#0#3;
                  |FINSI;

                  |SI #dscam051#1 = "S";
                     |MENSA "    <F2> Consulta codigos enlace";
                     E_sup = 4; E_inf = ""; CodEnl = #dscaz039#4;
                     |ET OtroCod;
                     CodEnl = 2246 ? 0;
                     |SI FSalida ! 0;
                        |SI FSalida = 10;
                           |ABRE #dscam030;
                           #dscam030#0 = CodEnl;
                           |LEE 000#dscam030.];
                           |CONSULTA_CLAVE #1#dscam030;
                           |SI FSalida = 0;
                              CodEnl = #dscam030#0;
                           |FINSI;
                           |CIERRA #dscam030;
                           |VETE OtroCod;
                        |SINO;
                           |BUCLE DesmarcaTodo;
                           TotalSelec = 0;
                           #dscaw026#2 = " "; |PINTA #dscaw026#2; |GRABA 020#dscaw026.a;
                           |SI aResp = "C";
                              eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
                           |SINO;
                              eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
                           |FINSI;
                           |POPV; |SAL;
                        |FINSI;
                     |FINSI;
                     |BLIN 4;
                  |FINSI;
               |SINO;
                  |SI FSalida = 10;
                     aAlfa = #48#16; |QBF aAlfa;
                     aAlfa = aAlfa + "def/cacuenta.mas";
                     |CARGA_DEF aAlfa, cacuenta@;
                     |SI FSalida = 0;
                        aAlfa = #48#16; |QBF aAlfa;
                        aAlfa = aAlfa + "fich/" + (("00000" + #48#14) % -105) + #48#19 + "/";
                        |PATH_DAT #100 aAlfa;
                        |ABRE #cacuenta@;
                        #cacuenta@#0 = CuentaPreg;
                        |LEE 000#cacuenta@.];
                        |CONSULTA_CLAVE #1#cacuenta@;
                        |SI FSalida = 0;
                           CuentaPreg = #cacuenta@#0;
                        |FINSI;
                        |CIERRA #cacuenta@;
                        |VETE OtraCta;
                     |FINSI;
                  |SINO;
                     |BUCLE DesmarcaTodo;
                     TotalSelec = 0;
                     #dscaw026#2 = " "; |PINTA #dscaw026#2; |GRABA 020#dscaw026.a;
                     |SI aResp = "C";
                        eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
                     |SINO;
                        eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
                     |FINSI;
                     |POPV; |SAL;
                  |FINSI;
               |FINSI;
               |POPV;
               |CONFI "    SES CORRECTO?";
               |SI FSalida = 0; Salir = 0; |FINSI;
            |SIGUE;

            |SI Salir = 0;
               |CONFI "    NConforme con los datos especificados ?";
               |SI FSalida = 0;
                  |SI aResp = "C";
                     |ABRE #dscam003; |ABRE #dscam004;
                  |SINO;
                     |ABRE #dscam008; |ABRE #dscam009;
                  |FINSI;
                  |BUCLE SaldaEntrega; |PTEC 815; |PTEC 814;
                  TotalSelec = 0;
                  |SI aResp = "C";
                     |CIERRA #dscam004; |CIERRA #dscam003;
                  |SINO;
                     |CIERRA #dscam008; |CIERRA #dscam009;
                  |FINSI;
               |SINO;
                  |BUCLE DesmarcaTodo;
                  #dscaw026#2 = " "; |PINTA #dscaw026#2; |GRABA 020#dscaw026.a;
                  |SI aResp = "C";
                     eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
                  |SINO;
                     eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            #dscaw026#2 = " "; |PINTA #dscaw026#2; |GRABA 020#dscaw026.a;
            |SI aResp = "C";
               eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
            |SINO;
               eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
            |FINSI;
         |FINSI;
         |ENTLINEAL #1#dscaw027,-1,7,21,1,infw027,supw027;
         |SI NumEntregas = 0; |PTEC 807; |FINSI;
      |FINSI;
   |SINO;
      #dscaw026#2 = " "; |GRABA 020#dscaw026.a;
      |SI aResp = "C";
         eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
      |SINO;
         eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO CreaDoc;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
   |FINSI;
   |CIERRA #dscam051;

   |PARA Salir = 1; |SI Salir = 1; |HACIENDO;
      |SI aResp = "C"; #dscaz039#4 = #dscam051#70;  |FINSI;
      |SI aResp = "P"; #dscaz039#4 = #dscam051#116; |FINSI;
      E_sup = 12; E_inf = ""; CuentaPreg = ""; aObserv = "";
      |PUSHV 2023 2357; |BLANCO 2023 2357; |CUADRO 2023 2357;
      |ATRI R; |PINTA 2024, "      Cuenta cobro  Cod.Enl.     "; |ATRI N;
      |PINTA 2130, #dscaz039#3; |PINTA 2146, #dscaz039#4;
      |PINTA 2225, #dscaz039#6;
      |MENSA "    <F2> Consulta cuentas contables";
      |ET OtraCta1;
      CuentaPreg = 2130 ? 0;
      |SI FSalida = 0;
         Comodin = CuentaPreg;
         Comodin = Comodin - ".";
         |SI FSalida ! 0;
            Calc = (((FSalida / 100) ! 0) - 1) + 100;
            aParte1 = Comodin % Calc;
            Calc = FSalida + 98;
            aParte2 = Comodin % Calc; |QBF aParte2;
            aLong = aParte1 % 0; nLong = aLong;
            aLong = aParte2 % 0; Calc = aLong; nLong = nLong + Calc;
            nLong = MaxDigit - nLong;
            Comodin = "0" * nLong;
            CuentaPreg = aParte1 + Comodin + aParte2;
            #0#3 = CuentaPreg; |PINTA 2130,#0#3;
         |FINSI;

         |SI #dscam051#1 = "S";
            |MENSA "    <F2> Consulta codigos enlace";
            E_sup = 4; E_inf = ""; CodEnl = #dscaz039#4;
            |ET OtroCod1;
            CodEnl = 2146 ? 0;
            |SI FSalida ! 0;
               |SI FSalida = 10;
                  |ABRE #dscam030;
                  #dscam030#0 = CodEnl;
                  |LEE 000#dscam030.];
                  |CONSULTA_CLAVE #1#dscam030;
                  |SI FSalida = 0;
                     CodEnl = #dscam030#0;
                  |FINSI;
                  |CIERRA #dscam030;
                  |VETE OtroCod1;
               |SINO;
                  |BUCLE DesmarcaTodo;
                  TotalSelec = 0;
                  #dscaw026#2 = " "; |PINTA #dscaw026#2; |GRABA 020#dscaw026.a;
                  |SI aResp = "C";
                     eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
                  |SINO;
                     eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
                  |FINSI;
                  |POPV; |SAL;
               |FINSI;
            |SINO;
               |MENSA "    Observaciones";
               E_sup = 30; E_inf = "";
               aObserv = 2225 ? 0;
               |SI FSalida ! 0;
                  |BUCLE DesmarcaTodo;
                  TotalSelec = 0;
                  #dscaw026#2 = " "; |PINTA #dscaw026#2; |GRABA 020#dscaw026.a;
                  |SI aResp = "C";
                     eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
                  |SINO;
                     eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
                  |FINSI;
                  |POPV; |SAL;
               |FINSI;
            |FINSI;
            |BLIN 4;
         |SINO;
            |MENSA "    Observaciones";
            E_sup = 30; E_inf = "";
            aObserv = 2225 ? 0;
            |SI FSalida ! 0;
               |BUCLE DesmarcaTodo;
               TotalSelec = 0;
               #dscaw026#2 = " "; |PINTA #dscaw026#2; |GRABA 020#dscaw026.a;
               |SI aResp = "C";
                  eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
               |SINO;
                  eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
               |FINSI;
               |POPV; |SAL;
            |FINSI;
            |BLIN 4;
         |FINSI;
      |SINO;
         |SI FSalida = 10;
            aAlfa = #48#16; |QBF aAlfa;
            aAlfa = aAlfa + "def/cacuenta.mas";
            |CARGA_DEF aAlfa, cacuenta@;
            |SI FSalida = 0;
               aAlfa = #48#16; |QBF aAlfa;
               aAlfa = aAlfa + "fich/" + (("00000" + #48#14) % -105) + #48#19 + "/";
               |PATH_DAT #100 aAlfa;
               |ABRE #cacuenta@;
               #cacuenta@#0 = CuentaPreg;
               |LEE 000#cacuenta@.];
               |CONSULTA_CLAVE #1#cacuenta@;
               |SI FSalida = 0;
                  CuentaPreg = #cacuenta@#0;
               |FINSI;
               |CIERRA #cacuenta@;
               |VETE OtraCta1;
            |FINSI;
         |SINO;
            |BUCLE DesmarcaTodo;
            TotalSelec = 0;
            #dscaw026#2 = " "; |PINTA #dscaw026#2; |GRABA 020#dscaw026.a;
            |SI aResp = "C";
               eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
            |SINO;
               eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaw026#0; |HAZ ProcesaTempo;
            |FINSI;
            |POPV; |SAL;
         |FINSI;
      |FINSI;
      |POPV;
      |CONFI "    SES CORRECTO ?";
      |SI FSalida = 0; Salir = 0; |FINSI;
   |SIGUE;

   |SI Salir = 0;
      |CONFI "    NConforme con los datos especificados ?";
      |SI FSalida = 0;
         #dscaw026#2 = "*"; |GRABA 020#dscaw026.a;
         |SI aResp = "C";
               |HAZ CompesaVta;
         |SINO;
               |HAZ CompesaCom;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO CompesaVta;
     |ABRE #dscam003;
     |ABRE #dscam004;

     |LEE 000#dscam003.u;
     nNumDoc = #dscam003#40 + 1;

     #dscam003#40 = #dscaw026#0;
     |LEE 000#dscam003.=;
     |SI FSalida = 0;
        #dscam003#40 = nNumDoc;
        |GRABA 020#dscam003.b;

        #dscam003#1  = 0;
        #dscam003#2  = 0;
        #dscam003#27 = 0;
        #dscam003#16 = 0;
        #dscam003#17 = 0;
        #dscam003#37 = 0;
        #dscam003#35 = "";
        #dscam003#36 = aObserv;
        #dscam003#47 = "N";
        #dscam003#69 = " ";
        #dscam003#70 = "";
        #dscam003#72 = "";

        #dscam003#25 = 0;           #dscam003#63 = 0;
        #dscam003#55 = 0;           #dscam003#68 = 0;
        #dscam003#22 = #dscaw026#1; #dscam003#60 = #dscaw026#3;
        #dscam003#30 = #dscaw026#1; #dscam003#64 = #dscaw026#3;
        #dscam003#23 = 0;           #dscam003#61 = 0;
        #dscam003#31 = #dscaw026#1; #dscam003#65 = #dscaw026#3;
        #dscam003#14 = "P";         #dscam003#15 = "Pendiente de cobro";
        |GRABA 020#dscam003.a; |LIBERA #dscam003;

        || ... lo incluyo en el riesgo de facturas para que al saldar no
        || me deje un saldo negativo ...
        eaTipoOper = "+4";     nImporte = #dscam003#30;
        enEmpCartera = -1;     enEmpGestion = #dscam003#46;
        eaSerie = #dscam003#0; eaCliGest = #dscam003#32;
        |HAZ BucleRiesgo;

        |DDEFECTO #dscaw027;
        #dscaw027#0 = #dscam003#40;
        #dscaw027#1 = #dscam003#31;
        #dscaw027#2 = "*";
        #dscaw027#3 = #dscam003#65;
        #dscaw027#4 = #dscam003#57;
        #dscaw027#5 = #dscam003#0;
        #dscaw027#6 = #dscam003#46;
        |GRABA 020#dscaw027.c;

        nSwSaldAutom = 1;
        |BUCLE SaldaEntrega; |PTEC 815; |PTEC 814;
        nSwSaldAutom = 0;
        TotalSelec = 0;
     |FINSI;
     |CIERRA #dscam004;
     |CIERRA #dscam003;
|FPRC;

|PROCESO CompesaCom;     ||Tiquet:1483/2160
     |ABRE #dscam008;
     |ABRE #dscam009;
     |LEE 000#dscam008.u;
     nNumDoc = #dscam008#40 + 1;

     #dscam008#40 = #dscaw026#0;
     |LEE 000#dscam008.=;
     |SI FSalida = 0;
        #dscam008#40 = nNumDoc;
        |GRABA 020#dscam008.b;

        #dscam008#1  = 0;
        #dscam008#2  = 0;
        #dscam008#27 = 0;
        #dscam008#16 = 0;
        #dscam008#17 = 0;
        #dscam008#37 = 0;
        #dscam008#35 = "";
        #dscam008#36 = aObserv;
        #dscam008#74 = "";

        #dscam008#22 = #dscaw026#1; #dscam008#53 = #dscaw026#3;  ||Imp Reci
        #dscam008#23 = 0;           #dscam008#57 = 0;            ||Liquida
        #dscam008#24 = 0;           #dscam008#54 = 0;            ||G.Nego
        #dscam008#25 = #dscaw026#1; #dscam008#56 = #dscaw026#3;  ||Tota Reci
        #dscam008#31 = #dscaw026#1; #dscam008#58 = #dscaw026#3;  ||Pdte
        #dscam008#30 = 0;           #dscam008#55 = 0;            ||Otros
        #dscam008#14 = "P";         #dscam008#15 = "Pendiente de cobro";
        |GRABA 020#dscam008.a; |LIBERA #dscam008;

        || ... lo incluyo en el riesgo de facturas para que al saldar no
        || me deje un saldo negativo ...
        eaTipoOper = "+4";     nImporte = #dscam008#25;
        enEmpCartera = -1;     enEmpGestion = #dscam008#46;
        eaSerie = #dscam008#0; eaCliGest = #dscam008#32;
        |HAZ BucleRiesgo;

        |DDEFECTO #dscaw027;
        #dscaw027#0 = #dscam008#40;
        #dscaw027#1 = #dscam008#31;
        #dscaw027#2 = "*";
        #dscaw027#3 = #dscam008#58;
        #dscaw027#4 = #dscam008#59;
        #dscaw027#5 = #dscam008#0;
        #dscaw027#6 = #dscam008#46;
        |GRABA 020#dscaw027.c;

        nSwSaldAutom = 1;
        |BUCLE SaldaEntrega; |PTEC 815; |PTEC 814;
        nSwSaldAutom = 0;
        TotalSelec = 0;
     |FINSI;
     |CIERRA #dscam008;
     |CIERRA #dscam009;
|FPRC;

|PROCESO Lineasw026; |TIPO 13;
   |SI FSalida = 10;
      |HAZ Intro;
   |FINSI;
   |SI FSalida = 11;
      |SI aResp = "C";
         |ABRE #dscam003;
         #dscam003#40 = #dscaw026#0;
         |LEE 000#dscam003.=;
         |SI FSalida = 0;
            |PUSHV 0501 2380;
            |PINPA #0#dscam003; |PINDA #0#dscam003;
            |PAUSA; |POPV;
         |FINSI;
         |CIERRA #dscam003;
      |SINO;
         |ABRE #dscam008;
         #dscam008#40 = #dscaw026#0;
         |LEE 000#dscam008.=;
         |SI FSalida = 0;
            |PUSHV 0501 2380;
            |PINPA #0#dscam008; |PINDA #0#dscam008;
            |PAUSA; |POPV;
         |FINSI;
         |CIERRA #dscam008;
      |FINSI;
   |FINSI;
   |SI FSalida = 12;
      aAlfa = "    NEste proceso creara un documento con el que se saldara la entrega actual. " + &191 + " Continuar ?";
      |CONFI aAlfa;
      |SI FSalida = 0;
         |HAZ CreaDoc;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO MiraEmpRiesgo;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0; |DDEFECTO #dscam051; |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#3 = "S";
      |SI nEmpGestion = 0; nEmpRiesgo = #48#0; |ACABA; |FINSI;

      |DFICB aAlfa; |QBF aAlfa; |PATH_DAT #dscam038#aAlfa#;
      |ABRE #dscam038;
      #dscam038#0 = nEmpGestion;
      #dscam038#1 = 0;
      |LEE 000#dscam038.];
      |PARA; |SI FSalida = 0; |Y #dscam038#0 = nEmpGestion; |HACIENDO;
         |SI #dscam038#2 = "F";
            |SI aSerie ] #dscam038#3; |Y aSerie [ #dscam038#4;
               nEmpRiesgo = #dscam038#5; |SAL;
            |FINSI;
         |FINSI;
         |LEE 000#dscam038.s;
      |SIGUE;
      |CIERRA #dscam038;
   |FINSI;
|FPRC;

|PROCESO Lineasw027; |TIPO 13;
   |SI FSalida = 10;
      |SI #dscaw027#2 = "*";
         eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw027#0; |HAZ ProcesaTempo;
         #dscaw027#2 = " ";
         NumSelec = NumSelec - 1;
         TotalSelec = TotalSelec - #dscaw027#1;
      |SINO;
         |SI TotalSelec > #dscaw026#1;
            |MENAV "    La entrega ya estaria saldada con los recibos seleccionados";
            |ERROR;
         |SINO;
            nCalc = nEmpRiesgo;
            aSerie = #dscaw027#5; nEmpGestion = #dscaw027#6; |HAZ MiraEmpRiesgo;
            |SI nCalc ! nEmpRiesgo; |Y aResp = "C";
               |MENAV "    Los riesgos de la entrega y el recibo no irian a la misma empresa de cartera";
               nEmpRiesgo = nCalc;
               |ERROR; |ACABA;
            |FINSI;
            |SI #dscaw026#4 ! #dscaw027#4;
               |MENAV "    Se esta intentando compensar documentos de distinta divisa. Proceso cancelado";
               |ERROR; |ACABA;
            |FINSI;
            enSwError = 0;
            eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscaw027#0; |HAZ ProcesaTempo;
            |SI enSwError = 0;
               #dscaw027#2 = "*";
               NumSelec = NumSelec + 1;
               TotalSelec = TotalSelec + #dscaw027#1;
            |FINSI;
         |FINSI;
      |FINSI;
      |GRABA 020#dscaw027.a;
   |FINSI;
   |SI FSalida = 11;
      |SI aResp = "C";
         |ABRE #dscam003;
         #dscam003#40 = #dscaw027#0;
         |LEE 000#dscam003.=;
         |SI FSalida = 0;
            |PUSHV 0501 2380;
            |PINPA #0#dscam003; |PINDA #0#dscam003;
            |PAUSA; |POPV;
         |FINSI;
         |CIERRA #dscam003;
      |SINO;
         |ABRE #dscam008;
         #dscam008#40 = #dscaw027#0;
         |LEE 000#dscam008.=;
         |SI FSalida = 0;
            |PUSHV 0501 2380;
            |PINPA #0#dscam008; |PINDA #0#dscam008;
            |PAUSA; |POPV;
         |FINSI;
         |CIERRA #dscam008;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO RellenaTempo1C;
   enSwClas   = 1; eaFichClas = "dscaz039"; eaTipoClas = #dscam003#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |ACABA; |FINSI;

   |SI #dscam003#47 ! "S"; |Y #dscam003#69 = " "; |ACABA; |FINSI;
   |SI #dscam003#61 = 0; |ACABA; |FINSI;

   |DDEFECTO #dscaw026;
   #dscaw026#0 = #dscam003#40;
   #dscaw026#1 = #dscam003#23;
   #dscaw026#3 = #dscam003#61;
   #dscaw026#4 = #dscam003#57;
   #dscaw026#5 = #dscam003#0;
   #dscaw026#6 = #dscam003#46;
   #dscaw026#7 = #dscam003#4;
   ||SI #dscam003#47 = "S"; |Y #dscam003#69 = " "; #dscaw026#6 = 0; |FINSI;

   |GRABA 020#dscaw026.n;
   NumEntregas = NumEntregas + 1;
|FPRC;

|DEFBUCLE RellenaTempo1C;
#dscam003#1;
32, 5;
000000001,aDCodCli,aDCtaCli;
999999999,aHCodCli,aHCtaCli;
;
NULL,RellenaTempo1C;
|FIN;

|PROCESO RellenaTempo1P;
   enSwClas   = 1; eaFichClas = "dscaz039"; eaTipoClas = #dscam008#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |ACABA; |FINSI;

   |SI #dscam008#74 ! "S"; |ACABA; |FINSI;
   |SI #dscam008#57 = 0;   |ACABA; |FINSI;
   |SI #dscam008#14 = "L"; |ACABA; |FINSI;

   |DDEFECTO #dscaw026;
   #dscaw026#0 = #dscam008#40;
   #dscaw026#1 = #dscam008#23;
   #dscaw026#3 = #dscam008#57;
   #dscaw026#4 = #dscam008#59;
   #dscaw026#5 = #dscam008#0;
   #dscaw026#6 = #dscam008#46;
   |GRABA 020#dscaw026.n;
   NumEntregas = NumEntregas + 1;
|FPRC;

|DEFBUCLE RellenaTempo1P;
#dscam008#1;
32, 5;
000000001,aDCodCli,aDCtaCli;
999999999,aHCodCli,aHCtaCli;
;
NULL,RellenaTempo1P;
|FIN;

|PROCESO RellenaTempo2C;
   enSwClas   = 1; eaFichClas = "dscaz039"; eaTipoClas = #dscam003#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |ACABA; |FINSI;

   |SI #dscam003#14 ! "C"; |Y #dscam003#14 ! "P"; |Y #dscam003#14 ! "I"; |ACABA; |FINSI;

   |DDEFECTO #dscaw027;
   #dscaw027#0 = #dscam003#40;
   #dscaw027#1 = #dscam003#31;
   #dscaw027#3 = #dscam003#65;
   #dscaw027#4 = #dscam003#57;
   #dscaw027#5 = #dscam003#0;
   #dscaw027#6 = #dscam003#46;
   |GRABA 020#dscaw027.n;
|FPRC;

|DEFBUCLE RellenaTempo2C;
#dscam003#1;
32, 5, 47;
000000001,aDCodCli, aDCtaCli, "N";
999999999,aHCodCli, aHCtaCli, "N";
;
NULL,RellenaTempo2C;
|FIN;

|PROCESO RellenaTempo2P;
   enSwClas   = 1; eaFichClas = "dscaz039"; eaTipoClas = #dscam008#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |ACABA; |FINSI;

   |SI #dscam008#14 ! "C"; |Y #dscam008#14 ! "P"; |ACABA; |FINSI;

   |DDEFECTO #dscaw027;
   #dscaw027#0 = #dscam008#40;
   #dscaw027#1 = #dscam008#31;
   #dscaw027#3 = #dscam008#58;
   #dscaw027#4 = #dscam008#59;
   #dscaw027#5 = #dscam008#0;
   #dscaw027#6 = #dscam008#46;
   |GRABA 020#dscaw027.n;
|FPRC;

|DEFBUCLE RellenaTempo2P;
#dscam008#1;
32, 5, 74;
000000001,aDCodCli, aDCtaCli, "N";
999999999,aHCodCli, aHCtaCli, "N";
;
NULL,RellenaTempo2P;
|FIN;

|RUTINA InfCliPro;
   Fichero = "Clientes/Proveedores"; Cmp = "Cliente/Proveedor"; Tipo = "C"; |HAZ ObtenDato;
   #caclipr@#CmpNum# = aFiltro;
   Fichero = "Clientes/Proveedores"; Cmp = "Cuenta Contable"; Tipo = "C"; |HAZ ObtenDato;
   #caclipr@#CmpNum# = "            ";
   Fichero = "Clientes/Proveedores"; Cmp = "Digito Contable"; Tipo = "C"; |HAZ ObtenDato;
   #caclipr@#CmpNum# = 0;
|FRUT;

|RUTINA SupCliPro;
   Fichero = "Clientes/Proveedores"; Cmp = "Cliente/Proveedor"; Tipo = "C"; |HAZ ObtenDato;
   #caclipr@#CmpNum# = aFiltro;
   Fichero = "Clientes/Proveedores"; Cmp = "Cuenta Contable"; Tipo = "C"; |HAZ ObtenDato;
   #caclipr@#CmpNum# = "zzzzzzzzzzzz";
   Fichero = "Clientes/Proveedores"; Cmp = "Digito Contable"; Tipo = "C"; |HAZ ObtenDato;
   #caclipr@#CmpNum# = 9;
|FRUT;

|PROCESO NombreCliPro;
   |SI FSalida = 10;
      |SI aResp1 = "G";
         |SI aResp = "C";
            |CONSULTA_CLAVE #1#agif024@;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Codigo Cliente"; |HAZ ObtenDato;
            #dscaz039#0 = #agif024@#CmpNum#; |PINTA #dscaz039#0;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Nombre Cliente"; |HAZ ObtenDato;
            #dscaz039#1 = #agif024@#CmpNum#; |PINTA #dscaz039#1;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Divisa Defecto"; |HAZ ObtenDato;
            #dscaz039#2 = #agif024@#CmpNum#;
         |SINO;
            |CONSULTA_CLAVE #1#agif112@;
            Fichero = "Proveedores"; Tipo = "G"; Cmp = "Codigo Proveedor"; |HAZ ObtenDato;
            #dscaz039#0 = #agif112@#CmpNum#; |PINTA #dscaz039#0;
            Fichero = "Proveedores"; Tipo = "G"; Cmp = "Nombre Comercial"; |HAZ ObtenDato;
            #dscaz039#1 = #agif112@#CmpNum#; |PINTA #dscaz039#1;
            Fichero = "Proveedores"; Tipo = "G"; Cmp = "Divisa Defecto"; |HAZ ObtenDato;
            #dscaz039#2 = #agif112@#CmpNum#;
         |FINSI;
         Divisa = #dscaz039#2; |HAZ TomaDecim; ||PINTA 0830, NombreDiv;
         |ERROR;
      |SINO;
         aFiltro = aResp;
         |CONSULTA_F_CLAVE #1#caclipr@, InfCliPro, SupCliPro;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Cuenta Contable"; |HAZ ObtenDato;
         #dscaz039#5 = #caclipr@#CmpNum#; |PINTA #dscaz039#5;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Razon Social"; |HAZ ObtenDato;
         #dscaz039#1 = #caclipr@#CmpNum#; |PINTA #dscaz039#1;
         #dscaz039#2 = "EUR";
      |FINSI;
   |SINO;
      |SI aResp1 = "G"; |Y Campo = 0;
         |SI aResp = "C";
            Comodin = #dscaz039#0; |QBF Comodin;
            Comodin = ("000000" + Comodin) % -106; #dscaz039#0 = Comodin; |PINTA #dscaz039#0;
            Fichero = "Clientes"; Tipo = "G"; Cmp = "Codigo Cliente"; |HAZ ObtenDato;
            #agif024@#CmpNum# = #dscaz039#0;
            |LEE 000#agif024@.=;
            |SI FSalida = 0; |Y #agif024@#CmpNum# ! "      ";
               Fichero = "Clientes"; Tipo = "G"; Cmp = "Nombre Cliente"; |HAZ ObtenDato;
               #dscaz039#1 = #agif024@#CmpNum#; |PINTA #dscaz039#1;
               Fichero = "Clientes"; Tipo = "G"; Cmp = "Divisa Defecto"; |HAZ ObtenDato;
               #dscaz039#2 = #agif024@#CmpNum#;
               Divisa = #dscaz039#2; |HAZ TomaDecim; ||PINTA 0830, NombreDiv;
            |SINO;
               |MENAV "    Cliente inexistente";
               |ERROR;
            |FINSI;
         |SINO;
            Comodin = #dscaz039#0; |QBF Comodin;
            Comodin = ("000000" + Comodin) % -106; #dscaz039#0 = Comodin; |PINTA #dscaz039#0;
            Fichero = "Proveedores"; Tipo = "G"; Cmp = "Codigo Proveedor"; |HAZ ObtenDato;
            #agif112@#CmpNum# = #dscaz039#0;
            |LEE 000#agif112@.=;
            |SI FSalida = 0; |Y #agif112@#CmpNum# ! "      ";
               Fichero = "Proveedores"; Tipo = "G"; Cmp = "Nombre Comercial"; |HAZ ObtenDato;
               #dscaz039#1 = #agif112@#CmpNum#; |PINTA #dscaz039#1;
               Fichero = "Proveedores"; Tipo = "G"; Cmp = "Divisa Defecto"; |HAZ ObtenDato;
               #dscaz039#2 = #agif112@#CmpNum#;
               Divisa = #dscaz039#2; |HAZ TomaDecim; ||PINTA 0830, NombreDiv;
            |SINO;
               |MENAV "    Proveedor inexistente";
               |ERROR;
            |FINSI;
         |FINSI;
      |FINSI;
      |SI aResp1 = "C"; |Y Campo = 5;
         Fichero = "Clientes/Proveedores"; Cmp = "Cliente/Proveedor"; Tipo = "C"; |HAZ ObtenDato;
         #caclipr@#CmpNum# = aResp;
         Fichero = "Clientes/Proveedores"; Cmp = "Cuenta Contable"; Tipo = "C"; |HAZ ObtenDato;
         #caclipr@#CmpNum# = #dscaz039#5;
         |LEE 000#caclipr@.];
         |SI FSalida = 0; |Y #caclipr@#CmpNum# = #dscaz039#5;
            Fichero = "Clientes/Proveedores"; Cmp = "Razon Social"; Tipo = "C"; |HAZ ObtenDato;
            #dscaz039#1 = #caclipr@#CmpNum#; |PINTA #dscaz039#1;
            #dscaz039#2 = "EUR";
            Divisa = #dscaz039#2; |HAZ TomaDecim; ||PINTA 0830, NombreDiv;
         |SINO;
            |SI aResp = "C";
               |MENAV "    Cliente inexistente";
            |SINO;
               |MENAV "    Proveedor inexistente";
            |FINSI;
            |ERROR;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROGRAMA;
   |HAZ Tipo8;
   |CLS;

   nSwTagl  = 0;
   |HAZ EsTagloma;
   |SI FSalida = 0; nSwTagl = 1; |SINO; nSwTagl = 0; |FINSI;

   |CABEZA "Saldado de entregas a cuenta";
   |DELINDEX #dscaw026; |DELINDEX #dscaw027;
   |PINPA #0#0; |PINDA #0#0;
   |ENTLINEAL #1#dscaw026,-1,7,21,1,infw026,supw026;
   |ENTLINEAL #1#dscaw027,-1,7,21,1,infw027,supw027;

   |BLANCO 0607 0873;
   |PINTA 0709, "Codigo Cli/Prov";
   |ATRI I; |PINTA 0716, "C"; |PINTA 0720, "P"; |ATRI N;
   |PINTA 0743, "Gestion/Contab.";
   |ATRI I; |PINTA 0743, "G"; |PINTA 0751, "C"; |ATRI N;
   |CUADRO 0607 0839; |CUADRO 0639 0873;
   |CUADRO 0807 1073;

   |SI PARAMETRO ! ""; aResp = PARAMETRO; |PTEC 802; |FINSI;
|ET OtraEleccion;
   E_sup = 1; E_inf = "";
   aResp = 0725 ? 1; aResp = aResp > aResp;
   |SI FSalida = 7; |ACABA; |FINSI;
   |SI aResp ! "C"; |Y aResp ! "P"; |VETE OtraEleccion; |FINSI;

   |SI aResp = "C";
      |ATRI I; |PINTA 0727, "Clientes    "; |ATRI N;
      |PINTA 0909, "Cliente  ";
   |FINSI;
   |SI aResp = "P";
      |ATRI I; |PINTA 0727, "Proveedores "; |ATRI N;
      |PINTA 0909, "Proveedor";
   |FINSI;
   |CUADRO 0607 0839; |CUADRO 0807 1073;

|ET OtraEleccion1;
   E_sup = 1; E_inf = "";
   aResp1 = 0759 ? 1; aResp1 = aResp1 > aResp1;
   |SI FSalida = 7; |ACABA; |FINSI;
   |SI aResp1 ! "G"; |Y aResp1 ! "C"; |VETE OtraEleccion1; |FINSI;

   |ATRI I;
   |SI aResp1 = "G";
      |PINTA 0761, "Gestion     ";
      |BLANCO 0919 0930;
      |C_V #dscaz039#0, 1, "S"; |C_V #dscaz039#5, 1, "N";
      |C_M #dscaz039#0, 1, "S"; |C_M #dscaz039#5, 1, "N";
      |PINTA #dscaz039#0;
   |FINSI;
   |SI aResp1 = "C";
      |BLANCO 0919 0930;
      |PINTA 0761, "Contabilidad";
      |C_V #dscaz039#0, 1, "N"; |C_V #dscaz039#5, 1, "S";
      |C_M #dscaz039#0, 1, "N"; |C_M #dscaz039#5, 1, "S";
      |PINTA #dscaz039#5;
   |FINSI;
   |ATRI N;
   |CUADRO 0639 0873; |CUADRO 0807 1073;

   |ENDATOS #1#0;
   |SI FSalida = 0;
      |ABRE #dscaw026; |ABRE #dscaw027;
      NumEntregas = 0;
      |SI aResp1 = "G";
         aDCodCli = #dscaz039#0; aHCodCli = #dscaz039#0;
         aDCtaCli = "            "; aHCtaCli = "zzzzzzzzzzzz";
      |SINO;
         aDCodCli = "      "; aHCodCli = "zzzzzz";
         aDCtaCli = #dscaz039#5; aHCtaCli = #dscaz039#5;
      |FINSI;

      |SI aResp = "C";
         |BUCLE RellenaTempo1C;
      |SINO;
         |BUCLE RellenaTempo1P;
      |FINSI;
      |SI NumEntregas ! 0;
         |SI aResp = "C";
            |BUCLE RellenaTempo2C;
         |SINO;
            |BUCLE RellenaTempo2P;
         |FINSI;
         |ENTLINEAL #1#dscaw027,-1,7,21,1,infw027,supw027;
         |ENTLINEAL #1#dscaw026,-1,4,21,1,infw026,supw026;
      |SINO;
         |SI aResp = "C";
            |MENAV "    No hay entregas a cuenta del cliente especificado";
         |SINO;
            |MENAV "    No hay entregas a cuenta del proveedor especificado";
         |FINSI;
         |ERROR;
      |FINSI;
      |CIERRA #dscaw026; |CIERRA #dscaw027;
   |FINSI;

   eaSesion   = Usuario; |HAZ LimpiaTempo;

   |HAZ Tipo9;
|FPRO;
