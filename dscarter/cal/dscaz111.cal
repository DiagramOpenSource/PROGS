|FICHEROS;
   dscaz111 #0;

   dscaw052 #10,MANTE;
   dscaw053 #11;
   dscam023 #12,MANTE;
   dscam058 #13;
   dscam044 #14;
   dscam003 #15;
   dscam091 #16;
   dscam045 #17;
   dscam097 #18;

   agif134@ #1000;
   agif133@ #1001;
   agif091@ #1002;
   agif091@ #1003;
   agif084@ #1004;
   agif024@ #1005;
|FIN;

|VARIABLES;
   &Divisa  = "";
   aSerie   = "";
   aMarca   = "";
   aAlfa    = "";
   aDirFic  = "";
   aDirDef  = "";

   nSw      = 0;
   nSwHay   = 0;
   nEmpre   = 0;
   nLimFec  = 0;
   nFactura = 0;
   nHayVtos = 0;
   nSwMarca = 0;

   fFecha   = @;
|FIN;

|PROCESO Limites;
   nLimFec = 1;
   |SI #dscam091#3 [ #dscam003#4; |Y #dscam091#4 ] #dscam003#4;
      nLimFec = 2; |ERROR10;
   |FINSI;
|FPRC;

|DEFBUCLE Limites;
#dscam091#1;
;
#dscam023#0, #dscam023#2, 01;
#dscam023#0, #dscam023#2, 99;
;
NULL,Limites;
|FIN;

|PROCESO MiraMarca; |TIPO 11;
   |SI FSalida = 10;
      |SI #dscaw052#8 = " ";
         #dscaw052#8 = "*";
         nSwMarca = nSwMarca + 1;
      |SINO;
         #dscaw052#8 = " ";
         nSwMarca = nSwMarca - 1;
      |FINSI;
      |GRABA 020#dscaw052.a;
      |ERROR; |PTEC 808;
      |PONCONTROL 23, "si";
   |FINSI;
   |SI FSalida = 11;
      Divisa = #dscaw052#13; |HAZ CargaNDeci;
      |PUSHV 0501 2380;
      |ENTLINEAL #1#dscaw053,-3,4,17,1,infw53,supw53;
      |POPV;
      |ERROR; |PTEC 808;
      |PONCONTROL 23, "si";
   |FINSI;
|FPRC;

|PROCESO Vtos;
   |SI #dscam003#4 ! fFecha; |ACABA; |FINSI;

   nLimFec = 0;
   |BUCLE Limites;
   |SI nLimFec = 1; |ACABA; |FINSI;

   nHayVtos = 1;

   #dscam058#0 = #dscam003#12;
   |LEE 000#dscam058.=;
   |SI FSalida ! 0; |DDEFECTO #dscam058; |FINSI;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   |DDEFECTO #dscaw053;
   #dscaw053#0 = #dscam003#0;
   #dscaw053#1 = #dscam003#1;
   #dscaw053#2 = #dscam003#2;
   #dscaw053#3 = #dscam003#3;
   #dscaw053#4 = #dscaw053#3 - #dscaw052#5;
   #dscaw053#5 = #dscam003#12;
   #dscaw053#6 = #dscam058#1;
   #dscaw053#7 = #dscam003#64;
   #dscaw053#8 = #dscaw052#5;
   #dscaw053#9 = #dscam003#40;
   |GRABA 020#dscaw053.n;
|FPRC;

|DEFBUCLE Vtos;
#dscam003#6;
89;
00, aSerie, nFactura, 001, " ", 000000001, "N";
00, aSerie, nFactura, 999, " ", 999999999, "N";
;
NULL,Vtos;
|FIN;

|PROCESO TmpVentas;
   Divisa = #agif134@#58; |HAZ CargaNDeci;

   #agif091@#0 = #agif134@#11;
   |LEE 000#agif091@.=;
   |SI FSalida ! 0; |DDEFECTO #agif091@; |FINSI;

   #dscam023#0 = #agif134@#2;
   |LEE 000#dscam023.=;
   |SI FSalida ! 0; |DDEFECTO #dscam023; |FINSI;

   |SI #dscam023#2 ! 0; |ACABA; |FINSI;

   |DDEFECTO #dscaw052;
   #dscaw052#0 = #agif134@#49;
   #dscaw052#1 = #agif134@#0;
   #dscaw052#2 = #agif134@#2;
   #dscaw052#3 = #agif134@#3;
   #dscaw052#4 = 0;
   #dscaw052#5 = #agif134@#1;
   #dscaw052#7 = #agif134@#101;
   #dscaw052#8 = aMarca;
   |SI aMarca = "*"; nSwMarca = nSwMarca + 1; |FINSI;

   #dscaw052#9  = #dscam023#20;
   #dscaw052#10 = #dscam023#19;

   #dscaw052#11 = #agif134@#11;
   #dscaw052#12 = #agif091@#1;
   #dscaw052#13 = #agif134@#58;

   #agif024@#0 = #dscaw052#2;
   |LEE 000#agif024@.=;
   |SI FSalida ! 0; |DDEFECTO #agif024@; |FINSI;

   #dscaw052#14 = #agif024@#6;
   #dscaw052#15 = #agif024@#178;
   #dscaw052#16 = #agif024@#179;
   #dscaw052#17 = #agif024@#7;

   aSerie = #agif134@#49; nFactura = #agif134@#0; fFecha = #agif134@#1;
   nHayVtos = 0; |BUCLE Vtos;
   |SI nHayVtos = 1; |GRABA 020#dscaw052.n; |FINSI;
|FPRC;

|DEFBUCLE TmpVentas;
#agif134@#1002;
1,2,12;
#0#2, #0#4, #0#11, #0#7, #0#9;
#0#3, #0#5, #0#12, #0#8, #0#10;
;
NULL,TmpVentas;
|FIN;

|PROCESO TmpDirectas;
   Divisa = #agif084@#65; |HAZ CargaNDeci;

   #agif091@#0 = #agif084@#8;
   |LEE 000#agif091@.=;
   |SI FSalida ! 0; |DDEFECTO #agif091@; |FINSI;

   #dscam023#0 = #agif084@#3;
   |LEE 000#dscam023.=;
   |SI FSalida ! 0; |DDEFECTO #dscam023; |FINSI;

   |SI #dscam023#2 ! 0; |ACABA; |FINSI;

   |DDEFECTO #dscaw052;
   #dscaw052#0 = #agif084@#48;
   #dscaw052#1 = #agif084@#0;
   #dscaw052#2 = #agif084@#3;
   #dscaw052#3 = #agif084@#4;
   #dscaw052#4 = 0;
   #dscaw052#5 = #agif084@#1;
   #dscaw052#7 = #agif084@#73;
   #dscaw052#8 = aMarca;

   #dscaw052#9  = #dscam023#20;
   #dscaw052#10 = #dscam023#19;

   #dscaw052#11 = #agif084@#8;
   #dscaw052#12 = #agif091@#1;
   #dscaw052#13 = #agif084@#65;

   #agif024@#0 = #dscaw052#2;
   |LEE 000#agif024@.=;
   |SI FSalida ! 0; |DDEFECTO #agif024@; |FINSI;

   #dscaw052#14 = #agif024@#6;
   #dscaw052#15 = #agif024@#178;
   #dscaw052#16 = #agif024@#179;
   #dscaw052#17 = #agif024@#7;

   aSerie = #agif084@#48; nFactura = #agif084@#0; fFecha = #agif084@#1;

   nHayVtos = 0; |BUCLE Vtos;
   |SI nHayVtos = 1; |GRABA 020#dscaw052.n; |FINSI;
|FPRC;

|DEFBUCLE TmpDirectas;
#agif084@#1002;
1,3,40;
#0#2, #0#4, #0#11, #0#7, #0#9;
#0#3, #0#5, #0#12, #0#8, #0#10;
;
NULL,TmpDirectas;
|FIN;

|PROCESO Empresas;
   nSwHay = 1;
   #dscam044#0 = #dscam045#0;
   |LEE 000#dscam044.=;

   aDirFic = #dscam044#1; |QBF aDirFic;
   aDirDef = aDirFic + "def/";
   aDirFic = aDirFic + "fich/" + (("00000" + #dscam045#0) % -105) + "/";

   aAlfa = aDirDef + "agifa134.mas";
   |CARGA_DEF aAlfa, agif134@;
   |SI FSalida = 0;
      aAlfa = aDirDef + "agifa133.mas"; |CARGA_DEF aAlfa, agif133@;
      aAlfa = aDirDef + "agifa091.mas"; |CARGA_DEF aAlfa, agif091@;
      aAlfa = aDirDef + "agifa024.mas"; |CARGA_DEF aAlfa, agif024@;
      aAlfa = aDirDef + "agifa084.mas"; |CARGA_DEF aAlfa, agif084@;
      |PATH_DAT #agif134@#aDirFic#; |ABRE #agif134@;
      |PATH_DAT #agif133@#aDirFic#; |ABRE #agif133@;
      |PATH_DAT #agif091@#aDirFic#; |ABRE #agif091@;
      |PATH_DAT #agif024@#aDirFic#; |ABRE #agif024@;
      |PATH_DAT #agif084@#aDirFic#; |ABRE #agif084@;
      |BUCLE TmpVentas; |BUCLE TmpDirectas;
      |CIERRA #agif084@; |DESCARGA_DEF #agif084@;
      |CIERRA #agif024@; |DESCARGA_DEF #agif024@;
      |CIERRA #agif091@; |DESCARGA_DEF #agif091@;
      |CIERRA #agif133@; |DESCARGA_DEF #agif133@;
      |CIERRA #agif134@; |DESCARGA_DEF #agif134@;
   |FINSI;
|FPRC;

|DEFBUCLE Empresas;
#dscam045#2;
2;
nEmpre,"V";
nEmpre,"V";
;
NULL,Empresas;
|FIN;

|PROCESO PintaPeriodo;
   |ATRI I;
   |SI #dscaz111#0 = 1;  |PINTA 0832, "Enero     "; |FINSI;
   |SI #dscaz111#0 = 2;  |PINTA 0832, "Febrero   "; |FINSI;
   |SI #dscaz111#0 = 3;  |PINTA 0832, "Marzo     "; |FINSI;
   |SI #dscaz111#0 = 4;  |PINTA 0832, "Abril     "; |FINSI;
   |SI #dscaz111#0 = 5;  |PINTA 0832, "Mayo      "; |FINSI;
   |SI #dscaz111#0 = 6;  |PINTA 0832, "Junio     "; |FINSI;
   |SI #dscaz111#0 = 7;  |PINTA 0832, "Julio     "; |FINSI;
   |SI #dscaz111#0 = 8;  |PINTA 0832, "Agosto    "; |FINSI;
   |SI #dscaz111#0 = 9;  |PINTA 0832, "Septiembre"; |FINSI;
   |SI #dscaz111#0 = 10; |PINTA 0832, "Octubre   "; |FINSI;
   |SI #dscaz111#0 = 11; |PINTA 0832, "Noviembre "; |FINSI;
   |SI #dscaz111#0 = 12; |PINTA 0832, "Diciembre "; |FINSI;
   |ATRI N;
|FPRC;

|PROCESO PasaAImp;
   #dscam023#0 = #dscaw052#2;
   |LEE 000#dscam023.=;
   |SI FSalida ! 0; |DDEFECTO #dscam023; |FINSI;

   |SI #dscam023#2 = 0; |Y #dscam023#23 ! 0;
      |SI #dscam023#23 = 51; #dscam097#2 = #dscam097#2 + #dscaw052#7; |FINSI;
      |SI #dscam023#23 = 52; #dscam097#3 = #dscam097#3 + #dscaw052#7; |FINSI;
      |SI #dscam023#23 = 53; #dscam097#4 = #dscam097#4 + #dscaw052#7; |FINSI;
      |SI #dscam023#23 = 54; #dscam097#5 = #dscam097#5 + #dscaw052#7; |FINSI;
      |SI #dscam023#23 = 55; #dscam097#6 = #dscam097#6 + #dscaw052#7; |FINSI;
      |SI #dscam023#23 = 56; #dscam097#7 = #dscam097#7 + #dscaw052#7; |FINSI;
      |SI #dscam023#23 = 57; #dscam097#8 = #dscam097#8 + #dscaw052#7; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE PasaAImp;
   #dscaw052#1;
   8;
   "     ", 000000, "*";
   "zzzzz", 999999, "*";
   ;
   NULL,PasaAImp;
|FIN;

|RUTINA infw52;
   #dscaw052#0 = "     ";
   #dscaw052#1 = 000000;
   #dscaw052#2 = 000;
|FRUT;

|RUTINA supw52;
   #dscaw052#0 = "zzzzz";
   #dscaw052#1 = 999999;
   #dscaw052#2 = 999;
|FRUT;

|PROCESO infw53;
   #dscaw053#0 = #dscaw052#0;
   #dscaw053#1 = #dscaw052#1;
   #dscaw053#2 = 001;
|FPRC;

|PROCESO supw53;
   #dscaw053#0 = #dscaw052#0;
   #dscaw053#1 = #dscaw052#1;
   #dscaw053#2 = 999;
|FPRC;

|PROCESO Selec;
   |PINTA 1535, "                           ";
   |SI #dscaz111#6 = "G";
      |C_M #dscaz111#9,  1, "N"; #dscaz111#9  = "";
      |C_M #dscaz111#10, 1, "N"; #dscaz111#10 = "z" * 12;
      |C_V #dscaz111#9, 1, "N"; |C_V #dscaz111#10, 1, "N";
      |C_M #dscaz111#7, 1, "S"; |C_M #dscaz111#8, 1, "S";
      |C_V #dscaz111#7, 1, "S"; |C_V #dscaz111#8, 1, "S";
      |PINTA #dscaz111#7; |PINTA #dscaz111#8;
   |SINO;
      |C_M #dscaz111#7, 1, "N"; #dscaz111#7 = "";
      |C_M #dscaz111#8, 1, "N"; #dscaz111#8 = "z" * 6;
      |C_V #dscaz111#7, 1, "N"; |C_V #dscaz111#8, 1, "N";
      |C_M #dscaz111#9, 1, "S"; |C_M #dscaz111#10, 1, "S";
      |C_V #dscaz111#9, 1, "S"; |C_V #dscaz111#10, 1, "S";
      |PINTA #dscaz111#9; |PINTA #dscaz111#10;
   |FINSI;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA "Calculo de importes no asegurados";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |CONFI "    NMarcar todos los registros ? ";
      |SI FSalida = 0; aMarca = "*"; |SINO; aMarca = " "; |FINSI;
      |HAZ Tipo8;
      aAlfa = "tc" + Usuario; |NOME_DAT #10 aAlfa;
      aAlfa = "tl" + Usuario; |NOME_DAT #11 aAlfa;
      |DELINDEX #dscaw052; |ABRE #dscaw052;
      |DELINDEX #dscaw053; |ABRE #dscaw053;
      |DFICB aAlfa; |QBF aAlfa;
      |PATH_DAT #14 aAlfa; |PATH_DAT #17 aAlfa;
      |ABRE #dscam044; |ABRE #dscam003; |ABRE #dscam058; |ABRE #dscam023;
      nSwHay = 0;
      nEmpre = #48#0; |BUCLE Empresas;
      |SI nSwHay = 0; |Y nSwMarca = 1; nSwMarca = 0; |FINSI;
      |CIERRA #dscaw052; |CIERRA #dscaw053;
      |CIERRA #dscam058; |CIERRA #dscam003; |CIERRA #dscam044;

      |ENTLINEAL #1#dscaw052,-2,1,17,1,infw52,supw52;
      |SI nSwMarca ! 0;
         |CONFI "    NActualizar mantenimiento importes no asegurados ?";
         |SI FSalida = 0;
            |ABRE #dscam097;
            #dscam097#0 = #dscaz111#0;
            #dscam097#1 = #dscaz111#1;
            |LEE 101#dscam097.=;
            |SI FSalida = 0;
               |CONFI "    NSe borraran los datos existentes del mto.de importes Continuar ?";
               |SI FSalida = 0;
                  #dscam097#2 = 0; #dscam097#3 = 0;
                  #dscam097#4 = 0; #dscam097#5 = 0;
                  #dscam097#6 = 0; #dscam097#7 = 0;
                  #dscam097#8 = 0; #dscam097#9 = 0;
                  nSw = 1;
               |SINO;
                  nSw = 0;
               |FINSI;
            |SINO;
               |DDEFECTO #dscam097;
               #dscam097#0 = #dscaz111#0;
               #dscam097#1 = #dscaz111#1;
               |GRABA 020#dscam097.b;
               nSw = 1;
            |FINSI;
            |SI nSw = 1;
               |ABRE #dscam003;
               |BUCLE PasaAImp;
               |GRABA 020#dscam097.a; |LIBERA #dscam097;
               |CIERRA #dscam003; |CIERRA #dscam097;
            |FINSI;
         |FINSI;
      |FINSI;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "tl" + Usuario + ".dat"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "tl" + Usuario + ".ddx"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "tl" + Usuario + ".ixx"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "tc" + Usuario + ".dat"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "tc" + Usuario + ".ixx"; |FBORRA aAlfa;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "tc" + Usuario + ".ddx"; |FBORRA aAlfa;

      |CIERRA #dscam023;
      |HAZ Tipo9;
   |FINSI;
|FPRO;
