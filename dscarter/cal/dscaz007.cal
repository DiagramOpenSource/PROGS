|FICHEROS;
   dscaz007 #0;
   dscaz008 #1,MANTE;
   dscam008 #2;
   dscam009 #3;
   dscam051 #4;

   dscam014 #7;

   dscaw007 #14,MANTE;

   &agif324@ #9;
   &agif321@ #10;

   dscaw043 #100;
   dscaw013 #101;
   dscam030 #102;
   dscam043 #103;
   dscam165 #104;
   dscaw079 #105;
   dscaw187 #187,MANTE;

   canempre@ #1000;
   cajainca@ #1001;
   cajainli@ #1002;
   caconasi@ #1003;
   cajasald@ #1004;

   xeferen@ #50;
   Referen@ #5000;
|FIN;

|VARIABLES;
   aMarca = "N";
   aNomeDat7 = "";
   aAlfa1 = "";
   aAlfa2 = "";
   nSal = 0;

   &TipoProveedor = ""; &CodProveedor = ""; &eaSesion = "";
   &DCampoG = 0;  &HCampoG = 0;  &DCampoC = 0;  &HCampoC = 0;
   &eaFichClas = "";  &eaTipoClas = ""; &enSwClas = 0;
   &enTipoRec = 0; &enExistOblig = 0;   &eaSerie = "";
   &eaCliente   = "";
   &enDocumento = 0;
   &efFechaVto  = @;
   &TipoCliente = "";
   &CodCliente = "";

   &eaCodigo = ""; &eaCuenta = "";
   &enNumDocumento = 0; &efFechaDiv = @;
   &enEmpGestion = 0; &enSwVisado = 0;

   &efFechaDoc = @;
   &efFechaUlt = @;

   nTotal    = 0;
   nTotalLiq = 0;
   nTotalPdt = 0;

   nSwErr  = 0;
   aCuenta = "";
   nSwLuxe = 0;

{-1}menu  = "";
    menu1 = "2400";
    menu2 = "1";
    menu3 = "";
    menu4 = "VFCAM";
    menu5 = " Aut. por Vto. ";
    menu6 = " Aut. por Fecha ";
    menu7 = " Aut. por Proveedor ";
    menu8 = " Acotado ";
    menu9 = " Manual ";

    DCodProv = "";
    HCodProv = "";
    DCtaProv = "";
    HCtaProv = "";
    Cont     = 0;
    nTecla   = 0;
    nApunte  = 0;
    nCont    = 0;

    aParte1  = "";
    aParte2  = "";
    nParte1  = 0;
    nParte2  = 0;

    aAlfa = "";

    aLong = ""; nLong = 0;

    Opcion = 0;
    Linea  = 0;
    LinCob = 0;
    nSwError = 0;
    nLinea = 0;
    nAnyo  = 0;
    nCalc  = 0;
    nCalc1 = 0;

    Documento = 0;
    Libro = 0;
    Serie = "";
    Factura = 0;
    Recibo = 0;
    NumLin = 0;
    fFecha = @;

    Comodin = ""; Comodin1 = "";
    ModoEntrada = 0; Calc = 0;
    SwError = 0;
    Manual = 0;
    FEstado = 0;
    HaySelec = 0;
    nNumSec  = 0;

    &Fichero   = "";  &Cmp = "";   &Tipo = ""; &CmpNum = 0;
    &MaxDigit = 0;    &UltNivel = 0;
    &nDeci_males = 0; &nDeci_Div = 0;
    &HayGestion = 0; &HayConta = 0;
    &Divisa = ""; &NombreDiv = "";
    &CambioBaseVn = 0; &CambioBaseCm = 0;
    &CambioDivVn  = 0; &CambioDivCm  = 0;
    &PosLibro = 0; &PosSerie = 0; &PosFactu = 0; &PosRecib = 0;
    &enDocum = 0;  &enFactura = 0;
    &eaTipoRecibo = ""; &enNumDocum = 0; &eaMensRet = ""; &enSwError = 0; &eaTOperacion = "";
    SwClave = 0;

    &enSwErr = 0;
|FIN;
|PROCESO Baja; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3;
      eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;
   |FINSI;
|FPRC;

|PROCESO Tipo13_007; |TIPO 13;
   efFechaDiv = #dscaz007#14;
   Divisa = #dscaz007#22; |HAZ TomaDecim;
|FPRC;

|PROCESO CalcCaja;
   nTotal = nTotal + (#cajainca@#3 - #cajainca@#2);
   nTotal = nTotal ! 2;
|FPRC;

|DEFBUCLE CalcCaja;
#cajainca@#1001;
;
"01.01.0000";
fFecha;
;
NULL, CalcCaja;
|FIN;

|PROCESO CalculaSaldoCaja;
   nTotal = 0; fFecha = #cajainca@#1;

   |LEE 000#cajasald@.p;
   |SI FSalida ! 0; |DDEFECTO #cajasald@; |FINSI;

   nTotal = #cajasald@#1;
   |SALVA_FICHA #cajainca@;
   |BUCLE CalcCaja;
   |REPON_FICHA #cajainca@;
|FPRC;

|PROCESO CambioDivisa;
      |SI HayGestion = 1;
         Fichero = "Divisas"; Tipo = "G"; Cmp = "Codigo Divisa"; |HAZ ObtenDato;
         #agif324@#CmpNum# = #dscaz007#22;
         |LEE 000#agif324@.=;
         |SI FSalida = 0;
            Fichero = "Divisas"; Tipo = "G"; Cmp = "Valor Compra"; |HAZ ObtenDato;
            #dscaz007#24 = CambioBaseCm * #agif324@#CmpNum#;
         |FINSI;
         efFechaDiv = #dscaz007#14;
         Divisa = #dscaz007#22; |HAZ TomaDecim;
         #dscaz007#24 = CambioDivCm;
      |SINO;
         |SI #dscaz007#22 = "EUR"; #dscaz007#24 = 1; |FINSI;
      |FINSI;
|FPRC;


|PROCESO HazPago;
   enSwError = 0;
   eaTOperacion = "A"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;
   |SI enSwError = 1; |ERROR; |ACABA; |FINSI;
   nSwError = 0; nLinea = #dscaz007#0;
   |SALVA_FICHA #dscaz007;
   |SELECT #3#dscaz007;
   #dscaz007#21 = enNumDocum;
   #dscaz007#0 = 1;
   |LEE 000#dscaz007.];
   |PARA; |SI FSalida = 0; |Y #dscaz007#21 = enNumDocum; |HACIENDO;
      |SI #dscaz007#0 ! nLinea; nSwError = 1; |SAL; |FINSI;
      |LEE 000#dscaz007.s;
   |SIGUE;
   |SELECT #1#dscaz007;
   |REPON_FICHA #dscaz007;
   |SI nSwError = 1;
      |MENAV "    Recibo ya incluido"; |ERROR; |ACABA;
   |FINSI;

   |SI HayConta = 1; |Y #dscam051#1 = "S";
      |C_M #dscaz008#10,1,"S";
   |SINO;
      |C_M #dscaz008#10,1,"N";
   |FINSI;

   eaCliente = #dscam008#32; enDocumento = #dscam008#40;

   |SI #dscam008#16 ! 0;
      |ABRE #dscam014;
      #dscam014#0 = #dscam008#16;
      |LEE 000#dscam014.=;
      |SI FSalida = 0;
         #dscaz008#0 = #dscam014#10;
      |SINO;
         #dscaz008#0 = #dscaz007#13;
      |FINSI;
      |CIERRA #dscam014;
   |SINO;
      #dscaz008#0 = #dscaz007#13;
   |FINSI;

   |SI #dscam051#38 = "S";
      fFecha = ~;
   |SINO;
      fFecha = #dscaz007#14;
   |FINSI;
   #dscaz008#1 = fFecha;
   #dscaz008#2 = #dscaz007#9;
   #dscaz008#3 = #dscaz007#7;
   #dscaz008#4 = #dscaz007#7;
   #dscaz008#5 = #dscaz007#15;
   #dscaz008#6 = #dscaz007#16;
   #dscaz008#7 = #dscaz007#17;
   #dscaz008#9 = #dscaz007#19;
   |SI #dscam051#1 = "S";
      #dscaz008#10 = #dscaz007#26;
   |SINO;
      #dscaz008#10 = "    ";
   |FINSI;
   #dscaz008#11 = #dscaz007#29;

|ET OtraVez;
   eaSerie = #dscaz007#1;
   |PUSHV 0646 2178;
   |PINPA #0#1; |PINDA #0#1;
   |ENDATOS #2#dscaz008;
   FEstado = FSalida;
   |POPV;

   |SI FEstado = 0; |Y #dscaz008#8 = "S";
      aAlfa = #dscaz008#0; |QBF aAlfa;
      aAlfa = aAlfa % 0103;
      |SI nSwLuxe = 1; |Y aAlfa = "570";
         |DBASS aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "contagen/def/canempre.mas";
         |CARGA_DEF aAlfa, canempre@;
         |SI FSalida = 0;
            |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "contagen/fich/";
            |PATH_DAT #canempre@#aAlfa#;
            |ABRE #canempre@;
            |DFICB aAlfa; |QBF aAlfa; |PATH_DAT #dscam043#aAlfa#;

            |ABRE #dscam043;
            |SELECT #2#dscam043;
            #dscam043#9 = #48#0;
            |LEE 000#dscam043.];
            |PARA; |SI FSalida = 0; |HACIENDO;
               #canempre@#2 = #dscam043#0;
               #canempre@#3 = #dscam043#1;
               |LEE 000#canempre@.=;
               |SI FSalida = 0;
                  nAnyo = #canempre@#26;
                  |SI nAnyo > 80;
                     nAnyo = nAnyo + 1900;
                  |SINO;
                     nAnyo = nAnyo + 2000;
                  |FINSI;
                  aAlfa = #dscaz008#1; |QBF aAlfa;
                  aAlfa = aAlfa % -104; nCalc = aAlfa;
                  |SI nAnyo = nCalc; |Y #dscaz007#1 ] #dscam043#7;
                   |Y #dscaz007#1 [ #dscam043#8; |Y #dscam043#3 = "C";
                     |SI #canempre@#34 > #dscaz008#1; |Y #canempre@#34 ! "01.01.0000";
                        aAlfa = "    Empresa contable bloqueada a fecha " + #canempre@#34;
                        |MENAV aAlfa;
                     |SINO;
                        |SAL;
                     |FINSI;
                  |FINSI;
               |FINSI;
               |LEE 000#dscam043.s;
            |SIGUE;

            |SI FSalida ! 0; |O nAnyo ! nCalc; |O #dscaz007#1 < #dscam043#7; |O #dscaz007#1 > #dscam043#8;
               |MENAV "    No encuentro la empresa contable asociada a esta empresa de cartera.";
               |SELECT #1#dscam043; |CIERRA #dscam043;
               |CIERRA #canempre@; |DESCARGA_DEF #canempre@;
               eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;

               |VETE OtraVez;
            |SINO;
               |SI #canempre@#34 > #dscaz008#1; |Y #canempre@#34 ! "01.01.0000";
                  |MENAV "    No encuentro la empresa contable asociada a esta empresa de cartera.";
                  |SELECT #1#dscam043; |CIERRA #dscam043;
                  |CIERRA #canempre@; |DESCARGA_DEF #canempre@;
                  eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;

                  |VETE OtraVez;
               |FINSI;
            |FINSI;
            |SELECT #1#dscam043; |CIERRA #dscam043;
            |CIERRA #canempre@; |DESCARGA_DEF #canempre@;
         |FINSI;

         |DBASS aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "contagen/def/cajainca.mas";
         |CARGA_DEF aAlfa, cajainca@;
         |SI FSalida = 0;
            |DBASS aAlfa; |QBF aAlfa;
            aAlfa = aAlfa + "contagen/def/cajasald.mas";
            |CARGA_DEF aAlfa, cajasald@;

            |DBASS aAlfa; |QBF aAlfa;
            aAlfa = aAlfa + "contagen/fich/" + (("00000" + #dscam043#0) % -105) + #dscam043#1 + "/";
            |PATH_DAT #cajainca@#aAlfa#; |PATH_DAT #cajasald@#aAlfa#;

            || Comprobamos si hay suficiente efectivo en la caja. Buscamos el
            ||    diario de hoy o si no existe, el ultimo (que debe ser anterior
            ||    a hoy)
            |ABRE #cajainca@; |ABRE #cajasald@;
            #cajainca@#1 = #dscaz008#1;
            |LEE 000#cajainca@.=;
            |SI FSalida ! 0;
               |LEE 000#cajainca@.u;
               |SI #cajainca@#1 < #dscaz008#1;
                  |HAZ CalculaSaldoCaja;
                  |SI nTotal < #dscaz008#4;
                     |MENAV "    Atencion, Caja sin fondos suficientes. No se puede realizar el anticipo. Revise el importe a pagar.";
                     |CIERRA #cajasald@; |DESCARGA_DEF #cajasald@;
                     |CIERRA #cajainca@; |DESCARGA_DEF #cajainca@;
                     eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;
                     |VETE OtraVez;
                  |FINSI;
               |FINSI;
            |SINO;
               |HAZ CalculaSaldoCaja;
               |SI nTotal < #dscaz008#4;
                  |MENAV "    Atencion, Caja sin fondos suficientes. No se puede realizar el anticipo. Revise el importe a pagar.";
                  |CIERRA #cajasald@; |DESCARGA_DEF #cajasald@;
                  |CIERRA #cajainca@; |DESCARGA_DEF #cajainca@;
                  eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;
                  |VETE OtraVez;
               |FINSI;
            |FINSI;
            |CIERRA #cajasald@; |DESCARGA_DEF #cajasald@;
            |CIERRA #cajainca@; |DESCARGA_DEF #cajainca@;
         |FINSI;
      |FINSI;

      #dscaz007#13 = #dscaz008#0;
      #dscaz007#14 = #dscaz008#1;
      #dscaz007#8  = #dscaz008#4;
      #dscaz007#7  = #dscaz008#3;
      #dscaz007#15 = #dscaz008#5;
      #dscaz007#16 = #dscaz008#6;
      #dscaz007#17 = #dscaz008#7;
      #dscaz007#13 = #dscaz008#0;
      #dscaz007#19 = #dscaz008#9;
      #dscaz007#10 = "*";
      #dscaz007#26 = #dscaz008#10;
      #dscaz007#29 = #dscaz008#11;

      |HAZ CambioDivisa;


      |GRABA 020#dscaz007.a;
      HaySelec = HaySelec + 1;
      nTotalPdt = nTotalPdt - #dscaz007#8;
      nTotalLiq = nTotalLiq + #dscaz007#8;

      #dscaw079#0 = nTotalPdt; #dscaw079#1 = nTotalLiq;
      |ATRI I; |PINTA 0801, " Pendiente : "; |PINTA 0825, " Liquidado : "; |ATRI N;
      |PINTA 0814, #dscaw079#0; |PINTA 0838, #dscaw079#1;
   |SINO;
      eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO EntregasPdtes;
   nSwErr = 1; |ERROR10;
|FPRC;

|DEFBUCLE EntregasPdtes;
#dscam008#5;
14;
aCuenta, 000000001, "e";
aCuenta, 999999999, "e";
;
NULL, EntregasPdtes;
|FIN;

|PROCESO TomaDocum; |TIPO 7;
   |SI #dscaz007#10 = "*";
      #dscam008#40 = #dscaz007#21;
      |LEE 000#dscam008.=;
      |SI FSalida = 0;
         eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;
         #dscaz007#10 = " ";
         |GRABA 020#dscaz007.a;
         HaySelec = HaySelec - 1;
         nTotalPdt = nTotalPdt + #dscaz007#8;
         nTotalLiq = nTotalLiq - #dscaz007#8;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO MiraRecibo;
   |SI FSalida = 2; |ACABA; |FINSI;

   #dscam008#40 = #dscaz007#21;
   |LEE 000#dscam008.=;
   |SI FSalida = 0;
      efFechaDoc = #dscam008#4;
      efFechaUlt = "01.01.0000";
      #dscam009#14 = #dscam008#40;
      #dscam009#3 = 99;
      |LEE 000#dscam009.];
      |SI FSalida = 0;
         |SI #dscam009#14 = #dscam008#40;
            efFechaUlt = #dscam009#6;
         |SINO;
            |LEE 000#dscam009.a;
            |SI FSalida = 0;
               |SI #dscam009#14 = #dscam008#40;
                  efFechaUlt = #dscam009#6;
               |FINSI;
            |FINSI;
         |FINSI;
      |SINO;
         |LEE 000#dscam009.u;
         |SI FSalida = 0;
            |SI #dscam009#14 = #dscam008#40;
               efFechaUlt = #dscam009#6;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   eaCodigo = #dscam008#32; eaCuenta = #dscam008#5; |HAZ MiraSiBloq;
   |SI enSwErr ! 0;
      |MENAV "    Proveedor bloqueado";
      |ERROR;  SwError = 1; |ACABA;
   |FINSI;

   aCuenta = #dscam008#5;
   nSwErr = 0;
   |SALVA_FICHA #dscam008;
   |BUCLE EntregasPdtes;
   |REPON_FICHA #dscam008;
   |SI nSwErr = 1;
      aAlfa = "    NEste proveedor tiene entregas a cuenta pendientes de saldar. " + &191 + " Continuar ?";
      |CONFI aAlfa;
      |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
   |FINSI;

   enNumDocumento = #dscam008#40;
   enEmpGestion = #dscam008#46; |HAZ MiraSiVisado;
   |SI enSwVisado < 0;
      |MENAV "    Factura proveedor no visada, no se permite el pago";
      |ERROR;  SwError = 1; |ACABA;
   |FINSI;

   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada ! 1; |Y #dscaz007#21 = Contenido; |ACABA; |FINSI;

   |SELECT #1#dscaz007;

   Documento = #dscaz007#21;
   NumLin = #dscaz007#0;
   SwError = 0;

   |LEE 000#dscaz007.=;
   |SI FSalida = 0;
      |SI NumLin ! #dscaz007#0;
         |AVISO;
         |MENAV "    Recibo ya introducido";
         |ERROR;
         SwError = 1;
      |SINO;
         #dscam008#40 = Documento;
         |LEE 000#dscam008.=;
         |SI FSalida = 0;
            eaCodigo = #dscam008#32; eaCuenta = #dscam008#5; |HAZ MiraSiBloq;
            |SI enSwErr ! 0;
               |AVISO; |MENAV "    Proveedor bloqueado"; |ERROR; SwError = 1;
            |FINSI;

            |SI #dscam008#31 = 0;
               |AVISO; |MENAV "    Recibo ya liquidado"; |ERROR; SwError = 1;
            |FINSI;
            |SI #dscam008#14 = "A";
               |AVISO; |MENAV "    Recibo agrupado"; |ERROR; SwError = 1;
            |FINSI;
            |SI #dscam008#14 = "D";
               |AVISO; |MENAV "    Recibo dividido"; |ERROR; SwError = 1;
            |FINSI;
            |SI #dscam008#14 = "E";
               |AVISO;
               |SI #dscam008#39 = "P"; |MENAV "    Recibo englobado en pagare  "; |FINSI;
               |SI #dscam008#39 = "T"; |MENAV "    Recibo englobado en talon   "; |FINSI;
               |SI #dscam008#39 = "C"; |MENAV "    Recibo englobado en confirme"; |FINSI;
               |ERROR; SwError = 1;
            |FINSI;
            enSwClas   = 1; eaFichClas = "dscaz007"; eaTipoClas = #dscam008#12;
            |HAZ CompruebaClas;
            |SI eaFichClas = "ERROR";
               |MENAV "    Documento inoperable en el perfil actual ";
               |ERROR; SwError = 1;
            |FINSI;
            |SI eaFichClas = "INFOR";
               |CONFI "    Documento inoperable en el perfil actual. Cambiar Tipo recibo ?";
               |SI FSalida = 0;
                  eaFichClas = "dscaz007";
                  enNumDocum = #dscam008#40; enTipoRec = #dscam008#12; |HAZ CambiaTR;
               |SINO;
                  |ERROR; |ACABA;
               |FINSI;
            |FINSI;

         |SINO;
            |AVISO;
            |MENAV "    Recibo inexistente";
            |ERROR;
            SwError = 1;
         |FINSI;
      |FINSI;
   |SINO;
      #dscam008#40 = Documento;
      |LEE 000#dscam008.=;
      |SI FSalida = 0;
         |SI #dscam008#31 = 0;
            |AVISO; |MENAV "    Recibo ya liquidado"; |ERROR; SwError = 1;
         |FINSI;
         |SI #dscam008#14 = "A";
            |AVISO; |MENAV "    Recibo agrupado"; |ERROR; SwError = 1;
         |FINSI;
      |SINO;
         |AVISO;
         |MENAV "    Recibo inexistente";
         |ERROR;
         SwError = 1;
      |FINSI;
   |FINSI;
   |SELECT #1#dscaz007;

   |SI SwError = 0;
      Manual = 1;
      #dscam008#40 = Documento;
      |LEE 000#dscam008.=;
      |SI FSalida = 0;
         efFechaDoc = #dscam008#4;
         efFechaUlt = "01.01.0000";
         #dscam009#14 = #dscam008#40;
         #dscam009#3 = 99;
         |LEE 000#dscam009.];
         |SI FSalida = 0;
            |SI #dscam009#14 = #dscam008#40;
               efFechaUlt = #dscam009#6;
            |SINO;
               |LEE 000#dscam009.a;
               |SI FSalida = 0;
                  |SI #dscam009#14 = #dscam008#40;
                     efFechaUlt = #dscam009#6;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            |LEE 000#dscam009.u;
            |SI FSalida = 0;
               |SI #dscam009#14 = #dscam008#40;
                  efFechaUlt = #dscam009#6;
               |FINSI;
            |FINSI;
         |FINSI;

         |HAZ GrabaRecibo;
      |FINSI;
      Manual = 0;
   |SINO;
      #dscaz007#0 = NumLin;
      |LEE 010#dscaz007.=;
   |FINSI;
|FPRC;

|PROCESO GrabaRecibo;
   |SI #dscam051#121 ! "N"; || Certificados de contratistas
      eaCliente = #dscam008#32;   efFechaVto = #dscam008#3;
      enDocumento = #dscam008#40; |HAZ MiraCertContr;
      |SI enSwErr ! 0; |ACABA; |FINSI;
   |SINO;
      eaCodigo = #dscam008#32; eaCuenta = #dscam008#5; |HAZ MiraSiBloq;
      |SI enSwErr ! 0; |ACABA; |FINSI;
   |FINSI;

   enNumDocumento = #dscam008#40;
   enEmpGestion = #dscam008#46; |HAZ MiraSiVisado;
   |SI enSwVisado < 0; |ACABA; |FINSI;

   |SI #dscam008#31 = 0; |ACABA; |FINSI;
   |SI #dscam008#14 ! "P"; |Y #dscam008#14 ! "C"; |ACABA; |FINSI;
   |SI Manual = 0; Linea = Linea + 1; |FINSI;

   enSwClas   = 1; eaFichClas = "dscaz007"; eaTipoClas = #dscam008#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |ACABA; |FINSI;

   |DDEFECTO #dscaz007;

   efFechaDiv = #dscaz007#14;
   Divisa = #dscam008#59; |HAZ TomaDecim;
   #dscam008#60 = NombreDiv;

   |SI Manual = 0;
      #dscaz007#0  = Linea;
   |SINO;
      #dscaz007#0  = NumLin;
      |LEE 000#dscaz007.=;
   |FINSI;
   #dscaz007#1  = #dscam008#0;
   #dscaz007#2  = #dscam008#1;
   #dscaz007#3  = #dscam008#2;
   #dscaz007#4  = #dscam008#5;
   #dscaz007#5  = #dscam008#32;
   #dscaz007#6  = #dscam008#6;
   #dscaz007#7  = #dscam008#31;
   #dscaz007#8  = #dscam008#23;
   #dscaz007#9  = #dscam008#22;
   #dscaz007#10 = " ";
   #dscaz007#11 = #dscam008#3;
   #dscaz007#12 = #dscam008#4;
   #dscaz007#13 = #dscam051#5;
   #dscaz007#14 = #dscam008#3;
   #dscaz007#15 = 0;
   #dscaz007#16 = #dscam008#13;
   #dscaz007#17 = #dscam008#12;
   #dscaz007#20 = #dscam008#27;
   #dscaz007#21 = #dscam008#40;
   #dscaz007#22 = #dscam008#59;
   #dscaz007#25 = #dscam008#61;
   #dscaz007#26 = #dscam051#22;
   #dscaz007#28 = #dscam008#63;

   |SI Manual = 0;
      |GRABA 020#dscaz007.n;
   |SINO;
      |GRABA 020#dscaz007.a;
   |FINSI;
   nTotalPdt = nTotalPdt + #dscaz007#9 -  #dscaz007#8;
|FPRC;

|DEFBUCLE Vencimiento;
#dscam008#3;
;
"01.01.1900",000000001;
"31.12.2999",999999999;
;
NULL,GrabaRecibo;
|FIN;

|DEFBUCLE Emision;
#dscam008#4;
;
"01.01.1900",000000001;
"31.12.2999",999999999;
;
NULL,GrabaRecibo;
|FIN;

|DEFBUCLE Cliente;
#dscam008#5;
;
"            ",000000001;
"zzzzzzzzzzzz",999999999;
;
NULL,GrabaRecibo;
|FIN;

|RUTINA inf007;
   #dscaz007#0 = 00001;
|FRUT;

|RUTINA sup007;
   #dscaz007#0 = 99999;
|FRUT;

|PROCESO MarcaTodos;
   |SI #dscaz007#10 = "*"; |ACABA; |FINSI;

   eaTOperacion = "A"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;
   #dscaz007#8 = #dscaz007#7;
   #dscaz007#13 = #dscam051#5;
   #dscaz007#16 = #dscam051#9;
   #dscaz007#17 = #dscam051#11;
   #dscaz007#10 = "*";
   #dscaz007#26 = #dscam051#22;
   HaySelec = HaySelec + 1;
   nTotalPdt = nTotalPdt - #dscaz007#9;
   nTotalLiq = nTotalLiq + #dscaz007#9;
   |HAZ CambioDivisa;
   |GRABA 020#dscaz007.a;
|FPRC;

|DEFBUCLE MarcaTodos;
#dscaz007#1;
;
INICIO;
FINAL;
;
NULL,MarcaTodos;
|FIN;

|PROCESO DesmarcaTodos;
   |SI #dscaz007#10 = " "; |ACABA; |FINSI;

   eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;
   #dscam008#40 = #dscaz007#21;
   |LEE 010#dscam008.=;
   |SI FSalida = 0;
      #dscaz007#8 = #dscam008#23;
      #dscaz007#10 = " ";
      |GRABA 020#dscaz007.a;
      HaySelec = HaySelec - 1;
      nTotalPdt = nTotalPdt + #dscaz007#8;
      nTotalLiq = nTotalLiq - #dscaz007#8;
   |FINSI;
|FPRC;

|DEFBUCLE DesmarcaTodos;
#dscaz007#1;
;
INICIO;
FINAL;
;
NULL,DesmarcaTodos;
|FIN;

|PROCESO MarcaDesm;
   |SI #dscaz007#10 = " ";
      eaTOperacion = "A"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;
      #dscaz007#8 = #dscaz007#7;
      #dscaz007#13 = #dscam051#5;
      #dscaz007#16 = #dscam051#9;
      #dscaz007#17 = #dscam051#11;
      #dscaz007#26 = #dscam051#22;
      #dscaz007#10 = "*";
      HaySelec = HaySelec + 1;
      nTotalPdt = nTotalPdt - #dscaz007#9;
      nTotalLiq = nTotalLiq + #dscaz007#9;
      |HAZ CambioDivisa;
      |GRABA 020#dscaz007.a;
   |SINO;
      nTotalPdt = nTotalPdt + #dscaz007#8;
      nTotalLiq = nTotalLiq - #dscaz007#8;

      eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;
      #dscam008#40 = #dscaz007#21;
      |LEE 010#dscam008.=;
      |SI FSalida = 0;
         #dscaz007#8 = #dscam008#23;
         #dscaz007#13 = "";
         #dscaz007#16 = "";
         #dscaz007#17 = 0;
         #dscaz007#10 = " ";
         |GRABA 020#dscaz007.a;
         HaySelec = HaySelec - 1;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO MarcaDesmarca; |TIPO 11;
   |SI FSalida = 11;
      |SALVA_FICHA #dscaz007;
      |PONCONTROL 23,"si";
      |BUCLE MarcaTodos;
      |PONCONTROL 23,"SI";
      |REPON_FICHA #dscaz007;
   |FINSI;
   |SI FSalida = 12;
      |SALVA_FICHA #dscaz007;
      |PONCONTROL 23,"si";
      |BUCLE DesmarcaTodos;
      |PONCONTROL 23,"SI";
      |REPON_FICHA #dscaz007;
   |FINSI;
   |SI FSalida = 9;
      |HAZ MarcaDesm;
   |FINSI;
   |SI FSalida = 18;
      |SALVA_FICHA #dscaz007;
      |PONCONTROL 23,"si";
      |HAZ AsignaCta;
      |PONCONTROL 23,"SI";
      |REPON_FICHA #dscaz007;
   |FINSI;

   #dscaw079#0 = nTotalPdt; #dscaw079#1 = nTotalLiq;
   |ATRI I; |PINTA 0801, " Pendiente : "; |PINTA 0825, " Liquidado : "; |ATRI N;
   |PINTA 0814, #dscaw079#0; |PINTA 0838, #dscaw079#1;
|FPRC;

|PROCESO LineaCaja;
   || Determino la empresa de contabilidad
   |DBASS aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "contagen/def/canempre.mas";
   |CARGA_DEF aAlfa, canempre@;
   |SI FSalida = 0;
      |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "contagen/fich/";
      |PATH_DAT #canempre@#aAlfa#;
      |ABRE #canempre@;

      |DFICB aAlfa; |QBF aAlfa; |PATH_DAT #dscam043#aAlfa#;
      |ABRE #dscam043;
      |SELECT #2#dscam043;
      #dscam043#9 = #48#0;
      |LEE 000#dscam043.];
      |PARA; |SI FSalida = 0; |HACIENDO;
         #canempre@#2 = #dscam043#0;
         #canempre@#3 = #dscam043#1;
         |LEE 000#canempre@.=;
         |SI FSalida = 0;
            nAnyo = #canempre@#26;
            |SI nAnyo > 80;
               nAnyo = nAnyo + 1900;
            |SINO;
               nAnyo = nAnyo + 2000;
            |FINSI;
            aAlfa = #dscam009#6; |QBF aAlfa;
            aAlfa = aAlfa % -104; nCalc = aAlfa;
            |SI nAnyo = nCalc; |Y #dscam009#0 ] #dscam043#7;
             |Y #dscam009#0 [ #dscam043#8; |Y #dscam043#3 = "C";
               |SI #canempre@#34 > #dscam009#6; |Y #canempre@#34 ! "01.01.0000";
                  aAlfa = "    Empresa contable bloqueada a fecha " + #canempre@#34;
                  |MENAV aAlfa;
               |SINO;
                  |SAL;
               |FINSI;
            |FINSI;
         |FINSI;
         |LEE 000#dscam043.s;
      |SIGUE;

      |SI FSalida ! 0; |O nAnyo ! nCalc; |O #dscam009#0 < #dscam043#7; |O #dscam009#0 > #dscam043#8;
        |O #dscam043#3 ! "C";
         |MENAV "    No encuentro la empresa contable asociada a esta empresa de cartera.";
         |SELECT #1#dscam043; |CIERRA #dscam043;
         |ACABA;
      |SINO;
         |SI #canempre@#34 > #dscam009#6; |Y #canempre@#34 ! "01.01.0000";
            |MENAV "    No encuentro la empresa contable asociada a esta empresa de cartera.";
            |SELECT #1#dscam043; |CIERRA #dscam043;
            |ACABA;
         |FINSI;
      |FINSI;
      |SELECT #1#dscam043;
      |CIERRA #dscam043;

      |ABRE #dscam165;
      |LEE 000#dscam165.p;
      |SI FSalida ! 0; |DDEFECTO #dscam165; |FINSI;
      |CIERRA #dscam165;

      |DBASS aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "contagen/def/cajainca.mas";
      |CARGA_DEF aAlfa, cajainca@;
      |SI FSalida = 0;
         |DBASS aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "contagen/def/cajainli.mas";
         |CARGA_DEF aAlfa, cajainli@;
         |SI FSalida = 0;
            |DBASS aAlfa; |QBF aAlfa;
            aAlfa = aAlfa + "contagen/def/caconasi.mas";
            |CARGA_DEF aAlfa, caconasi@;
            |SI FSalida = 0;
               |DBASS aAlfa; |QBF aAlfa;
               aAlfa = aAlfa + "contagen/fich/" + (("00000" + #dscam043#0) % -105) + #dscam043#1 + "/";
               |PATH_DAT #cajainca@#aAlfa#; |PATH_DAT #cajainli@#aAlfa#; |PATH_DAT #caconasi@#aAlfa#;

               |ABRE #cajainca@; |ABRE #cajainli@;
               |ABRE #caconasi@;

               #canempre@#2 = #dscam043#0;
               #canempre@#3 = #dscam043#1;
               |LEE 000#canempre@.=;
               |SI FSalida ! 0; |DDEFECTO #canempre@; |FINSI;

               #cajainca@#1 = #dscam009#6;
               |LEE 101#cajainca@.=;
               |SI FSalida ! 0;
                  |DDEFECTO #cajainca@;
                  #cajainca@#0 = #dscam165#1;
                  #cajainca@#1 = #dscam009#6;

                  |DDEFECTO #caconasi@;
                  |LEE 101#caconasi@.p;
                  |SI FSalida = 0;
                     #caconasi@#1 = #caconasi@#1 + 1;
                     #cajainca@#4 = #caconasi@#1;
                     |GRABA 020#caconasi@.a; |LIBERA #caconasi@;
                  |FINSI;

                  |GRABA 020#cajainca@.b;
               |FINSI;

               nApunte = 1;
               #cajainli@#1 = #cajainca@#1;
               #cajainli@#3 = 1;
               |LEE 000#cajainli@.];
               |PARA; |SI FSalida = 0; |Y #cajainli@#1 = #cajainca@#1; |HACIENDO;
                  nApunte = #cajainli@#3 + 1;
                  |LEE 000#cajainli@.s;
               |SIGUE;
               |DDEFECTO #cajainli@;
               #cajainli@#0 = #cajainca@#0;
               #cajainli@#1 = #cajainca@#1;
               #cajainli@#2 = #cajainca@#4;
               #cajainli@#3 = nApunte;
               #cajainli@#4 = #dscam008#5;
               aAlfa = #dscam009#4; |QBF aAlfa;
               aLong = aAlfa % 0; nLong = aLong;
               #cajainli@#5 = 0;
               |PARA nCont = 14; |SI nCont [ 19; |HACIENDO nCont = nCont + 1;
                  |SI nLong = #canempre@#nCont#;
                     #cajainli@#5 = nCont - 13; |SAL;
                  |FINSI;
               |SIGUE;
               #cajainli@#6  = #dscam165#4;
               aAlfa = #dscam165#5; |QBF aAlfa; aAlfa = aAlfa + " DOCUMENTO N§ " + #dscam009#14;
               aAlfa = aAlfa + "-" + #dscam009#17; |QBF aAlfa;
               #cajainli@#7  = aAlfa;
               #cajainli@#8  = "P";
               #cajainli@#9  = #dscam009#8;
               #cajainli@#13 = "P";
               #cajainli@#14 = #dscam008#27;
               #cajainli@#15 = #dscam008#1;
               #cajainli@#16 = #dscam008#0;
               #cajainli@#17 = #dscam008#2;
               |GRABA 020#cajainli@.n;

               #cajainca@#2 = #cajainca@#2 + #cajainli@#9;
               |GRABA 020#cajainca@.a; |LIBERA #cajainca@;

               |CIERRA #cajainli@; |CIERRA #cajainca@;
               |CIERRA #caconasi@; |DESCARGA_DEF #caconasi@;

               #dscam009#38 = nApunte;
            |FINSI;
            |DESCARGA_DEF #cajainli@;
         |FINSI;
         |DESCARGA_DEF #cajainca@;
      |FINSI;
      |CIERRA #canempre@; |DESCARGA_DEF #canempre@;
   |FINSI;
|FPRC;

|PROCESO Volcado;
   |SI #dscaz007#10 = " "; |ACABA; |FINSI;

   nNumSec = #dscaz007#27;
   efFechaDiv = #dscaz007#14;
   Divisa = #dscaz007#22; |HAZ TomaDecim;

   #dscam008#40 = #dscaz007#21;
   |LEE 000#dscam008.=;
   |SI FSalida ! 0; |DDEFECTO #dscam008; |FINSI;

   #dscam009#14 = #dscaz007#21;
   #dscam009#3 = 99;
   |LEE 010#dscam009.];
   |SI FSalida ! 0;
      |LEE 010#dscam009.u;
      |SI FSalida = 0; |Y #dscam009#14 = #dscaz007#21;
         LinCob = #dscam009#3 + 1;
      |SINO;
         LinCob = 1;
      |FINSI;
   |SINO;
      |SI #dscam009#14 = #dscaz007#21;
         LinCob = #dscam009#3 + 1;
      |SINO;
         |LEE 010#dscam009.a;
         |SI FSalida = 0; |Y #dscam009#14 = #dscaz007#21;
            LinCob = #dscam009#3 + 1;
         |SINO;
            LinCob = 1;
         |FINSI;
      |FINSI;
   |FINSI;

   |DDEFECTO #dscam009;
   #dscam009#14 = #dscaz007#21;
   #dscam009#13 = #dscaz007#20;
   #dscam009#0  = #dscaz007#1;
   #dscam009#1  = #dscaz007#2;
   #dscam009#2  = #dscaz007#3;
   #dscam009#3  = LinCob;
   #dscam009#4  = #dscaz007#13;
   nCalc1 = #dscaz007#7 + #dscaz007#15 + #dscaz007#18 + #dscaz007#19;
   |SI nCalc1 = #dscaz007#8;
      #dscam009#5  = "PAG";
   |SINO;
      #dscam009#5  = "PAP";
   |FINSI;
   #dscam009#6  = #dscaz007#14;
   #dscam008#40 = #dscaz007#21;
   |LEE 010#dscam008.=;
   |SI FSalida = 0;
      #dscam009#7  = #dscam008#23;
      #dscam009#20 = #dscam008#57;
   |FINSI;
   #dscam009#8  = #dscaz007#8;
   #dscam009#9  = #dscaz007#15 + #dscaz007#19;
   #dscam009#10 = #dscaz007#16;
   #dscam009#11 = #dscaz007#15;
   #dscam009#12 = #dscaz007#19;

   Calc = #dscaz007#8 / #dscaz007#24;
   #dscam008#40 = #dscaz007#21;
   |LEE 010#dscam008.=;
   |SI FSalida = 0;
      |SI Calc > #dscam008#58; Calc = #dscam008#58; |FINSI;
   |FINSI;

   Calc = (1/#dscaz007#24) - (1/#dscaz007#25);
   ||#dscam009#26 = #dscaz007#8 * Calc;
   #dscam009#21 = #dscaz007#8 / #dscaz007#24;
   ||#dscam009#23 = #dscaz007#15 / #dscaz007#25;
   ||#dscam009#24 = #dscaz007#19 / #dscaz007#25;
   #dscam009#23 = #dscaz007#15 / #dscaz007#24;
   #dscam009#24 = #dscaz007#19 / #dscaz007#24;
   ||Calc = #dscam008#58 + #dscam009#26 + #dscam009#23 + #dscam009#24;
   ||SI #dscam009#21 > Calc; #dscam009#21 = Calc; |FINSI;
   #dscam009#25 = #dscaz007#24;
   #dscam009#33 = nNumSec;
   #dscam009#17 = #dscaz007#29;
   ||#dscam009#26 = #dscam009#21 - (#dscam009#23 + #dscam009#24 + #dscam008#53);
   #dscam009#26 = #dscam009#21 - #dscam009#23 - #dscam009#24;
   #dscam009#26 = #dscam009#26 - ((#dscam009#8 - #dscam009#11 - #dscam009#12) / #dscaz007#25);

   |HAZ EsLuxe;
   |SI FSalida = 0;
      aAlfa = #dscam009#4; |QBF aAlfa;
      aAlfa = aAlfa % 0103;
      |SI aAlfa = "570";
         #dscam009#37 = "S";

         #dscam008#40 = #dscaz007#21;
         |LEE 000#dscam008.=;
         |SI FSalida ! 0; |DDEFECTO #dscam008; |FINSI;

         |HAZ LineaCaja;
      |FINSI;
   |FINSI;

   |GRABA 020#dscam009.c;

   #dscam008#40 = #dscaz007#21;
   |LEE 101#dscam008.=;
   |SI FSalida = 0;
      #dscam008#0  = #dscaz007#1;
      #dscam008#1  = #dscaz007#2;
      #dscam008#2  = #dscaz007#3;
      #dscam008#26 = #dscaz007#14;
      #dscam008#23 = #dscam008#23 + #dscaz007#8;

      Calc = (1/#dscaz007#24) - (1/#dscaz007#25);
      ||#dscam008#62 = #dscam008#62 + (#dscaz007#8 * Calc);
      #dscam008#62 = #dscam008#62 + #dscam009#26;

      #dscam008#24 = #dscam008#24 + #dscaz007#15;
      ||#dscam008#54 = #dscam008#54 + (#dscaz007#15 / #dscaz007#25);
      #dscam008#54 = #dscam008#54 + (#dscaz007#15 / #dscaz007#24);
      #dscam008#38 = #dscam008#38 + #dscaz007#19;
      ||#dscam008#55 = #dscam008#55 + (#dscaz007#19 / #dscaz007#25);
      #dscam008#55 = #dscam008#55 + (#dscaz007#19 / #dscaz007#24);
      #dscam008#25 = #dscam008#22 + #dscam008#24 + #dscam008#38;
      #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55 + #dscam008#62;
      #dscam008#31 = #dscam008#25 - #dscam008#23;

      Calc = #dscaz007#8 / #dscaz007#24;
      |SI Calc > #dscam008#56; Calc = #dscam008#56; |FINSI;
      #dscam008#57 = #dscam008#57 + Calc;
      #dscam008#58 = #dscam008#56 - #dscam008#57;

      |SI #dscam008#31 = 0;
         #dscam008#14 = "L";
         #dscam008#15 = "Recibo Liquidado";
      |SINO;
         |SI #dscam008#23 = 0;
            #dscam008#14 = "P";
            #dscam008#15 = "Pendiente de pago";
         |SINO;
            #dscam008#14 = "C";
            #dscam008#15 = "Parcialmente pagado";
         |FINSI;
      |FINSI;
      |GRABA 020#dscam008.a; |LIBERA #dscam008;
   |FINSI;

   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#1 = "S"; |Y HayConta = 1; |Y #dscaz007#26 ! "    ";
      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #dscaw013#Comodin#;
      |DELINDEX #dscaw013; |ABRE #dscaw013;
      |SI #dscaz007#27 = 0;
         Linea = 1;
         #dscaw013#15 = #dscaz007#26; #dscaw013#0 = Linea;
         #dscaw013#13 = "dscam009";   #dscaw013#14 = 14;
         #dscaw013#5 = #dscam009#14;  #dscaw013#6 = #dscam009#14;
         #dscaw013#11 = "N";          #dscaw013#12 = 9;
         |GRABA 020#dscaw013.n;
         |LIBERA #dscaw013;
         Linea = Linea + 1;
         #dscaw013#15 = #dscaz007#26; #dscaw013#0 = Linea;
         #dscaw013#13 = "dscam009";   #dscaw013#14 = 3;
         #dscaw013#5 = #dscam009#3;   #dscaw013#6 = #dscam009#3;
         #dscaw013#11 = "N";          #dscaw013#12 = 3;
         |GRABA 020#dscaw013.n;
         |LIBERA #dscaw013;
         |CIERRA #dscaw013;
         Comodin = #dscaz007#26; |QBF Comodin;
         Comodin = "dscam033.tab;" + Comodin;

         |LIBERA #dscam008; |CIERRAT #dscam008;
         |LIBERA #dscam009; |CIERRAT #dscam009;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam008; |LEE 101#dscam008.=;
         |ABRET #dscam009; |LEE 101#dscam009.=;
         |DELINDEX #dscaw013;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
      |FINSI;
   |FINSI;

   eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE Volcado;
#dscaz007#1;
;
INICIO;
FINAL;
;
NULL,Volcado;
|FIN;

|PROCESO Liberar;
   eaTOperacion = "B"; eaTipoRecibo = "C"; enNumDocum = #dscaz007#21; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE Liberar;
#dscaz007#1;
;
INICIO;
FINAL;
;
NULL,Liberar;
|FIN;

|PROCESO MarcaSec;
   #dscaw043#6 = -1; |GRABA 020#dscaw043.a;
|FPRC;

|DEFBUCLE MarcaSec;
#dscaw043#1;
6;
00001,nNumSec;
99999,nNumSec;
;
NULL,MarcaSec;
|FIN;

|PROCESO VuelcaSec;
   |SI #dscaw043#6 ] 0;
      |SI #dscam051#1 = "S"; |Y HayConta = 1;

         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #101 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         #dscaw013#15 = #dscaw043#5;  #dscaw013#0  = 1;
         #dscaw013#13 = "dscam009";   #dscaw013#14 = 33;
         #dscaw013#5 = #dscaw043#6;   #dscaw013#6  = #dscaw043#6;
         #dscaw013#11 = "N";          #dscaw013#12 = 9;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;

         Comodin = #dscaw043#5; |QBF Comodin;
         Comodin = "dscam033.tab;" + Comodin;
         |LIBERA #dscam008; |CIERRAT #dscam008;
         |LIBERA #dscam009; |CIERRAT #dscam009;
         |SUB_EJECUTA_NP Comodin; |DELINDEX #dscaw013;
         |ABRET #dscam008; |LEE 101#dscam008.=;
         |ABRET #dscam009; |LEE 101#dscam009.=;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
      |FINSI;

      nNumSec = #dscaw043#6;
      |SALVA_FICHA #dscaw043;
      |BUCLE MarcaSec;
      |LEE 000#dscaw043.p; |REPON_FICHA #dscaw043;
      |CIERRA #dscaw013;
   |FINSI;
|FPRC;

|DEFBUCLE VuelcaSec;
#dscaw043#1;
6;
00001,000000001;
99999,999999999;
;
NULL,VuelcaSec;
|FIN;

|PROCESO MiraSec;

   |SELECT #3#dscaw043;
   #dscaw043#2 = #dscaz007#13;
   #dscaw043#3 = "    ";
   #dscaw043#4 = "          ";
   #dscaw043#5 = #dscaz007#26;
   #dscaw043#7 = #dscaz007#14;
   |LEE 000#dscaw043.=;
   FEstado = FSalida;
   |SELECT #1#dscaw043;

   |SI FEstado = 0;
      nNumSec = #dscaw043#6;
   |SINO;
      |SI nNumSec = 0;
         |SALVA_FICHA #dscam009;
         |SELECT #3#dscam009;
         |LEE 000#dscam009.u;
         |SI nNumSec [ #dscam009#33;
            nNumSec = #dscam009#33 + 1;
         |SINO;
            nNumSec = nNumSec + 1;
         |FINSI;
         |SELECT #1#dscam009;
         |LEE 000#dscam009.p; |REPON_FICHA #dscam009;
      |SINO;
         nNumSec = nNumSec + 1;
      |FINSI;
   |FINSI;

   |ABRE #dscam030;
   #dscam030#0 = #dscaz007#26;
   |LEE 000#dscam030.=;
   |SI FSalida = 0;
      |SI #dscam030#8 = "N"; nNumSec = 0; |FINSI;
   |SINO;
      nNumSec = 0;
   |FINSI;
   |CIERRA #dscam030;

   |DDEFECTO #dscaw043;
   #dscaw043#0 = #dscaz007#0;
   #dscaw043#1 = #dscaz007#21;
   #dscaw043#2 = #dscaz007#13;
   #dscaw043#5 = #dscaz007#26;
   #dscaw043#6 = nNumSec;
   #dscaw043#7 = #dscaz007#14;
   |GRABA 020#dscaw043.n;

   #dscaz007#27 = nNumSec; |GRABA 020#dscaz007.a;

|FPRC;

|DEFBUCLE MiraSec;
#dscaz007#1;
10;
00001,"*";
99999,"*";
;
NULL,MiraSec;
|FIN;

|PROCESO Busca;
   |SI FSalida = 10;
      PosLibro = 2210; PosSerie = 2219; PosFactu = 2240; PosRecib = 2247;
      |HAZ ConsultaCompras;
      |SI enDocum ! -1; |Y enFactura ! -1;
         #dscaz007#21 = enDocum; |PINTA #dscaz007#21;
      |SINO;
         |MENAV "    Ficha inexistente"; |ERROR;
      |FINSI;
      SwClave = 1;
   |FINSI;
|FPRC;

|DEFBUCLE Acota;
#dscam008#6;
4,12;
DCtaProv,DCodProv,#dscaw007#3,#dscaw007#5,#dscaw007#46;
HCtaProv,HCodProv,#dscaw007#4,#dscaw007#6,#dscaw007#47;
;
NULL,GrabaRecibo;
|FIN;

|PROCESO BucleAcotado;
   |PUSHV 0501 2380;
   #dscaw007#31 = #dscam051#100;
   |PINPA #0#dscaw007; |PINDA #0#dscaw007;

   |ATRI R;
   |PINTA 0836, "COMPRA ";
   |PINTA 1421, "PROVEEDORES ";
   |ATRI N;
   |PINTA 0922, "Proveed."; |PINTA 0942, "Proveed.";
   |PINTA 1018, "Proveed."; |PINTA 1048, "Proveed.";

   |SI HayGestion = 1; #dscaw007#31 = "G"; |SINO; #dscaw007#31 = "C"; |FINSI;
   |HAZ Seleccion;

   |ENDATOS #1#dscaw007;
   |SI FSalida = 0;
      |SI #dscaw007#31 = "G";
         |SI #dscaw007#0 = "S";
            DCtaProv = " " * 12;    HCtaProv = "z" * 12;
            DCodProv = #dscaw007#1; HCodProv = #dscaw007#2;
            |BUCLE Acota;
         |SINO;
            |PARA Cont = 7; |SI Cont [ 30; |HACIENDO Cont = Cont + 1;
               |SI #dscaw007#Cont# ! 0;
                  DCtaProv = " " * 12;        HCtaProv = "z" * 12;
                  DCodProv = #dscaw007#Cont#; HCodProv = #dscaw007#Cont#;
                  |BUCLE Acota;
               |FINSI;
            |SIGUE;
         |FINSI;
      |SINO;
         |SI #dscaw007#0 = "S";
            DCodProv = " " * 6;      HCodProv = "z" * 6;
            DCtaProv = #dscaw007#32; HCtaProv = #dscaw007#33;
            |BUCLE Acota;
         |SINO;
            |PARA Cont = 34; |SI Cont [ 45; |HACIENDO Cont = Cont + 1;
               |SI #dscaw007#Cont# ! 0;
                  DCodProv = " " * 6;         HCodProv = "z" * 6;
                  DCtaProv = #dscaw007#Cont#; HCtaProv = #dscaw007#Cont#;
                  |BUCLE Acota;
               |FINSI;
            |SIGUE;
         |FINSI;
      |FINSI;
   |FINSI;
   |POPV;
|FPRC;

|PROCESO MensaAntes; |TIPO 7;
   |SI #dscaw007#31 = "G";
      |MENSA "    <F2> Consulta proveedores";
   |SINO;
      |MENSA "    <F2> Consulta cuentas contables";
   |FINSI;
|FPRC;

|PROCESO MensaDespues;
   |SI #dscaw007#31 = "G";
      |SI Campo = 1; |O Campo = 2;  |BLIN 4; |FINSI;
   |SINO;
      |SI Campo = 32; |O Campo = 33; |BLIN 4; |FINSI;
   |FINSI;
|FPRC;

|PROCESO MiraCliente;
   TipoProveedor = #dscaw007#31;
   enExistOblig = 1;
   CodProveedor = #dscaw007#Campo#;

   DCampoG = Campo; HCampoG = Campo;
   DCampoC = Campo; HCampoC = Campo;
   |HAZ ExisteProveedor;
   #dscaw007#Campo# = CodProveedor; |PINTA #dscaw007#Campo#;
|FPRC;

|PROCESO Seleccion;
   |SI HayConta = 0; |Y #dscaw007#31 = "C";
      |MENAV "    La contabilidad no esta instalada";
      |ERROR; |ACABA;
   |FINSI;

   |SI HayGestion = 0; |Y #dscaw007#31 = "G";
      |MENAV "    La gestion comercial no esta instalada";
      |ERROR; |ACABA;
   |FINSI;

   |SI #dscaw007#31 = "C";
      |C_M #dscaw007#1,1,"N"; |C_V #dscaw007#1,1,"N";
      |C_M #dscaw007#2,1,"N"; |C_V #dscaw007#2,1,"N";
      |PARA Cont = 7; |SI Cont [ 30; |HACIENDO Cont = Cont + 1;
         |C_M #dscaw007#Cont#,1,"N"; |C_V #dscaw007#Cont#,1,"N";
      |SIGUE;
      |SI #dscaw007#0 = "S";
         |C_M #dscaw007#32,1,"S"; |C_V #dscaw007#32,1,"S";
         |C_M #dscaw007#33,1,"S"; |C_V #dscaw007#33,1,"S";
      |SINO;
         |C_M #dscaw007#32,1,"N"; |C_V #dscaw007#32,1,"S";
         |C_M #dscaw007#33,1,"N"; |C_V #dscaw007#33,1,"S";
      |FINSI;
      |PINTA #dscaw007#32; |PINTA #dscaw007#33;
      |PARA Cont = 34; |SI Cont [ 45; |HACIENDO Cont = Cont + 1;
         |SI #dscaw007#0 = "S";
            |C_M #dscaw007#Cont#,1,"N"; |C_V #dscaw007#Cont#,1,"S";
         |SINO;
            |C_M #dscaw007#Cont#,1,"S"; |C_V #dscaw007#Cont#,1,"S";
         |FINSI;
         |PINTA #dscaw007#Cont#;
      |SIGUE;
   |SINO;
      |C_M #dscaw007#32,1,"N"; |C_V #dscaw007#32,1,"N";
      |C_M #dscaw007#33,1,"N"; |C_V #dscaw007#33,1,"N";
      |PARA Cont = 34; |SI Cont [ 45; |HACIENDO Cont = Cont + 1;
         |C_M #dscaw007#Cont#,1,"N"; |C_V #dscaw007#Cont#,1,"N";
      |SIGUE;
      |SI #dscaw007#0 = "S";
         |C_M #dscaw007#1,1,"S"; |C_V #dscaw007#1,1,"S";
         |C_M #dscaw007#2,1,"S"; |C_V #dscaw007#2,1,"S";
      |SINO;
         |C_M #dscaw007#1,1,"N"; |C_V #dscaw007#1,1,"S";
         |C_M #dscaw007#2,1,"N"; |C_V #dscaw007#2,1,"S";
      |FINSI;
      |PINTA #dscaw007#1; |PINTA #dscaw007#2;
      |PARA Cont = 7; |SI Cont [ 30; |HACIENDO Cont = Cont + 1;
         |SI #dscaw007#0 = "S";
            |C_M #dscaw007#Cont#,1,"N"; |C_V #dscaw007#Cont#,1,"S";
         |SINO;
            |C_M #dscaw007#Cont#,1,"S"; |C_V #dscaw007#Cont#,1,"S";
         |FINSI;
         |PINTA #dscaw007#Cont#;
      |SIGUE;
   |FINSI;
   |PINPA #0#dscaw007; |PINDA #0#dscaw007;
   |ATRI R;
   |PINTA 0836, "COMPRA ";
   |PINTA 1421, "PROVEEDORES ";
   |ATRI N;
   |PINTA 0922, "Proveed."; |PINTA 0942, "Proveed.";
   |PINTA 1018, "Proveed."; |PINTA 1048, "Proveed.";
|FPRC;

|PROCESO Cta; |TIPO 6;
   nTecla = FSalida;

   Comodin = #Fichero@#Campo#; |QBF Comodin;
   Comodin = Comodin - ".";

   |PARA; |SI FSalida ! 0; |HACIENDO;
      nParte1 = (FSalida / 100) ! 0 + 99; aParte1 = Comodin % nParte1;
      nParte2 = FSalida + 98;            aParte2 = Comodin % nParte2;
      |PARA; |SI FSalida ! 0; |HACIENDO; aParte1 = aParte1 - "."; |SIGUE;
      FSalida = 1;
      |PARA; |SI FSalida ! 0; |HACIENDO; aParte2 = aParte2 - "."; |SIGUE;
      Comodin = aParte1 % 0; Calc = Comodin;
      Comodin = aParte2 % 0; Calc = Calc + Comodin;
      Calc = MaxDigit - Calc; Comodin = "0" * Calc;
      Comodin = aParte1 + Comodin + aParte2;
      #Fichero@#Campo# = Comodin; |PINTA #Fichero@#Campo#;

      Comodin = Comodin - ".";
   |SIGUE;

   FSalida = nTecla;
|FPRC;

|PROCESO ExistClient2;
   |SI FSalida = 2; |ACABA; |FINSI;
   |SI #dscaw007#0 = "S"; |ACABA; |FINSI;

   DCampoG = 7;  HCampoG = 30;
   DCampoC = 34; HCampoC = 45;

   TipoProveedor = #dscaw007#31;
   CodProveedor  = #dscaw007#Campo#;
   |HAZ ExisteProveedor;
   |SI TipoProveedor = "ERROR";
      |ERROR;
   |SINO;
      #dscaw007#Campo# = CodProveedor;
      |PINTA #dscaw007#Campo#;
   |FINSI;
|FPRC;

|PROCESO RevisaCuentas;
   |PARA Cont = 34; |SI Cont [ 45; |HACIENDO Cont = Cont + 1;
      |SI Cont ! Campo;
         |SI #dscaw007#Cont# = #dscaw007#Campo#; |Y #dscaw007#Cont# ! "            ";
            |MENAV "    Cuenta repetida";
            |ERROR;
            |ACABA;
         |FINSI;
      |FINSI;
   |SIGUE;
|FPRC;

|PROGRAMA;
   |HAZ EsLuxe;
   |SI FSalida = 0;
      nSwLuxe = 1;
   |SINO;
      nSwLuxe = 0;
   |FINSI;

   |CLS;
   |CABEZA "Control de pagos";

   |HAZ Tipo8;

   |PINPA #0#0;
   ||PINDA #0#0;
   |ENTLINEAL #1#dscaz007,-1,7,20,0,inf007,sup007;

   |ATRI I; |PINTA 0801, " Pendiente "; |PINTA 0825, " Liquidado : "; |ATRI N;
   |PINTA 0814, #dscaw079#0; |PINTA 0838, #dscaw079#1;
   |ATRI I;

   |MENU menu;
   Opcion = FSalida;
   |SI Opcion < 1; |O Opcion > 5; |ACABA; |FINSI;

   nTotalLiq = 0; nTotalPdt = 0;

   aNomeDat7 = "cp" + Usuario; |NOME_DAT #0 aNomeDat7;
   |DELINDEX #dscaz007;
   |ABRE #dscaz007;
   |ABRE #dscam008;
   |ABRE #dscam009;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
   |FINSI;

   |SI Opcion = 1;
      |C_V #dscaz007#11,1,"S";
      |C_V #dscaz007#12,1,"N";
      |C_P #dscaz007#11,1,1244;
      |C_P #dscaz007#12,1,1144;
      |PINTA 1050, "Vto";
      |BUCLE Vencimiento;
   |FINSI;
   |SI Opcion = 2;
      |C_V #dscaz007#11,1,"N";
      |C_V #dscaz007#12,1,"S";
      |C_P #dscaz007#11,1,1144;
      |C_P #dscaz007#12,1,1244;
      |PINTA 1050, "Emi";
      |BUCLE Emision;
   |FINSI;
   |SI Opcion = 3; |BUCLE Cliente;      |FINSI;
   |SI Opcion = 4; |HAZ BucleAcotado; |FINSI;

   |PTEC 815;
   |PTEC 814;
   |PINPA #0#dscaz007;
   |ENTLINEAL #1#dscaz007,-1,2,20,0,inf007,sup007;

   |SI HaySelec > 0;
      |ATRI R;
      |CONFI "0400N¨ Conforme con los datos introducidos ? ";
      |SI FSalida = 0;

         |HAZ RepasaEnlaces;

         |SUB_EJECUTA_NP "dscaz169.tab;INICIO";

         aAlfa = ("43" + Usuario + "zzzzzzzz") % 0108; |NOME_DAT #dscaw043#aAlfa#;
         |DELINDEX #dscaw043; |ABRE #dscaw043;
         |BUCLE MiraSec;
         |BUCLE Volcado;
         |BUCLE VuelcaSec;
         |CIERRA #dscaw043;

         |SUB_EJECUTA_NP "dscaz169.tab;FINAL";
      |SINO;
         |BUCLE Liberar;
      |FINSI;
      |ATRI N;
   |FINSI;

   eaSesion   = Usuario; |HAZ LimpiaTempo;

   |CIERRA #dscam051;
   |CIERRA #dscam009;
   |CIERRA #dscam008;
   |CIERRA #dscaz007;

   |HAZ Tipo9;
|FPRO;

/*
|PROCESO MiraCliente;
   TipoCliente = #dscaw007#31; enExistOblig = 1;
   CodCliente = #dscaw007#Campo#;

   DCampoG = Campo; HCampoG = Campo;
   DCampoC = Campo; HCampoC = Campo;
   |HAZ ExisteProveedor;
   #dscaw007#Campo# = CodProveedor; |PINTA #dscaw007#Campo#;
|FPRC;

|PROCESO MensaAntes; |TIPO 7;
   |SI #dscaw007#31 = "G";
      |MENSA "    <F2> Consulta proveedores";
   |SINO;
      |MENSA "    <F2> Consulta cuentas contables";
   |FINSI;
|FPRC;

|PROCESO MensaDespues;
   |SI #dscaw007#31 = "G";
      |SI Campo = 1; |O Campo = 2; |BLIN 4; |FINSI;
   |SINO;
      |SI Campo = 32; |O Campo = 33; |BLIN 4; |FINSI;
   |FINSI;
|FPRC;
*/

|PROCESO Puntos; |TIPO 6;
   nTecla = FSalida;
   aAlfa = #Fichero@#Campo#; |QBF aAlfa;
   aAlfa = aAlfa - ".";
   |PARA; |SI FSalida ! 0; |HACIENDO;
      nCalc = ((FSalida / 100) ! 0) + 99; aAlfa1 = aAlfa % nCalc;
      nCalc = FSalida + 98;               aAlfa2 = aAlfa % nCalc;
      aAlfa = aAlfa1 + aAlfa2; |QBF aAlfa;
      aAlfa = aAlfa % 0; nCalc = aAlfa;
      nCalc = MaxDigit - nCalc; |SI nCalc < 0; nCalc = 0; |FINSI;
      aAlfa = "0" * nCalc;
      aAlfa = aAlfa1 + aAlfa + aAlfa2;

      aAlfa = aAlfa - ".";
   |SIGUE;

   #Fichero@#Campo# = aAlfa; |PINTA #Fichero@#Campo#;
   FSalida = nTecla;
|FPRC;

|PROCESO ConsultaCtas;
   #Referen@#0 = #dscaw187#0;
   |LEE 000#Referen@.];
   |CONSULTA_CLAVE #1#Referen@;
   |SI FSalida = 0;
      #dscaw187#0 = #Referen@#0; |PINTA #dscaw187#0;
      |PINTA 2031, #Referen@#2;
   |FINSI;
|FPRC;

|PROCESO CompruebaCta;
     nSal = FSalida;
     aAlfa = #48#16; |QBF aAlfa;
     aAlfa = aAlfa + "def/cacuenta.mas";
     |CARGA_DEF aAlfa, Referen@;
     |SI FSalida = 0;
          aAlfa = #48#16; |QBF aAlfa;
          aAlfa = aAlfa + "fich/" + (("00000" + #48#14) % -105) + #48#19 + "/";
          |PATH_DAT #Referen@#aAlfa#;
          |ABRE #Referen@;
          |SI nSal= 10;
               |HAZ ConsultaCtas; |ERROR;
          |SINO;
               #Referen@#0 = #dscaw187#0;
               |LEE 000#Referen@.=;
               |SI FSalida ! 0;
                    |MENAV "    Cuenta inexistente"; |ERROR;
               |SINO;
                    #dscaw187#0 = #Referen@#0; |PINTA #dscaw187#0;
                    |PINTA 2031, #Referen@#2;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AsignaCta;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dscaz007";
     |CARGA_DEF aAlfa, xeferen@;
     |SI FSalida = 0;
          |NOME_DAT #xeferen@#aNomeDat7#;
          |ABRE #xeferen@;

          aMarca = "N";
          |LEE 000#xeferen@.p;
          |PARA; |SI FSalida = 0; |HACIENDO;
               |SI #xeferen@#10 ! " ";
                    aMarca = "S"; |SAL;
               |FINSI;
               |LEE 000#xeferen@.s;
          |SIGUE;

          |SI aMarca = "S";
               |PUSHV 0501 2380;

               |DDEFECTO #187;
               |SI HayConta = 1; |Y #dscam051#1 = "S";
                    |C_M #187#3, 1, "S";
                    #187#3 = #dscaz007#26;
               |SINO;
                    |C_M #187#3, 1, "N";
               |FINSI;
               |SI #dscam051#38 = "S";
                    #187#1 = ~;
               |SINO;
                    #187#1 = #dscaz007#14;
               |FINSI;

               #dscam008#40 = #dscaz007#21;
               |LEE 020#dscam008.=;

               |SI #dscam008#16 ! 0;
                    |ABRE #dscam014;
                    #dscam014#0 = #dscam008#16;
                    |LEE 000#dscam014.=;
                    |SI FSalida = 0;
                         #187#0 = #dscam014#10;
                    |SINO;
                         #187#0 = #dscaz007#13;
                    |FINSI;
                    |CIERRA #dscam014;
               |SINO;
                    #187#0 = #dscaz007#13;
               |FINSI;

               #187#2 = #dscaz007#29;

               |PINPA #0#187;
               |PINDA #0#187;
               |ENDATOS #1#187;
               |SI FSalida = 0;
                    |LEE 000#xeferen@.p;
                    |PARA; |SI FSalida = 0; |HACIENDO;
                         |SI #xeferen@#10 ! " ";
                              #xeferen@#13 = #187#0; ||Cta
                              #xeferen@#14 = #187#1; ||Fecha
                              #xeferen@#29 = #187#2; ||Obs
                              #xeferen@#26 = #187#3; ||Enla
                              |GRABA 020#xeferen@.a;
                         |FINSI;
                         |LEE 000#xeferen@.s;
                    |SIGUE;
               |FINSI;
               |POPV;
          |SINO;
               |MENAV "0000No hay recibos marcados.";
          |FINSI;
          |CIERRA #xeferen@;
          |DESCARGA_DEF #xeferen@;
     |FINSI;
|FPRC;
