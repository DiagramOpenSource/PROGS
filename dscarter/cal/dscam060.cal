|FICHEROS;
   dscam060 #0;

   dscam003 #1;
   dscaw019 #2;
   dscaw020 #3,MANTE;
   dscam004 #4;
   dscam048 #5;
   dscam066 #6;
   dscam030 #7;
   dscam023 #8,MANTE;

   dscam067 #10;
   dscam051 #11;
   dscaw046 #12,MANTE;
   dscaw013 #100;
   dscaw998 #101,MANTE;

   Referen@ #1000;
   taglm01@ #1001;
   cacuent@ #1002;
|FIN;

|VARIABLES;
   &MaxDigit = 0;   &Divisa   = ""; &nDeci_Div = 0; &nDeci_Base = 0;
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = ""; &efFechaDiv = @;
   &HayGestion = 0; &HayConta = 0; &CambioDivVn = 0;
   &Niv1 = 0; &Niv2 = 0; &Niv3 = 0; &Niv4 = 0; &Niv5 = 0; &Niv6 = 0;

   &enEmpCartera = 0; &enEmpGestion = 0; &enDocum = 0;
   &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = "";

   &enFPago     = 0;
   &nCamFPago   = 0;
   &fFechaFac   = @;
   &fFecVto     = @;
   &eaCliente   = "";
   &eaEmpContab = "";
   &eaDirConta  = "";
   &enSwError   = 0;

   fFechaHoy    = @;

   aAlfa = "";
   aSql  = "";
   nClave    = 0;
   nSwTagl   = 0;
   nAntClave = 0;
   nOrden    = 0;
   nNumDocum = 0;
   nNumDoc   = 0;
   nNumLin   = 0;
   nNumLinea = 0;

   nSwVtoMasivo = 0;

   nImpRec = 0;
   nImpDto = 0;

   nSwSalir  = 0;
   nSwBloq   = 0;
   LinCob  = 0;
   SwHay   = 0;
   Linea   = 0;
   nCont   = 0;
   nCont1  = 0;
   SwError = 0;
   nSwBlanco = 0;
   nImporteD = 0;
   nImporteB = 0;
   nNumSec   = 0;
   nAntDoc   = 0;
   FEstado   = 0;
   SecAnt    = 0;
   Clave1    = "";
   Clave2    = "";
   Clave3    = "";

   FechaOper = "";
   Comodin = "";
   Parte   = "";
   Part1   = "";
   Part2   = "";
   LongAlfa = "";
   aEnlace = "";
   Parte1  = 0;
   Parte2  = 0;
   Long    = 0;
   nImport = 0;

   aEntClv = "";
   aNumClv = "";
   aEntidad = "";
   aNumero = "";
   aCliente = "";
   fFecha = @;
   fFechaC = @;

   nSwitch = 0;
   aSwEntidad = "";
   aSwDocumen = "";
   aSwFecha   = "";
   aSwCliente = "";
   nSwTecla   = 0;
   nSw        = 0;
   aSesionAnt = "";

   NumDias = 0;
   SwGraba = 0;
   Fecha   = @;
{100}nSesion = 0;

   nSwConta = 0;
   nCalc    = 0;
   nLong    = 0;
   aLong    = "";
   aParte1  = "";
   aParte2  = "";
   aAlfa1   = "";

|FIN;

|PROCESO RecogeDesglose;
   #dscam066#0 = #dscam003#40;
   |LEE 000#dscam066.=;
   |SI FSalida = 0;
      nImport = #dscam066#2;
   |SINO;
      |SI #dscam003#47 = "S";
         nImport = #dscam003#23;
      |SINO;
         nImport = 0;
      |FINSI;
   |FINSI;

   |DDEFECTO #dscaw019;
   #dscaw019#0 = Linea; Linea = Linea + 1;
   #dscaw019#1 = #dscam003#40;
   #dscaw019#2 = #dscam003#3;
   |SI nImport = 0;
      #dscaw019#3 = #dscam003#65;
   |SINO;
      #dscaw019#3 = nImport;
   |FINSI;
   #dscaw019#4 = #dscam003#15;
   #dscaw019#5 = #dscam003#0;
   #dscaw019#6 = #dscam003#1;
   #dscaw019#7 = #dscam003#2;
   #dscaw019#8 = #dscam003#3;
   |GRABA 020#dscaw019.n;
|FPRC;

|DEFBUCLE RecogeDesglose;
#dscam003#7;
;
#dscam060#2,#dscam060#0,0000000001;
#dscam060#2,#dscam060#0,9999999999;
;
NULL,RecogeDesglose;
|FIN;

|RUTINA infdesg;
   #dscaw019#0 = 001;
|FRUT;

|RUTINA supdesg;
   #dscaw019#0 = 999;
|FRUT;

|PROCESO BorraLin;

   |SI #dscam004#5 ! "RPT"; |Y #dscam004#5 ! "RAC"; |ACABA; |FINSI;
   aAlfa = #dscam004#5;
   nNumDocum = #dscam004#17; nNumLin = #dscam004#3;

   |SI #dscam051#1 = "S"; |Y HayConta = 1;
      |ABRE #dscam067;
      #dscam067#0 = "CB";
      #dscam067#1 = #dscam004#17;
      #dscam067#2 = #dscam004#3;
      #dscam067#3 = "";
      #dscam067#11 = 1;
      |LEE 000#dscam067.];
      FEstado = FSalida;
      Clave1 = #dscam067#1; Clave2 = #dscam067#2;
      Clave3 = #dscam067#3; |QBF Clave3;
      |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
       |Y Clave3  = "";
          Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
          |NOME_DAT #100 Comodin;
          |DELINDEX #dscaw013; |ABRE #dscaw013;
          |DDEFECTO #dscaw013;
          #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
          #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
          #dscaw013#11 = "N";          #dscaw013#12 = 9;
          #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
          |GRABA 020#dscaw013.n;

          |DDEFECTO #dscaw013;
          #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
          #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
          #dscaw013#11 = "N";          #dscaw013#12 = 3;
          #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
          |GRABA 020#dscaw013.n;

          |LIBERA #dscaw013; |CIERRA #dscaw013;
          Comodin = #dscam067#10;
          Comodin = "dscam033.tab;" + Comodin + ",B";
          |LIBERA #dscam003; |CIERRAT #dscam003;
          |LIBERA #dscam004; |CIERRAT #dscam004;
          |SUB_EJECUTA_NP Comodin;
          |ABRET #dscam003; |LEE 101#dscam003.=;
          |ABRET #dscam004; |LEE 101#dscam004.=;

          |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
          |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
          |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
      |FINSI;
      |CIERRA #dscam067;
   |FINSI;

   |SI #dscam004#12 ! 0;
      #dscam003#24 = #dscam003#24 - #dscam004#12;
      #dscam003#62 = #dscam003#62 - #dscam004#29;
   |FINSI;
   |SI #dscam004#13 ! 0;
      #dscam003#25 = #dscam003#25 - #dscam004#13;
      #dscam003#63 = #dscam003#63 - #dscam004#30;
   |FINSI;
   |SI #dscam004#14 ! 0;
      #dscam003#38 = #dscam003#38 - #dscam004#14;
      #dscam003#66 = #dscam003#66 - #dscam004#31;
   |FINSI;
   |SI #dscam004#12 ! 0; |O #dscam004#13 ! 0; |O #dscam004#14 ! 0;
      #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
      #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
      #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
      #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);
      #dscam003#31 = #dscam003#30 - #dscam003#23;
      #dscam003#65 = #dscam003#64 - #dscam003#61;
   |FINSI;
   |BORRA 020#dscam004.a;

   |SI aAlfa = "RPT";
      #dscam004#17 = nNumDocum;
      #dscam004#3  = nNumLin;
      |LEE 000#dscam004.];
      |SI FSalida = 0;
         |LEE 000#dscam004.a;
         |SI #dscam004#5 = "PRE";
            |ABRE #dscam067;
            #dscam067#0 = "CB";
            #dscam067#1 = #dscam004#17;
            #dscam067#2 = #dscam004#3;
            #dscam067#3 = "";
            #dscam067#11 = 1;
            |LEE 000#dscam067.];
            FEstado = FSalida;
            Clave1 = #dscam067#1; Clave2 = #dscam067#2;
            Clave3 = #dscam067#3; |QBF Clave3;
            |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
             |Y Clave3  = "";
                Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
                |NOME_DAT #100 Comodin;
                |DELINDEX #dscaw013; |ABRE #dscaw013;
                |DDEFECTO #dscaw013;
                #dscaw013#15 = #dscam067#10; #dscaw013#0 = 1;
                #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
                #dscaw013#11 = "N";          #dscaw013#12 = 9;
                #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
                |GRABA 020#dscaw013.n;

                |DDEFECTO #dscaw013;
                #dscaw013#15 = #dscam067#10; #dscaw013#0 = 2;
                #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
                #dscaw013#11 = "N";          #dscaw013#12 = 3;
                #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
                |GRABA 020#dscaw013.n;

                |LIBERA #dscaw013; |CIERRA #dscaw013;
                Comodin = #dscam067#10;
                Comodin = "dscam033.tab;" + Comodin + ",B";
                |LIBERA #dscam003; |CIERRAT #dscam003;
                |LIBERA #dscam004; |CIERRAT #dscam004;
                |SUB_EJECUTA_NP Comodin;
                |ABRET #dscam003; |LEE 101#dscam003.=;
                |ABRET #dscam004; |LEE 101#dscam004.=;

                |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
                |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
                |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
            |FINSI;
            |CIERRA #dscam067;
            |BORRA 020#dscam004.a; #dscam003#90 = "N";
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE BorraLin;
#dscam004#1;
5;
#dscam003#40,001,"RAC";
#dscam003#40,999,"RPT";
be;
NULL,BorraLin;
|FIN;

|PROCESO BorraTalon;

   |SI #dscam003#47 = "S";
      |BUCLE BorraLin;
      |BORRA 020#dscam003.a;
      |ACABA;
   |FINSI;
   |SI #dscam003#70 ! "          ";
      |BUCLE BorraLin;
      #dscam003#70 = ""; #dscam003#72 = "";
   |FINSI;

   |ABRE #dscam004;
   #dscam004#17 = #dscam003#40;
   #dscam004#3 = 99;
   |LEE 000#dscam004.];
   |SI FSalida = 0;
      |LEE 000#dscam004.a;
      |SI FSalida ! 0; |O #dscam004#17 ! #dscam003#40;
         |DDEFECTO #dscam004;
      |FINSI;
   |SINO;
      |LEE 000#dscam004.u;
      |SI FSalida ! 0; |O #dscam004#17 ! #dscam003#40;
         |DDEFECTO #dscam004;
      |FINSI;
   |FINSI;
   |CIERRA #dscam004;

   #dscam003#70 = "";
   #dscam003#71 = "01.01.0000";
   #dscam003#72 = "";
   |SI #dscam003#31 = 0;
      |SI #dscam003#47 = "N";
         #dscam003#14 = "L";
         #dscam003#15 = "Recibo Liquidado";
      |SINO;
         #dscam003#14 = "e";
         #dscam003#15 = "Pendiente de compensar";
      |FINSI;
   |SINO;
      |SI #dscam003#23 = 0;
         |SI #dscam003#70 = "          ";
            |SI #dscam003#16 = 0;
               |SI #dscam004#5 = "CFR";
                  #dscam003#14 = "F";
                  #dscam003#15 = "Recepcionado Confirme";
                  #dscam003#70 = #dscam004#52;
                  #dscam003#71 = #dscam004#53;
                  #dscam003#72 = #dscam004#51;
               |SINO;
                  #dscam003#14 = "P";
                  #dscam003#15 = "Pendiente de cobro";
               |FINSI;
            |SINO;
               #dscam003#14 = "I";
               #dscam003#15 = "Impagado";
            |FINSI;
         |SINO;
            |SI #dscam003#47 = "N";
               #dscam003#14 = "T";
               #dscam003#15 = "Pagare/Talon de cliente";
            |SINO;
               #dscam003#14 = "p";
               #dscam003#15 = "Entrega pdte.cobro";
            |FINSI;
         |FINSI;
      |SINO;
         #dscam003#14 = "C";
         #dscam003#15 = "Parcialmente cobrado";
      |FINSI;
   |FINSI;
   #dscam003#73 = "";
   #dscam003#74 = "";
   #dscam003#26 = ~;
   #dscam003#90 = "N";
   |GRABA 020#dscam003.a; |LIBERA #dscam003;

   #dscam066#0 = #dscam003#40;
   |LEE 000#dscam066.=;
   |SI FSalida = 0;
      |BORRA 020#dscam066.a;
   |FINSI;

|FPRC;

|DEFBUCLE BorraTalon;
#dscam003#7;
;
#dscam060#2,#dscam060#0,0000000001;
#dscam060#2,#dscam060#0,9999999999;
be;
NULL,BorraTalon;
|FIN;

|PROCESO RevisaTalon;
   |SI #dscam003#47 = "S"; |ACABA; |FINSI;

   |SI #dscam003#31 = 0; SwError = 1; |ERROR10; |FINSI;

   #dscam004#17 = #dscam003#40;
   #dscam004#3  = 1;
   |LEE 000#dscam004.];
   |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
      |SI #dscam004#5 = "RPT"; |O #dscam004#5 = "RTA";
         |DDEFECTO #dscam067;
         #dscam067#0 = "CB";
         #dscam067#1 = #dscam004#17;
         #dscam067#2 = #dscam004#3;
         #dscam067#3 = "";
         #dscam067#11 = 1;
         |LEE 000#dscam067.];
         FEstado = FSalida;
         Clave1 = #dscam067#1; Clave2 = #dscam067#2;
         Clave3 = #dscam067#3; |QBF Clave3;
         |SI FEstado = 0; |Y Clave1 = #dscam004#17; |Y Clave2 = #dscam004#3;
          |Y Clave3  = "";
            eaDirConta = #48#16; |QBF eaDirConta;
            eaEmpContab = (("00000" + #dscam067#8) % -105) + #dscam067#9;
            enSwError = 0;
            |HAZ CompruebaEmpContable; |SAL;
         |FINSI;
      |FINSI;
      |LEE 000#dscam004.s;
   |SIGUE;
   |SI enSwError < 0; |Y enSwError > -3; SwError = 2; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE RevisaTalon;
#dscam003#7;
;
#dscam060#2,#dscam060#0,0000000001;
#dscam060#2,#dscam060#0,9999999999;
be;
NULL,RevisaTalon;
|FIN;

|PROCESO SelecAut;
   |SI #dscaw020#10 = "    "; |Y #dscaw020#11 = "zzzz";
      SwError = 1; nSwBlanco = 1;
      |PARA nCont = 0; |SI nCont [ 7; |HACIENDO nCont = nCont + 1;
         |SI #dscaw020#nCont# ! "    "; nSwBlanco = 0;          |FINSI;
         |SI #dscaw020#nCont# = #dscam060#2; SwError = 0; |SAL; |FINSI;
      |SIGUE;
   |SINO;
      SwError = 0;
   |FINSI;

   |SI SwError = 1; |Y nSwBlanco = 0;
      #dscam060#5 = " ";
   |SINO;
      #dscam060#5 = "*";
   |FINSI;
   |PINTA #dscam060#5;
   |GRABA 020#dscam060.a;
|FPRC;

|DEFBUCLE SelecAut;
#dscam060#2;
;
#dscaw020#8, #dscaw020#10, "          ";
#dscaw020#9, #dscaw020#11, "zzzzzzzzzz";
;
NULL,SelecAut;
|FIN;

|PROCESO Recibos;
   nImpRec = 0;
   nImpDto = 0;
   nImporteD = 0;
   nImporteB = 0;

   #dscam066#0 = #dscam003#40;
   |LEE 000#dscam066.=;
   |SI FSalida = 0;
      nImporteD = #dscam066#1 ! nDeci_Div;
      nImporteB = #dscam066#2 ! nDeci_Base;
      |BORRA 020#dscam066.a;
   |FINSI;

   efFechaDiv = #Referen@#1;
   Divisa = #dscam003#57; |HAZ TomaDecim;

   |ABRE #dscam004;
   #dscam004#17 = #dscam003#40;
   #dscam004#3  = 1;
   |LEE 000#dscam004.];
   |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
      |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
         LinCob = #dscam004#3 + 1;

         ||SI #dscam004#5 = "RPT";  Tiquet:4533/354
         || a¤ado tambien RAC para que haga el enlace de una entrega a cta

         |SI #dscam004#5 = "RPT"; |O #dscam004#5 = "RAC";
            nImpRec = #dscam004#44;
            nImpDto = #dscam004#45;
            |SI nNumSec = 0;
               |SALVA_FICHA #dscam004;
               |SELECT #3#dscam004;
               |LEE 000#dscam004.u;
               nNumSec = #dscam004#43 + 1;
               |SELECT #1#dscam004;
               |LEE 000#dscam004.p;
               |REPON_FICHA #dscam004;
            |FINSI;
         |FINSI;
         |LEE 000#dscam004.s;
      |SIGUE;
   |SINO;
      LinCob = 1;
   |FINSI;

   |DDEFECTO #dscam004;
   #dscam004#17 = #dscam003#40;
   #dscam004#3 = LinCob;
   |GRABA 020#dscam004.b;
   #dscam004#0  = #dscam003#0;
   #dscam004#1  = #dscam003#1;
   #dscam004#2  = #dscam003#2;
   |SI nSwVtoMasivo = 1;
      aAlfa = #dscam060#15; |QBF aAlfa;
      |SI aAlfa ! "";
         #dscam004#4  = aAlfa;
      |SINO;
         #dscam004#4  = #Referen@#4;
      |FINSI;
   |SINO;
      #dscam004#4  = #Referen@#4;
   |FINSI;
   #dscam004#5  = "RTA";
   |SI nSwVtoMasivo = 1;
      |SI #dscam060#17 ! "01.01.0000";
         #dscam004#6  = #dscam060#17;
      |SINO;
         #dscam004#6  = FechaOper;
      |FINSI;
   |SINO;
      #dscam004#6  = FechaOper;
   |FINSI;
   |SI #dscam003#47 ! "S";
      #dscam004#7  = #dscam003#23; #dscam004#25 = #dscam003#61;
   |FINSI;
   |SI nImporteB ! 0;
      #dscam004#8  = nImporteD;
      #dscam004#26 = nImporteD / CambioDivVn;
      #dscam004#24 = #dscam004#26 - nImporteB;
   |SINO;
      #dscam004#8  = #dscam003#31;
      #dscam004#26 = #dscam003#31 / CambioDivVn;
      #dscam004#24 = #dscam004#26 - #dscam003#65;
      |SI nImporteD = 0; |Y nImporteB = 0;
         nImporteD = #dscam003#31; nImporteB = #dscam003#65;
      |FINSI;
      |SI nImpRec = 0; |Y nImpDto = 0;
         nImpRec = #dscam003#31; nImpDto = #dscam003#65;
      |FINSI;
   |FINSI;
   #dscam004#11 = #dscam003#13;
   #dscam004#15 = #dscam003#27;
   Comodin = "Cob.Talon n§" + #Referen@#2 + "/" + #Referen@#0;
   |SI nSwVtoMasivo = 1;
      aAlfa = #dscam060#16; |QBF aAlfa;
      |SI aAlfa ! "";
         #dscam004#16 = aAlfa;
      |SINO;
         #dscam004#16 = Comodin;
      |FINSI;
   |SINO;
      #dscam004#16 = Comodin;
   |FINSI;
   #dscam004#33 = CambioDivVn;
   #dscam004#43 = nNumSec;
   #dscam004#44 = nImpRec;
   #dscam004#45 = nImpDto;
   #dscam004#51 = #dscam003#72;
   #dscam004#52 = #dscam003#70;
   #dscam004#53 = #dscam003#71;
   |GRABA 020#dscam004.a;
   |LIBERA #dscam004; |CIERRA #dscam004;

   #dscam003#56 = #dscam003#56 + #dscam004#24;
   #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
   #dscam003#65 = #dscam003#64 - #dscam003#61;

   |SI nImporteB = 0;
      #dscam003#31 = 0; #dscam003#65 = 0;
      #dscam003#23 = #dscam003#30; #dscam003#61 = #dscam003#64;
      #dscam003#14 = "L"; #dscam003#15 = "Recibo liquidado";
   |SINO;
      #dscam003#31 = #dscam003#31 - nImporteD;
      #dscam003#65 = #dscam003#65 - (nImporteD / CambioDivVn);
      #dscam003#23 = #dscam003#30 - #dscam003#31;
      #dscam003#61 = #dscam003#64 - #dscam003#65;
      |SI #dscam003#31 ! 0;
         #dscam003#14 = "C";
         #dscam003#15 = "Parcialmente cobrado";
      |SINO;
         |SI #dscam003#47 = "N"; |Y #dscam003#69 = " ";
            #dscam003#14 = "L";
            #dscam003#15 = "Recibo liquidado";
         |SINO;
            #dscam003#14 = "e";
            #dscam003#15 = "Pendiente de compensar";
         |FINSI;
      |FINSI;
   |FINSI;
   #dscam003#84 = "S";
   |SI nSwVtoMasivo = 1;
      |SI #dscam060#17 ! "01.01.0000";
         #dscam003#26  = #dscam060#17;
      |SINO;
         #dscam003#26  = FechaOper;
      |FINSI;
   |SINO;
      #dscam003#26  = FechaOper;
   |FINSI;
   |GRABA 020#dscam003.a; |LIBERA #dscam003;

   |SI #dscam003#14 ! "e";
      |SI #dscam051#3 = "S";
         eaTipoOper = "-4";           enEmpCartera = -1;
         enEmpGestion = #dscam003#46; eaSerie = #dscam003#0;
         eaCliGest = #dscam003#32;    nImporte = #dscam004#26;
         |HAZ BucleRiesgo;
      |FINSI;
   |FINSI;

   eaCliente = #dscam003#32; |HAZ MiraBloqueoRiesgo;
|FPRC;

|DEFBUCLE Recibos;
#dscam003#7;
;
#Referen@#2, #Referen@#0, 000000001;
#Referen@#2, #Referen@#0, 999999999;
be;
NULL,Recibos;
|FIN;

|PROCESO LinAsientos;
   #dscam003#40 = #dscam004#17;
   |LEE 000#dscam003.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   |SI SecAnt ! #dscam004#43;
      SecAnt = #dscam004#43;
      |SI #dscam051#1 = "S"; |Y HayConta = 1;
          Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
          |NOME_DAT #100 Comodin;
          |DELINDEX #dscaw013; |ABRE #dscaw013;
          |DDEFECTO #dscaw013;
          #dscaw013#15 = aEnlace;      #dscaw013#0 = 1;
          #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
          #dscaw013#11 = "N";          #dscaw013#12 = 9;
          #dscaw013#5 = #dscam004#43;  #dscaw013#6 = #dscam004#43;
          |GRABA 020#dscaw013.n;

          |DDEFECTO #dscaw013;
          #dscaw013#15 = aEnlace;      #dscaw013#0 = 2;
          #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
          #dscaw013#11 = "A";          #dscaw013#12 = 3;
          #dscaw013#3 = #dscam004#5;   #dscaw013#4 = #dscam004#5;
          |GRABA 020#dscaw013.n;

          nNumDoc = #dscam004#17; nNumLinea = #dscam004#3;

          |LIBERA #dscaw013; |CIERRA #dscaw013;
          Comodin = aEnlace;
          Comodin = "dscam033.tab;" + Comodin + "V";
          |LIBERA #dscam003; |CIERRAT #dscam003;
          |SALVA_FICHA #dscam004;
          |LIBERA #dscam004; |CIERRAT #dscam004;
          |SUB_EJECUTA_NP Comodin;
          |ABRET #dscam003;
          #dscam003#40 = nNumDoc; |LEE 101#dscam003.=;
          |ABRET #dscam004;
          #dscam004#17 = nNumDoc; #dscam004#3 = nNumLinea; |LEE 101#dscam004.=;
          |REPON_FICHA #dscam004;

          |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
          |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
          |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
      |FINSI;
      |CIERRA #dscam067;
   |FINSI;
|FPRC;

|DEFBUCLE LinAsientos;
#dscam004#3;
5;
nNumSec,"RTA";
nNumSec,"RTA";
be;
NULL,LinAsientos;
|FIN;


|PROCESO HazVto;
   |SI #Referen@#5 = " ";
       |ACABA;
   |FINSI;

   |ABRE #dscam003;
   |PUSHV 1901 2380;
   |SI aEnlace = "";
      |SI #dscam051#1 = "S";
         #dscaw046#1 = #dscam051#41;
         |C_M #dscaw046#1, 1, "S";
         #dscam030#0 = #dscaw046#1;
         |LEE 000#dscam030.=;
         |SI FSalida = 0;
            #dscaw046#2 = #dscam030#1;
         |FINSI;
         aAlfa = #dscam051#61; |C_M #dscaw046#1, 1, aAlfa;
      |SINO;
         #dscaw046#1 = "    ";
         |C_M #dscaw046#1, 1, "N";
      |FINSI;

      |SI #dscam051#37 = "N";
         #dscaw046#0 = #Referen@#1;
      |FINSI;

      |PINPA #0#dscaw046; |PINDA #0#dscaw046;
      |ENDATOS #1#dscaw046;
   |SINO;
      #dscaw046#0 = FechaOper; #dscaw046#1 = aEnlace;
      FSalida = 0;
   |FINSI;

   |SI FSalida = 0;
      |POPV;
      FechaOper = #dscaw046#0;
      aEnlace   = #dscaw046#1;
      || ABDON N.Tiquet 010028/00685
      ||    Lo que se pretende en este tiquet es que en una sesion en la que
      || se hace el vencimiento de varios pagares se contabilice en el mismo
      || asiento.
      ||    Si no quito este punto, no se graba el mismo numero de sesion
      || en todos los documentos marcados en esta sesion, por lo que hace un
      || enlace por cada documento.
      || nNumSec   = 0;
      |BUCLE Recibos;
      nSesion = nNumSec; InSesion = InSesion + 1;

      |BORRA 020#Referen@.a;

      |SALVA_FICHA #dscam060;
      |SELECT #1#dscam060;
      #dscam060#0 = #Referen@#0;
      #dscam060#2 = #Referen@#2;
      |LEE 101#dscam060.=;
      |SI FSalida = 0; |BORRA 020#dscam060.a; |LIBERA #dscam060; |FINSI;
      |SI nClave = 1; |SELECT #1#dscam060; |FINSI;
      |SI nClave = 2; |SELECT #2#dscam060; |FINSI;
      |SI nClave = 3; |SELECT #3#dscam060; |FINSI;
      |REPON_FICHA #dscam060;

      ||nSwitch = 1; || Inicia la secuencia ...
   |SINO;
      |POPV;
   |FINSI;
   |CIERRA #dscam003;
|FPRC;

|DEFBUCLE HazVto;
#Referen@#1002;
;
"    ","          ";
"zzzz","zzzzzzzzzz";
;
NULL,HazVto;
|FIN;

|PROCESO VtoMasivo;
   |SI #Referen@#5 = " "; |ACABA; |FINSI;

   |SI nSw = 1;
      |ABRE #dscam003;
      |SI #dscam051#37 = "N";
         fFechaC = #Referen@#1;
      |SINO;
         fFechaC = ~;
      |FINSI;
      FechaOper = fFechaC;

      |SI #dscam051#1 = "S";
         aEnlace   = #dscam051#41;
      |SINO;
         aEnlace   = "";
      |FINSI;

      nNumSec   = 0;
      |BUCLE Recibos;
      nSesion = nNumSec; InSesion = InSesion + 1;

      #Referen@#14 = nNumSec;
      |GRABA 020#Referen@.a;
   |FINSI;

   |SI nSw = 2;
      |BORRA 020#Referen@.a;

      |SALVA_FICHA #dscam060;
      |SELECT #1#dscam060;
      #dscam060#0 = #Referen@#0;
      #dscam060#2 = #Referen@#2;
      |LEE 101#dscam060.=;
      |SI FSalida = 0; |BORRA 020#dscam060.a; |LIBERA #dscam060; |FINSI;
      |SI nClave = 1; |SELECT #1#dscam060; |FINSI;
      |SI nClave = 2; |SELECT #2#dscam060; |FINSI;
      |SI nClave = 3; |SELECT #3#dscam060; |FINSI;
      |REPON_FICHA #dscam060;

      |CIERRA #dscam003;
   |FINSI;
|FPRC;

|DEFBUCLE VtoMasivo;
#Referen@#1002;
;
"    ","          ";
"zzzz","zzzzzzzzzz";
;
NULL,VtoMasivo;
|FIN;

|PROCESO EnlaceMasivo;
   |SI #Referen@#5 = " "; |ACABA; |FINSI;

   |ABRE #dscam030;
   #dscam030#0 = aEnlace;
   |LEE 101#dscam030.=;
   |SI FSalida = 0;
      aSesionAnt = #dscam030#8;
      |SI aSesionAnt ! "S";
         #dscam030#8 = "S";
         |GRABA 020#dscam030.a; |LIBERA #dscam030;
      |FINSI;
   |FINSI;
   |CIERRA #dscam030;

   nNumSec = #Referen@#14; |BUCLE LinAsientos;

   |SI aSesionAnt ! "S";
      |ABRE #dscam030;
      #dscam030#0 = aEnlace;
      |LEE 101#dscam030.=;
      |SI FSalida = 0;
         #dscam030#8 = aSesionAnt;
         |GRABA 020#dscam030.a; |LIBERA #dscam030;
      |FINSI;
      |CIERRA #dscam030;
   |FINSI;
|FPRC;

|DEFBUCLE EnlaceMasivo;
#Referen@#1002;
;
"    ","          ";
"zzzz","zzzzzzzzzz";
;
NULL,EnlaceMasivo;
|FIN;

|PROCESO F11Cuenta; |TIPO 66;
   |SI nSwConta = 1;
      |HAZ AntesTrasCuenta;

      #cacuent@#0 = #dscaw998#0
      #cacuent@#1 = 1;
      |LEE 000#cacuent@.];
      |CONSULTA_CLAVE #1#cacuent@;
      |SI FSalida = 0;
         #dscaw998#0 = #cacuent@#0; |PINTA #dscaw998#0;
         #dscaw998#1 = #cacuent@#2; |PINTA #dscaw998#1;
      |FINSI;
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO AntesTrasCuenta; |TIPO 6;
   |SI nSwConta = 1;
      aAlfa = #dscaw998#0; |QBF aAlfa;
      aAlfa = aAlfa - ".";
      |PARA; |SI FSalida ! 0; |HACIENDO;
         nCalc = ((FSalida / 100) ! 0) + 99; aParte1 = aAlfa % nCalc; |QBF aParte1;
         nCalc = FSalida + 98;               aParte2 = aAlfa % nCalc; |QBF aParte2;
         aAlfa = aParte1 + aParte2; |QBF aAlfa;
         aLong = aAlfa % 0; nLong = aLong;
         nCalc = MaxDigit - nLong;
         aAlfa = aParte1 + ("0" * nCalc) + aParte2;
         aAlfa = aAlfa - ".";
      |SIGUE;
      #dscaw998#0 = aAlfa; |PINTA #dscaw998#0;
   |FINSI;
|FPRC;

|PROCESO TrasCuenta;
   |SI nSwConta = 1;
      |SI nLong = Niv1; #cacuent@#1 = 1; |FINSI;
      |SI nLong = Niv2; #cacuent@#1 = 2; |FINSI;
      |SI nLong = Niv3; #cacuent@#1 = 3; |FINSI;
      |SI nLong = Niv4; #cacuent@#1 = 4; |FINSI;
      |SI nLong = Niv5; #cacuent@#1 = 5; |FINSI;
      |SI nLong = Niv6; #cacuent@#1 = 6; |FINSI;
      |SI #cacuent@#1 = 0;
         |MENAV "    Cuenta fuera de nivel";
         |ERROR; |ACABA;
      |FINSI;

      #cacuent@#0 = #dscaw998#0
      |LEE 000#cacuent@.=;
      |SI FSalida = 0;
         #dscaw998#0 = #cacuent@#0; |PINTA #dscaw998#0;
         #dscaw998#1 = #cacuent@#2; |PINTA #dscaw998#1;
      |SINO;
         |MENAV "    Cuenta inexistente"; |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Marcadas;
   |SI #dscam060#5 = "*";
      #dscam060#15 = #dscaw998#0;
      #dscam060#16 = #dscaw998#2;
      #dscam060#17 = #dscaw998#3;
      |GRABA 020#dscam060.a;
   |FINSI;
|FPRC;

|DEFBUCLE Marcadas;
#dscam060#1;
;
"    ", "          ";
"zzzz", "zzzzzzzzzz";
be;
NULL, Marcadas;
|FIN;

|PROCESO MiraDesglose; |TIPO 11;
   |SI FSalida = 9;
      |SI #dscam060#5 = " ";
         #dscam060#5 = "*";
      |SINO;
         #dscam060#5 = " ";
      |FINSI;
      |GRABA 020#dscam060.a; |PINTA #dscam060#5;
      nSwTecla = 9;
      |PONCONTROL 23,"si";
   |FINSI;
   |SI FSalida = 10;
      |PUSHV 0501 2380;
      |DELINDEX #dscaw019;
      |ABRE #dscaw019;
      Linea = 1;
      |BUCLE RecogeDesglose;
      |CIERRA #dscaw019;
      |BLANCO 820 2161;
      |ENTLINEAL #1#dscaw019,-1,4,17,1,infdesg,supdesg;
      |POPV; |ERROR;
   |FINSI;
   |SI FSalida = 11;
      SwError = 0;
      |SI #dscam060#13 = "N";
         |ABRE #dscam004; |ABRE #dscam067;
         |BUCLE RevisaTalon;
         |CIERRA #dscam004; |CIERRA #dscam067;
         |SI SwError = 0;
            |CONFI "    NSeguro de borrar este talon/pagare ?";
            |SI FSalida = 0;
               |BUCLE BorraTalon;
               eaUsuario = Usuario % 0810;
               eaDescr   = "BAJA PAGARE/TALON ("+ (("0000" + #dscam060#2) % -104) + "/" + (("0000000000" + #dscam060#0) % -110) + ") DESDE MANTENIMIENTO DE PAGARES/TALONES";
               eaTipoReg = "PT";  eaNumero = (("0000" + #dscam060#2) % -104) + "/" + (("00000000000" + #dscam060#0) % -110);
               eaTipoOp  = "B";   enImpAct = 0; enImpAnt = #dscam060#8;
               |HAZ GrabaAudit;
               |BORRA 020#dscam060.a; |LEE 000#dscam060.];
               |PTEC 809; |PTEC 808;
            |FINSI;
            |ERROR;
            |PONCONTROL 23,"si";
         |SINO;
            |SI SwError ! 2;
               |SELECT #7#dscam003;
               #dscam003#70 = #dscam060#0;
               #dscam003#72 = #dscam060#2;
               |LEE 101#dscam003.=;
               |SI FSalida = 0;
                  |SI #dscam003#23 = 0; |Y #dscam003#31 = #dscam003#30;
                     #dscam004#17 = #dscam003#40;
                     #dscam004#3 = 1;
                     |LEE 101#dscam004.=;
                     |SI FSalida = 0;
                        |BORRA 020#dscam004.a; |LIBERA #dscam004;
                     |SINO;
                        |MENAV "    No se ha encontrado la recepcion de la entrega de este talon"; |ERROR;
                     |FINSI;
                     |BORRA 020#dscam003.a; |LIBERA #dscam003;
                     |BORRA 020#dscam060.a;
                  |SINO;
                     |MENAV "    Esta entrega tiene movimientos. No se eliminara"; |ERROR;
                  |FINSI;
               |SINO;
                  |MENAV "    No se ha encontrado la entrega de este talon"; |ERROR;
               |FINSI;
               |SELECT #1#dscam003;
               |PONCONTROL 23,"si";
            |SINO;
               |MENAV "    Empresa contable cerrada. Proceso cancelado."; |ERROR;
            |FINSI;
         |FINSI;
      |SINO;
         |MENAV "    El pagare no esta pendiente. No se borrara.";
         |ERROR;
      |FINSI;
   |FINSI;
   |SI FSalida = 12;
      |PUSHV 0829 1753;
      |PINPA #0#3; |PINDA #0#3;
      |ENDATOS #1#3;
      |SI FSalida = 0;
         |POPV;
         nSwTecla = 7;
         nSwSalir = 0; |PTEC 807;
      |SINO;
         |POPV; |ERROR;
         |PONCONTROL 23,"si";
      |FINSI;
   |FINSI;
   |SI FSalida = 13;

      |PARA nCont1 = 0; |SI nCont1 < 100; |HACIENDO nCont1 = nCont1 + 1;
         InSesion = nSesion1<-;
         InSesion = InSesion + nCont1;
         nSesion = 0;
      |SIGUE;
      InSesion = nSesion1<-; nNumSec = 0;

     |BUCLE HazVto;

/* para probar lo de sergio en lugar del bucle

     |LEE 000#Referen@.p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          |HAZ HazVto;
          |LEE 000#Referen@.s;
     |SIGUE;
*/


      |ABRE #dscam003;
      || ABDON N.Tiquet 010028/00685
      ||    Lo que se pretende en este tiquet es que en una sesion en la que
      || se hace el vencimiento de varios pagares se contabilice en el mismo
      || asiento.
      ||    Si no quito este bloque, no se graba el mismo numero de sesion
      || en todos los documentos marcados en esta sesion, por lo que hace un
      || enlace por cada documento.
/*
      |PARA nCont1 = 0; |SI nCont1 < 100; |HACIENDO nCont1 = nCont1 + 1;
         InSesion = nSesion1<-; InSesion = InSesion + nCont1;
         nNumSec = nSesion;
         |SI nNumSec = 0; |SAL; |FINSI;
         |BUCLE LinAsientos;
      |SIGUE;
*/

      |SUB_EJECUTA_NP "dscaz169.tab;INICIO";
      |BUCLE LinAsientos; || Se quita el bloque anterior y se pone esto
      |SUB_EJECUTA_NP "dscaz169.tab;FINAL";

      FechaOper = "01.01.0000"; aEnlace = "";
      |CIERRA #dscam003;
      |PTEC 809; ||PTEC 808;
      |ERROR;
      |PONCONTROL 23,"SI";
   |FINSI;
   |SI FSalida = 14;
      |PUSHV 1931 2161;
      |BLANCO 1931 2261;
      |CUADRO 1931 2261;
      |ATRI R; |PINTA 1932 , " Buscar pagare/talon "; |ATRI N;
      |PINTA 2032, " Entidad       N§ ";
      |PINTA 2132, " Fecha Vto. ";
      |PINTA 2041, #dscam060#2; aEntidad = #dscam060#2;
      |PINTA 2050, #dscam060#0; aNumero  = #dscam060#0;
      fFecha = #dscam060#1; #dscam060#1 = "01.01.0000";
      |PINTA 2146, #dscam060#1; #dscam060#1 = fFecha;
      |ERROR;
      E_sup  = 4;
      E_inf  = "";
      aEntidad = 2041 ? 0;
      |SI FSalida = 0;
         E_sup  = 10;
         E_inf  = "";
         aNumero = 2050 ? 0;
         |SI FSalida = 0;
            nSwSalir = 0;
            |QBF aEntidad; |QBF aNumero;
            |SI aEntidad ! ""; |O aNumero ! "";
               |SELECT #1#dscam060;
               #dscam060#2 = aEntidad;
               #dscam060#0 = aNumero;
               |LEE 000#dscam060.];
               |SI nClave = 1; |SELECT #1#dscam060; |FINSI;
               |SI nClave = 2; |SELECT #2#dscam060; |FINSI;
               |SI nClave = 3; |SELECT #3#dscam060; |FINSI;
               fFecha = #dscam060#1;
               aCliente = #dscam060#6;
               |PTEC 807;
            |SINO;
               |SELECT #2#dscam060;
               E_sup  = 10;
               E_inf  = "";
               fFecha = 2146 ? 2;
               |SI FSalida = 0;
                  #dscam060#1 = fFecha;
                  |LEE 000#dscam060.];
                  aEntidad = #dscam060#2;
                  aNumero  = #dscam060#0;
                  aCliente = #dscam060#6;
               |FINSI;
               |SI nClave = 1; |SELECT #1#dscam060; |FINSI;
               |SI nClave = 2; |SELECT #2#dscam060; |FINSI;
               |SI nClave = 3; |SELECT #3#dscam060; |FINSI;
               |PTEC 807;
            |FINSI;
         |FINSI;
      |FINSI;
      |POPV;
      ||PONCONTROL 23,"si";
   |FINSI;
   |SI FSalida = 15;
      nSwSalir = 0;
      nClave = nClave + 1;
      |SI nClave > 3; nClave = 1; |FINSI;
      |SI nClave = 3; nSwTecla = 1; |FINSI;
      |PTEC 807;
   |FINSI;
   |SI FSalida = 18;
      aAlfa = #48#16; |QBF aAlfa;
      aAlfa1 = aAlfa + "def/cacuenta.mas"; |CARGA_DEF aAlfa1, cacuent@;
      |SI FSalida = 0;
         nSwConta = 1;
         aAlfa = aAlfa + "fich/" + (("00000" + #48#14) % -105) + #48#19 + "/";
         |PATH_DAT #cacuent@#aAlfa#; |ABRE #cacuent@;

         |DDEFECTO #dscaw998;
         #cacuent@#0 = #dscam060#15; |LEE 000#cacuent@.=;
         |SI FSalida ! 0; |DDEFECTO #cacuent@; |FINSI;
         #dscaw998#0 = #dscam060#15;
         #dscaw998#1 = #cacuent@#2;
         #dscaw998#2 = #dscam060#16;
         #dscaw998#3 = #dscam060#17;
      |FINSI;

      nSw = 0;
      |PUSHV 0501 2380;
      |PINPA #0#dscaw998; |PINDA #0#dscaw998;
      |ENDATOS #1#dscaw998;
      |SI FSalida = 0;
         aEntClv = #dscam060#2;
         aNumClv  = #dscam060#0;
         |BUCLE Marcadas;
         #dscam060#0 = aNumClv;
         #dscam060#2 = aEntClv;
         |LEE 000#dscam060.=;

             || Lanzamos el proceso del vencimiento masivo ...
         nSw = 1;
      |FINSI;
      |POPV;

      |CIERRA #cacuent@; |DESCARGA_DEF #cacuent@;

      |SI nSw = 1; FSalida = 16; |FINSI;
   |FINSI;

   |SI FSalida = 16;
      aAlfa = "    S" + &191 + " Dar el vencimiento a los pagar‚s seleccionados ?";
      |CONFI aAlfa;
      |SI FSalida = 0;
         nSwVtoMasivo = 1;
         nSw = 1; |BUCLE VtoMasivo;

         |SUB_EJECUTA_NP "dscaz169.tab;INICIO";
         |BUCLE EnlaceMasivo;
         |SUB_EJECUTA_NP "dscaz169.tab;FINAL";

         nSw = 2; |BUCLE VtoMasivo;

         FechaOper = "01.01.0000"; aEnlace = "";
         |CIERRA #dscam003;
         |PTEC 809; ||PTEC 808;
         nSwVtoMasivo = 0;
         |ERROR;
         |PONCONTROL 23,"SI";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO RecibosCta;
   #dscam003#74 = #dscam060#4;
   |GRABA 020#dscam003.a;
|FPRC;

|DEFBUCLE RecibosCuenta;
#dscam003#7;
;
"    ",#dscam060#0,000000001;
"zzzz",#dscam060#0,999999999;
be;
NULL,RecibosCta;
|FIN;

|PROCESO CambioCuenta;
   |SI nSwTecla ! 0; nSwTecla = 0; |ACABA; |FINSI;

   |SI #dscam060#0 ! Contenido; |Y Campo = 0;
      #dscam060#0 = Contenido; |PINTA #dscam060#0;
   |FINSI;

   |ENCAMPO #4#dscam060;
   |SI FSalida = 0;
      |GRABA 020#dscam060.a;
      |BUCLE RecibosCuenta;
   |FINSI;
   |ERROR;
|FPRC;

|PROCESO Cuenta; |TIPO 6;
   Comodin = #dscam060#4;
   Comodin = Comodin - ".";
   |SI FSalida ! 0;
      Parte = FSalida;
      Parte1 = 100 + (((Parte / 100) ! 0) - 1);
      Parte2 = ((((Parte / 100) ! 0) + 1) * 100) + 99;
      Part1 = #dscam060#4 % Parte1;
      Part2 = #dscam060#4 % Parte2;
      |QBF Part2;
      Comodin = Part1 + Part2;
      LongAlfa = Comodin % 0;
      Long = MaxDigit - LongAlfa;
      LongAlfa = "0" * Long;
      Comodin = Part1 + LongAlfa + Part2;
      #dscam060#4 = Comodin;
      |PINTA #dscam060#4;
   |FINSI;
|FPRC;

|RUTINA infm060;
   |SI FSalida = "POSICION";
      #dscam060#0 = aNumero;
      #dscam060#2 = aEntidad;
      #dscam060#1 = fFecha;
      #dscam060#6 = aCliente;
      aNumero = "";  aEntidad = "";
      aCliente = ""; fFecha = "01.01.1900";
   |SINO;
      #dscam060#0 = "          ";
      #dscam060#2 = "    ";
      #dscam060#1 = "01.01.1900";
      #dscam060#6 = "      ";
   |FINSI;
|FRUT;

|RUTINA supm060;
   #dscam060#0 = "zzzzzzzzzz";
   #dscam060#2 = "zzzz";
   #dscam060#1 = "31.12.2999";
   #dscam060#6 = "zzzzzz";
|FRUT;

|PROCESO RellenaTempo;
   |SI #dscam003#14 ! "T"; |Y #dscam003#14 ! "p";
        |ACABA;
   |FINSI;
   |SI #dscam003#70 = "          "; |O #dscam003#72 = "    ";
        |ACABA;
   |FINSI;

   aAlfa = " Rellenando temporales (" + #dscam003#72 + " / " + #dscam003#70 + ")";
   |ATRI I; |PINTA 2310, aAlfa; |ATRI N;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   #dscam060#0 = #dscam003#70;
   #dscam060#2 = #dscam003#72;
   |LEE 000#dscam060.=;
   |SI FSalida ! 0;
      |DDEFECTO #dscam060;
      #dscam060#0  = #dscam003#70;
      #dscam060#1  = #dscam003#71;
      #dscam060#2  = #dscam003#72;
      #dscam060#3  = #dscam003#73;
      #dscam060#4  = #dscam003#74;
      #dscam060#6  = #dscam003#32;
      #dscam060#7  = #dscam003#6;
      #dscam060#8  = #dscam003#78;
      #dscam060#9  = #dscam003#79;
      #dscam060#10 = #dscam003#57;
      #dscam060#11 = #dscam003#58;
      #dscam060#13 = #dscam003#47;
      |GRABA 020#dscam060.n;
   |FINSI;
   SwHay = 1;
|FPRC;

|DEFBUCLE RellenaTempo;
#dscam003#10;
;
" ", 000000001, 00000, "  ", "01.01.1900";
"z", 999999999, 99999, "zz", "31.12.9999";
;
NULL,RellenaTempo;
|FIN;

|PROCESO MiraDecim; |TIPO 13;
   |SI nSwitch = 2;
      #dscam060#2 = aSwEntidad;
      #dscam060#1 = aSwFecha;
      #dscam060#0 = aSwDocumen;
      #dscam060#6 = aSwCliente;
      |LEE 000#dscam060.=;
      |PTEC 809; |PTEC 808;
      |PTEC 814; |PTEC 815;
      aSwEntidad = "";
      aSwDocumen = "";
      aSwFecha   = "";
      aSwCliente = "";
      nSwitch = 0;
   |FINSI;
   |SI nSwitch = 1;
      aSwEntidad = #dscam060#2;
      aSwDocumen = #dscam060#0;
      aSwFecha   = #dscam060#1;
      aSwCliente = #dscam060#6;
      nSwitch = 2;
   |FINSI;

   |SI nClave = 1;
      aAlfa = " Ordenado por Entidad + Documento              ";
      |C_M #dscam060#0, 1, "S"; |C_M #dscam060#1, 1, "N";
   |FINSI;
   |SI nClave = 2;
      aAlfa = " Ordenado por Fecha Vto. + Entidad + Documento ";
      |C_M #dscam060#0, 1, "S"; |C_M #dscam060#1, 1, "N";
   |FINSI;
   |SI nClave = 3;
      aAlfa = " Ordenado por Cliente + Fecha Vto.             ";
      |C_M #dscam060#0, 1, "N"; |C_M #dscam060#1, 1, "S";
   |FINSI;
   |ATRI R; |PINTA 0802, aAlfa; |ATRI N;

   Divisa = #dscam060#10; |HAZ TomaDecim;

   |SI nSwitch = 3;
      nSwitch = 0;
      |PONCONTROL 23, "SI";
   |FINSI;
|FPRC;

|PROCESO Imprime;
   |PRINT;
|FPRC;

|DEFBUCLE Imprime1;
#dscam060#5;
;
INICIO;
FINAL;
;
NULL,Imprime;
|FIN;

|DEFBUCLE Imprime2;
#dscam060#3;
;
INICIO;
FINAL;
;
NULL,Imprime;
|FIN;

|DEFBUCLE Imprime3;
#dscam060#4;
;
INICIO;
FINAL;
;
NULL,Imprime;
|FIN;

|PROCESO Deselec;
   #dscam060#5 = " ";
   |GRABA 020#dscam060.a;
|FPRC;

|DEFBUCLE Deselec;
#dscam060#1;
;
INICIO;
FINAL;
be;
NULL,Deselec;
|FIN;

|PROGRAMA;
   |CLS;
   |HAZ Tipo8; |HAZ TomaDecim;

   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.c;
   |FINSI;
   |CIERRA #dscam051;
   |ABRE #dscam030;

   nSwTagl  = 0;
   |HAZ EsTagloma;
   |SI FSalida = 0; nSwTagl = 1; |SINO; nSwTagl = 0; |FINSI;

   |SI PARAMETRO = "";
      |CABEZA "Pagares/Talones de clientes";
   |SINO;
      |CLS;
      |CABEZA "Listado Pagares/Talones de clientes pendientes";
      |ATRI R; |PINTA 0610, " EMISION DE PAGARES/TALONES DE CLIENTES PENDIENTES "; |ATRI N;
|ET OtraVez;
      |BLANCO 1020 1560; |CUADRO 1020 1560;
      |PINTA 1121, " Ordenado por  : (1) Banco + Vto   ";
      |PINTA 1221, "                 (2) Cliente + Vto ";
      |PINTA 1321, "                 (3) Vto + Cliente ";
      |PINTA 1421, " Introduzca el orden :             ";
      nOrden = 1444 ? 0;
      |SI FSalida = 0;
         |SI nOrden < 1; |O nOrden > 3; |VETE OtraVez; |FINSI;
      |SINO;
         |ACABA;
      |FINSI;
   |FINSI;

   SwHay = 0;
   Comodin = "pt" + Usuario; |NOME_DAT #0 Comodin;
   |DELINDEX #dscam060; |ABRE #dscam060; |ABRE #dscam066;
   |BUCLE RellenaTempo;
   |DDEF aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscam060.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      Comodin = "pt" + Usuario; |NOME_DAT #1000 Comodin;
      |ABRE #Referen@;
   |SINO;
      |CIERRA #dscam066; |CIERRA #dscam060; |CIERRA #dscam030;
      |HAZ Tipo9; |ACABA;
   |FINSI;

   |SI PARAMETRO = "";
      |SI SwHay = 1;
         |PINPA #0#0; |PINDA #0#0;
         nClave = 1; nSwSalir = 0;
         |PARA; |SI nSwSalir = 0; |HACIENDO;
            nSwSalir = 1;
            aSql = "SELECT * FROM dscam060 INTO tm" + Usuario + " WHERE ";
            aAlfa =         #dscaw020#0 + #dscaw020#1 + #dscaw020#2 + #dscaw020#3;
            aAlfa = aAlfa + #dscaw020#4 + #dscaw020#5 + #dscaw020#6 + #dscaw020#7;
            |QBF aAlfa;
            |SI aAlfa ! "";
               aAlfa = "";
               |SI #dscaw020#0 ! "    ";
                  aSql = aSql + "2 == '" + #dscaw020#0 + "'";
                  aAlfa = " OR ";
               |FINSI;
               |SI #dscaw020#1 ! "    ";
                  aSql = aSql + aAlfa + "2 == '" + #dscaw020#1 + "'";
                  aAlfa = " OR ";
               |FINSI;
               |SI #dscaw020#2 ! "    ";
                  aSql = aSql + aAlfa + "2 == '" + #dscaw020#2 + "'";
                  aAlfa = " OR ";
               |FINSI;
               |SI #dscaw020#3 ! "    ";
                  aSql = aSql + aAlfa + "2 == '" + #dscaw020#3 + "'";
                  aAlfa = " OR ";
               |FINSI;
               |SI #dscaw020#4 ! "    ";
                  aSql = aSql + aAlfa + "2 == '" + #dscaw020#4 + "'";
                  aAlfa = " OR ";
               |FINSI;
               |SI #dscaw020#5 ! "    ";
                  aSql = aSql + aAlfa + "2 == '" + #dscaw020#5 + "'";
                  aAlfa = " OR ";
               |FINSI;
               |SI #dscaw020#6 ! "    ";
                  aSql = aSql + aAlfa + "2 == '" + #dscaw020#6 + "'";
                  aAlfa = " OR ";
               |FINSI;
               |SI #dscaw020#7 ! "    ";
                  aSql = aSql + aAlfa + "2 == '" + #dscaw020#7 + "'";
               |FINSI;
            |SINO;
               aSql = aSql + "2 BETWEEN '" + #dscaw020#10 + "','" + #dscaw020#11 + "'";
            |FINSI;
            aSql = aSql + "AND 1 BETWEEN '" + #dscaw020#8 + "','" + #dscaw020#9 + "'";

            |SQL aSql;
            |SI FSalida = 0;
               |CIERRA #dscam060; |CIERRA #Referen@;
               aAlfa = "tm" + Usuario;
               |NOME_DAT #dscam060#aAlfa#; |NOME_DAT #Referen@#aAlfa#;
               |ABRE #dscam060; |ABRE #Referen@;
            |FINSI;

            |SI nClave = 1; |Y nSwSalir = 1; nAntClave = nClave; |ENTLINEAL #1#dscam060,-2,4,19,1,infm060,supm060; |FINSI;
            |SI nClave = 2; |Y nSwSalir = 1; nAntClave = nClave; |ENTLINEAL #2#dscam060,-3,4,19,1,infm060,supm060; |FINSI;
            |SI nClave = 3; |Y nSwSalir = 1; nAntClave = nClave; |ENTLINEAL #3#dscam060,-2,4,19,1,infm060,supm060; |FINSI;

            |CIERRA #dscam060; |DELINDEX #dscam060;
            aAlfa = "pt" + Usuario; |NOME_DAT #dscam060#aAlfa#;
            |ABRE #dscam060;

            |CIERRA #Referen@; |NOME_DAT #Referen@#aAlfa#;
            |ABRE #Referen@;

         |SIGUE;
      |SINO;
         |MENAV "    No hay registros";
      |FINSI;
   |SINO;
      |SI SwHay = 1;
         |IMPRE 0;
         |SI FSalida ! 0; |ACABA; |FINSI;
         |INFOR "dscam060";
         |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;
         |SI nOrden = 1; |BUCLE Imprime1; |FINSI;
         |SI nOrden = 2; |BUCLE Imprime2; |FINSI;
         |SI nOrden = 3; |BUCLE Imprime3; |FINSI;
         |PIEINF; |FININF;
         |FINIMP;
      |SINO;
         |MENAV "    No hay registros";
      |FINSI;
   |FINSI;

   |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |CIERRA #dscam066; |CIERRA #dscam060; |CIERRA #dscam030;
   |HAZ Tipo9;
|FPRO;
