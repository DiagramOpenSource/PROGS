|FICHEROS;
   dscaz066 #0;

   dscaw049 #10,MANTE;
   dscam013 #11;
   dscam003 #12;
   dscam004 #13;
   dscam030 #14;
   dscam051 #15;
   dscam012 #16;
   dscam002 #17;

   Referen@ #900;
   dscaw013 #910;
|FIN;

|VARIABLES;
   &enEmpCartera = 0; &enEmpGestion = 0; &enDocum = 0;
   &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = "";
   &nDeci_Base = 0;
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = ""; &eaLlamada = "";
   &eaTipoRecibo = ""; &enNumDocum = 0; &eaMensRet = ""; &enSwError = 0; &eaTOperacion = "";
   &HayConta = 0;  &aInforme = "";
   &eaMes = "";    &eaSesion = "";

   ModoEntrada = 0;
   nFlag = 0;
   SwImp = 0;
   nDocum = 0;
   nCartas = 0;

   SwBuscaFac  = 0;
   SwError     = 0;
   nNumSec     = 0;
   nTotal      = 0;
   nNumMarcas  = 0;
   Linea       = 0;
   LinCob      = 0;
   UltFecha    = 0;
   UltNumero   = 0;

   aAlfa       = "";
   aAlfa1      = "";

   fFechaHoy = @;
|FIN;

|RUTINA inf66;
   #dscaw049#1 = 001;
|FRUT;

|RUTINA sup66;
   #dscaw049#1 = 999;
|FRUT;

|PROCESO Volcado;
   |SI #dscaw049#9 = "S";
      |SI nNumSec = 0;
         |SALVA_FICHA #dscam004;
         |SELECT #3#dscam004;
         |LEE 000#dscam004.u;
         |SI nNumSec [ #dscam004#43;
            nNumSec = #dscam004#43 + 1;
         |SINO;
            nNumSec = nNumSec + 1;
         |FINSI;
         |SELECT #1#dscam004;
         |LEE 000#dscam004.p; |REPON_FICHA #dscam004;
      |SINO;
         nNumSec = nNumSec + 1;
      |FINSI;

      |ABRE #dscam030;
      #dscam030#0 = #dscaz066#1;
      |LEE 000#dscam030.=;
      |SI FSalida = 0;
         |SI #dscam030#8 = "N"; nNumSec = 0; |FINSI;
      |SINO;
         nNumSec = 0;
      |FINSI;
      |CIERRA #dscam030;

      #dscam003#40 = #dscaw049#8;
      |LEE 000#dscam003.=;

      |SI #dscam051#3 = "S";
         || enEmpCartera = #48#0;  enEmpGestion = #dscam003#46;
         enEmpCartera = -1;     enEmpGestion = #dscam003#46;
         eaSerie = #dscaw049#4; eaCliGest = #dscam003#32;
         |SI #dscam003#84 = "N";
            nImporte = #dscaw049#7; eaTipoOper ="-6+4"; |HAZ BucleRiesgo;
         |FINSI;
      |FINSI;

      |SI #dscam003#47 = "S"; |ACABA; |FINSI;

      #dscam004#17 = #dscaw049#8;
      #dscam004#3 = 99;
      |LEE 010#dscam004.];
      |SI FSalida ! 0;
         |LEE 010#dscam004.u;
         |SI FSalida = 0; |Y #dscam004#17 = #dscaw049#8;
            LinCob = #dscam004#3 + 1;
            UltFecha = #dscam004#6; UltNumero = #dscam004#3;
         |SINO;
            LinCob = 1;
         |FINSI;
      |SINO;
         |SI #dscam004#0 = #dscaw049#3; |Y #dscam004#17 = #dscaw049#8;
            LinCob = #dscam004#3 + 1;
            UltFecha = #dscam004#6; UltNumero = #dscam004#3;
         |SINO;
            |LEE 010#dscam004.a;
            |SI FSalida = 0; |Y #dscam004#17 = #dscaw049#8;
               LinCob = #dscam004#3 + 1;
               UltFecha = #dscam004#6; UltNumero = #dscam004#3;
            |SINO;
               LinCob = 1;
            |FINSI;
         |FINSI;
      |FINSI;

      |DDEFECTO #dscam004;
      #dscam004#0  = #dscaw049#4;
      #dscam004#1  = #dscaw049#3;
      #dscam004#2  = #dscaw049#5;
      #dscam004#3  = LinCob;
      #dscam004#5  = "RCE";
      #dscam004#6  = #dscaz066#0;
      #dscam003#40 = #dscaw049#8;
      |LEE 010#dscam003.=;
      |SI FSalida = 0;
         #dscam004#7  = #dscam003#23; #dscam004#25 = #dscam003#61;
      |FINSI;
      #dscam004#8  = 0;           #dscam004#26 = 0;
      #dscam004#9  = #dscaw049#7; #dscam004#27 = #dscaw049#7;
      #dscam004#10 = 0;           #dscam004#29 = 0;
      #dscam004#12 = 0;           #dscam004#30 = 0;
      #dscam004#17 = #dscaw049#8; #dscam004#33 = 1;
      #dscam004#43 = nNumSec;
      |GRABA 020#dscam004.n;
      eaUsuario = Usuario % 0810;
      eaTipoReg = "CB";  eaNumero = (("000000000" + #dscam004#17) % -109) + "/" + (("000" + #dscam004#3) % -103);
      eaDescr   = "ALTA RECLAMACION RECIBO (" + (("000000000" + #dscam004#17) % -109) + "/" + (("000" + #dscam004#3) % -103);
      eaDescr   = eaDescr + ") DESDE RECLAMACION DE EFECTOS";
      eaTipoOp  = "A";
      enImpAnt = #dscam003#64; enImpAct = #dscam003#64 - #dscam004#9;
      |HAZ GrabaAudit;

      #dscam013#0 = #dscam003#17;
      #dscam013#1 = #dscam003#37;
      |LEE 101#dscam013.=;
      |SI FSalida = 0;
         #dscam013#15 = "R"; |GRABA 020#dscam013.a; |LIBERA #dscam013;
      |FINSI;

      #dscam003#40 = #dscaw049#8;
      |LEE 010#dscam003.=;
      |SI FSalida = 0; |Y #dscam003#47 = "N";
         #dscam003#26 = "";
         #dscam003#23 = #dscam003#23 - #dscaw049#7;  #dscam003#61 = #dscam003#61 - #dscaw049#7;
         ||#dscam003#24 = #dscam003#24 + #dscaz066#2; #dscam003#62 = #dscam003#62 + #dscaz066#2;

         #dscam003#30 = #dscam003#22 + #dscam003#24 + #dscam003#25 + #dscam003#38;
         #dscam003#30 = #dscam003#30 - (#dscam003#54 + #dscam003#55);
         #dscam003#64 = #dscam003#60 + #dscam003#62 + #dscam003#63 + #dscam003#66 + #dscam003#56;
         #dscam003#64 = #dscam003#64 - (#dscam003#67 + #dscam003#68);

         #dscam003#31 = #dscam003#30 - #dscam003#23; #dscam003#65 = #dscam003#64 - #dscam003#61;

         #dscam003#17 = 0; #dscam003#37 = 0;
         #dscam003#14 = "P";
         #dscam003#15 = "Recibo reclamado";

         #dscam003#84 = "N"; |GRABA 020#dscam003.a;
      |FINSI;

      |SI #dscam051#1 = "S"; |Y HayConta = 1; |Y #dscaz066#1 ! "    ";
         aAlfa = Usuario; |QBF aAlfa; aAlfa = "ac" + aAlfa;
         |NOME_DAT #910 aAlfa;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         |SI nNumSec = 0;
            Linea = 1;
            #dscaw013#15 = #dscaz066#1;  #dscaw013#0 = Linea;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
            #dscaw013#5 = #dscam004#17;  #dscaw013#6 = #dscam004#17;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            |GRABA 020#dscaw013.n;
            |LIBERA #dscaw013;
            Linea = Linea + 1;
            #dscaw013#15 = #dscaz066#1;  #dscaw013#0 = Linea;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 3;
            #dscaw013#5 = #dscam004#3;   #dscaw013#6 = #dscam004#3;
            #dscaw013#11 = "N";          #dscaw013#12 = 3;
            |GRABA 020#dscaw013.n;
            |LIBERA #dscaw013;
         |SINO;
            Linea = 1;
            #dscaw013#15 = #dscaz066#1;  #dscaw013#0 = Linea;
            #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
            #dscaw013#5 = #dscam004#43;  #dscaw013#6 = #dscam004#43;
            #dscaw013#11 = "N";          #dscaw013#12 = 9;
            |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         |FINSI;
         |CIERRA #dscaw013;
         aAlfa = #dscaz066#1; |QBF aAlfa;
         aAlfa = "dscam033.tab;" + aAlfa;

         |LIBERA #dscam003; |CIERRAT #dscam003;
         |LIBERA #dscam004; |CIERRAT #dscam004;
         |SUB_EJECUTA_NP aAlfa; |DELINDEX #dscaw013;
         |ABRET #dscam003; |LEE 101#dscam003.=;
         |ABRET #dscam004; |LEE 101#dscam004.=;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;
      |FINSI;

      eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw049#8; |HAZ ProcesaTempo;
   |SINO;
      #dscam003#40 = #dscaw049#8;
      |LEE 101#dscam003.=;
      |SI FSalida = 0;
         #dscam003#98 = "S";
         |GRABA 020#dscam003.a;
      |FINSI;
      |HAZ Imprime;
   |FINSI;
|FPRC;

|DEFBUCLE Volcado;
#dscaw049#1;
;
INICIO;
FINAL;
;
NULL,Volcado;
|FIN;

|PROCESO BajaBloq;
   eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw049#8; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE BajaBloq;
#dscaw049#1;
;
INICIO;
FINAL;
;
NULL,BajaBloq;
|FIN;

|PROCESO MiraSiEsta;
   enSwError = 1;
|FPRC;

|DEFBUCLE MiraSiEsta;
#dscaw049#1;
8;
001,nDocum;
999,nDocum;
;
NULL,MiraSiEsta;
|FIN;

|PROCESO BuscaDocumen;
   |SI FSalida = 10;
      #dscam003#40 = #dscaw049#8;
      |LEE 000#dscam003.];
      |CONSULTA_CLAVE #1#dscam003;
      #dscaw049#8 = #dscam003#40;
   |FINSI;
   |SI FSalida = 11;
      SwBuscaFac = 1;
      |C_M #dscaw049#2,1,"S"; |C_M #dscaw049#3,1,"S";
      |C_M #dscaw049#4,1,"S"; |C_M #dscaw049#5,1,"S";
   |SINO;
      |C_M #dscaw049#2,1,"N"; |C_M #dscaw049#3,1,"N";
      |C_M #dscaw049#4,1,"N"; |C_M #dscaw049#5,1,"N";
      SwBuscaFac = 0;
      #dscam003#40 = #dscaw049#8;
      |LEE 000#dscam003.=;
      |SI FSalida ! 0;
         |MENAV "    Recibo inexistente"; |ERROR;
      |SINO;
         |SI #dscam003#17 = 0;
            |MENAV "    Recibo no remesado"; |ERROR;
         |SINO;
            #dscam013#0 = #dscam003#17;
            #dscam013#1 = #dscam003#37;
            |LEE 000#dscam013.=;
            |SI FSalida = 0;
               |SI #dscam013#15 = "S";
                  |MENAV "    El recibo ya esta vencido "; |ERROR;
               |SINO;
                  |SI #dscam003#14 ! "L";
                     |MENAV "    El recibo ya ha sido reclamado o impagado"; |ERROR;
                  |SINO;
                     enSwError = 0; nDocum = #dscaw049#8;
                     |SALVA_FICHA #dscaw049; |BUCLE MiraSiEsta; |REPON_FICHA #dscaw049;
                     |SI enSwError = 1;
                        |MENAV "    Recibo ya incluido "; |ERROR;
                     |SINO;
                        eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscaw049#8; |HAZ ProcesaTempo;
                        |SI enSwError = 0;
                           #dscaw049#7 = #dscam013#7;
                           #dscaw049#2 = #dscam003#27;
                           #dscaw049#4 = #dscam003#0;
                           #dscaw049#3 = #dscam003#1;
                           #dscaw049#5 = #dscam003#2;
                           #dscaw049#6 = #dscam003#3;
                           #dscaw049#9 = #dscam003#98;
                        |FINSI;
                     |FINSI;
                  |FINSI;
               |FINSI;
               |LEE 000#dscam013.s;
            |SINO;
               |MENAV "    El recibo no se encuentra en remesas "; |ERROR;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO BuscaFactura;
   |SELECT #6#dscam003;
   |SI FSalida = 10;
      #dscam003#27 = #dscaw049#2;
      #dscam003#0  = #dscaw049#4;
      #dscam003#1  = #dscaw049#3;
      #dscam003#2  = #dscaw049#5;
      #dscam003#69 = " ";
      #dscam003#40 = 1;
      |LEE 000#dscam003.];
      |LEE 000#dscam003.=;
      |CONSULTA_CLAVE #6#dscam003;
      |SI FSalida = 0;
         #dscaw049#2 = #dscam003#27;
         #dscaw049#4 = #dscam003#0;
         #dscaw049#3 = #dscam003#1;
         #dscaw049#5 = #dscam003#2;
         #dscaw049#6 = #dscam003#3;
         #dscaw049#9 = #dscam003#98;
      |SINO;
         |ERROR;
      |FINSI;
   |FINSI;
   |SI SwBuscaFac = 1;
      SwError = 1;
      |SELECT #6#dscam003;
      #dscam003#27 = #dscaw049#2;
      #dscam003#0  = #dscaw049#4;
      #dscam003#1  = #dscaw049#3;
      #dscam003#2  = #dscaw049#5;
      #dscam003#69 = " ";
      #dscam003#40 = 1;
      |LEE 000#dscam003.];
      |PARA; |SI FSalida = 0; |Y #dscam003#27 = #dscaw049#2; |Y #dscam003#0 = #dscaw049#4;
       |Y #dscam003#1 = #dscaw049#3; |Y #dscam003#2 = #dscaw049#5; |HACIENDO;
         aAlfa = #dscam003#3; |QBF aAlfa; aAlfa = aAlfa % -104;
         fFechaHoy = ~; aAlfa1 = fFechaHoy; |QBF aAlfa1; aAlfa1 = aAlfa1 % -104;
         |SI aAlfa = aAlfa1;
            SwError = 0; |SAL;
         |SINO;
            |LEE 000#dscam003.s;
         |FINSI;
      |SIGUE;
      |SI SwError ! 0;
         |MENAV "    Recibo inexistente"; |POSICIONATE #dscaw049#8;
      |SINO;
         |SI #dscam003#17 = 0;
            |MENAV "    Recibo no remesado"; |POSICIONATE #dscaw049#8;
         |SINO;
            #dscam013#0 = #dscam003#17;
            #dscam013#1 = #dscam003#37;
            |LEE 000#dscam013.=;
            |SI FSalida = 0;
               |SI #dscam013#15 = "S";
                  |MENAV "    El recibo ya esta vencido "; |POSICIONATE #dscaw049#8;
               |SINO;
                  |SI #dscam003#14 ! "L";
                     |MENAV "    El recibo ya ha sido reclamado o impagado"; |POSICIONATE #dscaw049#8;
                  |SINO;
                     enSwError = 0;
                     eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscaw049#8; |HAZ ProcesaTempo;
                     |SI enSwError = 1;
                        |MENAV "    Recibo ya incluido "; |ERROR;
                     |SINO;
                        #dscaw049#9 = #dscam003#98;
                        #dscaw049#8 = #dscam003#40;
                        #dscaw049#6 = #dscam003#3;
                        #dscaw049#7 = #dscam013#7;
                     |FINSI;
                  |FINSI;
               |FINSI;
               |LEE 000#dscam013.s;
            |SINO;
               |MENAV "    El recibo no se encuentra en remesas "; |POSICIONATE #dscaw049#8;
            |FINSI;
         |FINSI;
      |FINSI;
      |SELECT #1#dscam003;
      |C_M #dscaw049#2,1,"N"; |C_M #dscaw049#3,1,"N";
      |C_M #dscaw049#4,1,"N"; |C_M #dscaw049#5,1,"N";
   |FINSI;
   |SELECT #1#dscam003;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
  ModoEntrada = (FEntrada / 100) ! 0;
  nFlag = 0 +. 1;
  |SI ModoEntrada = 1; |Y nFlag > 0;
      eaTOperacion = "A"; eaTipoRecibo = "V"; enNumDocum = #dscaw049#8; |HAZ ProcesaTempo;
  |FINSI;
  |SI ModoEntrada = 3;
     eaTOperacion = "B"; eaTipoRecibo = "V"; enNumDocum = #dscaw049#8; |HAZ ProcesaTempo;
  |FINSI;
  nNumMarcas = nNumMarcas +. 1;
  |SI #dscaw049#9 = "N"; nCartas = nCartas +. 1; |FINSI;
|FPRC;

|PROCESO Imprime;
   #dscam003#40 = #dscaw049#8;
   |LEE 000#dscam003.=;
   |SI FSalida ! 0; |DDEFECTO #dscaw049; |FINSI;

   #dscam012#0 = #dscam003#17;
   |LEE 000#dscam012.=;
   |SI FSalida ! 0; |DDEFECTO #dscam012; |FINSI;

   #dscam002#0 = #dscam012#16;
   #dscam002#1 = #dscam012#17;
   |LEE 000#dscam002.=;
   |SI FSalida ! 0; |DDEFECTO #dscam002; |FINSI;

   |PRINT; |PIEINF;
|FPRC;

|PROCESO Tipo5w049; |TIPO 5;
   #dscaw049#9 = "S";
   |LINEAS_BI_ATRI #dscaw049#9,S,D,-1;
|FPRC

|PROCESO Mes;
   eaMes = #dscaz066#0; |QBF eaMes; eaMes = eaMes % 0402;

   |SI eaMes = "01"; eaMes = "Enero";      |FINSI;
   |SI eaMes = "02"; eaMes = "Febrero";    |FINSI;
   |SI eaMes = "03"; eaMes = "Marzo";      |FINSI;
   |SI eaMes = "04"; eaMes = "Abril";      |FINSI;
   |SI eaMes = "05"; eaMes = "Mayo";       |FINSI;
   |SI eaMes = "06"; eaMes = "Junio";      |FINSI;
   |SI eaMes = "07"; eaMes = "Julio";      |FINSI;
   |SI eaMes = "08"; eaMes = "Agosto";     |FINSI;
   |SI eaMes = "09"; eaMes = "Septiembre"; |FINSI;
   |SI eaMes = "10"; eaMes = "Octubre";    |FINSI;
   |SI eaMes = "11"; eaMes = "Noviembre";  |FINSI;
   |SI eaMes = "12"; eaMes = "Diciembre";  |FINSI;
|FPRC;

|PROGRAMA;
   |HAZ Tipo8; |HAZ TomaDecim;

   |ABRE #dscam003; |ABRE #dscam013; |ABRE #dscam004; |ABRE #dscam030;
   |ABRE #dscam051; |ABRE #dscam012; |ABRE #dscam002;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0; |DDEFECTO #dscam051; |FINSI;

   |CLS;
   |CABEZA " Reclamacion de recibos ";
   |DDEFECTO #dscaz066; #dscaz066#1 = #dscam051#44;
   |PINPA #0#0; |PINDA #0#0;
   |ENTLINEAL #1#dscaw049,-1,7,21,1,inf66,sup66;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      nNumMarcas = 0; nCartas = 0;
      aAlfa = "re" + Usuario; |NOME_DAT #10 aAlfa;
      |DELINDEX #dscaw049; |ABRE #dscaw049;
      |ENTLINEAL #1#dscaw049,-1,1,21,1,inf66,sup66;
      |SI nNumMarcas > 0;
         |CONFI "    NConforme con los datos introducidos ? ";
         |SI FSalida = 0;
            |SI nCartas > 0;
               |HAZ Mes;
               |IMPRE 0;
               |SI FSalida = 0;
                  aInforme = "Carta reclamacion efectos"; |HAZ ObtenInforme;
                  |SI aInforme = "Informe notas movimientos"; aInforme = "dscaz066"; |FINSI;
                  |INFOR aInforme;
               |FINSI;
            |FINSI;
            |BUCLE Volcado;
            |SI nCartas > 0;
               |PIEINF; |FININF;
               |FINIMP;
            |FINSI;
         |SINO;
            |BUCLE BajaBloq;
         |FINSI;
      |FINSI;

      |CIERRA #dscam030; |CIERRA #dscam051; |CIERRA #dscam012; |CIERRA #dscam002;
      |CIERRA #dscam004; |CIERRA #dscam003; |CIERRA #dscaw049; |CIERRA #dscam013;
   |FINSI;

   eaSesion   = Usuario; |HAZ LimpiaTempo;

   |HAZ Tipo9;
|FPRO;
