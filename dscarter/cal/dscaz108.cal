|FICHEROS;
   dscaz108 #0;
   dscam073 #1;

   dscam095 #2;
   dscam096 #3;
   dscam008 #4;
   dscam014 #5;
   dscam030 #6;
   dscaw013 #7;
   dscam009 #8;
   dscam051 #9;
   dscaw038 #10;
   dscaw063 #11;

   &agif112@ #150;
   &agif321@ #151;
   &caclipr@ #152;
   capaises@ #153;
   dscam096@ #154;
|FIN;

|VARIABLES;

   &Fichero = ""; &Tipo = ""; &Cmp = ""; &CmpNum = 0;
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = "";
   &nDeci_Base = 0; &nDeci_Div = 0; &eaNombre1   = "";
   &aCuenta    = ""; &nNivel = 0;
   &eaCodigo    = "";
   &eaTipoCod   = "";
   &eaNif       = "";
   &eaNombre    = "";
   &eaDireccion = "";
   &eaDirCobro  = "";
   &eaPoblacion = "";
   &eaProvincia = "";
   &eaCP        = "";
   &eaCP1       = "";
   &eaCP2       = "";
   &eaTelefono  = "";
   &eaPais      = "";

   nNumPago   = 0;
   nSw        = 0;
   aPago      = "";
   aBase      = "";
   aMas       = "";

   aPais = "";
   aCtaAnt = "";
   nTotal   = 0;
   aCuenta1 = "";
   fFechaVto = @;
   nHandle   = 0;

   nContF  = 0;
   nCalcF  = 0;
   nCalc1F = 0;
   nCalc2F = 0;
   aAlfaF  = "";
   aAlfa1F = "";
   aAlfa2F = "";

   nCont   = 0;
   nNumero = 0;
   nModulo = 0;
   LinPag = 0;
   nCalc  = 0;
   nCalc1 = 0;
   nCalc2 = 0;
   aFinLin = ""; aFinFic = "";
   VAlfa   = "";
   VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = ""; VAlfa06 = "";
   VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = ""; VAlfa11 = ""; VAlfa12 = "";
   VAlfa13 = ""; VAlfa14 = ""; VAlfa15 = "";

   Field = ""; Tipo1 = ""; Fecha = ""; Comodin = ""; Comodin1 = "";
   NumDig = 0; Calc = 0;  Handle = 0; aAlfa = ""; aAlfa1 = "";

   NumOrd = 0;  TotalOrd = 0;
   NumInd = 0;  TotalInd = 0;
   NumRegs = 0; nPrim   = 0;
   NumDomics = 0;
   EmpreAnt = 0; PerioAnt = 0;
   aDir = ""; aPob = ""; aCP1 = ""; aCP2 = ""; aPrv = ""; aNif = "";

   handle = 0;
   SwEmit  = 0; SwHayNoEmit  = 0; SwHay  = 0;

   &eaOrigen = "";
   &HayConta = 0;
   &HayGestion = 0;
   &Divisa   = "";
   &enEmpCartera = 0; &enEmpGestion = 0; &enBanco = 0;
   &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = "";

   Moneda = "";
   Cambio = 0;
   Redond = 0;
   Prefijo = "";

   n870 = 0;

|FIN;

|PROCESO IniVars;
   VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = ""; VAlfa06 = "";
   VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = ""; VAlfa11 = ""; VAlfa12 = "";
   Field = ""; Tipo1 = ""; Fecha = ""; Comodin = "";
   NumDig = 0; Calc = 0;
|FPRC;

|PROCESO Presentador;
   |HAZ IniVars;

   VAlfa01 = Prefijo + "170";
   Field = #dscam073#3;  Tipo1 = "N"; NumDig = 9; |HAZ Formato ; VAlfa02 = Field;
   Field = #dscaz108#8;  Tipo1 = "A"; NumDig = 3; |HAZ Formato ; VAlfa03 = Field;
   Fecha = #dscaz108#6;  |HAZ RetocaFecha; VAlfa04 = Fecha;
   VAlfa05 = "      ";
   Field = #dscam073#2; Tipo1 = "A"; NumDig = 40; |HAZ Formato ; VAlfa06 = Field;
   VAlfa07 = " " * 20;
   Field = #dscam073#12; Tipo1 = "N"; NumDig = 4;  |HAZ Formato ; VAlfa08 = Field;
   Field = #dscam073#13; Tipo1 = "N"; NumDig = 4;  |HAZ Formato ; VAlfa09 = Field;
   VAlfa10 = " " * 12;
   Field = #dscam073#19; Tipo1 = "A"; NumDig = 11;  |HAZ Formato ; VAlfa11 = Field;
   VAlfa12 = (" " * 43);
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa   + VAlfa08 + VAlfa09 + VAlfa10 + VAlfa11 + VAlfa12;

   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
   n870 = n870 + 1;

   TotalOrd = 0;
   NumOrd = 0;
|FPRC;

|PROCESO Ordenante;
   |HAZ IniVars;

   VAlfa01 = "0359";
   Field = #dscam073#2;  Tipo1 = "A"; NumDig = 9; |HAZ Formato ; VAlfa02  = Field;
   Field = #dscaz108#8;  Tipo1 = "A"; NumDig = 3; |HAZ Formato ; VAlfa03  = Field;
   VAlfa04 = " " * 12;
   VAlfa05 = "001";
   Fecha = #dscaz108#6;  |HAZ RetocaFecha; VAlfa06 = Fecha;
   VAlfa07 = " " * 9;
   aAlfa = (("0000" + #dscam073#4) % -104) + (("0000" + #dscam073#5) % -104);
   aAlfa = aAlfa + (("00" + #dscam073#22) % -102) + (("0000000000" + #dscam073#6) % -110);
   aAlfa = aAlfa + "142800"; nModulo = 97; |HAZ Modulo; nCalc = aAlfa;
   nCalc = 98 - nCalc;
   VAlfa08 = "ES" + (("00" + nCalc) % -102);
   VAlfa09 = (("0000"       + #dscam073#4)  % -104);
   VAlfa10 = (("0000"       + #dscam073#5)  % -104);
   VAlfa11 = (("00"         + #dscam073#22) % -102);
   VAlfa12 = (("0000000000" + #dscam073#6)  % -110);
   VAlfa13 = " " * 30;

   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa   + VAlfa08 + VAlfa09 + VAlfa10 + VAlfa11 + VAlfa12 + VAlfa13;
   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;

   TotalInd = 0;
   NumInd = 2;
   NumOrd = NumOrd + 1;
   n870 = n870 + 1;
|FPRC;

|PROCESO TotalProv;
   nTotal = nTotal + #dscam096@#7;
|FPRC;

|DEFBUCLE TotalProv;
#dscam096@#4003;
;
#dscam096#0, #dscam096#11, #dscam096#6;
#dscam096#0, #dscam096#11, #dscam096#6;
;
NULL,TotalProv;
|FIN;

|PROCESO Individual;
   |SI #dscam096#11 ! aCtaAnt; |O #dscam096#6 ! fFechaVto;
      nPrim = 0;
      fFechaVto = #dscam096#6;
      aCtaAnt   = #dscam096#11;
   |FINSI;

   nPrim = nPrim + 1;

   #dscam008#40 = #dscam096#16;
   |LEE 000#dscam008.=;
   |SI FSalida = 0;
      Divisa = #dscam008#59; |HAZ TomaDecim;
   |FINSI;

   |SI HayConta = 1;
      Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Cliente/Proveedor"; |HAZ ObtenDato;
      #caclipr@#CmpNum# = "P";
      Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Cuenta Contable"; |HAZ ObtenDato;
      #caclipr@#CmpNum# = #dscam008#5;
      Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Digito Contable"; |HAZ ObtenDato;
      nNumero = CmpNum; aCuenta = #dscam008#5; |HAZ SacaNivel;
      #caclipr@#nNumero# = nNivel;
      |LEE 000#caclipr@.=;
      |SI FSalida = 0;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Nif/Cif";
         |HAZ ObtenDato; aNif = #caclipr@#CmpNum#;

         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Direccion envio doc.pago";
         |HAZ ObtenDato; aDir = #caclipr@#CmpNum#; |QBF aDir
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Poblacion envio doc.pago";
         |HAZ ObtenDato; aPob = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Provincia envio doc.pago";
         |HAZ ObtenDato; aPrv = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "C.P.1 envio doc.pago";
         |HAZ ObtenDato; aCP1       = #caclipr@#CmpNum#;
         Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "C.P.2 envio doc.pago";
         |HAZ ObtenDato; aCP2       = #caclipr@#CmpNum#;
         |SI aDir = "";
            Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Direccion";
            |HAZ ObtenDato; aDir = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Poblacion";
            |HAZ ObtenDato; aPob = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Provincia";
            |HAZ ObtenDato; aPrv = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Codigo Postal 1";
            |HAZ ObtenDato; aCP1 = #caclipr@#CmpNum#;
            Fichero = "Clientes/Proveedores"; Tipo = "C"; Cmp = "Codigo Postal 2";
            |HAZ ObtenDato; aCP2 = #caclipr@#CmpNum#;
         |FINSI;

         aAlfa = #48#16; |QBF aAlfa;
         aAlfa = aAlfa - "agicont";
         |SI FSalida ! 0;
            aPais = "";
            |SI #caclipr@#24 = "DE "; aPais = "ALEMANIA    "; |FINSI;
            |SI #caclipr@#24 = "AT "; aPais = "AUSTRIA     "; |FINSI;
            |SI #caclipr@#24 = "BE "; aPais = "BELGICA     "; |FINSI;
            |SI #caclipr@#24 = "CY "; aPais = "CHIPRE      "; |FINSI;
            |SI #caclipr@#24 = "DK "; aPais = "DINAMARCA   "; |FINSI;
            |SI #caclipr@#24 = "SI "; aPais = "ESLOVENIA   "; |FINSI;
            |SI #caclipr@#24 = "EE "; aPais = "ESTONIA     "; |FINSI;
            |SI #caclipr@#24 = "FI "; aPais = "FINLANDIA   "; |FINSI;
            |SI #caclipr@#24 = "FR "; aPais = "FRANCIA     "; |FINSI;
            |SI #caclipr@#24 = "EL "; aPais = "GRECIA      "; |FINSI;
            |SI #caclipr@#24 = "GB "; aPais = "GRAN BRETA¥A"; |FINSI;
            |SI #caclipr@#24 = "NL "; aPais = "HOLANDA     "; |FINSI;
            |SI #caclipr@#24 = "HU "; aPais = "HUNGRIA     "; |FINSI;
            |SI #caclipr@#24 = "IT "; aPais = "ITALIA      "; |FINSI;
            |SI #caclipr@#24 = "IE "; aPais = "IRLANDA     "; |FINSI;
            |SI #caclipr@#24 = "LV "; aPais = "LETONIA     "; |FINSI;
            |SI #caclipr@#24 = "LT "; aPais = "LITUANIA    "; |FINSI;
            |SI #caclipr@#24 = "LU "; aPais = "LUXEMBURGO  "; |FINSI;
            |SI #caclipr@#24 = "MT "; aPais = "MALTA       "; |FINSI;
            |SI #caclipr@#24 = "PL "; aPais = "POLONIA     "; |FINSI;
            |SI #caclipr@#24 = "PT "; aPais = "PORTUGAL    "; |FINSI;
            |SI #caclipr@#24 = "CZ "; aPais = "REP.CHECA   "; |FINSI;
            |SI #caclipr@#24 = "SK "; aPais = "REP.ESLOVACA"; |FINSI;
            |SI #caclipr@#24 = "CE "; aPais = "SUECIA      "; |FINSI;
            |SI aPais = ""; aPais = "ESPA¥A              "; |FINSI;
         |SINO;
            aAlfa = #48#16; |QBF aAlfa;
            aAlfa = aAlfa - "contagen/";
            |SI FSalida ! 0;
               aAlfa1 = aAlfa + "integral/def/dsam0000.mas";
               |XABRE "E", aAlfa1, nHandle;
               |SI FSalida ! 0;
                  aAlfa1 = aAlfa + "basica/def/agim0016.mas";
                  |CARGA_DEF aAlfa1, capaises@;
                  aAlfa1 = aAlfa + "basica/fich/";
               |SINO;
                  aAlfa1 = aAlfa + "integral/def/dsam0104.mas";
                  |CARGA_DEF aAlfa1, capaises@;
                  aAlfa1 = aAlfa + "integral/fich/";
               |FINSI;
            |FINSI;
            |SI FSalida = 0;
               |PATH_DAT #153 aAlfa1;
               |ABRE #capaises@;
               #capaises@#0 = #caclipr@#24;
               |LEE 000#capaises@.=;
               |SI FSalida ! 0; |DDEFECTO #capaises@; |FINSI;
               aPais = #capaises@#1;
               |CIERRA #capaises@; |DESCARGA_DEF #capaises@;
            |FINSI;
         |FINSI;
      |SINO;
         |SI HayGestion = 1;
            eaCodigo = #dscam008#32; eaTipoCod = "P"; aCuenta = #dscam008#5; |HAZ LeeDatos;
            aPais = eaPais;
            aDir  = eaDireccion;
            aPob  = eaPoblacion;
            aPrv  = eaProvincia;
            aCP1  = eaCP1;
            aCP2  = eaCP2;
         |FINSI;
      |FINSI;
   |SINO;
       |SI HayGestion = 1;
          eaCodigo = #dscam008#32; eaTipoCod = "P"; aCuenta = #dscam008#5; |HAZ LeeDatos;
          aPais = eaPais;
          aDir  = eaDireccion;
          aPob  = eaPoblacion;
          aPrv  = eaProvincia;
          aCP1  = eaCP1;
          aCP2  = eaCP2;
      |FINSI;
   |FINSI;

   Prefijo = "0659";
   Field = #dscam073#2;  Tipo1 = "A"; NumDig = 9; |HAZ Formato; Prefijo = Prefijo + Field;
   Field = #dscaz108#8;  Tipo1 = "A"; NumDig = 3; |HAZ Formato; Prefijo = Prefijo + Field;
   Prefijo = Prefijo + ((aNif + (" " * 12)) % 0112);

   |SI nPrim = 1;
      VAlfa01 = "010";
      Field = #dscam008#6; Tipo1 = "A"; NumDig = 40;  |HAZ Formato ; VAlfa02 = Field;
      VAlfa03 = " " * 29;
      VAlfa = Prefijo + VAlfa01 + VAlfa02 + VAlfa03;
      VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
      n870 = n870 + 1;

      VAlfa01 = "011";
      Field = aDir; Tipo1 = "A"; NumDig = 45;  |HAZ Formato ; VAlfa02 = Field;
      VAlfa03 = " " * 24;
      VAlfa = Prefijo + VAlfa01 + VAlfa02 + VAlfa03;
      VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
      n870 = n870 + 1;

      VAlfa01 = "012";
      Field = aCP1; Tipo1 = "N"; NumDig = 2;   |HAZ Formato ; VAlfa02 = Field;
      Field = aCP2; Tipo1 = "N"; NumDig = 3;   |HAZ Formato ; VAlfa03 = Field;
      Field = aPob; Tipo1 = "A"; NumDig = 40;  |HAZ Formato ; VAlfa04 = Field;
      VAlfa05 = " " * 24;
      VAlfa = Prefijo + VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05;
      VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
      n870 = n870 + 1;

      VAlfa01 = "013";
      Field = aCP1;  Tipo1 = "N"; NumDig = 2;  |HAZ Formato; VAlfa02 = Field;
      Field = aCP2;  Tipo1 = "N"; NumDig = 3;  |HAZ Formato; VAlfa03 = Field;
      VAlfa03 = VAlfa03 + "    ";
      Field = aPrv;  Tipo1 = "A"; NumDig = 30; |HAZ Formato; VAlfa04 = Field;
      Field = aPais; Tipo1 = "A"; NumDig = 20; |HAZ Formato; VAlfa05 = Field;
      VAlfa06 = " " * 10;
      VAlfa = Prefijo + VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06;
      VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
      n870 = n870 + 1;

      VAlfa01 = "014"; aAlfa = "";

      || aAlfa = #dscam073#25; |QBF aAlfa;
      aAlfa = "9000";
      aAlfa = aAlfa + (("0000" + #dscam095#0) % -104); |QBF aAlfa;
      aAlfa1 = #dscam096#1; |QBF aAlfa1;
      aAlfa = aAlfa + (("000" + aAlfa1) % -103); |QBF aAlfa;
      nModulo = 7; |HAZ Modulo; nCalc = aAlfa; aAlfa = nCalc;

      aPago = (("0000" + #dscam095#0) % -104) + (("000" + #dscam096#1) % -103) + aAlfa; |QBF aPago;

      Field = aPago;   Tipo1 = "N"; NumDig = 8;  |HAZ Formato; VAlfa02 = Field;
      aAlfa = #dscam008#3; |QBF aAlfa;
      VAlfa03 = (aAlfa % 0102) + (aAlfa % 0402) + (aAlfa % 0704);

      nTotal = 0;
      |DBASE aBase; |QBF aBase;
      aMas = aBase + "def/dscam096.mas";
      |CARGA_DEF aMas, dscam096@;
      |SI FSalida = 0;
         |DFICE aAlfa; |QBF aAlfa; |PATH_DAT #dscam096@#aAlfa#;
         |BUCLE TotalProv;

         |DESCARGA_DEF #dscam096@;
      |FINSI;

      nCalc = (nTotal * 100) ! 0; aAlfa = nCalc; |QBF aAlfa;
      VAlfa04 = ("000000000000" + aAlfa) % -112;
      VAlfa05 = "0"; || Presentacion
      VAlfa06 = " " * 40;
      VAlfa = Prefijo + VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06;
      VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
      n870 = n870 + 1;

      aDir = ""; aPob = ""; aPrv = ""; aCP1 = ""; aCP2 = ""; aPais = ""; aNif = "";
      nCont = 15;
   |FINSI;

   VAlfa01 = ("000" + nCont) % -103; nCont = nCont + 1;
   Field = aPago; Tipo1 = "N"; NumDig = 8;  |HAZ Formato; VAlfa02 = Field;

   Field = #dscam008#63; Tipo1 = "A"; NumDig = 12; |HAZ Formato; VAlfa03 = Field;

   aAlfa = #dscam008#4; |QBF aAlfa;
   VAlfa04 = (aAlfa % 0102) +(aAlfa % 0402) + (aAlfa % 0704);
   nCalc = #dscam096#7;
   |SI nCalc < 0;
      nCalc = 0 - nCalc;
      VAlfa06 = "D";
   |SINO;
      VAlfa06 = "H";
   |FINSI;
   nCalc = (nCalc * 100) ! 0; aAlfa = nCalc; |QBF aAlfa;
   VAlfa05 = ("000000000000" + aAlfa) % -112;

   aAlfa = #dscam008#63; |QBF aAlfa;
   Field = aAlfa; Tipo1 = "A"; NumDig = 28; |HAZ Formato; VAlfa07 = Field;
   VAlfa = Prefijo + VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;

   n870 = n870 + 1;
   TotalInd = TotalInd + #dscam096#7;
   TotalOrd = TotalOrd + #dscam096#7;
   NumInd = NumInd + 1;
   NumDomics = NumDomics + 1;

   |SI #dscam095#8 = "N"; |HAZ ActRecibo; |FINSI;
|FPRC;

|PROCESO TotalGeneral;
   VAlfa01 = "0859";
   Field = #dscam073#2;  Tipo1 = "A"; NumDig = 9;  |HAZ Formato ; VAlfa02  = Field;
   Field = #dscaz108#8;  Tipo1 = "A"; NumDig = 3;  |HAZ Formato ; VAlfa03  = Field;
   VAlfa04 = " " * 15;
   nCalc = TotalInd; nCalc = (nCalc * 100) ! 0;
   Field = nCalc;        Tipo1 = "N"; NumDig = 12; |HAZ Formato ; VAlfa05  = Field;
   nCalc = n870 + 1; || Este registro
   Field = nCalc; Tipo1 = "N"; NumDig = 10;|HAZ Formato ; VAlfa06  = Field;
   VAlfa07 = " " * 47;
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
|FPRC;

|PROCESO ActRecibo;
|ACABA;
   #dscam008#40 = #dscam096#16;
   |LEE 000#dscam008.=;
   |SI FSalida = 0;
      Divisa = #dscam008#59; |HAZ TomaDecim;
   |FINSI;

   || Actualizo  el historico de cobros
   #dscam009#14 = #dscam096#16;
   #dscam009#3  = 99;
   |LEE 000#dscam009.];
   |SI FSalida ! 0;
      |LEE 010#dscam009.u;
      |SI FSalida = 0; |Y #dscam009#14 = #dscam096#16;
         LinPag = #dscam009#3 + 1;
      |SINO;
         LinPag = 1;
      |FINSI;
   |SINO;
      |SI #dscam009#14 = #dscam096#16;
         LinPag = #dscam009#3 + 1;
      |SINO;
         |LEE 010#dscam009.a;
         |SI FSalida = 0; |Y #dscam009#14 = #dscam096#16;
            LinPag = #dscam009#3 + 1;
         |SINO;
            LinPag = 1;
         |FINSI;
      |FINSI;
   |FINSI;

   |DDEFECTO #dscam009;
   #dscam009#14 = #dscam096#16;
   #dscam009#15 = #dscam096#2;
   #dscam009#0  = #dscam096#4;
   #dscam009#1  = #dscam096#3;
   #dscam009#2  = #dscam096#5;
   #dscam009#3  = LinPag;
   #dscam009#4  = #dscam095#14;
   #dscam009#5  = "PDM";
   #dscam009#6  = #dscam095#1;
   #dscam008#40 = #dscam096#16;
   |LEE 010#dscam008.=;
   |SI FSalida = 0;
      #dscam009#7  = #dscam008#23; #dscam009#20  = #dscam008#57;
   |FINSI;
   #dscam009#8  = #dscam096#22; #dscam009#21  = #dscam096#7;
   #dscam009#9  = 0;
   #dscam009#10 = 0;
   #dscam009#33 = #dscam008#61;
   |GRABA 020#dscam009.n;

   #dscam096#17 = LinPag; |GRABA 020#dscam096.a;

   || Actualizo el recibo
   #dscam008#40 = #dscam096#16;
   |LEE 101#dscam008.=;
   |SI FSalida = 0;
      #dscam008#26 = #dscam095#1;
      #dscam008#23 = #dscam008#23 + #dscam096#7; #dscam008#57 = #dscam008#57 + #dscam096#7;
      #dscam008#25 = #dscam008#22 + #dscam008#24 + #dscam008#38;
      #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55;
      Comodin = #dscam008#31; |QBF Comodin; Calc = Comodin;
      #dscam008#31 = #dscam008#25 - #dscam008#23;
      #dscam008#58 = #dscam008#56 - #dscam008#57;
      |SI #dscam008#31 = 0;
         #dscam008#14 = "L"; #dscam008#15 = "Recibo liquidado";
      |SINO;
         #dscam008#14 = "C"; #dscam008#15 = "Parcialmente cobrado";
      |FINSI;
      |GRABA 020#dscam008.a; |LIBERA #dscam008;
   |FINSI;

|FPRC;

|DEFBUCLE Recibos;
#dscam096#4;
;
#dscam095#0, "            ", "01.01.0000";
#dscam095#0, "zzzzzzzzzzzz", "31.12.9999";
;
NULL,Individual;
|FIN;

|PROCESO Remesas;

   #dscam095#0 = #dscaw038#0;
   |LEE 101#dscam095.=;
   |SI FSalida = 0;
      SwEmit = #dscam095#8;
   |FINSI;

   eaUsuario = Usuario % 0810;
   eaDescr   = "EMISION REL.PAGOS DOM.(" + (("00000" + #dscam095#0) % -105);
   eaDescr   = eaDescr + ") EN DISKETTE DESDE NORMA 68";
   eaTipoReg = "RE";  eaNumero = ("00000" + #dscam095#0) % -105;
   eaTipoOp  = "E";   enImpAnt = #dscam095#10; enImpAct = #dscam095#10;
   |HAZ GrabaAudit;

   nPrim = 0; |BUCLE Recibos;

   |SI #dscam095#8 = "N";
      #dscam095#8 = "S"; |GRABA 020#dscam095.a;
   |FINSI;
   |LIBERA #dscam095;

   |SI HayConta = 1; |Y SwEmit = "N"; |Y #dscam051#1 = "S";
      |ABRE #dscam030;
      #dscam030#0 = #dscaz108#14;
      |LEE 010#dscam030.=;
      |SI FSalida = 0;
         |SI #dscam030#4 ! #dscaw038#3; |O #dscam030#5 ! #dscaw038#4;
            EmpreAnt = #dscam030#4; PerioAnt = #dscam030#5;
            #dscam030#4 = #dscaw038#3; #dscam030#5 = #dscaw038#4;
            |GRABA 020#dscam030.a;
         |SINO;
            EmpreAnt = -1;
         |FINSI;
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #7 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         |DDEFECTO #dscaw013;
         #dscaw013#0  = 1;            #dscaw013#15 = #dscaz108#14;
         #dscaw013#5  = #dscam095#0;  #dscaw013#6  = #dscam095#0;
         #dscaw013#11 = "N";          #dscaw013#12 = 5;
         #dscaw013#13 = "dscam096";   #dscaw013#14 = 0;
         |GRABA 020#dscaw013.n;
         |CIERRA #dscaw013;

         Comodin = #dscaw038#2;
         Comodin = "dscam033.tab;" + Comodin + ",E";
         |LIBERA #dscam095; |CIERRAT #dscam095;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam095; |LEE 101#dscam095.=;

         |SI EmpreAnt ! -1;
            #dscam030#4 = EmpreAnt; #dscam030#5 = PerioAnt;
            |GRABA 020#dscam030.a;
         |FINSI;
      |FINSI;
      |CIERRA #dscam030;
   |FINSI;
|FPRC;

|DEFBUCLE Remesas;
#dscaw038#1;
;
INICIO;
FINAL;
;
NULL,Remesas;
|FIN;

|PROCESO MiraRemesas;
   SwHay = 1;
   |DDEFECTO #dscaw038;
   #dscaw038#0 = #dscam095#0;
   #dscaw038#1 = #dscam095#10;
   #dscaw038#2 = #dscaz108#14;
   #dscaw038#5 = #dscam095#8;
   |SI #dscaw038#5 = "N";
      SwHayNoEmit = 1;
   |FINSI;

   |ABRE #dscam030;
   #dscam030#0 = #dscaz108#14;
   |LEE 000#dscam030.=;
   |SI FSalida = 0;
      #dscaw038#3 = #dscam030#4;
      #dscaw038#4 = #dscam030#5;
   |FINSI;
   |CIERRA #dscam030;
   |GRABA 020#dscaw038.n;
|FPRC;

|DEFBUCLE MiraRemesas;
#dscam095#1;
1,2;
#0#0,#0#2,#dscam014#0;
#0#1,#0#3,#dscam014#0;
;
NULL,MiraRemesas;
|FIN;

|RUTINA infw038;
   #dscaw038#0 = 00001;
   #dscaw038#5 = "N";
|FRUT;

|RUTINA supw038;
   #dscaw038#0 = 99999;
   #dscaw038#5 = "N";
|FRUT;

|PROCESO Secuencial;
   #dscam073#0 = #dscam014#0;
   |LEE 000#dscam073.=;
   |SI FSalida ! 0; |DDEFECTO #dscam073; |FINSI;

   |DELINDEX #dscaw038; |DELINDEX #dscaw063;
   SwHayNoEmit = 0; SwHay = 0;
   |ABRE #dscaw038; |BUCLE MiraRemesas; |CIERRA #dscaw038;
   |SI SwHay = 0; |ACABA; |FINSI;

   |SI #dscaz108#15 = "N";
      |SI SwHayNoEmit = 1;
         |PUSHV 0501 2380;
         |ENTLINEAL #1#dscaw038,1,2,19,1,infw038,supw038;
         |POPV;
      |SINO;
         |MENAV "    No hay remesas sin emitir para redireccionar";
      |FINSI;
   |FINSI;

   Comodin1 = ("000" + #dscam014#0) % -103;
   Comodin1 = "n6800" + Comodin1 + ".seq";
   |DFICB Comodin; eaOrigen = Comodin; eaNombre1 = Comodin1;
   Comodin = "wb  " + Comodin + Comodin1;
   |QBF Comodin;
   |FABRE Comodin;
   handle = FSalida;
   |SI FSalida ] 0;
      |ABRE #dscam009; |ABRE #dscam008;
      |ABRE #dscam095;
      |ABRE #dscam096;
      |HAZ Ordenante;    NumRegs = NumRegs + 1;
      |BUCLE Remesas;    NumRegs = NumRegs + NumInd;
      |HAZ TotalGeneral; NumRegs = NumRegs + 1;
      #0#9 = NumDomics;
      #0#10 = NumRegs;
      #0#11 = TotalOrd;
      |PINTA #0#9; |PINTA #0#10; |PINTA #0#11;
      |PAUSA;
      |CIERRA #dscam096;
      |CIERRA #dscam095;
      |CIERRA #dscam008; |CIERRA #dscam009;
   |FINSI;
   VAlfa = Handle + " " + aFinFic; |FGRABA VAlfa;
   FSalida = handle; |FCIERRA FSalida;

   |SUB_EJECUTA_NP "dscaz032.tab";
|FPRC;

|DEFBUCLE Secuencial;
#dscam014#1;
;
#0#4;
#0#5;
;
NULL,Secuencial;
|FIN;

|PROGRAMA;
   |HAZ Tipo8;

   |CLS;
   |CABEZA "Emision diskette norma 58";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      aFinLin = &13 + &10; aFinFic = &0;

      |HAZ MiraMoneda;
      |ABRE #dscam073;
      |SI Cambio ! -1; |BUCLE Secuencial; |FINSI;
      |CIERRA #dscam073;
   |FINSI;

   |HAZ Tipo9;
|FPRO;

|PROCESO RetocaFecha;
   |QBF Fecha;
   Comodin = Fecha % 0102;  || Dia
   Comodin = Comodin + (Fecha % 0402);  || Mes
   Comodin = Comodin + (Fecha % 0902);  || A¤o
   Fecha = Comodin;
|FPRC;

|PROCESO Formato;
   |SI Tipo1 = "I";
      Calc = Field;
      Calc = (Calc * Cambio) ! Redond;
      |SI Moneda = "E"; Calc = Calc * 100; |FINSI;
      Field = Calc;
   |FINSI;
   |SI Tipo1 = "A";
      aAlfaF = Field; |QBF aAlfaF; aAlfaF = aAlfaF % 0;
      nCalcF = aAlfaF;
      aAlfaF = Field; |QBF aAlfaF;
      |PARA nContF = 0; |SI nContF < nCalcF; |HACIENDO nContF = nContF + 1;
         nCalc1F = ((nContF + 1) * 100) + 1; aAlfa1F = aAlfaF % nCalc1F;
         aAlfa2F = "";
         |SI aAlfa1F = "¤"; aAlfa2F = "ñ"; |FINSI;
         |SI aAlfa1F = "¥"; aAlfa2F = "Ñ"; |FINSI;
         |SI aAlfa1F = " "; aAlfa2F = "á"; |FINSI;
         |SI aAlfa1F = ""; aAlfa2F = "é"; |FINSI;
         |SI aAlfa1F = "¡"; aAlfa2F = "í"; |FINSI;
         |SI aAlfa1F = "¢"; aAlfa2F = "ó"; |FINSI;
         |SI aAlfa1F = "£"; aAlfa2F = "ú"; |FINSI;
         |SI aAlfa2F ! "";
            nCalc1F = 100 + nContF; nCalc2F = ((nContF + 2) * 100) + 99;
            aAlfaF = (aAlfaF % nCalc1F) + aAlfa2F + (aAlfaF % nCalc2F);
         |FINSI;
      |SIGUE;
      Field = aAlfaF;
      Comodin = " " * NumDig;
      Comodin = Field + Comodin;
      Calc = 100 + NumDig;
   |SINO;
      Comodin = "0" * NumDig;
      Comodin = Comodin + Field;
      Calc = 0 - (100 + NumDig);
   |FINSI;

   |QBF Field;
   Field = Comodin % Calc;

|FPRC;

|PROCESO CampoEnlace; |TIPO 7;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;
   |SI HayConta = 1; |Y #dscam051#1 = "S";
      |ABRE #dscam030;
      #dscam030#0 = #dscam051#78;
      |LEE 000#dscam030.=;
      |SI FSalida = 0;
         |PINTA 2020, #dscam030#1;
      |FINSI;
      |CIERRA #dscam030;
      #dscaz108#14 = #dscam051#78; |PINTA #dscaz108#14;
      |C_M #dscaz108#14,1,"S";
   |SINO;
      #dscaz108#14 = ""; |PINTA #dscaz108#14;
      |C_M #dscaz108#14,1,"N";
   |FINSI;
|FPRC;

|PROCESO MiraMoneda;
   Moneda = "E";
      ||POPV;
   |SI HayGestion = 1;
      |SI #agif321@#9 = "ESP";
         |SI Moneda = "P";
            Cambio = 1;
            Redond = 0;
            Prefijo = "0";
         |SINO;
            Cambio = 1/166.386;
            Redond = 2;
            Prefijo = "5";
         |FINSI;
      |FINSI;
      |SI #agif321@#9 = "EUR";
         |SI Moneda = "P";
            Cambio = 166.386;
            Redond = 0;
            Prefijo = "0";
         |SINO;
            Cambio = 1;
            Redond = 2;
            Prefijo = "5";
         |FINSI;
      |FINSI;
   |SINO;
      Cambio = 1;
      Redond = 2;
      Prefijo = "5";
   |FINSI;
|FPRC;

|PROCESO MiraParam; |TIPO 7;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#1 = "S";
      Comodin = #dscam051#61;
      |C_M #dscaz108#14,1,Comodin;
   |SINO;
      |C_M #dscaz108#14,1,"N";
   |FINSI;
|FPRC;

|PROCESO Modulo;
   aAlfa1 = aAlfa % 0101;
   |PARA; |SI aAlfa1 = "0"; |HACIENDO;
      aAlfa = aAlfa % 0299; aAlfa1 = aAlfa % 0101;
   |SIGUE;

   |PARA; |SI aAlfa ! ""; |HACIENDO;
      aAlfa1 = aAlfa % 0110; aAlfa = aAlfa % 1199;
      nCalc = aAlfa1;
      nCalc1 = nCalc / nModulo;
      nCalc1 = ((nCalc1 - 0.49) ! 0);
      nCalc1 = nCalc1 * nModulo;
      nCalc = nCalc - nCalc1;
      aAlfa1 = nCalc;
      |SI aAlfa ! ""; aAlfa = aAlfa1 + aAlfa; |FINSI;
   |SIGUE;
   aAlfa = nCalc; |QBF aAlfa;
   aAlfa = ("00" + aAlfa) % -102;
|FPRC;

|PROCESO TrasSufijo;
   |SI #dscaz108#8 = "   "; |ACABA; |FINSI;

   aAlfa1 = #dscaz108#8; |QBF aAlfa1;
    aAlfa1 = ("000" + aAlfa1) % -103;
   nCalc = #dscaz108#8; aAlfa = nCalc;
   aAlfa = ("000" + aAlfa) % -103;
   |SI aAlfa1 ! aAlfa;
      |ERROR;
   |SINO;
      aAlfa1 = #dscaz108#8; |QBF aAlfa1;
      aAlfa1 = ("000" + aAlfa1) % -103;
      #dscaz108#8 = aAlfa1; |PINTA #dscaz108#8;
   |FINSI;
|FPRC;
