|FICHEROS;
   dscaz020 #0;
   dscam021 #1;
   dscam022 #2;

   dscam030 #3;
   dscaw013 #4;

   dscam014 #5;

   dscam008 #6;
   dscam009 #7;
   dscam036 #8,MANTE;
   dscam051 #9;

   dscaw024 #10,MANTE;
|FIN;

|VARIABLES;
   &HayConta = 0;
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = ""; &Divisa = "";

   Comodin   = "";
   FechaCont = "";
   TipoDato  = "";
   aAlfa     = "";
   aMarca    = "";
   nSwTempo  = 0;
   nClave    = 0;
   nSwCambio = 0;

   nTecla    = 0;
   Cont      = 0;
   Opcion    = 0;
   Salir     = 0;
   LongDato  = 0;
   LinPag    = 0;
   Edicion   = 0;

   fFechaVto = @;

{-1}Menu  = "";
    Menu1 = "2400";
    Menu2 = "1";
    Menu3 = "";
    Menu4 = "REC";
    Menu5 = " Revisar ";
    Menu6 = " Enlazar ";
    Menu7 = " Cancelar ";
|FIN;

|PROCESO EscogeFic;

         TipoDato = #dscaw013#11; LongDato = #dscaw013#12;
         |SI TipoDato = "A";
            |CAMPO_ANCHO #dscaw013#3,1,LongDato;
            |CAMPO_MAXIMO #dscaw013#3,1,"\ +#";
            |CAMPO_ANCHO #dscaw013#4,1,LongDato;
            |CAMPO_MAXIMO #dscaw013#4,1,"\ +#";
            |C_M #dscaw013#3,1,"S"; |C_V #dscaw013#3,1,"S"; |PINTA #dscaw013#3;
            |C_M #dscaw013#4,1,"S"; |C_V #dscaw013#4,1,"S"; |PINTA #dscaw013#4;
            |C_M #dscaw013#5,1,"N"; |C_V #dscaw013#5,1,"N";
            |C_M #dscaw013#6,1,"N"; |C_V #dscaw013#6,1,"N";
            |C_M #dscaw013#7,1,"N"; |C_V #dscaw013#7,1,"N";
            |C_M #dscaw013#8,1,"N"; |C_V #dscaw013#8,1,"N";
         |FINSI;
         |SI TipoDato = "N";
            |C_M #dscaw013#3,1,"N"; |C_V #dscaw013#3,1,"N";
            |C_M #dscaw013#4,1,"N"; |C_V #dscaw013#4,1,"N";
            |C_M #dscaw013#5,1,"S"; |C_V #dscaw013#5,1,"S"; |PINTA #dscaw013#5;
            |C_M #dscaw013#6,1,"S"; |C_V #dscaw013#6,1,"S"; |PINTA #dscaw013#6;
            |C_M #dscaw013#7,1,"N"; |C_V #dscaw013#7,1,"N";
            |C_M #dscaw013#8,1,"N"; |C_V #dscaw013#8,1,"N";
         |FINSI;
         |SI TipoDato = "F";
            |C_M #dscaw013#3,1,"N"; |C_V #dscaw013#3,1,"N";
            |C_M #dscaw013#4,1,"N"; |C_V #dscaw013#4,1,"N";
            |C_M #dscaw013#5,1,"N"; |C_V #dscaw013#5,1,"N";
            |C_M #dscaw013#6,1,"N"; |C_V #dscaw013#6,1,"N";
            |C_M #dscaw013#7,1,"S"; |C_V #dscaw013#7,1,"S"; |PINTA #dscaw013#7;
            |C_M #dscaw013#8,1,"S"; |C_V #dscaw013#8,1,"S"; |PINTA #dscaw013#8;
         |FINSI;
|FPRC;

|PROCESO TomaVal;
   |SI TipoDato = "A"; #dscaw013#9 = #dscaw013#3; #dscaw013#10 = #dscaw013#4; |FINSI;
   |SI TipoDato = "N"; #dscaw013#9 = #dscaw013#5; #dscaw013#10 = #dscaw013#6; |FINSI;
   |SI TipoDato = "F"; #dscaw013#9 = "   " + #dscaw013#7; #dscaw013#10 = "   "+ #dscaw013#8; |FINSI;

   |C_M #dscaw013#3,1,"N"; |C_V #dscaw013#3,1,"N";
   |C_M #dscaw013#4,1,"N"; |C_V #dscaw013#4,1,"N";
   |C_M #dscaw013#5,1,"N"; |C_V #dscaw013#5,1,"N";
   |C_M #dscaw013#6,1,"N"; |C_V #dscaw013#6,1,"N";
   |C_M #dscaw013#7,1,"N"; |C_V #dscaw013#7,1,"N";
   |C_M #dscaw013#8,1,"N"; |C_V #dscaw013#8,1,"N";
                           |C_V #dscaw013#9,1,"S";
                           |C_V #dscaw013#10,1,"S";
|FPRC;

|RUTINA infe1;
   #dscaw013#0 = 001;
   #dscaw013#15 = #dscaz020#4;
   #dscaw013#17 = "S";
|FRUT;

|RUTINA supe1;
   #dscaw013#0 = 999;
   #dscaw013#15 = #dscaz020#4;
   #dscaw013#17 = "S";
|FRUT;

|PROCESO LineasPag;

   || Actualizo  el historico de pagos

   #dscam008#40 = #dscam022#13;
   |LEE 010#dscam008.=;
   |SI FSalida = 0;
      #dscam009#14 = #dscam022#13;
      #dscam009#3 = 99;
      |LEE 000#dscam009.];
      |SI FSalida ! 0;
         |LEE 010#dscam009.u;
         |SI FSalida = 0; |Y #dscam009#14 = #dscam022#13;
            LinPag = #dscam009#3 + 1;
         |SINO;
            LinPag = 1;
         |FINSI;
      |SINO;
         |SI #dscam009#14 = #dscam022#13;
            LinPag = #dscam009#3 + 1;
         |SINO;
            |LEE 010#dscam009.a;
            |SI FSalida = 0; |Y #dscam009#14 = #dscam022#13;
               LinPag = #dscam009#3 + 1;
            |SINO;
               LinPag = 1;
            |FINSI;
         |FINSI;
      |FINSI;

      |DDEFECTO #dscam009;
      #dscam009#14 = #dscam022#13;        || N§ documento
      #dscam009#13 = #dscam022#2;         || Libro
      #dscam009#0  = #dscam022#4;         || Serie
      #dscam009#1  = #dscam022#3;         || Factura
      #dscam009#2  = #dscam022#5;         || Recibo
      #dscam009#3  = LinPag;              || N§ de pago
      #dscam009#4  = #dscam021#10;     || Cuenta de pago
      #dscam009#5  = "PPA";
      |SI fFechaVto ! "01.01.0000";
         #dscam009#6  = fFechaVto;           || Fecha de vencimiento
      |SINO;
         #dscam009#6  = #dscam021#2;         || Fecha de vencimiento
      |FINSI;
      #dscam009#7  = #dscam008#23;        || Total liquidado (D)
      #dscam009#20 = #dscam008#57;        || Total liquidado (B)
      #dscam009#8  = #dscam022#7;         || Importe efecto (D)
      #dscam009#21 = #dscam022#19;        || Importe efecto (B)
      #dscam009#9  = 0;
      |GRABA 020#dscam009.n;

      || Actualizo el recibo
      |SI #dscam008#74 = "N";
         #dscam008#14 = "L";
         #dscam008#15 = "Recibo liquidado";
      |SINO;
         #dscam008#14 = "e";
         #dscam008#15 = "Pendiente de compensar";
         #dscam022#14 = #dscam009#3;
      |FINSI;

      |SI #dscam051#71 = "V";
         |SI #dscam051#72 = "E"; #dscam008#26 = #dscam021#1; |FINSI;
         |SI #dscam051#72 = "V";
            |SI fFechaVto ! "01.01.0000";
               #dscam008#26 = fFechaVto;
            |SINO;
               #dscam008#26 = #dscam021#2;
            |FINSI;
         |FINSI;
         |SI #dscam051#72 = " "; #dscam008#26 = ~;           |FINSI;
      |FINSI;

      |SI fFechaVto ! "01.01.0000";
         #dscam008#26  = fFechaVto;           || Fecha de vencimiento
      |SINO;
         #dscam008#26  = #dscam021#2;         || Fecha de vencimiento
      |FINSI;
      #dscam008#23 = #dscam008#23 + #dscam022#7;
      #dscam008#57 = #dscam008#57 + #dscam022#19;
      #dscam008#25 = #dscam008#22 + #dscam008#24 + #dscam008#38;
      #dscam008#56 = #dscam008#53 + #dscam008#54 + #dscam008#55;
      #dscam008#31 = #dscam008#25 - #dscam008#23;
      #dscam008#58 = #dscam008#56 - #dscam008#57;
      |GRABA 020#dscam008.a;
   |FINSI;

   #dscam022#12 = "S"; |GRABA 020#dscam022.a;
|FPRC;

|DEFBUCLE LineasPag;
#dscam022#1;
;
#dscam021#0,001;
#dscam021#0,999;
;
NULL,LineasPag;
|FIN;

|PROCESO VtoPagares;
   |C_M #dscaz020#5, 0, aAlfa;
   |SI aAlfa = "N";
      |SI nSwTempo = 0;
         FechaCont = #dscam021#2;
      |FINSI;
   |SINO;
      FechaCont = #dscaz020#5;
   |FINSI;

   #dscam014#0 = #dscam021#3;
   |LEE 010#dscam014.=;

   |SI HayConta = 1; |Y #dscam051#1 = "S";
      |ABRE #dscam030;
      #dscam030#0 = #dscaz020#4;
      |LEE 010#dscam030.=;
      |SI FSalida = 0;
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #4 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         |DDEFECTO #dscaw013;
         #dscaw013#0  = 1;            #dscaw013#15 = #dscaz020#4;
         #dscaw013#5  = #dscam021#0;  #dscaw013#6  = #dscam021#0;
         #dscaw013#11 = "N";          #dscaw013#12 = 5;
         #dscaw013#13 = "dscam022";   #dscaw013#14 = 0;
         |GRABA 020#dscaw013.n;
         |CIERRA #dscaw013;
         Comodin = #dscaz020#4;
         Comodin = "dscam033.tab;" + Comodin  + ",V" + FechaCont;
         |LIBERA #dscam021; |CIERRAT #dscam021;
         |LIBERA #dscam022; |CIERRAT #dscam022;
         |SUB_EJECUTA_NP Comodin;
         |ABRET #dscam021; |LEE 101#dscam021.=;
         |ABRET #dscam022; |LEE 101#dscam022.=;

         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".dat"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ddx"; |FBORRA aAlfa;
         |DFICE aAlfa; |QBF aAlfa; aAlfa = "ac" + Usuario + ".ixx"; |FBORRA aAlfa;

      |FINSI;
   |FINSI;
   |CIERRA #dscam030;
   #dscam021#8 = "S"; |GRABA 020#dscam021.a;

   |BUCLE LineasPag;

   eaUsuario = Usuario % 0810;
   eaDescr   = "VENCIMIENTO PAGARE (" + (("00000" + #dscam021#0) % -105) + ")";
   eaTipoReg = "PA";  eaNumero = ("00000" + #dscam021#0) % -105;
   eaTipoOp  = "V";   enImpAct = #dscam021#9; enImpAnt = #dscam021#9;
   |HAZ GrabaAudit;
|FPRC;

|DEFBUCLE VtoPagares;
#dscam021#1;
2,8;
#dscaz020#0,#dscaz020#2,"N";
#dscaz020#1,#dscaz020#3,"N";
be;
NULL,VtoPagares;
|FIN;

|PROCESO Temporal;
   FechaCont = #dscaw024#8;
   fFechaVto = #dscaw024#8;

   #dscam021#0 = #dscaw024#0;
   |LEE 000#dscam021.=;
   |HAZ VtoPagares;
|FPRC;

|DEFBUCLE Temporal;
#dscaw024#1;
7;
00001,"*";
99999,"*";
;
NULL,Temporal;
|FIN;

|PROCESO RellenaAcot;
   |DDEFECTO #dscaw013;
   |PARA Cont = 0; |SI Cont [ 17; |HACIENDO Cont = Cont + 1;
      #dscaw013#Cont# = #dscam036#Cont#;
   |SIGUE;
   |GRABA 020#dscaw013.n;
|FPRC;

|DEFBUCLE RellenaAcot;
#dscam036#2;
;
#dscaz020#4,"S",001;
#dscaz020#4,"S",999;
;
NULL,RellenaAcot;
|FIN;

|PROCESO RellenaTempo;
   |SI #dscam021#7 = "N"; |ACABA; |FINSI;

   Divisa = #dscam021#18; |HAZ TomaDecim; |PULSATECLA;

   #dscam022#0 = #dscam021#0;
   #dscam022#1 = 1;
   |LEE 000#dscam022.];
   |SI FSalida = 0; |Y #dscam022#0 = #dscam021#0;
      |DDEFECTO #dscaw024;
      #dscaw024#0  = #dscam021#0;
      #dscaw024#1  = #dscam022#10;
      #dscaw024#2  = #dscam021#1;
      #dscaw024#3  = #dscam021#2;
      #dscaw024#4  = #dscam021#9;
      #dscaw024#5  = #dscam021#4;
      #dscaw024#6  = #dscam021#18;
      #dscaw024#7  = aMarca;
      |SI #dscaz020#5 = "00.00.0000";
         #dscaw024#8  = #dscaw024#3;
      |SINO;
         #dscaw024#8  = #dscaz020#5;
      |FINSI;
      #dscaw024#9  = #dscam021#3;
      #dscaw024#10 = #dscam022#8;
      #dscaw024#11 = #dscam021#16;
      |GRABA 020#dscaw024.n;
   |FINSI;

|FPRC;

|DEFBUCLE RellenaTempo;
#dscam021#1;
2,7,8;
#dscaz020#0,#dscaz020#2," ","N";
#dscaz020#1,#dscaz020#3,"z","N";
;
NULL,RellenaTempo;
|FIN;

|RUTINA infw024;
   #dscaw024#0 = 00001;
   #dscaw024#2 = "01.01.0000";
   #dscaw024#3 = "01.01.0000";
   #dscaw024#4 = -9999999999.99;
   #dscaw024#9 = 000;
|FRUT;

|RUTINA supw024;
   #dscaw024#0 = 99999;
   #dscaw024#2 = "31.12.9999";
   #dscaw024#3 = "31.12.9999";
   #dscaw024#4 = 99999999999;
   #dscaw024#9 = 999;
|FRUT;

|PROCESO MarcaDesm;
   #dscaw024#7 = aMarca;
   |GRABA 020#dscaw024.a;
|FPRC;

|DEFBUCLE MarcaDesm;
   #dscaw024#1;
   ;
   INICIO;
   FINAL;
   ;
   NULL, MarcaDesm;
|FIN;

|PROCESO Teclas; |TIPO 11;
   nTecla = FSalida;
   Divisa = #dscaw024#6; |HAZ TomaDecim; |PULSATECLA;
   |SI nTecla = 10;
      |SI #dscaw024#7 = "*";
         #dscaw024#7 = " ";
      |SINO;
         #dscaw024#7 = "*";
      |FINSI;
      |PINTA #dscaw024#7;
      |GRABA 020#dscaw024.a;
      |SI nClave ! 1; |ERROR; |FINSI;
   |FINSI;
   |SI nTecla = 11;
      nSwCambio = 1;
      |SI nClave = 1; nClave = 2; aAlfa = " Ordenado por importes      "; |VETE Fin; |FINSI;
      |SI nClave = 2; nClave = 3; aAlfa = " Ordenado por bancos        "; |VETE Fin; |FINSI;
      |SI nClave = 3; nClave = 4; aAlfa = " Ordenado por fecha emision "; |VETE Fin; |FINSI;
      |SI nClave = 4; nClave = 5; aAlfa = " Ordenado por fecha Vto.    "; |VETE Fin; |FINSI;
      |SI nClave = 5; nClave = 1; aAlfa = " Ordenado por pagare        "; |VETE Fin; |FINSI;
      |ET Fin;
      |ERROR; |PTEC 807;
   |FINSI;
   |SI nTecla = 16;
      |SI #dscaw024#7 = "*";
         aMarca = " ";
      |SINO;
         aMarca = "*";
      |FINSI;
      |SALVA_FICHA #dscaw024;
      |BUCLE MarcaDesm;
      |REPON_FICHA #dscaw024;
      |PONCONTROL 23, "si";
   |FINSI;
|FPRC;

|PROCESO Ejecuta;
     |CLS;
     |HAZ Tipo8;

     |ABRE #dscam051;
     |LEE 010#dscam051.p;
     |SI FSalida ! 0;
        |DDEFECTO #dscam051;
        |GRABA 020#dscam051.n;
     |FINSI;
     |CIERRA #dscam051;

     |DDEFECTO #dscaz020;
     |SI HayConta = 1; |Y #dscam051#1 = "S";
        |C_M #dscaz020#4,1,"S";
        #dscaz020#4 = #dscam051#27;
     |SINO;
        |C_M #dscaz020#4,1,"N";
        #dscaz020#4 = "    ";
     |FINSI;

     fFechaVto = "01.01.0000";
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
        |ABRE #dscam014; |ABRE #dscam008; |ABRE #dscam009;
        |ABRE #dscam021; |ABRE #dscam022;

        |SI #dscam051#129 = "S";
           aAlfa = "    N" + &191 + " Desea la edicion de los pagares seleccionados ?";
           |CONFI aAlfa;
        |SINO;
           FSalida = 0;
        |FINSI;
        |SI FSalida = 0;
           aAlfa = "    S" + &191 + " Marcar todos los registros ?";
           |CONFI aAlfa;
           |SI FSalida = 0;
              aMarca = "*";
           |SINO;
              aMarca = " ";
           |FINSI;
           |DELINDEX #dscaw024;
           |ABRE #dscaw024; |BUCLE RellenaTempo; |CIERRA #dscaw024;
           aMarca = " ";
           |PUSHV 0501 2380;
           nSwCambio = 1; nClave = 1; aAlfa = " Ordenado por pagare        ";
           |PARA; |SI nSwCambio = 1; |HACIENDO;
              |ATRI R; |PINTA 810, aAlfa; |ATRI N;
              nSwCambio = 0;
              |SI nClave = 5; |ENTLINEAL #5#dscaw024,-2,2,17,1,infw024,supw024; |VETE Final; |FINSI;
              |SI nClave = 4; |ENTLINEAL #4#dscaw024,-2,2,17,1,infw024,supw024; |VETE Final; |FINSI;
              |SI nClave = 3; |ENTLINEAL #3#dscaw024,-2,2,17,1,infw024,supw024; |VETE Final; |FINSI;
              |SI nClave = 2; |ENTLINEAL #2#dscaw024,-2,2,17,1,infw024,supw024; |VETE Final; |FINSI;
              |SI nClave = 1; |ENTLINEAL #1#dscaw024,-1,2,17,1,infw024,supw024; |VETE Final; |FINSI;
              |ET Final;
           |SIGUE;
           |POPV; nSwTempo = 0;
           |CONFI "    N¨ Conforme con los datos editados ?";
           |SI FSalida = 0;
                 |SUB_EJECUTA_NP "dscaz169.tab;INICIO";

                 nSwTempo = 1;
                 |BUCLE Temporal;

                 |SUB_EJECUTA_NP "dscaz169.tab;FINAL";
           |FINSI;
        |SINO;
           aAlfa = "    " + &191 + " Desea enlazar el vencimiento de los pagares seleccionados ?";
           |CONFI aAlfa;
           |SI FSalida = 0;
              FechaCont = #dscaz020#5;
              |SI FechaCont = "00.00.0000"; FechaCont = ""; |FINSI;

              |SUB_EJECUTA_NP "dscaz169.tab;INICIO";

              |BUCLE VtoPagares;

              |SUB_EJECUTA_NP "dscaz169.tab;FINAL";
           |FINSI;
        |FINSI;

        |CIERRA #dscam022; |CIERRA #dscam021; |CIERRA #dscam009;
        |CIERRA #dscam008; |CIERRA #dscam014;

     |FINSI;
     |HAZ Tipo9;
|FPRC;

|PROCESO MiraFecha; |TIPO 7;
   |SI FSalida = 2; |ACABA; |FINSI;
   |SI #dscam051#106 = "S";
      aAlfa = "    " + #dscam051#107;
      aAlfa = aAlfa + "Usar como fecha contable la fecha de Vto.? ";
      |CONFI aAlfa;
   |SINO;
      |SI #dscam051#107 = "S";
         FSalida = 0;
      |SINO;
         FSalida = 1;
      |FINSI;
   |FINSI;
   |SI FSalida = 0;
      #dscaz020#5 = "00.00.0000"; |PINTA #dscaz020#5;
      |C_M #dscaz020#5, 1, "N";
   |SINO;
      #dscaz020#5 = ~; |PINTA #dscaz020#5;
      |C_M #dscaz020#5, 1, "S";
   |FINSI;
|FPRC;

|PROCESO MiraParam; |TIPO 7;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#1 = "S";
      Comodin = #dscam051#61;
      |C_M #dscaz020#4,1,Comodin;
   |SINO;
      |C_M #dscaz020#4,1,"N";
   |FINSI;
|FPRC;

|PROCESO Tipo12z020; |TIPO 12;
|FPRC;

|PROGRAMA;
     |ABRE #0;
     |LEE 000#0p;
     |SI FSalida = 0;
          aAlfa = "0000Bloqueado por: [" + #0#7; |QBF aAlfa;
          aAlfa = aAlfa + "] el " + #0#8 + " a las " + #0#9;
          |MENAV  aAlfa;
     |SINO;
          aAlfa = Usuario % 810;
          #0#7 = aAlfa;
          #0#8 = ~;
          |HORA aAlfa;
          #0#9 = aAlfa;
          |GRABA 020#0n;
          |HAZ Ejecuta;
          |BORRA 020#0c;
     |FINSI;
     |CIERRA #0;
|FPRO;
