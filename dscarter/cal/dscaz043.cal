|FICHEROS;
   dscaz043 #0;

   dscam067 #1;
   dscaw031 #2;

   dscam003 #3;
   dscam004 #4;
|FIN;

|VARIABLES;
   &aInforme = "";

   &Mensaje = "";
   FEstado = 0;
|FIN;

|PROCESO Temporal;

   |SI #dscam003#14 = "A"; |O #dscam003#14 = "D"; |ACABA; |FINSI;
   |SI #dscam003#47 = "S"; |ACABA; |FINSI;

   |SELECT #2#dscaw031;
   #dscaw031#1 = #dscam003#27;
   #dscaw031#2 = #dscam003#0;
   #dscaw031#3 = #dscam003#1;
   #dscaw031#4 = #dscam003#2;
   #dscaw031#5 = "N";
   |LEE 000#dscaw031.];
   |SI FSalida = 0; |Y #dscaw031#1 = #dscam003#27; |Y #dscaw031#2 = #dscam003#0;
    |Y #dscaw031#2 = #dscam003#0; |Y #dscaw031#3 = #dscam003#1; |Y #dscaw031#4 = #dscam003#2;
       |SI #dscaw031#5 = "N";
          FEstado = 0;
       |SINO;
          FEstado = 111;
       |FINSI;
   |SINO;
       FEstado = 111;
   |FINSI;
   |SELECT #1#dscaw031;

   |SI FEstado = 0;
      #dscaw031#1 = #dscam003#40;
      |LEE 000#dscaw031.=;
      |SI FSalida = 0;
         Mensaje = ("00"     + #dscam003#27) % -102;
         Mensaje = Mensaje + "/" + ("     "  + #dscam003#0)  % -105;
         Mensaje = Mensaje + "/" + ("000000" + #dscam003#1)  % -106;
         Mensaje = Mensaje + "/" + ("000"    + #dscam003#2)  % -103;
         Mensaje = Mensaje + " (" + (("000000000" + #dscam003#40) % -109) + "/";
         Mensaje = Mensaje +        (("000000000" + #dscaw031#0)  % -109) + ")";
         Mensaje = Mensaje + ". Recibo repetido";

         #dscam004#17 = #dscam003#40; #dscam004#3  = 1;
         |LEE 000#dscam004.];
         |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
            |SI #dscaw031#6 = "N";
               Mensaje = Mensaje + " que no se puede procesar automaticamente";
               #dscaw031#5 = "N"; |GRABA 020#dscaw031.a;
               |DDEFECTO #dscaw031;
               #dscaw031#0 = #dscam003#40;
               #dscaw031#1 = #dscam003#27;
               #dscaw031#2 = #dscam003#0;
               #dscaw031#3 = #dscam003#1;
               #dscaw031#4 = #dscam003#2;
               #dscaw031#5 = "S";
               #dscaw031#6 = "N";
               |GRABA 020#dscaw031.n;
            |SINO;
               #dscaw031#5 = "S"; |GRABA 020#dscaw031.a;
               |DDEFECTO #dscaw031;
               #dscaw031#0 = #dscam003#40;
               #dscaw031#1 = #dscam003#27;
               #dscaw031#2 = #dscam003#0;
               #dscaw031#3 = #dscam003#1;
               #dscaw031#4 = #dscam003#2;
               #dscaw031#5 = "N";
               #dscaw031#6 = "N";
               |GRABA 020#dscaw031.n;
            |FINSI;
         |SINO;
            |DDEFECTO #dscaw031;
            #dscaw031#0 = #dscam003#40;
            #dscaw031#1 = #dscam003#27;
            #dscaw031#2 = #dscam003#0;
            #dscaw031#3 = #dscam003#1;
            #dscaw031#4 = #dscam003#2;
            #dscaw031#5 = "S";
            #dscaw031#6 = "S";
            |GRABA 020#dscaw031.n;
         |FINSI;
         |PRINT;
      |FINSI;
   |SINO;
      |DDEFECTO #dscaw031;
      #dscaw031#0 = #dscam003#40;
      #dscaw031#1 = #dscam003#27;
      #dscaw031#2 = #dscam003#0;
      #dscaw031#3 = #dscam003#1;
      #dscaw031#4 = #dscam003#2;
      #dscaw031#5 = "N";
      #dscam004#17 = #dscam003#40;
      #dscam004#3  = 1;
      |LEE 000#dscam004.];
      |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
         #dscaw031#6 = "N";
      |SINO;
         #dscaw031#6 = "S";
      |FINSI;
      |GRABA 020#dscaw031.n;
   |FINSI;
|FPRC;

|DEFBUCLE Temporal;
#dscam003#1;
;
INICIO;
FINAL;
;
NULL,Temporal;
|FIN;

|PROCESO Cambios;
   |SI #dscaw031#6 = "S";
      #dscam003#40 = #dscaw031#0;
      |LEE 000#dscam003.=;
      |SI FSalida = 0; |BORRA 020#dscam003.a; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Cambios;
#dscaw031#1;
;
INICIO;
FINAL;
;
NULL,Cambios;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA "Recalculo cartera";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0; |Y #0#1 = "S";
      |IMPRE 0;
      |SI FSalida ! 0; |ACABA; |FINSI;
/*
      aInforme = "Informe Recalculo Cartera";
      |HAZ ObtenInforme; |INFOR aInforme;
*/
      |INFOR "dscaz043";
      |SI FSalida ! 0; |ACABA; |FINSI;
      |DELINDEX #dscaw031; |ABRE #dscaw031; |ABRE #dscam004; |ABRE #dscam003;
      |BUCLE Temporal;
      |SI #dscaz043#0 = "S"; |BUCLE Cambios; |FINSI;
      |CIERRA #dscaw031; |CIERRA #dscam004; |CIERRA #dscam003;
      |PIEINF; |FININF; |FINIMP;
   |FINSI;
|FPRO;
