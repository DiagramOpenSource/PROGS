|FICHEROS;
   dscaz086 #0;

   dscam081 #10;
   dscam082 #11;
   dscam030 #12;
   dscam003 #13;
   dscam004 #14;
   dscaw013 #17;
   dscaw001 #18,MANTE;
   dscam051 #20;

   &cacuent@ #492;
|FIN;

|VARIABLES;
   &eaTipo  = 1;
   &aCuenta = ""; &nNivel = 0; &HayConta = 0; &MaxDigit = 0;
   &Divisa  = ""; &nDeci_Div = 0; &nDeci_Base = 0;
   &CambioBaseVn = 0; &enRemesa = 1; &eaModulo = "";
   &eaFichClas = "";  &eaTipoClas = ""; &enSwClas = 0;
   &enSwLineal = 0; &enClave = 0;  &eaSesion = "";
   &eaTOperacion = ""; &enNumDocum   = 0;

   aEnv    = "";
   aAlfa    = "";
   aAlfa1   = "";
   aParte1  = "";
   aParte2  = "";
   aLong    = "";
   Comodin  = "";
   aTitulo  = "";

   FEstado  = 0;
   Linea    = 1;
   nLong    = 0;
   LinCob   = 0;
   nTecla   = 0;
   nCalc    = 0;
   nHayCtas = 0;
   nNumSec  = 0;
   nSw      = 0;
|FIN;

|PROCESO ConsCtas; |TIPO 6;
   nTecla = FSalida;
   |SI HayConta = 1; |Y #dscaz086#6 ! "    ";
      |SI nTecla = 10;
         #cacuent@#0 = #dscaz086#7;
         |LEE 000#cacuent@.];
         |CONSULTA_CLAVE #1#cacuent@;
         |SI FSalida = 0;
            #dscaz086#7 = #cacuent@#0; |PINTA #dscaz086#0;
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;
      aCuenta = #dscaz086#7;
      aCuenta = aCuenta - ".";
      |PARA; |SI FSalida ! 0; |HACIENDO;
         nCalc = ((FSalida / 100) ! 0) + 99; aParte1 = aCuenta % nCalc; |QBF aParte1;
         nCalc = FSalida + 98;               aParte2 = aCuenta % nCalc; |QBF aParte2;
         aCuenta = aParte1 + aParte2; |QBF aCuenta;
         aLong = aCuenta % 0; nLong = aLong;
         nCalc = MaxDigit - nLong;
         aCuenta = aParte1 + ("0" * nCalc) + aParte2;
         aCuenta = aCuenta - ".";
      |SIGUE;
      #dscaz086#7 = aCuenta; |PINTA #dscaz086#7;
      #cacuent@#0 = #dscaz086#7;
      aCuenta = #dscaz086#7; |HAZ SacaNivel;
      #cacuent@#1 = nNivel;
      |LEE 000#cacuent@.=;
      |SI FSalida = 0;
         |PINTA 1735, #cacuent@#2;
      |SINO;
         |MENAV "    Cuenta inexistente"; |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Documentos;
   |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "C"; |Y #dscam003#14 ! "I"; |ACABA; |FINSI;

   |SI #dscam003#30 < 0; |ACABA; |FINSI;

   enSwClas   = 1; eaFichClas = "dscaz086"; eaTipoClas = #dscam003#12;
   |HAZ CompruebaClas;
   |SI eaFichClas = "ERROR"; |ACABA; |FINSI;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   |DDEFECTO #dscaw001;
   #dscaw001#0 = Linea;
   Linea = Linea + 1;
   #dscaw001#1 = #dscam003#27;
   #dscaw001#2 = #dscam003#0;
   #dscaw001#3 = #dscam003#1;
   #dscaw001#4 = #dscam003#2;
   #dscaw001#5 = #dscam003#3;
   #dscaw001#6 = #dscam003#65;
   #dscaw001#7 = " ";
   #dscaw001#8 = #dscam003#40;
   #dscaw001#9 = #dscam003#57;
   #dscaw001#10 = #dscam003#5;
   #dscaw001#11 = #dscam003#32;
   #dscaw001#12 = #dscam003#6;
   #dscaw001#13 = #dscam003#14;
   #dscaw001#14 = #dscam003#35;
   #dscaw001#15 = #dscam003#36;
   |GRABA 010#dscaw001.n;
|FPRC;

|DEFBUCLE Documentos;
#dscam003#11;
4,93,29;
#dscaz086#0,#dscaz086#2,"   ",#dscaz086#1,aEnv,"N";
#dscaz086#3,#dscaz086#5,"zzz",#dscaz086#4,aEnv,"N";
be;
NULL,Documentos;
|FIN;

|PROCESO VuelcaDocs;
   #dscam003#40 = #dscaw001#8; |LEE 000#dscam003.=;

   |SELECT #2#dscam082;
   #dscam082#1 = #dscam003#12;
   |LEE 000#dscam082.=;
   |SI FSalida ! 0; |DDEFECTO #dscam082; |FINSI;
   |SELECT #1#dscam082;
   |LEE 000#dscam082.=;
   |SI FSalida = 0;
      #dscam081#0 = #dscam082#0;
      |LEE 000#dscam081.=;
      |SI FSalida = 0;
         |SI #dscam081#2 = "A";
            #dscam003#40 = #dscaw001#8;
            |LEE 101#dscam003.=;

            Divisa = #dscam003#57; |HAZ TomaDecim;

            #dscam004#17 = #dscam003#40;
            #dscam004#3 = 99;
            |LEE 000#dscam004.];
            |SI FSalida ! 0;
               |LEE 000#dscam004.u;
               |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
                  LinCob = #dscam004#3 + 1;
               |SINO;
                  LinCob = 1;
               |FINSI;
            |SINO;
               |SI #dscam004#17 = #dscam003#40;
                  LinCob = #dscam004#3 + 1;
               |SINO;
                  |LEE 000#dscam004.a;
                  |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40;
                     LinCob = #dscam004#3 + 1;
                  |SINO;
                     LinCob = 1;
                  |FINSI;
               |FINSI;
            |FINSI;

            |DDEFECTO #dscam004;
            #dscam004#17 = #dscam003#40;
            #dscam004#15 = #dscam003#27;
            #dscam004#0  = #dscam003#0;
            #dscam004#1  = #dscam003#1;
            #dscam004#2  = #dscam003#2;
            #dscam004#3  = LinCob;
            #dscam004#4  = #dscaz086#6;
            |SI nSw = 1;
               #dscam004#5  = "ENV";
            |SINO;
               #dscam004#5  = "ACE";
            |FINSI;
            #dscam004#6  = ~;
            #dscam004#11 = #dscam003#13;
            #dscam004#33 = CambioBaseVn;
            #dscam004#43 = nNumSec;
            #dscam004#44 = 0;
            #dscam004#45 = 0;
            #dscam004#46 = 0;
            #dscam004#47 = 0;
            |GRABA 020#dscam004.n; |LEE 000#dscam004.=

            |SI nSw = 1;
               #dscam003#14 = "V";
               #dscam003#15 = "Recibo enviado al cliente";
               #dscam003#93 = "S";
               #dscam003#95 = #dscaz086#6;
               #dscam003#90 = "N";
            |SINO;
               #dscam003#14 = "P";
               #dscam003#15 = "Recibo aceptado";
               #dscam003#29 = "S";
               #dscam003#96 = #dscaz086#6;
               #dscam003#90 = "S";
            |FINSI;
            |GRABA 020#dscam003.a; |LIBERA #dscam003;
         |FINSI;
      |FINSI;
   |FINSI;

   |SI HayConta = 1; |Y nNumSec = 0; |Y #dscaz086#6 ! "    ";
      Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
      |NOME_DAT #17 Comodin;
      |DELINDEX #dscaw013; |ABRE #dscaw013;
      #dscaw013#15 = #dscaz086#6;  #dscaw013#0  = 1;
      #dscaw013#13 = "dscam004";   #dscaw013#14 = 17;
      #dscaw013#5 = #dscam003#40;  #dscaw013#6  = #dscam003#40;
      #dscaw013#11 = "N";          #dscaw013#12 = 9;
      |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
      #dscaw013#15 = #dscaz086#6;  #dscaw013#0  = 2;
      #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
      |SI nSw = 1;
         #dscaw013#3 = "ENV";         #dscaw013#4  = "ENV";
      |SINO;
         #dscaw013#3 = "ACE";         #dscaw013#4  = "ACE";
      |FINSI;
      #dscaw013#11 = "A";          #dscaw013#12 = 3;
      |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
      #dscaw013#15 = #dscaz086#6;  #dscaw013#0  = 3;
      #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
      #dscaw013#7 = ~;             #dscaw013#8  = ~;
      #dscaw013#11 = "F";          #dscaw013#12 = 10;
      |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
      Comodin = #dscaz086#6; |QBF Comodin;
      Comodin = "dscam033.tab;" + Comodin;
      |CIERRAT #dscam003; |CIERRAT #dscam004;
      |SUB_EJECUTA_NP Comodin; |DELINDEX #dscaw013;
      |ABRET #dscam003; |ABRET #dscam004;
   |FINSI;
|FPRC;

|DEFBUCLE VuelcaDocs;
#dscaw001#1;
7;
00001,"*";
99999,"*";
;
NULL,VuelcaDocs;
|FIN;

|RUTINA inf001;
   #dscaw001#0 = 1;
   #dscaw001#10 = "";
   #dscaw001#11 = "";
|FRUT;

|RUTINA sup001;
   #dscaw001#0 = 99999;
   #dscaw001#10 = "zzzzzzzzzzzz";
   #dscaw001#11 = "zzzzzz";
|FRUT;


|RUTINA inf01a;
   #dscaw001#0 = 1;
   #dscaw001#10 = "";
   #dscaw001#11 = "";
|FRUT;

|RUTINA sup01a;
   #dscaw001#0 = 99999;
   #dscaw001#10 = "zzzzzzzzzzzz";
   #dscaw001#11 = "zzzzzz";
|FRUT;

|RUTINA inf01b;
   #dscaw001#0 = 1;
   #dscaw001#5 = "01.01.0000";
|FRUT;

|RUTINA sup01b;
   #dscaw001#0 = 99999;
   #dscaw001#5 = "31.12.9999";
|FRUT;

|PROCESO MiraParam; |TIPO 7;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0;
      |DDEFECTO #dscam051;
      |GRABA 020#dscam051.n;
      |LEE 000#dscam051.p;
   |FINSI;
   |CIERRA #dscam051;

   Comodin = #dscam051#61;
   |C_M #dscaz086#6,1,Comodin;
|FPRC;

|PROCESO Desbloquea;
   eaTOperacion = "B"; enNumDocum = #dscaw001#8; |HAZ ProcesaTempo;
|FPRC;

|DEFBUCLE Desbloquea;
#dscaw001#1;
;
INICIO;
FINAL;
;
NULL, Desbloquea;
|FIN;

|PROGRAMA;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0; |DDEFECTO #dscam051; |FINSI;
   |CIERRA #dscam051;

   |SI #dscam051#47 = "N";
      |MENAV "    Opcion de uso exclusivo con perfiles";
      |ERROR; |ACABA;
   |FINSI;

   |SI PARAMETRO = "ENVIO";
      aTitulo = " ENVIO DOCUMENTOS PARA ACEPTADO ";
      aEnv = "N"; nSw = 1;
   |SINO;
      aTitulo = " ACEPTADO DE DOCUMENTOS ";
      aEnv = "S"; nSw = 2;
   |FINSI;

   |HAZ Tipo8;

   eaModulo = "dscaz086";

   |CLS;
   |CABEZA aTitulo;
   |PINPA #0#dscaz086; |PINDA #0#dscaz086;
   |ATRI R; |PINTA 0605, aTitulo; |ATRI N;
   |ENDATOS #1#dscaz086;
   |SI FSalida = 0;
      |ABRE #dscam081; |ABRE #dscam082;
      |ABRE #dscam004; |ABRE #dscam003; |ABRE #dscam030;
      aAlfa = "tm" + Usuario; |NOME_DAT #18 aAlfa;
      |DELINDEX #dscaw001; |ABRE #dscaw001;

      #dscam030#0 = #dscaz086#6;
      |LEE 000#dscam030.=;
      |SI FSalida ! 0; |DDEFECTO #dscam030; |FINSI;
      |SI #dscam030#8 = "S";
         |SELECT #3#dscam004;
         |LEE 000#dscam004.u;
         |SI nNumSec [ #dscam004#43;
            nNumSec = #dscam004#43 + 1;
         |SINO;
            nNumSec = nNumSec + 1;
         |FINSI;
         |SELECT #1#dscam004;
      |SINO;
         nNumSec = 0;
      |FINSI;

      |BUCLE Documentos;

      |PUSHV 05012380;
      enSwLineal = 1; enClave = 1;
      |PARA; |SI enSwLineal ! 0; |HACIENDO;
         |SI enClave = 1; enSwLineal = 0; |ENTLINEAL #2#dscaw001,-3,4,17,1,inf01a,sup01a; |FINSI;
         |SI enClave = 2; enSwLineal = 0; |ENTLINEAL #3#dscaw001,-2,4,17,1,inf01b,sup01b; |FINSI;
      |SIGUE;
      FEstado = FSalida;
      |POPV;
      |SI FEstado = 0;
         |CONFI "    NConforme con el volcado de los datos ? ";
         |SI FSalida = 0;
            |BUCLE VuelcaDocs;
         |FINSI;
      |FINSI;
      |CIERRA #dscam003; |CIERRA #dscam004;
      |BUCLE Desbloquea;
      |CIERRA #dscaw001; |DELINDEX #dscaw001;

      |SI HayConta = 1; |Y nNumSec ! 0; |Y #dscaz086#6 ! "    ";
         Comodin = Usuario; |QBF Comodin; Comodin = "ac" + Comodin;
         |NOME_DAT #17 Comodin;
         |DELINDEX #dscaw013; |ABRE #dscaw013;
         #dscaw013#15 = #dscaz086#6;  #dscaw013#0  = 1;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 43;
         #dscaw013#5 = nNumSec;       #dscaw013#6  = nNumSec;
         #dscaw013#11 = "N";          #dscaw013#12 = 10;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         #dscaw013#15 = #dscaz086#6;  #dscaw013#0  = 2;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 5;
         |SI nSw = 1;
            #dscaw013#3 = "ENV";         #dscaw013#4  = "ENV";
         |SINO;
            #dscaw013#3 = "ACE";         #dscaw013#4  = "ACE";
         |FINSI;
         #dscaw013#11 = "A";          #dscaw013#12 = 3;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         #dscaw013#15 = #dscaz086#6;  #dscaw013#0  = 3;
         #dscaw013#13 = "dscam004";   #dscaw013#14 = 6;
         #dscaw013#7 = ~;             #dscaw013#8  = ~;
         #dscaw013#11 = "F";          #dscaw013#12 = 10;
         |GRABA 020#dscaw013.n; |LIBERA #dscaw013;
         Comodin = #dscaz086#6; |QBF Comodin;
         Comodin = "dscam033.tab;" + Comodin;
         |SUB_EJECUTA_NP Comodin; |DELINDEX #dscaw013;
      |FINSI;

      |CIERRA #dscam030;
      |CIERRA #dscam082; |CIERRA #dscam081;
   |FINSI;

   eaSesion   = Usuario; |HAZ LimpiaTempo;

   |HAZ Tipo9;
|FPRO;
