|FICHEROS;
   dscam023 #0;
   dscam024 #1;

   dscam020 #2,MANTE;
   dscam051 #3;
   dscam091 #4;
   dscam018 #5,MANTE;
   dscam215 #6,MANTE;
   dscam216 #7,MANTE;

   dscam003 #53;
   dscaw084 #55,MANTE;

   dscam038 #100;
   dscaw202 #101,MANTE;
   dscaw203 #102,MANTE;

   Referen@ #5000;
   Refere1@ #5001;
   Refere2@ #5002;
   visal000@ #902;
|FIN;

|VARIABLES;
   nSal = 0;
   &enSwPonBoton = 0;
   &enBoton = 0;

   &enCuadroIni  = 0;
   &enCuadroFin  = 0;
   &eaTitulo     = "";

   &TipoCliente = ""; &CodCliente = ""; &Nombre = "";
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = ""; &eaFicher = ""; &eaClave = "";
   &Divisa = "";

   nLinea   = 1;

   Comodin = "";
   ModoEntrada = 0; Borra = 0; nImpAnt = 0;
   nTecla  = 0;
   nCalc   = 0;
   Modulo = "";
   aAlfa = "";
   nSw      = 0;
   nSwOp    = 0;

    aQueQuiero = "";
    aNumCampos = "";
    nNumCampos = 0;
    aEmpresa   = "";
    aBase      = "";
    aMas       = "";
    aFich      = "";
    nSwTag     = 0;

{-1}aMenuOpc  = "";
    aMenuOpc1 = "2400";
    aMenuOpc2 = "1";
    aMenuOpc3 = "";
    aMenuOpc4 = "OFP";
    aMenuOpc5 = "Observaciones";
    aMenuOpc6 = "Ficha global ";
    aMenuOpc7 = "formas de Pago no permitidas ";

    nOpcion = 0;
    nTotalDispo  = 0;
    nTotalUsado  = 0;
    nTotalRiePed = 0;
    nTotalRieAlb = 0;
    nTotalRieFra = 0;
    nTotalRieBan = 0;
    nTotalRieEnt = 0;
    nTotalRieImp = 0;
|FIN;

|RUTINA infm091;
   #dscam091#0 = #dscam023#0;
   #dscam091#1 = #dscam023#2;
   #dscam091#2 = 01;
|FRUT;

|RUTINA supm091;
   #dscam091#0 = #dscam023#0;
   #dscam091#1 = #dscam023#2;
   #dscam091#2 = 99;
|FRUT;

|PROCESO Recalc2;
   #dscam024#9 = #dscam023#19 - #dscam023#20;
   |GRABA 020#dscam024.a;
   |SI Borra = 1; |BORRA 020#dscam024.a; |FINSI;
|FPRC;

|DEFBUCLE Recalc2;
#dscam024#1;
;
#dscam023#0,001;
#dscam023#0,999;
be;
NULL,Recalc2;
|FIN;

|PROCESO Recalc1;
   #dscam038#5 = #48#0
   #dscam038#6 = #dscam024#1;
   #dscam038#0 = 0;
   #dscam038#1 = 1;
   |LEE 000#dscam038.];
   |SI FSalida = 0; |Y #dscam038#5 = #48#0; |Y #dscam038#6 = #dscam024#1;
      |SI #dscam038#8 = "R";
         #dscam023#20 = #dscam023#20 + #dscam024#8; |PINTA #dscam023#20;
         |GRABA 020#dscam023.a;
      |FINSI;
   |FINSI;
   |SI Borra = 1; |BORRA 020#dscam024.a; |FINSI;
|FPRC;

|DEFBUCLE Recalc1;
#dscam024#1;
;
#dscam023#0,001;
#dscam023#0,999;
be;
NULL,Recalc1;
|FIN;

|PROCESO ComprExp;
   |HAZ EsArtenvas;
   |SI FSalida ! 0;
      |ABRE #dscam020;
      #dscam020#0 = #dscam023#2;
      #dscam020#2 = #dscam023#5;
      |LEE 000#dscam020.=;
      |SI FSalida = 0;
         #dscam023#2 = #dscam020#0;   |PINTA #dscam023#2;
         #dscam023#3 = #dscam020#1;   |PINTA #dscam023#3;
         #dscam023#5 = #dscam020#2;   |PINTA #dscam023#5;
         #dscam023#7 = #dscam020#18;  |PINTA #dscam023#7;
         #dscam023#8 = #dscam020#19;  |PINTA #dscam023#8;
         #dscam023#12 = #dscam020#14; |PINTA #dscam023#12;
         #dscam023#11 = #dscam020#15; |PINTA #dscam023#11;
         #dscam023#14 = #dscam020#16; |PINTA #dscam023#14;
         #dscam023#13 = #dscam020#17; |PINTA #dscam023#13;
         #dscam023#19 = #dscam023#13 + #dscam023#15 + #dscam023#17;
         |PINTA #dscam023#19;
         #dscam023#20 = 0; |BUCLE Recalc1; |BUCLE Recalc2;
      |FINSI;
      |CIERRA #dscam020;
   |SINO;
      |ABRE #dscam215;
      #dscam215#0 = #dscam023#2;
      #dscam215#2 = #dscam023#5;
      |LEE 000#dscam215.=;
      |SI FSalida = 0;
         #dscam023#2 = #dscam215#0;   |PINTA #dscam023#2;
         #dscam023#3 = #dscam215#1;   |PINTA #dscam023#3;
         #dscam023#5 = #dscam215#2;   |PINTA #dscam023#5;
         #dscam023#7 = #dscam215#18;  |PINTA #dscam023#7;
         #dscam023#8 = #dscam215#19;  |PINTA #dscam023#8;
         #dscam023#12 = #dscam215#14; |PINTA #dscam023#12;
         #dscam023#11 = #dscam215#15; |PINTA #dscam023#11;
         #dscam023#14 = #dscam215#16; |PINTA #dscam023#14;
         #dscam023#13 = #dscam215#17; |PINTA #dscam023#13;
         #dscam023#19 = #dscam023#13 + #dscam023#15 + #dscam023#17;
         |PINTA #dscam023#19;
         #dscam023#20 = 0; |BUCLE Recalc1; |BUCLE Recalc2;
      |FINSI;
      |CIERRA #dscam215;
   |FINSI;
|FPRC;

|PROCESO RecogeRecs;
   |SI #dscam003#14 ! "P"; |Y #dscam003#14 ! "C"; |Y #dscam003#14 ! "R"; |Y #dscam003#14 ! "I";
      |ACABA;
   |FINSI;

   |SI nSwOp = 2; #dscam023#21 = #dscam023#21 + 1; |ACABA; |FINSI;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   |DDEFECTO #dscaw084;
   #dscaw084#0 = nLinea; nLinea = nLinea + 1;
   #dscaw084#1 = #dscam003#40;
   #dscaw084#2 = #dscam003#0;
   #dscaw084#3 = #dscam003#1;
   #dscaw084#4 = #dscam003#2;
   #dscaw084#5 = #dscam003#4;
   #dscaw084#6 = #dscam003#31;
   |GRABA 020#dscaw084.n;
|FPRC;

|DEFBUCLE RecogeRecs;
#dscam003#11;
;
#dscam023#0, "01.01.0000", "     ";
#dscam023#0, "31.12.9999", "zzzzz";
;
NULL,RecogeRecs;
|FIN;

|PROCESO TomaDefectos; |TIPO 7;
   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |CIERRA #dscam051;
   Comodin = #dscam051#6;

   |HAZ EsArtenvas;
   |SI FSalida = 0;
     Comodin = "N";
   |FINSI;

   |C_M #dscam023#2,1,Comodin; |C_M #dscam023#5,1,Comodin;
|FPRC;

|PROCESO MiraExpedte; |TIPO 6;
   |SI FSalida = 10;
      |PUSHV 1342 2275;
      |ENTLINEAL #1#dscam091,3,1,21,1,infm091,supm091;
      |POPV;
      |ERROR; |ACABA;
   |FINSI;

   aAlfa = #dscam023#5; |QBF aAlfa;
   |SI #dscam051#6 = "N"; |O aAlfa = ""; |ACABA; |FINSI;

   |HAZ EsArtenvas;
   |SI FSalida ! 0;
      |ABRE #dscam020;
      #dscam020#0 = #dscam023#2;
      #dscam020#2 = #dscam023#5;
      |LEE 000#dscam020.=;
      |SI FSalida = 0;
         |SI #dscam020#4 ! #dscam023#0;
            |MENAV "    El expediente seleccionado no es de este cliente.";
            |ERROR;
         |FINSI;
      |SINO;
         enSwPonBoton = 1;
         |PUSHV 0501 2380;
         |PINPA #0#dscam020; |PINDA #0#dscam020;
         |CONFI "    NEl expediente no existe. Dar de alta ? ";
         |SI FSalida = 0;
            |DDEFECTO #dscam020;
            #dscam020#0 = #dscam023#2;
            #dscam020#2 = #dscam023#5;
            |GRABA 020#dscam020.b;

            |ENDATOS #1#dscam020;
            |SI FSalida = 0;
               |GRABA 020#dscam020.a;
            |SINO;
               |BORRA 020#dscam020.a;
               |ERROR;
            |FINSI;
            |LIBERA #dscam020;
            |SI #dscam020#4 ! #dscam023#0;
               |MENAV "    El expediente seleccionado no es de este cliente.";
               |ERROR;
            |FINSI;
         |SINO;
            |ERROR;
         |FINSI;
         |SI enBoton ! 0;
              |FIN_CONTROL_WINDOWS enBoton;
              enBoton = 0;
         |FINSI;
         enSwPonBoton = 0;
         |POPV;
      |FINSI;
      |CIERRA #dscam020;
   |SINO;
      |ABRE #dscam215;
      #dscam215#0 = #dscam023#2;
      #dscam215#2 = #dscam023#5;
      |LEE 000#dscam215.=;
      |SI FSalida = 0;
         |SI #dscam215#4 ! #dscam023#0;
            |MENAV "    El expediente seleccionado no es de este cliente.";
            |ERROR;
         |FINSI;
      |SINO;
         enSwPonBoton = 1;
         |PUSHV 0501 2380;
         |PINPA #0#dscam215; |PINDA #0#dscam215;
         |CONFI "    NEl expediente no existe. Dar de alta ? ";
         |SI FSalida = 0;
            |DDEFECTO #dscam215;
            #dscam215#0 = #dscam023#2;
            #dscam215#2 = #dscam023#5;
            |GRABA 020#dscam215.b;

            |ENDATOS #1#dscam215;
            |SI FSalida = 0;
               |GRABA 020#dscam215.a;
            |SINO;
               |BORRA 020#dscam215.a;
               |ERROR;
            |FINSI;
            |LIBERA #dscam215;
            |SI #dscam215#4 ! #dscam023#0;
               |MENAV "    El expediente seleccionado no es de este cliente.";
               |ERROR;
            |FINSI;
         |SINO;
            |ERROR;
         |FINSI;
         |SI enBoton ! 0;
              |FIN_CONTROL_WINDOWS enBoton;
              enBoton = 0;
         |FINSI;
         enSwPonBoton = 0;
         |POPV;
      |FINSI;
      |CIERRA #dscam215;
   |FINSI;
|FPRC;

|PROCESO MiraCompania; |TIPO 6;
   |SI #dscam051#6 = "N"; |ACABA; |FINSI;

   |SI FSalida = 10;
      |ABRE #dscam018;
      #dscam018#0 = #dscam023#2;
      |LEE 000#dscam018.];
      |CONSULTA_CLAVE #1#dscam018;
      |SI FSalida = 0;
         #dscam023#2 = #dscam018#0; |PINTA #dscam023#2;
         #dscam023#3 = #dscam018#1; |PINTA #dscam023#3;
      |FINSI;
      |CIERRA #dscam018;
      |ERROR;
   |FINSI;

   |SI #dscam023#2 ! 0;
      |C_M #dscam023#23, 1, "N"; #dscam023#23 = 00; |PINTA #dscam023#23; |HAZ MiraTm023;
      |C_M #dscam023#5, 1, "S";

      |HAZ EsArtenvas;
      |SI FSalida = 0;
          |C_M #dscam023#5, 1, "N";
      |FINSI;
      |ABRE #dscam018;
      #dscam018#0 = #dscam023#2;
      |LEE 000#dscam018.=;
      |SI FSalida ! 0;
         |PUSHV 0501 2380;
         |PINPA #0#dscam018; |PINDA #0#dscam018;
         |CONFI "    NLa compa¤ia no existe. Dar de alta ? ";
         |SI FSalida = 0;
            |DDEFECTO #dscam018;
            #dscam018#0 = #dscam023#2;
            |GRABA 020#dscam018.b;

            |ENDATOS #1#dscam018;
            |SI FSalida = 0;
               |GRABA 020#dscam018.a;
            |SINO;
               |BORRA 020#dscam018.a;
               |ERROR;
            |FINSI;
            |LIBERA #dscam018;
         |SINO;
            |ERROR;
         |FINSI;
         |POPV;
      |FINSI;
      #dscam023#3 = #dscam018#1; |PINTA #dscam023#3;
      |CIERRA #dscam018;
   |SINO;
      |C_M #dscam023#5, 1, "N"; #dscam023#5 = ""; |PINTA #dscam023#5;
      |C_M #dscam023#23, 1, "S";
   |FINSI;
|FPRC;

|PROCESO Client1;
   |SI FSalida = 2; |ACABA; |FINSI;
   nTecla = FSalida;

   TipoCliente = "G";
   CodCliente  = #dscam023#Campo#;
   |HAZ ExisteCliente;
   |SI TipoCliente = "ERROR";
      |ERROR;
   |SINO;
      #dscam023#0 = CodCliente; |PINTA #dscam023#0;
      #dscam023#1 = Nombre;     |PINTA #dscam023#1;
      |LEE 101#dscam023.=;
      |SI FSalida = 0;
         #dscam023#1 = Nombre;
         #dscam023#21 = 0; nSwOp = 2;
         |BUCLE RecogeRecs; nSwOp = 0;
         |GRABA 020#dscam023.a; |LIBERA #dscam023;
      |FINSI;
   |FINSI;

   |SI nTecla = 11; |HAZ RiesgoFac; |FINSI;
   |SI nTecla = 12; |HAZ RiesgoRec;  |FINSI;
   |SI nTecla = 13; |HAZ RiesgoPag;  |FINSI;
|FPRC;

|PROCESO Riesgo;
   |SI Campo = 15;
      |SI #dscam023#15 = 0;
         |C_M #dscam023#16,1,"N"; #dscam023#16 = ""; |PINTA #dscam023#16;
      |SINO;
         |C_M #dscam023#16,1,"S";
         |SI #dscam023#16 = "01.01.0000"; #dscam023#16 = ~; |FINSI;
      |FINSI;
   |FINSI;
   |SI Campo = 17;
      |SI #dscam023#17 = 0;
         |C_M #dscam023#18,1,"N"; #dscam023#18 = ""; |PINTA #dscam023#18;
      |SINO;
         |C_M #dscam023#18,1,"S";
         |SI #dscam023#18 = "01.01.0000"; #dscam023#18 = ~; |FINSI;
      |FINSI;
   |FINSI;
   #dscam023#19 = #dscam023#13 + #dscam023#15 + #dscam023#17;
   |PINTA #dscam023#19;
|FPRC;

|RUTINA inf023;
   #dscam024#0 = #dscam023#0;
   |SI FSalida = "POSICION";
      #dscam024#1 = 01;
   |SINO;
      #dscam024#1 = 01;
   |FINSI;
|FRUT;

|RUTINA sup023;
   #dscam024#0 = #dscam023#0;
   #dscam024#1 = 99;
|FRUT;

|PROCESO Lineas; |TIPO 0;
   |HAZ EsArtenvas;
   |SI FSalida = 0; |ACABA; |FINSI;

   |SALVA_DATOS #dscam023;
   |ENTLINEAL #1#dscam024,-2,1,22,1,inf023,sup023;
   |REPON_DATOS #dscam023;
|FPRC;

|PROCESO PresLin1; |TIPO 7;
   |ENTLINEAL #1#dscam024,-2,7,22,1,inf023,sup023;
|FPRC;

|PROCESO PresLin2;
   |MODULO Modulo;
   |SI Modulo = "dscam023";
      #dscam024#0 = #dscam023#0;
      #dscam024#1 = 1;
      |LEE 000#dscam024.];
      |SI FSalida ! 0; |O #dscam024#0 ! #dscam023#0; |DDEFECTO #dscam024; |FINSI;
/*
      |SI FSalida ! 0; |O #dscam024#0 ! #dscam023#0;
         |DDEFECTO #dscam024; #dscam024#1 = "  ";
         |PINTA 1442, #dscam024#1;
         |PINTA 1542, "  ";
         |PINTA 1642, "  ";
         |PINTA 1742, "  ";
         |PINTA 1842, "  ";
         |PINTA 1942, "  ";
         |PINTA 2042, "  ";
         |PINTA 2142, "  ";
         |PINTA 2242, "  ";
      |SINO;
         |ENTLINEAL #1#dscam024,-2,7,22,1,inf023,sup023;
      |FINSI;
*/
      |ENTLINEAL #1#dscam024,-2,7,22,1,inf023,sup023;
/*
      |PINTA #dscam024#2;
      |PINTA #dscam024#3;
      |PINTA #dscam024#4;
      |PINTA #dscam024#5;
      |PINTA #dscam024#6;
      |PINTA #dscam024#7;
      |PINTA #dscam024#8;
      |PINTA #dscam024#9;
*/
   |FINSI;
|FPRC;

|PROCESO EmpresaPrevencion;
     |DBASS aBase;  |QBF aMas;
     aMas = aBase + "dspreven/def/visal000.mas";

     |CARGA_DEF aMas, visal000@;
     aQueQuiero = "|NC";
     aNumCampos = #902#aQueQuiero#;
     nNumCampos = aNumCampos;
     aEmpresa   = "00001";

     |SI nNumCampos = 4;
         aFich = aBase + "dspreven/fich/";
         |PATH_DAT #902 aFich;
         |ABRE #902;
         |SELECT #2#902;
         #902#3 = "S";
         |LEE 000#902=;
         |SI FSalida = 0;
             aEmpresa = ("00000" + #902#0) % -105;
         |FINSI;
         |CIERRA #902;
     |FINSI;

     |DESCARGA_DEF #visal000@;
|FPRC;

|PROCESO CambiaDsPreven;
   |DBASS aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "dspreven/def/visalm01.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      |HAZ EmpresaPrevencion;

      aAlfa = "|NC"; aAlfa = #Referen@#aAlfa#; nCalc = aAlfa;
      |SI nCalc ] 122;
         |DBASS aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "dspreven/fich/" + aEmpresa + "/";
         |PATH_DAT #Referen@#aAlfa#;
         |ABRE #Referen@;
         #Referen@#0 = #dscam023#0;
         |LEE 101#Referen@.=;
         |SI FSalida = 0;
            |SI nSw = 1; #Referen@#121 = #dscam023#9; #Referen@#122 = #dscam023#10; |FINSI;
            |SI nSw = 2; #Referen@#121 = "N";         #Referen@#122 = "";           |FINSI;
            |GRABA 020#Referen@.a; |LIBERA #Referen@;
         |FINSI;
         |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Dat; |TIPO 13;
   |SI nSwTag = 0;
      |HAZ EsTagloma;
      nSwTag = FSalida;
      |SI nSwTag = 0;
         |CAMPO_POSICION #dscam023#7, 1, 1013;
         |CAMPO_POSICION #dscam023#8, 1, 1017;
         |CAMPO_POSICION #dscam023#9, 1, 1054;
         |CAMPO_POSICION #dscam023#10, 1, 1056;
         |CAMPO_POSICION #dscam023#24, 1, 1120;
         |C_M #dscam023#24, 1, "S"; |C_V #dscam023#24, 1, "S";
         |PINTA 1004, "º Estado                          Bloqueado S/N/A                       º";
         |PINTA 1104, "º                                                                       º";
         |ATRI I; |PINTA 1106, "Observaciones"; |ATRI N;
         |ATRI N; |PINTA 1038, "Bloque. S/N/A/X"; |ATRI N;

      |FINSI;
   |FINSI;

   |HAZ TomaDecim;
   |ABRE #dscam024;
   |HAZ PresLin2;
   |CIERRA #dscam024;
   |HAZ MiraTm023;
|FPRC;

|PROCESO Consulta;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 4;
      |LEE 000#dscam023.=;
      |SI FSalida = 0;
         |PINDA #0#0;
         |ENTLINEAL #1#dscam024,-2,4,22,1,inf023,sup023;
         |HAZ PresLin2;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO AntesRiesgo; |TIPO 7;
   nImpAnt = #dscam024#Campo#;
|FPRC;

|PROCESO RiesgoUtil;
   #dscam024#8 = #dscam024#2 + #dscam024#3 + #dscam024#4 - #dscam024#5;
   #dscam024#8 = #dscam024#8 + #dscam024#6 + #dscam024#7;
   |PINTA #dscam024#8;

   |SI #dscam024#Campo# ! nImpAnt;
      |SI enImpAnt ! 0;
         enImpAnt = nImpAnt;
         |SI Campo = 2; eaDescr = " (Riesgo de pedidos)";   |FINSI;
         |SI Campo = 3; eaDescr = " (Riesgo de albaranes)"; |FINSI;
         |SI Campo = 4; eaDescr = " (Riesgo de facturas)";  |FINSI;
         |SI Campo = 5; eaDescr = " (Saldo a su favor)";    |FINSI;
         |SI Campo = 6; eaDescr = " (Riesgo de bancos)";    |FINSI;
         |SI Campo = 7; eaDescr = " (Riesgo de impagados)"; |FINSI;
         |SI ModoEntrada = 2;
            eaDescr   = "MODIFICACION LINEA RIESGO CLIENTE (" + (("000000" + #dscam023#0) % -106) + "/" + (("000" + #dscam024#1) % -103) + ")" + eaDescr;
            eaTipoOp  = "M"; enImpAct = #dscam024#Campo#;
         |SINO;
            eaDescr   = "BAJA LINEA RIESGO CLIENTE (" + (("000000" + #dscam023#0) % -106) + "/" + (("000" + #dscam024#1) % -103) + ")";
            eaTipoOp  = "B"; enImpAct = 0;
         |FINSI;
         eaUsuario = Usuario % 0810;
         eaTipoReg = "RI";  eaNumero = ("000000" + #dscam023#0) % -106;
         eaFicher = "dscam024"; eaClave = #dscam024#0 + "/" + #dscam024#1;
         |HAZ GrabaAudit;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO ActRemesa; |TIPO 2;

   |DBASE aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "fich/"; |PATH_DAT #100 aAlfa;
   |ABRE #dscam038; |SELECT #4#dscam038;

   enImpAnt = #dscam023#20;
   #dscam023#19 = #dscam023#13 + #dscam023#15 + #dscam023#17; |PINTA #dscam023#19;
   #dscam023#20 = 0; |BUCLE Recalc1; |BUCLE Recalc2;

   |SI ModoEntrada = 2;
      eaDescr   = "MODIFICACION RIESGO CLIENTE (" + (("000000" + #dscam023#0) % -106) + ")";
      eaTipoOp  = "M"; enImpAct = #dscam023#20;
      nSw = 1; |HAZ CambiaDsPreven;
   |SINO;
      eaDescr   = "BAJA RIESGO CLIENTE (" + (("000000" + #dscam023#0) % -106) + ")";
      eaTipoOp  = "B"; enImpAct = 0;
      nSw = 2; |HAZ CambiaDsPreven;
   |FINSI;
   eaUsuario = Usuario % 0810;
   eaTipoReg = "RI";  eaNumero = ("000000" + #dscam023#0) % -106;
   eaFicher = "dscam023"; eaClave = #dscam023#0;
   |HAZ GrabaAudit;

   |SELECT #1#dscam038; |CIERRA #dscam038;
|FPRC;

|PROCESO BajaLinFec;
   |BORRA 020#dscam091.a;
|FPRC;

|DEFBUCLE BajaLinFec;
#dscam091#1;
;
#dscam023#0, #dscam023#2, 01;
#dscam023#0, #dscam023#2, 99;
be;
NULL,BajaLinFec;
|FIN;

|PROCESO Baja1; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3; |BUCLE BajaLinFec; |FINSI;
   enImpAnt = #dscam023#20;
   |SI ModoEntrada = 3; Borra = 1; |SINO; Borra = 0; |FINSI;
   #dscam023#20 = 0; |BUCLE Recalc1; |BUCLE Recalc2;

   |SI ModoEntrada = 2;
      eaDescr   = "MODIFICACION RIESGO CLIENTE (" + (("000000" + #dscam023#0) % -106) + ")";
      eaTipoOp  = "M"; enImpAct = #dscam023#20;
   |SINO;
      eaDescr   = "BAJA RIESGO CLIENTE (" + (("000000" + #dscam023#0) % -106) + ")";
      eaTipoOp  = "B"; enImpAct = 0;
   |FINSI;
   eaUsuario = Usuario % 0810;
   eaTipoReg = "RI";  eaNumero = ("000000" + #dscam023#0) % -106;
   eaFicher = "dscam023"; eaClave = #dscam023#0;
   |HAZ GrabaAudit;
|FPRC;

|PROCESO RepintaLin;
   |BUCLE Recalc2;
   |HAZ PresLin1;
   |SI #dscam024#0 ! #dscam023#0;
      |DDEFECTO #dscam024;
   |FINSI;
   |PINTA #dscam024#2;
   |PINTA #dscam024#3;
   |PINTA #dscam024#4;
   |PINTA #dscam024#5;
   |PINTA #dscam024#6;
   |PINTA #dscam024#7;
   |PINTA #dscam024#8;
   |PINTA #dscam024#9;
|FPRC;


|PROCESO MiraTm023;
   |SI #dscam023#23 ! 0; |Y #dscam023#23 < 51; |AVISO; |ERROR; |ACABA; |FINSI;

   |SI #dscam023#23 = 0;  aAlfa = "Sin Clasif.   "; |FINSI;
   |SI #dscam023#23 = 51; aAlfa = "Org.Publicos  "; |FINSI;
   |SI #dscam023#23 = 52; aAlfa = "Emp.Vinculadas"; |FINSI;
   |SI #dscam023#23 = 53; aAlfa = "Exportacion   "; |FINSI;
   |SI #dscam023#23 = 54; aAlfa = "Particulares  "; |FINSI;
   |SI #dscam023#23 = 55; aAlfa = "Contado       "; |FINSI;
   |SI #dscam023#23 = 56; aAlfa = "Clasif.NADA   "; |FINSI;
   |SI #dscam023#23 = 57; aAlfa = "Otros         "; |FINSI;

   |ATRI I; |PINTA 0959, aAlfa; |ATRI N;
|FPRC;


||******************************************************************
||******************************************************************
||******************************************************************

|FICHEROS;
   agif134@ #50;
   agif133@ #51;
   agif084@ #52;
   dscaw083 #54,MANTE;
   dscam044 #44;
   dscam045 #45;
   dscaw085 #56,MANTE;
|FIN;

|VARIABLES;
   HayVtos  = 0;
   nPendte  = 0;
   nFactura = 0;
   nSwHay   = 0;
   nEmpre   = 0;

   aSerie   = "";
   aDirDef  = "";
   aDirFic  = "";

   fFecha = @;
|FIN;

|PROCESO Vtosm023;
   HayVtos = 1;
   Divisa = #dscam003#57; |HAZ TomaDecim;
   nPendte = nPendte + #dscam003#31;
|FPRC;

|DEFBUCLE Vtosm023;
#dscam003#6;
4;
00, aSerie, nFactura, 001, " ", 000000001, fFecha;
00, aSerie, nFactura, 999, " ", 999999999, fFecha;
;
NULL,Vtosm023;
|FIN;

|PROCESO TmpVentm023;
   Divisa = #agif134@#58; |HAZ CargaNDeci;

   |DDEFECTO #dscaw083;
   #dscaw083#0 = nLinea; nLinea = nLinea + 1;
   #dscaw083#1 = #agif134@#49;
   #dscaw083#2 = #agif134@#0;
   #dscaw083#3 = #agif134@#1;
   #dscaw083#4 = #agif134@#101;
   aSerie = #agif134@#49; nFactura = #agif134@#0; fFecha = #agif134@#1;
   nPendte = 0; HayVtos = 0; |BUCLE Vtosm023;
   |SI HayVtos = 1;
      #dscaw083#5 = nPendte;
   |SINO;
      #dscaw083#5 = #dscaw083#4;
   |FINSI;
   #dscaw083#6 = aDirDef + "agifa134.mas";
   #dscaw083#7 = aDirFic;
   #dscaw083#8 = aSerie;
   #dscaw083#9 = nFactura;
   |GRABA 020#dscaw083.n;
|FPRC;

|DEFBUCLE TmpVentm023;
#agif134@#3004;
;
#dscam023#0, "01.01.0000", #dscam045#4, 000001;
#dscam023#0, "31,12,9999", #dscam045#5, 999999;
;
NULL,TmpVentm023;
|FIN;

|PROCESO TmpDirectm023;
   Divisa = #agif084@#65; |HAZ CargaNDeci;

   |DDEFECTO #dscaw083;
   #dscaw083#0 = nLinea; nLinea = nLinea + 1;
   #dscaw083#1 = #agif084@#48;
   #dscaw083#2 = #agif084@#0;
   #dscaw083#3 = #agif084@#1;
   #dscaw083#4 = #agif084@#73;
   aSerie = #agif084@#48; nFactura = #agif084@#0; fFecha = #agif084@#1;
   nPendte = 0; HayVtos = 0; |BUCLE Vtosm023;
   |SI HayVtos = 1;
      #dscaw083#5 = nPendte;
   |SINO;
      #dscaw083#5 = #dscaw083#4;
   |FINSI;
   #dscaw083#6 = aDirDef + "agifa084.mas";
   #dscaw083#7 = aDirFic;
   #dscaw083#8 = aSerie;
   #dscaw083#9 = nFactura;
   |GRABA 020#dscaw083.n;
|FPRC;

|DEFBUCLE TmpDirectm023;
#agif084@#3004;
;
#dscam023#0, "01.01.0000", #dscam045#4, 000001;
#dscam023#0, "31.12.9999", #dscam045#5, 999999;
;
NULL,TmpDirectm023;
|FIN;

|PROCESO Emprem023;
   nSwHay = 1;
   #dscam044#0 = #dscam045#0;
   |LEE 000#dscam044.=;

   aDirFic = #dscam044#1; |QBF aDirFic;
   aDirDef = aDirFic + "def/";
   aDirFic = aDirFic + "fich/" + (("00000" + #dscam045#0) % -105) + "/";

   aAlfa = aDirDef + "agifa134.mas";
   |CARGA_DEF aAlfa, agif134@;
   |SI FSalida = 0;
      aAlfa = aDirDef + "agifa133.mas"; |CARGA_DEF aAlfa, agif133@;
      aAlfa = aDirDef + "agifa084.mas"; |CARGA_DEF aAlfa, agif084@;
      |PATH_DAT #agif134@#aDirFic#; |ABRE #agif134@;
      |PATH_DAT #agif133@#aDirFic#; |ABRE #agif133@;
      |PATH_DAT #agif084@#aDirFic#; |ABRE #agif084@;
      |BUCLE TmpVentm023; |BUCLE TmpDirectm023;
      |CIERRA #agif084@; |DESCARGA_DEF #agif084@;
      |CIERRA #agif133@; |DESCARGA_DEF #agif133@;
      |CIERRA #agif134@; |DESCARGA_DEF #agif134@;
   |FINSI;
|FPRC;

|DEFBUCLE Emprem023;
#dscam045#2;
2;
nEmpre,"V";
nEmpre,"V";
;
NULL,Emprem023;
|FIN;

|RUTINA Infw083;
   #dscaw083#0 = 1;
|FRUT;

|RUTINA Supw083;
   #dscaw083#0 = 999999;
|FRUT;

|RUTINA Infw084;
   #dscaw084#0 = 1;
|FRUT;

|RUTINA Supw084;
   #dscaw084#0 = 999999;
|FRUT;

|RUTINA Infw085;
   #dscaw085#0 = 1;
|FRUT;

|RUTINA Supw085;
   #dscaw085#0 = 999999;
|FRUT;

|PROCESO RiesgoFac;
   |PUSHV 0501 2380;
   |DFICB aAlfa; |PATH_DAT #dscam044#aAlfa#; |PATH_DAT #dscam045#aAlfa#;
   aAlfa = "tm" + Usuario; |NOME_DAT #dscaw083#aAlfa#;
   |DELINDEX #dscaw083; |ABRE #dscaw083;
   |ABRE #dscam044; |ABRE #dscam045;
   nEmpre = #48#0; nLinea = 1; |BUCLE Emprem023;
   |ENTLINEAL #1#dscaw083, -1, 4, 22, 1, Infw083, Supw083;
   |CIERRA #dscam044; |CIERRA #dscam045;
   |CIERRA #dscaw083; |DELINDEX #dscaw083;
   |POPV; |ERROR;
|FPRC;

|PROCESO RiesgoRec;
   |PUSHV 0501 2380;
   aAlfa = "tm" + Usuario; |NOME_DAT #dscaw084#aAlfa#;
   |DELINDEX #dscaw084; |ABRE #dscaw084;
   nLinea = 1; |BUCLE RecogeRecs;
   |ENTLINEAL #1#dscaw084, -1, 4, 22, 1, Infw084, Supw084;
   |CIERRA #dscaw084; |DELINDEX #dscaw084;
   |POPV; |ERROR;
|FPRC;

|PROCESO RecogePags;
   |SI #dscam003#31 = 0; |ACABA; |FINSI;

   |SELECT #2#dscaw085;
   #dscaw085#1 = #dscam003#72;
   #dscaw085#2 = #dscam003#70;
   |LEE 000#dscaw085.=;
   |SI FSalida = 0; |ACABA; |FINSI;
   |SELECT #1#dscaw085;

   Divisa = #dscam003#57; |HAZ TomaDecim;

   |DDEFECTO #dscaw085;
   #dscaw085#0 = nLinea; nLinea = nLinea + 1;
   #dscaw085#1 = #dscam003#72;
   #dscaw085#2 = #dscam003#70;
   #dscaw085#3 = #dscam003#71;
   #dscaw085#4 = #dscam003#78;
   #dscaw085#5 = #dscam003#40;
   |GRABA 020#dscaw085.n;
|FPRC;

|DEFBUCLE RecogePags;
#dscam003#7;
32;
"!   ", "!         ", 000000001, #dscam023#0;
"zzzz", "zzzzzzzzzz", 999999999, #dscam023#0;
;
NULL,RecogePags;
|FIN;

|PROCESO RiesgoPag;
   |PUSHV 0501 2380;
   aAlfa = "tm" + Usuario; |NOME_DAT #dscaw085#aAlfa#;
   |DELINDEX #dscaw085; |ABRE #dscaw085;
   nLinea = 1; |BUCLE RecogePags;
   |ENTLINEAL #1#dscaw085, -1, 4, 22, 1, Infw085, Supw085;
   |CIERRA #dscaw085; |DELINDEX #dscaw085;
   |POPV; |ERROR;
|FPRC;

|PROCESO Empresasw202;
   |DDEFECTO #dscaw202;
   #dscaw202#0 = #Referen@#0;
   #dscaw202#1 = #Referen@#1;
   |GRABA 020#dscaw202.n;
|FPRC;

|DEFBUCLE Empresasw202;
#Referen@#1001;
;
00001;
99999;
;
NULL, Empresasw202;
|FIN;

|PROCESO LinRiesgosw203;
   #Refere2@#0 = #dscaw202#0;
   #Refere2@#6 = #Refere1@#1;
   #Refere2@#1 = 1;
   |LEE 000#Refere2@.];
   |SI FSalida ! 0; |O #Refere2@#0 ! #dscaw202#0; |O #Refere2@#6 ! #Refere1@#1;
      |DDEFECTO #Refere2@;
   |FINSI;
   |SI #Refere2@#8 ! "R"; |ACABA; |FINSI;

   |DDEFECTO #dscaw203;
   #dscaw203#0 = #dscaw202#0;
   #dscaw203#1 = #Refere1@#1;
   #dscaw203#2 = #Refere1@#2;
   #dscaw203#3 = #Refere1@#3;
   #dscaw203#4 = #Refere1@#4;
   #dscaw203#5 = #Refere1@#5;
   #dscaw203#6 = #Refere1@#6;
   #dscaw203#7 = #Refere1@#7;
   #dscaw203#8 = #Refere1@#8;
   #dscaw203#9 = #Refere1@#9;
   |GRABA 020#dscaw203.n;

   nTotalUsado  = nTotalUsado  + #Refere1@#8;
   nTotalDispo  = nTotalDispo  + #Refere1@#9;
   nTotalRiePed = nTotalRiePed + #Refere1@#2;
   nTotalRieAlb = nTotalRieAlb + #Refere1@#3;
   nTotalRieFra = nTotalRieFra + #Refere1@#4;
   nTotalRieBan = nTotalRieBan + #Refere1@#6;
   nTotalRieEnt = nTotalRieEnt + #Refere1@#5;
   nTotalRieImp = nTotalRieImp + #Refere1@#7;
|FPRC;

|DEFBUCLE LinRiesgosw203;
#Refere1@#1002;
;
#Referen@#0, 01;
#Referen@#0, 99;
;
NULL, LinRiesgosw203;
|FIN;

|PROCESO Riesgosw203;
   |DFICB aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + (("00000" + #dscaw202#0) % -105) + "/";
   |PATH_DAT #Referen@#aAlfa#; |PATH_DAT #Refere1@#aAlfa#;
   |ABRE #Referen@; |ABRE #Refere1@;
   #Referen@#0 = #dscam023#0;
   |LEE 000#Referen@.=;
   |SI FSalida = 0;
      #dscaw202#2 = #Referen@#19;
      #dscaw202#3 = #Referen@#20;
      |GRABA 020#dscaw202.a;

      |BUCLE LinRiesgosw203;
   |SINO;
      |BORRA 020#dscaw202.a;
   |FINSI;
   |CIERRA #Referen@; |CIERRA #Refere1@;
|FPRC;

|DEFBUCLE Riesgosw203;
#dscaw202#1;
;
INICIO;
FINAL;
be;
NULL, Riesgosw203;
|FIN;

|RUTINA infw202;
   #dscaw202#0 = 0;
|FRUT;

|RUTINA supw202;
   #dscaw202#0 = 99999;
|FRUT;

|RUTINA infw203;
   #dscaw203#0 = #dscaw202#0;
   #dscaw203#1 = 1;
|FRUT;

|RUTINA supw203;
   #dscaw203#0 = #dscaw202#0;
   #dscaw203#1 = 99;
|FRUT;

|RUTINA infm216;
   #dscam216#0 = #dscam023#0;
   #dscam216#1 = 01;
|FRUT;

|RUTINA supm216;
   #dscam216#0 = #dscam023#0;
   #dscam216#1 = 99;
|FRUT;

|PROCESO Tipo11w203; |TIPO 13;
   |PINTA #dscaw203#2;
   |PINTA #dscaw203#3;
   |PINTA #dscaw203#4;
   |PINTA #dscaw203#5;
   |PINTA #dscaw203#6;
   |PINTA #dscaw203#7;
   |PINTA #dscaw203#8;
   |PINTA #dscaw203#9;
|FPRC;

|PROCESO Tipo11w202; |TIPO 13;
   |SI FSalida = 10;
      |ENTLINEAL #1#dscaw203, 2, 4, 22, 1, infw203, supw203;
   |FINSI;

   |ENTLINEAL #1#dscaw203, 2, 7, 22, 1, infw203, supw203;
   |LEE 000#dscaw203.=;
   |SI FSalida ! 0; |O #dscaw203#0 ! #dscaw202#0; |DDEFECTO #dscaw203; |FINSI;

   |PINTA #dscaw203#2;
   |PINTA #dscaw203#3;
   |PINTA #dscaw203#4;
   |PINTA #dscaw203#5;
   |PINTA #dscaw203#6;
   |PINTA #dscaw203#7;
   |PINTA #dscaw203#8;
   |PINTA #dscaw203#9;
|FPRC;

|PROCESO Tipo20; |TIPO 20;
   |SI FSalida = "OPCION";
      |HAZ EsArtenvas;
      |SI FSalida = 0;
         FSalida = "Opciones";
      |SINO;
         FSalida = "Observ.";
      |FINSI;
   |SINO;
      |HAZ EsArtenvas;
      |SI FSalida = 0;
         |MENU aMenuOpc;
         nOpcion = FSalida; |SI nOpcion > 3; nOpcion = -1; |FINSI;
         |SI nOpcion = 1;                   || OBSERVACIONES
            enCuadroIni  = 1205;
            enCuadroFin  = 2275;
            eaTitulo     = " Observaciones ";
            aAlfa = "dscaz030.tab;" + (("000000" + #dscam023#0) % -106) + "000/999";
            |SUB_EJECUTA aAlfa;
         |FINSI;
         |SI nOpcion = 2;                   || FICHA GLOBAL
            |PUSHV 0501 2380;
            aAlfa = "rm1" + Usuario; |NOME_DAT #dscaw202#aAlfa#;
            aAlfa = "rm2" + Usuario; |NOME_DAT #dscaw203#aAlfa#;
            |DELINDEX #dscaw202; |DELINDEX #dscaw203;
            |ABRE #dscaw202; |ABRE #dscaw203;

            |DDEF aAlfa; |QBF aAlfa;
            aAlfa = aAlfa + "dscam000.mas";
            |CARGA_DEF aAlfa, Referen@;
            |SI FSalida = 0;
               |DFICB aAlfa; |QBF aAlfa;
               |PATH_DAT #Referen@#aAlfa#; |ABRE #Referen@;
               |BUCLE Empresasw202;
               |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
            |FINSI;

            |DDEF aAlfa; |QBF aAlfa;
            aAlfa = aAlfa + "dscam023.mas";
            |CARGA_DEF aAlfa, Referen@;
            |SI FSalida = 0;
               |DDEF aAlfa; |QBF aAlfa;
               aAlfa = aAlfa + "dscam024.mas";
               |CARGA_DEF aAlfa, Refere1@;

               |DDEF aAlfa; |QBF aAlfa;
               aAlfa = aAlfa + "dscam038.mas";
               |CARGA_DEF aAlfa, Refere2@;
               |DFICB aAlfa; |QBF aAlfa;
               |PATH_DAT #Refere2@#aAlfa#;
               |ABRE #Refere2@; |SELECT #3#Refere2@;

               nTotalRiePed = 0; nTotalRieAlb = 0;
               nTotalRieFra = 0; nTotalRieBan = 0;
               nTotalRieEnt = 0; nTotalRieImp = 0;
               nTotalDispo  = 0; nTotalUsado  = 0;
               |BUCLE Riesgosw203;

               || Riesgo refundido
               |DDEFECTO #dscaw202;
               #dscaw202#0 = 0;
               #dscaw202#1 = "Total riesgo refundido";
               #dscaw202#2 = nTotalDispo + nTotalUsado;
               #dscaw202#3 = nTotalUsado;
               |GRABA 020#dscaw202.n;

               #dscaw203#0 = 0;
               #dscaw203#1 = 1;
               #dscaw203#2 = nTotalRiePed;
               #dscaw203#3 = nTotalRieAlb;
               #dscaw203#4 = nTotalRieFra;
               #dscaw203#5 = nTotalRieEnt;
               #dscaw203#6 = nTotalRieBan;
               #dscaw203#7 = nTotalRieImp;
               #dscaw203#8 = nTotalUsado;
               #dscaw203#9 = nTotalDispo;
               |GRABA 020#dscaw203.n;

               |SELECT #1#Refere2@;
               |CIERRA #Refere2@; |DESCARGA_DEF #Refere2@;
               |DESCARGA_DEF #Refere1@;
               |DESCARGA_DEF #Referen@;
            |FINSI;

            |ENTLINEAL #1#dscaw202, 1, 7, 19, 1, infw203, supw203;
            |ENTLINEAL #1#dscaw202, 1, 4, 19, 1, infw202, supw202;

            |CIERRA #dscaw202; |CIERRA #dscaw203;
            |DELINDEX #dscaw202; |DELINDEX #dscaw203;
            |POPV;
         |FINSI;
         |SI nOpcion = 3;                   || FORMAS DE PAGO NO PERMITIDAS
            |PUSHV 0501 2380;
            |ENTLINEAL #1#dscam216, 1, 2, 22, 1, infm216, supm216;
            |POPV;
         |FINSI;
      |SINO;
         enCuadroIni  = 1205;
         enCuadroFin  = 2275;
         eaTitulo     = " Observaciones ";
         aAlfa = "dscaz030.tab;" + (("000000" + #dscam023#0) % -106) + "000/999";
         |SUB_EJECUTA aAlfa;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Bloqueo7; |TIPO 7;
     |HAZ EsTagloma; nSal = FSalida;
     |HAZ EsMOrts;
     |SI FSalida = 0; |O nSal = 0;
          aAlfa = "<S> Si,  <N> No,  <A> Automatico,   <X> Bloqueo Manual";
     |SINO;
          aAlfa = "<S> Si,  <N> No,  <A> Automatico";
     |FINSI;
     |MENSA aAlfa;
|FPRC;

|PROCESO Bloqueo0; |TIPO 0;
     |HAZ EsTagloma; nSal = FSalida;
     |HAZ EsMOrts;
     |SI FSalida = 0; |O nSal = 0;

     |SINO;   || la estandar
          |SI #0#9 = "X";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;
