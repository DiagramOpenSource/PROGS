|FICHEROS;
   dscam076 #0;
   dscam077 #1;
   dscam078 #2,MANTE;
   dscaw056 #3;
   dscaw057 #4;

   dscam051 #10;
   dscam003 #11;

   agif024@ #100;
   Referen@ #101;
|FIN;

|VARIABLES;
   &Divisa = ""; &nDeci_Base = 0; &nDeci_Div = 0;
   &HayGestion = 0;

   DFecha = @;
   HFecha = @;

   aAlfa  = "";
   aAlfa1 = "";

   nAviso = 0;
   nModo  = 0;
   nCalc  = 0;
   nCont  = 0;
   nTecla = 0;
   nFlag  = 0;
   nSw    = 0;
   nSwOk  = 0;
   nRef   = 0;
   nModoEntrada = 0;
|FIN;

|PROCESO MiraPeriodo;
   |SI #dscam076#1 = 01; aAlfa = "ENERO     "; |FINSI;
   |SI #dscam076#1 = 02; aAlfa = "FEBRERO   "; |FINSI;
   |SI #dscam076#1 = 03; aAlfa = "MARZO     "; |FINSI;
   |SI #dscam076#1 = 04; aAlfa = "ABRIL     "; |FINSI;
   |SI #dscam076#1 = 05; aAlfa = "MAYO      "; |FINSI;
   |SI #dscam076#1 = 06; aAlfa = "JUNIO     "; |FINSI;
   |SI #dscam076#1 = 07; aAlfa = "JULIO     "; |FINSI;
   |SI #dscam076#1 = 08; aAlfa = "AGOSTO    "; |FINSI;
   |SI #dscam076#1 = 09; aAlfa = "SEPTIEMBRE"; |FINSI;
   |SI #dscam076#1 = 10; aAlfa = "OCTUBRE   "; |FINSI;
   |SI #dscam076#1 = 11; aAlfa = "NOVIEMBRE "; |FINSI;
   |SI #dscam076#1 = 12; aAlfa = "DICIEMBRE "; |FINSI;
   |PINTA 0816, aAlfa;
|FPRC;

|RUTINA infm78;
   #dscam078#0 = #dscam077#0;
   #dscam078#1 = #dscam077#1;
   #dscam078#2 = #dscam077#2;
   #dscam078#3 = #dscam077#3;
   #dscam078#4 = 1;
|FRUT;

|RUTINA supm78;
   #dscam078#0 = #dscam077#0;
   #dscam078#1 = #dscam077#1;
   #dscam078#2 = #dscam077#2;
   #dscam078#3 = #dscam077#3;
   #dscam078#4 = 999;
|FRUT;

|PROCESO Reparte;
   nCalc = #dscam078#9 - #dscam078#8;
   #dscaw056#0 = nCalc;
   |LEE 000#dscaw056.];
   #dscaw056#1 = #dscaw056#1 + #dscam078#10;
   |GRABA 020#dscaw056.a;
|FPRC;

|DEFBUCLE Reparte;
#dscam078#1;
;
#dscam077#0, #dscam077#1, #dscam077#2, #dscam077#3,   1;
#dscam077#0, #dscam077#1, #dscam077#2, #dscam077#3, 999;
;
NULL,Reparte;
|FIN;

|RUTINA infw56;
   #dscaw056#0 = 1;
|FRUT;

|RUTINA supw56;
   #dscaw056#0 = 999;
|FRUT;

|PROCESO CogeDatos;
   nTecla = FSalida;
   nModoEntrada = (FEntrada / 100) ! 0;
   |SI nModoEntrada = 1;
      |SI HayGestion ! 0;
         aAlfa = #48#17; |QBF aAlfa;
         aAlfa = aAlfa + "def/agifa024.mas";
         |CARGA_DEF aAlfa, agif024@;
         |SI FSalida = 0;
            aAlfa = #48#17; |QBF aAlfa;
            aAlfa = aAlfa + "fich/" + (("00000" + #48#15) % -105) + "/";
            |PATH_DAT #100 aAlfa;
            |ABRE #agif024@;
            #agif024@#0 = #dscam077#3;
            |SI nTecla = 10;
               |LEE 000#agif024@.];
               |CONSULTA_CLAVE #1#agif024@;
               |SI FSalida = 0; #dscam077#3  = #agif024@#0; |FINSI;
            |FINSI;
            |LEE 000#agif024@.=;
            |SI FSalida = 0;
               #dscam077#4  = #agif024@#2;
               #dscam077#11 = #agif024@#6;
               #dscam077#12 = #agif024@#178;
               #dscam077#13 = #agif024@#179;
               #dscam077#14 = #agif024@#7;
            |SINO;
               |MENAV "    Cliente inexistente"; |ERROR;
            |FINSI;
            |CIERRA #agif024@; |DESCARGA_DEF #agif024@;
         |FINSI;
      |SINO;
         |MENAV "   No hay empresa de gestion comercial";
         |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO TotalClientes;
   #dscam076#4 = #dscam076#4 +. #dscam077#6;
|FPRC;

|DEFBUCLE TotalClientes;
#dscam077#1;
;
#dscam076#0, #dscam076#1, #dscam076#2, "      ";
#dscam076#0, #dscam076#1, #dscam076#2, "zzzzzz";
;
NULL,TotalClientes;
|FIN;

|PROCESO Tipo3m76; |TIPO 3;
   #dscam076#4 = 0;
   |BUCLE TotalClientes;
   |PINTA #dscam076#4;
|FPRC;

|PROCESO Totaliza;
   #dscam077#6 = #dscam077#6 + #dscam078#10;
|FPRC;

|DEFBUCLE Totaliza;
#dscam078#1;
;
#dscam077#0, #dscam077#1, #dscam077#2, #dscam077#3, 001;
#dscam077#0, #dscam077#1, #dscam077#2, #dscam077#3, 999;
;
NULL,Totaliza;
|FIN;

|PROCESO ActCliente; |TIPO 3;
   |PUSHV 0501 2380;
   |ENTLINEAL #1#dscam078,-5,2,21,1,infm78,supm78;
   |POPV;

   |SALVA_FICHA #dscam077; |HAZ Tipo3m76; |REPON_FICHA #dscam077;
   #dscam076#4 = #dscam076#4 - #dscam077#6;
   #dscam077#6 = 0; |BUCLE Totaliza; |PINTA #dscam077#6;
   #dscam076#4 = #dscam076#4 + #dscam077#6; |PINTA #dscam076#4;

   |HAZ Tipo13m76;
|FPRC;

|PROCESO Detalle; |TIPO 11;
   nTecla = FSalida;
   nModoEntrada = (FEntrada / 100) ! 0;
   |SI nTecla = 10; |Y nModoEntrada = 1;
      aAlfa = #48#17; |QBF aAlfa;
      aAlfa = aAlfa + "def/agifa024.mas";
      |CARGA_DEF aAlfa, agif024@;
      |SI FSalida = 0;
         aAlfa = #48#17; |QBF aAlfa;
         aAlfa = aAlfa + "fich/" + (("00000" + #48#15) % -105) + "/";
         |PATH_DAT #100 aAlfa;
         |ABRE #agif024@;
         #agif024@#0 = #dscam077#3;
         |LEE 000#agif024@.];
         |CONSULTA_CLAVE #1#agif024@;
         |SI FSalida = 0;
            #dscam077#3  = #agif024@#0;
            #dscam077#4  = #agif024@#2;
            #dscam077#11 = #agif024@#6;
            #dscam077#12 = #agif024@#178;
            #dscam077#13 = #agif024@#179;
            #dscam077#14 = #agif024@#7;
         |FINSI;
         |CIERRA #agif024@; |DESCARGA_DEF #agif024@;
      |FINSI;
   |FINSI;
   |SI nTecla = 11;
      |PUSHV 0501 2380;
      |BLANCO 1001 2363;
      |PINTA 1002, "ษ";
      |ATRI R; |PINTA 1003, " DETALLE CLIENTE "; |ATRI N;
      |PINTA 1020, "อออัออออออออออัออออออออออัออออัอออออออออออป";
      aAlfa = #dscam077#3 + " " + #dscam077#4; |QBF aAlfa; aAlfa = aAlfa + " ";
      |ATRI R; |PINTA 1020, aAlfa; |ATRI N;
      |ENTLINEAL #1#dscam078,-5,4,21,1,infm78,supm78;
      |POPV;
      |ERROR;
   |FINSI;
   |SI nTecla = 12;
      |PUSHV 0501 2380;
      |ABRE #dscam051;
      |LEE 000#dscam051.=;
      |SI FSalida ! 0;
         |MENAV "    No hay ficha de parametros generales. Proceso abortado";
         |CIERRA #dscam051; |ACABA;
      |FINSI;
      |SI #dscam051#45 = 0; |O #dscam051#46 = 0;
         |MENAV "    No hay datos indicados en los parametros generales. Proceso abortado";
         |CIERRA #dscam051; |ACABA;
      |FINSI;

      |CIERRA #dscam051;

      aAlfa = "di" + Usuario; |NOME_DAT #3 aAlfa;
      |DELINDEX #dscaw056; |ABRE #dscaw056;
      |PARA nCont = 1; |SI nCont [ #dscam051#46; |HACIENDO nCont = nCont + 1;
         nCalc = nCont * #dscam051#45;
         |DDEFECTO #dscaw056;
         #dscaw056#0 = nCalc;
         |GRABA 020#dscaw056.n;
      |SIGUE;
      |DDEFECTO #dscaw056; #dscaw056#0 = 999; |GRABA 020#dscaw056.n;
      |BUCLE Reparte;
      |ENTLINEAL #1#dscaw056,-1,4,22,1,infw56,supw56;
      |CIERRA #dscaw056;
      |POPV;
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO LinCab;
   |SI nSw = 1; |Y #dscam078#4 = nRef; |ACABA; |FINSI;
   nCalc = #dscam078#9 - #dscam078#8;
   #dscaw057#0 = nCalc;
   |LEE 000#dscaw057.];
   #dscaw057#1 = #dscaw057#1 + #dscam078#10;
   |GRABA 020#dscaw057.a;
|FPRC;

|DEFBUCLE LinCab;
#dscam078#1;
;
#dscam076#0, #dscam076#1, #dscam076#2, "      ",   1;
#dscam076#0, #dscam076#1, #dscam076#2, "zzzzzz", 999;
;
NULL,LinCab;
|FIN;

|RUTINA infw57;
   #dscaw057#0 = 1;
|FRUT;

|RUTINA supw57;
   #dscaw057#0 = 999;
|FRUT;

|PROCESO Tipo13m76; |TIPO 13;
   aAlfa = "di" + Usuario; |NOME_DAT #4 aAlfa;
   |DELINDEX #dscaw057; |ABRE #dscaw057;

   |ABRE #dscam051;
   |LEE 000#dscam051.p;
   |SI FSalida ! 0; |DDEFECTO #dscam051; |FINSI;
   |CIERRA #dscam051;

   |PARA nCont = 1; |SI nCont [ #dscam051#46; |HACIENDO nCont = nCont + 1;
      nCalc = nCont * #dscam051#45;
      |DDEFECTO #dscaw057;
      #dscaw057#0 = nCalc;
      |GRABA 020#dscaw057.n;
   |SIGUE;
   |DDEFECTO #dscaw057; #dscaw057#0 = 999; |GRABA 020#dscaw057.n;
   |BUCLE LinCab;
   |ENTLINEAL #1#dscaw057,-1,7,16,1,infw57,supw57;
   |CIERRA #dscaw057;
   |HAZ MiraPeriodo;
|FPRC;

|PROCESO CalcDias;
   #dscam078#13 = #dscam078#9 - #dscam078#8;
   |PINTA #dscam078#13;
|FPRC;

|PROCESO LineasVtos; |TIPO 2;
   nFlag = 0 +. 1;
   || Marca/Desmarca el recibo
   |ABRE #dscam003;
   #dscam003#40 = #dscam078#14;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      |SI nFlag < 0;
         #dscam003#89 = "N";
      |SINO;
         #dscam003#89 = "S";
      |FINSI;
      |GRABA 020#dscam003.a;
   |FINSI;
   |CIERRA #dscam003;

   |SI nFlag < 0;
      nSw = 1; nRef = #dscam078#4;
      |SALVA_FICHA #dscam078; |HAZ Tipo13m76; |REPON_FICHA #dscam078;
      nSw = 0;
   |SINO;
      |SALVA_FICHA #dscam078; |HAZ Tipo13m76; |REPON_FICHA #dscam078;
   |FINSI;
   #dscam076#4 = #dscam076#4 +. #dscam078#10; |PINTA #dscam076#4;
|FPRC;

|PROCESO CogeRecs;
   nTecla = FSalida;
   |ABRE #dscam003;
   |SI nTecla = 10;
      aAlfa = "SELECT * FROM dscam003 INTO rc" + Usuario + ".def WHERE 32 == " + #dscam077#3 + " AND 89 == 'N'";
      |SQL aAlfa;
      |SI FSalida = 0;
         aAlfa = FSalida % -102;
         |SI aAlfa ! ":0";
            |DBASE aAlfa; |QBF aAlfa;
            aAlfa = aAlfa + "def/rc" + Usuario + ".mas";
            |CARGA_DEF aAlfa, Referen@;
            |SI FSalida = 0;
               |ABRE #Referen@;
               |SELECT #6#Referen@;
               #Referen@#27 = 0;
               #Referen@#0  = #dscam078#5;
               #Referen@#1  = #dscam078#6;
               #Referen@#2  = #dscam078#7;
               #Referen@#69 = " ";
               #Referen@#40 = 1;
               |LEE 000#Referen@.];
               |CONSULTA_CLAVE #1#Referen@;
               |SI FSalida = 0;
                  Divisa = #Referen@#57; |HAZ TomaDecim;
                  #dscam078#5  = #Referen@#0;  |PINTA #dscam078#5;
                  #dscam078#6  = #Referen@#1;  |PINTA #dscam078#6;
                  #dscam078#7  = #Referen@#2;  |PINTA #dscam078#7;
                  #dscam078#8  = #Referen@#4;  |PINTA #dscam078#8;
                  #dscam078#9  = #Referen@#3;  |PINTA #dscam078#9;
                  #dscam078#10 = #Referen@#60; |PINTA #dscam078#10;
                  #dscam078#13 = #dscam078#9 - #dscam078#8;
                  #dscam078#14 = #Referen@#40;
               |SINO;
                  |ERROR;
               |FINSI;
               |SELECT #1#Referen@;
               |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
            |FINSI;
         |FINSI;
         |DBASE aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "def/rc" + Usuario + ".mas"; |FBORRA aAlfa;
      |FINSI;
   |SINO;
      |SI Campo = 7;
         nSwOk = 0; aAlfa = #dscam076#2;
         aAlfa1 = "01.01." + aAlfa; DFecha = aAlfa1;
         aAlfa1 = "31.12." + aAlfa; HFecha = aAlfa1;
         |SELECT #6#dscam003;
         #dscam003#27 = 0;
         #dscam003#0  = #dscam078#5;
         #dscam003#1  = #dscam078#6;
         #dscam003#2  = #dscam078#7;
         #dscam003#69 = " ";
         #dscam003#40 = 1;
         |LEE 000#dscam003.];
         |PARA; |SI FSalida = 0; |Y #dscam003#27 = 0; |Y #dscam003#0  = #dscam078#5;
          |Y #dscam003#1  = #dscam078#6; |Y #dscam003#2  = #dscam078#7; |Y #dscam003#69 = " "; |HACIENDO;
             |SI #dscam003#4 ] DFecha; |Y #dscam003#4 [ HFecha;
                nSwOk = 1; |SAL;
             |FINSI;
             |LEE 000#dscam003.s;
         |SIGUE;
         |SI nSwOk = 1;
            |SI #dscam003#32 ! #dscam077#3;
               |MENAV "    El cliente no se corresponde"; |ERROR; |VETE Final;
            |FINSI;
            |SI #dscam003#89 ! "N";
               |MENAV "    El recibo ya esta declarado"; |ERROR; |VETE Final;
            |FINSI;
            Divisa = #dscam003#57; |HAZ TomaDecim;
            #dscam078#5  = #dscam003#0;  |PINTA #dscam078#5;
            #dscam078#6  = #dscam003#1;  |PINTA #dscam078#6;
            #dscam078#7  = #dscam003#2;  |PINTA #dscam078#7;
            #dscam078#8  = #dscam003#4;  |PINTA #dscam078#8;
            #dscam078#9  = #dscam003#3;  |PINTA #dscam078#9;
            #dscam078#10 = #dscam003#60; |PINTA #dscam078#10;
            #dscam078#13 = #dscam078#9 - #dscam078#8;
            #dscam078#14 = #dscam003#40;
            |ET Final;
         |SINO;
            |MENAV "    Recibo inexistente"; |ERROR;
         |FINSI;
         |SELECT #1#dscam003;
      |FINSI;
   |FINSI;
   |CIERRA #dscam003;
|FPRC;

|PROCESO BajaRecibos;
   #dscam003#40 = #dscam078#14;
   |LEE 000#dscam003.=;
   |SI FSalida = 0;
      #dscam003#89 = "N";
      |GRABA 020#dscam003.a;
   |FINSI;
   |BORRA 020#dscam078.a;
|FPRC;

|DEFBUCLE BajaRecibos;
#dscam078#1;
;
#dscam077#0, #dscam077#1, #dscam077#2, #dscam077#3,001;
#dscam077#0, #dscam077#1, #dscam077#2, #dscam077#3,999;
;
NULL,BajaRecibos;
|FIN;

|PROCESO BajaClientes;
   |BUCLE BajaRecibos;
   |BORRA 020#dscam077.a;
|FPRC;

|DEFBUCLE BajaClientes;
#dscam077#1;
;
#dscam076#0, #dscam076#1, #dscam076#2, "      ";
#dscam076#0, #dscam076#1, #dscam076#2, "zzzzzz";
;
NULL,BajaClientes;
|FIN;

|PROCESO Tipo1m076; |TIPO 1;
   nModo = (FEntrada / 100) ! 0;
   |ABRE #dscam003;
   |SI nModo = 3; |BUCLE BajaClientes; |FINSI;
   |CIERRA #dscam003;
|FPRC;

|PROCESO Tipo07m076; |TIPO 7;
   nModo = (FEntrada / 100) ! 0;
   |SI nModo ! 4;
      |ABRE #dscam051;
      |LEE 000#dscam051.p;
      |SI FSalida = 0;
         |SI #dscam051#3 = "N"; |Y nAviso = 0;
            |MENAV "    No tiene activado el control de riesgo en parametros generales";
            nAviso = 1;
         |FINSI;
      |FINSI;
      |CIERRA #dscam051;
   |FINSI;
|FPRC;
