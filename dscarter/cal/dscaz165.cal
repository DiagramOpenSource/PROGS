|FICHEROS;
   dscaz165 #0;
   dscaw135 #1;

   dscam003 #10;
   dscam004 #11;

   agif024@ #100;
|FIN;

|VARIABLES;
   &nDeci_Base = 0; &nDeci_Div = 0; &Divisa = "";
   aCampo69 = "";
   nFechaEmi = 0;
   fSistema = @;
   nFechaSis = 0;
   nZonaInforme = 0;
   nDif = 0;

   nTotalPdt = 0;

   &aInforme = "";

   aAlfa     = "";
   aEntidad  = "";
   aNumero   = "";

   fFechaRecep = @;
|FIN;

|PROCESO Resumen; |TIPO 0;
     aAlfa = #0#6;
     |C_M #0#7, 1, aAlfa;
     |C_M #0#8, 1, aAlfa;
|FPRC;

|PROCESO MiraPdtTP;
   nTotalPdt = nTotalPdt + #dscam003#31;

   #dscam004#17 = #dscam003#40;
   #dscam004#3  = 1;
   |LEE 000#dscam004.];
   |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
      |SI #dscam004#5 = "RPT"; fFechaRecep = #dscam004#6; |FINSI;
      |LEE 000#dscam004.s;
   |SIGUE;
|FPRC;

|DEFBUCLE MiraPdtTP;
#dscam003#7;
;
aEntidad, aNumero, 0000000001;
aEntidad, aNumero, 9999999999;
;
NULL, MiraPdtTP;
|FIN;

/*
|PROCESO Cobros;
     nFechaEmi = #dscam004#6;
     nDif = nFechaSis - nFechaEmi;
     |SI nDif > 360;
          |ACABA;
     |FINSI;

   |DDEFECTO #dscaw135;
   #dscaw135#0  = #dscam003#33; || Codigo representante
   #dscaw135#1  = #dscam003#32; || Codigo cliente
   #dscaw135#2  = #dscam003#0;  || Serie recibo
   #dscaw135#3  = #dscam003#1;  || N§ factura recibo
   #dscaw135#4  = #dscam004#3;  || N§ recibo recibo
   #dscaw135#5  = #dscam003#72; || Entidad Pagare/Talon
   #dscaw135#6  = #dscam003#70; || N§ Pagare/Talon
   #dscaw135#9  = #dscam004#8;  || Importe del movimiento
   #dscaw135#24 = #dscam003#40; || Numero de documento
   #dscaw135#26 = #dscam004#6;  || Fecha de movimiento
   #dscaw135#27 = #dscam004#26;  || Importe del movimiento
   #dscaw135#28 = nZonaInforme;
   |GRABA 020#dscaw135.n;
   |LIBERA #dscaw135;
|FPRC;

|DEFBUCLE Cobros;
 #dscam004#1;
 ;
 #dscam003#40, 01;
 #dscam003#40, 99;
 ;
 NULL, Cobros;
|FIN;
*/

|PROCESO Temporal;
   nZonaInforme = 1;
   |SI #dscam003#14 = "A"; |O #dscam003#14 = "D"; |O #dscam003#14 = "R";
    |O  #dscam003#14 = "e"; |O #dscam003#14 = "L";
        |ACABA;
   |FINSI;

   aCampo69 = #dscam003#69;
   |QBF aCampo69;
   ||ABDON: Las entregas a cuenta no deben entrar
   |SI #dscam003#47 = "S"; |O aCampo69 ! "";
       |ACABA;
   |FINSI;

   fFechaRecep = "01.01.0000";
   nTotalPdt = 0; aEntidad = #dscam003#72; aNumero = #dscam003#70;
   |SI aEntidad ! "    "; |O aNumero ! "          ";
      |SALVA_FICHA #dscam003;
      |BUCLE MiraPdtTP;
      |REPON_FICHA #dscam003;
   |FINSI;

   |DDEFECTO #dscaw135;
   #dscaw135#0  = #dscam003#33; || Codigo representante
   #dscaw135#1  = #dscam003#32; || Codigo cliente
   #dscaw135#2  = #dscam003#0;  || Serie recibo
   #dscaw135#3  = #dscam003#1;  || N§ factura recibo
   #dscaw135#4  = #dscam003#2;  || N§ recibo recibo
   #dscaw135#5  = #dscam003#72; || Entidad Pagare/Talon
   #dscaw135#6  = #dscam003#70; || N§ Pagare/Talon
   #dscaw135#7  = #dscam003#4;  || Fecha emision recibo
   #dscaw135#8  = #dscam003#30; || Importe total recibo
   #dscaw135#9  = #dscam003#23; || Entregas recibo
   #dscaw135#10 = #dscam003#31; || Importe pendiente recibo
   #dscaw135#11 = #dscam003#3;  || Fecha vencimiento recibo
   #dscaw135#12 = #dscam003#78; || Importe total Pagare/Talon
   #dscaw135#13 = #dscam003#78 - nTotalPdt; || Importe cobrado Pagare/Talon
   #dscaw135#14 = nTotalPdt;    || Importe pendiente Pagare/Talon
   #dscaw135#15 = #dscam003#71; || Fecha vencimiento Pagare/Talon

   #agif024@#0 = #dscam003#32;
   |LEE 000#agif024@.=;
   |SI FSalida ! 0; |DDEFECTO #agif024@; |FINSI;

   #dscaw135#16 = #agif024@#8;  || Direccion factura cliente
   #dscaw135#17 = #agif024@#9;  || Poblacion factura cliente
   #dscaw135#18 = #agif024@#10; || Provincia factura cliente
   aAlfa = (("00" + #agif024@#181) % -102) + (("000" + #agif024@#182) % -103);
   #dscaw135#19 = aAlfa;        || CP factura cliente
   #dscaw135#20 = #agif024@#17; || Telefono cliente
   #dscaw135#21 = #agif024@#196;|| Telefono movil cliente
   #dscaw135#22 = #dscam003#34; || Nombre representante
   #dscaw135#23 = #dscam003#6;  || Nombre cliente
   #dscaw135#24 = #dscam003#40; || Numero de documento
   #dscaw135#25 = fFechaRecep;  || Fecha de recepcion del pagare/talon

   #dscam004#17 = #dscam003#40;
   #dscam004#3  = 1;
   |LEE 000#dscam004.];
   |PARA; |SI FSalida = 0; |Y #dscam004#17 = #dscam003#40; |HACIENDO;
      |SI #dscam004#5 ! "IMP";
         #dscaw135#26 = #dscam004#6;  || Fecha de movimiento
         #dscaw135#27 = #dscam004#8;  || Importe del movimiento
      |FINSI;
      |LEE 000#dscam004.s;
   |SIGUE;

   #dscaw135#28 = nZonaInforme;
   |GRABA 020#dscaw135.n;
   |LIBERA #dscaw135;

/*
   |SI #dscaz165#6 ! "N";
       nZonaInforme = 2;
       |BUCLE Cobros;
   |FINSI;
*/
|FPRC;

|DEFBUCLE Temporal;
#dscam003#12;
33;
#0#2, 000000, 000, "01.01.0000", "            ", #0#1, #0#0;
#0#5, 999999, 999, "31.12.9999", "zzzzzzzzzzzz", #0#4, #0#3;
;
NULL, Temporal;
|FIN;

|PROCESO Imprime;
   |PRINT;
|FPRC;

|DEFBUCLE Imprime;
#dscaw135#1;
;
INICIO;
FINAL;
;
NULL, Imprime;
|FIN;

|PROCESO dscam004_resto;
     ||Primero que exista el recibo.
     |DDEFECTO #dscam003;
     #dscam003#40 = #dscam004#17;
     |LEE 000#dscam003.=;
     |SI FSalida ! 0;
          |ACABA;
     |FINSI;

     ||Acotacion del informe.
     |SI #dscam003#0 < #0#2; |O #dscam003#0 > #0#5;
          |ACABA;
     |FINSI;
     |SI #dscam003#32 < #0#1; |O #dscam003#32 > #0#4;
          |ACABA;
     |FINSI;
     |SI #dscam003#33 < #0#0; |O #dscam003#33 > #0#3;
          |ACABA;
     |FINSI;
/*
     nFechaEmi = #dscam004#6;
     nDif = nFechaSis - nFechaEmi;
     |SI nDif > 360;
          |ACABA;
     |FINSI;
*/
     |DDEFECTO #dscaw135;
     #dscaw135#0  = #dscam003#33; || Codigo representante
     #dscaw135#1  = #dscam003#32; || Codigo cliente
     #dscaw135#2  = #dscam003#0;  || Serie recibo
     #dscaw135#3  = #dscam003#1;  || N§ factura recibo
     #dscaw135#4  = #dscam004#3;  || N§ recibo recibo
     #dscaw135#5  = #dscam003#72; || Entidad Pagare/Talon
     #dscaw135#6  = #dscam003#70; || N§ Pagare/Talon
     #dscaw135#9  = #dscam004#8;  || Importe del movimiento
     #dscaw135#24 = #dscam003#40; || Numero de documento
     #dscaw135#26 = #dscam004#6;  || Fecha de movimiento
     #dscaw135#27 = #dscam004#26;  || Importe del movimiento
     #dscaw135#28 = nZonaInforme;

     #agif024@#0 = #dscam003#32;
     |LEE 000#agif024@.=;
     |SI FSalida ! 0; |DDEFECTO #agif024@; |FINSI;

     #dscaw135#16 = #agif024@#8;  || Direccion factura cliente
     #dscaw135#17 = #agif024@#9;  || Poblacion factura cliente
     #dscaw135#18 = #agif024@#10; || Provincia factura cliente
     aAlfa = (("00" + #agif024@#181) % -102) + (("000" + #agif024@#182) % -103);
     #dscaw135#19 = aAlfa;        || CP factura cliente
     #dscaw135#20 = #agif024@#17; || Telefono cliente
     #dscaw135#21 = #agif024@#196;|| Telefono movil cliente
     #dscaw135#22 = #dscam003#34; || Nombre representante
     #dscaw135#23 = #dscam003#6;  || Nombre cliente

     |GRABA 020#dscaw135.n;
     |LIBERA #dscaw135;

/*
#0#2, 000000, 000, "01.01.0000", "            ", #0#1, #0#0;
#0#5, 999999, 999, "31.12.9999", "zzzzzzzzzzzz", #0#4, #0#3;

*/

|FPRC;

|DEFBUCLE dscam004_resto;
 #dscam004#7;
 ;
 #0#7, 000000000;
 #0#8, 999999999;
 ;
 NULL, dscam004_resto;
|FIN;

|PROGRAMA;
   nDeci_Base = 2;
   nDeci_Div = 2;

   fSistema = ~;
   nFechaSis = fSistema;
   |CLS;
   |CABEZA "";

   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      aAlfa = #48#17; |QBF aAlfa;
      aAlfa = aAlfa + "def/agifa024.mas";
      |CARGA_DEF aAlfa, agif024@;
      |SI FSalida = 0;
         aAlfa = #48#17; |QBF aAlfa;
         aAlfa = aAlfa + "fich/" + (("00000" + #48#15) % -105) + "/";
         |PATH_DAT #agif024@#aAlfa#; |ABRE #agif024@;

         aAlfa = "tr" + Usuario; |NOME_DAT #dscaw135#aAlfa#;
         |DELINDEX #dscaw135; |ABRE #dscaw135;
         |ABRET #dscam004;
         |BUCLE Temporal;
         |CIERRAT #dscam004;

         ||Tengo que meter en el informe TODOS los
         |SI #dscaz165#6 = "S";
             |ABRE #dscam003;
             nZonaInforme = 2;
             |BUCLE dscam004_resto;
             |CIERRA #dscam003;
         |FINSI;

         |CIERRA #agif024@; |DESCARGA_DEF #agif024@;

         ||TODO CCC
         ||DESCOMENTAR. OKIE
         Impresora = "CrystalReport";
         |IMPRE -1;

         ||IMPRE 0;
         |SI FSalida = 0;
            aInforme = "Informe Pdtes. Repres./Cliente"; |HAZ ObtenInforme;
            |SI aInforme = "Informe Pdtes. Repres./Cliente";
               aInforme = "dscaz165";
            |FINSI;

            |SI #dscaz165#6 = "S";
               aInforme = "dscaz965";
            |FINSI;

            |INFOR aInforme;
            |SI FSalida = 0;
               |BUCLE Imprime;
               |PIEINF; |FININF;
            |FINSI;
            |FINIMP;
         |FINSI;

         |CIERRA #dscaw135;   |DELINDEX #dscaw135;
      |FINSI;
   |FINSI;
|FPRO;
