|FICHEROS;
     rey00005;
     reacceso;
     rem01001;
|FIN;

|VARIABLES;
     &aAsigna    = "";
     &aIdenti    = "";
     &aAbre1     = "";
     &aAbre2     = "";
     &aIPRemoto  = "";
     &aOrigen    = "";
     &aDestino   = "";
     &aPathDocu  = "";
     &aAlfa      = "";
     &aDocumento = "";
     &aAlfa1     = "";
     &aAlfa2     = "";
     &aAlfa3     = "";
     &aPathRenta = "";
     &aDef       = "";
     &aLen       = "";
     &aImpor1    = "";
     &aImpor2    = "";
     &aImpor3    = "";
     &aImpor4    = "";
     &aImporte   = "";
     &aBloque    = "";
     &aFichero   = "";
     &aCaracter  = "";
     &aCadena    = "";

     &nContador     = 0;
     &nOpcion       = 0;
     &nCabecera     = 0;
     &nSubCabecera  = 0;
     &nImporte      = 0;
     &nImporte1     = 0;
     &nImporte2     = 0;
     &nLen          = 0;
     &nWord         = 0;
     &nWord1        = 0;
     &nWord2        = 0;
     &nCampo        = 0;
     &nCampoS       = 0;
     &nSwAlguno     = 0;
     &nSwLiqui      = 0;
     &nLinea        = 0;
     &nBloque       = 0;
     &nHay          = 0;
     &nPos          = 0;
     &nPaso         = 0;

     {39}&aCarac    = "";

     &enCanti      = 0;
     &enSwTrata    = 0;
     &eaMoneda     = "";
     &eaImporte    = "";
     &eaUnidadBasico  = "";
|FIN;

|PROCESO QuitaRaros;
     |QBF aAsigna;

     aCarac1   = "•";
     aCarac2   = "§";
     aCarac3   = "·";
     aCarac4   = "†";
     aCarac5   = "Ç";
     aCarac6   = "°";
     aCarac7   = "¢";
     aCarac8   = "£";
     aCarac9   = "ß";
     aCarac10  = "¶";
     aCarac11  = "®";
     aCarac12  = "Ä";
     aCarac13  = "á";
     aCarac14  = "Ö";
     aCarac15  = "ä";
     aCarac16  = "ç";
     aCarac17  = "ï";
     aCarac18  = "ó";
     aCarac19  = &001;
     aCarac20  = &002;
     aCarac21  = &003;
     aCarac22  = &004;
     aCarac23  = &005;
     aCarac24  = &006;
     aCarac25  = &007;
     aCarac26  = &015;
     aCarac27  = &016;
     aCarac28  = &017;
     aCarac29  = &018;
     aCarac30  = &019;
     aCarac31  = &020;
     aCarac32  = &021;
     aCarac33  = &022;
     aCarac34  = &023;
     aCarac35  = &024;
     aCarac36  = &025;
     aCarac37  = &026;
     aCarac38  = &028;
     aCarac39  = &029;

     IaCarac = aCarac1 <-;
     nHay    = 0;
     |PARA nCampo = 1;  |SI nCampo [ 39;  |HACIENDO nCampo = nCampo + 1;
           aCaracter = aAsigna - aCarac;
           |SI FSalida ! 0;  nHay = 1;  |SAL;  |FINSI;

           IaCarac = IaCarac + 1;
     |SIGUE;

     |SI nHay = 0;  |ACABA;  |FINSI;

     aCadena = "";
     aLen    = aAsigna % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aAsigna % nPos;
           nPaso     = 0;

           |SI aCaracter = aCarac1;  |Y nPaso = 0;  aCaracter = &0209;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac2;  |Y nPaso = 0;  aCaracter = &0241;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac3;  |Y nPaso = 0;  aCaracter = &0225;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac4;  |Y nPaso = 0;  aCaracter = &0225;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac5;  |Y nPaso = 0;  aCaracter = &0233;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac6;  |Y nPaso = 0;  aCaracter = &0237;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac7;  |Y nPaso = 0;  aCaracter = &0243;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac8;  |Y nPaso = 0;  aCaracter = &0250;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac9;  |Y nPaso = 0;  aCaracter = &0176;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac10; |Y nPaso = 0;  aCaracter = &0170;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac11; |Y nPaso = 0;  aCaracter = &0191;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac12; |Y nPaso = 0;  aCaracter = &0128;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac13; |Y nPaso = 0;  aCaracter = &0231;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac14; |Y nPaso = 0;  aCaracter = &0224;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac15; |Y nPaso = 0;  aCaracter = &0232;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac16; |Y nPaso = 0;  aCaracter = &0236;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac17; |Y nPaso = 0;  aCaracter = &0242;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac18; |Y nPaso = 0;  aCaracter = &0249;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac19; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac20; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac21; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac22; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac23; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac24; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac25; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac26; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac27; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac28; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac29; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac30; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac31; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac32; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac33; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac34; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac35; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac36; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac37; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac38; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac39; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;
     aAsigna = aCadena;
|FPRC;

|PROCESO Importe;    || Calculo para poner las comas en el importe
     enCanti   = nImporte;
     enSwTrata = 1;
     eaMoneda  = "EUROS  ";
     |HAZ SeparaImporte;
     aImporte   = eaImporte;
|FPRC;

|PROCESO AbreWord1;
     |DBASE aPathDocu;
     |QBF aPathDocu;
     aPathDocu = aPathDocu + "word/";

     aAlfa = eaUnidadBasico + "/MODELOS";                   |RMKDIR aAlfa;
     aAlfa = eaUnidadBasico + "/MODELOS/DOCUMENTOS";        |RMKDIR aAlfa;

     aOrigen   = aPathDocu + aDocumento;
     aDestino  = eaUnidadBasico + "/MODELOS/DOCUMENTOS/" + aDocumento;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;
     |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     nWord  = 1;
     aAbre1 = aDestino;

     |MENSA "      Abriendo el Documento, espere un Momento.";

     |WORD_ABRE nWord, aAbre1;
     nWord1 = nWord;
     |WORD_PROPIEDADES nWord1, "Visible", "NO";

     |MENSA "      Asignando Campos, espere un Momento.";
|FPRC;

|PROCESO AbreWord2;
     |DBASE aPathDocu;
     |QBF aPathDocu;
     aPathDocu = aPathDocu + "word/";

     aAlfa = eaUnidadBasico + "/MODELOS";                   |RMKDIR aAlfa;
     aAlfa = eaUnidadBasico + "/MODELOS/DOCUMENTOS";        |RMKDIR aAlfa;

     aOrigen   = aPathDocu + aDocumento;
     aDestino  = eaUnidadBasico + "/MODELOS/DOCUMENTOS/" + aDocumento;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;
     |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     nWord  = 2;
     aAbre2 = aDestino;

     |WORD_ABRE nWord, aAbre2;

     nWord2 = nWord;
     |WORD_PROPIEDADES nWord2, "Visible", "NO";
|FPRC;

|PROCESO ImprimeWord;
     |MENSA "      Imprimiendo Documento, espere un Momento.";

     aAsigna = "";
     aIdenti = "!<<PEGAR>>";
     |WORD_ASIGNA_TEXTO nWord1, aIdenti, aAsigna;

     |WORD_PROPIEDADES nWord1, "limpiafinal", "";
     |SI #rey00005#44 = "V";
         |WORD_PROPIEDADES nWord1, "Visible", "SI";
         FSalida = "NO";
         |PARA;  |SI FSalida = "NO";  |HACIENDO;
                 |PULSATECLA;
                 |WORD_PROPIEDADES nWord1, "Quit", "";
         |SIGUE;
     |SINO;
         |WORD_IMPRIME nWord1, "";
         |SLEEP 10;
         |WORD_SALVA nWord1, "";
     |FINSI;

     |RFBORRA aAbre1;
|FPRC;

|PROCESO CompletaLineas;
     |PARA nCampo = nContador; |SI nCampo [ 50; |HACIENDO nCampo = nCampo + 1;
           aAsigna = "";
           aIdenti = "!#"+ nCampo + "#";
           |WORD_ASIGNA_TEXTO nWord2, aIdenti, aAsigna;
     |SIGUE;

     |WORD_SALVA nWord2, "";

     |WORD_CARGA_TEXTO nWord1, "!<<PEGAR>>", aAbre2;
     |RFBORRA aAbre2;
|FPRC;

|PROCESO AbreOtro;
     |WORD_SALVA nWord2, "";

     |WORD_CARGA_TEXTO nWord1, "!<<PEGAR>>", aAbre2;

     |RFBORRA aAbre2;

     |HAZ AbreWord2;
|FPRC;

|PROCESO Asigna;
     |HAZ QuitaRaros;

     nContador = nContador + 1;
     aIdenti   = "!#" + nContador + "#";
     |WORD_ASIGNA_TEXTO nWord2, aIdenti, aAsigna;
     |SI FSalida ! 0;
         aAlfa1 = aAsigna;
         |HAZ AbreOtro;

         aAsigna   = "RENTA : " + (("00000" + #reacceso#0) % -105) + " " + #reacceso#1;
         nContador = 1;
         aIdenti   = "!#" + nContador + "#";
         |WORD_ASIGNA_TEXTO nWord, aIdenti, aAsigna;

         |SI nSwLiqui = 0;
             aAsigna   = "";
             nContador = 2;
             aIdenti   = "!#" + nContador + "#";
             |WORD_ASIGNA_TEXTO nWord, aIdenti, aAsigna;

             aAsigna   = aAlfa1;
             nContador = 3;
             aIdenti   = "!#" + nContador + "#";
             |WORD_ASIGNA_TEXTO nWord, aIdenti, aAsigna;
         |SINO;
             aAsigna   = "LIQUIDACION " + #rem01001#2;
             nContador = 2;
             aIdenti   = "!#" + nContador + "#";
             |WORD_ASIGNA_TEXTO nWord, aIdenti, aAsigna;

             aAsigna   = "";
             nContador = 3;
             aIdenti   = "!#" + nContador + "#";
             |WORD_ASIGNA_TEXTO nWord, aIdenti, aAsigna;

             aAsigna   = aAlfa1;
             nContador = 4;
             aIdenti   = "!#" + nContador + "#";
             |WORD_ASIGNA_TEXTO nWord, aIdenti, aAsigna;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO FiltroImpre;
     |SI nImporte = 0;  |Y #rey00005#43 = "N";
         |ACABA;
     |FINSI;

     |HAZ Asigna;
|FPRC;

|PROCESO ConverAyN;
     |SI nImporte = 0;  |Y #rey00005#43 = "N";
         |ACABA;
     |FINSI;

     |HAZ Importe;

     aAsigna = aAlfa1 + aImporte;
     |HAZ Asigna;
|FPRC;

|PROCESO ConverAyNN;
     |SI nImporte1 = 0;  |Y nImporte2 = 0;  |Y #rey00005#43 = "N";
         |ACABA;
     |FINSI;

     nImporte = nImporte1;  |HAZ Importe;  aAlfa2 = aImporte;
     nImporte = nImporte2;  |HAZ Importe;  aAlfa3 = aImporte;

     aAsigna = aAlfa1 + aAlfa2 + " " + aAlfa3;
     |HAZ Asigna;
|FPRC;

|PROCESO ConverAyD;
     |SI nImporte = 0;  |Y #rey00005#43 = "N";
         |ACABA;
     |FINSI;

     aAsigna = aAlfa1 + nImporte;
     |HAZ Asigna;
|FPRC;
