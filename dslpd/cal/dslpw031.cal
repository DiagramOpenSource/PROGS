|FICHEROS;
     dslpw031 #931;
     dslpw997 #997;
     dslpm510 #510;
     dslpm511 #511;
     dslpm523 #523;
|FIN;

|VARIABLES;
     nBoton1_1        = 0;
     nBoton1_2        = 0;
     nBoton1_3        = 0;
     nBoton1_4        = 0;
     nBoton1_5        = 0;
     nPanta1          = 0;
     nGrid1           = 0;
     nRango           = 0;
     nPos1            = 0;
     nPos2            = 0;
     nVentana         = 0;
     nHandle          = 0;
     nLong            = 0;
     nCampo           = 0;
     nPermiso         = 0;

     aFichero         = "";
     aEsc1            = "";
     aEsc2            = "";
     aRetu            = "";
     aTecla           = "";
     aAlfa            = "";
     aDirec           = "";
     aDir             = "";
     aAbre            = "";
     aLong            = "";
     aUsuario         = "";

     &enPlantilla     = 0;
     &enModo          = 0;
|FIN;

|PROCESO BajaPanta1;
     #931#0  = 00001;
|FPRC;

|PROCESO AltaPanta1;
     #931#0  = 99999;
|FPRC;

|| ------------------------------------------------------
|| Procesos del Boton 1_1
|| ------------------------------------------------------

|PROCESO Boton1_1;
     |LEE 000#931u;
     |SI FSalida ! 0;  |DDEFECTO #931;  |FINSI;

     |VENTANA 0501, 2799, -1, 1, "";
     nVentana = FSalida;

     enPlantilla = #931#0 + 1;
     enModo      = 1;
     |SUB_EJECUTA "dslpw032";

     |FINVENTANA nVentana;

     |REFRESCACONTROL nGrid1;
|FPRC;

|| ------------------------------------------------------
|| Procesos del Boton 1_2
|| ------------------------------------------------------

|PROCESO Boton1_2;
     |VENTANA 0501, 2799, -1, 1, "";
     nVentana = FSalida;

     enPlantilla = #931#0;
     enModo      = 2;
     |SUB_EJECUTA "dslpw032";

     |FINVENTANA nVentana;

     |REFRESCACONTROL nGrid1;
|FPRC;

|| ------------------------------------------------------
|| Procesos del Boton 1_3
|| ------------------------------------------------------

|PROCESO dslpm510B;
     |BORRA 020#510a;
     |LIBERA #510;
|FPRC;

|DEFBUCLE dslpm510B;
     #510#1;
     ;
     #931#0, 00001;
     #931#0, 99999;
     be;
     NULL, dslpm510B;
|FIN;

|PROCESO dslpm523B;
     |BORRA 020#523a;
     |LIBERA #523;
|FPRC;

|DEFBUCLE dslpm523B;
     #523#1;
     ;
     #931#0, 00001;
     #931#0, 99999;
     be;
     NULL, dslpm523B;
|FIN;

|PROCESO Boton1_3;
     aAlfa = "0000N" + &191 + " Esta vd.seguro de dar de baja a " + #931#1 + " ?";
     |CONFI aAlfa;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#931=;
     |SI FSalida = 0;
         |BUCLE dslpm510B;
         |BUCLE dslpm523B;

         |BORRA 020#931a;
         |LIBERA #931;
     |FINSI;

     |REFRESCACONTROL nGrid1;
|FPRC;

|| ------------------------------------------------------
|| Procesos del Boton 1_4
|| ------------------------------------------------------

|PROCESO Mete240;
     aLong = aAlfa % 0;
     nLong = aLong;
     |PARA nLong = nLong + 1;  |SI nLong [ 239;  |HACIENDO nLong = nLong + 1;
           aAlfa = aAlfa + " ";
     |SIGUE;

     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO dslpm510G;
     aAlfa = "001" + (("00000" + #510#1) % -105) + #510#3 + #510#4 + #510#5;
     |HAZ Mete240;

     aAlfa = "E00";
     |PARA nCampo = 7;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "E01";
     |PARA nCampo = 17;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     aAlfa = aAlfa + #510#219;
     aAlfa = aAlfa + #510#220;
     |HAZ Mete240;

     aAlfa = "E02";
     |PARA nCampo = 23;  |SI nCampo [ 27;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     aAlfa = aAlfa + #510#221;
     aAlfa = aAlfa + #510#222;
     aAlfa = aAlfa + #510#28;
     aAlfa = aAlfa + #510#29;
     aAlfa = aAlfa + #510#30;
     aAlfa = aAlfa + #510#31;
     |HAZ Mete240;

     aAlfa = "E03";
     |PARA nCampo = 32;  |SI nCampo [ 43;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "E04";
     |PARA nCampo = 44;  |SI nCampo [ 55;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "E05";
     |PARA nCampo = 56;  |SI nCampo [ 64;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "E06";
     |PARA nCampo = 65;  |SI nCampo [ 71;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "E07";
     |PARA nCampo = 72;  |SI nCampo [ 78;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "E08";
     |PARA nCampo = 79;  |SI nCampo [ 85;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "E09";
     |PARA nCampo = 86;  |SI nCampo [ 100;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "E10";
     |PARA nCampo = 101;  |SI nCampo [ 107;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "FD1";
     |PARA nCampo = 108;  |SI nCampo [ 112;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "FD2";
     |PARA nCampo = 113;  |SI nCampo [ 117;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "F00";
     |PARA nCampo = 119;  |SI nCampo [ 128;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "F01";
     |PARA nCampo = 129;  |SI nCampo [ 138;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "F02";
     |PARA nCampo = 139;  |SI nCampo [ 147;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "F03";
     |PARA nCampo = 148;  |SI nCampo [ 158;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "F04";
     |PARA nCampo = 159;  |SI nCampo [ 166;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "F05";
     |PARA nCampo = 167;  |SI nCampo [ 170;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "F06";
     |PARA nCampo = 171;  |SI nCampo [ 176;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "F07";
     |PARA nCampo = 177;  |SI nCampo [ 181;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "F08";
     |PARA nCampo = 182;  |SI nCampo [ 184;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "F09";
     |PARA nCampo = 185;  |SI nCampo [ 187;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "F10";
     |PARA nCampo = 188;  |SI nCampo [ 191;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "P00";
     |PARA nCampo = 193;  |SI nCampo [ 195;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "P01";
     |PARA nCampo = 196;  |SI nCampo [ 206;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "P02";
     |PARA nCampo = 207;  |SI nCampo [ 212;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "P03";
     |PARA nCampo = 213;  |SI nCampo [ 218;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #510nCampo;
     |SIGUE;
     |HAZ Mete240;

     #523#0 = #510#0;
     #523#1 = #510#1;
     |LEE 000#523=;
     |SI FSalida ! 0;  |DDEFECTO #523;  |FINSI;

     aAlfa = "C00";
     |PARA nCampo = 2;  |SI nCampo [ 3;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #523nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "C01";
     |PARA nCampo = 6;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #523nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "C02";
     |PARA nCampo = 18;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #523nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "C03";
     |PARA nCampo = 26;  |SI nCampo [ 29;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #523nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "T00";
     |PARA nCampo = 4;  |SI nCampo [ 5;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #523nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "T01";
     |PARA nCampo = 30;  |SI nCampo [ 51;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #523nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "T02";
     |PARA nCampo = 52;  |SI nCampo [ 59;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #523nCampo;
     |SIGUE;
     |HAZ Mete240;

     aAlfa = "T03";
     |PARA nCampo = 60;  |SI nCampo [ 63;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = aAlfa + #523nCampo;
     |SIGUE;
     |HAZ Mete240;
|FPRC;

|DEFBUCLE dslpm510G;
     #510#1;
     ;
     #931#0, 00001;
     #931#0, 99999;
     be;
     NULL, dslpm510G;
|FIN;

|PROCESO dslpw031;
     aAbre = aDirec + "/seg" + (("00000" + #931#0) % -105) + ".txt";
     |XABRE "CWB", aAbre, nHandle;
     |SI FSalida ] 0;
         aAlfa = "000" + (("00000" + #931#0) % -105) + #931#1;
         |HAZ Mete240;

         |ABRE #523;
         |BUCLE dslpm510G;
         |CIERRA #523;
     |FINSI;
     |XCIERRA nHandle;
|FPRC;

|DEFBUCLE dslpw031;
     #931#1;
     ;
     00001;
     99999;
     ;
     NULL, dslpw031;
|FIN;

|PROCESO Boton1_4;
     |MENAV "0000 Seleccione la Carpeta donde situaremos los ficheros exportados";

     aDirec = "D";
     |BROWSE aDirec;
     aDirec = aDirec % 290;  |QBF aDirec;
     |SI aDirec = "";  |ACABA;  |FINSI;

     |BORRA_HIJOS_PAN #0#931;
     |SUB_PINPA #0#997, nPanta1;

     aDir = aDirec + "/seg*.txt";
     |R_PDIR aDir;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |RFBORRA aDir;

          |R_SDIR aDir;
     |SIGUE;

     |BUCLE dslpw031;

     |BORRA_HIJOS_PAN #0#931;

     |MENAV "0000 Exportacion realizada.";
|FPRC;

|| ------------------------------------------------------
|| Procesos del Boton 1_5
|| ------------------------------------------------------

|PROCESO Boton1_5;
     |VENTANA 0501, 2799, -1, 1, "";
     nVentana = FSalida;

     |SUB_EJECUTA "dslpw034";

     |FINVENTANA nVentana;

     |REFRESCACONTROL nGrid1;
|FPRC;

|| ------------------------------------------------------
|| Procesos del Incio del Programa
|| ------------------------------------------------------

|PROCESO EventoPanta1;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#931=;
         |SI FSalida = 0;
             |ESTADO_CONTROL nBoton1_2, "ENABLE";
             |ESTADO_CONTROL nBoton1_3, "ENABLE";
             |ESTADO_CONTROL nBoton1_4, "ENABLE";
         |SINO;
             |ESTADO_CONTROL nBoton1_2, "DISABLE";
             |ESTADO_CONTROL nBoton1_3, "DISABLE";
             |ESTADO_CONTROL nBoton1_4, "DISABLE";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonesPanta1;
     |CONTROL_SIMPLE nPanta1, "BOTON,{{193}} Alta", 1077, 1198, Boton1_1;
     nBoton1_1 = FSalida;

     |CONTROL_SIMPLE nPanta1, "BOTON,{{197}} Modificar", 1377, 1498, Boton1_2;
     nBoton1_2 = FSalida;

     |CONTROL_SIMPLE nPanta1, "BOTON,{{199}} Baja ", 1677, 1798, Boton1_3;
     nBoton1_3 = FSalida;

     |CONTROL_SIMPLE nPanta1, "BOTON,{{217}} Exportar", 2277, 2398, Boton1_4;
     nBoton1_4 = FSalida;

     |CONTROL_SIMPLE nPanta1, "BOTON,{{218}} Importar", 2577, 2698, Boton1_5;
     nBoton1_5 = FSalida;

     |ESTADO_CONTROL nBoton1_1, "ENABLE";
     |ESTADO_CONTROL nBoton1_2, "DISABLE";
     |ESTADO_CONTROL nBoton1_3, "DISABLE";
     |ESTADO_CONTROL nBoton1_4, "DISABLE";
     |ESTADO_CONTROL nBoton1_5, "ENABLE";
|FPRC;

|PROCESO dslpm510;
     #931#0 = #510#0;
     |LEE 101#931=;
     |SI FSalida ! 0;
         |DDEFECTO #931;
         #931#0 = #510#0;
         #931#1 = #510#2;
         |GRABA 020#931n;
     |FINSI;
     |LIBERA #931;
|FPRC;

|DEFBUCLE dslpm510;
     #510#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dslpm510;
|FIN;

|PROCESO Tipo80;  |TIPO 80;
     aFichero = ("31" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #931 aFichero;
     |ABRE #931;  |CIERRA #931;  |DELINDEX #931;

     |ABRET #931;
     |BUCLE dslpm510;

     nPermiso = 0;
     aUsuario = Usuario % 810;

     |ABRE #511;
     #511#0 = aUsuario;
     |LEE 000#511=;
     |SI #511#2 = "N";
         || |MENAV "0000 Usted no tiene permiso para entrar en esta opcion";
         || nPermiso = 1;
     |FINSI;
     |CIERRA #511;

     FSalida = 2899;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |CIERRAT #931;
     |DELINDEX #931;
|FPRC;

|PROGRAMA;
     |SI nPermiso = 1;  |ACABA;  |FINSI;

     |PINPA #0#931;  nPanta1 = FSalida;

     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0902;
     nPos2  = 2665;

     |LINEAL_SIMPLE #1#931, nRango, nPos1, nPos2, BajaPanta1, AltaPanta1, EventoPanta1;
     nGrid1 = FSalida;

     |HAZ BotonesPanta1;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::Salir";
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1_1;
     |FIN_CONTROL_WINDOWS nBoton1_2;
     |FIN_CONTROL_WINDOWS nBoton1_3;
     |FIN_CONTROL_WINDOWS nBoton1_4;
     |FIN_CONTROL_WINDOWS nBoton1_5;

     |DESTRUYECONTROL nGrid1;
     |PULSATECLA;
|FPRO;
