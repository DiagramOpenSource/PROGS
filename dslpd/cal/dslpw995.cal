|FICHEROS;
     dslpm000 #0;
     dslpm001 #1;
     dslpm008 #8;
     dslpm511 #511;
     dslpw993 #993;
     dslpw995 #995;
|FIN;

|VARIABLES;
     nPanta1     = 0;
     nLen        = 0;
     nCampo      = 0;
     nCampo995   = 0;
     nPos        = 0;
     nHastaCampo = 0;
     nHandle     = 0;
     nBoton1_1   = 0;
     nCarpeta    = 0;

     aAlfa        = "";
     aAlfa1       = "";
     aDirec       = "";
     aFrom        = "";
     aTo          = "";
     aAsunto      = "";
     aMensaje     = "";
     aIPRemoto    = "";
     aSalida      = "";
     aAbre        = "";
     aOrigen      = "";
     aDestino     = "";
     aVersion1    = "";
     aVersion2    = "";
     aBase        = "";
     aCadena      = "";
     aLen         = "";
     aCaracter    = "";
     aBaseLocal   = "";
     aPara        = "";
     aDocumento   = "";
     aCliente     = "";
     aNomFichero  = "";
     aAdjunto     = "";
     aNomAdjunto  = "";
     aCarajo      = "";
     aIPLocal     = "";
     aQueSistema  = "";
     aIP          = "";
     aSmtp        = "";
     aDe          = "";
     aPathGecochek = "";
     aCarpeta      = "";
     aFichOri      = "";
     aFichDes      = "";


     &eaAlfa         = "";
     &enCliente      = 0;
     &eaNomClie      = "";
     &enDocumento    = 0;
     &enIncidencias  = 0;
     &enFormulario   = 0;
     &enPresupuesto  = 0;
     &enErrorCorreo  = 0;
     &eaClave        = "";
     &eaTipoEnvio    = "";
     &enAdministra   = 0;
     &eaGuardian     = "";
     &efFecha        = @;
     &eaBase         = "";

     {1}aContiene    = "";
     {1}aLocal       = "";

     aVer = "";
|FIN;

|PROCESO QuitaRaros;
     |QBF eaAlfa;

     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;

           |SI aCaracter = "¥";  aCaracter = &"0209"; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &0241;   |FINSI;
           |SI aCaracter = "á";  aCaracter = &0225;   |FINSI;
           |SI aCaracter = " ";  aCaracter = &0225;   |FINSI;
           |SI aCaracter = "‚";  aCaracter = &0233;   |FINSI;
           |SI aCaracter = "¡";  aCaracter = &0237;   |FINSI;
           |SI aCaracter = "¢";  aCaracter = &0243;   |FINSI;
           |SI aCaracter = "£";  aCaracter = &0250;   |FINSI;
           |SI aCaracter = "§";  aCaracter = &0176;   |FINSI;
           |SI aCaracter = "¦";  aCaracter = &0170;   |FINSI;
           |SI aCaracter = "¨";  aCaracter = &0191;   |FINSI;
           |SI aCaracter = "€";  aCaracter = &0199;   |FINSI;
           |SI aCaracter = "‡";  aCaracter = &0231;   |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena;
|FPRC;

|PROCESO CargaTexto;
     aAbre    = aBase + "documentos/correos";  |MKDIR aAbre;
     aAbre    = aAbre + "/adjunto.txt";
     |XABRE "WB", aAbre, nHandle;

     nHastaCampo = 0;
     |PARA nCampo = 16;  |SI nCampo ] 3;  |HACIENDO nCampo = nCampo - 1;
           aAlfa = #995nCampo;  |QBF aAlfa;
           |SI aAlfa ! "";
               nHastaCampo = nCampo;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nHastaCampo = 0;
         eaAlfa   = "" + &13 + &10;
         |XGRABA nHandle, eaAlfa;
     |SINO;
         |PARA nCampo995 = 3;  |SI nCampo995 [ nHastaCampo;  |HACIENDO nCampo995 = nCampo995 + 1;
               eaAlfa  = #995nCampo995;
               |HAZ QuitaRaros;
               eaAlfa = eaAlfa + &13 + &10;
               |XGRABA nHandle, eaAlfa;
         |SIGUE;
     |FINSI;
     |XCIERRA nHandle;
|FPRC;

|PROCESO CargaTexto61;
     aAbre    = aBase + "documentos/correos";  |MKDIR aAbre;
     aAbre    = aAbre + "/adjunto.txt";
     |XABRE "WB", aAbre, nHandle;

     eaAlfa = "Las preguntas y cuestionarios que se env¡an en el fichero adjunto " + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = &34 + "encuesta.doc" + &34 + " tienen la finalidad de recoger informaci¢n relevante para la " + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = "adecuaci¢n de la protecci¢n de datos de car cter personal de su instituci¢n, as¡" + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = "como la correcta elaboraci¢n del servicio que nos ha encomendado." + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;

     eaAlfa = "Esta informaci¢n tiene una importancia cr¡tica para la correcta y eficiente " + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = "realizaci¢n de la posterior adecuaci¢n a la normativa. Por favor, rogamos " + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = "respondan a las preguntas y suministren el m ximo de informaci¢n de una " + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = "forma lo m s precisa posible. Les agradecer¡amos respondan a todas " + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = "las preguntas usando el mismo formato con el que se env¡a: MS Word." + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;

     eaAlfa = "Una vez completado, les rogamos remitan una copia de este documento v¡a" + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = "correo electr¢nico a la direcci¢n joaquin.ab@diagram.es" + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;

     eaAlfa = "Para cualquier pregunta acerca de este documento o cualquier aclaraci¢n al " + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = "respecto pueden ponerse en contacto con nuestros profesionales a trav‚s de" + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = "los tel‚fonos:" + &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;

     eaAlfa = "965 33 77 43" + &13 + &10;  |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = "967 51 04 90" + &13 + &10;  |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = "968 27 13 78" + &13 + &10;  |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;
     eaAlfa = "902 10 01 77" + &13 + &10;  |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;

     eaAlfa = &13 + &10;
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;

     eaAlfa = "Muchas gracias por su colaboraci¢n.";
     |HAZ QuitaRaros;  |XGRABA nHandle, eaAlfa;

     |XCIERRA nHandle;
|FPRC;

|PROCESO CorreoEnUnix;
     aAlfa = #995#17;  |QBF aAlfa;
     |SI aAlfa ! aIPRemoto;  |ACABA;  |FINSI;

     |ESPECIFICA "RBASS", aLocal;
     aBaseLocal = aLocal;

     aDestino   = aBaseLocal + "bin/dscorreo.exe";
     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aVersion1  = FSalida;  |QBF aVersion1;

     |DBASE aBase;  |QBF aBase;
     aOrigen    = aBase + "documentos/plantillas/dscorreo.exe";
     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aVersion2  = FSalida;  |QBF aVersion2;

     |SI aVersion1 ! aVersion2;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;

     aAlfa  = "cmd " + &34 + "/c START /MIN " + aDestino + &34;
     |RSYSTEM aAlfa;
     |MENSA "         ";
     |PULSATECLA;
     |SLEEP 1;
|FPRC;

|PROCESO CorreoEnDos;
     |SI aIPRemoto ! "";  |ACABA;  |FINSI;

     |DBASE aBase;  |QBF aBase;
     aOrigen    = aBase + "documentos/plantillas/dscorreo.exe";

     aAlfa  = "cmd " + &34 + "/c START /MIN " + aOrigen + &34;
     |SYSTEM aAlfa;
     |MENSA "         ";
     |PULSATECLA;
     |SLEEP 1;
|FPRC;

|PROCESO MandaCorreo;
     |SI eaGuardian = "";
         |SI aQueSistema = "ESDOS";
             |HAZ CorreoEnDos;
             |SI aIPRemoto ! "";
                 |HAZ CorreoEnUnix;
             |FINSI;
         |SINO;
             |HAZ CorreoEnUnix;
         |FINSI;
     |FINSI;

||     aIP = "217.13.81.114";        || siempre la de DV (PRIEGO: 700000-3841)
     aIP = "192.168.14.101";        || siempre la de DV interna(CARLOS: 700000-5349)
/*
     aIP = "";
     |SI aIPRemoto ! "";
         aIP = #995#17;  |QBF aIP;
     |SINO;
         aIP = "192.168.14.10";
     |FINSI;
*/

     |SI eaGuardian = "";
         |ABRE #511;
         #511#0 = Usuario % 810;
         |LEE 000#511=;
         |SI FSalida ! 0;  |DDEFECTO #511;  |FINSI;
         |CIERRA #511;

         aFrom = #511#53; |QBF aFrom;
         |SI aFrom = "";  aFrom = "joaquin.ab@diagram.es";  |FINSI;
     |SINO;
         aFrom = #0#15; |QBF aFrom;
     |FINSI;

     aSalida  = #995#18;  |QBF aSalida;

     aTo      = #995#1;  |QBF aTo;
     eaAlfa   = #995#2;  |HAZ QuitaRaros;
     aAsunto  = eaAlfa;  |QBF aAsunto;
     aMensaje = "";

     |SI #8#14 = 61;  |HAZ CargaTexto61;  |FINSI;
     |SI #8#14 ! 61;  |HAZ CargaTexto;    |FINSI;
     aMensaje = "$$$$" + aAbre;

     |SI enDocumento ! 0;  |O eaGuardian ! "";
         aAdjunto = aDocumento;
     |SINO;
         aAdjunto = aAbre;
     |FINSI;

     || RPRIEGO: lo utilice para ver porque no enviaba correos desde
     ||          la linea de comandos (09.11.2007)
     |SI eaGuardian ! "";
          aVer = "0000******************";   |MENSA aVer;
          aVer = "0000aIP: " + aIP;     |MENSA aVer;
          aVer = "0000aSalida: " + aSalida;  |MENSA aVer;
          aVer = "0000aFrom: " + aFrom; |MENSA aVer;
          aVer = "0000aTo: " + aTo;     |MENSA aVer;
          aVer = "0000aAsunto: " + aAsunto;  |MENSA aVer;
          aVer = "0000aMensaje: " + aMensaje;     |MENSA aVer;
          aVer = "0000aAdjunto: " + aAdjunto;     |MENSA aVer;
          aVer = "0000******************";   |MENSA aVer;
     |FINSI;

     |DSCORREO_ENVIA aIP, aSalida, aFrom, aTo, aAsunto, aMensaje, aAdjunto;
     |SI FSalida < 0;
         enErrorCorreo = 1;

         |SI eaTipoEnvio = "";
             |MENAV "0000 Ha habido un error durante el envio.":
         |FINSI;
     |SINO;
         enErrorCorreo = 0;
         |SI eaTipoEnvio = "";
             |MENAV "0000 El correo se ha enviado correctamente.";
         |FINSI;
     |FINSI;

     |FBORRA aAbre;

     |SI enDocumento ! 0;
         |FBORRA aDocumento;
     |FINSI;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
     |SI FSalida = 7;  |ACABA;  |FINSI;

     aAlfa = #995#1;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000 Introduzca el PARA";
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa = #995#2;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000 Introduzca el Asunto";
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa = #995#3 + #995#4;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000 Introduzca el Cuerpo";
         |ERROR;
         |ACABA;
     |FINSI;

     |CONFI "0000SSeguro en mandar el correo";
     |SI FSalida = 0;
         |HAZ MandaCorreo;
     |FINSI;
|FPRC;

|PROCESO Tipo80;
     FSalida = 2899;
|FPRC;

|PROCESO ConfDSCorreo;
     aAlfa = #995#17;  |QBF aAlfa;
     |SI aAlfa = "";
          #995#17 = "192.168.14.10";
     |FINSI;

     aAlfa = #995#18;  |QBF aAlfa;
     |SI aAlfa = "";
         #995#18 = "asmtp.diagram.es";
     |FINSI;
|FPRC;

|PROCESO GrabaConf;
     |ABRE #995;
     aIP   = #995#17;
     aSmtp = #995#18;
     |LEE 101#995p;
     |SI FSalida ! 0;
         |DDEFECTO #995;
         |GRABA 020#995b;
     |FINSI;

     |PDEFECTO #995, 1, 17;
     #995#17 = aIP;
     #995#18 = aSmtp;
     |GRABA 020#995a;
     |LIBERA #995;
     |CIERRA #995;
|FPRC;

|PROCESO Boton1_1;
     |BORRA_HIJOS_PAN #0#995;

     |SUB_PINPA #0#993, nPanta1;

     #993#0 = #995#17;
     #993#1 = #995#18;

     |PINDA #0#993;
     |ENDATOS #2#993;
     |SI FSalida = 0;
         #995#17 = #993#0;
         #995#18 = #993#1;
     |FINSI;

     |BORRA_HIJOS_PAN #0#995;
|FPRC;

|PROCESO BotonPanta1;
     |CONTROL_SIMPLE nPanta1, "BOTON,Configurar DSCORREO", 0681, 0698, Boton1_1;
     nBoton1_1 = FSalida;
|FPRC;

|PROCESO CogeDatosCliente
     #995#19 = #1#1;
     #995#20 = #1#2;
     #995#21 = #1#15;
     #995#22 = #1#14;
|FPRC;

|PROCESO DeIncidencias;
     |CABEZA "Envio de Correo";

     |ABRE #1;
     |SELECT #2#1;
     #1#1 = enCliente;
     |LEE 000#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     |ABRE #995;
     |LEE 000#995p;
     |SI FSalida ! 0;
         |DDEFECTO #995;
     |FINSI;
     |CIERRA #995;

     #995#1 = #0#15;

     |HAZ ConfDSCorreo;

     |PDEFECTO #995, 2, 17;

     |SI enIncidencias = 1;
         #995#2  = "Incidencias en los datos del cliente: " + (("00000" + enCliente) % -105) + " " + eaNomClie;
         #995#3  = "Estimado Sr./a:";
         aAlfa   = eaNomClie;  |QBF aAlfa;
         #995#5  = "Al cliente con c¢digo: " + (("00000" + enCliente) % -105) + " y nombre " + aAlfa + ",";
         #995#6  = "le hemos detectado una serie de incidencias en sus datos, las cuales ";
         #995#7  = "relacionamos a continuaci¢n para que se corrijan en la base de datos de"
         #995#8  = "su despacho y, posteriormente, realice de nuevo el proceso de importaci¢n del";
         #995#9  = "fichero de clientes.";
         #995#11 = "Esperando sea atendida esta solicitud lo antes posible, reciba un cordial";
         #995#12 = "saludo.";
     |FINSI;

     |SI enIncidencias = 2;
         #995#2  = "Rechazo oferta LEY ORGANICA DE PROTECCION DE DATOS DE CARACTER PERSONAL";
         #995#3  = "Estimado Sr./a:";
         aAlfa   = eaNomClie;  |QBF aAlfa;
         #995#5  = "Ponemos en su conocimiento que el cliente con c¢digo: " + (("00000" + enCliente) % -105) + " y nombre ";
         #995#6  = aAlfa + ", al cual se le hab¡a remitido con ";
         #995#7  = "anterioridad una carta informativa referente a la ley de protecci¢n de datos de";
         #995#8  = "car cter personal, ha estimado en el d¡a de hoy, rechazar el servicio que se le";
         #995#9  = "ofreci¢ con la misma.";
         #995#11 = "Por lo tanto, el presente cliente queda en el apartado de CON OFERTAS RECHAZADAS";
         #995#12 = "de la aplicaci¢n dslpd, para su tratamiento personalizado del mismo.";
         #995#14 = "Reciba un cordial saludo.";
     |FINSI;

     |SI enIncidencias = 3;
         #995#2  = "Rechazo presupuesto LEY ORGANICA DE PROTECCION DE DATOS DE CARACTER PERSONAL";
         #995#3  = "Estimado Sr./a:";
         aAlfa   = eaNomClie;  |QBF aAlfa;
         #995#5  = "Ponemos en su conocimiento que el cliente con c¢digo: " + (("00000" + enCliente) % -105) + " y nombre ";
         #995#6  = aAlfa + ", al cual se le hab¡a remitido con ";
         #995#7  = "anterioridad un presupuesto referente a la ley de protecci¢n de datos de";
         #995#8  = "car cter personal, ha estimado en el d¡a de hoy, rechazar el servicio que se le";
         #995#9  = "ofreci¢ con el mismo.";
         #995#11 = "Por lo tanto, el presente cliente queda en el apartado de CON PRESUPUESTO";
         #995#12 = "RECHAZADO de la aplicaci¢n dslpd, para su tratamiento personalizado del mismo.";
         #995#14 = "Reciba un cordial saludo.";
     |FINSI;

     |HAZ CogeDatosCliente;

     |PINPA #0#995;  nPanta1 = FSalida;
     |PINDA #0#995;

     |HAZ BotonPanta1;

     |ENDATOS #1#995;
     |SI enErrorCorreo = 0;
         |HAZ GrabaConf;
     |FINSI;
     |CIERRA #995;
|FPRC;

|PROCESO DescomprimeDoc;
     aDirec   = aBase + "documentos/clientes/" + aCliente + "/correos/";
     aFichOri = aNomFichero % -430;  |QBF aFichOri;
     aFichDes = aNomAdjunto % -430;  |QBF aFichDes;
     aFichOri = aFichOri < "";
     aFichDes = aFichDes < "";

     |DESCOMPRIME aDestino;
     |DETAR aDestino, aDirec;

     aAlfa1   = aDirec + aFichDes + "tgz";      |FBORRA aAlfa1;
     aAlfa1   = aDirec + aFichDes + "tar";      |FBORRA aAlfa1;

     aOrigen  = aDirec + aFichOri + "doc";
     aDestino = aDirec + aFichDes + "doc";
     |RENOMBRA_FICHERO  aOrigen, aDestino;
|FPRC;


|PROCESO MontaDocumento;
     aDirec   = aBase + "documentos/clientes/" + aCliente + "/correos/";
     aFichOri = aNomFichero % -430;  |QBF aFichOri;
     aFichDes = aNomAdjunto % -430;  |QBF aFichDes;
     aFichOri = aFichOri < "";
     aFichDes = aFichDes < "";

     |DESCOMPRIME aDestino;
     |DETAR aDestino, aDirec;

     aAlfa1   = aDirec + aFichDes + "tgz";      |FBORRA aAlfa1;
     aAlfa1   = aDirec + aFichDes + "tar";      |FBORRA aAlfa1;

     aOrigen  = aDirec + aFichOri + "doc";
     aDestino = aDirec + aFichDes + "doc";
     |RENOMBRA_FICHERO  aOrigen, aDestino;

     aAlfa    = aDirec + aFichDes + "tar" + " " + aFichDes + "doc";
     |ATAR aAlfa, aDirec;

     aAlfa    = aDirec + aFichDes + "tar";
     |COMPRIME aAlfa;

     aDestino = aDirec + aFichDes + "tgz";

     aAlfa1   = aDirec + aFichDes + "doc";   |FBORRA aAlfa1;
     aAlfa1   = aDirec + aFichDes + "tar";   |FBORRA aAlfa1;
|FPRC;

|PROCESO DeDocumentos;
     |CABEZA "Envio de Correo";

     |ABRE #995;
     |LEE 000#995p;
     |SI FSalida ! 0;
         |DDEFECTO #995;
     |FINSI;
     |CIERRA #995;

     |HAZ ConfDSCorreo;

     |ABRE #8;
     #8#0 = enCliente;
     #8#1 = enDocumento;
     |LEE 000#8=;
     |SI FSalida ! 0;
         |CIERRA #8;
         |ACABA;
     |FINSI;
     |CIERRA #8;

     |ABRE #1;
     |SELECT #2#1;
     #1#1 = enCliente;
     |LEE 000#1=;
     |SI FSalida ! 0;
         |CIERRA #1;
         |ACABA;
     |FINSI;
     |CIERRA #1;

     |SI enAdministra = 0;
         aAlfa = #1#17;  |QBF aAlfa;
         aAlfa = aAlfa + ";" + aDe;  |QBF aAlfa;
     |SINO;
         aAlfa = aDe;
     |FINSI;

     #995#1 = aAlfa;

     aNomAdjunto = "DOCUMENTO." + #8#16;
     |SI #8#14 = 10;
         #995#2      = "Informaci¢n sobre LEY ORGANICA DE PROTECCION DE DATOS DE CARACTER PERSONAL";
         #995#3      = "Estimado Sr./a:";
         #995#5      = "De acuerdo con sus instrucciones, nos complace informarles sobre la normativa";
         #995#6      = "relativa a la protecci¢n de datos de car cter personal.";
         #995#7      = "Para ello, le rogamos encarecidamente que lea atentamente el documento adjunto";
         #995#8      = "que le remitimos con el presente correo.";
         #995#10     = "Esperando que ‚ste sea de su m ximo inter‚s, reciba un cordial saludo.";

         |SI #8#16 = "DOC";
             aNomAdjunto = "OFERTA.DOC";
         |SINO;
             aNomAdjunto = "OFERTA.TGZ";
         |FINSI;
     |FINSI;

     |SI #8#14 = 20;
         |SI enAdministra ! 0;
             |SI enAdministra = 1;
                 #995#2      = "Presupuesto realizado.";
                 #995#3      = "Presupuesto realizado.";
             |FINSI;

             |SI enAdministra = 2;
                 #995#2      = "Presupuesto aceptado.";
                 #995#3      = "Presupuesto aceptado.";
             |FINSI;

             #995#5      = "Cliente: " + (("00000" + #1#1) % -105) + " " + #1#2;
         |SINO;
             #995#2      = "Presupuesto realizado.";
             #995#3      = "Estimado Sr./a:";
             #995#5      = "Tras la aceptaci¢n de la oferta por parte de ustedes, nos complace informarles "
             #995#6      = "sobre el presupuesto relativo a la protecci¢n de datos de car cter personal.";
             #995#7      = "Para ello, le rogamos encarecidamente que lea atentamente el documento adjunto";
             #995#8      = "que le remitimos con el presente correo.";
             #995#10     = "Esperando que ‚ste sea de su m ximo inter‚s, reciba un cordial saludo.";
         |FINSI;

         |SI #8#16 = "DOC";
             aNomAdjunto = "PRESUPUESTO.DOC";
         |SINO;
             aNomAdjunto = "PRESUPUESTO.TGZ";
         |FINSI;
     |FINSI;

     |SI #8#14 = 60;
         #995#2      = "Carta de Solicitud de n£meros de inscripci¢n de los ficheros";
         #995#3      = "Estimado Sr./a:";
         #995#5      = "Para la correcta implantaci¢n de la Ley Org nica de Protecci¢n de Datos, es ";
         #995#6      = "necesario, previo al registro de los nuevos ficheros, realizar el proceso de";
         #995#7      = "supresi¢n de los anteriormente registrados en la Agencia Espa¤ola de Protecci¢n";
         #995#8      = "de Datos. Para ello se necesitan los n£meros de inscripci¢n de los ficheros, ";
         #995#9      = "por lo que tiene que enviar a la Agencia, por correo certificado y firmado por ";
         #995#10     = "el gerente, el documento adjunto a este correo. Antes curse esta solicitud, ";
         #995#11     = "antes podremos finalizar nuestro servicio.";
         #995#14     = "Reciba un cordial saludo.";

         |SI #8#16 = "DOC";
             aNomAdjunto = "SOLICITUD.DOC";
         |SINO;
             aNomAdjunto = "SOLICITUD.TGZ";
         |FINSI;
     |FINSI;

     |SI #8#14 = 61;
         #995#2  = "FORMULARIO PARA LA RECOGIDA DE DATOS PREVIA A LA ADECUACIÓN DE LA NORMATIVA EN PROTECCIÓN DE DATOS";
         #995#4  = "NO INTRODUCIR CUERPO, SE INTRODUCE INTERNAMENTE";

         |SI #8#16 = "DOC";
             aNomAdjunto = "ENCUESTA.DOC";
         |SINO;
             aNomAdjunto = "ENCUESTA.TGZ";
         |FINSI;
     |FINSI;

     |SI #8#14 = 90;
         #995#2      = "Documento de Seguridad de Ley de Proteccion de Datos";
         #995#3      = "Estimado Sr./a:";
         #995#5      = "Lea atentamente el documento adjunto que le remitimos.";
         #995#7      = "Un saludo.";

         |SI #8#16 = "DOC";
             aNomAdjunto = "SEGURIDAD.DOC";
         |SINO;
             aNomAdjunto = "SEGURIDAD.TGZ";
         |FINSI;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aCliente     = (("00000" + #8#0) % -105);
     aDestino     = aBase + "documentos/clientes/" + aCliente + "/correos";  |MKDIR aDestino;

     |SI #8#16 = "DOC";
          aNomFichero  = ("doc" + (("00000" + #8#1) % -105) + "." + #8#16) < "";
     |SINO;
          aNomFichero  = ("doc" + (("00000" + #8#1) % -105) + "." + "xgz") < "";
     |FINSI;

     aOrigen      = aBase + "documentos/clientes/" + aCliente + "/" + aNomFichero;
     aDestino     = (aDestino + "/" + aNomAdjunto) < "";

     |COPIA_FICHERO aOrigen, aDestino;

     |SI #8#14 = 61; |O #8#14 = 10; |O #8#14 = 20; |O #8#14 = 60; |O #8#14 = 90;
          ||Tiquet. 700000/4939
          ||Tiquet. 700000/5059
          |HAZ DescomprimeDoc;
     |SINO;
          |SI #8#16 = "XML";  |O #8#16 = "DOC";
              |HAZ MontaDocumento;
          |FINSI;
     |FINSI;

     aDocumento = aDestino

     |HAZ CogeDatosCliente;

     |SI eaTipoEnvio = "";
         |PINPA #0#995;  nPanta1 = FSalida;
         |PINDA #0#995;

         |HAZ BotonPanta1;

         |ENDATOS #1#995;
     |SINO;
         |HAZ MandaCorreo;
     |FINSI;

     |SI enErrorCorreo = 0;
         aAlfa = #1#17;  |QBF aAlfa;
         |ABRE #1;
         |SELECT #2#1;
         #1#1 = enCliente;
         |LEE 101#1=;
         |SI FSalida = 0;
             #1#17 = #995#1 - (";" + aDe);
             |GRABA 020#1a;
             |LIBERA #1;
         |FINSI;
         |CIERRA #1;

         |HAZ GrabaConf;
     |SINO;
         |SI enDocumento ! 0;  |Y aDocumento ! "";
            |FBORRA aDocumento;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO DeFormularios;
     |CABEZA "Envio de Correo";

     |ABRE #995;
     |LEE 000#995p;
     |SI FSalida ! 0;
         |DDEFECTO #995;
     |FINSI;
     |CIERRA #995;

     |ABRE #1;
     |SELECT #2#1;
     #1#1 = enCliente;
     |LEE 000#1=;
     |SI FSalida ! 0;
         |CIERRA #1;
         |ACABA;
     |FINSI;
     |CIERRA #1;

     |DBASS aBase;  |QBF aBase;
     aCarpeta = aBase % -204;

     nCarpeta = aCarpeta;
     |SI nCarpeta = 0;
         aCarpeta = "9999";
     |FINSI;

     eaClave = aCarpeta + (("00000" + enCliente) % -105);
     |HAZ Encripta;

     aAlfa = #1#17;  |QBF aAlfa;
     aAlfa = aAlfa + ";" + aDe;  |QBF aAlfa;

     #995#1 = aAlfa;

     |HAZ ConfDSCorreo;

     |PDEFECTO #995, 2, 17;

     #995#2  = "Formulario sobre LEY ORGANICA DE PROTECCION DE DATOS DE CARACTER PERSONAL";
     #995#3  = "Estimado Sr./a:";
     #995#5  = "Tras la aceptaci¢n por su parte de la oferta que les remitimos anteriormente ";
     #995#6  = "en relaci¢n a la Ley de Protecci¢n de Datos, procedemos a informarle de la    ";
     #995#7  = "p gina web donde deber  rellenar un formulario necesario para proceder a la ";
     #995#8  = "valoraci¢n del trabajo a relizar.";
     #995#9  = "Para ello, le rogamos pinche en el link abajo indicado y acceder  a la p gina";
     #995#10 = "web mencionada.";
     #995#11 = "http://www.geconet.net/dslpd/index.php?clau=" + eaClave;
     #995#13 = "A continuaci¢n, siga las instrucciones indicadas en ella y nos pondremos de";
     #995#14 = "nuevo en contacto con Vd.";
     #995#16 = "Reciba mientras un cordial saludo.";

     |HAZ CogeDatosCliente;

     |PINPA #0#995;  nPanta1 = FSalida;
     |PINDA #0#995;

     |HAZ BotonPanta1;

     |ENDATOS #1#995;
     |SI enErrorCorreo = 0;
         aAlfa = #1#17;  |QBF aAlfa;
         |ABRE #1;
         |SELECT #2#1;
         #1#1 = enCliente;
         |LEE 101#1=;
         |SI FSalida = 0;
             #1#17 = #995#1 - (";" + aDe);
             |GRABA 020#1a;
             |LIBERA #1;
         |FINSI;
         |CIERRA #1;

         |HAZ GrabaConf;
     |FINSI;
     |CIERRA #995;
|FPRC;

|PROCESO TodosAdm;
     aDe = "";
     |ABRE #511;
     |LEE 000#511p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          aAlfa = #511#53; |QBF aAlfa;
          |SI aAlfa ! ""; |Y #511#54 = "S";
               |SI aDe = "";
                    aDe = aAlfa;
               |SINO;
                    aDe = aDe + ";" + aAlfa;
               |FINSI;
               |QBF aDe;
          |FINSI;
          |LEE 000#511s;
     |SIGUE;
     |CIERRA #511;
     |SI aDe = "";
         aAlfa = "0000 No esta configurada la Cuenta de Correo para el Administrador";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO dslpm008;
     enDocumento = #8#1;
|FPRC;

|DEFBUCLE dslpm008;
     #8#2;
     ;
     20, enCliente, 00000;
     20, enCliente, 99999;
     ;
     NULL, dslpm008;
|FIN;

|PROCESO dslpm511;

     aAlfa = #511#53;  |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     aDe = #0#15;  |QBF aDe;

     |ABRE #995;
     |LEE 000#995p;
     |SI FSalida ! 0;
         |DDEFECTO #995;
     |FINSI;
     |CIERRA #995;

     |HAZ ConfDSCorreo;

     |PDEFECTO #995, 2, 17;

     #995#1  = #511#53;
     #995#2  = "Informe de situaciones del d¡a: " + efFecha;
     #995#3  = "Estimado Sr./a:";
     #995#5  = "Les envio el informe de situaci¢n del d¡a " + efFecha;
     #995#6  = "de la aplicaci¢n de DSLOPD situada en el directorio ";
     #995#7  = eaBase + "." + &13 + &10;
     #995#9  = "Abrir el documento TXT adjunto";

     aDocumento = eaGuardian;

     |HAZ MandaCorreo;
|FPRC;

|DEFBUCLE dslpm511;
     #511#2;
     54;
     "S", "          ", "S";
     "S", "zzzzzzzzzz", "S";
     ;
     NULL, dslpm511;
|FIN;

|PROGRAMA;
     |ABRE #0;
     |LEE 000#0p;
     |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
     |CIERRA #0;

     aIPLocal = "";
     |IP_LOCAL aIPLocal;    |QBF aIPLocal;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBF aIPRemoto;

     aQueSistema = "";
     |QUE_SISTEMA aQueSistema;  |QBF aQueSistema;

     |SI eaGuardian ! "";
         eaTipoEnvio = "NOMENSAJES";
         |BUCLE dslpm511;
         |ACABA;
     |FINSI;

     aDe = "";
     |SI enFormulario = 0;
          |ABRE #511;
          #511#0 = Usuario % 810;
          |LEE 000#511=;
          |SI FSalida ! 0;  |DDEFECTO #511;  |FINSI;
          |CIERRA #511;

          aDe = #511#53;  |QBF aDe;
          |SI aDe = "";
              aAlfa = "0000 No esta configurada la Cuenta de Correo en el Usuario " + (Usuario % 810);
              |MENAV aAlfa;
              |ACABA;
          |FINSI;
     |SINO;
          |HAZ TodosAdm;
          |SI aDe = ""; |ACABA; |FINSI;
     |FINSI;

     |SI enAdministra ! 0;
         enDocumento = 0;

         |BUCLE dslpm008;
         |SI enDocumento = 0;
             |MENAV "0000 No hay presupuesto para enviar a Administracion";
             enErrorCorreo = 0;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI enDocumento ! 0;
          |SI enAdministra ! 0;
              aDe = #0#15;  |QBF aDe;
          |SINO;
              |HAZ TodosAdm;
          |FINSI;
          |SI aDe ! ""; |HAZ DeDocumentos; |FINSI;
     |FINSI;

     |SI enIncidencias ! 0;
         |HAZ DeIncidencias;
     |FINSI;

     |SI enFormulario ! 0;
         |HAZ DeFormularios;
     |FINSI;
|FPRO;
