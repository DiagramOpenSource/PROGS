|| ---------------------------------------
|| Otros Documentos
|| ---------------------------------------

|FICHEROS;
     dslpz001 #0;
     dslpm001 #1;
     dslpm002 #2;
     dslpm004 #4;
     dslpm005 #5;
     dslpm006 #6;
     dslpm007 #7;
     dslpm008 #8;
     dslpm010 #10;
     dslpm100 #100;
|FIN;

|VARIABLES;
      aAlfa         = "";
      aDocRtf       = "";
      aNif          = "";
      aAbre         = "";
      aBase         = "";
      aIPRemoto     = "";

      nHandle       = 0;
      nSwHay        = 0;
      nPers         = 0;
      nCampo        = 0;
      nHastaCampo   = 0;

     &enCliente      = 0;
     &enModelo       = 0;
     &enFichero      = 0;
     &eaNomFichero   = "";
     &enError        = 0;
     &eaAlfa         = "";
     &eaAsigna       = "";
     &eaConten       = "";
     &eaHora         = "";
     &enWord1        = 0;
     &enCamWord      = 0;
     &enCargaPuntero = 0;
     &eaGuarda       = "";
     &enTipoDoc      = 0;
     &enDocumento    = 0;
     &enTipoOtro     = 0;
     &enTipoTipo     = 0;
     &eaDni          = "";
     &eaFecha        = "";
     &efFecha        = @;
     &enDocu         = 0;

     &eaDirPlantilla  = "";
     &eaDirTrabajo    = "";
     &eaDirTrabServi  = "";
     &eaDirSerGuarda  = "";
     &eaDirSerPlan    = "";
     &eaOrigen        = "";
     &eaDestino       = "";
     &eaDestinoTra    = "";
     &eaFicheroTra    = "";
     &eaFicheroDef    = "";
     &eaFicheroXgz    = "";
     &eaFicheroTgz    = "";
     &eaFicheroTar    = "";
     &eaFicheroTxt    = "";
     &enHandleTxt     = 0;
     &eaFicheroPlaGz  = "";
     &eaFicheroPlaMl  = "";
     &eaPathLogo      = "";
     &eaRaiz          = "";
     &eaModoPresenta  = "";
|FIN;

|PROCESO AbreDocuAD;
     |DBASE aBase;  |QBF aBase;
     |HORA eaHora;
     enDocumento    = 0;

     eaDirPlantilla = "C:\DOCUMENTOS\DSLPD\PLANTILLAS\";
     eaDirTrabajo   = "C:\DOCUMENTOS\DSLPD\DOCDSLPD\";
     eaDirSerPlan   = aBase  + "documentos/plantillas/";
     eaDirSerGuarda = aBase  + "documentos/clientes/" + (("00000" + #1#1) % -105) + "/";
     eaDirTrabServi = aBase  + "documentos/tmp/";
     eaRaiz         = eaNomFichero - ".xgz";
     eaFicheroTra   = eaRaiz + "." + "doc";
     eaFicheroXgz   = eaRaiz + ".xgz";
     eaFicheroTar   = eaRaiz + ".tar";
     eaFicheroTgz   = eaRaiz + ".tgz";
     eaFicheroTxt   = eaRaiz + ".txt";
     eaFicheroPlaGz = (eaRaiz + ".xgz") < "";
     eaFicheroPlaMl = (eaRaiz + ".doc") < "";

     |MKDIR eaDirTrabServi;

     eaOrigen       = eaDirSerPlan   + eaFicheroPlaGz;
     eaDestino      = eaDirPlantilla + eaFicheroPlaGz;
     eaDestinoTra   = eaDirTrabajo   + eaFicheroPlaGz;

     |HAZ MiraDirectorios;
     |HAZ EnviaFicheroConMD5;
     |HAZ DescomprimeFichero;

     aAbre = eaDirTrabajo + eaFicheroTra;
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         aAlfa   = "0000 El Documento " + aAbre + " no esta instalado. Instalelo.";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     aAbre = eaDirTrabServi + eaFicheroTxt;
     |XABRE "WB", aAbre, enHandleTxt;

     aAlfa = "[FICHERO]#" + eaDirTrabajo + eaFicheroTra + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;
|FPRC;

|PROCESO CierraDocuAD;
     |HAZ MiraLogos;

     aAlfa = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;

     |SI eaModoPresenta ! "N";
         aAlfa = "[IMPRESORA]#" + eaModoPresenta + &13 + &10;
         |XGRABA enHandleTxt, aAlfa;
     |FINSI;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;

     |SI aIPRemoto = "192.168.10.42";
         aAlfa = "[ERROR]" + &13 + &10;
         |XGRABA enHandleTxt, aAlfa;
     |FINSI;

     |XCIERRA enHandleTxt;

     eaOrigen  = eaDirTrabServi + eaFicheroTxt;
     eaDestino = eaDirTrabajo   + eaFicheroTxt;
     |HAZ EnviaFicheroSinMD5;

     |FBORRA eaOrigen;

     |HAZ AbreWordExterno;

     |SI eaGuarda = "S";
         |HAZ ActualizaRegistro;

         eaRaiz        = "doc" + (("00000" + #8#1) % -105);
         eaFicheroDef  = eaRaiz + ".doc";
         eaFicheroXgz  = eaRaiz + ".xgz";
         eaFicheroTar  = eaRaiz + ".tar";
         eaFicheroTgz  = eaRaiz + ".tgz";
         eaFicheroTxt  = eaRaiz + ".txt";

         |HAZ ComprimeFichero;

         eaOrigen  = eaDirSerGuarda + eaFicheroXgz;
         eaDestino = eaDirTrabajo   + eaFicheroTgz;

         |HAZ RecibeFichero;

         |RFBORRA eaDestino;
     |SINO;
         eaDestino = eaDirTrabajo + eaFicheroTxt;  |RFBORRA eaDestino;
         eaDestino = eaDirTrabajo + eaFicheroTra;  |RFBORRA eaDestino;
     |FINSI;
|FPRC;

|PROCESO OtrosDocumentos;
     |SI enTipoTipo = 0;
         |SI enTipoOtro = 1;   enTipoDoc = 70;  |FINSI;
         |SI enTipoOtro = 2;   enTipoDoc = 71;  |FINSI;
         |SI enTipoOtro = 3;   enTipoDoc = 72;  |FINSI;
         |SI enTipoOtro = 4;   enTipoDoc = 73;  |FINSI;
         |SI enTipoOtro = 5;   enTipoDoc = 74;  |FINSI;
         |SI enTipoOtro = 6;   enTipoDoc = 75;  |FINSI;
         |SI enTipoOtro = 7;   enTipoDoc = 76;  |FINSI;
         |SI enTipoOtro = 8;   enTipoDoc = 77;  |FINSI;
         |SI enTipoOtro = 9;   enTipoDoc = 78;  |FINSI;
         |SI enTipoOtro = 10;  enTipoDoc = 79;  |FINSI;
         |SI enTipoOtro = 11;  enTipoDoc = 80;  |FINSI;
         |SI enTipoOtro = 12;  enTipoDoc = 81;  |FINSI;
         |SI enTipoOtro = 13;  enTipoDoc = 82;  |FINSI;
         |SI enTipoOtro = 14;  enTipoDoc = 83;  |FINSI;

         eaModoPresenta = "P"
     |SINO;
         eaModoPresenta = "I"
     |FINSI;

     eaGuarda       = "S";

     |SI enTipoTipo = 0;
         |HAZ SacaDocumentos;
         |SI eaNomFichero = "";  |ACABA;  |FINSI;
     |FINSI;

     |HAZ AbreDocuAD;

     |ABRE #1;
     |SELECT #2#1;
     #1#1 = #0#0;
     |LEE 000#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     |ABRE #4;
     #4#0 = #0#0;
     #4#1 = 1;
     |LEE 000#4];
     |SI FSalida ! 0;  |O #4#0 ! #0#0;
         |DDEFECTO #4;
     |FINSI;
     |CIERRA #4;

     |ABRE #5;
     #5#0 = #4#0;
     #5#1 = #4#1;
     #5#2 = 1;
     |LEE 000#5];
     |SI FSalida ! 0;  |O #5#0 ! #4#0;  |O #5#1 ! #4#1;
         |DDEFECTO #5;
     |FINSI;
     |CIERRA #5;

     eaAlfa   = #1#2;             |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm001#2#";   |HAZ GrabaFicheroExterno;

     eaAlfa   = #1#3;                   |QBF eaAlfa;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm001#3#";   |HAZ GrabaFicheroExterno;

     eaAlfa   = #1#4;                   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #1#5;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + ", " + #1#6;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #1#7;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #1#8;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #1#9;   |QBF eaAlfa;  |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm001#4#";   |HAZ GrabaFicheroExterno;

     eaAlfa   = " (" + (("00" + #1#10) % -102) + (("000" + #1#11) % -103) + ") " + #1#12;
                                        |QBF eaAlfa;
                                        |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm001#12#";        |HAZ GrabaFicheroExterno;

     eaAlfa   = #1#12;                  |QBF eaAlfa;
                                        |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#1#12#SINCP#";         |HAZ GrabaFicheroExterno;

     eaAlfa   = #1#13;                  |QBF eaAlfa;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm001#13#";        |HAZ GrabaFicheroExterno;

     eaAlfa   = #4#4;                   |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm004#4#";         |HAZ GrabaFicheroExterno;

     eaAlfa   = #4#6;                   |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm004#6#";         |HAZ GrabaFicheroExterno;

     eaAlfa   = #4#14;            |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm004#14#";  |HAZ GrabaFicheroExterno;

     eaAlfa   = #10#4;             |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm010#4#";    |HAZ GrabaFicheroExterno;

     |ABRE #2;
     |SELECT #1#2;
     #2#0 = #0#0;
     #2#1 = #10#1;
     |LEE 000#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;


     eaAlfa   = #2#1;             |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm002#1#";   |HAZ GrabaFicheroExterno;

     eaAlfa   = #2#2;             |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm002#2#";   |HAZ GrabaFicheroExterno;

     eaAlfa   = #2#3;                   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #2#4;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + ", " + #2#5;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #2#6;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #2#7;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #2#8;   |QBF eaAlfa;  |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm002#4#";   |HAZ GrabaFicheroExterno;

     eaAlfa   = " (" + (("00" + #2#9) % -102) + (("000" + #2#10) % -103) + ") " + #2#11;
                                       |QBF eaAlfa;
                                        |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm002#11#";        |HAZ GrabaFicheroExterno;

     eaAlfa   = #2#12;                  |QBF eaAlfa;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm002#12#";        |HAZ GrabaFicheroExterno;

     eaAlfa   = #2#41;            |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm002#41#";   |HAZ GrabaFicheroExterno;

     |SI #5#243 ! "            ";
         |ABRE #2;
         |SELECT #1#2;
         #2#0 = #0#0;
         #2#1 = #5#243;
         |LEE 000#2=;
         |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
         |CIERRA #2;
     |SINO;
         |ABRE #2;
         |SELECT #1#2;
         #2#0 = #0#0;
         #2#1 = #4#3;
         |LEE 000#2=;
         |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
         |CIERRA #2;
     |FINSI;

     eaAlfa   = #2#11;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + ", " + #2#3;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " " + #2#4;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " " + #2#5;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " " + #2#6;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " " + #2#7;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " " + #2#8;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " (" + (("00" + #2#9) % -102) + (("000" + #2#10) % -103) + ")";
                                   |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm002#3#";    |HAZ GrabaFicheroExterno;

     |ABRE #2;
     |SELECT #1#2;
     #2#0 = #0#0;
     #2#1 = #4#15;
     |LEE 000#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     eaAlfa   = #2#2;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + ", " + #2#11;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + ", " + #2#3;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #2#4;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #2#5;   |QBF eaAlfa;
     eaAlfa   = eaAlfa + " (" + (("00" + #2#9) % -102) + (("000" + #2#10) % -103) + ")";
                                    |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm004#16#";    |HAZ GrabaFicheroExterno;

     eaAlfa   = eaAlfa + ", "  + #2#13;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "   + #2#14;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + ", "  + #2#15;  |QBF eaAlfa;
                                             |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm004#5#";    |HAZ GrabaFicheroExterno;

     efFecha  = ~;
     |HAZ SacaFecha;
     eaAlfa   = #1#12;            |QBF eaAlfa;
     eaAlfa   = eaAlfa + ", " + eaFecha;
     eaConten = eaAlfa;
     eaAsigna = "V#FECHAENTERA#";  |HAZ GrabaFicheroExterno;

     |ABRE #2;
     |SELECT #2#2;
     #2#33 = "S";
     #2#0  = #0#0;
     |LEE 000#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;


     eaAlfa = #2#2;               |QBF eaAlfa;
     eaAlfa = eaAlfa + ", titular del documento nacional de identidad n£mero " +  #2#1;  |QBF eaAlfa;
                                  |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#GERENTE#";  |HAZ GrabaFicheroExterno;

     eaAlfa   = #5#3;              |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm005#3#";    |HAZ GrabaFicheroExterno;

     aAlfa    = #5#128;  |QBF aAlfa;
     aAlfa    = aAlfa + " " + #5#129;
     aAlfa    = aAlfa + " " + #5#130;
     aAlfa    = aAlfa + " " + #5#131;
     aAlfa    = aAlfa + " " + #5#132;
     eaAlfa   = aAlfa;   |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm005#128#";    |HAZ GrabaFicheroExterno;

     aAlfa    = #5#133;  |QBF aAlfa;
     aAlfa    = aAlfa + " " + #5#134;
     aAlfa    = aAlfa + " " + #5#135;
     aAlfa    = aAlfa + " " + #5#136;
     aAlfa    = aAlfa + " " + #5#137;
     eaAlfa   = aAlfa;   |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm005#133#";    |HAZ GrabaFicheroExterno;

     |SI #5#243 ! "            ";
         eaAlfa   = #5#244;              |HAZ QuitaRaros;
     |SINO;
         eaAlfa   = #5#15;               |HAZ QuitaRaros;
     |FINSI;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm005#244#";    |HAZ GrabaFicheroExterno;

     |ABRE #100;
     |SI #5#243 ! "            ";
         #100#0 = #5#243;
     |SINO;
         #100#0 = #5#6;
     |FINSI;

     |LEE 000#100=;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;
     |CIERRA #100;

     eaAlfa   = #100#2;                 |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #100#3; |QBF eaAlfa;
     eaAlfa   = eaAlfa + ", " + #100#4; |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #100#5; |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #100#6; |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #100#7; |QBF eaAlfa;  |HAZ QuitaRaros;
     eaConten = eaAlfa;
     eaAsigna = "V#dslpm100#3#";   |HAZ GrabaFicheroExterno;

     |HAZ CierraDocuAD;

     |SELECT #1#10;
     #10#0 = #0#0;
     #10#1 = eaDni;
     #10#2 = enTipoOtro;
     |LEE 101#10=;
     |SI FSalida = 0;
         #10#5 = ~;
         #10#6 = eaHora;
         #10#7 = enDocu;
         |GRABA 020#10a;
         |LIBERA #10;
     |FINSI;

     |SELECT #2#10;

     |PULSATECLA;
|FPRC;

|PROCESO Documento93;
     enTipoDoc = 93;
     eaModoPresenta = "P"
     eaGuarda       = "S";

     |HAZ SacaDocumentos;
     |SI eaNomFichero = "";  |ACABA;  |FINSI;

     |HAZ AbreDocuAD;
     |HAZ CierraDocuAD;
     |PULSATECLA;
|FPRC;
