|FICHEROS;
     dslpm002 #2;
     dslpm004 #4;
     dslpm005 #5;
     dslpm006 #6;
     dslpw028 #928;
     dslpm002@ #999;
|FIN;

|VARIABLES;
      aFichero      = "";
      aBase         = "";
      aMas          = "";

      nCampoHasta   = 0;
      nCampoD       = 0;
      nCampoH       = 0;
      nPanta0       = 0;
      nCampo1       = 0;
      nCampo        = 0;

     &enCliente     = 0;
     &enModelo      = 0;
     &enFichero     = 0;
     &eaDepar       = "";
     &enModo        = 0;
|FIN;

|PROCESO Baja999;
     #999#0 = enCliente;
     #999#1 = "";
|FPRC;

|PROCESO Alta999;
     #999#0 = enCliente;
     #999#1 = "zzzzzzzzzzzz";
|FPRC;

|PROCESO Departamento;
     |SI enModo ! 1;  |ACABA;  |FINSI;

     |ABRE #6;
     #6#0 = enCliente;
     #6#1 = enModelo;
     #6#2 = enFichero;
     #6#3 = #928#0;
     |LEE 000#6=;
     |SI FSalida = 0;
         |MENAV "0000 El Departamento ya existe.";
         |ERROR;
     |FINSI;
     |CIERRA #6;
|FPRC;

|PROCESO dslpm002;
     |SI Campo = 2;
         |SI #2#17 ! "S";  |ACABA;  |FINSI;
     |FINSI;

     |SI Campo = 4;
         |SI #2#23 ! "S";  |ACABA;  |FINSI;
     |FINSI;

     |PARA nCampo = 0;  |SI nCampo [ 29;  |HACIENDO nCampo = nCampo + 1;
           #999nCampo = #2nCampo;
     |SIGUE;

     |GRABA 020#999n;
     |LIBERA #999;
|FPRC;

|DEFBUCLE dslpm002;
     #2#1;
     ;
     enCliente, "            ";
     enCliente, "zzzzzzzzzzzz";
     ;
     NULL, dslpm002;
|FIN;

|PROCESO CogeResponsable;  |TIPO 66;
     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dslpm002.mas";
     |CARGA_DEF aMas, dslpm002@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aFichero = ("DD" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #999 aFichero;
     |ABRE #999;  |CIERRA #999;  |DELINDEX #999;

     |ABRE #999;
     |BUCLE dslpm002;

     |LEE 000#999p;
     |SI FSalida ! 0;
         |MENAV "0000 No hay informado responsable o encargado en este apartado.";
         |ERROR;
         |CIERRA #999;
         |DELINDEX #999;
         |DESCARGA_DEF #dslpm002@;
         |ACABA;
     |FINSI;

     |CONSULTA_F_CLAVE #1#999, Baja999, Alta999;
     |SI FSalida = 0;
        #928Campo = #999#1;  |PINTA #928Campo;
     |FINSI;
     |CIERRA #999;
     |DELINDEX #999;

     |DESCARGA_DEF #dslpm002@;
     |ERROR;
|FPRC;

|PROCESO LeeResponsable;  |TIPO 0;
     nCampo1 = Campo + 1;
     |SI #928Campo = "            ";
         #928nCampo1 = "";
         |PINTA #928nCampo1;
         |ACABA;
     |FINSI;

     |ABRE #2;
     #2#0 = enCliente;
     #2#1 = #928Campo;
     |LEE 000#2=;
     |SI FSalida ! 0;
         |MENAV "0000 No existe la Persona en la Empresa";
         |ERROR;
     |SINO;
         |SI Campo = 2;
             |SI #2#17 ! "S";
                 |MENAV "0000 La persona no tiene informado responsable o encargado en este apartado.";
                 |ERROR;
             |SINO;
                 #928nCampo1 = #2#2;  |PINTA #928nCampo1;
             |FINSI;
         |FINSI;

         |SI Campo = 4;
             |SI #2#23 ! "S";
                 |MENAV "0000 La persona no tiene informado responsable o encargado en este apartado.";
                 |ERROR;
             |SINO;
                 #928nCampo1 = #2#2;  |PINTA #928nCampo1;
             |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
|FPRC;

|PROGRAMA;
     nCampoHasta = 8;
     |C_M #928, 1, "S";

     |ABRE #6;
     |SI enModo ! 1;
         #6#0 = enCliente;
         #6#1 = enModelo;
         #6#2 = enFichero;
         #6#3 = eaDepar;
         |LEE 101#6=;
         |SI FSalida ! 0;  |DDEFECTO #6; |FINSI;

         |C_M #928, 1, "N";

         |PARA nCampoD = 3;  |SI nCampoD [ nCampoHasta;   |HACIENDO nCampoD = nCampoD + 1;
               nCampoH = nCampoD - 3;
               #928nCampoH = #6nCampoD;
         |SIGUE;
     |SINO;
         |ABRE #4;
         #4#0 = enCliente;
         #4#1 = enModelo;
         |LEE 000#4=;
         |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
         |CIERRA #4;

         #928#2 = #4#5;
         #928#3 = #4#6;
         #928#4 = #4#17;
         #928#5 = #4#18;
     |FINSI;

     |CABEZA "Datos Departamento";

     |PINPA #0#928;  nPanta0 = FSalida;
     |PINDA #0#928;

     |SI enModo = 1;  |ENDATOS #1#928;  |FINSI;
     |SI enModo = 2;  |ENDATOS #2#928;  |FINSI;

     |SI FSalida = 0;
         #6#0 = enCliente;
         #6#1 = enModelo;
         #6#2 = enFichero;
         #6#3 = eaDepar;
         |LEE 101#6=;
         |SI FSalida ! 0;
             |DDEFECTO #6;
             #6#0 = enCliente;
             #6#1 = enModelo;
             #6#2 = enFichero;
             #6#3 = eaDepar;
             |GRABA 020#6b;
         |FINSI;

         |PARA nCampoD = 3;  |SI nCampoD [ nCampoHasta;  |HACIENDO nCampoD = nCampoD + 1;
               nCampoH = nCampoD - 3;
               #6nCampoD = #928nCampoH;
         |SIGUE;
         |GRABA 020#6a;
         |LIBERA #6;
     |FINSI;
     |CIERRA #6;

     |PULSATECLA;
|FPRO;
