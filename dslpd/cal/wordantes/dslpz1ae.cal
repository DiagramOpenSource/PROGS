|| ---------------------------------------
|| Presupuestos
|| ---------------------------------------

|FICHEROS;
     dslpz001 #0;
     dslpm000 #100;
     dslpm001 #1;
     dslpm011 #11;
     dslpm521 #521;
     dslpm522 #522;
     dslpw042 #942;
|FIN;

|VARIABLES;
      aAlfa         = "";
      aAlfa1        = "";
      aAlfa2        = "";
      aDocRtf       = "";
      aNif          = "";

      nHandle       = 0;
      nSwHay        = 0;
      nPers         = 0;
      nCampo        = 0;
      nHastaCampo   = 0;
      nContador     = 0;
      nNume         = 0;
      nPos          = 0;
      nPosi         = 0;
      nColumna      = 0;

     &enCliente      = 0;
     &enModelo       = 0;
     &enFichero      = 0;
     &eaNomFichero   = "";
     &enError        = 0;
     &eaAlfa         = "";
     &eaAsigna       = "";
     &eaHora         = "";
     &enWord1        = 0;
     &enCamWord      = 0;
     &enCargaPuntero = 0;
     &eaGuarda       = "";
     &enTipoDoc      = 0;
     &enDocumento    = 0;
     &eaFecha        = "";
     &efFecha        = @;
     &enPresenta     = 0;
     &eaImporte      = "";

   {500} &eaCamWord  = "";
|FIN;

|| ------------------------------------------------------
|| Procesos de la Generacion del Presupuesto
|| ------------------------------------------------------

|PROCESO dslpm011P;
     |ABRE #521;
     #521#0 = #11#2;
     |LEE 000#521=;
     |SI FSalida ! 0;  |DDEFECTO #521;  |FINSI;
     |CIERRA #521;

     |ABRE #522;
     #522#0 = #11#4;
     |LEE 000#522=;
     |SI FSalida ! 0;  |DDEFECTO #522;  |FINSI;
     |CIERRA #522;

     |SI #11#4 = 0;
         #942#12 = #942#12 + #11#8;
     |FINSI;

     |SI #11#4 = 1;
         #942#0 = #942#0 + #11#8;
         #942#1 = #522#2;
         #942#2 = #942#0 % #942#1;
         #942#3 = #942#0 + #942#2;
     |FINSI;

     |SI #11#4 = 2;
         #942#4 = #942#4 + #11#8;
         #942#5 = #522#2;
         #942#6 = #942#4 % #942#5;
         #942#7 = #942#4 + #942#6;
     |FINSI;

     |SI #11#4 = 3;
         #942#8  = #942#8 + #11#8;
         #942#9  = #522#2;
         #942#10 = #942#8 % #942#9;
         #942#11 = #942#8 + #942#10;
     |FINSI;

     #942#13 = #942#3 + #942#7 + #942#11 + #942#12;

     |SI nContador ! 1;
         aAlfa1 = "}2}2}1}+G";
         aAlfa2 = "";
         |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;

         aAlfa1 = "}2}1}1}+P";
         aAlfa2 = "";
         |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;
     |FINSI;

     nContador = nContador + 1;

     eaAlfa = #521#6;                    |QBF eaAlfa;
     eaAlfa = eaAlfa + " " + #521#7;     |QBF eaAlfa;
     eaAlfa = eaAlfa + " " + #521#8;     |QBF eaAlfa;
     eaAlfa = eaAlfa + " " + #521#9;     |QBF eaAlfa;
     eaAlfa = eaAlfa + " " + #521#10;    |QBF eaAlfa;
     |HAZ QuitaRaros;

     aAlfa1 = "}2}" + nContador + "}1}";
     aAlfa2 = eaAlfa;
     |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;

     aAlfa1 = "}2}" + nContador + "}2}";
     aAlfa2 = #522#2 + "%";
     |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;

     aAlfa1 = "}2}" + nContador + "}3}";
     eaImporte = #11#6;            |HAZ SeparaImporte;
     aAlfa2 = eaImporte;           |QBT aAlfa2;
     |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;

     aAlfa1 = "}2}" + nContador + "}4}";
     eaImporte = #11#7;            |HAZ SeparaImporte;
     aAlfa2 = eaImporte;           |QBT aAlfa2;
     |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;

     aAlfa1 = "}2}" + nContador + "}5}";
     eaImporte = #11#8;            |HAZ SeparaImporte;
     aAlfa2 = eaImporte;           |QBT aAlfa2;
     |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;
|FPRC;

|DEFBUCLE dslpm011P;
     #11#1;
     ;
     #1#1, 01;
     #1#1, 99;
     ;
     NULL, dslpm011P;
|FIN;

|PROCESO HojaValoracionP;
     |DDEFECTO #942;
     nContador = 1;
     |BUCLE dslpm011P;

     aAlfa1 = "}3}1}2}";
     nNume     = #942#0 + #942#4 + #942#8 + #942#12;
     eaImporte = nNume;                              |HAZ SeparaImporte;
     aAlfa2    = eaImporte;                          |QBT aAlfa2;
     |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;

     aAlfa1 = "}3}2}2}";
     nNume     = #942#2 + #942#6 + #942#10;
     eaImporte = nNume;                              |HAZ SeparaImporte;
     aAlfa2    = eaImporte;                          |QBT aAlfa2;
     |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;

     aAlfa1 = "}3}3}2}";
     eaImporte = #942#13;                            |HAZ SeparaImporte;
     aAlfa2    = eaImporte;                          |QBT aAlfa2;
     |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;

     nColumna = 0;
     |PARA nPos = 1;  |SI nPos [ 4;  |HACIENDO nPos = nPos + 1;
           nColumna = nColumna + 1;
           nPosi    = (nPos * 100) + 1;
           aAlfa1   = "}4}2}" + nColumna + "}";
           aAlfa2   = #1#40 % nPosi;
           |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;
     |SIGUE;

     |PARA nPos = 1;  |SI nPos [ 4;  |HACIENDO nPos = nPos + 1;
           nColumna = nColumna + 1;
           nPosi    = (nPos * 100) + 1;
           aAlfa1   = "}4}2}" + nColumna + "}";
           aAlfa2   = #1#41 % nPosi;
           |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;
     |SIGUE;

     |PARA nPos = 1;  |SI nPos [ 2;  |HACIENDO nPos = nPos + 1;
           nColumna = nColumna + 1;
           nPosi    = (nPos * 100) + 1;
           aAlfa1   = "}4}2}" + nColumna + "}";
           aAlfa2   = #1#43 % nPosi;
           |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;
     |SIGUE;

     |PARA nPos = 1;  |SI nPos [ 10;  |HACIENDO nPos = nPos + 1;
           nColumna = nColumna + 1;
           nPosi    = (nPos * 100) + 1;
           aAlfa1   = "}4}2}" + nColumna + "}";
           aAlfa2   = #1#42 % nPosi;
           |WORD_ASIGNA_TEXTO enWord1, aAlfa1, aAlfa2;
     |SIGUE;
|FPRC;

|PROCESO Presupuesto;
     |HORA eaHora;
     eaGuarda       = "S";
     enCargaPuntero = 1;
     enTipoDoc      = 20;
     enError        = 0;

     |HAZ SacaDocumentos;
     |SI eaNomFichero = "";  enError = 1;  |ACABA;  |FINSI;

     |HAZ EdicionWord;
     |SI enError = 1;  |ACABA;  |FINSI;

     |ABRE #1;
     |SELECT #2#1;
     #1#1 = enCliente;
     |LEE 000#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     eaAlfa   = #1#2;             |HAZ QuitaRaros;
     eaAsigna = "#dslpm001#2#";   |HAZ AsignaWord1;

     aAlfa = #1#4;  |QBF aAlfa;
     aAlfa = aAlfa + " " + #1#5;  |QBF aAlfa;
     |SI #1#6 ! "    ";
         aAlfa = aAlfa + ", " + #1#6;  |QBF aAlfa;
     |FINSI;
     |SI #1#7 ! "   ";
         aAlfa = aAlfa + " " + #1#7;  |QBF aAlfa;
     |FINSI;
     |SI #1#8 ! "  ";
         aAlfa = aAlfa + " " + #1#8;  |QBF aAlfa;
     |FINSI;
     |SI #1#9 ! "  ";
         aAlfa = aAlfa + " " + #1#9;  |QBF aAlfa;
     |FINSI;

     aAlfa    = aAlfa + ", " + (("00" + #1#10) % -102) + (("000" + #1#11) % -103);
     aAlfa    = aAlfa + " " + #1#12;  |QBF aAlfa;
     aAlfa    = aAlfa + " (" + #1#13;  |QBF aAlfa;
     aAlfa    = aAlfa + ")";
     eaAlfa   = aAlfa;            |HAZ QuitaRaros;
     eaAsigna = "#dslpm001#4#";   |HAZ AsignaWord1;

     eaAlfa   = #1#15;            |HAZ QuitaRaros;
     eaAsigna = "#dslpm001#15#";  |HAZ AsignaWord1;

     eaAlfa   = #1#3;             |HAZ QuitaRaros;
     eaAsigna = "#dslpm001#3#";   |HAZ AsignaWord1;

     eaAlfa   = #1#18;            |HAZ QuitaRaros;
     eaAsigna = "#dslpm001#18#";  |HAZ AsignaWord1;

     eaAlfa   = #1#21;            |HAZ QuitaRaros;
     eaAsigna = "#dslpm001#21#";  |HAZ AsignaWord1;

     eaAlfa   = #1#22;            |HAZ QuitaRaros;
     eaAsigna = "#22#";           |HAZ AsignaWord1;

     eaAlfa   = #1#23;            |HAZ QuitaRaros;
     eaAsigna = "#23#";           |HAZ AsignaWord1;

     eaAlfa   = #1#24;            |HAZ QuitaRaros;
     eaAsigna = "#24#";           |HAZ AsignaWord1;

     eaAlfa    = "";
     |SI #1#25 = "S";  eaAlfa = "X";  |FINSI;
     eaAsigna  = "#25#";           |HAZ AsignaWord1;

     eaAlfa    = "";
     |SI #1#26 = "S";  eaAlfa = "X";  |FINSI;
     eaAsigna  = "#26#";           |HAZ AsignaWord1;

     eaAlfa   = #1#27;            |HAZ QuitaRaros;
     eaAsigna = "#27#";           |HAZ AsignaWord1;

     eaAlfa    = "";
     |SI #1#28 = "S";  eaAlfa = "X";  |FINSI;
     eaAsigna  = "#28#";           |HAZ AsignaWord1;

     eaAlfa    = "";
     |SI #1#29 = "S";  eaAlfa = "X";  |FINSI;
     eaAsigna  = "#29#";           |HAZ AsignaWord1;

     eaAlfa    = "";
     |SI #1#30 = "S";  eaAlfa = "X";  |FINSI;
     eaAsigna  = "#30#";           |HAZ AsignaWord1;

     eaAlfa    = "";
     |SI #1#31 = "S";  eaAlfa = "X";  |FINSI;
     eaAsigna  = "#31#";           |HAZ AsignaWord1;

     eaAlfa    = "";
     |SI #1#32 = "S";  eaAlfa = "X";  |FINSI;
     eaAsigna  = "#32#";           |HAZ AsignaWord1;

     eaAlfa    = "";
     |SI #1#33 = "S";  eaAlfa = "X";  |FINSI;
     eaAsigna  = "#33#";           |HAZ AsignaWord1;

     eaAlfa    = "";
     |SI #1#34 = "S";  eaAlfa = "X";  |FINSI;
     eaAsigna  = "#34#";           |HAZ AsignaWord1;

     eaAlfa    = #1#35;            |HAZ QuitaRaros;
     eaAsigna  = "#35#";           |HAZ AsignaWord1;

     eaImporte = #1#36;            |HAZ SeparaImporte;
     eaAlfa    = eaImporte;
     eaAsigna  = "#dslpm001#36#";  |HAZ AsignaWord1;

     |ABRE #100;
     |LEE 000#100p;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;
     |CIERRA #100;

     eaAlfa   = #100#20;          |HAZ QuitaRaros;
     eaAsigna = "#dslpm000#20#";  |HAZ AsignaWord1;

     eaAlfa   = #100#1;           |HAZ QuitaRaros;
     eaAsigna = "#dslpm000#1#";   |HAZ AsignaWord1;

     eaAlfa   = #100#3;                  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #100#4;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + ", " + #100#5;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + ", " + #100#6;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #100#7;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " "  + #100#8;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + ", (" + (("00" + #100#9) % -102) + (("000" + #100#10) % -103) + ")";
     eaAlfa   = eaAlfa + " "  + #100#11; |QBF eaAlfa;
     eaAlfa   = eaAlfa + " ("  + #100#12; |QBF eaAlfa;
     eaAlfa   = eaAlfa + ")";
                                    |HAZ QuitaRaros;
     eaAsigna = "#dslpm000#3#";     |HAZ AsignaWord1;

     eaAlfa   = #100#2;           |HAZ QuitaRaros;
     eaAsigna = "#dslpm000#2#";   |HAZ AsignaWord1;

     efFecha  = ~;
     |HAZ SacaFecha;
     eaAlfa   = #100#11;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + ", " + eaFecha;
     eaAsigna = "#FECHAENTERA#";  |HAZ AsignaWord1;

     |HAZ HojaValoracionP;

     enPresenta = 1;
     |HAZ FinDocumentoWord;
     enPresenta = 0;

     |PULSATECLA;
|FPRC;
