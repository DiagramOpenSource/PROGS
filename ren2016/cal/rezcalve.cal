|FICHEROS;
     rezcalve;

     reacceso;
     rem01001;
     rem01002;
     rem99998;
     rem99999;

     zdat1001@;
     zdat1002@;
     rem01001@;
     rem01002@;
     zdat1033@;
     rem01033@;
|FIN;

|VARIABLES;
      aPathBase        = "";
      aPathRenta       = "";
      aPathInci        = "";
      aPath            = "";
      aDirDatos        = "";
      aBorrar          = "";
      aFichero         = "";
      aDef             = "";
      aAlfa            = "";
      aIP              = "";
      aMenu            = "";
      aAlfa1           = "";
      aAlfa2           = "";
      aVersionPrograma = "";
      aVersionMenu     = "";
      aAnyoI           = "";
      aAnyoF           = "";
      aFic             = "";
      aFicLCK          = "";
      aProg            = "";
      aHora            = "";

      nCanti           = 0;
      nCanti1          = 0;
      nCanti2          = 0;
      nRdto97          = 0;
      nSwPrint         = 0;
      nConta           = 0;
      nValor           = 0;
      nHandle          = 0;
      nDiferencia      = 0;
      nLinea           = 0;
      nCampo           = 0;
      nPorce           = 0;
      nImporte1        = 0;
      nImporte2        = 0;
      nImporte3        = 0;
      nHijos           = 0;
      nHay             = 0;
      nInteres         = 0;
      nAnyo            = 0;
      nAnyoDesde       = 0;
      nAnyoHasta       = 0;
      nDiasAnyo        = 0;
      nDias            = 0;
      nEmpresa         = 0;
      nLiq             = 0;
      nTot1            = 0;
      nTot2            = 0;
      nError           = 0;
      nVeces           = 0;
      nPausa           = 0;
      nNumInc          = 0;

      fFecha           = @;
      fFecha1          = @;
      fFecha2          = @;

     &enEmpresa    = 0;
     &enNomeDat    = 0;
     &enAnt        = 0;
     &eaPrograma   = "";
     &eaPunto      = "";
     &eaDeclarante = "";
     &eaLetra      = "";
     &eaDeDonde    = "";
     &eaLinDonde   = "";
     &eaAnyoUsu    = "";
     &eaEdadDec    = "";
     &eaPatr06     = "";
     &eaPatr07     = "";
     &eaPatr08     = "";
     &eaPatr09     = "";
     &eaPatr10     = "";
     &eaPatr11     = "";
     &eaPatr12     = "";
     &eaPatr13     = "";
     &eaPatr14     = "";
     &eaPatr15     = "";
     &eaPatr16     = "";
     &eaPatr16_1   = "";
     &eaPatr17     = "";
     &eaPatr18     = "";
     &eaPatr19     = "";
     &eaPatr20     = "";
     &eaPatr21     = "";

     &enError      = 0;
     &eaModoRenta  = "";
     &eaOrigen     = "";
     &eaDestino    = "";
     &eaUnidadBasico = "";

     &eaAzul       = "";
     &eaVerde      = "";
     &eaRojo       = "";
     &eaRosa       = "";
     &eaMarron     = "";
|FIN;

|PROCESO MiraImpre;
     |SI #rem01001#5 = "   ";  |ACABA;  |FINSI;

     |SI #rem01001#5 ! "714";
         |SI #reacceso#14 = "INACTIVO  ";
             #reacceso#14 = "NO IMPRESO";
         |FINSI;

         |SI #rem01001#6 = "S";  |Y #reacceso#14 = "NO IMPRESO";
             #reacceso#14 = "IMPRESO";
         |FINSI;

         |SI #rem01001#6 = "N";  |Y #reacceso#14 = "IMPRESO   ";
              #reacceso#14 = "PARCIAL";
         |FINSI;
     |FINSI;

     |SI #rem01001#5 = "714";
         |SI #reacceso#15 = "INACTIVO  ";
             #reacceso#15 = "NO IMPRESO";
         |FINSI;

         |SI #rem01001#6 = "S";  |Y #reacceso#15 = "NO IMPRESO";
             #reacceso#15 = "IMPRESO";
         |FINSI;

         |SI #rem01001#6 = "N";  |Y #reacceso#15 = "IMPRESO   ";
             #reacceso#15 = "PARCIAL";
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE rem01001;
     #rem01001#1;
     ;
     #reacceso#0, 00, "          ";
     #reacceso#0, 00, "zzzzzzzzzz";
     ;
     NULL, MiraImpre;
|FIN;

|PROCESO Repasa;
     |SI enEmpresa = #rem01001#0;  |ACABA;  |FINSI;

     enEmpresa = #rem01001#0;
     aAlfa     = "rezcalcu;" + #rem01001#0;
     |SUB_EJECUTA_NP aAlfa;

     |PULSATECLA;
|FPRC;

|DEFBUCLE rem01001P;
     #rem01001#1;
     5;
     00001, 00, "          ", "100";
     99999, 99, "zzzzzzzzzz", "100";
     ;
     NULL, Repasa;
|FIN;

|PROCESO BuscaIncidencias;
     |SI #rem01002@#5 = "521";  |ACABA;  |FINSI;

     #zdat1002@#0 = #rem01002@#0;
     #zdat1002@#1 = #rem01002@#1;
     #zdat1002@#2 = #rem01002@#2;
     #zdat1002@#3 = #rem01002@#3;
     #zdat1002@#4 = #rem01002@#4;
     |LEE 040#zdat1002@.=;
     |SI FSalida ! 0;   |DDEFECTO #zdat1002@;  |FINSI;

     nImporte1 = #zdat1002@#7;
     nImporte2 = #rem01002@#7;
     |SI nImporte1 ! nImporte2;
         #rem01001#0  = #rem01001@#0;
         #rem01001#1  = #rem01001@#1;
         #rem01001#2  = #rem01001@#2;
         #rem01001#5  = #rem01001@#5;
         #rem01001#7  = #rem01001@#7;
         #rem01001#37 = #rem01001@#37;
         #rem01002#5  = #rem01002@#5;
         #rem01002#6  = #rem01002@#6;
         #rem01002#7  = #rem01002@#7;
         enAnt    = #zdat1002@#7;

         |PRINT;
         nHay    = 1;
         nSwPrint = 1;
     |FINSI;
|FPRC;

|DEFBUCLE rem01002;
     #rem01002@#1005;
     ;
     #rem01001@#0, #rem01001@#1, #rem01001@#2, 00, 000;
     #rem01001@#0, #rem01001@#1, #rem01001@#2, 48, 999;   || Ver estructura y cambiar cada a¤o
     be;
     NULL, BuscaIncidencias;
|FIN;

|PROCESO Incidencias;
     nHay = 0;
     |BUCLE rem01002;

     #reacceso#0 = #rem01001@#0;
     |LEE 101#reacceso.=;

     |SI nEmpresa ! #rem01001@#0;
         #reacceso#23 = "N";
     |FINSI;

     nEmpresa = #rem01001@#0;

     |SI nHay = 1;
         nNumInc = nNumInc + 1;

         |SI #reacceso#14 = "IMPRESO   ";  |Y #reacceso#24 = "S";
             |ACABA;
         |FINSI;

         #reacceso#24 = "N";
         #reacceso#25 = "";
         #reacceso#26 = "01.01.0000";
         #reacceso#27 = "";

         |SI #reacceso#14 = "IMPRESO   ";
             #reacceso#23 = "S";
             #reacceso#20 = eaRojo;
             |GRABA 020#reacceso.a;
             |LIBERA #reacceso;

             |ACABA;
         |FINSI;

         #reacceso#14 = "NO IMPRESO";
         #reacceso#12 = " ";

         #rem01001#0 = #rem01001@#0;
         #rem01001#1 = #rem01001@#1;
         #rem01001#2 = #rem01001@#2;
         |LEE 101#rem01001.=;
         |SI FSalida = 0;
             #rem01001#5 = "";
             |GRABA 020#rem01001.a;
             |LIBERA #rem01001;
         |FINSI;

         |ABRE #rem99999;
         #rem99999#0 = #reacceso#0;
         #rem99999#1 = "rem01001";
         #rem99999#2 = "";
         |LEE 101#rem99999.=;
         |SI FSalida = 0;
             |BORRA 020#rem99999.a;
             |LIBERA #rem99999;
         |FINSI;
         |CIERRA #rem99999;
     |FINSI;

                                       #reacceso#20 = "";
     |SI #reacceso#12 = "*";           #reacceso#20 = eaAzul;    |FINSI;
     |SI #reacceso#14 = "IMPRESO   ";  #reacceso#20 = eaVerde;   |FINSI;
     |SI #reacceso#19 = "S";           #reacceso#20 = eaRosa;    |FINSI;
     |SI #reacceso#23 = "S";           #reacceso#20 = eaRojo;    |FINSI;
     |SI #reacceso#24 = "S";           #reacceso#20 = eaMarron;  |FINSI;

     |GRABA 020#reacceso.a;
     |LIBERA #reacceso;
|FPRC;

|DEFBUCLE rem01001S;
     #rem01001@#1003;
     5;
     00001, 00, "          ", "100";
     99999, 99, "zzzzzzzzzz", "100";
     ;
     NULL, Incidencias;
|FIN;

|PROCESO Borra;
     aBorrar  = aDirDatos + aFichero + ".dat";  |FBORRA aBorrar;
     aBorrar  = aDirDatos + aFichero + ".ddx";  |FBORRA aBorrar;
     aBorrar  = aDirDatos + aFichero + ".ixx";  |FBORRA aBorrar;
|FPRC;

|PROCESO BorraLiquiMala;
     aFichero = "zdat1001";  |HAZ Borra;
     aFichero = "zdat1002";  |HAZ Borra;
     aFichero = "zdat1010";  |HAZ Borra;
     aFichero = "zdat1011";  |HAZ Borra;
     aFichero = "zdat1012";  |HAZ Borra;
     aFichero = "zdat1013";  |HAZ Borra;
     aFichero = "zdat1014";  |HAZ Borra;
     aFichero = "zdat1015";  |HAZ Borra;
     aFichero = "zdat1018";  |HAZ Borra;
     aFichero = "zdat1019";  |HAZ Borra;
     aFichero = "zdat1021";  |HAZ Borra;
     aFichero = "zdat1022";  |HAZ Borra;
     aFichero = "zdat1023";  |HAZ Borra;
     aFichero = "zdat1024";  |HAZ Borra;
     aFichero = "zdat1025";  |HAZ Borra;
     aFichero = "zdat1026";  |HAZ Borra;
     aFichero = "zdat1027";  |HAZ Borra;
     aFichero = "zdat1030";  |HAZ Borra;
     aFichero = "zdat1031";  |HAZ Borra;
     aFichero = "zdat1032";  |HAZ Borra;
     aFichero = "zdat1033";  |HAZ Borra;
     aFichero = "zdat1034";  |HAZ Borra;
     aFichero = "zdat1035";  |HAZ Borra;
     aFichero = "zdat1037";  |HAZ Borra;
     aFichero = "zdat1039";  |HAZ Borra;
     aFichero = "zdat1040";  |HAZ Borra;
     aFichero = "zdat1041";  |HAZ Borra;
     aFichero = "zdat1042";  |HAZ Borra;
     aFichero = "zdat1043";  |HAZ Borra;
     aFichero = "zdat1044";  |HAZ Borra;
     aFichero = "zdat1045";  |HAZ Borra;
     aFichero = "zdat1046";  |HAZ Borra;
     aFichero = "zdat1047";  |HAZ Borra;
     aFichero = "zdat1048";  |HAZ Borra;
     aFichero = "zdat1049";  |HAZ Borra;
     aFichero = "zdat1050";  |HAZ Borra;
     aFichero = "zdat1051";  |HAZ Borra;
|FPRC;

|PROCESO CogeVersion;
     aVersionMenu = "";
     aMenu        = aPathBase + "ren2016.men";
     |XABRE "U", aMenu, nHandle;
     |SI FSalida ] 0;
         |XLEE nHandle, 250, aAlfa;
         aVersionMenu = aAlfa % -109;
     |FINSI;
     |XCIERRA nHandle;

     |QBF aVersionMenu;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
     |SI PARAMETRO = "";
         |CONFI "0000SRealizamos el proceso";
         |SI FSalida ! 0;  |ACABA;  |FINSI;
     |FINSI;

     |HAZ LeeUnidadBasico;

     fFecha = ~;
     |HORA aHora;

     #rem99998#0 = fFecha;
     #rem99998#1 = aHora;
     #rem99998#2 = Usuario % 810;
     #rem99998#3 = aVersionPrograma;
     #rem99998#4 = aVersionMenu;

     aPath = eaUnidadBasico + "/MODELOS";                   |RMKDIR aPath;
     aPath = eaUnidadBasico + "/MODELOS/DOCUMENTOS";        |RMKDIR aPath;
     aPath = eaUnidadBasico + "/MODELOS/DOCUMENTOS/";

     aFic  = (Usuario % 810);  |QBF aFic;
     aFic  = aFic + (fFecha % -104) + (fFecha % 402) + (fFecha % 102);
     aFic  = aFic + (aHora % 102) + (aHora % 402) + (aHora % 702);
     aFic  = aFic + ".pdf";

     Impresora = "CrystalReport;" + aPath + aFic;

     nError = 1;
     nVeces = 0;
     |PARA;  |SI;  |HACIENDO;
         |IMPRE -1;
         |SI FSalida = 0;  nError = 0;  |SAL;  |FINSI;
         |SI nVeces  > 10; |SAL;  |FINSI;

         nVeces = nVeces + 1;
     |SIGUE;

     |SI nError = 1;
         |MENAV "0000Problemas con su impresora y el crystal report, p¢ngase en contacto con su administrador";
         |ACABA;
     |FINSI;

     |INFOR "rezcalve";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |DFICE aDirDatos;  |QBT aDirDatos;

     |HAZ BorraLiquiMala;

     enEmpresa = 0;
     enNomeDat = 1;
     enAnt     = 0;
     |BUCLE rem01001P;

     aDef    = aPathRenta + "rem01001.mas";
     |CARGA_DEF aDef, zdat1001@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |FININF;
         |FINIMP;
         |ACABA;
     |FINSI;

     aDef    = aPathRenta + "rem01002.mas";
     |CARGA_DEF aDef, zdat1002@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |FININF;
         |FINIMP;
         |ACABA;
     |FINSI;

     aDef    = aPathRenta + "rem01001.mas";
     |CARGA_DEF aDef, rem01001@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |FININF;
         |FINIMP;
         |ACABA;
     |FINSI;

     aDef    = aPathRenta + "rem01002.mas";
     |CARGA_DEF aDef, rem01002@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |FININF;
         |FINIMP;
         |ACABA;
     |FINSI;

     aDef    = aPathRenta + "rem01033.mas";
     |CARGA_DEF aDef, zdat1033@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |FININF;
         |FINIMP;
         |ACABA;
     |FINSI;

     aDef    = aPathRenta + "rem01033.mas";
     |CARGA_DEF aDef, rem01033@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |FININF;
         |FINIMP;
         |ACABA;
     |FINSI;

     |NOME_DAT #zdat1001@#"zdat1001"#;
     |NOME_DAT #zdat1002@#"zdat1002"#;
     |NOME_DAT #rem01001@#"rem01001"#;
     |NOME_DAT #rem01002@#"rem01002"#;
     |NOME_DAT #zdat1033@#"zdat1033"#;
     |NOME_DAT #rem01033@#"rem01033"#;

     |ABRE #zdat1001@;
     |ABRE #zdat1002@;
     |ABRE #rem01001;
     |ABRE #reacceso;

     nEmpresa = 0;
     nNumInc   = 0;
     |BUCLE rem01001S;

     |CIERRA #reacceso;
     |CIERRA #rem01001;
     |CIERRA #zdat1001@;
     |CIERRA #zdat1002@;

     |DESCARGA_DEF #rem01033@;
     |DESCARGA_DEF #zdat1033@;
     |DESCARGA_DEF #rem01002@;
     |DESCARGA_DEF #rem01001@;
     |DESCARGA_DEF #zdat1002@;
     |DESCARGA_DEF #zdat1001@;

     |HAZ BorraLiquiMala;

     |ABRE #rem99998;
     #rem99998#0 = fFecha;
     #rem99998#1 = aHora;
     #rem99998#2 = Usuario % 810;
     #rem99998#3 = aVersionPrograma;
     #rem99998#4 = aVersionMenu;
     #rem99998#5 = nNumInc;

     |GRABA 020#rem99998.n;
     |LIBERA #rem99998;
     |CIERRA #rem99998;

     |DDEFECTO #rem01001;
     |DDEFECTO #rem01002;

     |SI nSwPrint = 0;
         #rem01001#0 = 0;
         #rem01001#7 = "SIN INCIDENCIAS";
         |PRINT;
     |FINSI;

     |PIEINF;
     |FININF;
     |FINIMP;

     |DBASE aPathInci;
     aPathInci = aPathInci + "incidencias";  |MKDIR aPathInci;
     aPathInci = aPathInci + "/";

     eaOrigen  = aPath + aFic;
     eaDestino = aPathInci + aFic;
     |HAZ RecibeFichero;

     |HAZ TraeDsAbreExtension;

     aFicLCK = aPath + Usuario + ".txt";
     aProg   = aPath + "dsabreextension.exe";
     |XABRE "EC", aProg, 0;
     |SI FSalida ] 0;
         aAlfa  = "START " + aProg + " " + aPath + aFic + " " + aFicLCK;
         |RSYSTEM aAlfa;

         |PARA;  |SI;  |HACIENDO;
                 |PARA nPausa = 1; |SI nPausa [ 10000; |HACIENDO nPausa = nPausa + 1;
                 |SIGUE;

                 |XABRE "EC", aFicLCK, nHandle;
                 |SI FSalida ] 0;
                     |SAL;
                 |FINSI;

                 |PULSATECLA;
         |SIGUE;
     |SINO;
         |MENAV "0000No se ha podido copiar el dsabreextension, pongase en contacto con su administrador.";
     |FINSI;

     |RFBORRA aFicLCK;

     aAlfa  = aPath + aFic;
     |RFBORRA aAlfa;
|FPRC;

|PROGRAMA;
     |HAZ CargaColores;

     |DBASE aPathRenta;  |QBT aPathRenta;
     aPathBase  = aPathRenta;
     aPathRenta = aPathRenta + "def/";

     |HAZ CogeVersion;

     |ABRE #rezcalve;
     #rezcalve#0 = 1;
     |LEE 101#rezcalve.=;
     |SI FSalida ! 0;
         |DDEFECTO #rezcalve;
         #rezcalve#0 = 1;
         #rezcalve#3 = aVersionMenu;
         |GRABA 020#rezcalve.b;
     |FINSI;

     aVersionPrograma = #rezcalve#3;   |QBF aVersionPrograma;

     |SI aVersionMenu = "36.00.000";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.001";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.002";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.004";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.006";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.008";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.010";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.013";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.015";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.019";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.020";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.021";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.022";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.023";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.024";  aVersionPrograma = aVersionMenu;  |FINSI;
     |SI aVersionMenu = "36.00.025";  aVersionPrograma = aVersionMenu;  |FINSI;

     |SUB_EJECUTA_NP "ver00001";
     |SI enError > 0;
         |MENAV "0000Hay patrones que no se ajustan a la versi¢n, consulte con su administrador";
     |SINO;
         #rezcalve#2 = "N";
         #rezcalve#4 = "N";

         |SI PARAMETRO ! "";
             |SI aVersionPrograma ! aVersionMenu;
                 |MENAV "0000Se ha detectado una versi¢n nueva, se va ejecutar las incidencias de la versi¢n";

                 |HAZ Tipo12;
             |FINSI;
         |SINO;
             |CLS;
             |CABEZA "Verificacion  de Version";
             |PINPA #0#rezcalve;
             |PINDA #0#rezcalve;
             |ENDATOS #1#rezcalve;
         |FINSI;

         #rezcalve#3 = aVersionMenu;
         |GRABA 020#rezcalve.a;
     |FINSI;
     |LIBERA #rezcalve;
     |CIERRA #rezcalve;

     |PULSATECLA;

     enNomeDat = 0;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     FSalida = 3699;
|FPRC;
