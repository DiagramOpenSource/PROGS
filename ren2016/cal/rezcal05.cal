|FICHEROS;
      rem01033@;
      rem01037@;
      rem01035@;
      rem01045@;
      rem01047@;

     &refere1@;
     &refere2@;
     &refere3@;
|FIN;

|VARIABLES;
|FIN;

|INCLUYE i_varcal;

|PROCESO rem01035;
     |SI #rem01035@#3 = 1;
         nExcesoT = nExcesoT  + #rem01035@#7;
         nAportaT = nAportaT  + #rem01035@#6;
     |FINSI;

     |SI #rem01035@#3 = 2;
         nExcesoC = nExcesoC  + #rem01035@#7;
         nAportaC = nAportaC  + #rem01035@#6;
     |FINSI;
|FPRC;

|DEFBUCLE rem01035;
     #rem01035@#1004;
     ;
     #refere1@#0, #refere1@#1, #refere1@#2, 001;
     #refere1@#0, #refere1@#1, #refere1@#2, 999;
     ;
     NULL, rem01035;
|FIN;

|PROCESO rem01037;
     |SI enConta < 7;
         nExcesoT   = nExcesoT   + #rem01037@#5;
         nAportaT   = nAportaT   + #rem01037@#6;
         nSeguroT   = nSeguroT   + #rem01037@#12;
         enValorTit = enValorTit  + #rem01037@#7;
     |SINO;
         |SI #rem01037@#3 = 1;
             nExcesoT   = nExcesoT   + #rem01037@#5;
             nAportaT   = nAportaT   + #rem01037@#6;
             nSeguroT   = nSeguroT   + #rem01037@#12;
             enValorTit = enValorTit  + #rem01037@#7;
         |FINSI;

         |SI #rem01037@#3 = 2;
             nExcesoC   = nExcesoC  + #rem01037@#5;
             nAportaC   = nAportaC  + #rem01037@#6;
             nSeguroC   = nSeguroC  + #rem01037@#12;
             enValorCon = enValorCon + #rem01037@#7;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE rem01037;
     #rem01037@#1004;
     ;
     #refere1@#0, #refere1@#1, #refere1@#2, 001;
     #refere1@#0, #refere1@#1, #refere1@#2, 999;
     ;
     NULL, rem01037;
|FIN;

|PROCESO rem01045;
     |SI enConta < 7;
         nExcesoT = nExcesoT  + #rem01045@#6;
         nAportaT = nAportaT  + #rem01045@#9 + #rem01045@#10;
     |SINO;
         |SI #rem01045@#3 = 1;
             nExcesoT = nExcesoT  + #rem01045@#6;
             nAportaT = nAportaT  + #rem01045@#9 + #rem01045@#10;
         |FINSI;

         |SI #rem01045@#3 = 2;
             nExcesoC = nExcesoC + #rem01045@#6;
             nAportaC = nAportaC  + #rem01045@#9 + #rem01045@#10;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE rem01045;
     #rem01045@#1004;
     ;
     #refere1@#0, #refere1@#1, #refere1@#2, 001;
     #refere1@#0, #refere1@#1, #refere1@#2, 999;
     ;
     NULL, rem01045;
|FIN;

|PROCESO rem01047;
     |SI enConta < 7;
         nExcesoT = nExcesoT  + #rem01047@#5;
         nAportaT = nAportaT  + #rem01047@#6;
     |SINO;
         |SI #rem01047@#3 = 1;
             nExcesoT = nExcesoT  + #rem01047@#5;
             nAportaT = nAportaT  + #rem01047@#6;
         |FINSI;

         |SI #rem01045@#3 = 2;
             nExcesoC = nExcesoC  + #rem01047@#5;
             nAportaC = nAportaC  + #rem01047@#6;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE rem01047;
     #rem01047@#1004;
     ;
     #refere1@#0, #refere1@#1, #refere1@#2, 001;
     #refere1@#0, #refere1@#1, #refere1@#2, 999;
     ;
     NULL, rem01047;
|FIN;

|PROCESO CalculaJ;
     aDef    = eaPathDef + "rem01033.mas";
     |CARGA_DEF aDef, rem01033@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #rem01033@#"zdat1033"#;  |FINSI;

     aDef    = eaPathDef + "rem01037.mas";
     |CARGA_DEF aDef, rem01037@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |DESCARGA_DEF #rem01033@;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #rem01037@#"zdat1037"#;  |FINSI;

     aDef    = eaPathDef + "rem01035.mas";
     |CARGA_DEF aDef, rem01035@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |DESCARGA_DEF #rem01037@;
         |DESCARGA_DEF #rem01033@;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #rem01035@#"zdat1035"#;  |FINSI;

     aDef    = eaPathDef + "rem01045.mas";
     |CARGA_DEF aDef, rem01045@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;

         |DESCARGA_DEF #rem01035@;
         |DESCARGA_DEF #rem01037@;
         |DESCARGA_DEF #rem01033@;

         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #rem01045@#"zdat1045"#;  |FINSI;

     aDef    = eaPathDef + "rem01047.mas";
     |CARGA_DEF aDef, rem01047@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |DESCARGA_DEF #rem01045@;
         |DESCARGA_DEF #rem01035@;
         |DESCARGA_DEF #rem01037@;
         |DESCARGA_DEF #rem01033@;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #rem01047@#"zdat1047"#;  |FINSI;

     |ABRE #rem01033@;
     #rem01033@#0 = #refere1@#0;
     #rem01033@#1 = #refere1@#1;
     #rem01033@#2 = #refere1@#2;
     |LEE 101#rem01033@.=;
     |SI FSalida ! 0;
         |DDEFECTO #rem01033@;
         #rem01033@#0 = #refere1@#0;
         #rem01033@#1 = #refere1@#1;
         #rem01033@#2 = #refere1@#2;
         |GRABA 020#rem01033@.b;
     |FINSI;

     #rem01033@#66      = (N\ #rem01033@#44);
     #rem01033@#67      = 0;
     #rem01033@#68      = 0;
     #rem01033@#69      = 0;
     #rem01033@#70      = 0;
     #rem01033@#71      = 0;
     #rem01033@#72      = 0;
     #rem01033@#73      = 0;

     |SI #rem01033@#66 > 0;
         nResta = #rem01033@#66;

         |SI #rem01033@#51 ! 0;
             |SI #rem01033@#51 [ nResta;
                 #rem01033@#67  = #rem01033@#51;
                 nResta = nResta - #rem01033@#51;
             |SINO;
                 #rem01033@#67  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         |SI nResta ! 0;  |Y #rem01033@#52 ! 0;
             |SI #rem01033@#52 [ nResta;
                 #rem01033@#68  = #rem01033@#52;
                 nResta = nResta - #rem01033@#52;
             |SINO;
                 #rem01033@#68  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         |SI nResta ! 0;  |Y #rem01033@#55 ! 0;
             |SI #rem01033@#55 [ nResta;
                 #rem01033@#69  = #rem01033@#55;
                 nResta = nResta - #rem01033@#55;
             |SINO;
                 #rem01033@#69  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         |SI nResta ! 0;  |Y #rem01033@#56 ! 0;
             |SI #rem01033@#56 [ nResta;
                 #rem01033@#70  = #rem01033@#56;
                 nResta = nResta - #rem01033@#56;
             |SINO;
                 #rem01033@#70  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         |SI nResta ! 0;  |Y #rem01033@#59 ! 0;
             |SI #rem01033@#59 [ nResta;
                 #rem01033@#71  = #rem01033@#59;
                 nResta = nResta - #rem01033@#59;
             |SINO;
                 #rem01033@#71  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         |SI nResta ! 0;  |Y #rem01033@#62 ! 0;
             |SI #rem01033@#62 [ nResta;
                 #rem01033@#72  = #rem01033@#62;
                 nResta = nResta - #rem01033@#62;
             |SINO;
                 #rem01033@#72  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         |SI nResta ! 0;  |Y #rem01033@#63 ! 0;
             |SI #rem01033@#63 [ nResta;
                 #rem01033@#73  = #rem01033@#63;
                 nResta = nResta - #rem01033@#63;
             |SINO;
                 #rem01033@#73  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #rem01033@#44 < 0;
         #rem01033@#75 = #rem01033@#44;
     |SINO;
         #rem01033@#75 = (N\ #rem01033@#44 - #rem01033@#67 - #rem01033@#68 - #rem01033@#69 - #rem01033@#70 - #rem01033@#71 - #rem01033@#72 - #rem01033@#73);
         |SI #rem01033@#75 < 0;  #rem01033@#75 = 0;  |FINSI;
     |FINSI;

     |SI #rem01033@#75 > 0;
         |SI #rem01033@#76 > #rem01033@#75;
             #rem01033@#76  = #rem01033@#75;
         |FINSI;
     |SINO;
         #rem01033@#76 = 0;
     |FINSI;

     #rem01033@#77  = (N\ #rem01033@#75 - #rem01033@#76);

     #rem01033@#78  = (N\ #rem01033@#50);
     #rem01033@#79  = 0;
     #rem01033@#80  = 0;
     #rem01033@#81  = 0;

     |SI #rem01033@#78 > 0;
         nResta     = #rem01033@#78;
         nRemanente = #rem01033@#51 - #rem01033@#67;
         |SI nRemanente > 0;
             |SI nRemanente [ nResta;
                 #rem01033@#79  = nRemanente;
                 nResta = nResta - nRemanente;
             |SINO;
                 #rem01033@#79  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         nRemanente = #rem01033@#62 - #rem01033@#72;
         |SI nRemanente > 0;  |Y nResta > 0;
             |SI nRemanente [ nResta;
                 #rem01033@#80  = nRemanente;
                 nResta = nResta - nRemanente;
             |SINO;
                 #rem01033@#80  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;
     |FINSI;

     #rem01033@#81 = (N\ #rem01033@#78 - #rem01033@#79 - #rem01033@#80);

     nAportaT   = 0;
     nAportaC   = 0;
     nSeguroT   = 0;
     nSeguroC   = 0;
     nExcesoT   = 0;
     nExcesoC   = 0;
     enValorTit = 0;
     enValorCon = 0;
     |BUCLE rem01037;

     |SI nExcesoT > enValorTit;  nExcesoT = enValorTit;  |FINSI;
     |SI nExcesoC > enValorCon;  nExcesoC = enValorCon;  |FINSI;

     nValor = #rem01033@#68;
     nResta = nValor - nExcesoT;
     |SI nResta ] 0;
         enValorTit = enValorTit - nExcesoT;
     |FINSI;

     |SI nResta > 0;
         |SI nResta > nExcesoC;
             nResta     = nResta    - nExcesoC;
             enValorCon = enValorCon - nExcesoC;
         |SINO;
             nResta = 0;
         |FINSI;
     |FINSI;

     |SI enValorTit < 0;  enValorTit = 0;  |FINSI;
     |SI enValorCon < 0;  enValorCon = 0;  |FINSI;

     |SI nResta > 0;
         nPorce   = (enValorTit / (enValorTit + enValorCon)) * 100;
         |SI nPorce = 100;  |O nPorce = 0;
             |SI nAportaT ] nResta;
                 nAportaT = nAportaT - nResta;
                 nResta   = 0;
             |SINO;
                 |SI nAportaT > 0;
                     nResta   = nResta - nAportaT;
                     nAportaT = 0;
                 |FINSI;
             |FINSI;

             |SI nResta > 0;
                 |SI nAportaC ] nResta;
                     nAportaC = nAportaC - nResta;
                     nResta   = 0;
                 |SINO;
                     |SI nAportaC > 0;
                         nResta   = nResta - nAportaC;
                         nAportaC = 0;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |SINO;
            |SI nAportaT ! 0;  |Y nAportaC ! 0;
                nResta1  = (nResta % nPorce) ! 2;
                nAportaT = nAportaT - nResta1;
                nAportaC = nAportaC - (nResta - nResta1);
                nResta   = nResta   - (nAportaT + nAportaC);
            |FINSI;
         |FINSI;
     |FINSI;

     |SI nResta > 0;
         nPorce   = (enValorTit / (enValorTit + enValorCon)) * 100;
         |SI nPorce = 100;  |O nPorce = 0;
             |SI nSeguroT ] nResta;
                 nSeguroT = nSeguroT - nResta;
                 nResta   = 0;
             |SINO;
                 |SI nSeguroT > 0;
                     nResta   = nResta - nSeguroT;
                     nSeguroT = 0;
                 |FINSI;
             |FINSI;

             |SI nResta > 0;
                 |SI nSeguroC ] nResta;
                     nSeguroC = nSeguroC - nResta;
                     nResta   = 0;
                 |SINO;
                     |SI nSeguroC > 0;
                         nResta   = nResta - nSeguroC;
                         nSeguroC = 0;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |SINO;
            |SI nSeguroT ! 0;  |Y nSeguroC ! 0;
                nResta1  = (nResta % nPorce) ! 2;
                nSeguroT = nSeguroT - nResta1;
                nSeguroC = nSeguroC - (nResta - nResta1);
                nResta   = nResta   - (nSeguroT + nSeguroC);
            |FINSI;
         |FINSI;
     |FINSI;

     nSumaT = nAportaT + nSeguroT;
     nSumaC = nAportaC + nSeguroC;

     |SI nSumaT > 0;  |Y nSumaC > 0;
         #rem01033@#82  = "TITULAR";
         #rem01033@#83  = nAportaT;
         #rem01033@#133 = nSeguroT;

         #rem01033@#84  = "CONYUGE";
         #rem01033@#85  = nAportaC;
         #rem01033@#134 = nSeguroC;
     |SINO;
         |SI nSumaT > 0;
             #rem01033@#82  = "TITULAR";
             #rem01033@#83  = nAportaT;
             #rem01033@#133 = nSeguroT;
         |FINSI;

         |SI nSumaC > 0;
             #rem01033@#82  = "CONYUGE";
             #rem01033@#83  = nAportaC;
             #rem01033@#133 = nSeguroC;
         |FINSI;
     |FINSI;

     nPdte = #rem01033@#56 - #rem01033@#70;
     |SI nPdte > 0;
         nAportaT = 0;
         nAportaC = 0;
         nExcesoT = 0;
         nExcesoC = 0;
         |BUCLE rem01045;

         |SI nPdte = 0;
             nAportaT = 0;
             nAportaC = 0;
         |SINO;
             nResta  = (nAportaT + nAportaC) - (#rem01033@#70 - nExcesoT - nExcesoC);
             |SI nResta [ 0;
                 nResta   = 0;
                 nAportaT = 0;
                 nAportaC = 0;
             |FINSI;

             nValor = nAportaT + nAportaC;
             |SI nResta > nValor;
                 nResta = nValor;
             |FINSI;

             |SI nResta > 0;
                 |SI nResta ] nAportaT;
                     nResta   = nResta - nAportaT;
                 |SINO;
                     nAportaT = nResta;
                     nResta   = 0;
                 |FINSI;
             |FINSI;

             |SI nResta > 0;
                 |SI nResta > nAportaC;
                     nResta   = nResta - nAportaC;
                 |SINO;
                     nAportaC = nResta;
                     nResta   = 0;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nAportaT ! 0;  |Y nAportaC ! 0;
             #rem01033@#86 = "TITULAR";
             #rem01033@#87 = nAportaT;

             #rem01033@#88 = "CONYUGE";
             #rem01033@#89 = nAportaC;
         |SINO;
             |SI nAportaT ! 0;
                 #rem01033@#86 = "TITULAR";
                 #rem01033@#87 = nAportaT;
             |FINSI;

             |SI nAportaC ! 0;
                 #rem01033@#86 = "CONYUGE";
                 #rem01033@#87 = nAportaC;
             |FINSI;
         |FINSI;
     |FINSI;

     nPdte = #rem01033@#59 - #rem01033@#71;
     |SI nPdte > 0;
         nAportaT = 0;
         nExcesoT = 0;
         nAportaC = 0;
         nExcesoC = 0;
         |BUCLE rem01035;

         nValor = #rem01033@#59 - #rem01033@#71;
         |SI nValor = 0;
             nAportaT = 0;
             nAportaC = 0;
         |SINO;
             nResta  = (nAportaT + nAportaC) - (#rem01033@#71 - nExcesoT - nExcesoC);
             |SI nResta [ 0;
                 nResta   = 0;
                 nAportaT = 0;
                 nAportaC = 0;
             |FINSI;

             nValor = nAportaT + nAportaC;
             |SI nResta > nValor;
                 nResta = nValor;
             |FINSI;

             |SI nResta [ 0;
                 nResta   = 0;
                 nAportaT = 0;
                 nAportaC = 0;
             |FINSI;

             |SI nResta > 0;
                 |SI nResta ] nAportaT;
                     nResta   = nResta - nAportaT;
                 |SINO;
                     nAportaT = nResta;
                     nResta   = 0;
                 |FINSI;
             |FINSI;

             |SI nResta > 0;
                 |SI nResta > nAportaC;
                     nResta   = nResta - nAportaC;
                 |SINO;
                     nAportaC = nResta;
                     nResta   = 0;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nAportaT ! 0;  |Y nAportaC ! 0;
             #rem01033@#90 = "TITULAR";
             #rem01033@#91 = nAportaT;

             #rem01033@#92 = "CONYUGE";
             #rem01033@#93 = nAportaC;
         |SINO;
             |SI nAportaT ! 0;
                 #rem01033@#90 = "TITULAR";
                 #rem01033@#91 = nAportaT;
             |FINSI;

             |SI nAportaC ! 0;
                 #rem01033@#90 = "CONYUGE";
                 #rem01033@#91 = nAportaC;
             |FINSI;
         |FINSI;
     |FINSI;

     nPdte = #rem01033@#63 - #rem01033@#73;
     |SI nPdte > 0;
         nAportaT = 0;
         nAportaC = 0;
         nExcesoT = 0;
         nExcesoC = 0;
         |BUCLE rem01047;

         nValor = #rem01033@#63 - #rem01033@#73;
         |SI nValor = 0;
             nAportaT = 0;
             nAportaC = 0;
         |SINO;
             nResta  = (nAportaT + nAportaC) - (#rem01033@#73 - nExcesoT - nExcesoC);
             |SI nResta [ 0;
                 nResta   = 0;
                 nAportaT = 0;
                 nAportaC = 0;
             |FINSI;

             nValor = nAportaT + nAportaC;
             |SI nResta > nValor;
                 nResta = nValor;
             |FINSI;

             |SI nResta [ 0;
                 nResta   = 0;
                 nAportaT = 0;
                 nAportaC = 0;
             |FINSI;

             |SI nResta > 0;
                 |SI nResta ] nAportaT;
                     nResta   = nResta - nAportaT;
                 |SINO;
                     nAportaT = nResta;
                     nResta   = 0;
                 |FINSI;
             |FINSI;

             |SI nResta > 0;
                 |SI nResta > nAportaC;
                     nResta   = nResta - nAportaC;
                 |SINO;
                     nAportaC = nResta;
                     nResta   = 0;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nAportaT ! 0;  |Y nAportaC ! 0;
             #rem01033@#94 = "TITULAR";
             #rem01033@#95 = nAportaT;

             #rem01033@#94 = "CONYUGE";
             #rem01033@#95 = nAportaC;
         |SINO;
             |SI nAportaT ! 0;
                 #rem01033@#94 = "TITULAR";
                 #rem01033@#95 = nAportaT;
             |FINSI;

             |SI nAportaC ! 0;
                 #rem01033@#96 = "CONYUGE";
                 #rem01033@#97 = nAportaC;
             |FINSI;
         |FINSI;
     |FINSI;

     |GRABA 020#rem01033@.a;
     |LIBERA #rem01033@;

     enSwAcum   = 0;
     enBloque   = 38;
     eaCasilla  = "392";  enImporte = #rem01033@#66;   |HAZ GrabaLineal;
     eaCasilla  = "438";  enImporte = #rem01033@#67;   |HAZ GrabaLineal;
     eaCasilla  = "439";  enImporte = #rem01033@#68;   |HAZ GrabaLineal;
     eaCasilla  = "440";  enImporte = #rem01033@#69;   |HAZ GrabaLineal;
     eaCasilla  = "441";  enImporte = #rem01033@#70;   |HAZ GrabaLineal;
     eaCasilla  = "442";  enImporte = #rem01033@#71;   |HAZ GrabaLineal;
     eaCasilla  = "443";  enImporte = #rem01033@#72;   |HAZ GrabaLineal;
     eaCasilla  = "444";  enImporte = #rem01033@#73;   |HAZ GrabaLineal;
     eaCasilla  = "445";  enImporte = #rem01033@#75;   |HAZ GrabaLineal;
     eaCasilla  = "446";  enImporte = #rem01033@#76;   |HAZ GrabaLineal;
     eaCasilla  = "450";  enImporte = #rem01033@#77;   |HAZ GrabaLineal;

     enBloque   = 39;
     eaCasilla  = "405";  enImporte = #rem01033@#78;   |HAZ GrabaLineal;
     eaCasilla  = "451";  enImporte = #rem01033@#79;   |HAZ GrabaLineal;
     eaCasilla  = "452";  enImporte = #rem01033@#80;   |HAZ GrabaLineal;
     eaCasilla  = "455";  enImporte = #rem01033@#81;   |HAZ GrabaLineal;

     |DESCARGA_DEF #rem01047@;
     |DESCARGA_DEF #rem01045@;
     |DESCARGA_DEF #rem01035@;
     |DESCARGA_DEF #rem01037@;
     |DESCARGA_DEF #rem01033@;
|FPRC;
