|FICHEROS;
     dstez001 #0;
     dstem001 #1;
     dstem002 #2;
     dstem003 #3;
     dstem004 #4;
     dstem000 #100;

     dstem500 #500;
     dstem501 #501;

     :/contagen/def/cacuenta #1100;
     :/dscomer9/def/agifa024 #1101;
     :/dscomer9/def/agifa112 #1102;
     :/dscomer9/def/agifa134 #1103;
     :/dscomer9/def/agifa079 #1104;
     :/dscomer9/def/agifa066 #1166;

     dstew001 #901;
     dstew003 #903,MANTE;
     dstew004 #904;
|FIN;

|VARIABLES;
     &enSwDentro = 0;
     nSalida = 0;
     fMovMayor = @;
     aMensaje = "";

     nRango         = 0;
     nPos1          = 0;
     nPos2          = 0;
     nApertura      = 0;
     nSw            = 0;
     nSwAcum        = 0;
     nCierro        = 0;
     nSaldo         = 0;
     nNume          = 0;
     nDCaja         = 0;
     nHCaja         = 0;
     nLen           = 0;
     nCampo         = 0;
     nPos           = 0;
     nLinea         = 0;
     nSaldoCaja     = 0;
     nImpo          = 0;

     nBoton1_0      = 0;
     nBoton1_1      = 0;
     nBoton1_2      = 0;
     nBoton2_0      = 0;

     aEsc1          = "";
     aEsc2          = "";
     aRetu          = "";
     aTecla         = "";
     aBase          = "";
     aPathTesor     = "";
     aAcceso        = "";
     aPathFich      = "";
     aAlfa          = "";
     aOrigen        = "";
     aDestino       = "";
     aIPRemoto      = "";
     aAsigna        = "";
     aLen           = "";
     aCaracter      = "";
     aCadena        = "";

     fFechaCierre   = @;

     &enPanta0      = 0;
     &enPanta1      = 0;
     &enPanta2      = 0;
     &enPanta3      = 0;
     &enPanta4      = 0;
     &enFoco1       = 0;
     &enFoco2       = 0;
     &enFoco3       = 0;
     &enFoco4       = 0;
     &enDentro4     = 0;
     &enDentro902   = 0;
     &enGrid1       = -1;
     &enGrid2       = -1;
     &enGrid3       = -1;

     &fApertura = @;
     &nSaldoI = 0;
     &fCierre = @;
     &nSaldoC = 0;
     &nSaldoAc = 0;
     &aCaja = "";
     &nEntradaLin = 0;
     &nSalidaLin = 0;
     &nSaldoLin = 0;
|FIN;

|| Informe -----------------------------------------------------------------

|PROCESO CopiaFichero;
     aAlfa = "C:\MODELOS";                   |RMKDIR aAlfa;
     aAlfa = "C:\MODELOS\DOCUMENTOS";        |RMKDIR aAlfa;

     |DBASE aBase;  |QBF aBase;
     aOrigen   = aBase + "planillas/movimientos.xls";
     aDestino  = "C:/MODELOS/DOCUMENTOS/MOVIMIENTOS.XLS";

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
|FPRC;

|PROCESO AsignaExcel;
     |QBF aAsigna;

     aCadena = "";
     aLen    = aAsigna % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aAsigna % nPos;

           |SI aCaracter = "•";  aCaracter = &"0209"; |FINSI;
           |SI aCaracter = "§";  aCaracter = &0241;   |FINSI;
           |SI aCaracter = "·";  aCaracter = &0225;   |FINSI;
           |SI aCaracter = "†";  aCaracter = &0225;   |FINSI;
           |SI aCaracter = "Ç";  aCaracter = &0233;   |FINSI;
           |SI aCaracter = "°";  aCaracter = &0237;   |FINSI;
           |SI aCaracter = "¢";  aCaracter = &0243;   |FINSI;
           |SI aCaracter = "£";  aCaracter = &0250;   |FINSI;
           |SI aCaracter = "ß";  aCaracter = &0176;   |FINSI;
           |SI aCaracter = "¶";  aCaracter = &0170;   |FINSI;
           |SI aCaracter = "®";  aCaracter = &0191;   |FINSI;
           |SI aCaracter = "Ä";  aCaracter = &0199;   |FINSI;
           |SI aCaracter = "á";  aCaracter = &0231;   |FINSI;
           |SI aCaracter = "Ö";  aCaracter = &0224;   |FINSI;
           |SI aCaracter = "ä";  aCaracter = &0232;   |FINSI;
           |SI aCaracter = "ç";  aCaracter = &0236;   |FINSI;
           |SI aCaracter = "ï";  aCaracter = &0242;   |FINSI;
           |SI aCaracter = "ó";  aCaracter = &0249;   |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;

     |ALFACALLDLL "agixl97.dll","poke_dato", aCadena;
|FPRC;

|PROCESO dstem003I;
     nLinea = nLinea + 1;

     aAsigna = "A" + nLinea + "," + (("000" + #3#2) % -103);
     |HAZ AsignaExcel;

     aAsigna = "C" + nLinea + "," + (("000" + #3#3) % -103);
     |HAZ AsignaExcel;

     aAsigna = "D" + nLinea + "," + #3#4;
     |HAZ AsignaExcel;

     aAsigna = "E" + nLinea + "," + #3#5;
     |HAZ AsignaExcel;

     aAsigna = "F" + nLinea + "," + #3#7;
     |HAZ AsignaExcel;

     aAsigna = "J" + nLinea + "," + #3#8;
     |HAZ AsignaExcel;

     aAsigna = "K" + nLinea + "," + #3#9;
     |HAZ AsignaExcel;

     aAsigna = "L" + nLinea + "," + #3#10;
     |HAZ AsignaExcel;

     aAsigna = "M" + nLinea + "," + #3#11;
     |HAZ AsignaExcel;

     |SI #3#12 ! 0;
         aAsigna = "N" + nLinea + "," + (("000000" + #3#12) % -106);
         |HAZ AsignaExcel;
     |FINSI;

     aAsigna = "O" + nLinea + "," + #3#13;
     |HAZ AsignaExcel;

     aAsigna = "B" + nLinea + "," + #3#14;
     |HAZ AsignaExcel;

     |SI #3#6 = "1";  |O #3#6 = "3";
         aAsigna = "G" + nLinea + "," + #3#15;

         nSaldoCaja = nSaldoCaja + #3#15;
     |FINSI;

     |SI #3#6 = "2";  |O #3#6 = "4";
         aAsigna = "H" + nLinea + "," + #3#15;

         nSaldoCaja = nSaldoCaja - #3#15;
     |FINSI;

     |SI #3#6 = "5";  |O #3#6 = "6";
         |SI #3#15 ] 0;
             aAsigna = "G" + nLinea + "," + #3#15;
         |SINO;
             nImpo = -#3#15;
             aAsigna = "H" + nLinea + "," + nImpo;
         |FINSI;

         nSaldoCaja = nSaldoCaja + #3#15;
     |FINSI;

     |HAZ AsignaExcel;

     aAsigna = "I" + nLinea + "," + nSaldoCaja;
     |HAZ AsignaExcel;
|FPRC;

|PROCESO dstem003ICrys;
     |SI #3#6 = "1";  |O #3#6 = "3";
         nEntradaLin = #3#15;
         nSaldoCaja = nSaldoCaja + #3#15;
     |FINSI;

     |SI #3#6 = "2";  |O #3#6 = "4";
         nSalidaLin = #3#15;
         nSaldoCaja = nSaldoCaja - #3#15;
     |FINSI;

     |SI #3#6 = "5";  |O #3#6 = "6";
         |SI #3#15 ] 0;
              nEntradaLin = #3#15;
         |SINO;
             nImpo = -#3#15;
             nSalidaLin = nImpo;
         |FINSI;

         nSaldoCaja = nSaldoCaja + #3#15;
     |FINSI;

     nSaldoLin = nSaldoCaja;
     |PRINT;
|FPRC;

|DEFBUCLE dstem003Crys;
     #3#1;
     ;
     #2#0, #2#1, 001;
     #2#0, #2#1, 999;
     ;
     NULL, dstem003ICrys;
|FIN;


|DEFBUCLE dstem003I;
     #3#1;
     ;
     #2#0, #2#1, 001;
     #2#0, #2#1, 999;
     ;
     NULL, dstem003I;
|FIN;

|PROCESO ImprimeCrys;

     fApertura = #1#0;
     nSaldoI = #3#15;

     |SI #1#2 ! "01.01.0000";
          fCierre = #1#2;
          nSaldoC = #2#3;
     |SINO;
          nSaldoAc = #2#3;
     |FINSI;

     aCaja = "CAJA: " + (("000" + #2#1) % -103) + " " + #2#2;

     nLinea     = 6;
     nSaldoCaja = 0;
     |BUCLE dstem003Crys;

     fApertura = @;
     nSaldoI = 0;
     fCierre = @;
     nSaldoC = 0;
     nSaldoAc = 0;
     aCaja = "";
     nEntradaLin = 0;
     nSalidaLin = 0;
     nSaldoLin = 0;
|FPRC;

|PROCESO dstem002I;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = 1;
     |LEE 000#3];
     |SI FSalida ! 0;  |O  #3#0 ! #2#0;  |O  #3#1 ! #2#1;
         |ACABA;
     |FINSI;

     |HAZ ImprimeCrys;
/*
     |HAZ CopiaFichero;

     aAlfa = "C:\MODELOS\DOCUMENTOS\MOVIMIENTOS.XLS";
     |ALFACALLDLL "agixl97.dll", "carga_book", aAlfa;
     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Hoja1";

     |MENSA "      Cargando Campos al Documento, espere un Momento.";

     aAsigna = "A2,FECHA DE APERTURA: " + #1#0;
     |HAZ AsignaExcel;

     aAsigna = "H2,SALDO INICIAL: ";
     |HAZ AsignaExcel;

     aAsigna = "O2," + #3#15;
     |HAZ AsignaExcel;

     |SI #1#2 ! "01.01.0000";
         aAsigna = "A3,FECHA DE CIERRE .....: " + #1#2;
         |HAZ AsignaExcel;

         aAsigna = "H3,SALDO CIERRE: ";
         |HAZ AsignaExcel;

         aAsigna = "O3," + #2#3;
         |HAZ AsignaExcel;
     |SINO;
         aAsigna = "H3,SALDO ACTUAL:  ";
         |HAZ AsignaExcel;

         aAsigna = "O3," + #2#3;
         |HAZ AsignaExcel;
     |FINSI;

     aAsigna = "A5,CAJA: " + (("000" + #2#1) % -103) + " " + #2#2;
     |HAZ AsignaExcel;

     nLinea     = 6;
     nSaldoCaja = 0;
     |BUCLE dstem003I;

     |ALFACALLDLL "agixl97.dll","fin_book", "imprime";

     |RFBORRA aDestino;
*/
|FPRC;

|DEFBUCLE dstem002I;
     #2#1;
     ;
     #1#0, nDCaja;
     #1#0, nHCaja;
     be;
     NULL, dstem002I;
|FIN;

|PROCESO Informe;
     ||CARGADLL "agixl97.dll";
     |SI FSalida < 0;  |ACABA;  |FINSI;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI enSwDentro = "1";
          |INFOR "dsteyd01";
     |SINO;
          |INFOR "dstey001";
     |FINSI;
     |SI FSalida = 0;
          |BUCLE dstem002I;
          |FININF;
          |PIEINF;
          |FINIMP;
     |FINSI;
     ||DESCARGADLL "agixl97.dll";
|FPRC;

|| -------------------------------------------------------------------------

|PROCESO BajaPanta1;
     #1#0 = "31.12.2999";
|FPRC;

|PROCESO AltaPanta1;
     #1#0 = "01.01.0000";
|FPRC;

|PROCESO BajaPanta2;
     #2#0 = #1#0;
     #2#1 = 001;
|FPRC;

|PROCESO AltaPanta2;
     #2#0 = #1#0;
     #2#1 = 999;
|FPRC;

|PROCESO BajaPanta3;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = 001;
|FPRC;

|PROCESO AltaPanta3;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = 999;
|FPRC;

|PROCESO BajaPanta4;
     #4#0 = "31.12.2999";
     #4#1 = "zzzzzzzz";
|FPRC;

|PROCESO AltaPanta4;
     #4#0 = "01.01.0000";
     #4#1 = "";
|FPRC;

|PROCESO dstem003;
     |SI #3#6 = "1";  |O #3#6 = "3";  |O #3#6 = "5";  |O #3#6 = "6";
         #1#1 = #1#1 + #3#15;
         #2#3 = #2#3 + #3#15;
     |SINO;
         #1#1 = #1#1 - #3#15;
         #2#3 = #2#3 - #3#15;
     |FINSI;

     nSwAcum = 1;
|FPRC;

|DEFBUCLE dstem003;
     #3#1;
     ;
     #2#0, #2#1, 001;
     #2#0, #2#1, 999;
     ;
     NULL, dstem003;
|FIN;

|PROCESO  dstem002;
     #2#3    = 0;
     nSwAcum = 0;
     |BUCLE dstem003;
     |SI nSwAcum = 0;
         |BORRA 020#2a;
     |SINO;
         nSw = 1;
         |GRABA 020#2a;
     |FINSI;
     |LIBERA #2;
|FPRC;

|DEFBUCLE dstem002;
     #2#1;
     ;
     #1#0, 001;
     #1#0, 999;
     be;
     NULL, dstem002;
|FIN;

|PROCESO  dstem002C;
     #2#0 = #1#0;
     |GRABA 020#2n;
     |LIBERA #2;

     |SI #2#3 = 0;  |ACABA;  |FINSI;

     |DDEFECTO #3;
     #3#0  = #1#0;
     #3#1  = #2#1;
     #3#2  = 1;
     #3#3  = #500#0;
     #3#4  = #500#1;
     #3#5  = "SALDO ANTERIOR";
     #3#6  = "6";
     #3#7  = "SALDO ANTERIOR APERTURA   ";
     #3#10 = "";
     #3#13 = #500#3;
     #3#14 = #903#0;
     #3#15 = #2#3;
     |GRABA 020#3n;
     |LIBERA #3;
|FPRC;

|DEFBUCLE dstem002C;
     #2#1;
     ;
     fFechaCierre, 001;
     fFechaCierre, 999;
     be;
     NULL, dstem002C;
|FIN;

|PROCESO dstem501;
     #2#0 = #1#0;
     #2#1 = #501#0;
     |LEE 000#2=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #2#0 = #1#0;
     #2#1 = #501#0;
     #2#2 = #501#1;
     #2#3 = 0;
     |GRABA 020#2n;
     |LIBERA #2;
|FPRC;

|DEFBUCLE dstem501;
     #501#1;
     ;
     001;
     999;
     ;
     NULL, dstem501;
|FIN;

|PROCESO EventoPanta1;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#1=;

         |ESTADO_CONTROL nBoton1_0, "DISABLE";
         |SI #1#2 = "01.01.0000";
             |ESTADO_CONTROL nBoton1_0, "ENABLE";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO EventoPanta2;
     |SI FSalida = 1;
         |LEE 000#2=;
         |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO EventoPanta3;
     |SI FSalida = 1;
         |LEE 000#3=;
         |SI FSalida ! 0;  |DDEFECTO #3;  |FINSI;

         |HAZ PintaDatosPantalla3;
     |FINSI;
|FPRC;

|PROCESO EventoPanta4;
     |SI FSalida = 1;
         |LEE 000#4=;
         |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;

         |HAZ PintaDatosPantalla4;
     |FINSI;
|FPRC;

|PROCESO EventoFocoGrid1;
     |SI enDentro4 = 1;
         enDentro4 = 0;
         |PTEC 806;
     |FINSI;

     |SI enDentro902 = 1;
         enDentro902 = 0;
         |PTEC 806;
     |FINSI;

     |LIBERA #1;
     |REFRESCACONTROL enGrid1;

     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO EventoFocoGrid2;
     |SI enDentro4 = 1;
         enDentro4 = 0;
         |PTEC 806;
     |FINSI;

     |SI enDentro902 = 1;
         enDentro902 = 0;
         |PTEC 806;
     |FINSI;

     |LIBERA #1;
     |REFRESCACONTROL enGrid2;

     |FOCOTECLADO enGrid2;

     #0#0 = #1#0;   |PINTA #0#0;
     #0#1 = #1#2;   |PINTA #0#1;
     #0#2 = #1#1;   |PINTA #0#2;
|FPRC;

|PROCESO EventoFocoGrid3;
     |LEE 101#1=;

     |SI enGrid3 ! -1;
         |DESTRUYECONTROL enGrid3;
         |FIN_CONTROL_WINDOWS enFoco3;
     |FINSI;

     |PINPA #3#0;  enPanta3 = FSalida;

     |SI #1#2 ! "01.01.0000";
         nRango = 4 + 8 + 16 + 32;
     |SINO;
         nRango = 1 + 4 + 8 + 16 + 32;
     |FINSI;

     nPos1  = 1402;
     nPos2  = 2298;

     |LINEAL_SIMPLE #1#3, nRango, nPos1, nPos2, BajaPanta3, AltaPanta3, EventoPanta3;
     enGrid3 = FSalida;

     |CONTROL_SIMPLE enPanta3, "EVENTOPAN", 0000, 0000, EventoFocoGrid3;
     enFoco3 = FSalida;

     |FOCOTECLADO enGrid3;

     FSalida = 1;
     |HAZ EventoPanta3;

     |LEE 000#2=;

     #0#0 = #1#0;   |PINTA #0#0;
     #0#1 = #1#2;   |PINTA #0#1;
     #0#2 = #1#1;   |PINTA #0#2;
     #0#3 = #1#0;   |PINTA #0#3;
     #0#4 = #1#2;   |PINTA #0#4;
     #0#5 = #1#1;   |PINTA #0#5;
     #0#6 = #2#1;   |PINTA #0#6;
     #0#7 = #2#2;   |PINTA #0#7;
     #0#8 = #2#3;   |PINTA #0#8;
|FPRC;

|PROCESO Boton1_0;
     |ABRE #500;
     |SELECT #2#500;
     #500#2 = "6";
     |LEE 000#500=;
     |SI FSalida ! 0;
         |CIERRA #500;
         |MENAV "0000 Imposible cerrar las cajas, no hay Concepto definido de Saldo Anterior Apertura.";
         |ACABA;
     |FINSI;
     |CIERRA #500;

     |SALVA_FICHA #dstem001;
     |LEE 000#dstem001.s;
     #903#18 = #dstem001#1;
     |REPON_FICHA #dstem001;
     #903#19 = #dstem001#1;
     #903#17 = #903#19 - #903#18; |PINTA #903#17;

     |BORRA_HIJOS_PAN #1#0;
     |SUB_PINPA #0#903, enPanta1;

     #903#0 = #1#0;
     |PINDA #0#903;
     |ENDATOS #1#903;
     nCierro = FSalida;
     |SI #903#17 ! 0;
        aAlfa = "    NSe han encontrado diferencias en el cuadre. " + &191 + " Cerrar de todas formas ? ";
        |CONFI aAlfa;
        nCierro = FSalida;
     |FINSI;

     |BORRA_HIJOS_PAN #1#0;

     |SI nCierro ! 0;  |ACABA;  |FINSI;

     |LEE 101#1=;

     #1#2 = #903#0;
     |GRABA 020#1a;
     |LIBERA #1;

     fFechaCierre = #1#0;
     nSaldo       = #1#1;
     nNume        = #903#0;
     |PARA;  |SI;  |HACIENDO;
          #1#0 = nNume;
          |LEE 000#1=;
          |SI FSalida ! 0;
              |DDEFECTO #1;
              #1#0 = nNume;
              #1#1 = nSaldo;
              |GRABA 020#1n;
              |LIBERA #1;

              |BUCLE dstem002C;

              |SAL;
          |FINSI;
          nNume = nNume + 1;
     |SIGUE;

     |REFRESCACONTROL enGrid1;
|FPRC;

|PROCESO Boton1_1;
     |BORRA_HIJOS_PAN #1#0;
     |SUB_PINPA #0#4, enPanta1;

     |LEE 000#4p;
     |HAZ PintaDatosPantalla4;

     nRango    = 1 + 4 + 8 + 16;
     nPos1     = 0902;
     nPos2     = 2298;
     enDentro4 = 1;

     |LINEAL_SIMPLE #1#4, nRango, nPos1, nPos2, BajaPanta4, AltaPanta4, EventoPanta4;

     |BORRA_HIJOS_PAN #1#0;

     |REFRESCACONTROL enGrid1;

     enDentro4 = 0;
|FPRC;

|PROCESO Boton1_2;
     |BORRA_HIJOS_PAN #1#0;
     |SUB_PINPA #0#904, enPanta1;

     enSwDentro = 0;
     nDCaja    = 1;
     nHCaja    = 999;
     |HAZ Informe;

     |BORRA_HIJOS_PAN #1#0;
|FPRC;

|PROCESO Boton2_0;
     |BORRA_HIJOS_PAN #2#0;
     |SUB_PINPA #0#904, enPanta2;

     enSwDentro = 1;
     nDCaja    = #2#1;
     nHCaja    = #2#1;
     |HAZ Informe;

     |BORRA_HIJOS_PAN #2#0;
|FPRC;

|PROCESO BotonesPanta1;
     |CONTROL_SIMPLE enPanta1, "BOTON,{{138}} Cerrar Apertura", 0770, 0998, Boton1_0;
     nBoton1_0 = FSalida;

     |CONTROL_SIMPLE enPanta1, "BOTON,{{136}} Traspasos", 1170, 1398, Boton1_1;
     nBoton1_1 = FSalida;

     |CONTROL_SIMPLE enPanta1, "BOTON,{{205}} Informe Movimientos", 1570, 1798, Boton1_2;
     nBoton1_2 = FSalida;
|FPRC;

|PROCESO BotonesPanta2;
     |CONTROL_SIMPLE enPanta2, "BOTON,{{205}} Informe Movimientos", 1275, 1498, Boton2_0;
     nBoton2_0 = FSalida;
|FPRC;

|PROCESO Grid1;
     |LEE 000#1p;
     nApertura = FSalida;

     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0625;
     nPos2  = 2263;

     |LINEAL_SIMPLE #1#1, nRango, nPos1, nPos2, BajaPanta1, AltaPanta1, EventoPanta1;
     enGrid1 = FSalida;

     |SI nApertura ! 0;
         |BORRA_HIJOS_PAN #1#0;
         |SUB_PINPA #0#901, enPanta1;
         |PINDA #0#901;
         |PARA;  |SI;  |HACIENDO;
              |ENDATOS #1#901;
              |SI FSalida = 0;  |SAL;  |FINSI;
         |SIGUE;

         |BORRA_HIJOS_PAN #1#0;

         |DDEFECTO #1;
         #1#0 = #901#0;
         |GRABA 020#1n;
         |LIBERA #1;

         |REFRESCACONTROL enGrid1;
     |FINSI;

     |FOCOTECLADO enGrid1;

     |LEE 000#1p;
     nApertura = FSalida;

     FSalida = 1;
     |HAZ EventoPanta1;

     |BUCLE dstem501;

     |CONTROL_SIMPLE enPanta1, "EVENTOPAN", 0000, 0000, EventoFocoGrid1;
     enFoco1 = FSalida;
|FPRC;

|PROCESO Grid2;
     nRango = 4 + 8 + 16 + 32;
     nPos1  = 1102;
     nPos2  = 2270;

     |LINEAL_SIMPLE #1#2, nRango, nPos1, nPos2, BajaPanta2, AltaPanta2, EventoPanta2;
     enGrid2 = FSalida;

     |CONTROL_SIMPLE enPanta2, "EVENTOPAN", 0000, 0000, EventoFocoGrid2;
     enFoco2 = FSalida;
|FPRC;

|PROCESO Grid3;
     nRango = 4 + 8 + 16 + 32;
     nPos1  = 1402;
     nPos2  = 2298;

     |LINEAL_SIMPLE #1#3, nRango, nPos1, nPos2, BajaPanta3, AltaPanta3, EventoPanta3;
     enGrid3 = FSalida;

     |CONTROL_SIMPLE enPanta3, "EVENTOPAN", 0000, 0000, EventoFocoGrid3;
     enFoco3 = FSalida;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     |DBASS aBase;  |QBF aBase;

     |DFICE aPathTesor;  |QBF aPathTesor;
     aAcceso = aPathTesor % -205;

     |ABRE #100;
     #100#0 = aAcceso;
     |LEE 000#100=;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;

     aPathFich = aBase + "contagen/fich/" + (("00000" + #100#2) % -105) + #100#3 + "/";
     |PATH_DAT #1100 aPathFich;

     aPathFich = aBase + "dscomer9/fich/" + (("00000" + #100#4) % -105) + "/";
     |PATH_DAT #1101 aPathFich;
     |PATH_DAT #1102 aPathFich;
     |PATH_DAT #1103 aPathFich;
     |PATH_DAT #1104 aPathFich;
     |PATH_DAT #1166 aPathFich;

     |ABRET #1;
     |ABRET #2;
     |ABRET #3;
     |ABRET #4;

     FSalida = 2799;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |CIERRAT #1;
     |CIERRAT #2;
     |CIERRAT #3;
     |CIERRAT #4;
|FPRC;

|PROGRAMA;
     |CABEZA "Gestion de Cajas/Bancos";

     |PINPA #0#0;  enPanta0 = FSalida;
     |PINPA #1#0;  enPanta1 = FSalida;  |HAZ Grid1;
     |PINPA #2#0;  enPanta2 = FSalida;  |HAZ Grid2;
     |PINPA #3#0;  enPanta3 = FSalida;  |HAZ Grid3;

     |HAZ BotonesPanta1;
     |HAZ BotonesPanta2;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";

     |PARA; |SI;  |HACIENDO;
         FSalida = "::Salir," + enGrid1;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1_0;
     |FIN_CONTROL_WINDOWS nBoton1_1;
     |FIN_CONTROL_WINDOWS nBoton1_2;
     |FIN_CONTROL_WINDOWS nBoton2_0;

     |LEE 101#1p;
     |SI FSalida = 0;
         nSw  = 0;
         #1#1 = 0;
         |BUCLE dstem002;
         |SI nSw = 0;
             |BORRA 020#1a;
         |SINO;
             |GRABA 020#1a;
         |FINSI;
         |LIBERA #1;
     |FINSI;

     |LEE 101#1p;
     |SI FSalida = 0;  |Y #1#2 ! "01.01.0000";
         #1#2 = "01.01.0000";
         |GRABA 020#1a;
         |LIBERA #1;
     |FINSI;

     |DESTRUYECONTROL enGrid1;
     |DESTRUYECONTROL enGrid2;
     |DESTRUYECONTROL enGrid3;
     |DESTRUYECONTROL enFoco1;
     |DESTRUYECONTROL enFoco2;
     |DESTRUYECONTROL enFoco3;
     |DESTRUYECONTROL enFoco4;

     |PULSATECLA;
|FPRO;
