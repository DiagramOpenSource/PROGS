|FICHEROS;
   dstew007 #0;

   Referen@ #1000;
   Refere1@ #1001;
|FIN;

|VARIABLES;
   nCalc  = 0;
   nCalc1 = 0;
   nCalc2 = 0;
   nLong  = 0;
   nLong1 = 0;
   nLong2 = 0;
   nNivel = 0;

   aAlfa  = "";
   aAlfa1 = "";
   aAlfa2 = "";
   aLong  = "";
   aLong1 = "";
   aLong2 = "";

   nMaxDig = 0;
   aCuenta = "";
|FIN;

|PROCESO Selec;
   |SI #dstew007#5 = "P";
      |C_M #dstew007#2, 1, "N"; |C_M #dstew007#3, 1, "S";
   |SINO;
      |C_M #dstew007#2, 1, "S"; |C_M #dstew007#3, 1, "N";
   |FINSI;
   |PINTA #dstew007#2; |PINTA #dstew007#3;
|FPRC;

|PROCESO AntesCta; |TIPO 7;
   |SI #dstew007#5 = "P";
      aAlfa = #dstew007#3;
   |SINO;
      aAlfa = #dstew007#2;
   |FINSI;
   |QBF aAlfa; aAlfa = aAlfa + ".a";
   #dstew007#4 = aAlfa;
|FPRC;

|PROCESO TrasCta;
   |DBASS aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "contagen/def/cacuenta.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      |DBASS aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "contagen/def/canempre.mas";
      |CARGA_DEF aAlfa, Refere1@;
      |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "contagen/fich/";
      |PATH_DAT #Refere1@#aAlfa#;

      |ABRE #Refere1@;
      #Refere1@#2 = #48#2;
      #Refere1@#3 = #48#3;
      |LEE 000#Refere1@.=;
      |SI FSalida ! 0; |DDEFECTO #Refere1@; |FINSI;
      nMaxDig = 0;
      |SI #Refere1@#14 ] nMaxDig; nMaxDig = #Refere1@#14; |FINSI;
      |SI #Refere1@#15 ] nMaxDig; nMaxDig = #Refere1@#15; |FINSI;
      |SI #Refere1@#16 ] nMaxDig; nMaxDig = #Refere1@#16; |FINSI;
      |SI #Refere1@#17 ] nMaxDig; nMaxDig = #Refere1@#17; |FINSI;
      |SI #Refere1@#18 ] nMaxDig; nMaxDig = #Refere1@#18; |FINSI;
      |SI #Refere1@#19 ] nMaxDig; nMaxDig = #Refere1@#19; |FINSI;

      |DBASS aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "contagen/fich/" + (("00000" + #48#2) % -105) + #48#3 + "/";
      |PATH_DAT #Referen@#aAlfa#;
      |ABRE #Referen@;
      aCuenta = #dstew007#4; |QBF aCuenta; |HAZ FiltraPuntos;
      #dstew007#4 = aCuenta; |PINTA #dstew007#4;
      #Referen@#0 = aCuenta;
      |LEE 000#Referen@.=;
      |SI FSalida ! 0;
         |DDEFECTO #Referen@;
         |SI #dstew007#5 = "P";
            #Referen@#0 = #dstew007#3;
         |SINO;
            #Referen@#0 = #dstew007#2;
         |FINSI;
         |LEE 000#Referen@.=;
         |SI FSalida = 0;
            #Referen@#0 = aCuenta; nNivel = 0; |HAZ MiraNivel;
            #Referen@#1 = nNivel;
            #Referen@#2 = #dstew007#1;
            #Referen@#3 = "S";
            |GRABA 020#Referen@.n;
         |SINO;
            aAlfa = "    Problemas con el plan contable. No encuentro el grupo " + #Referen@#0;
            |MENAV aAlfa;
         |FINSI;
      |FINSI;
      |CIERRA #Refere1@; |DESCARGA_DEF #Refere1@;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|PROCESO FiltraPuntos;
   aAlfa = aCuenta; |QBF aAlfa;
   aAlfa1 = aAlfa - ".a";
   |SI FSalida ! 0; |HAZ Ultima; |FINSI;

   aAlfa = aCuenta; aAlfa = aAlfa - ".";
   |PARA; |SI FSalida ! 0; |HACIENDO;
      nCalc1 = ((FSalida / 100) ! 0) + 99;
      nCalc2 = (((FSalida / 100) ! 0) * 100) + 99;
      aAlfa1 = aAlfa % nCalc1; aLong1 = aAlfa1 % 0;
      aAlfa2 = aAlfa % nCalc2; aLong2 = aAlfa2 % 0;
      nCalc1 = aLong1; nCalc2 = aLong2; nCalc = nCalc1 + nCalc2;
      nCalc = nMaxDig - nCalc;
      aAlfa = "0" * nCalc;
      aAlfa = aAlfa1 + aAlfa + aAlfa2;
      aAlfa = aAlfa - ".";
   |SIGUE;
   aCuenta = aAlfa;
|FPRC;

|PROCESO Ultima;
   nCalc = aAlfa1; nCalc = nCalc + 1; aAlfa1 = nCalc;
   #Referen@#0 = aAlfa1;
   |LEE 000#Referen@.];
   |SI FSalida ! 0;
      |LEE 000#Referen@.u;
   |SINO;
      |LEE 000#Referen@.a;
      |SI FSalida ! 0;
         |LEE 000#Referen@.p;
      |SINO;
         |PARA; |SI #Referen@#3 = "N"; |HACIENDO;
            |LEE 000#Referen@.a;
            |SI FSalida ! 0; |LEE 000#Referen@.p; |SAL; |FINSI;
         |SIGUE;
         aAlfa1 = #Referen@#0; |QBF aAlfa1;
      |FINSI;
   |FINSI;

   aAlfa = aCuenta; |QBF aAlfa;
   aAlfa1 = aAlfa - ".a"; |QBF aAlfa1;
   aLong = aAlfa1 % 0; nLong = aLong;
   nCalc = nLong + 100;
   aAlfa2 = #Referen@#0; |QBF aAlfa2; aAlfa2 = aAlfa2 % nCalc;
   |SI aAlfa1 = aAlfa2;
      nCalc = #Referen@#0; nCalc = nCalc + 1;
      aCuenta = nCalc;
   |SINO;
      nCalc = nMaxDig - (nLong + 1); aAlfa = "0" * nCalc;
      aCuenta = aAlfa1 + aAlfa + "1";
   |FINSI;
|FPRC;

|PROCESO MiraNivel;
   aAlfa = aCuenta; |QBF aAlfa;
   aLong = aAlfa % 0; nLong = aLong;
   |SI nLong = #Refere1@#14; nNivel = 1; |FINSI;
   |SI nLong = #Refere1@#15; nNivel = 2; |FINSI;
   |SI nLong = #Refere1@#16; nNivel = 3; |FINSI;
   |SI nLong = #Refere1@#17; nNivel = 4; |FINSI;
   |SI nLong = #Refere1@#18; nNivel = 5; |FINSI;
   |SI nLong = #Refere1@#19; nNivel = 6; |FINSI;
|FPRC;
