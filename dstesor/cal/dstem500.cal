|FICHEROS;
     dstem000 #0;
     dstew005 #50,MANTE;
     dstem500 #500;
     :/contagen/def/cacuenta #1100;
     :/contagen/def/canempre #1105;

     dstem500@ #900;
     Referen@ #1000;
|FIN;

|VARIABLES;
     aBase           = "";
     aPathFich       = "";
     aPathTesor      = "";
     aAcceso         = "";
     aMas            = "";
     aPath           = "";

     nCampo   = 0;
     aCodCta  = "";
     ndigC    = 0;
     nVent1   = 0;
     nForma   = 0;
     nModo    = 0;
     nEmpresa = 0;

     aLong  = "";
     nLong  = 0;
     nSw    = 0;

     nPos1  = 0;
     nPos2  = 0;
     aDirBass = "";

     nNume1 = 0;
     nPos   = 0;
     aAlfa  = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aAlfa4 = "";
     aGuarda = "";
     aPunto  = "";
|FIN;

|PROCESO Tipo0C2F500;  |TIPO 0;
     |SI #500#2 ! "5";  |Y #500#2 ! "6";  |ACABA;  |FINSI;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dstem500.mas";
     |CARGA_DEF aMas, dstem500@;
     |SI FSalida ! 0;
         |MENAV "0000 No puedo cargar el def dstem500.";
         |ERROR;
         |ACABA;
     |FINSI;

     |ABRE #900;
     |SELECT #2#900;
     #900#2 = #500#2;
     |LEE 000#900=;
     |SI FSalida = 0;  |Y #900#0 ! #500#0;
         |MENAV "0000 Este tipo de concepto es unico, y ya existe en otro registro.";
         |ERROR;
     |FINSI;
     |CIERRA #900;
|FPRC;

|PROCESO Tipo7C3F500;  |TIPO 7;
     |C_M #500#3, 1, "S";
     |SI #500#2 = "1";  |O #500#2 = "2";  |O #500#2 = "5";
         |C_M #500#3, 1, "N";  #500#3 = "";  |PINTA #500#3;
     |FINSI;

     |C_M #500#4, 1, "S";
     |SI #500#2 = "1";  |O #500#2 = "2"; |O #500#2 = "3";
      |O #500#2 = "5";  |O #500#2 = "6";
         |C_M #500#4, 1, "N";  #500#4 = "N";  |PINTA #500#4;
     |FINSI;
|FPRC;

|PROCESO FiltraPtos500;
    |ABRE #1105;
    |DDEFECTO #1105;
    #1105#2 = #48#2;
    #1105#3 = #48#3;
    |LEE 000#1105.=;
    |SI FSalida = 0;
         nCampo = 13 + #1105#13;   ||Empieza a partir del Campo 14
         ndigC = #1105#nCampo#;
    |SINO;
         ndigC = 9;
    |FINSI;
    |CIERRA #1105;

    |SI aCodCta = "            "; |ACABA; |FINSI;

    aAlfa1 = "";
    |PARA nNume1 = 1; |SI nNume1 [ 12; |HACIENDO nNume1 = nNume1 + 1;
          aAlfa2 = nNume1; |QBF aAlfa2;
          aAlfa2 = aAlfa2 + "01";
          aAlfa3 = aCodCta % aAlfa2;
          |SI aAlfa3 = "."; |O aAlfa3 = "0"; |O aAlfa3 = "1"; |O aAlfa3 = "2";
                            |O aAlfa3 = "3"; |O aAlfa3 = "4"; |O aAlfa3 = "5";
                            |O aAlfa3 = "6"; |O aAlfa3 = "7"; |O aAlfa3 = "8";
                            |O aAlfa3 = "9";
              aAlfa1 = aAlfa1 + aAlfa3;
          |FINSI;
    |SIGUE;
    aCodCta = aAlfa1;

    aPunto = aCodCta - ".";
    |SI FSalida ! 0;
        nNume1 = FSalida;
        nPos   = 100 + (((nNume1 / 100) ! 0) -1);
        aAlfa2 = aCodCta % nPos;   |QBF aAlfa2;
        nPos   = (((nNume1 / 100) ! 0) * 100) + 199;
        aAlfa3 = aCodCta % nPos;   |QBF aAlfa3;

        FSalida = nNume1;
        |PARA; |SI FSalida ! 0; |HACIENDO;
               aAlfa3 = aAlfa3 - "."; || limpiar mas puntos (los ignoramos)
        |SIGUE;

        nPos   = ndigC - ( (A \ aAlfa2 % 0) + (A \ aAlfa3 % 0));
        aAlfa4 = (A\ "0" * nPos);
        aCodCta  = (A\ aAlfa2 + aAlfa4 + aAlfa3);
    |FINSI;
|FPRC;

|PROCESO Baja1100_500;
     #1100#3 = "S";
     #1100#0 = "4        ";
|FPRC;

|PROCESO Alta1100_500;
     #1100#3 = "S";
     #1100#0 = "799999999999999";
|FPRC;

|PROCESO Tipo66C3F500;  |TIPO 66;
     |ABRE #1100;
     |CONSULTA_F_CLAVE #6#1100, Baja1100_500, Alta1100_500;
     |SI FSalida = 0;
          #dstem500#3 = #1100#0;
          |PINTA #dstem500#3;
     |FINSI;
     |CIERRA #1100;
|FPRC;

|PROCESO Tipo0C3F500;  |TIPO 0;
     |SI #500#2 = "1";  |O #500#2 = "2";  |O #500#2 = "5";  |ACABA;  |FINSI;

     aCodCta = #500#3;
     |HAZ FiltraPtos500;
     #500#3 = aCodCta;
     |PINTA #500#3;

     |ABRE #1100;
     #1100#0 = #500#3;
     |LEE 000#1100=;
     |SI FSalida ! 0;
         |MENAV "0000 Cuenta Contable Inexistente.";
         |ERROR;
     |SINO;
         |SI #1100#3 ! "S";
             |MENAV "0000 Debe ser una cuenta de Pase Directo.";
             |ERROR;
         |FINSI;
     |FINSI;

     |CIERRA #1100;
|FPRC;


|PROCESO MiraSiIVA;
   |SI #dstem500#4 = "S";
      |C_M #dstem500#23, 1, "S"; |C_M #dstem500#24, 1, "S";
      |C_M #dstem500#25, 1, "S";
   |SINO;
      |C_M #dstem500#23, 1, "N"; |C_M #dstem500#24, 1, "N";
      |C_M #dstem500#25, 1, "N";
   |FINSI;
|FPRC;

|PROCESO CogeDatos;
   |SI FSalida = 2; |ACABA; |FINSI;

   |SI #dstem500#4 = "S";

      |DDEFECTO #dstew005;
      #dstew005#0 = #dstem500#5;
      #dstew005#1 = #dstem500#6;
      #dstew005#2 = #dstem500#7;
      #dstew005#3 = #dstem500#8;
      #dstew005#4 = #dstem500#9;
      #dstew005#5 = #dstem500#10;
      #dstew005#6 = #dstem500#11;
      #dstew005#14 = #dstem500#14;
      #dstew005#15 = #dstem500#15;
      #dstew005#16 = #dstem500#16;
      #dstew005#17 = #dstem500#17;
      #dstew005#18 = #dstem500#18;
      #dstew005#24 = #dstem500#19;
      #dstew005#25 = #dstem500#20;
      #dstew005#28 = #dstem500#21;
      #dstew005#29 = #dstem500#22;
      #dstew005#30 = #dstem500#29;
      #dstew005#31 = #dstem500#30;
      #dstew005#32 = #dstem500#31;

      |DBASS aDirBass; |QBF aDirBass;
      aDirBass = aDirBass + "contagen/";
      aAlfa = aDirBass + "def/cacuenta.mas";
      |CARGA_DEF aAlfa, Referen@;
      |SI FSalida = 0;
         aAlfa = aDirBass + "fich/" + (("00000" + #48#2) % -105) + #48#3 + "/";
         |PATH_DAT #1000 aAlfa;
         |ABRE #Referen@;
         #Referen@#0 = #dstew005#2; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#7 = #Referen@#2; |FINSI;
         #Referen@#0 = #dstew005#3; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#8 = #Referen@#2; |FINSI;
         #Referen@#0 = #dstew005#4; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#9 = #Referen@#2; |FINSI;
         #Referen@#0 = #dstew005#5; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#10 = #Referen@#2; |FINSI;
         #Referen@#0 = #dstew005#6; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#11 = #Referen@#2; |FINSI;
         #Referen@#0 = #dstew005#14; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#19 = #Referen@#2; |FINSI;
         #Referen@#0 = #dstew005#15; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#20 = #Referen@#2; |FINSI;
         #Referen@#0 = #dstew005#16; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#21 = #Referen@#2; |FINSI;
         #Referen@#0 = #dstew005#17; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#22 = #Referen@#2; |FINSI;
         #Referen@#0 = #dstew005#18; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#23 = #Referen@#2; |FINSI;
         #Referen@#0 = #dstew005#24; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#26 = #Referen@#2; |FINSI;
         #Referen@#0 = #dstew005#25; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#27 = #Referen@#2; |FINSI;
         |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
      |FINSI;

      |DBASS aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "modelos/def/dsmom030.mas";
      |CARGA_DEF aAlfa, Referen@;
      |SI FSalida = 0;
         |DBASS aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "modelos/fich/";
         |PATH_DAT #1000 aAlfa;
         |ABRE #Referen@;
         #Referen@#0 = #dstew005#0; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#12 = #Referen@#1; |FINSI;
         #Referen@#0 = #dstew005#28; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#29 = #Referen@#1; |FINSI;
         |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
      |FINSI;

      aAlfa = aDirBass + "def/camandia.mas";
      |CARGA_DEF aAlfa, Referen@;
      |SI FSalida = 0;
         aAlfa = aDirBass + "fich/" + (("00000" + #48#2) % -105) + #48#3 + "/";
         |PATH_DAT #1000 aAlfa;
         |ABRE #Referen@;
         #Referen@#0 = #dstew005#1; |LEE 000#Referen@.=;
         |SI FSalida = 0; #dstew005#13 = #Referen@#1; |FINSI;
         |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
      |FINSI;

      nPos1 = 0910; nPos2 = 2477;
      |VENTANA nPos1, nPos2, -1, -1, ""; nVent1 = FSalida;

      |PINDA #0#dstew005;
      |ENDATOS #1#dstew005;
      |SI FSalida = 0;
         #dstem500#5  = #dstew005#0;
         #dstem500#6  = #dstew005#1;
         #dstem500#7  = #dstew005#2;
         #dstem500#8  = #dstew005#3;
         #dstem500#9  = #dstew005#4;
         #dstem500#10 = #dstew005#5;
         #dstem500#11 = #dstew005#6;
         #dstem500#14 = #dstew005#14;
         #dstem500#15 = #dstew005#15;
         #dstem500#16 = #dstew005#16;
         #dstem500#17 = #dstew005#17;
         #dstem500#18 = #dstew005#18;
         #dstem500#19 = #dstew005#24;
         #dstem500#20 = #dstew005#25;
         #dstem500#21 = #dstew005#28;
         #dstem500#22 = #dstew005#29;
         #dstem500#29 = #dstew005#30;
         #dstem500#30 = #dstew005#31;
         #dstem500#31 = #dstew005#32;
      |FINSI;
      |FINVENTANA nVent1;
   |FINSI;

|FPRC;

|PROCESO MiraDiario;
   |DBASS aDirBass; |QBF aDirBass;
   aDirBass = aDirBass + "contagen/";
   aAlfa = aDirBass + "def/camandia.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      aAlfa = aDirBass + "fich/" + (("00000" + #48#2) % -105) + #48#3 + "/";
      |PATH_DAT #Referen@#aAlfa#;
      |ABRE #Referen@;
      |SI nSw = 1;
         #Referen@#0 = #dstem500#5;
         |LEE 000#Referen@.];
         |CONSULTA_CLAVE #1#Referen@;
         |SI FSalida = 0;
            #dstem500#5 = #Referen@#0; |PINTA #dstem500#5;
            #dstem500#12 = #Referen@#1; |PINTA #dstem500#12;
         |FINSI;
         |ERROR;
      |FINSI;
      #Referen@#0 = #dstem500#5;
      |LEE 000#Referen@.=;
      |SI FSalida = 0;
         #dstem500#12 = #Referen@#1; |PINTA #dstem500#12;
      |SINO;
         |MENAV "    Diario contable inexistente"; |ERROR;
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|PROCESO T66Diario; |TIPO 66;
   nSw = 1; |HAZ MiraDiario; nSw = 0;
|FPRC;

|PROCESO MiraConcepto;
   |DBASS aDirBass; |QBF aDirBass;
   aDirBass = aDirBass + "modelos/";
   aAlfa = aDirBass + "def/dsmom030.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      aAlfa = aDirBass + "fich/"; |PATH_DAT #Referen@#aAlfa#;
      |ABRE #Referen@;
      |SI nSw = 1;
         #Referen@#0 = #dstem500#6;
         |LEE 000#Referen@.];
         |CONSULTA_CLAVE #1#Referen@;
         |SI FSalida = 0;
            #dstem500#6 = #Referen@#0; |PINTA #dstem500#6;
            #dstem500#13 = #Referen@#1; |PINTA #dstem500#13;
         |FINSI;
         |ERROR;
      |FINSI;
      #Referen@#0 = #dstem500#6;
      |LEE 000#Referen@.=;
      |SI FSalida = 0;
         #dstem500#13 = #Referen@#1; |PINTA #dstem500#13;
      |SINO;
         |MENAV "    Concepto contable inexistente"; |ERROR;
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|PROCESO T66Concepto; |TIPO 66;
   nSw = 1; |HAZ MiraConcepto; nSw = 0;
|FPRC;

|PROCESO dstem000;
     |SI nEmpresa = #0#0;  |ACABA;  |FINSI;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dstem500.mas";
     |CARGA_DEF aMas, dstem500@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |DBASE aBase; |QBF aBase;
     aPath = aBase + "fich/" + (("00000" + #0#0) % -105) + "/";
     |PATH_DAT #900 aPath;

     |SI nModo = 3;
         |ABRE #900;
         |SELECT #1#900;
         #900#0 = #500#0;
         |LEE 101#900=;
         |SI FSalida = 0;
             |BORRA 020#900a;
             |LIBERA #900;
         |FINSI;
         |CIERRA #900;
         |ACABA;
     |FINSI;

     |ABRE #900;
     |SELECT #1#900;
     #900#0 = #500#0;
     |LEE 101#900=;
     |SI FSalida ! 0;
         |DDEFECTO #900;
         #900#0 = #500#0;
         |GRABA 020#900b;
     |FINSI;

     |PARA nCampo = 1;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
           #900nCampo = #500nCampo;
     |SIGUE;

     |GRABA 020#900a;
     |LIBERA #900;
     |CIERRA #900;
|FPRC;

|DEFBUCLE dstem000;
     #0#1;
     5;
     00001, "S";
     99999, "S";
     ;
     NULL, dstem000;
|FIN;

|PROCESO Tipo2m500;  |TIPO 2;
     nModo    = (FEntrada / 100) ! 0;
     nEmpresa = #48#0;

     |SI nModo = 3;
         |CONFI "0000NDesea BORRARLO de todas las Empresas Activas.";
         |SI FSalida = 0;
             |BUCLE dstem000;
         |FINSI;
         |ACABA;
     |FINSI;

     nForma = 0 +. 1;
     |SI nForma = 1;
         |SI nModo = 1;
             |CONFI "0000NDesea CREARLO en todas las Empresas Activas.";
         |SINO;
             |CONFI "0000NDesea MODIFICARLO en todas las Empresas Activas.";
         |FINSI;

         |SI FSalida = 0;
             |BUCLE dstem000;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo80m500;  |TIPO 80;
     |DBASS aBase;  |QBF aBase;

     |DFICE aPathTesor;  |QBF aPathTesor;
     aAcceso = aPathTesor % -205;

     |ABRE #0;
     #0#0 = aAcceso;
     |LEE 000#0=;
     |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
     |CIERRA #0;

     aPathFich = aBase + "contagen/fich/" + (("00000" + #0#2) % -105) + #0#3 + "/";
     |PATH_DAT #1100 aPathFich;

     FSalida = 2799;
|FPRC;

|PROCESO Tipo13m500; |TIPO 13;
   |SI #dstem500#26 = " "; #dstem500#26 = "N"; |FINSI;
   |SI #dstem500#27 = " "; #dstem500#27 = "N"; |FINSI;
   |SI #dstem500#28 = " "; #dstem500#28 = "N"; |FINSI;
   |SI #dstem500#29 = " "; #dstem500#29 = "N"; |FINSI;
   |SI #dstem500#30 = " "; #dstem500#30 = "N"; |FINSI;
   |SI #dstem500#31 = " "; #dstem500#31 = "N"; |FINSI;
|FPRC;
