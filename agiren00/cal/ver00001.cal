|FICHEROS;
     ver00001 #0;
     reeleact #1;
     rem02000 #2;
     rem00021 #21;
     rem00027 #27;
     rem00028 #28;
     rem00045 #45;
     rem00036 #36;
     rem00055 #55;
     rem00099 #99;
     referen@ #500;
|FIN;

|VARIABLES;
     aDef       = "";
     aPathDef   = "";
     aPathFich  = "";
     aFich      = "";
     aPathRenta = "";
     aFichero   = "";
     aAlfa      = "";

     nCampo     = 0;
     nCampo1    = 0;
     nCampo2    = 0;
     nSwAsala2  = 0;
     nResto     = 0;
     nPorce     = 0;
     nPorce1    = 0;
     nPorce2    = 0;
     nDifer     = 0;
     nCampoRdto = 0;
     nCanti     = 0;
     nCanti1    = 0;
     nCanti2    = 0;

     &enEmpresa     = 0;
     &enTipoEntrada = 0;
|FIN;

|PROCESO BorraFichero;
     aDef = aPathDef + aFichero + ".mas";
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aFichero + ".mas";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     aFich = aPathFich + aFichero + ".dat";  |FBORRA aFich;
     aFich = aPathFich + aFichero + ".ddx";  |FBORRA aFich;
     aFich = aPathFich + aFichero + ".ixx";  |FBORRA aFich;

     |ABRE #500;  |CIERRA #500;  |DELINDEX #500;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO BorraLiquidacion;
     |DBASE aPathRenta;  |QBT aPathRenta;
     aPathDef  = aPathRenta + "def/";
     aPathFich = aPathRenta + "fich/";

     aFichero = "rem01001";  |HAZ BorraFichero;
     aFichero = "rem01002";  |HAZ BorraFichero;
     aFichero = "rem01010";  |HAZ BorraFichero;
     aFichero = "rem01011";  |HAZ BorraFichero;
     aFichero = "rem01012";  |HAZ BorraFichero;
     aFichero = "rem01014";  |HAZ BorraFichero;
     aFichero = "rem01015";  |HAZ BorraFichero;
     aFichero = "rem01016";  |HAZ BorraFichero;
     aFichero = "rem01017";  |HAZ BorraFichero;
     aFichero = "rem01018";  |HAZ BorraFichero;
     aFichero = "rem01019";  |HAZ BorraFichero;
     aFichero = "rem01020";  |HAZ BorraFichero;
     aFichero = "rem01021";  |HAZ BorraFichero;
     aFichero = "rem01022";  |HAZ BorraFichero;
     aFichero = "rem01023";  |HAZ BorraFichero;
     aFichero = "rem01024";  |HAZ BorraFichero;
     aFichero = "rem01025";  |HAZ BorraFichero;
     aFichero = "rem01026";  |HAZ BorraFichero;
     aFichero = "rem01027";  |HAZ BorraFichero;
     aFichero = "rem01028";  |HAZ BorraFichero;
     aFichero = "rem01029";  |HAZ BorraFichero;
     aFichero = "rem01030";  |HAZ BorraFichero;
     aFichero = "rem01031";  |HAZ BorraFichero;
     aFichero = "rem01032";  |HAZ BorraFichero;
     aFichero = "rem01033";  |HAZ BorraFichero;
     aFichero = "rem01034";  |HAZ BorraFichero;
     aFichero = "rem01037";  |HAZ BorraFichero;
     aFichero = "rem01041";  |HAZ BorraFichero;
     aFichero = "rem01042";  |HAZ BorraFichero;
     aFichero = "rem01043";  |HAZ BorraFichero;
|FPRC;

|PROCESO Incentivo2000;
     nPorce1 = 0;
     |SI nDifer > 0;  nPorce1 = nDifer * .40;  |FINSI;

     nPorce2 = 0;
     |SI #27#53 = "I";
         |SI nResto > 8;
             nPorce  = nResto - 8;
             nPorce2 = nPorce2 + (nPorce * 0.30);
             nResto  = 8;
         |FINSI;

         |SI nResto > 5;
             nPorce  = nResto - 5;
             nPorce2 = nPorce2 + (nPorce * 0.25);
             nResto  = 5;
         |FINSI;

         |SI nResto > 3;
             nPorce  = nResto - 3;
             nPorce2 = nPorce2 + (nPorce * 0.20);
             nResto  = 3;
         |FINSI;

         |SI nResto > 1;
             nPorce  = nResto - 1;
             nPorce2 = nPorce2 + (nPorce * 0.15);
             nResto  = 1;
         |FINSI;

         |SI nResto > 0;
             nPorce2 = nPorce2 + (nResto * 0.10);
         |FINSI;
     |FINSI;

     |SI #27#53 = "P";
         |SI nResto > 0;    |Y nResto [ 1;  nPorce2 = 0.10;  |FINSI;
         |SI nResto ] 1.01; |Y nResto [ 3;  nPorce2 = 0.15;  |FINSI;
         |SI nResto ] 3.01; |Y nResto [ 5;  nPorce2 = 0.20;  |FINSI;
         |SI nResto ] 5.01; |Y nResto [ 8;  nPorce2 = 0.25;  |FINSI;
         |SI nResto > 8;                    nPorce2 = 0.30;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Calcul27;
     || CALCULO DEL RENDIMIENTO EN 2000

     |SI #27#17 = "7212";
         |SI #27#40 = 7.5;
             #27#40 = 7500;
             #27#33 = #27#33 / 1000;
         |FINSI;
     |FINSI;

     |ABRE #1;
     #1#0 = #27#16;
     #1#1 = #27#17;
     #1#2 = #27#18;
     |LEE 040#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     #27#38  = #1#6;
     #27#39  = #1#9;
     #27#40  = #1#12;
     #27#41  = #1#15;
     #27#42  = #1#21;
     #27#43  = #1#24;
     #27#44  = #1#27;

     #27#52 = 0;
     |PARA nCampo = 45;  |SI nCampo [ 51;  |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo - 14;
           nCampo2 = nCampo - 7;
           #27nCampo = #27nCampo1 * #27nCampo2;
           |PINTA #27nCampo;
           #27#52 = #27#52 + #27nCampo;
     |SIGUE;

     nSwAsala2 = 0;
     aAlfa     = #1#1 % 103;
     |SI aAlfa = "644";  nSwAsala2 = 1;  |FINSI;

     #27#55 = #27#31;
     #27#57 = #27#38;
     #27#60 = 0;
     #27#62 = 0;
     |SI nSwAsala2 = 1;  #27#60 = #27#32;  #27#62 = #27#39;  |FINSI;

     || Minoracion de Empleo

     nResto   = #27#54 + #27#59;
     #27#56 = 0;
     #27#61 = 0;
     #27#58 = 0;
     #27#63 = 0;
     nPorce1  = 0;
     nPorce2  = 0;
     nDifer   = (#27#55 + #27#60) - (#27#54 + #27#59);
     |SI nDifer < 0;  nResto = #27#55 + #27#60;  |FINSI;
     |HAZ Incentivo2000;
     #27#56   = 0;
     #27#61   = 0;
     |SI #27#55 ! 0;
         #27#56   = nPorce1 + (nPorce2 * (#27#55 / (#27#55 + #27#60)));
     |FINSI;
     |SI #27#60 ! 0;
         #27#61   = nPorce1 + (nPorce2 * (#27#60 / (#27#55 + #27#60)));
     |FINSI;
     #27#58   = #27#57 * #27#56;
     #27#63   = #27#62 * #27#61;
     #27#64   = #27#58 + #27#63;

     || Minoracion Inversion

     #27#78 = #27#65 + #27#68 + #27#71 + #27#74 + #27#77;

     ||  Rdto Neto Minorado

     #27#79 = #27#52 - #27#64 - #27#78;

     ||  Quioscos

     #27#81  = #27#79 * #27#80;
     |SI #1#32 = "N";   #27#81 = 0;  |FINSI;
     |SI #27#81 < 0;    #27#81 = 0;  |FINSI;

     ||  Taxis

     #27#83  = #27#79 * #27#82;
     |SI #1#33 = "N";   #27#83 = 0;  |FINSI;
     |SI #27#83 < 0;    #27#83 = 0;  |FINSI;

     ||  Urbanos

     #27#85  = #27#79 * #27#84;
     |SI #1#35 = "N";   #27#85 = 0;  |FINSI;
     |SI #27#85 < 0;    #27#85 = 0;  |FINSI;

     ||  Mercancias

     #27#87  = #27#79 * #27#86;
     |SI #1#34 = "N";   #27#87 = 0;  |FINSI;
     |SI #27#55 ! 0;    #27#87 = 0;  |FINSI;
     |SI #27#60 ! 0;    #27#87 = 0;  |FINSI;
     |SI #27#87 < 0;    #27#87 = 0;  |FINSI;

     ||  Empresas Peque¤as dimensiones

     nCampoRdto = 79;
     |SI #27#81 ! 0;  nCampoRdto = 81;  |FINSI;

     #27#89 = #27nCampoRdto * #27#88;
     |SI #27#83 ! 0; |O #27#85 ! 0; |O #27#87 ! 0;
         #27#89 = 0;
     |FINSI;

     |SI #27#89 < 0;  #27#89 = 0;  |FINSI;

     ||  Temporada

     nCampoRdto = 79;
     |SI #27#81 ! 0;  nCampoRdto = 81;  |FINSI;
     |SI #27#83 ! 0;  nCampoRdto = 83;  |FINSI;
     |SI #27#85 ! 0;  nCampoRdto = 85;  |FINSI;
     |SI #27#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #27#89 ! 0;  nCampoRdto = 89;  |FINSI;

     #27#92 = #27nCampoRdto * #27#91;
     |SI #27#92 < 0;  #27#92 = 0;  |FINSI;

     || Exceso

     nCampoRdto = 79;
     |SI #27#81 ! 0;  nCampoRdto = 81;  |FINSI;
     |SI #27#83 ! 0;  nCampoRdto = 83;  |FINSI;
     |SI #27#85 ! 0;  nCampoRdto = 85;  |FINSI;
     |SI #27#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #27#89 ! 0;  nCampoRdto = 89;  |FINSI;
     |SI #27#92 ! 0;  nCampoRdto = 92;  |FINSI;

     #27#95  = #1#31;
     #27#93  = #27nCampoRdto - #27#95;
     #27#94  = #27#95 + (#27#93 * 1.30);
     |SI #27#93 < 0;  #27#94 = 0;  |FINSI;
     |SI #1#31  = 0;  #27#94 = 0;  |FINSI;
     |SI #27#89 ! 0;  #27#94 = 0;  |FINSI;

     || Nueva Actividad

     nCampoRdto = 79;
     |SI #27#81 ! 0;  nCampoRdto = 81;  |FINSI;
     |SI #27#83 ! 0;  nCampoRdto = 83;  |FINSI;
     |SI #27#85 ! 0;  nCampoRdto = 85;  |FINSI;
     |SI #27#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #27#89 ! 0;  nCampoRdto = 89;  |FINSI;
     |SI #27#92 ! 0;  nCampoRdto = 92;  |FINSI;
     |SI #27#94 ! 0;  nCampoRdto = 94;  |FINSI;

     #27#97 = #27nCampoRdto * #27#96;
     |SI #27#92 ! 0;  #27#97 = 0;  |FINSI;
     |SI #27#97 < 0;  #27#97 = 0;  |FINSI;

     || Rendimiento Neto Modulos Ajustado

     nCampoRdto = 79;
     |SI #27#81 ! 0;  nCampoRdto = 81;  |FINSI;
     |SI #27#83 ! 0;  nCampoRdto = 83;  |FINSI;
     |SI #27#85 ! 0;  nCampoRdto = 85;  |FINSI;
     |SI #27#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #27#89 ! 0;  nCampoRdto = 89;  |FINSI;
     |SI #27#92 ! 0;  nCampoRdto = 92;  |FINSI;
     |SI #27#94 ! 0;  nCampoRdto = 94;  |FINSI;
     |SI #27#97 ! 0;  nCampoRdto = 97;  |FINSI;

     #27#98  = #27nCampoRdto;

     || Rendimiento Neto Calculado

     #27#110 = #27#98 - #27#109;

     || Reduccion Ley 50/1998

     #27#112 = 0;
     |SI #27#110 > 0;
         #27#112 = #27#110 % #27#111;
     |FINSI;

     || Rdto Neto

     #27#114 = #27#110 - #27#112 + #27#113;

     || Reduccion Articulo 30 Ley 40/1998

     #27#116 = 0;
     |SI #27#115 = "S";
          #27#116 = #27#114 % 30;
     |FINSI;

     || Rdto Neto Reducido

     #27#117 = #27#114 - #27#116;

     #27#99  = 0;
     #27#100 = 0;
     #27#101 = 0;
     #27#102 = 0;
     #27#103 = 0;
     #27#104 = 0;
     #27#105 = 0;
     #27#106 = 0;
     #27#107 = 0;
     #27#108 = 0;

     |GRABA 020#27a;
     |LIBERA #27;
|FPRC;

|DEFBUCLE rem00027;
     #27#1;
     ;
     00001, 00;
     99999, 99;
     be;
     NULL, Calcul27;
|FIN;

|PROCESO Calcul28;
     #28#30 = #28#26 + #28#27;
     #28#34 = #28#30 - #28#33;

     nCanti1 = #28#26 - #28#31;
     |SI #28#35 ! 0;  nCanti1 = nCanti1 * #28#35;  |FINSI;
     |SI #28#36 ! 0;  nCanti1 = nCanti1 * #28#36;  |FINSI;
     |SI #28#38 ! 0;  nCanti1 = nCanti1 * #28#38;  |FINSI;
     |SI #28#54 ! 0;  nCanti1 = nCanti1 * #28#54;  |FINSI;
     |SI #28#39 ! 0;  nCanti1 = nCanti1 * #28#39;  |FINSI;
     |SI #28#55 ! 0;  nCanti1 = nCanti1 * #28#55;  |FINSI;

     nCanti2 = #28#27 - #28#32;
     |SI #28#35 ! 0;  nCanti2 = nCanti2 * #28#35;  |FINSI;
     |SI #28#36 ! 0;  nCanti2 = nCanti2 * #28#36;  |FINSI;
     |SI #28#37 ! 0;  nCanti2 = nCanti2 * #28#37;  |FINSI;
     |SI #28#38 ! 0;  nCanti2 = nCanti2 * #28#38;  |FINSI;
     |SI #28#54 ! 0;  nCanti2 = nCanti2 * #28#54;  |FINSI;
     |SI #28#39 ! 0;  nCanti2 = nCanti2 * #28#39;  |FINSI;
     |SI #28#55 ! 0;  nCanti2 = nCanti2 * #28#55;  |FINSI;

     #28#40 = nCanti1 + nCanti2;

     #28#57 = 0;
     |SI #28#56 = "S";
         #28#57 = #28#40 % 8;
     |FINSI;

     #28#44 = #28#40 - #28#57 - #28#43;
     #28#46 = #28#44 % #28#45;
     #28#48 = #28#44 % #28#47;
     #28#49 = #28#44 - #28#46 - #28#48;
     |SI #28#49 < 0;
         |SI #28#35 ! 0;  |O #28#36 ! 0;  |O #28#37 ! 0;  |O #28#38 ! 0;
          |O #28#39 ! 0;  |O #28#45 ! 0;  |O #28#46 ! 0;  |O #28#54 ! 0;
          |O #28#55 ! 0;
             #28#49 = 0;
         |FINSI;
     |FINSI;

     #28#51 = 0;
     |SI #28#50 = "S";
         #28#51 = #28#49 % 30;
     |FINSI;

     #28#52 = #28#49 - #28#51;

     #28#28 = 0;
     #28#29 = 0;
     #28#41 = 0;
     #28#42 = 0;
     |GRABA 020#28a;
     |LIBERA #28;
|FPRC;

|DEFBUCLE rem00028;
     #28#1;
     ;
     00001, 00;
     99999, 99;
     be;
     NULL, Calcul28;
|FIN;

|PROCESO Calcul45;
     #2#7 = #45#11;
     #2#8 = #45#13;
     |LEE 040#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #45#11 = #2#0;
     #45#12 = #2#2;
     #45#13 = #2#1;
     #45#14 = #2#3;
     #45#15 = #2#4;
     #45#16 = #2#5;
     #45#17 = #2#6;
     |GRABA 020#45n;
     |LIBERA #45;
|FPRC;

|DEFBUCLE rem00045;
     #45#1;
     ;
     00001, 00;
     99999, 99;
     be;
     NULL, Calcul45;
|FIN;

|PROCESO Calcul36;
     #36#19 = #55#26;
     |GRABA 020#36a;
     |LIBERA #36;
|FPRC;

|DEFBUCLE rem00036;
     #36#1;
     16, 17;
     #55#0, 01, "C5", #55#1;
     #55#0, 99, "C5", #55#1;
     be;
     NULL, Calcul36;
|FIN;

|PROCESO Calcul55;
     |BUCLE rem00036;
|FPRC;

|DEFBUCLE rem00055;
     #55#1;
     ;
     00001, 00;
     99999, 99;
     be;
     NULL, Calcul55;
|FIN;

|PROCESO Calcul99;
     #99#22 = "N";
     #99#23 = 0;
     |SI #21#30 ! 0;  |O #21#33 ! 0;
         #99#22 = "S";
         #99#23 = 25000000;
         |SI #21#2 = "GANANCIAL ";
             #99#23 = 50000000;
         |FINSI;
         |SI #99#23 > #99#10;
             #99#23 = #99#10;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE rem00099;
     #99#1;
     4, 5;
     #21#0, "A1", 001, "B1", #21#1;
     #21#0, "A1", 999, "B1", #21#1;
     be;
     NULL, Calcul99;
|FIN;

|PROCESO Calcul21;
     |BUCLE rem00099;
|FPRC;

|DEFBUCLE rem00021;
     #21#1;
     ;
     00001, 00;
     99999, 99;
     be;
     NULL, Calcul21;
|FIN;

|PROGRAMA;
     |ABRE #0;
     |LEE 040#0p;
     |SI FSalida = 0;
         |CIERRA #0;
         |ACABA;
     |FINSI;
     |DDEFECTO #0;
     |GRABA 020#0n;
     |CIERRA #0;

     |SUB_EJECUTA_NP "rez00001;VER";

     |MENSA "      Realizando Cambio de Version";

     |PINPA #0#0;

     |HAZ BorraLiquidacion;

     |BUCLE rem00027;
     |BUCLE rem00028;

     |ABRE #2;
     |SELECT #3#2;
     |BUCLE rem00045;
     |CIERRA #2;

     |BUCLE rem00055;
     |BUCLE rem00021;

     enEmpresa     = 0;
     enTipoEntrada = 99;
     |SUB_EJECUTA_NP "reacceso";
|FPRO;
