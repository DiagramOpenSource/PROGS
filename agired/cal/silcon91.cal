|FICHEROS;
     silcon09 #0;
     tsilcon0 #3;
     nomtrtc2 #11;
     nombonif #13;
     nomcalca #18;
     nomcalli #59;
     nomhicca #19;
     nomhicli #60;
     nomcalac #21;
     nomcalal #61;
     nombotra;
     labtraba #12;
     tsilcon1 #20;
     nombonif;
     silcon04 #4;
     silcon03 #5;
     silcon02 #2;
     nomtraca;
     nomconst #22;
     nomequiv;
     nomir003;
     nomir006;
     nomcontr #36;
     labempre;
     nomcones;
     tsilcon4 #14;
     silcon06;
|FINSI;

|VARIABLES;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";

     &nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     nume4 = 0;

     fech2 = @;
     fech3 = @;
     fech4 = @;
     fech5 = @;
     fech6 = @;

     &topemes = 0;

     &nDias = 0;
     &nProp55 = 0;
     &nProp60 = 0;
     &nDiasProp55 = 0;
     &nDiasProp60 = 0;
     &bon_55 = 0;
     &bon_60 = 0;

     &nVez = 0;
     &nGuardaPropAlta = 0;
     &nGuardaPropBaja = 0;
     &nGuardaPropMat = 0;
     &swParcheBonMat = 0;
     &swParcheBonMat_34 = 0;

     &nDias_nat_alta = 0;
     aFechaIniBon = "";
     aFechaFinBon = "";
     nMesesBon = 0;
     nDiasBon = 0;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aAlfa4 = "";
     aAlfa5 = "";
     aAlfa6 = "";
     nNume = 0;
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     fFecha = @;
     fFechaAlta = @;
     fFechaRef = @;
     nFecha = 0;
     &nDiasIT = 0;
     &nDiasProp55_A = 0;
     &nDiasProp55_IT = 0;
     &nDiasProp60_A = 0;
     &nDiasProp60_IT = 0;
     &nProp55_A = 0;
     &nProp55_IT = 0;
     &nProp60_A = 0;
     &nProp60_IT = 0;
     &nVeces = 0;

     ajuste1 = "";
     ajuste2 = "";
     ajuste3 = "";
     alfa = "";
     error = 0;
     ind = 0;
     long = 0;
     posi = 0;
     digito = "";
     texto = "";
     mascara = "";
     i = 0;
     j = 0;
     &nCampo = 0;
     nTipo = 0;

     &swbon_25 = 0;
     &swbon_31 = 0;
     &swbon_34 = 0;
     &linea = 0;
     &nlinea = 0;
     &clave = "";
     &sw_auxil = 0;
     &cadena = "";
     &for_hora = "";
     &for_fecha = "";
     &fech1 = @;
     &eldat = 0;
     &aEpiTc2 = "";

     &nBase = 0;
     &bonifi = 0;
     &bonifi_25 = 0;
     &reducc = 0;
     &swBonEpig = 0;
     &base_C = 0;
     &bonifi_Alta = 0;
     &bonifi25_Alta = 0;
     &bonjuv_Alta = 0;
     &nPropAlta = 0;
     &nPropBaja = 0;
     &nPropMat = 0;
     &base_Ca = 0;
     &bonifi_Baja = 0;
     &bonifi25_Baja = 0;
     &bonjuv_Baja = 0;
     &aSigno = "";
     &aParam = "";
     &tot_cd_06 = 0;
     &tot_cd_25 = 0;
     &tot_cd_28 = 0;
     &tot_cd_31 = 0;
     &tot_cd_32 = 0;
     &tot_cd_33 = 0;
     &tot_cd_34 = 0;
     &sw5560sim = 0; || bonificaciones textil > 55 y para > 60 a la vez
     &sw5960sim = 0; || bonificaciones > 59 y para > 60 a la vez
     &swredbonsim = 0; || bonificaciones > 45 a¤os y > 59 a¤os a la vez
     &swCumple = 0;
     &primer_mes = "";
     &ultimo_mes = "";
     &dat_mes = "";
     nume5 = 0;
     nume6 = 0;
     nume7 = 0;
     nume8 = 0;
     &aContrato = "";

     &nEuros = 0;
     &nPesetas = 0;
     &nCambioeuro = 166.386;
     &EURODB = 0;

     &s_ori = "";
     &swAjuste3 = 0;
     swSigue = 0;
     fFecha1 = @;
     fFecha2 = @;
     &CodigoCons = 0;
     &nBonif = 0;
     &swAjusteD = 0;
     &nElMes = 0;
     &d_alta = 0;
     nDiasMat = 0;
     &nDiasMate = 0;
     para1 = 0;
     &nCodigoCons = 0;
     nDiasVacac = 0;
     &nDiasExtra = 0;
     &nBaseExtra = 0;

     &s_tat = 0;
     &s_ele = "";
     &s_any = 0;
     &s_mes = 0;
     &s_has = 0;
     &s_anyl = 0;
     &s_sel = "";
     &s_lotecra = 0;
     &s_fichcra = "";
     &enLote = 0;
     &eaFich = "";
     &eaExt = "";
     &dias_enteros = 0;
     nProp = 0;
     &nBaseCC = 0;
     &swFiniqRaro2 = 0;
     &swSegundoLote = 0;

     nCoefTP = 0;
     nHorasSem = 0;
     &nPosicion = 0;
|FIN;

|PROCESO no_vacio; |TIPO 0;
    alfa1 = #0Campo;
|QBT alfa1;
|SI alfa1 = "";
    |MENAV "    Campo Obligatorio. Indique un nombre de fichero segun su criterio.";
    |ERROR;
|FINSI;
|FPRC;

|PROCESO euro;
     |SI EURODB = 0;          ||  Estamos en pesetas, pasa todo a euros
          nEuros = 0;
          nEuros = nPesetas / nCambioeuro;
          nEuros = (nEuros ! 2) * 100;
          nPesetas = 0;
     |FINSI;
     |SI EURODB = 2;          || Estamos en Euros, simplemente pasa a centimos
          nEuros = 0;
          nEuros = nPesetas * 100;
          nPesetas = 0;
     |FINSI;
|FPRC;

|PROCESO BuscaDisca;
     |ABRE #nomir006;
     #nomir006#0 = #labtraba#7;         || nif
     #nomir006#40 = #0#0;               || ejercicio
     |LEE 000#nomir006.=;
     |SI FSalida = 0;
          |SI #nomir006#6 = "S";
               #3#25 = "D";                   || Indicadores de discapacidad
          |FINSI;
     |FINSI;
     |CIERRA #nomir006;

     |ABRE #nomir003;
     #nomir003#0 = #labtraba#7;         || nif
     #nomir003#40 = #0#0;               || ejercicio
     #nomir003#41 = #labtraba#0;        || empresa
     |LEE 000#nomir003.=;
     |SI FSalida = 0;
          |SI #nomir003#6 = "S";
               #3#25 = "D";                   || Indicadores de discapacidad
          |FINSI;
     |FINSI;
     |CIERRA #nomir003;
|FPRC;

____________________________________/ TRANSFORMACION CONTRATOS
|PROCESO CodigosNuevos;
     |QBF aContrato;
     aContrato = ("000" + aContrato) % -103;
     |ABRE #nomequiv;
     #nomequiv#0 = aContrato;
     |LEE 000#nomequiv.=;
     |SI FSalida = 0;
          |SI #labtraba#42 = "X";|O #labtraba#42 = "T";|O #labtraba#42 = "P";
               aContrato = #nomequiv#2;      || tiempo parcial
          |SINO;
               aContrato = #nomequiv#1;      || tiempo completo
          |FINSI;
     |FINSI;
     |CIERRA #nomequiv;
|FPRC;

|PROCESO GuardaMeses;
     nume5 = primer_mes;
     nume6 = ultimo_mes;
     nume8 = dat_mes
     |SI nume8 < nume5; |O nume5 = 0;
          primer_mes = nume8;
     |FINSI;
     |SI nume8 > nume6; |O nume6 = 0;
          ultimo_mes = nume8;
     |FINSI;
|FPRC;

|PROCESO Los59;     || comprueba si este mes cumple 59 a¤os
     fech1 = #labtraba#11;        || ahora compruebo que tengo 2 bonif.
     aAlfa = fech1;
     aAlfa1 = aAlfa % 402;
     aAlfa2 = aAlfa % -104;
     nume1 = aAlfa1;     || mes
     nume2 = aAlfa2;     || a¤o
     nume3 = #0#0 - nume2;
     |SI #0#1 = nume1; |Y nume3 = 59;
          swCumple = 59;
     |FINSI;
|FPRC;

|PROCESO prop5560;
     || uso este proceso para proporcionar la parte que se va al dat de una
     || bonificacion y al dat de la otra, aunque uso las mismas variables
     nProp55 = 0;
     nProp60 = 0;
     nDiasProp55 = 0;
     nDiasProp60 = 0;
     nDiasProp55_A = 0;
     nDiasProp55_IT = 0;
     nDiasProp60_A = 0;
     nDiasProp60_IT = 0;
     nProp55_A = 0;
     nProp55_IT = 0;
     nProp60_A = 0;
     nProp60_IT = 0;

     |SI swredbonsim = 1; |O sw5960sim = 1;
          || nProp55 = reducc / (reducc + bonifi);
          || nProp60 = 1 - nProp55;

          aAlfa = #labtraba#11;
          aAlfa1 = aAlfa % 102;
          nume1 = aAlfa1;
          nDiasProp55 = nume1 - 1;
          nDiasProp60 = #11#20 - nDiasProp55;

          nProp55 = nDiasProp55 / (nDiasProp55 + nDiasProp60);
          nProp60 = 1 - nProp55;
     |FINSI;
     |SI sw5560sim = 1;
          nProp55 = bon_55 / (bon_55 + bon_60);
          nProp60 = 1 - nProp55;
          nDiasProp55 = (nProp55 * #11#20) ! 0;
          nDiasProp60 = (nProp60 * #11#20) ! 0;
     |FINSI;

     nDiasIT = #11#43 + #11#44;         || no cuento maternidad

     |SI nDiasProp55 > nDiasIT;
          nDiasProp55_A = nDiasProp55 - nDiasIT;
          nDiasProp55_IT = nDiasIT;
          nDiasProp60_A = nDiasProp60;
          nDiasProp60_IT = 0;
     |SINO;
          nDiasProp55_A = 0;
          nDiasProp55_IT = nDiasProp55;
          nDiasProp60_A = nDiasProp60 + nDiasProp55 - nDiasIT;
          nDiasProp60_IT = nDiasProp60 - nDiasProp60_A;
     |FINSI;

     nProp55_A = nDiasProp55_A / nDiasProp55;
     nProp55_IT = 1 - nProp55_A;
     nProp60_A = nDiasProp60_A / nDiasProp60;
     nProp60_IT = 1 - nProp60_A;
|FPRC;

|PROCESO ParcheBonifMat_1;
     swParcheBonMat = 0;
     nGuardaPropAlta = 0;
     nGuardaPropBaja = 0;
     nGuardaPropMat = 0;
     |ABRE #nombotra;
     #nombotra#0 = #labtraba#0;
     #nombotra#1 = #labtraba#1;
     #nombotra#2 = 111;
     |LEE 000#nombotra.=;
     |SI FSalida = 0; || es la 111
          |SI #labtraba#39 ! 0; |Y #labtraba#41 ! "          "; |Y #labtraba#41 ! "..........";
               fech1 = #labtraba#41;        || ahora compruebo que tengo 2 bonif.
               nume1 = fech1;              || y la otra es una que acaba justo
               nume1 = nume1 + 1;          || cuando la maternidad termina
               fech1 = nume1;              || en ese caso solo la tengo que pintar
               |SI #nombotra#4 = fech1;     || en el periodo de alta
                    aAlfa = fech1;
                    aAlfa1 = aAlfa % 402;
                    aAlfa2 = aAlfa % -104;
                    nume1 = aAlfa1;
                    nume2 = aAlfa2;
                    |SI #0#0 = nume2; |Y #0#1 = nume1;
                         swParcheBonMat = 1;
                         nGuardaPropAlta = nPropAlta;
                         nGuardaPropBaja = nPropBaja;
                         nGuardaPropMat = nPropMat;
                         nPropAlta = 0;
                         nPropBaja = 1;
                         nPropMat = 0;
                         swBonEpig = 0;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #nombotra;
|FPRC;

|PROCESO ParcheBonifMat_2;
     |SI swParcheBonMat = 1;
          nPropAlta = nGuardaPropAlta;
          nGuardaPropAlta = 0;
          nPropBaja = nGuardaPropBaja;
          nGuardaPropBaja = 0;
          nPropMat = nGuardaPropMat;
          nGuardaPropMat = 0;
          swParcheBonMat = 0;
     |FINSI;
|FPRC;

|PROCESO ParcheBonifMat_3;
     swParcheBonMat_34 = 0;
     nGuardaPropAlta = 0;
     nGuardaPropBaja = 0;
     nGuardaPropMat = 0;
     nDiasMat = #11#49;   || dias de maternidad
     |SI nDiasMat = 0;
          |ACABA;
     |FINSI;
     |SI #labtraba#39 ! 0; |Y #labtraba#40 ! "          "; |Y #labtraba#40 ! "..........";
          fech1 = #labtraba#40;
          aAlfa = fech1;
          aAlfa1 = aAlfa % 402;
          aAlfa2 = aAlfa % -104;
          nume1 = aAlfa1;
          nume2 = aAlfa2;
          |SI #0#0 = nume2; |Y #0#1 = nume1;
               || tengo una bonificacion que empieza este mes
               aAlfa = fech1;
               aAlfa1 = aAlfa % 102;
               nume1 = aAlfa1;
               nDiasBon = topemes - nume1;
               |SI nDiasBon [ nDiasMat;
                    || los dias bonificados son menores que los dias de
                    || maternidad, supongo que estoy todos los dias bonificados
                    || de maternidad, tiene que salir todos en el mismo seg-
                    || mento

                    swParcheBonMat_34 = 1;
                    nGuardaPropAlta = nPropAlta;
                    nGuardaPropBaja = nPropBaja;
                    nGuardaPropMat = nPropMat;
                    nPropAlta = 0;
                    nPropBaja = 0;
                    nPropMat = 1;
                    swBonEpig = 0;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ParcheBonifMat_4;
     |SI swParcheBonMat_34 = 1;
          nPropAlta = nGuardaPropAlta;
          nGuardaPropAlta = 0;
          nPropBaja = nGuardaPropBaja;
          nGuardaPropBaja = 0;
          nPropMat = nGuardaPropMat;
          nGuardaPropMat = 0;
          swParcheBonMat = 0;
     |FINSI;
|FPRC;

|PROCESO Dias_nat_alta;
     nDias_nat_alta = 0;

     alfa1 = "01";
     alfa2 = #0#1; alfa2 = "00" + alfa2; alfa2 = alfa2 % -102;
     alfa3 = #0#0;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
     fech1 = alfa4;      || PRIMER DIA DEL MES

     alfa1 = topemes; alfa1 = "00" + alfa1; alfa1 = alfa1 % -102;
     alfa2 = #0#1; alfa2 = "00" + alfa2; alfa2 = alfa2 % -102;
     alfa3 = #0#0;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
     fech2 = alfa4;      || ULTIMO DIA DEL MES

     alfa1 = #20#4;
     fech3 = alfa1;      || DIA ALTA TRABAJADOR

     alfa1 = #20#5;
     |QBT alfa1;
     |SI alfa1 = "";
          alfa1 = alfa4;
     |FINSI;
     fech4 = alfa1;      || DIA BAJA TRABAJADOR

     |SI fech3 ] fech1;
          fech5 = fech3;
     |SINO;
          fech5 = fech1;
     |FINSI;

     |SI fech4 [ fech2;
          fech6 = fech4;
     |SINO;
          fech6 = fech2;
     |FINSI;

     nume1 = fech5;
     nume2 = fech6;

     nDias_nat_alta = nume2 - nume1 + 1;
|FPRC;

|PROCESO fechas_bonif;
     aFechaIniBon = "        ";
     aFechaFinBon = "";
     nMesesBon = 0;
     nDiasBon = 0;

     |SI eldat = 1;
          nDiasBon = (#11#20 ! 0) - (#11#43 + #11#44 + #11#49); || dias alta
     |SINO;
          nDiasBon = (#11#43 + #11#44 + #11#49);   || dias baja
     |FINSI;

     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";

     aAlfa = #labtraba#40;         || fecha inicio bonificacion
     |QBF aAlfa;
     |SI aAlfa ! ""; |Y aAlfa ! "..........";
          aFechaIniBon = (aAlfa % -104) + (aAlfa % 402) + (aAlfa % 102);
          aAlfa1 = aAlfa % 402;    || mes inicio bonif.
          aAlfa2 = aAlfa % -104;   || a¤o inicio bonif.
          aAlfa3 = aAlfa % 102;    || dia inicio bonif.
     |FINSI;

     nNume1 = aAlfa1;
     nNume2 = aAlfa2;
     nNume3 = aAlfa3;
     |SI #0#1 = nNume1; |Y #0#0 = nNume2; |Y #labtraba#36 ! #labtraba#40;
          || la bonificacion comienza este mes;
          |SI eldat = 1;
               nDiasBon = nDiasBon - nNume3 + 1;
               |SI nDiasBon < 0;   || lo dejo como estaba
                    nDiasBon = nDiasBon + nNume3 - 1;
               |FINSI;
          |FINSI;
     |FINSI;

     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";

     aAlfa = #labtraba#41;         || fecha fin bonificacion
     |QBF aAlfa;
     |SI aAlfa ! ""; |Y aAlfa ! "..........";
          aFechaFinBon = (aAlfa % -104) + (aAlfa % 402) + (aAlfa % 102);
          aAlfa1 = aAlfa % 402;    || mes fin bonif.
          aAlfa2 = aAlfa % -104;   || a¤o fin bonif.
          aAlfa3 = aAlfa % 102;    || dia fin bonif.
     |FINSI;

     nNume1 = aAlfa1;
     nNume2 = aAlfa2;
     nNume3 = aAlfa3;
     |SI #0#1 = nNume1; |Y #0#0 = nNume2;
          || la bonificacion termina este mes;
          |SI eldat = 1;
               nDiasBon = nNume3 - (#11#43 + #11#44 + #11#49);   || dias baja
          |FINSI;
     |FINSI;

     |SI nNume2 [ #0#0;       || para que si la bonificacion ya ha
                              || acabado segun las fechas de la ficha del
                              || trabajador no me la pinte
          |SI nNume2 < #0#0;
               aFechaIniBon = "        ";
               aFechaFinBon = "        ";
          |FINSI;
          |SI nNume2 = #0#0;
               |SI nNume1 < #0#1;
                    aFechaIniBon = "        ";
                    aFechaFinBon = "        ";
               |FINSI;
          |FINSI;
     |FINSI;

     |SI aFechaIniBon ! "        "; |Y aFechaFinBon = "";
          |ABRE #nombonif;
          #nombonif#0 = #labtraba#39;
          |LEE 000#nombonif.=;
          |CIERRA #nombonif;

          |PARA nCampo = 14; |SI nCampo [ 19; |HACIENDO nCampo = nCampo + 1;
               |SI #nombonif#nCampo# ! 999;
                    nMesesBon = nMesesBon + #nombonif#nCampo#;
               |SINO;
                    aFechaFinBon = "        ";
               |FINSI;
          |SIGUE;

          |SI aFechaFinBon ! "        ";
               fFecha = #labtraba#40;
               nMesesBon = (nMesesBon/1000);
               fFecha = fFecha + nMesesBon;
               nFecha = fFecha;
               nFecha = nFecha - 1;
               fFecha = nFecha;

               aAlfa = fFecha;
               aFechaFinBon = (aAlfa % -104) + (aAlfa % 402) + (aAlfa % 102);
          |FINSI;
     |FINSI;

     |SI aFechaFinBon = "";
          aFechaFinBon = "        ";
     |FINSI;

     aAlfa1 = #3#1; |QBF aAlfa1;
     |SI aAlfa1 ! "10"; |Y aAlfa1 ! "11"; |Y sw5560sim ! 0; |Y sw5960sim ! 0;
     |Y swredbonsim ! 0;
          #3#2 = nDiasBon;
     |FINSI;
     #3#7 = aFechaIniBon;
     #3#8 = aFechaFinBon;
|FPRC;

|PROCESO bon_cd25;
     |SI #13#10 = 2;
          aAlfa1 = #13#13;
          |QBF aAlfa1;
          aAlfa1 = ("000" + aAlfa1) % -103;
          |SI aAlfa1 = "025";
               swbon_25 = 1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ini_linea;
     |DDEFECTO #5;
     linea = linea + 2;        || linea del fichero
     |SI linea > 99999;
          |MENAV "0000Numero de lineas excedido. Lote demasiado extenso.";
          |MENAV "0000Debera repetir el lote seleccionando menos empresas.";
     |FINSI;
     nlinea = nlinea + 1;      || numero de registros

     #5#0 = #2#0;
     #5#1 = linea;
     #5#2 = "F";
     #5#3 = clave;
     |GRABA 020#5b;

     sw_auxil = 0;
     #4#0 = #5#2;
     #4#1 = #5#3;
     |LEE 000#4=;
     |SI FSalida ! 0;
          alfa1 = "    Descripcion [" + #4#0 + "-" + #4#1 + "] sin definir ...";
          |MENAV alfa1;
          sw_auxil = 1;
     |FINSI;
|FPRC;

|PROCESO fin_linea;
     #5#4 = cadena;
     |GRABA 020#5a;
     |LIBERA #5;
|FPRC;

|PROCESO fin_linea2;
     linea = linea - 2;
     nlinea = nlinea - 1;
     |BORRA 020#5a;
     |LIBERA #5;
|FPRC;

|PROCESO fecha;
     for_fecha = fech1;
     aAlfa = for_fecha % -104;
     nNume = aAlfa;
     nNume = nNume $ 4;
     |SI nNume ! 0;      || no es bisiesto
          aAlfa = for_fecha % 105;
          |SI aAlfa = "29.02";
               for_fecha = "28.02" + (for_fecha % -105);
          |FINSI;
     |FINSI;
     for_fecha = (for_fecha % -104) + (for_fecha % 402) + (for_fecha % 102);
|FPRC;

|PROCESO fechaTC2;
     for_fecha = fech1;
     for_fecha = (for_fecha % 102) + (for_fecha % 402) + (for_fecha % -102);
|FPRC;

|PROCESO hora;
     |HORA for_hora;
     for_hora = (for_hora % 102) + (for_hora % 402);
|FPRC;

|PROCESO lee_bonif;
     |DDEFECTO #13;
     |ABRE #13;
     #13#0 = #20#12;
     |LEE 000#13=;
     |CIERRA #13;
|FPRC;

|PROCESO CD_2006_Epi;
     |SI eldat = 1;
          |SI #0#18 [ 2006;
               aEpiTc2 = #11#26;
          |SINO;
               |SI #11#26 > 900;
                    aEpiTc2 = #labtraba#204;
               |SINO;
                    aEpiTc2 = "";
               |FINSI;
          |FINSI;
     |SINO;
     || migue
          |SI #0#18 [ 2009;
               |SI #0#18 [ 2006;
                    aEpiTc2 = #22#2;
               |SINO;
                    aEpiTc2 = 904;
               |FINSI;
          |SINO;
               ||HAZ VerifCNAE;
               ||aEpiTc2 = nEpigConv;
          |FINSI;
     |FINSI;
|FPRC;

____________________________________/ FORMATEO DE DATOS
|PROCESO errores;
    alfa1 = "    " + i + "." + clave;
|SI error = 1;
        alfa1 = alfa1 + ": VALOR DE CAMPO NUMERICO INCORRECTO";
|FINSI;
|SI error = 2;
        alfa1 = alfa1 + ": CAMPO OBLIGADO SIN RELLENO";
|FINSI;
     alfa1 = alfa1 + " EN LINEA " + linea;
|MENAV alfa1;
|FPRC;

|PROCESO comp1;               || COMPRUEBA SI ES NUMERICO.
     |SI ajuste1 = "1";
          error = 0;
          |PARA ind = 1; |SI ind [ long; |HACIENDO ind = ind + 1;
               posi = 100 * ind + 1;
               digito = texto % posi;
               |SI digito ! " ";|Y digito ! ".";|Y digito ! "-";
                    |SI digito < "0"; |O digito > "9";
                         error = 1;
                         |SAL;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO comp2;               || COMPRUEBA SI TIENE QUE ESTAR RELLENO.
     |SI ajuste3 = "3";
          error = 0;
          FSalida = 0;
          |QBF alfa;
          |PARA ind = 1; |SI FSalida = 0; |HACIENDO ind = ind + 1;
               posi = 100 * ind + 1;
               digito = texto % posi;
               |SI digito = "";
                    error = 2;
                    |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO comp3;               || AJUSTA I, o D. Y RELLENA DE 0 o BLANCOS.
     |SI ajuste3 = "1";       || RELLENA BLANCOS.
          mascara = "                                                                    ";
     |FINSI;
     |SI ajuste3 = "2";       || RELLENA CEROS.
          mascara = "00000000000000000000000000000000000000000000000000000000000000000000";
     |FINSI;
     |SI ajuste2 = "1";       || AJUSTA DERECHA.
          posi = 100 + long;
          posi = posi * -1;
          |QBF texto;
          texto = mascara + texto;
          texto = texto % posi;
     |FINSI;
     |SI ajuste2 = "2";
          posi = 100 + long;
          |QBF texto;
          texto = texto + mascara;
          texto = texto % posi;
     |FINSI;
|FPRC;

|PROCESO monta;
     texto = "";
     cadena = "";
     |PARA i = 0; |SI i < 30; |HACIENDO i = i + 1;
          nCampo = i;
          texto = #3nCampo;
          nTipo = i * 6 + 2;                 || MODIFICABLE.
          alfa  = #4nTipo;
          nTipo = i * 6 + 2;                 || VISUAL.
          alfa1 = #4nTipo;
          |SI alfa = "S"; |O alfa1 = "S";
               nTipo = i * 6 + 6;            || Longitud.
               long  = #4nTipo;
               nTipo = i * 6 + 7;            || AJUSTE.
               alfa  = #4nTipo;
               ajuste1 = alfa % 101;
               ajuste2 = alfa % 201;
               ajuste3 = alfa % 301;
               |HAZ comp1;
               |SI error = 1; |HAZ errores; |ACABA; |FINSI;
               |HAZ comp2;
               |SI error = 2; |HAZ errores; |ACABA; |FINSI;
               |HAZ comp3;
               cadena = cadena + texto;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO edl_CD_32;      || bonificaciones SISTEMA GARANTIA JUVENIL
     clave = "EDL";
     |SI #20#122 = 0; |ACABA;  |FINSI;
     |HAZ ini_linea;
     nBase = #20#122;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          bonjuv_Alta = nBase * nPropAlta;
          bonjuv_Alta = (bonjuv_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = bonjuv_Alta;
          |SI nPropAlta ! 1;
               || ASI:
               |SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
                    nume1 = dias_enteros;
                    nProp = #12#234 / 40;
                    |SI 0.50 [ nProp; |Y nProp < 0.75;
                         nume2 = 5;
                    |FINSI;
                    |SI nProp ] 0.75;
                         nume2 = 7.5;
                    |FINSI;
               |SINO;
                    nume1 = d_alta;
                    nume2 = 10;
               |FINSI;
               bonjuv_Alta = nume1 * nume2;
               bonjuv_Alta = bonjuv_Alta * 100;
               nBase = bonjuv_Alta;
          |FINSI;
     |SINO;
          |SI nPropMat ! 0;   || ojo, es un mes entero de baja, con dias
                              || en maternidad
               nBase = nBase / 100;   || vuelvo a 2 decimales
               |SI eldat = 2;
                    bonjuv_Baja = nBase * nPropBaja;
                    bonjuv_Baja = (bonjuv_Baja * 100) ! 0;   || vuelvo en centimos
                    nBase = bonjuv_Baja;
               |FINSI;
               |SI eldat = 3;
                    nBase = #20#122 - bonjuv_Baja;
               |FINSI;
          |SINO;              || como siempre
               nBase = #20#122 - bonjuv_Alta;
               nBase = nBase ! 0;
          |FINSI;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "32";
          |SI dias_enteros ! 0;
               nume1 = dias_enteros;
          |SINO;
               nume1 = d_alta;
          |FINSI;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_32 = tot_cd_32 + nBase;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CD_32;      || TOTAL bonificaciones SISTEMA GARANTIA JUVENIL
     clave = "EDT";
     |HAZ ini_linea;
     tot_cd_32 = tot_cd_32 ! 2;
     |SI sw_auxil = 0;|Y tot_cd_32 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo elemento datos
          #3#1  = "32";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";                || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = tot_cd_32;         || importe o cuota
          #3#8  = aSigno;            || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CA_81;      || TOTAL bonificaciones SISTEMA GARANTIA JUVENIL
     clave = "EDT";
     |HAZ ini_linea;
     |SI sw_auxil = 0;|Y #14#170 ! 0;
          |DDEFECTO #3;
          #3#0  = "CA";              || tipo elemento datos
          #3#1  = "81";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";                || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = #14#170;           || importe o cuota
          #3#8  = aSigno;            || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO CoefTP;
     nCoefTP = 0;

     nHorasSem = 40;
     nCoefTP = (#labtraba#234 / nHorasSem) ! 3;
|FPRC;

|PROCESO edl_CD_34;                || reduccion exencion 500 euros
     clave = "EDL";
     |SI swbon_34 = 0; |ACABA; |FINSI;
     |HAZ ini_linea;
     nBase = reducc;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          bonifi_Alta = nBase * nPropAlta;
          bonifi_Alta = (bonifi_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = bonifi_Alta;
          |SI nPropAlta ! 1;
               || ASI:
               |SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
                    nume1 = dias_enteros;
                    |HAZ CoefTP;
                    nume2 = (((500 * nCoefTP) % 23.60) / 30) ! 2;
               |SINO;
                    nume1 = d_alta;
                    nume2 = 3.93;
               |FINSI;
               nume3 = #11#43 + #11#44 + #11#49 - swAjuste3;
               || el ajuste lo hago en la parte que haya mas dias
               || si no, nos da error
               |SI nume3 > nume1;
                    || mas dias de IT que de alta
                    bonifi_Alta = (nume1 * nume2) ! 2;
               |SINO;
                    bonifi_Alta = (reducc / 100) - (nume3 * nume2) ! 2;
               |FINSI;
               bonifi_Alta = bonifi_Alta * 100;
               nBase = bonifi_Alta;
          |FINSI;
     |SINO;
          |SI nPropMat ! 0;   || ojo, es un mes entero de baja, con dias
                              || en maternidad
               nBase = nBase / 100;   || vuelvo a 2 decimales
               |SI eldat = 2;
                    |SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
                         nume1 = dias_enteros;
                         |HAZ CoefTP;
                         nume2 = (((500 * nCoefTP) % 23.60) / 30) ! 2;
                    |SINO;
                         nume1 = d_alta;
                         nume2 = 3.93;
                    |FINSI;
                    bonifi_Baja = (nume1 * nume2) ! 2;
                    bonifi_Baja = bonifi_Baja * 100;
                    nBase = bonifi_Baja;
               |FINSI;
               |SI eldat = 3;
                    nBase = reducc - bonifi_Baja;
               |FINSI;
          |SINO;              || como siempre
               |SI eldat = 2;
                    |SI nDiasMate = 0;
                         nBase = reducc - bonifi_Alta;
                         nBase = nBase ! 0;
                    |SINO;
                         || habra enf y mat
                         |SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
                              nume1 = dias_enteros;
                              |HAZ CoefTP;
                              nume2 = (((500 * nCoefTP) % 23.60) / 30) ! 2;
                         |SINO;
                              nume1 = d_alta;
                              nume2 = 3.93;
                         |FINSI;
                         |SI dias_enteros ! 0;
                              || si tengo dias reales en el dat = 2
                              bonifi_Baja = reducc - bonifi_Alta;
                              nBase = bonifi_Baja;
                         |SINO;
                              nBase = 0;
                         |FINSI;
                         || bonifi_Baja = (nume1 * nume2) ! 2;
                         || bonifi_Baja = bonifi_Baja * 100;
                         || nBase = bonifi_Baja;
                    |FINSI;
               |SINO;
                    nBase = reducc - bonifi_Alta - bonifi_Baja;
                    nBase = nBase ! 0;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0; |Y reducc ! 0; |Y swbon_34 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "34";
          || nume1 = #11#20 ! 0;
          |SI dias_enteros ! 0;
               nume1 = dias_enteros;
          |SINO;
               nume1 = d_alta;
          |FINSI;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_34 = tot_cd_34 + nBase;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CD_34;                || reduccion exencion 500 euros
     clave = "EDT";
     |HAZ ini_linea;
     tot_cd_34 = tot_cd_34 ! 2;
     |SI sw_auxil = 0;|Y tot_cd_34 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo elemento datos
          #3#1  = "34";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";                || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = tot_cd_34;         || importe o cuota
          #3#8  = aSigno;            || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CD_33;                || bonificacion tutorias
     clave = "EDT";
     |HAZ ini_linea;
     tot_cd_33 = tot_cd_33 ! 2;
     |SI sw_auxil = 0;|Y tot_cd_33 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo elemento datos
          #3#1  = "33";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";                || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = tot_cd_33;         || importe o cuota
          #3#8  = aSigno;            || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_31;                || bonificaciones TARIFA PLANA
     clave = "EDL";
     |SI swbon_31 = 0; |ACABA; |FINSI;
     |HAZ ini_linea;
     nBase = reducc;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          |SI swBonEpig = 1;
               nBase = nBase - base_C;  || no porporciono bonif epig
          |FINSI;
          bonifi_Alta = nBase * nPropAlta;
          |SI swBonEpig = 1;
               bonifi_Alta = bonifi_Alta + base_Ca;
          |FINSI;
          bonifi_Alta = (bonifi_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = bonifi_Alta;
          |SI nPropAlta ! 1; |Y swbon_31 = 1;
               || ASI:
               |SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
                    nume1 = dias_enteros;
                    nProp = #12#234 / 40;
                    |SI 0.50 [ nProp; |Y nProp < 0.75;
                         nume2 = 1.67;
                    |FINSI;
                    |SI nProp ] 0.75;
                         nume2 = 2.5;
                    |FINSI;
               |SINO;
                    nume1 = d_alta;
                    nume2 = 3.33;
               |FINSI;
               bonifi_Alta = (((nBaseCC / 100) % 23.60) ! 2) - (nume1 * nume2);
               bonifi_Alta = bonifi_Alta * 100;
               nBase = bonifi_Alta;
          |FINSI;
     |SINO;
          |SI nPropMat ! 0;   || ojo, es un mes entero de baja, con dias
                              || en maternidad
               nBase = nBase / 100;   || vuelvo a 2 decimales
               |SI eldat = 2;
                    |SI swbon_31 = 1;
                         |SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
                              nume1 = dias_enteros;
                              nProp = #12#234 / 40;
                              |SI 0.50 [ nProp; |Y nProp < 0.75;
                                   nume2 = 1.67;
                              |FINSI;
                              |SI nProp ] 0.75;
                                   nume2 = 2.5;
                              |FINSI;
                         |SINO;
                              nume1 = d_alta;
                              nume2 = 3.33;
                         |FINSI;
                         bonifi_Baja = (((nBaseCC / 100) % 23.60) ! 2) - (nume1 * nume2);
                         bonifi_Baja = bonifi_Baja * 100;
                         nBase = bonifi_Baja;
                    |SINO;
                         bonifi_Baja = nBase * nPropBaja;
                         bonifi_Baja = (bonifi_Baja * 100) ! 0;   || vuelvo en centimos
                         nBase = bonifi_Baja;
                    |FINSI;
               |FINSI;
               |SI eldat = 3;
                    nBase = reducc - bonifi_Baja;
               |FINSI;
          |SINO;              || como siempre
               nBase = reducc - bonifi_Alta;
               nBase = nBase ! 0;
          |FINSI;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0; |Y reducc ! 0; |Y swbon_31 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "31";
          |SI swbon_31 = 2;
               #3#1  = "06";
          |FINSI;
          || nume1 = #11#20 ! 0;
          |SI dias_enteros ! 0;
               nume1 = dias_enteros;
          |SINO;
               nume1 = d_alta;
          |FINSI;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          |SI swbon_31 = 1;
               tot_cd_31 = tot_cd_31 + nBase;
          |FINSI;
          |SI swbon_31 = 2;
               tot_cd_06 = tot_cd_06 + nBase;
          |FINSI;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CD_31;
     clave = "EDT";
     |HAZ ini_linea;
     tot_cd_31 = tot_cd_31 ! 2;
     |SI sw_auxil = 0;|Y tot_cd_31 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo elemento datos
          #3#1  = "31";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";                || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = tot_cd_31;         || importe o cuota
          #3#8  = aSigno;            || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_25;
     clave = "EDL";
     |SI bonifi_25 ! 0;
          swbon_25 = 1;
     |FINSI;
     |SI swbon_25 = 0; |ACABA; |FINSI;
     |HAZ ini_linea;
     nBase = bonifi;
     |SI bonifi_25 ! 0;
          nBase = bonifi_25;
     |FINSI;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          |SI swBonEpig = 1;
               nBase = nBase - base_C;  || no porporciono bonif epig
          |FINSI;
          bonifi25_Alta = nBase * nPropAlta;
          |SI swBonEpig = 1;
               bonifi25_Alta = bonifi25_Alta + base_Ca;
          |FINSI;
          bonifi25_Alta = (bonifi25_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = bonifi25_Alta;
     |SINO;
          |SI nPropMat ! 0;   || ojo, es un mes entero de baja, con dias
                              || en maternidad
               nBase = nBase / 100;   || vuelvo a 2 decimales
               |SI eldat = 2;
                    bonifi25_Baja = nBase * nPropBaja;
                    bonifi25_Baja = (bonifi25_Baja * 100) ! 0;   || vuelvo en centimos
                    nBase = bonifi25_Baja;
               |FINSI;
               |SI eldat = 3;
                    nBase = bonifi_25 - bonifi25_Baja;
               |FINSI;
          |SINO;              || como siempre
               nBase = bonifi_25 - bonifi25_Alta;
               nBase = nBase ! 0;
          |FINSI;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0; |Y bonifi ! 0; |Y swbon_25 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "25";
          nume1 = #11#20 ! 0;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_25 = tot_cd_25 + nBase;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
     |SI bonifi_25 ! 0;
          swbon_25 = 0;
     |FINSI;
|FPRC;

|PROCESO edt_CD_25;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_25 = tot_cd_25 ! 2;
|SI sw_auxil = 0;|Y tot_cd_25 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "25";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_25;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_28;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_28 = tot_cd_28 ! 2;
|SI sw_auxil = 0;|Y tot_cd_28 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "28";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_28;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edl_CD_28;
     clave = "EDL";
     |HAZ ini_linea;
     nBase = #11#88;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "28";
          nume1 = #11#20 ! 0;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          ||HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_28 = tot_cd_28 + nBase;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO PFETP;
     |SI #12#129 = "G";  || en guarda legal, aunque este a TP la bonificacion
          |ACABA;        || se cobra completa, con lo que ESTO no hay que
     |FINSI;             || hacerlo, el indicador ha de quedarse a CERO

     |ABRE #nombotra;
     #nombotra#0 = #labtraba#0;
     #nombotra#1 = #labtraba#1;
     |SI #11#73 > 0;
          #nombotra#2 = #20#114;
          |SI #20#114 = 0;
               #nombotra#2 = nBonif;
          |FINSI;
     |FINSI;
     |SI #11#75 > 0;
          #nombotra#2 = #20#116;
          |SI #20#116 = 0;
               #nombotra#2 = nBonif;
          |FINSI;
     |FINSI;
     |LEE 000#nombotra.=;
     |CIERRA #nombotra;

     swSigue = 0;
     || aAlfa1 = #labtraba#36;
     aAlfa1 = #nombotra#4;
     aAlfa2 = "08.03.2009";
     fFecha1 = aAlfa1;
     fFecha2 = aAlfa2;
     |SI fFecha1 < fFecha2;
          swSigue = 1;
     |SINO;
          |SI #0#0 = 2009; |Y #0#1 = 4;
               swSigue = 1;   || todavia no estaba esto en vigor
          |SINO;
               swSigue = 0;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
               |SI #labtraba#234 > 0; |Y #labtraba#234 < 10;
                    #3#16 = "3";
               |FINSI;
               |SI #labtraba#234 ] 10; |Y #labtraba#234 < 20;
                    #3#16 = "2";
               |FINSI;
               |SI #labtraba#234 ] 20; |Y #labtraba#234 < 30;
                    #3#16 = "1";
               |FINSI;
               |SI #labtraba#234 ] 30;
                    #3#16 = "4";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PropTP;
          |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
               |SI #labtraba#234 ] 20; |Y #labtraba#234 < 30;
                    #3#16 = "5";
               |FINSI;
               |SI #labtraba#234 ] 30;
                    #3#16 = "6";
               |FINSI;
          |FINSI;
|FPRC;

|PROCESO RecargoMora;
     |SI #0#14 = "L04";
          |ACABA;
     |FINSI;
     |SI #labempre#127 > 0;
          #20#12 = 0;
          #20#43 = 0;
          #20#44 = 0;
          #20#82 = 0;
          #20#63 = 0;
          #20#79 = 0;
          #20#83 = 0;
          #20#81 = 0;
          #20#64 = 0;
          #20#92 = 0;
          #20#94 = 0;
          #20#95 = 0;
          #20#96 = 0;
          #20#97 = "";
          #20#99 = 0;
          #20#100 = 0;
          #20#101 = 0;
          #20#106 = 0;
     |FINSI;
     |SI #labempre#127 > 0; |Y #labempre#64 = "N";
          #20#57 = 0;
          #20#58 = 0;
     |FINSI;
|FPRC;

|PROCESO lee_cons;
     CodigoCons = #labempre#32;
     |ABRE #nomtraca;
     #nomtraca#0 = #11#0;
     #nomtraca#1 = #11#39;
     |LEE 000#nomtraca.=;
     |SI FSalida = 0;|Y #nomtraca#3 ! 0;
          CodigoCons = #nomtraca#3;
     |FINSI;
     |CIERRA #nomtraca;

     |DDEFECTO #nomconst;
     |ABRE #nomconst;
     #nomconst#0 = CodigoCons;
     |LEE 000#nomconst.=;
     |CIERRA #nomconst;
|FPRC;

|PROCESO Parche_Feb;
     || Y ooootro parchecito (12.03.2010, 00601.00478)
     || Resulta que en febrero, si cotizas por menos de la base minima y eres
     || diario, al topear la base de profesionales, la variable nPropAlta
     || en caso de IT todo el mes queda con un valor que debe quedar a cero
     || eso si tienes bonificaciones

     |SI #labtraba#42 = "D"; |Y dat_mes = 2;    || diario, febrero
          |SI #20#39 ! #20#40;                  || base comunes distinta a prof
               |SI #20#39 = #20#62;             || base comunes igual a base IT
                    nNume = #20#31 + #20#32 + #20#65;|| Dias enfer.acci.mater.
                    |SI nNume ] #20#8;             || todo el mes en IT
                         nume1 = #20#40 * 100;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AjusteDes;
     nume1 = #11#43 + #11#44 + #11#49;
     nume2 = #11#42;
     |SI nume2 = 0; nume2 = topemes; |FINSI;
     |SI #11#41 [ 1; |Y nume2 ] topemes; |Y #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
     |Y #11#69 ! 0;
     |Y d_alta < 30;
          |SI nElMes = 1; |O nElMes = 2; |O nElMes = 3; |O nElMes = 5; |O nElMes = 7;
          |O nElMes = 8; |O nElMes = 10; |O nElMes = 12;
/*
               |SI nElMes = 2;
                    swAjusteD = 2;
               |SINO;
                    swAjusteD = -1;
               |FINSI;
*/
          |FINSI;
     |FINSI;
     d_alta = d_alta + swAjusteD;
|FPRC;

|PROCESO Activa20; |TIPO 7;
     |SI #0#14 = "L00";
          |SI #0#9 = "T";          || liquidacion (total en plazo)
               #0#20 = 0;
               |CAMPO_MODIFICA #0#20, 1, "S";
          |FINSI;
          |SI #0#9 = "O";          || liquidacion (obrera en plazo)
               #0#20 = 1;
               |CAMPO_MODIFICA #0#20, 1, "N";
          |FINSI;
          |SI #0#9 = "P";          || liquidacion (patronal en plazo)
               #0#20 = 2;
               |CAMPO_MODIFICA #0#20, 1, "N";
          |FINSI;
     |SINO;
          #0#20 = 0;
          |CAMPO_MODIFICA #0#20, 1, "N";
     |FINSI;
     |PINTA #0#20;
|FPRC;

|PROCESO Busca111;
     || la bonificacion va solo en el segmento de alta en el caso de que comience
     || este mes, si venia de otra maternidad anterior tendra que ir en los dos
     |SI #nombotra#2 = 111;
          aAlfa = #nombotra#4;
          aAlfa1 = aAlfa % 402;
          aAlfa2 = aAlfa % -104;
          nume1 = aAlfa1;
          nume2 = aAlfa2;

          |PARA para1 = 27; |SI para1 [ 30; |HACIENDO para1 = para1 + 1;
               |SI #20para1 = "M"; |Y #0#0 = nume2; |Y #0#1 = nume1;
                    nDiasMate = 0;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Ayuda15; |TIPO 7;
     |PUSHV 10552380;
     |ATRI R;
     ||            5    6         7         8
     ||            56789012345678901234567890
     |PINTA 1055, "       - Opciones -       ";
     |PINTA 1155, "L00-Normal                ";
     |PINTA 1255, "L02-Salarios de tramita-  ";
     |PINTA 1355, "    ci¢n                  ";
     |PINTA 1455, "L03-Atrasos               ";
     |PINTA 1555, "L04-Devoluci¢n prestacio- ";
     |PINTA 1655, "    nes o bonificaciones  ";
     |PINTA 1755, "    indebidas             ";
     |PINTA 1855, "L09-Complementarias       ";
     |PINTA 1955, "L13-Finiquitos            ";
     |ATRI 0;
|FPRC;

|PROCESO Restaura_silcon09;
     |POPV;
|FPRC;

|PROCESO LeeConstante;
     nCodigoCons = #labempre#32;
     |ABRE #nomtraca;
     #nomtraca#0 = #labtraba#0;
     #nomtraca#1 = #labtraba#1;
     |LEE 000#nomtraca.=;
     |SI FSalida = 0;|Y #nomtraca#3 ! 0;
          nCodigoCons = #nomtraca#3;
     |FINSI;
     |CIERRA #nomtraca;

     |DDEFECTO #nomconst;
     |ABRE #nomconst;
     #nomconst#0 = nCodigoCons;
     |LEE 000#nomconst.=;
     |CIERRA #nomconst;
|FPRC;

|PROCESO FiniqMen;
     |SALVA_FICHA #nomcalca;

     #nomcalca#3 = 2;
     |LEE 000#nomcalca.=;
     |SI FSalida = 0;
          #20#159 = #nomcalca#171;
          #20#160 = #nomcalca#172;
     |FINSI;
     |REPON_FICHA #nomcalca;
|FPRC;

|PROCESO FiniqFormacionMen;
     |SI #labtraba#45 = "421"; |O #labtraba#45 = "422"
          |SI #0#17 = 0;
               |HAZ FiniqMen;

               |SI #20#159 ! 0;
                    nBase = #nomconst#33;

                    #20#8 = #20#8 + #20#159;
                    |SI #20#8 > 30;
                         |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
                              #20#8 = #20#8 - 1;
                         |FINSI;
                         #20#159 = #20#159 - 1;
                    |FINSI;
                    #20#39 = #20#39 + (#20#159 * nBase);
                    #20#40 = #20#40 + (#20#159 * nBase);
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO FiniqHis;
     |SALVA_FICHA #nomhicca;

     #nomhicca#3 = 2;
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;         || tengo finiquito
          #20#159 = #nomhicca#213;
          #20#160 = #nomhicca#214;
     |FINSI;

     |REPON_FICHA #nomhicca;
|FPRC;

|PROCESO FiniqFormacionHis;
     |SI #labtraba#45 = "421"; |O #labtraba#45 = "422"
          |SI #0#17 = 0;
               |HAZ FiniqHis;

               |SI #20#159 ! 0;
                    nBase = #nomconst#33;

                    #20#8 = #20#8 + #20#159;
                    |SI #20#8 > 30;
                         |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
                              #20#8 = #20#8 - 1;
                         |FINSI;
                         #20#159 = #20#159 - 1;
                    |FINSI;
                    #20#39 = #20#39 + (#20#159 * nBase);
                    #20#40 = #20#40 + (#20#159 * nBase);
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO edt_CA_13;                || otros conceptos
     clave = "EDT";
     |HAZ ini_linea;
     |SI sw_auxil = 0;|Y #14#169 ! 0;
          |DDEFECTO #3;
          #3#0  = "CA";              || tipo elemento datos
          #3#1  = "13";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = #14#168;           || base
          #3#4  = "";                || indicador de factor o tipo
          ||HAZ descompone;
          #3#5  = 0;            || parte entera de tipo
          #3#6  = 0;            || parte decimal de factor o tipo
          #3#7  = #14#169;           || importe o cuota
          #3#8  = "";                || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO CamposCRA;
     |SI #0#21 = "S";
          |CAMPO_MODIFICA #0#22, 1, "S";
          |CAMPO_MODIFICA #0#23, 1, "S";
          #0#22 = #0#2 + 1;
          #0#23 = #0#3;
          |PINTA #0#22;
          |PINTA #0#23;
     |SINO;
          |CAMPO_MODIFICA #0#22, 1, "N";
          |CAMPO_MODIFICA #0#23, 1, "N";
          #0#22 = 00000;
          #0#23 = "        ";
          |PINTA #0#22;
          |PINTA #0#23;
     |FINSI;
|FPRC;

|PROCESO LanzaCRA;
     s_sel = #0#11;
     s_lotecra = #0#22;
     s_fichcra = #0#23;
     |SI swFiniqRaro2 = 1; |O swSegundoLote = 1;
          s_any = s_any - 1;
          s_mes = 12;
          s_has = 12;
          s_anyl = s_anyl - 1;
     |FINSI;
     |SUB_EJECUTA "silcon20;silcon09";
|FPRC;

|PROCESO GrabaLote;
     aAlfa1 = #0#2; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
     aAlfa2 = #0#3; |QBF aAlfa2;
     aAlfa3 = #0#4; |QBF aAlfa3;
     aAlfa = "    S¿Desea grabar el fichero " + aAlfa2 + "." + aAlfa3 + "?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          enLote = #0#2;
          eaFich = #0#3; |QBF eaFich;
          eaExt = #0#4; |QBF eaExt;
          |SUB_EJECUTA "silcon05;silcon09";
     |FINSI;
|FPRC;

|PROCESO GrabaLotes;
     aAlfa1 = #0#2; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
     aAlfa2 = #0#3; |QBF aAlfa2;
     aAlfa3 = #0#4; |QBF aAlfa3;

     aAlfa4 = #0#22; |QBF aAlfa4; aAlfa4 = ("00000" + aAlfa4) % -105;
     aAlfa5 = #0#23; |QBF aAlfa5;
     aAlfa6 = "cra"; |QBF aAlfa6;

     aAlfa = "    S¿Desea grabar los ficheros " + aAlfa2 + "." + aAlfa3 + " y ";
     aAlfa = aAlfa + aAlfa5 + "." + aAlfa6 + "?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          enLote = #0#2;
          eaFich = #0#3; |QBF eaFich;
          eaExt = #0#4; |QBF eaExt;
          |SUB_EJECUTA "silcon05;silcon09";

          enLote = #0#22;
          eaFich = #0#23; |QBF eaFich;
          eaExt = "cra"; |QBF eaExt;
          |SUB_EJECUTA "silcon05;silcon09";
     |FINSI;
|FPRC;

|PROCESO bon_rdl012015_men;
     || transformo bonif. 507 o 508 en fomento empleo, para que acumulen
     || en el CA22
     |SI #18#12 = 507; |O #18#12 = 508;
          |SI #18#63 ! 0;
               |SI #18#96 = 0;
                    #18#96 = #18#63;    || importe bonif
                    #18#135 = #18#12;   || codigo bonif
               |SINO;
                    #18#133 = #18#63;   || importe bonif
                    #18#136 = #18#12;   || codigo bonif
               |FINSI;
               #18#12 = 0;
               #18#63 = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO bon_rdl012015_his;
     || transformo bonif. 507 o 508 en fomento empleo, para que acumulen
     || en el CA22
     |SI #19#12 = 507; |O #19#12 = 508;
          |SI #19#63 ! 0;
               |SI #19#138 = 0;
                    #19#138 = #19#63;    || importe bonif
                    #19#177 = #19#12;   || codigo bonif
               |SINO;
                    #19#175 = #19#63;   || importe bonif
                    #19#178 = #19#12;   || codigo bonif
               |FINSI;
               #19#12 = 0;
               #19#63 = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO cambia_autoriz;
     #silcon03#0 = #silcon03#0;
     #silcon03#1 = 0002;
     |LEE 101#silcon03.=;
     |SI FSalida = 0;
          nNume1 = nPosicion;
          nNume1 = 100 + nNume1;
          aAlfa1 = #silcon03#4 % nNume1;
          nNume2 = nPosicion + 9;
          nNume2 = (nNume2 * 100) + 99;
          aAlfa2 = #silcon03#4 % nNume2;
          #silcon03#4 = aAlfa1 + #silcon06#5 + aAlfa2;
          |GRABA 020#silcon03.a;
     |FINSI;
|FPRC;
