|FICHEROS;
    silcon10 #0;     || emision TC2
    labempre #1;     || empresas
    labempax #2;     || aux. empresas
    nomconst #3;     || constantes
    nomtepig #4;     || aux. epigrafes
    labtraba #5;     || trabajadores
    tsilcon1 #6;     || calculos cabs. (nomcalca)
    nomtrtc2 #7;     || campos de impresion
    nombonif #8;     || bonificaciones
    nomepigr #9;     || epigrafes
    labcentr #10;    || centros de trabajo
    nomepitr #11;    || epigrafes/trabajadores
    nomnotay #12;    || centros notarias/ayuntamientos
    nomcenes #13;    || centros especiales 18/93
    nomcones #14;    || constante especial 18/93
    nomtstc2 #15;    || tmp. tc1 sin tc2
    nomconca #16;    || convenios cabs.
    nomcontr #36;    || control aplicacion

    labemphi #52;    || aux.empresas hist. (para TC2)
    nomwepig #53;    || aux.epigrafes hist. (para TC2)

    nomequiv #101;   || tabla equivalencias contratos nuevos
    nomtraca #105;   || trabajadores cabs.
    nomatcon #106;   || Hco. Constantes
    nomcotmp #111;   || tmp para contador de trabajadores
    nomhicca #200;   || historico cabs. (acumulados dias enfermedad)
    nomcalac #201;   || atrasos cabs. (maternidad, acumulado meses)

    nomcalca;
    nomcalli;
    nomhicli;
    nomtepcd;       || AUXILIAR grabacion cuotas
    nomwepcd;       || AUXILIAR grabacion cuotas Historico
    nomcalal;
     nombotra;
     nomboni3;

     nomssfan;
|FIN;

|VARIABLES;
    menos = 0;
    runnom = "nomyytc2";
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    aAbreviado = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    sgdonum = 0;
    haentrat = 0;
    antcentr = 0;
    antbonif = 0;
    t_aux1 = 0;
    t_aux2 = 0;
    t_aux3 = 0;
    t_aux7b = 0;
    t_aux7c = 0;
    p_cont = 0;
    pp14 = 0;
    pp36 = 0;
    pp37 = 0;
    n85Mat = 0;
    n85 = 0;
    n85Des = 0;
    n85DesMat = 0;
    n64 = 0;
    n65 = 0;

    numalta1 = 0;
    numalta2 = 0;
    numbaja1 = 0;
    numbaja2 = 0;
    dianume1 = 0;
    dianume2 = 0;
    sanos = 0;
    tc21 = 0;
    puntero = 0;
    punt = 0;
    ya = 0;
    FEstado = 0;
    por_ilt = 0;
    por_ims = 0;
    postal1 = "";   || Codigo postal1 alfa
    postal2 = "";   || Codigo postal2 alfa
    domi    = "";   || Variable para quitar espacios al domicilio
    afili   = "";   || Variable para quitar espacios al nro. de afiliacion
    sgdoalf = "";   || Variable para quitar espacios al nro. de afiliacion
    fecsys = @;
    p_mes = "";

    bonifi = 0;
    reducc = 0;
    subven = 0;
    sub85pre = 0;
    sub85dis = 0;
    nCuota = 0;
    nSubve = 0;
    aTipoIPF = "";

    pp15 = "";
    pp16 = "";           || de trabajo
    pp17 = "";
    pp18 = "";

    bot1 = "  ";         || topes para el DEFBUCLE
    top1 = "zz";         || del fichero temporal
    bot2 = "         ";
    top2 = "zzzzzzzzz";
    bot3 = "           ";
    top3 = "zzzzzzzzzzz";

    diaalfa1 = "";
    diaalfa2 = "";
    alfalta1 = "";        || variables de trabajo para calcular mes alta/baja
    alfbaja1 = "";
    alfalta2 = "";
    alfbaja2 = "";

    &swbonif = 0;        || variables de condiciones para la impresion
    &swenfer = 0;
    &swepigr = 0;
    &swdetal = 0;

    &t_epigr = 0;        || codigo epigrafe total
    &t_epig0 = 0;        || acumula total epigrafe accidente (informe)
     t_epig1 = 0;        || acumula total epigrafe accidente
     t_epig2 = 0;        || nro. de trabajadores por epigrafe
    &t_epig3 = "";       || literal en total epigrafe
     t_epig4 = 0;        || contador de epigrafes diferentes por empresa
     t_epig5 = 0;        || acumula bases epigrafe global
     t_epig6 = 0;        || acumula importe ILT epigrafe global
     t_epig7 = 0;        || acumula importe IMS epigrafe global
     t_epig8 = 0;        || acumula nro. trabajadores epigrafe global
     t_epig9 = 0;        || cuota ILT epig.
     t_epiga = 0;        || cuota IMS epig.
     t_epigb = 0;        || cuota ILT (puente)
     t_epigc = 0;        || cuota IMS (puente)
     t_epigd = 0;        || acumula total epigrafe en maternidad (Cot. Emp.)
     t_epige = 0;        || acumula base AT/EP bonificada por RDL 16/2001 > 65
     t_epigf = 0;        || acumula total base Exp.Reg.Empleo
     t_cuotp = 0;        || cuota patronal desempleo
     t_cuoto = 0;        || cuota obrera desempleo
     t_cuotm = 0;        || cuota C.C. maternidad parte patronal
     t_cuotm2 = 0;       || cuota C.C. maternidad parte obrera
     t_cuotx = 0;        || cuota C.C. Exp.Reg.Empleo
      t_cuot_ere_ilt = 0;  || acumulador cuota IT en ere
      t_cuot_ere_ims = 0;  || acumulador cuota IMS en ere
     por_mat = 0;        || % C.C. maternidad
     por_mat_ref = 0;    || apoyo para guardar % C.C. maternidad
     t_puotp = 0;        || puente cuota patronal desempleo
     t_puoto = 0;        || puente cuota obrera desempleo
     t_puotm = 0;        || puente cuota C.C. maternidad parte patronal
     t_puotm2= 0;        || puente cuota C.C. maternidad parte obrera
     t_puotx = 0;        || puente cuota C.C. Exp.Reg.Empleo
      t_puot_ere_ilt = 0;  || acumulador cuota IT en ere
      t_puot_ere_ims = 0;  || acumulador cuota IMS en ere
     t_cuetp = 0;        || cuota patronal desempleo enf.
     t_cueto = 0;        || cuota obrera desempleo enf.

     t_enfe0 = 0;        || epigrafe enfermedad
     t_enfe1 = 0;        || total bases enfermedad
     t_enfe2 = 0;        || total trabajadores enfermos
     t_enfe3 = 0;        || cuotas ILT epig. enf.
     t_enfe4 = 0;        || cuotas IMS epig. enf.

     t_traba = 0;        || total trabajadores (empresas)
     t_trcen = 0;        || total trabajadores (centros)

     t_trab1 = 0;        || total trabajadores mes anterior (empresas)
     t_altas = 0;        || total altas (empresas)
     t_bajas = 0;        || total bajas (empresas)
     t_trab2 = 0;        || total trabajadores que quedan (empresas)

     t_trce1 = 0;        || total trabajadores mes anterior (centros)
     t_altce = 0;        || total altas (centros)
     t_bajce = 0;        || total bajas (centros)
     t_trce2 = 0;        || total trabajadores que quedan (centros)

    &t_trpo1 = 0;        || total trabajadores mes anterior (centros)
    &t_altpo = 0;        || total altas (centros)
    &t_bajpo = 0;        || total bajas (centros)
    &t_trpo2 = 0;        || total trabajadores que quedan (centros)

    &t_06 = 0;           || totales pie TC2
    &t_07 = 0;
    &t_08 = 0;
    &t_09 = 0;
    &t_10 = 0;
    &t_11 = 0;
    &t_12 = 0;
    &t_14 = 0;

    &desboni = "";       || descripcion de bonificacion
    &antepigr = 0;       || total epigrafe anterior

    &adjun_0 = "";       || variables para impreso 'SEGUN RELACION ADJUNTA'
    &adjun_1 = "";
    &adjun_2 = "";
    &adjun_3 = "";
    &adjun_4 = "";
    &adjun_5 = "";
    &adjun_6 = "";
    &adjun_7 = "";
    &adjun_8 = "";
    &adjun_9 = "";
    &adjun_A = "";
    &adjun_B = "";

    &antempre = 0;
    &antnombr = "";
    &antdirec = "";
    &antcodig = "";
    &antlocal = "";
    &antmutua = "";
    &antmutco = 0;
    &antcif   = "";
    &antcuent = "";

    {99}busca = 0;
    epig_ilt = 0;
    epig_ims = 0;
    guarda = 0;
    bisiesto = 0;
    notaria = 0;
    pregunta = 0;
    tip = 0;
    siono_cen = "";
    mas = 0;
    d_con = 0;
    h_con = 0;
    sw_mater = 0;
    m_dias = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    fech5 = @;
    fech6 = @;

    sw_reductor = 0;
    fecalf = "";
    dia = 0;
    mes = 0;
    any = 0;
    diaalt = 0;
    mesalt = 0;
    anyalt = 0;
    totalt = 0;
    diaven = 0;
    mesven = 0;
    anyven = 0;
    totven = 0;
    totact = 0;
    dboni_1 = 0;
    dtipo = 0;
    htipo = 0;
    desem = 0;
    dia_2 = 0;
    dia_3 = 0;
    dia_4 = 0;
    elsw4 = 0;
    apell1 = "";
    apell2 = "";
    nombre = "";
    dmate = 0;
    para1 = 0;
    para2 = 0;
    sitesp1 = "";
    sitesp2 = "";
    sitesp3 = "";
    sitesp4 = "";
    sitesp5 = "";
    sitesp6 = "";
    sitesp9 = "";

    &s_emp = 0;
    &s_any = 0;
    &s_anyl = 0;
    &s_mes = 0;
    &s_has = 0;
    &s_tip = "";
    &s_tipd = "";
    &s_cen = "";
    &s_pas = 0;
    &s_nom = "";
    &s_ori = "";
    &s_tat = 0;
    sw_red = 0;
    sw_segun = 0;

    &temp1 = "";
    &temp2 = "";
    &temp3 = "";
    &temp4 = "";
    &temp5 = "";
    &temp6 = "";
    nConstante = 0;
    &esAtrasos = 0;

    &enDesCen = 0;
    &enHasCen = 0;
    f_mes = "";
    anyonum = 0;
    m_des = 0;
    m_has = 0;
    m_fec = "";
    m_top = "";
    nTotEnf = 0;
    nTotAcc = 0;
    nTotMat = 0;
    nTotILT = 0;
    aTipILT = "";
    &any_hist = 0;
    &aParam = "";
    sw_abierto = 0;
    topemes = 0;
    cuenta = 0;
    aContrato = "";
    nTrab = 0;
    bot_cen = 0;
    top_cen = 0;
    nTipConta = 0;
    nCenConta = 0;
    aNafConta = "";
    nMesAtraso = 0;
    nEl61 = 0;
    nEl62 = 0;
    nEl25 = 0;
    nEl27 = 0;
    &enAny = 0;
    i = 0;
    &EURODB = 0;
    nChequea = 0;
    &eaTipoLi = "";
    swBorra = 0;
    nEl27_65anyos = 0;
    desde_mes = 0;
    hasta_mes = 0;

     nDias = 0;
     nDiasVac = 0;
     nDiasDisp = 0;
     aAlfa  = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     nNume1 = 0;
     nNume2 = 0;
     fFecha = @;
     fFechaAlta = @;
     fFechaRef = @;
     fFech1 = @;
     fFech2 = @;
     nBaseCC_Per2 = 0;
     nBaseCP_Per2 = 0;
     nBaseB1_Per2 = 0;
     nBaseB2_Per2 = 0;
     nBaseB3_Per2 = 0;
     nBaseB4_Per2 = 0;
     nBaseB5_Per2 = 0;
     nCampo = 0;
     &aTrabFiniq = "";
     swNoSigas = 0;
     &swSegundoLote = 0;
     &swCalDos = 0;
     nBaseTra = 0;
     nTip = 0;
     nBaseRegula = 0;

     nBaseA = 0;     || base epigrafe alta
     nCuotaA_ilt = 0;    || cuota epigrafe alta
     nCuotaA_ims = 0;    || cuota epigrafe alta
     nBaseIT = 0;     || base epigrafe alta
     nCuotaIT_ilt = 0;    || cuota epigrafe alta
     nCuotaIT_ims = 0;    || cuota epigrafe alta
     epig_ilt_A = 0;     || % epigrafe ILT ALTA
     epig_ims_A = 0;     || % epigrafe IMS ALTA
     epig_ilt_IT = 0;     || % epigrafe ILT IT (126)
     epig_ims_IT = 0;     || % epigrafe IMS IT (126)

     &nAny = 0;
     &nMes = 0;
     &nCodigoCons = 0;
     &swConsModif = 0;
     &swCambioDes = 0;
     &swCambioFOG = 0;
     &nCodigoBon = 0;
     &nEpigConv = 0;
     &aTempEpig = "";
     &swFiniqRaro2 = 0;
     nDias_nat_alta = 0;
     swSigue = 0;
     nColectivo = 0;
     nBonif = 0;
     nNume = 0;
     nParche_Feb = 0;
     &s_num = 0;
     nCuotaEmp = 0;
     nCuotaTra = 0;
     nBase = 0;
     swAgosto2012 = 0;
|FIN;
____________________________________/ TRANSFORMACION CONTRATOS
|PROCESO CodigosNuevos;
     |QBF aContrato;
     aContrato = ("000" + aContrato) % -103;
     |ABRE #nomequiv;
     #nomequiv#0 = aContrato;
     |LEE 000#nomequiv.=;
     |SI FSalida = 0;
          |SI #labtraba#42 = "X";|O #labtraba#42 = "T";|O #labtraba#42 = "P";
               aContrato = #nomequiv#2;      || tiempo parcial
          |SINO;
               aContrato = #nomequiv#1;      || tiempo completo
          |FINSI;
     |FINSI;
     |CIERRA #nomequiv;
|FPRC;
____________________________________/ RUTINAS DE CARGA DE TEMPORAL
|PROCESO abreviado;
    #2#22 = #15#5;              || con TC2 S/N
|SI #2#22 = "N";
    |PARA para1 = 23; |SI para1 [ 45; |HACIENDO para1 = para1 + 1;
            para2 = para1 - 17;
            #2para1 = #15para2;
    |SIGUE;
    |PARA para1 = 52; |SI para1 [ 58; |HACIENDO para1 = para1 + 1;
            para2 = para1 - 23;
            #2para1 = #15para2;
    |SIGUE;
|SINO;
    |PDEFECTO #2, 23, 46;
|FINSI;
|FPRC;

|PROCESO carga_sit;
|SI sitesp1 = "";
        sitesp1 = sitesp9;
|SINO;
    |SI sitesp2 = "";
            sitesp2 = sitesp9;
    |SINO;
        |SI sitesp3 = "";
                sitesp3 = sitesp9;
        |SINO;
            |SI sitesp4 = "";
                    sitesp4 = sitesp9;
            |SINO;
                |SI sitesp5 = "";
                        sitesp5 = sitesp9;
                |SINO;
                    |SI sitesp6 = "";
                            sitesp6 = sitesp9;
                    |SINO;
                        |MENAV "    Exceso de situaciones especiales ...";
                    |FINSI;
                |FINSI;
            |FINSI;
        |FINSI;
    |FINSI;
|FINSI;
    sitesp9 = "";
|FPRC;

|PROCESO situaciones;
    sitesp1 = "";
    sitesp2 = "";
    sitesp3 = "";
    sitesp4 = "";
    sitesp5 = "";
    sitesp6 = "";
|SI #6#33 > 0;|Y #6#33 < 1;
        sitesp9 = "1";   || huelga parcial
    |HAZ carga_sit;
|FINSI;
|SI #5#237 = "S";
        sitesp9 = "2";   || pluriempleo
    |HAZ carga_sit;
|FINSI;
|SI #15#2 ] 10;
        sitesp9 = "7";   || exp.reg.empleo total
    |HAZ carga_sit;
|FINSI;
/*
|SI #7#21 ] 8;|Y #7#21 [ 11;|Y #5#42 ! "D";|Y #5#42 ! "T";
        sitesp9 = "7";   || salario mensual
    |HAZ carga_sit;
|FINSI;
*/
     || situacion 3 -> reduccion jornada          (NO SE CONTEMPLAN!)
     || situacion 4 -> alta sin retribucion
     || situacion 5 -> exp.reg.empleo parcial
     || situacion 6 -> deduccion diferida de IT
|FPRC;

|PROCESO sep_nombre;
    alfa1 = #5#2;   |QBF alfa1;
    alfa2 = alfa1 % 0;   para2 = alfa2;
    elsw4 = 0;
    apell1 = "";
    apell2 = "";
    nombre = "";
|PARA para1 = 1; |SI para1 [ para2; |HACIENDO para1 = para1 + 1;
        nume2 = (para1 * 100) + 1;
        alfa3 = alfa1 % nume2;
    |SI alfa3 = " ";|O alfa3 = ",";
        |SI apell1 ! "";
                elsw4 = elsw4 + 1;
        |FINSI;
        |SI elsw4 ] 2;|Y nombre ! "";
                nombre = nombre + alfa3;
        |FINSI;
    |SINO;
        |SI elsw4 = 0;  apell1 = apell1 + alfa3; |FINSI;
        |SI elsw4 = 1;  apell2 = apell2 + alfa3; |FINSI;
        |SI elsw4 ] 2;  nombre = nombre + alfa3; |FINSI;
    |FINSI;
|SIGUE;
    aAbreviado = (apell1 % 102) + (apell2 % 102) + (nombre % 101);
    aAbreviado = aAbreviado > aAbreviado;

    alfa1 = #5#7 % 101;                 || Tipo de Identificacion Fiscal
    aTipoIPF = "1"
    |SI alfa1 ] "A";|Y alfa1 [ "z";
        |SI alfa1 = "X"; |O alfa1 = "Y"; |O alfa1 = "Z";
            aTipoIPF = "6";                  || tipo identif. (EXTRANJERO)
        |SINO;
            aTipoIPF = "2";                  || tipo identif. (PASAPORTE)
        |FINSI;
    |FINSI;

|FPRC;

|PROCESO bonif_formacion;
     |ABRE 000#8;
     #8#0 = #6#12;
     |LEE 020#8=;
     |SI FSalida = 0;
          nMes = #0#2;
          nAny = #0#3;
          nCodigoBon = #8#0;
          |HAZ VerifBonif;

          bonifi = 0;
          reducc = 0;
          subven = 0;
          sub85pre = 0;
          sub85dis = 0;
          nCuota = #6#63;
          nSubve = #6#64;
          |SI #8#10 = 1;  reducc = nCuota;    |FINSI;
          |SI #8#10 = 2;  bonifi = nCuota;    |FINSI;
          |SI #8#10 = 3;  reducc = nCuota;    |FINSI;
          |SI #8#10 = 4;  reducc = nCuota;    |FINSI;
          |SI #8#10 = 5;  bonifi = nCuota;    |FINSI;
          |SI #6#9 = 85; |O #6#9 = 97; |O #6#9 = 421; || formacion teorica
               |SI #8#12 > 5;  || precio hora 8 euros pres., 5 dist
                    sub85pre = nSubve;
               |SINO;
                    sub85dis = nSubve;
               |FINSI;
          |SINO;
               subven = nSubve;
          |FINSI;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO tc1solo;
|DDEFECTO #15;
    #15#0 = #7#0;        || empresa
|SI #1#45 = "S";    #15#1 = #7#14; |FINSI;   || centro (separados)
|SI #1#45 = "N";    #15#1 = 99;    |FINSI;   || centro (juntos)
    #15#2 = #7#48;       || tipo
|SI #6#9 = 87; |O #6#9 = 97; |O #6#9 = 85; |O #6#9 = 421; |O #6#9 = 422;
     #15#2 = #15#2 + 8;
|FINSI;
|SI #6#9 = 64; |O #6#9 = 65;                 #15#2 = #15#2 + 9;  |FINSI;
    #15#3 = #0#3 $ 100;  || a¤o
    #15#4 = #0#2;        || mes
|LEE 101#15=;
|SI FSalida = 0;
        #15#5 = "S";     || con TC2 SI
    |GRABA 020#15a;
|SINO;
    ||SI #1#45 = "S";|Y #1#46 = "N";
    ||        #15#5 = "S";      || con TC2 SI: TC2 centros SI,TC1 centros NO
    ||SINO;
        |SI #1#49 = "N";
                #15#5 = "S";  || con TC2 SI: abreviado NO
        |SINO;
            |HAZ sep_nombre;
            |HAZ situaciones;
            |HAZ bonif_formacion;
                #15#5 = "N";       || con TC2 NO (la primera vez)
                #15#6 = #5#75;     || NAFSS
                #15#7 = #5#7;      || NIF
                #15#8 = #7#20;     || dias alta
            |SI #5#42 = "X";|O #5#42 = "T";|O #5#42 = "I";|O #5#42 = "P";
                    #15#8 = #7#24; || horas alta para TP!!
            |FINSI;
                #15#9 = #7#21;     || grupo cotizacion
                aContrato = #7#22;
                |HAZ CodigosNuevos;
                #15#10 = aContrato;|| tipo contrato
                #15#11 = #7#24;    || horas contrato
                #15#12 = #7#26;    || epigrafe
                #15#13 = #7#33 - dmate; || dias IT (sin maternidad)
                #15#14 = dmate;         || dias maternidad
                #15#15 = #7#36;    || epigrafe IT
                #15#16 = #7#37;    || base IT
                #15#17 = #5#40;    || fecha alta bonificacion
                #15#18 = sitesp1;  || situacion especial 1
                #15#19 = sitesp2;  || situacion especial 2
                #15#20 = sitesp3;  || situacion especial 3
                #15#21 = sitesp4;  || situacion especial 4
                #15#22 = sitesp5;  || situacion especial 5
                #15#23 = sitesp6;  || situacion especial 6
                #15#24 = "";       || categoria profesional (FUTURO USO)
                #15#25 = 0;        || dias penosos (FUTURO USO)
                #15#26 = apell1;   || apellido 1
                #15#27 = apell2;   || apellido 2
                #15#28 = aAbreviado;   || nombre Abreviado
                #15#29 = (sub85pre / #8#12) ! 0;  || horas formacion presencial
                #15#30 = sub85pre;                || bonif formacion presencial
                #15#31 = (sub85dis / #8#12) ! 0;  || horas formacion a distancia
                #15#32 = sub85dis;                || bonif formacion a distancia
                #15#33 = (subven / #8#12) ! 0;    || horas complementarias
                #15#34 = subven;                  || bonif horas complementarias
                #15#35 = aTipoIPF;                || Tipo de Identificacion
        |FINSI;
    ||FINSI;
    |GRABA 020#15n;
|FINSI;
|LIBERA #15;
|FPRC;

|PROCESO expediente;
     |SI s_ori = "A"; |O s_ori = "T";
          |HAZ RegulaAtrasos;
          #7#67 = nBaseRegula * #6desem;
          #7#68 = nBaseRegula * #6desem;
          #7#69 = #6desem;
     |SINO;
          nume1 = #6desem;
          |HAZ modulo2;
          #7#67 = nume1 * #5#242;     || base contin. comunes
          #7#68 = #7#67;                || base contin. profes.
          #7#69 = nume1;              || dias en Exp.Reg.Empleo
     |FINSI;
|FPRC;

|PROCESO LeeConvenio;
     |DDEFECTO #16;
     #16#0 = #5#87;
     |LEE 000#16=;
     |SI FSalida ! 0;
          alfa1 = "    Trabajador [" + #5#0 + "." + #5#1 + "] con convenio [" + #16#0 + "] inaccesible ...";
     |SINO;
          |SI #16#142 = "       ";
               alfa1 = "    Convenio [" + #16#0 + "] sin codigo asignado ...";
               ||MENAV alfa1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tipo_T_meses_10;
     |SI #nomhicca#65 = 0;    |ACABA;   |FINSI;
     nume1 = #nomhicca#65;
     |HAZ liquidados;
     |HAZ modulo2_T;
     nEl61 = nEl61 + (#nomhicca#35 * nume1);
     nEl62 = nEl62 + (#nomhicca#36 * nume1);
     nEl25 = nEl25 + (#nomhicca#35 * nume1);
     nEl27 = nEl27 + (#nomhicca#36 * nume1);
|FPRC;

|PROCESO tipo_T_meses_1;
     |SI s_pas [ 3; |HAZ tipo_T_meses_10;    |FINSI;
|FPRC;

|DEFBUCLE tipo_T_meses;
 #nomhicca#1;
 ;
 #6#0, #6#1, any_hist, s_mes, s_tat;
 #6#0, #6#1, any_hist, s_has, s_tat;
 ;
 NULL, tipo_T_meses_1;
|FIN;

|PROCESO tipo_A_meses_10;
     |SI #nomcalac#65 = 0;    |ACABA;   |FINSI;

     nume1 = #nomcalac#65;
     |HAZ liquidados;
     |HAZ modulo2_A;
     nEl61 = nEl61 + (#nomcalac#35 * nume1);
     nEl62 = nEl62 + (#nomcalac#36 * nume1);
     nEl25 = nEl25 + (#nomcalac#35 * nume1);
     nEl27 = nEl27 + (#nomcalac#36 * nume1);
|FPRC;

|PROCESO tipo_A_meses_1;
     |SI s_pas [ 3; |HAZ tipo_A_meses_10;    |FINSI;
|FPRC;

|DEFBUCLE tipo_A_meses;
 #nomcalac#1;
 ;
 #6#0, #6#1, s_mes, 5;
 #6#0, #6#1, s_has, 5;
 ;
 NULL, tipo_A_meses_1;
|FIN;

|PROCESO ParaAtrasos;
     |SI s_ori = "A";    |BUCLE tipo_A_meses;     |FINSI;
     |SI s_ori = "T";    |BUCLE tipo_T_meses;     |FINSI;
|FPRC;

|PROCESO AvisoFiniq;
     swNoSigas = 0;
     aAlfa1 = #labtraba#0; aAlfa1 = "00000" + aAlfa1; aAlfa1 = aAlfa1 % -105;
     aAlfa2 = #labtraba#1; aAlfa2 = "00000" + aAlfa2; aAlfa2 = aAlfa2 % -105;
     aAlfa = aAlfa1 + "." + aAlfa2;
     ||SI aAlfa = aTrabFiniq;  || es que por aqui paso tres veces
     |SI s_pas ! 1;
          || swNoSigas = 1;
          |ACABA;             || por el s_pas, para imprimir solo
     |FINSI;                  || un aviso por pantalla
     |PUSHV 10161961;
                ||   2         3         4         5         6
                || 8901234567890123456789012345678901234567890
     |CUADRO 10161961;
     |PINTA 1118, "                                          ";
     |ATRI R;
     |PINTA 1136, "ATENCION";
     |ATRI I;
     |PINTA 1218, "El finiquito correspondiente al trabajador";
     |PINTA 1318, "                                          ";
     |ATRI R;
     |PINTA 1334, aAlfa;
     |ATRI I;
     |PINTA 1418, "genera una liquidacion de Seguros Sociales";
     |PINTA 1518, "en el mes de Enero. Es necesario completar";
     |PINTA 1618, "los Seguros Sociales  del mes de Diciembre";
     |PINTA 1718, "emitiendo el  TC1  de finiquitos  de enero";
     |PINTA 1818, "                 (tipo F)                 ";
     |ATRI 0;
     |AVISO;
     |PAUSA;
     |POPV;
     aTrabFiniq = aAlfa;
|FPRC;

|PROCESO Dias_nat_alta;
     nDias_nat_alta = 0;

     alfa1 = "01";
     alfa2 = #0#2; alfa2 = "00" + alfa2; alfa2 = alfa2 % -102;
     alfa3 = #0#3;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
     fech1 = alfa4;      || PRIMER DIA DEL MES

     alfa1 = topemes; alfa1 = "00" + alfa1; alfa1 = alfa1 % -102;
     alfa2 = #0#2; alfa2 = "00" + alfa2; alfa2 = alfa2 % -102;
     alfa3 = #0#3;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
     fech2 = alfa4;      || ULTIMO DIA DEL MES

     alfa1 = #6#4;
     fech3 = alfa1;      || DIA ALTA TRABAJADOR

     alfa1 = #6#5;
     fech4 = alfa1;      || DIA BAJA TRABAJADOR

     |SI fech3 ] fech1;
          fech5 = fech3;
     |SINO;
          fech5 = fech1;
     |FINSI;

     |SI fech4 [ fech2;
          fech6 = fech4;
     |SINO;
          fech6 = fech2;
     |FINSI;

     nume1 = fech5;
     nume2 = fech6;

     nDias_nat_alta = nume2 - nume1 + 1;
|FPRC;

|PROCESO topemes;     || halla el ultimo dia del mes
     nume2 = 0;
     nume1 = any_hist $ 4;    || a¤o historico
     |SI nume1 = 0;|Y #36#9 = "S";
          nume2 = 1;
     |FINSI;
     topemes = 31;
     |SI nMes = 2;
          topemes = 28 + nume2;
     |FINSI;
     |SI nMes = 4; |O nMes = 6; |O nMes = 9; |O nMes = 11;
          topemes = 30;
     |FINSI;
|FPRC;

|PROCESO finiquitoH;
     |ABRE #nomhicli;
     #nomhicli#0 = #6#0;      || empresa
     #nomhicli#1 = #6#1;      || trabajador
     #nomhicli#12 = any_hist;      || a¤o
     #nomhicli#2 = #6#2;      || mes
     #nomhicli#3 = #6#3;      || tipo
     #nomhicli#4 = 125;       || concepto
     |LEE 000#nomhicli.=;
     |SI FSalida = 0;
          |SI #nomhicli#11 > 0; |Y #nomhicli#11 < 1;
               nDiasVac = 1;
          |SINO;
               nDiasVac = (#nomhicli#11 + 0.05) ! 0;
          |FINSI;
     |FINSI;
     nMes = 12;
     /*
     |SI #labtraba#42 = "D"; |O #labtraba#42 = "T";
          topemes = 31;        || cotizacion diaria
     |SINO;
          topemes = 30;        || cotizacion mensual
     |FINSI;
     */
     |HAZ topemes;

     || TENGO EN CUENTA SI ES ALTA ESTE MES, QUE CUENTE A
     || PARTIR DEL DIA DE ALTA:

     aAlfa1 = #6#2;   aAlfa1 = "00" + aAlfa1; aAlfa1 = aAlfa1 % -102;
     aAlfa2 = #0#3;
     aAlfa1 = "01" + "." + aAlfa1 + "." + aAlfa2;
     fFecha = aAlfa1;
     fFechaAlta = #labtraba#36;
     |SI fFechaAlta > fFecha;
          aAlfa3 = #labtraba#36 % 102;
          nDias = aAlfa3;
          nDias = nDias - 1;
     |SINO;
          nDias = 0;
     |FINSI;

|| en los irregulares por dias 'topemes' no son los dias a cotizar,
||/por eso busco la fecha de baja y la resto al utlimo dia del mes,
||/asi obtenemos los disponibles
|| esto seria valido para todos, pero de momento dejamos solo los "I"
|| (PRIEGO-AGO.2003)

     |SI #labtraba#42 ! "I"; |Y #labtraba#42 ! "P";
          |HAZ Dias_nat_alta;
          nDiasDisp = topemes - nDias - nDias_nat_alta; || dias usados
     |SINO;
          aAlfa1 = topemes;    aAlfa1 = ("00" + aAlfa1) % -102;
          aAlfa2 = #0#1;       aAlfa2 = ("00" + aAlfa2) % -102;
          aAlfa1 = aAlfa1 + "." + aAlfa2 + "." + #0#0;
          fFech1 = aAlfa1;     nNume1 = fFech1;    || ultimo dia mes
          fFech2 = #6#5;      nNume2 = fFech2;    || fecha baja
          nDiasDisp = (nNume1 - nNume2) - nDias - (#6#8 ! 0) - #6#31 - #6#32 - #6#65 - #6#78; || dias usados
     |FINSI;

     |SI nDiasDisp < nDiasVac;
          || MOVIDA GORDA

          |SI nDiasDisp = 0;       || Diciembre, Finiquito y ningun dia dispo-
               swSegundoLote = 1;  || nible por ser baja el 31. Con esto obligo a
          |SINO;                   || hacer el segundo lote
               swSegundoLote = 0;
          |FINSI;

          |HAZ AvisoFiniq;
          ||SI swNoSigas = 1
          |SI s_pas ! 1;
               |ACABA;
          |FINSI;

          || cambio la base comunes y profesionales
          nBaseCC_Per2 = ((#6#39 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;
          nBaseCP_Per2 = ((#6#40 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;
          nBaseB1_Per2 = ((#6#63 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;
          nBaseB2_Per2 = ((#6#64 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;
          nBaseB3_Per2 = ((#6#81 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;
          nBaseB4_Per2 = ((#6#92 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;
          nBaseB5_Per2 = ((#6#94 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;

          #6#63 = #6#63 - nBaseB1_Per2;
          #6#64 = #6#64 - nBaseB2_Per2;
          #6#81 = #6#81 - nBaseB3_Per2;
          #6#92 = #6#92 - nBaseB4_Per2;
          #6#94 = #6#94 - nBaseB5_Per2;
          #6#43 = #6#43 - nBaseCC_Per2;
          #6#44 = #6#44 - nBaseCP_Per2;
          |GRABA 020#tsilcon1.a;
          #6#39 = #6#39 - nBaseCC_Per2;
          #6#40 = #6#40 - nBaseCP_Per2;

          || grabo nueva ficha en nomhicca (peligro!!!)
          |ABRE #nomhicca;
          #nomhicca#0 = #6#0;      || empresa
          #nomhicca#1 = #6#1;      || trabajador
          #nomhicca#66 = any_hist + 1;         || mes: ENERO
          #nomhicca#2 = 1;         || mes: ENERO
          #nomhicca#3 = 2;         || tipo: 2 (FINIQUITO)
          |LEE 101#nomhicca.=;
          |SI FSalida = 0;
               |BORRA 020#nomhicca.a;
          |FINSI;
          #nomhicca#0 = #6#0;      || empresa
          #nomhicca#1 = #6#1;      || trabajador
          #nomhicca#2 = 1;         || mes: ENERO
          #nomhicca#3 = 2;         || tipo: 2 (FINIQUITO)
          |PARA nCampo = 4; |SI nCampo [ 85; |HACIENDO nCampo = nCampo + 1;
               #nomhicca#nCampo# = #6nCampo;
          |SIGUE;
          || #nomhicca#8 = (nDiasVac - nDiasDisp);
          #nomhicca#8 = 0;         || dias en alta ha de ser cero
          #nomhicca#46 = 0;
          #nomhicca#37 = 0;
          #nomhicca#14 = 0;
          #nomhicca#63 = nBaseB1_Per2;  || cuota bonif 1
          #nomhicca#64 = nBaseB2_Per2;  || subvencion formacion
          #nomhicca#123 = nBaseB3_Per2; || cuota bonif 2
          #nomhicca#130 = nBaseB4_Per2; || cuota bonif 35/2002
          #nomhicca#138 = nBaseB5_Per2; || cuota bonif fom. empleo
          #nomhicca#39 = nBaseCC_Per2;
          #nomhicca#40 = nBaseCP_Per2;
          #nomhicca#43 = nBaseCC_Per2;
          #nomhicca#44 = nBaseCP_Per2;
          #nomhicca#66 = any_hist + 1;         || mes: ENERO

          #nomhicca#27 = "X";
          #nomhicca#28 = "X";
          #nomhicca#29 = "X";
          #nomhicca#30 = "X";

          |GRABA 020#nomhicca.n;
          |CIERRA #nomhicca;

          || grabo nueva ficha en nomhicli (mas peligro!!!)
          #nomhicli#0 = #6#0;      || empresa
          #nomhicli#1 = #6#1;      || trabajador
          #nomhicli#12 = any_hist + 1; || a¤o
          #nomhicli#2 = 1;         || mes: ENERO
          #nomhicli#3 = 2;         || tipo: 2 (FINIQUITO)
          #nomhicli#4 = 125;       || concepto
          |LEE 000#nomhicli.=;
          |SI FSalida = 0;
               |BORRA 020#nomhicli.a;
          |FINSI;
          #nomhicli#0 = #6#0;      || empresa
          #nomhicli#1 = #6#1;      || trabajador
          #nomhicli#12 = any_hist + 1; || a¤o
          #nomhicli#2 = 1;         || mes: ENERO
          #nomhicli#3 = 2;         || tipo: 2 (FINIQUITO)
          #nomhicli#4 = 125;       || concepto
          #nomhicli#8 = "XXXX";    || concepto
          #nomhicli#11 = (nDiasVac - nDiasDisp);  || Dias Vacaciones
          |GRABA 020#nomhicli.n;
     |FINSI;
     |CIERRA #nomhicli;
|FPRC;

|PROCESO finiquitoM;
     |ABRE #nomcalli;
     #nomcalli#0 = #6#0;      || empresa
     #nomcalli#1 = #6#1;      || trabajador
     #nomcalli#2 = #6#2;      || mes
     #nomcalli#3 = #6#3;      || tipo
     #nomcalli#4 = 125;       || concepto
     |LEE 000#nomcalli.=;
     |SI FSalida = 0;
          |SI #nomcalli#11 > 0; |Y #nomcalli#11 < 1;
               nDiasVac = 1;
          |SINO;
               nDiasVac = (#nomcalli#11 + 0.05) ! 0;
          |FINSI;
     |FINSI;
     nMes = 12;
     /*
     |SI #labtraba#42 = "D"; |O #labtraba#42 = "T";
          topemes = 31;        || cotizacion diaria
     |SINO;
          topemes = 30;        || cotizacion mensual
     |FINSI;
     */
     |HAZ topemes;

     ||SI nMesVac = #0#1;
     || TENGO EN CUENTA SI ES ALTA ESTE MES, QUE CUENTE A
     || PARTIR DEL DIA DE ALTA:

     aAlfa1 = #6#2;   aAlfa1 = "00" + aAlfa1; aAlfa1 = aAlfa1 % -102;
     aAlfa2 = #0#3;
     aAlfa1 = "01" + "." + aAlfa1 + "." + aAlfa2;
     fFecha = aAlfa1;
     fFechaAlta = #labtraba#36;
     |SI fFechaAlta > fFecha;
          aAlfa3 = #labtraba#36 % 102;
          nDias = aAlfa3;
          nDias = nDias - 1;
     |SINO;
          nDias = 0;
     |FINSI;

|| en los irregulares por dias 'topemes' no son los dias a cotizar,
||/por eso busco la fecha de baja y la resto al utlimo dia del mes,
||/asi obtenemos los disponibles
|| esto seria valido para todos, pero de momento dejamos solo los "I"
|| (PRIEGO-AGO.2003)

     |SI #labtraba#42 ! "I"; |Y #labtraba#42 ! "P";
          |HAZ Dias_nat_alta;
          nDiasDisp = topemes - nDias - nDias_nat_alta; || dias usados
     |SINO;
          aAlfa1 = topemes;    aAlfa1 = ("00" + aAlfa1) % -102;
          aAlfa2 = #0#1;       aAlfa2 = ("00" + aAlfa2) % -102;
          aAlfa1 = aAlfa1 + "." + aAlfa2 + "." + #0#0;
          fFech1 = aAlfa1;     nNume1 = fFech1;    || ultimo dia mes
          fFech2 = #6#5;      nNume2 = fFech2;    || fecha baja
          nDiasDisp = (nNume1 - nNume2) - nDias - (#6#8 ! 0) - #6#31 - #6#32 - #6#65 - #6#78; || dias usados
     |FINSI;

     |SI nDiasDisp < nDiasVac;
          || MOVIDA GORDA

          |SI nDiasDisp = 0;       || Diciembre, Finiquito y ningun dia dispo-
               swSegundoLote = 1;  || nible por ser baja el 31. Con esto obligo a
          |SINO;                   || hacer el segundo lote
               swSegundoLote = 0;
          |FINSI;

          |HAZ AvisoFiniq;
          ||SI swNoSigas = 1
          |SI s_pas ! 1;
               |ACABA;
          |FINSI;

          || cambio la base comunes y profesionales y bonificaciones

          nBaseCC_Per2 = ((#6#39 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;
          nBaseCP_Per2 = ((#6#40 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;
          nBaseB1_Per2 = ((#6#63 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;
          nBaseB2_Per2 = ((#6#64 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;
          nBaseB3_Per2 = ((#6#81 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;
          nBaseB4_Per2 = ((#6#92 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;
          nBaseB5_Per2 = ((#6#94 * (nDiasVac - nDiasDisp)) / nDiasVac) ! EURODB;

          #6#63 = #6#63 - nBaseB1_Per2;
          #6#64 = #6#64 - nBaseB2_Per2;
          #6#81 = #6#81 - nBaseB3_Per2;
          #6#92 = #6#92 - nBaseB4_Per2;
          #6#94 = #6#94 - nBaseB5_Per2;
          #6#43 = #6#43 - nBaseCC_Per2;
          #6#44 = #6#44 - nBaseCP_Per2;
          |GRABA 020#tsilcon1.a;
          #6#39 = #6#39 - nBaseCC_Per2;
          #6#40 = #6#40 - nBaseCP_Per2;

          || grabo nueva ficha en nomcalca (peligro!!!)
          |ABRE #nomcalca;
          #nomcalca#0 = #6#0;      || empresa
          #nomcalca#1 = #6#1;      || trabajador
          #nomcalca#2 = 1;         || mes: ENERO
          #nomcalca#3 = 2;         || tipo: 2 (FINIQUITO)
          |LEE 101#nomcalca.=;
          |SI FSalida = 0;
               |BORRA 020#nomcalca.a;
          |FINSI;
          #nomcalca#0 = #6#0;      || empresa
          #nomcalca#1 = #6#1;      || trabajador
          #nomcalca#2 = 1;         || mes: ENERO
          #nomcalca#3 = 2;         || tipo: 2 (FINIQUITO)
          |PARA nCampo = 4; |SI nCampo [ 85; |HACIENDO nCampo = nCampo + 1;
               #nomcalca#nCampo# = #6nCampo;
          |SIGUE;
          || #nomcalca#8 = (nDiasVac - nDiasDisp);
          #nomcalca#8 = 0;         || dias en alta ha de ser cero
          #nomcalca#46 = 0;
          #nomcalca#37 = 0;
          #nomcalca#14 = 0;
          #nomcalca#63 = nBaseB1_Per2;
          #nomcalca#64 = nBaseB2_Per2;
          #nomcalca#81 = nBaseB3_Per2;
          #nomcalca#88 = nBaseB4_Per2;
          #nomcalca#96 = nBaseB5_Per2;
          #nomcalca#39 = nBaseCC_Per2;
          #nomcalca#40 = nBaseCP_Per2;
          #nomcalca#43 = nBaseCC_Per2;
          #nomcalca#44 = nBaseCP_Per2;

          #nomcalca#27 = "X";
          #nomcalca#28 = "X";
          #nomcalca#29 = "X";
          #nomcalca#30 = "X";

          |GRABA 020#nomcalca.n;
          |CIERRA #nomcalca;

          || grabo nueva ficha en nomcalli (mas peligro!!!)
          #nomcalli#0 = #6#0;      || empresa
          #nomcalli#1 = #6#1;      || trabajador
          #nomcalli#2 = 1;         || mes: ENERO
          #nomcalli#3 = 2;         || tipo: 2 (FINIQUITO)
          #nomcalli#4 = 125;       || concepto
          |LEE 000#nomcalli.=;
          |SI FSalida = 0;
               |BORRA 020#nomcalli.a;
          |FINSI;
          #nomcalli#0 = #6#0;      || empresa
          #nomcalli#1 = #6#1;      || trabajador
          #nomcalli#2 = 1;         || mes: ENERO
          #nomcalli#3 = 2;         || tipo: 2 (FINIQUITO)
          #nomcalli#4 = 125;       || concepto
          #nomcalli#8 = "XXXX";    || marca para borrar despues
          #nomcalli#11 = (nDiasVac - nDiasDisp);  || Dias Vacaciones
          |GRABA 020#nomcalli.n;
     |FINSI;
     |CIERRA #nomcalli;
|FPRC;

|PROCESO finiquito;
     |SI #6#3 = 2; |Y #6#2 = 12;
          nDiasVac = 0;
          nDiasDisp = 0;
          |SI s_ori = "M";
               |HAZ finiquitoM;
          |FINSI;
          |SI s_ori = "H";
               |HAZ finiquitoH;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO RegulaAtrasos;
     nBaseRegula = 0;
     |SI s_ori = "A";
          |ABRE #nomcalal;
          #nomcalal#0 = #6#0;      || empresa
          #nomcalal#1 = #6#1;      || trabajador
          #nomcalal#2 = #6#2;      || mes
          #nomcalal#3 = 5;         || tipo: 5 (ATRASOS)
          #nomcalal#4 = 990;       || concepto
          |LEE 000#nomcalal.=;
          |SI FSalida = 0;
               nBaseRegula = #nomcalal#10;
          |FINSI;
          |CIERRA #nomcalal;
     |FINSI;
     |SI s_ori = "T";
          |ABRE #nomhicli;
          #nomhicli#0 = #6#0;      || empresa
          #nomhicli#1 = #6#1;      || trabajador
          #nomhicli#2 = #6#2;      || mes
          #nomhicli#3 = s_tat;     || tipo: el del lote (ATRASOS HISTORICO)
          #nomhicli#4 = 990;       || concepto
          #nomhicli#12 = any_hist; || a¤o historico
          |LEE 000#nomhicli.=;
          |SI FSalida = 0;
               nBaseRegula = #nomhicli#10;
          |FINSI;
          |CIERRA #nomhicli;
     |FINSI;
|FPRC;

|PROCESO modulo2_T;
     || este proceso se crea para controlar el tema de la opcion "3" en el
     || control de la aplicacion en el calculo de Dias de IT, esta copiado de
     || el del nomcal_3, adaptado para este silcon10
     || solo si no soy diario, estoy en un mes de 31 dias y tengo parte en mat
     || esta igual en el silcon09 y nomcal_3, si se cambia algo tenerlo en
     || cuenta tambien alli

     desem = 78;
     |SI #nomcontr#17 = 3; |Y #nomhicca#desem# = 0; || en reg. emp. no entres
          |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
               |SI #nomhicca#65 < #nomhicca#8; |Y #nomhicca#8 = 30;
                    |SI #nomhicca#2 ! 4; |Y #nomhicca#2 ! 6; |Y #nomhicca#2 ! 9;
                    |Y #nomhicca#2 ! 11;
                         |SI #nomhicca#2 ! 2;
                             nume1 = nume1 - 1;
                         |SINO;
                              |SI nume1 ! 30;          || FEBRERO, SOLO SI
                                   nume1 = nume1 + 2 - bisiesto;  || NO ESTOY TODO EL MES
                              |FINSI;                  || DE BAJA, si lo estoy
                         |FINSI;        || en el proceso liquidados se transforman
                    |FINSI;             || de 28 a 30, no hace falta
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO modulo2_A;
     || este proceso se crea para controlar el tema de la opcion "3" en el
     || control de la aplicacion en el calculo de Dias de IT, esta copiado de
     || el del nomcal_3, adaptado para este silcon10
     || solo si no soy diario, estoy en un mes de 31 dias y tengo parte en mat
     || esta igual en el silcon09 y nomcal_3, si se cambia algo tenerlo en
     || cuenta tambien alli

     desem = 78;
     |SI #nomcontr#17 = 3; |Y #nomcalac#desem# = 0; || en reg. emp. no entres
          |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
               |SI #nomcalac#65 < #nomcalac#8; |Y #nomcalac#8 = 30;
                    |SI #nomcalac#2 ! 4; |Y #nomcalac#2 ! 6; |Y #nomcalac#2 ! 9;
                    |Y #nomcalac#2 ! 11;
                         |SI #nomcalac#2 ! 2;
                             nume1 = nume1 - 1;
                         |SINO;
                              |SI nume1 ! 30;          || FEBRERO, SOLO SI
                                   nume1 = nume1 + 2 - bisiesto;  || NO ESTOY TODO EL MES
                              |FINSI;                  || DE BAJA, si lo estoy
                         |FINSI;        || en el proceso liquidados se transforman
                    |FINSI;             || de 28 a 30, no hace falta
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO modulo2;
     || este proceso se crea para controlar el tema de la opcion "3" en el
     || control de la aplicacion en el calculo de Dias de IT, esta copiado de
     || el del nomcal_3, adaptado para este silcon10
     || solo si no soy diario, estoy en un mes de 31 dias y tengo parte en mat
     || esta igual en el silcon09 y nomcal_3, si se cambia algo tenerlo en
     || cuenta tambien alli

     desem = 78;
     |SI #nomcontr#17 = 3; |Y #6desem = 0; || en reg. emp. no entres
          swSigue = 1;
     |FINSI;

     nume4 = 30 - #6#33;
     |SI swSigue = 1;
          |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
               swSigue = 0;
               |SI #6#65 [ #6#8; |Y #7#25 > 0;
                    swSigue = 1
               |FINSI;
               |SI #6#8 = nume4; |Y swSigue = 1
                    |SI #6#2 ! 4; |Y #6#2 ! 6; |Y #6#2 ! 9; |Y #6#2 ! 11;
                         |SI #6#2 ! 2;
                              nume1 = nume1 - 1;
                         |SINO;
                              |SI nume1 ! 30;          || FEBRERO, SOLO SI
                                   nume1 = nume1 + 2 - bisiesto;  || NO ESTOY TODO EL MES
                              |FINSI;                  || DE BAJA, si lo estoy
                         |FINSI;        || en el proceso liquidados se transforman
                    |FINSI;             || de 28 a 30, no hace falta
               |FINSI;
          |FINSI;
     |FINSI;

     || en Exp.Reg.Empleo:
     |SI #6desem ! 0;|Y #6#3 = 0;|Y #6#9 ! 87;|Y #6#9 ! 97;
     |Y #6#9 ! 85; |Y #6#9 ! 421;
          |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
               |SI #6#2 ! 4; |Y #6#2 ! 6; |Y #6#2 ! 9; |Y #6#2 ! 11;
                    |SI #6#2 ! 2;
                         |SI #6desem > 30;
                              nume1 = nume1 - 1;
                         |FINSI;
                    |SINO;
                         |SI #6desem = 28;
                              nume1 = nume1 + 2;
                         |FINSI;
                         |SI #6desem = 29;
                              nume1 = nume1 + 1;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO epig_T_meses_10;
     nBaseA = #nomhicca#40 - #nomhicca#62;
     nBaseIT = #nomhicca#62;
     |SI #nomhicca#65 ! 0;
          nume1 = #nomhicca#65;
          |HAZ liquidados;
          |HAZ modulo2;
          nBaseA = nBaseA + (#nomhicca#36 * nume1);
     |FINSI;
     |SI nBaseA < 0;     nBaseA = 0;    |FINSI;

     nCuotaA_ilt = nCuotaA_ilt + ((nBaseA % epig_ilt_A) ! 2);
     nCuotaA_ims = nCuotaA_ims + ((nBaseA % epig_ims_A) ! 2);
     nCuotaIT_ilt = nCuotaIT_ilt + ((nBaseIT % epig_ilt_IT) ! 2)
     nCuotaIT_ims = nCuotaIT_ims + ((nBaseIT % epig_ims_IT) ! 2)
|FPRC;

|PROCESO epig_T_meses_1;
     |SI s_pas [ 3; |HAZ epig_T_meses_10;    |FINSI;
|FPRC;

|DEFBUCLE epig_T_meses;
     #nomhicca#1;
     ;
     #7#0, #7#39, any_hist, s_mes, s_tat;
     #7#0, #7#39, any_hist, s_has, s_tat;
     ;
     NULL, epig_T_meses_1;
|FIN;

|PROCESO epig_A_meses_10;
     nBaseA = #nomcalac#40 - #nomcalac#62;
     nBaseIT = #nomcalac#62;
     |SI #nomcalac#65 ! 0;
          nume1 = #nomcalac#65;
          |HAZ liquidados;
          |HAZ modulo2;
          nBaseA = nBaseA + (#nomcalac#36 * nume1);
     |FINSI;
     |SI nBaseA < 0;     nBaseA = 0;    |FINSI;

     nCuotaA_ilt = nCuotaA_ilt + ((nBaseA % epig_ilt_A) ! 2);
     nCuotaA_ims = nCuotaA_ims + ((nBaseA % epig_ims_A) ! 2);
     nCuotaIT_ilt = nCuotaIT_ilt + ((nBaseIT % epig_ilt_IT) ! 2)
     nCuotaIT_ims = nCuotaIT_ims + ((nBaseIT % epig_ims_IT) ! 2)
|FPRC;

|PROCESO epig_A_meses_1;
     |SI s_pas [ 3; |HAZ epig_A_meses_10;    |FINSI;
|FPRC;

|DEFBUCLE epig_A_meses;
     #nomcalac#1;
     ;
     #7#0, #7#39, s_mes, 5;
     #7#0, #7#39, s_has, 5;
     ;
     NULL, epig_A_meses_1;
|FIN;

|PROCESO EpigAtrasos;
     nBaseA = 0;     || base epigrafe alta
     nCuotaA_ilt = 0;    || cuota epigrafe alta
     nCuotaA_ims = 0;    || cuota epigrafe alta
     nBaseIT = 0;     || base epigrafe alta
     nCuotaIT_ilt = 0;    || cuota epigrafe alta
     nCuotaIT_ims = 0;    || cuota epigrafe alta
     epig_ilt_A = 0;     || % epigrafe ILT ALTA
     epig_ims_A = 0;     || % epigrafe IMS ALTA


     |SI s_ori = "A";|O s_ori = "T";
          |DDEFECTO #9;
          #9#0 = #7#26;
          |LEE 020#9=;                  || lee epigrafe alta
          epig_ilt_A = #9#1;
          epig_ims_A = #9#2;

          #11#0 = #7#0;
          #11#1 = #7#39;
          #11#2 = #7#36;
          |LEE 000#11=;                 || lee epigrafe/trabajador
          |SI FSalida = 0;
               epig_ilt_A = #11#3;
               epig_ims_A = #11#4;
          |FINSI;

          |DDEFECTO #9;
          |SI s_anyl [ 2009;
               |SI s_anyl [ 2006;
                    #9#0 = 126;
               |SINO;
                    #9#0 = 904;
               |FINSI;
          |SINO;
               |HAZ VerifCNAE;
               #9#0 = nEpigConv;                  || Epigrafe
               || migue
          |FINSI;
          |LEE 020#9=;                  || lee epigrafe IT
          epig_ilt_IT = #9#1;
          epig_ims_IT = #9#2;

          |SI s_ori = "A";    |BUCLE epig_A_meses;     |FINSI;
          |SI s_ori = "T";    |BUCLE epig_T_meses;     |FINSI;
     |FINSI;
|FPRC;

|PROCESO Colectivo;
     |ABRE #nombotra;
     |ABRE #nomboni3;
     #nombotra#0 = #labtraba#0;
     #nombotra#1 = #labtraba#1;
     #nombotra#2 = nBonif;
     |LEE 000#nombotra.=;
     |SI FSalida = 0;
          #nomboni3#0 = #nombotra#2;
          |LEE 000#nomboni3.=;
          |SI FSalida = 0;
               nColectivo = #nomboni3#4;
          |FINSI;
     |SINO;
          |SI #6#95 > 0;
               |SI #labtraba#212 = 3; |O #labtraba#212 = 4;
                    nColectivo = 1001;  || colectivo 1001: Textil
               |FINSI;
               |SI #labtraba#212 = 5; |O #labtraba#212 = 6;
                    nColectivo = 0927;  || colectivo 0927: calzado
               |FINSI;
               |SI #labtraba#212 = 13; |O #labtraba#212 = 14;
                    nColectivo = 0727;  || colectivo 0727: Juguete
               |FINSI;
               |SI #labtraba#212 = 15; |O #labtraba#212 = 16;
                    nColectivo = 0827;  || colectivo 0827: mueble
               |FINSI;
          |SINO;
               |SI #6#96 > 0;
                    |SI #labtraba#212 = 3; |O #labtraba#212 = 4;
                         nColectivo = 1062;  || colectivo 1062: Textil
                    |FINSI;
                    |SI #labtraba#212 = 5; |O #labtraba#212 = 6;
                         nColectivo = 0936;  || colectivo 0936: calzado
                    |FINSI;
                    |SI #labtraba#212 = 13; |O #labtraba#212 = 14;
                         nColectivo = 0736;  || colectivo 0736: Juguete
                    |FINSI;
                    |SI #labtraba#212 = 15; |O #labtraba#212 = 16;
                         nColectivo = 0836;  || colectivo 0836: mueble
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #nomboni3;
     |CIERRA #nombotra;
|FPRC;

|PROCESO nombotra;
     nBonif = #nombotra#2;
     |HAZ Colectivo;
     |ERROR10;
|FPRC;

|DEFBUCLE nombotra;
     #nombotra#1;
     ;
     #labtraba#0, #labtraba#1, 001;
     #labtraba#0, #labtraba#1, 999;
     ;
     NULL, nombotra;
|FIN;

|PROCESO LeeBonPFE;
     || migue
     nColectivo = 0;

     |SI #6#94 ! 0;               || fomento empleo 1
          nBonif = #6#114;
          |HAZ Colectivo;
          |SI nColectivo = 16; |ACABA; |FINSI;
          || el colectivo 0016 anula al resto que hubiera
     |FINSI;
     |SI #6#112 ! 0;              || fomento empleo 2
          nBonif = #6#115;
          |HAZ Colectivo;
          |SI nColectivo = 16; |ACABA; |FINSI;
     |FINSI;
     |SI #6#96 ! 0;               || fomento empleo textil 1
          nBonif = #6#116;
          |HAZ Colectivo;
          |SI nColectivo = 16; |ACABA; |FINSI;
     |FINSI;
     |SI #6#113 ! 0;              || fomento empleo textil 2
          nBonif = #6#117;
          |HAZ Colectivo;
          |SI nColectivo = 16; |ACABA; |FINSI;
     |FINSI;
     |SI nColectivo = 0;
          |BUCLE nombotra;
     |FINSI;
|FPRC;

|PROCESO LeeBonif;
     |ABRE #8;
     |DDEFECTO #8
     |SI #7#35 ! 0; |Y #6#63 ! 0;
          #8#0 = #7#35;
          |LEE 000#8=;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO EnfMatMax;
     nNume1 = #6#31 + #6#65;
     |SI nNume1 ] #6#8;            || vale, todo el mes entre enf y mat
          nNume1 = #7#25 + #7#61;  || base enf. + mat. calculada
                                   || el #6#62 es la base IT
          |SI nNume1 > #6#62;      || si la base de IT (va todo enf+mat)
                                   || es MAYOR que la base de comunes + mat
                                   || calculada, es se¤al de que me en nomina
                                   || tuve que topear al maximo, asi que quito
                                   || de la base de la maternidad lo sobrante
               #7#61 = #7#61 - (nNume1 - #6#62);
               #7#62 = #7#62 - (nNume1 - #6#62);  || igual para CP
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Parche_Feb2;
     || lo mismo para la base de IT
     || Y ooootro parchecito (12.03.2010, 00601.00478)
     || Resulta que en febrero, si cotizas por menos de la base minima y eres
     || diario, al topear la base de profesionales, la variable nPropAlta
     || en caso de IT todo el mes queda con un valor que debe quedar a cero
     || eso si tienes bonificaciones

     |SI nParche_Feb ! 0;
          #7#37 = #6#40;
     |FINSI;
|FPRC;

|PROCESO Parche_Feb;
     || Y ooootro parchecito (12.03.2010, 00601.00478)
     || Resulta que en febrero, si cotizas por menos de la base minima y eres
     || diario, al topear la base de profesionales, la variable nPropAlta
     || en caso de IT todo el mes queda con un valor que debe quedar a cero
     || eso si tienes bonificaciones

     |SI #labtraba#42 = "D"; |Y nMes = 2;    || diario, febrero
          |SI #6#39 ! #6#40;                  || base comunes distinta a prof
               |SI #6#39 = #6#62;             || base comunes igual a base IT
                    nNume = #6#31 + #6#32 + #6#65;|| Dias enfer.acci.mater.
                    |SI nNume ] #6#8;             || todo el mes en IT
                         #7#27 = 0;
                         nParche_Feb = #6#40;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO temporal2;
     |DDEFECTO #7;
     #1#0 = #6#0;
     |LEE 020#1=;                                 || empresa
     |SI FSalida = 0;
          |SI #1#45 ! "S";|Y #1#45 ! "N";    || centros s/n
               #1#45 = "N";
          |FINSI;

          #3#0 = #1#32;
          |LEE 020#3=;                             || constante
          |SI FSalida = 0;
               nMes = #0#2;
               nAny = #0#3;
               nCodigoCons = #3#0;
               |HAZ VerifCons;

               #5#0 = #1#0;
               #5#1 = #6#1;
               |LEE 020#5=;                         || trabajador
               |SI FSalida = 0; |Y #5#42 ! "H"; |Y #5#42 ! "A"; |Y #5#42 ! "B";
                 |Y #5#42 ! "E"; |Y #5#42 ! "e";|Y #5#77 ] enDesCen; |Y #5#77 [ enHasCen;
                    #10#0 = #1#0;
                    #10#1 = #5#77;
                    |LEE 020#10=;                    || centro de trabajo
                    |SI FSalida = 0;
                         #7#0 = #1#0;             || codigo empresa
                         #7#1 = #1#2;             || nombre de la empresa
                         |SI #6#9 = 87; |O #6#9 = 97; |O #6#9 = 85; |O #6#9 = 421;
                           |O #6#9 = 64; |O #6#9 = 65; |O #6#9 = 422;
                              |HAZ cen_esp;
                              #7#2 = #13#14;       || clave
                              #7#3 = #13#15;       || entidad
                              domi = #13#3;
                              |QBF domi;               || domicilio 18/93
                              #7#4 = domi+" "+#13#4+" "+#13#5;
                              postal1="00" + #13#7;  postal1=postal1 % -102;
                              postal2="000" + #13#8; postal2=postal2 % -103;
                              #7#5 = postal1 + postal2;
                              #7#6 = #13#6;
                              afili = #13#10;
                         |SINO;
                              |SI #1#45 = "N";         || por centros S/N
                                   #7#2 = #1#19;    || clave entidad
                                   #7#3 = #1#20;    || entidad
                                   domi = #1#3;
                                   |QBF domi;           || domicilio empresa
                                   #7#4 = domi+" "+#1#4+" "+#1#5;
                                   postal1="00" + #1#7;  postal1=postal1 % -102;
                                   postal2="000" + #1#8; postal2=postal2 % -103;
                                   #7#5 = postal1 + postal2;
                                   #7#6 = #1#6;
                                   afili = #1#13;
                              |SINO;
                                   #7#2 = #10#13;        || clave
                                   #7#3 = #10#14;        || entidad
                                   domi = #10#3;
                                   |QBF domi;            || domicilio centro
                                   #7#4 = domi+" "+#10#4+" "+#10#5;
                                   postal1="00" + #10#7;  postal1=postal1 % -102;
                                   postal2="000" + #10#8; postal2=postal2 % -103;
                                   #7#5 = postal1 + postal2;
                                   #7#6 = #10#6;
                                   afili = #10#10;
                              |FINSI;
                         |FINSI;
                         #7#7 = #1#10;                   || C.I.F. empresa
                         |QBF afili;
                         sgdoalf = afili % 0;
                         sgdonum = sgdoalf;
                         sgdonum = sgdonum - 4;
                         sgdonum = sgdonum + 300;        || para coger 2do. digito
                         #7#8 = afili % 102;             || Primer digito S.S.
                         #7#9 = afili % sgdonum;         || Segundo digito S.S.
                         #7#10 = afili % -102;           || Tercer digito S.S.
                         |HAZ mes;                       || Mes literal
                         #7#12 = #0#3;                   || A¤o
                         |SI #6#3 ! 2;
                              |HAZ altabaja;                  || Si es alta/baja/continua/X
                         |FINSI;
                         #7#14 = #5#77;                  || Centro de Trabajo
                         afili = #5#75;
                         |QBF afili;
                         sgdoalf = afili % 0;
                         sgdonum = sgdoalf;
                         sgdonum = sgdonum - 4;
                         sgdonum = sgdonum + 300;        || para coger 2do. digito
                         #7#15 = afili % 102;            || Primer digito S.S.
                         #7#16 = afili % sgdonum;        || Segundo digito S.S.
                         #7#17 = afili % -102;           || Tercer digito S.S.
                         #7#18 = #5#7;                   || DNI/NIF trabajador
                         #7#19 = #5#2;               || Nombre Trabajador
                         #7#20 = #6#8;                   || Dias en Alta
                         /*
                         |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
                              #7#20 = #6#55; || dias en alta para citricos
                         |FINSI;
                         */
                         #7#21 = #5#33;                  || Grupo de Cotizacion
                         #7#22 = #6#9;                   || Tipo de Contrato
                         #7#23 = #6#10;                  || Dias de Contrato
                         #7#24 = #6#11;                  || Horas de Contrato
                         |HAZ finiquito;
                         |SI swCalDos = 1;
                              |SI #6#27 ! "X"; |O #6#28 ! "X"; |O #6#29 ! "X"; |O #6#30 ! "X";
                                   |ACABA;   || si es el lote de finiquitos de Enero
                                             || correspondiente a Diciembre, entran
                                             || solo los que tienen que entrar
                              |FINSI;
                         |FINSI;
                         #7#25 = #6#39;                  || Base Contin. Comunes
                         |SI s_anyl [ 2006
                              #7#26 = #5#32;                  || Epigrafe
                         |SINO;
                              |HAZ VerifCNAE;
                              #7#26 = nEpigConv;                  || Epigrafe
                         |FINSI;
                         #7#27 = #6#40 - #6#62;          || Base Desempleo
                         nParche_Feb = 0;
                         |HAZ Parche_Feb;
                         nEl27_65anyos = #6#40;   || mayores de 65 a¤os NO cotizan
                                                  || nada al desempleo, por lo que
                                                  || me guardo aqui TODA la base
                                                  || para despues bonificarla
                         |HAZ si_mater;
                         sw_reductor = 0;
                         |SI sw_mater = 1; |O #6#110 ! 0;
                              |SI s_ori = "A";|O s_ori = "T";
                                   |SI #7#22 ! 87; |Y #7#22 ! 97; |Y #7#22 ! 85;
                                   |Y #7#22 ! 421; |Y #7#22 ! 422;
                                   || en principio en atrasos no contemplo
                                   || maternidad en ctos. de formacion
                                        nEl61 = 0;
                                        nEl62 = 0;
                                        nEl25 = 0;
                                        nEl27 = 0;
                                        |HAZ ParaAtrasos;
                                        #7#61 = nEl61;
                                        #7#62 = nEl62;
                                        #7#25 = #7#25 + nEl25;
                                        #7#27 = #7#27 + nEl27;
                                   |FINSI;
                              |SINO;
                                   |SI #7#22 ! 87; |Y #7#22 ! 97; |Y #7#22 ! 85;
                                   |Y #7#22 ! 421; |Y #7#22 ! 422;

                                        |SI #6#110 ! 0;
                                             nume1 = #6#110;
                                        |SINO;
                                             nume1 = #6#65;
                                        |FINSI;
                                        |HAZ liquidados;
                                        |HAZ modulo2;
                                        #7#61 = #6#35 * nume1;     || comunes,al nuevo (sw_reduc)
                                        #7#62 = #6#36 * nume1;     || profes,al nuevo (sw_reduc)
                                        |HAZ EnfMatMax;

                                        |SI #6#119 = 0; |Y #6#109 = 0; |Y #6#111 = 0;
                                             || si no hay nada grabado nada, pero estos campos
                                             || se deben grabar con las bases de mat, rie, ctrl
                                             || si no hubiera nada me quedo con lo calculado
                                             || por el silcon10
                                        |SINO;
                                             || ya tengo esta base
                                             #7#61 = #6#119 + #6#109 + #6#111;
                                             #7#62 = #6#119 + #6#109 + #6#111;
                                       |FINSI;

                                        #7#25 = #7#25 + #7#61;  || maternidad
                                        #7#27 = #7#27 + #7#62;
                                   |SINO;
                                        |SI #6#119 = 0; |Y #6#109 = 0;
                                             nume1 = #6#65;
                                             |HAZ liquidados;
                                             |HAZ modulo2;
                                             |SI nume1 ] #7#20;
                                                  || todo el mes de maternidad
                                                  #7#61 = #7#25; || si no no sale
                                                  #7#62 = #7#25; || bien
                                             |SINO;
                                                  #7#61 = #6#35 * nume1;     || comunes,al nuevo (sw_reduc)
                                                  #7#62 = #6#36 * nume1;     || comunes,al nuevo (sw_reduc)
                                                  #7#25 = #7#25 + #7#61;  || maternidad
                                                  #7#27 = #7#27 + #7#62;  || maternidad
                                             |FINSI;
                                        |SINO;
                                             #7#61 = #6#119 + #6#109;
                                             #7#62 = #6#119 + #6#109;
                                             #7#25 = #7#25 + #7#61;  || maternidad
                                             #7#27 = #7#27 + #7#62;  || maternidad
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |SINO;
                              |SI #7#27 < 0;
                                   #7#27 = 0;
                              |FINSI;
                         |FINSI;
                         |SI #labtraba#42 ! "T"; |Y #labtraba#42 ! "X";
                              #7#28 = #6#41;                  || Base Horas 1
                              #7#29 = #6#42;                  || Base Horas 2
                         |FINSI;
                         |SI #5#247 = 911;   || REGIMEN DEL CARBON
                              #7#63 = #6#55; || dias laborables
                              #7#64 = #6#56; || base cotizacion diaria
                              #7#72 = #6#89; || dias IT mineros
                         |FINSI;
                         ||el campo '#6#55' se usa para el parche de maternidad

                         || para formacion voy a meter aqui la cuota a pagar
                         || porque asi sabre si un trabajador tiene dos contratos
                         || de formacion el mismo mes y tengo que contizar solo
                         || por uno, en ese caso este campo estara a cero

                         |SI #6#9 = 085; |O #6#9 = 097; |O #6#9 = 421; |O #6#9 = 422;
                              #7#30 = #6#48;                  || Base Ayuda Familiar
                              nNume1 = #6#65;
                              |SI s_mes = 2;
                                   |SI bisiesto = 0; |Y nNume1 = 28; nNume1 = 30; |FINSI;
                                   |SI bisiesto = 1; |Y nNume1 = 29; nNume1 = 30; |FINSI;
                              |FINSI;
                              |SI nNume1 ] #7#20;       || si estoy todo el mes de maternidad
                                   #7#30 = #6#119 + #6#109; || meto aqui la base, ya que si no
                              |FINSI;                  || no sale el lote
                         |FINSI;
                         #7#31 = #6#56;                  || Base Ayuda Subnormalidad
                         #7#32 = #6#57;                  || Dto. Enfermedad
                         #7#33 = #6#31 + #6#32 + #6#65;  || Dias enfer.acci.mater.
                         || los dias de ILT se desglosan usando los campos
                         || desde/hasta informativos
                         #7#43 = #6#31;      || enfermedad comun
                         #7#44 = #6#32;      || accidente trabajo
                         #7#49 = #6#65;      || maternidad
                         #7#100 = #6#33;     || huelga
                         |HAZ FechasInicioTC2;
                         #7#34 = #6#58;                  || Dto. Acc.Trabajo
                         #7#35 = #6#12;                  || Codigo Bonificacion
                         |HAZ LeeBonif;
                         |SI s_anyl [ 2009;
                              |SI s_anyl [ 2006;
                                   #7#36 = #3#2;                   || Epigrafe Enfermedad
                              |SINO;
                                   #7#36 = 904;                    || Epigrafe Enfermedad
                              |FINSI;
                         |SINO;
                              |HAZ VerifCNAE;
                              #7#36 = nEpigConv;                  || Epigrafe
                              || migue
                         |FINSI;
                         #7#37 = #6#62;      || Base Enferm.Accte.
                         |HAZ tope_parche21;
                         |SI #6#9 ! 87;|Y #6#9 ! 97; |Y #6#9 ! 85; |Y #6#9 ! 421; |Y #6#9 ! 422;
                              |HAZ enfersano;                 || Si es enfermo o sano
                         |FINSI;
                         #7#39 = #6#1;                   || Codigo Trabajador
                         #7#40 = #5#245;                 || Comentario
                         |HAZ suplemen;
                         |SI #6#9 = 87; |O #6#9 = 97; |O #6#9 = 85; |O #6#9 = 64;
                           |O #6#9 = 65; |O #6#9 = 421; |O #6#9 = 422;
                              #7#45 = #13#10;           || cta.cotiz.18/93
                         |SINO;
                              |SI #1#45 = "N";              || por centros S/N
                                   #7#45 = #1#13;        || cta.cotiz.empresa
                              |SINO;
                                   #7#45 = #10#10;       || cta.cotiz.centro
                              |FINSI;
                         |FINSI;
                         ||#7#46 = "";                   || Literal fijo
                         ||el 'LITERAL ATRATOS' se usa para maternidad
                         #7#48 = #6#3;                 || tipo
                         #7#52 = #7#15 + #7#16;        || en BTRIEVE no mas de 7
                         #7#53 = ~;                    || fecha impresion
                         #7#54 = #1#45;                || por centros S/N
                         |HAZ LeeConvenio;
                         #7#55 = #16#142;              || codigo convenio
                         #7#59 = #6#35;                || promedio comunes
                         #7#60 = #6#36;                || promedio profesionales

                    |SI #6#99 > 0;
                         #7#74 = 3141;           || BONIF MAYORES DE 59
                         |SI #labtraba#212 = 3; |O #labtraba#212 = 4;
                              #7#74 = 1062;  || colectivo 1062: textil
                         |FINSI;
                         |SI #labtraba#212 = 5; |O #labtraba#212 = 6;
                              #7#74 = 0936;  || colectivo 0936: calzado
                         |FINSI;
                         |SI #labtraba#212 = 13; |O #labtraba#212 = 14;
                              #7#74 = 0736;  || colectivo 0736: juguete
                         |FINSI;
                         |SI #labtraba#212 = 15; |O #labtraba#212 = 16;
                              #7#74 = 0836;  || colectivo 0836: mueble
                         |FINSI;
                    |FINSI;
                    |SI #6#95 > 0;           || BONIF mayores de 55 (Textil)
                         #7#75 = #6#95;
                         |SI #labtraba#212 = 3; |O #labtraba#212 = 4;
                              #7#76 = 1001;  || colectivo 1001: textil
                         |FINSI;
                         |SI #labtraba#212 = 5; |O #labtraba#212 = 6;
                              #7#76 = 0927;  || colectivo 0927: calzado
                         |FINSI;
                         |SI #labtraba#212 = 13; |O #labtraba#212 = 14;
                              #7#76 = 0727;  || colectivo 0727: juguete
                         |FINSI;
                         |SI #labtraba#212 = 15; |O #labtraba#212 = 16;
                              #7#76 = 0827;  || colectivo 0827: mueble
                         |FINSI;
                    |FINSI;
                    |SI #6#94 > 0;
                         #7#73 = #6#94 + #6#112;  || BONIF PROGRAMA FOM.EMPLEO
                         |HAZ LeeBonPFE;          || NORMAL
                         #7#74 = nColectivo;
                         |SI #6#114 = 161; |O #6#114 = 164;
                              |SI #6#97 = "2";
                                   nColectivo = nColectivo + 1;
                                   #7#74 = nColectivo;
                              |FINSI;
                              |SI #6#97 = "R";
                                   nColectivo = nColectivo + 2;
                                   #7#74 = nColectivo;
                              |FINSI;
                         |FINSI;
                         |SI #6#114 = 507; |O #6#114 = 508;
                              #7#74 = 3267;
                         |FINSI;
                         |SI #6#114 = 141; |O #6#114 = 142;
                              #7#77 = #6#97;      || a¤os bonificacion
                              |SI #6#97 = "R";
                                   nColectivo = nColectivo - 12;
                                   #7#74 = nColectivo;
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    |SI #6#96 > 0;
                         #7#75 = #7#75 + #6#96 + #6#113;   || BONIF PROGRAMA FOM.EMPLEO
                         |HAZ LeeBonPFE;          || TEXTIL
                         |SI #7#76 ! 1001; |Y #7#76 ! 0927; |Y #7#76 ! 0727;
                         |Y #7#76 ! 0827;
                              #7#76 = nColectivo;
                         |FINSI;
                         #7#77 = #6#97;           || Informacion complementaria RED
                    |FINSI;
                    #7#79 = #8#25;           || COLECTIVO BONIFICACION

                    || cuando viene de las bonificaciones de toda la vida
                    || con colectivo o en las del 100% de las cuota de formacion
                    || vamos, en las que no son de importes fijos y hay que
                    || pintar colectivo

                    #7#89 = #6#120;          || bonificacion formacion
                    |SI #7#22 = 85; |O #7#22 = 421;
                         |SI #labtraba#190 = "S"; |O #labtraba#190 = "T";
                              fFechaAlta = #labtraba#36;
                              fFechaRef = "31.08.2011";
                              |SI fFechaAlta ] fFechaRef;
                                   #7#79 = "4208";     || formacion con desempleo
                              |SINO;
                                   #7#79 = "4204";     || formacion con desempleo
                              |FINSI;
                         |SINO;
                              ||#7#79 = "4203";     || formacion sin desempleo
                              #7#79 = "4201";     || formacion sin desempleo
                              || dejo el 4201 ya que a estas alturas, contratos
                              || de formacion sin desempleo han de ser los
                              || hijos de autonomos
                              || Si resulta que la 4203 tambien puede existir
                              || habra que hacer algo para distinguirlos
                         |FINSI;
                    |FINSI;

                         #7#80 = #6#99;           || BONIF MAYORES 59 A¥OS
                         #7#88 = #6#106;          || BONIF 50% CC ERE
                         desem = 78;
                         |SI #6desem ! 0;|Y #6#3 = 0;|Y #6#9 ! 87;|Y #6#9 ! 97; |Y #6#9 ! 85;
                         |Y #6#9 ! 421; |Y #6#9 ! 422;
                              |HAZ expediente;
                         |FINSI;
                         #7#101 = #6#121;
                         #7#102 = #6#122;         || BONIF. GARANTIA JUVENIL
                         |SI #7#25 ! 0;|O #7#27 ! 0; |O #7#67 ! 0;
                              |SI s_pas [ 3;
                                   |GRABA 020#7n;
                                   |SI FSalida = 0;|Y #7#48 ! 2; || los finiquitos aparte
                                        |HAZ tc1solo;             ||/no los considera
                                   |FINSI;
                                   |HAZ contador;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO contador;
     nTipConta = 0;
     ||SI #7#48 = 2; nTipConta = 2; |FINSI;
     |SI s_ori = "C"; nTipConta = 3; |FINSI;
     |SI #7#22 = 87;|O #7#22 = 97; |O #7#22 = 85;
     |O #7#22 = 421; |O #7#22 = 422;
           nTipConta = 8;
     |FINSI;
     |SI #7#22 = 64;|O #7#22 = 65;                nTipConta = 9; |FINSI;
     |SI #7#48 ] 10;
          nTipConta = nTipConta + 10;
     |FINSI;

     |SI siono_cen = "S";   nCenConta = #7#14;   |FINSI;
     |SI siono_cen = "N";   nCenConta = 99;      |FINSI;

     aNafConta = #7#15 + #7#16 + #7#17;     || NAFSS trabajador
     |QBT aNafConta;

     #111#0 = #7#0;           || Empresa
     #111#1 = nCenConta;      || Centro
     #111#2 = #0#2;           || Mes
     #111#3 = nTipConta;      || Tipo
     #111#4 = aNafConta;      || nro.afiliacion
     |LEE 000#111=;
     |SI FSalida ! 0;
          |GRABA 020#111n;
     |FINSI;
|FPRC;

|PROCESO si_mater;
    sw_mater = 0;
|SI #6#65 ! 0;|Y #0#3 ] 1995;

    m_dias = #6#65;

    |SI runnom = "nomyytc2";|Y #5#60 = "M"; m_dias = m_dias + #5#89; |FINSI;
    ||SI runnom = "nomwwtc2";|Y #6#68 = "M"; m_dias = m_dias + #6#70; |FINSI;
    |SI runnom = "nomwwtc2";|Y #6#90 = "M"; m_dias = m_dias + #6#91; |FINSI;

        nume1 = 0;
    |SI #6#27 = "M";     nume1 = #6#23; |FINSI;
    |SI #6#28 = "M";     nume1 = #6#24; |FINSI;
    |SI #6#29 = "M";     nume1 = #6#25; |FINSI;
    |SI #6#30 = "M";     nume1 = #6#26; |FINSI;
    |SI nume1 = 0;       nume1 = #6#7; |FINSI;

        alfa1 = nume1;       alfa1 = "00" + alfa1;    alfa1 = alfa1 % -102;
        alfa2 = #6#2;        alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
        alfa3 = alfa1 + "." + alfa2 + "." + #0#3;
        fech1 = alfa3;            nume1 = fech1;
        fech2 = "01.01.1995";     nume2 = fech2;
        nume3 = nume1 - nume2 + 1;

    |SI m_dias [ nume3; sw_mater = 1;  |FINSI;
    |SI #6#2 ] 6;                  sw_mater = 1;  |FINSI;
|FINSI;
|FPRC;

|PROCESO mes;     || CALCULA MES LITERAL
    bisiesto = #0#3 $ 4;
|SI bisiesto = 0;
    bisiesto = 1;
|SINO;
    bisiesto = 0;
|FINSI;
|SI #0#2 = 1;  #7#11 = "Enero     ";  guarda = 31;  f_mes = "31.01."; |FINSI;
|SI #0#2 = 2;  #7#11 = "Febrero   ";  guarda = 28 + bisiesto;
     |SI bisiesto = 0;
          f_mes = "28.02.";
     |SINO;
          f_mes = "29.02.";
     |FINSI;
|FINSI;
|SI #0#2 = 3;  #7#11 = "Marzo     ";  guarda = 31;  f_mes = "31.03."; |FINSI;
|SI #0#2 = 4;  #7#11 = "Abril     ";  guarda = 30;  f_mes = "30.04."; |FINSI;
|SI #0#2 = 5;  #7#11 = "Mayo      ";  guarda = 31;  f_mes = "31.05."; |FINSI;
|SI #0#2 = 6;  #7#11 = "Junio     ";  guarda = 30;  f_mes = "30.06."; |FINSI;
|SI #0#2 = 7;  #7#11 = "Julio     ";  guarda = 31;  f_mes = "31.07."; |FINSI;
|SI #0#2 = 8;  #7#11 = "Agosto    ";  guarda = 31;  f_mes = "31.08."; |FINSI;
|SI #0#2 = 9;  #7#11 = "Septiembre";  guarda = 30;  f_mes = "30.09."; |FINSI;
|SI #0#2 = 10; #7#11 = "Octubre   ";  guarda = 31;  f_mes = "31.10."; |FINSI;
|SI #0#2 = 11; #7#11 = "Noviembre ";  guarda = 30;  f_mes = "30.11."; |FINSI;
|SI #0#2 = 12; #7#11 = "Diciembre ";  guarda = 31;  f_mes = "31.12."; |FINSI;
|FPRC;

|PROCESO altabaja;    || CALCULA CLAVE DE ALTA/BAJA/EMPATE
    alfalta1 = #6#4 % 402;  numalta1 = alfalta1;  || mes alta
    alfalta2 = #6#4 % 704;  numalta2 = alfalta2;  || a¤o alta

    alfbaja1 = #6#5 % 402;  numbaja1 = alfbaja1;  || mes baja
    alfbaja2 = #6#5 % 704;  numbaja2 = alfbaja2;  || a¤o baja

    diaalfa1 = #6#4 % 102;  dianume1 = diaalfa1;  || dia alta
    diaalfa2 = #6#5 % 102;  dianume2 = diaalfa2;  || dia baja

|SI numalta1 = #0#2; |Y numalta2 = #0#3;
        #7#13 = "A";     || es alta
|FINSI;
|SI numbaja1 = #0#2; |Y numbaja2 = #0#3;
        #7#13 = "B";     || es baja
|FINSI;
|SI numalta1 = numbaja1; |Y numalta2 = #0#3; |Y numbaja2 = #0#3;
        #7#13 = "X";     || es alta y baja en el mismo mes y a¤o
|FINSI;
|FPRC;

|PROCESO enfersano;    || CALCULA CLAVE DE ENFERMO/SANO
    sanos = #6#8 - #6#31;
|SI sanos < #6#31;       || si los dias de trabajo son menores a los dias
        #7#38 = "E";     || de enfermedad se incluye en el epigrafe accidente
|FINSI;                  || si no se incluye en el epigrafe de enfermedad
|FPRC;

|PROCESO suplemen;     || CALCULA VARIABLES PARA LINEA SUPLEMENTO
|SI #7#13="A"; #7#41=dianume1; #7#42=0; |FINSI;   || si es alta este mes
|SI #7#13="B"; #7#41=0; #7#42=dianume2; |FINSI;   || si es baja este mes
|SI #7#13=" "; #7#41=0; #7#42=0;        |FINSI;   || si continua
|SI #7#13="X"; #7#41=dianume1; #7#42=dianume2; |FINSI;  || alta/baja

|PARA nume1 = 27; |SI nume1 [ 30; |HACIENDO nume1 = nume1 + 1;

    |SI #6nume1 = "M";        || parche de AGIRED para maternidad
            #7#46 = #6#55;    || (usa el campo 'LITERAL ATRASOS')
    |FINSI;
/*
        nume2 = nume1 - 8;
        nume3 = nume1 - 4;
    |SI #6nume1 = "E";|O #6nume1 = "M";           || enfermedad/maternidad
            #7#43 = #6nume2;  || desde dia
            #7#49 = #6nume3;  || hasta dia
        |SI #7#43 = 0;  #7#43 =      1;  |FINSI;
        |SI #7#49 = 0;  #7#49 = guarda;  |FINSI;
    |FINSI;
            #7#51 = #7#32;
            alfa1 = #7#51;    |QBF alfa1;
        |SI #6nume1 = "M";|Y sw_mater = 1;
            |SI #7#32 ! 0;
                    alfa1 = alfa1 + " M";
            |SINO;
                    alfa1 = "   M";
            |FINSI;
        |FINSI;
            #7#51 = ("         " + alfa1) % -109;
    |FINSI;
    |SI #6nume1 = "A";                       || accidente
            #7#44 = #6nume2;  || desde dia
            #7#50 = #6nume3;  || hasta dia
        |SI #7#44 = 0;  #7#44 =      1;  |FINSI;
        |SI #7#50 = 0;  #7#50 = guarda;  |FINSI;
    |FINSI;
*/
|SIGUE;
|FPRC;

|PROCESO cen_esp;
|ABRE #13;
|DDEFECTO #13;
    #13#0 = #5#0;        || empresa
    #13#13 = #5#77;      || centro
|SI #6#9 = 97; |O #6#9 = 85; |O #6#9 = 421; |O #6#9 = 422;
        #13#1 = 87;
|SINO;
    |SI #6#9 = 65;
            #13#1 = 64;
    |SINO;
            #13#1 = #6#9;
    |FINSI;
|FINSI;
|LEE 000#13=;
|CIERRA #13;
|FPRC;

|PROCESO liquidados;
|SI s_ori = "A";|O s_ori = "T";
     |SI s_ori = "A";  nMesAtraso = #nomcalac#2;  |FINSI;
     |SI s_ori = "T";  nMesAtraso = #nomhicca#2;  |FINSI;

     nume2 = 0;     nume3 = #0#3 $ 4;
     |SI nume3 = 0;|Y #36#9 = "S"; nume2 = 1; |FINSI;  || bisiesto

     topemes = 31; |SI nMesAtraso = 2; topemes = 28 + nume2; |FINSI;
     |SI nMesAtraso = 4;|O nMesAtraso = 6;|O nMesAtraso = 9;|O nMesAtraso = 11; topemes = 30; |FINSI;

     dia_2 = topemes;
     dia_3 = 30;
     |SI #5#42 = "D";|O #5#42 = "T";
          dia_3 = topemes;
     |FINSI;
     dia_4 = dia_3;
/*
        dia_2 = 30 * (s_has - s_mes + 1);
        dia_3 = 30 * (s_has - s_mes + 1);    || dias cotizacion 'mensual'
    |SI #5#42 = "D";|O #5#42 = "T";
          dia_3 = 0;
          |PARA cuenta = s_mes; |SI cuenta [ s_has; |HACIENDO cuenta = cuenta + 1;
              nume2 = 0;    nume3 = #0#3 $ 4;
              |SI nume3 = 0;|Y #36#9 = "S";    nume2 = 1;     |FINSI;

              topemes = 31; |SI cuenta = 2; topemes = 28 + nume2; |FINSI;
              |SI cuenta = 4;|O cuenta = 6;|O cuenta = 9;|O cuenta = 11; topemes = 30; |FINSI;
              dia_3 = dia_3 + topemes;
          |SIGUE;
    |FINSI;
        dia_4 = dia_3;
*/
|SINO;
        dia_2 = guarda;      || dias que tiene el mes
        dia_3 = 30;          || dias cotizacion 'mensual'
    |SI #5#42 = "D";|O #5#42 = "T";
    |O #5#42 = "C";|O #5#42 = "F";
            dia_3 = guarda; || dias cotizacion 'diario'
    |FINSI;
        dia_4 = dia_3;
|FINSI;

|SI nume1 > dia_4;  nume1 = dia_4;  |FINSI;
|SI nume1 = dia_2; |Y nume1<dia_4;  nume1 = dia_4;  |FINSI;
|FPRC;

|PROCESO CalculaFechaTC2;
     |SI #6#27 = aTipILT; m_des = #6#19;    m_has = #6#23; |FINSI;
     |SI #6#28 = aTipILT; m_des = #6#20;    m_has = #6#24; |FINSI;
     |SI #6#29 = aTipILT; m_des = #6#21;    m_has = #6#25; |FINSI;
     |SI #6#30 = aTipILT; m_des = #6#22;    m_has = #6#26; |FINSI;

     |SI m_des ! 0;
             alfa1 = m_des;   alfa1 = "00" + alfa1;    alfa1 = alfa1 % -102;
             alfa2 = #6#2;    alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
             m_fec = alfa1 + "." + alfa2 + "." + anyonum;
     |SINO;
         |SI m_has ! 0;
                 alfa1 = m_has;   alfa1 = "00" + alfa1;    alfa1 = alfa1 % -102;
                 alfa2 = #6#2;    alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
                 m_top = alfa1 + "." + alfa2 + "." + anyonum;
         |SINO;
                 m_top = f_mes + anyonum;
                 |SI #labtraba#42 = "M";     || los mensuales puede haber
                    m_top = m_top % -108;    || problemas en este caso
                    m_top = "30" + m_top;
                 |FINSI;
         |FINSI;
             fech1 = m_top;   nume1 = fech1;
             nume1 = nume1 - nTotILT + 1;
             fech1 = nume1;
             m_fec = fech1;
     |FINSI;
     m_fec = (m_fec % 102) + (m_fec % 402) + (m_fec % -102);
|FPRC;

|PROCESO FechasInicioTC2;
     |SI s_ori = "A";|O s_ori = "T";         || en atrasos no se puede
          |ACABA;                            ||/calcular la fecha inicio ILT
     |FINSI;

     nTotEnf = 0;
     nTotMat = 0;
     nTotAcc = 0;

     |SI s_ori = "M";
          |SI #5#60 = "E";    nTotEnf = #5#89;    |FINSI;
          |SI #5#60 = "M";    nTotMat = #5#89;    |FINSI;
                              nTotAcc = #5#92;
     |FINSI;
     |SI s_ori = "H";
          |ABRE #200;
          #200#0 = #6#0;
          #200#1 = #6#1;
          #200#66= any_hist;
          #200#2 = #6#2;
          #200#3 = #6#3;
          |LEE 000#200=;
          |SI FSalida = 0;
               |SI #200#68 = "E";    nTotEnf = #200#70;    |FINSI;
               |SI #200#68 = "M";    nTotMat = #200#70;    |FINSI;
                                     nTotAcc = #200#73;
          |FINSI;
          |CIERRA #200;
     |FINSI;
     nTotEnf = nTotEnf + #7#43;
     nTotMat = nTotMat + #7#49;
     nTotAcc = nTotAcc + #7#44;

     |SI nTotEnf ! 0;
          nTotILT = nTotEnf;
          aTipILT = "E";
          |HAZ CalculaFechaTC2;
          #7#56 = m_fec;
     |FINSI;
     |SI nTotAcc ! 0;
          nTotILT = nTotAcc;
          aTipILT = "A";
          |HAZ CalculaFechaTC2;
          #7#57 = m_fec;
     |FINSI;
     |SI nTotMat ! 0;
          nTotILT = nTotMat;
          aTipILT = "M";
          |HAZ CalculaFechaTC2;
          #7#58 = m_fec;
     |FINSI;
|FPRC;
____________________________________/ RUTINAS DE IMPRESION
|PROCESO desglosa;     || DESGLOSA EN DIA, MES Y ANYO UNA FECHA DD.MM.AAAA
    alfa1 = fecalf %  102;   dia = alfa1;
    alfa1 = fecalf %  402;   mes = alfa1;
    alfa1 = fecalf % -104;   any = alfa1;
|SI alfa1 = "....";
        dia = 0;
        mes = 0;
        any = 0;
|FINSI;
|FPRC;

|PROCESO bonifica;
||SI #8#9 = "N";
||        sw_reductor = 0;
||SINO;
        fecalf = #5#40;   || desglosa fecha alta bonificacion
    |HAZ desglosa;
        diaalt = dia;     mesalt = mes;          anyalt = any;
        totalt = (anyalt * 100) + mesalt;

        fecalf = #5#41;   || desglosa fecha vto. bonificacion
    |HAZ desglosa;
        diaven = dia;     mesven = mes;          anyven = any;
        totven = (anyven * 100) + mesven;
    |SI totven = 0;
            totven = 999912;
    |FINSI;

        nume1 = #0#3;
        totact = (nume1 * 100) + #0#2;

        dboni_1 = 0;  || dias de bonificacion

    |SI totact = totalt;                     || empieza este mes
            dboni_1 = (30 - diaalt) + 1;
        |SI dboni_1 < 0;     dboni_1 = 0;        |FINSI;
    |FINSI;

    |SI totalt [ totact; |Y totven ] totact; || si esta entre el a¤o o es igual
            dboni_1 = 30;
    |FINSI;

    |SI totven = totact;                     || vence este mes
            dboni_1 = diaven;
    |FINSI;

    ||SI dboni_1 ! 0;     sw_reductor = 1;    |FINSI;
||FINSI;
|FPRC;

|PROCESO rup_epigr;
    swbonif = 0;
    swdetal = 0;
    swenfer = 0;
    swepigr = 1;             || carga el switch de impresion de epigrafe
    t_epigr = antepigr;      || carga el epigrafe accidente
    t_epig0 = t_epig1;       || carga el total bases cont. comunes
    t_epigb = t_epig9;       || carga el total cuotas epig. ILT
    t_epigc = t_epiga;       || carga el total cuotas epig. IMS
    t_epig3 = "..........."; || carga el literal del total
    t_puotp = t_cuotp;
    t_puoto = t_cuoto;
    t_puotm = t_cuotm;
    t_puotm2 = t_cuotm2;
    t_puotx = t_cuotx;
    t_puot_ere_ilt = t_cuot_ere_ilt;
    t_puot_ere_ims = t_cuot_ere_ims;

||PRINT;                      || imprime total epigrafe accidennte
|HAZ epigrafe;               || graba en aux. de epigrafes
|FPRC;

|PROCESO rup_enfer;
|SI pregunta = 87;
     |ACABA;
|FINSI;
|SI t_enfe1 ! 0;
        t_epigr = t_enfe0;       || carga el epigrafe de enfermedad
        t_epig0 = t_enfe1;       || carga el total bases enfermedad
        t_epigb = t_enfe3;       || carga el total cuotas epig.enf.ILT
        t_epigc = t_enfe4;       || carga el total cuotas epig.enf.IMS
        t_epig2 = t_enfe2;       || carga el nro. de trabajadores enfermos
        t_epig3 = "ENFERMEDAD "; || carga el literal del total
        t_puotp = t_cuetp;
        t_puoto = t_cueto;
    ||PRINT;                     || imprime t.epig.enferm.+suplemento
    |HAZ epigrafe;               || graba el 126 en el aux. de epigrafes
|FINSI;
|FPRC;

|PROCESO acum_epigenfe;
     |DDEFECTO #9;
     #9#0 = #7#36;
     |LEE 020#9=;                  || lee epigrafe
     epig_ilt = #9#1;
     epig_ims = #9#2;

     #11#0 = #7#0;
     #11#1 = #7#39;
     #11#2 = #7#36;
     |LEE 000#11=;                 || lee epigrafe/trabajador
     |SI FSalida = 0;
          epig_ilt = #11#3;
          epig_ims = #11#4;
     |FINSI;

     |SI #labtraba#42 = "M"; |Y pregunta = 87;
          |SI s_mes = 2; |Y #7#49 ] 28;
               || #7#49 = 30;
               #7#33 = 30;
          |FINSI;
     |FINSI;
     |SI pregunta = 87; |Y #7#33 ] #7#20;

     || vamos a ver, si estoy en enfermedad no tengo que volver a grabar epigrafe
     || ya que en formacion solo sale un epigrafe en el lote, si estoy todo
     || el mes en enfermedad sale el 126 y si no sale el que tenga el trabajador
     || pero aun asi la cuota es la fija del nomcones, aqui no tenog que hacer nada
     || si no lo grabo dos veces y eso no es correcto, ya que luego suma los dos
     || epigrafes en los lotes y TC's

          |SI #7#49 = #6#7;        || si estoy todo el mes de maternidad
               n85Mat = n85Mat + mas;    || esto para que me lo grabe en los que tiene
                                   || que descontar luego la cuota obrera
               |SI #labtraba#190 = "S";
                    n85DesMat = n85DesMat + mas;
               |FINSI;
          |FINSI;
     |SINO;
          |HAZ cotiz_esp;
          |HAZ tope_parche;
          |HAZ Parche_Feb2;
          t_enfe1 = t_enfe1 + #7#37;               || acumula total epigrafe enfer.

          |SI s_ori = "A";|O s_ori = "T";
               t_enfe3 = t_enfe3 + nCuotaIT_ilt;    || cuota ILT
               t_enfe4 = t_enfe4 + nCuotaIT_ims;    || cuota IMS
          |SINO;
               t_enfe3 = t_enfe3 + ((#7#37 % epig_ilt) ! EURODB);  || cuota ILT
               t_enfe4 = t_enfe4 + ((#7#37 % epig_ims) ! EURODB);  || cuota IMS
          |FINSI;
          t_cuetp = t_cuetp + (#7#37 % #3#12);          || desem.patronal
          t_cueto = t_cueto + (#7#37 % #3#13);          || desem.obrera
     |FINSI;

     nBaseTra = #7#37;

     |HAZ nomtepcd;
|FPRC;

|PROCESO acum_epigrafes;
|DDEFECTO #9;
    #9#0 = #7#26;
    |LEE 020#9=;                  || lee epigrafe
    epig_ilt = #9#1;
    epig_ims = #9#2;

    #11#0 = #7#0;
    #11#1 = #7#39;
    #11#2 = #7#26;
|LEE 000#11=;                 || lee epigrafe/trabajador
|SI FSalida = 0;
        epig_ilt = #11#3;
        epig_ims = #11#4;
|FINSI;
|HAZ cotiz_esp;
|SI #8#10 = 4;
     #7#62 = 0;
     || a ver, esto es porque tengo una bonificacion de mayores de 65 a¤os
     || y tengo tambien base de CP de maternidad, cosa que es imposible, con
     || lo que esto quiere decir que lo que tengo es una IT de mas de 365
     || dias que la aga la seguridad social directamente, entonces la base
     || para CP debe ser cero, al ser mayor de 65 a¤os, no va al BA22, va al BA42
|FINSI;
    t_epig1 = t_epig1 + #7#27;     || acumula total epigrafe (Cot. Normal)
    t_epigd = t_epigd + #7#62;     || para maternidad (Cotiz. Empresarial)
    t_epigf = t_epigf + #7#68;     || para Exp.Reg.Em (Cotiz. Empresarial)
|SI #8#10 = 4;
    || t_epige = t_epige + nEl27_65anyos;
    || t_epige = t_epige + #7#27;
    t_epige = t_epige + #7#27 + #7#37;  || lo dejo asi .... lo de la variable
                                        || no era buena idea
|FINSI;
|SI pregunta ! 87;
        |SI s_ori = "A";|O s_ori = "T";
             t_epig9 = t_epig9 + nCuotaA_ilt;    || cuota ILT
             t_epiga = t_epiga + nCuotaA_ims;    || cuota IMS
        |SINO;
             t_epig9 = t_epig9 + (#7#27 % epig_ilt) ! EURODB;    || cuota ILT
             t_epiga = t_epiga + (#7#27 % epig_ims) ! EURODB;    || cuota IMS
        |FINSI;
        t_cuotp = t_cuotp + (#7#27 % #3#12);                || desem.patronal
        t_cuoto = t_cuoto + (#7#27 % #3#13);                || desem.obrera
        t_cuotm = t_cuotm + (#7#62 % (#3#12+#3#14+#3#16));  || cp maternidad patronal
        t_cuotm2 = t_cuotm2 + (#7#62 % (#3#13+#3#15+#3#17));  || cp maternidad obrera
        t_cuotx = t_cuotx + (#7#68 % (#3#12+#3#14+#3#16));  || cp Exp.Reg.Empleo
        por_mat = #3#12 + #3#14 + #3#16;
        t_cuot_ere_ilt = t_cuot_ere_ilt + (#7#68 % epig_ilt_IT) ! EURODB;
        t_cuot_ere_ims = t_cuot_ere_ims + (#7#68 % epig_ims_IT) ! EURODB;

        |SI #7#62 > 0;                       || si tenemos maternidad
            |SI por_mat_ref ! -1;            || y no son ya distintos los %
                |SI por_mat_ref > 0;         || comparo con el d referencia
                    |SI por_mat ! por_mat_ref;   || si lo hay (si es > 0)
                        por_mat_ref = -1;    || si no son iguales se pone a -1
                    |FINSI;                  || (no se imprime)
                |SINO;                       || si son iguales, de momento el
                    por_mat_ref = por_mat;   || candidato es el actual
                |FINSI;                      || me lo guardo
            |FINSI;
        |FINSI;
|SINO;
          swSigue = 0;
          #5#0 = #7#0; #5#1 = #7#39; |LEE 020#5=;       || leo labtraba
          |SI #7#30 ! 0;
               swSigue = 1;
          |FINSI;
          |SI #labtraba#191 = "S"; |O #labtraba#191 = "T";
               |SI #7#30 = 0; |Y #7#89 ! 0;
                    || si es cero la cuota de comunes y es cero la bonif, es porque
                    || es un trabajador con cambio de contrato
                    swSigue = 1;
               |FINSI;
          |FINSI;
          |SI swSigue = 1;
             |SI #7#22=85; |O #7#22 = 421; |O #7#22 = 422;
                  t_epig9=t_epig9+#14#17; t_epiga=t_epiga+#14#15;
             |FINSI;
             |SI #7#22=87; t_epig9=t_epig9+#14#11; t_epiga=t_epiga+#14#9;  |FINSI;
             |SI #7#22=97;
                     #5#0 = #7#0; #5#1 = #7#39; |LEE 020#5=;
                     fech1 = #5#36;
                 |SI fech1 < "17.05.1997";
                         t_epig9=t_epig9+#14#11; t_epiga=t_epiga+#14#9;
                 |SINO;
                         t_epig9=t_epig9+#14#17; t_epiga=t_epiga+#14#15;
                 |FINSI;
             |FINSI;
        |FINSI;
|FINSI;
nBaseTra = #7#27;
|HAZ nomtepcd;               || grabo trabajador en auxiliar cuota Des.
|HAZ cotizTrab;
|FPRC;

|PROCESO cotizTrab;
     |ABRE #tsilcon1;
     #tsilcon1#0 = #labtraba#0;
     #tsilcon1#1 = #labtraba#1;
     #tsilcon1#2 = s_mes;
     #tsilcon1#3 = s_tat;
     |LEE 000#tsilcon1.=;
     |CIERRA #tsilcon1;

     |ABRE #nomssfan;
     |DDEFECTO #nomssfan;
     #nomssfan#0 = #labtraba#0;
     #nomssfan#1 = #labtraba#1;
     #nomssfan#2 = s_any;
     #nomssfan#3 = s_mes;
     #nomssfan#4 = s_tat;
     |LEE 101#nomssfan.=;
     FEstado = FSalida;

     #nomssfan#0 = #labtraba#0;
     #nomssfan#1 = #labtraba#1;
     #nomssfan#2 = s_any;
     #nomssfan#3 = s_mes;
     #nomssfan#4 = s_tat;
     #nomssfan#5 = s_num;
     #nomssfan#6 = nConstante;
     #nomssfan#7 = #labempre#128;
     #nomssfan#8 = #labtraba#204;

     aAlfa1 = #7#8; |QBF aAlfa1;
     aAlfa2 = #7#9; |QBF aAlfa2;
     aAlfa3 = #7#10; |QBF aAlfa3;
     aAlfa = "0111" + aAlfa1 + aAlfa2 + aAlfa3;

     #nomssfan#14 = aAlfa;

     |SI #7#22 ! 87; |Y #7#22 ! 97; |Y #7#22 ! 85; |Y #7#22 ! 421; |Y #7#22 ! 422;
          || comunes
          nCuotaEmp = (#7#25 - #7#61) % #nomconst#6;
          |SI #labtraba#247 ! 112;
               || artistas no
               nCuotaEmp = nCuotaEmp + ((#7#61 + #7#67) % #nomconst#6);
          |FINSI;
          || recargo contratos inferiores a 7 dias
          |SI #labtraba#112 = "S";
               nCuotaEmp = nCuotaEmp + (nCuotaEmp % 36);
          |FINSI;
          |SI #labtraba#247 ! 112;
               nBase = #7#27 + #7#37 + #7#68;
          |SINO;
               nBase = #7#27 + #7#68;
          |FINSI;
          || des + fog + fp
          nCuotaEmp = nCuotaEmp + (nBase % (#nomconst#12 + #nomconst#14 + #nomconst#16));
          || cnae / ocup
          nCuotaEmp = nCuotaEmp + (nBase % (epig_ilt + epig_ims));

          || horas extras
          nCuotaEmp = nCuotaEmp + (#7#28 % #nomconst#8) + (#7#29 % #nomconst#10);

          |SI #tsilcon1#61 = 4.70;
               || comunes
               nCuotaTra = (#7#25 - #7#61) % (#nomconst#7);
               || des + fog + fp
               nCuotaTra = nCuotaTra + ((#7#27 + #7#37 - #7#62) % (#nomconst#13 + #nomconst#15 + #nomconst#17));
               || horas extras
               nCuotaTra = nCuotaTra + (#7#28 % #nomconst#9) + (#7#29 % #nomconst#11);
          |SINO;
               nCuotaTra = (#7#25 - #7#61) % (#tsilcon1#61);

               || exentos de desempleo
               nCuotaEmp = nCuotaEmp - ((#7#27 + #7#37) % (#nomconst#12 + #nomconst#14 + #nomconst#16));
          |FINSI;
     |SINO;
          nCuotaEmp = #nomcones#16 + #nomcones#17 + #nomcones#15 + #nomcones#18 + #nomcones#23;
          nCuotaTra = #nomcones#19 + #nomcones#20 + #nomcones#24;
          |SI #labtraba#190 = "N";
               nCuotaEmp = nCuotaEmp - #nomcones#23;
               nCuotaTra = nCuotaTra - #nomcones#24;
          |SINO;
               |SI #labtraba#191 = "S";
                    swAgosto2012 = 0;
                    |SI s_any ] 2012;
                         |SI s_any ] 2013;
                              swAgosto2012 = 1;
                         |SINO;
                              |SI s_mes ] 08;
                                   swAgosto2012 = 1;
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    fFecha = #labtraba#36;
                    |SI fFecha ] "30.08.2011";
                         nCuotaEmp = 0;
                         nCuotaTra = 0;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     #nomssfan#9 = nCuotaEmp;
     #nomssfan#10 = nCuotaTra;

     || tsilcon1 -> #6
     nNume1 = #6#63 + #6#64 + #6#81 + #6#92 + #6#106;
     nNume1 = nNume1 + #7#73 + #6#95 + #6#96 + #6#99 + #6#122;
     |SI #7#22 ! 87; |Y #7#22 ! 97; |Y #7#22 ! 85; |Y #7#22 ! 421; |Y #7#22 ! 422;
          |SI #tsilcon1#61 ! 4.70;      || mayores de 65 a¤os
               nNume1 = nNume1 - (#7#25 % (#nomconst#7 - #tsilcon1#61));
          |FINSI;
     |FINSI;
     #nomssfan#11 = nNume1;

     #nomssfan#9 = #nomssfan#9 - #nomssfan#11;
     #nomssfan#12 = #nomssfan#9 + #nomssfan#10;
     #nomssfan#13 = #labtraba#45;

     |SI FEstado = 0;
          |GRABA 020#nomssfan.a;
     |SINO;
          |GRABA 020#nomssfan.n;
     |FINSI;
     |LIBERA #nomssfan;

     |CIERRA #nomssfan;
|FPRC;

|PROCESO cotiz_esp;
|ABRE #1;
    #1#0 = #7#0;         || lee empresa
|LEE 020#1=;
|CIERRA #1;
|ABRE #105;
    #105#0 = #7#0;
    #105#1 = #7#39;
|LEE 000#105=;           || lee trabajadores cabs.
|SI FSalida ! 0;|O #105#3 = 0;
     nConstante = #1#32;
|SINO;
     nConstante = #105#3;
|FINSI;
|CIERRA #105;

|ABRE #3;
    #3#0 = nConstante;   || lee constante
|LEE 020#3=;
     nMes = #0#2;
     nAny = #0#3;
     nCodigoCons = #3#0;
     |HAZ VerifCons;
|CIERRA #3;

|SI s_ori = "H"; |O s_ori = "A"; |O s_ori = "T";
     |ABRE #106;
     #106#77 = #7#0;          || empresa
     #106#78 = #7#39;         || trabajador
     ||#106#80 = enAny;         || a¤o
     #106#80 = s_anyl;         || a¤o
     #106#79 = #0#2;          || mes
     |LEE 000#106=;
     |SI FSalida = 0;
          nChequea = 0;
          #3#0 = nConstante;  || leer codigos de constante por emp,trab,mes,anyo
          |PARA i = 3; |SI i [ 19; |HACIENDO i = i + 1;
               nChequea = nChequea + #106i;
          |SIGUE;
          |SI nChequea ! 0;
               |PARA i = 1; |SI i [ 76; |HACIENDO i = i + 1;
                    #3i = #106i;
               |SIGUE;
          |FINSI;
     |FINSI;
     |CIERRA #106;
|FINSI;

|ABRE #14;
    #14#0 = #1#32;       || lee constante especial
|LEE 000#14=;
|CIERRA #14;
|FPRC;

|PROCESO tope_parche21;
     |SI swFiniqRaro2 = 1; |O #6#3 = 2;
          |ACABA;
     |FINSI;
     |SI #labtraba#42 = "M";
          |SI #7#33 > #6#8;       || todo el mes de baja
               |SI #7#27 > 0;      || con una base el alta (no es correcto)
                    #7#37 = #7#37 + #7#27;
                    #7#27 = 0;     || la base de epigrafes tiene que ser cero
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #labtraba#42 = "D"; |Y nMes ! 2;
          || en febrero no, por evitarme problemas con topes
          || aunque en verdad este parche NO deberia existir
          |SI #7#33 ] #6#8;       || todo el mes de baja
               |SI #7#27 > 0;      || con una base el alta (no es correcto)
                    #7#37 = #7#37 + #7#27;
                    #7#27 = 0;     || la base de epigrafes tiene que ser cero
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tope_parche;
     || en el caso de que tengamos un trabajador que sea:
     || 1. Diario
     || 2. Que cotize al maximo (88.40 euros al dia)
     || 3. Que este todo el mes de baja
     || no sale bien el seguro social porque al hacer la base en baja, al
     || estar el maximo ha de coger para comunes el maximo de 31 dias y para
     || profesionales el maximo de 30, eso en alta no tiene problema, pero
     || en baja me guardo una sola base, asi que este proceso topea las
     || profesionales comprobando que no pase del maximo, pero solo ESE caso
     || es decir, controla solo que la base de profesionales en baja no sea
     || mayor que el tope de Profesionales que dice la Seg. Social: 2652 euros
     || esto es un arreglo cutre para Asecor, 25.11.2003

     |SI #6#3 = 2;
          |ACABA;
     |FINSI;
     nume1 = #nomconst#20 * 30;
     |SI #7#37 > nume1;
          #7#37 = nume1;
     |FINSI;
|FPRC;
____________________________________/ LECTURA DEL TEMPORAL E IMPRESION TC2
|PROCESO pie_tc2;
|SI haentrat = 1;   || si ha impreso cierra el informe, totalizando
    |HAZ empresas;             || graba en la plantilla en la empresa
    |HAZ centros;              || graba en la plantilla en el centro
    |HAZ rup_epigr;            || graba epigrafe y linea total
    |HAZ rup_enfer;            || graba epigrafe enfermedad y linea total
    |SI siono_cen = "S";
        |HAZ lee_notar;
    |FINSI;
    |HAZ auxiliar;             || graba en el auxiliar de empresas
    ||PIEINF;
    ||FININF;                   || cierra el informe
    |HAZ adjuntar;             || lanza, en su caso, la relacion adjunta
|SINO;
    ||FININF;                   || cierra el informe
|FINSI;
|FPRC;

|PROCESO lee_epig_enfe;
     |DDEFECTO #9;
     |SI s_anyl [ 2009;
          |SI s_anyl [ 2006;
               #9#0 = 126;
          |SINO;
               #9#0 = 904;
          |FINSI;
     |SINO;
          ||HAZ VerifCNAE;
          ||#9#0 = nEpigConv;                  || Epigrafe
          #9#0 = #7#36;
          || migue
     |FINSI;
     |LEE 020#9=;                  || lee epigrafe IT
     epig_ilt_IT = #9#1;
     epig_ims_IT = #9#2;
|FPRC;

|PROCESO impresion;
|SI #7#22 = 64;|O #7#22 = 65;
    |SI pregunta = -1; |ACABA; |FINSI;
|FINSI;
|SI #7#22 = 87;|O #7#22 = 97; |O #7#22 = 85; |O #7#22 = 421; |O #7#22 = 422;
    |SI pregunta = -1; |ACABA; |FINSI;
|FINSI;
|SI #7#22 ! 64;|Y #7#22 ! 65;               |Y pregunta = 64; |ACABA; |FINSI;
|SI #7#22 ! 87;|Y #7#22 ! 97; |Y #7#22 ! 85; |Y #7#22 ! 421; |Y #7#22 ! 422;
|Y pregunta = 87;
     |ACABA;
|FINSI;
|SI antempre = -1;  |HAZ inicio;           |FINSI;
|SI antcentr = -1;      antcentr = #7#14;  |FINSI;
|SI antepigr = -1;      antepigr = #7#26;  |FINSI;
|HAZ lee_epig_enfe;
|SI antempre ! #7#0;   || RUPTURA POR EMPRESA
    |HAZ empresas;            || graba en la plantilla en la empresa
    |HAZ centros;             || graba en la plantilla en el centro
    |HAZ rup_epigr;           || graba epigrafe y linea de total
    |HAZ rup_enfer;           || graba epigrafe enfermedad y linea de total
    |SI siono_cen = "S";
        |HAZ lee_notar;
    |FINSI;
    |HAZ auxiliar;            || graba en aux. de empresas
    ||PIEINF;                  || imprime pie
    ||FININF;                  || cierra informe
    |HAZ adjuntar;            || lanza, en su caso, la relacion adjunta
    |HAZ limpieza;            || inicializa variables acumuladoras
    |HAZ vacibusc;            || borra tabla de nro. de TC's 2/1
    |HAZ inicio;              || abre informe
        antbonif = -1;
        antepigr = #7#26;
        antcentr = #7#14;
|SINO;
    |SI antcentr ! #7#14;          || RUPTURA POR CENTRO DE TRABAJO
        |HAZ centros;              || graba en la plantilla en el centro
        |SI siono_cen = "S";
            |HAZ rup_epigr;        || graba epigrafe y linea de total
            |HAZ rup_enfer;        || graba epigrafe enfermedad y linea de total
            |HAZ lee_notar;        || lee centros de notarias
            |HAZ auxiliar;         || graba en aux. de empresas
            ||PIEINF;               || imprime pie
            ||FININF;               || cierra informe
            |HAZ limpieza;         || inicializa variables acumuladoras
            |HAZ vacibusc;         || borra tabla de nro. de TC's 2/1
            |HAZ inicio;           || abre informe
                antbonif = -1;
                antepigr = #7#26;
        |FINSI;
            antcentr = #7#14;
    |FINSI;
|FINSI;

|SI antepigr ! #7#26;          || RUPTURA POR EPIGRAFE
    |HAZ rup_epigr;
        antepigr = #7#26;
|FINSI;

|SI antbonif ! #7#35;          || RUPTURA POR BONIFICACION
        #8#0 = #7#35;
        antbonif = #7#35;
    |LEE 001#8=;
    |SI FSalida = 0; |Y #8#0 ! 0;  || si esta y no es cero
            nMes = #0#2;
            nAny = #0#3;
            nCodigoBon = #8#0;
            |HAZ VerifBonif;

            swenfer = 0;
            swepigr = 0;
            swdetal = 0;
            swbonif = 1;       || carga el switch de impresion de bonificacion
            desboni = #8#1;    || carga en variable la descripcion
        ||PRINT;
        |SI #8#10 = 1; |O #8#10 = 4;   |HAZ cuentc21; |FINSI;   || solo las reducciones
    |SINO;
        |DDEFECTO #8;          || si no existe o es cero limpia los campos
    |FINSI;
|FINSI;
    swbonif = 0;
    swenfer = 0;
    swepigr = 0;
    swdetal = 1;
    #5#0 = #7#0;    #5#1 = #7#39;  |LEE 020#5=;   || lee el trabajador
    |HAZ EpigAtrasos;
|HAZ acum_epigrafes;
    t_06 = t_06 + #7#25;            || acumula total bases contingencias comunes
    t_07 = t_07 + (#7#27 + #7#37);  || acumula total bases desempleo + enferm.
    t_08 = t_08 + #7#28;            || acumula total bases horas 1
    t_09 = t_09 + #7#29;            || acumula total bases horas 2
    t_10 = t_10 + #7#30;            || acumula total ayuda familiar
    t_11 = t_11 + #7#31;            || acumula total ayuda subnormalidad
    t_12 = t_12 + #7#32;            || acumula total dto. enfermedad
    t_14 = t_14 + #7#34;            || acumula total dto. accid. trabaj.

    #5#0 = #7#0;    #5#1 = #7#39;  |LEE 020#5=;   || lee el trabajador

|HAZ bonifica;
||SI sw_reductor = 0;
        ||t_aux1 = t_aux1 + #7#25; || acumula si coef.reduc. NO (para aux.empre)
        t_aux1 = t_aux1 + (#7#25 - #7#61); || acumula si coef.reduc. NO (para aux.empre)
||SINO;
        t_aux2 = t_aux2 + #7#61 + #7#67; || acumula si coef.reduc. SI (para aux.empre)
||FINSI;

|SI #5#112 = "S";
        t_aux3 = t_aux3 + #7#25; || acumula si Ley 12/2001 (ctos.<7 dias)
|FINSI;

     |SI #7#101 ! 0;
          t_aux7b = t_aux7b + #7#25;  || base cot. solidaridad
          t_aux7c = t_aux7c + #7#101; || cuota cot. solidaridad
     |FINSI;

     p_cont = 0;
     |SI #5#45 = "422";
          p_cont = 422;
     |FINSI;

||SI #7#48 ! 2;  mas = 1;  |SINO;  mas = 0;  |FINSI;    || finiquito o no
    mas = 1;        || ahora siempre cuenta 1, aunque sean finiquitos (26.09.2003-RPC)

    t_traba = t_traba + mas;       || acumula nro. trabajadores empresas
    t_trcen = t_trcen + mas;       || acumula nro. trabajadores centros

|SI #7#13 = "X";
        t_altas = t_altas + mas;  t_bajas = t_bajas + mas;
        t_altce = t_altce + mas;  t_bajce = t_bajce + mas;
|FINSI;
|SI #7#13 = "A";  t_altas = t_altas + mas;  t_altce = t_altce + mas;  |FINSI;
|SI #7#13 = "B";  t_bajas = t_bajas + mas;  t_bajce = t_bajce + mas;  |FINSI;
|SI #7#38 = "E";
        t_enfe2 = t_enfe2 + mas;   || acumula nro. trabajadores enfermos
|SINO;
        t_epig2 = t_epig2 + mas;   || acumula nro. trabajadores por epigrafe
|FINSI;


|SI #7#22 = 97;
        fech1 = #5#36;
    |SI fech1 < "17.05.1997";
          || nada , esto ya no se dara nunca
    |SINO;
        |SI #7#30 ! 0;
            n85 = n85 + mas;
        |FINSI;
    |FINSI;
|FINSI;
||SI #7#22 = 87;               n85Mat = n85Mat + mas;    |FINSI;
|| 87 ya no existe
     |SI #7#22 = 85; |O #7#22 = 421; |O #7#22 = 422;
          |SI #7#30 ! 0;
               n85 = n85 + mas;
               |SI #labtraba#190 = "S";
                    n85Des = n85Des + mas;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #labtraba#191 = "S"; |O #labtraba#191 = "T";
          |SI #7#30 = 0;           || si es cero la cuota de comunes
          |Y #7#89 ! 0;            || si esta a cero es porque son dos fichas
                                   || de un mismo trabajdor y no tengo que contarlo
               n85 = n85 + mas;
               |SI #labtraba#190 = "S";
                    n85Des = n85Des + mas;
               |FINSI;
          |FINSI;
     |FINSI;

|SI #7#22 = 64;               n64 = n64 + #7#25;  |FINSI;
|SI #7#22 = 65;               n65 = n65 + #7#25;  |FINSI;

|SI #7#25 ! 0;|O #7#27 ! 0; |O #7#67 ! 0;
        haentrat = 1;
    ||PRINT;                        || LINEA DE DETALLE
|FINSI;

|SI #7#48 ! 2;                         || lineas de suplemento NO en finiquito
    |SI #7#37 ! 0;                     || LINEA DE ENFERMEDAD
            swbonif = 0; swepigr = 0;
            swdetal = 0; swenfer = 1;  || carga el switch de linea de enfermedad
            t_enfe0 = #7#36;           || guarda el epigrafe de enfermedad
        |HAZ acum_epigenfe;
        ||PRINT;
    |SINO;
        |SI #7#40 ! "                      "; |O #7#41 ! 0; |O #7#42 ! 0;
                swbonif = 0; swepigr = 0;
                swdetal = 0; swenfer = 1;
                pp14 = #7#14; pp15 = #7#15; pp16 = #7#16; pp17 = #7#17;
                pp18 = #7#18; pp36 = #7#36; pp37 = #7#37;
                #7#14 =  0; #7#15 = ""; #7#16 = ""; #7#17 = "";  || chapuzilla !!!
                #7#18 = ""; #7#36 =  0; #7#37 =  0;
            ||PRINT;
                #7#14 = pp14; #7#15 = pp15; #7#16 = pp16; #7#17 = pp17;
                #7#18 = pp18; #7#36 = pp36; #7#37 = pp37;
        |FINSI;                        || imprime suplemento !!!
    |FINSI;
|FINSI;
|FPRC;

|PROCESO entrat;
|HAZ limpieza;
    antempre = -1;
    antcentr = -1;
    antbonif = -1;  || inicializa variables para rupturas
    antepigr = -1;
|HAZ vacibusc;
    haentrat = 0;
|FPRC;
____________________________________/ LECTURAS POR CENTRO
|| Empresa, Centro, Bonificacion, Epigrafe, Provincia, S.S., Trabajador

|DEFBUCLE nomyytc21;                         || todos
 #7#1;
 ;
 "S",     0,  0,   0,   0, bot3,     0, dtipo;
 "S", 99999, 99, 999, 999, top3, 99999, htipo;
 ;
 entrat, impresion, NULL, NULL, pie_tc2;
|FIN;

|DEFBUCLE nomyyxx21;                         || aprendices y tiempo parcial
 #7#1;
 22;
 "S",     0,   0,  0,   0, bot3,     0, dtipo, d_con;
 "S", 99999, 999, 99, 999, top3, 99999, htipo, h_con;
 ;
 entrat, impresion, NULL, NULL, pie_tc2;
|FIN;
____________________________________/ LECTURAS POR EMPRESA
|| Empresa, Bonificacion, Epigrafe, Provincia, S.S., Trabajador, Centro

|DEFBUCLE nomyytc22;                         || todos
 #7#2;
 ;
 "N",     0,   0,   0, bot3,     0,  0, dtipo;
 "N", 99999, 999, 999, top3, 99999, 99, htipo;
 ;
 entrat, impresion, NULL, NULL, pie_tc2;
|FIN;

|DEFBUCLE nomyyxx22;                    || aprendices y tiempos parcial
 #7#2;
 22;
 "N",     0,   0,   0, bot3,     0,  0, dtipo, d_con;
 "N", 99999, 999, 999, top3, 99999, 99, htipo, h_con;
 ;
 entrat, impresion, NULL, NULL, pie_tc2;
|FIN;

____________________________________/ CALCULO PRINCIPAL
|PROCESO el_bucle;
    dtipo = 0;    htipo = 9;
|PARA; |SI; |HACIENDO;
        sw_red = 0;
    |SI dtipo = 0;                                sw_red = 1;    |FINSI;
    ||SI dtipo = 0; |Y s_pas [ 3;                  sw_red = 1;    |FINSI;
    ||SI dtipo = 10;|Y s_pas ] 4;|Y s_tipd ! "N";  sw_red = 1;    |FINSI;
    |SI sw_red = 1;
        |SI siono_cen = "S";
            |SI s_pas = 1;|O s_pas = 4;
                |SI s_ori ! "C";
                     pregunta = -1;  tip = 0;  |BUCLE nomyytc21; || todos
                |SINO;
                     pregunta = -1;  tip = 3;  |BUCLE nomyytc21; || todos
                |FINSI;
            |FINSI;

            |SI s_pas = 2;|O s_pas = 5;
                pregunta = 87;  tip = 8;
                d_con = 85;   h_con = 422; |BUCLE nomyyxx21; || 87
            |FINSI;

            |SI s_pas = 3;|O s_pas = 6;
                pregunta = 64;  tip = 9;
                d_con = 64;   h_con = 65; |BUCLE nomyyxx21; || 64
            |FINSI;
        |FINSI;

        |SI siono_cen = "N";
            |SI s_pas = 1;|O s_pas = 4;
                |SI s_ori ! "C";
                     pregunta = -1;  tip = 0;  |BUCLE nomyytc22; || todos
                |SINO;
                     pregunta = -1;  tip = 3;  |BUCLE nomyytc22; || todos
                |FINSI;
            |FINSI;

            |SI s_pas = 2;|O s_pas = 5;
                pregunta = 87;  tip = 8;
                d_con = 85;   h_con = 422; |BUCLE nomyyxx22; || 87
            |FINSI;

            |SI s_pas = 3;|O s_pas = 6;
                pregunta = 64;  tip = 9;
                d_con = 64;   h_con = 65; |BUCLE nomyyxx22; || 64
            |FINSI;
        |FINSI;

    |FINSI;
    |SI dtipo = 0;
            dtipo = 10;   htipo = 19;
    |SINO;
        |SAL;
    |FINSI;
|SIGUE;
|FPRC;

|PROCESO principal;
        swBorra = 0;
        |HAZ borrado;   || borra auxiliares
        |NOME_DAT #7 temp2;
        |DELINDEX #7;
        |NOME_DAT #15 temp6;
        |DELINDEX #15;
        |ABRET #1;      || empresas
        |ABRET #3;      || constantes
        |ABRET #5;      || trabajadores
        |ABRET #7;      || campos (tmp)
        |ABRET #10;     || centros trabajo
        |ABRET #15;     || tc1 solo
        |ABRET #16;     || convenios cabs.
        |ABRET #111;     || tmp contador de trabajadores
        |HAZ temporal0;
        |CIERRAT #1;
        |CIERRAT #3;
        |CIERRAT #7;
        |CIERRAT #10;
        |CIERRAT #16;
        |CIERRAT #111;

        |ABRET #2;      || aux. empresas
        |ABRET #8;      || bonificaciones
        |ABRET #9;      || epigrafes
        |ABRET #11;     || epigrafes/trabajador
        |HAZ el_bucle;
        |CIERRAT #2;
        |CIERRAT #5;
        |CIERRAT #8;
        |CIERRAT #9;
        |CIERRAT #11;
        |CIERRAT #15;
|FPRC;
____________________________________/ VARIOS
|PROCESO limpieza;
    t_enfe1 = 0;
    t_enfe2 = 0;
    t_enfe3 = 0;
    t_enfe4 = 0;
    t_cuetp = 0;
    t_cueto = 0;
    t_06 = 0;
    t_07 = 0;
    t_08 = 0;
    t_09 = 0;
    t_10 = 0;
    t_11 = 0;
    t_12 = 0;
    t_14 = 0;
    t_aux1 = 0;
    t_aux2 = 0;
    t_aux3 = 0;
    t_aux7b = 0;
    t_aux7c = 0;
    p_cont = 0;
    tc21 = 0;
    n85Mat = 0;
    n85 = 0;
    n85Des = 0;
    n85DesMat = 0;
    n64 = 0;
    n65 = 0;
|FPRC;

|PROCESO vacibusc;   || limpia la tabla busca y su puntero
|SI puntero = 0;
        puntero = 99;
|FINSI;
|PARA punt = 0; |SI punt < puntero; |HACIENDO punt = punt + 1;
    Ibusca = busca1 <-;
    Ibusca = Ibusca + punt;
     busca = 0;
|SIGUE;
    puntero = 0;
|FPRC;

|PROCESO cuentc21; || busca en la tabla la bonific. para ver si ya esta contada
    ya = 0;
|PARA punt = 0; |SI punt < puntero; |HACIENDO punt = punt + 1;
        Ibusca = busca1 <-;
        Ibusca = Ibusca + punt;
    |SI busca = #7#35;  ya = 1;  |FINSI;
|SIGUE;
|SI ya = 0;
        Ibusca = busca1 <-;
        Ibusca = Ibusca + puntero;
        busca = #7#35;
    |SI #8#03 ! 0;
            tc21 = tc21 + 1;   || numero de TC2/1 por empresa
    |FINSI;
    |SI #8#11 = "S";
            tc21 = tc21 + 1;   || a¤ade el de subv. tecnol.
    |FINSI;
        puntero = puntero + 1;
|FINSI;
|FPRC;

|PROCESO inicio;    || ABRE INFORME PARA NUEVA EMPRESA, CARGA VARIABLES
                    || /Y BORRA SU AUXILIAR DE EPIGRAFES
    #15#0 = #7#0;
|SI siono_cen = "S";     #15#1 = #7#14; |FINSI;
|SI siono_cen = "N";     #15#1 = 99;    |FINSI;
    #15#2 = tip + dtipo;
    #15#3 = #0#3 $ 100;
    #15#4 = #0#2;
|LEE 000#15=;
|SI FSalida = 0;|Y #15#5 = "S";
        sw_abierto = 1;
    ||INFOR c_informe;
|SINO;
        sw_abierto = 0;
|FINSI;
    antempre = #7#00;  antnombr = #7#01;  antdirec = #7#04;
    antcodig = #7#05;  antlocal = #7#06;  antmutua = #7#03;
    antmutco = #7#02;  antcif   = #7#07;  antcuent = #7#45;
|FPRC;

|PROCESO lee_notar;
|DDEFECTO #12;
|ABRE #12;
    #12#0 = antempre;    || empresa
    #12#1 = antcentr;    || centro
|LEE 000#12=;
|CIERRA #12;
    notaria = #12#2 + #12#3;
|FPRC;
____________________________________/ CALCULOS DE PANTALLA
|PROCESO defecto; |TIPO 7;
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % -104;
    #0Campo = alfa1;
    #0Campo = #0Campo - menos;
|PINTA #0Campo;
|FPRC;

|PROCESO pintames; |TIPO 0;
|SI #0Campo =  1;  p_mes = "ENERO     ";  |FINSI;
|SI #0Campo =  2;  p_mes = "FEBRERO   ";  |FINSI;
|SI #0Campo =  3;  p_mes = "MARZO     ";  |FINSI;
|SI #0Campo =  4;  p_mes = "ABRIL     ";  |FINSI;
|SI #0Campo =  5;  p_mes = "MAYO      ";  |FINSI;
|SI #0Campo =  6;  p_mes = "JUNIO     ";  |FINSI;
|SI #0Campo =  7;  p_mes = "JULIO     ";  |FINSI;
|SI #0Campo =  8;  p_mes = "AGOSTO    ";  |FINSI;
|SI #0Campo =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
|SI #0Campo = 10;  p_mes = "OCTUBRE   ";  |FINSI;
|SI #0Campo = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
|SI #0Campo = 12;  p_mes = "DICIEMBRE ";  |FINSI;
|PINTA 1335, p_mes;
|FPRC;

|PROCESO mirames; |TIPO 7; ||calcula el mes por defecto segun fecha sistema
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
    #0Campo = #0Campo - 1;
    menos = 0;
|SI #0Campo = 0;
        #0Campo = 12;
        menos = 1;
|FINSI;
|PINTA #0Campo;
|FPRC;
____________________________________/ GRABACION DEL TEMPORAL (incluye)
|PROCESO temporal1;
|HAZ temporal2;
|FPRC;

|DEFBUCLE nomyytc20;
 #6#1;
 ;
 #0#0,     0, #0#2, 0;
 #0#1, 99999, #0#2, 2;
 e;
 NULL, temporal1;
|FIN;

|PROCESO temporal0;
|BUCLE nomyytc20;
|FPRC;
____________________________________/ INICIO Y FIN DEL PROCESO
|PROCESO control;
|DDEFECTO #36;
|ABRE #36;
|LEE 000#36p;
|CIERRA #36;
|FPRC;

|PROGRAMA;
     #0#0 = s_emp;
     #0#1 = s_emp;
     #0#2 = s_mes;
     #0#3 = s_any;
     runnom = s_nom;
     anyonum = #0#3;
     siono_cen = s_cen;

     |SI s_anyl ] 2007;
          |NOME_DAT #9 aTempEpig;
     |FINSI;
     |NOME_DAT #2 temp4;      || aux.empresas
     |NOME_DAT #4 temp5;      || aux.epigrafes
     |NOME_DAT #6 temp3;      || calculos cabs.
     |HAZ control;
     |HAZ principal;
|FPRO;
_________________________/ BORRA AUXILIARES
|PROCESO h_bor_empresa1;
swBorra = 1;
|SI s_ori = "H"; |O s_ori = "C";
     |SI eaTipoLi = "F"; |O s_tat = 2; |ACABA; |FINSI;
     |SI s_pas = 1;|Y #52#2 = 0;  |BORRA 020#52a; |FINSI;
     |SI s_pas = 1;|Y #52#2 = 2;  |BORRA 020#52a; |FINSI;   || finiquitos
     |SI s_pas = 1;|Y #52#2 = 3;  |BORRA 020#52a; |FINSI;   || complementarias
     |SI s_pas = 4;|Y #52#2 = 10; |BORRA 020#52a; |FINSI;
     |SI s_pas = 2;|Y #52#2 = 8;  |BORRA 020#52a; |FINSI;
     |SI s_pas = 5;|Y #52#2 = 18; |BORRA 020#52a; |FINSI;
     |SI s_pas = 3;|Y #52#2 = 9;  |BORRA 020#52a; |FINSI;
     |SI s_pas = 6;|Y #52#2 = 19; |BORRA 020#52a; |FINSI;
|FINSI;
|SI s_ori = "T";
     |SI s_pas = 1;|Y #52#2 = 5;  |BORRA 020#52a; |FINSI;
     |SI s_pas = 4;|Y #52#2 = 15; |BORRA 020#52a; |FINSI;
     |SI s_pas = 2;|Y #52#2 = 6;  |BORRA 020#52a; |FINSI;
     |SI s_pas = 5;|Y #52#2 = 16; |BORRA 020#52a; |FINSI;
     |SI s_pas = 3;|Y #52#2 = 7;  |BORRA 020#52a; |FINSI;
     |SI s_pas = 6;|Y #52#2 = 17; |BORRA 020#52a; |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE h_bor_empresa;
 #52#1;
 50;
 #0#0,  0, any_hist, desde_mes,  0, "G";
 #0#1, 99, any_hist, hasta_mes, 19, "G";
 ;
 NULL, h_bor_empresa1;
|FIN;

|PROCESO h_bor_epi1cd;
     ||SI swBorra ! 1;
          ||ACABA;   || solo borra si ha entrado en el bucle de borrar empresas
     ||FINSI;        || para que no borre los agrarios
     |SI s_ori = "H";
          |SI eaTipoLi = "F"; |O s_tat = 2;
               |SI s_pas = 1;|Y #nomwepcd#9 = 2;  |BORRA 020#nomwepcd.a; |FINSI;
          |SINO;
               |SI s_pas = 1;|Y #nomwepcd#9 = 0;  |BORRA 020#nomwepcd.a; |FINSI;
               |SI s_pas = 4;|Y #nomwepcd#9 = 10; |BORRA 020#nomwepcd.a; |FINSI;
               |SI s_pas = 2;|Y #nomwepcd#9 = 8;  |BORRA 020#nomwepcd.a; |FINSI;
               |SI s_pas = 5;|Y #nomwepcd#9 = 18; |BORRA 020#nomwepcd.a; |FINSI;
               |SI s_pas = 3;|Y #nomwepcd#9 = 9;  |BORRA 020#nomwepcd.a; |FINSI;
               |SI s_pas = 6;|Y #nomwepcd#9 = 19; |BORRA 020#nomwepcd.a; |FINSI;
          |FINSI;
     |FINSI;
     |SI s_ori = "T";
          |SI s_pas = 1;|Y #nomwepcd#9 = 5;  |BORRA 020#nomwepcd.a; |FINSI;
          |SI s_pas = 4;|Y #nomwepcd#9 = 15; |BORRA 020#nomwepcd.a; |FINSI;
          |SI s_pas = 2;|Y #nomwepcd#9 = 6;  |BORRA 020#nomwepcd.a; |FINSI;
          |SI s_pas = 5;|Y #nomwepcd#9 = 16; |BORRA 020#nomwepcd.a; |FINSI;
          |SI s_pas = 3;|Y #nomwepcd#9 = 7;  |BORRA 020#nomwepcd.a; |FINSI;
          |SI s_pas = 6;|Y #nomwepcd#9 = 17; |BORRA 020#nomwepcd.a; |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE h_bor_epicd;   || CLAVE: Emp, Anyo, Mes, Trab, Centro, Epig, Tipo
 #nomwepcd#1;
 ;
 #0#0, any_hist, desde_mes, 00001,  0,   0,  0;
 #0#1, any_hist, hasta_mes, 99999, 99, 999, 19;
 ;
 NULL, h_bor_epi1cd;
|FIN;

|PROCESO h_bor_epi1;
|SI swBorra ! 1;
     |ACABA;   || solo borra si ha entrado en el bucle de borrar empresas
|FINSI;        || para que no borre los agrarios
|SI s_ori = "H";
     |SI eaTipoLi = "F"; |O s_tat = 2; |ACABA; |FINSI;
     |SI s_pas = 1;|Y #53#9 = 0;  |BORRA 020#53a; |FINSI;
     |SI s_pas = 1;|Y #53#9 = 2;  |BORRA 020#53a; |FINSI;   || finiquitos
     |SI s_pas = 4;|Y #53#9 = 10; |BORRA 020#53a; |FINSI;
     |SI s_pas = 2;|Y #53#9 = 8;  |BORRA 020#53a; |FINSI;
     |SI s_pas = 5;|Y #53#9 = 18; |BORRA 020#53a; |FINSI;
     |SI s_pas = 3;|Y #53#9 = 9;  |BORRA 020#53a; |FINSI;
     |SI s_pas = 6;|Y #53#9 = 19; |BORRA 020#53a; |FINSI;
|FINSI;
|SI s_ori = "T";
     |SI s_pas = 1;|Y #53#9 = 5;  |BORRA 020#53a; |FINSI;
     |SI s_pas = 4;|Y #53#9 = 15; |BORRA 020#53a; |FINSI;
     |SI s_pas = 2;|Y #53#9 = 6;  |BORRA 020#53a; |FINSI;
     |SI s_pas = 5;|Y #53#9 = 16; |BORRA 020#53a; |FINSI;
     |SI s_pas = 3;|Y #53#9 = 7;  |BORRA 020#53a; |FINSI;
     |SI s_pas = 6;|Y #53#9 = 17; |BORRA 020#53a; |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE h_bor_epi;
 #53#1;
 ;
 #0#0,  0, any_hist, desde_mes,   0,  0;
 #0#1, 99, any_hist, hasta_mes, 999, 19;
 ;
 NULL, h_bor_epi1;
|FIN;

|PROCESO bor_empresa1;
swBorra = 1;
|SI s_ori = "M";|O s_ori = "H";
     |SI eaTipoLi = "F"; |O s_tat = 2; |ACABA; |FINSI;
     |SI s_pas = 1;|Y #2#2 = 0;  |BORRA 020#2a; |FINSI;
     |SI s_pas = 1;|Y #2#2 = 2;  |BORRA 020#2a; |FINSI;     || finiquitos
     |SI s_pas = 4;|Y #2#2 = 10; |BORRA 020#2a; |FINSI;
     |SI s_pas = 2;|Y #2#2 = 8;  |BORRA 020#2a; |FINSI;
     |SI s_pas = 5;|Y #2#2 = 18; |BORRA 020#2a; |FINSI;
     |SI s_pas = 3;|Y #2#2 = 9;  |BORRA 020#2a; |FINSI;
     |SI s_pas = 6;|Y #2#2 = 19; |BORRA 020#2a; |FINSI;
|FINSI;
|SI s_ori = "A";|O s_ori = "T";
     |SI s_pas = 1;|Y #2#2 = 5;  |BORRA 020#2a; |FINSI;
     |SI s_pas = 4;|Y #2#2 = 15; |BORRA 020#2a; |FINSI;
     |SI s_pas = 2;|Y #2#2 = 6;  |BORRA 020#2a; |FINSI;
     |SI s_pas = 5;|Y #2#2 = 16; |BORRA 020#2a; |FINSI;
     |SI s_pas = 3;|Y #2#2 = 7;  |BORRA 020#2a; |FINSI;
     |SI s_pas = 6;|Y #2#2 = 17; |BORRA 020#2a; |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE bor_empresa;
 #2#1;
 50;
 #0#0,  0, desde_mes,  0, "G";
 #0#1, 99, hasta_mes, 19, "G";
 ;
 NULL, bor_empresa1;
|FIN;

|PROCESO bor_epi1cd;
     ||SI swBorra ! 1;
          ||ACABA;   || solo borra si ha entrado en el bucle de borrar empresas
     ||FINSI;        || para que no borre los agrarios
     |SI s_ori = "M";|O s_ori = "H";
          |SI eaTipoLi = "F"; |O s_tat = 2;
               |SI s_pas = 1;|Y #nomtepcd#9 = 2;  |BORRA 020#nomtepcd.a; |FINSI;
          |SINO;
               |SI s_pas = 1;|Y #nomtepcd#9 = 0;  |BORRA 020#nomtepcd.a; |FINSI;
               |SI s_pas = 4;|Y #nomtepcd#9 = 10; |BORRA 020#nomtepcd.a; |FINSI;
               |SI s_pas = 2;|Y #nomtepcd#9 = 8;  |BORRA 020#nomtepcd.a; |FINSI;
               |SI s_pas = 5;|Y #nomtepcd#9 = 18; |BORRA 020#nomtepcd.a; |FINSI;
               |SI s_pas = 3;|Y #nomtepcd#9 = 9;  |BORRA 020#nomtepcd.a; |FINSI;
               |SI s_pas = 6;|Y #nomtepcd#9 = 19; |BORRA 020#nomtepcd.a; |FINSI;
          |FINSI;
     |FINSI;
     |SI s_ori = "A";|O s_ori = "T";
          |SI s_pas = 1;|Y #nomtepcd#9 = 5;  |BORRA 020#nomtepcd.a; |FINSI;
          |SI s_pas = 4;|Y #nomtepcd#9 = 15; |BORRA 020#nomtepcd.a; |FINSI;
          |SI s_pas = 2;|Y #nomtepcd#9 = 6;  |BORRA 020#nomtepcd.a; |FINSI;
          |SI s_pas = 5;|Y #nomtepcd#9 = 16; |BORRA 020#nomtepcd.a; |FINSI;
          |SI s_pas = 3;|Y #nomtepcd#9 = 7;  |BORRA 020#nomtepcd.a; |FINSI;
          |SI s_pas = 6;|Y #nomtepcd#9 = 17; |BORRA 020#nomtepcd.a; |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE bor_epicd;   || CLAVE: Emp, Mes, Trab, Centro, Epig, Tipo
 #nomtepcd#1;
 ;
 #0#0, desde_mes, 00001,  0,   0,  0;
 #0#1, hasta_mes, 99999, 99, 999, 19;
 ;
 NULL, bor_epi1cd;
|FIN;

|PROCESO bor_epi1;
|SI swBorra ! 1;
     |ACABA;   || solo borra si ha entrado en el bucle de borrar empresas
|FINSI;        || para que no borre los agrarios
|SI s_ori = "M";|O s_ori = "H";
     |SI eaTipoLi = "F"; |O s_tat = 2; |ACABA; |FINSI;
     |SI s_pas = 1;|Y #4#9 = 0;  |BORRA 020#4a; |FINSI;
     |SI s_pas = 1;|Y #4#9 = 2;  |BORRA 020#4a; |FINSI;     || finiquitos
     |SI s_pas = 4;|Y #4#9 = 10; |BORRA 020#4a; |FINSI;
     |SI s_pas = 2;|Y #4#9 = 8;  |BORRA 020#4a; |FINSI;
     |SI s_pas = 5;|Y #4#9 = 18; |BORRA 020#4a; |FINSI;
     |SI s_pas = 3;|Y #4#9 = 9;  |BORRA 020#4a; |FINSI;
     |SI s_pas = 6;|Y #4#9 = 19; |BORRA 020#4a; |FINSI;
|FINSI;
|SI s_ori = "A";|O s_ori = "T";
     |SI s_pas = 1;|Y #4#9 = 5;  |BORRA 020#4a; |FINSI;
     |SI s_pas = 4;|Y #4#9 = 15; |BORRA 020#4a; |FINSI;
     |SI s_pas = 2;|Y #4#9 = 6;  |BORRA 020#4a; |FINSI;
     |SI s_pas = 5;|Y #4#9 = 16; |BORRA 020#4a; |FINSI;
     |SI s_pas = 3;|Y #4#9 = 7;  |BORRA 020#4a; |FINSI;
     |SI s_pas = 6;|Y #4#9 = 17; |BORRA 020#4a; |FINSI;
|FINSI;
|FPRC;


|DEFBUCLE bor_epi;
 #4#1;
 ;
 #0#0,  0, desde_mes,   0,  0;
 #0#1, 99, hasta_mes, 999, 19;
 ;
 NULL, bor_epi1;
|FIN;

|PROCESO borrado;
     |SI s_ori = "T";         || en Atrasos desde el Hco, que borre todos
          desde_mes = 1;      || los registros de esa emp/cen/tipo (5)/a¤o
          hasta_mes = 12;     || si no luego habra problemas al emitir pq
     |SINO;                   || puede acumular importes que no corresponden
          desde_mes = #0#2;
          hasta_mes = #0#2;
     |FINSI;
     |SI s_ori = "M"; |O s_ori = "A";
          |NOME_DAT #2 "labempax";      || aux.empresas
          |NOME_DAT #4 "nomtepig";      || aux.epigrafes

          |BUCLE bor_empresa;
          |BUCLE bor_epi;
          |BUCLE bor_epicd;

          |NOME_DAT #2 temp4;           || aux.empresas
          |NOME_DAT #4 temp5;           || aux.epigrafes
     |FINSI;

     |SI s_ori = "H"; |O s_ori = "T"; |O s_ori = "C";
          |BUCLE h_bor_empresa;
          |BUCLE h_bor_epi;
          |BUCLE h_bor_epicd;
     |FINSI;

     |SI aParam = "TC2";
          |SI s_ori = "M";|O s_ori = "A";
               |NOME_DAT #2 "labempax";      || aux.empresas
               |NOME_DAT #4 "nomtepig";      || aux.epigrafes
               |BUCLE bor_empresa;
               |BUCLE bor_epi;
               |BUCLE bor_epicd;
               |NOME_DAT #2 temp4;           || aux.empresas
               |NOME_DAT #4 temp5;           || aux.epigrafes
          |FINSI;
          |SI s_ori = "H";|O s_ori = "T";
               |BUCLE h_bor_empresa;
               |BUCLE h_bor_epi;
               |BUCLE h_bor_epicd;
          |FINSI;
     |FINSI;
     alfa1 = Usuario;  |QBF alfa1;    alfa1 = "rr" + alfa1;
     |NOME_DAT #111 alfa1;         || tmp contador de trabajadores
     |DELINDEX #111;   || Se carga el temporal que pudiera existir
|FPRC;

|PROCESO cuenta_trab;
     nTrab = nTrab + 1;
|FPRC;

|DEFBUCLE cuenta_trab;
     #111#1;
     ;
     #2#0, #2#18, #2#1, #2#2, "            ";
     #2#0, #2#18, #2#1, #2#2, "zzzzzzzzzzzz";
     ;
     NULL, cuenta_trab;
|FIN;

|PROCESO cuentalo;
     || desde 11/09/03 esto no lo usamos, el #2#13 que grabamos aqui luego ya
     || no se usa
     nTrab = 0;
     |BUCLE cuenta_trab;
|FPRC;

____________________________________/ GRABA AUX. DE EMPRESAS Y EPIGRAFES
|PROCESO auxiliar;
|DDEFECTO #2;
    #2#00 = antempre;         || codigo empresa
|SI siono_cen = "S";   #2#18 = antcentr;   |FINSI;     || centro trabajo SI
|SI siono_cen = "N";   #2#18 = 99;         |FINSI;     || centro trabajo NO
    #2#01 = #0#2;             || mes
    #2#02 = tip + dtipo;      || tipo
|LEE 101#2=;
    FEstado = FSalida;
    #2#03 = #2#03 + t_aux1;   || contingencias generales 101
    #2#04 = #2#04 + t_aux2;   || contingencias especiales 105
    #2#05 = #2#05 + t_08;     || horas extra 102
    #2#06 = #2#06 + t_09;     || horas extra 103
    #2#09 = #2#09 + t_12;     || compens.enfer.comun 201
    #2#10 = #2#10 + t_14;     || compens.accid.trab. 410
    #2#11 = 0;                || reducciones 209
    #2#12 = 0;                || bonif./subven. 601
    #2#15 = 0;                || compensacion desempleo parcial 602
    #2#16 = notaria;          || (%) deducc.notarias
    #2#17 = 0;                || clave 201/209
    |HAZ cuentalo;            || proceso para contar nro. trabajadores
    #2#13 = nTrab;            || nro. trabajadores
    #2#20 = 0;                || importe a pagar TC1
    #2#46 = n85Mat;           || nro. trabajadores 85 con Maternidad
    #2#47 = n85;              || nro. trabajadores 85
    #2#81 = n85Des;           || nro. trabajadores 85 con desempleo
    #2#82 = n85DesMat;        || nro. trabajadores 85 con desempleo y Maternidad
    #2#48 = n64;              || nro. trabajadores 64
    #2#49 = n65;              || nro. trabajadores 65
    #2#51 = #2#51 + t_aux3;   || contingencias comunes 106 (ctos.<7dias)
    #2#96 = #2#96 + t_aux7b;   || base cot. solidaridad
    #2#97 = #2#97 + t_aux7c;   || cuota cot. solidaridad

|HAZ abreviado;
     |SI p_cont = 422;     || para marcar que es un centro de becarios
          #2#34 = "422";
     |FINSI;

|SI FEstado ! 0;  |GRABA 020#2n;  |FINSI;
|SI FEstado = 0;  |GRABA 020#2a;  |FINSI;
|LIBERA #2;
    notaria = 0;
|FPRC;

|PROCESO epigrafe;       || GRABA EN FICHERO DE EPIGRAFES PARA TC1
|DDEFECTO #4;
|ABRET #4;
    #4#0 = antempre;               || empresa
    #4#1 = #0#2;                   || mes
    #4#2 = t_epigr;                || epigrafe
    #4#9 = tip + dtipo;            || tipo
|SI siono_cen = "S";  #4#10 = antcentr;  |FINSI;       || centro
|SI siono_cen = "N";  #4#10 = 99;        |FINSI;
|LEE 101#4=;
    FEstado = FSalida;
|SI FEstado ! 0;
        t_epig4 = t_epig4 + 1;     || contador de epigr.diferentes empresa
|FINSI;
    #4#5 = #4#5 + t_epig0;         || base contingencias
    #4#14 = #4#14 + t_epigd;       || base conting. en maternidad (Cot.Emp.)
    #4#15 = #4#15 + t_epige;       || total base bonif. RDL 16/2001 2.2.1
    #4#6 = #4#6 + t_epig2;         || nro. trabajadores
    #4#7 = #4#7 + t_epigb;         || cuota ILT
    #4#8 = #4#8 + t_epigc;         || cuota IMS
    #4#3 = (#4#7 * 100) / #4#5;    || (%) ILT
    #4#4 = (#4#8 * 100) / #4#5;    || (%) IMS
    #4#12 = #4#12 + t_puotp;       || cuota patronal desempleo
    #4#13 = #4#13 + t_puoto;       || cuota obrera desempleo
    #4#16 = #4#16 + t_puotm;       || cuota C.C. maternidad
    #4#18 = #4#18 + t_puotm2;      || cuota C.C. maternidad parte obrera
    #4#19 = #4#19 + t_epigf;       || base conting. en Exp.Reg.Emp(Cot.Emp.)
    #4#20 = #4#20 + t_puotx;       || cuota conting. en Exp.Reg.Emp(Cot.Emp.)
    #4#22 = #4#22 + t_puot_ere_ilt;       || cuota ILT en Exp.Reg.Emp.
    #4#23 = #4#23 + t_puot_ere_ims;       || cuota IMS en Exp.Reg.Emp.
    |HAZ comprueba_mat;
    #4#17 = por_mat_ref;           || (%) C.C. maternidad
|SI FEstado ! 0;  |GRABA 020#4n;  |FINSI;
|SI FEstado = 0;  |GRABA 020#4a;  |FINSI;
|LIBERA #4;
|CIERRAT #4;
    t_epig0 = 0;         || inicializa puente total epigrafe
    t_epig1 = 0;         || inicializa acumulador total epigrafe
    t_epig2 = 0;         || inicializa acumulador trabajadores
    t_epig9 = 0;         || inicializa acumulador cuotas ILT
    t_epiga = 0;         || inicializa acumulador cuotas IMS
    t_epigb = 0;         || inicializa puente cuotas ILT
    t_epigc = 0;         || inicializa puente cuotas IMS
    t_epigd = 0;         || inicializa puente bases C.C. en maternidad
    t_epige = 0;         || inicializa base AT/EP bonificada por RDL 16/2001 > 65
    t_epigf = 0;         || inicializa base Exp.Reg.Empleo
    t_cuotp = 0;         || inicializa acumulador cuota patronal desempleo
    t_cuoto = 0;         || inicializa acumulador cuota obrera desempleo
    t_cuotm = 0;         || inicializa acumulador cuota C.C. en maternidad
    t_cuotm2 = 0;        || inicializa acumulador cuota C.C. obrera en maternidad
    t_cuotx = 0;         || inicializa acumulador cuota C.C. en exp.reg.emp
    t_cuot_ere_ilt = 0;  || inicializa acumulador cuota IT en ere
    t_cuot_ere_ims = 0;  || inicializa acumulador cuota IMS en ere
    por_mat = 0;         || inicializa variable que guarda % de C.C. maternidad
    por_mat_ref = 0;     || inicializa variable que tendra el % del epigrafe
    t_puotp = 0;         || inicializa puente cuota patronal desempleo
    t_puoto = 0;         || inicializa puente cuota obrera desempleo
    t_puotp = 0;         || inicializa puente cuota patronal desempleo
    t_puoto = 0;         || inicializa puente cuota obrera desempleo
    t_puotm = 0;         || inicializa puente cuota C.C. en maternidad
    t_puotx = 0;         || inicializa puente cuota C.C. en Exp.Reg.Emp.
    t_puotm2 = 0;        || inicializa puente cuota C.C. en maternidad obrera
    t_puot_ere_ilt = 0;  || inicializa acumulador cuota IT en ere
    t_puot_ere_ims = 0;  || inicializa acumulador cuota IMS en ere
|FPRC;

|PROCESO nomtepcd;       || GRABA EN FICHERO AUXILIAR DE CUOTAS DESEMPLEO
     |SI s_ori = "M";|O s_ori = "A";
          |DDEFECTO #nomtepcd;
          |ABRE #nomtepcd;
          #nomtepcd#0 = #7#0;            || empresa
          #nomtepcd#1 = #0#2;                || mes
          #nomtepcd#2 = #7#26;             || epigrafe
          |SI #7#48 = 2;
               #nomtepcd#9 = 2;              || tipo (finiquitos)
          |SINO;
               #nomtepcd#9 = tip + dtipo;    || tipo
          |FINSI;
          |SI s_ori = "A";
               nTip = tip + dtipo;
               |SI nTip = 0; #nomtepcd#9 = 5;     |FINSI;
               |SI nTip = 8; #nomtepcd#9 = 6;     |FINSI;
               |SI nTip = 9; #nomtepcd#9 = 7;     |FINSI;
               |SI nTip = 10; #nomtepcd#9 = 15;     |FINSI;
               |SI nTip = 18; #nomtepcd#9 = 16;     |FINSI;
               |SI nTip = 19; #nomtepcd#9 = 17;     |FINSI;
          |FINSI;

          |SI siono_cen = "S";               || centro
                #nomtepcd#10 = antcentr;
          |FINSI;
          |SI siono_cen = "N";
                #nomtepcd#10 = 99;
          |FINSI;
          #nomtepcd#20 = #7#39;             || codigo de trabajador
          |LEE 101#nomtepcd.=;
          FEstado = FSalida;
          #nomtepcd#5 = #nomtepcd#5 + nBaseTra;         || base contingencias
          #nomtepcd#14 = #7#62;       || base conting. en maternidad (Cot.Emp.)
          || #nomtepcd#14 = #7#62 + #7#68;       || base conting. en maternidad (Cot.Emp.)
          |SI #8#10 = 4;
               #nomtepcd#15 = #7#27 + #7#37;       || total base bonif. RDL 16/2001 2.2.1
          |FINSI;
          || #nomtepcd#6 = t_epig2;         || nro. trabajadores
          || #nomtepcd#7 = t_epigb;         || cuota ILT
          || #nomtepcd#8 = t_epigc;         || cuota IMS
          || #nomtepcd#3 = (#nomtepcd#7 * 100) / #nomtepcd#5;    || (%) ILT
          || #nomtepcd#4 = (#nomtepcd#8 * 100) / #nomtepcd#5;    || (%) IMS
          #nomtepcd#12 = (#7#27 % #3#12);   || cuota patronal desempleo
          #nomtepcd#13 = (#7#27 % #3#13);       || cuota obrera desempleo
          #nomtepcd#16 = ((#7#62 + #7#68) % (#3#12+#3#14+#3#16));  || cuota C.C. mater.obr.
          #nomtepcd#18 = ((#7#62 + #7#68) % (#3#13+#3#15+#3#17));       || cuota C.C. mater.pat.
          ||HAZ comprueba_mat;
          ||#nomtepcd#17 = por_mat_ref;           || (%) C.C. maternidad
          #nomtepcd#21 = #nomconst#12 + #nomconst#13;
          #nomtepcd#22 = #nomtepcd#12 + #nomtepcd#13;
          #nomtepcd#23 = #nomconst#14;            || % FOGASA APLICADO
          #nomtepcd#24 = (#7#27 % #3#14);         || cuota patronal FOGASA
          |SI FEstado ! 0;  |GRABA 020#nomtepcd.n;  |FINSI;
          |SI FEstado = 0;  |GRABA 020#nomtepcd.a;  |FINSI;
          |LIBERA #nomtepcd;
          |CIERRAT #nomtepcd;
     |SINO;
          |DDEFECTO #nomwepcd;
          |ABRE #nomwepcd;
          #nomwepcd#0 = #7#0;            || empresa
          #nomwepcd#11 = any_hist;           || A¥O EN HISTORICO
          #nomwepcd#1 = #0#2;                || mes
          #nomwepcd#2 = #7#26;             || epigrafe
          |SI #7#48 = 2; |O #7#48 = 5;
               #nomwepcd#9 = #7#48;          || tipo (finiquitos)
          |SINO;
               #nomwepcd#9 = tip + dtipo;    || tipo
          |FINSI;
          |SI s_ori = "T";
               nTip = tip + dtipo;
               |SI nTip = 0; #nomwepcd#9 = 5;     |FINSI;
               |SI nTip = 8; #nomwepcd#9 = 6;     |FINSI;
               |SI nTip = 9; #nomwepcd#9 = 7;     |FINSI;
               |SI nTip = 10; #nomwepcd#9 = 15;     |FINSI;
               |SI nTip = 18; #nomwepcd#9 = 16;     |FINSI;
               |SI nTip = 19; #nomwepcd#9 = 17;     |FINSI;
          |FINSI;
          |SI siono_cen = "S";               || centro
                #nomwepcd#10 = antcentr;
          |FINSI;
          |SI siono_cen = "N";
                #nomwepcd#10 = 99;
          |FINSI;
          #nomwepcd#20 = #7#39;             || codigo de trabajador
          |LEE 101#nomwepcd.=;
          FEstado = FSalida;
          #nomwepcd#5 =  #nomwepcd#5 + nBaseTra;         || base contingencias
          #nomwepcd#14 = #7#62;       || base conting. en maternidad (Cot.Emp.)
          || #nomwepcd#14 = #7#62 + #7#68;       || base conting. en maternidad (Cot.Emp.)
          |SI #8#10 = 4;
               #nomwepcd#15 = #7#27 + #7#37;       || total base bonif. RDL 16/2001 2.2.1
          |FINSI;
          || #nomwepcd#6 = t_epig2;         || nro. trabajadores
          || #nomwepcd#7 = t_epigb;         || cuota ILT
          || #nomwepcd#8 = t_epigc;         || cuota IMS
          || #nomwepcd#3 = (#nomwepcd#7 * 100) / #nomwepcd#5;    || (%) ILT
          || #nomwepcd#4 = (#nomwepcd#8 * 100) / #nomwepcd#5;    || (%) IMS
          #nomwepcd#12 = (#7#27 % #3#12);   || cuota patronal desempleo
          #nomwepcd#13 = (#7#27 % #3#13);       || cuota obrera desempleo
          #nomwepcd#16 = ((#7#62 + #7#68) % (#3#12+#3#14+#3#16));  || cuota C.C. mater.obr.
          #nomwepcd#18 = ((#7#62 + #7#68) % (#3#13+#3#15+#3#17));       || cuota C.C. mater.pat.
          ||HAZ comprueba_mat;
          ||#nomwepcd#17 = por_mat_ref;           || (%) C.C. maternidad
          #nomwepcd#21 = #nomconst#12 + #nomconst#13;
          #nomwepcd#22 = #nomwepcd#12 + #nomwepcd#13;
          #nomwepcd#23 = #nomconst#14;            || % FOGASA APLICADO
          #nomwepcd#24 = (#7#27 % #3#14);         || cuota patronal FOGASA
          |SI FEstado ! 0;  |GRABA 020#nomwepcd.n;  |FINSI;
          |SI FEstado = 0;  |GRABA 020#nomwepcd.a;  |FINSI;
          |LIBERA #nomwepcd;
          |CIERRAT #nomwepcd;
     |FINSI;
|FPRC;

|PROCESO comprueba_mat;       || proceso auxiliar por si ya habia grabado
     |SI por_mat_ref ! 0;           || algo en el % de C.C. maternidad
          |SI por_mat_ref ! -1;     || si viene a -1, sera -1 por fuerza
               |SI #4#17 > 0;       || si viene > 0 y habia algo > 0 tambien
                    |SI #4#17 ! por_mat_ref;    || y es distinto a lo q habia
                         por_mat_ref = -1;      || planta un -1 a la fuerza
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          por_mat_ref = #4#17;     || si viene a cero, se queda con lo q habia
     |FINSI;
|FPRC;
____________________________________/ ACTUALIZA PLANTILLA EN EMPRESA Y CENTRO
|PROCESO empresas;
    t_trab1 = t_traba - t_altas;  || calcula trabajadores mes anterior
    t_trab2 = t_traba - t_bajas;  || calcula trabajadores que quedan
|ABRET #1;
    #1#0 = antempre;
|LEE 120#1=;
|SI FSalida = 0;
    |SI pregunta ! -1;
            #1#14 = #1#14 + t_trab2;
    |SINO;
            #1#14 = t_trab2;
    |FINSI;
    |GRABA 020#1a;
|FINSI;
|LIBERA #1;
|CIERRAT #1;
|SI siono_cen = "N";
        t_trpo1 = t_trab1;   t_trpo2 = t_trab2;  || variables puente
        t_altpo = t_altas;   t_bajpo = t_bajas;  || /para el informe
|FINSI;
    t_traba = 0;     || acumulador numero de trabajadores empresa
    t_altas = 0;     || acumulador altas de trabajadores empresa
    t_bajas = 0;     || acumulador bajas de trabajadores empresa
|FPRC;

|PROCESO centros;      || ACTUALIZA PLANTILLA EN CENTRO DE TRABAJO
    t_trce1 = t_trcen - t_altce;  || calcula trabajadores mes anterior
    t_trce2 = t_trcen - t_bajce;  || calcula trabajadores que quedan
|SI pregunta = -1;
    |ABRET #10;
        #10#0 = antempre;
        #10#1 = antcentr;
    |LEE 120#10=;
    |SI FSalida = 0;
            #10#11 = t_trce2;           || centro trabajo
        |GRABA 020#10a;
    |FINSI;
    |LIBERA #10;
    |CIERRAT #10;
|SINO;
    |ABRET #13;
        #13#0 = antempre;
        #13#13 = antcentr;
        #13#1 = pregunta;
    |LEE 120#13=;
    |SI FSalida = 0;
            #13#11 = t_trce2;           || centro 18/93
        |GRABA 020#13a;
    |FINSI;
    |LIBERA #13;
    |CIERRAT #13;
|FINSI;

|SI siono_cen = "S";
        t_trpo1 = t_trce1;   t_trpo2 = t_trce2;  || variables puente
        t_altpo = t_altce;   t_bajpo = t_bajce;  || /para el informe
|FINSI;
    t_trcen = 0;     || acumulador numero de trabajadores centro
    t_altce = 0;     || acumulador altas de trabajadores centro
    t_bajce = 0;     || acumulador bajas de trabajadores centro
|FPRC;
____________________________________/ RUTINAS DE IMPRESION RELACION ADJUNTA
|PROCESO relacion;
|SI #4#9 ! 5;       || los atrasos no
    ||PRINT;
|FINSI;
|FPRC;

|DEFBUCLE nomyytc24;
 #4#1;
 ;
 antempre,  0, #0#2,   0,  0;
 antempre, 99, #0#2, 999, 19;
 ;
 NULL, relacion;
|FIN;

|PROCESO adjuntar;      || INICIA Y CONTROLA EL BUCLE
|SI t_epig4 > 0; |Y #0#5 = "S"; |Y dtipo = 0; |Y pregunta = -1;
    |HAZ leempre;       || recoge datos empresa
        t_epig4 = 0;
        t_epig5 = 0;
        t_epig6 = 0;    || inicializa acumuladores
        t_epig7 = 0;
        t_epig8 = 0;
    ||INFOR "nomadjun";
    |BUCLE nomyytc24;           || el resto se acumula sobre el septimo
    ||PIEINF;
    ||FININF;
|FINSI;
    t_epig4 = 0;        || inicializa contador
|FPRC;

|PROCESO leempre;       || ABRE EMPRESA PARA LEER DATOS CORRESPONDIENTES
|ABRET #1;
    #1#0 = antempre;
|LEE 020#1=;
    adjun_0 = #1#0;                    || codigo empresa
    adjun_0 = "000" + adjun_0;
    adjun_0 = adjun_0 % -103;
    adjun_1 = #1#2;                    || nombre empresa
    domi = #1#3;
|QBF domi;
    adjun_2 = domi+" "+#1#4+" "+#1#5;     || domicilio empresa
    postal1 = "00" + #1#7;
    postal1 = postal1 % -102;
    postal2 = "000" + #1#8;
    postal2 = postal2 % -103;
    adjun_3 = postal1 + postal2;       || construye C.P.
    adjun_4 = #1#6;                    || localidad
    adjun_5 = #1#19;                   || clave entidad
    adjun_6 = #1#20;                   || nombre entidad
    adjun_7 = #1#10;                   || cif
    afili = #1#13;
|QBF afili;
    sgdoalf = afili % 0;
    sgdonum = sgdoalf;
    sgdonum = sgdonum - 4;
    sgdonum = sgdonum + 300;
    adjun_8 = afili % 102;             || Primer digito S.S.
    adjun_9 = afili % sgdonum;         || Segundo digito S.S.
    adjun_A = afili % -102;            || Tercer digito S.S.
    adjun_B = adjun_8 + adjun_9 + adjun_A;  || todo entero
|CIERRAT #1;
|FPRC;
