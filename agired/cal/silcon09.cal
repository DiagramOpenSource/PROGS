|FICHEROS;
    silcon09 #0;
    silcon01 #1;         || control directorio         **********************
    silcon02 #2;         || lotes cabs.                *    ­ATENCION!      *
    tsilcon0 #3;         || def ayuda carga lineas     * ESTOY AL LIMITE DE *
    silcon04 #4;         || campos auxiliares          *   LAS 8000 LINEAS  *
    silcon03 #5;         || lotes lins.                **********************
    silcon06 #6;         || empresas silcon
    silcon07 #7;         || registro lotes
    labempre #10;        || empresas
    nomtrtc2 #11;        || tmp. TC2
    labtraba #12;        || trabajadores
    nombonif #13;        || bonificaciones
    tsilcon4 #14;        || tmp. TC1
    tsilcon5 #15,MANTE;  || tmp. parrilla empresas
    labcentr #16;        || centros de trabajo
    nomcenes #17;        || centros de trabajo especiales
    nomcalca #18;        || calculos cabs. (proceso mensual)
    nomhicca #19;        || calculos cabs. (proceso historico)
    tsilcon1 #20;        || calculos cabs. (fuente calculos)
    nomcalac #21;        || calculos cabs. (proceso atrasos)
    nomconst #22;        || constantes
    tsilcon6 #23,MANTE;  || tmp. parrilla trabajadores
    nomtstc2 #24;        || tmp. tc1 sin tc2
    silcon15 #25;        || regimenes centros
    nomcontr #36;        || control aplicacion
    nomtraca #55;        || importes trab.cabs. (bonif.exp.reg.emp.)
    nomcones #56;        || constante especial (bonif.exp.reg.emp.)
    nomepigr #57;        || epigrafes (bonif.exp.reg.emp.)
    nomepitr #58;        || epigrafes trabajador (bonif.exp.reg.emp.)
    nomcalli #59;        || Mantenimiento Calculos Mensual   (Lineas)
    nomhicli #60;        || Mantenimiento Calculos Historico (Lineas)

    labempax #50;        || aux.empresas (para nome_dat y para TC2)
    nomtepig #51;        || aux.epigrafes (para nome_dat y para TC2)
    labemphi #52;        || aux.empresas hist. (para TC2)
    nomwepig #53;        || aux.epigrafes hist. (para TC2)

    nomret03 #100;       || bonificaciones retroactivas
    nomequiv #101;       || tabla equivalencias contratos nuevos
    tsilcon8 #104,MANTE;       || tmp. correcion segmentos EDL_CD_XX
    nombofli;
     nomlicol;
     nombotra;
     nomredco;
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    alfa5 = "";
    alfa6 = "";
    &nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    nume5 = 0;
    nume6 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    &fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;
    p_mes = "";
    inkey = 0;

    ajuste1 = "";
    ajuste2 = "";
    ajuste3 = "";
    alfa = "";
    error = 0;
    ind = 0;
    long = 0;
    posi = 0;
    digito = "";
    texto = "";
    mascara = "";
    &cadena = "";
    i = 0;
    j = 0;
    &nCampo = 0;
    &nTipo = 0;

    fichero = "";
    extension = "";

    &clave = "";
    &sw_auxil = 0;
    &linea = 0;
    &nlinea = 0;
    &for_fecha = "";
    &for_hora = "";
    apell1 = "";
    apell2 = "";
    nombre = "";
    nro_trab = 0;
    &tot_ba_01 = 0;
    &tot_ba_02 = 0;
    &tot_ba_06 = 0;
    &tot_ba_10 = 0;
    &tot_ba_11 = 0;
    &tot_ba_21 = 0;
    &tot_ba_22 = 0;
    &tot_ba_42 = 0;
    &tot_cd_01 = 0;
    &tot_cd_02 = 0;
    &tot_cd_03 = 0;
    &tot_cd_06 = 0;
    &tot_cd_07 = 0;
    &tot_cd_08 = 0;
    &tot_cd_10 = 0;
    &tot_cd_11 = 0;
    &tot_cd_13 = 0;
    &tot_cd_16 = 0;
    &tot_cd_17 = 0;
    &tot_cd_21 = 0;
    &tot_cd_22 = 0;
    &tot_cd_23 = 0;
    &tot_ca_86 = 0;
    descom = "";
    entero = "";
    decima = "";
    tot_emp = 0;
    &s_emp = 0;
    &s_any = 0;
    &s_mes = 0;
    &s_has = 0;
    &s_tip = "";
    &s_tipd = "";
    &s_cen = "";
    &s_pas = 0;
    &s_nom = "";
    &s_ori = "";
    &s_tat = 0;
    s_res = 0;
    indica = "";
    dto_mat = 0;
    cc_mat = 0;
    cp_mat = 0;
    &eldat = 0;
    &d_alta = 0;
    sw_dat1 = 0;
    sw_dat2 = 0;
    corta = 0;
    &nBaseCC = 0;

    sw_parrilla = 0;
    sw_bueno = 0;
    ant_centro = 0;
    cta_co = "";
    descto = "";
    &ind_cot = " ";
    &any_hist = 0;
    traba = 0;

    &bonifi = 0;
    &reducc = 0;
    &subven = 0;
    &sub85pre = 0;
    &sub85dis = 0;

    &nEuros = 0;
    &nPesetas = 0;
    &nCambioeuro = 166.386;
    nSwitchEuro1 = 0;
    nSwitchEuro2 = 0;

    &temp1 = "";
    &temp2 = "";
    &temp3 = "";
    &temp4 = "";
    &temp5 = "";
    &temp6 = "";
    &temp04 = "";

    bcomun = 0;
    bprofe = 0;
    dia_2 = 0;
    dia_3 = 0;
    dia_4 = 0;
    &topemes = 0;
    &esAtrasos = 0;
    &dat_mes = 0;
    ult11 = 0;
    fecha_bon_16 = "";

     aAbreviado = "";
     &eaFuente = "";
     &enTipoAt = 0;
     &enDesEmp = 0;
     &enHasEmp = 0;
     &enDesCen = 0;
     &enHasCen = 0;
     &enDesMes = 0;
     &enHasMes = 0;
     &enAny = 0;
     &eaTempo1 = "";
     &eaTempo2 = "";
     &eaTipoLi = "";
     &eaParame = "";
     &aParam = "";
     nEmpresa = 0;
     aLibre = "";
     aReser = "";
     &aEpiTc2 = "";
     nSwPrimera = 0;
     aPromed = "";
     &enSwBorrados = 0;
     bon_0 = 0;
     bon_3 = 0;
     bon_5 = 0;
     &bon_60 = 0;
     &swbon_65 = 0;
     swbon_21 = 0;
     base_A = 0;
     base_B = 0;
     &base_C = 0;
     base_F = 0;
     &nCodigoCons = 0;
     epig_ilt = 0;
     epig_ims = 0;
     nPorBon = 0;
     por1_cont = 0;
     por1_dfpg = 0;
     zbase_9 = 0;
     nMarcarE = 0;
     nMarcarT = 0;
     nPEnf = 0;
     nPAcc = 0;
     nBIlt = 0;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     &nVeces = 0;
     aRegimen = "";
     &aContrato = "";
     nAnyo = 0;
     aAnyo = "";
     &EURODB = 0;
     prov_ad = "";
     aClaveTC2 = "";
     nMes = 0;
     nBaseCC_vac = 0;
     nBaseCP_vac = 0;
     nBonifFCI_vac = 0;
     nBonifTex_vac = 0;
     nBaseCC_acu = 0;
     nBaseCP_acu = 0;
     tipo_bot = 0;
     tipo_top = 0;
     aAviso = "";
     m = 0;
     dias_finiq = 0;
     total_dias = 0;
     desde_mes = 0;
     nMes2 = 0;
     nSwDiasCero = 0;
     nReducc_vac = 0;
     nReducc_acu = 0;
     nBonifi_vac = 0;
     nBonifi_acu = 0;
     nSubven_vac = 0;
     nSubven_acu = 0;
     nSub85pre_vac = 0;
     nSub85pre_acu = 0;
     nSub85dis_vac = 0;
     nSub85dis_acu = 0;
     nBon_60_vac = 0;
     nBon_60_acu = 0;
     &primer_mes = ""
     &ultimo_mes = ""
     linea_EMP = 0;
     meses_bon = 0;
     swBonif = 0;
     &anyocal = 0;
     &mescal = 0;
     anyofin = 0;
     mesfin = 0;
     fecha1 = @;
     dias_enfmat = 0;

     nDiasRes = 0;
     nDiasDisp = 0;
     nMesVac = 0;
     nMesesVac = 0;
     nDiasVac = 0;
     nAnyoHis = 0;
     &swFiniqRaro = 0;
     nSumaUno = 0;
     swEsElUltimo = 0;
     d_coti = 0;
     d_baja = 0;
     nReduc17_Alta = 0;
     fFecha = @;
     fFechaAlta  = @;
     fFechaRef  = @;
     &nDias = 0;
     fFech1 = @;
     fFech2 = @;

     alfa7 = "";
     alfa8 = "";
     nume7 = 0;
     nume8 = 0;
     nTope = 0;
     &aTrabFiniq = "";
     &swSegundoLote = 0;      || indicador para que vuelva a calcular
     &swCalDos = 0;           || indicador para el silcon10
     epig_sec = 0;
     &swFiniqRaro2 = 0;
     desde = 0;
     hasta = 0;
     aFechaRef = "";
     aNAFSS_Act = "";
     aNAFSS_Ant = "";
     aSSCen2_Act = "";
     aSSCen2_Ant = "";
     nEmp_Act = 0;
     nEmp_Ant = 0;

     &nBase = 0;
     &nBaseAlta = 0;
     &nBaseBaja = 0;      || variables para proporcionar las bonificaciones
     &nBaseTotal = 0;     || segun periodo en alta/baja
     &nPropAlta = 0;
     &nPropBaja = 0;
     &nPropMat = 0;
     &reducc_Alta = 0;
     &reducc_Baja = 0;
     &bonifi_Alta = 0;
     &bonifi_Baja = 0;
     &bonifi25_Alta = 0;
     &bonifi25_Baja = 0;
     &bonjuv_Alta = 0;
     &bonjuv_Baja = 0;
     &bonifi_Mat = 0;
     &subven_Alta = 0;
     &bon_60_Alta = 0;
     &sub85pre_Alta = 0;
     &sub85dis_Alta = 0;

     &base_Ca = 0;
     &base_Cb = 0;
     zbase_9a = 0;
     zbase_9b = 0;
     &swBonEpig = 0;
     epig_ilt_126 = 0;
     epig_ims_126 = 0;
     &aSigno = "";
     nBonifFPCont = 0;
     swBonifFPCont = 0;
     nEmpresaAnt = 0;

     aFechaIniBon = "";
     aFechaFinBon = "";
     nMesesBon = 0;
     nFecha = 0;
     &swAjuste3 = 0;
     nDiasBon = 0;
     dias_bon_16 = 0;
     fecha_fin_16 = "";
     swNoAjuste3 = 0;
     d_cot_it = 0;

     nDiasMes = 0;
     nDiasAlta = 0;
     nDiasIT = 0;
     &nDiasMate = 0;
     nDiasExp = 0;
     nAjustePFE = 0;
     &tottracd22 = 0;

     &tottracd23 = 0;
     nBase55 = 0;
     &bon_55 = 0;
     bon_55_Alta = 0;
     nBon_55_vac = 0;
     nBon_55_acu = 0;
     swVengoDe = 0;
     nEdadParaBon = 0;
     &nEpigConv = 0;

     &nProp55 = 0;
     &nProp60 = 0;
     &nDiasProp55 = 0;
     &nDiasProp60 = 0;
     &nVez = 0;
     &s_anyl = 0;
     &s_ele = "";
     swSigue = 0;
     &nGuardaPropAlta = 0;
     &nGuardaPropBaja = 0;
     &nGuardaPropMat = 0;
     &swParcheBonMat = 0;
     &swParcheBonMat_34 = 0;
     &nElAny = 0;
     &nElMes = 0;
     &nDias_nat_alta = 0;
     bisiesto = 0;
     &nDiasProp55_A = 0;
     &nDiasProp55_IT = 0;
     &nDiasProp60_A = 0;
     &nDiasProp60_IT = 0;
     &nProp55_A = 0;
     &nProp55_IT = 0;
     &nProp60_A = 0;
     &nProp60_IT = 0;
     &swbon_25 = 0;
     &swbon_31 = 0;
     &swbon_34 = 0;
     &tot_cd_25 = 0;
     &tot_cd_28 = 0;
     &tot_cd_31 = 0;
     &tot_cd_32 = 0;
     &tot_cd_33 = 0;
     &tot_cd_34 = 0;
     nNume = 0;
     &sw5560sim = 0; || bonificaciones textil > 55 y para > 60 a la vez
     &sw5960sim = 0; || bonificaciones > 59 y para > 60 a la vez
     &swredbonsim = 0; || bonificaciones > 45 a¤os y > 59 a¤os a la vez
     &swCumple = 0;
     &swExiste = 0;
     swNuevo = 0;
     nBaseCC1 = 0;
     nBaseCC2 = 0;
     nBaseCC3 = 0;
     nBaseCC4 = 0;
     &nBonif = 0;
     swSocTP = 0;
     &dias_enteros = 0;
     &s_num = 0;
     &nDiasExtra = 0;
     &nBaseExtra = 0;
     &swSelEmp = 0;
     &swSelTra = 0;
     &s_fich = "";
     &enLote = 0;
     &eaFich = "";
     &eaExt = "";
     &bonifi_25 = 0;
     &swDobleTramoJuv = 0;
     &nPosicion = 0;
     aAutorizacion = "";
|FIN;
____________________________________/ GESTION PANTALLA
|PROCESO tipo8;
|ABRE #1;
|LEE 100#1p;
|SI FSalida ! 0;|Y aParam ! "TC2";
    |SI FSalida = 111;
        |MENAV "    Debera definir 'Maestros/Control R.E.D.'";
    |FINSI;
    |CIERRA #1;
    |PTEC 807;
|SINO;
        alfa1 = Usuario; |QBF alfa1;    alfa1 = "4" + alfa1;
    |NOME_DAT #14 alfa1;
|FINSI;
|FPRC;

|PROCESO tipo9;
|LIBERA #1;
|CIERRA #1;
|FPRC;

|PROCESO defecto; |TIPO 7;
     fech1 = ~;
     alfa1 = fech1;
     alfa1 = alfa1 % 402;
     nume1 = alfa1;
     alfa2 = fech1;
     alfa2 = alfa2 % -104;
     nume2 = alfa2;

     |SI nume1 = 1;
         #0Campo = nume2 - 1;
     |SINO;
         #0Campo = nume2;
     |FINSI;
     |PINTA #0Campo;
|FPRC;

|PROCESO elAnyo; |TIPO 0;
     enAny = #0#0;
|FPRC;

|PROCESO mirames; |TIPO 7;
     |SI #0#12 ! "A";|Y #0#12 ! "T"; |Y #0#12 ! "C";
          fech1 = ~;
          alfa1 = fech1;
          alfa1 = alfa1 % 402;
          nume1 = alfa1;
          alfa2 = fech1;
          alfa2 = alfa2 % -104;
          nume2 = alfa2;

          |SI nume1 = 1;
              #0Campo = 12;
          |SINO;
              #0Campo = nume1 - 1;
          |FINSI;

          |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO pintames; |TIPO 0;
|SI #0Campo =  1;  p_mes = "ENERO     ";  |FINSI;
|SI #0Campo =  2;  p_mes = "FEBRERO   ";  |FINSI;
|SI #0Campo =  3;  p_mes = "MARZO     ";  |FINSI;
|SI #0Campo =  4;  p_mes = "ABRIL     ";  |FINSI;
|SI #0Campo =  5;  p_mes = "MAYO      ";  |FINSI;
|SI #0Campo =  6;  p_mes = "JUNIO     ";  |FINSI;
|SI #0Campo =  7;  p_mes = "JULIO     ";  |FINSI;
|SI #0Campo =  8;  p_mes = "AGOSTO    ";  |FINSI;
|SI #0Campo =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
|SI #0Campo = 10;  p_mes = "OCTUBRE   ";  |FINSI;
|SI #0Campo = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
|SI #0Campo = 12;  p_mes = "DICIEMBRE ";  |FINSI;
|PINTA 0843, p_mes;
|FPRC;

|PROCESO ult_lote; |TIPO 7;
|ABRE #2;
|LEE 000#2u;
|SI FSalida = 0;
        #0#2 = #2#0 + 1;
|SINO;
        #0#2 = 1;
|FINSI;
|PINTA #0#2;
|CIERRA #2;
|FPRC;

|PROCESO si_existe; |TIPO 0;
     |ABRE #2;
     #2#0 = #0Campo;
     |LEE 000#2=;
     |SI FSalida = 0; |Y #0Campo ! 00000;
          |MENAV "    Numero de Lote YA existente ...";
          |ERROR;
     |FINSI;
     |CIERRA #2;

     |SI Campo = 2; |Y #0Campo = #0#2; |Y #0#21 = "S";
          aAlfa = "    El número de lote FAN debe ser distinto al del lote CRA.";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;

     |SI Campo = 22; |Y #0Campo = #0#2; |Y #0#21 = "S";
          aAlfa = "    El número de lote CRA debe ser distinto al del lote FAN.";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO mayus; |TIPO 0;
    #0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|PROCESO iniswitch;          || Solo para inicializar las variables
     nSwitchEuro1 = 0;       || del paso a euros
     nSwitchEuro2 = 0;
|FPRC;

|PROCESO fecha_bon_16;
     alfa1 = #12#11 % -104;        || anyo nacimiento
     alfa2 = #12#11 % -602;        || mes nacimiento
     alfa5 = #12#11 % 102;         || dia nacimiento
     alfa3 = #12#34 % -104;        || anyo antiguedad
     alfa4 = #12#34 % -602;        || mes antiguedad
     alfa6 = #12#34 % 102;         || dia antiguedad
     nume1 = alfa1;
     nume1 = alfa1 + nEdadParaBon;           || a¤o que cumple 60 a¤os
     alfa1 = nume1;
     nume3 = alfa3;                || a¤o que cumple 5 a¤os antiguedad
     nume3 = alfa3 + 5;
     alfa3 = nume3;
     nume2 = alfa2;                || mes edad
     nume4 = alfa4;                || mes antiguedad
     nume5 = alfa5;                || dia edad
     nume6 = alfa6;                || dia antiguedad

     |SI nume1 > nume3;            || cuando cumple 55 o 60 a¤os
          |SI nume1 < 2002;
               fecha_bon_16 = "01.01.2002";
          |SINO;
               fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
          |FINSI;
     |FINSI;
     |SI nume1 < nume3;            || cuando cumple antiguedad
          |SI nume3 < 2002;
               fecha_bon_16 = "01.01.2002";
          |SINO;
               fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
          |FINSI;
     |FINSI;
     |SI nume1 = nume3;            || mismo a¤o: comprobamos meses
          |SI nume2 > nume4;            || cuando cumple 60 a¤os
               |SI nume1 < 2002;
                    fecha_bon_16 = "01.01.2002";
               |SINO;
                    fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
               |FINSI;
          |FINSI;
          |SI nume2 < nume4;            || cuando cumple antiguedad
               |SI nume3 < 2002;
                    fecha_bon_16 = "01.01.2002";
               |SINO;
                    fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
               |FINSI;
          |FINSI;
          |SI nume2 = nume4;       || antiguedad y 60 a¤os en = a¤o, =mes
               |SI nume5 > nume6;            || cuando cumple 60 a¤os
                    |SI nume1 < 2002;
                         fecha_bon_16 = "01.01.2002";
                    |SINO;
                         fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
                    |FINSI;
               |FINSI;
               |SI nume6 < nume5;            || cuando cumple antiguedad
                    |SI nume3 < 2002;
                         fecha_bon_16 = "01.01.2002";
                    |SINO;
                         fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
                    |FINSI;
               |FINSI;
               |SI nume5 = nume6;
                    fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
               |FINSI;
          |FINSI;
     |FINSI;

     dias_bon_16 = 0;
     fecha_fin_16 = "";
     |SI bon_55 > 0;
          alfa7 = (#12#11 % -104);
          nume7 = alfa7;
          nume7 = nume7 + 60;
          alfa7 = nume7;
          fecha_fin_16 = alfa5 + "." + alfa2 + "." + alfa7;
     |FINSI;
     |SI swbon_65 ! 0;
          alfa7 = #labtraba#40;
          |QBF alfa7;
          |SI alfa7 ! ""; |Y alfa7 ! "..........";
               alfa7 = #labtraba#40 % 402;
               alfa8 = #labtraba#40 % -104;
               nume7 = alfa7;
               nume8 = alfa8;
               |SI nume7 = #0#1; |Y nume8 = #0#0;
                    alfa7 = #labtraba#40 % 102;
                    nume7 = alfa7;
                    dias_bon_16 = nume7 - 1;

                    fFecha = #labtraba#40;
                    nFecha = fFecha;
                    nFecha = nFecha - 1;
                    fFecha = nFecha;
                    fecha_fin_16 = fFecha;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO borra_tra1;
|BORRA 020#23a;
|LIBERA #23;
|FPRC;

|DEFBUCLE borra_tra;
 #23#2;
 ;
 #15#0,     1;
 #15#0, 99999;
 be;
 NULL, borra_tra1;
|FIN;

|PROCESO parrilla_tra1;
    #23#1 = #12#0;
    #23#2 = #12#1;
|LEE 000#23=;
|SI FSalida ! 0;
        traba = traba + 1;
    |DDEFECTO #23;
        #23#0 = traba;       || linea
        #23#1 = #12#0;       || empresa
        #23#2 = #12#1;       || trabajador
        #23#3 = #12#2;       || nombre
        #23#4 = #12#45;      || contrato
        #23#5 = #12#77;      || centro trabajo
        #23#6 = #12#39;      || bonificacion
    |SI nMarcarT = 0;     #23#7 = "*";   |FINSI;   || marcado SI
    |SI nMarcarT ! 0;     #23#7 = " ";   |FINSI;   || marcado NO
    |GRABA 020#23n;
|FINSI;
|FPRC;

|DEFBUCLE parrilla_tra;
 #12#1;
 ;
 #15#0,     1;
 #15#0, 99999;
 ;
 NULL, parrilla_tra1;
|FIN;

|PROCESO parrilla_emp1;
|SI #15#2 = "*";|O sw_parrilla = 0;
    |SELECT #2#23;
    |AVISO;
    alfa1 = "0000SMarcar todos los trabajadores de la empresa [" + #15#0 + "]:";
    |CONFI alfa1;
    nMarcarT = FSalida;
    |BUCLE parrilla_tra;
    |SELECT #1#23;
|SINO;
    |CIERRAT #23;
    |BUCLE borra_tra;
    |ABRET #23;
|FINSI;
|FPRC;

|DEFBUCLE parrilla_emp;
 #15#1;
 ;
     1;
 99999;
 ;
 NULL, parrilla_emp1;
|FIN;

|PROCESO parrilla2;
|ABRET #23;
|LEE 000#23u;  |SI FSalida = 0; traba = #23#0; |SINO; traba = 0; |FINSI;
|BUCLE parrilla_emp;
|LEE 000#23u;  |SI FSalida = 0; traba = #23#0; |SINO; traba = 0; |FINSI;
|CIERRAT #23;
|FPRC;

|PROCESO reenvio1;
    #10#0 = #6#0;
|LEE 000#10=;
|SI FSalida = 0;
    |DDEFECTO #15;
        #15#0 = #6#0;
        #15#1 = #10#2;
    |SI nMarcarE = 0;    #15#2 = "*";   |FINSI;
    |SI nMarcarE ! 0;    #15#2 = " ";   |FINSI;
    |GRABA 020#15n;
|FINSI;
|FPRC;

|DEFBUCLE reenvio;
 #6#1;
 ;
     1;
 99999;
 ;
 NULL, reenvio1;
|FIN;

|PROCESO min23;
    #23#0 = 1;
|FPRC;

|PROCESO max23;
    #23#0 = 999999;
|FPRC;

|PROCESO min15;
    #15#0 = 1;
|FPRC;

|PROCESO max15;
    #15#0 = 99999;
|FPRC;

|PROCESO parrilla; |TIPO 0;
|SI FSalida = 0;|Y #0#11 = "S";
    |SI sw_parrilla = 0;
        |ATRI P;   |MENSA "    Cargando seleccion ...";    |ATRI 0;
            alfa1 = Usuario; |QBT alfa1;    alfa1 = ("t" + alfa1) % 108;
            alfa2 = Usuario; |QBT alfa2;    alfa2 = ("u" + alfa2) % 108;
        |NOME_DAT #15 alfa1;
        |NOME_DAT #23 alfa2;
        |DELINDEX #15;
        |DELINDEX #23;
        |AVISO;
        |CONFI "0000NMarcar todas las empresas: ";
        nMarcarE = FSalida;
        |ABRE #10;
        |ABRE #15;
        |BUCLE reenvio;
        |CIERRA #10;
        |CIERRA #15;
        |ATRI R;   |BLIN 4;                                |ATRI 0;
            sw_parrilla = 1;
    |FINSI;

    |PUSHV 0501 2380;
    |ENTLINEAL #1#15, 1, 4, 22, 1, min15, max15;
    |CONFI "    NSeleccion de Trabajadores (S/N): ";
    |SI FSalida = 0;
        |HAZ parrilla2;
        |SI traba ! 0;
            |PUSHV 0501 2380;
            |ENTLINEAL #1#23, 1, 4, 22, 1, min23, max23;
            |POPV;
        |SINO;
            |MENAV "    No hay empresas seleccionadas ...";
        |FINSI;
    |FINSI;
    |POPV;
|FINSI;
|FPRC;

|PROCESO mes_atrasos; |TIPO 7;
|SI #0#12 ! "A"; |Y #0#12 ! "T"; |Y #0#12 ! "C";
    |CAMPO_MODIFICA #0#13, 1, "N";          || diocesis de lugo trimestrales
        #0#13 = #0#1;
    |PINTA #0#13;
|SINO;
    |CAMPO_MODIFICA #0#13, 1, "S";
|FINSI;
|FPRC;

|PROCESO def_calif; |TIPO 7;
|SI #0#12 = "M";   |O #0#12 = "H";       #0#14 = "L00"; |FINSI;
|SI #0#12 = "A";   |O #0#12 = "T";       #0#14 = "L03"; |FINSI;
|SI #0#17 = 2;                           #0#14 = "L13"; |FINSI;
|SI #0#12 = "C";                         #0#14 = "L09"; |FINSI;
|PINTA #0#14;
|FPRC;

|PROCESO calif_liq; |TIPO 0;
    inkey = FSalida;
    elsw1 = 0;
|SI #0#14 = "L00";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L01";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L02";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L03";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L04";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L07";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L08";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L09";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L10";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L11";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L12";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L13";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L15";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L80";  elsw1 = 1;     |FINSI;
|SI #0#14 = "A70";  elsw1 = 1;     |FINSI;
|SI #0#14 = "A71";  elsw1 = 1;     |FINSI;
|SI #0#14 = "A72";  elsw1 = 1;     |FINSI;
|SI #0#14 = "A73";  elsw1 = 1;     |FINSI;
|SI #0#14 = "A74";  elsw1 = 1;     |FINSI;
|SI #0#14 = "A75";  elsw1 = 1;     |FINSI;
|SI elsw1 = 0;
    |MENAV "    Calificador no reconocido ...";
    |ERROR;
|SINO;
    |SI inkey ! 2;
        |SI #0#12 = "A";|O #0#12 = "T";
            |SI #0#14 ! "L03";
                |MENAV "    Las liquidaciones por Atrasos deben calificarse con L03 o bien L09 para Liquidaciones Complementarias.";
            |FINSI;
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO no_fecha; |TIPO 7;
     alfa2 = #0#1;
     alfa2 = "0" + alfa2;
     alfa2 = alfa2 % -102;
     alfa3 = #0#0;
     ||SI #0#14 = "L03";
     |SI #0#12 = "A"; |O #0#12 = "T"; |O #0#14 = "L02";
     || atrasos o atrasos desde Hco. o complementarias L02
          alfa1 = "S";
     |SINO;
          alfa1 = "N";
     |FINSI;
     |C_M #0#10, 1, alfa1;
|FPRC;

|PROCESO notipo; |TIPO 7;
     |SI #0#12 ! "A"; |Y #0#12 ! "C";
          |C_M #0#17, 1, "S";
          |SI #0#12 = "M";|O #0#12 = "H";    #0#17 = 0;     |FINSI;
          |SI #0#12 = "T";                   #0#17 = 6;     |FINSI;
          |PINTA #0#17;
     |SINO;
          |SI #0#12 = "A";
               #0#17 = 5;
               |PINTA #0#17;
          |FINSI;
          |C_M #0#17, 1, "N";
     |FINSI;
|FPRC;

|PROCESO cheq_tipo; |TIPO 0;
     |SI #0#12 = "M"; |O #0#12 = "H";
          |SI #0Campo ! 0; |Y #0Campo ! 2;
               aAviso = "0000En Procesos Mensual o Historico solo se admiten "
               aAviso = aAviso + "los tipos 0 y 2";
               |MENAV aAviso;
               |ERROR;
          |FINSI;
     |FINSI;
     |SI #0#12 = "T";
          |SI #0Campo < 6;
               aAviso = "0000En Proceso Atrasos desde Historico solo se admiten "
               aAviso = aAviso + "los tipos del 6 al 9";
               |MENAV aAviso;
               ||ERROR;
          |FINSI;
     |FINSI;
     |SI #0#12 = "C";
          |CAMPO_MODIFICA #0Campo, 1, "N";
     |SINO;
          |CAMPO_MODIFICA #0Campo, 1, "N";
     |FINSI;
     |SI #0Campo = 2;
          #0#14 = "L13";
         |PINTA #0#14;
     |FINSI;
|FPRC;

|PROCESO AnyoLote; |TIPO 7;
     #0#18 = #0#0;
     |PINTA #0#18;
     |SI #0#12 = "M";|O #0#12 = "A";
          |C_M #0#18, 1, "N";
     |SINO;
          |C_M #0#18, 1, "S";
     |FINSI;
|FPRC;
____________________________________/ RUTINAS DE APOYO
|PROCESO descompone;
    entero = "";
    decima = "";
    elsw1 = 0;
    alfa1 = descom % 0;   long = alfa1;
|PARA para1 = 1; |SI para1 [ long; |HACIENDO para1 = para1 + 1;
        nume1 = (para1 * 100) + 1;
        alfa1 = descom % nume1;
    |SI alfa1 = ".";
            elsw1 = 1;
    |SINO;
        |SI elsw1 = 0;   entero = entero + alfa1; |FINSI;
        |SI elsw1 = 1;   decima = decima + alfa1; |FINSI;
    |FINSI;
|SIGUE;

|SI entero = "";    entero = "0";  |FINSI;
|SI decima = "";    decima = "0";  |FINSI;
|FPRC;

|PROCESO bonif;                    || vemos si tiene realmente bonif.
     swBonif = 0;                  || en exp. reg. empleo segun la fechas de
     anyocal = #0#0;               || alta y baja de la bonif
     mescal = #0#13;
     alfa1 = #12#41 % -104;        || a¤o baja bonif.
     alfa2 = #12#41 % 402;         || mes baja bonif.
     anyofin = alfa1;
     mesfin = alfa1;
     swbon_25 = 0;
     |SI anyofin ! 0;
          |SI anyofin ] anyocal;
               |SI anyofin = anyocal;
                    |SI mesfin ] mescal;
                         swBonif = 1;
                    |FINSI;
               |SINO;
                    swBonif = 1;
               |FINSI;
          |FINSI;
     |SINO;
          meses_bon = #13#14 + #13#15 + #13#16;
          |SI meses_bon ] 999;
               swBonif = 1;
          |SINO;
               meses_bon = meses_bon / 1000;
               fecha1 = #12#40;        || fecha alta bonif.
               fecha1 = fecha1 + meses_bon;
               alfa1 = fecha1;
               alfa2 = alfa1 % -104;
               alfa3 = alfa1 % 402;
               anyofin = alfa2;
               mesfin = alfa3;
               |SI anyofin ] anyocal;
                    |SI anyofin = anyocal;
                         |SI mesfin ] mescal;
                              swBonif = 1;
                         |FINSI;
                    |SINO;
                         swBonif = 1;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #labtraba#211 ! 0;
          swBonif = 1;
     |FINSI;
|FPRC;

|PROCESO prop_epig;
     base_C = 0;
     base_Ca = 0;
     base_Cb = 0;
     zbase_9 = 0;
     zbase_9a = 0;
     zbase_9b = 0;
     nBaseAlta = 0;
     nBaseBaja = 0;
     nBaseTotal = 0;
     swBonEpig = 0;

     |SI #13#8 = "S"; |Y #0#14 ! "L04";
          swBonEpig = 1;

          nBaseAlta = #11#27;
          nBaseBaja = #11#37 + #11#68;
          nBaseTotal = #11#27 + #11#37 + #11#68;

          nPorBon = #20#82;

          |DDEFECTO #nomepigr;
          |ABRE #nomepigr;

          |SI #0#18 [ 2006;
               nEpigConv = #labtraba#32;
          |SINO;
               |HAZ VerifCNAE;
          |FINSI;
          #nomepigr#0 = nEpigConv;
          |LEE 000#nomepigr.=;     || este el epigrafe de alta
          epig_ilt = #nomepigr#1;
          epig_ims = #nomepigr#2;

          |SI #0#18 [ 2009;
               |SI #0#18 [ 2006;
                    #nomepigr#0 = 126;
               |SINO;
                    #nomepigr#0 = 904;
               |FINSI;
          |SINO;
               || migue
               #nomepigr#0 = nEpigConv;
          |FINSI;

          |LEE 000#nomepigr.=;     || y este es el epigrafe de baja, el 126
          epig_ilt_126 = #nomepigr#1;
          epig_ims_126 = #nomepigr#2;

          |CIERRA #nomepigr;

          zbase_9a = nBaseAlta % (epig_ilt + epig_ims);
          zbase_9a = zbase_9a ! EURODB;      || cuota apig alta bonificada
          zbase_9b = nBaseBaja % (epig_ilt_126 + epig_ims_126);
          zbase_9b = zbase_9b ! EURODB;      || cuota epig baja bonificada

          zbase_9 = zbase_9a + zbase_9b;     || cuota tota epig bonificada
          base_C = zbase_9 % nPorBon;
          base_C = base_C ! EURODB;          || bonificacion total epigrafes

          base_Ca = zbase_9a % nPorBon;
          base_Ca = base_Ca ! EURODB;        || bonificacion alta epigrafes

          base_Cb = base_C - base_Ca;        || bonificacion baja epigrafes
     |FINSI;
|FPRC;

|PROCESO BonifFPCont;
     |SI #labempre#127 = 0;        || si hay recargo de mora no se bonifica
          |SI #14#118 = "X";
               swBonifFPCont = 1;
               nBonifFPCont = #14#167;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO calcula_bonif;
     bonifi = 0;
     reducc = 0;
     bonifi_25 = 0;
     subven = 0;
     sub85pre = 0;
     sub85dis = 0;
     bon_60 = 0;
     bon_55 = 0;
     swbon_65 = 0;
     swbon_21 = 0;
     swbon_25 = 0;
     swbon_31 = 0;
     swbon_34 = 0;

     || Nomina Normal: me traigo las bonificaciones:

     |ABRE #20;
     #20#0 = #11#0;
     #20#1 = #11#39;
     #20#2 = #0#1;
     #20#3 = #11#48;
     |LEE 000#20=;                 || lee calculos cabs.
     |SI FSalida = 0;
          |SI #20#63 ! 0;|O #20#64 ! 0;|O #20#81 ! 0;|O #20#92 ! 0; |O #20#95 ! 0;  || si tiene bonificacion
          |O #20#99 ! 0; |O #20#120 ! 0;
               |HAZ lee_bonif;                           || lee la bonificacion
               |SI #13#10 = 1;  reducc = #20#63 + #20#81;     |FINSI;
               |SI #13#10 = 2;  bonifi = #20#63 + #20#81;     |FINSI;
               |SI #13#10 = 3;  reducc = #20#63 + #20#81;     |FINSI;
               |SI #13#10 = 4;  reducc = #20#63 + #20#81; swbon_65 = 1;    |FINSI;
               |SI #13#10 = 5;  bonifi = #20#63 + #20#81; swbon_21 = 1;    |FINSI;
               |SI #13#0 = 521; |O #13#0 = 522;
                    bonifi_25 = (#20#43 % #13#5) ! 2;
               |FINSI;
               |SI #13#10 = 7;
                    nNume = #20#63 - bonifi_25;
                    reducc = (nNume / 2) ! 2;
                    bonifi = nNume - reducc;
               |FINSI;
               |SI #13#0 = 501; |O #13#0 = 502;
                    reducc = #20#63 + #20#81; swbon_31 = 1;
                    |SI #13#0 = 502; |Y #20#81 ! 0;
                         swbon_31 = 2;
                    |FINSI;
               |FINSI;
               |SI #13#0 = 505; |O #13#0 = 506;
                    reducc = #20#63 + #20#81; swbon_34 = 1;
               |FINSI;
               |HAZ bon_cd25;

               |SI #20#9 = 85; |O #20#9 = 97; |O #20#9 = 421; || formacion teorica
                    |SI #13#12 > 5;  || precio hora 8 euros pres., 5 dist.
                         sub85pre = #20#64;
                    |SINO;
                         sub85dis = #20#64;
                    |FINSI;
               |SINO;
                    subven = #20#64;
               |FINSI;
               |SI #20#92 ! 0;             || bonif. mayores 60 a¤os, RDL 16/2001
                    bon_60 = #20#92;
               |FINSI;
               |SI #20#95 ! 0;             || bonif. mayores 55 a¤os, textil
                    bon_55 = #20#95;
               |FINSI;
               |SI #20#99 ! 0;             || bonif. mayores 59 a¤os
                    reducc = reducc + #20#99;
               |FINSI;
               |SI #20#120 ! 0;
                    fFechaAlta = #labtraba#36;
                    fFechaRef = "31.08.2011";
                    |SI fFechaAlta ] fFechaRef;
                         |SI #20#9 = 422;
                              bonifi = #20#120; || miguebecarios desde 08/2014
                         |SINO;
                              reducc = #20#120;
                         |FINSI;
                    |SINO;
                         bonifi = #20#120;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI #20#94 ! 0; |O #20#112 ! 0;
               |SI #20#114 = 157; |O #20#114 = 158;
                    reducc = reducc + #20#94;
               |FINSI;
               |SI #20#115 = 157; |O #20#115 = 158;
                    reducc = reducc + #20#112;
               |FINSI;
          |FINSI;
          |HAZ prop_epig;
     |SINO;
          alfa1 = "    Calculo:["+#20#0+"]["+#20#1+"]["+#20#2+"]["+#20#3+"] inexistente ...";
          |MENAV alfa1;
     |FINSI;
     |CIERRA #20;
|FPRC;

|PROCESO separa_nom;
    alfa1 = #11#19; |QBF alfa1;
    alfa2 = alfa1 % 0;   para2 = alfa2;
    elsw4 = 0;
    apell1 = "";
    apell2 = "";
    nombre = "";
|PARA para1 = 1; |SI para1 [ para2; |HACIENDO para1 = para1 + 1;
        nume2 = (para1 * 100) + 1;
        alfa3 = alfa1 % nume2;
    |SI alfa3 = " ";|O alfa3 = ",";
        |SI apell1 ! "";
                elsw4 = elsw4 + 1;
        |FINSI;
        |SI elsw4 ] 2;|Y nombre ! "";
                nombre = nombre + alfa3;
        |FINSI;
    |SINO;
        |SI elsw4 = 0;  apell1 = apell1 + alfa3; |FINSI;
        |SI elsw4 = 1;  apell2 = apell2 + alfa3; |FINSI;
        |SI elsw4 ] 2;  nombre = nombre + alfa3; |FINSI;
    |FINSI;
|SIGUE;
    aAbreviado = (apell1 % 102) + (apell2 % 102) + (nombre % 101);
    aAbreviado = aAbreviado > aAbreviado;
|FPRC;

|PROCESO pasaaeuros_edl;
     |SI nSwitchEuro1 = 1;
          |ACABA;
     |FINSI;
     nPesetas = sub85dis; |HAZ euro; sub85dis = nEuros;
     nPesetas = sub85pre; |HAZ euro; sub85pre = nEuros;
     nPesetas = subven; |HAZ euro; subven = nEuros;
     nPesetas = bonifi; |HAZ euro; bonifi = nEuros;
     nPesetas = bonifi_25; |HAZ euro; bonifi_25 = nEuros;
     nPesetas = reducc; |HAZ euro; reducc = nEuros;
     nPesetas = bon_55; |HAZ euro; bon_55 = nEuros;
     nPesetas = bon_60; |HAZ euro; bon_60 = nEuros;
     nPesetas = #11#34; |HAZ euro; #11#34 = nEuros;
     nPesetas = #11#46; |HAZ euro; #11#46 = nEuros;
     nPesetas = #11#32; |HAZ euro; #11#32 = nEuros;
     nPesetas = #11#29; |HAZ euro; #11#29 = nEuros;
     nPesetas = #11#28; |HAZ euro; #11#28 = nEuros;
     nPesetas = #11#27; |HAZ euro; #11#27 = nEuros;
     nPesetas = #11#37; |HAZ euro; #11#37 = nEuros;
     nPesetas = #11#25; |HAZ euro; #11#25 = nEuros;
     nPesetas = #11#61; |HAZ euro; #11#61 = nEuros;
     nPesetas = #11#62; |HAZ euro; #11#62 = nEuros;
     nPesetas = #11#67; |HAZ euro; #11#67 = nEuros;
     nPesetas = #11#68; |HAZ euro; #11#68 = nEuros;
     nPesetas = #11#73; |HAZ euro; #11#73 = nEuros;
     nPesetas = #11#75; |HAZ euro; #11#75 = nEuros;
     nPesetas = #11#88; |HAZ euro; #11#88 = nEuros;
     nPesetas = #11#101; |HAZ euro; #11#101 = nEuros;
     nPesetas = #20#122; |HAZ euro; #20#122 = nEuros;
     nSwitchEuro1 = 1;
|FPRC;

|PROCESO pasaaeuros_edt;
     |SI nSwitchEuro2 = 1;
          |ACABA;
     |FINSI;
     nPesetas = #14#99; |HAZ euro; #14#99 = nEuros;
     nPesetas = #14#98; |HAZ euro; #14#98 = nEuros;
     nPesetas = #14#92; |HAZ euro; #14#92 = nEuros;
     nPesetas = #14#85; |HAZ euro; #14#85 = nEuros;
     nPesetas = #14#32; |HAZ euro; #14#32 = nEuros;
     nPesetas = #14#93; |HAZ euro; #14#93 = nEuros;
     nPesetas = #14#97; |HAZ euro; #14#97 = nEuros;
     nPesetas = tot_ca_86; |HAZ euro; tot_ca_86 = nEuros;
     nPesetas = #14#80; |HAZ euro; #14#80 = nEuros;
     nPesetas = #14#81; |HAZ euro; #14#81 = nEuros;
     nPesetas = #14#82; |HAZ euro; #14#82 = nEuros;
     nPesetas = #14#83; |HAZ euro; #14#83 = nEuros;
     nPesetas = #14#88; |HAZ euro; #14#88 = nEuros;
     nPesetas = #14#119; |HAZ euro; #14#119 = nEuros;
     nPesetas = #14#121; |HAZ euro; #14#121 = nEuros;
     nPesetas = #14#16; |HAZ euro; #14#16 = nEuros;
     nPesetas = #14#111; |HAZ euro; #14#111 = nEuros;
     nPesetas = #14#112; |HAZ euro; #14#112 = nEuros;
     nPesetas = #14#113; |HAZ euro; #14#113 = nEuros;
     nPesetas = #14#14; |HAZ euro; #14#14 = nEuros;
     nPesetas = #14#23; |HAZ euro; #14#23 = nEuros;
     nPesetas = #14#25; |HAZ euro; #14#25 = nEuros;
     nPesetas = #14#148; |HAZ euro; #14#148 = nEuros;
     nPesetas = #14#150; |HAZ euro; #14#150 = nEuros;
     nPesetas = #14#19; |HAZ euro; #14#19 = nEuros;
     nPesetas = #14#22; |HAZ euro; #14#22 = nEuros;
     nPesetas = nBonifFPCont; |HAZ euro; nBonifFPCont = nEuros;
     nPesetas = #14#168; |HAZ euro; #14#168 = nEuros;
     nPesetas = #14#169; |HAZ euro; #14#169 = nEuros;
     nPesetas = #14#170; |HAZ euro; #14#170 = nEuros;
     nSwitchEuro2 = 1;
|FPRC;

|PROCESO tope_parche22;
     |SI s_ori = "A"; |O s_ori = "T"; |ACABA; |FINSI;  || EN ATRASOS NO

     || Bueno, este proceso es para cubrir el siguiente caso: un trabajador
     || enfermo todo el mes que cotiza por el minimo en comunes y en profe-
     || sionales, porque su base IT era inferior al minimo, eso provoca que
     || la diferencia entre lo cotizado por CP y la base IT sea > 0. Eso
     || putea y bien debido a que esa diferencia la intenta poner como base
     || de prof. en alta y eso no esta bien, lo soluciono sumandosela a la
     || parte en baja, con ello consigo volver a tener la cantidad correcta
     ||SI #11#33 ] #11#20;     || todo el mes de baja
     |SI #11#33 = topemes;     || todo el mes de baja
          |SI #11#27 > 0;     || con una base el alta (no es correcto)
               nume1 = nume1 + #11#27; || le sumo la parte en alta
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tope_parche21;
     |SI s_ori = "A"; |O s_ori = "T"; |ACABA; |FINSI;  || EN ATRASOS NO

     || Bueno, este proceso es para cubrir el siguiente caso: un trabajador
     || enfermo todo el mes que cotiza por el minimo en comunes y en profe-
     || sionales, porque su base IT era inferior al minimo, eso provoca que
     || la diferencia entre lo cotizado por CP y la base IT sea > 0. Eso
     || putea y bien debido a que esa diferencia la intenta poner como base
     || de prof. en alta y eso no esta bien, lo soluciono sumandosela a la
     || parte en baja, con ello consigo volver a tener la cantidad correcta
     ||SI #11#33 ] #11#20;     || todo el mes de baja
     |SI #11#33 = topemes;     || todo el mes de baja
          |SI #11#27 > 0;     || con una base en alta (no es correcto)
               nume1 = 0;     || le anulo esta parte en alta
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tope_parche;
     |SI s_ori = "A"; |O s_ori = "T"; |ACABA; |FINSI;  || EN ATRASOS NO

     |HAZ lee_cons;
     || en el caso de que tengamos un trabajador que sea:
     || 1. Diario
     || 2. Que cotize al maximo (88.40 euros al dia)
     || 3. Que este todo el mes de baja
     || no sale bien el seguro social porque al hacer la base en baja, al
     || estar el maximo ha de coger para comunes el maximo de 31 dias y para
     || profesionales el maximo de 30, eso en alta no tiene problema, pero
     || en baja me guardo una sola base, asi que este proceso topea las
     || profesionales comprobando que no pase del maximo, pero solo ESE caso
     || es decir, controla solo que la base de profesionales en baja no sea
     || mayor que el tope de Profesionales que dice la Seg. Social: 2652 euros
     || esto es un arreglo cutre para Asecor, 25.11.2003

     nTope = #nomconst#20 * 30;
     nTope = nTope * 100;
     |SI nume1 > nTope;
          nume1 = nTope;
     |FINSI;
|FPRC;

|PROCESO tope_parcheCC;
     |SI s_ori = "A"; |O s_ori = "T"; |ACABA; |FINSI;  || EN ATRASOS NO

     |HAZ lee_cons;
     || este proceso es como el otro pero para topear las comunes
     nTope = #nomconst#20 * 30;
     nTope = nTope * 100;
     |SI nBaseCC > nTope;
          nBaseCC = nTope;
     |FINSI;
|FPRC;
____________________________________/ CARGA DE LOS DIFERENTES REGISTROS
|PROCESO actua_registro;
|ABRE #7;
    #7#0 = #6#0;         || empresa
    #7#1 = #0#2;         || nro.lote
    #7#2 = #0#5;         || indicador
|LEE 101#7=;
    FEstado = FSalida;

    #7#3 = #0#18;        || a¤o lote
    #7#4 = #0#1;         || mes
    #7#5 = ~;            || fecha envio
    #7#6 = "01.01.1900"; || fecha comprobacion
    #7#7 = "FAN";        || tipo lote

|SI FEstado = 0;    |GRABA 020#7a; |FINSI;
|SI FEstado ! 0;    |GRABA 020#7n; |FINSI;
|LIBERA #7;
|CIERRA #7;
|FPRC;

|PROCESO etf;
    clave = "ETF";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        #3#0  = "TC22";
        #3#1  = "0";
        #3#2  = "VIP2";
        #3#3  = "1";
        #3#4  = aAutorizacion;         || clave autorizacion
        #3#5  = #1#1;         || clave SILCON
        fech1 = ~;
    |HAZ fecha;
        #3#6  = for_fecha;    || fecha
    ||HAZ hora;
        #3#7  = for_hora;     || hora
        #3#8  = fichero;      || fichero
        #3#9  = extension;    || sufijo
        #3#10 = "N";          || codigo prioridad
        #3#11 = indica;       || indicador
        #3#12 = tot_emp;      || total segmentos EMP
        #3#13 = nlinea;       || total segmentos
        #3#14 = "";           || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO dba;
fech1 = ~;
fech2 = "01.03.2003";
nume1 = fech1;
nume2 = fech2;
|SI nume1 ] nume2;     |ACABA;   |FINSI;     || tendria que hacer el MPG
    clave = "DBA";
|HAZ ini_linea;
||SI sw_auxil = 0;|Y #0#14 = "L00";
|SI sw_auxil = 0;
    |SI #14#99 ! 0;|O #6#7 ! "N";  || si es negativo o es adeudo en cuenta
        |DDEFECTO #3;
        #6#7 = "C";   || hasta que solo sirva el mpg
        |SI #14#99 = 0;|Y #6#7 ! "N";
                #3#0  = "C";       || solicitud adeudo en cuenta
        |SINO;
                #3#0  = " ";       || solicitud saldo acreedor
        |FINSI;
            #3#1  = #10#113;      || cuenta cliente cargo
            alfa1 = #10#10 % 101; || tipo identificador titular
        |SI alfa1 ] "0";|Y alfa1 [ "9";
                #3#2 = "1";            || tipo identificacion DNI
        |SINO;
            |SI alfa1 = "X"; |O alfa1 = "Y"; |O alfa1 = "Z";       || extranjero
                    #3#2 = "6";        || tipo identificacion EXTRANJERO
            |SINO;
                |SI alfa1 ] "a";|Y alfa1 [ "z";
                        #3#2 = "2";    || tipo identificacion PASAPORTE
                |SINO;
                        #3#2 = "9";    || tipo identificacion CIF
                |FINSI;
            |FINSI;
        |FINSI;
            #3#3  = #10#10;       || identificador titular (CIF EMPRESA)
            #3#4  = #10#2;        || nombre del titular (NOMBRE EMPRESA)
        |HAZ monta;
        |HAZ fin_linea;
    |SINO;
        |HAZ fin_linea2;
    |FINSI;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO mpg;
fech1 = ~;
fech2 = "01.03.2003";
nume1 = fech1;
nume2 = fech2;
|SI nume1 < nume2;     |ACABA;   |FINSI;  || tendria que hacer el DBA
    clave = "MPG";
|HAZ ini_linea;
|| SI sw_auxil = 0; |Y #0#14 = "L00";
|SI sw_auxil = 0;
    |SI #0#12 ! "C"; |O #0#14 = "L02";
         |SI #14#99 ! 0;|O #6#7 ! "N";  || si es negativo o es adeudo en cuenta
             |DDEFECTO #3;              || o pago por ventanilla
             |SI #6#7 = "S"; #6#7 = "C"; |FINSI;
             |SI #14#99 = 0;|Y #6#7 ! "N";
                     #3#0  = #6#7;      || solicitud adeudo en cuenta o ventanilla
             |SINO;
                     #3#0  = " ";       || solicitud saldo acreedor
             |FINSI;
             alfa1 = #3#0;
             |QBF alfa1;
             |SI alfa1 ! "V";           || CCC,Tipo Id. y Id. titular
                 #3#1  = #10#113;      || cuenta cliente cargo
                 alfa1 = #10#10 % 101; || tipo identificador titular
                 |SI alfa1 ] "0";|Y alfa1 [ "9";
                     #3#2 = "1";            || tipo identificacion DNI
                 |SINO;
                     |SI alfa1 = "X"; |O alfa1 = "Y"; |O alfa1 = "Z";       || extranjero
                         #3#2 = "6";        || tipo identificacion EXTRANJERO
                     |SINO;
                         |SI alfa1 ] "a";|Y alfa1 [ "z";
                             #3#2 = "2";    || tipo identificacion PASAPORTE
                         |SINO;
                             #3#2 = "9";    || tipo identificacion CIF
                         |FINSI;
                     |FINSI;
                 |FINSI;
                 alfa1 = #10#10;
                 |QBF alfa1;
                 alfa1 = "00000000000000" + alfa1;
                 alfa1 = alfa1 % -114;
                 #3#3  = alfa1;       || identificador titular (CIF EMPRESA)
                 || lo ajusto yo con ceros por la izda pq tiene que ir ajustado
                 || asi cuando no sea pago por ventanilla y en blanco (sin ceros)
                 || cuando sea pago por ventanilla
                 alfa1 = #3#0;
                 |QBF alfa1;
                 |SI alfa1 = "";
                     #3#4  = #10#2;        || nombre del titular (NOMBRE EMPRESA)
                 |FINSI;
             |FINSI;
             |HAZ monta;
             |HAZ fin_linea;
         |SINO;
             |HAZ fin_linea2;
         |FINSI;
    |SINO;
         |HAZ fin_linea2;
    |FINSI;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_TT_92;
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#99 ! 0;
    |DDEFECTO #3;
        #3#0  = "TT";              || tipo elemento datos
        #3#1  = "92";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = #14#99;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_TT_91;
    clave = "EDT";
|HAZ ini_linea;
|SI #0#14 = "L04";
     #14#98 = #14#92 + #14#32 + #14#85 + #14#97;
     #14#99 = 0;
|FINSI;
swSigue = 0;
|SI #14#98 ! 0; swSigue = 1; |FINSI;
|SI #14#98 = 0; |Y #14#99 = 0; swSigue = 1; |FINSI;
|SI sw_auxil = 0; |Y swSigue = 1;
    |DDEFECTO #3;
        #3#0  = "TT";              || tipo elemento datos
        #3#1  = "91";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = #14#98;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_TT_30;
    clave = "EDT";
|HAZ ini_linea;
|SI #0#14 = "L04";
     #14#92 = tot_cd_07 + tot_cd_16 + tot_cd_10 + tot_cd_11 + tot_cd_13
     #14#92 = #14#92 + tot_cd_21 + tot_cd_22 + tot_cd_23 + tot_cd_25 + tot_cd_28;
|FINSI;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        #3#0  = "TT";              || tipo elemento datos
        #3#1  = "30";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#8  = "";                || signo
        nume1 = #14#92;
    |SI nume1 < 0;  nume1 = nume1 * -1; #3#8 = "-";   |FINSI;
        #3#7  = nume1;             || importe o cuota
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_TT_20;
    clave = "EDT";
|HAZ ini_linea;
|SI #0#14 = "L04";
     #14#85 = tot_cd_03;
|FINSI;
|SI sw_auxil = 0;|Y #14#85 ! 0;
    |DDEFECTO #3;
        #3#0  = "TT";              || tipo elemento datos
        #3#1  = "20";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#8  = "";                || signo
        nume1 = #14#85;
    |SI nume1 < 0;  nume1 = nume1 * -1; #3#8 = "-";   |FINSI;
        #3#7  = nume1;             || importe o cuota
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_TT_10;
    clave = "EDT";
|HAZ ini_linea;
|SI #0#14 = "L04";
     #14#32 = tot_cd_01 + tot_cd_02 + tot_cd_06 + tot_cd_17;
     #14#32 = #14#32 + tot_cd_31 + tot_cd_34;
|FINSI;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        #3#0  = "TT";              || tipo elemento datos
        #3#1  = "10";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#8  = "";                || signo
        nume1 = #14#32;
    |SI nume1 < 0;  nume1 = nume1 * -1; #3#8 = "-";   |FINSI;
        #3#7  = nume1;             || importe o cuota
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_90;                || recargo de mora
    clave = "EDT";
|HAZ ini_linea;
|SI #0#14 = "L04";
     || el total de todo
     nume1 = tot_cd_01 + tot_cd_03 + tot_cd_06 + tot_cd_17;
     nume1 = nume1 + tot_cd_07 + tot_cd_16 + tot_cd_10 + tot_cd_11 + tot_cd_13;
     nume1 = nume1 + tot_cd_22 + tot_cd_28 + tot_cd_31 + tot_cd_34;
     #14#93 = nume1;
     #14#93 = #14#93 / 100;        || paso a decimales
     #14#97 = (#14#93 % #14#94) ! EURODB;
     #14#93 = #14#93 * 100;
     #14#97 = #14#97 * 100;
|FINSI;

|SI sw_auxil = 0;|Y #14#94 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "90";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = #14#93;            || base
        #3#4  = "T";               || indicador de factor o tipo
        descom = #14#94;
    |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#97;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_60;                || bonificaciones + subvenciones
    clave = "EDT";
|HAZ ini_linea;
    nume1 = tot_cd_07 + tot_cd_08 + tot_cd_10 + tot_cd_11 + tot_cd_13 + tot_cd_16;
    nume1 = nume1 + tot_cd_21 + tot_cd_22 + tot_cd_23 + tot_cd_25 + tot_cd_33;
    nume1 = nume1 + nBonifFPCont + tot_cd_28;
|SI sw_auxil = 0;|Y nume1 ! 0;     || antes ponia el #14#104
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "60";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = nume1;             || importe o cuota
        #3#8  = aSigno;                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_80;                || bonificaciones + subvenciones
    clave = "EDT";
|HAZ ini_linea;
    nume1 = nBonifFPCont;
|SI sw_auxil = 0;|Y nume1 ! 0; |Y swBonifFPCont = 1;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "80";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = nume1;             || importe o cuota
        #3#8  = aSigno;                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_57;                || Cuota empresarial por AT-EP (maternidad)
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#148 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "57";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = #14#148;           || base
        #3#4  = "T";               || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = #14#150;           || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_50;                || bases y cuotas D+F+P
    clave = "EDT";
|HAZ ini_linea;
|SI #20#9 = 97; |O #20#9 = 85; |O #20#9 = 421;    || parche feo para formacion, estos no lle-
     #14#80 = #14#80 + 1;          || van base pero si cuota asi que sumo 1
|FINSI;                            || para que entre
|SI sw_auxil = 0;|Y #14#80 ! 0; |Y #14#88 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "50";              || clave
        #3#2  = "";                || calificador clave
    |SI #20#9 = 97; |O #20#9 = 85; |O #20#9 = 421; || parche feo para formacion, quito lo
        #14#80 = #14#80 - 1;           || que les sume
    |FINSI;                            || para que entrara
        #3#3  = #14#80;            || base
        #3#4  = "T";               || indicador de factor o tipo
        descom = #14#86;
    |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#88;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_32;                || cuotas epigrafes IMS
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#82 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "32";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = #14#82;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_31;                || cuotas epigrafes ILT
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#81 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "31";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = #14#81;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_30;

    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#83 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "30";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = #14#83;                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_22;      || ILT enf.comun + maternidad + reducciones
    clave = "EDT";
|HAZ ini_linea;
    nume1 = tot_cd_01 + tot_cd_02 + tot_cd_06 + tot_cd_17 + tot_cd_31 + tot_cd_34;
|SI sw_auxil = 0;|Y nume1 ! 0;     || antes ponia el #14#31
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "22";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = nume1;             || importe o cuota
        #3#8  = aSigno;                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_21;                || deduccion voluntaria enf.comun
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#120 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "21";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = #14#119;           || base
        #3#4  = "T";               || indicador de factor o tipo
        descom = #14#120;
    |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#121;           || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_20;                || contingencias excluidas
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#110 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "20";              || clave
        #3#2  = "";                || calificador clave
        nume1 = (#14#16 + #14#25);            || base
        #3#3  = nume1;
        #3#4  = "T";               || indicador de factor o tipo
        descom = #14#110;
    |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#111;           || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_11;                || otros conceptos
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#113 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "11";              || clave
        #3#2  = #14#146;           || calificador clave
        #3#3  = #14#112;           || base
        #3#4  = "T";               || indicador de factor o tipo
        descom = #14#114;
    |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#113;           || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_02;                || Cuota Empresarial Cont. Comunes
     clave = "EDT";
     |HAZ ini_linea;
     |SI #20#9 = 97; |O #20#9 = 85; |O #20#9 = 421; || parche feo para formacion, estos no lle-
          |SI #14#25 ! 0;               || van base pero si cuota asi que sumo 1
               #14#23 = #14#23 + 1;     || para que entre
          |FINSI;
     |FINSI;
     |SI sw_auxil = 0;|Y #14#23 ! 0;
          |DDEFECTO #3;
          #3#0  = "CA";              || tipo elemento datos
          #3#1  = "02";              || clave
          #3#2  = "";                || calificador clave
          |SI #20#9 = 97; |O #20#9 = 85; |O #20#9 = 421; || parche feo para formacion, quito lo
               |SI #14#25 ! 0;            || van base pero si cuota asi que sumo 1
                    #14#23 = #14#23 - 1;   || que les sume
               |FINSI;                    || para que entrara
          |FINSI;
          #3#3  = #14#23;            || base
          #3#4  = "T";               || indicador de factor o tipo
          descom = #14#24;
          |HAZ descompone;
          #3#5  = entero;            || parte entera de tipo
          #3#6  = decima;            || parte decimal de factor o tipo
          #3#7  = #14#25;            || importe o cuota
          #3#8  = "";                || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CA_01;                || contingencias comunes
     clave = "EDT";
     |HAZ ini_linea;
     |SI #20#9 = 97; |O #20#9 = 85; |O #20#9 = 421; |O #20#9 = 422; || parche feo para formacion, estos no lle-
          |SI #14#16 ! 0;               || van base pero si cuota asi que sumo 1
               #14#14 = #14#14 + 1;     || para que entre
          |FINSI;
     |FINSI;
     |SI sw_auxil = 0;|Y #14#14 ! 0;
          |DDEFECTO #3;
          #3#0  = "CA";              || tipo elemento datos
          #3#1  = "01";              || clave
          #3#2  = "";                || calificador clave
          |SI #20#9 = 97; |O #20#9 = 85; |O #20#9 = 421; |O #20#9 = 422; || parche feo para formacion, quito lo
               |SI #14#16 ! 0;            || van base pero si cuota asi que sumo 1
                    #14#14 = #14#14 - 1;   || que les sume
               |FINSI;                    || para que entrara
          |FINSI;
          #3#3  = #14#14;            || base
          #3#4  = "T";               || indicador de factor o tipo
          descom = #14#15;
          |HAZ descompone;
          #3#5  = entero;            || parte entera de tipo
          #3#6  = decima;            || parte decimal de factor o tipo
          #3#7  = #14#16;            || importe o cuota
          #3#8  = "";                || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CD_23;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_23 = tot_cd_23 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_23 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "23";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_23;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_22;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_22 = tot_cd_22 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_22 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "22";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_22;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_21;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_21 = tot_cd_21 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_21 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "21";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_21;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_17;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_17 = tot_cd_17 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_17 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "17";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_17;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_16;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_16 = tot_cd_16 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_16 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "16";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_16;         || importe o cuota
        #3#8  = aSigno;                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_13;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_13 = tot_cd_13 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_13 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "13";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_13;         || importe o cuota
        #3#8  = aSigno;                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_11;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_11 = tot_cd_11 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_11 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "11";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_11;         || importe o cuota
        #3#8  = aSigno;                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_10;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_10 = tot_cd_10 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_10 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "10";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_10;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_08;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_08 = tot_cd_08 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_08 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "08";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_08;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_07;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_07 = tot_cd_07 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_07 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "07";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_07;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_06;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_06 = tot_cd_06 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_06 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "06";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_06;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_03;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_03 = tot_cd_03 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_03 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "03";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_03;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_01;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_01 = tot_cd_01 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_01 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "01";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_01;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_42;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_42 = tot_ba_42 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_42 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "42";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_42;         || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_22;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_22 = tot_ba_22 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_22 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "22";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_22;         || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_21;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_21 = tot_ba_21 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_21 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "21";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_21;         || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC

|PROCESO edt_BA_11;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_11 = tot_ba_11 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_11 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "11";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_11;         || base
        #3#4  = "";                || indicador de factor o tipo
        descom = #14#21;
        |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#22;                || importe o cuota
        || #3#5  = "";                || parte entera de tipo
        || #3#6  = "";                || parte decimal de factor o tipo
        || #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_10;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_10 = tot_ba_10 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_10 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "10";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_10;         || base
        #3#4  = "";                || indicador de factor o tipo
        descom = #14#18;
        |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#19;                || importe o cuota
        || #3#5  = "";                || parte entera de tipo
        || #3#6  = "";                || parte decimal de factor o tipo
        || #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_06;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_06 = tot_ba_06 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_06 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "06";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_06;         || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_02;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_02 = tot_ba_02 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_02 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "02";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_02;         || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_01;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_01 = tot_ba_01 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_01 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "01";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_01;         || base (la cogemos del auxiliar para)
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO tct;
    clave = "TCT";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        #3#0  = "0";          || modalidad pago (normal)
        #3#1  = #11#2;        || clave entidad
        #3#2  = nro_trab;     || nro.trabajadores
        #3#3  = "";           || tipo exp.
        #3#4  = "";           || a¤o exp.
        #3#5  = "";           || referencia exp.
        #3#6  = "";           || indicador cargo en cuenta (RESERVADO)
        #3#7  = "";           || codigo cuenta (RESERVADO)
        #3#8  = "";           || reservado
        #3#9  = "";           || reservado
        #3#10  = "";           || fecha de control (solo en L03)
    |SI #0#12 = "A";|O #0#12 = "T"; |O #0#14 = "L02";
            #3#10 = #0#10;
    |FINSI;
        #3#11 = "";           || 6, 7, 8, 9 y 11 son de nueva creacion para
                              || los agrarios, la fecha control pasa al 10
    |HAZ monta;               || 12/2002
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO AjustaPFE;
     nDiasMes = 0;
     nAjustePFE = 0;
     nume1 = 0;
     |SI #0#17 = 2;
          nMes = nMesVac;
          |HAZ ultimo_dia;
          aAlfa = #20#5; aAlfa = aAlfa % 402;
          nNume = aAlfa;
          |SI nDiasVac > nDiasDisp;     || usare hasta final de mes
          |Y topemes = 31;              || es un mes de 31 dias
          |Y #labtraba#42 = "M";        || soy mensual
          |Y nMes = nNume;
               nDiasDisp = nDiasDisp - 1;   || tengo que quitar la
          |FINSI;                       || bonif del dia 31, si no me pasare
          |SI nDiasDisp < 0; nDiasDisp = 0; |FINSI;

          nDias = nDiasDisp;
          nDiasMes = nDiasVac;
          |SI swVengoDe = 22;
               nBase = nBonifFCI_vac;
          |FINSI;

          |ACABA;
     |FINSI;

     |ABRE #nombotra;
     #nombotra#0 = #labtraba#0;
     #nombotra#1 = #labtraba#1;
     #nombotra#2 = nBonif;
     |LEE 000#nombotra.=;
     |CIERRA #nombotra;

     |HAZ Busca111;

     nDiasMes = nDiasAlta + nDiasIT + nDiasMate + nDiasExp;

     |SI nDiasMes > 30;
          nAjustePFE = 1;
     |FINSI;
     |SI nDiasMes ] 28; |Y #0#1 = 2;
          |SI nDiasMes = 28;
               nAjustePFE = -2;
          |FINSI;
          |SI nDiasMes = 29;
               nAjustePFE = -1;
          |FINSI;
     |FINSI;
     |SI eldat = 1;
          nDias = nDiasAlta;
     |FINSI;
     |SI eldat = 2;
          nDias = nDiasIT;
     |FINSI;
     |SI eldat = 3;
          nDias = nDiasMate;
     |FINSI;
     |SI eldat = 4;
          nDias = nDiasExp;
     |FINSI;
     |SI nAjustePFE ! 0;
          nDiasMes = nDiasMes - nAjustePFE;
     |FINSI;

     |SI eldat = 1;
          nume1 = nDiasIT + nDiasMate + nDiasExp;
          |SI nDias > 0; |Y nume1 = 0;
               |SI nAjustePFE ! 0;
                    nDias = nDias - nAjustePFE;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI eldat = 2;
          nume1 = nDiasIT;
          |SI nAjustePFE ! 0; |Y nume1 > 0;
               nDias = nDias - nAjustePFE;
          |FINSI;
     |FINSI;
     |SI eldat = 3;
          nume1 = nDiasMate;
          |SI nAjustePFE ! 0; |Y nume1 > 0;
               |SI nDiasIT = 0;                   || si ya he ajustado por IT
                    nDias = nDias - nAjustePFE;   || no le tengo que volver a
               |FINSI;                            || ajustar en maternidad
          |FINSI;
     |FINSI;
     |SI eldat = 4;
          nume1 = nDiasExp;
          |SI nAjustePFE ! 0; |Y nume1 > 0;
               |SI nDiasIT = 0;                   || si ya he ajustado por IT
                    nDias = nDias - nAjustePFE;   || no le tengo que volver a
               |FINSI;                            || ajustar en maternidad
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO edl_CD_23_bon;
     |SI nVeces = 2; |Y nVez = 2; |ACABA; |FINSI;
     clave = "EDL";
     |HAZ ini_linea;
     nBase55 = bon_55;
     |SI eldat = 1;
          nBase55 = nBase55 / 100;   || vuelvo a 2 decimales
          |SI nVeces = 2;
               bon_55_Alta = nBase55 * nProp55_A;
          |SINO;
               bon_55_Alta = nBase55 * nPropAlta;
          |FINSI;
          bon_55_Alta = (bon_55_Alta * 100) ! 0;   || vuelvo en centimos
          nBase55 = bon_55_Alta;
     |SINO;
          nBase55 = bon_55 - bon_55_Alta;
          nBase55 = nBase55 ! 0;
     |FINSI;

     nBase = #11#75;
     swVengoDe = 23;
     |HAZ AjustaPFE;

     nBase = nBase / 100;
     nBase = (((nBase / nDiasMes) ! 2) * nDias) ! 2;
     nBase = nBase * 100;
     nBase = nBase + nBase55;

     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0; |Y nDias ! 0;
          nEdadParaBon = 55;
          |HAZ fecha_bon_16;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "23";
          nume1 = #11#20 ! 0;
          |SI #0#17 = 2;
               nume1 = nDias ! 0;
          |FINSI;

          |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
               #3#2  = 0;             || elemento
          |SINO;
               #3#2  = nume1;             || elemento
          |FINSI;

          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = "03";              || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          ||HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada

          |ABRE #nombotra;
          #nombotra#0 = #labtraba#0;
          #nombotra#1 = #labtraba#1;
          #nombotra#2 = nBonif;
          |LEE 000#nombotra.=;
          |SI FSalida = 0; |O bon_55 > 0;
               |SI aParam = "TC2";
                    fech1 = #nombotra#4;     || se guarda la fecha para el TC2
                    |SI bon_55 > 0; fech1 = fecha_bon_16; |FINSI;
                    |HAZ fechaTC2;
                    #3#7 = for_fecha;
                    fech1 = #nombotra#5;     || se guarda la fecha para el TC2
                    |SI bon_55 > 0; fech1 = fecha_fin_16; |FINSI;
                    |SI fech1 = "31.12.9999"; fech1 = ""; |FINSI;
                    |HAZ fechaTC2;
                    #3#8 = for_fecha;
               |SINO;
                    fech1 = #nombotra#4;     || fecha resolucion (bonificacion)
                    |SI bon_55 > 0; fech1 = fecha_bon_16; |FINSI;
                    |HAZ fecha;
                    #3#6 = for_fecha;
                    #3#7  = for_fecha;
                    fech1 = #nombotra#5;     || fecha resolucion (bonificacion)
                    |SI bon_55 > 0; fech1 = fecha_fin_16; |FINSI;
                    |SI fech1 = "31.12.9999"; fech1 = ""; |FINSI;
                    |HAZ fecha;
                    #3#8  = for_fecha;
               |FINSI;
          |FINSI;
          |CIERRA #nombotra;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_23 = tot_cd_23 + nBase;
          tottracd23 = tottracd23 + nBase;

          nume4 = #11#75 - tottracd23;
          |SI nume4 ! 0; |Y nume4 ] -25; |Y nume4 [ 25;
          || se habran provocado diferencias
               nBase = nBase + nume4;
               #3#3  = nBase;
               tot_cd_23 = tot_cd_23 + nume4;
          |FINSI;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO nombotra;
     nBonif = #nombotra#2;
     |ERROR10;
|FPRC;

|DEFBUCLE nombotra;
     #nombotra#1;
     ;
     #labtraba#0, #labtraba#1, 001;
     #labtraba#0, #labtraba#1, 999;
     ;
     NULL, nombotra;
|FIN;

|PROCESO edl_CD_23;
     nBase = #20#96;
     |SI nBase ! 0;
          nBonif = #20#116;
          |SI nBonif = 0;
               |BUCLE nombotra;
          |FINSI;
          |HAZ edl_CD_23_bon;
     |FINSI;

     nBase = #20#113;
     |SI nBase ! 0;
          nBonif = #20#117;
          |HAZ edl_CD_23_bon;
     |FINSI;
|FPRC;

|PROCESO edl_CD_22_bon;
     clave = "EDL";
     |HAZ ini_linea;
     nBase = #11#73;

     swVengoDe = 22;
     |HAZ AjustaPFE;

     nBase = nBase / 100;
     nBase = (((nBase / nDiasMes) ! 2) * nDias) ! 2;
     nBase = (nBase * 100);

     |SI #0#14 = "L04";
          nBase = #11#73;
          nDias = 30;         || (por ejemplo, para que salga algo)
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0; |Y nDias ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "22";
          || nume1 = #11#20 ! 0;
          nume1 = nDias ! 0;
          |SI #0#17 = 2;
               nume1 = nDias ! 0;
          |FINSI;
          |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
               #3#2  = 0;             || elemento
          |SINO;
               #3#2  = nume1;             || elemento
          |FINSI;

          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          ||HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada

          |ABRE #nombotra;
          #nombotra#0 = #labtraba#0;
          #nombotra#1 = #labtraba#1;
          #nombotra#2 = nBonif;
          |LEE 000#nombotra.=;
          |SI FSalida = 0;
               |SI aParam = "TC2";
                    fech1 = #nombotra#4;     || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#7 = for_fecha;
                    fech1 = #nombotra#5;     || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#8 = for_fecha;
               |SINO;
                    fech1 = #nombotra#4;     || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#7  = for_fecha;
                    fech1 = #nombotra#5;     || fecha resolucion (bonificacion)
                    |SI fech1 = "31.12.9999"; fech1 = ""; |FINSI;
                    |HAZ fecha;
                    #3#8  = for_fecha;
               |FINSI;
          |FINSI;
          |CIERRA #nombotra;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_22 = tot_cd_22 + nBase;
          tottracd22 = tottracd22 + nBase;

          nume4 = #11#73 - tottracd22;
          |SI nume4 ! 0; |Y nume4 ] -25; |Y nume4 [ 25;
          || se habran provocado diferencias
               nBase = nBase + nume4;
               #3#3  = nBase;
               tot_cd_22 = tot_cd_22 + nume4;
          |FINSI;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_22;
     nBase = #20#94;
     |SI nBase ! 0;
          nBonif = #20#114;
          |SI nBonif = 0;
               |BUCLE nombotra;
          |FINSI;
          |SI nBonif ! 157; |Y nBonif ! 158;
               |HAZ edl_CD_22_bon;
          |FINSI;
     |FINSI;

     nBase = #20#112;
     |SI nBase ! 0;
          nBonif = #20#115;
          |SI nBonif ! 157; |Y nBonif ! 158;
               |HAZ edl_CD_22_bon;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO edl_CD_16;
     |SI nVeces = 2; |Y nVez = 1; |ACABA; |FINSI;
     clave = "EDL";
     |HAZ ini_linea;
     nBase = bon_60;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          bon_60_Alta = nBase * nPropAlta;
          bon_60_Alta = (bon_60_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = bon_60_Alta;
     |SINO;
          nBase = bon_60 - bon_60_Alta;
          nBase = nBase ! 0;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0; |Y nBase ! 0;
          nEdadParaBon = 60;
          |HAZ fecha_bon_16;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "16";              || clave compensacion reducciones
          nume1 = d_alta;
          #3#2  = nume1;             || elemento
          |SI dias_bon_16 ! 0;
               #3#2 = dias_bon_16;
          |FINSI;
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |SI fecha_fin_16 ! "";
               |SI aParam = "TC2";
                    fech1 = fecha_fin_16;
                    |HAZ fechaTC2;
                    #3#8 = for_fecha;
               |SINO;
                    fech1 = fecha_fin_16;
                    |HAZ fecha;
                    #3#8 = for_fecha;
               |FINSI;
          |FINSI;
          #3#9  = "R.D.Ley 16/2001"; || referencia asociada
          |SI aParam = "TC2";
               fech1 = fecha_bon_16;        || se guarda la fecha para el TC2
               |HAZ fechaTC2;
               #3#7 = for_fecha;
          |SINO;
               fech1 = fecha_bon_16;  || fecha resolucion (subvencion)
               |HAZ fecha;
               #3#7  = for_fecha;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_cd_16 = tot_cd_16 + nBase;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_11;
     clave = "EDL";
     |HAZ ini_linea;
     nBase = sub85dis;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          sub85dis_Alta = nBase * nPropAlta;
          sub85dis_Alta = (sub85dis_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = sub85dis_Alta;
     |SINO;
          nBase = sub85dis - sub85dis_Alta;
          nBase = nBase ! 0;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "11";              || clave compensacion reducciones
          nume1 = #20#101;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (subvencion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_cd_11 = tot_cd_11 + nBase;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_10;
     clave = "EDL";
     |HAZ ini_linea;
     nBase = sub85pre;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          sub85pre_Alta = nBase * nPropAlta;
          sub85pre_Alta = (sub85pre_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = sub85pre_Alta;
     |SINO;
          nBase = sub85pre - sub85pre_Alta;
          nBase = nBase ! 0;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "10";              || clave compensacion reducciones
          nume1 = #20#101;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (subvencion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_cd_10 = tot_cd_10 + nBase;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_08;
     clave = "EDL";
     |HAZ ini_linea;
     nBase = subven;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          subven_Alta = nBase * nPropAlta;
          subven_Alta = (subven_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = subven_Alta;
     |SINO;
          nBase = subven - subven_Alta;
          nBase = nBase ! 0;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "08";              || clave compensacion reducciones
          nume1 = #11#20 ! 0;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "5";           || tipo de resolucion (subvencion)
                    fech1 = #12#40;        || fecha resolucion (subvencion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_cd_08 = tot_cd_08 + nBase;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_07;
     |SI swbon_21 ! 0; |O swbon_25 ! 0; |O swbon_34 ! 0;
          |ACABA;
     |FINSI;
     clave = "EDL";
     |HAZ ini_linea;
     nBase = bonifi;
     |HAZ ParcheBonifMat_1;
     |HAZ ParcheBonifMat_3;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          |SI swBonEpig = 1;
               nBase = nBase - base_C;  || no porporciono bonif epig
          |FINSI;
          |SI nVeces = 2;
               |SI nVez = 1;
                    ||SI swredbonsim = 1;
                    ||     bonifi_Alta = nBase * 1 * nProp55_A;
                    ||SINO;
                         bonifi_Alta = nBase * nProp55 * nProp55_A;
                    ||FINSI;
               |FINSI;
               |SI nVez = 2;
                    ||SI swredbonsim = 1;
                    ||     bonifi_Alta = nBase * 0 * nProp60_A;
                    ||SINO;
                         bonifi_Alta = nBase * nProp60 * nProp60_A;
                    ||FINSI;
               |FINSI;
          |SINO;
               bonifi_Alta = nBase * nPropAlta;
          |FINSI;
          |SI swBonEpig = 1;
               bonifi_Alta = bonifi_Alta + base_Ca;
          |FINSI;
          bonifi_Alta = (bonifi_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = bonifi_Alta;
     |SINO;
          |SI nPropMat ! 0;   || ojo, es un mes entero de baja, con dias
                              || en maternidad
               nBase = nBase / 100;   || vuelvo a 2 decimales
               |SI eldat = 2;
                    bonifi_Baja = nBase * nPropBaja;
                    bonifi_Baja = (bonifi_Baja * 100) ! 0;   || vuelvo en centimos
                    nBase = bonifi_Baja;
               |FINSI;
               |SI eldat = 3;
                    nBase = bonifi - bonifi_Baja;
               |FINSI;
          |SINO;              || como siempre
               |SI nVeces = 2;
                    |SI nVez = 1;
                         ||SI swredbonsim = 1;
                         ||     bonifi_Baja = nBase * 1 * nProp55_IT;
                         ||SINO;
                              bonifi_Baja = nBase * nProp55 * nProp55_IT;
                         ||FINSI;
                    |FINSI;
                    |SI nVez = 2;
                         ||SI swredbonsim = 1;
                         ||     bonifi_Baja = nBase * 0 * nProp60_IT;
                         ||SINO;
                              bonifi_Baja = nBase * nProp60 * nProp60_IT;
                         ||FINSI;
                    |FINSI;
                    nBase = bonifi_Baja;
               |SINO;
                    nBase = bonifi - bonifi_Alta;
               |FINSI;
               nBase = nBase ! 0;
          |FINSI;
     |FINSI;

     |HAZ ParcheBonifMat_2;
     |HAZ ParcheBonifMat_4;

     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0; |Y bonifi ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          |HAZ lee_bonif;
          aAlfa = #13#13; |QBF aAlfa; aAlfa = "000" + aAlfa; aAlfa = aAlfa % -102;
          |SI aAlfa ! "13";
               #3#1  = "07";              || clave compensacion reducciones
               tot_cd_07 = tot_cd_07 + nBase;
          |SINO;
               #3#1  = "13";              || clave compensacion reducciones 39
               tot_cd_13 = tot_cd_13 + nBase;
          |FINSI;
          |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
               nume1 = #11#20 ! 0;
          |SINO;
               nume1 = d_alta;
          |FINSI;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_06;
     clave = "EDL";
     |HAZ ini_linea;
     nBase = reducc;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          |SI swBonEpig = 1;
               nBase = nBase - base_C;  || no porporciono bonif epig
          |FINSI;
          |SI nVeces = 2;
               |SI nVez = 1;
                    |SI swredbonsim = 1;
                         reducc_Alta = nBase * 0 * nProp55_A;
                    |SINO;
                         |SI sw5960sim = 1;
                              reducc_Alta = nBase * 1 * nProp55_A;
                         |SINO;
                              reducc_Alta = nBase * nProp55 * nProp55_A;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |SI nVez = 2;
                    |SI swredbonsim = 1;
                         reducc_Alta = nBase * 1 * nProp60_A;
                    |SINO;
                         |SI sw5960sim = 1;
                              reducc_Alta = nBase * 0 * nProp60_A;
                         |SINO;
                              reducc_Alta = nBase * nProp60 * nProp60_A;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SINO;
               reducc_Alta = nBase * nPropAlta;
          |FINSI;
          |SI swBonEpig = 1;
               reducc_Alta = reducc_Alta + base_Ca;
          |FINSI;
          reducc_Alta = (reducc_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = reducc_Alta;
     |SINO;
          |SI nVeces = 2;
               |SI nVez = 1;
                    |SI swredbonsim = 1;
                         reducc_Baja = nBase * 0 * nProp55_IT;
                    |SINO;
                         |SI sw5960sim = 1;
                              reducc_Baja = nBase * 1 * nProp55_IT;
                         |SINO;
                              reducc_Baja = nBase * nProp55 * nProp55_IT;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |SI nVez = 2;
                    |SI swredbonsim = 1;
                         reducc_Baja = nBase * 1 * nProp60_IT;
                    |SINO;
                         |SI sw5960sim = 1;
                              reducc_Baja = nBase * 0 * nProp60_IT;
                         |SINO;
                              reducc_Baja = nBase * nProp60 * nProp60_IT;
                         |FINSI;
                    |FINSI;
               |FINSI;
               nBase = reducc_Baja;
          |SINO;
               nBase = reducc - reducc_Alta;
          |FINSI;
          nBase = nBase ! 0;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0; |Y nBase ! 0; |Y reducc ! 0; |Y swbon_65 ! 1;
     |Y swbon_31 = 0; |Y swbon_34 ! 1;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          |SI #11#22 ! 39;
               #3#1  = "06";          || clave compensacion reducciones
               tot_cd_06 = tot_cd_06 + nBase;
          |SINO;
               #3#1  = "13";          || clave compensacion reducciones 39
               tot_cd_13 = tot_cd_13 + nBase;
          |FINSI;
          |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
               nume1 = #11#20 ! 0;
          |SINO;
               nume1 = d_alta;
          |FINSI;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "2";           || tipo de resolucion (reduccion)
                    fech1 = #12#40;        || fecha resolucion (reduccion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada

                    alfa1 = #3#7; alfa2 = #3#8;
                    |QBF alfa1; |QBF alfa2;
                    |SI alfa1 = ""; |Y alfa2  = "";
                         #3#6 = "        ";
                    |FINSI;
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_03;
    clave = "EDL";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #11#34 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo de elemento de datos
        #3#1  = "03";              || clave compensacion accidente
        #3#2  = #11#44;            || elemento (dias accidente)
        #3#3  = #11#34;            || importe
        #3#4  = aSigno;               || signo (reservado)
        #3#5  = " ";               || tipo resolucion
    |SI aParam = "TC2";
            #3#6  = #11#57;        || fecha inicio accidente para TC2
    |SINO;
            #3#6  = "        ";    || fecha resolucion (fecha parte medico)
    |FINSI;
        #3#7  = "        ";        || inicio periodo
    |SI aParam ! "TC2";
            #3#8  = "        ";    || fin periodo
            #3#9  = "";            || referencia asociada
            #3#10 = "";            || reservado
    |SINO;
            |HAZ CD_2006_Epi;
            #3#8  = aPromed;       || se guarda el promedio para el TC2
            #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
            nume1 = #11#44;   |HAZ liquidados;
            #3#10 = nume1;         || se guarda los dias para calcular base IT
    |FINSI;
    |HAZ monta;
    |HAZ fin_linea;
        tot_cd_03 = tot_cd_03 + #11#34;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edl_CD_02;
    clave = "EDL";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #11#49 ! 0;|Y aParam = "TC2";
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo de elemento de datos
        #3#1  = "02";              || clave compensacion maternidad
        #3#2  = #11#49;            || elemento (dias maternidad)
        #3#3  = 0;                 || importe
        #3#4  = " ";               || signo (reservado)
        #3#5  = " ";               || tipo resolucion
        #3#6  = #11#58;            || fecha inicio maternidad para TC2
        #3#7  = "        ";        || inicio periodo
        #3#8  = aPromed;       || se guarda el promedio para el TC2
        |HAZ CD_2006_Epi;
        #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
        eldat = 3;  || para citricos en maternidad, si no provoca fallos
                    || en TC2
        nume1 = #11#49;   |HAZ liquidados;
        #3#10 = nume1;         || se guarda los dias para calcular base IT
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO graba_edl_cd_01;
     |DDEFECTO #3;
     #3#0  = "CD";              || tipo de elemento de datos
     #3#1  = "01";              || clave compensacion enf. comun
     #3#2  = #11#43;            || elemento (dias enf.comun)
     #3#3  = #11#32;            || importe
     #3#4  = aSigno;               || signo (reservado)
     #3#5  = " ";               || tipo resolucion
     |SI aParam = "TC2";
          #3#6  = #11#56;        || fecha inicio enf.comun para TC2
     |SINO;
          #3#6  = "        ";    || fecha resolucion (fecha parte medico)
     |FINSI;
          #3#7  = "        ";        || inicio periodo
     |SI aParam ! "TC2";
          #3#8  = "        ";    || fin periodo
          #3#9  = "";            || referencia asociada
          #3#10 = "";            || reservado
     |SINO;
          |SI eaFuente = "A"; aPromed = #21#35; |FINSI; || en atrasos, promedio del mes
          #3#8  = aPromed;       || se guarda el promedio para el TC2
          |HAZ CD_2006_Epi;
          #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          eldat = 2;  || para citricos en enfermedad, si no provoca fallos
                      || en TC2
          || nume1 = #11#43;  |HAZ liquidados;
          nume1 = d_cot_it;
          #3#10 = nume1;         || se guarda los dias para calcular base IT
     |FINSI;
     |HAZ monta;
     |HAZ fin_linea;
     tot_cd_01 = tot_cd_01 + #11#32;
|FPRC;

|PROCESO edl_CD_01;
    clave = "EDL";
|HAZ ini_linea;
|SI sw_auxil = 0; |Y #11#32 ! 0; |Y #11#25 ! 0;
    |HAZ graba_edl_cd_01;
|SINO;
    |SI aParam = "TC2";|Y #11#32 = 0;|Y #11#43 ! 0;
        |HAZ graba_edl_cd_01;      || cuando no hay prestacion enf.comun
    |SINO;
        |HAZ fin_linea2;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO edl_CD_17;
     clave = "EDL";
     |HAZ ini_linea;
     |SI eldat = 1;
          nume1 = (#11#27 / 100) / ((#11#27 + #11#37) / 100);
          reducc = reducc / 100;
          nume3 = ((reducc * nume1) ! 2) * 100;
          reducc = reducc * 100;   || dejo la variable como estaba
     |FINSI;        || base AT
     |SI eldat = 2;
          nume1 = ((#11#37 - #11#62) / 100) / ((#11#27 + #11#37) / 100);
          reducc = reducc / 100;
          nume3 = ((reducc * nume1) ! 2) * 100;
          reducc = reducc * 100;   || dejo la variable como estaba
     |FINSI;        || base IT
     |SI eldat = 3;
          nume1 = (#11#62 / 100) / ((#11#27 + #11#37) / 100);
          reducc = reducc / 100;
          nume3 = ((reducc * nume1) ! 2) * 100;
          reducc = reducc * 100;   || dejo la variable como estaba
     |FINSI;        || base IT
     |SI sw_auxil = 0;|Y reducc ! 0;|Y swbon_65 ! 0; |Y nume3 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "17";              || clave compensacion reducciones 42
          nume1 = #11#20 ! 0;
          #3#2  = nume1;             || elemento
          #3#3  = nume3;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |FINSI;
          |FINSI;
          |SI aParam = "TC2";
               |HAZ CD_2006_Epi;
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_17 = tot_cd_17 + nume3;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_BA_42;
    clave = "EDL";
|HAZ ini_linea;
    nume1 = 0;
|SI eldat = 1; nume1 = #11#27;               |FINSI;        || base AT
|SI eldat = 2; nume1 = #11#37 - #11#62;      |FINSI;        || base IT
|SI nume1 < 0; nume1 = 0;     |FINSI;
|SI eldat = 3; |Y swbon_65 = 1; nume1 = #11#62;      |FINSI;
|SI eldat = 1;|Y sw_dat1 = 0; nume1 = 0;     |FINSI;   || si no ha grabado
|SI eldat = 2;|Y sw_dat2 = 0; nume1 = 0;     |FINSI;   ||/el dat
|SI sw_auxil = 0;|Y nume1 ! 0; |Y swbon_65 = 1;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo de elemento de datos
        #3#1  = "42";              || clave bases AT y EP
        #3#2  = "000";             || elemento
        #3#3  = nume1;             || importe
        #3#4  = " ";               || signo (reservado)
        #3#5  = " ";               || tipo de resolucion
        #3#6  = "        ";        || fecha resolucion
        #3#7  = "        ";        || inicio periodo
        #3#8  = "        ";        || fin periodo
        #3#9  = "";                || referencia asociada
        #3#10 = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
        tot_ba_42 = tot_ba_42 + nume1;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edl_BA_21;
     clave = "EDL";
     |HAZ ini_linea;
     |SI eldat = 3;
          cc_mat = #11#61;      || Contingencias Comunes Maternidad
     |FINSI;
     |SI eldat = 4;
          cc_mat = #11#67;      || Contingencias Reg. Empleo
     |FINSI;
     |SI sw_auxil = 0;|Y cc_mat ! 0;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "21";              || clave compensacion maternidad
          #3#2  = " ";               || dias para compensacion-deduccion
          #3#3  = cc_mat;            || importe base cont. comunes maternidad
          #3#4  = " ";               || signo (reservado)
          #3#5  = "  ";              || tipo resolucion
          |SI #11#61 > 0; |Y eldat = 3;
               alfa1 = #11#58
               |QBF alfa1;
               |SI aParam = "TC2";
                    #3#6 = alfa1;        || fecha inicio maternidad para TC2
               |SINO;
                    alfa1 = "20" + (alfa1 % 502) + (alfa1 % 302) + (alfa1 % 102);
                    #3#6 = alfa1;        || fecha inicio maternidad para TC2
               |FINSI;
          |FINSI;
          |SI s_ori = "A"; |O s_ori = "T";
               #3#6  = "        ";        || en atrasos fecha inicio: NO
          |FINSI;
          #3#7  = "        ";        || inicio periodo
          |SI aParam ! "TC2";
               #3#8  = "        ";    || fin periodo
               #3#9  = "";            || referencia asociada
               #3#10 = "";            || reservado
          |SINO;
               #3#8  = aPromed;       || se guarda el promedio para el TC2
               |HAZ CD_2006_Epi;
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
               nume1 = #11#49;   |HAZ liquidados;
               #3#10 = nume1;         || se guarda los dias para calcular base IT
          |FINSI;
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_21 = tot_ba_21 + cc_mat;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_BA_22;
     clave = "EDL";
     |HAZ ini_linea;
     |SI eldat = 3; |Y swbon_65 ! 1;
          cp_mat = #11#62;      || Contingencias Comunes Maternidad
     |FINSI;
     |SI eldat = 4; |Y swbon_65 ! 1;
          cp_mat = #11#68;      || Contingencias Reg. Empleo
     |FINSI;
     |SI sw_auxil = 0;|Y cp_mat ! 0;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "22";              || clave compensacion maternidad
          #3#2  = " ";               || dias para compensacion-deduccion
          #3#3  = cp_mat;            || importe base cont. comunes maternidad
          #3#4  = " ";               || signo (reservado)
          #3#5  = "  ";              || tipo resolucion
          |SI #11#62 > 0; |Y eldat = 3;
               alfa1 = #11#58
               |QBF alfa1;
               |SI aParam = "TC2";
                    #3#6 = alfa1;        || fecha inicio maternidad para TC2
               |SINO;
                    alfa1 = "20" + (alfa1 % 502) + (alfa1 % 302) + (alfa1 % 102);
                    #3#6 = alfa1;        || fecha inicio maternidad para TC2
               |FINSI;
          |FINSI;
          |SI s_ori = "A"; |O s_ori = "T";
               #3#6  = "        ";        || en atrasos fecha inicio: NO
          |FINSI;
          #3#7  = "        ";        || inicio periodo
          |SI aParam ! "TC2";
               #3#8  = "        ";    || fin periodo
               #3#9  = "";            || referencia asociada
               #3#10 = "";            || reservado
          |SINO;
               |HAZ CD_2006_Epi;
               #3#8  = aPromed;       || se guarda el promedio para el TC2
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
               nume1 = #11#49;   |HAZ liquidados;
               #3#10 = nume1;         || se guarda los dias para calcular base IT
          |FINSI;
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_22 = tot_ba_22 + cp_mat;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_BA_11;
    clave = "EDL";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #11#29 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo de elemento de datos
        #3#1  = "11";              || clave bases horas no estructurales
        #3#2  = "000";             || elemento
        #3#3  = #11#29;            || importe
        #3#4  = " ";               || signo (reservado)
        #3#5  = " ";               || tipo resolucion
        #3#6  = "        ";        || fecha resolucion
        #3#7  = "        ";        || inicio periodo
        #3#8  = "        ";        || fin periodo
        #3#9  = "";                || referencia asociada
        #3#10 = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
        tot_ba_11 = tot_ba_11 + #11#29;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edl_BA_10;
    clave = "EDL";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #11#28 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo de elemento de datos
        #3#1  = "10";              || clave bases horas estructurales
        #3#2  = "000";             || elemento
        #3#3  = #11#28;            || importe
        #3#4  = " ";               || signo (reservado)
        #3#5  = " ";               || tipo resolucion
        #3#6  = "        ";        || fecha resolucion (fecha concesion horas)
        #3#7  = "        ";        || inicio periodo
        #3#8  = "        ";        || fin periodo
        #3#9  = "";                || referencia asociada
        #3#10 = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
        tot_ba_10 = tot_ba_10 + #11#28;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edl_BA_06;
     |SI #labtraba#247 ! 112;      || solo ARTISTAS
          |ACABA;
     |FINSI;

     |ABRE #20;
     #20#0 = #11#0;
     #20#1 = #11#39;
     #20#2 = #0#1;
     #20#3 = #11#48;
     |LEE 000#20=;                 || lee calculos cabs.
     |CIERRA #20;

     nPesetas = #20#46;  |HAZ euro;     #20#46 = nEuros;

     clave = "EDL";
     |HAZ ini_linea;
     swSigue = 0;

     nBaseCC1 = #11#25 - #11#37;    || base en alta
     nBaseCC2 = #11#37 - #11#61;    || base en IT
     nBaseCC3 = #11#61;             || base en maternidad
     nBaseCC4 = #11#67;             || base en ERE

     |SI sw_auxil = 0; |Y #20#46 ! 0;
          |SI eldat = 1;
               |SI nBaseCC1 > 0;
                    swSigue = 1;
               |FINSI;
          |FINSI;
          |SI eldat = 2; |Y nBaseCC1 [ 0;
               |SI nBaseCC2 > 0;
                    swSigue = 1;
               |FINSI;
          |FINSI;
          |SI eldat = 3; |Y nBaseCC1 [ 0; |Y nBaseCC2 [ 0;
               |SI nBaseCC3 > 0;
                    swSigue = 1;
               |FINSI;
          |FINSI;
          |SI eldat = 4; |Y nBaseCC1 [ 0; |Y nBaseCC2 [ 0; |Y nBaseCC3 [ 0;
               |SI nBaseCC4 > 0;
                    swSigue = 1;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "06";              || clave bases percepciones reg.ARTISTAS
          #3#2  = "000";             || elemento
          #3#3  = #20#46;            || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha concesion horas)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_06 = tot_ba_06 + #20#46;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_BA_02;
    clave = "EDL";
|HAZ ini_linea;
    nume1 = 0;
|SI eldat = 1; nume1 = #11#27;               |FINSI;        || base AT
|SI eldat = 1; |HAZ tope_parche21;             |FINSI;        || base IT
|SI eldat = 2; nume1 = #11#37 - #11#62;      |FINSI;        || base IT
|SI eldat = 2; |HAZ tope_parche;             |FINSI;        || base IT
|SI eldat = 2; |HAZ tope_parche22;             |FINSI;        || base IT
|SI eldat = 2; |HAZ Parche_Feb;             |FINSI;        || base IT
|SI nume1 < 0; nume1 = 0;     |FINSI;

|SI eldat = 1;|Y sw_dat1 = 0; nume1 = 0;     |FINSI;   || si no ha grabado
|SI eldat = 2;|Y sw_dat2 = 0; nume1 = 0;     |FINSI;   ||/el dat

|SI nVeces = 2; |Y nVez = 1;
     |SI eldat = 1;
          |SI nProp55 > 0; nume1 = (nume1 * nProp55 * nProp55_A) ! 0; |FINSI;
     |FINSI;
     |SI eldat = 2;
          |SI nProp55 > 0; nume1 = (nume1 * nProp55 * nProp55_IT) ! 0; |FINSI;
     |FINSI;
|FINSI;
|SI nVeces = 2; |Y nVez = 2;
     |SI eldat = 1;
          |SI nProp60 > 0; nume1 = nume1 - ((nume1 * nProp55 * nProp55_A) ! 0); |FINSI;
     |FINSI;
     |SI eldat = 2;
          |SI nProp60 > 0; nume1 = nume1 - ((nume1 * nProp55 * nProp55_IT) ! 0); |FINSI;
     |FINSI;
|FINSI;

|SI sw_auxil = 0;|Y nume1 ! 0; |Y swbon_65 ! 1;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo de elemento de datos
        #3#1  = "02";              || clave bases AT y EP
        #3#2  = "000";             || elemento
        #3#3  = nume1;             || importe
        #3#4  = " ";               || signo (reservado)
        #3#5  = " ";               || tipo de resolucion
        #3#6  = "        ";        || fecha resolucion
        #3#7  = "        ";        || inicio periodo
        #3#8  = "        ";        || fin periodo
        #3#9  = "";                || referencia asociada
        #3#10 = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
        tot_ba_02 = tot_ba_02 + nume1;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edl_BA_01;
    clave = "EDL";
|HAZ ini_linea;
    nume1 = 0;
|SI eldat = 1;|Y #11#27 ! 0;  nume1 = 1;     |FINSI;   || base AT no cero
|SI eldat = 2;|Y #11#27 = 0;  nume1 = 1;     |FINSI;   || base AT si cero
     nume3 = #11#33;                         || dias en IT
     |SI #labtraba#42 = "M"; |Y nume3 > 30;  || en mensuales no puedo estar
          nume3 = 30;         || de IT mas de 30 dias,
     |FINSI;
|SI eldat = 1;
     |SI #11#59 = #11#60;               || los promedios son iguales
          nBaseCC = #11#25 - #11#37;    || base en alta menos base en baja
     |SINO;
          ||nBaseCC = #11#25 - (((#11#33 * #11#59) ! EURODB) * 100); || lo mismo pero
          nBaseCC = #11#25 - (((nume3 * #11#59) ! EURODB) * 100); || lo mismo pero
                                        || recalcula la base segun prom. CC
          |SI #labtraba#247 = 911;
               nBaseCC = #11#25 - (((nume3 * #11#64) ! EURODB) * 100); || lo mismo pero
          |FINSI;
     |FINSI;
|FINSI;
|SI eldat = 2;                          || base IT
     nume1 = 0;
     nume3 = #11#43 + #11#44 - swAjuste3;     || dias en enf+acc
     |SI #11#59 = #11#60;               || los promedios son iguales
          nBaseCC = #11#37 - #11#61;    || base en baja
     |SINO;
          nBaseCC = (((nume3 * #11#59) ! EURODB) * 100);  || si no son iguales recalculo
                                                 || la base segun promedio CC
          nBaseCC = nBaseCC - #11#61;   || quito la parte de maternidad
     |FINSI;
          |SI #labtraba#247 = 911;
              nBaseCC = (((nume3 * #11#64) ! EURODB) * 100);  || si no son iguales recalculo
          |FINSI;
     |SI nBaseCC > 0; nume1 = 1; |FINSI;
|FINSI;
|SI eldat = 1;
     |SI #11#27 = 0;|Y #11#37 = 0;|Y #11#25 ! 0;  || excesos de cotizacion
          nume1 = 1;
     |FINSI;
|FINSI;
|SI eldat = 2; |HAZ tope_parcheCC;             |FINSI;        || base IT
|SI eldat = 1;|Y sw_dat1 = 0; nume1 = 0;     |FINSI;   || si no ha grabado
|SI eldat = 2;|Y sw_dat2 = 0; nume1 = 0;     |FINSI;   ||/el dat

|SI nVeces = 2; |Y nVez = 1;
     |SI eldat = 1;
          |SI nProp55 > 0; nBaseCC = (nBaseCC * nProp55 * nProp55_A) ! 0; |FINSI;
     |FINSI;
     |SI eldat = 2;
          |SI nProp55 > 0; nBaseCC = (nBaseCC * nProp55 * nProp55_IT) ! 0; |FINSI;
     |FINSI;
|FINSI;
|SI nVeces = 2; |Y nVez = 2;
     |SI eldat = 1;
          |SI nProp60 > 0; nBaseCC = nBaseCC - ((nBaseCC * nProp55 * nProp55_A) ! 0); |FINSI;
     |FINSI;
     |SI eldat = 2;
          |SI nProp60 > 0; nBaseCC = nBaseCC - ((nBaseCC * nProp55 * nProp55_IT) ! 0); |FINSI;
     |FINSI;
|FINSI;
|SI #11#25 = 0;|O nBaseCC [ 0; nume1 = 0;     |FINSI;   || base CC si cero
|SI sw_auxil = 0;|Y nume1 ! 0;
    |DDEFECTO #3;
        || #11#25 = nBaseCC;         || para que coja la base real en alta
        #3#0  = "BA";              || tipo de elemento de datos
        #3#1  = "01";              || clave bases conting.comunes
        #3#2  = "000";             || elemento
        || #3#3  = #11#25;            || importe
        #3#3  = nBaseCC;            || importe
        #3#4  = " ";               || signo (reservado)
        #3#5  = " ";               || tipo de resolucion
        #3#6  = "        ";        || fecha resolucion
        #3#7  = "        ";        || inicio periodo
        #3#8  = "        ";        || fin periodo
        #3#9  = "";                || referencia asociada
        #3#10 = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
        tot_ba_01 = tot_ba_01 + nBaseCC;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO CompModulo2;
     swNoAjuste3 = 0;
     |SI dat_mes = 2;
          |PARA para1 = 27; |SI para1 [ 30; |HACIENDO para1 = para1 + 1;
               |SI #20para1 = "E"; |O #20para1 = "A"; |O #20para1 = "M"; |O #20para1 = "D";
                    desde = para1 - 8;
                    hasta = para1 - 4;
                    |SI #20hasta = topemes; |O #20hasta ! 0
                         swNoAjuste3 = 1;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO modulo2;
     || este proceso se crea para controlar el tema de la opcion "3" en el
     || control de la aplicacion en el calculo de Dias de IT
     || solo si no soy diario, estoy en un mes de 31 dias y tengo parte en IT
     || esta copiado del i_nomcal3, donde hay uno igual, si se cambia algo
     || tenerlo en cuenta por si alli hace falta

     swAjuste3 = 0;
     swNoAjuste3 = 0;
     nume1 = #11#43 + #11#44 + #11#49;
     nume2 = #11#42;
     nume4 = 30 - #11#100;
     |SI nume2 = 0; nume2 = topemes; |FINSI;
     |SI #36#17 = 3;
          swSigue = 0;
          |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
               swSigue = 1;
          |FINSI;
          |SI swSigue = 1;
               |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
                    nume5 = #20#55;
                    |SI nume5 = 0;
                         |HAZ Dias_nat_alta;
                         nume5 = nDias_nat_alta;
                         |SI nume5 ] 31;
                              nume5 = 30;
                         |FINSI;
                    |FINSI;
               |SINO;
                    nume5 = #11#20;
               |FINSI;
               |SI nume1 ! 0; |Y nume5 ] nume4; || (todo el mes en alta)
               |Y #11#41 [ 1; |Y nume2 ] topemes; |Y swNoAjuste3 = 0;
                    ult11 = dat_mes; |HAZ ulti_dia11;
                    |SI dat_mes ! 4; |Y dat_mes ! 6; |Y dat_mes ! 9; |Y dat_mes ! 11;
                         |SI dat_mes ! 2;
                              swAjuste3 = 1;
                         |SINO;
                              swAjuste3 = -2 + bisiesto;
                         |FINSI;
                         /*
                         |SI eldat = 1; |Y #labtraba#42 ! "C"; |Y #labtraba#42 ! "F";
                              || en citricos aqui no
                              d_alta = d_alta + swAjuste3;
                         |FINSI;
                         */
                         |SI eldat = 2; |Y #11#49 = 0;
                              || no en caso de baja todo el mes
                              nume1 = #11#43 + #11#44 + #11#49;
                              |SI nume1 < dia_2; || (dias baja < dias labor. mes)
                              |Y nume1 < 30; || OJO, si tengo 30 dias, estoy de IT
                                             || el mes completo, con lo que no hay que
                                             || meterse aqui nunca (quitar si molesta
                                             || esta por un caso raro que se calculo con
                                             || el parametro a "2" (3708.188)
                                   d_alta = d_alta - swAjuste3;
                              |FINSI;
                         |FINSI;
                         |SI eldat = 3;
                              || no en caso de baja todo el mes
                              nume1 = #11#43 + #11#44 + #11#49;
                              |SI nume1 < dia_2; || (dias baja < dias labor. mes)
                                   d_alta = d_alta - swAjuste3;
                              |SINO;    || salvo que sea por enf. y mat.
                                   nume3 = #11#43 + #11#49;
                                   |SI nume3 ] dia_2; |Y #11#43 > 0; |Y #11#49 > 0;
                                        d_alta = d_alta - swAjuste3;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
/*
     |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
          |SI eldat = 2; |Y #20#55 ! 0;
               d_alta = #20#55;
          |FINSI;
     |FINSI;
*/
|FPRC;

|PROCESO dias_alta_2;
     |PARA eldat = 1; |SI eldat [ 4; |HACIENDO eldat = eldat + 1;
          |SI eldat = 1;
               d_alta = (#11#20 ! 0) - (#11#43 + #11#44 + #11#49);   || dias alta
               |HAZ modulo2;
               |SI d_alta > 0;
                    nDiasAlta = d_alta;
               |FINSI;
               |SI #0#1 = 2; |Y d_alta > 0; |Y #36#17 ! 3;    || parchecillo:
                    nume5 = #11#43 + #11#44 + #11#49;  || los que no tenian
                    |SI nume5 = topemes;     || tipo 3 en el control de la
                         nDiasAlta = 0;      || aplicacion, no estaba saliedno
                    |FINSI;                  || bien esto en las bonif
               |FINSI;
          |FINSI;
          |SI eldat = 2;
               |SI aParam ! "TC2";
                    d_alta = #11#43 + #11#44;                    || dias IT
               |SINO;
                    d_alta = #11#43 + #11#44 + #11#49;
               |FINSI;
               |SI d_alta > 0;
                    nume1 = d_alta;  |HAZ liquidados;
                    d_alta = nume1;
                    |SI #labtraba#42 ! "X"; || en los "X" repartia mal los dias
                         |HAZ modulo2;
                    |FINSI;
                    d_cot_it = d_alta;  || me voy a guardar aqui los dias cotizables
                                        || que he estado en baja para despues recuperarlos
                                        || en el tc2
                    nDiasIT = d_alta;
               |FINSI;
          |FINSI;
          |SI eldat = 3;
               d_alta = #11#49;                                      || dias mater
               nume1 = d_alta;  |HAZ liquidados;
               d_alta = nume1;
               |SI d_alta > 0;
                    |SI #labtraba#42 ! "X"; || en los "X" repartia mal los dias
                         |HAZ modulo2;
                    |FINSI;
                    nDiasMate = d_alta;
               |FINSI;
          |FINSI;
          |SI eldat = 4;                || Exp.Reg.Empleo
               d_alta = #11#69;      || dias en Exp.Reg.Empleo
               nume1 = d_alta;  |HAZ liquidados;
               |SI d_alta > 0;
                    d_alta = nume1;
                    nDiasExp = d_alta;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO dias_alta;
     |SI s_ori = "A"; ult11 = #21#2;   |HAZ ulti_dia11; |FINSI;
     |SI s_ori = "T"; ult11 = #19#2;   |HAZ ulti_dia11; |FINSI;
     |SI eldat = 1;
          d_alta = (#11#20 ! 0) - (#11#43 + #11#44 + #11#49);   || dias alta
          |HAZ modulo2;
          |SI #0#14 = "L04";
               d_alta = d_alta + #11#69;
          |FINSI;
     |FINSI;
     |SI eldat = 2;
          |SI aParam ! "TC2";
               d_alta = #11#43 + #11#44;                    || dias IT
          |SINO;
               d_alta = #11#43 + #11#44 + #11#49;
          |FINSI;
          nume1 = d_alta;  |HAZ liquidados;
          d_alta = nume1;
          |HAZ modulo2;
          d_cot_it = d_alta;  || me voy a guardar aqui los dias cotizables
                              || que he estado en baja para despues recuperarlos
                              || en el tc2
     |FINSI;
     |SI eldat = 3;
          d_alta = #11#49;                                      || dias mater
          nume1 = d_alta;  |HAZ liquidados;
          d_alta = nume1;
          |HAZ modulo2;
     |FINSI;
     |SI eldat = 4;                || Exp.Reg.Empleo
          d_alta = #11#69;      || dias en Exp.Reg.Empleo
          nume1 = d_alta;  |HAZ liquidados;
          d_alta = nume1;
          |HAZ AjusteDes;
     |FINSI;

     |SI d_alta < 0;|O d_alta = 0;
          d_alta = 0;
     |FINSI;
     dias_enteros = 0;
     |SI #labtraba#247 ! 112;      || los artistas cotizan igual que en Reg.General
          |SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
               dias_enteros = d_alta;
               |HAZ t_parcial;                  || si es tiempo parcial o irregular
          |SINO;                                || cotizan por horas, se pone en el EDL
               ind_cot = " ";                   || si no, cotizan normal
          |FINSI;
     |SINO;
          ind_cot = " ";
     |FINSI;

     |SI #0#17 = 2;                || en finiquitos buscamos dias de alta d cada
          d_alta = dias_finiq;     || mes y proporcionamos la base
     |FINSI;

     |SI nSwDiasCero = 0;
          |SI d_alta = 0;
               d_alta = 1;
               nSwDiasCero = 1;
          |FINSI;
     |SINO;
          d_alta = d_alta - 1;
          nSwDiasCero = 0;
          |SI d_alta [ 0;
               d_alta = d_alta + 1;     || cambio manual, si procede
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO t_parcial;
     |SI #36#17 = 3;
          d_alta = (d_alta * #12#47) ! 0;    || para todos igual
     |SINO;
          |SI eldat = 1;
               d_alta = #11#24 - ((#11#33 * #12#47) ! 0);   || horas en alta
          |FINSI;
          |SI eldat = 2;                                    || horas en IT
               d_alta = ((#11#43 + #11#44) * #12#47) ! 0;   || (enf + acc)
          |FINSI;
          |SI eldat = 3;                                    || horas en IT
               d_alta = (#11#49 * #12#47) ! 0;              || (maternidad)
          |FINSI;
          |SI eldat = 4;                                    || horas en IT
               d_alta = (d_alta * #12#47) ! 0;              || (ERE)
          |FINSI;
     |FINSI;
     |SI #12#42 = "P";        || en irregulares por horas
          d_alta = #11#24;    || no tengo por que calcular otra vez (1485.96)
     |FINSI;
     |SI #0#17 ! 2;
          ind_cot = "H";     || Indicador cotizacion  de los de t. parcial
     |FINSI;
|FPRC;

|PROCESO dat;
     clave = "DAT";
     |HAZ ini_linea;
     |SI eldat = 1; nume1 = #11#27 + #11#28 + #11#29;  |FINSI;   || base AT+horas
     |SI eldat = 2; || base IT
          |SI aParam ! "TC2";
               nume1 = #11#37 - #11#62;
          |SINO;
               nume1 = #11#37;
          |FINSI;
     |FINSI;
     |SI eldat = 3; nume1 = #11#62;                    |FINSI;   || base mater
     |SI eldat = 4; nume1 = #11#68;                    |FINSI;   || base ERE
     |SI eldat = 1;
          |SI #11#27 = 0;|Y #11#37 = 0;|Y #11#25 ! 0;  || excesos de cotizacion
               nume1 = #11#25;
          |FINSI;
     |FINSI;
     |SI eldat = 1; |HAZ tope_parche21;                |FINSI;
     |SI eldat = 2; |HAZ tope_parche22;                |FINSI;
     |SI nVeces = 2;
          |SI nVez = 1;
               |SI eldat = 1; |Y nDiasProp55_A = 0;
                    nume1 = 0;
               |FINSI;
               |SI eldat = 2; |Y nDiasProp55_IT = 0;
                    nume1 = 0;
               |FINSI;
          |FINSI;
          |SI nVez = 2;
               |SI eldat = 1; |Y nDiasProp60_A = 0;
                    nume1 = 0;
               |FINSI;
               |SI eldat = 2; |Y nDiasProp60_IT = 0;
                    nume1 = 0;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nume1 < 0; nume1 = 0; |FINSI;
     |SI sw_auxil = 0; |Y nume1 ! 0;
          |DDEFECTO #3;
          #3#0  = "0";                    || indicador
          #3#1  = dat_mes;                || mes TC2
          |SI #0#12 = "A"; |O #0#12 = "T";
               |HAZ GuardaMeses;
          |FINSI;
          #3#2  = " ";                    || huelga parcial (NO)
          #3#3  = " ";                    || pluriempleo (NO)
          |SI #12#237 = "S";
               #3#3  = "P";                || pluriempleo SI
          |FINSI;
          #3#4 = " ";                    || sin reduccion
          |SI #12#129 = "R"; |O #12#129 = "T";    || reduccion por mater/pater
               #3#4  = #12#129;                   || a TP
          |FINSI;
          |SI #12#129 = "G"; #3#4 = "R"; |FINSI; || por guarda legal
          |SI #0#18 > 2009;
               |SI eldat = 2; #3#4 = "I"; |FINSI;
               |SI eldat = 3; #3#4 = "D"; |FINSI;
          |FINSI;
          #3#5  = " ";                    || modalidad salario
          |SI #12#33 ] 8;|Y #12#33 [ 11;
               |SI #12#42 ! "D";|Y #12#42 ! "T"; |Y #12#42 ! "C";|Y #12#42 ! "F";
                    #3#5  = "M";            || retribucion mensual grupos 8-11
               |FINSI;
               ||SI #20#161 = "S"; #3#5 = "M"; |FINSI; ¨hace falta?
          |FINSI;
          #3#6  = " ";                    || alta sin retribucion
          #3#7  = " ";                    || otros
          nNume1 = (#11#67 - #11#25 - #11#37 - #11#61);
          |SI #11#67 ! 0;
               |SI eldat = 4;
                    |SI #12#129 = "E";  || ERE a TP, parte en ERE
                         #3#7 = "P";
                    |SINO;
                         #3#7 = "T";
                    |FINSI;
               |FINSI;
          |SINO;
               |SI eldat = 1; |O eldat = 2; |O eldat = 3;
                    |SI #12#129 = "A";  || ERE a TP, parte en ALTA
                         #3#7 = "R";
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI #12#112 ! "S";
               #3#8  = " ";                || contrato inferior a 7 dias NO
          |SINO;
               #3#8  = "C";                || contrato inferior a 7 dias SI
          |FINSI;
          |HAZ dias_alta;
          |SI nDiasProp55 > 0; |Y nDiasProp60 > 0; |Y nVeces = 2;
               |SI nVez = 1;
                    |SI eldat = 1; d_alta = nDiasProp55_A; |FINSI;
                    |SI eldat = 2; d_alta = nDiasProp55_IT; |FINSI;
               |FINSI;
               |SI nVez = 2;
                    |SI eldat = 1; d_alta = nDiasProp60_A; |FINSI;
                    |SI eldat = 2; d_alta = nDiasProp60_IT; |FINSI;
               |FINSI;
          |FINSI;
          #3#9 = d_alta;                 || cotizacion (parte entera)
          |HAZ LeeConstante;
          swSocTP = 0;
          |SI #nomconst#12 = 5.50; |Y #nomconst#14 = 0;
               swSocTP = 1;   || socios cooperativas a TP
          |FINSI;
          |SI #labtraba#42 = "X"; |O #labtraba#42 = "T"; |O #labtraba#42 = "P";
          |O #labtraba#42 = "I";
               |SI #11#73 > 0; |O #11#75 > 0; |O bon_55 > 0;
               |O swSocTP = 1;   || socios cooperativas a TP
               |O #11#79 = 3262; |O #20#122 ! 0;
               |O #11#79 = 3266; |O #11#79 = 3267;
                    || soy tiempo parcial y estoy bonificado por el RDL 05/2006
                    |SI #0#17 = 0;
                         #3#10 = dias_enteros;
                         |SI eldat = 4; |Y #11#69 ! 0; || tengo ERE
                              #3#10 = #11#69;
                         |FINSI;
                         |SI #labtraba#42 = "P"; |O #labtraba#42 = "I";
                              nNume1 = #11#20 ! 0;
                              #3#10 = nNume1;
                         |FINSI;
                         |SI #20#33 > 0; || si tengo huelga redondeo para
                                         || que aqui salgan lo dias enteros
                              nNume1 = (#11#20 + 0.49) ! 0;
                              #3#10 = nNume1;
                         |FINSI;
                    |FINSI;
               |SINO;
                    #3#10 = "";
               |FINSI;
          |SINO;
               #3#10 = "";
          |FINSI;
          #3#11 = ind_cot;                || indicador cotizacion
          #3#12 = " ";                    || reservado
          #3#13 = "0";                              || clave dias normales
          |SI #12#42 = "A";|O #12#42 = "B";|O #12#42 = "E";|O #12#42 = "e";
               #3#13 = "4";                          || clave dias agrarios
          |FINSI;

          #3#14 = "  ";                             || especificos
          |SI #12#247 = 911;
               #3#13 = "2";
               |SI eldat ! 2;
                    |SI #0#12 ! "C";
                         nume1 = #11#63;
                         #3#14 = nume1;               || dias cotiz 01 para el 911
                    |SINO;
                         nume1 = #11#63 + #11#72;
                         #3#14 = nume1;    || en complementarias el total de dias
                    |FINSI;        || laborables (alta+baja) si no el periodos de baja seria 0
               |SINO;
                    || #3#14 = d_alta;                    || dias cotiz 02 para el 911
                    #3#14 = #11#72;                    || dias laborables IT
               |FINSI;
          |FINSI;

          |SI aParam ! "TC2";
               #3#15 = "   ";                            || reservado
          |SINO;
               |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
                    || si es tiempo parcial me guardo la proporcion de horas
                    || que me hara falta despues en el TC2
                     #3#15 = #labtraba#234;                    || reservado
               |FINSI;
          |FINSI;
          #3#16 = "";
          |SI #11#73 > 0; |O #11#75 > 0; |O bon_55 > 0;
               nBonif = 0;
               |BUCLE nombotra;
               |HAZ PFETP;
          |FINSI;
          |SI #11#79 = 3262; |O #20#122 ! 0;
               |HAZ PropTP;
          |FINSI;
          #3#17 = #12#33;                           || grupo cotizacion
          |SI aParam ! "TC2";
                #3#18 = "   ";                        || reservado
                |SI #11#101 ! 0;
                     #3#18 = "S  ";     || cotizacion solidaridad
                |FINSI;
                |SI #20#122 ! 0;
                     #3#18 = "J  ";     || sistema garantia juvenil
                |FINSI;
                #3#19 = " ";
                |SI #labtraba#45 = "540";
                     |HAZ lee_cons;
                     nNume = #nomconst#12 + #nomconst#13;
                     |SI nNume < 8;
                          #3#19 = "I";
                     |SINO;
                          #3#19 = "D";
                     |FINSI;
                |FINSI;
          |SINO;
               #3#18 = #11#20;                       || dias alta para TC2
          |FINSI;
          aContrato = #11#22;
          |HAZ CodigosNuevos;
          |SI aContrato = "422"; aContrato = "000"; |FINSI;
          #11#22 = aContrato;
          #3#20 = #11#22;                           || clave contrato
          |SI #0#18 [ 2006;
               |SI eldat = 1;  #3#21 = #11#26;     |FINSI;   || epigrafe normal
               |SI eldat = 2;  #3#21 = #22#2;      |FINSI;   || epigrafe IT (126)
               |SI eldat = 3;  #3#21 = #22#2;      |FINSI;   || epigrafe IT (126)
               |SI eldat = 4;  #3#21 = #22#2;      |FINSI;   || epigrafe IT (126)
               |HAZ LeeEpigSec;
               aAlfa1 = #3#21;  |QBF aAlfa1;
               |SI epig_sec ! 0; |Y aAlfa1 ! "126";
                    #3#22 = epig_sec;                         || epigrafe secundario
               |SINO;
                    #3#22 = "";                               || epigrafe secundario
               |FINSI;
          |SINO;
|| migue
               |SI #0#18 [ 2009;
                    |SI eldat = 1; |Y #11#26 > 900;
                         #3#23 = #labtraba#204;
                    |FINSI;
                    |SI eldat = 2; |O eldat = 3; |O eldat = 4;
                         #3#23 = "c";
                    |FINSI;
               |SINO;
                    |SI #11#26 > 900;
                         #3#23 = #labtraba#204;
                    |FINSI;
               |FINSI;
          |FINSI;

          |SI aParam ! "TC2";
               #3#24  = "";                    || Reservado
               #3#25  = " ";                   || Indicadores de discapacidad
               |HAZ BuscaDisca;

               #3#26  = "";                    || Indicador de Relacion Laboral
               |SI #labtraba#122 ! " ";
                    |SI #labtraba#122 = "1"; #3#26  = "0100"; |FINSI;
                    |SI #labtraba#122 = "2"; #3#26  = "0409"; |FINSI;
                    |SI #labtraba#122 = "3"; #3#26  = "0900"; |FINSI;
               |FINSI;

               #3#27  = "";                    || Colectivo peculiaridad cotizacion
               |SI #11#74 = 3141;
                    |SI swredbonsim = 1; |O sw5960sim = 1;
                         |SI swredbonsim = 1;
                              |SI nVez = 2;
                                   #3#27 = #11#74;
                              |FINSI;
                         |FINSI;
                         |SI sw5960sim = 1;
                              |SI nVez = 1;
                                   #3#27 = #11#74;
                              |FINSI;
                         |FINSI;
                    |SINO;
                         #3#27 = #11#74;
                    |FINSI;
               |FINSI;
               |SI #11#73 > 0;
                    nNume3 = #11#74;
                    |SI #11#74 = 16; |Y eldat = 3;
                         || bonif fom. emp. 16, parte de maternidad, antes de que
                         || empiece o cuando acaba la bonif
                         || nDiasMate = 1; estaba aqui, no se por que, pero
                         || hacia que si tenia ya diasmate me los dejara a 1 ??
                         |HAZ Busca111;
                         |SI nDiasMate = 0;
                              nNume3 = 0;    || no tiene que aparecer colectivo
                         |FINSI;
                    |FINSI;
                    #3#27 = nNume3;
               |FINSI;
               |SI #11#76 ! 0;
                    #3#27 = #11#76;
               |FINSI;
               |SI #20#12 = 502; |Y #20#63 = 0; |Y #20#81 ! 0;
                    #3#27 = "3263";
               |FINSI;
               aAlfa = #11#79; |QBF aAlfa;
               |SI aAlfa ! "";
                    |SI aAlfa = "9901"; |Y #11#73 > 0;
                         || la 9901 junto con una de fom. emp. se pone el
                         || colectivo de fom. empleo.
                    |SINO;
                         #3#27 = #11#79;
                    |FINSI;
               |FINSI;

               #3#28  = #11#77;                || Informacio complementaria RED
               #3#29  = "";                    || Reservado
          |SINO;
               alfa5 = #11#55;                    || cod.convenio colectivo
               alfa5 = alfa5 + #12#42;            || clave salario
               |SI #12#247 ! 911;
                    alfa6 = #11#24;
                    alfa7 = alfa5 + alfa6;
                    alfa7 = (alfa7 + "               ") % 114;
                    #3#28 = alfa7 % 104;
                    #3#29 = alfa7 % -110;
                    || para poder seguir usando los campos, antes:
                    || #3#28 = alfa5 + alfa6;        || clave salario + horas contrato
               |SINO;
                    |SI eldat ! 2;
                         alfa6 = #11#63;
                         alfa7 = alfa5 + alfa6;
                         alfa7 = (alfa7 + "               ") % 114;
                         #3#28 = alfa7 % 104;
                         #3#29 = alfa7 % -110;
                         || para poder seguir usando los campos, antes:
                         || #3#27 = alfa5 + alfa6;        || clave salario + dias cotiz 01 para el 911
                    |SINO;
                         alfa6 = #11#72;
                         alfa7 = alfa5 + alfa6;
                         alfa7 = (alfa7 + "               ") % 114;
                         #3#28 = alfa7 % 104;
                         #3#29 = alfa7 % -110;
                         || para poder seguir usando los campos, antes:
                         || #3#27 = alfa5 + alfa6;        || clave salario + dias laborables IT
                    |FINSI;
               |FINSI;
          |FINSI;

         |SI eldat = 1;   sw_dat1 = 1;   |FINSI;
         |SI eldat = 2;   sw_dat2 = 1;   |FINSI;
         |HAZ monta;
         |HAZ fin_linea;
     |SINO;
         |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO ayn;
    clave = "AYN";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
    |HAZ separa_nom;
        #3#0  = apell1;            || primer apellido
        #3#1  = apell2;            || segundo apellido
        #3#2  = nombre;            || nombre
        #3#3  = aAbreviado;        || reservado
        #3#4  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO TipoID;
     alfa1 = #12#7 % 101;
     alfa2 = #12#7;
     |QBF alfa2;
     alfa2 = alfa2 % -101;

     |SI alfa1 ] "A"; |Y alfa1 [ "z";
          |SI alfa1 = "X"; |O alfa1 = "Y"; |O alfa1 = "Z";
               |SI alfa2 ] "A"; |Y alfa2 [ "z";
                    #3#2 = "6";                  || tipo identif.(EXTRANJERO)
                    #3#3 = "   ";                || pais emisor
                    #3#7 = #12#76 % 103;         || nacionalidad
               |SINO;
                    #3#2 = "2";                  || tipo identif.(PASAPORTE)
                    #3#3 = #12#76 % 103;         || pais emisor
                    #3#7 = #12#76 % 103;         || nacionalidad
               |FINSI;
          |SINO;
               #3#2 = "2";                  || tipo identif.(PASAPORTE)
               #3#3 = #12#76 % 103;         || pais emisor
               #3#7 = #12#76 % 103;         || nacionalidad
          |FINSI;
     |FINSI;
     |SI #nomcontr#40 = 2;
          |SI #3#2 = "6";
               aAlfa = #12#7;
               |QBF aAlfa;
               aAlfa1 = aAlfa % 101;
               aAlfa = aAlfa - aAlfa1;
               alfa6 = aAlfa % 0;
               long = alfa6;
               |SI long ! 9;
                    aAlfa = aAlfa1 + "0" + aAlfa;
               |SINO;
                    aAlfa = aAlfa1 + aAlfa;
               |FINSI;
               #12#7 = aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tra;
    clave = "TRA";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        #3#0  = #12#75 % 102;                || provincia NAFSS
        #3#1  = #12#75 % 3;                  || numero NAFSS
        #3#2  = "1";                         || tipo identificador (DNI)
        |HAZ TipoID;
        #3#3  = "011";                       || pais (espa¤a)
        #3#4  = #12#7;                       || DNI
        #3#5  = #12#77;                      || rot.control (cod.centro)
    |HAZ cta_cotizacion;
        #3#6  = descto;                      || rot.control (des.centro)
        #3#7  = "";                          || nacionalidad (reserv.afiliac.)
        #3#8  = "";                          || indicadores (reserv.afiliac.)
        #3#9  = "";                          || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO exc;
|FPRC;

|PROCESO rzs;
    clave = "RZS";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        #3#0  = "0";          || indicador razon social (siempre 0)
        #3#1  = #6#4;         || tipo alfab. empresario
        #3#2  = #10#2;        || razon social
        #3#3  = "";           || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO emp;
    clave = "EMP";
|HAZ ini_linea;
|SI sw_auxil = 0;
        linea_EMP = linea;
        tot_emp = tot_emp + 1;
    |DDEFECTO #3;
        #3#0  = aRegimen;          || RRSS
        #3#1  = cta_co % 102;      || provincia
        #3#2  = cta_co % 309;      || nro.cta.cotizacion
        alfa1 = #10#10 % 101;
    |SI alfa1 ] "0";|Y alfa1 [ "9";
            #3#3 = "1";            || tipo identificacion DNI
    |SINO;
        |SI alfa1 = "X"; |O alfa1 = "Y"; |O alfa1 = "Z";       || extranjero
                #3#3 = "6";        || tipo identificacion EXTRANJERO
        |SINO;
            |SI alfa1 ] "a";|Y alfa1 [ "z";
                    #3#3 = "2";    || tipo identificacion PASAPORTE
            |SINO;
                    #3#3 = "9";    || tipo identificacion CIF
            |FINSI;
        |FINSI;
    |FINSI;
        #3#4  = #6#3;              || pais
        #3#5  = #10#10;            || nro.identif.empresario
    |SI aParam ! "TC2";
            #3#6  = "";            || calif.cod.empresario
    |SINO;
            #3#6  = #14#117;       || guarda si es abreviado el TC2
    |FINSI;
        #3#7  = #6#2;              || RRSS principal
        #3#8  = #10#13 % 102;      || provincia principal
        #3#9  = #10#13 % 309;      || nro.cta.cotizacion principal
        #3#10 = #0#18;             || a¤o lote
        #3#11 = #0#1;              || desde mes
        #3#12 = #0#13;             || hasta mes
    |SI #11#48 < 10;
        #3#13 = #0#14;     || calificador liquidacion (normal)
    |SINO;
        #3#13 = "L11";         || calificador liquidacion (exp.reg.)
    |FINSI;
    aAlfa = #0#20; |QBF aAlfa;
    #3#14 = aAlfa;             || tipo de liquidacion
    |SI aParam ! "TC2";
            #3#15 = "";                 || libre usuario
            #3#16 = "";
    |SINO;
            #3#15 = aLibre;             || centro (para el TC2)
            #3#16 = aReser;             || centro especial (para el TC2)
    |FINSI;
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO inm;
|FPRC;

|VARIABLES;
     nHBase = 0;
     nHDeci = 0;
     nHRest = 0;
     aHCara = "";
     aHCade = "";
|FIN;

|PROCESO PasaHexaResto;
     |SI nHRest [ 9;
          aHCara = nHRest;
     |SINO;
          nHRest = nHRest + 55;
          aHCara = &nHRest;
     |FINSI;
|FPRC;

|PROCESO PasaHexa;
     aHCade = "";
     |PARA; |SI nHDeci ] nHBase; |HACIENDO;
          nHRest = nHDeci $ nHBase;
          nHDeci = ((nHDeci - nHRest) / nHBase);
          |HAZ PasaHexaResto;
          aHCade = aHCara + aHCade;
     |SIGUE;
     nHRest = nHDeci;
     |HAZ PasaHexaResto;
     aHCade = aHCara + aHCade;
|FPRC;

|PROCESO proporciona;
     nBaseAlta = #11#27;
     |SI nBaseAlta < 0;
          nBaseAlta = 0;
     |FINSI;
     || le quito la parte de horas extras porque si no a la hora de hallar la
     || proporcion en alta y en baja de bonificaciones el calculo no es correcto
     nBaseAlta = nBaseAlta - #11#28 - #11#29;
     nBaseTotal = nBaseAlta + #11#37 + #11#68;  || maternidad no, que ya esta
     || (Alta + Enf/Acc + Reg.Empleo)        || incluido en base IT
     nPropAlta = nBaseAlta / nBaseTotal;     || precision y no dar lugar a posible error
     |SI #11#27 = 0; |Y #11#68 = 0;
          nPropMat = #11#62 / #11#37;          || no tengo en cuenta Reg.Empleo
          nPropBaja = 1 - nPropMat;
     |FINSI;
|FPRC;

|PROCESO Siempre;
  |PARA nVez = 1; |SI nVez [ nVeces; |HACIENDO nVez = nVez + 1;
     |PARA eldat = 1; |SI eldat [ 2; |HACIENDO eldat = eldat + 1;
          |HAZ pasaaeuros_edl;
          |HAZ dat;
          |HAZ edl_BA_01;       || contingencias comunes
          |HAZ edl_BA_02;       || AT y EP
          |HAZ edl_BA_42;       || AT y EP para mayores de 65 a¤os

          |SI aParam ! "TC2"; |Y eldat = 1; || para el TC2 las crea al final para no molestar a los CD
               |HAZ edl_BA_10;           || horas estructurales
               |HAZ edl_BA_11;           || horas no estructurales
          |FINSI;

          |HAZ edl_CD_17;       || bonif. mayores 65 a¤os, RDL 16/2001
          |HAZ edl_BA_06;       || percepciones integras regimen artistas

          |SI eldat = 1;
               |HAZ CD_2006_Epi;
               || aEpiTc2 = #11#26;
               |HAZ edl_CD_06;           || reducciones
               |HAZ edl_CD_07;           || bonificaciones
               |HAZ edl_CD_08;           || subvenciones
               |HAZ edl_CD_10;           || form.teorica presencial
               |HAZ edl_CD_11;           || form.teorica a distancia
               |HAZ edl_CD_16;           || bonif. mayores 60 a¤os, RDL 16/2001
               ||HAZ edl_CD_21;           || bonif. Copa America
               |HAZ edl_CD_22;
               |HAZ edl_CD_23;
               |HAZ edl_CD_25;
               |HAZ edl_CD_31;
               |HAZ edl_CD_32;
               |HAZ edl_CD_34;
          |FINSI;
          |SI eldat = 2;
               |SI #11#62 = 0; |Y #11#68 = 0;
                    |HAZ CD_2006_Epi;
                    |HAZ edl_CD_06;           || reducciones
                    |HAZ edl_CD_07;           || bonificaciones
                    |HAZ edl_CD_08;           || subvenciones
                    |HAZ edl_CD_10;           || form.teorica presencial
                    |HAZ edl_CD_11;           || form.teorica a distancia
                    |HAZ edl_CD_16;           || bonif. mayores 60 a¤os, RDL 16/2001
                    ||HAZ edl_CD_21;           || bonif. Copa America
                    |HAZ edl_CD_25;           || bonif. Copa America
                    |HAZ edl_CD_31;           || bonif. Copa America
                    |HAZ edl_CD_32;
                    |HAZ edl_CD_34;
               |FINSI;
               |SI #0#17 ! 2;
                    |HAZ edl_CD_22;
                    |HAZ edl_CD_23;
               |FINSI;
          |FINSI;
          |SI eldat = 2; |Y #11#27 = 0; |Y #11#37 ! 0; |Y #11#62 ! 0; |Y #11#68 = 0;
               || para nPropMat ! 0, caso raro
               |HAZ edl_CD_07;           || bonificaciones
               |HAZ edl_CD_31;           || bonificaciones
          |FINSI;
     |SIGUE;
  |SIGUE;

     aPromed = #11#60;
     |HAZ edl_CD_01;           || prestacion enfermedad comun
     |HAZ edl_CD_03;           || prestacion accidentes

     |SI #11#49 ! 0; |Y aParam ! "TC2";
          eldat = 3;
          |HAZ dat;
     |FINSI;

     |SI #11#49 ! 0;
          |HAZ edl_BA_21;
          |HAZ edl_BA_22;
          |HAZ edl_BA_06;       || percepciones integras regimen artistas
          |HAZ edl_BA_42;       || AT y EP para mayores de 65 a¤os
     |FINSI;

     ||SI #11#67 ! 0; |Y aParam ! "TC2";
     |SI #11#67 ! 0;
          eldat = 4;

          |HAZ dat;
          |HAZ edl_BA_21;
          |HAZ edl_BA_22;
          |HAZ edl_BA_06;       || percepciones integras regimen artistas
     |FINSI;

     |SI #0#18 [ 2009;
          |SI #0#18 [ 2006;
               aEpiTc2 = 126;
          |SINO;
               aEpiTc2 = 904;
          |FINSI;
     |SINO;
     || migue
          ||HAZ VerifCNAE;
          ||aEpiTc2 = nEpigConv;
     |FINSI;

     aPromed = #11#60;
     |SI #11#62 ! 0; |O #11#68 ! 0;
          |SI #0#18 [ 2009;
               |SI #0#18 [ 2006;
                    aEpiTc2 = 126;
               |SINO;
                    aEpiTc2 = 904;
               |FINSI;
          |SINO;
|| migue
               ||HAZ VerifCNAE;
               ||aEpiTc2 = nEpigConv;
          |FINSI;

          |HAZ edl_CD_06;           || reducciones
          |HAZ edl_CD_07;           || bonificaciones
          |HAZ edl_CD_08;           || subvenciones
          |HAZ edl_CD_10;           || form.teorica presencial
          |HAZ edl_CD_11;           || form.teorica a distancia
          |HAZ edl_CD_16;           || bonif. mayores 60 a¤os, RDL 16/2001
          |HAZ edl_CD_22;
          |HAZ edl_CD_23;
          |HAZ edl_CD_28;
          |HAZ edl_CD_31;
          |HAZ edl_CD_32;
          |HAZ edl_CD_34;
     |FINSI;

     |SI #0#12 = "M";|O #0#12 = "H";
           || nVeces = 40;
           || BUCLE nomret03;     || bonificaciones retroactivas
           || borrados los procesos, esto no se usa desde 2003 que las quitaron
     |FINSI;

     |SI aParam = "TC2"; || para el TC2 las crea al final para no molestar a los CD
          |HAZ edl_BA_10;           || horas estructurales
          |HAZ edl_BA_11;           || horas no estructurales
     |FINSI;
|FPRC;

|PROCESO datos_mes;
     |SI #0#14 = "L04";
          |HAZ datos_L04;
          |ACABA;
     |FINSI;

     |SI #20#161 = "S"; #labtraba#42 = "T"; |FINSI;

     aSigno = " ";
     |HAZ ulti_dia;            || para 'liquidados'
     sw_dat1 = 0;
     sw_dat2 = 0;
     nSwDiasCero = 0;
     nReduc17_Alta = 0;

     nBaseAlta = 0;      || variables para proporcionar las bonificaciones
     nBaseTotal = 0;     || segun periodo en alta/baja
     nPropAlta = 0;
     nPropBaja = 0;
     nPropMat = 0;
     bon_60_Alta = 0;
     reducc_Alta = 0;
     bonifi_Alta = 0;
     bonifi_Baja = 0;
     bonifi25_Alta = 0;
     bonifi25_Baja = 0;
     bonjuv_Alta = 0;
     bonjuv_Baja = 0;
     bonifi_Mat = 0;
     subven_Alta = 0;
     sub85pre_Alta = 0;
     sub85dis_Alta = 0;
     nDiasAlta = 0;
     nDiasMate = 0;
     nDiasExp = 0;
     nDiasIT = 0;
     tottracd22 = 0;
     tottracd23 = 0;

     nVeces = 1;
     nVez = 0;

     |HAZ proporciona;
     |HAZ dias_alta_2;
     eldat = 0;

     swCumple = 0;
     sw5560sim = 0; || bonificaciones textil > 55 y para > 60 a la vez
     sw5960sim = 0; || bonificaciones > 59 y para > 60 a la vez
     swredbonsim = 0; || bonificaciones > 45 a¤os y > 59 a¤os a la vez
                    || es el caso que ha salido, son bonif. y reducc. a la vez
     |SI bon_55 > 0; |Y bon_60 > 0;
          sw5560sim = 1;
          nVeces = 2;
     |SINO;
          |SI reducc > 0; |Y bonifi > 0;
               |HAZ Los59;
               |SI swCumple = 59;
                    swredbonsim = 1;
                    nVeces = 2;
               |FINSI;
          |SINO;
               |SI #0#12 = "M"; |O #0#12 = "H"; nNume = #11#80; |FINSI;
               |SI #0#12 = "A";                 nNume = #21#106; |FINSI;
               |SI #0#12 = "T";                 nNume = #19#148; |FINSI;
               |SI nNume > 0; |Y bon_60 > 0;
                    sw5960sim = 1; || bonificaciones > 59 y para > 60 a la vez
                    nVeces = 2;
               |FINSI;
          |FINSI;
     |FINSI;
     |HAZ prop5560;
     |HAZ Busca;
     |SI swExiste = 0; |O aParam = "TC2";
          |HAZ Siempre;
     |SINO;
          swNuevo = 0;
          |SI #1#5 = "S";
               |SI #20#31 > 0.5; |Y #20#32 > 0.5;
                    swNuevo = 1;   || enfermedad y accidente
               |FINSI;
               |SI #20#92 > 0.5; |O #20#99 > 0.5; |O #20#95 > 0.5;
                    swNuevo = 1;   || bonif. mayores 55, 59 o 60
               |FINSI;
               |SI #20#94 > 0.5; |Y #20#112 > 0.5;     || dos bon. fom. empleo
                    swNuevo = 1;
               |FINSI;
               |SI #20#94 > 0.5; |Y #20#96 > 0.5; || 1 fom.emp. + 1 fom.emp.tex
                    swNuevo = 1;
               |FINSI;
               |SI #20#101 > 0.5;
                    swNuevo = 1;
               |FINSI;
               |SI #20#163 > 0.5;
                    swNuevo = 1;
               |FINSI;
               |SI #20#106 > 0.5;       || bonif. 50% CC en ERE
                    swNuevo = 1;
               |FINSI;
               |SI #20#108 > 0;
                    swNuevo = 1;
               |FINSI;
               |SI #20#110 > 0;
                    swNuevo = 1;
               |FINSI;
               |SI #20#12 = 502; |Y #20#43 ! 0; |Y #20#79 ! 0;
                    swNuevo = 1;
               |FINSI;
               nNume1 = #20#43; nNume1 = nNume1 ! 2;
               nNume2 = #20#39 + #11#61; nNume2 = nNume2 ! 2;
               |SI #20#12 = 501; |Y #20#43 ! 0; |Y nNume1 ! nNume2;
                    swNuevo = 1;
               |FINSI;
          |FINSI;
          |SI swNuevo = 1;
               |HAZ Nuevo;
          |SINO;
               |HAZ Siempre;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO inf04;
     #104#0 = #labtraba#0;
     #104#1 = #labtraba#1;
     #104#2 = "         ";
|FPRC;

|PROCESO sup04;
     #104#0 = #labtraba#0;
     #104#1 = #labtraba#1;
     #104#2 = "zzzzzzzzz";
|FPRC;

|PROCESO dat_L04;
     clave = "DAT";
     |HAZ ini_linea;

     |SI sw_auxil = 0;
          |DDEFECTO #3;
          #3#0  = "0";                    || indicador
          #3#1  = dat_mes;                || mes TC2
          #3#2  = " ";                    || huelga parcial (NO)
          #3#3  = " ";                    || pluriempleo (NO)
          |SI #12#237 = "S";
               #3#3  = "P";                || pluriempleo SI
          |FINSI;
          #3#4  = " ";                    || sin reduccion
          #3#5  = " ";                    || modalidad salario
          |SI #12#33 ] 8;|Y #12#33 [ 11;
               |SI #12#42 ! "D";|Y #12#42 ! "T";
                    #3#5  = "M";            || retribucion mensual grupos 8-11
               |FINSI;
          |FINSI;
          #3#6  = " ";                    || alta sin retribucion
          #3#7  = " ";                    || otros

          nNume1 = (#11#67 - #11#25 - #11#37 - #11#61);
          |SI nNume1 = #11#67;  || ERE Total
               |SI eldat = 4; |Y #11#68 ! 0;   || Exp.Reg.Empleo Total
                    #3#7 = "T";                 || parte en baja (todo)
                |FINSI;
          |SINO;
               |SI eldat = 1; |O eldat = 2;
                    |SI #11#68 ! 0;             || Exp.Reg.Empleo Parcial
                         #3#7 = "T";             || parte en alta o baja sin ERE
                    |FINSI;
               |FINSI;
               |SI eldat = 4; |Y #11#68 ! 0;    || Exp.Reg.Empleo Parcial
                    #3#7 = "P";                  || parte en baja
               |FINSI;
          |FINSI;
          |SI #12#112 ! "S";
               #3#8  = " ";                || contrato inferior a 7 dias NO
          |SINO;
               #3#8  = "C";                || contrato inferior a 7 dias SI
          |FINSI;
          |HAZ dias_alta;
          #3#9 = d_alta;                 || cotizacion (parte entera)
          #3#10 = "";                     || cotizacion (parte decimal)
          #3#11 = ind_cot;                || indicador cotizacion
          #3#12 = " ";                    || reservado
          #3#13 = "0";                              || clave dias normales
          |SI #12#42 = "A";|O #12#42 = "B";|O #12#42 = "E";|O #12#42 = "e";
               #3#13 = "4";                          || clave dias agrarios
          |FINSI;
          #3#14 = "  ";                             || especificos
          #3#15 = "  ";                             || reservado
          #3#16 = "";                             || reservado
          #3#17 = #12#33;                           || grupo cotizacion
          |SI aParam ! "TC2";
               #3#18 = "    ";                       || categoria
          |SINO;
               #3#18 = #11#20;                       || dias alta para TC2
          |FINSI;
          #3#19 = "";
          aContrato = #11#22;
          |HAZ CodigosNuevos;
          #11#22 = aContrato;
          #3#20 = #11#22;                           || clave contrato
          |SI #0#18 [ 2006;
               |SI eldat = 1;  #3#21 = #11#26;     |FINSI;   || epigrafe normal
               |SI eldat = 2;  #3#21 = #22#2;      |FINSI;   || epigrafe IT (126)
               |SI eldat = 3;  #3#21 = #22#2;      |FINSI;   || epigrafe IT (126)
               |SI eldat = 4;  #3#21 = #22#2;      |FINSI;   || epigrafe IT (126)
               |HAZ LeeEpigSec;
               aAlfa1 = #3#21;  |QBF aAlfa1;
               |SI epig_sec ! 0; |Y aAlfa1 ! "126";
                    #3#22 = epig_sec;                         || epigrafe secundario
               |SINO;
                    #3#22 = "";                               || epigrafe secundario
               |FINSI;
          |SINO;
               |SI #0#18 [ 2009;
                    |SI eldat = 1; |Y #11#26 > 900;
                         #3#23 = #labtraba#204;
                    |FINSI;
                    |SI eldat = 2; |O eldat = 3; |O eldat = 4; |O #11#68 ! 0;
                         #3#23 = "c";
                    |FINSI;
               |SINO;
                    |SI #11#26 > 900;
                         #3#23 = #labtraba#204;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI aParam ! "TC2";
               #3#24 = "";                           || indicad.cotiz.cont.exc.
               #3#25 = "";                           || reservado

               |HAZ BuscaDisca;
               #3#26 = "";
          |SINO;
               #3#24 = #11#24;                       || horas contrato
               #3#26 = #12#42;                       || clave dias salario
          |FINSI;
          |SI #11#74 ! 0;
               #3#27 = #11#74;
          |FINSI;
          |SI #11#76 ! 0;
                #3#27 = #11#76;
          |FINSI;
          aAlfa = #11#79; |QBF aAlfa;
          |SI aAlfa ! "";
               #3#27 = #11#79;
          |FINSI;
          #3#28 = #11#77;                || Informacion complementaria RED
          #3#29 = "";
          |SI eldat = 1;   sw_dat1 = 1;   |FINSI;
          |SI eldat = 2;   sw_dat2 = 1;   |FINSI;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO datos_L04;
     aSigno = "-"
     #104#0 = #labtraba#0;
     #104#1 = #labtraba#1;
     #104#5 = 0;
     #104#6 = #labempre#2;
     #104#7 = #labtraba#2;

     |SI #11#32 > 0;
          #104#2 = "EDL_CD_01";
          #104#3 = "Prestacion Enfermedad Comun";
          #104#4 = #11#32;
          |GRABA 020#104n;
     |FINSI;

     |SI #11#34 > 0;
          #104#2 = "EDL_CD_03";
          #104#3 = "Prestacion Accidente Laboral";
          #104#4 = #11#34;
          |GRABA 020#104n;
     |FINSI;

     |SI reducc > 0; |Y swbon_65 = 0; |Y swbon_31 = 0; |Y swbon_34 = 0;
          #104#2 = "EDL_CD_06";
          #104#3 = "Reducciones INEM";
          #104#4 = reducc;
          |GRABA 020#104n;
     |FINSI;

     |SI bonifi > 0; |Y swbon_21 = 0; |Y swbon_25 = 0;
          #104#2 = "EDL_CD_07";
          #104#3 = "Bonificaciones Seguridad Social";
          #104#4 = bonifi;
          |GRABA 020#104n;
     |FINSI;

     |SI subven > 0;
          #104#2 = "EDL_CD_08";
          #104#3 = "Subvenciones";
          #104#4 = subven;
          |GRABA 020#104n;
     |FINSI;

     |SI sub85pre > 0;
          #104#2 = "EDL_CD_10";
          #104#3 = "Bonif. Formacion Presencial";
          #104#4 = sub85pre;
          |GRABA 020#104n;
     |FINSI;

     |SI sub85dis > 0;
          #104#2 = "EDL_CD_11";
          #104#3 = "Bonif. Formacion a Distancia";
          #104#4 = sub85dis;
          |GRABA 020#104n;
     |FINSI;

     |SI bon_60 > 0;
          #104#2 = "EDL_CD_16";
          #104#3 = "Bonif. Mayores de 60 a¤os";
          #104#4 = bon_60;
          |GRABA 020#104n;
     |FINSI;

     |SI reducc > 0; |Y swbon_65 ! 0;
          #104#2 = "EDL_CD_17";
          #104#3 = "Bonif. Mayores de 65 a¤os";
          #104#4 = reducc;
          |GRABA 020#104n;
     |FINSI;

     |SI reducc > 0; |Y swbon_21 ! 0; |Y swbon_25 ! 0;
          #104#2 = "EDL_CD_21";
          #104#3 = "Bonif. Copa America";
          #104#4 = bonifi;
          |GRABA 020#104n;
     |FINSI;

     |SI #11#73 > 0;
          #104#2 = "EDL_CD_22";
          #104#3 = "Bonif. Fomento Empleo";
          #104#4 = #11#73;
          |GRABA 020#104n;
     |FINSI;

     |SI #11#88 > 0;
          #104#2 = "EDL_CD_28";
          #104#3 = "Bonif. 50% Cuota CC en ERE";
          #104#4 = #11#88;
          |GRABA 020#104n;
     |FINSI;
     |SI reducc > 0; |Y swbon_31 ! 0;
          #104#2 = "EDL_CD_31";
          #104#3 = "Bonificacion Tarifa Plana";
          #104#4 = reducc;
          |GRABA 020#104n;
     |FINSI;

     |SALVA_FICHA #labtraba;
     |ENTLINEAL #1#104, 3, 2, 22, 1, inf04, sup04;
     |REPON_FICHA #labtraba;

     #104#0 = #labtraba#0;
     #104#1 = #labtraba#1;

     #104#2 = "EDL_CD_01";
     |LEE 000#104=;
     |SI FSalida = 0;
          #11#32 = #104#5;
     |FINSI;

     #104#2 = "EDL_CD_03";
     |LEE 000#104=;
     |SI FSalida = 0;
          #11#34 = #104#5;
     |FINSI;

     #104#2 = "EDL_CD_06";
     |LEE 000#104=;
     |SI FSalida = 0;
          reducc = #104#5;
     |FINSI;

     #104#2 = "EDL_CD_07";
     |LEE 000#104=;
     |SI FSalida = 0;
          bonifi = #104#5;
     |FINSI;

     #104#2 = "EDL_CD_08";
     |LEE 000#104=;
     |SI FSalida = 0;
          subven = #104#5;
     |FINSI;

     #104#2 = "EDL_CD_10";
     |LEE 000#104=;
     |SI FSalida = 0;
          sub85pre = #104#5;
     |FINSI;

     #104#2 = "EDL_CD_11";
     |LEE 000#104=;
     |SI FSalida = 0;
          sub85dis = #104#5;
     |FINSI;

     #104#2 = "EDL_CD_16";
     |LEE 000#104=;
     |SI FSalida = 0;
          bon_60 = #104#5;
     |FINSI;

     #104#2 = "EDL_CD_17";
     |LEE 000#104=;
     |SI FSalida = 0;
          reducc = #104#5;
     |FINSI;

     #104#2 = "EDL_CD_21";
     |LEE 000#104=;
     |SI FSalida = 0;
          bonifi = #104#5;
     |FINSI;

     #104#2 = "EDL_CD_22";
     |LEE 000#104=;
     |SI FSalida = 0;
          #11#73 = #104#5;
     |FINSI;

     #104#2 = "EDL_CD_28";
     |LEE 000#104=;
     |SI FSalida = 0;
          #11#88 = #104#5;
     |FINSI;

     #104#2 = "EDL_CD_31";
     |LEE 000#104=;
     |SI FSalida = 0;
          reducc = #104#5;
     |FINSI;

     |HAZ ulti_dia;            || para 'liquidados'
     sw_dat1 = 0;
     sw_dat2 = 0;
     nSwDiasCero = 0;
     nReduc17_Alta = 0;

     nBaseAlta = 0;      || variables para proporcionar las bonificaciones
     nBaseTotal = 0;     || segun periodo en alta/baja
     nPropAlta = 0;
     nPropBaja = 0;
     nPropMat = 0;
     bon_60_Alta = 0;
     reducc_Alta = 0;
     bonifi_Alta = 0;
     bonifi_Baja = 0;
     bonifi25_Alta = 0;
     bonifi25_Baja = 0;
     bonifi_Mat = 0;
     subven_Alta = 0;
     sub85pre_Alta = 0;
     sub85dis_Alta = 0;

     nPropAlta = 1;

     nNume1 = #11#32 + #11#34 + reducc + bonifi + subven + sub85pre + sub85dis + bon_60;
     nNume1 = nNume1 + #11#73 + #11#88 + #11#75;
     |SI nNume1 ! 0;
          eldat = 1;
          |HAZ CD_2006_Epi;
          |HAZ dat_L04;
          |HAZ pasaaeuros_edl;

          |HAZ edl_CD_01;           || prestacion enfermedad comun
          |HAZ edl_CD_03;           || prestacion enfermedad comun
          |HAZ edl_CD_06;           || reducciones
          |HAZ edl_CD_07;           || bonificaciones
          |HAZ edl_CD_08;           || subvenciones
          |HAZ edl_CD_10;           || form.teorica presencial
          |HAZ edl_CD_11;           || form.teorica a distancia
          |HAZ edl_CD_16;           || bonif. mayores 60 a¤os, RDL 16/2001
          |HAZ edl_CD_17;           || bonif. mayores 65 a¤os, RDL 16/2001
          |HAZ edl_CD_22;           || bonif. Copa America
          |HAZ edl_CD_25;           || bonif. Copa America
          |HAZ edl_CD_28;
          |HAZ edl_CD_31;
     |SINO;
          |BORRA 020#5a;          || borra el TRA
          |LEE 101#5a;
          |BORRA 020#5a;          || borra el AYN
          |LEE 101#5a;
          nro_trab = nro_trab - 1;
          linea = linea - 2;
          nlinea = nlinea - 1;
     |FINSI;
|FPRC;

|PROCESO ulti_dia11;     || halla el ultimo dia del mes
    bisiesto = 0;
    nume1 = #0#0 $ 4;    || a¤o historico
|SI nume1 = 0;|Y #36#9 = "S";
        bisiesto = 1;
|FINSI;

    topemes = 31;
|SI ult11 = 2;
        topemes = 28 + bisiesto;
|FINSI;
|SI ult11 = 4;|O ult11 = 6;|O ult11 = 9;|O ult11 = 11;
        topemes = 30;
|FINSI;
|FPRC;

|PROCESO LeeEpigSec;
     |ABRE #nomepitr;
     #nomepitr#0 = #labtraba#0;
     #nomepitr#1 = #labtraba#1;
     #nomepitr#2 = #labtraba#32;
     |LEE 000#nomepitr.=;
     |SI FSalida = 0; |Y #0#18 [ 2006;
          epig_sec = #nomepitr#5;
     |SINO;
          epig_sec = 0;
     |FINSI;
     |CIERRA #nomepitr;
|FPRC;

|PROCESO ultimo_dia;     || halla el ultimo dia del mes
    bisiesto = 0;
    nume1 = nAnyoHis $ 4;    || a¤o historico
|SI nume1 = 0;|Y #36#9 = "S";
        bisiesto = 1;
|FINSI;

    topemes = 31;
|SI nMes = 2;
        topemes = 28 + bisiesto;
|FINSI;
|SI nMes = 4;|O nMes = 6;|O nMes = 9;|O nMes = 11;
        topemes = 30;
|FINSI;
|FPRC;

|PROCESO tipo_C_meses_1;           || liquidaciones complmentarias
     |SALVA_DATOS #11;
     |HAZ iniswitch;
     #labtraba#0 = #11#0;
     #labtraba#1 = #11#39;
     |LEE 000#labtraba.=;

     #11#20 = #nomlicol#5;         || dias en alta
     #11#22 = #labtraba#45;        || tipo de contrato
     #11#25 = #nomlicol#8;         || base CC
    |SI #0#18 [ 2006
        #11#26 = #labtraba#32;                  || Epigrafe
    |SINO;
        |HAZ VerifCNAE;
        #11#26 = nEpigConv;                  || Epigrafe
    |FINSI;
     #11#27 = #nomlicol#9;         || base CP
     #11#63 = #nomlicol#10;        || dias efectivos
     #11#72 = #nomlicol#11;        || dias IT carbon (laborables)
     dat_mes = #nomlicol#2;

     |HAZ datos_mes;

     |REPON_DATOS #11;
|FPRC;

|DEFBUCLE tipo_C_meses;
     #nomlicol#1;
     ;
     #11#0, #0#0, #0#1,  #11#39;
     #11#0, #0#0, #0#13, #11#39;
     ;
     NULL, tipo_C_meses_1;
|FIN;

|PROCESO tipo_T_meses_10;          || normales

|SALVA_DATOS #11;
||SI nPEnf = -1;
        nPEnf = #19#35;
        nPAcc = #19#36;
||FINSI;
|HAZ iniswitch;
    #11#20 = #19#8;      || dias en alta
    #11#22 = #19#9;      || tipo de contrato
    #11#24 = #19#11;     || horas contrato
    #11#25 = #19#39;     || base CC
    |SI #0#18 [ 2006
        #11#26 = #labtraba#32;                  || Epigrafe
    |SINO;
        |HAZ VerifCNAE;
        #11#26 = nEpigConv;                  || Epigrafe
    |FINSI;

     || el tema del ajuste en atrasos

     #11#43 = #19#31;     || enfermedad comun
     #11#44 = #19#32;     || accidente trabajo
     #11#49 = #19#65;     || maternidad
     dat_mes = #19#2;
     |HAZ modulo2;
     |SI swAjuste3 ! 0;
          |SI #19#65 ! 0;
               #19#65 = #19#65 - swAjuste3;
          |SINO;
               |SI #19#31 ! 0;
                    #19#31 = #19#31 - swAjuste3;
               |SINO;
                    |SI #19#32 ! 0;
                         #19#32 = #19#32 - swAjuste3;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

|SI #19#65 ! 0;|Y #11#22 ! 87;|Y #11#22 ! 97; |Y #11#22 ! 85; |Y #11#22 ! 421;
        ult11 = #19#2;   |HAZ ulti_dia11;
        nume1 = #19#65;  |HAZ liquidados;

          d_coti = (#19#8 ! 0);     || dias cotizables
          d_baja = (#19#31 + #19#32 + #19#33 + #19#65);   || dias de baja

          || vamos a ver, parche al parche: en febrero si d_baja es igual a 28
          || es porque estoy todo el puto mes de baja, eso quiere decir que
          || tengo que cotizar por 30 dias si soy mensual, con lo que en nume2
          || aparecen 2 dias que no tiene por que aparecer. En los demas meses
          || no pasa, lo soluciono asi: 14.04.2005
          |SI #19#2 = 2; |Y #labtraba#42 = "M"; |Y d_baja ] 28;
               d_baja = 30;
          |FINSI;

          nume2 = d_coti - d_baja;  || esto porque si en atrasos estamos
                                    || todo el mes de baja, si hay maternidad
                                    || no es necesario recalcular

          |SI nume2 > 0;
               #19#62 = nPAcc * nume1;              || recalcula base ILT ****
          |FINSI;
          #11#27 = #19#40 - #19#62;      || base CP

          ||SI #11#27 < 0;
          ||     #11#27 = 0;
          ||FINSI;


        nume4 = #19#62;  || me quedo con base IT original por si me hace falta
||        #19#62 = nPAcc * nume1;              || recalcula base ILT
||        #11#27 = #19#40 - #19#62;      || base CP

        #11#61 = nPEnf * nume1;
        #11#62 = nPAcc * nume1;

        #11#25 = #11#25 + (nPEnf * nume1);  || maternidad
        #11#27 = #11#27 + (nPAcc * nume1);
        dias_enfmat = #19#31 + #19#65;       || dias enf + dias mat
        |SI dias_enfmat ] topemes;
            #11#27 = 0;       || parche gordo: si esta todo el mes entre
            #19#62 = nume4;   || maternidad y enfermedad,la base CP es cero
        |FINSI;               || y uso como base IT la q me guarde antes
|SINO;
        #11#27 = #19#40 - #19#62;      || base CP
    |SI #11#27 < 0;
            #19#62 = #19#62 + #11#27;
            #11#27 = 0;
    |FINSI;
    |SI s_ori = "T";
        #11#61 = 0; #11#62 = 0;    || se supone que si no tengo mater
    |FINSI;
|FINSI;
    #11#28 = #19#41;               || base horas 1
    #11#29 = #19#42;               || base horas 2

    #11#33 = #19#31 + #19#32 + #19#65;  || dias enfer.acci.mater.

    || los dias de ILT se desglosan usando los campos
    || desde/hasta informativos
    #11#43 = #19#31;     || enfermedad comun
    #11#44 = #19#32;     || accidente trabajo
    #11#49 = #19#65;     || maternidad
    |SI #labempre#127 = 0;
         #11#32 = #19#57;                    || dto. enfermedad
         #11#34 = #19#58;     || dto. acc.trabajo
    |FINSI;
    #11#35 = #19#12;     || codigo bonificacion
     |SI #0#18 [ 2009;
          |SI #0#18 [ 2006;
               #11#36 = #22#2;
          |SINO;
               #11#36 = 904;
          |FINSI;
     |SINO;
|| migue
          |HAZ VerifCNAE;
          #11#36 = nEpigConv;
     |FINSI;
    #11#37 = #19#62;     || base ILT
    #11#59 = nPEnf;      || promedio enfermedad
    #11#60 = nPAcc;      || promedio accidente

|SI #19#65 ! 0;
        ult11 = #19#2;   |HAZ ulti_dia11;
        nume1 = #19#65;  |HAZ liquidados;
        bcomun = (nPEnf * nume1) % #22#7;
        bprofe = (nPAcc * nume1) % (#22#13 + #22#15 + #22#17 + #22#19);
        bcomun = bcomun ! EURODB;
        bprofe = bprofe ! EURODB;
     ||   #19#55 = bcomun + bprofe;  || reduccion por maternidad
|SINO;
     #11#46 = "";
|FINSI;                            || (usa un campo inhibido del nomcalca)

|PARA nume1 = 27; |SI nume1 [ 30; |HACIENDO nume1 = nume1 + 1;

    |SI #19nume1 = "M";       || parche de AGIRED para maternidad
            #11#46 = #19#55;  || (usa el campo 'LITERAL ATRASOS')
    |FINSI;
|SIGUE;
    bonifi = 0;
    reducc = 0;
    subven = 0;
    sub85pre = 0;
    sub85dis = 0;
    bon_60 = 0;
    swbon_65 = 0;
    swbon_21 = 0;
    swbon_25 = 0;

|SI #19#63 ! 0;|O #19#64 ! 0;|O #19#123 ! 0;|O #19#130 ! 0; |O #19#148 ! 0;
  |SI #labempre#127 = 0;
         |HAZ lee_bonif;                            || lee la bonificacion
         |SI #13#10 = 1; reducc = #19#63 + #19#123;    |FINSI;
         |SI #13#10 = 2; bonifi = #19#63 + #19#123;    |FINSI;
         |SI #13#10 = 3; reducc = #19#63 + #19#123;    |FINSI;
         |SI #13#10 = 4;  reducc = #19#63 + #19#123; swbon_65 = 1;    |FINSI;
         |SI #13#10 = 5;  bonifi = #19#63 + #19#123; swbon_21 = 1;    |FINSI;
         |SI #19#9 = 85; |O #19#9 = 97; |O #19#9 = 421; || formacion teorica
             |SI #13#12 > 2.4;           || precio hora
                     sub85pre = #19#64;
             |SINO;
                     sub85dis = #19#64;
             |FINSI;
         |SINO;
                 subven = #19#64;
         |FINSI;
         |SI #19#130 ! 0;             || bonif. mayores 60 a¤os, RDL 16/2001
             bon_60 = #19#130;
         |FINSI;
         |SI #19#148 ! 0;             || bonif. mayores 59 a¤os
               reducc = reducc + #19#148;
         |FINSI;
    |FINSI;
|FINSI;

     |SI #19#119 ! 0;     || si tengo dias Exp.Reg.Empleo
          #11#67 = #19#119 * (#11#67 / #11#69) ! EURODB;
          || #11#67 = (#11#67 * #11#69) ! EURODB;
          #11#68 = #19#119 * (#11#68 / #11#69) ! EURODB;
          || #11#68 = (#11#68 * #11#69) ! EURODB;
          #11#69 = #19#119;
     |SINO;
          #11#67 = 0;
          #11#68 = 0;
          #11#69 = 0;
     |FINSI;
     |SI #11#74 = 3141; |Y #19#148 = 0;
          #11#74 = 0;
     |FINSI;
     |HAZ prop_epig;
     dat_mes = #19#2;
     |HAZ datos_mes;

     |REPON_DATOS #11;
|FPRC;

|PROCESO tipo_T_meses_1;
|SI s_pas [ 3; |HAZ tipo_T_meses_10;    |FINSI;
|FPRC;

|DEFBUCLE tipo_T_meses;
 #19#1;
 ;
 #11#0, #11#39, any_hist, #0#1,  #0#17;
 #11#0, #11#39, any_hist, #0#13, #0#17;
 ;
 NULL, tipo_T_meses_1;
|FIN;

|PROCESO tipo_A_meses_10;
     |SALVA_DATOS #11;

     nPEnf = #21#35;
     nPAcc = #21#36;
     |HAZ iniswitch;
     #11#20 = #21#8;      || dias en alta
     #11#22 = #21#9;      || tipo de contrato
     #11#24 = #21#11;     || horas contrato
     #11#25 = #21#39;     || base CC
    |SI #0#18 [ 2006
        #11#26 = #labtraba#32;                  || Epigrafe
    |SINO;
        |HAZ VerifCNAE;
        #11#26 = nEpigConv;                  || Epigrafe
    |FINSI;

     || el tema del ajuste en atrasos

     #11#43 = #21#31;     || enfermedad comun
     #11#44 = #21#32;     || accidente trabajo
     #11#49 = #21#65;     || maternidad
     dat_mes = #21#2;
     |HAZ modulo2;
     |SI swAjuste3 ! 0;
          |SI #21#65 ! 0;
               #21#65 = #21#65 - swAjuste3;
          |SINO;
               |SI #21#31 ! 0;
                    #21#31 = #21#31 - swAjuste3;
               |SINO;
                    |SI #21#32 ! 0;
                         #21#32 = #21#32 - swAjuste3;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI #21#65 ! 0;|Y #11#22 ! 87;|Y #11#22 ! 97; |Y #11#22 ! 85; |Y #11#22 ! 421;
          ult11 = #21#2;   |HAZ ulti_dia11;
          nume1 = #21#65;  |HAZ liquidados;
          d_coti = (#21#8 ! 0);     || dias cotizables
          d_baja = (#21#31 + #21#32 + #21#33 + #21#65);   || dias de baja

          || vamos a ver, parche al parche: en febrero si d_baja es igual a 28
          || es porque estoy todo el puto mes de baja, eso quiere decir que
          || tengo que cotizar por 30 dias si soy mensual, con lo que en nume2
          || aparecen 2 dias que no tiene por que aparecer. En los demas meses
          || no pasa, lo soluciono asi: 14.04.2005
          |SI #21#2 = 2; |Y #labtraba#42 = "M"; |Y d_baja ] 28;
               d_baja = 30;
          |FINSI;

          nume2 = d_coti - d_baja;  || esto porque si en atrasos estamos
                                    || todo el mes de baja, si hay maternidad
                                    || no es necesario recalcular

          |SI nume2 > 0;
               #21#62 = nPAcc * nume1;              || recalcula base ILT ****
          |FINSI;
          #11#27 = #21#40 - #21#62;      || base CP

          #11#61 = nPEnf * nume1;
          #11#62 = nPAcc * nume1;

          |SI nume2 > 0;
               #11#25 = #11#25 + (nPEnf * nume1);   || maternidad 1995  ****
               #11#27 = #11#27 + (nPAcc * nume1);   || ****
          |FINSI;
     |SINO;

          #11#27 = #21#40 - #21#62;      || base CP
          |SI #11#27 < 0;
              #21#62 = #21#62 + #11#27;
              #11#27 = 0;
          |FINSI;
          |SI s_ori = "A";
               #11#61 = 0; #11#62 = 0;    || se supone que si no tengo mater
          |FINSI;                         || la base de mater es cero (atrasos!!)
     |FINSI;
     #11#28 = #21#41;               || base horas 1
     #11#29 = #21#42;               || base horas 2

     #11#33 = #21#31 + #21#32 + #21#65;  || dias enfer.acci.mater.

     || los dias de ILT se desglosan usando los campos
     || desde/hasta informativos
     #11#43 = #21#31;     || enfermedad comun
     #11#44 = #21#32;     || accidente trabajo
     #11#49 = #21#65;     || maternidad
     |SI #labempre#127 = 0;
          #11#32 = #21#57;                    || dto. enfermedad
          #11#34 = #21#58;     || dto. acc.trabajo
     |FINSI;
     #11#35 = #21#12;     || codigo bonificacion
     |SI #0#18 [ 2009;
          |SI #0#18 [ 2006;
               #11#36 = 126;
          |SINO;
               #11#36 = 904;
          |FINSI;
     |SINO;
|| migue
          |HAZ VerifCNAE;
          #11#36 = nEpigConv;
     |FINSI;
     #11#37 = #21#62;     || base ILT
     #11#59 = nPEnf;      || promedio enfermedad
     #11#60 = nPAcc;      || promedio accidente

     |SI #21#65 ! 0;
          ult11 = #21#2;   |HAZ ulti_dia11;
          nume1 = #21#65;  |HAZ liquidados;
          bcomun = (nPEnf * nume1) % #22#7;
          bprofe = (nPAcc * nume1) % (#22#13 + #22#15 + #22#17 + #22#19);
          bcomun = bcomun ! EURODB;
          bprofe = bprofe ! EURODB;
     |SINO;
          #11#46 = "";
     |FINSI;                            || (usa un campo inhibido del nomcalca)

     |PARA nume1 = 27; |SI nume1 [ 30; |HACIENDO nume1 = nume1 + 1;
          |SI #21nume1 = "M";       || parche de AGIRED para maternidad
               #11#46 = #21#55;  || (usa el campo 'LITERAL ATRASOS')
          |FINSI;
     |SIGUE;

     bonifi = 0;
     reducc = 0;
     subven = 0;
     sub85pre = 0;
     sub85dis = 0;
     bon_60 = 0;
     swbon_65 = 0;
     swbon_21 = 0;
     swbon_25 = 0;

     |SI #21#63 ! 0;|O #21#64 ! 0;|O #21#81 ! 0; |O #21#88 ! 0; |O #21#106 ! 0;
          |SI #labempre#127 = 0;
               |HAZ lee_bonif;                           || lee la bonificacion
               |SI #13#10 = 1; reducc = #21#63 + #21#81;     |FINSI;
               |SI #13#10 = 2; bonifi = #21#63 + #21#81;     |FINSI;
               |SI #13#10 = 3; reducc = #21#63 + #21#81;     |FINSI;
               |SI #13#10 = 4; reducc = #21#63 + #21#81; swbon_65 = 1;    |FINSI;
               |SI #13#10 = 5; bonifi = #21#63 + #21#81; swbon_21 = 1;    |FINSI;
               |SI #21#9 = 85; |O #21#9 = 97; |O #21#9 = 421; || formacion teorica
                    |SI #13#12 > 2.4;           || precio hora
                         sub85pre = #21#64;
                    |SINO;
                         sub85dis = #21#64;
                    |FINSI;
               |SINO;
                    subven = #21#64;
               |FINSI;
               |SI #21#88 ! 0;             || bonif. mayores 60 a¤os, RDL 16/2001
                    bon_60 = #21#88;
               |FINSI;
               |SI #21#106 ! 0;             || bonif. mayores 59 a¤os
                    reducc = reducc + #21#106;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #21#78 ! 0;     || si tengo dias Exp.Reg.Empleo
          #11#67 = #21#78 * (#11#67 / #11#69) ! EURODB;     || en atrasos es una mierda
          #11#68 = #21#78 * (#11#68 / #11#69) ! EURODB;     || hay que sacar la base de
          #11#69 = #21#78;
     |SINO;
          #11#67 = 0;
          #11#68 = 0;
          #11#69 = 0;
     |FINSI;
     |SI #11#74 = 3141; |Y #21#106 = 0;
          #11#74 = 0;
     |FINSI;
     |HAZ prop_epig;
     dat_mes = #21#2;
     |HAZ datos_mes;

     |REPON_DATOS #11;
|FPRC;

|PROCESO tipo_A_meses_1;
|SI s_pas [ 3; |HAZ tipo_A_meses_10;    |FINSI;
|FPRC;

|DEFBUCLE tipo_A_meses;
 #21#1;
 ;
 #11#0, #11#39, #0#1,  5;
 #11#0, #11#39, #0#13, 5;
 ;
 NULL, tipo_A_meses_1;
|FIN;

|PROCESO vacaciones_formacion;
     |SI #labtraba#33 = 10; nBase = #nomconst#33;    |FINSI;
     |SI #labtraba#33 = 11; nBase = #nomconst#34;    |FINSI;

     || nBase = (nBase % 75) * dias_finiq;
     nBase = (nBase % 100) * dias_finiq;

     #11#25 = nBase;
     #11#27 = nBase;

     |SI #20#120 ! 0;
          reducc = #20#120;
     |FINSI;
|FPRC;

|PROCESO vacaciones;               || se realiza TC complementario en caso de
     nAnyo = #0#0 - 2000;
     dat_mes = nMesVac;
     total_dias = nDiasVac;
     dias_finiq = nDiasDisp;

     |SI #labtraba#45 = "421";
          |HAZ vacaciones_formacion;
          nSwitchEuro1 = 0;   || para que me redondee a euros !!!
          |HAZ datos_mes;
          |ACABA;
     |FINSI;

     |SI swEsElUltimo = 0; || si no es el ultimo mes
          #11#25 = ((nBaseCC_vac * dias_finiq) / total_dias) ! EURODB;
          #11#27 = ((nBaseCP_vac * dias_finiq) / total_dias) ! EURODB;
          nBaseCC_acu = nBaseCC_acu + #11#25;
          nBaseCP_acu = nBaseCP_acu + #11#27;
     |SINO;
          #11#25 = nBaseCC_vac - nBaseCC_acu;
          #11#27 = nBaseCP_vac - nBaseCP_acu;
     |FINSI;

     |SI dias_finiq > 0;      || no bonifiques si no tienes dias
          |HAZ calcula_bonif; || finiquito con vacaciones
     |FINSI;

     || ahora tiene que proporcionar segun los meses que haya calculado
     || para el finiquito tambien todas las bonificaciones y reducciones
     || hago con todas las variables que tienen importes de bonif. lo mismo
     |SI reducc > 0;
          nReducc_vac = reducc;
          |SI swEsElUltimo = 0; || si no es el ultimo mes
               reducc = ((nReducc_vac * dias_finiq) / total_dias) ! EURODB;
               nReducc_acu = nReducc_acu + reducc;
          |SINO;
               reducc = nReducc_vac - nReducc_acu;
          |FINSI;
     |FINSI;

     |SI bonifi > 0;
          nBonifi_vac = bonifi;
          |SI swEsElUltimo = 0; || si no es el ultimo mes
               bonifi = ((nBonifi_vac * dias_finiq) / total_dias) ! EURODB;
               nBonifi_acu = nBonifi_acu + bonifi;
          |SINO;
               bonifi = nBonifi_vac - nBonifi_acu;
          |FINSI;
     |FINSI;

     |SI subven > 0;
          nSubven_vac = subven;
          |SI swEsElUltimo = 0; || si no es el ultimo mes
               subven = ((nSubven_vac * dias_finiq) / total_dias) ! EURODB;
               nSubven_acu = nSubven_acu + subven;
          |SINO;
               subven = nSubven_vac - nSubven_acu;
          |FINSI;
     |FINSI;

     |SI bon_60 > 0;
          nBon_60_vac = bon_60;
          |SI swEsElUltimo = 0; || si no es el ultimo mes
               bon_60 = ((nBon_60_vac * dias_finiq) / total_dias) ! EURODB;
               nBon_60_acu = nBon_60_acu + bon_60;
          |SINO;
               bon_60 = nBon_60_vac - nBon_60_acu;
          |FINSI;
     |FINSI;

     nSwitchEuro1 = 0;   || para que me redondee a euros !!!
     |HAZ datos_mes;
|FPRC;

|PROCESO trabajadores;
     #12#0 = #11#0;       || empresa
     #12#1 = #11#39;      || trabajador
     |LEE 000#12=;
     |SI FSalida = 0;
          |HAZ iniswitch;
          |SI #11#25 ! 0;|O #11#27 ! 0;|O #11#37 ! 0;|O #11#67 ! 0;
               |SI #0#14 = "L04";  || estoy en complementaria deducciones
                    |ABRE #20;          || leo la copia del nomcalca para
                    #20#0 = #11#0;      || comprobar luego si hay bonif
                    #20#1 = #11#39;     || porque si no hay bonif ni deducc
                    #20#2 = #0#1;       || el trabajador no tengo que presen-
                    #20#3 = #11#48;     || tarlo
                    |LEE 000#20=;                 || lee calculos cabs.
                    |CIERRA #20;

                    nNume1 = #11#32 + #11#34 + #20#63 + #20#64 + #20#81 + #20#92 + #20#106;
                    nNume1 = nNume1 + #11#73 + #20#95 + #20#96 + #20#99;
                    |SI nNume1 = 0;
                         |ACABA;
                    |FINSI;
               |FINSI;

               nEmp_Act = #11#0;
               aNAFSS_Act = #11#52;
               aSSCen2_Act = #11#9;       || nro patronal Centro
               |QBF aNAFSS_Act;
               |QBF aSSCen2_Act;
               |SI aNAFSS_Act = aNAFSS_Ant; |Y nEmp_Act = nEmp_Ant;
               |Y aSSCen2_Act = aSSCen2_Ant;
               ||Y aSSCen2_Act = aSSCen2_Ant; |Y #0#17 ! 2;
                    || mismo trabajador en misma empresa: no crees dos DAT
               |SINO;                             || si es el mismo NAFSS, entonces
                                                  || es el mismo trab. que ha tenido
                    ||SI #11#48 ! 2;|O #0#17 = 2;  || alta y baja o cambio de algo y
                         nro_trab = nro_trab + 1; || NO tengo que crear dos segmentos
                    ||FINSI;                       || TRA ni AYN, con uno vale. Tampoco
                    |HAZ tra;                     || tengo que contar dos veces al mismo
                    |HAZ ayn;                     || trabajador (05.04.2004)
               |FINSI;
               || ATENCION: el 31.05.2005 quito la condicion de los finiquitos
               || antes en finiquitos repetia el TRA y el AYN, ahora lo quito
               || porque ha salido un trabajador con 2 finiquitos el mismo mes
               nEmp_Ant = #11#0;
               aNAFSS_Ant = #11#52;
               aSSCen2_Ant = #11#9;
               |QBF aNAFSS_Ant;
               |QBF aSSCen2_Ant;

               |SI #0#12 = "A"; |O #0#12 = "T"; |O #0#12 = "C";
                    nPEnf = -1;
                    nPAcc = -1;
                    |SI #0#12 = "A";  |BUCLE tipo_A_meses;     |FINSI;
                    |SI #0#12 = "T";  |BUCLE tipo_T_meses;     |FINSI;
                    |SI #0#12 = "C";  |BUCLE tipo_C_meses;     |FINSI;
               |SINO;
                    |SI #0#17 = 2; |Y #0#14 ! "L04";
                         desde_mes = #0#13;
                         nBaseCC_vac = #11#25;       || guarda las bases para finiquitos
                         nBaseCP_vac = #11#27;       || para proporcionar las vacaciones
                         nBonifFCI_vac = #11#73 * 100;     || bonifFCI
                         nBonifTex_vac = #11#75 * 100;     || bonifTex

                         |SI #0#0 > 1999;           || paso a¤o a dos digitos
                              nume1 = #0#0 - 2000;
                         |SINO;
                              nume1 = #0#0 - 1999;
                         |FINSI;

                         |SI #0#12 = "M";
                              |ABRE #59;
                              #59#0 = #11#0;          || empresa
                              #59#1 = #11#39;         || trabajador
                              #59#2 = #0#13;          || mes
                              #59#3 = 2;              || tipo (= 2, finiquitos)
                              #59#4 = 125;            || concepto (el 125)
                              |LEE 000#59=;
                              |SI FSalida = 0;
                                   |SI #59#11 > 0; |Y #59#11 < 1;
                                        nDiasVac = 1;
                                   |SINO;
                                        nDiasVac = #59#11;
                                   |FINSI;
                                   nDiasVac = (nDiasVac + 0.49) ! 0;
                              |FINSI;
                              aAlfa1 = #59#8;
                              |QBF aAlfa1;
                              |SI aAlfa1 = "XXXX";
                                   |BORRA 020#59a;
                              |FINSI;
                              |CIERRA #59;
                         |SINO;
                              |ABRE #60;
                              #60#0 = #11#0;          || empresa
                              #60#1 = #11#39;         || trabajador
                              #60#12 = nume1;         || a¤o
                              #60#2 = #0#13;          || mes
                              #60#3 = 2;              || tipo (= 2, finiquitos)
                              #60#4 = 125;            || concepto (el 125)
                              |LEE 000#60=;
                              |SI FSalida = 0;
                                   |SI #60#11 > 0; |Y #60#11 < 1;
                                        nDiasVac = 1;
                                   |SINO;
                                        nDiasVac = #60#11;
                                   |FINSI;
                                   nDiasVac = (nDiasVac + 0.49) ! 0;
                              |FINSI;
                              aAlfa1 = #60#8;
                              |QBF aAlfa1;
                              |SI aAlfa1 = "XXXX";
                                   |BORRA 020#60a;
                              |FINSI;
                              |CIERRA #60;
                         |FINSI;

                         nBaseCC_acu = 0;
                         nBaseCP_acu = 0;
                         nReducc_acu = 0;
                         nBonifi_acu = 0;
                         nSubven_acu = 0;
                         nSub85pre_acu = 0;
                         nSub85dis_acu = 0;
                         nBon_60_acu = 0;

                         nAnyoHis = #0#0;

                         || nDiasVac: Dias que hay que cotizar por vacaciones
                         || nMesVac: el mes que estamos calculando
                         || nMesesVac: nro. meses en que se cotiza por vacaciones
                         || topemes: numero de dias del mes
                         || nDiasDisp: Dias disponibles para cotizar por vacaciones en
                         ||            el mes de calculo del finiquito
                         || nDiasRes: Dias que quedan por cotizar

                         nMesVac = #0#1;
                         nMesVac = nMesVac - 1;   || pirula para que desde mes empiece
                                                  || por el mes correcto y siga bien
                         |PARA j = 0; |SI; |HACIENDO j = j + 1;
                              swFiniqRaro = 0;
                              nMesesVac = nMesesVac + 1;
                              nMesVac = nMesVac + 1;   || desde mes
                              |SI nMesVac = 13;     || a ver que hacemos aqui cuando
                                   nMesVac = 1;      || cambiemos de a¤o ....
                              |FINSI;

                              nMes = nMesVac;
                              |HAZ ultimo_dia;    || PARA TODOS desde 27.08.2004
                              /*                  no se¤or, alguien nos hizo poner
                              |SI #12#42 = "M";   esto pero esto no esta bien, ha de ser
                                   topemes = 30;  siempre por dia natural aunque
                              |FINSI;             se sea mensual. Consultado a S.RED.
                              */

                              |SI #labtraba#45 = "421";
                                   || ojo, en formacion se rellena el mes de baja
                                   || con los dias de vacaciones, si no hay sufi
                                   || ciente entonces hago L13
                                   || el limite tiene que ser 30 en mensuales
                                   || por logica (pensamos nosotros)
                                   |SI #labtraba#42 ! "T"; |Y #labtraba#42 ! "D";
                                        topemes = 30;
                                   |FINSI;
                              |FINSI;

                              |SI nMesVac = #0#1;
                                   || TENGO EN CUENTA SI ES ALTA ESTE MES, QUE CUENTE A
                                   || PARTIR DEL DIA DE ALTA:

                                   aAlfa1 = #0#1;   aAlfa1 = "00" + aAlfa1; aAlfa1 = aAlfa1 % -102;
                                   aAlfa2 = #0#0;
                                   aAlfa1 = "01" + "." + aAlfa1 + "." + aAlfa2;
                                   fFecha = aAlfa1;
                                   fFechaAlta = #labtraba#36;
                                   |SI fFechaAlta > fFecha;
                                        aAlfa3 = #labtraba#36 % 102;
                                        nDias = aAlfa3;
                                        nDias = nDias - 1;
                                   |SINO;
                                        nDias = 0;
                                   |FINSI;

                                   |ABRE #20;
                                   #20#0 = #11#0;
                                   #20#1 = #11#39;      || para la fecha de baja y para
                                   #20#2 = #0#1;        ||/los dias de desempleo
                                   #20#3 = #11#48;
                                   |LEE 000#20=;
                                   |CIERRA #20;

              || en los irregulares por dias 'topemes' no son los dias a cotizar,
              ||/por eso busco la fecha de baja y la resto al utlimo dia del mes,
              ||/asi obtenemos los disponibles
              || esto seria valido para todos, pero de momento dejamos solo los "I"
              || (PRIEGO-AGO.2003)
              ||/M.Angel, cuando veas esto me preguntas ... si estoy, claro

                                   |SI #labtraba#42 ! "I"; |Y #labtraba#42 ! "P";
                                        |HAZ Dias_nat_alta;
                                        nDiasDisp = topemes - nDias_nat_alta - nDias; || dias usados
                                   |SINO;
                                        |HAZ ultimo_dia;
                                        aAlfa1 = topemes;    aAlfa1 = ("00" + aAlfa1) % -102;
                                        aAlfa2 = #0#1;       aAlfa2 = ("00" + aAlfa2) % -102;
                                        aAlfa1 = aAlfa1 + "." + aAlfa2 + "." + #0#0;
                                        fFech1 = aAlfa1;     nNume1 = fFech1;    || ultimo dia mes
                                        fFech2 = #20#5;      nNume2 = fFech2;    || fecha baja
                                        nDiasDisp = (nNume1 - nNume2) - nDias - (#11#20 ! 0) - #11#43 - #11#44 - #11#49 - #20#78; || dias usados
                                   |FINSI;
                                   nDiasRes = nDiasVac;
                                   |SI nDiasDisp < 0; nDiasDisp = 0; |FINSI; || por si acaso
                                   |SI nDiasDisp = 0;   || esto es para que si en el mes que
                                        nSumaUno = 1;    || calculamos no hay ningun dia
                                   |SINO;               || disponible la fecha del EMP sea
                                        nSumaUno = 0;    || la del mes siguiente
                                   |FINSI;
                              |SINO;
                                   nDiasDisp = topemes;
                              |FINSI;

                              |SI nMesVac = 12; |Y nDiasDisp < nDiasRes;
                                   || ATENCION: Estoy en Diciembre y no tengo mas dias
                                   || de vacaciones que dias disponibles para cotizar
                                   || tengo que generar el mes de enero de finiquito
                                   || esto se hace en el silcon10, asi que la base ya viene
                                   || proporcionada, ajusto manualmente los dias

                                   nDiasRes = nDiasDisp;
                                   swFiniqRaro = 1;
                                   swFiniqRaro2 = 1; || este para indicarle que vuelva
                                                    || a calcular un segundo lote
                              |SINO;
                                   swEsElUltimo = 0;
                              |FINSI;
                              |SI nDiasRes [ nDiasDisp; |O swFiniqRaro = 1;
                                   swEsElUltimo = 1;       || si me quedan menos dias o =
                                   |SI swFiniqRaro = 0;
                                        nDiasDisp = nDiasRes;   || por cotizar que disponibles
                                   |FINSI;
                                   |HAZ vacaciones;        || en el mes, este mes es el ultimo
                                   |SAL;
                              |SINO;
                                   swEsElUltimo = 0;
                                   nDiasRes = nDiasRes - nDiasDisp; || si no, continuo quitando
                                   || los que voy a cotizar este mes
                                   |SI #labtraba#45 = "421"; |Y j = 0;
                                        || finiquito de formacion, primer mes, no hago nada
                                        || ya que tienen que ir estos dias en la liquidacion
                                        || del mes de baja
                                   |SINO;
                                        |HAZ vacaciones;      || segmentos EMP y terminar este
                                   |FINSI;
                              |FINSI;
                         |SIGUE;
                         nume1 = #0#1 + nSumaUno;      || fecha del lote
                         nume2 = primer_mes;
                         |SI nume2 > nume1; |O nume2 = 0;
                              primer_mes = nume1;
                         |FINSI;
                         nume2 = ultimo_mes;
                         |SI nMesVac > nume2; |O nume2 = 0;
                             ultimo_mes = nMesVac;
                         |FINSI;
                    |SINO;
                         |HAZ calcula_bonif;
                         |HAZ BonifFPCont;
                         dat_mes = #0#1;
                         |HAZ datos_mes;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO cambia_fecha;
     |SI #0#17 = 2; |O #0#12 = "A"; |O #0#12 = "T";
          primer_mes = "00" + primer_mes;
          primer_mes = primer_mes % -102;
          ultimo_mes = "00" + ultimo_mes;
          ultimo_mes = ultimo_mes % -102;
          alfa3 = #0#18;
          #5#0 = #2#0;
          #5#1 = linea_EMP;
          |LEE 101#5=;
          |SI FSalida = 0;
               alfa1 = #5#4 % 150;
               alfa2 = #5#4 % -109;
               #5#4 = alfa1 + alfa3 + primer_mes + ultimo_mes + alfa2;
               |GRABA 020#5a;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO fecha_finiq;
     |SI #0#17 = 2; |O #0#12 = "A"; |O #0#12 = "T";
          |SI #0#12 = "M"; |O #0#12 = "A";
               |NOME_DAT #50 "labempax";
               |ABRE #labempax;
               #labempax#0 = #50#0;
               ||#labempax#18 = #50#18;
               #labempax#18 = #14#133;
               #labempax#1 = #50#1;
               #labempax#2 = #0#17;
               |LEE 101#labempax.=;
               |SI FSalida = 0;
                    #labempax#45 = primer_mes;    ||uso campo del abreviado
                    #labempax#59 = ultimo_mes;
                    |GRABA 020#labempax.a;
               |FINSI;
               |LIBERA #labempax;
               |CIERRA #labempax;
               |NOME_DAT #50 temp4;
          |SINO;
               |ABRE #labemphi;
               #labemphi#0 = #52#0;
               ||#labemphi#18 = #52#18;
               #labemphi#18 = #14#133;
               #labemphi#1 = #52#1;
               #labemphi#2 = #0#17;
               |LEE 101#labemphi.=;
               |SI FSalida = 0;
                    #labemphi#45 = primer_mes;    ||uso campo del abreviado
                    #labemphi#59 = ultimo_mes;
                    |GRABA 020#labemphi.a;
               |FINSI;
               |LIBERA #labemphi;
               |CIERRA #labemphi;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO regraba_nomwepig;
     |CDEFECTO #nomwepig, 1;
     |GRABA 020#nomwepig.a;
|FPRC;

|DEFBUCLE regraba_nomwepig;
     #nomwepig#1;
     ;
     #52#0, 01, nAnyo, #52#1, 000, nTipo;
     #52#0, 99, nAnyo, #52#1, 999, nTipo;
     be;
     NULL, regraba_nomwepig;
|FIN

|PROCESO regraba_nomtepig;
     |CDEFECTO #nomtepig, 1;
     |GRABA 020#nomtepig.a;
|FPRC;

|DEFBUCLE regraba_nomtepig;
     #nomtepig#1;
     ;
     #50#0, 01, #50#1, 000, nTipo;
     #50#0, 99, #50#1, 999, nTipo;
     be;
     NULL, regraba_nomtepig;
|FIN

|PROCESO regraba_labempax;
     |SI s_pas = 2;
          nTipo = 8;
     |SINO;
          nTipo = #0#17;
     |FINSI;
     |SI #0#12 = "M"; |O #0#12 = "A";
          |NOME_DAT #50 "labempax";
          |ABRE #labempax;
          #labempax#0 = #50#0;
          #labempax#18 = #14#133;
          #labempax#1 = #50#1;
          #labempax#2 = nTipo;
          |LEE 101#labempax.=;
          |SI FSalida = 0;
               |CDEFECTO #labempax,1;
               #labempax#0 = #50#0;
               #labempax#18 = #14#133;
               #labempax#1 = #50#1;
               #labempax#2 = nTipo;

               #labempax#9 = #14#32;        || prestaciones SS
               #labempax#10 = tot_cd_03;
               #labempax#15 = tot_cd_07 + tot_cd_16 + tot_cd_10 + tot_cd_11 + tot_cd_13;
               #labempax#15 = #labempax#15 + tot_cd_21 + tot_cd_22 + tot_cd_23 + tot_cd_28;

               #labempax#9 = #labempax#9 / 100;
               #labempax#9 = #labempax#9 * (-1);
               #labempax#10 = #labempax#10 / 100;
               #labempax#10 = #labempax#10 * (-1);
               #labempax#15 = #labempax#15 / 100;
               #labempax#15 = #labempax#15 * (-1);
               #labempax#13 = nro_trab;
               #labempax#45 = "4 0 0";
               |GRABA 020#labempax.a;
          |FINSI;
          |LIBERA #labempax;
          |CIERRA #labempax;
          |NOME_DAT #50 temp4;

          |NOME_DAT #51 "nomtepig";
          |BUCLE regraba_nomtepig;
          |NOME_DAT #51 temp5;
     |SINO;
          |ABRE #labemphi;
          #labemphi#0 = #52#0;
          #labemphi#18 = #14#133;
          #labemphi#1 = #52#1;
          #labemphi#2 = nTipo;
          nAnyo = #0#0 - 2000;
          #labemphi#16 = nAnyo;
          |LEE 101#labemphi.=;
          |SI FSalida = 0;
               |CDEFECTO #labemphi,1;
               #labemphi#0 = #50#0;
               #labemphi#18 = #14#133;
               #labemphi#1 = #50#1;
               #labemphi#2 = nTipo;

               #labemphi#9 = #14#32;        || prestaciones SS
               #labemphi#10 = tot_cd_03;
               #labemphi#15 = tot_cd_07 + tot_cd_16 + tot_cd_10 + tot_cd_11 + tot_cd_13;
               #labemphi#15 = #labemphi#15 + tot_cd_21 + tot_cd_22 + tot_cd_23 + tot_cd_28;

               #labemphi#9 = #labemphi#9 / 100;
               #labemphi#9 = #labemphi#9 * (-1);
               #labemphi#10 = #labemphi#10 / 100;
               #labemphi#10 = #labemphi#10 * (-1);
               #labemphi#15 = #labemphi#15 / 100;
               #labemphi#15 = #labemphi#15 * (-1);
               #labemphi#13 = nro_trab;
               #labemphi#45 = "4 0 0";
               |GRABA 020#labemphi.a;
               |GRABA 020#labemphi.a;
          |FINSI;
          |LIBERA #labemphi;
          |CIERRA #labemphi;

          |BUCLE regraba_nomwepig;
     |FINSI;
|FPRC;

|PROCESO despues;
     |SI #0#14 = "L04";
          |HAZ despues_L04;
          |ACABA;
     |FINSI;
     |HAZ tct;
     |HAZ pasaaeuros_edt;
     |HAZ edt_BA_01;
     |HAZ edt_BA_02;
     |HAZ edt_BA_06;
     |HAZ edt_BA_10;
     |HAZ edt_BA_11;
     |HAZ edt_BA_21;
     |HAZ edt_BA_22;
     |HAZ edt_BA_42;
     |HAZ edt_CD_01;
     |HAZ edt_CD_03;
     |HAZ edt_CD_06;
     |HAZ edt_CD_07;
     |HAZ edt_CD_08;
     |HAZ edt_CD_10;
     |HAZ edt_CD_11;
     |HAZ edt_CD_13;
     |HAZ edt_CD_16;
     |HAZ edt_CD_17;
     |HAZ edt_CD_21;
     |HAZ edt_CD_22;
     |HAZ edt_CD_23;
     |HAZ edt_CD_25;
     |HAZ edt_CD_28;
     |HAZ edt_CD_31;
     |HAZ edt_CD_32;
     |HAZ edt_CD_33;
     |HAZ edt_CD_34;
     |HAZ edt_CA_01;
     |HAZ edt_CA_02;
     |HAZ edt_CA_11;
     |HAZ edt_CA_13;
     |HAZ edt_CA_20;
     |HAZ edt_CA_21;
     |HAZ edt_CA_22;
     |HAZ edt_CA_30;
     |HAZ edt_CA_31;
     |HAZ edt_CA_32;
     |HAZ edt_CA_50;
     |HAZ edt_CA_57;
     |HAZ edt_CA_80;
     |HAZ edt_CA_60;
     |HAZ edt_CA_81;
     |HAZ edt_CA_90;
     |HAZ edt_TT_10;
     |HAZ edt_TT_20;
     |HAZ edt_TT_30;
     |HAZ edt_TT_91;
     |HAZ edt_TT_92;
     |HAZ dba;
     |HAZ mpg;
     |HAZ cambia_fecha;       || solo sirve para cambiar el mes desde en el EMP
                              || (para finiquitos de vacaciones)
     |HAZ fecha_finiq;        || para grabar la fecha de vacaciones para TC1 en papel
|FPRC;

|PROCESO despues_L04;
     |HAZ tct;
     |HAZ pasaaeuros_edt;
     |HAZ edt_CD_01;
     |HAZ edt_CD_03;
     |HAZ edt_CD_06;
     |HAZ edt_CD_07;
     |HAZ edt_CD_08;
     |HAZ edt_CD_10;
     |HAZ edt_CD_11;
     |HAZ edt_CD_13;
     |HAZ edt_CD_16;
     |HAZ edt_CD_17;
     |HAZ edt_CD_21;
     |HAZ edt_CD_22;
     |HAZ edt_CD_28;
     |HAZ edt_CD_31;

     |HAZ edt_CA_22;
     |HAZ edt_CA_60;

     |HAZ edt_CA_90;
     |HAZ edt_TT_10;
     |HAZ edt_TT_20;
     |HAZ edt_TT_30;
     |HAZ edt_TT_91;
     ||HAZ edt_TT_92;
     |HAZ dba;
     |HAZ regraba_labempax;
|FPRC;

|PROCESO regimen;
     |ABRE #silcon15;
     #silcon15#0 = #nomtrtc2#0;
     #silcon15#1 = #nomtrtc2#14;
     |LEE 000#silcon15.=;
     |SI FSalida = 0;
          aRegimen = #silcon15#2;
     |SINO;
          |ABRE #6;
          #6#0 = #nomtrtc2#0;
          |LEE 000#6=;
          |SI FSalida = 0;
               aRegimen = #6#2;
          |FINSI;
          |CIERRA #6;
     |FINSI;
     |CIERRA #silcon15;
|FPRC;

|PROCESO cta_cotizacion;
|SI #11#22 = 87;|O #11#22 = 97; |O #11#22 = 85; |O #11#22 = 421; |O #11#22 = 422;
                |O #11#22 = 64;|O #11#22 = 65;
    |DDEFECTO #17;
    |ABRE #17;
        #17#0 = #11#0;
        #17#13= #11#14;
    |SI #11#22 = 97; |O #11#22 = 85; |O #11#22 = 421; |O #11#22 = 422;
            #17#1 = 87;
    |SINO;
        |SI #11#22 = 65;
                #17#1 = 64;
        |SINO;
                #17#1 = #11#22;
        |FINSI;
    |FINSI;
    |LEE 000#17=;
    |CIERRA #17;
        descto = #17#2;       || descripcion centro de trabajo especial
        cta_co = #17#10;      || cta.cto. del centro de trabajo especial

        aLibre = #17#13;      || centro (para el TC2)
        aReser = #17#1;       || contrato (para el TC2)
|SINO;
        cta_co = #10#13;          || cta.cot. de la empresa
    |DDEFECTO #16;
    |ABRE #16;
        #16#0 = #11#0;
        #16#1 = #11#14;
    |LEE 000#16=;
    |CIERRA #16;
        descto = #16#2;           || descripcion centro de trabajo
    |SI #10#45 = "S";
            cta_co = #16#10;      || cta.cot. centro de trabajo
            aLibre = #16#1;
    |SINO;
            aLibre = "";
    |FINSI;
        aReser = "";
|FINSI;
    aLibre = ("00" + aLibre) % -102;
    aReser = ("00" + aReser) % -102;
|FPRC;

|PROCESO limpia_var;
    nro_trab = 0;
    tot_ba_01 = 0;
    tot_ba_02 = 0;
    tot_ba_06 = 0;
    tot_ba_21 = 0;
    tot_ba_22 = 0;
    tot_ba_42 = 0;
    tot_ba_10 = 0;
    tot_ba_11 = 0;
    tot_cd_01 = 0;
    tot_cd_02 = 0;
    tot_cd_03 = 0;
    tot_cd_06 = 0;
    tot_cd_07 = 0;
    tot_cd_08 = 0;
    tot_cd_10 = 0;
    tot_cd_11 = 0;
    tot_cd_13 = 0;
    tot_cd_16 = 0;
    tot_cd_17 = 0;
    tot_cd_21 = 0;
    tot_cd_22 = 0;
    tot_cd_23 = 0;
    tot_cd_25 = 0;
    tot_cd_28 = 0;
    tot_cd_31 = 0;
    tot_cd_32 = 0;
    tot_cd_33 = 0;
    tot_cd_34 = 0;
    tot_ca_86 = 0;
    primer_mes = "";
    ultimo_mes = "";
    nBonifFPCont = 0;
|FPRC;

|PROCESO antes;
|HAZ limpia_var;
|HAZ cta_cotizacion;
|HAZ regimen;

|HAZ inm;
|SI aAutorizacion ! ""; |Y aAutorizacion ! #6#5;
     || ya ha hecho la primera empresa
     || si la autorizacion anterior es distinta a la de la empresa actual,
     || le meto la general.En caso de dos distintas,la del control RED siempre

     #6#5 = #1#0;
     aAutorizacion = #1#0;
|SINO;
     aAutorizacion = #6#5;
|FINSI;
nPosicion = 10;
|HAZ cambia_autoriz;
|HAZ emp;
|HAZ rzs;
|HAZ exc;
|FPRC;

|PROCESO si_es_bueno;
    sw_bueno = 1;

|SI s_pas = 1;|O s_pas = 4;        || resto
    |SI #11#22=87;|O #11#22=97; |O #11#22=85; |O #11#22=421; |O #11#22=422;
                  |O #11#22=64;|O #11#22=65;
            sw_bueno=0;
    |FINSI;
|FINSI;
|SI s_pas = 2;|O s_pas = 5;        || aprendices
    |SI #11#22!87;|Y #11#22!97;|Y #11#22!85; |Y #11#22!421; |Y #11#22!422;
          sw_bueno=0;
    |FINSI;
|FINSI;
|SI s_pas = 3;|O s_pas = 6;        || tiempo parcial
    |SI #11#22!64;|Y #11#22!65;                           sw_bueno=0; |FINSI;
|FINSI;
|FPRC;

|PROCESO antesaun;                 || para Bonif Formacion Continua (CA80)
     |SI nEmpresaAnt ! #11#0;      || cuando cambio de empresa he de dejar
          swBonifFPCont = 0;       || que haga la bonif, si no se queda a uno
     |FINSI;                       || para que la haga una sola vez
     nEmpresaAnt = #11#0;
|FPRC;

|PROCESO ruptura_empresa;
|HAZ si_es_bueno;
|SI sw_bueno = 1;
    |SI ant_centro = -1;          || se utiliza de switch, no como ruptura!!!
            ant_centro = 0;
        |DDEFECTO #14;
            #14#100 = #11#0;           || empresa
            #14#133 = 99;              || centro de trabajo
        |LEE 000#14=;                                 || lee datos TC1
        |HAZ antesaun;
        |HAZ antes;
    |FINSI;
    |HAZ trabajadores;
|FINSI;
|FPRC;

|PROCESO ruptura_centros;
|HAZ si_es_bueno;
|SI sw_bueno = 1;
    |SI ant_centro ! #11#14;
        |SI ant_centro ! -1; |HAZ despues;  |FINSI;   || cierra liquidacion
            ant_centro = #11#14;
        |DDEFECTO #14;
            #14#100 = #11#0;           || empresa
            #14#133 = #11#14;          || centro de trabajo
        |LEE 000#14=;                                 || lee datos TC1
        |HAZ antesaun;                                || abre liquidacion
        |HAZ antes;                                   || abre liquidacion
    |FINSI;
    |HAZ trabajadores;
|FINSI;
|FPRC;

|DEFBUCLE por_centros;
 #11#4;
 ;
 "S",     0,  0, "       ", "           ",  0;
 "S", 99999, 99, "zzzzzzz", "zzzzzzzzzzz", 19;
 ;
 NULL, ruptura_centros;
|FIN;

|DEFBUCLE por_empresa;
 #11#5;
 ;
 "N",     0, "       ", "           ",  0;
 "N", 99999, "zzzzzzz", "zzzzzzzzzzz", 19;
 ;
 NULL, ruptura_empresa;
|FIN;

|PROCESO los_tcs;
    s_emp = #10#0;       || empresa
    s_any = #0#0;        || a¤o historico
    s_mes = #0#1;        || mes
    s_tip = #0#9;        || total/obrera/patronal (normal)
    s_tipd= #0#16;       || total/obrera/patronal (desempleo)
    s_cen = #10#45;      || centros S/N
    s_ori = #0#12;       || fichero origen (para atrasos dobles)
    s_has = #0#13;       || mes hasta (para atrasos dobles)
    s_tat = #0#17;       || tipo de atrasos (para atrasos dobles)
    s_anyl = #0#18;      || a¤o lote
    s_ele = #0#14;       || indicador lote
    s_num = #0#2;
    s_fich = #0#3;
|SUB_EJECUTA "silcon10";      || calcula TC2
|SUB_EJECUTA "silcon12";      || calcula TC2/1
|SUB_EJECUTA "silcon11";      || calcula TC1
    s_res = 0;
|ABRE #14;
|LEE 000#14p;
|SI FSalida ! 0;
||SI FSalida ! 0;  |O #14#79 = 0;
        s_res = 1;
|FINSI;
|CIERRA #14;
||SI aParam = "TC2";|Y s_res = 0;
|SI s_res = 0;
     |HAZ AuxiliaresTC1;
|FINSI;
|FPRC;

|PROCESO empresas1;
     #10#0 = #6#0;
     |LEE 000#10=;
     |SI FSalida = 0;
          |SI #10#45 ! "S";|Y #10#45 ! "N"; #10#45 = "N"; |FINSI;  || centros S/N

          |DDEFECTO #15;
          #15#0 = #10#0;
          |LEE 000#15=;
          |SI #15#2 = "*";|O aParam = "TC2";
               |PINTA 2302, "Procesando ... ";
               |PINTA 2318, #10#0;
               |PINTA 2324, #10#2;
               |DELINDEX #20;
               |HAZ carga_temporal;       || recarga del Tmp. TC2
               |PARA s_pas = 1; |SI s_pas [ 3; |HACIENDO s_pas = s_pas + 1;
                    corta = 0;
                    |SI s_pas = 1;|Y #0#15 ! "T";|Y #0#15 ! "F";|Y #0#15 ! "R"; corta = 1; |FINSI;
                    |SI s_pas = 2;|Y #0#15 ! "T";|Y #0#15 ! "F";|Y #0#15 ! "A"; corta = 1; |FINSI;
                    |SI s_pas = 3;|Y #0#15 ! "T";|Y #0#15 ! "F";|Y #0#15 ! "P"; corta = 1; |FINSI;
                    |SI corta = 0;
                         |HAZ los_tcs;
                         |SI s_res = 0;
                              ant_centro = -1;
                              nEmp_Ant = 0;
                              aNAFSS_Ant = "";
                              aSSCen2_Ant = "";
                              |ABRE #14;
                              |SI #10#45 = "N";   |BUCLE por_empresa; |FINSI;
                              |SI #10#45 = "S";   |BUCLE por_centros; |FINSI;
                              |CIERRA #14;
                              |HAZ despues;

                              |SI aParam ! "TC2";
                                   |HAZ actua_registro;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |SIGUE;
               |DELINDEX #20;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE empresas;
 #6#1;
 ;
     1;
 99999;
 ;
 NULL, empresas1;
|FIN;

|PROCESO eti;
    clave = "ETI";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        #3#0  = "TC22";
        #3#1  = "0";
        #3#2  = "VIP2";
        #3#3  = "1";
        #3#4  = #1#0;         || clave autorizacion
        #3#5  = "243     ";   || proveedor nomina + 5 blancos (reservados)
        fech1 = ~;
    |HAZ fecha;
        #3#6  = for_fecha;    || fecha
    |HAZ hora;
        #3#7  = for_hora;     || hora
        #3#8  = fichero;      || fichero
        #3#9  = extension;    || sufijo
        #3#10 = "N";          || codigo prioridad
        #3#11 = indica;       || indicador
        #3#12 = #0#18 % -102; || a¤o lote
        #3#13 = #0#1;         || mes
        #3#14 = #0#6;         || serie
        #3#15 = #0#7;         || nro. envio
        #3#16 = #0#8;         || nro. documento
        #3#17 = "";           || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO graba_lote;
     #2#1 = fichero;       || nombre salida
     #2#2 = extension;     || extension
     #2#3 = ~;             || fecha creacion
     #2#4 = ~;             || fecha grabacion
     |SI #0#21 = "S";
          #2#5 = #0#22;
          #2#6 = #0#23;
          #2#7 = "cra";
     |SINO;
          #2#5 = 0;
          #2#6 = "";
          #2#7 = "";
     |FINSI;
     |GRABA 020#2b;
|FPRC;

____________________________________/ PROCESO PRINCIPAL
|PROCESO tipo3;
     |ABRE #1;
     |ABRE #2;
     |ABRE #4;
     |ABRE #5;
     |ABRE #10;
     |ABRE #12;
     |ABRE #15;
     |ABRE #nomredco; |LEE 000#nomredco.p; |CIERRA #nomredco;

     #2#0 = #0#2;
     |LEE 000#2=;
     |SI FSalida = 0;|Y aParam ! "TC2";
          |MENAV "    Numero de Lote YA existente ...";
     |SINO;
          fichero = #0#3;
          extension = #0#4;

          alfa1 = Usuario; |QBF alfa1;
          temp1 = "1" + alfa1;  |NOME_DAT #14 temp1;     || tmp. TC1
          temp2 = "2" + alfa1;  |NOME_DAT #11 temp2;     || tmp. TC2
          temp3 = "3" + alfa1;  |NOME_DAT #20 temp3;     || tmp. calculos
          temp4 = "7" + alfa1;  |NOME_DAT #50 temp4;     || aux. empresas
          temp5 = "8" + alfa1;  |NOME_DAT #51 temp5;     || aux. epigrafes
          temp6 = "9" + alfa1;  |NOME_DAT #24 temp6;     || tc1 solo
          |DELINDEX #50;      || aux. empresas
          |DELINDEX #51;      || aux. epigrafes

          temp04 = "40" + alfa1;
          |NOME_DAT #104 temp04;     || tmp L04
          |DELINDEX #104;
          |ABRE #104;

          |SI #0#12 = "M";|O #0#12 = "A";     s_nom = "nomyytc2"; |FINSI;
          |SI #0#12 = "H";|O #0#12 = "T";     s_nom = "nomwwtc2"; |FINSI;

          |SI #0#12 = "A";|O #0#12 = "T";     esAtrasos = 1;      |FINSI;

          |SI #0#5 = "N"; indica = " ";  |FINSI;   || normal
          |SI #0#5 = "R"; indica = " ";  |FINSI;   || reenvio
          |SI #0#5 = "P"; indica = "P";  |FINSI;   || pruebas
          |SI #0#5 = "S"; indica = "N";  |FINSI;   || reenvio SIN sustitucion
          |HAZ graba_lote;
          |HAZ eti;
          |SI aParam ! "TC2";
               |BUCLE empresas;
          |SINO;
               |PARA nEmpresa = enDesEmp; |SI nEmpresa [ enHasEmp; |HACIENDO nEmpresa = nEmpresa + 1;
                    #6#0 = nEmpresa;
                    |HAZ empresas1;
               |SIGUE;
          |FINSI;
          |HAZ etf;
     |FINSI;
     |LIBERA #2;

     |CIERRA #1;
     |CIERRA #2;
     |CIERRA #4;
     |CIERRA #5;
     |CIERRA #10;
     |CIERRA #12;
     |CIERRA #15;
     |CIERRA #104;

     |DELINDEX #11;      || tmp. TC2
     |DELINDEX #14;      || tmp. TC1
     |SI swFiniqRaro2 = 0; |Y swSegundoLote = 0;           || si es finiquito raro
     |Y aAlfa ! "/u/dsprofes/"; |Y #0#21 ! "S";
          |DELINDEX #15;      || parrilla empresas        se queda con la seleccion
          |DELINDEX #23;      || parrilla trabajadores    para volver a hacer el
     |FINSI;                                              || lote
     |DELINDEX #20;      || tmp. calculos
     |DELINDEX #24;      || tc1 sin tc2
     |DELINDEX #50;      || aux. empresas
     |DELINDEX #51;      || aux. epigrafes
|FPRC;

|PROGRAMA;
     |SUB_EJECUTA "nomfich1;NOMENSA";
     aParam = eaParame;
     |QBF aParam;
     |HAZ tipo8;
     |HAZ PaseAutorizacion;
     |SI aParam ! "TC2";
          |CLS;
          |CABEZA "CREAC.LOTE TC2/TC1";
          |DDEFECTO #0;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               nElAny = #0#18;
               nElMes = #0#1;
               |HAZ ValoresITIMS;

               enDesCen = 1;
               enHasCen = 99;
               eaFuente = #0#12;
               |HAZ tipo3;

               aAlfa = #0#2; |QBF aAlfa; aAlfa = ("00000" + aAlfa) % -105;
               aAlfa = "    Se ha generado el lote fan número " + aAlfa;
               |MENAV aAlfa;

               |HAZ LoteFini;
               |SI #0#21 = "S";
                    |HAZ LanzaCRA;
                    |HAZ GrabaLotes;
               |SINO;
                    |HAZ GrabaLote;
               |FINSI;
          |FINSI;
     |SINO;
          #0#12 = eaFuente;
          #0#17 = enTipoAt;
          #0#0 = enAny;
          #0#18 = enAny;
          #0#1 = enDesMes;
          |SI #0#12 = "M";|O #0#12 = "H";
               #0#13 = #0#1;
          |SINO;
               #0#13 = enHasMes;
          |FINSI;
          #0#15 = eaTipoLi;
          #0#3  = "1";
          |NOME_DAT #2 eaTempo1;   |DELINDEX #2;       || lotes cabs.
          |NOME_DAT #5 eaTempo2;   |DELINDEX #5;       || lotes lins.
          nElAny = #0#18;
          nElMes = #0#1;
          |HAZ ValoresITIMS;
          |HAZ tipo3;
     |FINSI;
     |HAZ tipo9;
|FPRO;

|PROCESO LoteFini;
     |SI swFiniqRaro2 = 1; |O swSegundoLote = 1;
          |HAZ GrabaLote;

          swCalDos = 1;
          swSegundoLote = 0;
          swFiniqRaro2 = 1;
          linea = 0;
          nlinea = 0;
          tot_emp = 0;
          #0#0 = #0#0 + 1;
          #0#1 = 1;
          #0#13 = 1;
          #0#18 = #0#18 + 1;
          #0#2 = #0#2 + 1;
          aAlfa1 = #0#3;      |QBF aAlfa1;
          |SI #0#21 = "S";
               || si hay CRA, aumento uno porque si no se repite el mismo
               || numero de lote que el de FINIQUITO
               #0#22 = #0#22 + 1;
          |FINSI;
          #0#3 = "";
          |PINPA #0#0;
          |PINDA #0#0;
          |CUADRO 09571780
          |ATRI R;
                      ||5 6          7
                      ||8901234567890123456789
          |PINTA 1065,        "ATENCION";
          |ATRI I;
          |PINTA 1158, "Se va a generar el lo-";
          |PINTA 1258, "te FAN correspondiente";
          |PINTA 1358, " a la liquidacion por ";
          |PINTA 1458, " finiquitos en Enero. ";
          |PINTA 1558, "Por favor rellene  los";
          |PINTA 1658, "  campos solicitados  ";
          |ATRI 0;
          |AVISO;
          aAlfa2 = "";
          aAlfa2 = "    Nombre del fichero correspondiente a la liquidacion de Enero. ";
          |MENSA aAlfa2;
          |ENCAMPO #3#0;
          aAlfa2 = #0#3;      |QBF aAlfa2;
          |PARA; |SI aAlfa2 = aAlfa1; |HACIENDO;
               aAlfa3 = "    ATENCION: El nombre del fichero de la liquidacion ";
               aAlfa3 = aAlfa3 + " de Enero debe ser distinto al de la de Diciembre";
               |MENAV aAlfa3;
               |ENCAMPO #3#0;
               aAlfa2 = #0#3;      |QBF aAlfa2;
          |SIGUE;
          |ENCAMPO #4#0;
          |ENCAMPO #5#0;
          ||ENCAMPO #6#0;
          ||ENCAMPO #7#0;
          ||ENCAMPO #8#0;
          nElAny = #0#18 - 1;
          nElMes = 12;
          |HAZ ValoresITIMS;

          |HAZ tipo3;
          |SI #0#21 ! "S";    || si luego lanzo CRA necesito la seleccion
               |DELINDEX #15;      || Ahora si que borro la seleccion
               |DELINDEX #23;
          |FINSI;
     |FINSI;
|FPRC;
_________________/ TRASPASO DE nomcalca,nomcalac y nomhicca AL tsilcon1
|PROCESO ulti_dia;  || halla el ultimo dia del mes
    bisiesto = 0;
    nume1 = #0#0 $ 4;    || a¤o historico
|SI nume1 = 0;|Y #36#9 = "S";
        bisiesto = 1;
|FINSI;

    topemes = 31;
|SI #20#2= 2;
        topemes = 28 + bisiesto;
|FINSI;
|SI #20#2 = 4;|O #20#2 = 6;|O #20#2 = 9;|O #20#2 = 11;
        topemes = 30;
|FINSI;
|FPRC;

|PROCESO liquidados;
    dia_2 = topemes;     || dias que tiene el mes
    dia_3 = 30;          || dias cotizacion 'mensual'
|SI #12#42 = "D";|O #12#42 = "T";
        dia_3 = topemes; || dias cotizacion 'diario'
|FINSI;
    dia_4 = dia_3;

|SI nume1 > dia_4;  nume1 = dia_4;  |FINSI;
|SI nume1 = dia_2; |Y nume1<dia_4;  nume1 = dia_4;  |FINSI;

|| otro parche: esta vez para el caso de maternidad con enfermedad o accidente
|| estando todo el mes de baja entre una cosa y otra 21.03.2005
|SI eldat = 3;
     |SI nume1 > d_alta; |Y s_ori ! "A";  |Y s_ori ! "T"; || (no en atrasos - 14.04.2005)
          nume6 = nume1 + #11#43 + #11#44;
          |SI nume6 > dia_4;
               nume1 = dia_4 - #11#43 - #11#44;
          |FINSI;
     |FINSI;
|FINSI;
|SI #12#42 = "C";
    |SI aParam ! "TC2";
        |SI eldat ! 3;
             nume1 = #11#43 + #11#44;                    || dias IT
        |SINO;
             nume1 = #11#49;  || en maternidad (Cont.Empresariales) los dias
        |FINSI;               || que correspondan
    |SINO;
        |SI eldat ! 3;
             nume1 = #11#43 + #11#44;                    || dias IT
        |SINO;
             nume1 = #11#49;  || en maternidad (Cont.Empresariales) los dias
        |FINSI;               || que correspondan
        || nume1 = #11#43 + #11#44 + #11#49;
    |FINSI;

    ||nume1 = #11#43;
|FINSI;    || para q en citricos no topee
|FPRC;

|PROCESO maternidad;
    #12#0 = #20#0;       || estas 4 lineas estaban dentro del SI, las saco
    #12#1 = #20#1;       || porque me hace falta para los artistas
    |LEE 000#12=;
    |HAZ ulti_dia;
|SI #20#65 ! 0;
        nume1 = #20#65;
    |HAZ liquidados;
        |HAZ LeeConstante;
        bcomun = (#20#35 * nume1) % #22#7;
        bprofe = (#20#36 * nume1) % (#22#13 + #22#15 + #22#17 + #22#19);
        bcomun = bcomun ! EURODB;
        bprofe = bprofe ! EURODB;
|FINSI;
|FPRC;

|PROCESO graba_nomlicol;
     #23#1 = #nomlicol#0; || empresa
     #23#2 = #nomlicol#3; || trabajador
     |LEE 000#23=;
     |SI FSalida = 0;|Y #23#7 ! "*";    |ACABA;   |FINSI;

     |DDEFECTO #20;
     #20#0 = #nomlicol#0;  || empresa
     #20#1 = #nomlicol#3;  || trabajador
     #20#2 = #0#1;  || mes
     #20#3 = 0;      || tipo
     |LEE 101#20=;
     FEstado = FSalida;

     #labtraba#0 = #20#0;
     #labtraba#1 = #20#1;
     |LEE 000#labtraba.=;

     #20#7  = #nomlicol#5;           || dias periodo

     #20#8  = #20#8 + #nomlicol#5;   || dias alta
     #20#9  = #labtraba#45;           || tipo contrato
     #20#55 = #nomlicol#10;             || dias efectivos
     #20#89 = #nomlicol#11;             || dias IT carbon

     #20#39 = #20#39 + #nomlicol#8; || base cont.comunes
     #20#40 = #20#40 + #nomlicol#9; || base cont.profes.

     |SI FEstado ! 0;    |GRABA 020#20n;     |FINSI;
     |SI FEstado = 0;    |GRABA 020#20a;     |FINSI;
     |LIBERA #20;
|FPRC;

|DEFBUCLE lee_nomlicol;
     #nomlicol#1;
     ;
     #6#0, #0#0, #0#1,      1;
     #6#0, #0#0, #0#13, 99999;
     ;
     NULL, graba_nomlicol;
|FIN;

|PROCESO graba_nomhicac;
    #23#1 = #19#0;
    #23#2 = #19#1;
|LEE 000#23=;
|SI FSalida = 0;|Y #23#7 ! "*";    |ACABA;   |FINSI;

|DDEFECTO #20;
    #20#0 = #19#0;  || empresa
    #20#1 = #19#1;  || trabajador
    #20#2 = #0#1;   || mes
    #20#3 = 0;      || tipo
|LEE 101#20=;
    FEstado = FSalida;

    #20#4  = #19#4;           || fecha alta
    #20#5  = #19#5;           || fecha baja
    #20#6  = #19#6;           || fecha antiguedad.
    #20#7  = #19#7;           || dias periodo
    #20#8  = #20#8 + #19#8;   || dias alta
    #20#9  = #19#9;           || tipo contrato
    #20#10 = #20#10 + #19#10; || dias contrato
    #20#11 = #20#11 + #19#11; || horas contrato
    #20#12 = #19#12;          || cod.bonific.
    #20#13 = #19#13;          || (%)irpf 1
    #20#14 = #20#14 + #19#14; || base irpf 1
    #20#15 = #20#15 + #19#15; || retencion 1
    #20#16 = #20#16 + #19#16; || base irpf pagas
    #20#17 = #20#17 + #19#17; || retencion pagas
    #20#18 = #20#18 + #19#18; || base irpf exenta
    #20#19 = #19#19;          || desde dia 1
    #20#20 = #19#20;          || desde dia 2
    #20#21 = #19#21;          || desde dia 3
    #20#22 = #19#22;          || desde dia 4
    #20#23 = #19#23;          || hasta dia 1
    #20#24 = #19#24;          || hasta dia 2
    #20#25 = #19#25;          || hasta dia 3
    #20#26 = #19#26;          || hasta dia 4
    #20#27 = #19#27;          || tipo falta 1
    #20#28 = #19#28;          || tipo falta 2
    #20#29 = #19#29;          || tipo falta 3
    #20#30 = #19#30;          || tipo falta 4
    #20#31 = #20#31 + #19#31; || total dias E
    #20#32 = #20#32 + #19#32; || total dias A
    #20#33 = #20#33 + #19#33; || total dias H
    #20#34 = #20#34 + #19#34; || total dias F
    |SI FEstado ! 0;
           #20#35 = #19#35;        || prom.enferm.
           #20#36 = #19#36;        || prom.accid.
    |FINSI;
    #20#37 = #20#37 + #19#37; || remuner. total
    #20#38 = #20#38 + #19#38; || prorrata pagas
    #20#39 = #20#39 + #19#39; || base cont.comunes
    nume1 = #19#40 - #19#62;
    nBIlt = #19#62;
    ||SI nume1 < 0;           || comentado 11.05.2004, no se por que tenemos
    ||      nBIlt = #19#40;   || que igualar la base ILT a la base CP si es
    ||SINO;                   || menor que cero, esto provoca fallo en mater
    ||      nBIlt = #19#62;   || a la hora de la cotiz por epigrafes en Cont.
    ||FINSI;                  || Empresariales en mater si base IT > base alta
    #20#40 = #20#40 + #19#40; || base cont.profes.
    #20#62 = #20#62 + nBIlt;   || base ILT
    #20#41 = #20#41 + #19#41; || base horas 1
    #20#42 = #20#42 + #19#42; || base horas 2
    #20#43 = #20#43 + #19#43; || base bonif. CC 1
    #20#44 = #20#44 + #19#44; || base bonif. CP 1
    #20#45 = #20#45 + #19#45; || s.s. cgo. empresa
    #20#46 = #20#46 + #19#46; || bruto recibo
    #20#47 = #20#47 + #19#47; || bruto paga
    #20#48 = #20#48 + #19#48; || cuota cont.comunes
    #20#49 = #20#49 + #19#49; || cuota cont.profes.
    #20#50 = #20#50 + #19#50; || cuota horas 1
    #20#51 = #20#51 + #19#51; || cuota horas 2
    #20#52 = #20#52 + #19#52; || anticipos 1
    #20#53 = #20#53 + #19#53; || anticipos 2
    #20#54 = #20#54 + #19#54; || en especie
    #20#56 = #19#56;          || ~
    #20#57 = #20#57 + #19#57; || prest. enf. comun
    #20#58 = #20#58 + #19#58; || prest. accid.
    #20#59 = #20#59 + #19#59; || compl. enf. comun
    #20#60 = #20#60 + #19#60; || compl. accid.
    #20#61 = #19#61;          || (%) cont. comunes
    ||#20#62 = #20#62 + #19#62; || base ILT
    #20#63 = #20#63 + #19#63; || cuota bonif. 1
    #20#64 = #20#64 + #19#64; || subv. horas formacion
    #20#65 = #20#65 + #19#65; || total dias M

    #20#66 = #20#66 + #19#105;|| total dias vacaciones
    #20#67 = #19#106;         || (%) irpf 2
    #20#68 = #19#107;         || (%) irpf 3
    #20#69 = #20#69 + #19#108;|| base irpf 2
    #20#70 = #20#70 + #19#109;|| base irpf 3
    #20#71 = #20#71 + #19#110;|| retencion 2
    #20#72 = #20#72 + #19#111;|| retencion 3
    #20#73 = #20#73 + #19#112;|| prestacion enf. empresa
    #20#74 = #20#74 + #19#113;|| total bases
    #20#75 = #20#75 + #19#114;|| total retenciones
    #20#76 = #19#117;         || dto. pagas huelga
    #20#77 = #19#118;         || dto. pagas absentismo
    #20#78 = #20#78 + #19#119;|| total dias desempleo
    #20#79 = #20#79 + #19#121;|| base bonif. CC 2
    #20#80 = #20#80 + #19#122;|| base bonif. CP 2
    #20#81 = #20#81 + #19#123;|| cuota bonif. 2
    #20#82 = #19#124;         || (%) bonif. 1
    #20#83 = #19#125;         || (%) bonif. 2
    #20#84 = #20#84 + #19#126;|| base ILT bonif. 1
    #20#85 = #20#85 + #19#127;|| base ILT bonif. 2
                    || (hueco por si aparecen campos nuevos)
    #20#90 = #19#68;          || clave enf. (adaptado en silcon10)
    #20#91 = #19#70;          || dias enf. actual (adaptado en silcon10)
    #20#92 = #20#92 + #19#130;|| bonif > 60
    #20#99 = #20#99 + #19#148;|| bonif > 59
|HAZ maternidad;
     |HAZ RecargoMora;
|SI FEstado ! 0;    |GRABA 020#20n;     |FINSI;
|SI FEstado = 0;    |GRABA 020#20a;     |FINSI;
|LIBERA #20;
|FPRC;

|DEFBUCLE lee_nomhicac;
 #19#1;
 ;
 #6#0,     1, any_hist, #0#1,  #0#17;
 #6#0, 99999, any_hist, #0#13, #0#17;
 ;
 NULL, graba_nomhicac;
|FIN;

|PROCESO graba_nomcalac;
    #23#1 = #21#0;
    #23#2 = #21#1;
|LEE 000#23=;
|SI FSalida = 0;|Y #23#7 ! "*";    |ACABA;   |FINSI;

|DDEFECTO #20;
    #20#0 = #21#0;  || empresa
    #20#1 = #21#1;  || trabajador
    #20#2 = #0#1;  || mes
    #20#3 = 0;      || tipo
|LEE 101#20=;
    FEstado = FSalida;
    #20#4  = #21#4;           || fecha alta
    #20#5  = #21#5;           || fecha baja
    #20#6  = #21#6;           || fecha antiguedad.
    #20#7  = #21#7;           || dias periodo
    #20#8  = #20#8 + #21#8;   || dias alta
    #20#9  = #21#9;           || tipo contrato
    #20#10 = #20#10 + #21#10; || dias contrato
    #20#11 = #20#11 + #21#11; || horas contrato
    #20#12 = #21#12;          || cod.bonific.
    #20#13 = #21#13;          || (%)irpf 1
    #20#14 = #20#14 + #21#14; || base irpf 1
    #20#15 = #20#15 + #21#15; || retencion 1
    #20#16 = #20#16 + #21#16; || base irpf pagas
    #20#17 = #20#17 + #21#17; || retencion pagas
    #20#18 = #20#18 + #21#18; || base irpf exenta
    #20#19 = #21#19;          || desde dia 1
    #20#20 = #21#20;          || desde dia 2
    #20#21 = #21#21;          || desde dia 3
    #20#22 = #21#22;          || desde dia 4
    #20#23 = #21#23;          || hasta dia 1
    #20#24 = #21#24;          || hasta dia 2
    #20#25 = #21#25;          || hasta dia 3
    #20#26 = #21#26;          || hasta dia 4
    #20#27 = #21#27;          || tipo falta 1
    #20#28 = #21#28;          || tipo falta 2
    #20#29 = #21#29;          || tipo falta 3
    #20#30 = #21#30;          || tipo falta 4
    #20#31 = #20#31 + #21#31; || total dias E
    #20#32 = #20#32 + #21#32; || total dias A
    #20#33 = #20#33 + #21#33; || total dias H
    #20#34 = #20#34 + #21#34; || total dias F
    |SI FEstado ! 0;
            #20#35 = #21#35;       || prom.enferm.
            #20#36 = #21#36;       || prom.accid.
    |FINSI;
    #20#37 = #20#37 + #21#37; || remuner. total
    #20#38 = #20#38 + #21#38; || prorrata pagas
    #20#39 = #20#39 + #21#39; || base cont.comunes
    nume1 = #21#40 - #21#62;
    nBIlt = #21#62;
    #20#40 = #20#40 + #21#40; || base cont.profes.
    #20#62 = #20#62 + nBIlt;   || base ILT
    #20#41 = #20#41 + #21#41; || base horas 1
    #20#42 = #20#42 + #21#42; || base horas 2
    #20#43 = #20#43 + #21#43; || base bonif. CC 1
    #20#44 = #20#44 + #21#44; || base bonif. CP 1
    #20#45 = #20#45 + #21#45; || s.s. cgo. empresa
    #20#46 = #20#46 + #21#46; || bruto recibo
    #20#47 = #20#47 + #21#47; || bruto paga
    #20#48 = #20#48 + #21#48; || cuota cont.comunes
    #20#49 = #20#49 + #21#49; || cuota cont.profes.
    #20#50 = #20#50 + #21#50; || cuota horas 1
    #20#51 = #20#51 + #21#51; || cuota horas 2
    #20#52 = #20#52 + #21#52; || anticipos 1
    #20#53 = #20#53 + #21#53; || anticipos 2
    #20#54 = #20#54 + #21#54; || en especie
    #20#56 = #21#56;          || ~
    #20#57 = #20#57 + #21#57; || prest. enf. comun
    #20#58 = #20#58 + #21#58; || prest. accid.
    #20#59 = #20#59 + #21#59; || compl. enf. comun
    #20#60 = #20#60 + #21#60; || compl. accid.
    #20#61 = #21#61;          || (%) cont. comunes
    ||#20#62 = #20#62 + #21#62; || base ILT
    #20#63 = #20#63 + #21#63; || cuota bonif. 1
    #20#64 = #20#64 + #21#64; || subv. horas formacion
    #20#65 = #20#65 + #21#65; || total dias M
    #20#66 = #20#66 + #21#66; || total dias V
    #20#67 = #21#67;          || (%) irpf 2
    #20#68 = #21#68;          || (%) irpf 3
    #20#69 = #20#69 + #21#69; || base irpf 2
    #20#70 = #20#70 + #21#70; || base irpf 3
    #20#71 = #20#71 + #21#71; || retencion 2
    #20#72 = #20#72 + #21#72; || retencion 3
    #20#73 = #20#73 + #21#73; || prest. enf. comun empresa
    #20#74 = #20#74 + #21#74; || total bases irpf
    #20#75 = #20#75 + #21#75; || total retenciones
    #20#76 = #21#76;          || dto. pagas huelga
    #20#77 = #21#77;          || dto. pagas absentismo
    #20#78 = #20#78 + #21#78; || total dias D
    #20#79 = #20#79 + #21#79; || base bonif. CC 2
    #20#80 = #20#80 + #21#80; || base bonif. CP 2
    #20#81 = #20#81 + #21#81; || cuota bonif. 2
    #20#82 = #21#82;          || (%) bonif. 1
    |SI #20#83 < #21#83;      || esto porque si no en bonificaciones dobles
                              || da problemas al calcularla
        #20#83 = #21#83;      || (%) bonif. 2
    |FINSI;
    #20#84 = #20#84 + #21#84; || base ILT bonif. 1
    #20#85 = #20#85 + #21#85; || base ILT bonif. 2
    #20#92 = #20#92 + #21#88; || bonif. > 60
    #20#99 = #20#99 + #21#106; || bonif. > 59

|HAZ maternidad;
     |HAZ RecargoMora;
|SI FEstado ! 0;    |GRABA 020#20n;     |FINSI;
|SI FEstado = 0;    |GRABA 020#20a;     |FINSI;
|LIBERA #20;
|FPRC;

|DEFBUCLE lee_nomcalac;
 #21#1;
 ;
 #6#0,     1, #0#1,  5;
 #6#0, 99999, #0#13, 5;
 ;
 NULL, graba_nomcalac;
|FIN;

|PROCESO graba_nomhicca_2;
     |DDEFECTO #20;
     |HAZ bon_rdl012015_his;
     |PARA para1 = 0; |SI para1 [ 65; |HACIENDO para1 = para1 + 1;
          #20para1 = #19para1;
     |SIGUE;
     #20#66 = #19#105;         || total dias vacaciones
     #20#67 = #19#106;         || (%) retencion 2
     #20#68 = #19#107;         || (%) retencion 3
     #20#69 = #19#108;         || base irpf 2
     #20#70 = #19#109;         || base irpf 3
     #20#71 = #19#110;         || retencion 2
     #20#72 = #19#111;         || retencion 3
     #20#73 = #19#112;         || prestacion enf. empresa
     #20#74 = #19#113;         || total bases
     #20#75 = #19#114;         || total retenciones
     #20#76 = #19#117;         || dto. pagas huelga
     #20#77 = #19#118;         || dto. pagas absentismo
     #20#78 = #19#119;         || total dias desempleo
     #20#79 = #19#233;         || base bonif. CC 2
     #20#80 = #19#234;         || base bonif. CP 2
     #20#81 = #19#123;         || cuota bonif. 2
     #20#82 = #19#124;         || (%) bonif. 1
     #20#83 = #19#125;         || (%) bonif. 2
     #20#84 = #19#126;         || base ILT bonif. 1
     #20#85 = #19#127;         || base ILT bonif. 2
     #20#92 = #19#130;         || bonif. mayores 60 a¤os, R.D.L. 16/2001
                               || (hueco por si aparecen campos nuevos)
     #20#90 = #19#68;          || clave enf. (adaptado en silcon10)
     #20#91 = #19#70;          || dias enf. actual (adaptado en silcon10)
     #20#89 = #19#132;
     #20#94 = #19#138;         || bonif. programa fomento empleo
     #20#95 = #19#143;      || Bonif textil mayores 55 a¤os
     #20#96 = #19#144;      || Bonificacion textil programa fomento empleo
     #20#97 = #19#145;
     #20#99 = #19#148;      || Bonif mayores 59 a¤os
     #20#101 = #19#149;      || Horas subvencionadas formacion
     #20#106 = #19#167;      || BONIF.ERE.RDL 2/2009
     #20#108 = #19#171;      || Dias Riesgo
     #20#109 = #19#172;      || Base Riesgo
     #20#110 = #19#173;      || Dias Control IT SS
     #20#111 = #19#174;      || Base Control IT SS
     #20#112 = #19#175;      || Bonif fomento empleo 2
     #20#113 = #19#176;      || Bonif fomento empleo TEXTIL
     #20#114 = #19#177;      || Codigo Bonif fomento empleo 1
     #20#115 = #19#178;      || Codigo Bonif fomento empleo 2
     #20#116 = #19#179;      || Codigo Bonif fomento empleo TEXTIL 1
     #20#117 = #19#180;      || Codigo Bonif fomento empleo TEXTIL 2
     #20#118 = #19#181;      || Dias Paternidad
     #20#119 = #19#159;      || Base Maternidad
     #20#120 = #19#185 + #19#186;      || bonificacion formacion
     #20#121 = #19#206 + #19#207;      || cuota solidaridad
     #20#122 = #19#212;      || bonif sist. garantia juvenil
     #20#159 = #19#213;
     #20#160 = #19#214;
     #20#161 = #19#223;
     #20#162 = #19#224; #20#163 = #19#225;   || tutorias
     |HAZ maternidad;
     |SI #labtraba#247 = 112;
          |HAZ artistas;
     |FINSI;
     |SI #labtraba#45 = "421";
          nDiasExtra = 0;
          nBaseExtra = 0;
          |SALVA_FICHA #nomhicca;
          |HAZ FiniqFormacionHis;
          |SI nBaseExtra > 0;
               #20#8 = #20#8 + nDiasExtra;
               #20#39 = #20#39 + nBaseExtra;
               #20#40 = #20#40 + nBaseExtra;
          |FINSI;
          |REPON_FICHA #nomhicca;
     |FINSI;
     |HAZ RecargoMora;
     |GRABA 020#20n;
|FPRC;

|PROCESO graba_nomhicca;
     #23#1 = #19#0;
     #23#2 = #19#1;
     |LEE 000#23=;
     |SI FSalida = 0;|Y #23#7 ! "*";    |ACABA;   |FINSI;

     |HAZ graba_nomhicca_2;
     |SI #nomhicca#27 = "X";            || Marcado como ficha de finiquito
       |Y #nomhicca#28 = "X";           || en enero, generado por una liquidacion
       |Y #nomhicca#29 = "X";           || correspondiente a Diciembre
       |Y #nomhicca#30 = "X";
          |BORRA 020#nomhicca.a;
     |FINSI;
|FPRC;

|DEFBUCLE lee_nomhicca;
 #19#1;
 ;
 #6#0,     1, any_hist, #0#1, tipo_bot;
 #6#0, 99999, any_hist, #0#1, tipo_top;
 ;
 NULL, graba_nomhicca;
|FIN;

|PROCESO artistas;
     |PARA para1 = 27; |SI para1 [ 30; |HACIENDO para1 = para1 + 1;
          |SI #20para1 = "E";
               #20para1 = "M";
               desde = para1 - 8;
               hasta = para1 - 4;
               |SI #20desde = 0;
                    #20desde = 1;
               |FINSI;
               |SI #20hasta = 0;
                    #20hasta = topemes;
               |FINSI;
               nume1 = #20hasta - #20desde + 1;
               #20#65 = #20#65 + nume1;
               #20#31 = #20#31 - nume1;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO graba_nomcalca_2;
     |DDEFECTO #20;
     |HAZ bon_rdl012015_men;
     |PARA para1 = 0; |SI para1 [ 88; |HACIENDO para1 = para1 + 1;
             #20para1 = #18para1;
     |SIGUE;
     #20#79 = #18#191;
     #20#80 = #18#192;

     #20#92 = #18#88;      || Bonif R.D.L. 16/2001 mayores 60 a¤os
     #20#94 = #18#96;      || Bonificacion programa fomento empleo
     #20#89 = #18#90;
     #20#95 = #18#101;      || Bonif textil mayores 55 a¤os
     #20#96 = #18#102;      || Bonificacion textil programa fomento empleo
     #20#97 = #18#103;
     #20#99 = #18#106;      || Bonif mayores 59 a¤os
     #20#101 = #18#107;      || Horas subvencionadas formacion
     #20#106 = #18#125;      || BONIF.ERE.RDL 2/2009
     #20#108 = #18#129;      || DIAS RIESGO
     #20#109 = #18#130;      || BASE RIESGO
     #20#110 = #18#131;      || DIAS Control IT SS
     #20#111 = #18#132;      || BASE Control IT SS
     #20#112 = #18#133;      || Bonif fomento empleo 2
     #20#113 = #18#134;      || Bonif fomento empleo TEXTIL
     #20#114 = #18#135;      || Codigo Bonif fomento empleo 1
     #20#115 = #18#136;      || Codigo Bonif fomento empleo 2
     #20#116 = #18#137;      || Codigo Bonif fomento empleo TEXTIL 1
     #20#117 = #18#138;      || Codigo Bonif fomento empleo TEXTIL 2
     #20#118 = #18#139;      || Dias Paternidad
     #20#119 = #18#117;      || Base Maternidad
     #20#120 = #18#143 + #18#144;      || bonificacion formacion
     #20#121 = #18#164 + #18#165;      || cuota solidaridad
     #20#122 = #18#170;      || bonif sist. garantia juvenil
     #20#159 = #18#171;
     #20#160 = #18#172;
     #20#161 = #18#181;
     #20#162 = #18#182; #20#163 = #18#183;   || tutorias
     |HAZ maternidad;
     |SI #labtraba#247 = 112;
          |HAZ artistas;
     |FINSI;
     |HAZ RecargoMora;
     |SI #labtraba#45 = "421";
          nDiasExtra = 0;
          nBaseExtra = 0;
          |SALVA_FICHA #nomcalca;
          |HAZ FiniqFormacionMen;
          |SI nBaseExtra > 0;
               #20#8 = #20#8 + nDiasExtra;
               #20#39 = #20#39 + nBaseExtra;
               #20#40 = #20#40 + nBaseExtra;
          |FINSI;
          |REPON_FICHA #nomcalca;
     |FINSI;
     |GRABA 020#20n;
|FPRC;

|PROCESO graba_nomcalca;
     #23#1 = #18#0;
     #23#2 = #18#1;
     |LEE 000#23=;
     |SI FSalida = 0;|Y #23#7 ! "*";    |ACABA;   |FINSI;
     |HAZ graba_nomcalca_2;
     |SI #nomcalca#27 = "X";            || Marcado como ficha de finiquito
       |Y #nomcalca#28 = "X";           || en enero, generado por una liquidacion
       |Y #nomcalca#29 = "X";           || correspondiente a Diciembre
       |Y #nomcalca#30 = "X";
          |BORRA 020#nomcalca.a;
     |FINSI;
|FPRC;

|DEFBUCLE lee_nomcalca;
 #18#1;
 ;
 #6#0,     1, #0#1, tipo_bot;
 #6#0, 99999, #0#1, tipo_top;
 ;
 NULL, graba_nomcalca;
|FIN;

|PROCESO control;
|DDEFECTO #36;
|ABRE #36;
|LEE 000#36p;
|SI FSalida ! 0;
    |MENAV "    No existe control, usando defectos ...";
|FINSI;
|CIERRA #36;
|FPRC;

|PROCESO carga_temporal;
|HAZ control;
|ABRE #20;
|ABRE #22;
|ABRE #23;
|SELECT #2#23;
|DDEFECTO #22;
    #22#0 = #10#32;
|LEE 000#22=;                 || lee la constante (para las maternidades)
    any_hist = #0#0 $ 100;    || a¤o historico
|SI aParam ! "TC2";
    tipo_bot = #0#17;         || limites de tipo para el bucle
    tipo_top = #0#17;         || si es el RED, lo que vengan del DEF
|SINO;
    |SI eaTipoLi = "F";
        tipo_bot = 2;             || si es el TC2 impreso,
        tipo_top = 2;             || y estamos haciendo finiquitos
        #0#14 = "L13";
        #0#17 = 2;
    |SINO;
        tipo_bot = 0;             || si es el TC2 impreso, todos
        tipo_top = 0;
    |FINSI;
|FINSI;
|SI #0#12 = "M";    |BUCLE lee_nomcalca;     |FINSI;
|SI #0#12 = "H";    |BUCLE lee_nomhicca;     |FINSI;
|SI #0#12 = "A";    |BUCLE lee_nomcalac;     |FINSI;
|SI #0#12 = "T";    |BUCLE lee_nomhicac;     |FINSI;
|SI #0#12 = "C";    |BUCLE lee_nomlicol;     |FINSI;
|CIERRA #20;
|CIERRA #22;
|CIERRA #23;
|FPRC;

_________________/ TRASPASO DE AUXILIARES DEL TC1 SI ESTAMOS IMPRIMIENDO TC2
|PROCESO nomwepig_1;
     |PARA para1 = 0; |SI para1 [ 24; |HACIENDO para1 = para1 + 1;
          |SI para1 ! 11;
               #53para1 = #51para1;
          |SINO;
               #53#11 = any_hist;
          |FINSI;
     |SIGUE;
     |SI eaFuente = "T";
          |SI #53#9 = 0; #53#9 = 5;     |FINSI;
          |SI #53#9 = 8; #53#9 = 6;     |FINSI;
          |SI #53#9 = 9; #53#9 = 7;     |FINSI;
          |SI #53#9 = 10; #53#9 = 15;   |FINSI;
          |SI #53#9 = 18; #53#9 = 16;   |FINSI;
          |SI #53#9 = 19; #53#9 = 17;   |FINSI;
     |FINSI;
     |SI #0#17 = 2;|Y #53#9 = 0;
          #53#9 = 2;
     |FINSI;
     |BORRA 000#53c;
     |GRABA 020#53n;
|FPRC;

|PROCESO tempo7_1;
     |SI s_pas = 1;|O s_pas = 4;        || resto
          |SI #51#9 = 0;|O #51#9 = 10;  |HAZ nomwepig_1;    |FINSI;
     |FINSI;
     |SI s_pas = 2;|O s_pas = 5;        || aprendices
          |SI #51#9 = 8;|O #51#9 = 18;  |HAZ nomwepig_1;    |FINSI;
     |FINSI;
     |SI s_pas = 3;|O s_pas = 6;        || tiempo parcial
          |SI #51#9 = 9;|O #51#9 = 19;  |HAZ nomwepig_1;    |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE tempo7;
 #51#1;
 ;
 #10#0, 01, 01,   0,  0;
 #10#0, 99, 12, 999, 99;
 ;
 NULL, tempo7_1;
|FIN;

|PROCESO nomwepig;
     |ABRE #53;
     |BUCLE tempo7;
     |CIERRA #53;
|FPRC;

|PROCESO labemphi_1;
     |PARA para1 = 0; |SI para1 [ 98; |HACIENDO para1 = para1 + 1;
          |SI para1 ! 16;|Y para1 ! 19;
               #52para1 = #50para1;
          |SINO;
               |SI para1 = 16;
                    #52#16 = any_hist;
               |FINSI;
               |SI para1 = 19;
                    #52#19 = #50#16;
               |FINSI;
          |FINSI;
     |SIGUE;
     |SI eaFuente = "T";
          |SI #52#2 = 0; #52#2 = 5;     |FINSI;
          |SI #52#2 = 8; #52#2 = 6;     |FINSI;
          |SI #52#2 = 9; #52#2 = 7;     |FINSI;
          |SI #52#2 = 10; #52#2 = 15;   |FINSI;
          |SI #52#2 = 18; #52#2 = 16;   |FINSI;
          |SI #52#2 = 19; #52#2 = 17;   |FINSI;
     |FINSI;
     ||SI aParam ! "TC2";|Y #0#17 = 2;|Y #52#2 = 0;
     |SI #0#17 = 2;|Y #52#2 = 0;
          #52#2 = 2;
     |FINSI;
     |BORRA 000#52c;
     |GRABA 020#52n;
|FPRC;

|PROCESO tempo4_1;
     |SI s_pas = 1;|O s_pas = 4;        || resto
          |SI #50#2 = 0;|O #50#2 = 3;|O #50#2 = 10;  |HAZ labemphi_1;    |FINSI;
     |FINSI;
     |SI s_pas = 2;|O s_pas = 5;        || aprendices
          |SI #50#2 = 8;|O #50#2 = 18;  |HAZ labemphi_1;    |FINSI;
     |FINSI;
     |SI s_pas = 3;|O s_pas = 6;        || tiempo parcial
          |SI #50#2 = 9;|O #50#2 = 19;  |HAZ labemphi_1;    |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE tempo4;
 #50#1;
 ;
 #10#0, 01, 01,  0;
 #10#0, 99, 12, 99;
 ;
 NULL, tempo4_1;
|FIN;

|PROCESO labemphi;
     |ABRE #52;
     |BUCLE tempo4;
     |CIERRA #52;
|FPRC;

|PROCESO nomtepig_1;
     |SI eaFuente = "A";
          |SI #51#9 = 0; #51#9 = 5;     |FINSI;
          |SI #51#9 = 8; #51#9 = 6;     |FINSI;
          |SI #51#9 = 9; #51#9 = 7;     |FINSI;
          |SI #51#9 = 10; #51#9 = 15;   |FINSI;
          |SI #51#9 = 18; #51#9 = 16;   |FINSI;
          |SI #51#9 = 19; #51#9 = 17;   |FINSI;
     |FINSI;
     |SI #0#17 = 2;|Y #51#9 = 0;
          #51#9 = 2;
     |FINSI;

     |NOME_DAT #51 "nomtepig";
     |ABRE #51;
     |BORRA 000#51c;
     |GRABA 020#51n;
     |CIERRA #51;

     |SI eaFuente = "A";
          |SI #51#9 = 5; #51#9 = 0;     |FINSI;
          |SI #51#9 = 6; #51#9 = 8;     |FINSI;
          |SI #51#9 = 7; #51#9 = 9;     |FINSI;   || repone para continuar
          |SI #51#9 = 15; #51#9 = 10;   |FINSI;   ||/con el bucle
          |SI #51#9 = 16; #51#9 = 18;   |FINSI;
          |SI #51#9 = 17; #51#9 = 19;   |FINSI;
     |FINSI;
     ||SI aParam ! "TC2";|Y #0#17 = 2;|Y #51#9 = 2;
     |SI #0#17 = 2;|Y #51#9 = 2;
          #51#9 = 0;
     |FINSI;
|FPRC;

|PROCESO nomtepig;
     |PARA; |SI; |HACIENDO;
          |NOME_DAT #51 temp5;
          |ABRE #51;
          |SI nSwPrimera = 0;
               nSwPrimera = 1;
               |DDEFECTO #51;
               #51#0 = #10#0;
               ||LEE 020#51];
               |LEE 000#51];
               |SI FSalida ! 0;|O #51#0 ! #10#0;
                    |CIERRA #51;
                    |SAL;
               |FINSI;
          |SINO;
               |LEE 000#51=;
               |LEE 000#51s;
               |SI FSalida ! 0;|O #51#0 ! #10#0;
                    |CIERRA #51;
                    |SAL;
               |FINSI;
          |FINSI;
          |CIERRA #51;

          |SI s_pas = 1;|O s_pas = 4;        || resto
               |SI #51#9 = 0;|O #51#9 = 10;  |HAZ nomtepig_1;    |FINSI;
          |FINSI;
          |SI s_pas = 2;|O s_pas = 5;        || aprendices
               |SI #51#9 = 8;|O #51#9 = 18;  |HAZ nomtepig_1;    |FINSI;
          |FINSI;
          |SI s_pas = 3;|O s_pas = 6;        || tiempo parcial
               |SI #51#9 = 9;|O #51#9 = 19;  |HAZ nomtepig_1;    |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO labempax_1;
     |SI eaFuente = "A";
          |SI #50#2 = 0; #50#2 = 5;     |FINSI;
          |SI #50#2 = 8; #50#2 = 6;     |FINSI;
          |SI #50#2 = 9; #50#2 = 7;     |FINSI;
          |SI #50#2 = 10; #50#2 = 15;   |FINSI;
          |SI #50#2 = 18; #50#2 = 16;   |FINSI;
          |SI #50#2 = 19; #50#2 = 17;   |FINSI;
     |FINSI;
     |SI #0#17 = 2;|Y #50#2 = 0;
          #50#2 = 2;
     |FINSI;
     |NOME_DAT #50 "labempax";
     |ABRE #50;
     |BORRA 000#50c;
     |GRABA 020#50n;
     |CIERRA #50;

     |SI eaFuente = "A";
          |SI #50#2 = 5; #50#2 = 0;     |FINSI;
          |SI #50#2 = 6; #50#2 = 8;     |FINSI;
          |SI #50#2 = 7; #50#2 = 9;     |FINSI;   || repone para continuar
          |SI #50#2 = 15; #50#2 = 10;   |FINSI;   ||/con el bucle
          |SI #50#2 = 16; #50#2 = 18;   |FINSI;
          |SI #50#2 = 17; #50#2 = 19;   |FINSI;
     |FINSI;
     ||SI aParam ! "TC2";|Y #0#17 = 2;|Y #50#2 = 2;
     |SI #0#17 = 2;|Y #50#2 = 2;
          #50#2 = 0;
     |FINSI;
|FPRC;

|PROCESO labempax;
     |PARA; |SI; |HACIENDO;
          |NOME_DAT #50 temp4;
          |ABRE #50;
          |SI nSwPrimera = 0;
               nSwPrimera = 1;
               |DDEFECTO #50;
               #50#0 = #10#0;
               ||LEE 020#50];
               |LEE 000#50];
               |SI FSalida ! 0;|O #50#0 ! #10#0;
                    |CIERRA #50;
                    |SAL;
               |FINSI;
          |SINO;
               |LEE 000#50=;
               |LEE 000#50s;
               |SI FSalida ! 0;|O #50#0 ! #10#0;
                    |CIERRA #50;
                    |SAL;
               |FINSI;
          |FINSI;
          |CIERRA #50;
          |SI s_pas = 1;|O s_pas = 4;        || resto
               |SI #50#2 = 0;|O #50#2 = 10;  |HAZ labempax_1;    |FINSI;
          |FINSI;
          |SI s_pas = 2;|O s_pas = 5;        || aprendices
               |SI #50#2 = 8;|O #50#2 = 18;  |HAZ labempax_1;    |FINSI;
          |FINSI;
          |SI s_pas = 3;|O s_pas = 6;        || tiempo parcial
               |SI #50#2 = 9;|O #50#2 = 19;  |HAZ labempax_1;    |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;
|PROCESO AuxiliaresTC1;
     |SI eaFuente = "M";|O eaFuente = "A";
          nSwPrimera = 0;     |HAZ labempax;
          nSwPrimera = 0;     |HAZ nomtepig;
     |FINSI;
     |SI eaFuente = "H";|O eaFuente = "T";|O eaFuente = "C";
          |HAZ labemphi;
          |HAZ nomwepig;
     |FINSI;
|FPRC;
