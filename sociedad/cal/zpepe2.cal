|FICHEROS;
     :agicli/agim0019;
     :agicli/agifigen;       || Bancos

     maempr01;
     maempr11;

     isocie00;
     isom9000;
     isow9001;                    || Registro emision 2010
     isow9006;                    || Registro emision 2013 H1
     isow9007;                    || Registro emision 2013 H2
     isow9008;                    || Registro emision 2014 H1
     isow9009;                    || Registro emision 2014 H2
|FIN;

|VARIABLES;
     aCasilla       = "";
     aAlfa          = "";
     aAlfa0         = "";
     aAlfa1         = "";
     aAlfa2         = "";
     aBase          = "";
     aDirServidor   = "";
     aDirInternet   = "";
     aDirLanza      = "";
     aDirBase       = "";
     aPathPlugins   = "";
     aDelindex      = "";
     aFichero       = "";
     aFicheroP      = "";
     aFicheroE      = "";
     aAbre          = "";
     aOrigen        = "";
     aDestino       = "";
     aContenido     = "";
     aCNAE          = "";
     aDia           = "";
     aMes           = "";
     aEjerc         = "";
     aPais          = "";
     aCodPais       = "";
     aLong          = "";
     aTecla         = "";
     aRetu          = "";
     aEsc1          = "";
     aEsc2          = "";
     aTipo          = "";
     aDocRemoto     = "";
     aDocServidor   = "";
     aIPRemoto      = "";

     nFicha         = 0;
     nLong          = 0;
     nNume          = 0;
     nPos           = 0;
     nValor         = 0;
     nValor1        = 0;
     nValor2        = 0;
     nValor3        = 0;
     nValor4        = 0;
     nValor5        = 0;
     nExiste        = 0;
     nSuma          = 0;
     nVent          = 0;
     nVent202       = 0;
     nPanta         = 0;
     nCasilla       = 0;
     nFecha         = 0;
     nCampo         = 0;
     nSwPunto       = 0;
     nCaracter      = 0;
     nContaBucle    = 0;
     nContaBucleL   = 0;
     nComple        = 0;
     nPuntero       = 0;
     nDesde         = 0;
     nHasta         = 0;
     nHay           = 0;
     nTotal         = 0;
     nValor626      = 0;
     nValor627      = 0;
     nValor628      = 0;
     nValor629      = 0;
     nCanti1        = 0;
     nCanti2        = 0;
     nCanti3        = 0;
     nCanti4        = 0;
     nCantiT        = 0;
     nResto         = 0;
     nTecla         = 0;
     nBotonCont     = 0;
     nBotonSal      = 0;
     nRango         = 0;
     nGrid509       = 0;
     nBoton1        = 0;
     nBoton2        = 0;
     nBoton3        = 0;
     nHandle        = 0;
     nAnyoI         = 0;

     fFechaD        = @;
     fFechaH        = @;


     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     {10}aPopup       = "";

      {1}aContiene    = "";

     &enEmpresa       = 0;
     &enAnyo          = 0;
     &enNavieras      = 0;
     &enCooperativa   = 0;
     &enTranspa       = 0;
     &enZEC           = 0;
     &enPeqDimen      = 0;
     &enForales       = 0;
     &enError         = 0;
     &enAviso         = 0;
     &eaError         = "";
     &eaAlfa          = "";
     &enHandle        = 0;
     &enCanti         = 0;
     &eaPagina        = "";
     &enCodCli        = 0;
     &enSwDeDonde     = 0;
     &eaEfectivo      = "";
     &eaAdeudo        = "";
     &eaEntidad       = "";
     &eaOficina       = "";
     &eaDC             = "";
     &eaCuenta         = "";
     &enModelo         = 0;
     &enBanco          = 0;
     &enFormaPag       = 0;
     &enForzar         = 0;
     &eaPathExplorador = "";
     &eaForzExplorador = "";
     &eaImpre          = "";
     &eaJusti          = "";
     &eaFinLinea       = "";
     &eaUnidadBasico   = "";
     &enGrid           = 0;
     &enEjercicio      = 0;
     &enErrorPortal    = 0;
|FIN;

|PROCESO PonVentana;
     |VENTANA 0501, 0540, -1, 16, "Procesando emisi¢n modelo 202";
     nVent202 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent202;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;
|FPRC;

|PROCESO QuitaVentana;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent202;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent202;
|FPRC;

|PROCESO CopiaFichero;
     aAlfa = "";
     |IP_REMOTO aAlfa;  |QBT aAlfa;
     |SI aAlfa ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
|FPRC;

|PROCESO GrabaPortal;
     eaAlfa = eaAlfa + &13 + &10;
     |XGRABA enHandle, eaAlfa;
|FPRC;

|PROCESO GrabaPortalSin;
     |XGRABA enHandle, eaAlfa;
|FPRC;

|PROCESO PortalBorrador;       || 8.1.1.1
     aAbre = aDirServidor + aFicheroP;
     |XABRE "WB", aAbre, enHandle;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + "https://www2.agenciatributaria.gob.es/l/zi22zilk0022" + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + "IE1202VA" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + "ES" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "LEV" + &34 + " value=" + &34 + "000000000000" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIC" + &34 + " value=" + &34;
     |HAZ GrabaPortalSin;
     |XCIERRA enHandle;

     aDestino   = aDirServidor + aFicheroP;
     aOrigen    = aDirServidor + aFichero;

     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre = aDirServidor + aFicheroP;
     |XABRE "AB", aAbre, enHandle;

     eaAlfa = &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "RUT" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + #isom9000#1 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + "202" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandle;

     aOrigen  = aDirServidor + aFicheroP;
     aDestino = aDirLanza + aFicheroP;
     |HAZ CopiaFichero;

     eaForzExplorador = "N";
     enEjercicio      = #isom9000#1;
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + aDestino;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aDestino + &34;
     |FINSI;

     |RSYSTEM aAlfa;

     aAlfa = eaPathExplorador > "";
     aAlfa = aAlfa - "CHROME.EXE";
     |SI FSalida ! 0;  |SLEEP 30;  |FINSI;

     aAlfa = aDirServidor + aFicheroP;   |FBORRA aAlfa;
     aAlfa = aDirLanza + aFicheroP;      |RFBORRA aAlfa;
|FPRC;

|PROCESO TraeWait;
     |DBASE aAlfa;  |QBT aAlfa;
     aAlfa    = aAlfa + "planilla";
     aOrigen  = aAlfa + "/wait.exe";
     aDestino = aDirLanza + "wait.exe";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO MandaAInternet;
     |CONFI "0000NDesea presentar en estos momentos la declaracion";
     |SI FSalida = 0;
         aOrigen  = aDirServidor + aFichero;
         aDestino = aDirLanza + aFichero;
         |HAZ CopiaFichero;

         |HAZ TraeWait;

         eaForzExplorador = "N";
         enEjercicio      = #isom9000#1;
         |HAZ Explorador;

         aAbre = aDirLanza + "imp" + Usuario + ".bat";
         |XABRE "WBC", aAbre, nHandle;

         eaAlfa = aDirLanza + "wait ";
         |HAZ GrabaPortalSin;

         eaAlfa = eaPathExplorador + " " + &34 + "https://www2.agenciatributaria.gob.es/es13/h/servurls.html";
         |HAZ GrabaPortalSin;

         eaAlfa = "?WEB=INTERNET&PRG=202&EJE=0000&URL=PIR&EXT=?FIC=";
         |HAZ GrabaPortalSin;

         eaAlfa = aDirLanza + aFichero + &34 + &13 + &10;
         |HAZ GrabaPortal;

         |XCIERRA nHandle;

         |RSYSTEM aAbre;

         aAlfa = eaPathExplorador > "";
         aAlfa = aAlfa - "CHROME.EXE";
         |SI FSalida ! 0;  |SLEEP 30;  |FINSI;

         aAlfa = aDirLanza + aFichero;
         |RFBORRA aAlfa;
         |RFBORRA aAbre;
     |SINO;
         aOrigen  = aDirServidor + aFichero;
         aDestino = aDirInternet + aFichero;
         |HAZ CopiaFichero;

         aAlfa = "0000El fichero generado est  en " + aDestino + " para su presentaci¢n.";
         |MENAV aAlfa;
     |FINSI;

     eaImpre = "S";
     eaJusti = "";
|FPRC;

|PROCESO Portal;
     |HAZ PonVentana;

     |SI aTipo = "BORRADOR";
         |HAZ PortalBorrador;
         |HAZ QuitaVentana;
         |ACABA;
     |FINSI;

     aAlfa = aDirInternet + aFichero;   |RFBORRA aAlfa;

     |HAZ MandaAInternet;

     |HAZ QuitaVentana;
|FPRC;

|PROCESO AbreSecuencial;
     |HAZ LeeUnidadBasico;

     |DBASE aBase;  |QBF aBase;
     aDirServidor = aBase + "tmp";   |MKDIR aDirServidor;
     aDirServidor = aBase + "tmp/";

     aDirLanza    = eaUnidadBasico + "\AEAT";                                        |RMKDIR aDirLanza;
     aDirLanza    = eaUnidadBasico + "\AEAT\202";                                    |RMKDIR aDirLanza;
     aDirLanza    = eaUnidadBasico + "\AEAT\202\" + #isom9000#1;                          |RMKDIR aDirLanza;
     aDirLanza    = eaUnidadBasico + "\AEAT\202\" + #isom9000#1 + "\" + #isom9000#2;           |RMKDIR aDirLanza;
     aDirLanza    = eaUnidadBasico + "\AEAT\202\" + #isom9000#1 + "\" + #isom9000#2 + "\";

     aDirBase     = eaUnidadBasico + "\AEAT\202\";

     aDirInternet = eaUnidadBasico + "/AEAT";                                        |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET";                               |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET/202";                           |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET/202/" + #isom9000#1;                 |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET/202/" + #isom9000#1 + "/" + #isom9000#2;  |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET/202/" + #isom9000#1 + "/" + #isom9000#2 + "/";

     aFichero    = "202" + (("00000" + #isom9000#0) % -105) + (("00" + #isom9000#3) % -102) + ".txt";
     aFicheroP   = "portal202.html";

     aAbre       = aDirServidor + aFichero;
     |XABRE "BW", aAbre, enHandle;
|FPRC;

|PROCESO CierraSecuencial;
     |XCIERRA enHandle;

     |HAZ Portal;

     |SI aTipo = "BORRADOR";
         aAbre = aDirServidor + aFichero;   |FBORRA aAbre;
         |ACABA;
     |FINSI;

     aAlfa = aDirServidor + aFichero;   |FBORRA aAlfa;
|FPRC;

|PROCESO FormaPago;
     #isow9001#36 = #isom9000#36;
     |SI #isow9001#36 = "4";  #isow9001#36 = "2";  |FINSI;

     |SI #isow9001#36 = "2";  |O #isow9001#36 = "3";
         |SI #isom9000#37 = "1";
             |ABRE #isocie00;
             |PARA nAnyoI = #isom9000#1 - 1;  |SI;  |HACIENDO nAnyoI = nAnyoI - 1;
                   |SI nAnyoI [ 1980;  |SAL;  |FINSI;

                   #isocie00#0 = #isom9000#0;
                   #isocie00#1 = nAnyoI;
                   |LEE 000#isocie00.=;
                   |SI FSalida = 0;
                       |SI #isocie00#5 ! "0000000000";  |Y #isocie00#5 ! "          ";
                           #isow9001#37 = #isocie00#2;
                           #isow9001#38 = #isocie00#3;
                           #isow9001#39 = #isocie00#4;
                           #isow9001#40 = #isocie00#5;
                       |FINSI;
                       |SAL;
                   |FINSI;
             |SIGUE;
             |CIERRA #isocie00;
         |FINSI;

         |SI #isom9000#37 = "2";  |O #isow9001#37 = "0000";  |O #isow9001#37 = "    ";
             |ABRE #agifigen;
             #agifigen#0 = #isom9000#0;
             |LEE 040#agifigen.=;
             |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;
             |CIERRA #agifigen;

             |SI #agifigen#84 ! "                    ";
                 #isow9001#37 = #agifigen#81;
                 #isow9001#38 = #agifigen#82;
                 #isow9001#39 = #agifigen#83;
                 #isow9001#40 = #agifigen#84 % 110;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #isow9001#37 = "    ";        #isow9001#37 = "0000";        |FINSI;
     |SI #isow9001#38 = "    ";        #isow9001#38 = "0000";        |FINSI;
     |SI #isow9001#39 = "  ";          #isow9001#39 = "00";          |FINSI;
     |SI #isow9001#40 = "          ";  #isow9001#40 = "0000000000";  |FINSI;


                          #isow9001#6 = "I";
     |SI #isom9000#36 = "3";   #isow9001#6 = "U";  |FINSI;
     |SI #isom9000#36 = "4";   #isow9001#6 = "G";  |FINSI;
|FPRC;

|PROCESO CargaSecu2010;
     |ABRE #agim0019;
     #agim0019#0 = #isom9000#0;
     #agim0019#1 = 99;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
         |LEE 000#agim0019.a;
     |SINO;
         |LEE 000#agim0019.u;
     |FINSI;

     nFicha = 0;
     |SI FSalida ! 0;  |O #agim0019#0 ! #isom9000#0;
         |DDEFECTO #agim0019;
     |FINSI;
     |CIERRA #agim0019;

     |DDEFECTO #isow9001;

     |SI #agim0019#89 = "S";  #isow9001#12 = "X";  |FINSI;

     #isow9001#7  = #isom9000#4;
     #isow9001#8  = #isom9000#5;
     #isow9001#9  = #isom9000#1;
     #isow9001#10 = #isom9000#2;
     #isow9001#11 = (#isom9000#7 % 102) + (#isom9000#7 % 402) + (#isom9000#7 % 704);

     enCanti = #isom9000#10;  |HAZ Calcula17D;  #isow9001#13 = eaAlfa;
     enCanti = #isom9000#13;  |HAZ Calcula17D;  #isow9001#14 = eaAlfa;
     enCanti = #isom9000#14;  |HAZ Calcula17D;  #isow9001#15 = eaAlfa;
     enCanti = #isom9000#15;  |HAZ Calcula17D;  #isow9001#16 = eaAlfa;
     enCanti = #isom9000#16;  |HAZ Calcula17D;  #isow9001#17 = eaAlfa;
     enCanti = #isom9000#17;  |HAZ Calcula17D;  #isow9001#18 = eaAlfa;
     enCanti = #isom9000#18;  |HAZ Calcula17D;  #isow9001#19 = eaAlfa;
     enCanti = #isom9000#19 * 100;              #isow9001#20 = ("00000" + enCanti) % -105;
     enCanti = #isom9000#20;  |HAZ Calcula17D;  #isow9001#21 = eaAlfa;
     enCanti = #isom9000#21;  |HAZ Calcula17D;  #isow9001#22 = eaAlfa;
     enCanti = #isom9000#22;  |HAZ Calcula17D;  #isow9001#23 = eaAlfa;
     enCanti = #isom9000#23 * 100;              #isow9001#24 = ("00000" + enCanti) % -105;
     enCanti = #isom9000#24;  |HAZ Calcula17D;  #isow9001#25 = eaAlfa;
     enCanti = #isom9000#25;  |HAZ Calcula17D;  #isow9001#26 = eaAlfa;
     enCanti = #isom9000#26 * 100;              #isow9001#27 = ("00000" + enCanti) % -105;
     enCanti = #isom9000#27;  |HAZ Calcula17D;  #isow9001#28 = eaAlfa;
     enCanti = #isom9000#28;  |HAZ Calcula17D;  #isow9001#29 = eaAlfa;
     enCanti = #isom9000#29;  |HAZ Calcula17D;  #isow9001#30 = eaAlfa;
     enCanti = #isom9000#30;  |HAZ Calcula17D;  #isow9001#31 = eaAlfa;
                                           #isow9001#32 = "00000";
     |SI #isom9000#6 ! "A ";
         enCanti = #isom9000#31 * 100;              #isow9001#32 = ("00000" + enCanti) % -105;
     |FINSI;
     enCanti = #isom9000#32;  |HAZ Calcula17D;  #isow9001#33 = eaAlfa;
     enCanti = #isom9000#33;  |HAZ Calcula17D;  #isow9001#34 = eaAlfa;
     enCanti = #isom9000#34;  |HAZ Calcula17D;  #isow9001#35 = eaAlfa;

     nTotal  = #isom9000#14 + #isom9000#34;
     #isow9001#6  = "N";
     #isow9001#36 = "0";
     |SI nTotal > 0;
         |HAZ FormaPago;
     |FINSI;

     #isow9001#41 = "0";
     |SI #isom9000#3 > 0;
         #isow9001#41 = "1";
         #isow9001#42 = #isom9000#35;
     |FINSI;

     |ABRE #maempr01;
     #maempr01#0 = #isom9000#0;
     #maempr01#1 = #isom9000#1;
     |LEE 000#maempr01.=;
     |SI FSalida ! 0;  |DDEFECTO #maempr01;  |FINSI;
     |CIERRA #maempr01;

     #isow9001#44 = #maempr01#77;
     #isow9001#45 = #maempr01#15;
     #isow9001#49 = #isom9000#38;

     |PARA nCampo = 1;  |SI nCampo [ 52;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isow9001#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;
|FPRC;

|PROCESO FormaPago2013;
     #isow9007#11 = #isom9000#36;
     |SI #isow9007#11 = "4";  #isow9007#11 = "2";  |FINSI;

     |SI #isow9007#11 = "2";  |O #isow9007#11 = "3";
         |SI #isom9000#37 = "1";
             |ABRE #isocie00;
             |PARA nAnyoI = #isom9000#1 - 1;  |SI;  |HACIENDO nAnyoI = nAnyoI - 1;
                   |SI nAnyoI [ 2007;  |SAL;  |FINSI;

                   |DDEFECTO #isocie00;
                   #isocie00#0 = #isom9000#0;
                   #isocie00#1 = nAnyoI;
                   |LEE 000#isocie00.=;
                   |SI FSalida = 0;
                       |SI #isocie00#5 ! "0000000000";  |Y #isocie00#5 ! "          ";
                           #isow9007#12 = #isocie00#2;
                           #isow9007#13 = #isocie00#3;
                           #isow9007#14 = #isocie00#4;
                           #isow9007#15 = #isocie00#5;
                       |FINSI;
                       |SAL;
                   |FINSI;
             |SIGUE;
             |CIERRA #isocie00;
         |FINSI;

         |SI #isom9000#37 = "2"; |O #isow9007#12 = "0000"; |O #isow9007#12 = "    ";
             |ABRE #agifigen;
             #agifigen#0 = #isom9000#0;
             |LEE 040#agifigen.=;
             |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;
             |CIERRA #agifigen;

             |SI #agifigen#84 ! "                    ";
                 #isow9007#12 = #agifigen#81;
                 #isow9007#13 = #agifigen#82;
                 #isow9007#14 = #agifigen#83;
                 #isow9007#15 = #agifigen#84 % 110;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #isow9007#12 = "    ";        #isow9007#12 = "0000";        |FINSI;
     |SI #isow9007#13 = "    ";        #isow9007#13 = "0000";        |FINSI;
     |SI #isow9007#14 = "  ";          #isow9007#14 = "00";          |FINSI;
     |SI #isow9007#15 = "          ";  #isow9007#15 = "0000000000";  |FINSI;

                          #isow9006#6 = "I";
     |SI #isom9000#36 = "3";   #isow9006#6 = "U";  |FINSI;
     |SI #isom9000#36 = "4";   #isow9006#6 = "G";  |FINSI;
|FPRC;

|PROCESO CargaSecu2013;
     |ABRE #agim0019;
     #agim0019#0 = #isom9000#0;
     #agim0019#1 = 99;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
         |LEE 000#agim0019.a;
     |SINO;
         |LEE 000#agim0019.u;
     |FINSI;
     |CIERRA #agim0019;

     aCNAE = "";
     |SI FSalida = 0;  |Y #agim0019#0 = #isom9000#0;
         aCNAE = #agim0019#81;
     |FINSI;

     |ABRE #maempr11;
     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 6;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#39 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 17;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#41 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 18;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#41 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 22;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#53 = "S";
     |FINSI;

     |CIERRA #maempr11;

     |ABRE #maempr01;
     #maempr01#0 = #isom9000#0;
     #maempr01#1 = #isom9000#1;
     |LEE 000#maempr01.=;
     |SI FSalida ! 0;  |DDEFECTO #maempr01;  |FINSI;
     |CIERRA #maempr01;

     |DDEFECTO #isow9006;
     |DDEFECTO #isow9007;

     #isow9006#7  = #isom9000#4;
     #isow9006#8  = #isom9000#5;
     #isow9006#9  = #isom9000#1;
     #isow9006#10 = #isom9000#2;
     #isow9006#11 = (#isom9000#7 % 102) + (#isom9000#7 % 402) + (#isom9000#7 % 704);
     #isow9006#12 = aCNAE;

     |SI #isom9000#39 = "S";  #isow9006#13 = "X";  |FINSI;

     |SI #isom9000#40 = "S";  #isow9006#14 = "X";  |FINSI;

                              #isow9006#15 = "0";
     |SI #isom9000#41 = "S";  #isow9006#15 = "1";  |FINSI;
     |SI #isom9000#42 = "S";  #isow9006#15 = "2";  |FINSI;

     #isow9006#16 = #isom9000#43;
     #isow9006#17 = #isom9000#38;

     |SI #isom9000#44 = "S";  #isow9006#18 = "X";  |FINSI;

     enCanti = #isom9000#10;  |HAZ Calcula17D;  #isow9006#19 = eaAlfa;
     enCanti = #isom9000#13;  |HAZ Calcula17D;  #isow9006#20 = eaAlfa;
     enCanti = #isom9000#14;  |HAZ Calcula17D;  #isow9006#21 = eaAlfa;

     enCanti = #isom9000#15;  |HAZ Calcula17D;  #isow9006#22 = eaAlfa;
     enCanti = #isom9000#45;  |HAZ Calcula17D;  #isow9006#23 = eaAlfa;
     enCanti = #isom9000#46;  |HAZ Calcula17D;  #isow9006#24 = eaAlfa;
     enCanti = #isom9000#47;  |HAZ Calcula17D;  #isow9006#25 = eaAlfa;
     enCanti = #isom9000#48;  |HAZ Calcula17D;  #isow9006#26 = eaAlfa;
     enCanti = #isom9000#49;  |HAZ Calcula17D;  #isow9006#27 = eaAlfa;
     enCanti = #isom9000#50;  |HAZ Calcula17D;  #isow9006#28 = eaAlfa;
     enCanti = #isom9000#17;  |HAZ Calcula17D;  #isow9006#29 = eaAlfa;
     enCanti = #isom9000#18;  |HAZ Calcula17D;  #isow9006#30 = eaAlfa;
     enCanti = #isom9000#19 * 100;              #isow9006#31 = ("00000" + enCanti) % -105;
     enCanti = #isom9000#20;  |HAZ Calcula17D;  #isow9006#32 = eaAlfa;
     enCanti = #isom9000#21;  |HAZ Calcula17D;  #isow9006#33 = eaAlfa;
     enCanti = #isom9000#22;  |HAZ Calcula17D;  #isow9006#34 = eaAlfa;
     enCanti = #isom9000#23 * 100;              #isow9006#35 = ("00000" + enCanti) % -105;
     enCanti = #isom9000#24;  |HAZ Calcula17D;  #isow9006#36 = eaAlfa;
     enCanti = #isom9000#25;  |HAZ Calcula17D;  #isow9006#37 = eaAlfa;
     enCanti = #isom9000#26 * 100;              #isow9006#38 = ("00000" + enCanti) % -105;
     enCanti = #isom9000#27;  |HAZ Calcula17D;  #isow9006#39 = eaAlfa;
     enCanti = #isom9000#28;  |HAZ Calcula17D;  #isow9006#40 = eaAlfa;
     enCanti = #isom9000#29;  |HAZ Calcula17D;  #isow9006#41 = eaAlfa;
     enCanti = #isom9000#30;  |HAZ Calcula17D;  #isow9006#42 = eaAlfa;
                                                #isow9006#43 = "00000";
     |SI #isom9000#6 ! "A ";
         enCanti = #isom9000#31 * 100;          #isow9006#43 = ("00000" + enCanti) % -105;
     |FINSI;

     enCanti = #isom9000#33;  |HAZ Calcula17D;  #isow9006#44 = eaAlfa;
     enCanti = #isom9000#32;  |HAZ Calcula17D;  #isow9006#45 = eaAlfa;
     enCanti = #isom9000#51;  |HAZ Calcula17D;  #isow9006#46 = eaAlfa;
     enCanti = #isom9000#52;  |HAZ Calcula17D;  #isow9006#47 = eaAlfa;
     enCanti = #isom9000#34;  |HAZ Calcula17D;  #isow9006#48 = eaAlfa;

     |SI #isom9000#53 = "S";  #isow9006#49 = "X";  |FINSI;

     nTotal  = #isom9000#14 + #isom9000#34;
     #isow9007#6  = "";
     #isow9007#7  = "";

     #isow9007#8  = "";
     |SI #isom9000#3 > 0;
         #isow9007#8 = "X";
         #isow9007#9 = #isom9000#35;
     |FINSI;

     #isow9006#6  = "N";
     #isow9007#11 = "0";
     |SI nTotal > 0;
         |HAZ FormaPago2013;
     |SINO;
         #isow9007#10 = "X";
     |FINSI;

     #isow9007#18 = #maempr01#77;
     #isow9007#19 = #maempr01#15;

     |PARA nCampo = 1;  |SI nCampo [ 51;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isow9006#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;

     |SI aTipo ! "BORRADOR";
         eaAlfa = &13 + &10;
         |HAZ GrabaSecuencial;
     |FINSI;

     |PARA nCampo = 1;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isow9007#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;

     |SI aTipo ! "BORRADOR";
         eaAlfa = &13 + &10;
         |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|PROCESO FormaPago2014;
     #isow9009#11 = #isom9000#36;
     |SI #isow9009#11 = "4";  #isow9009#11 = "2";  |FINSI;

     |SI #isow9009#11 = "2";  |O #isow9009#11 = "3";
         |SI #isom9000#37 = "1";
             |ABRE #isocie00;
             |PARA nAnyoI = #isom9000#1 - 1;  |SI;  |HACIENDO nAnyoI = nAnyoI - 1;
                   |SI nAnyoI [ 2007;  |SAL;  |FINSI;

                   |DDEFECTO #isocie00;
                   #isocie00#0 = #isom9000#0;
                   #isocie00#1 = nAnyoI;
                   |LEE 000#isocie00.=;
                   |SI FSalida = 0;
                       |SI #isocie00#5 ! "0000000000";  |Y #isocie00#5 ! "          ";
                           #isow9009#12 = #isocie00#7;
                       |FINSI;
                       |SAL;
                   |FINSI;
             |SIGUE;
             |CIERRA #isocie00;
         |FINSI;
         aAlfa = #isow9009#12; |QBF aAlfa;
         |SI #isom9000#37 = "2";  |O aAlfa = "";
             |ABRE #agifigen;
             #agifigen#0 = #isom9000#0;
             |LEE 040#agifigen.=;
             |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;
             |CIERRA #agifigen;

             #isow9009#12 = #agifigen#94;
         |FINSI;
     |FINSI;

                               #isow9008#6 = "I";
     |SI #isom9000#36 = "3";   #isow9008#6 = "U";  |FINSI;
     |SI #isom9000#36 = "4";   #isow9008#6 = "G";  |FINSI;
|FPRC;

|PROCESO CargaSecu2014;
     |ABRE #agim0019;
     #agim0019#0 = #isom9000#0;
     #agim0019#1 = 99;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
         |LEE 000#agim0019.a;
     |SINO;
         |LEE 000#agim0019.u;
     |FINSI;
     |CIERRA #agim0019;

     aCNAE = "";
     |SI FSalida = 0;  |Y #agim0019#0 = #isom9000#0;
         aCNAE = #agim0019#81;
     |FINSI;

     |ABRE #maempr11;
     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 6;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#39 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 17;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#41 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 18;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#41 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 22;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#53 = "S";
     |FINSI;

     |CIERRA #maempr11;

     |ABRE #maempr01;
     #maempr01#0 = #isom9000#0;
     #maempr01#1 = #isom9000#1;
     |LEE 000#maempr01.=;
     |SI FSalida ! 0;  |DDEFECTO #maempr01;  |FINSI;
     |CIERRA #maempr01;

     |DDEFECTO #isow9008;
     |DDEFECTO #isow9009;

     |DDEFECTO #isow9008;
     |DDEFECTO #isow9009;

     #isow9008#7  = #isom9000#4;
     #isow9008#8  = #isom9000#5;
     #isow9008#9  = #isom9000#1;
     #isow9008#10 = #isom9000#2;
     #isow9008#11 = (#isom9000#7 % 102) + (#isom9000#7 % 402) + (#isom9000#7 % 704);
     #isow9008#12 = aCNAE;


     |SI #isom9000#53 = "S";  #isow9008#13 = "X";  |FINSI;
     |SI #isom9000#39 = "S";  #isow9008#14 = "X";  |FINSI;
     |SI #isom9000#40 = "S";  #isow9008#15 = "X";  |FINSI;

                              #isow9008#16 = "0";
     |SI #isom9000#41 = "S";  #isow9008#16 = "1";  |FINSI;
     |SI #isom9000#42 = "S";  #isow9008#16 = "2";  |FINSI;

     #isow9008#17 = #isom9000#43;
     #isow9008#18 = #isom9000#38;

     |SI #isom9000#44 = "S";  #isow9008#19 = "X";  |FINSI;

     enCanti = #isom9000#10;  |HAZ Calcula17D;  #isow9008#20 = eaAlfa;
     enCanti = #isom9000#13;  |HAZ Calcula17D;  #isow9008#21 = eaAlfa;
     enCanti = #isom9000#14;  |HAZ Calcula17D;  #isow9008#22 = eaAlfa;

     enCanti = #isom9000#15;  |HAZ Calcula17D;  #isow9008#23 = eaAlfa;
     enCanti = #isom9000#45;  |HAZ Calcula17D;  #isow9008#24 = eaAlfa;
     enCanti = #isom9000#46;  |HAZ Calcula17D;  #isow9008#25 = eaAlfa;
     enCanti = #isom9000#54;  |HAZ Calcula17D;  #isow9008#26 = eaAlfa;
     enCanti = #isom9000#55;  |HAZ Calcula17D;  #isow9008#27 = eaAlfa;
     enCanti = #isom9000#47;  |HAZ Calcula17D;  #isow9008#28 = eaAlfa;
     enCanti = #isom9000#48;  |HAZ Calcula17D;  #isow9008#29 = eaAlfa;
     enCanti = #isom9000#56;  |HAZ Calcula17D;  #isow9008#30 = eaAlfa;
     enCanti = #isom9000#57;  |HAZ Calcula17D;  #isow9008#31 = eaAlfa;
     enCanti = #isom9000#49;  |HAZ Calcula17D;  #isow9008#32 = eaAlfa;
     enCanti = #isom9000#50;  |HAZ Calcula17D;  #isow9008#33 = eaAlfa;
     enCanti = #isom9000#17;  |HAZ Calcula17D;  #isow9008#34 = eaAlfa;
     enCanti = #isom9000#18;  |HAZ Calcula17D;  #isow9008#35 = eaAlfa;
     enCanti = #isom9000#19 * 100;              #isow9008#36 = ("00000" + enCanti) % -105;
     enCanti = #isom9000#58;  |HAZ Calcula17D;  #isow9008#37 = eaAlfa;
     enCanti = #isom9000#20;  |HAZ Calcula17D;  #isow9008#38 = eaAlfa;
     enCanti = #isom9000#21;  |HAZ Calcula17D;  #isow9008#39 = eaAlfa;
     enCanti = #isom9000#22;  |HAZ Calcula17D;  #isow9008#40 = eaAlfa;
     enCanti = #isom9000#23 * 100;              #isow9008#41 = ("00000" + enCanti) % -105;
     enCanti = #isom9000#24;  |HAZ Calcula17D;  #isow9008#42 = eaAlfa;
     enCanti = #isom9000#25;  |HAZ Calcula17D;  #isow9008#43 = eaAlfa;
     enCanti = #isom9000#26 * 100;              #isow9008#44 = ("00000" + enCanti) % -105;
     enCanti = #isom9000#27;  |HAZ Calcula17D;  #isow9008#45 = eaAlfa;
     enCanti = #isom9000#59;  |HAZ Calcula17D;  #isow9008#46 = eaAlfa;
     enCanti = #isom9000#28;  |HAZ Calcula17D;  #isow9008#47 = eaAlfa;
     enCanti = #isom9000#29;  |HAZ Calcula17D;  #isow9008#48 = eaAlfa;
     enCanti = #isom9000#30;  |HAZ Calcula17D;  #isow9008#49 = eaAlfa;
                                                #isow9008#50 = "00000";
     |SI #isom9000#6 ! "A ";
         enCanti = #isom9000#31 * 100;          #isow9008#50 = ("00000" + enCanti) % -105;
     |FINSI;

     enCanti = #isom9000#33;  |HAZ Calcula17D;  #isow9008#51 = eaAlfa;
     enCanti = #isom9000#32;  |HAZ Calcula17D;  #isow9008#52 = eaAlfa;
     enCanti = #isom9000#51;  |HAZ Calcula17D;  #isow9008#53 = eaAlfa;
     enCanti = #isom9000#52;  |HAZ Calcula17D;  #isow9008#54 = eaAlfa;
     enCanti = #isom9000#34;  |HAZ Calcula17D;  #isow9008#55 = eaAlfa;

     nTotal  = #isom9000#14 + #isom9000#34;
     #isow9009#6  = "";
     #isow9009#7  = "";

     #isow9009#8  = "";
     |SI #isom9000#3 > 0;
         #isow9009#8 = "X";
         #isow9009#9 = #isom9000#35;
     |FINSI;

     #isow9008#6  = "N";
     #isow9009#11 = "0";
     |SI nTotal > 0;
         |HAZ FormaPago2014;
     |SINO;
         #isow9009#10 = "X";
     |FINSI;

     #isow9009#15 = #maempr01#77;
     #isow9009#16 = #maempr01#15;

     |PARA nCampo = 1;  |SI nCampo [ 57;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isow9008#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;

     |SI aTipo ! "BORRADOR";
         eaAlfa = &13 + &10;
         |HAZ GrabaSecuencial;
     |FINSI;

     |PARA nCampo = 1;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isow9009#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;

     |SI aTipo ! "BORRADOR";
         eaAlfa = &13 + &10;
         |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|PROCESO Borrador;

     |SI #isom9000#1 ] 2013;
         |SI #isom9000#2 = "3P";
             aAlfa = (("00000" + #isom9000#0) % -105) + "," + #isom9000#1 + "," + #isom9000#2;
             aAlfa = "isoy0005;" + aAlfa;
             |SUB_EJECUTA_NP aAlfa;
||             |MENAV "0000Hacienda en este periodo y posteriores no ha facilitado esta opci¢n. Discupen las molestias.";
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #isom9000#1 ] 2014;
         aAlfa = (("00000" + #isom9000#0) % -105) + "," + #isom9000#1 + "," + #isom9000#2;
         aAlfa = "isoy0005;" + aAlfa;
         |SUB_EJECUTA_NP aAlfa;
||         |MENAV "0000Hacienda en este periodo y posteriores no ha facilitado esta opci¢n. Discupen las molestias.";
         |ACABA;
     |FINSI;

     aTipo = "BORRADOR";

     |HAZ AbreSecuencial;

     |SI #isom9000#1 [ 2011;
         |HAZ CargaSecu2010;
     |FINSI;

     |SI #isom9000#1 = 2012;
         |SI #isom9000#2 = "1P";
             |HAZ CargaSecu2010;
         |SINO;
             |HAZ CargaSecu2013;
         |FINSI;
     |FINSI;

     |SI #isom9000#1 = 2013;
         |SI #isom9000#2 ! "3P";
             |HAZ CargaSecu2013;
         |SINO;
             |HAZ CargaSecu2014;
         |FINSI;
     |FINSI;

     |SI #isom9000#1 ] 2014;
         |HAZ CargaSecu2014;
     |FINSI;

     |HAZ CierraSecuencial;
|FPRC;

|PROCESO Emision;
     |SI #isom9000#8 = "S";
         |CONFI "0000NEl registro ya est  impreso. Quiere volver a emitir";
         |SI FSalida ! 0;  |ACABA;  |FINSI;
     |FINSI;

     |LEE 101#isom9000.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     eaImpre = "N";
     eaJusti = "";

     aTipo = "EMISION";
     |HAZ AbreSecuencial;

     |SI #isom9000#1 [ 2011;
         |HAZ CargaSecu2010;
     |FINSI;

     |SI #isom9000#1 = 2012;
         |SI #isom9000#2 = "1P";
             |HAZ CargaSecu2010;
         |SINO;
             |HAZ CargaSecu2013;
         |FINSI;
     |FINSI;

     |SI #isom9000#1 = 2013;
         |SI #isom9000#2 ! "3P";
             |HAZ CargaSecu2013;
         |SINO;
             |HAZ CargaSecu2014;
         |FINSI;
     |FINSI;

     |SI #isom9000#1 ] 2014;
         |HAZ CargaSecu2014;
     |FINSI;

     |HAZ CierraSecuencial;

     #isom9000#8 = eaImpre;
     #isom9000#9 = eaJusti;
     |GRABA 020#isom9000.a;
     |LIBERA #isom9000;

     |REFRESCACONTROL enGrid;
     |FOCOTECLADO enGrid;
|FPRC;
