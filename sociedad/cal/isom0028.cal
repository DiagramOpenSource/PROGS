|FICHEROS;
     isom0000;
     isom0001;
     isom0006;
     isom0028;
     isom0516;

     maempr10;
|FIN;

|VARIABLES;
      nRango         = 0;
      nBotonSal      = 0;
      nBotonAnota    = -1;
      nBotonPorce    = -1;
      nTree          = 0;
      nHandle        = 0;
      nPanta         = 0;
      nBotonLabel    = 0;
      nVentana       = 0;
      nVent          = 0;
      nGrid          = 0;
      nModo          = 0;
      nLinea         = 0;
      nBase          = 0;
      nBase1         = 0;
      nCasilla552    = 0;
      nPorce         = 0;
      nDLinea        = 0;
      nHLinea        = 0;
      nTope          = 0;
      nValor1170     = 0;
      nValor505      = 0;

      aContenido     = "";
      aTexto         = "";
      aCasilla       = "";
      aCas           = "";
      aBase          = "";
      aAlfa          = "";
      aAbre          = "";
      aEsc1          = "";
      aEsc2          = "";
      aRetu          = "";
      aTecla         = "";

     {-1}sTree       = 0;
     sT_nID          = 0;
     sT_nOper        = 0;
     sT_aData        = "";

     {-1}aVent       = "";
         aVent1      = 0;
         aVent2      = 0;
         aVent3      = 0;
         aVent4      = 0;
         aVent5      = "";

     &enEmpresa      = 0;
     &enAnyo         = 0;
     &eaCasilla      = "";
     &eaTitCasilla   = "";
     &eaRutaOrigen   = "";
     &eaRutaDestino  = "";
     &eaFicheroTra   = "";
     &eaFicheroTxt   = "";
     &eaFicheroTgz   = "";
     &eaFicheroTar   = "";
     &eaOrigen       = "";
     &eaDestino      = "";
     &eaAlfa         = "";
     &eaTipoColor    = "";
     &eaColor        = "";
     &enModoConsulta = 0;
|FIN;

|PROCESO Tipo12;  |TIPO 12;
|FPRC;

|PROCESO Tipo1;  |TIPO 1;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;  |O nModo = 3;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo7C5m28;  |TIPO 7;
     |SI aCas = "1040";
         |SI nValor1170 = 0;  |Y #isom0028#5 = 0;
             #isom0028#5 = nValor505;
         |FINSI;

         |PINTA #isom0028#5;
     |FINSI;
|FPRC;

|PROCESO Tipo7C7m28;  |TIPO 7;
     nPorce = 5;
     |SI enAnyo [ 2015;
         |SI #isom0028#3 = "2015      "; |O #isom0028#3 = "2015 (*)  ";
             nPorce = 2;
         |FINSI;
     |FINSI;

     |SI enAnyo ] 2016;
         |SI #isom0028#4 = "1166 ";   |O #isom0028#4 = "1178 ";
             nPorce = 2;
         |FINSI;
     |FINSI;

     #isom0028#7 = #isom0028#5 % nPorce;
     |PINTA #isom0028#7;
|FPRC;

|PROCESO Tipo7C9m28;  |TIPO 7;
     |SI #isom0028#9 = 0;
         |SI #isom0028#7 [ nBase;
             #isom0028#9 = #isom0028#7;
         |SINO;
             #isom0028#9 = nBase;
         |FINSI;
     |FINSI;

     |SI #isom0028#9 > nBase;
         #isom0028#9 = nBase;
     |FINSI;

     |SI #isom0028#9 > #isom0028#7;
         #isom0028#9 = #isom0028#7;
     |FINSI;

     |PINTA #isom0028#7;
     |PINTA #isom0028#9;
|FPRC;

|PROCESO Tipo0C9m28;  |TIPO 0;
     |SI #isom0028#9 > nBase;
         |MENAV "0000 Lo aplicado supera a la casilla 582 menos el resto de deducciones";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Totalm28;
     #isom0028#11 = 0;

     |SI #isom0028#9 > #isom0028#7;  #isom0028#9 = #isom0028#7;   |FINSI;

     |SI #isom0028#10 ! "     ";
         #isom0028#11 = #isom0028#7 - #isom0028#9;
     |FINSI;

     |PINTA #isom0028#7;
     |PINTA #isom0028#9;
|FPRC;

|PROCESO Tipo2;  |TIPO 2;
     |HAZ Tipo1;

     nBase      = (nBase -. #isom0028#9) ! 2;
     nValor1170 = nValor1170 +. #isom0028#5;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     #isom0516#0 = #isom0028#1;
     #isom0516#1 = #isom0028#2;
     |LEE 000#isom0516.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0516;  |FINSI;

     |SI #isom0516#7 ! "I";  |ACABA;  |FINSI;

     |GRABA 020#isom0028.a;
     |LIBERA #isom0028;

     nLinea = #isom0028#2;

     |HAZ TotalFich128;

     #isom0028#0 = #maempr10#0;
     #isom0028#1 = #maempr10#1;
     #isom0028#2 = nLinea;
     |LEE 101#isom0028.=;

     aAlfa = "|IDGRID";
     aAlfa = #isom0028#aAlfa#;
     nGrid = aAlfa;
     |REFRESCACONTROL nGrid;
|FPRC;

|PROCESO Tipo0;  |TIPO 0;
     |C_M #isom0028#5,  1, "N";
     |C_M #isom0028#7,  1, "N";
     |C_M #isom0028#9,  1, "N";
     |C_M #isom0028#11, 1, "N";

     #isom0516#0 = #isom0028#1;
     #isom0516#1 = #isom0028#2;
     |LEE 000#isom0516.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0516;  |FINSI;

     |SI #isom0516#7 ! "I";  |ACABA;  |FINSI;

     |SI #isom0028#4  ! "     ";  |C_M #isom0028#5,  1, "S";  |FINSI;
     |SI #isom0028#8  ! "     ";  |C_M #isom0028#9,  1, "S";  |FINSI;
     |SI #isom0028#10 ! "     ";  |C_M #isom0028#11, 1, "S";  |FINSI;
|FPRC;

|PROCESO Evento128;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#isom0028.=;
     |FINSI;
|FPRC;

|PROCESO isom0516;
     #isom0028#0  = enEmpresa;
     #isom0028#1  = #isom0516#0;
     #isom0028#2  = #isom0516#1;
     |LEE 101#isom0028.=;
     |SI FSalida ! 0;
         |DDEFECTO #isom0028;
         #isom0028#0  = enEmpresa;
         #isom0028#1  = #isom0516#0;
         #isom0028#2  = #isom0516#1;
         |GRABA 020#isom0028.b;
     |FINSI;

     #isom0028#3  = #isom0516#2;
     #isom0028#4  = #isom0516#3;
     #isom0028#6  = #isom0516#4;
     #isom0028#8  = #isom0516#5;
     #isom0028#10 = #isom0516#6;

     eaTipoColor  = #isom0516#8;
     |HAZ CogeColor;
     #isom0028#12 = eaColor;

     |GRABA 020#isom0028.a;
     |LIBERA #isom0028;
|FPRC;

|DEFBUCLE isom0516;
     #isom0516#1;
     ;
     enAnyo, nDLinea;
     enAnyo, nHLinea;
     ;
     NULL, isom0516;
|FIN;

|PROCESO MontaEstructura516;
     |BUCLE isom0516;
|FPRC;

|PROCESO BotonSalir;
     |PTEC 807;
|FPRC;

|PROCESO BotonAnota;
     eaCasilla    = #isom0028#4;     |QBF eaCasilla;
     eaTitCasilla = #isom0028#3;     |QBF eaTitCasilla;

     |SUB_EJECUTA "isom0499";

     aAlfa = "|IDGRID";
     aAlfa = #isom0028#aAlfa#;
     nGrid = aAlfa;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Baja128;
     #isom0028#0  = enEmpresa;
     #isom0028#1  = enAnyo;
     #isom0028#2  = nDLinea;
|FPRC;

|PROCESO Alta128;
     #isom0028#0  = enEmpresa;
     #isom0028#1  = enAnyo;
     #isom0028#2  = nHLinea;
|FPRC;

|PROCESO isom0028R;
     |SI #isom0028#9  = 0;  |ACABA;  |FINSI;

     |SI nBase = 0;
         #isom0028#9  = 0;

         |SI #isom0028#10 ! "     ";
             #isom0028#11 = #isom0028#7 - #isom0028#9;
         |FINSI;

         |GRABA 020#isom0028.a;
         |LIBERA #isom0028;
         |ACABA;
     |FINSI;

     nBase1 = nBase1 + #isom0028#9;

     |SI nBase1 > nBase;
         nBase1 = nBase1 - #isom0028#9;
         #isom0028#9 = nBase - nBase1;
         nBase1 = nBase1 + #isom0028#9;

         |SI #isom0028#9 > #isom0028#7;
             #isom0028#9 = #isom0028#7;
         |FINSI;

         #isom0028#11 = 0;

         |SI #isom0028#10 ! "     ";
             #isom0028#11 = #isom0028#7 - #isom0028#9;
         |FINSI;

         |GRABA 020#isom0028.a;
         |LIBERA #isom0028;
     |FINSI;
|FPRC;

|DEFBUCLE isom0028R;
     #isom0028#1;
     ;
     enEmpresa, enAnyo, nDLinea;
     enEmpresa, enAnyo, nHLinea;
     be;
     NULL, isom0028R;
|FIN;

|PROCESO RecogeBase;
     nBase = 0;

     |ABRE #isom0001;
     |SELECT #2#isom0001;
     eaCasilla = "582";  |HAZ LeeCas101;  nBase = nBase + #isom0001#5;
     eaCasilla = "583";  |HAZ LeeCas101;  nBase = nBase - #isom0001#5;
     eaCasilla = "585";  |HAZ LeeCas101;  nBase = nBase - #isom0001#5;
     eaCasilla = "584";  |HAZ LeeCas101;  nBase = nBase - #isom0001#5;
     eaCasilla = "588";  |HAZ LeeCas101;  nBase = nBase - #isom0001#5;
     eaCasilla = "1039"; |HAZ LeeCas101;  nBase = nBase - #isom0001#5;
     eaCasilla = "565";  |HAZ LeeCas101;  nBase = nBase - #isom0001#5;
     eaCasilla = "590";  |HAZ LeeCas101;  nBase = nBase - #isom0001#5;
     eaCasilla = "399";  |HAZ LeeCas101;  nBase = nBase - #isom0001#5;
     eaCasilla = "082";  |HAZ LeeCas101;  nBase = nBase - #isom0001#5;

     |SI aCas = "1041";
         eaCasilla = "1040";  |HAZ LeeCas101;  nBase = nBase - #isom0001#5;
     |FINSI;

     |SELECT #1#isom0001;
     |CIERRA #isom0001;
|FPRC;

|PROCESO TopeCompensa;
     |ABRE #isom0000;
     #isom0000#0 = enEmpresa;
     #isom0000#1 = enAnyo;
     |LEE 000#isom0000.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0000;  |FINSI;
     |CIERRA #isom0000;

     |HAZ RecogeBase;
     nTope = nBase;

     |SI aCas = "1040"; aCasilla = "1170";  |FINSI;
     |SI aCas = "1041"; aCasilla = "1182";  |FINSI;

     |SELECT #2#isom0028;
     #isom0028#0 = enEmpresa;
     #isom0028#1 = enAnyo;
     #isom0028#4 = aCasilla;
     |LEE 000#isom0028.=;
     |SI FSalida = 0;
         nBase = (nBase - #isom0028#9) ! 2;
     |FINSI;
     |LIBERA #isom0028;
     |SELECT #1#isom0028;

     |SI nBase < 0;  |O nTope [ 0;
         |HAZ RecogeBase;
         |SI nBase < 0;  nBase = 0;  |FINSI;

         nBase1 = 0;  |BUCLE isom0028R;
         |HAZ TotalFich128;

         nBase = 0;
     |FINSI;
|FPRC;

|PROCESO isom0028;
     |SI #isom0028#5  ! 0;  |ACABA;  |FINSI;
     |SI #isom0028#7  ! 0;  |ACABA;  |FINSI;
     |SI #isom0028#9  ! 0;  |ACABA;  |FINSI;
     |SI #isom0028#11 ! 0;  |ACABA;  |FINSI;

     |BORRA 020#isom0028.a;
     |LIBERA #isom0028;
|FPRC;

|DEFBUCLE isom0028;
     #isom0028#1;
     ;
     enEmpresa, enAnyo, nDLinea;
     enEmpresa, enAnyo, nHLinea;
     be;
     NULL, isom0028;
|FIN;

|PROGRAMA;
     |SI aCas = "1040";
         |ABRE #isom0006;
         |SELECT #3#isom0006;
         #isom0006#0  = enEmpresa;
         #isom0006#1  = enAnyo;
         #isom0006#6  = "505";
         |LEE 040#isom0006.=;
         |SI FSalida ! 0;  |DDEFECTO #isom0006;  |FINSI;
         |CIERRA #isom0006;
         |SELECT #1#isom0006;

         nValor505 = #isom0006#7;

         |SI nValor505 = 0;
             |MENAV "0000Casilla (505) en los detalles de las correcciones, no tiene contenido";
         |FINSI;

         |SELECT #2#isom0028;
         #isom0028#0 = enEmpresa;
         #isom0028#1 = enAnyo;
         #isom0028#4 = "1170";
         |LEE 000#isom0028.=;
         |SI FSalida ! 0;  |DDEFECTO #isom0028;  |FINSI;

         nValor1170 = #isom0028#5;

         |SELECT #1#isom0028;
     |FINSI;

     |ABRE #maempr10;
     #maempr10#0 = enEmpresa;
     #maempr10#1 = enAnyo;
     |LEE 000#maempr10.=;
     |SI FSalida ! 0;  |DDEFECTO #maempr10;  |FINSI;
     |CIERRA #maempr10;

     |HAZ MontaEstructura516;

     |HAZ TopeCompensa;

     #isom0028#0 = enEmpresa;
     #isom0028#1 = enAnyo;
     #isom0028#2 = nDLinea;
     |LEE 000#isom0028.];

     |PINPA #0#isom0028;

     |CONTROL_SIMPLE 0, "BOTON,{{197}} sali&R", 3488, 3498, BotonSalir;
     nBotonSal = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}} a&Notaciones de la compesaci¢n", 3302, 3425, BotonAnota;
     nBotonAnota = FSalida;

     |SI enModoConsulta = 0;
         nRango = 1 + 2 + 4 + 8 + 16 + 128 + 256;
     |SINO;
         nRango = 4 + 8 + 16 + 128 + 256;
     |FINSI;

     |PARA;  |SI;  |HACIENDO;
          |LINEAL_SIMPLE #1#isom0028, nRango, 0502, 3498, Baja128, Alta128, Evento128;
          |SI aCas = "1041";  |SAL;  |FINSI;

          |SELECT #2#isom0028;
          #isom0028#0 = enEmpresa;
          #isom0028#1 = enAnyo;
          #isom0028#4 = "1170";
          |LEE 000#isom0028.=;
          |SI FSalida ! 0;  |DDEFECTO #isom0028;  |FINSI;

          |SAL;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBotonSal;
     |FIN_CONTROL_WINDOWS nBotonAnota;

     |BUCLE isom0028;

     |PULSATECLA;
|FPRO;

|PROCESO Tipo80m28;  |TIPO 80;
     |ABRET #isom0028;
     |ABRET #isom0516;

     aCas = eaCasilla;  |QBF aCas;

     |SI enAnyo [ 2015;
         |SI aCas = "1040";
             nDLinea = 95;
             nHLinea = 105;
         |FINSI;

         |SI aCas = "1041";
             nDLinea = 115;
             nHLinea = 125;
         |FINSI;
     |FINSI;

     |SI enAnyo = 2016;
         |SI aCas = "1040";
             nDLinea = 110;
             nHLinea = 125;
         |FINSI;

         |SI aCas = "1041";
             nDLinea = 135;
             nHLinea = 150;
         |FINSI;
     |FINSI;

     |SI enAnyo = 2017;
         |SI aCas = "1040";
             nDLinea = 125;
             nHLinea = 145;
         |FINSI;

         |SI aCas = "1041";
             nDLinea = 155;
             nHLinea = 175;
         |FINSI;
     |FINSI;

     |SI enAnyo = 2018;
         |SI aCas = "1040";
             nDLinea = 135;
             nHLinea = 160;
         |FINSI;

         |SI aCas = "1041";
             nDLinea = 170;
             nHLinea = 195;
         |FINSI;
     |FINSI;

     |SI enAnyo = 2019;
         |SI aCas = "1040";
             nDLinea = 145;
             nHLinea = 175;
         |FINSI;

         |SI aCas = "1041";
             nDLinea = 185;
             nHLinea = 215;
         |FINSI;
     |FINSI;

     FSalida = 3499;
|FPRC;

|PROCESO Tipo90m28;  |TIPO 90;
     |CIERRAT #isom0028;
     |CIERRAT #isom0516;

     |SELECT #1#isom0001;
|FPRC;
