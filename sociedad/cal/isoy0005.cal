|FICHEROS
     isoy0005 #0;

     :agicli/agim0019;
     :agicli/agifigen;

     maempr01;
     maempr11;

     isocie00;
     isom9000;
      espejo@;


     isow9008;                    || Registro emision 2014 H1
     isow9009;                    || Registro emision 2014 H2
|FIN;

|VARIABLES;
     aParam    = "";
     aAlfa     = "";
     nCampo    = 0;
     aPeriodo  = "";
     nDEmpresa = 0;
     nHEmpresa = 0;

     nTotal    = 0;
     aCNAE     = "";
     aBase     = "";
     aMas      = "";

     nCanti           = 0;
     eaAlfa           = "";

     &enEmpresa       = 0;
     &enAnyo          = 0;
     &enModelo        = 0;
     &eaIBAN          = "";

     aAlfa1    = "";
     aAlfa2    = "";
     aAlfa3    = "";
     &eaFechaB = "";
     &eaDiaB   = "";
     &eaMesB   = "";
     &eaAnyoB  = "";
     nAnyoI    = 0;
|FIN;

|| **************************************************************************
||                           PROCESOS DE UTLIDADES LASER
|| **************************************************************************

|PROCESO Seleccion; |TIPO 0;
     |SI #0#0 = "S";
         |C_M #0#01, 1, "S";
         |C_M #0#02, 1, "S";
         |PARA nCampo = 3; |SI nCampo [ 32; |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0; |PINTA #0nCampo;
         |SIGUE;
     |SINO;
         #0#1 = 00001; |PINTA #0#1;
         #0#2 = 99999; |PINTA #0#2;
         |C_M #0#01, 1, "N";
         |C_M #0#02, 1, "N";

         |PARA nCampo = 3; |SI nCampo [ 32; |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|CALCULO NoMasEmpresas; |TIPO 0;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO ElEjercicio;
    aAlfa = "S";
    |SI #0#33 = 2013;
        aAlfa = "N"; #0#35 = 3; |PINTA #0#35;
    |FINSI;
    |C_M #0#35,1,aAlfa;
|FCAL;

|| ======================================================================
|PROCESO FormaPago2014;
     #isow9009#11 = #isom9000#36;
     |SI #isow9009#11 = "4";  #isow9009#11 = "2";  |FINSI;

     |SI #isow9009#11 = "2";  |O #isow9009#11 = "3";
         |SI #isom9000#37 = "1";
             |ABRE #isocie00;
             |PARA nAnyoI = #isom9000#1 - 1;  |SI;  |HACIENDO nAnyoI = nAnyoI - 1;
                   |SI nAnyoI [ 2007;  |SAL;  |FINSI;

                   |DDEFECTO #isocie00;
                   #isocie00#0 = #isom9000#0;
                   #isocie00#1 = nAnyoI;
                   |LEE 000#isocie00.=;
                   |SI FSalida = 0;
                       |SI #isocie00#5 ! "0000000000";  |Y #isocie00#5 ! "          ";
                           #isow9009#12 = #isocie00#7;
                       |FINSI;
                       |SAL;
                   |FINSI;
             |SIGUE;
             |CIERRA #isocie00;
         |FINSI;
         aAlfa = #isow9009#12; |QBF aAlfa;
         |SI #isom9000#37 = "2";  |O aAlfa = "";
             |ABRE #agifigen;
             #agifigen#0 = #isom9000#0;
             |LEE 040#agifigen.=;
             |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;
             |CIERRA #agifigen;

             #isow9009#12 = #agifigen#94;
         |FINSI;
     |FINSI;

                               #isow9008#6 = "I";
     |SI #isom9000#36 = "3";   #isow9008#6 = "U";  |FINSI;
     |SI #isom9000#36 = "4";   #isow9008#6 = "G";  |FINSI;
|FPRC;

|PROCESO FechaBonito;
     eaAlfa = #0#34;
     aAlfa1 = eaAlfa % 102;
     aAlfa2 = eaAlfa % 402;
     aAlfa3 = eaAlfa % 704;

     |SI aAlfa2 = "01";  aAlfa2 = "ENERO     ";  |FINSI;
     |SI aAlfa2 = "02";  aAlfa2 = "FEBRERO   ";  |FINSI;
     |SI aAlfa2 = "03";  aAlfa2 = "MARZO     ";  |FINSI;
     |SI aAlfa2 = "04";  aAlfa2 = "ABRIL     ";  |FINSI;
     |SI aAlfa2 = "05";  aAlfa2 = "MAYO      ";  |FINSI;
     |SI aAlfa2 = "06";  aAlfa2 = "JUNIO     ";  |FINSI;
     |SI aAlfa2 = "07";  aAlfa2 = "JULIO     ";  |FINSI;
     |SI aAlfa2 = "08";  aAlfa2 = "AGOSTO    ";  |FINSI;
     |SI aAlfa2 = "09";  aAlfa2 = "SEPTIEMBRE";  |FINSI;
     |SI aAlfa2 = "10";  aAlfa2 = "OCTUBRE   ";  |FINSI;
     |SI aAlfa2 = "11";  aAlfa2 = "NOVIEMBRE ";  |FINSI;
     |SI aAlfa2 = "12";  aAlfa2 = "DICIEMBRE ";  |FINSI;

     |QBF aAlfa2;
     eaFechaB = aAlfa1 + " de " + aAlfa2 + " de " + aAlfa3;
     eaDiaB   = aAlfa1;
     eaMesB   = aAlfa2;
     eaAnyoB  = aAlfa3;
|FPRC;

|PROCESO Calcula17D;
     nCanti = nCanti * 100;
     nCanti = nCanti ! 0;

     |SI nCanti ] 0;
         aAlfa = nCanti;
         eaAlfa = ("00000000000000000" + aAlfa) % -117;
     |SINO;
         nCanti  = -nCanti;
         aAlfa   = nCanti;
         eaAlfa   = "N" + (("0000000000000000" + aAlfa) % -116);
     |FINSI;
|FPRC;

|| ======================================================================
|PROCESO Imprime;
    #espejo@#0 = #isom9000#0;
    #espejo@#1 = #isom9000#1;
    #espejo@#2 = #isom9000#2;
    #espejo@#3 = #isom9000#3 + 1;
    |LEE 041#espejo@.=;
    |SI FSalida = 0;
        |REPON_DATOS #isom9000;
        |ACABA;
    |FINSI;

    aCNAE = "";
    #agim0019#0 = #isom9000#0;
    #agim0019#1 = 99;
    |LEE 000#agim0019.];
    |SI FSalida = 0;
        |LEE 000#agim0019.a;
    |SINO;
        |LEE 000#agim0019.u;
    |FINSI;
    |SI FSalida = 0;  |Y #agim0019#0 = #isom9000#0;
        aCNAE = #agim0019#40;
    |SINO;
        |DDEFECTO #agim0019;
    |FINSI;
/*
    #maempr11#0 = #isom9000#0;
    #maempr11#1 = #isom9000#1;
    #maempr11#2 = 6;
    |LEE 000#maempr11.=;
    |SI FSalida = 0;
        #isom9000#39 = "S";
    |FINSI;

    #maempr11#0 = #isom9000#0;
    #maempr11#1 = #isom9000#1;
    #maempr11#2 = 17;
    |LEE 000#maempr11.=;
    |SI FSalida = 0;
        #isom9000#41 = "S";
    |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 18;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#41 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 22;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#53 = "S";
     |FINSI;
*/
     #maempr01#0 = #isom9000#0;
     #maempr01#1 = #isom9000#1;
     |LEE 000#maempr01.=;
     |SI FSalida ! 0;  |DDEFECTO #maempr01;  |FINSI;

     |DDEFECTO #isow9008;
     |DDEFECTO #isow9009;

     #isow9008#7  = #isom9000#4;
     #isow9008#8  = #isom9000#5;
     #isow9008#9  = #isom9000#1;
     #isow9008#10 = #isom9000#2;
     #isow9008#11 = (#isom9000#7 % 102) + (#isom9000#7 % 402) + (#isom9000#7 % 704);
     #isow9008#12 = aCNAE;

     |SI #isom9000#53 = "S";  #isow9008#13 = "X";  |FINSI;
     |SI #isom9000#39 = "S";  #isow9008#14 = "X";  |FINSI;
     |SI #isom9000#40 = "S";  #isow9008#15 = "X";  |FINSI;

                              #isow9008#16 = "0";
     |SI #isom9000#41 = "S";  #isow9008#16 = "1";  |FINSI;
     |SI #isom9000#42 = "S";  #isow9008#16 = "2";  |FINSI;

     #isow9008#17 = #isom9000#43;
     #isow9008#18 = #isom9000#38;

     |SI #isom9000#44 = "S";  #isow9008#19 = "X";  |FINSI;

     nCanti = #isom9000#10;  |HAZ Calcula17D;  #isow9008#20 = eaAlfa;
     nCanti = #isom9000#13;  |HAZ Calcula17D;  #isow9008#21 = eaAlfa;
     nCanti = #isom9000#14;  |HAZ Calcula17D;  #isow9008#22 = eaAlfa;

     nCanti = #isom9000#15;  |HAZ Calcula17D;  #isow9008#23 = eaAlfa;
     nCanti = #isom9000#45;  |HAZ Calcula17D;  #isow9008#24 = eaAlfa;
     nCanti = #isom9000#46;  |HAZ Calcula17D;  #isow9008#25 = eaAlfa;
     nCanti = #isom9000#54;  |HAZ Calcula17D;  #isow9008#26 = eaAlfa;
     nCanti = #isom9000#55;  |HAZ Calcula17D;  #isow9008#27 = eaAlfa;
     nCanti = #isom9000#47;  |HAZ Calcula17D;  #isow9008#28 = eaAlfa;
     nCanti = #isom9000#48;  |HAZ Calcula17D;  #isow9008#29 = eaAlfa;
     nCanti = #isom9000#56;  |HAZ Calcula17D;  #isow9008#30 = eaAlfa;
     nCanti = #isom9000#57;  |HAZ Calcula17D;  #isow9008#31 = eaAlfa;
     nCanti = #isom9000#49;  |HAZ Calcula17D;  #isow9008#32 = eaAlfa;
     nCanti = #isom9000#50;  |HAZ Calcula17D;  #isow9008#33 = eaAlfa;
     nCanti = #isom9000#17;  |HAZ Calcula17D;  #isow9008#34 = eaAlfa;
     nCanti = #isom9000#18;  |HAZ Calcula17D;  #isow9008#35 = eaAlfa;
     nCanti = #isom9000#19 * 100;              #isow9008#36 = ("00000" + nCanti) % -105;
     nCanti = #isom9000#58;  |HAZ Calcula17D;  #isow9008#37 = eaAlfa;
     nCanti = #isom9000#20;  |HAZ Calcula17D;  #isow9008#38 = eaAlfa;
     nCanti = #isom9000#21;  |HAZ Calcula17D;  #isow9008#39 = eaAlfa;
     nCanti = #isom9000#22;  |HAZ Calcula17D;  #isow9008#40 = eaAlfa;
     nCanti = #isom9000#23 * 100;              #isow9008#41 = ("00000" + nCanti) % -105;
     nCanti = #isom9000#24;  |HAZ Calcula17D;  #isow9008#42 = eaAlfa;
     nCanti = #isom9000#25;  |HAZ Calcula17D;  #isow9008#43 = eaAlfa;
     nCanti = #isom9000#26 * 100;              #isow9008#44 = ("00000" + nCanti) % -105;
     nCanti = #isom9000#27;  |HAZ Calcula17D;  #isow9008#45 = eaAlfa;
     nCanti = #isom9000#59;  |HAZ Calcula17D;  #isow9008#46 = eaAlfa;
     nCanti = #isom9000#28;  |HAZ Calcula17D;  #isow9008#47 = eaAlfa;
     nCanti = #isom9000#29;  |HAZ Calcula17D;  #isow9008#48 = eaAlfa;
     nCanti = #isom9000#30;  |HAZ Calcula17D;  #isow9008#49 = eaAlfa;
                                                #isow9008#50 = "00000";
     |SI #isom9000#6 ! "A ";
         nCanti = #isom9000#31 * 100;          #isow9008#50 = ("00000" + nCanti) % -105;
     |FINSI;

     nCanti = #isom9000#33;  |HAZ Calcula17D;  #isow9008#51 = eaAlfa;
     nCanti = #isom9000#32;  |HAZ Calcula17D;  #isow9008#52 = eaAlfa;
     nCanti = #isom9000#51;  |HAZ Calcula17D;  #isow9008#53 = eaAlfa;
     nCanti = #isom9000#52;  |HAZ Calcula17D;  #isow9008#54 = eaAlfa;
     nCanti = #isom9000#34;  |HAZ Calcula17D;  #isow9008#55 = eaAlfa;

     nTotal  = #isom9000#14 + #isom9000#34;
     #isow9009#6  = "";
     #isow9009#7  = "";

     #isow9009#8  = "";
     |SI #isom9000#3 > 0;
         #isow9009#8 = "X";
         #isow9009#9 = #isom9000#35;
     |FINSI;

     #isow9008#6  = "N";
     #isow9009#11 = "0";
     |SI nTotal > 0;
         |HAZ FormaPago2014;
     |SINO;
         #isow9009#10 = "X";
     |FINSI;

     #isow9009#15 = #maempr01#77;
     #isow9009#16 = #maempr01#15;

     |PRINT;
|FPRC;

|DEFBUCLE isom9000;
     #isom9000#1;
     ;
     nDEmpresa, #0#33, aPeriodo, 00;
     nHEmpresa, #0#33, aPeriodo, 99;
     e;
     NULL, Imprime;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#35 = 1;  aPeriodo = "1P";  |FINSI;
     |SI #0#35 = 2;  aPeriodo = "2P";  |FINSI;
     |SI #0#35 = 3;  aPeriodo = "3P";  |FINSI;

     Impresora = "CrystalReports";
     |IMPRE -1;
     |SI FSalida ! 0;
         |MENAV "    Error en Impresora";
         |ACABA;
     |FINSI;

     |INFOR "isoy0005";
     |SI FSalida ! 0;
         |MENAV "    Error en Informe";
         |FINIMP;
         |ACABA;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/isom9000.mas";
     |CARGA_DEF  aMas, espejo@;

     |HAZ FechaBonito;

     |ABRE #maempr01;
     |ABRE #maempr11;
     |ABRE #agim0019;
     |ABRE #espejo@;

     |SI #0#0 = "S";
         nDEmpresa = #0#1;
         nHEmpresa = #0#2;
         |BUCLE isom9000;
     |SINO;
         |PARA nCampo = 3; |SI nCampo [ 32; |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo ! 0;
                   nDEmpresa = #0nCampo;
                   nHEmpresa = #0nCampo;
                   |BUCLE isom9000;
               |FINSI;
         |SIGUE;
     |FINSI;

     |CIERRA #espejo@;
     |DESCARGA_DEF #espejo@;

     |CIERRA #agim0019;
     |CIERRA #maempr11;
     |CIERRA #maempr01;

     |PIEINF;
     |FININF;
     |FINIMP;
|FPRC;


|PROGRAMA;
     aParam = PARAMETRO; |QBF aParam;

     |SI aParam = "";
         |MANTE #0;
     |SINO;
         |PULSATECLA;
         aAlfa = aParam % 0105; enEmpresa = aAlfa;
         aAlfa = aParam % 0704; enAnyo    = aAlfa;
         aAlfa = aParam % 1201; aPeriodo  = aAlfa;

         |DDEFECTO #0;
         #0#1  = enEmpresa;
         #0#2  = enEmpresa;
         #0#33 = enAnyo;
         #0#35 = aPeriodo;
         |HAZ Tipo3;
     |FINSI;
|FPRO;
