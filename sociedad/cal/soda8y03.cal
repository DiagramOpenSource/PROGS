|FICHEROS;
     soda8y03 #0;
     sodacoca #1;
     sodacoli #2;
     maacceso #200;
     maempr10 #210;

    :/agicont/def/ca8m0000 #420;
     cubal801 #801;
     cubal802 #802;
     soda8w07 #890;
|FIN;

|VARIABLES;
     &empresa = 0;
     &anyo    = 0;
     &nombre  = "";
     &nif     = "";
     &unid    = "";
     &tipo    = "";
     &hoja1   = 0;
     &eaTitol = "";

     &eaImp1 = "";
     &eaImp2 = "";
     &eaImp3 = "";
     &eaCeros = "";
     &eaICtas = "";

     &eaFich1 = "";
     &eaFich2 = "";
     &eaFich3 = "";

     nNume1   = 0;
     aAlfa1   = "";
     aParam   = "";
     nSw      = 0;
|FIN;

|INCLUYE varbal_i;

|CALCULO ElEjer;
  aAlfa1 = "S";
  |SI #0#0 < 2008;  aAlfa1 = "N"; |FINSI;
  |C_M #0#5,1,aAlfa1;
  |C_M #0#6,1,aAlfa1;
  |C_M #0#7,1,aAlfa1;
  |C_M #0#9,1,aAlfa1;
  |C_M #0#11,1,aAlfa1;
|FCAL;

|CALCULO SituayCta;
  nNume1 = 7; |SI Campo = 6; nNume1 = 9; |FINSI;
  aAlfa1 = #0Campo;
  |C_M #0nNume1,1, aAlfa1;
|FCAL;

|CALCULO LeoBal; |TIPO 6;
  nNume1 = Campo + 1;
  |C_M #0Campo, 0, aAlfa1;
  |SI aAlfa1 = "N";
      #0nNume1 = ""; |PINTA #0nNume1;
      |ACABA;
  |FINSI;

  |ABRE #420;
  #420#0 = #0Campo;
  |LEE 001#420=;
  |SI FSalida ! 0;
      |MENAV "    No existe Balance";
      |ERROR;
  |SINO;
      #0nNume1 = #420#1;
      |PINTA #0nNume1;
  |FINSI;
  |CIERRA #420;
|FCAL;

|CALCULO AntesCtas; |TIPO 7;
  |C_M #0#11, 1, "S";
  |SI #0#5 = "N"; |Y #0#6 = "N";
      |C_M #0#11, 1, "N";
      #0#11 = "N"; |PINTA #0#11;
  |FINSI;
|FCAL;

|| ************************** Lectura de tipo de balances

|PROCESO LeeBal0;
 |ABRE #420;
 #420#0 = nBalNum;
 |LEE 001#420=;
 enTBal   = #420#2;
 aLucratB = #420#3;
 |CIERRA #420
|FPRC;

|PROCESO LeeRes0;
 |ABRE #420;
 #420#0 = nCtaNum;
 |LEE 001#420=;
 enTCta   = #420#2;
 aLucratP = #420#3;
 |CIERRA #420
|FPRC;

|| ************************************************
|PROCESO LeeLasLineas;
 nSw = 1;
 |PRINT;
|FPRC;

|DEFBUCLE LeeLasLineas;
 #2#2;
 ;
 #1#0, #1#1, "            ";
 #1#0, #1#1, "zzzzzzzzzzzz";
 e;
 NULL, LeeLasLineas;
|FIN;

|PROCESO ImpSumasySaldos;
   eaTitol = "ENTRADA DE DATOS CONTABLES AFECTOS AL IS Y CCAA";
   |INFOR "soda8y03";
   |SI FSalida ! 0;
       |ACABA;
   |FINSI;

   nSw = 0;
   |BUCLE LeeLasLineas;
   |SI nSw = 1;
       |PIEINF;
   |FINSI;
   |FININF;
|FPRC;

|PROCESO LeoSodaCoca;

    |ABRE #200;
    #200#0 = #1#0;
    #200#1 = #1#1;
    |LEE 000#200=;
    |SI FSalida ! 0;  |DDEFECTO #200;  |FINSI;
    |CIERRA #200;
    nombre = #200#2;
    nif    = #200#3;
    hoja1  = 1;

    |SI #0#4 = "S";
        |HAZ ImpSumasySaldos;
    |FINSI;

    |SI #0#5 = "S"; |O #0#6 = "S";
        empresa = #1#0;
        anyo    = #1#1;
        eaICtas = #0#11;
        |SUB_EJECUTA_NP "cubal800;BORRADOR";

        eaCeros = #0#3;
        eaImp1  = #0#4;
        eaImp2  = #0#5;
        eaImp3  = #0#6;
        eaICtas = #0#11;
        |SUB_EJECUTA_NP "cubal807;BORRADOR";
    |FINSI;

|FPRC;

|DEFBUCLE LeoSodaCoca;
  #1#1;
  ;
  #0#1, #0#0;
  #0#2, #0#0;
  e;
  NULL, LeoSodaCoca;
|FIN;

|PROCESO pase;  |TIPO 3;
    |IMPRE 0;
    |SI FSalida ! 0;
        |MENAV "    Proceso Interrumpido";
        |ACABA;
    |FINSI;

    nBalNum = #0#7; |HAZ LeeBal0;
    nCtaNum = #0#9; |HAZ LeeRes0;

    eaFich1 = "1s" + Usuario;
    eaFich2 = "1c" + Usuario;
    eaFich3 = "1d" + Usuario;

    |NOME_DAT #801 eaFich1; |DELINDEX #801;
    |NOME_DAT #802 eaFich2; |DELINDEX #802;
    |NOME_DAT #890 eaFich3; |DELINDEX #890;

    |BUCLE LeoSodaCoca;

    |FINIMP;
    |DELINDEX #801;
    |DELINDEX #802;
    |DELINDEX #890;
|FPRC;


|PROGRAMA;

     aParam = PARAMETRO; |QBF aParam;
     |SI aParam = "";
         |MANTE #0;
     |SINO;
         |DDEFECTO  #0;
         #0#0 = anyo;     |C_M #0#0, 1, "N";
         #0#1 = empresa;  |C_M #0#1, 1, "N";
         #0#2 = empresa;  |C_M #0#2, 1, "N";

         #0#3 = eaCeros;
         #0#4 = eaImp1;
         #0#5 = eaImp2;
         #0#6 = eaImp3;
         #0#11 = eaICtas;

         |ABRE #210;
         #210#0 = #0#1;
         #210#1 = #0#0;
         |LEE 000#210=;
         |SI FSalida ! 0;  |DDEFECTO #210;  |FINSI;
         |CIERRA #210;
         #0#7 = #210#101; nBalNum = #0#7; |HAZ LeeBal0; #0#8  = #420#1;
         #0#9 = #210#102; nCtaNum = #0#9; |HAZ LeeRes0; #0#10 = #420#1;

         |HAZ pase;
   |FINSI;
|FPRO;
