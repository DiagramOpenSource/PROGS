|FICHEROS;
      isoy2017;
      maempr10;
      maempr02;
      maempr03;
      maempr04;
      maempr06;
      maempr11;

      isocie00;
      isom0000;
      isom0001;
      isom0002;
      isom0003;
      isom0004;
      isom0005;
      isom0006;
      isom0007;
      isom0009;
      isom0011;
      isom0012;
      isom0016;
      isom0027;
      isom0028;

      isom0500;
      isom0501;
      isom0502;
      isom0503;
      isom0504;
      isom0505;
      isom0507;
      isom0508;
      isom0509;
      isom0516;

      zregpres;

      isoh1701;
      isoh1602;
      isoh16di;

      :/agicli/def/agim0019;
      :/agicont/def/ca8m0000;
|FIN;

|VARIABLES;
     aAlfa          = "";
     aAlfa0         = "";
     aAlfa1         = "";
     aAlfa2         = "";
     aAlfa3         = "";
     aAlfa4         = "";
     aAlfa5         = "";
     aBase          = "";
     aPathPlugins   = "";
     aDirServidor   = "";
     aDirInternet   = "";
     aDirLanza      = "";
     aDocRemoto     = "";
     aDocServidor   = "";
     aDirBase       = "";
     aIPRemoto      = "";
     aDelindex      = "";
     aFicheroAux    = "";
     aFicheroTxt    = "";
     aFicheroPtl    = "";
     aFicheroErr    = "";
     aAbre          = "";
     aAbre1         = "";
     aAbre2         = "";
     aOrigen        = "";
     aDestino       = "";
     aContenido     = "";
     aCNAE          = "";
     aDia           = "";
     aMes           = "";
     aEjerc         = "";
     aPais          = "";
     aCodPais       = "";
     aLong          = "";
     aTecla         = "";
     aRetu          = "";
     aEsc1          = "";
     aEsc2          = "";
     aDesde         = "";
     aHasta         = "";
     aEnlace        = "";
     aHID           = "";
     aPRG           = "";
     aEJF           = "";
     aMOD           = "";
     aIDI           = "";
     aParte1        = "";
     aParte2        = "";
     aDirFotoLocal  = "";
     aFotoGen       = "";
     aFotoBor       = "";
     aFotoErr       = "";
     aFotoSal       = "";
     aFotoPre       = "";
     aCaracter      = "";

     nLong            = 0;
     nNume            = 0;
     nPos             = 0;
     nVal             = 0;
     nVal1            = 0;
     nVal2            = 0;
     nVal3            = 0;
     nVal4            = 0;
     nVal5            = 0;
     nVal1501         = 0;
     nVal1502         = 0;
     nVal1503         = 0;
     nVal1504         = 0;
     nVal1505         = 0;
     nVal1506         = 0;
     nVal1507         = 0;
     nVal1508         = 0;
     nExiste          = 0;
     nSuma            = 0;
     nVent            = 0;
     nVent200         = 0;
     nPanta           = 0;
     nPntPres         = 0;
     nCasilla         = 0;
     nFecha           = 0;
     nCampo           = 0;
     nSwPunto         = 0;
     nCaracter        = 0;
     nContaBucle      = 0;
     nContaBucleL     = 0;
     nComple          = 0;
     nPuntero         = 0;
     nDesde           = 0;
     nHasta           = 0;
     nHay             = 0;
     nTotal           = 0;
     nCanti1          = 0;
     nCanti2          = 0;
     nCanti3          = 0;
     nCanti4          = 0;
     nCantiT          = 0;
     nTecla           = 0;
     nPasada          = 0;
     nHandle          = 0;
     nHandle1         = 0;
     nHandle2         = 0;
     nCalc1           = 0;
     nCalc2           = 0;
     nSwError         = 0;
     nLbl             = 0;
     nCalc            = 0;
     nOk              = 0;

     fFechaD          = @;
     fFechaH          = @;

     {1}aContiene     = "";

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     &enEmpresa       = 0;
     &enAnyo          = 0;
     &enNavieras      = 0;
     &enCooperativa   = 0;
     &enTranspa       = 0;
     &enZEC           = 0;
     &enPeqDimen      = 0;
     &enForales       = 0;
     &enError         = 0;
     &enAviso         = 0;
     &eaError         = "";
     &eaAlfa          = "";
     &enHandle        = 0;
     &enCanti         = 0;
     &enCodCli        = 0;
     &enSwDeDonde     = 0;
     &eaEfectivo      = "";
     &eaAdeudo        = "";
     &eaIBAN           = "";
     &eaBIC            = "";
     &enModelo         = 0;
     &enBanco          = 0;
     &enFormaPag       = 0;
     &enForzar         = 0;
     &eaPathExplorador = "";
     &eaForzExplorador = "";
     &efFechaImpre     = @;
     &eaImpre          = "";
     &eaJusti          = "";
     &eaFinLinea       = "";
     &eaUnidadBasico   = "";
     &enEjercicio      = 0;
     &eaCasilla        = "";
     &enErrorPortal    = 0;
     &eaOrigen         = "";
     &eaDestino        = "";
|FIN;

|PROCESO PonVentana;
     |VENTANA 0501, 2750, -1, 16, "Emisi¢n modelo 200";
     nVent200 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent200;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "LABEL,{{9}}Generando fichero ", 0613, 0749, NULL;
     nLbl = FSalida;

     |PTEC 802;  |PAUSA;  |PULSATECLA;
|FPRC;

|PROCESO QuitaVentana;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent200;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent200;
|FPRC;

|PROCESO TraeDsaeatresp;
     |DBASE aPathPlugins;  |QBT aPathPlugins;
     aPathPlugins = aPathPlugins + "planilla";
     aOrigen      = aPathPlugins   + "/dsaeatresp.exe";
     aDestino     = aDirBase + "dsaeatresp.exe";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CopiaFichero;
     aAlfa = "";
     |IP_REMOTO aAlfa;  |QBT aAlfa;
     |SI aAlfa ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
|FPRC;

|PROCESO AbreSecuencial;
     |DBASE aBase;  |QBF aBase;
     aDirServidor = aBase + "tmp";   |MKDIR aDirServidor;
     aDirServidor = aBase + "tmp/";

     aDirLanza    = eaUnidadBasico + "\AEAT";                         |RMKDIR aDirLanza;
     aDirLanza    = eaUnidadBasico + "\AEAT\200";                     |RMKDIR aDirLanza;
     aDirLanza    = eaUnidadBasico + "\AEAT\200\" + #maempr10#1;           |RMKDIR aDirLanza;
     aDirLanza    = eaUnidadBasico + "\AEAT\200\" + #maempr10#1 + "\";

     aDirBase     = eaUnidadBasico + "\AEAT\200\";

     aDirInternet = eaUnidadBasico + "/AEAT";                         |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET";                |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET/200";            |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET/200/" + #maempr10#1;  |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET/200/" + #maempr10#1 + "\";

     aFicheroAux = (("00000" + #maempr10#0) % -105) + #maempr10#1 + "AUX.txt";
     aFicheroTxt = (("00000" + #maempr10#0) % -105) + #maempr10#1 + ".txt";
     aFicheroErr = "err" + (("00000" + #maempr10#0) % -105) + #maempr10#1 + ".html";

     aAbre       = aDirServidor + aFicheroTxt;
     |XABRE "BW", aAbre, enHandle;
|FPRC;

|PROCESO GrabaPortal;
     eaAlfa = eaAlfa + &13 + &10;
     |XGRABA enHandle, eaAlfa;
|FPRC;

|PROCESO GrabaPortalSin;
     |XGRABA enHandle, eaAlfa;
|FPRC;

|PROCESO GrabaHtml;
     aAbre = aDirServidor + aFicheroPtl;
     |XABRE "WB", aAbre, enHandle;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + aEnlace + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + aHID + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + aIDI + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "LEV" + &34 + " value=" + &34 + "000000000000" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIC" + &34 + " value=" + &34;
     |HAZ GrabaPortalSin;
     |XCIERRA enHandle;

     aDestino   = aDirServidor + aFicheroPtl;
     aOrigen    = aDirServidor + aFicheroAux;

     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre = aDirServidor + aFicheroPtl;
     |XABRE "AB", aAbre, enHandle;

     eaAlfa = &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "RUT" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + aPRG + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + aEJF + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + aMOD + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandle;

     aOrigen  = aDirServidor + aFicheroPtl;
     aDestino = aDirLanza + aFicheroPtl;
     |HAZ CopiaFichero;
|FPRC;

|PROCESO PortalBorrador;
     aFicheroPtl = "bor_" + (("00000" + #maempr10#0) % -105) + ".html";
     aEnlace     = "https://www6.aeat.es/l/zi22zilk0022";
     aEnlace     = "https://www2.agenciatributaria.gob.es/l/zi22zilk0022";

     aHID        = "SOV7200A";
     aPRG        = "";
     aEJF        = "2017";
     aMOD        = "200";

     |SI #isoy2017#6 = "1";  aIDI = "ES";  |FINSI;
     |SI #isoy2017#6 = "2";  aIDI = "VA";  |FINSI;
     |SI #isoy2017#6 = "3";  aIDI = "GL";  |FINSI;
     |SI #isoy2017#6 = "4";  aIDI = "CA";  |FINSI;

     aAlfa = aDirLanza + aFicheroPtl;      |RFBORRA aAlfa;

     |HAZ GrabaHtml;

     eaForzExplorador = "N";
     enEjercicio      = enAnyo;
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + aDestino;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aDestino + &34;
     |FINSI;

     |RSYSTEM aAlfa;
|FPRC;

|PROCESO SacaError;
     nSwError = 0;

     aAbre    = aDirLanza + aFicheroErr;
     |XABRE "C", aAbre, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |PARA; |SI; |HACIENDO;
          |XLEE nHandle,  255, aAlfa;
          |SI FSalida < 0; |SAL; |FINSI;

          aAlfa1 = aAlfa < "";  |QBF aAlfa1;
          aAlfa2 = aAlfa1 - "<title>";
          |SI FSalida ! 0;
              aAlfa2 = aAlfa1 - "error";
              |SI FSalida ! 0; nSwError = 1; |SAL;  |FINSI;

              aAlfa2 = aAlfa1 - "errónea";
              |SI FSalida ! 0; nSwError = 1; |SAL;  |FINSI;
           |FINSI;
     |SIGUE;
     |XCIERRA nHandle;
|FPRC;

|PROCESO Generar;
     aOrigen  = aDirServidor + aFicheroAux;
     aDestino = aDirInternet + aFicheroTxt;
     |HAZ CopiaFichero;

     aAlfa = "0000Se ha generado en " + aDirInternet + " el fichero " + aFicheroTxt;
     aAlfa = aAlfa + " para su presentaci¢n.";
     |MENAV aAlfa;

     eaImpre      = "S";
     efFechaImpre = #isoy2017#1;
|FPRC;

|PROCESO Presentar;
     aOrigen  = aDirServidor + aFicheroAux;
     aDestino = aDirLanza + aFicheroTxt;
     |HAZ CopiaFichero;

     aAlfa = "";
     aLong = aDestino % 0;
     nLong = aLong;
     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (nCaracter * 100) + 1;
           aCaracter = aDestino % nPos;
           |SI aCaracter = "\";
               aCaracter = "\\";
           |FINSI;

           aAlfa = aAlfa + aCaracter;
     |SIGUE;

     aAlfa1  = "https://www1.agenciatributaria.gob.es/static_files";
     aAlfa1  = aAlfa1 + "/common/internet/dep/aplicaciones/ov/servurlp.html";
     aAlfa1  = aAlfa1 + "?WEB=INTERNET&PRG=200&EJE=2017&URL=PIR&EXT=?FIC=";
     aAlfa1  = aAlfa1 + aAlfa;

     aEnlace = aAlfa1;

     aAbre = aDirLanza + "Presenta.html";
     |XABRE "WBC", aAbre, nHandle;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.location = ";
     |HAZ GrabaPortalSin;

     eaAlfa = &34 + aEnlace + &34 + ";";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA nHandle;

     eaForzExplorador = "N";
     enEjercicio      = enAnyo;
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + aAbre;
         aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAbre + &34;
     |FINSI;

     |RSYSTEM aAlfa;
     |PULSATECLA;

     eaImpre      = "S";
     efFechaImpre = #isoy2017#1;
|FPRC;

|PROCESO QuitaPRG;
     aAbre1 = aDirLanza + aFicheroPtl;
     aAbre2 = aDirLanza + "Borrador.html";

     |XABRE "ABC", aAbre1, nHandle1;
     |XABRE "WBC", aAbre2, nHandle2;

     |PARA;  |SI;  |HACIENDO;
           |XLEE nHandle1,  250, aAlfa1;
           |SI FSalida [ 0;  |SAL;  |FINSI;

           aAlfa2 = aAlfa1;
           aAlfa  = aAlfa1 - aPRG;
           |SI FSalida ! 0;
               aAlfa2 = aAlfa;
           |FINSI;

           |XGRABA nHandle2, aAlfa2;
     |SIGUE;

     |XCIERRA nHandle1;
     |XCIERRA nHandle2;
|FPRC;

|PROCESO Borrador;
     aAbre2 = aDirLanza + aFicheroPtl;
     |SI nSwError ! 0;
         |HAZ QuitaPRG;
     |FINSI;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + aAbre2;
     |SINO;
         aAlfa = aAbre2;
     |FINSI;

     aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;

     |RSYSTEM aAlfa;
     |PULSATECLA;
|FPRC;

|PROCESO VerErrores;
     aAlfa1 = aDirLanza + aFicheroErr;
     aAlfa  = eaPathExplorador + " " + aAlfa1;
     aAlfa  = aAlfa - "/";
     |PARA; |SI FSalida ! 0; |HACIENDO;
            nCalc = ((FSalida / 100) ! 0) + 99; aAlfa1 = aAlfa % nCalc;
            nCalc = FSalida + 98;               aAlfa2 = aAlfa % nCalc;
            aAlfa = aAlfa1 + "\" + aAlfa2;
            aAlfa = aAlfa - "/";
     |SIGUE;

     aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |RSYSTEM aAlfa;
|FPRC;

|PROCESO Salir;
     |PTEC 806;
|FPRC;

|PROCESO PresentaResultado;
     |HAZ SacaError;

     |FIN_CONTROL_WINDOWS nLbl;

     |PINPA #0#isom0500;  nPntPres = FSalida;

     |SI nSwError = 0;
         |CONTROL_SIMPLE nPntPres, "LABEL,{{9}}Fichero validado correctamente ", 0602, 0749, NULL;

         |CONTROL_SIMPLE nPntPres, aFotoGen, 0805, 1012, Generar;
         |CONTROL_SIMPLE nPntPres, aFotoPre, 0821, 1028, Presentar;
         |CONTROL_SIMPLE nPntPres, aFotoBor, 0838, 1045, Borrador;
     |FINSI;

     |SI nSwError = 1;
         |CONTROL_SIMPLE nPntPres, "LABEL,{{9}}Fichero con errores ", 0610, 0749, NULL;
         |CONTROL_SIMPLE nPntPres, aFotoErr, 0815, 1022, VerErrores;
         |CONTROL_SIMPLE nPntPres, aFotoBor, 0828, 1035, Borrador;
     |FINSI;

     |CONTROL_SIMPLE nPntPres, aFotoSal, 1342, 1549, Salir;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::";
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aAlfa = aDirLanza + aFicheroErr;       |RFBORRA aAlfa;
     aAlfa = aDirLanza + aFicheroPtl;       |RFBORRA aAlfa;
     aAlfa = aDirLanza + aFicheroTxt;       |RFBORRA aAlfa;
     aAlfa = aDirLanza + "Presenta.html";   |RFBORRA aAlfa;
|FPRC;

|PROCESO PortalValidacion;
     eaForzExplorador = "N";
     enEjercicio      = enAnyo;
     |HAZ Explorador;

     aFicheroPtl = "ptl_" + (("00000" + #maempr10#0) % -105) + ".html";
     aEnlace     = "https://www6.aeat.es/l/zi22zilk0022";
     aEnlace     = "https://www2.agenciatributaria.gob.es/l/zi22zilk0022";

     aHID        = "SOV7200A";
     aPRG        = "PTLINKP0";
     aIDI        = "ES";
     aEJF        = "2017";
     aMOD        = "200";

     |SI #isoy2017#6 = "1";  aIDI = "ES";  |FINSI;
     |SI #isoy2017#6 = "2";  aIDI = "VA";  |FINSI;
     |SI #isoy2017#6 = "3";  aIDI = "GL";  |FINSI;
     |SI #isoy2017#6 = "4";  aIDI = "CA";  |FINSI;

     aAlfa = aDirInternet + aFicheroTxt;  |RFBORRA aAlfa;

     |HAZ GrabaHtml;

     |FIN_CONTROL_WINDOWS nLbl;

     |CONTROL_SIMPLE 0, "LABEL,{{9}}Validando fichero ", 0613, 0749, NULL;
     nLbl = FSalida;

     enErrorPortal = 0;
     |HAZ TraeDsaeatresp;

     || Filtro las '/' por '\'
     aDestino = aDestino - "/";
     |PARA; |SI FSalida ! 0; |HACIENDO;
        nCalc1 = ((FSalida / 100) ! 0) + 99; aParte1 = aDestino % nCalc1;
        nCalc2 = FSalida + 98;               aParte2 = aDestino % nCalc2;
        aDestino = aParte1 + "\" + aParte2;

        aDestino = aDestino - "/";
     |SIGUE;

     aAlfa = aDirLanza + aFicheroErr;  |RFBORRA aAlfa;

     aAlfa  = aDestino + " " + aDirLanza + aFicheroPtl + " " + aDirLanza + aFicheroErr;
     aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |RSYSTEM aAlfa;

     |HAZ PresentaResultado;
|FPRC;

|PROCESO Portal;
     |HAZ PonVentana;

     |SI PARAMETRO = "BORRADOR";
         |HAZ PortalBorrador;
         |HAZ QuitaVentana;
         |ACABA;
     |FINSI;

     aAlfa = aDirInternet + aFicheroAux;   |RFBORRA aAlfa;

     |HAZ PortalValidacion;

     |HAZ QuitaVentana;
|FPRC;

|PROCESO CierraSecuencial;
     |XCIERRA enHandle;

     aAbre      = aDirServidor + aFicheroAux;

     |XABRE "BW", aAbre, enHandle;

     eaAlfa = "<T2000" + #maempr10#1 + "0A0000>";  |HAZ GrabaSecuencial;
     eaAlfa = "<AUX>";       |HAZ GrabaSecuencial;
     eaAlfa = " " * 70;      |HAZ GrabaSecuencial;
     eaAlfa = "1.00";        |HAZ GrabaSecuencial;
     eaAlfa = "    ";        |HAZ GrabaSecuencial;
     eaAlfa = "B53179768";   |HAZ GrabaSecuencial;
     eaAlfa = " " * 213;     |HAZ GrabaSecuencial;
     eaAlfa = "</AUX>";      |HAZ GrabaSecuencial;
     |XCIERRA enHandle;

     aDestino   = aDirServidor + aFicheroAux;
     aOrigen    = aDirServidor + aFicheroTxt;

     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre      = aDirServidor + aFicheroAux;

     |XABRE "BA", aAbre, enHandle;
     eaAlfa = "</T2000" + #maempr10#1 + "0A0000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
     |XCIERRA enHandle;

     |HAZ Portal;

     |SI PARAMETRO = "BORRADOR";
         aAbre = aDirServidor + aFicheroAux;   |FBORRA aAbre;
         |ACABA;
     |FINSI;

     aAlfa = aDirServidor + aFicheroTxt;  |FBORRA aAlfa;
     aAlfa = aDirServidor + aFicheroAux;  |FBORRA aAlfa;
     aAlfa = aDirServidor + aFicheroPtl;  |FBORRA aAlfa;
|FPRC;

|PROCESO maempr03;
     nContaBucle  = nContaBucle + 1;
     #isoh1602#0  = ((nContaBucle / 6) + .49) ! 0;
     nContaBucleL = (nContaBucle + 5) - (6 * #isoh1602#0);

     |LEE 101#isoh1602.=;
     |SI FSalida ! 0;
         |DDEFECTO #isoh1602;
         #isoh1602#0 = ((nContaBucle / 6) + .49) ! 0;

                               #isoh1602#5 = "";
         |SI #isoh1602#0 ! 1;  #isoh1602#5 = "C";  nComple = 1;  |FINSI;

         #isoh1602#2   = "200";
         #isoh1602#3   = "02000";
         #isoh1602#144 = "</T20002000>";

         |GRABA 020#isoh1602.b;
     |FINSI;

     nPuntero     = (nContaBucleL * 6) + 6;
     #isoh1602#nPuntero# = #maempr03#3;

     nPuntero     = nPuntero + 1;
     #isoh1602#nPuntero# = #maempr03#4;

                             aAlfa = "0";
     |SI #maempr03#8 = "X";  aAlfa = "1";  |FINSI;

     nPuntero     = nPuntero + 1;
     #isoh1602#nPuntero# = aAlfa;

     nPuntero     = nPuntero + 1;
     #isoh1602#nPuntero# = #maempr03#5;

     nPuntero     = nPuntero + 1;
     #isoh1602#nPuntero# = #maempr03#6;

     |SI #isoh1701#32 = "1";
         nPuntero     = nPuntero + 1;
         aAlfa        = ("00" + #maempr03#7) % -102;
         #isoh1602#nPuntero# = aAlfa;
     |FINSI;

     |GRABA 020#isoh1602.a;
     |LIBERA #isoh1602;
|FPRC;

|DEFBUCLE maempr03;
     #maempr03#1;
     ;
     #maempr10#0, #maempr10#1, 00;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, maempr03;
|FIN;

|PROCESO maempr06;
     |SI nPasada = 0;
         nVal1501 = nVal1501 + #maempr06#6;
         nVal1502 = nVal1502 + #maempr06#8;
         nVal1503 = nVal1503 + #maempr06#9;
         nVal1504 = nVal1504 + #maempr06#10;
         nVal1505 = nVal1505 + #maempr06#11;
         nVal1506 = nVal1506 + #maempr06#20;
         nVal1507 = nVal1507 + #maempr06#12;
         nVal1508 = nVal1508 + #maempr06#13;

         |ACABA;
     |FINSI;

     nContaBucle  = nContaBucle + 1;
     #isoh1602#0  = ((nContaBucle / 3) + .49) ! 0;
     nContaBucleL = (nContaBucle + 2) - (3 * #isoh1602#0);

     |LEE 101#isoh1602.=;
     |SI FSalida ! 0;
         |DDEFECTO #isoh1602;
         #isoh1602#0     = ((nContaBucle / 3) + .49) ! 0;

                               #isoh1602#5 = "";
         |SI #isoh1602#0 ! 1;  #isoh1602#5 = "C";  nComple = 1;  |FINSI;

         #isoh1602#2   = "200";
         #isoh1602#3   = "02000";
         #isoh1602#144 = "</T20002000>";

         |GRABA 020#isoh1602.b;
     |FINSI;

     nPuntero     = (nContaBucleL * 16) + 42;
     #isoh1602#nPuntero# = #maempr06#3;

     nPuntero     = nPuntero + 1;
     #isoh1602#nPuntero# = #maempr06#4;

     nPuntero     = nPuntero + 1;
     aAlfa        = ("00" + #maempr06#5) % -102;
     #isoh1602#nPuntero# = aAlfa;

     nPuntero     = nPuntero + 1;
     enCanti      = #maempr06#7;
     |HAZ Calcula3E2D;
     #isoh1602#nPuntero# = eaAlfa;

     nPuntero     = nPuntero + 1;
     enCanti      = #maempr06#6;
     |HAZ Calcula17D;
     #isoh1602#nPuntero# = eaAlfa;

     |PARA nCampo = 8;  |SI nCampo [ 11;  |HACIENDO nCampo = nCampo + 1;
           nPuntero  = nPuntero + 1;
           enCanti   = #maempr06#nCampo#;
           |HAZ Calcula17D;
           #isoh1602#nPuntero# = eaAlfa;
     |SIGUE;

     nPuntero  = nPuntero + 1;
     enCanti   = #maempr06#20;
     |HAZ Calcula17D;
     #isoh1602#nPuntero# = eaAlfa;

     |PARA nCampo = 12;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
           nPuntero  = nPuntero + 1;
           enCanti   = #maempr06#nCampo#;
           |HAZ Calcula17D;
           #isoh1602#nPuntero# = eaAlfa;
     |SIGUE;

     |PARA nCampo = 16;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
           nPuntero  = nPuntero + 1;
           enCanti   = #maempr06#nCampo#;
           |HAZ Calcula17D;
           #isoh1602#nPuntero# = eaAlfa;
     |SIGUE;

     |GRABA 020#isoh1602.a;
     |LIBERA #isoh1602;
|FPRC;

|DEFBUCLE maempr06;
     #maempr06#1;
     ;
     #maempr10#0, #maempr10#1, 00;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, maempr06;
|FIN;

|PROCESO maempr02;
     nContaBucle  = nContaBucle + 1;
     #isoh1602#0  = ((nContaBucle / 6) + .49) ! 0;
     nContaBucleL = (nContaBucle + 5) - (6 * #isoh1602#0);

     |LEE 101#isoh1602.=;
     |SI FSalida ! 0;
         |DDEFECTO #isoh1602;
         #isoh1602#0 = ((nContaBucle / 6) + .49) ! 0;

                               #isoh1602#5 = "";
         |SI #isoh1602#0 ! 1;  #isoh1602#5 = "C";  nComple = 1;  |FINSI;

         #isoh1602#3   = "02000";
         #isoh1602#144 = "</T20002000>";

         |GRABA 020#isoh1602.b;
     |FINSI;

     nPuntero     = (nContaBucleL * 7) + 99;
     #isoh1602#nPuntero# = #maempr02#3;

                             aAlfa = "0";
     |SI #maempr02#9 = "X";  aAlfa = "1";  |FINSI;

     nPuntero     = nPuntero + 1;
     #isoh1602#nPuntero# = aAlfa;

     nPuntero     = nPuntero + 1;
     #isoh1602#nPuntero# = #maempr02#4;

     nPuntero     = nPuntero + 1;
     #isoh1602#nPuntero# = #maempr02#5;

     nPuntero     = nPuntero + 1;
     aAlfa        = #maempr02#6;  |QBT aAlfa;
     aAlfa        = ("00" + aAlfa) % -102;
     #isoh1602#nPuntero# = aAlfa;

     nPuntero     = nPuntero + 1;
     enCanti      = #maempr02#7;
     |HAZ Calcula17D;
     #isoh1602#nPuntero# = eaAlfa;

     nPuntero     = nPuntero + 1;
     enCanti      = #maempr02#8;
     |HAZ Calcula3E2D;
     #isoh1602#nPuntero# = eaAlfa;

     |GRABA 020#isoh1602.a;
     |LIBERA #isoh1602;
|FPRC;

|DEFBUCLE maempr02;
     #maempr02#1;
     ;
     #maempr10#0, #maempr10#1, 00;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, maempr02;
|FIN;

|PROCESO isoh1602;
     |PARA nCampo = 1;  |SI nCampo [ 144;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isoh1602#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isoh1602;
     #isoh1602#1;
     ;
     01;
     99;
     ;
     NULL, isoh1602;
|FIN;

|PROCESO Hoja02;
     aDelindex = ("h1" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #isoh1602#aDelindex#;
     |ABRE #isoh1602; |CIERRA #isoh1602; |DELINDEX #isoh1602;

     |ABRE #isoh1602;
     #isoh1602#0 = 1;
     |LEE 101#isoh1602.=;
     |SI FSalida ! 0;
         |DDEFECTO #isoh1602;
         #isoh1602#0   = 1;
         #isoh1602#2   = "200";
         #isoh1602#3   = "02000";
         #isoh1602#5   = "";
         #isoh1602#144 = "</T20002000>";

         |SI #maempr10#73 > 100;  #maempr10#73 = 0;  #maempr10#74 = 0;  |FINSI;
         |SI #maempr10#74 > 100;  #maempr10#73 = 0;  #maempr10#74 = 0;  |FINSI;

         nVal1501 = 0;
         nVal1502 = 0;
         nVal1503 = 0;
         nVal1504 = 0;
         nVal1505 = 0;
         nVal1506 = 0;
         nVal1507 = 0;
         nVal1508 = 0;
         nPasada  = 0;  |BUCLE maempr06;

         enCanti  = nVal1501;  |HAZ Calcula17D; #isoh1602#90 = eaAlfa;
         enCanti  = nVal1502;  |HAZ Calcula17D; #isoh1602#91 = eaAlfa;
         enCanti  = nVal1503;  |HAZ Calcula17D; #isoh1602#92 = eaAlfa;
         enCanti  = nVal1504;  |HAZ Calcula17D; #isoh1602#93 = eaAlfa;
         enCanti  = nVal1505;  |HAZ Calcula17D; #isoh1602#94 = eaAlfa;
         enCanti  = nVal1506;  |HAZ Calcula17D; #isoh1602#95 = eaAlfa;
         enCanti  = nVal1507;  |HAZ Calcula17D; #isoh1602#96 = eaAlfa;
         enCanti  = nVal1508;  |HAZ Calcula17D; #isoh1602#97 = eaAlfa;

         enCanti   = #maempr10#73;
         |HAZ Calcula3E2D;
         #isoh1602#141 = eaAlfa;

         enCanti   = #maempr10#74;
         |HAZ Calcula3E2D;
         #isoh1602#142 = eaAlfa;

         |GRABA 020#isoh1602.n;
         |LIBERA #isoh1602;
     |FINSI;

     nPasada = 1;

     nContaBucle = 0;    |BUCLE maempr03;
     nContaBucle = 0;    |BUCLE maempr06;
     nContaBucle = 0;    |BUCLE maempr02;

     |CIERRA #isoh1602;

     |BUCLE isoh1602;

     |ABRE #isoh1602; |CIERRA #isoh1602; |DELINDEX #isoh1602;
|FPRC;

|PROCESO isom0501;
     |SI #isom0501#2 = "     ";  |ACABA;  |FINSI;

     #isom0002#0 = #maempr10#0;
     #isom0002#1 = #maempr10#1;
     #isom0002#2 = #isom0501#1;
     |LEE 000#isom0002.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0002;  |FINSI;

     enCanti  = #isom0002#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isom0501;
      #isom0501#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0501;
|FIN;

|PROCESO Hoja03;
     eaAlfa = "<T20003000> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0002;
     nDesde = 10;
     nHasta = 260;
     |BUCLE isom0501;
     |CIERRA #isom0002;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20003000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja04;
     eaAlfa = "<T20004000> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0002;
     nDesde = 265;
     nHasta = 420;
     |BUCLE isom0501;
     |CIERRA #isom0002;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20004000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja05;
     eaAlfa = "<T20005000> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0002;
     nDesde = 435;
     nHasta = 665;
     |BUCLE isom0501;
     |CIERRA #isom0002;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20005000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja06;
     eaAlfa = "<T20006000> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0002;
     nDesde = 675;
     nHasta = 805;
     |BUCLE isom0501;
     |CIERRA #isom0002;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20006000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0502;
     |SI #isom0502#2 = "     ";  |ACABA;  |FINSI;

     #isom0003#0 = #maempr10#0;
     #isom0003#1 = #maempr10#1;
     #isom0003#2 = #isom0502#1;
     |LEE 000#isom0003.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0003;  |FINSI;

     enCanti  = #isom0003#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isom0502;
      #isom0502#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0502;
|FIN;

|PROCESO Hoja07;
     eaAlfa = "<T20007000> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0003;
     nDesde = 15;
     nHasta = 270;
     |BUCLE isom0502;
     |CIERRA #isom0003;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20007000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja08;
     eaAlfa = "<T20008000> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0003;
     nDesde = 280;
     nHasta = 495;
     |BUCLE isom0502;
     |CIERRA #isom0003;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20008000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0503;
     |SI #isom0503#2 = "     ";  |ACABA;  |FINSI;

     |SI nPasada = 0;
         |SI #isom0004#3 ! "500  ";  |Y #isom0004#3 ! "355  ";
             |SI #isom0004#5 ! 0;
                  nOk = 1;  |ERROR10;
             |FINSI;
         |FINSI;

         |ACABA;
     |FINSI;

     #isom0004#0 = #maempr10#0;
     #isom0004#1 = #maempr10#1;
     #isom0004#2 = #isom0503#1;
     |LEE 000#isom0004.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0004;  |FINSI;

     enCanti  = #isom0004#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isom0503;
      #isom0503#1;
      ;
      #maempr10#1, 0000;
      #maempr10#1, 9999;
      ;
      NULL, isom0503;
|FIN;

|PROCESO Hoja09;
     |SI #isoh1701#78 = "3";  |ACABA;  |FINSI;

     nOk = 1;
     |SI #isoh1701#78 = "2";
         nOk     = 0;           || Para quitar el valor de la 500
         |ABRE #isom0004;
         nPasada = 0;  |BUCLE isom0503;
         |CIERRA #isom0004;

         |SI nOk = 0;  |ACABA;  |FINSI;
     |FINSI;

     eaAlfa = "<T20009000> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0004;
     nPasada = 1;  |BUCLE isom0503;
     |CIERRA #isom0004;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20009000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0504;
     |SI #isom0504#2 = "     ";  |ACABA;  |FINSI;

     #isom0005#0 = #maempr10#0;
     #isom0005#1 = #maempr10#1;
     #isom0005#2 = #isom0504#1;
     |LEE 000#isom0005.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0005;  |FINSI;

     |SI nPasada = 0;
         |SI #isom0005#5 ! 0;
             nOk = 1;
             |ERROR10;
         |FINSI;

         |ACABA;
     |FINSI;

     enCanti  = #isom0005#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isom0504;
      #isom0504#2;
      ;
      #maempr10#1, aDesde, nDesde;
      #maempr10#1, aHasta, nHasta;
      ;
      NULL, isom0504;
|FIN;

|PROCESO Hoja10;
     nDesde = 5;
     nHasta = 800;

     |SI #isoh1701#78 ! "1";
         |ABRE #isom0005;
         |SELECT #1#isom0005;

         nPasada = 0;
         nOk     = 0;

         aDesde  = "     ";  aHasta = "631";  |BUCLE isom0504;

         |SI nOk = 0;
             aDesde  = "715";    aHasta = "742";  |BUCLE isom0504;
         |FINSI;

         |SI nOk = 0;
             aDesde  = "632";    aHasta = "645";  |BUCLE isom0504;
         |FINSI;

         |CIERRA #isom0005;

         |SI nOk = 0;  |ACABA;  |FINSI;
     |FINSI;

     nPasada = 1;

     eaAlfa = "<T20010000> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0005;
     |SELECT #1#isom0005;

     aDesde = "     ";  aHasta = "631";  |BUCLE isom0504;
     aDesde = "715";    aHasta = "742";  |BUCLE isom0504;
     aDesde = "632";    aHasta = "645";  |BUCLE isom0504;

     |CIERRA #isom0005;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20010000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja11;
     nDesde = 810;
     nHasta = 1545;

     |SI #isoh1701#78 ! "1";
         |ABRE #isom0005;
         |SELECT #1#isom0005;

         nPasada = 0;
         nOk     = 0;

         aDesde = "     ";  aHasta = "631";  |BUCLE isom0504;

         |SI nOk = 0;
             aDesde  = "715";    aHasta = "742";  |BUCLE isom0504;
         |FINSI;

         |SI nOk = 0;
             aDesde  = "632";    aHasta = "645";  |BUCLE isom0504;
         |FINSI;

         |CIERRA #isom0005;

         |SI nOk = 0;  |ACABA;  |FINSI;
     |FINSI;

     nPasada = 1;

     eaAlfa = "<T20011000> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0005;
     |SELECT #1#isom0005;

     aDesde = "     ";  aHasta = "631";  |BUCLE isom0504;
     aDesde = "715";    aHasta = "742";  |BUCLE isom0504;
     aDesde = "632";    aHasta = "645";  |BUCLE isom0504;
     |CIERRA #isom0005;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20011000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO GrabaCasLiq;
     |SELECT #2#isom0001;
     #isom0001#0 = #maempr10#0;
     #isom0001#1 = #maempr10#1;
     #isom0001#3 = eaCasilla;
     |LEE 000#isom0001.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0001;  |FINSI;

     enCanti  = #isom0001#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO GrabaCas1234;
     |ABRE #isom0011;
     |SELECT #2#isom0011;
     #isom0011#0 = #maempr10#0;
     #isom0011#1 = #maempr10#1;
     #isom0011#4 = "517";
     |LEE 000#isom0011.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0011;  |FINSI;
     |SELECT #1#isom0011;
     |CIERRA #isom0011;

     enCanti  = #isom0011#9;
     |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO GrabaCas1200;
     |SELECT #2#isom0001;
     #isom0001#0 = #maempr10#0;
     #isom0001#1 = #maempr10#1;
     #isom0001#3 = "1042";
     |LEE 000#isom0001.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0001;  |FINSI;

     enCanti  = #isom0001#5;

     |SELECT #2#isom0001;
     #isom0001#0 = #maempr10#0;
     #isom0001#1 = #maempr10#1;
     #isom0001#3 = "1333";
     |LEE 000#isom0001.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0001;  |FINSI;

     enCanti  = enCanti;

     |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0500;
     |SI #isom0500#2 = "900  ";  |ACABA;  |FINSI;
     |SI #isom0500#2 = "901  ";  |ACABA;  |FINSI;
     |SI #isom0500#2 = "     ";  |ACABA;  |FINSI;

     #isom0001#0 = #maempr10#0;
     #isom0001#1 = #maempr10#1;
     #isom0001#2 = #isom0500#1;
     |LEE 000#isom0001.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0001;  |FINSI;

     |SI #isom0500#2 ! "558  ";
         enCanti  = #isom0001#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |SINO;
         enCanti  = #isom0001#5;  |HAZ Calcula2E2D; |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0500;
      #isom0500#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0500;
|FIN;

|PROCESO isom0505;
     #isom0006#0 = #maempr10#0;
     #isom0006#1 = #maempr10#1;
     #isom0006#2 = #isom0505#1;
     |LEE 000#isom0006.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0006;  |FINSI;

     |SI #isom0505#2 ! "     ";
         enCanti  = #isom0006#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0505#3 ! "     ";
         enCanti  = #isom0006#7;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0505;
      #isom0505#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0505;
|FIN;

|PROCESO Hoja12;
     eaAlfa = "<T20012000> ";  |HAZ GrabaSecuencial;

     nDesde = 10;
     nHasta = 35;

     |ABRE #isom0001;
     |BUCLE isom0500;
     |CIERRA #isom0001;

     nDesde = 5;
     nHasta = 275;

     |ABRE #isom0006;
     |BUCLE isom0505;
     |CIERRA #isom0006;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20012000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja13;
     eaAlfa = "<T20013000> ";  |HAZ GrabaSecuencial;

     nDesde = 280;
     nHasta = 400;

     |ABRE #isom0006;
     |BUCLE isom0505;
     |CIERRA #isom0006;

     nDesde = 50;
     nHasta = 240;

     |ABRE #isom0001;
     |BUCLE isom0500;
     |CIERRA #isom0001;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20013000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja14;
     eaAlfa = "<T20014000> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0001;

     nDesde = 255;  nHasta = 495;  |BUCLE isom0500;

     |CIERRA #isom0001;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20014000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja14B;
     eaAlfa = "<T20014B00> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0001;

     eaCasilla = "1785"; |HAZ GrabaCasLiq;
     eaCasilla = "1786"; |HAZ GrabaCasLiq;
     eaCasilla = "1787"; |HAZ GrabaCasLiq;
     eaCasilla = "1788"; |HAZ GrabaCasLiq;
     eaCasilla = "1789"; |HAZ GrabaCasLiq;
     eaCasilla = "1790"; |HAZ GrabaCasLiq;
     eaCasilla = "1791"; |HAZ GrabaCasLiq;
     eaCasilla = "1792"; |HAZ GrabaCasLiq;
     eaCasilla = "1793"; |HAZ GrabaCasLiq;
     eaCasilla = "1794"; |HAZ GrabaCasLiq;
     eaCasilla = "1795"; |HAZ GrabaCasLiq;
     eaCasilla = "1796"; |HAZ GrabaCasLiq;
     eaCasilla = "597";  |HAZ GrabaCasLiq;
     eaCasilla = "1797"; |HAZ GrabaCasLiq;
     eaCasilla = "1798"; |HAZ GrabaCasLiq;
     eaCasilla = "1799"; |HAZ GrabaCasLiq;
     eaCasilla = "599";  |HAZ GrabaCasLiq;
     eaCasilla = "600";  |HAZ GrabaCasLiq;
     eaCasilla = "601";  |HAZ GrabaCasLiq;
     eaCasilla = "602";  |HAZ GrabaCasLiq;
     eaCasilla = "603";  |HAZ GrabaCasLiq;
     eaCasilla = "604";  |HAZ GrabaCasLiq;
     eaCasilla = "605";  |HAZ GrabaCasLiq;
     eaCasilla = "606";  |HAZ GrabaCasLiq;
     eaCasilla = "611";  |HAZ GrabaCasLiq;
     eaCasilla = "612";  |HAZ GrabaCasLiq;
     eaCasilla = "615";  |HAZ GrabaCasLiq;
     eaCasilla = "616";  |HAZ GrabaCasLiq;
     eaCasilla = "633";  |HAZ GrabaCasLiq;
     eaCasilla = "642";  |HAZ GrabaCasLiq;
     eaCasilla = "617";  |HAZ GrabaCasLiq;
     eaCasilla = "618";  |HAZ GrabaCasLiq;
     eaCasilla = "619";  |HAZ GrabaCasLiq;
     eaCasilla = "620";  |HAZ GrabaCasLiq;

     |HAZ GrabaCas1234;
     eaCasilla = "083";  |HAZ GrabaCasLiq;
     eaCasilla = "1332"; |HAZ GrabaCasLiq;

     |HAZ GrabaCas1200;
     eaCasilla = "1042"; |HAZ GrabaCasLiq;
     eaCasilla = "1333"; |HAZ GrabaCasLiq;

     eaCasilla = "621";  |HAZ GrabaCasLiq;
     eaCasilla = "622";  |HAZ GrabaCasLiq;

     enCanti  = #isom0000#122;
     |HAZ Calcula17D;  |HAZ GrabaSecuencial;

     eaCasilla = "1020"; |HAZ GrabaCasLiq;
     eaCasilla = "1043"; |HAZ GrabaCasLiq;

     enCanti  = #isom0000#123;
     |HAZ Calcula17D;  |HAZ GrabaSecuencial;

     eaCasilla = "1021"; |HAZ GrabaCasLiq;
     eaCasilla = "1044"; |HAZ GrabaCasLiq;

     |CIERRA #isom0001;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20014B00>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0507;
     #isom0009#0 = #maempr10#0;
     #isom0009#1 = #maempr10#1;
     #isom0009#2 = #isom0507#1;
     |LEE 000#isom0009.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0009;  |FINSI;

     |SI #isom0507#3 ! "     ";
         eaAlfa = #isom0009#4;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0507#4 ! "     ";
        enCanti  = #isom0009#6;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0507#5 ! "     ";
        enCanti  = #isom0009#8;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0507#6 ! "     ";
        enCanti  = #isom0009#10; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0507;
      #isom0507#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0507;
|FIN;

|PROCESO isom0509;
     #isom0012#0 = #maempr10#0;
     #isom0012#1 = #maempr10#1;
     #isom0012#2 = #isom0509#1;
     |LEE 000#isom0012.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0012;  |FINSI;

     |SI #isom0509#2 ! "     ";
         enCanti  = #isom0012#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0509#3 ! "     ";
         |SI #isom0509#3 ! "103  ";
             enCanti  = #isom0012#7;  |HAZ Calcula2E2D; |HAZ GrabaSecuencial;
         |SINO;
             enCanti  = #isom0012#7;  |HAZ Calcula3E4D; |HAZ GrabaSecuencial;
         |FINSI;
     |FINSI;

     |SI #isom0509#4 ! "     ";
         enCanti  = #isom0012#9;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0509#5 ! "     ";
         enCanti  = #isom0012#11; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0509#6 ! "     ";
         enCanti  = #isom0012#13; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0509;
      #isom0509#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0509;
|FIN;

|PROCESO Hoja15;
     nSuma = 0;
     eaCasilla = "670";  |HAZ LeeFich109;  nSuma = nSuma + #isom0009#6;
     eaCasilla = "1048"; |HAZ LeeFich109;  nSuma = nSuma + #isom0009#6;
     eaCasilla = "116";  |HAZ LeeFich112;  nSuma = nSuma + #isom0012#5;
     eaCasilla = "1342"; |HAZ LeeFich112;  nSuma = nSuma + #isom0012#5;
     eaCasilla = "1346"; |HAZ LeeFich112;  nSuma = nSuma + #isom0012#5;

     |SI nSuma = 0;  |ACABA;  |FINSI;

     eaAlfa = "<T20015000> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0009;
     |SELECT #1#isom0009;
     nDesde = 5;    nHasta = 115;   |BUCLE isom0507;
     |CIERRA #isom0009;

     |ABRE #isom0012;
     |SELECT #1#isom0012;
     nDesde = 15;    nHasta = 555;   |BUCLE isom0509;
     |CIERRA #isom0012;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20015000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0508;
     #isom0011#0 = #maempr10#0;
     #isom0011#1 = #maempr10#1;
     #isom0011#2 = #isom0508#1;
     |LEE 000#isom0011.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0011;  |FINSI;

     |SI nPasada = 0;
         |SI #isom0011#5 ! 0;  nSuma = 1;  |ERROR10;  |FINSI;
         |SI #isom0011#7 ! 0;  nSuma = 1;  |ERROR10;  |FINSI;
         |SI #isom0011#9 ! 0;  nSuma = 1;  |ERROR10;  |FINSI;

         |ACABA;
     |FINSI;

     |SI #isom0508#2 = "918  ";
      |O #isom0508#2 = "589  ";
      |O #isom0508#2 = "822  ";
      |O #isom0508#2 = "232  ";
      |O #isom0508#2 = "1123 ";
      |O #isom0508#2 = "1127 ";
      |O #isom0508#2 = "1426 ";
      |O #isom0508#2 = "1430 ";
      |O #isom0508#2 = "1710 ";
      |O #isom0508#2 = "1714 ";
      |O #isom0508#2 = "517  ";
         enCanti  = #isom0011#5;       |HAZ Calcula17D;  |HAZ GrabaSecuencial;
         enCanti  = #isom0011#5 % 80;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
         enCanti  = #isom0011#7;       |HAZ Calcula17D;  |HAZ GrabaSecuencial;
         enCanti  = #isom0011#9;       |HAZ Calcula17D;  |HAZ GrabaSecuencial;

         |ACABA;
     |FINSI;

     |SI #isom0508#2 ! "     ";
         enCanti  = #isom0011#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0508#3 ! "     ";
         enCanti  = #isom0011#7;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0508#4 ! "     ";
         enCanti  = #isom0011#9;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0508;
      #isom0508#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0508;
|FIN;

|PROCESO Hoja16;
     nSuma = 0;
     eaCasilla = "160";  |HAZ LeeFich112;  nSuma = nSuma + #isom0012#5;
     eaCasilla = "131";  |HAZ LeeFich112;  nSuma = nSuma + #isom0012#5;
     eaCasilla = "171";  |HAZ LeeFich112;  nSuma = nSuma + #isom0012#5;
     eaCasilla = "841";  |HAZ LeeFich111;  nSuma = nSuma + #isom0011#5;

     |SI nSuma = 0;  |ACABA;  |FINSI;

     eaAlfa = "<T20016000> ";  |HAZ GrabaSecuencial;

     nPasada  = 1;

     |ABRE #isom0012;
     |SELECT #1#isom0012;
     nDesde = 1010;    nHasta = 1140;   |BUCLE isom0509;
     |CIERRA #isom0012;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 10;    nHasta = 95;    |BUCLE isom0508;
     |CIERRA #isom0011;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20016000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja16B;
     eaCasilla = "764";  |HAZ LeeFich111;  nSuma = #isom0011#5;
     eaCasilla = "886";  |HAZ LeeFich111;  nSuma = nSuma + #isom0011#5;

     |SI nSuma = 0;  |ACABA;  |FINSI;

     nPasada  = 1;

     eaAlfa = "<T20016B00> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 110;   nHasta = 195; |BUCLE isom0508;
     nDesde = 205;   nHasta = 300; |BUCLE isom0508;
     nDesde = 200;   nHasta = 200; |BUCLE isom0508;
     nDesde = 305;   nHasta = 305; |BUCLE isom0508;
     |CIERRA #isom0011;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20016B00>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja17;
     nPasada = 0;
     nSuma   = 0;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 320;   nHasta = 620; |BUCLE isom0508;
     |CIERRA #isom0011;

     |SI nSuma = 0;  |ACABA;  |FINSI;

     nPasada  = 1;

     eaAlfa = "<T20017000> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 320;   nHasta = 620; |BUCLE isom0508;
     |CIERRA #isom0011;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20017000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Punto37;
     #isom0028#0 = #maempr10#0;
     #isom0028#1 = #maempr10#1;
     #isom0028#2 = #isom0516#1;
     |LEE 000#isom0028.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0028;  |FINSI;

     |SI nPasada = 0;
         |SI #isom0028#5  ! 0;  nSuma = 1;  |ERROR10;  |FINSI;
         |SI #isom0028#7  ! 0;  nSuma = 1;  |ERROR10;  |FINSI;
         |SI #isom0028#9  ! 0;  nSuma = 1;  |ERROR10;  |FINSI;
         |SI #isom0028#11 ! 0;  nSuma = 1;  |ERROR10;  |FINSI;

         |ACABA;
     |FINSI;

     |SI #isom0516#3 ! "     ";
         enCanti  = #isom0028#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0516#4 ! "     ";
         enCanti  = #isom0028#7;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0516#5 ! "     ";
         enCanti  = #isom0028#9;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0516#6 ! "     ";
         enCanti  = #isom0028#11;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|PROCESO PuntoNi;
     #isom0027#0 = #maempr10#0;
     #isom0027#1 = #maempr10#1;
     #isom0027#2 = #isom0516#1;
     |LEE 000#isom0027.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0027;  |FINSI;

     |SI nPasada = 0;
         |SI #isom0027#5  ! 0;  nSuma = 1;  |ERROR10;  |FINSI;
         |SI #isom0027#7  ! 0;  nSuma = 1;  |ERROR10;  |FINSI;
         |SI #isom0027#9  ! 0;  nSuma = 1;  |ERROR10;  |FINSI;
         |SI #isom0027#11 ! 0;  nSuma = 1;  |ERROR10;  |FINSI;

         |ACABA;
     |FINSI;

     |SI #isom0516#3 ! "     ";
         enCanti  = #isom0027#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0516#4 ! "     ";
         enCanti  = #isom0027#7;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0516#5 ! "     ";
         enCanti  = #isom0027#9;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0516#6 ! "     ";
         enCanti  = #isom0027#11;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|PROCESO isom0516_01;
     |SI nDesde = 125;  |HAZ Punto37;  |FINSI;
     |SI nDesde = 60;   |HAZ PuntoNi;  |FINSI;
|FPRC;

|DEFBUCLE isom0516_01;
      #isom0516#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0516_01;
|FIN;

|PROCESO Hoja18;
     nPasada = 0;
     nSuma   = 0;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 625;   nHasta = 870; |BUCLE isom0508;
     |CIERRA #isom0011;

     |SI nSuma = 0;  |ACABA;  |FINSI;

     nPasada  = 1;

     eaAlfa = "<T20018000> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 625;   nHasta = 870; |BUCLE isom0508;
     |CIERRA #isom0011;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20018000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja18B;
     nPasada = 0;
     nSuma   = 0;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 885;  nHasta = 950; |BUCLE isom0508;
     |CIERRA #isom0011;

     |SI nSuma = 0;
         |ABRE #isom0028;
         |SELECT #1#isom0028;
         nDesde = 125;   nHasta = 175; |BUCLE isom0516_01;
         |CIERRA #isom0028;
     |FINSI;

     |SI nSuma = 0;
         |ABRE #isom0027;
         |SELECT #1#isom0027;
         nDesde = 60;   nHasta = 115; |BUCLE isom0516_01;
         |CIERRA #isom0027;
     |FINSI;

     |SI nSuma = 0;  |ACABA;  |FINSI;

     nPasada  = 1;

     eaAlfa = "<T20018B00> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 885;  nHasta = 950; |BUCLE isom0508;
     |CIERRA #isom0011;

     |ABRE #isom0028;
     |SELECT #1#isom0028;
     nDesde = 125;   nHasta = 175; |BUCLE isom0516_01;
     |CIERRA #isom0028;

     |ABRE #isom0027;
     |SELECT #1#isom0027;
     nDesde = 60;   nHasta = 115; |BUCLE isom0516_01;
     |CIERRA #isom0027;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20018B00>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Graba107;
     enCanti  = #isom0007#5; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0007#7; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0016;
     |SI #isom0016#2 = 1;  aAlfa1 = #isom0016#3;        |FINSI;
     |SI #isom0016#2 = 2;  aAlfa2 = #isom0016#3;        |FINSI;
     |SI #isom0016#2 = 3;  aAlfa3 = #isom0016#3;        |FINSI;
     |SI #isom0016#2 = 4;  aAlfa4 = #isom0016#3 % 113;  |FINSI;
     |SI #isom0016#2 = 5;  aAlfa4 = #isom0016#3 % 113;  |FINSI;
|FPRC;

|DEFBUCLE isom0016;
     #isom0016#1;
     ;
     #maempr10#0, #maempr10#1, 1;
     #maempr10#0, #maempr10#1, 4;
     ;
     NULL, isom0016;
|FIN;

|PROCESO Hoja19;
     nVal = 0;
     |PARA nCampo = 84;  |SI nCampo [ 105;  |HACIENDO nCampo = nCampo + 1;
           nVal = nVal + #isom0000#nCampo#;
     |SIGUE;

     |SI nVal = 0;
         |ABRE #isom0016;
         #isom0016#0 = #maempr10#0;
         #isom0016#1 = #maempr10#1;
         #isom0016#2 = 1;
         |LEE 000#isom0016.];
         |SI FSalida = 0;  |Y  #isom0016#0 = #maempr10#0;  |Y #isom0016#1 = #maempr10#1;
             nVal = nVal + 1;
         |FINSI;
         |CIERRA #isom0016;
     |FINSI;

     |SI nVal = 0;
         eaCasilla = "417";   |HAZ LeeFich107;  nVal  = nVal + #isom0007#5 + #isom0007#7;
         eaCasilla = "051";   |HAZ LeeFich107;  nVal  = nVal + #isom0007#5 + #isom0007#7;
     |FINSI;

     |SI nVal = 0;  |ACABA;  |FINSI;

     eaAlfa = "<T20019000> ";  |HAZ GrabaSecuencial;

     enCanti  = #isom0000#84;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#85;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#86 + #isom0000#87;
                               |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#88;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;

     enCanti  = #isom0000#89 + #isom0000#90 + #isom0000#91 + #isom0000#92;
     enCanti  = enCanti + #isom0000#125 + #isom0000#126;
                               |HAZ Calcula17D;  |HAZ GrabaSecuencial;

     enCanti  = #isom0000#125; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#126; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#89 + #isom0000#90 + #isom0000#91 + #isom0000#92;
                               |HAZ Calcula17D;  |HAZ GrabaSecuencial;

     enCanti  = #isom0000#93;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#94 + #isom0000#95;
                               |HAZ Calcula17D;  |HAZ GrabaSecuencial;


     enCanti  = #isom0000#96;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#97;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#98;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#100; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#99 + #isom0000#101 + #isom0000#102 + #isom0000#103;
                               |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#104; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#105; |HAZ Calcula17D;  |HAZ GrabaSecuencial;

     eaCasilla = "001";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "003";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "027";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "005";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "029";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "007";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "031";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "009";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "033";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "011";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "035";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "013";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "037";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "015";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "039";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "017";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "041";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "019";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "043";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "021";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "045";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "023";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "047";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "025";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "049";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "417";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "051";  |HAZ LeeFich107;  |HAZ Graba107;

     aAlfa1 = "                      ";
     aAlfa2 = "                      ";
     aAlfa3 = "                      ";
     aAlfa4 = "             ";
     aAlfa5 = "             ";

     nContaBucle  = 0;
     |BUCLE isom0016;

     eaAlfa = aAlfa1;  |HAZ GrabaSecuencial;
     eaAlfa = aAlfa2;  |HAZ GrabaSecuencial;
     eaAlfa = aAlfa3;  |HAZ GrabaSecuencial;
     eaAlfa = aAlfa4;  |HAZ GrabaSecuencial;
     eaAlfa = aAlfa5;  |HAZ GrabaSecuencial;

     eaAlfa = " " * 200;       |HAZ GrabaSecuencial;
     eaAlfa = "</T20019000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Lee201;
     aContenido = "0";

     |DDEFECTO #maempr11;
     #maempr11#0 = #maempr10#0;
     #maempr11#1 = #maempr10#1;
     #maempr11#2 = nCasilla;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         aContenido = "1";
     |FINSI;

     |SI nCasilla = 9;  |Y #maempr11#4 = 0;
         aContenido = "0";
     |FINSI;
|FPRC;

|PROCESO maempr04;
     nContaBucle = nContaBucle + 1;
     |SI nContaBucle = 1;
         #isoh1701#91 = #maempr04#3;
         #isoh1701#92 = #maempr04#4;
         #isoh1701#93 = (#maempr04#5 % -104) + (#maempr04#5 % 402) + (#maempr04#5 % 102);
         #isoh1701#94 = #maempr04#6;
     |FINSI;

     |SI nContaBucle = 2;
         #isoh1701#95 = #maempr04#3;
         #isoh1701#96 = #maempr04#4;
         #isoh1701#97 = (#maempr04#5 % -104) + (#maempr04#5 % 402) + (#maempr04#5 % 102);
         #isoh1701#98 = #maempr04#6;
     |FINSI;

     |SI nContaBucle = 3;
         #isoh1701#99  = #maempr04#3;
         #isoh1701#100 = #maempr04#4;
         #isoh1701#101 = (#maempr04#5 % -104) + (#maempr04#5 % 402) + (#maempr04#5 % 102);
         #isoh1701#102 = #maempr04#6;
     |FINSI;
|FPRC;

|DEFBUCLE maempr04;
     #maempr04#1;
     ;
     #maempr10#0, #maempr10#1, 00;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, maempr04;
|FIN;

|PROCESO TDeclaracion;
     |SI nTotal = 0;
         #isoh1701#6 = "N";
     |FINSI;

     |SI nTotal > 0;
         |SI #isoy2017#0 = "I";  #isoh1701#6 = "I";  |FINSI;
         |SI #isoy2017#0 = "H";  #isoh1701#6 = "I";  |FINSI;
         |SI #isoy2017#0 = "U";  #isoh1701#6 = "U";  |FINSI;
         |SI #isoy2017#2 = "S";  #isoh1701#6 = "G";  |FINSI;
     |FINSI;

     |SI nTotal < 0;
         |SI #isoy2017#5 = "1";  #isoh1701#6 = "D";  |FINSI;
         |SI #isoy2017#5 = "2";  #isoh1701#6 = "D";  |FINSI;
         |SI #isoy2017#5 = "3";  #isoh1701#6 = "R";  |FINSI;
         |SI #isoy2017#2 = "S";  #isoh1701#6 = "V";  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Hoja01;
     |DDEFECTO #isoh1701;

     |HAZ TDeclaracion;

     #isoh1701#7  = #maempr10#3;                   || NIF
     #isoh1701#8  = #maempr10#2;                   || Razon Social
     #isoh1701#9  = "2017";
     #isoh1701#10 = "0A";
     #isoh1701#11 = #maempr10#31 % -104;           || Del A¤o
     #isoh1701#12 = #maempr10#31 % 402;            || Del Mes
     #isoh1701#13 = #maempr10#31 % 102;            || Del Dia
     #isoh1701#14 = #maempr10#32 % -104;           || Al A¤o
     #isoh1701#15 = #maempr10#32 % 402;            || Al Mes
     #isoh1701#16 = #maempr10#32 % 102;            || Al Dia
     |SI #maempr10#31 = "01.01.2017";  |Y #maempr10#32 = "31.12.2017";
         #isoh1701#17 = "1";                    || Todo el Ejercicio
     |SINO;
         fFechaD = #maempr10#31;
         fFechaH = #maempr10#32;
         nFecha  = (fFechaH - fFechaD) + 1;
         |SI nFecha ] 365;
             #isoh1701#17 = "2";                || No coincide con el A¤o Natural
         |SINO;
             #isoh1701#17 = "3";                || No todo el Ejercicio
         |FINSI;
     |FINSI;

     |ABRE #agim0019;
     #agim0019#0 = #maempr10#0;
     #agim0019#1 = 99;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
         |LEE 000#agim0019.a;
     |SINO;
         |LEE 000#agim0019.u;
     |FINSI;
     |CIERRA #agim0019;

     aCNAE = "";
     |SI FSalida = 0;  |Y #agim0019#0 = #maempr10#0;
         aCNAE = #agim0019#40;  |QBF aCNAE;

         |SI aCNAE = "";
             aCNAE = #agim0019#81;  |QBF aCNAE;
         |FINSI;
     |FINSI;

     #isoh1701#18 = aCNAE;                         || CNAE
     #isoh1701#19 = "";                            || Telefono 1
     #isoh1701#20 = "";                            || Telefono 2

     |SI #isoy2017#3 = "S";
         #isoh1701#19 = #maempr10#15;
     |FINSI;

     |ABRE #maempr11;
     nCasilla = 1;   |HAZ Lee201;  #isoh1701#21 = aContenido;
     nCasilla = 2;   |HAZ Lee201;  #isoh1701#22 = aContenido;
     nCasilla = 3;   |HAZ Lee201;  #isoh1701#23 = aContenido;
     nCasilla = 4;   |HAZ Lee201;  #isoh1701#24 = aContenido;
     nCasilla = 5;   |HAZ Lee201;  #isoh1701#25 = aContenido;
     nCasilla = 11;  |HAZ Lee201;  #isoh1701#26 = aContenido;
     nCasilla = 13;  |HAZ Lee201;  #isoh1701#27 = aContenido;
     nCasilla = 14;  |HAZ Lee201;  #isoh1701#28 = aContenido;
     nCasilla = 17;  |HAZ Lee201;  #isoh1701#29 = aContenido;
     nCasilla = 18;  |HAZ Lee201;  #isoh1701#30 = aContenido;
     nCasilla = 19;  |HAZ Lee201;  #isoh1701#31 = aContenido;
     nCasilla = 21;  |HAZ Lee201;  #isoh1701#32 = aContenido;
     nCasilla = 23;  |HAZ Lee201;  #isoh1701#33 = aContenido;
     nCasilla = 24;  |HAZ Lee201;  #isoh1701#34 = aContenido;
     nCasilla = 25;  |HAZ Lee201;  #isoh1701#35 = aContenido;
     nCasilla = 31;  |HAZ Lee201;  #isoh1701#36 = aContenido;
     nCasilla = 32;  |HAZ Lee201;  #isoh1701#37 = aContenido;
     nCasilla = 36;  |HAZ Lee201;  #isoh1701#38 = aContenido;
     nCasilla = 48;  |HAZ Lee201;  #isoh1701#39 = aContenido;
     nCasilla = 58;  |HAZ Lee201;  #isoh1701#40 = aContenido;
     nCasilla = 60;  |HAZ Lee201;  #isoh1701#41 = aContenido;
     nCasilla = 66;  |HAZ Lee201;  #isoh1701#42 = aContenido;
     nCasilla = 6;   |HAZ Lee201;  #isoh1701#43 = aContenido;
     nCasilla = 15;  |HAZ Lee201;  #isoh1701#44 = aContenido;
     nCasilla = 22;  |HAZ Lee201;  #isoh1701#45 = aContenido;
     nCasilla = 28;  |HAZ Lee201;  #isoh1701#46 = aContenido;
     nCasilla = 47;  |HAZ Lee201;  #isoh1701#47 = aContenido;
     nCasilla = 35;  |HAZ Lee201;  #isoh1701#48 = aContenido;
     nCasilla = 49;  |HAZ Lee201;  #isoh1701#49 = aContenido;
     nCasilla = 29;  |HAZ Lee201;  #isoh1701#50 = aContenido;
     nCasilla = 33;  |HAZ Lee201;  #isoh1701#51 = aContenido;
     nCasilla = 34;  |HAZ Lee201;  #isoh1701#52 = aContenido;
     nCasilla = 38;  |HAZ Lee201;  #isoh1701#53 = aContenido;
     nCasilla = 46;  |HAZ Lee201;  #isoh1701#54 = aContenido;
     nCasilla = 12;  |HAZ Lee201;  #isoh1701#55 = aContenido;
     nCasilla = 64;  |HAZ Lee201;  #isoh1701#56 = aContenido;
     nCasilla = 57;  |HAZ Lee201;  #isoh1701#57 = aContenido;
     nCasilla = 20;  |HAZ Lee201;  #isoh1701#58 = aContenido;
     nCasilla = 62;  |HAZ Lee201;  #isoh1701#59 = aContenido;
     nCasilla = 7;   |HAZ Lee201;  #isoh1701#60 = aContenido;
     nCasilla = 9;   |HAZ Lee201;  #isoh1701#61 = aContenido;
     nCasilla = 10;  |HAZ Lee201;  #isoh1701#62 = aContenido;
     nCasilla = 16;  |HAZ Lee201;  #isoh1701#63 = aContenido;
     nCasilla = 26;  |HAZ Lee201;  #isoh1701#64 = aContenido;
     nCasilla = 27;  |HAZ Lee201;  #isoh1701#65 = aContenido;
     nCasilla = 30;  |HAZ Lee201;  #isoh1701#66 = aContenido;
     nCasilla = 39;  |HAZ Lee201;  #isoh1701#67 = aContenido;
     nCasilla = 43;  |HAZ Lee201;  #isoh1701#68 = aContenido;
     nCasilla = 45;  |HAZ Lee201;  #isoh1701#69 = aContenido;
     nCasilla = 63;  |HAZ Lee201;  #isoh1701#70 = aContenido;
     nCasilla = 71;  |HAZ Lee201;  #isoh1701#71 = aContenido;
     nCasilla = 70;  |HAZ Lee201;  #isoh1701#72 = aContenido;
     nCasilla = 59;  |HAZ Lee201;  #isoh1701#73 = aContenido;
     nCasilla = 65;  |HAZ Lee201;  #isoh1701#74 = aContenido;
     nCasilla = 67;  |HAZ Lee201;  #isoh1701#75 = aContenido;
     nCasilla = 72;  |HAZ Lee201;  #isoh1701#76 = aContenido;
     nCasilla = 73;  |HAZ Lee201;  #isoh1701#77 = aContenido;

     |ABRE #ca8m0000;
     |DDEFECTO #ca8m0000;
     #ca8m0000#0 = #maempr10#101;
     |LEE 000#ca8m0000.=;
     #isoh1701#78 = #ca8m0000#2;

     #isoh1701#79 = "0";
     |SI #isoh1701#64 = "0";
         |DDEFECTO #ca8m0000;
         #ca8m0000#0 = #maempr10#102;
         |LEE 000#ca8m0000.=;
         #isoh1701#79 = #ca8m0000#2;
         |CIERRA #ca8m0000;
     |FINSI;

                               #isoh1701#80 = "0";
     |SI #maempr10#113 = "S";  #isoh1701#80 = "1";  |FINSI;

     nCasilla = 9;  |HAZ Lee201;
     #isoh1701#82 = #maempr11#5;
     |SI #maempr11#4 ! 0;
          aAlfa = ("000000" + #maempr11#4) % -106;
          aAlfa = (aAlfa % 104) + "/" + (aAlfa % 502);

          #isoh1701#81 = aAlfa;
     |SINO;
          nCasilla = 10;  |HAZ Lee201;
          |SI #maempr11#4 ! 0;
              aAlfa = ("000000" + #maempr11#4) % -106;
              aAlfa = (aAlfa % 104) + "/" + (aAlfa % 502);

              #isoh1701#81 = aAlfa;
              #isoh1701#83 = #maempr11#5;
          |SINO;
              #isoh1701#82 = "";
          |FINSI;
     |FINSI;

     |CIERRA #maempr11;

     nNume   = #maempr10#75 * 100;
     #isoh1701#84 = ("0000000000" + nNume) % -109;  || Empleados fijos
     nNume   = #maempr10#76 * 100;
     #isoh1701#85 = ("0000000000" + nNume) % -109;  || Empleados si fijos

     #isoh1701#86 = "0";
     #isoh1701#87 = "0000000000000";

     |SI #maempr10#98 = "S";
         #isoh1701#86 = "1";
         aAlfa1  = #maempr10#99;  |QBT aAlfa1;
         aAlfa2  = #maempr10#100; |QBT aAlfa2;
         #isoh1701#87 = ("0000000000000" + aAlfa1 + aAlfa2) % -113;  || N§ Justificante
     |FINSI;

     #isoh1701#88 = #maempr10#77;                          || Nombre Secretario
     #isoh1701#89 = #maempr10#78;                          || NIF    Secretario
     #isoh1701#90 = "00000000";
     |SI #isoh1701#32 = "1";
         #isoh1701#90 = (#isoy2017#1 % -104) + (#isoy2017#1 % 402) + (#isoy2017#1 % 102);
     |FINSI;

     nContaBucle = 0;    |BUCLE maempr04;

     |SI #isoh1701#93  = "        ";  #isoh1701#94  = "00000000";  |FINSI;
     |SI #isoh1701#97  = "        ";  #isoh1701#98  = "00000000";  |FINSI;
     |SI #isoh1701#101 = "        ";  #isoh1701#102 = "00000000";  |FINSI;

     |DDEFECTO #zregpres;
     #zregpres#0 = #maempr10#1;
     |LEE 000#zregpres.=;
     |CIERRA #zregpres;

     #isoh1701#105  = #zregpres#1;
     nNume    = #zregpres#6;  #isoh1701#106 = (("000000000" + nNume) % -109);
     nNume    = #zregpres#7;  #isoh1701#107 = (("000000000" + nNume) % -109);
     #isoh1701#108 = #zregpres#8;

     |PARA nCampo = 1;  |SI nCampo [ 111;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isoh1701#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO HojaDID;
     |DDEFECTO #isoh16di;

     #isoh16di#7  = #maempr10#1;
     |SI #maempr10#31 = "01.01.2017";  |Y #maempr10#32 = "31.12.2017";
         #isoh16di#8 = "1";                    || Todo el Ejercicio
     |SINO;
         fFechaD = #maempr10#31;
         fFechaH = #maempr10#32;
         nFecha  = (fFechaH - fFechaD) + 1;
         |SI nFecha ] 365;
             #isoh16di#8 = "2";                || No coincide con el A¤o Natural
         |SINO;
             #isoh16di#8 = "3";                || No todo el Ejercicio
         |FINSI;
     |FINSI;

     #isoh16di#9  = "0A";                     || Periodo
     #isoh16di#10 = #maempr10#31 % 102;            || Del Dia
     #isoh16di#11 = #maempr10#31 % 402;            || Del Mes
     #isoh16di#12 = #maempr10#31 % -102;           || Del Anyo
     #isoh16di#13 = #maempr10#32 % 102;            || Al Dia
     #isoh16di#14 = #maempr10#32 % 402;            || Al Mes
     #isoh16di#15 = #maempr10#32 % -102;           || Al A¤o
     #isoh16di#16 = #maempr10#3;                   || NIF
     #isoh16di#17 = #maempr10#2;                   || Apellidos o Razon Social

     eaCasilla = "552";  |HAZ LeeFich101;
     enCanti  = #isom0001#5; |HAZ Calcula17D;  #isoh16di#18 = eaAlfa;

     eaCasilla = "562";  |HAZ LeeFich101;
     enCanti  = #isom0001#5; |HAZ Calcula17D;  #isoh16di#19 = eaAlfa;

     eaCasilla = "621";  |HAZ LeeFich101;
     enCanti  = #isom0001#5; |HAZ Calcula17D;  #isoh16di#20 = eaAlfa;
     nTotal   = #isom0001#5 ! 2;

     |ABRE #isocie00;
     #isocie00#0 = #maempr10#0;
     #isocie00#1 = #maempr10#1;
     |LEE 040#isocie00.=;
     |SI FSalida ! 0;  |DDEFECTO #isocie00;  |FINSI;
     |CIERRA #isocie00;

     |SI #isoh1701#61 = "1"; nTotal = 0; |FINSI;
     |SI #isoh1701#62 = "1"; nTotal = 0; |FINSI;

     |SI #isoy2017#2 = "S";
         #isoh16di#6 = "1";

         |SI nTotal < 0;
             #isoh16di#25 = " ";
             enCanti = -nTotal;  |HAZ Calcula17D;  #isoh16di#26 = eaAlfa;
         |FINSI;

         |SI nTotal > 0;
             #isoh16di#29 = " ";
             enCanti  = nTotal; |HAZ Calcula17D;  #isoh16di#31 = eaAlfa;
         |FINSI;
     |SINO;
         |SI nTotal < 0;
             |SI #isoy2017#5 = "1";  #isoh16di#25 = "D";  |FINSI;
             |SI #isoy2017#5 = "2";  #isoh16di#25 = " ";  |FINSI;
             |SI #isoy2017#5 = "3";  #isoh16di#25 = "R";  |FINSI;

             enCanti  = -nTotal;  |HAZ Calcula17D;  #isoh16di#26 = eaAlfa;
             |SI #isoh16di#25 ! "R";
                 #isoh16di#27 = #isocie00#7;
                 #isoh16di#28 = #isocie00#8;
             |FINSI;
         |FINSI;

         |SI nTotal > 0;
             enCanti  = nTotal; |HAZ Calcula17D;  #isoh16di#32 = eaAlfa;
             #isoh16di#29 = #isoy2017#0;
             |SI #isoy2017#0 ! "H";
                 #isoh16di#33 = #isocie00#7;
             |FINSI;
         |FINSI;

         |SI nTotal = 0;
             #isoh16di#36 = "1";
         |FINSI;
     |FINSI;

     eaCasilla = "150";  |HAZ LeeFich101;
     enCanti  = #isom0001#5; |HAZ Calcula17D;  #isoh16di#34 = eaAlfa;

     eaCasilla = "506";  |HAZ LeeFich101;
     enCanti  = #isom0001#5; |HAZ Calcula17D;  #isoh16di#35 = eaAlfa;

     #isoh16di#30 = "";
     #isoh16di#31 = "";
     #isoh16di#37 = "";

     |PARA nCampo = 1;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isoh16di#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
     nTecla = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVent;

     |SI nTecla = 7;  |ACABA;  |FINSI;

     aDia   = #isoy2017#1 % 102;
     aMes   = #isoy2017#1 % 402;
     aEjerc = #isoy2017#1 % -104;

     |SI aMes = "01"; aMes = "Enero     "; |FINSI;
     |SI aMes = "02"; aMes = "Febrero   "; |FINSI;
     |SI aMes = "03"; aMes = "Marzo     "; |FINSI;
     |SI aMes = "04"; aMes = "Abril     "; |FINSI;
     |SI aMes = "05"; aMes = "Mayo      "; |FINSI;
     |SI aMes = "06"; aMes = "Junio     "; |FINSI;
     |SI aMes = "07"; aMes = "Julio     "; |FINSI;
     |SI aMes = "08"; aMes = "Agosto    "; |FINSI;
     |SI aMes = "09"; aMes = "Septiembre"; |FINSI;
     |SI aMes = "10"; aMes = "Octubre   "; |FINSI;
     |SI aMes = "11"; aMes = "Noviembre "; |FINSI;
     |SI aMes = "12"; aMes = "Diciembre "; |FINSI;
     aMes = aMes > aMes;

     |ABRE #isom0000;
     #isom0000#0 = #maempr10#0;
     #isom0000#1 = #maempr10#1;
     |LEE 000#isom0000.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0000;  |FINSI;
     |CIERRA #isom0000;

     |HAZ AbreSecuencial;
     |HAZ Hoja01;
     |HAZ Hoja02;
     |HAZ Hoja03;
     |HAZ Hoja04;
     |HAZ Hoja05;
     |HAZ Hoja06;
     |HAZ Hoja07;
     |HAZ Hoja08;
     |HAZ Hoja09;
     |HAZ Hoja10;
     |HAZ Hoja11;
     |HAZ Hoja12;
     |HAZ Hoja13;
     |HAZ Hoja14;
     |HAZ Hoja14B;
     |HAZ Hoja15;
     |HAZ Hoja16;
     |HAZ Hoja16B;
     |HAZ Hoja17;
     |HAZ Hoja18;
     |HAZ Hoja18B;
     |HAZ Hoja19;
     |HAZ Hoja20;
     |HAZ Hoja20B;
     |HAZ Hoja20C;
     |HAZ Hoja21;
     |HAZ Hoja22;
     |HAZ Hoja23;
     |HAZ Hoja24;
     |HAZ Hoja25;
     |HAZ Hoja26;
     |HAZ HojaDID;

     |HAZ CierraSecuencial;
|FPRC;

|PROGRAMA;
||     |MENAV "0000A£n no se ha abierto el portal del 2017.";
||     |ACABA;

     |HAZ LeeUnidadBasico;

     efFechaImpre = "01.01.0000";
     eaImpre    = "N";
     eaJusti    = "";
     eaFinLinea = &13 + &10;
     eaFinLinea = "";

     |SI PARAMETRO ! "BORRADOR";
         enError = 0;
         |SUB_EJECUTA_NP "isoz0002;CHEQUEOEMISION";
         |SI enError ! 0;
             |MENAV "0000Hay errores graves, no puedo emitir el modelo.";
             |ACABA;
         |FINSI;

         |SI enAviso ! 0;
             |CONFI "0000SHay errores leves, quiere emitir de todas formas";
             |SI FSalida ! 0;  |ACABA;  |FINSI;
         |FINSI;
     |FINSI;

     |ABRE #maempr10;
     #maempr10#0 = enEmpresa;
     #maempr10#1 = enAnyo;
     |LEE 000#maempr10.=;
     |SI FSalida ! 0;  |CIERRA #maempr10;  |ACABA; |FINSI;
     |CIERRA #maempr10;

     |C_M #isoy2017#0, 1, "N";
     |C_M #isoy2017#5, 1, "N";
     eaCasilla = "621";  |HAZ LeeFich101;
     nTotal   = #isom0001#5;

     |SI nTotal > 0;
         |C_M #isoy2017#0, 1, "S";

         |ABRE #isocie00;
         #isocie00#0 = #maempr10#0;
         #isocie00#1 = #maempr10#1;
         |LEE 040#isocie00.=;
         |SI FSalida ! 0;  |DDEFECTO #isocie00;  |FINSI;
         |CIERRA #isocie00;

                                            #isoy2017#0 = "H";
         |SI #isocie00#5 ! "          ";    #isoy2017#0 = "I";  |FINSI;
     |FINSI;

     |SI nTotal < 0;
         |C_M #isoy2017#5, 1, "S";

         #isoy2017#5 = "1";
         |SI #maempr10#34 = "S";  #isoy2017#5 = "3";  |FINSI;
     |FINSI;

     aAlfa =  "Emisi¢n modelo 200 (" + (("00000" + #maempr10#0) % -105) + " / " + #maempr10#1 + " " + #maempr10#2;
     |QBF aAlfa;
     aAlfa = aAlfa + ")";
     |VENTANA 0501, 2799, -1, 16, aAlfa;
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#isoy2017;
     |PINDA #0#isoy2017;

     |ENDATOS #1#isoy2017;

     |PULSATECLA;
|FPRO;

|PROCESO LeeImagenes;
     |DBASE aBase;

     eaOrigen     = aBase  + "planilla/aeat_imagenes.tgz";
     eaDestino    = aDirFotoLocal + "aeat_imagenes.tgz";
     |HAZ EnviaFicheroConMD5;

     aAlfa = aDirFotoLocal + "aeat_imagenes.tgz";
     Pos   = -1;
     |RDESCOMPRIME aAlfa;

     aAlfa1 = aDirFotoLocal;
     |RDETAR aAlfa, aDirFotoLocal;

     aAlfa = aDirFotoLocal + "aeat_imagenes.tar";
     |RFBORRA aAlfa;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;

     aDirFotoLocal = aContiene1;
     aDirFotoLocal = aDirFotoLocal + "botones";   |RMKDIR aDirFotoLocal;
     aDirFotoLocal = aDirFotoLocal + "\";

     |HAZ LeeImagenes;

     aFotoGen = "IMAGEN," + aDirFotoLocal + "aeat_generar.bmp";
     aFotoBor = "IMAGEN," + aDirFotoLocal + "aeat_borrador.bmp";
     aFotoErr = "IMAGEN," + aDirFotoLocal + "aeat_errores.bmp";
     aFotoSal = "IMAGEN," + aDirFotoLocal + "aeat_salir.bmp";
     aFotoPre = "IMAGEN," + aDirFotoLocal + "aeat_presentar.bmp";

     |PULSATECLA;

     FSalida = 1899;
|FPRC;
