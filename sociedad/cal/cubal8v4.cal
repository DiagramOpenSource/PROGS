|FICHEROS;
  cubal8v4 #0;

  cubal804 #4;
  soda8m02 #1;
  soda8m03 #2;
  soda8tli #11;
  soda8tco #12;

  imagen@ #900;
  soda8w02 #999;
|FIN;

|VARIABLES;
   &empresa = 0;
   &anyo    = 0;
   &nombre  = "";
   &nif     = "";
   &tipo    = "";
   &unid    = "";
   &modo    = 0;
   &sw_mod  = 0;
   anyo1    = 0;
   anyo2    = 0;
   nSeguir  = 0;
   inkey     = 0;

   aAlfa1    = "";
   aAlfa2    = "";
   nNume1    = 0;
   nNume2    = 0;
   nNumC1    = 0;
   nNumC2    = 0;
   nNumC3    = 0;
   nValor1   = 0;
   nValor2   = 0;
   nValor3   = 0;
   nValor4   = 0;
   nColum    = 0;
   nNoExiste = 0;
   nBoton1   = 0;
   nBoton2   = 0;
   nBoton3   = 0;
   nTecla    = 0;
   nModoEntrada = 0;
   aMas      = "";
   aDef      = "";
   &enCam2   = 0;
   &eaCam3   = "";
   &enCam4   = 0;
   &enCam5   = 0;
   &enCam6   = 0;
   &eaCam8   = "";
   &eaCam9   = "";
   &eaCam10  = "";
   &eaCam11  = "";
   informe   = "cubal8v4";
   &enSwCero = 0;

   &nIntTodo = 0;
   avisos   = "";
   alfa1    = "";
   nume1    = 0;
   nume2    = 0;
|FIN;

|INCLUYE varbal_i;

|PROCESO Alta4;
 #4#0 = empresa;
 #4#1 = anyo;
 #4#2 = 001;
|FPRC;

|PROCESO Baja4;
 #4#0 = empresa;
 #4#1 = anyo;
 #4#2 = 999;
|FPRC;

|PROCESO Cons_bal4;
   |ABRE #4;
   |CONSULTA_F_CLAVE #1#4, Alta4, Baja4;
   |CIERRA #4;
|FPRC;

|PROCESO LeeImagen;
 enCam2 = #900#2;
 eaCam3 = #900#3;
 enCam4 = #900#4;
 enCam5 = #900#5;
 enCam6 = #900#6;
 eaCam8 = #900#8;
 eaCam9 = #900#9;
 eaCam9 = ("000" + eaCam9) % -103;

 |ABRE #12;
 |DDEFECTO #12;
 #12#5 = enEjerBal;
 #12#0 = nBalNum;
 #12#1 = #900#5;
 |LEE 001#12=;
 |CIERRA #12;
 eaCam11 = #12#2;

 |ABRE #11;
 |DDEFECTO #11;
 #11#8 = enEjerBal;
 #11#0 = nBalNum;
 #11#1 = #900#4;
 |LEE 001#11=;
 |CIERRA #11;
 eaCam10 = #11#2;

 |PRINT;
|FPRC;

|DEFBUCLE LeeImagen;
 #900#1003;
 ;
 empresa, anyo, 0001;
 empresa, anyo, 9999;
 e;
 NULL, LeeImagen;
|FIN;

|PROCESO Imprimir;

   |IMPRE 0;
   |SI FSalida ! 0;
       |ACABA;
   |FINSI;

   |INFOR informe;
   |SI FSalida ! 0;
       |MENAV "    No existe informe";
       |FINIMP;
       |ACABA;
   |FINSI;

   |BUCLE LeeImagen;

   |PIEINF;
   |FININF;
   |FINIMP;
|FPRC;

|PROCESO Inferior0;
 #0#0 = empresa;
 #0#1 = anyo;
 #0#2 = 0001;
|FPRC;

|PROCESO Superior0;
 #0#0 = empresa;
 #0#1 = anyo;
 #0#2 = 9999;
|FPRC;

|PROGRAMA;
 |DBASS aMas;
 aDef = aMas + "sociedad/def/cubal8v4";
 |CARGA_DEF aDef, imagen@;
 |SI FSalida ! 0; |ACABA; |FINSI;

 |C_A #12#2, 1, 30;
 nBalance = 3; ||Estado de Cambios del Patrimonio Neto
 |PINPA #0#0;
 |HAZ pintaany;
 |HAZ pidedato;

 |ENTLINEAL #1#0, -3, modo, 21, 0, Inferior0, Superior0;

 |DESCARGA_DEF #900;
 enSwCero = 1;
 |HAZ ElCalFinal804;
|FPRO;

|PROCESO pidedato;
 |ABRE #4;
 #4#0 = empresa;
 #4#1 = anyo;
 #4#2 = 000;
 |LEE 001#4];
 |SI FSalida ! 0; |O #4#0 ! empresa; |O #4#1 ! anyo;
     |CIERRA #4;
     |HAZ eCrearVacio;
     |CIERRA #4;
 |FINSI;
 |CIERRA #4;
|FPRC;

|PROCESO pintaany;
 anyo2 = anyo - 1;
 anyo1 = anyo;
 |ATRI P; |PINTA 975, anyo1; |ATRI 0;
|FPRC;

|PROCESO ImprTextos;
  |C_A #1#6, 1, 40;   |PINTA 1106, #1#6;
  |C_A #12#2, 1, 30;  |PINTA 1048, #12#2;
            |ATRI P;  |PINTA 1148, "Importe en el ECPN: "; |ATRI 0;
  #999#1 = nValor1;   |PINTA 1168, #999#1;
|FPRC;

|PROCESO LeeValorCasilla;
 nValor1 = 0;             || Lee la Casilla ahora
 nValor2 = 0;
 nValor3 = 0;

 nColum = #0#5;
 nNumC1 = nColum + 5;
 nNumC2 = nColum + 18;
 nNumC3 = nColum + 30;

 |ABRE #4;
 |DDEFECTO #4;
 #4#0 = #0#0;
 #4#1 = #0#1;
 #4#2 = #0#4;
 |LEE 001#4=;
 |SI FSalida = 0;
     nValor1 = #4nNumC1;
     nValor2 = #4nNumC2;
     nValor3 = #4nNumC3;
 |FINSI;
 |CIERRA #4;
|FPRC;

|PROCESO LeeColumna;
 |ABRE #12;
 |DDEFECTO #12;
 #12#5 = enEjerBal;
 #12#0 = nBalNum;
 #12#1 = #0#5;
 |LEE 001#12=;
 |CIERRA #12;
|FPRC;

|PROCESO LeeDefinicion;
 nNoExiste = 0;
 |ABRE #1;
 |DDEFECTO #1;
 #1#34 = enEjerBal;
 #1#0 = nBalNum;
 #1#1 = #0#4;
 |LEE 001#1=;
 |SI FSalida ! 0;
     nNoExiste = 1;
 |FINSI;
 |CIERRA #1;
|FPRC;

|CALCULO Tipo7; |TIPO 7;
  nModoEntrada = (FEntrada / 100) ! 0;
  |SI nModoEntrada < 2;
      #1#6 = ""; #12#2 = "";
      nValor1= 0; nValor2 = 0; nValor3 = 0;
  |SINO;
      |HAZ LeeDefinicion;
      |HAZ LeeColumna;
      |HAZ LeeValorCasilla;
  |FINSI;
  |HAZ ImprTextos;

  |BLIN 22;
  |CONTROL_SIMPLE 0, "BOTON,F2 Con.Estado Cambios P.Neto", 2235, 2258, Boton1;
  nBoton1 = FSalida;
  |CONTROL_SIMPLE 0, "BOTON,F3 Imprimir Variaciones", 2260, 2278, Boton2;
  nBoton2 = FSalida;
|FCAL;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROCESO Boton2;
     |PTEC 825;
|FPRC;

|PROCESO Tipo0;  |TIPO 0;
     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |PULSATECLA;
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
     nTecla = FSalida;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |PULSATECLA;

     |SI nTecla ] 10; |Y nTecla [ 12;
         |SI nTecla = 12;
             |BLIN 22;
             |PINTA 2202, " Actualizando las variaciones en el Estado de Cambios Pat. Neto";
             enSwCero = 1;
             |HAZ ElCalFinal804;
             nTecla = 10;
         |FINSI;
         |SI nTecla = 10;  |HAZ Cons_bal4; |FINSI;
         |SI nTecla = 11;  |HAZ Imprimir; |FINSI;
         |ERROR;
         |HAZ Tipo7;
    |FINSI;
|FPRC;

|PROCESO Alta11;
 #11#8 = enEjerBal;
 #11#0 = nBalNum;
 #11#1 = 1;
|FPRC;

|PROCESO Baja11;
 #11#8 = enEjerBal;
 #11#0 = nBalNum;
 #11#1 = 999;
|FPRC;

|PROCESO Alta12;
 #12#5 = enEjerBal;
 #12#0 = nBalNum;
 #12#1 = 1;
|FPRC;

|PROCESO Baja12;
 #12#5 = enEjerBal;
 #12#0 = nBalNum;
 #12#1 = 12;
|FPRC;

|CALCULO elTipo0; |TIPO 0;
  inkey = FSalida;
  |SI inkey = 10;
      |ABRE #11;
      #11#1 = #0#4;
      |CONSULTA_F_CLAVE #1#11, Alta11, Baja11;
      #0#4 = #11#1; |PINTA #0#4;
      |CIERRA #11;
  |FINSI;
  |HAZ LeeDefinicion;
  |SI nNoExiste = 1;
      |MENAV "    No existe la Definicion.";
      |ERROR;
      |ACABA;
  |FINSI;
  #0#8 = #1#2; |PINTA #0#8;
  #0#9 = #1#3; |PINTA #0#9;
  |HAZ LeeValorCasilla;

  nValor1 = nValor1 + #0#6;  ||ya lo ha restado anteriormente

  |HAZ ImprTextos;
|FCAL;

|CALCULO LaCol; |TIPO 0;
  inkey = FSalida;
  |SI inkey = 2; |ACABA; |FINSI;
  |SI inkey = 10;
      |ABRE #12;
      #12#5 = enEjerBal;
      #12#1 = #0#5;
      |CONSULTA_F_CLAVE #1#12, Alta12, Baja12;
      #0#5 = #12#1; |PINTA #0#5;
      |CIERRA #12;
  |FINSI;
  |HAZ LeeColumna;
  |PINTA 1048, #12#2;

   nColum = #0#5;
   nNume1 = nColum + 6;
   |SI #1nNume1 = "X";
       |MENAV "    Linea - Columna del Balance No Activa ";
       |ERROR;
   |SINO;
       |HAZ LeeValorCasilla;
       nValor1 = nValor1 + #0#6;  ||ya lo ha restado anteriormente
       |HAZ ImprTextos;
   |FINSI;
|FCAL;

|CALCULO Tipo3; |TIPO 3;
 |SI #0#8 = " "; |O #0#9 = 0;
     |MENAV "   Error. Falta Informar Apartado y Casilla de las Ctas Anuales";
     |ERROR;
     |ACABA;
 |FINSI;
|FCAL;

|PROCESO color_f;
   |COLOR 4, 0;
   |ATRI 0;
|FPRC;

|PROCESO color_c;
   |COLOR 14, 0;
   |ATRI 0;
|FPRC;

|PROCESO avisos;         || desde calculo 'c_importe' (camaasil)
   |PUSHV  12311459;
   |BLANCO 12311459;
   |HAZ color_f;
   |CUADRO 1231 1458;
||   |HAZ color_c;

   |PINTA  1332, avisos;
   |ATRI 0;
   |AVISO;
|FPRC;

|CALCULO QueIntro; |TIPO 7;
   |SI nIntTodo = 1;
       |MENSA "    <F2> Cambiar para introducir Imp.Variacion";
       #0#6 = nValor1; |PINTA #0#6;
       avisos = "      IMPORTE CASILLA     ";
   |SINO;
       |MENSA "    <F2> Cambiar para introducir Imp.Casilla";
       avisos = "     IMPORTE VARIACION    ";
   |FINSI;

   |HAZ avisos;
|FCAL;

|CALCULO QueSale; |TIPO 0;
   |POPV;

   |SI FSalida = 10;
       |SI nIntTodo = 0;
           nIntTodo = 1;
       |SINO;
           nIntTodo = 0;
           #0#6 = nValor1 - nValor2 - nValor3;
       |FINSI;
       |HAZ QueIntro;
       |ERROR;
       |ACABA;
   |FINSI;

   |SI nIntTodo = 1;
       nValor4 = #0#6 - nValor2 - nValor3;
       nValor1 = #0#6;
       #0#6  = nValor4;  |PINTA #0#6;
       #999#1 = nValor1; |PINTA 1168, #999#1;
   |FINSI;
|FCAL;

|CALCULO Tipo2; |TIPO 2;
 nModoEntrada = (FEntrada / 100) ! 0;

 nColum = #0#5;
 nNume1 = nColum + 6;
 |SI #1nNume1 = "X"; |ACABA; |FINSI;
 |ABRE #4;
 #4#0 = #0#0;
 #4#1 = #0#1;
 #4#2 = #0#4;
 |LEE 101#4=;
 |SI FSalida = 0;
     nNume1 = nColum + 30;
     #4nNume1 = #4nNume1 +. #0#6;
     |GRABA 020#4a;
 |FINSI;
 |LIBERA #4;
 |CIERRA #4;

 enSwCero = 2;
 |HAZ ElCalFinal804;
|FCAL;
