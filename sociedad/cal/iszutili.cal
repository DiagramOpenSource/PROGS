|FICHEROS;
     isocie30 #30;
     isocie06 #6;
     isocie38 #38;
     isocie09 #9;
     isocie63 #63;
     isocie70 #70;
     isocie68 #68;
     isocie69 #69;
     isocie73 #73;
     isocie75 #75;
     ism00001 #1;
     ism00002 #2;
     isacceso #0;
     isyycasi #3;
|FIN;

|VARIABLES;
      nLinea   = 0;
      nAgru    = 0;
      nConc    = 0;
      nEmpresa = 0;
      nAnyo    = 0;
      nSwEsta  = 0;

      &eParametro = "";
      &empresa    = 0;
      &anyo       = 0;
      &enError    = 0;

      aAlfa       = "";
      &enAnyo     = 0;
      nNegro      = 0;
      nVerde      = 0;
      nAzul       = 0;
      nRojo       = 0;
      nTodos      = 0;
      &eaTNegro   = "";
      &eaTAzul    = "";
      &eaTRojo    = "";
      &eaTVerde   = "";
      &eaTTodos   = "";

      &eaAzul    = "";
      &eaRojo    = "";
      &eaVerde   = "";
|FIN;

|PROCESO CogeNuevo;
     #70#0 = nEmpresa;
     #70#1 = nAnyo;
     #70#2 = 99;
     |LEE 040#70];
     |SI FSalida = 0;
         |LEE 040#70a;
     |SINO;
         |LEE 040#70u;
     |FINSI;

     nLinea = 1;
     |SI FSalida = 0;  |Y #70#0 = nEmpresa;  |Y #70#1 = nAnyo;
         nLinea = #70#2 + 1;
     |FINSI;
|FPRC;

|PROCESO Pasa70_30;
     nAgru    = 0;
     nConc    = 0;
     nEmpresa = #30#0;
     nAnyo    = #30#1;

     |SI #30#3 = 94;
         |SI #30#9 = 1;  nAgru = 1;  nConc = 1;  |FINSI;
         |SI #30#9 = 2;  nAgru = 1;  nConc = 2;  |FINSI;
         |SI #30#9 = 3;  nAgru = 1;  nConc = 3;  |FINSI;
     |FINSI;

     |SI #30#3 = 95;
         |SI #30#9 = 1;  nAgru = 1;  nConc = 5;  |FINSI;
         |SI #30#9 = 2;  nAgru = 1;  nConc = 6;  |FINSI;
         |SI #30#9 = 3;  nAgru = 1;  nConc = 7;  |FINSI;
     |FINSI;

     |SI #30#3 = 96;
         |SI #30#9 = 1;  nAgru = 2;  nConc = 1;  |FINSI;
         |SI #30#9 = 4;  nAgru = 1;  nConc = 9;  |FINSI;
     |FINSI;

     |SI #30#3 = 97;
         |SI #30#9 = 1;  nAgru = 2;  nConc = 2;  |FINSI;
     |FINSI;

     |SI #30#3 = 98;
         |SI #30#9 = 1;  nAgru = 2;  nConc = 4;  |FINSI;
         |SI #30#9 = 2;  nAgru = 2;  nConc = 4;  |FINSI;
         |SI #30#9 = 3;  nAgru = 2;  nConc = 4;  |FINSI;
     |FINSI;


     |SI nAgru = 0; |Y nConc = 0;  |ACABA;  |FINSI;

     #2#7 = anyo;
     #2#0 = nAgru;
     #2#1 = nConc;
     |LEE 040#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ CogeNuevo;

     |DDEFECTO #70;
     #70#0  = #30#0;
     #70#1  = #30#1;
     #70#2  = nLinea;
     #70#3  = #2#0;
     #70#4  = #2#2;
     #70#5  = #2#1;
     #70#6  = #2#3;
     #70#7  = #2#4;
     #70#8  = #2#5;
     #70#9  = #2#6;
     #70#10 = #30#7;
     #70#11 = #30#7;
     #70#12 = #30#5;
     |GRABA 020#70n;
     |LIBERA #70;
|FPRC;

|DEFBUCLE isocie30;
     #30#1;
     ;
     00001, 1999, 00;
     99999, 1999, 99;
     ;
     NULL, Pasa70_30;
|FIN;

|PROCESO Pasa70_06;
     nAgru    = 0;
     nConc    = 0;
     nEmpresa = #6#0;
     nAnyo    = #6#1;

     |SI #6#3 = "PM";
         nAgru = 2;  nConc = 6;
     |FINSI;

     |SI #6#3 = "CE";
         nAgru = 2;  nConc = 7;
     |FINSI;

     |SI #6#3 = "GI";
         nAgru = 2;  nConc = 9;
         |SI #6#6 = 20;  nAgru = 2;  nConc = 8;  |FINSI;
     |FINSI;

     |SI #6#3 = "PC";
         nAgru = 2;  nConc = 11;
         |SI #6#6 = 5;   nAgru = 2;  nConc = 10;  |FINSI;
     |FINSI;

     |SI #6#3 = "BI";
         nAgru = 2;  nConc = 12;
     |FINSI;

     |SI #6#3 = "AE";
         nAgru = 2;  nConc = 13;
     |FINSI;

     |SI #6#3 = "FP";
         nAgru = 2;  nConc = 15;
         |SI #6#6 = 5;   nAgru = 2;  nConc = 14;  |FINSI;
     |FINSI;

     |SI #6#3 = "EL";
         nAgru = 2;  nConc = 16;
     |FINSI;

     |SI #6#3 = "SJ";
         nAgru = 2;  nConc = 17;
     |FINSI;

     |SI #6#3 = "CC";
         nAgru = 2;  nConc = 18;
     |FINSI;

     |SI nAgru = 0; |Y nConc = 0;  |ACABA;  |FINSI;

     #2#7 = anyo;
     #2#0 = nAgru;
     #2#1 = nConc;
     |LEE 040#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ CogeNuevo;

     |DDEFECTO #70;
     #70#0  = #6#0;
     #70#1  = #6#1;
     #70#2  = nLinea;
     #70#3  = #2#0;
     #70#4  = #2#2;
     #70#5  = #2#1;
     #70#6  = #2#3;
     #70#7  = #2#4;
     #70#8  = #2#5;
     #70#9  = #2#6;
     #70#10 = #6#7;
     #70#11 = #6#8;
     #70#12 = #6#5;
     |SI #70#9 = 0;  |O #70#9 = 100;
         #70#10 = #6#8;
     |FINSI;
     |GRABA 020#70n;
     |LIBERA #70;
|FPRC;

|DEFBUCLE isocie06;
     #6#1;
     ;
     00001, 1999, 00;
     99999, 1999, 99;
     ;
     NULL, Pasa70_06;
|FIN;

|PROCESO Pasa70_38;
     nAgru    = 0;
     nConc    = 0;
     nEmpresa = #38#0;
     nAnyo    = #38#1;

     |SI #38#3 = "1";
         |SI #38#4 = 94;  nAgru = 5;  nConc = 1;  |FINSI;
         |SI #38#4 = 95;  nAgru = 5;  nConc = 2;  |FINSI;
         |SI #38#4 = 96;  nAgru = 5;  nConc = 3;  |FINSI;
         |SI #38#4 = 97;  nAgru = 5;  nConc = 4;  |FINSI;
         |SI #38#4 = 98;  nAgru = 5;  nConc = 5;  |FINSI;
         |SI #38#4 = 99;  nAgru = 5;  nConc = 6;  |FINSI;
     |FINSI;

     |SI #38#3 = "2";
         |SI #38#4 = 94; nAgru = 4;  nConc = 1;  |FINSI;
         |SI #38#4 = 95; nAgru = 4;  nConc = 2;  |FINSI;
         |SI #38#4 = 96; nAgru = 4;  nConc = 3;  |FINSI;
         |SI #38#4 = 97; nAgru = 4;  nConc = 4;  |FINSI;
         |SI #38#4 = 98; nAgru = 4;  nConc = 5;  |FINSI;
         |SI #38#4 = 99; nAgru = 4;  nConc = 7;  |FINSI;

         |SI #38#4 = 94; |Y #38#5 = 25;  nAgru = 3;  nConc = 1;  |FINSI;
         |SI #38#4 = 95; |Y #38#5 = 25;  nAgru = 3;  nConc = 2;  |FINSI;
         |SI #38#4 = 96; |Y #38#5 = 25;  nAgru = 3;  nConc = 3;  |FINSI;
         |SI #38#4 = 97; |Y #38#5 = 25;  nAgru = 3;  nConc = 4;  |FINSI;
         |SI #38#4 = 98; |Y #38#5 = 25;  nAgru = 3;  nConc = 5;  |FINSI;
         |SI #38#4 = 99; |Y #38#5 = 25;  nAgru = 3;  nConc = 7;  |FINSI;
     |FINSI;

     |SI #38#3 = "4";
         |SI #38#4 = 96;  nAgru = 5;  nConc = 7;  |FINSI;
         |SI #38#4 = 97;  nAgru = 5;  nConc = 8;  |FINSI;
         |SI #38#4 = 98;  nAgru = 5;  nConc = 9;  |FINSI;
         |SI #38#4 = 99;  nAgru = 5;  nConc = 10; |FINSI;
     |FINSI;

     |SI nAgru = 0; |Y nConc = 0;  |ACABA;  |FINSI;

     #2#7 = anyo;
     #2#0 = nAgru;
     #2#1 = nConc;
     |LEE 040#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ CogeNuevo;

     |DDEFECTO #70;
     #70#0  = #38#0;
     #70#1  = #38#1;
     #70#2  = nLinea;
     #70#3  = #2#0;
     #70#4  = #2#2;
     #70#5  = #2#1;
     #70#6  = #2#3;
     #70#7  = #2#4;
     #70#8  = #2#5;
     #70#9  = #2#6;
     #70#10 = #38#9;
     #70#11 = #38#9;
     #70#12 = #38#6;
     |GRABA 020#70n;
     |LIBERA #70;
|FPRC;

|DEFBUCLE isocie38;
     #38#1;
     ;
     00001, 1999, 00;
     99999, 1999, 99;
     ;
     NULL, Pasa70_38;
|FIN;

|PROCESO Pasa70_09;
     nAgru    = 0;
     nConc    = 0;
     nEmpresa = #9#0;
     nAnyo    = #9#1;

     |SI #9#3 = 94;
         nAgru = 6;  nConc = 1;
     |FINSI;

     |SI #9#3 = 95;
         nAgru = 6;  nConc = 2;
     |FINSI;

     |SI nAgru = 0; |Y nConc = 0;  |ACABA;  |FINSI;

     #2#7 = anyo;
     #2#0 = nAgru;
     #2#1 = nConc;
     |LEE 040#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ CogeNuevo;

     |DDEFECTO #70;
     #70#0  = #9#0;
     #70#1  = #9#1;
     #70#2  = nLinea;
     #70#3  = #2#0;
     #70#4  = #2#2;
     #70#5  = #2#1;
     #70#6  = #2#3;
     #70#7  = #2#4;
     #70#8  = #2#5;
     #70#9  = #2#6;
     #70#10 = #9#6;
     #70#11 = #9#6;
     #70#12 = #9#4;
     |GRABA 020#70n;
     |LIBERA #70;
|FPRC;

|DEFBUCLE isocie09;
     #9#1;
     ;
     00001, 1999, 00;
     99999, 1999, 99;
     ;
     NULL, Pasa70_09;
|FIN;

|PROCESO Pasa69;
     empresa = #68#0;
     anyo    = #68#1;
     |SUB_EJECUTA "isz00006";
|FPRC;

|DEFBUCLE isocie68;
     #68#1;
     ;
     00001, 1999;
     99999, 1999;
     ;
     NULL, Pasa69;
|FIN;

|PROCESO Recoge99;
     |ABRE #2;
     |BUCLE isocie30;
     |BUCLE isocie06;
     |BUCLE isocie38;
     |BUCLE isocie09;
     |BUCLE isocie68;
     |CIERRA #2;
|FPRC;

|PROCESO Convertir99;
     |ABRE #70;
     |LEE 040#70p;
     |SI FSalida ! 0;
         |HAZ Recoge99;
     |FINSI;
     |CIERRA #70;
|FPRC;

|PROCESO Graba70;
     #2#7 = 1999;
     #2#0 = #70#3;
     #2#1 = #70#5;
     |LEE 040#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #2#7 = 2000;
     #2#0 = #2#8;
     #2#1 = #2#9;
     |LEE 040#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #70#3 = #2#0;
     #70#4 = #2#2;
     #70#5 = #2#1;
     #70#6 = #2#3;
     #70#7 = #2#4;
     #70#8 = #2#5;
     #70#9 = #2#6;
     |GRABA 020#70a;

     nSwEsta = 1;
|FPRC;

|DEFBUCLE isocie70;
     #70#1;
     ;
     #69#0, #69#1, 01;
     #69#0, #69#1, 99;
     be;
     NULL, Graba70;
|FIN;

|PROCESO Trata69;
     nSwEsta = 0;
     |BUCLE isocie70;
     |SI nSwEsta = 1;
         empresa = #69#0;
         anyo    = #69#1;
         |SUB_EJECUTA "isz00006";
         |BORRA 020#69a;
         |LIBERA #69;
     |FINSI;
|FPRC;

|DEFBUCLE isocie69;
     #69#1;
     ;
     00000, 2000;
     99999, 2000;
     be;
     NULL, Trata69;
|FIN;

|PROCESO Recoge00;
     |BUCLE isocie69;
|FPRC;

|PROCESO PonCamposNuevos;
     #0#5 = "201";
     |SI #0#4 = "N";  #0#5 = "200";  |FINSI;

     |SI #0#1 < 2000;
         #0#6 = "S";  |PINTA #0#6;
     |FINSI;
     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE isacceso;
     #0#1;
     5;
     0000, 00000, "   ";
     9999, 99999, "   ";
     be;
     NULL, PonCamposNuevos;
|FIN;

|PROCESO Convertir00;
     |ABRE #0;
     #0#0 = 0;
     #0#1 = 0;
     |LEE 040#0];
     |SI FSalida = 0;  |Y #0#5 = "   ";
         |SUB_EJECUTA "instalar;AUTOMA";

         |BUCLE isacceso;

         |ABRE #2;
         |ABRE #73;
         |LEE 040#73p;
         |SI FSalida ! 0;
             |HAZ Recoge00;
         |FINSI;
         |CIERRA #73;
         |CIERRA #2;
     |FINSI;
     |CIERRA #0;
|FPRC;

|PROCESO Trata63;
     #75#0  = #63#0;
     #75#1  = #63#1;
     #75#2  = #63#2;
     #75#3  = #63#5;
     #75#4  = #63#8;
     #75#5  = #63#3;
     #75#6  = #63#6;
     #75#7  = #63#9;
     #75#8  = #63#17;
     #75#9  = #63#18;
     #75#10 = #63#19;
     #75#11 = #63#20;
     #75#12 = #63#21;
     #75#13 = #63#22;
     #75#14 = #63#23;
     #75#15 = #63#24;
     #75#16 = #63#25;
     #75#17 = #63#11;
     #75#18 = #63#13;
     #75#19 = #63#15;

     #75#4  = #75#2  - #75#3;
     #75#7  = #75#5  - #75#6;
     #75#10 = #75#8  - #75#9;
     #75#13 = #75#11 - #75#12;
     #75#16 = #75#14 - #75#15;
     #75#19 = #75#17 - #75#18;
     #75#22 = #75#20 - #75#21;

     #75#41 = #75#2 + #75#5 + #75#8  + #75#11 + #75#14;
     #75#42 = #75#3 + #75#6 + #75#9  + #75#12 + #75#15;
     #75#43 = #75#4 + #75#7 + #75#10 + #75#13 + #75#16;

     #75#44 = #75#17 + #75#20;
     #75#45 = #75#18 + #75#21;
     #75#46 = #75#19 + #75#22;

     |GRABA 020#75n;
     |LIBERA #75;
|FPRC;

|DEFBUCLE isocie63;
     #63#1;
     ;
     00000, 2001;
     99999, 2001;
     be;
     NULL, Trata63;
|FIN;

|PROCESO Convertir01;
     |ABRE #2;
     #2#7 = 2001;
     #2#0 = 1;
     #2#1 = 1;
     |LEE 040#2=;
     |SI FSalida ! 0;
         |SUB_EJECUTA "instalar;AUTOMA";
     |FINSI;
     |CIERRA #2;

     |ABRE #75;
     |LEE 040#75p;
     |SI FSalida ! 0;
         |BUCLE isocie63;
     |FINSI;
     |CIERRA #75;
|FPRC;

|PROCESO Convertir02;
     |ABRE #2;
     #2#7 = 2002;
     #2#0 = 1;
     #2#1 = 1;
     |LEE 040#2=;
     |SI FSalida ! 0;
         |CIERRA #2;
         |DELINDEX #1;
         |DELINDEX #2;

         |SUB_EJECUTA "instalar;AUTOMA";
     |FINSI;
     |CIERRA #2;

     |ABRE #2;
     #2#7 = 2002;
     #2#0 = 1;
     #2#1 = 1;
     |LEE 040#2=;
     enError = FSalida;
     |CIERRA #2;
|FPRC;

|PROCESO Convertir03;
     |ABRE #2;
     #2#7 = 2003;
     #2#0 = 1;
     #2#1 = 1;
     |LEE 040#2=;
     |SI FSalida ! 0;
         |CIERRA #2;
         |DELINDEX #1;
         |DELINDEX #2;

         |SUB_EJECUTA "instalar;AUTOMA";
     |FINSI;
     |CIERRA #2;

     |ABRE #2;
     #2#7 = 2003;
     #2#0 = 1;
     #2#1 = 1;
     |LEE 040#2=;
     enError = FSalida;
     |CIERRA #2;
|FPRC;

|PROCESO Convertir04;
     |ABRE #2;
     #2#7 = 2004;
     #2#0 = 1;
     #2#1 = 1;
     |LEE 040#2=;
     |SI FSalida ! 0;
         |CIERRA #2;
         |DELINDEX #1;
         |DELINDEX #2;

         |SUB_EJECUTA "instalar;AUTOMA";
     |FINSI;
     |CIERRA #2;

     |ABRE #2;
     #2#7 = 2004;
     #2#0 = 1;
     #2#1 = 1;
     |LEE 040#2=;
     enError = FSalida;
     |CIERRA #2;
|FPRC;

|PROCESO Convertir05;
     |ABRE #2;
     #2#7 = 2005;
     #2#0 = 1;
     #2#1 = 1;
     |LEE 040#2=;
     |SI FSalida ! 0;
         |CIERRA #2;
         |DELINDEX #1;
         |DELINDEX #2;

         |SUB_EJECUTA "instalar;AUTOMA";
     |FINSI;
     |CIERRA #2;

     |ABRE #2;
     #2#7 = 2005;
     #2#0 = 1;
     #2#1 = 1;
     |LEE 040#2=;
     enError = FSalida;
     |CIERRA #2;
|FPRC;

|PROCESO Convertir06;
     |ABRE #2;
     #2#7 = 2006;
     #2#0 = 1;
     #2#1 = 1;
     |LEE 040#2=;
     |SI FSalida ! 0;
         |CIERRA #2;
         |DELINDEX #1;
         |DELINDEX #2;

         |SUB_EJECUTA "instalar;AUTOMA";
     |FINSI;
     |CIERRA #2;

     |ABRE #2;
     #2#7 = 2006;
     #2#0 = 1;
     #2#1 = 1;
     |LEE 040#2=;
     enError = FSalida;
     |CIERRA #2;
|FPRC;

|PROCESO Convertir07;
     |ABRE #2;
     #2#7 = 2007;
     #2#0 = 2;
     #2#1 = 27;
     |LEE 040#2=;
     |SI FSalida ! 0;  |O #2#6 ! 12;
         |CIERRA #2;
         |DELINDEX #1;
         |DELINDEX #2;

         |SUB_EJECUTA "instalar;AUTOMA";
     |FINSI;
     |CIERRA #2;

     |ABRE #2;
     #2#7 = 2007;
     #2#0 = 2;
     #2#1 = 27;
     |LEE 040#2=;
     |SI FSalida ! 0;  |O #2#6 ! 12;
         enError = 1;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO ContarImpuestos0;

    aAlfa = #isacceso#9; |QBF aAlfa;
    |SI aAlfa = "";      nNegro = nNegro + 1; |FINSI;
    |SI aAlfa = eaAzul;  nAzul  = nAzul  + 1; |FINSI;
    |SI aAlfa = eaRojo;  nRojo  = nRojo  + 1; |FINSI;
    |SI aAlfa = eaVerde; nVerde = nVerde + 1; |FINSI;
    nTodos = nTodos + 1;
|FPRC;

|DEFBUCLE ContarImpuestos;
     #isacceso#1;
     ;
     enAnyo, 00001;
     enAnyo, 99999;
     e;
     NULL, ContarImpuestos0;
|FIN;

|PROCESO ContarImpuestos;

     |HAZ CargaColores;
     nNegro = 0;
     nAzul  = 0;
     nRojo  = 0;
     nVerde = 0;
     nTodos = 0;
     |BUCLE ContarImpuestos;

     aAlfa = nNegro; aAlfa = ("    " + aAlfa) % -104; aAlfa = "(" + aAlfa + ")";
     eaTNegro = aAlfa;

     aAlfa = nAzul; aAlfa = ("    " + aAlfa) % -104; aAlfa = "(" + aAlfa + ")";
     eaTAzul  =  aAlfa;

     aAlfa = nRojo; aAlfa = ("    " + aAlfa) % -104; aAlfa = "(" + aAlfa + ")";
     eaTRojo  = aAlfa;

     aAlfa = nVerde; aAlfa = ("    " + aAlfa) % -104; aAlfa = "(" + aAlfa + ")";
     eaTVerde = aAlfa;

     aAlfa  = nTodos; aAlfa = ("    " + aAlfa) % -104; aAlfa = "(" + aAlfa + ")";
     eaTTodos =  aAlfa;
|FPRC;
