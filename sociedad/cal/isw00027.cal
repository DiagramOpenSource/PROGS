|FICHEROS;
     isw00027 #0;
     maacceso #1;
     isw00029 #87,MANTE;          || Entlineal de Empresas com Errores
|FIN;

|VARIABLES;
     aAlfa        = "";
     aDirModelo   = "";
     aDirSesion   = "";
     aRaiz        = "";
     aDirectorio  = "";
     aSesion      = "";
     aError       = "";
     aFichero     = "";
     aAbre        = "";
     aHandle      = "";
     aVariable    = "";
     aContr       = "";

     nRegistro    = 0;
     nHePasado    = 0;
     nNume        = 0;
     nCanal       = 0;

     &enAnyo      = 0;
     &eaTipoSec   = "";
|FIN;

|RUTINA ClaveBaja87;
     #87#0 = #0#0;
     #87#1 = 00000;
|FRUT;

|RUTINA ClaveAlta87;
     #87#0 = #0#0;
     #87#1 = 99999;
|FRUT;

|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| PROCESOS LLAMADOS DESDE EL REW01002
|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Tipo11w0029;  |TIPO 11;
     |SI FSalida = 10;
         aAlfa = "EDIT " + aDirSesion + #87#2;

         |RSYSTEM aAlfa;
     |FINSI;
|FPRC;

|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| PROCESOS DE BUSQUEDA DE ERRORES
|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO MiraEmpresas;
     nRegistro   = 0;
     aSesion     = "DIRECTA";  |QBF aSesion;
     aDirSesion  = "/MODELOS/SOCIEDAD/" + eaTipoSec + "/" + #0#0 + "/";
     aFichero    = "/MODELOS/SOCIEDAD/" + eaTipoSec + "/" + #0#0 + "/*.txt";
     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            aError = aFichero - aDirSesion;
            aAlfa  = aError % 405;
            #1#0   = aAlfa;
            #1#1   = #0#0;
            |LEE 040#1=;
            |SI FSalida = 0;
                nHePasado = 1;
                nRegistro = 1;
                #87#0 = #1#1;
                #87#1 = #1#0;
                #87#2 = aError;
                #87#3 = #1#2;
                |GRABA 020#87n;
                |LIBERA #87;
            |FINSI;
            |R_SDIR aFichero;
     |SIGUE;
|FPRC;

|PROCESO MiraEmpresas2007;
     nRegistro   = 0;
     aSesion     = "DIRECTA";  |QBF aSesion;
     aDirSesion  = "/MODELOS/SOCIEDAD/" + eaTipoSec + "/" + #0#0 + "/";
     aFichero    = "/MODELOS/SOCIEDAD/" + eaTipoSec + "/" + #0#0 + "/*.txt";
     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;
            aAlfa  = aFichero < "";
            aAlfa  = aAlfa - "r201";
            |SI FSalida ! 0;
                aError = aFichero - aDirSesion;
                aAlfa  = aError % 505;
                #1#0   = aAlfa;
                #1#1   = #0#0;
                |LEE 040#1=;
                |SI FSalida = 0;
                    nHePasado = 1;
                    nRegistro = 1;
                    #87#0 = #1#1;
                    #87#1 = #1#0;
                    #87#2 = aError;
                    #87#3 = #1#2;
                    |GRABA 020#87n;
                    |LIBERA #87;
                |FINSI;
            |FINSI;
            |R_SDIR aFichero;
     |SIGUE;
|FPRC;

|PROCESO Errores;
     aFichero = ("87" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #87 aFichero;
     |ABRE #87;  |CIERRA #87;  |DELINDEX #87;

     nHePasado = 0;
     |ABRE #1;
     |ABRE #87;
     |SI eaTipoSec ! "202";
         |SI #0#0 [ 2006;  |HAZ MiraEmpresas;      |FINSI;
         |SI #0#0 ] 2007;  |HAZ MiraEmpresas2007;  |FINSI;
     |SINO;
         |HAZ MiraEmpresas;
     |FINSI;

     |CIERRA #1;
     |CIERRA #87;

     |SI nHePasado = 1;
         |ENTLINEAL #1#87, -1, 4, 21, 0, ClaveBaja87, ClaveAlta87;
     |FINSI;

     |DELINDEX #87;
|FPRC;

____________________________________/
|PROCESO Tipo3; |TIPO 3;
     |SI eaTipoSec = "";  eaTipoSec = "201";  |FINSI;

     enAnyo  = #0#0;
     |HAZ Errores;
|FPRC;

|PROGRAMA;
     |SI enAnyo ! 0;
         |PINPA #0#0;
         #0#0 = enAnyo;
         |PINDA #0#0;
         |HAZ Tipo3;
     |SINO;
         |MANTE #0;
     |FINSI;
|FPRO;
