|FICHEROS;
     zhazdocu #0;
     zregdocu #1;
     zregfirm #4;
     zhazcrea #2,MANTE;
     maempr01 #301;

     megwordc #800;
     megwordl #801;

     cubal801 #1801;
     cubal802 #1802;
     cubal803 #1803;
     cubal804 #1804;
     cubal805 #1805;

     zw000010 #910;
     :/agicli/def/agim0135 #635;
|FIN;

|VARIABLES;
     aBase            = "";
     aAbre            = "";
     aAbreTxt         = "";
     aAlfa            = "";
     aAlfa1           = "";
     aAlfa2           = "";
     aAlfa3           = "";
     aIPRemoto        = "";
     aCuenta          = "";
     aAste            = "";
     aLong            = "";
     aCuentaD         = "";
     aCuentaH         = "";
     aHora            = "";
     aPag             = "";
     aPag1            = "";
     aPag2            = "";
     aCarac10         = "";
     aCarac13         = "";
     aQueQuiero       = "";
     aTipo            = "";
     aClave           = "";

     nLong            = 0;
     nSubPanta        = 0;
     nVentana         = 0;
     nNume            = 0;
     nNume1           = 0;
     nNume2           = 0;
     nNume3           = 0;
     nNume4           = 0;
     nRango           = 0;
     nBotonSal        = 0;
     nImporte         = 0;
     nEjer            = 0;
     nCampo1          = 0;
     nCampo2          = 0;
     nCampo3          = 0;
     nCampo4          = 0;
     nHandle          = 0;
     nVar             = 0;
     nCampo           = 0;
     nNumCampo        = 0;
     nSwContar        = 0;
     nContador1       = 0;
     nContador2       = 0;
     nConta           = 0;
     nTributa         = 0;
     nC1              = 0;
     nC2              = 0;
     nC3              = 0;
     nC4              = 0;
     nC5              = 0;
     nC6              = 0;
     nCT              = 0;
     nCE              = 0;
     nCasilla         = 0;
     nImporte1        = 0;
     nImporte2        = 0;
     nImporte3        = 0;
     nImporte4        = 0;
     nImporte5        = 0;
     nImporte6        = 0;
     nColumna         = 0;

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     &eaDirPlantilla  = "";
     &eaDirTrabajo    = "";
     &eaDirTrabServi  = "";
     &eaDirSerPlan    = "";
     &eaDirSerDoc     = "";
     &eaDirGuarda     = "";
     &eaOrigen        = "";
     &eaDestino       = "";
     &eaFicheroTra    = "";
     &eaFicheroTxt    = "";
     &eaFicheroPla    = "";
     &eaPlanillaTra   = "";
     &eaModoPresenta  = "";
     &enHandleTxt     = 0;
     &eaAsigna        = "";
     &eaConten        = "";
     &enCanti         = 0;
     &eaImporte       = "";
     &enSwTrata       = 0;
     &eaAlfa          = "";
     &eaFichero       = "";
     &enPersonaliza   = 0;
     &enAnyo          = 0;
     &enUltCoop       = 0;
     &aCNAE           = "";
     &EURODB          = 0;
|FIN;

|PROCESO LeeCNAE;
     |ABRE #635;
     #635#0 = aCNAE;
     |LEE 000#635=;
     |SI FSalida ! 0;  |DDEFECTO #635;  |FINSI;
     |CIERRA #635;

     aCNAE = #635#1;  |QBF aCNAE;
|FPRC;

|PROCESO cubal801;
     |SI #1801#8  = "A";  |ACABA;  |FINSI;
     |SI #1801#16 = 0;
         aAlfa = #1801#3;  |QBF aAlfa;
         |SI aAlfa = "TOTAL ACTIVO";
             #1801#16 = "10000";
         |FINSI;

         |SI aAlfa = "TOTAL PASIVO";
             #1801#16 = "30000";
         |FINSI;
     |FINSI;

     |SI #1801#16 = 0;   |ACABA;   |FINSI;

     |SI #1801#16 = 31590;  |Y #1801#11 = 3;
         #1801#16 = 32590;
     |FINSI;

     |SI #1801#16 = 31701;  |Y #1801#11 = 3;
         #1801#16 = 32701;
     |FINSI;

     |SI #1801#16 = 31704;  |Y #1801#11 = 3;
         #1801#16 = 32704;
     |FINSI;

     aClave = ("000000" + #1801#16) % -106;

     eaAsigna = "V#" + aClave + "N#";
     eaConten = "";
     |SI #1801#7 ! 0;
         enCanti  = #1801#7;
         |HAZ SeparaImporte;
         eaConten = eaImporte;  |QBT eaConten;
     |FINSI;
     |HAZ GrabaContenido;

     eaAsigna = "V#" + aClave + "A#";
     eaConten = "";
     |SI #1801#6 ! 0;
         enCanti  = #1801#6;
         |HAZ SeparaImporte;
         eaConten = eaImporte;  |QBT eaConten;
     |FINSI;
     |HAZ GrabaContenido;

     eaAsigna = "V#" + aClave + "M#";
     eaConten = #1801#5;  |QBF eaConten;
     |HAZ GrabaContenido;
|FPRC;

|DEFBUCLE cubal801;
     #1801#1;
     ;
     #2#0, #2#1, 0001;
     #2#0, #2#1, 9999;
     ;
     NULL, cubal801;
|FIN;

|PROCESO cubal802;
     |SI #1802#8  = "A";  |ACABA;  |FINSI;

     |SI #1802#16 = 0;  |Y #1802#9 = 4; |Y #1802#8 = "S";
         #1802#16 = 49600;
     |FINSI;

     |SI #1802#16 = 0;    |ACABA;   |FINSI;

     aClave = ("000000" + #1802#16) % -106;

     eaAsigna = "V#" + aClave + "N#";
     eaConten = "";
     |SI #1802#7 ! 0;
         enCanti  = #1802#7;
         |HAZ SeparaImporte;
         eaConten = eaImporte;  |QBT eaConten;
     |FINSI;
     |HAZ GrabaContenido;

     eaAsigna = "V#" + aClave + "A#";
     eaConten = "";
     |SI #1802#6 ! 0;
         enCanti  = #1802#6;
         |HAZ SeparaImporte;
         eaConten = eaImporte;  |QBT eaConten;
     |FINSI;
     |HAZ GrabaContenido;

     eaAsigna = "V#" + aClave + "M#";
     eaConten = #1802#5;  |QBF eaConten;
     |HAZ GrabaContenido;
|FPRC;

|DEFBUCLE cubal802;
     #1802#1;
     ;
     #2#0, #2#1, 0001;
     #2#0, #2#1, 9999;
     ;
     NULL, cubal802;
|FIN;

|PROCESO cubal803;
     |SI #1803#8  = "A";  |ACABA;  |FINSI;
     |SI #1803#16 = 0;    |ACABA;   |FINSI;

     aClave = ("000000" + #1803#16) % -106;

     eaAsigna = "V#" + aClave + "N#";
     eaConten = "";
     |SI #1803#7 ! 0;
         enCanti  = #1803#7;
         |HAZ SeparaImporte;
         eaConten = eaImporte;  |QBT eaConten;
     |FINSI;
     |HAZ GrabaContenido;

     eaAsigna = "V#" + aClave + "A#";
     eaConten = "";
     |SI #1803#6 ! 0;
         enCanti  = #1803#6;
         |HAZ SeparaImporte;
         eaConten = eaImporte;  |QBT eaConten;
     |FINSI;
     |HAZ GrabaContenido;

     eaAsigna = "V#" + aClave + "M#";
     eaConten = #1803#5;  |QBF eaConten;
     |HAZ GrabaContenido;
|FPRC;

|DEFBUCLE cubal803;
     #1803#1;
     ;
     #2#0, #2#1, 0001;
     #2#0, #2#1, 9999;
     ;
     NULL, cubal803;
|FIN;

|PROCESO cubal804;
     aClave = ("000" + #1804#4) % -103;

     |PARA nCampo = 6;  |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
           eaConten = "";
           |SI #1804nCampo ! 0;
               enCanti  = #1804nCampo;
               |HAZ SeparaImporte;
               eaConten = eaImporte;  |QBT eaConten;
           |FINSI;

           nColumna = nCampo - 5;
           eaAsigna = "V#" + aClave + (("00" + nColumna) % -102) + #1804#3 + "#";
          |HAZ GrabaContenido;
     |SIGUE;
|FPRC;

|DEFBUCLE cubal804;
     #1804#1;
     ;
     #2#0, #2#1, 0001;
     #2#0, #2#1, 9999;
     ;
     NULL, cubal804;
|FIN;

|PROCESO CargaVarCuentas;
     nNume    = #2#1 - 2;
     eaAsigna = "V#ejer-2#";
     eaConten = nNume;
     |HAZ GrabaContenido;

     nNume    = #2#1 - 1;
     eaAsigna = "V#ejerA#";
     eaConten = nNume;
     |HAZ GrabaContenido;

     eaAsigna = "V#ejerN#";
     eaConten = #2#1;
     |HAZ GrabaContenido;

     nNume    = #2#1 - 2;
     eaAsigna = "V200X-2";
     eaConten = nNume;
     |HAZ GrabaContenido;

     nNume    = #2#1 - 1;
     eaAsigna = "V200X-1";
     eaConten = nNume;
     |HAZ GrabaContenido;

     nNume    = #2#1 - 1;
     eaAsigna = "V200X - 1";
     eaConten = nNume;
     |HAZ GrabaContenido;

     eaAsigna = "V200X";
     eaConten = #2#1;
     |HAZ GrabaContenido;

     eaAlfa   = #2#2;       |HAZ QuitaRarosDSXML;
     eaAsigna = "C#empresa#";
     eaConten = eaAlfa;
     |HAZ GrabaContenido;

     enSwTrata = 1;

     |BUCLE cubal801;
     |BUCLE cubal802;
     |BUCLE cubal803;
     |BUCLE cubal804;
|FPRC;

|PROCESO CreaCtasCoop;
     |HAZ VentanaTrabajo;

     nEjer = #0#0;
     |SI nEjer [ 2010;      nEjer = enUltCoop;  |FINSI;
     |SI nEjer > enUltCoop; nEjer = enUltCoop;  |FINSI;

     |SI #0#0 [ 2010;
         |SI #2#4 = 21;  eaPlanillaTra  = "cacoop21.doc";  |FINSI;
         |SI #2#4 = 22;  eaPlanillaTra  = "cacoop22.doc";  |FINSI;
         |SI #2#4 = 31;  eaPlanillaTra  = nEjer + "cp31.doc";  |FINSI;
         |SI #2#4 = 32;  eaPlanillaTra  = nEjer + "cp32.doc";  |FINSI;
     |SINO;
         |SI #2#4 = 21;  eaPlanillaTra  = nEjer + "cp21.doc";  |FINSI;
         |SI #2#4 = 22;  eaPlanillaTra  = nEjer + "cp22.doc";  |FINSI;
         |SI #2#4 = 31;  eaPlanillaTra  = nEjer + "cp31.doc";  |FINSI;
         |SI #2#4 = 32;  eaPlanillaTra  = nEjer + "cp32.doc";  |FINSI;
     |FINSI;

     |DBASE aBase;
     eaDirSerDoc    = aBase  + "word/cuentas/";
     eaDirTrabajo   = "C:\MODELOS";                          |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = "C:\MODELOS\MEMORIAS";                 |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = "C:\MODELOS\MEMORIAS\" + #2#1;         |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = "C:\MODELOS\MEMORIAS\" + #2#1 + "\";
     eaDirSerPlan   = aBase  + "planilla/";
     eaDirTrabServi = aBase  + "tmp";                        |MKDIR eaDirTrabServi;
     eaDirTrabServi = aBase  + "tmp/";
     eaFicheroTxt   = "wcuenta.txt";
     eaFicheroTra   = "wcuenta.doc";
     eaFicheroPla   = eaPlanillaTra;
     eaDirGuarda    = aBase  + "emisiones";    |MKDIR eaDirGuarda;
     eaDirGuarda    = eaDirGuarda + "/" + (("00000" + #2#0) % -105);  |MKDIR eaDirGuarda;
     eaDirGuarda    = eaDirGuarda + "/" + #2#1;                       |MKDIR eaDirGuarda;
     eaDirGuarda    = eaDirGuarda + "/";

     eaModoPresenta = "";

     eaOrigen       = eaDirSerDoc  + eaPlanillaTra;
     eaDestino      = eaDirTrabajo + eaFicheroPla;
     |HAZ EnviaFicheroConMD5;

     aAbre = eaDirTrabajo + eaFicheroPla;
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         aAlfa   = "0000 El Documento " + aAbre + " no esta instalado. Consulte con su administrador.";
         |MENAV aAlfa;
         |HAZ FinVentanaTrabajo;
         |ACABA;
     |FINSI;

     aAbre = eaDirTrabServi + eaFicheroTxt;
     |XABRE "WB", aAbre, enHandleTxt;

     aAlfa = "[FICHERO]#" + eaDirTrabajo + eaFicheroPla + "#" + eaDirTrabajo + eaFicheroTra + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;

     aAlfa = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;

     |SI aIPRemoto = "192.168.10.42";
         aAlfa = "[ERROR]" + &13 + &10;
         |XGRABA enHandleTxt, aAlfa;
     |FINSI;

     |HAZ CargaVarCuentas;

     |XCIERRA enHandleTxt;

     eaOrigen  = eaDirTrabServi + eaFicheroTxt;
     eaDestino = eaDirTrabajo   + eaFicheroTxt;
     |HAZ EnviaFicheroSinMD5;

     aAlfa = eaDirTrabServi + eaFicheroTxt;
     |FBORRA aAlfa;

     |HAZ AbreWordExterno;

     aAbre = eaDirTrabajo + eaFicheroTra;
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         |ACABA;
     |FINSI;

     eaOrigen  = aAbre;
     eaDestino = eaDirGuarda + "wcuenta.doc";
     |HAZ RecibeFichero;

     |RFBORRA aAbre;

     aAbre = eaDirGuarda + "wcuenta.doc";
     |XABRE "E", aAbre, nHandle;
     |SI FSalida < 0;
         |HAZ FinVentanaTrabajo;
         |ACABA;
     |FINSI;

     #1#3  = "S";

     |ABRE #800;
     #800#0 = #1#0;
     #800#1 = #1#1;
     |LEE 101#800=;
     |SI FSalida ! 0;
         |DDEFECTO #800;
         #800#0 = #1#0;
         #800#1 = #1#1;
         |GRABA 020#800b;
     |FINSI;

     #800#2 = #1#2;
     #800#3 = #1#5;
     #800#4 = #1#6;
     #800#5 = #1#9;
     #800#6 = #1#10;

     |GRABA 020#800a;
     |LIBERA #800;
     |CIERRA #800;

     |ABRE #801;
     #801#0 = #1#0;
     #801#1 = #1#1;
     #801#2 = "wcuenta.doc";
     |LEE 101#801=;
     |SI FSalida ! 0;
         |DDEFECTO #801;
         #801#0 = #1#0;
         #801#1 = #1#1;
         #801#2 = "wcuenta.doc";
         |GRABA 020#801b;
     |FINSI;

     #801#3 = "CUENTAS ANUALES";
     #801#4 = ~;
     |HORA aHora;
     #801#5 = aHora % 102;
     #801#6 = aHora % 402;

     |GRABA 020#801a;
     |LIBERA #801;
     |CIERRA #801;

     |HAZ FinVentanaTrabajo;

     |PULSATECLA;
|FPRC;

|PROCESO VisualizaCuentasDoc;
     |HAZ VentanaTrabajo;

     |DBASE aBase;
     eaDirTrabajo   = "C:\MODELOS";                          |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = "C:\MODELOS\MEMORIAS";                 |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = "C:\MODELOS\MEMORIAS\" + #2#1;         |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = "C:\MODELOS\MEMORIAS\" + #2#1 + "\";
     eaDirSerPlan   = aBase  + "planilla/";
     eaDirTrabServi = aBase  + "tmp";                        |MKDIR eaDirTrabServi;
     eaDirTrabServi = aBase  + "tmp/";
     eaFicheroTxt   = "wcuenta.txt";
     eaFicheroTra   = "wcuenta.doc";
     eaFicheroPla   = eaPlanillaTra;
     eaDirGuarda    = aBase  + "emisiones";    |MKDIR eaDirGuarda;
     eaDirGuarda    = eaDirGuarda + "/" + (("00000" + #2#0) % -105);  |MKDIR eaDirGuarda;
     eaDirGuarda    = eaDirGuarda + "/" + #2#1;                       |MKDIR eaDirGuarda;
     eaDirGuarda    = eaDirGuarda + "/";
     eaDirSerDoc    = eaDirGuarda;
     eaModoPresenta = "P";

     eaOrigen       = eaDirGuarda  + eaFicheroTra;
     eaDestino      = eaDirTrabajo + eaFicheroTra;
     |HAZ EnviaFicheroConMD5;

     aAbre = eaDirTrabajo + eaFicheroTra;
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         aAlfa   = "0000 El Documento " + aAbre + " no esta instalado. Consulte con su administrador.";
         |MENAV aAlfa;
         |HAZ FinVentanaTrabajo;
         |ACABA;
     |FINSI;

     |HAZ EditaDocumento;

     aAbre = eaDirTrabajo + eaFicheroTra;
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         |HAZ FinVentanaTrabajo;
         |ACABA;
     |FINSI;

     eaOrigen  = aAbre;
     eaDestino = eaDirGuarda + eaFicheroTra;
     |HAZ RecibeFichero;

     |RFBORRA aAbre;

     |HAZ FinVentanaTrabajo;

     |PULSATECLA;
|FPRC;

|PROCESO VisualizaCuentasPdf;
     |HAZ VentanaTrabajo;

     |DBASE aBase;
     eaDirTrabajo   = "C:\MODELOS";                          |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = "C:\MODELOS\MEMORIAS";                 |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = "C:\MODELOS\MEMORIAS\" + #2#1;         |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = "C:\MODELOS\MEMORIAS\" + #2#1 + "\";
     eaDirSerPlan   = aBase  + "planilla/";
     eaFicheroTra   = "wcuenta.fdf";
     eaDirGuarda    = aBase  + "emisiones";    |MKDIR eaDirGuarda;
     eaDirGuarda    = eaDirGuarda + "/" + (("00000" + #2#0) % -105);  |MKDIR eaDirGuarda;
     eaDirGuarda    = eaDirGuarda + "/" + #2#1;                       |MKDIR eaDirGuarda;
     eaDirGuarda    = eaDirGuarda + "/";
     eaDirSerDoc    = eaDirGuarda;

     eaOrigen       = eaDirGuarda  + eaFicheroTra;
     eaDestino      = eaDirTrabajo + eaFicheroTra;
     |HAZ EnviaFicheroConMD5;

     aAbre = eaDirTrabajo + eaFicheroTra;
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         aAlfa   = "0000 El Documento " + aAbre + " no esta instalado. Consulte con su administrador.";
         |MENAV aAlfa;
         |HAZ FinVentanaTrabajo;
         |ACABA;
     |FINSI;

     eaOrigen  = eaDirSerPlan + "dsfdf" + #2#1 + ".tgz";
     eaDestino = eaDirTrabajo + "dsfdf" + #2#1 + ".tgz";
     |HAZ EnviaFicheroConMD5;

     |RDESCOMPRIME eaDestino;
     |RDETAR eaDestino, eaDirTrabajo;

     aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaDirTrabajo + "wcuenta.fdf" + &34;
     |RSYSTEM aAlfa;

     eaOrigen  = aAbre;
     eaDestino = eaDirGuarda + eaFicheroTra;
     |HAZ RecibeFichero;

     |RFBORRA aAbre;

     aAlfa = eaDirTrabajo + "dsfdf" + enAnyo + ".tar";  |RFBORRA aAlfa;

     |HAZ FinVentanaTrabajo;
|FPRC;

|PROCESO VisualizaCuentas;
     |SI #2#4 = 21;  |O #2#4 = 22;
      |O #2#4 = 31;  |O #2#4 = 32;
         |HAZ VisualizaCuentasDoc;
     |SINO;
         |HAZ VisualizaCuentasPdf;
     |FINSI;
|FPRC;

|PROCESO EditaCtasPatron;
     |HAZ VentanaTrabajo;

     |DBASE aBase;
     eaDirTrabajo   = "C:\MODELOS";                          |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = "C:\MODELOS\MEMORIAS";                 |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = "C:\MODELOS\MEMORIAS\" + #0#0;         |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = "C:\MODELOS\MEMORIAS\" + #0#0 + "\";
     eaDirSerPlan   = aBase  + "planilla/";
     eaDirSerDoc    = aBase  + "word/cuentas/";
     eaDirTrabServi = aBase  + "tmp";                        |MKDIR eaDirTrabServi;
     eaDirTrabServi = aBase  + "tmp/";
     eaFicheroTxt   = "cco" + #0#0 + ".txt";
     eaFicheroTra   = eaFichero;
     eaFicheroPla   = eaPlanillaTra;
     eaDirGuarda    = aBase  + "word/cuentas/";
     eaModoPresenta = "P";

     eaOrigen       = eaDirGuarda + eaFichero;
     eaDestino      = eaDirTrabajo + eaFichero;
     |HAZ EnviaFicheroConMD5;

     aAbre = eaDirTrabajo + eaFichero;
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         aAlfa   = "0000 El Documento " + aAbre + " no esta instalado. Consulte con su administrador.";
         |MENAV aAlfa;
         |HAZ FinVentanaTrabajo;
         |ACABA;
     |FINSI;

     |HAZ EditaDocumento;

     aAbre = eaDirTrabajo + eaFicheroTra;
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         |HAZ FinVentanaTrabajo;
         |ACABA;
     |FINSI;

     eaOrigen  = aAbre;
     eaDestino = eaDirGuarda + eaFichero;
     |HAZ RecibeFichero;

     |HAZ FinVentanaTrabajo;

     |PULSATECLA;
|FPRC;
