|FICHEROS;
      isoy2012;
      maempr10;
      maempr02;
      maempr03;
      maempr04;
      maempr06;
      maempr11;

      isocie00;
      isom0000;
      isom0001;
      isom0002;
      isom0003;
      isom0004;
      isom0005;
      isom0006;
      isom0007;
      isom0008;
      isom0009;
      isom0011;
      isom0012;
      isom0016;
      isom0022;
      isom0023;
      isom0205;

      isom0500;
      isom0501;
      isom0502;
      isom0503;
      isom0504;
      isom0505;
      isom0506;
      isom0507;
      isom0508;
      isom0509;
      isom0510;
      isom0511;

      zregpres;

      isoh1201;
      isoh0902;
      isoh11di;

      :/agicli/def/agim0019 #0;
      :/agicont/def/ca8m0000 #1;
|FIN;

|VARIABLES;
     aAlfa          = "";
     aAlfa0         = "";
     aAlfa1         = "";
     aAlfa2         = "";
     aBase          = "";
     aPathPlugins   = "";
     aDirServidor   = "";
     aDirInternet   = "";
     aDirLanza      = "";
     aDocRemoto     = "";
     aDocServidor   = "";
     aDirBase       = "";
     aIPRemoto      = "";
     aDelindex      = "";
     aFichero       = "";
     aFicheroT      = "";
     aFicheroP      = "";
     aFicheroE      = "";
     aAbre          = "";
     aOrigen        = "";
     aDestino       = "";
     aContenido     = "";
     aCNAE          = "";
     aDia           = "";
     aMes           = "";
     aEjerc         = "";
     aPais          = "";
     aCodPais       = "";
     aLong          = "";
     aTecla         = "";
     aRetu          = "";
     aEsc1          = "";
     aEsc2          = "";
     aDesde         = "";
     aHasta         = "";

     nLong          = 0;
     nNume          = 0;
     nPos           = 0;
     nValor         = 0;
     nValor1        = 0;
     nValor2        = 0;
     nValor3        = 0;
     nValor4        = 0;
     nValor5        = 0;
     nExiste        = 0;
     nSuma          = 0;
     nVent          = 0;
     nVent200       = 0;
     nPanta         = 0;
     nCasilla       = 0;
     nFecha           = 0;
     nCampo           = 0;
     nSwPunto         = 0;
     nCaracter        = 0;
     nContaBucle      = 0;
     nContaBucleL     = 0;
     nComple          = 0;
     nPuntero         = 0;
     nDesde           = 0;
     nHasta           = 0;
     nHay             = 0;
     nTotal           = 0;
     nValor626        = 0;
     nValor627        = 0;
     nValor628        = 0;
     nValor629        = 0;
     nCanti1          = 0;
     nCanti2          = 0;
     nCanti3          = 0;
     nCanti4          = 0;
     nCantiT          = 0;
     nResto           = 0;
     nResto1          = 0;
     nResto2          = 0;
     nResto3          = 0;
     nTecla           = 0;
     nPasada          = 0;
     nBotonCont       = 0;
     nBotonSal        = 0;
     nHandle          = 0;

     fFechaD          = @;
     fFechaH          = @;

     {1}aContiene     = "";

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     &enEmpresa       = 0;
     &enAnyo          = 0;
     &enNavieras      = 0;
     &enCooperativa   = 0;
     &enTranspa       = 0;
     &enZEC           = 0;
     &enPeqDimen      = 0;
     &enForales       = 0;
     &enError         = 0;
     &enAviso         = 0;
     &eaError         = "";
     &eaAlfa          = "";
     &enHandle        = 0;
     &enCanti         = 0;
     &eaPagina        = "";
     &enCodCli        = 0;
     &enSwDeDonde     = 0;
     &eaEfectivo      = "";
     &eaAdeudo        = "";
     &eaEntidad       = "";
     &eaOficina       = "";
     &eaDC             = "";
     &eaCuenta         = "";
     &enModelo         = 0;
     &enBanco          = 0;
     &enFormaPag       = 0;
     &enForzar         = 0;
     &eaPathExplorador = "";
     &eaForzExplorador = "";
     &efFechaImpre     = @;
     &eaImpre          = "";
     &eaJusti          = "";
     &eaFinLinea       = "";
     &eaUnidadBasico   = "";
     &enEjercicio      = 0;
     &eaCasilla        = "";
     &enErrorPortal    = 0;
|FIN;

|PROCESO PonVentana;
     |VENTANA 0501, 2399, -1, 16, "Emisi¢n modelo 200";
     nVent200 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent200;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
|FPRC;

|PROCESO QuitaVentana;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent200;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent200;
|FPRC;

|PROCESO TraeDsaeatresp;
     |DBASE aPathPlugins;  |QBT aPathPlugins;
     aPathPlugins = aPathPlugins + "planilla";
     aOrigen      = aPathPlugins   + "/dsaeatresp.exe";
     aDestino     = aDirBase + "dsaeatresp.exe";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CopiaFichero;
     aAlfa = "";
     |IP_REMOTO aAlfa;  |QBT aAlfa;
     |SI aAlfa ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
|FPRC;

|PROCESO AbreSecuencial;
     |DBASE aBase;  |QBF aBase;
     aDirServidor = aBase + "tmp";   |MKDIR aDirServidor;
     aDirServidor = aBase + "tmp/";

     aDirLanza    = eaUnidadBasico + "\AEAT";                         |RMKDIR aDirLanza;
     aDirLanza    = eaUnidadBasico + "\AEAT\200";                     |RMKDIR aDirLanza;
     aDirLanza    = eaUnidadBasico + "\AEAT\200\" + #maempr10#1;           |RMKDIR aDirLanza;
     aDirLanza    = eaUnidadBasico + "\AEAT\200\" + #maempr10#1 + "\";

     aDirBase     = eaUnidadBasico + "\AEAT\200\";

     aDirInternet = eaUnidadBasico + "/AEAT";                         |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET";                |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET/200";            |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET/200/" + #maempr10#1;  |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET/200/" + #maempr10#1 + "\";

     aFichero    = (("00000" + #maempr10#0) % -105) + #maempr10#1 + ".txt";
     aFicheroT   = (("00000" + #maempr10#0) % -105) + #maempr10#1 + "T.txt";
     aFicheroP   = "portal200.html";

     aAbre       = aDirServidor + aFicheroT;
     |XABRE "BW", aAbre, enHandle;
|FPRC;

|PROCESO GrabaPortal;
     eaAlfa = eaAlfa + &13 + &10;
     |XGRABA enHandle, eaAlfa;
|FPRC;

|PROCESO GrabaPortalSin;
     |XGRABA enHandle, eaAlfa;
|FPRC;

|PROCESO PortalBorrador;
     aAbre = aDirServidor + aFicheroP;
     |XABRE "WB", aAbre, enHandle;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + "https://www2.agenciatributaria.gob.es/l/zi22zilk0022" + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + "SOV2200A" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + "ES" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "LEV" + &34 + " value=" + &34 + "000000000000" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIC" + &34 + " value=" + &34;
     |HAZ GrabaPortalSin;
     |XCIERRA enHandle;

     aDestino   = aDirServidor + aFicheroP;
     aOrigen    = aDirServidor + aFichero;

     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre = aDirServidor + aFicheroP;
     |XABRE "AB", aAbre, enHandle;

     eaAlfa = &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "RUT" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + "2012" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + "200" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandle;

     aOrigen  = aDirServidor + aFicheroP;
     aDestino = aDirLanza + aFicheroP;
     |HAZ CopiaFichero;

     eaForzExplorador = "N";
     enEjercicio      = enAnyo;
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + aDestino;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aDestino + &34;
     |FINSI;

     |RSYSTEM aAlfa;

     aAlfa = aDirServidor + aFicheroP;   |FBORRA aAlfa;
     aAlfa = aDirLanza + aFicheroP;      |RFBORRA aAlfa;
|FPRC;

|PROCESO PortalValidacion;
     aFicheroE = "e" + (("00000" + #maempr10#0) % -105) + ".html";
     aAbre     = aDirServidor + aFicheroP;
     |XABRE "WB", aAbre, enHandle;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + "https://www2.agenciatributaria.gob.es/l/zi22zilk0022" + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + "SOV2200A" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + "ES" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "LEV" + &34 + " value=" + &34 + "000000000000" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIC" + &34 + " value=" + &34;
     |HAZ GrabaPortalSin;
     |XCIERRA enHandle;

     aDestino   = aDirServidor + aFicheroP;
     aOrigen    = aDirServidor + aFichero;

     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre = aDirServidor + aFicheroP;
     |XABRE "AB", aAbre, enHandle;

     eaAlfa = &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "RUT" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + "EWLINKYR" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + "2012" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + "200" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandle;

     aOrigen  = aDirServidor + aFicheroP;
     aDestino = aDirLanza + aFicheroP;
     |HAZ CopiaFichero;

     enErrorPortal = 0;
     |HAZ TraeDsaeatresp;

     aAlfa = aDirLanza + aFicheroE;  |RFBORRA aAlfa;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     aAbre = aDirLanza + "ejecutaweb.bat";
     |XABRE "WBC", aAbre, nHandle;

     aAlfa = aDirBase + "dsaeatresp " + aDirLanza + aFicheroP + " " + aDirLanza + aFicheroE;
     |XGRABA nHandle, aAlfa;

     |RSYSTEM aAbre;

     aAbre = aDirLanza + aFicheroE;
     |XABRE "UC", aAbre, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |PARA; |SI; |HACIENDO;
          |XLEE nHandle, 250, aAlfa;
          |SI FSalida < 0;  |SAL;  |FINSI;

          aAlfa1 = aAlfa < "";  |QBF aAlfa1;
          aAlfa2 = aAlfa1 - "<title>";
          |SI FSalida ! 0;
              aAlfa2 = aAlfa1 - "error";
              |SI FSalida ! 0;  enErrorPortal = 1;  |SAL;  |FINSI;

              aAlfa2 = aAlfa1 - "errónea";
              |SI FSalida ! 0;  enErrorPortal = 1;  |SAL;  |FINSI;
          |FINSI;
     |SIGUE;
     |XCIERRA nHandle;

     |SI enErrorPortal = 1;
         |CONFI "0000SHay errores. Quiere consultarlos";
         |SI FSalida = 0;
             eaForzExplorador = "N";
             enEjercicio      = enAnyo;
             |HAZ Explorador;

             |SI eaPathExplorador ! "";
                 aAlfa = eaPathExplorador + " " + aDirLanza + aFicheroE;
                 aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
             |SINO;
                 aAlfa  = "cmd " + &34 + "/c START /WAIT " + aDirLanza + aFicheroE + &34;
             |FINSI;

             |RSYSTEM aAlfa;
         |FINSI;
     |FINSI;

     aAlfa = aDirLanza + aFicheroE;         |RFBORRA aAlfa;
     aAlfa = aDirLanza + aFicheroP;         |RFBORRA aAlfa;
     aAlfa = aDirLanza + "ejecutaweb.bat";  |RFBORRA aAlfa;
|FPRC;

|PROCESO PortalImprime;
     |VENTANA 0501, 2399, -1, 16, "Generar PDF";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     aAlfa = "LABEL,{{10}}A continuaci¢n obtendremos el impreso.";
     aAlfa = aAlfa + " Luego se puede guardar el PDF en cualquier directorio ";
     aAlfa = aAlfa + "de la red.";
     |CONTROL_SIMPLE 0, aAlfa, 1045, 1398, NULL;

     aAlfa = "LABEL,{{10}}Es conveniente hacer un copiar al n£mero de justificante ";
     aAlfa = aAlfa + "porque luego lo pediremos.";
     |CONTROL_SIMPLE 0, aAlfa, 1445, 2698, NULL;

     |CONTROL_SIMPLE 0, "BOTON, Continuar", 1215, 1435, BotonContinuar;
     nBotonCont = FSalida;

     |PULSATECLA;
     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Cancelar," + nBotonCont;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVent;

     aAbre = aDirServidor + aFicheroP;
     |XABRE "WB", aAbre, enHandle;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + "https://www2.agenciatributaria.gob.es/l/zi21zilk0021" + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + "SOB2200A" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + "ES" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "LEV" + &34 + " value=" + &34 + "000000000000" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "F01" + &34 + " value=" + &34;
     |HAZ GrabaPortalSin;
     |XCIERRA enHandle;

     aDestino   = aDirServidor + aFicheroP;
     aOrigen    = aDirServidor + aFichero;

     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre = aDirServidor + aFicheroP;
     |XABRE "AB", aAbre, enHandle;

     eaAlfa = &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "ANA" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + "2012" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + "200" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + "EWLINKYQ" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandle;

     aOrigen  = aDirServidor + aFicheroP;
     aDestino = aDirLanza + aFicheroP;
     |HAZ CopiaFichero;

     eaForzExplorador = "N";
     enEjercicio      = #maempr02#1;
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + aDestino;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aDestino + &34;
     |FINSI;

     |RSYSTEM aAlfa;

     |VENTANA 0501, 1350, -1, 16, "N£mero de justificante obtenido";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     aAlfa = "LABEL,{{2}}N£mero de justificante ";
     |CONTROL_SIMPLE 0, aAlfa, 0902, 0920, NULL;

     E_inf   = "";
     E_sup   = "16";

     |PARA;  |SI;  |HACIENDO;
          eaJusti = 0922 ? 1;
          |CONFI "0000SEl n£mero introducido es correcto";
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVent;

     |PULSATECLA;

     eaImpre = "S";
     efFechaImpre = #isoy2012#1;

     aAlfa = aDirLanza + aFichero;      |RFBORRA aAlfa;
     aAlfa = aDirLanza + aFicheroP;     |RFBORRA aAlfa;
|FPRC;

|PROCESO BotonContinuar;
     |PTEC 806;
|FPRC;

|PROCESO BotonSalir;
     |PTEC 807;
|FPRC;

|PROCESO MandaAInternet;
     aOrigen  = aDirServidor + aFichero;
     aDestino = aDirInternet + aFichero;
     |HAZ CopiaFichero;

     aAlfa = "0000El fichero generado est  en " + aDestino + " para su presentaci¢n.";
     |MENAV aAlfa;

     eaImpre = "S";
     efFechaImpre = #isoy2012#1;
     eaJusti = "";
|FPRC;

|PROCESO ModoPresentacion;
     |VENTANA 0501, 2399, -1, 16, "Forma de env¡o";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     aAlfa = "LABEL,{{10}}A continuaci¢n elija el tipo de presentaci¢n";
     |CONTROL_SIMPLE 0, aAlfa, 1345, 2698, NULL;

     |CONTROL_SIMPLE 0, "BOTON, Internet", 1015, 1235, BotonContinuar;
     nBotonCont = FSalida;

     |CONTROL_SIMPLE 0, "BOTON, Presentaci¢n en PDF", 1415, 1635, BotonSalir;
     nBotonSal = FSalida;

     |PULSATECLA;
     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Cancelar," + nBotonCont;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVent;

     |SI aTecla = aEsc2;
         |HAZ PortalImprime;
         |ACABA;
     |FINSI;

     |SI aTecla = aEsc1;
         |HAZ MandaAInternet;
     |FINSI;
|FPRC;

|PROCESO Portal;
     |HAZ PonVentana;

     |SI PARAMETRO = "BORRADOR";
         |HAZ PortalBorrador;
         |HAZ QuitaVentana;
         |ACABA;
     |FINSI;

     aAlfa = aDirInternet + aFichero;   |RFBORRA aAlfa;

     |HAZ PortalValidacion;

     |SI enErrorPortal = 1;
         |HAZ QuitaVentana;

         |ACABA;
     |FINSI;

     aAlfa = #maempr10#3 % 101;
     |SI aAlfa = "A";  |O aAlfa = "B";
         |HAZ MandaAInternet;
         |HAZ QuitaVentana;
         |ACABA;
     |FINSI;

     |HAZ ModoPresentacion;

     |HAZ QuitaVentana;
|FPRC;

|PROCESO CierraSecuencial;
     |XCIERRA enHandle;

     aAbre      = aDirServidor + aFichero;

     |XABRE "BW", aAbre, enHandle;

     eaPagina  = eaPagina + "FIN";
     aLong     = eaPagina % 0;
     nLong     = aLong;
     nResto    = 600 - nLong;
     |SI nResto < 0;  nResto = 0;  |FINSI;

     nResto1 = 0;
     nResto2 = 0;
     nResto3 = 0;

     |SI nResto > 200;
         nResto1 = 200;
         nResto  = nResto - 200;
     |FINSI;

     |SI nResto > 200;
         nResto2 = 200;
         nResto  = nResto - 200;
     |FINSI;

     |SI nResto ! 0;
         nResto3 = nResto;
     |FINSI;

     eaAlfa = "<T2000" + #maempr10#1 + "0A0000>";  |HAZ GrabaSecuencial;
     eaAlfa = "<AUX>";       |HAZ GrabaSecuencial;
     eaAlfa = " " * 70;      |HAZ GrabaSecuencial;
     eaAlfa = "1.00";        |HAZ GrabaSecuencial;
     eaAlfa = "    ";        |HAZ GrabaSecuencial;
     eaAlfa = "B53179768";   |HAZ GrabaSecuencial;
     eaAlfa = " " * 213;     |HAZ GrabaSecuencial;
     eaAlfa = "</AUX>";      |HAZ GrabaSecuencial;
     eaAlfa = "<VECTOR>";    |HAZ GrabaSecuencial;
     eaAlfa = eaPagina;      |HAZ GrabaSecuencial;
     eaAlfa = " " * nResto1; |HAZ GrabaSecuencial;
     eaAlfa = " " * nResto2; |HAZ GrabaSecuencial;
     eaAlfa = " " * nResto3; |HAZ GrabaSecuencial;
     eaAlfa = "</VECTOR>";   |HAZ GrabaSecuencial;
     |XCIERRA enHandle;

     aDestino   = aDirServidor + aFichero;
     aOrigen    = aDirServidor + aFicheroT;

     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre      = aDirServidor + aFichero;

     |XABRE "BA", aAbre, enHandle;
     eaAlfa = "</T2000" + #maempr10#1 + "0A0000>";  |HAZ GrabaSecuencial;

     eaAlfa = &13 + &10;  |HAZ GrabaSecuencial;
     |XCIERRA enHandle;

     |HAZ Portal;

     |SI PARAMETRO = "BORRADOR";
         aAbre = aDirServidor + aFichero;   |FBORRA aAbre;
         |ACABA;
     |FINSI;

     aAlfa = aDirServidor + aFicheroT;  |FBORRA aAlfa;
     aAlfa = aDirServidor + aFichero;   |FBORRA aAlfa;
|FPRC;

|PROCESO Lee201;
     aContenido = "0";

     #maempr11#0 = #maempr10#0;
     #maempr11#1 = #maempr10#1;
     #maempr11#2 = nCasilla;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         aContenido = "1";
     |FINSI;
|FPRC;

|PROCESO maempr04;
     nContaBucle = nContaBucle + 1;
     |SI nContaBucle = 1;
         #isoh1201#83 = #maempr04#3;
         #isoh1201#84 = #maempr04#4;
         #isoh1201#85 = (#maempr04#5 % -104) + (#maempr04#5 % 402) + (#maempr04#5 % 102);
         #isoh1201#86 = #maempr04#6;
     |FINSI;

     |SI nContaBucle = 2;
         #isoh1201#87 = #maempr04#3;
         #isoh1201#88 = #maempr04#4;
         #isoh1201#89 = (#maempr04#5 % -104) + (#maempr04#5 % 402) + (#maempr04#5 % 102);
         #isoh1201#90 = #maempr04#6;
     |FINSI;

     |SI nContaBucle = 3;
         #isoh1201#91 = #maempr04#3;
         #isoh1201#92 = #maempr04#4;
         #isoh1201#93 = (#maempr04#5 % -104) + (#maempr04#5 % 402) + (#maempr04#5 % 102);
         #isoh1201#94 = #maempr04#6;
     |FINSI;
|FPRC;

|DEFBUCLE maempr04;
     #maempr04#1;
     ;
     #maempr10#0, #maempr10#1, 00;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, maempr04;
|FIN;

|PROCESO Hoja1;
     eaPagina = "010";

     |DDEFECTO #isoh1201;

     #isoh1201#6  = #maempr10#31 % -104;           || Del A¤o
     #isoh1201#7  = #maempr10#31 % 402;            || Del Mes
     #isoh1201#8  = #maempr10#31 % 102;            || Del Dia
     #isoh1201#9  = #maempr10#32 % -104;           || Al A¤o
     #isoh1201#10 = #maempr10#32 % 402;            || Al Mes
     #isoh1201#11 = #maempr10#32 % 102;            || Al Dia
     |SI #maempr10#31 = "01.01.2012";  |Y #maempr10#32 = "31.12.2012";
         #isoh1201#12 = "1";                    || Todo el Ejercicio
     |SINO;
         fFechaD = #maempr10#31;
         fFechaH = #maempr10#32;
         nFecha  = (fFechaH - fFechaD) + 1;
         |SI nFecha ] 365;
             #isoh1201#12 = "2";                || No coincide con el A¤o Natural
         |SINO;
             #isoh1201#12 = "3";                || No todo el Ejercicio
         |FINSI;
     |FINSI;

     |ABRE #agim0019;
     #agim0019#0 = #maempr10#0;
     #agim0019#1 = 99;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
         |LEE 000#agim0019.a;
     |SINO;
         |LEE 000#agim0019.u;
     |FINSI;
     |CIERRA #agim0019;

     aCNAE = "";
     |SI FSalida = 0;  |Y #agim0019#0 = #maempr10#0;
         aCNAE = #agim0019#81;
     |FINSI;

     #isoh1201#13 = aCNAE;                    || CNAE
     #isoh1201#14 = #maempr10#3;              || NIF
     #isoh1201#15 = #maempr10#2;              || Razon Social
     #isoh1201#16 = #maempr10#15;             || Telefono 1
     #isoh1201#17 = "";                       || Telefono 2
     #isoh1201#18 = "2012";

     |ABRE #maempr11;
     nCasilla = 1;   |HAZ Lee201;  #isoh1201#19 = aContenido;
     nCasilla = 2;   |HAZ Lee201;  #isoh1201#20 = aContenido;
     nCasilla = 3;   |HAZ Lee201;  #isoh1201#21 = aContenido;
     nCasilla = 4;   |HAZ Lee201;  #isoh1201#22 = aContenido;
     nCasilla = 5;   |HAZ Lee201;  #isoh1201#23 = aContenido;
     nCasilla = 11;  |HAZ Lee201;  #isoh1201#24 = aContenido;
     nCasilla = 13;  |HAZ Lee201;  #isoh1201#25 = aContenido;
     nCasilla = 14;  |HAZ Lee201;  #isoh1201#26 = aContenido;
     nCasilla = 17;  |HAZ Lee201;  #isoh1201#27 = aContenido;
     nCasilla = 18;  |HAZ Lee201;  #isoh1201#28 = aContenido;
     nCasilla = 19;  |HAZ Lee201;  #isoh1201#29 = aContenido;
     nCasilla = 21;  |HAZ Lee201;  #isoh1201#30 = aContenido;
     nCasilla = 23;  |HAZ Lee201;  #isoh1201#31 = aContenido;
     nCasilla = 24;  |HAZ Lee201;  #isoh1201#32 = aContenido;
     nCasilla = 25;  |HAZ Lee201;  #isoh1201#33 = aContenido;
     nCasilla = 31;  |HAZ Lee201;  #isoh1201#34 = aContenido;
     nCasilla = 32;  |HAZ Lee201;  #isoh1201#35 = aContenido;
     nCasilla = 36;  |HAZ Lee201;  #isoh1201#36 = aContenido;
     nCasilla = 48;  |HAZ Lee201;  #isoh1201#37 = aContenido;
     nCasilla = 58;  |HAZ Lee201;  #isoh1201#38 = aContenido;
     nCasilla = 60;  |HAZ Lee201;  #isoh1201#39 = aContenido;
     nCasilla = 6;   |HAZ Lee201;  #isoh1201#40 = aContenido;
     nCasilla = 15;  |HAZ Lee201;  #isoh1201#41 = aContenido;
     nCasilla = 22;  |HAZ Lee201;  #isoh1201#42 = aContenido;
     nCasilla = 28;  |HAZ Lee201;  #isoh1201#43 = aContenido;
     nCasilla = 47;  |HAZ Lee201;  #isoh1201#44 = aContenido;
     nCasilla = 49;  |HAZ Lee201;  #isoh1201#45 = aContenido;
     nCasilla = 29;  |HAZ Lee201;  #isoh1201#46 = aContenido;
     nCasilla = 33;  |HAZ Lee201;  #isoh1201#47 = aContenido;
     nCasilla = 34;  |HAZ Lee201;  #isoh1201#48 = aContenido;
     nCasilla = 38;  |HAZ Lee201;  #isoh1201#49 = aContenido;
     nCasilla = 46;  |HAZ Lee201;  #isoh1201#50 = aContenido;
     nCasilla = 12;  |HAZ Lee201;  #isoh1201#51 = aContenido;
     nCasilla = 57;  |HAZ Lee201;  #isoh1201#52 = aContenido;
     nCasilla = 20;  |HAZ Lee201;  #isoh1201#53 = aContenido;
     nCasilla = 56;  |HAZ Lee201;  #isoh1201#54 = aContenido;
     nCasilla = 7;   |HAZ Lee201;  #isoh1201#55 = aContenido;
     nCasilla = 8;   |HAZ Lee201;  #isoh1201#56 = aContenido;
     nCasilla = 9;   |HAZ Lee201;  #isoh1201#57 = aContenido;
     nCasilla = 10;  |HAZ Lee201;  #isoh1201#58 = aContenido;
     nCasilla = 16;  |HAZ Lee201;  #isoh1201#60 = aContenido;
     nCasilla = 26;  |HAZ Lee201;  #isoh1201#61 = aContenido;
     nCasilla = 27;  |HAZ Lee201;  #isoh1201#62 = aContenido;
     nCasilla = 30;  |HAZ Lee201;  #isoh1201#63 = aContenido;
     nCasilla = 35;  |HAZ Lee201;  #isoh1201#64 = aContenido;
     nCasilla = 37;  |HAZ Lee201;  #isoh1201#65 = aContenido;
     nCasilla = 39;  |HAZ Lee201;  #isoh1201#66 = aContenido;
     nCasilla = 43;  |HAZ Lee201;  #isoh1201#67 = aContenido;
     nCasilla = 44;  |HAZ Lee201;  #isoh1201#68 = aContenido;
     nCasilla = 45;  |HAZ Lee201;  #isoh1201#69 = aContenido;
     nCasilla = 62;  |HAZ Lee201;  #isoh1201#70 = aContenido;

     #isoh1201#59 = "0";

     |ABRE #isom0205;
     #isom0205#0 = #maempr10#0;
     #isom0205#1 = #maempr10#1;
     |LEE 000#isom0205.=;
     |SI FSalida = 0;
         #isoh1201#59 = "1";
     |FINSI;
     |CIERRA #isom0205;

     #isoh1201#73 = "0";
     |SI #maempr10#113 = "S";  #isoh1201#73 = "1";  |FINSI;

     |ABRE #ca8m0000;
     |DDEFECTO #ca8m0000;
     #ca8m0000#0 = #maempr10#101;
     |LEE 000#ca8m0000.=;
     #isoh1201#71 = #ca8m0000#2;

     #isoh1201#72 = "0";
     |SI #isoh1201#61 = "0";
         |DDEFECTO #ca8m0000;
         #ca8m0000#0 = #maempr10#102;
         |LEE 000#ca8m0000.=;
         #isoh1201#72 = #ca8m0000#2;
         |CIERRA #ca8m0000;
     |FINSI;

     nCasilla = 9;  |HAZ Lee201;
     |SI #maempr11#4 ! 0;
          aAlfa = ("000000" + #maempr11#4) % -106;
          aAlfa = (aAlfa % 104) + "/" + (aAlfa % 502);

          #isoh1201#74 = aAlfa;
          #isoh1201#75 = #maempr11#5;
     |SINO;
          nCasilla = 10;  |HAZ Lee201;
          |SI #maempr11#4 ! 0;
              aAlfa = ("000000" + #maempr11#4) % -106;
              aAlfa = (aAlfa % 104) + "/" + (aAlfa % 502);

              #isoh1201#74 = aAlfa;
              #isoh1201#75 = #maempr11#5;
          |FINSI;
     |FINSI;

     |CIERRA #maempr11;

     nNume   = #maempr10#75 * 100;
     #isoh1201#76 = ("0000000000" + nNume) % -109;  || Empleados fijos
     nNume   = #maempr10#76 * 100;
     #isoh1201#77 = ("0000000000" + nNume) % -109;  || Empleados si fijos

     #isoh1201#78 = "0";
     #isoh1201#79 = "0000000000000";

     |SI #maempr10#98 = "S";
         #isoh1201#78 = "1";
         aAlfa1  = #maempr10#99;  |QBT aAlfa1;
         aAlfa2  = #maempr10#100; |QBT aAlfa2;
         #isoh1201#79 = ("0000000000000" + aAlfa1 + aAlfa2) % -113;  || N§ Justificante
     |FINSI;

     #isoh1201#80 = #maempr10#77;                          || Nombre Secretario
     #isoh1201#81 = #maempr10#78;                          || NIF    Secretario
     #isoh1201#82 = "00000000";
     |SI #isoh1201#30 = "1";
         #isoh1201#82 = (#isoy2012#1 % -104) + (#isoy2012#1 % 402) + (#isoy2012#1 % 102);
     |FINSI;

     nContaBucle = 0;    |BUCLE maempr04;

     |SI #isoh1201#85 = "        ";  #isoh1201#85 = "00000000";  |FINSI;
     |SI #isoh1201#89 = "        ";  #isoh1201#89 = "00000000";  |FINSI;
     |SI #isoh1201#93 = "        ";  #isoh1201#93 = "00000000";  |FINSI;

     |DDEFECTO #zregpres;
     #zregpres#0 = #maempr10#1;
     |LEE 000#zregpres.=;
     |CIERRA #zregpres;

     #isoh1201#97  = #zregpres#1;
     nNume    = #zregpres#6;  #isoh1201#98 = (("000000000" + nNume) % -109);
     nNume    = #zregpres#7;  #isoh1201#99 = (("000000000" + nNume) % -109);
     #isoh1201#100 = #zregpres#8;

     |PARA nCampo = 1;  |SI nCampo [ 102;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isoh1201#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO maempr03;
     nContaBucle  = nContaBucle + 1;
     #isoh0902#0       = ((nContaBucle / 6) + .49) ! 0;
     nContaBucleL = (nContaBucle + 5) - (6 * #isoh0902#0);

     |LEE 101#isoh0902.=;
     |SI FSalida ! 0;
         |DDEFECTO #isoh0902;
         #isoh0902#0 = ((nContaBucle / 6) + .49) ! 0;

                          #isoh0902#5 = "";
         |SI #isoh0902#0 ! 1;  #isoh0902#5 = "C";  nComple = 1;  |FINSI;

         #isoh0902#2   = "200";
         #isoh0902#3   = "020";
         #isoh0902#146 = "</T200020>";

         eaPagina = eaPagina + "020";

         |GRABA 020#isoh0902.b;
     |FINSI;

     nPuntero     = (nContaBucleL * 6) + 6;
     #isoh0902#nPuntero# = #maempr03#3;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = #maempr03#4;

                        aAlfa = "0";
     |SI #maempr03#8 = "X";  aAlfa = "1";  |FINSI;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = aAlfa;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = #maempr03#5;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = #maempr03#6;

     |SI #isoh1201#30 = "1";
         nPuntero     = nPuntero + 1;
         aAlfa        = ("00" + #maempr03#7) % -102;
         #isoh0902#nPuntero# = aAlfa;
     |FINSI;

     |GRABA 020#isoh0902.a;
     |LIBERA #isoh0902;
|FPRC;

|DEFBUCLE maempr03;
     #maempr03#1;
     ;
     #maempr10#0, #maempr10#1, 00;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, maempr03;
|FIN;

|PROCESO maempr06;
     nContaBucle  = nContaBucle + 1;
     #isoh0902#0       = ((nContaBucle / 4) + .49) ! 0;
     nContaBucleL = (nContaBucle + 3) - (4 * #isoh0902#0);

     |LEE 101#isoh0902.=;
     |SI FSalida ! 0;
         |DDEFECTO #isoh0902;
         #isoh0902#0     = ((nContaBucle / 4) + .49) ! 0;

                          #isoh0902#5 = "";
         |SI #isoh0902#0 ! 1;  #isoh0902#5 = "C";  nComple = 1;  |FINSI;

         #isoh0902#2   = "200";
         #isoh0902#3   = "020";
         #isoh0902#146 = "</T200020>";

         eaPagina = eaPagina + "020";

         |GRABA 020#isoh0902.b;
     |FINSI;

     nPuntero     = (nContaBucleL * 15) + 42;
     #isoh0902#nPuntero# = #maempr06#3;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = #maempr06#4;

     nPuntero     = nPuntero + 1;
     aAlfa        = ("00" + #maempr06#5) % -102;
     #isoh0902#nPuntero# = aAlfa;

     nPuntero     = nPuntero + 1;
     enCanti       = #maempr06#7;
     |HAZ Calcula3E2D;
     #isoh0902#nPuntero# = eaAlfa;

     nPuntero     = nPuntero + 1;
     enCanti       = #maempr06#6;
     |HAZ Calcula17D;
     #isoh0902#nPuntero# = eaAlfa;

     |PARA nCampo = 8;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
           nPuntero  = nPuntero + 1;
           enCanti   = #maempr06#nCampo#;
           |HAZ Calcula17D;
           #isoh0902#nPuntero# = eaAlfa;
     |SIGUE;

     |PARA nCampo = 16;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
           nPuntero  = nPuntero + 1;
           enCanti   = #maempr06#nCampo#;
           |HAZ Calcula17D;
           #isoh0902#nPuntero# = eaAlfa;
     |SIGUE;

     |GRABA 020#isoh0902.a;
     |LIBERA #isoh0902;
|FPRC;

|DEFBUCLE maempr06;
     #maempr06#1;
     ;
     #maempr10#0, #maempr10#1, 00;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, maempr06;
|FIN;

|PROCESO maempr02;
     nContaBucle  = nContaBucle + 1;
     #isoh0902#0       = ((nContaBucle / 6) + .49) ! 0;
     nContaBucleL = (nContaBucle + 5) - (6 * #isoh0902#0);

     |LEE 101#isoh0902.=;
     |SI FSalida ! 0;
         |DDEFECTO #isoh0902;
         #isoh0902#0 = ((nContaBucle / 6) + .49) ! 0;

                          #isoh0902#5 = "";
         |SI #isoh0902#0 ! 1;  #isoh0902#5 = "C";  nComple = 1;  |FINSI;

         #isoh0902#3   = "020";
         #isoh0902#146 = "</T200020>";

         eaPagina = eaPagina + "020";

         |GRABA 020#isoh0902.b;
     |FINSI;

     nPuntero     = (nContaBucleL * 7) + 102;
     #isoh0902#nPuntero# = #maempr02#3;

                        aAlfa = "0";
     |SI #maempr02#9 = "X";  aAlfa = "1";  |FINSI;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = aAlfa;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = #maempr02#4;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = #maempr02#5;

     nPuntero     = nPuntero + 1;
     aAlfa        = #maempr02#6;  |QBT aAlfa;
     aAlfa        = ("00" + aAlfa) % -102;
     #isoh0902#nPuntero# = aAlfa;

     nPuntero     = nPuntero + 1;
     enCanti       = #maempr02#7;
     |HAZ Calcula17D;
     #isoh0902#nPuntero# = eaAlfa;

     nPuntero     = nPuntero + 1;
     enCanti       = #maempr02#8;
     |HAZ Calcula3E2D;
     #isoh0902#nPuntero# = eaAlfa;

     |GRABA 020#isoh0902.a;
     |LIBERA #isoh0902;
|FPRC;

|DEFBUCLE maempr02;
     #maempr02#1;
     ;
     #maempr10#0, #maempr10#1, 00;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, maempr02;
|FIN;

|PROCESO isoh0902;
     |PARA nCampo = 1;  |SI nCampo [ 146;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isoh0902#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isoh0902;
     #isoh0902#1;
     ;
     01;
     99;
     ;
     NULL, isoh0902;
|FIN;

|PROCESO Hoja2;
     aDelindex = ("h1" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #isoh0902#aDelindex#;
     |ABRE #isoh0902; |CIERRA #isoh0902; |DELINDEX #isoh0902;

     |ABRE #isoh0902;
     #isoh0902#0 = 1;
     |LEE 101#isoh0902.=;
     |SI FSalida ! 0;
         |DDEFECTO #isoh0902;
         #isoh0902#0   = 1;
         #isoh0902#3   = "020";
         #isoh0902#5   = "";
         #isoh0902#2   = "200";
         #isoh0902#3   = "020";
         #isoh0902#146 = "</T200020>";

         |SI #maempr10#73 > 100;  #maempr10#73 = 0;  #maempr10#74 = 0;  |FINSI;
         |SI #maempr10#74 > 100;  #maempr10#73 = 0;  #maempr10#74 = 0;  |FINSI;

         |SI #isoh0902#5 = " ";
             enCanti   = #maempr10#73;
             |HAZ Calcula3E2D;
             #isoh0902#144 = eaAlfa;

             enCanti   = #maempr10#74;
             |HAZ Calcula3E2D;
             #isoh0902#145 = eaAlfa;
         |FINSI;

         eaPagina = eaPagina + "020";

         |GRABA 020#isoh0902.n;
         |LIBERA #isoh0902;
     |FINSI;

     nContaBucle = 0;    |BUCLE maempr03;
     nContaBucle = 0;    |BUCLE maempr06;
     nContaBucle = 0;    |BUCLE maempr02;

     |CIERRA #isoh0902;

     |BUCLE isoh0902;

     |ABRE #isoh0902; |CIERRA #isoh0902; |DELINDEX #isoh0902;
|FPRC;

|PROCESO isom0501;
     |SI #isom0501#2 = "     ";  |ACABA;  |FINSI;

     #isom0002#0 = #maempr10#0;
     #isom0002#1 = #maempr10#1;
     #isom0002#2 = #isom0501#1;
     |LEE 000#isom0002.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0002;  |FINSI;

     enCanti  = #isom0002#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isom0501;
      #isom0501#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0501;
|FIN;

|PROCESO Hoja3;
     eaPagina = eaPagina + "030";

     eaAlfa = "<T200030> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0002;
     nDesde = 15;
     nHasta = 255;
     |BUCLE isom0501;
     |CIERRA #isom0002;

     eaAlfa = "</T200030>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja4;
     eaPagina = eaPagina + "040";

     eaAlfa = "<T200040> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0002;
     nDesde = 260;
     nHasta = 415;
     |BUCLE isom0501;
     |CIERRA #isom0002;

     eaAlfa = "</T200040>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja5;
     eaPagina = eaPagina + "050";

     eaAlfa = "<T200050> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0002;
     nDesde = 455;
     nHasta = 670;
     |BUCLE isom0501;
     |CIERRA #isom0002;

     eaAlfa = "</T200050>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja6;
     eaPagina = eaPagina + "060";

     eaAlfa = "<T200060> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0002;
     nDesde = 680;
     nHasta = 800;
     |BUCLE isom0501;
     |CIERRA #isom0002;

     eaAlfa = "</T200060>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0502;
     |SI #isom0502#2 = "     ";  |ACABA;  |FINSI;

     #isom0003#0 = #maempr10#0;
     #isom0003#1 = #maempr10#1;
     #isom0003#2 = #isom0502#1;
     |LEE 000#isom0003.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0003;  |FINSI;

     enCanti  = #isom0003#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isom0502;
      #isom0502#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0502;
|FIN;

|PROCESO Hoja7;
     eaPagina = eaPagina + "070";

     eaAlfa = "<T200070> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0003;
     nDesde = 15;
     nHasta = 260;
     |BUCLE isom0502;
     |CIERRA #isom0003;

     eaAlfa = "</T200070>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja8;
     eaPagina = eaPagina + "080";

     eaAlfa = "<T200080> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0003;
     nDesde = 265;
     nHasta = 440;
     |BUCLE isom0502;
     |CIERRA #isom0003;

     eaAlfa = "</T200080>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0503;
     |SI #isom0503#2 = "     ";  |ACABA;  |FINSI;

     #isom0004#0 = #maempr10#0;
     #isom0004#1 = #maempr10#1;
     #isom0004#2 = #isom0503#1;
     |LEE 000#isom0004.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0004;  |FINSI;

     enCanti  = #isom0004#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isom0503;
      #isom0503#1;
      ;
      #maempr10#1, 0000;
      #maempr10#1, 9999;
      ;
      NULL, isom0503;
|FIN;

|PROCESO Hoja9;
     |SI #isoh1201#71 = "3";  |ACABA;  |FINSI;

     eaPagina = eaPagina + "090";

     eaAlfa = "<T200090> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0004;
     |BUCLE isom0503;
     |CIERRA #isom0004;

     eaAlfa = "</T200090>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0504;
     |SI #isom0504#2 = "     ";  |ACABA;  |FINSI;

     #isom0005#0 = #maempr10#0;
     #isom0005#1 = #maempr10#1;
     #isom0005#2 = #isom0504#1;
     |LEE 000#isom0005.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0005;  |FINSI;

     enCanti  = #isom0005#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isom0504;
      #isom0504#2;
      ;
      #maempr10#1, "     ", nDesde;
      #maempr10#1, "zzzzz", nHasta;
      ;
      NULL, isom0504;
|FIN;

|PROCESO Hoja10;
     eaPagina = eaPagina + "100";

     eaAlfa = "<T200100> ";  |HAZ GrabaSecuencial;

     nDesde = 5;
     nHasta = 700;

     |ABRE #isom0005;
     |BUCLE isom0504;
     |CIERRA #isom0005;

     eaAlfa = "</T200100>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja11;
     eaPagina = eaPagina + "110";

     eaAlfa = "<T200110> ";  |HAZ GrabaSecuencial;

     nDesde = 705;
     nHasta = 1345;

     |ABRE #isom0005;
     |BUCLE isom0504;
     |CIERRA #isom0005;

     eaAlfa = "</T200110>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0500;
     |SI #isom0500#2 = "900  ";  |ACABA;  |FINSI;
     |SI #isom0500#2 = "901  ";  |ACABA;  |FINSI;
     |SI #isom0500#2 = "     ";  |ACABA;  |FINSI;

     #isom0001#0 = #maempr10#0;
     #isom0001#1 = #maempr10#1;
     #isom0001#2 = #isom0500#1;
     |LEE 000#isom0001.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0001;  |FINSI;

     |SI #isom0500#2 ! "558  ";
         enCanti  = #isom0001#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |SINO;
         enCanti  = #isom0001#5;  |HAZ Calcula2E2D; |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0500;
      #isom0500#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0500;
|FIN;

|DEFBUCLE isom0500_2;
      #isom0500#2;
      ;
      #maempr10#1, aDesde, nDesde;
      #maempr10#1, aHasta, nHasta;
      ;
      NULL, isom0500;
|FIN;

|PROCESO isom0505;
     #isom0006#0 = #maempr10#0;
     #isom0006#1 = #maempr10#1;
     #isom0006#2 = #isom0505#1;
     |LEE 000#isom0006.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0006;  |FINSI;

     |SI #isom0505#2 ! "     ";
         enCanti  = #isom0006#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0505#3 ! "     ";
         enCanti  = #isom0006#7;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0505;
      #isom0505#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0505;
|FIN;

|PROCESO Hoja12;
     eaPagina = eaPagina + "120";

     eaAlfa = "<T200120> ";  |HAZ GrabaSecuencial;

     nDesde = 5;
     nHasta = 25;

     |ABRE #isom0001;
     |BUCLE isom0500;
     |CIERRA #isom0001;

     nDesde = 5;
     nHasta = 230;

     |ABRE #isom0006;
     |BUCLE isom0505;
     |CIERRA #isom0006;

     eaAlfa = "</T200120>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja13;
     eaPagina = eaPagina + "130";

     eaAlfa = "<T200130> ";  |HAZ GrabaSecuencial;

     nDesde = 235;
     nHasta = 340;

     |ABRE #isom0006;
     |BUCLE isom0505;
     |CIERRA #isom0006;

     nDesde = 40;
     nHasta = 190;

     |ABRE #isom0001;
     |BUCLE isom0500;
     |CIERRA #isom0001;

     eaAlfa = "</T200130>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja14;
     eaPagina = eaPagina + "140";

     eaAlfa = "<T200140> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0001;
     nDesde = 205;  nHasta = 330;  |BUCLE isom0500;
     nDesde = 425;  nHasta = 435;  |BUCLE isom0500;

     aDesde = "599"; aHasta = "616";
     nDesde = 440;   nHasta = 590;  |BUCLE isom0500_2;

     aDesde = "633"; aHasta = "642";
     nDesde = 440;   nHasta = 590;  |BUCLE isom0500_2;

     aDesde = "617"; aHasta = "622";
     nDesde = 440;   nHasta = 590;  |BUCLE isom0500_2;

     |CIERRA #isom0001;

     eaAlfa = "</T200140>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0507;
     #isom0009#0 = #maempr10#0;
     #isom0009#1 = #maempr10#1;
     #isom0009#2 = #isom0507#1;
     |LEE 000#isom0009.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0009;  |FINSI;

     |SI #isom0507#3 ! "     ";
         eaAlfa = #isom0009#4;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0507#4 ! "     ";
        enCanti  = #isom0009#6;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0507#5 ! "     ";
        enCanti  = #isom0009#8;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0507#6 ! "     ";
        enCanti  = #isom0009#10; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0507;
      #isom0507#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0507;
|FIN;

|PROCESO isom0509;
     #isom0012#0 = #maempr10#0;
     #isom0012#1 = #maempr10#1;
     #isom0012#2 = #isom0509#1;
     |LEE 000#isom0012.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0012;  |FINSI;

     |SI #isom0509#2 ! "     ";
         enCanti  = #isom0012#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0509#3 ! "     ";
         |SI #isom0509#3 ! "103  ";
             enCanti  = #isom0012#7;  |HAZ Calcula2E2D; |HAZ GrabaSecuencial;
         |SINO;
             enCanti  = #isom0012#7;  |HAZ Calcula3E4D; |HAZ GrabaSecuencial;
         |FINSI;
     |FINSI;

     |SI #isom0509#4 ! "     ";
         enCanti  = #isom0012#9;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0509#5 ! "     ";
         enCanti  = #isom0012#11; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0509#6 ! "     ";
         enCanti  = #isom0012#13; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0509;
      #isom0509#1;
      ;
      #maempr10#1, 0000;
      #maempr10#1, 9999;
      ;
      NULL, isom0509;
|FIN;

|PROCESO Hoja15;
     eaCasilla = "670";  |HAZ LeeFich109;  nValor1 = #isom0009#6;
     eaCasilla = "116";  |HAZ LeeFich112;  nValor2 = #isom0012#5;
     eaCasilla = "131";  |HAZ LeeFich112;  nValor3 = #isom0012#5;
     eaCasilla = "160";  |HAZ LeeFich112;  nValor4 = #isom0012#5;
     eaCasilla = "171";  |HAZ LeeFich112;  nValor5 = #isom0012#5;

     nSuma = nValor1 + nValor2 + nValor3 + nValor4 + nValor5
     |SI nSuma = 0;  |ACABA;  |FINSI;

     eaPagina = eaPagina + "150";

     eaAlfa = "<T200150> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0009;
     |SELECT #1#isom0009;
     nDesde = 5;    nHasta = 85;   |BUCLE isom0507;
     |CIERRA #isom0009;

     |ABRE #isom0012;
     |SELECT #1#isom0012;
     |BUCLE isom0509;
     |CIERRA #isom0012;

     eaAlfa = "</T200150>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0508;
     #isom0011#0 = #maempr10#0;
     #isom0011#1 = #maempr10#1;
     #isom0011#2 = #isom0508#1;
     |LEE 000#isom0011.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0011;  |FINSI;

     |SI #isom0508#2 ! "     ";
         enCanti  = #isom0011#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0508#3 ! "     ";
         enCanti  = #isom0011#7;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0508#4 ! "     ";
         enCanti  = #isom0011#9;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0508;
      #isom0508#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0508;
|FIN;

|PROCESO Hoja16;
     eaCasilla = "841";  |HAZ LeeFich111;  nValor1 = #isom0011#5;
     eaCasilla = "764";  |HAZ LeeFich111;  nValor2 = #isom0011#5;
     eaCasilla = "886";  |HAZ LeeFich111;  nValor3 = #isom0011#5;

     nSuma = nValor1 + nValor2 + nValor3 + #isom0000#66;
     nSuma = nSuma   + #isom0000#70 + #isom0000#74 + #isom0000#106 + #isom0000#112;
     |SI nSuma = 0;  |ACABA;  |FINSI;

     eaPagina = eaPagina + "160";

     eaAlfa = "<T200160> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 10;    nHasta = 65;    |BUCLE isom0508;
     nDesde = 80;    nHasta = 110;   |BUCLE isom0508;

     |SI #isom0000#64 = " ";  #isom0000#64 = "0";  |FINSI;
     |SI #isom0000#68 = " ";  #isom0000#68 = "0";  |FINSI;

     enCanti = #isom0000#70;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#71;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#72;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#74;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#75;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#76;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#77;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#106; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#107; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#108; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#109; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#112; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#113; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#114; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#115; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#116; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#117; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#118; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#119; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#78;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti = #isom0000#79;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;

     nDesde = 125;   nHasta = 235;   |BUCLE isom0508;
     |CIERRA #isom0011;

     eaAlfa = "</T200160>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja17;
     eaCasilla = "831";  |HAZ LeeFich111;  nSuma = #isom0011#5;

     |SI nSuma = 0;  |ACABA;  |FINSI;

     eaPagina = eaPagina + "170";

     eaAlfa = "<T200170> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 250;   nHasta = 550; |BUCLE isom0508;
     |CIERRA #isom0011;

     eaAlfa = "</T200170>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Graba107;
     enCanti  = #isom0007#5; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0007#7; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Graba108;
     #isom0506#0  = #maempr11#1;
     #isom0506#1  = eaCasilla;
     |LEE 000#isom0506.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0506;  |FINSI;

     |SI #isom0506#2 ! "     ";
         enCanti  = #isom0008#5; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0506#3 ! "     ";
         enCanti  = #isom0008#7; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|PROCESO isom0016;
     nContaBucle  = nContaBucle + 1;

     |SI nContaBucle = 1;
         aAlfa1 = #isom0016#3;
     |FINSI;

     |SI nContaBucle = 2;
         aAlfa2 = #isom0016#3;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE isom0016;
     #isom0016#1;
     ;
     #maempr10#0, #maempr10#1, 01;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, isom0016;
|FIN;

|PROCESO Hoja18;
     eaCasilla = "598";   |HAZ LeeFich111;  nValor  = #isom0011#5;
     eaCasilla = "417";   |HAZ LeeFich107;  nValor  = nValor + #isom0007#5 + #isom0007#7;
     eaCasilla = "051";   |HAZ LeeFich107;  nValor  = nValor + #isom0007#5 + #isom0007#7;

     |PARA nCampo = 84;  |SI nCampo [ 105;  |HACIENDO nCampo = nCampo + 1;
           nValor = nValor + #isom0000#nCampo#;
     |SIGUE;

     |ABRE #isom0016;
     #isom0016#0 = #maempr10#0;
     #isom0016#1 = #maempr10#1;
     #isom0016#2 = 1;
     |LEE 000#isom0016.];
     |SI FSalida = 0;  |Y  #isom0016#0 = #maempr10#0;  |Y #isom0016#1 = #maempr10#1;
         nValor = 1;
     |FINSI;
     |CIERRA #isom0016;

     |SI nValor = 0;  |ACABA;  |FINSI;

     eaPagina = eaPagina + "180";

     eaAlfa = "<T200180> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 565;   nHasta = 625; |BUCLE isom0508;
     |CIERRA #isom0011;

     enCanti  = #isom0000#84;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#85;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#86 + #isom0000#87;
                          |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#88;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#89 + #isom0000#90 + #isom0000#91 + #isom0000#92;
                          |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#93;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#94 + #isom0000#95;
                          |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#96;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#97;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#98;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#100; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#99 + #isom0000#101 + #isom0000#102 + #isom0000#103;
                          |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#104; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#105; |HAZ Calcula17D;  |HAZ GrabaSecuencial;

     eaCasilla = "001";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "003";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "027";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "005";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "029";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "007";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "031";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "009";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "033";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "011";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "035";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "013";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "037";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "015";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "039";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "017";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "041";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "019";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "043";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "021";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "045";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "023";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "047";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "025";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "049";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "417";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "051";  |HAZ LeeFich107;  |HAZ Graba107;

     aAlfa1 = "                      ";
     aAlfa2 = "                      ";

     nContaBucle  = 0;
     |BUCLE isom0016;

     eaAlfa = aAlfa1;  |HAZ GrabaSecuencial;
     eaAlfa = aAlfa2;  |HAZ GrabaSecuencial;

     eaAlfa = "</T200180>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0510;
     #isom0022#0 = #maempr10#0;
     #isom0022#1 = #maempr10#1;
     #isom0022#2 = #isom0510#1;
     |LEE 000#isom0022.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0022;  |FINSI;

     |SI nPasada = 0;
         |SI #isom0022#5 ! 0;
             nHay = 1;
             |ERROR10;
         |FINSI;

         |ACABA;
     |FINSI;

     |SI #isom0510#2 ! "     ";
         enCanti  = #isom0022#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0510;
      #isom0510#1;
      ;
      #maempr10#1, 0000;
      #maempr10#1, 9999;
      ;
      NULL, isom0510;
|FIN;

|PROCESO isom0511;
     #isom0023#0 = #maempr10#0;
     #isom0023#1 = #maempr10#1;
     #isom0023#2 = #isom0511#1;
     |LEE 000#isom0023.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0023;  |FINSI;

     |SI nPasada = 0;
         nSuma = #isom0023#5 + #isom0023#7 + #isom0023#9;
         |SI nSuma ! 0;
             nHay = 1;
             |ERROR10;
         |FINSI;

         |ACABA;
     |FINSI;

     |SI #isom0511#2 ! "     ";
         enCanti  = #isom0023#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0511#3 ! "     ";
         enCanti  = #isom0023#7;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0511#4 ! "     ";
         enCanti  = #isom0023#9;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0511;
      #isom0511#1;
      ;
      #maempr10#1, 0000;
      #maempr10#1, 9999;
      ;
      NULL, isom0511;
|FIN;

|PROCESO Hoja18B;
     nHay    = 0;
     nPasada = 0;
     |ABRE #isom0022;
     |ABRE #isom0023;
     |SELECT #1#isom0022;
     |SELECT #1#isom0023;

                    |BUCLE isom0510;
     |SI nHay = 0;  |BUCLE isom0511;  |FINSI;

     |CIERRA #isom0022;
     |CIERRA #isom0023;

     |SI nHay = 0;  |ACABA;  |FINSI;

     eaPagina = eaPagina + "18B";

     eaAlfa = "<T20018B> ";  |HAZ GrabaSecuencial;

     nPasada = 1;

     |ABRE #isom0022;
     |SELECT #1#isom0022;
     |BUCLE isom0510;
     |CIERRA #isom0022;

     |ABRE #isom0023;
     |SELECT #1#isom0023;
     |BUCLE isom0511;
     |CIERRA #isom0023;

     eaAlfa = "</T20018B>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;


|PROCESO HojaDID;
     |DDEFECTO #isoh11di;

     #isoh11di#7  = #maempr10#1;
     |SI #maempr10#31 = "01.01.2012";  |Y #maempr10#32 = "31.12.2012";
         #isoh11di#8 = "1";                    || Todo el Ejercicio
     |SINO;
         fFechaD = #maempr10#31;
         fFechaH = #maempr10#32;
         nFecha  = (fFechaH - fFechaD) + 1;
         |SI nFecha ] 365;
             #isoh11di#8 = "2";                || No coincide con el A¤o Natural
         |SINO;
             #isoh11di#8 = "3";                || No todo el Ejercicio
         |FINSI;
     |FINSI;

     #isoh11di#9  = "0A";                     || Periodo
     #isoh11di#10 = #maempr10#31 % 102;            || Del Dia
     #isoh11di#11 = #maempr10#31 % 402;            || Del Mes
     #isoh11di#12 = #maempr10#31 % -102;           || Del Anyo
     #isoh11di#13 = #maempr10#32 % 102;            || Al Dia
     #isoh11di#14 = #maempr10#32 % 402;            || Al Mes
     #isoh11di#15 = #maempr10#32 % -102;           || Al A¤o
     #isoh11di#16 = #maempr10#3;                   || NIF
     #isoh11di#17 = #maempr10#2;                   || Apellidos o Razon Social

     eaCasilla = "552";  |HAZ LeeFich101;
     enCanti  = #isom0001#5; |HAZ Calcula17D;  #isoh11di#18 = eaAlfa;

     eaCasilla = "562";  |HAZ LeeFich101;
     enCanti  = #isom0001#5; |HAZ Calcula17D;  #isoh11di#19 = eaAlfa;

     eaCasilla = "621";  |HAZ LeeFich101;
     enCanti  = #isom0001#5; |HAZ Calcula17D;  #isoh11di#20 = eaAlfa;
     nTotal   = #isom0001#5;

     |ABRE #isocie00;
     #isocie00#0 = #maempr10#0;
     #isocie00#1 = #maempr10#1;
     |LEE 040#isocie00.=;
     |SI FSalida ! 0;  |DDEFECTO #isocie00;  |FINSI;
     |CIERRA #isocie00;

     |SI #isoh1201#57 = "1"; nTotal = 0; |FINSI;
     |SI #isoh1201#58 = "1"; nTotal = 0; |FINSI;

     |SI #isoy2012#2 = "S";
         #isoh11di#6 = "1";

         |SI nTotal < 0;
             #isoh11di#25 = " ";
             enCanti = -nTotal;  |HAZ Calcula17D;  #isoh11di#26 = eaAlfa;
         |FINSI;

         |SI nTotal > 0;
             #isoh11di#31  = " ";
             enCanti  = nTotal; |HAZ Calcula17D;  #isoh11di#34 = eaAlfa;
         |FINSI;
     |SINO;
         |SI nTotal < 0;
             #isoh11di#25 = "D";
             enCanti  = -nTotal;  |HAZ Calcula17D;  #isoh11di#26 = eaAlfa;
             |SI #maempr10#34 = "S";
                 #isoh11di#25 = "R";
             |SINO;
                 aAlfa   = #isocie00#2;  |QBF aAlfa; #isoh11di#27 = ("0000" + aAlfa) % -104;
                 aAlfa   = #isocie00#3;  |QBF aAlfa; #isoh11di#28 = ("0000" + aAlfa) % -104;
                 aAlfa   = #isocie00#4;  |QBF aAlfa; #isoh11di#29 = ("00"   + aAlfa) % -102;
                 aAlfa   = #isocie00#5;  |QBF aAlfa; #isoh11di#30 = ("0000000000" + aAlfa) % -110;
             |FINSI;
         |FINSI;

         |SI nTotal > 0;
             enCanti  = nTotal; |HAZ Calcula17D;  #isoh11di#34 = eaAlfa;
             #isoh11di#31 = #isoy2012#0;
             |SI #isoy2012#0 ! "H";
                 aAlfa   = #isocie00#2;   |QBF aAlfa; #isoh11di#35 = ("0000" + aAlfa) % -104;
                 aAlfa   = #isocie00#3;   |QBF aAlfa; #isoh11di#36 = ("0000" + aAlfa) % -104;
                 aAlfa   = #isocie00#4;   |QBF aAlfa; #isoh11di#37 = ("00"   + aAlfa) % -102;
                 aAlfa   = #isocie00#5;   |QBF aAlfa; #isoh11di#38 = ("0000000000" + aAlfa) % -110;
             |FINSI;
         |FINSI;

         |SI nTotal = 0;
             #isoh11di#39 = "1";
         |FINSI;
     |FINSI;

     #isoh11di#32 = "";
     #isoh11di#33 = "";

     |PARA nCampo = 1;  |SI nCampo [ 40;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isoh11di#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;

     eaPagina = eaPagina + "DID";
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
     nTecla = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVent;

     |SI nTecla = 7;  |ACABA;  |FINSI;

     aDia   = #isoy2012#1 % 102;
     aMes   = #isoy2012#1 % 402;
     aEjerc = #isoy2012#1 % -104;

     |SI aMes = "01"; aMes = "Enero     "; |FINSI;
     |SI aMes = "02"; aMes = "Febrero   "; |FINSI;
     |SI aMes = "03"; aMes = "Marzo     "; |FINSI;
     |SI aMes = "04"; aMes = "Abril     "; |FINSI;
     |SI aMes = "05"; aMes = "Mayo      "; |FINSI;
     |SI aMes = "06"; aMes = "Junio     "; |FINSI;
     |SI aMes = "07"; aMes = "Julio     "; |FINSI;
     |SI aMes = "08"; aMes = "Agosto    "; |FINSI;
     |SI aMes = "09"; aMes = "Septiembre"; |FINSI;
     |SI aMes = "10"; aMes = "Octubre   "; |FINSI;
     |SI aMes = "11"; aMes = "Noviembre "; |FINSI;
     |SI aMes = "12"; aMes = "Diciembre "; |FINSI;
     aMes = aMes > aMes;

     |ABRE #isom0000;
     #isom0000#0 = #maempr10#0;
     #isom0000#1 = #maempr10#1;
     |LEE 000#isom0000.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0000;  |FINSI;
     |CIERRA #isom0000;

     |HAZ AbreSecuencial;
     |HAZ Hoja1;
     |HAZ Hoja2;
     |HAZ Hoja3;
     |HAZ Hoja4;
     |HAZ Hoja5;
     |HAZ Hoja6;
     |HAZ Hoja7;
     |HAZ Hoja8;
     |HAZ Hoja9;
     |HAZ Hoja10;
     |HAZ Hoja11;
     |HAZ Hoja12;
     |HAZ Hoja13;
     |HAZ Hoja14;
     |HAZ Hoja15;
     |HAZ Hoja16;
     |HAZ Hoja17;
     |HAZ Hoja18;
     |HAZ Hoja18B;
     |HAZ Hoja19;
     |HAZ Hoja20;
     |HAZ Hoja21;
     |HAZ Hoja22;
     |HAZ Hoja23;
     |HAZ Hoja24;
     |HAZ HojaDID;

     |HAZ CierraSecuencial;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     FSalida = 1899;
|FPRC;

|PROGRAMA;
||     |MENAV "0000A£n no se ha abierto el portal del 2012.";
||     |ACABA;

     |HAZ LeeUnidadBasico;

     efFechaImpre = "01.01.0000";
     eaImpre    = "N";
     eaJusti    = "";
     eaFinLinea = &13 + &10;
     eaFinLinea = "";

     |SI PARAMETRO ! "BORRADOR";
         |SUB_EJECUTA_NP "isoz0002;CHEQUEOEMISION";
         |SI enError ! 0;
             |MENAV "0000Hay errores graves, no puedo emitir el modelo.";
             |ACABA;
         |FINSI;

         |SI enAviso ! 0;
             |CONFI "0000SHay errores leves, quiere emitir de todas formas";
             |SI FSalida ! 0;  |ACABA;  |FINSI;
         |FINSI;
     |FINSI;

     |ABRE #maempr10;
     #maempr10#0 = enEmpresa;
     #maempr10#1 = enAnyo;
     |LEE 000#maempr10.=;
     |SI FSalida ! 0;  |CIERRA #maempr10;  |ACABA; |FINSI;
     |CIERRA #maempr10;

     |C_M #isoy2012#0, 1, "N";
     eaCasilla = "621";  |HAZ LeeFich101;
     nTotal   = #isom0001#5;
     |SI nTotal > 0;
         |C_M #isoy2012#0, 1, "S";

         |ABRE #isocie00;
         #isocie00#0 = #maempr10#0;
         #isocie00#1 = #maempr10#1;
         |LEE 040#isocie00.=;
         |SI FSalida ! 0;  |DDEFECTO #isocie00;  |FINSI;
         |CIERRA #isocie00;

                                            #isoy2012#0 = "H";
         |SI #isocie00#5 ! "          ";    #isoy2012#0 = "I";  |FINSI;
     |FINSI;

     aAlfa =  "Emisi¢n modelo 200 (" + (("00000" + #maempr10#0) % -105) + " / " + #maempr10#1 + " " + #maempr10#2;
     |QBF aAlfa;
     aAlfa = aAlfa + ")";
     |VENTANA 0501, 1550, -1, 16, aAlfa;
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SI PARAMETRO ! "BORRADOR";
         |PINPA #0#isoy2012;
         |PINDA #0#isoy2012;

         |ENDATOS #1#isoy2012;
     |SINO;
         FSalida = 0;
         |HAZ Tipo12;
     |FINSI;

     |PULSATECLA;
|FPRO;
