|FICHEROS;
     cuacceso #0;
     cubala02 #2;
     cubala03 #3;
     cubala04 #4;
     cubala05 #5;
     cubala11 #11;

     cubala22 #22;
     cubala23 #23;
     cubala24 #24;
     cubala25 #25;
     maempr11 #111;
     maacceso #200;
     maempr10 #10;

     agim0019 #6;
     agicontr #8;
    :/agicli/def/agim0056  #56;

    :/agicont/def/canempre  #30;
    :/agicont/def/ca8ctrle  #400;
    :/agicont/def/ca8comay  #401;
    :/agicont/def/ca8cumay  #402;
    :/sociedad/def/soda8m02 #412;
    :/sociedad/def/soda8m03 #413;
    :/agicont/def/ca8m0000  #420;
    :/agicont/def/ca8m0001  #421;
    :/agicont/def/ca8m0002  #422;
    :/agicont/def/ca8m0021  #431;
    :/sociedad/def/soda8m22 #441;

     cubal801 #801;
     cubal802 #802;
     cubal803 #803;
     cubal804 #804;
     cubal805 #805;
     cubal8v4 #814;
     cuaccpar #899;

     cubaz802 #902;
|FIN;

|VARIABLES;
   sw       = 0;
   &empresa = 0;
   &anyo    = 0;
   &enAnyo  = 0;
   &nombre  = "";
   &nif     = "";
   &tipo    = "";
   &unid    = "";
   &opcion  = 0;
   &modo    = 0;
   &sw_mod  = 0;
   &acabalo = 0;

   fich     = "";
   provi    = "";
   fondo    = "ฐ";
   x        = 0;
   posici   = 0;
   horizo   = "";
   SwIntegrador = 0;
   Modulo       = "";

{-1} menu   = "";
   menu1    = "1220";
   menu2    = "1";
   menu3    = "10";
   menu4    = "Pase Ejercicio Anterior            ";
   menu5    = "Pase desde Entrada General de Datos";
   menu6    = "Pase desde Liquidacion Impuesto    ";
   menu7    = "Entrada del Activo                 ";
   menu8    = "Entrada del Pasivo                 ";
   menu9    = "Entrada del Debe                   ";
   menu10   = "Entrada del Haber                  ";
   menu11   = "Calculo Debe - Haber               ";
   menu12   = "Pantalla de Totales                ";
   menu13   = "Impresion Registro                 ";

   fFecha = @;
   alfa1  = "";
   nume1  = 0;

{-1} aMenu   = "";
   aMenu1    = "1220";
   aMenu2    = "1";
   aMenu3    = "9";
   aMenu4    = "Pase Ejercicio Anterior                 ";
   aMenu5    = "Pase desde Entrada General de Datos     ";
   aMenu6    = "Consulta Balance Situacion              ";
   aMenu7    = "Consulta Cuenta de Resultados           ";
   aMenu8    = "Consulta Ingresos y Gastos reconocidos  ";
   aMenu9    = "Consulta y Variaciones al ECPN          ";
   aMenu10   = "Consulta Estado Flujo de Efectivo       ";
   aMenu11   = "Pantalla de Totales                     ";
   aMenu12   = "Imprimir Borradores                     ";

   aAlfa1 = "";
   aAlfa2 = "";
   nEjer  = 0;
|FIN;

|INCLUYE varcon_i;
|INCLUYE varbal_i;
|INCLUYE lospat_i;

|CALCULO defFecha; |TIPO 7;
 fFecha = ~;
 alfa1 = fFecha;
 alfa1 = alfa1 % -104;
 nume1 = alfa1;
 #0Campo = nume1 - 1;
|FCAL;

|PROCESO forzar;
 |C_M #0#5,0,aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;

 |SI #0#5 = "A";
     #0#12 = "A";
     |CAMPO_MODIFICA #0#12, 1, "N";
 |SINO;
     |CAMPO_MODIFICA #0#12, 1, "S";
 |FINSI;
 |PINTA #0#12;
|FPRC;

|PROCESO cuadro; |TIPO 7;
 |C_M #0#12, 0, aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;

 |PUSHV 0501 2380;
 |CUADRO 0820 1376;
 |ATRI R;
 |PINTA 0921, " <A> Forzar a Abreviado                                ";
 |PINTA 1021, " <E> Forzar a Extendido                                ";
 |PINTA 1121, " <B> Balance Abreviado, Perdidas y Ganancias Extendido ";
 |PINTA 1221, " <P> Balance Extendido, Perdidas y Ganancias Abreviado ";
 |ATRI r;
|FPRC;

|PROCESO repon; |TIPO 0;
 |C_M #0#12, 0, aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;
 |POPV;
 |PINTA #0#12;
|FPRC;

|PROCESO base; |TIPO 80;
  SwIntegrador = 1;
  |DBASS fich; |QBF fich;
  |PATH_DAT #8fich;
  |ABRE #8;
  |LEE 040#8p;
  |SI FSalida ! 0;  SwIntegrador = 0;  |ACABA;  |FINSI;
  |CIERRA #8;

  Modulo = #8#8;  |QBF Modulo;
  |SI Modulo = ""; SwIntegrador = 0;  |ACABA;  |FINSI;

  |PATH_DAT #6Modulo;
|FPRC;

|PROCESO Registro;
 |SI SwIntegrador = 0;  |ACABA;  |FINSI;
 |ABRE #6;
 #6#0 = #0#0;
 #6#1 = 99;
 |LEE 040#6];
 |SI FSalida = 0;
     |LEE 040#6a;
 |SINO;
     |LEE 040#6u;
 |FINSI;
 |SI FSalida ! 0;  |O #6#0 ! #0#0;
     |DDEFECTO #6;
 |FINSI;
 |CIERRA #6;

 #0#3  = #6#27;
 #0#6  = #6#29;
 #0#7  = #6#30;
 #0#8  = #6#31;
 #0#9  = #6#32;
 #0#10 = #6#33;
 |SI #0#11 = "           ";
     #0#11 = #6#34;
 |FINSI;
 #0#17 = #6#83;
 #0#18 = #6#84;
 #0#19 = #6#85;
 #0#20 = #6#86;
 #0#21 = #6#91;
|FPRC;

|PROCESO leeregi; |TIPO 0;
modo = (FEntrada / 100) ! 0;
|SI modo = 1;
    |HAZ Registro;
    |PINTA #0#3;
    |PINTA #0#6;
    |PINTA #0#7;
    |PINTA #0#8;
    |PINTA #0#9;
    |PINTA #0#10;
    |PINTA #0#11;
    |PINTA #0#21;
|FINSI;
|FPRC;

|PROCESO cambioti; |TIPO 0;
 |HAZ CamposBal;
 modo = (FEntrada / 100) ! 0;
 |CAMPO_MODIFICA #0#5,  1, "N";
 |CAMPO_MODIFICA #0#14, 1, "N";
 |CAMPO_MODIFICA #0#15, 1, "N";
 |SI #0#1 < 2008;
    |SI modo ! 1;
        |CAMPO_MODIFICA #0#5, 1, "N";
        |CAMPO_MODIFICA #0#12, 1, "N";
    |SINO;
        |CAMPO_MODIFICA #0#5, 1, "S";
    |FINSI;
 |SINO;
    |SI modo ! 1;
        |CAMPO_MODIFICA #0#15, 1, "N";
        |CAMPO_MODIFICA #0#16, 1, "N";
    |SINO;
        |CAMPO_MODIFICA #0#15, 1, "S";
        |CAMPO_MODIFICA #0#16, 1, "S";
    |FINSI;
 |FINSI;

 |SI #0#1 ] 2008;
      |SI modo = 1;
          |HAZ LeeEmpresa;
      |FINSI;
 |FINSI;
|FPRC;


|PROCESO Borrar801;
 |BORRA 020#801a;
 |LIBERA #801;
|FPRC;

|DEFBUCLE Borrar801;
 #801#1;
 ;
 #0#0, #0#1, 0001;
 #0#0, #0#1, 9999;
 be;
 NULL, Borrar801;
|FIN;

|PROCESO Borrar802;
 |BORRA 020#802a;
 |LIBERA #802;
|FPRC;

|DEFBUCLE Borrar802;
 #802#1;
 ;
 #0#0, #0#1, 0001;
 #0#0, #0#1, 9999;
 be;
 NULL, Borrar802;
|FIN;

|PROCESO Borrar803;
 |BORRA 020#803a;
 |LIBERA #803;
|FPRC;

|DEFBUCLE Borrar803;
 #803#1;
 ;
 #0#0, #0#1, 0001;
 #0#0, #0#1, 9999;
 be;
 NULL, Borrar803;
|FIN;

|PROCESO Borrar8v4;
 |BORRA 020#814a;
 |LIBERA #814;
|FPRC;

|DEFBUCLE Borrar8v4;
 #814#1;
 ;
 #0#0, #0#1, 0001;
 #0#0, #0#1, 9999;
 be;
 NULL, Borrar8v4;
|FIN;

|PROCESO Borrar804;
 |BORRA 020#804a;
 |LIBERA #804;
|FPRC;

|DEFBUCLE Borrar804;
 #804#1;
 ;
 #0#0, #0#1, 001;
 #0#0, #0#1, 999;
 be;
 NULL, Borrar804;
|FIN;

|PROCESO Borrar805;
 |BORRA 020#805a;
 |LIBERA #805;
|FPRC;

|DEFBUCLE Borrar805;
 #805#1;
 ;
 #0#0, #0#1, 0001;
 #0#0, #0#1, 9999;
 be;
 NULL, Borrar805;
|FIN;

|PROCESO borrado; |TIPO 2;
modo = (FEntrada / 100) ! 0;
|SI modo = 3;
    |PINTA 2430,"Borrando Registro ...";
    |SI #0#1 < 2008;
        |ABRE #2; #2#0 = #0#0; #2#1 = #0#1; |BORRA 101#2c; |LIBERA #2; |CIERRA #2;
        |ABRE #3; #3#0 = #0#0; #3#1 = #0#1; |BORRA 101#3c; |LIBERA #3; |CIERRA #3;
        |ABRE #4; #4#0 = #0#0; #4#1 = #0#1; |BORRA 101#4c; |LIBERA #4; |CIERRA #4;
        |ABRE #5; #5#0 = #0#0; #5#1 = #0#1; |BORRA 101#5c; |LIBERA #5; |CIERRA #5;

        |ABRE #22; #22#0 = #0#0; #22#1 = #0#1; |BORRA 101#22c; |LIBERA #22; |CIERRA #22;
        |ABRE #23; #23#0 = #0#0; #23#1 = #0#1; |BORRA 101#23c; |LIBERA #23; |CIERRA #23;
        |ABRE #24; #24#0 = #0#0; #24#1 = #0#1; |BORRA 101#24c; |LIBERA #24; |CIERRA #24;
        |ABRE #25; #25#0 = #0#0; #25#1 = #0#1; |BORRA 101#25c; |LIBERA #25; |CIERRA #25;

   |SINO;
        |BUCLE Borrar801;
        |BUCLE Borrar802;
        |BUCLE Borrar803;
        |BUCLE Borrar8v4;
        |BUCLE Borrar804;
        |BUCLE Borrar805;
   |FINSI;
   |PINTA 2430,"                     ";
|FINSI;
|FPRC;

|PROCESO acceso;|TIPO 30;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1;
         #0#13 = "N";

         |ABRE #11;
         |LEE 000#11=;
         |SI FSalida ! 0;  |DDEFECTO #11;  |FINSI;
         |CIERRA #11;

         |SI #11#1 = "N";
             |ABRE #111;
             #111#0 = #0#0;
             #111#1 = #0#1;
             #111#2 = 17;
             |LEE 000#111=;
             |SI FSalida = 0;   #0#13 = "S";   |FINSI;

             #111#0 = #0#0;
             #111#1 = #0#1;
             #111#2 = 18;
             |LEE 000#111=;
             |SI FSalida = 0;   #0#13 = "S";   |FINSI;

             #111#0 = #0#0;
             #111#1 = #0#1;
             #111#2 = 19;
             |LEE 000#111=;
             |SI FSalida = 0;   #0#13 = "S";   |FINSI;
         |FINSI;
     |FINSI;

     |SI modo = 1; |O modo = 2;
         |HAZ LeeParaEmpresa;
         |SI #0#1 < 2008; |O enModBal = 1;
             |CONFI "2400SAlta / Modificacion de los 2 Periodos : ";
             |SI FSalida = 0; sw_mod = 0; |SINO; sw_mod = 1; |FINSI;
         |FINSI;

         |GRABA 020#0a;
         |LIBERA #0;
         |CIERRAT #0;
         |HAZ pantalla;
         |ABRET #0;
     |FINSI;
     sw_mod = 0;
|FPRC;

|PROCESO consulta; |TIPO 13;
|HAZ CamposBal;
modo = FEntrada / 100;
modo = modo ! 0;
|SI modo = 4;
    |CAMPO_MODIFICA #0#2, 1, "S";
    |CAMPO_MODIFICA #0#4, 1, "S";
    |PINTA #0#0;
    |PINTA #0#1;
    |PINTA #0#2;
    |PINTA #0#3;
    |PINTA #0#4;
    |PINTA #0#5;
    |PINTA #0#6;
    |PINTA #0#7;
    |PINTA #0#8;
    |PINTA #0#9;
    |PINTA #0#10;
    |PINTA #0#11;
    |PINTA #0#12;
    |PINTA #0#21;
    |HAZ pantalla;
|SINO;
    |CAMPO_MODIFICA #0#2, 1, "N";
    |CAMPO_MODIFICA #0#4, 1, "N";
|FINSI;
|FPRC;

|PROCESO CamposBal;
|SI #0#1 < 2008;
    |PINTA 0667, "  Tipo For. ";
    |PINTA 0767, "            ";
    |PINTA 0867, "ออออออออออออ";
    |C_V #0#5,1,"S";  |C_V #0#12,1,"S"; |C_M #0#12, 1, "S";
    |C_V #0#14,1,"N"; |C_V #0#15,1,"N"; |C_V #0#16, 1, "N";
    |PINTA #0#5;
    |PINTA #0#12;
|SINO;
    |PINTA 0667, "Plan Bal Cta";
    |PINTA 0767, "            ";
    |PINTA 0867, "ออออออออออออ";
    |C_V #0#5,1,"N";  |C_V #0#12,1,"N"; |C_M #0#12,1,"N";
    |C_V #0#14,1,"S"; |C_V #0#15,1,"S"; |C_V #0#16,1,"S";
    |PINTA #0#14;
    |PINTA #0#15;
    |PINTA #0#16;
|FINSI;
|FPRC;

|PROCESO pantalla;
     opcion = 1;
     sw = 0;
     empresa = #0#0;
     anyo    = #0#1;
     nombre  = #0#2;
     unid    = #0#3;
     nif     = #0#4;
     tipo    = #0#5;
     nBalNum = #0#15;
     nCtaNum = #0#16;

|SI #0#1 < 2008;
     |PARA; |SI sw = 0; |HACIENDO;
       menu3    = "10";
       |SI #0#13 = "S";   menu3 = "9";  |FINSI;
       menu2  = opcion;
       |MENUG menu;
       opcion = FSalida;
       |SI opcion ] 1; |Y opcion [ 10;
           |SI opcion = 1; |Y modo ! 4;  |SUB_EJECUTA_NP "cubala12"; |FINSI;
           |SI opcion = 2; |Y modo ! 4;  |SUB_EJECUTA_NP "cubala01"; |FINSI;
           |SI opcion = 3; |Y modo ! 4;  |SUB_EJECUTA_NP "cubala16"; |FINSI;

           |SI #0#13 = "N";
               |SI opcion = 4;               |SUB_EJECUTA_NP "cubala02"; |FINSI;
               |SI opcion = 5;               |SUB_EJECUTA_NP "cubala03"; |FINSI;
               |SI opcion = 6;               |SUB_EJECUTA_NP "cubala04"; |FINSI;
               |SI opcion = 7;               |SUB_EJECUTA_NP "cubala05"; |FINSI;
           |SINO;
               |SI opcion = 4;               |SUB_EJECUTA_NP "cubala22"; |FINSI;
               |SI opcion = 5;               |SUB_EJECUTA_NP "cubala23"; |FINSI;
               |SI opcion = 6;               |SUB_EJECUTA_NP "cubala24"; |FINSI;
               |SI opcion = 7;               |SUB_EJECUTA_NP "cubala25"; |FINSI;
           |FINSI;

           |SI opcion = 8; |Y modo ! 4;  |SUB_EJECUTA_NP "cubala06"; |FINSI;
           |SI opcion = 9;               |SUB_EJECUTA_NP "cubala07"; |FINSI;
           |SI opcion = 10; |Y modo ! 4; |SUB_EJECUTA_NP "cubala08"; |FINSI;
       |SINO;
           sw = 1;
       |FINSI;
     |SIGUE;
|SINO;
    |HAZ LeoPlan;
    |HAZ LeeBal0;
    |HAZ LeeRes0;
    |PARA; |SI sw = 0; |HACIENDO;
       aMenu3  = "9";
       aMenu2  = opcion;
       |MENUG aMenu;
       opcion = FSalida;
       |SI opcion ] 1; |Y opcion [ 9;
           |SI opcion = 1; |Y modo ! 4;
               |SI anyo < 2009;
                   |MENAV "    Operativo a partir del Ejercicio 2009";
               |SINO;
                   |SUB_EJECUTA_NP "cubal808";
               |FINSI;
           |FINSI;
           |SI opcion = 2; |Y modo ! 4;  |SUB_EJECUTA_NP "cubal800"; |FINSI;

           |SI opcion = 3;               |SUB_EJECUTA_NP "cubal801"; |FINSI;
           |SI opcion = 4;               |SUB_EJECUTA_NP "cubal802"; |FINSI;
           |SI opcion = 5;               |SUB_EJECUTA_NP "cubal803"; |FINSI;
           |SI opcion = 6;               |SUB_EJECUTA_NP "cubal8v4"; |FINSI;
           |SI opcion = 7;               |SUB_EJECUTA_NP "cubal805"; |FINSI;

           |SI opcion = 8;               |SUB_EJECUTA_NP "cubal806"; |FINSI;
           |SI opcion = 9;               |SUB_EJECUTA_NP "cubal807"; |FINSI;
       |SINO;
           sw = 1;
       |FINSI;
    |SIGUE;
|FINSI;

     |PINPA #0#0;
|FPRC;

|PROCESO laempresa;
  enEnContagen = 1;
  enPerConta   = #30#3;
|FPRC;

|DEFBUCLE laempresa;
  #30#1;
  26;
  #0#0, 0, nEjer;
  #0#0, 9, nEjer;
  e;
  NULL, laempresa;
|FIN;

|PROCESO LeeEmpresa;

     aAlfa1 = #0#1;
     aAlfa1 = aAlfa1 % -102;
     nEjer = aAlfa1;

     |C_M #0#14, 1, "S";
     enEnContagen = 0;
     |BUCLE laempresa;
     |SI enEnContagen = 1;
         |ABRE #ca8ctrle;
         |DDEFECTO #ca8ctrle;
         #ca8ctrle#0 = #0#0;
         #ca8ctrle#1 = enPerConta;
         |LEE 001#ca8ctrle.=;
         |SI FSalida = 0;
             eNum2008 = #ca8ctrle#2;
             #0#14 = eNum2008; |PINTA #0#14;
             |C_M #0#14, 1, "N";
         |FINSI;
         |CIERRA #ca8ctrle;
    |FINSI;

    |ABRE #10;
    #10#0 = #0#0;
    #10#1 = #0#1;
    |LEE 041#10=;
    |SI FSalida = 0;
        #0#15 = #10#101; |PINTA #0#15;
        #0#16 = #10#102; |PINTA #0#16;
    |SINO;
        #0#15 = #6#87; |PINTA #0#15;
        #0#16 = #6#88; |PINTA #0#16;
    |FINSI;
    |CIERRA #10;
|FPRC;

|PROCESO LeoPlan;
    eNum2008 = #0#14;
    |ABRE #401;
    #401#0 = #0#14;
    |LEE 041#401=;
    eTip2008 = #401#3;
    |CIERRA #401;
    enAnyo = #0#1; |HAZ eHazEjerCCAA;
|FPRC;

|PROCESO LeeBal0;
 |ABRE #420;
 #420#0 = #0#15;
 |LEE 001#420=;
 enTBal   = #420#2;
 aLucratB = #420#3;
 |CIERRA #420
|FPRC;

|PROCESO LeeRes0;
 |ABRE #420;
 #420#0 = #0#16;
 |LEE 001#420=;
 enTCta = #420#2;
 aLucratP = #420#3;
 |CIERRA #420
|FPRC;

|PROCESO LeeBal; |TIPO 0;
 |SI #0#1 < 2008; |ACABA; |FINSI;
 |C_M #0#15,0,aAlfa1;

 |HAZ LeeBal0;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;
 |SI eTip2008 = 2;
      |SI enTBal = 1; |O enTBal = 2;
          |MENAV "    Error. Plan Contable de Empresa PYME, NO puede realizar estos Balances";
          |ERROR;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO LeeRes; |TIPO 0;
 |SI #0#1 < 2008; |ACABA; |FINSI;
 |C_M #0#16,0,aAlfa1;

 |HAZ LeeRes0;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;
 |SI eTip2008 = 2;
      |SI enTCta = 1; |O enTCta = 2;
          |MENAV "    Error. Plan Contable de Empresa PYME, NO puede realizar esta Cta de Resultados";
          |ERROR;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO LeeParaEmpresa;
 enModBal = 0;
 |ABRE #899;
 #899#0 = #0#0;
 #899#1 = #0#1;
 |LEE 001#899=;
 |SI FSalida = 0;
     |SI #899#3 = "S";
         enModBal = 1;
     |FINSI;
 |FINSI;
 |CIERRA #899;
|FPRC;

|PROCESO LosPatrones;
  |ABRE #56;
  |LEE 040#56p;
  |SI FSalida ! 0;
      |CIERRA #56;
      |SUB_EJECUTA_NP ":agicli/instalar;agim0056";
  |SINO;
      #56#0 = "02010";
      |LEE 041#56=;
      |SI FSalida ! 0; |O #56#1 ! "ALBACETE                                ";
          |CIERRA #56;
          |SUB_EJECUTA_NP ":agicli/instalar;agim0056";
      |FINSI;
      |CIERRA #56;
  |FINSI;

  |HAZ VerPatrones;

 |ABRE #902;
 #902#4 = "A";
 |LEE 040#902=;
 |SI FSalida ! 0; |O #902#5 ! "X";
     |CIERRA #cubaz802;
     |SUB_EJECUTA_NP "cubaz802;Pase";
 |SINO;
     |CIERRA #cubaz802;
 |FINSI;

|FPRC;


|PROGRAMA;
     |HAZ LosPatrones;

     |SI PARAMETRO = "";
         |MANTE #0;
     |SINO;
         |ABRE #0;
         |DDEFECTO #0;
         #0#0  = empresa;
         #0#1  = anyo;
         #0#14 = eNum2008;
         #0#15 = enTBal;
         #0#16 = enTCta;
         |HAZ Registro;

         |ABRE #200;
         #200#0 = #0#0;
         #200#1 = #0#1;
         |LEE 000#200=;
         |SI FSalida ! 0;  |DDEFECTO #200;  |FINSI;
         |CIERRA #200;

         #0#2 = #200#2;
         #0#4 = #200#3;

         |GRABA 020#0n;
         |LIBERA #0;
         |CIERRA #0;

         |HAZ LeeBal0;
         |HAZ LeeRes0;

         nBalNum = #0#15;
         nCtaNum = #0#16;
         |SUB_EJECUTA_NP "cubal800;AUTO";
     |FINSI;
|FPRO;
