|FICHEROS
     isemi202 #0;
     isocie00 #100;
     isocie29 #1;
     maempr01 #2;
     imphacie #3;
     isw00005 #99;

     isw00600 #600,MANTE;
     isw00601 #601;

     :/agicli/def/agifigen #1000;    || Bancos
|FIN;

|VARIABLES;
     x      = 0;

     &dia    = "";
     &mes    = "";
     &anyo   = "";

     aAlfa        = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAlfa3       = "";
     aCadena      = "";
     aLong        = "";
     aCaracter    = "";

     nEspa        = 0;
     nLong        = 0;
     nCampo       = 0;
     nPos         = 0;
     nSwHoja      = 0;

     aAbre        = "";
     aModelos     = "";
     aVersion     = "";

     nHandle1     = 0;
     nHandle2     = 0;
     nSwHay       = 0;
     nCanti       = 0;
     nTCampo      = 0;
     nAnyoI       = 0;

     fFecha       = @;

     aUnidad      = "";
  {1}aContiene    = "";

     &eaFOrigen   = "";
     &eaFDestino  = "";
     &eaInternet  = "";
     &eaAlfa      = "";
     &eaVarDni    = "";
     &eaDiaB      = "";
     &eaMesB      = "";
     &eaAnyoB     = "";
     &eaFechaB    = "";
     &eaTipoSec   = "";
     &enAnyo      = 0;
     &enCanti     = 0;
     &eaMoneda    = "";
     &eaImpresora = "";
     &eaModelos   = "";
|FIN;

|| **************************************************************************
||                           PROCESOS DE UTLIDADES LASER
|| **************************************************************************

|PROCESO FPago; |TIPO 0;
 |SI FSalida = 2; |ACABA; |FINSI;

 |SI #0#39 ! "F";
     |SI #0#38 = "A";  |O #0#38 = "E";
         |MENAV "    Opcion valida solo para Fichero / Internet. ";
         |ERROR;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO CopiaFicheroIP;
     aAlfa = "";
     |IP_REMOTO aAlfa;  |QBT aAlfa;
     |SI aAlfa ! "";
         |ENVIA_FICHERO eaFOrigen, eaFDestino;
     |SINO;
         |COPIA_FICHERO eaFOrigen, eaFDestino;
     |FINSI;
|FPRC;

|PROCESO QuitaRaros;
     eaAlfa = eaAlfa > " ";
     nEspa   = 0;
     aCadena = "";
     aLong   = eaAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           |SI aCaracter = ",";  aCaracter = "";   |FINSI;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &209; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena + (" " * nEspa);

     eaAlfa = eaAlfa > eaAlfa;
|FPRC;

|PROCESO QuitaRarosTfno;
     aCadena = "";
     aLong   = eaAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           |SI aCaracter = "0";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "1";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "2";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "3";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "4";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "5";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "6";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "7";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "8";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "9";  aCadena = aCadena + aCaracter;  |FINSI;
     |SIGUE;
     eaAlfa = aCadena;  |QBT eaAlfa;
     eaAlfa = eaAlfa > eaAlfa;
|FPRC;

|PROCESO FechaBonito;
     aAlfa1 = eaAlfa % 102;
     aAlfa2 = eaAlfa % 402;
     aAlfa3 = eaAlfa % 704;

     |SI aAlfa2 = "01";  aAlfa2 = "ENERO     ";  |FINSI;
     |SI aAlfa2 = "02";  aAlfa2 = "FEBRERO   ";  |FINSI;
     |SI aAlfa2 = "03";  aAlfa2 = "MARZO     ";  |FINSI;
     |SI aAlfa2 = "04";  aAlfa2 = "ABRIL     ";  |FINSI;
     |SI aAlfa2 = "05";  aAlfa2 = "MAYO      ";  |FINSI;
     |SI aAlfa2 = "06";  aAlfa2 = "JUNIO     ";  |FINSI;
     |SI aAlfa2 = "07";  aAlfa2 = "JULIO     ";  |FINSI;
     |SI aAlfa2 = "08";  aAlfa2 = "AGOSTO    ";  |FINSI;
     |SI aAlfa2 = "09";  aAlfa2 = "SEPTIEMBRE";  |FINSI;
     |SI aAlfa2 = "10";  aAlfa2 = "OCTUBRE   ";  |FINSI;
     |SI aAlfa2 = "11";  aAlfa2 = "NOVIEMBRE ";  |FINSI;
     |SI aAlfa2 = "12";  aAlfa2 = "DICIEMBRE ";  |FINSI;

     |QBF aAlfa2;
     eaFechaB = aAlfa1 + " de " + aAlfa2 + " de " + aAlfa3;
     eaDiaB   = aAlfa1;
     eaMesB   = aAlfa2;
     eaAnyoB  = aAlfa3;
|FPRC;

|PROCESO Conver13;
     eaMoneda = #0#37;
     enCanti  = nCanti;
     |HAZ ConverMoneda;
     nCanti   = enCanti;

     |SI nCanti ] 0;
         eaAlfa = nCanti;
         eaAlfa = ("0000000000000" + eaAlfa) % -113;
     |SINO;
         nCanti  = -nCanti;
         eaAlfa   = nCanti;
         eaAlfa   = "N" + (("000000000000" + eaAlfa) % -112);
     |FINSI;
|FPRC;

|| **************************************************************************
||                           PROCESOS DEL PROGRAMA
|| **************************************************************************

|PROCESO MiraVarMoneda;  |TIPO 0;
     |HAZ PintaMoneda;
     #0#37 = eaMoneda;

     |SI #0#33 ] 2002;
         |SI #0#37 = "PESETAS";
             |MENAV "     Moneda erronea.";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO TipoImpresion;
     |SI #0#33 [ 2001;  |Y #0#39 ! "O";
         |MENAV "     Tipo de Impresion incorrecto, valido para el a¤o 2002 y superiores";
         |ERROR;
     |FINSI;

/*
     |SI #0#39 = "L";
         |MENAV "0000 Hacienda no ha proporcionado el nuevo Modelo en Laser. Oficial o Internet";
         |ERROR;
     |FINSI;
*/
|FPRC;

|PROCESO Seleccion; |TIPO 0;
     |SI #0#0 = "S";
         |C_M #0#01, 1, "S";
         |C_M #0#02, 1, "S";
         |PARA x = 3; |SI x [ 32; |HACIENDO x = x + 1;
               #0x = 0; |PINTA #0x;
         |SIGUE;
         |C_M #0#03, 1, "N"; |C_M #0#04, 1, "N";
         |C_M #0#05, 1, "N"; |C_M #0#06, 1, "N";
         |C_M #0#07, 1, "N"; |C_M #0#08, 1, "N";
         |C_M #0#09, 1, "N"; |C_M #0#10, 1, "N";
         |C_M #0#11, 1, "N"; |C_M #0#12, 1, "N";
         |C_M #0#13, 1, "N"; |C_M #0#14, 1, "N";
         |C_M #0#15, 1, "N"; |C_M #0#16, 1, "N";
         |C_M #0#17, 1, "N"; |C_M #0#18, 1, "N";
         |C_M #0#19, 1, "N"; |C_M #0#20, 1, "N";
         |C_M #0#21, 1, "N"; |C_M #0#22, 1, "N";
         |C_M #0#23, 1, "N"; |C_M #0#24, 1, "N";
         |C_M #0#25, 1, "N"; |C_M #0#26, 1, "N";
         |C_M #0#27, 1, "N"; |C_M #0#28, 1, "N";
         |C_M #0#29, 1, "N"; |C_M #0#30, 1, "N";
         |C_M #0#31, 1, "N"; |C_M #0#32, 1, "N";
     |SINO;
         #0#1 = 001; |PINTA #0#1;
         #0#2 = 999; |PINTA #0#2;
         |C_M #0#01, 1, "N";
         |C_M #0#02, 1, "N";

         |C_M #0#03, 1, "S"; |C_M #0#04, 1, "S";
         |C_M #0#05, 1, "S"; |C_M #0#06, 1, "S";
         |C_M #0#07, 1, "S"; |C_M #0#08, 1, "S";
         |C_M #0#09, 1, "S"; |C_M #0#10, 1, "S";
         |C_M #0#11, 1, "S"; |C_M #0#12, 1, "S";
         |C_M #0#13, 1, "S"; |C_M #0#14, 1, "S";
         |C_M #0#15, 1, "S"; |C_M #0#16, 1, "S";
         |C_M #0#17, 1, "S"; |C_M #0#18, 1, "S";
         |C_M #0#19, 1, "S"; |C_M #0#20, 1, "S";
         |C_M #0#21, 1, "S"; |C_M #0#22, 1, "S";
         |C_M #0#23, 1, "S"; |C_M #0#24, 1, "S";
         |C_M #0#25, 1, "S"; |C_M #0#26, 1, "S";
         |C_M #0#27, 1, "S"; |C_M #0#28, 1, "S";
         |C_M #0#29, 1, "S"; |C_M #0#30, 1, "S";
         |C_M #0#31, 1, "S"; |C_M #0#32, 1, "S";
     |FINSI;
|FPRC;

|PROCESO CargaImprime;
     aAlfa = "del err" + (("00000" + #1#0) % -105) + ".TXT" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "wait mipf32 ";
     aAlfa = aAlfa + "/E:202" + (("00000" + #1#0) % -105) + ".TXT ";
     aAlfa = aAlfa + "/R:err" + (("00000" + #1#0) % -105) + ".TXT ";
     |SI eaImpresora ! "";
         aAlfa = aAlfa + "/I:" + &34 + eaImpresora + &34;
     |FINSI;
     aAlfa = aAlfa + " /C:" + #600#0;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL " + "202" + (("00000" + #1#0) % -105) + ".TXT ";
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO TDeclaracion;
     |SI #99#23 > 0;
         nCanti = #99#23;  |HAZ Conver13;  #601#51 = eaAlfa;
     |SINO;
         nCanti = 0;       |HAZ Conver13;  #601#51 = eaAlfa;
     |FINSI;

     #601#49 = #99#26;
     #601#50 = #99#27;
     #601#52 = #99#28;
     #601#53 = #99#29;
     #601#54 = #99#30;
     #601#55 = #99#31;

     #601#4 = "";
     |SI #0#39 ! "L";
         |SI #99#23 > 0;
                                                   #601#4 = "I";
             |SI #0#38 = "A";                      #601#4 = "A";  |FINSI;
             |SI #0#38 = "E";                      #601#4 = "E";  |FINSI;
             |SI #601#50 = "X";  |Y #0#38 = "D";   #601#4 = "U";  |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Carga202_2002;
     |SI #0#39 = "L";
         aAbre = eaModelos + "202" + (("00000" + #1#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |SI #0#39 = "F";
         aAbre = eaInternet + "202" + (("00000" + #1#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |DDEFECTO #601;

     #601#1   = "202";
     #601#2   = "01";
     #601#3   = "";

     #601#5   = (("00" + #3#0) % -102) + (("000" + #3#1) % -103);
     aAlfa    = #2#3;  |QBF aAlfa;
     #601#6   = ("000000000" + aAlfa) % -109;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #601#8   = eaAlfa;
     #601#9   = ".";
     eaAlfa   = #2#4;    |HAZ QuitaRaros;     #601#10  = eaAlfa;
     eaAlfa   = #2#5;    |HAZ QuitaRaros;     #601#11  = eaAlfa;
     #601#12  = #2#6;
     #601#13  = #2#7;
     #601#14  = #2#8;
     #601#15  = #2#9;
     eaAlfa   = #2#15;   |HAZ QuitaRarosTfno; #601#16 = eaAlfa;
     eaAlfa   = #2#13;   |HAZ QuitaRaros;     #601#17  = eaAlfa;
     eaAlfa   = #2#14;   |HAZ QuitaRaros;     #601#18  = eaAlfa;
     #601#19  = (("00" + #2#10) % -102) + (("000" + #2#11) % -103);

     #601#20  = #0#33;
     #601#21  = #0#35 + "P";

     nCanti  = #99#1;           |HAZ Conver13;  #601#22 = eaAlfa;
     nCanti  = #99#2;           |HAZ Conver13;  #601#23 = eaAlfa;
     nCanti  = #99#3;           |HAZ Conver13;  #601#24 = eaAlfa;

     nCanti  = #99#4;           |HAZ Conver13;  #601#25 = eaAlfa;
     nCanti  = #99#5 * 100;                     #601#26 = ("0000" + nCanti) % -104;
     nCanti  = #99#6;           |HAZ Conver13;  #601#27 = eaAlfa;

     nCanti  = #99#7;           |HAZ Conver13;  #601#28 = eaAlfa;
     nCanti  = #99#8;           |HAZ Conver13;  #601#29 = eaAlfa;
     nCanti  = #99#9;           |HAZ Conver13;  #601#30 = eaAlfa;
     nCanti  = #99#10;          |HAZ Conver13;  #601#31 = eaAlfa;
     nCanti  = #99#11;          |HAZ Conver13;  #601#32 = eaAlfa;
     nCanti  = #99#12;          |HAZ Conver13;  #601#33 = eaAlfa;

     nCanti  = #99#13;          |HAZ Conver13;  #601#34 = eaAlfa;
     nCanti  = #99#14;          |HAZ Conver13;  #601#35 = eaAlfa;
     nCanti  = #99#15;          |HAZ Conver13;  #601#36 = eaAlfa;
     nCanti  = #99#16;          |HAZ Conver13;  #601#37 = eaAlfa;
     nCanti  = #99#17;          |HAZ Conver13;  #601#38 = eaAlfa;

     nCanti  = #99#18;          |HAZ Conver13;  #601#39 = eaAlfa;
     nCanti  = #99#19;          |HAZ Conver13;  #601#40 = eaAlfa;
     nCanti  = #99#20;          |HAZ Conver13;  #601#41 = eaAlfa;
     nCanti  = #99#21;          |HAZ Conver13;  #601#42 = eaAlfa;
     nCanti  = #99#22;          |HAZ Conver13;  #601#43 = eaAlfa;

     |SI #0#39 = "L";
         #601#45 = #99#24;
     |SINO;
         #601#44 = #99#24;
     |FINSI;

     |HAZ TDeclaracion;


     eaAlfa  = #2#77;    |HAZ QuitaRaros;       #601#56 = eaAlfa;
     eaAlfa  = #2#15;    |HAZ QuitaRarosTfno;   #601#57 = eaAlfa;

     eaAlfa  = #0#34;     |HAZ FechaBonito;
     #601#46 = eaDiaB;
     #601#47 = eaMesB;
     #601#48 = eaAnyoB;
     #601#62 = &13 + &10;

     |SI #0#39 = "L";
         #601#4  = "";
         #601#7  = "";
         #601#56 = "";
         #601#57 = "";
         #601#58 = "";
         #601#59 = "";
         #601#60 = "";
         #601#61 = "";
         nTCampo = 62;
     |FINSI;

     |SI #0#39 = "F";
         #601#2  = "";
         #601#3  = "";
         #601#5  = "";
         #601#8  = "";
         #601#9  = "";
         #601#10 = "";
         #601#11 = "";
         #601#12 = "";
         #601#13 = "";
         #601#14 = "";
         #601#15 = "";
         #601#16 = "";
         #601#17 = "";
         #601#18 = "";
         #601#19 = "";
         #601#47 = "";
         #601#48 = "";
         nTCampo = 61;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #601nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     |SI #0#39 = "L";
         |HAZ CargaImprime;
     |FINSI;

     nSwHay = 1;
|FPRC;

|PROCESO CogeBanco;
     |SI #0#38 = "S";  |O #0#38 = "D";  |O #0#38 = "E";  |O #0#38 = "A";
         |SI #0#40 = 1;
             |ABRE #100;
             |PARA nAnyoI = #1#1 - 1;  |SI nAnyoI ] 2000;  |HACIENDO nAnyoI = nAnyoI - 1;
                   #100#0 = #1#0;
                   #100#1 = nAnyoI;
                   |LEE 040#100=;
                   |SI FSalida = 0;
                       |SI #100#5 ! "0000000000";  |Y #100#5 ! "          ";
                           #99#27 = "X";
                           #99#28 = #100#2;
                           #99#29 = #100#3;
                           #99#30 = #100#4;
                           #99#31 = #100#5;
                       |FINSI;
                       |SAL;
                   |FINSI;
             |SIGUE;
             |CIERRA #100;

             |SI #99#28 = "    ";
                 |ABRE #1000;
                 #1000#0 = #1#0;
                 |LEE 040#1000=;
                 |SI FSalida ! 0;  |DDEFECTO #1000;  |FINSI;
                 |CIERRA #1000;

                 |SI #1000#84 ! "                    ";
                     #99#27 = "X";
                     #99#28 = #1000#81;
                     #99#29 = #1000#82;
                     #99#30 = #1000#83;
                     #99#31 = #1000#84 % 110;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI #0#40 = 2;
             |ABRE #1000;
             #1000#0 = #1#0;
             |LEE 040#1000=;
             |SI FSalida ! 0;  |DDEFECTO #1000;  |FINSI;
             |CIERRA #1000;

             |SI #1000#84 ! "                    ";
                  #99#27 = "X";
                  #99#28 = #1000#81;
                  #99#29 = #1000#82;
                  #99#30 = #1000#83;
                  #99#31 = #1000#84 % 110;
             |FINSI;

             |SI #99#28 = "    ";
                 |ABRE #100;
                 #100#0 = #1#0;
                 #100#1 = #1#1 - 1;
                 |LEE 040#100=;
                 |SI FSalida = 0;
                     |SI #100#5 ! "0000000000";  |Y #100#5 ! "          ";
                         #99#27 = "X";
                         #99#28 = #100#2;
                         #99#29 = #100#3;
                         #99#30 = #100#4;
                         #99#31 = #100#5;
                     |FINSI;
                 |FINSI;
                 |CIERRA #100;
             |FINSI;
         |FINSI;

         |SI #99#28 = "    ";
             #99#26 = "X";
         |FINSI;
     |SINO;
         #99#26 = "X";
     |FINSI;
|FPRC;

|PROCESO Imprime;
     |DDEFECTO #99;

     #2#0 = #1#0;
     #2#1 = #1#1;
     |LEE 040#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     #3#0 = #2#29;
     #3#1 = #2#30;
     |LEE 040#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

     #99#25 = #0#35;          || Periodo

     |SI #1#30 = 1;           || Tipo A
         |SI #0#35 = 1;
             #99#1  = #1#3;   || Base del Pago
             #99#2  = #1#50;  || Resultado Declaracion Anterior
             #99#3  = #1#6;   || A Ingresar
             #99#23 = 0;
             |SI #1#6 > 0;  #99#23 = #1#6;  |FINSI;
             #99#24 = #1#65;

             #1#9   = #0#34;  || Fecha de Presentacion
         |FINSI;

         |SI #0#35 = 2;
             #99#1  = #1#4;   || Base del Pago
             #99#2  = #1#51;  || Resultado Declaracion Anterior
             #99#3  = #1#7;   || A Ingresar
             |SI #1#7 > 0;  #99#23 = #1#7;  |FINSI;
             #99#24 = #1#66;

             #1#10  = #0#34;  || Fecha de Presentacion
         |FINSI;

         |SI #0#35  = 3;
             #99#1  = #1#5;   || Base del Pago
             #99#2  = #1#52;  || Resultado Declaracion Anterior
             #99#3  = #1#8;   || A Ingresar
             |SI #1#8 > 0;  #99#23 = #1#8;  |FINSI;
             #99#24 = #1#67;

             #1#11  = #0#34;  || Fecha de Presentacion
         |FINSI;
     |FINSI;

     |SI #1#30 = 2;           || Tipo B1
         |SI #0#35  = 1;
             #99#4  = #1#12;  || Base del Pago
             #99#5  = #1#32;  || Porcentaje
             #99#6  = #1#15;  || Resultado
             #99#18 = #1#47;  || Bonificaciones
             #99#19 = #1#18;  || Retenciones
             #99#20 = #1#50;  || Resultado Declaracion Anterior Complementaria
             #99#21 = #1#21;  || Pagos Anteriores
             #99#22 = #1#24;  || A Ingresar
             |SI #1#24 > 0;  #99#23 = #1#24;  |FINSI;
             #99#24 = #1#65;
             #1#27  = #0#34;  || Fecha Presentacion
         |FINSI;

         |SI #0#35  = 2;
             #99#4  = #1#13;  || Base del Pago
             #99#5  = #1#33;  || Porcentaje
             #99#6  = #1#16;  || Resultado
             #99#18 = #1#48;  || Bonificaciones
             #99#19 = #1#19;  || Retenciones
             #99#20 = #1#51;  || Resultado Declaracion Anterior Complementaria
             #99#21 = #1#22;  || Pagos Anteriores
             #99#22 = #1#25;  || A Ingresar
             |SI #1#25 > 0;  #99#23 = #1#25;  |FINSI;
             #99#24 = #1#66;
             #1#28  = #0#34;  || Fecha Presentacion
         |FINSI;

         |SI #0#35  = 3;
             #99#4  = #1#14;  || Base del Pago
             #99#5  = #1#34;  || Porcentaje
             #99#6  = #1#17;  || Resultado
             #99#18 = #1#49;  || Bonificaciones
             #99#19 = #1#20;  || Retenciones
             #99#20 = #1#52;  || Resultado Declaracion Anterior Complementaria
             #99#21 = #1#23;  || Pagos Anteriores
             #99#22 = #1#26;  || A Ingresar
             |SI #1#26 > 0;  #99#23 = #1#26;  |FINSI;
             #99#24 = #1#67;
             #1#29  = #0#34;  || Fecha Presentacion
         |FINSI;
     |FINSI;

     |SI #1#30 = 3;           || Tipo B2
         |SI #0#35  = 1;
             #99#7  = #1#12;  || Base del Pago
             #99#8  = #1#35;  || Hasta
             #99#9  = #1#38;  || Porcentaje 21 %
             #99#10 = #1#41;  || Resto
             #99#11 = #1#44;  || Porcentaje 25 %
             #99#12 = #1#15;  || Resultado
             #99#18 = #1#47;  || Bonificaciones
             #99#19 = #1#18;  || Retenciones
             #99#20 = #1#50;  || Resultado Declaracion Anterior Complementaria
             #99#21 = #1#21;  || Pagos Anteriores
             #99#22 = #1#24;  || A Ingresar
             |SI #1#24 > 0;  #99#23 = #1#24;  |FINSI;
             #99#24 = #1#65;
             #1#27  = #0#34;  || Fecha Presentacion
         |FINSI;

         |SI #0#35  = 2;
             #99#7  = #1#13;  || Base del Pago
             #99#8  = #1#36;  || Hasta
             #99#9  = #1#39;  || Porcentaje 21 %
             #99#10 = #1#42;  || Resto
             #99#11 = #1#45;  || Porcentaje 25 %
             #99#12 = #1#16;  || Resultado
             #99#18 = #1#48;  || Bonificaciones
             #99#19 = #1#19;  || Retenciones
             #99#20 = #1#51;  || Resultado Declaracion Anterior Complementaria
             #99#21 = #1#22;  || Pagos Anteriores
             #99#22 = #1#25;  || A Ingresar
             |SI #1#25 > 0;  #99#23 = #1#25;  |FINSI;
             #99#24 = #1#66;
             #1#28  = #0#34;  || Fecha Presentacion
         |FINSI;

         |SI #0#35  = 3;
             #99#7  = #1#14;  || Base del Pago
             #99#8  = #1#37;  || Hasta
             #99#9  = #1#40;  || Porcentaje 21 %
             #99#10 = #1#43;  || Resto
             #99#11 = #1#46;  || Porcentaje 25 %
             #99#12 = #1#17;  || Resultado
             #99#18 = #1#49;  || Bonificaciones
             #99#19 = #1#20;  || Retenciones
             #99#20 = #1#52;  || Resultado Declaracion Anterior Complementaria
             #99#21 = #1#23;  || Pagos Anteriores
             #99#22 = #1#26;  || A Ingresar
             |SI #1#26 > 0;  #99#23 = #1#26;  |FINSI;
             #99#24 = #1#67;
             #1#29  = #0#34;  || Fecha Presentacion
         |FINSI;
     |FINSI;

     |SI #1#30 = 4;           || Tipo B3
         |SI #0#35  = 1;
             #99#13 = #1#53;  || Parte General
             #99#14 = #1#56;  || % 28
             #99#15 = #1#59;  || Parte Especial
             #99#16 = #1#62;  || % 10
             #99#17 = #1#68;  || Resultado
             #99#18 = #1#47;  || Bonificaciones
             #99#19 = #1#18;  || Retenciones
             #99#20 = #1#50;  || Resultado Declaracion Anterior Complementaria
             #99#21 = #1#21;  || Pagos Anteriores
             #99#22 = #1#24;  || A Ingresar
             |SI #1#24 > 0;  #99#23 = #1#24;  |FINSI;
             #99#24 = #1#65;
             #1#27  = #0#34;  || Fecha Presentacion
         |FINSI;

         |SI #0#35  = 2;
             #99#13 = #1#54;  || Parte General
             #99#14 = #1#57;  || % 28
             #99#15 = #1#60;  || Parte Especial
             #99#16 = #1#63;  || % 10
             #99#17 = #1#69;  || Resultado
             #99#18 = #1#48;  || Bonificaciones
             #99#19 = #1#19;  || Retenciones
             #99#20 = #1#51;  || Resultado Declaracion Anterior Complementaria
             #99#21 = #1#22;  || Pagos Anteriores
             #99#22 = #1#25;  || A Ingresar
             |SI #1#25 > 0;  #99#23 = #1#25;  |FINSI;
             #99#24 = #1#66;
             #1#28  = #0#34;  || Fecha Presentacion
         |FINSI;

         |SI #0#35  = 3;
             #99#13 = #1#55;  || Parte General
             #99#14 = #1#58;  || % 28
             #99#15 = #1#61;  || Parte Especial
             #99#16 = #1#64;  || % 10
             #99#17 = #1#70;  || Resultado
             #99#18 = #1#49;  || Bonificaciones
             #99#19 = #1#20;  || Retenciones
             #99#20 = #1#52;  || Resultado Declaracion Anterior Complementaria
             #99#21 = #1#23;  || Pagos Anteriores
             #99#22 = #1#26;  || A Ingresar
             |SI #1#26 > 0;  #99#23 = #1#26;  |FINSI;
             #99#24 = #1#67;
             #1#29  = #0#34;  || Fecha Presentacion
         |FINSI;
     |FINSI;

     |SI #99#1  = 0; |Y #99#4  = 0; |Y #99#7 = 0; |Y #99#13 = 0;
      |Y #99#15 = 0;  |Y #0#36 = "N";
         |ACABA;
     |FINSI;

     |GRABA 020#1a;
     |LIBERA #1;

     |SI #99#23 > 0;
         |HAZ CogeBanco;
     |FINSI;

     |SI #0#39 = "O";
         |SI nSwHoja = 1;
             |MENAV "      Coloque nuevo impreso y pulse tecla";
         |FINSI;

         |PRINT; |PIEINF;
     |SINO;
         |SI #0#33 ] 2002;  |HAZ Carga202_2002;  |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE isocie29;
     #1#1;
     ;
     #0#1, #0#33;
     #0#2, #0#33;
     be;
     NULL, Imprime;
|FIN;

|PROCESO Fecha;
     dia  = #0#34 % 102;
     mes  = #0#34 % 402;
     anyo = #0#34 % 704;

     |SI mes = "01"; mes = "Enero     "; |FINSI;
     |SI mes = "02"; mes = "Febrero   "; |FINSI;
     |SI mes = "03"; mes = "Marzo     "; |FINSI;
     |SI mes = "04"; mes = "Abril     "; |FINSI;
     |SI mes = "05"; mes = "Mayo      "; |FINSI;
     |SI mes = "06"; mes = "Junio     "; |FINSI;
     |SI mes = "07"; mes = "Julio     "; |FINSI;
     |SI mes = "08"; mes = "Agosto    "; |FINSI;
     |SI mes = "09"; mes = "Septiembre"; |FINSI;
     |SI mes = "10"; mes = "Octubre   "; |FINSI;
     |SI mes = "11"; mes = "Noviembre "; |FINSI;
     |SI mes = "12"; mes = "Diciembre "; |FINSI;
|FPRC;

|PROCESO AbreImprime;
     aAbre = eaModelos + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "CD \" + &13 + &10;                 |XGRABA nHandle1, aAlfa;
     aAlfa = "CD MODELOS" + &13 + &10;           |XGRABA nHandle1, aAlfa;
     aAlfa = "CD SOCIEDAD" + &13 + &10;           |XGRABA nHandle1, aAlfa;
     aAlfa = "CD 202" + &13 + &10;               |XGRABA nHandle1, aAlfa;
     aAlfa = "CD " + #0#33 + " " + &13 + &10;    |XGRABA nHandle1, aAlfa;

     aAlfa = #0#33;
     aAlfa = aAlfa % -102;
     aVersion = "";

     |SI #0#33 = 2008; aVersion = "02"; |FINSI;
     |SI #0#33 ] 2009; aVersion = "01"; |FINSI;

     aAlfa1 = "DEL ERRORES.RST" + &13 + &10;      |XGRABA nHandle1, aAlfa1;

     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     aUnidad = (aContiene1 % 102) > "";

     |SI aVersion = "";
         aAlfa = "ZLS" + aAlfa + "MPF.EXE /T:" + aUnidad + "\MODELOS\SOCIEDAD\202\" + #0#33 + "\" + &13 + &10;
     |SINO;
         aAlfa = "Z" + aAlfa + aVersion + "MPF.EXE /T:" + aUnidad + "\MODELOS\SOCIEDAD\202\" + #0#33 + "\" + &13 + &10;
     |FINSI;

     |XGRABA nHandle1, aAlfa;

     |SI #0#33 ] 2002;
         aAlfa = "MOVE ERRORM~1.TXT ERRORMIPF.TXT" + &13 + &10;      |XGRABA nHandle1, aAlfa;
         aAlfa = "MOVE EAN128~1.DLL EAN128_32.DLL" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     |FINSI;
|FPRC;

|PROCESO EmiteEsto;
     aAlfa = "DEL *.wmf" + &13 + &10;             |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.tab"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.dll"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errorm~1.txt" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errormipf.txt"  + &13 + &10;    |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errmipf.txt"  + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.exe"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     |XCIERRA nHandle1;

     aAlfa   = #0#33;
     aAlfa   = aAlfa % -102;
     aVersion = "";

     |SI #0#33 = 2008; aVersion = "02"; |FINSI;
     |SI #0#33 ] 2009; aVersion = "01"; |FINSI;

     |SI aVersion = "";
         aAlfa = "zls" + aAlfa;

     |SINO;
         aAlfa = "z" + aAlfa + aVersion;
     |FINSI;

     |DBASE aModelos;  |QBT aModelos;
     aModelos   = aModelos  + "hacienda/";
     eaFOrigen  = aModelos  + aAlfa + "mpf.exe";
     eaFDestino = eaModelos + aAlfa + "mpf.exe";
     |HAZ CopiaFicheroIP;

     aAlfa = eaModelos + "IMPRIME";
     |RSYSTEM aAlfa;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#39 = "O";
         nSwHoja = 0;
         |CONFI "0000N La Emision es Hoja a Hoja";
         |SI FSalida = 0;  nSwHoja = 1;  |FINSI;

         |IMPRE 0;
         |SI FSalida ! 0; |ACABA; |FINSI;

         |INFOR "h0320201";
         |SI FSalida ! 0;  |FINIMP;   |ACABA; |FINSI;
     |SINO;
         |SI #0#39 = "L";
             |PARA;  |SI;  |HACIENDO;
                 |DDEFECTO #600;
                 |PINPA #0#600;
                 |PINDA #0#600;
                 |ENDATOS #1#600;
                 |SI FSalida = 0;
                     aAlfa     = "\MODELOS";                        |RMKDIR aAlfa;
                     aAlfa     = "\MODELOS\SOCIEDAD";               |RMKDIR aAlfa;
                     aAlfa     = "\MODELOS\SOCIEDAD\202";           |RMKDIR aAlfa;
                     aAlfa     = "\MODELOS\SOCIEDAD\202\" + #0#33;  |RMKDIR aAlfa;
                     eaModelos = aAlfa + "\";
                     |HAZ AbreImprime;
                     |SAL;
                 |FINSI;
             |SIGUE;
         |FINSI;

         |SI #0#39 = "F";
             aAlfa      = "/AEAT";                       |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET";              |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET/202";          |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET/202/" + #0#33; |RMKDIR aAlfa;
             eaInternet = aAlfa + "/";
         |FINSI;
     |FINSI;

     |HAZ Fecha;
     |ABRE #2;
     |ABRE #3;
     |SI #0#0 = "S";
         |BUCLE isocie29;
     |SINO;
         |ABRE #1;
         |PARA x = 3; |SI x [ 32; |HACIENDO x = x + 1;
               |SI #0x ! 0;
                   #1#0 = #0x;
                   #1#1 = #0#33;
                   |LIBERA #1;
                   |LEE 110#1=;
                   |SI FSalida = 0; |HAZ Imprime; |FINSI;
               |FINSI;
          |SIGUE;
          |CIERRA #1;
     |FINSI;

     |CIERRA #2;
     |CIERRA #3;

     |SI #0#39 = "O";
         |FININF;
         |FINIMP;
     |SINO;
         |SI #0#39 = "L";
             |SI nSwHay = 1;
                 |HAZ EmiteEsto;
                 eaTipoSec = "202";
                 enAnyo    = #0#33;
                 |SUB_EJECUTA "isw00027";
              |SINO;
                 |MENAV "     Seleccion Vacia";
                 |XCIERRA nHandle1;
             |FINSI;
             aAlfa = eaModelos + "imprime.bat";
             |RFBORRA aAlfa;
          |FINSI;

          |SI #0#39 = "F";
              |SI nSwHay = 1;
                  aAlfa =  "      Ficheros Generados. Situados en " + eaInternet + " de su PC";
                  |MENAV aAlfa;
              |SINO;
                 |MENAV "     Seleccion Vacia";
              |FINSI;
          |FINSI;
     |FINSI;
|FPRC;
