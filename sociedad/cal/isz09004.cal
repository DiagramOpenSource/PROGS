|FICHEROS;
     isz00004 #0;
     ism00002 #2;
     isocie73 #73;  || Resumen Fichero de Deducciones A¤o 2000
     isocie70 #70;  || Fichero de Deducciones
|FIN;

|VARIABLES;
     &empresa    = 0;
     &anyo       = 0;

     nLinea      = 0;
     nTotalDec   = 0;
     nAnyoDed    = 0;
     nTipoDec    = 0;
     nAnyoAnt    = 0;
     nAplicar    = 0;
     nCasilla    = 0;

     aDescri     = "";

     &eParametro = "";
|FIN;

|PROCESO CogeNuevo2001;
     #70#0 = empresa;
     #70#1 = anyo;
     #70#2 = 99;
     |LEE 040#70];
     |SI FSalida = 0;
         |LEE 040#70a;
     |SINO;
         |LEE 040#70u;
     |FINSI;

     nLinea = 1;
     |SI FSalida = 0;  |Y #70#0 = empresa;  |Y #70#1 = anyo;
         nLinea = #70#2 + 1;
     |FINSI;
|FPRC;

|PROCESO Trae2001;
     aDescri = #70#12;

     |SI nTotalDec = 0; |ACABA; |FINSI;

     |SI #70#11 [ nTotalDec;
         nAplicar  = #70#11;
         nTotalDec = nTotalDec - #70#11;
     |SINO;
         nAplicar  = nTotalDec;
         nTotalDec = 0;
     |FINSI;

     #2#7 = nAnyoAnt;
     #2#0 = #70#3;
     #2#1 = #70#5;
     |LEE 040#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #2#8 = 0;  |Y #2#9 = 0;
         |ACABA;
     |FINSI;

     #2#7 = anyo;
     #2#0 = #2#8;
     #2#1 = #2#9;
     |LEE 040#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SALVA_DATOS #70;

     |HAZ CogeNuevo2001;

     |DDEFECTO #70;
     #70#0  = empresa;
     #70#1  = anyo;
     #70#2  = nLinea;
     #70#3  = #2#0;
     #70#4  = #2#2;
     #70#5  = #2#1;
     #70#6  = #2#3;
     #70#7  = #2#4;
     #70#8  = #2#5;
     #70#9  = #2#6;
     |SI #70#9 ! 0;
         #70#10 = (nAplicar * 100) / #70#9;
     |SINO;
         #70#10 = nAplicar;
     |FINSI;
     #70#11 = nAplicar;
     #70#12 = aDescri;
     |GRABA 020#70n;
     |LIBERA #70;

     |REPON_DATOS #70;
     |LEE 000#70=;
|FPRC;

|DEFBUCLE isocie70_2001;
     #70#1;
     7;
     empresa, nAnyoAnt, 001, nCasilla;
     empresa, nAnyoAnt, 999, nCasilla;
     ;
     NULL, Trae2001;
|FIN;

|PROCESO importa_01;
     nAnyoAnt = anyo - 1

     |ABRE #73;

     #73#0 = empresa;
     #73#1 = nAnyoAnt;
     |LEE 040#73=;
     |SI FSalida ! 0; |CIERRA #73; |ACABA; |FINSI;

     |ABRE #70;
     |ABRE #2;

     |SI #73#016 ! 0; nTotalDec = #73#016; nCasilla = 753; |BUCLE isocie70_2001; |FINSI;
     |SI #73#019 ! 0; nTotalDec = #73#019; nCasilla = 756; |BUCLE isocie70_2001; |FINSI;
     |SI #73#022 ! 0; nTotalDec = #73#022; nCasilla = 759; |BUCLE isocie70_2001; |FINSI;
     |SI #73#025 ! 0; nTotalDec = #73#025; nCasilla = 762; |BUCLE isocie70_2001; |FINSI;
     |SI #73#028 ! 0; nTotalDec = #73#028; nCasilla = 765; |BUCLE isocie70_2001; |FINSI;
     |SI #73#031 ! 0; nTotalDec = #73#031; nCasilla = 768; |BUCLE isocie70_2001; |FINSI;

     |SI #73#037 ! 0; nTotalDec = #73#037; nCasilla = 773; |BUCLE isocie70_2001; |FINSI;
     |SI #73#040 ! 0; nTotalDec = #73#040; nCasilla = 776; |BUCLE isocie70_2001; |FINSI;
     |SI #73#043 ! 0; nTotalDec = #73#043; nCasilla = 779; |BUCLE isocie70_2001; |FINSI;
     |SI #73#046 ! 0; nTotalDec = #73#046; nCasilla = 782; |BUCLE isocie70_2001; |FINSI;
     |SI #73#049 ! 0; nTotalDec = #73#049; nCasilla = 785; |BUCLE isocie70_2001; |FINSI;
     |SI #73#052 ! 0; nTotalDec = #73#052; nCasilla = 788; |BUCLE isocie70_2001; |FINSI;
     |SI #73#055 ! 0; nTotalDec = #73#055; nCasilla = 791; |BUCLE isocie70_2001; |FINSI;
     |SI #73#058 ! 0; nTotalDec = #73#058; nCasilla = 794; |BUCLE isocie70_2001; |FINSI;
     |SI #73#061 ! 0; nTotalDec = #73#061; nCasilla = 797; |BUCLE isocie70_2001; |FINSI;
     |SI #73#064 ! 0; nTotalDec = #73#064; nCasilla = 800; |BUCLE isocie70_2001; |FINSI;
     |SI #73#067 ! 0; nTotalDec = #73#067; nCasilla = 803; |BUCLE isocie70_2001; |FINSI;
     |SI #73#070 ! 0; nTotalDec = #73#070; nCasilla = 806; |BUCLE isocie70_2001; |FINSI;
     |SI #73#073 ! 0; nTotalDec = #73#073; nCasilla = 809; |BUCLE isocie70_2001; |FINSI;
     |SI #73#076 ! 0; nTotalDec = #73#076; nCasilla = 812; |BUCLE isocie70_2001; |FINSI;
     |SI #73#079 ! 0; nTotalDec = #73#079; nCasilla = 815; |BUCLE isocie70_2001; |FINSI;
     |SI #73#082 ! 0; nTotalDec = #73#082; nCasilla = 818; |BUCLE isocie70_2001; |FINSI;
     |SI #73#085 ! 0; nTotalDec = #73#085; nCasilla = 821; |BUCLE isocie70_2001; |FINSI;
     |SI #73#088 ! 0; nTotalDec = #73#088; nCasilla = 824; |BUCLE isocie70_2001; |FINSI;
     |SI #73#091 ! 0; nTotalDec = #73#091; nCasilla = 827; |BUCLE isocie70_2001; |FINSI;
     |SI #73#094 ! 0; nTotalDec = #73#094; nCasilla = 830; |BUCLE isocie70_2001; |FINSI;

     |SI #73#103 ! 0; nTotalDec = #73#103; nCasilla = 837; |BUCLE isocie70_2001; |FINSI;
     |SI #73#106 ! 0; nTotalDec = #73#106; nCasilla = 840; |BUCLE isocie70_2001; |FINSI;
     |SI #73#109 ! 0; nTotalDec = #73#109; nCasilla = 843; |BUCLE isocie70_2001; |FINSI;
     |SI #73#112 ! 0; nTotalDec = #73#112; nCasilla = 846; |BUCLE isocie70_2001; |FINSI;
     |SI #73#115 ! 0; nTotalDec = #73#115; nCasilla = 849; |BUCLE isocie70_2001; |FINSI;

     |SI #73#124 ! 0; nTotalDec = #73#124; nCasilla = 856; |BUCLE isocie70_2001; |FINSI;
     |SI #73#127 ! 0; nTotalDec = #73#127; nCasilla = 859; |BUCLE isocie70_2001; |FINSI;
     |SI #73#130 ! 0; nTotalDec = #73#130; nCasilla = 862; |BUCLE isocie70_2001; |FINSI;
     |SI #73#133 ! 0; nTotalDec = #73#133; nCasilla = 865; |BUCLE isocie70_2001; |FINSI;
     |SI #73#136 ! 0; nTotalDec = #73#136; nCasilla = 868; |BUCLE isocie70_2001; |FINSI;
     |SI #73#139 ! 0; nTotalDec = #73#139; nCasilla = 871; |BUCLE isocie70_2001; |FINSI;
     |SI #73#142 ! 0; nTotalDec = #73#142; nCasilla = 874; |BUCLE isocie70_2001; |FINSI;
     |SI #73#145 ! 0; nTotalDec = #73#145; nCasilla = 882; |BUCLE isocie70_2001; |FINSI;
     |SI #73#148 ! 0; nTotalDec = #73#148; nCasilla = 885; |BUCLE isocie70_2001; |FINSI;
     |SI #73#151 ! 0; nTotalDec = #73#151; nCasilla = 888; |BUCLE isocie70_2001; |FINSI;

     |CIERRA #2;
     |CIERRA #73;
     |CIERRA #70;

     eParametro = "FUERA01";
     |SUB_EJECUTA_NP "isz00006";
|FPRC;
