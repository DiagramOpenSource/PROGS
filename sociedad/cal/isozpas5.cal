|FICHEROS;
     isoz0001 #0;

     isom0001 #102;
     isom0002 #102;
     isom0003 #103;
     isom0004 #104;
     isom0005 #105;

     sodacoli #1;
     soda8w02 #2;
     soda8w04 #4;
|FIN;

|VARIABLES;
     &enAnyo    = 0;
     &enCampo0  = 0;
     nHay       = 0;

     aFichero   = "";
     &aCuenta   = "";
     &aTitulo   = "";
     &aAPR      = "";
     aSigno     = "";
     nImporte   = 0;

     aDCta      = "";
     aHCta      = "";
     aAlfa1     = "";
|FIN;

|INCLUYE varcon_i;
|INCLUYE varbal_i;

|| ***************************************************************************
|| *********************  GRABACION y CALCULOS *******************************
|| ***************************************************************************

|PROCESO LasLineas105;
  |DDEFECTO #105;
  #105#0  = enEmpresa;
  #105#1  = enAnyo;
  #105#3  = #4#2;
  |LEE 101#105=;
  |SI FSalida = 0;
      #105#5 = #105#5 + nImporte;
      |GRABA 020#105a;
  |FINSI;
  |LIBERA #105;
|FPRC;

|PROCESO LaCondicion105;
    nImporte = (nImporte) ! 2; |SI #4#5 = "-"; nImporte = - nImporte; |FINSI;
     |SI nImporte ! 0;
         |HAZ LasLineas105;
     |FINSI;
|FPRC;

|PROCESO calculit105;
  #0#6 = enAnyo; #0#7 = #1#3;
  || |SI PARAMETRO = ""; |PINTA #0#6; |PINTA #0#7; |FINSI;

  aCuenta = #1#3;
  |HAZ MSigno08_s;

  |SI #4#8 = 3;
      |SI #4#7 = 1; nImporte = #1#8; |FINSI;
      |SI #4#7 = 2; nImporte = #1#6 - #1#7; |FINSI;
      |SI #4#7 ] 3;
          |SI #4#7 = 3; #1#7 = 0; |FINSI;  ||solo debe
          |SI #4#7 = 4; #1#6 = 0; |FINSI;  ||solo haber
          nImporte = #1#6 - #1#7;
      |FINSI;
      |HAZ LaCondicion105;
  |FINSI;

  |SI #4#8 = 2;
      nImporte = #1#9; || todos igual
      |SI #4#7 ] 3;
          |SI #4#7 = 3; |Y nImporte < 0; nImporte = 0; |FINSI;
          |SI #4#7 = 4; |Y nImporte > 0; nImporte = 0; |FINSI;
      |FINSI;
      |HAZ LaCondicion105;
  |FINSI;
|FPRC;

|DEFBUCLE cabasitu105;
  #1#2;
  ;
  enEmpresa, enAnyo, aDCta;
  enEmpresa, enAnyo, aHCta;
  e;
  NULL,calculit105;
|FIN;

|PROCESO calculit1_105;
  #0#6 = enAnyo; #0#7 = #2#0;
  || |SI PARAMETRO = ""; |PINTA #0#6; |PINTA #0#7; |FINSI;

  aCuenta = #2#0;
  |HAZ MSigno08_s;

  |SI #4#8 = 3;
      |SI #4#7 ] 3;
          |SI #4#7 = 3; #2#2 = 0; |FINSI;  ||solo debe
          |SI #4#7 = 4; #2#1 = 0; |FINSI;  ||solo haber
      |FINSI;
      nImporte = #2#1 - #2#2;
      |HAZ LaCondicion105;
  |FINSI;

  |SI #4#8 = 2;
      |SI #4#7 ] 3;
          |SI #4#7 = 3;  #2#4 = 0; |FINSI;
          |SI #4#7 = 4;  #4#3 = 0; |FINSI;
      |FINSI;
      nImporte = #2#3 - #2#4;
      |HAZ LaCondicion105;
  |FINSI;
|FPRC;

|DEFBUCLE elauxi105;
    #2#1;
    ;
    enAnyo, aDCta;
    enAnyo, aHCta;
    e;
    NULL,calculit1_105;
|FIN;

|PROCESO Carga_isom0005;

 aAlfa1 = #4#4; |QBF aAlfa1;
 aDCta = (aAlfa1 + "            ") % 112;
 aHCta = (aAlfa1 + "zzzzzzzzzzzz") % 112;

 |BUCLE cabasitu105;
 |BUCLE elauxi105;
|FPRC;

|DEFBUCLE Carga_isom0005;
   #4#1;
   ;
   nBalNum, nBalance, "     ", 001;
   nBalNum, nBalance, "99999", 999;
   e;
   NULL, Carga_isom0005;
|FIN;


|PROCESO Pase_isom0005;

  |SI PARAMETRO = "";
      || |ATRI I; |PINTA 2156, "Estado Cambios del P.N."; |ATRI 0;
  |FINSI;

  aFichero = "2x" + Usuario;
  |NOME_DAT #2 aFichero;

  aFichero = "2y" + Usuario;
  |NOME_DAT #4 aFichero; |DELINDEX #4;
  enCampo0 = nBalNum;
  |HAZ MontaEstPase;

  |ABRET #105;
  |SELECT #2#105;
  |BUCLE Carga_isom0005;
  |SELECT #1#105;

  |HAZ TotalFich105;

  |CIERRAT #105;
|FPRC;
