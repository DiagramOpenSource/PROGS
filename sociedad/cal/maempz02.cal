|FICHEROS;
     maempr02,MANTE;
     maempr10;
|FIN;

|VARIABLES;
     &empresa   = 0;
     &anyo      = 0;
     &modo      = 0;

     nSalir     = 0;
     nSuma      = 0;
|FIN;

|PROCESO inferior;
     #maempr02#0 = empresa;
     #maempr02#1 = anyo;
     #maempr02#2 = 1;
|FPRC;

|PROCESO superior;
     #maempr02#0 = empresa;
     #maempr02#1 = anyo;
     #maempr02#2 = 999;
|FPRC;

|PROCESO SumaParticipacion;
     #maempr10#73 = (#maempr10#73 + #maempr02#8) ! 2;
     nSuma  = (nSuma  + #maempr02#8) ! 2;
|FPRC;

|DEFBUCLE SumaParticipacion;
     #maempr02#1;
     ;
     empresa, anyo, 001;
     empresa, anyo, 999;
     ;
     NULL, SumaParticipacion;
|FIN;

|PROGRAMA;
     |SI anyo [ 2003;
         |ENTLINEAL #1#maempr02, -3, modo, 22, 1, inferior, superior;
     |SINO;
         |ABRE #maempr10;
         #maempr10#0 = empresa;
         #maempr10#1 = anyo;
         |LEE 040#maempr10.=;
         |SI FSalida ! 0;  |DDEFECTO #maempr10;  |FINSI;

         |SI #maempr10#73 > 100;  #maempr10#73 = 0;  #maempr10#74 = 0;  |FINSI;
         |SI #maempr10#74 > 100;  #maempr10#73 = 0;  #maempr10#74 = 0;  |FINSI;

         |PINPA #0#maempr02;
         |BLANCO 2006 2378;
         |CUADRO 2006 2378;

         |PINTA 2107, "Porc. participaciones inferiores 5% o 1% para valor. cotizados :";
         |PINTA 2207, "Porcentaje de participacion en situaciones especiales .........:";

         |PINTA 2172, #maempr10#73;
         |PINTA 2272, #maempr10#74;

         #maempr10#0 = empresa;
         #maempr10#1 = anyo;
         |LEE 101#maempr10.=;
         |SI FSalida ! 0;
             |DDEFECTO #maempr10;
             #maempr10#0 = empresa;
             #maempr10#1 = anyo;
             |GRABA 020#maempr10.b;
         |FINSI;

         nSalir = 0;
         |PARA; |SI  nSalir = 0; |HACIENDO;
                nSalir = 1;
                |ENTLINEAL #1#maempr02, -3, modo, 19, 0, inferior, superior;

                #maempr10#73 = 0; nSuma = 0;
                |BUCLE SumaParticipacion;
                |SI nSuma [ 100;
                    #maempr10#73 = (100 - #maempr10#73 - #maempr10#74) ! 2; |SI #maempr10#73 < 0; #maempr10#73 = 0; |FINSI;

                    |C_P #maempr10#73, 1, 2172;
                    |C_P #maempr10#74, 1, 2272;

                    |ENCAMPO #73#maempr10;
                    |ENCAMPO #74#maempr10;
                    nSuma = (nSuma + #maempr10#73 + #maempr10#74) ! 2;
                |FINSI;

                |SI nSuma > 100;
                    |MENAV "    Error. La suma de todos los porcentajes de participacion es MAYOR al 100%";
                    nSalir = 0;
                |FINSI;

                |SI nSuma < 100;
                    |CONFI "    SLa suma de todos los porcentajes de participacion debe ser un 100%. Corregir ?";
                    |SI FSalida = 0;
                        nSalir = 0;
                    |FINSI;
                |FINSI;
         |SIGUE;

         |GRABA 020#maempr10.a;
         |LIBERA #maempr10;
         |CIERRA #maempr10;
     |FINSI;
|FPRO;
