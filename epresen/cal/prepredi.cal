|FICHEROS;
    prepredi #0;
    labempre #1;         || empresas
    labtraba #2;         || trabajadores
    prerecib #3;         || RECIBOS ALMACEN!!!
    nomgrubl #6;         || grupos bancos lins.
    nomrevca #7;         || transfer. cabs.
    nomrevli #8;         || transfer. lins.
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;

    el_mes = 0;
    el_any = 0;
    devenga = 0;
    deducir = 0;
    liquido = 0;
    swbaja = 0;
    esta = 0;
    fecalf = "";
    dia = 0;
    mes = 0;
    any = 0;
    confi = "";
    linea = 0;
    la_linea = 0;
|FIN;
____________________________________/
|PROCESO mayus; |TIPO 0;
    #0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|PROCESO defecto; |TIPO 7; ||calcula el a¤o por defecto segun fecha sistema
    fech1 = ~;
    alfa1 = fech1;
    alfa1 = alfa1 % -104;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;

|PROCESO mirames; |TIPO 7;
    fech1 = ~;
    alfa1 = fech1;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;

|PROCESO no_entres; |TIPO 7;
|SI #0#4 = "M";|O #0#4 = "H";
    |CAMPO_MODIFICA #0#8, 1, "S";
|SINO;
        #0#8 = "M"; |PINTA #0#8;
    |CAMPO_MODIFICA #0#8, 1, "N";
|FINSI;
|FPRC;

|PROCESO sel_banco; |TIPO 0;
|SI #0#12 = "G";
    |CAMPO_MODIFICA #0#10, 1, "N";
    |CAMPO_MODIFICA #0#11, 1, "N";
    |CAMPO_MODIFICA #0#13, 1, "S";
|SINO;
    |CAMPO_MODIFICA #0#10, 1, "S";
    |CAMPO_MODIFICA #0#11, 1, "S";
    |CAMPO_MODIFICA #0#13, 1, "N";
|FINSI;
|FPRC;

|PROCESO ultimo; |TIPO 7;
|SI elsw1 = 0;
        elsw1 = 1;
    |ABRE #7;
        #7#0 = #0#0;
        #7#1 = 999999;
    |LEE 000#7];
    |SI FSalida = 0;
        |LEE 000#7a;
    |SINO;
        |LEE 000#7u;
    |FINSI;
    |SI FSalida = 0;|Y #7#0 = #0#0;
            #0#9 = #7#1 + 1;
    |SINO;
            #0#9 = 1;
    |FINSI;
    |CIERRA #7;
|FINSI;
|FPRC;

|PROCESO si_esta; |TIPO 0;
|ABRE #7;
    #7#0 = #0#0;
    #7#1 = #0#9;
|LEE 101#7=;
|SI FSalida = 0;
    |MENSA "2300Registro existente, (I)nicializar - (A)cumular - (C) Cancelar: ";
    |ATRI I;
    |PINTA 2329, "I";
    |PINTA 2345, "A";
    |PINTA 2358, "C";
    |ATRI 0;
        E_sup = 1;
        E_inf = "IACiac";
    |AVISO;
        confi = 2371 ? 0;
    |SI confi = "I";|O confi = "i";
        |MENSA "2300Borrando ...";
        |BUCLELIN 1NULL#7;
        |BORRA 020#7a;
    |SINO;
        |SI confi = "C";|O confi = "c";
            |PTEC 807;
        |FINSI;
    |FINSI;
    |BLIN 23;
|FINSI;
|LIBERA #7;
|CIERRA #7;
|FPRC;
____________________________________/ GRABACION TRANSFERENCIA
|PROCESO graba_cab;
|DDEFECTO #7;
    #7#0 = #0#0;
    #7#1 = #0#9;
|LEE 101#7=;
|SI FSalida ! 0;
    |GRABA 020#7b;
|FINSI;

    #8#0 = #7#0;
    #8#1 = #7#1;
    #8#2 = 99999;
|LEE 000#8];
|SI FSalida = 0;
    |LEE 000#8a;
|SINO;
    |LEE 000#8u;
|FINSI;
|SI FSalida = 0;|Y #8#0 = #7#0;|Y #8#1 = #7#1;
        linea = #8#2 + 1;
|SINO;
        linea = 1;
|FINSI;
|FPRC;

|PROCESO graba_trans;
|SELECT #2#8;
    #8#1 = #0#9;         || registro
    #8#0 = #0#0;         || empresa
    #8#3 = #2#1;         || trabajador
|LEE 000#8=;
|SI FSalida = 0;         || lectura por clave secundaria
        la_linea = #8#2; || por si hay que acumular
|SINO;
        la_linea = linea;
|FINSI;

|SELECT #1#8;
|DDEFECTO #8;
    #8#0 = #0#0;         || empresa
    #8#1 = #0#9;         || registro
    #8#2 = la_linea;     || linea
|LEE 101#8=;
    FEstado = FSalida;

    #8#3 = #2#1;         || trabajador
    #8#4 = #2#7;         || dni
    #8#5 = #2#72;        || cta. cte.
    #8#6 = #8#6 + liquido;    || liquido

|SI FEstado = 0;    |GRABA 020#8a; |FINSI;
|SI FEstado ! 0;    |GRABA 020#8n; |FINSI;
|LIBERA #8;

    #7#2 = #7#2 + liquido;    || total liquidos
|SI FEstado ! 0;
        linea = linea + 1;    || contador de lineas
        #7#3 = #7#3 + 1;      || total transferencias
|FINSI;
    #7#4 = ~;                 || fecha registro
|GRABA 020#7a;
|FPRC;
____________________________________/ CALCULO LIQUIDOS
|PROCESO mirando;
    esta = 1;
|FPRC;

|DEFBUCLE buscalo;
 #6#1;
 ;
 #0#13, #2#71;
 #0#13, #2#71;
 ;
 NULL, mirando;
|FIN;

|PROCESO proceso;
    el_mes = #3#3;

    esta = 0;
|HAZ ordena;
|SI #2#70 = "T";
    |SI #0#12 = "S";
        |SI #2#71 ] #0#10;|Y #2#71 [ #0#11;
                esta = 1;
        |FINSI;
    |SINO;
        |BUCLE buscalo;
    |FINSI;
    |SI esta = 1;
            liquido = #3#12;       || liquido recibo directamente
        |SI liquido > 0;
                #0#14 = #2#0;  |PINTA #0#14;
                #0#15 = #2#1;  |PINTA #0#15;
                seleccio = 1;
            |HAZ graba_trans;
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO ordena;   || LEE EL TRABAJADOR
|DDEFECTO #2;
    #2#0 = #3#0;
    #2#1 = #3#1;
|LEE 000#2=;
|FPRC;

|DEFBUCLE recibos;
 #3#1;
 ;
 #0#0, #0#2, #0#5, #0#6;
 #0#0, #0#3, #0#5, #0#7;
 ;
 NULL, ordena, NULL, NULL, NULL, proceso;
 #2#7, #3#0, #3#1, #3#2, #3#3;
|FIN;

|PROCESO tipo3; |TIPO 3;
|CAMPO_VISUAL #0#14, 1, "S";
|CAMPO_VISUAL #0#15, 1, "S";
|PINTA 2203, "En proceso ...";
    alfa1 = #0#5;   alfa1 = alfa1 % -102;
    el_any = alfa1;

|ABRE #1;
|ABRE #2;
|ABRE #7;
|ABRE #8;
|HAZ graba_cab;
    #1#0 = #0#0;
|LEE 020#1=;
|BUCLE recibos;
|SI seleccio = 0;
    |BORRA 020#7a;
    |MENAV "    Seleccion vacia ...";
|FINSI;
|CIERRA #1;
|CIERRA #2;
|LIBERA #7;
|CIERRA #7;
|CIERRA #8;
|FPRC;
