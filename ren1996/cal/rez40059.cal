|INCLUYE i_lar714;
|INCLUYE i_varemi;
|INCLUYE i_varlar;

|PROCESO LetraDni;
  |QBF CampoDni;
  Letra2 = CampoDni;
  |QBT Letra2;

      Caracter = Letra2 % 101;
  |SI Caracter!"A";|Y Caracter!"B";|Y Caracter!"C";|Y Caracter!"D";
       |Y Caracter!"E";|Y Caracter!"F";
       |Y Caracter!"G";|Y Caracter!"P";|Y Caracter!"Q";|Y Caracter!"S";|Y Caracter!"X";
          Letra4 = "";
          Letra3 = Letra2 % 0;
          Carac2 = Letra3;
      |PARA Carac5 = 1;  |SI Carac5 [ Carac2;  |HACIENDO Carac5 = Carac5 + 1;
              Carac3 = (Carac5 * 100) + 1;
              Letra3 = Letra2 % Carac3;
          |SI Letra3="0";|O Letra3="1";|O Letra3="2";|O Letra3="3";
                        |O Letra3="4";|O Letra3="5";|O Letra3="6";
                        |O Letra3="7";|O Letra3="8";|O Letra3="9";
                  Letra4 = Letra4 + Letra3;
          |FINSI;
      |SIGUE;
          Carac4 = Letra4;
      |SI Carac4 ! 0; |Y Letra4 ! "";
              Carac1 = Carac4 $ 23;
              Carac1 = Carac1 + 1;
              Carac3 = (Carac1 * 100) + 1;
              Letra1 = LetrasNif % Carac3;

              Letra4 = "000000000000" + Letra4;
              Letra7 = Letra4 % -103;
              Letra6 = Letra4 % -403;
              Letra5 = Letra4 % -703;

              Letra8 = Letra5  % 101;
              |SI Letra8 = "0"; Letra5 = Letra5 % 202; |FINSI;

              Letra8 = Letra5  % 101;
              |SI Letra8 = "0"; Letra5 = Letra5 % 201; |FINSI;

              Letra8 = Letra5  % 101;
              |SI Letra8 = "0"; Letra5 = ""; |FINSI;

              |SI Letra5 ! "";
                  Letra4 = Letra5 + Letra6 + Letra7 + Letra1;
              |SINO;
                  Letra4 = Letra6 + Letra7 + Letra1;
              |FINSI;

              CampoDni = Letra4;
              CampoDni = ("000000000" + CampoDni) % -109;
      |FINSI;
  |SINO;
      Caracter = "";
      Cadena   = "";
      |PARA XPara = 1; |SI XPara [ 12; |HACIENDO XPara = XPara + 1;
            Posi = (100 * XPara) + 1;
            Caracter = CampoDni % Posi;
            |SI Caracter ! "."; |Y Caracter ! "-"; |Y Caracter ! " ";
                Cadena = Cadena + Caracter;
            |FINSI;
      |SIGUE;
       CampoDni = Cadena % 109;
  |FINSI;
  CampoDni = (CampoDni + "         ") % 109;
|FPRC;

|PROCESO CambiCanti;
  CantiNum = CantiNum ! 0;
  |SI CantiNum ] 0;
      CantiAlfa = CantiNum;
      CantiAlfa = ("000000000000" + CantiAlfa) % -112;
  |SINO;
      CantiNum  = -CantiNum;
      CantiAlfa = CantiNum;
      CantiAlfa = "N" + (("00000000000" + CantiAlfa) % -111);
  |FINSI;
|FPRC;

|PROCESO BorraCampos;
  ICampos = Campos1 <-;
  |PARA XPara = 1; |SI XPara [ 211; |HACIENDO XPara = XPara + 1;
        Campos   = "";
        ICampos  = ICampos + 1;
  |SIGUE;
|FPRC;

|PROCESO CopiaFichero;
  |SI #500#3 = "D";
      Unidad  = #500#1 + ":";
  |SINO;
      Unidad  = DirectorioD;
  |FINSI;

  |QUE_SISTEMA Sistema;
  FSalida = 0;
  |SI Sistema ! "ESDOS"; |Y #500#3 = "D";
      VAlfa = Raiz + "bin/agcopiaa " + Directorio + Fichero + " " + Unidad;
      |PINTA 2018, "";
      |ATRI I; |SYSTEM VAlfa; |ATRI i;
  |SINO;
      VAlfa1 = Directorio + Fichero;
      VAlfa2 = Unidad + Fichero;
      |COPIA_FICHERO VAlfa1, VAlfa2;
      |SI FSalida ! 0;
          VAlfa3 = "Error [" + FSalida + "] en copia de ficheros ...";
          |PINTA 2018, VAlfa3;
          |PINTA 2380, ".";
          |PAUSA;
      |SINO;
          |SI Sistema ! "ESDOS";
              VAlfa = Raiz + "bin/agichmod 777 " + VAlfa2;
              |SYSTEM VAlfa;
          |FINSI;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO CopiaBasico;
  Fichero = "admon.tab";     |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_a01";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_a02";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_f00";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_o01";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_o02";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_o03";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_o04";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_o05";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_o06";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_o07";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_o08";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_o09";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_o10";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_o11";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_o12";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_o13";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_s01";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_s02";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_s03";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_s04";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_s05";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_p01";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_p02";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_p03";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_p04";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_p05";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_p06";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_p07";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_p08";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_p09";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "hoja_p10";      |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "irpf_pdf.imp";  |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
  Fichero = "r96pdf.exe";    |HAZ CopiaFichero; |SI FSalida ! 0; |ACABA; |FINSI;
|FPRC;

|PROCESO CopiaBueno;
  Pos = -1;
  INSecuen = NSecuen1 <-;
  |ATRI P;
  |PINTA 2018, "";
  |ATRI p;

  Path = "";
  |DBASE Path;
  Path  = "wb  " + Path + "hacienda/imprime.bat";

  Pos = -1;
  |FABRE Path;
  Handle = FSalida;
  |SI FSalida ] 0;
      |SI #500#3 = "D";
          Variable = Variable + " A:" + &#0#37 + &#0#38;
          |FGRABA Variable;
      |FINSI;

      |PARA XPara = 1; |SI XPara [ 200; |HACIENDO XPara = XPara + 1;
            |SI NSecuen = ""; |SAL; |FINSI;

             Fichero  = NSecuen % -108;  |HAZ CopiaFichero;

             Variable = Handle + " " + "r96pdf " + Fichero;
             |SI #500#3 = "D";
                 |SI #500#2 = "N"; Variable = Variable + "  s"; |FINSI;
             |SINO;
                 |SI #500#5 = "N"; Variable = Variable + "  s"; |FINSI;
             |FINSI;
             Variable = Variable + &#0#37 + &#0#38;
             |FGRABA Variable;

             INSecuen = INSecuen + 1;
      |SIGUE;

      |SI #500#3 = "D";
          Variable = Handle + " " + "C:" + &#0#37 + &#0#38;
          |FGRABA Variable;
      |FINSI;

      FSalida = Handle;
      |FCIERRA FSalida;

      Fichero = "imprime.bat"; |HAZ CopiaFichero;
  |FINSI;

  |SI #500#3 = "D";
      |ATRI I;
      |PINTA 2018, " FICHEROS COPIADO !!!!. Introduzca el diskette  ";
      |PINTA 2118, " en una maquina en D.O.S. e introducir A:IMPRIME";
      |ATRI 0;
      |PAUSA;
      |POPV;
  |SINO;
      |ATRI I;
      |PINTA 2018, " FICHEROS COPIADO !!!!. SESION COMPLETADA CON EXITO";
      |ATRI 0;
      |PAUSA;
      |POPV;
  |FINSI;
|FPRC;

|PROCESO CopiaDisco;
  |DDEFECTO #500;
  |PINPA #0#500;
  |PINDA #0#500;
  |ENDATOS #2#500;
  |SI FSalida = 0;
      Raiz       = "";
      |DIRECTORIO Raiz;
      Directorio = "";
      |DBASE Directorio;
      Directorio = Directorio + "hacienda/";
      |SI #500#3 = "S";
          Raiz       = "";
          |DIRECTORIO Raiz;
          DirectorioD = "";
          |DBASE DirectorioD;
          DirectorioD = DirectorioD + "laser";
          |MKDIR DirectorioD;
          Sesion = #500#4; |QBF Sesion;
          DirectorioD = DirectorioD + "/" + Sesion;
          |MKDIR DirectorioD;
          DirectorioD = DirectorioD + "/";
      |FINSI;

      |SI #500#0 = "S"; |HAZ CopiaBasico; |FINSI;
      |SI #500#3 = "S"; |HAZ CopiaBasico; |FINSI;
      |HAZ CopiaBueno;
  |FINSI;
|FPRC;

|PROCESO Diskette; |TIPO 0;
  #500#3 = #500#3 > #500#3;  |PINTA #500#3;

  |C_M #500#4, 1, "S";
  |C_M #500#5, 1, "S";
  |C_M #500#0, 1, "S";
  |C_M #500#1, 1, "S";
  |C_M #500#2, 1, "S";

  |SI #500#3 = "D";
      Atras = 1;
      |C_M #500#4, 1, "N";
      |C_M #500#5, 1, "N";
  |SINO;
      Atras = 0;
      |C_M #500#0, 1, "N";
      |C_M #500#1, 1, "N";
      |C_M #500#2, 1, "N";
  |FINSI;
|FPRC;

|PROCESO Atras;
  |SI Atras = 1; |ACABA; |FINSI;
  |PINPA #0#500;
  |PINDA #0#500;
|FPRC;

|PROCESO Sesion; |TIPO 0;
  |SI #500#3 = "D";                 |ACABA;  |FINSI;
  |SI #500#4 = "        "; |ERROR;  |ACABA;  |FINSI;

  Raiz       = "";
  |DIRECTORIO Raiz;
  Directorio = "";
  |DBASE Directorio;
  Directorio = "rb  " + Directorio + "laser/";
  Sesion = #500#4; |QBF Sesion;
  Directorio = Directorio + Sesion + "/" + "imprime.bat";

  Pos = -1;
  |FABRE Directorio;
  Handle = FSalida;
  |SI FSalida ] 0;
      |CONFI "2400SLa Sesion ya existe, desea otra sesion : "
      |SI FSalida = 0;
          |ERROR;
      |FINSI;
      |FCIERRA Handle;
  |SINO;
      |ACABA;
  |FINSI;
  Pos = -1;
|FPRC;
