|FICHEROS;
   repartid #0;
   redatcon #1;
   repant18 #4;
|FIN;

|VARIABLES;
   &empresa  = 0;
   &nombre   = "";
   &nif      = "";

   Campos    = 0;
   Campos1   = 0;
   Campos2   = 0;
   Campos3   = 0;
   CuantosAnyos = 0;
   FEstado   = 0;
   Modo      = 0;
   Coefia    = 0.00;
   Coefit    = 0.00;
   Coefic    = 0.00;
   Fecpar    = @;
   Feini = @;
   Fefin = @;
   Dias = 0;
   Parte1 = 0.00;
   Parte2 = 0.00;
   anyonum = 0;
   anyofam = 0;
   rafa = 0;
   mayort = 0;
   mayorc = 0;
|FIN;

|INCLUYE i_fechat;
|INCLUYE i_cambio;

|PROGRAMA;
|ABRET #0;
|PINPA #0#0;
#0#0 = empresa;
|LIBERA #0;
|LEE 140#0=;
Modo    = 0;
FEstado = FSalida;
|SI FEstado ! 0; |DDEFECTO #0; Modo = 1; |FINSI;

|PINDA #0#0;
#0#0 = empresa;
#0#1 = nombre;
#0#2 = nif;
|ENDATOS #1#0;
|SI FSalida = 0;
    |SI #0#3 ! 0;
        |SI FEstado = 0; |GRABA 140#0a; |SINO; |GRABA 140#0n; |FINSI;
    |SINO;
        |SI FEstado = 0; |BORRA 140#0a; |FINSI;
    |FINSI;
|FINSI;

|CIERRAT #0;
|FPRO;

|PROCESO grabacon; |TIPO 2;
|ABRE #1;
#1#0 = #0#0;
|LIBERA #1;
|LEE 110#1=;
|SI FSalida = 0;
    #1#143 = "N";
    |SI #0#3 ! 0;  #1#143 = "S";  |FINSI;
    |GRABA 020#1a;
|FINSI;
|CIERRA #1;
|FPRC;

|PROCESO noentres; |TIPO 0;
|SI #0#3 = 0;
    |PDEFECTO #0, 4, 33;
    |PARA Campos = 4; |SI Campos [ 32; |HACIENDO Campos = Campos + 1;
          |C_M #0Campos, 1, "N";
    |SIGUE;
|FINSI;

|SI #0#3 = 1; |O #0#3 = 3;
    |CAMPO_MODIFICA #0#04, 1, "N";
    |CAMPO_MODIFICA #0#05, 1, "N";
    |CAMPO_MODIFICA #0#06, 1, "S";
|FINSI;

|SI #0#3 = 2;
    |CAMPO_MODIFICA #0#04, 1, "S";
    |CAMPO_MODIFICA #0#05, 1, "S";
    |CAMPO_MODIFICA #0#06, 1, "N";
|FINSI;
|FPRC;

|PROCESO  EntraFami;
|SI #0#3 = 0; |ACABA; |FINSI;
|SI Modo ! 1; |ACABA; |FINSI;

|ABRE #1;
#1#0 = #0#0;
|LEE 110#1=;
|LIBERA #1;
|CIERRA #1;

|SI #0#3 = 2; Fecpar = #0#4; |SINO; Fecpar = #0#6; |FINSI;
|SI Fecpar = "01.01.1900";  |CIERRA #1;  |ACABA;  |FINSI;
Feini    = "01.01.1996";
Fefin    = Fecpar;
Dias     = Fefin - Feini + 1;
Parte1   = ((100 * Dias) / 36600) ! 4;
Parte2   = 1 - Parte1;
|SI #0#3 = 1;
    Coefia = Parte2;
    Coefit = Parte1;
    Coefic = Parte1;
|FINSI;
|SI #0#3 = 2;
    |SI #0#5 = "T";
        Coefia = Parte1;
        Coefit = 0;
        Coefic = Parte2;
    |SINO;
        Coefia = Parte1;
        Coefit = Parte2;
        Coefic = 0;
    |FINSI;
|FINSI;
|SI #0#3 = 3;
    Coefia = Parte1;
    Coefit = Parte2;
    Coefic = Parte2;
|FINSI;
#0#10 = (#1#183 * Coefia) + (#1#184 * Coefia);
#0#11 = (#1#183 * Coefit);
#0#12 = (#1#184 * Coefic);
#0#13 = (#1#185 * Coefia) + (#1#186 * Coefia);
#0#14 = (#1#185 * Coefit);
#0#15 = (#1#186 * Coefic);
#0#16 = (#1#187 * Coefia) + (#1#188 * Coefia);
#0#17 = (#1#187 * Coefit);
#0#18 = (#1#188 * Coefic);
#0#19 = (#1#189 * Coefia) + (#1#190 * Coefia);
#0#20 = (#1#189 * Coefit);
#0#21 = (#1#190 * Coefic);
#0#22 = (#1#202 * Coefia) + (#1#203 * Coefia);
#0#23 = (#1#202 * Coefit);
#0#24 = (#1#203 * Coefic);
#0#25 = (#1#204 * Coefia) + (#1#205 * Coefia);
#0#26 = (#1#204 * Coefit);
#0#27 = (#1#205 * Coefic);
#0#28 = (#1#206 * Coefia) + (#1#207 * Coefia);
#0#29 = (#1#206 * Coefit);
#0#30 = (#1#207 * Coefic);

mayort = 0;
mayorc = 0;
|SI #1#3 ! "    ";
   anyonum = #1#3;
   anyofam = 1996 - anyonum;
   |SI anyofam ] 65; mayort = 1; |FINSI;  ||Si el Titular es mayor 65
|FINSI;
rafa = #1#30;
|SI #1#30 ! "    ";  |Y rafa ! 0;
   anyonum = #1#30;
   anyofam = 1996 - anyonum;
   |SI anyofam ] 65; mayorc = 1; |FINSI; ||Si el Conyuge es mayor 65
|FINSI;

|SI #0#3 = 2;
    |SI #0#5 = "T";
        #0#12 = #1#183 + #1#184 - #0#10;
        #0#15 = #1#185 + #1#186 - #0#13;
        |SI mayort ! 1;
            #0#18 = #1#187 + #1#188 - #0#16;
        |SINO;
            #0#18 = ((#1#187 - 1) * Parte1) + (#1#188 * Parte2);
        |FINSI;
        |SI #1#5 ! "S";
            #0#21 = #1#189 + #1#190 - #0#19;
        |SINO;
            #0#21 = ((#1#189 - 1) * Parte1) + (#1#190 * Parte2);
        |FINSI;
        #0#24 = #1#202 + #1#203 - #0#22;
        #0#27 = #1#204 + #1#205 - #0#25;
        #0#30 = #1#206 + #1#207 - #0#28
    |SINO;
        #0#11 = #1#183 + #1#184 - #0#10;
        #0#14 = #1#185 + #1#186 - #0#13;
        |SI mayorc ! 1;
            #0#17 = #1#187 + #1#188 - #0#16;
        |SINO;
            #0#17 = (#1#187 * Parte2) + ((#1#188 - 1) * Parte1);
        |FINSI;
        |SI #1#31 ! "S";
            #0#20 = #1#189 + #1#190 - #0#19;
        |SINO;
            #0#20 = (#1#189 * Parte2)  + ((#1#190 - 1) * Parte1);
        |FINSI;
        #0#23 = #1#202 + #1#203 - #0#22;
        #0#26 = #1#204 + #1#205 - #0#25;
        #0#29 = #1#206 + #1#207 - #0#28
    |FINSI;
|FINSI;
#0#07 = #0#22 + #0#25 + #0#28;
#0#08 = #0#23 + #0#26 + #0#29;
#0#09 = #0#24 + #0#27 + #0#30;

#0#31 = "N";
#0#32 = "N";
|PARA Campos = 68; |SI Campos [ 77; |HACIENDO Campos = Campos + 1;
      Campos1      = Campos + 96;
      Campos2      = Campos + 86;
      CuantosAnyos = 1996 - #1Campos;
      |SI #1Campos1 = "H"; |Y CuantosAnyos [ 18;
          |SI #1Campos2 = "A"; #0#31 = "S"; #0#32 = "S"; |FINSI;
          |SI #1Campos2 = "T"; #0#31 = "S";              |FINSI;
          |SI #1Campos2 = "C"; #0#32 = "S";              |FINSI;
      |FINSI;
|SIGUE;
|FPRC;

|PROCESO escala; |TIPO 7;
|SI #0#3 = 0; |ACABA; |FINSI;

|PUSHV 0501 2380;

|ATRI P;
|PINTA 1717, "Descendientes .........";
|PINTA #0#7;
|PINTA #0#8;
|PINTA #0#9;
|ATRI 0;

|PINPA #0#4;

#4#0 = #0#22;
#4#1 = #0#23;
#4#2 = #0#24;
#4#3 = #0#25;
#4#4 = #0#26;
#4#5 = #0#27;
#4#6 = #0#28;
#4#7 = #0#29;
#4#8 = #0#30;

|PINDA #0#4;
|ENDATOS #1#4;
|SI FSalida = 0;
    #0#22 = #4#0;
    #0#23 = #4#1;
    #0#24 = #4#2;
    #0#25 = #4#3;
    #0#26 = #4#4;
    #0#27 = #4#5;
    #0#28 = #4#6;
    #0#29 = #4#7;
    #0#30 = #4#8;
|FINSI;

#0#7 = #0#22 + #0#25 + #0#28;
#0#8 = #0#23 + #0#26 + #0#29;
#0#9 = #0#24 + #0#27 + #0#30;

|POPV;

|PINTA #0#7;
|PINTA #0#8;
|PINTA #0#9;
|PINTA #0#07;
|PINTA #0#08;
|PINTA #0#09;
|PINTA #0#10;
|PINTA #0#11;
|PINTA #0#12;
|PINTA #0#13;
|PINTA #0#14;
|PINTA #0#15;
|PINTA #0#16;
|PINTA #0#17;
|PINTA #0#18;
|PINTA #0#19;
|PINTA #0#20;
|PINTA #0#21;
|FPRC;

|PROCESO NoConjunta; |TIPO 7;
|C_M #0Campo, 1, "S";
Campos1 = Campo - 23;
|SI #0Campos1 = 0;
    |C_M #0Campo, 1, "N";
    #0Campo = "N";
    |PINTA #Campo;
|FINSI;
|FPRC;
