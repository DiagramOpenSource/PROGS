|FICHEROS;
     rezcaptu;
     reacceso;

     :/integral/def/dsam0000;
     :/integral/def/dsam0003;
     :/integral/def/dsam0005;

     :/contagen/def/canempre;
     :/contagen/def/cacuenta;
     :/contagen/def/camaasil;

     :/basica/def/agicen14;
     :/basica/def/agicen30;

     :/modelos/def/dsmom001;
     :/modelos/def/dsmom042;
     :/modelos/def/dsmom043;
     :/modelos/def/dsm19001;
     :/modelos/def/dsm193ca;
     :/modelos/def/dsm193li;
     :/modelos/def/dsmom014;
     :/modelos/def/dsmom018;
     :/modelos/def/dsmom068;
     :/modelos/def/dsmom060;
     :/modelos/def/dsmom061;

     rem00022;
     rem00025;
     rem00026;
     rem00058;
     rem00041;
     rem00905;
     reauxval;

     rew00070;
     rew00071;

     activida@;

     rem01001@;
     rem01011@;
|FIN;

|VARIABLES;
      aBase          = "";
      aPathFich      = "";
      aMas           = "";
      aFichero       = "";
      aNif           = "";
      aAlfa          = "";
      aAlfa1         = "";
      aAlfa2         = "";
      aIdentificador = "";
      aContri        = "";
      aDC            = "";
      aHC            = "";
      aNome          = "";
      aCas           = "";

      nLinea        = 0;
      nValor        = 0;
      nEmpresa43    = 0;
      nActivid43    = 0;
      nComprueba    = 0;
      nComple       = 0;
      nSaldo        = 0;
      nFactor       = 0;
      nImporte      = 0;
      nDepar        = 0;
      nOk           = 0;

     &enEmpresa    = 0;
     &enAmortiza   = 0;
     &enActividad  = 0;
     &enConAct     = 0;
     &enConv       = 0;
     &enSwPasa     = 0;
     &enTipoGanan  = 0;
     &eaPrograma   = "";
     &eaPunto      = "  ";
     &eaPerceptor  = "";
     &eaCaptura    = "";
     &enDComple    = 0;
     &enHComple    = 0;
     &enError      = 0;
     &enGastos     = 0;
     &eaRefCast    = "";
     &eaLorca      = "";
     &enImporte    = 0;
     &enImporteT   = 0;
     &enImporteC   = 0;
     &enImporte1   = 0;
     &enImporte2   = 0;
     &enImporte3   = 0;
     &enImporte4   = 0;
     &enPorce      = 0;

     &enOk               = 0;
     &enLin              = 0;
     &eaModal            = "";
     &ea32_1             = "";
     &ea32_2_1           = "";
     &en0180             = 0;
     &en0218             = 0;
     &en0219             = 0;
     &en0220             = 0;
     &en0221             = 0;
     &en0222             = 0;
     &en0223             = 0;
     &en0224             = 0;
     &en0225             = 0;
     &en0226             = 0;

     &eaAzul             = "";
     &eaVerde            = "";
     &eaRojo             = "";
     &eaRosa             = "";
|FIN;

|PROCESO CogeAmortizacion;
     enAmortiza = (enAmortiza + #dsmom042#11) ! 2;
|FPRC;

|DEFBUCLE dsmom042;
     #dsmom042#1;
     1, 9, 6;
     #canempre#2, "        ", 00, 001, enActividad, "01.01.2019", "A";
     #canempre#2, "zzzzzzzz", 99, 999, enActividad, "31.12.2019", "A";
     ;
     NULL, CogeAmortizacion;
|FIN;

|PROCESO AmortizaAgricola;
     enAmortiza = 0;
     |BUCLE dsmom042;
|FPRC;

|PROCESO GrabaEl41;
     nLinea = 1;
     |ABRE #rem00041;
     #rem00041#0 = #reacceso#0;
     #rem00041#1 = 99;
     |LEE 040#rem00041.];
     |SI FSalida = 0;
         |LEE 040#rem00041.a;
     |SINO;
         |LEE 040#rem00041.u;
     |FINSI;
     |SI FSalida = 0;  |Y #rem00041#0 = #reacceso#0;
         nLinea = #rem00041#1 + 1;
         |SI nLinea ] 99;
             |PARA nLinea = 99; |SI nLinea ] 0; |HACIENDO nLinea = nLinea - 1;
                   #rem00041#0 = #reacceso#0;
                   #rem00041#1 = nLinea;
                   |LEE 040#rem00041.=;
                   |SI FSalida ! 0;  |SAL;  |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;

     #rem00041#0 = #reacceso#0;
     #rem00041#1 = nLinea;
     |LEE 101#rem00041.=;
     |SI FSalida ! 0;
         |DDEFECTO #rem00041;
         #rem00041#0  = #reacceso#0;
         #rem00041#1  = nLinea;
         #rem00041#3  = "X";
         |GRABA 020#rem00041.b;
     |FINSI;

     #rem00041#2  = eaPerceptor;
     #rem00041#13 = #dsmom043#4;
     #rem00041#16 = "7";
     #rem00041#14 = "O";
     #rem00041#20 = #dsmom043#7;
     #rem00041#19 = #dsmom043#6;
     #rem00041#21 = #dsmom043#9 % enPorce;
     #rem00041#27 = (#dsmom043#10 % enPorce) - (#dsmom043#12 % enPorce);

     nValor = #rem00041#21 - #rem00041#27;
     |SI nValor < 0;
         #rem00041#28 = -nValor;
         #rem00041#29 = #rem00041#22;
     |SINO;
         #rem00041#30 = nValor;
         #rem00041#35 = #rem00041#30;
         #rem00041#44 = #rem00041#30;
     |FINSI;

     #rem00041#11 = "PA";

     |GRABA 020#rem00041.a;
     |LIBERA #rem00041;

     eaPrograma   = "rem00041";
     eaPunto      = "  ";
     |HAZ ProgramaActivo;
|FPRC;

|PROCESO GrabaGananyPerd;
      |SI enTipoGanan = 1;  |Y #dsmom043#8 = 1;
          |HAZ GrabaEl41;
      |FINSI;

     |SI enTipoGanan = 2;  |Y #dsmom043#8 ! 1;
         |HAZ GrabaEl41;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom043;
     #dsmom043#1;
     1;
     nEmpresa43, "        ", 00, 2019, nActivid43;
     nEmpresa43, "zzzzzzzz", 99, 2019, nActivid43;
     ;
     NULL, GrabaGananyPerd;
|FIN;

|PROCESO MiraComunero_1;
     |SI #dsmom001#8 > "01.01.0000";
         |SI #dsmom001#8 > "31.12.2019";  |ACABA;  |FINSI;
     |FINSI;

     |SI #dsmom001#9 > "01.01.0000";
         |SI #dsmom001#9 < "01.01.2019";  |ACABA;  |FINSI;
     |FINSI;

     nEmpresa43  = #dsmom001#0;
     nActivid43  = #dsmom001#1;
     enPorce     = #dsmom001#7;
     |BUCLE dsmom043;
|FPRC;

|DEFBUCLE dsmom001_1;
     #dsmom001#2;
     ;
     #agicen14#0, #agicen14#1;
     #agicen14#0, #agicen14#1;
     ;
     NULL, MiraComunero_1;
|FIN;

|PROCESO GananciasYPerdidas;
     |SI #agicen30#8  = 13;  |O #agicen30#8 = 14;  |O #agicen30#8 = 15;
      |O #agicen30#8  = 16;  |O #agicen30#8 = 17;  |O #agicen30#8 = 19;
         |BUCLE dsmom001_1;
     |SINO;
         nEmpresa43 = #agicen14#0;
         nActivid43 = #agicen14#1;
         enPorce    = 100;
         |BUCLE dsmom043;
     |FINSI;
|FPRC;

|PROCESO Borra141;
     |SI #rem00041#3 = "X";
         |BORRA 020#rem00041.a;
         eaPrograma   = "rem00041";
         eaPunto      = "  ";
         |HAZ ProgramaActivo;
     |SINO;
         enSwPasa = 0;
     |FINSI;
     |LIBERA #rem00041;
|FPRC;

|DEFBUCLE rem00041;
     #rem00041#1;
     11;
     #reacceso#0, 01, "PA";
     #reacceso#0, 99, "PA";
     be;
     NULL, Borra141;
|FIN;

|PROCESO Borra41;
     |BUCLE rem00041;
|FPRC;

|PROCESO BuscaCaptura;
     |DBASS aBase;  |QBF aBase;
     aMas = aBase + "basica/def/agicen14.mas";
     |CARGA_DEF aMas, activida@;
     |SI FSalida = 0;
         aPathFich = aBase + "basica/fich/";
         |PATH_DAT #activida@#aPathFich#;

         |ABRE #activida@;
         |SELECT #1#activida@;
         #activida@#0 = #dsmom001#0;
         #activida@#1 = #dsmom001#1;
         |LEE 000#activida@.=;
         |SI FSalida ! 0;  |DDEFECTO #activida@;  |FINSI;
         |CIERRA #activida@;

         eaCaptura = #activida@#15;
     |FINSI;

     |DESCARGA_DEF #activida@;

     |DBASS aBase;  |QBF aBase;
     aMas = aBase + "basica/def/agicen30.mas";
     |CARGA_DEF aMas, activida@;
     |SI FSalida = 0;
         aPathFich = aBase + "basica/fich/";
         |PATH_DAT #activida@#aPathFich#;

         |ABRE #activida@;
         |SELECT #1#activida@;
         #activida@#0 = #dsmom001#0;
         #activida@#1 = #dsmom001#1;
         #activida@#2 = 2019;
         |LEE 000#activida@.=;
         |SI FSalida ! 0;  |DDEFECTO #activida@;  |FINSI;
         |CIERRA #activida@;

         |SI #activida@#16 ! "          ";
             eaCaptura = #activida@#16;
         |FINSI;
     |FINSI;

     |DESCARGA_DEF #activida@;
|FPRC;

|PROCESO AbreTempoTrab;
     aFichero = ("70" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #rew00070#aFichero#;
|FPRC;

|PROCESO GrabaFiltro;
     |ABRE #rew00070;
     #rew00070#0 = #dsm19001#0;
     |LEE 101#rew00070.=;
     |SI FSalida ! 0;
         |DDEFECTO #rew00070;
         #rew00070#0 = #dsm19001#0;
         |GRABA 020#rew00070.b;
     |FINSI;
     #rew00070#1 = enDComple;
     #rew00070#2 = enHComple;
     |GRABA 020#rew00070.a;
     |LIBERA #rew00070;
     |CIERRA #rew00070;
|FPRC;

|PROCESO LeeFiltro;
     |ABRE #rew00070;
     #rew00070#0 = #dsm19001#0;
     |LEE 101#rew00070.=;
     |SI FSalida ! 0;  |DDEFECTO #rew00070;  |FINSI;
     |CIERRA #rew00070;

     enError = 0;
     |SI #dsm19001#4 < #rew00070#1;  |O #dsm19001#4 > #rew00070#2;
         enError = 1;
     |FINSI;
|FPRC;

|PROCESO CierraTempoTrab;
     |DELINDEX #rew00070;
|FPRC;

|PROCESO PintaPantalla;
     |PINPA #0#rezcaptu;
|FPRC;

|PROCESO Busca122;
     nLinea = #rem00022#1;
|FPRC;

|DEFBUCLE rem00022B;
     #rem00022#1;
     18;
     #reacceso#0, 01, aIdentificador;
     #reacceso#0, 99, aIdentificador;
     be;
     NULL, Busca122;
|FIN;

|PROCESO dsm193li;
     |SI nComprueba = 0;
         |SI #dsm193li#4 ! 0;
             |ABRE #dsm193ca;
             #dsm193ca#0 = #dsm193li#0;
             #dsm193ca#1 = #dsm193li#1;
             #dsm193ca#2 = #dsm193li#2;
             #dsm193ca#3 = #dsm193li#3;
             #dsm193ca#4 = #dsm193li#4;
             #dsm193ca#5 = #dsm193li#5;
             |LEE 040#dsm193ca.=;
             |SI FSalida ! 0;  |DDEFECTO #dsm193ca;  |FINSI;
             |CIERRA #dsm193ca;

             |SI #dsm193ca#14 = "S";
                 enDComple = #dsm193li#4;
                 enHComple = #dsm193li#4;
             |SINO;
                 enHComple = #dsm193li#4;
             |FINSI;
         |SINO;
             enDComple = #dsm193li#4;
             enHComple = #dsm193li#4;
         |FINSI;

         #dsm19001#0 = #dsm193li#0;
         |HAZ GrabaFiltro;

         |ACABA;
     |FINSI;

     #dsm19001#0 = #dsm193li#0;
     #dsm19001#4 = #dsm193li#4;
     |HAZ LeeFiltro;
     |SI enError = 1;  |ACABA;  |FINSI;

     nLinea         = 0;
     aIdentificador = "*" + (("00000" + #dsm193li#0) % -105) + (#dsm193li#6 % 109) + (("0000" + #dsm193li#7) % -104) + "*";
     |BUCLE rem00022B;

     |SI nLinea = 0;
         |ABRE #rem00022;
         nLinea = 1;
         #rem00022#0 = #reacceso#0;
         #rem00022#1 = 99;
         |LEE 040#rem00022.];
         |SI FSalida = 0;
             |LEE 040#rem00022.a;
         |SINO;
             |LEE 040#rem00022.u;
         |FINSI;
         |SI FSalida = 0;  |Y #rem00022#0 = #reacceso#0;
             nLinea = #rem00022#1 + 1;
             |SI nLinea ] 99;
                 |PARA nLinea = 99; |SI nLinea ] 0; |HACIENDO nLinea = nLinea - 1;
                       #rem00022#0 = #reacceso#0;
                       #rem00022#1 = nLinea;
                       |LEE 040#rem00022.=;
                       |SI FSalida ! 0;  |SAL;  |FINSI;
                 |SIGUE;
             |FINSI;
         |FINSI;
         |CIERRA #rem00022;
     |FINSI;

     |SI nLinea = 0;  |ACABA;  |FINSI;

     #rem00022#0 = #reacceso#0;
     #rem00022#1 = nLinea;
     |LEE 101#rem00022.=;
     |SI FSalida ! 0;
         |DDEFECTO #rem00022;
         #rem00022#0 = #reacceso#0;
         #rem00022#1 = nLinea;
         #rem00022#3  = "X";
         |GRABA 020#rem00022.b;
     |FINSI;

     |SI #rem00022#3 ! "X";  |ACABA;  |FINSI;

     |ABRE #dsam0000;
     #dsam0000#0 = #dsm193li#0;
     |LEE 040#dsam0000.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0000;  |FINSI;
     |CIERRA #dsam0000;

     |ABRE #reauxval;
     |SELECT #2#reauxval;
     #reauxval#1 = #dsam0000#1;
     |LEE 000#reauxval.=;
     |SI FSalida ! 0;  |DDEFECTO #reauxval;  |FINSI;
     |CIERRA #reauxval;

     #rem00022#2  = eaPerceptor;
     #rem00022#16 = #reauxval#0;
     #rem00022#17 = #dsam0000#1;
     #rem00022#18 = aIdentificador;
     #rem00022#19 = #rem00022#19 + #dsm193li#23;
     #rem00022#23 = #dsm193li#24;
     #rem00022#20 = 0;
     #rem00022#21 = 0;
     #rem00022#24 = #rem00022#19 % #rem00022#23;
     #rem00022#22 = #rem00022#19;

                              #rem00022#30 = "";
     |SI #rem00022#3  = "X";  #rem00022#30 = eaRojo;  |FINSI;

     |GRABA 020#rem00022.a;
     |LIBERA #rem00022;

     eaPrograma   = "rem00022";
     eaPunto      = "  ";
     |HAZ ProgramaActivo;
|FPRC;

|DEFBUCLE dsm193li;
     #dsm193li#1;
     ;
     00000, 2019, 99, 193, enDComple, 00, aNif, 0000, "A", "02", 1;
     99999, 2019, 99, 193, enHComple, 99, aNif, 9999, "A", "02", 1;
     ;
     NULL, NULL, NULL, NULL, NULL, dsm193li;
     6, 1, 4, 8, 9;
|FIN;

|PROCESO Borra122;
     aAlfa1 =  #rem00022#18 % 101;
     aAlfa2 =  #rem00022#18 % 2001;
     |SI aAlfa1 ! "*"; |O aAlfa2 ! "*";
         |ACABA;
    |FINSI;

     |SI #rem00022#3 = "X";
         |BORRA 020#rem00022.a;
         eaPrograma   = "rem00022";
         eaPunto      = "  ";
         |HAZ ProgramaActivo;
     |FINSI;
     |LIBERA #rem00022;
|FPRC;

|DEFBUCLE rem00022;
     #rem00022#1;
     ;
     #reacceso#0, 01;
     #reacceso#0, 99;
     be;
     NULL, Borra122;
|FIN;

|PROCESO PasaDelModelo193;
     |ABRET #rem00022;

     |BUCLE rem00022;

     |HAZ AbreTempoTrab;
     aNif        = #dsam0003#1;   |QBT aNif;
     eaPerceptor = "TITULAR";
     enDComple   = 0;
     enHComple   = 99;
     nComprueba  = 0;  |BUCLE dsm193li;
     nComprueba  = 1;  |BUCLE dsm193li;
     |HAZ CierraTempoTrab;


     |HAZ AbreTempoTrab;
     aNif        = #dsam0003#35;   |QBT aNif;
     eaPerceptor = "CONYUGE";
     enDComple   = 0;
     enHComple   = 99;
     nComprueba  = 0;  |BUCLE dsm193li;
     nComprueba  = 1;  |BUCLE dsm193li;
     |HAZ CierraTempoTrab;

     |CIERRAT #rem00022;
|FPRC;

|PROCESO rem01011;
     enGastos = enGastos + #rem01011@#15;
|FPRC;

|DEFBUCLE rem01011;
     #rem01011@#1004;
     9;
     #reacceso#0, nComple, aContri, 001, eaRefCast;
     #reacceso#0, nComple, aContri, 999, eaRefCast;
     ;
     NULL, rem01011;
|FIN;

|PROCESO rem01001;
     nComple  = #rem01001@#1;
     aContri  = #rem01001@#2;
     |BUCLE rem01011;
|FPRC;

|DEFBUCLE rem01001;
     #rem01001@#1003;
     5;
     #reacceso#0, 00, "          ", "100";
     #reacceso#0, 99, "zzzzzzzzzz", "101";
     ;
     NULL, rem01001;
|FIN;

|PROCESO RecogeGastos;
     |DBASS aBase;
     aMas = aBase + "ren2018/def/rem01001.mas";
     |CARGA_DEF aMas, rem01001@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aMas = aBase + "ren2018/def/rem01011.mas";
     |CARGA_DEF aMas, rem01011@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aPathFich = aBase + "ren2018/fich/";
     |PATH_DAT #rem01001@#aPathFich#;
     |PATH_DAT #rem01011@#aPathFich#;

     enGastos = 0;
     |BUCLE rem01001;

     |DESCARGA_DEF #rem01011@;
     |DESCARGA_DEF #rem01001@;
|FPRC;

|PROCESO MiraLorca;
     |ABRE #dsmom068;
     #dsmom068#0 = #dsmom018#0;
     #dsmom068#1 = #dsmom018#1;
     #dsmom068#2 = #dsmom018#2;
     #dsmom068#3 = #dsmom018#3;
     |LEE 000#dsmom068.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom068;  |FINSI;
     |CIERRA #dsmom068;

     eaLorca = #dsmom068#12;
|FPRC;

|PROCESO cacuenta;
     nSaldo = #cacuenta#53 - #cacuenta#50;

     |SI eaPerceptor = "TITULAR   ";  enImporteT = enImporteT + nSaldo;  |FINSI;
     |SI eaPerceptor = "CONYUGE   ";  enImporteC = enImporteC + nSaldo;  |FINSI;
     |SI eaPerceptor = "1 FAMILIAR";  enImporte1 = enImporte1 + nSaldo;  |FINSI;
     |SI eaPerceptor = "2 FAMILIAR";  enImporte2 = enImporte2 + nSaldo;  |FINSI;
     |SI eaPerceptor = "3 FAMILIAR";  enImporte3 = enImporte3 + nSaldo;  |FINSI;
     |SI eaPerceptor = "4 FAMILIAR";  enImporte4 = enImporte4 + nSaldo;  |FINSI;
|FPRC;

|DEFBUCLE cacuenta;
     #cacuenta#6;
     ;
     "S", aDC;
     "S", aHC;
     ;
     NULL, cacuenta;
|FIN;

|PROCESO Asalariados;
     |ABRE #canempre;
     |SELECT #4#canempre;
     #canempre#2  = #agicen14#0;
     #canempre#26 = 19;               || Ejercicio 2019
     |LEE 040#canempre.=;
     |SI FSalida ! 0;
         |CIERRA #canempre;
         |ACABA;
     |FINSI;

     |DBASS aBase;  |QBF aBase;
     aPathFich = aBase + "contagen/fich/" + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";

     |PATH_DAT #cacuenta#aPathFich#;
     aDC = "64";
     aHC = "64zzzzzzzzz";
     |BUCLE cacuenta;
|FPRC;

|| ------------------------------------- Estimacion Directa

|PROCESO Graba71;
     #rew00071#0 = #rem00905#2;
     #rew00071#1 = #camaasil#4;
     |LEE 101#rew00071.=;
     |SI FSalida ! 0;
         |DDEFECTO #rew00071;
         #rew00071#0 = #rem00905#2;
         #rew00071#1 = #camaasil#4;
         #rew00071#3 = #dsmom061#5;
         #rew00071#4 = #dsmom061#7;
         #rew00071#5 = #dsmom060#1;
         |GRABA 020#rew00071.b;
     |FINSI;

     |SI #dsmom061#5 = "-";
         #rew00071#2 = #rew00071#2 - nImporte;
     |SINO;
         #rew00071#2 = #rew00071#2 + nImporte;
     |FINSI;

     |GRABA 020#rew00071.a;
     |LIBERA #rew00071;
|FPRC;

|PROCESO camaasil_Directa;
     nDepar = #camaasil#21;
     |SI nDepar = 0;
         nDepar = enActividad;
     |FINSI;

     |SI nDepar ! enActividad;
         |ACABA;
     |FINSI;

     |SI #camaasil#0 = 99;  |ACABA;  |FINSI;

     nFactor = 1;
     |SI #dsmom060#1 = "I";
         |SI #camaasil#8 = "D"; nFactor = -1; |FINSI;
     |SINO;
         |SI #camaasil#8 = "H"; nFactor = -1; |FINSI;
     |FINSI;

     nImporte =  ((#camaasil#9 / enConv) * nFactor) ! 2;
     |HAZ Graba71;
|FPRC;

|DEFBUCLE camaasil_Directa;
     #camaasil#3;
     0;
     aDC, "01.01.2019", 000001, 0001, 00;
     aHC, "31.12.2019", 999999, 9999, 99;
     ;
     NULL, camaasil_Directa;
|FIN;

|PROCESO dsmom061;
     aDC = #dsmom061#4;
     aHC = #dsmom061#4;  |QBF aHC;
     aHC = (aHC + "zzzzzzzzzzzz") % 112;
     |BUCLE camaasil_Directa;
|FPRC;

|DEFBUCLE dsmom061;
     #dsmom061#1;
     ;
     #dsmom060#6, #dsmom060#0, #dsmom060#1, #dsmom060#2, 001;
     #dsmom060#6, #dsmom060#0, #dsmom060#1, #dsmom060#2, 999;
     ;
     NULL, dsmom061;
|FIN;

|PROCESO dsmom060;
     #rem00905#5 = #dsmom060#7;
     |LEE 000#rem00905.=;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     |BUCLE dsmom061;
|FPRC;

|DEFBUCLE dsmom060;
     #dsmom060#2;
     ;
     2019, "N", " ", "A  ";
     2019, "N", "z", "zzz";
     ;
     NULL, dsmom060;
|FIN;

|PROCESO rew00071;
     #rem00026#0 = #rem00025#0;
     #rem00026#1 = #rem00025#1;
     #rem00026#4 = #rew00071#0;
     |LEE 101#rem00026.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #rew00071#5 = "I";
         #rew00071#2 = -#rew00071#2;
     |FINSI;

     |SI #rew00071#4 = "P";
         |SI #rew00071#2 < 0;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #rew00071#4 = "N";
         |SI #rew00071#2 > 0;
             |ACABA;
         |FINSI;
     |FINSI;


     #rem00026#5 = #rem00026#5 + #rew00071#2;

/*
     |SI #rew00071#3 = "-";
         #rem00026#5 = #rem00026#5 - #rew00071#2;
     |SINO;
         #rem00026#5 = #rem00026#5 + #rew00071#2;
     |FINSI;
*/

     |GRABA 020#rem00026.a;
     |LIBERA #rem00026;
|FPRC;

|DEFBUCLE rew00071;
     #rew00071#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, rew00071;
|FIN;

|PROCESO rem00905;
     #rem00026#0 = #rem00025#0;
     #rem00026#1 = #rem00025#1;
     #rem00026#2 = #rem00905#0;
     |LEE 000#rem00026.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |DDEFECTO #rem00026;
     #rem00026#0 = #rem00025#0;
     #rem00026#1 = #rem00025#1;
     #rem00026#2 = #rem00905#0;
     #rem00026#3 = #rem00905#1;
     #rem00026#4 = #rem00905#2;
     #rem00026#6 = #rem00905#6;

     |GRABA 020#rem00026.n;
     |LIBERA #rem00026;
|FPRC;

|DEFBUCLE rem00905;
     #rem00905#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, rem00905;
|FIN;

|PROCESO Graba25;
     |DDEFECTO #rem00025;
     #rem00025#0 = #reacceso#0;
     #rem00025#1 = enConAct;

     #rem00025#2  = eaPerceptor;
     #rem00025#3  = "A";
     #rem00025#4  = 0;
     |SI enPorce ! 100;
         #rem00025#13 = "S";
         #rem00025#15 = #dsam0000#3;
         #rem00025#16 = #dsam0000#1;
     |FINSI;

     #rem00025#14 = enPorce;

                            #rem00025#18 = "1";
     |SI #agicen30#12 = 1;  #rem00025#18 = "1";  |FINSI;
     |SI #agicen30#12 = 2;  #rem00025#18 = "3";  |FINSI;
     |SI #agicen30#12 = 3;  #rem00025#18 = "2";  |FINSI;
     |SI #agicen30#12 = 5;  #rem00025#18 = "4";  |FINSI;
     |SI #agicen30#12 = 4;  #rem00025#18 = "5";  |FINSI;

     #rem00025#19 = #agicen30#3;
     #rem00025#20 = #agicen30#4;
     |SI #rem00025#20 = "9999";  #rem00025#20 = "    ";  |FINSI;

     #rem00025#21 = #agicen30#5;
     #rem00025#22 = #dsam0005#9;
     #rem00025#23 = #dsam0005#10;
     aAlfa  = #dsam0005#3 + " " + #dsam0005#4;  |QBF aAlfa;
     aAlfa  = aAlfa + " " + #dsam0005#5;
     #rem00025#24 = aAlfa;

     #rem00025#11 = "N";
     |SI #agicen30#8 = 4;  |O #agicen30#8 = 9;  |O #agicen30#8 = 14;
         #rem00025#11 = "S";
     |FINSI;

     |GRABA 020#rem00025.b;
     |LIBERA #rem00025;
|FPRC;

|PROCESO GrabaDirecta;
     |ABRE #dsam0005;
     #dsam0005#0 = #agicen14#0;
     #dsam0005#1 = #agicen14#1;
     |LEE 040#dsam0005.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0005;  |FINSI;
     |CIERRA #dsam0005;

     #rem00025#0 = #reacceso#0;
     #rem00025#1 = enConAct;
     |LEE 101#rem00025.=;
     |SI FSalida ! 0;
         |HAZ Graba25;
     |FINSI;

     |SELECT #1#rem00026;
     |BUCLE rem00905;

     |SELECT #2#rem00026;
     |BUCLE rew00071;

     enLin    = #rem00025#1;
     eaModal  = #rem00025#11;
     ea32_1   = #rem00025#31;
     ea32_2_1 = #rem00025#32;
     |SUB_EJECUTA "rem00026;RECALCULA";

     #rem00025#25 = en0180;
     #rem00025#26 = en0218;
     #rem00025#27 = en0220 + en0223;
     #rem00025#28 = en0224;
     #rem00025#29 = en0225;
     #rem00025#30 = en0226;

     |GRABA 020#rem00025.a;
     |LIBERA #rem00025;

     eaPrograma   = "rem00025";
     eaPunto      = "  ";
     |HAZ ProgramaActivo;

     |SI #rem00025#13 = "S";
         |ABRE #rem00058;
         |SELECT #2#rem00058;
         #rem00058#0  = #rem00025#0;
         #rem00058#14 = "E1";
         #rem00058#15 = #rem00025#1;
         |LEE 040#rem00058.=;
         |SI FSalida ! 0;
             |SELECT #1#rem00058;
             #rem00058#0 = #rem00025#0;
             #rem00058#1 = 99;
             |LEE 040#rem00058.];
             |SI FSalida = 0;
                 |LEE 040#rem00058.a;
             |SINO;
                 |LEE 040#rem00058.u;
             |FINSI;
             nLinea = 1;

             |SI FSalida = 0;  |Y #rem00058#0 = #rem00025#0;
                 nLinea = #rem00058#1 + 1;
             |FINSI;
         |SINO;
             nLinea = #rem00058#1;
         |FINSI;

         |DDEFECTO #rem00058;
         |SELECT #1#rem00058;
         #rem00058#0  = #rem00025#0;
         #rem00058#1  = nLinea;
         |LEE 101#rem00058.=;
         |SI FSalida ! 0;
             |DDEFECTO #rem00058;
             #rem00058#0  = #rem00025#0;
             #rem00058#1  = nLinea;
             |GRABA 020#rem00058.b;
         |FINSI;

         #rem00058#2  = #rem00025#2;
         #rem00058#3  = "R";
         #rem00058#4  = #rem00025#4;
         #rem00058#5  = #rem00025#5;
         #rem00058#6  = #rem00025#6;
         #rem00058#7  = #rem00025#7;
         #rem00058#8  = #rem00025#8;
         #rem00058#9  = #rem00025#9;
         #rem00058#10 = #rem00025#10;
         #rem00058#11 = #rem00025#14;
         #rem00058#12 = #rem00025#15;
         #rem00058#14 = "E1";
         #rem00058#15 = #rem00025#1;

         |SI #rem00025#20 ! "8612";
             #rem00058#13 = 3;
             #rem00058#27 = #rem00025#28 % #rem00058#11;
             #rem00058#29 = #rem00025#29 % #rem00058#11;
             #rem00058#30 = #rem00058#27 - #rem00058#28 - #rem00058#29;
         |SINO;
             #rem00058#13 = 2;
             #rem00058#23 = #rem00025#28 % #rem00058#11;
             #rem00058#56 = #rem00025#29 % #rem00058#11;
             #rem00058#26 = #rem00058#23 - #rem00058#24 - #rem00058#25 - #rem00058#56;
         |FINSI;

         |GRABA 020#rem00058.a;
         |LIBERA #rem00058;
         |CIERRA #rem00058;

         eaPrograma   = "rem00058";
         eaPunto      = #rem00058#13;
         |HAZ ProgramaActivo;
     |FINSI;
|FPRC;

|PROCESO EstDirecta;
     aNome = "rew00071" + Usuario;
     |NOME_DAT #rew00071#aNome#;
     |ABRE #rew00071;  |CIERRA #rew00071;  |DELINDEX #rew00071;

     |ABRE #rew00071;
     |ABRET #rem00905;  |SELECT #2#rem00905;
     |BUCLE dsmom060;

     |LEE 000#rew00071.p;
     nOk = FSalida;
     |CIERRA #rew00071;

     |SI nOk ! 0;
         |DELINDEX #rew00071;
         |ACABA;
     |FINSI;

     |ABRET #rem00025;
     |ABRET #rem00026;

     |HAZ GrabaDirecta;

     |CIERRAT #rem00025;
     |CIERRAT #rem00026;
     |CIERRAT #rem00905;
     |DELINDEX #rew00071;
|FPRC;

|PROCESO GrabaDirectaPlan;
     |ABRE #dsam0005;
     #dsam0005#0 = #agicen14#0;
     #dsam0005#1 = #agicen14#1;
     |LEE 040#dsam0005.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0005;  |FINSI;
     |CIERRA #dsam0005;

     #rem00025#0 = #reacceso#0;
     #rem00025#1 = enConAct;
     |LEE 101#rem00025.=;
     |SI FSalida ! 0;
         |HAZ Graba25;

         |GRABA 020#rem00025.a;
         |LIBERA #rem00025;

         |SELECT #1#rem00026;
         |BUCLE rem00905;

         enOk = 1;
     |FINSI;

                            aCas = "";
     |SI #dsmom014#7 = 01;  aCas = "0171";  |FINSI;
     |SI #dsmom014#7 = 21;  aCas = "0172";  |FINSI;
     |SI #dsmom014#7 = 22;  aCas = "0173";  |FINSI;
     |SI #dsmom014#7 = 23;  aCas = "0174";  |FINSI;
     |SI #dsmom014#7 = 03;  aCas = "0175";  |FINSI;
     |SI #dsmom014#7 = 02;  aCas = "0178";  |FINSI;
     |SI #dsmom014#7 = 04;  aCas = "0181";  |FINSI;
     |SI #dsmom014#7 = 24;  aCas = "0183";  |FINSI;
     |SI #dsmom014#7 = 05;  aCas = "0184";  |FINSI;
     |SI #dsmom014#7 = 06;  aCas = "0185";  |FINSI;
     |SI #dsmom014#7 = 25;  aCas = "0187";  |FINSI;
     |SI #dsmom014#7 = 26;  aCas = "0189";  |FINSI;
     |SI #dsmom014#7 = 07;  aCas = "0190";  |FINSI;
     |SI #dsmom014#7 = 08;  aCas = "0192";  |FINSI;
     |SI #dsmom014#7 = 09;  aCas = "0193";  |FINSI;
     |SI #dsmom014#7 = 11;  aCas = "0198";  |FINSI;
     |SI #dsmom014#7 = 10;  aCas = "0199";  |FINSI;
     |SI #dsmom014#7 = 27;  aCas = "0200";  |FINSI;
     |SI #dsmom014#7 = 12;  aCas = "0202";  |FINSI;
     |SI #dsmom014#7 = 14;  aCas = "0203";  |FINSI;
     |SI #dsmom014#7 = 13;  aCas = "0206";  |FINSI;
     |SI #dsmom014#7 = 15;  aCas = "0208";  |FINSI;
     |SI #dsmom014#7 = 28;  aCas = "0227";  |FINSI;
     |SI #dsmom014#7 = 29;  aCas = "0214";  |FINSI;
     |SI #dsmom014#7 = 18;  aCas = "0215";  |FINSI;
     |SI #dsmom014#7 = 19;  aCas = "0216";  |FINSI;
     |SI #dsmom014#7 = 17;  aCas = "0217";  |FINSI;
     |SI #dsmom014#7 = 16;  aCas = "0219";  |FINSI;

     |SI aCas = "";  |ACABA;  |FINSI;

     |SELECT #2#rem00026;

     #rem00026#0 = #rem00025#0;
     #rem00026#1 = #rem00025#1;
     #rem00026#4 = aCas;
     |LEE 101#rem00026.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #rem00026#5 = #rem00026#5 + enImporte;

     |GRABA 020#rem00026.a;
     |LIBERA #rem00026;
|FPRC;

|PROCESO CierraDirectaPlan;
     #rem00025#0 = #reacceso#0;
     #rem00025#1 = enConAct;
     |LEE 101#rem00025.=;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     enLin    = #rem00025#1;
     eaModal  = #rem00025#11;
     ea32_1   = #rem00025#31;
     ea32_2_1 = #rem00025#32;
     |SUB_EJECUTA "rem00026;RECALCULA";

     #rem00025#25 = en0180;
     #rem00025#26 = en0218;
     #rem00025#27 = en0220 + en0223;
     #rem00025#28 = en0224;
     #rem00025#29 = en0225;
     #rem00025#30 = en0226;

     |GRABA 020#rem00025.a;
     |LIBERA #rem00025;
     |CIERRA #rem00025;

     eaPrograma   = "rem00025";
     eaPunto      = "  ";
     |HAZ ProgramaActivo;

     |SI #rem00025#13 = "S";
         |ABRE #rem00058;
         |SELECT #2#rem00058;
         #rem00058#0  = #rem00025#0;
         #rem00058#14 = "E1";
         #rem00058#15 = #rem00025#1;
         |LEE 040#rem00058.=;
         |SI FSalida ! 0;
             |SELECT #1#rem00058;
             #rem00058#0 = #rem00025#0;
             #rem00058#1 = 99;
             |LEE 040#rem00058.];
             |SI FSalida = 0;
                 |LEE 040#rem00058.a;
             |SINO;
                 |LEE 040#rem00058.u;
             |FINSI;
             nLinea = 1;

             |SI FSalida = 0;  |Y #rem00058#0 = #rem00025#0;
                 nLinea = #rem00058#1 + 1;
             |FINSI;
         |SINO;
             nLinea = #rem00058#1;
         |FINSI;

         |DDEFECTO #rem00058;
         |SELECT #1#rem00058;
         #rem00058#0  = #rem00025#0;
         #rem00058#1  = nLinea;
         |LEE 101#rem00058.=;
         |SI FSalida ! 0;
             |DDEFECTO #rem00058;
             #rem00058#0  = #rem00025#0;
             #rem00058#1  = nLinea;
             |GRABA 020#rem00058.b;
         |FINSI;

         #rem00058#2  = #rem00025#2;
         #rem00058#3  = "R";
         #rem00058#4  = #rem00025#4;
         #rem00058#5  = #rem00025#5;
         #rem00058#6  = #rem00025#6;
         #rem00058#7  = #rem00025#7;
         #rem00058#8  = #rem00025#8;
         #rem00058#9  = #rem00025#9;
         #rem00058#10 = #rem00025#10;
         #rem00058#11 = #rem00025#14;
         #rem00058#12 = #rem00025#15;
         #rem00058#14 = "E1";
         #rem00058#15 = #rem00025#1;

         |SI #rem00025#20 ! "8612";
             #rem00058#13 = 3;
             #rem00058#27 = #rem00025#28 % #rem00058#11;
             #rem00058#29 = #rem00025#29 % #rem00058#11;
             #rem00058#30 = #rem00058#27 - #rem00058#28 - #rem00058#29;
         |SINO;
             #rem00058#13 = 2;
             #rem00058#23 = #rem00025#28 % #rem00058#11;
             #rem00058#56 = #rem00025#29 % #rem00058#11;
             #rem00058#26 = #rem00058#23 - #rem00058#24 - #rem00058#25 - #rem00058#56;
         |FINSI;

         |GRABA 020#rem00058.a;
         |LIBERA #rem00058;
         |CIERRA #rem00058;

         eaPrograma   = "rem00058";
         eaPunto      = #rem00058#13;
         |HAZ ProgramaActivo;
     |FINSI;
|FPRC;
