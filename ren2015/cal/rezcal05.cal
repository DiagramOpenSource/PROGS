|FICHEROS;
      datfic0@;
      datfic1@;
      datfic2@;
      datfic3@;
      datfic4@;
      datfic5@;

     &refere1@;
     &refere2@;
     &refere3@;
|FIN;

|VARIABLES;
|FIN;

|INCLUYE i_varcal;

|PROCESO rem01035;
     |SI #datfic2@#3 = 1;
         nExcesoT = nExcesoT  + #datfic2@#7;
         nAportaT = nAportaT  + #datfic2@#6;
     |FINSI;

     |SI #datfic2@#3 = 2;
         nExcesoC = nExcesoC  + #datfic2@#7;
         nAportaC = nAportaC  + #datfic2@#6;
     |FINSI;
|FPRC;

|DEFBUCLE rem01035;
     #datfic2@#1004;
     ;
     #refere1@#0, #refere1@#1, #refere1@#2, 001;
     #refere1@#0, #refere1@#1, #refere1@#2, 999;
     ;
     NULL, rem01035;
|FIN;

|PROCESO rem01037;
     |SI enConta < 7;
         nExcesoT   = nExcesoT   + #datfic1@#5;
         nAportaT   = nAportaT   + #datfic1@#6;
         nSeguroT   = nSeguroT   + #datfic1@#12;
         enValorTit = enValorTit  + #datfic1@#7;
     |SINO;
         |SI #datfic1@#3 = 1;
             nExcesoT   = nExcesoT   + #datfic1@#5;
             nAportaT   = nAportaT   + #datfic1@#6;
             nSeguroT   = nSeguroT   + #datfic1@#12;
             enValorTit = enValorTit  + #datfic1@#7;
         |FINSI;

         |SI #datfic1@#3 = 2;
             nExcesoC   = nExcesoC  + #datfic1@#5;
             nAportaC   = nAportaC  + #datfic1@#6;
             nSeguroC   = nSeguroC  + #datfic1@#12;
             enValorCon = enValorCon + #datfic1@#7;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE rem01037;
     #datfic1@#1004;
     ;
     #refere1@#0, #refere1@#1, #refere1@#2, 001;
     #refere1@#0, #refere1@#1, #refere1@#2, 999;
     ;
     NULL, rem01037;
|FIN;

|PROCESO rem01045;
     |SI enConta < 7;
         nExcesoT = nExcesoT  + #datfic3@#6;
         nAportaT = nAportaT  + #datfic3@#9 + #datfic3@#10;
     |SINO;
         |SI #datfic3@#3 = 1;
             nExcesoT = nExcesoT  + #datfic3@#6;
             nAportaT = nAportaT  + #datfic3@#9 + #datfic3@#10;
         |FINSI;

         |SI #datfic3@#3 = 2;
             nExcesoC = nExcesoC + #datfic3@#6;
             nAportaC = nAportaC  + #datfic3@#9 + #datfic3@#10;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE rem01045;
     #datfic3@#1004;
     ;
     #refere1@#0, #refere1@#1, #refere1@#2, 001;
     #refere1@#0, #refere1@#1, #refere1@#2, 999;
     ;
     NULL, rem01045;
|FIN;

|PROCESO rem01047;
     |SI enConta < 7;
         nExcesoT = nExcesoT  + #datfic4@#5;
         nAportaT = nAportaT  + #datfic4@#6;
     |SINO;
         |SI #datfic4@#3 = 1;
             nExcesoT = nExcesoT  + #datfic4@#5;
             nAportaT = nAportaT  + #datfic4@#6;
         |FINSI;

         |SI #datfic3@#3 = 2;
             nExcesoC = nExcesoC  + #datfic4@#5;
             nAportaC = nAportaC  + #datfic4@#6;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE rem01047;
     #datfic4@#1004;
     ;
     #refere1@#0, #refere1@#1, #refere1@#2, 001;
     #refere1@#0, #refere1@#1, #refere1@#2, 999;
     ;
     NULL, rem01047;
|FIN;

|PROCESO CalculaJ;
     aDef    = eaPathDef + "rem01033.mas";
     |CARGA_DEF aDef, datfic0@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic0@#"zdat1033"#;  |FINSI;

     aDef    = eaPathDef + "rem01037.mas";
     |CARGA_DEF aDef, datfic1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |DESCARGA_DEF #datfic0@;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic1@#"zdat1037"#;  |FINSI;

     aDef    = eaPathDef + "rem01035.mas";
     |CARGA_DEF aDef, datfic2@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |DESCARGA_DEF #datfic1@;
         |DESCARGA_DEF #datfic0@;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic2@#"zdat1035"#;  |FINSI;

     aDef    = eaPathDef + "rem01045.mas";
     |CARGA_DEF aDef, datfic3@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;

         |DESCARGA_DEF #datfic2@;
         |DESCARGA_DEF #datfic1@;
         |DESCARGA_DEF #datfic0@;

         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic3@#"zdat1045"#;  |FINSI;

     aDef    = eaPathDef + "rem01047.mas";
     |CARGA_DEF aDef, datfic4@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |DESCARGA_DEF #datfic3@;
         |DESCARGA_DEF #datfic2@;
         |DESCARGA_DEF #datfic1@;
         |DESCARGA_DEF #datfic0@;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic4@#"zdat1047"#;  |FINSI;

     |ABRE #datfic0@;
     #datfic0@#0 = #refere1@#0;
     #datfic0@#1 = #refere1@#1;
     #datfic0@#2 = #refere1@#2;
     |LEE 101#datfic0@.=;
     |SI FSalida ! 0;
         |DDEFECTO #datfic0@;
         #datfic0@#0 = #refere1@#0;
         #datfic0@#1 = #refere1@#1;
         #datfic0@#2 = #refere1@#2;
         |GRABA 020#datfic0@.b;
     |FINSI;

     #datfic0@#66      = (N\ #datfic0@#44);
     #datfic0@#67      = 0;
     #datfic0@#68      = 0;
     #datfic0@#69      = 0;
     #datfic0@#70      = 0;
     #datfic0@#71      = 0;
     #datfic0@#72      = 0;
     #datfic0@#73      = 0;

     |SI #datfic0@#66 > 0;
         nResta = #datfic0@#66;

         |SI #datfic0@#51 ! 0;
             |SI #datfic0@#51 [ nResta;
                 #datfic0@#67  = #datfic0@#51;
                 nResta = nResta - #datfic0@#51;
             |SINO;
                 #datfic0@#67  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         |SI nResta ! 0;  |Y #datfic0@#52 ! 0;
             |SI #datfic0@#52 [ nResta;
                 #datfic0@#68  = #datfic0@#52;
                 nResta = nResta - #datfic0@#52;
             |SINO;
                 #datfic0@#68  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         |SI nResta ! 0;  |Y #datfic0@#55 ! 0;
             |SI #datfic0@#55 [ nResta;
                 #datfic0@#69  = #datfic0@#55;
                 nResta = nResta - #datfic0@#55;
             |SINO;
                 #datfic0@#69  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         |SI nResta ! 0;  |Y #datfic0@#56 ! 0;
             |SI #datfic0@#56 [ nResta;
                 #datfic0@#70  = #datfic0@#56;
                 nResta = nResta - #datfic0@#56;
             |SINO;
                 #datfic0@#70  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         |SI nResta ! 0;  |Y #datfic0@#59 ! 0;
             |SI #datfic0@#59 [ nResta;
                 #datfic0@#71  = #datfic0@#59;
                 nResta = nResta - #datfic0@#59;
             |SINO;
                 #datfic0@#71  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         |SI nResta ! 0;  |Y #datfic0@#62 ! 0;
             |SI #datfic0@#62 [ nResta;
                 #datfic0@#72  = #datfic0@#62;
                 nResta = nResta - #datfic0@#62;
             |SINO;
                 #datfic0@#72  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         |SI nResta ! 0;  |Y #datfic0@#63 ! 0;
             |SI #datfic0@#63 [ nResta;
                 #datfic0@#73  = #datfic0@#63;
                 nResta = nResta - #datfic0@#63;
             |SINO;
                 #datfic0@#73  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #datfic0@#44 < 0;
         #datfic0@#75 = #datfic0@#44;
     |SINO;
         #datfic0@#75 = (N\ #datfic0@#44 - #datfic0@#67 - #datfic0@#68 - #datfic0@#69 - #datfic0@#70 - #datfic0@#71 - #datfic0@#72 - #datfic0@#73);
         |SI #datfic0@#75 < 0;  #datfic0@#75 = 0;  |FINSI;
     |FINSI;

     |SI #datfic0@#75 > 0;
         |SI #datfic0@#76 > #datfic0@#75;
             #datfic0@#76  = #datfic0@#75;
         |FINSI;
     |SINO;
         #datfic0@#76 = 0;
     |FINSI;

     #datfic0@#77  = (N\ #datfic0@#75 - #datfic0@#76);

     #datfic0@#78  = (N\ #datfic0@#50);
     #datfic0@#79  = 0;
     #datfic0@#80  = 0;
     #datfic0@#81  = 0;

     |SI #datfic0@#78 > 0;
         nResta     = #datfic0@#78;
         nRemanente = #datfic0@#51 - #datfic0@#67;
         |SI nRemanente > 0;
             |SI nRemanente [ nResta;
                 #datfic0@#79  = nRemanente;
                 nResta = nResta - nRemanente;
             |SINO;
                 #datfic0@#79  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;

         nRemanente = #datfic0@#62 - #datfic0@#72;
         |SI nRemanente > 0;  |Y nResta > 0;
             |SI nRemanente [ nResta;
                 #datfic0@#80  = nRemanente;
                 nResta = nResta - nRemanente;
             |SINO;
                 #datfic0@#80  = nResta;
                 nResta = 0;
             |FINSI;
         |FINSI;
     |FINSI;

     #datfic0@#81 = (N\ #datfic0@#78 - #datfic0@#79 - #datfic0@#80);

     nAportaT   = 0;
     nAportaC   = 0;
     nSeguroT   = 0;
     nSeguroC   = 0;
     nExcesoT   = 0;
     nExcesoC   = 0;
     enValorTit = 0;
     enValorCon = 0;
     |BUCLE rem01037;

     |SI nExcesoT > enValorTit;  nExcesoT = enValorTit;  |FINSI;
     |SI nExcesoC > enValorCon;  nExcesoC = enValorCon;  |FINSI;

     nValor = #datfic0@#68;
     nResta = nValor - nExcesoT;
     |SI nResta ] 0;
         enValorTit = enValorTit - nExcesoT;
     |FINSI;

     |SI nResta > 0;
         |SI nResta > nExcesoC;
             nResta     = nResta    - nExcesoC;
             enValorCon = enValorCon - nExcesoC;
         |SINO;
             nResta = 0;
         |FINSI;
     |FINSI;

     |SI enValorTit < 0;  enValorTit = 0;  |FINSI;
     |SI enValorCon < 0;  enValorCon = 0;  |FINSI;

     |SI nResta > 0;
         nPorce   = (enValorTit / (enValorTit + enValorCon)) * 100;
         |SI nPorce = 100;  |O nPorce = 0;
             |SI nAportaT ] nResta;
                 nAportaT = nAportaT - nResta;
                 nResta   = 0;
             |SINO;
                 |SI nAportaT > 0;
                     nResta   = nResta - nAportaT;
                     nAportaT = 0;
                 |FINSI;
             |FINSI;

             |SI nResta > 0;
                 |SI nAportaC ] nResta;
                     nAportaC = nAportaC - nResta;
                     nResta   = 0;
                 |SINO;
                     |SI nAportaC > 0;
                         nResta   = nResta - nAportaC;
                         nAportaC = 0;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |SINO;
            |SI nAportaT ! 0;  |Y nAportaC ! 0;
                nResta1  = (nResta % nPorce) ! 2;
                nAportaT = nAportaT - nResta1;
                nAportaC = nAportaC - (nResta - nResta1);
                nResta   = nResta   - (nAportaT + nAportaC);
            |FINSI;
         |FINSI;
     |FINSI;

     |SI nResta > 0;
         nPorce   = (enValorTit / (enValorTit + enValorCon)) * 100;
         |SI nPorce = 100;  |O nPorce = 0;
             |SI nSeguroT ] nResta;
                 nSeguroT = nSeguroT - nResta;
                 nResta   = 0;
             |SINO;
                 |SI nSeguroT > 0;
                     nResta   = nResta - nSeguroT;
                     nSeguroT = 0;
                 |FINSI;
             |FINSI;

             |SI nResta > 0;
                 |SI nSeguroC ] nResta;
                     nSeguroC = nSeguroC - nResta;
                     nResta   = 0;
                 |SINO;
                     |SI nSeguroC > 0;
                         nResta   = nResta - nSeguroC;
                         nSeguroC = 0;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |SINO;
            |SI nSeguroT ! 0;  |Y nSeguroC ! 0;
                nResta1  = (nResta % nPorce) ! 2;
                nSeguroT = nSeguroT - nResta1;
                nSeguroC = nSeguroC - (nResta - nResta1);
                nResta   = nResta   - (nSeguroT + nSeguroC);
            |FINSI;
         |FINSI;
     |FINSI;

     nSumaT = nAportaT + nSeguroT;
     nSumaC = nAportaC + nSeguroC;

     |SI nSumaT > 0;  |Y nSumaC > 0;
         #datfic0@#82  = "TITULAR";
         #datfic0@#83  = nAportaT;
         #datfic0@#133 = nSeguroT;

         #datfic0@#84  = "CONYUGE";
         #datfic0@#85  = nAportaC;
         #datfic0@#134 = nSeguroC;
     |SINO;
         |SI nSumaT > 0;
             #datfic0@#82  = "TITULAR";
             #datfic0@#83  = nAportaT;
             #datfic0@#133 = nSeguroT;
         |FINSI;

         |SI nSumaC > 0;
             #datfic0@#82  = "CONYUGE";
             #datfic0@#83  = nAportaC;
             #datfic0@#133 = nSeguroC;
         |FINSI;
     |FINSI;

     nPdte = #datfic0@#56 - #datfic0@#70;
     |SI nPdte > 0;
         nAportaT = 0;
         nAportaC = 0;
         nExcesoT = 0;
         nExcesoC = 0;
         |BUCLE rem01045;

         |SI nPdte = 0;
             nAportaT = 0;
             nAportaC = 0;
         |SINO;
             nResta  = (nAportaT + nAportaC) - (#datfic0@#70 - nExcesoT - nExcesoC);
             |SI nResta [ 0;
                 nResta   = 0;
                 nAportaT = 0;
                 nAportaC = 0;
             |FINSI;

             nValor = nAportaT + nAportaC;
             |SI nResta > nValor;
                 nResta = nValor;
             |FINSI;

             |SI nResta > 0;
                 |SI nResta ] nAportaT;
                     nResta   = nResta - nAportaT;
                 |SINO;
                     nAportaT = nResta;
                     nResta   = 0;
                 |FINSI;
             |FINSI;

             |SI nResta > 0;
                 |SI nResta > nAportaC;
                     nResta   = nResta - nAportaC;
                 |SINO;
                     nAportaC = nResta;
                     nResta   = 0;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nAportaT ! 0;  |Y nAportaC ! 0;
             #datfic0@#86 = "TITULAR";
             #datfic0@#87 = nAportaT;

             #datfic0@#88 = "CONYUGE";
             #datfic0@#89 = nAportaC;
         |SINO;
             |SI nAportaT ! 0;
                 #datfic0@#86 = "TITULAR";
                 #datfic0@#87 = nAportaT;
             |FINSI;

             |SI nAportaC ! 0;
                 #datfic0@#86 = "CONYUGE";
                 #datfic0@#87 = nAportaC;
             |FINSI;
         |FINSI;
     |FINSI;

     nPdte = #datfic0@#59 - #datfic0@#71;
     |SI nPdte > 0;
         nAportaT = 0;
         nExcesoT = 0;
         nAportaC = 0;
         nExcesoC = 0;
         |BUCLE rem01035;

         nValor = #datfic0@#59 - #datfic0@#71;
         |SI nValor = 0;
             nAportaT = 0;
             nAportaC = 0;
         |SINO;
             nResta  = (nAportaT + nAportaC) - (#datfic0@#71 - nExcesoT - nExcesoC);
             |SI nResta [ 0;
                 nResta   = 0;
                 nAportaT = 0;
                 nAportaC = 0;
             |FINSI;

             nValor = nAportaT + nAportaC;
             |SI nResta > nValor;
                 nResta = nValor;
             |FINSI;

             |SI nResta [ 0;
                 nResta   = 0;
                 nAportaT = 0;
                 nAportaC = 0;
             |FINSI;

             |SI nResta > 0;
                 |SI nResta ] nAportaT;
                     nResta   = nResta - nAportaT;
                 |SINO;
                     nAportaT = nResta;
                     nResta   = 0;
                 |FINSI;
             |FINSI;

             |SI nResta > 0;
                 |SI nResta > nAportaC;
                     nResta   = nResta - nAportaC;
                 |SINO;
                     nAportaC = nResta;
                     nResta   = 0;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nAportaT ! 0;  |Y nAportaC ! 0;
             #datfic0@#90 = "TITULAR";
             #datfic0@#91 = nAportaT;

             #datfic0@#92 = "CONYUGE";
             #datfic0@#93 = nAportaC;
         |SINO;
             |SI nAportaT ! 0;
                 #datfic0@#90 = "TITULAR";
                 #datfic0@#91 = nAportaT;
             |FINSI;

             |SI nAportaC ! 0;
                 #datfic0@#90 = "CONYUGE";
                 #datfic0@#91 = nAportaC;
             |FINSI;
         |FINSI;
     |FINSI;

     nPdte = #datfic0@#63 - #datfic0@#73;
     |SI nPdte > 0;
         nAportaT = 0;
         nAportaC = 0;
         nExcesoT = 0;
         nExcesoC = 0;
         |BUCLE rem01047;

         nValor = #datfic0@#63 - #datfic0@#73;
         |SI nValor = 0;
             nAportaT = 0;
             nAportaC = 0;
         |SINO;
             nResta  = (nAportaT + nAportaC) - (#datfic0@#73 - nExcesoT - nExcesoC);
             |SI nResta [ 0;
                 nResta   = 0;
                 nAportaT = 0;
                 nAportaC = 0;
             |FINSI;

             nValor = nAportaT + nAportaC;
             |SI nResta > nValor;
                 nResta = nValor;
             |FINSI;

             |SI nResta [ 0;
                 nResta   = 0;
                 nAportaT = 0;
                 nAportaC = 0;
             |FINSI;

             |SI nResta > 0;
                 |SI nResta ] nAportaT;
                     nResta   = nResta - nAportaT;
                 |SINO;
                     nAportaT = nResta;
                     nResta   = 0;
                 |FINSI;
             |FINSI;

             |SI nResta > 0;
                 |SI nResta > nAportaC;
                     nResta   = nResta - nAportaC;
                 |SINO;
                     nAportaC = nResta;
                     nResta   = 0;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nAportaT ! 0;  |Y nAportaC ! 0;
             #datfic0@#94 = "TITULAR";
             #datfic0@#95 = nAportaT;

             #datfic0@#94 = "CONYUGE";
             #datfic0@#95 = nAportaC;
         |SINO;
             |SI nAportaT ! 0;
                 #datfic0@#94 = "TITULAR";
                 #datfic0@#95 = nAportaT;
             |FINSI;

             |SI nAportaC ! 0;
                 #datfic0@#96 = "CONYUGE";
                 #datfic0@#97 = nAportaC;
             |FINSI;
         |FINSI;
     |FINSI;

     |GRABA 020#datfic0@.a;
     |LIBERA #datfic0@;

     enSwAcum   = 0;
     enBloque   = 36;
     eaCasilla  = "380";  enImporte = #datfic0@#66;   |HAZ GrabaLineal;
     eaCasilla  = "428";  enImporte = #datfic0@#67;   |HAZ GrabaLineal;
     eaCasilla  = "429";  enImporte = #datfic0@#68;   |HAZ GrabaLineal;
     eaCasilla  = "430";  enImporte = #datfic0@#69;   |HAZ GrabaLineal;
     eaCasilla  = "431";  enImporte = #datfic0@#70;   |HAZ GrabaLineal;
     eaCasilla  = "432";  enImporte = #datfic0@#71;   |HAZ GrabaLineal;
     eaCasilla  = "433";  enImporte = #datfic0@#72;   |HAZ GrabaLineal;
     eaCasilla  = "434";  enImporte = #datfic0@#73;   |HAZ GrabaLineal;
     eaCasilla  = "435";  enImporte = #datfic0@#75;   |HAZ GrabaLineal;
     eaCasilla  = "436";  enImporte = #datfic0@#76;   |HAZ GrabaLineal;
     eaCasilla  = "440";  enImporte = #datfic0@#77;   |HAZ GrabaLineal;

     enBloque   = 37;
     eaCasilla  = "395";  enImporte = #datfic0@#78;   |HAZ GrabaLineal;
     eaCasilla  = "441";  enImporte = #datfic0@#79;   |HAZ GrabaLineal;
     eaCasilla  = "442";  enImporte = #datfic0@#80;   |HAZ GrabaLineal;
     eaCasilla  = "445";  enImporte = #datfic0@#81;   |HAZ GrabaLineal;

     |DESCARGA_DEF #datfic4@;
     |DESCARGA_DEF #datfic3@;
     |DESCARGA_DEF #datfic2@;
     |DESCARGA_DEF #datfic1@;
     |DESCARGA_DEF #datfic0@;
|FPRC;
