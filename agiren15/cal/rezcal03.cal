|FICHEROS;
      datfic0@;
      datfic1@;
      datfic2@;
      datfic3@;
      datfic4@;
      datfic5@;

     &refere1@;
     &refere2@;
     &refere3@;
|FIN;

|VARIABLES;
|FIN;

|INCLUYE i_varcal;

|PROCESO CalcuH1;
     enBloque = 02; eaCasilla = "037"; |HAZ SacaImporte; nValor1 = enImporte;

     #datfic0@#148  = 0;
     #datfic0@#149  = 0;

     nSuma  = (N\ nValor1 + #datfic1@#4 + #datfic1@#5);
     |SI nSuma ] 0;
         #datfic0@#148  = nSuma;
     |SINO;
         #datfic0@#149  = -nSuma;
     |FINSI;
|FPRC;

|PROCESO CalcuH4_1;
     enBloque = 25; eaCasilla = "370"; |HAZ SacaImporte; #datfic0@#46 = enImporte;

     |SI #datfic0@#46 [ 0;
         #datfic0@#160 = (N\ #datfic0@#160 + #datfic0@#156);

         #datfic0@#47  = 0;
         #datfic0@#150 = 0;
         #datfic0@#156 = 0;
         #datfic0@#157 = 0;

         |ACABA;
     |FINSI;

     #datfic0@#150 = (N\ #datfic0@#149);
     nLimite = #datfic0@#46 % 10;
     |SI #datfic0@#150 > nLimite;
          #datfic0@#150 = (N\ nLimite);
     |FINSI;

     nResta = #datfic0@#46 - #datfic0@#150 - #datfic0@#47;
     |SI nResta < 0;
         #datfic0@#47  = (N\ #datfic0@#46 - #datfic0@#150);
         #datfic0@#160 = (N\ #datfic0@#160 + #datfic0@#156);
         #datfic0@#156 = 0;

         |ACABA;
     |FINSI;

     nResta = #datfic0@#46 - #datfic0@#150 - #datfic0@#47 - #datfic0@#156;
     |SI nResta < 0;
         #datfic0@#160 = (N\ #datfic0@#160 + -nResta);
         #datfic0@#156 = (N\ #datfic0@#46 - #datfic0@#150 - #datfic0@#47);

         |ACABA;
     |FINSI;

     nSaldoH4 = nResta;
|FPRC;

|PROCESO Compensa5_1;
     |SI nSaldoH4 > 0;
         |SI nSaldoH4 > nImporte1;
             #datfic0@#157   = (N\ #datfic0@#157 + nImporte1);
             nSaldoH4 = nSaldoH4 - nImporte1;
             nImporte1   = 0;
         |SINO;
             #datfic0@#157   = (N\ #datfic0@#157 + nSaldoH4);
             nImporte1   = nImporte1 - nSaldoH4;
             nSaldoH4 = 0;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CalcuH5_1;
     #datfic0@#49 = #datfic0@#148;

     |SI #datfic0@#49 < 0;
         nImporte1 = #datfic0@#159;
         nImporte2 = #datfic0@#160;
         |HAZ Compensa5_1;

         #datfic0@#111 = 0;
         #datfic0@#151 = 0;
         #datfic0@#159 = 0;
         #datfic0@#160 = 0;

         |ACABA;
     |FINSI;

     #datfic0@#151 = (N\ #datfic0@#38);
     nLimite = #datfic0@#49 % 10;
     |SI #datfic0@#151 > nLimite;
          #datfic0@#151 = (N\ nLimite);
     |FINSI;

     nResta = #datfic0@#49 - #datfic0@#151 - #datfic0@#111;
     |SI nResta < 0;
         nImporte1 = #datfic0@#159;
         nImporte2 = #datfic0@#160;
         |HAZ Compensa5_1;

         #datfic0@#111 = (N\ #datfic0@#49 - #datfic0@#151);
         #datfic0@#159 = 0;
         #datfic0@#160 = 0;

         |ACABA;
     |FINSI;

     nResta = #datfic0@#49 - #datfic0@#151 - #datfic0@#111 - #datfic0@#159;
     |SI nResta < 0;
         nImporte1 = -nResta;
         nImporte2 = #datfic0@#160;
         |HAZ Compensa5_1;

         #datfic0@#159 = (N\ #datfic0@#49 - #datfic0@#151 - #datfic0@#111);
         #datfic0@#160 = 0;

         |ACABA;
     |FINSI;

     nResta = #datfic0@#49 - #datfic0@#151 - #datfic0@#111 - #datfic0@#159 - #datfic0@#160;
     |SI nResta < 0;
         nImporte1 = 0;
         nImporte2 = -nResta;
         |HAZ Compensa5_1;

         #datfic0@#160 = (N\ #datfic0@#49 - #datfic0@#151 - #datfic0@#111 - #datfic0@#159);
     |FINSI;
|FPRC;

|PROCESO CalcuH2;
     enBloque = 24; eaCasilla = "366"; |HAZ SacaImporte; #datfic0@#39 = enImporte;

     |SI #datfic0@#39 [ 0;
         #datfic0@#40  = 0;

         |ACABA;
     |FINSI;

     nResta = #datfic0@#39 - #datfic0@#40;
     |SI nResta < 0;
         #datfic0@#40 = (N\ #datfic0@#39);
     |FINSI;
|FPRC;

|PROCESO CalcuH3;
     enBloque = 24; eaCasilla = "367"; |HAZ SacaImporte; #datfic0@#155 = enImporte;

     nResta  = #datfic0@#40 - #datfic0@#42 - #datfic0@#155;
     |SI nResta = 0;
         #datfic0@#42  = 0;
         #datfic0@#155 = 0;
     |FINSI;

     |SI nResta < 0;
         nResta = -nResta;
         |SI #datfic0@#155 > nResta;
             #datfic0@#155  = nResta;
             #datfic0@#42   = 0;
             nResta = 0;
         |SINO;
             #datfic0@#42 = nResta - #datfic0@#155;
         |FINSI;
     |FINSI;

     #datfic0@#41 = 0;
     enBloque = 1;  eaCasilla = "022"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);
     enBloque = 3;  eaCasilla = "047"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);
     enBloque = 4;  eaCasilla = "070"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);
     enBloque = 4;  eaCasilla = "071"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);
     enBloque = 5;  eaCasilla = "125"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);
     enBloque = 6;  eaCasilla = "150"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);
     enBloque = 7;  eaCasilla = "180"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);
     enBloque = 8;  eaCasilla = "212"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);
     enBloque = 8;  eaCasilla = "215"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);
     enBloque = 8;  eaCasilla = "216"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);
     enBloque = 9;  eaCasilla = "235"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);
     enBloque = 10; eaCasilla = "240"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);
     enBloque = 11; eaCasilla = "244"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);
     enBloque = 12; eaCasilla = "250"; |HAZ SacaImporte; #datfic0@#41 = (N\ #datfic0@#41 + enImporte);

     |SI #datfic0@#41 [ 0;
         #datfic0@#155 = 0;
         #datfic0@#42  = 0;

         |ACABA;
     |FINSI;

     nValor1 = #datfic0@#41 % 25;
     nValor2 = #datfic0@#41 % 25;

     |SI #datfic0@#155 > nValor2;
         #datfic0@#155 = nValor2;
     |FINSI;

     nValor2 = nValor2 - #datfic0@#155;
     |SI nValor2 < 0;  nValor2 = 0;  |FINSI;

     |SI #datfic0@#42 > nValor1;
         #datfic0@#42 = nValor1;
     |FINSI;

     |SI #datfic0@#42 > nValor2;
         #datfic0@#42 = nValor2;
     |FINSI;
|FPRC;

|PROCESO CalculaH;
     aDef    = eaPathDef + "rem01033.mas";
     |CARGA_DEF aDef, datfic0@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic0@#"zdat1033"#;  |FINSI;

     aDef    = eaPathDef + "rem01026.mas";
     |CARGA_DEF aDef, datfic1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic1@#"zdat1026"#;  |FINSI;

     |ABRE #datfic1@;
     #datfic1@#0 = #refere1@#0;
     #datfic1@#1 = #refere1@#1;
     #datfic1@#2 = #refere1@#2;
     |LEE 000#datfic1@.=;
     |SI FSalida ! 0;  |DDEFECTO #datfic1@;  |FINSI;
     |CIERRA #datfic1@;

     |ABRE #datfic0@;
     #datfic0@#0 = #refere1@#0;
     #datfic0@#1 = #refere1@#1;
     #datfic0@#2 = #refere1@#2;
     |LEE 101#datfic0@.=;
     |SI FSalida ! 0;
         |DDEFECTO #datfic0@;
         #datfic0@#0 = #refere1@#0;
         #datfic0@#1 = #refere1@#1;
         #datfic0@#2 = #refere1@#2;
         |GRABA 020#datfic0@.b;
     |FINSI;

     nSaldoH4 = 0;
     |HAZ CalcuH1;
     |HAZ CalcuH4_1;
     |HAZ CalcuH5_1;
     |HAZ CalcuH2;
     |HAZ CalcuH3;

     #datfic0@#44  = (N\ #datfic0@#39 - #datfic0@#40  + #datfic0@#41);
     #datfic0@#44  = (N\ #datfic0@#44 - #datfic0@#42  - #datfic0@#155);

     #datfic0@#50  = (N\ #datfic0@#46 - #datfic0@#150 - #datfic0@#47);
     #datfic0@#50  = (N\ #datfic0@#50 - #datfic0@#156 - #datfic0@#157);
     #datfic0@#50  = (N\ #datfic0@#50 + #datfic0@#49  - #datfic0@#151);
     #datfic0@#50  = (N\ #datfic0@#50 - #datfic0@#111 - #datfic0@#159);
     #datfic0@#50  = (N\ #datfic0@#50 - #datfic0@#160);

     #datfic0@#45  = (N\ #datfic0@#34  - #datfic0@#155);
     #datfic0@#162 = (N\ #datfic0@#38  - #datfic0@#151);
     #datfic0@#163 = (N\ #datfic0@#149 - #datfic0@#150);

     enSwAcum  = 0;

     enBloque  = 26;
     eaCasilla = "372";  enImporte = #datfic0@#148; |HAZ GrabaLineal;
     eaCasilla = "373";  enImporte = #datfic0@#149; |HAZ GrabaLineal;

     enBloque  = 27;
     eaCasilla = "366";  enImporte = #datfic0@#39;  |HAZ GrabaLineal;
     eaCasilla = "376";  enImporte = #datfic0@#40;  |HAZ GrabaLineal;
     eaCasilla = "377";  enImporte = #datfic0@#41;  |HAZ GrabaLineal;
     eaCasilla = "379";  enImporte = #datfic0@#155; |HAZ GrabaLineal;
     eaCasilla = "378";  enImporte = #datfic0@#42;  |HAZ GrabaLineal;
     eaCasilla = "380";  enImporte = #datfic0@#44;  |HAZ GrabaLineal;

     enBloque  = 28;
     eaCasilla = "370";  enImporte = #datfic0@#46;  |HAZ GrabaLineal;
     eaCasilla = "382";  enImporte = #datfic0@#150; |HAZ GrabaLineal;
     eaCasilla = "383";  enImporte = #datfic0@#47;  |HAZ GrabaLineal;
     eaCasilla = "384";  enImporte = #datfic0@#156; |HAZ GrabaLineal;
     eaCasilla = "385";  enImporte = #datfic0@#157; |HAZ GrabaLineal;
     eaCasilla = "372";  enImporte = #datfic0@#49;  |HAZ GrabaLineal;
     eaCasilla = "387";  enImporte = #datfic0@#151; |HAZ GrabaLineal;
     eaCasilla = "388";  enImporte = #datfic0@#111; |HAZ GrabaLineal;
     eaCasilla = "389";  enImporte = #datfic0@#159; |HAZ GrabaLineal;
     eaCasilla = "390";  enImporte = #datfic0@#160; |HAZ GrabaLineal;
     eaCasilla = "395";  enImporte = #datfic0@#50;  |HAZ GrabaLineal;

     enBloque  = 29;
     eaCasilla = "396";  enImporte = #datfic0@#45;  |HAZ GrabaLineal;
     eaCasilla = "397";  enImporte = #datfic0@#162; |HAZ GrabaLineal;
     eaCasilla = "398";  enImporte = #datfic0@#163; |HAZ GrabaLineal;

     |GRABA 020#datfic0@.a;
     |LIBERA #datfic0@;
     |CIERRA #datfic0@;

     |DESCARGA_DEF #datfic1@;
     |DESCARGA_DEF #datfic0@;
|FPRC;
