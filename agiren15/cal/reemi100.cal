|FICHEROS;
     reemi100;

     zregubic;
     rem00100;
     rem01001;
     reacceso;

     reemipat,MANTE;

     rew00001;
     rew02000;
     rew02001;
|FIN

|VARIABLES;
      nEntro          = 0;
      nCont           = 0;
      nCalc           = 0;
      nCalc1          = 0;
      nCalc2          = 0;
      nHandle         = 0;
      nHandle1        = 0;
      nHandle2        = 0;
      nHandleErr      = 0;
      SwEstar         = 0;
      DEmpre          = 0;
      HEmpre          = 0;
      XCampos         = 0;
      nRegsPorEmitir  = 0;
      nRango          = 0;
      nPos            = 0;
      nPos1           = 0;
      nPos2           = 0;
      FEstado         = 0;
      nCopia          = 0;
      nCanal          = 0;
      nSwCopia        = 0;
      nSwPresenta     = 0;
      nLongitud       = 0;
      nValida         = 0;
      nSwError        = 0;
      nVent           = 0;
      nVentTrab       = 0;
      nVentErr        = 0;
      nPant           = 0;
      nBtnCont        = 0;
      nBtnSal         = 0;
      nBtnErr         = 0;
      nBtnPst         = 0;
      nBtnSalirErr    = 0;
      nBtnUnidad      = 0;
      nBtnOk          = 0;
      nBtnCancel      = 0;
      nBtnExplor      = 0;
      nBtnReader      = 0;
      nBtnImpre       = 0;
      nBtnValida      = 0;
      nBtnBorrador    = 0;
      nBtnSalir       = 0;
      nBtnPrevis      = 0;
      nGrid1          = 0;
      nGrid2          = 0;
      nGrid3          = 0;
      nHandleEjec     = 0;
      nCaracter       = 0;
      nSwErrores      = 0;
      nBtn            = 0;
      nConErrores     = 0;

      aSwError        = "";
      aLongitud       = "";
      aCaracter       = "";
      aMarca          = "";
      aParte1         = "";
      aParte2         = "";
      eaJusti         = "";
      aAlfa           = "";
      aAlfa1          = "";
      aAlfa2          = "";
      aAlfa3          = "";
      aAlfa4          = "";
      aAbre           = "";
      aParam          = "";
      aTipo           = "";
      aIdioma         = "";
      aDirBase        = "";
      aDirInternet    = "";
      aTecla          = "";
      aRetu           = "";
      aEsc1           = "";
      aEsc2           = "";
      aIPRemoto       = "";
      aImpre          = "";
      DReimp          = "";
      HReimp          = "";
      Comodin         = "";
      aNombre         = "";
      aDirOrigen      = "";
      aDirectorio     = "";
      aPathRenta      = "";
      aPathLocal      = "";
      aVersionBasico  = "";
      aVersionJava    = "";
      aEjecutaJava    = "";
      aUnidadSistema  = "";
      aProgFiles      = "";
      aPathPdf        = "";
      aDocRemoto      = "";
      aDocServidor    = "";
      aPathExplorador = "";
      aForzExplorador = "";
      aPathServidor   = "";
      aForzAcrobat    = "";
      areemision      = "";
      aQueBoton       = "";
      aEnlace         = "";
      aID             = "";
      aTipoEmi        = "";
      aHID            = "";
      aEJF            = "";
      aMOD            = "";
      aIDI            = "";
      aPRG            = "";
      aAbre1          = "";
      aAbre2          = "";
      aTipoWeb        = "";

    {5}aPopup       = "";
    {1}version      = "";
    {1}aContiene    = "";

   {-1}aVent        = "";
       aVent1       = 0;
       aVent2       = 0;
       aVent3       = 0;
       aVent4       = 0;
       aVent5       = "";

      &eaModelo       = "";
      &enEmpresa      = 0;
      &eaTipo         = "";
      &eaNif          = "";
      &efFechaPatrim  = @;
      &eaFOrigen      = "";
      &eaFDestino     = "";
      &eaPathLanza    = "";
      &eaDirJava      = "";
      &eaUnidadBasico = "";
      &eaPathAcrobat  = "";
      &eaModoImpre    = "";
      &eaTipoR        = "";
      &eaTipoE        = "";
      &eaTipoP        = "";
      &enBasico       = 0;
      &enError        = 0;
      &enHandle       = 0;
      &enSwFalle      = 0;
      &eaDSMAC        = "";
      &eaOrigen       = "";
      &eaDestino      = "";
      &eaRojo         = "";
      &eaVerde        = "";
      &eaTipoBor      = "";

      &eaFichero      = "";
      &eaFicheroTxt   = "";
      &eaFicheroSin   = "";
      &eaFicheroPtl   = "";
      &eaDirServidor  = "";
      &eaDirLanza     = "";
|FIN;

|PROCESO PonVntn;
     aAlfa = ("00000" + #rew00001#0) % -105;
     aAlfa = aAlfa + " / " + #rew00001#2;  |QBF aAlfa;
     aAlfa = aAlfa + " / " + #rew00001#3;  |QBF aAlfa;
     |VENTANA 0501, 0560, -1, 16, aAlfa;
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;
|FPRC;

|PROCESO QuitaVntn;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentTrab;
|FPRC;

|PROCESO LimpiaCarpeta;
     aAlfa = eaDirLanza + "*.*";
     |R_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
             |RFBORRA aAlfa;

             |R_SDIR aAlfa;
     |SIGUE;
|FPRC;

|PROCESO GrabaHtmlEspera;
     aAbre = eaDirServidor + eaFicheroPtl;
     |XABRE "WB", aAbre, nHandle;

     aAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     aAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "<html>";
     |HAZ GrabaPortal;

     aAlfa = "<head>";
     |HAZ GrabaPortal;

     aAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     aAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "</head>";
     |HAZ GrabaPortal;

     aAlfa = "";
     |HAZ GrabaPortal;

     aAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "     function carga()";
     |HAZ GrabaPortal;

     aAlfa = "     {";
     |HAZ GrabaPortal;

     aAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     aAlfa = "     }";
     |HAZ GrabaPortal;

     aAlfa = "</script>";
     |HAZ GrabaPortal;

     aAlfa = "";
     |HAZ GrabaPortal;

     aAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + aEnlace + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + aHID + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + aIdioma + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "LEV" + &34 + " value=" + &34 + "000000000000" + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIC" + &34 + " value=" + &34;
     |HAZ GrabaPortalSin;
     |XCIERRA nHandle;

     eaDestino   = eaDirServidor + eaFicheroPtl;
     eaOrigen    = eaDirServidor + eaFicheroTxt;

     |AFEGIR_FICHERO eaOrigen, eaDestino;

     aAbre = eaDirServidor + eaFicheroPtl;
     |XABRE "AB", aAbre, nHandle;

     aAlfa = &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "RUT" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + aPRG + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + aEJF + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + aMOD + &34 + " />";
     |HAZ GrabaPortal;

     |SI aTipoEmi = "B";
         aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "SINVL" + &34 + " value=" + &34 + &34 + " />";
         |HAZ GrabaPortal;
     |FINSI;

     aAlfa = "</form>";   |HAZ GrabaPortal;
     aAlfa = "</body>";   |HAZ GrabaPortal;
     aAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA nHandle;

     eaOrigen  = eaDirServidor + eaFicheroPtl;
     eaDestino = eaDirLanza + eaFicheroPtl;
     |HAZ CopiaFichero;
|FPRC;

|PROCESO VerErrores;
     aForzExplorador = "N";
     aPathExplorador = "";
     |HAZ Explorador; |QBF aPathExplorador;
     |SI aPathExplorador = "";
         aForzExplorador = "S"; aPathExplorador = "";
         |HAZ Explorador;
     |FINSI;

     aAlfa1 = #rew02001#4;  |QBF aAlfa1;
     aAlfa  = aPathExplorador + " " + aAlfa1;
     aAlfa  = aAlfa - "/";
     |PARA; |SI FSalida ! 0; |HACIENDO;
            nCalc = ((FSalida / 100) ! 0) + 99; aAlfa1 = aAlfa % nCalc;
            nCalc = FSalida + 98;               aAlfa2 = aAlfa % nCalc;
            aAlfa = aAlfa1 + "\" + aAlfa2;
            aAlfa = aAlfa - "/";
     |SIGUE;

     aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |RSYSTEM aAlfa;

     |FOCOTECLADO nGrid3;
|FPRC;

|PROCESO PresentaWeb;
     aAlfa1 =  #rew02001#4;  |QBF aAlfa1;

     |SI eaModelo = "100";
         aAlfa  = "https://www" + aTipoWeb+ ".agenciatributaria.gob.es/wlpl/PARE-RW15/EXTE/index.zul?EDFI";

||         aAlfa  = "https://www" + aTipoWeb + ".agenciatributaria.gob.es/static_files/";
||         aAlfa  = aAlfa + "common/internet/dep/aplicaciones/ov/servurlr.html";
||         aAlfa  = aAlfa + "?WEB=INTERNET&PRG=" + eaModelo + "&EJE=2015&URL=PIR&EXT=?FIC=";
||         aAlfa  = aAlfa + aAlfa1;
     |FINSI;

     |SI eaModelo = "714";
         aAlfa  = "https://www" + aTipoWeb + ".agenciatributaria.gob.es/static_files/";
         aAlfa  = aAlfa + "common/internet/dep/aplicaciones/ov/ie57140f.html";
||         aAlfa  = aAlfa + "?WEB=INTERNET&PRG=" + eaModelo + "&EJE=2015&URL=PIR&EXT=?FIC=";
||         aAlfa  = aAlfa + aAlfa1;
     |FINSI;

     aEnlace = aAlfa;

     aAbre = eaDirLanza + "Presenta.html";
     |XABRE "WBC", aAbre, nHandle;

     aAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     aAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "<html>";
     |HAZ GrabaPortal;

     aAlfa = "<head>";
     |HAZ GrabaPortal;

     aAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     aAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "</head>";
     |HAZ GrabaPortal;

     aAlfa = "";
     |HAZ GrabaPortal;

     aAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "     function carga()";
     |HAZ GrabaPortal;

     aAlfa = "     {";
     |HAZ GrabaPortal;

     aAlfa = "          document.location = ";
     |HAZ GrabaPortalSin;

     aAlfa = &34 + aEnlace + &34 + ";";
     |HAZ GrabaPortal;

     aAlfa = "     }";
     |HAZ GrabaPortal;

     aAlfa = "</script>";
     |HAZ GrabaPortal;

     aAlfa = "";
     |HAZ GrabaPortal;

     aAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "";  |HAZ GrabaPortal;
     aAlfa = "";  |HAZ GrabaPortal;

     aAlfa = "</form>";   |HAZ GrabaPortal;
     aAlfa = "</body>";   |HAZ GrabaPortal;
     aAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA nHandle;

     aForzExplorador = "N";
     aPathExplorador = "";
     |HAZ Explorador; |QBF aPathExplorador;
     |SI aPathExplorador = "";
         aForzExplorador = "S"; aPathExplorador = "";
         |HAZ Explorador;
     |FINSI;

     |SI aPathExplorador ! "";
         aAlfa = aPathExplorador + " " + aAbre;
         aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
        aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAbre + &34;
     |FINSI;

     |RSYSTEM aAlfa;

     |PULSATECLA;

     |FOCOTECLADO nGrid3;
|FPRC;

|PROCESO PresentaDoc;
     nConErrores = 0;
     aAlfa = #rew02001#3;  |QBF aAlfa;
     |SI aAlfa ! "Validado";
         |CONFI "0000NEl fichero contiene errores, quiere presentarlo de todas forma";
         |SI FSalida ! 0;
             |FOCOTECLADO nGrid3;
             |ACABA;
         |FINSI;
         nConErrores = 1;
     |FINSI;

     aPopup1  = nBtnPst;
     aPopup2  = 3;
     aPopup3  = "1.- Con certificado";
     aPopup4  = "2.- Con referencia";
     aPopup5  = "3.- Salir";

     |PARA;  |SI;  |HACIENDO;
          IaPopup  = aPopup1  <-;
          |ESPECIFICA "TRACKPOPUP", aPopup;
          |SI FSalida ! 0;
              IaPopup  = aPopup3  <-;
              IaPopup  = IaPopup + (FSalida - 1);

              aAlfa = aPopup % 101;

              |SI aAlfa = "1";  aTipoWeb = "1"; |HAZ PresentaWeb;  |SAL;  |FINSI;
              |SI aAlfa = "2";  aTipoWeb = "9"; |HAZ PresentaWeb;  |SAL;  |FINSI;
              |SI aAlfa = "3";  |SAL;                                     |FINSI;

              |PULSATECLA;
          |FINSI;
     |SIGUE;

     |SI nConErrores = 1;  |Y aAlfa ! "3";
         |DDEFECTO #rew02001;
         #rew02001#0 = #rew00001#0;
         #rew02001#2 = #rew00001#2;
         |LEE 101#rew02001.=;
         |SI FSalida = 0;
             #rew02001#1 = #rew00001#3;
             #rew02001#3 = "Forzado";
             #rew02001#4 = eaDestino;
             #rew02001#5 = eaDirLanza + eaFicheroPtl;
             #rew02001#6 = eaVerde;
             |GRABA 020#rew02001.a;
             |LIBERA #rew02001;

             nSwError = 0;
             |HAZ GrabaImpreso;

             |REFRESCACONTROL nGrid3;
         |FINSI;
     |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO Quita714;
     aPRG = "PTLINK0U";

     aAbre1 = #rew02001#5;  |QBF aAbre1;
     aAbre2 = eaDirLanza + "Borrador.html";

     |PARA;  |SI;  |HACIENDO;
           |XLEE nHandle1,  250, aAlfa1;
           |SI FSalida [ 0;  |SAL;  |FINSI;

           aAlfa2 = aAlfa1;
           aAlfa  = aAlfa1 - aPRG;
           |SI FSalida ! 0;
               aAlfa2 = aAlfa;
           |FINSI;

           |XGRABA nHandle2, aAlfa2;
     |SIGUE;

     |XCIERRA nHandle1;
     |XCIERRA nHandle2;
|FPRC;

|PROCESO QuitaPRG;
     |HAZ Quita714;
|FPRC;

|PROCESO PresBorrador;
     aAlfa = #rew02001#3;  |QBF aAlfa;
     |SI aAlfa = "Validado";
         aAlfa1 = #rew02001#5 < "";  |QBF aAlfa1;
         aAlfa1 = aAlfa1 - ".html" + "Borrador.pdf";
         |XABRE "EC", aAlfa1, 0;
         |SI FSalida ] 0;
             aForzAcrobat = "N";
             |HAZ TomaReader;

             |SI eaPathAcrobat ! "";
                 aAlfa = eaPathAcrobat + " " + aAlfa1;  |QBF aAlfa;
             |SINO;
                 aAlfa = aAlfa1;  |QBF aAlfa;
             |FINSI;

             aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
         |SINO;
             |SI aPathExplorador ! "";
                 aAlfa = aPathExplorador + " " + #rew02001#5;  |QBF aAlfa;
             |SINO;
                 aAlfa = #rew02001#5;  |QBF aAlfa;
             |FINSI;

             aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
         |FINSI;
     |SINO;
         |SI eaModelo = "100";
             |HAZ Borrador100;

             |FOCOTECLADO nGrid3;

             |ACABA;
         |FINSI;

         |HAZ QuitaPRG;

         |SI aPathExplorador ! "";
             aAlfa = aPathExplorador + " " + aAbre2;
         |SINO;
             aAlfa = aAbre2;
         |FINSI;

         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |FINSI;

     |RSYSTEM aAlfa;
     |PULSATECLA;

     |FOCOTECLADO nGrid3;
|FPRC;

|PROCESO EvtoGrid3;
     |SI FSalida = 1; |O FSalida = 2;
         |LEE 000#rew02001.=;

         aAlfa = #rew02001#3;  |QBF aAlfa;
         |SI aAlfa = "Validado";
             |ESTADO_CONTROL nBtnPst, "ENABLE";
         |SINO;
             |ESTADO_CONTROL nBtnErr, "ENABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
         aAlfa = #rew02001#3;  |QBF aAlfa;
         |SI aAlfa = "Validado";
             |HAZ PresentaDoc;
         |SINO;
             |HAZ VerErrores
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PantaResultados;
     |LEE 000#rew02001.p;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |VENTANA 0501, 3499, -1, 16, "Resultado de la emisi¢n";
     nVentErr = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentErr;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Ver errores", 3280, 3298, VerErrores;
     nBtnErr = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Presentar declaraci¢n", 3260, 3278, PresentaDoc;
     nBtnPst = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Borrador", 3246, 3256, PresBorrador;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}Doble click en el registro para presentar o ver errores", 0502, 0598, NULL;

     |ESTADO_CONTROL nBtnErr, "DISABLE";
     ||ESTADO_CONTROL nBtnPst, "DISABLE";

     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#rew02001, nRango, 0602, 3198, NULL, NULL, EvtoGrid3;
     nGrid3 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
        FSalida = "::{{001}}Salir," + nGrid3;

        |LEETECLA aTecla;
        |SI aTecla = aEsc1; |SAL; |FINSI;
        |SI aTecla = aEsc2; |SAL; |FINSI;
        |SI aTecla = aRetu; |SAL; |FINSI;
     |SIGUE;

     |DESTRUYECONTROL nGrid3;

     |FIN_CONTROL_WINDOWS nBtnErr;
     |FIN_CONTROL_WINDOWS nBtnPst;

     aVent4 = nVentErr;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentErr;
|FPRC;

|PROCESO GrabaImpreso;
     |ABRE #rem01001;
     #rem01001#0 = #rew00001#0;
     #rem01001#1 = 0;
     aAlfa       = #rew00001#2 % 110;
     #rem01001#2 = aAlfa;
     |LEE 101#rem01001.=;
     |SI FSalida = 0;
         #rem01001#6 = "N";

         |SI nSwError = 0;
             #rem01001#6 = "S";
         |FINSI;

         |GRABA 020#rem01001.a;
         |LIBERA #rem01001;
     |FINSI;
     |CIERRA #rem01001;

     |ABRE #reacceso;
     #reacceso#0 = #rew00001#0;
     |LEE 101#reacceso.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI eaModelo = "100";
         |SI #reacceso#14 = "INACTIVO  ";
             #reacceso#14 = "NO IMPRESO";
         |FINSI;

         |SI #rem01001#6 = "S";  |Y #reacceso#14 = "NO IMPRESO";
              #reacceso#14 = "IMPRESO";
         |FINSI;

         |SI #rem01001#6 = "N";  |Y #reacceso#14 = "IMPRESO   ";
             #reacceso#14 = "PARCIAL";
         |FINSI;

                                           #reacceso#20 = "";
         |SI #reacceso#12 = "*";           #reacceso#20 = "18,28,245;255,255,255";      |FINSI;
         |SI #reacceso#14 = "IMPRESO   ";  #reacceso#20 = "0,185,0;255,255,255";        |FINSI;
         |SI #reacceso#19 = "S";           #reacceso#20 = "215,120,210;255,255,255";    |FINSI;

         #reacceso#17 = #reemi100#33;
     |FINSI;

     |SI eaModelo = "714";
         |SI #reacceso#15 = "INACTIVO  ";
             #reacceso#15 = "NO IMPRESO";
         |FINSI;

         |SI #rem01001#6 = "S";  |Y #reacceso#15 = "NO IMPRESO";
             #reacceso#15 = "IMPRESO";
         |FINSI;

         |SI #rem01001#6 = "N";  |Y #reacceso#15 = "IMPRESO   ";
             #reacceso#15 = "PARCIAL";
         |FINSI;

                                           #reacceso#20 = "";
         |SI #reacceso#12 = "*";           #reacceso#20 = "18,28,245;255,255,255";      |FINSI;
         |SI #reacceso#15 = "IMPRESO   ";  #reacceso#20 = "0,185,0;255,255,255";        |FINSI;
         |SI #reacceso#19 = "S";           #reacceso#20 = "215,120,210;255,255,255";    |FINSI;
         #reacceso#18 = #reemi100#33;
     |FINSI;

     |GRABA 020#reacceso.a;
     |LIBERA #reacceso;
     |CIERRA #reacceso;
|FPRC;

|PROCESO GrabaPortal;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO GrabaPortalSin;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO GrabaHtml;
     aAbre = eaDirServidor + eaFicheroPtl;
     |XABRE "WB", aAbre, nHandle;

     aAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     aAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "<html>";
     |HAZ GrabaPortal;

     aAlfa = "<head>";
     |HAZ GrabaPortal;

     aAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     aAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "</head>";
     |HAZ GrabaPortal;

     aAlfa = "";
     |HAZ GrabaPortal;

     aAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "     function carga()";
     |HAZ GrabaPortal;

     aAlfa = "     {";
     |HAZ GrabaPortal;

     aAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     aAlfa = "     }";
     |HAZ GrabaPortal;

     aAlfa = "</script>";
     |HAZ GrabaPortal;

     aAlfa = "";
     |HAZ GrabaPortal;

     aAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + aEnlace + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + aHID + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + aIdioma + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "LEV" + &34 + " value=" + &34 + "000000000000" + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIC" + &34 + " value=" + &34;
     |HAZ GrabaPortalSin;
     |XCIERRA nHandle;

     eaDestino   = eaDirServidor + eaFicheroPtl;
     eaOrigen    = eaDirServidor + eaFicheroTxt;

     |AFEGIR_FICHERO eaOrigen, eaDestino;

     aAbre = eaDirServidor + eaFicheroPtl;
     |XABRE "AB", aAbre, nHandle;

     aAlfa = &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "RUT" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + aPRG + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + aEJF + &34 + " />";
     |HAZ GrabaPortal;

     aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + aMOD + &34 + " />";
     |HAZ GrabaPortal;

     |SI aTipoEmi = "B";
         aAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "SINVL" + &34 + " value=" + &34 + &34 + " />";
         |HAZ GrabaPortal;
     |FINSI;

     aAlfa = "</form>";   |HAZ GrabaPortal;
     aAlfa = "</body>";   |HAZ GrabaPortal;
     aAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA nHandle;

     eaOrigen  = eaDirServidor + eaFicheroPtl;
     eaDestino = eaDirLanza + eaFicheroPtl;
     |HAZ CopiaFichero;
|FPRC;

|PROCESO PortalImprime;
     |SI eaModelo = "100";
         aEnlace = "https://www6.aeat.es/wlpl/PFTW-PICW/ServVali";
         aEnlace = "https://www2.agenciatributaria.gob.es/wlpl/PFTW-PICW/ServVali";
     |FINSI;

     |SI eaModelo = "714";
         aEnlace = "https://www6.aeat.es/es13/l/zi22zilk0022";
     |FINSI;

     aHID    = "IEV" + eaModelo + "0A";
     aIDI    = aIdioma;
     aEJF    = "2015";
     aMOD    = eaModelo;

     |HAZ GrabaHtml;

     aForzExplorador = "N"; |HAZ Explorador;

     || Filtro las '/' por '\'
     eaDestino = eaDestino - "/";
     |PARA; |SI FSalida ! 0; |HACIENDO;
        nCalc1 = ((FSalida / 100) ! 0) + 99; aParte1 = eaDestino % nCalc1;
        nCalc2 = FSalida + 98;               aParte2 = eaDestino % nCalc2;
        eaDestino = aParte1 + "\" + aParte2;

        eaDestino = eaDestino - "/";
     |SIGUE;

     |SI aPathExplorador ! "";
         aAlfa = aPathExplorador + " " + eaDestino;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaDestino + &34;
     |FINSI;

     |RSYSTEM aAlfa;
     |PULSATECLA;

     |SLEEP 5;

     aAlfa = eaDirServidor + eaFicheroPtl;   |FBORRA aAlfa;
     aAlfa = eaDirLanza + eaFicheroPtl;
     |PULSATECLA;
|FPRC;

|PROCESO SacaError;
     aSwError = aAlfa1; nSwError = 0;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     |XABRE "C", aAlfa1, nHandle;
     |SI FSalida = 0;
        |PARA; |SI; |HACIENDO;
           |XLEE nHandle,  250, aAlfa;
           |SI FSalida < 0; |SAL; |FINSI;

           aAlfa1 = aAlfa < "";  |QBF aAlfa1;

           aAlfa2 = aAlfa1 - "http://www.w3.org/TR/html4/loose.dtd";
           |SI FSalida ! 0;
               nSwError = 1; |SAL;
           |FINSI;

           aAlfa2 = aAlfa1 - "<title>";
           |SI FSalida ! 0;
              aAlfa2 = aAlfa1 - "error";
              |SI FSalida ! 0; nSwError = 1; |SAL;  |FINSI;

              aAlfa2 = aAlfa1 - "errónea";
              |SI FSalida ! 0; nSwError = 1; |SAL;  |FINSI;
           |FINSI;
        |SIGUE;
        |XCIERRA nHandle;
     |FINSI;

     |DDEFECTO #rew02001;
     #rew02001#0 = #rew00001#0;
     #rew02001#1 = #rew00001#3;
     #rew02001#2 = #rew00001#2;
     #rew02001#3 = "Validado";
     #rew02001#4 = eaDestino;
     #rew02001#5 = eaDirLanza + eaFicheroPtl;

     #rew02001#6 = eaVerde;
     |SI nSwError = 1;
         #rew02001#4 = aSwError;
         #rew02001#3 = "Errores";
         #rew02001#6 = eaRojo;
     |FINSI;
     |GRABA 020#rew02001.n;
     |LIBERA #rew02001;
|FPRC;

|PROCESO PortalValida;
     |SI eaModelo = "100";
         aEnlace = "https://www6.aeat.es/wlpl/PFTW-PICW/ServVali";
         aEnlace = "https://www2.agenciatributaria.gob.es/wlpl/PFTW-PICW/ServVali";
     |FINSI;

     |SI eaModelo = "714";
         aEnlace = "https://www6.aeat.es/es13/l/zi22zilk0022";
     |FINSI;

     aHID    = "IEV" + eaModelo + "0A";
     aIDI    = aIdioma;
     aEJF    = "2015";
     aMOD    = eaModelo;

     |HAZ GrabaHtml;

     aForzExplorador = "N"; |HAZ Explorador;

     || Filtro las '/' por '\'
     eaDestino = eaDestino - "/";
     |PARA; |SI FSalida ! 0; |HACIENDO;
        nCalc1 = ((FSalida / 100) ! 0) + 99; aParte1 = eaDestino % nCalc1;
        nCalc2 = FSalida + 98;               aParte2 = eaDestino % nCalc2;
        eaDestino = aParte1 + "\" + aParte2;

        eaDestino = eaDestino - "/";
     |SIGUE;

     |DBASE eaOrigen; |QBF eaOrigen;
     eaOrigen  = eaOrigen + "hacienda/dsaeatresp.exe";
     eaDestino = eaDirLanza + "dsaeatresp.exe";
     |HAZ EnviaFichero;

     aAlfa1 = eaDirLanza + "error" + eaFicheroSin + ".html";
     aAlfa  = eaDestino + " " + eaDirLanza + eaFicheroPtl + " " + aAlfa1;
     aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |RSYSTEM aAlfa;

     eaOrigen    = eaDirServidor + eaFicheroTxt;
     |SI eaModelo = 100;
         eaDestino   = #reemi100#40; |QBF eaDestino; |RMKDIR eaDestino;
     |SINO;
         eaDestino   = #reemipat#40; |QBF eaDestino; |RMKDIR eaDestino;
     |FINSI;

     aAlfa1 = eaDestino % -101;
     |SI aAlfa1 ! "/"; |Y aAlfa1 ! "\";
         eaDestino = eaDestino + "\";
     |FINSI;
     eaDestino   = eaDestino + eaFicheroTxt;

     aAlfa1 = eaDirLanza + "error" + eaFicheroSin + ".html";
     |HAZ SacaError;
     |HAZ GrabaImpreso;

||     |SI nSwError = 1;  |ACABA;  |FINSI;

     |HAZ EnviaFichero;

     |PULSATECLA;
|FPRC;

|PROCESO Portal;
     |SI #reemi100#35 = "E"; aIdioma = "ES"; |FINSI;
     |SI #reemi100#35 = "C"; aIdioma = "CA"; |FINSI;
     |SI #reemi100#35 = "G"; aIdioma = "GL"; |FINSI;
     |SI #reemi100#35 = "V"; aIdioma = "VA"; |FINSI;

     |SI aTipoEmi = "B";
         aPRG = "";
         |HAZ PortalImprime;
     |FINSI;

     |SI aTipoEmi = "V";
         |SI eaModelo = "100";
             aPRG = "";
             |HAZ PortalValida;

             |HAZ GrabaImpreso;
         |FINSI;

         |SI eaModelo = "714";
             aPRG = "PTLINK0U";
             |HAZ PortalValida;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO rew00001Portal;
     |HAZ PonVntn;

     enEmpresa = #rew00001#0;
     eaTipo    = #rew00001#2; |QBF eaTipo; eaTipo = eaTipo % 0110;
     eaNif     = #rew02000#2;
     |SI eaModelo = "100"; |HAZ GrabaSecuencial100; |FINSI;
     |SI eaModelo = "714"; |HAZ GrabaSecuencial714; |FINSI;

     |SI eaModelo = "100";
        aAlfa       = #rew00001#0; |QBF aAlfa; aAlfa = aAlfa % 0110;
        eaFichero    = "or" + (("00000" + aAlfa) % -105);

        aAlfa       = #rew00001#2; |QBF aAlfa;
        |SI aAlfa   = "CONJUNTA";  aAlfa = "A"; |FINSI;
        |SI aAlfa   = "CONJUNTAE"; aAlfa = "A"; |FINSI;

        eaFicheroSin = eaFichero + (aAlfa % 0101);
        eaFicheroTxt = eaFicheroSin + ".txt";
        eaFicheroPtl = eaFicheroSin + ".html";

        |HAZ Portal;
     |FINSI;

     |SI eaModelo = "714";
        aAlfa       = #rew00001#0; |QBF aAlfa; aAlfa = aAlfa % 0110;
        eaFichero    = "pa" + (("00000" + aAlfa) % -105);
        aAlfa       = #rew00001#2; |QBF aAlfa;
        eaFicheroSin = eaFichero + (aAlfa % -301);
        eaFicheroTxt = eaFicheroSin + ".txt";
        eaFicheroPtl = eaFicheroSin + ".html";

        |ABRE #rem01001;
        #rem01001#0 = #rew00001#0;
        #rem01001#1 = "";
        #rem01001#2 = #rew00001#2;
        |LEE 000#rem01001.=;
        |SI FSalida ! 0; |DDEFECTO #rem01001; |FINSI;

        |HAZ Portal;

        |CIERRA #rem01001;
     |FINSI;

     |HAZ QuitaVntn;
|FPRC;

|DEFBUCLE rew00001Portal;
     #rew00001#1;
     11;
     00000, "          ", "*";
     99999, "zzzzzzzzzz", "*";
     ;
     NULL, rew00001Portal;
|FIN;

|PROCESO CreaCarpeta;
     |DBASE aDirBase; |QBF aDirBase;
     eaDirServidor = aDirBase + "tmp"; |MKDIR eaDirServidor;
     eaDirServidor = aDirBase + "tmp/";

     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     eaDirLanza    = aContiene1; |QBF eaDirLanza; aAlfa = ""; aAlfa2 = "";
     |PARA nCont = 101; |SI aAlfa2 ! "/"; |Y aAlfa2 ! "\"; |HACIENDO nCont = nCont + 100;
        aAlfa2 = eaDirLanza % nCont;
        |SI aAlfa2 ! "/"; |Y aAlfa2 ! "\";
           aAlfa = aAlfa + aAlfa2;
        |FINSI;
     |SIGUE;

     eaDirLanza    = aAlfa + "\";
     eaDirLanza    = eaDirLanza + "AEAT\";                    |RMKDIR eaDirLanza;
     aDirInternet = eaDirLanza;
     eaDirLanza    = eaDirLanza + eaModelo + "\";             |RMKDIR eaDirLanza;
     eaDirLanza    = eaDirLanza + "2015\";                    |RMKDIR eaDirLanza;
     eaDirLanza    = eaDirLanza + Usuario + "\";              |RMKDIR eaDirLanza;

     aDirInternet = aDirInternet + "INTERNET\";             |RMKDIR aDirInternet;
     aDirInternet = aDirInternet + eaModelo + "\";          |RMKDIR aDirInternet;
     aDirInternet = aDirInternet + "2015\";                 |RMKDIR aDirInternet;

     |HAZ LimpiaCarpeta;
|FPRC;

|PROCESO Borrador100;
     |HAZ CreaCarpeta;

     aTipoEmi = "B";
     eaModelo = "100";
     |BUCLE rew00001Portal;
|FPRC;

|PROCESO Valida100;
     |HAZ CreaCarpeta;

     |ABRE #rew02001;  |CIERRA #rew02001;  |DELINDEX #rew02001;

     |ABRE #rew02001;

     aTipoEmi = "V";
     eaModelo = "100";
     |BUCLE rew00001Portal;

     aAlfa  = "    Los ficheros validados se han depositado en la carpeta ";
     aAlfa1 = #reemi100#40; |QBF aAlfa1;
     aAlfa  = aAlfa + aAlfa1;
     |MENAV aAlfa;

     |HAZ PantaResultados;

     |CIERRA #rew02001;  |DELINDEX #rew02001;

     |PTEC 806;
|FPRC;

|PROCESO Borrador714;
     |HAZ CreaCarpeta;

     aTipoEmi = "B";
     eaModelo = "714";
     |BUCLE rew00001Portal;
|FPRC;

|PROCESO Valida714;
     |HAZ CreaCarpeta;

     |ABRE #rew02001;  |CIERRA #rew02001;  |DELINDEX #rew02001;

     |ABRE #rew02001;

     aTipoEmi = "V";
     eaModelo = "714";
     |BUCLE rew00001Portal;

     aAlfa  = "    Los ficheros validados se han depositado en la carpeta ";
     aAlfa1 = #reemipat#40; |QBF aAlfa1;
     aAlfa  = aAlfa + aAlfa1;
     |MENAV aAlfa;

     |HAZ PantaResultados;

     |CIERRA #rew02001;  |DELINDEX #rew02001;

     |PTEC 806;
|FPRC;

|| --------------------------------------------------------------------------

|PROCESO QuitaBotones;  |TIPO 7;
     |SI nEntro = 1;  |ACABA;  |FINSI;

     aQueBoton = "|X000";
     aID       = #reemi100#aQueBoton#;
     nBtn    = aID;
     |ESTADO_CONTROL nBtn, "HIDE";

     aQueBoton = "|X001";
     aID       = #reemi100#aQueBoton#;
     nBtn    = aID;
     |ESTADO_CONTROL nBtn, "HIDE";

     nEntro = 1;
|FPRC;

|PROCESO Explorador;
     |SI eaDSMAC = "";  |HAZ CogeMac;  |FINSI;

     |ABRE #zregubic;
     #zregubic#0 = 2015;
     #zregubic#1 = eaDSMAC;
     |LEE 101#zregubic.=;
     |SI FSalida ! 0;
         |DDEFECTO #zregubic;
         #zregubic#0 = 2015;
         #zregubic#1 = eaDSMAC;
         |GRABA 020#zregubic.b;
     |FINSI;

     aPathExplorador = #zregubic#4;  |QBF aPathExplorador;

     |SI aPathExplorador = "";  |O aForzExplorador = "S";
         |MENAV "0000Busque y pinche en el explorador con el que quiera trabajar";

         aPathExplorador = "F" + aPathExplorador;
         |BROWSE aPathExplorador;
         aPathExplorador = aPathExplorador % 290;  |QBF aPathExplorador;
     |FINSI;

     |SI aPathExplorador ! "";
         #zregubic#4 = aPathExplorador;
     |FINSI;

     |GRABA 020#zregubic.a;
     |LIBERA #zregubic;
     |CIERRA #zregubic;
|FPRC;

|PROCESO BotonUnidad;
     |MENAV "0000Busque y pinche en la ubicacion que quiera asignar para depositar los ficheros a enviar";

     |SI eaModelo = 100;
        aAlfa = #reemi100#40; |QBF aAlfa;
     |SINO;
        aAlfa = #reemipat#40; |QBF aAlfa;
     |FINSI;
     aAlfa = "D" + aAlfa; |BROWSE aAlfa;
     aAlfa = aAlfa % 290;  |QBF aAlfa;

     |SI eaDSMAC = "";  |HAZ CogeMac;  |FINSI;

     |ABRE #zregubic;
     #zregubic#0 = 2015;
     #zregubic#1 = eaDSMAC;
     |LEE 101#zregubic.=;
     |SI FSalida ! 0;
        |DDEFECTO #zregubic;
        #zregubic#0 = 2015;
        #zregubic#1 = eaDSMAC;
        |GRABA 020#zregubic.b;
     |FINSI;
     |SI eaModelo = "100";
        #zregubic#6 = aAlfa;
     |SINO;
        #zregubic#7 = aAlfa;
     |FINSI;
     |GRABA 020#zregubic.a;
     |LIBERA #zregubic; |CIERRA #zregubic;

     |SI eaModelo = "100";
        #reemi100#40 = #zregubic#6; |PINDA #0#reemi100;
     |SINO;
        #reemipat#40 = #zregubic#7; |PINDA #0#reemipat;
     |FINSI;
|FPRC;

|PROCESO BotonContinuar;
     |PTEC 806;
|FPRC;

|PROCESO BotonSalir;
     |PTEC 807;
|FPRC;

|PROCESO Inf;
     #rem01001#0 = #reemi100#1;
|FPRC;

|PROCESO Sup;
     #rem01001#0 = #reemi100#2;
|FPRC;

|PROCESO MiraSeleccion;
     |SI #reemi100#0 = "S";
        |C_M #reemi100#1, 1, "S"; |C_M #reemi100#2, 1, "S";
        |PARA nCont = 3; |SI nCont [ 32; |HACIENDO nCont = nCont + 1;
           |C_M #reemi100#nCont#, 1, "N";
        |SIGUE;
     |SINO;
        |C_M #reemi100#1, 1, "N"; |C_M #reemi100#2, 1, "N";
        |PARA nCont = 3; |SI nCont [ 32; |HACIENDO nCont = nCont + 1;
           |C_M #reemi100#nCont#, 1, "S";
        |SIGUE;
     |FINSI;

     |SI PARAMETRO ! "";
        aParam = PARAMETRO;
        aAlfa = aParam - "EMP";
        |SI FSalida ! 0;
           nCalc = FSalida + 2;
           aAlfa = aAlfa % nCalc;
        |FINSI;

        |C_M #reemi100#0, 1, "N"; #reemi100#0 = "S";   |PINTA #reemi100#0;
        |C_M #reemi100#1, 1, "N"; #reemi100#1 = aAlfa; |PINTA #reemi100#1;
        |C_M #reemi100#2, 1, "N"; #reemi100#2 = aAlfa; |PINTA #reemi100#2;

        |PARA nCont = 3; |SI nCont [ 32; |HACIENDO nCont = nCont + 1;
           |C_M #reemi100#nCont#, 1, "N"; #reemi100#nCont# = 0; |PINTA #reemi100#nCont#;
        |SIGUE;
     |FINSI;

     |PINDA #0#reemi100;
|FPRC;

|PROCESO MiraSeleccion714;
     |SI #reemipat#0 = "S";
        |C_M #reemipat#1, 1, "S"; |C_M #reemipat#2, 1, "S";
        |PARA nCont = 3; |SI nCont [ 32; |HACIENDO nCont = nCont + 1;
           |C_M #reemipat#nCont#, 1, "N";
        |SIGUE;
     |SINO;
        |C_M #reemipat#1, 1, "N"; |C_M #reemipat#2, 1, "N";
        |PARA nCont = 3; |SI nCont [ 32; |HACIENDO nCont = nCont + 1;
           |C_M #reemipat#nCont#, 1, "S";
        |SIGUE;
     |FINSI;

     |SI PARAMETRO ! "";
        aParam = PARAMETRO;
        aAlfa = aParam - "EMP";
        |SI FSalida ! 0;
           nCalc = FSalida + 2;
           aAlfa = aAlfa % nCalc;
        |FINSI;

        |C_M #reemipat#0, 1, "N"; #reemipat#0 = "S";   |PINTA #reemipat#0;
        |C_M #reemipat#1, 1, "N"; #reemipat#1 = aAlfa; |PINTA #reemipat#1;
        |C_M #reemipat#2, 1, "N"; #reemipat#2 = aAlfa; |PINTA #reemipat#2;

        |PARA nCont = 3; |SI nCont [ 32; |HACIENDO nCont = nCont + 1;
           |C_M #reemipat#nCont#, 1, "N"; #reemipat#nCont# = 0; |PINTA #reemipat#nCont#;
        |SIGUE;
     |FINSI;

     |PINDA #0#reemipat;
|FPRC;

|PROCESO TomaExplor;
     aForzExplorador = "S"; |HAZ Explorador; aForzExplorador = "N";
|FPRC;

|PROCESO TomaReader;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |ABRE #zregubic;
     #zregubic#0 = 2015;
     #zregubic#1 = aIPRemoto;
     |LEE 101#zregubic.=;
     |SI FSalida ! 0;
         |DDEFECTO #zregubic;
         #zregubic#0 = 2015;
         #zregubic#1 = aIPRemoto;
         |GRABA 020#zregubic.b;
     |FINSI;

     eaPathAcrobat    = #zregubic#5;  |QBF eaPathAcrobat;

     |SI eaPathAcrobat = ""; |O aForzAcrobat = "S";
         |MENAV "0000Busque y pinche en la ubicacion del lector de PDFs";

         eaPathAcrobat = "F" + eaPathAcrobat;
         |BROWSE eaPathAcrobat;
         eaPathAcrobat = eaPathAcrobat % 290;  |QBF eaPathAcrobat;
     |FINSI;

     |SI eaPathAcrobat ! ""; #zregubic#5 = eaPathAcrobat; |FINSI;

     |GRABA 020#zregubic.a;
     |LIBERA #zregubic;
     |CIERRA #zregubic;
|FPRC;

|PROCESO Ubicaciones;
     aForzAcrobat = "S";

     aPopup1  = nBtnReader;
     aPopup2  = 3;
     aPopup3  = "1.- Ubicacion Reader";
     aPopup4  = "2.- Ubicacion explorador internet";
     aPopup5  = "3.- Salir";

     |PARA;  |SI;  |HACIENDO;
          IaPopup  = aPopup1  <-;
          |ESPECIFICA "TRACKPOPUP", aPopup;
          |SI FSalida ! 0;
              IaPopup  = aPopup3  <-;
              IaPopup  = IaPopup + (FSalida - 1);

              aAlfa = aPopup % 101;

              |SI aAlfa = "1";  |HAZ TomaReader;  |FINSI;
              |SI aAlfa = "2";  |HAZ TomaExplor;  |FINSI;
              |SI aAlfa = "3";  |SAL;             |FINSI;

              |PULSATECLA;
          |FINSI;
     |SIGUE;

     |PULSATECLA;
|FPRC;

|PROCESO rew00001Marca;
     #rew00001#11 = aMarca;
     |GRABA 020#rew00001.a;
|FPRC;

|DEFBUCLE rew00001Marca;
     #rew00001#1;
     ;
     #rew02000#0, "          ";
     #rew02000#0, "zzzzzzzzzz";
     be;
     NULL, rew00001Marca;
|FIN;

|PROCESO EvtoGrid1;
     |SI FSalida = 1; |O FSalida = 2;
        |LEE 000#rew02000.c;

        #rew00001#0 = #rew02000#0;
        #rew00001#1 = " ";
        |LEE 000#rew00001.];
        |PARA; |SI FSalida = 0; |Y #rew00001#0 = #rew02000#0; |HACIENDO;
           aAlfa = #rew00001#2; |QBF aAlfa;
           |SI aAlfa = "CONJUNTAE";
              enSwFalle = 1;
              |SAL;
           |SINO;
              enSwFalle = 0;
           |FINSI;
           |LEE 000#rew00001.s;
        |SIGUE;

        |REFRESCACONTROL nGrid2;
     |FINSI;

     |SI FSalida = 4;
        |SI #rew02000#3 = " ";
           #rew02000#3 = "*";
        |SINO;
           #rew02000#3 = " ";
        |FINSI;
        |GRABA 020#rew02000.a;

        aMarca = #rew02000#3; |BUCLE rew00001Marca;
        |REFRESCACONTROL nGrid1;
     |FINSI;
|FPRC;

|PROCESO EvtoGrid2;
     |SI FSalida = 1; |O FSalida = 2;
        |LEE 000#rew00001.c;
     |FINSI;
     |SI FSalida = 4;
        |SI #rew00001#11 = " ";
           #rew00001#11 = "*";
        |SINO;
           #rew00001#11 = " ";
        |FINSI;
        |GRABA 020#rew00001.a;

        |REFRESCACONTROL nGrid2;
     |FINSI;
|FPRC;


|PROCESO Infw001;
     #rew00001#0 = #rew02000#0;
     #rew00001#1 = " ";
|FPRC;

|PROCESO Supw001;
     #rew00001#0 = #rew02000#0;
     #rew00001#1 = "z";
|FPRC;

|PROCESO rem01001;
     SwEstar = 1;
     #rem00100#0 = #rem01001#0;
     |LEE 000#rem00100.=;
     |SI FSalida ! 0; |DDEFECTO #rem00100; |FINSI;

     #rew02000#0 = #rem01001#0;
     |LEE 000#rew02000.=;
     |SI FSalida ! 0;
        |DDEFECTO #rew02000;
        #rew02000#0 = #rem01001#0;
        aAlfa = #rem00100#2; |QBF aAlfa;
        aAlfa = aAlfa + " " + #rem00100#3; |QBF aAlfa;
        aAlfa = aAlfa + ", " + #rem00100#4; |QBF aAlfa;
        #rew02000#1 = aAlfa;
        #rew02000#2 = #rem00100#1;
        |GRABA 020#rew02000.n;
     |FINSI;

     #rew00001#0 = #rem01001#0;
     #rew00001#1 = "";
     #rew00001#2 = #rem01001#2;
     |SI eaModelo = "100";
        Comodin = #rew00001#2; |QBF Comodin;
        Comodin = Comodin % 0101;
        |SI #rew00001#2 = "CONJUNTAE    "; Comodin = "J"; |FINSI;
        |SI #rew00001#2 = "CONJUNTA     "; Comodin = "N"; |FINSI;
     |FINSI;
     |SI eaModelo = "714";
        Comodin = #rew00001#2; |QBF Comodin;
        Comodin = Comodin % -301;
     |FINSI;
     #rew00001#1 = Comodin;
     #rew00001#3 = #rem01001#7;
     #rew00001#4 = 1;
     #rew00001#5 = "S";
     #rew00001#6 = 1;
     #rew00001#7 = "";
     |GRABA 000#rew00001.n;
|FPRC;

|DEFBUCLE rem01001_100;
     #rem01001#1;
     5, 6;
     DEmpre, 00, "          ", eaModelo, DReimp;
     HEmpre, 99, "zzzzzzzzzz", eaModelo, HReimp;
     be;
     NULL, rem01001;
|FIN;

|DEFBUCLE rem01001_714;
     #rem01001#1;
     5,6;
     DEmpre,00,"          ",eaModelo,DReimp;
     HEmpre,99,"zzzzzzzzzz",eaModelo,HReimp;
     be;
     NULL, rem01001;
|FIN;

|PROCESO CargaTempo;
     SwEstar = 0;

     |ABRE #rem00100;

     |SI eaModelo = "100";
        areemision = #reemi100#36;
     |SINO;
        areemision = #reemipat#36;
     |FINSI;
     |SI areemision = "S";
        DReimp = "N"; HReimp = "S";
     |SINO;
        DReimp = "N"; HReimp = "N";
     |FINSI;

     |SI eaModelo = "100";
        |SI #reemi100#0 = "S";
           DEmpre = #reemi100#1; HEmpre = #reemi100#2;
           |BUCLE rem01001_100;
        |SINO;
           |PARA XCampos = 3; |SI XCampos [ 32; |HACIENDO XCampos = XCampos + 1;
               |SI #reemi100#XCampos# ! 0;
                   DEmpre = #reemi100#XCampos#;
                   HEmpre = #reemi100#XCampos#;
                   |BUCLE rem01001_100;
               |FINSI;
           |SIGUE;
        |FINSI;
     |FINSI;

     |SI eaModelo = "714";
        |SI #reemipat#0 = "S";
           DEmpre = #reemipat#1; HEmpre = #reemipat#2;
           |BUCLE rem01001_714;
        |SINO;
            |PARA XCampos = 3; |SI XCampos [ 32; |HACIENDO XCampos = XCampos + 1;
               |SI #reemipat#XCampos# ! 0;
                   DEmpre = #reemipat#XCampos#;
                   HEmpre = #reemipat#XCampos#;
                   |BUCLE rem01001_714;
               |FINSI;
            |SIGUE;
         |FINSI;
     |FINSI;
     |CIERRA #rem00100;
|FPRC;

|PROCESO Modelo714;
     |SI eaDSMAC = "";  |HAZ CogeMac;  |FINSI;

     |ABRE #zregubic;
     #zregubic#0 = 2015;
     #zregubic#1 = eaDSMAC;
     |LEE 101#zregubic.=;
     |SI FSalida ! 0;
        |DDEFECTO #zregubic;
        #zregubic#0 = 2015;
        #zregubic#1 = eaDSMAC;
        |GRABA 020#zregubic.b;
     |FINSI;

     aAlfa = #zregubic#7; |QBF aAlfa;
     |SI aAlfa = "";
        aContiene = "";
        |ESPECIFICA "RBASS", aContiene;
        aAlfa = (aContiene1 % 102) > "";
        aAlfa1 = aAlfa % -101;
        |SI aAlfa1 ! ":"; aAlfa = ""; |FINSI;

        aAlfa = aAlfa + "/AEAT/INTERNET/714/2015/"; |RMKDIR aAlfa;
        #zregubic#7 = aAlfa;
        |GRABA 020#zregubic.a;
     |FINSI;
     |LIBERA #zregubic; |CIERRA #zregubic;

     #reemipat#40 = #zregubic#7;

     |PINPA #0#reemipat; nPant = FSalida;
     |HAZ MiraSeleccion714;

     aAlfa = "e1" + Usuario; |NOME_DAT #rew02000#aAlfa#;
     aAlfa = "e2" + Usuario; |NOME_DAT #rew00001#aAlfa#;
     aAlfa = "e3" + Usuario; |NOME_DAT #rew02001#aAlfa#;
     |ABRE #rew00001;  |CIERRA #rew00001;  |DELINDEX #rew00001;
     |ABRE #rew02000;  |CIERRA #rew02000;  |DELINDEX #rew02000;

     |ABRE #rew00001;
     |ABRE #rew02000;

     |CONTROL_SIMPLE nPant, "BOTON,{{197}}Ubicaciones", 2604, 2620, Ubicaciones;
     nBtnReader = FSalida;
     |ESTADO_CONTROL nBtnReader, "DISABLE";

     |CONTROL_SIMPLE nPant, "BOTON,{{197}}Presentaci¢n telem tica", 2650, 2672, Valida714;
     nBtnValida = FSalida;

     |CONTROL_SIMPLE nPant, "BOTON,{{205}}Borrador sin validaci¢n", 2675, 2698, Borrador714;
     nBtnBorrador = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{001}}Salir", 3586, 3598, BotonSalir;
     nBtnSalir = FSalida;

     |ESTADO_CONTROL nBtnValida,   "DISABLE";
     |ESTADO_CONTROL nBtnBorrador, "DISABLE";
     |ESTADO_CONTROL nBtnSalir,   "DISABLE";

     |CONTROL_SIMPLE nPant, "BOTON,{{206}}Validar", 1676, 1686, BotonContinuar;
     nBtnOk = FSalida;

     |CONTROL_SIMPLE nPant, "BOTON,{{207}}Cancelar", 1688, 1698, BotonSalir;
     nBtnCancel = FSalida;

     |CONTROL_SIMPLE nPant, "BOTON,{{197}}Cambiar unidad", 1583, 1598, BotonUnidad;
     nBtnUnidad = FSalida;

     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#rew02000, nRango, 1703, 2598, NULL, NULL, EvtoGrid1;
     nGrid1 = FSalida;

     nPos1 = 2803; nPos2 = 3698;
     |LINEAL_SIMPLE #1#rew00001, nRango, nPos1, nPos2, Infw001, Supw001, EvtoGrid2;
     nGrid2 = FSalida;
     |PULSATECLA;

     |ENDATOS #1#reemipat;
     |SI FSalida = 0;
        |FIN_CONTROL_WINDOWS nBtnOk;
        |FIN_CONTROL_WINDOWS nBtnCancel;
        |FIN_CONTROL_WINDOWS nBtnUnidad;
        |PINPA #0#reemipat;

        |C_M #reemipat#1, 1, "N"; |C_M #reemipat#2, 1, "N";
        |PARA nCont = 3; |SI nCont [ 32; |HACIENDO nCont = nCont + 1;
           |C_M #reemipat#nCont#, 1, "N";
        |SIGUE;

        SwEstar = 0; |HAZ CargaTempo;
        |SI SwEstar = 0;
           |MENAV "    Seleccion vacia";
        |SINO;
           |ESTADO_CONTROL nBtnReader,   "ENABLE";
           |ESTADO_CONTROL nBtnValida,   "ENABLE";
           |ESTADO_CONTROL nBtnBorrador, "ENABLE";
           |ESTADO_CONTROL nBtnSalir,    "ENABLE";

           |REFRESCACONTROL nGrid1;

           aEsc1  = &255 + "806";
           aEsc2  = &255 + "807";
           aRetu  = &255 + "802";
           |PARA; |SI;  |HACIENDO;
              FSalida = "::," + nGrid1;
              |LEETECLA aTecla;
              |SI aTecla = aEsc1; |SAL; |FINSI;
              |SI aTecla = aEsc2; |SAL; |FINSI;
              |SI aTecla = aRetu; |SAL; |FINSI;
           |SIGUE;
        |FINSI;
     |SINO;
        |FIN_CONTROL_WINDOWS nBtnOk;
        |FIN_CONTROL_WINDOWS nBtnCancel;
     |FINSI;

     |DESTRUYECONTROL nGrid1;
     |DESTRUYECONTROL nGrid2;
     |FIN_CONTROL_WINDOWS nBtnReader;
     |FIN_CONTROL_WINDOWS nBtnValida;
     |FIN_CONTROL_WINDOWS nBtnBorrador;
     |FIN_CONTROL_WINDOWS nBtnSalir;

     |CIERRA #rew00001; |DELINDEX #rew00001;
     |CIERRA #rew02000; |DELINDEX #rew02000;
|FPRC;

|PROCESO Modelo100;
     |SI eaDSMAC = "";  |HAZ CogeMac;  |FINSI;

     |ABRE #zregubic;
     #zregubic#0 = 2015;
     #zregubic#1 = eaDSMAC;
     |LEE 101#zregubic.=;
     |SI FSalida ! 0;
        |DDEFECTO #zregubic;
        #zregubic#0 = 2015;
        #zregubic#1 = eaDSMAC;
        |GRABA 020#zregubic.b;
     |FINSI;

     aAlfa = #zregubic#6; |QBF aAlfa;
     |SI aAlfa = "";
         aContiene = "";
         |ESPECIFICA "RBASS", aContiene;
         aAlfa = (aContiene1 % 102) > "";
         aAlfa1 = aAlfa % -101;
         |SI aAlfa1 ! ":"; aAlfa = ""; |FINSI;

         aAlfa = aAlfa + "/AEAT/INTERNET/100/2015/"; |RMKDIR aAlfa;
         #zregubic#6 = aAlfa;
         |GRABA 020#zregubic.a;
     |FINSI;
     |LIBERA #zregubic; |CIERRA #zregubic;

     #reemi100#40 = #zregubic#6;

     |PINPA #0#reemi100; nPant = FSalida;
     |HAZ MiraSeleccion;

     aAlfa = "e1" + Usuario; |NOME_DAT #rew02000#aAlfa#;
     aAlfa = "e2" + Usuario; |NOME_DAT #rew00001#aAlfa#;
     aAlfa = "e3" + Usuario; |NOME_DAT #rew02001#aAlfa#;
     |ABRE #rew00001;  |CIERRA #rew00001;  |DELINDEX #rew00001;
     |ABRE #rew02000;  |CIERRA #rew02000;  |DELINDEX #rew02000;

     |ABRE #rew00001;
     |ABRE #rew02000;

     |CONTROL_SIMPLE nPant, "BOTON,{{197}}Ubicaciones", 2604, 2620, Ubicaciones;
     nBtnReader = FSalida;
     |ESTADO_CONTROL nBtnReader, "DISABLE";

     |CONTROL_SIMPLE nPant, "BOTON,{{197}}Presentaci¢n telem tica", 2650, 2672, Valida100;
     nBtnValida = FSalida;

     |CONTROL_SIMPLE nPant, "BOTON,{{205}}Borrador sin validaci¢n", 2675, 2698, Borrador100;
     nBtnBorrador = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{001}}Salir", 3586, 3598, BotonSalir;
     nBtnSalir = FSalida;

     |ESTADO_CONTROL nBtnValida,   "DISABLE";
     |ESTADO_CONTROL nBtnBorrador, "DISABLE";
     |ESTADO_CONTROL nBtnSalir,   "DISABLE";

     |CONTROL_SIMPLE nPant, "BOTON,{{206}}Validar", 1676, 1686, BotonContinuar;
     nBtnOk = FSalida;

     |CONTROL_SIMPLE nPant, "BOTON,{{207}}Cancelar", 1688, 1698, BotonSalir;
     nBtnCancel = FSalida;

     |CONTROL_SIMPLE nPant, "BOTON,{{197}}Cambiar unidad", 1583, 1598, BotonUnidad;
     nBtnUnidad = FSalida;

     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#rew02000, nRango, 1703, 2598, NULL, NULL, EvtoGrid1;
     nGrid1 = FSalida;

     |LINEAL_SIMPLE #1#rew00001, nRango, 2803, 3698, Infw001, Supw001, EvtoGrid2;
     nGrid2 = FSalida;
     |PULSATECLA;

     |ENDATOS #1#reemi100;
     |SI FSalida = 0;
        |FIN_CONTROL_WINDOWS nBtnOk;
        |FIN_CONTROL_WINDOWS nBtnCancel;
        |FIN_CONTROL_WINDOWS nBtnUnidad;
        |PINPA #0#reemi100;

        |C_M #reemi100#1, 1, "N"; |C_M #reemi100#2, 1, "N";
        |PARA nCont = 3; |SI nCont [ 32; |HACIENDO nCont = nCont + 1;
           |C_M #reemi100#nCont#, 1, "N";
        |SIGUE;

        SwEstar = 0; |HAZ CargaTempo;
        |SI SwEstar = 0;
           |MENAV "    Seleccion vacia";
        |SINO;
           |ESTADO_CONTROL nBtnReader,   "ENABLE";
           |ESTADO_CONTROL nBtnValida,   "ENABLE";
           |ESTADO_CONTROL nBtnBorrador, "ENABLE";
           |ESTADO_CONTROL nBtnSalir,    "ENABLE";

           |REFRESCACONTROL nGrid1;

           aEsc1  = &255 + "806";
           aEsc2  = &255 + "807";
           aRetu  = &255 + "802";
           |PARA; |SI;  |HACIENDO;
              FSalida = "::," + nGrid1;
              |LEETECLA aTecla;
              |SI aTecla = aEsc1; |SAL; |FINSI;
              |SI aTecla = aEsc2; |SAL; |FINSI;
              |SI aTecla = aRetu; |SAL; |FINSI;
           |SIGUE;
        |FINSI;
     |SINO;
        |FIN_CONTROL_WINDOWS nBtnOk;
        |FIN_CONTROL_WINDOWS nBtnCancel;
     |FINSI;

     |DESTRUYECONTROL nGrid1;
     |DESTRUYECONTROL nGrid2;

     |FIN_CONTROL_WINDOWS nBtnReader;
     |FIN_CONTROL_WINDOWS nBtnValida;
     |FIN_CONTROL_WINDOWS nBtnBorrador;
     |FIN_CONTROL_WINDOWS nBtnSalir;

     |CIERRA #rew00001; |DELINDEX #rew00001;
     |CIERRA #rew02000; |DELINDEX #rew02000;
|FPRC;

|PROCESO Borrador;
     aAlfa = "e1" + Usuario; |NOME_DAT #rew02000#aAlfa#;
     aAlfa = "e2" + Usuario; |NOME_DAT #rew00001#aAlfa#;
     |ABRE #rew00001;  |CIERRA #rew00001;  |DELINDEX #rew00001;
     |ABRE #rew02000;  |CIERRA #rew02000;  |DELINDEX #rew02000;

     |ABRE #rew00001;
     |ABRE #rew02000;

     |ABRE #rem01001;
     #rem01001#0 = enEmpresa;
     #rem01001#1 = 0;
     #rem01001#2 = eaTipoBor;
     |LEE 000#rem01001.=;
     |SI FSalida = 0;
         |HAZ rem01001;
     |FINSI;
     |CIERRA #rem01001;

     |LEE 000#rew00001.p;
     |SI FSalida = 0;
         |SI PARAMETRO = "BORRADOR_RENTA";  |HAZ Borrador100;  |FINSI;
         |SI PARAMETRO = "BORRADOR_PATRI";  |HAZ Borrador714;  |FINSI;
     |FINSI;

     |CIERRA #rew00001;  |DELINDEX #rew00001;
     |CIERRA #rew02000;  |DELINDEX #rew02000;
|FPRC;

|PROGRAMA;
     |PTEC 802;  |PAUSA;    || No quitar

     |SI PARAMETRO = "BORRADOR_RENTA";
         eaModelo = "100";
         |HAZ Borrador;
         |ACABA;
     |FINSI;

     |SI PARAMETRO = "BORRADOR_PATRI";
         eaModelo = "714";
         |HAZ Borrador;

         |ACABA;
     |FINSI;

     |SI PARAMETRO = "";
         eaModelo = "100";
     |FINSI;

     |SI PARAMETRO ! "";
        aAlfa = PARAMETRO; |QBF aAlfa;
        aAlfa = aAlfa - "|MODELO100";
        |SI FSalida ! 0;
            eaModelo = "100";
            PARAMETRO = aAlfa;
        |FINSI;

        aAlfa = PARAMETRO; |QBF aAlfa;
        aAlfa = aAlfa - "|MODELO714";
        |SI FSalida ! 0;
            eaModelo = "714";
            PARAMETRO = aAlfa;
        |FINSI;
     |FINSI;

     |SI eaModelo = "100"; |HAZ Modelo100; |FINSI;
     |SI eaModelo = "714"; |HAZ Modelo714; |FINSI;

     |PULSATECLA;
|FPRO;

|PROCESO Tipo80; |TIPO 80;
     |HAZ CargaColores;
     nEntro  = 0;
     FSalida = 3599;
|FPRC;

|PROCESO Tipo90; |TIPO 90;
     |SI eaDirLanza ! "";
||         |HAZ LimpiaCarpeta;
     |FINSI;
|FPRC;
