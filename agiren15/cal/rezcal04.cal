|FICHEROS;
      rew99999;

      datfic0@;
      datfic1@;
      datfic2@;
      datfic3@;
      datfic4@;
      datfic5@;

     &refere1@;
     &refere2@;
     &refere3@;
|FIN;

|VARIABLES;
|FIN;

|INCLUYE i_varcal;

|PROCESO SacaTope;
     aDef    = eaPathDef + "rem01026.mas";
     |CARGA_DEF aDef, datfic5@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic5@#"zdat1026"#;  |FINSI;

     |ABRE #datfic5@;
     #datfic5@#0 = #refere1@#0;
     #datfic5@#1 = #refere1@#1;
     #datfic5@#2 = #refere1@#2;
     |LEE 040#datfic5@.=;
     |SI FSalida ! 0;  |DDEFECTO #datfic5@;  |FINSI;
     |CIERRA #datfic5@;

     nValor = #datfic2@#15  + #datfic2@#7  + #datfic2@#8  + #datfic2@#11  + #datfic2@#13 + #datfic5@#15;
     |SI nValor [ 0;  nValor = 0;  |FINSI;

     |DESCARGA_DEF #datfic5@;
|FPRC;

|PROCESO CalculaI6;
     aDef    = eaPathDef + "rem01047.mas";
     |CARGA_DEF aDef, datfic1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic1@#"zdat1047"#;  |FINSI;

     aDef    = eaPathDef + "rem01018.mas";
     |CARGA_DEF aDef, datfic2@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |DESCARGA_DEF #datfic1@;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic2@#"zdat1018"#;  |FINSI;

     aDef    = eaPathDef + "rem01033.mas";
     |CARGA_DEF aDef, datfic3@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |DESCARGA_DEF #datfic2@;
         |DESCARGA_DEF #datfic1@;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic3@#"zdat1033"#;  |FINSI;

     |ABRE #datfic1@;
     |ABRE #datfic2@;
     |ABRE #datfic3@;

     #datfic3@#0 = #refere1@#0;
     #datfic3@#1 = #refere1@#1;
     #datfic3@#2 = #refere1@#2;
     |LEE 101#datfic3@.=;
     |SI FSalida ! 0;
         |DDEFECTO #datfic3@;
         #datfic3@#0 = #refere1@#0;
         #datfic3@#1 = #refere1@#1;
         #datfic3@#2 = #refere1@#2;
         |GRABA 020#datfic3@.b;
     |FINSI;

     |SI enConta = 1;
         #datfic1@#0 = #refere1@#0;
         #datfic1@#1 = #refere1@#1;
         #datfic1@#2 = #refere1@#2;
         #datfic1@#3 = 1;
         |LEE 101#datfic1@.=;
         |SI FSalida ! 0;
             |DDEFECTO #datfic1@;
             #datfic1@#0 = #refere1@#0;
             #datfic1@#1 = #refere1@#1;
             #datfic1@#2 = #refere1@#2;
             #datfic1@#3 = 1;
             |GRABA 020#datfic1@.b;
         |FINSI;

         #datfic2@#0 = #refere1@#0;
         #datfic2@#1 = #refere1@#1;
         #datfic2@#2 = #refere1@#2;
         |LEE 000#datfic2@.=;
         |SI FSalida ! 0;  |DDEFECTO #datfic2@;  |FINSI;

         |HAZ SacaTope;

         nValor = #datfic1@#5 + #datfic1@#6;
         nResto = 0;
         |SI nValor > 24250;
             nValor = 24250;
             nResta = 24250 - #datfic1@#6;
             |SI nResta < 0;  nResta = 0;  |FINSI;

             nResto = #datfic1@#5 - nResta;
         |FINSI;

         nValorTit20 = nValor;

         |GRABA 020#datfic1@.a;
         |LIBERA #datfic1@;

         #datfic3@#63 = nValor;
     |FINSI;

     |SI enConta = 2;
         #datfic1@#0 = #refere1@#0;
         #datfic1@#1 = #refere1@#1;
         #datfic1@#2 = #refere1@#2;
         #datfic1@#3 = 2;
         |LEE 101#datfic1@.=;
         |SI FSalida ! 0;
             |DDEFECTO #datfic1@;
             #datfic1@#0 = #refere1@#0;
             #datfic1@#1 = #refere1@#1;
             #datfic1@#2 = #refere1@#2;
             #datfic1@#3 = 2;
             |GRABA 020#datfic1@.b;
         |FINSI;

         #datfic2@#0 = #refere1@#0;
         #datfic2@#1 = #refere1@#1;
         #datfic2@#2 = #refere1@#2;
         |LEE 000#datfic2@.=;
         |SI FSalida ! 0;  |DDEFECTO #datfic2@;  |FINSI;

         |HAZ SacaTope;

         nValor = #datfic1@#5 + #datfic1@#6;
         nResto = 0;
         |SI nValor > 24250;
             nValor = 24250;
             nResta = 24250 - #datfic1@#6;
             |SI nResta < 0;  nResta = 0;  |FINSI;

             nResto = #datfic1@#5 - nResta;
         |FINSI;

         nValorCon20 = nValor;

         |GRABA 020#datfic1@.a;
         |LIBERA #datfic1@;

         #datfic3@#63 = nValor;
     |FINSI;

     |SI enConta = 7;
         #datfic3@#63 = nValorTit20 + nValorCon20;
     |FINSI;

     |SI enConta = 8;
         |SI eaMuerto = "T";
             #datfic3@#63 = nValorCon20;
         |SINO;
             #datfic3@#63 = nValorTit20;
         |FINSI;
     |FINSI;

     |GRABA 020#datfic3@.a;
     |LIBERA #datfic3@;

     enSwAcum  = 0;
     enBloque  = 35;
     eaCasilla = "427";  enImporte = #datfic3@#63;   |HAZ GrabaLineal;

     |CIERRA #datfic1@;
     |CIERRA #datfic2@;
     |CIERRA #datfic3@;

     |DESCARGA_DEF #datfic3@;
     |DESCARGA_DEF #datfic2@;
     |DESCARGA_DEF #datfic1@;
|FPRC;

|PROCESO QuitaConyuge;
     |SI #datfic3@#5 ] nResto;
         #datfic3@#5 = (N\ #datfic3@#5 - nResto);
         nResto = 0;
     |SINO;
         nResto = nResto - #datfic3@#5;
         #datfic3@#5  = (N\ 0);
     |FINSI;

     |SI nResto ] 0;
         |SI #datfic3@#10 ] nResto;
             #datfic3@#10 = (N\ #datfic3@#10 - nResto);
             nResto = 0;
         |SINO;
             nResto = nResto - #datfic3@#10;
             #datfic3@#10  = (N\ 0);
         |FINSI;
     |FINSI;

     |SI nResto ] 0;
         |SI #datfic3@#6 ] nResto;
             #datfic3@#6 = (N\ #datfic3@#6 - nResto);
             nResto = 0;
         |SINO;
             nResto = nResto - #datfic3@#6;
             #datfic3@#6  = 0;
         |FINSI;
     |FINSI;

     |SI nResto ] 0;
         |SI #datfic3@#12 ] nResto;
             #datfic3@#12 = (N\ #datfic3@#12 - nResto);
             nResto = 0;
         |SINO;
             nResto = nResto - #datfic3@#12;
             #datfic3@#12  = 0;
         |FINSI;
     |FINSI;

     #datfic3@#7  = (N\ #datfic3@#5 + #datfic3@#10 + #datfic3@#6 + #datfic3@#12);
|FPRC;

|PROCESO CalculaI;
     aDef    = eaPathDef + "rem01033.mas";
     |CARGA_DEF aDef, datfic0@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef + " " + FSalida;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic0@#"zdat1033"#;  |FINSI;

     aDef    = eaPathDef + "rem01037.mas";
     |CARGA_DEF aDef, datfic3@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |DESCARGA_DEF #datfic0@;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic3@#"zdat1037"#;  |FINSI;

     |ABRE #datfic0@;
     #datfic0@#0 = #refere1@#0;
     #datfic0@#1 = #refere1@#1;
     #datfic0@#2 = #refere1@#2;
     |LEE 040#datfic0@.=;
     |SI FSalida ! 0;  |DDEFECTO #datfic0@;  |FINSI;

     nLimiteGral = 0;
     enBloque = 27;  eaCasilla = "380"; |HAZ SacaImporte; nLimiteGral = nLimiteGral + enImporte;
     enBloque = 28;  eaCasilla = "395"; |HAZ SacaImporte; nLimiteGral = nLimiteGral + enImporte;

     |SI enConta = 1;
         nSuma        = nRdtoCon16;
         nPdte        = nSuma;
         |SI nSuma ! 0;  |Y nRdtoCon < 8000;
             |SI eaCalcP = "P";
                 |SI nRdtoTit ] 8000;
                     #datfic0@#55 = nPdte;
                     |SI #datfic0@#55 ] 2500;
                         #datfic0@#55 = (N\ 2500);
                     |FINSI;
                 |FINSI;
             |FINSI;

             |SI eaCalcP = "R";
                 #datfic0@#55 = (N\ nRdtoCon17);
                 |SI #datfic0@#55 ] 2500;
                     #datfic0@#55 = (N\ 2500);
                 |FINSI;
             |FINSI;

             |SI eaCalcP = "M";
                 #datfic0@#55 = (N\ enCalcP);
                 |SI #datfic0@#55 ] 2500;
                     #datfic0@#55 = (N\ 2500);
                 |FINSI;

                 |SI #datfic0@#55 ] nSuma;
                     #datfic0@#55 = (N\ nSuma);
                 |FINSI;
             |FINSI;

             |SI #datfic0@#55 > nLimiteGral;  #datfic0@#55 = nLimiteGral;  |FINSI;
             |SI #datfic0@#55 < 0;            #datfic0@#55 = 0;            |FINSI;

             nRdtoCon18 = #datfic0@#55;

             #datfic0@#0 = #refere1@#0;
             #datfic0@#1 = #refere1@#1;
             #datfic0@#2 = "TITULAR   ";
             |LEE 101#datfic0@.=;
             |SI FSalida = 0;
                 #datfic0@#55 = nRdtoCon18;
                 |GRABA 020#datfic0@.a;
                 |LIBERA #datfic0@;

                 enSwAcum  = 0;
                 enBloque  = 31;
                 eaCasilla = "407";  enImporte = #datfic0@#55;   |HAZ GrabaLineal;
             |FINSI;

             |ABRE #datfic3@;
             #datfic3@#0 = #refere1@#0;
             #datfic3@#1 = #refere1@#1;
             #datfic3@#2 = "CONYUGE   ";
             #datfic3@#3 = 2;
             |LEE 101#datfic3@.=;
             |SI FSalida = 0;
                 nResto  = nRdtoCon18;
                 aAlfa   = #datfic3@#2;
                 |HAZ QuitaConyuge;

                 |GRABA 020#datfic3@.a;
                 |LIBERA #datfic3@;
             |FINSI;
             |CIERRA #datfic3@;
         |FINSI;
     |FINSI;

     |SI enConta = 2;
         nSuma        = nRdtoTit16;
         nPdte        = nSuma;
         |SI nSuma ! 0;  |Y nRdtoTit < 8000;
             |SI eaCalcP = "P";
                 |SI nRdtoCon ] 8000;
                     #datfic0@#55 = nPdte;
                     |SI #datfic0@#55 ] 2500;
                         #datfic0@#55 = (N\ 2500);
                     |FINSI;
                 |FINSI;
             |FINSI;

             |SI eaCalcP = "R";
                 #datfic0@#55 = (N\ nRdtoTit17);
                 |SI #datfic0@#55 ] 2500;
                     #datfic0@#55 = (N\ 2500);
                 |FINSI;
             |FINSI;

             |SI eaCalcP = "M";
                 #datfic0@#55 = (N\ enCalcP);
                 |SI #datfic0@#55 ] 2500;
                     #datfic0@#55 = (N\ 2500);
                 |FINSI;
                 |SI #datfic0@#55 ] nSuma;
                     #datfic0@#55 = (N\ nSuma);
                 |FINSI;
             |FINSI;

             |SI #datfic0@#55 > nLimiteGral;  #datfic0@#55 = nLimiteGral;  |FINSI;
             |SI #datfic0@#55 < 0;            #datfic0@#55 = 0;            |FINSI;

             nRdtoTit18 = #datfic0@#55;

             #datfic0@#0 = #refere1@#0;
             #datfic0@#1 = #refere1@#1;
             #datfic0@#2 = "CONYUGE   ";
             |LEE 101#datfic0@.=;
             |SI FSalida = 0;
                 #datfic0@#55 = nRdtoTit18;
                 |GRABA 020#datfic0@.a;
                 |LIBERA #datfic0@;

                 enSwAcum  = 0;
                 enBloque  = 31;
                 eaCasilla = "407";  enImporte = #datfic0@#55;   |HAZ GrabaLineal;
             |FINSI;

             |ABRE #datfic3@;
             #datfic3@#0 = #refere1@#0;
             #datfic3@#1 = #refere1@#1;
             #datfic3@#2 = "TITULAR   ";
             #datfic3@#3 = 1;
             |LEE 101#datfic3@.=;
             |SI FSalida = 0;
                 nResto  = nRdtoTit18;
                 aAlfa   = #datfic3@#2;
                 |HAZ QuitaConyuge;

                 |GRABA 020#datfic3@.a;
                 |LIBERA #datfic3@;
             |FINSI;
             |CIERRA #datfic3@;
         |FINSI;
     |FINSI;

     |SI enConta = 7;
         #datfic0@#0 = #refere1@#0;
         #datfic0@#1 = #refere1@#1;
         #datfic0@#2 = #refere1@#2;
         |LEE 101#datfic0@.=;
         |SI FSalida ! 0;
             |DDEFECTO #datfic0@;
             #datfic0@#0 = #refere1@#0;
             #datfic0@#1 = #refere1@#1;
             #datfic0@#2 = #refere1@#2;
             |GRABA 020#datfic0@.b;
         |FINSI;

         |SI nLimiteGral > 0;  |O eaCalcP = "M";
             #datfic0@#55  = (N\ nRdtoTit18  + nRdtoCon18);
         |SINO;
             #datfic0@#55      = 0;
             nRdtoTit18 = 0;
             nRdtoCon18 = 0;
         |FINSI;

         nPdte = #datfic0@#55;
         |SI nPdte > nLimiteGral;  |Y eaCalcP ! "M";
             #datfic0@#55 = nLimiteGral;
             |SI #datfic0@#55 < 0;  #datfic0@#55 = 0;  |FINSI;

             nResto  = #datfic0@#55;
             |SI nResto > 0;
                 |SI nRdtoTit18 > nResto;
                     nRdtoTit18 = nResto;
                     nRdtoCon18 = 0;
                     nResto     = 0;
                 |SINO;
                     nResto = nResto - nRdtoTit18;
                 |FINSI;

                 |SI nResto > 0;
                     |SI nRdtoCon18 > nResto;
                         nRdtoCon18 = nResto;
                     |FINSI;
                 |FINSI;
             |SINO;
                 nRdtoTit18 = 0;
                 nRdtoCon18 = 0;
             |FINSI;
         |FINSI;

         enSwAcum  = 0;
         enBloque  = 31;
         eaCasilla = "407";  enImporte = #datfic0@#55;   |HAZ GrabaLineal;

         |GRABA 020#datfic0@.a;
         |LIBERA #datfic0@;

         |ABRE #datfic3@;
         #datfic3@#0 = #refere1@#0;
         #datfic3@#1 = #refere1@#1;
         #datfic3@#2 = #refere1@#2;
         #datfic3@#3 = 1;
         |LEE 101#datfic3@.=;
         |SI FSalida = 0;
             nResto  = nRdtoTit18;
             aAlfa   = "TITULAR";
             |HAZ QuitaConyuge;

             |GRABA 020#datfic3@.a;
             |LIBERA #datfic3@;
         |FINSI;

         #datfic3@#0 = #refere1@#0;
         #datfic3@#1 = #refere1@#1;
         #datfic3@#2 = #refere1@#2;
         #datfic3@#3 = 2;
         |LEE 101#datfic3@.=;
         |SI FSalida = 0;
             nResto  = nRdtoCon18;
             aAlfa   = "CONYUGE";
             |HAZ QuitaConyuge;

             |GRABA 020#datfic3@.a;
             |LIBERA #datfic3@;
         |FINSI;

         |CIERRA #datfic3@;
     |FINSI;

     |SI enConta = 8;  |Y nLimiteGral > 0;
         #datfic0@#0 = #refere1@#0;
         #datfic0@#1 = #refere1@#1;
         #datfic0@#2 = #refere1@#2;
         |LEE 101#datfic0@.=;
         |SI FSalida ! 0;
             |DDEFECTO #datfic0@;
             #datfic0@#0 = #refere1@#0;
             #datfic0@#1 = #refere1@#1;
             #datfic0@#2 = #refere1@#2;
             |GRABA 020#datfic0@.b;
         |FINSI;

         |SI nLimiteGral > 0;
             |SI eaMuerto = "T";
                 #datfic0@#55 = (N\ nRdtoCon18);
                 nRdtoTit18 = 0;
             |SINO;
                 #datfic0@#55 = (N\ nRdtoTit18);
                 nRdtoCon18 = 0;
             |FINSI;
         |SINO;
             #datfic0@#55      = 0;
             nRdtoTit18 = 0;
             nRdtoCon18 = 0;
         |FINSI;

         nPdte = #datfic0@#55;
         |SI nPdte > nLimiteGral;
             #datfic0@#55 = nLimiteGral;
             |SI #datfic0@#55 < 0;  #datfic0@#55 = 0;  |FINSI;

             nResto  = #datfic0@#55;
             |SI nResto > 0;
                 |SI nRdtoTit18 > nResto;
                     nRdtoTit18 = nResto;
                     nRdtoCon18 = 0;
                     nResto     = 0;
                 |SINO;
                     nResto = nResto - nRdtoTit18;
                 |FINSI;

                 |SI nResto > 0;
                     |SI nRdtoCon18 > nResto;
                         nRdtoCon18 = nResto;
                     |FINSI;
                 |FINSI;
             |SINO;
                 nRdtoTit18 = 0;
                 nRdtoCon18 = 0;
             |FINSI;
         |FINSI;

         enSwAcum  = 0;
         enBloque  = 31;
         eaCasilla = "407";  enImporte = #datfic0@#55;   |HAZ GrabaLineal;

         |GRABA 020#datfic0@.a;
         |LIBERA #datfic0@;

         |ABRE #datfic3@;

         #datfic3@#0 = #refere1@#0;
         #datfic3@#1 = #refere1@#1;
         #datfic3@#2 = #refere1@#2;
         #datfic3@#3 = 1;
         |LEE 101#datfic3@.=;
         |SI FSalida = 0;
             nResto  = nRdtoTit18;
             aAlfa   = "TITULAR";
             |HAZ QuitaConyuge;

             |GRABA 020#datfic3@.a;
             |LIBERA #datfic3@;
         |FINSI;

         #datfic3@#0 = #refere1@#0;
         #datfic3@#1 = #refere1@#1;
         #datfic3@#2 = #refere1@#2;
         #datfic3@#3 = 2;
         |LEE 101#datfic3@.=;
         |SI FSalida = 0;
             nResto  = nRdtoCon18;
             aAlfa   = "CONYUGE";
             |HAZ QuitaConyuge;

             |GRABA 020#datfic3@.a;
             |LIBERA #datfic3@;
         |FINSI;

         |CIERRA #datfic3@;
     |FINSI;

     |CIERRA #datfic0@;

     |DESCARGA_DEF #datfic3@;
     |DESCARGA_DEF #datfic0@;
|FPRC;

|PROCESO CalculaPlan;
     |ABRE #rew99999;
     |SELECT #2#rew99999;
     #rew99999#1 = #refere1@#2;
     |LEE 040#rew99999.=;
     |SI FSalida  ! 0;  |DDEFECTO #rew99999;  |FINSI;
     |CIERRA #rew99999;

     enBloque = 1;  eaCasilla = "019"; |HAZ SacaImporte; nValor = enImporte;
     enBloque = 8;  eaCasilla = "216"; |HAZ SacaImporte; nValor = nValor + enImporte;

     nValor   = nValor +  #datfic2@#7  +  #datfic2@#11  + #datfic2@#13;

     |SI nValor [ 0;  nValor = 0;  |FINSI;

     nLimite = 8000;

     |SI #datfic1@#6 ! 0;  |Y #datfic1@#12 ! 0;
         nLimite = 13000;
     |FINSI;

     |SI #datfic1@#6 = 0;  |Y #datfic1@#12 ! 0;
         nLimite = 5000;
     |FINSI;

     nValor  = (nValor % 30) ! 2;
     |SI nValor > nLimite;
         nValor = nLimite;
     |FINSI;

     |SI #datfic1@#6  > 8000;   #datfic1@#6  = 8000;  |FINSI;
     |SI #datfic1@#10 > 5000;   #datfic1@#10 = 5000;  |FINSI;
     |SI #datfic1@#12 > 5000;   #datfic1@#12 = 5000;  |FINSI;

     |SI #datfic1@#7 > nValor;
         #datfic1@#7 = nValor;
     |FINSI;

     |SI #datfic1@#7 > nLimite;
         #datfic1@#7 = nLimite;
     |FINSI;
|FPRC;

|PROCESO CalculaI2;
     aDef    = eaPathDef + "rem01037.mas";
     |CARGA_DEF aDef, datfic1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic1@#"zdat1037"#;  |FINSI;

     aDef    = eaPathDef + "rem01018.mas";
     |CARGA_DEF aDef, datfic2@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |DESCARGA_DEF #datfic1@;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic2@#"zdat1018"#;  |FINSI;

     aDef    = eaPathDef + "rem01033.mas";
     |CARGA_DEF aDef, datfic3@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |DESCARGA_DEF #datfic2@;
         |DESCARGA_DEF #datfic1@;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic3@#"zdat1033"#;  |FINSI;

     |ABRE #datfic1@;
     |ABRE #datfic2@;
     |ABRE #datfic3@;

     #datfic3@#0 = #refere1@#0;
     #datfic3@#1 = #refere1@#1;
     #datfic3@#2 = #refere1@#2;
     |LEE 101#datfic3@.=;
     |SI FSalida ! 0;
         |DDEFECTO #datfic3@;
         #datfic3@#0 = #refere1@#0;
         #datfic3@#1 = #refere1@#1;
         #datfic3@#2 = #refere1@#2;
         |GRABA 020#datfic3@.b;
     |FINSI;

     |SI enConta = 1;
         #datfic1@#0 = #refere1@#0;
         #datfic1@#1 = #refere1@#1;
         #datfic1@#2 = #refere1@#2;
         #datfic1@#3 = 1;
         |LEE 101#datfic1@.=;
         |SI FSalida ! 0;
             |DDEFECTO #datfic1@;
             #datfic1@#0 = #refere1@#0;
             #datfic1@#1 = #refere1@#1;
             #datfic1@#2 = #refere1@#2;
             #datfic1@#3 = 1;
             |GRABA 020#datfic1@.b;
         |FINSI;

         #datfic2@#0 = #refere1@#0;
         #datfic2@#1 = #refere1@#1;
         #datfic2@#2 = #refere1@#2;
         |LEE 000#datfic2@.=;
         |SI FSalida ! 0;  |DDEFECTO #datfic2@;  |FINSI;

         |SI #datfic1@#8 ! "N";  |Y eaCalcP = "";
             eaCalcP = #datfic1@#8;  |QBF eaCalcP;
             enCalcP = #datfic1@#9;
         |FINSI;

         |HAZ CalculaPlan;

         n401T = #datfic1@#5;
         n402T = #datfic1@#10;
         n403T = #datfic1@#6;
         n404T = #datfic1@#12;
         n405T = #datfic1@#7;

         |GRABA 020#datfic1@.a;
         |LIBERA #datfic1@;

         #datfic3@#52 = #datfic1@#7;

         enBloque = 8;  eaCasilla = "216"; |HAZ SacaImporte;

         nRdtoTit16 = #datfic1@#5 + #datfic1@#10 + #datfic1@#6 + #datfic1@#12;
         nRdtoTit17 = (#datfic1@#5 + #datfic1@#10 + #datfic1@#6 + #datfic1@#12) - #datfic1@#7;
         nRdtoTit   = #datfic2@#15  + #datfic2@#7  +  #datfic2@#11  + #datfic2@#13 + enImporte;
     |FINSI;

     |SI enConta = 2;
         #datfic1@#0 = #refere1@#0;
         #datfic1@#1 = #refere1@#1;
         #datfic1@#2 = #refere1@#2;
         #datfic1@#3 = 2;
         |LEE 101#datfic1@.=;
         |SI FSalida ! 0;
             |DDEFECTO #datfic1@;
             #datfic1@#0 = #refere1@#0;
             #datfic1@#1 = #refere1@#1;
             #datfic1@#2 = #refere1@#2;
             #datfic1@#3 = 2;
             |GRABA 020#datfic1@.b;
         |FINSI;

         #datfic2@#0 = #refere1@#0;
         #datfic2@#1 = #refere1@#1;
         #datfic2@#2 = #refere1@#2;
         |LEE 000#datfic2@.=;
         |SI FSalida ! 0;  |DDEFECTO #datfic2@;  |FINSI;

         |SI #datfic1@#8 ! "N";  |Y eaCalcP = "";
             eaCalcP = #datfic1@#8;  |QBF eaCalcP;
             enCalcP = #datfic1@#9;
         |FINSI;

         |HAZ CalculaPlan;

         n401C = #datfic1@#5;
         n402C = #datfic1@#10;
         n403C = #datfic1@#6;
         n404C = #datfic1@#12;
         n405C = #datfic1@#7;

         |GRABA 020#datfic1@.a;
         |LIBERA #datfic1@;

         #datfic3@#52 = #datfic1@#7;

         enBloque = 8;  eaCasilla = "216"; |HAZ SacaImporte;

         nRdtoCon16 = #datfic1@#5 + #datfic1@#10 + #datfic1@#6 + #datfic1@#12;
         nRdtoCon17 = (#datfic1@#5 + #datfic1@#10 + #datfic1@#6 + #datfic1@#12) - #datfic1@#7;
         nRdtoCon   = #datfic2@#15  + #datfic2@#7  +  #datfic2@#11  + #datfic2@#13 + enImporte;
     |FINSI;

     |SI enConta = 7;
         #datfic1@#0 = #refere1@#0;
         #datfic1@#1 = #refere1@#1;
         #datfic1@#2 = #refere1@#2;
         #datfic1@#3 = 1;
         |LEE 101#datfic1@.=;
         |SI FSalida = 0;
             #datfic1@#5  = n401T;
             #datfic1@#10 = n402T;
             #datfic1@#6  = n403T;
             #datfic1@#12 = n404T;
             #datfic1@#7  = n405T;

             |GRABA 020#datfic1@.a;
             |LIBERA #datfic1@;
         |FINSI;

         #datfic1@#0 = #refere1@#0;
         #datfic1@#1 = #refere1@#1;
         #datfic1@#2 = #refere1@#2;
         #datfic1@#3 = 2;
         |LEE 101#datfic1@.=;
         |SI FSalida = 0;
             #datfic1@#5  = n401C;
             #datfic1@#10 = n402C;
             #datfic1@#6  = n403C;
             #datfic1@#12 = n404C;
             #datfic1@#7  = n405C;

             |GRABA 020#datfic1@.a;
             |LIBERA #datfic1@;
         |FINSI;

         #datfic3@#52 = n405T + n405C;
     |FINSI;

     |SI enConta = 8;
         |SI eaMuerto = "T";
             #datfic1@#0 = #refere1@#0;
             #datfic1@#1 = #refere1@#1;
             #datfic1@#2 = #refere1@#2;
             #datfic1@#3 = 2;
             |LEE 101#datfic1@.=;
             |SI FSalida = 0;
                 #datfic1@#5  = n401C;
                 #datfic1@#10 = n402C;
                 #datfic1@#6  = n403C;
                 #datfic1@#12 = n404C;
                 #datfic1@#7  = n405C;
                 |GRABA 020#datfic1@.a;
                 |LIBERA #datfic1@;
             |FINSI;

             #datfic3@#52 = n405C;
         |SINO;
             #datfic1@#0 = #refere1@#0;
             #datfic1@#1 = #refere1@#1;
             #datfic1@#2 = #refere1@#2;
             #datfic1@#3 = 1;
             |LEE 101#datfic1@.=;
             |SI FSalida = 0;
                 #datfic1@#5  = n401T;
                 #datfic1@#10 = n402T;
                 #datfic1@#6  = n403T;
                 #datfic1@#12 = n404T;
                 #datfic1@#7  = n405T;

                 |GRABA 020#datfic1@.a;
                 |LIBERA #datfic1@;
              |FINSI;

             #datfic3@#52 = n405T;
         |FINSI;
     |FINSI;

     |GRABA 020#datfic3@.a;
     |LIBERA #datfic3@;

     enSwAcum  = 0;
     enBloque  = 31;
     eaCasilla = "406";  enImporte = #datfic3@#52;   |HAZ GrabaLineal;

     |CIERRA #datfic1@;
     |CIERRA #datfic2@;
     |CIERRA #datfic3@;

     |DESCARGA_DEF #datfic3@;
     |DESCARGA_DEF #datfic2@;
     |DESCARGA_DEF #datfic1@;
|FPRC;

|PROCESO CalculaI1;
     |SI enConta ! 7;  |Y enConta ! 8;
         |ACABA;
     |FINSI;

     aDef    = eaPathDef + "rem00100.mas";
     |CARGA_DEF aDef, datfic0@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     aDef    = eaPathDef + "rem01033.mas";
     |CARGA_DEF aDef, datfic1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |DESCARGA_DEF #datfic0@;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #datfic1@#"zdat1033"#;  |FINSI;

     |ABRE #datfic0@;
     #datfic0@#0 = #refere1@#0;
     |LEE 040#datfic0@.=;
     |SI FSalida ! 0;  |DDEFECTO #datfic0@;  |FINSI;
     |CIERRA #datfic0@;

     |ABRE #datfic1@;

     #datfic1@#0 = #refere1@#0;
     #datfic1@#1 = #refere1@#1;
     #datfic1@#2 = #refere1@#2;
     |LEE 101#datfic1@.=;
     |SI FSalida ! 0;
         |DDEFECTO #datfic1@;
         #datfic1@#0 = #refere1@#0;
         #datfic1@#1 = #refere1@#1;
         #datfic1@#2 = #refere1@#2;
         |GRABA 020#datfic1@.b;
     |FINSI;

     #datfic1@#51 = 0;
     |SI enConta ! 8;
        |SI #datfic0@#6 = "C";
            #datfic1@#51 = 3400;
        |SINO;
            |SI #datfic0@#95 ! "S";
                #datfic1@#51 = 2150;
            |FINSI;
        |FINSI;
     |SINO;
        #datfic1@#51 = 2150;
     |FINSI;

     |GRABA 020#datfic1@.a;
     |LIBERA #datfic1@;
     |CIERRA #datfic1@;

     enSwAcum  = 0;
     enBloque  = 30;
     eaCasilla = "399";  enImporte = #datfic1@#51;   |HAZ GrabaLineal;

     |DESCARGA_DEF #datfic1@;
     |DESCARGA_DEF #datfic0@;
|FPRC;
