|FICHEROS;
    camaasic #1;
    camaasil #2;
    caditra1 #3;
    cacuenta #4;
|FIN;

|VARIABLES;
    sw_alguno = 0;
    m_orden   = 1;
    d_iva     = "";
    f_iva     = @;
|FIN;

|PROCESO alguno;
 |SI #2#6 ] #0#9;|Y #2#6 [ #0#10;    || comprueba si hay algun apunte
     sw_alguno = 1;                  || valido en el apunte
 |FINSI;
|FPRC;

|PROCESO porpan;

 |SI #2#6 ] #0#9;|Y #2#6 [ #0#10;
     sw_alguno = 1;
     |SI lin > 1000;
         sw_desc = 0;
         |HAZ cambiapa;
     |FINSI;
     #3#0 = #2#1;
     #3#1 = #2#0;
     #3#2 = #1#3;
     #3#3 = #2#2;
     #3#4 = #2#4;
     #3#5 = #2#6;
     #3#6 = #2#7;
     #3#7 = #2#8;
     |SI #3#7 = "D";
         #3#8 = #2#9;          || debe
         #3#16 = 0;             || haber
     |SINO;
         #3#8 = 0;
         #3#16 = #2#9;
     |FINSI;
     #3#9 = #2#10;

     |SI #2#8 = "D";
         #3#10 = #3#10 + #2#9;
         #3#13 = #3#13 + #2#9;
     |SINO;
         #3#11 = #3#11 + #2#9;
         #3#14 = #3#14 + #2#9;
     |FINSI;
     #3#12 = #3#10 - #3#11;
     #3#15 = #3#13 - #3#14;

     |SI d_iva = "S";
         |HAZ delIVA;
     |FINSI;
|| |SINO;
         |ATRI I;
         |PINTA 0628, #3#0;
         |PINTA 0616, #3#1;
         |PINTA 0670, #3#2;
         |PINTA 0652, #3#3;
         |ATRI 0;
         Pos = lin;
         |PINDA #0#3;
         Pos = -1;
         |ATRI I;
         |PINTA 2126, #3#10;
         |PINTA 2146, #3#11;
         |PINTA 2166, #3#12;
         |PINTA 2226, #3#13;
         |PINTA 2246, #3#14;
         |PINTA 2266, #3#15;
         |ATRI 0;
         lin = lin + 100;
   ||  |FINSI;
 |FINSI;
|FPRC;

|PROCESO delIVA;
  f_iva = "";
  |SI #2#12 = "R";
      |SI #2#19 = "F"; |O #2#19 = "f";
          |ABRE #15;
          #15#0  = #2#13;
          #15#2  = #2#14;
          #15#27 = #2#15;
          |LEE 001#15=;
          |SI FSalida = 0;
              f_iva = #15#3;
          |FINSI;
          |CIERRA #15;
      |FINSI;
  |FINSI;
  |SI #2#12 = "S";
      |SI #2#19 = "F"; |O #2#19 = "f";
          |ABRE #16;
          #16#0  = #2#13;
          #16#2  = #2#14;
          #16#27 = #2#15;
          |LEE 001#16=;
          |SI FSalida = 0;
              f_iva = #16#3;
          |FINSI;
          |CIERRA #16;
      |FINSI;
  |FINSI;
  #3#17 = f_iva;
|FPRC;

|PROCESO buclepan;
 sw_alguno = 0;
 |BUCLELIN 0porpan#1;
 |SI sw_alguno ! 0;
     |SI #3#12 ! 0;
         sw_desc = 1;
     |SINO;
         sw_desc = 0;
     |FINSI;
     |HAZ cambiapa;
     #3#10 = 0;
     #3#11 = 0;
     #3#12 = 0;
 |FINSI;
|FPRC;

|DEFBUCLE caditrab1;
 #1#2;
 ;
 #0#0, #0#4, #0#7, #0#2;
 #0#1, #0#5, #0#8, #0#3;
 e;
 NULL, buclepan;
|FIN;

|DEFBUCLE caditrab2;
 #1#1;
 3;
 #0#7, #0#4, #0#2, #0#0;
 #0#8, #0#5, #0#3, #0#1;
 e;
 NULL, buclepan;
|FIN;

|DEFBUCLE caditrab3;
 #1#3;
 3,1,0;
 #0#2, #0#2,  #0#0, #0#4, #0#7;
 #0#3, #0#3,  #0#1, #0#5, #0#8;
 e;
 NULL, buclepan;
|FIN;

|PROCESO pantalla;
  lin = 100;
  |SI d_iva = "S";
      |PINPA #1#3;
      |C_P #3#4, 1, 1002;
      |C_P #3#5, 1, 1015;
      |C_P #3#6, 1, 1018; |C_A #3#6, 1, 25;
      |C_P #3#8, 1, 1057;
      |C_P #3#16, 1, 1069;
      |C_V #3#17, 1, "S";
  |SINO;
      |PINPA #0#3;
      |C_P #3#4, 1, 1006;
      |C_P #3#5, 1, 1019;
      |C_P #3#6, 1, 1022; |C_A #3#6, 1, 80;
      |C_P #3#8, 1, 1053;
      |C_P #3#16, 1, 1065;
      |C_V #3#17, 1, "N";
  |FINSI;
  |SI m_orden = 1; |BUCLE caditrab1; |FINSI;
  |SI m_orden = 2; |BUCLE caditrab2; |FINSI;
  |SI m_orden = 3; |BUCLE caditrab3; |FINSI;
|FPRC;

|PROCESO cambiapa;
 |SI sw_desc = 1;
     |AVISO;
     |AVISO;
     |ATRI P;
     |PINTA 0430,"===  DESCUADRE ===";
     |ATRI 0;
 |FINSI;
 |PAUSA;
 |SI FSalida = 1; |O FSalida = 7;
    |ERROR10;
 |FINSI;
 |ATRI R; |BLIN 04; |ATRI 0;

 |SI d_iva = "S";
     |PINPA #1#3;
 |SINO;
     |PINPA #0#3;
 |FINSI;
 lin = 100;
|FPRC;

|PROCESO borrar;
|DDEFECTO #3;
|FPRC;

|PROCESO inicial; |TIPO 7;
 |HAZ inicio;
 #0#4 = fec1;
 #0#5 = fec2;
 |PINTA #0#4;
 |PINTA #0#5;
|FPRC;

|PROCESO fechad;
 |SI #0#4 < fec1; |O #0#4 > fec2;
     |MENAV mensa1;
     |ERROR;
     |ACABA;
 |FINSI;
|FPRC;

|PROCESO fechah;
 |SI #0#5 < fec1; |O #0#5 > fec2; |O #0#5 < #0#4;
     |MENAV mensa1;
     |ERROR;
     |ACABA;
 |FINSI;
|FPRC;
