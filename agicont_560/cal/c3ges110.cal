|FICHEROS;
     c3ges110 #00;
     catra115 #1;
     caivasop #2;
     caclipro #4;
     caprovin #6;
     caman110 #11;
     eosclipr #12;
     cacongru #13;
     canempre #30;
     agicontr #23;
|FIN;

|VARIABLES;
     nCampo    = 0;
     nCampo1   = 0;
     nCampo2   = 0;
     aSiNo1    = "";
     aSiNo2    = "";
     aTipo     = "";
     nParrilla = 0;
     nSumaO    = 0;
     nSumaD    = 0;

     desde = 0;
     hasta = 0;

     x      = 0;
     direcc = "";
     linea  = 0;
     sien   = 0;
     alfa1   = "";
     alfa2   = "";
     alfa3   = "";
     alfa4   = "";
     lonagi  = "";
     longi   = 0;
     nume1   = 0;
     nume2   = 0;
     nume3   = 0;
     nume4   = 0;

     fech1 = @;
     fech2 = @;

     totbas = 0;
     swgr = 0;
     grupo = 0;
     concepto = 0;
     swclipro = 0;

     agi = "";
     &agi1 = "";
     &agi2 = "";
     &aste = "";
     num = 0;

     ult_cont = 0;
     cclau    = "";
     ccc      = 0;
     nif      = "";
     campobas1 = 0;
     camporet1 = 0;
     campobas2 = 0;
     camporet2 = 0;
     retencion = 0;
     campobas3 = 0;
     camporet3 = 0;
     meses     = 0;
     cta       = "";
     dig       = 0;
     traba     = "";

     i_cm1     = 79;
|FIN;

|INCLUYE acceso_i;
|INCLUYE multie_i;
|INCLUYE tempo_i;


|| ******************************************************************
||PROCESOS DE LA PANTALLA
|| ****************************************************************

|PROCESO mayor;
  #0Campo = #0Campo > #0Campo;
  |PINTA #0Campo;
|FPRC;

|PROCESO SaltaAgru;
      aSiNo1 = "S";
      aSiNo2 = #0Campo;
      |SI #0Campo = "S";  aSiNo1 = "N";  |FINSI;

      nCampo  = Campo - 3;  |C_M #0nCampo, 1, aSiNo1;
      nCampo  = Campo - 2;  |C_M #0nCampo, 1, aSiNo1;
      nCampo  = Campo - 1;  |C_M #0nCampo, 1, aSiNo1;

      nCampo1 = Campo + 1;
      nCampo2 = Campo + 4;
      |PARA nCampo = nCampo1; |SI nCampo [ nCampo2;  |HACIENDO nCampo = nCampo + 1;
            |C_M #0nCampo, 1, aSiNo2;
      |SIGUE;

      nCampo1 = Campo + 5;
      nCampo2 = Campo + 14;
      |PARA nCampo = nCampo1; |SI nCampo [ nCampo2;  |HACIENDO nCampo = nCampo + 1;
            |C_M #0nCampo, 1, aSiNo1;
      |SIGUE;

      |SI #0Campo = "S";
          nCampo1 = Campo - 3;
          nCampo2 = Campo;
          |PDEFECTO #0, nCampo1, nCampo2;

          nCampo1 = Campo + 5;
          nCampo2 = Campo + 15;
          |PDEFECTO #0, nCampo1, nCampo2;
      |SINO;
          nCampo1 = Campo + 1;
          nCampo2 = Campo + 5;
          |PDEFECTO #0, nCampo1, nCampo2;
      |FINSI;

      |PINDA #0#0;
|FPRC;

|PROCESO SaltaConce;
      nCampo = Campo + 3;
      |SI #0nCampo = "S";  |ACABA;  |FINSI;

      aSiNo1 = "S";
      aSiNo2 = #0Campo;
      |SI #0Campo = "S";  aSiNo1 = "N";  |FINSI;

      nCampo  = Campo + 1;  |C_M #0nCampo, 1, aSiNo2;
      nCampo  = Campo + 2;  |C_M #0nCampo, 1, aSiNo2;

      nCampo1 = Campo + 8;
      nCampo2 = Campo + 17;
      |PARA nCampo = nCampo1; |SI nCampo [ nCampo2;  |HACIENDO nCampo = nCampo + 1;
            |C_M #0nCampo, 1, aSiNo1;
      |SIGUE;

      |SI #0Campo = "S";
          nCampo1 = Campo + 8;
          nCampo2 = Campo + 18;
          |PDEFECTO #0, nCampo1, nCampo2;
      |SINO;
          nCampo1 = Campo + 1;
          nCampo2 = Campo + 3;
          |PDEFECTO #0, nCampo1, nCampo2;
      |FINSI;

      |PINDA #0#0;
|FPRC;


|| ****************************************************************

|PROCESO tipo_8; || controlar si existe ficha clientes
     |DIRECTORIO agi;
     |QBF agi;
     |PATH_DAT #23 agi;
     |ABRE #23;
     #23#0 = 1;
     |LEE 040#23=;
     |SI FSalida ! 0; aste = "*"; |CIERRA #23; |ACABA; |FINSI;
     |CIERRA #23;
     aste = #23#7;
     |QBF aste;
     |SI aste  = "*"; |ACABA; |FINSI;
     agi1 = #23#8; |QBF agi1;
     lonagi = agi1 % 0;
     num   = lonagi;
     num   = 100 + (num - 5);
     lonagi = num;
     agi2  = (agi1 % lonagi) + "pan/";
     |PATH_DAT #12 agi1;

     |HAZ inicio;
     any = #30#26;
     |HAZ coloca;
     #0#2 = any;
|FPRC;

|| ***********************************************************************
|| BORRA ACUMULADOS
|| ***********************************************************************

|PROCESO acero;
    |PARA meses = desde; |SI meses [ hasta;  |HACIENDO meses = meses + 1;
          campobas1 = meses + 22;
          camporet1 = meses + 35;
          campobas2 = meses + 48;
          camporet2 = meses + 61;
          campobas3 = meses + 74;
          camporet3 = meses + 87;
          #11#35  = #11#35  - #11campobas1;
          #11#48  = #11#48  - #11camporet1;
          #11#61  = #11#61  - #11campobas2;
          #11#74  = #11#74  - #11camporet2;
          #11#87  = #11#87  - #11campobas3;
          #11#100 = #11#100 - #11camporet3;
          #11campobas1 = 0;  || total bases  1
          #11camporet1 = 0;  || total reten. 1
          #11campobas2 = 0;  || total bases  2
          #11camporet2 = 0;  || total reten. 2
          #11campobas3 = 0;  || total bases  3
          #11camporet3 = 0;  || total reten. 3
    |SIGUE;

    ult_cont = #11#1;
    |GRABA 020#11a;
    |LIBERA #11;
|FPRC;

|DEFBUCLE caman110B;
    #11#1;
    ;
    #0#0, 00001, #0#2;
    #0#0, 99999, #0#2;
    be;
    NULL, acero;
|FIN;

|| ***********************************************************************
|| ********************* CREAR FICHERO DE TRABAJO ************************
|| ***********************************************************************
|| ............... ver grupo;

|PROCESO vergrupo;
     swgr = 0;
     |ABRE #13;
     #13#0 = grupo;
     |LEE 001#13=;
     |SI FSalida = 0;
         |PARA x = 2; |SI x [ 21; |HACIENDO x = x + 1;
               |SI #13x  = concepto;
                   swgr = 1;
                   |SAL;
                |FINSI;
         |SIGUE;
     |FINSI;
     |CIERRA #13;
|FPRC;

|| ---------------------------------------------------

|PROCESO LetraG;
     aTipo = "G";

     |SI #0#9 = "S";
         swgr = 0; concepto = #2#6;
         |SI #0#10 ! 0;              grupo = #0#10; |HAZ vergrupo; |FINSI;
         |SI #0#11 ! 0; |Y swgr = 0; grupo = #0#11; |HAZ vergrupo; |FINSI;
         |SI #0#12 ! 0; |Y swgr = 0; grupo = #0#12; |HAZ vergrupo; |FINSI;
         |SI #0#13 ! 0; |Y swgr = 0; grupo = #0#13; |HAZ vergrupo; |FINSI;
         |SI swgr = 1;               sien = 1;                     |FINSI;
     |SINO;
         |SI #0#6 = "S";
             |SI #2#6 ] #0#7;  |Y #2#6 [ #0#8;
                 sien = 1;
             |FINSI;
         |SINO;
             sien = 0;
             |PARA desde = 14;  |SI desde [ 23;  |HACIENDO desde = desde + 1;
                   |SI #0desde = 0;  |SAL;  |FINSI;
                   |SI #2#6 = #0desde;
                       sien = 1;
                       |SAL;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO LetraH;
     aTipo = "H";

     |SI #0#27 = "S";
         swgr = 0; concepto = #2#6;
         |SI #0#28 ! 0;              grupo = #0#28; |HAZ vergrupo; |FINSI;
         |SI #0#29 ! 0; |Y swgr = 0; grupo = #0#29; |HAZ vergrupo; |FINSI;
         |SI #0#30 ! 0; |Y swgr = 0; grupo = #0#30; |HAZ vergrupo; |FINSI;
         |SI #0#31 ! 0; |Y swgr = 0; grupo = #0#31; |HAZ vergrupo; |FINSI;
         |SI swgr = 1;               sien = 1;                     |FINSI;
     |SINO;
         |SI #0#24 = "S";
             |SI #2#6 ] #0#25;  |Y #2#6 [ #0#26;
                 sien = 1;
             |FINSI;
         |SINO;
             sien = 0;
             |PARA desde = 32;  |SI desde [ 41;  |HACIENDO desde = desde + 1;
                   |SI #0desde = 0;  |SAL;  |FINSI;
                   |SI #2#6 = #0desde;
                       sien = 1;
                       |SAL;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO LetraK;
     aTipo = "K";

     |SI #0#45 = "S";
         swgr = 0; concepto = #2#6;
         |SI #0#46 ! 0;              grupo = #0#46; |HAZ vergrupo; |FINSI;
         |SI #0#47 ! 0; |Y swgr = 0; grupo = #0#47; |HAZ vergrupo; |FINSI;
         |SI #0#48 ! 0; |Y swgr = 0; grupo = #0#48; |HAZ vergrupo; |FINSI;
         |SI #0#49 ! 0; |Y swgr = 0; grupo = #0#49; |HAZ vergrupo; |FINSI;
         |SI swgr = 1;               sien = 1;                     |FINSI;
     |SINO;
         |SI #0#42 = "S";
             |SI #2#6 ] #0#43;  |Y #2#6 [ #0#44;
                 sien = 1;
             |FINSI;
         |SINO;
             sien = 0;
             |PARA desde = 50;  |SI desde [ 59;  |HACIENDO desde = desde + 1;
                   |SI #0desde = 0;  |SAL;  |FINSI;
                   |SI #2#6 = #0desde;
                       sien = 1;
                       |SAL;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO LetraL;
     aTipo = "L";

     |SI #0#63 = "S";
         swgr = 0; concepto = #2#6;
         |SI #0#64 ! 0;              grupo = #0#64; |HAZ vergrupo; |FINSI;
         |SI #0#65 ! 0; |Y swgr = 0; grupo = #0#65; |HAZ vergrupo; |FINSI;
         |SI #0#66 ! 0; |Y swgr = 0; grupo = #0#66; |HAZ vergrupo; |FINSI;
         |SI #0#67 ! 0; |Y swgr = 0; grupo = #0#67; |HAZ vergrupo; |FINSI;
         |SI swgr = 1;               sien = 1;                     |FINSI;
     |SINO;
         |SI #0#60 = "S";
             |SI #2#6 ] #0#61;  |Y #2#6 [ #0#62;
                 sien = 1;
             |FINSI;
         |SINO;
             sien = 0;
             |PARA desde = 68;  |SI desde [ 77;  |HACIENDO desde = desde + 1;
                   |SI #0desde = 0;  |SAL;  |FINSI;
                   |SI #2#6 = #0desde;
                       sien = 1;
                       |SAL;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO sumacomp;
     sien  = 0;
     aTipo = "";
     |SI #2#63 = 0;  |ACABA;  |FINSI;

                    |HAZ LetraG;
     |SI sien = 0;  |HAZ LetraH;  |FINSI;
     |SI sien = 0;  |HAZ LetraK;  |FINSI;
     |SI sien = 0;  |HAZ LetraL;  |FINSI;

     |SI sien = 0;  |ACABA;       |FINSI;

     |SI #0#5 = "S";
         cclau = #2#51;
     |SINO;
         alfa2 = #2#5; |QBF alfa2;
         alfa2 = ("0" + alfa2) % -101;
         alfa1 = #2#4;
         alfa1 = (alfa1 + "            ") % 112;
         cclau = alfa1 + alfa2;
     |FINSI;

     #1#0 = #0#0;
     #1#7 = cclau;
     |LEE 101#1=;
     |SI FSalida ! 0;
         |DDEFECTO #1;
         #1#0   = #0#0;
         #1#127 = #2#4 + #2#5;
         #1#3   = #2#50;
         #1#7   = cclau;
         |GRABA 020#1b;
     |FINSI;

     alfa1 = #2#3;
     alfa1 = alfa1 % 0402;
     nume1 = alfa1;

     |SI #1#12 = " ";  |O #1#12 = aTipo;
         #1#12 = aTipo;
         campobas1 = nume1 + 22;
         camporet1 = nume1 + 35;
         #1#9      = #2#62;
     |SINO;
         |SI #1#13 = " ";  |O #1#13 = aTipo;
             #1#13 = aTipo;
             campobas1 = nume1 + 48;
             camporet1 = nume1 + 61;
             #1#10     = #2#62;
         |SINO;
             |SI #1#14 = " ";  |O #1#14 = aTipo;
                 #1#14 = aTipo;
                 campobas1 = nume1 + 74;
                 camporet1 = nume1 + 87;
                 #1#11     = #2#62;
             |SINO;
                 |MENAV "    EXISTEN MAS DE TRES TIPOS ";
             |FINSI;
         |FINSI;
     |FINSI;

     #1campobas1 = #1campobas1 + #2#65;
     #1camporet1 = #1camporet1 + #2#63;

     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE compras;
     #2#1;
     3, 64;
     00, 000001, "  ", fech1, "N";
     99, 999999, "zz", fech2, "N";
     ;
     NULL, sumacomp;
|FIN;

|| ***********************************************************************
|| ****************** CREAR FICHERO DE MODELO 115 ************************
|| ***********************************************************************
|PROCESO encuentra;
     ccc = #11#1;
     |ERROR10;
|FPRC;

|DEFBUCLE caman110E;
     #11#2;
     0,134;
     cclau, #0#0, #0#2;
     cclau, #0#0, #0#2;
     be;
     NULL, encuentra;
|FIN;

|| ........ Lecturas de clientes / proveedores
|PROCESO leepro;
 nif = "";
 #4#23 = "P";
 |HAZ clipro;
 |SI swclipro = 0;
     #4#23 = "C";
     |HAZ clipro;
 |FINSI;
 |SI swclipro = 1;
     nif = #4#9;      ||dni
 |FINSI;
|FPRC;

|PROCESO clipro;
  swclipro = 0;
  #4#10 = cta;
  #4#11 = dig;
  |LEE 001#4=;
  |SI FSalida = 0;
      swclipro = 1;
  |FINSI;
|FPRC;

|PROCESO leeclipro;
     #4#23 = "C";
     |HAZ clipro;
     |SI swclipro = 0;
         #4#23 = "P";
         |HAZ clipro;
     |FINSI;
     #11#7   = cclau;
     #11#2   = #0#1;      ||nombre Empresa

     #11#3   = #1#3;      ||nombre
     |SI swclipro = 1; || lee el nombre del Plan Contable
          #11#7   = #4#9;      ||dni
          #11#3   = #4#1;      ||nombre
          #11#127 = #4#2;      || Domicilio
          #11#5   = #4#3;  || C.P.1
          #11#6   = #4#4;  || C.P.2
          #11#4   = #4#6;  || Localidad
          #11#132 = #4#5;  || Provincia
     |FINSI;
|FPRC;
|| ----------------------------------------------------
|PROCESO datospro;
     |SI aste = "*";
          |HAZ leeclipro;
          |ACABA;
     |FINSI;

     #12#0 = cclau;
     |LEE 001#12=;
     |SI FSalida = 0;
         #11#7 = #12#0;      || Nif
         #11#3 = #12#1;      || Nombre
         traba = #12#2;     || SG
         |QBF traba;
         |SI traba = "";
             #11#127 = #12#3;   || Domicilio
         |SINO;
             #11#127 = traba + " " + #12#3; || Sg. + Domicilio
         |FINSI;
         #11#128 = #12#4;  || Numero
         #11#130 = #12#5;  || Piso
         #11#131 = #12#6;  || Puerta
         #11#5   = #12#7;  || C.P.1
         #11#6   = #12#8;  || C.P.2
         #11#4   = #12#10; || Localidad
         #11#132 = #12#9;  || Provincia
     |SINO;
         |HAZ leeclipro;
     |FINSI;
|FPRC;

|PROCESO Acumulados;
     nSumaO = 0;
     nSumaD = 0;
     |SI aTipo = #11#12;
         nSumaO = 22;
         |SI nParrilla = 1; nSumaD = 22;  |FINSI;
         |SI nParrilla = 2; nSumaD = 48;  |FINSI;
         |SI nParrilla = 3; nSumaD = 74;  |FINSI;
     |SINO;
         |SI aTipo = #11#13;
             nSumaO = 48;
             |SI nParrilla = 1; nSumaD = 22;  |FINSI;
             |SI nParrilla = 2; nSumaD = 48;  |FINSI;
             |SI nParrilla = 3; nSumaD = 74;  |FINSI;
         |SINO;
             |SI aTipo = #11#14;
                 nSumaO = 74;
                 |SI nParrilla = 1; nSumaD = 22;  |FINSI;
                 |SI nParrilla = 2; nSumaD = 48;  |FINSI;
                 |SI nParrilla = 3; nSumaD = 74;  |FINSI;
             |SINO;
                 |SI #11#12 = " ";
                     #11#12 = aTipo;
                     nSumaO = 22;
                     |SI nParrilla = 1; nSumaD = 22;  |FINSI;
                     |SI nParrilla = 2; nSumaD = 48;  |FINSI;
                     |SI nParrilla = 3; nSumaD = 74;  |FINSI;
                 |SINO;
                     |SI #11#13 = " ";
                         #11#13 = aTipo;
                         nSumaO = 48;
                         |SI nParrilla = 1; nSumaD = 22;  |FINSI;
                         |SI nParrilla = 2; nSumaD = 48;  |FINSI;
                         |SI nParrilla = 3; nSumaD = 74;  |FINSI;
                    |SINO;
                         |SI #11#14 = " ";
                             #11#14 = aTipo;
                             nSumaO = 74;
                             |SI nParrilla = 1; nSumaD = 22;  |FINSI;
                             |SI nParrilla = 2; nSumaD = 48;  |FINSI;
                             |SI nParrilla = 3; nSumaD = 74;  |FINSI;
                         |FINSI;
                    |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSumaO = 0; |Y nSumaD = 0;
         |ACABA;
     |FINSI;

     |PARA meses = 1; |SI meses [ 12;  |HACIENDO meses = meses + 1;
           campobas1 = meses +  nSumaO;
           camporet1 = meses +  nSumaO + 13;

           campobas2 = meses +  nSumaD;
           camporet2 = meses +  nSumaD + 13;

           #11campobas1 = #11campobas1 + #1campobas2;  || total bases  1
           #11camporet1 = #11camporet1 + #1camporet2;  || total reten. 1
     |SIGUE;

     |SI nSumaO = 22;
         |SI nSumaD = 22;  #11#9  = #1#9;   |FINSI;
         |SI nSumaD = 48;  #11#9  = #1#10;  |FINSI;
         |SI nSumaD = 74;  #11#9  = #1#11;  |FINSI;
     |FINSI;

     |SI nSumaO = 48;
         |SI nSumaD = 22;  #11#10  = #1#9;   |FINSI;
         |SI nSumaD = 48;  #11#10  = #1#10;  |FINSI;
         |SI nSumaD = 74;  #11#10  = #1#11;  |FINSI;
     |FINSI;

     |SI nSumaO = 74;
         |SI nSumaD = 22;  #11#11  = #1#9;   |FINSI;
         |SI nSumaD = 48;  #11#11  = #1#10;  |FINSI;
         |SI nSumaD = 74;  #11#11  = #1#11;  |FINSI;
     |FINSI;

     #11#35 = 0;
     |PARA nCampo = 23;  |SI nCampo [ 34;  |HACIENDO nCampo = nCampo + 1;
           #11#35 = #11#35 + #11nCampo;
     |SIGUE;

     #11#48 = 0;
     |PARA nCampo = 36;  |SI nCampo [ 47;  |HACIENDO nCampo = nCampo + 1;
           #11#48 = #11#48 + #11nCampo;
     |SIGUE;

     #11#61 = 0;
     |PARA nCampo = 49;  |SI nCampo [ 60;  |HACIENDO nCampo = nCampo + 1;
           #11#61 = #11#61 + #11nCampo;
     |SIGUE;

     #11#74 = 0;
     |PARA nCampo = 62;  |SI nCampo [ 73;  |HACIENDO nCampo = nCampo + 1;
           #11#74 = #11#74 + #11nCampo;
     |SIGUE;

     #11#87 = 0;
     |PARA nCampo = 75;  |SI nCampo [ 86;  |HACIENDO nCampo = nCampo + 1;
           #11#87 = #11#87 + #11nCampo;
     |SIGUE;

     #11#100 = 0;
     |PARA nCampo = 88;  |SI nCampo [ 99;  |HACIENDO nCampo = nCampo + 1;
           #11#100 = #11#100 + #11nCampo;
     |SIGUE;
|FPRC;

|PROCESO lineas;
     cclau = #1#7;
     |SI #0#5 = "N";
         cta   = #1#7 %  112;
         alfa1 = #1#7 % 1301;
         dig = alfa1;
         |HAZ leepro;
         cclau = nif;
     |SINO;
         cta   = #1#127 %  112;
         alfa1 = #1#127 % 1301;
         dig = alfa1;
     |FINSI;

     ccc = 0;
     |BUCLE caman110E;
     |SI ccc = 0;
         ult_cont = ult_cont + 1;
         ccc = ult_cont;
     |FINSI;

     #11#0   = #0#0;
     #11#1   = ccc;
     #11#134 = #0#2;
     |LEE 101#11=;
     |SI FSalida ! 0;
         |DDEFECTO #11;
         #11#0   = #0#0;
         #11#1   = ccc;
         #11#134 = #0#2;
         |HAZ datospro;
         |GRABA 020#11b;
     |FINSI;

     nSumaO = 0;
     nSumaD = 0;

     |SI #1#12 ! " ";  aTipo = #1#12;  nParrilla = 1;  |HAZ Acumulados;  |FINSI;
     |SI #1#13 ! " ";  aTipo = #1#13;  nParrilla = 2;  |HAZ Acumulados;  |FINSI;
     |SI #1#14 ! " ";  aTipo = #1#14;  nParrilla = 3;  |HAZ Acumulados;  |FINSI;

     |GRABA 020#11a;
     |LIBERA #11;
|FPRC;

|DEFBUCLE catra115;
     #1#1;
     ;
     #0#0, "               ";
     #0#0, "zzzzzzzzzzzzzzz";
     e;
     NULL, lineas;
|FIN;

|| **************************************************************************
|| EMPIEZA EL MEOLLO
|| **************************************************************************


|PROCESO elpase;
    |HAZ nom_usu;
    alfa1 = "x" + nom_tmp;
    |NOME_DAT #1 alfa1;
    |ABRE #1;  |CIERRA #1;   |DELINDEX #1;

     ult_cont = 0;
     desde = 1;
     |SI #0#3 = 2; desde =  4; |FINSI;
     |SI #0#3 = 3; desde =  7; |FINSI;
     |SI #0#3 = 4; desde = 10; |FINSI;

     hasta = 3;
     |SI #0#4 = 2; hasta =  6; |FINSI;
     |SI #0#4 = 3; hasta =  9; |FINSI;
     |SI #0#4 = 4; hasta = 12; |FINSI;

     |BUCLE caman110B;

     |SI #0#2 [ 80;
         nume2 = 2000 + #0#2;
     |SINO;
         nume2 = 1900 + #0#2;
     |FINSI;
     alfa3 = nume2; |QBF alfa3;
     alfa3 = ("0000" + alfa3) % -104;

     alfa1 = desde; |QBF alfa1;
     alfa1 = ("00" + alfa1) % -102;
     alfa2 = "01." + alfa1 + "." + alfa3;
     fech1 = alfa2;

     alfa1 = hasta; |QBF alfa1;
     alfa1 = ("00" + alfa1) % -102;
     alfa4 = "30."; |SI hasta = 3; |O hasta = 12; alfa4 = "31."; |FINSI;
     alfa2 = alfa4 + alfa1 + "." + alfa3;
     fech2 = alfa2;

     |ABRE #1;
     |BUCLE compras;  || lee el fichero de Compras
     |CIERRA #1;

     |ABRE #4;
     |ABRE #6;
     |SI #0#6 ="S"; |Y aste ! "*"; |ABRE #12;  |FINSI;

     |ABRET #11;
     |BUCLE catra115;
     |CIERRAT #11;

     |CIERRA #1;
     |DELINDEX #1;

     |CIERRA #4;
     |CIERRA #6;
     |SI #0#6 ="S"; |Y aste ! "*"; |CIERRA #12;  |FINSI;
|FPRC;

|| ******************************** PROCESO
|PROCESO haztodo;
 |PATH_DAT #2 dirfich0;
 |PATH_DAT #4 dirfich0;
 |PATH_DAT #11 dirfich0;
 |PATH_DAT #13 dirfich0;

  |ATRI R;
  |PINTA 2213, #30#2;
  |PINTA 2219, #30#3;
  |PINTA 2221, #30#1;
  |ATRI 0;

  #0#0 = #30#2;
  #0#1 = #30#1;
  |HAZ elpase;
|FPRC;

|| ************************************************************************

|PROCESO sel_multi;
  |SI #30#26 ! #0#2;  |ACABA; |FINSI;
  |SI #30#21 = "I";   |ACABA; |FINSI;
  leidos = 1;
|FPRC;

|| ***********************************************************************
|| ---------- Seleccion DESDE / HASTA Empresa.

|PROCESO esdesd1;
  alfa1 = #30#2;
  alfa2 = #30#3;
  alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
  alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
  dirfich0 = dir_fich + alfa1 + alfa2 + "/";
  leidos = 0;
  |HAZ sel_multi;
  |SI leidos = 1;
      |HAZ haztodo;
  |FINSI;
|FPRC;

|DEFBUCLE esdesde;
 #30#1;
 ;
 d_empres, d_period;
 h_empres, h_period;
 e;
 NULL,esdesd1;
|FIN;

|| ---------- Seleccion en parrilla.
|PROCESO esunaauna;
  |PARA xx = i_cm6; |SI xx [ i_cm7; |HACIENDO xx = xx + 1;
        |SI #0xx = 0;  |SAL;  |FINSI;
        yy = xx + 20;
        alfa1 = #0xx;
        alfa2 = #0yy;

        || ... lee empresa
           |ABRE #30;
           |DDEFECTO #30;
           #30#2 = #0xx;
           #30#3 = #0yy;
           |LEE 011#30=;
           |CIERRA #30;
           leidos = 0;
           |HAZ sel_multi;
           |SI leidos = 0; |VETE otramas; |FINSI;
        || ...................

        alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
        alfa2 = "0"     + alfa2;   alfa2 = alfa2 % -101;
        dirfich0 = dir_fich + alfa1 + alfa2 + "/";

        |HAZ haztodo;
 |ET otramas;
  |SIGUE;
|FPRC;

|| ***********************************************************************
|PROCESO reo115g;
  any = #0#2;
  |PUSHV 2102 2378;
  |ATRI I;
  |CUADRO 2102 2378
  |ATRI N;
  |ATRI R;
  |PINTA 2203," EMPRESA:                                                                  ";
  |ATRI 0;
  |SI #0i_cm1 = "S";
      |BUCLE esdesde;
  |SINO;
      |HAZ esunaauna;
  |FINSI;
|FPRC;

|| ************************************************************************

|PROGRAMA;
  |HAZ inicio;
  |HAZ tipo_8; || controlar si existe la ficha de clientes
  |CLS;
  |CABEZA "Pase a Mant.Mod. 110";
  |ABRE #0;
  |LEE 141#0p;
  |SI FSalida ! 0;
      |DDEFECTO #0;
      #0#2   = any;
      |GRABA 001#0b;
  |FINSI;
  |PINPA #0#0;

  |PINDA #0#0;
  |ENDATOS #2#0;
  |SI FSalida = 0;
      |GRABA 001#0a;
      |HAZ reo115g;
  |FINSI;
  |CIERRA #0;
|FPRO;
