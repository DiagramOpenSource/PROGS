|FICHEROS;
    pacontac #0;
    camaasic #2;    || apuntes cabs.
    camaasil #3;    || apuntes lins.
    cacuenta #4;    || plan contable
    cacuebal #15;   || cuentas de balance
    caclipro #16;   || clientes/proveedores
|FIN;

|VARIABLES;
    fiche = "";
    handle = "";
    varalfa = "";
    varalfa2 = "";
    trabajo = "";
    trabaj1 = "";
    traba = "";
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    sw = 0;

    ult_apunt = 0;
    docum = 0;
    FEstado = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    digito = 0;
    mascara = "";
    mensa1   = "     No esta definida esta cuenta en Cuentas de Balance";
    uno = "";
    dos = "";
    nada = "";
    fichero = "";
    top = 0;
    conte = "";
    digcu = 0;
    fecha = @;
    descr = "";
    signe = "";
    impor = 0;
|FIN;

|INCLUYE acceso_i;
|INCLUYE actcta_i;
|INCLUYE actudi_i;
|INCLUYE conasi_i;
____________________________________/ CALCULOS DESDE PANTALLA
|PROCESO mayus; |TIPO 0;
    #0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;
____________________________________/ CALCULOS COMUNES CUENTAS Y APUNTES
|PROCESO principio;
|PARA para1 = 1;  |SI para1 [ top;  |HACIENDO para1 = para1 + 1;
        varalfa = handle + " 1";
    |FLEE varalfa;
|SIGUE;
|FPRC;

|PROCESO nombre;
    Pos = -1;
    alfa1 = #0#1;
|QBF alfa1;
    alfa1 = alfa1 + fichero;
|QBF alfa1;
    traba = trabaj1;
|QBF traba;
    alfa1 = alfa1 + traba + ".dbf";
|QBF alfa1;
    fiche = "rb  " + alfa1;
|QBF fiche;
|FPRC;

|PROCESO digito;
    alfa1 = conte;  |QBF alfa1;
    alfa2 = alfa1 % 0;   nume1 = alfa2;
    digito = 0;
|SI nume1 = dig4;   digito = 1;    |FINSI;
|SI nume1 = dig5;   digito = 2;    |FINSI;
|SI nume1 = dig6;   digito = 3;    |FINSI;
|SI nume1 = dig7;   digito = 4;    |FINSI;
|SI nume1 = dig8;   digito = 5;    |FINSI;
|SI nume1 = dig9;   digito = 6;    |FINSI;
|FPRC;
____________________________________/ CALCULOS DEL PASE DEL DIARIO
|PROCESO ultimo;
    #3#3 = 9999;
|LEE 000#3];
|SI FSalida = 0;
    |LEE 000#3a;
|SINO;
    |LEE 000#3u;
|FINSI;
|SI FSalida = 0;|Y #3#0 = 1;|Y #3#1 = fecha;|Y #3#2 = docum;
        ult_apunt = #3#3 + 2;
|SINO;
        ult_apunt = 1;
|FINSI;

|DDEFECTO #3;
    #3#0 = 1;
    #3#1 = fecha;
    #3#2 = docum;
|FPRC;

|PROCESO cabecera;
|DDEFECTO #2;
    #2#0 = #3#0;
    #2#1 = #3#1;
    #2#2 = #3#2;
|LEE 101#2=;
    FEstado = FSalida;
    #2#0 = #3#0;         || diario
    #2#1 = #3#1;         || fecha
    #2#2 = #3#2;         || documento
    #2#3 = #2#2;         || asiento
|SI #3#8 = "D";
        #2#4 = #2#4 + #3#9;
    |SI #2#09 = 0; #2#08 = #3#4; #2#09 = #3#5; |FINSI;      || contrp.HABER
|FINSI;
|SI #3#8 = "H";
        #2#5 = #2#5 + #3#9;
    |SI #2#11 = 0; #2#10 = #3#4; #2#11 = #3#5; |FINSI;      || contrp.DEBE
|FINSI;
    #2#6 = #2#4 - #2#5;
|SI FEstado = 0;  |GRABA 020#2a;  |FINSI;
|SI FEstado ! 0;  |GRABA 020#2n;  |FINSI;
|LIBERA #2;
|FPRC;

|PROCESO apuntes;
    conte = varalfa % 1612;   |QBF conte;
|SI conte = "";
        conte = varalfa % 2812;   |QBF conte;     || contrapartida
|FINSI;
|SI conte ! "";
    |DDEFECTO #3;
        #3#00 = 1;          || diario
        alfa1 = varalfa % 808;
        alfa1 = (alfa1 % -102) + "." + (alfa1 % 502) + "." + (alfa1 % 104);
        fecha = alfa1;
        #3#01 = fecha;      || fecha
        #3#02 = docum;      || documento
    |HAZ ultimo;
        #3#03 = ult_apunt;  || apunte
    |HAZ digito;
        #3#04 = conte;      || cuenta
        digcu = digito;
        #3#05 = digcu;      || digito cuenta
        #3#06 = 999;        || concepto
        alfa1 = varalfa % 5225;
        #3#07 = alfa1;      || descripcion
        alfa1 = varalfa % 4210;   nume1 = alfa1;
        alfa1 = varalfa % 7910;   nume2 = alfa1;
        signe = "";
        impor = 0;
    |SI nume1 ! 0; signe = "D";   impor = nume1; |FINSI;
    |SI nume2 ! 0; signe = "H";   impor = nume2; |FINSI;
        #3#08 = signe;      || signo
        #3#09 = impor;      || importe
    |SI #3#08 = "D";
            #3#16 = #3#4;
            #3#17 = #3#5;
    |SINO;
            #3#10 = #3#4;
            #3#11 = #3#5;
    |FINSI;
        #3#12 = "";           || cobros/pagos
        #3#13 = 0;            || libro
        #3#14 = 0;            || orden
        #3#15 = "";           || serie
        #3#22 = 0;            || nro.recibo
        #3#19 = "";           || tipo acumulador
        #3#20 = 0;            || numero acumulador
        #3#21 = "";           || departamento
    |SI impor ! 0;
        |GRABA 020#3n;
        |SI FSalida = 0;

            |ATRI I;
            |PINTA 2221, #3#1;
            |PINTA 2234, #3#4;
            |ATRI 0;

            |HAZ cabecera;
                ressum = #3#9;
            |HAZ actualiz1;     || actualiza cuentas
                opera = "A";
            |HAZ altatra;       || actualiza niveles inferiores
                d_diari = #3#0;
                d_opera = #3#8;
                d_impor = #3#9;
            |HAZ actu_diari;    || actualiza diario
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO diario_03;
|HAZ contador;
    docum = #20#1;

|ABRET #2;
|ABRET #3;
    trabaj1 = #0#2;
    fichero = "diario";
|HAZ nombre;
|FABRE fiche;
    handle = FSalida;
|SI FSalida ] 0;
        top = 610;
    |HAZ principio;
        sw = 0;
    |PARA; |SI sw = 0; |HACIENDO;
            varalfa = handle + " 145";
        |FLEE varalfa;
        |SI FSalida = 145;
            |HAZ apuntes;
        |SINO;
                sw = 1;
        |FINSI;
    |SIGUE;
        FSalida = handle;
    |FCIERRA FSalida;
|FINSI;
    Pos = -1;
|CIERRAT #2;
|CIERRAT #3;
|FPRC;

|PROCESO diario_02;
|HAZ contador;
    docum = #20#1;

|ABRET #2;
|ABRET #3;
    trabaj1 = #0#2;
    fichero = "diario";
|HAZ nombre;
|FABRE fiche;
    handle = FSalida;
|SI FSalida ] 0;
        top = 578;
    |HAZ principio;
        sw = 0;
    |PARA; |SI sw = 0; |HACIENDO;
            varalfa = handle + " 139";
        |FLEE varalfa;
        |SI FSalida = 139;
            |HAZ apuntes;
        |SINO;
                sw = 1;
        |FINSI;
    |SIGUE;
        FSalida = handle;
    |FCIERRA FSalida;
|FINSI;
    Pos = -1;
|CIERRAT #2;
|CIERRAT #3;
|FPRC;

|PROCESO diario_01;
|HAZ contador;
    docum = #20#1;

|ABRET #2;
|ABRET #3;
    trabaj1 = #0#2;
    fichero = "diario";
|HAZ nombre;
|FABRE fiche;
    handle = FSalida;
|SI FSalida ] 0;
        top = 483;
    |HAZ principio;
        sw = 0;
    |PARA; |SI sw = 0; |HACIENDO;
            varalfa = handle + " 119";
        |FLEE varalfa;
        |SI FSalida = 119;
            |HAZ apuntes;
        |SINO;
                sw = 1;
        |FINSI;
    |SIGUE;
        FSalida = handle;
    |FCIERRA FSalida;
|FINSI;
    Pos = -1;
|CIERRAT #2;
|CIERRAT #3;
|FPRC;
____________________________________/ CALCULOS DEL PASE DE CUENTAS
|PROCESO cli_prov_02;
  alfa1 = #4#0 % 103;
  |SI alfa1 ! "430";  |Y alfa1 ! "440";  |Y alfa1 ! "400";  |Y alfa1 ! "410";
      |ACABA;
  |FINSI;
  |DDEFECTO #16;
  |SI alfa1 = "430";|O alfa1 = "440";
      #16#23 = "C";
  |SINO;
      #16#23 = "P";
  |FINSI;
  #16#10 = #4#0;             || cuenta contable
  #16#11 = #4#1;             || digito
  |LEE 101#16=;
  FEstado = FSalida;
  #16#0 = #4#0;              || codigo (cuenta)
  #16#1 = #4#2;              || nombre
  #16#2 = varalfa % 5835;    || direccion
  #16#6 = varalfa % 9325;    || poblacion
  #16#9 = varalfa % 4315;    || cif
  |SI FEstado ! 0;  |GRABA 020#16n;     |FINSI;
  |SI FEstado = 0;  |GRABA 020#16a;     |FINSI;
  |LIBERA #16;
|FPRC;

|PROCESO cli_prov_01;
  alfa1 = #4#0 % 103;
  |SI alfa1 ! "430";  |Y alfa1 ! "440";  |Y alfa1 ! "400";  |Y alfa1 ! "410";
      |ACABA;
  |FINSI;
  |DDEFECTO #16;
  |SI alfa1 = "430";|O alfa1 = "440";
      #16#23 = "C";
  |SINO;
      #16#23 = "P";
  |FINSI;
  #16#10 = #4#0;             || cuenta contable
  #16#11 = #4#1;             || digito
  |LEE 101#16=;
  FEstado = FSalida;
  #16#0 = #4#0;              || codigo (cuenta)
  #16#1 = #4#2;              || nombre
  #16#2 = varalfa % 5340;    || direccion
  #16#6 = varalfa % 9325;    || poblacion
  #16#9 = varalfa % 4310;    || cif
  |SI FEstado ! 0;  |GRABA 020#16n;     |FINSI;
  |SI FEstado = 0;  |GRABA 020#16a;     |FINSI;
  |LIBERA #16;
|FPRC;

|PROCESO saca;
    #4#4 = #15#1;
    #4#5 = #15#2;
    #4#6 = #15#3;
    #4#7 = #15#4;
    #4#8 = #15#5;
|FPRC;

|PROCESO defect;
  |ABRE #15;
  uno = #4#0;
  |QBF uno;
  dos = uno + "000000000000";
  uno = dos % A101;
  #15#0 = uno;
  |LEE 040#15=;
  |SI FSalida = 0;
      |HAZ saca;
      |VETE findefe;
  |FINSI;
  uno = dos % A102;
  #15#0 = uno;
  |LEE 040#15=;
  |SI FSalida = 0;
      |HAZ saca;
      |VETE findefe;
  |FINSI;
  uno = dos % A103;
  #15#0 = uno;
  |LEE 040#15=;
  |SI FSalida = 0;
      |HAZ saca;
      |VETE findefe;
  |FINSI;
  uno = dos % A104;
  #15#0 = uno;
  |LEE 040#15=;
  |SI FSalida = 0;
      |HAZ saca;
      |VETE findefe;
  |SINO;
      |MENAV mensa1;
  |FINSI;
|ET findefe;
  |CIERRA #15;
|FPRC;

|PROCESO cuentas;
|DDEFECTO #4;

    #4#0 = varalfa % 112;     || cuenta
    conte = #4#0;
|HAZ digito;
|SI digito ! 0;
        #4#1 = digito;            || digito
        #4#2 = varalfa % 1330;    || descripcion
        #4#3 = "S";               || pase directo

    |ATRI I;
    |PINTA 2221, #4#0;
    |PINTA 2234, #4#2;
    |ATRI 0;

        mascara = #4#0;
    |QBF mascara;
        mascara = mascara +"zzzzzzzzzzzz";
        mascara = mascara % 112;

        #4#54 = mascara;
        #4#55 = #4#1;

    |HAZ defect;

    |GRABA 000#4n;
    |SI FSalida = 0;
        |SI #0#5 = 1;    |HAZ cli_prov_01;   |FINSI;
        |SI #0#5 ] 2;    |HAZ cli_prov_02;   |FINSI;
    |FINSI;
|SINO;
    |MENAV "    No corresponden los Niveles; proceso interrumpido ...";
        sw = 1;
|FINSI;
|FPRC;

|PROCESO subcta_02;
|ABRET #4;
|ABRET #16;
    trabaj1 = #0#2;
    fichero = "subcta";
|HAZ nombre;
|FABRE fiche;
    handle = FSalida;
|SI FSalida ] 0;
        top = 2115;
    |HAZ principio;
        sw = 0;
    |PARA; |SI sw = 0; |HACIENDO;
            sw = 1;
            varalfa = handle + " 214";
        |FLEE varalfa;
        |SI FSalida = 214;
                varalfa2 = handle + " 200";
            |FLEE varalfa2;
            |SI FSalida = 200;
                    varalfa2 = handle + " 200";
                |FLEE varalfa2;
                |SI FSalida = 200;
                        varalfa2 = handle + " 200";
                    |FLEE varalfa2;
                    |SI FSalida = 200;
                            sw = 0;
                        |HAZ cuentas;
                    |FINSI;
                |FINSI;
            |FINSI;
        |FINSI;
    |SIGUE;
        FSalida = handle;
    |FCIERRA FSalida;
|FINSI;
    Pos = -1;
|CIERRAT #4;
|CIERRAT #16;
|FPRC;

|PROCESO subcta_01;
|ABRET #4;
|ABRET #16;
    trabaj1 = #0#2;
    fichero = "subcta";
|HAZ nombre;
|FABRE fiche;
    handle = FSalida;
|SI FSalida ] 0;
        top = 547;
    |HAZ principio;
        sw = 0;
    |PARA; |SI sw = 0; |HACIENDO;
            varalfa = handle + " 211";
        |FLEE varalfa;
        |SI FSalida = 211;
            |HAZ cuentas;
        |SINO;
                sw = 1;
        |FINSI;
    |SIGUE;
        FSalida = handle;
    |FCIERRA FSalida;
|FINSI;
    Pos = -1;
|CIERRAT #4;
|CIERRAT #16;
|FPRC;
____________________________________/ CALCULO PRINCIPAL
|PROCESO pasa;  |TIPO 3;
|SI #0#0 = "S";
    |SI #0#3 = "S";
        |SI #0#5 = 1;    |HAZ subcta_01;     |FINSI;
        |SI #0#5 ] 2;    |HAZ subcta_02;     |FINSI;
    |FINSI;
    |PINTA 2221, "                                                ";
    |SI #0#4 = "S";
        |SI #0#5 = 1;    |HAZ diario_01;     |FINSI;
        |SI #0#5 = 2;    |HAZ diario_02;     |FINSI;
        |SI #0#5 = 3;    |HAZ diario_03;     |FINSI;
        |SUB_EJECUTA "camaapua.run";
    |FINSI;
|FINSI;
|FPRC;
