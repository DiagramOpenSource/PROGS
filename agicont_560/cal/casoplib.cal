|FICHEROS;
   casoplib #0;

   caportad #2;

   cabucemp #3;
   cabucem1 #4;

   caconimp #5;
   canempre #30;

   agim0019 #500;
|FIN;

|VARIABLES;
   aPath       = "";
   aTipo       = "";

   aSistema    = "";
   aOrigen     = "";
   aDestino    = "";
   EstadoAnt   = "";
   Comodin     = "";
   Comodin1    = "";
   Comodin2    = "";
   Comodin3    = "";
   NombreTotal = "";
   Nombre      = "";
   aApell1     = "";
   aApell2     = "";
   aLong       = "";
   Directorio  = "";
   Dia         = "";
   anyo        = "";
   Cuenta      = "";
   aDia        = "";
   aMes        = "";
   aAnyo       = "";
   ComFecha    = "";
   Caracter    = "";
   aNumer      = "";
   aAlfa       = "";
   aImpre      = "";
   aMemoria    = "";

   Local       = 0;
   ModoEntrada = 0;
   nLong       = 0;
   nParte1     = 0;
   nParte2     = 0;
   Handle      = 0;
   Calc        = 0;
   Empresa     = 0;
   Periodo     = 0;
   Linea       = 1;
   Cuentador   = 0;
   nCont       = 0;
   NumFecha    = 0;
   Ejercicio   = 0;
   Numeracion  = 0;
   Empre1      = 0;

   Fecha       = @;

   nBoton01    = 0;
   nBoton02    = 0;
   nBoton03    = 0;
   nBoton04    = 0;
   nBoton05    = 0;
   nBoton06    = 0;
   nBoton07    = 0;
   nBoton08    = 0;
   nBoton09    = 0;
   nBoton10    = 0;
   nBoton11    = 0;
   nBoton12    = 0;
   nBoton13    = 0;
   nBoton14    = 0;
   nBoton15    = 0;
   nBoton16    = 0;
   nDejaSI = 0;
|FIN;

|PROCESO MiraCabecera;
   |ABRE #caportad;
   #caportad#0 = #48#2;
   #caportad#1 = #48#26;
   |LEE 000#caportad.=;
   |SI FSalida = 0;
      #casoplib#0 = #48#2;
      #casoplib#1 = #48#26;
      #casoplib#2 = #caportad#2; NombreTotal = #caportad#2; |HAZ SeparaNombre;
      |SI Nombre ! ""; |Y aApell1 ! ""; |Y aApell2 ! "";
         #casoplib#4 = Nombre;
         #casoplib#5 = aApell1;
         #casoplib#6 = aApell2;
      |FINSI;
      #casoplib#3 = #caportad#13;
      Comodin = #caportad#3;
      Comodin1 = #caportad#4; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#5; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#6; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#7; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#8; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      #casoplib#7  = Comodin;
      #casoplib#8  = (("00" + #caportad#9) % -102) + (("000" + #caportad#10) % -103);
      #casoplib#9  = #caportad#11;
      #casoplib#10 = #caportad#12;
      #casoplib#11 = #caportad#14;

      #casoplib#13 = #caportad#38;
      #casoplib#14 = #caportad#39; NombreTotal = #caportad#39; |HAZ SeparaNombre;
      |SI Nombre ! ""; |Y aApell1 ! ""; |Y aApell2 ! "";
         #casoplib#14 = Nombre;
         #casoplib#15 = aApell1;
         #casoplib#16 = aApell2;
      |FINSI;
      Comodin = #caportad#40;
      Comodin1 = #caportad#41; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#42; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#43; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#44; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#45; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      #casoplib#17  = Comodin;
      #casoplib#18  = (("00" + #caportad#47) % -102) + (("000" + #caportad#48) % -103);
      #casoplib#19 = #caportad#49;
      #casoplib#20 = #caportad#50;
      #casoplib#21 = #caportad#46;
   |FINSI;
   |CIERRA #caportad;

   |DBASS Comodin; |QBF Comodin;
   Comodin = Comodin + "agicli/fich/";
   |PATH_DAT #500 Comodin;
   |ABRE #agim0019;
   #agim0019#0 = #48#2;
   #agim0019#1 = 01;
   |LEE 000#agim0019.];
   |SI FSalida = 0;
      |PARA; |SI FSalida = 0; |Y #agim0019#0 = #48#2; |HACIENDO;
         |LEE 000#agim0019.s;
      |SIGUE;
      |LEE 000#agim0019.a;
      #casoplib#23 = #agim0019#29;
      #casoplib#24 = #agim0019#30;
      #casoplib#25 = #agim0019#31;
      #casoplib#26 = #agim0019#32;
      #casoplib#27 = #agim0019#25;
      #casoplib#31 = #agim0019#33;
   |FINSI;
   |CIERRA #agim0019;
|FPRC;

|PROCESO ObtenNombre;
   Comodin1 = "";
   aLong = Nombre % 0; nLong = aLong;
   |PARA nCont = 1; |SI nCont [ nLong; |HACIENDO nCont = nCont + 1;
      Calc = -((nCont * 100) + 1);
      Caracter = Nombre % Calc;
      |SI Caracter = "/";
         |SAL;
      |SINO;
         Comodin1 = Caracter + Comodin1;
      |FINSI;
   |SIGUE;
   Nombre = Comodin1;
|FPRC;

|PROCESO Fecha;
   |SI aMes = "Ultimo"; |O aMes = "Tercero"; |O aMes = "Sexto";
    |O aMes = "Noveno";
      |SI #48#12 ! 12;
         Calc = aAnyo; Calc = Calc + 1; aAnyo = ("00" + Calc) % -102;
      |FINSI;
   |FINSI;
   |SI aAnyo ] "80";
      aAnyo = "19" + aAnyo;
   |SINO;
      aAnyo = "20" + aAnyo;
   |FINSI;
   |SI aMes = "Primero"; aMes = ("00" + #48#11) % -102; |FINSI;
   |SI aMes = "Tercero"; aMes = ("00" + (#48#11+3)) % -102; |FINSI;
   |SI aMes = "Sexto";   aMes = ("00" + (#48#11+6)) % -102; |FINSI;
   |SI aMes = "Noveno";  aMes = ("00" + (#48#11+9)) % -102; |FINSI;
   |SI aMes = "Ultimo";  aMes = ("00" + #48#12) % -102; |FINSI;
   |SI aDia = "Primero"; aDia = "01"; |FINSI;
   |SI aDia = "Ultimo";
      |SI aMes = "02";
         |SI aAnyo = "80"; |O aAnyo = "84"; |O aAnyo = "88"; |O aAnyo = "92";
          |O aAnyo = "96"; |O aAnyo = "04"; |O aAnyo = "08"; |O aAnyo = "12";
          |O aAnyo = "16"; |O aAnyo = "20"; |O aAnyo = "24"; |O aAnyo = "28";
            aDia = "29";
         |SINO;
            aDia = "28";
         |FINSI;
      |SINO;
         |SI aMes = "01"; |O aMes = "03"; |O aMes = "05"; |O aMes = "07";
          |O aMes = "08"; |O aMes = "10"; |O aMes = "12";
            aDia = "31";
         |SINO;
            aDia = "30";
         |FINSI;
      |FINSI;
   |FINSI;
   ComFecha = aDia + "." + aMes + "." + aAnyo;
|FPRC;

|PROCESO SeparaNombre;
   Comodin = NombreTotal; |QBF Comodin;

   Nombre = ""; aApell1 = ""; aApell2 = "";
   Comodin = Comodin - " ";
   |SI FSalida ! 0;
      nParte1 = FSalida;
      Comodin = Comodin - ",";
      |SI FSalida ! 0;
         nParte2 = FSalida + 98;
         Nombre = Comodin % nParte2; Comodin = Comodin - Nombre; |QBF Nombre;
         nParte1 = nParte1 + 98;
         aApell2 = Comodin % nParte1; Comodin = Comodin - aApell2; |QBF aApell2;
         aApell1 = Comodin;
      |SINO;
         Comodin = Comodin - " ";
         |SI FSalida ! 0;
            nParte2 = FSalida + 98;
            Nombre = Comodin % nParte2; Comodin = Comodin - Nombre; |QBF Nombre;
            nParte1 = nParte1 + 98;
            aApell2 = Comodin % nParte1; Comodin = Comodin - aApell2; |QBF aApell2;
            aApell1 = Comodin;
         |FINSI;
      |FINSI;
   |FINSI;

   |QBF Nombre; |QBF aApell1; |QBF aApell2;

   |SI Nombre ! "";
      Comodin = " ";
      |PARA; |SI Comodin = " "; |HACIENDO;
         Comodin = Nombre % 0101;
         |SI Comodin = " "; Nombre = Nombre - " "; |FINSI;
      |SIGUE;
   |FINSI;

   |SI aApell1 ! "";
      Comodin = " ";
      |PARA; |SI Comodin = " "; |HACIENDO;
         Comodin = aApell1 % 0101;
         |SI Comodin = " "; aApell1 = aApell1 - " "; |FINSI;
      |SIGUE;
   |FINSI;

   |SI aApell2 ! "";
      Comodin = " ";
      |PARA; |SI Comodin = " "; |HACIENDO;
         Comodin = aApell2 % 0101;
         |SI Comodin = " "; aApell2 = aApell2 - " "; |FINSI;
      |SIGUE;
   |FINSI;
|FPRC;

|PROCESO CreaSecuenciales;
   #48#2 = #cabucem1#0;
   #48#3 = #cabucem1#1;
   |LEE 000#48=;
   |SI FSalida = 0;
      |DBASE Directorio; |QBF Directorio;
      Directorio = Directorio + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
      Comodin = "wb  " + Directorio + "nombres.txt";
      |FABRE Comodin;
      |SI FSalida ] 0;
         Handle = FSalida; Nombre = "";
         |DBASE Comodin1; |QBF Comodin1;
         Comodin1 = Comodin1 + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
         Comodin1 = Comodin1 + "*.xls";
         |_PDIR Comodin1;
         |SI FSalida = 0;
            |PARA; |SI FSalida = 0; |HACIENDO;
               aLong = Comodin1 % 0; nLong = aLong;
               |PARA nCont = 1; |SI nCont [ nLong; |HACIENDO nCont = nCont + 1;
                   Calc = -((nCont * 100) + 1);
                   Caracter = Comodin1 % Calc;
                   |SI Caracter = "/";
                      |SAL;
                   |SINO;
                      Nombre = Caracter + Nombre;
                   |FINSI;
               |SIGUE;
               Nombre = Handle + " " + Nombre + &13 + &10; |FGRABA Nombre;
               Nombre = "";
               |_SDIR Comodin1;
            |SIGUE;
         |FINSI;
         FSalida = Handle;
         |FCIERRA FSalida;
      |SINO;
         |MENAV "    Problemas al crear el secuencial de nombres";
         |ERROR;
      |FINSI;

      Comodin = "wb  " + Directorio + "datos.txt";
      |FABRE Comodin;
      |SI FSalida ] 0;
         Handle = FSalida;

         Comodin = Handle + " 100" + #casoplib#10 + &13 + &10;  |FGRABA Comodin; || Provincia Presentacion
         Comodin = #casoplib#30; |QBF Comodin;
         Comodin = Comodin - "."; Comodin = Comodin - ".";
         Comodin = Handle + " 101" + Comodin + &13 + &10;       |FGRABA Comodin; || Fecha solicitud
         Comodin = Handle + " 102" + #casoplib#4  + &13 + &10;  |FGRABA Comodin; || Nombre Empresario
         Comodin = Handle + " 103" + #casoplib#5  + &13 + &10;  |FGRABA Comodin; || 1 Apellido Empresario
         Comodin = Handle + " 104" + #casoplib#6  + &13 + &10;  |FGRABA Comodin; || 2 Apellido Empresario
         Comodin = Handle + " 105" + #casoplib#3  + &13 + &10;  |FGRABA Comodin; || NIF Empresario
         Comodin = Handle + " 106" + #casoplib#7  + &13 + &10;  |FGRABA Comodin; || Direccion Empresario
         Comodin = Handle + " 107" + #casoplib#9  + &13 + &10;  |FGRABA Comodin; || Localidad Empresario
         Comodin = Handle + " 108" + #casoplib#8  + &13 + &10;  |FGRABA Comodin; || C.P. Empresario
         Comodin = Handle + " 109" + (#casoplib#8 % 0102) + &13 + &10; |FGRABA Comodin; || Cod.Provincia Empresario
         Comodin = Handle + " 110" + #casoplib#12 + &13 + &10; |FGRABA Comodin; || Fax Empresario
         Comodin = Handle + " 111" + #casoplib#11 + &13 + &10; |FGRABA Comodin; || Telefono Empresario

         Comodin = Handle + " 201" + #casoplib#23 + &13 + &10; |FGRABA Comodin; || N§ Tomo Registro
         Comodin = Handle + " 202" + #casoplib#24 + &13 + &10; |FGRABA Comodin; || N§ Libro Registro
         Comodin = Handle + " 203" + #casoplib#25 + &13 + &10; |FGRABA Comodin; || N§ Seccion Registro
         Comodin = Handle + " 204" + #casoplib#26 + &13 + &10; |FGRABA Comodin; || N§ Folio Registro
         Comodin = Handle + " 205" + #casoplib#27 + &13 + &10; |FGRABA Comodin; || Tipo Registro Publico
         Comodin = Handle + " 206" + #casoplib#31 + &13 + &10; |FGRABA Comodin; || N§ Hoja Registro

         Comodin = Handle + " 301" + #casoplib#14 + &13 + &10; |FGRABA Comodin; || Nombre Representante
         Comodin = Handle + " 302" + #casoplib#15 + &13 + &10; |FGRABA Comodin; || 1 Apellido Representante
         Comodin = Handle + " 303" + #casoplib#16 + &13 + &10; |FGRABA Comodin; || 2 Apellido Representante
         Comodin = Handle + " 304" + #casoplib#13 + &13 + &10; |FGRABA Comodin; || DNI Representante
         Comodin = Handle + " 305" + #casoplib#17 + &13 + &10; |FGRABA Comodin; || Direccion Representante
         Comodin = Handle + " 306" + #casoplib#19 + &13 + &10; |FGRABA Comodin; || Localidad Representante
         Comodin = Handle + " 307" + #casoplib#18 + &13 + &10; |FGRABA Comodin; || C.P. Representante
         Comodin = Handle + " 308" + #casoplib#20 + &13 + &10; |FGRABA Comodin; || Provincia Representante
         Comodin = Handle + " 309" + #casoplib#22 + &13 + &10; |FGRABA Comodin; || Fax Representante
         Comodin = Handle + " 310" + #casoplib#21 + &13 + &10; |FGRABA Comodin; || Telefono Representante

         Comodin = Handle + " 401" + #casoplib#29 + &13 + &10; |FGRABA Comodin; || Solicita Retencion
         Comodin = ("000" + #casoplib#28) % -103;
         Comodin = Handle + " 501" + Comodin + &13 + &10;      |FGRABA Comodin; || Numero libros presentados

         Numeracion = 1;
         |DBASE Comodin1; |QBF Comodin1;
         Comodin1 = Comodin1 + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
         Comodin1 = Comodin1 + "*.xls";
         |_PDIR Comodin1;
         |SI FSalida = 0;
            |PARA; |SI FSalida = 0; |HACIENDO;
               aLong = Comodin1 % 0; nLong = aLong;
               |PARA nCont = 1; |SI nCont [ nLong; |HACIENDO nCont = nCont + 1;
                   Calc = -((nCont * 100) + 1);
                   Caracter = Comodin1 % Calc;
                   |SI Caracter = "/";
                      |SAL;
                   |SINO;
                      Nombre = Caracter + Nombre;
                   |FINSI;
               |SIGUE;
               Comodin3 = Nombre % -107; Nombre = Nombre - Comodin3;
               Comodin3 = Comodin3 % 0103;
               aNumer = ("000" + Numeracion) % -103;
               Numeracion = Numeracion + 1;
               |SI Nombre = "DIARIO_";
                  Comodin2 = Handle + " " + aNumer + "01Diario                          " + &13 + &10; |FGRABA Comodin2;
               |FINSI;
               |SI Nombre = "INV_CUEN_";
                  Comodin2 = Handle + " " + aNumer + "01Inventario y cuentas anuales    " + &13 + &10; |FGRABA Comodin2;
               |FINSI;
               |SI Nombre = "BAL_SUMS_";
                  Comodin2 = Handle + " " + aNumer + "01Balance comprob.sumas y saldos  " + &13 + &10; |FGRABA Comodin2;
               |FINSI;
               |SI Nombre = "MAYOR_";
                  Comodin2 = Handle + " " + aNumer + "01Libro de mayor                  " + &13 + &10; |FGRABA Comodin2;
               |FINSI;
               |SI Nombre = "FAC_EMIT_";
                  Comodin2 = Handle + " " + aNumer + "01Libro de facturas emitidas      " + &13 + &10; |FGRABA Comodin2;
               |FINSI;
               |SI Nombre = "FAC_RECI_";
                  Comodin2 = Handle + " " + aNumer + "01Libro de facturas recibidas     " + &13 + &10; |FGRABA Comodin2;
               |FINSI;

               Comodin2 = Handle + " " + aNumer + "02" + Comodin3 + &13 + &10; |FGRABA Comodin2;
               aDia = "01"; aMes = "Primero"; aAnyo = (("00" + #48#26) % -102);
               |HAZ Fecha;
               ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
               Comodin2 = Handle + " " + aNumer + "03" + ComFecha + &13 + &10; |FGRABA Comodin2;
               aDia = "Ultimo"; aMes = "Ultimo"; aAnyo = (("00" + #48#26) % -102);
               |HAZ Fecha;
               ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
               Comodin2 = Handle + " " + aNumer + "04" + ComFecha + &13 + &10; |FGRABA Comodin2;
               aDia = "01"; aMes = "Primero"; aAnyo = (("00" + #48#26) % -102);
               |HAZ Fecha;
               Fecha = ComFecha; NumFecha = Fecha; NumFecha = NumFecha - 1; Fecha = NumFecha; ComFecha = Fecha;
               ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
               Comodin2 = Handle + " " + aNumer + "05" + ComFecha + &13 + &10; |FGRABA Comodin2;
               Nombre = "";
               |_SDIR Comodin1;
            |SIGUE;
         |FINSI;

         FSalida = Handle;
         |FCIERRA FSalida;
      |SINO;
         |MENAV "    Problemas al crear el secuencial de nombres";
         |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE CreaSecuenciales;
#cabucem1#1;
;
INICIO;
FINAL;
;
NULL,CreaSecuenciales;
|FIN;

|PROCESO EscondeBotones;
   |ESTADO_CONTROL nBoton01,"DISABLE";
   |ESTADO_CONTROL nBoton02,"DISABLE";
   |ESTADO_CONTROL nBoton03,"DISABLE";
   |ESTADO_CONTROL nBoton04,"DISABLE";
   |ESTADO_CONTROL nBoton05,"DISABLE";
   |ESTADO_CONTROL nBoton06,"DISABLE";
   |ESTADO_CONTROL nBoton07,"DISABLE";
   |ESTADO_CONTROL nBoton08,"DISABLE";
   |ESTADO_CONTROL nBoton09,"DISABLE";
   |ESTADO_CONTROL nBoton10,"DISABLE";
   |ATRI I; |PINTA 2330, "Imprimiendo, espere por favor"; |ATRI N;
|FPRC;

|PROCESO ReponBotones;
   |ESTADO_CONTROL nBoton01,"ENABLE";
   |ESTADO_CONTROL nBoton02,"ENABLE";
   |ESTADO_CONTROL nBoton03,"ENABLE";
   |ESTADO_CONTROL nBoton04,"ENABLE";
   |ESTADO_CONTROL nBoton05,"ENABLE";
   |ESTADO_CONTROL nBoton06,"ENABLE";
   |ESTADO_CONTROL nBoton07,"ENABLE";
   |ESTADO_CONTROL nBoton08,"ENABLE";
   |ESTADO_CONTROL nBoton09,"ENABLE";
   |ESTADO_CONTROL nBoton10,"ENABLE";
   |PINTA 2330, "                             ";
|FPRC;

|PROCESO CopiaNuevo;
   |DBASE Comodin; |QBF Comodin; Comodin = Comodin + "hacienda/tmp1.xls";
   |IP_REMOTO Comodin1; |QBF Comodin1;
   |SI Comodin1 ! "";
      Comodin1 = "c:\tmp1.xls";
      |ENVIA_FICHERO Comodin, Comodin1;
   |SINO;
      Comodin1 = "c:\tmp1.xls";
      |COPIA_FICHERO Comodin, Comodin1;
   |FINSI;
|FPRC;

|PROCESO Proceso01;
   |HAZ EscondeBotones;
   |HAZ CopiaNuevo;
   |SUB_EJECUTA_NP "cadiario.tab;PRUEBA";
   |HAZ ReponBotones;
|FPRC;

|PROCESO Proceso02;
   |HAZ EscondeBotones;
   |HAZ CopiaNuevo;
   Comodin = "cauxinva.tab;PRUEBA";  |SUB_EJECUTA_NP Comodin;

   |SI aMemoria = "S";
      Comodin = ":sociedad/memoria1.tab;" + #cabucem1#0; |SUB_EJECUTA_NP Comodin;
   |FINSI;

   Comodin = "cabatodo.tab;0,12,C";  |SUB_EJECUTA_NP Comodin;
   Comodin = "cabatodo.tab;0,12";    |SUB_EJECUTA_NP Comodin;

   |DBASE Comodin1; |QBF Comodin1;
   Comodin1 = Comodin1 + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
   Comodin1 = Comodin1 + "INV_CUEN_*.xls";
   |_PDIR Comodin1;
   |SI FSalida = 0;
      |PARA; |SI FSalida = 0; |HACIENDO;
         Comodin = Comodin1 % -107; Comodin = Comodin % 0103;
         Numeracion = Comodin; Numeracion = Numeracion + 1;
         |_SDIR Comodin1;
      |SIGUE;
   |SINO;
      Numeracion = 1;
   |FINSI;

   Comodin = "c:/tmp1.xls";
   |XCIERRA Handle;
   |DBASE Comodin1; |QBF Comodin1;
   Comodin1 = Comodin1 + "hacienda/PresLibr/";
   |MKDIR Comodin1;
   Comodin1 = Comodin1 + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
   |MKDIR Comodin1;
   Comodin1 = Comodin1 + "INV_CUEN_" + (("000" + Numeracion) % -103) + ".xls";
   |IP_REMOTO aAlfa; |QBF aAlfa;
   |SI aAlfa ! "";
      |RECIBE_FICHERO Comodin, Comodin1;
   |SINO;
      |COPIA_FICHERO Comodin, Comodin1;
   |FINSI;
   FSalida = 1;

   |HAZ ReponBotones;
|FPRC;

|PROCESO Proceso03;
   |HAZ EscondeBotones;

   |HAZ CopiaNuevo;
   Comodin = "caycosy0.tab;1,12"; |SUB_EJECUTA_NP Comodin;
   Comodin = "caycosy0.tab;1,9";  |SUB_EJECUTA_NP Comodin;
   Comodin = "caycosy0.tab;1,6";  |SUB_EJECUTA_NP Comodin;
   Comodin = "caycosy0.tab;1,3";  |SUB_EJECUTA_NP Comodin;
   Comodin = "caycosy0.tab;0,0";  |SUB_EJECUTA_NP Comodin;

   |DBASE Comodin1; |QBF Comodin1;
   Comodin1 = Comodin1 + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
   Comodin1 = Comodin1 + "BAL_SUMS*.xls";
   |_PDIR Comodin1;
   |SI FSalida = 0;
      |PARA; |SI FSalida = 0; |HACIENDO;
         Comodin = Comodin1 % -107; Comodin = Comodin % 0103;
         Numeracion = Comodin; Numeracion = Numeracion + 1;
         |_SDIR Comodin1;
      |SIGUE;
   |SINO;
      Numeracion = 1;
   |FINSI;

   Comodin = "c:/tmp1.xls";
   |DBASE Comodin1; |QBF Comodin1;
   Comodin1 = Comodin1 + "hacienda/PresLibr/";
   |MKDIR Comodin1;
   Comodin1 = Comodin1 + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
   |MKDIR Comodin1;
   Comodin1 = Comodin1 + "BAL_SUMS_" + (("000" + Numeracion) % -103) + ".xls";
   |IP_REMOTO aAlfa; |QBF aAlfa;
   |SI aAlfa ! "";
      |RECIBE_FICHERO Comodin, Comodin1;
   |SINO;
      |COPIA_FICHERO Comodin, Comodin1;
   |FINSI;
   FSalida = 1;

   |HAZ ReponBotones;
|FPRC;

|PROCESO Proceso07;
   |HAZ EscondeBotones;
   |HAZ CopiaNuevo;
   |SUB_EJECUTA_NP "camaydia.tab;PRUEBA";
   |HAZ ReponBotones;
|FPRC;

|PROCESO Proceso10;
   |HAZ EscondeBotones;
   |HAZ CopiaNuevo;
   |SUB_EJECUTA_NP "cay4ivav.tab;PRUEBA";
   |HAZ ReponBotones;
|FPRC;

|PROCESO Proceso11;
   |HAZ EscondeBotones;
   |HAZ CopiaNuevo;
   |SUB_EJECUTA_NP "cay4ivac.tab;PRUEBA";
   |HAZ ReponBotones;
|FPRC;

|PROCESO Empresas;
   #48#2 = #cabucem1#0;
   #48#3 = #cabucem1#1;
   |LEE 000#48=;
   |SI FSalida = 0;
      |DBASE Comodin; |QBF Comodin;
      Comodin = Comodin + "fich/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
      |PATH_DAT #2 Comodin;
      |ABRE #caportad;
      |HAZ MiraCabecera;
      |DBASE Comodin; |QBF Comodin;
      Comodin = Comodin + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
      |CIERRA #caportad;
      |HAZ CreaSecuenciales;
   |FINSI;
|FPRC;

|DEFBUCLE Empresas;
#cabucem1#1;
;
INICIO;
FINAL;
;
NULL,Empresas;
|FIN;

|PROCESO PasaFicheros;
   |DBASE aOrigen; |QBF aOrigen;
   aOrigen = aOrigen + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/*.*";
   Comodin = aOrigen - "*.*";
   |_PDIR aOrigen;
   |PARA; |SI FSalida = 0; |HACIENDO;
      aDestino = aPath + ((("00000" + #cabucem1#0) % -105) + #cabucem1#1) + "/";
      |RMKDIR aDestino;
      aDestino = aDestino + (aOrigen - Comodin);
      |SI Local = 0;
         |ENVIA_FICHERO aOrigen, aDestino;
      |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
      |FINSI;
      |FBORRA aOrigen;
      |_SDIR aOrigen;
   |SIGUE;
   |RMDIR Comodin;
|FPRC;

|DEFBUCLE PasaFicheros;
#cabucem1#1;
;
INICIO;
FINAL;
;
NULL,PasaFicheros;
|FIN;

|PROCESO Proceso14;
   |ABRE #48;
   |BUCLE Empresas;
   |CIERRA #48;

   Comodin = ""; |IP_REMOTO Comodin; |QBF Comodin;
   |SI Comodin = "";
      Local = 1;
   |SINO;
      Local = 0;
   |FINSI;

   Comodin = aPath % -101;
   |SI Comodin ! "/";
      |SI Comodin ! "\";
         aPath = aPath + "/";
      |FINSI;
   |FINSI;

   |BUCLE PasaFicheros;
   |MENAV "    Ficheros creados satisfactoriamente";
|FPRC;

|PROCESO Proceso15;
   Calc = 1; |PULSATECLA; |PTEC 801;
|FPRC;

|PROCESO EmpresReo;
   |HAZ EscondeBotones;
   |HAZ CopiaNuevo;

   |ABRE #30;
   #30#2 = #cabucem1#0;
   #30#3 = #cabucem1#1;
   |LEE 000#30=;
   |SI FSalida = 0;
      Calc = #30#26;
      |SI Calc ] 80;
         Calc = Calc + 1900;
      |SINO;
         Calc = Calc + 2000;
      |FINSI;
      |SI aTipo = "venta";
         Comodin = ":agieos/eosivacl.tab;";
      |SINO;
         Comodin = ":agieos/eosivapr.tab;";
      |FINSI;
      Comodin = Comodin + #cabucem1#0 + "," + Calc; |SUB_EJECUTA_NP Comodin;
   |FINSI;
   |CIERRA #30;

   |DBASE Comodin1; |QBF Comodin1;
   Comodin1 = Comodin1 + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
   |SI aTipo = "venta";
      Comodin1 = Comodin1 + "FAC_EMIT*.xls";
   |SINO;
      Comodin1 = Comodin1 + "FAC_RECI*.xls";
   |FINSI;
   |_PDIR Comodin1;
   |SI FSalida = 0;
      |PARA; |SI FSalida = 0; |HACIENDO;
         Comodin = Comodin1 % -107; Comodin = Comodin % 0103;
         Numeracion = Comodin; Numeracion = Numeracion + 1;
         |_SDIR Comodin1;
      |SIGUE;
   |SINO;
      Numeracion = 1;
   |FINSI;

   Comodin = "c:/tmp1.xls";
   |DBASE Comodin1; |QBF Comodin1;
   Comodin1 = Comodin1 + "hacienda/PresLibr/";
   |MKDIR Comodin1;
   Comodin1 = Comodin1 + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
   |MKDIR Comodin1;
   |SI aTipo = "venta";
      Comodin1 = Comodin1 + "FAC_RECI_" + (("000" + Numeracion) % -103) + ".xls";
   |SINO;
      Comodin1 = Comodin1 + "FAC_EMIT_" + (("000" + Numeracion) % -103) + ".xls";
   |FINSI;
   |IP_REMOTO aAlfa; |QBF aAlfa;
   |SI aAlfa ! "";
      |RECIBE_FICHERO Comodin, Comodin1;
   |SINO;
      |COPIA_FICHERO Comodin, Comodin1;
   |FINSI;
   FSalida = 1;

   |HAZ ReponBotones;
|FPRC;

|DEFBUCLE EmpresReo;
#cabucem1#1;
;
INICIO;
FINAL;
;
NULL,EmpresReo;
|FIN;

|PROCESO Proceso51;
   aTipo = "venta"; |BUCLE EmpresReo;
|FPRC;

|PROCESO Proceso52;
   aTipo = "compra"; |BUCLE EmpresReo;
|FPRC;

|PROCESO Borrado;
   Comodin = aPath + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
   Comodin1 = Comodin + "datos.txt";   |RFBORRA Comodin1;
   Comodin1 = Comodin + "nombres.txt"; |RFBORRA Comodin1;
   |PARA nCont = 1; |SI nCont [ 999; |HACIENDO nCont = nCont + 1;
      Comodin1 = Comodin + "DIARIO_"   + (("000" + nCont) % -103) + ".xls";
      |RFBORRA Comodin1;
      Comodin1 = Comodin + "BAL_SUMS_"  + (("000" + nCont) % -103) + ".xls";
      |RFBORRA Comodin1;
      Comodin1 = Comodin + "INV_CUEN_" + (("000" + nCont) % -103) + ".xls";
      |RFBORRA Comodin1;
      Comodin1 = Comodin + "MAYOR_" + (("000" + nCont) % -103) + ".xls";
      |RFBORRA Comodin1;
      Comodin1 = Comodin + "FAC_EMIT_" + (("000" + nCont) % -103) + ".xls";
      |RFBORRA Comodin1;
      Comodin1 = Comodin + "FAC_RECI_" + (("000" + nCont) % -103) + ".xls";
      |RFBORRA Comodin1;
   |SIGUE;
   |RRMDIR Comodin;
|FPRC;

|DEFBUCLE Borrado;
#cabucem1#1;
;
INICIO;
FINAL;
;
NULL,Borrado;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA "Emision de libros para su legalizacion y presentacion telematica";

   nDejaSI = 0;
   |ABRE #caconimp;
   |LEE 101#caconimp.p;
   |SI FSalida ! 0;
        |GRABA 020#caconimp.b;
   |FINSI;
   |SI #caconimp#4 = "S";
        nDejaSI = 1;
   |FINSI;
   #caconimp#4 = "N";
   |GRABA 020#caconimp.a;
   |LIBERA #caconimp;
   |CIERRA #caconimp;

   Empresa = #48#2; Periodo = #48#3;
   |ABRE #48;
   |SUB_EJECUTA "cabucemp.tab";

   |DELINDEX #casoplib; |ABRE #casoplib;
   |ABRE #cabucem1;
   |LEE 000#cabucem1.p;
   |SI FSalida ! 0; |CIERRA #cabucem1; |ACABA; |FINSI;

   aPath = "C:/Progra~1/Adhoc/Legalia/Legalia.exe";
   |XABRE "C", aPath, Handle;
   |SI FSalida < 0;
      aPath = "C:/Archiv~1/Adhoc/Legalia/Legalia.exe";
      |XABRE "C", aPath, Handle;
      |SI FSalida < 0;
         aPath = "C:/Archiv~1/Legalia/Legalia.exe";
         |XABRE "C", aPath, Handle;
         |SI FSalida < 0;
            aPath = "C:/Adhoc/Legalia/Legalia.exe";
            |XABRE "C", aPath, Handle;
            |SI FSalida < 0;
               aPath = "C:/Legalia/Legalia.exe";
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   aPath = aPath - "Legalia.exe"; aPath = aPath + "Data/";

   |PUSHV 1910 2365;
   |BLANCO 1910 2365;
   |CUADRO 1911 2364;
   |ATRI R; |PINTA 1913 , " Indique el path para dejar los archivos          "; |ATRI N;
   |ATRI R; |PINTA 2113 , " Incluir memoria del Impuesto de Sociedades S/N   "; |ATRI N;
   E_sup  = 50;
   E_inf  = "";
   aPath = 2013 ? 0;
   |QBF aPath;

   E_sup  = 1;
   E_inf  = "SN";
   aMemoria = "N";
   aMemoria = 2162 ? 0;
   |POPV;

   |BUCLE Borrado;

   Comodin = "0,9,1";
   |MENUITEM 0,Comodin; EstadoAnt = FSalida;
   |SI FSalida = "UNCHECKED";
      Comodin = "0,9,0"; |MENUITEM 0,Comodin;
      aImpre = "0";
   |SINO;
      aImpre = "1";
   |FINSI;

   |CONTROL_SIMPLE 0,"LBOTON, A) Diario                             ", 0530,0658,Proceso01; nBoton01 = FSalida;
   |CONTROL_SIMPLE 0,"LBOTON, B) Inventario y cuentas anuales       ", 0730,0858,Proceso02; nBoton02 = FSalida;
   |CONTROL_SIMPLE 0,"LBOTON, C) Balance comprobacion sumas y saldos", 0930,1058,Proceso03; nBoton03 = FSalida;
   |CONTROL_SIMPLE 0,"LBOTON, D) Mayor                              ", 1130,1258,Proceso07; nBoton04 = FSalida;
   |CONTROL_SIMPLE 0,"LBOTON, E) Facturas emitidas                  ", 1330,1458,Proceso10; nBoton05 = FSalida;
   |CONTROL_SIMPLE 0,"LBOTON, F) Facturas recibidas                 ", 1530,1658,Proceso11; nBoton06 = FSalida;
   |CONTROL_SIMPLE 0,"LBOTON, G) Generar ficheros                   ", 1730,1858,Proceso14; nBoton07 = FSalida;
   |CONTROL_SIMPLE 0,"LBOTON, S) Salir                              ", 1930,2058,Proceso15; nBoton08 = FSalida;
   |CONTROL_SIMPLE 0,"LBOTON, 1) Facturas emitidas (REO)            ", 0505,0628,Proceso51; nBoton09 = FSalida;
   |CONTROL_SIMPLE 0,"LBOTON, 2) Facturas recibidas (REO)           ", 0705,0828,Proceso52; nBoton10 = FSalida;

   ||CONTROL_SIMPLE 0,"LBOTON, L) Detalle del diario                 ", 1147,1275,Proceso01; nBoton12 = FSalida;
   ||CONTROL_SIMPLE 0,"LBOTON, M) Registro de acciones nominativas   ", 1347,1475,Proceso01; nBoton13 = FSalida;
   ||CONTROL_SIMPLE 0,"LBOTON, N) Registro de socios                 ", 1547,1675,Proceso01; nBoton14 = FSalida;
   ||CONTROL_SIMPLE 0,"LBOTON, O) Otros                              ", 1747,1875,Proceso01; nBoton15 = FSalida;
   Comodin = "Path para ficheros : " + aPath;
   |ATRI I; |PINTA 2210, Comodin; |ATRI N;

   |PARA; |SI Calc = 0; |HACIENDO;
      |LEETECLA Comodin;
   |SIGUE;

   |FIN_CONTROL_WINDOWS nBoton01;
   |FIN_CONTROL_WINDOWS nBoton02;
   |FIN_CONTROL_WINDOWS nBoton03;
   |FIN_CONTROL_WINDOWS nBoton04;
   |FIN_CONTROL_WINDOWS nBoton05;
   |FIN_CONTROL_WINDOWS nBoton06;
   |FIN_CONTROL_WINDOWS nBoton07;
   |FIN_CONTROL_WINDOWS nBoton08;
   |FIN_CONTROL_WINDOWS nBoton09;
   |FIN_CONTROL_WINDOWS nBoton10;
   ||FIN_CONTROL_WINDOWS nBoton11;
   ||FIN_CONTROL_WINDOWS nBoton12;
   ||FIN_CONTROL_WINDOWS nBoton13;
   ||FIN_CONTROL_WINDOWS nBoton14;
   ||FIN_CONTROL_WINDOWS nBoton15;
   ||FIN_CONTROL_WINDOWS nBoton16;
   |PULSATECLA;

   #48#2 = Empresa;
   #48#3 = Periodo;
   |LEE 000#48=;
   |CIERRA #48;

   |SI nDejaSI = 1;
        |ABRE #caconimp;
        |LEE 101#caconimp.p;
        #caconimp#4 = "S";
        |GRABA 020#caconimp.a;
        |LIBERA #caconimp;
        |CIERRA #caconimp;
   |FINSI;

   Comodin = "0,9," + aImpre; |MENUITEM 0,Comodin;
|FPRO;
