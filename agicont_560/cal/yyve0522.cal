|FICHEROS;
  yyve0522 #0;

  agide144 #1;   || def nuevo de CACUIVLI
  agide145 #2;   || def viejo

  agide146 #3;   || def nuevo de CAIIVREL
  agide147 #4;   || def viejo

  agide148 #5;   || def nuevo de CAIIVSOL
  agide149 #6;   || def viejo
|FIN;

|VARIABLES;
  agidef0 = "agidef0";
  v_nuevonom = "";
  v_numero = 0;
  def = "";
  sis = "";
  copy = "";
  dire = "";
  numero = 0;
  alfa1 = "";
  alfa3 = "";
  otro1 = "";
  fich = "";
  campo = 0;
  borrar = "";
  campotra = 0;
  temporal1 = "";
  temporal2 = "";
  x = 0;
  salida = 0;
  pos1 = "";
  pos2 = "";
  traba = "";
  f1 = @;
  f2 = @;
  f3 = @;
  sw = 0;
  linea = 0;
  texto = "";
|FIN;

|INCLUYE camver_i;
|INCLUYE acceso_i;

****************************************************************************
      INICIO DE PROCESO
****************************************************************************

|PROCESO caminos;
  |SI enganche < 1;  |ACABA;  |FINSI;
  |PATH_DAT #1 v_path;
  |PATH_DAT #2 v_path;
  |PATH_DAT #3 v_path;
  |PATH_DAT #4 v_path;
  |PATH_DAT #5 v_path;
  |PATH_DAT #6 v_path;
|FPRC;

|PROGRAMA;

  |DDEFECTO #0;
  |HAZ caminos;
  |HAZ base;
  |SI enganche > 0;
      v_nombre = v_nomemp;
      |PINPA #0#0;
      |CUADRO 1808 2059;
      |PINTA 1909, "                                                  ";
      |ATRI I;
      |PINTA 1909, v_codigo;
      |PINTA 1915, v_period;
      |PINTA 1918, v_nombre;
      |ATRI i;
      #0#1 = "SI"; |PINTA #0#1;
      |HAZ conver;
  |SINO;
      |HAZ inicio;
      v_codigo = cod1;
      v_period = ejerc;
      v_any    = cod2;
      |HAZ lee_version;
      |SI v_switch = 1; |ACABA; |FINSI;
      |PINPA #0#0;
      |PINDA #0#0;
      |ENDATOS #1#0;
      |SI FSalida = 0; |Y #0#1 = "SI";
          |HAZ conver;
      |FINSI;
  |FINSI;
|FPRO;

|PROCESO conver;
  |HAZ borra_malos;

  |SI #0#3 = "S";
      v_nombre = "cacuivli";
      v_numero =  8;
      |ATRI P; |PINTA 0918, "*";  |ATRI 0;
      |HAZ proceso1;   || de fichero a Cabecera Extra
  |FINSI;
  |SI #0#4 = "S";
      v_nombre = "caiivrel";
      v_numero =  31;
               |PINTA 0918, " ";
      |ATRI P; |PINTA 1018, "*";  |ATRI 0;
      |HAZ proceso2;   || de fichero Introduccion IVA Repercutido Lineas
  |FINSI;

  |SI #0#5 = "S";
      v_nombre = "caiivsol";
      v_numero =  31;
               |PINTA 1018, " ";
      |ATRI P; |PINTA 1118, "*";  |ATRI 0;
      |HAZ proceso3;   || de fichero Introduccion IVA Soportado Lineas
  |FINSI;

  |HAZ gra_version;
|FPRC;

|PROCESO pinta;
  numero = numero + 1;
  alfa3 = numero;  alfa3 = "      " + numero;  alfa3 = alfa3 % -106;
  |PINTA 2170, alfa3;
|FPRC;

****************************************************************************
      LECTURA Y GRABACION
****************************************************************************
|PROCESO proceso1;
  numero = 0;
  |NOME_DAT #2 agidef0;
  |DELINDEX #2;
  |ABRE #2;
  |CIERRA #2;
  temporal1 = fich + "agidef0.ddx";
  temporal2 = fich + v_nombre + ".ddx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  temporal1 = fich + "agidef0.ixx";
  temporal2 = fich + v_nombre + ".ixx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  |DELINDEX #2;
  |NOME_DAT #1 v_nombre;
  |ABRE #1;        || def nuevo
  |CIERRA #1;
  |GRABAENDEF v_nombre,"";
|FPRC;

|PROCESO proceso2;
  numero = 0;
  |NOME_DAT #4 agidef0;
  |DELINDEX #4;
  |ABRE #4;
  |CIERRA #4;
  temporal1 = fich + "agidef0.ddx";
  temporal2 = fich + v_nombre + ".ddx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  temporal1 = fich + "agidef0.ixx";
  temporal2 = fich + v_nombre + ".ixx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  |DELINDEX #4;
  |NOME_DAT #3 v_nombre;
  |ABRE #3;        || def nuevo
  |CIERRA #3;
  |GRABAENDEF v_nombre,"";
|FPRC;

|PROCESO proceso3;
  numero = 0;
  |NOME_DAT #6 agidef0;
  |DELINDEX #6;
  |ABRE #6;
  |CIERRA #6;
  temporal1 = fich + "agidef0.ddx";
  temporal2 = fich + v_nombre + ".ddx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  temporal1 = fich + "agidef0.ixx";
  temporal2 = fich + v_nombre + ".ixx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  |DELINDEX #6;
  |NOME_DAT #5 v_nombre;
  |ABRE #5;        || def nuevo
  |CIERRA #5;
  |GRABAENDEF v_nombre,"";
|FPRC;
|| ***********************************************************************
|PROCESO borra_malos;
  dire = "";
  |DIRECTORIO dire;
  borrar = dire + "bin/agirm " + fich + "agidef0.*";
  |SYSTEM borrar;
|FPRC;

|PROCESO mayor; |TIPO 0;
  #0Campo = #0Campo > #0Campo;
  |PINTA #0Campo;
|FPRC;

|PROCESO lo_que_digo; |TIPO 0;
  |HAZ mayor;
  |CAMPO_VISUAL   #0#3, 1, "N";
  |CAMPO_VISUAL   #0#4, 1, "N";
  |CAMPO_VISUAL   #0#5, 1, "N";
  |CAMPO_VISUAL   #0#6, 1, "N";

  |CAMPO_MODIFICA #0#3, 1, "N";
  |CAMPO_MODIFICA #0#4, 1, "N";
  |CAMPO_MODIFICA #0#5, 1, "N";
  |CAMPO_MODIFICA #0#6, 1, "N";

  |HAZ que_me_dices;
  |SI lo_que_dices = 0; |ACABA; |FINSI;

  #0#1 = "SI"; |PINTA #0#1;

  |CAMPO_VISUAL   #0#3, 1, "S";
  |CAMPO_VISUAL   #0#4, 1, "S";
  |CAMPO_VISUAL   #0#5, 1, "S";
||  |CAMPO_VISUAL   #0#6, 1, "S";

  |CAMPO_MODIFICA #0#3, 1, "S";
  |CAMPO_MODIFICA #0#4, 1, "S";
  |CAMPO_MODIFICA #0#5, 1, "S";
||  |CAMPO_MODIFICA #0#6, 1, "S";
|FPRC;

****************************************************************************
      ACTUALIZACION FICHERO PUENTE SOBRE FICHERO ACTUAL
****************************************************************************
|PROCESO actualiz2;
    temporal1 = fich + "agidef0.ixx";
    temporal2 = fich + v_nombre + ".ixx";
    |COPIA_FICHERO temporal1,temporal2;
    |SI FSalida ! 0;  |ACABA;  |FINSI;
    temporal1 = fich + "agidef0.dat";
    temporal2 = fich + v_nombre + ".dat";
    |COPIA_FICHERO temporal1,temporal2;
    |SI FSalida ! 0;
        temporal2 = fich + v_nombre + ".ixx";
        |FBORRA temporal2;
        |ACABA;
    |FINSI;
    temporal1 = fich + "agidef0.ddx";
    temporal2 = fich + v_nombre + ".ddx";
    |COPIA_FICHERO temporal1,temporal2;
|FPRC;
