|FICHEROS;
     cacieex4 #0;   || Auxiliar Apuntes Lineas
     cacieex2 #11;  || def de proceso Cabecera

     cacuenta #1;   || cuentas
     camaasic #2;   || apuntes cabs.
     camaasil #3;   || apuntes lins.
     caconcep #4;   || conceptos automaticos
     camandia #5;   || diarios
     caconasi #20;  || Contador Asientos
     caconiso #100; || Control de Asientos

     :/contasoc/def/ctw00001 #900;
     :/contasoc/def/ctw00002 #901;
|FIN;

|VARIABLES;
    &entrada = 1;
    &modcon  = 0;
    &swpanta = 0;
    &swcalcu = 0;
    &algun   = 0;

    salidas  = 0;
    nNume    = 0;
    nNume1   = 0;
    nNume2   = 0;
    nDiDeAnt = 0;
    nDiHaAnt = 0;
    nCoAnt   = 0;
    nImpAnt  = 0;
    nCampo   = 0;
    nCampo1  = 0;
    nCont    = 0;
    nSw      = 0;
    nLineal  = 0;
    nConcep  = 0;
    nImport  = 0;
    nCampos  = 0;
    nDigito  = 0;
    nRetencion = 0;
    nBeneficio = 0;

    aLong    = "";
    aAvisos  = "";
    aCtDeAnt = "";
    aCtHaAnt = "";
    aDeAnt   = "";
    aDhAnt   =  "";
    aAlfa1   = "";
    aAlfa2   = "";
    aAlfa    = "";
    aConcep  = "";
    aCuenta  = "";
|FIN;

|INCLUYE inici1_i;
|INCLUYE puntos_i;

|PROCESO Aviso5;         || desde calculo 'c_importe' (camaasil)
     |PUSHV 09101171;

     |HAZ ColorF;
     |CUADRO 09 10 11 71;
     |HAZ ColorC;
     |QBF aAvisos;

     aAlfa1 = aAvisos % 0;  nNume1 = aAlfa1;
     nNume2 = ((60 - nNume1) / 2) ! 0;
     nNume1 = 60 - nNume1 - nNume2;
     aAvisos = (" " * nNume1) + aAvisos + (" " * nNume2);        || lo centra

     |PINTA 1011, aAvisos;
     |ATRI 0;
     |AVISO;
|FPRC;

|PROCESO Aviso9;         || desde calculo 'descuadre', 'modbaj'
     |ATRI 0;
     |POPV;
|FPRC;

|PROCESO CuenFin; |TIPO 0;
     |HAZ Signo;
     nCampo  = Campo;
     nCampo1 = Campo + 1;
     #1#0 = #0nCampo;
     #1#1 = #0nCampo1;
     |LEE 001#1=;
     |SI FSalida ! 0;  |ERROR;  |ACABA;  |FINSI;
     |SI #1#3 = "N";
         |MENAV "     La Cuenta NO tiene PASE DIRECTO";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO CuentaTl;
     aAlfa1 = #0nCampo;    |QBF aAlfa1;
     aAlfa2 = aAlfa1 % 0;
     aLong  = aAlfa2;
     nCont  = 0;
     nSw    = 0;

     |SI aLong = dig4;  nSw = 1;  #0nCampo1 = 1;  |FINSI;
     |SI aLong = dig5;  nSw = 1;  #0nCampo1 = 2;  |FINSI;
     |SI aLong = dig6;  nSw = 1;  #0nCampo1 = 3;  |FINSI;
     |SI aLong = dig7;  nSw = 1;  #0nCampo1 = 4;  |FINSI;
     |SI aLong = dig8;  nSw = 1;  #0nCampo1 = 5;  |FINSI;
     |SI aLong = dig9;  nSw = 1;  #0nCampo1 = 6;  |FINSI;
     |SI aLong = 0;     nSw = 1;  #0nCampo1 = 0;  |FINSI;

     |SI nSw = 0;
         #0nCampo1 = 0;
         |MENAV "      Longitud de Cuenta Fuera de Nivel ";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Cuenta; |TIPO 6;                    || desde campo 'cuenta'
     salidas = FSalida;
     |SI salidas = 15;
         |SI Campo = 8;
             #0#8 = aCtHaAnt;
             #0#9 = nDiHaAnt;
         |FINSI;
         |SI Campo = 10;
             #0#10 = aCtDeAnt;
             #0#11 = nDiDeAnt;
         |FINSI;
         |PINTA #0Campo;
         salidas = 0;
     |FINSI;

     p_alfa1 = #0Campo;
     salidas = FSalida;
     mierda  = 0;

     |HAZ punto;
     |SI p_error ! 0;  |ERROR;  |ACABA;  |FINSI;

     nCampo  = Campo;
     nCampo1 = Campo + 1;
     |HAZ CuentaTl;
|FPRC;

|PROCESO CCuenta; |TIPO 7;
     nNume = (FEntrada / 100) ! 0;
     |C_M #0#8,  1, "S";
     |C_M #0#10, 1, "S";

     |SI #0#8 ! "            "; |O #0#10 ! "            ";
         |SI Campo = 8;  |Y #0#10 ! "            "; |C_M #0#8, 1,"N"; |FINSI;
         |SI Campo = 10; |Y #0#8  ! "            "; |C_M #0#10,1,"N"; |FINSI;
     |FINSI;
|FPRC;

|PROCESO NoCero; |TIPO 0;
     salidas = FSalida;
     |HAZ Aviso9;
     |SI #0Campo = 0; |Y salidas ! 11;
         |ERROR;
         |ACABA;
     |SINO;
         |SI salidas = 11;   || <F3>
             |SI #0#6 = "D";  #0#7 = #11#14 * -1;  |FINSI;
             |SI #0#6 = "H";  #0#7 = #11#14;       |FINSI;
             |PINTA #0#7;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Signo;
     #0#6 = "";
     |SI #0#10 ! "            ";
         #0#6 = "D";
         #0#2 = #0#10;
         #0#3 = #0#11;
         #0#8 = "";
         #0#9 = 0;
     |FINSI;

     |SI #0#8  ! "            ";
         #0#6 = "H";
         #0#2 = #0#8;
         #0#3 = #0#9;
         #0#10 = "";
         #0#11 = 0;
     |FINSI;
|FPRC;

|PROCESO CImporte; |TIPO 7;
     |HAZ Signo;
     nNume = (FEntrada / 100) ! 0;
     |SI nNume = 1;
         #0#7 = nImpAnt;
         |PINTA #0#7;
     |FINSI;
|FPRC;

|PROCESO CDescrip; |TIPO 7;
     |PTEC 816;
|FPRC;

|PROCESO Descrip; |TIPO 0;
     salidas = FSalida;
     |SI FSalida = 15;
         #0#5 = aDeAnt;
         |PINTA #0#5;
     |FINSI;
|FPRC;

|PROCESO Concepto; |TIPO 0;             || desde campo 'concepto'
     salidas = FSalida;
     |ABRE #4;
     #4#0 = #0#4;
     |LEE 040#4=;
     |SI FEntrada = 101;
         |SI #0#4 = nCoAnt; |Y #11#12 ! #11#13;
             #0#5 = aDeAnt;
         |SINO;
             #0#5 = #4#1;
         |FINSI;
     |SINO;
         |SI #0#4 = nCoAnt;
             #0#5 = aDeAnt;
         |SINO;
             #0#5 = #4#1;
         |FINSI;
     |FINSI;
     |PINTA #0#5;
     |CIERRA #4;
|FPRC;

|PROCESO ColorC;        || activa el color caracter en Avisos
     |COLOR 14, 0;
     |ATRI 0;
|FPRC;

|PROCESO ColorF;        || activa el color graficos en Avisos
     |COLOR 4, 0;
     |ATRI 0;
|FPRC;


|PROCESO Tipo3; |TIPO 3;          || desde campo 'linea'
     aAlfa1 = #0#10;   |QBF aAlfa1;
     aAlfa2 = #0#8;    |QBF aAlfa2;
     |SI aAlfa1 = "";  |Y aAlfa2 = "";    ||al menos una cuenta cargada;
         aAvisos = "ATENCION!!! Apunte sin cuentas ...";
         |HAZ Aviso5;
         |PAUSA;
         |HAZ Aviso9;
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #0#7 = 0;                       || importe distinto de cero
         aAvisos = "ATENCION!!! Importe cero ...";
         |HAZ Aviso5;
         |PAUSA;
         |HAZ Aviso9;
         |ERROR;
         |ACABA;
     |FINSI;

     |SI aAlfa1 ! "";
         aCtDeAnt = #0#10;
         nDiDeAnt = #0#11;
     |FINSI;

     |SI aAlfa2 ! "";
         aCtHaAnt = #0#8;
         nDiHaAnt = #0#9;
     |FINSI;

     nCoAnt  = #0#4;
     aDeAnt  = #0#5;
     aDhAnt  = #0#6;
     nImpAnt = #0#7;
|FPRC;

|PROCESO Salta; |TIPO 0;
     salidas = FSalida;
     |SI FEntrada = 101; |Y #0#1 ! 1;
         |SI nCoAnt ! 0;
             #0#4 = nCoAnt;
             #0#5 = aDeAnt;
             #0#6 = aDhAnt;
         |FINSI;
         |PINTA #0#4;
         |PINTA #0#5;
     |FINSI;
|FPRC;


|PROCESO Tipo2; |TIPO 2;
     |HAZ Signo;

     |SI #0#6 = "D"; #11#12 = #11#12 +. #0#7; |FINSI;
     |SI #0#6 = "H"; #11#13 = #11#13 +. #0#7; |FINSI;

     #11#14 = #11#12 - #11#13;

     |PINTA #11#12;  |PINTA #11#13;  |PINTA #11#14;
|FPRC;

|PROCESO ConGruEnl;
     #11#11 = "N";
     |SI #11#14 ! 0;
         |MENAV "    EL ASIENTO NO ESTA CUADRADO";
     |FINSI;

     nNume = #11#12;
     |SI #11#10 [ 0; nNume = -nNume; |FINSI;
     |SI #11#10 ! nNume;
         ||MENAV "    EL ASIENTO NO COINCIDE CON EL IMPUESTO A DEVENGAR";
     |FINSI;
     #11#11 = "S";
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
      salidas = FSalida;
      |SI salidas = 1;
          |HAZ ConGruEnl;
          salidas = 0;
      |FINSI;
|FPRC;

|| **********************************************************************
|| PORCESO DE CREACION DE LAS LINEAS
|| **********************************************************************

|PROCESO PonSaldo;
     |SI #0#6 = "D";
         #11#12 = #11#12 + #0#7;
     |SINO;
         #11#13 = #11#13 + #0#7;
     |FINSI;
     #11#14 = #11#12 - #11#13;

     |PINTA #11#12;
     |PINTA #11#13;
     |PINTA #11#14;

     |SI #0#2 = #100#7;  |Y #0#3 = #100#8;
         |SI #0#6 = "D";  nBeneficio = nBeneficio - #0#7;  |FINSI;
         |SI #0#6 = "H";  nBeneficio = nBeneficio + #0#7;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Asiento1;
     nLineal = nLineal + 1;

     |DDEFECTO #0;
     #0#0  = #11#29;
     #0#1  = nLineal;

     #0#2    = #100#4;  p_alfa1 = #100#4;  Campo = 2;  mierda = 1;  |HAZ punto;
     nCampo  = 2;   nCampo1 = 3;   |HAZ CuentaTl;

     #0#3  = #100#5;
     #0#4  = #100#34;
     #0#5  = #100#35;
     #0#6  = "D";
     #0#7  = -#11#8;
     #0#10 = #0#2;
     #0#11 = #100#5;
     |GRABA 020#0n;

     |HAZ PonSaldo;

     nLineal = nLineal + 1;

     |DDEFECTO #0;
     #0#0  = #11#29;
     #0#1  = nLineal;
     #0#2  = #100#1;
     #0#3  = #100#2;
     #0#4  = #100#34;
     #0#5  = #100#35;
     #0#6  = "H";
     #0#7  = -#11#8;
     #0#8  = #100#1;
     #0#9  = #100#2;
     |GRABA 020#0n;

     |HAZ PonSaldo;
|FPRC;

|PROCESO Asiento2;
     nLineal = nLineal + 1;

     |DDEFECTO #0;
     #0#0  = #11#29;
     #0#1  = nLineal;
     #0#2  = #100#1;
     #0#3  = #100#2;
     #0#4  = #100#34;
     #0#5  = #100#35;
     #0#6  = "D";
     #0#7  = #11#8;
     #0#10 = #100#1;
     #0#11 = #100#2;
     |GRABA 020#0n;

     |HAZ PonSaldo;

     nLineal = nLineal + 1;

     |DDEFECTO #0;
     #0#0  = #11#29;
     #0#1  = nLineal;
     #0#2  = #100#7;
     #0#3  = #100#8;
     #0#4  = #100#34;
     #0#5  = #100#35;
     #0#6  = "H";
     #0#7  = #11#8;
     #0#8  = #100#7;
     #0#9  = #100#8;
     |GRABA 020#0n;

     |HAZ PonSaldo;
|FPRC;

|PROCESO Asiento3;
     nLineal = nLineal + 1;
     |DDEFECTO #0;
     #0#0  = #11#29;
     #0#1  = nLineal;
     #0#2  = #100#13;
     #0#3  = #100#14;
     #0#4  = #100#44;
     #0#5  = #100#45;

     |SI #11#9 ] 0;
         #0#6  = "D";
         #0#7  = #11#9;
         #0#10 = #100#13;
         #0#11 = #100#14;
         |GRABA 020#0n;
     |SINO;
         #0#6  = "H";
         #0#7  = -#11#9;
         #0#8  = #100#13;
         #0#9  = #100#14;
         |GRABA 020#0n;
     |FINSI;

     |HAZ PonSaldo;

     |SI #11#8 ] 0;
         aCuenta = #100#7;
         nDigito = #100#8;
     |SINO;
         #0#2   = #100#4;  p_alfa1 = #100#4;  Campo = 2;  mierda = 1; |HAZ punto;
         nCampo = 2;   nCampo1 = 3;   |HAZ CuentaTl;
         aCuenta = #0#2;
         nDigito = #0#3;
     |FINSI;

     nLineal = nLineal + 1;
     |DDEFECTO #0;
     #0#0  = #11#29;
     #0#1  = nLineal;
     #0#2  = aCuenta;
     #0#3  = nDigito;
     #0#4  = #100#44;
     #0#5  = #100#45;

     |SI #11#9 < 0;
         #0#6  = "D";
         #0#7  = -#11#9;
         #0#10 = aCuenta;
         #0#11 = nDigito;
         |GRABA 020#0n;
     |SINO;
         #0#6  = "H";
         #0#7  = #11#9;
         #0#8  = aCuenta;
         #0#9  = nDigito;
         |GRABA 020#0n;
     |FINSI;

     |HAZ PonSaldo;
|FPRC;

|PROCESO Asiento4;
     |SI #901#4 = 0;  |ACABA;  |FINSI;

     nLineal = nLineal + 1;
     |DDEFECTO #0;
     #0#0  = #11#29;
     #0#1  = nLineal;
     #0#2  = #901#0;
     #0#3  = #901#5;
     #0#4  = #100#46;
     #0#5  = #100#47;
     #0#6  = "H";
     #0#7  = #901#4;
     #0#8  = #901#0;
     #0#9  = #901#5;
     |GRABA 020#0n;

     |HAZ PonSaldo;
|FPRC;

|DEFBUCLE caw000061;
     #901#1;
     ;
     "            ";
     "zzzzzzzzzzzz";
     ;
     NULL, Asiento4;
|FIN;

|PROCESO PonAsiento5;
     |SI #900#3 = 0;  |ACABA;  |FINSI;

     nLineal = nLineal + 1;
     |DDEFECTO #0;
     #0#0  = #11#29;
     #0#1  = nLineal;
     #0#2  = #900#1;
     #0#3  = #900#4;
     #0#4  = nConcep;
     #0#5  = aConcep;

     |SI nImport < 0;
         #0#6  = "D";
         #0#7  = #900#3;
         #0#10 = #900#1;
         #0#11 = #900#4;
         |GRABA 020#0n;
     |SINO;
         #0#6  = "H";
         #0#7  = #900#3;
         #0#8  = #900#1;
         #0#9  = #900#4;
         |GRABA 020#0n;
     |FINSI;

     |HAZ PonSaldo;
|FPRC;

|DEFBUCLE caw000051;
     #900#1;
     ;
     nCampos, "            ";
     nCampos, "zzzzzzzzzzzz";
     ;
     NULL, PonAsiento5;
|FIN;

|PROCESO Asiento5;
     |SI #11#34 ! 0;
         nCampos = 34;
         nConcep = #100#36;
         aConcep = #100#37;
         nImport = #11#34;
         |BUCLE caw000051;
     |FINSI;

     |SI #11#35 ! 0;
         nCampos = 35;
         nConcep = #100#38;
         aConcep = #100#39;
         nImport = #11#35;
         |BUCLE caw000051;
     |FINSI;

     |SI #11#36 ! 0;
         nCampos = 36;
         nConcep = #100#40;
         aConcep = #100#41;
         nImport = #11#36;
         |BUCLE caw000051;
     |FINSI;

     |SI #11#37 ! 0;
         nCampos = 37;
         nConcep = #100#42;
         aConcep = #100#43;
         nImport = #11#37;
         |BUCLE caw000051;
     |FINSI;

     nImport = #11#8 + #11#9;
     |SI nImport < 0;
         nLineal = nLineal + 1;
         |DDEFECTO #0;
         #0#0  = #11#29;
         #0#1  = nLineal;
         #0#2  = #100#31;
         #0#3  = #100#32;
         #0#4  = #100#48;
         #0#5  = #100#49;
         #0#6  = "D";
         #0#7  = -#11#14;
         #0#10 = #100#31;
         #0#11 = #100#32;
         |GRABA 020#0n;

         |HAZ PonSaldo;
     |SINO;
         nRetencion = #11#34 + #11#35 + #11#36 + #11#37;
         |SI nBeneficio > nRetencion;
             nLineal = nLineal + 1;
             |DDEFECTO #0;
             #0#0  = #11#29;
             #0#1  = nLineal;
             #0#2  = #100#7;
             #0#3  = #100#8;
             #0#4  = #100#48;
             #0#5  = #100#49;
             #0#6  = "D";
             #0#7  = nRetencion;
             #0#10 = #100#7;
             #0#11 = #100#8;
             |GRABA 020#0n;

             |HAZ PonSaldo;
         |SINO;
             nLineal = nLineal + 1;
             |DDEFECTO #0;
             #0#0  = #11#29;
             #0#1  = nLineal;
             #0#2  = #100#7;
             #0#3  = #100#8;
             #0#4  = #100#48;
             #0#5  = #100#49;
             #0#6  = "D";
             #0#7  = nBeneficio;
             #0#10 = #100#7;
             #0#11 = #100#8;
             |GRABA 020#0n;

             |HAZ PonSaldo;

             nLineal = nLineal + 1;
             |DDEFECTO #0;
             #0#0  = #11#29;
             #0#1  = nLineal;
             #0#2  = #100#31;
             #0#3  = #100#32;
             #0#4  = #100#48;
             #0#5  = #100#49;
             #0#6  = "D";
             #0#7  = -#11#14;
             #0#10 = #100#31;
             #0#11 = #100#32;
             |GRABA 020#0n;

             |HAZ PonSaldo;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo5;  |TIPO 5;
     nBeneficio = 0;

     |ABRE #100;
     |LEE 040#100p;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;
     |CIERRA #100;

     nLineal = 0;
     |SI #11#8 < 0;
         |HAZ Asiento1;
     |SINO;
         |HAZ Asiento2;
     |FINSI;

     |SI #11#9  ! 0;  |HAZ Asiento3;     |FINSI;

     nImport = #11#8 + #11#9;
     |SI #11#33 ! 0; |Y nImport > 0;
         |BUCLE caw000061;

         nLineal = nLineal + 1;
         |DDEFECTO #0;
         #0#0  = #11#29;
         #0#1  = nLineal;
         #0#2  = #100#7;
         #0#3  = #100#8;
         #0#4  = #100#46;
         #0#5  = #100#47;
         #0#6  = "D";
         #0#7  = #11#33;
         #0#10 = #100#7;
         #0#11 = #100#8;
         |GRABA 020#0n;

         |HAZ PonSaldo;
     |FINSI;

     |HAZ Asiento5;

     #0#1 = 1;
     |PTEC 809;
     |PTEC 815;
     |PTEC 815;
     |PTEC 815;
     |PTEC 815;
|FPRC;
