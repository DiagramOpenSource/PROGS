|FICHEROS;
  capas110 #0;
  caman110 #1;
  caportad #2;

  canempre #30;

  labempre #50;
  labtraba #51;
  nomconca #52;
  nomconli #53;
  eosm0030 #54;
  eosm0031 #55;
  eosm0032 #56;

  agicontr #99;
|FIN;

|VARIABLES;
  agi = "";
  path_fich = "";
  path_pan = "";
  trabajador = 0;
  primer = 0;
  segund = 0;
  tercer = 0;
  cuarto = 0;
  x = 0;
  letra = "";
  irpf = 0;
  desde = 0;
  hasta = 0;
  desde1 = 0;
  hasta1 = 0;
  dnitra = "";
  dnicon = "";
  encontrado = 0;

  para1 = 0;
  aClave = "";
  nMes = 0;
  nume2 = 0;
  nBase = 0;
  nPorc = 0;
  nCuot = 0;
  nGtos = 0;
  aSubClave = "";
  nEspe = 0;
  nPorE = 0;
  nCuoE = 0;
  aRepe = "";
  nTipo = 0;
  nTipoA = 0;
  nAnyo = 0;
|FIN;


|INCLUYE acceso_i;

|PROCESO mayor2;
  #0Campo = #0Campo > " ";
  |PINTA #0Campo;
|FPRC;

|PROCESO tipo8;  |TIPO 8;
  |HAZ inicio;
  |DBASS agi;
  |PATH_DAT #99 agi;
  |ABRE #99;
  |LEE 040#99p;
  |SI FSalida ! 0;
      |MENAV "      No existe <AGIFIGE>";
      |PTEC 807;
      |CIERRA #99;
      |ACABA;
  |FINSI;
  |CIERRA #99;
  path_fich = #99#2; |QBF path_fich;
  path_pan  = (path_fich - "fich/") + "pan/"
  |SI path_fich  = "*";
      |MENAV "      No esta activada la aplicacion de nominas en el <AGIFIGE>";
      |PTEC 807;
      |ACABA;
  |FINSI;
  |PATH_DAT #50 path_fich;
  |PATH_PAN #50 path_pan;
  |PATH_DAT #51 path_fich;
  |PATH_PAN #51 path_pan;
  |PATH_DAT #52 path_fich;
  |PATH_PAN #52 path_pan;
  |PATH_DAT #53 path_fich;
  |PATH_PAN #53 path_pan;
  |PATH_DAT #54 path_fich;
  |PATH_PAN #54 path_pan;
  |PATH_DAT #55 path_fich;
  |PATH_PAN #55 path_pan;
  |PATH_DAT #56 path_fich;
  |PATH_PAN #56 path_pan;
|FPRC;

|PROCESO sacacampos;  |TIPO 7;
  #0#0 = cod1;
  #0#1 = #30#1;
  #0#2 = #30#26;
  |PINTA #0#0;
  |PINTA #0#1;
  |PINTA #0#2;
|FPRC;

|PROCESO borraacumula;
  |SI #0#5 = 1;
      |CAMPO_MODIFICA #0#7, 1, "S";
  |SINO;
      |CAMPO_MODIFICA #0#7, 1, "N";
      #0#7 = "N";
      |PINTA #0#7;
  |FINSI;
|FPRC;

|PROCESO miratraba;
  dnitra = #51#7; |QBT dnitra;
  dnicon = #1#7;  |QBT dnicon;
  |SI dnitra = dnicon;
      trabajador = #51#1;
      encontrado = 1;
      |ERROR10;
      |ACABA;
  |FINSI;
  |SI #51#1 ] #0#8;  |Y #51#1 [ #0#9;
      trabajador = #51#1;
  |FINSI;
|FPRC;

|DEFBUCLE labtraba;
#51#1;
;
#0#3, 00000;
#0#3, 99999;
e;
NULL, miratraba;
|FIN;

|RUTINA buscatrabajador;
  |BUCLE labtraba;
  |SI encontrado = 1
      #1#136 = trabajador;
      |GRABA 101#1a;
      |ACABA;
  |FINSI;
  trabajador = trabajador + 1;
  #1#136 = trabajador;
  |GRABA 101#1a;
|FRUT;

|RUTINA cargatabla;
  hasta = desde1 + 23;
  hasta1 = 0;
  |PARA x = desde1;  |SI x [ hasta;  |HACIENDO x = x + 1;
        hasta1 = hasta1 + 1;
        #51x = #51x + #1desde;
        |SI hasta1 = 12;  desde = desde + 1;  |FINSI;
        desde = desde + 1;
  |SIGUE;
|FRUT;

|RUTINA buscaletra;
  |SI #51#148 = " ";  |O letra = #51#148;
      |SI #51#148 = " ";  #51#148 = letra;  #51#30  = irpf;  |FINSI;
      desde1 = 99;
      |HAZ cargatabla;
  |FINSI;
  |SI #51#228 = " ";  |O letra = #51#228;
      |SI #51#228 = " ";  #51#228 = letra;  #51#174 = irpf;  |FINSI;
      desde1 = 176;
      |HAZ cargatabla;
  |FINSI;
  |SI #51#229 = " ";  |O letra = #51#29;
      |SI #51#229 = " ";  #51#229 = letra;  #51#175 = irpf;  |FINSI;
      desde1 = 200;
      |HAZ cargatabla;
  |FINSI;
|FRUT;

/*
|RUTINA yaexiste;
  |SI #0#7 ="S";
      |PDEFECTO #51, 99, 123;
      |PDEFECTO #51, 176, 228;
      #51#151 = 0;
      #51#152 = 0;
  |FINSI;
  |SI primer = 0;                      ||ANULO LAS VARIABLES PUES NO SE GRABAN
      #1#23 = 0;  #1#24 = 0;  #1#25 = 0;  #1#36 = 0;  #1#37 = 0;  #1#38 = 0;
      #1#49 = 0;  #1#50 = 0;  #1#51 = 0;  #1#62 = 0;  #1#63 = 0;  #1#64 = 0;
      #1#75 = 0;  #1#76 = 0;  #1#77 = 0;  #1#88 = 0;  #1#89 = 0;  #1#90 = 0;
  |FINSI;
  |SI segund = 0;
      #1#26 = 0;  #1#27 = 0;  #1#28 = 0;  #1#39 = 0;  #1#40 = 0;  #1#41 = 0;
      #1#52 = 0;  #1#53 = 0;  #1#54 = 0;  #1#65 = 0;  #1#66 = 0;  #1#67 = 0;
      #1#78 = 0;  #1#79 = 0;  #1#80 = 0;  #1#91 = 0;  #1#92 = 0;  #1#93 = 0;
  |FINSI;
  |SI tercer = 0;
      #1#29 = 0;  #1#30 = 0;  #1#31 = 0;  #1#42 = 0;  #1#43 = 0;  #1#44 = 0;
      #1#55 = 0;  #1#56 = 0;  #1#57 = 0;  #1#68 = 0;  #1#69 = 0;  #1#70 = 0;
      #1#81 = 0;  #1#82 = 0;  #1#83 = 0;  #1#94 = 0;  #1#95 = 0;  #1#96 = 0;
  |FINSI;
  |SI cuarto = 0;
      #1#32 = 0;  #1#33 = 0;  #1#34 = 0;  #1#45 = 0;  #1#46 = 0;  #1#47 = 0;
      #1#58 = 0;  #1#59 = 0;  #1#60 = 0;  #1#71 = 0;  #1#72 = 0;  #1#73 = 0;
      #1#84 = 0;  #1#85 = 0;  #1#86 = 0;  #1#97 = 0;  #1#98 = 0;  #1#99 = 0;
  |FINSI;
  |SI #1#12 ! " ";  desde = 23;  letra = #1#12;  irpf = #1#9;  |HAZ buscaletra;  |FINSI;
  |SI #1#13 ! " ";  desde = 49;  letra = #1#13;  irpf = #1#10; |HAZ buscaletra;  |FINSI;
  |SI #1#14 ! " ";  desde = 75;  letra = #1#14;  irpf = #1#11; |HAZ buscaletra;  |FINSI;
  #51#151 = #51#99  + #51#100 + #51#101 + #51#102 + #51#103 + #51#104;
  #51#151 = #51#151 + #51#105 + #51#106 + #51#107 + #51#108 + #51#109 + #51#110;
  #51#152 = #51#111 + #51#112 + #51#113 + #51#114 + #51#115 + #51#116;
  #51#152 = #51#152 + #51#117 + #51#118 + #51#119 + #51#120 + #51#121 + #51#122;
  #51#224 = #51#176 + #51#177 + #51#178 + #51#179 + #51#180 + #51#181;
  #51#224 = #51#224 + #51#182 + #51#183 + #51#184 + #51#185 + #51#186 + #51#187;
  #51#226 = #51#188 + #51#189 + #51#190 + #51#191 + #51#192 + #51#193;
  #51#226 = #51#226 + #51#194 + #51#195 + #51#196 + #51#197 + #51#198 + #51#199;
  #51#225 = #51#200 + #51#201 + #51#202 + #51#203 + #51#204 + #51#205;
  #51#225 = #51#225 + #51#206 + #51#207 + #51#208 + #51#209 + #51#210 + #51#211;
  #51#227 = #51#212 + #51#213 + #51#214 + #51#215 + #51#216 + #51#217;
  #51#225 = #51#225 + #51#218 + #51#219 + #51#220 + #51#221 + #51#222 + #51#223;
|FRUT;
*/

|PROCESO caman110;

  |ABRE #eosm0030;
  |ABRE #eosm0031;
  |ABRE #eosm0032;
  nAnyo = #caman110#134;
  |SI nAnyo ] 80;
     nAnyo = nAnyo + 1900;
  |SINO;
     nAnyo = nAnyo + 2000;
  |FINSI;
  |HAZ Trabajador;
  |CIERRA #eosm0030;
  |CIERRA #eosm0031;
  |CIERRA #eosm0032;

  |SI #1#136 = 0;
      encontrado = 0;
      trabajador = #0#8;
      |HAZ buscatrabajador;
  |FINSI;

  |DDEFECTO #50;
  #50#0 = #0#3;
  |LEE 000#50=;

  |DDEFECTO #51;
  #51#0 = #0#3;
  #51#1 = #1#136;
  |LEE 101#51=;
  |SI FSalida ! 0;  |GRABA 020#51b;     |FINSI;

      #51#2   = #1#3;     || Nombre
      #51#3   = #1#127;   || Domicilio
      #51#4   = #1#128;   || Numero
      #51#5   = #1#130;   || Piso
      #51#6   = #1#4;     || Localidad
      #51#7   = #1#7;     || D.N.I.
      #51#8   = #1#5;     || Codigo Postal 1
      #51#9   = #1#6;     || Codigo Postal 2
      #51#10  = #1#132;   || Provincia

      #51#44  = "B";      || Situacion Baja
      #51#87  = #50#1;    || Convenio

      #51#30  = #1#9;     || % I.R.P.F. 1
      #51#174 = #1#10;    || % I.R.P.F. 1
      #51#175 = #1#11;    || % I.R.P.F. 1

      #51#99 = #1#12;     || CLAVE 1
      #51#100 = #1#13;    || CLAVE 2
      #51#101 = #1#14;    || CLAVE 3

      #51#102 = #1#137;   || SUBCLAVE 1
      #51#103 = #1#138;   || SUBCLAVE 2
      #51#104 = #1#139;   || SUBCLAVE 3

      #51#111 = 2;        || TIPO RELACION LABORAL

/*
      |SI primer = 1;
          #51#99  = #1#23;   #51#100 = #1#24;   #51#101 = #1#25;
          #51#111 = #1#36;   #51#112 = #1#37;   #51#113 = #1#38;
          #51#176 = #1#49;   #51#177 = #1#50;   #51#178 = #1#51;
          #51#188 = #1#62;   #51#189 = #1#63;   #51#190 = #1#64;
          #51#200 = #1#75;   #51#201 = #1#76;   #51#202 = #1#77;
          #51#212 = #1#88;   #51#213 = #1#89;   #51#214 = #1#90;
      |FINSI;
      |SI segund = 1;
          #51#102 = #1#26;   #51#103 = #1#27;   #51#104 = #1#28;
          #51#114 = #1#39;   #51#115 = #1#40;   #51#116 = #1#41;
          #51#179 = #1#52;   #51#180 = #1#53;   #51#181 = #1#54;
          #51#191 = #1#65;   #51#192 = #1#66;   #51#193 = #1#67;
          #51#203 = #1#78;   #51#204 = #1#79;   #51#205 = #1#80;
          #51#215 = #1#91;   #51#216 = #1#92;   #51#217 = #1#93;
      |FINSI;
      |SI tercer = 1;
          #51#105 = #1#29;   #51#106 = #1#30;   #51#107 = #1#31;
          #51#117 = #1#42;   #51#118 = #1#43;   #51#119 = #1#44;
          #51#182 = #1#55;   #51#183 = #1#56;   #51#184 = #1#57;
          #51#194 = #1#68;   #51#195 = #1#69;   #51#196 = #1#70;
          #51#206 = #1#81;   #51#207 = #1#82;   #51#208 = #1#83;
          #51#218 = #1#94;   #51#219 = #1#95;   #51#220 = #1#96;
      |FINSI;
      |SI cuarto = 1;
          #51#108 = #1#32;   #51#109 = #1#33;   #51#110 = #1#34;
          #51#120 = #1#45;   #51#121 = #1#46;   #51#122 = #1#47;
          #51#185 = #1#58;   #51#186 = #1#59;   #51#187 = #1#60;
          #51#197 = #1#71;   #51#198 = #1#72;   #51#199 = #1#73;
          #51#209 = #1#84;   #51#210 = #1#85;   #51#211 = #1#86;
          #51#221 = #1#97;   #51#222 = #1#98;   #51#223 = #1#99;
      |FINSI;
      #51#151 = #51#99  + #51#100 + #51#101 + #51#102 + #51#103 + #51#104;
      #51#151 = #51#151 + #51#105 + #51#106 + #51#107 + #51#108 + #51#109 + #51#110;
      #51#152 = #51#111 + #51#112 + #51#113 + #51#114 + #51#115 + #51#116;
      #51#152 = #51#152 + #51#117 + #51#118 + #51#119 + #51#120 + #51#121 + #51#122;
      #51#224 = #51#176 + #51#177 + #51#178 + #51#179 + #51#180 + #51#181;
      #51#224 = #51#224 + #51#182 + #51#183 + #51#184 + #51#185 + #51#186 + #51#187;
      #51#226 = #51#188 + #51#189 + #51#190 + #51#191 + #51#192 + #51#193;
      #51#226 = #51#226 + #51#194 + #51#195 + #51#196 + #51#197 + #51#198 + #51#199;
      #51#225 = #51#200 + #51#201 + #51#202 + #51#203 + #51#204 + #51#205;
      #51#225 = #51#225 + #51#206 + #51#207 + #51#208 + #51#209 + #51#210 + #51#211;
      #51#227 = #51#212 + #51#213 + #51#214 + #51#215 + #51#216 + #51#217;
      #51#225 = #51#225 + #51#218 + #51#219 + #51#220 + #51#221 + #51#222 + #51#223;
*/
  |GRABA 020#51a;
  |LIBERA #51;
|FPRC;

|DEFBUCLE caman110;
#1#1;
;
#0#0, 00001, #0#2;
#0#0, 99999, #0#2;
be;
NULL, caman110;
|FIN;

|PROCESO tipo3;  |TIPO 3;
  primer = 0;
  segund = 0;
  tercer = 0;
  cuarto = 0;
  |SI #0#5 = 1;  primer = 1;  segund = 1;  tercer = 1;  cuarto = 1;  |FINSI;
  |SI #0#5 = 2;               segund = 1;  tercer = 1;  cuarto = 1;  |FINSI;
  |SI #0#5 = 3;                            tercer = 1;  cuarto = 1;  |FINSI;
  |SI #0#5 = 4;                                         cuarto = 1;  |FINSI;
  |SI #0#6 = 1;               segund = 0;  tercer = 0;  cuarto = 0;  |FINSI;
  |SI #0#6 = 2;                            tercer = 0;  cuarto = 0;  |FINSI;
  |SI #0#6 = 3;                                         cuarto = 0;  |FINSI;
  |SI #0#6 = 4;                                                      |FINSI;
  |ABRE #50;
  |ABRET #51;
  |ABRE #52;
  |ABRE #53;
  |BUCLE caman110;
  |CIERRA #50;
  |CIERRAT #51;
  |CIERRA #52;
  |CIERRA #53;
|FPRC;

|PROCESO Trabajador;
     |HAZ GrabaCab;
     |PARA para1 = 1; |SI para1 [ 12; |HACIENDO para1 = para1 + 1;
          aClave = #caman110#12;
          aSubClave = #caman110#137;
          nMes = para1;

          nume2 = para1 + 22;   nBase = #caman110#nume2#;
          nPorc = #caman110#9;
          nume2 = para1 + 35;   nCuot = #caman110#nume2#;
          nume2 = para1 + 113;  nGtos = #caman110#nume2#;
          |HAZ GrabaLin;
     |SIGUE;

     |PARA para1 = 1; |SI para1 [ 12; |HACIENDO para1 = para1 + 1;
          aClave = #caman110#13;
          aSubClave = #caman110#138;
          nMes = para1;

          nume2 = para1 + 48;  nBase = #caman110#nume2#;
          nPorc = #caman110#10;
          nume2 = para1 + 61;  nCuot = #caman110#nume2#;
          nGtos = 0;
          |HAZ GrabaLin;
     |SIGUE;

     |PARA para1 = 1; |SI para1 [ 12; |HACIENDO para1 = para1 + 1;
          aClave = #caman110#14;
          aSubClave = #caman110#139;
          nMes = para1;

          nume2 = para1 + 74;  nBase = #caman110#nume2#;
          nPorc = #caman110#11;
          nume2 = para1 + 87;  nCuot = #caman110#nume2#;
          nGtos = 0;
          |HAZ GrabaLin;
     |SIGUE;

     |PARA para1 = 1; |SI para1 [ 12; |HACIENDO para1 = para1 + 1;
          aClave = "L";
          aSubClave = "01";
          nMes = para1;

          nume2 = para1 + 100;  nBase = #caman110#nume2#;
          nPorc = 0;
          nCuot = 0;
          nGtos = 0;
          |HAZ GrabaLin;
     |SIGUE;

|FPRC;


|PROCESO GrabaLin;
     aClave = aClave > aClave;

     |SI aClave = " ";             |ACABA;   |FINSI;
     |SI nBase = 0;|Y nCuot = 0;
          |ACABA;
     |FINSI;

     nEspe = 0;
     nPorE = 0;
     nCuoE = 0;
     aRepe = "N";

/*
               |SI aClave = "K";|O aClave = "Y";
                    aClave = "H";
               |SINO;
                    |SI aClave = "L";|O aClave = "Z";
                         aClave = "H";
                         nEspe = nBase; nBase = 0;
                         nPorE = nPorc; nPorc = 0;
                         nCuoE = nCuot; nCuot = 0;
                         |SI nPorE ! 0; aRepe = "S";   |FINSI;
                    |SINO;
                         |SI aClave = "E";
                              aClave = "L";
                         |FINSI;
                    |FINSI;
               |FINSI;
*/

     nTipo = 0;
     |SI aClave = "A";
          nTipo = nTipoA;
          |SI nTipo = 0; nTipo = 1;     |FINSI;
     |FINSI;

     |DDEFECTO #eosm0032;
     #eosm0032#0 = #capas110#3;    || empresa
     #eosm0032#1 = nAnyo;          || a¤o
     #eosm0032#2 = #caman110#7;    || nif
     #eosm0032#3 = aClave;         || clave
     #eosm0032#4 = aSubClave;      || subclave
     #eosm0032#5 = nTipo;          || tipo relacion
     #eosm0032#6 = nMes;           || mes
     |LEE 101#eosm0032.=;
     |SI FSalida ! 0;
          |GRABA 020#eosm0032.b;
     |FINSI;

     #eosm0032#7 = #eosm0032#7 + nBase;      || base
     #eosm0032#9 = #eosm0032#9 + nCuot;      || cuota
     #eosm0032#8 = (#eosm0032#9 * 100) / #eosm0032#7;       || (%) dinerarias
     #eosm0032#10 = #eosm0032#10 + nEspe;    || en especie
     #eosm0032#12 = #eosm0032#12 + nCuoE;    || cuota en especie
     #eosm0032#11 = (#eosm0032#12 * 100) / #eosm0032#10;    || (%) en especie
     #eosm0032#13 = aRepe;                   || repercute
     #eosm0032#15 = #eosm0032#15 + nGtos;    || gastos 17.3

     |GRABA 020#eosm0032.a;
     |LIBERA #eosm0032;
|FPRC;

|PROCESO GrabaCab;
     |DDEFECTO #eosm0030;
     #eosm0030#0 = #capas110#3;
     #eosm0030#1 = nAnyo;
     |LEE 101#eosm0030.=;
     |SI FSalida ! 0;
          |DDEFECTO #caportad;
          #caportad#0 = #caman110#0;
          |LEE 000#caportad.=;

          #eosm0030#2 = #caman110#2;
          #eosm0030#3 = " ";
          #eosm0030#16 = #caportad#46;
          #eosm0030#17 = #caportad#39;
          ||#eosm0030#18 = #labempre#18;
          |GRABA 020#eosm0030.n;
     |FINSI;
     |LIBERA #eosm0030;

     |DDEFECTO #eosm0031;
     #eosm0031#0 = #capas110#3;
     #eosm0031#1 = nAnyo;
     #eosm0031#2 = #caman110#7;
     |LEE 101#eosm0031.=;
     |SI FSalida ! 0;
          #eosm0031#3 = #caman110#2;
          |GRABA 020#eosm0031.n;
     |FINSI;
     |LIBERA #eosm0031;
|FPRC;
