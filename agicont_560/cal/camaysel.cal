|FICHEROS;
    camaysel #0;    || def de ejecuccion
    camaycab #1;    || mayor cabs.
    camaylin #2;    || mayor lins.
    camaasic #3;    || apuntes cabs.
    camaasil #4;    || apuntes lins.
    caconcep #7;    || conceptos
|FIN;

|VARIABLES;
    &entrada = 1;
    traba1 = "";
    traba2 = "";
    trame = "";
    trames = 0;
    tranyo = 0;
    tranyos = "";
    men1  = "     NO EXISTE EMPRESA !";
    men2  = "     Longitud de Cuenta Fuera de Nivel !";
    fecalf = "";
    mensa1 = "    ERROR ESTA FECHA NO CORRESPONDE AL EJERCICIO";
    prim = 0;
    desde = "            ";
    hasta = "zzzzzzzzzzzz";
    ante = "";
    parte = "";
    cien = 0;
    ciento = "";
    cuenta = "";
    feini = @;
    fefin = @;
    doini = 1;
    dofin = 999999;
    u = 0;
    v = 0;
    w = 0;
    x = 0;
    y = 0;
    z = 0;
    alfa1 = "";
    pp = 0;
|FIN;

|INCLUYE acceso_i;
____________________________________/ CALCULOS DE PANTALLA
|PROCESO nomodifi;
  alfa1 = #0#23 > " ";
  #0#23 = alfa1;
  |PINTA #0#23;
  |PARA x = 2;  |SI x [ 22;  |HACIENDO x = x + 1;
        |SI #0#23 = "N";
            |CAMPO_MODIFICA #0x,1,"N";
        |SINO;
            |CAMPO_MODIFICA #0x,1,"S";
        |FINSI;
  |SIGUE;
  |PARA x = 109;  |SI x [ 115;  |HACIENDO x = x + 1;
        |SI #0#23 = "N";
            |CAMPO_MODIFICA #0x,1,"N";
        |SINO;
            |CAMPO_MODIFICA #0x,1,"S";
        |FINSI;
  |SIGUE;
  |SI #0#23 = "N";
      |CAMPO_MODIFICA #0#108,1,"S";
      |CAMPO_MODIFICA #0#105,1,"S";
  |SINO;
      #0#105 = "";
      |PINTA #0#105;
      |CAMPO_MODIFICA #0#108,1,"N";
      |CAMPO_MODIFICA #0#105,1,"N";
  |FINSI;
|FPRC;

|PROCESO comprueb; |TIPO 0;
  |SI #0#24 > dig3;  |ERROR;  |ACABA;  |FINSI;
  |SI #0#24 = 1; cien = 100 + dig4;  |FINSI;
  |SI #0#24 = 2; cien = 100 + dig5;  |FINSI;
  |SI #0#24 = 3; cien = 100 + dig6;  |FINSI;
  |SI #0#24 = 4; cien = 100 + dig7;  |FINSI;
  |SI #0#24 = 5; cien = 100 + dig8;  |FINSI;
  |SI #0#24 = 6; cien = 100 + dig9;  |FINSI;
  ciento = cien;
|FPRC;

|PROCESO empieza;  |TIPO 7;
  |HAZ inicio;
  trame   = fec1 % 402;
  trames  = trame;
  tranyos = fec1 % -104;
  tranyo  = tranyos;
  |HAZ calfecha;
  tra1 = 10000 + tranyo;
  traba1 = tra1 % -104;
  traba1 = dia1 + "." + trame + "." + traba1;
  #0#85 = fec1;
  |PARA x = 86;  |SI x [ 104;  |HACIENDO x = x + 1;
        #0x = traba1;
        |SI x [ 96; |HAZ cosas; |FINSI;
  |SIGUE;
|FPRC;

|PROCESO calfecha;
  dia1 = "31";
  |SI trames = 4; |O trames = 6; |O trames = 9; |O trames = 11;
      dia1 = "30";
  |FINSI;
  |SI trames = 2;
      dia1 = "28";
      |SI tranyo = 1988; |O tranyo = 1992; |O tranyo = 1996; |O tranyo = 2000; |O tranyo = 2004;
          dia1 = "29" ;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO cosas;
  trames = trames + 1;
  |SI trames > 12;
      trames = 1;
      tranyo = tranyo + 1;
  |FINSI;
  |HAZ calfecha;
  tra1 = 10000 + tranyo;
  traba2 = tra1 % -104;
  tra1 = 100 + trames;
  traba1 = tra1 % -102;
  traba1 = dia1 + "." + traba1 + "." + traba2;
|FPRC;

|PROCESO concepto; |TIPO 0;        || desde campo 'concepto'
  |ABRE #7;
  #7#0 = #0Campo;
  |LEE 001#7=;
  |SI FSalida ! 0;
      |MENAV men2;
      |DDEFECTO #7;
      |CIERRA #7;
      |ERROR;
      |ACABA;
  |FINSI;
  |SI Campo = 106; |O Campo = 107; pp = Campo - 106; |FINSI;
  |SI Campo = 108; pp = 105; |FINSI;
  |SI Campo = 109; pp =   4; |FINSI;
  |SI Campo = 110; pp =   7; |FINSI;
  |SI Campo = 111; pp =  10; |FINSI;
  |SI Campo = 112; pp =  13; |FINSI;
  |SI Campo = 113; pp =  16; |FINSI;
  |SI Campo = 114; pp =  19; |FINSI;
  |SI Campo = 115; pp =  22; |FINSI;
  |SI #7#1 > "                              ";
      #0pp = #7#1;
      |PINTA #0pp;
  |FINSI;
  |CIERRA #7;
|FPRC;

____________________________________/ GRABACION DE MAYOR CABS.
|PROCESO actualiza1;
  #1#0 = #2#0;
  #1#1 = #2#1;
  #1#2 = #2#2;
  |LEE 101#1=;
  |SI FSalida ! 0;
      #1#0 = #2#0;
      #1#1 = #2#1;
      #1#2 = #2#2;
      #1#3 = #2#2;
      #1#4 = 0;
      #1#5 = 0;
      |LIBERA #1;
      |GRABA 020#1c;
      |LEE 101#1=;
  |FINSI;
  |SI #2#8 = "D";
      #1#4 = #1#4 + #2#9;
  |SINO;
      #1#5 = #1#5 + #2#9;
  |FINSI;
  |GRABA 020#1a;
  |LIBERA #1;
|FPRC;

|DEFBUCLE actualiza;
 #2#1;
 ;
  0, feini, doini,    1;
 99, fefin, dofin, 9999;
 ;
 NULL, actualiza1;
|FIN;
____________________________________/ GRABACION DE MAYOR LINS.
|PROCESO grabacion;
  |PARA x = 45;  |SI x [ 64;  |HACIENDO x = x + 1
        y = x + 20;
        z = x + 40
        w = x - 20;
        #2#0 = 1;
        #2#4 = ante;
        #2#5 = #0#24;
        #2#6 = #0#107;
        #2#7 = #0#1;
        |SI x = 45;  #2#0 = 0;  #2#6 = #0#106; #2#7 = #0#0;  |FINSI;
        |SI x ] 57; |Y #0#23 = "S";
            v = ((x - 57) * 3) + 4;
            u = (x + 52);
            #2#6 = #0u;
            #2#7 = #0v;
        |FINSI;
        |SI x = 58;  |Y #0#23 = "N";
                     #2#0 = 99;
                     #2#6 = #0#108;
                     #2#7 = #0#105;
        |FINSI;
        |SI #0x ! 0;
            #2#1 = #0z;
            #2#2 = x - 44;
            #0w = #0w + 1;
            #2#3 = #0w;
            #2#8 = "D";
            #2#9 = #0x;
            |GRABA 040#2n;
        |FINSI;
        |SI #0y ! 0;
            #2#1 = #0z;
            #2#2 = x - 44;
            #0w = #0w + 1;
            #2#3 = #0w;
            #2#8 = "H";
            #2#9 = #0y;
            |GRABA 040#2n;
        |FINSI;
  |SIGUE;
  |HAZ acerando;
|FPRC;

|PROCESO lee_apuntes1;
  |SI prim = 0;
      prim = 1;
      ante = #4#4 % ciento;
  |FINSI;
  cuenta = #4#4 % ciento;

  |SI ante ! cuenta;
      |HAZ grabacion;
      ante = #4#4 % ciento;
  |FINSI;
  |SI #4#0 = 0;
      |SI #4#8 = "D";
          #0#45 = #0#45 + #4#9;
      |SINO;
          #0#65 = #0#65 + #4#9;
      |FINSI;
      |ACABA;
  |FINSI;
  |SI #4#0 = 99; |Y #0#23 = "N";
      |SI #4#8 = "D";
          #0#58 = #0#58 + #4#9;
      |SINO;
          #0#78 = #0#78 + #4#9;
      |FINSI;
      |ACABA;
  |FINSI;

  |PARA x = 86;  |SI x [ 104;   |HACIENDO x = x + 1;
        y = x - 40;
        z = x - 20;
        |SI x < 98;  |Y #0#23 = "N";
            |SI #4#1 [ #0x;  |SAL;  |FINSI;
        |FINSI;
        |SI x < 97;
            |SI #4#1 [ #0x;  |SAL;  |FINSI;
        |SINO;
            #3#0 = #4#0;
            #3#1 = #4#1;
            #3#2 = #4#2;
            |LEE 000#3=;
            |SI #3#3 ] #0#2;  |Y #3#3 [ #0#3;   |SAL;  |FINSI;
            |SI #3#3 ] #0#5;  |Y #3#3 [ #0#6;   y=y+1; z=z+1; |SAL;  |FINSI;
            |SI #3#3 ] #0#8;  |Y #3#3 [ #0#9;   y=y+2; z=z+2; |SAL;  |FINSI;
            |SI #3#3 ] #0#11; |Y #3#3 [ #0#12;  y=y+3; z=z+3; |SAL;  |FINSI;
            |SI #3#3 ] #0#14; |Y #3#3 [ #0#15;  y=y+4; z=z+4; |SAL;  |FINSI;
            |SI #3#3 ] #0#17; |Y #3#3 [ #0#18;  y=y+5; z=z+5; |SAL;  |FINSI;
            |SI #3#3 ] #0#20; |Y #3#3 [ #0#21;  y=y+6; z=z+6; |SAL;  |FINSI;
        |FINSI;
  |SIGUE;

  |SI #4#8 = "D";
      #0y = #0y + #4#9;
  |SINO;
      #0z = #0z + #4#9;
  |FINSI;
|FPRC;

|DEFBUCLE lee_apuntes;
 #4#3;
 ;
 desde, 1, fec1,       1;
 hasta, 6, #0#104, 999999;
 ;
 NULL, lee_apuntes1;
|FIN;

|PROCESO impres; |TIPO 3;
  |ABRE #2;
  |CIERRA #2;
  |DELINDEX #2;
  |ABRE #2;
  |ABRE #3;
  |HAZ acerando;
  prim = 0;
  |BUCLE lee_apuntes;
  |HAZ grabacion;
  |CIERRA #2;
  |CIERRA #3;

  |PINTA 2410,"Recuperando Saldos de Cabeceras";
  |ABRE #1;
  |CIERRA #1;
  |DELINDEX #1;
  |ABRE #1;
  feini = "01.01.0000";
  fefin = "31.12.9999";
  |BUCLE actualiza;
  |CIERRA #1;
|FPRC;

|PROCESO acerando;
  |PARA x = 45;  |SI x [ 84;  |HACIENDO x = x + 1;
        #0x = 0;
  |SIGUE;
|FPRC;
