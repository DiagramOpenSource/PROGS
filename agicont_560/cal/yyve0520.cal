|FICHEROS;
  yyve0520 #0;
  agide103 #1;   || def nuevo clipro
  agide104 #2;   || def viejo
  agide105 #3;   || def nuevo portadas
  agide106 #4;   || def viejo

  agide107 #7;   || def nuevo Pase   Ventas Automaticas
  agide108 #8;   || def viejo Pase

  agide109 #9;   || def nuevo Desglose Cuentas.
  agide110 #10;  || def viejo

  caman300 #5;
  casopeti #6;
|FIN;

|VARIABLES;
  agidef0 = "agidef0";
  v_nuevonom = "";
  v_numero = 0;
  def = "";
  sis = "";
  copy = "";
  dire = "";
  numero = 0;
  alfa1 = "";
  alfa3 = "";
  otro1 = "";
  fich = "";
  campo = 0;
  borrar = "";
  campotra = 0;
  temporal1 = "";
  temporal2 = "";
  x = 0;
  salida = 0;
  pos1 = "";
  pos2 = "";
  traba = "";
  f1 = @;
  f2 = @;
  f3 = @;
  sw = 0;
  linea = 0;
|FIN;

|INCLUYE camver_i;
|INCLUYE acceso_i;

****************************************************************************
      INICIO DE PROCESO
****************************************************************************

|PROCESO caminos;
  |SI enganche < 1;  |ACABA;  |FINSI;
  |PATH_DAT #1 v_path;
  |PATH_DAT #2 v_path;
  |PATH_DAT #3 v_path;
  |PATH_DAT #4 v_path;
  |PATH_DAT #5 v_path;
  |PATH_DAT #6 v_path;
  |PATH_DAT #7 v_path;
  |PATH_DAT #8 v_path;
|FPRC;

|PROGRAMA;
  |DDEFECTO #0;
  |HAZ caminos;
  |HAZ base;
  |SI enganche > 0;
      v_nombre = v_nomemp;
      |PINPA #0#0;
      |CUADRO 1808 2059;
      |PINTA 1909, "                                                  ";
      |ATRI I;
      |PINTA 1909, v_codigo;
      |PINTA 1915, v_period;
      |PINTA 1918, v_nombre;
      |ATRI i;
      #0#1 = "SI"; |PINTA #0#1;
      |HAZ conver;
  |SINO;
      |HAZ inicio;
      v_codigo = cod1;
      v_period = ejerc;
      v_any    = cod2;
      |HAZ lee_version;
      |SI v_switch = 1; |ACABA; |FINSI;
      |PINPA #0#0;
      |PINDA #0#0;
      |ENDATOS #1#0;
      |SI FSalida = 0; |Y #0#1 = "SI";
          |HAZ conver;
      |FINSI;
  |FINSI;
|FPRO;

|PROCESO conver;
  |HAZ borra_malos;

  |SI #0#3 = "S";
      v_nombre = "caclipro";
      v_numero =  23;
      |ATRI P; |PINTA 0918, "*";  |ATRI 0;
      |HAZ proceso1;   || Clientes y Proveedores
      |HAZ actualiza;
  |FINSI;

  |SI #0#4 = "S";
      v_nombre = "caportad";
      v_numero =  88;
               |PINTA 0918, " ";
      |ATRI P; |PINTA 1018, "*";  |ATRI 0;
      |HAZ proceso2;   || Portadas
      |HAZ actualiz1;
  |FINSI;

  |SI #0#5 = "S";
      v_nombre = "capasven";
      v_numero =  23;
               |PINTA 1018, " ";
      |ATRI P; |PINTA 1118, "*";  |ATRI 0;
      |HAZ proceso3;
  |FINSI;

  |SI #0#6 = "S";
      v_nombre = "camoauxc";
      v_numero =  2;
               |PINTA 1118, " ";
      |ATRI P; |PINTA 1218, "*";  |ATRI 0;
      |HAZ proceso4;
  |FINSI;


  |HAZ gra_version;
|FPRC;

****************************************************************************
      LECTURA Y GRABACION
****************************************************************************

|PROCESO creacodigos; |TIPO 0;
  pos1 = #1#3;
  pos2 = "000" + pos1;
  traba = pos2 % -102;
  pos1 = #1#4;
  pos2 = "0000" + pos1;
  pos1 = pos2 % -103;
  #1#25 = traba + pos1;

  pos1 = #1#15;
  pos2 = "000" + pos1;
  traba = pos2 % -102;
  pos1 = #1#16;
  pos2 = "0000" + pos1;
  pos1 = pos2 % -103;
  #1#26 = traba + pos1;

  |GRABA 020#1a;
  |LIBERA #1;
  |HAZ pinta;
|FPRC;

|DEFBUCLE actual;
 #1#1;
 ;
 " ", "            ", 0;
 "z", "zzzzzzzzzzzz", 9;
 be;
 NULL, creacodigos;
|FIN;

|PROCESO actualiza;
  |ABRET #1;
  |BUCLE actual;
  |CIERRAT #1;
|FPRC;

|PROCESO man300;
 |ABRE #5;
 |DDEFECTO #5;
 |LEE 001#5p;
 |SI FSalida = 0;
     #3#93 = #5#45;
 |FINSI;
 |CIERRA #5;
|FPRC;

|PROCESO sopeti;
 |ABRE #6;
 |DDEFECTO #6;
 |LEE 001#6p;
 |SI FSalida = 0;
     #3#89 = #6#5;
     #3#90 = #6#6;
     #3#91 = #6#7;
     #3#92 = #6#17;
 |FINSI;
 |CIERRA #6;
|FPRC;

|PROCESO actualiz1;
  |ABRE #3;
  #3#0 = v_codigo;
  #3#1 = v_any;
  |LEE 001#3=;
  |SI FSalida = 0;
      |HAZ man300;
      |HAZ sopeti;
      |GRABA 020#3a;
      |LIBERA #3;
  |FINSI;
  |CIERRA #3;
|FPRC;

|PROCESO pinta;
  numero = numero + 1;
  alfa3 = numero;  alfa3 = "      " + numero;  alfa3 = alfa3 % -106;
  |PINTA 2170, alfa3;
|FPRC;

****************************************************************************
      LECTURA Y GRABACION
****************************************************************************
|PROCESO proceso1;
  numero = 0;
  |NOME_DAT #2 agidef0;
  |DELINDEX #2;
  |ABRE #2;
  |CIERRA #2;
  temporal1 = fich + "agidef0.ddx";
  temporal2 = fich + v_nombre + ".ddx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  temporal1 = fich + "agidef0.ixx";
  temporal2 = fich + v_nombre + ".ixx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  |DELINDEX #2;
  |NOME_DAT #1 v_nombre;
  |ABRE #1;        || def nuevo
  |CIERRA #1;
  |GRABAENDEF v_nombre,"";
|FPRC;

|PROCESO proceso2;
  numero = 0;
  |NOME_DAT #4 agidef0;
  |DELINDEX #4;
  |ABRE #4;
  |CIERRA #4;
  temporal1 = fich + "agidef0.ddx";
  temporal2 = fich + v_nombre + ".ddx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  temporal1 = fich + "agidef0.ixx";
  temporal2 = fich + v_nombre + ".ixx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  |DELINDEX #4;
  |NOME_DAT #3 v_nombre;
  |ABRE #3;        || def nuevo
  |CIERRA #3;
  |GRABAENDEF v_nombre,"";
|FPRC;

|PROCESO proceso3;
  numero = 0;
  |NOME_DAT #8 agidef0;
  |DELINDEX #8;
  |ABRE #8;
  |CIERRA #8;
  temporal1 = fich + "agidef0.ddx";
  temporal2 = fich + v_nombre + ".ddx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  temporal1 = fich + "agidef0.ixx";
  temporal2 = fich + v_nombre + ".ixx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  |DELINDEX #8;
  |NOME_DAT #7 v_nombre;
  |ABRE #7;        || def nuevo
  |CIERRA #7;
  |GRABAENDEF v_nombre,"";
|FPRC;

|PROCESO proceso4;
  numero = 0;
  |NOME_DAT #10 agidef0;
  |DELINDEX #10;
  |ABRE #10;
  |CIERRA #10;
  temporal1 = fich + "agidef0.ddx";
  temporal2 = fich + v_nombre + ".ddx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  temporal1 = fich + "agidef0.ixx";
  temporal2 = fich + v_nombre + ".ixx";
  |FBORRA temporal2;
  |RENOMBRA_FICHERO temporal1,temporal2;
  |DELINDEX #10;
  |NOME_DAT #9 v_nombre;
  |ABRE #9;        || def nuevo
  |CIERRA #9;
  |GRABAENDEF v_nombre,"";
|FPRC;

|| ***********************************************************************
|PROCESO borra_malos;
  dire = "";
  |DIRECTORIO dire;
  borrar = dire + "bin/agirm " + fich + "agidef0.*";
  |SYSTEM borrar;
|FPRC;

|PROCESO mayor; |TIPO 0;
  #0Campo = #0Campo > #0Campo;
  |PINTA #0Campo;
|FPRC;

|PROCESO lo_que_digo; |TIPO 0;
  |HAZ mayor;
  |CAMPO_VISUAL   #0#3, 1, "N";
  |CAMPO_VISUAL   #0#4, 1, "N";
  |CAMPO_VISUAL   #0#5, 1, "N";
  |CAMPO_VISUAL   #0#6, 1, "N";

  |CAMPO_MODIFICA #0#3, 1, "N";
  |CAMPO_MODIFICA #0#4, 1, "N";
  |CAMPO_MODIFICA #0#5, 1, "N";
  |CAMPO_MODIFICA #0#6, 1, "N";

  |HAZ que_me_dices;
  |SI lo_que_dices = 0; |ACABA; |FINSI;

  #0#1 = "SI"; |PINTA #0#1;

  |CAMPO_VISUAL   #0#3, 1, "S";
  |CAMPO_VISUAL   #0#4, 1, "S";
  |CAMPO_VISUAL   #0#5, 1, "S";
  |CAMPO_VISUAL   #0#6, 1, "S";

  |CAMPO_MODIFICA #0#3, 1, "S";
  |CAMPO_MODIFICA #0#4, 1, "S";
  |CAMPO_MODIFICA #0#5, 1, "S";
  |CAMPO_MODIFICA #0#6, 1, "S";
|FPRC;

****************************************************************************
      ACTUALIZACION FICHERO PUENTE SOBRE FICHERO ACTUAL
****************************************************************************
|PROCESO actualiz2;
    temporal1 = fich + "agidef0.ixx";
    temporal2 = fich + v_nombre + ".ixx";
    |COPIA_FICHERO temporal1,temporal2;
    |SI FSalida ! 0;  |ACABA;  |FINSI;
    temporal1 = fich + "agidef0.dat";
    temporal2 = fich + v_nombre + ".dat";
    |COPIA_FICHERO temporal1,temporal2;
    |SI FSalida ! 0;
        temporal2 = fich + v_nombre + ".ixx";
        |FBORRA temporal2;
        |ACABA;
    |FINSI;
    temporal1 = fich + "agidef0.ddx";
    temporal2 = fich + v_nombre + ".ddx";
    |COPIA_FICHERO temporal1,temporal2;
|FPRC;
