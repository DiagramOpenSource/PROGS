|FICHEROS;
    caivahue #0;
    cacuenta #4;
    caclipro #5;
    calibros #10;
    caivarep #130;
    caivasop #140;
|FIN;

|VARIABLES;
    &entrada = 1;
    potra = 0;
    mensa1 = "    ERROR ESTA FECHA NO CORRESPONDE AL EJERCICIO";
    men1  = "     NO EXISTE EMPRESA !";
    men2  = "     Longitud de Cuenta Fuera de Nivel !";
    men3  = "      Esta Cuenta NO tiene Pase directo";
    cont = 0;
    long = "  ";
    nCon = 0;
    nCa  = 0;
    cta  = 0;
    num   = 0;
    sw = 0;
    xy = 0;
    traba1 = "";
    traba2 = "";
    trasum = 0;
    juan = 0;
    jose = 0;
    pepe = 0;
    rafa = 0;
    anter = 0;
    antnum = 0;
    seran = "";

    &libro = 0;
    &orden = 0;
    &serie = "";
    &pesetas = 0;
    &cuenta = "";
    &digito = 0;
    &emision = "";
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    trim1 = @;
    trim2 = @;
    trim3 = @;
    mas = 0;
    modo = 0;

     letrasnif = "TRWAGMYFPDXBNJZSQVHLCKE";
     letra = "";
     final = "";
     x = "";
     lugar = 0;
     nifnum = 0;
     resto = 0;

  &fec_am = @;
  &imp_am = 0;
  &c_am = "";
   factor = 0;
  swf1 = 0;
|FIN;

|INCLUYE acceso_i;
|INCLUYE puntos_i;

|PROCESO suma1; |TIPO 0;
|SI Campo ]  8; |Y Campo [ 10;  factor = 3;  |FINSI;
|SI Campo ] 52; |Y Campo [ 53;  factor = 2;  |FINSI;
    juan = Campo + factor;          || % IVA
    jose = Campo + (factor * 2);    || cuota IVA
    pepe = Campo + (factor * 3);    || % RE
    rafa = Campo + (factor * 4);    || cuota recargo
    trasum = #0Campo * #0juan / 100;
    #0jose = trasum ! EURODB;
    trasum = #0Campo * #0pepe / 100;
    #0rafa = trasum ! EURODB;
    potra = Campo;
|PINTA #0jose;
|PINTA #0rafa;
|HAZ acumula;
    Campo = potra;
|FPRC;

|PROCESO suma2; |TIPO 0;
|SI Campo ] 11; |Y Campo [ 13;  factor = 3;  |FINSI;
|SI Campo ] 54; |Y Campo [ 55;  factor = 2;  |FINSI;
    juan = Campo - factor;    || base
    jose = Campo + factor;    || cuota IVA
    trasum = #0juan * #0Campo / 100;
    #0jose = trasum ! EURODB;
    potra = Campo;
|PINTA #0jose;
|HAZ acumula;
    Campo = potra;
|FPRC;

|PROCESO suma3; |TIPO 0;
|SI Campo ] 17; |Y Campo [ 19;  factor = 3;  |FINSI;
|SI Campo ] 58; |Y Campo [ 59;  factor = 2;  |FINSI;
    juan = Campo - (factor * 3);    || base
    jose = Campo + factor;          || cuota recargo
    trasum = #0juan * #0Campo / 100;
    #0jose = trasum ! EURODB;
    potra = Campo;
|PINTA #0jose;
|HAZ acumula;
    Campo = potra;
|FPRC;

|PROCESO acumula; |TIPO 0;
    #0#26 =0;
|PARA juan =  8; |SI juan [ 10; |HACIENDO juan = juan + 1;
        jose = juan + 6;      || cuota iva
        pepe = juan + 12;     || cuota recargo
        #0#26 = #0#26 + #0juan + #0jose + #0pepe;
|SIGUE;
|PARA juan = 52; |SI juan [ 53; |HACIENDO juan = juan + 1;
        jose = juan + 4;      || cuota iva
        pepe = juan + 8;      || cuota recargo
        #0#26 = #0#26 + #0juan + #0jose + #0pepe;
|SIGUE;
|PINTA #0#26;
|FPRC;




|PROCESO mayusc;
  #0Campo = #0Campo > " ";
  |PINTA #0Campo;
|FPRC;


|PROCESO serieSi;
 |SI swf1 = 0;
     |C_V #0#27,1,"S";
     |C_M #0#27,1,"S";
   ||  |PINTA 0821, "Serie: ";
     |PINTA 0924, "S:   ";
     swf1 = 1;
 |SINO;
     |C_V #0#27,1,"N";
     |C_M #0#27,1,"N";
   ||  |PINTA 0821, "       ";
     |PINTA 0924, "     ";
     swf1 = 0;
 |FINSI;
|FPRC;

|PROCESO funcio1; |TIPO 0;
|SI FSalida = 9;
    |HAZ serieSi;
    |ERROR;
    |ACABA;
|FINSI;
|FPRC;

|PROCESO cuefin; |TIPO 0;
    modo = (FEntrada / 100) ! 0;
|ABRE #4;
    #4#0 = #0#4;
    #4#1 = #0#5;
|LEE 001#4=;
|SI FSalida = 0;
    |SI #4#3 = "S";
        |SI modo = 1;  |HAZ lee_client;  |FINSI;     || solo en alta
    |SINO;
        |MENAV men3;
        |ERROR;
    |FINSI;
|SINO;
    |ERROR;
|FINSI;
|CIERRA #4;
|FPRC;

|PROCESO lee_client;
  |ABRE #5;
  #5#10 = "C";
  #5#10 = #0#4;   || cuenta
  #5#11 = #0#5;   || digito
  |LEE 001#5=;
  |SI FSalida ! 0;
      |DDEFECTO #5;
  |FINSI;
  #0#50 = #4#2;        || carga el nombre del plan contable
  #0#51 = #5#9;        || carga el CIF del cliente
  |PINTA #0#50;
  |PINTA #0#51;
  |CIERRA #5;
|FPRC;

|PROCESO cuenta;|TIPO 6;
    p_alfa1 = #0Campo;
    salidas = FSalida;
|HAZ punto;
|SI p_error ! 0;  |ERROR;  |ACABA;  |FINSI;
    cta  = #0#4;
    long = cta % A0;
    cont = 0;
    sw = 0;
|SI long = #30#14; sw = 1; #0#5 = 1; |FINSI;
|SI long = #30#15; sw = 1; #0#5 = 2; |FINSI;
|SI long = #30#16; sw = 1; #0#5 = 3; |FINSI;
|SI long = #30#17; sw = 1; #0#5 = 4; |FINSI;
|SI long = #30#18; sw = 1; #0#5 = 5; |FINSI;
|SI long = #30#19; sw = 1; #0#5 = 6; |FINSI;
|SI sw = 0;
    |MENAV men2;
    |ERROR;
|FINSI;
|FPRC;

|PROCESO ejec; |TIPO 3;
     |SI #0#24 = "S";
          |HAZ caivasop;
     |FINSI;
     |SI #0#24 = "R";
          |HAZ caivarep;
     |FINSI;
|FPRC;


|PROCESO nodepar; |TIPO 7;
|SI #30#24 = "N";
    |CAMPO_MODIFICA #0#49, 1, "N";
|SINO;
    |CAMPO_MODIFICA #0#49, 1, "S";
|FINSI;
|FPRC;

|PROCESO letra_0;  |TIPO 6;
  |SI FSalida ! 9;  |ACABA;  |FINSI;

  alfa1 = #0Campo;   |QBT alfa1;
  x    = alfa1 % 101;
  |SI x ! "A"; |Y x ! "B"; |Y x ! "C"; |Y x ! "D"; |Y x ! "E"; |Y x ! "F";
   |Y x ! "G"; |Y x ! "P"; |Y x ! "Q"; |Y x ! "S"; |Y x ! "X";
      final = "";
      alfa2 = alfa1 % 0;
      nume1 = alfa2;
      |PARA nume2 = 1;  |SI nume2 [ nume1;  |HACIENDO nume2 = nume2 + 1;
            lugar = (nume2 * 100) + 1;
            alfa2 = alfa1 % lugar;
            |SI alfa2 = "0"; |O alfa2 = "1";|O alfa2 = "2"; |O alfa2 = "3";
             |O alfa2 = "4"; |O alfa2 = "5";|O alfa2 = "6";
             |O alfa2 = "7"; |O alfa2 = "8";|O alfa2 = "9";
                final = final + alfa2;
            |FINSI;
      |SIGUE;
      nifnum = final;
      |SI nifnum ! 0; |Y final ! "";
          resto   = nifnum $ 23;
          resto   = resto + 1;
          lugar   = (resto * 100) + 1;
          letra   = letrasnif % lugar;
          final   = ("000000000" + final + letra) % -109;
          #0Campo = final;
      |FINSI;
   |SINO;
      |MENAV "    ATENCION !!! No se calcular un C.I.F. ...";
   |FINSI;
   |PINTA #0Campo;
|FPRC;


|PROCESO caivasop;
     |ABRE #140;
     |PARA nCon = #0#2; |SI nCon < #0#62; |HACIENDO nCon = nCon + #0#63;
          #140#0  = #0#0;
          #140#2  = nCon;
          #140#27 = #0#27;
          |LEE 101#140=;
          |SI FSalida ! 0;
               |DDEFECTO #140;
               #140#0 = #0#0;
               #140#1 = #0#1;
               #140#2 = nCon;
               |PARA nCa = 3; |SI nCa < 62; |HACIENDO nCa = nCa + 1;

               |SI nCa ! 24;
                    #140nCa = #0nCa;
               |FINSI;
               |SIGUE;
               #140#46 = "";
               |GRABA 020#140n;
          |FINSI;
          |LIBERA #140;
     |SIGUE;
     |CIERRA #140;
|FPRC;

|PROCESO caivarep;
     |ABRE #130;
     |PARA nCon = #0#2; |SI nCon < #0#62; |HACIENDO nCon = nCon + 1;
          #130#0  = #0#0;
          #130#2  = nCon;
          #130#27 = #0#27;
          |LEE 101#130=;
          |SI FSalida ! 0;
               |DDEFECTO #130;
               #130#0 = #0#0;
               #130#1 = #0#1;
               #130#2 = nCon;
               |PARA nCa = 3; |SI nCa < 62; |HACIENDO nCa = nCa + 1;

               |SI nCa ! 24;
                    #130nCa = #0nCa;
               |FINSI;
               |SIGUE;
               #130#46 = "";
               |GRABA 020#130n;
          |FINSI;
          |LIBERA #130;
     |SIGUE;
     |CIERRA #130;
|FPRC;
