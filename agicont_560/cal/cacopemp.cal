|FICHEROS;
  cacopemp #0;
  cacuenta #3;
  catracie #4;

  camandia #5;

  caman110 #100;
  caman115 #101;
  caman130 #102;
  caman300 #103;
  cama3390 #104;
  cama4390 #110;

  camac347 #105;
  camal347 #106;

  camac349 #107;
  camal349 #108;
|FIN;

|VARIABLES;
   &entrada = 1;
   numero = 0;
   avisillo = "";
   cuenta = "";
   men1   = "    NO EXISTE EMPRESA";
   desde = "            ";
   hasta = "zzzzzzzzzzzz";
   rafa = 0;
   jose = 0;
   alfa1 = "";
   r_emp = 0;
   r_per = 0;
   sw = 0;

   BufferDir = 0;
   ElemDir   = 0;

   Cont = 0;
   Cont2 = 0;

   Nombre = "";
   Comodin = "";
   Comodin1 = "";
   Directorio = "";
   Fichero    = "";
|FIN;

|INCLUYE acceso_i;
|INCLUYE copian_i;

|| **************************************************************************

|PROCESO deentrada;  |TIPO 7;
  |SI sw = 0;
      #0#0 = empre;
      #0#1 = ejerc + 1; |SI ejerc = 10; ejerc = 0; |FINSI;

      |PINTA #0#0;
      |PINTA #0#1;
      sw = 1;
  |FINSI;
|FPRC;

|PROCESO esbuena;
  |SI FSalida = 9;  |ACABA;  |FINSI;
  |ABRE #30;
  #30#2 = #0#0;
  #30#3 = 0;
  |LEE 011#30];
  |SI FSalida ! 0;  |O #30#2 ! #0#0;
     |HAZ CreaEmpresa;
  |FINSI;
  |CIERRA #30;
|FPRC;

|PROCESO consulta;
  |SI FSalida ! 9;  |ACABA;  |FINSI;
  |CIERRAT #30;
  r_emp = 0;
  |SUB_EJECUTA "caconemp.run";
  |ABRET #30;
  |ERROR;
      #0#0 = r_emp;
      #0#1 = r_per;
      |PTEC 802;
      |PTEC 802;
|FPRC;

|PROCESO esbuena1;
  |SI FSalida = 2; |ACABA; |FINSI;
  |SI #0#0 = empre; |Y #0#1 = ejerc;
      |MENAV "    La Empresa y periodo seleccionados son los ACTUALES ";
      |ERROR;
      |ACABA;
  |FINSI;
  |ABRE #30;
  #30#2 = #0#0;
  #30#3 = #0#1;
  |LEE 011#30=;
  |SI FSalida ! 0;
     |HAZ CreaEmpresa;
     #30#2 = empre;
     #30#3 = ejerc;
     |LEE 010#canempre.=;
     |SI FSalida = 0;
        #30#2 = #0#0;
        #30#3 = #0#1;
        Comodin = #0#0;
        |QBF Comodin;
        Comodin = Comodin + #0#1;
        |QBF Comodin;
        #30#0 = Comodin;
        #30#26 = #30#26 + 1;
        |SI #30#26 > 99; #30#26 = 0; |FINSI;
        |GRABA 020#canempre.n;
     |FINSI;
  |SINO;
      |SI #30#13 ! dig3;  |O #30#14 ! dig4;  |O #30#15 ! dig5;
                          |O #30#16 ! dig6;  |O #30#17 ! dig7;
                          |O #30#18 ! dig8;  |O #30#19 ! dig9;
          |MENAV "     NO CORRESPONDEN LOS NIVELES";
          |ERROR;
      |SINO;
           #0#2 = #30#1;
           |PINTA #0#2;
      |FINSI;
  |FINSI;

  #30#2 = empre;
  #30#3 = ejerc;
  |LEE 011#30=;
  |CIERRA #30;
|FPRC;

|PROCESO mayus; |TIPO 0;
  alfa1 = #0Campo > " ";
  #0Campo = alfa1;
  |PINTA #0Campo;
|FPRC;

|| *********************************************************************
||                             COMIENZO
|| *********************************************************************

|PROGRAMA;
  |CLS;
  |CABEZA "Traspaso de Saldos";
  |HAZ inicio;
  |PINPA #0#0;
  |DDEFECTO #0;
  |PINDA #0#0;                    || Pinta los datos por defecto
  |ENDATOS #1#0;
  |SI FSalida = 0;                || Si el conforme es igua a S
      |HAZ AceraCuentas;
  |FINSI;
|FPRO;

|PROCESO AceraCtas;
  avisillo = "2401               Tratando Cuenta: " + #3#0;
  |MENSA avisillo;
  |PARA Cont = 9; |SI Cont [ 53; |HACIENDO Cont = Cont + 1;
     #3Cont = 0;
  |SIGUE;
  |GRABA 020#3a;
|FPRC;

|DEFBUCLE AceraCtas;
#3#1;
;
desde,0;
hasta,9;
be;
NULL,AceraCtas;
|FIN;

|PROCESO AceraCuentas;
  |DBASE dir_fich;
  dir_fich=dir_fich + "fich/";
  numero = 10000000 + (#0#0 * 10) + #0#1;
  cuenta = numero;
  avisillo = cuenta % -106;
  dir_fich=dir_fich + avisillo + "/";
  |PATH_DAT #3 dir_fich;
  |ABRE #3;
  |BUCLE AceraCtas;
  |CIERRA #3;
|FPRC;

|PROCESO AceraDiarios;
   #camandia#2 = 0;
   #camandia#3 = 0;
   |GRABA 020#camandia.a;
|FPRC;

|DEFBUCLE AceraDiarios;
#camandia#1;
;
INICIO;
FINAL;
;
NULL,AceraDiarios;
|FIN;

|PROCESO CreaEmpresa;

     |DFICB Comodin;
     Comodin = Comodin + (("00000" + #30#2) % -105);
     Comodin = Comodin + #30#3 + "/";
     |DFICB Comodin1;
     Comodin1 = Comodin1 + (("00000" + empre) % -105);
     Comodin1 = Comodin1 + ejerc + "/";
     |MKDIR Comodin;

     fich_copi = Comodin1;
     fich_alta = Comodin;

     Directorio = "";
     |DFICB Directorio;
     Fichero = Directorio + "agicont.dir";
     |LEESECUENCIAL Fichero, BufferDir, ElemDir, 1, 0;
      |SI ElemDir > 0;
          |PARA Cont = 1; |SI Cont [ ElemDir; |HACIENDO Cont = Cont + 5;
                Cont2 = Cont + 3;
                |DEL_BUF BufferDir, Cont2, Nombre;
                |DEL_BUF BufferDir, Cont, Nombre;
                |SI Nombre ! "camaasic"; |Y Nombre ! "camaasil";
                |Y Nombre ! "caivasop"; |Y Nombre ! "caivarep";
                |Y Nombre ! "camanpag"; |Y Nombre ! "camancob";
                   traba1 = Nombre;    |HAZ copiando;
                |FINSI;
          |SIGUE;
      |SINO;
          Nombre = "    [" + Fichero + "] NO accesible en lectura.";
          |MENAV Nombre;
      |FINSI;
      |FINDIM BufferDir;

      |PATH_DAT #5 Comodin;
      |ABRE #camandia;
      |BUCLE AceraDiarios;
      |HAZ BorraModelos;
      |CIERRA #camandia;
|FPRC;

|PROCESO Borra390_1;
   |BORRA 020#cama3390.a;
|FPRC;

|DEFBUCLE Borra390_1;
#cama3390#1;
;
#0#0,#0#1;
#0#0,#0#1;
;
NULL,Borra390_1;
|FIN;

|PROCESO Borra390_2;
   |BORRA 020#cama4390.a;
|FPRC;

|DEFBUCLE Borra390_2;
#cama4390#1;
;
#0#0,#0#1;
#0#0,#0#1;
;
NULL,Borra390_2;
|FIN;

|PROCESO BorraModelos;
  |DBASE dir_fich;
  dir_fich=dir_fich + "fich/";
  dir_fich=dir_fich + (("00000" + #0#0) % -105);
  dir_fich = dir_fich + #0#1 + "/";

  |PATH_DAT #100 dir_fich; |DELINDEX #100; |ABRE #100; |CIERRA #100;
  |PATH_DAT #101 dir_fich; |DELINDEX #101; |ABRE #101; |CIERRA #101;
  |PATH_DAT #102 dir_fich; |DELINDEX #102; |ABRE #102; |CIERRA #102;
  |PATH_DAT #103 dir_fich; |DELINDEX #103; |ABRE #103; |CIERRA #103;
  |PATH_DAT #104 dir_fich; |ABRE #104; |BUCLE Borra390_1; |CIERRA #104;
  |PATH_DAT #110 dir_fich; |ABRE #110; |BUCLE Borra390_2; |CIERRA #110;
  |PATH_DAT #105 dir_fich; |DELINDEX #105; |ABRE #105; |CIERRA #105;
  |PATH_DAT #106 dir_fich; |DELINDEX #106; |ABRE #106; |CIERRA #106;
  |PATH_DAT #107 dir_fich; |DELINDEX #107; |ABRE #107; |CIERRA #107;
  |PATH_DAT #108 dir_fich; |DELINDEX #108; |ABRE #108; |CIERRA #108;

|FPRC;
