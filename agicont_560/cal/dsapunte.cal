|FICHEROS;
   dsapunte #0;
   caenlace #1;

   camaasic #3;
   camaasil #4;
   cacuenta #5;
   camandia #6;

   caivarep #7;
   caivasop #8;

   caivaasi #9;
   caivases #10;
   calibros #11;
   caclipro #12;

   canempre #30;
|FIN;

|INCLUYE acceso_i;
|INCLUYE conasi_i;

|VARIABLES;
   Path = ""; aAlfa = ""; aAlfa1 = "";
   Campo1 = 0; Campo2 = 0; Campo3 = 0;
   Contador = 0; Cambiante = 0;

   Comodin = ""; Comodin1 = ""; ComodNum = 0;

   Calc = 0; Calc1 = 0; Calc2 = 0;
   nLong = 0; aLong = "";
   SwNivel = 0; Nivel = 0; MaxNiv = 0;
   LibContra = 0; SerContra = ""; FacContra = 0;
   LibroAnt  = 0; SerieAnt  = "";

   CmpDebe  = 0; CmpHaber = 0; CmpSaldo = 0;
   TotDebe  = 0; TotHaber = 0; TotSaldo = 0;

   Cuenta  = ""; Cuenta1 = ""; nImporte = 0;
   aNombre = ""; ErrorDoc = 0; Respuesta = "";
   Cont = 0; nCont = 0;

   EnDiario = 0; EnFecha = @; EnAsto = 0; nDOCUMENTO = 0;
   Dig1 = 0; Dig2 = 0; Dig3 = 0; Dig4 = 0; Dig5 = 0; Dig6 = 0;


   FechaEnl    = @; FechaHoy  = @;
   HoraEnl     = 0; Hora      = 0;
   MinutosEnl  = 0; Minutos   = 0;
   SegundosEnl = 0; Segundos  = 0;
|FIN;

|PROCESO RecalculaIva;
   |ATRI I; |PINTA 2207, "Recalculando campos de iva       "; |ATRI N;
   |SI #caenlace#10 = "R";
      #caivarep#26 = #caivarep#8  + #caivarep#9  + #caivarep#10 + #caivarep#52 + #caivarep#53;
      #caivarep#26 = #caivarep#26 + #caivarep#14 + #caivarep#15 + #caivarep#16 + #caivarep#56 + #caivarep#57;
      #caivarep#26 = #caivarep#26 + #caivarep#20 + #caivarep#21 + #caivarep#22 + #caivarep#60 + #caivarep#61;

      |SI #caenlace#28 = 00.00;
         |SI #caenlace#26 = "B";
            #caivarep#11 = ((#caivarep#14 / #caivarep#8)  * 100) ! 0;  || Tipos de IVA
            #caivarep#12 = ((#caivarep#15 / #caivarep#9)  * 100) ! 0;
            #caivarep#13 = ((#caivarep#16 / #caivarep#10) * 100) ! 0;
            #caivarep#54 = ((#caivarep#56 / #caivarep#52) * 100) ! 0;
            #caivarep#55 = ((#caivarep#57 / #caivarep#53) * 100) ! 0;
         |FINSI;
      |SINO;
         |SI #caenlace#27 = 1; #caivarep#11 = #caenlace#28; |FINSI;
         |SI #caenlace#27 = 2; #caivarep#12 = #caenlace#28; |FINSI;
         |SI #caenlace#27 = 3; #caivarep#13 = #caenlace#28; |FINSI;
         |SI #caenlace#27 = 4; #caivarep#54 = #caenlace#28; |FINSI;
         |SI #caenlace#27 = 5; #caivarep#55 = #caenlace#28; |FINSI;

         #caivarep#14 = #caivarep#8  % #caivarep#11;
         #caivarep#15 = #caivarep#9  % #caivarep#12;
         #caivarep#16 = #caivarep#10 % #caivarep#13;
         #caivarep#56 = #caivarep#52 % #caivarep#54;
         #caivarep#57 = #caivarep#53 % #caivarep#55;

         #caivarep#26 = #caivarep#8  + #caivarep#9  + #caivarep#10 + #caivarep#52 + #caivarep#53;
         #caivarep#26 = #caivarep#26 + #caivarep#14 + #caivarep#15 + #caivarep#16 + #caivarep#56 + #caivarep#57;
         #caivarep#26 = #caivarep#26 + #caivarep#20 + #caivarep#21 + #caivarep#22 + #caivarep#60 + #caivarep#61;
      |FINSI;

      |SI #caenlace#33 = 00.00;
         |SI #caenlace#26 = "B";
            #caivarep#17 = ((#caivarep#20 / #caivarep#8)  * 100) ! 1;  || Tipos de REC
            #caivarep#18 = ((#caivarep#21 / #caivarep#9)  * 100) ! 1;
            #caivarep#19 = ((#caivarep#22 / #caivarep#10) * 100) ! 1;
            #caivarep#58 = ((#caivarep#60 / #caivarep#52) * 100) ! 1;
            #caivarep#59 = ((#caivarep#61 / #caivarep#53) * 100) ! 1;
         |FINSI;
      |SINO;
         |SI #caenlace#27 = 1; #caivarep#17 = #caenlace#33; |FINSI;
         |SI #caenlace#27 = 2; #caivarep#18 = #caenlace#33; |FINSI;
         |SI #caenlace#27 = 3; #caivarep#19 = #caenlace#33; |FINSI;
         |SI #caenlace#27 = 4; #caivarep#58 = #caenlace#33; |FINSI;
         |SI #caenlace#27 = 5; #caivarep#59 = #caenlace#33; |FINSI;

         #caivarep#20 = #caivarep#8  % #caivarep#17;
         #caivarep#21 = #caivarep#9  % #caivarep#18;
         #caivarep#22 = #caivarep#10 % #caivarep#19;
         #caivarep#60 = #caivarep#52 % #caivarep#58;
         #caivarep#61 = #caivarep#53 % #caivarep#59;

         #caivarep#26 = #caivarep#8  + #caivarep#9  + #caivarep#10 + #caivarep#52 + #caivarep#53;
         #caivarep#26 = #caivarep#26 + #caivarep#14 + #caivarep#15 + #caivarep#16 + #caivarep#56 + #caivarep#57;
         #caivarep#26 = #caivarep#26 + #caivarep#20 + #caivarep#21 + #caivarep#22 + #caivarep#60 + #caivarep#61;
      |FINSI;
   |FINSI;
   |SI #caenlace#10 = "S";
      #caivasop#26 = #caivasop#8  + #caivasop#9  + #caivasop#10 + #caivasop#52 + #caivasop#53;
      #caivasop#26 = #caivasop#26 + #caivasop#14 + #caivasop#15 + #caivasop#16 + #caivasop#56 + #caivasop#57;
      #caivasop#26 = #caivasop#26 + #caivasop#20 + #caivasop#21 + #caivasop#22 + #caivasop#60 + #caivasop#61;

      |SI #caenlace#28 = 00.00;
         |SI #caenlace#26 = "B";
            #caivasop#11 = ((#caivasop#14 / #caivasop#8)  * 100) ! 0;  || Tipos de IVA
            #caivasop#12 = ((#caivasop#15 / #caivasop#9)  * 100) ! 0;
            #caivasop#13 = ((#caivasop#16 / #caivasop#10) * 100) ! 0;
            #caivasop#54 = ((#caivasop#56 / #caivasop#52) * 100) ! 0;
            #caivasop#55 = ((#caivasop#57 / #caivasop#53) * 100) ! 0;
         |FINSI;
      |SINO;
         |SI #caenlace#27 = 1; #caivasop#11 = #caenlace#28; |FINSI;
         |SI #caenlace#27 = 2; #caivasop#12 = #caenlace#28; |FINSI;
         |SI #caenlace#27 = 3; #caivasop#13 = #caenlace#28; |FINSI;
         |SI #caenlace#27 = 4; #caivasop#54 = #caenlace#28; |FINSI;
         |SI #caenlace#27 = 5; #caivasop#55 = #caenlace#28; |FINSI;

         #caivasop#14 = #caivasop#8  % #caivasop#11;
         #caivasop#15 = #caivasop#9  % #caivasop#12;
         #caivasop#16 = #caivasop#10 % #caivasop#13;
         #caivasop#56 = #caivasop#52 % #caivasop#54;
         #caivasop#57 = #caivasop#53 % #caivasop#55;

         #caivasop#26 = #caivasop#8  + #caivasop#9  + #caivasop#10 + #caivasop#52 + #caivasop#53;
         #caivasop#26 = #caivasop#26 + #caivasop#14 + #caivasop#15 + #caivasop#16 + #caivasop#56 + #caivasop#57;
         #caivasop#26 = #caivasop#26 + #caivasop#20 + #caivasop#21 + #caivasop#22 + #caivasop#60 + #caivasop#61;
      |FINSI;

      |SI #caenlace#33 = 00.00;
         |SI #caenlace#26 = "B";
            #caivasop#17 = ((#caivasop#20 / #caivasop#8)  * 100) ! 1;  || Tipos de REC
            #caivasop#18 = ((#caivasop#21 / #caivasop#9)  * 100) ! 1;
            #caivasop#19 = ((#caivasop#22 / #caivasop#10) * 100) ! 1;
            #caivasop#58 = ((#caivasop#60 / #caivasop#52) * 100) ! 1;
            #caivasop#59 = ((#caivasop#61 / #caivasop#53) * 100) ! 1;
         |FINSI;
      |SINO;
         |SI #caenlace#27 = 1; #caivasop#17 = #caenlace#33; |FINSI;
         |SI #caenlace#27 = 2; #caivasop#18 = #caenlace#33; |FINSI;
         |SI #caenlace#27 = 3; #caivasop#19 = #caenlace#33; |FINSI;
         |SI #caenlace#27 = 4; #caivasop#58 = #caenlace#33; |FINSI;
         |SI #caenlace#27 = 5; #caivasop#59 = #caenlace#33; |FINSI;

         #caivasop#20 = #caivasop#8  % #caivasop#17;
         #caivasop#21 = #caivasop#9  % #caivasop#18;
         #caivasop#22 = #caivasop#10 % #caivasop#19;
         #caivasop#60 = #caivasop#52 % #caivasop#58;
         #caivasop#61 = #caivasop#53 % #caivasop#59;

         #caivasop#26 = #caivasop#8  + #caivasop#9  + #caivasop#10 + #caivasop#52 + #caivasop#53;
         #caivasop#26 = #caivasop#26 + #caivasop#14 + #caivasop#15 + #caivasop#16 + #caivasop#56 + #caivasop#57;
         #caivasop#26 = #caivasop#26 + #caivasop#20 + #caivasop#21 + #caivasop#22 + #caivasop#60 + #caivasop#61;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO CreaRegistro;
   |SI #caenlace#26 = "F";
      |ABRE #caivaasi; |LEE 000#caivaasi.p; |CIERRA #caivaasi;
      |SI #caenlace#10 = "R";
         #caivarep#0  = #caenlace#11;
         #caivarep#27 = #caenlace#12;
         #caivarep#2  = #caenlace#13;
         |LEE 101#caivarep.=;
         |SI FSalida ! 0;
            |DDEFECTO #caivarep;
            #caivarep#0  = #caenlace#11;
            #caivarep#27 = #caenlace#12;
            #caivarep#2  = #caenlace#13;
            |GRABA 020#caivarep.b;
         |FINSI;
/*
         |SI #caivaasi#44 = "S";
            |ABRE #caivases;
            #caivases#0 = #caenlace#12;
            #caivases#1 = "R";
            |LEE 101#caivases.=;
            |SI FSalida = 0;
               #caivases#3 = #caenlace#13 + 1;
               |GRABA 020#caivases.a; |LIBERA #caivases;
            |SINO;
               |DDEFECTO #caivases;
               #caivases#0 = #caenlace#12;
               #caivases#1 = "R";
               #caivases#3 = #caenlace#13 + 1;
               |GRABA 020#caivases.n; |LIBERA #caivases;
            |FINSI;
            |CIERRA #caivases;
         |SINO;
*/
            |ABRE #calibros;
            #calibros#0 = #caenlace#11;
            |LEE 101#calibros.=;
            |SI FSalida = 0;
               #calibros#4 = #caenlace#13 + 1;
               |GRABA 020#calibros.a; |LIBERA #calibros;
            |SINO;
               |DDEFECTO #calibros;
               #calibros#0 = #caenlace#11;
               #calibros#1 = "LIBRO " + (("00" + #caenlace#11) % -102) + " REPERCUTIDO";
               #calibros#2 = #caenlace#10;
               #calibros#3 = #caenlace#13 + 1;
               #calibros#4 = 1;
               |GRABA 020#calibros.n;
            |FINSI;
            |CIERRA #calibros;
||         |FINSI;
         #caivarep#3  = #caenlace#29;
         #caivarep#4  = #caenlace#4;
         #caivarep#5  = #caenlace#5;
         #caivarep#6  = #caenlace#6;
         #caivarep#7  = #caenlace#7;
         Comodin = #caenlace#31; |QBF Comodin;
         |SI Comodin = "";
            #caivarep#23 = #caivaasi#21;
         |SINO;
            #caivarep#23 = #caenlace#31;
         |FINSI;
         Comodin = #caenlace#29;
         Comodin = Comodin % 0402; Calc = Comodin;
/*
         |SI #caivaasi#46 = "T";
            |SI Calc ] 1;  |Y Calc [ 3;  #caivarep#44 = 1; |FINSI;
            |SI Calc ] 4;  |Y Calc [ 6;  #caivarep#44 = 2; |FINSI;
            |SI Calc ] 7;  |Y Calc [ 9;  #caivarep#44 = 3; |FINSI;
            |SI Calc ] 10; |Y Calc [ 12; #caivarep#44 = 4; |FINSI;
         |SINO;
*/
            #caivarep#44 = Calc;
||         |FINSI;
         #caivarep#45 = #caenlace#0;
         #caivarep#46 = #caenlace#1;
         #caivarep#47 = #caenlace#2;
         Comodin = #caenlace#32; |QBF Comodin;
         |SI Comodin = "";
            #caivarep#48 = #caivaasi#23;
         |SINO;
            #caivarep#48 = #caenlace#32;
         |FINSI;
         #caivarep#49 = #caivaasi#15;

         |ABRE #caclipro;
         #caclipro#23 = "C";
         #caclipro#10 = #caenlace#4;
         #caclipro#11 = #caenlace#5;
         |LEE 000#caclipro.=;
         |SI FSalida = 0;
            #caivarep#50 = #caclipro#1;
            #caivarep#51 = #caclipro#9;
         |FINSI;
         |CIERRA #caclipro;
         |HAZ RecalculaIva;
         |SI #caenlace#30 = "S";
            |SI FacContra ! 0; |Y LibContra = #caenlace#34; |Y SerContra = #caenlace#35;
               #caenlace#36 = FacContra;
            |SINO;
               #caivases#0 = #caenlace#35;
               #caivases#1 = "S";
               |LEE 101#caivases.=;
               |SI FSalida = 0;
                  FacContra = #caivases#3; #caenlace#36 = #caivases#3;
                  #caivases#3 = #caivases#3 + #caivases#4;
                  |GRABA 020#caivases.a; |LIBERA #caivases;
               |FINSI;
            |FINSI;
            aAlfa = "**"  + (("00" + #caenlace#34) % -102);
            aAlfa = aAlfa + #caenlace#35;
            aAlfa = aAlfa + (("000000" + #caenlace#36) % -106);
            #caivarep#35 = aAlfa;
         |FINSI;
         |GRABA 020#caivarep.a; |LIBERA #caivarep;
         |ATRI I;|PINTA 2207, "Grabando registro de iva         ";|ATRI N;
      |FINSI;
      |SI #caenlace#10 = "S";
         #caivasop#0  = #caenlace#11;
         #caivasop#27 = #caenlace#12;
         #caivasop#2  = #caenlace#13;
         |LEE 101#caivasop.=;
         |SI FSalida ! 0;
            |DDEFECTO #caivasop;
            #caivasop#0  = #caenlace#11;
            #caivasop#27 = #caenlace#12;
            #caivasop#2  = #caenlace#13;
            |GRABA 020#caivasop.b;
         |FINSI;
/*
         |SI #caivaasi#44 = "S";
            |ABRE #caivases;
            #caivases#0 = #caenlace#12;
            #caivases#1 = "S";
            |LEE 101#caivases.=;
            |SI FSalida = 0;
               #caivases#3 = #caenlace#13 + #caivases#4;
               |GRABA 020#caivases.a; |LIBERA #caivases;
            |SINO;
               |DDEFECTO #caivases;
               #caivases#0 = #caenlace#12;
               #caivases#1 = "S";
               #caivases#3 = #caenlace#13 + #caivases#4;
               |GRABA 020#caivases.n; |LIBERA #caivases;
            |FINSI;
            |CIERRA #caivases;
         |SINO;
*/
            |ABRE #calibros;
            #calibros#0 = #caenlace#11;
            |LEE 101#calibros.=;
            |SI FSalida = 0;
               #calibros#4 = #caenlace#13 + 1;
               |GRABA 020#calibros.a; |LIBERA #calibros;
            |SINO;
               |DDEFECTO #calibros;
               #calibros#0 = #caenlace#11;
               #calibros#1 = "LIBRO " + (("00" + #caenlace#11) % -102) + " SOPORTADO";
               #calibros#2 = #caenlace#10;
               #calibros#3 = #caenlace#13 + 1;
               #calibros#4 = 1;
               |GRABA 020#calibros.n;
            |FINSI;
            |CIERRA #calibros;
||         |FINSI;
         #caivasop#3  = #caenlace#29;
         #caivasop#4  = #caenlace#4;
         #caivasop#5  = #caenlace#5;
         #caivasop#6  = #caenlace#6;
         #caivasop#7  = #caenlace#7;
         Comodin = #caenlace#31; |QBF Comodin;
         |SI Comodin = "";
            #caivasop#23 = #caivaasi#21;
         |SINO;
            #caivasop#23 = #caenlace#31;
         |FINSI;
         Comodin = #caenlace#29; |QBF Comodin;
         Comodin = Comodin % 0402; Calc = Comodin;
/*
         |SI #caivaasi#46 = "T";
            |SI Calc ] 1;  |Y Calc [ 3;  #caivasop#44 = 1; |FINSI;
            |SI Calc ] 5;  |Y Calc [ 6;  #caivasop#44 = 1; |FINSI;
            |SI Calc ] 7;  |Y Calc [ 9;  #caivasop#44 = 1; |FINSI;
            |SI Calc ] 10; |Y Calc [ 12; #caivasop#44 = 1; |FINSI;
         |SINO;
*/
            #caivasop#44 = Calc;
||         |FINSI;
         #caivasop#45 = #caenlace#0;
         #caivasop#46 = #caenlace#1;
         #caivasop#47 = #caenlace#2;
         Comodin = #caenlace#32; |QBF Comodin;
         |SI Comodin = "";
            #caivasop#48 = #caivaasi#23;
         |SINO;
            #caivasop#48 = #caenlace#32;
         |FINSI;
         #caivasop#49 = #caivaasi#15;

         |ABRE #caclipro;
         #caclipro#23 = "P";
         #caclipro#10 = #caenlace#4;
         #caclipro#11 = #caenlace#5;
         |LEE 000#caclipro.=;
         |SI FSalida = 0;
            #caivasop#50 = #caclipro#1;
            #caivasop#51 = #caclipro#9;
         |FINSI;
         |CIERRA #caclipro;
         |HAZ RecalculaIva;
         |SI #caenlace#30 = "S";
            |SI FacContra ! 0; |Y LibContra = #caenlace#34; |Y SerContra = #caenlace#35;
               #caenlace#36 = FacContra;
            |SINO;
               #caivases#0 = #caenlace#35;
               #caivases#1 = "R";
               |LEE 101#caivases.=;
               |SI FSalida = 0;
                  FacContra = #caivases#3; #caenlace#36 = #caivases#3;
                  #caivases#3 = #caivases#3 + 1;
                  |GRABA 020#caivases.a; |LIBERA #caivases;
               |FINSI;
            |FINSI;
            aAlfa = "**"  + (("00" + #caenlace#34) % -102);
            aAlfa = aAlfa + #caenlace#35;
            aAlfa = aAlfa + (("000000" + #caenlace#36) % -106);
            #caivasop#35 = aAlfa;
         |FINSI;
         |GRABA 020#caivasop.a; |LIBERA #caivasop;
         |ATRI I;|PINTA 2207, "Grabando registro de iva         ";|ATRI N;
      |FINSI;
   |FINSI;
   |SI #caenlace#26 = "B";
      |SI #caenlace#10 = "R";
         #caivarep#0  = #caenlace#11;
         #caivarep#27 = #caenlace#12;
         #caivarep#2  = #caenlace#13;
         |LEE 101#caivarep.=;
         |SI FSalida = 0;
            |SI #caenlace#27 = 1; #caivarep#8  = #caivarep#8  + #caenlace#9; |FINSI;
            |SI #caenlace#27 = 2; #caivarep#9  = #caivarep#9  + #caenlace#9; |FINSI;
            |SI #caenlace#27 = 3; #caivarep#10 = #caivarep#10 + #caenlace#9; |FINSI;
            |SI #caenlace#27 = 4; #caivarep#52 = #caivarep#52 + #caenlace#9; |FINSI;
            |SI #caenlace#27 = 5; #caivarep#53 = #caivarep#53 + #caenlace#9; |FINSI;
         |FINSI;
         |HAZ RecalculaIva;
         |GRABA 020#caivarep.a; |LIBERA #caivarep;
         |ATRI I;|PINTA 2207, "Actualizando bases del registro  ";|ATRI N;
      |FINSI;
      |SI #caenlace#10 = "S";
         #caivasop#0  = #caenlace#11;
         #caivasop#27 = #caenlace#12;
         #caivasop#2  = #caenlace#13;
         |LEE 101#caivasop.=;
         |SI FSalida = 0;
            |SI #caenlace#27 = 1; #caivasop#8  = #caivasop#8  + #caenlace#9; |FINSI;
            |SI #caenlace#27 = 2; #caivasop#9  = #caivasop#9  + #caenlace#9; |FINSI;
            |SI #caenlace#27 = 3; #caivasop#10 = #caivasop#10 + #caenlace#9; |FINSI;
            |SI #caenlace#27 = 4; #caivasop#52 = #caivasop#52 + #caenlace#9; |FINSI;
            |SI #caenlace#27 = 5; #caivasop#53 = #caivasop#53 + #caenlace#9; |FINSI;
         |FINSI;
         |HAZ RecalculaIva;
         |ATRI I;|PINTA 2207, "Actualizando bases del registro  ";|ATRI N;
         |GRABA 020#caivasop.a; |LIBERA #caivasop;
      |FINSI;
   |FINSI;
   |SI #caenlace#26 = "I";
      |SI #caenlace#10 = "R";
         #caivarep#0  = #caenlace#11;
         #caivarep#27 = #caenlace#12;
         #caivarep#2  = #caenlace#13;
         |LEE 101#caivarep.=;
         |SI FSalida = 0;
            |SI #caenlace#27 = 1; Campo1 = 14; Campo2 = 11; Campo3 = 8;  |FINSI;
            |SI #caenlace#27 = 2; Campo1 = 15; Campo2 = 12; Campo3 = 9;  |FINSI;
            |SI #caenlace#27 = 3; Campo1 = 16; Campo2 = 13; Campo3 = 10; |FINSI;
            |SI #caenlace#27 = 4; Campo1 = 56; Campo2 = 54; Campo3 = 52; |FINSI;
            |SI #caenlace#27 = 5; Campo1 = 57; Campo2 = 55; Campo3 = 53; |FINSI;
            #caivarep#Campo1# = #caivarep#Campo1# + #caenlace#9;
            #caivarep#Campo2# = (#caivarep#Campo1# / #caivarep#Campo3#)* 100;
         |FINSI;
         |HAZ RecalculaIva;
         |ATRI I;|PINTA 2207, "Actualizando cuotas de iva       ";|ATRI N;
         |GRABA 020#caivarep.a; |LIBERA #caivarep;
      |FINSI;
      |SI #caenlace#10 = "S";
         #caivasop#0  = #caenlace#11;
         #caivasop#27 = #caenlace#12;
         #caivasop#2  = #caenlace#13;
         |LEE 101#caivasop.=;
         |SI FSalida = 0;
            |SI #caenlace#27 = 1; Campo1 = 14; Campo2 = 11; Campo3 = 8;  |FINSI;
            |SI #caenlace#27 = 2; Campo1 = 15; Campo2 = 12; Campo3 = 9;  |FINSI;
            |SI #caenlace#27 = 3; Campo1 = 16; Campo2 = 13; Campo3 = 10; |FINSI;
            |SI #caenlace#27 = 4; Campo1 = 56; Campo2 = 54; Campo3 = 52; |FINSI;
            |SI #caenlace#27 = 5; Campo1 = 57; Campo2 = 55; Campo3 = 53; |FINSI;
            #caivasop#Campo1# = #caivasop#Campo1# + #caenlace#9;
            #caivasop#Campo2# = (#caivasop#Campo1# / #caivasop#Campo3#)* 100;
         |FINSI;
         |HAZ RecalculaIva;
         |ATRI I;|PINTA 2207, "Actualizando cuotas de iva       ";|ATRI N;
         |GRABA 020#caivasop.a; |LIBERA #caivasop;
      |FINSI;
   |FINSI;
   |SI #caenlace#26 = "R";
      |SI #caenlace#10 = "R";
         #caivarep#0  = #caenlace#11;
         #caivarep#27 = #caenlace#12;
         #caivarep#2  = #caenlace#13;
         |LEE 101#caivarep.=;
         |SI FSalida = 0;
            |SI #caenlace#27 = 1; Campo1 = 20; Campo2 = 17; Campo3 = 8;  |FINSI;
            |SI #caenlace#27 = 2; Campo1 = 21; Campo2 = 18; Campo3 = 9;  |FINSI;
            |SI #caenlace#27 = 3; Campo1 = 22; Campo2 = 19; Campo3 = 10; |FINSI;
            |SI #caenlace#27 = 4; Campo1 = 60; Campo2 = 58; Campo3 = 52; |FINSI;
            |SI #caenlace#27 = 5; Campo1 = 61; Campo2 = 59; Campo3 = 53; |FINSI;
            #caivarep#Campo1# = #caivarep#Campo1# + #caenlace#9;
            #caivarep#Campo2# = (#caivarep#Campo1# / #caivarep#Campo3#)* 100;
         |FINSI;
         |HAZ RecalculaIva;
         |ATRI I;|PINTA 2207, "Actualizando cuotas de recargo   ";|ATRI N;
         |GRABA 020#caivarep.a; |LIBERA #caivarep;
      |FINSI;
      |SI #caenlace#10 = "S";
         #caivasop#0  = #caenlace#11;
         #caivasop#27 = #caenlace#12;
         #caivasop#2  = #caenlace#13;
         |LEE 101#caivasop.=;
         |SI FSalida = 0;
            |SI #caenlace#27 = 1; Campo1 = 20; Campo2 = 17; Campo3 = 8;  |FINSI;
            |SI #caenlace#27 = 2; Campo1 = 21; Campo2 = 18; Campo3 = 9;  |FINSI;
            |SI #caenlace#27 = 3; Campo1 = 22; Campo2 = 19; Campo3 = 10; |FINSI;
            |SI #caenlace#27 = 4; Campo1 = 60; Campo2 = 58; Campo3 = 52; |FINSI;
            |SI #caenlace#27 = 5; Campo1 = 61; Campo2 = 59; Campo3 = 53; |FINSI;
            #caivasop#Campo1# = #caivasop#Campo1# + #caenlace#9;
            #caivasop#Campo2# = (#caivasop#Campo1# / #caivasop#Campo3#)* 100;
         |FINSI;
         |HAZ RecalculaIva;
         |ATRI I;|PINTA 2207, "Actualizando cuotas de recargo   ";|ATRI N;
         |GRABA 020#caivasop.a; |LIBERA #caivasop;
      |FINSI;
   |FINSI;
   |SI #caenlace#30 = "S";
      #caenlace#36 = FacContra;
      |SI #caenlace#10 = "S";
         aAlfa = "**"  + (("00" + #caenlace#34) % -102);
         aAlfa = aAlfa + #caenlace#35;
         aAlfa = aAlfa + (("000000" + #caenlace#36) % -106);
         #caivarep#0  = #caenlace#34;
         #caivarep#27 = #caenlace#35;
         #caivarep#2  = #caenlace#36;
         |LEE 101#caivarep.=;
         |SI FSalida ! 0;
            |DDEFECTO #caivarep;
            #caivarep#0  = #caenlace#34;
            #caivarep#27 = #caenlace#35;
            #caivarep#2  = #caenlace#36;
            |GRABA 020#caivarep.b;
         |FINSI;
         aAlfa = "|NC"; Calc = #caivarep#aAlfa#;
         Calc = Calc - 2;  || El fichero de iva repercutido tiene un campo mas que el de iva soportado
         |PARA nCont = 0; |SI nCont [ Calc; |HACIENDO nCont = nCont + 1;
            |SI nCont ! 0; |Y nCont ! 27; |Y nCont ! 2;
               #caivarep#nCont# = #caivasop#nCont#;
            |FINSI;
         |SIGUE;
         |GRABA 020#caivarep.a; |LIBERA #caivarep;
      |FINSI;
      |SI #caenlace#10 = "R";
         #caivasop#0  = #caenlace#34;
         #caivasop#27 = #caenlace#35;
         #caivasop#2  = #caenlace#36;
         |LEE 101#caivasop.=;
         |SI FSalida ! 0;
            |DDEFECTO #caivasop;
            #caivasop#0  = #caenlace#34;
            #caivasop#27 = #caenlace#35;
            #caivasop#2  = #caenlace#36;
            |GRABA 020#caivasop.b;
         |FINSI;
         aAlfa = "|NC"; Calc = #caivasop#aAlfa#; Calc = Calc - 1;
         |PARA nCont = 0; |SI nCont [ Calc; |HACIENDO nCont = nCont + 1;
            |SI nCont ! 0; |Y nCont ! 27; |Y nCont ! 2;
               #caivasop#nCont# = #caivarep#nCont#;
            |FINSI;
         |SIGUE;
         |GRABA 020#caivasop.a; |LIBERA #caivasop;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO BorraLinAsto;
   |SI #camaasil#12 = "R";
      #caivarep#0  = #camaasil#13;
      #caivarep#27 = #camaasil#15;
      #caivarep#2  = #camaasil#14;
      |LEE 101#caivarep.=;
      |SI FSalida = 0;
         aAlfa = #caivarep#35; |QBF aAlfa;
         aAlfa1 = aAlfa % 0102;
         |SI aAlfa1 = "**";
            aAlfa1 = aAlfa % 0302; #caivasop#0  = aAlfa1; LibContra = #caivasop#0;
            aAlfa1 = aAlfa % 0502; #caivasop#27 = aAlfa1; SerContra = #caivasop#27;
            aAlfa1 = aAlfa % 0706; #caivasop#2  = aAlfa1; FacContra = #caivasop#2;
            |LEE 101#caivasop.=;
            |SI FSalida = 0;
               |BORRA 020#caivasop.a; |LIBERA #caivasop;
            |FINSI;
         |FINSI;
         LibroAnt = #caivarep#0; SerieAnt = #caivarep#27;
         |BORRA 020#caivarep.a; |LIBERA #caivarep;
      |FINSI;
   |FINSI;

   |SI #camaasil#12 = "S";
      #caivasop#0  = #camaasil#13;
      #caivasop#27 = #camaasil#15;
      #caivasop#2  = #camaasil#14;
      |LEE 101#caivasop.=;
      |SI FSalida = 0;
         aAlfa = #caivasop#35; |QBF aAlfa;
         aAlfa1 = aAlfa % 0102;
         |SI aAlfa1 = "**";
            aAlfa1 = aAlfa % 0302; #caivarep#0  = aAlfa1; LibContra = #caivarep#0;
            aAlfa1 = aAlfa % 0502; #caivarep#27 = aAlfa1; SerContra = #caivarep#27;
            aAlfa1 = aAlfa % 0706; #caivarep#2  = aAlfa1; FacContra = #caivarep#2;
            |LEE 101#caivarep.=;
            |SI FSalida = 0;
               |BORRA 020#caivarep.a; |LIBERA #caivarep;
            |FINSI;
         |FINSI;
         LibroAnt = #caivasop#0; SerieAnt = #caivasop#27;
         |BORRA 020#caivasop.a; |LIBERA #caivasop;
      |FINSI;
   |FINSI;

   |ATRI I;|PINTA 2207, "Borrando lineas de asientos      ";|ATRI N;
   Cuenta = #camaasil#4; nImporte = 0 - #camaasil#9; |HAZ Actualiza;
   |BORRA 020#camaasil.a;
|FPRC;

|DEFBUCLE BorraLinAsto;
#camaasil#1;
;
#camaasic#0,#camaasic#1,#camaasic#2,0001;
#camaasic#0,#camaasic#1,#camaasic#2,9999;
be;
NULL,BorraLinAsto;
|FIN;

|PROCESO BorraAsto;
   #camaasic#0  = #caenlace#0;
   #camaasic#1  = #caenlace#1;
   #camaasic#2  = nDOCUMENTO;
   |LEE 101#camaasic.=;
   |SI FSalida = 0;
      |BUCLE BorraLinAsto;
      |ATRI I;|PINTA 2207, "Borrando asientos                ";|ATRI N;
      |BORRA 020#camaasic.a;
   |FINSI;
   |LIBERA #camaasic;
|FPRC;

|PROCESO Asientos;
   |LEE 101#dsapunte.p; #dsapunte#5 = Contador; |GRABA 020#dsapunte.a; |LIBERA #dsapunte;
   Contador = Contador + 1; |SI Contador > 99999999999; Contador = 0; |FINSI;

   |SALVA_FICHA #caenlace;
   |SI EnDiario ! #caenlace#0; |O EnFecha ! #caenlace#1; |O EnAsto ! #caenlace#2;
      |SI LibroAnt ! #caenlace#11; |O SerieAnt ! #caenlace#12;
         LibContra = 0; SerContra = ""; FacContra = 0;
      |FINSI;
      #camaasic#0  = #caenlace#0;
      #camaasic#1  = #caenlace#1;
      #camaasic#2  = #caenlace#2; || nDOCUMENTO
      |LEE 101#camaasic.=;
      |SI FSalida = 0;
         nDOCUMENTO = #camaasic#2;
         |HAZ BorraAsto;
      |SINO;
         nDOCUMENTO = #caenlace#2;
      |FINSI;
      |LIBERA #camaasic;

      |SI #caenlace#25 = "S"; |O #caenlace#9 = 0;
         |BORRA 020#caenlace.a; |REPON_FICHA #caenlace;
         |ACABA;
      |FINSI;

      |DDEFECTO #camaasic;
      #camaasic#0 = #caenlace#0;
      #camaasic#1 = #caenlace#1;
      #camaasic#2 = #caenlace#2;
      nDOCUMENTO = #camaasic#2;
      #camaasic#3  = nDOCUMENTO;
      #camaasic#4 = 0; #camaasic#5 = 0; #camaasic#6 = 0; #camaasic#7 = 0;
      #camaasic#8  = ""; #camaasic#9  = 0;
      #camaasic#10 = ""; #camaasic#11 = 0;
      |ATRI I;|PINTA 2207, "Grabando cabeceras de asientos   ";|ATRI N;
      |GRABA 020#camaasic.n;
      EnDiario = #caenlace#0;
      EnFecha  = #caenlace#1;
      EnAsto   = #caenlace#2;
      |LIBERA #camaasic; |LEE 000#camaasic.=;
   |FINSI;

   |SI #caenlace#9 = 0;
      |REPON_FICHA #caenlace;
      |ACABA;
   |FINSI;

   |DDEFECTO #camaasil;
   #camaasil#0 = #camaasic#0;
   #camaasil#1 = #camaasic#1;
   #camaasil#2 = #camaasic#2;
   #caenlace#2 = #camaasic#2;
   #camaasil#3 = #caenlace#3;
   #camaasil#4 = #caenlace#4;
   #camaasil#5 = #caenlace#5;
   #camaasil#6 = #caenlace#6;
   #camaasil#7 = #caenlace#7;
   #camaasil#8 = #caenlace#8;
   #camaasil#9 = #caenlace#9;
   |SI #camaasil#8 = "D";
      #camaasil#10 = "";          #camaasil#11 = 0;
      #camaasil#16 = #camaasil#4; #camaasil#17 = #camaasil#5;
   |SINO;
      #camaasil#10 = #camaasil#4; #camaasil#11 = #camaasil#5;
      #camaasil#16 = "";          #camaasil#17 = 0;
   |FINSI;
   #camaasil#12 = #caenlace#10;
   #camaasil#13 = #caenlace#11;
   #camaasil#14 = #caenlace#13;
   #camaasil#15 = #caenlace#12;
   #camaasil#18 = " ";
   #camaasil#19 = #caenlace#26;
   #camaasil#20 = #caenlace#27;
   #camaasil#21 = #caenlace#15;
   #camaasil#22 = #caenlace#14;
   #camaasil#23 = "N";
   |ATRI I;|PINTA 2207, "Grabando lineas de asientos      ";|ATRI N;
   |GRABA 020#camaasil.n;
   |LIBERA #camaasil; |LEE 000#camaasil.=;

   |HAZ CreaRegistro;
   #caenlace#20 = "S";
   |GRABA 020#caenlace.a;

   Cuenta = #camaasil#4; nImporte = #camaasil#9; |HAZ Actualiza;
   |REPON_FICHA #caenlace;
|FPRC;

|DEFBUCLE Asientos;
#caenlace#1;
20;
00,"00.00.0000",000001,0000,"N";
99,"31.12.9999",999999,9999,"N";
be;
NULL,Asientos;
|FIN;

|PROCESO Actualiza;
   || Actualiza la cabecera del asiento
   |SI #camaasil#8 = "D";
      #camaasic#4 = #camaasic#4 + nImporte;
      |SI #camaasic#8 = "            ";
         #camaasic#8 = #camaasil#4; #camaasic#9 = #camaasil#5;
      |SINO;
         #camaasic#8 = ""; #camaasic#9 = 0;
      |FINSI;
   |SINO;
      #camaasic#5 = #camaasic#5 + nImporte;
      |SI #camaasic#10 = "            ";
         #camaasic#10 = #camaasil#4; #camaasic#11 = #camaasil#5;
      |SINO;
         #camaasic#10 = ""; #camaasic#11 = 0;
      |FINSI;
   |FINSI;
   #camaasic#6 = #camaasic#4 - #camaasic#5;
   |GRABA 020#camaasic.a;

   || Actualiza el diario
   #camandia#0 = #camaasic#0;
   |LEE 101#camandia.=;
   |SI FSalida ! 0;
      |DDEFECTO #camandia;
      #camandia#0 = #camaasic#0;
      Comodin = ("00" + #camaasic#0) % -102; Comodin = "DIARIO " + Comodin;
      #camandia#1 = Comodin;
      |GRABA 020#camandia.b;
   |FINSI;

   |SI #camaasil#8 = "D";
      #camandia#2 = #camandia#2 + nImporte;
   |SINO;
      #camandia#3 = #camandia#3 + nImporte;
   |FINSI;
   |GRABA 020#camandia.a; |LIBERA #camandia;

   || Actualiza la cuenta del apunte
   Cuenta = #camaasil#4; |HAZ SacaNivel;
   |SI Nivel = 0;
      Comodin = #camaasil#4; |QBF Comodin;
      Comodin = "    La cuenta " + Comodin + " no tiene longitud correcta";
      |MENAV Comodin;
   |FINSI;
   Comodin = Cuenta; |QBF Comodin;
   |SI Comodin = ""; |Y ErrorDoc ! #caenlace#2;
      Comodin = "    El asiento " + (("00"+#caenlace#0)%-102) + "/";
      Comodin = Comodin + #caenlace#1 + "/";
      Comodin = Comodin + (("000000"+#caenlace#2)%-106) + "/";
      Comodin = Comodin + " tiene apuntes sin cuenta asignada";
      |MENAV Comodin;
      ErrorDoc = #caenlace#2;
   |FINSI;

   Cuenta1 = Cuenta; |HAZ ActCuenta;

   || Actualiza los niveles superiores
   Nivel = Nivel - 1;
   |PARA; |SI Nivel > 0; |HACIENDO Nivel = Nivel - 1;
          |SI Nivel = 1; Calc = Dig1; |FINSI;
          |SI Nivel = 2; Calc = Dig2; |FINSI;
          |SI Nivel = 3; Calc = Dig3; |FINSI;
          |SI Nivel = 4; Calc = Dig4; |FINSI;
          |SI Nivel = 5; Calc = Dig5; |FINSI;
          |SI Nivel = 6; Calc = Dig6; |FINSI;
          Calc = Calc + 100;
          Comodin = Cuenta1; |QBF Comodin;
          Cuenta = Comodin % Calc; |HAZ ActCuenta;
   |SIGUE;
|FPRC;

|PROCESO SacaNivel;
   Comodin = Cuenta; |QBF Comodin;
   aLong = Comodin % 0; nLong = aLong;
   Nivel = 0;
   |SI nLong = Dig1; Nivel = 1; |FINSI;
   |SI nLong = Dig2; Nivel = 2; |FINSI;
   |SI nLong = Dig3; Nivel = 3; |FINSI;
   |SI nLong = Dig4; Nivel = 4; |FINSI;
   |SI nLong = Dig5; Nivel = 5; |FINSI;
   |SI nLong = Dig6; Nivel = 6; |FINSI;
|FPRC;

|PROCESO ActCuenta;
   #cacuenta#0 = Cuenta; ||HAZ SacaNivel;
   #cacuenta#1 = Nivel;
   |LEE 101#cacuenta.=;
   |SI FSalida ! 0;
      |DDEFECTO #cacuenta;
      |PARA nCont = 6; |SI nCont ] 1; |HACIENDO nCont = nCont - 1;
         Calc = 13 + nCont;
         Calc = 100 + #canempre#Calc#;
         Comodin = Cuenta % Calc;
         #cacuenta#0 = Comodin;
         #cacuenta#1 = nCont;
         |LEE 000#cacuenta.=;
         |SI FSalida = 0;
            |SAL;
         |FINSI;
      |SIGUE;
      #cacuenta#0 = Cuenta;
      #cacuenta#1 = Nivel;
      |GRABA 020#cacuenta.b;
      |PUSHV 0501 2380; #cacuenta#3 = "S";
      |PINPA #0#cacuenta; |PINDA #0#cacuenta;
      |ENDATOS #1#cacuenta;
      |POPV;
   |FINSI;

   Comodin = #camaasil#1; |QBF Comodin;
   Comodin = Comodin % 0402; ComodNum = Comodin;
   CmpDebe = (ComodNum * 3) + 9;
   CmpHaber = CmpDebe + 1;
   CmpSaldo = CmpDebe + 2;
   |SI #camaasil#8 = "D";
      #cacuenta#CmpDebe# = #cacuenta#CmpDebe# + nImporte;
   |SINO;
      #cacuenta#CmpHaber# = #cacuenta#CmpHaber# + nImporte;
   |FINSI;
   #cacuenta#CmpSaldo# = #cacuenta#CmpDebe# - #cacuenta#CmpHaber#;

   CmpDebe = 0; CmpHaber = 0; CmpSaldo = 0;
   TotDebe = 0; TotHaber = 0; TotSaldo = 0;
   |PARA Cont = 12; |SI Cont [ 45; |HACIENDO Cont = Cont + 3;
        CmpDebe = Cont; CmpHaber = Cont + 1; CmpSaldo = Cont + 2;
        TotDebe  = TotDebe  + #cacuenta#CmpDebe#;
        TotHaber = TotHaber + #cacuenta#CmpHaber#;
        TotSaldo = TotSaldo + #cacuenta#CmpSaldo#;
   |SIGUE;

   #cacuenta#51 = #cacuenta#9 + TotDebe;
   #cacuenta#52 = #cacuenta#10 + TotHaber;
   #cacuenta#53 = #cacuenta#11 + TotSaldo;
   |SI #camaasic#1 > #cacuenta#58; #cacuenta#58 = #camaasic#1; |FINSI;

   |GRABA 020#cacuenta.a; |LIBERA #cacuenta;
|FPRC;

|PROGRAMA;
   Path = PARAMETRO;
   Path = Path - ",";
   |SI FSalida ! 0;
      Calc = FSalida + 98;
      aNombre = Path % Calc; Path = Path - aNombre;
   |FINSI;
   |PATH_DAT #0  Path; |ABRET #dsapunte;

   Respuesta = "";
   |PARA; |SI; |HACIENDO;
      |LEE 000#dsapunte.p;
      |SI FSalida ! 0;
         |DDEFECTO #dsapunte;
         |GRABA 020#dsapunte.n;
         |LEE 000#dsapunte.p;
      |FINSI;
      |SI #dsapunte#1 = "N";
         |LEE 101#dsapunte.p;
         |SI FSalida = 0;
            #dsapunte#1 = "S";
            #dsapunte#2 = ~;
            |HORA Comodin; Comodin = Comodin % 0105; #dsapunte#3 = Comodin;
            Comodin = Usuario % 1008; #dsapunte#4 = Comodin;
            |GRABA 020#dsapunte.a; |LIBERA #dsapunte;
            |ATRI N;|PINTA 2307,"                                      "; |ATRI N;
            |SAL;
         |FINSI;
      |SINO;
         FechaHoy = ~;  FechaEnl = #dsapunte#2;
         |HORA Comodin;
         Comodin1 = Comodin % 0102; Hora        = Comodin1;
         Comodin1 = Comodin % 0402; Minutos     = Comodin1;
         Comodin1 = Comodin % 0702; Segundos    = Comodin1;
         |SI HoraEnl = 0; |Y MinutosEnl = 0; |Y SegundosEnl = 0;
            |HORA Comodin; |QBF Comodin;
            Comodin1 = Comodin % 0102; HoraEnl     = Comodin1;
            Comodin1 = Comodin % 0402; MinutosEnl  = Comodin1;
            Comodin1 = Comodin % 0702; SegundosEnl = Comodin1;
            SegundosEnl = SegundosEnl + 30;
            |SI SegundosEnl ] 60;
               MinutosEnl = MinutosEnl + 1; SegundosEnl = SegundosEnl - 60;
               |SI MinutosEnl ] 60;
                  HoraEnl = HoraEnl + 1; MinutosEnl = MinutosEnl - 60;
               |FINSI;
            |FINSI;
         |SINO;
            |SI Cambiante ! #dsapunte#5;
                Cambiante = #dsapunte#5;
                |HORA Comodin; |QBF Comodin;
                Comodin1 = Comodin % 0102; HoraEnl     = Comodin1;
                Comodin1 = Comodin % 0402; MinutosEnl  = Comodin1;
                Comodin1 = Comodin % 0702; SegundosEnl = Comodin1;
                SegundosEnl = SegundosEnl + 30;
                |SI SegundosEnl ] 60;
                   MinutosEnl = MinutosEnl + 1; SegundosEnl = SegundosEnl - 60;
                   |SI MinutosEnl ] 60;
                      HoraEnl = HoraEnl + 1; MinutosEnl = MinutosEnl - 60;
                  |FINSI;
                |FINSI;
            |SINO;
               Comodin  = (("00" + Hora)    % -102) + (("00" + Minutos)    % -102) + (("00" + Segundos)    % -102);
               Comodin1 = (("00" + HoraEnl) % -102) + (("00" + MinutosEnl) % -102) + (("00" + SegundosEnl) % -102);
               |SI FechaHoy = FechaEnl; |Y Comodin1 ] Comodin;
                  |ATRI I; |PINTA 2307, "Enlace Bloqueado, Espere por favor .. "; |ATRI N;
               |SINO;
                  |SI Respuesta = "";
                     |PUSHV 0501 2380; |BLANCO 1010 1870; |CUADRO 1010 1870;
                     |PINTA 1112, "Hay un enlace activo que parece bloqueado.";
                     Comodin = "Fecha comienzo enlace : " + #dsapunte#2 + "   Hora comienzo : " + #dsapunte#3;
                     |PINTA 1212, Comodin;
                     Comodin = "Usuario que lanzo el enlace : " + #dsapunte#4;
                     |PINTA 1312, Comodin;
                     Comodin = "¨ Desea anularlo ? (SI/NO) : ";
                     |PINTA 1513, Comodin;
                     E_sup = 2; E_inf = "SINO";
                     Respuesta = "NO";
                     Respuesta = 1541 ? 0;
                     |SI Respuesta = "SI";
                        #dsapunte#1 = "S";
                        #dsapunte#2 = ~;
                        |HORA Comodin; Comodin = Comodin % 0105;
                        #dsapunte#3 = Comodin;
                        |GRABA 020#dsapunte.a; |LIBERA #dsapunte;
                        |ATRI N;|PINTA 2307,"                                      "; |ATRI N;
                        |SAL;
                     |SINO;
                        Respuesta = "";
                     |FINSI;
                     |POPV;
                  |SINO;
                     |ATRI I; |PINTA 2307, "Enlace Bloqueado, Espere por favor .. "; |ATRI N;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |SIGUE;

   |PATH_DAT #1  Path;
   ||PATH_DAT #2  Path;
   |PATH_DAT #3  Path;
   |PATH_DAT #4  Path;
   |PATH_DAT #5  Path;
   |PATH_DAT #6  Path;
   |PATH_DAT #7  Path;
   |PATH_DAT #8  Path;
   |PATH_DAT #9  Path;
   |PATH_DAT #10  Path;
   |PATH_DAT #11  Path;
   |PATH_DAT #12  Path;
   Comodin = Path % -107;
   Path = Path - Comodin;
   |PATH_DAT #30 Path;
   Path = PARAMETRO; Path = Path - ","; Path = Path - aNombre;

   |HAZ inicio;
   |SI aNombre ! ""; |NOME_DAT #1 aNombre; |FINSI;

   |ABRE #caenlace;
   |ABRE #camaasic;
   |ABRE #camaasil;
   |ABRE #cacuenta;
   |ABRE #camandia;
   |ABRE #canempre;
   |ABRE #caivarep;
   |ABRE #caivasop;
   |ABRE #caivases;

   Comodin = PARAMETRO; |QBF Comodin;
   |SI aNombre ! ""; Comodin = Comodin - ","; Comodin = Comodin - aNombre; |FINSI;
   Comodin = Comodin % -107;
   Comodin = Comodin - "/";
   Comodin1 = Comodin % 0105; #canempre#2 = Comodin1;
   Comodin1 = Comodin % -101; #canempre#3 = Comodin1;
   |LEE 000#canempre.=;
   |SI FSalida = 0;
      Dig1 = #canempre#14; Dig2 = #canempre#15; Dig3 = #canempre#16;
      Dig4 = #canempre#17; Dig5 = #canempre#18; Dig6 = #canempre#19;
      MaxNiv = #canempre#13;
   |FINSI;

   Contador = 0;
   |BUCLE Asientos;

   |CIERRA #caivases;
   |CIERRA #caivasop;
   |CIERRA #caivarep;
   |CIERRA #canempre;
   |CIERRA #camandia;
   |CIERRA #cacuenta;
   |CIERRA #camaasil;
   |CIERRA #camaasic;
   |CIERRA #caenlace;

   |LEE 101#dsapunte.p;
   |SI FSalida = 0;
      #dsapunte#1 = "N";
      |GRABA 020#dsapunte.a; |LIBERA #dsapunte;
   |FINSI;
   |CIERRAT #dsapunte;

|FPRO;
