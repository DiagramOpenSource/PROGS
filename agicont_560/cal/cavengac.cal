|FICHEROS;
    cavengac #0;
    camaasic #1;
    camaasil #2;
    catracfe #3; || def para los tipos de IVA;
    caivarep #4;
    cacuenta #5;
    cavengca #6;
    cavengli #7;
    catracf1 #8; || trabajo para apuntes
    catradia #9; || trabajo para actualizar cuentas
    camandia #10;
    cagruiva #11;
    caivaasi #12;
|FIN;

|VARIABLES;
    &pepe = 0;
    &entrada = 1;
    &modcon = 0;

    alfa1 = "";
    alfa2 = "";
    avisos = "";

    quenum1 = 0;
    quenum2 = 0;
    quenumt = 0;
    swquenum = 0;

    libro = 0;
    sw = 0;
    sw_ERROR = 0;
    sw_che = 0;
    antnum = 0;

    diario = 0;
    fecha = @;
    docume = 0;
    asient = 0;

    numfac1 = 0;
    numfacu = 0;
    desant = "";
    desact = "";
    primera = "";
    ultima = "";

    iv1 = 0;
    iv2 = 0;
    iv3 = 0;
    iv4 = 0;
    iv5 = 0;
    re1 = 0;
    re2 = 0;
    re3 = 0;
    re4 = 0;
    re5 = 0;
    ctipos = 0;

    num = 0;
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    nume5 = 0;
    nume6 = 0;
    nume7 = 0;
    nume8 = 0;
    num21 = 0;
    num22 = 0;
    num23 = 0;
    num24 = 0;
    num25 = 0;

    totfac = 0;
    tope_cant = 0;
    totanter = 0;

    tipo   = "";
    cue    = "";
    niv    = 0;
    tpiva  = 0;
    tprec  = 0;
    concep = 0;
    imp    = 0;
    descr  = "";

    cam = 0;
    error = 0;

    linea = 0;
    sw_fin = 0;
    aun_hay = 0;
    ac = 0;
    sw_ac = 0;
    sihay = 0;
    y  = 0;
    x  = 0;
    x1 = 0;
    x2 = 0;
    x3 = 0;
    x4 = 0;
    x5 = 0;
    ceros = "000000";
    estado = 0;

{-1}opcion = "";
    opcion1 = "2400";
    opcion2 = "1";
    opcion3 = " Desea continuar: ";
    opcion4 = "NSB";
    opcion5 = " No ";
    opcion6 = " Si - al final "
    opcion7 = " si - Buscando huecos ";

   fecalf = "";
   ini = 0;
   mes = "";
   mesfec = 0;
   mesac = 0;
   a = 0;
   b = 0;
   c = 0;
|FIN;


|INCLUYE acceso_i;
|INCLUYE conasi_i;

|| _________________________________ Calculos de pantalla

|PROCESO mayor;
  #0Campo = #0Campo > " ";
  |PINTA #0Campo;
|FPRC;

|PROCESO control; |TIPO 8;
 |HAZ inicio;
 |SI pepe = 1;
     |CAMPO_MODIFICA #0#0, 1, "N";
     |CAMPO_MODIFICA #0#1, 1, "N";
 |FINSI;
 |ABRE #12;
 |DDEFECTO #12;
 |LEE 001#12p;
 tope_cant = #12#38;     || cantidad tope de facturas englobadas
 |CIERRA #12;
|FPRC;

|PROCESO def_fechas; |TIPO 7;
 #0#0 = fec1; |PINTA #0#0;
 #0#1 = fec2; |PINTA #0#1;
|FPRC;

|PROCESO fecha; |TIPO 0;
  |SI #0Campo < fec1; |O #0Campo > fec2;
      |MENAV "     Fecha ERRONEA ";
      |ERROR;
      |ACABA;
  |FINSI;
  |SI #0Campo = 1;
      |SI #0#1 > #0#0;
          |MENAV "     Fecha ERRONEA ";
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO entrada; |TIPO 0;
  |HAZ contador;
  |ABRE #1;
  #1#0 = #0#2;
  #1#1 = fec2;
  #1#2 = 999999;
  |LEE 040#1>;
  |SI FSalida = 0;
      |LEE 040#1a;
  |SINO;
      |LEE 040#1u;
      |SI FSalida ! 0;
          #1#1 = fec1;
      |FINSI;
  |FINSI;
  #0#3 = #20#1; |PINTA #0#3;
  #0#4 = #20#1; |PINTA #0#4;
  |CIERRA #1;
|FPRC;

|| **************************************************************************

|| ___________________/ Calcular el ultimo numero de factura del libro
|PROCESO ult_fra;
  |ABRE #4;
  #4#0 = libro;
  #4#2 = 999999;
  #4#27 = "  ";
  |LEE 001#4];
  |SI FSalida = 0;
      |LEE 001#4a;
      |SI FSalida ! 0; |O libro ! #4#0;
          #4#2 = 0;
      |FINSI;
      antnum = #4#2;
  |SINO;
      |LEE 001#4u;
      |SI FSalida ! 0; |O libro ! #4#0;
          #4#2 = 0;
      |FINSI;
      antnum = #4#2;
  |FINSI;
  |CIERRA #4;
|FPRC;

|PROCESO huecos;
  |ABRE #4;
  #4#0 = libro;
  #4#2 = quenum2;
  #4#27 = "  ";
  |LEE 001#4=;
  |SI FSalida ! 0;
      |LEE 001#4a;
      |SI FSalida ! 0; |O libro ! #4#0;
          #4#2 = 0;
      |FINSI;
  |FINSI;
  quenum1 = #4#2;

|ET leesiguiente;
  swquenum = 1;
  |LEE 001#4s;
  |SI FSalida ! 0; |O libro ! #4#0;
      swquenum = 0;
      #4#2  = 999999;
      #4#62 = 0;
  |FINSI;
  quenumt = #4#2 - #4#62;  || la ultima libre.
  |SI quenumt = quenum1;
      quenum1 = #4#2;
      |SI quenum1 < 999999;
          |VETE leesiguiente;
      |FINSI;
  |FINSI;
|CIERRA #4;
|FPRC;

____________________________________/ CHEQUEO DE EXISTENTES
|PROCESO si_existe;
  |SI sw = 0;
      sw = 1;
      libro = #6#1; |HAZ ult_fra;
  |FINSI;
  |SI libro ! #6#1;
      libro = #6#1; |HAZ ult_fra;
  |FINSI;
  |SI antnum > #6#3;
        avisos = #6#0 + " Existen Facturas POSTERIORES !!!";
        |HAZ aviso5;
        |ERROR10;
  |FINSI;
|FPRC;

|DEFBUCLE chequea1;
 #6#1;
 ;
 #0#0;
 #0#1;
 b;
 NULL, NULL, NULL, NULL, NULL, si_existe;
 #6#1, #6#0;
|FIN;

||**************************************************************************
|PROCESO si_quedan;
    aun_hay = 1;
    #6#15 = #6#15 + #7#4  + #7#5  +  #7#6 +  #7#7 +  #7#8;
    #6#16 = #6#16 + #7#9  + #7#10 + #7#11 + #7#12 + #7#13;
    #6#17 = #6#17 + #7#14 + #7#15 + #7#16 + #7#17 + #7#18;
    #6#19 = #6#15 + #6#16 + #6#17;
|FPRC;

|PROCESO borra_cab1;
    aun_hay = 0;
    #6#15 = 0;
    #6#16 = 0;
    #6#17 = 0;
    #6#19 = 0;
|BUCLELIN 2si_quedan#6;
|SI aun_hay = 0;
    |BORRA 020#6a;
|SINO;
    |GRABA 020#6a;
    |LIBERA #6;
|FINSI;
|FPRC;

|DEFBUCLE borra_cab;
 #6#1;
 ;
 #0#0;
 #0#1;
 e;
 NULL, borra_cab1;
|FIN;

____________________________________/ ACTUALIZACION

|PROCESO lineas;
 |SI cam = 0;
     |HAZ nueva;
     |SI sw_ERROR ! 0; |ERROR10; |ACABA; |FINSI;
     cam = 1;
 |FINSI;

 totanter = totfac + #7#3;
 |SI totanter > tope_cant;
     |HAZ factura;
     |HAZ asiento;
     |HAZ nueva;
     |SI sw_ERROR ! 0; |ERROR10; |ACABA; |FINSI;
 |FINSI;
 |HAZ traba_lineas;
 |SI sw_ERROR ! 0; |ERROR10; |ACABA; |FINSI;

 |SI error = 0;
     |BORRA 020#7a;
 |FINSI;
|FPRC;

|PROCESO hacer;
     cam = 0;
  libro  = #6#1;
  fecha  = #6#0;

  quenum1 = #6#3; || anterior al hueco;
  quenum2 = #6#3; || a partir de este numero buscar huecos;
  quenumt = 999999; || ultimo numero libre.
  swquenum = 0;

  |HAZ ult_fra;
  |SI antnum [ #6#3;  |Y sw_che = 0;
      numfacu = #6#3;
  |SINO;
      |SI sw_che ! 3;
          #6#3 = antnum;
          numfacu = #6#3;
      |SINO;
          quenum2 = #6#3;
          |HAZ huecos;
          numfacu = quenum1;
      |FINSI;
  |FINSI;

  |SI numfacu ] 999999; |HAZ errorgordo; |ERROR10; |ACABA; |FINSI;

  |BUCLELIN 0lineas#6;
  |HAZ factura;
  |HAZ asiento;
  |SI sw_ERROR ! 0; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE cavengac0;
 #6#1;
 ;
 #0#0;
 #0#1;
 be;
 NULL, hacer;
|FIN;

||**************************************************************************
|| ******************* PROCESO POR TIPO 3 **********************************
||**************************************************************************

|PROCESO actual; |TIPO 3;
  diario = #0#2;
  docume = #0#3;
  asient = #0#4;
  sw = 0;
  sw_che = 0;
  |SI #0#8 = "N";
      |BUCLE chequea1;  || Numero de Facturas Superiores
  |SINO;
      |SI #0#8 = "F";
          sw_che = 2;
      |SINO;
          sw_che = 3;
      |FINSI;
  |FINSI;
  |SI sw_che = 1; |ACABA; |FINSI;
  sw = 0;
  |ABRE #1;
  |ABRE #2;
  |ABRE #6;
  |ABRE #7;
  |ABRE #8;

  || .................. Abre fichero Auxiliar de Cuentas
  |ABRE #9;
  |LEE 101#9u;
  |SI FSalida ! 0;
      |DDEFECTO #9;
      #9#0 = 1;
  |SINO;
      #9#0 = #9#0 + 1;
  |FINSI;
  |GRABA 101#9n;
  codcon = #9#0;
  |LIBERA #9;
  || ==============================================================

     sw_fin = 0;
  |BUCLE cavengac0;
  |CIERRA #1;
  |CIERRA #2;
  |CIERRA #6;
  |CIERRA #7;
  |CIERRA #8;
  |CIERRA #9;
  |BUCLE borra_cab;
  |DELINDEX #8;

 || ............... Terminar
 |SI modcon = 0;
     |ABRET #9;
     |DDEFECTO #9;
     #9#0 = codcon;
     |LEE 040#9=;
     |BORRA 101#9a;
     |CIERRAT #9;
 |SINO;
     |CORRE "camaapua.tab"
 |FINSI;
|FPRC;

|| **********************************************************************
|PROCESO nueva; || para crear la factura ya

  |DDEFECTO #3;
  #3#0 = libro;
  numfac1 = numfacu + 1;
  #3#1 = numfac1;
  #3#2 = numfacu;
  #3#29 = #6#13;
    totfac = 0;
    ctipos = 0;
  |CIERRA #8;
  |DELINDEX #8;
  |ABRE #8;

  |SI numfacu ] 999999; |HAZ errorgordo; |ACABA; |FINSI;

|SI sw_fin = 1;
    |HAZ contador;
    docume = #20#1;
    asient = asient + 1;
|FINSI;
sw_fin = 1;
|FPRC;

|PROCESO traba_lineas;
 error = 0;
 |ABRE #11;
 #11#0 = #7#2;
 |LEE 001#11=;
 |SI FSalida ! 0; |CIERRA #11; error = 1; |ACABA; |FINSI;

 |SI numfacu ] 999999; |HAZ errorgordo; |ACABA; |FINSI;

 |SI swquenum = 1;
     |SI numfacu = quenumt;
         |HAZ factura;
         |HAZ asiento;
         |HAZ buscar;
         |HAZ nueva;
         |SI sw_ERROR ! 0; |ACABA; |FINSI;
     |FINSI;
 |FINSI;

 |SI ctipos ! 0; |HAZ verBases; |FINSI; || Comprobar que hay menos de 5 bases
 |SI sw_ERROR ! 0; |ACABA; |FINSI;

sihay= 0;
|PARA num = 1; |SI num [ 5; |HACIENDO num = num + 1;
  |HAZ sumanume;
      sihay = 1;
  |SI #7num21 ! 0;   || Existe Importe de Base.
      tpiva = #7num22;     || % iva
      tprec = #7num24;     || % rec.
|| .............................................../ Base
      tipo = "B";         ||Base ...
      cue  =  #11nume1;   || cuenta
      x = nume1 + 15;
      niv  = #11x;        || digito
      concep = #11nume2;  || concepto
      x = nume2 + 15;
      descr  = #11x;      || descripcion
      imp = #7num21;
      |HAZ gratra1;
|| .............................................../ IVA
      |SI #7num23 ! 0;
          tipo = "I";         || IVA
          cue  =  #11nume4;   || cuenta
          x = nume4 + 15;
          niv  = #11x;        || digito
          concep = #11nume5;   || concepto
          x = nume5 + 15;
          descr  = #11x;       || descripcion
          imp = #7num23;
          |HAZ gratra1;
      |FINSI;
|| ............................................../ Recargo
      |SI #7num25 ! 0;
          tipo = "R";        || Recargo
          cue  =  #11nume7;  || cuenta
          x = nume7 + 15;
          niv  = #11x;        || digito
          concep = #11nume8;   || concepto
          x = nume8 + 15;
          descr  = #11x;       || descripcion
          imp = #7num25;
          |HAZ gratra1;
      |FINSI;
|| ........................................................................

      |HAZ acumulador2;
      x1 = ac + 2;
      x2 = ac + 7;  x3 = ac + 12;
      x4 = ac + 17; x5 = ac + 22;
      #3x1 = #3x1 + #7num21;
      #3x2 = #7num22;
      #3x3 = #3x3 + #7num23;
      #3x4 = #7num24;
      #3x5 = #3x5 + #7num25;
      totfac = totfac + #7num21 + #7num23 + #7num25;
      #3#28  = totfac;
  |FINSI;
|SIGUE;
  |SI sihay = 1;
      numfacu = numfacu + 1;
      #3#2 = numfacu;
  |FINSI;
|FPRC;

|PROCESO acumulador2;
    sw_ac = 0; ac = 0;
|SI tpiva = #3#8;  |Y tprec = #3#18; ac = 1; sw_ac = 1; |FINSI;
|SI tpiva = #3#9;  |Y tprec = #3#19; ac = 2; sw_ac = 1; |FINSI;
|SI tpiva = #3#10; |Y tprec = #3#20; ac = 3; sw_ac = 1; |FINSI;
|SI tpiva = #3#11; |Y tprec = #3#21; ac = 4; sw_ac = 1; |FINSI;
|SI tpiva = #3#12; |Y tprec = #3#22; ac = 5; sw_ac = 1; |FINSI;

   |SI sw_ac = 1; |ACABA; |FINSI;
   ctipos = ctipos + 1; ac = ctipos; sw_ac = 1;
|FPRC;

|PROCESO verBases;
 x = 0;
 iv1 = 0; iv2 = 0; iv3 = 0; iv4 = 0; iv5 = 0;
 re1 = 0; re2 = 0; re3 = 0; re4 = 0; re5 = 0;
|PARA num = 1; |SI num [ 5; |HACIENDO num = num + 1;
  |HAZ sumanume;
  |SI #7num21 ! 0;   || Existe Importe de Base.
      tpiva = #7num22;     || % iva
      tprec = #7num24;     || % rec.
      sw_ac = 0;
      |SI tpiva = #3#8;  |Y tprec = #3#18; sw_ac = 1; |FINSI;
      |SI tpiva = #3#9;  |Y tprec = #3#19; sw_ac = 1; |FINSI;
      |SI tpiva = #3#10; |Y tprec = #3#20; sw_ac = 1; |FINSI;
      |SI tpiva = #3#11; |Y tprec = #3#21; sw_ac = 1; |FINSI;
      |SI tpiva = #3#12; |Y tprec = #3#22; sw_ac = 1; |FINSI;

      |SI sw_ac = 0;
          |PARA y = 1; |SI y [ x; |HACIENDO y = y + 1;
                |SI iv1 = tpiva; |Y re1 = tprec; sw_ac = 1; |FINSI;
                |SI iv2 = tpiva; |Y re2 = tprec; sw_ac = 1; |FINSI;
                |SI iv3 = tpiva; |Y re3 = tprec; sw_ac = 1; |FINSI;
                |SI iv4 = tpiva; |Y re4 = tprec; sw_ac = 1; |FINSI;
                |SI iv5 = tpiva; |Y re5 = tprec; sw_ac = 1; |FINSI;
          |SIGUE;
          |SI sw_ac = 0;
                x = x + 1;
                |SI x = 1; iv1 = tpiva; re1 = tprec; |FINSI;
                |SI x = 2; iv2 = tpiva; re2 = tprec; |FINSI;
                |SI x = 3; iv3 = tpiva; re3 = tprec; |FINSI;
                |SI x = 4; iv4 = tpiva; re4 = tprec; |FINSI;
                |SI x = 5; iv5 = tpiva; re5 = tprec; |FINSI;
          |FINSI;
      |FINSI;
  |FINSI;
|SIGUE;
  x = x + ctipos;
  |SI x > 5;
     |HAZ factura;
     |HAZ asiento;
     |HAZ nueva;
  |FINSI;
|FPRC;

|PROCESO buscar; || busca en siguiente Hueco;
  quenum1 = numfacu; || anterior al hueco;
  quenum2 = numfacu; || a partir de este numero buscar huecos;
  quenumt = 999999; || ultimo numero libre.
  swquenum = 0;
  |HAZ huecos;
  numfacu = quenum1;
|FPRC;


|PROCESO gratra1; || trabajo para crear apuntes y factura.
 #8#0 = tipo;    || B/I/R
 #8#1 = cue;     || cuenta
 #8#2 = niv;     || digito
||  #8#4 = tpiva;   || % iva  || si no son clave, una solo contrapartida.
||  #8#5 = tprec;   || % rec. || Clave, tantas cuentas como tipo iva.
 #8#6 = concep;  || concepto.
 |LEE 101#8=;
 |SI FSalida ! 0;
     #8#0 = tipo;    || B/I/R
     #8#1 = cue;     || cuenta
     #8#2 = niv;     || digito
     #8#3 = 0;       || Importe;
     #8#4 = tpiva;   || % iva
     #8#5 = tprec;   || % rec.
     #8#6 = concep;  || concepto.
     #8#7 = "";      || descripcion;
     |GRABA 020#8b;
 |FINSI;
 #8#3 = #8#3 + imp;
 #8#7 = descr;
 |SI tpiva ! #8#4; |O tprec ! #8#5; || quitando esto dejamos que grabe la
     #8#4 = -1; #8#5 = -1;          || misma cuenta segun el %IVA.
 |FINSI;                            || As¡, agrupamos las cuentas en apunte.
 |GRABA 020#8a;
 |LIBERA #8;
|FPRC;

|PROCESO factura; || Crear la factura;
 |SI numfac1 > numfacu; |ACABA; |FINSI; || no hay ninguna factura;
    primera = numfac1; primera = (ceros + primera) % -106;
    ultima  = numfacu; ultima  = (ceros + ultima ) % -106;
    desant =  " " + primera + " a " + ultima;
    |SI numfac1 = numfacu; desant = " "+ primera; |FINSI;
|| ....................................
 |ABRE #4;
 |DDEFECTO #4;
 #4#0 = #3#0;
 #4#2 = #3#2;
 #4#27 = #3#29;
 |LEE 001#4=;
 estado = FSalida;
 #4#0 = #3#0; #0#5 = #4#0; |PINTA #0#5;
 #4#2 = #3#2; #0#6 = #4#2; |PINTA #0#6;
 #4#27 = #3#29;
 #4#1  = #6#2;
 #4#3  = fecha;
 #4#4  = #6#4;
 #4#5  = #6#5;
 #4#6  = #6#6; desact = #6#7; |QBF desact;
 #4#7  = desact + desant;
 #4#8  = #3#3;  #4#9  = #3#4;  #4#10 = #3#5;  #4#52 = #3#6;  #4#53 = #3#7;
 #4#11 = #3#8;  #4#12 = #3#9;  #4#13 = #3#10; #4#54 = #3#11; #4#55 = #3#12;
 #4#14 = #3#13; #4#15 = #3#14; #4#16 = #3#15; #4#56 = #3#16; #4#57 = #3#17;
 #4#17 = #3#18; #4#18 = #3#19; #4#19 = #3#20; #4#58 = #3#21; #4#59 = #3#22;
 #4#20 = #3#23; #4#21 = #3#24; #4#22 = #3#25; #4#60 = #3#26; #4#61 = #3#27;
 #4#26 = #3#28;
 #4#23 = "S";
 #4#24 = "N";
 #4#28 = "N";
 #4#44 = #6#12;
 #4#45 = diario;
 #4#46 = fecha;
 #4#47 = docume;
 #4#48 = #6#11;
 #4#49 = #6#10;
 #4#50 = #6#8;
 #4#51 = #6#9;

 #4#62 = 1 + numfacu - numfac1;
 |SI estado = 0;
     |GRABA 020#4a;
 |SINO;
     |GRABA 020#4n;
 |FINSI;
 |LIBERA #4;
|CIERRA #4;
|FPRC;


|PROCESO asiento; || Graba el Asiento
 |SI numfac1 > numfacu; |ACABA; |FINSI; || no hay ninguna factura;
 |HAZ cabecera;

    primera = numfac1; primera = (ceros + primera) % -106;
    ultima  = numfacu; ultima  = (ceros + ultima ) % -106;
    desant =  " " + primera + " a " + ultima;
    |SI numfac1 = numfacu; desant = " "+ primera; |FINSI;

    |DDEFECTO #2;
    #2#0 = diario;
    #2#1 = fecha;
    #2#2 = docume;
    linea = linea + 10;
    #2#3 = linea;
    #2#4 = #6#4;
    #2#5 = #6#5;
    #2#6 = #6#6; desact = #6#7; |QBF desact;
    #2#7 = desact + desant;
    #2#8 = "D";
    #2#9 = totfac;
    #2#21 = #6#10;
    |HAZ adapta;
    |HAZ a_diario;
    |HAZ a_cuenta;

    #2#12 = "R";           || repercutido
    #2#13 = #4#0;          || libro
    #2#14 = #4#2;          || factura
    #2#15 = #4#27;         || serie (inhibida)
    #2#19 = "F";            || tipo acumulador
    #2#20 = 0;             || nro. acumulador
|GRABA 020#2n;

    |HAZ gratra;
    |HAZ act_cabecera;
|| ..................... ................ Graba contrapartidas

|LEE 001#8p;
|VETE sigcua;
|ET siglee;
    |LEE 001#8s;
    |SI FSalida ! 0;
        |VETE fincua;
    |FINSI;
|ET sigcua;
        #2#0 = diario;
        #2#1 = fecha;
        #2#2 = docume;
        linea = linea + 10;
        #2#3 = linea;
        #2#4 = #8#1;
        #2#5 = #8#2;
        #2#6 = #8#6; desact = #8#7; |QBF desact; || concepto para este apunte
        #2#7 = desact + desant;

        #2#8 = "H";
        #2#9 = #8#3;
        |HAZ adapta;
        |HAZ a_diario;
        |HAZ a_cuenta;

        #2#12 = "R";           || repercutido
        #2#13 = #4#0;          || libro
        #2#14 = #4#2;          || factura
        #2#15 = #4#27;         || serie (inhibida)
        #2#12 = "R";           || soportado
        #2#19 = #8#0;          || tipo acumulador
        |HAZ acumulador;
        #2#20=ac;              || numero acumulador
        #2#21 = #6#10;
        |GRABA 020#2n;
        |LIBERA #2;
        |HAZ gratra;
        |HAZ act_cabecera;
    |VETE siglee;
|ET fincua;
|FPRC;

|PROCESO gratra; || trabajo para actualizar cuentas del Plan Contable
 modcon = 1;               || graba el temporal para la actualiz. de ctas.
 #9#0 = codcon;
 #9#1 = #2#4;
 #9#2 = #2#5;
 #9#3 = #2#1;
 #9#4 = #2#8;
 #9#6 = #2#0;
 |LEE 101#9=;
 |SI FSalida ! 0;
     |DDEFECTO #9;
     #9#0 = codcon;
     #9#1 = #2#4;
     #9#2 = #2#5;
     #9#3 = #2#1;
     #9#4 = #2#8;
     #9#6 = #2#0;
     |GRABA 101#9b;
 |FINSI;
 #9#5 = #9#5 + #2#9;
 |GRABA 101#9a;
 |LIBERA #9;
 sw = 1;
|FPRC;

|PROCESO cabecera; || lee la cabecera.
|DDEFECTO #1;
  #1#0 = diario;
  #1#1 = fecha;
  #1#2 = docume;
  #1#3 = asient;
  linea = -9;
  iv1 = 0;  iv2 = 0;  iv3 = 0;  iv4 = 0;  iv5 = 0;
  re1 = 0;  re2 = 0;  re3 = 0;  re4 = 0;  re5 = 0;
  |GRABA 020#1n;
  |SI FSalida ! 0;
      #2#0 = #1#0;
      #2#1 = #1#1;
      #2#2 = #1#2;
      #2#3 = 9999;
      |LEE 040#2];
      |SI FSalida = 0;
          |LEE 040#2a;
          |SI #2#0 = #1#0; |Y #2#1 = #1#1; |Y #2#2 = #1#2;
              linea = #2#3;
          |FINSI;
      |SINO;
          |LEE 040#2u;
          |SI FSalida = 0; |Y  #2#0 = #1#0; |Y #2#1 = #1#1; |Y #2#2 = #1#2;
              linea = #2#3;
          |FINSI;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO act_cabecera;
  #1#0 = diario;
  #1#1 = fecha;
  #1#2 = docume;
  |LEE 101#1=;
  |SI #2#8 = "D";
       #1#4 = #1#4 + #2#9;
       |SI #1#09 = 0; #1#08 = #2#4; #1#09 = #2#5; |FINSI;  || contrp.HABER
  |SINO;
       #1#5 = #1#5 + #2#9;
       |SI #1#11 = 0; #1#10 = #2#4; #1#11 = #2#5; |FINSI;  || contrp.DEBE
  |FINSI;
  #1#6 = #1#4 - #1#5;        || saldo
  |GRABA 020#1a;
  |LIBERA #1;
|FPRC;

|PROCESO acumulador;
    sw_ac = 0;
    ac = 0;
|SI iv1 = #8#4;|Y re1 = #8#5; ac = 1; sw_ac = 1; |FINSI;
|SI iv2 = #8#4;|Y re2 = #8#5; ac = 2; sw_ac = 1; |FINSI;
|SI iv3 = #8#4;|Y re3 = #8#5; ac = 3; sw_ac = 1; |FINSI;
|SI iv4 = #8#4;|Y re4 = #8#5; ac = 4; sw_ac = 1; |FINSI;
|SI iv5 = #8#4;|Y re5 = #8#5; ac = 5; sw_ac = 1; |FINSI;

|SI sw_ac = 0;|Y iv1 = 0;|Y re1 = 0;
        iv1 = #8#4;  re1 = #8#5;  sw_ac = 1; ac = 1;
|FINSI;
|SI sw_ac = 0;|Y iv2 = 0;|Y re2 = 0;
        iv2 = #8#4;  re2 = #8#5;  sw_ac = 1; ac = 2;
|FINSI;
|SI sw_ac = 0;|Y iv3 = 0;|Y re3 = 0;
        iv3 = #8#4;  re3 = #8#5;  sw_ac = 1; ac = 3;
|FINSI;
|SI sw_ac = 0;|Y iv4 = 0;|Y re4 = 0;
        iv4 = #8#4;  re4 = #8#5;  sw_ac = 1; ac = 4;
|FINSI;
|SI sw_ac = 0;|Y iv5 = 0;|Y re5 = 0;
        iv5 = #8#4;  re5 = #8#5;  sw_ac = 1; ac = 5;
|FINSI;
|SI ac = 0;    ac = 6;   |FINSI;
|FPRC;

|PROCESO adapta;
|SI #2#8 = "D";
        #2#16 = #2#4;
        #2#17 = #2#5;
        #2#10 = "";
        #2#11 = 0;
|SINO;
        #2#16 = "";
        #2#17 = 0;
        #2#10 = #2#4;
        #2#11 = #2#5;
|FINSI;
|FPRC;

|PROCESO a_actualiza;                || rutina 'a_cuentas'
  ini = dig1;
  fecalf = #2#1;
  mes = fecalf % 402;
  mesfec = mes;
  |SI ini = 1;
      mesac = mesfec;
  |SINO;
      mesac = (mesfec - ini) + 1;
      |SI mesac [ 0;
          mesac = (13 - ini) + mesfec;
      |FINSI;
  |FINSI;
  a = (mesac * 3) + 9;
  b = a + 1;
  c = a + 2;
  |SI #2#8 = "D";
      #5a = #5a + #2#9;
      #5#51 = #5#51 + #2#9;
  |SINO;
      #5b = #5b + #2#9;
      #5#52 = #5#52 + #2#9;
  |FINSI;
  #5c = #5a - #5b;
  #5#53 = #5#51 - #5#52;
|FPRC;

|PROCESO a_cuenta;
 |ABRE #5;
 #5#0 = #2#4;
 #5#1 = #2#5;
 |LEE 101#5=;
 |SI FSalida = 0;
     |SI #2#0 = 0;
         |SI #2#8 = "D";
             #5#9  = #5#9  + #2#9;        || diario cero (saldos iniciales)
             #5#51 = #5#51 + #2#9;
         |SINO;
             #5#10 = #5#10 + #2#9;
             #5#52 = #5#52 + #2#9;
         |FINSI;
         #5#11 = #5#9 - #5#10;
         #5#53 = #5#51 - #5#52;
     |SINO;
         |SI #2#0 = 99;
             |SI #2#8 = "D";
                 #5#48 = #5#48 + #2#9;       || diario 99 (saldos finales)
                 #5#51 = #5#51 + #2#9;
             |SINO;
                 #5#49 = #5#49 + #2#9;
                 #5#52 = #5#52 + #2#9;
             |FINSI;
             #5#50 = #5#48 - #5#49;
             #5#53 = #5#51 - #5#52;
         |SINO;
             |HAZ a_actualiza;           || saldos del mes correspondiente
         |FINSI;
     |FINSI;
     |GRABA 020#5a;
     |LIBERA #5;
 |FINSI;
 |CIERRA #5;
|FPRC;

|PROCESO a_diario;
|ABRE #10;
    #10#0 = #2#0;
|LEE 101#10=;
|SI FSalida ! 0;              || actualiza el diario
    |DDEFECTO #10;
        #10#0 = #2#0;
        #10#1 = "<DIARIO SIN DEFINIR>";
    |GRABA 020#10b;
|FINSI;
|SI #2#8 = "D";  #10#2 = #10#2 + #2#9;  |FINSI;
|SI #2#8 = "H";  #10#3 = #10#3 + #2#9;  |FINSI;
|GRABA 020#10a;
|LIBERA #10;
|CIERRA #10;
|FPRC;

|| ..... AUXILIARES
|PROCESO sumanume;
  nume1 = num + 1;
  nume2 = nume1 + 30; || concepto Base
  nume3 = nume1 + 60; || % IVA
  nume4 = nume1 +  5; || Cta IVA
  nume5 = nume1 + 35; || Concepto IVA
  nume6 = nume1 + 65; || % Recargo
  nume7 = nume1 + 10; || Cta Recargo
  nume8 = nume1 + 40; || Concepto Recargo

  num21 = num + 3;
  num22 = num21 + 15; || % IVA
  num23 = num21 +  5; || Cuota IVA
  num24 = num21 + 20; || % Recargo
  num25 = num21 + 10; || Cuota Recargo
|FPRC;

|PROCESO aviso5;
 |PUSHV 09101171;
 |HAZ color_f;
 |CUADRO 09 10 11 71;
 |HAZ color_c;
 |QBF avisos;
      alfa1 = avisos % 0;  nume1 = alfa1;
      nume2 = ((60 - nume1) / 2) ! 0;     nume1 = 60 - nume1 - nume2;
      avisos = (" " * nume1) + avisos + (" " * nume2);        || lo centra
  |PINTA 1011, avisos;
  |AVISO;
  |ATRI 0;

|MENU opcion;
    sw_che = FSalida;
    |SI sw_che < 1; |O sw_che > 3;
        sw_che = 1;
    |FINSI;
    |POPV;

|FPRC;

|PROCESO color_c;        || activa el color caracter en avisos
|COLOR 14, 0;
|ATRI 0;
|FPRC;

|PROCESO color_f;        || activa el color graficos en avisos
|COLOR 4, 0;
|ATRI 0;
|FPRC;

|PROCESO errorgordo;
   |AVISO;
   |CUADRO 1007 1373;
   |ATRI R;
   avisos = "00" + libro;
   avisos = avisos % -102;
   avisos = " ­­­ ERROR !!!. SE HA LLEGADO AL FINAL DEL LIBRO " + avisos + " DE FACTURAS. ";
   |PINTA 1108, avisos;
   |PINTA 1208, " ! EL PROCESO NO PUEDE CONTINUAR.!  VERIFIQUE SUS DATOS ........ ";
   |ATRI 0;
   |PAUSA;
   sw_ERROR = 1;
|FPRC;
