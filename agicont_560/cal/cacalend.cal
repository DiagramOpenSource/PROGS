|FICHEROS;
  cacalend #0;
  calendar #1;
|FIN;

|VARIABLES;
 pepe = 0;
 camp = 0;
 conta = 0;
 i = 0;
    procesa = "     Estoy procesando espere un poco Por Favor";
    modifi = "2330S  Modificar el Calendario S/N : ";
    alta = "2330S     Dar el alta al Calendario S/N : ";
    errorfec1 = "     Fecha erronea DD/MM";
    errorfec2 = "     Fecha Hasta menor que la Fecha Desde";
    errorfec3 = "     No existe ese dia el a¤o no es bisiesto";
    varalfa = "";
    varalfa1 = "";
    varalfa2  = "";
    vardia = 0;
    varmes = 0;
    fechadesde = "";
    fechadesde1 = "";
    fechadesde2 = "";
    fechahasta = "";
    fechahasta1 = "";
    fechahasta2 = "";
    anu5 = "8917";
    anu6 = "9011";
    anu7 = "9112";
    anu8 = "9203";
    anu9 = "9315";
    anu10 = "9416";
    anu11 = "9517";
    anu12 = "9601";
    anu13 = "9713";
    anu14 = "9814";
    anu15 = "9915";
    diapri = "";
    diapri1 = 0;
    mesdes = 0;
    meshast = 0;
    mesdes1 = "";
    meshast1 = "";
    diades = 0;
    diahast = 0;
    diades1 = "";
    diahast1 = "";
    bisiesto = "";
    swbis = 1;
    anyo = "";
    dd = 0;
    x = 0;
    y = 0;
    alfapeso = "";
    suma = 0;
    var = 0;
    indice = 0;
    swbis1 = 0;
    trab1 = "";
    nume1 = 0;
    nume2 = 0;
    pesofec = "";
    {367}peso=0;
|FIN;

|INCLUYE inicio_i;

|PROCESO inicial;  |TIPO 8;
  |HAZ inicio;
|FPRC;

|PROCESO calanyo;  |TIPO 7;
  nume1  = (FEntrada / 100) ! 0;
  |SI fec1 = "00.00.0000";
      |HAZ inicio;
  |FINSI;
  trab1 = fec1 % 704;
  |SI nume1 ! 1;  nume1 = trab1;  |ACABA;  |FINSI;
  nume1 = trab1;
  #0#1 = nume1;
  |PINTA #0#1;
|FPRC;

|PROCESO  fechbien;  |TIPO 0;        ||Calcula si la fecha es correcta
  varalfa = #0Campo;
  |SI varalfa = "    ";  |ACABA;  |FINSI;
  |SI varalfa = "2902";|Y swbis = 1;
      |MENAV errorfec3;
      |ERROR;
      |ACABA;
  |FINSI;
  varalfa1 = varalfa / 2;
  varalfa2 = varalfa % A302;
  vardia = varalfa1;
  varmes = varalfa2;
  |SI varmes [ 0;|O varmes > 12;
       |MENAV errorfec1;
       |ERROR;
       |ACABA;
  |FINSI;
  |SI varmes = 1;  |O varmes = 3;  |O varmes = 5;  |O varmes = 7;
                   |O varmes = 8;  |O varmes = 10; |O varmes = 12;
      |SI vardia > 31; |O vardia [ 0;
          |MENAV errorfec1;
          |ERROR;
      |FINSI;
  |SINO;
      |SI varmes = 2;
          |SI vardia > 29;  |O vardia [ 0;
              |MENAV errorfec1;
              |ERROR;
          |FINSI;
      |SINO;
          |SI vardia > 30; |O vardia [ 0;
              |MENAV errorfec1;
              |ERROR;
          |FINSI;
      |FINSI;
  |FINSI;
|FPRC;

                    ||Calcula si la fecha desde es mayor a la fecha desde
|PROCESO desdefec;|TIPO 0;
  camp = Campo - 1;
  fechadesde = #0camp;
  fechadesde1 = fechadesde % A302;
  fechadesde2 = fechadesde % A102;
  fechadesde = fechadesde1 + fechadesde2;
  fechahasta = #0Campo;
  fechahasta1 = fechahasta % A302;
  fechahasta2 = fechahasta % A102;
  fechahasta = fechahasta1 + fechahasta2
  |SI fechadesde > fechahasta;
      |MENAV errorfec2;
      |ERROR;
  |FINSI;
|FPRC;


|PROCESO anyo;|TIPO 0;
  |SI nume1 ! #0#1;
      |MENAV "      LA FECHA NO SE CORRESPONDE CON EL EJERCICIO";
      |ERROR;
      |ACABA;
  |FINSI;
  |SI #0#1 = 1989;  anyo = anu5;  |FINSI;
  |SI #0#1 = 1990;  anyo = anu6;  |FINSI;
  |SI #0#1 = 1991;  anyo = anu7;  |FINSI;
  |SI #0#1 = 1992;  anyo = anu8;  |FINSI;
  |SI #0#1 = 1993;  anyo = anu9;  |FINSI;
  |SI #0#1 = 1994;  anyo = anu10; |FINSI;
  |SI #0#1 = 1995;  anyo = anu11; |FINSI;
  |SI #0#1 = 1996;  anyo = anu12; |FINSI;
  |SI #0#1 = 1997;  anyo = anu13; |FINSI;
  |SI #0#1 = 1998;  anyo = anu14; |FINSI;
  |SI #0#1 = 1999;  anyo = anu15; |FINSI;

                          ||Calcular si es o no anyo bisiesto;
  swbis = 0;
  bisiesto = anyo % A301;
  |SI bisiesto = 1;  swbis = 1;  |FINSI;
|FPRC;



|PROCESO peso;|TIPO 3;
  pepe = (FEntrada / 100) ! 0;
  |SI pepe ! 1;  |Y pepe ! 2;
      |ACABA;
  |FINSI;
  |SI pepe = 1;
      |CONFI alta;
  |SINO;
      |CONFI modifi;
  |FINSI;
  |SI FSalida ! 0;
      |BLIN 23;
      |ACABA;
  |FINSI;
  |BLIN 23;
  |ABRE #1;
  |HAZ peso1;
  |BLIN 23;
  |GRABA 020#1a;
  |LIBERA #1;
  |CIERRA #1;
|FPRC;



|PROCESO peso1;
  |PINTA 2330,procesa;
  #1#0 = #0#0;
  |LEE 110#1=;
  |SI FSalida ! 0;
      |DDEFECTO #1;
      #1#0 = #0#0;
      #1#13 = #0#1;
      |GRABA 020#1c;
  |FINSI;
  diapri = anyo % A401;
  diapri1 = diapri;
  nume2 = diapri1 + 1;
  |PARA dd = 0;  |SI dd [ 6;  |HACIENDO dd = dd + 1;
        indice = dd;
        |HAZ undia;
        nume2 = nume2 + 1;
        |SI nume2 = 9;
            nume2 = 2;
        |FINSI;
  |SIGUE;

  Ipeso = Ipeso + 1;
  peso = 0;
  |HAZ fechas;              ||Calculo para cargar pesos de fecha a fecha

                            ||Carga los pesos de enero
  Ipeso = peso1 <-;
  y = 1;
  trab1 = "";
  |PARA x = 1;  |SI x [ 366;  |HACIENDO x = x + 1;
        |SI x = 32;  #1#1 = trab1;  trab1 = "";  |FINSI;
        |SI x = 61;  #1#2 = trab1;  trab1 = "";  |FINSI;
        |SI x = 92;  #1#3 = trab1;  trab1 = "";  |FINSI;
        |SI x = 122; #1#4 = trab1;  trab1 = "";  |FINSI;
        |SI x = 153; #1#5 = trab1;  trab1 = "";  |FINSI;
        |SI x = 183; #1#6 = trab1;  trab1 = "";  |FINSI;
        |SI x = 214; #1#7 = trab1;  trab1 = "";  |FINSI;
        |SI x = 245; #1#8 = trab1;  trab1 = "";  |FINSI;
        |SI x = 275; #1#9 = trab1;  trab1 = "";  |FINSI;
        |SI x = 306; #1#10= trab1;  trab1 = "";  |FINSI;
        |SI x = 336; #1#11= trab1;  trab1 = "";  |FINSI;
        alfapeso = peso;
        |QBF alfapeso;
        trab1 = trab1 + alfapeso;
        Ipeso = Ipeso + 1;
  |SIGUE;
  #1#12 = trab1;
|FPRC;


|PROCESO undia;           ||Introducir los pesos de un dia;
  swbis1 = 0;
  Ipeso = peso1 <-;
  Ipeso = Ipeso + dd;
  |PARA conta = 0;  |SI conta [ 366;  |HACIENDO conta = conta + 7;
        |SI indice = 59;|Y swbis = 1;
            peso = 0;
            Ipeso = Ipeso + 1;
            indice = indice + 1;
            swbis1 = 1;
        |FINSI;
        |SI indice > 59;|Y swbis = 1;|Y swbis1 = 0;
            Ipeso = Ipeso + 1;
            indice = indice + 1;
            swbis1 = 1;
        |FINSI;
        peso = #0nume2;
        Ipeso = Ipeso + 7;
        indice = indice + 7;
  |SIGUE;
|FPRC;




|PROCESO fechas;         ||Carga desde fecha a fecha y de dia a dia
  Ipeso = peso1 <-;
                            ||   Introduce pesos de fechas y dias
  |PARA x = 9;  |SI x [ 96;  |HACIENDO x = x + 3;
        |SI #0x ! "    ";
            diades1 = #0x % A102;
            y = x + 1;
            diahast1 = #0y % A102;
            diades = diades1;           ||Controla el dia del desde
            diahast = diahast1;         ||Controla el dia del hasta
            mesdes1 = #0x % A302;
            meshast1 = #0y % A302;
            y = y + 1;
            pesofec = #0y;
            |HAZ otrobucle;
        |FINSI;
  |SIGUE;
  |PARA x = 99; |SI x [ 152; |HACIENDO x = x + 2;
        |SI #0x ! "    ";
            diades1 = #0x % A102;
            diahast1 = diades1;
            diades = diades1;
            diahast = diahast1;
            mesdes1 = #0x % A302
            meshast1 = mesdes1;
            y = x + 1;
            pesofec = #0y;
            |HAZ otrobucle;
        |FINSI;
  |SIGUE;
|FPRC;

|PROCESO otrobucle;
  |SI mesdes1  = "01";  mesdes = 0;    |FINSI;
  |SI mesdes1  = "02";  mesdes = 31;   |FINSI;
  |SI mesdes1  = "03";  mesdes = 60;   |FINSI;
  |SI mesdes1  = "04";  mesdes = 91;   |FINSI;
  |SI mesdes1  = "05";  mesdes = 121;  |FINSI;
  |SI mesdes1  = "06";  mesdes = 152;  |FINSI;
  |SI mesdes1  = "07";  mesdes = 182;  |FINSI;
  |SI mesdes1  = "08";  mesdes = 213;  |FINSI;
  |SI mesdes1  = "09";  mesdes = 244;  |FINSI;
  |SI mesdes1  = "10";  mesdes = 274;  |FINSI;
  |SI mesdes1  = "11";  mesdes = 305;  |FINSI;
  |SI mesdes1  = "12";  mesdes = 335;  |FINSI;
  |SI meshast1 = "01";  meshast = 0;   |FINSI;
  |SI meshast1 = "02";  meshast = 31;  |FINSI;
  |SI meshast1 = "03";  meshast = 60;  |FINSI;
  |SI meshast1 = "04";  meshast = 91;  |FINSI;
  |SI meshast1 = "05";  meshast = 121; |FINSI;
  |SI meshast1 = "06";  meshast = 152; |FINSI;
  |SI meshast1 = "07";  meshast = 182; |FINSI;
  |SI meshast1 = "08";  meshast = 213; |FINSI;
  |SI meshast1 = "09";  meshast = 244; |FINSI;
  |SI meshast1 = "10";  meshast = 274; |FINSI;
  |SI meshast1 = "11";  meshast = 305; |FINSI;
  |SI meshast1 = "12";  meshast = 335; |FINSI;
                         || Introduce los pesos de las fechas y dias
  suma = (meshast + diahast) - (mesdes + diades);
  conta = 0;
  Ipeso = peso1 <-;
  indice = 1;
  indice = indice + mesdes + diades;
  Ipeso = Ipeso + mesdes + diades;
  Ipeso = Ipeso - 1;
  indice = indice - 1;
  |PARA conta = 0;  |SI conta [ suma;  |HACIENDO conta = conta + 1;
        |SI pesofec = "+";|O pesofec = "-";
            |HAZ signo;
        |SINO;
            |SI indice = 60;|Y swbis = 1;
                Ipeso = Ipeso + 1;
                indice = indice + 1;
                conta = conta + 1;
            |FINSI;
            peso = pesofec;
        |FINSI;
        Ipeso = Ipeso + 1;
        indice = indice + 1;
  |SIGUE;
|FPRC;


|PROCESO signo;
   |SI peso = 0;  |ACABA;  |FINSI;
   |SI pesofec = "+";
       peso = peso + 1;
       |SI peso > 9;  peso = 9;  |FINSI;
   |SINO;
       |SI peso = 1;  |ACABA;  |FINSI;
       peso = peso - 1;
       |SI peso < 0;  peso = 0;  |FINSI;
   |FINSI;
|FPRC;
