|FICHEROS;
    cacuenta #3;
    calibros #10;
|FIN;

|VARIABLES;
    &entrada = 1;
    sw = 0;
    sw_pie = 0;
    contaiva = 0;
    contarec = 0;
    tiva11 = 0;
    sw_punt = 0;
    pepe = 0;
    fecalf = "";
    men1   = "    NO EXISTE EMPRESA";
    mensa1 = "    ERROR ESTA FECHA NO CORRESPONDE AL EJERCICIO";
    traba1 = "";
    x = 0;
    y = 0;
    z = 0;
    p = 0;
    hasta = 0;
    fectra = @;
    fectrac = @;
    blanco = "  ";
    ultimo = "zz";
    &regis = 0;
    &varalf = "";
    &total1 = 0;
    &total2 = 0;
    &total3 = 0;
    &total4 = 0;
    &total5 = 0;
    sw_total = 0;
    &tb = 0;
    &ti = 0;
    &tr = 0;
    &tt = 0;
    &td = 0;
    &te = 0;
    &descri0 = "";
    &descri1 = "";
    &descri2 = "";
    &varnum1 = 0;
    &varnum2 = 0;
    &varnum3 = 0;
    &tiva1 = 0;
    &tiva3 = 0;
    &trec1 = 0;
    &trec3 = 0;
    &ttotal1 = 0;
    &ttotal3 = 0;
    &swlin = 0;
    &hoja = 0;
    &fecha_i = @;

    &basenod = 0;
    &cuotnod = 0;
    zz = 0;
    prim = 0;

    {10}iva = 0;
    {10}baseiva = 0;
    {10}cuotiva = 0;
    {10}rec = 0;
    {10}baserec = 0;
    {10}cuotrec = 0;

    runnom = "";
    sw_con = 0;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
|FIN;

|PROCESO mayus; |TIPO 0;
    #0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|PROCESO no_entres; |TIPO 0;
    alfa1 = #0#11;
|CAMPO_MODIFICA #0#12, 1, alfa1;
|CAMPO_MODIFICA #0#13, 1, alfa1;
|CAMPO_MODIFICA #0#14, 1, alfa1;
|CAMPO_MODIFICA #0#15, 1, alfa1;
|CAMPO_MODIFICA #0#16, 1, alfa1;
|CAMPO_MODIFICA #0#17, 1, alfa1;
|CAMPO_MODIFICA #0#18, 1, alfa1;
|CAMPO_MODIFICA #0#19, 1, alfa1;
|CAMPO_MODIFICA #0#20, 1, alfa1;
|CAMPO_MODIFICA #0#21, 1, alfa1;
|CAMPO_MODIFICA #0#22, 1, alfa1;
|CAMPO_MODIFICA #0#23, 1, alfa1;
|CAMPO_MODIFICA #0#24, 1, alfa1;
|CAMPO_MODIFICA #0#25, 1, alfa1;
|CAMPO_MODIFICA #0#26, 1, alfa1;
|CAMPO_MODIFICA #0#27, 1, alfa1;
|CAMPO_MODIFICA #0#28, 1, alfa1;
|CAMPO_MODIFICA #0#29, 1, alfa1;
|CAMPO_MODIFICA #0#30, 1, alfa1;
|CAMPO_MODIFICA #0#31, 1, alfa1;
|CAMPO_MODIFICA #0#32, 1, alfa1;
|CAMPO_MODIFICA #0#33, 1, alfa1;
|CAMPO_MODIFICA #0#34, 1, alfa1;
|CAMPO_MODIFICA #0#35, 1, alfa1;
|FPRC;

|PROCESO contador;
|SI #0#7 = 0;
        regis = #1#2;
|SINO;
        regis = regis + 1;
|FINSI;
|FPRC;

|PROCESO conceptos;
    sw_con = 0;
|SI #0#11 = "S";
        sw_con = 1;
    |PARA para1 = 12; |SI para1 [ 35; |HACIENDO para1 = para1 + 1;
        |SI #0para1 ! 0;|Y #0para1 = #1#6;
                sw_con = 0;
        |FINSI;
    |SIGUE;
|FINSI;
|FPRC;

|PROCESO anterior;
|HAZ conceptos;
|SI sw_con = 1;     |ACABA;   |FINSI;

|HAZ puntero2;
|HAZ contador;
|FPRC;

|PROCESO imprimir;
|HAZ conceptos;
|SI sw_con = 1;     |ACABA;   |FINSI;

|SI #0#10 = 1; fecha_i = #1#3; |SINO; fecha_i = #1#46; |FINSI;
|SI sw = 0;
        varalf = #10#1;
    |QBF varalf;
        varalf = " LIBRO DE " + varalf;
        sw = 1;
|FINSI;
    sw_pie = 1;
|HAZ leecuen;

    total1 = 0;  total2 = 0;  total3 = 0;  total4 = 0;  total5 = 0;
    sw_total = 0;

|SI #1#53 ! 0;                  total5 = #1#26;  sw_total = 1; |FINSI;
|SI #1#52 ! 0;|Y sw_total = 0;  total4 = #1#26;  sw_total = 1; |FINSI;
|SI #1#10 ! 0;|Y sw_total = 0;  total3 = #1#26;  sw_total = 1; |FINSI;
|SI #1#09 ! 0;|Y sw_total = 0;  total2 = #1#26;  sw_total = 1; |FINSI;
|SI #1#08 ! 0;|Y sw_total = 0;  total1 = #1#26;                |FINSI;

|HAZ contador;
|PRINT;
|HAZ puntero1;
|HAZ puntero2;
|FPRC;

|PROCESO impre2;
|MODULO runnom;
|INFOR informe2;
    Iiva = iva1 <-;
    Ibaseiva = baseiva1 <-;
    Icuotiva = cuotiva1 <-;
    tiva1 = 0;
    tiva11 = 0;
    tiva3 = 0;
    prim = 0;
|PARA x = 1; |SI x [ contaiva; |HACIENDO x = x + 1;
        varnum1 = baseiva;
        varnum2 = iva;
        varnum3 = cuotiva;
        tiva1 = tiva1 + varnum1;
        tiva11 = tiva11 + varnum1;
        tiva3 = tiva3 + varnum3;
    |SI prim = 0;
        |SI runnom = "cay4ivac";  descri0 = "SOPORTADO  ";  |FINSI;
        |SI runnom = "cay4ivav";  descri0 = "REPERCUTIDO";  |FINSI;
            descri1 = "I.V.A.";
            descri2 = "======";
            swlin = 1;
        |PRINT;
            prim = 1;
    |FINSI;
        swlin = 2;
    |PRINT;
        Ibaseiva = Ibaseiva + 1;
        Icuotiva = Icuotiva + 1;
        Iiva = Iiva + 1;
|SIGUE;
    tiva1 = tiva1 + basenod;
    tiva3 = tiva3 + cuotnod;
|SI basenod ! 0;|O cuotnod ! 0;    swlin = 4;     |PRINT;   |FINSI;
|SI contaiva ! 0;   swlin = 3;     |PRINT;   |FINSI;
    ttotal3 = ttotal3 + tiva3;

  || --------------------------------------------------------
    Irec = rec1 <-;                        || Imprime resume recargo
    Ibaserec = baserec1 <-;
    Icuotrec = cuotrec1 <-;
    tiva1 = 0;
    tiva3 = 0;
    prim = 0;
|PARA x = 1; |SI x [ contarec; |HACIENDO x = x + 1;
        varnum1 = baserec;
        varnum2 = rec;
        varnum3 = cuotrec;
        tiva1 = tiva1 + varnum1;
        tiva3 = tiva3 + varnum3;
    |SI prim = 0;
            descri1 = "RECARGO DE EQUIVALENCIA";
            descri2 = "=======================";
            swlin = 1;
        |PRINT;
            prim = 1;
    |FINSI;
        swlin = 2;
    |PRINT;
        Ibaserec = Ibaserec + 1;
        Icuotrec = Icuotrec + 1;
        Irec = Irec + 1;
|SIGUE;
|SI contarec ! 0;   swlin = 3;     |PRINT;   |FINSI;
    ttotal1 = tiva11 + basenod;
    ttotal3 = ttotal3 + tiva3;
|PIEINF;
|FININF;
|FPRC;

|PROCESO puntero1;   || Carga el iva
|PARA x =  8; |SI x [ 10; |HACIENDO x = x + 1;
        y = x + 3;
        z = y + 3;
    |SI #1#23 = "N";
            basenod = basenod + #1x;
            cuotnod = cuotnod + #1z;
    |SINO;
        |SI #1x ! 0;
            |HAZ carga_iva;
        |FINSI;
    |FINSI;
|SIGUE;
|PARA x = 52; |SI x [ 53; |HACIENDO x = x + 1;
        y = x + 2;
        z = y + 2;
    |SI #1#23 = "N";
            basenod = basenod + #1x;
            cuotnod = cuotnod + #1z;
    |SINO;
        |SI #1x ! 0;
            |HAZ carga_iva;
        |FINSI;
    |FINSI;
|SIGUE;

|PARA x =  8; |SI x [ 10; |HACIENDO x = x + 1;   || Carga el recargo
       y = x + 9;
       z = y + 3;
   |SI #1#23 = "N";
           basenod = basenod + #1z;
   |SINO;
       |SI #1x ! 0; |Y #1y ! 0;
           |HAZ carga_rec;
       |FINSI;
   |FINSI;
|SIGUE;
|PARA x =  52; |SI x [ 53; |HACIENDO x = x + 1;   || Carga el recargo
       y = x + 6;
       z = y + 2;
   |SI #1#23 = "N";
           basenod = basenod + #1z;
   |SINO;
       |SI #1x ! 0; |Y #1y ! 0;
           |HAZ carga_rec;
       |FINSI;
   |FINSI;
|SIGUE;
|FPRC;

|PROCESO carga_iva;
|SI #1x ! 0;
        Iiva = iva1 <-;
        Ibaseiva = baseiva1 <-;
        Icuotiva = cuotiva1 <-;

    |SI contaiva = 0;
            baseiva = baseiva + #1x;
            iva = #1y;
            cuotiva = cuotiva + #1z;
            contaiva = contaiva + 1;
            sw_punt = 0;
    |SINO;
            sw_punt = 1;
        |PARA pepe = 1; |SI pepe [ contaiva; |HACIENDO pepe = pepe + 1;
            |SI iva = #1y;
                |SI sw_punt = 1;
                        baseiva = baseiva + #1x;
                        cuotiva = cuotiva + #1z;
                        sw_punt = 0;
                |FINSI;
            |SINO;
                    Ibaseiva = Ibaseiva + 1;
                    Icuotiva = Icuotiva + 1;
                    Iiva = Iiva + 1;
            |FINSI;
        |SIGUE;

        |SI sw_punt = 1;
                baseiva = baseiva + #1x;
                cuotiva = cuotiva + #1z;
                iva = #1y;
                contaiva = contaiva + 1;
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO carga_rec;
|SI #1x ! 0;
        Irec = rec1 <-;
        Ibaserec = baserec1 <-;
        Icuotrec = cuotrec1 <-;

    |SI contarec = 0;
            baserec = baserec + #1x;
            rec = #1y;
            cuotrec = cuotrec + #1z;
            contarec = contarec + 1;
            sw_punt = 0;
    |SINO;
            sw_punt = 1;
        |PARA pepe = 1; |SI pepe [ contarec; |HACIENDO pepe = pepe + 1;
            |SI rec = #1y;
                |SI sw_punt = 1;
                        baserec = baserec + #1x;
                        cuotrec = cuotrec + #1z;
                        sw_punt = 0;
                |FINSI;
            |SINO;
                    Ibaserec = Ibaserec + 1;
                    Icuotrec = Icuotrec + 1;
                    Irec = Irec + 1;
            |FINSI;
        |SIGUE;
        |SI sw_punt = 1;
                baserec = baserec + #1x;
                cuotrec = cuotrec + #1z;
                rec = #1y;
                contarec = contarec + 1;
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO puntero2;        ||SUMA anteriores;
|MODULO runnom;
|PARA x =  8; |SI x [ 10; |HACIENDO x = x + 1;
        y = x + 6;
        z = y + 6;
        p = x + 3;
    |SI runnom = "cay4ivav";
        |SI #1p ! 0;
                tb = tb + #1x;
        |SINO;
                te = te + #1x;          || base exenta (repercutido)
        |FINSI;
    |SINO;
            tb = tb + #1x;
    |FINSI;
    |SI runnom = "cay4ivac";
        |SI #1#23 = "S";
                ti = ti + #1y;
        |SINO;
                td = td + #1y;          || no deducible (soportado)
        |FINSI;
    |SINO;
            ti = ti + #1y;
    |FINSI;
        tr = tr + #1z;
|SIGUE;
|PARA x = 52; |SI x [ 53; |HACIENDO x = x + 1;
        y = x + 4;
        z = y + 4;
        p = x + 2;
    |SI runnom = "cay4ivav";
        |SI #1p ! 0;
                tb = tb + #1x;
        |SINO;
                te = te + #1x;          || base exenta (repercutido)
        |FINSI;
    |SINO;
            tb = tb + #1x;
    |FINSI;
    |SI runnom = "cay4ivac";
        |SI #1#23 = "S";
                ti = ti + #1y;
        |SINO;
                td = td + #1y;
        |FINSI;
    |SINO;
            ti = ti + #1y;
    |FINSI;
        tr = tr + #1z;
|SIGUE;
    tt = tt + #1#26;
|FPRC;

|PROCESO leecuen;
    #3#0 = #1#4;
    #3#1 = #1#5;
|LEE 001#3=;
|SI FSalida ! 0;
    |DDEFECTO #3;
|FINSI;
|FPRC;

|PROCESO borrapunt;
    basenod = 0;
    cuotnod = 0;
    Iiva = iva1 <-;
    Ibaseiva = baseiva1 <-;
    Icuotiva = cuotiva1 <-;
    Irec = rec1 <-;
    Ibaserec = baserec1 <-;
    Icuotrec = cuotrec1 <-;
|PARA x = 1; |SI x [ 10; |HACIENDO x = x + 1;
        iva = 0;
        baseiva = 0;
        cuotiva = 0;
        rec = 0;
        baserec = 0;
        cuotrec = 0;
        Ibaseiva = Ibaseiva + 1;
        Icuotiva = Icuotiva + 1;
        Iiva = Iiva + 1;
        Ibaserec = Ibaserec + 1;
        Icuotrec = Icuotrec + 1;
        Irec = Irec + 1;
|SIGUE;
|FPRC;
