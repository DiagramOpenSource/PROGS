|FICHEROS;
     caems347 #0;
     camac347 #1;
     camal347 #2;
     camic347 #3;
     camil347 #4;
     caportad #7;
     catrasop #104;
     cabucem1 #105;
|FIN;

|VARIABLES;
     &eFecha       = "";
     &eNif         = "";
     &eTelefono    = "";
     &eNombre      = "";
     &eCalle       = "";
     &eNumero      = "";
     &eMunicipio   = "";
     &eProvincia   = "";
     &eCodPostal   = "";
     &eNumDecl     = "";
     &eTotalPers   = 0;
     &eTotalOper   = 0;
     &eTotalInm    = 0;
     &eTotalArrend = 0;
     &eTDeclar     = 0;
     &eTDeclardos  = 0;
     &eNumDeclP    = "";
     &eFirmado     = "";
     &eEmpleo      = "";
     &eAnyo        = "";
     &ePres        = "";
     &eCompl       = "";
     &eSust        = "";

     Handle1    = 0;
     Vacio20    = "                    ";
     Vacio40    = "                                        ";
     Vacio45    = "                                             ";
     Salir      = 0;
     Opcion     = 0;
     nLongitud  = 0;
     TDeclarantes = 0;
     TDeclarados  = 0;
     TInmuebles   = 0;
     TotalA = 0; TotalB = 0; TotalC = 0; TotalD = 0;
     TotalE = 0; TInm = 0; nEmpresa = 0; nTecla = 0;
     TLinea     = 0; Cambio = 0; Redond = 0;
     SwError    = 0;
     Calc       = 0;
     nEspa      = 0;
     nLong      = 0;
     nPos       = 0;
     Comodin    = "";
     Comodin1   = "";
     aCadena    = "";
     Cadena1    = "";
     aLong      = "";
     aCaracter  = "";
     nTOperacion = 0;

     VAlfa      = "";
     VAlfa1     = "";
     VAlfa2     = "";
     VAlfa3     = "";
     VAlfa4     = "";

     aTecla     = "";
     Letras     = "";
     Compl      = "";
     Refer      = "";

     Campos     = "";
     Campos1    = "";
     Campos2    = "";
     Campos3    = "";
     Campos4    = "";
     Campos5    = "";
     Campos6    = "";
     Campos7    = "";
     Campos8    = "";
     Campos9    = "";
     Campos10   = "";
     Campos11   = "";
     Campos12   = "";
     Campos13   = "";
     Campos14   = "";
     Campos15   = "";
     Campos16   = "";
     Campos17   = "";
     Campos18   = "";
     Campos19   = "";

     DClave     = "";
     HClave     = "";
     Clave      = "";
     Contador   = 0;
     ModoModi   = "";
     SwLee      = 0;
     Fichero1   = "";
     FicheroD   = "";
     Path       = "";
     aTipo      = "";

     CampoDni   = "";
     LetrasNif  = "TRWAGMYFPDXBNJZSQVHLCKE";
     Letra1     = "";
     Letra2     = "";
     Letra3     = "";
     Letra4     = "";
     Letra5     = "";
     Letra6     = "";
     Letra7     = "";
     Letra8     = "";
     Caracter   = "";
     Carac1     = 0;
     Carac2     = 0;
     Carac3     = 0;
     Carac4     = 0;
     Carac5     = 0;
     aAlfa = "";
     nSwError = 0;
     nCanal   = 0;

         alfa1    = "";
         alfa2    = "";
         tip1     = 0;
         tip2     = 0;
         empcon   = 0;
         ejecon   = 0;
         leidos   = 0;
         dirfich0 = "";
         xx       = 0;
         yy       = 0;
         x        = 0;
         y        = 0;
         &r_emp   = 0;
         &r_per   = 0;
         sw_inm   = 0;

         EuroAnt   = 0;
         EuroDBAnt = 0;
         EuroDVAnt = 0;

         &cargoem = "";
         &any     = "";
         &dia     = "";
         &mes     = "";
         &anyo    = "";
         &preimp  = "";
         &predis  = "";
         &predi1  = "";
         &predi2  = "";
         &represen = "";
         &fecbo   = "";
         &ttes    = 0;
         &tdos    = 0;


     &THojas    = 0;
     &NHojas    = 0;

{-1} MGeneral   = "";
     MGeneral1  = "1860";
     MGeneral2  = "1";
     MGeneral3  = "4";
     MGeneral4  = "Creacion  Diskette ";
     MGeneral5  = "Etiqueta  Diskette ";
     MGeneral6  = "Grabacion Diskette ";
     MGeneral7  = "Portadas Papel Continuo";

   aDirOri  = "";
   aDirDes  = "";
   aOrigen  = "";
   aDestino = "";
|FIN;

|INCLUYE acceso_i;
|INCLUYE i_laserc;

|| ***********************************************************************
||                       PROCESO CARGA DE DATOS
|| ***********************************************************************

|PROCESO Relleno;
  |SI Campo = 6;
      VAlfa = #0Campo; |QBT VAlfa;
      VAlfa = ("00000" + VAlfa) % -105;
  |FINSI;

  |SI Campo = 10;
      VAlfa = #0Campo; |QBT VAlfa;
      VAlfa = ("000" + VAlfa) % -103;
  |FINSI;

  |SI Campo = 11;
      VAlfa = #0Campo; |QBT VAlfa;
      VAlfa = ("0000000" + VAlfa) % -107;
  |FINSI;

  #0Campo = VAlfa;  |PINTA #0Campo;
|FPRC;

|| -------------------------------------------------------------------------
|PROGRAMA;
  |HAZ QueVersion;
  |HAZ inicio;

  aTipoSec = "347";

  |CLS;
  |CABEZA "Soporte Magn. 347";
  |DDEFECTO #0;
  |PINPA #0#0;
  |ABRE #0;
  |LEE 101#0p;
  |SI FSalida ! 0;
      |GRABA 020#0b;
  |FINSI;
  |PINDA #0#0;
  |ENDATOS #1#0;
  |SI FSalida = 0;
      |GRABA 020#0a;
  |FINSI;
  |LIBERA #0;
  |CIERRA #0;
|FPRO;

|| -----------------------------------------------------------------------

|PROCESO Mayus; |TIPO 0;
  #0Campo = #0Campo > #0Campo;
  |PINTA #0Campo;
|FPRC;

|PROCESO PintaAnyo; |TIPO 7;
  || #0#2 = cod2; |PINTA #0#2;
  |SI cod2 ] 80;
     #0#2 = 1900 + cod2;
  |SINO;
     #0#2 = 2000 + cod2;
  |FINSI;
  |PINTA #0#2;
|FPRC;

|PROCESO Individual; |TIPO 0;

  |SI #caems347#35 = "C";
     ModoModi = "S";
  |SINO;
     ModoModi = "N";
  |FINSI;

  |C_M #0#03, 1, ModoModi;
  |C_M #0#04, 1, ModoModi;
  |C_M #0#05, 1, ModoModi;
  |C_M #0#06, 1, ModoModi;
  |C_M #0#07, 1, ModoModi;
  |C_M #0#08, 1, ModoModi;
  |C_M #0#09, 1, ModoModi;
  |C_M #0#10, 1, ModoModi;
  |C_M #0#11, 1, ModoModi;
  |C_M #0#12, 1, ModoModi;
  |C_M #0#16, 1, ModoModi;
  |C_M #0#17, 1, ModoModi;
  |C_M #0#18, 1, ModoModi;
  |C_M #0#26, 1, ModoModi;
  |C_M #0#27, 1, ModoModi;
  |C_M #0#29, 1, ModoModi;
  |C_M #0#30, 1, ModoModi;
  |C_M #0#31, 1, ModoModi;
|FPRC;

|PROCESO Parrilla;
   |PUSHV 0501 2380;
   |SUB_EJECUTA "cabucemp";
   |POPV;
|FPRC;

|PROCESO PonIgual;
  nTecla = FSalida;
  |SI #0#22 = "L";
      #0#9  = "";    |PINTA #0#9;              || NIF
      #0#3  = "";    |PINTA #0#3;              || Apellidos y Nombre
      #0#4  = "";    |PINTA #0#4;              || SG
      #0#5  = "";    |PINTA #0#5;              || Calle
      #0#6  = "";    |PINTA #0#6;              || Numero
      #0#11 = "";    |PINTA #0#11;             || Telefono
      #0#7  = "";    |PINTA #0#7;              || Municipio
      #0#8  = "";    |PINTA #0#8;              || Provincia
      #0#17 = 0;     |PINTA #0#17;             || Codigo Postal 1
      #0#18 = 0;     |PINTA #0#18;             || Codigo Postal 2
      #0#12 = 0;     |PINTA #0#12;             || Delegacion de Hacienda
      #0#16 = 0;     |PINTA #0#16;             || Administracion de Hacienda
      #0#26 = "";    |PINTA #0#26;             || Delegacion de Hacienda
      #0#27 = "";    |PINTA #0#27;             || Administracion de Hacienda
      #0#29 = "";    |PINTA #0#29;             || Escalera
      #0#30 = "";    |PINTA #0#30;             || Piso
      #0#31 = "";    |PINTA #0#31;             || Puerta
  |FINSI;

  |SI #0#22 = "L";  |ACABA;  |FINSI;

  |SI #0#35 = "I";
     || .......... #0#1 = #0#0; |PINTA #0#1;
     |ABRE #1;
     #1#0 = #30#2;
     Comodin = #0#2 % -102; |QBF Comodin;
     #1#1 = Comodin;
     |LEE 040#1=;
     |SI FSalida ! 0;
        |CIERRA #1;
        |MENAV "     No Existe Movimientos en el Modelo 347 con esta Empresa";
        |ERROR;
        |ACABA;
     |FINSI;
     |CIERRA #1;

     |ABRE #7;
     #7#0 = empre;
     Comodin = #0#2 % -102; |QBF Comodin;
     #7#1 = Comodin;
     |LEE 040#7=;
     |SI FSalida ! 0;
        |CIERRA #7;
        |MENAV "    No existen datos el PORTADAS MOD. OFICIALES ";
        |ERROR;
        |ACABA;
     |FINSI;
     |CIERRA #7;

     |HAZ representante;
     #0#25 = represen; |PINTA #0#25;             || Fdo.
     CampoDni = #7#13;  |HAZ LetraDni;
     #0#9  = CampoDni; |PINTA #0#9;              || NIF
     #0#3  = #7#2;     |PINTA #0#3;              || Apellidos y Nombre
     #0#4  = #7#3;     |PINTA #0#4;              || SG
     #0#5  = #7#4;     |PINTA #0#5;              || Calle
     #0#6  = #7#5;     |PINTA #0#6;              || Numero
     Comodin1 = #7#14; |QBT Comodin1;
     aLong = Comodin1 % 0; nLong = aLong;
     |SI nLong > 7;
        Comodin  = Comodin1 % -107;
        Comodin1 = Comodin1 - Comodin;
        #0#10 = Comodin1; |PINTA #0#10;          || Prefijo
     |FINSI;
     #0#11 = Comodin;  |PINTA #0#11;             || Telefono
     #0#7  = #7#11;    |PINTA #0#7;              || Municipio
     #0#8  = #7#12;    |PINTA #0#8;              || Provincia
     #0#17 = #7#09;    |PINTA #0#17;             || Codigo Postal 1
     #0#18 = #7#10;    |PINTA #0#18;             || Codigo Postal 2
     #0#12 = #7#16;    |PINTA #0#12;             || Delegacion de Hacienda
     #0#16 = #7#17;    |PINTA #0#16;             || Administracion de Hacienda
     #0#26 = #7#18;    |PINTA #0#26;             || Delegacion
     #0#27 = #7#19;    |PINTA #0#27;             || Administracion
     #0#29 = #7#6;     |PINTA #0#27;             || Escalera
     #0#30 = #7#7;     |PINTA #0#27;             || Piso
     #0#31 = #7#8;     |PINTA #0#27;             || Puerta
  |FINSI;

  |SI #0#35 = "C"; |Y nTecla ! 2; |HAZ Parrilla; |ACABA; |FINSI;
|FPRC;

|PROCESO representante;
 represen = "";
 |SI #7#39 ! Vacio45;
     represen = #7#39;
 |SINO;
     |SI #7#51 ! Vacio20; |O #7#52 ! Vacio20;
         represen = #7#51;
         |QBF represen;
         represen = represen + ", " + #7#52;
     |SINO;
         |SI #7#56 ! Vacio20; |O #7#57 ! Vacio20;
              represen = #7#56;
              |QBF represen;
              represen = represen + ", " + #7#57;
         |SINO;
              |SI #7#61 ! Vacio20; |O #7#62 ! Vacio20;
                  represen = #7#61;
                  |QBF represen;
                  represen = represen + ", " + #7#62;
              |FINSI;
         |FINSI;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO LetraDni;
|QBF CampoDni;
Letra2 = CampoDni;
|QBT Letra2;

    Caracter = Letra2 % 101;
|SI Caracter!"A";|Y Caracter!"B";|Y Caracter!"C";|Y Caracter!"D";
     |Y Caracter!"E";|Y Caracter!"F";
     |Y Caracter!"G";|Y Caracter!"P";|Y Caracter!"Q";|Y Caracter!"S";|Y Caracter!"X";
        Letra4 = "";
        Letra3 = Letra2 % 0;
        Carac2 = Letra3;
    |PARA Carac5 = 1;  |SI Carac5 [ Carac2;  |HACIENDO Carac5 = Carac5 + 1;
            Carac3 = (Carac5 * 100) + 1;
            Letra3 = Letra2 % Carac3;
        |SI Letra3="0";|O Letra3="1";|O Letra3="2";|O Letra3="3";
                      |O Letra3="4";|O Letra3="5";|O Letra3="6";
                      |O Letra3="7";|O Letra3="8";|O Letra3="9";
                Letra4 = Letra4 + Letra3;
        |FINSI;
    |SIGUE;
        Carac4 = Letra4;
    |SI Carac4 ! 0; |Y Letra4 ! "";
            Carac1 = Carac4 $ 23;
            Carac1 = Carac1 + 1;
            Carac3 = (Carac1 * 100) + 1;
            Letra1 = LetrasNif % Carac3;

            Letra4 = "000000000000" + Letra4;
            Letra7 = Letra4 % -103;
            Letra6 = Letra4 % -403;
            Letra5 = Letra4 % -703;

            Letra8 = Letra5  % 101;
            |SI Letra8 = "0"; Letra5 = Letra5 % 202; |FINSI;

            Letra8 = Letra5  % 101;
            |SI Letra8 = "0"; Letra5 = Letra5 % 201; |FINSI;

            Letra8 = Letra5  % 101;
            |SI Letra8 = "0"; Letra5 = ""; |FINSI;

            |SI Letra5 ! "";
                Letra4 = Letra5 + Letra6 + Letra7 + Letra1;
            |SINO;
                Letra4 = Letra6 + Letra7 + Letra1;
            |FINSI;

            CampoDni = Letra4;
            CampoDni = ("000000000" + CampoDni) % -109;
    |FINSI;
|FINSI;
 CampoDni = (CampoDni + "         ");
 CampoDni = CampoDni % 109;
|FPRC;

|| ***********************************************************************
||                       IMPRESION DE LA PORTADA
|| ***********************************************************************

|PROCESO FechaP;
  VAlfa2 = #0#15 % 102;
  VAlfa3 = #0#15 % 402;
  VAlfa4 = #0#15 % 704;

  |SI VAlfa3 = "01";  VAlfa3 = "Enero     ";  |FINSI;
  |SI VAlfa3 = "02";  VAlfa3 = "Febrero   ";  |FINSI;
  |SI VAlfa3 = "03";  VAlfa3 = "Marzo     ";  |FINSI;
  |SI VAlfa3 = "04";  VAlfa3 = "Abril     ";  |FINSI;
  |SI VAlfa3 = "05";  VAlfa3 = "Mayo      ";  |FINSI;
  |SI VAlfa3 = "06";  VAlfa3 = "Junio     ";  |FINSI;
  |SI VAlfa3 = "07";  VAlfa3 = "Julio     ";  |FINSI;
  |SI VAlfa3 = "08";  VAlfa3 = "Agosto    ";  |FINSI;
  |SI VAlfa3 = "09";  VAlfa3 = "Septiembre";  |FINSI;
  |SI VAlfa3 = "10";  VAlfa3 = "Octubre   ";  |FINSI;
  |SI VAlfa3 = "11";  VAlfa3 = "Noviembre ";  |FINSI;
  |SI VAlfa3 = "12";  VAlfa3 = "Diciembre ";  |FINSI;

  eFecha = VAlfa2 + " de " + VAlfa3 + " de " + VAlfa4;
|FPRC;

|PROCESO CuentaInm;
  eTotalInm    = eTotalInm + 1;
  eTotalArrend = eTotalArrend + #camil347#4;
|FPRC;

|DEFBUCLE CuentaInm;
#camil347#1;
;
#cabucem1#0,001;
#cabucem1#0,999;
;
NULL,CuentaInm;
|FIN;

|PROCESO CuentaDecl;
  eTotalPers  = eTotalPers + 1;
  eTotalOper = eTotalOper + #camal347#5;
|FPRC;

|DEFBUCLE CuentaDecl;
#camal347#1;
;
#cabucem1#0,001;
#cabucem1#0,999;
;
NULL,CuentaDecl;
|FIN;

|PROCESO ImprimePortadas;
   |ABRE #30;
   #30#2 = #cabucem1#0; #30#3 = #cabucem1#1;
   |LEE 000#30.=;
   |SI FSalida = 0;
      |DBASE Comodin; |QBF Comodin;
      Comodin = Comodin + "fich/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
      |PATH_DAT #7 Comodin;
      |PATH_DAT #1 Comodin; |PATH_DAT #2 Comodin;
      |PATH_DAT #3 Comodin; |PATH_DAT #4 Comodin;

      |DBASE fich_alta; |QBF fich_alta;
      fich_alta = fich_alta + "fich/" + (("00000" + #30#2) % -105) + #30#3 + "/";
      |HAZ inicio;

      Cambio = 1;
      Redond = 2;
      |SI eaMoneda = "P";  Cambio = 166.386;  |FINSI;

      |ABRE #7;
      #caportad#0 = #cabucem1#0;
      Comodin = #0#2 % -102; |QBF Comodin;
      #caportad#1 = Comodin;
      |LEE 040#caportad.=;
      |SI FSalida = 0;
         eNif       = #caportad#13;
         eTelefono  = #caportad#14;
         eNombre    = #caportad#2;
         eCalle     = #caportad#3 + " " + #caportad#4;
         eNumero    = #caportad#5;
         eMunicipio = #caportad#11;
         eProvincia = #caportad#12;
         eCodPostal = #caportad#10;
         eNumDecl   = "";
         eNumDeclP  = "";
         eTotalInm = 0; eTotalArrend = 0;
         |BUCLE CuentaInm;
         eTDeclar = 1; eTotalOper = 0; eTotalPers = 0;
         |BUCLE CuentaDecl;
         eTDeclar    = 0;
         eTDeclardos = 0;
         eFirmado   = #caems347#25;
         eEmpleo    = #caems347#24;
         eAnyo      = #caems347#2;
         ePres      = 2;
         eCompl     = "";
         eSust      = "";
         |PRINT;
         |PIEINF;
      |FINSI;
      |CIERRA #7;
   |FINSI;
   |CIERRA #30;
|FPRC;

|DEFBUCLE ImprimePortadas;
#cabucem1#1;
;
INICIO;
FINAL;
;
NULL,ImprimePortadas;
|FIN;

|PROCESO LeePortadaP;

  eAnyo   = #0#2;                                    || A¤o Emision
  eEmpleo = #0#24;                                   || Cargo o Empleo
  EuroAnt = EURO; EuroDBAnt = EURODB; EuroDVAnt = EURODV;

  |SI #0#2 ] 2000;
     |SI #0#35 = "C"; |Y #0#22 = "S";
        |SI #caems347#34 = "PESETAS";
           EURO = 1 / 166.386; EURODB = 0; EURODV = 2;
        |SINO;
           EURO = 166.386; EURODB = 2; EURODV = 0;
        |FINSI;
        || Primero emito la portada del presentador
        eNif         = #caems347#9;                     || Nif del presentador
        eTelefono    = #caems347#10 + #caems347#11;     || Telefono presentador
        eNombre      = #caems347#25;                    || Nombre presentador
        eCalle       = #caems347#4 + " " + #caems347#5; || Calle presentador
        eNumero      = #caems347#6;                     || Numero presentador
        eMunicipio   = #caems347#7;
        eProvincia   = #caems347#8;
        eCodPostal   = (("00" + #caems347#17) % -102) + (("000" + #caems347#18) % -103);
        eCompl       = "";
        eSust        = "";
        eNumDecl     = "";
        eTotalPers   = #104#0 + #104#1 + #104#2 + #104#3 + #104#4;
        eTotalOper   = #104#7 + #104#8 + #104#9 + #104#10 + #104#11;
        eTotalInm    = #104#5;
        eTotalArrend = #104#12;
        eTDeclar     = #104#15;
        eTDeclardos  = #104#6;
        eNumDeclP    = #104#14 - (#104#15 + 1);
        eFirmado     = #caems347#25; |QBF eFirmado;
        ePres        = 1;
        |PRINT;
        |PIEINF;
     |FINSI;
  |FINSI;

  |SI #0#22 = "L";
      |HAZ representante;
      #0#25 = represen;
  |FINSI;
  represen = #0#25;                           || Representante;

  |SI #0#2 ] 2000;
     |SI #0#35 = "C";
        |SI #0#22 = "S"; |BUCLE ImprimePortadas; |FINSI;
        |DFICE Comodin;
        |PATH_DAT #7 Comodin;
        |PATH_DAT #1 Comodin; |PATH_DAT #2 Comodin;
        |PATH_DAT #3 Comodin; |PATH_DAT #4 Comodin;
        |DBASE fich_alta; |QBF fich_alta;
        fich_alta = fich_alta + "fich/" + (("00000" + #30#2) % -105) + #30#3 + "/";
        |HAZ inicio;
     |FINSI;
     |SI #0#35 = "I"; |Y #0#22 = "S"; #cabucem1#0 = #30#2; #cabucem1#1 = #30#3; |HAZ ImprimePortadas; |FINSI;
  |SINO;
     |PRINT;
     |PIEINF;
  |FINSI;

  #1#2 = #0#15;
  #1#3 = "S";
  #1#16 = #0#35; ||SI #1#16 = "L"; #1#16 = "I"; |FINSI;

  |GRABA 140#1a;
  |LIBERA #1;
|FPRC;

|PROCESO Portada;
  |HAZ FechaP;

  |IMPRE 0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;

  |SI enAnyo < 2000;
     |INFOR "capor347";
  |SINO;
     |INFOR "capo1347";
  |FINSI;
  |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

  ttes    = 0;
  tdos    = 0;

  |SI #0#2 < 2000;
     |SI #0#35 = "C";
         SwLee = 0;  |HAZ eosm0009C;

         |DDEFECTO #7;
         |DDEFECTO #1;
         Comodin  = #0#2 % -102; |QBF Comodin;
         any      = Comodin;                || A¤o Emision
         preimp   = "";                     || Impreso
         predis   = "";                     || Soporte Individual
         predi1   = "X";                    || Soporte Colectivo Presentador
         predi2   = "";                     || Soporte Colectivo Declarante
         represen = "";                     || Nombre Representante

         #7#0  = 0;                        || Codigo Cliente
         CampoDni = #0#9;  |HAZ LetraDni;
         #7#13 = CampoDni;                 || NIF
         #7#2  = #0#3;                     || Apellidos y Nombre
         #7#3  = #0#4;                     || SG
         #7#4  = #0#5;                     || Calle
         #7#5  = #0#6;                     || Numero
         #7#14 = #0#10 + "-" + #0#11;      || Telefono
         #7#11 = #0#7;                     || Municipio
         #7#12 = #0#8;                     || Provincia
         #7#09 = #0#17;                    || Codigo Postal 1
         #7#10 = #0#18;                    || Codigo Postal 2
         #7#16 = #0#12;                    || Delegacion de Hacienda
         #7#17 = #0#16;                    || Administracion de Hacienda
         #7#18 = #0#26;                    || Delegacion Hacienda
         #7#19 = #0#27;                    || Adminsitracion Hacienda
         |PRINT;
         |PIEINF;
     |FINSI;
  |FINSI;

  ttes    = 0;
  tdos    = 0;

  SwLee = 1; |HAZ eosm0009C;
  |FININF;
  |FINIMP;
|FPRC;

|| ***********************************************************************
||                       GRABACION SECUENCIAL DISTINTOS TIPOS
|| ***********************************************************************

|PROCESO Tipo2;
  Campos1  = "2";                                || Tipo Registro
  Campos2  = "347";                              || Modelo

  Comodin = #0#2 % -102; |QBF Comodin; Campos3 = Comodin;
  VAlfa    = #0#12;  VAlfa = ("00" + VAlfa) % -102;
  Campos4  = VAlfa;                                       || Delegacion A.E.A.T.
  CampoDni = #7#13;  |HAZ LetraDni;
  Campos5  = CampoDni;                                    || N.I.F.

  Campos6 = "";
  |SI #2#2 = "1"; Campos6 = "B"; |FINSI;
  |SI #2#2 = "2"; Campos6 = "A"; |FINSI;
  |SI #2#2 = "3"; Campos6 = "C"; |FINSI;
  |SI #2#2 = "4"; Campos6 = "D"; |FINSI;
  |SI #2#2 = "5"; Campos6 = "E"; |FINSI;                   || Clave Operacion

  CampoDni = #2#3;  |HAZ LetraDni;
  Campos7  = CampoDni;                                    || NIF Declarado
  Campos8  = #2#4;                                        || Apellidos y Nombre
  Campos9  = " ";
  |SI #2#15 = "S";  Campos9 = "R";  |FINSI;               || Representante

  VAlfa    = #2#9;  VAlfa = ("00" + VAlfa) % -102;
  Campos10 = VAlfa;                                     || Codigo Postal 1

  VAlfa = "000";
  |SI #2#9 = 99; VAlfa = #2#10; |FINSI;
  VAlfa = ("000" + VAlfa) % -103;
  Campos11 = VAlfa;                                     || Codigo Postal 2

  VAlfa    = #2#5;  VAlfa = ("000000000000000" + VAlfa) % -115;
  Campos12 = VAlfa;                                     || I. Operaciones

  Campos13 = " ";
  |SI #2#13 = "S";  Campos13 = "X";  |FINSI;               || Oper.Seguros

  Campos14 = " ";
  |SI #2#14 = "S";  Campos14 = "X";  |FINSI;               || Arrendamientos

  Campos15 = " " * 88;

  Campos   = Handle   + " " + Campos1 + Campos2 + Campos3 + Campos4;
  Campos   = Campos   + Campos5  + Campos6  + Campos7  + Campos8  + Campos9;
  Campos   = Campos   + Campos10 + Campos11 + Campos12 + Campos13;
  Campos   = Campos   + Campos14 + Campos15;
  Campos   = Campos   + &#0#19 + &#0#20;        || Caracter Final de Linea
  |FGRABA Campos; #104#14 = #104#14 + 1;
|FPRC;

|PROCESO Tipo3;

  Campos1  = "3";                                || Tipo Registro
  Campos2  = "347";                              || Modelo
  Comodin  = #0#2 % -102; |QBF Comodin; Campos3  = Comodin;
  VAlfa    = #0#12;  VAlfa = ("00" + VAlfa) % -102;
  Campos4  = VAlfa;                                       || Delegacion A.E.A.T.

  CampoDni = #7#13;  |HAZ LetraDni;
  Campos5  = CampoDni;                                    || N.I.F.

  CampoDni = #4#2;  |HAZ LetraDni;
  Campos6  = CampoDni;                                    || NIF Arrendatario

  Campos7  = #4#3;                                        || Apellidos y Nombre
  VAlfa    = #4#4;  VAlfa = ("000000000000000" + VAlfa) % -115;
  Campos8  = VAlfa;                                       || I. Operaciones

  VAlfa    = #4#11;  VAlfa = ("00" + VAlfa) % -102;
  Campos9  = VAlfa;                                     || Codigo Postal 1
||  VAlfa    = #4#12;  VAlfa = ("000" + VAlfa) % -103;
  Campos10 = "000";                                     || Codigo Postal 2

  Campos11 = #4#14;                                     || Municipio
  Campos12 = #4#15;                                     || Referencia
  Campos13 = #4#5;                                      || SG
  Campos14 = #4#6;                                      || Calle

  VAlfa    = #4#7; |QBT VAlfa;
  VAlfa    = ("00000" + VAlfa) % -105;
  Campos15 = VAlfa;                                     || Numero

  Campos16 = #4#8;                                      || Escalera
  Campos17 = #4#9;                                      || Piso
  Campos18 = #4#10;                                     || Puerta
  Campos19 = " " * 5;
  Campos   = Handle   + " " + Campos1 + Campos2 + Campos3 + Campos4;
  Campos   = Campos   + Campos5  + Campos6  + Campos7  + Campos8  + Campos9;
  Campos   = Campos   + Campos10 + Campos11 + Campos12 + Campos13 + Campos14;
  Campos   = Campos   + Campos15 + Campos16 + Campos17 + Campos18 + Campos19;
  Campos   = Campos   + &#0#19 + &#0#20;        || Caracter Final de Linea
  |FGRABA Campos;
  #104#14 = #104#14 + 1;
|FPRC;

|PROCESO Tipo_2;
   |SI #caems347#2 < 2000;
      |HAZ Tipo2;
   |SINO;
      |HAZ Tipo22001_1;
   |FINSI;
|FPRC;

|DEFBUCLE grlin;
 #2#2;
 0;
 tip1, "            ", #30#2;
 tip2, "zzzzzzzzzzzz", #30#2;
 be;
 NULL, Tipo_2;
|FIN;

|PROCESO eosm0010;
  tip1 = 2;
  tip2 = 2;
  |BUCLE grlin; || las lineas - registro de operaciones
  tip1 = 1;
  tip2 = 1;
  |BUCLE grlin; || las lineas - registro de operaciones
  tip1 = 3;
  tip2 = 9;
  |BUCLE grlin; || las lineas - registro de operaciones
|FPRC;

|PROCESO Tipo1;
  Campos1  = "1";                                || Tipo Registro
  Campos2  = "347";                              || Modelo
  Comodin  = #0#2 % -102; |QBF Comodin; Campos3 = Comodin;
  VAlfa    = #0#12;  VAlfa = ("00" + VAlfa) % -102;

  Campos4  = VAlfa;                                       || Delegacion A.E.A.T.
  CampoDni = #7#13;  |HAZ LetraDni;
  Campos5  = CampoDni;                                    || N.I.F.
  Campos6  = #7#2;                                        || Apellidos y Nombre

  VAlfa    = #1#6; VAlfa = ("000000000" + VAlfa) % -109;
  Campos7  = VAlfa;                       || Total Personas Clave A

  VAlfa    = #1#7;  VAlfa = ("000000000000000" + VAlfa) % -115;
  Campos8  = VAlfa;                       || T. Operaciones Clave A

  VAlfa    = #1#8; VAlfa = ("000000000" + VAlfa) % -109;
  Campos9  = VAlfa;                       || Total Personas Clave B

  VAlfa    = #1#9;  VAlfa = ("000000000000000" + VAlfa) % -115;
  Campos10 = VAlfa;                       || T. Operaciones Clave B

  VAlfa    = #1#10; VAlfa = ("000000000" + VAlfa) % -109;
  Campos11 = VAlfa;                       || Total Personas Clave C

  VAlfa    = #1#11;  VAlfa = ("000000000000000" + VAlfa) % -115;
  Campos12 = VAlfa;                       || T. Operaciones Clave C

  VAlfa    = #1#12; VAlfa = ("000000000" + VAlfa) % -109;
  Campos13 = VAlfa;                       || Total Personas Clave D

  VAlfa    = #1#13;  VAlfa = ("000000000000000" + VAlfa) % -115;
  Campos14 = VAlfa;                       || T. Operaciones Clave D

  VAlfa    = #1#14; VAlfa = ("000000000" + VAlfa) % -109;
  Campos15 = VAlfa;                       || Total Personas Clave E

  VAlfa    = #1#15;  VAlfa = ("000000000000000" + VAlfa) % -115;
  Campos16 = VAlfa;                       || T. Operaciones Clave E

  Campos17 = " ";

  Campos   = Handle   + " " + Campos1 + Campos2 + Campos3 + Campos4;
  Campos   = Campos   + Campos5  + Campos6  + Campos7  + Campos8  + Campos9;
  Campos   = Campos   + Campos10 + Campos11 + Campos12 + Campos13 + Campos14;
  Campos   = Campos   + Campos15 + Campos16 + Campos17;
  Campos   = Campos   + &#0#19 + &#0#20;        || Caracter Final de Linea
  |FGRABA Campos; #104#14 = #104#14 + 1;
|FPRC;

|PROCESO Tipo_3;
   |SI #caems347#2 < 2000;
      |HAZ Tipo3;
   |SINO;
      |HAZ Tipo22001_2;
   |FINSI;
|FPRC;

|PROCESO TotalDecl;
   || TLinea = (#camal347#5 / Cambio) ! Redond;
   TLinea = #camal347#5;
   |SI #camal347#2 = "1"; TotalA = TotalA + TLinea; |FINSI;
   |SI #camal347#2 = "2"; TotalB = TotalB + TLinea; |FINSI;
   |SI #camal347#2 = "3"; TotalC = TotalC + TLinea; |FINSI;
   |SI #camal347#2 = "4"; TotalD = TotalD + TLinea; |FINSI;
   |SI #camal347#2 = "5"; TotalE = TotalE + TLinea; |FINSI;

   TDeclarados  = TDeclarados + 1;

   |SI #camal347#2 ] "1"; |O  #camal347#2 [ "5";
       nTOperacion  = nTOperacion + ((#camal347#5 / Cambio) ! Redond);
   |FINSI;
|FPRC;

|DEFBUCLE TotalDecl;
#camal347#1;
;
nEmpresa,00001;
nEmpresa,99999;
;
NULL,TotalDecl;
|FIN;

|PROCESO TotalInm;
   TLinea = (#camil347#4 / Cambio) ! Redond;
   TInm = TInm + TLinea;
   TInmuebles  = TInmuebles + 1;
|FPRC;

|DEFBUCLE TotalInm;
#camil347#1;
;
nEmpresa,00001;
nEmpresa,99999;
;
NULL,TotalInm;
|FIN;

|PROCESO LeePortadaC;
  TotalA = 0; TotalB = 0; TotalC = 0; TotalD = 0; TotalE = 0; TInm = 0;
  nTOperacion = 0;
  Cambio      = 1;
  Redond      = 2;
  |SI eaMoneda = "P";  Cambio = 166.386;  |FINSI;

  nEmpresa = #30#2;
  |BUCLE TotalDecl; |BUCLE TotalInm;

  |SI SwLee = 0;
      ttes = ttes + 1;
      tdos = tdos + (#1#6 + #1#8 + #1#10 + #1#12 + #1#14 + #3#2);
      #104#0  = #104#0 + #1#6;
      #104#1  = #104#1 + #1#8;
      #104#2  = #104#2 + #1#10;
      #104#3  = #104#3 + #1#12;
      #104#4  = #104#4 + #1#14;
      #104#5  = #104#5 + #3#2;
      #104#6  = #104#0 + #104#1 + #104#2 + #104#3 + #104#4 + #104#5;

      #104#7  = #104#7  + TotalB;
      #104#8  = #104#8  + TotalA;
      #104#9  = #104#9  + TotalC;
      #104#10 = #104#10 + TotalD;
      #104#11 = #104#11 + TotalE;
      #104#12 = #104#12 + TInm;
      #104#13 = #104#7  + #104#8 + #104#9 + #104#10 + #104#11 + #104#12;
      #104#15 = #104#15 + 1;

      |ACABA;
  |FINSI;

  |ABRE #3;
  sw_inm = 0;
  #3#0  = #1#0;
  |LEE 040#3=;
  |SI FSalida ! 0; sw_inm = 1; |DDEFECTO #3; |FINSI;
  |CIERRA #3;

  SwLee = 1;
  |SI #caems347#2 < 2000;
     |HAZ Tipo1;
  |SINO;
     |HAZ Tipo12001;
     aTipo = "1"; |HAZ CreaAuxiliar;
  |FINSI;
  SwLee = 2;  DClave = "A";  HClave = "E"; |HAZ eosm0010;
  |SI sw_inm = 0;
       SwLee = 3;  DClave = "Z";  HClave = "Z";
       |BUCLELIN 0Tipo_3#3; || las lineas - Inmuebles.
  |FINSI;
|FPRC;

|| ************************************************************************
|| ************ REGISTROS SOPORTE MAGNETICO MODELO 347 (2001) *************
|| ************************************************************************

|PROCESO Tipo02001;
   Cadena = "0347";
   aAlfa = #caems347#2;  Cadena = Cadena + aAlfa;   || Ejercicio
   aAlfa = #caems347#9;  Cadena = Cadena + aAlfa;   || Nif Presentador
   aAlfa = #caems347#25; aTipo = "A";  nLongitud = 40;
   |HAZ AnalizaCadena;   Cadena = Cadena + aAlfa;   || Presentador
   aAlfa = #caems347#4;  Cadena = Cadena + aAlfa;   || SG Presentador
   aAlfa = #caems347#5;  aTipo = "A";  nLongitud = 20;
   |HAZ AnalizaCadena;   Cadena = Cadena + aAlfa;   || Nombre Via
   aAlfa = #caems347#6;  aTipo = "N";  nLongitud = 5;
   |HAZ AnalizaCadena;   Cadena = Cadena + aAlfa;   || Numero
   aAlfa = #caems347#29; Cadena = Cadena + aAlfa;   || Escalera
   aAlfa = #caems347#30; Cadena = Cadena + aAlfa;   || Piso
   aAlfa = #caems347#31; Cadena = Cadena + aAlfa;   || Puerta
   aAlfa = (("00" + #caems347#17) % -102) + (("000" + #caems347#18) % -103)
   Cadena = Cadena + aAlfa;                         || Codigo Postal
   aAlfa = #caems347#7;  aTipo = "A";  nLongitud = 12;
   |HAZ AnalizaCadena;   Cadena = Cadena + aAlfa;   || Municipio
   aAlfa = ("00" + #caems347#17) % -102;
   Cadena = Cadena + aAlfa;                         || Codigo Provincia
   aAlfa = #104#15; aTipo = "N"; nLongitud = 5;
   |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;       || Total Declarantes
   aAlfa = #104#6;  aTipo = "N"; nLongitud = 9;
   |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;       || Total Declarados
   Cadena = Cadena + "D";
   aAlfa = #caems347#33; |HAZ QuitaRarosTfno;
   Cadena = Cadena + aAlfa;                           || Telefono Contacto
   aAlfa = #caems347#32; aTipo = "A"; nLongitud = 40;
   |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;       || Persona de contacto
   aAlfa = " " * 77;   Cadena = Cadena + aAlfa;
   Comodin = #0#19; Cadena = Cadena + &Comodin;
   Comodin = #0#20; Cadena = Cadena + &Comodin;
   Cadena = Handle + " " + Cadena; |FGRABA Cadena; #104#14 = #104#14 + 1;
|FPRC;

|PROCESO Tipo12001;
   Cadena = "1347";
   aAlfa = #caems347#2;  Cadena = Cadena + aAlfa;   || Ejercicio
   aAlfa = #caportad#13; aTipo = "A"; nLongitud = 9;
   |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;     || Nif Declarante
   aAlfa = #caportad#2;  aTipo = "A"; nLongitud = 40;
   |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;     || Declarante
   Cadena = Cadena + "D";
   aAlfa = #caportad#90; |QBF aAlfa; aAlfa = aAlfa + #caportad#91;
   |HAZ QuitaRarosTfno;  Cadena = Cadena + aAlfa;   || Telefono Pers.Contacto
   aAlfa = #caportad#89; aTipo = "A"; nLongitud = 40;
   |HAZ AnalizaCadena;   Cadena = Cadena + aAlfa;   || Persona Contacto
   |SI #caems347#34 = "EUROS  "; aAlfa = "348"; |SINO; aAlfa = "347"; |FINSI;
   aAlfa = aAlfa + ("0" * 10); Cadena = Cadena + aAlfa;   || N§ Justificante declar.
   |SI #camac347#18 = "C"; aAlfa = "C "; |FINSI;    || Decl. Complementaria
   |SI #camac347#18 = "S"; aAlfa = " S"; |FINSI;    || Decl. Sustitutoria
   |SI #camac347#18 = "N"; aAlfa = "  "; |FINSI;    || Decl. Normal
   Cadena = Cadena + aAlfa;
   aAlfa = #camac347#19; aTipo = "N"; nLongitud = 13;
   |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;     || N§ Decl.Anterior
   Calc = #camac347#6 + #camac347#8 + #camac347#10 + #camac347#12 + #camac347#14;
   aAlfa = Calc; aTipo = "N"; nLongitud = 9;
   |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;

   ||Calc = ((TotalA + TotalB + TotalC + TotalD + TotalE) / Cambio) ! Redond;
   Calc = nTOperacion ! Redond;
   |SI #caems347#34 = "EUROS  "; Calc = Calc * 100; |FINSI;

   aAlfa = "0" * 15; aAlfa = (aAlfa + Calc) % -115; Cadena = Cadena + aAlfa;
   Calc = #camic347#2; aAlfa = Calc; aTipo = "N"; nLongitud = 9;
   |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;
   |SI #caems347#34 = "EUROS  "; Calc = TInm * 100; |SINO; Calc = TInm; |FINSI;
   aAlfa = "0" * 15; aAlfa = (aAlfa + Calc) % -115; Cadena = Cadena + aAlfa;
   aAlfa = " " * 67; Cadena = Cadena + aAlfa;
   Comodin = #0#19;  Cadena = Cadena + &Comodin;
   Comodin = #0#20;  Cadena = Cadena + &Comodin;
   Cadena = Handle + " " + Cadena;
   |FGRABA Cadena; #104#14 = #104#14 + 1;
|FPRC;

|PROCESO Tipo22001_1;
   Cadena = "2347";
   aAlfa = #caems347#2;  Cadena = Cadena + aAlfa;   || Ejercicio
   aAlfa = #caportad#13; aTipo = "A"; nLongitud = 9;
   |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;     || Nif Declarante
   |SI #camal347#15 = "S";
      aAlfa = "         "; Cadena = Cadena + aAlfa; || Nif Declarado
      aAlfa = #camal347#3; aTipo = "A"; nLongitud = 9;
      |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;  || Nif Representante
   |SINO;
      aAlfa = #camal347#3; aTipo = "A"; nLongitud = 9;
      |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;  || Nif Declarado
      aAlfa = "         "; Cadena = Cadena + aAlfa; || Nif Representante
   |FINSI;
   aAlfa = #camal347#4;    aTipo = "A"; nLongitud = 40;
   |HAZ AnalizaCadena;    Cadena = Cadena + aAlfa;  || Nombre Declarado
   Cadena = Cadena + "D";                           || Tipo de hoja
   aAlfa = #camal347#9;  |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
   Cadena = Cadena + aAlfa;                         || Codigo Provincia
   |SI #camal347#9 = "99";
      aAlfa = #camal347#10; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   |SINO;
      aAlfa = "000";
   |FINSI;
   Cadena = Cadena + aAlfa;                         || Codigo Pais
                                                    || Clave Codigo
   |SI #camal347#2 = 2; Cadena = Cadena + "A"; |FINSI;
   |SI #camal347#2 = 1; Cadena = Cadena + "B"; |FINSI;
   |SI #camal347#2 = 3; Cadena = Cadena + "C"; |FINSI;
   |SI #camal347#2 = 4; Cadena = Cadena + "D"; |FINSI;
   |SI #camal347#2 = 5; Cadena = Cadena + "E"; |FINSI;

   aAlfa = #camal347#5; aTipo = "N"; nLongitud = 15;
   |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;     || Importe operaciones
   |SI #camal347#13 = "S"; Cadena = Cadena + "X"; |SINO; Cadena = Cadena + " "; |FINSI;
   |SI #camal347#14 = "S"; Cadena = Cadena + "X"; |SINO; Cadena = Cadena + " "; |FINSI;
   aAlfa = " " * 151; Cadena = Cadena + aAlfa;
   Comodin = #0#19;  Cadena = Cadena + &Comodin;
   Comodin = #0#20;  Cadena = Cadena + &Comodin;
   Cadena = Handle + " " + Cadena; |FGRABA Cadena; #104#14 = #104#14 + 1;
|FPRC;

|PROCESO Tipo22001_2;
   Cadena = "2347";
   aAlfa = #caems347#2;  Cadena = Cadena + aAlfa;   || Ejercicio
   aAlfa = #caportad#13; aTipo = "A"; nLongitud = 9;
   |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;     || Nif Declarante
   aAlfa = #camil347#2; aTipo = "A"; nLongitud = 9;
   |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;     || Nif Arrendatario
   aAlfa = "         "; Cadena = Cadena + aAlfa;    || Nif Representante
   aAlfa = #camil347#3; aTipo = "A"; nLongitud = 40;
   |HAZ AnalizaCadena; Cadena = Cadena + aAlfa;     || Nombre Declarado
   Cadena = Cadena + "I";                           || Tipo de hoja
   aAlfa = " " * 23;      Cadena = Cadena + aAlfa;
   aAlfa = #camil347#4;  aTipo = "N"; nLongitud = 15;
   |HAZ AnalizaCadena;  Cadena = Cadena + aAlfa;     || Importe operacion
   aAlfa = #camil347#15; aTipo = "A"; nLongitud = 25;
   |HAZ AnalizaCadena;  Cadena = Cadena + aAlfa;     || Referencia catastral
   aAlfa = #camil347#11; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
   Cadena = Cadena + aAlfa;                         || Codigo Provincial
   aAlfa = #camil347#14; aTipo = "A"; nLongitud = 24;
   |HAZ AnalizaCadena;  Cadena = Cadena + aAlfa;     || Municipio
   aAlfa = #camil347#5; Cadena = Cadena + aAlfa;    || SG
   aAlfa = #camil347#6;  aTipo = "A"; nLongitud = 20;
   |HAZ AnalizaCadena;  Cadena = Cadena + aAlfa;     || Nombre Via
   aAlfa = #camil347#7;  aTipo = "N"; nLongitud = 5;
   |HAZ AnalizaCadena;  Cadena = Cadena + aAlfa;     || Numero
   aAlfa = #camil347#8;  Cadena = Cadena + aAlfa;    || Escalera
   aAlfa = #camil347#9;  Cadena = Cadena + aAlfa;    || Piso
   aAlfa = #camil347#10; Cadena = Cadena + aAlfa;    || Puerta
   aAlfa = " " * 52; Cadena = Cadena + aAlfa;
   Comodin = #0#19;  Cadena = Cadena + &Comodin;
   Comodin = #0#20;  Cadena = Cadena + &Comodin;
   Cadena = Handle + " " + Cadena; |FGRABA Cadena; #104#14 = #104#14 + 1;
|FPRC;



|| ************************************************************************
|| ................. HAZ TODO
|PROCESO eosm0009C;
 empcon = #30#1;
 ejecon = #0#2;
 |ABRE #1;
 |LEE 001#1p;
 |SI FSalida ! 0; |CIERRA #1; |ACABA; |FINSI;

 |ABRE #7;
 #7#0 = #30#2;
 #7#1 = #30#26;
 |LEE 001#7=;
 |SI FSalida ! 0; |CIERRA #1; |CIERRA #7; |ACABA; |FINSI;

 sw_inm = 0;
 |ABRE #3;
 |DDEFECTO #3;
 #3#0 = #30#2;
 |LEE 001#3=;
 |SI #3#2 = 0; sw_inm = 1; |FINSI;

 |CIERRA #1;
 |CIERRA #7;
 |CIERRA #3;
 |SI Opcion = 1;
     |SI #0#22 ! "L"; |HAZ LeePortadaC; |FINSI;
     |SI #0#22 = "L"; |HAZ LeePortadaL; |FINSI;
 |FINSI;
 |SI Opcion = 2;
     |HAZ LeePortadaP;
 |FINSI;
|FPRC;
|| ************************************************************************
|PROCESO Tipo0;
  Campos1  = "0";                                || Tipo Registro
  Campos2  = "347";                              || Modelo

  Comodin = #0#2 % -102; |QBF Comodin; Campos3 = Comodin;

  VAlfa    = #0#12;  VAlfa = ("00" + VAlfa) % -102;
  Campos4  = VAlfa;                                     || Delegacion A.E.A.T.
  Campos5  = #0#9;                                      || N.I.F.
  Campos6  = #0#3;                                      || Apellidos y Nombre
  Campos7  = #0#4;                                      || SG
  Campos8  = #0#5 % 120;                                || Calle
  Campos9  = #0#6;
  VAlfa    = #0#17;  VAlfa = ("00" + VAlfa) % -102;
  Campos10 = VAlfa;                                     || Codigo Postal 1
  VAlfa    = #0#18;  VAlfa = ("000" + VAlfa) % -103;
  Campos11 = VAlfa;                                     || Codigo Postal 2
  Campos12 = #0#7 % 112;                                || Municipio
  Campos13 = #0#10;                                     || Prefijo
  Campos14 = #0#11;                                     || Telefono
  VAlfa    = ttes; VAlfa = ("00000" + VAlfa) % -105; || Total Declarantes
  Campos15 = VAlfa;
  VAlfa    = tdos; VAlfa = ("000000000" + VAlfa) % -109; || T. Declarados
  Campos16 = VAlfa;
  Campos17 = " " * 53;

  Campos   = Handle   + " " + Campos1 + Campos2 + Campos3 + Campos4;
  Campos   = Campos   + Campos5  + Campos6  + Campos7  + Campos8  + Campos9;
  Campos   = Campos   + Campos10 + Campos11 + Campos12 + Campos13 + Campos14;
  Campos   = Campos   + Campos15 + Campos16 + Campos17;
  Campos   = Campos   + &#0#19 + &#0#20;        || Caracter Final de Linea
  |FGRABA Campos;
  #104#14 = #104#14 + 1;
|FPRC;

|| ************************************************************************
||                  CREACION DISKETTE SOPORTE COLECTIVO E INDIVIDUAL
|| ************************************************************************

|PROCESO CuentaEmpresas;
   |ABRE #30;
   #30#2 = #cabucem1#0;
   #30#3 = #cabucem1#1;
   |LEE 000#30=;
   |SI FSalida = 0;
      |DBASE Comodin; |QBF Comodin;
      Comodin = Comodin + "fich/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
      |PATH_DAT #1 Comodin;
      |PATH_DAT #2 Comodin;
      |PATH_DAT #3 Comodin;
      |PATH_DAT #4 Comodin;
      |PATH_DAT #7 Comodin;
      |DBASE fich_alta; |QBF fich_alta;
      fich_alta = fich_alta + "fich/" + (("00000" + #30#2) % -105) + #30#3 + "/";
      EuroAnt   = EURO;
      EuroDBAnt = EURODB;
      EuroDVAnt = EURODV;
      |HAZ inicio;
      EURO   = EuroAnt;
      EURODB = EuroDBAnt;
      EURODV = EuroDVAnt;
      SwLee = 0;  |HAZ eosm0009C;
      TotalA = 0; TotalB = 0; TotalC = 0;
      TotalD = 0; TotalE = 0; TInmuebles = 0;
      nTOperacion = 0;
   |FINSI;
   |CIERRA #30;
|FPRC;

|DEFBUCLE CuentaEmpresas;
#cabucem1#1;
;
INICIO;
FINAL;
;
NULL,CuentaEmpresas;
|FIN;

|PROCESO Empresas;
   |ABRE #30;
   #30#2 = #cabucem1#0;
   #30#3 = #cabucem1#1;
   |LEE 000#30=;
   |SI FSalida = 0;
      |DBASE Comodin; |QBF Comodin;
      Comodin = Comodin + "fich/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
      |PATH_DAT #1 Comodin;
      |PATH_DAT #2 Comodin;
      |PATH_DAT #3 Comodin;
      |PATH_DAT #4 Comodin;
      |PATH_DAT #7 Comodin;
      |DBASE fich_alta; |QBF fich_alta;
      fich_alta = fich_alta + "fich/" + (("00000" + #30#2) % -105) + #30#3 + "/";
      EuroAnt = EURO;
      EuroDBAnt = EURODB;
      EuroDVAnt = EURODV;
      |HAZ inicio;
      EURO = EuroAnt;
      EURODB = EuroDBAnt;
      EURODV = EuroDVAnt;
      SwLee = 1;  |HAZ eosm0009C;
   |FINSI;
   |CIERRA #30;
|FPRC;

|DEFBUCLE Empresas;
#cabucem1#1;
;
INICIO;
FINAL;
;
NULL,Empresas;
|FIN;

|PROCESO Creacion;
  |HAZ FechaP;

  |DDEFECTO #104;

  ttes    = 0;
  tdos    = 0;

  Raiz       = "";  |DIRECTORIO Raiz;
  Directorio = "";  |DBASE Directorio;
  Directorio = Directorio + "hacienda/" + aTipoSec;  |MKDIR Directorio;
  Directorio = Directorio + "/";
  Valfa = Raiz + "bin/agichmod 777 " + Directorio;
  |SYSTEM Valfa;

  Comodin = #0#2; Fichero    = "op" + Comodin;
  aNomAux = "auxiliar.txt";
  aNombre = Fichero;
  NFichero   = Directorio + Fichero;          |QBF NFichero;

  Fichero  = "wb  "+ NFichero;

  Pos = -1;
  |FABRE Fichero;
  Handle = FSalida;
  |SI FSalida ] 0;
     Comodin = #0#2;
     NFichero   = Directorio + aNomAux;          |QBF NFichero;

     Fichero  = "wb  "+ NFichero;
     Pos = -1;
     |FABRE Fichero;   Handle1 = FSalida;
     |SI FSalida ] 0;
        TotalA = 0; TotalB = 0; TotalC = 0;
        TotalD = 0; TotalE = 0; TInmuebles = 0;
        nTOperacion = 0;
        |SI #0#35 = "C";
          |BUCLE CuentaEmpresas;
          |SI #caems347#2 < 2000;
            |HAZ Tipo0;
          |SINO;
            |HAZ Tipo02001;
            aTipo = "0"; |HAZ CreaAuxiliar;
          |FINSI;  || Registro del Presentador
          |BUCLE Empresas;
          #30#2 = #48#2;
          #30#3 = #48#3;
          |LEE 000#30=;
        |SINO;
          SwLee = 0;  |HAZ eosm0009C;
          SwLee = 1;  |HAZ eosm0009C;
        |FINSI;
    |FINSI;
  |FINSI;

  FSalida = Handle; |FCIERRA FSalida;
  FSalida = Handle1; |FCIERRA FSalida;

  Pos = -1;
  |PUSHV 0501 2380;
  |PINPA #0#104;
  |PINDA #0#104;
  |LEETECLA aTecla;
  |CONFI "2400SEs Correcto : ";
  |SI FSalida ! 0;
      |FBORRA NFichero;
      Salir = 1;
  |FINSI;
  |POPV;

  |SI #0#22 = "F";
     aAlfa = ""; |IP_REMOTO aAlfa;
     |DBASE aDirOri; |QBF aDirOri;
     aDirOri = aDirOri + "hacienda/" + aTipoSec + "/";
     aDirDes = "/MODELOS";
     |SI aAlfa ! ""; |RMKDIR aDirDes; |SINO; |MKDIR aDirDes; |FINSI;
     aDirDes = "/MODELOS/INTERNET";
     |SI aAlfa ! ""; |RMKDIR aDirDes; |SINO; |MKDIR aDirDes; |FINSI;
     |SI #0#34 = "PESETAS";
        aDirDes = "/MODELOS/INTERNET/" + aTipoSec;
     |SINO;
        aDirDes = "/MODELOS/INTERNET/348";
     |FINSI;
     |SI aAlfa ! ""; |RMKDIR aDirDes; |SINO; |MKDIR aDirDes; |FINSI;
     aDirDes = aDirDes + "/"; SwError = 0;
     aOrigen = aDirOri + aNombre; aDestino = aDirDes + aNombre;
     |SI aAlfa ! ""; |ENVIA_FICHERO aOrigen, aDestino; |SINO; |COPIA_FICHERO aOrigen, aDestino; |FINSI;
     aOrigen = aDirOri + aNomAux; aDestino = aDirDes + aNomAux;
     |SI aAlfa ! ""; |ENVIA_FICHERO aOrigen, aDestino; |SINO; |COPIA_FICHERO aOrigen, aDestino; |FINSI;

     aAlfa = "    Ficheros creados correctamente " + aDirDes;
     |MENAV aAlfa;
  |FINSI;
|FPRC;

|| ************************************************************************
||                  CREACION DISKETTE SOPORTE LASER
|| ************************************************************************

|PROCESO LeePortadaL;

  || Primero preparo los totales para luego escribirlos en cada registro
  TotalA = 0; TotalB = 0; TotalC = 0; TotalD = 0; TotalE = 0; TInmuebles = 0;
  nTOperacion = 0;
  nEmpresa = #30#2;
  Cambio = 1;
  Redond = 2;
  |SI eaMoneda = "P";  Cambio = 166.386;  |FINSI;

  |BUCLE TotalDecl; |BUCLE TotalInm;

  #0#12 = #7#16;

  Directorio = "";
  |DBASE Directorio;
  Directorio = Directorio + "hacienda/347";
  |MKDIR Directorio;
  Directorio = Directorio + "/";

  Empresa  = #1#0;  Empresa  = ("00000" + Empresa) % -105;

  Fichero    = "347" + Empresa;
  INEmpresas = NEmpresas1 <-;
  INEmpresas = INEmpresas + NACopiar;
  NFichero   = Directorio + Fichero;          |QBF NFichero;
  NEmpresas  = NFichero;
  NACopiar   = NACopiar + 1;

  Fichero  = "wb  "+ NFichero;

  Pos = -1;
  |FABRE Fichero;
  Handle = FSalida;
  |SI FSalida ] 0;
     |SI #caems347#2 < 2000;
        |HAZ Tipo1;
     |SINO;
        |HAZ Tipo12001;
     |FINSI;
     SwLee = 2;  DClave = "A";  HClave = "E"; |HAZ eosm0010;
     |SI sw_inm = 0;
         SwLee = 3;  DClave = "Z";  HClave = "Z";
         |BUCLELIN 0Tipo_3#3; || las lineas - Inmuebles.
     |FINSI;
  |FINSI;

  FSalida = Handle; |FCIERRA FSalida;

  Fichero    = "347" + Empresa + ".car";
  NFichero   = Directorio + Fichero;          |QBF NFichero;

  Fichero  = "wb  "+ NFichero;
  |FABRE Fichero;   Handle = FSalida;
  |SI FSalida ] 0;
      aTipo = "1";
      |HAZ CreaAuxiliar;
  |FINSI;
  FSalida = Handle; |FCIERRA FSalida;

|FPRC;

|PROCESO CreaAuxiliar;
   |SI aTipo = "1";
      Cadena1 = aTipo; |QBF Cadena1;
      Cadena1 = Cadena1 + "347";
      aAlfa = #0#2; Cadena1 = Cadena1 + #0#2;            || Ejercicio
      aAlfa = #caportad#13; aTipo = "A"; nLongitud = 9;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Nif Declarante
      aAlfa = #caportad#16; aTipo = "N"; nLongitud = 2;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Codigo delegacion
      aAlfa = #caportad#17; aTipo = "N"; nLongitud = 3;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Codigo administracion
      aAlfa = #caportad#3;  aTipo = "A"; nLongitud = 2;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || SG
      aAlfa = #caportad#4;  aAlfa = aAlfa % 0120; aTipo = "A"; nLongitud = 20;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Nombre de la via
      aAlfa = #caportad#5;  aTipo = "N"; nLongitud = 5;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Numero de la via
      aAlfa = #caportad#11; aAlfa = aAlfa % 0112; aTipo = "A"; nLongitud = 12;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Municipio
      aAlfa = #caportad#9;  aTipo = "N"; nLongitud = 2;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Codigo provincial
      aAlfa = (("00" + #caportad#9) % -102) + (("000" + #caportad#10) % -103);
      Cadena1 = Cadena1 + aAlfa;                         || Codigo postal
      aAlfa = #0#15; aAlfa = (aAlfa % 0704) + (aAlfa % 0402) + (aAlfa % 0102);
      Cadena1 = Cadena1 + aAlfa;     || Fecha Presentacion
      aAlfa = #caems347#25; aTipo = "A"; nLongitud = 30;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Firmante
      aAlfa = #caems347#24; aTipo = "A"; nLongitud = 25;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Cargo o empleo
      |SI #0#35 = "C"; |Y #0#2 = 2000;
          Cadena1 = Cadena1 + " ";
      |FINSI;

      |SI #0#2 ] 2002;
          Cadena1 = Cadena1 + (("00000" + #1#0) % -105) + (" " * 15);
      |FINSI;

      Comodin = #0#19;  Cadena1 = Cadena1 + &Comodin;
      Comodin = #0#20;  Cadena1 = Cadena1 + &Comodin;
      Cadena1 = Handle1 + " " + Cadena1; |FGRABA Cadena1;
   |SINO;
      Cadena1 = aTipo; |QBF Cadena1;
      Cadena1 = Cadena1 + "347";
      aAlfa = #0#2; Cadena1 = Cadena1 + #0#2;            || Ejercicio
      aAlfa = #caems347#9; aTipo = "A"; nLongitud = 9;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Nif Declarante
      aAlfa = #caems347#12; aTipo = "N"; nLongitud = 2;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Codigo delegacion
      aAlfa = #caems347#16; aTipo = "N"; nLongitud = 3;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Codigo administracion
      aAlfa = #caems347#4;  aTipo = "A"; nLongitud = 2;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || SG
      aAlfa = #caems347#5;  aAlfa = aAlfa % 0120; aTipo = "A"; nLongitud = 20;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Nombre de la via
      aAlfa = #caems347#6;  aTipo = "N"; nLongitud = 5;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Numero de la via
      aAlfa = #caems347#7; aAlfa = aAlfa % 0112; aTipo = "A"; nLongitud = 12;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Municipio
      aAlfa = #caems347#17; aTipo = "N"; nLongitud = 2;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Codigo provincial
      aAlfa = (("00" + #caems347#17) % -102) + (("000" + #caems347#18) % -103);
      Cadena1 = Cadena1 + aAlfa;                         || Codigo postal
      aAlfa = #0#15; aAlfa = (aAlfa % 0704) + (aAlfa % 0402) + (aAlfa % 0102);
      Cadena1 = Cadena1 + aAlfa;     || Fecha Presentacion
      aAlfa = #caems347#25; aTipo = "A"; nLongitud = 30;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Firmante
      aAlfa = #caems347#24; aTipo = "A"; nLongitud = 25;
      |HAZ AnalizaCadena; Cadena1 = Cadena1 + aAlfa;     || Cargo o empleo
      |SI #0#35 = "C"; |Y #0#2 = 2000;
          Cadena1 = Cadena1 + " ";
      |FINSI;

      |SI #0#2 ] 2002;
          Cadena1 = Cadena1 + (" " * 20);
      |FINSI;

      Comodin = #0#19;  Cadena1 = Cadena1 + &Comodin;
      Comodin = #0#20;  Cadena1 = Cadena1 + &Comodin;
      Cadena1 = Handle1 + " " + Cadena1; |FGRABA Cadena1;
   |FINSI;
|FPRC;

|PROCESO CreacionLaser;
  NACopiar   = 0;
  INEmpresas = NEmpresas1 <-;
  |PARA XPara = 1; |SI XPara [ 10;  |HACIENDO XPara = XPara + 1;
        NEmpresas = "";
        INEmpresas = INEmpresas + 1;
  |SIGUE;

  |HAZ FechaP;
  |HAZ eosm0009C;
|FPRC;

|| ************************************************************************
||                  VERIFICACION
|| ************************************************************************

|PROCESO Verificacion;
     Pos = -1;
     Directorio = "";  |DBASE Directorio;
     Directorio = Directorio + "hacienda/" + aTipoSec;  |MKDIR Directorio;
     Directorio = Directorio + "/";
     || Comodin = #0#2; Fichero    = "op" + Comodin;
     Fichero = aNombre;
     NFichero = Fichero;          |QBF NFichero;
     Fichero  = "rt  "+ Directorio + NFichero;

     |FABRE Fichero;
     |SI FSalida < 0;
         Valfa = "      No se ha creado el fichero " + NFichero + " Por favor haga la Creacion del Diskette";
         |MENAV  Valfa;
         |ACABA;
     |FINSI;
     |FCIERRA FSalida;

     |HAZ GrabaDisketteV;

     nSwError = 0;
     Fichero     = "/MODELOS/" + eaTipoSec + "/op" + enAnyo + ".txt";
     |XABRE "EC", Fichero, nCanal;
     |SI FSalida ] 0;
        nSwError = 1;
     |FINSI;
|FPRC;

|| ************************************************************************
||                  GRABACION DEL DISKETTE OP
|| ************************************************************************

|PROCESO GrabaDisketteC;
     |HAZ Verificacion;
     |SI nSwError = 1; |HAZ Errores347;  |ACABA;  |FINSI;

     Pos = -1;
     Directorio = "";  |DBASE Directorio;
     Directorio = Directorio + "hacienda/" + aTipoSec;  |MKDIR Directorio;
     Directorio = Directorio + "/";
     NFichero = aNombre;          |QBF NFichero;
     Fichero  = "rt  "+ Directorio + NFichero;

     |FABRE Fichero;
     |SI FSalida < 0;
         Valfa = "      No se ha creado el fichero " + NFichero + " Por favor haga la Creacion del Diskette";
         |MENAV  Valfa;
         |ACABA;
     |FINSI;
     |FCIERRA FSalida;

     Pos = -1;
     |PUSHV 0501 2380;
     |PINPA #1#104;

     E_sup  = 1;
     E_inf  = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
     Unidad = "A";
     Unidad = 0851 ? 0;
     |ATRI I;
     |SI enSwDirecta = 1;
         |PINTA 1616, "Introduzca un diskette formateado en D.O.S. en su PC.";
         |PINTA 1716, "         Pulse una tecla cuando este preparado       ";
     |SINO;
         |PINTA 1616, "Introduzca un diskette formateado en D.O.S. en el Servidor";
         |PINTA 1716, "            Pulse una tecla cuando este preparado         ";
     |FINSI;
     |ATRI i;
     |PINTA 2380, ".";
     |PAUSA;

     Raiz = "";
     |DIRECTORIO Raiz; |QBF Raiz;
     Directorio = "";  |DBASE Directorio;
     Directorio = Directorio + "hacienda/" + aTipoSec;  |MKDIR Directorio;
     Directorio = Directorio + "/";
     Comodin = #0#2; Fichero    = aNombre;
     NFichero   = Fichero;          |QBF NFichero;
     Fichero    = Directorio + NFichero;

     |ATRI P;
     |PINTA 1616, "                       Copiando ...                       ";
     |PINTA 1716, "                                                          ";
     |ATRI p;

     |SI enSwDirecta = 1;
         |POPV;
         eaTipoSec    = aTipoSec;
         eaTipoEmi    = "COPIA";
         eaUnidad     = Unidad;
         eaFichCol    = aNombre;
         |SUB_EJECUTA "eosz9999";

         eaTipoSec    = aTipoSec;
         eaTipoEmi    = "COPIA";
         eaUnidad     = Unidad;
         eaFichCol    = aNomAux;
         |SUB_EJECUTA "eosz9999";
         |ACABA;
     |FINSI;

     |QUE_SISTEMA Sistema;
     |SI Sistema ! "ESDOS";
         Valfa = Raiz + "bin/agcopiaa " + Fichero + " " + Unidad + ":";
         |SYSTEM Valfa;

         Fichero = Directorio + aNomAux;
         Valfa = Raiz + "bin/agcopiaa " + Fichero + " " + Unidad + ":";
         |SYSTEM Valfa;

         |ATRI P;
         |PINTA 1616, "           FICHERO COPIADO !!!!                 ";
         |ATRI p;
         |PAUSA;
     |SINO;
         Valfa1 = Fichero;
         Valfa2 = Unidad + ":" + NFichero;

         |COPIA_FICHERO Valfa1, Valfa2;
         |SI FSalida ! 0;
             Valfa3 = "Error [" + FSalida + "] en copia de ficheros ...";
             |PINTA 1616, Valfa3;
             |PAUSA;
             |POPV;
             |ACABA;
         |FINSI;

         Valfa1  = Directorio + aNomAux;
         Valfa2  = Unidad + ":" + aNomAux;

         |COPIA_FICHERO Valfa1, Valfa2;
         |SI FSalida ! 0;
             Valfa3 = "Error [" + FSalida + "] en copia de ficheros ...";
             |PINTA 1616, Valfa3;
             |PAUSA;
             |POPV;
             |ACABA;
         |FINSI;


         |ATRI P;
         |PINTA 1616, "           FICHERO COPIADO !!!!                 ";
         |ATRI p;
         |PAUSA;
     |FINSI;
     |POPV;
|FPRC;

|| ***********************************************************************
||                       EMISION DE ETIQUETAS
|| ***********************************************************************

|PROCESO Etiquetas;
  |SI #104#14 = 0;
      |MENAV "     Por favor haga la creacion de Diskette.";
      |ACABA;
  |FINSI;

  |PUSHV 0501 2380;

  Comodin = #0#2 % -102; |QBF Comodin;
  Campos1  = Comodin;                                   || Ejercicio
  VAlfa    = #0#17;  VAlfa = ("00" + VAlfa) % -102;
  Campos2  = VAlfa;                                     || Codigo Postal 1
  VAlfa    = #0#18;  VAlfa = ("000" + VAlfa) % -103;
  Campos3  = VAlfa;                                     || Codigo Postal 2

  #104#16 = "Delegacion .........: " + #7#18;
  #104#17 = "Ejercicio ..........: " + Campos1;
  #104#18 = "Modelo .............: 347";
  #104#19 = "Numero Justificante : ";
  #104#20 = "N.I.F. .............: " + #0#9;
  #104#21 = "Nombre : " + #0#3;
  #104#22 = #0#4 + " " + #0#5 + " " + #0#6 + " " + Campos2 + " " + Campos3 + " " + #0#7;
  |SI #0#35 = "C";
     #104#23 = "P.Cont.: " + #0#3;
     #104#24 = "Telefono ...........: " + #0#10 + " " + #0#11;
  |SINO;
     #104#23 = "P.Cont.: " + #caportad#89;
     #104#24 = "Telefono ...........: " + #caportad#90 + " " + #caportad#91;
  |FINSI;
  #104#25 = "Numero total Registros ..: " + #104#14;
  #104#26 = "Densidad soporte : 1,44 MB en Diskettes de 3 1/2";
  #104#27 = "";
  #104#28 = "";
  |C_M #104#27, 1, "N";
  |C_M #104#28, 1, "N";
  |SI #0#35 = "C";
      #104#27 = "Numero total Declarantes : " + #104#15;
      #104#28 = "Numero total Declarados .: " + #104#6;
      |C_M #104#27, 1, "S";
      |C_M #104#28, 1, "S";
  |FINSI;

  |PINPA #2#104;
  |PINDA #2#104;
  |ENDATOS #1#104;
  |SI FSalida = 0;
      |PINPA #2#104;
      |PINDA #2#104;

      |CONFI "2400SRealizar Impresion de la Etiqueta : ";
      |SI FSalida ! 0; |POPV; |ACABA; |FINSI;

      |IMPRE 0;
      |SI FSalida ! 0;  |ACABA;  |FINSI;

      |INFOR "catrasop";
      |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

      |PRINT; |PIEINF; |FININF; |FINIMP;
  |FINSI;
  |POPV;
|FPRC;

|| ***********************************************************************
||                       PROCESO DE DISTRIBUCION
|| ***********************************************************************

|PROCESO Distribuye; |TIPO 3;
  |SI EURODB ! 0;
      eaMoneda = "E";
  |SINO;
      eaMoneda = "P";
  |FINSI;

  enAnyo = #0#2;

  |PINPA #0#0;
  |PINDA #0#0;

  |SI #0#22 = "L";
      Opcion = 1; |HAZ CreacionLaser;
      Opcion = 4; |HAZ GrabaDisketteL;
      |ACABA;
  |FINSI;

  |SI #0#22 = "F"; Opcion = 1; |HAZ Creacion; |ACABA; |FINSI;

  |PARA; |SI Salir = 0; |HACIENDO;
         |MENUG MGeneral;
         MGeneral2 = FSalida;
         Opcion    = MGeneral2;
         Salir     = 1;
         |SI Opcion ] 1; |Y Opcion [ 5;
             Salir = 0;
             |SI Opcion = 1; |HAZ Creacion;       |FINSI;
             |SI Opcion = 2; |HAZ Etiquetas;      |FINSI;
             |SI Opcion = 3; |HAZ GrabaDisketteC; |FINSI;
             |SI Opcion = 4; |HAZ Portada;        |FINSI;
         |FINSI;
  |SIGUE;
|FPRC;

|PROCESO AnalizaCadena;
     |QBF aAlfa;
     |SI aTipo = "N";
        |SI nLongitud = 15;
           Calc = aAlfa; Calc = (Calc / Cambio) ! Redond;

           |SI #caems347#34 = "EUROS  ";  Calc = Calc * 100; |FINSI;
           aAlfa = Calc;
        |FINSI;
        Comodin = "0" * nLongitud;
     |SINO;
        Comodin = " " * nLongitud;
     |FINSI;

     nEspa   = 0;
     aCadena = "";
     aLong   = aAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aAlfa % nPos;
           |SI aCaracter = ",";  aCaracter = "";   nEspa = nEspa + 1;  |FINSI;
         ||  |SI aCaracter = ".";  aCaracter = " ";  |FINSI;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &209; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           |SI aCaracter = "'";  aCaracter = "";   |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     aAlfa = aCadena + (" " * nEspa);

     aAlfa = aAlfa > aAlfa;

     |SI aTipo = "A";
        Calc  = 100 + nLongitud;
        aAlfa = (aAlfa + Comodin) % Calc;
     |SINO;
        Calc  = 0 - (100 + nLongitud);
        aAlfa = (Comodin + aAlfa) % Calc;
     |FINSI;
|FPRC;

|PROCESO QuitaRarosTfno;
     aCadena = "";
     aLong   = aAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aAlfa % nPos;
           |SI aCaracter = "0";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "1";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "2";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "3";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "4";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "5";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "6";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "7";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "8";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "9";  aCadena = aCadena + aCaracter;  |FINSI;
     |SIGUE;
     aAlfa = aCadena;  |QBT aAlfa;
     aAlfa = aAlfa > aAlfa;

     Comodin = "000000000";
     aAlfa = (Comodin + aAlfa) % -109;
|FPRC;

|PROCESO MiraVarMoneda;  |TIPO 0;
     |HAZ PintaMoneda;
     #0#34 = eaMoneda;
     |SI #0#34 = "PESETAS";
         |MENAV "     Obligada la Emision en EUROS, cambien la Moneda en el Menu Ver";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO TipoSop;
   |SI #0#22 = "L";
      #0#35 = "I"; |PINTA #0#35; |C_M #0#35,1,"N";
   |SINO;
      |C_M #0#35,1,"S";
   |FINSI;
|FPRC;
