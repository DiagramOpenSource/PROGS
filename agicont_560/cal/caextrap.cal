|FICHEROS;
  caextrap #0;
  camaasil #1;         || apuntes lins.
  cacuenta #3;         || cuentas
  caextrp2 #4;         || pantalla display
  caextrp5 #5;         || pantalla display II
|FIN;

|VARIABLES;
  mensa1 = "    ATENCION!!! Fecha fuera de periodo ...";
  linea = 0;
  FEstado = 0;
  hay_alguno = 0;
  &entrada = 1;
  &ext1   = "";
  &ext2   = "";
  &d_abajo = 0;
  &h_abajo = 0;
  &s_abajo = 0;
  &runnom = "";
  &espe1 = @;
  &espe2 = @;
  &espe3 = 0;
  &espe4 = 0;
  &espe5 = "";
  &espe6 = "";
  &espe7 = 0;
  &espe8 = 0;
  &espe9 = 0;
  &sino = "";
  alfa1 = "";
  alfa2 = "";
  alfa3 = "";
  alfa4 = "";
  fe1 = @;
  fe2 = @;
|FIN;

|INCLUYE tempo_i;
|INCLUYE acceso_i;
_____________________________________________________________________________
|PROCESO no_dep; |TIPO 7;
  alfa1 = #30#24;
  |CAMPO_MODIFICA #0#7, 1, alfa1;
  |CAMPO_MODIFICA #0#8, 1, alfa1;
|FPRC;

|PROCESO mayusc;
   alfa1 = #0Campo > " ";
   #0Campo = alfa1;
   |PINTA #0Campo;
|FPRC;
_____________________________________________________________________________
|PROGRAMA;
  |DDEFECTO #0;
  #0#0 = ext1;
  |ABRE #3;
  #3#0 = #0#0;
  #3#1 = ext2;
  |LEE 001#3=;
  |SI FSalida ! 0;  |CIERRA #3;  |ACABA;   |FINSI;
  |HAZ inicio;
  |SI runnom ! "caextrax";
      #0#2 = fec1;
      #0#3 = fec2;
  |SINO;
      #0#2 = espe1;
      #0#3 = espe2;
      #0#5 = espe3;
      #0#6 = espe4;
      #0#7 = espe5;
      #0#8 = espe6;
      #0#9 = espe7;
      #0#10 = espe8;
      #0#11 = espe9;
      #0#12 = sino;
  |FINSI;
  #0#4 = #3#2;
  |BLIN 4;
  |SI runnom ! "caextrax";  |PINPA #0#0;    |FINSI;
  |PINDA #0#0;
  |SI runnom ! "caextrax";  |ENDATOS #1#0;  |FINSI;
  |SI FSalida = 0;
      fe1= fec1;
      fe2= fec2;
      |SI #0#12 ="N";
          fe1= #0#2;
          fe2= #0#3;
      |FINSI;
      |SI #0#9 = 1;
           |HAZ impre1;
      |SINO;
           |HAZ impre2;
      |FINSI;
  |FINSI;
  |CIERRA #3;
|FPRO;
_____________________________________________________________________________
|PROCESO buclepan;
  #4#00 = linea;            || linea
  |LEE 101#4=;
  FEstado = FSalida;
  #4#00 = linea;            || linea
  #4#01 = #0#0;             || cuenta
  #4#02 = #0#4;             || descripcion
  #4#03 = #0#2;             || desde fecha
  #4#04 = #0#3;             || hasta fecha
  #4#18 = #1#0;             || diario
  #4#08 = #1#1;             || fecha
  #4#09 = #1#2;             || documento
  #4#19 = #1#3;             || Apunte
  #4#10 = #1#7;             || descripcion
  #4#11 = #1#8;             || signo (no en pantalla!!!)
  |SI #4#11 = "D";
      #4#05 = #4#05 + #1#9; || total debe arriba
      #4#12 = #1#9;         || importe debe
      #4#13 = #4#13 + #1#9; || total saldo detalle
      #4#14 = #4#14 + #1#9; || total debe abajo
      #4#17 = 0;            || importe haber detalle
      d_abajo = d_abajo + #1#9;       || ACUMULADO DEBE FINAL
  |SINO;
      #4#06 = #4#06 + #1#9; || total haber arriba
      #4#12 = 0;            || importe debe
      #4#13 = #4#13 - #1#9; || total saldo detalle
      #4#17 = #1#9;         || importe haber detalle
      h_abajo = h_abajo + #1#9;       || ACUMULADO HABER FINAL
  |FINSI;
  #4#07 = #4#05 - #4#06;    || saldo arriba
  s_abajo = d_abajo - h_abajo;        || SALDO FINAL
  |SI #1#1 ] #0#2;|Y #1#1 [ #0#3;
      hay_alguno = 1;
  |FINSI;
  |SI #1#1 [ #0#3;              || fecha dentro del limite hasta
      |SI FEstado = 0;
          |GRABA 020#4a;
      |SINO;
          |GRABA 020#4n;
      |FINSI;
      |LIBERA #4;
      |SI #1#1 ] #0#2;              || fecha dentro del limite desde
          linea = linea + 1;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE caextrp00;
 #1#3;
 0, 6, 21;
 #0#0, 0, fe1,      1, #0#10, #0#5, #0#7;
 #0#0, 9, fe2, 999999, #0#11, #0#6, #0#8;
 e;
 NULL, buclepan;
|FIN;
_____________________________________________________________________________
|PROCESO impre1;
  linea = 1;
  hay_alguno = 0;
  |HAZ nom_usu;
  alfa1 = "x" + nom_tmp;
  |NOME_DAT #4 alfa1;
  |DELINDEX #4;
  |ABRE #4;
  |BUCLE caextrp00;
  |CIERRA #4;
  |SI #0#12 = "N";
      d_abajo = #3#51;
      h_abajo = #3#52;
      s_abajo = #3#53;
  |FINSI;
  |SI hay_alguno ! 0;
      |ENTLINEAL #1#4, 1, 4, 20, 1, min, max;
  |SINO;
      |MENAV "    Seleccion vacia ...";
  |FINSI;
  |DELINDEX #4;
|FPRC;

|PROCESO min;
  #4#0 = 1;
|FPRC;

|PROCESO max;
  #4#0 = 999999;
|FPRC;

|PROCESO min1;
  #5#0 = 1;
|FPRC;

|PROCESO max1;
  #5#0 = 999999;
|FPRC;
_____________________________________________________________________________
|PROCESO buclepan1;
  #5#00 = linea;            || linea
  |LEE 101#5=;
  FEstado = FSalida;
  #5#00 = linea;            || linea
  #5#01 = #0#0;             || cuenta
  #5#02 = #0#4;             || descripcion
  #5#03 = #0#2;             || desde fecha
  #5#04 = #0#3;             || hasta fecha
  #5#18 = #1#0;             || diario
  #5#08 = #1#1;             || fecha
  alfa2 = #1#1 % 102;
  alfa3 = #1#1 % 402;
  alfa4 = alfa2 + alfa3;
  #5#17 = alfa4;
  #5#09 = #1#2;             || documento
  #5#19 = #1#3;
  #5#10 = #1#7;             || descripcion
  #5#11 = #1#8;             || signo
  #5#12 = #1#9;             || importe debe
  |SI #5#11 = "D";
      #5#05 = #5#05 + #1#9; || total debe arriba
      #5#13 = #5#13 + #1#9; || total saldo detalle
      #5#14 = #5#14 + #1#9; || total debe abajo
      d_abajo = d_abajo + #1#9;       || ACUMULADO DEBE FINAL
  |SINO;
      #5#06 = #5#06 + #1#9; || total haber arriba
      #5#13 = #5#13 - #1#9; || total saldo detalle
||      #5#15 = #5#15 + #1#9; || total deba abajo:
      h_abajo = h_abajo + #1#9;       || ACUMULADO HABER FINAL
  |FINSI;
  #5#07 = #5#05 - #5#06;    || saldo arriba
  s_abajo = d_abajo - h_abajo;        || SALDO FINAL
  |SI #1#1 ] #0#2;|Y #1#1 [ #0#3;
      hay_alguno = 1;
  |FINSI;
  |SI #1#1 [ #0#3;              || fecha dentro del limite hasta
      |SI FEstado = 0;
          |GRABA 020#5a;
      |SINO;
          |GRABA 020#5n;
      |FINSI;
      |LIBERA #5;
      |SI #1#1 ] #0#2;              || fecha dentro del limite desde
          linea = linea + 1;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE caextrp01;
 #1#3;
 0, 6, 21;
 #0#0, 0, fe1,      1, #0#10, #0#5, #0#7;
 #0#0, 9, fe2, 999999, #0#11, #0#6, #0#8;
 e;
 NULL, buclepan1;
|FIN;
_____________________________________________________________________________
|PROCESO impre2;
  linea = 1;
  hay_alguno = 0;
  |HAZ nom_usu;
  alfa1 = "x" + nom_tmp;
  |NOME_DAT #5 alfa1;
  |DELINDEX #5;
  |ABRE #5;
  |BUCLE caextrp01;
  |CIERRA #5;
  |SI #0#12 = "N";
      d_abajo = #3#51;
      h_abajo = #3#52;
      s_abajo = #3#53;
  |FINSI;
  |SI hay_alguno ! 0;
      |ENTLINEAL #1#5, 1, 4, 20, 1, min1, max1;
  |SINO;
      |MENAV "    Seleccion vacia ...";
  |FINSI;
  |DELINDEX #5;
|FPRC;

|PROCESO fechad; |TIPO 0;
  |SI #0#2 < fec1; |O #0#2 > fec2;
      |MENAV mensa1;
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO fechah; |TIPO 0;
  |SI #0#3 < fec1; |O #0#3 > fec2; |O #0#3 < #0#2;
      |MENAV mensa1;
      |ERROR;
  |FINSI;
|FPRC;
_____________________________________________________________________________
||PROCESO acumula;             || CUANDO NO ENTRA EN LA SELECCION DE FECHAS
  ||SI #1#8 = "D";
   ||   #4#5 = #4#5 + #1#9;        || total debe arriba
      ||#4#13 = #4#13 + #1#9;      || saldo detalle
  ||SINO;
   ||   #4#6 = #4#6 + #1#9;        || total haber arriba
     || #4#13 = #4#13 - #1#9;      || saldo detalle
  ||FINSI;
  ||#4#7 = #4#5 - #4#6;            || total saldo arriba
  ||#4#14 = #4#5;                  || total debe abajo
  ||#4#15 = #4#6;                  || total haber abajo
  ||#4#16 = #4#7;                  || saldo abajo
  ||PINTA #4#5;
  ||PINTA #4#6;
  ||PINTA #4#7;
||FPRC;
