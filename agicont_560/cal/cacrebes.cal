|FICHEROS;
    cacrebes #00;   || def de datos
    caagrupa #01;   || agrupaciones
    cacuebal #02;   || cuentas de balance
    caepigra #03;   || epigrafes
    caparbal #04;   || partidas de balance
    caparexp #05;   || partidas de explotacion
    cacuenta #06;   || cuentas
|FIN;

|VARIABLES;
    &entrada = 1;
    &sw_conase4 = 1;
    vari1="rb  ";
    vari2="wb  ";
    fiche="";
    handle="";
    canal= "";
    espacio=" ";
    traba="";
    traba1 = "";
    saber = "";
    menos=-1;
    num = 0;
    field = 0;
    sw_vale = 0;
    FEstado = 0;
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    pepe = 0;
    temporal1 = "";
    temporal2 = "";

  ceros   = "000000000000000";
  blancos = "                                                       ";
  elefe = "";
  ceerre = "";

  contenido = "";
  final = "";
  varalfa = "";
  alfa6 = "";
  alfa7 = "";
  alfa8 = "";
  alfa9 = "";
  alfa10 = "";
  alfa11 = "";
  alfa12 = "";
  alfa13 = "";
  alfa14 = "";
  alfa15 = "";
  alfa16 = "";
  nuevos = "";
  sw_existen = 0;
|FIN;

|INCLUYE acceso_i;

|| ==================== Datos pantalla

|PROCESO mayus; |TIPO 0;
  alfa1 = #0Campo > " ";
  #0Campo = alfa1;
  |PINTA #0Campo;
 || |SI Campo = 1;
 ||     |HAZ repon;
 || |FINSI;
|FPRC;


|PROCESO minus; |TIPO 0;
  alfa1 = #0Campo < " ";
  #0Campo = alfa1;
  |PINTA #0Campo;
  |SI #0Campo [ "   ";
      |ERROR;
      |ACABA;
  |FINSI;
  |ATRI I;
  |PINTA 1524, #0Campo;
  |PINTA 1540, #0Campo;
  |PINTA 1640, #0Campo;
  |PINTA 1556, #0Campo;
  |PINTA 1656, #0Campo;
  |ATRI 0;

  |SI #0#1 = "E";
      |SI #0#0 = "amp"; |O #0#0 = "abr";
          |MENAV "    Extension de los Standard de AGICONT. ";
          |ERROR;
      |FINSI;
  |FINSI;
|FPRC;

|| =======================================================================
|PROCESO primer;
  elefe = &010;
 || ceerre = &013;
 || elefe = ceerre + elefe;
|FPRC;

|PROCESO tipo3;  |TIPO 3;
  |SI #0#2 = "N"; |ACABA; |FINSI;
  |HAZ inicio;

  |QBF fich_alta;
  |SI fich_alta = "";
      |DFICE fich_alta;
  |FINSI;

  |SI #0#1 = "I";
      |HAZ creacion;   || agrupaciones, epigrafes, partidas y cuentas bal.
      |SI sw_existen = 1;
          |CORRE "carecepi.tab";
      |SINO;
          |MENAV "    NO EXISTEN FICHEROS INDICADOS ";
      |FINSI;
  |SINO;
      |HAZ copiarlos;
  |FINSI;
|FPRC;
|| *********************************************************************

|PROCESO gra_agrupa;
  varalfa = "";
  alfa6 = #1#0 + blancos;
  alfa6 = alfa6 % 101;
  alfa7 = blancos + #1#1;
  alfa7 = alfa7 % -102;
  alfa8 = #1#2 + blancos;
  alfa8 = alfa8 % 140;

  varalfa = varalfa + alfa6 + alfa7 + alfa8;
  contenido = handle + espacio + varalfa + elefe;
  |FGRABA contenido;

  saber = "Grabando Agrupacion: " + #1#0 + " " + #1#1 + "                  ";
|PINTA 2211,saber;
|FPRC;

|DEFBUCLE c_agrupa;
 #1#1;
 ;
 " ", 00;
 "z", 99;
 be;
 NULL, gra_agrupa;
|FIN;

|PROCESO gra_epigra;
  varalfa = "";
  alfa6 = #3#0 + blancos;
  alfa6 = alfa6 % 101;
  alfa7 = blancos + #3#1;
  alfa7 = alfa7 % -102;
  alfa8 = #3#2 + blancos;
  alfa8 = alfa8 % 140;
  alfa9 = blancos + #3#3;
  alfa9 = alfa9 % -102;
  alfa10 = #3#4 + blancos;
  alfa10 = alfa10 % 140;

  varalfa = varalfa + alfa6 + alfa7 + alfa8 + alfa9 + alfa10;
  contenido = handle + espacio + varalfa + elefe;
  |FGRABA contenido;

    saber = "Grabando Epigrafe: " + #3#0 + "  " + #3#1 + " " + #3#3 + "        ";
|PINTA 2211,saber;
|FPRC;

|DEFBUCLE c_epigra;
 #3#1;
 ;
 " ", 00, 00;
 "z", 99, 99;
 be;
 NULL, gra_epigra;
|FIN;

|PROCESO gra_parbal;
  varalfa = "";
  alfa6 = #4#0 + blancos;
  alfa6 = alfa6 % 101;
  alfa7 = blancos + #4#1;
  alfa7 = alfa7 % -102;
  alfa8 = #4#2 + blancos;
  alfa8 = alfa8 % 140;
  alfa9 = blancos + #4#3;
  alfa9 = alfa9 % -102;
  alfa10 = #4#4 + blancos;
  alfa10 = alfa10 % 140;
  alfa11 = blancos + #4#5;
  alfa11 = alfa11 % -102;
  alfa12 = #4#6 + blancos;
  alfa12 = alfa12 % 140;

  varalfa = varalfa + alfa6 + alfa7 + alfa8 + alfa9;
  varalfa = varalfa + alfa10 + alfa11 + alfa12;

  contenido = handle + espacio + varalfa + elefe;
  |FGRABA contenido;

    saber = "Gra. Partidas Balance: " + #4#0 + "  " + #4#1 + " " + #4#3 + " " + #4#5 + "       ";
|PINTA 2211,saber;
|FPRC;

|DEFBUCLE c_parbal;
 #4#1;
 ;
 " ", 00, 00, 00;
 "z", 99, 99, 99;
 be;
 NULL, gra_parbal;
|FIN;

|PROCESO gra_parexp;
  varalfa = "";
  alfa6 = blancos + #5#0;
  alfa6 = alfa6 % -101;
  alfa7 = #5#1 + blancos;
  alfa7 = alfa7 % 101;
  alfa8 = blancos + #5#2;
  alfa8 = alfa8 % -102;
  alfa9 = #5#3 + blancos;
  alfa9 = alfa9 % 140;
  alfa10 = blancos + #5#4;
  alfa10 = alfa10 % -102;
  alfa11 = #5#5 + blancos;
  alfa11 = alfa11 % 140;
  alfa12 = blancos + #5#6;
  alfa12 = alfa12 % -102;
  alfa13 = #5#7 + blancos;
  alfa13 = alfa13 % 140;

  varalfa = varalfa + alfa6 + alfa7 + alfa8 + alfa9;
  varalfa = varalfa + alfa10 + alfa11 + alfa12 + alfa13;

  contenido = handle + espacio + varalfa + elefe;
  |FGRABA contenido;

    saber = "Gra. Partidas Explotacion: " + #5#0 + "  " + #5#1 + " " + #5#2 + " " + #5#4 + " " + #5#6;
|PINTA 2211,saber;
|FPRC;

|DEFBUCLE c_parexp;
 #5#1;
 ;
 0, " ", 00, 00, 00;
 9, "z", 99, 99, 99;
 be;
 NULL, gra_parexp;
|FIN;

|PROCESO gra_cuebal;
  varalfa = "";
  alfa6 = #2#0 + blancos;
  alfa6 = alfa6 % 112;
  alfa7 = blancos + #2#1;
  alfa7 = alfa7 % -101;
  alfa8 = #2#2 + blancos;
  alfa8 = alfa8 % 101;
  alfa9 = blancos + #2#3;
  alfa9 = alfa9 % -102;
  alfa10 = blancos + #2#4;
  alfa10 = alfa10 % -102;
  alfa11 = blancos + #2#5;
  alfa11 = alfa11 % -102;

  varalfa = varalfa + alfa6 + alfa7 + alfa8 + alfa9;
  varalfa = varalfa + alfa10 + alfa11;

  contenido = handle + espacio + varalfa + elefe;
  |FGRABA contenido;

    saber = "Grabando Cuenta de Balance: " + #2#0 + "           ";
|PINTA 2211,saber;
|FPRC;

|DEFBUCLE c_cuebal;
 #2#1;
 ;
 "0           ";
 "zzzzzzzzzzzz";
 be;
 NULL, gra_cuebal;
|FIN;

|PROCESO copiarlos;
  |HAZ primer;
  nuevos = "." + #0#0; ||Extension de los ficheros
  |DBASE dir_fich;
  dir_fich=dir_fich + "fich/";

|| ....................................... agrupaciones
  fiche=vari2 + dir_fich + "agrupaci";
  fiche = fiche + nuevos;
  |QBF fiche;
  |FABRE fiche;
  handle = FSalida;
  |SI FSalida ] 0;
      |BUCLE c_agrupa;
  |FINSI;
  FSalida = handle;
  |FCIERRA FSalida;
  Pos = -1;
|| ....................................... epigrafes
  fiche=vari2 + dir_fich + "epigrafe";
  fiche = fiche + nuevos;
  |QBF fiche;
  |FABRE fiche;
  handle = FSalida;
  |SI FSalida ] 0;
      |BUCLE c_epigra;
  |FINSI;
  FSalida = handle;
  |FCIERRA FSalida;
  Pos = -1;
|| ....................................... Partidas Balance
  fiche=vari2 + dir_fich + "parbalan";
  fiche = fiche + nuevos;
  |QBF fiche;
  |FABRE fiche;
  handle = FSalida;
  |SI FSalida ] 0;
      |BUCLE c_parbal;
  |FINSI;
  FSalida = handle;
  |FCIERRA FSalida;
  Pos = -1;
|| ....................................... Partidas Explotacion
  fiche=vari2 + dir_fich + "parexplo";
  fiche = fiche + nuevos;
  |QBF fiche;
  |FABRE fiche;
  handle = FSalida;
  |SI FSalida ] 0;
      |BUCLE c_parexp;
  |FINSI;
  |FCIERRA FSalida;
  FSalida = handle;
  Pos = -1;
|| ....................................... Cuentas a Estructura
  fiche=vari2 + dir_fich + "cuebalan";
  fiche = fiche + nuevos;
  |QBF fiche;
  |FABRE fiche;
  handle = FSalida;
  |SI FSalida ] 0;
      |BUCLE c_cuebal;
  |FINSI;
  |FCIERRA FSalida;
  FSalida = handle;
  Pos = -1;
|FPRC;

|| ************************************************************************

|PROCESO creacion;
  || ... Abrimos uno para ver que existen.
  nuevos = "." + #0#0; ||Extension de los ficheros
  sw_existen = 0;
     |DBASE dir_fich;
     dir_fich=dir_fich + "fich/";
     fiche=vari1 + dir_fich + "agrupaci";
     fiche = fiche + nuevos;
     |QBF fiche;
     |FABRE fiche;
     |SI FSalida ] 0;
         sw_existen = 1;
     |FINSI;
     |FCIERRA handle;
     |SI sw_existen = 0; |ACABA; |FINSI;

|| ...... Procesos de creacion
  |DBASE dir_fich;
  dir_fich=dir_fich + "fich/";

  |PATH_DAT #1 fich_alta;
  |ABRE #1;
  |CIERRA #1;
  |DELINDEX #1;

  |ABRE #1;
    fiche=vari1 + dir_fich + "agrupaci";
    fiche = fiche + nuevos;

  |QBF fiche;
  |FABRE fiche;
  |SI FSalida ] 0;
      handle = FSalida;
      |HAZ seagru;
      |PARA; |SI field > 0; |HACIENDO;
             |HAZ seagru;
      |SIGUE;
      |FCIERRA handle;
  |FINSI;
  |CIERRA #1;
  Pos = menos;

  |DBASE dir_fich;
  dir_fich=dir_fich + "fich/";

  |PATH_DAT #2 fich_alta;
  |ABRE #2;
  |CIERRA #2;
  |DELINDEX #2;
  |ABRE #2;
  fiche=vari1 + dir_fich + "cuebalan";
  fiche = fiche + nuevos;

  |QBF fiche;
  |FABRE fiche;
  |SI FSalida ] 0;
      handle = FSalida;
      |HAZ secueb;
      |PARA; |SI field > 0; |HACIENDO;
             |HAZ secueb;
      |SIGUE;
      |FCIERRA handle;
  |FINSI;
  |CIERRA #2;
  Pos = menos;

  |DBASE dir_fich;
  dir_fich=dir_fich + "fich/";
  |PATH_DAT #3 fich_alta;
  |ABRE #3;
  |CIERRA #3;
  |DELINDEX #3;
  |ABRE #3;
  fiche=vari1 + dir_fich + "epigrafe";
  fiche = fiche + nuevos;

  |QBF fiche;
  |FABRE fiche;
  |SI FSalida ] 0;
      handle = FSalida;
      |HAZ seepig;
      |PARA; |SI field > 0; |HACIENDO;
             |HAZ seepig;
      |SIGUE;
      |FCIERRA handle;
  |FINSI;
  |CIERRA #3;
  Pos = menos;

  |DBASE dir_fich;
  dir_fich=dir_fich + "fich/";
  |PATH_DAT #4 fich_alta;
  |ABRE #4;
  |CIERRA #4;
  |DELINDEX #4;
  |ABRE #4;
  fiche=vari1 + dir_fich + "parbalan";
  fiche = fiche + nuevos;

  |QBF fiche;
  |FABRE fiche;
  |SI FSalida ] 0;
      handle = FSalida;
      |HAZ sebala;
      |PARA; |SI field > 0; |HACIENDO;
             |HAZ sebala;
      |SIGUE;
      |FCIERRA handle;
  |FINSI;
  |CIERRA #4;
  Pos = menos;

  |DBASE dir_fich;
  dir_fich=dir_fich + "fich/";
  |PATH_DAT #5 fich_alta;
  |ABRE #5;
  |CIERRA #5;
  |DELINDEX #5;
  |ABRE #5;
  fiche=vari1 + dir_fich + "parexplo";
  fiche = fiche + nuevos;

  |QBF fiche;
  |FABRE fiche;
  |SI FSalida ] 0;
      handle = FSalida;
      |HAZ seexpl;
      |PARA; |SI field > 0; |HACIENDO;
             |HAZ seexpl;
      |SIGUE;
      |FCIERRA handle;
  |FINSI;
  |CIERRA #5;
  Pos = menos;
|FPRC;

|PROCESO seagru;
    canal = handle + espacio;
    canal = canal + 44;
|FLEE canal;
    field = FSalida;
|SI field [ 0;  |ACABA;  |FINSI;
    traba = canal % 101;
    #1#0 = traba;
    traba = canal % 202;
    #1#1 = traba;
|LEE 101#1=;
|SI FSalida = 0;
    |HAZ seagru1;
    |GRABA 020#1a;
|SINO;
    |DDEFECTO #1;
    |HAZ seagru1;
    |GRABA 020#1n;
|FINSI;
|LIBERA #1;
    saber = "Recuperando Agrupacion: " + #1#0 + " " + #1#1 + "         ";
|PINTA 2211,saber;
|FPRC;

|PROCESO seagru1;
    traba = canal %101;
    #1#0 = traba;
    traba = canal %202;
    #1#1 = traba;
    traba = canal % 440;
    #1#2 = traba;
|FPRC;

|PROCESO secueb;
    canal = handle + espacio;
    canal = canal + 21;
|FLEE canal;
    field = FSalida;
|SI field [ 0;  |ACABA;  |FINSI;
    traba = canal % 112;
    #2#0 = traba;
|LEE 101#2=;
|SI FSalida = 0;
    |HAZ secueb1;
    |GRABA 020#2a;
|SINO;
    |DDEFECTO #2;
    |HAZ secueb1;
    |GRABA 020#2n;
|FINSI;
|LIBERA #2;
    saber = "Recuperando Cuenta de Balance: " + #2#0 + "           ";
|PINTA 2211,saber;
|FPRC;

|PROCESO secueb1;
    traba = canal %112;
    #2#0 = traba;
    traba = canal %1301;
    #2#1 = traba;
    traba = canal % 1401;
    #2#2 = traba;
    traba = canal %1502;
    #2#3 = traba;
    traba = canal %1702;
    #2#4 = traba;
    traba = canal % 1902;
    #2#5 = traba;
|FPRC;

|PROCESO seepig;
    canal = handle + espacio;
    canal = canal + 86;
|FLEE canal;
    field = FSalida;
|SI field [ 0;  |ACABA;  |FINSI;
    traba = canal % 101;
    #3#0 = traba;
    traba = canal % 202;
    #3#1 = traba;
    traba = canal % 4402;
    #3#3 = traba;
|LEE 101#3=;
|SI FSalida = 0;
    |HAZ seepig1;
    |GRABA 020#3a;
|SINO;
    |DDEFECTO #3;
    |HAZ seepig1;
    |GRABA 020#3n;
|FINSI;
|LIBERA #3;
    saber = "Recuperando Epigrafe: " + #3#0 + "  " + #3#1 + " " + #3#3 + "        ";
|PINTA 2211,saber;
|FPRC;

|PROCESO seepig1;
    traba = canal % 101;
    #3#0 = traba;
    traba = canal % 202;
    #3#1 = traba;
    traba = canal % 4402;
    #3#3 = traba;
    traba = canal % 440;
    #3#2 = traba;
    traba = canal % 4640;
    #3#4 = traba;
|FPRC;

|PROCESO sebala;
    canal = handle + espacio;
    canal = canal + 128;
|FLEE canal;
    field = FSalida;
|SI field [ 0;  |ACABA;  |FINSI;
    traba = canal % 101;
    #4#0 = traba;
    traba = canal % 202;
    #4#1 = traba;
    traba = canal % 4402;
    #4#3 = traba;
    traba = canal % 8602;
    #4#5 = traba;
|LEE 101#4=;
|SI FSalida = 0;
    |HAZ sebala1;
    |GRABA 020#4a;
|SINO;
    |DDEFECTO #4;
    |HAZ sebala1;
    |GRABA 020#4n;
|FINSI;
|LIBERA #4;
    saber = "Rec. Partidas Balance: " + #4#0 + "  " + #4#1 + " " + #4#3 + " " + #4#5 + "       ";
|PINTA 2211,saber;
|FPRC;

|PROCESO sebala1;
    traba = canal % 101;
    #4#0 = traba;
    traba = canal % 202;
    #4#1 = traba;
    traba = canal % 4402;
    #4#3 = traba;
    traba = canal % 8602;
    #4#5 = traba;
    traba = canal % 440;
    #4#2 = traba;
    traba = canal % 4640;
    #4#4 = traba;
    traba = canal % 8840;
    #4#6 = traba;
|FPRC;

|PROCESO seexpl;
    canal = handle + espacio;
    canal = canal + 129;
|FLEE canal;
    field = FSalida;
|SI field [ 0;  |ACABA;  |FINSI;
    traba = canal % 101;
    #5#0 = traba;
    traba = canal % 201;
    #5#1 = traba;
    traba = canal % 302;
    #5#2 = traba;
    traba = canal % 4502;
    #5#4 = traba;
    traba = canal % 8702;
    #5#6 = traba;
|LEE 101#5=;
|SI FSalida = 0;
    |HAZ seexpl1;
    |GRABA 020#5a;
|SINO;
    |DDEFECTO #5;
    |HAZ seexpl1;
    |GRABA 020#5n;
|FINSI;
|LIBERA #5;
    saber = "Rec. Partidas Explotacion: " + #5#0 + "  " + #5#1 + " " + #5#2 + " " + #5#4 + " " + #5#6;
|PINTA 2211,saber;
|FPRC;

|PROCESO seexpl1;
    traba = canal % 101;
    #5#0 = traba;
    traba = canal % 201;
    #5#1 = traba;
    traba = canal % 302;
    #5#2 = traba;
    traba = canal % 4502;
    #5#4 = traba;
    traba = canal % 8702;
    #5#6 = traba;
    traba = canal % 540;
    #5#3 = traba;
    traba = canal % 4740;
    #5#5 = traba;
    traba = canal % 8940;
    #5#7 = traba;
|FPRC;

|PROCESO cuadro; |TIPO 7;
 |PUSHV 1010 1664;
  |CUADRO 1010 1663;
  |ATRI R;
  |PINTA 1111, " (E) Pasar los Ficheros de Balances de Esta Empresa ";
  |PINTA 1211, " a secuenciales para recogerlos en otra Empresa.    ";
  |PINTA 1311, "----------------------------------------------------";
  |PINTA 1411, " (I) Crear los Ficheros de Balance en Esta Empresa  ";
  |PINTA 1511, " a partir de los seleccionados.                     ";
  |ATRI r;
|FPRC;

|PROCESO repon; |TIPO 0;
 |POPV;
|FPRC;
