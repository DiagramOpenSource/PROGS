|FICHEROS;
   cabucemp #0;
   cabucem1 #1;

   canempre #30;
   caportad #3;
|FINSI;

|VARIABLES;
   nCont  = 0;
   Campo1 = 0;
   Campo2 = 0;

   EmpreAnt = 0;
   PerioAnt = 0;

   DEmpresa = 0; DPeriodo = 0;
   HEmpresa = 0; HPeriodo = 0;
|FIN;

|PROCESO AntesEmp;
   Campo1 = Campo + 1;
   EmpreAnt = #cabucemp#Campo#;
   PerioAnt = #cabucemp#Campo1#;
|FPRC;

|PROCESO TrasEmp;
   |SI FSalida = 2; |ACABA; |FINSI;
   |SI #cabucemp#64 = "S"; |ACABA; |FINSI;
   Campo1 = Campo - 1; Campo2 = Campo + 1;
   |SI #cabucemp#Campo1# = 0; |PTEC 806; |ACABA; |FINSI;
   |SI EmpreAnt = #cabucemp#Campo#; |Y PerioAnt = #cabucemp#Campo1#;
      |ACABA;
   |FINSI;

   #canempre#2 = #cabucemp#Campo1#;
   #canempre#3 = #cabucemp#Campo#;
   |LEE 000#canempre.=;
   |SI FSalida = 0; |Y #cabucemp#Campo1# ! 0;
      #cabucemp#Campo2# = #canempre#1; |PINTA #cabucemp#Campo2#;
   |SINO;
      |MENAV "    Empresa inexistente"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO Seleccion;
   |SI #cabucemp#64 = "S";
      |C_M #cabucemp#0,1,"S"; |C_M #cabucemp#1,1,"S";
      |C_M #cabucemp#2,1,"S"; |C_M #cabucemp#3,1,"S";
      |PARA nCont = 4; |SI nCont [ 63; |HACIENDO nCont = nCont + 3;
         |C_M #cabucemp#nCont#,1,"N"; nCont = nCont + 1;
         |C_M #cabucemp#nCont#,1,"N"; nCont = nCont - 1;
      |SIGUE;
   |SINO;
      |C_M #cabucemp#0,1,"N"; |C_M #cabucemp#1,1,"N";
      |C_M #cabucemp#2,1,"N"; |C_M #cabucemp#3,1,"N";
      |PARA nCont = 4; |SI nCont [ 63; |HACIENDO nCont = nCont + 3;
         |C_M #cabucemp#nCont#,1,"S"; nCont = nCont + 1;
         |C_M #cabucemp#nCont#,1,"S"; nCont = nCont - 1;
      |SIGUE;
   |FINSI;
|FPRC;

|PROCESO Empresas;
   |DDEFECTO #cabucem1;
   #cabucem1#0 = #canempre#2;
   #cabucem1#1 = #canempre#3;
   |GRABA 020#cabucem1.n;
|FPRC;

|DEFBUCLE Empresas;
#canempre#1;
;
DEmpresa,DPeriodo;
HEmpresa,HPeriodo;
;
NULL,Empresas;
|FIN;

|PROGRAMA;
   |CLS;
   |PINPA #0#0; |PINDA #0#0;
   |DELINDEX #cabucem1; |ABRE #cabucem1; |ABRE #canempre;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |SI #cabucemp#64 = "S";
         DEmpresa = #cabucemp#0; DPeriodo = #cabucemp#1;
         HEmpresa = #cabucemp#2; HPeriodo = #cabucemp#3;
         |BUCLE Empresas;
      |SINO;
         |PARA nCont = 4; |SI nCont [ 63; |HACIENDO nCont = nCont + 3;
            Campo1 = nCont + 1;
            DEmpresa = #cabucemp#nCont#; DPeriodo = #cabucemp#Campo1#;
            HEmpresa = #cabucemp#nCont#; HPeriodo = #cabucemp#Campo1#;
            |BUCLE Empresas;
         |SIGUE;
      |FINSI;
   |FINSI;
   |CIERRA #canempre; |CIERRA #cabucem1;
|FPRO;
