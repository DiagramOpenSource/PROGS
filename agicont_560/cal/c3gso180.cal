|FICHEROS;
     c3gso180 #0;
     caportad #1;
     canempre #30;
     cat18001 #2;
     cat18002 #11;
     caman115 #20;
     caportad #1;
     cat18003 #104;

     c3gem180 #900;
|FIN;

|VARIABLES;

      nCalc       = 0;
      nLong       = 0;
      nPos        = 0;
      nVarCampo1  = 0;
      nVarCampo1T = 0;
      nVarCampo2  = 0;
      nVarCampo2T = 0;
      nSwError    = 0;
      nLeidos     = 0;
      nDesde      = 0;
      nHasta      = 0;
      FEstado     = 0;
      nSwAcumula  = 0;
      nPag        = 0;
      s1          = 0;
      s2          = 0;
      b1          = 0;
      b2          = 0;
      r1          = 0;
      r2          = 0;
      nSwTraba    = 0;
      nYaEsta1    = 0;
      nYaEsta2    = 0;
      nMeses      = 0;
      nCampoBase  = 0;
      nCampoRete  = 0;
      nCampoBase1 = 0;
      nCampoBase2 = 0;
      nCampoRete1 = 0;
      nCampoRete2 = 0;
      nSwBusca    = 0;
      Calc        = 0;
      Calc1       = 0;
      NCar        = 0;

      aCadena     = "";
      aLong       = "";
      aCaracter   = "";
      aFichOrigen = "";
      aFichDestin = "";
      Maneja      = "";
      Tipo        = "";
      Comodin     = "";
      Comodin1    = "";
      aEjerc      = "";
      aDirFich    = "";
      aAlfa       = "";
      aDCla       = "";
      aHCla       = "";
      aAlfa1      = "";
      aAlfa2      = "";
      aAlfa3      = "";
      nume1       = 0;

     &r_emp       = 0;
     &r_per       = 0;
     &clave       = "";
     &tb          = 0;
     &tr          = 0;
     &te          = 0;
     &hoja        = 0;
     &linea       = 0;
     &tothojas    = 0;
     &cp1         = "";
     &cp2         = "";

     MaxOpc     = 0;
     dv         = 0;
     tb2        = 0;
     ttb2        = 0;
     tr2        = 0;
     ttr2        = 0;
     sg         = "";
     fiche = "";
     regis = "";
     blancos = "";
     caden = "";
     unida = "";
     treten = 0;
     tperce = 0;
     dire = "";
     sistem = "";
     SwLaser = 0;

     CampoDni   = "";
     LetrasNif  = "TRWAGMYFPDXBNJZSQVHLCKE";
     Letra1     = "";
     Letra2     = "";
     Letra3     = "";
     Letra4     = "";
     Letra5     = "";
     Letra6     = "";
     Letra7     = "";
     Letra8     = "";
     Caracter   = "";
     Carac1     = 0;
     Carac2     = 0;
     Carac3     = 0;
     Carac4     = 0;
     Carac5     = 0;
     ModoModi   = "";
     Salir      = 0;
     Opcion     = 0;
     SwLee      = 0;
     NEmpresa   = 0;

||     Variable    = "";
||     Sesion      = "";
||     XPara      = 0;
||     NACopiar   = 0;
||     Unidad     = "";
||     Raiz       = "";
||     Sistema    = "";
||     DirectorioD = "";
||     nCampo      = 0;
||     Handle     = "";
||     NFichero   = "";
||     Fichero    = "";
||     Directorio = "";
||     Empresa    = "";
||     aTipoSec  = "";
||{500}NEmpresas = "";

     Fichero1   = "";
     FicheroD   = "";
     VAlfa      = "";
     VAlfa1     = "";
     VAlfa2     = "";
     VAlfa3     = "";
     VAlfa4     = "";
     Path        = "";
     Reper       = "";

     Punto01     = 0;
     Punto02     = 0;
     Punto03     = 0;
     Punto04     = 0;
     Punto05     = 0;

     &impreso  = "";
     &sopindi  = "";
     &sopcole  = "";
     &cinta    = "";
     &disco    = "";
     &locali   = "";
     &sf       = "";
     &pp       = 0;

{-1} MGeneral   = "";
     MGeneral1  = "1660";
     MGeneral2  = "1";
     MGeneral3  = "4";
     MGeneral4  = "Creacion  Diskette ";
     MGeneral5  = "Emision   Portada  ";
     MGeneral6  = "Etiqueta  Diskette ";
     MGeneral7  = "Grabacion Diskette ";
     MGeneral8  = "";

|FIN;

|INCLUYE acceso_i;
|INCLUYE i_laserc;

|| *************************************************************************
||                        CALCULOS DE PANTALLA
|| *************************************************************************

|PROCESO Defecto; |TIPO 7;
     #0#0 = cod2;
     |PINTA #0#0;
|FPRC;

|PROCESO Consulta;
     |SI FSalida ! 9;  |ACABA;  |FINSI;

     |SUB_EJECUTA "caconemp.run";
     |ERROR;

     |SI Campo = 5;
         #0#5 = r_emp;
         #0#7 = r_per;
         |PTEC 802;
         |PTEC 802;
     |FINSI;

     |SI Campo = 6;
         #0#6 = r_emp;
         #0#8 = r_per;
         |PTEC 802;
     |FINSI;

     |SI Campo ] 9;
         #0Campo = r_emp;
         nVarCampo1   = Campo + 20;
         #0nVarCampo1 = r_per;
         |PTEC 802;
         |PTEC 802;
     |FINSI;
|FPRC;

|PROCESO Mayus;
     #0Campo = #0Campo > #0Campo;
     |PINTA #0Campo;
|FPRC;

|PROCESO Mayus1;
     |HAZ Mayus;
     |SI #0Campo = "N";
         |PARA nVarCampo1 = 9;  |SI nVarCampo1 [ 48;  |HACIENDO nVarCampo1 = nVarCampo1 + 1;
               |C_M #0nVarCampo1,1,"S";
         |SIGUE;

         |C_M #0#5,1,"N";  #0#5 = 0;  |PINTA #0#5;
         |C_M #0#7,1,"N";  #0#7 = 0;  |PINTA #0#7;
         |C_M #0#6,1,"N";  #0#6 = 0;  |PINTA #0#6;
         |C_M #0#8,1,"N";  #0#8 = 0;  |PINTA #0#8;
      |SINO;
         |PARA nVarCampo1 = 9;  |SI nVarCampo1 [ 48;  |HACIENDO nVarCampo1 = nVarCampo1 + 1;
               #0nVarCampo1 = 0;
               |C_M #0nVarCampo1,1,"N";
         |SIGUE;

         |C_M #0#5,1,"S";
         |C_M #0#7,1,"S";
         |C_M #0#6,1,"S";
         |C_M #0#8,1,"S";
  |FINSI;
|FPRC;

|PROCESO Relleno;
     |SI Campo = 78;
         VAlfa = #0Campo; |QBT VAlfa;
         VAlfa = ("00000" + VAlfa) % -105;
     |FINSI;

     |SI Campo = 84;
         VAlfa = #0Campo; |QBT VAlfa;
         VAlfa = (VAlfa + "   ") % 103;
     |FINSI;

     |SI Campo = 85;
         VAlfa = #0Campo; |QBT VAlfa;
         VAlfa = ("0000000" + VAlfa) % -107;
     |FINSI;

     |SI Campo = 92;
         VAlfa = #0Campo; |QBT VAlfa;
         VAlfa = ("000000000" + VAlfa) % -109;
     |FINSI;

     #0Campo = VAlfa;  |PINTA #0Campo;
|FPRC;

|| --------------- comprueba desde-hasta empresas ---------------------------

|PROCESO BuscaEmpresa;
     |SI #30#21 = "I"; |ACABA; |FINSI;

     |SI #30#26 ! #0#0;
         nSwError = 3;
         |ACABA;
     |FINSI;

     aDirFich = "";
     |DBASE aDirFich;
     aDirFich = aDirFich + "fich/" + (("00000" + #30#2) % -105) + (("0" + #30#3) % -101) + "/";

     || aqui estaba el path

     || aqui estaba la lectura

     nLeidos = 1;
|FPRC;

|DEFBUCLE canempre_1;
     #30#1;
     ;
     #0#5, nDesde;
     #0#6, nHasta;
     ;
     NULL, BuscaEmpresa;
|FIN;

|PROCESO BucleEmpresa;
     |SI #0#7 > #0#8;
         |MENAV "     ERROR EN INTRODUCCION";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #0#5 = 0;  |Y #0#6 = 0;  |ACABA;  |FINSI;

     nDesde  = #0#7;
     nHasta  = #0#8;
     nLeidos = 0;
     |BUCLE canempre_1;
     |SI nLeidos = 0;
         |MENAV "    ATENCION SELECCION VACIA";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO DesdeHasta;
     |SI #0#6 < #0#5;
         |MENAV "      Error en Introduccion";
         |ERROR;
     |FINSI;
|FPRC;

|| ------------------------------------------------------------------------

|PROCESO Nomodifica;
     |PARA nVarCampo1 = Campo + 1;  |SI nVarCampo1 [ 28;  |HACIENDO nVarCampo1 = nVarCampo1 + 1;
                                          #0nVarCampo1 = 0;  |C_M #0nVarCampo1,1,"N";
           nVarCampo2 = nVarCampo1 + 20;  #0nVarCampo2 = 0;  |C_M #0nVarCampo2,1,"N";
     |SIGUE;
     nVarCampo2 = Campo + 20; #0nVarCampo2 = 0;  |C_M #0nVarCampo2,1,"N";  |PINTA #0nVarCampo2;
|FPRC;

|PROCESO EsBuena; || desde campo de empresas seleccion
     |SI FSalida = 2; |ACABA; |FINSI;
     |SI #0Campo = 0; |HAZ Nomodifica;  |ACABA;  |FINSI;

     |ABRE #30;
     #30#2 = #0Campo;
     #30#3 = 0;
     |LEE 011#30];
     |SI FSalida ! 0;  |O #30#2 ! #0Campo;
         |MENAV "     NO Existe la empresa Contable";
         |ERROR;
     |FINSI;
     |CIERRA #30;
|FPRC;

|PROCESO EsBuena1;
     |SI FSalida = 2;|ACABA;|FINSI;

     nVarCampo1 = Campo - 20;
     |SI #0nVarCampo1 = 0;  |ACABA;  |FINSI;

     |ABRE #30;
     nVarCampo1 = Campo - 20;
     #30#2 = #0nVarCampo1;
     #30#3 = #0Campo;
     |LEE 011#30=;
     |SI FSalida ! 0;
         |MENAV "     NO Existe Periodo en la empresa Contable";
         |CIERRA #30;
         |ERROR;
         |ACABA;
     |FINSI;
     |CIERRA #30;

     |SI #30#21 = "I";
         |MENAV "       Empresa Contable Inactiva";
         |ERROR;
         |ACABA;
     |FINSI;

     nLeidos = 0;
     |HAZ BuscaEmpresa;
     |SI nLeidos = 0;
         |SI nSwError = 1;
             |MENAV "     No existe Modelo 390";
         |FINSI;

         |SI nSwError = 2
             |MENAV "0000No se encuentra el fichero de control Datos Fijos";
         |FINSI;

         |SI nSwError = 3;
             |MENAV "     El a¤o contable NO corresponde ";
         |FINSI;
         |ERROR;
         |ACABA;
     |FINSI;

     nVarCampo1 = Campo + 20;  #0nVarCampo1 = #30#1;  |PINTA #0nVarCampo1;
     nVarCampo1 = Campo - 20;
|FPRC;

|PROCESO LetraDni;
     |QBF CampoDni;  Letra2 = CampoDni;  |QBT Letra2;

     Caracter = Letra2 % 101;
     |SI Caracter ! "A"; |Y Caracter ! "B"; |Y Caracter ! "C"; |Y Caracter ! "D";
      |Y Caracter ! "E"; |Y Caracter ! "F"; |Y Caracter ! "G"; |Y Caracter ! "P";
      |Y Caracter ! "Q"; |Y Caracter ! "S"; |Y Caracter ! "X";
         Letra4 = "";
         Letra3 = Letra2 % 0;
         Carac2 = Letra3;
         |PARA Carac5 = 1;  |SI Carac5 [ Carac2;  |HACIENDO Carac5 = Carac5 + 1;
               Carac3 = (Carac5 * 100) + 1;
               Letra3 = Letra2 % Carac3;
               |SI Letra3 = "0"; |O Letra3 = "1"; |O Letra3 = "2"; |O Letra3 = "3";
                |O Letra3 = "4"; |O Letra3 = "5"; |O Letra3 = "6"; |O Letra3 = "7";
                |O Letra3 = "8"; |O Letra3 = "9";
                   Letra4 = Letra4 + Letra3;
               |FINSI;
         |SIGUE;

         Carac4 = Letra4;
         |SI Carac4 ! 0; |Y Letra4 ! "";
             Carac1 = Carac4 $ 23;
             Carac1 = Carac1 + 1;
             Carac3 = (Carac1 * 100) + 1;
             Letra1 = LetrasNif % Carac3;
             Letra4 = ("000000000" + Letra4 + Letra1) % -109;
             CampoDni = Letra4;
         |FINSI;
     |FINSI;
     CampoDni = ("000000000" + CampoDni) % -109;
|FPRC;

|| ****************************
|| CREACION DE LOS SECUENCIALES
|| ****************************

|PROCESO magnetico9;
     aAlfa1   = caden % 0;
     nume1   = aAlfa1;
     nume1   = 185 - nume1;      || ajusta a 185 posiciones
     blancos = " " * nume1;
     caden   = caden + blancos;
     caden   = Handle + " " + caden;
     caden   = caden + &#0#93 + &#0#94;         || caract. final de linea
     |FGRABA caden;
     |SI FSalida < 185;|O FSalida > 187;
         aAlfa2 = "    Error grabando secuencial: " + FSalida;
         |MENAV aAlfa2;
     |SINO;
         |SI regis = "1";  treten = treten + 1;  |FINSI;    || total retenedores
         |SI regis = "2";  tperce = tperce + 1;  |FINSI;    || total perceptores
     |FINSI;
     #104#14 = #104#14 + 1;
|FPRC;

|PROCESO magnetico0;     || registro tipo 0 'presentador'
     regis = "0";
     caden = "0";                                || tipo de registro (1)
     caden = caden + "180";                      || modelo 180       (3)
     caden = caden + aEjerc;                     || aEjercicio        (4)
     caden = caden + (("00" + #0#12) % -102);    || delegacion       (2)
     caden = caden + #0#83;                      || nif              (9)
     caden = caden + #0#75;                      || razon social     (40)
     caden = caden + #0#76;                      || cl               (2)
     caden = caden + (#0#77 % 120);              || calle            (20)
     caden = caden + #0#78;                      || numero           (5)
     caden = caden + "  ";                       || Escalera         (2)
     caden = caden + "  ";                       || Piso             (2)
     caden = caden + "  ";                       || Puerta           (2)
     caden = caden + (("00"  + #0#79) % -102);   || Codigo provincia (2)
     caden = caden + (("000" + #0#80) % -103);   || Codigo poblacion (3)
     caden = caden + (#0#81 % 112);              || municipio        (12)
     caden = caden + "00000";                    || retenedores, lo regraba al final     (5)
     caden = caden + "000000000";                || perceptores, lo regraba al final     (9)
     caden = caden + "D";                        || tipo presentacion (diskette)    (1)
     caden = caden + #0#92;                      || Telefono         (9)
     caden = caden + #0#91;                      || Persona Contacto (40)
     |HAZ magnetico9;
|FPRC;

|PROCESO magnetico1;     || registro tipo 1 'retenedor'
     |ATRI I; |PINTA 0772, #1#0; |ATRI 0;

     regis = "1";
     caden = "1";                                || tipo de registro    (1)
     caden = caden + "180";                      || modelo 180          (3)
     caden = caden + aEjerc;                      || aEjercicio           (4)
     caden = caden + (("00" + #1#18) % -102);    || delegacion          (2)
     CampoDni = #1#13;  |HAZ LetraDni;
     caden = caden + CampoDni;                   || nif                 (9)
     caden = caden + #1#2;                       || razon social        (40)
     aAlfa1 = ("00000000000" + #11#19) % -109;
     caden = caden + aAlfa1;                      || perceptores         (9)
     |SI #11#20 < 0;
         caden = caden + "N";    ttb2 = -#11#20;  ttr2 = -#11#21;
     |SINO;
         caden = caden + " ";    ttb2 = #11#20;   ttr2 = #11#21;
     |FINSI;
     aAlfa1 = ("000000000000000" + ttb2) % -115;
     caden = caden + aAlfa1;                      || retribuciones       (15)
     aAlfa1 = ("000000000000000" + ttr2) % -115;
     caden = caden + aAlfa1;                      || retenciones         (15)
     |SI #11#22 < 0;
         caden = caden + "N";    nume1 = -#11#22;
     |SINO;
         caden = caden + " ";    nume1 = #11#22;
     |FINSI;
     aAlfa1 = ("000000000000000" + nume1) % -115;
     caden = caden + aAlfa1;                      || retrib.en especie   (15)
     aAlfa1 = ("000000000000000" + #11#23) % -115;
     caden = caden + aAlfa1;                      || ingresos a cuenta   (15)
     caden = caden + "D";                        || tipo presentacion (diskette)

     |SI #0#70 ! "C";
         caden = caden + #0#92;                  || Telefono
         caden = caden + #0#91;                  || Persona Contacto
     |FINSI;

     Punto01 = Punto01 + #11#19;
     Punto02 = Punto02 + #11#20;
     Punto03 = Punto03 + #11#21;
     Punto04 = Punto04 + #11#22;
     Punto05 = Punto05 + #11#23;

     |HAZ magnetico9;
|FPRC;

|PROCESO magnetico2;     || registro tipo 2 'perceptor'
     regis = "2";
     caden = "2";                                    || tipo de registro (1)
     caden = caden + "180";                          || modelo 180       (3)
     caden = caden + aEjerc;                          || aEjercicio        (4)
     caden = caden + (("00" + #1#16) % -102);        || delegacion       (2)
     CampoDni = #1#13;  |HAZ LetraDni;
     caden = caden + CampoDni;                       || nif retenedor    (9)
     |SI clave = "1";  clave = "A";  |FINSI;
     |SI clave = "2";  clave = "B";  |FINSI;
     caden = caden + clave;                          || clave perceptora (1)
     CampoDni = #2#7;  |HAZ LetraDni;
     caden = caden + CampoDni;                       || nif perceptor    (9)
     caden = caden + #2#133;                         || Representante    (1)
     caden = caden + #2#3;                           || apellidos,nombre (40)

     |SI #2#5 = 99;      || con 99 reside en el extranjero
         aAlfa1 = ("00"  + #2#5) % -102;
         aAlfa2 = ("000" + #2#6) % -103;
     |SINO;
         aAlfa1 = ("00"  + #2#5) % -102;
         aAlfa2 = "000";
     |FINSI;
     caden = caden + aAlfa1 + aAlfa2;                  || codigo postal    (5)

     |SI tb ] 0;
         sg  = " ";  tb2 = tb;   tr2 = tr;
     |SINO;
         sg  = "N";  tb2 = -tb;  tr2 = -tr;
     |FINSI;
     caden = caden + sg;                             || signo (1)
     aAlfa1 = ("000000000000000" + tb2) % -115;
     caden = caden + aAlfa1;                          || retribuciones    (15)
     aAlfa1 = ("000000000000000" + tr2) % -115;
     caden = caden + aAlfa1;                          || retencion   (15)
     caden = caden + "0000";                         || aEjercicio devengo (4)

     |HAZ magnetico9;
|FPRC;

|PROCESO magnetico20009;
     aAlfa1   = caden % 0;
     nume1   = aAlfa1;
     nume1   = 250 - nume1;      || ajusta a 185 posiciones
     blancos = " " * nume1;
     caden   = caden + blancos;
     caden   = Handle + " " + caden;
     caden   = caden + &#0#93 + &#0#94;         || caract. final de linea
     |FGRABA caden;
     |SI FSalida < 250;|O FSalida > 252;
         aAlfa2 = "    Error grabando secuencial: " + FSalida;
         |MENAV aAlfa2;
     |SINO;
         |SI regis = "1";  treten = treten + 1;  |FINSI;    || total retenedores
         |SI regis = "2";  tperce = tperce + 1;  |FINSI;    || total perceptores
     |FINSI;
     #104#14 = #104#14 + 1;
|FPRC;

|PROCESO magnetico20000;     || registro tipo 0 'presentador' soporte 2000
     regis = "0";
     caden = "0";                                || tipo de registro (1)
     caden = caden + "180";                      || modelo 180       (3)
     caden = caden + aEjerc;                     || aEjercicio        (4)
     caden = caden + #0#83;                      || nif              (9)
     aAlfa = #0#75; nLongi = 40; |HAZ QuitaComas;
     caden = caden + aAlfa;                      || razon social     (40)
     caden = caden + #0#76;                      || cl               (2)
     caden = caden + (#0#77 % 120);              || calle            (20)
     caden = caden + #0#78;                      || numero           (5)
     caden = caden + "  ";                       || Escalera         (2)
     caden = caden + "  ";                       || Piso             (2)
     caden = caden + "  ";                       || Puerta           (2)
     caden = caden + (("00"  + #0#79) % -102);   || Codigo provincia (2)
     caden = caden + (("000" + #0#80) % -103);   || Codigo poblacion (3)
     caden = caden + (#0#81 % 112);              || municipio        (12)
     caden = caden + (("00"  + #0#79) % -102);   || Codigo provincia (2)
     caden = caden + "00000";                    || retenedores, lo regraba al final     (5)
     caden = caden + "000000000";                || perceptores, lo regraba al final     (9)
     caden = caden + "D";                        || tipo presentacion (diskette)    (1)
     caden = caden + #0#92;                      || Telefono         (9)
     aAlfa = #0#91; nLongi = 40; |HAZ QuitaComas;
     caden = caden + aAlfa;                      || Persona Contacto (40)
     |HAZ magnetico20009;
|FPRC;

|PROCESO magnetico20001;     || registro tipo 1 'retenedor' soporte 2000
     |ATRI I; |PINTA 0772, #1#0; |ATRI 0;

     regis = "1";
     caden = "1";                                || tipo de registro    (1)
     caden = caden + "180";                      || modelo 180          (3)
     caden = caden + aEjerc;                      || aEjercicio           (4)
     CampoDni = #1#13;  |HAZ LetraDni;
     caden = caden + CampoDni;                   || nif                 (9)
     aAlfa = #1#2; nLongi = 40; |HAZ QuitaComas;
     caden = caden + aAlfa;                      || razon social        (40)
     caden = caden + "D";                        || Tipo de soporte     (1)
     caden = caden + #0#92;                      || Telefono            (9)
     aAlfa = #0#91; nLongi = 40; |HAZ QuitaComas;
     caden = caden + aAlfa;                      || Persona Contacto    (40)
     Comodin = "1800000000000";
     caden = caden + Comodin;                    || N§ justificante
     caden = caden + "  0000000000000";          || Declaracion sustitutiva

     aAlfa1 = ("00000000000" + #11#19) % -109;
     caden = caden + aAlfa1;                      || perceptores         (9)

     nume1 = #11#20 + #11#22; ttr2 = #11#21 + #11#23;
     |SI nume1 < 0;
         caden = caden + "N";
         nume1 = -nume1;  ttr2 = -ttr2;
     |SINO;
         caden = caden + " ";
     |FINSI;
     aAlfa1 = ("000000000000000" + nume1) % -115;
     caden = caden + aAlfa1;                      || retribuciones       (15)
     aAlfa1 = ("000000000000000" + ttr2) % -115;
     caden = caden + aAlfa1;                      || retenciones         (15)

     Punto01 = Punto01 + #11#19;
     Punto02 = Punto02 + #11#20;
     Punto03 = Punto03 + #11#21;
     Punto04 = Punto04 + #11#22;
     Punto05 = Punto05 + #11#23;

     |HAZ magnetico20009;
|FPRC;

|PROCESO magnetico20002;     || registro tipo 2 'perceptor' soporte 2000
     regis = "2";
     caden = "2";                                    || tipo de registro (1)
     caden = caden + "180";                          || modelo 180       (3)
     caden = caden + aEjerc;                          || aEjercicio        (4)
     CampoDni = #1#13;  |HAZ LetraDni;
     caden = caden + CampoDni;                       || nif retenedor    (9)
     CampoDni = #2#7;  |HAZ LetraDni;
     Comodin = " " * 9;
     |SI #2#133 = " ";
        caden = caden + CampoDni;                    || nif perceptor     (9)
        caden = caden + Comodin;                     || nif representante (9)
     |SINO;
        caden = caden + Comodin;                     || nif perceptor     (9)
        caden = caden + CampoDni;                    || nif representante (9)
     |FINSI;
     aAlfa = #2#3; nLongi = 40; |HAZ QuitaComas;
     caden = caden + aAlfa;                          || apellidos,nombre (40)
     aAlfa1 = ("00" + #2#5) % -102;
     caden = caden + aAlfa1;                         || Codigo Provincial (2)
     caden = caden + clave;

     |SI tb ] 0;
         sg  = " ";  tb2 = tb;   tr2 = tr;
     |SINO;
         sg  = "N";  tb2 = -tb;  tr2 = -tr;
     |FINSI;
     caden = caden + sg;                             || signo (1)
     aAlfa1 = ("0000000000000" + tb2) % -113;
     caden = caden + aAlfa1;                          || retribuciones    (15)

/*
     Calc = (tr2 * 100) / tb2;
     |SI Calc ] 17; |Y Calc [ 19; Calc = 18;  |FINSI;
     |SI Calc ] -1; |Y Calc [ 1;  Calc = 0;   |FINSI;
     |SI Calc ] 8;  |Y Calc [ 10; Calc = 9;   |FINSI;
     |SI Calc ] 14; |Y Calc [ 16; Calc = 15;  |FINSI;
     |SI Calc ] 6;  |Y Calc [ 9;  Calc = 7.5; |FINSI;
*/
     |SI clave = "1"; Calc = #20#9;  |FINSI;
     |SI clave = "2"; Calc = #20#10; |FINSI;

     Calc1 = (Calc - 0.5) ! 0;
     Comodin = ("00" + Calc1) % -102; caden = caden + Comodin;
     Calc1 = (Calc - Calc1) * 100; Comodin = Calc1; Comodin = Comodin - ".";
     Comodin = ("00" + Comodin) % -102; caden = caden + Comodin;

     aAlfa1 = ("0000000000000" + tr2) % -113;
     caden = caden + aAlfa1;                          || retencion   (15)
     caden = caden + "0000";                         || aEjercicio devengo (4)

     |HAZ magnetico20009;
|FPRC;

|PROCESO magnetico;      || abre el fichero
     |DFICE fiche;
     fiche = "wb  " + fiche + "RTPA" + aEjerc;
     |FABRE fiche;
     FEstado = FSalida;
     Handle = FEstado;
|FPRC;

|| **********************************************************************
||                       CALCULOS DE IMPRESION
|| **********************************************************************

|PROCESO QuitaComas;
     |QBF aAlfa;
     aCadena = "";
     aLong   = aAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aAlfa % nPos;
           |SI aCaracter = ",";  aCaracter = " ";  |FINSI;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &209; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     Comodin = " " * nLongi; nCalc = 100 + nLongi;
     aCadena = (aCadena + Comodin) % nCalc;
     aAlfa = aCadena;
|FPRC;

|PROCESO GrabaTempo1;
     |DDEFECTO #2;
     #2#0  = #20#0;
     #2#7  = #20#7;       || dni
     |LEE 101#2=;
     FEstado = FSalida;

     |PARA nCampo = 0; |SI nCampo [ 133; |HACIENDO nCampo = nCampo + 1;
           nSwAcumula = 0;
           |SI nCampo ]  23; |Y nCampo [ 126;  nSwAcumula = 1;  |FINSI;
           |SI nSwAcumula = 0;
               #2nCampo = #20nCampo;
           |SINO;
               #2nCampo = #2nCampo + #20nCampo;
           |FINSI;
     |SIGUE;

     #2#0   = #20#0;
     #2#7   = #20#7;         || dni
     #2#135 = #20#135;       || dni

     |SI FEstado = 0;  |GRABA 000#2a;  |FINSI;
     |SI FEstado ! 0;  |GRABA 000#2n;  |FINSI;
     |LIBERA #2;
|FPRC;

|DEFBUCLE caman115;
     #20#1;
     135;
     #30#2, 00000, #30#26, "5";
     #30#2, 99999, #30#26, "5";
     ;
     NULL, GrabaTempo1;
|FIN;

|PROCESO CreaTemporal1;
     |PINTA 2305, "Preparando Temporal por NIF's ... ";
     |ABRE #2;  |CIERRA #2;  |DELINDEX #2;

     |NOPARA;

     |ABRE #2;
     |BUCLE caman115;
     |CIERRA #2;

     |SIPARA;
|FPRC;

|PROCESO Hojas;
     hoja     = 0;
     tothojas = 0;
     nPag     = 7;
     |SI #11#32 ! 0;
         nCampo = #11#32 $ nPag;
         |SI nCampo ! 0;
             tothojas = tothojas + ((#11#32 + (nPag - nCampo)) / nPag);
         |SINO;
             tothojas = tothojas + (#11#32 / nPag);
         |FINSI;
     |FINSI;

     |SI #11#33 ! 0;
         nCampo = #11#33 $ nPag;
         |SI nCampo ! 0;
             tothojas = tothojas + ((#11#33 + (nPag - nCampo)) / nPag);
         |SINO;
             tothojas = tothojas + (#11#33 / nPag);
         |FINSI;
     |FINSI;

     |SI #11#34 ! 0;
         nCampo = #11#34 $ nPag;
         |SI nCampo ! 0;
             tothojas = tothojas + ((#11#34 + (nPag - nCampo)) / nPag);
         |SINO;
             tothojas = tothojas +  (#11#34 / nPag);
         |FINSI;
     |FINSI;

     |SI #11#35 ! 0;
         nCampo = #11#35 $ nPag;
         |SI nCampo ! 0;
             tothojas = tothojas + ((#11#35 + (nPag - nCampo)) / nPag);
         |SINO;
             tothojas = tothojas +  (#11#35 / nPag);
         |FINSI;
     |FINSI;

     |SI #11#36 ! 0;
         nCampo = #11#36 $ nPag;
         |SI nCampo ! 0;
             tothojas = tothojas + ((#11#36 + (nPag - nCampo)) / nPag);
         |SINO;
             tothojas = tothojas +  (#11#36 / nPag);
         |FINSI;
     |FINSI;

     |SI #11#37 ! 0;
         nCampo = #11#37 $ nPag;
         |SI nCampo ! 0;
             tothojas = tothojas + ((#11#37 + (nPag - nCampo)) / nPag);
         |SINO;
             tothojas = tothojas +  (#11#37 / nPag);
         |FINSI;
     |FINSI;

     |SI #11#38 ! 0;
         nCampo=#11#38 $ nPag;
         |SI nCampo ! 0;
             tothojas = tothojas + ((#11#38 + (nPag - nCampo)) / nPag);
         |SINO;
             tothojas = tothojas + (#11#38 /nPag);
         |FINSI;
     |FINSI;

     |SI #11#39 ! 0;
         nCampo = #11#39 $ nPag;
         |SI nCampo ! 0;
             tothojas = tothojas + ((#11#39 + (nPag - nCampo) ) / nPag);
         |SINO;
             tothojas = tothojas + (#11#39 /nPag);
         |FINSI;
     |FINSI;

     |SI #11#40 ! 0;
         nCampo = #11#40 $ nPag;
         |SI nCampo ! 0;
             tothojas = tothojas + ((#11#40 + (nPag - nCampo)) / nPag);
         |SINO;
             tothojas = tothojas + (#11#40 / nPag);
         |FINSI;
     |FINSI;

     |SI #11#41 ! 0;
         nCampo = #11#41 $ nPag;
         |SI nCampo ! 0;
             tothojas = tothojas + ((#11#41 + (nPag - nCampo)) / nPag);
         |SINO;
             tothojas = tothojas + (#11#41 / nPag);
         |FINSI;
     |FINSI;

     |SI #11#42 ! 0;
         nCampo=#11#42 $ nPag;
         |SI nCampo ! 0;
             tothojas = tothojas + ((#11#42 + (nPag - nCampo)) / nPag);
         |SINO;
             tothojas = tothojas + (#11#42 / nPag);
         |FINSI;
     |FINSI;

     |SI #11#43 ! 0;
         nCampo = #11#43 $ nPag;
         |SI nCampo ! 0;
             tothojas = tothojas + ((#11#43 + (nPag - nCampo)) / nPag);
         |SINO;
             tothojas = tothojas +  (#11#43 / nPag);
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Punteros;
     s1 = 0;   b1 = 0;   r1 = 0;
     |SI #2#12 = "1";  s1 = 32;  b1 = 20;  r1 = 21;  |FINSI;
     |SI #2#12 = "2";  s1 = 37;  b1 = 22;  r1 = 23;  |FINSI;

     s2 = 0;   b2 = 0;   r2 = 0;
     |SI #2#13 = "1";  s2 = 32;  b2 = 20;  r2 = 21;  |FINSI;
     |SI #2#13 = "2";  s2 = 37;  b2 = 22;  r2 = 23;  |FINSI;
|FPRC;

|PROCESO Proceso;
     nSwTraba = 1;   || si hay trabajadores
     nYaEsta1 = 0;
     nYaEsta2 = 0;
     |HAZ Punteros;

     |PARA nMeses = 1; |SI nMeses [ 12;  |HACIENDO nMeses = nMeses + 1;
           nCampoBase1 = nMeses +  22;
           nCampoRete1 = nMeses +  35;
           nCampoBase2 = nMeses +  48;
           nCampoRete2 = nMeses +  61;
           #11b1 = #11b1 + #2nCampoBase1;
           #11r1 = #11r1 + #2nCampoRete1;   || total reten. 1
           #11b2 = #11b2 + #2nCampoBase2;   || total bases 2
           #11r2 = #11r2 + #2nCampoRete2;   || total reten. 2

           |SI nYaEsta1 = 0;
               |SI #2nCampoBase1 ! 0;|O #2nCampoRete1 ! 0;
                   nYaEsta1 = 1;
                   #11s1 = #11s1 + 1;  || sujetos 1
               |FINSI;
           |FINSI;

           |SI nYaEsta2 = 0;
               |SI #2nCampoBase2 ! 0;|O #2nCampoRete2 ! 0;
                   nYaEsta2 = 1;
                   #11s2 = #11s2 + 1;  || sujetos 2
               |FINSI;
           |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE cat18001_1;
     #2#1;
     ;
     #30#2, "            ";
     #30#2, "zzzzzzzzzzzz";
     e;
     NULL, Proceso, NULL, NULL, Hojas;
|FIN;

____________________________________/ Portada
|| *************************
|| IMPRESION DE LAS PORTADAS
|| *************************

|PROCESO PortadaC;
     #900#75  = #0#88;
     #900#76  = #0#89;
     #900#77  = (("00" + #0#86) % -102) + (("000" + #0#87) % -103);
     #900#78  = 0;
     #900#79  = #0#0;
     #900#80  = " ";
     #900#81  = " ";
     #900#82  = "X";
     #900#83  = " ";
     #900#84  = #0#83;
     #900#85  = #0#75;
     #900#86  = #0#76;
     #900#87  = #0#77;
     #900#88  = #0#78;
     #900#89  = "";
     #900#90  = "";
     #900#91  = "";
     #900#92  = #0#85;
     #900#93  = #0#81;
     #900#94  = #0#82;
     #900#95  = (("00" + #0#79) % -102) + (("000" + #0#80) % -103);
     #900#96  = "";
     #900#97  = "";
     #900#98  = Punto01;
     #900#99  = Punto02;
     #900#100 = Punto03;
     #900#101 = Punto04;
     #900#102 = Punto05;
     #900#103 = #104#15;
     #900#104 = #104#6;
     #900#105 = "";
     aAlfa    = #0#81;  |QBF aAlfa;
     #900#106 = aAlfa + ",  " + #0#1;
     #900#107 = "";
     #900#108 = #0#90;

     |INFOR "capor180";

     |PRINT;
     |PIEINF;
     |FININF;
|FPRC;

|PROCESO PortadaI;
     |ABRE #1;
     #1#0 = #30#2;
     #1#1 = #30#26;
     |LEE 040#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     #900#75  = #1#18;
     #900#76  = #1#19;
     #900#77  = (("00" + #1#16) % -102) + (("000" + #1#17) % -103);
     #900#78  = #1#0;
     #900#79  = #1#1;
     #900#80  = " ";
     #900#81  = " ";
     #900#82  = " ";
     #900#83  = " ";
     |SI #0#70 = "I"; #900#81 = "X";  |FINSI;
     |SI #0#70 = "C"; #900#83 = "X";  |FINSI;
     #900#84  = #1#13;
     #900#85  = #1#2;
     #900#86  = #1#3;
     #900#87  = #1#4;
     #900#88  = #1#5;
     #900#89  = #1#6;
     #900#90  = #1#7;
     #900#91  = #1#8;
     #900#92  = #1#14;
     #900#93  = #1#11;
     #900#94  = #1#12;
     #900#95  = (("00" + #1#9) % -102) + (("000" + #1#10) % -103);
     #900#96  = "";
     #900#97  = "";
     #900#98  = #11#19;
     #900#99  = #11#20;
     #900#100 = #11#21;
     #900#101 = #11#22;
     #900#102 = #11#23;
     #900#103 = 0;
     #900#104 = 0;
     #900#105 = "";
     #900#107 = "";
     #900#108 = "";

     |INFOR "capor180";

     aAlfa = #1#11;  |QBF aAlfa;
     #900#106 = aAlfa + ",  " + #0#1;

     |PRINT;
     |PIEINF;
     |FININF;

     Punto01 = Punto01 + #11#19;
     Punto02 = Punto02 + #11#20;
     Punto03 = Punto03 + #11#21;
     Punto04 = Punto04 + #11#22;
     Punto05 = Punto05 + #11#23;
|FPRC;

|PROCESO HojasIn2;
     #20#0   = #2#0;
     #20#1   = #2#1;        || lee del fichero maestro
     #20#134 = #0#0;
     |LEE 121#20=;            || tiene que existir!!!
     |SI nSwBusca = 1;  nVarCampo1 =  22;  nVarCampo2 =  35;  |FINSI;    || punteros de base
     |SI nSwBusca = 2;  nVarCampo1 =  48;  nVarCampo2 =  61;  |FINSI;    ||/y retencion
         tb = 0;
         tr = 0;
     |PARA nMeses = 1; |SI nMeses [ 12; |HACIENDO nMeses = nMeses + 1;
             nCampoBase = nMeses + nVarCampo1;
             nCampoRete = nMeses + nVarCampo2;
             tb = tb + #2nCampoBase;                     || acumula bases
             tr = tr + #2nCampoRete;                     || acumula retencion
     |SIGUE;

     |SI nSwBusca = 1;  #20#15 = 0;  #20#19 = 0;  |FINSI;
     |SI nSwBusca = 2;  #20#16 = 0;  #20#20 = 0;  |FINSI;      || inicializa la

     |SI tb ! 0;|O tr ! 0;
         |SI nSwBusca = 1;  pp = #2#09;  clave = #2#12;  |FINSI;
         |SI nSwBusca = 2;  pp = #2#10;  clave = #2#13;  |FINSI; || carga

         |SI #c3gso180#0 ] 80;
            |HAZ magnetico2;
         |SINO;
            |HAZ magnetico20002;
         |FINSI;

         |SI nSwBusca = 1;  #20#15 = hoja;  #20#19 = linea;  |FINSI;
         |SI nSwBusca = 2;  #20#16 = hoja;  #20#20 = linea;  |FINSI;  || carga hoja
     |FINSI;
     |GRABA 020#20a;               || regraba el trabajador
     |LIBERA #20;
|FPRC;

|DEFBUCLE cat18001_2;
     #2#1;
     12;
     #30#2, "            ", aDCla;
     #30#2, "zzzzzzzzzzzz", aHCla;
     e;
     NULL, HojasIn2;
|FIN;

|DEFBUCLE cat18001_3;
     #2#1;
     13;
     #30#2, "            ", aDCla;
     #30#2, "zzzzzzzzzzzz", aHCla;
     e;
     NULL, HojasIn2;
|FIN;

|PROCESO HojasIn1;
     nSwBusca = 1;  |BUCLE cat18001_2;
     nSwBusca = 2;  |BUCLE cat18001_3;
|FPRC;

|PROCESO HojasIn;
     |SI #11#32 ! 0;  aDCla = "1";  aHCla = aDCla;  |HAZ HojasIn1;  |FINSI;
     |SI #11#37 ! 0;  aDCla = "2";  aHCla = aDCla;  |HAZ HojasIn1;  |FINSI;
|FPRC;

____________________________________/ GRABA REGISTROS POR EMPRESA

|PROCESO SumaPerce;
     |PARA nCampo = 32; |SI nCampo [ 43; |HACIENDO nCampo = nCampo + 1;
             #11#19 = #11#19 + #11nCampo;        || casilla 1 (total percep.)
     |SIGUE;
|FPRC;

|PROCESO Reparte;
     |ABRE #1;
     #1#0 = #30#2;
     #1#1 = #30#26;
     |LEE 040#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     |SI Opcion ! 2;
         |HAZ SumaPerce;           || halla el total perceptores
         |SI #c3gso180#0 ] 80; |HAZ magnetico1; |SINO; |HAZ magnetico20001; |FINSI;
         |HAZ HojasIn;             || imprime hojas interiores
     |SINO;
         |HAZ SumaPerce;
         |HAZ PortadaI;
     |FINSI;
|FPRC;

|PROCESO Imprime;
     |BLIN 23;
     |PINTA 2305, "  Imprimiendo";

     |DDEFECTO #11;
     nSwTraba = 0;
     |BUCLE cat18001_1;          || lee trabajadores y calcula el numero de hojas
     |SI nSwTraba = 1; |HAZ Reparte; |FINSI;
|FPRC;

|PROCESO HazTodo;
  enEmpresa = #canempre#2;
  enPeriodo = #canempre#3;
  swOperacion = 0
  |SUB_EJECUTA "camoneda.tab";

     |PATH_DAT #2  aDirFich;
     |PATH_DAT #11 aDirFich;
     |PATH_DAT #20 aDirFich;
     |PATH_DAT #1  aDirFich;

     |HAZ CreaTemporal1;

     |ABRE #20;
     |HAZ Imprime;
     |CIERRA #20;
|FPRC;

|| ---------- Seleccion DESDE / HASTA Empresa.

|PROCESO Leelo;
     aDirFich = "";
     |DBASE aDirFich;
     aDirFich = aDirFich + "fich/" + (("00000" + #30#2) % -105) + (("0" + #30#3) % -101) + "/";

     |SI #30#26 ! #0#0; |O #30#21 = "I";
         |ACABA;
     |FINSI;

     |HAZ HazTodo;
|FPRC;

|DEFBUCLE canempre_2;
     #30#1;
     ;
     #0#5, #0#7;
     #0#6, #0#8;
     ;
     NULL, Leelo;
|FIN;

|PROCESO Seleccion;
     |SI #0#4 = "S";
         |BUCLE canempre_2;
     |SINO;
         |PARA nVarCampo1T = 9;  |SI nVarCampo1T [ 28;  |HACIENDO nVarCampo1T = nVarCampo1T + 1;
               |SI #0nVarCampo1T = 0;  |SAL;  |FINSI;
               nVarCampo2T = nVarCampo1T + 20;

               #0#5 = #0nVarCampo1T;
               #0#6 = #0nVarCampo1T;
               #0#7 = #0nVarCampo2T;
               #0#8 = #0nVarCampo2T;
               |BUCLE canempre_2;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO CreaTempos;
     Punto01 = 0;
     Punto02 = 0;
     Punto03 = 0;
     Punto04 = 0;
     Punto05 = 0;

     |HAZ Seleccion;

     |SI Opcion = 2;
         |SI #0#70 = "C";  |HAZ PortadaC;  |FINSI;

         |ACABA;
     |FINSI;
|FPRC;

|PROCESO GrabaTotal;    || regraba total retenedores y total perceptores
     |DFICE fiche;
     fiche = "r+b " + fiche + "RTPA" + aEjerc;
     |FABRE fiche;
     |SI FSalida ] 0;
         Handle = FSalida;
         aAlfa1 = ("00000" + treten) % -105;
         caden = aAlfa1;
         caden = Handle + " " + caden;
         Pos   = 109;
         |FGRABA caden;       || regraba total retenedores

         aAlfa1 = ("000000000" + tperce) % -109;
         caden = aAlfa1;
         caden = Handle + " " + caden;
         Pos = 114;
         |FGRABA caden;       || regraba total perceptores
         |FCIERRA Handle;
         Pos = -1;
     |FINSI;
|FPRC;

|| *********************************************
|| PROCESO DEL SECUENCIAL PARA SOPORTE MAGNETICO
|| *********************************************

|PROCESO Creacion;
     |DDEFECTO #104;
     treten = 0;
     tperce = 0;

     |HAZ magnetico;

     |SI FEstado ] 0;
         |SI #0#70 = "C";
            |SI #c3gso180#0 ] 80;
               |HAZ magnetico0;
            |SINO;
               |HAZ magnetico20000;
            |FINSI;
         |FINSI;

         |DDEFECTO #11;
         |HAZ CreaTempos;

         caden = Handle + " " + &#0#95;
         |FGRABA caden;
         |FCIERRA Handle;
         Pos = -1;
         |SI #0#70 = "C";
             |HAZ GrabaTotal;     || regraba el registro tipo 0 'presentador' (colec.)
         |FINSI;
         |BLIN 23;
     |FINSI;

     |SI SwLaser = 1; |ACABA; |FINSI;

     Pos = -1;
     |PUSHV 0501 2380;
     |PINPA #0#104;

     |C_V #104#1,  1, "N";  |C_M #104#1,  1, "N";
     |C_V #104#2,  1, "N";  |C_M #104#2,  1, "N";
     |C_V #104#3,  1, "N";  |C_M #104#3,  1, "N";
     |C_V #104#4,  1, "N";  |C_M #104#4,  1, "N";
     |C_V #104#5,  1, "N";  |C_M #104#5,  1, "N";
     |C_V #104#7,  1, "N";  |C_M #104#7,  1, "N";
     |C_V #104#12, 1, "N";  |C_M #104#12, 1, "N";
     |C_V #104#13, 1, "N";  |C_M #104#13, 1, "N";

     #104#0  = Punto01;
     #104#8  = Punto02;
     #104#9  = Punto03;
     #104#10 = Punto04;
     #104#11 = Punto05;
     #104#15 = treten;
     #104#6  = tperce;

     |PINDA #0#104;
     |CONFI "2400SEs Correcto : ";
     |SI FSalida ! 0;
         fiche = "";
         |DFICE fiche;
         fiche = fiche + "RTPA" + aEjerc;
         |FBORRA fiche;
         Salir = 1;
     |FINSI;
     |POPV;
|FPRC;

|| *********************************************************************
||                    COMIENZO con TIPO 3
|| *********************************************************************

|PROCESO Portadas;
     |IMPRE 0;
     |HAZ CreaTempos;
     |FINIMP;
|FPRC;

|| ***********************************************************************
||                       EMISION DE ETIQUETAS
|| ***********************************************************************

|PROCESO Etiquetas;
     |SI #104#14 = 0;
         |MENAV "     Por favor haga la creacion de Diskette.";
         |ACABA;
     |FINSI;

     |PUSHV 0501 2380;

     aAlfa1  = "19";
     |SI #0#0 < 80; aAlfa1 = "20"; |FINSI;
     VAlfa    = #0#0;   VAlfa = ("00" + VAlfa) % -102;
     aAlfa1  = aAlfa1 + VAlfa;                          || Ejercicio
     VAlfa    = #0#79;  VAlfa = ("00" + VAlfa) % -102;
     aAlfa2  = VAlfa;                                     || Codigo Postal 1
     VAlfa    = #0#80;  VAlfa = ("000" + VAlfa) % -103;
     aAlfa3  = VAlfa;                                     || Codigo Postal 2

     #104#16 = "Delegacion .........: " + #0#88;
     #104#17 = "Ejercicio ..........: " + aAlfa1;
     #104#18 = "Modelo .............: 180";
     #104#19 = "Numero Justificante : ";
     #104#20 = "N.I.F. .............: " + #0#83;
     #104#21 = "Nombre : " + #0#75;
     #104#22 = #0#76 + " " + #0#77 + " " + #0#78 + " " + aAlfa2 + aAlfa3 + " " + #0#81;
     #104#23 = "P.Cont.: " + #0#91;
     #104#24 = "Telefono ...........: " + #0#84 + " " + #0#85;
     #104#25 = "Numero total Registros ..: " + #104#14;
     #104#26 = "Densidad soporte : 1,44 MB en Diskettes de 3 1/2";
     #104#27 = "";
     #104#28 = "";
     |C_M #104#27, 1, "N";
     |C_M #104#28, 1, "N";
     |SI #0#22 = "C";
         #104#27 = "Numero total Declarantes : " + #104#15;
         #104#28 = "Numero total Declarados .: " + #104#6;
         |C_M #104#27, 1, "S";
         |C_M #104#28, 1, "S";
     |FINSI;

     |PINPA #2#104;
     |PINDA #2#104;
     |ENDATOS #1#104;
     |SI FSalida = 0;
         |PINPA #2#104;
         |PINDA #2#104;

         |CONFI "2400SRealizar Impresion de la Etiqueta : ";
         |SI FSalida ! 0; |POPV; |ACABA; |FINSI;

         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |INFOR "caetique";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

         |PRINT; |PIEINF; |FININF; |FINIMP;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO Recorta;
   |SI Tipo ! "F";
      |SI Tipo = "A";
         Calc = 100 + NCar;
         Comodin1 = " ";
         Comodin1 = Comodin1 * NCar;
         Comodin = (Comodin + Comodin1) % Calc;
      |SINO;
         |QBF Comodin;
         Calc = 0 - (100 + NCar);
         Comodin1 = "0";
         Comodin1 = Comodin1 * NCar;
         Comodin = (Comodin1 + Comodin) % Calc;
      |FINSI;
   |SINO;
      Comodin1 = Comodin % -104;
      Comodin1 = Comodin1 + (Comodin % 0402);
      Comodin  = Comodin1 + (Comodin % 0102);
   |FINSI;
|FPRC;

|PROCESO CreaCaratula;
     |DFICE Directorio;
     Fichero  = #0#0;
     Fichero  = "RTPA" + aEjerc + ".car";
     NFichero = Fichero;          |QBF NFichero;
     Fichero  = "wb  "+ Directorio + NFichero;
     |FABRE Fichero;
     |SI FSalida ] 0;
        Maneja = FSalida;
        caden = "1180";
        caden = caden + aEjerc;
        Comodin = #caportad#13; NCar = 9;  Tipo = "A"; |HAZ Recorta; caden = caden + Comodin;
        Comodin = #caportad#16; NCar = 2;  Tipo = "N"; |HAZ Recorta; caden = caden + Comodin;
        Comodin = #caportad#17; NCar = 3;  Tipo = "N"; |HAZ Recorta; caden = caden + Comodin;
        Comodin = #caportad#3;  NCar = 2;  Tipo = "A"; |HAZ Recorta; caden = caden + Comodin;
        Comodin = #caportad#4;  NCar = 20; Tipo = "A"; |HAZ Recorta; caden = caden + Comodin;
        Comodin = #caportad#5;  NCar = 5;  Tipo = "N"; |HAZ Recorta; caden = caden + Comodin;
        Comodin = #caportad#11; NCar = 12; Tipo = "A"; |HAZ Recorta; caden = caden + Comodin;
        Comodin = #caportad#9;  NCar = 2;  Tipo = "N"; |HAZ Recorta; caden = caden + Comodin;
        Comodin = #caportad#9;  NCar = 2;  Tipo = "N"; |HAZ Recorta; caden = caden + Comodin;
        Comodin = #caportad#10; NCar = 3;  Tipo = "N"; |HAZ Recorta; caden = caden + Comodin;
        Comodin = #0#1;         NCar = 8;  Tipo = "F"; |HAZ Recorta; caden = caden + Comodin;
        Comodin = #0#75;        NCar = 30; Tipo = "A"; |HAZ Recorta; caden = caden + Comodin;
        Comodin = #0#90;        NCar = 25; Tipo = "A"; |HAZ Recorta; caden = caden + Comodin;
        caden = caden + &13 + &10;
        caden = Maneja + " " + caden; |FGRABA caden;
     |FINSI;
     |FCIERRA Maneja;
|FPRC;

|PROCESO Laser;
   INEmpresas = NEmpresas1 <-; NEmpresas = "RTPA" + aEjerc;
   SwLaser = 1; |HAZ Creacion; SwLaser = 0;
   |HAZ CreaCaratula;

   Directorio = "";  |DBASE Directorio; DirectorioD = Directorio;
   Directorio = Directorio + "hacienda/180/";
   Comodin = (("00000" + #48#2) % -105) + #48#3;
   DirectorioD = DirectorioD + "fich/" + Comodin + "/";

   aFichOrigen = DirectorioD + "RTPA" + aEjerc;
   aFichDestin = Directorio  + "RTPA" + aEjerc;
   |COPIA_FICHERO aFichOrigen, aFichDestin;
   aFichOrigen = aFichOrigen + ".car";
   aFichDestin = aFichDestin + ".car";
   |COPIA_FICHERO aFichOrigen, aFichDestin;

   aTipoSec = "180";
   |HAZ GrabaDisketteL;
|FPRC;

|PROCESO GrabaDisketteC;
     Pos = -1;
     Directorio = "";
     |DFICE Directorio;
     Fichero  = #0#0;
     Fichero  = "RTPA" + aEjerc;
     NFichero = Fichero;          |QBF NFichero;
     Fichero  = "rt  "+ Directorio + NFichero;
     |FABRE Fichero;
     |SI FSalida < 0;
         VAlfa = "      No se ha creado el fichero " + NFichero + " Por favor haga la Creacion del Diskette";
         |MENAV  VAlfa;
         |ACABA;
     |FINSI;
     |FCIERRA FSalida;

     Pos = -1;
     |PUSHV 0501 2380;
     |PINPA #1#104;

     E_sup  = 1;
     E_inf  = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
     Unidad = "A";
     Unidad = 0851 ? 0;
     |ATRI I;
     |PINTA 1616, "Introduzca un diskette formateado en D.O.S. ...";
     |ATRI i;
     |PINTA 2380, ".";
     |PAUSA;

     Raiz = "";
     |DIRECTORIO Raiz; |QBF Raiz;
     |DFICE Fichero;   |QBF Fichero;
     NFichero  = #0#0;
     NFichero  = "RTPA" + aEjerc;
     Fichero   = Fichero + NFichero;

     |ATRI P;
     |PINTA 1616, "                  Copiando ...                 ";
     |ATRI p;
     |PINTA 2380, ".";

     |QUE_SISTEMA Sistema;
     |SI Sistema ! "ESDOS";
         VAlfa = Raiz + "bin/agcopiaa " + Fichero + " " + Unidad + ":";
         |SYSTEM VAlfa;

         |ATRI P;
         |PINTA 1616, "           FICHERO COPIADO !!!!                 ";
         |ATRI p;
         |PINTA 2380, ".";
         |PAUSA;
     |SINO;
         VAlfa1 = Fichero;
         VAlfa2 = Unidad + ":" + NFichero;

         |COPIA_FICHERO VAlfa1, VAlfa2;
         |SI FSalida ! 0;
             VAlfa3 = "Error [" + FSalida + "] en copia de ficheros ...";
             |PINTA 1616, VAlfa3;
             |PINTA 2380, ".";
             |PAUSA;
         |SINO;
             |ATRI P;
             |PINTA 1616, "           FICHERO COPIADO !!!!                 ";
             |ATRI p;
             |PINTA 2380, ".";
             |PAUSA;
         |FINSI;
     |FINSI;
     |POPV;
|FPRC;

____________________________________/ LEE LAS EMPRESAS
|PROCESO Tipo3; |TIPO 3;
     aEjerc = "19";
     |SI #0#0 [ 80; aEjerc = "20"; |FINSI;
     aEjerc = aEjerc + (("00" + #0#0) % -102);
     enAnyo = aEjerc;

     |SI #0#0 < 80;
        MGeneral3 = "5"; MGeneral8 = "Emision Laser";
     |SINO;
        MGeneral3 = "4"; MGeneral8 = "";
     |FINSI;

     |PARA; |SI Salir = 0; |HACIENDO;
            |MENUG MGeneral;
            MGeneral2 = FSalida;
            Opcion    = MGeneral2;
            Salir     = 1;
            |SI #0#0 ] 80;
               MaxOpc = 4;
            |SINO;
               MaxOpc = 5;
            |FINSI;
            |SI Opcion ] 1; |Y Opcion [ MaxOpc;
                Salir = 0;
                |SI Opcion = 1;  |HAZ Creacion;       |FINSI;
                |SI Opcion = 2;  |HAZ Portadas;       |FINSI;
                |SI Opcion = 3;  |HAZ Etiquetas;      |FINSI;
                |SI Opcion = 4;  |HAZ GrabaDisketteC; |FINSI;
                |SI Opcion = 5;  |HAZ Laser;          |FINSI;
            |FINSI;
     |SIGUE;
     |ABRE #2;  |CIERRA #2;  |DELINDEX #2;
|FPRC;

|PROGRAMA;
     |HAZ inicio;

     |CLS;
     |CABEZA "Emision 180 Magn.";
     |DDEFECTO #0;
     |PINPA #0#0;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0;
         |CIERRA #0;  |DELINDEX #0;
         |ABRE #0;
         |GRABA 020#0b;
     |FINSI;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
         |GRABA 020#0a;
     |FINSI;
     |LIBERA #0;
     |CIERRA #0;
|FPRO;
