|FICHEROS;
  c3ginfam #0;
  camocabe #1;
  camoline #2;
  camogrup #3;         ||Grupos de Amortizacion
  cainftmp #4;         ||Temporal grabacion cuentas
  cainfamo #5;
|FIN;

|VARIABLES;
  &entrada = 1;
  informe = "cainfamo";
  &tipo = "AMORTIZACIONES";
  amo = "A";
  &impo = 0;
  &total = 0;
  &totcue = 0;
  &lintot = 0;
  &linnor = 0;
  &linant = 0;
  &ulti = "";
  &impoc = 0;
  &totalc = 0;
  &totcuec = 0;
  &nof = "";
  &noc = "";
  t1 = "NORMAL";
  t2 = "DEGRESIVA";
  t3 = "ACELERADA";
  are = "a";
  bueno = 0;
  nombre = "";
  alfa1 = "";
  alfa2 = "";
  nume1 = 0;
  sw_error = 0;
  i_cm1 = 10;  || Campo Desde/Hasta Empresa
|FIN;

|INCLUYE acceso_i;
|INCLUYE puntos_i;
|INCLUYE numamo_i;
|INCLUYE multie_i;

|| *****************************************************************
|PROCESO numamo; |TIPO 0;
  x_alfa1 = #0Campo;
  |HAZ x_punto;
  #0Campo = x_alfa1;
  |PINTA #0Campo;
|FPRC;

|PROCESO mayor;
  alfa1 = #0Campo > " ";
  #0Campo = alfa1;
  |PINTA #0Campo;
|FPRC;

|PROCESO cuenta; |TIPO 0;
  p_alfa1 = #0Campo;
  salidas = FSalida;
  |HAZ punto;
  |SI p_error ! 0;  |ERROR;  |FINSI;
|FPRC;

|PROCESO tipo8;  |TIPO 8;
  |HAZ inicio;
  any = #30#26;
  |HAZ coloca;
|FPRC;

|| *************************************************************************
|PROCESO sel_multi;
|| |SI #30#26 ! any;  |ACABA; |FINSI;
  |SI #30#21 = "I"; |ACABA; |FINSI;
  sw_error = 0;
  leidos = 1;
|FPRC;

|| ***********************************************************************
|| ---------- Seleccion DESDE / HASTA Empresa.
|PROCESO esdesd1;
  alfa1 = #30#2;
  alfa2 = #30#3;
  alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
  alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
  dirfich0 = dir_fich + alfa1 + alfa2 + "/";

  sw_error = 0;
  leidos = 0;
  |HAZ sel_multi;
  |SI leidos = 1; |Y sw_error = 0;
      |HAZ haztodo;
  |FINSI;
|FPRC;

|DEFBUCLE esdesde;
 #30#1;
 ;
 d_empres, d_period;
 h_empres, h_period;
 e;
 NULL,esdesd1;
|FIN;

|| ---------- Seleccion en parrilla.
|PROCESO esunaauna;
  |PARA xx = i_cm6; |SI xx [ i_cm7; |HACIENDO xx = xx + 1;
        |SI #0xx = 0;  |SAL;  |FINSI;
        yy = xx + 20;
        alfa1 = #0xx;
        alfa2 = #0yy;

        || ... lee empresa
           |ABRE #30;
           |DDEFECTO #30;
           #30#2 = #0xx;
           #30#3 = #0yy;
           |LEE 011#30=;
           |CIERRA #30;
           leidos = 0; sw_error = 0;
           |HAZ sel_multi;
           |SI leidos = 0; |O sw_error ! 0; |VETE otramas; |FINSI;
        || ...................

        alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
        alfa2 = "0"     + alfa2;   alfa2 = alfa2 % -101;
        dirfich0 = dir_fich + alfa1 + alfa2 + "/";

        |HAZ haztodo;
 |ET otramas;
  |SIGUE;
|FPRC;
|| *************************************************************************
|| ....... Calculos de la impresion
|PROCESO graba_tmp;
  |SI #0#7 = "N";
      |SI #1#22 = "N"; |ACABA; |FINSI;
  |FINSI;
  #3#0 = #1#15;
  |LEE 001#3=;
  |SI FSalida ! 0;  |ACABA;   |FINSI;
  |SI #3#1 ] #0#0; |Y #3#1 [ #0#1;
      #4#0 = #3#1;
      #4#1 = #3#2;
      #4#2 = #1#0;
      #4#3 = #1#1;
      |GRABA 021#4n;
      |LIBERA #4;
  |FINSI;
|FPRC;

|DEFBUCLE carga_tmp;
#1#1;
;
#0#2,00;
#0#3,99;
e;
NULL , graba_tmp;
|FIN;

|PROCESO imprelin;
  |SI #2#4 = "A";
      |SI #2#3 ] #0#4; |Y #2#3 [ #0#5;
          impo = impo + #2#5;     impoc = impoc + #2#9;
          total = total + #2#5;   totalc = totalc + #2#9;
          totcue = totcue + #2#5; totcuec = totcuec + #2#9;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO fechafac;
  #1#0 = #4#2;
  #1#1 = #4#3;
  |LEE 001#1=;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  |SI bueno ! 0;
      |SI #4#0 ! ulti;
          lintot = 1;
          |PRINT; || linea del informe
          totcue = 0; totcuec = 0;
          lintot = 0;
          linant = 0;
          linnor = 1;
      |SINO;
          lintot = 0;
          linnor = 0;
          linant = 1;
      |FINSI;
  |SINO;
      lintot = 0;
      linnor = 1;
      linant = 0;
  |FINSI;
  ulti = #4#0;
  nof = t1; noc = t1;
  |SI #1#10 = "D"; nof = t2; |FINSI;
  |SI #1#10 = "A"; nof = t3; |FINSI;
  |SI #1#16 = "D"; noc = t2; |FINSI;
  |SI #1#16 = "A"; noc = t3; |FINSI;
  |BUCLELIN 2imprelin#1; || lee las lineas de esta cabecera
  |SI impo ! 0; |O impoc ! 0;
      |PRINT;
      bueno = 1;
  |SINO;
      |SI #0#8 = "S";
          |PRINT;
          bueno = 1;
      |FINSI;
  |FINSI;
  lintot = 0;
  linnor = 0;
  linant = 0;
  impo = 0; impoc = 0;
|FPRC;

|DEFBUCLE cainfamo0;
#4#1;
;
#0#0 , 0 , #0#2, 00;
#0#1 , 9 , #0#3, 99;
e;
NULL, fechafac;
|FIN;

|| **********************************************************************
|PROCESO proceso; |TIPO 3;

  nombre = "amo" + Usuario;
  nombre = nombre % 108;
  |QBF nombre;
  |NOME_DAT #4 nombre;

  |IMPRE 0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  |INFOR informe;
  |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

  |PARA nume1 = 0; |SI nume1 [ 8; |HACIENDO nume1 = nume1 + 1;
        #5nume1 = #0nume1;
  |SIGUE;

  |SI #0i_cm1 = "S";
      |BUCLE esdesde;
  |SINO;
      |HAZ esunaauna;
  |FINSI;
  |FININF;
  |FINIMP;
|FPRC;

|| ................................................................
|PROCESO haztodo;

  enEmpresa = #canempre#2;
  enPeriodo = #canempre#3;
  swOperacion = 0;
  |SUB_EJECUTA "camoneda.tab";

  |PATH_DAT #1 dirfich0;
  |PATH_DAT #2 dirfich0;
  |PATH_DAT #3 dirfich0;

  |ABRE #4;
  |CIERRA #4;
  |DELINDEX #4;

  |HAZ borrar;

  |ABRE #3;
  |ABRE #4;
  |BUCLE carga_tmp;
  |CIERRA #3;
  |CIERRA #4;

  bueno = 0;
  |ABRE #1;
  |BUCLE cainfamo0;
  |SI bueno = 1;
      lintot = 1;
      |PRINT;
      |PIEINF;
  |FINSI; || imprime el pie del informe

  |CIERRA #1;
  |DELINDEX #4;
|FPRC;

|PROCESO borrar;
 impo    = 0;
 total   = 0;
 totcue  = 0;
 lintot  = 0;
 linnor  = 0;
 linant  = 0;
 ulti    = "";
 impoc   = 0;
 totalc  = 0;
 totcuec = 0;
|FPRC;
