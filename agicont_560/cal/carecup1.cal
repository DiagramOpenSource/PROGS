|FICHEROS;
    cacuenta #1;
    camaasil #3;
    cacuebal #5;
    camandia #10;
    cacuen01 #21;     ||LOS FICHEROS cacuenta para repondatos
    cacuen02 #22;     ||LOS FICHEROS cacuenta para repondatos
    cacuen03 #23;     ||LOS FICHEROS cacuenta para repondatos
    cacuen04 #24;     ||LOS FICHEROS cacuenta para repondatos
    cacuen05 #25;     ||LOS FICHEROS cacuenta para repondatos
    cacuen06 #26;     ||LOS FICHEROS cacuenta para repondatos
||FIN;
||FICHEROS;
    carecupe #0;
    caconimp #8;
|FIN;

|VARIABLES;
    num = 0;
    juan = 0;
    men1   = "    NO EXISTE EMPRESA";
    mensa1 = "     No puedo bloquear los ficheros";
    mensa2   = "     No esta definida esta cuenta en Cuentas de Balance";
    ctini = "            ";
    ctfin = "999999999999";
    feini = "01.01.0000";
    fefin = "31.12.9999";
    fini = @;
    ffin = @;
    cini = 0;
    cfin = 0;
    doini = 1;
    dofin = 999999;
    prim = 0;
    cuant  = "";
    cuant1 = "";
    cuant2 = "";
    cuant3 = "";
    cuant4 = "";
    cuant5 = "";
    cuant6 = "";
    lon1 = 0;
    lon2 = 0;
    lon3 = 0;
    lon4 = 0;
    lon5 = 0;
    lon6 = 0;
    aa = 0;
    ini = 0;
    fecalf = "";
    mes = "";
    mesfec = 0;
    mesac = 0;
    a = 0;
    b = 0;
    c = 0;
    mensa = "";
    aar = "";
    traba  = "";
    traba1 = "";
    traba2 = "";
    traba3 = "";
    traba4 = "";
    traba5 = "";
    traba6 = "";
    mensaa = "";
    errant = "aaaaaaaaaaaa";
    uno = "";
    dos = "";
    mascara = "";
    nivel = 0;
    conforme = "";
    alfa1 = "";
    d_diari = 0;
    d_opera = "";
    d_impor = 0;
    diant = 0;
    primera = 0;
||FIN;
||VARIABLES;
    &entrada = 1;
    &sw_conase4 = 0;
|FIN;

|INCLUYE acceso_i;       || lectura de la empresa

|PROCESO mayus;  |TIPO 6;
  #0Campo = #0Campo > " ";
  |PINTA #0Campo;
|FPRC;


|PROCESO conase4; |TIPO 7;
|SI sw_conase4 = 1;
        #0#0 = "S";
    |PTEC 802;
    |PTEC 802;
|FINSI;
|FPRC;

|PROCESO procal; |TIPO 3;
  |NOPARA;
  |HAZ inicio;
  conforme = #0#0;
  fini = "01.01.0000";
  ffin = "31.12.9999";
  cini = 1;
  cfin = 999;
  |HAZ recuperacion;
  |SIPARA;
  |ABRE #8;
  |LEE 111#8p;
  |SI FSalida ! 0;
      |DDEFECTO #8;
      #8#3 = "S";
      |GRABA 011#8n;
  |SINO;
      #8#3 = "S";
      |GRABA 011#8a;
  |FINSI;
  |CIERRA #8;
|FPRC;

|PROCESO inicial; |TIPO 8;
|FPRC;

|PROCESO diarios;
  #10#2 = 0;
  #10#3 = 0;
  |GRABA 020#10a;
  |LIBERA #10;
|FPRC;

|DEFBUCLE carecupe2;          || acera los diarios
#10#1;
;
0;
99;
be;
NULL, diarios;
|FIN;

|PROCESO acumulados;
  |PDEFECTO #1,9,54;
  |GRABA 020#1a;
  |LIBERA #1;
|FPRC;

|DEFBUCLE carecupe0;     || acera las cuentas
#1#1;
;
ctini, 0;
ctfin, 9;
be;
NULL, acumulados;
|FIN;

|PROCESO leecuenta;
  |LIBERA #1;
  |LEE 101#1=;
  |SI FSalida ! 0;
      |LIBERA #1;
      |DDEFECTO #1;
      #1#0 = cuant;
      #1#1 = juan;
      |HAZ defect1;
      |PUSHV 0501 1980;
      |PINPA #0#1;
      |PINDA #0#1;
      |ENDATOS #1#1;
      |SI FSalida ! 0;
          |DDEFECTO #1;
          #1#0 = cuant;
          #1#1 = juan;
      |FINSI;
      |GRABA 020#1b;
      |POPV;
  |FINSI;
|FPRC;

|PROCESO actuali;
  aar = lon1;  traba1 = #3#4 % aar;            || coge cuenta1
  aar = lon2;  traba2 = #3#4 % aar;            || coge cuenta2
  aar = lon3;  traba3 = #3#4 % aar;            || coge cuenta3
  aar = lon4;  traba4 = #3#4 % aar;            || coge cuenta4
  aar = lon5;  traba5 = #3#4 % aar;            || coge cuenta5
  aar = lon6;  traba6 = #3#4 % aar;            || coge cuenta6
  |SI prim = 0;
      |SI lon1 ! 100;
          cuant1 = traba1;
          #1#0 = cuant1;  #1#1 = 1;
          cuant = #1#0;   juan = #1#1;
          |HAZ leecuenta;
          |SALVA_DATOS #1;
          |REPON_DATOS #21;
      |FINSI;
      |SI lon2 ! 100;
          cuant2 = traba2;
          #1#0 = cuant2;  #1#1 = 2;
          cuant = #1#0;   juan = #1#1;
          |HAZ leecuenta;
          |SALVA_DATOS #1;
          |REPON_DATOS #22;
      |FINSI;
      |SI lon3 ! 100;
          cuant3 = traba3;
          #1#0 = cuant3;  #1#1 = 3;
          cuant = #1#0;   juan = #1#1;
          |HAZ leecuenta;
          |SALVA_DATOS #1;
          |REPON_DATOS #23;
      |FINSI;
      |SI lon4 ! 100;
          cuant4 = traba4;
          #1#0 = cuant4;  #1#1 = 4;
          cuant = #1#0;   juan = #1#1;
          |HAZ leecuenta;
          |SALVA_DATOS #1;
          |REPON_DATOS #24;
      |FINSI;
      |SI lon5 ! 100;
          cuant5 = traba5;
          #1#0 = cuant5;  #1#1 = 5;
          cuant = #1#0;   juan = #1#1;
          |HAZ leecuenta;
          |SALVA_DATOS #1;
          |REPON_DATOS #25;
      |FINSI;
      |SI lon6 ! 100;
          cuant6 = traba6;
          #1#0 = cuant6;  #1#1 = 6;
          cuant = #1#0;   juan = #1#1;
          |HAZ leecuenta;
          |SALVA_DATOS #1;
          |REPON_DATOS #26;
      |FINSI;
      prim = 1;
  |FINSI;
  |SI cuant6 ! traba6;
      #1#0 = #26#0;  #1#1 = #26#1;
      |LEE 101#1=;
      |SALVA_DATOS #26;
      |REPON_DATOS #1;
      |GRABA 101#1a;
      cuant6 = traba6;
      #1#0 = cuant6;  #1#1 = 6;
      |SI #30#13 = 6;
          mensa = "Recuperando Cuenta: " + #1#0 + "      ";
          |PINTA 2410,mensa;
      |FINSI;
      cuant = #1#0;   juan = #1#1;
      |HAZ leecuenta;
      |SALVA_DATOS #1;
      |REPON_DATOS #26;
  |FINSI;
  |SI cuant5 ! traba5;
      #1#0 = #25#0;  #1#1 = #25#1;
      |LEE 101#1=;
      |SALVA_DATOS #25;
      |REPON_DATOS #1;
      |GRABA 101#1a;
      cuant5 = traba5;
      #1#0 = cuant5;  #1#1 = 5;
      |SI #30#13 = 5;
          mensa = "Recuperando Cuenta: " + #1#0 + "      ";
          |PINTA 2410,mensa;
      |FINSI;
      cuant = #1#0;   juan = #1#1;
      |HAZ leecuenta;
      |SALVA_DATOS #1;
      |REPON_DATOS #25;
  |FINSI;
  |SI cuant4 ! traba4;
      #1#0 = #24#0;  #1#1 = #24#1;
      |LEE 101#1=;
      |SALVA_DATOS #24;
      |REPON_DATOS #1;
      |GRABA 101#1a;
      cuant4 = traba4;
      #1#0 = cuant4;  #1#1 = 4;
      |SI #30#13 = 4;
          mensa = "Recuperando Cuenta: " + #1#0 + "      ";
          |PINTA 2410,mensa;
      |FINSI;
      cuant = #1#0;   juan = #1#1;
      |HAZ leecuenta;
      |SALVA_DATOS #1;
      |REPON_DATOS #24;
  |FINSI;
  |SI cuant3 ! traba3;
      #1#0 = #23#0;  #1#1 = #23#1;
      |LEE 101#1=;
      |SALVA_DATOS #23;
      |REPON_DATOS #1;
      |GRABA 101#1a;
      cuant3 = traba3;
      #1#0 = cuant3;  #1#1 = 3;
      |SI #30#13 = 3;
          mensa = "Recuperando Cuenta: " + #1#0 + "      ";
          |PINTA 2410,mensa;
      |FINSI;
      cuant = #1#0;   juan = #1#1;
      |HAZ leecuenta;
      |SALVA_DATOS #1;
      |REPON_DATOS #23;
  |FINSI;
  |SI cuant2 ! traba2;
      #1#0 = #22#0;  #1#1 = #22#1;
      |LEE 101#1=;
      |SALVA_DATOS #22;
      |REPON_DATOS #1;
      |GRABA 101#1a;
      cuant2 = traba2;
      #1#0 = cuant2;  #1#1 = 2;
      |SI #30#13 = 2;
          mensa = "Recuperando Cuenta: " + #1#0 + "      ";
          |PINTA 2410,mensa;
      |FINSI;
      cuant = #1#0;   juan = #1#1;
      |HAZ leecuenta;
      |SALVA_DATOS #1;
      |REPON_DATOS #22;
  |FINSI;
  |SI cuant1 ! traba1;
      #1#0 = #21#0;  #1#1 = #21#1;
      |LEE 101#1=;
      |SALVA_DATOS #21;
      |REPON_DATOS #1;
      |GRABA 101#1a;
      cuant1 = traba1;
      #1#0 = cuant1;  #1#1 = 1;
      |SI #30#13 = 1;
           mensa = "Recuperando Cuenta: " + #1#0 + "      ";
           |PINTA 2410,mensa;
      |FINSI;
      cuant = #1#0;   juan = #1#1;
      |HAZ leecuenta;
      |SALVA_DATOS #1;
      |REPON_DATOS #21;
  |FINSI;
  |HAZ suma;
  |SI #3#8 = "D";
      #1#51  = #1#51  + #3#9;
      #21#51 = #21#51 + #3#9;
      #22#51 = #22#51 + #3#9;
      #23#51 = #23#51 + #3#9;
      #24#51 = #24#51 + #3#9;
      #25#51 = #25#51 + #3#9;
      #26#51 = #26#51 + #3#9;
  |SINO;
      #1#52  = #1#52  + #3#9;
      #21#52 = #21#52 + #3#9;
      #22#52 = #22#52 + #3#9;
      #23#52 = #23#52 + #3#9;
      #24#52 = #24#52 + #3#9;
      #25#52 = #25#52 + #3#9;
      #26#52 = #26#52 + #3#9;
  |FINSI;
  #1#53  = #1#51  - #1#52;
  #21#53 = #21#51 - #21#52;
  #22#53 = #22#51 - #22#52;
  #23#53 = #23#51 - #23#52;
  #24#53 = #24#51 - #24#52;
  #25#53 = #25#51 - #25#52;
  #26#53 = #26#51 - #26#52;
  |SI diant ! #3#0;
      |SI primera = 1;
          |GRABA 020#10a;
          |LIBERA #10;
      |FINSI;
      primera = 1;
      diant = #3#0;
      #10#0 = #3#0;
      |LEE 101#10=;
      |SI FSalida ! 0;
          |DDEFECTO #10;
          #10#0 = #3#0;
          #10#1 = "<DIARIO SIN DEFINIR>";
          |GRABA 020#10n;
          |LEE 121#10=;
      |FINSI;
  |FINSI;
  |SI #3#8 = "D";
      #10#2 = #10#2 + #3#9;        || debe
  |SINO;
      #10#3 = #10#3 + #3#9;        || haber
  |FINSI;
|FPRC;

|DEFBUCLE carecupe1;
 #3#3;
 6;
 ctini, 0, fini, doini, cini;
 ctfin, 9, ffin, dofin, cfin;
 be;
 NULL, actuali;
|FIN;

|PROCESO recuperacion;
|SI conforme ! "S"; |ACABA;   |FINSI;
    diant = -1;
    primera = 0;
    |PINTA 2410,"Acerando el Plan Contable y los Diarios ...";
    |BUCLE carecupe0;
    |BUCLE carecupe2;
    |BLIN 24;
    |ABRE #1;
    |ABRE #10;
    prim = 0;
    lon1 = 100;  lon2 = 100;  lon3 = 100;
    lon4 = 100;  lon5 = 100;  lon6 = 100;
    |SI #30#13 ] 1; lon1 = 100 + #30#14; |FINSI;
    |SI #30#13 ] 2; lon2 = 100 + #30#15; |FINSI;
    |SI #30#13 ] 3; lon3 = 100 + #30#16; |FINSI;
    |SI #30#13 ] 4; lon4 = 100 + #30#17; |FINSI;
    |SI #30#13 ] 5; lon5 = 100 + #30#18; |FINSI;
    |SI #30#13 ] 6; lon6 = 100 + #30#19; |FINSI;
    prim = 0;
    fini = "01.01.0001";
    ffin = "31.12.8999";
    |BUCLE carecupe1;
    |SI primera = 1;
        |GRABA 020#10a;
        |LIBERA #10;
        primera = 0;
    |FINSI;
    |SI lon6 ! 100;
        #1#0 = #26#0;  #1#1 = #26#1;
        |LEE 101#1=;
        |SALVA_DATOS #26;
        |REPON_DATOS #1;
        |GRABA 101#1a;
    |FINSI;
    |SI lon5 ! 100;
        #1#0 = #25#0;  #1#1 = #25#1;
        |LEE 101#1=;
        |SALVA_DATOS #25;
        |REPON_DATOS #1;
        |GRABA 101#1a;
    |FINSI;
    |SI lon4 ! 100;
        #1#0 = #24#0;  #1#1 = #24#1;
        |LEE 101#1=;
        |SALVA_DATOS #24;
        |REPON_DATOS #1;
        |GRABA 101#1a;
    |FINSI;
    |SI lon3 ! 100;
        #1#0 = #23#0;  #1#1 = #23#1;
        |LEE 101#1=;
        |SALVA_DATOS #23;
        |REPON_DATOS #1;
        |GRABA 101#1a;
    |FINSI;
    |SI lon2 ! 100;
        #1#0 = #22#0;  #1#1 = #22#1;
        |LEE 101#1=;
        |SALVA_DATOS #22;
        |REPON_DATOS #1;
        |GRABA 101#1a;
    |FINSI;
    |SI lon1 ! 100;
        #1#0 = #21#0;  #1#1 = #21#1;
        |LEE 101#1=;
        |SALVA_DATOS #21;
        |REPON_DATOS #1;
        |GRABA 101#1a;
    |FINSI;
    |CIERRA #1;
    |CIERRA #10;
|FPRC;

|PROCESO suma;
  |SI #3#1 > #1#58;   #1#58  = #3#1;  |FINSI;
  |SI #3#1 > #21#58;  #21#58 = #3#1;  |FINSI;
  |SI #3#1 > #22#58;  #22#58 = #3#1;  |FINSI;
  |SI #3#1 > #23#58;  #23#58 = #3#1;  |FINSI;
  |SI #3#1 > #24#58;  #24#58 = #3#1;  |FINSI;
  |SI #3#1 > #25#58;  #25#58 = #3#1;  |FINSI;
  |SI #3#1 > #26#58;  #26#58 = #3#1;  |FINSI;
  |SI #3#0 ! 0;|Y #3#0 ! 99;
      ini = #30#11;
      fecalf = #3#1;
      mes = fecalf % 402;
      mesfec = mes;
      mesac = (mesfec - ini) + 1;
      |SI mesac [ 0;
          mesac = (13 - ini) + mesfec;
      |FINSI;
      a = (mesac * 3) + 9;
      b = a + 1;
      c = a + 2;
      |SI #3#8 = "D";
          #1a    = #1a    + #3#9;
          #1c    = #1a    - #1b;
          #21a   = #21a   + #3#9;
          #21c   = #21a   - #21b;
          #22a   = #22a   + #3#9;
          #22c   = #22a   - #22b;
          #23a   = #23a   + #3#9;
          #23c   = #23a   - #23b;
          #24a   = #24a   + #3#9;
          #24c   = #24a   - #24b;
          #25a   = #25a   + #3#9;
          #25c   = #25a   - #25b;
          #26a   = #26a   + #3#9;
          #26c   = #26a   - #26b;
          |ACABA;
      |FINSI;
      #1b    = #1b    + #3#9;
      #1c    = #1a    - #1b;
      #21b   = #21b   + #3#9;
      #21c   = #21a   - #21b;
      #22b   = #22b   + #3#9;
      #22c   = #22a   - #22b;
      #23b   = #23b   + #3#9;
      #23c   = #23a   - #23b;
      #24b   = #24b   + #3#9;
      #24c   = #24a   - #24b;
      #25b   = #25b   + #3#9;
      #25c   = #25a   - #25b;
      #26b   = #26b   + #3#9;
      #26c   = #26a   - #26b;
      |ACABA;
  |FINSI;
  |SI #3#0 = 0;
      |SI #3#8 = "D";
          #1#9   = #1#9   + #3#9;
          #1#11  = #1#9   - #1#10;
          #21#9  = #21#9  + #3#9;
          #21#11 = #21#9  - #21#10;
          #22#9  = #22#9  + #3#9;
          #22#11 = #22#9  - #22#10;
          #23#9  = #23#9  + #3#9;
          #23#11 = #23#9  - #23#10;
          #24#9  = #24#9  + #3#9;
          #24#11 = #24#9  - #24#10;
          #25#9  = #25#9  + #3#9;
          #25#11 = #25#9  - #25#10;
          #26#9  = #26#9  + #3#9;
          #26#11 = #26#9  - #26#10;
          |ACABA;
      |FINSI;
      #1#10  = #1#10  + #3#9;
      #1#11  = #1#9   - #1#10;
      #21#10 = #21#10 + #3#9;
      #21#11 = #21#9  - #21#10;
      #22#10 = #22#10 + #3#9;
      #22#11 = #22#9  - #22#10;
      #23#10 = #23#10 + #3#9;
      #23#11 = #23#9  - #23#10;
      #24#10 = #24#10 + #3#9;
      #24#11 = #24#9  - #24#10;
      #25#10 = #25#10 + #3#9;
      #25#11 = #25#9  - #25#10;
      #26#10 = #26#10 + #3#9;
      #26#11 = #26#9  - #26#10;
      |ACABA;
  |FINSI;
  |SI #3#8 = "D";
      #1#48 = #1#48 + #3#9;
      #1#50 = #1#48 - #1#49;
      #21#48 = #21#48 + #3#9;
      #21#50 = #21#48 - #21#49;
      #22#48 = #22#48 + #3#9;
      #22#50 = #22#48 - #22#49;
      #23#48 = #23#48 + #3#9;
      #23#50 = #23#48 - #23#49;
      #24#48 = #24#48 + #3#9;
      #24#50 = #24#48 - #24#49;
      #25#48 = #25#48 + #3#9;
      #25#50 = #25#48 - #25#49;
      #26#48 = #26#48 + #3#9;
      #26#50 = #26#48 - #26#49;
      |ACABA;
  |FINSI;
  #1#49  = #1#49  + #3#9;
  #1#50  = #1#48  - #1#49;
  #21#49 = #21#49 + #3#9;
  #21#50 = #21#48 - #21#49;
  #22#49 = #22#49 + #3#9;
  #22#50 = #22#48 - #22#49;
  #23#49 = #23#49 + #3#9;
  #23#50 = #23#48 - #23#49;
  #24#49 = #24#49 + #3#9;
  #24#50 = #24#48 - #24#49;
  #25#49 = #25#49 + #3#9;
  #25#50 = #25#48 - #25#49;
  #26#49 = #26#49 + #3#9;
  #26#50 = #26#48 - #26#49;
|FPRC;

|PROCESO defect1;
  |ABRE #5;
  uno = #1#0;
  |QBF uno;
  dos = uno + "000000000000";
  uno = dos % A101;
  #5#0 = uno;
  |LEE 000#5=;
  |SI FSalida = 0;
      |HAZ saca1;
  |SINO;
      uno = dos % A102;
      #5#0 = uno;
      |LEE 000#5=;
      |SI FSalida = 0;
          |HAZ saca1;
      |SINO;
          uno = dos % A103;
          #5#0 = uno;
          |LEE 000#5=;
          |SI FSalida = 0;
              |HAZ saca1;
          |SINO;
              uno = dos % A104;
              #5#0 = uno;
              |LEE 000#5=;
              |SI FSalida = 0;
                  |HAZ saca1;
              |SINO;
                  |MENAV mensa2;
              |FINSI;
          |FINSI;
      |FINSI;
  |FINSI;
  nivel = #1#1;
|| la 3a clave esta formada por la cta + zzzz y el campo fantasma del nivel;
  mascara = #1#0;
  |QBF mascara;
  mascara = mascara +"zzzzzzzzzzzz";
  mascara = mascara % 112;
  #1#54    = mascara;
  #1#55    = nivel;
  |CIERRA #5;
|FPRC;

|PROCESO saca1;
  #1#4 = #5#1;
  #1#5 = #5#2;
  #1#6 = #5#3;
  #1#7 = #5#4;
  #1#8 = #5#5;
|FPRC;
