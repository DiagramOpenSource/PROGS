|FICHEROS;
  cientcon #0;
  cacuenta #2;
  cacuentp #70;
  caclipro #71;
|FIN;

|VARIABLES;
  &total = 0;
  &sumal = 0;
  &difer = 0;
  &fec1 = @;
  &fec2 = @;
  &cod_emp1 = "";
  &cod_emp2 = "";
  &clave1 = "";
  &clave2 = "";
  &cod1 = 0;
  &cod2 = 0;
  &empresa = "";
  &dir_fich = "";
  &dig1 = 0;
  &dig3 = 0;
  &dig4 = 0;
  &dig5 = 0;
  &dig6 = 0;
  &dig7 = 0;
  &dig8 = 0;
  &dig9 = 0;
  &work1 = "";
  &tra1 = 0;
  &mes1 = "";
  &dia1 = "";
  &codcon = 0;
  &swerror = 0;
  &empre = 0;
  &ejerc = 0;
  cta = "";
  salidas = 0;
  nada = "";
  ctanum = 0;
  ctaalf = "";
  longnum = "";
  longalf = "";
  nivel = 0;
  sw = 0;
    p_lugar = 0;
    p_cuan3 = 0;
    p_cuan4 = 0;
    p_cuan5 = 0;
    p_alfa1 = "";
    p_alfa2 = "";
    p_alfa3 = "";
    p_alfa4 = "";
    &p_alfa5 = "";
    p_nume1 = 0;
    p_nume2 = 0;
    p_ceros = "";
    p_error = 0;
    p_mensa = "    LONGITUD DE CUENTA FUERA DE NIVEL!";
    cue11 = "";
    cue21 = "";
    &cue31 = "";
    sw_no1 = 0;
    varia_co1 = "";
    desde1 = "";
    hasta1 = "";
    num_campo11 = 0;
    p_nif3 = "";
  &fecapu = @;
  &sigapu = "";
  signo = "";
  ini = 0;
  fecalf = "";
  mes = "";
  mesfec = 0;
  mesac = 0;
  a = 0;
  b = 0;
  c = 0;
  &descri = "";

  modo   = 0;
  aGua4  = "";
  nGua5  = 0;
  nGua6  = 0;
  aGua7  = "";
  nGua8  = 0;
  &ext1 = "";
  &ext2 = "";
|FIN;

|RUTINA pintaimportes;
  |PINTA 0824,"             ";
  |PINTA 0849,"             ";
  |ATRI I;
  |PINTA 0824,sumal;
  |PINTA 0849,difer;
  |ATRI 0;
|FRUT;

|PROCESO entrando;  |TIPO 13;
  |HAZ pintaimportes;
|FPRC;

|PROCESO laslineas;  |TIPO 2;
  |ABRET #2;
  |SI sigapu = "D";
      signo = "H";
  |SINO;
      signo = "D";
  |FINSI;
  #2#0 = #0#4;
  #2#1 = #0#5;
  |LEE 101#2=;
  |SI FSalida = 0;
      ini = dig1;
      fecalf = fecapu;
      mes = fecalf % 402;
      mesfec = mes;
      |SI ini = 1;
          mesac = mesfec;
      |SINO;
          mesac = (mesfec - ini) + 1;
          |SI mesac [ 0;
              mesac = (13 - ini) + mesfec;
          |FINSI;
      |FINSI;
      a = (mesac * 3) + 9;
      b = a + 1;
      c = a + 2;
      |SI signo = "D";
          #2a = #2a +. #0#8;
          #2#51 = #2#51 +. #0#8;
      |SINO;
          #2b = #2b +. #0#8;
          #2#52 = #2#52 +. #0#8;
      |FINSI;
      #2c = #2a - #2b;
      #2#53 = #2#51 - #2#52;
      |SI #2#58 < fecapu;  #2#58 = fecapu;  |FINSI;     || fecha ultimo apunte
      |GRABA 020#2a;
  |FINSI;
  |CIERRAT #2;
  |CIERRAT #2;
  sumal = sumal +. #0#8;
  difer = total - sumal;
  |HAZ pintaimportes;
|FPRC;

|PROCESO elimporte;
  |SI #0#8 = 0;
      |MENAV  "     Debe Introducir un Importe";
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO tipo11;  |TIPO 11;
  |SI FSalida ! 6;  |Y FSalida ! 7;  |Y FSalida ! 1;
      |ACABA;
  |FINSI;
  |SI difer ! 0;
      |MENAV "     ATENCION!  NO Esta Cuadrado el Asiento";
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO tipo3;  |TIPO 3;
  |SI #0#8 = 0;
      |MENAV "     ATENCION!  El importe NO puede ser CERO";
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO leeporni33;
  p_nif3 = "               ";
  p_alfa1 = #2#0;
  p_alfa1 = p_alfa1 % 101;
  |SI p_alfa1 ! "4"; |Y p_alfa1 ! "5";
      |ACABA;
  |FINSI;
  |ABRE #71;
  #71#23 = "C";
  #71#10 = #2#0;
  #71#11 = #2#1;
  |LEE 001#71=;
  |SI FSalida = 0;
      p_nif3 = #71#9;
  |SINO;
      #71#23 = "P";
      #71#10 = #2#0;
      #71#11 = #2#1;
      |LEE 001#71=;
      |SI FSalida = 0;
          p_nif3 = #71#9;
      |FINSI;
  |FINSI;
  |CIERRA #71;
|FPRC;

|PROCESO busca_cue33;
  cue31 = #2#2;
  cue31 = cue31 > cue31;
  cue21 = cue31 - cue11;
  |SI cue21 ! cue31; |Y #2#3 = "S";
      |HAZ leeporni33;
      #70#1 = #2#2;
      #70#2 = #2#0;
      #70#4 = p_nif3;
      |PINTA #70#1;
      |PINTA #70#2;
      |PINTA #70#4;
      |PAUSA;
      |SI FSalida = 1;  sw_no1 = 1;  |ERROR10;  |FINSI;
      |SI FSalida = 7;  |ERROR10;  |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE consult33;
#2#1;
;
desde1 , 0;
hasta1 , 9;
e;
NULL,busca_cue33;
|FIN;

|RUTINA cuet33;
  sw_no1 = 0;
  |PUSHV 0501 2380;
  |DDEFECTO #70;
  |PINPA #0#70;
  |ENDATOS #1#70;
  |SI FSalida = 0;
      |SI #70#0 ] 1; |Y #70#0 [ 7;
          desde1 = #70#0 + "           ";
          hasta1 = #70#0 + "99999999999";
      |SINO;
          |SI #70#0 = "C";
              desde1 = "4300        ";
              hasta1 = "439999999999";
          |FINSI;
          |SI #70#0 = "P";
               desde1 = "4000        ";
               hasta1 = "419999999999";
          |FINSI;
          |SI #70#0 = "T";
              desde1 = "            ";
              hasta1 = "zzzzzzzzzzzz";
          |FINSI;
      |FINSI;
      cue11 = #70#1; |QBF cue11;
      cue11 = cue11 > cue11;
      |MENSA "0000Pulse <Return> Para Seguir, <Esc> Para Aceptar, <Ctrl+C> Para Abandonar";
      |BUCLE consult33;
  |FINSI;
  |POPV;
  |BLIN 4;
  |SI sw_no1 = 1;
      varia_co1 = #2#0;
      |QBF varia_co1;
      #0num_campo11 = varia_co1;
  |SINO;
      #0num_campo11 = p_alfa1;
  |FINSI;
  |PINTA #0num_campo11;
  Campo = num_campo11;
  |ERROR;
|FRUT;

|RUTINA punto33;
  |SI salidas = 18;
      num_campo11 = Campo;
      |HAZ cuet33;
      |ACABA;
  |FINSI;
  p_error = 0;
  p_lugar = 0;
  p_cuan3 = 0;
  p_cuan4 = 0;
  p_alfa3 = "";
  p_alfa4 = "";
  p_alfa4 = p_alfa1 > " ";
  p_alfa1 = p_alfa4;
  p_alfa4 = "";
  |PARA p_nume1 = 1; |SI p_nume1 [ 12; |HACIENDO p_nume1 = p_nume1 + 1;
        p_nume2 = (p_nume1 * 100) + 1;
        p_alfa2 = p_alfa1 % p_nume2;
        |SI p_alfa2 ! " ";
            |SI p_alfa2 = ".";
                p_lugar = p_nume1;
            |SINO;
                |SI p_lugar=0; p_alfa3=p_alfa3+p_alfa2; p_cuan3=p_cuan3+1; |FINSI;
                |SI p_lugar!0; p_alfa4=p_alfa4+p_alfa2; p_cuan4=p_cuan4+1; |FINSI;
            |FINSI;
        |FINSI;
  |SIGUE;
  |SI p_lugar ! 0;
      |SI dig3 = 1;  p_cuan5 = dig4;  |FINSI;
      |SI dig3 = 2;  p_cuan5 = dig5;  |FINSI;
      |SI dig3 = 3;  p_cuan5 = dig6;  |FINSI;
      |SI dig3 = 4;  p_cuan5 = dig7;  |FINSI;
      |SI dig3 = 5;  p_cuan5 = dig8;  |FINSI;
      |SI dig3 = 6;  p_cuan5 = dig9;  |FINSI;
      p_nume1 = p_cuan5 - (p_cuan3 + p_cuan4);
      |SI p_nume1 > 0;
          cue11 = p_alfa4 % 101;
          p_ceros = "0" * p_nume1;
          p_alfa5 = p_alfa3 + p_ceros + p_alfa4;
          cue11 = p_alfa4 % 101;
          |SI cue11 = "U";  |O cue11 = "A";
              cue31 = cue11;
              |HAZ ultialt21;
          |FINSI;
          #0Campo = p_alfa5;
          |PINTA #0Campo;
      |SINO;
          |MENAV p_mensa;
          p_error = 1;
      |FINSI;
  |SINO;
      p_alfa5 = p_alfa1;
  |FINSI;
|FRUT;

|PROCESO eldigito;  |TIPO 6;
  salidas = FSalida;
  p_alfa1 = #0Campo;
  |HAZ punto33;
  |SI p_error ! 0;  |ERROR;  |ACABA;  |FINSI;
  cta = #0Campo;
  |QBF cta;
  nada = cta % A101;
  |SI nada ! "0";
      ctanum = cta;
      ctaalf = ctanum;
      longnum = ctaalf % A0;
  |SINO;
      ctanum = 1;
      ctaalf = cta;
      longnum = ctaalf % A0;
  |FINSI;
  longalf = cta    % A0;
  |SI longnum ! longalf;|O ctanum = 0;
      |MENAV "     CUENTA ERRONEA !!";
      |PINTA #0Campo;
      |ERROR;
      |ACABA;
  |FINSI;
  nivel= 0;
  sw = 0;
  |SI longnum = dig4; sw = 1; nivel = 1; |FINSI;
  |SI longnum = dig5; sw = 1; nivel = 2; |FINSI;
  |SI longnum = dig6; sw = 1; nivel = 3; |FINSI;
  |SI longnum = dig7; sw = 1; nivel = 4; |FINSI;
  |SI longnum = dig8; sw = 1; nivel = 5; |FINSI;
  |SI longnum = dig9; sw = 1; nivel = 6; |FINSI;
  |SI sw = 0;
      |MENAV "     LONGITUD DE CUENTA FUERA DE NIVEL !";
      |PINTA #0Campo;
      |ERROR;
      |ACABA;
  |FINSI;
  #0#5 = nivel;
  |ABRET #2;
  #2#0 = #0#4;
  #2#1 = #0#5;
  |LEE 101#2=;
  |SI FSalida = 0;
     |SI #2#3 ! "S";
        |MENAV "     LA CUENTA NO ES DE PASE DIRECTO";
        |ERROR;
        |ACABA;
     |FINSI;
  |FINSI;
  |CIERRAT #2;
|FPRC;


|PROCESO sacacuenta;
  |SI salidas  = 9;
      ext1 = #0#4;
      ext2 = #0#5;
      |SUB_EJECUTA "caextrap"
      salidas = 0;
  |FINSI;
  |ABRET #2;
  #2#0 = #0#4;
  #2#1 = #0#5;
  |LEE 001#2=;
  |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
  |CIERRAT #2;
  |ATRI I;
  |PINTA 2203, #2#2;
  |PINTA 2240, #2#51;
  |PINTA 2254, #2#52;
  |PINTA 2268, #2#53;
  |ATRI 0;
|FPRC;

|PROCESO duplica;
  |SI FSalida = 9;
      #0#7 = descri;
      |PINTA #0#7;
  |FINSI;
  descri = #0#7;
|FPRC;

|PROCESO guardaP; |TIPO 3;
     aGua4  = #0#4;
     nGua5  = #0#5;
     nGua6  = #0#6;
     aGua7  = #0#7;
     nGua8  = #0#8;
|FPRC;

|PROCESO Coge4; |TIPO 7;                || desce campo 'Concepto'
     modo = (FEntrada / 100) ! 0;
     |SI modo  ! 1;  |ACABA;   |FINSI;
     |SI aGua4 = ""; |ACABA;   |FINSI;

     #0#4 = aGua4;
     #0#5 = nGua5;

     |PINTA #0#4;
|FPRC;

|PROCESO Coge6; |TIPO 7;                || desce campo 'Concepto'
     modo = (FEntrada / 100) ! 0;
     |SI modo  ! 1;  |ACABA;   |FINSI;
     |SI nGua6 = 0;  |ACABA;   |FINSI;

     #0Campo = nGua6;
     |PINTA #0Campo;
|FPRC;

|PROCESO Coge7; |TIPO 7;                || desce campo 'Descrp.2'
     modo = (FEntrada / 100) ! 0;
     |SI modo ! 1;  |PTEC 816;  |ACABA;  |FINSI;

     |SI #0#6 = nGua6;
         #0#7 = aGua7;
         |PINTA #0Campo;
     |FINSI;
     |PTEC 816;
|FPRC;

|PROCESO Coge8; |TIPO 7;                || desce campo 'Concepto'
     modo = (FEntrada / 100) ! 0;
     |SI modo  ! 1;  |ACABA;   |FINSI;
     |SI nGua8 = 0;  |ACABA;   |FINSI;

     #0Campo = nGua8;
     |PINTA #0Campo;
|FPRC;


|PROCESO ultialt21;
  |ABRE #2;
  p_nume2 = p_alfa3;
  p_nume2 = p_nume2 + 1;
  cue11 = p_nume2;
  #2#0 = cue11;
  #2#1 = "0";
  |LEE 021#2];
  |SI FSalida ! 0;
      |LEE 021#2u;
  |SINO;
      |LEE 021#2a;
      |SI FSalida ! 0;
          |LEE 021#2p;
      |FINSI;
  |FINSI;
  cue21 = p_alfa3 % 0;
  p_nume2 = cue21;
  p_nume2 = p_nume2 + 100;
  cue11 = p_nume2;
  cue21 = #2#0 % cue11;
  |SI cue21 = p_alfa3;
      cue21 = #2#0;
      p_nume2 = cue21;
      |SI cue31 = "A";
          p_nume2 = p_nume2 + 1;
      |FINSI;
      p_alfa5 = p_nume2;
  |SINO;
      p_ceros = "0" * p_nume1;
      p_alfa5 = p_alfa3 + p_ceros + "1";
  |FINSI;
  |DDEFECTO #2;
|FPRC;
