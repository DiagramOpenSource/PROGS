|FICHEROS;
    caxactim #0;
    caxcontr #1;    || control expor./impor.
    camaasil #2;    || apuntes lins.
    exmaasil #3;    || apuntes lins. (exportacion)
    caivarep #4;    || repercutido
    exivarep #5;    || repercutido (exportacion)
    caivasop #6;    || soportado
    exivasop #7;    || soportado (exportacion)
    camancob #8;    || cobros
    exmancob #9;    || cobros (exportacion)
    camanpag #10;   || pagos
    exmanpag #11;   || pagos (exportacion)
    cacuenta #12;   || plan contable
    excuenta #13;   || plan contable (exportacion)
    camaasic #14;   || apuntes cabs.
    caconasi #20;   || contador de asientos
    calibros #21;   || actualizacion libros de iva
    catradia #22;   || actualizacion niveles inferiores
    camandia #23;   || actualizacion diarios
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    FEstado = 0;
    seleccio = 0;

    fiche = "";
    direc = "";
    sel_apun = 0;
    sel_repe = 0;
    sel_sopo = 0;
    sel_cobr = 0;
    sel_pago = 0;
    sel_cuen = 0;

    c_camaasil = 23;
    c_caivarep = 62;
    c_caivasop = 61;
    c_camancob = 27;
    c_caivapag = 26;
    c_cacuenta = 59;

    modcon = 0;
    importe = 0;
    opera = "";

    ini = 0;
    fecalf = "";
    mes = "";
    mesfec = 0;
    mesac = 0;
    a = 0;
    b = 0;
    c = 0;
    signo = "";
    swfecha = 0;
    fabre = "";
    fpath = "";
    field = "";
    field1 = "";
    field2 = "";
    fcanl = "";
|FIN;

|INCLUYE acceso_i;

|PROCESO mayus;
  #0Campo = #0Campo > " ";
  |PINTA #0Campo;
|FPRC;

____________________________________/ CALCULOS DE PANTALLA
|PROCESO ver_tipo; |TIPO 8;
|ABRE #1;
|LEE 000#1p;
|SI FSalida = 0;
    |SI #1#1 = "E";
        |MENAV "    Control configurado para la Exportacion ...";
        |PTEC 807;
    |SINO;
        |HAZ inicio;
        |HAZ inicial;
    |FINSI;
|SINO;
    |MENAV "    Debera definir el Control de Exportaciones/Importaciones ...";
    |PTEC 807;
|FINSI;
|CIERRA #1;
|FPRC;

|PROCESO importa; |TIPO 3;
  |SI #0#0 ! "SI";  |ACABA;  |FINSI;
  |DFICE fpath;   fpath = "rb  " + fpath; |QBF fpath;
  |SI #1#2 = "S";  |HAZ apuntes0;                  |FINSI;
      |SI swfecha = 1; |ACABA; |FINSI;
  |SI #1#5 = "S";  |HAZ cuentas0;                  |FINSI;
  |SI #1#3 = "S";  |HAZ repercu0;  |HAZ soporta0;  |FINSI;
  |SI #1#4 = "S";  |HAZ cobros0;   |HAZ pagos0;    |FINSI;
  |SI sel_apun = 0;|Y sel_repe = 0;|Y sel_sopo = 0;|Y sel_cobr = 0;
                   |Y sel_pago = 0;|Y sel_cuen = 0;
      |MENAV "    Importacion vacia ...";
  |SINO;
      |SI #1#2 = "S";  |HAZ termino;  |FINSI;
  |FINSI;
|FPRC;
____________________________________/ IMPORTACION DE APUNTES
|PROCESO apuntes4;
|DDEFECTO #20;
|ABRE #20;
|LEE 101#20p;
|SI FSalida ! 0;  |GRABA 020#20b;  |FINSI;
|SI #14#2 > #20#1;
        #20#1 = #14#2;
    |GRABA 020#20a;
|FINSI;
|LIBERA #20;
|CIERRA #20;
|FPRC;

|PROCESO apuntes3;
|DDEFECTO #14;
    #14#0 = #2#0;
    #14#1 = #2#1;
    #14#2 = #2#2;
|LEE 101#14=;
    FEstado = FSalida;
    #14#0 = #2#0;         || diario
    #14#1 = #2#1;         || fecha
    #14#2 = #2#2;         || documento
    #14#3 = #14#2;        || asiento
|SI #2#8 = "D";
        #14#4 = #14#4 + #2#9;
    |SI #14#09 = 0; #14#08 = #2#4; #14#09 = #2#5; |FINSI;      || contrp.HABER
|FINSI;
|SI #2#8 = "H";
        #14#5 = #14#5 + #2#9;
    |SI #14#11 = 0; #14#10 = #2#4; #14#11 = #2#5; |FINSI;      || contrp.DEBE
|FINSI;
    #14#6 = #14#4 - #14#5;
|SI FEstado = 0;  |GRABA 020#14a;  |FINSI;
|SI FEstado ! 0;  |GRABA 020#14n;  |FINSI;
|LIBERA #14;
|FPRC;

|PROCESO apuntes_lin_1;
|DDEFECTO #3;
    nume2 = 1;
|PARA para1 = 0; |SI para1 [ c_camaasil; |HACIENDO para1 = para1 + 1;
        alfa1 = #3para1;
        alfa1 = alfa1 % 0;
        nume1 = alfa1;
        nume3 = (nume2 * 100) + nume1;
        nume2 = nume2 + nume1;
        alfa1 = field % nume3;
        #2para1 = alfa1;
|SIGUE;
  |SI #2#1 < fec1; |O #2#1 > fec2;
     swfecha = 1;
     |MENAV "    ERROR!, LOS DATOS A IMPORTAR NO CORRESPONDEN AL EJERCICIO";
     |ACABA;
 |FINSI;
|GRABA 000#2n;
|SI FSalida = 0;
    |HAZ apuntes3;
    |HAZ apuntes4;
        opera = "A";
    |HAZ altatra;
    |HAZ actualiz;
    |HAZ diario;
        #0#4 = #2#1;     |PINTA #0#4;
        sel_apun = 1;
|FINSI;
|FPRC;

|PROCESO apuntes0;
    #0#3 = "APUNTES     ";
|PINTA #0#3;
    fabre = fpath + "exmaasil.asc";
|FABRE fabre;
|SI FSalida ] 0;
        fcanl = FSalida;
    |ABRE #2;
    |ABRE #14;
    |PARA; |SI; |HACIENDO;
            field = fcanl + " 125";
        |FLEE field;
        |SI FSalida > 0;
            |HAZ apuntes_lin_1;
            |SI swfecha = 1; |SAL; |FINSI;
        |SINO;
            |SAL;
        |FINSI;
    |SIGUE;
    |CIERRA #2;
    |CIERRA #14;
    |FCIERRA fcanl;
|FINSI;
    Pos = -1;
|FPRC;
____________________________________/ IMPORTACION DE REPERCUTIDO
|PROCESO repercu3;
|DDEFECTO #21;
|ABRE #21;
    #21#0 = #4#0;
|LEE 000#21=;
|SI FSalida ! 0;
        #21#0 = #4#0;
        #21#1 = "[IVA REPERCUTIDO]";
        #21#2 = "R";
    |GRABA 020#21n;
|FINSI;
|CIERRA #21;
|FPRC;

|PROCESO repercu2;
|DDEFECTO #5;
    nume2 = 1;
|PARA para1 = 0; |SI para1 [ 34; |HACIENDO para1 = para1 + 1;
        alfa1 = #5para1;
        alfa1 = alfa1 % 0;
        nume1 = alfa1;
        nume3 = (nume2 * 100) + nume1;
        nume2 = nume2 + nume1;
        alfa1 = field % nume3;
        #4para1 = alfa1;
|SIGUE;
    nume2 = 1;
|PARA para1 = 35; |SI para1 [ c_caivarep; |HACIENDO para1 = para1 + 1;
        alfa1 = #5para1;
        alfa1 = alfa1 % 0;
        nume1 = alfa1;
        nume3 = (nume2 * 100) + nume1;
        nume2 = nume2 + nume1;
        alfa1 = field1 % nume3;
        #4para1 = alfa1;
|SIGUE;
|GRABA 000#4n;
|SI FSalida = 0;
        #0#4 = #4#3;     |PINTA #0#4;
        sel_repe = 1;
    |HAZ repercu3;
|FINSI;
|FPRC;

|PROCESO repercu0;
    #0#3 = "REPERCUTIDO ";
|PINTA #0#3;
    fabre = fpath + "exivarep.asc";
|FABRE fabre;
|SI FSalida ] 0;
        fcanl = FSalida;
    |ABRE #4;
    |PARA; |SI; |HACIENDO;
            field = fcanl + " 239";
        |FLEE field;
        |SI FSalida > 0;
                field1 = fcanl + " 227";
            |FLEE field1;
            |HAZ repercu2;
        |SINO;
            |SAL;
        |FINSI;
    |SIGUE;
    |CIERRA #4;
    |FCIERRA fcanl;
|FINSI;
    Pos = -1;
|FPRC;
____________________________________/ IMPORTACION DE SOPORTADO
|PROCESO soporta3;
|DDEFECTO #21;
|ABRE #21;
    #21#0 = #6#0;
|LEE 000#21=;
|SI FSalida ! 0;
        #21#0 = #6#0;
        #21#1 = "[IVA SOPORTADO]";
        #21#2 = "S";
    |GRABA 020#21n;
|FINSI;
|CIERRA #21;
|FPRC;

|PROCESO soporta2;
|DDEFECTO #7;
    nume2 = 1;
|PARA para1 = 0; |SI para1 [ 34; |HACIENDO para1 = para1 + 1;
        alfa1 = #7para1;
        alfa1 = alfa1 % 0;
        nume1 = alfa1;
        nume3 = (nume2 * 100) + nume1;
        nume2 = nume2 + nume1;
        alfa1 = field % nume3;
        #6para1 = alfa1;
|SIGUE;
    nume2 = 1;
|PARA para1 = 35; |SI para1 [ c_caivasop; |HACIENDO para1 = para1 + 1;
        alfa1 = #7para1;
        alfa1 = alfa1 % 0;
        nume1 = alfa1;
        nume3 = (nume2 * 100) + nume1;
        nume2 = nume2 + nume1;
        alfa1 = field1 % nume3;
        #6para1 = alfa1;
|SIGUE;
|GRABA 000#6n;
|SI FSalida = 0;
        #0#4 = #6#3;     |PINTA #0#4;
        sel_sopo = 1;
    |HAZ soporta3;
|FINSI;
|FPRC;

|PROCESO soporta0;
    #0#3 = "SOPORTADO   ";
|PINTA #0#3;
    fabre = fpath + "exivasop.asc";
|FABRE fabre;
|SI FSalida ] 0;
        fcanl = FSalida;
    |ABRE #6;
    |PARA; |SI; |HACIENDO;
            field = fcanl + " 239";
        |FLEE field;
        |SI FSalida > 0;
                field1 = fcanl + " 223";
            |FLEE field1;
            |SI FSalida > 0;  |HAZ soporta2; |FINSI;
        |SINO;
            |SAL;
        |FINSI;
    |SIGUE;
    |CIERRA #6;
    |FCIERRA fcanl;
|FINSI;
    Pos = -1;
|FPRC;
____________________________________/ IMPORTACION DE COBROS
|PROCESO cobros2;
|DDEFECTO #9;
    nume2 = 1;
|PARA para1 = 0; |SI para1 [ 21; |HACIENDO para1 = para1 + 1;
        alfa1 = #9para1;
        alfa1 = alfa1 % 0;
        nume1 = alfa1;
        nume3 = (nume2 * 100) + nume1;
        nume2 = nume2 + nume1;
        alfa1 = field % nume3;
        #8para1 = alfa1;
|SIGUE;
    nume2 = 1;
|PARA para1 = 22; |SI para1 [ c_camancob; |HACIENDO para1 = para1 + 1;
        alfa1 = #9para1;
        alfa1 = alfa1 % 0;
        nume1 = alfa1;
        nume3 = (nume2 * 100) + nume1;
        nume2 = nume2 + nume1;
        alfa1 = field1 % nume3;
        #8para1 = alfa1;
|SIGUE;
|GRABA 000#8n;
|SI FSalida = 0;
        #0#4 = #8#6;     |PINTA #0#4;
        sel_cobr = 1;
|FINSI;
|FPRC;

|PROCESO cobros0;
    #0#3 = "COBROS      ";
|PINTA #0#3;
    fabre = fpath + "exmancob.asc";
|FABRE fabre;
|SI FSalida ] 0;
        fcanl = FSalida;
    |ABRE #8;
    |PARA; |SI; |HACIENDO;
            field = fcanl + " 222";
        |FLEE field;
        |SI FSalida > 0;
                field1 = fcanl + " 79";
            |FLEE field1;
            |SI FSalida > 0;  |HAZ cobros2;  |FINSI;
        |SINO;
            |SAL;
        |FINSI;
    |SIGUE;
    |CIERRA #8;
    |FCIERRA fcanl;
|FINSI;
    Pos = -1;
|FPRC;
____________________________________/ IMPORTACION DE PAGOS
|PROCESO pagos2;
|DDEFECTO #11;
    nume2 = 1;
|PARA para1 = 0; |SI para1 [ c_caivapag; |HACIENDO para1 = para1 + 1;
        alfa1 = #11para1;
        alfa1 = alfa1 % 0;
        nume1 = alfa1;
        nume3 = (nume2 * 100) + nume1;
        nume2 = nume2 + nume1;
        alfa1 = field % nume3;
        #10para1 = alfa1;
|SIGUE;
|GRABA 000#10n;
|SI FSalida = 0;
        #0#4 = #10#6;    |PINTA #0#4;
        sel_pago = 1;
|FINSI;
|FPRC;

|PROCESO pagos0;
    #0#3 = "PAGOS       ";
|PINTA #0#3;
|ABRE #10;
    fabre = fpath + "exmanpag.asc";
|FABRE fabre;
|SI FSalida ] 0;
        fcanl = FSalida;
    |ABRE #10;
    |PARA; |SI; |HACIENDO;
            field = fcanl + " 254";
        |FLEE field;
        |SI FSalida > 0;
            |HAZ pagos2;
        |SINO;
            |SAL;
        |FINSI;
    |SIGUE;
    |CIERRA #10;
    |FCIERRA fcanl;
|FINSI;
    Pos = -1;
|FPRC;
____________________________________/ IMPORTACION DE CUENTAS
|PROCESO cuentas2;
|DDEFECTO #13;
    nume2 = 1;
|PARA para1 = 0; |SI para1 [ 23; |HACIENDO para1 = para1 + 1;
        alfa1 = #13para1;
        alfa1 = alfa1 % 0;
        nume1 = alfa1;
        nume3 = (nume2 * 100) + nume1;
        nume2 = nume2 + nume1;
        alfa1 = field % nume3;
        #12para1 = alfa1;
|SIGUE;
    nume2 = 1;
|PARA para1 = 24; |SI para1 [ 44; |HACIENDO para1 = para1 + 1;
        alfa1 = #13para1;
        alfa1 = alfa1 % 0;
        nume1 = alfa1;
        nume3 = (nume2 * 100) + nume1;
        nume2 = nume2 + nume1;
        alfa1 = field1 % nume3;
        #12para1 = alfa1;
|SIGUE;
    nume2 = 1;
|PARA para1 = 45; |SI para1 [ c_cacuenta; |HACIENDO para1 = para1 + 1;
        alfa1 = #13para1;
        alfa1 = alfa1 % 0;
        nume1 = alfa1;
        nume3 = (nume2 * 100) + nume1;
        nume2 = nume2 + nume1;
        alfa1 = field2 % nume3;
        #12para1 = alfa1;
|SIGUE;
|GRABA 000#12n;
|SI FSalida = 0;
        sel_cuen = 1;
|FINSI;
|FPRC;

|PROCESO cuentas0;
  #0#3 = "CUENTAS     ";
  #0#4 = "01.01.0001";
  |PINTA #0#3;
  |PINTA #0#4;
  fabre = fpath + "excuenta.asc";
  |FABRE fabre;
  |SI FSalida < 0;  Pos = -1;  |ACABA;  |FINSI;
  fcanl = FSalida;
  |ABRE #12;
  |PARA; |SI; |HACIENDO;
         field = fcanl + " 238";
         |FLEE field;
         |SI FSalida [ 0;  |SAL;  |FINSI;
         field1 = fcanl + " 252";
         |FLEE field1;
         |SI FSalida > 0;
             field2 = fcanl + " 152";
             |FLEE field2;
             |SI FSalida > 0;   |HAZ cuentas2; |FINSI;
         |FINSI;
  |SIGUE;
  |CIERRA #12;
  |FCIERRA fcanl;
  Pos = -1;
|FPRC;
____________________________________/ ACTUALIZACION DE CUENTAS
|PROCESO inicial;
|ABRE #22;
|LEE 101#22u;
|SI FSalida ! 0;
    |DDEFECTO #22;
        #22#0 = 1;
|SINO;
        #22#0 = #22#0 + 1;
|FINSI;
|GRABA 101#22n;
    codcon = #22#0;
|LIBERA #22;
|CIERRA #22;
|FPRC;

|PROCESO termino;
|SI modcon = 0;
    |ABRET #22;
    |DDEFECTO #22;
        #22#0 = codcon;
    |LEE 040#22=;
    |BORRA 101#22a;
    |CIERRAT #22;
|SINO;
    |SUB_EJECUTA "camaapua.run"
|FINSI;
|FPRC;

|PROCESO altatra;
    modcon = 1;
|ABRE #22;
    #22#0 = codcon;
    #22#0 = codcon;
    #22#1 = #2#4;    || cuenta
    #22#2 = #2#5;    || digito
    #22#3 = #2#1;    || fecha
    #22#4 = #2#8;    || signo
    #22#6 = #2#0;    || diario
|LEE 101#22=;
|SI FSalida ! 0;
    |DDEFECTO #22;
        #22#0 = codcon;
        #22#1 = #2#4;    || cuenta
        #22#2 = #2#5;    || digito
        #22#3 = #2#1;    || fecha
        #22#4 = #2#8;    || signo
        #22#6 = #2#0;    || diario
    |GRABA 020#22b;
|FINSI;
    importe = #2#9;      || importe
|SI opera = "B";
        importe = -importe;
|FINSI;
    #22#5 = #22#5 + importe;
|GRABA 020#22a;
|LIBERA #22;
|CIERRA #22;
|FPRC;

|PROCESO actualiz;
|ABRE #12;
    #12#0 = #2#4;
    #12#1 = #2#5;
|LEE 101#12=;
|SI FSalida = 0;
    |SI #2#0 = 0;
        |SI #2#8 = "D";
                #12#9 = #12#9 +. #2#9;        || diario cero (saldos iniciales)
                #12#51 = #12#51 +. #2#9;
        |SINO;
                #12#10 = #12#10 +. #2#9;
                #12#52 = #12#52 +. #2#9;
        |FINSI;
            #12#11 = #12#9 - #12#10;
            #12#53 = #12#51 - #12#52;
    |SINO;
        |SI #2#0 = 99;
            |SI #2#8 = "D";
                    #12#48 = #12#48 +. #2#9;       || diario 99 (saldos finales)
                    #12#51 = #12#51 +. #2#9;
            |SINO;
                    #12#49 = #12#49 +. #2#9;
                    #12#52 = #12#52 +. #2#9;
            |FINSI;
                #12#50 = #12#48 - #12#49;
                #12#53 = #12#51 - #12#52;
        |SINO;
            |HAZ actualiz2;
        |FINSI;
    |FINSI;
    |SI #12#58 < #2#1;
            #12#58 = #2#1;               || fecha ultimo apunte
    |FINSI;
    |GRABA 020#12a;
|FINSI;
|LIBERA #12;
|CIERRA #12;
|FPRC;

|PROCESO actualiz2;
    ini = dig1;
    fecalf = #2#1;
    mes = fecalf % 402;
    mesfec = mes;
|SI ini = 1;
        mesac = mesfec;
|SINO;
        mesac = (mesfec - ini) + 1;
    |SI mesac [ 0;
            mesac = (13 - ini) + mesfec;
    |FINSI;
|FINSI;
    a = (mesac * 3) + 9;
    b = a + 1;
    c = a + 2;
|SI #2#8 = "D";
        #12a = #12a +. #2#9;
        #12#51 = #12#51 +. #2#9;
|SINO;
        #12b = #12b +. #2#9;
        #12#52 = #12#52 +. #2#9;
|FINSI;
    #12c = #12a - #12b;
    #12#53 = #12#51 - #12#52;
|FPRC;

|PROCESO diario;
|ABRE #23;
    #23#0 = #2#0;
|LEE 101#23=;
|SI FSalida ! 0;              || actualiza el diario
    |DDEFECTO #23;
        #23#0 = #2#0;
        #23#1 = "[DIARIO SIN DEFINIR]";
    |GRABA 020#23b;
|FINSI;
|SI #2#8 = "D";  #23#2 = #23#2 + #2#9;  |FINSI;
|SI #2#8 = "H";  #23#3 = #23#3 + #2#9;  |FINSI;
|GRABA 020#23a;
|LIBERA #23;
|CIERRA #23;
|FPRC;
