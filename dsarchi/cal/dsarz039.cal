|FICHEROS;
     dsarz039;
     dsarm001;
     dsarm005;
     dsarm034;
     dsarz010;
     dpntm100;
     dpntm101;

     dsarw074;

     :contagen/canempre;

     dsarm034@;
|FIN;

|VARIABLES;
     aUsuario             = "";
     aEsc1                = "";
     aEsc2                = "";
     aRetu                = "";
     aTecla               = "";
     aAlfa                = "";
     aMas                 = "";
     aFicTmp              = "";
     aVerde               = "";
     aColor               = "";
     aTipo                = "";
     aTipoBan             = "";
     aBase                = "";
     aPathDatos           = "";

     nPanta939            = 0;
     nVentana             = 0;
     nVentTra             = 0;
     n1Vent               = 0;
     n2Vent               = 0;
     nCampo               = 0;
     nEmpresa             = 0;
     nPeriodo             = 0;
     nPdtesEnvi           = 0;
     nPdtesPlan           = 0;
     nPdtesInte           = 0;
     nPdtesVali           = 0;
     nPdtesCont           = 0;
     nGrid                = -1;
     nGridTra             = -1;
     nRango               = -1;
     nSalir               = -1;
     nSituacion           = 0;
     nLabelTit            = -1;
     nLabelPdte           = -1;
     nLabelEnvi           = -1;
     nLabelInte           = -1;
     nLabelVali           = -1;
     nLabelCont           = -1;
     nBotonPdte           = -1;
     nBotonEnvi           = -1;
     nBotonInte           = -1;
     nBotonVali           = -1;
     nPasada              = -1;
     nNoPasaOCR           = 0;

     {-1}aVent            = "";
         aVent1           = 0;
         aVent2           = 0;
         aVent3           = 0;
         aVent4           = 0;
         aVent5           = "";

     &Tempo               = "";
     &eaTitulo            = "";
     &enTemporal          = 0;
     &efFechaOCR          = @;
     &eaHoraOCR           = "";
     &eaPrograma          = "";
     &enAprobacion        = 0;
|FIN;

|PROCESO dsarm034Env;
     |PARA nCampo = 0;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
           #dsarm034@#nCampo# = #dsarm034#nCampo#;
     |SIGUE;

     aAlfa = #dsarm034#24;  |QBF aAlfa;
     |SI aAlfa = "";
         #dsarm034@#23 = #dsarm034#0;
         #dsarm034@#24 = #dsarm034#1;
         #dsarm034@#25 = #dsarm034#6;
     |FINSI;

     #dsarm034@#15 = "";
     |GRABA 020#dsarm034@.n;
     |LIBERA #dsarm034@;
|FPRC;

|DEFBUCLE dsarm034Env;
     #dsarm034#7;
     17, 7;
     "N",          0, aTipoBan, 0;
     "N",  999999999, aTipoBan, 0;
     ;
     NULL, dsarm034Env;
|FIN;

|PROCESO EvtoGrid1;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsarm034@.=;
     |FINSI;

     |SI FSalida = 4;
         |LEE 101#dsarm034@.=;

         aAlfa = #dsarm034@#15;  |QBF aAlfa;
         |SI aAlfa = "";
             #dsarm034@#15 = aVerde;
         |SINO;
             #dsarm034@#15 = "";
         |FINSI;

         |GRABA 020#dsarm034@.a;
         |LIBERA #dsarm034@;

         |REFRESCACONTROL nGridTra;
     |FINSI;
|FPRC;

|PROCESO dsarm034Tempo;
     |SI nPasada = 0;
         #dsarm034@#15 = aColor;

         |GRABA 020#dsarm034@.a;
         |LIBERA #dsarm034@;
     |FINSI;

     |SI nPasada = 1;
         aAlfa = #dsarm034@#15;  |QBF aAlfa;
         |SI aAlfa ! aVerde;  |ACABA;  |FINSI;

         efFechaOCR = #dsarm034@#0;
         eaHoraOCR  = #dsarm034@#1;

         aAlfa = "dsarz013;MANDAOCR" + #dsarm034@#16;
         |SUB_EJECUTA aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm034Tempo;
     #dsarm034@#1003;
     17;
     "01.01.0000", "     ", "                    ", aTipoBan;
     "31.12.9999", "zzzzz", "zzzzzzzzzzzzzzzzzzzz", aTipoBan;
     be;
     NULL, dsarm034Tempo;
|FIN;

|PROCESO Activar;
     aColor  = aVerde;
     nPasada = 0;
     |BUCLE dsarm034Tempo;

     |REFRESCACONTROL nGridTra;
|FPRC;

|PROCESO Desactivar;
     aColor  = "";
     nPasada = 0;
     |BUCLE dsarm034Tempo;

     |REFRESCACONTROL nGridTra;
|FPRC;

|PROCESO VerDoc;
     |VENTANA 0501, 0540, -1, 16, "Visualizando documento";
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |SI #dsarz039#0 = "R";
         aAlfa = "dsarz038;VERDOC" + #dsarm034@#16;
     |FINSI;

     |SI #dsarz039#0 = "E";
         aAlfa = "dsarz049;VERDOC" + #dsarm034@#16;
     |FINSI;

     |SUB_EJECUTA_NP aAlfa;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;
|FPRC;

|PROCESO Enviar;
     aVerde = "0,185,0;255,255,255";

     |DBASE aMas;  |QBF aMas;
     aMas = aMas + "def/dsarm034.mas";
     |CARGA_DEF aMas, dsarm034@;

     aFicTmp = "dsarm034" + Usuario;
     |NOME_DAT #dsarm034@#aFicTmp#;
     |ABRE #dsarm034@;  |CIERRA #dsarm034@;  |DELINDEX #dsarm034@;

     |ABRE #dsarm034@;
     |SELECT #1#dsarm034@;
     |BUCLE dsarm034Env;

     |VENTANA 0501, 3299, -1, 16, "Seleccionar registros";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |CONTROL_SIMPLE 0, "LABEL,{{16}}Doble click en el registro para activarlo o desactivarlo", 0502, 0580, NULL;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Todos activados", 3102, 3120, Activar;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Todos desactivados", 3122, 3140, Desactivar;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Ver documento", 3150, 3170, VerDoc;

     nRango  = 2 + 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#dsarm034@, nRango, 0602, 3098, NULL, NULL, EvtoGrid1;
     nGridTra = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::Salir," + nGridTra;
          |LEETECLA aTecla;

          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     |CONFI "0000NConforme con la selecci¢n realizada";
     |SI FSalida = 0;
         nPasada = 1;
         |ABRE #dsarm005;
         |BUCLE dsarm034Tempo;
         |CIERRA #dsarm005;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |CIERRA #dsarm034@;  |DELINDEX #dsarm034@;
     |NOME_DAT #dsarm034@#"dsarm034"#;
     |DESCARGA_DEF #dsarm034@;

|FPRC;

|PROCESO Bandeja;
     |SI #dsarz039#0 = "R";
         |VENTANA 0501, 3299, -1, 16, "Bandeja dsEscan recibidas";
     |FINSI;

     |SI #dsarz039#0 = "E";
         |VENTANA 0501, 3299, -1, 16, "Bandeja dsEscan emitidas";
     |FINSI;

     nVentTra = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTra;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SI #dsarz039#0 = "R";
         |SUB_EJECUTA_NP "dsarz038";
     |FINSI;

     |SI #dsarz039#0 = "E";
         |SUB_EJECUTA_NP "dsarz049";
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTra;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentTra;

     |HAZ DibujaPantalla;
|FPRC;

|PROCESO Reintentar;
     |SI #dsarz039#0 = "R";
         |SUB_EJECUTA_NP "dsarz038;REINTENTAR";
     |FINSI;

     |SI #dsarz039#0 = "E";
         |SUB_EJECUTA_NP "dsarz049;REINTENTAR";
     |FINSI;

     |HAZ DibujaPantalla;
|FPRC;

|PROCESO Validar;
     |SI #dsarz039#0 = "R";
         |SUB_EJECUTA_NP "dsarz038;VALIDAR";
     |FINSI;

     |SI #dsarz039#0 = "E";
         |SUB_EJECUTA_NP "dsarz049;VALIDAR";
     |FINSI;

     |HAZ DibujaPantalla;
|FPRC;

|PROCESO dsarm034;
     nSituacion = 0;
     aAlfa      = #dsarm034#15;  |QBF aAlfa;

     |SI aAlfa = "110,110,110;255,255,255";    || Gris
         nSituacion = 1;
     |FINSI;

     |SI aAlfa = "192,192,192;255,255,255";    || Otro Gris
         nSituacion = 1;
     |FINSI;

     |SI #dsarm034#7 = 0;  |Y #dsarm034#9 ! "I";
         nSituacion = 1;
     |FINSI;

     |SI #dsarm034#9 = "N"; |Y #dsarm034#10 = "N";  |Y #dsarm034#7 ! 0;
         nSituacion = 2;
     |FINSI;

     |SI #dsarm034#9 = "S"; |Y #dsarm034#10 = "N";
         nSituacion = 3;
     |FINSI;

     |SI #dsarm034#9 = "S"; |Y #dsarm034#10 = "S";
         nSituacion = 4;

         #dsarm005#0 = #dsarm034#16;
         |LEE 000#dsarm005.=;
         |SI FSalida ! 0;   |DDEFECTO #dsarm005;  |FINSI;

         |SI #dsarm005#71 ! 0;
             nSituacion = 5;
         |FINSI;
     |SINO;
          |SI #dsarm001#199 = "S";
               |SI #dsarm034#9 = "N"; |Y #dsarm034#10 = "S";
                    nSituacion = 4;

                    #dsarm005#0 = #dsarm034#16;
                    |LEE 000#dsarm005.=;
                    |SI FSalida ! 0;   |DDEFECTO #dsarm005;  |FINSI;

                    |SI #dsarm005#71 ! 0;
                        nSituacion = 5;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI #dsarm034#9 = "I";
         nSituacion = 6;
     |FINSI;

     |SI nSituacion ] 5;
         |LIBERA #dsarm034;

         #dsarm034@#0 = #dsarm034#0;
         #dsarm034@#1 = #dsarm034#1;
         #dsarm034@#2 = #dsarm034#2;
         |LEE 101#dsarm034@.=;
         |SI FSalida = 0;
             |SI nSituacion = 5;  #dsarm034@#15 = "0,185,0;255,255,255";
                                  #dsarm034@#22 = "S";
             |FINSI;  ||Verde
             |SI nSituacion = 6;
                 #dsarm034@#15 = "215,120,210;255,255,255";    ||Rosa
                 #dsarm034@#10 = "I";
                 #dsarm034@#22 = "N";
             |FINSI;
             |GRABA 020#dsarm034@.a;
             |LIBERA #dsarm034@;
         |FINSI;

         |ACABA;
     |FINSI;

     |SI #dsarm034#7 = 0;
         nPdtesEnvi = nPdtesEnvi + 1;
     |FINSI;

     |SI nSituacion = 1;  nPdtesPlan = nPdtesPlan + 1;  |FINSI;
     |SI nSituacion = 2;  nPdtesInte = nPdtesInte + 1;  |FINSI;
     |SI nSituacion = 3;  nPdtesVali = nPdtesVali + 1;  |FINSI;
     |SI nSituacion = 4;  nPdtesCont = nPdtesCont + 1;  |FINSI;

     |SI nSituacion = 2;  #dsarm034#15 = "255,0,0;255,255,255";   |FINSI; || Rojo
     |SI nSituacion = 3;  #dsarm034#15 = "18,28,245;255,255,255"; |FINSI; || Azul
     |SI nSituacion = 4;  #dsarm034#15 = "200,150,0;255,255,255"; |FINSI; || Ocre

     |SI nSituacion = 4;
         #canempre#2 = #dsarm034#18;
         #canempre#3 = #dsarm034#19;
         |LEE 000#canempre.=;
         |SI FSalida ! 0;  |DDEFECTO #canempre;  |FINSI;

         |SI #dsarm034#17 = "FR000000";
             |DBASS aBase;  |QBF aBase;

             aPathDatos = aBase + "despanet";
             aPathDatos = aPathDatos + "/" + (("00000" + #dsarm034#18) % -105);
             aPathDatos = aPathDatos + "/fich";
             aPathDatos = aPathDatos + "/";

             |PATH_DAT #dpntm101#aPathDatos#;

             |ABRE #dpntm101;
             |SELECT #5#dpntm101;
             #dpntm101#50 = #dsarm034#16;
             |LEE 000#dpntm101.=;
             |SI FSalida ! 0;
                 #dsarm034#22 = "N";
                 #dsarm034#9  = "S";
                 #dsarm034#10 = "N";
                 #dsarm034#11 = "01.01.0000";
                 #dsarm034#12 = "";
                 #dsarm034#13 = "";
                 #dsarm034#14 = 0;
                 #dsarm034#15 = "18,28,245;255,255,255";
                 nSituacion   = 3;
             |FINSI;
             |CIERRA #dpntm101;
         |FINSI;

         |SI #dsarm034#17 = "FE000000";
             |DBASS aBase;  |QBF aBase;

             aPathDatos = aBase + "despanet";
             aPathDatos = aPathDatos + "/" + (("00000" + #dsarm034#18) % -105);
             aPathDatos = aPathDatos + "/fich";
             aPathDatos = aPathDatos + "/";

             |PATH_DAT #dpntm100#aPathDatos#;

             |ABRE #dpntm100;
             |SELECT #5#dpntm100;
             #dpntm100#50 = #dsarm034#16;
             |LEE 000#dpntm100.=;
             |SI FSalida ! 0;
                 #dsarm034#22 = "N";
                 #dsarm034#9  = "S";
                 #dsarm034#10 = "N";
                 #dsarm034#11 = "01.01.0000";
                 #dsarm034#12 = "";
                 #dsarm034#13 = "";
                 #dsarm034#14 = 0;
                 #dsarm034#15 = "18,28,245;255,255,255";
                 nSituacion   = 3;
             |FINSI;
             |CIERRA #dpntm100;
         |FINSI;
     |FINSI;

     |SI nSituacion = 4;
         #dsarw074#0 = #dsarm034#18;
         #dsarw074#1 = #dsarm034#19;
         |LEE 101#dsarw074.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsarw074;
             #dsarw074#0 = #dsarm034#18;
             #dsarw074#1 = #dsarm034#19;
             #dsarw074#2 = 2000 + #canempre#26;
             #dsarw074#3 = #canempre#1;
             |GRABA 020#dsarw074.b;
         |FINSI;
         #dsarw074#4 = #dsarw074#4 + 1;
         |GRABA 020#dsarw074.a;
         |LIBERA #dsarw074;
     |FINSI;

     |GRABA 020#dsarm034.a;
     |LIBERA #dsarm034;
|FPRC;

|DEFBUCLE dsarm034;
     #dsarm034#7;
     17;
     "N",          0, aTipoBan;
     "N",  999999999, aTipoBan;
     be;
     NULL, dsarm034;
|FIN;

|PROCESO dsarm034_malconta;
     ||No puede estar contabilizado si hay algo de esto incorrecto. Es un error
     |SI #dsarm034#9 = "I"; |O #dsarm034#10 = "I"; |O #dsarm034#9 = "N"; |O #dsarm034#10 = "N";
          #dsarm034#22 = "N";
          |GRABA 020#dsarm034.a;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm034_malconta;
     #dsarm034#7;
     17;
     "S",          0, aTipoBan;
     "S",  999999999, aTipoBan;
     be;
     NULL, dsarm034_malconta;
|FIN;

|PROCESO Eventodsarw074;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsarw074.=;
     |FINSI;

     |SI FSalida = 4;
         |ESTADO_CONTROL nGrid, "DISABLE";
         |ESTADO_CONTROL nBotonPdte, "HIDE";
         |ESTADO_CONTROL nBotonEnvi, "HIDE";
         |ESTADO_CONTROL nBotonInte, "HIDE";
         |ESTADO_CONTROL nBotonVali, "HIDE";

         |PULSATECLA;
         |PULSATECLA;
         |PULSATECLA;

         |SI #dsarz039#0 = "R";  aTipo = "S";  |FINSI;  || Soportadas
         |SI #dsarz039#0 = "E";  aTipo = "R";  |FINSI;  || Repercutidas

         eaTitulo = "Empresa: " + (("00000" + #dsarw074#0) % -105) + " " + #dsarw074#3;
         aAlfa    = ":contagen/gadz0002 canempr1 " + (("00000" + #dsarw074#0) % -105) + #dsarw074#1 + ";" + aTipo + "GAD";
         |SUB_EJECUTA aAlfa;

         |ESTADO_CONTROL nGrid, "ENABLE";
         |ESTADO_CONTROL nBotonPdte, "SHOW";
         |ESTADO_CONTROL nBotonEnvi, "SHOW";
         |ESTADO_CONTROL nBotonInte, "SHOW";
         |ESTADO_CONTROL nBotonVali, "SHOW";

         |PULSATECLA;
         |PULSATECLA;
         |PULSATECLA;

         nSalir   = 1;
         nEmpresa = #dsarw074#0;
         nPeriodo = #dsarw074#1;

         |SI nNoPasaOCR = 0;
             |PTEC 806;
         |FINSI;

         |PULSATECLA;
         |PULSATECLA;
         |PULSATECLA;
         |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO DibujaPantalla;
     |SI #dsarz039#0 = "R";  aTipoBan = "FR000000";  |FINSI;
     |SI #dsarz039#0 = "E";  aTipoBan = "FE000000";  |FINSI;

     nPdtesEnvi = 0;
     nPdtesPlan = 0;
     nPdtesInte = 0;
     nPdtesVali = 0;
     nPdtesCont = 0;

     |SI nGrid ! -1;
        |DESTRUYECONTROL nGrid;
        |FIN_CONTROL_WINDOWS nBotonPdte;
        |FIN_CONTROL_WINDOWS nBotonEnvi;
        |FIN_CONTROL_WINDOWS nBotonInte;
        |FIN_CONTROL_WINDOWS nBotonVali;
        |FIN_CONTROL_WINDOWS nLabelTit;
        |FIN_CONTROL_WINDOWS nLabelPdte;
        |FIN_CONTROL_WINDOWS nLabelEnvi;
        |FIN_CONTROL_WINDOWS nLabelInte;
        |FIN_CONTROL_WINDOWS nLabelVali;
        |FIN_CONTROL_WINDOWS nLabelCont;

        |CIERRA #dsarw074;
        |DELINDEX #dsarw074;

        |HAZ BoraTempo;
     |FINSI;

     |HAZ CreaTempo;
     |NOME_DAT #dsarw074#Tempo#;

     |DBASE aMas;  |QBF aMas;
     aMas = aMas + "def/dsarm034.mas";
     |CARGA_DEF aMas, dsarm034@;

     enTemporal = 1;
     |ABRE #dsarm034@;
     |SELECT #1#dsarm034@;
     |ABRE #dsarw074;
     |ABRE #dsarm005;
     |ABRE #canempre;
     |BUCLE dsarm034_malconta;
     |BUCLE dsarm034;
     |CIERRA #dsarm034@;
     |CIERRA #dsarm005;
     |CIERRA #canempre;
     enTemporal = 0;

     |DESCARGA_DEF #dsarm034@;

     |SI #dsarz039#0 = "R"; aAlfa = "LABEL,{{15}}Bandeja recibidas";  |FINSI;
     |SI #dsarz039#0 = "E"; aAlfa = "LABEL,{{15}}Bandeja emitidas";   |FINSI;

     |CONTROL_SIMPLE nPanta939, aAlfa, 0502, 0530, NULL;
     nLabelTit = FSalida;

     |CONTROL_SIMPLE nPanta939, "BOTON,{{197}}Recoger", 0702, 0713, Reintentar;
     nBotonPdte = FSalida;

     |CONTROL_SIMPLE nPanta939, "BOTON,{{197}}Enviar", 0902, 0913, Enviar;
     nBotonEnvi = FSalida;

     |CONTROL_SIMPLE nPanta939, "BOTON,{{197}}Consultar", 1102, 1113, Bandeja;
     nBotonInte = FSalida;

     |CONTROL_SIMPLE nPanta939, "BOTON,{{197}}Validar", 1302, 1313, Validar;
     nBotonVali = FSalida;

     |SI nPdtesPlan ! 0;
         aAlfa = "LABEL,{{13}}" + nPdtesPlan + " registros pendientes de respuesta OCR";
     |SINO;
         aAlfa = "LABEL,{{16}}No hay registros pendientes de respuesta OCR";

         |ESTADO_CONTROL nBotonPdte, "DISABLE";
         |ESTADO_CONTROL nBotonEnvi, "DISABLE";
     |FINSI;

     |CONTROL_SIMPLE nPanta939, aAlfa, 0715, 0760, NULL;
     nLabelPdte = FSalida;

     |SI nPdtesEnvi ! 0;
         aAlfa = "LABEL,{{13}}" + nPdtesEnvi + " registros posibles a enviar de nuevo al OCR";
     |SINO;
         aAlfa = "LABEL,{{16}}No hay registros a enviar al OCR";
     |FINSI;

     |CONTROL_SIMPLE nPanta939, aAlfa, 0915, 0960, NULL;
     nLabelEnvi = FSalida;

     |SI nPdtesInte ! 0;
         aAlfa = "LABEL,{{13}}" + nPdtesInte + " registros pendientes de integridad";
     |SINO;
         aAlfa = "LABEL,{{16}}No hay registros pendientes de integridad";
     |FINSI;

     |CONTROL_SIMPLE nPanta939, aAlfa, 1115, 1160, NULL;
     nLabelInte = FSalida;

     |SI nPdtesVali ! 0;
         aAlfa = "LABEL,{{13}}" + nPdtesVali + " registros pendientes de validar";
     |SINO;
         aAlfa = "LABEL,{{16}}No hay registros pendientes de validar";

         |ESTADO_CONTROL nBotonVali, "DISABLE";
     |FINSI;

     |CONTROL_SIMPLE nPanta939, aAlfa, 1315, 1360, NULL;
     nLabelVali = FSalida;

     |SI nPdtesCont ! 0;
         aAlfa = "LABEL,{{13}}" + nPdtesCont + " registros pendientes de contabilizar";
     |SINO;
         aAlfa = "LABEL,{{16}}No hay registros pendientes de contabilizar";
     |FINSI;

     |CONTROL_SIMPLE nPanta939, aAlfa, 1802, 1860, NULL;
     nLabelCont = FSalida;

     nRango  = 2 + 4 + 8 + 16 + 32 + 128;
     |SI #dsarm001#182 = "1";
         |LINEAL_SIMPLE #1#dsarw074, nRango, 2002, 3198, NULL, NULL, Eventodsarw074;
     |SINO;
         |CONTROL_SIMPLE nPanta939, "LABEL,{{4}}Desactivado", 1625, 1640, NULL;

         |LINEAL_SIMPLE #1#dsarw074, nRango, 2002, 3198, NULL, NULL, NULL;
     |FINSI;
     nGrid   = FSalida;

     #dsarw074#0 = nEmpresa;
     #dsarw074#1 = nPeriodo;
     |LEE 000#dsarw074.=;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO ModoSoloRecibidas;
     |VENTANA 0501, 3299, -1, 16, "Panel de control dsEscan";
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#dsarz039;
     nPanta939 = FSalida;

     |PTEC 802;  |PAUSA;

     |DDEFECTO #dsarz039;
     |C_V #dsarz039#0, 1, "N";
     |CONTROL_SIMPLE nPanta939, "LABEL,{{15}}    ", 0671, 0691, NULL;
     |CONTROL_SIMPLE nPanta939, "LABEL,{{15}}    ", 0771, 0791, NULL;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          |HAZ DibujaPantalla;

          FSalida = "::Salir," + nGrid;
          |LEETECLA aTecla;

          |SI nSalir = 1;  aTecla = "";  |FINSI;

          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;

          nSalir = 0;
          |PULSATECLA;
     |SIGUE;

     |DESTRUYECONTROL nGrid;
     |CIERRA #dsarw074;
     |DELINDEX #dsarw074;
     |HAZ BoraTempo;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;
|FPRC;

|PROCESO Tipo0C0;  |TIPO 0;
     |SI nNoPasaOCR = 0;  |ACABA;  |FINSI;

     |HAZ DibujaPantalla;
|FPRC;

|PROCESO Tipo12C0;  |TIPO 12;
     |SI nNoPasaOCR = 0;  |ACABA;  |FINSI;

     nSalir = 1;
|FPRC;

|PROCESO DosModos;
     |VENTANA 0501, 3299, -1, 16, "Panel de control dsEscan";
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #dsarz039;
     |PINPA #0#dsarz039;
     nPanta939 = FSalida;

     |PTEC 802;  |PAUSA;

     |C_V #dsarz039#0, 1, "S";
     |C_M #dsarz039#0, 1, "S";

     |HAZ DibujaPantalla;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          |ENDATOS #1#dsarz039;
          |SI nSalir = 1;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     |DESTRUYECONTROL nGrid;
     |CIERRA #dsarw074;
     |DELINDEX #dsarw074;
     |HAZ BoraTempo;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;
|FPRC;

|PROGRAMA;
     |ABRE #dsarm001;
     |DDEFECTO #dsarm001;
     |LEE 000#dsarm001.p;
     |CIERRA #dsarm001;

     |ABRE #dsarz010;
     aUsuario = Usuario % 810;
     |DDEFECTO #dsarz010;
     #dsarz010#0 = aUsuario;
     |LEE 000#dsarz010.=;
     |SI FSalida ! 0;
        |PARA nCampo = 3;  |SI nCampo [ 52;  |HACIENDO nCampo = nCampo + 1;
              #dsarz010#nCampo# = "S";
        |SIGUE;
     |FINSI;
     |CIERRA #dsarz010;

     |SI #dsarm001#168 ! "S";
         |MENAV "0000No est  activado el dsEscan en par metros de la aplicaci¢n";
         |ACABA;
     |FINSI;

     |SI #dsarz010#13 ! "S";
         |MENAV "0000El usuario no tiene permiso para ejecutar esta opci¢n";
         |ACABA;
     |FINSI;

     enAprobacion = 0;
     eaPrograma   = "NOPASAOCR";
     |HAZ DSARCHI_INI;
     nNoPasaOCR   = enAprobacion;

     |SI nNoPasaOCR = 0;
         |HAZ ModoSoloRecibidas;
     |FINSI;

     |SI nNoPasaOCR = 1;
         |HAZ DosModos;
     |FINSI;
|FPRO;

|PROCESO dsarm034Cheq;
     #dsarm034#17 = "FR000000";

     |GRABA 020#dsarm034.a;
     |LIBERA #dsarm034;
|FPRC;

|DEFBUCLE dsarm034Cheq;
     #dsarm034#1;
     17;
     "01.01.0000", "     ", "                    ", "        ";
     "31.12.9999", "zzzzz", "zzzzzzzzzzzzzzzzzzzz", "        ";
     be;
     NULL, dsarm034Cheq;
|FIN;

|PROCESO Tipo80;  |TIPO 80;
     |ABRET #dsarm034;
     |SELECT #5#dsarm034;
     #dsarm034#17 = "";
     #dsarm034#0  = "01.01.0000";
     #dsarm034#1  = "";
     #dsarm034#2  = "";
     #dsarm034#10 = "N";
     |LEE 000#dsarm034.];
     |SI FSalida ] 0;  |Y #dsarm034#17 = "        ";
         |BUCLE dsarm034Cheq;
     |FINSI;
     |CIERRAT #dsarm034;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |DBASE aAlfa;   |QBF aAlfa;
     aAlfa = aAlfa + "ocr/";
     aAlfa = aAlfa + "Envio" + Usuario + ".txt";
     |XABRE "E", aAlfa, 0;
     |SI FSalida ] 0;
         |SUB_EJECUTA "dsarw010;ENVIAAVISODIAGRAM";
     |FINSI;
|FPRC;
