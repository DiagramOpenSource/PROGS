|FICHEROS;
     dsarm001;
     dsarm002;
     dsarm003;
     dsarm004;
     dsarm005;
     dsarm008;
     dsarm055;
     dsarm056;

     dsarm005@;
     dsarm055@;
|FIN;

|VARIABLES;
     n0Vent              = 0;
     nTot                = 0;
     nSi                 = 0;
     nNo                 = 0;
     nOk                 = 0;
     nCmp                = 0;
     nRes                = 0;
     nLbl1               = -1;
     nLbl2               = -1;

     aReg                = "";
     aAlfa               = "";
     aFic                = "";
     aBase               = "";
     aDef                = "";
     aMas                = "";
     aPathFic            = "";
     aPathGad            = "";
     aPathDoc            = "";
     aPathVis            = "";
     aCarpeta            = "";

     &enTemporal         = 1;
     &enNHN              = 1;
|FIN;

|PROCESO CargaDeVistas;
     #dsarm055#0 = #dsarm005#0;
     |LEE 000#dsarm055.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsarm056#5 = #dsarm055#1;
     |LEE 000#dsarm056.=;
     |SI FSalida ! 0;  |DDEFECTO #dsarm056;  |FINSI;

     #dsarm005#4   = #dsarm055#8;
     #dsarm005#5   = #dsarm055#9;
     #dsarm005#8   = #dsarm055#10;
     #dsarm005#10  = #dsarm055#11;
     #dsarm005#94  = #dsarm055#12;
     #dsarm005#9   = #dsarm055#13;
     #dsarm005#6   = #dsarm055#14;

     |SI #dsarm008#31 = 1;
         #dsarm005#24 = #dsarm055#3;
         #dsarm005#25 = #dsarm055#4;
         #dsarm005#26 = #dsarm055#5;
         #dsarm005#27 = #dsarm055#6;

         aAlfa = #dsarm056#0;  |QBF aAlfa;
         |SI aAlfa ! "";
             #dsarm005#28 = (aAlfa % 107) + (aAlfa % 1602) + "." + (aAlfa % 1302) + "." + (aAlfa % 0804);
         |FINSI;

         aAlfa = #dsarm056#2;  |QBF aAlfa;
         |SI aAlfa ! "";
             #dsarm005#24 = aAlfa;
         |FINSI;

         aAlfa = #dsarm056#3;  |QBF aAlfa;
         |SI aAlfa ! "";
             #dsarm005#55 = aAlfa;
         |FINSI;
     |FINSI;

     |SI #dsarm008#31 = 2;
         #dsarm005#9  = #dsarm055#3;
     |FINSI;

     |SI #dsarm008#31 = 3;
         #dsarm005#9  = #dsarm055#3;

     |FINSI;

     |SI #dsarm008#31 = 4;
         |SI #dsarm005#1 = 0;
             aAlfa = #dsarm055#3 % 103;  #dsarm005#1 = aAlfa;
         |FINSI;

         |SI #dsarm005#2 = 0;
             aAlfa = #dsarm055#4 % 103;  #dsarm005#2 = aAlfa;
         |FINSI;

         |SI #dsarm005#3 = 0;
             aAlfa = #dsarm055#5 % 103;  #dsarm005#3 = aAlfa;
         |FINSI;

         #dsarm005#67 = #dsarm056#0;
         #dsarm005#68 = #dsarm056#1;
     |FINSI;

     |SI #dsarm008#31 = 5;
         #dsarm005#14 = #dsarm055#3 % 799;
         #dsarm005#21 = #dsarm055#4 % 140;

         |SI #dsarm005#17 = 0;
             #dsarm005#17 = #dsarm056#1;
         |FINSI;

         |SI #dsarm005#18 = 0;
             aAlfa = #dsarm056#2 % 102;  #dsarm005#18 = aAlfa;
         |FINSI;
     |FINSI;

     |SI #dsarm008#31 = 6;
         #dsarm005#69 = #dsarm055#3;
         #dsarm005#70 = #dsarm055#4;
         #dsarm005#71 = #dsarm055#5;
         #dsarm005#72 = #dsarm055#6;
         #dsarm005#73 = #dsarm055#7;

         #dsarm005#67 = #dsarm056#0;
         #dsarm005#68 = #dsarm056#1;
     |FINSI;

     |SI #dsarm008#31 = 7;
         #dsarm005#66 = #dsarm055#3;
         #dsarm005#39 = #dsarm055#4;
         #dsarm005#40 = #dsarm055#5;
     |FINSI;

     |SI #dsarm008#31 = 8;
         #dsarm005#19 = #dsarm055#3;

         |SI #dsarm005#17 = 0;
             #dsarm005#17 = #dsarm056#1;
         |FINSI;

         |SI #dsarm005#18 = 0;
             aAlfa = #dsarm056#2 % 102;  #dsarm005#18 = aAlfa;
         |FINSI;
     |FINSI;

     |SI #dsarm008#31 = 9;
         #dsarm005#14 = #dsarm055#3 % 799;

         |SI #dsarm005#17 = 0;
             #dsarm005#17 = #dsarm056#1;
         |FINSI;

         |SI #dsarm005#18 = 0;
             aAlfa = #dsarm056#2 % 102;  #dsarm005#18 = aAlfa;
         |FINSI;
     |FINSI;

     |SI #dsarm008#31 = 10;
         aAlfa = #dsarm055#3 % 105;  #dsarm005#15 = aAlfa;
         aAlfa = #dsarm055#3 % 799;  #dsarm005#16 = aAlfa;

         |SI #dsarm005#17 = 0;
             #dsarm005#17 = #dsarm056#1;
         |FINSI;

         |SI #dsarm005#18 = 0;
             aAlfa = #dsarm056#2 % 102;  #dsarm005#18 = aAlfa;
        |FINSI;
     |FINSI;

     nOk = 1;
|FPRC;

|PROCESO dsarm008;
     nOk = 0;

     aFic = "va" + (("000000" + #dsarm008#31) % -106);
     |NOME_DAT #dsarm055#aFic#;
     |PATH_DAT #dsarm055#aPathVis#;

     aFic = "vb" + (("000000" + #dsarm008#31) % -106);
     |NOME_DAT #dsarm056#aFic#;
     |PATH_DAT #dsarm056#aPathVis#;

     |ABRE #dsarm055;
     |ABRE #dsarm056;  |SELECT #2#dsarm056;
     |HAZ CargaDeVistas;
     |CIERRA #dsarm055;
     |CIERRA #dsarm056;
|FPRC;

|DEFBUCLE dsarm008;
     #dsarm008#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsarm008;
|FIN;

|PROCESO GrabaReg;
     |DDEFECTO #dsarm005;
     #dsarm005#0  = aReg;
     #dsarm005#1  = #dsarm002#0;
     #dsarm005#2  = #dsarm003#1;
     #dsarm005#3  = #dsarm004#2;
     #dsarm005#7  = aPathGad + "/" + aCarpeta + "/";

     nOk = 0;
     |BUCLE dsarm008;

     |GRABA 020#dsarm005.n;
     |LIBERA #dsarm005;

     nRes = nTot $ 100;
     |SI nRes = 0;
         |SI nLbl2 ! -1;
             |DESTRUYECONTROL nLbl2;
         |FINSI;

         aAlfa = "LABEL,{{15}} Registros: " + nTot;
         |CONTROL_SIMPLE 0, aAlfa, 1302, 1399, NULL;
         nLbl2 = FSalida;
     |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO dsarm004;
     |DDEFECTO #dsarm002;
     #dsarm002#0 = #dsarm004#0;
     |LEE 000#dsarm002.=;

     |DDEFECTO #dsarm003;
     #dsarm003#0 = #dsarm004#0;
     #dsarm003#1 = #dsarm004#1;
     |LEE 000#dsarm003.=;

     aCarpeta = #dsarm002#2;  |QBF aCarpeta;
     |SI aCarpeta = "";
         aCarpeta = #dsarm003#3;
     |SINO;
         aCarpeta = aCarpeta + "/" + #dsarm003#3;
     |FINSI;
     |QBF aCarpeta;

     |SI aCarpeta = "";
         aCarpeta = #dsarm004#4;
     |SINO;
          aCarpeta = aCarpeta + "/" + #dsarm004#4;
     |FINSI;
     |QBF aCarpeta;

     aAlfa = "LABEL,{{16}}" + aCarpeta;
     |CONTROL_SIMPLE 0, aAlfa, 1102, 1199, NULL;
     nLbl1 = FSalida;

     aPathDoc = aPathGad + "/" + aCarpeta + "/*.*";
     |_PDIR aPathDoc;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          aReg  = aPathDoc - (aPathGad + "/" + aCarpeta + "/");
          aReg  = aReg % 109;

          nTot = nTot + 1;

          #dsarm005#0 = aReg;
          |LEE 000#dsarm005.=;
          |SI FSalida = 0;
              nSi = nSi + 1;
          |SINO;
              nNo = nNo + 1;

              |HAZ GrabaReg;
          |FINSI;

          |_SDIR aPathDoc;
     |SIGUE;

     |DESTRUYECONTROL nLbl1;
|FPRC;

|DEFBUCLE dsarm004;
     #dsarm004#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsarm004;
|FIN;

|PROCESO dsarm005;
     |PARA nCmp = 0;  |SI nCmp [ 100;  |HACIENDO nCmp = nCmp + 1;
           #dsarm005#nCmp# = #dsarm005@#nCmp#;
     |SIGUE;

     |GRABA 020#dsarm005.n;
     |LIBERA #dsarm005;
|FPRC;

|DEFBUCLE dsarm005;
     #dsarm005@#1001;
     ;
     000000001;
     999999999;
     ;
     NULL, dsarm005;
|FIN;

|PROCESO GrabaCentralita;
     |DDEFECTO #dsarm005;
     #dsarm005#0 = #dsarm055@#0;
     #dsarm005#1  = 0;
     #dsarm005#2  = 0;
     #dsarm005#3  = 0;

     nOk = 0;
     |BUCLE dsarm008;

     |DDEFECTO #dsarm002;
     #dsarm002#0 = #dsarm004#0;
     |LEE 000#dsarm002.=;

     |DDEFECTO #dsarm003;
     #dsarm003#0 = #dsarm004#0;
     #dsarm003#1 = #dsarm004#1;
     |LEE 000#dsarm003.=;

     aCarpeta = #dsarm002#2;  |QBF aCarpeta;
     |SI aCarpeta = "";
         aCarpeta = #dsarm003#3;
     |SINO;
         aCarpeta = aCarpeta + "/" + #dsarm003#3;
     |FINSI;
     |QBF aCarpeta;

     |SI aCarpeta = "";
         aCarpeta = #dsarm004#4;
     |SINO;
          aCarpeta = aCarpeta + "/" + #dsarm004#4;
     |FINSI;
     |QBF aCarpeta;

     #dsarm005#7  = aPathGad + "/" + aCarpeta + "/";

     |GRABA 020#dsarm005.n;
     |LIBERA #dsarm005;

     nRes = nTot $ 100;
     |SI nRes = 0;
         |SI nLbl2 ! -1;
             |DESTRUYECONTROL nLbl2;
         |FINSI;

         aAlfa = "LABEL,{{15}} Registros: " + nTot;
         |CONTROL_SIMPLE 0, aAlfa, 1302, 1399, NULL;
         nLbl2 = FSalida;
     |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO dsarm055;
     #dsarm002#0 = 0;
     #dsarm003#1 = 0;
     #dsarm004#2 = 0;

     #dsarm005#0 = #dsarm055@#0;
     |LEE 000#dsarm005.=;
     |SI FSalida ! 0;
         nTot = nTot + 1;
         nNo  = nNo + 1;

         |HAZ GrabaCentralita;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm055;
     #dsarm055@#1001;
     ;
     000000001;
     999999999;
     ;
     NULL, dsarm055;
|FIN;

|PROGRAMA;

     |ABRE #dsarm001;
     |LEE 000#dsarm001.p;
     |SI FSalida ! 0;  |DDEFECTO #dsarm001;  |FINSI;
     |CIERRA #dsarm001;

     aPathGad =  #dsarm001#1;  |QBF aPathGad;

     |DBASE aPathVis;  |QBF aPathVis;
     aPathVis = aPathVis + "vistastmp";
     aPathVis = aPathVis + "/";

     |VENTANA 0501, 2799, -1, 1, "";
     n0Vent = FSalida;

     |PTEC 802;  |PAUSA;

     |DBASE aBase;
     |DDEF aDef;

     aMas = aDef + "dsarm005.mas";  |CARGA_DEF aMas, dsarm005@;
     aMas = aDef + "dsarm055.mas";  |CARGA_DEF aMas, dsarm055@;

     aPathFic = aBase + "tmp/";
     |PATH_DAT #dsarm005@#aPathFic#;

     aFic = "va000001";
     |NOME_DAT #dsarm055@#aFic#;
     |PATH_DAT #dsarm055@#aPathVis#;

     |ABRE #dsarm005;  |CIERRA #dsarm005;  |DELINDEX #dsarm005;

     |ABRE #dsarm005;
     |BUCLE dsarm005;
     |CIERRA #dsarm005;

     |DESCARGA_DEF #dsarm005@;

     |ABRE #dsarm002;
     |ABRE #dsarm003;
     |ABRE #dsarm005;

     |BUCLE dsarm004;
     |BUCLE dsarm055;

     |CIERRA #dsarm002;
     |CIERRA #dsarm003;
     |CIERRA #dsarm005;

     |DESCARGA_DEF #dsarm055@;

     |FINVENTANA n0Vent;

     aAlfa = "0000Un total de " + nTot + " registros con SI: " + nSi + " con NO: " + nNo;
     |MENAV aAlfa;
|FPRO;
