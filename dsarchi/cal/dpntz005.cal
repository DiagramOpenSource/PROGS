|FICHEROS;
     dpntm001;
     dpntm002;
     dpntm004;
     dpntm005;
     dpntm007;

     dsarm004;
     dsarm005;
     dsarz010;

     :/laboral/def/labcentr;
     :/laboral/def/nomw0003;

     dpntw001,MANTE;
     dpntw011;
     dpntw012;
     dpntw013;
     dpntw014;
     dpntw015;
|FIN;

|VARIABLES;
     n0Vent              = 0;
     n1Vent              = 0;
     nBtnDes13           = 0;
     nBtnDes14           = 0;
     nGrid12             = 0;
     nGrid13             = 0;
     nGrid14             = 0;
     nGrid15             = 0;
     nPanta              = 0;
     nRango              = 0;
     nIde                = 0;
     nFSalida            = 0;
     nOk                 = 0;
     nAccesos            = 0;

     aAlfa               = "";
     aFicTmp             = "";
     aPathLab            = "";
     aMas                = "";
     aEsc1               = "";
     aEsc2               = "";
     aRetu               = "";
     aTecla              = "";
     aEmail              = "";
     aGuardaEmail        = "";
     aHMail              = "";
     aVerde              = "0,185,0;255,255,255";
     aRojo               = "255,80,80;255,255,255";

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     &eaAcceso           = "PIBOX";
     &eaAdmin            = "S";
     &enCreaAcceso       = 0;
     &eaMaiCli           = "";
     &enEmpresa          = 0;
|FIN;

|PROCESO dpntw012B;
     |BORRA 000#dpntw012.a;
|FPRC;

|DEFBUCLE dpntw012B;
     #dpntw012#1;
     ;
     "";
     aHMail;
     ;
     NULL, dpntw012B;
|FIN;

|PROCESO dpntw013B;
     |BORRA 000#dpntw013.a;
|FPRC;

|DEFBUCLE dpntw013B;
     #dpntw013#1;
     ;
     ""    , 00000, 000;
     aHMail, 99999, 999;
     ;
     NULL, dpntw013B;
|FIN;

|PROCESO dpntw014B;
     |BORRA 000#dpntw014.a;
|FPRC;

|DEFBUCLE dpntw014B;
     #dpntw014#1;
     ;
     ""    , 00000, 000, 000;
     aHMail, 99999, 999, 999;
     ;
     NULL, dpntw014B;
|FIN;

|PROCESO dpntw015B;
     |BORRA 000#dpntw015.a;
|FPRC;

|DEFBUCLE dpntw015B;
     #dpntw015#1;
     ;
     ""    , 00000, "";
     aHMail, 99999, "zzzzzzzzzzzz";
     ;
     NULL, dpntw015B;
|FIN;

|PROCESO dpntm005;
     aAlfa = #dpntm005#2;  |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     #dpntw012#0 = #dpntm005#2;
     |LEE 000#dpntw012.=;
     |SI FSalida ! 0;
         #dpntw012#0 = #dpntm005#2;
         |GRABA 000#dpntw012.n;
         |LIBERA #dpntw012;
     |FINSI;

     #dpntw013#0 = #dpntm005#2;
     #dpntw013#1 = #dpntm005#0;
     #dpntw013#2 = #dpntm005#1;
     |LEE 000#dpntw013.=;
     |SI FSalida ! 0;
         #dpntm001#0 = #dpntm005#0;
         |LEE 000#dpntm001.=;
         |SI FSalida ! 0;  |DDEFECTO #dpntm001;  |FINSI;

         #dpntw013#0 = #dpntm005#2;
         #dpntw013#1 = #dpntm005#0;
         #dpntw013#2 = #dpntm005#1;
         #dpntw013#3 = #dpntm001#2;

         |GRABA 000#dpntw013.n;
         |LIBERA #dpntw013;
     |FINSI;
|FPRC;

|DEFBUCLE dpntm005;
     #dpntm005#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dpntm005;
|FIN;

|PROCESO dpntm007;
     aAlfa = #dpntm007#3;  |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     #dpntw012#0 = #dpntm007#3;
     |LEE 000#dpntw012.=;
     |SI FSalida ! 0;
         #dpntw012#0 = #dpntm007#3;
         |GRABA 000#dpntw012.n;
         |LIBERA #dpntw012;
     |FINSI;

     #dpntw014#0 = #dpntm007#3;
     #dpntw014#1 = #dpntm007#0;
     #dpntw014#2 = #dpntm007#1;
     #dpntw014#3 = #dpntm007#2;
     |LEE 000#dpntw014.=;
     |SI FSalida ! 0;
         #dpntm001#0 = #dpntm007#0;
         |LEE 000#dpntm001.=;
         |SI FSalida ! 0;  |DDEFECTO #dpntm001;  |FINSI;

         #labcentr#0 = #dpntm007#0;
         #labcentr#1 = #dpntm007#1;
         |LEE 000#labcentr.=;
         |SI FSalida ! 0;  |DDEFECTO #labcentr;  |FINSI;

         #dpntw014#0 = #dpntm007#3;
         #dpntw014#1 = #dpntm007#0;
         #dpntw014#2 = #dpntm007#1;
         #dpntw014#3 = #dpntm007#2;
         #dpntw014#4 = #dpntm001#2;
         #dpntw014#5 = #labcentr#2;

         |GRABA 000#dpntw014.n;
         |LIBERA #dpntw014;
     |FINSI;
|FPRC;

|DEFBUCLE dpntm007;
     #dpntm007#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dpntm007;
|FIN;

|PROCESO PonColor_Pibox;
     aEmail = #dpntm004#4;  |QBF aEmail;

                               nOk = 1;
     |SI #nomw0003#44  ! "A";  nOk = 0;  |FINSI;
     |SI #nomw0003#142 ! "S";  nOk = 0;  |FINSI;
     |SI aEmail        =  "";  nOk = 0;  |FINSI;

     #dpntm004#6  = "N";
     |SI nOk = 1;
         #dpntm004#6  = "S";
     |FINSI;

     #dpntm004#5 = "";
     #dpntm004#9 = "";

     aEmail = #dpntm004#4;   |QBF aEmail;
     |SI aEmail = "";
         #dpntm004#9 = aRojo;
     |FINSI;

     |SI #nomw0003#44 ! "A";
         #dpntm004#9 = aRojo;
     |FINSI;

     |SI #dpntm004#6  = "S";
         #dpntm004#9 = aVerde;
     |FINSI;
|FPRC;

|PROCESO dpntm004;
     #nomw0003#0 = #dpntm004#0;
     #nomw0003#1 = #dpntm004#2;
     |LEE 101#nomw0003.=;
     |SI FSalida ! 0;
         |BORRA 020#dpntm004.a;
         |LIBERA #dpntm004;
         |ACABA;
     |FINSI;

     aAlfa = #dpntm004#4;  |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     #dpntw012#0 = #dpntm004#4;
     |LEE 000#dpntw012.=;
     |SI FSalida ! 0;
         #dpntw012#0 = #dpntm004#4;
         |GRABA 000#dpntw012.n;
         |LIBERA #dpntw012;
     |FINSI;

     |HAZ PonColor_Pibox;

     #dpntw015#0 = #dpntm004#4;
     #dpntw015#1 = #dpntm004#0;
     #dpntw015#2 = #dpntm004#1;
     |LEE 000#dpntw015.=;
     |SI FSalida ! 0;
         #dpntm001#0 = #dpntm004#0;
         |LEE 000#dpntm001.=;
         |SI FSalida ! 0;  |DDEFECTO #dpntm001;  |FINSI;

         #dpntw015#0 = #dpntm004#4;
         #dpntw015#1 = #dpntm004#0;
         #dpntw015#2 = #dpntm004#1;
         #dpntw015#3 = #dpntm004#2;
         #dpntw015#4 = #dpntm004#3;
         #dpntw015#5 = #dpntm001#2;
         #dpntw015#6 = #dpntm004#6;
         #dpntw015#7 = #dpntm004#9;

         |GRABA 000#dpntw015.n;
         |LIBERA #dpntw015;
     |FINSI;
|FPRC;

|DEFBUCLE dpntm004;
     #dpntm004#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dpntm004;
|FIN;

|PROCESO CreaTempos;
     aGuardaEmail = #dpntw012#0;

     |BUCLE dpntw012B;
     |BUCLE dpntw013B;
     |BUCLE dpntw014B;
     |BUCLE dpntw015B;

     |BUCLE dpntm005;
     |BUCLE dpntm007;
     |BUCLE dpntm004;

     #dpntw012#0 = aGuardaEmail;
     |LEE 000#dpntw012.=;

     |REFRESCACONTROL nGrid12;
     |REFRESCACONTROL nGrid13;
     |REFRESCACONTROL nGrid14;
     |REFRESCACONTROL nGrid15;
|FPRC;

|PROCESO Baja15;
     #dpntw015#0 = #dpntw012#0;
     #dpntw015#1 = 0;
     #dpntw015#2 = "";
|FPRC;

|PROCESO Alta15;
     #dpntw015#0 = #dpntw012#0;
     #dpntw015#1 = 99999;
     #dpntw015#2 = "zzzzzzzzzzzz";
|FPRC;

|PROCESO Evnt15;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dpntw015.=;
     |FINSI;

     |SI FSalida = 4;
         #dpntm004#0 = #dpntw015#1;
         #dpntm004#1 = #dpntw015#2;
         |LEE 101#dpntm004.=;
         |SI FSalida ! 0;
             |FOCOTECLADO nGrid15;

             |ACABA;
         |FINSI;

         #nomw0003#0 = #dpntm004#0;
         #nomw0003#1 = #dpntm004#2;
         |LEE 101#nomw0003.=;
         |SI FSalida = 0;
             |SI #nomw0003#142 = "S";
                 #nomw0003#142 = "N";
             |SINO;
                 #nomw0003#142 = "S";
             |FINSI;

             |GRABA 020#nomw0003.a;
             |LIBERA #nomw0003;
         |FINSI;

         |HAZ PonColor_Pibox;

         |GRABA 020#dpntm004.a;
         |LIBERA #dpntm004;

         #dpntw015#0 = #dpntm004#4;
         #dpntw015#1 = #dpntm004#0;
         #dpntw015#2 = #dpntm004#1;
         |LEE 000#dpntw015.=;
         |SI FSalida = 0;
             #dpntw015#6 = #dpntm004#6;
             #dpntw015#7 = #dpntm004#9;

             |GRABA 000#dpntw015.a;
             |LIBERA #dpntw015;

             |REFRESCACONTROL nGrid15;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Baja14;
     #dpntw014#0 = #dpntw012#0;
     #dpntw014#1 = 0;
     #dpntw014#2 = 0;
     #dpntw014#3 = 0;
|FPRC;

|PROCESO Alta14;
     #dpntw014#0 = #dpntw012#0;
     #dpntw014#1 = 99999;
     #dpntw014#2 = 999;
     #dpntw014#3 = 999;
|FPRC;

|PROCESO Evnt14;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dpntw014.=;

         |ESTADO_CONTROL nBtnDes14, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO Baja13;
     #dpntw013#0 = #dpntw012#0;
     #dpntw013#1 = 0;
     #dpntw013#2 = 0;
|FPRC;

|PROCESO Alta13;
     #dpntw013#0 = #dpntw012#0;
     #dpntw013#1 = 99999;
     #dpntw013#2 = 999;
|FPRC;

|PROCESO Evnt13;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dpntw013.=;

         |ESTADO_CONTROL nBtnDes13, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO Evnt12;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dpntw012.=;

         |REFRESCACONTROL nGrid13;
         |REFRESCACONTROL nGrid14;
         |REFRESCACONTROL nGrid15;
     |FINSI;
|FPRC;

|PROCESO NuevoGrid12;
     |VENTANA 0501, 1680, -1, 16, "Nuevo Acceso";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |DDEFECTO #dpntw011;

     |PINPA #0#dpntw011;
     |PINDA #0#dpntw011;
     |ENDATOS #1#dpntw011;
     |SI FSalida = 0;
         #dpntw012#0 = #dpntw011#0;
         |LEE 000#dpntw012.=;
         |SI FSalida ! 0;
             #dpntw012#0 = #dpntw011#0;
             |GRABA 000#dpntw012.n;
         |SINO;
             |MENAV "0000El acceso ya existe";
         |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |LEE 000#dpntw012.=;
     |REFRESCACONTROL nGrid12;
     |FOCOTECLADO nGrid12;
|FPRC;

|PROCESO dsarm005;
     aAlfa = "N";

     #dsarm004#0 = #dsarm005#1;
     #dsarm004#1 = #dsarm005#2;
     #dsarm004#2 = #dsarm005#3;
     |LEE 000#dsarm004.=;
     |SI FSalida = 0;  |Y #dsarm004#76 = "S";
         #dpntm002#0 = #dpntm001#0;
         #dpntm002#1 = #dsarm004#0;
         #dpntm002#2 = #dsarm004#1;
         #dpntm002#3 = #dsarm004#2;
         |LEE 000#dpntm002.=;
         |SI FSalida ! 0;
             aAlfa = "S";
         |FINSI;
     |FINSI;

     #dsarm005#94 = aAlfa;
     |GRABA 020#dsarm005.a;
     |LIBERA #dsarm005;
|FPRC;

|DEFBUCLE dsarm005;
     #dsarm005#3;
     ;
     #dpntm001#0, "00.00.0000", "     ", 000000001;
     #dpntm001#0, "31.12.9999", "zzzzz", 999999999;
     be;
     NULL, dsarm005;
|FIN;

|PROCESO CreaDPNTM001;
     |DDEFECTO #dpntm001;
     #dpntm001#0  = #dpntw001#0;
     #dpntm001#1  = #dpntw001#1;
     #dpntm001#2  = #dpntw001#2;
     #dpntm001#3  = #dpntw001#3;
     #dpntm001#4  = #dpntw001#4;
     #dpntm001#5  = #dpntw001#5;
     #dpntm001#6  = #dpntw001#6;
     #dpntm001#7  = #dpntw001#7;
     #dpntm001#8  = #dpntw001#8;
     #dpntm001#9  = #dpntw001#9;
     #dpntm001#10 = #dpntw001#10;
     #dpntm001#11 = #dpntw001#11;
     #dpntm001#12 = #dpntw001#12;
     #dpntm001#13 = #dpntw001#13;
     #dpntm001#14 = #dpntw001#14;
     #dpntm001#15 = #dpntw001#15;
     #dpntm001#16 = #dpntw001#16;
     |GRABA 020#dpntm001.n;
     |LIBERA #dpntm001;

     #dpntm005#0 = #dpntm001#0;
     #dpntm005#1 = 1;
     #dpntm005#2 = #dpntw001#9;
     #dpntm005#3 = #dpntw001#14;
     |GRABA 020#dpntm005.n;
     |LIBERA #dpntm005;

     #dpntm005#0 = #dpntm001#0;

     #dsarz010#0 = #dpntm001#1;
     |LEE 101#dsarz010.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsarz010;
         #dsarz010#0 = #dpntm001#1;
         #dsarz010#7 = "S";
         |GRABA 020#dsarz010.n;
     |FINSI;
     |LIBERA #dsarz010;
     |CIERRA #dsarz010;

     |BUCLE dsarm005;
|FPRC;

|PROCESO CreaDPNTM005;
     #dpntm005#0 = #dpntw001#0;
     #dpntm005#1 = 999;
     |LEE 000#dpntm005.];
     |SI FSalida = 0;
         |LEE 000#dpntm005.a;
     |SINO;
         |LEE 000#dpntm005.u;
     |FINSI;

     nIde = 1;
     |SI FSalida = 0;  |Y #dpntm005#0 = #dpntw001#0;
         nIde = #dpntm005#1 + 1;
     |FINSI;

     |DDEFECTO #dpntm005;
     #dpntm005#0 = #dpntw001#0;
     #dpntm005#1 = nIde;
     #dpntm005#2 = #dpntw012#0;

     |GRABA 020#dpntm005.n;
     |LIBERA #dpntm005;
|FPRC;

|PROCESO ActivarGrid13;
     aAlfa = "Habilitar Empresa en " + eaAcceso;
     |VENTANA 0501, 1999, -1, 16, aAlfa;
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #dpntw001;

     |C_M #dpntw001#00, 1, "S";
     |C_M #dpntw001#09, 1, "N";
     |C_V #dpntw001#14, 1, "N";

     #dpntw001#9 = #dpntw012#0;
     eaMaiCli    = #dpntw001#9;

     |PINPA #0#dpntw001;  nPanta = FSalida;

     |CONTROL_SIMPLE nPanta, "LABEL,{{11}}            ", 1103, 1125, NULL;
     |C_V #dpntw001#14, 1, "N";

     |PINDA #0#dpntw001;

     |ENDATOS #1#dpntw001;
     nFSalida = FSalida;
     |SI nFSalida = 0;
         |SI enCreaAcceso = 1;
             |HAZ CreaDPNTM001;
         |SINO;
             |HAZ CreaDPNTM005;
         |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;
     |FINVENTANA n1Vent;

     |PULSATECLA;
     |PULSATECLA;

     |SI nFSalida = 0;
         |HAZ CreaTempos;
     |FINSI;

     |FOCOTECLADO nGrid12;
|FPRC;

|PROCESO DesactivarGrid13;
     nAccesos = 0;
     #dpntm005#0 = #dpntw013#1;
     #dpntm005#1 = 1;
     |LEE 000#dpntm005.];
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #dpntm005#0 ! #dpntw013#1;
              |SAL;
          |FINSI;

          nAccesos = nAccesos + 1;

          |LEE 000#dpntm005.s;
     |SIGUE;

     |SI nAccesos [ 1;
         |CONFI "0000NQuiere deshabilitar la empresa";
         |SI FSalida = 0;
             #dpntm001#0 = #dpntw013#1;
             |LEE 101#dpntm001.=;
             |SI FSalida = 0;
                 |HAZ Deshabilito;
                 |HAZ CreaTempos;
             |FINSI;
         |FINSI;

         |FOCOTECLADO nGrid13;

         |ACABA;
     |FINSI;

     |CONFI "0000NSeguro que quiere deshabilitar el acceso";
     |SI FSalida ! 0;
         |FOCOTECLADO nGrid13;
         |ACABA;
     |FINSI;

     enEmpresa = #dpntw013#1;

     #dpntm005#0 = #dpntw013#1;
     #dpntm005#1 = #dpntw013#2;
     |LEE 101#dpntm005.=;
     |SI FSalida = 0;
         |BORRA 020#dpntm005.a;
         |LIBERA #dpntm005;

         |HAZ CreaTempos;
     |FINSI;

     #dpntm005#0 = enEmpresa;
     #dpntm005#1 = 1;
     |LEE 000#dpntm005.];
     |SI FSalida = 0;  |Y #dpntm005#0 = enEmpresa;
         #dpntm001#0 = enEmpresa;
         |LEE 101#dpntm001.=;
         |SI FSalida = 0;
             #dpntm001#9 = #dpntm005#2;

             |GRABA 020#dpntm001.a;
             |LIBERA #dpntm001;
         |FINSI;
     |FINSI;

     |FOCOTECLADO nGrid13;
|FPRC;

|PROCESO ActivarGrid14;
     |MENAV "0000A continuaci¢n de la lista seleccione la Empresa/Centro para habilitar";

     |CONSULTA_CLAVE #1#labcentr;
     |SI FSalida ! 0;
         |FOCOTECLADO nGrid14;
         |ACABA;
     |FINSI;

     #dpntm001#0 = #labcentr#0;
     |LEE 000#dpntm001.=;
     |SI FSalida ! 0;
         |MENAV "0000La empresa seleccionada no est  activada en PIBOX";
         |FOCOTECLADO nGrid14;
         |ACABA;
     |FINSI;

     |SELECT #2#dpntm005;
     |LEE 000#dpntm005.=;
     #dpntm005#0 = #dpntm001#0;
     #dpntm005#2 = #dpntw012#0;
     |LEE 000#dpntm005.=;
     |SI FSalida = 0;
         nOk = 1;
     |FINSI;
     |SELECT #1#dpntm005;

     |SELECT #2#dpntm007;
     |LEE 000#dpntm007.=;
     #dpntm007#0 = #dpntm001#0;
     #dpntm007#1 = #labcentr#1;
     #dpntm007#3 = #dpntw012#0;
     |LEE 000#dpntm007.=;
     |SI FSalida = 0;
         nOk = 2;
     |FINSI;
     |SELECT #1#dpntm007;

     |SI nOk = 1;
         |CONFI "0000NEl E_mail se est  usando en un acceso de esta empresa. Continuar.";
         |SI FSalida ! 0;
             |FOCOTECLADO nGrid13;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI nOk = 2;
         |MENAV "0000El E_mail ya existe en este centro.";

         |FOCOTECLADO nGrid13;
         |ACABA;
     |FINSI;

     #dpntm007#0 = #dpntm001#0;
     #dpntm007#1 = #labcentr#1;
     #dpntm007#2 = 999;
     |LEE 000#dpntm007.];
     |SI FSalida = 0;
         |LEE 000#dpntm007.a;
     |SINO;
         |LEE 000#dpntm007.u;
     |FINSI;

     nIde = 1;
     |SI FSalida = 0;  |Y #dpntm007#0 = #dpntm001#0;
                       |Y #dpntm007#1 = #labcentr#1;
         nIde = #dpntm007#2 + 1;
     |FINSI;

     #dpntm007#0 = #dpntm001#0;
     #dpntm007#1 = #labcentr#1;
     #dpntm007#2 = nIde;
     #dpntm007#3 = #dpntw012#0;

     |GRABA 020#dpntm007.n;
     |LIBERA #dpntm007;

     |HAZ CreaTempos;
     |FOCOTECLADO nGrid13;
|FPRC;

|PROCESO DesactivarGrid14;
     |CONFI "0000NSeguro que quiere deshabilitar el acceso";
     |SI FSalida ! 0;
         |FOCOTECLADO nGrid14;
         |ACABA;
     |FINSI;

     #dpntm007#0 = #dpntw014#1;
     #dpntm007#1 = #dpntw014#2;
     #dpntm007#2 = #dpntw014#3;
     |LEE 101#dpntm007.=;
     |SI FSalida = 0;
         |BORRA 020#dpntm007.a;
         |LIBERA #dpntm007;

         |HAZ CreaTempos;
     |FINSI;

     |FOCOTECLADO nGrid14;
|FPRC;

|PROCESO AccesoTrab;
     |MENAV "0000A continuaci¢n de la lista seleccione la Empresa para acceder a sus trabajadores";

     |CONSULTA_CLAVE #1#dpntm001;
     |SI FSalida ! 0;
         |FOCOTECLADO nGrid15;
         |ACABA;
     |FINSI;

     aAlfa = "Acceso " + eaAcceso + " Trabajadores Empresa: " + #dpntm001#2;  |QBF aAlfa;
     |VENTANA 0501, 2899, -1, 16, aAlfa;
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enEmpresa = #dpntm001#0;
     |SUB_EJECUTA "dpntm004";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |HAZ CreaTempos;
     |FOCOTECLADO nGrid12;
|FPRC;

|PROCESO AccesoAgru;
     |VENTANA 0501, 2899, -1, 16, "Accesos agrupaci¢n";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SUB_EJECUTA "dpntm008";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |FOCOTECLADO nGrid12;
|FPRC;

|PROGRAMA;
     |DBASS aPathLab;
     aMas  = aPathLab + "laboral/def/labcentr.mas";
     |XABRE "E", aMas, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 3799, -1, 16, "Asistente activaciones por E_mail";
     n0Vent = FSalida;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}Accesos", 0502, 0540, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{15}}Empresas", 1502, 1540, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{15}}Centros de trabajo", 2202, 2240, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{15}}Trabajadores (Doble click para HABILITAR / DESHABILITAR)", 2902, 2990, NULL;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Nuevo acceso", 1483, 1498, NuevoGrid12;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Habilitar acceso", 2183, 2198, ActivarGrid13;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Deshabilitar acceso", 2164, 2181, DesactivarGrid13;
     nBtnDes13 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Habilitar acceso", 2883, 2898, ActivarGrid14;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Deshabilitar acceso", 2864, 2881, DesactivarGrid14;
     nBtnDes14 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Acceso trabajadores", 3702, 3720, AccesoTrab;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Acceso agrupaci¢n", 3722, 3740, AccesoAgru;

     |ESTADO_CONTROL nBtnDes13, "DISABLE";
     |ESTADO_CONTROL nBtnDes14, "DISABLE";

     nRango   = 2 + 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#dpntw012, nRango, 0602, 1398, NULL, NULL, Evnt12;
     nGrid12 = FSalida;

     |LINEAL_SIMPLE #1#dpntw013, nRango, 1602, 2098, Baja13, Alta13, Evnt13;
     nGrid13 = FSalida;

     |LINEAL_SIMPLE #1#dpntw014, nRango, 2302, 2798, Baja14, Alta14, Evnt14;
     nGrid14 = FSalida;

     |LINEAL_SIMPLE #1#dpntw015, nRango, 3002, 3498, Baja15, Alta15, Evnt15;
     nGrid15 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid12;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FINVENTANA n0Vent;

     |PULSATECLA;
|FPRO;

|PROCESO T80;  |TIPO 80;
     eaAcceso = "PIBOX";
     eaAdmin  = "S";

     |DBASS aPathLab;
     aMas  = aPathLab + "laboral/def/labcentr.mas";
     |XABRE "E", aMas, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aPathLab = aPathLab + "laboral/fich/";
     |PATH_DAT #labcentr#aPathLab#;

     aFicTmp = "dpntw012" + Usuario;  |NOME_DAT #dpntw012#aFicTmp#;
     aFicTmp = "dpntw013" + Usuario;  |NOME_DAT #dpntw013#aFicTmp#;
     aFicTmp = "dpntw014" + Usuario;  |NOME_DAT #dpntw014#aFicTmp#;
     aFicTmp = "dpntw015" + Usuario;  |NOME_DAT #dpntw015#aFicTmp#;

     aHMail  = "z" * 150;

     |ABRE #dpntw012;  |CIERRA #dpntw012;  |DELINDEX #dpntw012;
     |ABRE #dpntw013;  |CIERRA #dpntw013;  |DELINDEX #dpntw013;
     |ABRE #dpntw014;  |CIERRA #dpntw014;  |DELINDEX #dpntw014;
     |ABRE #dpntw015;  |CIERRA #dpntw015;  |DELINDEX #dpntw015;

     |ABRET #dpntw012;
     |ABRET #dpntw013;
     |ABRET #dpntw014;
     |ABRET #dpntw015;

     |ABRET #dpntm001;
     |ABRET #dpntm004;
     |ABRET #dpntm005;
     |ABRET #dpntm007;
     |ABRET #dsarz010;
     |ABRET #labcentr;
     |ABRET #nomw0003;

     |HAZ CreaTempos;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #dpntm001;
     |CIERRAT #dpntm004;
     |CIERRAT #dpntm005;
     |CIERRAT #dpntm007;
     |CIERRAT #dsarz010;
     |CIERRAT #labcentr;
     |CIERRAT #nomw0003;

     |CIERRAT #dpntw012;  |DELINDEX #dpntw012;
     |CIERRAT #dpntw013;  |DELINDEX #dpntw013;
     |CIERRAT #dpntw014;  |DELINDEX #dpntw014;
     |CIERRAT #dpntw015;  |DELINDEX #dpntw015;
|FPRC;
