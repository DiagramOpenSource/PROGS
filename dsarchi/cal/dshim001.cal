|FICHEROS;
     dshim001;
|FIN;

|VARIABLES;
     nRango           = 0;
     nGrid            = 0;
     n1Vent           = 0;
     nBtnCon          = 0;
     nBtnDev          = 0;
     nEjAnt           = 0;
     nHand            = 0;
     nEj              = 0;
     nEjAct           = 0;
     nTree            = 0;
     nLin             = 0;

     aFoto            = "";
     aBase            = "";
     aDirLocal        = "";
     aExt             = "";
     aFotoOrigen      = "";
     aFotoDestino     = "";
     aDocRemoto       = "";
     aDocServidor     = "";
     aIPRemoto        = "";
     aEsc1            = "";
     aEsc2            = "";
     aRetu            = "";
     aTecla           = "";
     aFic             = "";
     aAlfa            = "";
     aAbre            = "";
     aRefresca        = "";
     aBuscar          = "";
     aNome            = "";

     fFecha           = @;

     {1}aContiene     = "";

     {-1}sTree        = 0;
         sT_nID       = 0;
         sT_nOper     = 0;
         sT_aData     = "";

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     &eaUnidadBasico   = "";
     &enDocumento      = 0;
     &eaEj             = "";
|FIN;

|PROCESO Archivar;
     |VENTANA 0501, 1835, -1, 0, "";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SUB_EJECUTA_NP "dshiz001;ARCHIVAR";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Desarchivar;
     |VENTANA 0501, 1835, -1, 0, "";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SUB_EJECUTA_NP "dshiz001;DESARCHIVAR";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Consulta;
     enDocumento = #dshim001#0;
     eaEj        = #dshim001#4 % -104;

     |VENTANA 0501, 3599, -1, 16, "Datos Documentos";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SUB_EJECUTA_NP "dsarw006;HISTORICO";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Devolver;
     |CONFI "0000NSeguro que quiere devolver el registro seleccionado al registro";
     |SI FSalida ! 0;
         |FOCOTECLADO nGrid;
         |ACABA;
     |FINSI;

     enDocumento = #dshim001#0;
     eaEj        = #dshim001#4 % -104;

     |VENTANA 0501, 0540, -1, 16, "Realizando proceso.";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |SUB_EJECUTA_NP "dshiz001;DEVOLVER";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Limpiar;
     |MENAV "0000Limpia los registros borrados y llevados al hist¢rico, asegurese que no hay nadie archivando";
     |CONFI "0000NEst  seguro";
     |SI FSalida ! 0;
         |FOCOTECLADO nGrid;
         |ACABA;
     |FINSI;

     |VENTANA 0501, 0540, -1, 16, "Limpiando registros ...";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |SUB_EJECUTA_NP "dshiz001;LIMPIAR";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO DecoraPantalla;
     |DBASE aBase;  |QBF aBase;

     aFotoOrigen = aBase + "logos/logods.jpg";
     aExt        = ".jpg";

     |HAZ LeeUnidadBasico;

     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS";                     |RMKDIR aDirLocal;
     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS\DSARCHI";             |RMKDIR aDirLocal;
     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS\DSARCHI\LOGOS";       |RMKDIR aDirLocal;
     aFotoDestino = aDirLocal + "/logods" + aExt;

     aContiene1 = aFotoDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aFotoOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         aIPRemoto = "";
         |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aFotoOrigen, aFotoDestino;
         |SINO;
             |COPIA_FICHERO aFotoOrigen, aFotoDestino;
         |FINSI;
     |FINSI;

     aFoto = "IMAGEN,"  + aFotoDestino;
     |CONTROL_SIMPLE 0, aFoto, 0501, 0928, NULL;

     |CONTROL_SIMPLE 0, "LABEL,{{16}}Hist¢rico de registros archivados", 0570, 0998, NULL;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Consulta", 3002, 3012, Consulta;
     nBtnCon = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Devolver al registro", 3014, 3030, Devolver;
     nBtnDev = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Archivar en el hist¢rico", 3202, 3222, Archivar;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Devolver al registro desde/hasta", 3224, 3252, Desarchivar;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Limpiar registros borrados", 3254, 3275, Limpiar;

     |ESTADO_CONTROL nBtnCon, "DISABLE";
     |ESTADO_CONTROL nBtnDev, "DISABLE";
|FPRC;

|PROCESO EvntM001;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dshim001.=;

         |ESTADO_CONTROL nBtnCon, "ENABLE";
         |ESTADO_CONTROL nBtnDev, "ENABLE";
     |FINSI;

     |SI FSalida = 4;
         |HAZ Consulta;
     |FINSI;
|FPRC;

|PROCESO EvntTree;
     |SI FEntrada ! 0;  |ACABA;  |FINSI;

     |SI nGrid ! -1;
         |CIERRA #dshim001;
         |DESTRUYECONTROL nGrid;
         |PULSATECLA;
     |FINSI;

     aAlfa = Contenido;  |QBF aAlfa;
     aAlfa = aAlfa % -101;
     |SI aAlfa = ":";
         |ACABA;
     |FINSI;

     aAlfa = Contenido % -104;
     nEj   = aAlfa;
     |SI nEj < 2000;
         |ACABA;
     |FINSI;

     aNome  = "h" + nEj + "m01";
     |NOME_DAT #dshim001#aNome#;

     |ABRE #dshim001;
     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #2#dshim001, nRango, 1102, 2998, NULL, NULL, EvntM001;
     nGrid = FSalida
|FPRC;

|PROCESO CreaTree;
     |HAZ LeeUnidadBasico;

     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS";
     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS\DSARCHI";
     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS\DSARCHI\TMP";         |RMKDIR aDirLocal;
     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS\DSARCHI\TMP\";

     |DFICE aFic;

     fFecha = ~;
     aAlfa  = fFecha % -104;
     nEjAct = aAlfa;

     aAbre = aDirLocal + "dshim001.txt";
     |XABRE "CW", aAbre, nHand;
     |SI FSalida ] 0;
         nLin = 0;
         |PARA nEj = nEjAct; |SI nEj ] 2000;  |HACIENDO nEj = nEj - 1;
               aAlfa = aFic + "h" + nEj + "m01.dat";
               |XABRE "E", aAlfa, 0;
               |SI FSalida ] 0;
                   nLin = nLin + 1;
                   aAlfa = nLin + ":" + nEj + " " + "{{" + nEj + "}}" + &13 + &10;
                   |XGRABA nHand, aAlfa;
               |FINSI;
         |SIGUE;
     |FINSI;
     |XCIERRA nHand;

     sT_nID   = nTree;
     sT_nOper = 0;

     aAlfa = "TREECTRL,Ejercicios {{" + aAbre + "}}";
     |CONTROL_SIMPLE 0, aAlfa, 0635, 0963, EvntTree;
     nTree = FSalida;

     |SI aBuscar ! "";
         sT_nID   = nTree;
         sT_nOper = 3;
         sT_aData = "[" + aBuscar;
         |ESPECIFICA "COMMANDCONTROL", sTree;
         |SI FSalida ] 0;
             aRefresca = ":" + FSalida;
         |SINO;
             aRefresca = "1:";
         |FINSI;
     |FINSI;

     sT_nID   = nTree;
     sT_nOper = 2;
     |SI aRefresca = "";
         sT_aData = "1:";
     |SINO;
         sT_aData = aRefresca;
     |FINSI;
     |ESPECIFICA "COMMANDCONTROL", sTree;

     |RFBORRA aAbre;
|FPRC;

|PROGRAMA;
     |HAZ DecoraPantalla;

     |HAZ CreaTree;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::Salir," + nTree;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |CIERRA #dshim001;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     FSalida = 3299;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
|FPRC;
