||Esta basado en el dsarz028. Reglas Auto.Documen. (la estructura del programa)

|FICHEROS;
     dsarm023 #1;

     dsarm024 #24;       ||Colecciones

     dsarw051 #51,MANTE; ||Aux.Prep.Document.

     dsarm025 #25;       ||Config.Colec.Documen
     dsarm027 #27;       ||Local.ValoresBusqued

     dsarw052 #40,MANTE; ||Aux. Copiar Coleccion

     dsarm004 #4;        ||Tipos Documentos

     dsarm002 #2;        ||Grupos

     dsarm005 #5;        ||Registro Documentos
     referen@ #905;      ||Carga_def resultados


     dsarm001 #101;      ||Parametros.

     dsarw075 #75;       ||Tempo Preg.Localiza.
     dsarw076 #76,MANTE; ||Panta Preg.Localiza.

     dsarw080 #80,MANTE;       ||Axu. Aplicar Colecc.

     dsarcl01 #901;
     dsarcl02 #902;
|FIN;

|VARIABLES;
     &enCodHistoria = 0;

     nBotonSele1 = 0;
     nBotonSele2 = 0;
     nBotonSele3 = 0;
     nBotonSele4 = 0;
     nBotonSele5 = 0;
     nBotonSele6 = 0;
     nBotonSele7 = 0;
     nBotonSele8 = 0;
     nBotonSele9 = 0;
     nBotonSele10 = 0;
     nBotonSele11 = 0;
     nBotonSele12 = 0;

     &eaHistoriaBusca = "";
     &eaEpisodioBusca = "";

     nSwPregLocaliGlobal = 0;
     &enSwColeccionGrid = 0;

     aSwLocaNif = "";
     aModoColeccion = "";
     nColeccion = 0;
     nSalida = 0;

     nVentm23 = 0;
     aParametro = "";

     ||Localizadores Variables
     nConsulta = 1;           ||Para averiguar si debe preguntar o no algun localizador
     nSwPregLocali = 0;
     aLoca = "";
     nVentm2 = 0;
     nPanta76 = 0;
     nSwCancelar = 0;
     aRangoParrilla = "";
     fBusco = @;
     fDesde = @;
     fHasta = @;

     aDirectorio = "";
     aPath = "";
     aLetra = "";
     aPathDestino = "";
     aCarpetaDestino = "";
     nSeleccionados = 0;
     nSwModoLibre = 0;
     nVoyLibre = 0;
     nContador = 0;
     nMiraCampo = 0;
     nMiraSele = 0;
     nMiraLoca = 0;
     aLiteral = "";
     aQuita = "";

     nCampoBusco = 0;
     aLocalizador = "";
     nSwMete = 0;
     nSwContinua = 0;
     nGrupo = 0;
     nSubGrupo = 0;
     nTipo = 0;

     aTipoCampo = "";         || [A]lfa; [F]echa; [N]umerico
     aBusco = "";
     nBusco = 0;
     aBlanco50 = "";
     nSwPlantilla = 0;
     aValor = "";
     aDesde = "";
     nDesde = 0;
     aHasta = "";
     nHasta = 0;
     nValor = 0;

     nBotonLabel = 0;

     aDef = "";
     aTexto = "";
     &enNumeroPrepa = 0;
     nPreparacion = 0;

     nSwGrupo = 0;
     nSwNumPre = 0;
     nSwEstaCarpeta = 0;
     aBuscoCarpeta = "";
     nEstoy = 0;

     aCarpeta = "";
     {1}aContiene     = "";
     nError = 0;
     aOrigen = "";
     nHandle = 0;
     aDestino = "";
     aDocDestino = "";
     aDocOrigen = "";
     aIPRemoto = "";
     aLinea = "";


     &eaUnidad = "";
     nRegla = 0;
     nLabel = 0;

     {-1}aVent      = "";
         aVent1     = 0;
         aVent2     = 0;
         aVent3     = 0;
         aVent4     = 0;
         aVent5     = "";

     nSubVent = 0;
     &enNumRegla = 0;
     aEjecuta = "";
     aQueBoton     = "";
     aID           = "";
     nBotonAceptar = 0;
     nBotonCancelar = 0;

     aAux = "";
     nTCampo = 0;
     aQueQuiero = "";
     aFichero = "";
     aBase = "";
     aCarga = "";
     nCampo = 0;
     aImpre = "";

     nUltimo = 0;
     nIdSalir = 0;
     {2}nNivel = 0;
     nVentana = 0;
     nPantaDos = 0;
     aCadena = "";
     aAlfa = "";
     nCampoHasta = 0;
     nCampoD = 0;
     nCampoH = 0;


     aMensaje = "";

     nBoton1 = 0;
     nBoton2 = 0;
     nBoton3 = 0;
     nBoton4 = 0;
     nBoton5 = 0;
     nPanta = 0;
     nRango = 0;
     nPos1  = 0;
     nPos2  = 0;
     nGrid = 0;
     aEsc1  = "";
     aEsc2  = "";
     aRetu  = "";
     aTecla = "";

     nModo = 0;

     &eaUnidadBasico = "";
|FIN;

|PROCESO Tipo7C2w076; |TIPO 7;
     |HAZ Tipo0C2w076;
|FPRC;

|PROCESO Tipo0C2w076; |TIPO 0;
     |SI #dsarw076#2 = "R";
          |C_M #dsarw076#3, 1, "S";
          |C_M #dsarw076#4, 1, "S";
          |C_M #dsarw076#5, 1, "N";
          |C_M #dsarw076#6, 1, "N";
          |C_M #dsarw076#7, 1, "N";
          |C_M #dsarw076#8, 1, "N";
          |C_M #dsarw076#9, 1, "N";
          |C_M #dsarw076#10, 1, "N";
          |C_M #dsarw076#11, 1, "N";
          |C_M #dsarw076#12, 1, "N";
          |C_M #dsarw076#13, 1, "N";
          |C_M #dsarw076#14, 1, "N";
          |SI #dsarm001#194 = "S";
               |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
                    |ESTADO_CONTROL nBotonSele1, "ENABLE";
                    |ESTADO_CONTROL nBotonSele2, "ENABLE";
                    |ESTADO_CONTROL nBotonSele3, "DISABLE";
                    |ESTADO_CONTROL nBotonSele4, "DISABLE";
                    |ESTADO_CONTROL nBotonSele5, "DISABLE";
                    |ESTADO_CONTROL nBotonSele6, "DISABLE";
                    |ESTADO_CONTROL nBotonSele7, "DISABLE";
                    |ESTADO_CONTROL nBotonSele8, "DISABLE";
                    |ESTADO_CONTROL nBotonSele9, "DISABLE";
                    |ESTADO_CONTROL nBotonSele10, "DISABLE";
                    |ESTADO_CONTROL nBotonSele11, "DISABLE";
                    |ESTADO_CONTROL nBotonSele12, "DISABLE";
               |FINSI;
          |FINSI;
     |SINO;
          |C_M #dsarw076#3, 1, "N";
          |C_M #dsarw076#4, 1, "N";
          |C_M #dsarw076#5, 1, "S";
          |C_M #dsarw076#6, 1, "S";
          |C_M #dsarw076#7, 1, "S";
          |C_M #dsarw076#8, 1, "S";
          |C_M #dsarw076#9, 1, "S";
          |C_M #dsarw076#10, 1, "S";
          |C_M #dsarw076#11, 1, "S";
          |C_M #dsarw076#12, 1, "S";
          |C_M #dsarw076#13, 1, "S";
          |C_M #dsarw076#14, 1, "S";
          |SI #dsarm001#194 = "S";
               |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
                    |ESTADO_CONTROL nBotonSele1, "DISABLE";
                    |ESTADO_CONTROL nBotonSele2, "DISABLE";
                    |ESTADO_CONTROL nBotonSele3, "ENABLE";
                    |ESTADO_CONTROL nBotonSele4, "ENABLE";
                    |ESTADO_CONTROL nBotonSele5, "ENABLE";
                    |ESTADO_CONTROL nBotonSele6, "ENABLE";
                    |ESTADO_CONTROL nBotonSele7, "ENABLE";
                    |ESTADO_CONTROL nBotonSele8, "ENABLE";
                    |ESTADO_CONTROL nBotonSele9, "ENABLE";
                    |ESTADO_CONTROL nBotonSele10, "ENABLE";
                    |ESTADO_CONTROL nBotonSele11, "ENABLE";
                    |ESTADO_CONTROL nBotonSele12, "ENABLE";
               |FINSI;
          |FINSI;
     |FINSI;
     |PINTA #dsarw076#3;
     |PINTA #dsarw076#4;
     |PINTA #dsarw076#5;
     |PINTA #dsarw076#6;
     |PINTA #dsarw076#7;
     |PINTA #dsarw076#8;
     |PINTA #dsarw076#9;
     |PINTA #dsarw076#10;
     |PINTA #dsarw076#11;
     |PINTA #dsarw076#12;
     |PINTA #dsarw076#13;
     |PINTA #dsarw076#14;
     |PINTA #dsarw076#15;
|FPRC;

|PROCESO SeleccionaDondeBuscar;
     aTexto = "Preparaci¢n documentaci¢n: " + aTexto
     |VENTANA 0501, 2799, nPanta, 17, aTexto;
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enNumeroPrepa = nPreparacion;

     |SUB_EJECUTA_NP "dsarm026";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;
|FPRC;

|PROCESO Tipo12_w076; |TIPO 12;
|FPRC;

|PROCESO Tipo12_w080; |TIPO 12;
|FPRC;



|PROCESO Tipo12w051; |TIPO 12;
     |SI FSalida ! 7;         ||CANCELAR
          aCarpeta = #dsarw051#2;
          |QBT aCarpeta;
          |SI aCarpeta = "";
               aMensaje = "0000Atenci¢n: Carpeta vacia";
               |MENAV aMensaje;
               |ERROR;
          |FINSI;

          nPreparacion = #dsarw051#0;

          aTexto = (("0000" + nPreparacion) % -104) + " " + #dsarw051#1;
          |QBF aTexto;
          aTexto = aTexto % 180;

          |HAZ SeleccionaDondeBuscar;
     |FINSI;
|FPRC;

|PROCESO Tipo0C0w051; |TIPO 0;
     |SI FSalida ! 7;
          |SI nModo = 1;
               #dsarm024#0 = #dsarw051#0;
               |LEE 000#dsarm024.=;
               |SI FSalida = 0;
                    aMensaje = "0000Error: Colecci¢n YA definida previamente";
                    |MENAV aMensaje;
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo0C0w052; |TIPO 0;
     |SI FSalida ! 7;
          |SI #dsarw052#0 = #dsarw052#2;
               aMensaje = "0000Error: Colecci¢n Origen = Colecci¢n Destino";
               |MENAV aMensaje;
               |ERROR;
          |SINO;

               #dsarm024#0 = #dsarw052#2;
               |LEE 000#dsarm024.=;
               |SI FSalida = 0;
                    aMensaje = "0000Error: Colecci¢n YA definida previamente";
                    |MENAV aMensaje;
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo12w052; |TIPO 12;
     |SI FSalida ! 7;         ||CANCELAR
          aCarpeta = #dsarw052#4;
          |QBT aCarpeta;
          |SI aCarpeta = "";
               aMensaje = "0000Atenci¢n: Carpeta vacia";
               |MENAV aMensaje;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO Tipo0Etiqueta; |TIPO 0;
     nCampo = Campo - 2;
     aAux = #51Campo;
     |QBF aAux;
     |SI aAux = ""; |Y #51nCampo = 0;
          nCampo = nCampo + 1;
          #51nCampo = "";
          |PINTA #51nCampo;
     |SINO;
          |SI aAux ! ""; |Y #51nCampo = 0;
               nCampo = Campo - 1;
               #51nCampo = "Linea";
               |PINTA #51nCampo;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ObtenIdSalir;
     InNivel = nNivel1<-;
     nNivel1 = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;
     nIdSalir = nNivel2;
|FPRC;


|PROCESO Tipo80C0; |TIPO 80;
     FSalida = 2999;
|FPRC;

|PROCESO BajaPanta;
     #dsarm024#0 = 0001;
|FPRC;

|PROCESO AltaPanta;
     #dsarm024#0 = 9999;
|FPRC;

|PROCESO EventoPanta;
     |SI FSalida = 1;  |O FSalida = 2;
          |LEE 000#dsarm024.=;
          |SI FSalida = 0;
               |ESTADO_CONTROL nBoton2, "ENABLE";
               |ESTADO_CONTROL nBoton3, "ENABLE";
               |ESTADO_CONTROL nBoton4, "ENABLE";
          |SINO;
               |ESTADO_CONTROL nBoton2, "DISABLE";
               |ESTADO_CONTROL nBoton3, "DISABLE";
               |ESTADO_CONTROL nBoton4, "DISABLE";
          |FINSI;
     |FINSI;

     |SI FSalida = 4;
          |HAZ Boton2;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     nModo = 1;
     |HAZ ModiAlta;
     |REFRESCACONTROL nGrid;
|FPRC;

|PROCESO Boton2;
     |LEE 000#dsarm024.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nModo = 2;
     |HAZ ModiAlta;
     |REFRESCACONTROL nGrid;
|FPRC;

|PROCESO dsarm025_borra;
     |BORRA 020#dsarm025.a;
|FPRC;

|DEFBUCLE dsarm025_borra;
 #dsarm025#1;
 ;
 #dsarm024#0, 001, 001, 001;
 #dsarm024#0, 999, 999, 999;
 be;
 NULL, dsarm025_borra;
|FIN;

|PROCESO dsarm027_borra;
     |BORRA 020#dsarm027.a;
|FPRC;

|DEFBUCLE dsarm027_borra;
 #dsarm027#1;
 ;
 #dsarm024#0, "        ";
 #dsarm024#0, "zzzzzzzz";
 be;
 NULL, dsarm027_borra;
|FIN;


|PROCESO Boton3;
     |LEE 000#dsarm024.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |LEE 101#dsarm024.=;
     |SI FSalida = 0;
          aMensaje = "0000NDesea Borrar " + #24#1;
          |QBF aMensaje;
          aMensaje = aMensaje + "?";
          |CONFI aMensaje;
          |SI FSalida = 0;
               |BUCLE dsarm025_borra;
               |BUCLE dsarm027_borra;
               |BORRA 020#dsarm024.a;
          |FINSI;
          |LIBERA #dsarm024;
     |FINSI;

     |REFRESCACONTROL nGrid;
|FPRC;

|PROCESO dsarm025_copia;
     #dsarm025#0 = #dsarw052#2;
     |GRABA 020#dsarm025.n;
     |LIBERA #dsarm025;
|FPRC;

|DEFBUCLE dsarm025_copia;
 #dsarm025#1;
 ;
 nRegla, 001, 001, 001;
 nRegla, 999, 999, 999;
 ;
 NULL, dsarm025_copia;
|FIN;

|PROCESO dsarm027_copia;
     #dsarm027#0 = #dsarw052#2;
     |GRABA 020#dsarm027.n;
     |LIBERA #dsarm027;
|FPRC;

|DEFBUCLE dsarm027_copia;
 #dsarm027#1;
 ;
 nRegla, "        ";
 nRegla, "zzzzzzzz";
 ;
 NULL, dsarm027_copia;
|FIN;


|PROCESO Boton4;
     |LEE 000#dsarm024.=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nRegla = #dsarm024#0;

     |VENTANA 1005, 1790, nPanta, 17, "Copiar Configuraci¢n Colecci¢n";
     nSubVent = FSalida;

     nLabel = -1;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #dsarw052;
     #dsarw052#0 = #dsarm024#0;
     #dsarw052#1 = #dsarm024#1;
     nUltimo = 0;
     |HAZ DameUltimo;
     nUltimo = nUltimo + 1;
     #dsarw052#2 = nUltimo;

     |PINPA #0#dsarw052;
     |PINDA #0#dsarw052;

     |ENDATOS #1#dsarw052;
     |SI FSalida = 0;
          #dsarm024#0 = nRegla;
          |LEE 000#dsarm024.=;
          |SI FSalida = 0;
               #dsarm024#0 = #dsarw052#2;
               #dsarm024#1 = #dsarw052#3;
               #dsarm024#2 = #dsarw052#4;
               |GRABA 020#dsarm024.n;
               |LIBERA #dsarm024;

               |BUCLE dsarm025_copia;
               |BUCLE dsarm027_copia;
          |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;

     |REFRESCACONTROL nGrid;
|FPRC;

|PROCESO Acotacion;
     |DDEFECTO #dsarm027;
     #dsarm027#0 = nPreparacion;
     #dsarm027#1 = aLocalizador;
     |LEE 000#dsarm027.=;
     |SI FSalida = 0;
          |SI #dsarm027#16 = "S";
               nSwPregLocali = 1;
          |SINO;
               nSwPregLocali = 0;
          |FINSI;
     |FINSI;

     |SI nSwPregLocali = 0;
          |DDEFECTO #dsarm027;
          #dsarm027#0 = nPreparacion;
          #dsarm027#1 = aLocalizador;
          |LEE 000#dsarm027.=;
          |SI FSalida ! 0;
               ||No encuentra el localizador. No puedo acotar.
               nSwContinua = 0;
               |ACABA;
          |FINSI;
     |SINO;
          |DDEFECTO #dsarw075;
          #dsarw075#1 = aLocalizador;
          |LEE 000#dsarw075.=;
          |SI FSalida ! 0;
               ||No encuentra el localizador. No puedo acotar.
               nSwContinua = 0;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI nSwModoLibre = 1;
          aQuita = aLiteral + ": ";
          aBusco = #dsarm005#nCampoBusco#;
          aBusco = aBusco - aQuita;
          |SI aTipoCampo = "A";
               aBusco = (aBusco + aBlanco50) % 150;
          |SINO;
               |SI aTipoCampo = "F";
                    |QBF aBusco;
                    fBusco = aBusco;
               |SINO;
                    nBusco = aBusco;
                    ||aBusco = (nBusco + aBlanco50) % 150;
               |FINSI;
          |FINSI;
     |SINO;
          |SI aTipoCampo = "A";
               aBusco = #dsarm005#nCampoBusco#;
               aBusco = (aBusco + aBlanco50) % 150;
          |SINO;
               |SI aTipoCampo = "F";
                    |QBF aBusco;
                    fBusco = aBusco;
               |SINO;
                    nBusco = #dsarm005#nCampoBusco#;
                    ||aBusco = (nBusco + aBlanco50) % 150;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nSwPregLocali = 0;
          aRangoParrilla = #dsarm027#2;
     |SINO;
          aRangoParrilla = #dsarw075#2;
     |FINSI;

     |SI aRangoParrilla = "R";   ||RANGO

          |SI aTipoCampo = "A"; |O aTipoCampo = "F";
               |SI nSwPregLocali = 0;
                    aDesde = #dsarm027#3;
                    aHasta = #dsarm027#4;
               |SINO;
                    aDesde = #dsarw075#3;
                    aHasta = #dsarw075#4;
               |FINSI;
               |SI aTipoCampo = "F";
                    |QBF aDesde;
                    |QBF aHasta;
                    fDesde = aDesde;
                    fHasta = aHasta;
               |FINSI;
          |SINO;
               |SI nSwPregLocali = 0;
                    nDesde = #dsarm027#3;
                    nHasta = #dsarm027#4;
               |SINO;
                    nDesde = #dsarw075#3;
                    nHasta = #dsarw075#4;
               |FINSI;
               ||aDesde = (nDesde + aBlanco50) % 150;
               ||aHasta = (nHasta + aBlanco50) % 150;
          |FINSI;

          |SI aTipoCampo = "F";
               |SI fBusco ] fDesde; |Y fBusco [ fHasta;
                    nSwMete = 1;
                    |ACABA;
               |SINO;
                    nSwMete = 0;
                    nSwContinua = 0;
                    |ACABA;
               |FINSI;
          |SINO;
               |SI aTipoCampo = "N";
                    |SI nBusco ] nDesde; |Y nBusco [ nHasta;
                         nSwMete = 1;
                         |ACABA;
                    |SINO;
                         nSwMete = 0;
                         nSwContinua = 0;
                         |ACABA;
                    |FINSI;
               |SINO;
                    |SI aBusco ] aDesde; |Y aBusco [ aHasta;
                         nSwMete = 1;
                         |ACABA;
                    |SINO;
                         nSwMete = 0;
                         nSwContinua = 0;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          nSwPlantilla = 0;

          |SI nSwPregLocali = 0;
               aValor = #dsarm027#5;
          |SINO;
               aValor = #dsarw075#5;
          |FINSI;
          aAux = aValor;
          |QBF aAux;
          |SI aAux ! "";
               |SI aTipoCampo = "N";
                    nValor = aValor;
                    ||aValor = (nValor + aBlanco50) % 150;
                    |SI nBusco = nValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |SINO;
                    |SI aBusco = aValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSwPregLocali = 0;
               aValor = #dsarm027#6;
          |SINO;
               aValor = #dsarw075#6;
          |FINSI;
          aAux = aValor;
          |QBF aAux;
          |SI aAux ! "";
               |SI aTipoCampo = "N";
                    nValor = aValor;
                    ||aValor = (nValor + aBlanco50) % 150;
                    |SI nBusco = nValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |SINO;
                    |SI aBusco = aValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSwPregLocali = 0;
               aValor = #dsarm027#7;
          |SINO;
               aValor = #dsarw075#7;
          |FINSI;
          aAux = aValor;
          |QBF aAux;
          |SI aAux ! "";
               |SI aTipoCampo = "N";
                    nValor = aValor;
                    ||aValor = (nValor + aBlanco50) % 150;
                    |SI nBusco = nValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |SINO;
                    |SI aBusco = aValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSwPregLocali = 0;
               aValor = #dsarm027#8;
          |SINO;
               aValor = #dsarw075#8;
          |FINSI;
          aAux = aValor;
          |QBF aAux;
          |SI aAux ! "";
               |SI aTipoCampo = "N";
                    nValor = aValor;
                    ||aValor = (nValor + aBlanco50) % 150;
                    |SI nBusco = nValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |SINO;
                    |SI aBusco = aValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSwPregLocali = 0;
               aValor = #dsarm027#9;
          |SINO;
               aValor = #dsarw075#9;
          |FINSI;
          aAux = aValor;
          |QBF aAux;
          |SI aAux ! "";
               |SI aTipoCampo = "N";
                    nValor = aValor;
                    ||aValor = (nValor + aBlanco50) % 150;
                    |SI nBusco = nValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |SINO;
                    |SI aBusco = aValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSwPregLocali = 0;
               aValor = #dsarm027#10;
          |SINO;
               aValor = #dsarw075#10;
          |FINSI;
          aAux = aValor;
          |QBF aAux;
          |SI aAux ! "";
               |SI aTipoCampo = "N";
                    nValor = aValor;
                    ||aValor = (nValor + aBlanco50) % 150;
                    |SI nBusco = nValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |SINO;
                    |SI aBusco = aValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSwPregLocali = 0;
               aValor = #dsarm027#11;
          |SINO;
               aValor = #dsarw075#11;
          |FINSI;
          aAux = aValor;
          |QBF aAux;
          |SI aAux ! "";
               |SI aTipoCampo = "N";
                    nValor = aValor;
                    ||aValor = (nValor + aBlanco50) % 150;
                    |SI nBusco = nValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |SINO;
                    |SI aBusco = aValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSwPregLocali = 0;
               aValor = #dsarm027#12;
          |SINO;
               aValor = #dsarw075#12;
          |FINSI;
          aAux = aValor;
          |QBF aAux;
          |SI aAux ! "";
               |SI aTipoCampo = "N";
                    nValor = aValor;
                    ||aValor = (nValor + aBlanco50) % 150;
                    |SI nBusco = nValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |SINO;
                    |SI aBusco = aValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSwPregLocali = 0;
               aValor = #dsarm027#13;
          |SINO;
               aValor = #dsarw075#13;
          |FINSI;
          aAux = aValor;
          |QBF aAux;
          |SI aAux ! "";
               |SI aTipoCampo = "N";
                    nValor = aValor;
                    ||aValor = (nValor + aBlanco50) % 150;
                    |SI nBusco = nValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |SINO;
                    |SI aBusco = aValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSwPregLocali = 0;
               aValor = #dsarm027#14;
          |SINO;
               aValor = #dsarw075#14;
          |FINSI;
          aAux = aValor;
          |QBF aAux;
          |SI aAux ! "";
               |SI aTipoCampo = "N";
                    nValor = aValor;
                    ||aValor = (nValor + aBlanco50) % 150;
                    |SI nBusco = nValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |SINO;
                    |SI aBusco = aValor;
                         nSwPlantilla = 1;
                         nSwMete = 1;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;

          |SI nSwPlantilla = 0;
               nSwMete = 0;
               nSwContinua = 0;
               |ACABA;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AcotacionLibre;
     nSwModoLibre = 1;

     |SI nVoyLibre [ 15;
          nCampoBusco = 22 + nVoyLibre;
     |SINO;
          nCampoBusco = 44 + nVoyLibre;
     |FINSI;
     |HAZ Acotacion;
|FPRC;

|PROCESO dsarm005;
     nSwModoLibre = 0;

     ||MIRA ACOTACION.
     nSwMete = 0;        ||Por defecto NO lo meto.
     nSwContinua = 1;    ||Estoy haciendo un AND.

     ||_CLIENTE_
     aTipoCampo = "N";
     nCampoBusco = 8;
     aLocalizador = #dsarm025#52;
     |QBF aLocalizador;
     |SI #dsarm025#7 = "S"; |Y aLocalizador ! "";
          |HAZ Acotacion;
     |FINSI;
     |SI nSwContinua = 0;     |ACABA;   |FINSI;

     ||_NIF_
     aTipoCampo = "A";
     nCampoBusco = 10;
     aLocalizador = #dsarm025#53;
     |QBF aLocalizador;
     |SI #dsarm025#8 = "S"; |Y aLocalizador ! "";
          |HAZ Acotacion;
     |FINSI;
     |SI nSwContinua = 0;     |ACABA;   |FINSI;

     ||_TRABAJADOR_
     aTipoCampo = "N";
     nCampoBusco = 15;
     aLocalizador = #dsarm025#54;
     |QBF aLocalizador;
     |SI #dsarm025#9 = "S"; |Y aLocalizador ! "";
          |HAZ Acotacion;
     |FINSI;
     |SI nSwContinua = 0;     |ACABA;   |FINSI;

     ||_MODELOS_
     aTipoCampo = "N";
     nCampoBusco = 19;
     aLocalizador = #dsarm025#55;
     |QBF aLocalizador;
     |SI #dsarm025#10 = "S"; |Y aLocalizador ! "";
          |HAZ Acotacion;
     |FINSI;
     |SI nSwContinua = 0;     |ACABA;   |FINSI;

     ||_SERIE MINUTAS_
     aTipoCampo = "A";
     nCampoBusco = 39;
     aLocalizador = #dsarm025#56;
     |QBF aLocalizador;
     |SI #dsarm025#11 = "S"; |Y aLocalizador ! "";
          |HAZ Acotacion;
     |FINSI;
     |SI nSwContinua = 0;     |ACABA;   |FINSI;

     ||_SERIE MINUTAS_
     aTipoCampo = "N";
     nCampoBusco = 40;
     aLocalizador = #dsarm025#57;
     |QBF aLocalizador;
     |SI #dsarm025#11 = "S"; |Y aLocalizador ! "";
          |HAZ Acotacion;
     |FINSI;
     |SI nSwContinua = 0;     |ACABA;   |FINSI;


     |SI #dsarm001#194 = "S";       ||Conexion CLINICA
          ||Historias
          aTipoCampo = "N";
          nCampoBusco = 97;
          aLocalizador = #dsarm025#81;
          |QBF aLocalizador;
          |SI aLocalizador ! "";
               |HAZ Acotacion;
          |FINSI;
          |SI nSwContinua = 0;     |ACABA;   |FINSI;

          ||Episodios
          aTipoCampo = "N";
          nCampoBusco = 98;
          aLocalizador = #dsarm025#82;
          |QBF aLocalizador;
          |SI aLocalizador ! "";
               |HAZ Acotacion;
          |FINSI;
          |SI nSwContinua = 0;     |ACABA;   |FINSI;
     |FINSI;

     ||FALTA CONTROL CAMPOS LIBRES

     nVoyLibre = 0;

     |PARA nContador = 1; |SI nContador [ 20; |HACIENDO nContador = nContador + 1;
          |SI nSwContinua = 0;     |SAL;   |FINSI;
          nMiraCampo = 11 + nContador;
          nMiraSele = 31 + nContador;
          nMiraLoca = 57 + nContador;
          aAux = #dsarm025#nMiraCampo#;
          |QBF aAux;
          |SI aAux ! "";
               aLiteral = aAux;
               nVoyLibre = nVoyLibre + 1;
               aLocalizador = #dsarm025#nMiraLoca#;
               |QBF aLocalizador;
               |SI #dsarm025#nMiraSele# = "S"; |Y aLocalizador ! "";
                    |SI nContador [ 10;
                         aTipoCampo = "A";
                    |SINO;
                         |SI nContador [ 15;
                              aTipoCampo = "N";
                         |SINO;
                              aTipoCampo = "F";
                         |FINSI;
                    |FINSI;

                    |HAZ AcotacionLibre;
               |FINSI;
          |FINSI;
     |SIGUE;

     |SI nSwMete = 1;
          aMensaje = "0000Mete Registro " + #dsarm005#0;
          ||MENAV aMensaje;

          |DDEFECTO #referen@;
          #referen@#0 = #dsarm005#0;
          |LEE 101#referen@.=;
          |SI FSalida ! 0;
               nSeleccionados = nSeleccionados + 1;
               |PARA nContador = 1; |SI nContador [ 98; |HACIENDO nContador = nContador + 1;
                    #referen@#nContador# = #dsarm005#nContador#;
               |SIGUE;
               |GRABA 020#referen@.n;
          |FINSI;
          |LIBERA #referen@;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm005;
 #dsarm005#2;
 ;
 nGrupo, nSubGrupo, nTipo, 000000001;
 nGrupo, nSubGrupo, nTipo, 999999999;
 ;
 NULL, dsarm005;
|FIN;

|PROCESO dsarm025;
     nGrupo = #dsarm025#1;
     nSubGrupo = #dsarm025#2;
     nTipo = #dsarm025#3;
     |BUCLE dsarm005;
|FPRC;

|DEFBUCLE dsarm025;
 #dsarm025#1;
 ;
 nPreparacion, 001, 001, 001;
 nPreparacion, 999, 999, 999;
 ;
 NULL, dsarm025;
|FIN;

|PROCESO CopiaFicheros;
     aOrigen = #referen@#7;
     |QBF aOrigen;
     aOrigen = aOrigen + #referen@#9;
     |QBF aOrigen;

     aDestino = aPathDestino + #referen@#9;
     |QBF aDestino;

     |SI #dsarm001#7 = "N";
          |SI aIPRemoto ! "";
               |ENVIA_FICHERO aOrigen, aDestino;
          |SINO;
               |COPIA_FICHERO aOrigen, aDestino;
          |FINSI;
     |SINO;
          |RCOPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     aMensaje = "0000Copiar " + aOrigen;
     ||MENAV aMensaje;
     ||TODO CCC
|FPRC;

|DEFBUCLE CopiaFicheros;
 #referen@#1001;
 ;
 000000001;
 999999999;
 ;
 NULL, CopiaFicheros;
|FIN;

/*
||ESTA REPETIDO
|PROCESO Tipo0C2_w076;
     |SI #dsarw076#2 = "R";
          |C_M #dsarw076#3, 1, "S";
          |C_M #dsarw076#4, 1, "S";
          |C_M #dsarw076#5, 1, "N";
          |C_M #dsarw076#6, 1, "N";
          |C_M #dsarw076#7, 1, "N";
          |C_M #dsarw076#8, 1, "N";
          |C_M #dsarw076#9, 1, "N";
          |C_M #dsarw076#10, 1, "N";
          |C_M #dsarw076#11, 1, "N";
          |C_M #dsarw076#12, 1, "N";
          |C_M #dsarw076#13, 1, "N";
          |C_M #dsarw076#14, 1, "N";
     |SINO;
          |C_M #dsarw076#3, 1, "N";
          |C_M #dsarw076#4, 1, "N";
          |C_M #dsarw076#5, 1, "S";
          |C_M #dsarw076#6, 1, "S";
          |C_M #dsarw076#7, 1, "S";
          |C_M #dsarw076#8, 1, "S";
          |C_M #dsarw076#9, 1, "S";
          |C_M #dsarw076#10, 1, "S";
          |C_M #dsarw076#11, 1, "S";
          |C_M #dsarw076#12, 1, "S";
          |C_M #dsarw076#13, 1, "S";
          |C_M #dsarw076#14, 1, "S";
     |FINSI;
     |PINTA #dsarw076#3;
     |PINTA #dsarw076#4;
     |PINTA #dsarw076#5;
     |PINTA #dsarw076#6;
     |PINTA #dsarw076#7;
     |PINTA #dsarw076#8;
     |PINTA #dsarw076#9;
     |PINTA #dsarw076#10;
     |PINTA #dsarw076#11;
     |PINTA #dsarw076#12;
     |PINTA #dsarw076#13;
     |PINTA #dsarw076#14;
     |PINTA #dsarw076#15;
|FPRC;
*/

|PROCESO Inf02;
     #dsarcl02#0 = enCodHistoria;
     #dsarcl02#1 = 0;
|FPRC;

|PROCESO Sup02;
     #dsarcl02#0 = enCodHistoria;
     #dsarcl02#1 = 999999999;
|FPRC;

|PROCESO BotonSele1;
     |SI #dsarm001#194 = "S";
          |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
               |SI #dsarm027#17 = "S";
                    |CONSULTA_CLAVE #1#dsarcl01;
                    |SI FSalida = 0;
                         #dsarw076#3 = #dsarcl01#0;
                         |PINTA #dsarw076#3;
                         #dsarw076#4 = #dsarcl01#0;
                         |PINTA #dsarw076#4;
                         enCodHistoria = #dsarw076#3;
                    |FINSI;
               |FINSI;
               |SI #dsarm027#18 = "S";
                    |SI enCodHistoria ! 0;
                         ||ARA38
                         |CONSULTA_F_CLAVE #1#dsarcl02, Inf02, Sup02;
                    |SINO;
                         |CONSULTA_CLAVE #1#dsarcl02;
                    |FINSI;
                    |SI FSalida = 0;
                         #dsarw076#3 = #dsarcl02#1;
                         |PINTA #dsarw076#3;
                         #dsarw076#4 = #dsarcl02#1;
                         |PINTA #dsarw076#4;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonSele2;
     |SI #dsarm001#194 = "S";
          |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
               |SI #dsarm027#17 = "S";
                    |CONSULTA_CLAVE #1#dsarcl01;
                    |SI FSalida = 0;
                         #dsarw076#4 = #dsarcl01#0;
                         |PINTA #dsarw076#4;
                         enCodHistoria = #dsarw076#4;
                    |FINSI;
               |FINSI;
               |SI #dsarm027#18 = "S";
                    |SI enCodHistoria ! 0;
                         |CONSULTA_F_CLAVE #1#dsarcl02, Inf02, Sup02;
                    |SINO;
                         |CONSULTA_CLAVE #1#dsarcl02;
                    |FINSI;
                    |SI FSalida = 0;
                         #dsarw076#4 = #dsarcl02#1;
                         |PINTA #dsarw076#4;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonSele3;
     |SI #dsarm001#194 = "S";
          |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
               |SI #dsarm027#17 = "S";
                    |CONSULTA_CLAVE #1#dsarcl01;
                    |SI FSalida = 0;
                         #dsarw076#5 = #dsarcl01#0;
                         |PINTA #dsarw076#5;
                         enCodHistoria = 0;
                    |FINSI;
               |FINSI;
               |SI #dsarm027#18 = "S";
                    |SI enCodHistoria ! 0;
                         |CONSULTA_F_CLAVE #1#dsarcl02, Inf02, Sup02;
                    |SINO;
                         |CONSULTA_CLAVE #1#dsarcl02;
                    |FINSI;
                    |SI FSalida = 0;
                         #dsarw076#5 = #dsarcl02#1;
                         |PINTA #dsarw076#5;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonSele4;
     |SI #dsarm001#194 = "S";
          |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
               |SI #dsarm027#17 = "S";
                    |CONSULTA_CLAVE #1#dsarcl01;
                    |SI FSalida = 0;
                         #dsarw076#6 = #dsarcl01#0;
                         |PINTA #dsarw076#6;
                         enCodHistoria = 0;
                    |FINSI;
               |FINSI;
               |SI #dsarm027#18 = "S";
                    |SI enCodHistoria ! 0;
                         |CONSULTA_F_CLAVE #1#dsarcl02, Inf02, Sup02;
                    |SINO;
                         |CONSULTA_CLAVE #1#dsarcl02;
                    |FINSI;
                    |SI FSalida = 0;
                         #dsarw076#6 = #dsarcl02#1;
                         |PINTA #dsarw076#6;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonSele5;
     |SI #dsarm001#194 = "S";
          |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
               |SI #dsarm027#17 = "S";
                    |CONSULTA_CLAVE #1#dsarcl01;
                    |SI FSalida = 0;
                         #dsarw076#7 = #dsarcl01#0;
                         |PINTA #dsarw076#7;
                         enCodHistoria = 0;
                    |FINSI;
               |FINSI;
               |SI #dsarm027#18 = "S";
                    |SI enCodHistoria ! 0;
                         |CONSULTA_F_CLAVE #1#dsarcl02, Inf02, Sup02;
                    |SINO;
                         |CONSULTA_CLAVE #1#dsarcl02;
                    |FINSI;
                    |SI FSalida = 0;
                         #dsarw076#7 = #dsarcl02#1;
                         |PINTA #dsarw076#7;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonSele6;
     |SI #dsarm001#194 = "S";
          |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
               |SI #dsarm027#17 = "S";
                    |CONSULTA_CLAVE #1#dsarcl01;
                    |SI FSalida = 0;
                         #dsarw076#8 = #dsarcl01#0;
                         |PINTA #dsarw076#8;
                         enCodHistoria = 0;
                    |FINSI;
               |FINSI;
               |SI #dsarm027#18 = "S";
                    |SI enCodHistoria ! 0;
                         |CONSULTA_F_CLAVE #1#dsarcl02, Inf02, Sup02;
                    |SINO;
                         |CONSULTA_CLAVE #1#dsarcl02;
                    |FINSI;
                    |SI FSalida = 0;
                         #dsarw076#8 = #dsarcl02#1;
                         |PINTA #dsarw076#8;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonSele7;
     |SI #dsarm001#194 = "S";
          |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
               |SI #dsarm027#17 = "S";
                    |CONSULTA_CLAVE #1#dsarcl01;
                    |SI FSalida = 0;
                         #dsarw076#9 = #dsarcl01#0;
                         |PINTA #dsarw076#9;
                         enCodHistoria = 0;
                    |FINSI;
               |FINSI;
               |SI #dsarm027#18 = "S";
                    |SI enCodHistoria ! 0;
                         |CONSULTA_F_CLAVE #1#dsarcl02, Inf02, Sup02;
                    |SINO;
                         |CONSULTA_CLAVE #1#dsarcl02;
                    |FINSI;
                    |SI FSalida = 0;
                         #dsarw076#9 = #dsarcl02#1;
                         |PINTA #dsarw076#9;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonSele8;
     |SI #dsarm001#194 = "S";
          |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
               |SI #dsarm027#17 = "S";
                    |CONSULTA_CLAVE #1#dsarcl01;
                    |SI FSalida = 0;
                         #dsarw076#10 = #dsarcl01#0;
                         |PINTA #dsarw076#10;
                         enCodHistoria = 0;
                    |FINSI;
               |FINSI;
               |SI #dsarm027#18 = "S";
                    |SI enCodHistoria ! 0;
                         |CONSULTA_F_CLAVE #1#dsarcl02, Inf02, Sup02;
                    |SINO;
                         |CONSULTA_CLAVE #1#dsarcl02;
                    |FINSI;
                    |SI FSalida = 0;
                         #dsarw076#10 = #dsarcl02#1;
                         |PINTA #dsarw076#10;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonSele9;
     |SI #dsarm001#194 = "S";
          |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
               |SI #dsarm027#17 = "S";
                    |CONSULTA_CLAVE #1#dsarcl01;
                    |SI FSalida = 0;
                         #dsarw076#11 = #dsarcl01#0;
                         |PINTA #dsarw076#11;
                         enCodHistoria = 0;
                    |FINSI;
               |FINSI;
               |SI #dsarm027#18 = "S";
                    |SI enCodHistoria ! 0;
                         |CONSULTA_F_CLAVE #1#dsarcl02, Inf02, Sup02;
                    |SINO;
                         |CONSULTA_CLAVE #1#dsarcl02;
                    |FINSI;
                    |SI FSalida = 0;
                         #dsarw076#11 = #dsarcl02#1;
                         |PINTA #dsarw076#11;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonSele10;
     |SI #dsarm001#194 = "S";
          |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
               |SI #dsarm027#17 = "S";
                    |CONSULTA_CLAVE #1#dsarcl01;
                    |SI FSalida = 0;
                         #dsarw076#12 = #dsarcl01#0;
                         |PINTA #dsarw076#12;
                         enCodHistoria = 0;
                    |FINSI;
               |FINSI;
               |SI #dsarm027#18 = "S";
                    |SI enCodHistoria ! 0;
                         |CONSULTA_F_CLAVE #1#dsarcl02, Inf02, Sup02;
                    |SINO;
                         |CONSULTA_CLAVE #1#dsarcl02;
                    |FINSI;
                    |SI FSalida = 0;
                         #dsarw076#12 = #dsarcl02#1;
                         |PINTA #dsarw076#12;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonSele11;
     |SI #dsarm001#194 = "S";
          |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
               |SI #dsarm027#17 = "S";
                    |CONSULTA_CLAVE #1#dsarcl01;
                    |SI FSalida = 0;
                         #dsarw076#13 = #dsarcl01#0;
                         |PINTA #dsarw076#13;
                         enCodHistoria = 0;
                    |FINSI;
               |FINSI;
               |SI #dsarm027#18 = "S";
                    |SI enCodHistoria ! 0;
                         |CONSULTA_F_CLAVE #1#dsarcl02, Inf02, Sup02;
                    |SINO;
                         |CONSULTA_CLAVE #1#dsarcl02;
                    |FINSI;
                    |SI FSalida = 0;
                         #dsarw076#13 = #dsarcl02#1;
                         |PINTA #dsarw076#13;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonSele12;
     |SI #dsarm001#194 = "S";
          |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
               |SI #dsarm027#17 = "S";
                    |CONSULTA_CLAVE #1#dsarcl01;
                    |SI FSalida = 0;
                         #dsarw076#14 = #dsarcl01#0;
                         |PINTA #dsarw076#14;
                         enCodHistoria = 0;
                    |FINSI;
               |FINSI;
               |SI #dsarm027#18 = "S";
                    |SI enCodHistoria ! 0;
                         |CONSULTA_F_CLAVE #1#dsarcl02, Inf02, Sup02;
                    |SINO;
                         |CONSULTA_CLAVE #1#dsarcl02;
                    |FINSI;
                    |SI FSalida = 0;
                         #dsarw076#14 = #dsarcl02#1;
                         |PINTA #dsarw076#14;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO PreguntaValores;
     |ABRE #dsarcl01;
     |ABRE #dsarcl02;

     |VENTANA 0501, 3099, -1, 16, "Valores B£squeda para Localizador";
     nVentm2 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm2;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#76;  nPanta76 = FSalida;
     |DDEFECTO #76;

     |SI #dsarm001#194 = "S";
          |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
               |CONTROL_SIMPLE nPanta76, "BOTON,Seleccionar", 1163, 1172, BotonSele1;
               nBotonSele1 = FSalida;

               |CONTROL_SIMPLE nPanta76, "BOTON,Seleccionar", 1263, 1272, BotonSele2;
               nBotonSele2 = FSalida;

               |CONTROL_SIMPLE nPanta76, "BOTON,Seleccionar", 1563, 1572, BotonSele3;
               nBotonSele3 = FSalida;

               |CONTROL_SIMPLE nPanta76, "BOTON,Seleccionar", 1663, 1672, BotonSele4;
               nBotonSele4 = FSalida;

               |CONTROL_SIMPLE nPanta76, "BOTON,Seleccionar", 1763, 1772, BotonSele5;
               nBotonSele5 = FSalida;

               |CONTROL_SIMPLE nPanta76, "BOTON,Seleccionar", 1863, 1872, BotonSele6;
               nBotonSele6 = FSalida;

               |CONTROL_SIMPLE nPanta76, "BOTON,Seleccionar", 1963, 1972, BotonSele7;
               nBotonSele7 = FSalida;

               |CONTROL_SIMPLE nPanta76, "BOTON,Seleccionar", 2063, 2072, BotonSele8;
               nBotonSele8 = FSalida;

               |CONTROL_SIMPLE nPanta76, "BOTON,Seleccionar", 2163, 2172, BotonSele9;
               nBotonSele9 = FSalida;

               |CONTROL_SIMPLE nPanta76, "BOTON,Seleccionar", 2263, 2272, BotonSele10;
               nBotonSele10 = FSalida;

               |CONTROL_SIMPLE nPanta76, "BOTON,Seleccionar", 2363, 2372, BotonSele11;
               nBotonSele11 = FSalida;

               |CONTROL_SIMPLE nPanta76, "BOTON,Seleccionar", 2463, 2472, BotonSele12;
               nBotonSele12 = FSalida;
          |FINSI;
     |FINSI;

     |C_M #76#1, 1, "N";
     #76#1 = aLoca;
     #76#2 = #dsarm027#2;
     #76#15 = aSwLocaNif;
     |PINTA #76#1;
     |PINTA #76#2;
     |PINTA #76#15;

     |HAZ Tipo0C2w076;
     |PINDA #0#76;
     |ENDATOS #1#76;
     |SI FSalida = 0;
          |PARA nCampoD = 1;  |SI nCampoD [ 18;  |HACIENDO nCampoD = nCampoD + 1;
               #75nCampoD = #76nCampoD;
          |SIGUE;
          |GRABA 020#dsarw075.n;
          |LIBERA #dsarw075;
     |SINO;
          nSwCancelar = 1;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm2;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentm2;
     |CIERRA #dsarcl01;
     |CIERRA #dsarcl02;
|FPRC;

|PROCESO dsarm025_Preg;
/*
     |SI eaHistoriaBusca ! "";
          aMensaje = "0000Ya tengo la Historia " + eaHistoriaBusca + " y Episodio " + eaEpisodioBusca;
          |MENAV aMensaje;
     |FINSI;
*/

     |PARA nCampo = 52; |SI nCampo [ 83; |HACIENDO nCampo = nCampo + 1;
          |SI nCampo ! 78; |Y nCampo ! 79; |Y nCampo ! 80;
               aLoca = #dsarm025#nCampo#;
               |QBF aLoca;
               |SI aLoca ! "";
                    |DDEFECTO #dsarm027;
                    #dsarm027#0 = #dsarm024#0;
                    #dsarm027#1 = aLoca;
                    |LEE 000#dsarm027.=;
                    |SI FSalida = 0;
                         |SI #dsarm001#194 = "S";      ||CONEXION CLINICA
                              |SI #dsarm027#17 = "S"; |O #dsarm027#18 = "S";
                                   |SI eaHistoriaBusca ! "";
                                        |SI nConsulta = 0;
                                             ||ARA38
                                             |DDEFECTO #75;
                                             #75#1 = aLoca;
                                             |LEE 101#75.=;
                                             |SI FSalida ! 0;
                                                  #75#2 = "R";
                                                  |SI #dsarm027#17 = "S";
                                                       #75#3 = eaHistoriaBusca;
                                                       #75#4 = eaHistoriaBusca;
                                                  |SINO;
                                                       #75#3 = eaEpisodioBusca;
                                                       #75#4 = eaEpisodioBusca;
                                                  |FINSI;
                                                  #75#16 = "N";
                                                  |GRABA 020#75.n;
                                             |FINSI;
                                             |LIBERA #75;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |FINSI;

                         |SI #dsarm027#16 = "S";
                              aSwLocaNif = #dsarm027#15;
                              |SI nConsulta = 1;
                                   nSwPregLocaliGlobal = 1;
                                   |ERROR10;
                              |SINO;
                                   |SI nSwCancelar = 1;
                                        |ERROR10;
                                        |ACABA;
                                   |FINSI;
                                   ||Miro si ya esta este localizador en el temporal
                                   ||sino pregunto los datos y lo meto.
                                   |DDEFECTO #75;
                                   #75#1 = aLoca;
                                   |LEE 000#75.=;
                                   |SI FSalida ! 0;
                                        |HAZ PreguntaValores;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE dsarm025_Preg;
 #dsarm025#1;
 ;
 #dsarm024#0, 001, 001, 001;
 #dsarm024#0, 999, 999, 999;
 ;
 NULL, dsarm025_Preg;
|FIN;

|PROCESO PreguntarLocali;
     |ABRE #dsarm027;
     |BUCLE dsarm025_Preg;
     |CIERRA #dsarm027;
|FPRC;

|PROCESO Boton5;
     |LEE 000#dsarm024.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nPreparacion = #dsarm024#0;

     aCarpetaDestino = #dsarm024#2;
     |QBF aCarpetaDestino;
     |SI aCarpetaDestino = "";
          aMensaje = "0000Carpeta Destino Vacia. Proceso Cancelado";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;

     |DBASE aBase;
     |QBF aBase;

     aDef = aBase + "/def/dsarm005";
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
          aMensaje = "0000Problemas CARGADEF" + aDef;
          |MENAV aMensaje;
          |ERROR;
          |ACABA;
     |FINSI;

     ||aFichero = ("d8" + Usuario + "zzzzzzzz") % 108;
     aFichero = ("01" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #905 aFichero;
     |DELINDEX #905;

     |CONTROL_SIMPLE 0, "LABEL,{{5}}Realizando Proceso ... ", 1315, 1680, NULL;
     nBotonLabel = FSalida;

     |PTEC 802;  |PAUSA;

     nSwCancelar = 0;
     nConsulta = 1;           ||Para averiguar si debe preguntar o no algun localizador
     nSwPregLocaliGlobal = 0;
     |HAZ PreguntarLocali;
     |SI nSwPregLocaliGlobal = 1;
          aFichero = ("d9" + Usuario + "zzzzzzzz") % 108;
          |NOME_DAT #75 aFichero;
          |DELINDEX #75;

          |ABRE #75;
          nConsulta = 0;
          |HAZ PreguntarLocali;

          |SI nSwCancelar = 1;
               |FIN_CONTROL_WINDOWS nBotonLabel;

               aMensaje = "0000Proceso cancelado";
               |MENAV aMensaje;

               |CIERRA #75;
               |DELINDEX #75;
               |ACABA;
          |FINSI;
     |FINSI;

     |ABRE #dsarm005;
     |ABRE #referen@;

     nSeleccionados = 0;
     |BUCLE dsarm025;

     |SI nSeleccionados = 0;
          aMensaje = "0000Ningun registro cumple los criterios de b£squeda";
          |MENAV aMensaje;
     |SINO;
          |SI aModoColeccion = "P";

               |SI nSeleccionados = 1;
                    aMensaje = "0000NSeleccionado 1 registro. Copiar a la carpeta ["  + aCarpetaDestino + "] ?";
               |SINO;
                    aMensaje = "0000NSeleccionados " + nSeleccionados + " registros. Copiar a la carpeta ["  + aCarpetaDestino + "] ?";
               |FINSI;
               |CONFI aMensaje;
               |SI FSalida = 0;
                    aPathDestino = aCarpetaDestino;
                    |QBF aPathDestino;
                    aLetra = aPathDestino % -101;
                    |SI aLetra ! "\";
                         aPathDestino = aPathDestino + "\";
                    |FINSI;
                    |RMKDIR aPathDestino;

                    |BUCLE CopiaFicheros;
               |FINSI;
          |SINO;
               enSwColeccionGrid = 1;
               ||CONSULTA_CLAVE #1#referen@;
          |FINSI;
     |FINSI;

     |CIERRA #referen@;

     |SI enSwColeccionGrid ! 1;
          |DELINDEX #referen@;
     |FINSI;

     |CIERRA #dsarm005;
     |DESCARGA_DEF #referen@;

     |FIN_CONTROL_WINDOWS nBotonLabel;

     |SI nSwPregLocaliGlobal = 1;
          |CIERRA #75;
          |DELINDEX #75;
     |FINSI;
|FPRC;

|PROCESO BotonCondiciones;
     aQueBoton     = "|X000";
     aID           = #dsarw051#aQueBoton#;
     nBotonAceptar = aID;
     |ESTADO_CONTROL nBotonAceptar, "HIDE";

     aQueBoton      = "|X001";
     aID            = #dsarw051#aQueBoton#;
     nBotonCancelar = aID;
     |ESTADO_CONTROL nBotonCancelar, "HIDE";

     enNumRegla = #dsarw051#0;

     aEjecuta = "dsarz029";
     |SUB_EJECUTA_NP aEjecuta;

     |ESTADO_CONTROL nBotonAceptar, "SHOW";
     |ESTADO_CONTROL nBotonCancelar, "SHOW";
|FPRC;

|PROCESO ModiAlta;
     nIdSalir = 0;
     |HAZ ObtenIdSalir;
     |ESTADO_CONTROL nIdSalir, "HIDE";

     |VENTANA 0501, 2999, -1, -1, "";
     nVentana = FSalida;

     aCadena ="|NC";
     aAlfa = #24#aCadena#;
     nCampoHasta = aAlfa;
     nCampoHasta = nCampoHasta - 1;

     |SI nModo ! 1;
          |PARA nCampoD = 0;  |SI nCampoD [ nCampoHasta; |HACIENDO nCampoD = nCampoD + 1;
                nCampoH = nCampoD;
                #51nCampoH = #24nCampoD;
          |SIGUE;

          |C_M #51#0, 1, "N";
     |SINO;
          |C_M #51#0, 1, "S";
          nUltimo = 0;
          |HAZ DameUltimo;
          |DDEFECTO #51;
          nUltimo = nUltimo + 1;
          #51#0 = nUltimo;
     |FINSI;

     |PINPA #0#51; nPantaDos = FSalida;
     |PINDA #0#51;

     |SI nModo = 1;  |ENDATOS #1#51;  |FINSI;
     |SI nModo = 2;  |ENDATOS #2#51;  |FINSI;

     |SI FSalida = 0;
          |HAZ GrabaDatos;
     |FINSI;

     |FINVENTANA nVentana;

     |ESTADO_CONTROL nIdSalir, "SHOW";
|FPRC;

|PROCESO DameUltimo;
     |LEE 000#dsarm024.u;
     |SI FSalida = 0;
          nUltimo = #dsarm024#0;
     |SINO;
          nUltimo = 0;
     |FINSI;
|FPRC;

|PROCESO dsarm002_carpeta;
     aAux = #dsarm002#2;
     |QBT aAux;
     |SI aAux = aBuscoCarpeta;
          nSwGrupo = #dsarm002#0;
          nSwEstaCarpeta = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm002_carpeta;
 #dsarm002#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, dsarm002_carpeta;
|FIN;

|PROCESO dsarm024_carpeta;
     |SI nEstoy ! #dsarm024#0;
          aAux = #dsarm024#2;
          |QBT aAux;
          |SI aAux = aBuscoCarpeta;
               nSwNumPre = #dsarm024#0;
               nSwEstaCarpeta = 1;
               |ERROR10;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm024_carpeta;
 #dsarm024#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, dsarm024_carpeta;
|FIN;

|PROCESO MiraSiEstaCarpeta;
     ||Primero busco en los grupos y luego en el propio fichero
     ||Ahora solo busco en el propio fichero.
     ||Son carpetas de la maquina local.
     ||BUCLE dsarm002_carpeta;
     |SI nSwEstaCarpeta = 0;
          |BUCLE dsarm024_carpeta;
     |FINSI;
|FPRC;

|PROCESO Tipo0C4w052; |TIPO 0;
     |SI FSalida = 10;
          aDirectorio = "";
          |HAZ Browse;
          |SI aDirectorio ! "";
               #dsarw052#4 = aDirectorio;
               |PINTA #dsarw052#4;
               |ERROR;
          |FINSI;
     |FINSI;

     aCarpeta = #dsarw052#4;
     |QBT aCarpeta;
     |SI aCarpeta = "";
          aMensaje = "0000Atenci¢n: Carpeta vacia";
          |MENAV aMensaje;
          |ERROR;
     |SINO;
          #dsarw052#4 = aCarpeta;
          |PINTA #dsarw052#4;

          aBuscoCarpeta = aCarpeta;
          nSwEstaCarpeta = 0;
          nEstoy = #dsarw052#2;
          nSwGrupo = -1;
          nSwNumPre = -1;
          |HAZ MiraSiEstaCarpeta;

          |SI nSwEstaCarpeta = 1;
               |SI nSwGrupo ! -1;
                    aMensaje = "0000Carpeta Ubicaci¢n [ " + aBuscoCarpeta + "] ya utilizada en Grupo [" + nSwGrupo + "]";
               |SINO;
                    aMensaje = "0000Carpeta Ubicaci¢n [ " + aBuscoCarpeta + "] ya utilizada en Num.Preparacion [" + nSwNumPre + "]";
               |FINSI;
               |MENAV aMensaje;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Browse;
     |HAZ LeeUnidadBasico;

     aPath = "D" + eaUnidadBasico + "\";
     |BROWSE aPath;
     aPath = (aPath % 270);
     |QBF aPath;
     |SI aPath ! "";
          aDirectorio = aPath + "\";
     |FINSI;
|FPRC;

|PROCESO Tipo0C4w051; |TIPO 0;
     |SI FSalida = 10;
          aDirectorio = "";
          |HAZ Browse;
          |SI aDirectorio ! "";
               #dsarw051#2 = aDirectorio;
               |PINTA #dsarw051#2;
               |ERROR;
          |FINSI;
     |FINSI;

     aCarpeta = #dsarw051#2;
     |QBT aCarpeta;
     |SI aCarpeta = "";
          aMensaje = "0000Atenci¢n: Carpeta vacia";
          |MENAV aMensaje;
          |ERROR;
     |SINO;
          #dsarw051#2 = aCarpeta;
          |PINTA #dsarw051#2;

          aBuscoCarpeta = aCarpeta;
          nSwEstaCarpeta = 0;
          nEstoy = #dsarw051#0;
          nSwGrupo = -1;
          nSwNumPre = -1;
          |HAZ MiraSiEstaCarpeta;

          |SI nSwEstaCarpeta = 1;
               |SI nSwGrupo ! -1;
                    aMensaje = "0000Carpeta Ubicaci¢n [ " + aBuscoCarpeta + "] ya utilizada en Grupo [" + nSwGrupo + "]";
               |SINO;
                    aMensaje = "0000Carpeta Ubicaci¢n [ " + aBuscoCarpeta + "] ya utilizada en Num.Preparacion [" + nSwNumPre + "]";
               |FINSI;
               |MENAV aMensaje;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO GrabaDatos;
     #24#0 = #51#0;
     |LEE 101#24=;
     |SI FSalida ! 0;
         |DDEFECTO #24;
         #24#0 = #51#0;
         |GRABA 020#24b;
     |FINSI;

     |PARA nCampoD = 1;  |SI nCampoD [ nCampoHasta;  |HACIENDO nCampoD = nCampoD + 1;
           nCampoH   = nCampoD;
           #24nCampoD = #51nCampoH;
     |SIGUE;

     |GRABA 020#24a;
     |LIBERA #24;
|FPRC;

|PROGRAMA;
     aParametro = PARAMETRO;
     |QBF aParametro;

     |SI aParametro = "APLICARCOLECCION";
          |VENTANA 1201, 2199, -1, 16, "Aplicar Colecci¢n";
          nVentm23 = FSalida;

          aVent1 = -1;
          aVent2 = -1;
          aVent3 = 0;
          aVent4 = nVentm23;
          aVent5 = "MODAL";
          |ESPECIFICA "ESTADO_VENTANA", aVent;

          |CLS;
          |CABEZA "Aplicar Colecci¢n";
          |ABRE #dsarm001;
          |DDEFECTO #dsarm001;
          |LEE 000#dsarm001.p;
          |CIERRA #dsarm001;

          aIPRemoto = "";
          |IP_REMOTO aIPRemoto;
          |QBT aIPRemoto;

          aBlanco50 = (" " * 50);

          |ABRET #dsarm024;
          |ABRET #dsarm025;
          |ABRET #dsarm027;

          ||Pregunto si Vista Grid o Generar paquete y Numero de Coleccion.
          |PINPA #0#dsarw080;

          #dsarm024#0 = 1;
          |LEE 000#dsarm024.=;
          |SI FSalida = 0;
               #dsarw080#2 = #dsarm024#1;
               #dsarw080#3 = #dsarm024#2;
          |FINSI;

          |PINDA #0#dsarw080;
          |ENDATOS #1#dsarw080;
          nSalida = FSalida;

          aVent1 = -1;
          aVent2 = -1;
          aVent3 = 0;
          aVent4 = nVentm23;
          aVent5 = "MODELESS";
          |ESPECIFICA "ESTADO_VENTANA", aVent;

          |FINVENTANA nVentm23;

          |SI nSalida ! 0;
               |CIERRAT #dsarm024;
               |CIERRAT #dsarm025;
               |CIERRAT #dsarm027;
          |SINO;
               ||ARA
               aModoColeccion = #dsarw080#0;
               nColeccion = #dsarw080#1;

               #dsarm024#0 = nColeccion;
               |HAZ Boton5;

               |CIERRAT #dsarm024;
               |CIERRAT #dsarm025;
               |CIERRAT #dsarm027;
          |FINSI;
     |SINO;
          ||POR DEFECTO, SE CREA LOS PAQUETES.
          aModoColeccion = "P";

          |CLS;
          |CABEZA "Preparaci¢n Documentaci¢n";

          |ABRE #dsarm001;
          |DDEFECTO #dsarm001;
          |LEE 000#dsarm001.p;
          |CIERRA #dsarm001;

          aIPRemoto = "";
          |IP_REMOTO aIPRemoto;
          |QBT aIPRemoto;

          aBlanco50 = (" " * 50);

          |ABRET #dsarm024;
          |ABRET #dsarm025;
          |ABRET #dsarm027;

          |PINPA #0#dsarm023;
          nPanta = FSalida;

          |CONTROL_SIMPLE nPanta, "BOTON,{{193}}Alta ", 2753, 2763, Boton1;
          nBoton1 = FSalida;

          |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Modificar ", 2765, 2775, Boton2;
          nBoton2 = FSalida;

          |CONTROL_SIMPLE nPanta, "BOTON,{{199}}Baja ", 2777, 2787, Boton3;
          nBoton3 = FSalida;

          |CONTROL_SIMPLE nPanta, "BOTON,[+]   Copiar ", 2703, 2713, Boton4;
          nBoton4 = FSalida;

          |CONTROL_SIMPLE nPanta, "BOTON,Prepara Archivos", 2903, 2923, Boton5;
          nBoton5 = FSalida;


          nRango = 4 + 8 + 16 + 32;
          nPos1  = 0702;
          nPos2  = 2698;

          |LINEAL_SIMPLE #1#dsarm024, nRango, nPos1, nPos2, BajaPanta, AltaPanta, EventoPanta;
          nGrid = FSalida;

          aEsc1  = &255 + "806";
          aEsc2  = &255 + "807";
          aRetu  = &255 + "802";
          |PARA; |SI;  |HACIENDO;
              FSalida = "::{{001}}Salir," + nGrid;
              |LEETECLA aTecla;
              |SI aTecla = aEsc1; |SAL;  |FINSI;
              |SI aTecla = aEsc2; |SAL;  |FINSI;
              |SI aTecla = aRetu; |SAL;  |FINSI;
          |SIGUE;

          |FIN_CONTROL_WINDOWS nGrid;

          |DESTRUYECONTROL nBoton1;
          |DESTRUYECONTROL nBoton2;
          |DESTRUYECONTROL nBoton3;
          |DESTRUYECONTROL nBoton4;

          |CIERRAT #dsarm024;
          |CIERRAT #dsarm025;
          |CIERRAT #dsarm027;
     |FINSI;
|FPRO;
