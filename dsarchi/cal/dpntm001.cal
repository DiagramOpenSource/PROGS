|FICHEROS;
     dpntm001;
     dpntm002;
     dpntm005;

     dsarm001;
     dsarm002;
     dsarm003;
     dsarm004;
     dsarm005;
     dsarz010;

     dpntw001;
     dpntw002;
     dpntw003;
     dpntw004;
|FIN;

|VARIABLES;
     fFecha = @;
     aFecha = "";
     aHora = "";
     aOpcion = "";

     nVentana       = 0;
     nVent          = 0;
     n1Vent         = 0;
     n2Vent         = 0;
     nBtnHab        = -1;
     nBtnDes        = -1;
     nBtnRes        = -1;
     nBtnEst        = -1;
     nBtnAcc        = -1;
     nGrid          = -1;
     nGrid802       = 0;
     nGrid902       = 0;
     nGrid903       = 0;
     nGrid904       = 0;
     nPanta         = 0;
     nTreeUti       = 0;

     nRango         = 0;
     nGrupo         = 0;
     nSubGrupo      = 0;
     nTipo          = 0;
     nDSubGrupo     = 0;
     nHSubGrupo     = 0;
     nDTipo         = 0;
     nHTipo         = 0;
     nDesde         = 0;
     nHasta         = 0;
     nCmp           = 0;
     nHandle        = 0;
     nOpcion        = 0;
     nOk            = 0;

     aEsc1          = "";
     aEsc2          = "";
     aRetu          = "";
     aTecla         = "";
     aBase          = "";
     aMas           = "";
     aAlfa          = "";
     aFichero       = "";
     aAbre          = "";
     aPathLocal     = "";
     aContenido     = "";

     {-1}sTree      = 0;
         sT_nID     = 0;
         sT_nOper   = 0;
         sT_aData   = "";

     {-1}aVent      = "";
         aVent1     = 0;
         aVent2     = 0;
         aVent3     = 0;
         aVent4     = 0;
         aVent5     = "";

     &enCargaPerfiles = 0;
     &enGrid          = 0;
     &enCalDESPANET   = 0;
     &enEmpresa       = 0;
     &eaModoNet       = "";
     &eaUsuNet        = "";
     &eaFechaNet      = "";
     &eaAccesoNet     = "";
     &eaEmpNet        = "";
     &eaTraNet        = "";
     &eaAccNet        = "";
     &eaMaiNet        = "";
     &eaDesNet        = "";
     &eaLabNet        = "";
     &eaUnidadBasico  = "";
     &eaAcceso        = "";
|FIN;

|PROCESO dsarm004;
     #dpntm002#0 = #dpntm001#0;
     #dpntm002#1 = #dsarm004#0;
     #dpntm002#2 = #dsarm004#1;
     #dpntm002#3 = #dsarm004#2;
     |LEE 000#dpntm002.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #dsarm002#0 = #dsarm004#0;
     |LEE 000#dsarm002.=;
     |SI FSalida ! 0;  |DDEFECTO #dsarm002;  |FINSI;

     #dsarm003#0 = #dsarm004#0;
     #dsarm003#1 = #dsarm004#1;
     |LEE 000#dsarm003.=;
     |SI FSalida ! 0;  |DDEFECTO #dsarm003;  |FINSI;

     #dpntw002#0 = #dsarm004#0;
     |LEE 101#dpntw002.=;
     |SI FSalida ! 0;
         #dpntw002#0 = #dsarm004#0;
         #dpntw002#1 = #dsarm002#1;
         |GRABA 020#dpntw002.n;
     |FINSI;
     |LIBERA #dpntw002;

     #dpntw003#0 = #dsarm004#0;
     #dpntw003#1 = #dsarm004#1;
     |LEE 101#dpntw003.=;
     |SI FSalida ! 0;
         #dpntw003#0 = #dsarm004#0;
         #dpntw003#1 = #dsarm004#1;
         #dpntw003#2 = #dsarm003#2;
         |GRABA 020#dpntw003.n;
     |FINSI;
     |LIBERA #dpntw003;

     #dpntw004#0 = #dsarm004#0;
     #dpntw004#1 = #dsarm004#1;
     #dpntw004#2 = #dsarm004#2;
     |LEE 101#dpntw004.=;
     |SI FSalida ! 0;
         #dpntw004#0 = #dsarm004#0;
         #dpntw004#1 = #dsarm004#1;
         #dpntw004#2 = #dsarm004#2;
         #dpntw004#3 = #dsarm004#3;
         |GRABA 020#dpntw004.n;
     |FINSI;
     |LIBERA #dpntw004;
|FPRC;

|DEFBUCLE dsarm004;
     #dsarm004#2;
     ;
     "S", 000, nDSubGrupo, nDTipo;
     "S", 999, nHSubGrupo, nHTipo;
     ;
     NULL, dsarm004;
|FIN;

|PROCESO ReconstruyeGrids;
     aFichero = "dpntw002" + Usuario;  |NOME_DAT #dpntw002#aFichero#;
     aFichero = "dpntw003" + Usuario;  |NOME_DAT #dpntw003#aFichero#;
     aFichero = "dpntw004" + Usuario;  |NOME_DAT #dpntw004#aFichero#;

     |ABRE #dpntw002;  |CIERRA #dpntw002;  |DELINDEX #dpntw002;
     |ABRE #dpntw003;  |CIERRA #dpntw003;  |DELINDEX #dpntw003;
     |ABRE #dpntw004;  |CIERRA #dpntw004;  |DELINDEX #dpntw004;

     |ABRE #dpntw002;
     |ABRE #dpntw003;
     |ABRE #dpntw004;

     |BUCLE dsarm004;

     #dpntw002#0 = nGrupo;
     |LEE 000#dpntw002.];
     |SI FSalida ! 0;
         |LEE 000#dpntw002.p;
         nSubGrupo = 1;
         nTipo     = 1;
     |FINSI;

     #dpntw003#0 = #dpntw002#0;
     #dpntw003#1 = nSubGrupo;
     |LEE 000#dpntw003.];
     |SI FSalida ! 0;
         #dpntw003#0 = #dpntw002#0;
         #dpntw003#1 = 1;
         |LEE 000#dpntw003.];
         nTipo     = 1;
     |FINSI;

     #dpntw004#0 = #dpntw003#0;
     #dpntw004#1 = #dpntw003#1;
     #dpntw004#2 = nTipo;
     |LEE 000#dpntw004.];
     |SI FSalida ! 0;  |DDEFECTO #dpntw004;  |FINSI;
|FPRC;

|PROCESO Evento802;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dpntm002.=;
     |FINSI;

     |SI FSalida = 4;
         |LEE 101#dpntm002.=;
         |SI FSalida = 0;
             |BORRA 020#dpntm002.a;
             |LIBERA #dpntm002;

             enCalDESPANET   = 1;

             |CIERRA  #dpntw002;
             |CIERRA  #dpntw003;
             |CIERRA  #dpntw004;

             nGrupo    = #dpntm002#1;
             nSubGrupo = #dpntm002#2;
             nTipo     = #dpntm002#3;

             |HAZ ReconstruyeGrids;

             #dpntm002#0 = #dpntm001#0;
             #dpntm002#1 = nGrupo;
             #dpntm002#2 = nSubGrupo;
             #dpntm002#3 = nTipo;
             |LEE 000#dpntm002.];
             |SI FSalida ! 0;
                 |LEE 000#dpntm002.u;
             |FINSI;

             |REFRESCACONTROL nGrid902;
             |REFRESCACONTROL nGrid903;
             |REFRESCACONTROL nGrid904;
             |REFRESCACONTROL nGrid802;
             |FOCOTECLADO nGrid802;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO dpntw004;
     #dpntm002#0 = #dpntm001#0;
     #dpntm002#1 = #dpntw004#0;
     #dpntm002#2 = #dpntw004#1;
     #dpntm002#3 = #dpntw004#2;
     #dpntm002#4 = #dpntw004#3;
     |GRABA 020#dpntm002.n;
     |LIBERA #dpntm002;

     enCalDESPANET = 1;
|FPRC;

|DEFBUCLE dpntw004;
     #dpntw004#1;
     ;
     #dpntw002#0, nDesde, 000;
     #dpntw002#0, nHasta, 999;
     ;
     NULL, dpntw004;
|FIN;

|PROCESO Evento902;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dpntw002.=;
         |SI FSalida = 0;
             #dpntw003#0 = #dpntw002#0;
             #dpntw003#1 = 1;
             |LEE 000#dpntw003.];

             |REFRESCACONTROL nGrid903;
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
         nDesde = 000;
         nHasta = 999;
         |BUCLE dpntw004;

         |CIERRA  #dpntw002;
         |CIERRA  #dpntw003;
         |CIERRA  #dpntw004;

         nGrupo    = 1;
         nSubGrupo = 1;
         nTipo     = 1;

         |HAZ ReconstruyeGrids;

         |REFRESCACONTROL nGrid902;
         |REFRESCACONTROL nGrid903;
         |REFRESCACONTROL nGrid904;
         |REFRESCACONTROL nGrid802;
     |FINSI;
|FPRC;

|PROCESO Evento903;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dpntw003.=;
         |SI FSalida = 0;
             #dpntw004#0 = #dpntw003#0;
             #dpntw004#1 = #dpntw003#1;
             #dpntw004#2 = 1;
             |LEE 000#dpntw004.];

             |REFRESCACONTROL nGrid904;
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
         nDesde = #dpntw003#1;
         nHasta = #dpntw003#1;
         |BUCLE dpntw004;

         |CIERRA  #dpntw002;
         |CIERRA  #dpntw003;
         |CIERRA  #dpntw004;

         nGrupo    = #dpntw003#0;
         nSubGrupo = 1;
         nTipo     = 1;

         |HAZ ReconstruyeGrids;

         |REFRESCACONTROL nGrid902;
         |REFRESCACONTROL nGrid903;
         |REFRESCACONTROL nGrid904;
         |REFRESCACONTROL nGrid802;
     |FINSI;
|FPRC;

|PROCESO Evento904;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dpntw004.=;
     |FINSI;

     |SI FSalida = 4;
         #dpntm002#0 = #dpntm001#0;
         #dpntm002#1 = #dpntw004#0;
         #dpntm002#2 = #dpntw004#1;
         #dpntm002#3 = #dpntw004#2;
         #dpntm002#4 = #dpntw004#3;
         |GRABA 020#dpntm002.n;
         |LIBERA #dpntm002;

         enCalDESPANET = 1;

         |CIERRA  #dpntw002;
         |CIERRA  #dpntw003;
         |CIERRA  #dpntw004;

         nGrupo    = #dpntw004#0;
         nSubGrupo = #dpntw004#1;
         nTipo     = #dpntw004#2;

         |HAZ ReconstruyeGrids;

         |REFRESCACONTROL nGrid902;
         |REFRESCACONTROL nGrid903;
         |REFRESCACONTROL nGrid904;
         |REFRESCACONTROL nGrid802;
     |FINSI;
|FPRC;

|PROCESO Baja802;
     #dpntm002#0 = #dpntm001#0;
     #dpntm002#1 = 001;
     #dpntm002#2 = nDSubGrupo;
     #dpntm002#3 = nDTipo;
|FPRC;

|PROCESO Alta802;
     #dpntm002#0 = #dpntm001#0;
     #dpntm002#1 = 999;
     #dpntm002#2 = nHSubGrupo;
     #dpntm002#3 = nHTipo;
|FPRC;

|PROCESO Baja903;
     #dpntw003#0 = #dpntw002#0;
     #dpntw003#1 = nDSubGrupo;
|FPRC;

|PROCESO Alta903;
     #dpntw003#0 = #dpntw002#0;
     #dpntw003#1 = nHSubGrupo;
|FPRC;

|PROCESO Baja904;
     #dpntw004#0 = #dpntw003#0;
     #dpntw004#1 = #dpntw003#1;
     #dpntw004#2 = nDTipo;
|FPRC;

|PROCESO Alta904;
     #dpntw004#0 = #dpntw003#0;
     #dpntw004#1 = #dpntw003#1;
     #dpntw004#2 = nHTipo;
|FPRC;

|PROCESO Completo;
     nDSubGrupo  = 000;
     nHSubGrupo  = 999;
     nDTipo      = 000;
     nHTipo      = 999;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}Carpetas restringidas", 0555, 0699, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{15}}Grupos", 0502, 0545, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{15}}Subgrupos", 1402, 1445, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{15}}Tipos", 2302, 2345, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{2}}Doble click en los registros para moverlos", 3302, 3380, NULL;

     |HAZ ReconstruyeGrids;

     nRango = 4 + 8 + 16 + 32;

     |LINEAL_SIMPLE #1#dpntm002, nRango, 0652, 3298, Baja802, Alta802, Evento802;
     nGrid802 = FSalida;

     |LEE 000#dpntw002.p;
     |LEE 000#dpntw003.p;
     |LEE 000#dpntw004.p;

     |LINEAL_SIMPLE #1#dpntw002, nRango, 0602, 1350, NULL, NULL, Evento902;
     nGrid902 = FSalida;

     |LINEAL_SIMPLE #1#dpntw003, nRango, 1502, 2250, Baja903, Alta903, Evento903;
     nGrid903 = FSalida;

     |LINEAL_SIMPLE #1#dpntw004, nRango, 2402, 3250, Baja904, Alta904, Evento904;
     nGrid904 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          |PULSATECLA;
          FSalida = "::{{001}}Salir," + nGrid902;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |CIERRA #dpntw002;
     |CIERRA #dpntw003;
     |CIERRA #dpntw004;

     |DELINDEX #dpntw002;
     |DELINDEX #dpntw003;
     |DELINDEX #dpntw004;
|FPRC;

|PROCESO SoloGrupos;
     nDSubGrupo  = 001;
     nHSubGrupo  = 001;
     nDTipo      = 001;
     nHTipo      = 001;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}Carpetas restringidas", 0555, 0699, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{15}}Grupos", 0502, 0545, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{2}}Doble click en los registros para moverlos", 3302, 3380, NULL;

     |HAZ ReconstruyeGrids;

     nRango = 4 + 8 + 16 + 32;

     |LINEAL_SIMPLE #1#dpntm002, nRango, 0652, 3298, Baja802, Alta802, Evento802;
     nGrid802 = FSalida;

     |LEE 000#dpntw002.p;

     |LINEAL_SIMPLE #1#dpntw002, nRango, 0602, 3250, NULL, NULL, Evento902;
     nGrid902 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          |PULSATECLA;
          FSalida = "::{{001}}Salir," + nGrid902;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |CIERRA #dpntw002;
     |CIERRA #dpntw003;
     |CIERRA #dpntw004;

     |DELINDEX #dpntw002;
     |DELINDEX #dpntw003;
     |DELINDEX #dpntw004;
|FPRC;

|PROCESO Restringir;
     aAlfa = "Restringir carpetas al usuario: " + #dpntm001#2;  |QBF aAlfa;
     |VENTANA 0501, 3399, -1, 16, aAlfa;
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SI #dsarm001#8 = "S";
         |HAZ Completo;
     |SINO;
         |HAZ SoloGrupos;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;
|FPRC;

|PROCESO Estructura;
     aAlfa = "Estructura documental personalizada: " + #dpntm001#2;  |QBF aAlfa;
     |VENTANA 0501, 2899, -1, 16, aAlfa;
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enEmpresa = #dpntm001#0;
     |SUB_EJECUTA "dpntm003";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |FOCOTECLADO enGrid;
|FPRC;

|PROCESO AccesosEmpresas;
     aAlfa = "Accesos a la empresa " + eaAcceso + " " + #dpntm001#2;  |QBF aAlfa;
     |VENTANA 0501, 2899, -1, 16, aAlfa;
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enEmpresa = #dpntm001#0;
     |SUB_EJECUTA "dpntm005";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;
|FPRC;

|PROCESO AccesosCentros;
     aAlfa = "Accesos Centros de Trabajo de la empresa " + eaAcceso + " " + #dpntm001#2;  |QBF aAlfa;
     |VENTANA 0501, 2899, -1, 16, aAlfa;
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enEmpresa = #dpntm001#0;
     |SUB_EJECUTA "dpntm007";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;
|FPRC;

|PROCESO AccesosTrabajadores;
     aAlfa = "Habilitar / Deshabilitar " + eaAcceso + " Trabajadores Empresa: " + #dpntm001#2;  |QBF aAlfa;
     |VENTANA 0501, 2899, -1, 16, aAlfa;
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enEmpresa = #dpntm001#0;
     |SUB_EJECUTA "dpntm004";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;
|FPRC;

|PROCESO CargaArbol;
     aOpcion = aOpcion + &13 + &10;
     |XGRABA nHandle, aOpcion;
|FPRC;

|PROCESO EvntTree;
     aContenido = Contenido;

     |SI FEntrada = 0;
         |ACABA;
     |FINSI;

     |SI aContenido = "1";  |HAZ AccesosEmpresas;      |FINSI;
     |SI aContenido = "2";  |HAZ AccesosCentros;       |FINSI;
     |SI aContenido = "3";  |HAZ AccesosTrabajadores;  |FINSI;

     |FOCOTECLADO nTreeUti;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
|FPRC;

|PROCESO Accesos;
     aAlfa = "Accesos de la empresa " + (("00000" + #dpntm001#0) % -105);
     aAlfa = aAlfa + " " + #dpntm001#1;  |QBF aAlfa;
     |VENTANA 0501, 1550, -1, 16, "Accesos";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     sT_nID   = nTreeUti;
     sT_nOper = 0;

     aAbre = aPathLocal + "tree" + Usuario + ".txt";
     |XABRE "WBC", aAbre, nHandle;

     nOpcion = 0;

     nOpcion  = nOpcion + 1;
     aOpcion  = nOpcion + ":Accesos de la empresa {{1}}";
     |HAZ CargaArbol;

     |SI eaAcceso = "PIBOX";
         nOpcion  = nOpcion + 1;
         aOpcion  = nOpcion + ":Accesos de los centros de trabajo {{2}}";
         |HAZ CargaArbol;
     |FINSI;

     nOpcion  = nOpcion + 1;
     aOpcion  = nOpcion + ":Habilitar / Deshabilitar trabajadores {{3}}";
     |HAZ CargaArbol;

     |XCIERRA nHandle;

     aAlfa = "TREECTRL, Tabla de contenidos {{" + aAbre + "}}";
     |CONTROL_SIMPLE 0, aAlfa, 0602, 1348, EvntTree;
     nTreeUti = FSalida;

     |RFBORRA aAbre;

     sT_nID   = nTreeUti;
     sT_nOper = 2;
     sT_aData = "1:";

     |ESPECIFICA "COMMANDCONTROL", sTree;

     |PULSATECLA;
     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nTreeUti;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;

     |FINVENTANA n1Vent;

     |FOCOTECLADO enGrid;
|FPRC;

|PROCESO Agrupador;
     |VENTANA 0501, 1999, -1, 16, "Modificar agrupador";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #dpntw001;

     |PARA nCmp = 0;  |SI nCmp [ 16;  |HACIENDO nCmp = nCmp + 1;
           #dpntw001#nCmp#  = #dpntm001#nCmp#;
     |SIGUE;

     |C_M #dpntw001#00, 1, "N";
     |C_M #dpntw001#09, 1, "N";
     |C_M #dpntw001#14, 1, "N";

     |PINPA #0#dpntw001;  nPanta = FSalida;

     |SI eaAcceso = "PIBOX";
         |CONTROL_SIMPLE nPanta, "LABEL,{{11}}            ", 1103, 1125, NULL;
         |C_V #dpntw001#14, 1, "N";
     |SINO;
         |C_V #dpntw001#14, 1, "S";
         |C_M #dpntw001#14, 1, "N";
     |FINSI;

     |PINDA #0#dpntw001;

     |ENDATOS #1#dpntw001;
     |SI FSalida = 0;
         |LEE 101#dpntm001.=;
         |SI FSalida = 0;
             |SI #dpntm001#1 = "          ";
                 #dpntm001#1 = ("00000" + #dpntm001#0) % -105;
             |FINSI;

             #dpntm001#15 = #dpntw001#15;
             #dpntm001#16 = #dpntw001#16;
             |GRABA 020#dpntm001.a;
             |LIBERA #dpntm001;
         |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;
     |FINVENTANA nVent;

     |REFRESCACONTROL enGrid;

     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO Evento801;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dpntm001.=;
         |SI FSalida = 0;
             |ESTADO_CONTROL nBtnDes, "ENABLE";
             |ESTADO_CONTROL nBtnAcc, "ENABLE";

             |SI nBtnRes ! -1;  |ESTADO_CONTROL nBtnRes, "ENABLE";  |FINSI;
             |SI nBtnEst ! -1;  |ESTADO_CONTROL nBtnEst, "ENABLE";  |FINSI;
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
         |HAZ Agrupador;
     |FINSI;
|FPRC;

|PROCESO dsarm005;
     aAlfa = "N";

     #dsarm004#0 = #dsarm005#1;
     #dsarm004#1 = #dsarm005#2;
     #dsarm004#2 = #dsarm005#3;
     |LEE 000#dsarm004.=;
     |SI FSalida = 0;  |Y #dsarm004#76 = "S";
         #dpntm002#0 = #dpntm001#0;
         #dpntm002#1 = #dsarm004#0;
         #dpntm002#2 = #dsarm004#1;
         #dpntm002#3 = #dsarm004#2;
         |LEE 000#dpntm002.=;
         |SI FSalida ! 0;
             aAlfa = "S";
         |FINSI;
     |FINSI;

     #dsarm005#94 = aAlfa;
     |GRABA 020#dsarm005.a;
     |LIBERA #dsarm005;
|FPRC;

|DEFBUCLE dsarm005;
     #dsarm005#3;
     ;
     #dpntm001#0, "00.00.0000", "     ", 000000001;
     #dpntm001#0, "31.12.9999", "zzzzz", 999999999;
     be;
     NULL, dsarm005;
|FIN;

|PROCESO Habilitar;
     |DBASS aBase;  |QBF aBase;

     aAlfa = "Habilitar Empresa en " + eaAcceso;
     |VENTANA 0501, 1999, -1, 16, aAlfa;
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #dpntw001;

     |C_M #dpntw001#00, 1, "S";
     |C_M #dpntw001#09, 1, "S";

     |SI eaAcceso = "PIBOX";
         |C_V #dpntw001#14, 1, "N";
     |SINO;
         |C_V #dpntw001#14, 1, "S";
         |C_M #dpntw001#14, 1, "S";
     |FINSI;

     |PINPA #0#dpntw001;  nPanta = FSalida;

     |SI eaAcceso = "PIBOX";
         |CONTROL_SIMPLE nPanta, "LABEL,{{11}}            ", 1103, 1125, NULL;
         |C_V #dpntw001#14, 1, "N";
     |SINO;
         |C_V #dpntw001#14, 1, "S";
         |C_M #dpntw001#14, 1, "S";
     |FINSI;

     |PINDA #0#dpntw001;

     |ENDATOS #1#dpntw001;
     |SI FSalida = 0;
         #dpntm001#0  = #dpntw001#0;
         #dpntm001#1  = #dpntw001#1;
         #dpntm001#2  = #dpntw001#2;
         #dpntm001#3  = #dpntw001#3;
         #dpntm001#4  = #dpntw001#4;
         #dpntm001#5  = #dpntw001#5;
         #dpntm001#6  = #dpntw001#6;
         #dpntm001#7  = #dpntw001#7;
         #dpntm001#8  = #dpntw001#8;
         #dpntm001#9  = #dpntw001#9;
         #dpntm001#10 = #dpntw001#10;
         #dpntm001#11 = #dpntw001#11;
         #dpntm001#12 = #dpntw001#12;
         #dpntm001#13 = #dpntw001#13;
         #dpntm001#14 = #dpntw001#14;
         #dpntm001#15 = #dpntw001#15;
         #dpntm001#16 = #dpntw001#16;
         |GRABA 020#dpntm001.n;
         |LIBERA #dpntm001;

         #dpntm005#0 = #dpntm001#0;
         #dpntm005#2 = #dpntw001#9;
         #dpntm005#3 = #dpntw001#14;
         |GRABA 020#dpntm005.n;
         |LIBERA #dpntm005;

         #dpntm005#0 = #dpntm001#0;

         #dsarz010#0 = #dpntm001#1;
         |LEE 101#dsarz010.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsarz010;
             #dsarz010#0 = #dpntm001#1;
             #dsarz010#7 = "S";
             |GRABA 020#dsarz010.n;
         |FINSI;
         |LIBERA #dsarz010;
         |CIERRA #dsarz010;

         |BUCLE dsarm005;

         |SI eaAcceso ! "PIBOX";
             |HAZ CargaMac;

             |HORA aHora;

             eaModoNet     = "Habilitar empresa";
             eaUsuNet      = Usuario % 810; |QBF eaUsuNet;
             fFecha        = ~;
             aFecha        = fFecha;
             eaFechaNet    = aFecha + " " + aHora;
             eaAccesoNet   = #dpntm001#1; |QBF eaAccesoNet;
             eaEmpNet      = ("00000" + #dpntm001#0) % -105;
             eaEmpNet      = eaEmpNet + " / " + #dpntm001#2;   |QBF eaEmpNet;
             eaEmpNet      = eaEmpNet + " / " + #dpntm001#10;  |QBF eaEmpNet;
             eaAccNet      = ("000" + #dpntm005#1) % -103;
             eaAccNet      = eaAccNet + " / " + #dpntm005#2;   |QBF eaAccNet;
             eaTraNet      = "";
             eaDesNet      = #dpntm005#5;
             eaLabNet      = #dpntm005#6;

             |HAZ EnviaNotificacion;

             enCalDESPANET   = 1;
             enCargaPerfiles = 1;
         |FINSI;

         |REFRESCACONTROL enGrid;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;
     |FINVENTANA nVent;

     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROGRAMA;
     |ABRE #dsarm001;
     |LEE 000#dsarm001.p;
     |SI FSalida ! 0;  |DDEFECTO #dsarm001;  |FINSI;
     |CIERRA #dsarm001;

     nOk = 0;
     |SI PARAMETRO ! "";          nOk = 1;  |FINSI;
     |SI PARAMETRO = "DESPABOX";  nOk = 0;  |FINSI;
     |SI PARAMETRO = "PIBOX";     nOk = 0;  |FINSI;

     |SI nOk = 1;
         #dpntm001#0 = PARAMETRO;
         |LEE 101#dpntm001.=;
         |SI FSalida = 0;
             |HAZ Deshabilito;
         |FINSI;

         |ACABA;
     |FINSI;

     eaAcceso        = PARAMETRO;
     enCargaPerfiles = 0;

     |CLS;
     aAlfa = "Asistente activaciones " + eaAcceso;
     |CABEZA aAlfa;

     aAlfa = "Asistente activaciones " + eaAcceso + " (con doble click cambiamos agrupador)";
     |VENTANA 0501, 2899, -1, 16, aAlfa;
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "BOTON,Habilitar nueva empresa", 2502, 2615, Habilitar;
     nBtnHab = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Deshabilitar empresa", 2517, 2630, Deshabilitar;
     nBtnDes = FSalida;

     |SI eaAcceso ! "PIBOX";
         |CONTROL_SIMPLE 0, "BOTON,Restringir carpetas al usuario", 2532, 2656, Restringir;
         nBtnRes = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,Estructura documental personalizada", 2558, 2677, Estructura;
         nBtnEst = FSalida;
     |FINSI;

     |CONTROL_SIMPLE 0, "BOTON,Accesos", 2588, 2698, Accesos;
     nBtnAcc = FSalida;

     |ESTADO_CONTROL nBtnDes, "DISABLE";
     |ESTADO_CONTROL nBtnAcc, "DISABLE";

     |ESTADO_CONTROL nBtnRes, "DISABLE";

     |SI nBtnRes ! -1;  |ESTADO_CONTROL nBtnRes, "DISABLE";  |FINSI;
     |SI nBtnEst ! -1;  |ESTADO_CONTROL nBtnEst, "DISABLE";  |FINSI;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#dpntm001, nRango, 0502, 2498, NULL, NULL, Evento801;
     enGrid = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + enGrid;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |DESTRUYECONTROL enGrid;
     |FIN_CONTROL_WINDOWS nBtnHab;
     |FIN_CONTROL_WINDOWS nBtnDes;
     |FIN_CONTROL_WINDOWS nBtnAcc;

     |SI nBtnRes ! -1;  |FIN_CONTROL_WINDOWS nBtnRes;  |FINSI;
     |SI nBtnEst ! -1;  |FIN_CONTROL_WINDOWS nBtnEst;  |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;
|FPRO;

|PROCESO dpntm001Ver;
     #dpntm005#0 = #dpntm001#0;
     #dpntm005#1 = 1;
     #dpntm005#2 = #dpntm001#9;
     #dpntm005#3 = #dpntm001#14;
     |GRABA 020#dpntm005.n;
     |LIBERA #dpntm005;
|FPRC;

|DEFBUCLE dpntm001Ver;
     #dpntm001#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dpntm001Ver;
|FIN;

|PROCESO Tipo80;  |TIPO 80;
     |HAZ LeeUnidadBasico;

     aPathLocal = eaUnidadBasico + "\documentos";   |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\dsarchi";          |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\";

     |ABRE #dpntm005;
     |LEE 000#dpntm005.p;
     |SI FSalida ! 0;
         |BUCLE dpntm001Ver;
     |FINSI;
     |CIERRA #dpntm005;

     |ABRET #dsarm002;
     |ABRET #dsarm003;
     |ABRET #dsarm004;
     |ABRET #dpntm002;
     |ABRET #dsarz010;
     |ABRET #dpntm001;
     |ABRET #dpntm005;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |CIERRAT #dsarm002;
     |CIERRAT #dsarm003;
     |CIERRAT #dsarm004;
     |CIERRAT #dpntm002;
     |CIERRAT #dsarz010;
     |CIERRAT #dpntm001;
     |CIERRAT #dpntm005;
|FPRC;
