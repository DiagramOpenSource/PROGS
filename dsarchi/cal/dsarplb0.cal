|FICHEROS;
     dsarm001 #1;
     dsarm005 #5;
     dsarm006 #6;        ||Entrada/Salidas Doc.
     dsarm007 #7;        ||Asociaciones
|FIN;

|VARIABLES;
     aCar = "";
     nValor = 0;
     nSwYaUTF = 0;
     aMete = "";
     nSwHayQueEscapar = 0;
     &eaEscapaAsunto = "";

     &enSwDocModificado = 0;
     &enSwIOCorrecta    = 0;

     nTipoD          = 0;
     nTipoH          = 0;
     nSubD           = 0;
     nSubH           = 0;
     nGrupo          = 0;
     nPos1           = 0;
     nPos2           = 0;

     nCamuf          = 0;
     nCamuf1         = 0;
     nCamuf2         = 0;
     nNum            = 0;
     nCaracter       = 0;
     nPos            = 0;
     nCampo          = 0;
     nCampo1         = 0;
     nSer            = 0;
     nLong           = 0;
     nBarra          = 0;
     nCar            = 0;
     nLen            = 0;
     nIdSalir        = 0;
     nVentPlb        = 0;
     nHay            = 0;
     nPaso           = 0;
     nLen1           = 0;

     aMensaje        = "";
     aPath           = "";
     aBorra          = "";
     aCamufz         = "";
     aAlfa           = "";
     aAlfa1          = "";
     aAlfa2          = "";
     aIPRemoto       = "";
     aLong           = "";
     aCadena         = "";
     aCaracter       = "";
     aLen            = "";
     aDocRemoto      = "";
     aDocServidor    = "";

     {50}aCarac      = "";

     {-1}aVent       = "";
         aVent1      = 0;
         aVent2      = 0;
         aVent3      = 0;
         aVent4      = 0;
         aVent5      = "";

     {2}nNivel       = 0;
     {1}aContiene    = "";

     &eaOrigen        = "";
     &eaDestino       = "";
     &eaRutaOrigen    = "";
     &eaRutaDestino   = "";
     &eaFicheroTar    = "";
     &eaFicheroTxt    = "";
     &eaFicheroTgz    = "";
     &eaAlfa          = "";
     &eaGrupoBorra    = 0;
     &eaSubBorra      = 0;
     &eaTipoBorra     = 0;
     &eaClave         = "";
     &enPassword      = 0;
     &enSwNuevoMD5    = 0;
     &eaSwBorroOrigen = "";
     &eaDocPC         = "";
|FIN;

|PROCESO CargaVarBorrado;
     eaSwBorroOrigen = #dsarm001#217;
     |SI #dsarm001#217 = "P";
         eaSwBorroOrigen = "N";
         |CONFI "0000NBorramos documento en origen si se archiva correctamente";
         |SI FSalida = 0;
             eaSwBorroOrigen = "S";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO RecibeConMD5;
     aIPRemoto   = "";
     |IP_REMOTO aIPRemoto;

     enSwIOCorrecta = 0;
     |SI #1#7 = "N";
         aContiene1 = eaDestino;
         |ESPECIFICA "REMOTOMD5", aContiene;
         aDocRemoto = FSalida;  |QBF aDocRemoto;

         aContiene1 = eaOrigen;
         |ESPECIFICA "MD5", aContiene;
         aDocServidor = FSalida;  |QBF aDocServidor;

         |SI aDocRemoto ! aDocServidor;
             enSwDocModificado = 1;

             |SI aIPRemoto ! "";
                 |RECIBE_FICHERO eaDestino, eaOrigen;

                 aContiene1 = eaDestino;
                 |ESPECIFICA "REMOTOMD5", aContiene;
                 aDocRemoto = FSalida;  |QBF aDocRemoto;

                 aContiene1 = eaOrigen;
                 |ESPECIFICA "MD5", aContiene;
                 aDocServidor = FSalida;  |QBF aDocServidor;

                 |SI aDocRemoto = aDocServidor;
                      enSwIOCorrecta = 1;
                 |FINSI;

                 aAlfa = "";
                 |DIRECTORIO aAlfa;  |QBF aAlfa;
                 aAlfa = aAlfa + "bin/agichmod 777 " + eaOrigen;
                 |SYSTEM aAlfa;
             |SINO;
                 |COPIA_FICHERO eaDestino, eaOrigen;
                 aContiene1 = eaDestino;
                 |ESPECIFICA "REMOTOMD5", aContiene;
                 aDocRemoto = FSalida;  |QBF aDocRemoto;

                 aContiene1 = eaOrigen;
                 |ESPECIFICA "MD5", aContiene;
                 aDocServidor = FSalida;  |QBF aDocServidor;

                 |SI aDocRemoto = aDocServidor;
                      enSwIOCorrecta = 1;
                 |FINSI;
             |FINSI;
         |SINO;
             enSwIOCorrecta = 1;
         |FINSI;
     |SINO;
          aContiene1 = eaDestino;
          |ESPECIFICA "REMOTOMD5", aContiene;
          aDocRemoto = FSalida;  |QBF aDocRemoto;

          aContiene1 = eaOrigen;
          |ESPECIFICA "REMOTOMD5", aContiene;
          aDocServidor = FSalida;  |QBF aDocServidor;

          |SI aDocRemoto ! aDocServidor;
              enSwDocModificado = 1;
              |RCOPIA_FICHERO eaDestino, eaOrigen;
              aContiene1 = eaDestino;
              |ESPECIFICA "REMOTOMD5", aContiene;
              aDocRemoto = FSalida;  |QBF aDocRemoto;

              aContiene1 = eaOrigen;
              |ESPECIFICA "REMOTOMD5", aContiene;
              aDocServidor = FSalida;  |QBF aDocServidor;

              |SI aDocRemoto = aDocServidor;
                  enSwIOCorrecta = 1;
              |FINSI;
          |SINO;
              enSwIOCorrecta = 1;
          |FINSI;
     |FINSI;

     |SI enSwIOCorrecta = 1;
         |SI eaSwBorroOrigen = "S";
             |SI eaDocPC ! ""
                 |RFBORRA eaDocPC;
             |FINSI;
         |FINSI;
     |FINSI;

     eaDocPC = "";
|FPRC;

|PROCESO dsarm006borra;
     |BORRA 020#dsarm006.a;
|FPRC;

|DEFBUCLE dsarm006borra;
     #dsarm006#1;
     ;
     #dsarm005#0, 001;
     #dsarm005#0, 999;
     be;
     NULL, dsarm006borra;
|FIN;

|PROCESO dsarm007borra;
     |BORRA 020#dsarm007.a;
|FPRC;

|DEFBUCLE dsarm007borra;
     #dsarm007#1;
     ;
     #dsarm005#0, 001;
     #dsarm005#0, 999;
     be;
     NULL, dsarm007borra;
|FIN;

|PROCESO dsarm005;
     |BUCLE dsarm006borra;
     |BUCLE dsarm007borra;

     |SI #1#7 = "S";
         aPath = #dsarm005#7;  |QBF aPath;
         |SI aPath ! "";
             aBorra = aPath + #dsarm005#9;
             |QBF aBorra;
             |SI aBorra ! "";
                 |RFBORRA aBorra;
             |FINSI;
        |FINSI;
     |FINSI;

     |BORRA 020#dsarm005.a;
|FPRC;

|DEFBUCLE dsarm005;
     #dsarm005#2;
     ;
     nGrupo, nSubD, nTipoD, 000000000;
     nGrupo, nSubH, nTipoH, 999999999;
     be;
     NULL, dsarm005;
|FIN;

|PROCESO BorraRegistro;
     |ABRE #1;
     |LEE 000#1p;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     |SI eaTipoBorra = "*";
          nTipoD = 0;
          nTipoH = 999;
     |SINO;
          nTipoD = eaTipoBorra;
          nTipoH = eaTipoBorra;
     |FINSI;

     |SI eaSubBorra = "*";
          nSubD = 0;
          nSubH = 999;
     |SINO;
          nSubD = eaSubBorra;
          nSubH = eaSubBorra;
     |FINSI;

     nGrupo = eaGrupoBorra;

     |BUCLE dsarm005;
|FPRC;

|PROCESO Encripta;
     aCamufz = "";
     |PARA nCaracter = 1; |SI nCaracter [ 10; |HACIENDO nCaracter = nCaracter + 1;
           nPos   = (nCaracter * 100) + 1;
           aAlfa1 = eaClave % nPos;

           nCamuf = &aAlfa1;
           nCamuf = nCamuf * 2;

           nNum    = ((nCamuf - (nCamuf $ 26)) / 26 ) + 65;
           aCamufz = aCamufz + &nNum;

           nNum    = (nCamuf $ 26) + 65;
           aCamufz = aCamufz + &nNum;
     |SIGUE;

     eaClave = aCamufz;
|FPRC;

|PROCESO Desencripta;
     aCamufz = "";
     |PARA nCaracter = 1; |SI nCaracter [ 20; |HACIENDO nCaracter = nCaracter + 2;
          nPos = (nCaracter * 100) + 1;         aAlfa1 = eaClave % nPos;
          nPos = ((nCaracter + 1) * 100) + 1;   aAlfa2 = eaClave % nPos;

          nCamuf2 = &aAlfa2;
          nCamuf2 = nCamuf2 - 65;

          nCamuf1 = &aAlfa1;
          nCamuf1 = nCamuf1 - 65;
          nCamuf1 = ((nCamuf1 * 26) + nCamuf2) / 2;

          aCamufz = aCamufz + &nCamuf1;
     |SIGUE;
     eaClave = aCamufz;
|FPRC;

|PROCESO PidePassword;
     |ABRE #1;
     |LEE 000#1p;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     aAlfa = #1#2;  |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     |VENTANA 1240, 1470, -1, 16, "Introduzca el Password";
     nVentPlb = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentPlb;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enPassword = 0;
     eaClave    = "";
     E_sup      = 10;
     E_inf      = "";
     eaClave    = 1350 ? -1;

     |HAZ Encripta;

     |SI eaClave ! #1#2;
         |MENAV "0000 Password incorrecto ...";
         enPassword = 1;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentPlb;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentPlb;
|FPRC;

|PROCESO PidePassword9;
     |ABRE #1;
     |LEE 000#1p;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     aAlfa = #1#2;  |QBF aAlfa;

     |SI aAlfa = "";  |ACABA;  |FINSI;

     |PUSHV 0501 2380;

     |BLANCO 1416 1760;
     |CUADRO 1416 1760;

     |PINTA 1521, "Introduzca el Password";

     enPassword = 0;
     eaClave    = "";
     E_sup      = 10;
     E_inf      = "";
     eaClave    = 1546 ? -1;

     |HAZ Encripta;

     |SI eaClave ! #1#2;
         |MENAV "0000 Password incorrecto ...";
         enPassword = 1;
     |FINSI;

     |POPV;
|FPRC;


|PROCESO QuitaRarosCorreo;
     |QBF eaAlfa;

     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           nCaracter = &aCaracter;

           |SI aCaracter = "¥";  aCaracter = &"0209"; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &0241;   |FINSI;
           |SI aCaracter = "á";  aCaracter = &0225;   |FINSI;
           |SI aCaracter = " ";  aCaracter = &0225;   |FINSI;
           |SI aCaracter = "";  aCaracter = &0233;   |FINSI;
           |SI aCaracter = "¡";  aCaracter = &0237;   |FINSI;
           |SI aCaracter = "¢";  aCaracter = &0243;   |FINSI;
           |SI aCaracter = "£";  aCaracter = &0250;   |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena;
|FPRC;


|PROCESO QuitaRarosXML;
     ||DEBUG;
     |QBF eaAlfa;

     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
          nPos = (100 * nCampo) + 1;
          aCaracter = eaAlfa % nPos;
          aCar = aCaracter;
          nCaracter = &aCaracter;

          nValor = &aCar;
          nSwYaUTF = 0;

          |SI aCar = "Ñ"; aCar = &195 + &145; nSwYaUTF = 1; |FINSI; || en algunos defectos la ¥ ya esta cambiada
          |SI aCar = "¥"; aCar = &195 + &145; nSwYaUTF = 1; |FINSI;

          |SI aCar = "ñ"; aCar = &195 + &177; nSwYaUTF = 1; |FINSI;
          |SI aCar = "¤"; aCar = &195 + &177; nSwYaUTF = 1; |FINSI;

          |SI aCar = "á"; aCar = &195 + &161; nSwYaUTF = 1; |FINSI;
          |SI aCar = " "; aCar = &195 + &161; nSwYaUTF = 1; |FINSI;

          |SI aCar = "é"; aCar = &195 + &169; nSwYaUTF = 1; |FINSI;
          |SI aCar = ""; aCar = &195 + &169; nSwYaUTF = 1; |FINSI;

          |SI aCar = "í"; aCar = &195 + &173; nSwYaUTF = 1; |FINSI;
          |SI aCar = "¡"; aCar = &195 + &173; nSwYaUTF = 1; |FINSI;

          |SI aCar = "ó"; aCar = &195 + &179; nSwYaUTF = 1; |FINSI;
          |SI aCar = "¢"; aCar = &195 + &179; nSwYaUTF = 1; |FINSI;

          |SI aCar = "ú"; aCar = &195 + &186; nSwYaUTF = 1; |FINSI;
          |SI aCar = "£"; aCar = &195 + &186; nSwYaUTF = 1; |FINSI;

          |SI aCar = "º"; aCar = &194 + &186; nSwYaUTF = 1; |FINSI;
          |SI aCar = "§"; aCar = &194 + &186; nSwYaUTF = 1; |FINSI;

          |SI aCar = "ª"; aCar = &194 + &170; nSwYaUTF = 1; |FINSI;
          |SI aCar = "¦"; aCar = &194 + &170; nSwYaUTF = 1; |FINSI;

          |SI aCar = "°"; aCar = &226 + &130 + &172; nSwYaUTF = 1; |FINSI;  ||Euro

          |SI nValor > 127; |Y nSwYaUTF = 0;
               |SI nValor = "135"; aCar = &195 + &167; nSwYaUTF = 1; |FINSI;    || c cedilla
               |SI nValor = "128"; aCar = &195 + &135; nSwYaUTF = 1; |FINSI;    || C cedilla

               |SI nValor = "133"; aCar = &195 + &160; nSwYaUTF = 1; |FINSI;    || a acento cerrado
               |SI nValor = "138"; aCar = &195 + &168; nSwYaUTF = 1; |FINSI;    || e acento cerrado
               |SI nValor = "141"; aCar = &195 + &172; nSwYaUTF = 1; |FINSI;    || i acento cerrado
               |SI nValor = "149"; aCar = &195 + &178; nSwYaUTF = 1; |FINSI;    || o acento cerrado
               |SI nValor = "151"; aCar = &195 + &185; nSwYaUTF = 1; |FINSI;    || u acento cerrado

               |SI nValor = "129"; aCar = &195 + &175; nSwYaUTF = 1; |FINSI;    || i con dieresis
               |SI nValor = "139"; aCar = &195 + &188; nSwYaUTF = 1; |FINSI;    || u con dieresis
               |SI nValor = "148"; aCar = &195 + &182; nSwYaUTF = 1; |FINSI;    || o con dieresis

               |SI nValor = "207"; aCar = &195 + &143; nSwYaUTF = 1; |FINSI;    || I con dieresis
               |SI nValor = "154"; aCar = &195 + &156; nSwYaUTF = 1; |FINSI;    || U con dieresis

               |SI nValor = "165"; aCar = &195 + &145; nSwYaUTF = 1; |FINSI;    || ENYE

               |SI nValor = "160"; aCar = &195 + &161; nSwYaUTF = 1; |FINSI;    || a acento
               |SI nValor = "130"; aCar = &195 + &169; nSwYaUTF = 1; |FINSI;    || e acento
          |FINSI;

          |SI nSwYaUTF = 1;
               aCaracter = aCar;
          |SINO;
              |SI aCaracter = "&";
                   aCaracter = "&amp;";
              |SINO;
                   |SI nCaracter = 192;  aCaracter = "A";  |FINSI;
                   |SI nCaracter = 193;  aCaracter = "A";  |FINSI;
                   |SI nCaracter = 142;  aCaracter = "A";  |FINSI;
                   |SI nCaracter = 200;  aCaracter = "E";  |FINSI;
                   |SI nCaracter = 201;  aCaracter = "E";  |FINSI;
                   |SI nCaracter = 210;  aCaracter = "O";  |FINSI;
                   |SI nCaracter = 211;  aCaracter = "O";  |FINSI;
                   |SI nCaracter = 204;  aCaracter = "I";  |FINSI;
                   |SI nCaracter = 205;  aCaracter = "I";  |FINSI;
                   |SI nCaracter = 207;  aCaracter = "I";  |FINSI;
                   |SI nCaracter = 153;  aCaracter = "O";  |FINSI;
                   |SI nCaracter = 217;  aCaracter = "U";  |FINSI;
                   |SI nCaracter = 218;  aCaracter = "U";  |FINSI;
                   |SI nCaracter = 154;  aCaracter = "U";  |FINSI;

                   |SI nCaracter = 160;  aCaracter = "a";  |FINSI;
                   |SI nCaracter = 130;  aCaracter = "e";  |FINSI;
                   |SI nCaracter = 161;  aCaracter = "i";  |FINSI;
                   |SI nCaracter = 162;  aCaracter = "o";  |FINSI;
                   |SI nCaracter = 163;  aCaracter = "u";  |FINSI;

                   |SI nCaracter = 133;  aCaracter = "a";  |FINSI;
                   |SI nCaracter = 138;  aCaracter = "e";  |FINSI;
                   |SI nCaracter = 141;  aCaracter = "i";  |FINSI;
                   |SI nCaracter = 149;  aCaracter = "o";  |FINSI;
                   |SI nCaracter = 151;  aCaracter = "u";  |FINSI;
                   |SI nCaracter = 132;  aCaracter = "a";  |FINSI;
                   |SI nCaracter = 137;  aCaracter = "e";  |FINSI;
                   |SI nCaracter = 139;  aCaracter = "i";  |FINSI;
                   |SI nCaracter = 148;  aCaracter = "o";  |FINSI;
                   |SI nCaracter = 129;  aCaracter = "u";  |FINSI;

                   |SI nCaracter = 164;  aCaracter = "n";  |FINSI;
                   |SI nCaracter = 165;  aCaracter = "N";  |FINSI;
                   |SI nCaracter = 135;  aCaracter = "c";  |FINSI;
                   |SI nCaracter = 128;  aCaracter = "C";  |FINSI;
                   |SI nCaracter = 166;  aCaracter = "a";  |FINSI;
                   |SI nCaracter = 167;  aCaracter = "o";  |FINSI;


                   ||Tiquet. 3480 | 318

                   |SI nCaracter < 32; aCaracter = ""; |FINSI;       ||Caracteres Control
                   |SI nCaracter = 131;  aCaracter = "a";  |FINSI;   ||a con acento circunflejo
                   |SI nCaracter = 134;  aCaracter = "a";  |FINSI;   ||a con anillo
                   |SI nCaracter = 136;  aCaracter = "e";  |FINSI;   ||e con acento circunflejo
                   |SI nCaracter = 140;  aCaracter = "i";  |FINSI;   ||i con acento circunflejo
                   |SI nCaracter = 143;  aCaracter = "A";  |FINSI;   ||A con anillo
                   |SI nCaracter = 144;  aCaracter = "E";  |FINSI;   ||E con acento agudo
                   |SI nCaracter = 145;  aCaracter = " ";  |FINSI;   ||diptongo ae
                   |SI nCaracter = 146;  aCaracter = " ";  |FINSI;   ||diptongo AE
                   |SI nCaracter = 147;  aCaracter = "o";  |FINSI;   ||o con acento circunflejo
                   |SI nCaracter = 150;  aCaracter = "u";  |FINSI;   ||u con acento circunflejo
                   |SI nCaracter = 152;  aCaracter = "y";  |FINSI;   ||y con dieresis
                   |SI nCaracter = 155;  aCaracter = "o";  |FINSI;   ||o con barra inclinada
                   |SI nCaracter = 156;  aCaracter = " ";  |FINSI;   ||Libra esterlina
                   |SI nCaracter = 157;  aCaracter = "O";  |FINSI;   ||O con barra inclinada
                   |SI nCaracter = 169;  aCaracter = " ";  |FINSI;   ||Signo Registrado
                   |SI nCaracter = 170;  aCaracter = " ";  |FINSI;   ||Signo Negacion
                   |SI nCaracter = 171;  aCaracter = " ";  |FINSI;   ||1/2
                   |SI nCaracter = 172;  aCaracter = " ";  |FINSI;   ||1/4
                   |SI nCaracter = 181;  aCaracter = "A";  |FINSI;   ||A con acento agudo
                   |SI nCaracter = 182;  aCaracter = "A";  |FINSI;   ||A con acento circunflejo
                   |SI nCaracter = 183;  aCaracter = "A";  |FINSI;   ||A con acento grave
                   |SI nCaracter = 184;  aCaracter = "c";  |FINSI;   ||Signo Copyright
                   |SI nCaracter = 198;  aCaracter = "a";  |FINSI;   ||a con tilde
                   |SI nCaracter = 199;  aCaracter = "A";  |FINSI;   ||A con tilde
                   ||SI nCaracter = 210;  aCaracter = "E";  |FINSI;   ||E con acento circunflejo
                   ||SI nCaracter = 211;  aCaracter = "E";  |FINSI;   ||E con dieresis
                   |SI nCaracter = 212;  aCaracter = "E";  |FINSI;   ||E con acento grave
                   |SI nCaracter = 213;  aCaracter = "i";  |FINSI;   ||i sin punto
                   |SI nCaracter = 214;  aCaracter = "I";  |FINSI;   ||I acento agudo
                   |SI nCaracter = 215;  aCaracter = "I";  |FINSI;   ||I acento circunflejo
                   |SI nCaracter = 216;  aCaracter = "I";  |FINSI;   ||I con dieresis
                   |SI nCaracter = 222;  aCaracter = "I";  |FINSI;   ||I con acento grave
                   |SI nCaracter = 224;  aCaracter = "O";  |FINSI;   ||O con acento agudo
                   |SI nCaracter = 226;  aCaracter = "O";  |FINSI;   ||O con acento circunflejo
                   |SI nCaracter = 227;  aCaracter = "O";  |FINSI;   ||O con acento grave
                   |SI nCaracter = 228;  aCaracter = "o";  |FINSI;   ||o con tilde
                   |SI nCaracter = 229;  aCaracter = "O";  |FINSI;   ||O con tilde
                   |SI nCaracter = 233;  aCaracter = "U";  |FINSI;   ||U acento agudo
                   |SI nCaracter = 234;  aCaracter = "U";  |FINSI;   ||U acento circunflejo
                   |SI nCaracter = 235;  aCaracter = "U";  |FINSI;   ||U acento grave
                   |SI nCaracter = 236;  aCaracter = "y";  |FINSI;   ||y acento agudo
                   |SI nCaracter = 237;  aCaracter = "Y";  |FINSI;   ||Y acento agudo
              |FINSI;
          |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena;
|FPRC;

|PROCESO EscapaAsunto;
     |QBF eaEscapaAsunto;

     nSwHayQueEscapar = 0;


/*
     ||TODO CCC. Quitar esto. SOLO PARA PRUEBAS.
     aCadena = "";
     |PARA nCampo = 128;  |SI nCampo [ 255;  |HACIENDO nCampo = nCampo + 1;
          aCaracter = &nCampo;
          aCadena = aCadena + aCaracter;
     |SIGUE;
     eaEscapaAsunto = aCadena;
     ||TODO CCC. Quitar esto. SOLO PARA PRUEBAS.
*/

     aLen    = eaEscapaAsunto % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
          nPos = (100 * nCampo) + 1;
          aCaracter = eaEscapaAsunto % nPos;
          nCaracter = &aCaracter;

          |SI nCaracter > 127;
               nSwHayQueEscapar = 1;
               |SAL;
          |FINSI;
     |SIGUE;

     |SI nSwHayQueEscapar = 1;
          aCadena = "=?iso-8859-1?Q?";
          aLen    = eaEscapaAsunto % 0;
          nLen    = aLen;
          |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
               nPos = (100 * nCampo) + 1;
               aCaracter = eaEscapaAsunto % nPos;
               nCaracter = &aCaracter;

               |SI nCaracter > 127; |O nCaracter = 61; |O nCaracter = 63; |O nCaracter = 32;
                    ||Escapamos el caracter
                    |SI nCaracter = 61; |O nCaracter = 63;
                         |SI nCaracter = 61;
                              aCadena = aCadena + "=3D";
                         |SINO;
                              aCadena = aCadena + "=3F";
                         |FINSI;
                    |SINO;
                         |SI nCaracter = 32;
                              aCadena = aCadena + "_";
                         |SINO;
                              ||Escapar > 127
                              ||Son < 127 y < 255

                              aMete = "_";        ||Por defecto los cambio por un espacio

                              |SI nCaracter = 225; aMete = "=E1"; |FINSI;   ||a + acento
                              |SI nCaracter = 233; aMete = "=E9"; |FINSI;   ||e + acento
                              |SI nCaracter = 237; aMete = "=ED"; |FINSI;   ||i + acento
                              |SI nCaracter = 243; aMete = "=F3"; |FINSI;   ||o + acento
                              |SI nCaracter = 250; aMete = "=FA"; |FINSI;   ||u + acento

                              ||Las mayusculas acentuadas, las convierte automaticamente el basico, quitandole el acento.

                              |SI nCaracter = 133; aMete = "=E0"; |FINSI;   ||a + acento abierto
                              |SI nCaracter = 138; aMete = "=E8"; |FINSI;   ||e +
                              |SI nCaracter = 141; aMete = "=EC"; |FINSI;   ||i +
                              |SI nCaracter = 149; aMete = "=F2"; |FINSI;   ||o +
                              |SI nCaracter = 151; aMete = "=F9"; |FINSI;   ||u +

                              |SI nCaracter = 132; aMete = "=E4"; |FINSI;   ||a + dieresis
                              |SI nCaracter = 137; aMete = "=EB"; |FINSI;   ||e +
                              |SI nCaracter = 139; aMete = "=EF"; |FINSI;   ||i +
                              |SI nCaracter = 148; aMete = "=F6"; |FINSI;   ||o +
                              |SI nCaracter = 129; aMete = "=FC"; |FINSI;   ||u +


                              |SI nCaracter = 241; aMete = "=F1"; |FINSI;   ||enye
                              |SI nCaracter = 209; aMete = "=D1"; |FINSI;   ||ENYE


                              |SI nCaracter = 135; aMete = "=E7"; |FINSI;   ||c trencada
                              |SI nCaracter = 128; aMete = "=C7"; |FINSI;

                              aCadena = aCadena + aMete;
                         |FINSI;
                    |FINSI;
               |SINO;
                    aCadena = aCadena + aCaracter;
               |FINSI;
          |SIGUE;
          aCadena = aCadena + "?=";
          eaEscapaAsunto = aCadena;
     |FINSI;
|FPRC;
