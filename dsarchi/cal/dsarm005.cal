||EnvioCorreoAva  (Envia correo Avanzado)
||EnvioCorreoMulti (Envia correo MultiDocumentos (como adjuntos))

||Nuevo parametro:
||"DS9ALBAOCR" -> Tendre que averiguar el XXXYYYZZZ (207, 208 y 209 en dsarm001)
||Hace un filtro del grupo XXX subgrupo YYY y tipo ZZZ
||similar a como lo tenemos en ADCONTA.
||Tiquet: 1647.512.  El nucleo esta en el dsarm505

||Nuevo parametro:
||CAPDOC + 8 digitos ( dsarchi/XXXXXXXX.txt) + CIF/NIF
||CAPDOC0008600021652787N
||Sirve para capturar documentos del cif en cuestion que le pasemos
||Devuelve un "8digitos".txt en dsarchi con la ubicacion + nombre + RedLocal S/N
||Se utiliza por ahora solo en dsparcli

|FICHEROS;
     dsarz010;

     dsarm000;           ||Usuarios
     dsarm001;
     dsarm002;           ||Grupos
     dsarm003;           ||Subgrupos
     dsarm004;           ||Tipos
     dsarm005;           ||Registro documentos
     dsarm006;           ||Entrada/Salidas Doc.
     dsarm007;           ||Entrada/Salidas Doc.
     dsarm008;           ||Vistas por Arbol.
     dsarm029;           ||Plantillas AutoRelle
     dsarm030;
     dsarm031;
     dsarm034;           ||Resultado dsEscan
     dsarm035;           ||VAR. Resul. dsEscan
     dsarm043;           ||Permisos Vistas Usu.
     dsarm044;           ||Permisos VistasTipos
     dsarm046;           ||Vinculos externos
     dsarm054;           ||Band.exporta.DsEscan
     dsarm055;
     dsarm056;
     dsarm059;

     dpntm001;

     dsarw018,MANTE;
     dsarw058;
     dsarw087,MANTE;           ||Preg. Asunto+Cuerpo
     dsarw088;                 ||Aux. Envio Avanzado

     flowm006;
     flowm001;
     flowm002;
     flowm004;
     flowm005;

     dsarm005@;
     dsam0000@;
     registro@;
     canempre@;
     referen@;
     otrodef@;
|FIN;

|VARIABLES;
     aUsuDebug = "";
     &enSwFiltroAsociar = 0;       ||Asociar Avanzado
     &eaNomFicFiltroAso = "";      ||Fichero temporal para Aso. Avanzada

     ||Numero parametro: CAPDOC0008600021652787N
     aNombreCapDoc = "";
     nSwModoCapDoc = 0;
     aFicheroCap = "";
     nHandleCap = 0;
     aLinea = "";

     ||Bandeja errores reconocimiento OCR
     &enSwBandejaErrOCR = 0;
     &enGrupoErrOCR = 0;
     &enSubGrupoErrOCR = 0;
     &enTipoErrOCR = 0;
     &enGrupoOCRYes = 0;
     &enSubGrupoOCRYes = 0;
     &enTipoOCRYes = 0;
     &enEmpDS9Mov = 0;
     &eaSerDS9Mov = "";
     &enNumDS9Mov = 0;
     &enSwDS9Mov = 0;

     ||Enviar al dserp
     &enNumDSerpAV = 0;
     &eaPathFichero = "";
     &enSwEstaAV = 0;
     &eaSerieAV = "";
     &enNumeroAV = 0;
     &enEmpresaAV = 0;


     ||Borrar documento en el dserp al dar de baja,
     ||procede de un albaran de dscomer9 (captura automatica)
     aDirDocs = "";
     aTextoVin1 = "";
     aTipoDocAux = "";
     aSerieAux = "";
     nNumeroAux = 0;
     nEmpresaAux = 0;
     nNumDocDSerp = 0;
     aCien = "";
     aClaveErp = "";
     aBass = "";
     aErp = "";
     aPathErp = "";

     aNomFicheroAux = "";
     aSQL = "";
     aLetra = "";
     nVoy = 0;
     aSaca = "";
     &enSwModoClinica = 0;      ||Se llamada desde parametros  CLINICAHHHH_EEEE
                                ||La llamada se hace desde una aplicacion externa
                                ||como GreenCube.
     &enHHHHClinica = 0;
     &enEEEEClinica = 0;

     aHHHH = "";
     aEEEE = "";
     nSwHayBarra = 0;

     &enSwPlantillaConta = 0;
     &enLibroConta = 0;
     &enDocumentoConta = 0;

     &eaAuxConta1 = "";
     &eaAuxConta2 = "";
     &eaAuxConta3 = "";
     &eaAuxConta4 = "";
     &eaAuxConta5 = "";

     aParaIni = "";
     aCarpetaCaptura = "";
     aTextoIni = "";

     ||Control de Vinculos Externos.
     aVinculo1Antes = "";
     aVinculo2Antes = "";
     nSwConsultaVinExternos = 0;
     &enNumRegVincuExte = 0;
     &enSwVinculosExternos = 0;
     &eaTipoVinculo = "";
     &eaValorVinculo1 = "";
     &eaValorVinculo2 = "";
     &eaValorVinculoAux = "";
     &eaPosicionateVinculo1 = "";
     &eaPosicionateVinculo2 = "";
     &enGrupoVinExte = 0;
     &enSubGrupoVinExte = 0;
     &enTipoVinExte = 0;
     &enSwErrorVinExte = 0;

     ||BANDEJADSESCANMANUAL
     &efFechaBandeja = @;
     &eaHoraBandeja = "";
     &eaNombreBandeja = "";
     nSwCreaBanDSEscanManual = 0;
     nSwEstaBandeja = 0;

     ||Multiseleccion Correo
     nBotonMas = 0;
     nBotonMulti = 0;
     &enNumMultiSele = 0;
     &enSwDefMultiSele = 0;
     aDatos999 = "";

     &enModoBus = 0;          ||Indica si estamos o no dentro de una busqueda
                              ||enBusqueda No me sirve, se usa para mas cosas

     &eaNombre188 = "";       ||Para pasar el nombre de los adjuntos al Enviador de correos
     &enCliAutoAvanzado = 0;  ||Cliente al que se envia el correo.
     &eaEmailCliAvanzado = "";
     &enCodSelAva = 0;
     &eaGrabaHis = "";
     &eaAsuntoAva = "";
     &eaCuerpo1Ava = "";
     &eaCuerpo2Ava = "";
     &eaCuerpo3Ava = "";
     &eaCuerpo4Ava = "";
     &eaCuerpo5Ava = "";
     &eaCuerpo6Ava = "";
     &eaCuerpo7Ava = "";
     &eaCuerpo8Ava = "";
     &eaCuerpo9Ava = "";
     &eaCuerpo10Ava = "";
     &eaCuerpo11Ava = "";
     &eaCuerpo12Ava = "";
     &eaCuerpo13Ava = "";
     &eaCuerpo14Ava = "";
     &eaCuerpo15Ava = "";
     &eaCuerpo16Ava = "";
     &eaCuerpo17Ava = "";
     &eaCuerpo18Ava = "";
     &eaCuerpo19Ava = "";
     &eaCuerpo20Ava = "";
     &eaCuerpo21Ava = "";
     &eaCuerpo22Ava = "";
     &eaCuerpo23Ava = "";
     &eaCuerpo24Ava = "";
     &eaCuerpo25Ava = "";
     &eaCuerpo26Ava = "";
     &eaCuerpo27Ava = "";
     &eaCuerpo28Ava = "";
     &eaCuerpo29Ava = "";
     &eaCuerpo30Ava = "";
     &eaCuerpo31Ava = "";
     &eaCuerpo32Ava = "";
     &eaCuerpo33Ava = "";
     &eaCuerpo34Ava = "";
     &eaCuerpo35Ava = "";
     &eaCuerpo36Ava = "";
     &eaCuerpo37Ava = "";
     &eaCuerpo38Ava = "";
     &eaCuerpo39Ava = "";
     &eaCuerpo40Ava = "";
     &eaCuerpo41Ava = "";
     &eaCuerpo42Ava = "";
     &eaCuerpo43Ava = "";
     &eaCuerpo44Ava = "";
     &eaCuerpo45Ava = "";
     &eaCuerpo46Ava = "";
     &eaCuerpo47Ava = "";
     &eaCuerpo48Ava = "";
     &eaCuerpo49Ava = "";
     &eaCuerpo50Ava = "";
     &eaCuerpo51Ava = "";
     &eaCuerpo52Ava = "";
     &eaCuerpo53Ava = "";
     &eaCuerpo54Ava = "";
     &eaCuerpo55Ava = "";
     &eaCuerpo56Ava = "";
     &eaCuerpo57Ava = "";
     &eaCuerpo58Ava = "";
     &eaCuerpo59Ava = "";
     &eaCuerpo60Ava = "";
     &eaCuerpo61Ava = "";
     &eaCuerpo62Ava = "";
     &eaCuerpo63Ava = "";
     &eaCuerpo64Ava = "";
     &eaCuerpo65Ava = "";
     &eaCuerpo66Ava = "";
     &eaCuerpo67Ava = "";
     &eaCuerpo68Ava = "";
     &eaCuerpo69Ava = "";
     &eaCuerpo70Ava = "";
     &eaCuerpo71Ava = "";
     &eaCuerpo72Ava = "";
     &eaCuerpo73Ava = "";
     &eaCuerpo74Ava = "";
     &eaCuerpo75Ava = "";
     &eaCuerpo76Ava = "";
     &eaCuerpo77Ava = "";
     &eaCuerpo78Ava = "";
     &eaCuerpo79Ava = "";
     &eaCuerpo80Ava = "";
     &eaCuerpo81Ava = "";
     &eaCuerpo82Ava = "";
     &eaCuerpo83Ava = "";
     &eaCuerpo84Ava = "";
     &eaCuerpo85Ava = "";
     &eaCuerpo86Ava = "";
     &eaCuerpo87Ava = "";
     &eaCuerpo88Ava = "";
     &eaCuerpo89Ava = "";
     &eaCuerpo90Ava = "";
     &eaCuerpo91Ava = "";
     &eaCuerpo92Ava = "";
     &eaCuerpo93Ava = "";
     &eaCuerpo94Ava = "";
     &eaCuerpo95Ava = "";
     &eaCuerpo96Ava = "";
     &eaCuerpo97Ava = "";
     &eaCuerpo98Ava = "";
     &eaCuerpo99Ava = "";


     nCodCliAnt = 0;
     aCodCli = "";
     aDirDestino = "";
     aBaseI = "";
     aCliInt = "";
     nHandleI = 0;

     nErrorEnv = 0;
     aAuxEstado = "";
     aInforme = "";
     nSwPie = 0;
     nNumCamp = 0;

     &enSwHaySelAva = 0;
     &eaAsuntoSel = "";

     nBotonAceptar   = -1;
     nBotonCancelar  = -1;
     nBotonEnvCorr   = 0;
     nBotonCanCorr   = 0;
     aID             = "";
     aQueBoton       = "";
     aQueUsu         = "";

     aTempo188 = "";
     &Tempo = "";

     nSwRamaEpisodio = 0;
     nBuscaCampo = 0;
     aNivel = "";
     nNivel = 0;
     aNodo = "";
     aEstoy = "";
     aDentro = "";
     &eaHistoriaBusca = "";
     &eaEpisodioBusca = "";

     nSwQuitaBotonAplica = 0;      ||Para que no muestre el boton de aplicar coleccion
     nSwModoVincula = 0;

     &eaTipoVincu = "";
     &eaValorVincu1 = "";
     &eaValorVincu2 = "";

     primero = "";
     aRegistros = "";
     nRegistros = 0;
     temporal1 = "";
     fich_alta = "";
     nSwHayExclu = 0;

     &enSwColeccionGrid = 0;

     ||Orden en ultimo nivel Arbol
     aOrden = "";
     nOrden = 0;
     nSwCampoNum = 0;
     nCampoOrden = 0;
     nSwCampoFecha = 0;
     aAuxOrden = "";
     aIniOrden = "";
     aFechaUno = "";
     fFechaUno = @;
     nFechaUno = 0;
     fFechaDos = @;
     aDia = "";
     aMes = "";
     aAnyo = "";
     aPilla = "";

     ||Autoplantilla
     aAux2 = "";
     nSwLogError = 0;
     nRegDocu = 0;
     aUbicacion = "";
     aFicheroTif = "";
     aMete31 = "";
     nVentz1 = 0;
     nContDos = 0;
     nContReal = 0;
     nCampo1 = 0;

     ||Borra los registros en el dpntm101
     aPathDatos101 = "";
     aEmpB = "";
     aBaseB = "";
     aMasB = "";
     aProcesoPI = "";

     &eaBorraCache = "";
     aCodigo9 = "";
     aUsuarioVista = "";

     &enNumRegFlow = 0;
     &enSituFlow = 0;
     &eaDesSituFlow = "";

     aFicheroOcr = "";
     aVacio25 = "";
     aZeta25 = "";
     nSwExisteOCR = 0;
     aCarpetaOrigen = "";
     aCarpetaDestino = "";
     aFicAux = "";

     &enAprobacion = 0;
     &eaPrograma = "";
     nSwIpAbogax = 0;
     aAlfaEsta = "";

     &eaOrigen = "";
     &eaDestino = "";

     nRegFactura = 0;
     aPrograma = "";
     {1}aLocal       = "";
     aBorra = "";
     aPath = "";
     &enEscaneo = 0;
     {7}aPopTria = "";
     aSele = "";
     &eaFicheroEscaner = "";
     aRuta = "";
     aProg = "";
     &eaDocCaptura = "";
     &enErrorCaptura = 0;
     &enNumRegistro = 0;

     aEjecuta = "";
     &enGrupoTres = 0;
     &enSubGTres = 0;
     &enTipoTres = 0;
     nElementos = 0;
     nHay = 0;
     nGrupoBucle = 0;
     nSubGruBucle = 0;
     aContenido = "";

     aAuxNom = "";
     nSwHayFlow = 0;
     nPasada = 0;
     nUsuarios = 0;
     &enNoClonarFlow = 0;
     aHora = "";
     nLinea = 0;
     nSitu = 0;
     aOriHis = "";
     aDesHis = "";
     nSalidaHis = 0;

     aDetalle = "";
     &enModoModiw006 = 0;

     nSwObligatorios  = 0;
     nSwArbolActivo   = 0;      ||Para indicar si estamos en Arbol o en Grid
     nEntroPDatos     = 0;
     nGrupoAra        = 0;
     nSubGrupoAra     = 0;
     nTipoAra         = 0;
     nConta           = 0;
     nGrupoAnt        = 0;
     nSubGruAnt       = 0;
     nTipoAnt         = 0;
     nGrupo           = 0;
     nSubGrupo        = 0;
     nTipo            = 0;
     nClaveAD1        = 0;
     nClaveAD3        = 0;
     fClaveAD2        = @;
     nSalida          = 0;
     nCorreoEnvOk     = 0;
     nSwHayDocs       = 0;
     nDesdeGrupo      = 0;
     nHastaGrupo      = 0;
     nDesdeSub        = 0;
     nHastaSub        = 0;
     nCampoD          = 0;
     nCampoH          = 0;
     nEstadoGrid      = -1;
     nVentm5          = -1;
     nVentaEA         = -1;
     nPos1            = 0;
     nPos2            = 0;
     nRango           = 0;
     nBotonBand       = 0;
     nBoton0_1        = 0;
     nBoton0_2        = 0;
     nBoton0_3        = 0;
     nBoton0_4        = 0;
     nBoton0_5        = 0;
     nBoton0_6        = 0;
     nBoton0_7        = 0;
     nBoton0_8        = -1;
     nBoton0_9        = -1;
     nBoton0_10       = -1;
     nBoton0_11       = -1;
     nBoton0_12       = -1;
     nBoton0_13       = -1;
     nBoton0_14       = -1;
     nBoton0_15       = 0;
     nBoton0_16       = -1;
     nBoton0_20       = 0;
     nBotonBuscaPac   = 0;
     nBoton0_abogax   = 0;
     nBtnUsu          = 0;
     nOpcion          = 0;
     nCargar          = 0;
     nPosi            = 0;
     nError           = 0;
     nNume            = 0;
     nBotonFoto       = 0;
     nVentana         = 0;
     nSwQuedan        = 0;
     nBorrado         = 0;
     nPosDRamas       = 0;
     nPosHRamas       = 0;
     nPosDGrid        = 0;
     nPosHGrid        = 0;
     nGridTree        = -1;
     nBtnGuarda       = -1;
     nCliente         = 0;
     nOk              = 0;
     aFechaSis        = "";
     aAAAAMM          = "";
     aTipoVista       = "";
     aUsuario         = "";
     aAuxTxt          = "";
     aGuarda          = "";
     aAux             = "";
     aLabel           = "";
     aMensaje         = "";
     aEsc1            = "";
     aEsc2            = "";
     aRetu            = "";
     aTecla           = "";
     aAlfa            = "";
     aAlfa1           = "";
     aAlfa2           = "";
     aAlfa3           = "";
     aAlfa4           = "";
     aAlfa5           = "";
     aBeta            = "";
     aBeta1           = "";
     aBeta2           = "";
     aBeta3           = "";
     aBeta4           = "";
     aBeta5           = "";
     aAlfa6           = "";
     aOrigen          = "";
     aDestino         = "";
     aIPRemoto        = "";
     aBase            = "";
     aMas             = "";
     aBusca           = "";
     aRefresca        = "";
     aTexto           = "";
     aFechaGuarda     = "";
     aDirLocal        = "";
     aExt             = "";
     aFotoOrigen      = "";
     aFotoDestino     = "";
     aFoto            = "";
     aDocRemoto       = "";
     aDocServidor     = "";
     aQueQuiero       = "";
     aVista           = "";
     aDUsuario        = "";
     aHUsuario        = "zzzzzzzzzz";
     aLista           = "";
     aFic             = "";
     aDCarp1          = "";
     aDCarp2          = "";
     aDCarp3          = "";
     aDCarp4          = "";
     aDCarp5          = "";
     aDCarp6          = "";
     aHCarp1          = "";
     aHCarp2          = "";
     aHCarp3          = "";
     aHCarp4          = "";
     aHCarp5          = "";
     aHCarp6          = "";
     aTextoFoco       = "";
     aTextoFoco1      = "";
     aTextoFoco2      = "";
     aTextoFoco3      = "";
     aTextoFoco4      = "";
     aTextoFoco5      = "";
     aTextoFoco6      = "";
     aCodRama         = "";
     aCodRama1        = "";
     aCodRama2        = "";
     aCodRama3        = "";
     aCodRama4        = "";
     aCodRama5        = "";
     aCodRama6        = "";

     fFecha           = @;
     fFecha1          = @;
     fFecha2          = @;

     {1}aContiene     = "";

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     {200}aPopup      = "";
     {200}aOpcion     = "";
     {7}aPopCorreo    = "";
     {4}aPopAsociar   = "";

     &enBusqueda      = 0;
     &enGrid          = 0;
     &enModo          = 0;
     &eaClave         = "";
     &enPassword      = 0;
     &enDocumento     = 0;
     &enDocuPpal      = 0;
     &eaFichero       = "";
     &enError         = 0;
     &enGrupo         = 0;
     &enSubGrupo      = 0;
     &enTipo          = 0;
     &enSwCargaDef    = 0;
     &enNumSeleADC    = 0;
     &enSwDefSele     = 0;
     &enMueveDoc      = 0;
     &enSwError       = 0;
     &enGrupoPV       = 0;
     &enSubGrupoPV    = 0;
     &enTipoPV        = 0;
     &enSwPosicionate = 0
     &enErrorCorreo   = 0;
     &eaDirDestino    = "";
     &enSwADContD     = 0;
     &eaNomDef        = "";
     &eaClaveAD1      = "";
     &eaClaveAD2      = "";
     &eaClaveAD3      = "";
     &enSw999CargaDef = 0;
     &enEstoyBoton    = 0;
     &enSwADConta     = 0;
     &enEmpADConta    = 0;
     &enEjeADConta    = 0;
     &enSwPantaDiv    = 0;
     &enBotonADC1     = 0;
     &enBotonADC2     = 0;
     &enBotonADC3     = 0;
     &enBotonADC4     = 0;
     &enBotonADC5     = 0;
     &enBotonADC6     = 0;
     &enBotonADC7     = 0;
     &enBotonADC8     = 0;
     &enBotonADC9     = 0;
     &enBotonADC10    = 0;
     &enLinea005      = 0;
     &eaNifTrab       = "";
     &enSwErrorModiw006 = 0;
     &eaFoco          = "";
     &enArbol         = 0;
|FIN;

|INCLUYE incvista;

|PROCESO Tipo12w087; |TIPO 12;
     |SI FSalida = 7; |ACABA; |FINSI;

     eaAsuntoAva = #dsarw087#3;
     |QBF eaAsuntoAva;
     eaCuerpo1Ava = #dsarw087#4;
     |QBF eaCuerpo1Ava;
     eaCuerpo2Ava = #dsarw087#5;
     |QBF eaCuerpo2Ava;
     eaCuerpo3Ava = #dsarw087#6;
     |QBF eaCuerpo3Ava;
     eaCuerpo4Ava = #dsarw087#7;
     |QBF eaCuerpo4Ava;
     eaCuerpo5Ava = #dsarw087#8;
     |QBF eaCuerpo5Ava;
     eaCuerpo6Ava = #dsarw087#9;
     |QBF eaCuerpo6Ava;
     eaCuerpo7Ava = #dsarw087#10;
     |QBF eaCuerpo7Ava;
     eaCuerpo8Ava = #dsarw087#11;
     |QBF eaCuerpo8Ava;
     eaCuerpo9Ava = #dsarw087#12;
     |QBF eaCuerpo9Ava;
     eaCuerpo10Ava = #dsarw087#13;
     |QBF eaCuerpo10Ava;
     eaCuerpo11Ava = #dsarw087#14;
     |QBF eaCuerpo11Ava;
     eaCuerpo12Ava = #dsarw087#15;
     |QBF eaCuerpo12Ava;
     eaCuerpo13Ava = #dsarw087#16;
     |QBF eaCuerpo13Ava;
     eaCuerpo14Ava = #dsarw087#17;
     |QBF eaCuerpo14Ava;
     eaCuerpo15Ava = #dsarw087#18; |QBF eaCuerpo15Ava;
     eaCuerpo16Ava = #dsarw087#19; |QBF eaCuerpo16Ava;
     eaCuerpo17Ava = #dsarw087#20; |QBF eaCuerpo17Ava;
     eaCuerpo18Ava = #dsarw087#21; |QBF eaCuerpo18Ava;
     eaCuerpo19Ava = #dsarw087#22; |QBF eaCuerpo19Ava;
     eaCuerpo20Ava = #dsarw087#23; |QBF eaCuerpo20Ava;
     eaCuerpo21Ava = #dsarw087#24; |QBF eaCuerpo21Ava;
     eaCuerpo22Ava = #dsarw087#25; |QBF eaCuerpo22Ava;
     eaCuerpo23Ava = #dsarw087#26; |QBF eaCuerpo23Ava;
     eaCuerpo24Ava = #dsarw087#27; |QBF eaCuerpo24Ava;
     eaCuerpo25Ava = #dsarw087#28; |QBF eaCuerpo25Ava;
     eaCuerpo26Ava = #dsarw087#29; |QBF eaCuerpo26Ava;
     eaCuerpo27Ava = #dsarw087#30; |QBF eaCuerpo27Ava;
     eaCuerpo28Ava = #dsarw087#31; |QBF eaCuerpo28Ava;
     eaCuerpo29Ava = #dsarw087#32; |QBF eaCuerpo29Ava;
     eaCuerpo30Ava = #dsarw087#33; |QBF eaCuerpo30Ava;
     eaCuerpo31Ava = #dsarw087#34; |QBF eaCuerpo31Ava;
     eaCuerpo32Ava = #dsarw087#35; |QBF eaCuerpo32Ava;
     eaCuerpo33Ava = #dsarw087#36; |QBF eaCuerpo33Ava;
     eaCuerpo34Ava = #dsarw087#37; |QBF eaCuerpo34Ava;
     eaCuerpo35Ava = #dsarw087#38; |QBF eaCuerpo35Ava;
     eaCuerpo36Ava = #dsarw087#39; |QBF eaCuerpo36Ava;
     eaCuerpo37Ava = #dsarw087#40; |QBF eaCuerpo37Ava;
     eaCuerpo38Ava = #dsarw087#41; |QBF eaCuerpo38Ava;
     eaCuerpo39Ava = #dsarw087#42; |QBF eaCuerpo39Ava;
     eaCuerpo40Ava = #dsarw087#43; |QBF eaCuerpo40Ava;
     eaCuerpo41Ava = #dsarw087#44; |QBF eaCuerpo41Ava;
     eaCuerpo42Ava = #dsarw087#45; |QBF eaCuerpo42Ava;
     eaCuerpo43Ava = #dsarw087#46; |QBF eaCuerpo43Ava;
     eaCuerpo44Ava = #dsarw087#47; |QBF eaCuerpo44Ava;
     eaCuerpo45Ava = #dsarw087#48; |QBF eaCuerpo45Ava;
     eaCuerpo46Ava = #dsarw087#49; |QBF eaCuerpo46Ava;
     eaCuerpo47Ava = #dsarw087#50; |QBF eaCuerpo47Ava;
     eaCuerpo48Ava = #dsarw087#51; |QBF eaCuerpo48Ava;
     eaCuerpo49Ava = #dsarw087#52; |QBF eaCuerpo49Ava;
     eaCuerpo50Ava = #dsarw087#53; |QBF eaCuerpo50Ava;
     eaCuerpo51Ava = #dsarw087#54; |QBF eaCuerpo51Ava;
     eaCuerpo52Ava = #dsarw087#55; |QBF eaCuerpo52Ava;
     eaCuerpo53Ava = #dsarw087#56; |QBF eaCuerpo53Ava;
     eaCuerpo54Ava = #dsarw087#57; |QBF eaCuerpo54Ava;
     eaCuerpo55Ava = #dsarw087#58; |QBF eaCuerpo55Ava;
     eaCuerpo56Ava = #dsarw087#59; |QBF eaCuerpo56Ava;
     eaCuerpo57Ava = #dsarw087#60; |QBF eaCuerpo57Ava;
     eaCuerpo58Ava = #dsarw087#61; |QBF eaCuerpo58Ava;
     eaCuerpo59Ava = #dsarw087#62; |QBF eaCuerpo59Ava;
     eaCuerpo60Ava = #dsarw087#63; |QBF eaCuerpo60Ava;
     eaCuerpo61Ava = #dsarw087#64; |QBF eaCuerpo61Ava;
     eaCuerpo62Ava = #dsarw087#65; |QBF eaCuerpo62Ava;
     eaCuerpo63Ava = #dsarw087#66; |QBF eaCuerpo63Ava;
     eaCuerpo64Ava = #dsarw087#67; |QBF eaCuerpo64Ava;
     eaCuerpo65Ava = #dsarw087#68; |QBF eaCuerpo65Ava;
     eaCuerpo66Ava = #dsarw087#69; |QBF eaCuerpo66Ava;
     eaCuerpo67Ava = #dsarw087#70; |QBF eaCuerpo67Ava;
     eaCuerpo68Ava = #dsarw087#71; |QBF eaCuerpo68Ava;
     eaCuerpo69Ava = #dsarw087#72; |QBF eaCuerpo69Ava;
     eaCuerpo70Ava = #dsarw087#73; |QBF eaCuerpo70Ava;
     eaCuerpo71Ava = #dsarw087#74; |QBF eaCuerpo71Ava;
     eaCuerpo72Ava = #dsarw087#75; |QBF eaCuerpo72Ava;
     eaCuerpo73Ava = #dsarw087#76; |QBF eaCuerpo73Ava;
     eaCuerpo74Ava = #dsarw087#77; |QBF eaCuerpo74Ava;
     eaCuerpo75Ava = #dsarw087#78; |QBF eaCuerpo75Ava;
     eaCuerpo76Ava = #dsarw087#79; |QBF eaCuerpo76Ava;
     eaCuerpo77Ava = #dsarw087#80; |QBF eaCuerpo77Ava;
     eaCuerpo78Ava = #dsarw087#81; |QBF eaCuerpo78Ava;
     eaCuerpo79Ava = #dsarw087#82; |QBF eaCuerpo79Ava;
     eaCuerpo80Ava = #dsarw087#83; |QBF eaCuerpo80Ava;
     eaCuerpo81Ava = #dsarw087#84; |QBF eaCuerpo81Ava;
     eaCuerpo82Ava = #dsarw087#85; |QBF eaCuerpo82Ava;
     eaCuerpo83Ava = #dsarw087#86; |QBF eaCuerpo83Ava;
     eaCuerpo84Ava = #dsarw087#87; |QBF eaCuerpo84Ava;
     eaCuerpo85Ava = #dsarw087#88; |QBF eaCuerpo85Ava;
     eaCuerpo86Ava = #dsarw087#89; |QBF eaCuerpo86Ava;
     eaCuerpo87Ava = #dsarw087#90; |QBF eaCuerpo87Ava;
     eaCuerpo88Ava = #dsarw087#91; |QBF eaCuerpo88Ava;
     eaCuerpo89Ava = #dsarw087#92; |QBF eaCuerpo89Ava;
     eaCuerpo90Ava = #dsarw087#93; |QBF eaCuerpo90Ava;
     eaCuerpo91Ava = #dsarw087#94; |QBF eaCuerpo91Ava;
     eaCuerpo92Ava = #dsarw087#95; |QBF eaCuerpo92Ava;
     eaCuerpo93Ava = #dsarw087#96; |QBF eaCuerpo93Ava;
     eaCuerpo94Ava = #dsarw087#97; |QBF eaCuerpo94Ava;
     eaCuerpo95Ava = #dsarw087#98; |QBF eaCuerpo95Ava;
     eaCuerpo96Ava = #dsarw087#99; |QBF eaCuerpo96Ava;
     eaCuerpo97Ava = #dsarw087#100; |QBF eaCuerpo97Ava;
     eaCuerpo98Ava = #dsarw087#101; |QBF eaCuerpo98Ava;
     eaCuerpo99Ava = #dsarw087#102; |QBF eaCuerpo99Ava;

     |SI eaAsuntoAva = "";
          aMensaje = "0000NTexto del Asunto VACIO. Esta seguro?";
          |CONFI aMensaje;
          |SI FSalida ! 0;
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI eaCuerpo1Ava = ""; |Y eaCuerpo2Ava = ""; |Y eaCuerpo3Ava = "";
      |Y eaCuerpo4Ava = ""; |Y eaCuerpo5Ava = ""; |Y eaCuerpo6Ava = "";
      |Y eaCuerpo7Ava = ""; |Y eaCuerpo8Ava = ""; |Y eaCuerpo9Ava = "";
      |Y eaCuerpo10Ava = ""; |Y eaCuerpo11Ava = ""; |Y eaCuerpo12Ava = "";
      |Y eaCuerpo13Ava = ""; |Y eaCuerpo14Ava = ""; |Y eaCuerpo15Ava = "";
      |Y eaCuerpo16Ava = ""; |Y eaCuerpo17Ava = ""; |Y eaCuerpo18Ava = "";
      |Y eaCuerpo19Ava = ""; |Y eaCuerpo20Ava = ""; |Y eaCuerpo21Ava = "";
      |Y eaCuerpo22Ava = ""; |Y eaCuerpo23Ava = ""; |Y eaCuerpo24Ava = "";
      |Y eaCuerpo25Ava = ""; ||Si los primeros 25 estan vacios. Para mi esta TODO vacio.
          aMensaje = "0000NTexto del Cuerpo del Correo VACIO. Esta seguro?";
          |CONFI aMensaje;
          |SI FSalida ! 0;
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ControlPermisos;
     |SI #dsarz010#3 = "N";  |ESTADO_CONTROL nBoton0_14, "DISABLE";  |FINSI;
     |SI #dsarz010#4 = "N";  |ESTADO_CONTROL nBoton0_7,  "DISABLE";  |FINSI;
     |SI #dsarz010#5 = "N";  |ESTADO_CONTROL nBoton0_6,  "DISABLE";  |FINSI;
     |SI #dsarz010#6 = "N";  |ESTADO_CONTROL nBoton0_3,  "DISABLE";  |FINSI;
     |SI #dsarz010#7 = "N";  |ESTADO_CONTROL nBoton0_2,  "DISABLE";  |FINSI;
     |SI #dsarz010#8 = "N";  |ESTADO_CONTROL nBoton0_13, "DISABLE";  |FINSI;
     |SI #dsarz010#9 = "N";  |ESTADO_CONTROL nBoton0_1,  "DISABLE";  |FINSI;
     |SI #dsarz010#14 = "N"; |ESTADO_CONTROL nBoton0_15, "DISABLE";  |FINSI;
     |SI #dsarz010#15 = "N"; |ESTADO_CONTROL nBoton0_16, "DISABLE";  |FINSI;
|FPRC;

|PROCESO ControlaBotonesUsuario;

     |SI nSwModoCapDoc = 1;
          |ESTADO_CONTROL nBoton0_15, "DISABLE";
          |SI #dsarz010#14 = "S";  |ESTADO_CONTROL nBoton0_15, "ENABLE";  |FINSI;

          |ESTADO_CONTROL nBoton0_20, "ENABLE";

          |ACABA;
     |FINSI;

     |ESTADO_CONTROL nBoton0_1,  "DISABLE";
     |ESTADO_CONTROL nBoton0_2,  "DISABLE";
     |ESTADO_CONTROL nBoton0_3,  "DISABLE";
     |ESTADO_CONTROL nBoton0_6,  "DISABLE";
     |ESTADO_CONTROL nBoton0_7,  "DISABLE";
     |ESTADO_CONTROL nBoton0_13, "DISABLE";
     |ESTADO_CONTROL nBoton0_14, "DISABLE";
     |ESTADO_CONTROL nBoton0_15, "DISABLE";
     |ESTADO_CONTROL nBoton0_16, "DISABLE";

     |SI aFichero = "";  |ACABA;  |FINSI;

     |SI #dsarz010#9  = "S";  |ESTADO_CONTROL nBoton0_1,  "ENABLE";  |FINSI;
     |SI #dsarz010#7  = "S";  |ESTADO_CONTROL nBoton0_2,  "ENABLE";  |FINSI;
     |SI #dsarz010#6  = "S";  |ESTADO_CONTROL nBoton0_3,  "ENABLE";  |FINSI;
     |SI #dsarz010#5  = "S";  |ESTADO_CONTROL nBoton0_6,  "ENABLE";  |FINSI;
     |SI #dsarz010#4  = "S";  |ESTADO_CONTROL nBoton0_7,  "ENABLE";  |FINSI;
     |SI #dsarz010#8  = "S";  |ESTADO_CONTROL nBoton0_13, "ENABLE";  |FINSI;
     |SI #dsarz010#3  = "S";  |ESTADO_CONTROL nBoton0_14, "ENABLE";  |FINSI;
     |SI #dsarz010#14 = "S";  |ESTADO_CONTROL nBoton0_15, "ENABLE";  |FINSI;

     |SI #dsarz010#15 = "S";
          |SI enSwHaySelAva = 1; |O enSwModoClinica = 1;
              |ESTADO_CONTROL nBoton0_16, "DISABLE";
          |SINO;
              |ESTADO_CONTROL nBoton0_16, "ENABLE";
          |FINSI;
     |FINSI;

     |SI #dsarz010#7  = "S";  nEntroPDatos = 1; |FINSI;
|FPRC;

|PROCESO EventoPanta1;
     |SI #dsarm005#0 = 0;  |ACABA;  |FINSI;

     |SI FSalida = 1;  |O FSalida = 2;
         |SELECT #1#dsarm005;
         |LEE 000#dsarm005.=;

         enLinea005 = #dsarm005#0;

         aFichero = #dsarm005#7;              |QBF aFichero;
         aFichero = aFichero + #dsarm005#9;   |QBF aFichero;

         |HAZ ControlaBotonesUsuario;
     |FINSI;

     |SI FSalida = 4;
         |SI nSwModoCapDoc = 1;
              |LEE 000#dsarm005.=;
              |SI FSalida = 0;
                   |HAZ Boton0_20;
              |FINSI;
         |SINO;
              |SI #dsarz010#7 = "S";
                   |LEE 000#dsarm005.=;
                   |SI FSalida = 0;
                       |HAZ Boton0_2;
                   |FINSI;
              |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO EventoPanta905;
     |SI #dsarm005@#0 = 0;  |ACABA;  |FINSI;

     |SI FSalida = 1;  |O FSalida = 2;
         |SELECT #1#dsarm005@;
         |LEE 000#dsarm005@.=;
         |SI FSalida ! 0;  |DDEFECTO #dsarm005@;  |FINSI;

         enLinea005 = #dsarm005@#0;

         aFichero = #dsarm005@#7;              |QBF aFichero;
         aFichero = aFichero + #dsarm005@#9;   |QBF aFichero;

         |HAZ ControlaBotonesUsuario;
     |FINSI;

     |SI FSalida = 4;
         |SI #dsarz010#7 = "S";
              |LEE 000#dsarm005@.=;
              |SI FSalida = 0;
                  |HAZ Boton0_2;
              |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

||Bandeja errores reconocimiento OCR
|PROCESO BajaPanta0_2;
     |SELECT #2#dsarm005;
     #dsarm005#1 = enGrupoErrOCR;
     #dsarm005#2 = enSubGrupoErrOCR;
     #dsarm005#3 = enTipoErrOCR;
     #dsarm005#0 = 000000001;
|FPRC;

|PROCESO AltaPanta0_2;
     #dsarm005#1 = enGrupoErrOCR;
     #dsarm005#2 = enSubGrupoErrOCR;
     #dsarm005#3 = enTipoErrOCR;
     #dsarm005#0 = 999999999;
|FPRC;

|| ------------------------------------------------------------------------
|| PROCESOS DE ASIGNACION DE MENUS
|| ------------------------------------------------------------------------
|PROCESO BajaPanta0_10;
     |SELECT #10#dsarm005;
     #dsarm005#67 = enEmpADConta;
     #dsarm005#68 = enEjeADConta;
     #dsarm005#69 = eaClaveAD1;
     #dsarm005#70 = eaClaveAD2;
     #dsarm005#71 = eaClaveAD3;
     #dsarm005#0  = 1;
|FPRC;

|PROCESO AltaPanta0_10;
     #dsarm005#67 = enEmpADConta;
     #dsarm005#68 = enEjeADConta;
     #dsarm005#69 = eaClaveAD1;
     #dsarm005#70 = eaClaveAD2;
     #dsarm005#71 = eaClaveAD3;
     #dsarm005#0  = 999999999;
|FPRC;

|PROCESO BajaPanta0_11;
     |SELECT #11#dsarm005;
     #dsarm005#67 = enEmpADConta;
     #dsarm005#68 = enEjeADConta;
     #dsarm005#72 = eaClaveAD1;
     #dsarm005#73 = eaClaveAD2;
|FPRC;

|PROCESO AltaPanta0_11;
     #dsarm005#67 = enEmpADConta;
     #dsarm005#68 = enEjeADConta;
     #dsarm005#72 = eaClaveAD1;
     #dsarm005#73 = eaClaveAD2;
|FPRC;

|PROCESO BajaPanta0_11_cainliva;
     |SELECT #11#dsarm005;
     #dsarm005#67 = enEmpADConta;
     #dsarm005#68 = enEjeADConta;
     #dsarm005#72 = eaClaveAD1;
     nRegFactura = 100000000 + (eaClaveAD1 * 1000) + eaClaveAD2;
     #dsarm005#73 = nRegFactura;
|FPRC;

|PROCESO AltaPanta0_11_cainliva;
     #dsarm005#67 = enEmpADConta;
     #dsarm005#68 = enEjeADConta;
     #dsarm005#72 = eaClaveAD1;
     nRegFactura = 100000000 + (eaClaveAD1 * 1000) + eaClaveAD2;
     #dsarm005#73 = nRegFactura;
|FPRC;


|PROCESO BajaPanta0_12;
     |SELECT #12#dsarm005;
     #dsarm005#67 = enEmpADConta;
     #dsarm005#68 = enEjeADConta;
     #dsarm005#74 = eaClaveAD1;
|FPRC;

|PROCESO AltaPanta0_12;
     #dsarm005#67 = enEmpADConta;
     #dsarm005#68 = enEjeADConta;
     #dsarm005#74 = eaClaveAD1;
|FPRC;

|PROCESO BajaPanta0_13;
     |SELECT #13#dsarm005;
     #dsarm005#75 = eaClaveAD1;
     #dsarm005#76 = eaClaveAD2;
|FPRC;

|PROCESO AltaPanta0_13;
     #dsarm005#75 = eaClaveAD1;
     #dsarm005#76 = eaClaveAD2;
|FPRC;

|PROCESO BajaPanta0_6;
     |SELECT #6#dsarm005;
     #dsarm005#1 = nDesdeGrupo;
     #dsarm005#2 = nDesdeSub;
     #dsarm005#4 = aDFecha;
     #dsarm005#6 = aDUsuario;
     #dsarm005#0 = 1;
|FPRC;

|PROCESO AltaPanta0_6;
     #dsarm005#1 = nDesdeGrupo;
     #dsarm005#2 = nDesdeSub;
     #dsarm005#4 = aHFecha;
     #dsarm005#6 = aHUsuario;
     #dsarm005#0 = 999999999;
|FPRC;

|PROCESO BajaPanta0_14;
     |SELECT #14#dsarm005;
     #dsarm005#67 = enEmpADConta;
     #dsarm005#68 = 0;
     #dsarm005#1 = nDesdeGrupo;
     #dsarm005#2 = nDesdeSub;
     #dsarm005#4 = aDFecha;
     #dsarm005#0 = 1;
|FPRC;

|PROCESO AltaPanta0_14;
     #dsarm005#67 = enEmpADConta;
     #dsarm005#68 = 9;
     #dsarm005#1 = nDesdeGrupo;
     #dsarm005#2 = nDesdeSub;
     #dsarm005#4 = aHFecha;
     #dsarm005#0 = 999999999;
|FPRC;

|PROCESO BajaPanta0_7;
     |SELECT #7#dsarm005;
     #dsarm005#94 = "S";
     #dsarm005#8  = #dpntm001#0;
     #dsarm005#4 = aDFecha;
     #dsarm005#0  = 1;
|FPRC;

|PROCESO AltaPanta0_7;
     #dsarm005#94 = "S";
     #dsarm005#8  = #dpntm001#0;
     #dsarm005#4 = aHFecha;
     #dsarm005#0 = 999999999;
|FPRC;

|PROCESO BajaPanta0_8;
     |SELECT #8#dsarm005;
     #dsarm005#0 = 1;
     #dsarm005#4 = aDFecha;
     #dsarm005#5 = "";
|FPRC;

|PROCESO AltaPanta0_8;
     #dsarm005#0 = 999999999;
     #dsarm005#4 = aHFecha;
     #dsarm005#5 = "zzzzz";
|FPRC;

|PROCESO BajaPanta0_3;
     |SELECT #3#dsarm005;
     #dsarm005#8 = aParametro;
     #dsarm005#4 = aDFecha;
     #dsarm005#5 = "";
     #dsarm005#0 = 1;
|FPRC;

|PROCESO AltaPanta0_3;
     #dsarm005#8 = aParametro;
     #dsarm005#4 = aHFecha;
     #dsarm005#5 = "zzzzz";
     #dsarm005#0 = 999999999;
|FPRC;

|PROCESO BajaPanta0_4;
     |SELECT #4#dsarm005;
     #dsarm005#10 = aParametro;
     #dsarm005#4 = aDFecha;
     #dsarm005#5 = "";
     #dsarm005#0  = 1;
|FPRC;

|PROCESO AltaPanta0_4;
     #dsarm005#10 = aParametro;
     #dsarm005#4 = aHFecha;
     #dsarm005#5 = "zzzzz";
     #dsarm005#0  = 999999999;
|FPRC;

|PROCESO BajaPanta905_1;
     #dsarm005@#0 = 1;
|FPRC;

|PROCESO AltaPanta905_1;
     #dsarm005@#0 = 999999999;
|FPRC;

|PROCESO BajaPanta905_6;
     #dsarm005@#0 = 1;
     #dsarm005@#1 = nDesdeGrupo;
     #dsarm005@#2 = nDesdeSub;
     #dsarm005@#4 = aDFecha;
     #dsarm005@#6 = aDUsuario;
|FPRC;

|PROCESO AltaPanta905_6;
     #dsarm005@#0 = 999999999;
     #dsarm005@#1 = nHastaGrupo;
     #dsarm005@#2 = nHastaSub;
     #dsarm005@#4 = aHFecha;
     #dsarm005@#6 = aHUsuario;
|FPRC;

|PROCESO BajaPanta905_14;
     #dsarm005@#67 = enEmpADConta;
     #dsarm005@#68 = enEjeADConta;
     #dsarm005@#1 = nDesdeGrupo;
     #dsarm005@#2 = nDesdeSub;
     #dsarm005@#4 = aDFecha;
     #dsarm005@#0 = 1;
|FPRC;

|PROCESO AltaPanta905_14;
     #dsarm005@#67 = enEmpADConta;
     #dsarm005@#68 = enEjeADConta;
     #dsarm005@#1 = nHastaGrupo;
     #dsarm005@#2 = nHastaSub;
     #dsarm005@#4 = aHFecha;
     #dsarm005@#0 = 999999999;
|FPRC;

|PROCESO BajaPanta905_7;
     #dsarm005@#94 = "S";
     #dsarm005@#8  = #dpntm001#0;
     #dsarm005@#4 = aDFecha;
     #dsarm005@#0  = 1;
|FPRC;

|PROCESO AltaPanta905_7;
     #dsarm005@#94 = "S";
     #dsarm005@#8  = #dpntm001#0;
     #dsarm005@#4 = aHFecha;
     #dsarm005@#0 = 999999999;
|FPRC;

|PROCESO BajaPanta905_8;
     #dsarm005@#0 = 1;
     #dsarm005@#4 = aDFecha;
     #dsarm005@#5 = "";
|FPRC;

|PROCESO AltaPanta905_8;
     #dsarm005@#0 = 999999999;
     #dsarm005@#4 = aHFecha;
     #dsarm005@#5 = "zzzzz";
|FPRC;

|PROCESO BajaPanta905_3;
     #dsarm005@#8 = aParametro;
     #dsarm005@#4 = aDFecha;
     #dsarm005@#5 = "";
     #dsarm005@#0 = 1;
|FPRC;

|PROCESO AltaPanta905_3;
     #dsarm005@#8 = aParametro;
     #dsarm005@#4 = aHFecha;
     #dsarm005@#5 = "zzzzz";
     #dsarm005@#0 = 999999999;
|FPRC;

|PROCESO BajaPanta905_5;
     #dsarm005@#10 = aParametro;
     #dsarm005@#4 = aDFecha;
     #dsarm005@#5 = "";
     #dsarm005@#0  = 1;
|FPRC;

|PROCESO AltaPanta905_5;
     #dsarm005@#10 = aParametro;
     #dsarm005@#4 = aHFecha;
     #dsarm005@#5 = "zzzzz";
     #dsarm005@#0  = 999999999;
|FPRC;

|PROCESO BajaPanta905_10;
     #dsarm005@#67 = enEmpADConta;
     #dsarm005@#68 = enEjeADConta;
     #dsarm005@#69 = eaClaveAD1;
     #dsarm005@#70 = eaClaveAD2;
     #dsarm005@#71 = eaClaveAD3;
|FPRC;

|PROCESO AltaPanta905_10;
     #dsarm005@#67 = enEmpADConta;
     #dsarm005@#68 = enEjeADConta;
     #dsarm005@#69 = eaClaveAD1;
     #dsarm005@#70 = eaClaveAD2;
     #dsarm005@#71 = eaClaveAD3;
|FPRC;

|PROCESO BajaPanta905_11;
     #dsarm005@#67 = enEmpADConta;
     #dsarm005@#68 = enEjeADConta;
     #dsarm005@#72 = eaClaveAD1;
     #dsarm005@#73 = eaClaveAD2;
|FPRC;

|PROCESO AltaPanta905_11;
     #dsarm005@#67 = enEmpADConta;
     #dsarm005@#68 = enEjeADConta;
     #dsarm005@#72 = eaClaveAD1;
     #dsarm005@#73 = eaClaveAD2;
|FPRC;

|PROCESO BajaPanta905_11_cainliva;
     #dsarm005@#67 = enEmpADConta;
     #dsarm005@#68 = enEjeADConta;
     #dsarm005@#72 = eaClaveAD1;
     nRegFactura = 100000000 + (eaClaveAD1 * 1000) + eaClaveAD2;
     #dsarm005@#73 = nRegFactura;
|FPRC;

|PROCESO AltaPanta905_11_cainliva;
     #dsarm005@#67 = enEmpADConta;
     #dsarm005@#68 = enEjeADConta;
     #dsarm005@#72 = eaClaveAD1;
     nRegFactura = 100000000 + (eaClaveAD1 * 1000) + eaClaveAD2;
     #dsarm005@#73 = nRegFactura;
|FPRC;

|PROCESO BajaPanta905_12;
     #dsarm005@#67 = enEmpADConta;
     #dsarm005@#68 = enEjeADConta;
     #dsarm005@#74 = eaClaveAD1;
|FPRC;

|PROCESO AltaPanta905_12;
     #dsarm005@#67 = enEmpADConta;
     #dsarm005@#68 = enEjeADConta;
     #dsarm005@#74 = eaClaveAD1;
|FPRC;

|PROCESO BajaPanta905_13;
     #dsarm005@#75 = eaClaveAD1;
     #dsarm005@#76 = eaClaveAD2;
|FPRC;

|PROCESO AltaPanta905_13;
     #dsarm005@#75 = eaClaveAD1;
     #dsarm005@#76 = eaClaveAD2;
|FPRC;

|PROCESO GridFicheroEntero;
     |SI #dsarm001#8 = "N";
         |C_V #dsarm005#2,  1, "N";
         |C_V #dsarm005#3,  1, "N";
         |C_V #dsarm005#45, 1, "N";
         |C_V #dsarm005#46, 1, "N";
     |FINSI;

     |SI enLABORAL = 1;
          eaNifTrab = aParametro;
          |HAZ CargaSqlLaboral;
          |HAZ GridFichero905;
          |ACABA;
     |FINSI;

     |ABRE #dsarm005;
     |SI aParametro = "";
         |SI enSwADConta = 1;
              |SI #dsarm001#24 = "S";
                   |LINEAL_SIMPLE #14#dsarm005, nRango, nPos1, nPos2, BajaPanta0_14, AltaPanta0_14, EventoPanta1;
              |SINO;
                   |SI eaNomDef ! "cainliva";
                       |LINEAL_SIMPLE #6#dsarm005, nRango, nPos1, nPos2, BajaPanta0_6, AltaPanta0_6, EventoPanta1;
                   |SINO;
                       |LINEAL_SIMPLE #6#dsarm005, nRango, nPos1, nPos2, BajaPanta0_6, AltaPanta0_6, EventoCALINIVA;
                   |FINSI;
              |FINSI;
         |FINSI;

         |SI enSwADConta = 0; |Y enSwADContD = 1;
             |SI eaNomDef = "camaasic"; |O eaNomDef = "camaasil";
                 |LINEAL_SIMPLE #10#dsarm005, nRango, nPos1, nPos2, BajaPanta0_10, AltaPanta0_10, EventoPanta1;
             |FINSI;

             |SI eaNomDef = "camaniva";
                 |LINEAL_SIMPLE #11#dsarm005, nRango, nPos1, nPos2, BajaPanta0_11, AltaPanta0_11, EventoPanta1;
             |FINSI;

             |SI eaNomDef = "cainliva";
                 |LINEAL_SIMPLE #11#dsarm005, nRango, nPos1, nPos2, BajaPanta0_11_cainliva, AltaPanta0_11_cainliva, EventoPanta1;
             |FINSI;

             |SI eaNomDef = "cacuenta";
                 |LINEAL_SIMPLE #12#dsarm005, nRango, nPos1, nPos2, BajaPanta0_12, AltaPanta0_12, EventoPanta1;
             |FINSI;

             |SI eaNomDef = "dsmom041"; |O eaNomDef = "dsmom042";
                 |LINEAL_SIMPLE #13#dsarm005, nRango, nPos1, nPos2, BajaPanta0_13, AltaPanta0_13, EventoPanta1;
             |FINSI;
         |FINSI;

         |SI enDESPANET = 1;
             |LINEAL_SIMPLE #7#dsarm005, nRango, nPos1, nPos2, BajaPanta0_7, AltaPanta0_7, EventoPanta1;
         |FINSI;

         |SI enSwBandejaErrOCR = 1;
             |LINEAL_SIMPLE #2#dsarm005, nRango, nPos1, nPos2, BajaPanta0_2, AltaPanta0_2, EventoPanta1;
         |FINSI;

         |SI enSwADConta = 0; |Y enSwADContD = 0;  |Y enDESPANET = 0; |Y enSwBandejaErrOCR = 0;
             |LINEAL_SIMPLE #8#dsarm005, nRango, nPos1, nPos2, BajaPanta0_8, AltaPanta0_8, EventoPanta1;
         |FINSI;
     |SINO;
         aAlfa = aParametro % 0;
         |SI aAlfa = "5";
             |LINEAL_SIMPLE #3#dsarm005, nRango, nPos1, nPos2, BajaPanta0_3, AltaPanta0_3, EventoPanta1;
         |SINO;
             |LINEAL_SIMPLE #4#dsarm005, nRango, nPos1, nPos2, BajaPanta0_4, AltaPanta0_4, EventoPanta1;
         |FINSI;
         nSwQuitaBotonAplica = 1;
     |FINSI;

     enGrid      = FSalida;
     nEstadoGrid = FSalida;
     nFichero    = 0;

     |FOCOTECLADO enGrid;
|FPRC;

|PROCESO GridFicheroBusqueda;
     |ABRE #dsarm005@;
     |LEE 000#dsarm005@.p;

     |SI aParametro = "";
         |SI enSwADConta = 1;
             |SI #dsarm001#24 = "S";
                 |LINEAL_SIMPLE #14#dsarm005@, nRango, nPos1, nPos2, BajaPanta905_14, AltaPanta905_14, EventoPanta905;
             |SINO;
                 |LINEAL_SIMPLE #6#dsarm005@, nRango, nPos1, nPos2, BajaPanta905_6, AltaPanta905_6, EventoPanta905;
             |FINSI;
         |FINSI;

         |SI enSwADConta = 0; |Y enSwADContD = 1;
             |SI eaNomDef = "camaasic"; |O eaNomDef = "camaasil";
                 |LINEAL_SIMPLE #10#dsarm005@, nRango, nPos1, nPos2, BajaPanta905_10, AltaPanta905_10, EventoPanta905;
             |FINSI;

             |SI eaNomDef = "camaniva";
                 |LINEAL_SIMPLE #11#dsarm005@, nRango, nPos1, nPos2, BajaPanta905_11, AltaPanta905_11, EventoPanta905;
             |FINSI;

             |SI eaNomDef = "cainliva";
                 |LINEAL_SIMPLE #11#dsarm005@, nRango, nPos1, nPos2, BajaPanta905_11_cainliva, AltaPanta905_11_cainliva, EventoPanta905;
             |FINSI;


             |SI eaNomDef = "cacuenta";
                 |LINEAL_SIMPLE #12#dsarm005@, nRango, nPos1, nPos2, BajaPanta905_12, AltaPanta905_12, EventoPanta905;
             |FINSI;

             |SI eaNomDef = "dsmom041"; |O eaNomDef = "dsmom042";
                 |LINEAL_SIMPLE #13#dsarm005@, nRango, nPos1, nPos2, BajaPanta905_13, AltaPanta905_13, EventoPanta905;
             |FINSI;
         |FINSI;

         |SI enDESPANET = 1;
             |LINEAL_SIMPLE #7#dsarm005@, nRango, nPos1, nPos2, BajaPanta905_7, AltaPanta905_7, EventoPanta905;
         |FINSI;

         |SI enSwADConta = 0; |Y enSwADContD = 0;  |Y enDESPANET = 0;
             |LINEAL_SIMPLE #8#dsarm005@, nRango, nPos1, nPos2, BajaPanta905_8, AltaPanta905_8, EventoPanta905;
         |FINSI;
     |SINO;
         aAlfa = aParametro % 0;
         |SI aAlfa = "5";
              |LINEAL_SIMPLE #3#dsarm005@, nRango, nPos1, nPos2, BajaPanta905_3, AltaPanta905_3, EventoPanta905;
         |SINO;
              |LINEAL_SIMPLE #4#dsarm005@, nRango, nPos1, nPos2, BajaPanta905_5, AltaPanta905_5, EventoPanta905;
         |FINSI;
     |FINSI;

     enGrid       = FSalida;
     nEstadoGrid  = FSalida;
     nFichero     = 905;

||     |FOCOTECLADO enGrid;
     |PULSATECLA;
|FPRC;

|| ------------------------------------------------------
|| Procesos del Inicio del Programa
|| ------------------------------------------------------
|PROCESO dsarm030_borra;
     |BORRA 020#dsarm030.a;
|FPRC;

|DEFBUCLE dsarm030_borra;
     #dsarm030#1;
     ;
     #dsarm005#0,     0;
     #dsarm005#0, 99999;
     be;
     NULL, dsarm030_borra;
|FIN;

|PROCESO dsarm031_borra;
     |BORRA 020#dsarm031.a;
|FPRC;

|DEFBUCLE dsarm031_borra;
     #dsarm031#1;
     ;
     #dsarm005#0,   0;
     #dsarm005#0, 999;
     be;
     NULL, dsarm031_borra;
|FIN;

|PROCESO dsarm006_borra;
     |BORRA 020#dsarm006.a;
|FPRC;

|DEFBUCLE dsarm006_borra;
     #dsarm006#1;
     ;
     #dsarm005#0, 001;
     #dsarm005#0, 999;
     be;
     NULL, dsarm006_borra;
|FIN;

|PROCESO dsarm007_1B;
     |BORRA 020#dsarm007.a;
     |LIBERA #dsarm007;
|FPRC;

|DEFBUCLE dsarm007_1B;
     #dsarm007#1;
     ;
     #dsarm005#0, 000000001;
     #dsarm005#0, 999999999;
     be;
     NULL, dsarm007_1B;
|FIN;

|PROCESO dsarm007_2B;
     |BORRA 020#dsarm007.a;
     |LIBERA #dsarm007;
|FPRC;

|DEFBUCLE dsarm007_2B;
     #dsarm007#2;
     ;
     #dsarm005#0, 000000001;
     #dsarm005#0, 999999999;
     be;
     NULL, dsarm007_2B;
|FIN;

|PROCESO CtrlClave;
     nSwQuedan = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE Clave10;
 #dsarm005#10;
 ;
 enEmpADConta, enEjeADConta, nClaveAD1, eaClaveAD2, nClaveAD3, 000000001;
 enEmpADConta, enEjeADConta, nClaveAD1, eaClaveAD2, nClaveAD3, 999999999;
 ;
 NULL, CtrlClave;
|FIN;

|DEFBUCLE Clave11;
 #dsarm005#11;
 ;
 enEmpADConta, enEjeADConta, nClaveAD1, nClaveAD3;
 enEmpADConta, enEjeADConta, nClaveAD1, nClaveAD3;
 ;
 NULL, CtrlClave;
|FIN;

|DEFBUCLE Clave12;
 #dsarm005#12;
 ;
 enEmpADConta, enEjeADConta, eaClaveAD1;
 enEmpADConta, enEjeADConta, eaClaveAD1;
 ;
 NULL, CtrlClave;
|FIN;

|DEFBUCLE Clave13;
 #dsarm005#13;
 ;
 eaClaveAD1, nClaveAD1;
 eaClaveAD1, nClaveAD1;
 ;
 NULL, CtrlClave;
|FIN;


|PROCESO MiraSiQuedan;
     |SI eaNomDef = "camaasic"; |O eaNomDef = "camaasil";
          nClaveAD1 = eaClaveAD1;
          nClaveAD3 = eaClaveAD3;
          |BUCLE Clave10;
     |FINSI;
     |SI eaNomDef = "camaniva";
          nClaveAD1 = eaClaveAD1;
          nClaveAD3 = eaClaveAD2;
          |BUCLE Clave11;
     |FINSI;
     |SI eaNomDef = "cacuenta";
          |BUCLE Clave12;
     |FINSI;
     |SI eaNomDef = "dsmom041"; |O eaNomDef = "dsmom042";
          nClaveAD1 = eaClaveAD2;
          |BUCLE Clave13;
     |FINSI;
     |SI eaNomDef = "cainliva";
          nClaveAD1 = eaClaveAD1;
          nRegFactura = 100000000 + (eaClaveAD1 * 1000) + eaClaveAD2;
          nClaveAD3 = nRegFactura;
          |BUCLE Clave11;
     |FINSI;
|FPRC;

|PROCESO registro;
     |BORRA 020#registro@.a;
     |LIBERA #registro@;
|FPRC;

|DEFBUCLE registro;
     #registro@#5001;
     ;
     #dsarm034#16;
     #dsarm034#16;
     be;
     NULL, registro;
|FIN;

|PROCESO Borradpntm101;
     ||Se basa en el calculo del dpntz002

     aEmpB = ("00000" + #dsarm034#18) % -105;

     |DBASS aBaseB;  |QBF aBaseB;
     aPathDatos101 = aBaseB + "despanet";             |MKDIR aPathDatos101;
     aPathDatos101 = aPathDatos101 + "/" + aEmpB;     |MKDIR aPathDatos101;
     aPathDatos101 = aPathDatos101 + "/fich";         |MKDIR aPathDatos101;
     aPathDatos101 = aPathDatos101 + "/";

     |DBASE aBaseB;  |QBF aBaseB;
     aMasB = aBaseB + "def/dpntm101";
     |CARGA_DEF aMasB, registro@;
     |SI FSalida = 0;
         |PATH_DAT #registro@#aPathDatos101#;

         |BUCLE registro;

         |DESCARGA_DEF #registro@;
     |FINSI;
|FPRC;

|PROCESO Borradpntm100;
     ||Se basa en el calculo del dpntz002

     aEmpB = ("00000" + #dsarm034#18) % -105;

     |DBASS aBaseB;  |QBF aBaseB;
     aPathDatos101 = aBaseB + "despanet";             |MKDIR aPathDatos101;
     aPathDatos101 = aPathDatos101 + "/" + aEmpB;     |MKDIR aPathDatos101;
     aPathDatos101 = aPathDatos101 + "/fich";         |MKDIR aPathDatos101;
     aPathDatos101 = aPathDatos101 + "/";

     |DBASE aBaseB;  |QBF aBaseB;
     aMasB = aBaseB + "def/dpntm100";
     |CARGA_DEF aMasB, registro@;
     |SI FSalida = 0;
         |PATH_DAT #registro@#aPathDatos101#;

         |BUCLE registro;

         |DESCARGA_DEF #registro@;
     |FINSI;
|FPRC;

|PROCESO dsarm035_borra;
     aProcesoPI = #dsarm034#17;
     |QBF aProcesoPI;
     |SI aProcesoPI = "FR000000";
         |HAZ Borradpntm101;
     |FINSI;

     |SI aProcesoPI = "FE000000";
         |HAZ Borradpntm100;
     |FINSI;

     |BORRA 020#dsarm035.a;
|FPRC;

|DEFBUCLE dsarm035_borra;
 #dsarm035#1;
 ;
 #dsarm034#0, #dsarm034#1, #dsarm034#2, aVacio25;
 #dsarm034#0, #dsarm034#1, #dsarm034#2, aZeta25;
 be;
 NULL, dsarm035_borra;
|FIN;

|PROCESO dsarm034_borra;
     |BUCLE dsarm035_borra;
     |BORRA 020#dsarm034.a;

     #dsarm054#0 = #dsarm034#0;
     #dsarm054#1 = #dsarm034#1;
     #dsarm054#2 = #dsarm034#2;
     |LEE 101#dsarm054.=;
     |SI FSalida = 0;
          |BORRA 020#dsarm054.a;
          |LIBERA #dsarm054;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm034_borra;
 #dsarm034#2;
 ;
 #dsarm005#0;
 #dsarm005#0;
 be;
 NULL, dsarm034_borra;
|FIN;

|PROCESO dsarm046_borra;
     |BORRA 020#dsarm046.a;
|FPRC;

|DEFBUCLE dsarm046_borra;
 #dsarm046#1;
 ;
 #dsarm005#0;
 #dsarm005#0;
 be;
 NULL, dsarm046_borra;
|FIN;

|PROCESO Boton0_1;
     |CONFI "0000N¿Est  seguro de que quiere dar de baja el registro?.";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ PidePassword;
     |SI enPassword = 1;  |ACABA;  |FINSI;

     |SI nFichero ! 0;        ||Estoy en Busqueda.
          |SELECT #1#dsarm005@;
          #dsarm005@#0 = enLinea005;
          |LEE 101#dsarm005@.=;
          |SI FSalida = 0;
               |BORRA 020#dsarm005@.a;
               |LIBERA #dsarm005@;
          |FINSI;
          #dsarm005#0 = enLinea005;
     |FINSI;

     |LEE 101#dsarm005.=;
     |SI FSalida = 0;
         aFichero = #dsarm005#7;              |QBF aFichero;
         aFichero = aFichero + #dsarm005#9;   |QBF aFichero;

         aFicheroOcr = aFichero + ".txt";
         |SI #dsarm001#7 = "N";
             |FBORRA aFichero;
             |FBORRA aFicheroOcr;
         |SINO;
             |RFBORRA aFichero;
             |RFBORRA aFicheroOcr;
         |FINSI;

         |BUCLE dsarm006_borra;
         |BUCLE dsarm007_1B;
         |BUCLE dsarm007_2B;
         |BUCLE dsarm030_borra;
         |BUCLE dsarm031_borra;


         |ABRE #dsarm054;
         |BUCLE dsarm034_borra;    ||Borramos los restos del dsEscan
         |CIERRA #dsarm054;

         |BUCLE dsarm046_borra;

         aTextoVin1 = #dsarm005#97;       ||Sirve para saber si tengo que borrar
         |QBF aTextoVin1;          ||o no del dsERP
         aTipoDocAux = #dsarm005#84;
         aSerieAux = #dsarm005#85;
         nNumeroAux = #dsarm005#86;
         nEmpresaAux = #dsarm005#88;

         |SI nSwArbolActivo = 1;
             |BORRA 020#dsarm055.a;
             |LIBERA #dsarm055;
         |FINSI;

         |BORRA 020#dsarm005.a;
         |LIBERA #dsarm005;

         aSaca = aTextoVin1 % 115;
         |SI aSaca = "dserp:dscomer9.";
              aSaca = aTextoVin1 % 16;
              |QBF aSaca;
              nNumDocDSerp = aSaca;
              |SI nNumDocDSerp ! 0;
                    |HAZ BorraDocumentoDSerp;
              |FINSI;
         |FINSI;

         |LEE 000#dsarm005.];
         |SI enSwADContD = 1;
               nSwQuedan = 0;
               |HAZ MiraSiQuedan;
               |SI nSwQuedan = 0;
                    aMensaje = "0000Sin documentos Asociados";
                    |MENAV aMensaje;
                    |PTEC 807;
                    |ACABA;
               |FINSI;
               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;
               |REFRESCACONTROL enGrid;
         |SINO;
              |SI nSwArbolActivo = 0;
                  |SI enSwADConta = 1;
                       |SI #dsarm001#24 = "S";
                            |SELECT #14#dsarm005;
                       |SINO;
                            |SELECT #6#dsarm005;
                       |FINSI;
                  |FINSI;
                  |PULSATECLA;
                  |PULSATECLA;
                  |PULSATECLA;
                  |REFRESCACONTROL enGrid;
              |SINO;
                  |HAZ EventoTree;
              |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BorraDocumentoDSerp;
     |DBASS aBass;
     |QBF aBass;
     aErp = aBass + "dserp/def/dserpm09.mas";
     |XABRE "E", aErp, 0;
     |SI FSalida ] 0;
          |CARGA_DEF aErp, otrodef@;
          |SI FSalida = 0;
                 aDirDocs = aBass + "dserp/documentos/";

                 aPathErp = aBass + "dserp/fich/";
                 |PATH_DAT #otrodef@#aPathErp#;
                 |ABRE #otrodef@;
                 |DDEFECTO #otrodef@;

                 |SI aTipoDocAux = "AV";
                      aCien = " " * 100;
                      aClaveErp = aSerieAux + ("000000" + nNumeroAux) % -106;
                      |QBF aClaveErp;
                      aClaveErp = (aClaveErp + aCien) % 199;
                      aClaveErp = aClaveErp + " ";
                      #otrodef@#7 = "dscomer9";
                      #otrodef@#6 = nEmpresaAux;
                      #otrodef@#0 = "agifa010";
                      #otrodef@#1 = aClaveErp;
                      #otrodef@#2 = nNumDocDSerp;
                      |LEE 101#otrodef@.=;
                      |SI FSalida = 0;
                           aBorra = aDirDocs + #otrodef@#3;
                           |QBF aBorra;
                           |FBORRA aBorra;

                           |BORRA 020#otrodef@.a;
                           |LIBERA #otrodef@;

                      |FINSI;
                 |FINSI;

                 |CIERRA #otrodef@;
                 |DESCARGA_DEF #otrodef@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Boton0_2;
     |SI nFichero = 0;
         enDocumento = #dsarm005#0;
     |SINO;
         enDocumento = #dsarm005@#0;
     |FINSI;

     |VENTANA 0501, 3599, -1, 16, "Datos Documentos";
     nVentm5 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SUB_EJECUTA_NP "dsarw006";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentm5;

     |SI nSwArbolActivo = 0;
         |REFRESCACONTROL enGrid;
     |SINO;
         |FOCOTECLADO nTree;
         |SI nGridTree ! -1;
             |REFRESCACONTROL nGridTree;
             |FOCOTECLADO nGridTree;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Boton0_13;
     |SI nFichero = 0;
         enDocumento = #dsarm005#0;
     |SINO;
         enDocumento = #dsarm005@#0;
     |FINSI;

     aAlfa = "Entradas / Salidas del documento " + (("0000000" + enDocumento) % -109);
     |VENTANA 0501, 2699, -1, 16, aAlfa;
     nVentm5 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SUB_EJECUTA_NP "dsarw012";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentm5;

     |SI nSwArbolActivo = 0;
         |REFRESCACONTROL enGrid;
     |SINO;
         |FOCOTECLADO nTree;
         |SI nGridTree ! -1;
             |REFRESCACONTROL nGridTree;
             |FOCOTECLADO nGridTree;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO EnviaPendientes;
     aTria = "P";
     |HAZ EnviaMuchosCorreos;
|FPRC;

|PROCESO EnviaTodos;
     aTria = "T";
     |HAZ EnviaMuchosCorreos;
|FPRC;

|PROCESO EnviaUno;
     enDocumento = #dsarm005#0;
     enErrorCorreo = 1;
     |SUB_EJECUTA_NP "dsarw010;AUTO";
     |SI enErrorCorreo = 0;
          nCorreoEnvOk = nCorreoEnvOk + 1;
     |FINSI;
|FPRC;

|PROCESO Act905;
     #dsarm005#0 = #dsarm005@#0;
     |LEE 000#dsarm005.=;
     |SI FSalida = 0;
          |PARA nCampo = 1;  |SI nCampo [ enNumCampos;  |HACIENDO nCampo = nCampo + 1;
               #dsarm005@#nCampo# = #dsarm005#nCampo#;
          |SIGUE;
          |GRABA 020#dsarm005@.a;
     |FINSI;
|FPRC;

|PROCESO RealizaAct905;
     |SI nFichero ! 0;
          |ABRE #dsarm005;
          |LEE 101#dsarm005@.p;
          nSalida = FSalida;
          |PARA; |SI nSalida = 0; |HACIENDO;
               |HAZ Act905;
               |LIBERA #dsarm005@;
               |LEE 101#dsarm005@.s;
               nSalida = FSalida;
          |SIGUE;
          |CIERRA #dsarm005;
     |FINSI;
|FPRC;

|PROCESO BotonEnvCorr;
     |PTEC 806;
|FPRC;

|PROCESO BotonCanCorr;
     |PTEC 807;
|FPRC;

|PROCESO BotonesAva;
     |CONTROL_SIMPLE 0, "BOTON,{{230}}Enviar Correo", 3084, 3098, BotonEnvCorr;
     nBotonEnvCorr = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{207}}Cancelar", 3072, 3082, BotonCanCorr;
     nBotonCanCorr = FSalida;
|FPRC;

|PROCESO Tipo7C3w087;   |TIPO 7;
     |SI nBotonAceptar ! -1;  |ACABA;  |FINSI;

     aQueBoton     = "|X000";
     aID           = #dsarw087#aQueBoton#;
     nBotonAceptar = aID;
     |ESTADO_CONTROL nBotonAceptar, "HIDE";

     aQueBoton      = "|X001";
     aID            = #dsarw087#aQueBoton#;
     nBotonCancelar = aID;
     |ESTADO_CONTROL nBotonCancelar, "HIDE";
|FPRC;

|PROCESO DimeDireccionDestino;
     ||Busca la direccion destino en la integral (y la basica ??? creo que no)
     aDirDestino = "";
     || integral/def/dsam0000
     |SI nCliente ! 0;
          |DBASS aBaseI;
          |QBF aBaseI;
          aCliInt = aBaseI + "/integral/def/dsam0000.mas";
          |XABRE "E", aMas, nHandleI;
          |SI FSalida ] 0;
               |CARGA_DEF aCliInt, dsam0000@;
               |SI FSalida ! 0; |ACABA; |FINSI;
               |ABRE #dsam0000@;
               |DDEFECTO #dsam0000@;
               #dsam0000@#0 = nCliente;
               |LEE 000#dsam0000@.=;
               |SI FSalida = 0;
                    aDirDestino = #dsam0000@#71;
                    |QBF aDirDestino;
               |FINSI;
               |CIERRA #dsam0000@;
               |DESCARGA_DEF #dsam0000@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsarm905_clave3;
     |SI #dsarm005@#8 ! nCodCliAnt
          |SI nCodCliAnt ! -1;
               ||ARRIBA
               |CIERRA #dsarw088;

               ||Falta.
               ||Controlar si es el cliente cero.  ERROR.
               ||Y si el cliente tiene o no tiene dir. correo. ERROR

               |SI nCodCliAnt ! 0; |Y aDirDestino ! "";
                    eaEmailCliAvanzado = aDirDestino;
                    enCliAutoAvanzado = nCodCliAnt;
                    aEjecuta = "dsarw010;AUTOENVAVANZADO";
                    |SUB_EJECUTA aEjecuta;
               |FINSI;

               |ABRE #dsarw088;
               nCliente = #dsarm005@#8;
               |HAZ DimeDireccionDestino;
          |SINO;
               |ABRE #dsarw088;
               nCliente = #dsarm005@#8;
               |HAZ DimeDireccionDestino;
          |FINSI;

          |HAZ Mete188;
          nCodCliAnt = #dsarm005@#8;
     |SINO;
          |HAZ Mete188;
     |FINSI;
|FPRC;

|PROCESO Mete188;
     |DDEFECTO #dsarw088;
     #dsarw088#0 = #dsarm005@#8;
     #dsarw088#1 = #dsarm005@#0;
     |LEE 101#dsarw088.=;
     |SI FSalida ! 0; |GRABA 020#dsarw088.b; |FINSI;

     |SI #dsarw088#0 = 0;
          #dsarw088#2 = "ERROR";
          #dsarw088#5 = "Numero Cliente 00000 NO Valido";
     |SINO;
          |SI aDirDestino = "";
               aCodCli = ("00000" + #dsarw088#0) % -105;
               #dsarw088#2 = "ERROR";
               #dsarw088#5 = "Cliente " + aCodCli + " sin direccion de correo";
          |SINO;
               #dsarw088#2 = "PEND.";
               #dsarw088#3 = #dsarm005@#7;
               #dsarw088#4 = #dsarm005@#9;
          |FINSI;
     |FINSI;

     |GRABA 020#dsarw088.a;
     |LIBERA #dsarw088;
|FPRC;

|DEFBUCLE dsarm905_clave3;
 #dsarm005@#3004;
 ;
 00000, "01.01.0000", "     ", 000000001;
 99999, "31.12.2099", "zzzzz", 999999999;
 ;
 NULL, dsarm905_clave3;
|FIN;

|PROCESO dsarw088_CuentaErr;
     aAuxEstado = #dsarw088#2;
     |QBF aAuxEstado;
     |SI aAuxEstado = "ERROR";
          nErrorEnv = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE dsarw088_CuentaErr;
 #dsarw088#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, dsarw088_CuentaErr;
|FIN;

|PROCESO dsarw088_Imp;
     aAuxEstado = #dsarw088#2;
     |QBF aAuxEstado;
     |SI aAuxEstado = "ERROR";
          |PRINT;
          nSwPie = 1;
     |FINSI;
|FPRC;

|DEFBUCLE dsarw088_Imp;
 #dsarw088#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, dsarw088_Imp;
|FIN;

|PROCESO ImprimeErrorEnv;
     |IMPRE 0;
     |SI FSalida = 0;
          aInforme = "dsarw088";
          |INFOR aInforme;
          |SI FSalida = 0;
               |BUCLE dsarw088_Imp;
               |SI nSwPie = 1;
                    |PIEINF;
               |FINSI;
               |FININF;
          |SINO;
               aMensaje = "0000Informe " + aInforme + " inaccesible.";
               |MENAV aMensaje;
          |FINSI;
          |FINIMP;
     |SINO;
          |MENAV "0000Proceso cancelado.";
     |FINSI;
|FPRC;

|PROCESO EnvioAvanzado;
     ||Agrupo los correos por cliente
     ||Mando los correos a cada cliente. Pillo la direccion de Integral/Basica
     ||Informe con los correos NO enviados o con error.

     ||Primero me creo 1 temporales (Al final solo uno, que se usa para ambas cosas)
     ||El primero para controlar los errores en el envio
     ||El segundo para indicar los fichero a adjuntar en cada correo.

     |HAZ CreaTempo;
     aTempo188 = Tempo;
     |NOME_DAT #dsarw088#aTempo188#;
     |DELINDEX #dsarw088;

     eaNombre188 = aTempo188;

     nCodCliAnt = -1;
     aDirDestino = "";
     |BUCLE dsarm905_clave3;

     |SI nCodCliAnt ! -1;
          ||Envio (dsarw010).  COPIAR DE ||ARRIBA
          |CIERRA #dsarw088;

          ||Falta.
          ||Controlar si es el cliente cero.  ERROR.
          ||Y si el cliente tiene o no tiene dir. correo. ERROR

          |SI nCodCliAnt ! 0; |Y aDirDestino ! "";
               eaEmailCliAvanzado = aDirDestino;
               enCliAutoAvanzado = nCodCliAnt;
               aEjecuta = "dsarw010;AUTOENVAVANZADO";
               |SUB_EJECUTA aEjecuta;
          |FINSI;
     |FINSI;

     nErrorEnv = 0;
     |BUCLE dsarw088_CuentaErr;
     |SI nErrorEnv = 1;
          aMensaje = "0000SSe han producido errores al realizar el envio de los correos. Desea revisarlos?";
          |CONFI aMensaje;
          |SI FSalida = 0;
              |HAZ ImprimeErrorEnv;
          |FINSI;
     |FINSI;

     |DELINDEX #dsarw088;
     Tempo = aTempo188;
     |HAZ BoraTempo;
|FPRC;

|PROCESO MultiSel999;
     |DDEFECTO #dsarw088;
     #dsarw088#0 = 0;              ||Aqui no hay cliente
     #dsarw088#1 = #referen@#0;
     |LEE 101#dsarw088.=;
     |SI FSalida ! 0; |GRABA 020#dsarw088.b; |FINSI;
     #dsarw088#2 = "PEND.";
     #dsarw088#3 = #referen@#7;
     #dsarw088#4 = #referen@#9;
     #dsarw088#5 = "";
     |GRABA 020#dsarw088.a;
     |LIBERA #dsarw088;
|FPRC;

|DEFBUCLE MultiSel999;
 #referen@#1001;
 ;
 000000001;
 999999999;
 ;
 NULL, MultiSel999;
|FIN;

|PROCESO EnvioCorreoMulti;
     ||En el dsarw010, me pregunta como si fuera un correo normal,
     ||pero el adjunto, es un tgz con los documentos de la multiseleccion.

     |VENTANA 0501, 3099, -1, 16, "Env¡o de correo Multiseleccion";
     nVentm5 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |HAZ CreaTempo;
     aTempo188 = Tempo;
     |NOME_DAT #dsarw088#aTempo188#;
     |DELINDEX #dsarw088;

     eaNombre188 = aTempo188;

     ||FALTA RELLENAR EL 188
     |DBASE aBaseB;  |QBF aBaseB;
     aMasB = aBaseB + "def/dsarm005";
     |CARGA_DEF aMasB, referen@;
     |SI FSalida = 0;
          aDatos999 = ("ms" + Usuario + "zzzzzzzz") % 108;
          |QBF aDatos999;
          |NOME_DAT #referen@#aDatos999#;

          |ABRE #dsarw088;
          |BUCLE MultiSel999;
          |CIERRA #dsarw088;

          |DESCARGA_DEF #referen@;

          aEjecuta = "dsarw010;AUTOMULTIENVIO";
          |SUB_EJECUTA aEjecuta;

          nErrorEnv = 0;
          |BUCLE dsarw088_CuentaErr;
          |SI nErrorEnv = 1;
               aMensaje = "0000SSe han producido errores al realizar el envio de los correos. Desea revisarlos?";
               |CONFI aMensaje;
               |SI FSalida = 0;
                   |HAZ ImprimeErrorEnv;
               |FINSI;
          |FINSI;
     |FINSI;

     |DELINDEX #dsarw088;
     Tempo = aTempo188;
     |HAZ BoraTempo;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentm5;
|FPRC;

|PROCESO EnvioCorreoAva;
     ||Pantalla preguntando Asunto y Cuerpo.
     ||Necesito la descripcion de la Seleccion para poner como asunto
     ||Agrupo los correos por cliente
     ||Mando los correos a cada cliente. Pillo la direccion de Integral/Basica
     ||Informe con los correos NO enviados o con error.

     nBotonAceptar = -1;
     nBotonCancelar = -1;

     |VENTANA 0501, 3099, -1, 16, "Env¡o de correo";
     nVentm5 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #dsarw087;
     #dsarw087#3 = eaAsuntoSel;
     |PINPA #0#dsarw087;
     |PINDA #0#dsarw087;
     |HAZ BotonesAva;
     |ENDATOS #1#dsarw087;
     |SI FSalida = 0;
          eaAsuntoAva = #dsarw087#3;
          eaCuerpo1Ava = #dsarw087#4;
          eaCuerpo2Ava = #dsarw087#5;
          eaCuerpo3Ava = #dsarw087#6;
          eaCuerpo4Ava = #dsarw087#7;
          eaCuerpo5Ava = #dsarw087#8;
          eaCuerpo6Ava = #dsarw087#9;
          eaCuerpo7Ava = #dsarw087#10;
          eaCuerpo8Ava = #dsarw087#11;
          eaCuerpo9Ava = #dsarw087#12;
          eaCuerpo10Ava = #dsarw087#13;
          eaCuerpo11Ava = #dsarw087#14;
          eaCuerpo12Ava = #dsarw087#15;
          eaCuerpo13Ava = #dsarw087#16;
          eaCuerpo14Ava = #dsarw087#17;
          eaCuerpo15Ava = #dsarw087#18;
          eaCuerpo16Ava = #dsarw087#19;
          eaCuerpo17Ava = #dsarw087#20;
          eaCuerpo18Ava = #dsarw087#21;
          eaCuerpo19Ava = #dsarw087#22;
          eaCuerpo20Ava = #dsarw087#23;
          eaCuerpo21Ava = #dsarw087#24; 
          eaCuerpo22Ava = #dsarw087#25; 
          eaCuerpo23Ava = #dsarw087#26; 
          eaCuerpo24Ava = #dsarw087#27;
          eaCuerpo25Ava = #dsarw087#28; 
          eaCuerpo26Ava = #dsarw087#29; 
          eaCuerpo27Ava = #dsarw087#30; 
          eaCuerpo28Ava = #dsarw087#31; 
          eaCuerpo29Ava = #dsarw087#32; 
          eaCuerpo30Ava = #dsarw087#33; 
          eaCuerpo31Ava = #dsarw087#34; 
          eaCuerpo32Ava = #dsarw087#35; 
          eaCuerpo33Ava = #dsarw087#36; 
          eaCuerpo34Ava = #dsarw087#37; 
          eaCuerpo35Ava = #dsarw087#38; 
          eaCuerpo36Ava = #dsarw087#39;
          eaCuerpo37Ava = #dsarw087#40; 
          eaCuerpo38Ava = #dsarw087#41; 
          eaCuerpo39Ava = #dsarw087#42; 
          eaCuerpo40Ava = #dsarw087#43; 
          eaCuerpo41Ava = #dsarw087#44; 
          eaCuerpo42Ava = #dsarw087#45; 
          eaCuerpo43Ava = #dsarw087#46; 
          eaCuerpo44Ava = #dsarw087#47; 
          eaCuerpo45Ava = #dsarw087#48; 
          eaCuerpo46Ava = #dsarw087#49; 
          eaCuerpo47Ava = #dsarw087#50; 
          eaCuerpo48Ava = #dsarw087#51; 
          eaCuerpo49Ava = #dsarw087#52; 
          eaCuerpo50Ava = #dsarw087#53; 
          eaCuerpo51Ava = #dsarw087#54; 
          eaCuerpo52Ava = #dsarw087#55;
          eaCuerpo53Ava = #dsarw087#56; 
          eaCuerpo54Ava = #dsarw087#57; 
          eaCuerpo55Ava = #dsarw087#58; 
          eaCuerpo56Ava = #dsarw087#59; 
          eaCuerpo57Ava = #dsarw087#60; 
          eaCuerpo58Ava = #dsarw087#61; 
          eaCuerpo59Ava = #dsarw087#62; 
          eaCuerpo60Ava = #dsarw087#63; 
          eaCuerpo61Ava = #dsarw087#64; 
          eaCuerpo62Ava = #dsarw087#65; 
          eaCuerpo63Ava = #dsarw087#66; 
          eaCuerpo64Ava = #dsarw087#67; 
          eaCuerpo65Ava = #dsarw087#68; 
          eaCuerpo66Ava = #dsarw087#69; 
          eaCuerpo67Ava = #dsarw087#70; 
          eaCuerpo68Ava = #dsarw087#71;
          eaCuerpo69Ava = #dsarw087#72; 
          eaCuerpo70Ava = #dsarw087#73; 
          eaCuerpo71Ava = #dsarw087#74; 
          eaCuerpo72Ava = #dsarw087#75; 
          eaCuerpo73Ava = #dsarw087#76; 
          eaCuerpo74Ava = #dsarw087#77; 
          eaCuerpo75Ava = #dsarw087#78; 
          eaCuerpo76Ava = #dsarw087#79; 
          eaCuerpo77Ava = #dsarw087#80; 
          eaCuerpo78Ava = #dsarw087#81; 
          eaCuerpo79Ava = #dsarw087#82; 
          eaCuerpo80Ava = #dsarw087#83; 
          eaCuerpo81Ava = #dsarw087#84; 
          eaCuerpo82Ava = #dsarw087#85; 
          eaCuerpo83Ava = #dsarw087#86; 
          eaCuerpo84Ava = #dsarw087#87;
          eaCuerpo85Ava = #dsarw087#88; 
          eaCuerpo86Ava = #dsarw087#89; 
          eaCuerpo87Ava = #dsarw087#90;
          eaCuerpo88Ava = #dsarw087#91; 
          eaCuerpo89Ava = #dsarw087#92; 
          eaCuerpo90Ava = #dsarw087#93; 
          eaCuerpo91Ava = #dsarw087#94; 
          eaCuerpo92Ava = #dsarw087#95; 
          eaCuerpo93Ava = #dsarw087#96; 
          eaCuerpo94Ava = #dsarw087#97; 
          eaCuerpo95Ava = #dsarw087#98; 
          eaCuerpo96Ava = #dsarw087#99; 
          eaCuerpo97Ava = #dsarw087#100;
          eaCuerpo98Ava = #dsarw087#101; 
          eaCuerpo99Ava = #dsarw087#102; 

          |HAZ EnvioAvanzado;
     |SINO;
          ||Se cancela el envio del correo.
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentm5;
|FPRC;

|PROCESO Boton0_3;
     |SI enSwHaySelAva = 1;
          ||Estoy en un Envio Avanzado de correo. Ya he seleccionado
          ||los documentos a enviar.
          |HAZ EnvioCorreoAva;

          ||Una vez terminado. Me quedo aqui.
     |SINO;
          |SI #dsarm001#3 = "S"; |O #dsarm001#9 = "S"; |O #dsarm001#31 = "S";
               |O #dsarm001#46 = "S"; |O #dsarm001#55 = "S";
               aTria = "FIN";

               aPopCorreo1 = "-1";  || Si fuera -1 en la posicion

               |SI enModoBus = 0;
                    |SI enNumMultiSele = 0;
                         aPopCorreo2  = 4;
                         aPopCorreo3  = "Enviar Seleccionado";
                         aPopCorreo4  = "Enviar Pendientes";
                         aPopCorreo5  = "Enviar Todos";
                         aPopCorreo6  = "Envio Avanzado";
                    |SINO;
                         aPopCorreo2  = 5;
                         aPopCorreo3  = "Enviar Seleccionado";
                         aPopCorreo4  = "Enviar Pendientes";
                         aPopCorreo5  = "Enviar Todos";
                         aPopCorreo6  = "Envio Avanzado";
                         aPopCorreo7  = "Envio Multiseleccion";
                    |FINSI;
               |SINO;
                    |SI enNumMultiSele = 0;
                         aPopCorreo2  = 3;
                         aPopCorreo3  = "Enviar Seleccionado";
                         aPopCorreo4  = "Enviar Pendientes";
                         aPopCorreo5  = "Enviar Todos";
                    |SINO;
                         aPopCorreo2  = 3;
                         aPopCorreo3  = "Enviar Seleccionado";
                         aPopCorreo4  = "Enviar Pendientes";
                         aPopCorreo5  = "Enviar Todos";
                         aPopCorreo6  = "Envio Multiseleccion";
                    |FINSI;
               |FINSI;

               IaPopCorreo  = aPopCorreo1  <-;
               |ESPECIFICA "TRACKPOPUP", aPopCorreo;
               |SI FSalida ! 0;
                   IaPopCorreo  = aPopCorreo3  <-;
                   IaPopCorreo  = IaPopCorreo + (FSalida - 1);

                   aTria = aPopCorreo % 801;
               |FINSI;

               |SI aTria ! "FIN";
                    |SI aTria = "S";
                         |HAZ EnviaSeleccionado;
                    |SINO;
                         |SI aTria = "P";
                              nCorreos = 0;
                              |HAZ DimeNumCorreosPed;
                              |SI nCorreos = 0;
                                   aMensaje = "0000No hay correos pendientes de envio";
                                   |MENAV aMensaje;
                              |SINO;
                                   |SI nCorreos = 1;
                                        aMensaje = "0000NSe enviara 1 correo al destinatario indicado en el registro." + &13 + "ESTA SEGURO?";
                                   |SINO;
                                        aMensaje = "0000NSe enviaran " + nCorreos + " correos pendientes." + &13 + "Uno a cada destinatario indicado en el registro." + &13 + "ESTA SEGURO?";
                                   |FINSI;
                                   |CONFI aMensaje;
                                   |SI FSalida = 0;
                                        nCorreoEnvOk = 0;
                                        |HAZ EnviaPendientes;
                                        |SI nCorreoEnvOk ! 0;
                                             |SI nCorreoEnvOk = 1;
                                                  aMensaje = "0000Enviado 1 correo electronico.";
                                             |SINO;
                                                  aMensaje = "0000Enviados " + nCorreoEnvOk + " correos electronicos.";
                                             |FINSI;
                                             |MENAV aMensaje;
                                             |HAZ RealizaAct905;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |SINO;
                              |SI aTria = "T";
                                   nCorreos = 0;
                                   |HAZ DimeNumCorreosTodos;
                                   |SI nCorreos = 0;
                                        aMensaje = "0000No hay direcciones de correos [Dir. Destino Correos]";
                                        |MENAV aMensaje;
                                   |SINO;
                                        |SI nCorreos = 1;
                                             aMensaje = "0000NSe enviara 1 correo al destinatario indicado en el registro." + &13 + "ESTA SEGURO?";
                                        |SINO;
                                             aMensaje = "0000NSe enviaran en total " + nCorreos + " correos." + &13 + "Uno a cada destinatario indicado en el registro." + &13 + "ESTA SEGURO?";
                                        |FINSI;
                                        |CONFI aMensaje;
                                        |SI FSalida = 0;
                                             nCorreoEnvOk = 0;
                                             |HAZ EnviaTodos;
                                             |SI nCorreoEnvOk = 1;
                                                  aMensaje = "0000Enviado 1 correo.";
                                             |SINO;
                                                  aMensaje = "0000Enviados " + nCorreoEnvOk + " correos electronicos.";
                                             |FINSI;
                                             |MENAV aMensaje;
                                             |HAZ RealizaAct905;
                                        |FINSI;
                                   |FINSI;
                              |SINO;
                                   |SI aTria = "v";         ||Envio Avanzado
                                        |SI nFichero = 0;
                                             aGuarda = #dsarm005#0;
                                        |SINO;
                                             aGuarda = #dsarm005@#0;
                                        |FINSI;

                                        eaAsuntoSel = "";
                                        enSwHaySelAva = 0;
                                        ||Envio Avanzado.  Sub_ejecuta dsarz054
                                        |VENTANA 0501, 3199, -1, 16, "Seleccion Envio Avanzado Correos";
                                        nVentaEA = FSalida;

                                        aVent1 = -1;
                                        aVent2 = -1;
                                        aVent3 = 0;
                                        aVent4 = nVentaEA;
                                        aVent5 = "MODAL";
                                        |ESPECIFICA "ESTADO_VENTANA", aVent;

                                        aEjecuta = "dsarz054";
                                        |SUB_EJECUTA_NP aEjecuta;

                                        aVent1 = -1;
                                        aVent2 = -1;
                                        aVent3 = 0;
                                        aVent4 = nVentaEA;
                                        aVent5 = "MODELESS";
                                        |ESPECIFICA "ESTADO_VENTANA", aVent;

                                        |FINVENTANA nVentaEA;

                                        |SI enSwHaySelAva = 1;
                                             |HAZ Boton0_3;
                                             enSwHaySelAva = 0;

                                             ||ARA99
                                             |DESTRUYECONTROL enGrid;  |PULSATECLA;
                                             |HAZ GridFicheroBusqueda;

                                             enBusqueda = 1;

                                             |SI nBoton0_9 ! -1;
                                                 |ESTADO_CONTROL enGrid, "HIDE";
                                                 nEstadoGrid = -1;
                                                 |HAZ Boton0_8;
                                             |FINSI;

                                             |ESTADO_CONTROL nBoton0_5, "ENABLE";
                                             |ESTADO_CONTROL nBoton0_16, "DISABLE";

                                             |ESTADO_CONTROL nBotonMas, "HIDE";
                                             |ESTADO_CONTROL nBotonMulti, "HIDE";
                                        |SINO;
                                             ||TODO
                                             ||SI no se selecciona nada ..
                                             ||tengo que volver a leer el registro en el que estoy
                                             |SI nFichero = 0;
                                                  #dsarm005#0 = aGuarda;
                                             |SINO;
                                                  #dsarm005@#0 = aGuarda;
                                             |FINSI;
                                        |FINSI;
                                   |SINO;
                                        ||Envio Multiseleccion
                                        ||aTria = "u";         ||Envio Multiseleccion
                                        ||Relleno el temporal w088 y llamo al dsarw010
                                        |HAZ EnvioCorreoMulti;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SINO;
               |HAZ EnviaSeleccionado;
          |FINSI;

          |SI nSwArbolActivo = 0;
              |REFRESCACONTROL enGrid;
              |FOCOTECLADO enGrid;
          |SINO;
              |FOCOTECLADO nTree;
              |SI nGridTree ! -1;
                  |REFRESCACONTROL nGridTree;
                  |FOCOTECLADO nGridTree;
              |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO EnviaSeleccionado;
     |SI nFichero = 0;
         enDocumento  = #dsarm005#0;
         eaDirDestino = #dsarm005#78;
         nCliente     = #dsarm005#8;
     |SINO;
         enDocumento  = #dsarm005@#0;
         eaDirDestino = #dsarm005@#78;
         nCliente     = #dsarm005@#8;
     |FINSI;

     |HAZ DimeDireccionDestino;
     |SI aDirDestino ! "";
         eaDirDestino = aDirDestino;
     |FINSI;

     |VENTANA 0501, 3099, -1, 16, "Env¡o de correo";
     nVentm5 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enErrorCorreo = 1;
     |SUB_EJECUTA_NP "dsarw010";
     |SI enErrorCorreo = 0;
          |SI nFichero ! 0;
               |SELECT #1#dsarm005;
               #dsarm005#0 = enDocumento;
               |LEE 000#dsarm005.=;
               |SI FSalida = 0;
                    |SELECT #1#dsarm005@;
                    |LEE 101#dsarm005@.=;
                    |SI FSalida = 0;
                         |PARA nCampo = 1;  |SI nCampo [ enNumCampos;  |HACIENDO nCampo = nCampo + 1;
                              #dsarm005@#nCampo# = #dsarm005#nCampo#;
                         |SIGUE;
                         |GRABA 020#dsarm005@.a;
                         |LIBERA #dsarm005@;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentm5;
|FPRC;

|PROCESO Boton0_4;
     |CIERRA #dsarm005;
     |CIERRA #dsarm005@;

     |VENTANA 0501, 2699, -1, 16, "Busqueda de Documentos";
     nVentm5 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enError = 0;
     |SI aParametro ! "";
          aAlfa = "dsarz002;" + aParametro;
     |SINO;
          aAlfa = "dsarz002";
     |FINSI;

     |SUB_EJECUTA_NP aAlfa;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentm5;

     |SI enError = 1;
         |ABRE #dsarm005;
         |ABRE #dsarm005@;
         |ACABA;
     |FINSI;

     |DESTRUYECONTROL enGrid;  |PULSATECLA;
     |HAZ GridFicheroBusqueda;

     enBusqueda = 1;
     |PULSATECLA;

     enModoBus = 1;

     |SI nBoton0_9 ! -1;
         |ESTADO_CONTROL enGrid, "HIDE";
         nEstadoGrid = -1;
         |HAZ Boton0_8;
     |FINSI;

     |ESTADO_CONTROL nBoton0_5, "ENABLE";
     |ESTADO_CONTROL nBoton0_16, "DISABLE";
|FPRC;

|PROCESO Boton0_5;
     |HAZ BorraTempoVistaVZ;

     enModoBus = 0;
     enSwHaySelAva = 0;

     |SI nSwModoVincula = 1;
          |CIERRA #dsarm005@;  |DELINDEX #dsarm005@;
          |DESTRUYECONTROL enGrid;

          |HAZ Vinculacion;
          |SI nBoton0_9 ! -1;
              |ESTADO_CONTROL enGrid, "HIDE";
              nEstadoGrid = -1;

              |HAZ Boton0_8;
          |FINSI;

          |ESTADO_CONTROL nBoton0_5, "DISABLE";
          |ESTADO_CONTROL nBoton0_16, "ENABLE";
     |SINO;
          |CIERRA #dsarm005@;  |DELINDEX #dsarm005@;
          |DESTRUYECONTROL enGrid;

          enBusqueda = 1;

          |HAZ GridFicheroEntero;
          |SI nBoton0_9 ! -1;
              |ESTADO_CONTROL enGrid, "HIDE";
              nEstadoGrid = -1;

              |HAZ Boton0_8;
          |FINSI;

          |ESTADO_CONTROL nBoton0_5, "DISABLE";
          |ESTADO_CONTROL nBoton0_16, "ENABLE";

          |ESTADO_CONTROL nBotonMas, "SHOW";
          |ESTADO_CONTROL nBotonMulti, "SHOW";
     |FINSI;
|FPRC;

|PROCESO Boton0_6;
     |VENTANA 0501, 2799, -1, 16, "Copiar Documentos";
     nVentm5 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SI nFichero = 0;
         enDocumento = #dsarm005#0;
     |SINO;
         enDocumento = #dsarm005@#0;
     |FINSI;

     |SUB_EJECUTA "dsarz003";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentm5;

     |SI nSwArbolActivo = 0;
         |FOCOTECLADO enGrid;
     |SINO;
         |FOCOTECLADO nTree;
         |SI nGridTree ! -1;  |FOCOTECLADO nGridTree;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Boton0_7;
     |SI nFichero = 0;
         enDocumento = #dsarm005#0;
         enDocuPpal  = #dsarm005#0;
         enGrupo     = #dsarm005#1;
         enSubGrupo  = #dsarm005#2;
         enTipo      = #dsarm005#3;
     |SINO;
         enDocumento = #dsarm005@#0;
         enDocuPpal  = #dsarm005@#0;
         enGrupo     = #dsarm005@#1;
         enSubGrupo  = #dsarm005@#2;
         enTipo      = #dsarm005@#3;
     |FINSI;

     aTria = "";
     |SI #dsarm001#216 = "S";

          aPopAsociar1 = "-1";  || Si fuera -1 en la posicion
          aPopAsociar2  = 2;
          aPopAsociar3  = "Asociar";
          aPopAsociar4  = "Asociar Avanzado";

          IaPopAsociar  = aPopAsociar1  <-;
          |ESPECIFICA "TRACKPOPUP", aPopAsociar;
          |SI FSalida ! 0;
               IaPopAsociar  = aPopAsociar3  <-;
               IaPopAsociar  = IaPopAsociar + (FSalida - 1);

               aTria = aPopAsociar % 901;
          |FINSI;
     |FINSI;

     enSwHaySelAva = 0;
     |QBF aTria;
     |SI aTria = "A";
          eaNomFicFiltroAso = ("88" + Usuario + "zzzzzzzz") % 108;

          ||ARA40
          eaAsuntoSel = "";
          enSwHaySelAva = 0;

          ||Seleccion Avanzada.  Sub_ejecuta dsarz061
          |VENTANA 0501, 3199, -1, 16, "Seleccion Avanzada Registros";
          nVentaEA = FSalida;

          aVent1 = -1;
          aVent2 = -1;
          aVent3 = 0;
          aVent4 = nVentaEA;
          aVent5 = "MODAL";
          |ESPECIFICA "ESTADO_VENTANA", aVent;

          aEjecuta = "dsarz061";
          |SUB_EJECUTA_NP aEjecuta;

          aVent1 = -1;
          aVent2 = -1;
          aVent3 = 0;
          aVent4 = nVentaEA;
          aVent5 = "MODELESS";
          |ESPECIFICA "ESTADO_VENTANA", aVent;

          |FINVENTANA nVentaEA;

          |SI enSwHaySelAva = 0;
               aMensaje = "0000Ningun registro cumple la seleccion";
               |MENAV aMensaje;
               |ACABA;
          |FINSI;
     |FINSI;

     |VENTANA 0501, 3099, -1, 16, "Asociar Documentos";
     nVentm5 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SI enSwHaySelAva = 1;
          enSwFiltroAsociar = 1;
     |SINO;
          enSwFiltroAsociar = 0;
     |FINSI;

     enNoClonarFlow = 1;
     ||Tiquet 2537 | 430
     |SUB_EJECUTA_NP "dsarz005";
     enNoClonarFlow = 0;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentm5;

     |SI nSwArbolActivo = 0;
         |FOCOTECLADO enGrid;
     |SINO;
         |FOCOTECLADO nTree;
         |SI nGridTree ! -1;  |FOCOTECLADO nGridTree;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO LeeDocumento;
     |SI nFichero = 0;
         |SELECT #1#dsarm005;
         #dsarm005#0 = #dsarm055#0;
         |LEE 000#dsarm005.=;
         |SI FSalida = 0;
             |SI #dsarz010#9 = "S";
                 |ESTADO_CONTROL nBoton0_1, "ENABLE";
             |SINO;
                 |ESTADO_CONTROL nBoton0_1, "DISABLE";
             |FINSI;
         |SINO;
             |ESTADO_CONTROL nBoton0_1, "DISABLE";
             |DDEFECTO #dsarm005;
         |FINSI;

         |SI aParametro = "";
             |SI enDESPANET = 1;
                 |SELECT #7#dsarm005;
             |SINO;
                 |SELECT #8#dsarm005;
             |FINSI;
         |SINO;
             aAlfa = aParametro % 0;
             |SI aAlfa = "5";
                 |SELECT #3#dsarm005;
             |SINO;
                 |SELECT #4#dsarm005;
             |FINSI;
         |FINSI;
         |LEE 000#dsarm005.=;

         enLinea005 = #dsarm005#0;
         aFichero   = #dsarm005#7;              |QBF aFichero;
         aFichero   = aFichero + #dsarm005#9;   |QBF aFichero;
     |SINO;
         |SELECT #1#dsarm005@;
         #dsarm005@#0 = #dsarm055#0;
         |LEE 000#dsarm005@.=;
         |SI FSalida ! 0;  |DDEFECTO #dsarm005@;  |FINSI;

         |SI aParametro = "";
             |SI enDESPANET = 1;
                 |SELECT #7#dsarm005@;
             |SINO;
                 |SELECT #8#dsarm005@;
             |FINSI;
         |SINO;
             aAlfa = aParametro % 0;
             |SI aAlfa = "5";
                 |SELECT #3#dsarm005@;
             |SINO;
                 |SELECT #4#dsarm005@;
             |FINSI;
         |FINSI;

         |LEE 000#dsarm005@.=;

         enLinea005 = #dsarm005@#0;
         aFichero   = #dsarm005@#7;              |QBF aFichero;
         aFichero   = aFichero + #dsarm005@#9;   |QBF aFichero;
     |FINSI;

     |HAZ ControlaBotonesUsuario;
|FPRC;

|PROCESO EventoGridTree;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsarm055.=;

         eaFoco = "DOCUMENTO";

         |HAZ LeeDocumento;
     |FINSI;

     |SI FSalida = 4;
         |SI nEntroPDatos = 1;
             |HAZ Boton0_2;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BajaDSARM055_2;
     #dsarm055#1  = #dsarm056#5;
     #dsarm055#0  = 0;
|FPRC;

|PROCESO AltaDSARM055_2;
     #dsarm055#1  = #dsarm056#5;
     #dsarm055#0  = 999999999;
|FPRC;

|PROCESO BajaDSARM055_3;
     #dsarm055#1  = #dsarm056#5;
     #dsarm055#0  = 0;
     #dsarm055#2  = "";
|FPRC;

|PROCESO AltaDSARM055_3;
     #dsarm055#1  = #dsarm056#5;
     #dsarm055#0  = 999999999;
     #dsarm055#2  = "z" * 135;
|FPRC;

|PROCESO BajaDSARM055_4;
     #dsarm055#1  = #dsarm056#5;
     #dsarm055#0  = 0;
     #dsarm055#2  = "z" * 135;
|FPRC;

|PROCESO AltaDSARM055_4;
     #dsarm055#1  = #dsarm056#5;
     #dsarm055#0  = 999999999;
     #dsarm055#2  = "";
|FPRC;

|PROCESO CreaGrid;
     |DBASE aBase;  |QBF aBase;
     eaPathDef     = aBase + "def/";
     eaFichRegedit = "dsarm055";
     |HAZ BorraDelRegedit;

     |C_V #dsarm055#4,  1, "S";
     |C_V #dsarm055#5,  1, "S";
     |C_V #dsarm055#6,  1, "S";
     |C_V #dsarm055#7,  1, "S";

     nNumCamp = #dsarm008#12;
     |SI #dsarm056#6 ! "                    ";
         |ABRE #dsarm059;
         #dsarm059#0 = #dsarm056#6;
         |LEE 000#dsarm059.=;
         |CIERRA #dsarm059;

         nNumCamp = #dsarm059#1;
     |FINSI;

     |SI nNumCamp = 1;
         |C_V #dsarm055#4,  1, "N";
         |C_V #dsarm055#5,  1, "N";
         |C_V #dsarm055#6,  1, "N";
         |C_V #dsarm055#7,  1, "N";
     |FINSI;

     |SI nNumCamp = 2;
         |C_V #dsarm055#5,  1, "N";
         |C_V #dsarm055#6,  1, "N";
         |C_V #dsarm055#7,  1, "N";
     |FINSI;

     |SI nNumCamp = 3;
         |C_V #dsarm055#6,  1, "N";
         |C_V #dsarm055#7,  1, "N";
     |FINSI;

     |SI nNumCamp = 4;
         |C_V #dsarm055#7,  1, "N";
     |FINSI;
|FPRC;

|PROCESO SacaCodRama;
     aCodRama1 = "";
     aCodRama2 = "";
     aCodRama3 = "";
     aCodRama4 = "";
     aCodRama5 = "";
     aCodRama6 = "";

     aLong     = aCodRama % 0;
     nLong        = aLong;
     nCargar      = 1;
     |PARA nPosi  = 1;  |SI nPosi [ nLong;  |HACIENDO nPosi = nPosi + 1;
           nPos = (nPosi * 100) + 1;
           aCarac = aCodRama % nPos;

           |SI aCarac ! ",";
               |SI nCargar = 1;  aCodRama1 = aCodRama1 + aCarac;  |FINSI;
               |SI nCargar = 2;  aCodRama2 = aCodRama2 + aCarac;  |FINSI;
               |SI nCargar = 3;  aCodRama3 = aCodRama3 + aCarac;  |FINSI;
               |SI nCargar = 4;  aCodRama4 = aCodRama4 + aCarac;  |FINSI;
               |SI nCargar = 5;  aCodRama5 = aCodRama5 + aCarac;  |FINSI;
               |SI nCargar = 6;  aCodRama6 = aCodRama6 + aCarac;  |FINSI;
           |SINO;
               nCargar = nCargar + 1;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO CargaTextoFoco;
     |SI aTextoFoco1 = "";  aTextoFoco1 = aTextoFoco;  |ACABA;  |FINSI;
     |SI aTextoFoco2 = "";  aTextoFoco2 = aTextoFoco;  |ACABA;  |FINSI;
     |SI aTextoFoco3 = "";  aTextoFoco3 = aTextoFoco;  |ACABA;  |FINSI;
     |SI aTextoFoco4 = "";  aTextoFoco4 = aTextoFoco;  |ACABA;  |FINSI;
     |SI aTextoFoco5 = "";  aTextoFoco5 = aTextoFoco;  |ACABA;  |FINSI;
     |SI aTextoFoco6 = "";  aTextoFoco6 = aTextoFoco;  |ACABA;  |FINSI;
|FPRC;

|PROCESO SacaNombreRama;
     sT_nID   = nTree;
     sT_aData = aCodRama + ":";
     sT_nOper = 4;
     |ESPECIFICA "COMMANDCONTROL", sTree;
     aTextoFoco = Contenido;

     |HAZ CargaTextoFoco;
|FPRC;

|PROCESO CargaRamas;
     aTextoFoco1 = "";
     aTextoFoco2 = "";
     aTextoFoco3 = "";
     aTextoFoco4 = "";
     aTextoFoco5 = "";
     aTextoFoco6 = "";

     aAlfa = aNodo;  |QBT aAlfa;
     |SI aAlfa = "0";
         |ACABA;
     |FINSI;

     sT_nID   = nTree;
     sT_aData = ":" + aNodo;
     sT_nOper = 7;
     |ESPECIFICA "COMMANDCONTROL", sTree;
     aCodRama = Contenido;

     |HAZ SacaCodRama;

     |SI aCodRama1 ! "";
         aCodRama = aCodRama1;
         |HAZ SacaNombreRama;
     |FINSI;

     |SI aCodRama2 ! "";
         aCodRama = aCodRama1 + "," + aCodRama2;
         |HAZ SacaNombreRama;
     |FINSI;

     |SI aCodRama3 ! "";
         aCodRama = aCodRama1 + "," + aCodRama2 + "," + aCodRama3;
         |HAZ SacaNombreRama;
     |FINSI;

     |SI aCodRama4 ! "";
         aCodRama = aCodRama1 + "," + aCodRama2 + "," + aCodRama3;
         aCodRama = aCodRama  + "," + aCodRama4;
         |HAZ SacaNombreRama;
     |FINSI;

     |SI aCodRama5 ! "";
         aCodRama = aCodRama1 + "," + aCodRama2 + "," + aCodRama3;
         aCodRama = aCodRama  + "," + aCodRama4 + "," + aCodRama5;
         |HAZ SacaNombreRama;
     |FINSI;

     |SI aCodRama6 ! "";
         aCodRama = aCodRama1 + "," + aCodRama2 + "," + aCodRama3;
         aCodRama = aCodRama  + "," + aCodRama4 + "," + aCodRama5;
         aCodRama = aCodRama  + "," + aCodRama6;
         |HAZ SacaNombreRama;
     |FINSI;
|FPRC;

|PROCESO EventoTree;
     |SI FEntrada = 0;
         eaFoco = "CARPETA";

         aEstoy = Contenido;
         |QBF aEstoy;

         nEntroPDatos = 0;
         aAlfa        = Contenido;  |QBF aAlfa;
         aTexto       = "";
         aLong        = aAlfa % 0;
         nLong        = aLong;
         nCargar      = 0;
         aNodo = "";
         |PARA nPosi  = 1;  |SI nPosi [ nLong;  |HACIENDO nPosi = nPosi + 1;
               nPos = (nPosi * 100) + 1;
               aCarac = aAlfa % nPos;

               |SI nCargar = 1;
                   aTexto = aTexto + aCarac;
               |SINO;
                    |SI aCarac ! ":";
                         aNodo = aNodo + aCarac
                    |FINSI;
               |FINSI;

               |SI aCarac = ":";  nCargar = 1; |FINSI;
         |SIGUE;

         aContenido = aTexto;

         |HAZ CargaRamas;


         |SI #dsarm001#194 = "S";   ||CLINICA
               nSwRamaEpisodio = 0;
               ||Tengo que averiguar si estoy en una rama
               ||que se corresponde a un episodio en concreto.

               ||ARA38
               sT_nID   = nTree;
               sT_nOper = 4;
               sT_aData = ":" + aNodo;
               |ESPECIFICA "COMMANDCONTROL", sTree;
               aDentro = Contenido;
               |QBF aDentro;

               sT_nID   = nTree;
               sT_nOper = 7;
               sT_aData = ":" + aNodo;
               |ESPECIFICA "COMMANDCONTROL", sTree;
               aNivel = Contenido;
               |QBF aNivel;

               nNivel = 1;         ||Si no tiene comas es nivel 1.
               aLong = aNivel % 0;
               nLong = aLong;
               |PARA nPosi  = 1;  |SI nPosi [ nLong;  |HACIENDO nPosi = nPosi + 1;
                    nPos = (nPosi * 100) + 1;
                    aCarac = aNivel % nPos;
                    |SI aCarac = ",";
                         nNivel = nNivel + 1;
                    |FINSI;
               |SIGUE;

               nBuscaCampo = nNivel * 2;

                                                  ||Valor Vinculado 2. (Episodio)
               |SI #dsarm008#nBuscaCampo# = 98;
                    nSwRamaEpisodio = 1;
                    eaEpisodioBusca = aDentro;
               |FINSI;
          |FINSI;
     |FINSI;

     |ESTADO_CONTROL nBoton0_1,  "DISABLE";
     |ESTADO_CONTROL nBoton0_2,  "DISABLE";
     |ESTADO_CONTROL nBoton0_3,  "DISABLE";
     |ESTADO_CONTROL nBoton0_6,  "DISABLE";
     |ESTADO_CONTROL nBoton0_7,  "DISABLE";
     |ESTADO_CONTROL nBoton0_13, "DISABLE";
     |ESTADO_CONTROL nBoton0_14, "DISABLE";
     |ESTADO_CONTROL nBoton0_15,  "DISABLE";

     |SI nGridTree ! -1;
         |CIERRA #dsarm055;
         |DESTRUYECONTROL nGridTree;
         |FIN_CONTROL_WINDOWS nBtnGuarda;
         nGridTree = -1;
     |FINSI;

     aAlfa = aContenido;  |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     |CIERRA #dsarm055;
     |CIERRA #dsarm056;

     |SI enTemporal = 0;
         aFichero = "va" + (("000000" + #dsarm008#31) % -106);
         |NOME_DAT #dsarm055#aFichero#;
         |PATH_DAT #dsarm055#aDirVistas#;

         aFichero = "vb" + (("000000" + #dsarm008#31) % -106);
         |NOME_DAT #dsarm056#aFichero#;
         |PATH_DAT #dsarm056#aDirVistas#;
     |FINSI;

     |SI enTemporal = 1;
         aFichero = "vy" + ((Usuario + "zzzzzzzz") % 108);
         |NOME_DAT #dsarm055#aFichero#;
         |PATH_DAT #dsarm055#aDirVistas#;

         aFichero = "vz" + ((Usuario + "zzzzzzzz") % 108);
         |NOME_DAT #dsarm056#aFichero#;
         |PATH_DAT #dsarm056#aDirVistas#;
     |FINSI;

     |ABRE #dsarm056;
     |SELECT #2#dsarm056;
     #dsarm056#5 = aContenido;

     |LEE 000#dsarm056.=;
     |SI FSalida = 0;
         eaIdent = #dsarm056#7; |QBF eaIdent;

         |SI eaIdent = "";
             |CIERRA #dsarm008;
             |CIERRA #dsarm056;

             eaCodVista = #dsarm008#0;
             |SUB_EJECUTA "dsarz050";

             |ABRE #dsarm008;
             |ABRE #dsarm056;

             #dsarm008#0 = eaCodVista;
             |LEE 000#dsarm008.=;

             |SELECT #2#dsarm056;
             #dsarm056#5 = aContenido;
             |LEE 000#dsarm056.=;
             |SI FSalida ! 0;  |DDEFECTO #dsarm056;  |FINSI;

             eaIdent = #dsarm056#7; |QBF eaIdent;
         |FINSI;

         |HAZ CreaGrid;

         |ABRE #dsarm055;
         nRango     = 4 + 8 + 16 + 32 + 128;

         |CONTROL_SIMPLE 0, "BOTON,{{217}} ", 2102, 2103, GuardaGrid;
         nBtnGuarda = FSalida;

         |SI #dsarm008#30 = "N";
             |SI #dsarm008#28 = 0;
                 |LINEAL_SIMPLE #2#dsarm055, nRango, nPosDGrid, nPosHGrid, BajaDSARM055_2, AltaDSARM055_2, EventoGridTree;
             |SINO;
                 |LINEAL_SIMPLE #3#dsarm055, nRango, nPosDGrid, nPosHGrid, BajaDSARM055_3, AltaDSARM055_3, EventoGridTree;
             |FINSI;
         |SINO;
             |LINEAL_SIMPLE #4#dsarm055, nRango, nPosDGrid, nPosHGrid, BajaDSARM055_4, AltaDSARM055_4, EventoGridTree;
         |FINSI;
         nGridTree = FSalida;

         |FOCOTECLADO nGridTree;
     |FINSI;
     |CIERRA #dsarm056;

     eaFoco = "CARPETA";

     |PULSATECLA;
|FPRC;

|PROCESO dsarm044;
     |SI #dsarm044#4 = "N";
          nSwHayExclu = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm044;
 #dsarm044#1;
 ;
 #dsarm008#0, "000000000";
 #dsarm008#0, "999999999";
 ;
 NULL, dsarm044;
|FIN;

|PROCESO MiraExcluVistas;
     |BUCLE dsarm044;
|FPRC;

|PROCESO CreaArbol;
     ||ARA66
     ||Tiquet
     |SI aTipoFecha = "1";  |Y #dsarm001#191 = "N";
          |DBASE fich_alta;
          |QBF fich_alta;
          fich_alta = fich_alta + "fich/dsarm005";

          nRegistros = 0;
          primero   = "dsarm005";
          temporal1 = fich_alta;
          |LEEDEDEF primero, temporal1;
          |SI FSalida ] 0;
              temporal1 = FSalida % 375;
              aRegistros = (A\temporal1 % 1615);
              nRegistros = aRegistros;
          |FINSI;

          ||ARA66
          |SI nRegistros > 10000;
               nSwHayExclu = 0;
               |HAZ MiraExcluVistas;
               |SI nSwHayExclu = 0;
                    aMensaje = "0000SSeg£n la cantidad de registros y las acotaciones ";
                    aMensaje = aMensaje + "definidas la vista seleccionada ";
                    aMensaje = aMensaje + "tardar  varios minutos en presentarse." + &10 + "Limitar seg£n fecha?";
                    |CONFI aMensaje;
                    |SI FSalida = 0;
                        |HAZ Boton0_12;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     nSwArbolActivo = 1;

     |ESTADO_CONTROL nBoton0_1,  "HIDE";
     |ESTADO_CONTROL nBoton0_2,  "HIDE";
     |ESTADO_CONTROL nBoton0_3,  "HIDE";
     |ESTADO_CONTROL nBoton0_4,  "HIDE";
     |ESTADO_CONTROL nBoton0_5,  "HIDE";
     |ESTADO_CONTROL nBoton0_6,  "HIDE";
     |ESTADO_CONTROL nBoton0_7,  "HIDE";
     |ESTADO_CONTROL nBoton0_12, "HIDE";
     |ESTADO_CONTROL nBoton0_13, "HIDE";
     |ESTADO_CONTROL nBoton0_14, "HIDE";
     |ESTADO_CONTROL nBoton0_15,  "HIDE";
     |ESTADO_CONTROL nBoton0_16,  "HIDE";
     |SI nSwIpAbogax = 1;
          |ESTADO_CONTROL nBoton0_abogax,  "HIDE";
     |FINSI;
     |SI nBoton0_8   ! -1;  |ESTADO_CONTROL nBoton0_8,  "HIDE";  |FINSI;
     |SI nBoton0_9   ! -1;  |ESTADO_CONTROL nBoton0_9,  "HIDE";  |FINSI;
     |SI nBoton0_10  ! -1;  |ESTADO_CONTROL nBoton0_10, "HIDE";  |FINSI;
     |SI nBoton0_11  ! -1;  |ESTADO_CONTROL nBoton0_11, "HIDE";  |FINSI;
     |SI nEstadoGrid ! -1;  |ESTADO_CONTROL enGrid,      "HIDE";  |FINSI;

     |SI #dsarm001#194 = "S";
          |ESTADO_CONTROL nBotonBuscaPac, "HIDE";
     |FINSI;
     |ESTADO_CONTROL nBotonMas, "HIDE";
     |ESTADO_CONTROL nBotonMulti, "HIDE";

     |HAZ QuitaBotonSalir;

     |VENTANA 0501, 0550, -1, 16, "Procesando vista, espere por favor...";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;
     |PAUSA;

     |SI nGridTree ! -1;
         |CIERRA #dsarm055;
         |DESTRUYECONTROL nGridTree;
         |FIN_CONTROL_WINDOWS nBtnGuarda;
         nGridTree = -1;
     |FINSI;

     nTDocumentos = 0;

     ||ARA38
     |SI #dsarm001#191 = "N";  |O nFichero = 905;
         |HAZ CargaTemporalVista;
     |SINO;
         |SI aParametro = "";
              |SI enDESPANET = 1;
                  |HAZ CargaTemporalVista;
              |SINO;
                  |HAZ CargaRealVista;
              |FINSI;
         |SINO;
              aAlfa = aParametro % 0;
              |SI aAlfa = "5";
                  |HAZ CargaTemporalVista;
              |SINO;
                  |SI enLABORAL = 0;
                      |HAZ CargaTemporalVista;
                  |SINO;
                      |HAZ CargaRealVista;
                  |FINSI;
              |FINSI;
          |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentTrab;

     |SI nTree ! -1;
         |FIN_CONTROL_WINDOWS nTree;
         nTree = -1;
     |FINSI;

     eaAlfa = "TREECTRL," + #dsarm008#0;  |QBF eaAlfa;
     eaAlfa = eaAlfa + " (" + nTDocumentos + " documentos)";
     eaAlfa = eaAlfa + " {{" + aAlfa + "}}";

     |CONTROL_SIMPLE 0, eaAlfa, nPosDRamas, nPosHRamas, EventoTree;
     nTree = FSalida;

     |ESTADO_CONTROL nTree, "HIDE";

     |ESTADO_CONTROL nBoton0_1,  "SHOW";
     |ESTADO_CONTROL nBoton0_2,  "SHOW";
     |ESTADO_CONTROL nBoton0_3,  "SHOW";
     |ESTADO_CONTROL nBoton0_4,  "SHOW";
     |ESTADO_CONTROL nBoton0_5,  "SHOW";
     |ESTADO_CONTROL nBoton0_6,  "SHOW";
     |ESTADO_CONTROL nBoton0_7,  "SHOW";
     |ESTADO_CONTROL nBoton0_12, "SHOW";
     |ESTADO_CONTROL nBoton0_13, "SHOW";
     |ESTADO_CONTROL nBoton0_14, "SHOW";
     |ESTADO_CONTROL nBoton0_15,  "SHOW";
     |SI nSwQuitaBotonAplica = 0;
          |ESTADO_CONTROL nBoton0_16,  "SHOW";
     |FINSI;

     |SI nSwIpAbogax = 1;
          |ESTADO_CONTROL nBoton0_abogax,  "SHOW";
     |FINSI;

     |SI nBoton0_8   ! -1;  |ESTADO_CONTROL nBoton0_8,  "SHOW";  |FINSI;
     |SI nBoton0_9   ! -1;  |ESTADO_CONTROL nBoton0_9,  "SHOW";  |FINSI;
     |SI nBoton0_10  ! -1;  |ESTADO_CONTROL nBoton0_10, "SHOW";  |FINSI;
     |SI nBoton0_11  ! -1;  |ESTADO_CONTROL nBoton0_11, "SHOW";  |FINSI;
     |SI nEstadoGrid ! -1;  |ESTADO_CONTROL enGrid,     "SHOW";  |FINSI;

     |SI #dsarm001#194 = "S";
          |ESTADO_CONTROL nBotonBuscaPac, "SHOW";
     |FINSI;
     |ESTADO_CONTROL nBotonMas, "SHOW";
     |ESTADO_CONTROL nBotonMulti, "SHOW";

     |HAZ PonBotonSalir;

     |HAZ CreaGrid;

     |ABRE #dsarm055;
|FPRC;

|PROCESO PresentaArbol;
     nSwArbolActivo = 1;

     |PULSATECLA;

     |ESTADO_CONTROL nTree, "SHOW";

     |SI nGridTree ! -1;
         |ESTADO_CONTROL nGridTree, "SHOW";
         |ESTADO_CONTROL nBtnGuarda, "SHOW";
     |FINSI;

     |SI #dsarm001#184 = "S";
         #dsarm055#0 = aBusca;
         |LEE 000#dsarm055.=;
         |SI FSalida = 0;
              aBusca = #dsarm055#1;

              sT_nID   = nTree;
              sT_nOper = 3;
              sT_aData = "[" + aBusca;
              |ESPECIFICA "COMMANDCONTROL", sTree;
              aRefresca = ":" + FSalida;
         |FINSI;
     |FINSI;

     sT_nID   = nTree;
     sT_nOper = 2;
     |SI aRefresca = "";
         sT_aData = "1:";
     |SINO;
         sT_aData = aRefresca;
     |FINSI;

     |ESPECIFICA "COMMANDCONTROL", sTree;
     |PULSATECLA;

     |FOCOTECLADO nTree;
     |SI nGridTree ! -1;  |FOCOTECLADO nGridTree;  |FINSI;
|FPRC;

|PROCESO dsarm008;
     |DDEFECTO #dsarm043;
     #dsarm043#0 = aUsuarioVista;
     #dsarm043#1 = #dsarm008#0;
     |LEE 000#dsarm043.=;
     |SI FSalida = 0; |Y #dsarm043#2 = "N";
          |ACABA;
     |FINSI;

     nContador = nContador + 1;

     eaAlfa     = #dsarm008#0;  |QBF eaAlfa;
     aOpcion    = eaAlfa;

     |HAZ QuitaRaros;
     aPopup    = eaAlfa;

     IaPopup   = IaPopup  + 1;
     IaOpcion  = IaOpcion + 1;
|FPRC;

|DEFBUCLE dsarm008;
     #dsarm008#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsarm008;
|FIN;

|PROCESO ControlBorraCache;
     |SI #dsarm001#181 = "S";
          |SI eaBorraCache ! "";
               |RFBORRA eaBorraCache;
               eaBorraCache = "";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Boton0_15;
     |SI nFichero = 0;
         enDocumento = #dsarm005#0;
     |SINO;
         enDocumento = #dsarm005@#0;
     |FINSI;

     |VENTANA 0501, 3599, -1, 16, "Visualizar Documento";
     nVentm5 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |HAZ ControlBorraCache;

     |SUB_EJECUTA_NP "dsarw006;VERDOCUMENTO";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentm5;
|FPRC;

|PROCESO dsarm034_esta;
     nSwEstaBandeja = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE dsarm034_esta;
 #dsarm034#2;
 ;
 enDocumento;
 enDocumento;
 ;
 NULL, dsarm034_esta;
|FIN;

|PROCESO MiraSiObligatorios;
     |ABRE #dsarm004;
     |DDEFECTO #dsarm004;
     #dsarm004#0 = enGrupoPV;
     #dsarm004#1 = enSubGrupoPV;
     #dsarm004#2 = enTipoPV;
     |LEE 000#dsarm004.=;

     ||ARA1
     ||Tengo que controlar si me tocar meter el documento en la bandeja DsEscan
     ||de forma manual.
     nSwCreaBanDSEscanManual = 0;
     |SI #dsarm004#87 = "S";
          nSwEstaBandeja = 0;
          |BUCLE dsarm034_esta;
          |SI nSwEstaBandeja = 0;
               efFechaBandeja = "01.01.0000";
               eaHoraBandeja = "";
               eaNombreBandeja = "";

               aAlfa = "dsarz013;BANDEJADSESCANMANUAL";
               |SUB_EJECUTA aAlfa;

               |SI eaHoraBandeja ! "";
                    nSwCreaBanDSEscanManual = 1;
               |FINSI;
          |FINSI;
     |FINSI;



     |SI #dsarm004#20 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#21 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#22 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#23 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#24 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#55 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#56 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#57 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#58 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#59 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#60 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#61 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#62 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#63 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#64 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#65 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#66 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#67 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#68 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#69 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#70 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#71 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#72 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#73 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#74 = "S"; nSwObligatorios = 1; |FINSI;
     |CIERRA #dsarm004;
|FPRC;

|PROCESO flowm005;
     |BORRA 020#flowm005.a;
     #flowm005#1 = nGrupo;
     #flowm005#2 = nSubGrupo;
     #flowm005#3 = nTipo;
     #flowm005#4 = 001;
     |GRABA 040#flowm005.n;
     |LIBERA #flowm005;

     nSwHayFlow = 1;
|FPRC;

|DEFBUCLE flowm005;
 #flowm005#2;
 ;
 #dsarm005#0, "          ", nGrupoAnt, nSubGruAnt, nTipoAnt, 000;
 #dsarm005#0, "zzzzzzzzzz", nGrupoAnt, nSubGruAnt, nTipoAnt, 999;
 be;
 NULL, flowm005;
|FIN;


|PROCESO flowm004_m005;
     |SI nPasada = 0;
         nUsuarios  = nUsuarios + 1;
         |ACABA;
     |FINSI;

     |DDEFECTO #flowm005;

     #flowm005#0  = #flowm004#4;
     #flowm005#1  = #flowm004#0;
     #flowm005#2  = #flowm004#1;
     #flowm005#3  = #flowm004#2;
     #flowm005#4  = #flowm004#3;
     #flowm005#5  = #dsarm005#0;
     |LEE 101#flowm005.=;
     |SI FSalida ! 0; |GRABA 020#flowm005.b; |FINSI;

     #flowm005#6  = #dsarm005#4;
     #flowm005#7  = aHora;
     #flowm005#8  = "E";
     #flowm005#9  = "0,0,0;0,255,0";
     #flowm005#10  = #dsarm005#6;
     #flowm005#11  = #dsarm005#10;
     #flowm005#12  = #dsarm005#38;
     #flowm005#13  = #dsarm005#23;
     #flowm005#14  = #dsarm005#24;
     #flowm005#15  = #dsarm005#25;
     #flowm005#16  = #dsarm005#26;
     #flowm005#17  = #dsarm005#27;
     #flowm005#18  = #dsarm005#28;

     |SI nUsuarios > 1;
         #flowm005#8  = "C";
         #flowm005#9  = "0,0,0;255,255,0";
     |FINSI;

     |GRABA 020#flowm005.a;
     |LIBERA #flowm005;
|FPRC;

|DEFBUCLE flowm004_m005;
     #flowm004#1;
     ;
     #flowm002#0, #flowm002#1, #flowm002#2, #flowm002#3, "          ";
     #flowm002#0, #flowm002#1, #flowm002#2, #flowm002#3, "zzzzzzzzzz";
     ;
     NULL, flowm004_m005;
|FIN;

|PROCESO ActualizaWorkflow;
     nSwHayFlow = 0;
     |BUCLE flowm005;

||Ahora, siempre se realiza el control del workflow. Tiquet. 4182.56
||     |SI nSwHayFlow = 0;
          ||Miro si ahora debe entrar en el workflow. (Ver tipo 15 del PLB).

          |ABRE #flowm001;
          #flowm001#0 = nGrupo;
          #flowm001#1 = nSubGrupo;
          #flowm001#2 = nTipo;
          |LEE 000#flowm001.=;
          |SI FSalida ! 0;
              |CIERRA #flowm001;
              |ACABA;
          |FINSI;
          |CIERRA #flowm001;

          |ABRE #flowm002;
          #flowm002#0 = #flowm001#0;
          #flowm002#1 = #flowm001#1;
          #flowm002#2 = #flowm001#2;
          #flowm002#3 = 1;
          |LEE 000#flowm002.];
          |SI FSalida ! 0;  |O #flowm002#0 ! #flowm001#0;  |O #flowm002#1 ! #flowm001#1;
                            |O #flowm002#2 ! #flowm001#2;
              |CIERRA #flowm002;
              |ACABA;
          |FINSI;
          |CIERRA #flowm002;

          ||Historico
          |HORA aHora;
          aUsuario = Usuario % 810;
          |ABRE #flowm006;
          #flowm006#0  = #dsarm005#0;
          #flowm006#1  = 99999;
          |LEE 000#flowm006.];
          |SI FSalida = 0;
               |LEE 000#flowm006.a;
          |SINO;
               |LEE 000#flowm006.u;
          |FINSI;
          |SI FSalida = 0; |Y #flowm006#0  = #dsarm005#0;
               nLinea = #flowm006#1 + 1;
               nSitu = #flowm006#2;
          |SINO;
               nSitu = 1;
               nLinea = 1;
          |FINSI;
          |SI nSitu = 0; nSitu = 1; |FINSI;

          |DDEFECTO #flowm006;
          #flowm006#0  = #dsarm005#0;
          #flowm006#1  = nLinea;
          |LEE 101#flowm006.=;
          |SI FSalida ! 0; |GRABA 020#flowm006.b; |FINSI;
          #flowm006#2  = nSitu;
          #flowm006#3  = ~;
          #flowm006#4  = aHora;
          #flowm006#5  = aUsuario;
          #flowm006#6 = "ENTRADA WORKFLOW";

          enNumRegFlow = #flowm006#0;
          enSituFlow = #flowm006#2;
          |HAZ DimeDesFlow;
          #flowm006#7 = eaDesSituFlow;

          |GRABA 020#flowm006.a;
          |LIBERA #flowm006;
          |CIERRA #flowm006;

          nUsuarios = 0;

          |ABRE #flowm005;
          nPasada = 0;  |BUCLE flowm004_m005;
          nPasada = 1;  |BUCLE flowm004_m005;
          |CIERRA #flowm005;
||     |FINSI;
|FPRC;

|PROCESO dsarm030_borraReg;
     |BORRA 020#dsarm030.a;
|FPRC;

|PROCESO Baja30;
     #dsarm030#0 = nRegDocu;
     #dsarm030#1 = 1;
|FPRC;

|PROCESO Alta30;
     #dsarm030#0 = nRegDocu;
     #dsarm030#1 = 99999;
|FPRC;

|PROCESO Evento30;
|FPRC;

|DEFBUCLE dsarm030_borraReg;
 #dsarm030#1;
 ;
 nRegDocu,     0;
 nRegDocu, 99999;
 be;
 NULL, dsarm030_borraReg;
|FIN;

|PROCESO dsarm031_borraReg;
     |BORRA 020#dsarm031.a;
|FPRC;

|DEFBUCLE dsarm031_borraReg;
 #dsarm031#1;
 ;
 nRegDocu, 000;
 nRegDocu, 999;
 be;
 NULL, dsarm031_borraReg;
|FIN;

|PROCESO dsarm031_mete;
     nCampo = #dsarm031#1;
     aValor = #dsarm031#2;

     |SI nCampo ] 23; |Y nCampo [ 37;
          aAux2 = #dsarm005#nCampo#;
          |QBF aAux2;
          |SI aAux2 ! "";
               aAux2 = aAux2 + " " + aValor;
               |QBF aAux2;
               #dsarm005#nCampo# = aAux2;
          |SINO;
               #dsarm005#nCampo# = aValor;
          |FINSI;
     |SINO;
          |SI nCampo ] 60; |Y nCampo [ 64;
               aAux2 = #dsarm005#nCampo#;
               |QBF aAux2;
               |SI aAux2 ! "";
                    aAux2 = aAux2 + " " + aValor;
                    |QBF aAux2;
                    #dsarm005#nCampo# = aAux2;
               |SINO;
                    #dsarm005#nCampo# = aValor;
               |FINSI;
          |SINO;
               #dsarm005#nCampo# = aValor;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm031_mete;
 #dsarm031#1;
 ;
 nRegDocu, 001;
 nRegDocu, 999;
 ;
 NULL, dsarm031_mete;
|FIN;

|PROCESO PonEtiquetas;
     nContDos = nContDos + 1;
     aAux = #dsarm004#nCampo#;
     |QBF aAux;
     |SI aAux ! "";
          nContReal = nContReal + 1;

          |SI nContReal < 16;
               nCampo1 = 22 + nContReal;
          |SINO;
               nCampo1 = 44 + nContReal;
          |FINSI;

          aTexto = aAux;
          |QBF aTexto;
          aTexto = aTexto + ": ";
          #dsarm005#nCampo1# = aTexto;
     |FINSI;
|FPRC;

|PROCESO dsarm035_borraBja;
     |BORRA 020#dsarm035.a;
|FPRC;

|DEFBUCLE dsarm035_borraBja;
 #dsarm035#1;
 ;
 efFechaBandeja, eaHoraBandeja, eaNombreBandeja, aVacio25;
 efFechaBandeja, eaHoraBandeja, eaNombreBandeja, aZeta25;
 be;
 NULL, dsarm035_borraBja;
|FIN;

|PROCESO dsarm034_borraBja;
     |BORRA 020#dsarm034.a;
     |BUCLE dsarm035_borraBja;
|FPRC;

|DEFBUCLE dsarm034_borraBja;
 #dsarm034#1;
 ;
 efFechaBandeja, eaHoraBandeja, eaNombreBandeja;
 efFechaBandeja, eaHoraBandeja, eaNombreBandeja;
 be;
 NULL, dsarm034_borraBja;
|FIN;


|PROCESO Boton0_14;
     |SI enSwBandejaErrOCR = 1;
          enEmpDS9Mov = 0;
          eaSerDS9Mov = "";
          enNumDS9Mov = 0;
          enSwDS9Mov = 0;
          |HAZ MoverBandejaErrOCR;

          |SI enSwDS9Mov = 1;
               ||aMensaje = "0000Mover doc " + #dsarm005#0 + " adjuntando alb. " + eaSerDS9Mov + "/" + enNumDS9Mov;
               ||MENAV aMensaje;
               ||ARA39
               ||MOVER EL DOCUMENTO AL G/S/T destino

               enGrupoPV = enGrupoOCRYes;
               enSubGrupoPV = enSubGrupoOCRYes;
               enTipoPV = enTipoOCRYes;

               nSwObligatorios = 0;
               |HAZ MiraSiObligatorios;
               |SI nSwObligatorios = 1;
                    |SI nFichero = 0;
                        enDocumento = #dsarm005#0;
                    |SINO;
                        enDocumento = #dsarm005@#0;
                    |FINSI;

                    |VENTANA 0501, 3599, -1, 16, "Datos Documentos";
                    nVentm5 = FSalida;

                    aVent1 = -1;
                    aVent2 = -1;
                    aVent3 = 0;
                    aVent4 = nVentm5;
                    aVent5 = "MODAL";
                    |ESPECIFICA "ESTADO_VENTANA", aVent;
                    |PULSATECLA;

                    |PTEC 802;  |PAUSA;

                    enMueveDoc = 1;
                    |SUB_EJECUTA_NP "dsarw006";
                    enMueveDoc = 0;

                    aVent1 = -1;
                    aVent2 = -1;
                    aVent3 = 0;
                    aVent4 = nVentm5;
                    aVent5 = "MODELESS";
                    |ESPECIFICA "ESTADO_VENTANA", aVent;

                    |FINVENTANA nVentm5;

                    |SI enSwErrorModiw006 = 1;
                        |MENAV "0000Proceso cancelado.";
                        |FOCOTECLADO enGrid;
                        |ACABA;
                    |FINSI;
               |FINSI;

               |FOCOTECLADO enGrid;

               ||ARA39
               aBusca = ("000000000" + #dsarm005#0) % -109;
               #dsarm005#0 = aBusca;
               |LEE 101#dsarm005.=;
               |SI FSalida = 0;
                    nGrupoAnt = #dsarm005#1;
                    nSubGruAnt = #dsarm005#2;
                    nTipoAnt = #dsarm005#3;

                    nGrupo = enGrupoPV;
                    nSubGrupo = enSubGrupoPV;
                    nTipo = enTipoPV;
                    |SI nGrupoAnt ! nGrupo; |O nSubGruAnt ! nSubGrupo; |O nTipoAnt ! nTipo;
                         ||Tengo que mover el documento a la nueva ubicacion.
                         ||TODO CCC
                         aFichero = #dsarm005#7;
                         |QBF aFichero;
                         aCarpetaOrigen = aFichero;
                         |QBF aCarpetaOrigen;

                         aFichero = aFichero + #dsarm005#9;
                         |QBF aFichero;
                         aOrigen  = aFichero;

                         aDestino = #dsarm001#1;
                         |QBF aDestino;
                         |ABRE #dsarm002;
                         |DDEFECTO #dsarm002;
                         #dsarm002#0 = nGrupo;
                         |LEE 000#dsarm002.=;
                         |SI FSalida = 0;
                              aDestino = aDestino + "/" + #dsarm002#2;
                              |QBF aDestino;
                              |SI #dsarm001#7 = "N";
                                   |MKDIR aDestino;
                              |SINO;
                                   |RMKDIR aDestino;
                              |FINSI;
                              |SI #dsarm001#8 = "N"; ||NO Usan Grupo, Subgrupo y Tipo
                                   |ABRE #dsarm004;
                                   |DDEFECTO #dsarm004;
                                   #dsarm004#0 = nGrupo;
                                   #dsarm004#1 = 1;
                                   #dsarm004#2 = 1;
                                   |LEE 000#dsarm004.=;
                                   |SI FSalida = 0;
                                        |SI #dsarm004#75 = "S";
                                             aFechaSis = #dsarm005#4;
                                             aAAAAMM = (aFechaSis % -104) + (aFechaSis % 402);
                                             aDestino = aDestino + "/" + aAAAAMM;
                                             |SI #dsarm001#7 = "N";
                                                  |MKDIR aDestino;
                                             |SINO;
                                                  |RMKDIR aDestino;
                                             |FINSI;
                                        |FINSI;
                                   |FINSI;
                                   |CIERRA #dsarm004;
                              |FINSI;
                         |FINSI;
                         |CIERRA #dsarm002;

                         |SI #dsarm001#8 = "S"; ||Usan Grupo, Subgrupo y Tipo
                              |ABRE #dsarm003;
                              |DDEFECTO #dsarm003;
                              #dsarm003#0 = nGrupo;
                              #dsarm003#1 = nSubGrupo;
                              |LEE 000#dsarm003.=;
                              |SI FSalida = 0;
                                   aDestino = aDestino + "/" + #dsarm003#3;
                                   |QBF aDestino;
                                   |SI #dsarm001#7 = "N";
                                        |MKDIR aDestino;
                                   |SINO;
                                        |RMKDIR aDestino;
                                   |FINSI;
                              |FINSI;
                              |CIERRA #dsarm003;
                              |ABRE #dsarm004;
                              |DDEFECTO #dsarm004;
                              #dsarm004#0 = nGrupo;
                              #dsarm004#1 = nSubGrupo;
                              #dsarm004#2 = nTipo;
                              |LEE 000#dsarm004.=;
                              |SI FSalida = 0;
                                   aDestino = aDestino + "/" + #dsarm004#4;
                                   |QBF aDestino;
                                   |SI #dsarm001#7 = "N";
                                        |MKDIR aDestino;
                                   |SINO;
                                        |RMKDIR aDestino;
                                   |FINSI;
                              |FINSI;
                              |CIERRA #dsarm004;
                              |SI #dsarm004#75 = "S";
                                   aFechaSis = #dsarm005#4;
                                   aAAAAMM = (aFechaSis % -104) + (aFechaSis % 402);
                                   aDestino = aDestino + "/" + aAAAAMM;
                                   |SI #dsarm001#7 = "N";
                                        |MKDIR aDestino;
                                   |SINO;
                                        |RMKDIR aDestino;
                                   |FINSI;
                              |FINSI;
                         |FINSI;

                         aDestino = aDestino + "/";
                         #dsarm005#7 = aDestino;

                         aCarpetaDestino = aDestino;

                         aDestino = aDestino + #dsarm005#9;
                         |QBF aDestino;

                         |SI #dsarm001#7 = "N";
                              |RENOMBRA_FICHERO aOrigen, aDestino;
                         |SINO;
                              |RRENOMBRA_FICHERO aOrigen, aDestino;
                         |FINSI;
                         nSalidaHis = FSalida;

                         aFicAux = #dsarm005#92;
                         |QBF aFicAux;
                         |SI aFicAux ! "";
                              aOrigen = aCarpetaOrigen + aFicAux;
                              aDestino = aCarpetaDestino + aFicAux;
                              |SI #dsarm001#7 = "N";
                                   |RENOMBRA_FICHERO aOrigen, aDestino;
                              |SINO;
                                   |RRENOMBRA_FICHERO aOrigen, aDestino;
                              |FINSI;
                         |FINSI;

                         aFicAux = #dsarm005#96;
                         |QBF aFicAux;
                         |SI aFicAux ! "";
                              aOrigen = aCarpetaOrigen + aFicAux;
                              aDestino = aCarpetaDestino + aFicAux;
                              |SI #dsarm001#7 = "N";
                                   |RENOMBRA_FICHERO aOrigen, aDestino;
                              |SINO;
                                   |RRENOMBRA_FICHERO aOrigen, aDestino;
                              |FINSI;
                         |FINSI;
                         aFicAux = #dsarm005#9;
                         |QBF aFicAux;
                         aFicAux = aFicAux + ".txt";
                         nSwExisteOCR = 0;      ||Si existe el resultado del OCR
                         aOrigen = aCarpetaOrigen + aFicAux;
                         |SI #dsarm001#7 = "N";
                              |XABRE "E", aOrigen, 0;
                              |SI FSalida ] 0;
                                   nSwExisteOCR = 1;
                              |SINO;
                                   nSwExisteOCR = 0;
                              |FINSI;
                         |SINO;
                              |XABRE "CE", aOrigen, 0;
                              |SI FSalida ] 0;
                                   nSwExisteOCR = 1;
                              |SINO;
                                   nSwExisteOCR = 0;
                              |FINSI;
                         |FINSI;

                         |SI nSwExisteOCR = 1;
                              aOrigen = aCarpetaOrigen + aFicAux;
                              aDestino = aCarpetaDestino + aFicAux;
                              |SI #dsarm001#7 = "N";
                                   |RENOMBRA_FICHERO aOrigen, aDestino;
                              |SINO;
                                   |RRENOMBRA_FICHERO aOrigen, aDestino;
                              |FINSI;
                         |FINSI;
                    |FINSI;

                    ||Historico
                    |HORA aHora;
                    aUsuario = Usuario % 810;
                    |ABRE #flowm006;
                    #flowm006#0  = #dsarm005#0;
                    #flowm006#1  = 99999;
                    |LEE 000#flowm006.];
                    |SI FSalida = 0;
                         |LEE 000#flowm006.a;
                    |SINO;
                         |LEE 000#flowm006.u;
                    |FINSI;
                    |SI FSalida = 0; |Y #flowm006#0  = #dsarm005#0;
                         nLinea = #flowm006#1 + 1;
                         nSitu = #flowm006#2;
                    |SINO;
                         nSitu = 0;
                         nLinea = 1;
                    |FINSI;
                    |DDEFECTO #flowm006;
                    #flowm006#0  = #dsarm005#0;
                    #flowm006#1  = nLinea;
                    |LEE 101#flowm006.=;
                    |SI FSalida ! 0; |GRABA 020#flowm006.b; |FINSI;
                    #flowm006#2  = nSitu;
                    #flowm006#3  = ~;
                    #flowm006#4  = aHora;
                    #flowm006#5  = aUsuario;
                    aOriHis = (("000" + nGrupoAnt) % -103) + "/" + (("000" + nSubGruAnt) % -103) + "/" + (("000" + nTipoAnt) % -103)
                    aDesHis = (("000" + nGrupo) % -103) + "/" + (("000" + nSubGrupo) % -103) + "/" + (("000" + nTipo) % -103)

                    #flowm006#6  = "MOVIDO DE " + aOriHis + " A " + aDesHis + ". [" + nSalidaHis + "]";

                    enNumRegFlow = #flowm006#0;
                    enSituFlow = #flowm006#2;
                    |HAZ DimeDesFlow;
                    #flowm006#7 = eaDesSituFlow;

                    |GRABA 020#flowm006.a;
                    |LIBERA #flowm006;
                    |CIERRA #flowm006;

                    #dsarm005#1 = nGrupo;
                    #dsarm005#2 = nSubGrupo;
                    #dsarm005#3 = nTipo;

                    |SI enSwVinculosExternos = 1; |Y nSwConsultaVinExternos = 1;
                         |SI eaTipoVinculo = "CLINICA";
                              |SI aVinculo1Antes = ""; |Y eaValorVinculo1 ! "";
                                   #dsarm005#97 = eaValorVinculo1;
                                   #dsarm005#98 = eaValorVinculo2;
                                   #dsarm005#13 = eaValorVinculoAux;

                                   enNumRegVincuExte = #dsarm005#0;
                                   |HAZ GrabaVincuExte;
                              |SINO;
                                   |SI aVinculo1Antes ! eaValorVinculo1; |O aVinculo2Antes ! eaValorVinculo2;
                                        aMensaje = "0000SHa modificado el valor del vinculo externo." + &10 + "Desea Actualizar el registro?";
                                        |CONFI aMensaje;
                                        |SI FSalida = 0;
                                            #dsarm005#97 = eaValorVinculo1;
                                            #dsarm005#98 = eaValorVinculo2;
                                            #dsarm005#13 = eaValorVinculoAux;

                                            enNumRegVincuExte = #dsarm005#0;
                                            |HAZ GrabaVincuExte;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;

                    #dsarm005#84 = "AV";
                    #dsarm005#85 = eaSerDS9Mov;
                    #dsarm005#86 = enNumDS9Mov;
                    #dsarm005#88 = enEmpDS9Mov;

                    |GRABA 020#dsarm005.a;
                    |LIBERA #dsarm005;

                    ||Para enviar el documento al dserp
                    enNumDSerpAV = 0;
                    enSwEstaAV = 0;
                    eaSerieAV = eaSerDS9Mov;
                    enNumeroAV = enNumDS9Mov;
                    enEmpresaAV = enEmpDS9Mov;
                    |HAZ AVEstaEnDscomer9;

                    |SI enSwEstaAV = 1;
                         eaPathFichero = #dsarm005#7;
                         |QBF eaPathFichero;
                         eaPathFichero = eaPathFichero + #dsarm005#9;
                         |QBF eaPathFichero;

                         aEjecuta = "dsarz060";
                         |SUB_EJECUTA_NP aEjecuta;

                         |LEE 101#dsarm005.=;
                         |SI FSalida = 0;
                              #dsarm005#97 = "dserp:dscomer9." + enNumDSerpAV;
                              |GRABA 020#dsarm005.a;
                              |LIBERA #dsarm005;
                         |FINSI;
                    |FINSI;

                    aAlfa = "dsarz030;" + #dsarm005#0;
                    |SUB_EJECUTA aAlfa;

                    |REFRESCACONTROL enGrid;
               |FINSI;

               ||MOVER EL DOCUMENTO AL G/S/T destino
               ||Actulizar los campos del dsarm005
               ||Y crear el documento en el dserp.
          |FINSI;

          |ACABA;
     |FINSI;

     |SI enSwADContD = 1;
          aMensaje = "0000NDesea dejar el Documento en Pendientes de Vincular?";
          |CONFI aMensaje;
          |SI FSalida ! 0;
               aMensaje = "0000Proceso cancelado";
               |MENAV aMensaje;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI nFichero = 0;
         aBusca = ("000000000" + #dsarm005#0) % -109;
     |SINO;
         aBusca = ("000000000" + #dsarm005@#0) % -109;
     |FINSI;

     #dsarm005#0 = aBusca;
     |LEE 000#dsarm005.=;
     |SI FSalida = 0;
          aAuxNom = #dsarm005#9;
          |QBF aAuxNom;
          |SI aAuxNom = "-DOCUMENTOWEB-";
               aMensaje = "0000No es posible mover documentos:llamadas Asterisk";
               |MENAV aMensaje;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI enSwADContD = 1;
          enSwError = 0;
          |HAZ DestinoDesvincula;
          |SI enSwError = 0;
               #dsarm005#0 = aBusca;
               |LEE 101#dsarm005.=;
               |SI FSalida = 0;
                    nGrupoAnt = #dsarm005#1;
                    nSubGruAnt = #dsarm005#2;
                    nTipoAnt = #dsarm005#3;

                    nGrupo = enGrupoPV;
                    nSubGrupo = enSubGrupoPV;
                    nTipo = enTipoPV;
                    |SI nGrupoAnt ! nGrupo; |O nSubGruAnt ! nSubGrupo; |O nTipoAnt ! nTipo;
                         ||Tengo que mover el documento a la nueva ubicacion.
                         ||TODO CCC
                         aFichero = #dsarm005#7;
                         |QBF aFichero;
                         aCarpetaOrigen = aFichero;
                         |QBF aCarpetaOrigen;
                         aFichero = aFichero + #dsarm005#9;
                         |QBF aFichero;
                         aOrigen  = aFichero;

                         aDestino = #dsarm001#1;
                         |QBF aDestino;
                         |ABRE #dsarm002;
                         |DDEFECTO #dsarm002;
                         #dsarm002#0 = nGrupo;
                         |LEE 000#dsarm002.=;
                         |SI FSalida = 0;
                              aDestino = aDestino + "/" + #dsarm002#2;
                              |QBF aDestino;
                              |SI #dsarm001#7 = "N";
                                   |MKDIR aDestino;
                              |SINO;
                                   |RMKDIR aDestino;
                              |FINSI;
                         |FINSI;
                         |CIERRA #dsarm002;

                         |SI #dsarm001#8 = "S"; ||Usan Grupo, Subgrupo y Tipo
                              |ABRE #dsarm003;
                              |DDEFECTO #dsarm003;
                              #dsarm003#0 = nGrupo;
                              #dsarm003#1 = nSubGrupo;
                              |LEE 000#dsarm003.=;
                              |SI FSalida = 0;
                                   aDestino = aDestino + "/" + #dsarm003#3;
                                   |QBF aDestino;
                                   |SI #dsarm001#7 = "N";
                                        |MKDIR aDestino;
                                   |SINO;
                                        |RMKDIR aDestino;
                                   |FINSI;
                              |FINSI;
                              |CIERRA #dsarm003;
                              |ABRE #dsarm004;
                              |DDEFECTO #dsarm004;
                              #dsarm004#0 = nGrupo;
                              #dsarm004#1 = nSubGrupo;
                              #dsarm004#2 = nTipo;
                              |LEE 000#dsarm004.=;
                              |SI FSalida = 0;
                                   aDestino = aDestino + "/" + #dsarm004#4;
                                   |QBF aDestino;
                                   |SI #dsarm001#7 = "N";
                                        |MKDIR aDestino;
                                   |SINO;
                                        |RMKDIR aDestino;
                                   |FINSI;
                              |FINSI;
                              |CIERRA #dsarm004;
                              |SI #dsarm004#75 = "S";
                                   aFechaSis = #dsarm005#4;
                                   aAAAAMM = (aFechaSis % -104) + (aFechaSis % 402);
                                   aDestino = aDestino + "/" + aAAAAMM;
                                   |SI #dsarm001#7 = "N";
                                        |MKDIR aDestino;
                                   |SINO;
                                        |RMKDIR aDestino;
                                   |FINSI;
                              |FINSI;
                         |FINSI;

                         aDestino = aDestino + "/";
                         #dsarm005#7 = aDestino;

                         aCarpetaDestino = aDestino;
                         |QBF aCarpetaDestino;

                         aDestino = aDestino + #dsarm005#9;
                         |QBF aDestino;

                         |SI #dsarm001#7 = "N";
                              |RENOMBRA_FICHERO aOrigen, aDestino;
                         |SINO;
                              |RRENOMBRA_FICHERO aOrigen, aDestino;
                         |FINSI;

                         aFicAux = #dsarm005#92;
                         |QBF aFicAux;
                         |SI aFicAux ! "";
                              aOrigen = aCarpetaOrigen + aFicAux;
                              aDestino = aCarpetaDestino + aFicAux;
                              |SI #dsarm001#7 = "N";
                                   |RENOMBRA_FICHERO aOrigen, aDestino;
                              |SINO;
                                   |RRENOMBRA_FICHERO aOrigen, aDestino;
                              |FINSI;
                         |FINSI;
                         aFicAux = #dsarm005#96;
                         |QBF aFicAux;
                         |SI aFicAux ! "";
                              aOrigen = aCarpetaOrigen + aFicAux;
                              aDestino = aCarpetaDestino + aFicAux;
                              |SI #dsarm001#7 = "N";
                                   |RENOMBRA_FICHERO aOrigen, aDestino;
                              |SINO;
                                   |RRENOMBRA_FICHERO aOrigen, aDestino;
                              |FINSI;
                         |FINSI;

                         aFicAux = #dsarm005#9;
                         |QBF aFicAux;
                         aFicAux = aFicAux + ".txt";
                         nSwExisteOCR = 0;      ||Si existe el resultado del OCR
                         aOrigen = aCarpetaOrigen + aFicAux;
                         |SI #dsarm001#7 = "N";
                              |XABRE "E", aOrigen, 0;
                              |SI FSalida ] 0;
                                   nSwExisteOCR = 1;
                              |SINO;
                                   nSwExisteOCR = 0;
                              |FINSI;
                         |SINO;
                              |XABRE "CE", aOrigen, 0;
                              |SI FSalida ] 0;
                                   nSwExisteOCR = 1;
                              |SINO;
                                   nSwExisteOCR = 0;
                              |FINSI;
                         |FINSI;

                         |SI nSwExisteOCR = 1;
                              aOrigen = aCarpetaOrigen + aFicAux;
                              aDestino = aCarpetaDestino + aFicAux;
                              |SI #dsarm001#7 = "N";
                                   |RENOMBRA_FICHERO aOrigen, aDestino;
                              |SINO;
                                   |RRENOMBRA_FICHERO aOrigen, aDestino;
                              |FINSI;
                         |FINSI;
                    |FINSI;

                    #dsarm005#1 = nGrupo;
                    #dsarm005#2 = nSubGrupo;
                    #dsarm005#3 = nTipo;

                    #dsarm005#67 = 0;
                    #dsarm005#68 = 0;
                    #dsarm005#69 = 0;
                    #dsarm005#70 = "01.01.0000";
                    #dsarm005#71 = 0;
                    #dsarm005#72 = 0;
                    #dsarm005#73 = 0;
                    #dsarm005#74 = "";
                    #dsarm005#75 = "";
                    #dsarm005#76 = "";
                    |GRABA 020#dsarm005.a;
                    |LIBERA #dsarm005;
               |FINSI;
               |SI nFichero = 0;
                    |REFRESCACONTROL enGrid;
               |SINO;
                    #dsarm005@#0 = aBusca;
                    |LEE 101#dsarm005@.=;
                    |SI FSalida = 0;
                        |PARA nConta = 1; |SI nConta [ 76; |HACIENDO nConta = nConta + 1;
                              #dsarm005@#nConta# = #dsarm005#nConta#;
                        |SIGUE;
                        |GRABA 020#dsarm005@.a;

                        |LIBERA #dsarm005@;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
||**************************************************************************
          ||PRIMERO OBTENGO, EL DESTINO DONDE MOVEREMOS EL DOCUMENTO.  INI
||**************************************************************************
          ||Usar similar al boton Copiar (Boton0_6)

          |VENTANA 0501, 2799, -1, 16, "Mover Documentos";
          nVentm5 = FSalida;

          aVent1 = -1;
          aVent2 = -1;
          aVent3 = 0;
          aVent4 = nVentm5;
          aVent5 = "MODAL";
          |ESPECIFICA "ESTADO_VENTANA", aVent;

          |SI nFichero = 0;
              enDocumento = #dsarm005#0;
              nGrupoAra = #dsarm005#1;
              nSubGrupoAra = #dsarm005#2;
              nTipoAra = #dsarm005#3;
          |SINO;
              enDocumento = #dsarm005@#0;
              nGrupoAra = #dsarm005@#1;
              nSubGrupoAra = #dsarm005@#2;
              nTipoAra = #dsarm005@#3;
          |FINSI;

          enGrupoPV = 0;
          enSubGrupoPV = 0;
          enTipoPV = 0;

          enMueveDoc = 1;

          |SUB_EJECUTA "dsarz003";

          enMueveDoc = 0;

          aVent1 = -1;
          aVent2 = -1;
          aVent3 = 0;
          aVent4 = nVentm5;
          aVent5 = "MODELESS";
          |ESPECIFICA "ESTADO_VENTANA", aVent;

          |FINVENTANA nVentm5;

          |SI enGrupoPV = 0; |Y enSubGrupoPV = 0; |Y enTipoPV = 0;
               |ACABA;
          |FINSI;
||**************************************************************************
          ||PRIMERO OBTENGO, EL DESTINO DONDE MOVEREMOS EL DOCUMENTO.  FIN
||**************************************************************************

          |SI enGrupoPV = nGrupoAra; |Y enSubGrupoPV = nSubGrupoAra; |Y enTipoPV = nTipoAra;
               aMensaje = "0000Ha selecciondo la misma ubicacion Destino que la ubicacion Origen";
               |MENAV aMensaje;
               |ACABA;
          |FINSI;

          nSwConsultaVinExternos = 0;
          nSwObligatorios = 0;
          |HAZ MiraSiObligatorios;
          |SI nSwObligatorios = 1;
               |SI nFichero = 0;
                   enDocumento = #dsarm005#0;
               |SINO;
                   enDocumento = #dsarm005@#0;
               |FINSI;

               |VENTANA 0501, 3599, -1, 16, "Datos Documentos";
               nVentm5 = FSalida;

               aVent1 = -1;
               aVent2 = -1;
               aVent3 = 0;
               aVent4 = nVentm5;
               aVent5 = "MODAL";
               |ESPECIFICA "ESTADO_VENTANA", aVent;
               |PULSATECLA;

               |PTEC 802;  |PAUSA;

               enMueveDoc = 1;
               |SUB_EJECUTA_NP "dsarw006";
               enMueveDoc = 0;

               aVent1 = -1;
               aVent2 = -1;
               aVent3 = 0;
               aVent4 = nVentm5;
               aVent5 = "MODELESS";
               |ESPECIFICA "ESTADO_VENTANA", aVent;

               |FINVENTANA nVentm5;
          |SINO;
               nSwConsultaVinExternos = 1;
          |FINSI;

          |SI nSwArbolActivo = 0;
              |FOCOTECLADO enGrid;
          |SINO;
              |FOCOTECLADO nTree;
              |SI nGridTree ! -1;  |FOCOTECLADO nGridTree;  |FINSI;
          |FINSI;

          |SI enGrupoPV = 0; |Y enSubGrupoPV = 0; |Y enTipoPV = 0;
               |SI nSwCreaBanDSEscanManual = 1;
                    ||TODO CCC
                    ||Tengo que borrar el dsarm034 y dsarm035. se ha anulado el
                    ||proceso de mover el documento
                    |SI eaHoraBandeja ! "";
                         |BUCLE dsarm034_borraBja;
                    |FINSI;
               |FINSI;
               |ACABA;
               ||NADA PROCESO Cancelado.
          |SINO;
               |SI nSwConsultaVinExternos = 1; |Y #dsarm001#194 = "S";
                    |SI nFichero = 0;
                        enNumRegVincuExte = #dsarm005#0;
                    |SINO;
                        enNumRegVincuExte = #dsarm005@#0;
                    |FINSI;
                    |HAZ DimeValoresVinculo;
                    |SI enSwVinculosExternos = 1;
                          eaPosicionateVinculo1 = eaValorVinculo1;
                          eaPosicionateVinculo2 = eaValorVinculo2;
                    |SINO;
                          eaPosicionateVinculo1 = "";
                          eaPosicionateVinculo2 = "";
                    |FINSI;
                    aVinculo1Antes = eaPosicionateVinculo1;
                    aVinculo2Antes = eaPosicionateVinculo2;
                    enSwVinculosExternos = 0;

                    enGrupoVinExte = enGrupoPV;
                    enSubGrupoVinExte = enSubGrupoPV;
                    enTipoVinExte = enTipoPV;

                    enSwErrorVinExte = 0;
                    |HAZ VinculosExternos;
               |FINSI;

               #dsarm005#0 = aBusca;
               |LEE 101#dsarm005.=;
               |SI FSalida = 0;
                    nGrupoAnt = #dsarm005#1;
                    nSubGruAnt = #dsarm005#2;
                    nTipoAnt = #dsarm005#3;

                    nGrupo = enGrupoPV;
                    nSubGrupo = enSubGrupoPV;
                    nTipo = enTipoPV;
                    |SI nGrupoAnt ! nGrupo; |O nSubGruAnt ! nSubGrupo; |O nTipoAnt ! nTipo;
                         ||Tengo que mover el documento a la nueva ubicacion.
                         ||TODO CCC
                         aFichero = #dsarm005#7;
                         |QBF aFichero;
                         aCarpetaOrigen = aFichero;
                         |QBF aCarpetaOrigen;

                         aFichero = aFichero + #dsarm005#9;
                         |QBF aFichero;
                         aOrigen  = aFichero;

                         aDestino = #dsarm001#1;
                         |QBF aDestino;
                         |ABRE #dsarm002;
                         |DDEFECTO #dsarm002;
                         #dsarm002#0 = nGrupo;
                         |LEE 000#dsarm002.=;
                         |SI FSalida = 0;
                              aDestino = aDestino + "/" + #dsarm002#2;
                              |QBF aDestino;
                              |SI #dsarm001#7 = "N";
                                   |MKDIR aDestino;
                              |SINO;
                                   |RMKDIR aDestino;
                              |FINSI;
                              |SI #dsarm001#8 = "N"; ||NO Usan Grupo, Subgrupo y Tipo
                                   |ABRE #dsarm004;
                                   |DDEFECTO #dsarm004;
                                   #dsarm004#0 = nGrupo;
                                   #dsarm004#1 = 1;
                                   #dsarm004#2 = 1;
                                   |LEE 000#dsarm004.=;
                                   |SI FSalida = 0;
                                        |SI #dsarm004#75 = "S";
                                             aFechaSis = #dsarm005#4;
                                             aAAAAMM = (aFechaSis % -104) + (aFechaSis % 402);
                                             aDestino = aDestino + "/" + aAAAAMM;
                                             |SI #dsarm001#7 = "N";
                                                  |MKDIR aDestino;
                                             |SINO;
                                                  |RMKDIR aDestino;
                                             |FINSI;
                                        |FINSI;
                                   |FINSI;
                                   |CIERRA #dsarm004;
                              |FINSI;
                         |FINSI;
                         |CIERRA #dsarm002;

                         |SI #dsarm001#8 = "S"; ||Usan Grupo, Subgrupo y Tipo
                              |ABRE #dsarm003;
                              |DDEFECTO #dsarm003;
                              #dsarm003#0 = nGrupo;
                              #dsarm003#1 = nSubGrupo;
                              |LEE 000#dsarm003.=;
                              |SI FSalida = 0;
                                   aDestino = aDestino + "/" + #dsarm003#3;
                                   |QBF aDestino;
                                   |SI #dsarm001#7 = "N";
                                        |MKDIR aDestino;
                                   |SINO;
                                        |RMKDIR aDestino;
                                   |FINSI;
                              |FINSI;
                              |CIERRA #dsarm003;
                              |ABRE #dsarm004;
                              |DDEFECTO #dsarm004;
                              #dsarm004#0 = nGrupo;
                              #dsarm004#1 = nSubGrupo;
                              #dsarm004#2 = nTipo;
                              |LEE 000#dsarm004.=;
                              |SI FSalida = 0;
                                   aDestino = aDestino + "/" + #dsarm004#4;
                                   |QBF aDestino;
                                   |SI #dsarm001#7 = "N";
                                        |MKDIR aDestino;
                                   |SINO;
                                        |RMKDIR aDestino;
                                   |FINSI;
                              |FINSI;
                              |CIERRA #dsarm004;
                              |SI #dsarm004#75 = "S";
                                   aFechaSis = #dsarm005#4;
                                   aAAAAMM = (aFechaSis % -104) + (aFechaSis % 402);
                                   aDestino = aDestino + "/" + aAAAAMM;
                                   |SI #dsarm001#7 = "N";
                                        |MKDIR aDestino;
                                   |SINO;
                                        |RMKDIR aDestino;
                                   |FINSI;
                              |FINSI;
                         |FINSI;

                         aDestino = aDestino + "/";
                         #dsarm005#7 = aDestino;

                         aCarpetaDestino = aDestino;

                         aDestino = aDestino + #dsarm005#9;
                         |QBF aDestino;

                         |SI #dsarm001#7 = "N";
                              |RENOMBRA_FICHERO aOrigen, aDestino;
                         |SINO;
                              |RRENOMBRA_FICHERO aOrigen, aDestino;
                         |FINSI;
                         nSalidaHis = FSalida;

                         aFicAux = #dsarm005#92;
                         |QBF aFicAux;
                         |SI aFicAux ! "";
                              aOrigen = aCarpetaOrigen + aFicAux;
                              aDestino = aCarpetaDestino + aFicAux;
                              |SI #dsarm001#7 = "N";
                                   |RENOMBRA_FICHERO aOrigen, aDestino;
                              |SINO;
                                   |RRENOMBRA_FICHERO aOrigen, aDestino;
                              |FINSI;
                         |FINSI;

                         aFicAux = #dsarm005#96;
                         |QBF aFicAux;
                         |SI aFicAux ! "";
                              aOrigen = aCarpetaOrigen + aFicAux;
                              aDestino = aCarpetaDestino + aFicAux;
                              |SI #dsarm001#7 = "N";
                                   |RENOMBRA_FICHERO aOrigen, aDestino;
                              |SINO;
                                   |RRENOMBRA_FICHERO aOrigen, aDestino;
                              |FINSI;
                         |FINSI;
                         aFicAux = #dsarm005#9;
                         |QBF aFicAux;
                         aFicAux = aFicAux + ".txt";
                         nSwExisteOCR = 0;      ||Si existe el resultado del OCR
                         aOrigen = aCarpetaOrigen + aFicAux;
                         |SI #dsarm001#7 = "N";
                              |XABRE "E", aOrigen, 0;
                              |SI FSalida ] 0;
                                   nSwExisteOCR = 1;
                              |SINO;
                                   nSwExisteOCR = 0;
                              |FINSI;
                         |SINO;
                              |XABRE "CE", aOrigen, 0;
                              |SI FSalida ] 0;
                                   nSwExisteOCR = 1;
                              |SINO;
                                   nSwExisteOCR = 0;
                              |FINSI;
                         |FINSI;

                         |SI nSwExisteOCR = 1;
                              aOrigen = aCarpetaOrigen + aFicAux;
                              aDestino = aCarpetaDestino + aFicAux;
                              |SI #dsarm001#7 = "N";
                                   |RENOMBRA_FICHERO aOrigen, aDestino;
                              |SINO;
                                   |RRENOMBRA_FICHERO aOrigen, aDestino;
                              |FINSI;
                         |FINSI;
                    |FINSI;

                    ||Historico
                    |HORA aHora;
                    aUsuario = Usuario % 810;
                    |ABRE #flowm006;
                    #flowm006#0  = #dsarm005#0;
                    #flowm006#1  = 99999;
                    |LEE 000#flowm006.];
                    |SI FSalida = 0;
                         |LEE 000#flowm006.a;
                    |SINO;
                         |LEE 000#flowm006.u;
                    |FINSI;
                    |SI FSalida = 0; |Y #flowm006#0  = #dsarm005#0;
                         nLinea = #flowm006#1 + 1;
                         nSitu = #flowm006#2;
                    |SINO;
                         nSitu = 0;
                         nLinea = 1;
                    |FINSI;
                    |DDEFECTO #flowm006;
                    #flowm006#0  = #dsarm005#0;
                    #flowm006#1  = nLinea;
                    |LEE 101#flowm006.=;
                    |SI FSalida ! 0; |GRABA 020#flowm006.b; |FINSI;
                    #flowm006#2  = nSitu;
                    #flowm006#3  = ~;
                    #flowm006#4  = aHora;
                    #flowm006#5  = aUsuario;
                    aOriHis = (("000" + nGrupoAnt) % -103) + "/" + (("000" + nSubGruAnt) % -103) + "/" + (("000" + nTipoAnt) % -103)
                    aDesHis = (("000" + nGrupo) % -103) + "/" + (("000" + nSubGrupo) % -103) + "/" + (("000" + nTipo) % -103)

                    #flowm006#6  = "MOVIDO DE " + aOriHis + " A " + aDesHis + ". [" + nSalidaHis + "]";

                    enNumRegFlow = #flowm006#0;
                    enSituFlow = #flowm006#2;
                    |HAZ DimeDesFlow;
                    #flowm006#7 = eaDesSituFlow;

                    |GRABA 020#flowm006.a;
                    |LIBERA #flowm006;
                    |CIERRA #flowm006;

                    #dsarm005#1 = nGrupo;
                    #dsarm005#2 = nSubGrupo;
                    #dsarm005#3 = nTipo;

                    |SI enSwVinculosExternos = 1; |Y nSwConsultaVinExternos = 1;
                         |SI eaTipoVinculo = "CLINICA";
                              |SI aVinculo1Antes = ""; |Y eaValorVinculo1 ! "";
                                   #dsarm005#97 = eaValorVinculo1;
                                   #dsarm005#98 = eaValorVinculo2;
                                   #dsarm005#13 = eaValorVinculoAux;

                                   enNumRegVincuExte = #dsarm005#0;
                                   |HAZ GrabaVincuExte;
                              |SINO;
                                   |SI aVinculo1Antes ! eaValorVinculo1; |O aVinculo2Antes ! eaValorVinculo2;
                                        aMensaje = "0000SHa modificado el valor del vinculo externo." + &10 + "Desea Actualizar el registro?";
                                        |CONFI aMensaje;
                                        |SI FSalida = 0;
                                            #dsarm005#97 = eaValorVinculo1;
                                            #dsarm005#98 = eaValorVinculo2;
                                            #dsarm005#13 = eaValorVinculoAux;

                                            enNumRegVincuExte = #dsarm005#0;
                                            |HAZ GrabaVincuExte;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;

                    |GRABA 020#dsarm005.a;
                    |LIBERA #dsarm005;

                    ||ARA18.  Falta el DSESCAN y LA AUTOPLANTILLA.

                    |SI #dsarm004#78 ! 0;         ||Plantillas Auto-Relleno
                         |ABRE #dsarm029;
                         |DDEFECTO #dsarm029;
                         #dsarm029#0 = #dsarm004#78;
                         |LEE 000#dsarm029.=;
                         nSwLogError = #dsarm029#84;
                         |CIERRA #dsarm029;

                         nRegDocu = #dsarm005#0;
                         |BUCLE dsarm030_borraReg;
                         |BUCLE dsarm031_borraReg;

                         aUbicacion = #dsarm005#7;
                         aFicheroTif = #dsarm005#9;

                         |ABRE #dsarm031;
                         aMete31 = "";
                         aMete31 = (("000" + nGrupo) % -103) + " " + (("000" + nSubGrupo) % -103) + " " + (("000" + nTipo) % -103);
                         aMete31 = aMete31 + " " + aUbicacion + "|" + aFicheroTif;
                         #dsarm031#0 = nRegDocu;
                         #dsarm031#1 = 0;
                         |LEE 101#dsarm031.=;
                         |SI FSalida ! 0;
                              #dsarm031#2 = aMete31;
                              |GRABA 020#dsarm031.n;
                         |FINSI;
                         |LIBERA #dsarm031;
                         |CIERRA #dsarm031;

                         aAlfa = "dsarz013;" + #dsarm005#0;
                         |SUB_EJECUTA aAlfa;

                         |ABRE #dsarm030;
                         |DDEFECTO #dsarm030;
                         #dsarm030#0 = nRegDocu;
                         #dsarm030#1 = 0;
                         |LEE 000#dsarm030.=;
                         |SI FSalida = 0;
                              aAux = #dsarm030#2;
                              |QBF aAux;
                         |SINO;
                              |SI nSwLogError = 1;
                                   aMensaje = "0000Error plantillas Auto-Relleno.";
                                   |MENAV aMensaje;
                              |FINSI;
                              aAux = "ERROR";
                         |FINSI;
                         |SI aAux = "ERROR";
                              |SI nSwLogError = 1;
                                   |VENTANA 0501, 2999, -1, 16, "Visualizando LOG Plantilla Auto-Relleno";
                                   nVentz1  = FSalida;

                                   aVent1 = -1;
                                   aVent2 = -1;
                                   aVent3 = 0;
                                   aVent4 = nVentz1;
                                   aVent5 = "MODAL";
                                   |ESPECIFICA "ESTADO_VENTANA", aVent;

                                   |PINPA #0#dsarw058;
                                   |PINDA #0#dsarw058;
                                   |PTEC 802;
                                   |PAUSA;

                                   nRango = 2 + 4 + 8 + 16;
                                   |LINEAL_SIMPLE #1#dsarm030, nRango, 0602, 2998, Baja30, Alta30, Evento30;

                                   aVent1 = -1;
                                   aVent2 = -1;
                                   aVent3 = 0;
                                   aVent4 = nVentz1;
                                   aVent5 = "MODELESS";
                                   |ESPECIFICA "ESTADO_VENTANA", aVent;

                                   |FINVENTANA nVentz1;

                                   ||Mostramos GRID de LOG.
                                   ||ARA77. Con Ventana y MODAL.
                              |FINSI;
                         |SINO;
                              |ABRE #dsarm005;
                              #dsarm005#0 = nRegDocu;
                              |LEE 101#dsarm005.=;
                              |SI FSalida = 0;
                                   #dsarm005#23 = "";
                                   #dsarm005#24 = "";
                                   #dsarm005#25 = "";
                                   #dsarm005#26 = "";
                                   #dsarm005#27 = "";
                                   #dsarm005#28 = "";
                                   #dsarm005#29 = "";
                                   #dsarm005#30 = "";
                                   #dsarm005#31 = "";
                                   #dsarm005#32 = "";
                                   #dsarm005#33 = "";
                                   #dsarm005#34 = "";
                                   #dsarm005#35 = "";
                                   #dsarm005#36 = "";
                                   #dsarm005#37 = "";
                                   #dsarm005#60 = "";
                                   #dsarm005#61 = "";
                                   #dsarm005#62 = "";
                                   #dsarm005#63 = "";
                                   #dsarm005#64 = "";

                                   nContReal = 0;
                                   nContDos = 0;
                                   |PARA nCampo = 5;  |SI nCampo [ 9;  |HACIENDO nCampo = nCampo + 1;
                                        |HAZ PonEtiquetas;
                                   |SIGUE;
                                   |PARA nCampo = 27;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
                                        |HAZ PonEtiquetas;
                                   |SIGUE;
                                   |PARA nCampo = 10;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
                                        |HAZ PonEtiquetas;
                                   |SIGUE;

                                   |BUCLE dsarm031_mete;
                                   |GRABA 020#dsarm005.a;
                                   |LIBERA #dsarm005;
                              |FINSI;
                              |CIERRA #dsarm005;
                         |FINSI;
                         |CIERRA #dsarm030;
                    |SINO;
                         enNumRegistro = #dsarm005#0;
                         aAlfa = "dsarz013;" + #dsarm005#0;
                         |SUB_EJECUTA aAlfa;
                    |FINSI;

                    aAlfa = "dsarz030;" + #dsarm005#0;
                    |SUB_EJECUTA aAlfa;

                    |HAZ ActualizaWorkflow;
               |FINSI;
               |SI nFichero = 0;
                    |REFRESCACONTROL enGrid;
               |SINO;
                    #dsarm005@#0 = aBusca;
                    |LEE 101#dsarm005@.=;
                    |SI FSalida = 0;
                        |PARA nConta = 1; |SI nConta [ 76; |HACIENDO nConta = nConta + 1;
                              #dsarm005@#nConta# = #dsarm005#nConta#;
                         |SIGUE;

                         |GRABA 020#dsarm005@.a;
                         |LIBERA #dsarm005@;
                    |FINSI;
                    |REFRESCACONTROL enGrid;
               |FINSI;
               ||Mueve documento.
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Boton0_8;
     |SI nFichero = 0;
         aBusca = ("000000000" + #dsarm005#0) % -109;
     |SINO;
         aBusca = ("000000000" + #dsarm005@#0) % -109;
     |FINSI;

     aAlfa  = #dsarm008#0;  |QBF aAlfa;
     |SI aAlfa = "";
         |HAZ Boton0_10;

         |SI nError [ 0;  |ACABA;  |FINSI;
     |SINO;
          aUsuarioVista = Usuario % 810;
          |QBF aUsuarioVista;
          |ABRE #dsarm043;
          |DDEFECTO #dsarm043;
          #dsarm043#0 = aUsuarioVista;
          #dsarm043#1 = #dsarm008#0;
          |LEE 000#dsarm043.=;
          |SI FSalida = 0; |Y #dsarm043#2 = "N";
               |CIERRA #dsarm043;
               |HAZ Boton0_10;

               |SI nError [ 0;
                    |ACABA;
               |FINSI;
          |SINO;
               |CIERRA #dsarm043;
               |SI enBusqueda = 1;
                   |HAZ CreaArbol;
               |FINSI;
          |FINSI;
     |FINSI;

     enBusqueda     = 0;

     |ESTADO_CONTROL enGrid, "HIDE";
     nEstadoGrid = -1;

     |SI enSwPantaDiv = 0;
          |HAZ PresentaArbol;

          |SI nBoton0_8 ! -1;
              |FIN_CONTROL_WINDOWS nBoton0_8;
              nBoton0_8 = -1;

              |CONTROL_SIMPLE 0, "BOTON,{{155}} Vistas por Lineal", 3202, 3220, Boton0_9;
              nBoton0_9 = FSalida;

              |CONTROL_SIMPLE 0, "BOTON,{{137}} Cambiar Vistas", 3242, 3260, Boton0_10;
              nBoton0_10 = FSalida;

              |CONTROL_SIMPLE 0, "BOTON,{{197}} Actualizar Arbol", 3222, 3240, Boton0_11;
              nBoton0_11 = FSalida;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Boton0_9;
     nSwArbolActivo = 0;

     |PULSATECLA;
     |SI nTree ! -1;
         |ESTADO_CONTROL nTree, "HIDE";
     |FINSI;

     |SI nGridTree ! -1;
         |ESTADO_CONTROL nGridTree, "HIDE";
         |ESTADO_CONTROL nBtnGuarda, "HIDE";
     |FINSI;

     |PULSATECLA;

     |ESTADO_CONTROL enGrid, "SHOW";
     nEstadoGrid = enGrid;

     |REFRESCACONTROL enGrid;
     |FOCOTECLADO enGrid;
     |PULSATECLA;

     |FIN_CONTROL_WINDOWS nBoton0_9;
     nBoton0_9 = -1;

     |FIN_CONTROL_WINDOWS nBoton0_10;
     nBoton0_10 = -1;

     |FIN_CONTROL_WINDOWS nBoton0_11;
     nBoton0_11 = -1;

     |SI enSwPantaDiv = 0; |Y enSwADContD = 0;
          |CONTROL_SIMPLE 0, "BOTON,{{155}} Vistas por Arbol", 3202, 3220, Boton0_8;
          nBoton0_8 = FSalida;
     |FINSI;
|FPRC;

|PROCESO Boton0_10;
     nContador = 0;
     aPopup1   = enGrid;

     |ABRE #dsarm043;
     aUsuarioVista = Usuario % 810;
     |QBF aUsuarioVista;

     IaPopup  = aPopup3  <-;
     IaOpcion = aOpcion1 <-;
     |BUCLE dsarm008;
     aPopup2 = nContador;

     |CIERRA #dsarm043;

     |SI nContador = 0;
          aMensaje = "0000No tiene permiso para ver las vistas por  rbol";
          |MENAV aMensaje;
          aTipoVista = "L";
          nBoton0_9 = -1;
          #dsarm000#1 = "L";
          |ACABA;
     |FINSI;

     IaPopup  = aPopup1  <-;
     IaOpcion = aOpcion1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     nError = FSalida;

     |SI nError > 0;
         IaPopup  = aPopup3  <-;
         IaOpcion = aOpcion1 <-;

         nOpcion  = nError - 1;
         IaPopup  = IaPopup  + nOpcion;
         IaOpcion = IaOpcion + nOpcion;
         aAlfa    = aOpcion;

         |PULSATECLA;

         #dsarm008#0 = aAlfa;
         |LEE 000#dsarm008.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |HAZ CreaArbol;
         enBusqueda = 0;
     |FINSI;

     |SI nBoton0_10 = -1;  |Y enBusqueda = 0;
         |ACABA;
     |FINSI;

     |SI enBusqueda = 1;
         |HAZ CreaArbol;
     |FINSI;

     enBusqueda = 0;

     |HAZ PresentaArbol;
|FPRC;

|PROCESO Boton0_11;
     enBusqueda = 0;
     |HAZ CreaArbol;
     |HAZ PresentaArbol;
|FPRC;

|PROCESO Boton0_16;
     ||Aplicar Coleccion. Falta controlar los MODALES en las ventanas

     enSwColeccionGrid = 0;

     |SI #dsarm001#194 = "S";
          |SI nSwRamaEpisodio = 1;
               ||Falta averiguar la historia. :)
               |HAZ ClinicaDimeHis;
               ||Ya he cargado los valores, en el EventoTree
          |SINO;
               |SI nFichero = 0;
                   eaHistoriaBusca = #dsarm005#97;
                   eaEpisodioBusca = #dsarm005#98;
               |SINO;
                   eaHistoriaBusca = #dsarm005@#97;
                   eaEpisodioBusca = #dsarm005@#98;
               |FINSI;
          |FINSI;
          |QBF eaHistoriaBusca;
          |QBF eaEpisodioBusca;
     |SINO;
          eaHistoriaBusca = "";
          eaEpisodioBusca = "";
     |FINSI;

     aEjecuta = "dsarm023;APLICARCOLECCION";
     |SUB_EJECUTA_NP aEjecuta;

     |SI enSwColeccionGrid = 1;
          ||ARA99
          |DESTRUYECONTROL enGrid;  |PULSATECLA;
          |HAZ GridFicheroBusqueda;

          enBusqueda = 1;
          enModoBus = 1;

          |SI nBoton0_9 ! -1;
              |ESTADO_CONTROL enGrid, "HIDE";
              nEstadoGrid = -1;
              |HAZ Boton0_8;
          |FINSI;

          |ESTADO_CONTROL nBoton0_5, "ENABLE";

          |ESTADO_CONTROL nBoton0_16, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO Boton0_12;
     |VENTANA 0501, 1354, -1, 16, "Pedir desde fecha";
     nVentm5 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     aFechaGuarda = aDFecha;

     #dsarw018#7 = aTipoFecha;
     #dsarw018#8 = aDFecha;

     |PINPA #0#dsarw018;
     |PINDA #0#dsarw018;
     |ENDATOS #1#dsarw018;
     |SI FSalida = 0;
         aDFecha    = #dsarw018#8;
         aTipoFecha = #dsarw018#7;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentm5;

     |SI nSwArbolActivo = 0;
         |SI aFechaGuarda ! aDFecha;
             fFecha1 = aDFecha;
             fFecha2 = aHFecha;
             |SI fFecha1 > fFecha2;
                 aDFecha = aHFecha;
             |FINSI;
             |REFRESCACONTROL enGrid;
             enBusqueda = 1;
         |FINSI;

         |FOCOTECLADO enGrid;
     |SINO;
         |SI aFechaGuarda ! aDFecha;
             fFecha1 = aDFecha;
             fFecha2 = aHFecha;
             |SI fFecha1 > fFecha2;
                 aDFecha = aHFecha;
             |FINSI;
             enBusqueda = 0;
             |HAZ CreaArbol;
             |HAZ PresentaArbol;
         |FINSI;
     |FINSI;

     |HAZ BotonFecha;
|FPRC;

|PROCESO BotonFecha;
     |SI #dsarm001#191 = "S";      |ACABA;  |FINSI;
     |SI enSwPantaDiv ! 0;  |ACABA;  |FINSI;

     |SI nBoton0_12 ! -1;
         |FIN_CONTROL_WINDOWS nBoton0_12;
         nBoton0_12 = -1;
     |FINSI;

     |SI aTipoFecha = "1";
         aAlfa = "BOTON,Desde Fecha: SIN LIMITE";
     |FINSI;

     |SI aTipoFecha = "2";
         aAlfa = "BOTON,Desde Fecha: MES ACTUAL";
     |FINSI;

     |SI aTipoFecha = "3";
         aAlfa = "BOTON,Desde Fecha: A¥O ACTUAL";
     |FINSI;

     |SI aTipoFecha = "4";
         aAlfa = "BOTON,Desde Fecha: TRES MESES ATRAS";
     |FINSI;

     |SI aTipoFecha = "5";
         aAlfa = "BOTON,Desde Fecha: SEIS MESES ATRAS";
     |FINSI;

     |SI aTipoFecha = "6";
         aAlfa = "BOTON,Desde Fecha: UN A¥O ATRAS";
     |FINSI;

     |SI aTipoFecha = "7";
         aAlfa = "BOTON,Desde Fecha: " + aDFecha;
     |FINSI;

     |SI #dsarm001#194 = "S";
          |CONTROL_SIMPLE 0, aAlfa, 0770, 0798, Boton0_12;
     |SINO;
          |CONTROL_SIMPLE 0, aAlfa, 0870, 0898, Boton0_12;
     |FINSI;
     nBoton0_12 = FSalida;
|FPRC;

|PROCESO PonFoto;
     |DBASE aBase;  |QBF aBase;

     |SI enDESPANET = 0;
         aFotoOrigen = aBase + "logos/logods.jpg";
         aExt        = ".jpg";
     |SINO;
         aFotoOrigen = aBase + "logos/logodespanet.jpg";
         aExt        = ".jpg";
         |XABRE "E", aFotoOrigen, nHandle;
         |SI FSalida < 0;
             aFotoOrigen = aBase + "logos/logodespanet.bmp";
             aExt        = ".bmp";
             |XABRE "E", aFotoOrigen, nHandle;
             |SI FSalida < 0;
                 aFotoOrigen = aBase + "logos/insertarlogo.jpg";
                 aExt        = ".jpg";
                 |XABRE "E", aFotoOrigen, nHandle;
                 |SI FSalida < 0;
                     |ACABA;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |HAZ LeeUnidadBasico;

     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS";                     |RMKDIR aDirLocal;
     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS\DSARCHI";             |RMKDIR aDirLocal;
     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS\DSARCHI\LOGOS";       |RMKDIR aDirLocal;
     aFotoDestino = aDirLocal + "/logods" + aExt;

     aContiene1 = aFotoDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aFotoOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         aIPRemoto = "";
         |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aFotoOrigen, aFotoDestino;
         |SINO;
             |COPIA_FICHERO aFotoOrigen, aFotoDestino;
         |FINSI;
     |FINSI;

     aFoto = "IMAGEN,"  + aFotoDestino;
     |CONTROL_SIMPLE 0, aFoto, 0501, 0928, NULL;
     nBotonFoto = FSalida;
|FPRC;

|PROCESO Boton0_abogax;
     |SI nFichero = 0;
         enDocumento = #dsarm005#0;
     |SINO;
         enDocumento = #dsarm005@#0;
     |FINSI;

     aAlfa = "Vincular Documento con Expedientes";
     |VENTANA 0501, 3199, -1, 16, aAlfa;
     nVentm5 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SUB_EJECUTA_NP "dsarm033";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentm5;

     |SI nSwArbolActivo = 0;
         |REFRESCACONTROL enGrid;
     |SINO;
         |FOCOTECLADO nTree;
         |SI nGridTree ! -1;
             |REFRESCACONTROL nGridTree;
             |FOCOTECLADO nGridTree;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonBuscaPac;
     enError = 0;
     |HAZ ClinicaBuscaPac;

     |SI enError = 1;
         |ACABA;
     |FINSI;

     |DESTRUYECONTROL enGrid;  |PULSATECLA;
     |HAZ GridFicheroBusqueda;

     enBusqueda = 1;
     |PULSATECLA;

     |SI nBoton0_9 ! -1;
         |ESTADO_CONTROL enGrid, "HIDE";
         nEstadoGrid = -1;
         |HAZ Boton0_8;
     |FINSI;

     |ESTADO_CONTROL nBoton0_5, "ENABLE";
     |ESTADO_CONTROL nBoton0_16, "DISABLE";
|FPRC;

|PROCESO dsarm055Sel;
     |SELECT #1#dsarm005;
     #dsarm005#0 = #dsarm055#0;
     |LEE 000#dsarm005.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ BotonMas;
|FPRC;

|DEFBUCLE dsarm055Sel;
     #dsarm055#2;
     ;
     #dsarm056#5, 000000000;
     #dsarm056#5, 999999999;
     ;
     NULL, dsarm055Sel;
|FIN;

|PROCESO dsarm056Sel;
     |BUCLE dsarm055Sel;
|FPRC;

|DEFBUCLE dsarm056Sel;
     #dsarm056#1;
     ;
     aDCarp1, aDCarp2, aDCarp3, aDCarp4, aDCarp5, aDCarp6;
     aHCarp1, aHCarp2, aHCarp3, aHCarp4, aHCarp5, aHCarp6;
     ;
     NULL, dsarm056Sel;
|FIN;

|PROCESO RecogeDocCarpeta;
     aDCarp1 = "";
     aHCarp1 = "z" * 135;
     aAlfa   = aTextoFoco1;  |QBF aAlfa;
     |SI aAlfa ! "";
         aDCarp1 = aTextoFoco1;
         aHCarp1 = aTextoFoco1;
     |FINSI;

     aDCarp2 = "";
     aHCarp2 = "z" * 135;
     aAlfa   = aTextoFoco2;  |QBF aAlfa;
     |SI aAlfa ! "";
         aDCarp2 = aTextoFoco2;
         aHCarp2 = aTextoFoco2;
     |FINSI;

     aDCarp3 = "";
     aHCarp3 = "z" * 135;
     aAlfa   = aTextoFoco3;  |QBF aAlfa;
     |SI aAlfa ! "";
         aDCarp3 = aTextoFoco3;
         aHCarp3 = aTextoFoco3;
     |FINSI;

     aDCarp4 = "";
     aHCarp4 = "z" * 135;
     aAlfa   = aTextoFoco4;  |QBF aAlfa;
     |SI aAlfa ! "";
         aDCarp4 = aTextoFoco4;
         aHCarp4 = aTextoFoco4;
     |FINSI;

     aDCarp5 = "";
     aHCarp5 = "z" * 135;
     aAlfa   = aTextoFoco5;  |QBF aAlfa;
     |SI aAlfa ! "";
         aDCarp5 = aTextoFoco5;
         aHCarp5 = aTextoFoco5;
     |FINSI;

     aDCarp6 = "";
     aHCarp6 = "z" * 135;
     aAlfa   = aTextoFoco6;  |QBF aAlfa;
     |SI aAlfa ! "";
         aDCarp6 = aTextoFoco6;
         aHCarp6 = aTextoFoco6;
     |FINSI;

     |BUCLE dsarm056Sel;
|FPRC;

|PROCESO LlamaBotonMas;
     |SI nFichero ! 0;
          #dsarm005#0 = #dsarm005@#0;
          |LEE 000#dsarm005.=;
     |FINSI;

     |SI nSwArbolActivo = 1;
         |SI eaFoco = "CARPETA";
             |HAZ RecogeDocCarpeta;
             |HAZ RefrescaBotMulti;
             |ACABA;
         |FINSI;
     |FINSI;

     |HAZ BotonMas;
     |HAZ RefrescaBotMulti;
|FPRC;

|PROCESO LlamaBotonMulti;
     enArbol = nSwArbolActivo;

     |HAZ BotonMulti;
     |HAZ RefrescaBotMulti;
|FPRC;

|PROCESO RefrescaBotMulti;
     |FIN_CONTROL_WINDOWS nBotonMulti;

     |SI enNumMultiSele = 0;
          |SI #dsarm001#194 = "S";
               |CONTROL_SIMPLE 0, "BOTON,Ver MultiSeleccion (0)", 0875, 0898, LlamaBotonMulti;
          |SINO;
               |CONTROL_SIMPLE 0, "BOTON,Ver MultiSeleccion (0)", 0975, 0998, LlamaBotonMulti;
          |FINSI;
          nBotonMulti = FSalida;
     |SINO;
          aAuxTxt = "BOTON,Ver MultiSeleccion (" + enNumMultiSele + ")";

          |SI #dsarm001#194 = "S";
               |CONTROL_SIMPLE 0, aAuxTxt, 0875, 0898, LlamaBotonMulti;
          |SINO;
               |CONTROL_SIMPLE 0, aAuxTxt, 0975, 0998, LlamaBotonMulti;
          |FINSI;
          nBotonMulti = FSalida;
     |FINSI;
|FPRC;

|PROCESO BtnUsu;
     |FIN_CONTROL_WINDOWS nBtnUsu;

     |SI aHUsuario ! aDUsuario;
         |ABRE #dsarz010;
         |PARA; |SI;  |HACIENDO;
             |CONSULTA_CLAVE #1#dsarz010;
             |SI FSalida = 0;  |SAL;  |FINSI;

             |MENAV "0000Seleccione un  usuario";
         |SIGUE;
         |CIERRA #dsarz010;


         aQueUsu   = #dsarz010#0;     |QBF aQueUsu;
         aDUsuario = #dsarz010#0;
         aHUsuario = #dsarz010#0;

         aAlfa     = "BOTON,{{197}}Usuario: " + aQueUsu;
     |SINO;
         aQueUsu   = "";
         aDUsuario = "";
         aHUsuario = "zzzzzzzzzz";

         aAlfa     = "BOTON,{{197}}Usuario: TODOS";
     |FINSI;

     |CONTROL_SIMPLE 0, aAlfa, 0730, 0750, BtnUsu;
     nBtnUsu = FSalida;

     |REFRESCACONTROL enGrid;
|FPRC;

|PROCESO PantaDConta;
     |SI aQueUsu = "";
         aDUsuario = "";
         aHUsuario = "zzzzzzzzzz";
         aAlfa     = "BOTON,{{197}}Usuario: TODOS";
     |SINO;
         aDUsuario = aQueUsu;
         aHUsuario = aQueUsu;
         aAlfa     = "BOTON,{{197}}Usuario: " + aQueUsu;
     |FINSI;

     |CONTROL_SIMPLE 0, aAlfa, 0730, 0750, BtnUsu;
     nBtnUsu = FSalida;

     |SI eaNomDef = "cainliva";
         |CONTROL_SIMPLE 0, "BOTON,{{197}}Visualizar el Documento", 3003, 3026, Boton0_15;
         nBoton0_15 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,{{199}} Baja ", 3087, 3098, Boton0_1;
         nBoton0_1 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,{{197}} Entradas/Salidas", 3069, 3085, Boton0_13;
         nBoton0_13 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,{{197}} Pantalla Datos", 3053, 3067, Boton0_2;
         nBoton0_2 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,{{157}} Correo", 3040, 3051, Boton0_3;
         nBoton0_3 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,{{156}} Copiar", 3028, 3038, Boton0_6;
         nBoton0_6 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,Vincular Seleccionado", 3202, 3222, VinculaCAINLIVA;
         enBotonADC8 = FSalida;

         |ESTADO_CONTROL nBotonMas,   "HIDE";
         |ESTADO_CONTROL nBotonMulti, "HIDE";

         nPos2 = 2998;

         |ACABA;
     |FINSI;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Visualizar el Documento", 1803, 1826, Boton0_15;
     nBoton0_15 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}} Baja ", 1887, 1898, Boton0_1;
     nBoton0_1 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}} Entradas/Salidas", 1869, 1885, Boton0_13;
     nBoton0_13 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}} Pantalla Datos", 1853, 1867, Boton0_2;
     nBoton0_2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{157}} Correo", 1840, 1851, Boton0_3;
     nBoton0_3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{156}} Copiar", 1828, 1838, Boton0_6;
     nBoton0_6 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Apuntes Contables", 2002, 2016, BotonADC1;
     enBotonADC1 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Facturas", 2017, 2025, BotonADC2;
     enBotonADC2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Cuentas", 2026, 2034, BotonADC3;
     enBotonADC3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Fichas Amortizaci¢n", 2035, 2049, BotonADC4;
     enBotonADC4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{163}} Busqueda", 3135, 3150, BotonADC6;
     enBotonADC6 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{207}} Borrar Busqueda", 3152, 3172, BotonADC7;
     enBotonADC7 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Vincular Seleccionado", 3102, 3122, LlamaBotonADC8;
     enBotonADC8 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,+", 2069, 2072, LlamaBotonADC9;
     enBotonADC9 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Ver MultiSeleccion (0)", 2074, 2098, LlamaBotonADC10;
     enBotonADC10 = FSalida;

     |ESTADO_CONTROL enBotonADC1,  "DISABLE";
     |ESTADO_CONTROL enBotonADC2,  "ENABLE";
     |ESTADO_CONTROL enBotonADC3,  "ENABLE";
     |ESTADO_CONTROL enBotonADC4,  "ENABLE";
     |ESTADO_CONTROL enBotonADC5,  "ENABLE";
     |ESTADO_CONTROL enBotonADC7,  "DISABLE";
     |ESTADO_CONTROL enBotonADC8,  "ENABLE";
     |ESTADO_CONTROL enBotonADC9,  "ENABLE";
     |ESTADO_CONTROL enBotonADC10,  "ENABLE";

     enEstoyBoton = 1;
     enSwCargaDef = 0;
     |HAZ CargaDefs;
     |SI enSwCargaDef = 0;
         |ACABA;
     |FINSI;
     |HAZ PintaGrids;
|FPRC;

|PROCESO Boton0_20;
     |DBASE aFicheroCap;
     |QBF aFicheroCap;

     aFicheroCap = aFicheroCap + aNombreCapDoc + ".txt";

     |XABRE "W", aFicheroCap, nHandleCap;
     |SI FSalida ] 0;
          aLinea = #dsarm005#7;
          |QBF aLinea;
          |XGRABA nHandleCap, aLinea;
          aLinea = #dsarm005#9;
          |QBF aLinea;
          |XGRABA nHandleCap, aLinea;
          aLinea = #dsarm001#7;
          |QBF aLinea;
          |XGRABA nHandleCap, aLinea;
          |XCIERRA nHandleCap;
     |FINSI;

     |PTEC 806;
|FPRC;

|PROCESO BotonesPanta0;
     |PULSATECLA;
     |PULSATECLA;
     |HAZ PonFoto;

     ||ARA39
     |SI nSwModoCapDoc = 1;
          |CONTROL_SIMPLE 0, "LABEL,{{14}} Captura documentos", 0538, 0698, NULL;

          |CONTROL_SIMPLE 0, "BOTON,{{197}}Ver Doc.", 3002, 3013, Boton0_15;
          nBoton0_15 = FSalida;

          |CONTROL_SIMPLE 0, "BOTON,{{197}}Capturar Doc.", 3262, 3280, Boton0_20;
          nBoton0_20 = FSalida;

          |ESTADO_CONTROL nBoton0_15,  "DISABLE";
          |ESTADO_CONTROL nBoton0_20,  "DISABLE";
          |ACABA;
     |FINSI;

     |SI enSwBandejaErrOCR = 0;
           |CONTROL_SIMPLE 0, "LABEL,{{14}} Asistente de consulta", 0538, 0698, NULL;
     |SINO;
           |CONTROL_SIMPLE 0, "LABEL,{{14}} Bandeja Errores OCR", 0538, 0698, NULL;
     |FINSI;

     |SI nSwIpAbogax = 1;
          |CONTROL_SIMPLE 0, "BOTON,Vincular con Expedientes", 0787, 0898, Boton0_abogax;
          nBoton0_abogax = FSalida;
     |FINSI;


     |SI enSwBandejaErrOCR = 0;
          |SI enLABORAL = 0;
               || desactivo la busqueda si vengo de la ficha de trabajadores de laboral

               |CONTROL_SIMPLE 0, "BOTON,{{163}} Busqueda", 0940, 0950, Boton0_4;
               nBoton0_4 = FSalida;

               |CONTROL_SIMPLE 0, "BOTON,{{207}} Borrar Busqueda", 0952, 0968, Boton0_5;
               nBoton0_5 = FSalida;

               |SI #dsarm001#194 = "S"; |Y enSwModoClinica = 0;
                   |CONTROL_SIMPLE 0, "BOTON,{{163}} Busqueda Pacientes", 0970, 0988, BotonBuscaPac;
                   nBotonBuscaPac = FSalida;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI enSwBandejaErrOCR = 0;
          |SI #dsarm001#194 = "S"; |Y enSwModoClinica = 0;
              |CONTROL_SIMPLE 0, "BOTON,+", 0870, 0874, LlamaBotonMas;
              nBotonMas = FSalida;

              |CONTROL_SIMPLE 0, "BOTON,Ver MultiSeleccion (0)", 0875, 0898, LlamaBotonMulti;
              nBotonMulti = FSalida;
          |SINO;
              |CONTROL_SIMPLE 0, "BOTON,+", 0970, 0974, LlamaBotonMas;
              nBotonMas = FSalida;

              |CONTROL_SIMPLE 0, "BOTON,Ver MultiSeleccion (0)", 0975, 0998, LlamaBotonMulti;
              nBotonMulti = FSalida;
          |FINSI;
     |FINSI;

     |SI enSwPantaDiv = 0;
          |CONTROL_SIMPLE 0, "BOTON,{{199}} Baja ", 3088, 3099, Boton0_1;
          nBoton0_1 = FSalida;

          |SI enSwBandejaErrOCR = 0;
               |CONTROL_SIMPLE 0, "BOTON,{{197}} Ent./Sal.", 3076, 3087, Boton0_13;
               nBoton0_13 = FSalida;
          |FINSI;

          |CONTROL_SIMPLE 0, "BOTON,{{197}} Pantalla Datos", 3062, 3075, Boton0_2;
          nBoton0_2 = FSalida;

          |SI enSwBandejaErrOCR = 0;
               |CONTROL_SIMPLE 0, "BOTON,{{157}} Correo", 3050, 3061, Boton0_3;
               nBoton0_3 = FSalida;

               |CONTROL_SIMPLE 0, "BOTON,{{156}} Copiar", 3038, 3049, Boton0_6;
               nBoton0_6 = FSalida;

               |CONTROL_SIMPLE 0, "BOTON,{{197}} Asociar", 3026, 3037, Boton0_7;
               nBoton0_7 = FSalida;
          |FINSI;

          |SI enSwADContD = 1;
               |CONTROL_SIMPLE 0, "BOTON,Desvincular", 3014, 3025, Boton0_14;
               nBoton0_14 = FSalida;
          |SINO;
               |CONTROL_SIMPLE 0, "BOTON,Mover", 3014, 3025, Boton0_14;
               nBoton0_14 = FSalida;
          |FINSI;

          |CONTROL_SIMPLE 0, "BOTON,{{197}}Ver Doc.", 3002, 3013, Boton0_15;
          nBoton0_15 = FSalida;

          |SI enSwBandejaErrOCR = 0;
               |CONTROL_SIMPLE 0, "BOTON,Aplicar Colecci¢n", 3262, 3280, Boton0_16;
               nBoton0_16 = FSalida;
          |FINSI;

          ||ESTADO_CONTROL nBoton0_16, "DISABLE";

          |SI nSwQuitaBotonAplica = 1;
               |ESTADO_CONTROL nBoton0_16, "HIDE";
          |FINSI;
     |SINO;
          |HAZ PantaDConta;
     |FINSI;

     |SI enSwBandejaErrOCR = 0;
          |SI enLABORAL = 0;
               || desactivo la busqueda si vengo de la ficha de trabajadores de laboral
               |HAZ BotonFecha;
          |FINSI;
     |FINSI;

     |SI enSwPantaDiv = 0; |Y enSwADContD = 0; |Y enSwBandejaErrOCR = 0;
          |LEE 000#dsarm008.p;
          |SI FSalida = 0;
              |CONTROL_SIMPLE 0, "BOTON,{{155}} Vistas por Arbol", 3202, 3220, Boton0_8;
              nBoton0_8 = FSalida;
          |FINSI;
     |FINSI;

     |ESTADO_CONTROL nBoton0_1,  "DISABLE";
     |ESTADO_CONTROL nBoton0_2,  "DISABLE";
     |ESTADO_CONTROL nBoton0_3,  "DISABLE";
     |ESTADO_CONTROL nBoton0_6,  "DISABLE";
     |ESTADO_CONTROL nBoton0_7,  "DISABLE";
     |ESTADO_CONTROL nBoton0_13, "DISABLE";
     |ESTADO_CONTROL nBoton0_14, "DISABLE";
     |ESTADO_CONTROL nBoton0_15,  "DISABLE";
|FPRC;

|PROCESO LlamaBotonADC8;
     |HAZ BotonADC8;
     |HAZ RefrescaBotones;
|FPRC;

|PROCESO LlamaBotonADC9;
     |HAZ BotonADC9;
     |HAZ RefrescaBotones;
|FPRC;

|PROCESO LlamaBotonADC10;
     |HAZ BotonADC10;
     |HAZ RefrescaBotones;
|FPRC;

|PROCESO RefrescaBotones;
     |FIN_CONTROL_WINDOWS enBotonADC8;
     |FIN_CONTROL_WINDOWS enBotonADC10;

     |SI enNumSeleADC = 0;
          |CONTROL_SIMPLE 0, "BOTON,Vincular Seleccionado", 3102, 3122, LlamaBotonADC8;
          enBotonADC8 = FSalida;

          |CONTROL_SIMPLE 0, "BOTON,Ver MultiSeleccion (0)", 2074, 2098, LlamaBotonADC10;
          enBotonADC10 = FSalida;
     |SINO;
          aAuxTxt = "BOTON,Vincular Multiseleccion (" + enNumSeleADC + ")";

          |CONTROL_SIMPLE 0, aAuxTxt, 3102, 3122, LlamaBotonADC8;
          enBotonADC8 = FSalida;

          aAuxTxt = "BOTON,Ver MultiSeleccion (" + enNumSeleADC + ")";

          |CONTROL_SIMPLE 0, aAuxTxt, 2074, 2098, LlamaBotonADC10;
          enBotonADC10 = FSalida;
     |FINSI;
|FPRC;


|PROCESO CalculaFecha;
     fFecha  = ~;

     |SI aTipoFecha = "1";
         aDFecha = "01.01.0000";
     |FINSI;

     |SI aTipoFecha = "2";
         aAlfa   = fFecha % 0402;
         aAlfa   = "01." + aAlfa + (fFecha % -105);
         aDFecha = aAlfa;
     |FINSI;

     |SI aTipoFecha = "3";
         aAlfa   = "01.01." + (fFecha % -104);
         aDFecha = aAlfa;
     |FINSI;

     |SI aTipoFecha = "4";
         nNume   = fFecha;
         nNume   = (nNume - 92);
         fFecha  = nNume;
         aDFecha = fFecha;
     |FINSI;

     |SI aTipoFecha = "5";
         nNume  = fFecha;
         nNume  = (nNume - 184);
         fFecha  = nNume;
         aDFecha = fFecha;
     |FINSI;

     |SI aTipoFecha = "6";
         nNume  = fFecha;
         nNume  = (nNume - 365);
         fFecha  = nNume;
         aDFecha = fFecha;
     |FINSI;
|FPRC;

|PROCESO MiraHayDocs;
     |SI eaNomDef = "camaasic"; |O eaNomDef = "camaasil";
          nSwHayDocs = 0;
          nClaveAD1 = eaClaveAD1;
          fClaveAD2 = eaClaveAD2;
          nClaveAD3 = eaClaveAD3;

          |SELECT #10#dsarm005;
          #dsarm005#67 = enEmpADConta;
          #dsarm005#68 = enEjeADConta;
          #dsarm005#69 = nClaveAD1;
          #dsarm005#70 = fClaveAD2;
          #dsarm005#71 = nClaveAD3;
          #dsarm005#0  = 1;
          |LEE 000#dsarm005.];
          |SI FSalida = 0;
              |SI #dsarm005#67 = enEmpADConta;  |Y  #dsarm005#68 = enEjeADConta;
               |Y #dsarm005#69 = nClaveAD1;     |Y #dsarm005#70 = fClaveAD2;
               |Y #dsarm005#71 = nClaveAD3;
                  nSwHayDocs = 1;
              |FINSI;
          |FINSI;
     |FINSI;
     |SI eaNomDef = "camaniva";
          |SELECT #11#dsarm005;
          #dsarm005#67 = enEmpADConta;
          #dsarm005#68 = enEjeADConta;
          #dsarm005#72 = eaClaveAD1;
          #dsarm005#73 = eaClaveAD2;
          |LEE 000#dsarm005.=;
          |SI FSalida = 0;
               nSwHayDocs = 1;
          |SINO;
               nSwHayDocs = 0;
          |FINSI;
     |FINSI;
     |SI eaNomDef = "cainliva";
          |SELECT #11#dsarm005;
          #dsarm005#67 = enEmpADConta;
          #dsarm005#68 = enEjeADConta;
          #dsarm005#72 = eaClaveAD1;
          nRegFactura = 100000000 + (eaClaveAD1 * 1000) + eaClaveAD2;
          #dsarm005#73 = nRegFactura;
          |LEE 000#dsarm005.=;
          |SI FSalida = 0;
               nSwHayDocs = 1;
          |SINO;
               nSwHayDocs = 0;
          |FINSI;
     |FINSI;
     |SI eaNomDef = "cacuenta";
          |SELECT #12#dsarm005;
          #dsarm005#67 = enEmpADConta;
          #dsarm005#68 = enEjeADConta;
          #dsarm005#74 = eaClaveAD1;
          |LEE 000#dsarm005.=;
          |SI FSalida = 0;
               nSwHayDocs = 1;
          |SINO;
               nSwHayDocs = 0;
          |FINSI;
     |FINSI;
     |SI eaNomDef = "dsmom041"; |O eaNomDef = "dsmom042";
          |SELECT #13#dsarm005;
          #dsarm005#75 = eaClaveAD1;
          #dsarm005#76 = eaClaveAD2;
          |LEE 000#dsarm005.=;
          |SI FSalida = 0;
               nSwHayDocs = 1;
          |SINO;
               nSwHayDocs = 0;
          |FINSI;
     |FINSI;
     |SELECT #1#dsarm005;
|FPRC;

|PROCESO DimeNumCorreosPed;
     aTria = "P";
     |HAZ DimeNumCorreos;
|FPRC;

|PROCESO DimeNumCorreosTodos;
     aTria = "T";
     |HAZ DimeNumCorreos;
|FPRC;

|PROCESO DimeNumCorreos;
     |SI nFichero = 0;
         aGuarda = #dsarm005#0;
     |SINO;
         aGuarda = #dsarm005@#0;
     |FINSI;

     nSwSoloCuenta = 1;

     |SI aParametro = "";
         |SI enDESPANET = 1;
             |SI nFichero = 0;    |BUCLE dsarm005_0_7;    |FINSI;
             |SI nFichero = 905;  |BUCLE dsarm005_905_7;  |FINSI;
         |SINO;
             |SI nFichero = 0;    |BUCLE dsarm005_0_8;    |FINSI;
             |SI nFichero = 905;  |BUCLE dsarm005_905_8;  |FINSI;
         |FINSI;
     |SINO;
         aAlfa = aParametro % 0;
         |SI aAlfa = "5";
             |SI nFichero = 0;    |BUCLE dsarm005_0_3;    |FINSI;
             |SI nFichero = 905;  |BUCLE dsarm005_905_3;  |FINSI;
         |SINO;
             |SI nFichero = 0;    |BUCLE dsarm005_0_4;    |FINSI;
             |SI nFichero = 905;  |BUCLE dsarm005_905_4;  |FINSI;
         |FINSI;
     |FINSI;
     |SI nFichero = 0;
         #dsarm005#0 = aGuarda;
     |SINO;
         #dsarm005@#0 = aGuarda;
     |FINSI;
     nSwSoloCuenta = 0;
|FPRC;

|PROCESO EnviaMuchosCorreos;
     |SI nFichero = 0;
         aGuarda = #dsarm005#0;
     |SINO;
         aGuarda = #dsarm005@#0;
     |FINSI;

     nSwModoEnvio = 1;

     |SI aParametro = "";
         |SI enDESPANET = 1;
             |SI nFichero = 0;    |BUCLE dsarm005_0_7;    |FINSI;
             |SI nFichero = 905;  |BUCLE dsarm005_905_7;  |FINSI;
         |SINO;
             |SI nFichero = 0;    |BUCLE dsarm005_0_8;    |FINSI;
             |SI nFichero = 905;  |BUCLE dsarm005_905_8;  |FINSI;
         |FINSI;
     |SINO;
         aAlfa = aParametro % 0;
         |SI aAlfa = "5";
             |SI nFichero = 0;    |BUCLE dsarm005_0_3;    |FINSI;
             |SI nFichero = 905;  |BUCLE dsarm005_905_3;  |FINSI;
         |SINO;
             |SI nFichero = 0;    |BUCLE dsarm005_0_4;    |FINSI;
             |SI nFichero = 905;  |BUCLE dsarm005_905_4;  |FINSI;
         |FINSI;
     |FINSI;
     ||TODO CCC.
     |SI nFichero = 0;
         #dsarm005#0 = aGuarda;
     |SINO;
         #dsarm005@#0 = aGuarda;
     |FINSI;
|FPRC;


|PROCESO CreaPopUp_pri;
     |SI nHay = 0;
          IaPopup = aPopup1  <-;
          IaPopup = IaPopup + 1;
          IaPopup = IaPopup + 1;
          nHay = 1;
     |FINSI;
     nElementos = nElementos + 1;

     aContenido = #dsarm004#2 + " " + #dsarm004#3;
     |QBF aContenido;
     aPopup = aContenido;
     IaPopup = IaPopup + 1;
|FPRC;

|DEFBUCLE CreaPopUp_pri;
 #dsarm004#1;
 ;
 nGrupoBucle, nSubGruBucle, 001;
 nGrupoBucle, nSubGruBucle, 999;
 ;
 NULL, CreaPopUp_pri;
|FIN;

|PROCESO MeteRegCaptura;
     enSwPlantillaConta = 0;
     |SI eaNomDef = "camaasic"; |O eaNomDef = "camaasil";
          enSwPlantillaConta = 1;
          enLibroConta = eaAuxConta1;
          enDocumentoConta = eaAuxConta2;
     |SINO;
          |SI eaNomDef = "camaniva";
               enSwPlantillaConta = 1;
               enLibroConta       = eaClaveAD1;
               enDocumentoConta   = eaClaveAD2;
          |FINSI;
     |FINSI;

     enGrupo = nGrupo;
     enSubGrupo = nSubGrupo;
     enTipo = nTipo;
     eaDocCaptura = eaFicheroEscaner;
     enErrorCaptura = 0;
     enNumRegistro = 0;
     enEscaneo = 0;
     aEjecuta = "dsarz001;CAPTURAESTEDOC";
     |SUB_EJECUTA_NP aEjecuta;
     enEscaneo = 0;

     |SI enErrorCaptura = 0;
          ||TODO CCC. Quitar
          aMensaje = "0000Capturado " + aProg + " en " + nGrupo + "/" + nSubGrupo + "/" + nTipo;
          ||MENAV aMensaje;

          |HAZ ActDatosRegConta;
     |SINO;
          ||TODO CCC. Quitar
          aMensaje = "0000Error al capturar " + aProg + " en " + nGrupo + "/" + nSubGrupo + "/" + nTipo;
          ||MENAV aMensaje;
     |FINSI;
|FPRC;

|PROCESO MeteRegEscaner;
     enSwPlantillaConta = 0;
     |SI eaNomDef = "camaasic"; |O eaNomDef = "camaasil";
          enSwPlantillaConta = 1;
          enLibroConta = eaAuxConta1;
          enDocumentoConta = eaAuxConta2;
     |SINO;
          |SI eaNomDef = "camaniva";
               enSwPlantillaConta = 1;
               enLibroConta       = eaClaveAD1;
               enDocumentoConta   = eaClaveAD2;
          |FINSI;

          |SI eaNomDef = "cainliva";
               enSwPlantillaConta = 1;
               enLibroConta = eaClaveAD1;
               enDocumentoConta = eaClaveAD1;
          |FINSI;
     |FINSI;

     enGrupo = nGrupo;
     enSubGrupo = nSubGrupo;
     enTipo = nTipo;
     eaDocCaptura = eaFicheroEscaner;
     enErrorCaptura = 0;
     enNumRegistro = 0;
     enEscaneo = 1;
     aEjecuta = "dsarz001;CAPTURAESTEDOC";
     |SUB_EJECUTA_NP aEjecuta;
     enEscaneo = 0;

     |SI enErrorCaptura = 0;
          ||TODO CCC. Quitar
          aMensaje = "0000Capturado " + aProg + " en " + nGrupo + "/" + nSubGrupo + "/" + nTipo;
          ||MENAV aMensaje;

          |HAZ ActDatosRegConta;
     |SINO;
          ||TODO CCC. Quitar
          aMensaje = "0000Error al capturar " + aProg + " en " + nGrupo + "/" + nSubGrupo + "/" + nTipo;
          ||MENAV aMensaje;
     |FINSI;
|FPRC;

|PROCESO ActDatosRegConta;
     #dsarm005#0 = enNumRegistro;
     |LEE 101#dsarm005.=;
     |SI FSalida = 0;
          ||ARA77
          |SI eaNomDef = "camaasic"; |O eaNomDef = "camaasil";
               #dsarm005#67 = enEmpADConta;
               #dsarm005#68 = enEjeADConta;
               #dsarm005#69 = eaClaveAD1;
               #dsarm005#70 = eaClaveAD2;
               #dsarm005#71 = eaClaveAD3;
               #dsarm005#72 = eaAuxConta1;
               #dsarm005#73 = eaAuxConta2;
               #dsarm005#74 = eaAuxConta3;
          |FINSI;

          ||2
          |SI eaNomDef = "camaniva";
               #dsarm005#67 = enEmpADConta;
               #dsarm005#68 = enEjeADConta;
               #dsarm005#72 = eaClaveAD1;
               #dsarm005#73 = eaClaveAD2;
               #dsarm005#69 = eaAuxConta1;
               #dsarm005#70 = eaAuxConta2;
               #dsarm005#71 = eaAuxConta3;
               #dsarm005#74 = eaAuxConta5;
          |FINSI;

          ||3
          |SI eaNomDef = "cacuenta";
               #dsarm005#67 = enEmpADConta;
               #dsarm005#68 = enEjeADConta;
               #dsarm005#74 = eaClaveAD1;
          |FINSI;

          ||4
          |SI eaNomDef = "dsmom041"; |O eaNomDef = "dsmom042";
               #dsarm005#67 = enEmpADConta;
               #dsarm005#75 = eaClaveAD1;
               #dsarm005#76 = eaClaveAD2;
          |FINSI;

          ||5
          |SI eaNomDef = "cainliva";
               #dsarm005#67 = enEmpADConta;
               #dsarm005#68 = enEjeADConta;
               #dsarm005#72 = eaClaveAD1;
               nRegFactura = 100000000 + (eaClaveAD1 * 1000) + eaClaveAD2;
               #dsarm005#73 = nRegFactura;
               ||TODO CCC
          |FINSI;

          |GRABA 020#dsarm005.a;
          |LIBERA #dsarm005;
     |FINSI;
|FPRC;

|PROCESO dsarm005Vinc;
     |SI #dsarm005#8 = 0;  |ACABA;  |FINSI;

     #referen@#0 = #dsarm005#0;
     |LEE 101#referen@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #referen@#67 = #dsarm005#8;
     #referen@#68 = 0;
     aAlfa        = #dsarm005#4 % -102;

     |ABRE #canempre@;
     |SELECT #4#canempre@;
     #canempre@#26 = aAlfa;
     #canempre@#2  = #dsarm005#8;
     |LEE 000#canempre@.=;
     |SI FSalida = 0;
         #referen@#68 = #canempre@#3;
     |FINSI;
     |CIERRA #canempre@;

     |GRABA 020#referen@.a;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE dsarm005Vinc;
     #dsarm005#14;
     ;
     00000, 0, nDesdeGrupo, nDesdeSub, "01.01.0000", 000000001;
     00000, 0, nHastaGrupo, nHastaSub, "31.12.2999", 999999999;
     ;
     NULL, dsarm005Vinc;
|FIN;

|PROCESO PonEmpresaContab;
     |DBASE aBaseB;  |QBF aBaseB;
     aMasB = aBaseB + "def/dsarm005";
     |CARGA_DEF aMasB, referen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |DBASS aBaseI;
     |QBF aBaseI;
     aCliInt = aBaseI + "/contagen/def/canempre.mas";
     |XABRE "E", aMas, nHandleI;
     |SI FSalida < 0;
         |DESCARGA_DEF #referen@;
         |ACABA;
     |FINSI;

     |CARGA_DEF aCliInt, canempre@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #referen@;
         |ACABA;
     |FINSI;

     |ABRE #referen@;
     |BUCLE dsarm005Vinc;
     |CIERRA #referen@;

     |DESCARGA_DEF #canempre@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO RecogeParametros;
     nSwModoVincula = 0;
     nSwQuitaBotonAplica = 0;

     nError = 0;

     aAux = aParametro % 110;
     |SI aAux = "DS9ALBAOCR";
          |SI #dsarm001#203 = "N";
               aMensaje = "0000Proceso cancelado. Parametro Importacion Albaranes venta no activo";
               |MENAV aMensaje;
               nError = 1;
               |ACABA;
          |FINSI;

          |HAZ EsDscomer9;
          |SI FSalida ! 0;
               aMensaje = "0000Proceso cancelado. Aplicacion de gestion (dscomer9) no instalada";
               |MENAV aMensaje;
               nError = 1;
               |ACABA;
          |FINSI;

          enGrupoErrOCR = #dsarm001#207;
          enSubGrupoErrOCR = #dsarm001#208;
          enTipoErrOCR = #dsarm001#209;
          enGrupoOCRYes = #dsarm001#204;
          enSubGrupoOCRYes = #dsarm001#205;
          enTipoOCRYes = #dsarm001#206;

          |SI enGrupoErrOCR = 0; |O enGrupoOCRYes = 0;
               aMensaje = "0000Proceso cancelado." + &13 + "Parametro Importacion Albaranes venta G/S/T no activo";
               |MENAV aMensaje;
               nError = 1;
               |ACABA;
          |FINSI;

          |SI enGrupoErrOCR = enGrupoOCRYes; |Y enSubGrupoErrOCR = enSubGrupoOCRYes;
           |Y enTipoErrOCR = enTipoOCRYes;
               aMensaje = "0000Proceso cancelado." + &13 + "G/S/T incorrectamente indicado para Importacion Albaranes";
               |MENAV aMensaje;
               nError = 1;
               |ACABA;
          |FINSI;

          enSwBandejaErrOCR = 1;
          aParametro = "";
     |FINSI;

     aAux   = aParametro % 107;
     |SI aAux = "ADCONTA";
         |SI #dsarm001#9 = "N";
             aMensaje = "0000Error: Gestion Documental no conectada a Contabilidad";
             |MENAV aMensaje;
             nError = 1;

             |ACABA;
         |FINSI;

         enSwADConta  = 1;
         nSwQuitaBotonAplica = 1;
         aAux         = aParametro % 805;
         enEmpADConta = aAux;
         aAux         = aParametro % 1301;
         enEjeADConta = aAux;
         enSwPantaDiv = 1;

         aParametro   = "";
         nDesdeGrupo  = #dsarm001#10;
         nHastaGrupo  = #dsarm001#10;
         nDesdeSub    = #dsarm001#11;
         nHastaSub    = #dsarm001#11;

         |HAZ PonEmpresaContab;
     |FINSI;

     |SI aAux = "ADCONTD";
         |SI #dsarm001#9 = "N";
             aMensaje = "0000Error: Gestion Documental no conectada a Contabilidad";
             |MENAV aMensaje;
             nError = 1;

             |ACABA;
         |FINSI;

         nSwQuitaBotonAplica = 1;
         enSwADContD  = 1;
         aAux         = aParametro % 805;
         enEmpADConta = aAux;
         aAux         = aParametro % 1301;
         enEjeADConta = aAux;
         aAux         = aParametro % 1408;
         eaNomDef     = aAux;

         ||Tiquet 2537 | 426.
         ||Fisicamente es el mismo fichero, pero con 2 nombres distintos
         |SI eaNomDef = "anz00010";
               eaNomDef = "camaasic";
         |FINSI;
         |SI eaNomDef = "anz00011";
               eaNomDef = "camaasil";
         |FINSI;

         |SI eaNomDef = "camaasic"; |O eaNomDef = "camaasil";
             aAux       = aParametro % 2202;
             eaClaveAD1 = aAux;
             aAux       = aParametro % 2410;
             eaClaveAD2 = aAux;
             aAux       = aParametro % 3406;
             eaClaveAD3 = aAux;

             |SI eaClaveAD1 = "00"; |Y eaClaveAD2 = "01.01.0000"; |Y eaClaveAD3 = "000000";
                 aMensaje = "0000Por favor, seleccione un apunte.";
                 |MENAV aMensaje;
                 nError = 1;

                 |ACABA;
             |FINSI;
             eaAuxConta1 = aParametro % 4002;
             eaAuxConta2 = aParametro % 4210;
             eaAuxConta3 = aParametro % 5212;
             eaAuxConta4 = "";
             eaAuxConta5 = "";
         |FINSI;

         |SI eaNomDef = "camaniva";
             aAux        = aParametro % 2202;
             eaClaveAD1  = aAux;
             aAux        = aParametro % 2410;
             eaClaveAD2  = aAux;
             eaClaveAD3  = "";
             eaAuxConta1 = aParametro % 3402;
             eaAuxConta2 = aParametro % 3610;
             eaAuxConta3 = aParametro % 4606;
             eaAuxConta4 = aParametro % 5202;
             eaAuxConta5 = aParametro % 5412;

             |SI eaClaveAD1 = "00"; |Y eaClaveAD2 = "0000000000"; |Y eaClaveAD3 = "";
                 aMensaje = "0000Por favor, seleccione un Reg. IVA.";
                 |MENAV aMensaje;
                 nError = 1;

                 |ACABA;
             |FINSI;
         |FINSI;

         |SI eaNomDef = "cacuenta";
             aAux       = aParametro % 2212;
             eaClaveAD1 = aAux;
             eaClaveAD2 = "";
             eaClaveAD3 = "";

             |SI eaClaveAD1 = ""; |Y eaClaveAD2 = ""; |Y eaClaveAD3 = "";
                 aMensaje = "0000Por favor, seleccione un cuenta.";
                 |MENAV aMensaje;
                 nError = 1;

                 |ACABA;
             |FINSI;
         |FINSI;

         |SI eaNomDef = "dsmom041"; |O eaNomDef = "dsmom042";
             aAux       = aParametro % 2202;
             eaClaveAD2 = aAux;
             aAux       = aParametro % 2408;
             eaClaveAD1 = aAux;
             eaClaveAD3 = "";

             |SI eaClaveAD1 = ""; |Y eaClaveAD2 = "00"; |Y eaClaveAD3 = "";
                 aMensaje = "0000Por favor, seleccione un modelo.";
                 |MENAV aMensaje;
                 nError = 1;

                 |ACABA;
             |FINSI;
         |FINSI;

         |SI eaNomDef = "cainliva";
             aAux       = aParametro % 2202;
             eaClaveAD1 = aAux;
             aAux       = aParametro % 2403;
             eaClaveAD2 = aAux;
             eaClaveAD3 = "";

             |SI eaClaveAD1 = "00"; |Y eaClaveAD2 = "000";
                 aMensaje = "0000Por favor, seleccione una factura.";
                 |MENAV aMensaje;
                 nError = 1;

                 |ACABA;
             |FINSI;
         |FINSI;

         aPopTria2  = 5;
         aPopTria3  = "Captura del disco y Vincular";
         aPopTria4  = "Escanear Documento y Vincular";
         aPopTria5  = "Vincular Documentos Pendientes";
         aPopTria6  = "Consultar Documentos";
         aPopTria7  = "Cancelar";

         aSele      = "Can";
         aPopTria1  = "0";
         IaPopTria  = aPopTria1  <-;
         |ESPECIFICA "TRACKPOPUP", aPopTria;
         |SI FSalida ! 0;
             IaPopTria  = aPopTria3  <-;
             IaPopTria  = IaPopTria + (FSalida - 1);

             aSele = aPopTria % 103;
         |FINSI;

         |SI aSele = "Can";
              nError = 1;
              |ACABA;
         |FINSI;

         |SI aSele = "Cap";

               aUsuDebug = Usuario % 810;
               |QBF aUsuDebug;
               |SI aUsuDebug = "GONA"; |O aUsuDebug = "CARLOSC";
                   ||DEBUG;
               |FINSI;

               ||TODO CCC. Captura del disco el Documento y vincular a la ficha
               ||en la que estamos.
               ||TODO CCC

               aRuta    = "";
               |HAZ Traete_dsselect;
               |SI enError = 1;
                   |MENAV "0000No puedo instala el dsselect.exe, consulte con su administrador";
               |FINSI;

               |HAZ DimeUnidad;
               eaUnidadBasico = eaUnidad + ":";
               aAux      = eaUnidadBasico + "\DOCUMENTOS\DSARCHI\";
               aPrograma = aAux + "dsselect.exe";

               aParaIni = aAux + "dsselect.ini";
               |FBORRA aParaIni;

               |ESPECIFICA "RBASS", aLocal;
               aDirLocal = aLocal;

               aBorra = aDirLocal + "dsselect.txt";
               |FBORRA aBorra;

               |ABRE #dsarm000;
               #dsarm000#0 = Usuario % 810;
               |LEE 000#dsarm000.=;
               |SI FSalida ! 0;
                    |DDEFECTO #dsarm000;
               |FINSI;
               aCarpetaCaptura = #dsarm000#27;
               |QBF aCarpetaCaptura;
               |SI aCarpetaCaptura = "";
                    aCarpetaCaptura = eaUnidadBasico;
               |FINSI;
               |CIERRA #dsarm000;

               aTextoIni = &34 + aCarpetaCaptura + &34 + " " + &34 + aBorra + &34;
               |XABRE "CW", aParaIni, nHandle;
               |SI FSalida ] 0;
                    |XGRABA nHandle, aTextoIni;
               |FINSI;
               |XCIERRA nHandle;

               aEjecuta = aPrograma;
               |RSYSTEM aEjecuta;

               aAbre = aDirLocal + "dsselect.txt";
               |XABRE "CU", aAbre, nHandle;
               |SI FSalida < 0;
                  aPath = "";
                  nError = 1;
                  |ACABA;
               |FINSI;

               |XLEE nHandle, 250, aPath;
               |SI FSalida < 0
                   aPath = "";
                   nError = 1;
                   |ACABA;
               |FINSI;

               |QBF aPath;
               |SI aPath ! "";
                   aAlfa    = aPath;
                   aFichero = "";
                   aLong    = aAlfa % 0;
                   nLong    = aLong;
                   aRuta    = "";
                   |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
                         nPos   = (nCarac * 100) + 1;
                         aCarac =  aAlfa % nPos;
                         |SI aCarac = "/";  |O aCarac = "\";
                             aProg = "";
                         |SINO;
                             aProg = aProg + aCarac;
                         |FINSI;

                         aRuta = aRuta + aCarac;
                   |SIGUE;
               |FINSI;
               |XCIERRA nHandle;

               aBorra = aDirLocal + "dsselect.txt";
               |RFBORRA aBorra;

               |SI aRuta ! ""; |Y aProg ! "";

                    aCarpetaCaptura = aRuta - aProg;
                    |QBF aCarpetaCaptura;
                    |SI aCarpetaCaptura ! "";
                         |ABRE #dsarm000;
                         #dsarm000#0 = Usuario % 810;
                         |LEE 101#dsarm000.=;
                         |SI FSalida ! 0; |GRABA 020#dsarm000.b; |FINSI;
                         #dsarm000#27 = aCarpetaCaptura;
                         |GRABA 000#dsarm000.a;
                         |LIBERA #dsarm000;
                         |CIERRA #dsarm000;
                    |FINSI;


                   |HAZ DimeUnidad;
                   aAlfa    = eaUnidad + ":\DOCUMENTOS";        |RMKDIR aAlfa;

                   aAlfa     = aAlfa + "\DSARCHI";     |RMKDIR aAlfa;
                   eaOrigen  = aRuta;
                   eaDestino = aAlfa + "/" + aProg;
                   |RCOPIA_FICHERO eaOrigen, eaDestino;
                   eaFicheroEscaner = eaDestino;
               |SINO;
                   nError = 1;
                   |ACABA;
               |FINSI;

               |QBF eaFicheroEscaner;
               |SI eaFicheroEscaner = "";
                    aMensaje = "0000Proceso cancelado. No se ha capturado ningun documento";
                    |MENAV aMensaje;
                    nError = 1;
                    |ACABA;
               |FINSI;
               |QBF aRuta;
               |QBF eaFicheroEscaner;

               |SI #dsarm001#65 = "S";
                    enGrupoTres = 0;
                    enSubGTres = 0;
                    enTipoTres = 0;
                    aEjecuta = "dsarz003;DAMETRE";
                    |SUB_EJECUTA_NP aEjecuta;
                    |SI enGrupoTres ! 0;
                         nGrupo = enGrupoTres;
                         nSubGrupo = enSubGTres;
                         nTipo = enTipoTres;
                         |HAZ MeteRegCaptura;

                    |FINSI;
               |SINO;
                    |SI #dsarm001#8 = "S";
                         nElementos = 0;
                         nHay = 0;
                         nGrupoBucle = #dsarm001#12;
                         nSubGruBucle = #dsarm001#13;
                         |BUCLE CreaPopUp_pri;
                         |SI nHay = 1;
                              |SI nElementos = 1;
                                   aAux = aContenido % 103;
                                   nTipo = aAux;
                              |SINO;
                                   |HAZ ElPopUp;
                                   |SI nTipo = -1;
                                        aMensaje = "0000Proceso de Vinculacion cancelado por el usuario";
                                        |MENAV aMensaje;
                                        |ACABA;
                                   |FINSI;
                              |FINSI;
                              nGrupo = #dsarm001#12;
                              nSubGrupo = #dsarm001#13;
                              |HAZ MeteRegCaptura;
                         |SINO;
                              aMensaje = "0000NO existen TIPOS definidos para el Grupo/Subgrupo Vinculados";
                              |MENAV aMensaje;
                              |ACABA;
                         |FINSI;
                    |SINO;
                         nGrupo = #dsarm001#12;
                         nSubGrupo = 1;
                         nTipo = 1;
                         |HAZ MeteRegCaptura;
                    |FINSI;
               |FINSI;

               nError = 1;
               |ACABA;
         |FINSI;


         |SI aSele = "Esc";
               ||TODO CCC. Escanear Documento y vincular a la ficha
               ||en la que estamos.
               ||No se si luego se sale .. o continuara el proceso.
               ||Falta estudiar-lo.

               ||ARA66. DESCOMENTAR ||TODO CCC

               |VENTANA 0501, 2999, -1, 16, aAlfa;
               nVentana = FSalida;

               aVent1 = -1;
               aVent2 = -1;
               aVent3 = 0;
               aVent4 = nVentana;
               aVent5 = "MODAL";
               |ESPECIFICA "ESTADO_VENTANA", aVent;

               eaFicheroEscaner = "";
               |SUB_EJECUTA_NP "dsarz001;VOLVERESCANEAR";

               aVent1 = -1;
               aVent2 = -1;
               aVent3 = 0;
               aVent4 = nVentana;
               aVent5 = "MODELESS";
               |ESPECIFICA "ESTADO_VENTANA", aVent;

               |FINVENTANA nVentana;

               |PULSATECLA;

               |QBF eaFicheroEscaner;
               |SI eaFicheroEscaner = "";
                    aMensaje = "0000Proceso cancelado. No se ha escaneado ningun documento";
                    |MENAV aMensaje;
                    nError = 1;
                    |ACABA;
               |FINSI;

               aProg    = "";
               aAlfa    = eaFicheroEscaner;
               aFichero = "";
               aLong    = aAlfa % 0;
               nLong    = aLong;
               aRuta    = "";
               |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
                     nPos   = (nCarac * 100) + 1;
                     aCarac =  aAlfa % nPos;
                     |SI aCarac = "/";  |O aCarac = "\";
                         aProg = "";
                     |SINO;
                         aProg = aProg + aCarac;
                     |FINSI;

                     aRuta = aRuta + aCarac;
               |SIGUE;

               |QBF aRuta;
               |QBF eaFicheroEscaner;

               |SI #dsarm001#65 = "S";
                    enGrupoTres = 0;
                    enSubGTres = 0;
                    enTipoTres = 0;
                    aEjecuta = "dsarz003;DAMETRE";
                    |SUB_EJECUTA_NP aEjecuta;
                    |SI enGrupoTres ! 0;
                         nGrupo = enGrupoTres;
                         nSubGrupo = enSubGTres;
                         nTipo = enTipoTres;
                         |HAZ MeteRegEscaner;
                    |FINSI;
               |SINO;
                    |SI #dsarm001#8 = "S";
                         nElementos = 0;
                         nHay = 0;
                         nGrupoBucle = #dsarm001#12;
                         nSubGruBucle = #dsarm001#13;
                         |BUCLE CreaPopUp_pri;
                         |SI nHay = 1;
                              |SI nElementos = 1;
                                   aAux = aContenido % 103;
                                   nTipo = aAux;
                              |SINO;
                                   |HAZ ElPopUp;
                                   |SI nTipo = -1;
                                        aMensaje = "0000Proceso de Vinculacion cancelado por el usuario";
                                        |MENAV aMensaje;
                                        |ACABA;
                                   |FINSI;
                              |FINSI;
                              nGrupo = #dsarm001#12;
                              nSubGrupo = #dsarm001#13;
                              |HAZ MeteRegEscaner;
                         |SINO;
                              aMensaje = "0000NO existen TIPOS definidos para el Grupo/Subgrupo Vinculados";
                              |MENAV aMensaje;
                              |ACABA;
                         |FINSI;
                    |SINO;
                         nGrupo = #dsarm001#12;
                         nSubGrupo = 1;
                         nTipo = 1;
                         |HAZ MeteRegEscaner;
                    |FINSI;
               |FINSI;

               nError = 1;
               |ACABA;
         |FINSI;

         |SI aSele = "Vin";
                 enSwPosicionate = 1;
                 enSwADContD     = 0;
                 enSwADConta     = 1;
                 aAux            = aParametro % 805;
                 enEmpADConta    = aAux;
                 aAux            = aParametro % 1301;
                 enEjeADConta    = aAux;
                 aParametro      = "";
                 nDesdeGrupo     = #dsarm001#10;
                 nHastaGrupo     = #dsarm001#10;
                 nDesdeSub       = #dsarm001#11;
                 nHastaSub       = #dsarm001#11;
                 enSwPantaDiv    = 1;
         |FINSI;

         |SI aSele = "Con";
              nSwHayDocs = 0;
              |HAZ MiraHayDocs;
              |SI nSwHayDocs = 0;
                    aMensaje = "0000Sin documentos asociados";
                    |MENAV aMensaje;
                    nError = 1;

                    |ACABA;
              |FINSI;
              nSwQuitaBotonAplica = 1;
         |FINSI;

         aParametro = "";
     |FINSI;

     |SI aAux = "VINCULA";
          eaTipoVincu = aParametro % 808;
          |QBF eaTipoVincu;
          |SI eaTipoVincu = "";
               nError = 1;
               |MENAV "0000Error al pasar los parametros al dsarchi";
               |ACABA;
          |FINSI;
          |SI eaTipoVincu = "ESTALLER";
               eaTipoVincu = "TALLER";
          |FINSI;

          eaValorVincu1 = aParametro % 1630;
          eaValorVincu2 = aParametro % 4630;

          ||Creo un temporal con los resultados .... y luego llamo al equivalente al boton de buscar.

          nSwQuitaBotonAplica = 1;

          nSwModoVincula = 1;
          aParametro = "";
          |ACABA;
     |FINSI;

     aAux   = aParametro % 108;
     |SI aAux = "DESPABOX";
         enDESPANET = 1;
         aParametro = "";

         aUsuario = Usuario % 810;
         |ABRE #dpntm001;
         #dpntm001#0 = aUsuario;
         |LEE 000#dpntm001.=;
         |SI FSalida ! 0;
             nError = 1;
             |MENAV "0000No tiene permiso para entrar en esta opci¢n, no es un usuario DESPABOX";
         |FINSI;
         |CIERRA #dpntm001;

         enSwADConta = 0;
         enSwADContD = 0;
     |FINSI;
|FPRC;

|PROCESO CompruebaFic;
     nOk  = 1;
     aFic = aLista < "";

     aAlfa = aFic - ".jpg";
     |SI FSalida ! 0;  nOk = 0;  |ACABA;  |FINSI;

     aAlfa = aFic - ".ini";
     |SI FSalida ! 0;  nOk = 0;  |ACABA;  |FINSI;

     aAlfa = aFic - ".exe";
     |SI FSalida ! 0;  nOk = 0;  |ACABA;  |FINSI;

     aAlfa = aFic - ".tgz";
     |SI FSalida ! 0;  nOk = 0;  |ACABA;  |FINSI;

     aAlfa = aFic - ".dll";
     |SI FSalida ! 0;  nOk = 0;  |ACABA;  |FINSI;

     aAlfa = aFic - ".sh";
     |SI FSalida ! 0;  nOk = 0;  |ACABA;  |FINSI;
|FPRC;

|PROCESO BorraDocCache;
     |HAZ LeeUnidadBasico;

     aLista = eaUnidadBasico + "\DOCUMENTOS\DSARCHI\*.*";
     |R_PDIR aLista;
     |PARA; |SI FSalida = 0; |HACIENDO;
          |HAZ CompruebaFic;

          |SI nOk = 1;
              |RFBORRA aLista;
          |FINSI;

          |R_SDIR aLista;
     |SIGUE;
|FPRC;


|PROCESO Vinculacion;
     ||ARA23 Creo el temporal .. y luego .. ejecuto lo del boton.
     ||Falta carga el 905 con los vinculos externos, como se hace al buscar

     |HAZ CreaTempoVinculacion;

     |HAZ GridFicheroBusqueda;

     enBusqueda = 1;

     |ESTADO_CONTROL nBoton0_5, "ENABLE";

     |ESTADO_CONTROL nBoton0_16, "DISABLE";
|FPRC;

|PROGRAMA;
     aAlfa = Usuario % 810;  |QBF aAlfa;
     |SI aAlfa = "MOSA";
         ||DEBUG;
     |FINSI;

     |SI PARAMETRO ! "";
         |PULSATECLA;
     |FINSI;

     aVacio25  = (" " * 25);
     aZeta25   = ("z" * 25);
     enModoBus = 0;

     aQueQuiero  = "|NC";
     enNumCampos = #dsarm005#aQueQuiero#;
     enNumCampos = enNumCampos - 1;

     |ABRE #dsarm001;
     |LEE 000#dsarm001.p;
     |SI FSalida ! 0;  |DDEFECTO #dsarm001;  |FINSI;
     |CIERRA #dsarm001;

     eaPrograma = "IPABOGAX";
     |HAZ DSARCHI_INI;
     |SI enAprobacion = 1;
          |DBASS aAlfaEsta;
          |QBF aAlfaEsta;
          aAlfaEsta = aAlfaEsta + "facturar/def/abom0001.mas";
          |XABRE "E", aAlfaEsta, 0;
          |SI FSalida = 0;
               nSwIpAbogax = 1;
          |SINO;
               nSwIpAbogax = 0;
          |FINSI;
     |SINO;
          nSwIpAbogax = 0;
     |FINSI;

     |ABRE #dsarz010;

     aParametro = PARAMETRO;
     |QBF aParametro;

     aAux = aParametro % 107;
     |SI aAux = "CLINICA";
          |CABEZA "Consulta Documentos";

          |SI #dsarm001#194 = "N";
               aMensaje = "0000Conexi¢n cl¡nica no activa. Proceso cancelado";
               |MENAV aMensaje;
               |ACABA;
          |FINSI;
          enSwModoClinica = 1;

          aAux = aParametro - "CLINICA";
          |QBF aAux;
          |SI aAux = "_"; |O aAux = "";
               enHHHHClinica = 0;
               enEEEEClinica = 0;
          |SINO;
               aHHHH = "";
               aEEEE = "";
               nSwHayBarra = 0;
               aLong = aAux % A0;
               nLong = aLong;
               |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
                    aSaca = nVoy + "01";
                    aLetra = aAux % aSaca;
                    |SI aLetra = "_";
                         nSwHayBarra = nSwHayBarra + 1;
                    |SINO;
                         |SI nSwHayBarra = 0;
                              aHHHH = aHHHH + aLetra;
                         |SINO;
                              aEEEE = aEEEE + aLetra;
                         |FINSI;
                    |FINSI;
               |SIGUE;

               |QBF aHHHH;
               |SI aHHHH ! "";
                    enHHHHClinica = aHHHH;
               |SINO;
                    enHHHHClinica = 0;
               |FINSI;
               |QBF aEEEE;
               |SI aEEEE ! "";
                    enEEEEClinica = aEEEE;
               |SINO;
                    enEEEEClinica = 0;
               |FINSI;
          |FINSI;
          aParametro = "";
     |FINSI;

     aAlfa = aParametro % -107;
     |SI aAlfa = "laboral";
          aParametro = aParametro - "laboral";
          enLABORAL = 1;
     |SINO;
          enLABORAL = 0;
     |FINSI;

     aAlfa = aParametro % 106;
     |SI aAlfa = "CAPDOC";
          nSwModoCapDoc = 1;
          aNombreCapDoc = aParametro % 708;
          |QBF aNombreCapDoc;

          aAlfa = aParametro % 15;
          |QBF aAlfa;
          aParametro = aAlfa;
     |FINSI;

     aUsuario = Usuario % 810;
     |DDEFECTO #dsarz010;
     #dsarz010#0 = aUsuario;
     |LEE 000#dsarz010.=;
     |SI FSalida ! 0;
          |PARA nCampo = 3;  |SI nCampo [ 52;  |HACIENDO nCampo = nCampo + 1;
               #dsarz010#nCampo# = "S";
          |SIGUE;
     |FINSI;

     nDesdeGrupo  = 0;
     nHastaGrupo  = 999;
     nDesdeSub    = 0;
     nHastaSub    = 999;
     enSwPantaDiv = 0;

     |SI aParametro ! "";
         |HAZ RecogeParametros;
         |SI nError = 1;  |ACABA;  |FINSI;
     |SINO;
         aUsuario = Usuario % 810;
         |ABRE #dpntm001;
         #dpntm001#0 = aUsuario;
         |LEE 000#dpntm001.=;
         |SI FSalida = 0;
             |MENAV "0000No tiene permiso para entrar en esta opci¢n, es un usuario DESPABOX";
             |CIERRA #dpntm001;
             |ACABA;
         |FINSI;
         |CIERRA #dpntm001;
     |FINSI;

     nParametro = aParametro;

     |ABRE #dsarm000;
     #dsarm000#0 = Usuario % 810;
     |LEE 000#dsarm000.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsarm000;
     |FINSI;
     |CIERRA #dsarm000;

     aQueUsu = #dsarm000#28;  |QBF aQueUsu;

     nRango     = 2 + 4 + 8 + 16 + 32 + 128;

     nPosDRamas = 1002;
     nPosHRamas = 2098;
     nPosDGrid  = 2104;
     nPosHGrid  = 2998;

     |SI enSwPantaDiv = 0;
          nPos1      = 1002;
          nPos2      = 2998;
     |SINO;
          nPos1      = 1002;
          nPos2      = 1798;
     |FINSI;

     fFecha     = ~;
     aDFecha    = #dsarm000#3;
     aTipoFecha = #dsarm000#4;
     aHFecha = fFecha;

     |SI #dsarm001#191 = "S";
         aTipoFecha = "1";
         aDFecha    = "01.01.0000";
     |FINSI;

     |SI enSwADConta = 1;
          aLabel = "ADCONTA: VINCULAR" + " " + enEmpADConta + ":" + enEjeADConta;
          |VENTANA 0501, 3299, -1, 16, aLabel;
          nVentana = FSalida;
     |FINSI;

     |HAZ CalculaFecha;

     |HAZ BotonesPanta0;
     |SI nSwModoVincula = 1;
          |HAZ Vinculacion;
     |SINO;
          |SI enSwModoClinica = 1;

               ||Ejecuto la SQL  (ver ClinicaBuscaPac)
               aAux = ( enHHHHClinica + "                              ") % 130;
               aNomFicheroAux = ("01" + Usuario + "zzzzzzzz") % 108;
               aSQL = "SELECT * FROM dsarm005 INTO " + aNomFicheroAux + " WHERE 97 == " + "'" + aAux + "'";
               |SQL aSQL;

               |HAZ GridFicheroBusqueda;
               enBusqueda = 1;
               |PULSATECLA;

               |SI nBoton0_9 ! -1;
                   |ESTADO_CONTROL enGrid, "HIDE";
                   nEstadoGrid = -1;
                   |HAZ Boton0_8;
               |FINSI;

               |ESTADO_CONTROL nBoton0_16, "DISABLE";
          |SINO;
               |HAZ GridFicheroEntero;
          |FINSI;
     |FINSI;

     |SI enSwADConta = 1; |Y enSwCargaDef = 0;
          |SI eaNomDef ! "cainliva";
              |FINVENTANA nVentana;
              |ACABA;
          |FINSI;
     |FINSI;

     |HAZ ControlPermisos;

     FSalida = 1;
     |SI enBusqueda = 1;
          |HAZ EventoPanta905;
          |SI enSwModoClinica = 1;
               |ESTADO_CONTROL nBoton0_5, "DISABLE";
          |FINSI;
     |SINO;
          |HAZ EventoPanta1;
          |ESTADO_CONTROL nBoton0_5, "DISABLE";
     |FINSI;

     #dsarm008#0 = #dsarm000#2;
     |LEE 000#dsarm008.=;
     |SI FSalida ! 0;  |DDEFECTO #dsarm008;  |FINSI;

     |SI enSwBandejaErrOCR = 1;
         #dsarm000#1 = "L";
     |FINSI;

     |SI #dsarm000#1 = "A"; |Y enSwPantaDiv = 0; |Y enSwADContD = 0;
         |HAZ CreaArbol;
         |HAZ Boton0_8;
     |SINO;
         enBusqueda = 1;
     |FINSI;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         |SI #dsarm000#1 = "L";  FSalida = "::Salir," + enGrid;  |FINSI;
         |SI #dsarm000#1 = "A";  FSalida = "::Salir," + nTree;   |FINSI;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |SI nBoton0_8  ! -1;  #dsarm000#1 = "L";  |FINSI;
     |SI nBoton0_9  ! -1;  #dsarm000#1 = "A";  |FINSI;

     |SI enSwBandejaErrOCR = 0;
         |ABRE #dsarm000;
         aTipoVista = #dsarm000#1;
         #dsarm000#0 = Usuario % 810;
         |LEE 101#dsarm000.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsarm000;
             #dsarm000#0 = Usuario % 810;
             |GRABA 020#dsarm000.b;
         |FINSI;
         #dsarm000#1  = aTipoVista;
         #dsarm000#2  = #dsarm008#0;
         #dsarm000#3  = aDFecha;
         #dsarm000#4  = aTipoFecha;
         #dsarm000#28 = aQueUsu;
         |GRABA 020#dsarm000.a;
         |LIBERA #dsarm000;
         |CIERRA #dsarm000;
     |FINSI;

     |SI nSwModoCapDoc = 1;
          |FIN_CONTROL_WINDOWS nBoton0_15;
          |FIN_CONTROL_WINDOWS nBoton0_20;
     |SINO;
          |FIN_CONTROL_WINDOWS nBoton0_1;
          |FIN_CONTROL_WINDOWS nBoton0_2;
          |FIN_CONTROL_WINDOWS nBoton0_3;
          |FIN_CONTROL_WINDOWS nBoton0_4;
          |FIN_CONTROL_WINDOWS nBoton0_5;
          |FIN_CONTROL_WINDOWS nBoton0_6;
          |FIN_CONTROL_WINDOWS nBoton0_7;
          |FIN_CONTROL_WINDOWS nBoton0_12;
          |FIN_CONTROL_WINDOWS nBoton0_13;
          |FIN_CONTROL_WINDOWS nBoton0_14;
          |FIN_CONTROL_WINDOWS nBoton0_15;
          |FIN_CONTROL_WINDOWS nBoton0_16;

          |FIN_CONTROL_WINDOWS nBotonMas;
          |FIN_CONTROL_WINDOWS nBotonMulti;
          |SI enSwDefMultiSele = 1;
               |HAZ DesCargaDefMulti;
          |FINSI;


          |SI nSwIpAbogax = 1;
               |FIN_CONTROL_WINDOWS nBoton0_abogax;
          |FINSI;
          |SI #dsarm001#194 = "S";
               |FIN_CONTROL_WINDOWS nBotonBuscaPac;
          |FINSI;

          |SI enSwPantaDiv = 1;
               |FIN_CONTROL_WINDOWS enBotonADC1;
               |FIN_CONTROL_WINDOWS enBotonADC2;
               |FIN_CONTROL_WINDOWS enBotonADC3;
               |FIN_CONTROL_WINDOWS enBotonADC4;
               |FIN_CONTROL_WINDOWS enBotonADC5;
               |FIN_CONTROL_WINDOWS enBotonADC6;
               |FIN_CONTROL_WINDOWS enBotonADC7;
               |FIN_CONTROL_WINDOWS enBotonADC8;
               |FIN_CONTROL_WINDOWS enBotonADC9;
               |FIN_CONTROL_WINDOWS enBotonADC10;

               |SI enSwDefSele = 1;
                    |HAZ DesCarga905;
               |FINSI;
          |FINSI;

          |SI nBoton0_8  ! -1;  |FIN_CONTROL_WINDOWS nBoton0_8;   |FINSI;
          |SI nBoton0_9  ! -1;  |FIN_CONTROL_WINDOWS nBoton0_9;   |FINSI;
          |SI nBoton0_10 ! -1;  |FIN_CONTROL_WINDOWS nBoton0_10;  |FINSI;
          |SI nBoton0_11 ! -1;  |FIN_CONTROL_WINDOWS nBoton0_11;  |FINSI;
          |SI nTree      ! -1;  |FIN_CONTROL_WINDOWS nTree;       |FINSI;

          |SI nGridTree ! -1;
              |DESTRUYECONTROL nGridTree;
              |FIN_CONTROL_WINDOWS nBtnGuarda;
          |FINSI;
     |FINSI;

     |CIERRA #dsarm055;

     |DESTRUYECONTROL enGrid;

     eaFicheroTxt  = "dsarm00501" + Usuario + ".txt";
     aAlfa         = eaRutaDestino + eaFicheroTxt;
     |RFBORRA aAlfa;

     |CIERRA #dsarz010;

     |SI enSwADConta = 1;
          |FINVENTANA nVentana;
     |FINSI;

     |SI enLABORAL = 1;
          |HAZ DescargaSqlLaboral;
     |FINSI;

     |PULSATECLA;
     |PULSATECLA;

     |HAZ ControlBorraCache;

     |HAZ BorraTempoVistaVZ;
|FPRO;

/****************************************************************************/
/* ESTA PARTE ES SOLO PARA LA NOMINA DE MOMENTO, CONSULTA POR NIF DE TRABAJ
/****************************************************************************/


|PROCESO AltaPantaLab_905;
     #dsarm005@#0 = 999999999;
|FPRC;

|PROCESO BajaPantaLab_905;
     #dsarm005@#0 = 000000001;
|FPRC;

|PROCESO GridFichero905;
     aAlfa = "tm" + Usuario;
     |NOME_DAT #dsarm005@#aAlfa#;

     |ABRE #dsarm005@;
     |LEE 000#dsarm005@.p;

     aAlfa = aParametro % 0;
     |LINEAL_SIMPLE #1#dsarm005@, nRango, nPos1, nPos2, BajaPanta905_1, AltaPanta905_1, EventoPanta905;

     enGrid       = FSalida;
     nEstadoGrid  = FSalida;
     nFichero = 905;

     |FOCOTECLADO enGrid;
|FPRC;

|PROCESO Tipo80w087; |TIPO 80;
     FSalida = 3299;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     |DBASE aMas;  |QBF aMas;
     aMas = aMas + "def/dsarm005.mas";
     |CARGA_DEF aMas, dsarm005@;
     |SI FSalida ! 0;
          |MENAV "0000[dsarm005.mas] inaccesible. Consulte con su distribuidor.";
          |ACABA;
     |FINSI;

     eaFichero = ("01" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dsarm005@#eaFichero#;
     |ABRE #dsarm005@;  |CIERRA #dsarm005@;  |DELINDEX #dsarm005@;

     |ABRE #dsarm005;
     |ABRET #dsarm008;

     FSalida = 3299;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |HAZ Descarga999;

     |SI aDestino ! "";
          |RFBORRA aDestino;
          aDestino = "";
     |FINSI;

     |SI #dsarm001#181 = "S";
         |HAZ BorraDocCache;
     |FINSI;

     |CIERRA #dsarm005;
     |CIERRAT #dsarm008;

     || RPRIEGO - Tiquet: 002805-00265
     || no habia DESCARGA_DEF !!!

     |ABRE #dsarm005@;  |CIERRA #dsarm005@;  |DELINDEX #dsarm005@;
     |DESCARGA_DEF #dsarm005@;
|FPRC;
