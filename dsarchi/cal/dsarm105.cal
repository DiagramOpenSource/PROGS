||Modulo ADConta

|FICHEROS;
     dsarm001;
     dsarm002;
     dsarm003;
     dsarm004;
     dsarm005;

     dsarw021;

     camaw001@;               ||Apuntes Contables
     camaniva@;               ||Facturas
     cacuenta@;               ||Cuentas
     dsmom041@;               ||Amortizaciones Cab (MODELOS)
     dsarm005@;
     referen@;
|FIN;

|VARIABLES;
     &enSwPlantillaConta  = 0;
     &enLibroConta        = 0;
     &enDocumentoConta    = 0;
     &enNoQuieroQueEntres = 0;

     ||Para comparar si tiene o no los mismos literales campos origen y destino
     aLiteral1Ori = "";       ||Primero los 10 alfa
     aLiteral2Ori = "";       ||Despues los 5 numericos
     aLiteral3Ori = "";       ||por ultimo los 5 campos fecha
     aLiteral4Ori = "";
     aLiteral5Ori = "";
     aLiteral6Ori = "";
     aLiteral7Ori = "";
     aLiteral8Ori = "";
     aLiteral9Ori = "";
     aLiteral10Ori = "";
     aLiteral11Ori = "";
     aLiteral12Ori = "";
     aLiteral13Ori = "";
     aLiteral14Ori = "";
     aLiteral15Ori = "";
     aLiteral16Ori = "";
     aLiteral17Ori = "";
     aLiteral18Ori = "";
     aLiteral19Ori = "";
     aLiteral20Ori = "";

     aLiteral1Des = "";       ||Primero los 10 alfa
     aLiteral2Des = "";       ||Despues los 5 numericos
     aLiteral3Des = "";       ||por ultimo los 5 campos fecha
     aLiteral4Des = "";
     aLiteral5Des = "";
     aLiteral6Des = "";
     aLiteral7Des = "";
     aLiteral8Des = "";
     aLiteral9Des = "";
     aLiteral10Des = "";
     aLiteral11Des = "";
     aLiteral12Des = "";
     aLiteral13Des = "";
     aLiteral14Des = "";
     aLiteral15Des = "";
     aLiteral16Des = "";
     aLiteral17Des = "";
     aLiteral18Des = "";
     aLiteral19Des = "";
     aLiteral20Des = "";
     nSwEtiquetasDistintas = 0;

     &enModoVincula = 0;
     &enGrupoVincula = 0;
     &enSubGruVincula = 0;
     &enTipoVincula = 0;

     nSwObligatorios  = 0;
     &enDocumento     = 0;
     &enModoModiw006 = 0;
     &enSwErrorModiw006 = 0;

     &enSwCargaDef = 0;
     &enGrupoTres = 0;
     &enSubGTres = 0;
     &enTipoTres = 0;


     aEjecuta = "";
     nSwMulti = 0;
     nPanta21 = 0;
     nGridSel = 0;
     nBotonQuita = 0;

 {-1}get = "";
     get1 = 0;
     get2 = 0;
     get3 = 0;
     get4 = 0;
     get5 = "";

     nVentana = 0;

     aCadena = "";
     nCampoHasta = 0;
     nCampo = 0;

     &enSwDefSele = 0;
     &enNumSeleADC = 0;
     &enSwError = 0;
     &enGrupoPV = 0;
     &enSubGrupoPV = 0;
     &enTipoPV = 0;

     nGrupoBucle = 0;
     nSubGruBucle = 0;
     &eaNomDef = "";
     &enSwPosicionate = 0;
     &eaClaveAD1 = "";
     &eaClaveAD2 = "";
     &eaClaveAD3 = "";

     aFichero = "";
     aIPRemoto   = "";
     aOrigen = "";
     aDestino = "";

     nGrupoAnt = 0;
     nSubGruAnt = 0;
     nTipoAnt = 0;

     aDirDatModelos = "";
     aDirModel = "";
     nRegFactura = 0;

     aDef = "";
     aAux = "";
     nSwBusActiva = 0;
     aEmpresa = "";
     aEjercicio = "";
     aAuxPara = "";
     nVentm5 = 0;
     aMas = "";
     nGrupo = 0;
     nSubGrupo = 0;
     nTipo = 0;
     nError = 0;
     nReg005 = 0;

     {-1}aVent      = "";
         aVent1     = 0;
         aVent2     = 0;
         aVent3     = 0;
         aVent4     = 0;
         aVent5     = "";

     nElementos = 0;
     nHay = 0;
     {1000} aPopup          = "";
     aAlfa = "";
     aContenido = "";

     &enBusqueda = 0;
     &enGrid = 0;

     &enSw999CargaDef = 0;
     &enError = 0;
     &enLinea005 = 0;
     &enSwADConta = 0;
     &enEmpADConta = 0;
     &enEjeADConta = 0;
     &enSwPantaDiv = 0;
     &enBotonADC1 = 0;
     &enBotonADC2 = 0;
     &enBotonADC3 = 0;
     &enBotonADC4 = 0;
     &enBotonADC5 = 0;
     &enBotonADC6 = 0;
     &enBotonADC7 = 0;
     &enBotonADC8 = 0;
     &enBotonADC9 = 0;
     &enBotonADC10 = 0;
     &enEstoyBoton = 0;
     &eaFichero = "";

     aBase = "";
     aDirConta = "";
     aDirDatos = "";
     aApuntes = "";
     nRango = 0;
     nPos1 = 0;
     nPos2 = 0;
     aMensaje = "";

     &enGridADC1 = 0;
     &enGridADC2 = 0;
     &enGridADC3 = 0;
     &enGridADC4 = 0;
     &enGridADC5 = 0;
     &enGrid999 = 0;
|FIN;

|PROCESO CargaDefs;
     |DBASS aBase;
     |QBF aBase;

     aDirConta = aBase + "contagen/";
     aDirModel = aBase + "modelos/";
     aDirDatos = aDirConta + "fich/" + (("00000" + enEmpADConta) % -105) + (("0" + enEjeADConta) % -101) + "/";
     aDirDatModelos = aDirModel + "fich/";

     aApuntes = aDirConta + "def/camaw001";
     |CARGA_DEF aApuntes, camaw001@;
     |SI FSalida ! 0;
          aMensaje  = "0000[camaw001.mas] inaccesible. Consulte con su distribuidor." + &13 + "[Modulo 000adc instalado?]";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;

     aDef = aDirConta + "def/camaniva";
     |CARGA_DEF aDef, camaniva@;
     |SI FSalida ! 0;
          |MENAV "0000[camaniva.mas] inaccesible. Consulte con su distribuidor.";
          |ACABA;
     |FINSI;

     aDef = aDirConta + "def/cacuenta";
     |CARGA_DEF aDef, cacuenta@;
     |SI FSalida ! 0;
          |MENAV "0000[cacuenta.mas] inaccesible. Consulte con su distribuidor.";
          |ACABA;
     |FINSI;

     aDef = aDirModel + "def/dsmom041";
     |CARGA_DEF aDef, dsmom041@;
     |SI FSalida ! 0;
          |MENAV "0000[dsmom041.mas] inaccesible (modelos). Consulte con su distribuidor.";
          |ACABA;
     |FINSI;

     |PATH_DAT #camaw001@#aDirDatos#;
     |PATH_DAT #camaniva@#aDirDatos#;
     |PATH_DAT #cacuenta@#aDirDatos#;
     |PATH_DAT #dsmom041@#aDirDatModelos#;

     |ABRE #camaw001@;
     |ABRE #camaniva@;
     |ABRE #cacuenta@;
     |ABRE #dsmom041@;

     |C_M #camaw001@#0, 1, "S";
     |C_M #camaw001@#1, 1, "S";
     |C_M #camaw001@#2, 1, "S";
     |C_M #camaw001@#3, 1, "S";
     |C_M #camaw001@#4, 1, "S";
     |C_M #camaw001@#6, 1, "S";
     |C_M #camaw001@#7, 1, "S";
     |C_M #camaw001@#8, 1, "S";
     |C_M #camaw001@#9, 1, "S";

     |C_M #camaw001@#5, 1, "N";
     |C_M #camaw001@#10, 1, "N";
     |C_M #camaw001@#11, 1, "N";
     |C_M #camaw001@#12, 1, "N";
     |C_M #camaw001@#13, 1, "N";
     |C_M #camaw001@#14, 1, "N";
     |C_M #camaw001@#15, 1, "N";
     |C_M #camaw001@#16, 1, "N";
     |C_M #camaw001@#17, 1, "N";
     |C_M #camaw001@#18, 1, "N";
     |C_M #camaw001@#19, 1, "N";
     |C_M #camaw001@#20, 1, "N";
     |C_M #camaw001@#21, 1, "N";
     |C_M #camaw001@#22, 1, "N";
     |C_M #camaw001@#23, 1, "N";
     |C_M #camaw001@#24, 1, "N";
     |C_M #camaw001@#25, 1, "N";
     |C_M #camaw001@#26, 1, "N";
     |C_M #camaw001@#27, 1, "N";
     |C_M #camaw001@#28, 1, "N";
     |C_M #camaw001@#29, 1, "N";
     |C_M #camaw001@#30, 1, "N";

     enSwCargaDef = 1;
|FPRC;

|PROCESO DescargaDefs;
     |CIERRA #camaw001@;
     |CIERRA #camaniva@;
     |CIERRA #cacuenta@;
     |CIERRA #dsmom041@;
     |DESCARGA_DEF #dsmom041@;
     |DESCARGA_DEF #cacuenta@;
     |DESCARGA_DEF #camaniva@;
     |DESCARGA_DEF #camaw001@;
|FPRC;

|PROCESO Baja999;
     #referen@#0 = enEmpADConta;
     #referen@#2 = "        ";
     #referen@#3 = 00;
|FPRC;

|PROCESO Alta999;
     #referen@#0 = enEmpADConta;
     #referen@#2 = "zzzzzzzz";
     #referen@#3 = 99;
|FPRC;

|PROCESO BajaPanta500;
 #camaw001@#0 = 00;
 #camaw001@#1 = "01.01.0000";
 #camaw001@#2 = 000001;
 #camaw001@#3 = 0001;
|FPRC;

|PROCESO AltaPanta500;
 #camaw001@#0 = 99;
 #camaw001@#1 = "31.12.2999";
 #camaw001@#2 = 999999;
 #camaw001@#3 = 9999;
|FPRC;

|PROCESO BajaPanta501;
 #camaniva@#0 = 00;
 #camaniva@#1 = 0000000000;
|FPRC;

|PROCESO AltaPanta501;
 #camaniva@#0 = 99;
 #camaniva@#1 = 9999999999;
|FPRC;

|PROCESO BajaPanta502;
 #cacuenta@#0 = "            ";
|FPRC;

|PROCESO AltaPanta502;
 #cacuenta@#0 = "zzzzzzzzzzzz";
|FPRC;

|PROCESO BajaPanta503;
 #dsmom041@#0 = enEmpADConta;
 #dsmom041@#2 = "        ";
 #dsmom041@#3 = 00;
|FPRC;

|PROCESO AltaPanta503;
 #dsmom041@#0 = enEmpADConta;
 #dsmom041@#2 = "zzzzzzzz";
 #dsmom041@#3 = 99;
|FPRC;

|PROCESO Evento500;
|FPRC;

|PROCESO Evento501;
|FPRC;

|PROCESO Evento502;
|FPRC;

|PROCESO Evento503;
|FPRC;

|PROCESO PintaGrids;
     nRango     = 2 + 4 + 8 + 16 + 32 + 128;

     nPos1      = 2102;
     nPos2      = 3098;

     |LINEAL_SIMPLE #1#camaw001@, nRango, nPos1, nPos2, BajaPanta500, AltaPanta500, Evento500;
     enGridADC1 = FSalida;

     |LINEAL_SIMPLE #1#camaniva@, nRango, nPos1, nPos2, BajaPanta501, AltaPanta501, Evento501;
     enGridADC2 = FSalida;
     |ESTADO_CONTROL enGridADC2, "HIDE";

     |LINEAL_SIMPLE #1#cacuenta@, nRango, nPos1, nPos2, BajaPanta502, AltaPanta502, Evento502;
     enGridADC3 = FSalida;
     |ESTADO_CONTROL enGridADC3, "HIDE";

     |LINEAL_SIMPLE #1#dsmom041@, nRango, nPos1, nPos2, BajaPanta503, AltaPanta503, Evento503;
     enGridADC4 = FSalida;
     |ESTADO_CONTROL enGridADC4, "HIDE";

     |SI enSwPosicionate = 1;
          |SI eaNomDef = "camaniva";
               enEstoyBoton = 2;
               |ESTADO_CONTROL enGridADC1, "HIDE";
               |ESTADO_CONTROL enGridADC2, "SHOW";
               |ESTADO_CONTROL enBotonADC1,  "ENABLE";
               |ESTADO_CONTROL enBotonADC2,  "DISABLE";
               #camaniva@#0 = eaClaveAD1;
               #camaniva@#1 = eaClaveAD2;
               |LEE 000#camaniva@.=;
               |REFRESCACONTROL enGridADC2;
          |SINO;
               #camaw001@#0 = eaClaveAD1;
               #camaw001@#1 = eaClaveAD2;
               #camaw001@#2 = eaClaveAD3;
               ||ARA38
               #camaw001@#3 = 01;
               |LEE 000#camaw001@.];
               |REFRESCACONTROL enGridADC1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonADC1;
     enEstoyBoton = 1;
     |SI nSwBusActiva = 1;
          |HAZ BotonADC7;
     |FINSI;

     |ESTADO_CONTROL enBotonADC1,  "DISABLE";
     |ESTADO_CONTROL enBotonADC2,  "ENABLE";
     |ESTADO_CONTROL enBotonADC3,  "ENABLE";
     |ESTADO_CONTROL enBotonADC4,  "ENABLE";
     |ESTADO_CONTROL enBotonADC5,  "ENABLE";

     |ESTADO_CONTROL enGridADC1, "SHOW";
     |ESTADO_CONTROL enGridADC2, "HIDE";
     |ESTADO_CONTROL enGridADC3, "HIDE";
     |ESTADO_CONTROL enGridADC4, "HIDE";

     |FOCOTECLADO enGridADC1;
|FPRC;

|PROCESO BotonADC2;
     enEstoyBoton = 2;
     |SI nSwBusActiva = 1;
          |HAZ BotonADC7;
     |FINSI;

     |ESTADO_CONTROL enBotonADC1,  "ENABLE";
     |ESTADO_CONTROL enBotonADC2,  "DISABLE";
     |ESTADO_CONTROL enBotonADC3,  "ENABLE";
     |ESTADO_CONTROL enBotonADC4,  "ENABLE";
     |ESTADO_CONTROL enBotonADC5,  "ENABLE";

     |ESTADO_CONTROL enGridADC1, "HIDE";
     |ESTADO_CONTROL enGridADC2, "SHOW";
     |ESTADO_CONTROL enGridADC3, "HIDE";
     |ESTADO_CONTROL enGridADC4, "HIDE";
     |FOCOTECLADO enGridADC2;
|FPRC;

|PROCESO BotonADC3;
     enEstoyBoton = 3;
     |SI nSwBusActiva = 1;
          |HAZ BotonADC7;
     |FINSI;

     |ESTADO_CONTROL enBotonADC1,  "ENABLE";
     |ESTADO_CONTROL enBotonADC2,  "ENABLE";
     |ESTADO_CONTROL enBotonADC3,  "DISABLE";
     |ESTADO_CONTROL enBotonADC4,  "ENABLE";
     |ESTADO_CONTROL enBotonADC5,  "ENABLE";

     |ESTADO_CONTROL enGridADC1, "HIDE";
     |ESTADO_CONTROL enGridADC2, "HIDE";
     |ESTADO_CONTROL enGridADC3, "SHOW";
     |ESTADO_CONTROL enGridADC4, "HIDE";
     |FOCOTECLADO enGridADC3;
|FPRC;

|PROCESO BotonADC4;
     enEstoyBoton = 4;
     |SI nSwBusActiva = 1;
          |HAZ BotonADC7;
     |FINSI;

     |ESTADO_CONTROL enBotonADC1,  "ENABLE";
     |ESTADO_CONTROL enBotonADC2,  "ENABLE";
     |ESTADO_CONTROL enBotonADC3,  "ENABLE";
     |ESTADO_CONTROL enBotonADC4,  "DISABLE";
     |ESTADO_CONTROL enBotonADC5,  "ENABLE";

     |ESTADO_CONTROL enGridADC1, "HIDE";
     |ESTADO_CONTROL enGridADC2, "HIDE";
     |ESTADO_CONTROL enGridADC3, "HIDE";
     |ESTADO_CONTROL enGridADC4, "SHOW";
     |FOCOTECLADO enGridADC4;
|FPRC;

|PROCESO BotonADC5;
     ||NO se utiliza
|FPRC;

|PROCESO BotonADC6;      ||Busqueda
     |VENTANA 0501, 2699, -1, 16, "Busqueda de Documentos";
     nVentm5 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enError = 0;
     ||aAuxPara.   Fichero donde Buscar. + "CONTA/MODEL/?????" + EMPRESA + EJERCICIO
     ||TODO CCC
     aEmpresa = ("00000" + enEmpADConta) % -105;
     aEjercicio = ("0" + enEjeADConta) % -101;
     |SI enEstoyBoton = 1;
          aAuxPara = "CONTA" + "camaasil" + aEmpresa + aEjercicio;
     |FINSI;
     |SI enEstoyBoton = 2;
          aAuxPara = "CONTA" + "camaniva" + aEmpresa + aEjercicio;
     |FINSI;
     |SI enEstoyBoton = 3;
          aAuxPara = "CONTA" + "cacuenta" + aEmpresa + aEjercicio;
     |FINSI;
     |SI enEstoyBoton = 4;
          aAuxPara = "MODEL" + "dsmom041" + aEmpresa;
     |FINSI;

     aAlfa = "dsarz008;" + aAuxPara;

     |SUB_EJECUTA_NP aAlfa;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentm5;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentm5;

     |SI enError = 1;
         |ACABA;
     |FINSI;

     |HAZ GridFicheroBus500;

     nSwBusActiva = 1;
     |ESTADO_CONTROL enBotonADC7, "ENABLE";
|FPRC;

|PROCESO BotonADC7;      ||Quitar Busqueda.
     |ESTADO_CONTROL enBotonADC7, "DISABLE";
     nSwBusActiva = 0;

     |DESTRUYECONTROL enGrid999;
     |HAZ Descarga999;

     |SI enEstoyBoton = 1;
          |ESTADO_CONTROL enGridADC1, "SHOW";
          |REFRESCACONTROL enGridADC1;
          |FOCOTECLADO enGridADC1;
     |FINSI;
     |SI enEstoyBoton = 2;
          |ESTADO_CONTROL enGridADC2, "SHOW";
          |FOCOTECLADO enGridADC2;
     |FINSI;
     |SI enEstoyBoton = 3;
          |ESTADO_CONTROL enGridADC3, "SHOW";
          |FOCOTECLADO enGridADC3;
     |FINSI;
     |SI enEstoyBoton = 4;
          |ESTADO_CONTROL enGridADC4, "SHOW";
          |FOCOTECLADO enGridADC4;
     |FINSI;
|FPRC;

|PROCESO ElPopUp;
     nTipo = -1;

     aPopup1 = "-1";  || Si fuera -1 en la posicion
     aPopup2  = nElementos;

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup;
         |QBF aAlfa;
         aAlfa = aAlfa % 103;
         nTipo = aAlfa;
     |FINSI;
|FPRC;

|PROCESO CreaPopUp;
     |SI nHay = 0;
          IaPopup = aPopup1  <-;
          IaPopup = IaPopup + 1;
          IaPopup = IaPopup + 1;
          nHay = 1;
     |FINSI;
     nElementos = nElementos + 1;

     aContenido = #dsarm004#2 + " " + #dsarm004#3;
     |QBF aContenido;
     aPopup = aContenido;
     IaPopup = IaPopup + 1;
|FPRC;

|DEFBUCLE CreaPopUp;
 #dsarm004#1;
 ;
 nGrupoBucle, nSubGruBucle, 001;
 nGrupoBucle, nSubGruBucle, 999;
 ;
 NULL, CreaPopUp;
|FIN;

|PROCESO BotonADC8;      ||Vincular Seleccionado
     |ABRE #dsarm001;
     |LEE 000#dsarm001.p;
     |SI FSalida ! 0;  |DDEFECTO #dsarm001;  |FINSI;
     |CIERRA #dsarm001;

     |SI #dsarm001#65 = "S";
          enGrupoTres = 0;
          enSubGTres = 0;
          enTipoTres = 0;
          aEjecuta = "dsarz003;DAMETRE";
          |SUB_EJECUTA_NP aEjecuta;
          |SI enGrupoTres ! 0;
               nGrupo = enGrupoTres;
               nSubGrupo = enSubGTres;
               nTipo = enTipoTres;
               |HAZ VincularUnooMas;
          |FINSI;
     |SINO;
          |SI #dsarm001#8 = "S";
               nElementos = 0;
               nHay = 0;
               nGrupoBucle = #dsarm001#12;
               nSubGruBucle = #dsarm001#13;
               |BUCLE CreaPopUp;
               |SI nHay = 1;
                    |SI nElementos = 1;
                         aAux = aContenido % 103;
                         nTipo = aAux;
                    |SINO;
                         |HAZ ElPopUp;
                         |SI nTipo = -1;
                              aMensaje = "0000Proceso de Vinculacion cancelado por el usuario";
                              |MENAV aMensaje;
                              |ACABA;
                         |FINSI;
                    |FINSI;
                    nGrupo = #dsarm001#12;
                    nSubGrupo = #dsarm001#13;
                    |HAZ VincularUnooMas;
               |SINO;
                    aMensaje = "0000NO existen TIPOS definidos para el Grupo/Subgrupo Vinculados";
                    |MENAV aMensaje;
                    |ACABA;
               |FINSI;
          |SINO;
               nGrupo = #dsarm001#12;
               nSubGrupo = 1;
               nTipo = 1;
               |HAZ VincularUnooMas;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DesCarga905;
     |CIERRA #dsarm005@;
     |DELINDEX #dsarm005@;

     |DESCARGA_DEF #dsarm005@;
|FPRC;

|PROCESO MultiSeleccion;
     enLinea005 = #dsarm005@#0;

     |HAZ ActDatos;
||     aMensaje = "0000Vincular " + #dsarm005@#0;
||     |MENAV aMensaje;

     |BORRA 020#dsarm005@.a;
     |SI enNumSeleADC > 0;
          enNumSeleADC = enNumSeleADC - 1;
     |FINSI;
|FPRC;

|DEFBUCLE MultiSeleccion;
 #dsarm005@#1001;
 ;
 000000001;
 999999999;
 be;
 NULL, MultiSeleccion;
|FIN;


|PROCESO VincularUnooMas;
     |SI enNumSeleADC = 0;
          nSwMulti = 0;
          |HAZ ActDatos;
     |SINO;
          nSwMulti = 1;
          |BUCLE MultiSeleccion;
          enNumSeleADC = 0;
          enLinea005 = 0;
          nSwMulti = 0;

          |REFRESCACONTROL enGrid;
     |FINSI;
|FPRC;

|PROCESO LeeCamposLibresOri;
     |ABRE #dsarm004;
     |DDEFECTO #dsarm004;
     #dsarm004#0 = nGrupoAnt;
     #dsarm004#1 = nSubGruAnt;
     #dsarm004#2 = nTipoAnt;
     |LEE 000#dsarm004.=;

     aLiteral1Ori = #dsarm004#5;
     aLiteral2Ori = #dsarm004#6;
     aLiteral3Ori = #dsarm004#7;
     aLiteral4Ori = #dsarm004#8;
     aLiteral5Ori = #dsarm004#9;
     aLiteral6Ori = #dsarm004#27;
     aLiteral7Ori = #dsarm004#28;
     aLiteral8Ori = #dsarm004#29;
     aLiteral9Ori = #dsarm004#30;
     aLiteral10Ori = #dsarm004#31;
     aLiteral11Ori = #dsarm004#10;
     aLiteral12Ori = #dsarm004#11;
     aLiteral13Ori = #dsarm004#12;
     aLiteral14Ori = #dsarm004#13;
     aLiteral15Ori = #dsarm004#14;
     aLiteral16Ori = #dsarm004#15;
     aLiteral17Ori = #dsarm004#16;
     aLiteral18Ori = #dsarm004#17;
     aLiteral19Ori = #dsarm004#18;
     aLiteral20Ori = #dsarm004#19;
     |CIERRA #dsarm004;

     |QBF aLiteral1Ori;
     |QBF aLiteral2Ori;
     |QBF aLiteral3Ori;
     |QBF aLiteral4Ori;
     |QBF aLiteral5Ori;
     |QBF aLiteral6Ori;
     |QBF aLiteral7Ori;
     |QBF aLiteral8Ori;
     |QBF aLiteral9Ori;
     |QBF aLiteral10Ori;
     |QBF aLiteral11Ori;
     |QBF aLiteral12Ori;
     |QBF aLiteral13Ori;
     |QBF aLiteral14Ori;
     |QBF aLiteral15Ori;
     |QBF aLiteral16Ori;
     |QBF aLiteral17Ori;
     |QBF aLiteral18Ori;
     |QBF aLiteral19Ori;
     |QBF aLiteral20Ori;
|FPRC;

|PROCESO LeeCamposLibresDes;
     |ABRE #dsarm004;
     |DDEFECTO #dsarm004;
     #dsarm004#0 = nGrupo;
     #dsarm004#1 = nSubGrupo;
     #dsarm004#2 = nTipo;
     |LEE 000#dsarm004.=;

     aLiteral1Des = #dsarm004#5;
     aLiteral2Des = #dsarm004#6;
     aLiteral3Des = #dsarm004#7;
     aLiteral4Des = #dsarm004#8;
     aLiteral5Des = #dsarm004#9;
     aLiteral6Des = #dsarm004#27;
     aLiteral7Des = #dsarm004#28;
     aLiteral8Des = #dsarm004#29;
     aLiteral9Des = #dsarm004#30;
     aLiteral10Des = #dsarm004#31;
     aLiteral11Des = #dsarm004#10;
     aLiteral12Des = #dsarm004#11;
     aLiteral13Des = #dsarm004#12;
     aLiteral14Des = #dsarm004#13;
     aLiteral15Des = #dsarm004#14;
     aLiteral16Des = #dsarm004#15;
     aLiteral17Des = #dsarm004#16;
     aLiteral18Des = #dsarm004#17;
     aLiteral19Des = #dsarm004#18;
     aLiteral20Des = #dsarm004#19;
     |CIERRA #dsarm004;
     |QBF aLiteral1Des;
     |QBF aLiteral2Des;
     |QBF aLiteral3Des;
     |QBF aLiteral4Des;
     |QBF aLiteral5Des;
     |QBF aLiteral6Des;
     |QBF aLiteral7Des;
     |QBF aLiteral8Des;
     |QBF aLiteral9Des;
     |QBF aLiteral10Des;
     |QBF aLiteral11Des;
     |QBF aLiteral12Des;
     |QBF aLiteral13Des;
     |QBF aLiteral14Des;
     |QBF aLiteral15Des;
     |QBF aLiteral16Des;
     |QBF aLiteral17Des;
     |QBF aLiteral18Des;
     |QBF aLiteral19Des;
     |QBF aLiteral20Des;
|FPRC;

|PROCESO MiraSiObligatorios105;
     |ABRE #dsarm004;
     |DDEFECTO #dsarm004;
     #dsarm004#0 = nGrupo;
     #dsarm004#1 = nSubGrupo;
     #dsarm004#2 = nTipo;
     |LEE 000#dsarm004.=;

     |SI #dsarm004#20 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#21 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#22 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#23 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#24 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#55 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#56 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#57 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#58 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#59 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#60 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#61 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#62 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#63 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#64 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#65 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#66 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#67 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#68 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#69 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#70 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#71 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#72 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#73 = "S"; nSwObligatorios = 1; |FINSI;
     |SI #dsarm004#74 = "S"; nSwObligatorios = 1; |FINSI;
     |CIERRA #dsarm004;
|FPRC;

|PROCESO EtiquetasCamposLibres;
     |SI aLiteral1Des ! aLiteral1Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral2Des ! aLiteral2Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral3Des ! aLiteral3Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral4Des ! aLiteral4Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral5Des ! aLiteral5Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral6Des ! aLiteral6Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral7Des ! aLiteral7Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral8Des ! aLiteral8Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral9Des ! aLiteral9Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral10Des ! aLiteral10Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral11Des ! aLiteral11Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral12Des ! aLiteral12Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral13Des ! aLiteral13Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral14Des ! aLiteral14Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral15Des ! aLiteral15Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral16Des ! aLiteral16Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral17Des ! aLiteral17Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral18Des ! aLiteral18Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral19Des ! aLiteral19Ori; nSwEtiquetasDistintas = 1; |FINSI;
     |SI aLiteral20Des ! aLiteral20Ori; nSwEtiquetasDistintas = 1; |FINSI;
|FPRC;

|PROCESO ActDatos;
     ||ARA66
     #dsarm005#0 = enLinea005;
     enSwErrorModiw006 = 0;
     nSwObligatorios = 0;

     ||Tiquet. 2537.443
     ||Pide los campos siempre, sean o no obligatorios
     ||HAZ MiraSiObligatorios105;
     nSwObligatorios = 1;

     ||ARA777
     |HAZ LeeCamposLibresDes;

     |SI nSwObligatorios = 1;
          nGrupoAnt = #dsarm005#1;
          nSubGruAnt = #dsarm005#2;
          nTipoAnt = #dsarm005#3;
          |HAZ LeeCamposLibresOri;

          nSwEtiquetasDistintas = 0;
          |HAZ EtiquetasCamposLibres;
          |SI nSwEtiquetasDistintas = 1;
               |LEE 101#dsarm005.=;
               |SI FSalida = 0;
                    #dsarm005#23 = "";
                    #dsarm005#24 = "";
                    #dsarm005#25 = "";
                    #dsarm005#26 = "";
                    #dsarm005#27 = "";
                    #dsarm005#28 = "";
                    #dsarm005#29 = "";
                    #dsarm005#30 = "";
                    #dsarm005#31 = "";
                    #dsarm005#32 = "";
                    #dsarm005#33 = "";
                    #dsarm005#34 = "";
                    #dsarm005#35 = "";
                    #dsarm005#36 = "";
                    #dsarm005#37 = "";
                    #dsarm005#60 = "";
                    #dsarm005#61 = "";
                    #dsarm005#62 = "";
                    #dsarm005#63 = "";
                    #dsarm005#64 = "";
                    |GRABA 020#dsarm005.a;
               |FINSI;
               |LIBERA #dsarm005;
          |FINSI;

          enDocumento = #dsarm005#0;

          |VENTANA 0501, 2999, -1, 16, "Datos Documentos";
          nVentm5 = FSalida;

          aVent1 = -1;
          aVent2 = -1;
          aVent3 = 0;
          aVent4 = nVentm5;
          aVent5 = "MODAL";
          |ESPECIFICA "ESTADO_VENTANA", aVent;

          |SI enEstoyBoton = 1; |O enEstoyBoton = 2;
               enSwPlantillaConta = 1;
               |SI enEstoyBoton = 1;
                    |SI nSwBusActiva = 0;
                         #dsarm005#69 = #camaw001@#0;
                         #dsarm005#70 = #camaw001@#1;
                         #dsarm005#71 = #camaw001@#2;
                    |SINO;
                         #dsarm005#69 = #referen@#0;
                         #dsarm005#70 = #referen@#1;
                         #dsarm005#71 = #referen@#2;
                    |FINSI;

                    |DDEFECTO #camaniva@;
                    |SELECT #2#camaniva@;
                    #camaniva@#7 = #dsarm005#69;
                    #camaniva@#8 = #dsarm005#70;
                    #camaniva@#9 = #dsarm005#71;
                    |LEE 000#camaniva@.=;
                    |SI FSalida = 0;
                         enLibroConta = #camaniva@#0;
                         enDocumentoConta = #camaniva@#1;
                    |FINSI;
               |FINSI;
               ||ARA
               |SI enEstoyBoton = 2;
                    |SI nSwBusActiva = 0;
                         enLibroConta = #camaniva@#0;
                         enDocumentoConta = #camaniva@#1;
                    |SINO;
                         enLibroConta = #referen@#0;
                         enDocumentoConta = #referen@#1;
                    |FINSI;
               |FINSI;
          |FINSI;

          enModoModiw006 = 1;
          enModoVincula = 1;
          enGrupoVincula = nGrupo;
          enSubGruVincula = nSubGrupo;
          enTipoVincula = nTipo;
          |SUB_EJECUTA_NP "dsarw006";
          enModoVincula = 0;
          enModoModiw006 = 0;

          aVent1 = -1;
          aVent2 = -1;
          aVent3 = 0;
          aVent4 = nVentm5;
          aVent5 = "MODELESS";
          |ESPECIFICA "ESTADO_VENTANA", aVent;

          |FINVENTANA nVentm5;
     |FINSI;

     |SI enSwErrorModiw006 = 0;
          #dsarm005#0 = enLinea005;
          |LEE 101#dsarm005.=;
          |SI FSalida = 0;
               nGrupoAnt = #dsarm005#1;
               nSubGruAnt = #dsarm005#2;
               nTipoAnt = #dsarm005#3;
               |SI nGrupoAnt ! nGrupo; |O nSubGruAnt ! nSubGrupo; |O nTipoAnt ! nTipo;

                    ||Tengo que mover el documento a la nueva ubicacion.

                    ||TODO CCC
                    aFichero = #dsarm005#7;
                    |QBF aFichero;
                    aFichero = aFichero + #dsarm005#9;
                    |QBF aFichero;
                    aOrigen  = aFichero;

                    aDestino = #dsarm001#1;
                    |QBF aDestino;
                    |ABRE #dsarm002;
                    |DDEFECTO #dsarm002;
                    #dsarm002#0 = nGrupo;
                    |LEE 000#dsarm002.=;
                    |SI FSalida = 0;
                         aDestino = aDestino + "/" + #dsarm002#2;
                         |QBF aDestino;
                         |SI #dsarm001#7 = "N";
                              |MKDIR aDestino;
                         |SINO;
                              |RMKDIR aDestino;
                         |FINSI;
                    |FINSI;
                    |CIERRA #dsarm002;

                    |SI #dsarm001#8 = "S"; ||Usan Grupo, Subgrupo y Tipo
                         |ABRE #dsarm003;
                         |DDEFECTO #dsarm003;
                         #dsarm003#0 = nGrupo;
                         #dsarm003#1 = nSubGrupo;
                         |LEE 000#dsarm003.=;
                         |SI FSalida = 0;
                              aDestino = aDestino + "/" + #dsarm003#3;
                              |QBF aDestino;
                              |SI #dsarm001#7 = "N";
                                   |MKDIR aDestino;
                              |SINO;
                                   |RMKDIR aDestino;
                              |FINSI;
                         |FINSI;
                         |CIERRA #dsarm003;
                         |ABRE #dsarm004;
                         |DDEFECTO #dsarm004;
                         #dsarm004#0 = nGrupo;
                         #dsarm004#1 = nSubGrupo;
                         #dsarm004#2 = nTipo;
                         |LEE 000#dsarm004.=;
                         |SI FSalida = 0;
                              aDestino = aDestino + "/" + #dsarm004#4;
                              |QBF aDestino;
                              |SI #dsarm001#7 = "N";
                                   |MKDIR aDestino;
                              |SINO;
                                   |RMKDIR aDestino;
                              |FINSI;
                         |FINSI;
                         |CIERRA #dsarm003;
                    |FINSI;

                    aDestino = aDestino + "/";
                    #dsarm005#7 = aDestino;

                    aDestino = aDestino + #dsarm005#9;
                    |QBF aDestino;

                    |SI #dsarm001#7 = "N";
                         |RENOMBRA_FICHERO aOrigen, aDestino;
                    |SINO;
                         |RRENOMBRA_FICHERO aOrigen, aDestino;
                    |FINSI;
               |FINSI;

               #dsarm005#1 = nGrupo;
               #dsarm005#2 = nSubGrupo;
               #dsarm005#3 = nTipo;

               |SI enEstoyBoton = 1;
                    #dsarm005#67 = enEmpADConta;
                    #dsarm005#68 = enEjeADConta;
                    |SI nSwBusActiva = 0;
                         #dsarm005#69 = #camaw001@#0;
                         #dsarm005#70 = #camaw001@#1;
                         #dsarm005#71 = #camaw001@#2;
                    |SINO;
                         #dsarm005#69 = #referen@#0;
                         #dsarm005#70 = #referen@#1;
                         #dsarm005#71 = #referen@#2;
                    |FINSI;

                    |DDEFECTO #camaniva@;
                    |SELECT #2#camaniva@;
                    #camaniva@#7 = #dsarm005#69;
                    #camaniva@#8 = #dsarm005#70;
                    #camaniva@#9 = #dsarm005#71;
                    |LEE 000#camaniva@.=;
                    |SI FSalida = 0;
                         #dsarm005#72 = #camaniva@#0;
                         #dsarm005#73 = #camaniva@#1;
                    |FINSI;
               |FINSI;
               ||ARA
               |SI enEstoyBoton = 2;
                    #dsarm005#67 = enEmpADConta;
                    #dsarm005#68 = enEjeADConta;
                    |SI nSwBusActiva = 0;
                         #dsarm005#72 = #camaniva@#0;
                         #dsarm005#73 = #camaniva@#1;
                         #dsarm005#69 = #camaniva@#7;
                         #dsarm005#70 = #camaniva@#8;
                         #dsarm005#71 = #camaniva@#9;
                    |SINO;
                         #dsarm005#72 = #referen@#0;
                         #dsarm005#73 = #referen@#1;
                         #dsarm005#69 = #referen@#7;
                         #dsarm005#70 = #referen@#8;
                         #dsarm005#71 = #referen@#9;
                    |FINSI;
               |FINSI;
               |SI enEstoyBoton = 3;
                    #dsarm005#67 = enEmpADConta;
                    #dsarm005#68 = enEjeADConta;
                    |SI nSwBusActiva = 0;
                         #dsarm005#74 = #cacuenta@#0;
                    |SINO;
                         #dsarm005#74 = #referen@#0;
                    |FINSI;
               |FINSI;
               |SI enEstoyBoton = 4;
                    #dsarm005#67 = enEmpADConta;
                    |SI nSwBusActiva = 0;
                         #dsarm005#75 = #dsmom041@#2;
                         #dsarm005#76 = #dsmom041@#3;
                    |SINO;
                         #dsarm005#75 = #referen@#2;
                         #dsarm005#76 = #referen@#3;
                    |FINSI;
               |FINSI;
               |GRABA 020#dsarm005.a;
               |LIBERA #dsarm005;

               |SI nSwMulti = 0;
                    |REFRESCACONTROL enGrid;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Evento999;
     ||TODO CCC
|FPRC;

|PROCESO Descarga999;
     |SI enSw999CargaDef = 1;
          |DESCARGA_DEF #referen@;
          enSw999CargaDef = 0;
     |FINSI;
|FPRC;

|PROCESO GridFicheroBus500;
     |SI enEstoyBoton = 1;
          aDef = aDirConta + "def/camaw001";
          |CARGA_DEF aDef, referen@;
          |SI FSalida ! 0;
               aMensaje  = "0000[camaw001.mas] inaccesible. Consulte con su distribuidor." + &13 + "[Modulo 000adc instalado?]";
               |MENAV aMensaje;
               |ACABA;
          |FINSI;
          enSw999CargaDef = 1;

          |PATH_DAT #referen@#aDirDatos#;
          |NOME_DAT #referen@#eaFichero#;
          |ABRE #referen@;

          |LINEAL_SIMPLE #1#referen@, nRango, nPos1, nPos2, NULL, NULL, Evento999;
          enGrid999 = FSalida;
          |ESTADO_CONTROL enGridADC1, "HIDE";
          |FOCOTECLADO enGrid999;
     |FINSI;
     |SI enEstoyBoton = 2;
          aDef = aDirConta + "def/camaniva";
          |CARGA_DEF aDef, referen@;
          |SI FSalida ! 0;
               |MENAV "0000[camaniva.mas] inaccesible. Consulte con su distribuidor.";
               |ACABA;
          |FINSI;
          enSw999CargaDef = 1;

          |PATH_DAT #referen@#aDirDatos#;
          |NOME_DAT #referen@#eaFichero#;
          |ABRE #referen@;

          |LINEAL_SIMPLE #1#referen@, nRango, nPos1, nPos2, NULL, NULL, Evento999;
          enGrid999 = FSalida;
          |ESTADO_CONTROL enGridADC1, "HIDE";
          |FOCOTECLADO enGrid999;
     |FINSI;
     |SI enEstoyBoton = 3;
          aDef = aDirConta + "def/cacuenta";
          |CARGA_DEF aDef, referen@;
          |SI FSalida ! 0;
               |MENAV "0000[cacuenta.mas] inaccesible. Consulte con su distribuidor.";
               |ACABA;
          |FINSI;
          enSw999CargaDef = 1;

          |PATH_DAT #referen@#aDirDatos#;
          |NOME_DAT #referen@#eaFichero#;
          |ABRE #referen@;

          |LINEAL_SIMPLE #1#referen@, nRango, nPos1, nPos2, NULL, NULL, Evento999;
          enGrid999 = FSalida;
          |ESTADO_CONTROL enGridADC3, "HIDE";
          |FOCOTECLADO enGrid999;
     |FINSI;
     |SI enEstoyBoton = 4;
          aDef = aDirModel + "def/dsmom041";
          |CARGA_DEF aDef, referen@;
          |SI FSalida ! 0;
               |MENAV "0000[dsmom041.mas] inaccesible (modelos). Consulte con su distribuidor.";
               |ACABA;
          |FINSI;
          enSw999CargaDef = 1;

          |PATH_DAT #referen@#aDirDatModelos#;
          |NOME_DAT #referen@#eaFichero#;
          |ABRE #referen@;

          |LINEAL_SIMPLE #1#referen@, nRango, nPos1, nPos2, Baja999, Alta999, Evento999;
          enGrid999 = FSalida;
          |ESTADO_CONTROL enGridADC4, "HIDE";
          |FOCOTECLADO enGrid999;
     |FINSI;
|FPRC;

|PROCESO DestinoDesvincula;
     ||Nos devuelve el Grupo, SubGrupo y Tipo de Pend. Vincular.

     |ABRE #dsarm001;
     |LEE 000#dsarm001.p;
     |SI FSalida ! 0;  |DDEFECTO #dsarm001;  |FINSI;
     |CIERRA #dsarm001;

     |SI #dsarm001#8 = "S";
          nElementos = 0;
          nHay = 0;
          nGrupoBucle = #dsarm001#10;
          nSubGruBucle = #dsarm001#11;
          |BUCLE CreaPopUp;
          |SI nHay = 1;
               |SI nElementos = 1;
                    aAux = aContenido % 103;
                    nTipo = aAux;
               |SINO;
                    |HAZ ElPopUp;
                    |SI nTipo = -1;
                         aMensaje = "0000Proceso de Desvinculacion cancelado por el usuario";
                         |MENAV aMensaje;
                         enSwError = 1;
                         |ACABA;
                    |FINSI;
               |FINSI;
               nGrupo = #dsarm001#10;
               nSubGrupo = #dsarm001#11;
          |SINO;
               aMensaje = "0000NO existen TIPOS definidos para el Grupo/Subgrupo Pend. Vincular";
               |MENAV aMensaje;
               enSwError = 1;
               |ACABA;
          |FINSI;
     |SINO;
          nGrupo = #dsarm001#10;
          nSubGrupo = 1;
          nTipo = 1;
     |FINSI;

     enGrupoPV = nGrupo;
     enSubGrupoPV = nSubGrupo;
     enTipoPV = nTipo;
|FPRC;

|PROCESO BotonADC9;      ||+  Anyadir a Seleccinados.
     |SI enSwDefSele = 0;
          |DBASE aMas;  |QBF aMas;
          aMas = aMas + "def/dsarm005.mas";
          |CARGA_DEF aMas, dsarm005@;
          |SI FSalida ! 0;
               |MENAV "0000[dsarm005.mas] inaccesible. Consulte con su distribuidor.";
               |ACABA;
          |FINSI;

          enSwDefSele = 1;

          aAux = ("01" + Usuario + "zzzzzzzz") % 108;
          |NOME_DAT #dsarm005@#aAux#;

          |DELINDEX #dsarm005@;

          |ABRE #dsarm005@;
     |FINSI;

     aCadena ="|NC";
     aAlfa = #dsarm005@#aCadena#;
     nCampoHasta = aAlfa;
     nCampoHasta = nCampoHasta - 1;

     |SELECT #1#dsarm005@;
     #dsarm005@#0 = #dsarm005#0;
     |LEE 101#dsarm005@.=;
     |SI FSalida ! 0;
          |PARA nCampo = 1;  |SI nCampo [ nCampoHasta;   |HACIENDO nCampo = nCampo + 1;
               #dsarm005@#nCampo# = #dsarm005#nCampo#
          |SIGUE;
          |GRABA 020#dsarm005@.n;
          |LIBERA #dsarm005@;
          enNumSeleADC = enNumSeleADC + 1;
     |SINO;
          aMensaje = "0000Este documento YA esta Seleccionado";
          |MENAV aMensaje;
     |FINSI;
|FPRC;

|PROCESO BotonQuita;     || "-"  Deseleccionar
     |LEE 101#dsarm005@.=;
     |SI FSalida = 0;
          |BORRA 020#dsarm005@.a;
          |LIBERA #dsarm005@;

          enNumSeleADC = enNumSeleADC - 1;
          |SI enNumSeleADC = 0;
               |ESTADO_CONTROL nBotonQuita, "DISABLE";
          |FINSI;

          |REFRESCACONTROL nGridSel;
     |FINSI;
|FPRC;

|PROCESO Evento;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#dsarm005@.=;
          |SI FSalida = 0;
               |ESTADO_CONTROL nBotonQuita, "ENABLE";
          |SINO;
               |ESTADO_CONTROL nBotonQuita, "DISABLE";
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO BotonADC10;     ||Ver Seleccionados
     |SI enNumSeleADC = 0;
          aMensaje = "0000MultiSeleccion Vacia";
          |MENAV aMensaje;
     |SINO;
          |VENTANA 0501, 2699, -1, 16, "Ver Documentos Seleccionados";
          nVentana = FSalida;

          get1 = -1;
          get2 = -1;
          get3 = 0;
          get4 = nVentana;
          get5 = "MODAL";
          |ESPECIFICA "ESTADO_VENTANA", get;

          |PINPA #0#dsarw021;
          nPanta21 = FSalida;

          nPos1 = 2686;
          nPos2 = 2698;

          |CONTROL_SIMPLE nPanta21, "BOTON,Deseleccionar", nPos1, nPos2, BotonQuita;
          nBotonQuita = FSalida;

          nRango = 2 + 4 + 8 + 16 + 32 + 128;
          nPos1 = 0802;
          nPos2 = 2599;

          |LINEAL_SIMPLE #1#dsarm005@, nRango, nPos1, nPos2, NULL, NULL, Evento;
          nGridSel = FSalida;

          FSalida = 1;
          |HAZ Evento;

          |PAUSA;

          get1 = -1;
          get2 = -1;
          get3 = 0;
          get4 = nVentana;
          get5 = "MODELESS";
          |ESPECIFICA "ESTADO_VENTANA", get;

          |FINVENTANA nVentana;

          ||Ventana MODAL.
     |FINSI;
|FPRC;

|PROCESO ConsultaTipo;
     nError = 0;

     |ABRE #dsarm004;
     #dsarm004#0 = nGrupo;
     #dsarm004#1 = nSubGrupo;
     #dsarm004#2 = nTipo;
     |LEE 000#dsarm004.=;
     |SI FSalida ! 0;  |DDEFECTO #dsarm004;  |FINSI;
     |CIERRA #dsarm004;

     |SI #dsarm004#88 = 0;
         |MENAV "0000No se puede vincular el documento, el TIPO no tiene plantilla rellenable";
         nError = 1;
     |FINSI;
|FPRC;

|PROCESO VinculaCAINLIVA;
     |PULSATECLA;
     enNoQuieroQueEntres = 1;

     nError  = 0;
     nReg005 = enLinea005;

     |SELECT #1#dsarm005;
     #dsarm005#0 = enLinea005;
     |LEE 000#dsarm005.=;
     |SI FSalida ! 0;
         |SELECT #6#dsarm005;
         |ACABA;
     |FINSI;

     aAlfa = "0000SSeguro que quiere vincular el documento " + #dsarm005#0 + " al registro de IVA";
     |CONFI aAlfa;
     |SI FSalida ! 0;
         |SELECT #6#dsarm005;
         |ACABA;
     |FINSI;

     |ABRE #dsarm001;
     |LEE 000#dsarm001.p;
     |SI FSalida ! 0;  |DDEFECTO #dsarm001;  |FINSI;
     |CIERRA #dsarm001;

     |SI #dsarm001#65 = "S";
          enGrupoTres = 0;
          enSubGTres = 0;
          enTipoTres = 0;
          aEjecuta = "dsarz003;DAMETRE";
          |SUB_EJECUTA_NP aEjecuta;
          |SI enGrupoTres ! 0;
               nGrupo = enGrupoTres;
               nSubGrupo = enSubGTres;
               nTipo = enTipoTres;

               |HAZ ConsultaTipo;
               |SI nError = 1;
                   |SELECT #6#dsarm005;
                   |ACABA;
               |FINSI;

               |HAZ VincularUnooMas;
          |FINSI;
     |SINO;
          |SI #dsarm001#8 = "S";
               nElementos = 0;
               nHay = 0;
               nGrupoBucle = #dsarm001#12;
               nSubGruBucle = #dsarm001#13;
               |BUCLE CreaPopUp;
               |SI nHay = 1;
                    |SI nElementos = 1;
                         aAux = aContenido % 103;
                         nTipo = aAux;
                    |SINO;
                         |HAZ ElPopUp;
                         |SI nTipo = -1;
                              aMensaje = "0000Proceso de Vinculacion cancelado por el usuario";
                              |MENAV aMensaje;
                              |SELECT #6#dsarm005;
                              |ACABA;
                         |FINSI;
                    |FINSI;
                    nGrupo = #dsarm001#12;
                    nSubGrupo = #dsarm001#13;

                    |HAZ ConsultaTipo;
                    |SI nError = 1;
                        |SELECT #6#dsarm005;
                        |ACABA;
                    |FINSI;

                    |HAZ VincularUnooMas;
               |SINO;
                    aMensaje = "0000NO existen TIPOS definidos para el Grupo/Subgrupo Vinculados";
                    |MENAV aMensaje;
                    |SELECT #6#dsarm005;
                    |ACABA;
               |FINSI;
          |SINO;
               nGrupo = #dsarm001#12;
               nSubGrupo = 1;
               nTipo = 1;
               |HAZ ConsultaTipo;
               |SI nError = 1;
                   |SELECT #6#dsarm005;
                   |ACABA;
               |FINSI;

               |HAZ VincularUnooMas;
          |FINSI;
     |FINSI;

     |PULSATECLA;

     |SELECT #1#dsarm005;
     #dsarm005#0 = nReg005;
     |LEE 000#dsarm005.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nGrupo    = #dsarm005#1;
     nSubGrupo = #dsarm005#2;
     nTipo     = #dsarm005#3;
     |HAZ ConsultaTipo;
     |SI nError = 1;
         |SELECT #6#dsarm005;
         |ACABA;
     |FINSI;

     #dsarm005#0 = nReg005;
     |LEE 101#dsarm005.=;
     |SI FSalida ! 0;
         |SELECT #6#dsarm005;
         |ACABA;
     |FINSI;

     #dsarm005#67 = enEmpADConta;
     #dsarm005#68 = enEjeADConta;
     #dsarm005#72 = eaClaveAD1;
     nRegFactura = 100000000 + (eaClaveAD1 * 1000) + eaClaveAD2;
     #dsarm005#73 = nRegFactura;

     #dsarm005#69 = 0;
     #dsarm005#70 = "01.01.0000";
     #dsarm005#71 = 0;
     #dsarm005#74 = "";
     #dsarm005#75 = "";
     #dsarm005#76 = "";

     |GRABA 020#dsarm005.a;
     |LIBERA #dsarm005;

|| Manolo: Aunque parezca una tonteria el codigo de aqui abajo por favor no lo
||         toqueis que sino no hace lo que tiene que hacer se vuelve loca en el
||         plb del tipo 16

     enNoQuieroQueEntres = 0;
     |SELECT #1#dsarm005;
     #dsarm005#0 = nReg005;
     |LEE 101#dsarm005.=;
     |SI FSalida = 0;
         |GRABA 020#dsarm005.a;
         |LIBERA #dsarm005;
     |FINSI;

     |SI #dsarm005#67 ! enEmpADConta;
         |SELECT #1#dsarm005;
         #dsarm005#0 = nReg005;
         |LEE 101#dsarm005.=;
         |SI FSalida = 0;
             |GRABA 020#dsarm005.a;
             |LIBERA #dsarm005;
         |FINSI;
     |FINSI;

     |PULSATECLA;

     |SELECT #6#dsarm005;
     |PTEC 806;
|FPRC;

|PROCESO EventoCALINIVA;
     |SI #dsarm005#0 = 0;  |ACABA;  |FINSI;

     |SI FSalida = 1;  |O FSalida = 2;
         |SELECT #6#dsarm005;
         |LEE 000#dsarm005.=;

         enLinea005 = #dsarm005#0;

         aFichero = #dsarm005#7;              |QBF aFichero;
         aFichero = aFichero + #dsarm005#9;   |QBF aFichero;
     |FINSI;

     |SI FSalida = 4;
         |HAZ VinculaCAINLIVA;
     |FINSI;
|FPRC;
