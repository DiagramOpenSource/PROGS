|FICHEROS;
   dsarm005 #10;
   dsarm001 #11;
   dsarm002 #12;
   dsarm003 #13;
   dsarm004 #14;
   dsarw010 #510;

   referen@ #999;
   dsarm100 #100;        ||Contador Reg.Doc.
|FIN;

|VARIABLES;
   nUltimoDoc = 0;          ||Contador
   &enSwDesde9 = 0;
   aUltLetra = "";
   nSwTipoArchi = 0;       ||  1) Minutas; 2) DSCOMER9
   nError       = 0;
   nHandleEjec  = 0;
   nCaracter    = 0;

   aAux = "";
   &eaUnidad = "";

   &eaSwEnvioCorreo = "";  ||Indica si se envia por correo al emitir la minuta
   &enErrorCorreo = 0;
   &enDocumento   = 0;

   &eaEmpresaFE = "";
   &eaArTipoDoc = "";
   &eaArSerDoc = "";
   &enArNumDoc = 0;
   &eaArFecDoc = ""

   nSwFirmaOK = 0;
   aOrigenFE = "";
   aDestinoFE = "";
   aEjecuta = "";
   aUnidadSistema = "";

   &eaErrorFirma = "";
   &eaBaseFirmador = "";
   &eaFEOrigen = "";
   &eaFEDestino = "";
   &eaDniFirmador = "";

   &enSwNuevoMD5 = 0;

   aMensaje = "";
   &eaOrigen = "";
   &eaDestino = "";
   {1}aLocal = "";
   aBaseLocal = "";
   aBaseBin = "";
   aBaseDll = "";
   aBase = "";
   aAbre = "";

   &eaUnidadBasico = "";
   &eaDirDesFE = "";  || Direccion destino para envio por correo
   &eaFirmarFE = "";  || Indica si tenemos que firmar o no el documento
   &eaArCodCli = "";  || Codigo Cliente
   &eaArNomCli = "";  || Nombre Cliente
   &eaArCodCif = "";  || Cif
   &eaArNomCif = "";  || Nombre Cif
   &eaArCodTra = "";  || Codigo Trabajador
   &eaArNomTra = "";  || Nombre Trabajador
   &eaArCamPDF = "";  || Camino al PDF a archivar
   &eaArSerMin = "";  || Serie minuta en caso de archivar desde minutacion
   &eaArNumMin = "";  || Numero minuta en caso de archivar desde minutacion
   &eaArFecMin = "";  || Fecha minuta en caso de archivar desde minutacion
   &eaArGrpMin = "";  || Grupo archivo en caso de archivar desde minutacion
   &eaArSbGMin = "";  || Subgrupo archivo en caso de archivar desde minutacion
   &eaArTipMin = "";  || Tipo archivo en caso de archivar desde minutacion
   &PRMNT_nOpc = 0;

   nNumDocum   = 0;
   nCont       = 0;
   nCalc       = 0;
   nCalc1      = 0;
   aAlfa       = "";
   aAlfa1      = "";
   aAlfa2      = "";
   aNombrePDF  = "";
   aCaminoPDF  = "";
   aSerie1     = "";
   aSerie2     = "";
   nNumero1    = 0;
   nNumero2    = 0;
   FEstado     = 0;
   nHandle     = 0;
   nDocuCarpeta = 0;

   aPathRemoto = "";
   aIPRemoto   = "";

{-1}aCrea  = "";
    aCrea1 = "2400";
    aCrea2 = "1";
    aCrea3 = "El documento existe. Ubicacion?: ";
    aCrea4 = "NATt";
    aCrea5 = "Nueva";
    aCrea6 = "Actual";
    aCrea7 = "Todos Nuevos";
    aCrea8 = "Todos Actual";

/*
     &enSwNomina = 0;
     &enArEjerci = 0;
     &enArPeriod = 0;
     &enArModelo = 0;
     &enArComple = 0;
     &eaArModDes = "";
     &eaArPerDes = "";
*/
|FIN;

|PROCESO CreaNuevo;
     |SELECT #2#10;
     #dsarm005#1 = eaArGrpMin;
     #dsarm005#2 = eaArSbGMin;
     #dsarm005#3 = eaArTipMin;
     #dsarm005#0 = 999999999;
     |LEE 000#10];
     |SI FSalida = 0;
         |LEE 000#10a;
     |SINO;
         |LEE 000#10u;
     |FINSI;

     nDocuCarpeta = 1;
     |SI FSalida = 0;  |Y  #dsarm005#1 = eaArGrpMin;
                       |Y  #dsarm005#2 = eaArSbGMin;
                       |Y  #dsarm005#3 = eaArTipMin;
         nDocuCarpeta =  #dsarm005#47 + 1;
     |FINSI;

     |SELECT #1#10;
     |LEE 000#dsarm005.u;
     |SI FSalida = 0;
        nNumDocum = #dsarm005#0 + 1;
     |SINO;
        nNumDocum = 1;
     |FINSI;

     |ABRE #dsarm100;
     |DDEFECTO #dsarm100;
     |LEE 000#dsarm100.p;
     |SI FSalida = 0;
          nUltimoDoc = #dsarm100#1 + 1;
     |SINO;
          nUltimoDoc = 1;
     |FINSI;
     |SI nUltimoDoc > nNumDocum;
          nNumDocum = nUltimoDoc;
     |FINSI;
     #dsarm100#0 = "1";
     |LEE 101#dsarm100.=;
     |SI FSalida ! 0; |GRABA 020#dsarm100.b; |FINSI;
     #dsarm100#1 = nNumDocum;
     |GRABA 020#dsarm100.a;
     |LIBERA #dsarm100;
     |CIERRA #dsarm100;

     |DDEFECTO #dsarm005;
     #dsarm005#0 = nNumDocum;
     #dsarm005#1 = eaArGrpMin;
     #dsarm005#2 = eaArSbGMin;
     #dsarm005#3 = eaArTipMin;
     #dsarm005#4 = ~;
     |HORA aAlfa; |QBF aAlfa; aAlfa = aAlfa % 0105;
     #dsarm005#5 = aAlfa;
     aAlfa = Usuario % 0810;
     #dsarm005#6 = aAlfa;

     |SI nSwTipoArchi = 1;
          nCalc = eaArNumMin;
     |SINO;
          nCalc = enArNumDoc;
     |FINSI;

     |SI nCalc ! 0;
        |SI nSwTipoArchi = 1;
             |SI #dsarm001#3 = "N"; |ACABA; |FINSI;
        |SINO;
             |SI #dsarm001#31 = "N"; |ACABA; |FINSI;
        |FINSI;

        |ABRE #dsarm002;
        #dsarm002#0 = eaArGrpMin;
        |LEE 101#dsarm002.=;
        |SI FSalida ! 0;
            |DDEFECTO #dsarm002;
            #dsarm002#0 = eaArGrpMin;
            |GRABA 020#dsarm002.b;
        |FINSI;

        #dsarm002#3 = #dsarm002#3 + 1;
        |GRABA 020#dsarm002.a;
        |LIBERA #dsarm002;
        |CIERRA #dsarm002;

        |ABRE #dsarm003;
        #dsarm003#0 = eaArGrpMin;
        #dsarm003#1 = eaArSbGMin;
        |LEE 000#dsarm003.=;
        |SI FSalida ! 0;
            |DDEFECTO #dsarm003;
            #dsarm003#0 = eaArGrpMin;
            #dsarm003#1 = eaArSbGMin;
            |GRABA 020#dsarm003.b;
        |FINSI;

        #dsarm003#4 = #dsarm003#4 + 1;
        |GRABA 020#dsarm003.a;
        |LIBERA #dsarm003;
        |CIERRA #dsarm003;

        |ABRE #dsarm004;
        #dsarm004#0 = eaArGrpMin;
        #dsarm004#1 = eaArSbGMin;
        #dsarm004#2 = eaArTipMin;
        |LEE 000#dsarm004.=;
        |SI FSalida ! 0;
            #dsarm004#0 = eaArGrpMin;
            #dsarm004#1 = eaArSbGMin;
            #dsarm004#2 = eaArTipMin;
            |GRABA 020#dsarm004.b;
            |DDEFECTO #dsarm004;
        |FINSI;
        #dsarm004#25 = #dsarm004#25 + 1;
        |GRABA 020#dsarm004.a;
        |LIBERA #dsarm004;
        |CIERRA #dsarm004;

        aCaminoPDF = #11#1;  |QBF aCaminoPDF;
        aUltLetra = aCaminoPDF % -101;
        |SI aUltLetra ! "/";
             aCaminoPDF = aCaminoPDF + "/";
        |FINSI;

        |SI #11#8 = "N";
            aAlfa1 = #dsarm002#2; |QBF aAlfa1;
            aCaminoPDF = aCaminoPDF + aAlfa1;
            |SI aAlfa1 ! ""; aCaminoPDF = aCaminoPDF + "/"; |FINSI;

            |SI #11#7 = "N";
                |MKDIR aCaminoPDF;
            |SINO;
                |RMKDIR aCaminoPDF;
            |FINSI;
        |SINO;
            aAlfa1 = #dsarm002#2; |QBF aAlfa1;
            aCaminoPDF = aCaminoPDF + aAlfa1;
            |SI aAlfa1 ! ""; aCaminoPDF = aCaminoPDF + "/"; |FINSI;

            |SI #11#7 = "N";
                |MKDIR aCaminoPDF;
            |SINO;
                |RMKDIR aCaminoPDF;
            |FINSI;

            aAlfa1 = #dsarm003#3; |QBF aAlfa1;
            aCaminoPDF = aCaminoPDF + aAlfa1;
            |SI aAlfa1 ! ""; aCaminoPDF = aCaminoPDF + "/"; |FINSI;

            |SI #11#7 = "N";
                |MKDIR aCaminoPDF;
            |SINO;
                |RMKDIR aCaminoPDF;
            |FINSI;

            aAlfa1 = #dsarm004#4; |QBF aAlfa1;
            aCaminoPDF = aCaminoPDF + aAlfa1;
            |SI aAlfa1 ! ""; aCaminoPDF = aCaminoPDF + "/"; |FINSI;

            |SI #11#7 = "N";
                |MKDIR aCaminoPDF;
            |SINO;
                |RMKDIR aCaminoPDF;
            |FINSI;
       |FINSI;

        aNombrePDF = nNumDocum; |QBF aNombrePDF;
        aNombrePDF = (("000000000") + aNombrePDF) % -109;
        aAlfa = eaArCamPDF; |QBF aAlfa; aAlfa = aAlfa % -104;
        aAlfa1 = aAlfa % 0101;
        |SI aAlfa1 = ".";
           aNombrePDF = aNombrePDF + aAlfa;
        |FINSI;
        aAlfa = aCaminoPDF + aNombrePDF;

        |SI #11#7 = "N";
            |COPIA_FICHERO eaArCamPDF, aAlfa;
        |SINO;
            |SI #dsarm001#7 = "N";
                 |HAZ DimeUnidad;
                 aPathRemoto = eaUnidad + ":\DOCUMENTOS";              |RMKDIR aPathRemoto;
                 aPathRemoto = eaUnidad + ":\DOCUMENTOS\DSARCHI";      |RMKDIR aPathRemoto;
                 aPathRemoto = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + aNombrePDF;
            |SINO;
                 aPathRemoto = eaUnidadBasico + "\DOCUMENTOS";              |RMKDIR aPathRemoto;
                 aPathRemoto = eaUnidadBasico + "\DOCUMENTOS\DSARCHI";      |RMKDIR aPathRemoto;
                 aPathRemoto = eaUnidadBasico + "\DOCUMENTOS\DSARCHI\" + aNombrePDF;
            |FINSI;

            |SI aIPRemoto ! "";
                |ENVIA_FICHERO eaArCamPDF, aPathRemoto;
            |SINO;
                |COPIA_FICHERO eaArCamPDF, aPathRemoto;
            |FINSI;

            |RCOPIA_FICHERO aPathRemoto, aAlfa;

            |RFBORRA aPathRemoto;
       |FINSI;

       |SI #11#7 = "N";
           |XABRE "E", aAlfa, nHandle;
       |SINO;
           |XABRE "EC", aAlfa, nHandle;
       |FINSI;

       |SI FSalida < 0;
           |MENAV "    Problemas al archivar el documento";
           aAlfa2 = "    Origen  : " + eaArCamPDF; |MENAV aAlfa2;
           aAlfa2 = "    Destino : " + aAlfa;      |MENAV aAlfa2;
       |SINO;
           |FBORRA eaArCamPDF;
       |FINSI;
     |SINO;
        aCaminoPDF = eaArCamPDF; aNombrePDF = "";
        aAlfa = aCaminoPDF % 0; nCalc = aAlfa;
        |PARA nCont = nCalc; |SI nCont ] 0; |HACIENDO nCont = nCont + 1;
           nCalc1 = (nCont * 100) + 1; aAlfa1 = aAlfa % nCalc1;
           |SI aAlfa1 = "/"; |O aAlfa1 = "\";
              |SAL;
           |SINO;
              aNombrePDF = aNombrePDF + aAlfa1;
           |FINSI;
        |SIGUE;
        aCaminoPDF = aCaminoPDF - aNombrePDF;
     |FINSI;

     #dsarm005#8  = eaArCodCli;
     #dsarm005#10 = eaArCodCif;
     #dsarm005#14 = eaArNomCli;
     #dsarm005#15 = eaArCodTra;
     #dsarm005#16 = eaArNomTra;
     #dsarm005#38 = eaArNomCif;
     |SI nSwTipoArchi = 1;
          #dsarm005#39 = eaArSerMin;
          #dsarm005#40 = eaArNumMin;
          #dsarm005#66 = eaArFecMin;
          #dsarm005#88 = eaEmpresaFE;
     |FINSI;
     |SI nSwTipoArchi = 2;
          #dsarm005#84 = eaArTipoDoc;
          #dsarm005#85 = eaArSerDoc;
          #dsarm005#86 = enArNumDoc;
          #dsarm005#87 = eaArFecDoc;
     |FINSI;
     #dsarm005#44 = ((#12#3  / #12#4)  + 0.48) ! 0;
     #dsarm005#45 = ((#13#4  / #13#5)  + 0.48) ! 0;
     #dsarm005#46 = ((#14#25 / #14#26) + 0.48) ! 0;
     #dsarm005#47 = nDocuCarpeta;

     |SI #dsarm005#44 = 0;  #dsarm005#44 = 1;  |FINSI;
     |SI #dsarm005#45 = 0;  #dsarm005#45 = 1;  |FINSI;
     |SI #dsarm005#46 = 0;  #dsarm005#46 = 1;  |FINSI;
/*
     |SI enSwNomina = 1;
          #dsarm005#17 = enArEjerci;
          #dsarm005#18 = enArPeriod;
          #dsarm005#19 = enArModelo;
          #dsarm005#20 = enArComple;
          #dsarm005#21 = eaArModDes;
          #dsarm005#22 = eaArPerDes;
     |FINSI;
*/
|FPRC;

|PROCESO Existente;

   |SI PRMNT_nOpc ! 3; |Y PRMNT_nOpc ! 4;
      |SI #11#193 = "S";
          FSalida = 0;
          aCrea3 = "Doc. " + #dsarm005#0 + " existe. Ubicacion?: ";
          |PARA; |SI FSalida < 1; |O FSalida > 4; |HACIENDO;
                 |MENU aCrea;
          |SIGUE;
      |SINO;
          FSalida = 4;
      |FINSI;
      PRMNT_nOpc = FSalida;
   |FINSI;

   |SI PRMNT_nOpc = 1; |O PRMNT_nOpc = 3;
      |LIBERA #dsarm005;
      |HAZ CreaNuevo;
      |GRABA 020#dsarm005.b;
   |FINSI;

   |SI PRMNT_nOpc = 2; |O PRMNT_nOpc = 4;
      aAlfa = #dsarm005#7;         |QBF aAlfa;
      aAlfa = aAlfa + #dsarm005#9; |QBF aAlfa;

      |SI #11#7 = "N";
          |COPIA_FICHERO eaArCamPDF, aAlfa;
      |SINO;
          |SI #dsarm001#7 = "N";
               |HAZ DimeUnidad;
               aPathRemoto = eaUnidad + ":\DOCUMENTOS";              |RMKDIR aPathRemoto;
               aPathRemoto = eaUnidad + ":\DOCUMENTOS\DSARCHI";      |RMKDIR aPathRemoto;
               aPathRemoto = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + #dsarm005#9;  |QBF aPathRemoto;
          |SINO;
               aPathRemoto = eaUnidadBasico + "\DOCUMENTOS";              |RMKDIR aPathRemoto;
               aPathRemoto = eaUnidadBasico + "\DOCUMENTOS\DSARCHI";      |RMKDIR aPathRemoto;
               aPathRemoto = eaUnidadBasico + "\DOCUMENTOS\DSARCHI\" + #dsarm005#9;  |QBF aPathRemoto;
          |FINSI;

          |SI aIPRemoto ! "";
              |ENVIA_FICHERO eaArCamPDF, aPathRemoto;
          |SINO;
              |COPIA_FICHERO eaArCamPDF, aPathRemoto;
          |FINSI;

          |RCOPIA_FICHERO aPathRemoto, aAlfa;

          |RFBORRA aPathRemoto;
     |FINSI;

     |SI #11#7 = "N";
         |XABRE "E", aAlfa, nHandle;
     |SINO;
         |XABRE "EC", aAlfa, nHandle;
     |FINSI;

     |SI FSalida ] 0;
         |FBORRA eaArCamPDF;
     |FINSI;

     aCaminoPDF = #dsarm005#7; aNombrePDF = #dsarm005#9;
     #dsarm005#41 = ~;
     |HORA aAlfa; |QBF aAlfa; aAlfa = aAlfa % 0105;
     #dsarm005#42 = aAlfa;
     aAlfa = Usuario; |QBF aAlfa; aAlfa = aAlfa % 0810;
     #dsarm005#43 = aAlfa;
   |FINSI;
|FPRC;

|PROCESO Ubicacion;
   #dsarm005#0 = nNumDocum;
   |LEE 101#dsarm005.=;
   |SI FSalida ! 0;
      |HAZ CreaNuevo;
      |GRABA 020#dsarm005.b;
   |SINO;
      |HAZ Existente;
   |FINSI;

   ||TODO CCC
   |SI eaFirmarFE = "S";
        aOrigenFE = aCaminoPDF + aNombrePDF;
        |SI #dsarm001#7 = "N";
            |HAZ DimeUnidad;
             aDestinoFE = eaUnidad + ":\DOCUMENTOS\";              |RMKDIR aDestinoFE;
             aDestinoFE = eaUnidad + ":\DOCUMENTOS\DSARCHI\";      |RMKDIR aDestinoFE;
        |SINO;
             aDestinoFE = eaUnidadBasico + "\DOCUMENTOS\";              |RMKDIR aDestinoFE;
             aDestinoFE = eaUnidadBasico + "\DOCUMENTOS\DSARCHI\";      |RMKDIR aDestinoFE;
        |FINSI;
        aDestinoFE = aDestinoFE + aNombrePDF;

        |SI #11#7 = "S";
            |RCOPIA_FICHERO aOrigenFE, aDestinoFE;
        |SINO;
            |SI aIPRemoto ! "";
                |ENVIA_FICHERO aOrigenFE, aDestinoFE;
            |SINO;
                |COPIA_FICHERO aOrigenFE, aDestinoFE;
            |FINSI;
       |FINSI;

       |HAZ LaFirma;
       |SI nSwFirmaOK = 1;
           |SI #dsarm001#7 = "N";
                |HAZ DimeUnidad;
                aOrigenFE = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + aNombrePDF;
           |SINO;
                aOrigenFE = eaUnidadBasico + "\DOCUMENTOS\DSARCHI\" + aNombrePDF;
           |FINSI;
           aDestinoFE = aCaminoPDF + aNombrePDF;

           |SI #11#7 = "S";
               |RCOPIA_FICHERO aOrigenFE, aDestinoFE;
           |SINO;
               |SI aIPRemoto ! "";
                   |RECIBE_FICHERO aOrigenFE, aDestinoFE;
               |SINO;
                   |COPIA_FICHERO aOrigenFE, aDestinoFE;
               |FINSI;

               |SI #dsarm001#181 = "S";
                    ||Ahora controlamos si borramos o no la cache.
                    |QBF aOrigenFE;
                    |SI aOrigenFE ! "";
                         |RFBORRA aOrigenFE;
                         aOrigenFE = aOrigenFE - ".fir";
                         |RFBORRA aOrigenFE;
                    |FINSI;
               |SINO;
                    aOrigenFE = aOrigenFE - ".fir";
               |FINSI;
          |FINSI;
       |FINSI;
   |FINSI;
   ||Dejar en Ubicacion predeterminada.

   #dsarm005#77 = #dsarw010#1;
   #dsarm005#78 = eaDirDesFE;

   #dsarm005#7 = aCaminoPDF;
   #dsarm005#9 = aNombrePDF;

   |GRABA 020#dsarm005.a; |LIBERA #dsarm005;

   |SI eaSwEnvioCorreo = "S";
      enDocumento = #dsarm005#0;
      enErrorCorreo = 1;
      |SUB_EJECUTA_NP "dsarw010;AUTODESDED9";
   |FINSI;

   enSwDesde9 = 1;
   aAlfa = "dsarz013;" + #dsarm005#0;
   |SUB_EJECUTA aAlfa;
   aAlfa = "dsarz030;" + #dsarm005#0;
   |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO TraeLocalExeFirmar;
   |ESPECIFICA "RBASS", aLocal;
   aBaseLocal = aLocal;

   aBaseBin = aBaseLocal + "bin/";
   eaDestino = aBaseBin + "aeatfact.dll";

   enSwNuevoMD5 = 0;
   |DBASE aBase;
   |QBF aBase;
   aBaseDll = aBase + "dlls/";
   eaOrigen = aBaseDll + "aeatfact.dll";
   |HAZ EnviaFicheroConMD5;
   |SI enSwNuevoMD5 = 1;
       nError = 1;
       |PARA nCaracter = 67;  |SI nCaracter [ 90;  |HACIENDO nCaracter = nCaracter + 1;
             aUnidadSistema = &nCaracter + ":";
             aAbre   = aUnidadSistema + "\windows\system32\regsvr32.exe";
             |XABRE "EC", aAbre, nHandleEjec;
             |SI FSalida ] 0;  nError = 0;  |SAL;  |FINSI;
       |SIGUE;

       |SI nError = 0;
           aEjecuta = aUnidadSistema + "\windows\system32\regsvr32.exe " + aBaseBin + "aeatfact.dll";
           |RSYSTEM aEjecuta;
       |FINSI;
   |FINSI;

   eaDestino = aBaseBin + "dsaeatfact.exe";
   eaOrigen = aBaseDll + "dsaeatfact.exe";
   |HAZ EnviaFicheroConMD5;

   eaDestino = aBaseBin + "dsabreextension.exe";
   eaOrigen = aBaseDll + "dsabreextension.exe";
   |HAZ EnviaFicheroConMD5;
|FPRC;

|PROCESO LaFirma;
   |HAZ TraeLocalExeFirmar;

   nSwFirmaOK = 0;
   eaErrorFirma = "";
   eaBaseFirmador = aBaseBin;
   |SI #dsarm001#7 = "N";
        |HAZ DimeUnidad;
        eaFEOrigen = eaUnidad + ":\documentos\dsarchi\" + aNombrePDF;
   |SINO;
        eaFEOrigen = eaUnidadBasico + "\documentos\dsarchi\" + aNombrePDF;
   |FINSI;

   eaFEDestino = eaFEOrigen + ".fir";

   eaDniFirmador = #dsarm001#23;
   |QBF eaDniFirmador;
   |SI eaDniFirmador ! "";
          |HAZ FirmaDocumento;
          |SI eaErrorFirma ! "";
               aMensaje = "0000Error: " + eaErrorFirma;
               |QBF aMensaje;
               aMensaje = aMensaje + &13 + "El documento se quedara sin firmar.";
               |MENAV aMensaje;
          |SINO;
               nSwFirmaOK = 1;
               aNombrePDF = aNombrePDF + ".fir";
          |FINSI;
   |FINSI;
|FPRC;

|PROGRAMA;
     |HAZ LeeUnidadBasico;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;

     nSwTipoArchi = 0;

     |ABRE #dsarw010;
     |LEE 000#dsarw010.p;
     |SI FSalida ! 0; |DDEFECTO #dsarw010; |FINSI;
     |CIERRA #dsarw010;

     |ABRE #dsarm001;
     |LEE 000#dsarm001.p;
     |SI FSalida ! 0; |DDEFECTO #dsarm001; |FINSI;
     |CIERRA #dsarm001;

     |QBF eaArCamPDF;
     |SI eaArNumMin ! 0;
        nSwTipoArchi = 1;

        nNumDocum = 0;
        |ABRE #dsarm005;
        |SELECT #5#dsarm005;
        #dsarm005#39 = eaArSerMin; aSerie1 = #dsarm005#39;
        #dsarm005#40 = eaArNumMin;
        |LEE 000#dsarm005.];
        |PARA; |SI FSalida = 0; |Y #dsarm005#39 = aSerie1;
         |Y #dsarm005#40 = eaArNumMin; |HACIENDO;
           |SI #dsarm005#66 = eaArFecMin; |Y #dsarm005#88 = eaEmpresaFE;
              nNumDocum = #dsarm005#0;
           |FINSI;
           |LEE 000#dsarm005.s;
        |SIGUE;
        |SELECT #1#dsarm005;

        |HAZ Ubicacion;
        |CIERRA #dsarm005;
     |SINO;
          |SI enArNumDoc ! 0;
             nSwTipoArchi = 2;

             nNumDocum = 0;
             |ABRE #dsarm005;
             |SELECT #15#dsarm005;
             #dsarm005#84 = eaArTipoDoc;
             #dsarm005#85 = eaArSerDoc;
             #dsarm005#86 = enArNumDoc;
             |LEE 000#dsarm005.];
             |PARA; |SI FSalida = 0; |Y #dsarm005#84 = eaArTipoDoc; |Y #dsarm005#85 = eaArSerDoc;
              |Y #dsarm005#86 = enArNumDoc; |HACIENDO;
                |SI #dsarm005#87 = eaArFecDoc;
                   nNumDocum = #dsarm005#0;
                |FINSI;
                |LEE 000#dsarm005.s;
             |SIGUE;
             |SELECT #1#dsarm005;
             |HAZ Ubicacion;
             |CIERRA #dsarm005;
          |FINSI;
     |FINSI;

     enSwDesde9 = 1;
     |SUB_EJECUTA "dpntz001;CLI";
     enSwDesde9 = 0;

     |DBASE aAlfa;   |QBF aAlfa;
     aAlfa = aAlfa + "ocr/";
     aAlfa = aAlfa + "Envio" + Usuario + ".txt";
     |XABRE "E", aAlfa, 0;
     |SI FSalida ] 0;
         |SUB_EJECUTA "dsarw010;ENVIAAVISODIAGRAM";
     |FINSI;
|FPRO;
