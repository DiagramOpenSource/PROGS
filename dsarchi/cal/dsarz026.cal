|FICHEROS;
     dsarz026 #0;        ||Este Def

     crontcom@ #100;     ||Crontab del rwnetcom

     dsarm001 #1;        ||Parametros
|FIN;

|VARIABLES;
     aEjecuta = "";
     aLetra = "";
     nSaca = 0;
     aSaca = "";
     aDirSacaBo = "";

     aNombreShell = "";
     aLog = "";
     aErr = "";
     aBaseGeco = "";
     aNombre = "";
     aDirSaca = "";
     nConta = 0;
     aCampo = "";
     aValor = "";
     aDirBase    = "";
     aAplicacion = "";
     aDefEmpre   = "";
     aNumEmpre   = "";
     aTAB        = "";
     aParam      = "";
     aShell      = "";
     nHandle = 0;
     aLong   = "";
     nLong   = 0;
     nPos = 0;
     aAlfa2 = "";
     aAlfa2Esc = "";
     aTitulo = "";

     Tab1 = 0;
     aTab = "";
     aAbre = "";
     aAlfa = "";
     aReturn = "";
     aFicBat = "";
     aFicLanzaBat = "";
     aComandoDOS = "";
     aPathSh = "";
     nLinea = 0;
     aSistema = "";
     aAux = "";
     aDirBass = "";
     aFicCron = "";
     aDatos = "";
     aHoraIni = "";
     aHora = "";
     aMinutos = "";
     aCampoDiaMes = "";
     aCampoMes = "";
     aCampoDiaSem = "";
     aFechaVez = "";
     aDia = "";
     aMes = "";
     nContador = 0;

     aMin = "";
     aDia_mes = "";
     aDia_Sem = "";
     aComando = "";
     nCanal = 0;
     aDBass = "";



     nExiste = 0;
     aMensaje = "";
     nNum1 = 0;
     nNum2 = 0;
     nCampo = 0;
     fFechaSys = @;
     aFechaSys = "";
     aFecha = "";
     aAnyo = "";
     nAnyo = 0;
     aAnyoSys = "";
     nAnyoSys = 0;

     &enSoyDESPANET = 0;
|FIN;

|PROCESO Tipo80; |TIPO 80;
   FSalida = 2999;
|FPRC;

|PROCESO CheqHora; |TIPO 0;
     nNum1 = (A\(#0#3 % 102)) $ 24;
     nNum2 = (A\(#0#3 %-102)) $ 60;
     #0#3 = (("00" + nNum1) % -102) + ":" + (("00" + nNum2) % -102)
     |PINTA #0#3;
|FPRC;

|PROCESO Seleccion; |TIPO 0;
     |SI #dsarz026#2 = "D";
          |C_M #dsarz026#3, 1, "S";
          |C_M #dsarz026#5, 1, "S";
          |C_M #dsarz026#6, 1, "S";
          |C_M #dsarz026#7, 1, "S";
          |C_M #dsarz026#8, 1, "S";
          |C_M #dsarz026#9, 1, "S";
          |C_M #dsarz026#10, 1, "S";
          |C_M #dsarz026#11, 1, "S";
          |C_M #dsarz026#12, 1, "N";
          |C_M #dsarz026#13, 1, "N";
          |C_M #dsarz026#14, 1, "N";
          |C_M #dsarz026#15, 1, "N";
          |C_M #dsarz026#16, 1, "N";
          |C_M #dsarz026#17, 1, "N";
          |C_M #dsarz026#18, 1, "N";
          |C_M #dsarz026#19, 1, "N";
          |C_M #dsarz026#20, 1, "N";
          |C_M #dsarz026#21, 1, "N";
          |C_M #dsarz026#22, 1, "N";
          |C_M #dsarz026#23, 1, "N";
          |C_M #dsarz026#24, 1, "N";
          |C_M #dsarz026#25, 1, "N";
          |C_M #dsarz026#28, 1, "N";
          |C_M #dsarz026#29, 1, "N";
          |C_M #dsarz026#30, 1, "N";
          |C_M #dsarz026#31, 1, "N";
          |C_M #dsarz026#32, 1, "N";
          |C_M #dsarz026#33, 1, "S";
     |FINSI;
     |SI #dsarz026#2 = "M";
          |C_M #dsarz026#3, 1, "S";
          |C_M #dsarz026#5, 1, "N";
          |C_M #dsarz026#6, 1, "N";
          |C_M #dsarz026#7, 1, "N";
          |C_M #dsarz026#8, 1, "N";
          |C_M #dsarz026#9, 1, "N";
          |C_M #dsarz026#10, 1, "N";
          |C_M #dsarz026#11, 1, "N";
          |C_M #dsarz026#12, 1, "S";
          |C_M #dsarz026#13, 1, "S";
          |C_M #dsarz026#14, 1, "S";
          |C_M #dsarz026#15, 1, "S";
          |C_M #dsarz026#16, 1, "S";
          |C_M #dsarz026#17, 1, "S";
          |C_M #dsarz026#18, 1, "S";
          |C_M #dsarz026#19, 1, "S";
          |C_M #dsarz026#20, 1, "S";
          |C_M #dsarz026#21, 1, "S";
          |C_M #dsarz026#22, 1, "S";
          |C_M #dsarz026#23, 1, "S";
          |C_M #dsarz026#24, 1, "S";
          |C_M #dsarz026#25, 1, "N";
          |C_M #dsarz026#28, 1, "N";
          |C_M #dsarz026#29, 1, "N";
          |C_M #dsarz026#30, 1, "N";
          |C_M #dsarz026#31, 1, "N";
          |C_M #dsarz026#32, 1, "N";
          |C_M #dsarz026#33, 1, "S";
     |FINSI;
     |SI #dsarz026#2 = "V";
          |C_M #dsarz026#3, 1, "S";
          |C_M #dsarz026#5, 1, "N";
          |C_M #dsarz026#6, 1, "N";
          |C_M #dsarz026#7, 1, "N";
          |C_M #dsarz026#8, 1, "N";
          |C_M #dsarz026#9, 1, "N";
          |C_M #dsarz026#10, 1, "N";
          |C_M #dsarz026#11, 1, "N";
          |C_M #dsarz026#12, 1, "N";
          |C_M #dsarz026#13, 1, "N";
          |C_M #dsarz026#14, 1, "N";
          |C_M #dsarz026#15, 1, "N";
          |C_M #dsarz026#16, 1, "N";
          |C_M #dsarz026#17, 1, "N";
          |C_M #dsarz026#18, 1, "N";
          |C_M #dsarz026#19, 1, "N";
          |C_M #dsarz026#20, 1, "N";
          |C_M #dsarz026#21, 1, "N";
          |C_M #dsarz026#22, 1, "N";
          |C_M #dsarz026#23, 1, "N";
          |C_M #dsarz026#24, 1, "N";
          |C_M #dsarz026#25, 1, "S";
          |C_M #dsarz026#28, 1, "N";
          |C_M #dsarz026#29, 1, "N";
          |C_M #dsarz026#30, 1, "N";
          |C_M #dsarz026#31, 1, "N";
          |C_M #dsarz026#32, 1, "N";
          |C_M #dsarz026#33, 1, "S";
     |FINSI;
     |SI #dsarz026#2 = "E";
          |C_M #dsarz026#3, 1, "N";
          |C_M #dsarz026#5, 1, "N";
          |C_M #dsarz026#6, 1, "N";
          |C_M #dsarz026#7, 1, "N";
          |C_M #dsarz026#8, 1, "N";
          |C_M #dsarz026#9, 1, "N";
          |C_M #dsarz026#10, 1, "N";
          |C_M #dsarz026#11, 1, "N";
          |C_M #dsarz026#12, 1, "N";
          |C_M #dsarz026#13, 1, "N";
          |C_M #dsarz026#14, 1, "N";
          |C_M #dsarz026#15, 1, "N";
          |C_M #dsarz026#16, 1, "N";
          |C_M #dsarz026#17, 1, "N";
          |C_M #dsarz026#18, 1, "N";
          |C_M #dsarz026#19, 1, "N";
          |C_M #dsarz026#20, 1, "N";
          |C_M #dsarz026#21, 1, "N";
          |C_M #dsarz026#22, 1, "N";
          |C_M #dsarz026#23, 1, "N";
          |C_M #dsarz026#24, 1, "N";
          |C_M #dsarz026#25, 1, "N";
          |C_M #dsarz026#28, 1, "S";
          |C_M #dsarz026#29, 1, "S";
          |C_M #dsarz026#30, 1, "S";
          |C_M #dsarz026#31, 1, "S";
          |C_M #dsarz026#32, 1, "S";
          |C_M #dsarz026#33, 1, "S";
     |FINSI;
     |SI #dsarz026#2 = "B";
          |C_M #dsarz026#3, 1, "N";
          |C_M #dsarz026#5, 1, "N";
          |C_M #dsarz026#6, 1, "N";
          |C_M #dsarz026#7, 1, "N";
          |C_M #dsarz026#8, 1, "N";
          |C_M #dsarz026#9, 1, "N";
          |C_M #dsarz026#10, 1, "N";
          |C_M #dsarz026#11, 1, "N";
          |C_M #dsarz026#12, 1, "N";
          |C_M #dsarz026#13, 1, "N";
          |C_M #dsarz026#14, 1, "N";
          |C_M #dsarz026#15, 1, "N";
          |C_M #dsarz026#16, 1, "N";
          |C_M #dsarz026#17, 1, "N";
          |C_M #dsarz026#18, 1, "N";
          |C_M #dsarz026#19, 1, "N";
          |C_M #dsarz026#20, 1, "N";
          |C_M #dsarz026#21, 1, "N";
          |C_M #dsarz026#22, 1, "N";
          |C_M #dsarz026#23, 1, "N";
          |C_M #dsarz026#24, 1, "N";
          |C_M #dsarz026#25, 1, "N";
          |C_M #dsarz026#28, 1, "N";
          |C_M #dsarz026#29, 1, "N";
          |C_M #dsarz026#30, 1, "N";
          |C_M #dsarz026#31, 1, "N";
          |C_M #dsarz026#32, 1, "N";
          |C_M #dsarz026#33, 1, "N";
     |FINSI;

     |PINTA #dsarz026#3;
     |PARA nCampo = 5; |SI nCampo [ 25; |HACIENDO nCampo = nCampo + 1;
          |PINTA #dsarz026#nCampo#;
     |SIGUE;
     |PARA nCampo = 28; |SI nCampo [ 33; |HACIENDO nCampo = nCampo + 1;
          |PINTA #dsarz026#nCampo#;
     |SIGUE;

     |HAZ ControlaCampoSmb;
     |HAZ ControlaGeconet;
|FPRC;

|PROCESO Tipo0C33_z026; |TIPO 0;
     |HAZ ControlaCampoSmb;
|FPRC;

|PROCESO ControlaCampoSmb;
     |SI #dsarz026#33 = "S"; |Y #dsarm001#7 = "S";
          |C_M #dsarz026#34, 1, "S";
     |SINO;
          |C_M #dsarz026#34, 1, "N";
     |FINSI;
     |PINTA #dsarz026#34;
|FPRC;

|PROCESO Tipo0C35_z026; |TIPO 0;
     |HAZ ControlaGeconet;
|FPRC;

|PROCESO ControlaGeconet;
     |SI #dsarz026#35 = "S";
          #dsarz026#33 = "S";
          |C_M #dsarz026#33, 1, "N";
     |SINO;
          |C_M #dsarz026#33, 1, "S";
     |FINSI;
     |PINTA #dsarz026#33;
     |HAZ Tipo0C33_z026;
|FPRC;


|PROCESO FechaEsteAnyo;
     |SI #dsarz026#2 = "V";
          aFecha = #dsarz026#25;
          aAnyo = aFecha % -104;
          nAnyo = aAnyo;

          fFechaSys = ~;
          aFechaSys = fFechaSys;
          aAnyoSys = aFechaSys % -104;
          nAnyoSys = aAnyoSys;


          |SI nAnyo ! nAnyoSys;
               aMensaje = "0000Solo puede programar la ejecución para el año en curso [" + aAnyoSys + "]";
               |MENAV aMensaje;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DiaMes; |TIPO 0;
     |SI #dsarz026#2 = "M";
          |SI #dsarz026#12 < 0; |O #dsarz026#12 > 31;
               aMensaje = "0000Día del Mes incorrecto [" + #dsarz026#12 + "].";
               |MENAV aMensaje;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BorraCron;
     || SI es  tarea de DSARCHI00, borra la tarea.
     aAux = #crontcom@#22;
     |QBF aAux;
     aAux = aAux % 109;
     |SI aAux = "DSARCHI00";
          |BORRA 020#crontcom@.a;
     |FINSI;
|FPRC;

|DEFBUCLE BorraCron;
 #crontcom@#3002;
 ;
 000, "S";
 999, "S";
 be;
 NULL, BorraCron;
|FIN;

|PROCESO SacaNombre;
     aNombre = "";
     aLong = aDirSaca % A0;
     nLong = aLong;
     |PARA nConta = 1; |SI nConta [ nLong; |HACIENDO nConta = nConta + 1;
          |SI nConta [ 99;
               aCampo = ("00" + nConta) % -102;
               aCampo = "-" + aCampo + "01";
               nCampo = aCampo;
               aValor = aDirSaca % nCampo;
               |SI aValor ! "/"; |Y aValor ! "\";
                    aNombre = aValor + aNombre;
               |SINO;
                    |SI nConta ! 1;
                        |SAL;
                    |FINSI;
               |FINSI;
          |SINO;
               aNombre = "";
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO ShellGeconet;
     aLetra = aDirSaca % -101;
     |SI aLetra = "/";
          aLong = aDirSaca % A0;
          nLong = aLong;
          nLong = nLong - 1;
          nSaca = 100 + nLong;
          aSaca = aDirSaca % nSaca;
          aDirSacaBo = aSaca;
     |SINO;
          aDirSacaBo = aDirSaca;
     |FINSI;

     aBaseGeco = "/u/basico/";

     aFicLanzaBat = aBaseGeco + "bin/lanza_" + aNombre + ".sh";
     aNombreShell = aBaseGeco + "bin/rc_" + aNombre + ".sh";
     aLog = aBaseGeco + "bin/rc_" + aNombre + ".log";
     aErr = aBaseGeco + "bin/rc_" + aNombre + ".err";

     aTitulo = "Tarea generada Automaticamente desde DSARCHI. Recepcion Correos: " + aNombre;
     aShell = aFicLanzaBat;
     |XABRE "WB", aShell, nHandle;

     aAlfa = "#" + aTitulo + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = aNombreShell + " &" + &10;
     |XGRABA nHandle, aAlfa;
     |XCIERRA nHandle;
     aAlfa = "chmod 777 " + aShell;
     |SYSTEM aAlfa;

     aShell = aNombreShell;
     |XABRE "WB", aShell, nHandle;

     aDirBase = aBaseGeco; |QBF aDirBase;
     aLong = aDirBase % 0;
     nLong = aLong;
     aAlfa = aDirBase;
     nPos = 100 + nLong - 1;
     aDirBase    = aAlfa % nPos;
     aAplicacion = "dsarchi"; |QBF aAplicacion;
     aDefEmpre   = ""; |QBF aDefEmpre;
     aNumEmpre   = ""; |QBF aNumEmpre;
     aTAB        = "dsarz009"; |QBF aTAB;
     aParam      = ""; |QBF aParam;

     aAlfa = "#" + aTitulo + &10;
     |XGRABA nHandle, aAlfa;
     aAlfa2 = &10;

     aAlfa = "echo Iniciando la ejecucion.";
     aAlfa2 = " >>" + aLog + " 2>>" + aErr + &10;
     aAlfa = aAlfa + aAlfa2;
     |XGRABA nHandle, aAlfa;

     aAlfa = "date";
     aAlfa = aAlfa + aAlfa2;
     |XGRABA nHandle, aAlfa;

     aAlfa = aBaseGeco + "bin/serverds @" + aDirSacaBo + " " + &34 + "/!:" + aAplicacion +"/"+ aTAB;
     |SI aDefEmpre ! "";
          aAlfa = aAlfa + " " + aDefEmpre;
     |FINSI;
     |SI aNumEmpre ! "";
          aAlfa = aAlfa + " " + aNumEmpre;
     |FINSI;
     |SI aParam ! "";
          aAlfa = aAlfa + ";" + aParam;
     |FINSI;
     aAlfa = aAlfa + &34 + aAlfa2;
     |XGRABA nHandle, aAlfa;

     aAlfa = "echo Finalizada la ejecucion:";
     aAlfa = aAlfa + aAlfa2;
     |XGRABA nHandle, aAlfa;

     aAlfa = "date";
     aAlfa = aAlfa + aAlfa2;
     |XGRABA nHandle, aAlfa;

     |XCIERRA nHandle;
     aAlfa = "chmod 777 " + aShell;
     |SYSTEM aAlfa;
|FPRC;

|PROCESO Principal;
     |DBASS aDirBass;
     |QBF aDirBass;
     aFicCron = aDirBass + "agitool/def/crontcom";
     |CARGA_DEF aFicCron, crontcom@;
     |SI FSalida ! 0;
          aMensaje = "0000Problemas con el CargaDef " + aFicCron;
          |MENAV aMensaje;
          |ACABA;
     |FINSI;


     Tab1 = 9;
     aTab = &Tab1;
     ||TODO CCC. Descomentar para pruebas mias.
     aSistema = "ESDOS";
     |QUE_SISTEMA aSistema;
     |SI aSistema = "ESDOS";
          aSistema = "ESDOS";
          aReturn = &13 + &10;     ||DOS.
     |SINO;
          aSistema = "ESUNIX";
          aReturn = &10;           ||Unix
     |FINSI;

     aDatos = aDirBass + "agitool/fich/";
     |PATH_DAT #100 aDatos;

     |BUCLE BorraCron;
     |SI #dsarz026#2 ! "B";
          |SI #dsarz026#35 = "S";
               aNombre = "";
               aDirSaca = aDirBass;
               |HAZ SacaNombre;

               |HAZ ShellGeconet;
          |SINO;
               |HAZ GrabaTarea;
          |FINSI;
     |FINSI;

     |HAZ GrabaTareasSrv;

     |DESCARGA_DEF #crontcom@;

     |SI #dsarz026#2 ! "B";
          aEjecuta = "dsarz043;AUTO";
          |SUB_EJECUTA_NP aEjecuta;
     |FINSI;
|FPRC;

|| -------------- ESCRIBE EN EL FICHERO
|PROCESO Escribe;
     aMin     = #100#2;    |QBT aMin;
     aHora    = #100#3;    |QBT aHora;
     aDia_mes = #100#4;    |QBT aDia_mes;
     aMes     = #100#5;    |QBT aMes;
     aDia_Sem = #100#6;    |QBT aDia_Sem;
     aComando = #100#7;    |QBF aComando;

     aAlfa = "#" + #100#22 + aReturn;
     |XGRABA nCanal, aAlfa;

     |SI #100#8 = "S";
          aAlfa = aMin + " " + aHora + " " + aDia_mes + " " + aMes + " " + aDia_Sem + " " + aComando + aReturn;
     |SINO;
          aAlfa = "#" + aMin + " " + aHora + " " + aDia_mes + " " + aMes + " " + aDia_Sem + " " + aComando + aReturn;
     |FINSI;
     |XGRABA nCanal, aAlfa;
|FPRC;

|DEFBUCLE crontcom;
     #crontcom@#1002;
     ;
     00, 000;
     00, 999;
     ;
     NULL, Escribe;
|FIN;


|| -------------- GRABA EL FICHERO "TAREAS.SRV" -----------------
|PROCESO GrabaTareasSrv;
     |DBASS aAbre;
     aAbre = aAbre + "bin/tareas.srv";
     |XABRE "WB", aAbre, nCanal;
     |BUCLE crontcom;
     |XCIERRA nCanal;
|FPRC;


|PROCESO GrabaTarea;
     aHoraIni = #dsarz026#3;
     aHora = aHoraIni % 102;
     aMinutos = aHoraIni % -102;

     ||Segun la configuracion (dsarz026)... me dice como meto la linea en el crontab

     |SI #dsarz026#2 = "D";
          |SI #dsarz026#5 = "S"; |Y #dsarz026#6 = "S"; |Y #dsarz026#7 = "S"; |Y #dsarz026#8 = "S"; |Y #dsarz026#9 = "S"; |Y #dsarz026#10 = "S"; |Y #dsarz026#11 = "S";
               aCampoDiaSem = "*";
          |SINO;
               |SI #dsarz026#5 = "S"; |Y #dsarz026#6 = "S"; |Y #dsarz026#7 = "S"; |Y #dsarz026#8 = "S"; |Y #dsarz026#9 = "S"; |Y #dsarz026#10 = "N"; |Y #dsarz026#11 = "N";
                    aCampoDiaSem = "1-5";
               |SINO;
                    |SI #dsarz026#5 = "S"; |Y #dsarz026#6 = "S"; |Y #dsarz026#7 = "S"; |Y #dsarz026#8 = "S"; |Y #dsarz026#9 = "S"; |Y #dsarz026#10 = "S"; |Y #dsarz026#11 = "N";
                         aCampoDiaSem = "1-6";
                    |SINO;
                         aAux = "";
                         |SI #dsarz026#5 = "S";
                              |SI aAux = "";
                                   aAux = aAux + "1";
                              |SINO;
                                   aAux = aAux + ",1";
                              |FINSI;
                         |FINSI;
                         |SI #dsarz026#6 = "S";
                              |SI aAux = "";
                                   aAux = aAux + "2";
                              |SINO;
                                   aAux = aAux + ",2";
                              |FINSI;
                         |FINSI;
                         |SI #dsarz026#7 = "S";
                              |SI aAux = "";
                                   aAux = aAux + "3";
                              |SINO;
                                   aAux = aAux + ",3";
                              |FINSI;
                         |FINSI;
                         |SI #dsarz026#8 = "S";
                              |SI aAux = "";
                                   aAux = aAux + "4";
                              |SINO;
                                   aAux = aAux + ",4";
                              |FINSI;
                         |FINSI;
                         |SI #dsarz026#9 = "S";
                              |SI aAux = "";
                                   aAux = aAux + "5";
                              |SINO;
                                   aAux = aAux + ",5";
                              |FINSI;
                         |FINSI;
                         |SI #dsarz026#10 = "S";
                              |SI aAux = "";
                                   aAux = aAux + "6";
                              |SINO;
                                   aAux = aAux + ",6";
                              |FINSI;
                         |FINSI;
                         |SI #dsarz026#11 = "S";
                              |SI aAux = "";
                                   aAux = aAux + "7";
                              |SINO;
                                   aAux = aAux + ",7";
                              |FINSI;
                         |FINSI;
                         aCampoDiaSem = aAux;
                    |FINSI;
               |FINSI;
          |FINSI;

          aCampoDiaMes = "*";
          aCampoMes = "*";
     |FINSI;
     |SI #dsarz026#2 = "M";
          |SI #0#13 = "S"; |Y #0#14 = "S"; |Y #0#15 = "S"; |Y #0#16 = "S"; |Y #0#17 = "S"; |Y #0#18 = "S"; |Y #0#19 = "S"; |Y #0#20 = "S"; |Y #0#21 = "S"; |Y #0#22 = "S"; |Y #0#23 = "S"; |Y #0#24 = "S";
               aCampoMes = "*";
          |SINO;
               aAux = "";
               |SI #0#13 = "S";
                    |SI aAux = "";
                         aAux = aAux + "1";
                    |SINO;
                         aAux = aAux + ",1";
                    |FINSI;
               |FINSI;
               |SI #0#14 = "S";
                    |SI aAux = "";
                         aAux = aAux + "2";
                    |SINO;
                         aAux = aAux + ",2";
                    |FINSI;
               |FINSI;
               |SI #0#15 = "S";
                    |SI aAux = "";
                         aAux = aAux + "3";
                    |SINO;
                         aAux = aAux + ",3";
                    |FINSI;
               |FINSI;
               |SI #0#16 = "S";
                    |SI aAux = "";
                         aAux = aAux + "4";
                    |SINO;
                         aAux = aAux + ",4";
                    |FINSI;
               |FINSI;
               |SI #0#17 = "S";
                    |SI aAux = "";
                         aAux = aAux + "5";
                    |SINO;
                         aAux = aAux + ",5";
                    |FINSI;
               |FINSI;
               |SI #0#18 = "S";
                    |SI aAux = "";
                         aAux = aAux + "6";
                    |SINO;
                         aAux = aAux + ",6";
                    |FINSI;
               |FINSI;
               |SI #0#19 = "S";
                    |SI aAux = "";
                         aAux = aAux + "7";
                    |SINO;
                         aAux = aAux + ",7";
                    |FINSI;
               |FINSI;
               |SI #0#20 = "S";
                    |SI aAux = "";
                         aAux = aAux + "8";
                    |SINO;
                         aAux = aAux + ",8";
                    |FINSI;
               |FINSI;
               |SI #0#21 = "S";
                    |SI aAux = "";
                         aAux = aAux + "9";
                    |SINO;
                         aAux = aAux + ",9";
                    |FINSI;
               |FINSI;
               |SI #0#22 = "S";
                    |SI aAux = "";
                         aAux = aAux + "10";
                    |SINO;
                         aAux = aAux + ",10";
                    |FINSI;
               |FINSI;
               |SI #0#23 = "S";
                    |SI aAux = "";
                         aAux = aAux + "11";
                    |SINO;
                         aAux = aAux + ",11";
                    |FINSI;
               |FINSI;
               |SI #0#24 = "S";
                    |SI aAux = "";
                         aAux = aAux + "12";
                    |SINO;
                         aAux = aAux + ",12";
                    |FINSI;
               |FINSI;
               aCampoMes = aAux;
          |FINSI;

          |SI #dsarz026#12 = 0;
               aCampoDiaMes = "*";
          |SINO;
               aCampoDiaMes = #dsarz026#12;
          |FINSI;
          aCampoDiaSem = "*";
     |FINSI;
     |SI #dsarz026#2 = "V";
          aFechaVez = #dsarz026#25;
          aDia = aFechaVez % 102;
          aMes = aFechaVez % 402;
          aCampoDiaMes = aDia;
          aCampoMes = aMes;
          aCampoDiaSem = "*";
     |FINSI;
     |SI #dsarz026#2 = "E";        ||Modo Experto
          aMinutos = #dsarz026#29;
          |QBT aMinutos;
          aHora = #dsarz026#28;
          |QBT aHora;
          aCampoDiaMes = #dsarz026#31;
          |QBT aCampoDiaMes;
          aCampoMes = #dsarz026#30;
          |QBT aCampoMes;
          aCampoDiaSem = #dsarz026#32;
          |QBT aCampoDiaSem;
     |FINSI;

     |ABRE #crontcom@;

     ||Controlar el numero de linea.
     nLinea = 1;
     |HAZ DameLineaLibre;

     |DDEFECTO #crontcom@;
     #crontcom@#0 = 0;
     #crontcom@#1 = nLinea;
     |LEE 101#crontcom@.=;
     |SI FSalida ! 0;
          #crontcom@#2 = aMinutos;
          #crontcom@#3 = aHora;
          #crontcom@#4 = aCampoDiaMes;
          #crontcom@#5 = aCampoMes;
          #crontcom@#6 = aCampoDiaSem;
          |SI aSistema = "ESDOS";
               aFicBat = aDirBass + "bin/cron" + nLinea + ".bat";
               #crontcom@#7 = aFicBat;
          |SINO;
               aFicLanzaBat = aDirBass + "bin/lanza" + nLinea + ".sh";
               #crontcom@#7 = aFicLanzaBat;
          |FINSI;
          #crontcom@#8 = "S";
          #crontcom@#9 = #crontcom@#2;
          #crontcom@#10 = #crontcom@#3;
          #crontcom@#11 = #crontcom@#4;
          #crontcom@#12 = #crontcom@#5;
          #crontcom@#13 = #crontcom@#6;
          #crontcom@#14 = #crontcom@#7;
          #crontcom@#15 = "S";
          #crontcom@#16 = aDirBass;
          #crontcom@#17 = "dsarchi";
          #crontcom@#18 = "";
          #crontcom@#19 = "";
          #crontcom@#20 = "dsarz009";
          |SI #dsarz026#33 = "N";
               #crontcom@#21 = "";
          |SINO;
               #crontcom@#21 = "SERVIDORUNIX";
          |FINSI;
          aAux = "DSARCHI00" + "Tarea generada Automaticamente desde DSARCHI.";
          #crontcom@#22 = aAux;
          #crontcom@#23 = "S";
          |GRABA 020#crontcom@.n;
          |LIBERA #crontcom@;

          |HAZ CreaBatsShells;
     |FINSI;

     |CIERRA #crontcom@;
|FPRC;

|PROCESO Bat;
     |DBASS aDBass;
     |QBF aDBass;
     aShell = aFicBat
     |XABRE "WB", aShell, nHandle;
     aDirBase = #100#16; |QBF aDirBase;
     aLong = aDirBase % 0;
     nLong = aLong;
     aAlfa = aDirBase;
     nPos = 100 + nLong - 1;
     aDirBase    = aAlfa % nPos;
     aAplicacion = #100#17; |QBF aAplicacion;
     aDefEmpre   = #100#18; |QBF aDefEmpre;
     aNumEmpre   = #100#19; |QBF aNumEmpre;
     aTAB        = #100#20; |QBF aTAB;
     aParam      = #100#21; |QBF aParam;

     aAlfa = "@echo off" + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = "echo Iniciando la ejecucion:";
     aAlfa2 = " >>" + aDBass + "bin/cron" + nLinea + ".log 2>>" + aDBass + "bin/cron" + nLinea + ".err" + &13 + &10;
     aAlfa = aAlfa + aAlfa2;
     |XGRABA nHandle, aAlfa;

     aAlfa = "time /T";
     aAlfa = aAlfa + aAlfa2;
     |XGRABA nHandle, aAlfa;


     |SI #dsarm001#179 = "N";      ||Sin timeout, se ejecuta como siempre.
          aAlfa = aDBass + "bin/diagramx.exe /DS:" + &34 + "@" + aDirBase + " $$$batch,batch# //(" + aAplicacion +")"+ aTAB;
          |SI aDefEmpre ! "";
               aAlfa = aAlfa + "&" + aDefEmpre;
          |FINSI;
          |SI aNumEmpre ! "";
               aAlfa = aAlfa + "&" + aNumEmpre;
          |FINSI;
          |SI aParam ! "";
               aAlfa = aAlfa + ";" + aParam;
          |FINSI;
          aAlfa = aAlfa + &34 + aAlfa2;
          |XGRABA nHandle, aAlfa;
     |SINO;
          ||Ahora tenemos timeout.
          aAlfa = "echo " + aDBass + "bin/diagramx.exe /DS:" + &34 + "@" + aDirBase + " $$$batch,batch# //(" + aAplicacion +")"+ aTAB;
          |SI aDefEmpre ! "";
               aAlfa = aAlfa + "&" + aDefEmpre;
          |FINSI;
          |SI aNumEmpre ! "";
               aAlfa = aAlfa + "&" + aNumEmpre;
          |FINSI;
          |SI aParam ! "";
               aAlfa = aAlfa + ";" + aParam;
          |FINSI;
          aAlfa = aAlfa + &34 + " > " + aDBass + "bin/p" + nLinea + ".txt" + &13 + &10;
          |XGRABA nHandle, aAlfa;

          aAlfa = aDBass + "bin/tiempo.exe " + aDBass + "bin/p" + nLinea + ".txt";
          aAlfa = aAlfa + aAlfa2;
          |XGRABA nHandle, aAlfa;
     |FINSI;

     aAlfa = "echo Finalizada la ejecucion:";
     aAlfa = aAlfa + aAlfa2;
     |XGRABA nHandle, aAlfa;

     aAlfa = "time /T";
     aAlfa = aAlfa + aAlfa2;
     |XGRABA nHandle, aAlfa;

     |XCIERRA nHandle;
|FPRC;

|| -------------- CONSTRUIMOS UNA SHELL O UN BAT
|PROCESO ShellLinux;
     aTitulo     = #100#22; |QBF aTitulo;

     |DBASS aDBass;
     |QBF aDBass;

     aShell = aFicLanzaBat;
     |XABRE "WB", aShell, nHandle;
     aAlfa = "#" + aTitulo + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = aDBass + "bin/cron" + nLinea  + ".sh &" + &10;
     |XGRABA nHandle, aAlfa;
     |XCIERRA nHandle;
     aAlfa = "chmod 777 " + aShell;
     |SYSTEM aAlfa;

     aShell = aDBass + "bin/cron" + nLinea  + ".sh";
     |XABRE "WB", aShell, nHandle;
     aDirBase    = #100#16; |QBF aDirBase;
     aLong = aDirBase % 0;
     nLong = aLong;
     aAlfa = aDirBase;
     nPos = 100 + nLong - 1;
     aDirBase    = aAlfa % nPos;
     aAplicacion = #100#17; |QBF aAplicacion;
     aDefEmpre   = #100#18; |QBF aDefEmpre;
     aNumEmpre   = #100#19; |QBF aNumEmpre;
     aTAB        = #100#20; |QBF aTAB;
     aParam      = #100#21; |QBF aParam;

     aAlfa = "#" + aTitulo + &10;
     |XGRABA nHandle, aAlfa;
     aAlfa2 = &10;
     |SI #100#25 = "S";
          aAlfa = "echo Iniciando la ejecucion:";
          aAlfa2 = " >>" + aDBass + "bin/cron" + nLinea + ".log 2>>" + aDBass + "bin/cron" + nLinea + ".err" + &10;
          aAlfa = aAlfa + aAlfa2;
          |XGRABA nHandle, aAlfa;

          aAlfa = "date";
          aAlfa = aAlfa + aAlfa2;
          |XGRABA nHandle, aAlfa;
     |FINSI;

     aAlfa = aDBass + "bin/serverds @" + aDirBase + " " + &34 + "/!:" + aAplicacion +"/"+ aTAB;
     |SI aDefEmpre ! "";
          aAlfa = aAlfa + " " + aDefEmpre;
     |FINSI;
     |SI aNumEmpre ! "";
          aAlfa = aAlfa + " " + aNumEmpre;
     |FINSI;
     |SI aParam ! "";
          aAlfa = aAlfa + ";" + aParam;
     |FINSI;
     aAlfa = aAlfa + &34 + aAlfa2;
     |XGRABA nHandle, aAlfa;
     |SI #100#25 = "S";
          aAlfa = "echo Finalizada la ejecucion:";
          aAlfa = aAlfa + aAlfa2;
          |XGRABA nHandle, aAlfa;

          aAlfa = "date";
          aAlfa = aAlfa + aAlfa2;
          |XGRABA nHandle, aAlfa;
     |FINSI;
     |XCIERRA nHandle;
     aAlfa = "chmod 777 " + aShell;
     |SYSTEM aAlfa;
|FPRC;

|PROCESO CreaBatsShells;
     |SI aSistema = "ESDOS";
          |HAZ Bat;
     |SINO;
          |HAZ ShellLinux;
     |FINSI;
|FPRC;

|PROCESO DameLineaLibre;
     ||Este proceso ira buscando una a una las lineas libres para ir ocupandolas
     |PARA nContador = nLinea; |SI nContador [ 999; |HACIENDO nContador = nContador + 1;
          #crontcom@#0 = 0;
          #crontcom@#1 = nContador;
          |LEE 000#crontcom@.=;
          |SI FSalida ! 0;
               nLinea = nContador;
               |SAL;
          |FINSI;
     |SIGUE;

     |SI nContador ] 999;
          aMensaje = "0000Error: Contador de Líneas en el crontcom, ha llegado a las 999.";
          |MENAV aMensaje;
     |FINSI;
|FPRC;

|PROGRAMA;
     |HAZ SoyDESPANET;
     |SI enSoyDESPANET = 1;  |ACABA;  |FINSI;

     |ABRE #dsarm001;
     |DDEFECTO #dsarm001;
     |LEE 000#dsarm001.p;
     |CIERRA #dsarm001;

     |CLS;
     |ABRE #0;
     |DDEFECTO #0;
     |LEE 101#0p;
     nExiste = FSalida;
     |PINPA #0#0;
     |PINDA #0#0;
     |HAZ Seleccion;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |SI nExiste = 0;
               |GRABA 020#0a;
          |SINO;
               |GRABA 020#0n;
          |FINSI;
          |HAZ Principal;
     |FINSI;
     |LIBERA #0;
     |CIERRA #0;
|FPRO;
