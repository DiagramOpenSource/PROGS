|FICHEROS;
     dsarw118;
     dsarw102,MANTE;

     dsarm001;
     dsarm073;

     dsarm002;
     dsarm003;
     dsarm004;

     agitab99@;
|FIN;

|VARIABLES;
     nSalida        = 0;
     nRango         = 0;
     nPanta         = 0;
     nGrid          = 0;
     nID            = 0;
     nBtn1          = 0;
     nBtn2          = 0;
     nBtn3          = 0;
     nHandle        = 0;
     nSubVent       = 0;
     nBotonAceptar  = 0;
     nBotonCancelar = 0;

     nOk            = 0;
     aAlfa          = "";
     aAlfa1         = "";
     aAlfa2         = "";
     aAlfa3         = "";
     aAlfa4         = "";
     aAlfa5         = "";
     aAlfa6         = "";
     aTecla         = "";
     aEsc1          = "";
     aEsc2          = "";
     aRetu          = "";
     aBase          = "";
     aDef           = "";
     aMensaje       = "";
     aEjecuta       = "";
     aQueBoton      = "";
     aID            = "";

     {-1}aVent      = "";
         aVent1     = 0;
         aVent2     = 0;
         aVent3     = 0;
         aVent4     = 0;
         aVent5     = "";

  {30}aPopup        = "";
|FIN;

|PROCESO LeeDescripcion;
     |SI #dsarm073#3 ! 000;

         #dsarm002#0 = #dsarm073#3;
         |LEE 000#dsarm002.=;
         |SI FSalida = 0;
             #dsarm073#6 = #dsarm002#1;
         |FINSI;

         |SI #dsarm073#4 ! 000;
             #dsarm003#0 = #dsarm073#3;
             #dsarm003#1 = #dsarm073#4;
             |LEE 000#dsarm003.=;
             |SI FSalida = 0;
                 #dsarm073#7 = #dsarm003#2;
             |FINSI;

             |SI #dsarm073#5 ! 000;
                 #dsarm004#0 = #dsarm073#3;
                 #dsarm004#1 = #dsarm073#4;
                 #dsarm004#2 = #dsarm073#5;
                 |LEE 000#dsarm004.=;
                 |SI FSalida = 0;
                     #dsarm073#8 = #dsarm004#3;
                 |FINSI;
             |FINSI;

         |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaModelo;
     aAlfa1 = aAlfa % 103;
     aAlfa2 = aAlfa % 502;
     aAlfa3 = aAlfa % 1240;
     aAlfa4 = aAlfa % 5203;
     aAlfa5 = aAlfa % 5503;
     aAlfa6 = aAlfa % 5803;

     |DDEFECTO #dsarm073;
     #dsarm073#0 = aAlfa1;
     #dsarm073#1 = aAlfa2;
     #dsarm073#2 = aAlfa3;
     #dsarm073#3 = aAlfa4;
     #dsarm073#4 = aAlfa5;
     #dsarm073#5 = aAlfa6;
     #dsarm073#9 = " ";
     |HAZ LeeDescripcion;
     |GRABA 020#dsarm073.n;
|FPRC;

|PROCESO GrabaFijos;
     |ABRE #dsarm002;
     |ABRE #dsarm003;
     |ABRE #dsarm004;
            ||          1         2         3         4         5
            || 123456789012345678901234567890123456789012345678901234567890
     aAlfa  = "909/01     BALANCE DE SITUACION                    003003001";  |HAZ GrabaModelo;
     aAlfa  = "909/02     CUENTA PERDIDAS Y GANANCIAS             003003001";  |HAZ GrabaModelo;
     aAlfa  = "909/03     ESTADO DE INGRESOS Y GASTOS RECONOCIDOS 003003001";  |HAZ GrabaModelo;
     aAlfa  = "909/04     E.C.P.N.                                003003001";  |HAZ GrabaModelo;
     aAlfa  = "909/05     E.F.E.                                  003003001";  |HAZ GrabaModelo;
     aAlfa  = "909/06     BALANCE DE SUMAS Y SALDOS               003003001";  |HAZ GrabaModelo;
     aAlfa  = "908/01     LIBRO DIARIO                            003004001";  |HAZ GrabaModelo;
     aAlfa  = "901/01     LIBRO DE IVA REPERCUTIDO                003004003";  |HAZ GrabaModelo;
     aAlfa  = "902/01     LIBRO DE IVA SOPORTADO                  003004003";  |HAZ GrabaModelo;
     aAlfa  = "910/01     LIBRO DE VENTAS E INGRESOS              003004008";  |HAZ GrabaModelo;
     aAlfa  = "911/01     LIBRO DE COMPRAS Y GASTOS               003004008";  |HAZ GrabaModelo;
     aAlfa  = "950/01     MAYORES / EXTRACTOS                     003003002";  |HAZ GrabaModelo;
     aAlfa  = "950/02     ANOTACIONES DE REVISION CONTABLE        003003003";  |HAZ GrabaModelo;

|| mas adelante     aAlfa  = "950/03     INFORMES AGRUPADOS                      003003003";  |HAZ GrabaModelo;
||                  aAlfa  = "951/01     LEGALIZACION LIBROS CONTABLES           003006001";  |HAZ GrabaModelo;
||                  aAlfa  = "951/02     LEGALIZACION CCAA                       003006002";  |HAZ GrabaModelo;

     aAlfa  = "952/01     CERTIFICADO MODELO 180                  002002003";  |HAZ GrabaModelo;
     aAlfa  = "952/02     CERTIFICADO MODELO 184                  002002005";  |HAZ GrabaModelo;
     aAlfa  = "952/03     CERTIFICADO MODELO 190 (TRABAJADORES)   002002001";  |HAZ GrabaModelo;
     aAlfa  = "952/04     CERTIFICADO MODELO 190 (ACT.ECONOMICAS) 002002001";  |HAZ GrabaModelo;
     aAlfa  = "952/05     CERTIFICADO MODELO 190 (PREMIOS)        002002001";  |HAZ GrabaModelo;
     aAlfa  = "952/06     CERTIFICADO MODELO 190 (DERECHOS IMAGEN)002002001";  |HAZ GrabaModelo;
     aAlfa  = "952/07     CERTIFICADO MODELO 190 (APRO.FORESTALES)002002001";  |HAZ GrabaModelo;
     aAlfa  = "952/08     CERTIFICADO MODELO 193                  002002004";  |HAZ GrabaModelo;

     |CIERRA #dsarm004;
     |CIERRA #dsarm003;
     |CIERRA #dsarm002;
|FPRC;

|PROCESO CtrlNuevasCarpetas;
     #dsarm073#0 = 950; |HAZ ControlaModelo;
     #dsarm073#0 = 951; |HAZ ControlaModelo;
     #dsarm073#0 = 952; |HAZ ControlaModelo;

     nOk = 0;
     |ABRE #dsarm004;
     |DDEFECTO #dsarm004;
     #dsarm004#0 = 003;
     #dsarm004#1 = 004;
     #dsarm004#2 = 008;
     |LEE 041#dsarm004.=;
     aAlfa  = #dsarm004#3;  |QBF aAlfa;  aAlfa  = aAlfa  > " ";
     aAlfa1 = #dsarm004#90; |QBF aAlfa1; aAlfa1 = aAlfa1 > " ";
     |SI aAlfa ! "LIBROS DE ACTIVIDADES ECONOMICAS"; |O aAlfa1 ! "MODELOS";
         nOk = 1;
     |FINSI;
     |CIERRA #dsarm004;
     |SI nOk = 1;
         aAlfa1 = "dsarz990";
         |SI aAlfa = "LIBROS DE ACTIVIDADES ECONOMICAS";
             aAlfa1 = "dsarz990;TODO";
         |FINSI;
         |SUB_EJECUTA aAlfa1;
     |FINSI;
|FPRC;

|PROCESO Tipo12Fw118; |TIPO 12;
|FPRC;

|PROCESO Tipo0C0Fw118;
     |ESTADO_CONTROL nGrid, "DISABLE";
     |ESTADO_CONTROL nBtn1, "DISABLE";

     |C_M #dsarw118#1, 1, "N";

     |SI #dsarw118#0 = "S";
         |ESTADO_CONTROL nGrid, "ENABLE";
         |ESTADO_CONTROL nBtn1, "ENABLE";

         |HAZ CtrlNuevasCarpetas;
         |C_M #dsarw118#1, 1, "S";

         |LEE 000#dsarm073.p;
         |SI FSalida ! 0;
              |HAZ GrabaFijos;
              |LEE 000#dsarm073.p;
              |REFRESCACONTROL nGrid;
         |FINSI;

     |SINO;
         |ESTADO_CONTROL nBtn2, "DISABLE";
         |ESTADO_CONTROL nBtn3, "DISABLE";
     |FINSI;

     |PINTA #dsarw118#1;
|FPRC;

|PROCESO ControlaModelo;
     |DBASS aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "basica/def/agitab99.mas";
     |CARGA_DEF aAlfa, agitab99@;

     |DBASS aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "basica/fich/";
     |PATH_DAT #agitab99@#aAlfa#;

     |ABRE #agitab99@;
     |DDEFECTO #agitab99@;
     #agitab99@#0 = #dsarm073#0;
     |LEE 000#agitab99@.=;
     |SI FSalida ! 0;
         |DDEFECTO #agitab99@;
         #agitab99@#0 = #dsarm073#0;

         |SI #agitab99@#0 = 908;
             #agitab99@#1 = "LIBRO DIARIO DE MOVIMIENTOS";
             #agitab99@#2 = "LIBRO DIARIO DE MOVIMIENTOS";
             #agitab99@#3 = "";
             #agitab99@#5 = "M";
         |FINSI;

         |SI #agitab99@#0 = 909;
             #agitab99@#1 = "LIBRO DE BALANCES Y CUENTAS ANUALES";
             #agitab99@#2 = "LIBRO BALANCE E INVENTARIOS Y CUENTAS ANUALES";
             #agitab99@#3 = "";
             #agitab99@#5 = "M";
         |FINSI;

         |SI #agitab99@#0 = 901;
             #agitab99@#1 = "LIBRO REGISTRO DE FACTURAS EMITIDAS";
             #agitab99@#2 = "LIBRO REGISTRO DE FACTURAS EMITIDAS";
             #agitab99@#3 = "";
             #agitab99@#5 = "M";
         |FINSI;

         |SI #agitab99@#0 = 902;
             #agitab99@#1 = "LIBRO REGISTRO DE FACTURAS RECIBIDAS";
             #agitab99@#2 = "LIBRO REGISTRO DE FACTURAS RECIBIDAS";
             #agitab99@#3 = "";
             #agitab99@#5 = "M";
         |FINSI;

         |SI #agitab99@#0 = 950;
             #agitab99@#1 = "INFORMES CONTABLES VARIOS";
             #agitab99@#2 = "INFORMES CONTABLES VARIOS (EXTRACTOS, ANOTACIONES DE REVISION CONTABLE";
             #agitab99@#3 = "INFORMES AGRUPADOS, ETC)";
             #agitab99@#4 = "N";
             #agitab99@#5 = "C";
             #agitab99@#6 = "M";
             #agitab99@#7 = "N";
             #agitab99@#8 = "N";
         |FINSI;

         |SI #agitab99@#0 = 951;
             #agitab99@#1 = "LEGALIZACIONES";
             #agitab99@#2 = "LEGALIZACIONES DE LIBROS Y CUENTAS ANUALES";
             #agitab99@#3 = "";
             #agitab99@#4 = "N";
             #agitab99@#5 = "C";
             #agitab99@#6 = "M";
             #agitab99@#7 = "N";
             #agitab99@#8 = "N";
         |FINSI;

         |SI #agitab99@#0 = 952;
             #agitab99@#1 = "CERTIFICADOS DE IRPF";
             #agitab99@#2 = "CERTIFICADOS DE LOS MODELOS 180, 184, 190 Y 193";
             #agitab99@#3 = "";
             #agitab99@#4 = "N";
             #agitab99@#5 = "C";
             #agitab99@#6 = "M";
             #agitab99@#7 = "N";
             #agitab99@#8 = "N";
         |FINSI;

         |GRABA 020#agitab99@.n;
         |LIBERA #agitab99@;
     |FINSI;
     |CIERRA #agitab99@;

     |DESCARGA_DEF #agitab99@;
|FPRC;

|PROCESO EntraDatos;
     |VENTANA 0501, 1368, -1, 16, "Datos modelo";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #dsarw102;
     #dsarw102#0  = #dsarm073#3;
     #dsarw102#1  = #dsarm073#4;
     #dsarw102#2  = #dsarm073#5;
     #dsarw102#3  = #dsarm073#6;
     #dsarw102#4  = #dsarm073#7;
     #dsarw102#5  = #dsarm073#8;
     #dsarw102#6  = #dsarm073#9;

     |PINPA #0#dsarw102;
     |PINDA #0#dsarw102;
     |ENDATOS #1#dsarw102;
     |SI FSalida = 0;
         #dsarm073#3  = #dsarw102#0;
         #dsarm073#4  = #dsarw102#1;
         #dsarm073#5  = #dsarw102#2;
         #dsarm073#6  = #dsarw102#3;
         #dsarm073#7  = #dsarw102#4;
         #dsarm073#8  = #dsarw102#5;
         #dsarm073#9  = #dsarw102#6;
     |FINSI;

     |GRABA 020#dsarm073.a;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;
|FPRC;

|PROCESO Nuevo;
     nID      = -1;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 24;
     aPopup3  = "909/01     BALANCE DE SITUACION";
     aPopup4  = "909/02     CUENTA PERDIDAS Y GANANCIAS";
     aPopup5  = "909/03     ESTADO DE INGRESOS Y GASTOS RECONOCIDOS";
     aPopup6  = "909/04     E.C.P.N.";
     aPopup7  = "909/05     E.F.E.";
     aPopup8  = "909/06     BALANCE DE SUMAS Y SALDOS";
     aPopup9  = "908/01     LIBRO DIARIO";
     aPopup10 = "901/01     LIBRO DE IVA REPERCUTIDO";
     aPopup11 = "902/01     LIBRO DE IVA SOPORTADO";
     aPopup12 = "910/01     LIBRO DE VENTAS E INGRESOS";
     aPopup13 = "911/01     LIBRO DE COMPRAS Y GASTOS";
     aPopup14 = "950/01     MAYORES / EXTRACTOS";
     aPopup15 = "950/02     ANOTACIONES DE REVISION CONTABLE";
     aPopup16 = "950/03     INFORMES AGRUPADOS";
     aPopup17 = "951/01     LEGALIZACION LIBROS CONTABLES";
     aPopup18 = "951/02     LEGALIZACION CCAA";
     aPopup19 = "952/01     CERTIFICADO MODELO 180";
     aPopup20 = "952/02     CERTIFICADO MODELO 184";
     aPopup21 = "952/03     CERTIFICADO MODELO 190 (TRABAJADORES)";
     aPopup22 = "952/04     CERTIFICADO MODELO 190 (ACT.ECONOMICAS)";
     aPopup23 = "952/05     CERTIFICADO MODELO 190 (PREMIOS)";
     aPopup24 = "952/06     CERTIFICADO MODELO 190 (DERECHOS IMAGEN)";
     aPopup25 = "952/07     CERTIFICADO MODELO 190 (APRO.FORESTALES)";
     aPopup26 = "952/08     CERTIFICADO MODELO 193";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     IaPopup  = aPopup3  <-;
     IaPopup  = IaPopup + (FSalida - 1);

     aAlfa1 = aPopup % 103;
     aAlfa2 = aPopup % 506; |QBF aAlfa2;
     aAlfa3 = aPopup % 1240;

     #dsarm073#0 = aAlfa1;
     #dsarm073#1 = aAlfa2;
     |LEE 000#dsarm073.=;
     |SI FSalida = 0;
         |MENAV "0000El modelo ya est  introducido.";
         |ACABA;
     |FINSI;

     aAlfa4 = "003";
     aAlfa5 = "003";
     aAlfa6 = "001";
     |SI aAlfa1 = "908";
         aAlfa5 = "004";
     |FINSI;

     |SI aAlfa1 = "901"; |O aAlfa1 = "902";
         aAlfa5 = "004";
         aAlfa6 = "003";
     |FINSI;

     |SI aAlfa1 = "910"; |O aAlfa1 = "911";
         aAlfa5 = "004";
         aAlfa6 = "008";
     |FINSI;

     |SI aAlfa1 = "950";
         aAlfa6 = "003";
         |SI aAlfa2 = "01";
             aAlfa6 = "002";
         |FINSI;
     |FINSI;

     |SI aAlfa1 = "951"; aAlfa5 = "006";  aAlfa6 = "0" + aAlfa2; |FINSI;

     |SI aAlfa1 = "952";
         aAlfa4 = "002";
         aAlfa5 = "002";
         aAlfa6 = "001";

         |SI aAlfa2 = "01"; aAlfa6 = "003"; |FINSI;
         |SI aAlfa2 = "02"; aAlfa6 = "005"; |FINSI;
         |SI aAlfa2 = "08"; aAlfa6 = "004"; |FINSI;
     |FINSI;

     |DDEFECTO #dsarm073;
     #dsarm073#0 = aAlfa1;
     #dsarm073#1 = aAlfa2;
     #dsarm073#2 = aAlfa3;
     #dsarm073#3 = aAlfa4;
     #dsarm073#4 = aAlfa5;
     #dsarm073#5 = aAlfa6;
     #dsarm073#9 = " ";
     |ABRE #dsarm002;
     |ABRE #dsarm003;
     |ABRE #dsarm004;
     |HAZ LeeDescripcion;
     |CIERRA #dsarm004;
     |CIERRA #dsarm003;
     |CIERRA #dsarm002;
     |GRABA 020#dsarm073.b;

     |HAZ ControlaModelo;
     |HAZ EntraDatos;

     |LIBERA #dsarm073;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Modificar;
     |LEE 101#dsarm073.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ EntraDatos;

     |LIBERA #dsarm073;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Borrar;
     |CONFI "0000NSeguro que quiere borrar el modelo";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#dsarm073.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BORRA 020#dsarm073.a;
     |LIBERA #dsarm073;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO EventoGrid;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsarm073.=;

         |ESTADO_CONTROL nBtn2, "DISABLE";
         |ESTADO_CONTROL nBtn3, "DISABLE";

         |SI #dsarw118#0 = "S";
             |ESTADO_CONTROL nBtn2, "ENABLE";
             |ESTADO_CONTROL nBtn3, "ENABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
         |HAZ Modificar;
     |FINSI;
|FPRC;

|PROGRAMA;
     |DBASS aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "basica/def/agitab99.mas";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida < 0;
          aAlfa = "    ERROR EN CARGA_DEF: No encuentro aplicaci¢n ipmodelo";
          |MENAV aAlfa;
          |ACABA;
     |FINSI;

     #dsarw118#0  = #dsarm001#225;
     #dsarw118#1  = #dsarm001#226;

     |PINPA #0#dsarw118;    nPanta = FSalida;
     |PINDA #0#dsarw118;

     nRango = 2 + 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#dsarm073, nRango, 0802, 1998, NULL, NULL, EventoGrid;
     nGrid = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{193}}Borrar modelo", 2085, 2098, Borrar;
     nBtn3 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Modificar modelo", 2065, 2083, Modificar;
     nBtn2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{199}}Nuevo modelo", 2050, 2063, Nuevo;
     nBtn1 = FSalida;

     |ESTADO_CONTROL nBtn2, "DISABLE";
     |ESTADO_CONTROL nBtn3, "DISABLE";

     |HAZ Tipo0C0Fw118;

     |ENDATOS #1#dsarw118;
     |SI FSalida = 0;
         #dsarm001#225 = #dsarw118#0;
         #dsarm001#226 = #dsarw118#1;

         |GRABA 020#dsarm001.a;
     |FINSI;
     |LIBERA #dsarm001;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     |ABRE #dsarm073;
     |ABRE #dsarm001;
     |LEE 101#dsarm001.p;
     |SI FSalida ! 0;
         |DDEFECTO #dsarm001;
         |GRABA 020#dsarm001.b;
     |FINSI;

     |SI #dsarm001#225 = "S";
         |LEE 000#dsarm073.p;
         |SI FSalida ! 0;
              |HAZ GrabaFijos;
              |LEE 000#dsarm073.p;
         |FINSI;
     |FINSI;

     FSalida = 2799;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |CIERRA #dsarm001;
     |CIERRA #dsarm073;
|FPRC;
