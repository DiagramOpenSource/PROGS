|FICHEROS;
     dsarm001;
     dsarm005;
     dsarw047;
     dsarw121;
|FIN;

|INCLUYE z1000var;

|PROCESO LeeContenido;
     eaContenido = "";
     enError     = 1;

     #dsarw047#0 = enLinea;
     |LEE 000#dsarw047.=;
     |SI FSalida = 0;
         eaContenido = #dsarw047#1;  |QBF eaContenido;
         enError     = 0;
     |FINSI;
|FPRC;

|PROCESO VerDocu;
     |SI #dsarm001#7 = "N";
          |HAZ DimeUnidad;
     |SINO;
          |HAZ LeeUnidadBasico;

          eaUnidad = eaUnidadBasico % 101;
     |FINSI;

     |DBASE aPathBase;
     |QBF aPathBase;

     eaDestino = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "dsabreextension.exe";
     eaOrigen = aPathBase + "dlls/dsabreextension.exe";
     |HAZ EnviaFicheroConMD5;

     aAlfa = eaRuta + "/" + #dsarw121#1;  |QBF aAlfa;

     |XABRE "EC", aAlfa, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aEjecuta = "START " + eaUnidad + ":\DOCUMENTOS\DSARCHI\dsabreextension ";
     aEjecuta = aEjecuta + aAlfa;
     aEjecuta = aEjecuta + " " + eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";

     aAlfa  = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";
     |RFBORRA aAlfa;

     |RSYSTEM aEjecuta;
     aAlfa  = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";
     |PARA;  |SI;  |HACIENDO;
             |XABRE "EC", aAlfa, nHandle;
             |SI FSalida ] 0;
                 |SAL;
             |FINSI;

             |PARA nPausa = 1; |SI nPausa < 10000; |HACIENDO nPausa = nPausa + 1;
             |SIGUE;
             |PULSATECLA;
     |SIGUE;
     |PULSATECLA;

     aAlfa  = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";
     |RFBORRA aAlfa;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO VerDocuTXT;
     |SI #dsarm001#7 = "N";
          |HAZ DimeUnidad;
     |SINO;
          |HAZ LeeUnidadBasico;

          eaUnidad = eaUnidadBasico % 101;
     |FINSI;

     |DBASE aPathBase;
     |QBF aPathBase;

     eaDestino = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "dsabreextension.exe";
     eaOrigen = aPathBase + "dlls/dsabreextension.exe";
     |HAZ EnviaFicheroConMD5;

     aAlfa = eaRuta + "/" + #dsarw121#1;  |QBF aAlfa;
     aAlfa = aAlfa < " ";
     aAlfa = aAlfa - ".pdf" + ".txt";

     |XABRE "EC", aAlfa, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aEjecuta = "START " + eaUnidad + ":\DOCUMENTOS\DSARCHI\dsabreextension ";
     aEjecuta = aEjecuta + aAlfa;
     aEjecuta = aEjecuta + " " + eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";

     aAlfa  = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";
     |RFBORRA aAlfa;

     |RSYSTEM aEjecuta;
     aAlfa  = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";
     |PARA;  |SI;  |HACIENDO;
             |XABRE "EC", aAlfa, nHandle;
             |SI FSalida ] 0;
                 |SAL;
             |FINSI;

             |PARA nPausa = 1; |SI nPausa < 10000; |HACIENDO nPausa = nPausa + 1;
             |SIGUE;
             |PULSATECLA;
     |SIGUE;
     |PULSATECLA;

     aAlfa  = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";
     |RFBORRA aAlfa;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO dsarm005F;
     aOrigen  = #dsarm005#7;  |QBF aOrigen;
     aOrigen  = aOrigen + #dsarm005#9;  |QBF aOrigen;
     aDestino = aFichero;

     |SI #dsarm001#7 = "N";
         aContiene1 = aDestino;
         |ESPECIFICA "REMOTOMD5", aContiene;
         aDocRemoto = FSalida;  |QBF aDocRemoto;

         aContiene1 = aOrigen;
         |ESPECIFICA "MD5", aContiene;
         aDocServidor = FSalida;  |QBF aDocServidor;

         |SI aDocRemoto = aDocServidor;
             nEsta = 1;
             |ERROR10;
         |FINSI;
     |SINO;
          aContiene1 = aDestino;
          |ESPECIFICA "REMOTOMD5", aContiene;
          aDocRemoto = FSalida;  |QBF aDocRemoto;

          aContiene1 = aOrigen;
          |ESPECIFICA "REMOTOMD5", aContiene;
          aDocServidor = FSalida;  |QBF aDocServidor;

          |SI aDocRemoto = aDocServidor;
              nEsta = 1;
              |ERROR10;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm005F;
     #dsarm005#16;
     ;
     eaFicRes,         1;
     eaFicRes, 999999999;
     ;
     NULL, dsarm005F;
|FIN;

|PROCESO PonColor;
     aColor   = "";
     nEsta    = 0;
     eaFicRes = #dsarw121#1;  |QBF eaFicRes;
     aFichero = eaRuta + "\" + #dsarw121#1;  |QBF aFichero;

     |SI #dsarw121#21 = "*";
         aColor = eaAzul;
     |FINSI;

     |SI aColor = "";
         |BUCLE dsarm005F;
         |SI nEsta = 1;  aColor = eaVerde;  |FINSI;
     |FINSI;

     |SI aColor = "";
         |SI #dsarw121#16 = 0;
          |O #dsarw121#19 = 0;
          |O #dsarw121#8  = 0;
          |O #dsarw121#9  = 0;
          |O #dsarw121#10 = 0;
          |O #dsarw121#14 = 0;
          |O #dsarw121#15 = 0;
             aColor = eaRojo;
         |FINSI;
     |FINSI;

     #dsarw121#22 = aColor;
|FPRC;

|PROCESO QuitaBlan;
     |QBF eaContenido;
     aLong  = eaContenido % 0;
     nLong  = aLong;
     eaAlfa = "";
     nLoc   = 0;

     |PARA nCar = 1;  |SI nCar [ nLong;  |HACIENDO nCar = nCar + 1;
           nPos = (nCar * 100) + 1
           aCar = eaContenido % nPos;

           |SI aCar ! " ";
               nLoc = 1;
           |FINSI;

           |SI aCar = "Ó";
               aCar = "O";
           |FINSI;

           |SI nLoc = 1;
               eaAlfa = eaAlfa + aCar;
           |FINSI;
     |SIGUE;

     eaContenido = eaAlfa;
|FPRC;

|PROCESO SeparaGuion;
     |QBF eaContenido;
     aLong   = eaContenido % 0;
     nLong   = aLong;
     eaAlfa1 = "";
     eaAlfa2 = "";
     nLoc    = 0;

     |PARA nCar = 1;  |SI nCar [ nLong;  |HACIENDO nCar = nCar + 1;
           nPos = (nCar * 100) + 1
           aCar = eaContenido % nPos;

           |SI aCar = "-";
               nLoc = 1;
           |FINSI;

           |SI aCar = "ó";
               aCar = "¢";
           |FINSI;

           |SI nLoc = 0;
               eaAlfa1 = eaAlfa1 + aCar;
           |FINSI;

           |SI nLoc = 1;
               |SI aCar ! "-";
                   eaAlfa2 = eaAlfa2 + aCar;
               |FINSI;
           |FINSI;
     |SIGUE;
|FPRC;
