||Da un extranyo error si se compila ella sola, pero si se compila
||toda dsarchi, no da absolutamente ningun error

|FICHEROS;
     flowm006 #606;

     dsarw008 #908;
|FIN;

|VARIABLES;
     aTexto = "";
     aAuxTexto = "";
     aMensaje = "";
     nVentana     = 0;
     nRango       = 0;
     nGrid606     = 0;
     nIde         = 0;
     nCampo1      = 0;
     nCampo2      = 0;
     nPanta0      = 0;
     nBoton1      = 0;
     nBoton2      = 0;
     nBoton3      = 0;

     aEsc1        = "";
     aEsc2        = "";
     aRetu        = "";
     aTecla       = "";
     aAlfa        = "";
     aHora        = "";
     aUsuario     = "";

   {-1}aVent      = "";
       aVent1     = 0;
       aVent2     = 0;
       aVent3     = 0;
       aVent4     = 0;
       aVent5     = "";

     &enDocumento = 0;

     aNombreHisto = "";
     &eaDestino = "";
     nHandle = 0;
     aEjecuta = "";
     &eaUnidad = "";
     aPathBase = "";
     &eaOrigen = "";
     aIPRemoto = "";
     nVentw6 = 0;
|FIN;

|PROCESO Baja606;
     #606#0 = enDocumento;
     #606#1 = 00001;
|FPRC;

|PROCESO Alta606;
     #606#0 = enDocumento;
     #606#1 = 99999;
|FPRC;

|PROCESO PresentaDocumento;
     |XABRE "EC", eaDestino, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aEjecuta = "START " + eaUnidad + ":\DOCUMENTOS\DSARCHI\dsabreextension ";
     aEjecuta = aEjecuta + eaDestino;
     aEjecuta = aEjecuta + " " + eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";

     aAlfa  = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";
     |RFBORRA aAlfa;

     |RSYSTEM aEjecuta;
|FPRC;

|PROCESO MostrarHistoricoFACE;
     |HAZ DimeUnidad;
     |DBASE aPathBase;
     |QBF aPathBase;

     eaOrigen = aPathBase + "dlls/dsabreextension.exe";
     eaDestino = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "dsabreextension.exe";
     |HAZ EnviaFicheroConMD5;


     aNombreHisto = ("000000000" + #flowm006#0) % -109;
     aNombreHisto = aNombreHisto + ".txt";
     eaOrigen = aPathBase + "face/" + aNombreHisto;
     eaDestino = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + aNombreHisto;

     aIPRemoto   = "";
     |IP_REMOTO aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO eaOrigen, eaDestino;
     |SINO;
         |COPIA_FICHERO eaOrigen, eaDestino;
     |FINSI;

     |SI aIPRemoto = "";
         |XABRE "E", eaDestino, nHandle;
     |SINO;
         |XABRE "EC", eaDestino, nHandle;
     |FINSI;

     |SI FSalida < 0;
         aMensaje = "0000No puedo localizar el documento.";
         |MENAV aMensaje;
         |ACABA;
     |FINSI;

     |VENTANA 0501, 2999, -1, 16, "Visualizando Documento";
     nVentw6  = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentw6;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#908;
     |PINDA #0#908;
     |PTEC 802;
     |PAUSA;

     |HAZ PresentaDocumento;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentw6;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentw6;
|FPRC;

|PROCESO Evento606;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#606=;
     |FINSI;

     |SI FSalida = 4;
          aTexto = #606#6;
          |QBF aTexto;
          aAuxTexto = aTexto - "Factura a WS FACE";
          |SI aTexto ! aAuxTexto;
               |HAZ MostrarHistoricoFACE;
          |FINSI;
     |FINSI;
|FPRC;

|PROGRAMA;
     aUsuario = Usuario % 810;

     aAlfa = "Hist¢rico documento: " + enDocumento;
     |VENTANA 0501, 3299, -1, 16, aAlfa;
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #606;
     nRango     = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#606, nRango, 0502, 3098, Baja606, Alta606, Evento606;
     nGrid606 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::Salir," + nGrid606;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |CIERRA #606;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;
|FPRO;
