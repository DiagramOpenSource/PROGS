|FICHEROS;
     dsary002;

     dsarm001;
     dsarm004;
     dsarm005;
     dsarm059;
     dsarm110;

     :basica/agiusuar;
     :integral/dsam0108;
|FIN;

|VARIABLES;
     aBase             =  "";
     aColor            =  "";
     aRojo             =  "";
     aAlfa             =  "";
     aAlfa1            =  "";
     aAlfa2            =  "";
     aEsc1             =  "";
     aEsc2             =  "";
     aRetu             =  "";
     aTecla            =  "";
     aContenido        =  "";
     aDescri           =  "";
     aID               =  "";
     aRuta             =  "";
     aLong             =  "";
     aPathOri          = "";
     aPathDes          = "";
     aPathFic          = "";
     aNomFic           = "";
     aAbre             = "";
     aIPRemoto         = "";
     aOrigen           = "";
     aDestino          = "";
     aFicTar           = "";
     aFicTgz           = "";

     n1Vent            = 0;
     nBtnExcl          = -1;
     nBtnCarp          = -1;
     nGrid             = 0;
     nRango            = 0;
     nHay              = 0;
     nPasada           = 0;
     nCpF              = 0;
     nCpD              = 0;
     nID               = 0;
     nPan              = 0;
     nCarac            = 0;
     nPos              = 0;
     nError            = 0;
     nLong             = 0;

     fFecha            = @;

     {-1}aVent         = "";
         aVent1        = 0;
         aVent2        = 0;
         aVent3        = 0;
         aVent4        = 0;
         aVent5        = "";

     &eaValor1         = "";
     &eaValor2         = "";
     &eaValor3         = "";
     &eaValor4         = "";
     &eaValor5         = "";
|FIN;

|PROCESO PonEti;
     aDescri    = "";
     aContenido = #dsarm005#nCpF#;  |QBF aContenido;

     |SI nCpF = 11;  |ACABA;  |FINSI;
     |SI nCpF = 12;  |ACABA;  |FINSI;
     |SI nCpF = 13;  |ACABA;  |FINSI;
     |SI nCpF = 23;  |ACABA;  |FINSI;
     |SI nCpF = 24;  |ACABA;  |FINSI;
     |SI nCpF = 25;  |ACABA;  |FINSI;
     |SI nCpF = 26;  |ACABA;  |FINSI;
     |SI nCpF = 27;  |ACABA;  |FINSI;
     |SI nCpF = 28;  |ACABA;  |FINSI;
     |SI nCpF = 29;  |ACABA;  |FINSI;
     |SI nCpF = 30;  |ACABA;  |FINSI;
     |SI nCpF = 31;  |ACABA;  |FINSI;
     |SI nCpF = 32;  |ACABA;  |FINSI;
     |SI nCpF = 33;  |ACABA;  |FINSI;
     |SI nCpF = 34;  |ACABA;  |FINSI;
     |SI nCpF = 35;  |ACABA;  |FINSI;
     |SI nCpF = 36;  |ACABA;  |FINSI;
     |SI nCpF = 37;  |ACABA;  |FINSI;
     |SI nCpF = 41;  |ACABA;  |FINSI;
     |SI nCpF = 42;  |ACABA;  |FINSI;
     |SI nCpF = 43;  |ACABA;  |FINSI;
     |SI nCpF = 49;  |ACABA;  |FINSI;
     |SI nCpF = 50;  |ACABA;  |FINSI;
     |SI nCpF = 51;  |ACABA;  |FINSI;
     |SI nCpF = 52;  |ACABA;  |FINSI;
     |SI nCpF = 53;  |ACABA;  |FINSI;
     |SI nCpF = 54;  |ACABA;  |FINSI;
     |SI nCpF = 55;  |ACABA;  |FINSI;
     |SI nCpF = 56;  |ACABA;  |FINSI;
     |SI nCpF = 57;  |ACABA;  |FINSI;
     |SI nCpF = 58;  |ACABA;  |FINSI;
     |SI nCpF = 59;  |ACABA;  |FINSI;
     |SI nCpF = 60;  |ACABA;  |FINSI;
     |SI nCpF = 61;  |ACABA;  |FINSI;
     |SI nCpF = 62;  |ACABA;  |FINSI;
     |SI nCpF = 63;  |ACABA;  |FINSI;
     |SI nCpF = 64;  |ACABA;  |FINSI;
     |SI nCpF = 65;  |ACABA;  |FINSI;
     |SI nCpF = 97;  |ACABA;  |FINSI;
     |SI nCpF = 98;  |ACABA;  |FINSI;

     aDescri = #dsarm059#nCpD#;  |QBF aDescri;
|FPRC;

|PROCESO UnValor;
     nCpF = #dsarm059#2; nCpD = 3; |HAZ PonEti;  eaValor1 = aDescri + " " + aContenido;
|FPRC;

|PROCESO DosValores;
     nCpF = #dsarm059#2; nCpD = 3; |HAZ PonEti;  eaValor1 = aDescri + " " + aContenido + " / ";
     nCpF = #dsarm059#4; nCpD = 5; |HAZ PonEti;  eaValor2 = aDescri + " " + #dsarm005#nCpF#;
|FPRC;

|PROCESO TresValores;
     nCpF = #dsarm059#2; nCpD = 3; |HAZ PonEti;  eaValor1 = aDescri + " " + aContenido + " / ";
     nCpF = #dsarm059#4; nCpD = 5; |HAZ PonEti;  eaValor2 = aDescri + " " + aContenido + " / ";
     nCpF = #dsarm059#6; nCpD = 7; |HAZ PonEti;  eaValor3 = aDescri + " " + #dsarm005#nCpF#;
|FPRC;

|PROCESO CuatroValores;
     nCpF = #dsarm059#2; nCpD = 3; |HAZ PonEti;  eaValor1 = aDescri + " " + aContenido + " / ";
     nCpF = #dsarm059#4; nCpD = 5; |HAZ PonEti;  eaValor2 = aDescri + " " + aContenido + " / ";
     nCpF = #dsarm059#6; nCpD = 7; |HAZ PonEti;  eaValor3 = aDescri + " " + aContenido + " / ";
     nCpF = #dsarm059#8; nCpD = 9; |HAZ PonEti;  eaValor4 = aDescri + " " + #dsarm005#nCpF#;
|FPRC;

|PROCESO CincoValores;
     nCpF = #dsarm059#2;  nCpD = 3; |HAZ PonEti;  eaValor1 = aDescri + " " + aContenido + " / ";
     nCpF = #dsarm059#4;  nCpD = 5; |HAZ PonEti;  eaValor2 = aDescri + " " + aContenido + " / ";
     nCpF = #dsarm059#6;  nCpD = 7; |HAZ PonEti;  eaValor3 = aDescri + " " + aContenido + " / ";
     nCpF = #dsarm059#8;  nCpD = 9; |HAZ PonEti;  eaValor5 = aDescri + " " + aContenido + " / ";
     nCpF = #dsarm059#10; nCpD = 11; |HAZ PonEti;  eaValor5 = aDescri + " " + #dsarm005#nCpF#;
|FPRC;

|PROCESO CopiaDocumento;
     aAbre = aPathOri + aNomFic;

     |SI #dsarm001#7 = "N";  |Y aIPRemoto ! "";
         |XABRE "E", aAbre, 0;
     |SINO;
         |XABRE "EC", aAbre, 0;
     |FINSI;

     |SI FSalida ] 0;
         aOrigen  = aPathOri + aNomFic;
         aDestino = aPathDes + aNomFic;
         |SI #dsarm001#7 = "N";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |RCOPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsarm005;
     #dsarm110#0 = #dsarm005#1;
     #dsarm110#1 = #dsarm005#2;
     #dsarm110#2 = #dsarm005#3;
     |LEE 000#dsarm110.=;
     |SI FSalida = 0;
         aAlfa = #dsarm110#4;  |QBF aAlfa;
         |SI aAlfa = aRojo;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI nPasada = 0;
         nHay = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     #dsarm004#0 = #dsarm005#1;
     #dsarm004#1 = #dsarm005#2;
     #dsarm004#2 = #dsarm005#3;
     |LEE 000#dsarm004.=;
     |SI FSalida ! 0;  |DDEFECTO #dsarm004;  |FINSI;

     aAlfa = #dsarm004#90;  |QBF aAlfa;
     |SI aAlfa = "";
         aAlfa = #dsary002#22;  |QBF aAlfa;
     |FINSI;

     #dsarm059#0 = aAlfa;
     |LEE 000#dsarm059.=;
     |SI FSalida ! 0;  |DDEFECTO #dsarm059;  |FINSI;

     eaValor1 = "";
     eaValor2 = "";
     eaValor3 = "";
     eaValor4 = "";
     eaValor5 = "";

     |SI #dsarm059#1 = "1";  |HAZ UnValor;       |FINSI;
     |SI #dsarm059#1 = "2";  |HAZ DosValores;    |FINSI;
     |SI #dsarm059#1 = "3";  |HAZ TresValores;   |FINSI;
     |SI #dsarm059#1 = "4";  |HAZ CuatroValores; |FINSI;
     |SI #dsarm059#1 = "5";  |HAZ CincoValores;  |FINSI;

     |PRINT;

     |SI #dsary002#23 = "N";  |ACABA;  |FINSI;

     aPathOri = #dsarm005#7;   |QBF aPathOri;
     aPathDes = #dsary002#24;  |QBF aPathDes;

     aNomFic  = #dsarm005#9;  |QBF aNomFic;

     |SI aNomFic = "-DOCUMENTOWEB-";  |ACABA;  |FINSI;

     |HAZ CopiaDocumento;

     aNomFic = #dsarm005#92;  |QBF aNomFic;
     |SI aNomFic ! "";
         |HAZ CopiaDocumento;
     |FINSI;

     aNomFic  = #dsarm005#96;  |QBF aNomFic;
     |SI aNomFic ! "";
         |HAZ CopiaDocumento;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm005;
     #dsarm005#3;
     ;
     #dsary002#0, "01.01.0000", "     ", 000000001;
     #dsary002#0, "31.12.9999", "zzzzz", 999999999;
     ;
     NULL, dsarm005;
|FIN;

|PROCESO Tipo12;  |TIPO 12;
     |SI FSalida = 7;  |ACABA;  |FINSI;

     aIPRemoto   = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     aAlfa = #dsary002#7;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000Introduzca contenido en Texto";
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa = #dsary002#22;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000Introduzca contenido en Campos detalle por defecto";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #dsary002#23 = "S";
         aAlfa = #dsary002#24;  |QBF aAlfa;
         |SI aAlfa = "";
             |MENAV "0000Seleccione la carpeta donde alojar el comprimido.";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida ! 0;
         |MENAV "0000 No tiene instalada Impresora CrystalReport, pongase en contacto con su Administrador";
         |ACABA;
     |FINSI;

     |INFOR "dsary002";
     |SI FSalida ! 0;
         |FINIMP;
         |ACABA;
     |FINSI;

     |VENTANA 0501, 0540, -1, 16, "Procesando trabajo";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     nPasada = 1;  |BUCLE dsarm005;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |PIEINF;
     |FININF;
     |FINIMP;

     |SI #dsary002#23 = "N";  |ACABA;  |FINSI;

     aPathDes = #dsary002#24;  |QBF aPathDes;

     fFecha   = ~;
     aNomFic  = ("00000" + #dsary002#0) % -105;
     aNomFic  = aNomFic + "_" + (fFecha % -104) + (fFecha % 402) + (fFecha % 102);
     aFicTar  = aNomFic + ".tar";
     aFicTgz  = aNomFic + ".tgz";

     aPathFic = aPathDes + aNomFic;  |RMKDIR aPathFic;
     aPathFic = aPathFic + "\";

     aAlfa = aPathFic + aFicTar + " *.*";
     |RATAR aAlfa, aPathDes;

     aAlfa = aPathFic + aFicTar;
     |RCOMPRIME aAlfa;

     aAlfa = aPathFic + aFicTar;
     |RFBORRA aAlfa;

     aAlfa = aPathDes + "*.*";
     |R_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          aAlfa1 = aAlfa - aNomFic;
          |SI FSalida = 0;
              |RFBORRA aAlfa;
          |FINSI;

          |R_SDIR aAlfa;
     |SIGUE;
|FPRC;

|PROCESO Tipo0C23;  |TIPO 0;
     |SI #dsary002#23 = "S";
         |ESTADO_CONTROL nBtnCarp, "ENABLE";
     |SINO;
         |ESTADO_CONTROL nBtnCarp, "DISABLE";

         #dsary002#24 = "";  |PINTA #dsary002#24;
     |FINSI;
|FPRC;

|PROCESO Tipo0C7;  |TIPO 0;
     |PINTA #dsary002#8;
|FPRC;

|PROCESO Tipo0C4;  |TIPO 0;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, 0;
     |SI FSalida = 0;
         |ABRE #dsam0108;
         #dsam0108#0 = #dsary002#4;
         |LEE 000#dsam0108.=;
         |SI FSalida ! 0;  |DDEFECTO #dsam0108;  |FINSI;
         |CIERRA #dsam0108;

         #dsary002#5 = #dsam0108#1;
     |SINO;
         |ABRE #agiusuar;
         #agiusuar#0 = #dsary002#4;
         |LEE 000#agiusuar.=;
         |SI FSalida ! 0;  |DDEFECTO #agiusuar;  |FINSI;
         |CIERRA #agiusuar;

         #dsary002#5 = #agiusuar#1;
     |FINSI;

     |PINTA #dsary002#5;
|FPRC;

|PROCESO dsarm004;
     aColor      = aRojo;
     #dsarm110#0 = #dsarm004#0;
     #dsarm110#1 = #dsarm004#1;
     #dsarm110#2 = #dsarm004#2;
     |LEE 000#dsarm110.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsarm110;
         #dsarm110#0 = #dsarm004#0;
         #dsarm110#1 = #dsarm004#1;
         #dsarm110#2 = #dsarm004#2;
         |GRABA 020#dsarm110.b;
     |FINSI;

     aAlfa = #dsarm110#4;  |QBF aAlfa;
     |SI aAlfa = "";
         aColor = "";
     |FINSI;

     #dsarm110#0 = #dsarm004#0;
     #dsarm110#1 = #dsarm004#1;
     #dsarm110#2 = #dsarm004#2;
     #dsarm110#3 = #dsarm004#3;
     #dsarm110#4 = aColor;
     |GRABA 020#dsarm110.a;
     |LIBERA #dsarm110;
|FPRC;

|DEFBUCLE dsarm004;
     #dsarm004#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsarm004;
|FIN;

|PROCESO dsarm110B;
     aAlfa = #dsarm110#4;  |QBF aAlfa;
     |SI aAlfa ! "";  |ACABA;  |FINSI;

     |BORRA 020#dsarm110.a;
     |LIBERA #dsarm110;
|FPRC;

|DEFBUCLE dsarm110B;
     #dsarm110#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsarm110B;
|FIN;

|PROCESO Evnt110;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsarm110.=;
     |FINSI;

     |SI FSalida = 4;
         |LEE 101#dsarm110.=;

         aAlfa = #dsarm110#4;  |QBF aAlfa;
         |SI aAlfa ! "";
             #dsarm110#4 = "";
         |SINO;
             #dsarm110#4 = aRojo;
         |FINSI;
         |GRABA 020#dsarm110.a;
         |LIBERA #dsarm110;

         |REFRESCACONTROL nGrid;

         FSalida = "SKIPDEFAULT";
     |FINSI;
|FPRC;

|PROCESO Excluir;
     |VENTANA 0501, 0540, -1, 16, "Procesando trabajo";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |BUCLE dsarm004;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |VENTANA 0501, 2960, -1, 16, "ROJO - DOCUMENTOS EXCLUIDOS";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |CONTROL_SIMPLE 0, "LABEL,{{1}}Doble click en la l¡nea para incluir o excluir el registro seleccionado", 0502, 0558, NULL;

     nRango  = 2 + 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#dsarm110, nRango, 0601, 2758, NULL, NULL, Evnt110;
     nGrid = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |BUCLE dsarm110B;
|FPRC;

|PROCESO Carpeta;
     aRuta  = "D ";
     |BROWSE aRuta;

     aAlfa  = aRuta;   |QBF aAlfa;
     aRuta  = "";
     aLong  = aAlfa % 0;
     nLong  = aLong;
     |PARA nCarac = 2;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos = (nCarac * 100) + 1;
           aRuta = aRuta + (aAlfa % nPos);
     |SIGUE;

     |SI aRuta = "";
         |MENAV "0000No ha seleccionado un directorio.";
         nError = 1;
         |ACABA;
     |FINSI;

     aRuta = aRuta + "\";

     aAlfa = aRuta + "*.*";
     |R_PDIR aAlfa;
     |SI FSalida = 0;
         |MENAV "0000La carpeta debe estar vac¡a.";
         |ACABA;
     |FINSI;

     #dsary002#24 = aRuta;  |PINTA #dsary002#24;
|FPRC;

|PROCESO Tipo0C0;  |TIPO 0;
     |VENTANA 0501, 0540, -1, 16, "Procesando trabajo";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     nHay = 0;  nPasada = 0;  |BUCLE dsarm005;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |SI nHay = 0;
         |MENAV "0000Cliente sin documentos a emitir.";
         |ERROR;
     |FINSI;
|FPRC;

|PROGRAMA;
     |DDEFECTO #dsary002;

     |PINPA #0#dsary002;  nPan = FSalida;
     |PINDA #0#dsary002;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Tipos de documentos a excluir", 3102, 3130, Excluir;
     nBtnExcl = FSalida;

     |CONTROL_SIMPLE nPan, "BOTON,{{136}}", 1490, 1492, Carpeta;
     nBtnCarp = FSalida;

     |ENDATOS #1#dsary002;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     aRojo = "255,80,80;255,255,255";

     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, 0;
     |SI FSalida ] 0;
         |MODO_RELACION #dsary002, 1, "agiusuar", "N", "N";
         |MODO_RELACION #dsary002, 1, "agiusuar", "X", "X";
         |MODO_RELACION #dsary002, 0, "dsam0108", "X", "X";
         |MODO_RELACION #dsary002, 1, "dsam0108", "N", "S";
     |SINO;
         |MODO_RELACION #dsary002, 1, "dsam0108", "N", "N";
         |MODO_RELACION #dsary002, 1, "dsam0108", "X", "X";
         |MODO_RELACION #dsary002, 0, "agiusuar", "X", "X";
         |MODO_RELACION #dsary002, 1, "agiusuar", "N", "S";
     |FINSI;

     |ABRE #dsarm001;
     |LEE 000#dsarm001.p;
     |CIERRA #dsarm001;

     |ABRET #dsarm004;
     |ABRET #dsarm059;
     |ABRET #dsarm110;

     FSalida = 3199;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |CIERRAT #dsarm004;
     |CIERRAT #dsarm059;
     |CIERRAT #dsarm110;
|FPRC;
