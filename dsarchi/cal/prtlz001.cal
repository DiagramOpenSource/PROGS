|FICHEROS;
     prtlm000;
     prtlm001;
     prtlm003;

     prtla001@;
|FIN;

|VARIABLES;
     nOk                 = 0;
     nCmp                = 0;
     nCmp1               = 0;
     nCmp3               = 0;
     nUlt                = 0;
     nAny                = 0;

     aFic                = "";
     aFicD               = "";
     aOr                 = "";
     aDe                 = "";
     aAbre               = "";
     aBase               = "";
     aDef                = "";
     aMas                = "";
     aHora               = "";
     aAlfa               = "";
     aVerde              = "0,185,0;255,255,255";
|FIN;

|PROCESO Copia;
     |DFICE aFic;
     aOr = aFic + "prtlm001.dat";
     |XABRE "E", aOr, 0;
     |SI FSalida < 0;
         |ACABA;
     |FINSI;

     aOr = aFic + "prtlm001.dat";
     aDe = aFic + "prtla001.dat";
     |COPIA_FICHERO aOr, aDe;

     aOr = aFic + "prtlm001.ddx";
     aDe = aFic + "prtla001.ddx";
     |COPIA_FICHERO aOr, aDe;

     aOr = aFic + "prtlm001.ixx";
     aDe = aFic + "prtla001.ixx";
     |COPIA_FICHERO aOr, aDe;
|FPRC;

|PROCESO prtlm001;
      #prtla001@#0  = #prtlm001#0;
      #prtla001@#1  = #prtlm001#1;
      #prtla001@#2  = #prtlm001#2;
      #prtla001@#3  = #prtlm001#3;
      #prtla001@#4  = #prtlm001#4;
      |LEE 000#prtla001@.=;
      |SI FSalida ! 0;  |DDEFECTO #prtla001@;  |FINSI;

      nOk = 0;
      |PARA nCmp = 0;  |SI nCmp [ 16;  |HACIENDO nCmp = nCmp + 1;
            |SI #prtla001@#nCmp# ! #prtlm001#nCmp#;
                nOk = 1;
                |SAL;
            |FINSI;
      |SIGUE;

      |SI #prtla001@#19 ! #prtlm001#19;
          nOk = 1;
      |FINSI;

      |SI nOk = 0;  |ACABA;  |FINSI;

      #prtlm003#0 = #prtlm000#0;

      |PARA nCmp1 = 0;  |SI nCmp1 [ 19;  |HACIENDO nCmp1 = nCmp1 + 1;
            nCmp3 = nCmp1 + 1;
            #prtlm003#nCmp3# = #prtlm001#nCmp1#;
      |SIGUE;

      |GRABA 020#prtlm003.n;
      |LIBERA #prtlm003;

      #prtlm000#3 = #prtlm000#3 + 1;
      #prtlm000#4 = aVerde;
|FPRC;

|DEFBUCLE prtlm001;
     #prtlm001#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, prtlm001;
|FIN;

|PROCESO NotiModelos;
     |DBASS aBase;
     aAbre = aBase + "modelos/bin/prtlz001.tab";
     |XABRE "E", aAbre, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |SUB_EJECUTA ":modelos/prtlz001";
|FPRC;

|PROCESO NotiLaboral;
     |DBASS aBase;
     aAbre = aBase + "laboral/bin/prtlz001.tab";
     |XABRE "E", aAbre, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |SUB_EJECUTA ":laboral/prtlz001";
|FPRC;

|PROCESO NotiIntegral;
     |DBASS aBase;
     aAbre = aBase + "integral/bin/prtlz001.tab";
     |XABRE "E", aAbre, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |SUB_EJECUTA ":integral/prtlz001";
|FPRC;

|PROCESO NotiRenta;
     |DBASS aBase;
     |PARA nAny = 2017;  |SI;  |HACIENDO nAny = nAny + 1;
           aAbre = aBase + "ren" + nAny + "/bin/prtlz001.tab";
           |XABRE "E", aAbre, 0;
           |SI FSalida < 0;  |SAL;  |FINSI;

           aAlfa = ":" + "ren" + nAny + "/prtlz001";
           |SUB_EJECUTA aAlfa;
     |SIGUE;
|FPRC;

|PROCESO NotiSociedad;
     |DBASS aBase;
     aAbre = aBase + "contasoc/bin/prtlz001.tab";
     |XABRE "E", aAbre, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |SUB_EJECUTA ":contasoc/prtlz001";
|FPRC;

|PROGRAMA;
      |HAZ Copia;

      |ABRE #prtlm001;  |CIERRA #prtlm001;  |DELINDEX #prtlm001;

      |HAZ NotiModelos;
      |HAZ NotiLaboral;
      |HAZ NotiIntegral;
      |HAZ NotiRenta;
      |HAZ NotiSociedad;

      |DDEF aDef;
      aMas = aDef + "prtlm001.mas";
      |CARGA_DEF aMas, prtla001@;

      |NOME_DAT #prtla001@#"prtla001"#;

      |ABRE #prtla001@;
      |ABRE #prtlm003;
      |BUCLE prtlm001;
      |CIERRA #prtla001@;
      |CIERRA #prtlm003;

      |DESCARGA_DEF #prtla001@;
|FPRO;

|PROCESO prtlm003Rec;
     #prtlm000#3 = #prtlm000#3 + 1;
|FPRC;

|DEFBUCLE prtlm003Rec;
     #prtlm003#1;
     ;
     #prtlm000#0, 00000, 0000, 00, 000, "";
     #prtlm000#0, 99999, 9999, 99, 999, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, prtlm003Rec;
|FIN;


|PROCESO prtlm000Rec;
     #prtlm000#3 = 0;
     |BUCLE prtlm003Rec;

     #prtlm000#4 = "";
     |SI #prtlm000#3 ! 0;
         #prtlm000#4 = aVerde;
     |FINSI;

     |GRABA 020#prtlm000.a;
     |LIBERA #prtlm000;
|FPRC;

|DEFBUCLE prtlm000Rec;
     #prtlm000#1;
     ;
            0;
     99999999;
     be;
     NULL, prtlm000Rec;
|FIN;

|PROCESO T80;  |TIPO 80;
     |ABRET #prtlm000;

     |SELECT #3#prtlm000;
     |LEE 000#prtlm000.u;
     |SI FSalida = 0;  |Y #prtlm000#3 = 0;
         |BUCLE prtlm000Rec;
     |FINSI;

     |SELECT #1#prtlm000;
     |LEE 101#prtlm000.p;
     |LIBERA #prtlm000;

     |LEE 000#prtlm000.u;
     |SI FSalida ! 0;  |DDEFECTO #prtlm000;  |FINSI;

     nUlt = #prtlm000#0 + 1;

     #prtlm000#0 = nUlt;
     |LEE 101#prtlm000.=;
     |SI FSalida ! 0;
         |DDEFECTO #prtlm000;
         #prtlm000#0 = nUlt;
         #prtlm000#3 = 0;
         #prtlm000#4 = "";

         |GRABA 020#prtlm000.b;
     |FINSI;
|FPRC;

|PROCESO T90;  |TIPO 90;
     #prtlm000#1 = ~;
     |HORA aHora;  #prtlm000#2 = aHora;

     |GRABA 020#prtlm000.a;
     |LIBERA #prtlm000;
     |CIERRAT #prtlm000;
|FPRC;
