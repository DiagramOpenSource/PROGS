|FICHEROS;
     dsarz003;

     dsarm000;
     dsarm001;
     dsarm002;
     dsarm003;
     dsarm004;
     dsarm005;
     dsarm072;

     dpntm001;
     dpntm002;

     reflejo2@;
     reflejo3@;
     reflejo4@;

     dsarw067;

     dsarm100;           ||Contador Reg.Doc.
|FIN;

|VARIABLES;

     aHHHH = "";
     aEEEE = "";
     nSwHayBarra = 0;
     aLetra = "";
     aLong = "";
     nLong = 0;
     nVoy = 0;
     aSaca = "";

     nUltimo    = 0;
     nUltimoDoc = 0;          ||Contador


     nVentz1 = 0;
     aTempo67 = "";

     aAlfa3 = "";

     aCodigo = "";
     aDescripcion = "";
     aCarpeta = "";

     aIntParametro = "";
     aBorra = "";
     aLinea = "";

     nSwParametroFichero = 0;
     aResto = "";

     nSwObligatorios = 0;
     nSwDameTres     = 0;              ||Sirve para preguntar GRUPO/SUBGRUPO/TIPO
     nUltDoc         = 0;
     nVentana        = -1;
     nEmpresa        = 0;
     nEjercicio      = 0;
     nHandle         = 0;
     nDesdeGrupo     = 0;
     nHastaGrupo     = 0;
     nDesdeSub       = 0;
     nHastaSub       = 0;
     nSwADConta      = 0;
     nRefresca       = 0;
     nSalida         = 0;
     nPanta0         = 0;
     nBotonFoto      = 0;
     nRango          = 0;
     nPos1           = 0;
     nPos2           = 0;
     nGrid1          = -1;
     nGrid2          = -1;
     nGrid3          = -1;
     nBoton1         = -1;
     nBoton2         = -1;
     nBoton3         = -1;
     nBoton4         = -1;
     nBoton5         = -1;

     nIdSalir        = 0;
     nVentz3         = 0;
     nCampo          = 0;
     nNumCampos      = 0;
     nCambio         = 0;
     nOk             = 0;
     nErrorDESPANET  = 0;

     aLabel          = "";
     aEmpresa        = "";
     aEjercicio      = "";
     aAux            = "";
     aParametro      = "";
     aDirLocal       = "";
     aMensaje        = "";
     aBase           = "";
     aFotoOrigen     = "";
     aFotoDestino    = "";
     aExt            = "";
     aDocRemoto      = "";
     aDocServidor    = "";
     aIPRemoto       = "";
     aFoto           = "";
     aEsc1           = "";
     aEsc2           = "";
     aRetu           = "";
     aTecla          = "";
     aAlfa           = "";
     aUsuario        = "";
     aQueQuiero      = "";
     aMas            = "";
     aHora           = "";
     aPathDSSelect   = "";
     aParaIni        = "";
     aTextoIni       = "";
     aPrograma       = "";
     aEjecuta        = "";
     aFic            = "";
     aLista          = "";
     aPathLab        = "";

     {1}aContiene    = "";
     {1}aLocal       = "";
     {2}nNivel       = 0;
     {6}aPopup       = "";

     {-1}aVent       = "";
         aVent1      = 0;
         aVent2      = 0;
         aVent3      = 0;
         aVent4      = 0;
         aVent5      = "";

     &enBotonCancelar = 0;
     &Tempo          = "";
     &enSwDesde9     = 0;
     &enGrupo        = 0;
     &enSubGrupo     = 0;
     &enTipo         = 0;
     &enEscaneo      = 0;
     &enDocumento    = 0;
     &enDESPANET     = 0;
     &enGrupoTres    = 0;
     &enSubGTres     = 0;
     &enTipoTres     = 0;
     &enSwADConta    = 0;
     &enEmpADConta   = 0;
     &enEjeADConta   = 0;
     &enMueveDoc     = 0;
     &enGrupoPV      = 0;
     &enSubGrupoPV   = 0;
     &enTipoPV       = 0;
     &eaUnidadBasico = "";
     &eaUnidad       = "";
     &eaRuta         = "";
     &enError        = 0;
     &enHHHHClinica  = 0;
     &enEEEEClinica  = 0;
     &enSwModoClinica = 0;      ||Se llamada desde parametros  CLINICAHHHH_EEEE
                                ||La llamada se hace desde una aplicacion externa
                                ||como GreenCube.
|FIN;

|PROCESO Baja2;
     #dsarm002#0 = nDesdeGrupo;
|FPRC;

|PROCESO Alta2;
     #dsarm002#0 = nHastaGrupo;
|FPRC;

|PROCESO Baja3;
     #dsarm003#0 = #dsarm002#0;
     #dsarm003#1 = nDesdeSub;
|FPRC;

|PROCESO Alta3;
     #dsarm003#0 = #dsarm002#0;
     #dsarm003#1 = nHastaSub;
|FPRC;

|PROCESO Baja4;
     #dsarm004#0 = #dsarm003#0;
     #dsarm004#1 = #dsarm003#1;
     #dsarm004#2 = 1;
|FPRC;

|PROCESO Alta4;
     #dsarm004#0 = #dsarm003#0;
     #dsarm004#1 = #dsarm003#1;
     #dsarm004#2 = 999;
|FPRC;

|PROCESO PintaUltimo;
     |ABRE #dsarm005;
     |LEE 000#dsarm005.u;
     |SI FSalida ! 0;  |DDEFECTO #dsarm005;  |FINSI;
     |CIERRA #dsarm005;

     nUltimo = #dsarm005#0;

     |ABRE #dsarm100;
     |DDEFECTO #dsarm100;
     |LEE 000#dsarm100.p;
     |SI FSalida = 0;
          nUltimoDoc = #dsarm100#1 + 1;
     |SINO;
          nUltimoDoc = 1;
     |FINSI;
     |SI nUltimoDoc > nUltimo;
          nUltimo = nUltimoDoc;
     |FINSI;
     |CIERRA #dsarm100;

     #dsarz003#6 = nUltimo;  |PINTA #dsarz003#6;
|FPRC;

|PROCESO ActUltDocCarpeta;
     |ABRE #dsarm005;
     |SELECT #2#dsarm005;
     #dsarm005#1 = #dsarz003#0;
     #dsarm005#2 = #dsarz003#2;
     #dsarm005#3 = #dsarz003#4;
     #dsarm005#0 = 999999999;
     |LEE 000#dsarm005.];
     |SI FSalida = 0;
         |LEE 000#dsarm005.a;
     |SINO;
         |LEE 000#dsarm005.u;
     |FINSI;

     nUltDoc = 0;
     |SI FSalida = 0;  |Y #dsarm005#1 = #dsarz003#0;  |Y #dsarm005#2 = #dsarz003#2; |Y #dsarm005#3 = #dsarz003#4;
         nUltDoc = #dsarm005#47;
     |FINSI;
     |SELECT #1#dsarm005;
     |CIERRA #dsarm005;

     #dsarz003#7 = nUltDoc;
     |PINTA #dsarz003#7;
|FPRC;

|PROCESO Evento4;
     |SI FSalida = 1;  |O FSalida = 2;
         |SI enGrupoTres ! 0;
             nRefresca   = 0;
         |FINSI;

         |SI nRefresca = 0;
             |LEE 000#dsarm004.=;
         |SINO;
             #dsarm004#0 = #dsarm003#0;
             #dsarm004#1 = #dsarm003#1;
             #dsarm004#2 = 9999;
             |LEE 000#dsarm004.];
             |SI FSalida = 0;
                 |LEE 000#dsarm004.a;
             |SINO;
                 |LEE 000#dsarm004.u;
             |FINSI;

             nRefresca = 0;
         |FINSI;

         |SI FSalida = 0;
             #dsarz003#4 = #dsarm004#2;  |PINTA #dsarz003#4;
             #dsarz003#5 = #dsarm004#3;  |PINTA #dsarz003#5;
         |SINO;
             #dsarz003#4 = 0;   |PINTA #dsarz003#4;
             #dsarz003#5 = "";  |PINTA #dsarz003#5;
         |FINSI;

         |SI enGrupoTres = 0;
             |HAZ ActUltDocCarpeta;
         |FINSI;

         |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO Evento3;
     |SI FSalida = 1;  |O FSalida = 2;
         |SI enGrupoTres ! 0;
             nRefresca   = 0;

             |SI #dsarz003#4 = 0;
                 #dsarz003#0 = enGrupo;
                 #dsarz003#2 = enSubGTres;
                 #dsarz003#4 = enTipoTres;
             |FINSI;
         |FINSI;


         |SI nRefresca = 0;
             |LEE 000#dsarm003.=;
         |SINO;
             #dsarm003#0 = #dsarm002#0;
             #dsarm003#1 = 9999;
             |LEE 000#dsarm003.];
             |SI FSalida = 0;
                 |LEE 000#dsarm003.a;
             |SINO;
                 |LEE 000#dsarm003.u;
             |FINSI;

             |REFRESCACONTROL nGrid2;
         |FINSI;

         |REFRESCACONTROL nGrid3;

         |SI FSalida = 0;
             #dsarz003#2 = #dsarm003#1;  |PINTA #dsarz003#2;
             #dsarz003#3 = #dsarm003#2;  |PINTA #dsarz003#3;
         |SINO;
             #dsarz003#2 = 0;   |PINTA #dsarz003#2;
             #dsarz003#3 = "";  |PINTA #dsarz003#3;
         |FINSI;

         |SI enGrupoTres = 0;
             |HAZ ActUltDocCarpeta;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Evento2;
     |SI FSalida = 1;  |O FSalida = 2;
         nSalida = FSalida;

         |SI enGrupoTres ! 0;
             nRefresca   = 0;
         |FINSI;

         |LEE 000#dsarm002.=;
         |SI FSalida = 0;
             #dsarz003#0 = #dsarm002#0;  |PINTA #dsarz003#0;
             #dsarz003#1 = #dsarm002#1;  |PINTA #dsarz003#1;
         |SINO;
             #dsarz003#0 = 0;  |PINTA #dsarz003#0;
             #dsarz003#1 = ""; |PINTA #dsarz003#1;
         |FINSI;

         |SI #dsarm001#8 = "S";
             nRefresca = 1;
             FSalida   = 1;
         |FINSI;

         |SI enGrupoTres = 0;
             |HAZ PintaUltimo;
             |HAZ ActUltDocCarpeta;
         |FINSI;

         |REFRESCACONTROL nGrid2;
         |REFRESCACONTROL nGrid3;
     |FINSI;
|FPRC;

|PROCESO Evento4P;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsarm004.=;
         |SI FSalida = 0;
             #dsarm002#0 = #dsarm004#0;
             |LEE 000#dsarm002.=;

             #dsarm003#0 = #dsarm004#0;
             #dsarm003#1 = #dsarm004#1;
             |LEE 000#dsarm003.=;

             #dsarz003#0 = #dsarm002#0;  |PINTA #dsarz003#0;
             #dsarz003#1 = #dsarm002#1;  |PINTA #dsarz003#1;
             #dsarz003#2 = #dsarm003#1;  |PINTA #dsarz003#2;
             #dsarz003#3 = #dsarm003#2;  |PINTA #dsarz003#3;
             #dsarz003#4 = #dsarm004#2;  |PINTA #dsarz003#4;
             #dsarz003#5 = #dsarm004#3;  |PINTA #dsarz003#5;
         |FINSI;

         |HAZ ActUltDocCarpeta;
     |FINSI;
|FPRC;

|PROCESO EventoAuxTipo;
     |SI FSalida = 1;  |O FSalida = 2;
         ||ARA
         |LEE 000#dsarw067.=;
         |SI FSalida = 0;
             aCodigo = #dsarw067#0;
             |QBF aCodigo;
             aAlfa3 = aCodigo % 103;
             #dsarm004#0 = aAlfa3;
             aAlfa3 = aCodigo % 403;
             #dsarm004#1 = aAlfa3;
             aAlfa3 = aCodigo % 703;
             #dsarm004#2 = aAlfa3;
             |LEE 000#dsarm004.=;
             |SI FSalida = 0;
                  #dsarm002#0 = #dsarm004#0;
                  |LEE 000#dsarm002.=;

                  #dsarm003#0 = #dsarm004#0;
                  #dsarm003#1 = #dsarm004#1;
                  |LEE 000#dsarm003.=;

                  #dsarz003#0 = #dsarm002#0;  |PINTA #dsarz003#0;
                  #dsarz003#1 = #dsarm002#1;  |PINTA #dsarz003#1;
                  #dsarz003#2 = #dsarm003#1;  |PINTA #dsarz003#2;
                  #dsarz003#3 = #dsarm003#2;  |PINTA #dsarz003#3;
                  #dsarz003#4 = #dsarm004#2;  |PINTA #dsarz003#4;
                  #dsarz003#5 = #dsarm004#3;  |PINTA #dsarz003#5;
             |FINSI;
         |FINSI;

         |HAZ ActUltDocCarpeta;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     #dsarm004#0 = #dsarz003#0;
     #dsarm004#1 = #dsarz003#2;
     #dsarm004#2 = #dsarz003#4;
     |LEE 000#dsarm004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI enSwModoClinica = 1;
          |SI #dsarm004#86 = "N";
               aMensaje = "0000El tipo seleccionado NO tiene vinculacion con Historias/Episodios";
               |MENAV aMensaje;
               |ACABA;
          |SINO;
               |SI #dsarm004#86 = "E";
                    enEEEEClinica = 0;
               |FINSI;
          |FINSI;
     |FINSI;

     aAlfa =  "Escanear documento   (ultimo n£mero de registro: " + ((("000000000") + #dsarz003#6) % -109) + ")";
     |VENTANA 0501, 3499, -1, 16, aAlfa;
     nVentz3 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentz3;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enGrupo    = #dsarm004#0;
     enSubGrupo = #dsarm004#1;
     enTipo     = #dsarm004#2;
     enEscaneo  = 1;
     |SUB_EJECUTA_NP "dsarz001"; ||1

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentz3;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentz3;

     |PULSATECLA;

     |SI #dsarm001#8 = "S";
         nRefresca = 1;
         FSalida   = 1;
         |HAZ Evento2;
         |HAZ Evento3;
     |FINSI;

     |HAZ PintaUltimo;
     |HAZ ActUltDocCarpeta;

     |SI enSwModoClinica = 1;
          |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO Boton2;
     #dsarm004#0 = #dsarz003#0;
     #dsarm004#1 = #dsarz003#2;
     #dsarm004#2 = #dsarz003#4;
     |LEE 000#dsarm004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI enSwModoClinica = 1;
          |SI #dsarm004#86 = "N";
               aMensaje = "0000El tipo seleccionado NO tiene vinculacion con Historias/Episodios";
               |MENAV aMensaje;
               |ACABA;
          |SINO;
               |SI #dsarm004#86 = "E";
                    enEEEEClinica = 0;
               |FINSI;
          |FINSI;
     |FINSI;

     aAlfa =  "Capturar del disco   (ultimo n£mero de registro: " + ((("000000000") + #dsarz003#6) % -109) + ")";
     |VENTANA 0501, 3499, -1, 16, aAlfa;
     nVentz3 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentz3;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enGrupo    = #dsarm004#0;
     enSubGrupo = #dsarm004#1;
     enTipo     = #dsarm004#2;
     enEscaneo  = 0;
     enBotonCancelar = 0;

     |SUB_EJECUTA_NP "dsarz001"; ||2

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentz3;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentz3;

     |PULSATECLA;

     |HAZ PintaUltimo;
     |HAZ ActUltDocCarpeta;

     |SI enSwModoClinica = 1; |Y enBotonCancelar = 0;
          |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO Boton3;
     #dsarm004#0 = #dsarz003#0;
     #dsarm004#1 = #dsarz003#2;
     #dsarm004#2 = #dsarz003#4;
     |LEE 000#dsarm004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI enMueveDoc = 1;
          enGrupoPV = #dsarm004#0;
          enSubGrupoPV = #dsarm004#1;
          enTipoPV = #dsarm004#2;

          aTecla     = &255 + "806";
          |PTEC 806;
          |ACABA;
     |FINSI;

     |SI enMueveDoc = 1;
          |VENTANA 0501, 3499, -1, 16, "Mover documento";
     |SINO;
          |VENTANA 0501, 3499, -1, 16, "Pegar documento";
     |FINSI;
     nVentz3 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentz3;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enGrupo    = #dsarm004#0;
     enSubGrupo = #dsarm004#1;
     enTipo     = #dsarm004#2;
     enEscaneo  = 2;
     |SUB_EJECUTA_NP "dsarz001"; ||3

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentz3;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentz3;

     aTecla     = &255 + "806";
     |PTEC 806;
|FPRC;

|PROCESO Boton4;
     enGrupoTres = #dsarz003#0;
     enSubGTres  = #dsarz003#2;
     enTipoTres  = #dsarz003#4;

     aTecla     = &255 + "806";
     |PTEC 806;
|FPRC;

|PROCESO Boton5;
     |SI nGrid1  ! -1;  |DESTRUYECONTROL nGrid1;       |FINSI;
     |SI nGrid2  ! -1;  |DESTRUYECONTROL nGrid2;       |FINSI;
     |SI nGrid3  ! -1;  |DESTRUYECONTROL nGrid3;       |FINSI;
     |SI nBoton5 ! -1;  |FIN_CONTROL_WINDOWS nBoton5;  |FINSI;

     |ABRE #dsarm000;
     #dsarm000#0 = Usuario % 810;
     |LEE 101#dsarm000.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsarm000;
         #dsarm000#0 = Usuario % 810;
         |GRABA 020#dsarm000.b;
     |FINSI;

     |SI nCambio = 1;
         |SI #dsarm000#5 = "3";
             #dsarm000#5 = "1";
         |SINO;
             #dsarm000#5 = "3";
         |FINSI;
     |FINSI;

     |GRABA 020#dsarm000.a;
     |LIBERA #dsarm000;
     |CIERRA #dsarm000;

     |SI #dsarm000#5 = "1";
         ||ESTO LO HACE PETAR, SI PREVIAMENTE HAY 100 SUB_EJECUTAS
         ||CONTROL_SIMPLE nPanta0, "BOTON,{{230}}", 0930, 0932, Boton5;

         |CONTROL_SIMPLE nPanta0, "BOTON,>>", 0930, 0932, Boton5;
         nBoton5 = FSalida;
     |FINSI;

     |SI #dsarm000#5 = "3";
         ||ESTO LO HACE PETAR, SI PREVIAMENTE HAY 100 SUB_EJECUTAS
         ||CONTROL_SIMPLE nPanta0, "BOTON,{{229}}", 0930, 0932, Boton5;

         |CONTROL_SIMPLE nPanta0, "BOTON,<<", 0930, 0932, Boton5;
         nBoton5 = FSalida;
     |FINSI;

     |SI #dsarm000#5 = "1";
         |SI nSwDameTres = 0; |Y enSwADConta = 1;
              nPos1  = 1010;
              nPos2  = 2790;
              FSalida = 0;

              |LINEAL_SIMPLE #1#dsarm004, nRango, nPos1, nPos2, Baja4, Alta4, Evento4P;
              nGrid1 = FSalida;
         |SINO;
              nPos1  = 1002;
              nPos2  = 2798;
              FSalida = 0;

              |LINEAL_SIMPLE #1#dsarw067, nRango, nPos1, nPos2, NULL, NULL, EventoAuxTipo;
              nGrid1 = FSalida;
         |FINSI;
     |FINSI;

     |SI #dsarm000#5 = "3";
         nPos1  = 1002;
         nPos2  = 2734;
         FSalida = 0;
         |LINEAL_SIMPLE #1#dsarm002, nRango, nPos1, nPos2, Baja2, Alta2, Evento2;
         nGrid1 = FSalida;

         nPos1  = 1036;
         nPos2  = 2768;
         FSalida = 0;
         |LINEAL_SIMPLE #1#dsarm003, nRango, nPos1, nPos2, Baja3, Alta3, Evento3;
         nGrid2 = FSalida;

         nPos1  = 1070;
         nPos2  = 2798;
         FSalida = 0;
         |LINEAL_SIMPLE #1#dsarm004, nRango, nPos1, nPos2, Baja4, Alta4, Evento4;
         nGrid3 = FSalida;
     |FINSI;

     |SI nCambio = 1;
         |FOCOTECLADO nGrid1;
     |FINSI;

     nCambio = 1;
|FPRC;

|PROCESO ObtenIdSalir;
     InNivel = nNivel1<-;
     nNivel1 = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;
     nIdSalir = nNivel2;
|FPRC;

|PROCESO PonFoto;
     |DBASE aBase;  |QBF aBase;

     |SI enDESPANET = 0;
         aFotoOrigen = aBase + "logos/logods.jpg";
         aExt        = ".jpg";
     |SINO;
         aFotoOrigen = aBase + "logos/logodespanet.jpg";
         aExt        = ".jpg";
         |XABRE "E", aFotoOrigen, nHandle;
         |SI FSalida < 0;
             aFotoOrigen = aBase + "logos/logodespanet.bmp";
             aExt        = ".bmp";
             |XABRE "E", aFotoOrigen, nHandle;
             |SI FSalida < 0;
                 aFotoOrigen = aBase + "logos/insertarlogo.jpg";
                 aExt        = ".jpg";
                 |XABRE "E", aFotoOrigen, nHandle;
                 |SI FSalida < 0;
                     |ACABA;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS";                |RMKDIR aDirLocal;
     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS\DSARCHI";        |RMKDIR aDirLocal;
     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS\DSARCHI\LOGOS";  |RMKDIR aDirLocal;
     aFotoDestino = aDirLocal + "/logods" + aExt;

     aContiene1 = aFotoDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aFotoOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         aIPRemoto = "";
         |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aFotoOrigen, aFotoDestino;
         |SINO;
             |COPIA_FICHERO aFotoOrigen, aFotoDestino;
         |FINSI;
     |FINSI;

     aFoto = "IMAGEN,"  + aFotoDestino;
     |CONTROL_SIMPLE nPanta0, aFoto, 0501, 0928, NULL;
     nBotonFoto = FSalida;
|FPRC;

|PROCESO Explorador;
     eaRuta  = "";
     |HAZ Traete_dsselect;
     |SI enError = 1;
         |MENAV "0000No puedo instala el dsselect.exe, consulte con su administrador";
     |FINSI;

     |ESPECIFICA "RBASS", aLocal;
     aDirLocal = aLocal;

     |HAZ DimeUnidad;
     aAux      = eaUnidad + ":\DOCUMENTOS\DSARCHI\";
     aPrograma = aAux + "dsselect.exe";

     aPathDSSelect = aAux;

     aBorra = aPathDSSelect + "dsselect.txt";
     |RFBORRA aBorra;

     aParaIni = aAux + "dsselect.ini";
     |RFBORRA aParaIni;

     aTextoIni = &34 + eaUnidadBasico + &34 + " " + &34 + aBorra + &34;
     |XABRE "CW", aParaIni, nHandle;
     |SI FSalida ] 0;
          |XGRABA nHandle, aTextoIni;
     |FINSI;
     |XCIERRA nHandle;

     aEjecuta = aPrograma;
     |RSYSTEM aEjecuta;

     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO Laborales;
     aPopup2  = 2;
     aPopup3  = "Huella del contrato de trabajo";
     aPopup4  = "Documentos Seguridad Social";

     aPopup1  = "0";
     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         |SI FSalida = 1;  |SUB_EJECUTA "dsarz101;1";  |FINSI;
         |SI FSalida = 2;  |SUB_EJECUTA "dsarz101;2";  |FINSI;
     |FINSI;

     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO BotonesPanta0;
     |PULSATECLA;
     |PULSATECLA;
     |HAZ PonFoto;

     |SI nSwDameTres = 1;
          |SI #dsarm001#8 = "S";
               |CONTROL_SIMPLE nPanta0, "LABEL,{{1}}                   ", 2966, 2980, NULL;
          |FINSI;

          ||CONTROL_SIMPLE nPanta0, "BOTON,{{206}}Aceptar", 3166, 3180, Boton4;
          |CONTROL_SIMPLE nPanta0, "BOTON,Aceptar", 3166, 3180, Boton4;
          nBoton4 = FSalida;

          nIdSalir = 0;
          |HAZ ObtenIdSalir;
          |ESTADO_CONTROL nIdSalir, "HIDE";

          |ACABA;
     |FINSI;

     |CONTROL_SIMPLE 0, "BOTON,Explorador disco", 3202, 3220, Explorador;

     |ABRE #dsarm072;
     #dsarm072#0 = 991;
     #dsarm072#1 = 0;
     |LEE 000#dsarm072.=;
     |SI FSalida = 0;
         |DBASS aBase;
         aPathLab = aBase + "laboral/def/labempre.mas";
         |XABRE "E", aPathLab, 0;
         |SI FSalida ] 0;
             |CONTROL_SIMPLE 0, "BOTON,Archivar Documentos Laborales", 3222, 3245, Laborales;
         |FINSI;
     |FINSI;
     |CIERRA #dsarm072;


     |SI #dsarm001#8 = "S";
         |SI enDocumento = 0;
             |CONTROL_SIMPLE nPanta0, "BOTON,Escanear", 3066, 3180, Boton1;
             nBoton1 = FSalida;

             |CONTROL_SIMPLE nPanta0, "BOTON,Capturar del disco", 3084, 3198, Boton2;
             nBoton2 = FSalida;
         |SINO;
             |CONTROL_SIMPLE nPanta0, "LABEL,{{1}}                   ", 2966, 2980, NULL;

             |SI enMueveDoc = 0;
                 |CONTROL_SIMPLE nPanta0, "BOTON,Pegar", 3084, 3198, Boton3;
                 nBoton3 = FSalida;
             |SINO;
                 |CONTROL_SIMPLE nPanta0, "BOTON,Mover", 3084, 3198, Boton3;
                 nBoton3 = FSalida;
             |FINSI;
         |FINSI;
     |SINO;
         |SI enDocumento = 0;
             |CONTROL_SIMPLE nPanta0, "BOTON,Escanear", 3066, 3180, Boton1;
             nBoton1 = FSalida;

             |CONTROL_SIMPLE nPanta0, "BOTON,Capturar del disco", 3084, 3198, Boton2;
             nBoton2 = FSalida;
         |SINO;
             |CONTROL_SIMPLE nPanta0, "LABEL,{{1}}                   ", 2966, 2980, NULL;

             |SI enMueveDoc = 0;
                  ||CONTROL_SIMPLE nPanta0, "BOTON,{{217}} Pegar", 3084, 3198, Boton3;
                 |CONTROL_SIMPLE nPanta0, "BOTON,Pegar", 3084, 3198, Boton3;
                 nBoton3 = FSalida;
             |SINO;
                 |CONTROL_SIMPLE nPanta0, "BOTON,Mover", 3084, 3198, Boton3;
                 nBoton3 = FSalida;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsarm005_z03;
     #dsarm002#0 = #dsarm005#1;
     |LEE 101#dsarm002.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsarm002;
         #dsarm002#0 = #dsarm005#1;
         |GRABA 020#dsarm002.b;
     |FINSI;

     #dsarm002#3 = #dsarm002#3 + 1;
     |GRABA 020#dsarm002.a;
     |LIBERA #dsarm002;

     #dsarm003#0 = #dsarm005#1;
     #dsarm003#1 = #dsarm005#2;
     |LEE 101#dsarm003.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsarm003;
         #dsarm003#0 = #dsarm005#1;
         #dsarm003#1 = #dsarm005#2;
         |GRABA 020#dsarm003.b;
     |FINSI;

     #dsarm003#4 = #dsarm003#4 + 1;
     |GRABA 020#dsarm003.a;
     |LIBERA #dsarm003;

     #dsarm004#0 = #dsarm005#1;
     #dsarm004#1 = #dsarm005#2;
     #dsarm004#2 = #dsarm005#3;
     |LEE 101#dsarm004.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsarm004;
         #dsarm004#0 = #dsarm005#1;
         #dsarm004#1 = #dsarm005#2;
         #dsarm004#2 = #dsarm005#3;
         |GRABA 020#dsarm004.b;
     |FINSI;

     #dsarm004#25 = #dsarm004#25 + 1;
     |GRABA 020#dsarm004.a;
     |LIBERA #dsarm004;

     #dsarm005#44 = ((#dsarm002#3  / #dsarm002#4)  + 0.48) ! 0;
     #dsarm005#45 = ((#dsarm003#4  / #dsarm003#5)  + 0.48) ! 0;
     #dsarm005#46 = ((#dsarm004#25 / #dsarm004#26) + 0.48) ! 0;

     |SI #dsarm005#44 = 0;  #dsarm005#44 = 1;  |FINSI;
     |SI #dsarm005#45 = 0;  #dsarm005#45 = 1;  |FINSI;
     |SI #dsarm005#46 = 0;  #dsarm005#46 = 1;  |FINSI;

     |GRABA 020#dsarm005.a;
     |LIBERA #dsarm005;
|FPRC;

|DEFBUCLE dsarm005_z03;
     #dsarm005#1;
     ;
     000000001;
     999999999;
     be;
     NULL, dsarm005_z03;
|FIN;

|PROCESO reflejo3;
     #dpntm002#0 = #dpntm001#0;
     #dpntm002#1 = #reflejo4@#0;
     #dpntm002#2 = #reflejo4@#1;
     #dpntm002#3 = #reflejo4@#2;
     |LEE 000#dpntm002.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #reflejo2@#0 = #reflejo4@#0;
     |LEE 000#reflejo2@.=;

     #reflejo3@#0 = #reflejo4@#0;
     #reflejo3@#1 = #reflejo4@#1;
     |LEE 000#reflejo3@.=;

     #dsarm002#0 = #reflejo4@#0;
     |LEE 101#dsarm002.=;
     |SI FSalida ! 0;
         #dsarm002#0 = #reflejo4@#0;
         #dsarm002#1 = #reflejo2@#1;
         #dsarm002#2 = #reflejo2@#2;
         #dsarm002#3 = #reflejo2@#3;
         #dsarm002#4 = #reflejo2@#4;
         |GRABA 020#dsarm002.n;
     |FINSI;
     |LIBERA #dsarm002;

     #dsarm003#0 = #reflejo4@#0;
     #dsarm003#1 = #reflejo4@#1;
     |LEE 101#dsarm003.=;
     |SI FSalida ! 0;
         #dsarm003#0 = #reflejo4@#0;
         #dsarm003#1 = #reflejo4@#1;
         #dsarm003#2 = #reflejo3@#2;
         #dsarm003#3 = #reflejo3@#3;
         #dsarm003#4 = #reflejo3@#4;
         #dsarm003#5 = #reflejo3@#5;
         |GRABA 020#dsarm003.n;
     |FINSI;
     |LIBERA #dsarm003;

     |PARA nCampo = 0;  |SI nCampo [ nNumCampos;  |HACIENDO nCampo = nCampo + 1;
           #dsarm004#nCampo# = #reflejo4@#nCampo#;
     |SIGUE;
     |GRABA 020#dsarm004.n;
     |LIBERA #dsarm004;
|FPRC;

|DEFBUCLE reflejo3;
     #reflejo4@#2004;
     ;
     "S", 000, 000, 000;
     "S", 999, 999, 999;
     ;
     NULL, reflejo3;
|FIN;

|PROCESO TempoDESPANET;
     nErrorDESPANET = 0;
     aUsuario       = Usuario % 810;
     |ABRE #dpntm001;
     #dpntm001#0 = aUsuario;
     |LEE 000#dpntm001.=;
     |SI FSalida ! 0;
         nErrorDESPANET = 1;
         |CIERRA #dpntm001;
         |ACABA;
     |FINSI;
     |CIERRA #dpntm001;

     enDESPANET = 1;

     |HORA aHora;
     aAlfa = "2" + ((aHora % 102) + (aHora % 402) + (aHora % 702) + Usuario) % 108;
     |NOME_DAT #dsarm002#aAlfa#;

     aAlfa = "3" + ((aHora % 102) + (aHora % 402) + (aHora % 702) + Usuario) % 108;
     |NOME_DAT #dsarm003#aAlfa#;

     aAlfa = "4" + ((aHora % 102) + (aHora % 402) + (aHora % 702) + Usuario) % 108;
     |NOME_DAT #dsarm004#aAlfa#;

     |ABRE #dsarm002;  |CIERRA #dsarm002;  |DELINDEX #dsarm002;
     |ABRE #dsarm003;  |CIERRA #dsarm003;  |DELINDEX #dsarm003;
     |ABRE #dsarm004;  |CIERRA #dsarm004;  |DELINDEX #dsarm004;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsarm002.mas";  |CARGA_DEF aMas, reflejo2@;
     aMas = aBase + "def/dsarm003.mas";  |CARGA_DEF aMas, reflejo3@;
     aMas = aBase + "def/dsarm004.mas";  |CARGA_DEF aMas, reflejo4@;

     aQueQuiero = "|NC";
     nNumCampos = #dsarm004#aQueQuiero#;
     nNumCampos = nNumCampos - 1;

     |ABRE #dsarm002;
     |ABRE #dsarm003;
     |ABRE #dsarm004;
     |ABRE #reflejo2@;
     |ABRE #reflejo3@;
     |ABRE #dpntm002;
     |BUCLE reflejo3;
     |CIERRA #reflejo2@;
     |CIERRA #reflejo3@;
     |CIERRA #dsarm002;
     |CIERRA #dsarm003;
     |CIERRA #dsarm004;
     |CIERRA #dpntm002;

     |DESCARGA_DEF #reflejo4@;
     |DESCARGA_DEF #reflejo3@;
     |DESCARGA_DEF #reflejo2@;
|FPRC;


|PROCESO ControlZero;
     |ABRE #dsarm002;
     #dsarm002#0 = 0;
     |LEE 101#dsarm002.=;
     |SI FSalida = 0;
          |BORRA 020#dsarm002.a;
          |LIBERA #dsarm002;
     |FINSI;
     |CIERRA #dsarm002;

     |ABRE #dsarm004;
     #dsarm004#0 = 0;
     #dsarm004#1 = 0;
     #dsarm004#2 = 0;
     |LEE 101#dsarm004.=;
     |SI FSalida = 0;
          |BORRA 020#dsarm004.a;
          |LIBERA #dsarm004;
     |FINSI;
     |CIERRA #dsarm004;
|FPRC;


|PROCESO dsarm004_AuxTipos;
     aCodigo = ((("000" + #dsarm004#0) % -103) + (("000" + #dsarm004#1) % -103) + (("000" + #dsarm004#2) % -103));

     |ABRE #dsarm002;
     |DDEFECTO #dsarm002;
     #dsarm002#0 = #dsarm004#0;
     |LEE 000#dsarm002.=;
     |CIERRA #dsarm002;

     aDescripcion = #dsarm002#1;
     |QBF aDescripcion;

     |ABRE #dsarm003;
     |DDEFECTO #dsarm003;
     #dsarm003#0 = #dsarm004#0;
     #dsarm003#1 = #dsarm004#1;
     |LEE 000#dsarm003.=;
     |CIERRA #dsarm003;

     |SI aDescripcion = "";
          aDescripcion = #dsarm003#2;
     |SINO;
          aDescripcion = aDescripcion + " " + #dsarm003#2;
     |FINSI;
     |QBF aDescripcion;

     |SI aDescripcion = "";
          aDescripcion = #dsarm004#3;
     |SINO;
          aDescripcion = aDescripcion + " " + #dsarm004#3;
     |FINSI;
     |QBF aDescripcion;

     aCarpeta = #dsarm002#2;
     |QBF aCarpeta;
     |SI aCarpeta = "";
           aCarpeta = #dsarm003#3;
     |SINO;
           aCarpeta = aCarpeta + "/" + #dsarm003#3;
     |FINSI;
     |QBF aCarpeta;
     |SI aCarpeta = "";
           aCarpeta = #dsarm004#4;
     |SINO;
           aCarpeta = aCarpeta + "/" + #dsarm004#4;
     |FINSI;

     |DDEFECTO #dsarw067;
     #dsarw067#0 = aCodigo;
     |LEE 101#dsarw067.=;
     |SI FSalida ! 0; |GRABA 020#dsarw067.b; |FINSI;
     #dsarw067#1 = aDescripcion;
     #dsarw067#2 = aCarpeta;
     |GRABA 020#dsarw067.a;
     |LIBERA #dsarw067;
|FPRC;

|DEFBUCLE dsarm004_AuxTipos;
 #dsarm004#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, dsarm004_AuxTipos;
|FIN;

|PROCESO RefrescaAuxTipos;
     |HAZ CreaTempo; aTempo67 = Tempo;
     |NOME_DAT #dsarw067#aTempo67#;

     |ABRE #dsarw067;  |CIERRA #dsarw067;  |DELINDEX #dsarw067;

     |ABRET #dsarw067;
     |BUCLE dsarm004_AuxTipos;
|FPRC;

|PROCESO FicIntePara;
      |DBASE aBase;  |QBF aBase;
      aIntParametro = aBase + "intepara/";
      aBorra = aIntParametro + aResto;

      |XABRE "U", aBorra, nHandle;
      |SI FSalida ] 0;
          |XLEE nHandle, 250, aLinea;
          |SI FSalida ] 0;
              |QBF aLinea;
              aAux = aLinea % 103;
              enGrupoTres = aAux;
              aAux = aLinea % 403;
              enSubGTres = aAux;
              aAux = aLinea % 703;
              enTipoTres = aAux;
          |FINSI;
      |FINSI;
      |XCIERRA nHandle;
      |FBORRA aBorra;
|FPRC;

|PROGRAMA;
     |SI nErrorDESPANET = 1;
         |MENAV "0000No tiene permiso para entrar en esta opci¢n, no es un usuario DESPABOX";
         |ACABA;
     |FINSI;

     |HAZ ControlZero;

     aParametro  = PARAMETRO;
     |QBF aParametro;
     aAux = aParametro % 107;
     |SI aAux = "DAMETRE";
          |CABEZA "Selecci¢n Grupo/Subgrupo/Tipo";
     |SINO;
          |SI aAux = "CLINICA";
               |CABEZA "Asistente de archivado";

               |SI #dsarm001#194 = "N";
                    aMensaje = "0000Conexi¢n cl¡nica no activa. Proceso cancelado";
                    |MENAV aMensaje;
                    |ACABA;
               |FINSI;
               enSwModoClinica = 1;

               aAux = aParametro - "CLINICA";
               |QBF aAux;
               |SI aAux = "_"; |O aAux = "";
                    enHHHHClinica = 0;
                    enEEEEClinica = 0;
               |SINO;
                    aHHHH = "";
                    aEEEE = "";
                    nSwHayBarra = 0;
                    aLong = aAux % A0;
                    nLong = aLong;
                    |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
                         aSaca = nVoy + "01";
                         aLetra = aAux % aSaca;
                         |SI aLetra = "_";
                              nSwHayBarra = nSwHayBarra + 1;
                         |SINO;
                              |SI nSwHayBarra = 0;
                                   aHHHH = aHHHH + aLetra;
                              |SINO;
                                   aEEEE = aEEEE + aLetra;
                              |FINSI;
                         |FINSI;
                    |SIGUE;

                    |QBF aHHHH;
                    |SI aHHHH ! "";
                         enHHHHClinica = aHHHH;
                    |SINO;
                         enHHHHClinica = 0;
                    |FINSI;
                    |QBF aEEEE;
                    |SI aEEEE ! "";
                         enEEEEClinica = aEEEE;
                    |SINO;
                         enEEEEClinica = 0;
                    |FINSI;
               |FINSI;
               ||enHHHHClinica;
               ||enEEEEClinica;
          |SINO;
               |CABEZA "Asistente de archivado";
          |FINSI;
     |FINSI;

     nSwADConta  = 0;
     nDesdeGrupo = 1;
     nHastaGrupo = 999;
     nDesdeSub   = 1;
     nHastaSub   = 999;

     aAux = aParametro % 107;
     |SI aAux = "ADCONTA";
          aEmpresa   = aParametro % 805;
          aEjercicio = aParametro % 1302;
          nEmpresa   = aEmpresa;
          nEjercicio = aEjercicio;

          |SI #dsarm001#9 = "N";  |ACABA;  |FINSI;

          nDesdeGrupo  = #dsarm001#10;
          nHastaGrupo  = #dsarm001#10;
          nDesdeSub    = #dsarm001#11;
          nHastaSub    = #dsarm001#11;
          nSwADConta   = 1;
          enSwADConta  = nSwADConta;
          enEmpADConta = nEmpresa;
          enEjeADConta = nEjercicio;
     |FINSI;

     nVentana    = -1;
     nSwDameTres = 0;
     |SI aAux = "DAMETRE";
          nSwParametroFichero = 0;
          aResto = aParametro % 8;
          |QBF aResto;
          |SI aResto ! "";
               enSwDesde9 = 1;
               nSwParametroFichero = 1;
               |HAZ FicIntePara;
          |FINSI;

          nSwDameTres = 1;
          aLabel = "Selecci¢n Grupo/Subgrupo/Tipo";
          |VENTANA 0501, 3299, -1, 16, aLabel;
          nVentana = FSalida;
     |SINO;
          |SI nSwADConta = 1;
              aLabel = "ADCONTA: PENDIENTES VINCULAR";
              |VENTANA 0501, 3299, -1, 16, aLabel;
              nVentana = FSalida;
          |FINSI;
     |FINSI;

     nPanta0 = 0;

     |PINPA #0#dsarz003;  nPanta0 = FSalida;

     |HAZ BotonesPanta0;

     nRango  = 2 + 4 + 8 + 16 + 32 + 128;
     |SI #dsarm001#8 = "S";
         |PINDA #0#dsarz003;

         nCambio = 0;
         |HAZ Boton5;
     |SINO;
         |PINPA #0#dsarz003;  nPanta0 = FSalida;

         nPos1  = 1002;
         nPos2  = 2798;
         FSalida = 0;
         |LINEAL_SIMPLE #1#dsarm002, nRango, nPos1, nPos2, Baja2, Alta2, Evento2;
         nGrid1 = FSalida;

         nGrid2 = 0;
         nGrid3 = 0;

         |C_V #dsarz003#0, 1, "N";
         |C_V #dsarz003#1, 1, "N";
         |C_V #dsarz003#2, 1, "N";
         |C_V #dsarz003#3, 1, "N";
         |C_V #dsarz003#4, 1, "N";
         |C_V #dsarz003#5, 1, "N";

         #dsarz003#2 = 1;
         #dsarz003#4 = 1;

         |CONTROL_SIMPLE nPanta0, "LABEL,{{1}}          ", 2902, 2910, NULL;
         |CONTROL_SIMPLE nPanta0, "LABEL,{{1}}          ", 3002, 3010, NULL;
         |CONTROL_SIMPLE nPanta0, "LABEL,{{1}}          ", 3102, 3110, NULL;
     |FINSI;

     |SI aAux = "DAMETRE";
         ||ARA55
         |CONTROL_SIMPLE nPanta0, "LABEL,{{14}}                                          ", 0530, 0598, NULL;
         |CONTROL_SIMPLE nPanta0, "LABEL,{{1}}                       ", 0856, 0886, NULL;
         |CONTROL_SIMPLE nPanta0, "LABEL,{{1}}                       ", 0956, 0986, NULL;
         |C_M #dsarz003#6, 1, "N";
         |C_V #dsarz003#6, 1, "N";
         |C_M #dsarz003#7, 1, "N";
         |C_V #dsarz003#7, 1, "N";
     |FINSI;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         |SI enGrupoTres = 0;
              |FOCOTECLADO nGrid1;
              FSalida = 1;  |HAZ Evento2;
         |FINSI;

         |SI enGrupoTres ! 0;
             #dsarm002#0 = enGrupoTres;
             |LEE 000#dsarm002.=

             #dsarm003#0 = enGrupoTres;
             #dsarm003#1 = enSubGTres;
             |LEE 000#dsarm003.=

             #dsarm004#0 = enGrupoTres;
             #dsarm004#1 = enSubGTres;
             #dsarm004#2 = enTipoTres;
             |LEE 000#dsarm004.=

             |REFRESCACONTROL nGrid3;
             |REFRESCACONTROL nGrid2;
             |REFRESCACONTROL nGrid1;


||             enGrupoTres = 0;
||             enSubGTres  = 0;
||             enTipoTres  = 0;
         |FINSI;

         FSalida = "::Salir," + nGrid1;
         |LEETECLA aTecla;

         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu;
             enGrupoTres = 0;
             enSubGTres  = 0;
             enTipoTres  = 0;
             |SAL;
         |FINSI;

         |PULSATECLA;
     |SIGUE;

     |SI enDocumento = 0;
         |FIN_CONTROL_WINDOWS nBoton1;
         |FIN_CONTROL_WINDOWS nBoton2;
     |SINO;
         |FIN_CONTROL_WINDOWS nBoton3;
     |FINSI;

     |DESTRUYECONTROL nGrid1;

     |SI #dsarm001#8 = "S";
         |DESTRUYECONTROL nGrid2;
         |DESTRUYECONTROL nGrid3;
     |FINSI;

     |SI nSwDameTres = 1;
          |ESTADO_CONTROL nIdSalir, "SHOW";
     |FINSI;

     |SI nVentana ! -1;
         |FINVENTANA nVentana;
     |FINSI;

     |PULSATECLA;

     |SI nSwParametroFichero = 1;
          |DBASE aBase;  |QBF aBase;
          aIntParametro = aBase + "intepara/";
          |MKDIR aIntParametro;

          aBorra = aIntParametro + aResto;
          |FBORRA aBorra;

          |XABRE "W", aBorra, nHandle;
          |SI FSalida ] 0;
               aLinea = (("000" + enGrupoTres) % -103) + (("000" + enSubGTres) % -103) + (("000" + enTipoTres) % -103);
               |XGRABA nHandle, aLinea;
          |FINSI;
          |XCIERRA nHandle;
     |FINSI;

     |SI nSwDameTres = 0;
          |SUB_EJECUTA "dpntz001;CLI";
     |FINSI;
|FPRO;

|VARIABLES;
     nConta = 0;
|FIN;

|PROCESO Tipo80;  |TIPO 80;
     |ABRE #dsarm001;
     |LEE 000#dsarm001.p;
     |SI FSalida ! 0;  |DDEFECTO #dsarm001;  |FINSI;
     |CIERRA #dsarm001;

     |HAZ LeeUnidadBasico;

     |SI #dsarm001#8 = "S";
          |HAZ RefrescaAuxTipos;
     |FINSI;

     aAux   = PARAMETRO % 108;
     |SI aAux = "DESPABOX";
         |HAZ TempoDESPANET;
         |SI nErrorDESPANET = 1;
             |ACABA;
         |FINSI;
     |SINO;
         aUsuario = Usuario % 810;

         |ABRE #dpntm001;
         #dpntm001#0 = aUsuario;
         |LEE 000#dpntm001.=;
         |SI FSalida = 0;
             nErrorDESPANET = 1;
             |CIERRA #dpntm001;
             |ACABA;
         |FINSI;
         |CIERRA #dpntm001;
     |FINSI;

     |ABRET #dsarm002;
     |ABRET #dsarm003;
     |ABRET #dsarm004;

     |ABRE #dsarm005;
     |LEE 000#dsarm005.p;
     |SI #dsarm005#0 = 0; |LEE 000#dsarm005.s; |FINSI;  || Compruebo si es el documento 0
                                         ||   y si lo es, no le hago caso. Leo
                                         ||   el siguiente.
     |SI #dsarm005#44 = 0;  |Y #dsarm005#45 = 0;  |Y #dsarm005#46 = 0;
         |CIERRA #dsarm005;

         |BUCLE dsarm005_z03;
     |FINSI;
     |CIERRA #dsarm005;

     |SI PARAMETRO ! "DAMETRE";
         FSalida = 3299;
     |FINSI;
|FPRC;

|PROCESO CompruebaFic;
     nOk  = 1;
     aFic = aLista < "";

     aAlfa = aFic - ".jpg";
     |SI FSalida ! 0;  nOk = 0;  |ACABA;  |FINSI;

     aAlfa = aFic - ".ini";
     |SI FSalida ! 0;  nOk = 0;  |ACABA;  |FINSI;

     aAlfa = aFic - ".exe";
     |SI FSalida ! 0;  nOk = 0;  |ACABA;  |FINSI;

     aAlfa = aFic - ".tgz";
     |SI FSalida ! 0;  nOk = 0;  |ACABA;  |FINSI;

     aAlfa = aFic - ".dll";
     |SI FSalida ! 0;  nOk = 0;  |ACABA;  |FINSI;

     aAlfa = aFic - ".sh";
     |SI FSalida ! 0;  nOk = 0;  |ACABA;  |FINSI;
|FPRC;

|PROCESO BorraDocCache;
     |HAZ LeeUnidadBasico;

     aLista = eaUnidadBasico + "\DOCUMENTOS\DSARCHI\*.*";
     |R_PDIR aLista;
     |PARA; |SI FSalida = 0; |HACIENDO;
          |HAZ CompruebaFic;

          |SI nOk = 1;
              |RFBORRA aLista;
          |FINSI;

          |R_SDIR aLista;
     |SIGUE;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |SI #dsarm001#8 = "S";
          |CIERRAT #dsarw067;

          |DELINDEX #dsarw067; Tempo = aTempo67; |HAZ BoraTempo;
     |FINSI;

     |CIERRAT #dsarm002;
     |CIERRAT #dsarm003;
     |CIERRAT #dsarm004;

     |SI enDESPANET = 1;
          aAux = PARAMETRO % 108;
          |SI aAux = "DESPABOX";
               |DELINDEX #dsarm002;
               |DELINDEX #dsarm003;
               |DELINDEX #dsarm004;
          |FINSI;
     |FINSI;

     |DBASE aAlfa;   |QBF aAlfa;
     aAlfa = aAlfa + "ocr/";
     aAlfa = aAlfa + "Envio" + Usuario + ".txt";
     |XABRE "E", aAlfa, 0;
     |SI FSalida ] 0;
         |SUB_EJECUTA "dsarw010;ENVIAAVISODIAGRAM";
     |FINSI;

     |SI #dsarm001#181 = "S";
          aAux = PARAMETRO % 107;
          |SI aAux ! "DAMETRE";
               |HAZ BorraDocCache;
          |FINSI;
     |FINSI;
|FPRC;
