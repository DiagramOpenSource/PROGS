|FICHEROS;
     dsarm001;
     dsarw046;
     dsarw047;
|FIN;

|INCLUYE z1000var;

|PROCESO VerModelo;
     |SI #dsarm001#7 = "N";
          |HAZ DimeUnidad;
     |SINO;
          |HAZ LeeUnidadBasico;

          eaUnidad = eaUnidadBasico % 101;
     |FINSI;

     |DBASE aPathBase;
     |QBF aPathBase;

     eaDestino = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "dsabreextension.exe";
     eaOrigen = aPathBase + "dlls/dsabreextension.exe";
     |HAZ EnviaFicheroConMD5;

     aAlfa = eaRuta + "/" + #dsarw046#10;  |QBF aAlfa;

     |XABRE "EC", aAlfa, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aEjecuta = "START " + eaUnidad + ":\DOCUMENTOS\DSARCHI\dsabreextension ";
     aEjecuta = aEjecuta + aAlfa;
     aEjecuta = aEjecuta + " " + eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";

     aAlfa  = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";
     |RFBORRA aAlfa;

     |RSYSTEM aEjecuta;
     aAlfa  = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";
     |PARA;  |SI;  |HACIENDO;
             |XABRE "EC", aAlfa, nHandle;
             |SI FSalida ] 0;
                 |SAL;
             |FINSI;

             |PARA nPausa = 1; |SI nPausa < 10000; |HACIENDO nPausa = nPausa + 1;
             |SIGUE;
             |PULSATECLA;
     |SIGUE;
     |PULSATECLA;

     aAlfa  = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";
     |RFBORRA aAlfa;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO VerModeloTXT;
     |SI #dsarm001#7 = "N";
          |HAZ DimeUnidad;
     |SINO;
          |HAZ LeeUnidadBasico;

          eaUnidad = eaUnidadBasico % 101;
     |FINSI;

     |DBASE aPathBase;
     |QBF aPathBase;

     eaDestino = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "dsabreextension.exe";
     eaOrigen = aPathBase + "dlls/dsabreextension.exe";
     |HAZ EnviaFicheroConMD5;

     aAlfa = eaRuta + "/" + #dsarw046#10;  |QBF aAlfa;
     aAlfa = aAlfa < " ";
     aAlfa = aAlfa - ".pdf" + ".txt";

     |XABRE "EC", aAlfa, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aEjecuta = "START " + eaUnidad + ":\DOCUMENTOS\DSARCHI\dsabreextension ";
     aEjecuta = aEjecuta + aAlfa;
     aEjecuta = aEjecuta + " " + eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";

     aAlfa  = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";
     |RFBORRA aAlfa;

     |RSYSTEM aEjecuta;
     aAlfa  = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";
     |PARA;  |SI;  |HACIENDO;
             |XABRE "EC", aAlfa, nHandle;
             |SI FSalida ] 0;
                 |SAL;
             |FINSI;

             |PARA nPausa = 1; |SI nPausa < 10000; |HACIENDO nPausa = nPausa + 1;
             |SIGUE;
             |PULSATECLA;
     |SIGUE;
     |PULSATECLA;

     aAlfa  = eaUnidad + ":\DOCUMENTOS\DSARCHI\" + "fin" + Usuario + ".txt";
     |RFBORRA aAlfa;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO CogeJustificante;
     aAlfa    = eaContenido;   |QBT aAlfa;
     aLong    = aAlfa % 0;
     nLong    = aLong;
     aCadena  = "";
     eaElect   = "";
     nSw1     = 0;
     |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos   = (nCarac * 100) + 1;
           aCarac =  aAlfa % nPos;
           |SI aCarac = ":";
               |SI nSw1 = 1;
                   eaElect  = aCadena % 116;
                   nSw2 = 0;
                   |SAL;
               |FINSI;

               aAlfa1 = aCadena - "Elect.";
               |SI FSalida ! 0;
                   nSw1 = 1;
               |FINSI;

               aCadena = "";
           |SINO;
               aCadena = aCadena + aCarac;
           |FINSI;
     |SIGUE;

     aAlfa    = eaContenido;   |QBT aAlfa;
     aLong    = aAlfa % 0;
     nLong    = aLong;
     eaJusti   = "";
     aCadena  = "";
     nSw1     = 0;
     |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos   = (nCarac * 100) + 1;
           aCarac =  aAlfa % nPos;
           |SI aCarac = ":";
               |SI nSw1 = 1;
                   eaJusti  = aCadena % 116;
                   nSw2    = 0;
                   |SAL;
               |FINSI;

               aAlfa1 = aCadena - "Just.";
               |SI FSalida ! 0;
                   nSw1 = 1;
               |FINSI;

               aCadena = "";
           |SINO;
               aCadena = aCadena + aCarac;
           |FINSI;
     |SIGUE;

     eaJusti = eaJusti % 113;
|FPRC;

|PROCESO CargaPeriodo;
     eaPeriodo = "";
     aCadena   = eaContenido;

     aBusco = aCadena - "1T";  |SI FSalida ! 0;  eaPeriodo = "03";  |ACABA;  |FINSI;
     aBusco = aCadena - "2T";  |SI FSalida ! 0;  eaPeriodo = "06";  |ACABA;  |FINSI;
     aBusco = aCadena - "3T";  |SI FSalida ! 0;  eaPeriodo = "09";  |ACABA;  |FINSI;
     aBusco = aCadena - "4T";  |SI FSalida ! 0;  eaPeriodo = "12";  |ACABA;  |FINSI;
     aBusco = aCadena - "01";  |SI FSalida ! 0;  eaPeriodo = "01";  |ACABA;  |FINSI;
     aBusco = aCadena - "02";  |SI FSalida ! 0;  eaPeriodo = "02";  |ACABA;  |FINSI;
     aBusco = aCadena - "03";  |SI FSalida ! 0;  eaPeriodo = "03";  |ACABA;  |FINSI;
     aBusco = aCadena - "04";  |SI FSalida ! 0;  eaPeriodo = "04";  |ACABA;  |FINSI;
     aBusco = aCadena - "05";  |SI FSalida ! 0;  eaPeriodo = "05";  |ACABA;  |FINSI;
     aBusco = aCadena - "06";  |SI FSalida ! 0;  eaPeriodo = "06";  |ACABA;  |FINSI;
     aBusco = aCadena - "07";  |SI FSalida ! 0;  eaPeriodo = "07";  |ACABA;  |FINSI;
     aBusco = aCadena - "08";  |SI FSalida ! 0;  eaPeriodo = "08";  |ACABA;  |FINSI;
     aBusco = aCadena - "09";  |SI FSalida ! 0;  eaPeriodo = "09";  |ACABA;  |FINSI;
     aBusco = aCadena - "10";  |SI FSalida ! 0;  eaPeriodo = "10";  |ACABA;  |FINSI;
     aBusco = aCadena - "11";  |SI FSalida ! 0;  eaPeriodo = "11";  |ACABA;  |FINSI;
     aBusco = aCadena - "12";  |SI FSalida ! 0;  eaPeriodo = "12";  |ACABA;  |FINSI;
|FPRC;

|PROCESO CargaPeriodoPdf;
     eaPeriodo = "";

     aCadena = eaContenido - "Ejercicio";
     |SI FSalida = 0;
         aCadena = eaContenido - eaEjercicio;
         aLong   = aCadena % 0;
         nLong   = aLong;
         |SI nLong > "2";  |ACABA;  |FINSI;
     |SINO;
         aCadena = eaContenido - eaEjercicio;
     |FINSI;

     aBusco = aCadena - "1T";  |SI FSalida ! 0;  eaPeriodo = "03";  |ACABA;  |FINSI;
     aBusco = aCadena - "2T";  |SI FSalida ! 0;  eaPeriodo = "06";  |ACABA;  |FINSI;
     aBusco = aCadena - "3T";  |SI FSalida ! 0;  eaPeriodo = "09";  |ACABA;  |FINSI;
     aBusco = aCadena - "4T";  |SI FSalida ! 0;  eaPeriodo = "12";  |ACABA;  |FINSI;
     aBusco = aCadena - "01";  |SI FSalida ! 0;  eaPeriodo = "01";  |ACABA;  |FINSI;
     aBusco = aCadena - "02";  |SI FSalida ! 0;  eaPeriodo = "02";  |ACABA;  |FINSI;
     aBusco = aCadena - "03";  |SI FSalida ! 0;  eaPeriodo = "03";  |ACABA;  |FINSI;
     aBusco = aCadena - "04";  |SI FSalida ! 0;  eaPeriodo = "04";  |ACABA;  |FINSI;
     aBusco = aCadena - "05";  |SI FSalida ! 0;  eaPeriodo = "05";  |ACABA;  |FINSI;
     aBusco = aCadena - "06";  |SI FSalida ! 0;  eaPeriodo = "06";  |ACABA;  |FINSI;
     aBusco = aCadena - "07";  |SI FSalida ! 0;  eaPeriodo = "07";  |ACABA;  |FINSI;
     aBusco = aCadena - "08";  |SI FSalida ! 0;  eaPeriodo = "08";  |ACABA;  |FINSI;
     aBusco = aCadena - "09";  |SI FSalida ! 0;  eaPeriodo = "09";  |ACABA;  |FINSI;
     aBusco = aCadena - "10";  |SI FSalida ! 0;  eaPeriodo = "10";  |ACABA;  |FINSI;
     aBusco = aCadena - "11";  |SI FSalida ! 0;  eaPeriodo = "11";  |ACABA;  |FINSI;
     aBusco = aCadena - "12";  |SI FSalida ! 0;  eaPeriodo = "12";  |ACABA;  |FINSI;
|FPRC;

|PROCESO LeeContenido;
     eaContenido = "";

     #dsarw047#0 = enLinea;
     |LEE 000#dsarw047.=;
     |SI FSalida = 0;
         eaContenido = #dsarw047#1;  |QBT eaContenido;
     |FINSI;
|FPRC;
