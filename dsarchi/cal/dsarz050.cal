|FICHEROS;
     dsarm001;
     dsarm005;
     dsarm008;
     dsarm044;
     dsarm055;
     dsarm056;

     dsarm044@;
|FIN;

|VARIABLES;
     aBorra           = "";
     aDirVistas       = "";
     aFichero         = "";
     aAlfa            = "";
     aBase            = "";
     aDef             = "";

     nVentTrab        = 0;
     nNume            = 0;
     nGrupo           = 0;
     nSubGrupo        = 0;
     nTipo            = 0;
     nLabel           = -1;

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     &eaCodVista   = "";
|FIN;

|PROCESO dsarm005;
     |HAZ IndexaTiempoReal;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsarm005Todo;
     #dsarm005#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsarm005;
|FIN;

|DEFBUCLE dsarm005Tipos;
     #dsarm005#2;
     ;
     nGrupo, nSubGrupo, nTipo,         1;
     nGrupo, nSubGrupo, nTipo, 999999999;
     ;
     NULL, dsarm005;
|FIN;

|PROCESO dsarm044;
     aAlfa = #dsarm044@#1 % 103;  nGrupo    = aAlfa;
     aAlfa = #dsarm044@#1 % 403;  nSubGrupo = aAlfa;
     aAlfa = #dsarm044@#1 % 703;  nTipo     = aAlfa;

     |BUCLE dsarm005Tipos;
|FPRC;

|DEFBUCLE dsarm044;
     #dsarm044@#1002;
     4;
     eaCodVista, "         ", "S";
     eaCodVista, "zzzzzzzzz", "S";
     ;
     NULL, dsarm044;
|FIN;

|PROGRAMA;
     |DBASE aDirVistas;  |QBF aDirVistas;
     aDirVistas = aDirVistas + "vistas";  |MKDIR aDirVistas;
     aDirVistas = aDirVistas + "/";

     |ABRE #dsarm001;
     |LEE 000#dsarm001.p;
     |SI FSalida ! 0;  |DDEFECTO #dsarm001;  |FINSI;
     |CIERRA #dsarm001;

     |SI #dsarm001#191 = "N";
         |MENAV "0000La aplicaci¢n no tiene activada la vista r pida, act¡vela en par metros generales";
         |ACABA;
     |FINSI;

     |SI eaCodVista ! "";
         |MENAV "0000Se va a proceder a regenerar la tabla de la vistas r pidas de la vista que acaba de crear o modificar";
     |FINSI;

     |VENTANA 0502, 0582, -1, 16, "Procesando trabajo. Esto puede tardar varios minutos.";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;
     |PAUSA;

     |SI eaCodVista = "";
         aBorra = aDirVistas + "v*.*";
         |_PDIR aBorra;
         |PARA; |SI FSalida = 0; |HACIENDO;
              |FBORRA aBorra;
              |_SDIR aBorra;
         |SIGUE;

         |BUCLE dsarm005Todo;
     |SINO;
         |ABRE #dsarm008;
         #dsarm008#0 = eaCodVista;
         |LEE 000#dsarm008.=;
         |SI FSalida ! 0;  |DDEFECTO #dsarm008;  |FINSI;
         |CIERRA #dsarm008;

         |SI #dsarm008#31 ! 0;
             aBorra = aDirVistas + "va" + (("000000" + #dsarm008#31) % -106) + ".dat";
             |FBORRA aBorra;

             aBorra = aDirVistas + "va" + (("000000" + #dsarm008#31) % -106) + ".ddx";
             |FBORRA aBorra;

             aBorra = aDirVistas + "va" + (("000000" + #dsarm008#31) % -106) + ".ixx";
             |FBORRA aBorra;

             aBorra = aDirVistas + "vb" + (("000000" + #dsarm008#31) % -106) + ".dat";
             |FBORRA aBorra;

             aBorra = aDirVistas + "vb" + (("000000" + #dsarm008#31) % -106) + ".ddx";
             |FBORRA aBorra;

             aBorra = aDirVistas + "vb" + (("000000" + #dsarm008#31) % -106) + ".ixx";
             |FBORRA aBorra;
         |FINSI;

         aAlfa = "LABEL,{{15}}Indexando vista: " + #dsarm008#0;  |QBF aAlfa;
         |CONTROL_SIMPLE 0, aAlfa, 0502, 0578, NULL;
         nLabel = FSalida;

         |PTEC 802;  |PAUSA;

         |DBASE aBase;  |QBF aBase;
         aDef = aBase + "def/dsarm044";
         |CARGA_DEF aDef, dsarm044@;

         |BUCLE dsarm044;

         |DESCARGA_DEF #dsarm044@;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentTrab;
|FPRO;
