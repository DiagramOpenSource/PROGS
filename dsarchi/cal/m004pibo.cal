|FICHEROS;
     dpntm001;
     dpntm004;

     dpntw007,MANTE;

     &labtraba@;
|FIN;

|VARIABLES;
     nUsuDespabox = 0;
     aUsuDespabox = "";
     nNumeroEnviados    = 0;
     nVentana           = 0;
     nBtnMT             = -1;
     nBtnDT             = -1;
     nBtnED             = -1;
     nBtnEA             = -1;
     nBtnEC             = -1;
     nBtnAD             = -1;
     nRango             = 0;
     nGrid              = 0;
     nTrabCapturados    = 0;
     nCorreosActuali    = 0;
     nPanW7             = 0;
     nOk                = 0;

     aEsc1              = "";
     aEsc2              = "";
     aRetu              = "";
     aTecla             = "";
     aBase              = "";
     aLaboral           = "";
     aDef               = "";
     aMensaje           = "";
     aAlfa              = "";

     aUsuario           = "";
     aCorreo            = "";
     nVentCorreo        = 0;
     aMarca             = "";
     aVerde             = "0,185,0;255,255,255";
     aRojo              = "255,80,80;255,255,255";
     aHora              = "";
     aFecha             = "";

     fFecha             = @;

     {-1}aVent          = "";
         aVent1         = 0;
         aVent2         = 0;
         aVent3         = 0;
         aVent4         = 0;
         aVent5         = "";

     &enEmpresa         = 0;
     &eaModoNet         = "";
     &eaUsuNet          = "";
     &eaFechaNet        = "";
     &eaAccesoNet       = "";
     &eaEmpNet          = "";
     &eaTraNet          = "";
     &eaAccNet          = "";
     &eaMaiNet          = "";
     &eaDesNet          = "";
     &eaLabNet          = "";
     &eaAcceso          = "";
     &eaDni             = "";
     &eaEmail           = "";
     &enSwHayRegistros  = 0;
|FIN;

|PROCESO PonColor_Pibox;
     eaEmail = #dpntm004#4;  |QBF eaEmail;

                                nOk = 1;
     |SI #labtraba@#44  ! "A";  nOk = 0;  |FINSI;
     |SI #labtraba@#142 ! "S";  nOk = 0;  |FINSI;
     |SI eaEmail        =  "";  nOk = 0;  |FINSI;

     #dpntm004#6  = "N";
     |SI nOk = 1;
         #dpntm004#6  = "S";
     |FINSI;

     #dpntm004#9 = "";

     eaEmail = #dpntm004#4;   |QBF eaEmail;
     |SI eaEmail = "";
         #dpntm004#9 = aRojo;
     |FINSI;

     |SI #labtraba@#44 ! "A";
         #dpntm004#9 = aRojo;
     |FINSI;

     |SI #dpntm004#6  = "S";
         #dpntm004#9 = aVerde;
     |FINSI;
|FPRC;

|PROCESO Evento4_Pibox;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dpntm004.=;
         |SI FSalida = 0;
             |SI nBtnEC ! -1;  |ESTADO_CONTROL nBtnEC, "ENABLE";  |FINSI;

             |ESTADO_CONTROL nBtnED, "ENABLE";
             |ESTADO_CONTROL nBtnAD, "DISABLE";

             aAlfa = #dpntm004#9;   |QBF aAlfa;
             |SI aAlfa = "";  |O #dpntm004#6 = "S";
                 |ESTADO_CONTROL nBtnAD, "ENABLE";
             |FINSI;
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
         |HAZ Activa_Pibox;
     |FINSI;
|FPRC;

|PROCESO labtraba_Pibox;
     eaDni = #labtraba@#7;  |QBF eaDni;

     #dpntm004#0 = enEmpresa;
     #dpntm004#1 = eaDni;
     |LEE 101#dpntm004.=;
     |SI FSalida ! 0;
         |DDEFECTO #dpntm004;
         #dpntm004#0  = enEmpresa;
         #dpntm004#1  = eaDni;
         #dpntm004#2  = #labtraba@#1;
         #dpntm004#3  = #labtraba@#2;
         #dpntm004#4  = #labtraba@#127;
         |SI #labtraba@#36 ! "          ";
             #dpntm004#11 = #labtraba@#36;
         |FINSI;

         nUsuDespabox = #dpntm004#8;
         |SI nUsuDespabox = 0;
              aUsuDespabox = (("00000" + #dpntm004#0) % -105) + (("00000" + #dpntm004#2) % -105) ;
              #dpntm004#8 = aUsuDespabox;
         |FINSI;

         |GRABA 020#dpntm004.b;
         nTrabCapturados = nTrabCapturados + 1;
     |FINSI;

     fFecha = #labtraba@#36;
     |SI #dpntm004#2 ! #labtraba@#1;
         |SI fFecha < #dpntm004#11;
             |ACABA;
         |FINSI;
     |FINSI;

     #dpntm004#2  = #labtraba@#1;
     #dpntm004#11 = fFecha;
     #dpntm004#4  = #labtraba@#127;

     |HAZ PonColor_Pibox;

     nUsuDespabox = #dpntm004#8;
     |SI nUsuDespabox = 0;
          aUsuDespabox = (("00000" + #dpntm004#0) % -105) + (("00000" + #dpntm004#2) % -105) ;
          #dpntm004#8 = aUsuDespabox;
     |FINSI;

     |GRABA 020#dpntm004.a;
     |LIBERA #dpntm004;
|FPRC;

|DEFBUCLE labtraba_Pibox;
     #labtraba@#1002;
     ;
     enEmpresa, 00001;
     enEmpresa, 99999;
     ;
     NULL, labtraba_Pibox;
|FIN;

|PROCESO dpntm004_Pibox;
     #labtraba@#0 = #dpntm004#0;
     #labtraba@#1 = #dpntm004#2;
     |LEE 101#labtraba@.=;
     |SI FSalida ! 0;
         |BORRA 020#dpntm004.a;
         |LIBERA #dpntm004;
         |ACABA;
     |FINSI;

     |HAZ PonColor_Pibox;

     nUsuDespabox = #dpntm004#8;
     |SI nUsuDespabox = 0;
          aUsuDespabox = (("00000" + #dpntm004#0) % -105) + (("00000" + #dpntm004#2) % -105) ;
          #dpntm004#8 = aUsuDespabox;
     |FINSI;

     |GRABA 020#dpntm004.a;
     |LIBERA #dpntm004;
|FPRC;

|DEFBUCLE dpntm004_Pibox;
     #dpntm004#1;
     ;
     enEmpresa, "            ";
     enEmpresa, "zzzzzzzzzzzz";
     be;
     NULL, dpntm004_Pibox;
|FIN;

|PROCESO CargaTrab_Pibox;
     |BUCLE dpntm004_Pibox;
     |BUCLE labtraba_Pibox;
|FPRC;

|PROCESO Activa_Pibox;
     |LEE 101#dpntm004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #labtraba@#0 = enEmpresa;
     #labtraba@#1 = #dpntm004#2;
     |LEE 101#labtraba@.=;
     |SI FSalida = 0;
         |SI #labtraba@#142 = "S";
             #labtraba@#142 = "N";
         |SINO;
             #labtraba@#142 = "S";
         |FINSI;

         |GRABA 020#labtraba@.a;
         |LIBERA #labtraba@;
     |FINSI;

     |HAZ PonColor_Pibox;

     nUsuDespabox = #dpntm004#8;
     |SI nUsuDespabox = 0;
          aUsuDespabox = (("00000" + #dpntm004#0) % -105) + (("00000" + #dpntm004#2) % -105) ;
          #dpntm004#8 = aUsuDespabox;
     |FINSI;

     |GRABA 020#dpntm004.a;
     |LIBERA #dpntm004;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Edita_Pibox;
     |VENTANA 0501, 1599, -1, 16, "Editar datos trabajador";
     nVentCorreo = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentCorreo;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     #dpntw007#0 = #dpntm004#4;
     #dpntw007#1 = #dpntm004#10;

     |PINPA #0#dpntw007;      nPanW7 = FSalida;

     |C_V #dpntw007#1, 1, "N";  |C_M #dpntw007#1, 1, "N";
     |C_V #dpntw007#2, 1, "N";

     |CONTROL_SIMPLE nPanW7, "LABEL,{{11}}            ", 0902, 1573, NULL;

     eaDni = #dpntm004#1;  |QBF eaDni;

     |PINDA #0#dpntw007;
     |ENDATOS #2#dpntw007;
     |SI FSalida = 0;
          |SI #dpntm004#4 ! #dpntw007#0;
              #dpntm004#4  = #dpntw007#0;
          |FINSI;

          #labtraba@#0 = enEmpresa;
          #labtraba@#1 = #dpntm004#2;
          |LEE 000#labtraba@.=;
          |SI FSalida ! 0;  |DDEFECTO #labtraba@;  |FINSI;

          |HAZ PonColor_Pibox;

          nUsuDespabox = #dpntm004#8;
          |SI nUsuDespabox = 0;
               aUsuDespabox = (("00000" + #dpntm004#0) % -105) + (("00000" + #dpntm004#2) % -105) ;
               #dpntm004#8 = aUsuDespabox;
          |FINSI;
          |GRABA 020#dpntm004.a;

          eaEmail = #dpntw007#0;
          |HAZ GrabaEmailTraba;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentCorreo;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentCorreo;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Baja4_Pibox;
     #dpntm004#0 = enEmpresa;
     #dpntm004#1 = "";
|FPRC;

|PROCESO Alta4_Pibox;
     #dpntm004#0 = enEmpresa;
     #dpntm004#1 = "z" * 12;
|FPRC;

|PROCESO Pibox;
     nTrabCapturados    = 0;
     nCorreosActuali    = 0;
     |HAZ CargaTrab_Pibox;
     |SI enSwHayRegistros = 0; |Y nTrabCapturados = 0;
          aMensaje = "0000Esta empresa NO tiene trabajadores definidos";
          |MENAV aMensaje;
     |FINSI;

     |CLS;
     aAlfa = "Acceso Trabajadores " + eaAcceso;
     |CABEZA aAlfa;

     aAlfa = "Acceso " + eaAcceso + " Trabajadores Empresa: " + #dpntm001#2;  |QBF aAlfa;
     |VENTANA 0501, 2899, -1, 16, aAlfa;
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}Doble click en el registro para HABILITAR o DESHABILITAR", 0502, 0598, NULL;

     |CONTROL_SIMPLE 0, "BOTON,Editar datos trabajador", 2570, 2682, Edita_Pibox;
     nBtnED = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Habilitar/Deshabilitar trabajador", 2584, 2698, Activa_Pibox;
     nBtnAD = FSalida;

     |SI nBtnEC ! -1;  |ESTADO_CONTROL nBtnEC, "DISABLE";  |FINSI;

     |ESTADO_CONTROL nBtnED, "DISABLE";
     |ESTADO_CONTROL nBtnAD, "DISABLE";

     |C_V #dpntm004#5, 1, "N";

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#dpntm004, nRango, 0602, 2498, Baja4_Pibox, Alta4_Pibox, Evento4_Pibox;
     nGrid = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |DESTRUYECONTROL nGrid;

     |FIN_CONTROL_WINDOWS nBtnED;
     |FIN_CONTROL_WINDOWS nBtnAD;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;
|FPRC;
