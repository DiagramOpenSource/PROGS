|| Esto tambien esta en contagen


|FICHEROS;
     dpntw100 #900,MANTE;

     :/basica/def/agicen14 #714;

     &regisnif@ #709;
|FIN;

|VARIABLES;
     nOpcion        = 0;
     nTotalLinea    = 0;
     nConta         = 0;
     nBaffer        = 0;
     nCogeOpcion    = 0;
     nError         = 0;
     nPos           = 0;
     nComp          = 0;
     nLCod          = 0;
     nVentana       = 0;
     nCalc          = 0;
     nID            = 0;
     nEmpresa       = 0;
     nActiv         = 0;

     aAlfa          = "";
     aContenido     = "";
     aTabla         = "";
     aFTabla        = "";
     aDestino       = "";
     aAlfa1         = "";
     aID            = "";

  {20}aPopup        = "";

     {-1}aVent      = "";
         aVent1     = 0;
         aVent2     = 0;
         aVent3     = 0;
         aVent4     = 0;
         aVent5     = "";

     &eaVarDni      = "";
     &enCalcCif     = 0;
     &eaCodNif      = "";
     &eaAlfa        = "";
     &enError       = 0;
     &eaUsuario     = "";
|FIN;

|PROCESO Tipo12Fw100;  |TIPO 12;
     |SI FSalida ! 1;  |ACABA;  |FINSI;

     |PULSATECLA;

     aAlfa = #900#13;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000Numero identificaci¢n de la factura sin contenido.";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #900#21 = 0;
         |MENAV "0000La base imponible puede ser cero. Ponga un importe distinto a cero";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO agicen14_w100;
     nConta = nConta + 1;
     nActiv = #714#1;
|FPRC;

|DEFBUCLE agicen14_w100;
     #714#1;
     6;
     nEmpresa, 01, "01.01.0000";
     nEmpresa, 99, "01.01.0000";
     ;
     NULL, agicen14_w100;
|FIN;

|PROCESO Tipo7C1Fw100; |TIPO 7;
     nEmpresa = eaUsuario;
     nConta   = 0;
     |BUCLE agicen14_w100;

     |C_M #900#1, 1, "S";
     |SI nConta = 1;
         |C_M #900#1, 1, "N";
         #900#1 = nActiv;
     |FINSI;

     |PINTA #900#1;
|FPRC;

|PROCESO Baja714_w100;
     #714#0 = nEmpresa;
     #714#1 = 01;
|FPRC;

|PROCESO Alta714_w100;
     #714#0 = nEmpresa;
     #714#1 = 99;
|FPRC;

|PROCESO Tipo66C1Fw100; |TIPO 66;
     |ABRE #714;
     #714#0 = eaUsuario;
     #714#1 = #900#1;
     |LEE 000#714=;

     |CONSULTA_F_CLAVE #1#714, Baja714_w100, Alta714_w100;
     |SI FSalida = 0;
         #900#1  = #714#1;
         #900#46 = #714#4;
     |FINSI;
     |CIERRA #714;

     |PINTA #900#1;
     |PINTA #900#46;
|FPRC;

|PROCESO Tipo0C1Fw100; |TIPO 0;
     |ABRE #714;
     #714#0 = eaUsuario;
     #714#1 = #900#1;
     |LEE 000#714=;
     |SI FSalida ! 0;
         |MENAV "0000No existe la Actividad";
         |CIERRA #714;
         |ERROR;
         |ACABA;
     |FINSI;
     |CIERRA #714;

     |SI #714#6 ! "01.01.0000";
         |MENAV "0000La actividad est  dada de baja";
         |ERROR;
         |ACABA;
     |FINSI;

     #900#1  = #714#1;
     #900#46 = #714#4;

     |PINTA #900#1;
     |PINTA #900#46;
|FPRC;

|PROCESO Tipo6C2Fw100;  |TIPO 6;
     eaVarDni  = #900Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #900Campo ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #900Campo = eaVarDni;  |PINTA #900Campo;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     aContenido = Contenido;
     |SI #900#2 = aContenido;  |ACABA;   |FINSI;

     eaCodNif  = #900#2;
     |HAZ LeeNifs;

     |ABRE #709;
     #709#0 = #900#2;
     |LEE 000#709=;
     |SI FSalida = 0;
         #900#4  = #709#1;
         #900#5  = #709#12;
         #900#47 = #709#13;
     |FINSI;
     |CIERRA #709;

     |SI #900#5  = "   ";
         #900#5  = "ES";
         #900#47 = "ESPAÑA";
     |FINSI;

     |PINTA #900#4;
     |PINTA #900#5;
     |PINTA #900#47;

     aAlfa = #900#2 % 101;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         #900#6  = "4";
         #900#48 = "Documento Oficial de identificacion expedido por el pais o territorio de residencia";

         |PINTA #900#6;
         |PINTA #900#48;
     |FINSI;
|FPRC;

|PROCESO CargaTablaFw100;
     |DBASS aTabla;  |QBF aTabla;
     aTabla = aTabla + "modelos/fich/";

     aTabla      = aTabla + aFTabla;
     nOpcion     = 1;
     nTotalLinea = 0;
     nConta      = -1;
     nBaffer     = 0;

     |LEESECUENCIAL aTabla, nBaffer, nTotalLinea, 0, 0;
|FPRC;

|PROCESO SacaTablaFw100;
     |VENTANA 1750, 2885, -1, 17, "Paises";
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PARA; |SI;  |HACIENDO;
          nOpcion = 1;
          |BMENUG nBaffer, 0, 1, nTotalLinea, 1545, nOpcion;
          nOpcion     = FSalida;
          nCogeOpcion = nOpcion - 1;
          |SI FSalida [ nTotalLinea; |Y FSalida ] 1;
              |DEL_BUF nBaffer, nCogeOpcion, aDestino;

              |SAL;
         |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;
|FPRC;

|PROCESO CompruebaTablaFw100;
     enError = 1;
     nPos    = 100 + nComp;

     |LEESECUENCIAL aTabla, nBaffer, nTotalLinea, 0, 0;
     |PARA nConta = 0;  |SI nConta [ nTotalLinea;  |HACIENDO nConta = nConta + 1;
         |DEL_BUF nBaffer, nConta, aDestino;
         aAlfa = aDestino % nPos;

         |QBF aAlfa;
         |QBF eaAlfa;

         |SI aAlfa = eaAlfa;  enError = 0;  |SAL;  |FINSI;
     |SIGUE;

     |FINDIM nBaffer;
|FPRC;

|PROCESO FinTablaFw100;
     |FINDIM nBaffer;
|FPRC;

|PROCESO Tipo7C5Fw100; |TIPO 7;
     aFTabla = "ztabla05.txt";
     nLCod   = 2;
     |HAZ CargaTablaFw100;
|FPRC;

|PROCESO Tipo66C5Fw100; |TIPO 66;
     |HAZ SacaTablaFw100;
     aAlfa1  = aDestino % 102;  #900#5  = aAlfa1;
     aAlfa1  = aDestino % 440;  #900#47 = aAlfa1;

     |PINTA #900#5;
     |PINTA #900#47;
|FPRC;

|PROCESO Tipo0C5Fw100; |TIPO 0;
     nComp = nLCod;
     aAlfa = "|C010TIPO"; aAlfa1 = #900aAlfa;
     aAlfa = #900#5; |QBF aAlfa;
     |SI aAlfa1 = "N"; nCalc = - (100 + nLCod); aAlfa = (("0" * nComp) + aAlfa) % nCalc; |FINSI;
     |SI aAlfa1 ! "N"; nCalc = 100 + nLCod;     aAlfa = (aAlfa + (" " * nComp)) % nCalc; |FINSI;
     eaAlfa = aAlfa;
     |HAZ CompruebaTablaFw100;

     |SI enError = 1;
         |MENAV "0000 Contenido Incorrecto. Consulta la Tabla con F2";
         |ERROR;
         |PULSATECLA;
         |ACABA;
     |FINSI;

     aAlfa1  = aDestino % 102;  #900#5  = aAlfa1;  |PINTA #900#5;
     aAlfa1  = aDestino % 440;  #900#47 = aAlfa1;  |PINTA #900#47;

     |HAZ FinTablaFw100;
|FPRC;

|PROCESO Tipo66C6Fw100;  |TIPO 66;
     aAlfa = "|C006WID";
     aID   = #900#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 6;
     aPopup3  = "1 NIF";
     aPopup4  = "2 NIF/IVA (NIF operador intracomunitario)";
     aPopup5  = "3 Pasaporte";
     aPopup6  = "4 Documento Oficial de identificacion expedido por el pais o territorio de residencia";
     aPopup7  = "5 Certificado de residencia fiscal";
     aPopup8  = "6 Otro documento probatorio";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 101;  #900#6  = aAlfa;
         aAlfa = aPopup % 360;  #900#48 = aAlfa;
     |FINSI;

     |PINTA #900#6;
     |PINTA #900#48;
|FPRC;

|PROCESO Tipo0C6Fw100;   |TIPO 0;
     #900#48 = "";

     |SI #900#6 = "1";
         #900#48 = "NIF";
     |FINSI;

     |SI #900#6 = "2";
         #900#48 = "NIF/IVA (NIF operador intracomunitario)";
     |FINSI;

     |SI #900#6 = "3";
         #900#48 = "Pasaporte";
     |FINSI;

     |SI #900#6 = "4";
         #900#48 = "Documento Oficial de identificacion expedido por el pais o territorio de residencia";
     |FINSI;

     |SI #900#6 = "5";
         #900#48 = "Certificado de residencia fiscal";
     |FINSI;

     |SI #900#6 = "6";
         #900#48 = "Otro documento probatorio";
     |FINSI;

     |PINTA #900#48;

     aAlfa = #900#48;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000 Clave identificaci¢n pais de residencia incorrecto";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo66C8Fw100;  |TIPO 66;
     aAlfa = "|C008WID";
     aID   = #900#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 15;
     aPopup3  = "  Operación habitual";
     aPopup4  = "A Asiento resumen de facturas";
     aPopup5  = "B Asiento resumen de tiques";
     aPopup6  = "C Factura con varios asientos (varios tipo impositivos)";
     aPopup7  = "D Factura rectificativa";
     aPopup8  = "E IVA devengado pendiente de emitir factura";
     aPopup9  = "G Régimen especial de grupo de entidades en IVA o IGIC";
     aPopup10 = "H Régimen especial de oro de inversión";
     aPopup11 = "I Inversión del Sujeto pasivo (ISP)";
     aPopup12 = "J Tiques";
     aPopup13 = "K Rectificación anotaciones registrales";
     aPopup14 = "M IVA facturado pendiente de devengar (emitida factura)";
     aPopup15 = "N Facturación de las prestaciones de servicios de agencias de viaje que actúan como mediadoras en nombre y por cuenta ajena";
     aPopup16 = "O Factura emitida en sustitución de tiques facturados y declarados.";
     aPopup17 = "Q Operaciones a las que se aplique el régimen especial de bienes usados, ...";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 101;  #900#8  = aAlfa;
         aAlfa = aPopup % 380;  #900#49 = aAlfa;
     |FINSI;

     |PINTA #900#8;
     |PINTA #900#49;
|FPRC;

|PROCESO Tipo0C8Fw100;  |TIPO 0;
     #900#49 = "";
     |SI #900#8 = " ";
         #900#49 = "Operaci¢n habitual";
     |FINSI;

     |SI #900#8 = "A";
         #900#49 = "Asiento resumen de facturas";
     |FINSI;

     |SI #900#8 = "B";
         #900#49 = "Asiento resumen de tiques";
     |FINSI;

     |SI #900#8 = "C";
         #900#49 = "Factura con varios asientos (varios tipo impositivos)";
     |FINSI;

     |SI #900#8 = "D";
         #900#49 = "Factura rectificativa";
     |FINSI;

     |SI #900#8 = "E";
         #900#49 = "IVA devengado pendiente de emitir factura";
     |FINSI;

     |SI #900#8 = "G";
         #900#49 = "Rgimen especial de grupo de entidades en IVA o IGIC";
     |FINSI;

     |SI #900#8 = "H";
         #900#49 = "Rgimen especial de oro de inversi¢n";
     |FINSI;

     |SI #900#8 = "I";
         #900#49 = "Inversi¢n del Sujeto pasivo (ISP)";
     |FINSI;

     |SI #900#8 = "J";
         #900#49 = "Tiques";
     |FINSI;

     |SI #900#8 = "K";
         #900#49 = "Rectificación anotaciones registrales";
     |FINSI;

     |SI #900#8 = "M";
         #900#49 = "IVA facturado pendiente de devengar (emitida factura)";
     |FINSI;

     |SI #900#8 = "N";
         #900#49 = "Facturaci¢n de las prestaciones de servicios de agencias de viaje que actúan como mediadoras en nombre y por cuenta ajena";
     |FINSI;

     |SI #900#8 = "O";
         #900#49 = "Factura emitida en sustituci¢n de tiques facturados y declarados.";
     |FINSI;

     |SI #900#8 = "Q";
         #900#49 = "Operaciones a las que se aplique el rgimen especial de bienes usados, ...";
     |FINSI;

     aAlfa = #900#49;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000 Clave de operaci¢n incorrecta";
         |ERROR;
         |ACABA;
     |FINSI;

     |PINTA #900#49;

     |C_M #900#9,  1, "S";
     |C_M #900#11, 1, "S";
     |C_M #900#12, 1, "S";
     |SI #900#8 ! "A";  |Y #900#8 ! "B";
         |C_M #900#9,  1, "N";  #900#9  = 1;
         |C_M #900#11, 1, "N";  #900#11 = "";
         |C_M #900#12, 1, "N";  #900#12 = "";
     |FINSI;

     |C_M #900#10, 1, "S";
     |SI #900#8 ! "C";
         |C_M #900#10, 1, "N";  #900#10 = 1;
     |FINSI;

     |PINTA #900#9;
     |PINTA #900#10;
     |PINTA #900#11;
     |PINTA #900#12;
|FPRC;

|PROCESO Tipo0C18Fw100;  |TIPO 0;
     |C_M #900#19, 1, "S";
     |SI #900#18 = "N";
         |C_M #900#19, 1, "N";  #900#19 = "";
     |FINSI;

     |PINTA #900#19;
|FPRC;

|PROCESO Tipo0C42Fw100;  |TIPO 0;
     |SI FSalida = 0;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo0C28Fw100;  |TIPO 0;
     |SI #900Campo = Contenido;  |ACABA;  |FINSI;

     #900#23 = #900#21 % #900#22;
     #900#25 = #900#21 % #900#24;
     #900#27 = #900#21 % #900#26;

     #900#32 = #900#30 % #900#31;
     #900#34 = #900#30 % #900#33;
     #900#36 = #900#30 % #900#35;

     #900#39 = #900#37 % #900#38;
     #900#41 = #900#37 % #900#40;
     #900#43 = #900#37 % #900#42;

     #900#28 = #900#21 + #900#23 + #900#25 - #900#27;
     #900#28 = #900#28 + #900#30 + #900#32 + #900#34 - #900#36;
     #900#28 = #900#28 + #900#37 + #900#39 + #900#41 - #900#43;

     |PINTA #900#23;
     |PINTA #900#25;
     |PINTA #900#27;
     |PINTA #900#32;
     |PINTA #900#34;
     |PINTA #900#36;
     |PINTA #900#39;
     |PINTA #900#41;
     |PINTA #900#43;
     |PINTA #900#28;
|FPRC;
