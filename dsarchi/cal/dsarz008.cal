|FICHEROS;
     dsarm001 #1;
     dsarz008 #908;

     origen@  #5;
     destino@ #905;
|FIN;

|VARIABLES;
     aNuevaCad = "";
     aLong = "";
     nLong = 0;
     nVoy = 0;
     nSaca = 0;
     aSaca = "";
     aLetra = "";

     nTotalCampos = 0;
     aDirConta = "";
     aDirDatos = "";
     aDef = "";

     aAplicacion = "";
     aParametro = "";
     aMensaje = "";
     aNomDef = "";
     aEmpresa = "";
     aEjercicio = "";

     nPanta0      = 0;
     nCampo       = 0;
     nHandle      = 0;
     nNume        = 0;
     nVentz2      = 0;
     nBotonLabel  = 0;

     aAlfa        = "";
     aAlfa1       = "";
     aMas         = "";
     aFicheroSql  = "";
     aCadena      = "";
     aBase        = "";
     aOrigen      = "";
     aDestino     = "";
     aFichOri     = "";
     aFichDes     = "";

     {-1}aVent      = "";
         aVent1     = 0;
         aVent2     = 0;
         aVent3     = 0;
         aVent4     = 0;
         aVent5     = "";

     &enDocumento = 0;
     &eaFichero   = "";
     &enError     = 0;
|FIN;

|PROCESO Tipo12Fz002;  |TIPO 12;
     |SI FSalida = 7;  enError = 1;   |ACABA;   |FINSI;

     |VENTANA 0501, 2699, -1, 16, "Buscando registros ...";
     nVentz2  = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentz2;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "LABEL,{{5}}Buscando registros ...", 1315, 1680, NULL;
     nBotonLabel = FSalida;

     |PTEC 802;   |PAUSA;
     |PULSATECLA;

     aFichOri = aNomDef;
     aFichDes = eaFichero;

     |DBASE aBase;
     aAlfa = aBase + "tmp";  |MKDIR aAlfa;
     aFicheroSql = aAlfa  + "/sql" + Usuario + ".txt";
     |XABRE "WB", aFicheroSql, nHandle;

     aCadena = #908#0;  |QBF aCadena;
     |SI #908#1 = "I";
          ||Sustituir las "," por ".";
          aNuevaCad = "";
          aLong = aCadena % A0;
          nLong = aLong;
          |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
               nSaca = 100 * nVoy;
               nSaca = nSaca + 1;
               aSaca = nSaca;
               aLetra = aCadena % aSaca;
               |SI aLetra = ","; |O aLetra = "'";
                    aNuevaCad = aNuevaCad + ".";
               |SINO;
                    aNuevaCad = aNuevaCad + aLetra;
               |FINSI;
          |SIGUE;
          aCadena = aNuevaCad;
     |FINSI;

     aCadena = "'" + aCadena + "'";  |QBF aCadena;

     aAlfa = "* FROM " + aFichOri + " INTO " + aFichDes + " WHERE ";
     |XGRABA nHandle, aAlfa;

     |SI #908#1 = "D";
         |SI aNomDef = "camaasil";
               aAlfa =  " 7 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
         |FINSI;
         |SI aNomDef = "camaniva";
               aAlfa =  " 22 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 24 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 25 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 28 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 30 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
         |FINSI;
         |SI aNomDef = "cacuenta";
               aAlfa =  " 2 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
         |FINSI;
         |SI aNomDef = "dsmom041";
               aAlfa =  " 4 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
         |FINSI;
     |FINSI;

     |SI #908#1 = "I";
         |SI aNomDef = "camaasil";
               aAlfa =  " 9 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
         |FINSI;
         |SI aNomDef = "camaniva";
               aAlfa =  " 19 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 20 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 21 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 23 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 26 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
         |FINSI;
         |SI aNomDef = "cacuenta";
               aAlfa =  " 48 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 49 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 50 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 51 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 52 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 53 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
         |FINSI;
         |SI aNomDef = "dsmom041";
               aAlfa =  " 10 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 15 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 16 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 21 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
               aAlfa = " OR 22 LIKE " + aCadena;
               |XGRABA nHandle, aAlfa;
         |FINSI;
     |FINSI;

     |SI #908#1 = "T";
          |SI aNomDef = "camaasil";
               nTotalCampos = 30;
          |FINSI;
          |SI aNomDef = "camaniva";
               nTotalCampos = 40;
          |FINSI;
          |SI aNomDef = "cacuenta";
               nTotalCampos = 61;
          |FINSI;
          |SI aNomDef = "dsmom041";
               nTotalCampos = 40;
          |FINSI;
          |PARA nCampo = 0;  |SI nCampo [ nTotalCampos;  |HACIENDO nCampo = nCampo + 1;
                |SI nCampo = 0;
                    aAlfa = nCampo + " LIKE " + aCadena;
                |SINO;
                    aAlfa = " OR " + nCampo + " LIKE " + aCadena;
                |FINSI;
                |XGRABA nHandle, aAlfa;
          |SIGUE;
     |FINSI;

     |XCIERRA nHandle;

     |ABRE #5;
     aAlfa = "SELECT @" + aFicheroSql;
     |SQL aAlfa;
     |CIERRA #5;

     ||ARA
     ||FBORRA aFicheroSql;

     aOrigen  = aBase + "fich/" + eaFichero + ".dat";
     aDestino = aDirDatos + eaFichero + ".dat";
     |RENOMBRA_FICHERO aOrigen, aDestino;

     aOrigen  = aBase + "fich/" + eaFichero + ".ddx";
     aDestino = aDirDatos + eaFichero + ".ddx";
     |RENOMBRA_FICHERO aOrigen, aDestino;

     aOrigen  = aBase + "fich/" + eaFichero + ".ixx";
     aDestino = aDirDatos + eaFichero + ".ixx";
     |RENOMBRA_FICHERO aOrigen, aDestino;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentz2;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentz2;
|FPRC;

|PROCESO Tipo80; |TIPO 80;
     FSalida = 2699;
|FPRC;

|PROCESO CargaDefs;
     |SI aAplicacion = "CONTA";

          |DBASS aBase;
          |QBF aBase;

          aDirConta = aBase + "contagen/";
          aDirDatos = aDirConta + "fich/" + (("00000" + aEmpresa) % -105) + (("0" + aEjercicio) % -101) + "/";

          aDef = aDirConta + "def/" + aNomDef;
          |CARGA_DEF aDef, origen@;
          |SI FSalida ! 0;
               aMensaje = "0000[" + aNomDef + ".mas] inaccesible. Consulte con su distribuidor.";
               |MENAV aMensaje;
               enError = 1;
               |ACABA;
          |FINSI;

          |PATH_DAT #5 aDirDatos;
          |ABRE #5;

          |CARGA_DEF aDef, destino@;
          |SI FSalida ! 0;
               |DESCARGA_DEF #origen@;
               aMensaje = "0000[" + aNomDef + ".mas] inaccesible. Consulte con su distribuidor.";
               |MENAV aMensaje;
               enError = 1;
               |ACABA;
          |FINSI;

          |PATH_DAT #905 aDirDatos;

          eaFichero = ("02" + Usuario + "zzzzzzzz") % 108;
     |FINSI;
     |SI aAplicacion = "MODEL";
          |DBASS aBase;
          |QBF aBase;

          aDirConta = aBase + "modelos/";
          aDirDatos = aDirConta + "fich/";

          aDef = aDirConta + "def/" + aNomDef;
          |CARGA_DEF aDef, origen@;
          |SI FSalida ! 0;
               aMensaje = "0000[" + aNomDef + ".mas] inaccesible (modelos). Consulte con su distribuidor.";
               |MENAV aMensaje;
               enError = 1;
               |ACABA;
          |FINSI;

          |PATH_DAT #5 aDirDatos;
          |ABRE #5;

          |CARGA_DEF aDef, destino@;
          |SI FSalida ! 0;
               |DESCARGA_DEF #origen@;
               aMensaje = "0000[" + aNomDef + ".mas] inaccesible (modelos). Consulte con su distribuidor.";
               |MENAV aMensaje;
               enError = 1;
               |ACABA;
          |FINSI;

          |PATH_DAT #905 aDirDatos;

          eaFichero = ("03" + Usuario + "zzzzzzzz") % 108;
     |FINSI;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |SI enError = 0;
          |DESCARGA_DEF #origen@;
          |DESCARGA_DEF #destino@;
     |FINSI;
|FPRC;

|PROGRAMA;
     aParametro = PARAMETRO;
     |QBF aParametro;

     |SI aParametro = "";
          aMensaje = "0000Programa llamado con Parametros incorrectos. [Vacio]";
          |MENAV aMensaje;
     |FINSI;

     aAplicacion = aParametro % 105;
     aNomDef = aParametro % 608;
     aEmpresa = aParametro % 1405;
     |SI aAplicacion = "CONTA";
          aEjercicio = aParametro % 1901;
     |FINSI;

     |HAZ CargaDefs;

     |SI enError = 0;
          |DDEFECTO #908;
          |PINPA #0#908;  nPanta0 = FSalida;
          |PINDA #0#908;

          |ENDATOS #1#908;
     |FINSI;

     |PULSATECLA;
|FPRO;
