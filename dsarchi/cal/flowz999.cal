||VerificaCampo

|FICHEROS;
     dsarm001 #1;
     dsarm002 #2;
     dsarm003 #3;
     dsarm004 #4;
     dsarm005 #5;

     flowm008 #508;      ||C.Oblig.Sit WORKFLOW
|FIN;

|VARIABLES;
     ||Variables externas para MiraSiFechaRegistro
     &enGrupoFR = 0;
     &enSubGrupoFR = 0;
     &enTipoFR = 0;
     &enSitFR = 0;
     &enSwFR = 0;
     &efFechaFR = @;
     &enNumDocFR = 0;


     aPillaFecha = "";
     nFecha = 0;
     nVoy = 0;
     nCampoLibre = 0;
     aPatron = "";
     nCampoReal = 0;
     aFecha = "";
     fFecha = @;
     fFecha2 = @;


     nSwHayObliga = 0;
     nCampo = 0;
     aAux = "";

     nPosObli = 0;
     nCampoAux = 0;
     nEstoy = 0;
     aAux2 = "";
     nCampoDato = 0;
     aValor = "";
     aTextoObli = "";

     &enSwCamposObligados = 0;
     &eaPermisoModTipo = "S";
     &enGrupoCO = 0;
     &enSubGrupoCO = 0;
     &enTipoCO = 0;
     &enSituCO = 0;
     &enNumDocCO = 0;
     &eaTextoCO = "";
     nCuentaLibres = 0;
     &enNumLibreCO = 0;
     &enPosicionCO = 0;
|FIN;

|PROCESO VerificaCampo;
     ||ARA
     |SI aAux ! "";
          nPosObli = nPosObli + 1;
          nCampoAux = 23 + nEstoy;
          aAux2 = #flowm008#nCampoAux#;
          |QBF aAux2;
          |SI aAux2 = "S";
               |SI nPosObli [ 15;
                    nCampoDato = 22 + nPosObli;
               |SINO;
                    nCampoDato = 44 + nPosObli;
               |FINSI;
               aValor = #dsarm005#nCampoDato#;
               |QBF aValor;

               aValor = aValor - aAux - ":";
               |QBT aValor;
               |SI aValor = "";
                    |SI aTextoObli = "";
                         aTextoObli = aAux;
                    |SINO;
                         aTextoObli = aTextoObli + ", " + aAux;
                    |FINSI;
                    enSwCamposObligados = 1;
                    |SI enNumLibreCO = 0;
                         enNumLibreCO = nCuentaLibres;
                         enPosicionCO = nEstoy;
                    |FINSI;
               |SINO;
                    |SI aValor = "01.01.0000"; |Y nEstoy > 15;
                         |SI aTextoObli = "";
                              aTextoObli = aAux;
                         |SINO;
                              aTextoObli = aTextoObli + ", " + aAux;
                         |FINSI;
                         enSwCamposObligados = 1;
                         |SI enNumLibreCO = 0;
                              enNumLibreCO = nCuentaLibres;
                              enPosicionCO = nEstoy;
                         |FINSI;
                    |SINO;
                         |SI aValor = 0;
                              |SI nEstoy ] 11; |Y nEstoy [ 15;
                                   |SI aTextoObli = "";
                                        aTextoObli = aAux;
                                   |SINO;
                                        aTextoObli = aTextoObli + ", " + aAux;
                                   |FINSI;
                                   enSwCamposObligados = 1;
                                   |SI enNumLibreCO = 0;
                                        enNumLibreCO = nCuentaLibres;
                                        enPosicionCO = nEstoy;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MiraCamposObliWFSitu;
     ||Solo mira si la situacion en concreto tiene campos obligatorios o no.

     eaTextoCO = aTextoObli;
     |ABRE #flowm008;
     |DDEFECTO #flowm008;
     #flowm008#0 = enGrupoCO;
     #flowm008#1 = enSubGrupoCO;
     #flowm008#2 = enTipoCO;
     #flowm008#3 = enSituCO;
     |LEE 000#flowm008.=;
     |SI FSalida ! 0;
          enSwCamposObligados = 0;
          |ACABA;
     |FINSI;
     |CIERRA #flowm008;

     nSwHayObliga = 0;
     |PARA nCampo = 24; |SI nCampo [ 43; |HACIENDO nCampo = nCampo + 1;
          |SI #flowm008#nCampo# = "S";
               nSwHayObliga = 1;
          |FINSI;
     |SIGUE;

     |SI nSwHayObliga = 0;
          enSwCamposObligados = 0;
          |ACABA;
     |FINSI;
|FPRC;

|PROCESO MiraCamposObliWF;
     aTextoObli = "";
     eaTextoCO = aTextoObli;
/*
     ||TODO. PARA PRUEBAS.
     enSwCamposObligados = 1;
     |ACABA;
*/

     |ABRE #flowm008;
     |DDEFECTO #flowm008;
     #flowm008#0 = enGrupoCO;
     #flowm008#1 = enSubGrupoCO;
     #flowm008#2 = enTipoCO;
     #flowm008#3 = enSituCO;
     |LEE 000#flowm008.=;
     |SI FSalida ! 0;
          enSwCamposObligados = 0;
          |ACABA;
     |FINSI;
     |CIERRA #flowm008;

     nSwHayObliga = 0;
     |PARA nCampo = 24; |SI nCampo [ 43; |HACIENDO nCampo = nCampo + 1;
          |SI #flowm008#nCampo# = "S";
               nSwHayObliga = 1;
          |FINSI;
     |SIGUE;

     |SI nSwHayObliga = 0;
          enSwCamposObligados = 0;
          |ACABA;
     |FINSI;

     |ABRE #dsarm002;
     |DDEFECTO #dsarm002;
     #dsarm002#0 = enGrupoCO;
     |LEE 000#dsarm002.=;
     |CIERRA #dsarm002;

     |ABRE #dsarm003;
     |DDEFECTO #dsarm003;
     #dsarm003#0 = enGrupoCO;
     #dsarm003#1 = enSubGrupoCO;
     |LEE 000#dsarm003.=;
     |CIERRA #dsarm003;

     |ABRE #dsarm004;
     |DDEFECTO #dsarm004;
     #dsarm004#0 = enGrupoCO;
     #dsarm004#1 = enSubGrupoCO;
     #dsarm004#2 = enTipoCO;
     |LEE 000#dsarm004.=;
     |CIERRA #dsarm004;

     nCuentaLibres = 0;
     enNumLibreCO = 0;
     enPosicionCO = 0;
     |ABRE #dsarm005;
     |DDEFECTO #dsarm005;
     #dsarm005#0 = enNumDocCO;
     |LEE 000#dsarm005.=;
     |SI FSalida = 0;
          nEstoy = 0;
          nPosObli = 0;

          nEstoy = nEstoy + 1;
          aAux = #4#5; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#6; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#7; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#8; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#9; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#27; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#28; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#29; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#30; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#31; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#10; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#11; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#12; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#13; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#14; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#15; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#16; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#17; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#18; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;

          nEstoy = nEstoy + 1;
          aAux = #4#19; |QBF aAux;
          |SI aAux ! ""; nCuentaLibres = nCuentaLibres + 1; |FINSI;
          |HAZ VerificaCampo;
     |FINSI;
     |CIERRA #dsarm005;
     eaTextoCO = aTextoObli;
|FPRC;

|PROCESO MiraSiFechaRegistro;
     |ABRE #flowm008;
     |DDEFECTO #flowm008;
     #flowm008#0 = enGrupoFR;
     #flowm008#1 = enSubGrupoFR;
     #flowm008#2 = enTipoFR;
     #flowm008#3 = enSitFR;
     |LEE 000#flowm008.=;
     |SI FSalida = 0;
          nFecha = 0;
          aPillaFecha = #flowm008#44;
          |QBF aPillaFecha;
          |SI aPillaFecha = "S";
               nFecha = 1;
          |FINSI;
          |SI nFecha = 0;
               aPillaFecha = #flowm008#45;
               |QBF aPillaFecha;
               |SI aPillaFecha = "S";
                    nFecha = 2;
               |FINSI;
          |FINSI;
          |SI nFecha = 0;
               aPillaFecha = #flowm008#46;
               |QBF aPillaFecha;
               |SI aPillaFecha = "S";
                    nFecha = 3;
               |FINSI;
          |FINSI;
          |SI nFecha = 0;
               aPillaFecha = #flowm008#47;
               |QBF aPillaFecha;
               |SI aPillaFecha = "S";
                    nFecha = 4;
               |FINSI;
          |FINSI;
          |SI nFecha = 0;
               aPillaFecha = #flowm008#48;
               |QBF aPillaFecha;
               |SI aPillaFecha = "S";
                    nFecha = 5;
               |FINSI;
          |FINSI;

          |SI nFecha ! 0;
               |ABRE #dsarm004;
               |DDEFECTO #dsarm004;
               #dsarm004#0 = enGrupoFR;
               #dsarm004#1 = enSubGrupoFR;
               #dsarm004#2 = enTipoFR;
               |LEE 000#dsarm004.=;
               |CIERRA #dsarm004;

               nVoy = 0;
               nEstoy = 0;

               nEstoy = nEstoy + 1;
               aAux = #4#5; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#6; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#7; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#8; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#9; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#27; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#28; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#29; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#30; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#31; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#10; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#11; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#12; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#13; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#14; |QBF aAux;
               |SI aAux ! ""; nVoy = nVoy + 1; |FINSI;

               ||Aqui empiezan las fechas.
               nCampoLibre = nVoy + nFecha;

               nEstoy = 0;
               nEstoy = nEstoy + 1;
               aAux = #4#15; |QBF aAux;
               |SI aAux = "";
                    |SI nFecha > nEstoy;
                         nCampoLibre = nCampoLibre - 1;
                    |SINO;
                         |SI nFecha = nEstoy;
                              nFecha = 0;
                         |FINSI;
                     |FINSI;
               |SINO;
                    |SI nFecha = nEstoy;
                         aPatron = aAux;
                    |FINSI;
               |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#16; |QBF aAux;
               |SI aAux = "";
                    |SI nFecha > nEstoy;
                         nCampoLibre = nCampoLibre - 1;
                    |SINO;
                         |SI nFecha = nEstoy;
                              nFecha = 0;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |SI nFecha = nEstoy;
                         aPatron = aAux;
                    |FINSI;
               |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#17; |QBF aAux;
               |SI aAux = "";
                    |SI nFecha > nEstoy;
                         nCampoLibre = nCampoLibre - 1;
                    |SINO;
                         |SI nFecha = nEstoy;
                              nFecha = 0;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |SI nFecha = nEstoy;
                         aPatron = aAux;
                    |FINSI;
               |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#18; |QBF aAux;
               |SI aAux = "";
                    |SI nFecha > nEstoy;
                         nCampoLibre = nCampoLibre - 1;
                    |SINO;
                         |SI nFecha = nEstoy;
                              nFecha = 0;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |SI nFecha = nEstoy;
                         aPatron = aAux;
                    |FINSI;
               |FINSI;

               nEstoy = nEstoy + 1;
               aAux = #4#19; |QBF aAux;
               |SI aAux = "";
                    |SI nFecha > nEstoy;
                         nCampoLibre = nCampoLibre - 1;
                    |SINO;
                         |SI nFecha = nEstoy;
                              nFecha = 0;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |SI nFecha = nEstoy;
                         aPatron = aAux;
                    |FINSI;
               |FINSI;

               ||Hay que buscar la fecha en el dsarm005

               |SI nFecha = 0; |ACABA; |FINSI;

               ||nCampoLibre
               ||ARA

               |ABRE #dsarm005;
               |DDEFECTO #dsarm005;
               #dsarm005#0 = enNumDocFR;
               |LEE 000#dsarm005.=;
               |SI FSalida = 0;
                    |SI nCampoLibre [ 15;
                         nCampoReal = 22 + nCampoLibre;
                    |SINO;
                         nCampoReal = 44 + nCampoLibre;
                    |FINSI;
                    aValor = #dsarm005#nCampoReal#;
                    |QBF aValor;

                    aFecha = aValor - aPatron;
                    |QBT aFecha;
                    aFecha = aFecha - ":";
                    |SI aFecha ! "";
                         fFecha = aFecha;
                         nFecha = fFecha;
                         fFecha2 = nFecha;
                         |SI fFecha = fFecha2;
                              enSwFR = 1;
                              efFechaFR = fFecha;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |CIERRA #dsarm005;
          |FINSI;
     |FINSI;
     |CIERRA #flowm008;
|FPRC;
