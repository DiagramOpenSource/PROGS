|FICHEROS;
     dsarz054 #0;
     dsarm060 #60;       ||Ctrl. Archivado Auto
     dsarw086 #86,MANTE; ||Pan. Aux. Archi.Auto

     dsarm001 #1;

     dsarm002 #2;
     dsarm003 #3;
     dsarm004 #4;
     dsarm005 #5;

     dsarm063 #63;       ||Asis.Sel. Filtro GST

     referen@ #905;      ||Carga_def resultados
|FIN;

|VARIABLES;
     &enSwHaySelAva = 0;           ||Hay registros Correo Envio Avanzado.
     &eaAsuntoSel = "";
     &enCodSelAva = 0;
     &eaGrabaHis = "";

     aNif = "";
     aNifSel1 = "";
     aNifSel2 = "";
     aNifSel3 = "";
     aNifSel4 = "";
     aNifSel5 = "";
     aNifSel6 = "";
     aNifSel7 = "";
     aNifSel8 = "";
     aNifSel9 = "";
     aNifSel10 = "";

     nRegSeleccion = 0;
     aBase = "";
     aDef = "";
     aFichero = "";
     nBotonLabel = 0;


     aSwGuardarSel = "";
     aSwHistoEnvio = "";

     nBorraSel = 0;
     aDescripcion    = "";
     aCarpeta        = "";
     aCodigo         = "";
     aMarca          = "";
     nVent63        = 0;
     nGrid63        = 0;
     nNumSel = 0;

     nBotonAcota = 0;

     aQueBoton     = "";
     aID           = "";
     nBotonAceptar = 0;
     nBotonCancelar = 0;
     nUltimo = 0;
     nIdSalir = 0;
     {2}nNivel = 0;
     nVentana = 0;
     nPantaDos = 0;
     aCadena = "";
     aAlfa = "";
     nCampoHasta = 0;
     nCampoD = 0;
     nCampoH = 0;

     {-1}aVent      = "";
         aVent1     = 0;
         aVent2     = 0;
         aVent3     = 0;
         aVent4     = 0;
         aVent5     = "";

     aMensaje = "";

     nBoton1 = 0;
     nBoton2 = 0;
     nBoton3 = 0;

     nPanta = 0;
     nRango = 0;
     nPos1  = 0;
     nPos2  = 0;
     nGrid = 0;
     aEsc1  = "";
     aEsc2  = "";
     aRetu  = "";
     aTecla = "";

     nModo = 0;
|FIN;

|PROCESO ObtenIdSalir;
     InNivel = nNivel1<-;
     nNivel1 = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;
     nIdSalir = nNivel2;
|FPRC;

|PROCESO Tipo0C0w86; |TIPO 0;
     |SI nModo = 1;
          #dsarm060#0 = #dsarw086#0;
          |LEE 000#dsarm060.=;
          |SI FSalida = 0;
               aMensaje = "0000Ya existe una seleccion con este numero";
               |MENAV aMensaje;
               |ERROR;
          |SINO;
               ||Una vez introducido el numero NO dejara modificarlo.
               |C_M #dsarw086#0, 1, "N";
               |PINTA #dsarw086#0;

               |ESTADO_CONTROL nBotonAcota, "ENABLE";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo12_w86; |TIPO 12;
     |SI FSalida ! 7;
          aSwGuardarSel = #dsarw086#32;
          aSwHistoEnvio = #dsarw086#33;

          |ABRE #dsarm063;
          |HAZ Seleccion;
          |CIERRA #dsarm063;

          |SI nRegSeleccion = 0;
               aMensaje = "0000Seleccion vacia";
               |MENAV aMensaje;
          |SINO;
               |PTEC 806;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsarm005;
     ||Quito las acotaciones.
     ||ARA39

     ||Cliente
     |SI #dsarm005#8 < #dsarw086#2; |O #dsarm005#8 > #dsarw086#3;
          |ACABA;
     |FINSI;

     ||Nif
     |SI #dsarw086#31 = "S";
          aNif = #dsarm005#10;
          |QBF aNif;
          |SI aNif = ""; |ACABA; |FINSI;

          aNifSel1 = #dsarw086#21; |QBF aNifSel1;
          aNifSel2 = #dsarw086#22; |QBF aNifSel2;
          aNifSel3 = #dsarw086#23; |QBF aNifSel3;
          aNifSel4 = #dsarw086#24; |QBF aNifSel4;
          aNifSel5 = #dsarw086#25; |QBF aNifSel5;
          aNifSel6 = #dsarw086#26; |QBF aNifSel6;
          aNifSel7 = #dsarw086#27; |QBF aNifSel7;
          aNifSel8 = #dsarw086#28; |QBF aNifSel8;
          aNifSel9 = #dsarw086#29; |QBF aNifSel9;
          aNifSel10 = #dsarw086#30; |QBF aNifSel10;

          |SI aNif ! aNifSel1; |Y aNif ! aNifSel2; |Y aNif ! aNifSel3;
           |Y aNif ! aNifSel4; |Y aNif ! aNifSel5; |Y aNif ! aNifSel6;
           |Y aNif ! aNifSel7; |Y aNif ! aNifSel7; |Y aNif ! aNifSel9;
           |Y aNif ! aNifSel10;
               |ACABA;
          |FINSI;
     |FINSI;

     ||Grupo/Sub./Tipo
     aCodigo = ((("000" + #dsarm005#1) % -103) + (("000" + #dsarm005#2) % -103) + (("000" + #dsarm005#3) % -103));

     |DDEFECTO #dsarm063;
     #dsarm063#0 = #dsarw086#0;
     #dsarm063#1 = aCodigo;
     |LEE 000#dsarm063.=;
     |SI FSalida = 0;
          |SI #dsarm063#3 = "N";
               |ACABA;
          |FINSI;
     |FINSI;

     ||Trabajador
     |SI #dsarm005#15 < #dsarw086#4; |O #dsarm005#15 > #dsarw086#5;
          |ACABA;
     |FINSI;

     ||Modelo
     |SI #dsarm005#19 < #dsarw086#6; |O #dsarm005#19 > #dsarw086#7;
          |ACABA;
     |FINSI;

     ||Ejercicio
     |SI #dsarm005#17 < #dsarw086#8; |O #dsarm005#17 > #dsarw086#9;
          |ACABA;
     |FINSI;

     ||Periodo
     |SI #dsarm005#18 < #dsarw086#10; |O #dsarm005#18 > #dsarw086#11;
          |ACABA;
     |FINSI;

     ||Complementaria
     |SI #dsarm005#20 < #dsarw086#12; |O #dsarm005#20 > #dsarw086#13;
          |ACABA;
     |FINSI;

     ||Serie Minuta
     |SI #dsarm005#39 < #dsarw086#14; |O #dsarm005#39 > #dsarw086#15;
          |ACABA;
     |FINSI;

     ||Numero Minuta
     |SI #dsarm005#40 < #dsarw086#16; |O #dsarm005#40 > #dsarw086#17;
          |ACABA;
     |FINSI;

     |SALVA_DATOS #dsarm005;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.n;

     nRegSeleccion = nRegSeleccion + 1;
|FPRC;

|DEFBUCLE dsarm005_fecha;
 #dsarm005#8;
 ;
 #dsarw086#18, "00:00", 000000001;
 #dsarw086#19, "99:99", 999999999;
 ;
 NULL, dsarm005;
|FIN;

|DEFBUCLE dsarm005;
 #dsarm005#1;
 ;
 000000001;
 999999999;
 ;
 NULL, dsarm005;
|FIN;

|PROCESO Seleccion;
     ||aMensaje = "0000Ejecuto la seleccion y devuelvo un temporal con datos";
     ||MENAV aMensaje;

     |SI #dsarw086#32 = "S";
          enCodSelAva = #dsarw086#0;
     |SINO;
          enCodSelAva = 0;
     |FINSI;
     eaGrabaHis = #dsarw086#33;
     eaAsuntoSel = #dsarw086#1;
     |QBF eaAsuntoSel;
     eaAsuntoSel = eaAsuntoSel % 199;

     nRegSeleccion = 0;
     |DBASE aBase;
     |QBF aBase;
     aDef = aBase + "def/dsarm005";
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
          aMensaje = "0000Problemas al realizar el CARGA_DEF para la seleccion";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;

     aFichero = ("01" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #905 aFichero;
     |DELINDEX #905;

     |CONTROL_SIMPLE 0, "LABEL,{{5}}Realizando Proceso ... ", 1315, 1680, NULL;
     nBotonLabel = FSalida;

     |PTEC 802;  |PAUSA;

     |ABRE #referen@;

     ||METO LOS REGISTRO QUE CUMPLAN LA SELECCION.
     ||ARA38
     |SI #dsarw086#20 = "S";
          |BUCLE dsarm005_fecha;
     |SINO;
          |BUCLE dsarm005;
     |FINSI;

     |CIERRA #referen@;

     |DESCARGA_DEF #referen@;
     |FIN_CONTROL_WINDOWS nBotonLabel;
|FPRC;

|PROCESO dsarm004_63;
     aCodigo = ((("000" + #4#0) % -103) + (("000" + #4#1) % -103) + (("000" + #4#2) % -103));

     |ABRE #2;
     |DDEFECTO #2;
     #2#0 = #4#0;
     |LEE 000#2=;
     |CIERRA #2;

     aDescripcion = #2#1;
     |QBF aDescripcion;

     |ABRE #3;
     |DDEFECTO #3;
     #3#0 = #4#0;
     #3#1 = #4#1;
     |LEE 000#3=;
     |CIERRA #3;

     |SI aDescripcion = "";
          aDescripcion = #3#2;
     |SINO;
          aDescripcion = aDescripcion + " " + #3#2;
     |FINSI;
     |QBF aDescripcion;

     |SI aDescripcion = "";
          aDescripcion = #4#3;
     |SINO;
          aDescripcion = aDescripcion + " " + #4#3;
     |FINSI;
     |QBF aDescripcion;

     aCarpeta = #2#2;
     |QBF aCarpeta;
     |SI aCarpeta = "";
           aCarpeta = #3#3;
     |SINO;
           aCarpeta = aCarpeta + "/" + #3#3;
     |FINSI;
     |QBF aCarpeta;
     |SI aCarpeta = "";
           aCarpeta = #4#4;
     |SINO;
           aCarpeta = aCarpeta + "/" + #4#4;
     |FINSI;

     #63#0 = nNumSel;
     #63#1 = aCodigo;
     |LEE 101#63=;
     |SI FSalida ! 0;
         |DDEFECTO #63;
         #63#0 = nNumSel;
         #63#1 = aCodigo;
         |GRABA 020#63b;
         #63#3 = "S";
     |FINSI;

     #63#2 = aDescripcion;

     |SI #63#3 = "S";
         #63#4 = "0,185,0;255,255,255";
     |SINO;
         #63#4 = "255,0,0;255,255,255";
     |FINSI;

     |GRABA 020#63a;
     |LIBERA #63;
|FPRC;

|DEFBUCLE dsarm004_63;
     #4#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsarm004_63;
|FIN;

|PROCESO Evento63;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#63=;
     |FINSI;

     |SI FSalida = 4;
         |LEE 101#63=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |SI #dsarm063#3 = "S";
             #dsarm063#3 = "N";
             #dsarm063#4 = "255,0,0;255,255,255";
         |SINO;
             #dsarm063#3 = "S";
             #dsarm063#4 = "0,185,0;255,255,255";
         |FINSI;

         |GRABA 020#dsarm063.a;
         |LIBERA #dsarm063;

         |REFRESCACONTROL nGrid63;
     |FINSI;
|FPRC;

|PROCESO Min63;
     #63#0 = nNumSel;
     #63#1 = "000000000";
|FPRC;

|PROCESO Max63;
     #63#0 = nNumSel;
     #63#1 = "999999999";
|FPRC;

|PROCESO dsarm063;
     #dsarm063#3 = aMarca;

     |SI #dsarm063#3 = "S";
         #dsarm063#4 = "0,185,0;255,255,255";
     |SINO;
         #dsarm063#4 = "255,0,0;255,255,255";
     |FINSI;

     |GRABA 020#dsarm063.a;
     |LIBERA #dsarm063;
|FPRC;

|DEFBUCLE dsarm063;
     #63#1;
     ;
     nNumSel, "         ";
     nNumSel, "999999999";
     be;
     NULL, dsarm063;
|FIN;

|PROCESO Todo;
     aMarca = "S";
     |BUCLE dsarm063;

     |REFRESCACONTROL nGrid63;
|FPRC;

|PROCESO Ninguno;
     aMarca = "N";
     |BUCLE dsarm063;

     |REFRESCACONTROL nGrid63;
|FPRC;

|PROCESO GrabaAcotaciones;
     |ABRE #63;
     |BUCLE dsarm004_63;
     |CIERRA #63;
|FPRC;

|PROCESO BotonAcota;
     nNumSel = #dsarw086#0;

     |VENTANA 0501, 2999, -1, 17, "VERDE - ACTIVADO.  ROJO - DESACTIVADO";
     nVent63 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent63;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |HAZ GrabaAcotaciones;

     |ABRET #63;
     |CONTROL_SIMPLE 0, "BOTON,{{235}}Activar todo", 0502, 0620, Todo;
     |CONTROL_SIMPLE 0, "BOTON,{{234}}Desactivar todo", 0522, 0640, Ninguno;
     |CONTROL_SIMPLE 0, "LABEL,{{1}}Doble click en la l¡nea para seleccionar o quitar el registro seleccionado", 0542, 0698, NULL;

     nRango  = 2 + 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#63, nRango, 0701, 2799, Min63, Max63, Evento63;
     nGrid63 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid63;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent63;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent63;

     |CIERRAT #63;
|FPRC;

|PROCESO dsarm063_borra;
     |BORRA 020#dsarm063.a;
|FPRC;

|DEFBUCLE dsarm063_borra;
 #dsarm063#1;
 ;
 nBorraSel, "         ";
 nBorraSel, "999999999";
 be;
 NULL, dsarm063_borra;
|FIN;

|PROCESO ModiAlta;
     nIdSalir = 0;
     |HAZ ObtenIdSalir;
     |ESTADO_CONTROL nIdSalir, "HIDE";

     ||VENTANA 0501, 2999, -1, -1, "";
     |VENTANA 0501, 2999, -1, 17, "";
     nVentana = FSalida;

     aCadena ="|NC";
     aAlfa = #60#aCadena#;
     nCampoHasta = aAlfa;
     nCampoHasta = nCampoHasta - 1;

     |SI nModo ! 1;
          |PARA nCampoD = 0;  |SI nCampoD [ nCampoHasta; |HACIENDO nCampoD = nCampoD + 1;
                nCampoH = nCampoD;
                #86nCampoH = #60nCampoD;
          |SIGUE;

          |C_M #86#0, 1, "N";
     |SINO;
          |C_M #86#0, 1, "S";
          nUltimo = 0;
          |HAZ DameUltimo;
          |DDEFECTO #86;
          nUltimo = nUltimo + 1;
          #86#0 = nUltimo;
     |FINSI;

     |PINPA #0#86; nPantaDos = FSalida;
     |PINDA #0#86;

     |CONTROL_SIMPLE nPantaDos, "BOTON,Acotar por Grupo/Sub./Tipo", 1172, 1288, BotonAcota;
     nBotonAcota = FSalida;

     |SI nModo = 1;
          |ESTADO_CONTROL nBotonAcota, "DISABLE";
     |SINO;
          |SI nModo = 2;
               |ESTADO_CONTROL nBotonAcota, "ENABLE";
          |FINSI;
     |FINSI;

     |SI nModo = 1;  |ENDATOS #1#86;  |FINSI;
     |SI nModo = 2;  |ENDATOS #2#86;  |FINSI;

     |SI FSalida = 0;
          |SI aSwGuardarSel = "S";
              |HAZ GrabaDatos;
          |SINO;
               |SI nModo = 1;
                    nBorraSel = #dsarw086#0;
                    |BUCLE dsarm063_borra;
               |FINSI;
          |FINSI;
     |SINO;
          |SI nModo = 1;
               nBorraSel = #dsarw086#0;
               |BUCLE dsarm063_borra;
          |FINSI;
     |FINSI;

     |FINVENTANA nVentana;

     |ESTADO_CONTROL nIdSalir, "SHOW";
|FPRC;

|PROCESO DameUltimo;
     |LEE 000#dsarm060.u;
     |SI FSalida = 0;
          nUltimo = #dsarm060#0;
     |SINO;
          nUltimo = 0;
     |FINSI;
|FPRC;

|PROCESO GrabaDatos;
     #60#0 = #86#0;
     |LEE 101#60=;
     |SI FSalida ! 0;
         |DDEFECTO #60;
         #60#0 = #86#0;
         |GRABA 020#60b;
     |FINSI;

     |PARA nCampoD = 1;  |SI nCampoD [ nCampoHasta;  |HACIENDO nCampoD = nCampoD + 1;
           nCampoH   = nCampoD;
           #60nCampoD = #86nCampoH;
     |SIGUE;

     |GRABA 020#60a;
     |LIBERA #60;
|FPRC;

|PROCESO Tipo80C0; |TIPO 80;
     FSalida = 2999;
|FPRC;

|PROCESO BajaPanta;
     #dsarm060#0 = 0001;
|FPRC;

|PROCESO AltaPanta;
     #dsarm060#0 = 9999;
|FPRC;

|PROCESO EventoPanta;
     |SI FSalida = 1;  |O FSalida = 2;
          |LEE 000#dsarm060.=;
          |SI FSalida = 0;
               |ESTADO_CONTROL nBoton2, "ENABLE";
               |ESTADO_CONTROL nBoton3, "ENABLE";
          |SINO;
               |ESTADO_CONTROL nBoton2, "DISABLE";
               |ESTADO_CONTROL nBoton3, "DISABLE";
          |FINSI;
     |FINSI;

     |SI FSalida = 4;
          |HAZ Boton2;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     nModo = 1;
     |HAZ ModiAlta;
     |REFRESCACONTROL nGrid;
|FPRC;

|PROCESO Boton2;
     |LEE 000#dsarm060.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nModo = 2;
     |HAZ ModiAlta;
     |REFRESCACONTROL nGrid;
|FPRC;


|PROCESO Boton3;
     |LEE 000#dsarm060.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |LEE 101#dsarm060.=;
     |SI FSalida = 0;
          aMensaje = "0000NDesea Borrar la seleccion: " + #60#1;
          |QBF aMensaje;
          aMensaje = aMensaje + "?";
          |CONFI aMensaje;
          |SI FSalida = 0;
               nBorraSel = #dsarm060#0;
               |BUCLE dsarm063_borra;

               |BORRA 020#dsarm060.a;
          |FINSI;
          |LIBERA #dsarm060;
     |FINSI;

     |REFRESCACONTROL nGrid;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "Asistente Seleccion Envio Correo";

     |ABRE #dsarm001;
     |DDEFECTO #dsarm001;
     |LEE 000#dsarm001.=;
     |CIERRA #dsarm001;

     |ABRE #dsarm060;

     |PINPA #0#dsarz054;
     nPanta = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{193}}Alta ", 2753, 2763, Boton1;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Modificar ", 2765, 2775, Boton2;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{199}}Baja ", 2777, 2787, Boton3;
     nBoton3 = FSalida;

     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0702;
     nPos2  = 2698;

     |LINEAL_SIMPLE #1#dsarm060, nRango, nPos1, nPos2, BajaPanta, AltaPanta, EventoPanta;
     nGrid = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nGrid;

     |DESTRUYECONTROL nBoton1;
     |DESTRUYECONTROL nBoton2;
     |DESTRUYECONTROL nBoton3;

     |CIERRA #dsarm060;

     |SI nRegSeleccion = 0;
          enSwHaySelAva = 0;
          eaAsuntoSel = "";
          enCodSelAva = 0;
          eaGrabaHis = "N";
     |SINO;
          enSwHaySelAva = 1;
     |FINSI;
|FPRO;
