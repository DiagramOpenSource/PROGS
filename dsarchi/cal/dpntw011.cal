|FICHEROS;
     dpntm001;
     dpntm005;
     dpntm007;

     :laboral/labcentr;

     dpntw011,MANTE;
|FIN;

|VARIABLES;
     n1Vent              = 0;
     nOk                 = 0;
     nIde                = 0;

     aEMail              = "";

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     &enGrid7            = 0;
     &enModo             = 0;
|FIN;

|PROCESO T12;  |TIPO 12;
|FPRC;

|PROCESO T0;  |TIPO 0;
     aEMail = #dpntw011#0;  |QBF aEMail;
     |SI aEMail = "";
         |MENAV "0000E_mail incorrecto.";
         |ERROR;
         |ACABA;
     |FINSI;

     aEMail = #dpntw011#0 - "@";
     |SI FSalida = 0;
         |MENAV "0000E_mail incorrecto.";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI enModo ! 1;  |ACABA;  |FINSI;

     nOk = 0;

     |SELECT #2#dpntm005;
     |LEE 000#dpntm005.=;
     #dpntm005#0 = #dpntm001#0;
     #dpntm005#2 = #dpntw011#0;
     |LEE 000#dpntm005.=;
     |SI FSalida = 0;
         nOk = 1;
     |FINSI;
     |SELECT #1#dpntm005;

     |SELECT #2#dpntm007;
     |LEE 000#dpntm007.=;
     #dpntm007#0 = #dpntm001#0;
     #dpntm007#1 = #labcentr#1;
     #dpntm007#3 = #dpntw011#0;
     |LEE 000#dpntm007.=;
     |SI FSalida = 0;
         nOk = 2;
     |FINSI;
     |SELECT #1#dpntm007;

     |SI nOk = 1;
         |CONFI "0000NEl E_mail se est  usando en un acceso de esta empresa. Continuar.";
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI nOk = 2;
         |MENAV "0000El E_mail ya existe en este centro.";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO NuevoAcceso;
     |VENTANA 0501, 1680, -1, 16, "Nuevo Acceso";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |DDEFECTO #dpntw011;

     enModo = 1;
     |PINPA #0#dpntw011;
     |PINDA #0#dpntw011;
     |ENDATOS #2#dpntw011;
     |SI FSalida = 0;
         #dpntm007#0 = #dpntm001#0;
         #dpntm007#1 = #labcentr#1;
         #dpntm007#2 = 999;
         |LEE 000#dpntm007.];
         |SI FSalida = 0;
             |LEE 000#dpntm007.a;
         |SINO;
             |LEE 000#dpntm007.u;
         |FINSI;

         nIde = 1;
         |SI FSalida = 0;  |Y #dpntm007#0 = #dpntm001#0;
                           |Y #dpntm007#1 = #labcentr#1;
                 nIde = #dpntm007#2 + 1;
         |FINSI;

         #dpntm007#0 = #dpntm001#0;
         #dpntm007#1 = #labcentr#1;
         #dpntm007#2 = nIde;
         #dpntm007#3 = #dpntw011#0;

         |GRABA 020#dpntm007.n;
         |LIBERA #dpntm007;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |REFRESCACONTROL enGrid7;
     |FOCOTECLADO enGrid7;
|FPRC;
