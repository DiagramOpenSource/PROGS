|FICHEROS;
     dsarcl01 #1;
     dsarcl02 #2;
|FIN;

|VARIABLES;
     nSwModoSQLServer = 0;

     aPath = "";
     aNombreSql = "";
     aDestino = "";
     nHandle = 0;
     aTexto = "";
     aAux = "";

     nVoy = 0;
     aDia = "";
     aMes = "";
     aAnyo = "";

     aComilla = "'";

     aTextoEscapa = "";
     aLong = "";
     nLong = 0;
     nConta = 0;
     nSaca = 0;
     aSaca = "";
     aLetra = "";
|FIN;

|PROCESO EscapaComilla;
     aTextoEscapa = "";

     aLong = aAux % A0;
     nLong = aLong;
     |PARA nConta = 1; |SI nConta [ nLong; |HACIENDO nConta = nConta + 1;
          nSaca = 100 * nConta;
          nSaca = nSaca + 1;
          aSaca = nSaca;
          aLetra = aAux % aSaca;
          |SI aLetra = aComilla;
               aTextoEscapa = aTextoEscapa + aComilla + aComilla;
          |SINO;
               aTextoEscapa = aTextoEscapa + aLetra;
          |FINSI;
     |SIGUE;
     aAux = aTextoEscapa;
|FPRC;

|PROCESO dsarcl01;
     ||nVoy = nVoy + 1;
     |||SI nVoy = 3; |ERROR10; |FINSI;

     aTexto = "INSERT INTO historiasdiagram VALUES(" + #dsarcl01#0;

     aAux = #dsarcl01#1; |QBF aAux;
     |HAZ EscapaComilla;
     aTexto = aTexto + ",'" + aAux + "'";

     aAux = #dsarcl01#2; |QBF aAux;
     |HAZ EscapaComilla;
     aTexto = aTexto + ",'" + aAux + "'";

     aAux = #dsarcl01#3; |QBF aAux;
     |HAZ EscapaComilla;
     aTexto = aTexto + ",'" + aAux + "'";

     aAux = #dsarcl01#4; |QBF aAux;
     |HAZ EscapaComilla;
     aTexto = aTexto + ",'" + aAux + "'";

     aAux = #dsarcl01#5; |QBF aAux;
     |SI aAux = "01.01.0000";
          aTexto = aTexto + ",NULL";
     |SINO;
          aDia = aAux % 102;
          aMes = aAux % 402;
          aAnyo = aAux % -104;
          |SI nSwModoSQLServer = 0;
               aAux = aAnyo + "-" + aMes + "-" + aDia + " 00:00:00";
          |SINO;
               aAux = aDia + "/" + aMes + "/" + aAnyo + " 00:00:00";
          |FINSI;
          aTexto = aTexto + ",'" + aAux + "'";
     |FINSI;

     aAux = #dsarcl01#6; |QBF aAux;
     |HAZ EscapaComilla;
     aTexto = aTexto + ",'" + aAux + "'";

     aAux = #dsarcl01#7; |QBF aAux;
     |HAZ EscapaComilla;
     aTexto = aTexto + ",'" + aAux + "'";

     aAux = #dsarcl01#8; |QBF aAux;
     |HAZ EscapaComilla;
     aTexto = aTexto + ",'" + aAux + "'";

     aAux = #dsarcl01#9; |QBF aAux;
     |HAZ EscapaComilla;
     aTexto = aTexto + ",'" + aAux + "'";

     aTexto = aTexto + ");";

     |XGRABA nHandle, aTexto;
|FPRC;

|DEFBUCLE dsarcl01;
 #dsarcl01#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, dsarcl01;
|FIN;

|PROCESO dsarcl02;
     ||nVoy = nVoy + 1;
     |||SI nVoy = 3; |ERROR10; |FINSI;

     aTexto = "INSERT INTO episodiosdiagram VALUES(" + #dsarcl02#0;

     aTexto = aTexto + "," + #dsarcl02#1;

     aAux = #dsarcl02#2; |QBF aAux;
     |SI aAux = "01.01.0000";
          aTexto = aTexto + ",NULL";
     |SINO;
          aDia = aAux % 102;
          aMes = aAux % 402;
          aAnyo = aAux % -104;
          |SI nSwModoSQLServer = 0;
               aAux = aAnyo + "-" + aMes + "-" + aDia + " 00:00:00";
          |SINO;
               aAux = aDia + "/" + aMes + "/" + aAnyo + " 00:00:00";
          |FINSI;
          aTexto = aTexto + ",'" + aAux + "'";
     |FINSI;

     aAux = #dsarcl02#3; |QBF aAux;
     aTexto = aTexto + ",'" + aAux + "'";

     aTexto = aTexto + ");";

     |XGRABA nHandle, aTexto;
|FPRC;


|DEFBUCLE dsarcl02;
 #dsarcl02#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, dsarcl02;
|FIN;



|PROGRAMA;
     ||Para el SQL de David.
     nSwModoSQLServer = 1;

     ||Creamos las SQL que las hitorias y episodios

     aPath = "/extra/carlos/sql/";

     aNombreSql = "historias.sql";
     aDestino = aPath + aNombreSql;
     |XABRE "W", aDestino, nHandle;
     |SI FSalida < 0; |ACABA; |FINSI;
     |BUCLE dsarcl01;
     |XCIERRA nHandle;

     nVoy = 0;
     aNombreSql = "episodios.sql";
     aDestino = aPath + aNombreSql;
     |XABRE "W", aDestino, nHandle;
     |SI FSalida < 0; |ACABA; |FINSI;
     |BUCLE dsarcl02;
     |XCIERRA nHandle;
|FPRO;
