|FICHEROS;
     dsarw005 #905;

     :/basica/def/agitab99 #299;
     :/laboral/def/nomw0003 #303;
     :/laboral/def/labcentr;
|FIN;

|VARIABLES;
     aBass = "";
     nHandle = 0;
     nSwEstaIntegral = 0;
     nSwEstaBasica = 0;

      nEstoy = 0;
      aMensaje = "";

      aAlfa     = "";
      aPideNif  = "";
      aPideCli  = "";

      nMes      = 0;
      nAnyo     = 0;
      nHay      = 0;
      nID       = 0;
      nCampo    = 0;

      fFecha    = @;

      aQueBoton      = "";
      aID            = "";
      aMas           = "";
      nBotonAceptar  = 0;
      nBotonCancelar = 0;

     &eaVarDni       = "";
     &enCalcCif      = 0;
     &enEscaneo      = 0;
     &enDESPANET     = 0;
     &nPanta905_0    = 0;

     &enIdeCli       = 0;
     &eaNomCli       = "";
     &eaNifCli       = "";
     &eaCodNif       = "";
     &eaNomNif       = "";
|FIN;

|PROCESO T0C80Fw5;  |TIPO 0;
     |C_M #dsarw005#80, 0, aAlfa;
     |SI aAlfa = "N";
         #dsarw005#80 = 0;   |PINTA #dsarw005#80;
         #dsarw005#81 = "";  |PINTA #dsarw005#81;
         |ACABA;
     |FINSI;

     |SI #dsarw005#80 = 0;
         #dsarw005#81 = "Todos";  |PINTA #dsarw005#81;

         |ACABA;
     |FINSI;

     |DBASS aBass;
     aBass = aBass + "laboral/fich/";
     |PATH_DAT #labcentr#aBass#;

     |ABRE #labcentr;
     #labcentr#0 = #dsarw005#3;
     #labcentr#1 = #dsarw005#80;
     |LEE 000#labcentr.=;
     |SI FSalida ! 0;
         |MENAV "0000No existe el centro de trabajo.";
         |ERROR;
     |FINSI;
     |CIERRA #labcentr;

     #dsarw005#81 = #labcentr#2;  |PINTA #dsarw005#81;
|FPRC;

|PROCESO Baj80;
     #labcentr#0 = #dsarw005#3;
     #labcentr#1 = 001;
|FPRC;

|PROCESO Alt80;
     #labcentr#0 = #dsarw005#3;
     #labcentr#1 = 999;
|FPRC;

|PROCESO T66C80Fw5;  |TIPO 66;
     |DBASS aBass;
     aBass = aBass + "laboral/fich/";
     |PATH_DAT #labcentr#aBass#;

     |ABRE #labcentr;
     #labcentr#0 = #dsarw005#3;
     #labcentr#1 = #dsarw005#80;
     |LEE 000#labcentr.];
     |CONSULTA_F_CLAVE #1#labcentr, Baj80, Alt80;
     |SI FSalida = 0;
         #dsarw005#80 = #labcentr#1;  |PINTA #dsarw005#80;
         #dsarw005#81 = #labcentr#2;  |PINTA #dsarw005#81;
     |FINSI;
     |CIERRA #labcentr;
|FPRC;

|PROCESO TipoModificable;

     |C_M #905#12, 0, aAlfa;
     |SI aAlfa = "N";  |C_M #905#12, 1, "S";  |FINSI;

     |C_M #905#65, 0, aAlfa;
     |SI aAlfa = "N";  |C_M #905#65, 1, "S";  |FINSI;

||     |HAZ MiraSiRepe;
|FPRC;

|PROCESO MiraSiRepe; |TIPO 0;
     nEstoy = Campo;

     aMensaje = "0000Estoy en el Campo: " + nEstoy;
     |MENAV aMensaje;
|FPRC;

|PROCESO Tipo0C3Fw005;  |TIPO 0;
     |SI FSalida = 2;
         |PTEC 808;
         |PTEC 808;
         |PTEC 808;
         |ACABA;
     |FINSI;

     |C_M #905#3, 0, aPideCli;

     |SI enDESPANET = 0;
         |SI aPideCli = "N";  |ACABA;  |FINSI;
     |FINSI;

     |SI enDESPANET = 1;
         |C_M #905#3, 1, "N";
     |FINSI;

     enIdeCli = #905#3;
     |HAZ LeeCliente;

     #905#9  = eaNomCli;
     #905#11 = eaNifCli;

     |PINTA #905#9;
     |PINTA #905#11;

     eaCodNif = #905#11;
     |HAZ LeeNifs;
     #905#53 = eaNomNif;  |PINTA #905#53;
|FPRC;

|PROCESO Tipo6C11Fw005;  |TIPO 6;
     |C_M #905#11, 0, aPideNif;
     |SI aPideNif = "N";  |ACABA;  |FINSI;

     eaVarDni   = #905Campo;   |QBF eaVarDni;
     |SI eaVarDni = "";  |ACABA;  |FINSI;

     |SI FSalida = 10;
         eaVarDni   = #905Campo;
         enCalcCif  = 1;
         |HAZ CalculoDNI;
         #905Campo = eaVarDni;
         |PINTA #905Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #905Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;
     eaVarDni = (eaVarDni + "            ") % 112;
     |SI #905Campo ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #905Campo = eaVarDni;  |PINTA #905Campo;
             |ERROR;
         |FINSI;
     |FINSI;

     #905#53 = eaNomNif;  |PINTA #905#53;
|FPRC;

|PROCESO Tipo0C11Fw005;  |TIPO 0;
     aAlfa = #905Campo;  |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     |C_M #905#11, 0, aAlfa;
     |SI aAlfa = "N";  |ACABA;  |FINSI;

     eaCodNif = #905#11;
     |HAZ LeeNifs;
     #905#53 = eaNomNif;  |PINTA #905#53;
|FPRC;

|PROCESO Baja303;
     #303#0 = #905#3;
     #303#1 = 1;
|FPRC;

|PROCESO Alta303;
     #303#0 = #905#3;
     #303#1 = 99999;
|FPRC;

|PROCESO Tipo66C15Fw005;  |TIPO 66;
     |ABRE #303;
     #303#0 = #905#3;
     #303#1 = #905#15;
     |LEE 000#303=;
     |SI FSalida ! 0;  |DDEFECTO #303;  |FINSI;

     |CONSULTA_F_CLAVE #1#303, Baja303, Alta303;
     |SI FSalida = 0;
         #905#15 = #303#1;  |PINTA #905#15;
         #905#16 = #303#2;  |PINTA #905#16;
     |FINSI;

     |CIERRA #303;
|FPRC;

|PROCESO PintaNifTrab;
     aAlfa = #905#78;
     |QBF aAlfa;
     |SI aAlfa ! "";
          |CAMPO_VISUAL #905#78, 1, "S";
          |CONTROL_SIMPLE nPanta905_0, "LABEL,{{11}}NIF", 1454, 1460, NULL;
          |PINTA #905#78;
     |SINO;
          |CAMPO_VISUAL #905#78, 1, "N";
          |CONTROL_SIMPLE nPanta905_0, "LABEL,{{11}}   ", 1454, 1460, NULL;
     |FINSI;
|FPRC;

|PROCESO Tipo0C15Fw005;  |TIPO 0;
     |SI #905#15 = 0;
         #905#16 = "";  |PINTA #905#16;
         |ACABA;
     |FINSI;

     |ABRE #303;
     #303#0 = #905#3;
     #303#1 = #905#15;
     |LEE 000#303=;
     |SI FSalida ! 0;
         |DDEFECTO #303;
         |MENAV "0000 Trabajador inexistente en este Cliente.";
         |ERROR;
     |FINSI;
     |CIERRA #303;

     || #905#11 = #303#7;  |PINTA #905#11;
     || esto no tiene sentido aqui, me esta sustituyendo el NIF de cliente
     || por el NIF de trabajador si lo encuentra en la nomina
     || Creo un campo nuevo para pintar el NIF del trabajador y llevarmelo
     || luego al dsarm005 - Migue 23.11.2009

     #905#78 = #303#7;
     |HAZ PintaNifTrab;

     #905#16 = #303#2;  |PINTA #905#16;
|FPRC;

|PROCESO Tipo0C18Fw005;  |TIPO 0;
     |SI #905#18 > 12;  |Y #905#18 < 99;
         |MENAV "0000 Periodo Erroneo.";
         |ERROR;
     |FINSI;

     |SI #905#18 = 1;   #905#22 = "ENERO     ";  |FINSI;
     |SI #905#18 = 2;   #905#22 = "FEBRERO   ";  |FINSI;
     |SI #905#18 = 3;   #905#22 = "MARZO     ";  |FINSI;
     |SI #905#18 = 4;   #905#22 = "ABRIL     ";  |FINSI;
     |SI #905#18 = 5;   #905#22 = "MAYO      ";  |FINSI;
     |SI #905#18 = 6;   #905#22 = "JUNIO     ";  |FINSI;
     |SI #905#18 = 7;   #905#22 = "JULIO     ";  |FINSI;
     |SI #905#18 = 8;   #905#22 = "AGOSTO    ";  |FINSI;
     |SI #905#18 = 9;   #905#22 = "SEPTIEMBRE";  |FINSI;
     |SI #905#18 = 10;  #905#22 = "OCTUBRE   ";  |FINSI;
     |SI #905#18 = 11;  #905#22 = "NOVIEMBRE ";  |FINSI;
     |SI #905#18 = 12;  #905#22 = "DICIEMBRE ";  |FINSI;
     |SI #905#18 = 99;  #905#22 = "ANUAL     ";  |FINSI;

     |PINTA #905#22;
     |PINTA #905#17;

     |SI #905#19 = 0;  |ACABA;  |FINSI;

     |SI #299#5 = "T";
         |SI #905#18 ! 3;  |Y #905#18 ! 6;  |Y #905#18 ! 9; |Y #905#18 ! 12;
             |MENAV "     El Modelo lo tiene configurado Trimestral debe ser debe 3, 6, 9 o 12";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI #299#5 = "A";
         |SI #905#18 ! 99;
             |MENAV "     El Modelo lo tiene configurado Anual debe ser debe 99";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo0C19Fw005;  |TIPO 0;
     |C_M #dsarw005#80, 1, "N";

     |SI #905#19 = 0;  |ACABA;  |FINSI;

     |SI #dsarw005#19 ! 994;
         #dsarw005#80 = 0;
         #dsarw005#81 = "";
     |SINO;
         |C_M #dsarw005#80, 1, "S";
     |FINSI;

     |PINTA #dsarw005#80;
     |PINTA #dsarw005#81;

     |ABRE #299;
     #299#0 = #905#19;
     |LEE 040#299=;
     |SI FSalida ! 0;  |DDEFECTO #299;  |FINSI;
     |CIERRA #299;

     #905#21 = #299#1;   |PINTA #905#21;

     |SI #905#19 = 180;  |O #905#19 = 190;  |O #905#19 = 390;  |O #905#19 = 392;
      |O #905#19 = 184;  |O #905#19 = 193;
         #299#4 = "S";
     |FINSI;

     #905#18 = 0;
     |SI #905#19 = 180;  #905#18 = 99;  |FINSI;
     |SI #905#19 = 184;  #905#18 = 99;  |FINSI;
     |SI #905#19 = 190;  #905#18 = 99;  |FINSI;
     |SI #905#19 = 193;  #905#18 = 99;  |FINSI;
     |SI #905#19 = 390;  #905#18 = 99;  |FINSI;
     |SI #905#19 = 392;  #905#18 = 99;  |FINSI;
     |SI #905#19 = 347;  #905#18 = 99;  |FINSI;

     fFecha = ~;
     aAlfa  = fFecha % -104;
     #905#17   = aAlfa;
     |SI #905#18 = 99;
         #905#17   = #905#17  - 1;
     |FINSI;

     |SI #905#18 = 99;
         |C_M #905#18, 1, "N";
         |PINTA #905#18;
         |HAZ Tipo0C18Fw005;
     |SINO;
         fFecha = ~;
         aAlfa  = fFecha % 402;   nMes  = aAlfa;
         aAlfa  = fFecha % -104;  nAnyo = aAlfa;
         |SI #299#5 = "T";  |O #299#5 = "C";
             |SI nMes [ 3;
                 #905#18 = 12;
                 #905#17 = nAnyo - 1;
                 |HAZ Tipo0C18Fw005;
                 |PINTA #905#18;
                 |PINTA #905#17;
                 |ACABA;
             |FINSI;

             |SI nMes [ 6;
                 #905#18 = 3;
                 #905#17 = nAnyo;
                 |HAZ Tipo0C18Fw005;
                 |PINTA #905#18;
                 |PINTA #905#17;
                 |ACABA;
             |FINSI;

             |SI nMes [ 9;
                 #905#18 = 6;
                 #905#17 = nAnyo;
                 |HAZ Tipo0C18Fw005;
                 |PINTA #905#18;
                 |PINTA #905#17;
                 |ACABA;
             |FINSI;

             |SI nMes [ 12;
                 #905#18 = 9;
                 #905#17 = nAnyo;
                 |HAZ Tipo0C18Fw005;
                 |PINTA #905#18;
                 |PINTA #905#17;
                 |ACABA;
             |FINSI;
         |FINSI;

         |SI #299#5 = "A";
             #905#18 = 99;
             #905#17 = nAnyo - 1;
             |HAZ Tipo0C18Fw005;
             |PINTA #905#18;
             |PINTA #905#17;
         |FINSI;

         |SI #299#5 = "M";
             |SI nMes = 1;
                 #905#18 = 12;
                 #905#17 = nAnyo - 1;
                 |HAZ Tipo0C18Fw005;
             |SINO;
                 #905#18 = nMes - 1;
                 #905#17 = nAnyo;
                 |HAZ Tipo0C18Fw005;
             |FINSI;
             |PINTA #905#18;
             |PINTA #905#17;
         |FINSI;
     |FINSI;
|FPRC;
