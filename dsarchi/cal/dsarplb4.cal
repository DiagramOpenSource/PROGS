|FICHEROS;
     dsarm035 #35,MANTE;

     dsarm034;
     dsarm036 #36;
     dsarm005 #5;        ||Registro Documentos

     referen@ #1000;     ||Para los CargaDef
|FIN;

|VARIABLES;
     aVarAux = "";
     nNumeroAux = 0;
     aControlRedondeo = "";

     nAuxSuma = 0;
     &enNoTocarEmpPerContagen = 0;
     aUltimaLetra = "";

     aPais = "";
     nContaReal = 0;
     nSwControlCero = 0;      ||Sirve para si es cero, no crear linea en el lineal
     nValorCero = 0;
     nValorAntes = 0;
     nVentaContado = 0;

     aValorAnt = "";
     aAlfaAux = "";
     aBase = "";
     aDef = "";
     nNumReg = 0;
     aProNom = "";
     aProNif = "";
     aVarProNom = "";
     aVarProNif = "";
     nEmpConta = 0;
     nPerConta = 0;

     &enNumCampoPPI = 0;
     &eaValorPPI = "";
     &eaValorPPI2 = "";
     &eaValorPPI3 = "";
     &eaValorPPI4 = "";
     &eaValorPPI5 = "";
     &eaValorPPI6 = "";
     &enProveedor = 0;

     aNomVar = "";
     aNomVar2 = "";
     aNomVar3 = "";
     aNomVar4 = "";
     aNomVar5 = "";
     aNomVar6 = "";
     aMensaje = "";
     aPfj     = "";
|FIN;

||                               dsarplb5


          ||TIPOS DE INCIDENCIAS
          ||1. VARIABLE VACIA
          ||2. TIPO VARIABLE
          ||3. FECHA VALIDA
          ||4. CONTROL NIF/CIF
          ||5. CIF PARA OBTENER EMPRESA CONTAGEN
          ||6. CUADRE IMPORTES


|VARIABLES;
     nNumIva = 0;
     nGuiones = 0;
     nCaracteres = 0;
     aValorEntrada = "";
     nSwHayIncidencia = 0;
     &enCodPrimeraInc = 0;
     &eaPrimeraInc = "";

     aVarFecha = "";
     nErrorCuadres = 0;
     aErrorCuadre = "";

     nEmpContagen = 0;
     nPerContagen = 0;

     aFechaDesde = "";
     aFechaHasta = "";
     fFechaDesde = @;
     fFechaHasta = @;
     nSwEstaConta = 0;

     ||Tema Contagen.
     aCifContagen = "";
     aCifAra = "";
     aDirConta = "";
     aDirDatos = "";

     dia1 = "";
     aIdentificador = "";
     fFechaFac = @;
     nBase1Fac = 0;
     nBase2Fac = 0;
     nBase3Fac = 0;
     nBase4Fac = 0;
     nBase5Fac = 0;
     nCuotaIva1Fac = 0;
     nCuotaIva2Fac = 0;
     nCuotaIva3Fac = 0;
     nCuotaIva4Fac = 0;
     nCuotaIva5Fac = 0;
     nCuotaRe1Fac = 0;
     nCuotaRe2Fac = 0;
     nCuotaRe3Fac = 0;
     nCuotaRe4Fac = 0;
     nCuotaRe5Fac = 0;
     nCuotaReten1Fac = 0;
     nCuotaReten2Fac = 0;
     nCuotaReten3Fac = 0;
     nCuotaReten4Fac = 0;
     nCuotaReten5Fac = 0;
     nIva1Fac = 0;
     nIva2Fac = 0;
     nIva3Fac = 0;
     nIva4Fac = 0;
     nIva5Fac = 0;
     nRe1Fac = 0;
     nRe2Fac = 0;
     nRe3Fac = 0;
     nRe4Fac = 0;
     nRe5Fac = 0;
     nReten1Fac = 0;
     nReten2Fac = 0;
     nReten3Fac = 0;
     nReten4Fac = 0;
     nReten5Fac = 0;
     nTotalFac = 0;
     aReten1BF = "";
     aReten2BF = "";
     aReten3BF = "";
     aReten4BF = "";
     aReten5BF = "";
     nActividad = 0;

     nCuotaIva1Cal = 0;
     nCuotaIva2Cal = 0;
     nCuotaIva3Cal = 0;
     nCuotaIva4Cal = 0;
     nCuotaIva5Cal = 0;
     nCuotaRe1Cal = 0;
     nCuotaRe2Cal = 0;
     nCuotaRe3Cal = 0;
     nCuotaRe4Cal = 0;
     nCuotaRe5Cal = 0;
     nCuotaReten1Cal = 0;
     nCuotaReten2Cal = 0;
     nCuotaReten3Cal = 0;
     nCuotaReten4Cal = 0;
     nCuotaReten5Cal = 0;
     nTotalCal       = 0;
     nResto          = 0;
     nTopeError      = 0;
     nDEmpConta      = 0;
     nHEmpConta      = 0;

     ||ENTRADA
     &enSwAvisaInte = 0;
     &eaProcesoPIInte = "";
     &efFechaInte = @;
     &eaHoraInte = "";
     &eaFicInte = "";

     ||SALIDA
     &enResultadoInte = 0;
     &enCodIncidencia = 0;
     &eaIncidencia = "";

     ||NIF/CIF
     &eaVarDni = "";
     &enCalcCif = 0;
     &enModoSilencio = 0;
     &enHayErrorDni = 0;

     aAlfa = "";
     aAlfa1 = "";
     nComasPuntos = 0;
     aVerifica = "";
     aValor = "";
     nSwNumerico = 0;
     aTipoVar = "";
     aLong = "";
     nLong = 0;
     nVoy = 0;
     aSaca = "";
     aLetra = "";
     aSaca2 = "";
     aLetra2 = "";


     nDia = 0;
     nMes = 0;
     nAnyo = 0;
     aFecha = "";
     fFecha = @;
     nFecha = 0;
     fFechaDespues = @;

     aDia = "";
     aMes = "";
     aAnyo = "";
     nSalto = 0;
     aValorMin = "";
     nSwMesLetra = 0;
     aAntes = "";
     aDespues = "";
     nSalta = 0;


     aProcesoPI = "";

     aVacio25 = "";
     aZeta25 = "";
     aVacio = "";
     nDecimales = 0;
|FIN;

|PROCESO BuscaVentaContado;
     nVentaContado = 0;

     |DDEF aDef;  |QBF aDef;
     aDef = aDef + "dsarm035";
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #referen@;
     #referen@#0 = efFechaInte;
     #referen@#1 = eaHoraInte;
     #referen@#2 = eaFicInte;
     #referen@#3 = "FE000000_clinom";
     |LEE 000#referen@.=;
     |SI FSalida = 0;
         aAlfa = #referen@#4;  |QBF aAlfa;
         |SI aAlfa = "VENTA AL CONTADO";
          |O aAlfa = "VENTA CONTADO";
             nVentaContado = 1;
         |FINSI;
     |FINSI;

     |SI nVentaContado = 0;
         #referen@#0 = efFechaInte;
         #referen@#1 = eaHoraInte;
         #referen@#2 = eaFicInte;
         #referen@#3 = "FE000000_clinif";
         |LEE 000#referen@.=;
         |SI FSalida = 0;
             aAlfa = #referen@#4;  |QBF aAlfa;
             |SI aAlfa = "QTY000000";
                 nVentaContado = 1;
             |FINSI;
         |FINSI;
     |FINSI;

     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO ActNifyNombre;
     |ABRE #dsarm036;
     |ABRE #dsarm034;
     |DDEFECTO #dsarm034;
     #dsarm034#0 = efFechaInte;
     #dsarm034#1 = eaHoraInte;
     #dsarm034#2 = eaFicInte;
     |LEE 000#dsarm034.=;
     |SI FSalida = 0;
          nNumReg = #dsarm034#16;
          |SI nNumReg ! 0;
               aProNom = "";
               aProNif = "";
               aVarProNom = "";
               aVarProNif = "";
               nEmpConta = #dsarm034#18;
               nPerConta = #dsarm034#19;
               |DDEFECTO #dsarm036;
               |SELECT #2#dsarm036;
               #dsarm036#0 = eaProcesoPIInte;
               #dsarm036#8 = "pronom";
               |LEE 000#dsarm036.=;
               |SI FSalida = 0;
                    aVarProNom = #dsarm036#1;
               |FINSI;
               #dsarm036#0 = eaProcesoPIInte;
               #dsarm036#8 = "pronif";
               |LEE 000#dsarm036.=;
               |SI FSalida = 0;
                    aVarProNif = #dsarm036#1;
               |FINSI;
               |SELECT #1#dsarm036;

               |SI aVarProNom ! ""; |O aVarProNif ! "";
                    |DBASE aBase;
                    |QBF aBase;

                    aDef = aBase + "def/dsarm035";
                    |CARGA_DEF aDef, referen@;
                    |SI FSalida = 0;
                         |ABRE #referen@;
                         |SI aVarProNom ! "";
                              #referen@#0 = efFechaInte;
                              #referen@#1 = eaHoraInte;
                              #referen@#2 = eaFicInte;
                              #referen@#3 = aVarProNom;
                              |LEE 000#referen@.=;
                              |SI FSalida = 0;
                                   aProNom = #referen@#4;
                              |FINSI;
                         |FINSI;
                         |SI aVarProNif ! "";
                              #referen@#0 = efFechaInte;
                              #referen@#1 = eaHoraInte;
                              #referen@#2 = eaFicInte;
                              #referen@#3 = aVarProNif;
                              |LEE 000#referen@.=;
                              |SI FSalida = 0;
                                   aProNif = #referen@#4;
                              |FINSI;
                         |FINSI;
                         |CIERRA #referen@;
                         |DESCARGA_DEF #referen@;

                         |ABRE #dsarm005;
                         #dsarm005#0 = nNumReg;
                         |LEE 101#dsarm005.=;
                         |SI FSalida = 0;
                              #dsarm005#67 = nEmpConta;
                              #dsarm005#68 = nPerConta;
                              #dsarm005#10 = aProNif;
                              #dsarm005#38 = aProNom;
                              |GRABA 020#dsarm005.a;
                              |LIBERA #dsarm005;
                         |FINSI;
                         |CIERRA #dsarm005;
                    |FINSI;
                    ||ARA22
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #dsarm034;
     |CIERRA #dsarm036;
|FPRC;

|PROCESO Carga69;
     |SI enNumCampoPPI = 1;  aNomVar = aPfj + "000000_actividad";        |FINSI;
     |SI enNumCampoPPI = 3;  aNomVar = aPfj + "000000_representante";    |FINSI;
     |SI enNumCampoPPI = 5;  aNomVar = aPfj + "000000_pais";             |FINSI;
     |SI enNumCampoPPI = 6;  aNomVar = aPfj + "000000_idpaisre";         |FINSI;
     |SI enNumCampoPPI = 7;  aNomVar = aPfj + "000000_numidfiscalpais";  |FINSI;
     |SI enNumCampoPPI = 8;  aNomVar = aPfj + "000000_cloperacion";      |FINSI;
     |SI enNumCampoPPI = 9;  aNomVar = aPfj + "000000_nf";               |FINSI;
     |SI enNumCampoPPI = 10; aNomVar = aPfj + "000000_nr";               |FINSI;
     |SI enNumCampoPPI = 11; aNomVar = aPfj + "000000_primern";          |FINSI;
     |SI enNumCampoPPI = 12; aNomVar = aPfj + "000000_ultimon";          |FINSI;
     |SI enNumCampoPPI = 13; aNomVar = aPfj + "000000_idfactura";        |FINSI;
     |SI enNumCampoPPI = 14; aNomVar = aPfj + "000000_idfacrec";         |FINSI;
     |SI enNumCampoPPI = 15; aNomVar = aPfj + "000000_fechaexpe";        |FINSI;
     |SI enNumCampoPPI = 16; aNomVar = aPfj + "000000_fechaope";         |FINSI;
     |SI enNumCampoPPI = 17; aNomVar = aPfj + "000000_igic";             |FINSI;
     |SI enNumCampoPPI = 18; aNomVar = aPfj + "000000_bieninve";         |FINSI;
     |SI enNumCampoPPI = 19; aNomVar = aPfj + "000000_desbieninve";      |FINSI;
     |SI enNumCampoPPI = 20; aNomVar = aPfj + "000000_obs";              |FINSI;

     |SI aPfj = "FR";
         |SI enNumCampoPPI = 4;  aNomVar = aPfj + "000000_pronom";           |FINSI;

         |SI enNumCampoPPI = 2;
             aNomVar     = aPfj + "000000_pronif";
             aNomVar2    = aPfj + "000000_pronom";
         |FINSI;
     |FINSI;

     |SI aPfj = "FE";
         |SI enNumCampoPPI = 4;  aNomVar = aPfj + "000000_clinom";           |FINSI;

         |SI enNumCampoPPI = 2;
             aNomVar     = aPfj + "000000_clinif";
             aNomVar2    = aPfj + "000000_clinom";
         |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 21;
          aNomVar = aPfj + "000000_base1";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotaiva1";
          |FINSI;
          |SI eaValorPPI3 ! "";
               aNomVar3 = aPfj + "000000_cuotare1";
          |FINSI;
          |SI eaValorPPI4 ! "";
               aNomVar4 = aPfj + "000000_cuotareten1";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten1SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 22;
          aNomVar = aPfj + "000000_iva1";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotaiva1";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten1SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 23;
          aNomVar = aPfj + "000000_cuotaiva1";
     |FINSI;

     |SI enNumCampoPPI = 24;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_re1";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotare1";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten1SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 25;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotare1";
     |FINSI;

     |SI enNumCampoPPI = 26;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_reten1";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotareten1";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten1SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 27;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotareten1";
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten1SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 28;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_total";
     |FINSI;

     |SI enNumCampoPPI = 30;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_base2";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotaiva2";
          |FINSI;
          |SI eaValorPPI3 ! "";
               aNomVar3 = aPfj + "000000_cuotare2";
          |FINSI;
          |SI eaValorPPI4 ! "";
               aNomVar4 = aPfj + "000000_cuotareten2";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten2SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 31;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_iva2";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotaiva2";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten2SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 32;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotaiva2";
     |FINSI;

     |SI enNumCampoPPI = 33;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_re2";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotare2";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten2SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 34;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotare2";
     |FINSI;

     |SI enNumCampoPPI = 35;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_reten2";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotareten2";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten2SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 36;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotareten2";
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten2SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 37;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_base3";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotaiva3";
          |FINSI;
          |SI eaValorPPI3 ! "";
               aNomVar3 = aPfj + "000000_cuotare3";
          |FINSI;
          |SI eaValorPPI4 ! "";
               aNomVar4 = aPfj + "000000_cuotareten3";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten3SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 38;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_iva3";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotaiva3";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten3SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 39;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotaiva3";
     |FINSI;

     |SI enNumCampoPPI = 40;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_re3";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotare3";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten3SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 41;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotare3";
     |FINSI;

     |SI enNumCampoPPI = 42;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_reten3";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotareten3";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten3SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 43;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotareten3";
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten3SobreBF";
          |FINSI;
     |FINSI;

     ||Base4
     |SI enNumCampoPPI = 57;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_base4";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotaiva4";
          |FINSI;
          |SI eaValorPPI3 ! "";
               aNomVar3 = aPfj + "000000_cuotare4";
          |FINSI;
          |SI eaValorPPI4 ! "";
               aNomVar4 = aPfj + "000000_cuotareten4";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten4SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 58;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_iva4";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotaiva4";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten4SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 59;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotaiva4";
     |FINSI;

     |SI enNumCampoPPI = 60;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_re4";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotare4";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten4SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 61;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotare4";
     |FINSI;

     |SI enNumCampoPPI = 62;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_reten4";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotareten4";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten4SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 63;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotareten4";
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten4SobreBF";
          |FINSI;
     |FINSI;

     ||Base5
     |SI enNumCampoPPI = 64;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_base5";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotaiva5";
          |FINSI;
          |SI eaValorPPI3 ! "";
               aNomVar3 = aPfj + "000000_cuotare5";
          |FINSI;
          |SI eaValorPPI4 ! "";
               aNomVar4 = aPfj + "000000_cuotareten5";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten5SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 65;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_iva5";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotaiva5";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten5SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 66;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotaiva5";
     |FINSI;

     |SI enNumCampoPPI = 67;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_re5";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotare5";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten5SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 68;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotare5";
     |FINSI;

     |SI enNumCampoPPI = 69;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_reten5";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotareten5";
          |FINSI;
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten5SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 70;
          nSwControlCero = 1;
          aNomVar = aPfj + "000000_cuotareten5";
          |SI eaValorPPI6 ! "";
               aNomVar6 = aPfj + "000000_reten5SobreBF";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 71;
          nSwControlCero = 1;
          aNomVar6 = aPfj + "000000_reten1SobreBF";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotareten1";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 72;
          nSwControlCero = 1;
          aNomVar6 = aPfj + "000000_reten2SobreBF";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotareten2";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 73;
          nSwControlCero = 1;
          aNomVar6 = aPfj + "000000_reten3SobreBF";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotareten3";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 74;
          nSwControlCero = 1;
          aNomVar6 = aPfj + "000000_reten4SobreBF";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotareten4";
          |FINSI;
     |FINSI;

     |SI enNumCampoPPI = 75;
          nSwControlCero = 1;
          aNomVar6 = aPfj + "000000_reten5SobreBF";
          |SI eaValorPPI2 ! "";
               aNomVar2 = aPfj + "000000_cuotareten5";
          |FINSI;
     |FINSI;

     |SI eaValorPPI5 ! "";
         aNomVar5 = aPfj + "000000_total";
     |FINSI;
|FPRC;

|PROCESO Carga70;
     |SI aPfj = "FR";
         |SI enNumCampoPPI = 1;  aNomVar = aPfj + "000000_pronom";        |FINSI;
         |SI enNumCampoPPI = 2;  aNomVar = aPfj + "000000_pais";          |FINSI;
         |SI enNumCampoPPI = 4;  aNomVar = aPfj + "000000_procalle";      |FINSI;
         |SI enNumCampoPPI = 5;  aNomVar = aPfj + "000000_procodpos";     |FINSI;
         |SI enNumCampoPPI = 6;  aNomVar = aPfj + "000000_prolocalidad";  |FINSI;
         |SI enNumCampoPPI = 7;  aNomVar = aPfj + "000000_prortelefono";  |FINSI;
         |SI enNumCampoPPI = 8;  aNomVar = aPfj + "000000_profax";        |FINSI;
         |SI enNumCampoPPI = 9;  aNomVar = aPfj + "000000_proapcorreo";   |FINSI;
     |FINSI;

     |SI aPfj = "FE";
         |SI enNumCampoPPI = 1;  aNomVar = aPfj + "000000_clinom";        |FINSI;
         |SI enNumCampoPPI = 2;  aNomVar = aPfj + "000000_pais";          |FINSI;
         |SI enNumCampoPPI = 4;  aNomVar = aPfj + "000000_clicalle";      |FINSI;
         |SI enNumCampoPPI = 5;  aNomVar = aPfj + "000000_clicodpos";     |FINSI;
         |SI enNumCampoPPI = 6;  aNomVar = aPfj + "000000_clilocalidad";  |FINSI;
         |SI enNumCampoPPI = 7;  aNomVar = aPfj + "000000_clirtelefono";  |FINSI;
         |SI enNumCampoPPI = 8;  aNomVar = aPfj + "000000_clifax";        |FINSI;
         |SI enNumCampoPPI = 9;  aNomVar = aPfj + "000000_cliapcorreo";   |FINSI;
     |FINSI;
|FPRC;

|PROCESO FormularioaVariables;
     |ABRE #dsarm035;

     aNomVar = "";
     aNomVar2 = "";
     aNomVar3 = "";
     aNomVar4 = "";
     aNomVar5 = "";
     aNomVar6 = "";
     nSwControlCero = 0;

     aPfj = eaProcesoPIInte % 102;

     |SI enProveedor = 0;  |HAZ Carga69;  |FINSI;
     |SI enProveedor = 1;  |HAZ Carga70;  |FINSI;

     |SI aNomVar ! "";
          |DDEFECTO #dsarm035;
          #dsarm035#0 = efFechaInte;
          #dsarm035#1 = eaHoraInte;
          #dsarm035#2 = eaFicInte;
          #dsarm035#3 = aNomVar;
          |LEE 101#dsarm035.=;
          |SI FSalida ! 0;
               |SI nSwControlCero = 1;
                    nValorCero = eaValorPPI;
                    |SI nValorCero = 0;
                         |ACABA;
                    |FINSI;
               |FINSI;

               |GRABA 020#dsarm035.b;

               |ABRE #dsarm036;
               |DDEFECTO #dsarm036;
               #dsarm036#0 = eaProcesoPIInte;
               #dsarm036#1 = #dsarm035#3;
               |LEE 000#dsarm036.=;
               |SI FSalida = 0;
                    #dsarm035#10 = #dsarm036#9;
               |FINSI;
               |CIERRA #dsarm036;
          |SINO;
               |SI nSwControlCero = 1;
                    nValorCero = eaValorPPI;
                    nValorAntes = #dsarm035#4;
                    |SI nValorCero = 0; |Y nValorAntes = 0;
                         |LIBERA #dsarm035;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          aValorAnt = #dsarm035#9;
          |QBF aValorAnt;
          |SI aValorAnt = "*SIN CAMBIOS*";
               #dsarm035#9 = #dsarm035#4;
          |FINSI;
          #dsarm035#4 = eaValorPPI;
          #dsarm035#5 = 3;
          #dsarm035#8 = "0,158,0;255,255,255";
          #dsarm035#6 = "";
          #dsarm035#7 = 0;
          |GRABA 020#dsarm035.a;
          |LIBERA #dsarm035;

          |ABRE #dsarm036;
          |DDEFECTO #dsarm036;
          #dsarm036#0 = eaProcesoPIInte;
          #dsarm036#1 = #dsarm035#3;
          |LEE 000#dsarm036.=;
          |SI FSalida = 0;
               aAlfaAux = #dsarm036#8;
               |QBF aAlfaAux;
               |SI aAlfaAux = "pronom"; |O aAlfaAux = "pronif";
                    |HAZ ActNifyNombre;
               |FINSI;
          |FINSI;
          |CIERRA #dsarm036;
     |FINSI;
     |SI aNomVar2 ! "";
          |DDEFECTO #dsarm035;
          #dsarm035#0 = efFechaInte;
          #dsarm035#1 = eaHoraInte;
          #dsarm035#2 = eaFicInte;
          #dsarm035#3 = aNomVar2;
          |LEE 101#dsarm035.=;
          |SI FSalida ! 0;
               |GRABA 020#dsarm035.b;
               |ABRE #dsarm036;
               |DDEFECTO #dsarm036;
               #dsarm036#0 = eaProcesoPIInte;
               #dsarm036#1 = #dsarm035#3;
               |LEE 000#dsarm036.=;
               |SI FSalida = 0;
                    #dsarm035#10 = #dsarm036#9;
               |FINSI;
               |CIERRA #dsarm036;
          |FINSI;
          |QBF aValorAnt;
          |SI aValorAnt = "*SIN CAMBIOS*";
               #dsarm035#9 = #dsarm035#4;
          |FINSI;
          #dsarm035#4 = eaValorPPI2;
          #dsarm035#5 = 3;
          #dsarm035#8 = "0,158,0;255,255,255";
          #dsarm035#6 = "";
          #dsarm035#7 = 0;
          |GRABA 020#dsarm035.a;
          |LIBERA #dsarm035;
     |FINSI;
     |SI aNomVar3 ! "";
          |DDEFECTO #dsarm035;
          #dsarm035#0 = efFechaInte;
          #dsarm035#1 = eaHoraInte;
          #dsarm035#2 = eaFicInte;
          #dsarm035#3 = aNomVar3;
          |LEE 101#dsarm035.=;
          |SI FSalida ! 0;
               |GRABA 020#dsarm035.b;
               |ABRE #dsarm036;
               |DDEFECTO #dsarm036;
               #dsarm036#0 = eaProcesoPIInte;
               #dsarm036#1 = #dsarm035#3;
               |LEE 000#dsarm036.=;
               |SI FSalida = 0;
                    #dsarm035#10 = #dsarm036#9;
               |FINSI;
               |CIERRA #dsarm036;
          |FINSI;
          |QBF aValorAnt;
          |SI aValorAnt = "*SIN CAMBIOS*";
               #dsarm035#9 = #dsarm035#4;
          |FINSI;
          #dsarm035#4 = eaValorPPI3;
          #dsarm035#5 = 3;
          #dsarm035#8 = "0,158,0;255,255,255";
          #dsarm035#6 = "";
          #dsarm035#7 = 0;
          |GRABA 020#dsarm035.a;
          |LIBERA #dsarm035;
     |FINSI;
     |SI aNomVar4 ! "";
          |DDEFECTO #dsarm035;
          #dsarm035#0 = efFechaInte;
          #dsarm035#1 = eaHoraInte;
          #dsarm035#2 = eaFicInte;
          #dsarm035#3 = aNomVar4;
          |LEE 101#dsarm035.=;
          |SI FSalida ! 0;
               |GRABA 020#dsarm035.b;
               |ABRE #dsarm036;
               |DDEFECTO #dsarm036;
               #dsarm036#0 = eaProcesoPIInte;
               #dsarm036#1 = #dsarm035#3;
               |LEE 000#dsarm036.=;
               |SI FSalida = 0;
                    #dsarm035#10 = #dsarm036#9;
               |FINSI;
               |CIERRA #dsarm036;
          |FINSI;
          |QBF aValorAnt;
          |SI aValorAnt = "*SIN CAMBIOS*";
               #dsarm035#9 = #dsarm035#4;
          |FINSI;
          #dsarm035#4 = eaValorPPI4;
          #dsarm035#5 = 3;
          #dsarm035#8 = "0,158,0;255,255,255";
          #dsarm035#6 = "";
          #dsarm035#7 = 0;
          |GRABA 020#dsarm035.a;
          |LIBERA #dsarm035;
     |FINSI;
     |SI aNomVar5 ! "";
          |DDEFECTO #dsarm035;
          #dsarm035#0 = efFechaInte;
          #dsarm035#1 = eaHoraInte;
          #dsarm035#2 = eaFicInte;
          #dsarm035#3 = aNomVar5;
          |LEE 101#dsarm035.=;
          |SI FSalida ! 0;
               |GRABA 020#dsarm035.b;
               |ABRE #dsarm036;
               |DDEFECTO #dsarm036;
               #dsarm036#0 = eaProcesoPIInte;
               #dsarm036#1 = #dsarm035#3;
               |LEE 000#dsarm036.=;
               |SI FSalida = 0;
                    #dsarm035#10 = #dsarm036#9;
               |FINSI;
               |CIERRA #dsarm036;
          |FINSI;
          |QBF aValorAnt;
          |SI aValorAnt = "*SIN CAMBIOS*";
               #dsarm035#9 = #dsarm035#4;
          |FINSI;
          #dsarm035#4 = eaValorPPI5;
          #dsarm035#5 = 3;
          #dsarm035#8 = "0,158,0;255,255,255";
          #dsarm035#6 = "";
          #dsarm035#7 = 0;
          |GRABA 020#dsarm035.a;
          |LIBERA #dsarm035;
     |FINSI;

     |SI aNomVar6 ! "";
          |SI eaValorPPI6 = "F";
               |DDEFECTO #dsarm035;
               #dsarm035#0 = efFechaInte;
               #dsarm035#1 = eaHoraInte;
               #dsarm035#2 = eaFicInte;
               #dsarm035#3 = aNomVar6;
               |LEE 101#dsarm035.=;
               |SI FSalida ! 0;
                    |GRABA 020#dsarm035.b;
                    |ABRE #dsarm036;
                    |DDEFECTO #dsarm036;
                    #dsarm036#0 = eaProcesoPIInte;
                    #dsarm036#1 = #dsarm035#3;
                    |LEE 000#dsarm036.=;
                    |SI FSalida = 0;
                         #dsarm035#10 = #dsarm036#9;
                    |FINSI;
                    |CIERRA #dsarm036;
               |FINSI;
               |QBF aValorAnt;
               |SI aValorAnt = "*SIN CAMBIOS*";
                    #dsarm035#9 = #dsarm035#4;
               |FINSI;
               #dsarm035#4 = eaValorPPI6;
               #dsarm035#5 = 3;
               #dsarm035#8 = "0,158,0;255,255,255";
               #dsarm035#6 = "";
               #dsarm035#7 = 0;
               |GRABA 020#dsarm035.a;
               |LIBERA #dsarm035;
          |SINO;
               |DDEFECTO #dsarm035;
               #dsarm035#0 = efFechaInte;
               #dsarm035#1 = eaHoraInte;
               #dsarm035#2 = eaFicInte;
               #dsarm035#3 = aNomVar6;
               |LEE 101#dsarm035.=;
               |SI FSalida = 0;
                    |BORRA 020#dsarm035.a;
               |FINSI;
               |LIBERA #dsarm035;
          |FINSI;
     |FINSI;

     |CIERRA #dsarm035;
|FPRC;

|PROCESO dsarm036_vacio;
     aAlfa = #dsarm036#1;  |QBF aAlfa;
     |SI aAlfa = "FE000000_clinif";
         |HAZ BuscaVentaContado;
         |SI nVentaContado = 1;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #dsarm036#2 = "S";
          |DDEFECTO #dsarm035;
          #dsarm035#0 = efFechaInte;
          #dsarm035#1 = eaHoraInte;
          #dsarm035#2 = eaFicInte;
          #dsarm035#3 = #dsarm036#1;
          |LEE 101#dsarm035.=;
          |SI FSalida ! 0;
               nSwHayIncidencia = 1;
               enCodIncidencia = 1;
               eaIncidencia = "Variable vacia [" + #dsarm036#1;
               |QBF eaIncidencia;
               eaIncidencia = eaIncidencia + "]";
               #dsarm035#5 = 2;
               #dsarm035#7 = enCodIncidencia;
               #dsarm035#6 = eaIncidencia;
               #dsarm035#8 = "255,0,0;255,255,255";
               #dsarm035#10 = #dsarm036#9;
               |GRABA 020#dsarm035.n;
               |LIBERA #dsarm035;
          |SINO;
               aVacio = #dsarm035#4;
               |QBF aVacio;
               |SI aVacio = "";
                    nSwHayIncidencia = 1;
                    enCodIncidencia = 1;
                    eaIncidencia = "Variable vacia [" + #dsarm036#1;
                    |QBF eaIncidencia;
                    eaIncidencia = eaIncidencia + "]";
                    #dsarm035#5 = 2;
                    #dsarm035#7 = enCodIncidencia;
                    #dsarm035#6 = eaIncidencia;
                    #dsarm035#8 = "255,0,0;255,255,255";
                    |GRABA 020#dsarm035.a;
               |FINSI;
               |LIBERA #dsarm035;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm036_vacio;
 #dsarm036#1;
 ;
 aProcesoPI, aVacio25;
 aProcesoPI, aZeta25;
 ;
 NULL, dsarm036_vacio;
|FIN;

|PROCESO LimpiaNumerico;
     nDecimales = #dsarm034#21;
     |SI nDecimales = 0;
          nDecimales = 2;
     |FINSI;

     ||ARA22
     aAlfa = "";
     nCaracteres = 0;
     nGuiones = 0;
     aLong = aVerifica % A0;
     nLong = aLong;
     |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
          aSaca = nVoy + "01";
          aSaca = "-" + aSaca;
          aLetra = aVerifica % aSaca;

          |SI aLetra < "0"; |O aLetra > "9";
               |SI aLetra = "-";        ||Signo negativo
                    aSaca2 = nVoy + "02";
                    aSaca2 = "-" + aSaca2;
                    aLetra2 = aVerifica % aSaca2;
                    |SI aLetra2 = ".-";
                         ||Para saltar este valor.
                         nVoy = nVoy + 1;
                    |SINO;
                         |SI nCaracteres ! 0;
                              aAlfa = aLetra + aAlfa;
                              |SAL;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |SI aLetra = "."; |O aLetra = " "; |O aLetra = "'"; |O aLetra = ","; |O aLetra = "`";
               ||MANOLO. PARA CONTROL DE LOS DECIMALES
                    |SI nCaracteres [ nDecimales;  |Y nCaracteres > 0; |Y nGuiones = 0;
                         aAlfa = "," + aAlfa;
                         nGuiones = nGuiones + 1;
                    |FINSI;
               |FINSI;
               ||No es un caracter numerico
          |SINO;
               aAlfa = aLetra + aAlfa;
               nCaracteres = nCaracteres + 1;
          |FINSI;
     |SIGUE;
     aVerifica = aAlfa;
|FPRC;


|PROCESO EsNumerico;
     nComasPuntos = 0;
     aLong = aVerifica % A0;
     nLong = aLong;
     |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
          aSaca = nVoy + "01";
          aLetra = aVerifica % aSaca;
          |SI aLetra = ","; |O aLetra = ".";
               nComasPuntos = nComasPuntos + 1;
               |SI nComasPuntos > 1;
                    nSwNumerico = 0;
                    |SAL;
               |FINSI;
          |SINO;
               |SI aLetra < "0"; |O aLetra > "9";
                    |SI aLetra ! "-";
                         nSwNumerico = 0;
                         |SAL;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO QBI;
     ||Varible:  aVerifica
     aAlfa = "";

     aLong = aVerifica % A0;
     nLong = aLong;
     |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
          aSaca = nVoy + "01";
          aLetra = aVerifica % aSaca;
          |SI aLetra ! " ";
               aAlfa = aVerifica % nVoy;
               |SAL;
          |FINSI;
     |SIGUE;

     |SI aAlfa ! "";
          aVerifica = aAlfa;
     |FINSI;
|FPRC;

|PROCESO Pilla9Digitos;  ||Sirve para pillar unicamente 9 digitos para los NIF/CIF
     |SI aPais = "ES";
          aAlfa = aVerifica % -109;
          aVerifica = aAlfa;
     |FINSI;
|FPRC;

|PROCESO PorDetrasHastaEspacio;
     aAlfa = "";

     aLong = aVerifica % A0;
     nLong = aLong;
     |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
          aSaca = nVoy + "01";
          aSaca = "-" + aSaca;
          aLetra = aVerifica % aSaca;
          |SI aLetra = " ";
               ||No hacemos nada. Estos caracteres son los que quitamos
               |SAL;
          |SINO;
               aAlfa = aLetra + aAlfa;
          |FINSI;
     |SIGUE;
     aVerifica = aAlfa;
|FPRC;

|PROCESO QuitaGuionesyDemasNIF;
     aAlfa = "";

     nContaReal = 0;
     aLong = aVerifica % A0;
     nLong = aLong;
     |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
          aSaca = nVoy + "01";
          aLetra = aVerifica % aSaca;
          |SI aLetra = "-"; |O aLetra = "."; |O aLetra = " "; |O aLetra = "/"; |O aLetra = "\"; |O aLetra = ","; |O aLetra = ":"; |O aLetra = "?";
               ||No hacemos nada. Estos caracteres son los que quitamos
          |SINO;
               aAlfa = aAlfa + aLetra;
          |FINSI;
     |SIGUE;
     aVerifica = aAlfa;
|FPRC;

|PROCESO ControlDigitosNIF;
     aAlfa = "";

     nContaReal = 0;
     aLong = aVerifica % A0;
     nLong = aLong;
     |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
          aSaca = nVoy + "01";
          aLetra = aVerifica % aSaca;
          ||Tiquet 4182.117. y Tiquet 700000.6393
          ||Asumimos que el primer digito es una letra y el resto numeros
          nContaReal = nContaReal + 1;
          |SI nContaReal > 1;
               |SI aLetra = "O"; |O aLetra = "o";
                    aLetra = "0";
               |FINSI;
               |SI aLetra = "L"; |O aLetra = "l";
                    aLetra = "1";
               |FINSI;
               |SI aLetra = "Z"; |O aLetra = "z";
                    aLetra = "2";
               |FINSI;
               |SI aLetra = "A";
                    aLetra = "4";
               |FINSI;
               |SI aLetra = "S"; |O aLetra = "s";
                    aLetra = "5";
               |FINSI;
               |SI aLetra = "G";
                    aLetra = "6";
               |FINSI;
               |SI aLetra = "B";
                    aLetra = "8";
               |FINSI;
               |SI aLetra = "q"; |O aLetra = "g";
                    aLetra = "9";
               |FINSI;
               aAlfa = aAlfa + aLetra;
          |SINO;
               ||El primer digito
               |SI aLetra = "8";
                    aUltimaLetra = aVerifica % -101;
                    |SI aUltimaLetra ] "0"; |Y aUltimaLetra [ "9";
                         aLetra = "B";
                    |FINSI;
                    aAlfa = aAlfa + aLetra;
               |SINO;
                    aAlfa = aAlfa + aLetra;
               |FINSI;
          |FINSI;
     |SIGUE;
     aVerifica = aAlfa;
|FPRC;


|PROCESO MeteIdentificador;
     ||No se si tendre que hacer algun tratamientod del punto/coma separador
     ||de la parte entera y la decimal, por ahora SIN tratamiento.

     |SI aIdentificador = "base1";
          nBase1Fac = aValor;
     |FINSI;
     |SI aIdentificador = "base2";
          nBase2Fac = aValor;
     |FINSI;
     |SI aIdentificador = "base3";
          nBase3Fac = aValor;
     |FINSI;
     |SI aIdentificador = "base4";
          nBase4Fac = aValor;
     |FINSI;
     |SI aIdentificador = "base5";
          nBase5Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotaiva1";
          nCuotaIva1Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotaiva2";
          nCuotaIva2Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotaiva3";
          nCuotaIva3Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotaiva4";
          nCuotaIva4Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotaiva5";
          nCuotaIva5Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotare1";
          nCuotaRe1Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotare2";
          nCuotaRe2Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotare3";
          nCuotaRe3Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotare4";
          nCuotaRe4Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotare5";
          nCuotaRe5Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotareten1";
          nCuotaReten1Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotareten2";
          nCuotaReten2Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotareten3";
          nCuotaReten3Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotareten4";
          nCuotaReten4Fac = aValor;
     |FINSI;
     |SI aIdentificador = "cuotareten5";
          nCuotaReten5Fac = aValor;
     |FINSI;
     |SI aIdentificador = "iva1";
          nIva1Fac = aValor;
     |FINSI;
     |SI aIdentificador = "iva2";
          nIva2Fac = aValor;
     |FINSI;
     |SI aIdentificador = "iva3";
          nIva3Fac = aValor;
     |FINSI;
     |SI aIdentificador = "iva4";
          nIva4Fac = aValor;
     |FINSI;
     |SI aIdentificador = "iva5";
          nIva5Fac = aValor;
     |FINSI;
     |SI aIdentificador = "re1";
          nRe1Fac = aValor;
     |FINSI;
     |SI aIdentificador = "re2";
          nRe2Fac = aValor;
     |FINSI;
     |SI aIdentificador = "re3";
          nRe3Fac = aValor;
     |FINSI;
     |SI aIdentificador = "re4";
          nRe4Fac = aValor;
     |FINSI;
     |SI aIdentificador = "re5";
          nRe5Fac = aValor;
     |FINSI;
     |SI aIdentificador = "reten1";
          nReten1Fac = aValor;
     |FINSI;
     |SI aIdentificador = "reten2";
          nReten2Fac = aValor;
     |FINSI;
     |SI aIdentificador = "reten3";
          nReten3Fac = aValor;
     |FINSI;
     |SI aIdentificador = "reten4";
          nReten4Fac = aValor;
     |FINSI;
     |SI aIdentificador = "reten5";
          nReten5Fac = aValor;
     |FINSI;

     |SI aIdentificador = "reten1SobreBF"; aReten1BF = aValor; |FINSI;
     |SI aIdentificador = "reten2SobreBF"; aReten2BF = aValor; |FINSI;
     |SI aIdentificador = "reten3SobreBF"; aReten3BF = aValor; |FINSI;
     |SI aIdentificador = "reten4SobreBF"; aReten4BF = aValor; |FINSI;
     |SI aIdentificador = "reten5SobreBF"; aReten5BF = aValor; |FINSI;
     |SI aIdentificador = "total";
          nTotalFac = aValor;
     |FINSI;
|FPRC;

|PROCESO canempre;
     ||Controlar el CIF, la fecha (ini y fin) y el inactiva S/N.

     aCifAra = #referen@#8;
     |QBT aCifAra;
     aVerifica = aCifAra;
     |HAZ QuitaGuionesyDemasNIF;
     aCifAra = aVerifica;
     |SI aCifAra = aCifContagen;
          |SI #referen@#21 = "A";       ||Empresa activa.
               aFechaDesde = "01." + (("00" + #referen@#11) % -102) + ".20" + (("00" + #referen@#26) % -102);
               dia1 = "31";
               |SI #referen@#12 = 4; |O #referen@#12 = 6; |O #referen@#12 = 9; |O #referen@#12 = 11;
                  dia1 = "30";
               |FINSI;
               |SI #referen@#12 = 2;
                  dia1 = "28";
                  |SI #referen@#12 = 8; |O #referen@#12 = 12; |O #referen@#12 = 16; |O #referen@#12 = 20; |O #referen@#12 = 24; |O #referen@#12 = 28;
                     dia1 = "29";
                  |FINSI;
               |FINSI;
               aFechaHasta = dia1 + "." + (("00" + #referen@#12) % -102) + ".20" + (("00" + #referen@#26) % -102);

               fFechaDesde = aFechaDesde;
               fFechaHasta = aFechaHasta;
               |SI fFechaFac ] fFechaDesde; |Y fFechaFac [ fFechaHasta;
                    nSwEstaConta = 1;
                    nEmpContagen = #referen@#2;
                    nPerContagen = #referen@#3;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE canempre;
     #referen@#1002;
     ;
     nDEmpConta, 0;
     nHEmpConta, 9;
     ;
     NULL, canempre;
|FIN;

|PROCESO dsarm035_fecha;
     |HAZ dsarm035;
|FPRC;

|PROCESO ActEmpContagen;
     |SI enNoTocarEmpPerContagen = 0;
          |ABRE #dsarm034;
          |DDEFECTO #dsarm034;
          #dsarm034#0 = efFechaInte;
          #dsarm034#1 = eaHoraInte;
          #dsarm034#2 = eaFicInte;
          |LEE 101#dsarm034.=;
          |SI FSalida = 0;
               #dsarm034#18 = nEmpContagen;
               #dsarm034#19 = nPerContagen;
               |GRABA 020#dsarm034.a;
               |LIBERA #dsarm034;
          |FINSI;
          |CIERRA #dsarm034;
     |FINSI;
|FPRC;

|PROCESO ActEstadoIntegridad;
     |ABRE #dsarm034;
     |DDEFECTO #dsarm034;
     #dsarm034#0 = efFechaInte;
     #dsarm034#1 = eaHoraInte;
     #dsarm034#2 = eaFicInte;
     |LEE 101#dsarm034.=;
     |SI FSalida = 0;
          |SI enResultadoInte = 0;
               #dsarm034#9 = "N";
          |SINO;
               #dsarm034#9 = "S";
          |FINSI;
          |SI #dsarm034#9 = "S"; |Y #dsarm034#10 = "N";
               #dsarm034#15 = "18,28,245;255,255,255";
          |FINSI;
          |SI #dsarm034#9 = "N"; |Y #dsarm034#10 = "N";
               #dsarm034#15 = "255,0,0;255,255,255";
          |FINSI;
          |GRABA 020#dsarm034.a;
          |LIBERA #dsarm034;
     |FINSI;
     |CIERRA #dsarm034;
|FPRC;

|PROCESO BuscaEmpPerConta;
     nDEmpConta   = 1;
     nHEmpConta   = 99999;
     nEmpContagen = 0;

     |SI #dsarm034#18 ! 0;
         nDEmpConta   = #dsarm034#18;
         nHEmpConta   = #dsarm034#18;
         nEmpContagen = #dsarm034#18;
     |FINSI;

     nPerContagen = -1;
     nSwEstaConta = 0;
     |BUCLE canempre;

     |SI nPerContagen = -1;
         nDEmpConta   = 1;
         nHEmpConta   = 99999;
         nEmpContagen = 0;
         |BUCLE canempre;
     |FINSI;
|FPRC;

|PROCESO dsarm035;
     |DDEFECTO #dsarm036;
     #dsarm036#0 = aProcesoPI;
     #dsarm036#1 = #dsarm035#3;
     |LEE 000#dsarm036.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     ||Realizar resto de verificaciones integridad.
     ||2. TIPO VARIABLE

     aTipoVar = #dsarm036#3;
     |QBF aTipoVar;
     |SI aTipoVar = ""; |O aTipoVar = "A"; |O aTipoVar = "F";
          ||Nada, todo correcto.
          ||Si esta vacio, es pq. no tengo que verificar nada
          ||Si es alfanumerico, cualquier valor sera correcto
          ||Si es fecha, ya tengo un contro especifico para fechas validas
     |SINO;
          ||Es numerico, verifico que realmente es un numero.

          aValorEntrada = #dsarm035#4;
          |QBF aValorEntrada;
          aValor = #dsarm035#4;
          |QBF aValor;
          |SI aValor = "";  aValor = "0";  |FINSI;
          aVerifica = aValor
          |HAZ LimpiaNumerico;
          aValor = aVerifica;

          |SI aValor = "";
               nSwHayIncidencia = 1;
               enCodIncidencia = 2;
               eaIncidencia = "Variable no numerica [" + #dsarm036#1;
               |QBF eaIncidencia;
               eaIncidencia = eaIncidencia + "]";
               #dsarm035#5 = 2;
               #dsarm035#7 = enCodIncidencia;
               #dsarm035#6 = eaIncidencia;
               #dsarm035#8 = "255,0,0;255,255,255";
               |GRABA 020#dsarm035.a;
               |SI enSwAvisaInte = 1;
                    |LIBERA #dsarm035;
                    |ACABA;
               |FINSI;
          |SINO;
               aVerifica = aValor;
               nSwNumerico = 1;
               |HAZ EsNumerico;

               |SI nSwNumerico = 0;
                    nSwHayIncidencia = 1;
                    enCodIncidencia = 2;
                    eaIncidencia = "Variable no numerica [" + #dsarm036#1;
                    |QBF eaIncidencia;
                    eaIncidencia = eaIncidencia + "]";
                    #dsarm035#5 = 2;
                    #dsarm035#7 = enCodIncidencia;
                    #dsarm035#6 = eaIncidencia;
                    #dsarm035#8 = "255,0,0;255,255,255";
                    |GRABA 020#dsarm035.a;
                    |SI enSwAvisaInte = 1;
                         |LIBERA #dsarm035;
                         |ACABA;
                    |FINSI;
               |SINO;
                    |SI aValor ! aValorEntrada;
                         #dsarm035#4 = aValor;
                         |GRABA 020#dsarm035.a;
                         |LIBERA #dsarm035;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;


     ||3. FECHA VALIDA
     |SI #dsarm036#4 = "S";
          aValor = #dsarm035#4;

          ||Primero quito los espacios en blanco por el inicio y por el final

          |QBF aValor;
          aVerifica = aValor;
          |HAZ QBI;
          aValor = aVerifica;

          aDia = "";
          aMes = "";
          aAnyo = "";

          aValorMin = aValor < aValor;  ||Lo paso a minusculas

          nSwMesLetra = 0;
          ||Luego verifico si el mes esta en letra
          aAntes = aValorMin;
          aDespues = aValorMin - "ene";
          |SI aAntes ! aDespues;
               aMes = "01";
               nSwMesLetra = 1;
          |FINSI;
          aDespues = aValorMin - "feb";
          |SI aAntes ! aDespues;
               aMes = "02";
               nSwMesLetra = 1;
          |FINSI;
          aDespues = aValorMin - "mar";
          |SI aAntes ! aDespues;
               aMes = "03";
               nSwMesLetra = 1;
          |FINSI;
          aDespues = aValorMin - "abr";
          |SI aAntes ! aDespues;
               aMes = "04";
               nSwMesLetra = 1;
          |FINSI;
          aDespues = aValorMin - "may";
          |SI aAntes ! aDespues;
               aMes = "05";
               nSwMesLetra = 1;
          |FINSI;
          aDespues = aValorMin - "jun";
          |SI aAntes ! aDespues;
               aMes = "06";
               nSwMesLetra = 1;
          |FINSI;
          aDespues = aValorMin - "jul";
          |SI aAntes ! aDespues;
               aMes = "07";
               nSwMesLetra = 1;
          |FINSI;
          aDespues = aValorMin - "ago";
          |SI aAntes ! aDespues;
               aMes = "08";
               nSwMesLetra = 1;
          |FINSI;
          aDespues = aValorMin - "sep";
          |SI aAntes ! aDespues;
               aMes = "09";
               nSwMesLetra = 1;
          |FINSI;
          aDespues = aValorMin - "oct";
          |SI aAntes ! aDespues;
               aMes = "10";
               nSwMesLetra = 1;
          |FINSI;
          aDespues = aValorMin - "nov";
          |SI aAntes ! aDespues;
               aMes = "11";
               nSwMesLetra = 1;
          |FINSI;
          aDespues = aValorMin - "dic";
          |SI aAntes ! aDespues;
               aMes = "12";
               nSwMesLetra = 1;
          |FINSI;
          ||Si lo esta .. proceso MesLetra

          ||Ahora saco el Anyo y el Mes si aun no lo tengo.

          nSalto = 0;
          aLong = aVerifica % A0;
          nLong = aLong;
          |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
               aSaca = nVoy + "01";
               aSaca = "-" + aSaca;
               aLetra = aValor % aSaca;
               |SI aLetra ] "0"; |Y aLetra [ "9";
                    |SI nSalto = 0;
                         aAnyo = aLetra + aAnyo;
                    |SINO;
                         |SI nSwMesLetra = 0;
                              |SI nSalto = 1;
                                   aMes = aLetra + aMes
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |SINO;
                    nSalto = nSalto + 1;
                    |SI nSalto > 1;
                         |SAL;
                    |FINSI;
               |FINSI;
          |SIGUE;

          ||Por ultimo saco el dia.
          nSalto = 0;
          aLong = aVerifica % A0;
          nLong = aLong;
          |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
               aSaca = nVoy + "01";
               aLetra = aValor % aSaca;
               |SI aLetra ] "0"; |Y aLetra [ "9";
                    |SI nSalto = 0;
                         aDia = aDia + aLetra;
                    |SINO;
                         |SAL;
                    |FINSI;
               |SINO;
                    nSalto = nSalto + 1;
                    |SI nSalto > 1;
                         |SAL;
                    |FINSI;
               |FINSI;
          |SIGUE;

          |SI aDia = ""; |O aMes = ""; |O aAnyo = "";
               nSwHayIncidencia = 1;
               enCodIncidencia = 3;
               eaIncidencia = "Fecha no valida [" + #dsarm036#1;
               |QBF eaIncidencia;
               eaIncidencia = eaIncidencia + "] :" + aValor;
               #dsarm035#5 = 2;
               #dsarm035#7 = enCodIncidencia;
               #dsarm035#6 = eaIncidencia;
               #dsarm035#8 = "255,0,0;255,255,255";
               |GRABA 020#dsarm035.a;
               |SI enSwAvisaInte = 1;
                    |LIBERA #dsarm035;
                    |ACABA;
               |FINSI;
          |SINO;
               nDia = aDia;
               nMes = aMes;
               nAnyo = aAnyo;
               |SI nAnyo < 99;
                    nAnyo = nAnyo + 2000;
               |FINSI;
               |SI nDia = 0; |O nMes = 0; |O aAnyo = 0;
                    nSwHayIncidencia = 1;
                    enCodIncidencia = 3;
                    eaIncidencia = "Fecha no valida [" + #dsarm036#1;
                    |QBF eaIncidencia;
                    eaIncidencia = eaIncidencia + "] :" + aValor;
                    #dsarm035#5 = 2;
                    #dsarm035#7 = enCodIncidencia;
                    #dsarm035#6 = eaIncidencia;
                    #dsarm035#8 = "255,0,0;255,255,255";
                    |GRABA 020#dsarm035.a;
                    |SI enSwAvisaInte = 1;
                         |LIBERA #dsarm035;
                         |ACABA;
                    |FINSI;
               |SINO;
                    ||Lo trasformo a este formato Dia.Mes.Ao. y verifico que es una fecha valida

                    aDia = ("00" + nDia) % -102;
                    aMes = ("00" + nMes) % -102;
                    aAnyo = ("0000" + nAnyo) % -104;

                    aFecha = aDia + "." + aMes + "." + aAnyo;
                    fFecha = aFecha;

                    nFecha = fFecha;
                    fFechaDespues = nFecha;
                    |SI fFecha ! fFechaDespues;
                         nSwHayIncidencia = 1;
                         enCodIncidencia = 3;
                         eaIncidencia = "Fecha no valida [" + #dsarm036#1;
                         |QBF eaIncidencia;
                         eaIncidencia = eaIncidencia + "] :" + aValor;
                         #dsarm035#5 = 2;
                         #dsarm035#7 = enCodIncidencia;
                         #dsarm035#6 = eaIncidencia;
                         #dsarm035#8 = "255,0,0;255,255,255";
                         |GRABA 020#dsarm035.a;
                         |SI enSwAvisaInte = 1;
                              |LIBERA #dsarm035;
                              |ACABA;
                         |FINSI;
                    |SINO;
                         aIdentificador = #dsarm036#8;
                         |QBF aIdentificador;
                         |SI aIdentificador = "fecha";
                              fFechaFac = fFecha;

                              aFecha = fFecha;
                              |QBF aFecha;
                              |SI aFecha ! aValor;
                                   #dsarm035#4 = fFecha;
                                   #dsarm035#5 = 3;
                                   #dsarm035#7 = 0;
                                   #dsarm035#6 = "";
                                   #dsarm035#8 = "0,158,0;255,255,255";
                                   |GRABA 020#dsarm035.a;
                                   |LIBERA #dsarm035;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     ||4. CONTROL NIF/CIF

     |SI #dsarm036#5 = "S";
         aAlfa = #dsarm036#1;  |QBF aAlfa;
         |SI aAlfa = "FE000000_clinif";
             |HAZ BuscaVentaContado;
             |SI nVentaContado = 1;
                 |ACABA;
             |FINSI;
         |FINSI;

          aValorEntrada = #dsarm035#4;
          |QBF aValorEntrada;
          aValor = #dsarm035#4;
          |QBF aValor;
          aVerifica = aValor;

          |HAZ QuitaGuionesyDemasNIF;
          aValor = aVerifica;
          |QBF aValor;

          aVerifica = aValor;
          |HAZ Pilla9Digitos;
          aValor = aVerifica;

          enModoSilencio = 1;
          enHayErrorDni = 0;
          eaVarDni = aValor;
          enCalcCif = 0;
          |HAZ CalculoDNI;
          |QBF eaVarDni;
          |SI eaVarDni ! aValor; |O enHayErrorDni = 1;
               aVerifica = aValor;
               |HAZ ControlDigitosNIF;
               aValor = aVerifica;
               |QBF aValor;
          |FINSI;

          |SI aValorEntrada ! aValor;
               #dsarm035#4 = aValor;
               |GRABA 020#dsarm035.a;
               |LIBERA #dsarm035;
          |FINSI;

          ||TODO CCC. ESTE CONTROL NO LO HACEMOS
          ||NO ES NECESARIO, SOLO DA COMO VALIDAS LOS NIF INTRACOMUNITARIOS
          ||QUE ESTEN DADOS DE ALTA EN LA INTEGRAL o LA BASICA
          enModoSilencio = 1;
          enHayErrorDni = 0;
          eaVarDni = aValor;
          enCalcCif = 0;
          |HAZ CalculoDNI;
          |QBF eaVarDni;
          |SI eaVarDni ! aValor; |O enHayErrorDni = 1;  |O eaVarDni = "";
              nSwHayIncidencia = 1;
              enCodIncidencia = 4;
              eaIncidencia = "NIF/CIF incorrecto [" + #dsarm036#1;
              |QBF eaIncidencia;
              eaIncidencia = eaIncidencia + "] :" + aValor;
              #dsarm035#5 = 2;
              #dsarm035#7 = enCodIncidencia;
              #dsarm035#6 = eaIncidencia;
              #dsarm035#8 = "255,0,0;255,255,255";
              |GRABA 020#dsarm035.a;
              |SI enSwAvisaInte = 1;
                  |LIBERA #dsarm035;
                  |ACABA;
              |FINSI;
           |FINSI;
           enModoSilencio = 0;
     |FINSI;

     ||5. CIF PARA OBTENER EMPRESA CONTAGEN
     |SI #dsarm036#6 = "S";
          aValor = #dsarm035#4;
          |QBT aValor;

          aVerifica = aValor;
          |HAZ QuitaGuionesyDemasNIF;
          aValor = aVerifica;
          |QBF aValor;

          aVerifica = aValor;
          |HAZ Pilla9Digitos;
          aValor = aVerifica;

          enModoSilencio = 1;
          enHayErrorDni = 0;
          eaVarDni = aValor;
          enCalcCif = 0;
          |HAZ CalculoDNI;
          |QBF eaVarDni;
          |SI eaVarDni ! aValor; |O enHayErrorDni = 1;
               aVerifica = aValor;
               |HAZ ControlDigitosNIF;
               aValor = aVerifica;
               |QBF aValor;
          |FINSI;

          aCifContagen = aValor;
          |QBF aCifContagen;

          |SI fFechaFac = "01.01.0000";
               nSwHayIncidencia = 1;
               enCodIncidencia = 5;
               eaIncidencia = "No existe emp. contagen [" + #dsarm036#1;
               |QBF eaIncidencia;
               eaIncidencia = eaIncidencia + "] : <sin fecha factura>" ;
               #dsarm035#5 = 2;
               #dsarm035#7 = enCodIncidencia;
               #dsarm035#6 = eaIncidencia;
               #dsarm035#8 = "255,0,0;255,255,255";
               |GRABA 020#dsarm035.a;

               |SI enSwAvisaInte = 1;
                    |LIBERA #dsarm035;
                    |ACABA;
               |FINSI;
          |SINO;
               |DBASS aBase;
               |QBF aBase;

               aDirConta = aBase + "contagen/";
               aDirDatos = aDirConta + "fich/";

               aDef = aDirConta + "def/canempre";
               |CARGA_DEF aDef, referen@;
               |SI FSalida ! 0;
                    nSwHayIncidencia = 1;
                    enCodIncidencia = 5;
                    eaIncidencia = "[canempre] inaccesible. Contabilidad Contagen no instalada";
                    #dsarm035#5 = 2;
                    #dsarm035#7 = enCodIncidencia;
                    #dsarm035#6 = eaIncidencia;
                    #dsarm035#8 = "255,0,0;255,255,255";
                    |GRABA 020#dsarm035.a;

                    |SI enSwAvisaInte = 1;
                         |LIBERA #dsarm035;
                         |ACABA;
                    |FINSI;
               |FINSI;

               |PATH_DAT #1000 aDirDatos;

               |HAZ BuscaEmpPerConta;
               |SI nSwEstaConta = 0;
                    nSwHayIncidencia = 1;
                    enCodIncidencia = 5;
                    eaIncidencia = "No existe emp. contagen [" + #dsarm036#1;
                    |QBF eaIncidencia;
                    eaIncidencia = eaIncidencia + "] : Cif: " + aValor;
                    #dsarm035#5 = 2;
                    #dsarm035#7 = enCodIncidencia;
                    #dsarm035#6 = eaIncidencia;
                    #dsarm035#8 = "255,0,0;255,255,255";
                    |GRABA 020#dsarm035.a;
                    |SI enSwAvisaInte = 1;
                         |LIBERA #dsarm035;
                         |ACABA;
                    |FINSI;
               |SINO;
                    |HAZ ActEmpContagen;
               |FINSI;

               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;

     ||6. CUADRE IMPORTES
     |SI #dsarm036#7 = "S";
          |SI nErrorCuadres = 1;
               nSwHayIncidencia = 1;
               enCodIncidencia = 6;
               ||Habria que identificar el error exactamente a que tipo de variable corresponde.
               ||por ahora, lo voy a dejar a todos, como revisar importes.
               ||eaIncidencia = "Importes incorrectos: " + aErrorCuadre;
               eaIncidencia = "Revisar Importes";
               #dsarm035#5 = 2;
               #dsarm035#7 = enCodIncidencia;
               #dsarm035#6 = eaIncidencia;
               #dsarm035#8 = "255,0,0;255,255,255";
               |GRABA 020#dsarm035.a;
               |SI enSwAvisaInte = 1;
                    |LIBERA #dsarm035;
                    |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     aAlfa1 = aProcesoPI + "_actividad";
     aAlfa = #dsarm036#1;  |QBF aAlfa;
     |SI aAlfa = aAlfa1;
         aAlfa = #dsarm035#4;  |QBF aAlfa;
         |SI aAlfa = "0";
             nSwHayIncidencia = 1;
             enCodIncidencia  = 2;
             eaIncidencia = "Actividad = 0";
             #dsarm035#5 = 2;
             #dsarm035#7 = 2;
             #dsarm035#6 = "Actividad = 0";
             #dsarm035#8 = "255,0,0;255,255,255";
             |GRABA 020#dsarm035.a;
             |LIBERA #dsarm035;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI enCodIncidencia = 0;
          |SI #dsarm035#5 ! 3;     ||Solo si distinto de <3> Corregido
               #dsarm035#5 = 1;
               #dsarm035#8 = "0,0,0;0,0,0";
          |FINSI;
          #dsarm035#7 = enCodIncidencia;
          #dsarm035#6 = "";
          |GRABA 020#dsarm035.a;
          |LIBERA #dsarm035;
     |SINO;
          |SI enCodPrimeraInc = 0;
               enCodPrimeraInc = enCodIncidencia;
               eaPrimeraInc = eaIncidencia;
          |FINSI;
          nSwHayIncidencia = 1;
          enCodIncidencia = 0;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm035;
 #dsarm035#1;
 ;
 efFechaInte, eaHoraInte, eaFicInte, aVacio25;
 efFechaInte, eaHoraInte, eaFicInte, aZeta25;
 be;
 NULL, dsarm035;
|FIN;

|PROCESO dsarm035_limpiaPLB;
     ||Primero que nada, Limpio y arreglo las variables.
     ||Tratamiento de fechas
     ||Tratamiento de CIF's
     ||Tratamiento de Numericos .... etc.

     aValor = #dsarm035#4;
     |QBF aValor;
     |SI aValor = "";
||          |ACABA;
     |FINSI;

     |DDEFECTO #dsarm036;
     #dsarm036#0 = aProcesoPI;
     #dsarm036#1 = #dsarm035#3;
     |LEE 000#dsarm036.=;
     |SI FSalida = 0;
          ||2. TIPO VARIABLE

          aTipoVar = #dsarm036#3;
          |QBF aTipoVar;
          |SI aTipoVar = ""; |O aTipoVar = "A"; |O aTipoVar = "F";
               ||Nada, todo correcto.
               ||Si esta vacio, es pq. no tengo que verificar nada
               ||Si es alfanumerico, cualquier valor sera correcto
               ||Si es fecha, ya tengo un contro especifico para fechas validas
          |SINO;
               ||Es numerico, verifico que realmente es un numero.

               aValorEntrada = #dsarm035#4;
               |QBF aValorEntrada;
               aValor = #dsarm035#4;
               |QBF aValor;
               aVerifica = aValor
               |HAZ LimpiaNumerico;
               aValor = aVerifica;

               |SI aValor ! aValorEntrada;
                    #dsarm035#4 = aValor;
                    |GRABA 020#dsarm035.a;
                    |LIBERA #dsarm035;
               |FINSI;
          |FINSI;

          ||3. FECHA VALIDA
          |SI #dsarm036#4 = "S";
               aValorEntrada = #dsarm035#4;
               |QBF aValorEntrada;
               aValor = #dsarm035#4;

               ||Primero quito los espacios en blanco por el inicio y por el final

               |QBF aValor;
               aVerifica = aValor;
               |HAZ QBI;
               aValor = aVerifica;

               aDia = "";
               aMes = "";
               aAnyo = "";

               aValorMin = aValor < aValor;  ||Lo paso a minusculas

               nSwMesLetra = 0;
               ||Luego verifico si el mes esta en letra
               aAntes = aValorMin;
               aDespues = aValorMin - "ene";
               |SI aAntes ! aDespues;
                    aMes = "01";
                    nSwMesLetra = 1;
               |FINSI;
               aDespues = aValorMin - "feb";
               |SI aAntes ! aDespues;
                    aMes = "02";
                    nSwMesLetra = 1;
               |FINSI;
               aDespues = aValorMin - "mar";
               |SI aAntes ! aDespues;
                    aMes = "03";
                    nSwMesLetra = 1;
               |FINSI;
               aDespues = aValorMin - "abr";
               |SI aAntes ! aDespues;
                    aMes = "04";
                    nSwMesLetra = 1;
               |FINSI;
               aDespues = aValorMin - "may";
               |SI aAntes ! aDespues;
                    aMes = "05";
                    nSwMesLetra = 1;
               |FINSI;
               aDespues = aValorMin - "jun";
               |SI aAntes ! aDespues;
                    aMes = "06";
                    nSwMesLetra = 1;
               |FINSI;
               aDespues = aValorMin - "jul";
               |SI aAntes ! aDespues;
                    aMes = "07";
                    nSwMesLetra = 1;
               |FINSI;
               aDespues = aValorMin - "ago";
               |SI aAntes ! aDespues;
                    aMes = "08";
                    nSwMesLetra = 1;
               |FINSI;
               aDespues = aValorMin - "sep";
               |SI aAntes ! aDespues;
                    aMes = "09";
                    nSwMesLetra = 1;
               |FINSI;
               aDespues = aValorMin - "oct";
               |SI aAntes ! aDespues;
                    aMes = "10";
                    nSwMesLetra = 1;
               |FINSI;
               aDespues = aValorMin - "nov";
               |SI aAntes ! aDespues;
                    aMes = "11";
                    nSwMesLetra = 1;
               |FINSI;
               aDespues = aValorMin - "dic";
               |SI aAntes ! aDespues;
                    aMes = "12";
                    nSwMesLetra = 1;
               |FINSI;
               ||Si lo esta .. proceso MesLetra

               ||Ahora saco el Anyo y el Mes si aun no lo tengo.

               nSalto = 0;
               aLong = aVerifica % A0;
               nLong = aLong;
               |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
                    aSaca = nVoy + "01";
                    aSaca = "-" + aSaca;
                    aLetra = aValor % aSaca;
                    |SI aLetra ] "0"; |Y aLetra [ "9";
                         |SI nSalto = 0;
                              aAnyo = aLetra + aAnyo;
                         |SINO;
                              |SI nSwMesLetra = 0;
                                   |SI nSalto = 1;
                                        aMes = aLetra + aMes
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |SINO;
                         nSalto = nSalto + 1;
                         |SI nSalto > 1;
                              |SAL;
                         |FINSI;
                    |FINSI;
               |SIGUE;

               ||Por ultimo saco el dia.
               nSalto = 0;
               aLong = aVerifica % A0;
               nLong = aLong;
               |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
                    aSaca = nVoy + "01";
                    aLetra = aValor % aSaca;
                    |SI aLetra ] "0"; |Y aLetra [ "9";
                         |SI nSalto = 0;
                              aDia = aDia + aLetra;
                         |SINO;
                              |SAL;
                         |FINSI;
                    |SINO;
                         nSalto = nSalto + 1;
                         |SI nSalto > 1;
                              |SAL;
                         |FINSI;
                    |FINSI;
               |SIGUE;

               |SI aDia = ""; |O aMes = ""; |O aAnyo = "";
                    ||NADA
               |SINO;
                    nDia = aDia;
                    nMes = aMes;
                    nAnyo = aAnyo;
                    |SI nAnyo < 99;
                         nAnyo = nAnyo + 2000;
                    |FINSI;
                    |SI nDia = 0; |O nMes = 0; |O aAnyo = 0;
                         ||NADA
                    |SINO;
                         ||Lo trasformo a este formato Dia.Mes.Ao. y verifico que es una fecha valida

                         aDia = ("00" + nDia) % -102;
                         aMes = ("00" + nMes) % -102;
                         aAnyo = ("0000" + nAnyo) % -104;

                         aFecha = aDia + "." + aMes + "." + aAnyo;
                         fFecha = aFecha;

                         nFecha = fFecha;
                         fFechaDespues = nFecha;
                         |SI fFecha ! fFechaDespues;
                              ||NADA
                         |SINO;
                              |SI aValor ! aValorEntrada;
                                   #dsarm035#4 = aValor;
                                   |GRABA 020#dsarm035.a;
                                   |LIBERA #dsarm035;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;

          ||4. CONTROL NIF/CIF
          |SI #dsarm036#5 = "S";
               aValorEntrada = #dsarm035#4;
               |QBF aValorEntrada;
               aValor = #dsarm035#4;
               |QBF aValor;
               aVerifica = aValor;

               ||Esto no nos sirve, hay muchos que vienen "76775180 F"
               ||HAZ PorDetrasHastaEspacio;
               ||aValor = aVerifica;

               aVerifica = aValor;
               |HAZ QuitaGuionesyDemasNIF;
               aValor = aVerifica;
               |QBF aValor;

               aVerifica = aValor;
               |HAZ Pilla9Digitos;
               aValor = aVerifica;

               enModoSilencio = 1;
               enHayErrorDni = 0;
               eaVarDni = aValor;
               enCalcCif = 0;
               |HAZ CalculoDNI;
               |QBF eaVarDni;
               |SI eaVarDni ! aValor; |O enHayErrorDni = 1;
                    aVerifica = aValor;
                    |HAZ ControlDigitosNIF;
                    aValor = aVerifica;
                    |QBF aValor;
               |FINSI;

               |SI aValorEntrada ! aValor;
                    #dsarm035#4 = aValor;
                    |GRABA 020#dsarm035.a;
                    |LIBERA #dsarm035;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm035_limpiaPLB;
 #dsarm035#1;
 ;
 efFechaInte, eaHoraInte, eaFicInte, aVacio25;
 efFechaInte, eaHoraInte, eaFicInte, aZeta25;
 be;
 NULL, dsarm035_limpiaPLB;
|FIN;



|PROCESO dsarm035_varcuadres;
     |DDEFECTO #dsarm036;
     #dsarm036#0 = aProcesoPI;
     #dsarm036#1 = #dsarm035#3;
     |LEE 000#dsarm036.=;
     |SI FSalida = 0;
          aIdentificador = #dsarm036#8;
          |QBF aIdentificador;
          |SI aIdentificador ! "";
               aValor = #dsarm035#4;
               |QBT aValor;
               |HAZ MeteIdentificador;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm035_varcuadres;
 #dsarm035#1;
 ;
 efFechaInte, eaHoraInte, eaFicInte, aVacio25;
 efFechaInte, eaHoraInte, eaFicInte, aZeta25;
 be;
 NULL, dsarm035_varcuadres;
|FIN;

|DEFBUCLE dsarm035_fecha;
 #dsarm035#1;
 ;
 efFechaInte, eaHoraInte, eaFicInte, aVarFecha;
 efFechaInte, eaHoraInte, eaFicInte, aVarFecha;
 be;
 NULL, dsarm035_fecha;
|FIN;

|PROCESO AceraIdentificador;
     fFechaFac = "01.01.0000";
     nBase1Fac = 0;
     nBase2Fac = 0;
     nBase3Fac = 0;
     nBase4Fac = 0;
     nBase5Fac = 0;
     nCuotaIva1Fac = 0;
     nCuotaIva2Fac = 0;
     nCuotaIva3Fac = 0;
     nCuotaIva4Fac = 0;
     nCuotaIva5Fac = 0;
     nCuotaRe1Fac = 0;
     nCuotaRe2Fac = 0;
     nCuotaRe3Fac = 0;
     nCuotaRe4Fac = 0;
     nCuotaRe5Fac = 0;
     nCuotaReten1Fac = 0;
     nCuotaReten2Fac = 0;
     nCuotaReten3Fac = 0;
     nCuotaReten4Fac = 0;
     nCuotaReten5Fac = 0;
     nIva1Fac = 0;
     nIva2Fac = 0;
     nIva3Fac = 0;
     nIva4Fac = 0;
     nIva5Fac = 0;
     nRe1Fac = 0;
     nRe2Fac = 0;
     nRe3Fac = 0;
     nRe4Fac = 0;
     nRe5Fac = 0;
     nReten1Fac = 0;
     nReten2Fac = 0;
     nReten3Fac = 0;
     nReten4Fac = 0;
     nReten5Fac = 0;
     nTotalFac = 0;
     nActividad = 0;
     aReten1BF = "B";
     aReten2BF = "B";
     aReten3BF = "B";
     aReten4BF = "B";
     aReten5BF = "B";
|FPRC;

|PROCESO MeteIvaenLineal;
     |DDEFECTO #dsarm036;
     |SELECT #2#dsarm036;
     #dsarm036#0 = aProcesoPI;
     |SI nNumIva = 1;  #dsarm036#8 = "iva1";    |FINSI;
     |SI nNumIva = 2;  #dsarm036#8 = "iva2";    |FINSI;
     |SI nNumIva = 3;  #dsarm036#8 = "iva3";    |FINSI;
     |SI nNumIva = 4;  #dsarm036#8 = "re1";     |FINSI;
     |SI nNumIva = 5;  #dsarm036#8 = "re2";     |FINSI;
     |SI nNumIva = 6;  #dsarm036#8 = "re3";     |FINSI;
     |SI nNumIva = 7;  #dsarm036#8 = "reten1";  |FINSI;
     |SI nNumIva = 8;  #dsarm036#8 = "reten2";  |FINSI;
     |SI nNumIva = 9;  #dsarm036#8 = "reten3";  |FINSI;
     |SI nNumIva = 10;  #dsarm036#8 = "iva4";    |FINSI;
     |SI nNumIva = 11;  #dsarm036#8 = "iva5";    |FINSI;
     |SI nNumIva = 12;  #dsarm036#8 = "re4";     |FINSI;
     |SI nNumIva = 13;  #dsarm036#8 = "re5";     |FINSI;
     |SI nNumIva = 14;  #dsarm036#8 = "reten4";  |FINSI;
     |SI nNumIva = 15;  #dsarm036#8 = "reten5";  |FINSI;
     |LEE 000#dsarm036.=;
     |SI FSalida = 0;
          |ABRE #dsarm035;
          |DDEFECTO #dsarm035;
          #dsarm035#0 = efFechaInte;
          #dsarm035#1 = eaHoraInte;
          #dsarm035#2 = eaFicInte;
          #dsarm035#3 = #dsarm036#1;
          |LEE 101#dsarm035.=;
          |SI FSalida = 0;
               |SI nNumIva = 1;  #dsarm035#4 = nIva1Fac;    |FINSI;
               |SI nNumIva = 2;  #dsarm035#4 = nIva2Fac;    |FINSI;
               |SI nNumIva = 3;  #dsarm035#4 = nIva3Fac;    |FINSI;
               |SI nNumIva = 4;  #dsarm035#4 = nRe1Fac;     |FINSI;
               |SI nNumIva = 5;  #dsarm035#4 = nRe2Fac;     |FINSI;
               |SI nNumIva = 6;  #dsarm035#4 = nRe3Fac;     |FINSI;
               |SI nNumIva = 7;  #dsarm035#4 = nReten1Fac;  |FINSI;
               |SI nNumIva = 8;  #dsarm035#4 = nReten2Fac;  |FINSI;
               |SI nNumIva = 9;  #dsarm035#4 = nReten3Fac;  |FINSI;
               |SI nNumIva = 10;  #dsarm035#4 = nIva4Fac;    |FINSI;
               |SI nNumIva = 11;  #dsarm035#4 = nIva5Fac;    |FINSI;
               |SI nNumIva = 12;  #dsarm035#4 = nRe4Fac;     |FINSI;
               |SI nNumIva = 13;  #dsarm035#4 = nRe5Fac;     |FINSI;
               |SI nNumIva = 14;  #dsarm035#4 = nReten4Fac;  |FINSI;
               |SI nNumIva = 15;  #dsarm035#4 = nReten5Fac;  |FINSI;

               #dsarm035#5 = 3;
               #dsarm035#6 = "";
               #dsarm035#7 = 0;
               #dsarm035#8 = "0,158,0;255,255,255";
               #dsarm035#9 = "*SIN CAMBIOS*";
               |GRABA 020#dsarm035.a;
               |LIBERA #dsarm035;
               |SI enCodIncidencia = 1;
                    eaIncidencia = "";
                    nSwHayIncidencia = 0;
                    enCodIncidencia = 0;
               |FINSI;
          |FINSI;
          |CIERRA #dsarm035;
     |FINSI;
     |SELECT #2#dsarm036;
|FPRC;

|PROCESO ControlRedondeo;
     ||aControlRedondeo

     aVarAux = aControlRedondeo;
     |QBF aVarAux;
     aVarAux = aVarAux % -103;
     |SI aVarAux = ".99"; |O aVarAux = ".01"; |O aVarAux = ".49"; |O aVarAux = ".51";
          nNumeroAux = aControlRedondeo;
          |SI aVarAux = ".99"; |O aVarAux = ".49";
               nNumeroAux = nNumeroAux + 0.01;
               aControlRedondeo = nNumeroAux;
          |SINO;
               nNumeroAux = nNumeroAux - 0.01;
               aControlRedondeo = nNumeroAux;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO RevisaCuadres;
     nTopeError = 0.03;

     |SI nCuotaIva1Fac   = 0;  nIva1Fac   = 0;  nNumIva = 1;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaIva2Fac   = 0;  nIva2Fac   = 0;  nNumIva = 2;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaIva3Fac   = 0;  nIva3Fac   = 0;  nNumIva = 3;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaRe1Fac    = 0;  nRe1Fac    = 0;  nNumIva = 4;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaRe2Fac    = 0;  nRe2Fac    = 0;  nNumIva = 5;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaRe3Fac    = 0;  nRe3Fac    = 0;  nNumIva = 6;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaReten1Fac = 0;  nReten1Fac = 0;  nNumIva = 7;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaReten2Fac = 0;  nReten2Fac = 0;  nNumIva = 8;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaReten3Fac = 0;  nReten3Fac = 0;  nNumIva = 9;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaIva4Fac   = 0;  nIva4Fac   = 0;  nNumIva = 10;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaIva5Fac   = 0;  nIva5Fac   = 0;  nNumIva = 11;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaRe4Fac    = 0;  nRe4Fac    = 0;  nNumIva = 12;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaRe5Fac    = 0;  nRe5Fac    = 0;  nNumIva = 13;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaReten4Fac = 0;  nReten4Fac = 0;  nNumIva = 14;  |HAZ MeteIvaenLineal;  |FINSI;
     |SI nCuotaReten5Fac = 0;  nReten5Fac = 0;  nNumIva = 15;  |HAZ MeteIvaenLineal;  |FINSI;

     |SI nIva1Fac ! 0;
          nBase1Fac     = nBase1Fac ! 2;
          nIva1Fac      = nIva1Fac  ! 2;
          nCuotaIva1Fac = nCuotaIva1Fac ! 2;

          nCuotaIva1Cal = (nBase1Fac % nIva1Fac) ! 2;

          nResto = (nCuotaIva1Fac - nCuotaIva1Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "IVA 1";
               nErrorCuadres = 1;
               |ACABA;
          |FINSI;
     |SINO;
          |SI nCuotaIva1Fac ! 0; |Y nBase1Fac ! 0;
               nIva1Fac = ((nCuotaIva1Fac * 100) / nBase1Fac) ! 2;

               aControlRedondeo = nIva1Fac;
               |HAZ ControlRedondeo;
               nIva1Fac = aControlRedondeo;

               nNumIva = 1;  |HAZ MeteIvaenLineal;
          |FINSI;
     |FINSI;

     |SI nIva2Fac ! 0;
          nCuotaIva2Cal = (nBase2Fac % nIva2Fac) ! 2;

          nResto = (nCuotaIva2Fac - nCuotaIva2Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "IVA 2";
               nErrorCuadres = 1;
               |ACABA;
          |FINSI;
     |SINO;
          |SI nCuotaIva2Fac ! 0; |Y nBase2Fac ! 0;
               nIva2Fac = ((nCuotaIva2Fac * 100) / nBase2Fac) ! 2;

               aControlRedondeo = nIva2Fac;
               |HAZ ControlRedondeo;
               nIva2Fac = aControlRedondeo;

               nNumIva = 2;
               |HAZ MeteIvaenLineal;
          |FINSI;
     |FINSI;

     |SI nIva3Fac ! 0;
          nCuotaIva3Cal = (nBase3Fac % nIva3Fac) ! 2;

          nResto = (nCuotaIva3Fac - nCuotaIva3Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "IVA 3";
               nErrorCuadres = 1;
               |ACABA;
          |SINO;
               |SI nCuotaIva3Fac ! 0; |Y nBase3Fac ! 0;
                    nIva3Fac = ((nCuotaIva3Fac * 100) / nBase3Fac) ! 2;

                    aControlRedondeo = nIva3Fac;
                    |HAZ ControlRedondeo;
                    nIva3Fac = aControlRedondeo;

                    nNumIva = 3;
                    |HAZ MeteIvaenLineal;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nIva4Fac ! 0;
          nCuotaIva4Cal = (nBase4Fac % nIva4Fac) ! 2;

          nResto = (nCuotaIva4Fac - nCuotaIva4Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "IVA 4";
               nErrorCuadres = 1;
               |ACABA;
          |SINO;
               |SI nCuotaIva4Fac ! 0; |Y nBase4Fac ! 0;
                    nIva4Fac = ((nCuotaIva4Fac * 100) / nBase4Fac) ! 2;
                    aControlRedondeo = nIva4Fac;
                    |HAZ ControlRedondeo;
                    nIva4Fac = aControlRedondeo;
                    nNumIva = 10;
                    |HAZ MeteIvaenLineal;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nIva5Fac ! 0;
          nCuotaIva5Cal = (nBase5Fac % nIva5Fac) ! 2;

          nResto = (nCuotaIva5Fac - nCuotaIva5Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "IVA 5";
               nErrorCuadres = 1;
               |ACABA;
          |SINO;
               |SI nCuotaIva5Fac ! 0; |Y nBase5Fac ! 0;
                    nIva5Fac = ((nCuotaIva5Fac * 100) / nBase5Fac) ! 2;
                    aControlRedondeo = nIva5Fac;
                    |HAZ ControlRedondeo;
                    nIva5Fac = aControlRedondeo;

                    nNumIva = 11;
                    |HAZ MeteIvaenLineal;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nRe1Fac ! 0;
          nCuotaRe1Cal = (nBase1Fac % nRe1Fac) ! 2;

          nResto = (nCuotaRe1Fac - nCuotaRe1Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "RECARGO 1";
               nErrorCuadres = 1;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI nRe2Fac ! 0;
          nCuotaRe2Cal = (nBase2Fac % nRe2Fac) ! 2;

          nResto = (nCuotaRe2Fac - nCuotaRe2Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "RECARGO 2";
               nErrorCuadres = 1;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI nRe3Fac ! 0;
          nCuotaRe3Cal = (nBase3Fac % nRe3Fac) ! 2;

          nResto = (nCuotaRe3Fac - nCuotaRe3Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "RECARGO 3";
               nErrorCuadres = 1;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI nRe4Fac ! 0;
          nCuotaRe4Cal = (nBase4Fac % nRe4Fac) ! 2;

          nResto = (nCuotaRe4Fac - nCuotaRe4Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "RECARGO 4";
               nErrorCuadres = 1;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI nRe5Fac ! 0;
          nCuotaRe5Cal = (nBase5Fac % nRe5Fac) ! 2;

          nResto = (nCuotaRe5Fac - nCuotaRe5Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "RECARGO 5";
               nErrorCuadres = 1;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI nReten1Fac ! 0;
          ||ARA3939
          |QBF aReten1BF;
          |SI aReten1BF = ""; |O aReten1BF = "B";
               nCuotaReten1Cal = (nBase1Fac % nReten1Fac) ! 2;
          |SINO;
               nAuxSuma = nBase1Fac + nCuotaIva1Fac + nCuotaRe1Fac;
               nCuotaReten1Cal = (nAuxSuma % nReten1Fac) ! 2;
          |FINSI;

          nResto = (nCuotaReten1Fac - nCuotaReten1Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "RETENCION 1";
               nErrorCuadres = 1;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI nReten2Fac ! 0;
          |QBF aReten2BF;
          |SI aReten2BF = ""; |O aReten2BF = "B";
               nCuotaReten2Cal = (nBase2Fac % nReten2Fac) ! 2;
          |SINO;
               nAuxSuma = nBase2Fac + nCuotaIva2Fac + nCuotaRe2Fac;
               nCuotaReten2Cal = (nAuxSuma % nReten2Fac) ! 2;
          |FINSI;

          nResto = (nCuotaReten2Fac - nCuotaReten2Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "RETENCION 2";
               nErrorCuadres = 1;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI nReten3Fac ! 0;
          |QBF aReten3BF;
          |SI aReten3BF = ""; |O aReten3BF = "B";
               nCuotaReten3Cal = (nBase3Fac % nReten3Fac) ! 2;
          |SINO;
               nAuxSuma = nBase3Fac + nCuotaIva3Fac + nCuotaRe3Fac;
               nCuotaReten3Cal = (nAuxSuma % nReten3Fac) ! 2;
          |FINSI;

          nResto = (nCuotaReten3Fac - nCuotaReten3Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "RETENCION 3";
               nErrorCuadres = 1;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI nReten4Fac ! 0;
          |QBF aReten4BF;
          |SI aReten4BF = ""; |O aReten4BF = "B";
               nCuotaReten4Cal = (nBase4Fac % nReten4Fac) ! 2;
          |SINO;
               nAuxSuma = nBase4Fac + nCuotaIva4Fac + nCuotaRe4Fac;
               nCuotaReten4Cal = (nAuxSuma % nReten4Fac) ! 2;
          |FINSI;

          nResto = (nCuotaReten4Fac - nCuotaReten4Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "RETENCION 4";
               nErrorCuadres = 1;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI nReten5Fac ! 0;
          |QBF aReten5BF;
          |SI aReten5BF = ""; |O aReten5BF = "B";
               nCuotaReten5Cal = (nBase5Fac % nReten5Fac) ! 2;
          |SINO;
               nAuxSuma = nBase5Fac + nCuotaIva5Fac + nCuotaRe5Fac;
               nCuotaReten5Cal = (nAuxSuma % nReten5Fac) ! 2;
          |FINSI;

          nResto = (nCuotaReten5Fac - nCuotaReten5Cal) ! 2;
          |SI nResto < 0;  nResto = -nResto;  |FINSI;

          |SI nResto > nTopeError;
               aErrorCuadre = "RETENCION 5";
               nErrorCuadres = 1;
               |ACABA;
          |FINSI;
     |FINSI;

     nTotalCal = nBase1Fac + nCuotaIva1Fac + nCuotaRe1Fac - nCuotaReten1Fac;
     nTotalCal = nTotalCal + nBase2Fac + nCuotaIva2Fac + nCuotaRe2Fac - nCuotaReten2Fac;
     nTotalCal = nTotalCal + nBase3Fac + nCuotaIva3Fac + nCuotaRe3Fac - nCuotaReten3Fac;
     nTotalCal = nTotalCal + nBase4Fac + nCuotaIva4Fac + nCuotaRe4Fac - nCuotaReten4Fac;
     nTotalCal = nTotalCal + nBase5Fac + nCuotaIva5Fac + nCuotaRe5Fac - nCuotaReten5Fac;
     nTotalCal = nTotalCal ! 2;
     |SI nTotalCal ! nTotalFac;
          aErrorCuadre = "TOTAL FACTURA";
          nErrorCuadres = 1;
          |ACABA;
     |FINSI;

     |SI nTotalFac = 0;
          aErrorCuadre = "TOTAL FACTURA A CERO";
          nErrorCuadres = 1;
          |ACABA;
     |FINSI;
|FPRC;

|PROCESO DamePais;
     |ABRE #dsarm035;
     |DDEFECTO #dsarm035;
     #dsarm035#0 = efFechaInte;
     #dsarm035#1 = eaHoraInte;
     #dsarm035#2 = eaFicInte;
     #dsarm035#3 = aProcesoPI + "_pais";
     |LEE 000#dsarm035.=;
     |SI FSalida = 0;
         aPais = #dsarm035#4;  |QBF aPais;
     |FINSI;
     |CIERRA #dsarm035;
|FPRC;

|PROCESO IntegridaddsEscan;
     nErrorCuadres = 0;
     aErrorCuadre = "";
     nEmpContagen = 0;
     nPerContagen = 0;
     nSwEstaConta = 0;
     nSwHayIncidencia = 0;
     enCodIncidencia = 0;
     aProcesoPI = eaProcesoPIInte;
     |QBF aProcesoPI;

     |SI aProcesoPI = "";
          enCodIncidencia = 99;
          eaIncidencia = "Sin ProcesoPI";
          enResultadoInte = 0;
          |ACABA;
     |FINSI;

     aVacio25 = (" " * 25);
     aZeta25 = ("z" * 25);

     aPais = "ES";
     |HAZ DamePais;

     ||Primero que nada, Limpio y arreglo las variables.
     ||Tratamiento de fechas
     ||Tratamiento de CIF's
     ||Tratamiento de Numericos .... etc.
     |ABRE #dsarm036;
     |BUCLE dsarm035_limpiaPLB;
     |CIERRA #dsarm036;

     ||Antes que nada, meto en el lineal los obligatorios (NO VACIOS).
     ||Primero controlo los no vacios
     |ABRE #dsarm035;
     |BUCLE dsarm036_vacio;
     |CIERRA #dsarm035;

     ||Luego ya reviso el resto de integridades.
     |SI nSwHayIncidencia = 0; |O enSwAvisaInte = 0;

          |SI nSwHayIncidencia ! 0;
               |SI enCodPrimeraInc = 0;
                    enCodPrimeraInc = enCodIncidencia;
                    eaPrimeraInc = eaIncidencia;
               |FINSI;
          |FINSI;

          |HAZ AceraIdentificador;

          |ABRE #dsarm036;

          |BUCLE dsarm035_varcuadres;

          ||Si no existe % iva, lo crea.

          |HAZ RevisaCuadres;

          ||Primero que todo tengo que procesar, la fecha, pq. me hace falta
          ||para obtener la empresa+periodo de contagen.
          aVarFecha = "";
          |DDEFECTO #dsarm036;
          |SELECT #2#dsarm036;
          #dsarm036#0 = aProcesoPI;
          #dsarm036#8 = "fecha               ";
          |LEE 000#dsarm036.=;
          |SI FSalida = 0;
               aVarFecha = #dsarm036#1;
          |FINSI;
          |SELECT #1#dsarm036;

          |SI aVarFecha ! "";
               |BUCLE dsarm035_fecha;
          |FINSI;

          |BUCLE dsarm035;
          |CIERRA #dsarm036;
     |SINO;
          |SI enCodPrimeraInc = 0;
               enCodPrimeraInc = enCodIncidencia;
               eaPrimeraInc = eaIncidencia;
          |FINSI;
     |FINSI;

     |SI nSwHayIncidencia = 0;
          enResultadoInte = 1;     ||Integridad OKIE
     |SINO;
          enResultadoInte = 0;     ||Integridad con errores
     |FINSI;
     |HAZ ActEstadoIntegridad;
|FPRC;
