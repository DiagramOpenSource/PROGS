|FICHEROS;
     dsarw090,MANTE;
     dsarw091,MANTE;
     dsarw092,MANTE;
     dsarw113,MANTE;

     dsarm064;              ||Conf.Formato Correos
|FIN;

|VARIABLES;
     &enCorreoMultiEmp = 0;
     &enTipoCorreo = 0;
     &enSwSMTPCLI = 0;
     &enSwBLAT = 0;
     nBotonFoto = 0;
     {1}aContiene     = "";
     aDocRemoto = "";
     aDocServidor = "";
     aBase = "";
     aDirLocal = "";
     &eaUnidadBasico = "";
     aFotoOrigen = "";
     aFotoDestino = "";
     aExt = "";
     aFoto = "";
     aNombreLogo = "";
     nHandle = 0;
     aIPRemoto = "";
     aDirec = "";
     aAux = "";
     nAux = 0;
     nAdjunto = 0;
     aNombre = "";
     aLong = "";
     nLong = 0;
     aDirSaca = "";
     nConta = 0;
     aValor = "";
     aPath = "";
     &eaOrigen = "";
     &eaDestino = "";
     nBotonA1 = 0;
     nBotonA2 = 0;
     nBotonA3 = 0;
     nBotonA4 = 0;
     nBotonA5 = 0;
     nBotonA6 = 0;
     nBotonA7 = 0;
     nBotonA8 = 0;
     nBotonA9 = 0;
     nCampo = 0;
     &eaUnidad = "";
     aAdjunto = "";
     aBorra = "";

     nVentana = 0;
     nVent    = 0;
     nVentDos = 0;
     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     nPanta = 0;
     nBoton1 = 0;
     nBoton2 = 0;
     nBoton3 = 0;
     nRango = 0;
     nPos1 = 0;
     nPos2 = 0;
     nGrid = 0;
     aEsc1 = "";
     aEsc2 = "";
     aRetu = "";
     aTecla = "";
     nModo = 0;
     aMensaje = "";
     nIdSalir = 0;
     {2}nNivel = 0;
     aCadena = "";
     aAlfa = "";
     nCampoHasta = 0;
     nCampoD = 0;
     nCampoH = 0;
     nUltimo = 0;
     nPantaDos = 0;
|FIN;

|PROCESO Tipo0C111_w092; |TIPO 0;
     |SI #dsarw092#111 = "S";
          |C_M #dsarw092#110, 1, "N";
          #dsarw092#110 = "";
          |PINTA #dsarw092#110;
     |SINO;
          |C_M #dsarw092#110, 1, "S";
          |PINTA #dsarw092#110;
     |FINSI;
|FPRC;

|PROCESO Tipo0C1_w113; |TIPO 0;
     |SI nModo = 1;
          #dsarm064#0 = #dsarw113#0;
          #dsarm064#1 = #dsarw113#1;
          |LEE 000#dsarm064.=;
          |SI FSalida = 0;
               aMensaje = "0000Ya existe la configuraci¢n para esta empresa";
               |MENAV aMensaje;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo0C1_w091; |TIPO 0;
     |SI nModo = 1;
          #dsarm064#0 = #dsarw091#0;
          #dsarm064#1 = #dsarw091#1;
          |LEE 000#dsarm064.=;
          |SI FSalida = 0;
               aMensaje = "0000Ya existe la configuraci¢n para esta empresa";
               |MENAV aMensaje;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo0C1_w092; |TIPO 0;
     |SI nModo = 1;
          #dsarm064#0 = #dsarw092#0;
          #dsarm064#1 = #dsarw092#1;
          |LEE 000#dsarm064.=;
          |SI FSalida = 0;
               aMensaje = "0000Ya existe la configuraci¢n para esta empresa";
               |MENAV aMensaje;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo12_w091; |TIPO 12;
|FPRC;

|PROCESO Tipo12_w092; |TIPO 12;
|FPRC;

|PROCESO Tipo12_w113; |TIPO 12;
|FPRC;

/*
|PROCESO Tipo7C110_w113; |TIPO 7;
     |HAZ Tipo0C7_w113;
|FPRC;
*/


|PROCESO Tipo7C110_w091; |TIPO 7;
     |HAZ Tipo0C7_w091;
|FPRC;

|PROCESO Tipo7C1_w113; |TIPO 7;
     |SI nModo = 1;
          |HAZ Tipo0C3_w113;
          |HAZ Tipo0C7_w113;
     |FINSI;
|FPRC;

|PROCESO Tipo7C1_w091; |TIPO 7;
     |SI nModo = 1;
          |HAZ Tipo0C3_w091;
          |HAZ Tipo0C7_w091;
     |FINSI;
|FPRC;

|PROCESO Tipo7C2_w113; |TIPO 7;
     |HAZ Tipo0C3_w113;
     |HAZ Tipo0C7_w113;
|FPRC;

|PROCESO Tipo7C2_w091; |TIPO 7;
     |HAZ Tipo0C3_w091;
     |HAZ Tipo0C7_w091;
|FPRC;

|PROCESO Tipo0C3_w113;  |TIPO 0;
     |SI #dsarw113#3 = "S";
          |ESTADO_CONTROL nBotonA1, "ENABLE";
          aAdjunto = #dsarw113#4;
          |QBF aAdjunto;
          |SI aAdjunto = "";
               |ESTADO_CONTROL nBotonA2, "DISABLE";
               |ESTADO_CONTROL nBotonA3, "DISABLE";
          |SINO;
               |ESTADO_CONTROL nBotonA2, "ENABLE";
               |ESTADO_CONTROL nBotonA3, "ENABLE";
          |FINSI;

          |ESTADO_CONTROL nBotonA4, "ENABLE";
          aAdjunto = #dsarw113#5;
          |QBF aAdjunto;
          |SI aAdjunto = "";
               |ESTADO_CONTROL nBotonA5, "DISABLE";
               |ESTADO_CONTROL nBotonA6, "DISABLE";
          |SINO;
               |ESTADO_CONTROL nBotonA5, "ENABLE";
               |ESTADO_CONTROL nBotonA6, "ENABLE";
          |FINSI;

          |ESTADO_CONTROL nBotonA7, "ENABLE";
          aAdjunto = #dsarw113#6;
          |QBF aAdjunto;
          |SI aAdjunto = "";
               |ESTADO_CONTROL nBotonA8, "DISABLE";
               |ESTADO_CONTROL nBotonA9, "DISABLE";
          |SINO;
               |ESTADO_CONTROL nBotonA8, "ENABLE";
               |ESTADO_CONTROL nBotonA9, "ENABLE";
          |FINSI;
          ||Botones Activos
     |SINO;
          |ESTADO_CONTROL nBotonA1, "DISABLE";
          |ESTADO_CONTROL nBotonA2, "DISABLE";
          |ESTADO_CONTROL nBotonA3, "DISABLE";
          |ESTADO_CONTROL nBotonA4, "DISABLE";
          |ESTADO_CONTROL nBotonA5, "DISABLE";
          |ESTADO_CONTROL nBotonA6, "DISABLE";
          |ESTADO_CONTROL nBotonA7, "DISABLE";
          |ESTADO_CONTROL nBotonA8, "DISABLE";
          |ESTADO_CONTROL nBotonA9, "DISABLE";
          ||Botones Inactivos
     |FINSI;
|FPRC;

|PROCESO Tipo0C3_w091;  |TIPO 0;
     |SI #dsarw091#3 = "S";
          |ESTADO_CONTROL nBotonA1, "ENABLE";
          aAdjunto = #dsarw091#4;
          |QBF aAdjunto;
          |SI aAdjunto = "";
               |ESTADO_CONTROL nBotonA2, "DISABLE";
               |ESTADO_CONTROL nBotonA3, "DISABLE";
          |SINO;
               |ESTADO_CONTROL nBotonA2, "ENABLE";
               |ESTADO_CONTROL nBotonA3, "ENABLE";
          |FINSI;

          |ESTADO_CONTROL nBotonA4, "ENABLE";
          aAdjunto = #dsarw091#5;
          |QBF aAdjunto;
          |SI aAdjunto = "";
               |ESTADO_CONTROL nBotonA5, "DISABLE";
               |ESTADO_CONTROL nBotonA6, "DISABLE";
          |SINO;
               |ESTADO_CONTROL nBotonA5, "ENABLE";
               |ESTADO_CONTROL nBotonA6, "ENABLE";
          |FINSI;

          |ESTADO_CONTROL nBotonA7, "ENABLE";
          aAdjunto = #dsarw091#6;
          |QBF aAdjunto;
          |SI aAdjunto = "";
               |ESTADO_CONTROL nBotonA8, "DISABLE";
               |ESTADO_CONTROL nBotonA9, "DISABLE";
          |SINO;
               |ESTADO_CONTROL nBotonA8, "ENABLE";
               |ESTADO_CONTROL nBotonA9, "ENABLE";
          |FINSI;
          ||Botones Activos
     |SINO;
          |ESTADO_CONTROL nBotonA1, "DISABLE";
          |ESTADO_CONTROL nBotonA2, "DISABLE";
          |ESTADO_CONTROL nBotonA3, "DISABLE";
          |ESTADO_CONTROL nBotonA4, "DISABLE";
          |ESTADO_CONTROL nBotonA5, "DISABLE";
          |ESTADO_CONTROL nBotonA6, "DISABLE";
          |ESTADO_CONTROL nBotonA7, "DISABLE";
          |ESTADO_CONTROL nBotonA8, "DISABLE";
          |ESTADO_CONTROL nBotonA9, "DISABLE";
          ||Botones Inactivos
     |FINSI;
|FPRC;

|PROCESO Tipo0C7_w113;  |TIPO 0;
     |SI #dsarw113#7 ! "N";
        |C_M #dsarw113#11, 1, "S";
     |SINO;
        |C_M #dsarw113#11, 1, "N";
     |FINSI;
     |PINTA #dsarw113#11;
|FPRC;

|PROCESO Tipo0C7_w091;  |TIPO 0;
     |SI #dsarw091#7 ! "N";
        |C_M #dsarw091#11, 1, "S";
     |SINO;
        |C_M #dsarw091#11, 1, "N";
     |FINSI;
     |PINTA #dsarw091#11;
|FPRC;

|PROCESO Tipo7C110_w092; |TIPO 7;
     |HAZ Tipo0C7_w092;
|FPRC;

|PROCESO Tipo7C1_w092; |TIPO 7;
     |SI nModo = 1;
          |HAZ Tipo0C3_w092;
          |HAZ Tipo0C7_w092;
          |HAZ Tipo0C111_w092;
     |FINSI;
|FPRC;

|PROCESO Tipo7C2_w092; |TIPO 7;
     |HAZ Tipo0C3_w092;
     |HAZ Tipo0C7_w092;
     |HAZ Tipo0C111_w092;
|FPRC;

|PROCESO Tipo0C3_w092;  |TIPO 0;
     |SI #dsarw092#3 = "S";
          |ESTADO_CONTROL nBotonA1, "ENABLE";
          aAdjunto = #dsarw092#4;
          |QBF aAdjunto;
          |SI aAdjunto = "";
               |ESTADO_CONTROL nBotonA2, "DISABLE";
               |ESTADO_CONTROL nBotonA3, "DISABLE";
          |SINO;
               |ESTADO_CONTROL nBotonA2, "ENABLE";
               |ESTADO_CONTROL nBotonA3, "ENABLE";
          |FINSI;

          |ESTADO_CONTROL nBotonA4, "ENABLE";
          aAdjunto = #dsarw092#5;
          |QBF aAdjunto;
          |SI aAdjunto = "";
               |ESTADO_CONTROL nBotonA5, "DISABLE";
               |ESTADO_CONTROL nBotonA6, "DISABLE";
          |SINO;
               |ESTADO_CONTROL nBotonA5, "ENABLE";
               |ESTADO_CONTROL nBotonA6, "ENABLE";
          |FINSI;

          |ESTADO_CONTROL nBotonA7, "ENABLE";
          aAdjunto = #dsarw092#6;
          |QBF aAdjunto;
          |SI aAdjunto = "";
               |ESTADO_CONTROL nBotonA8, "DISABLE";
               |ESTADO_CONTROL nBotonA9, "DISABLE";
          |SINO;
               |ESTADO_CONTROL nBotonA8, "ENABLE";
               |ESTADO_CONTROL nBotonA9, "ENABLE";
          |FINSI;
          ||Botones Activos
     |SINO;
          |ESTADO_CONTROL nBotonA1, "DISABLE";
          |ESTADO_CONTROL nBotonA2, "DISABLE";
          |ESTADO_CONTROL nBotonA3, "DISABLE";
          |ESTADO_CONTROL nBotonA4, "DISABLE";
          |ESTADO_CONTROL nBotonA5, "DISABLE";
          |ESTADO_CONTROL nBotonA6, "DISABLE";
          |ESTADO_CONTROL nBotonA7, "DISABLE";
          |ESTADO_CONTROL nBotonA8, "DISABLE";
          |ESTADO_CONTROL nBotonA9, "DISABLE";
          ||Botones Inactivos
     |FINSI;
|FPRC;

|PROCESO Tipo0C7_w092;  |TIPO 0;
     |SI #dsarw092#7 ! "N";
        |C_M #dsarw092#11, 1, "S";
     |SINO;
        |C_M #dsarw092#11, 1, "N";
     |FINSI;
     |PINTA #dsarw092#11;
|FPRC;

|PROCESO ObtenIdSalir;
     InNivel = nNivel1<-;
     nNivel1 = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;
     nIdSalir = nNivel2;
|FPRC;

|PROCESO PonImagen;
     |SI nBotonFoto ! -1;
          |FIN_CONTROL_WINDOWS nBotonFoto;
     |FINSI;
     |DBASE aBase;  |QBF aBase;
     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS";                     |RMKDIR aDirLocal;
     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS\DSARCHI";             |RMKDIR aDirLocal;
     aDirLocal    = eaUnidadBasico + "\DOCUMENTOS\DSARCHI\LOGOS";       |RMKDIR aDirLocal;

     |SI enTipoCorreo = 2;
          aNombreLogo = #dsarw091#113;
     |SINO;
          |SI enTipoCorreo = 3;
               aNombreLogo = #dsarw092#113;
          |SINO;
               aNombreLogo = #dsarw113#113;
          |FINSI;
     |FINSI;
     |QBF aNombreLogo;
     |SI aNombreLogo = "";
          aFotoOrigen = aBase + "logos/insertarlogo.jpg";
          aFotoDestino = aDirLocal + "/insertarlogo.jpg";
     |SINO;
          aFotoOrigen = aBase + "logos/" + aNombreLogo;
          aExt        = ".jpg";
          |XABRE "E", aFotoOrigen, nHandle;
          |SI FSalida < 0;
               aFotoOrigen = aBase + "logos/insertarlogo.jpg";
               aExt        = ".jpg";
               |XABRE "E", aFotoOrigen, nHandle;
               |SI FSalida < 0;
                   |MENAV "0000Hay un problema en su aplicaci¢n, no est n instalado los logos";
                   |ACABA;
               |FINSI;
          |FINSI;
          aFotoDestino = aDirLocal + "/" + aNombreLogo;
     |FINSI;

     aContiene1 = aFotoDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aFotoOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         aIPRemoto = "";
         |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aFotoOrigen, aFotoDestino;
         |SINO;
             |COPIA_FICHERO aFotoOrigen, aFotoDestino;
         |FINSI;
     |FINSI;

     aFoto = "IMAGEN,"  + aFotoDestino;

     |SI enTipoCorreo = 2;
          |CONTROL_SIMPLE nPantaDos, aFoto, 0770, 1197, NULL;
     |SINO;
          |CONTROL_SIMPLE nPantaDos, aFoto, 0870, 1297, NULL;
     |FINSI;
     nBotonFoto = FSalida;
|FPRC;

|PROCESO CambiaLogo;
     ||ARA39
     |SI enTipoCorreo = 2;
          aNombreLogo = #dsarw091#113;
     |SINO;
          |SI enTipoCorreo = 3;
               aNombreLogo = #dsarw092#113;
          |SINO;
               aNombreLogo = #dsarw113#113;
          |FINSI;
     |FINSI;
     |QBF aNombreLogo;
     |SI aNombreLogo ! "";
          aAlfa = aDirLocal + "/" + aNombreLogo + ".jpg";   |RFBORRA aAlfa;
     |FINSI;

     aDirec = "F";
     |BROWSE aDirec;
     aDirec = aDirec % 290;  |QBF aDirec;
     |SI aDirec = "";  |ACABA;  |FINSI;

     aExt = (aDirec % -103) < "";
     |SI aExt ! "jpg";
         |MENAV "0000Por favor seleccione una imagen JPG";
         |ACABA;
     |FINSI;

     |SI aNombreLogo ! "";
          aAlfa = aBase + "logos/" + aNombreLogo + ".jpg";  |FBORRA aAlfa;
     |FINSI;

     |SI enTipoCorreo = 2;
          aNombreLogo = (("00000" + #dsarw091#1) % -105) + "2logo";
     |SINO;
          |SI enTipoCorreo = 3;
               aNombreLogo = (("00000" + #dsarw092#1) % -105) + "3logo";
          |SINO;
               aNombreLogo = (("00000" + #dsarw113#1) % -105) + "1logo";
          |FINSI;
     |FINSI;

     aFotoOrigen  = aDirec;
     aFotoDestino = aBase + "logos/" + aNombreLogo + "." + aExt;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |RECIBE_FICHERO aFotoOrigen, aFotoDestino;
     |SINO;
         |COPIA_FICHERO aFotoOrigen, aFotoDestino;
     |FINSI;

     aAux = aNombreLogo + "." + aExt;
     |SI enTipoCorreo = 2;
          #dsarw091#113 = aAux;
     |SINO;
          |SI enTipoCorreo = 3;
               #dsarw092#113 = aAux;
          |SINO;
               #dsarw113#113 = aAux;
          |FINSI;
     |FINSI;

     |HAZ PonImagen;
|FPRC;

|PROCESO BotonA1;
     nAdjunto = 1;
     |HAZ Asignar;
|FPRC;

|PROCESO BotonA2;
     nAdjunto = 1;
     |HAZ VisuAdjunto;
|FPRC;

|PROCESO BotonA3;
     nAdjunto = 1;
     |HAZ BorrarAdjunto;
|FPRC;

|PROCESO BotonA4;
     nAdjunto = 2;
     |HAZ Asignar;
|FPRC;

|PROCESO BotonA5;
     nAdjunto = 2;
     |HAZ VisuAdjunto;
|FPRC;

|PROCESO BotonA6;
     nAdjunto = 2;
     |HAZ BorrarAdjunto;
|FPRC;

|PROCESO BotonA7;
     nAdjunto = 3;
     |HAZ Asignar;
|FPRC;

|PROCESO BotonA8;
     nAdjunto = 3;
     |HAZ VisuAdjunto;
|FPRC;

|PROCESO BotonA9;
     nAdjunto = 3;
     |HAZ BorrarAdjunto;
|FPRC;

|PROCESO SacaNombre;
     aNombre = "";
     aLong = aDirSaca % A0;
     nLong = aLong;
     |PARA nConta = nLong; |SI nConta ] 1; |HACIENDO nConta = nConta - 1;
          nCampo = (100 * nConta) + 1;
          aValor = aDirSaca % nCampo;
          |SI aValor ! "/"; |Y aValor ! "\";
               aNombre = aValor + aNombre;
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Asignar;
     |DBASE aBase;  |QBF aBase;

     aPath = "A" + "";
     |BROWSE aPath;
     aPath = (aPath % 270);
     |QBF aPath;
     |SI aPath ! "";
          aNombre = "";
          aDirSaca = aPath;
          |HAZ SacaNombre;
          |QBF aNombre;
          |SI aNombre ! "";
               ||COPIA A SERVIDOR.
               eaOrigen = aBase + "adjuntos/";
               |MKDIR eaOrigen;
               eaOrigen = eaOrigen + aNombre;
               eaDestino = aPath;
               |HAZ RecibeEnServidorMD5;

               |SI nAdjunto = 1;
                    |SI enTipoCorreo = 2;
                         #dsarw091#4 = aNombre;
                         |PINTA #dsarw091#4;
                    |SINO;
                         |SI enTipoCorreo = 3;
                              #dsarw092#4 = aNombre;
                              |PINTA #dsarw092#4;
                         |SINO;
                              #dsarw113#4 = aNombre;
                              |PINTA #dsarw113#4;
                         |FINSI;
                    |FINSI;
                    |ESTADO_CONTROL nBotonA2, "ENABLE";
                    |ESTADO_CONTROL nBotonA3, "ENABLE";
               |FINSI;
               |SI nAdjunto = 2;
                    |SI enTipoCorreo = 2;
                         #dsarw091#5 = aNombre;
                         |PINTA #dsarw091#5;
                    |SINO;
                         |SI enTipoCorreo = 3;
                              #dsarw092#5 = aNombre;
                              |PINTA #dsarw092#5;
                         |SINO;
                              #dsarw113#5 = aNombre;
                              |PINTA #dsarw113#5;
                         |FINSI;
                         #dsarw092#5 = aNombre;
                         |PINTA #dsarw092#5;
                    |FINSI;
                    |ESTADO_CONTROL nBotonA5, "ENABLE";
                    |ESTADO_CONTROL nBotonA6, "ENABLE";
               |FINSI;
               |SI nAdjunto = 3;
                    |SI enTipoCorreo = 2;
                         #dsarw091#6 = aNombre;
                         |PINTA #dsarw091#6;
                    |SINO;
                         |SI enTipoCorreo = 3;
                              #dsarw092#6 = aNombre;
                              |PINTA #dsarw092#6;
                         |SINO;
                              #dsarw113#6 = aNombre;
                              |PINTA #dsarw113#6;
                         |FINSI;
                         #dsarw092#6 = aNombre;
                         |PINTA #dsarw092#6;
                    |FINSI;
                    |ESTADO_CONTROL nBotonA8, "ENABLE";
                    |ESTADO_CONTROL nBotonA9, "ENABLE";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO VisuAdjunto;
     aNombre = "";
     |SI nAdjunto = 1;
          |SI enTipoCorreo = 2;
               aNombre = #dsarw091#4;
          |SINO;
               |SI enTipoCorreo = 3;
                    aNombre = #dsarw092#4;
               |SINO;
                    aNombre = #dsarw113#4;
               |FINSI;
          |FINSI;
          |QBF aNombre;
     |FINSI;
     |SI nAdjunto = 2;
          |SI enTipoCorreo = 2;
               aNombre = #dsarw091#5;
          |SINO;
               |SI enTipoCorreo = 3;
                    aNombre = #dsarw092#5;
               |SINO;
                    aNombre = #dsarw113#5;
               |FINSI;
          |FINSI;
          |QBF aNombre;
     |FINSI;
     |SI nAdjunto = 3;
          |SI enTipoCorreo = 2;
               aNombre = #dsarw091#6;
               |QBF aNombre;
          |SINO;
               |SI enTipoCorreo = 3;
                    aNombre = #dsarw092#6;
                    |QBF aNombre;
               |SINO;
                    aNombre = #dsarw113#6;
                    |QBF aNombre;
               |FINSI;
          |FINSI;
     |FINSI;


     |SI aNombre = "";
          aMensaje = "0000No hay Documento que mostrar";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;

     |DBASE aBase;
     |QBF aBase;
     eaOrigen = aBase + "adjuntos/" + aNombre;

     eaUnidad = "";
     |HAZ DimeUnidad;
     |SI eaUnidad = "";
          eaUnidad = "C";
     |FINSI;
     eaDestino = eaUnidad + ":\documentos\dsarchi\" + aNombre;
     |HAZ EnviaFicheroConMD5;

     |RSYSTEM eaDestino;
     ||COPIAR a CACHE + DOCUMENTOS y RSYSTEM.
|FPRC;

|PROCESO BorrarAdjunto;
     |SI enTipoCorreo = 2;
          nAux = nAdjunto + 3;
          aAdjunto = #dsarw091#nAux#;
     |SINO;
          |SI enTipoCorreo = 3;
               nAux = nAdjunto + 3;
               aAdjunto = #dsarw092#nAux#;
          |SINO;
               nAux = nAdjunto + 3;
               aAdjunto = #dsarw113#nAux#;
          |FINSI;
     |FINSI;
     |QBF aAdjunto;
     |SI aAdjunto ! "";
          |DBASE aBase;  |QBF aBase;
          aBorra = aBase + "adjuntos/" + aAdjunto;
          ||Ahora ya no lo borro fisicamente por si se usa en otro sitio.
          ||FBORRA aBorra;

          |SI enTipoCorreo = 2;
               #dsarw091#nAux# = "";
               |PINTA #dsarw091#nAux#;
          |SINO;
               |SI enTipoCorreo = 3;
                    #dsarw092#nAux# = "";
                    |PINTA #dsarw092#nAux#;
               |SINO;
                    #dsarw113#nAux# = "";
                    |PINTA #dsarw113#nAux#;
               |FINSI;
          |FINSI;

          |SI nAdjunto = 1;
               |ESTADO_CONTROL nBotonA2, "DISABLE";
               |ESTADO_CONTROL nBotonA3, "DISABLE";
          |FINSI;
          |SI nAdjunto = 2;
               |ESTADO_CONTROL nBotonA5, "DISABLE";
               |ESTADO_CONTROL nBotonA6, "DISABLE";
          |FINSI;
          |SI nAdjunto = 3;
               |ESTADO_CONTROL nBotonA8, "DISABLE";
               |ESTADO_CONTROL nBotonA9, "DISABLE";
          |FINSI;
     |FINSI;
     ||TODO CCC
|FPRC;

|PROCESO Botones9;
     |SI enTipoCorreo = 2;
          |CONTROL_SIMPLE nPantaDos, "BOTON,{{197}} Asignar", 0935, 0945, BotonA1;
          nBotonA1 = FSalida;

          |CONTROL_SIMPLE nPantaDos, "BOTON,{{137}} Visualizar", 0947, 0957, BotonA2;
          nBotonA2 = FSalida;

          |CONTROL_SIMPLE nPantaDos, "BOTON,{{207}} Borrar", 0959, 0969, BotonA3;
          nBotonA3 = FSalida;

          |CONTROL_SIMPLE nPantaDos, "BOTON,{{197}} Asignar", 1035, 1045, BotonA4;
          nBotonA4 = FSalida;

          |CONTROL_SIMPLE nPantaDos, "BOTON,{{137}} Visualizar", 1047, 1057, BotonA5;
          nBotonA5 = FSalida;

          |CONTROL_SIMPLE nPantaDos, "BOTON,{{207}} Borrar", 1059, 1069, BotonA6;
          nBotonA6 = FSalida;

          |CONTROL_SIMPLE nPantaDos, "BOTON,{{197}} Asignar", 1135, 1145, BotonA7;
          nBotonA7 = FSalida;

          |CONTROL_SIMPLE nPantaDos, "BOTON,{{137}} Visualizar", 1147, 1157, BotonA8;
          nBotonA8 = FSalida;

          |CONTROL_SIMPLE nPantaDos, "BOTON,{{207}} Borrar", 1159, 1169, BotonA9;
          nBotonA9 = FSalida;
     |SINO;
          |SI enTipoCorreo = 3;
               |CONTROL_SIMPLE nPantaDos, "BOTON,{{197}} Asignar", 1035, 1045, BotonA1;
               nBotonA1 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{137}} Visualizar", 1047, 1057, BotonA2;
               nBotonA2 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{207}} Borrar", 1059, 1069, BotonA3;
               nBotonA3 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{197}} Asignar", 1135, 1145, BotonA4;
               nBotonA4 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{137}} Visualizar", 1147, 1157, BotonA5;
               nBotonA5 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{207}} Borrar", 1159, 1169, BotonA6;
               nBotonA6 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{197}} Asignar", 1235, 1245, BotonA7;
               nBotonA7 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{137}} Visualizar", 1247, 1257, BotonA8;
               nBotonA8 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{207}} Borrar", 1259, 1269, BotonA9;
               nBotonA9 = FSalida;
          |SINO;
               |CONTROL_SIMPLE nPantaDos, "BOTON,{{197}} Asignar", 0935, 0945, BotonA1;
               nBotonA1 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{137}} Visualizar", 0947, 0957, BotonA2;
               nBotonA2 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{207}} Borrar", 0959, 0969, BotonA3;
               nBotonA3 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{197}} Asignar", 1035, 1045, BotonA4;
               nBotonA4 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{137}} Visualizar", 1047, 1057, BotonA5;
               nBotonA5 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{207}} Borrar", 1059, 1069, BotonA6;
               nBotonA6 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{197}} Asignar", 1135, 1145, BotonA7;
               nBotonA7 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{137}} Visualizar", 1147, 1157, BotonA8;
               nBotonA8 = FSalida;

               |CONTROL_SIMPLE nPantaDos, "BOTON,{{207}} Borrar", 1159, 1169, BotonA9;
               nBotonA9 = FSalida;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MensaVar;
     |VENTANA 0602, 1651, -1, 16, "Variables a insertar desde DSCOMER9: Facturas Ventas";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;


     |CONTROL_SIMPLE 0, "LABEL,{{16}}#SERIE#            = Serie", 0703, 0750, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}#NUMFAC#        = N£mero de factura", 0803, 0850, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}#FECHAFAC#     = Fecha factura", 0903, 0950, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}#IMPORTEFAC#  = Importe factura", 1003, 1050, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}#FECHAVTO#     = Fecha Primer Vencimiento", 1103, 1150, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}#IMPORTEVTO#  = Importe primer vencimiento", 1203, 1250, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}#IBAN#               = IBAN", 1303, 1350, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}#RAZONSOCIAL#= Razon Social", 1403, 1450, NULL;

     |PAUSA;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;
|FPRC;

|PROCESO ModiAlta;
     ||ARA39

     nIdSalir = 0;
     |HAZ ObtenIdSalir;
     |ESTADO_CONTROL nIdSalir, "HIDE";

     |SI enTipoCorreo = 2;
          |SI enSwSMTPCLI = 1;
               |VENTANA 0501, 3099, -1, 17, "Configuraci¢n Adjuntos/Texto/Logo Correos FacturaE";
          |SINO;
               |VENTANA 0501, 3099, -1, 17, "Configuraci¢n Adjuntos/Texto Correos FacturaE";
          |FINSI;
     |SINO;
          |SI enTipoCorreo = 3;
               |SI enSwSMTPCLI = 1;
                    |VENTANA 0501, 3099, -1, 17, "Configuraci¢n Adjuntos/Texto/Logo Correos N¢minas";
               |SINO;
                    |VENTANA 0501, 3099, -1, 17, "Configuraci¢n Adjuntos/Texto Correos N¢minas";
               |FINSI;
          |SINO;
               |SI enSwSMTPCLI = 1;
                    |VENTANA 0501, 3099, -1, 17, "Configuraci¢n Adjuntos/Texto/Logo Correos";
               |SINO;
                    |VENTANA 0501, 3099, -1, 17, "Configuraci¢n Adjuntos/Texto Correos";
               |FINSI;
          |FINSI;
     |FINSI;
     nVentDos = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentDos;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     aCadena ="|NC";
     aAlfa = #dsarm064#aCadena#;
     nCampoHasta = aAlfa;
     nCampoHasta = nCampoHasta - 1;

     |SI nModo ! 1;
          |PARA nCampoD = 0;  |SI nCampoD [ nCampoHasta; |HACIENDO nCampoD = nCampoD + 1;
                nCampoH = nCampoD;
                |SI enTipoCorreo = 2;
                     #dsarw091#nCampoH# = #dsarm064#nCampoD#;
                |SINO;
                     |SI enTipoCorreo = 3;
                          #dsarw092#nCampoH# = #dsarm064#nCampoD#;
                     |SINO;
                          #dsarw113#nCampoH# = #dsarm064#nCampoD#;
                     |FINSI;
                |FINSI;
          |SIGUE;

          |SI enTipoCorreo = 2;
               |C_M #dsarw091#0, 1, "N";
               |C_M #dsarw091#1, 1, "N";
          |SINO;
               |SI enTipoCorreo = 3;
                    |C_M #dsarw092#0, 1, "N";
                    |C_M #dsarw092#1, 1, "N";
               |SINO;
                    |C_M #dsarw113#0, 1, "N";
                    |C_M #dsarw113#1, 1, "N";
               |FINSI;
          |FINSI;
     |SINO;
          |SI enTipoCorreo = 2;
               |C_M #dsarw091#1, 1, "S";
          |SINO;
               |SI enTipoCorreo = 3;
                    |C_M #dsarw092#1, 1, "S";
               |SINO;
                    |C_M #dsarw113#1, 1, "S";
               |FINSI;
          |FINSI;
          nUltimo = 0;
          |SI enCorreoMultiEmp = 1;
               |HAZ DameUltimo;
          |FINSI;
          |SI enTipoCorreo = 2;
               |DDEFECTO #dsarw091;
               #dsarw091#0 = enTipoCorreo;
               #dsarw091#1 = nUltimo;
               |SI enCorreoMultiEmp = 0;
                    |C_M #dsarw091#1, 1, "N";
                    #dsarw091#2 = "*DEFECTO*";
                    |C_M #dsarw091#2, 1, "N";
               |SINO;
                    |C_M #dsarw091#1, 1, "S";
                    |C_M #dsarw091#2, 1, "S";
               |FINSI;
          |SINO;
               |SI enTipoCorreo = 3;
                    |DDEFECTO #dsarw092;
                    #dsarw092#0 = enTipoCorreo;
                    #dsarw092#1 = nUltimo;
                    |SI enCorreoMultiEmp = 0;
                         |C_M #dsarw092#1, 1, "N";
                         #dsarw092#2 = "*DEFECTO*";
                         |C_M #dsarw092#2, 1, "N";
                    |SINO;
                         |C_M #dsarw092#1, 1, "S";
                         |C_M #dsarw092#2, 1, "S";
                    |FINSI;
                    |DDEFECTO #dsarw091;
               |SINO;
                    #dsarw113#0 = enTipoCorreo;
                    #dsarw113#1 = nUltimo;
                    |SI enCorreoMultiEmp = 0;
                         |C_M #dsarw113#1, 1, "N";
                         #dsarw113#2 = "*DEFECTO*";
                         |C_M #dsarw113#2, 1, "N";
                    |SINO;
                         |C_M #dsarw113#1, 1, "S";
                         |C_M #dsarw113#2, 1, "S";
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI enTipoCorreo = 2;
         |PINPA #0#dsarw091; nPantaDos = FSalida;
         |PINDA #0#dsarw091;
     |SINO;
         |SI enTipoCorreo = 3;
              |PINPA #0#dsarw092; nPantaDos = FSalida;
              |PINDA #0#dsarw092;
         |SINO;
              |PINPA #0#dsarw113; nPantaDos = FSalida;
              |PINDA #0#dsarw113;
         |FINSI;
     |FINSI;

     |HAZ Botones9;

     |CONTROL_SIMPLE nPantaDos, "BOTON,{{163}}", 1785, 1887, MensaVar;

     |SI enTipoCorreo = 2; |O enTipoCorreo = 3; |O enTipoCorreo = 1;
          |SI enSwSMTPCLI = 1;
               |CONTROL_SIMPLE nPantaDos, "BOTON,Pulse aqu¡ para cambiar el logo", 1370, 1497, CambiaLogo;
               |CONTROL_SIMPLE nPantaDos, "LABEL,{{16}}Imagen JPG de 170 X 80", 1570, 1597, NULL;

               nBotonFoto = -1;
               |HAZ PonImagen;
               ||Meter tema del logo.
          |SINO;
               |SI enTipoCorreo = 2; |Y enSwBLAT = 1;
                    |CONTROL_SIMPLE nPantaDos, "BOTON,Pulse aqu¡ para cambiar el logo", 1370, 1497, CambiaLogo;
                    |CONTROL_SIMPLE nPantaDos, "LABEL,{{16}}Imagen JPG de 170 X 80", 1570, 1597, NULL;

                    nBotonFoto = -1;
                    |HAZ PonImagen;
                    ||Meter tema del logo.
               |FINSI;
          |FINSI;
     |FINSI;



     |SI enTipoCorreo = 2;
         |SI nModo = 1;  |ENDATOS #1#dsarw091;  |FINSI;
         |SI nModo = 2;  |ENDATOS #2#dsarw091;  |FINSI;
     |SINO;
         |SI enTipoCorreo = 3;
              |SI nModo = 1;  |ENDATOS #1#dsarw092;  |FINSI;
              |SI nModo = 2;  |ENDATOS #2#dsarw092;  |FINSI;
         |SINO;
              |SI nModo = 1;  |ENDATOS #1#dsarw113;  |FINSI;
              |SI nModo = 2;  |ENDATOS #2#dsarw113;  |FINSI;
         |FINSI;
     |FINSI;

     |SI FSalida = 0;
          |HAZ GrabaDatos;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentDos;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentDos;

     |SI enCorreoMultiEmp = 1;
          aVent1 = -1;
          aVent2 = -1;
          aVent3 = 0;
          aVent4 = nVentana;
          aVent5 = "MODAL";
          |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINSI;

     |ESTADO_CONTROL nIdSalir, "SHOW";
|FPRC;

|PROCESO DameUltimo;
     #dsarm064#0 = enTipoCorreo;
     #dsarm064#1 = 99999;
     |LEE 000#dsarm064.];
     |SI FSalida = 0;
          |LEE 000#dsarm064.a;
     |SINO;
          |LEE 000#dsarm064.u;
     |FINSI;
     |SI FSalida = 0; |Y #dsarm064#0 = enTipoCorreo;
          nUltimo = #dsarm064#1 + 1;
     |SINO;
          nUltimo = 1;
     |FINSI;
|FPRC;

|PROCESO GrabaDatos;
     #dsarm064#0 = enTipoCorreo;
     |SI enTipoCorreo = 2;
         #dsarm064#1 = #dsarw091#1;
     |SINO;
          |SI enTipoCorreo = 3;
              #dsarm064#1 = #dsarw092#1;
          |SINO;
              #dsarm064#1 = #dsarw113#1;
          |FINSI;
     |FINSI;
     |LEE 101#dsarm064.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsarm064;
         #dsarm064#0 = enTipoCorreo;
         |SI enTipoCorreo = 2;
              #dsarm064#1 = #dsarw091#1;
         |SINO;
              |SI enTipoCorreo = 3;
                   #dsarm064#1 = #dsarw092#1;
              |SINO;
                   #dsarm064#1 = #dsarw113#1;
              |FINSI;
         |FINSI;
         |GRABA 020#dsarm064.b;
     |FINSI;

     |PARA nCampoD = 2;  |SI nCampoD [ nCampoHasta;  |HACIENDO nCampoD = nCampoD + 1;
           nCampoH   = nCampoD;
           |SI enTipoCorreo = 2;
                #dsarm064#nCampoD# = #dsarw091#nCampoH#;
           |SINO;
                |SI enTipoCorreo = 3;
                     #dsarm064#nCampoD# = #dsarw092#nCampoH#;
                |SINO;
                     #dsarm064#nCampoD# = #dsarw113#nCampoH#;
                |FINSI;
           |FINSI;
     |SIGUE;

     |GRABA 020#dsarm064.a;
     |LIBERA #dsarm064;
|FPRC;

|PROCESO Tipo80w090; |TIPO 80;
     FSalida = 2899;
|FPRC;

|PROCESO BajaPanta;
     #dsarm064#0 = enTipoCorreo;
     #dsarm064#1 = 1;
|FPRC;

|PROCESO AltaPanta;
     #dsarm064#0 = enTipoCorreo;
     #dsarm064#1 = 99999;
|FPRC;

|PROCESO EventoPanta;
     |SI FSalida = 1;  |O FSalida = 2;
          |LEE 000#dsarm064.=;
          |SI FSalida = 0; |Y #dsarm064#0 = enTipoCorreo;
               |ESTADO_CONTROL nBoton2, "ENABLE";
               |ESTADO_CONTROL nBoton3, "ENABLE";
          |SINO;
               |ESTADO_CONTROL nBoton2, "DISABLE";
               |ESTADO_CONTROL nBoton3, "DISABLE";
          |FINSI;
     |FINSI;

     |SI FSalida = 4;
          |HAZ Boton2;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     nModo = 1;
     |HAZ ModiAlta;
     |REFRESCACONTROL nGrid;
|FPRC;

|PROCESO Boton2;
     |LEE 000#dsarm064.=;
     |SI FSalida ! 0; |O #dsarm064#0 ! enTipoCorreo;
          |ACABA;
     |FINSI;

     nModo = 2;
     |HAZ ModiAlta;
     |REFRESCACONTROL nGrid;
|FPRC;

|PROCESO Boton3;
     |LEE 000#dsarm064.=;
     |SI FSalida ! 0; |O #dsarm064#0 ! enTipoCorreo;
          |ACABA;
     |FINSI;

     |LEE 101#dsarm064.=;
     |SI FSalida = 0;
          aMensaje = "0000NDesea Borrar configuraci¢n " + #dsarm064#2;
          |QBF aMensaje;
          aMensaje = aMensaje + "?";
          |CONFI aMensaje;
          |SI FSalida = 0;
               |BORRA 020#dsarm064.a;
          |FINSI;
          |LIBERA #dsarm064;
     |FINSI;

     |REFRESCACONTROL nGrid;
|FPRC;

|PROGRAMA;
     |SI enTipoCorreo = 1;
          |VENTANA 0501, 2799, nPanta, 17, "Configuraci¢n Formato Correos";
     |SINO;
          |SI enTipoCorreo = 2;
              |VENTANA 0501, 2799, nPanta, 17, "Configuraci¢n Formato Correos FacturaE (por Empresa)";
          |SINO;
              |VENTANA 0501, 2799, nPanta, 17, "Configuraci¢n Formato Correos N¢minas (por Empresa)";
          |FINSI;
     |FINSI;

     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SI enCorreoMultiEmp = 1;
          |CABEZA "Configuraci¢n por Empresas";

          |ABRE #dsarm064;

          |PINPA #0#dsarw090;
          nPanta = FSalida;

          |CONTROL_SIMPLE nPanta, "BOTON,{{193}}Alta ", 2753, 2763, Boton1;
          nBoton1 = FSalida;

          |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Modificar ", 2765, 2775, Boton2;
          nBoton2 = FSalida;

          |CONTROL_SIMPLE nPanta, "BOTON,{{199}}Baja ", 2777, 2787, Boton3;
          nBoton3 = FSalida;

          nRango = 4 + 8 + 16 + 32;
          nPos1  = 0702;
          nPos2  = 2698;

          |LINEAL_SIMPLE #1#dsarm064, nRango, nPos1, nPos2, BajaPanta, AltaPanta, EventoPanta;
          nGrid = FSalida;

          aEsc1  = &255 + "806";
          aEsc2  = &255 + "807";
          aRetu  = &255 + "802";
          |PARA; |SI;  |HACIENDO;
              FSalida = "::{{001}}Salir," + nGrid;
              |LEETECLA aTecla;
              |SI aTecla = aEsc1; |SAL;  |FINSI;
              |SI aTecla = aEsc2; |SAL;  |FINSI;
              |SI aTecla = aRetu; |SAL;  |FINSI;
          |SIGUE;

          |FIN_CONTROL_WINDOWS nGrid;

          |DESTRUYECONTROL nBoton1;
          |DESTRUYECONTROL nBoton2;
          |DESTRUYECONTROL nBoton3;

          |CIERRA #dsarm064;
     |SINO;
          ||Entro directamente en la pantalla de Alta/Modificacion
          |ABRE #dsarm064;
          |DDEFECTO #dsarm064;
          #dsarm064#0 = enTipoCorreo;
          #dsarm064#1 = 0;                   ||Valor por defecto para TODOS
          |LEE 000#dsarm064.=;
          |SI FSalida = 0;
               nModo = 2;
               |HAZ ModiAlta;
          |SINO;
               nModo = 1;
               |HAZ ModiAlta;
          |FINSI;
          |CIERRA #dsarm064;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;
|FPRO;
