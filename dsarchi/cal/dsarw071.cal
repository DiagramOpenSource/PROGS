|FICHEROS;
     dsarw071 #971,MANTE;
     dsarm001 #1;
     dsarm002 #2;
     dsarm003 #3;
     dsarm004 #4;
     dsarz010 #101;
|FIN;

|VARIABLES;
     &enBtnTipo = 0;
     aAlfa       = "";
     aRuta       = "";
     aLong       = "";
     aEjecuta    = "";
     aAux        = "";
     aPrograma   = "";
     aDirLocal   = "";
     aBorra      = "";
     aMensaje    = "";
     aLinea      = "";
     aAbre       = "";
     aPath       = "";
     aBase       = "";

     nLong       = 0;
     nCarac      = 0;
     nPos        = 0;
     nHandle     = 0;

    &enGrupoTres = 0;
    &enSubGTres  = 0;
    &enTipoTres  = 0;
    &eaUnidad    = "";
    &eaOrigen    = "";
    &eaDestino   = "";
|FIN;

|PROCESO Tipo12Fw71;  |TIPO 12;
     |SI FSalida = 7;  |ACABA;  |FINSI;

     aAlfa = #971#0;   |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000Introduzca una carpeta contenedora";
         |ERROR;
         |ACABA;
     |FINSI;


     |SI #971#10 = "S";
          ||Importacion albaranes Venta (dscomer9)
     |SINO;
          |ABRE #4;
          #dsarm004#0 = #971#2;
          #dsarm004#1 = #971#3;
          #dsarm004#2 = #971#4;
          |LEE 000#4=;
          |SI FSalida ! 0;
              |MENAV "    Datos de la ubicaci¢n en la Gesti¢n documental inexistente";
              |ERROR;
              |CIERRA #4;
              |ACABA;
          |FINSI;
          |CIERRA #4;

          |SI #dsarm004#20 = "S";  |O #dsarm004#21 = "S";  |O #dsarm004#22 = "S";
           |O #dsarm004#23 = "S"; |O #dsarm004#24 = "S";
               |SI #dsarm004#81 = "S"; |Y #dsarm004#78 ! 0;
                    ||ES correcto. Pq. tengo el dsescan y una plantilla de autorelleno
               |SINO;
                    |MENAV "    Esta ubicaci¢n no es automatica, se piden datos del documento";
                    |ERROR;
                    |ACABA;
               |FINSI;
          |FINSI;

     |FINSI;
|FPRC;

|PROCESO Tipo0C11w071; |TIPO 0;
     |SI #dsarw071#11 = "S";
          |C_M #dsarw071#12, 1, "S";
          |C_M #dsarw071#13, 1, "S";
          |PINTA #dsarw071#12;
          |PINTA #dsarw071#13;

          #dsarw071#10 = "N";
          |PINTA #dsarw071#10;
          |HAZ Tipo0C10w071;
     |SINO;
          |C_M #dsarw071#12, 1, "N";
          |C_M #dsarw071#13, 1, "N";
          |PINTA #dsarw071#12;
          |PINTA #dsarw071#13;
     |FINSI;
|FPRC;

|PROCESO Tipo0C10w071; |TIPO 0;
     |SI #dsarm001#203 = "S";
          |SI #dsarw071#10 = "S";
               #dsarw071#2 = 0;
               #dsarw071#3 = 0;
               #dsarw071#4 = 0;
               #dsarw071#5 = "";
               #dsarw071#6 = "";
               #dsarw071#7 = "";
               #dsarw071#9 = "N";

               |PINTA #dsarw071#2;
               |PINTA #dsarw071#3;
               |PINTA #dsarw071#4;
               |PINTA #dsarw071#5;
               |PINTA #dsarw071#6;
               |PINTA #dsarw071#7;
               |ESTADO_CONTROL enBtnTipo, "DISABLE";
               |C_M #dsarw071#9, 1, "N";
          |SINO;
               |ESTADO_CONTROL enBtnTipo, "ENABLE";
               |C_M #dsarw071#9, 1, "S";
          |FINSI;
     |SINO;
          |ESTADO_CONTROL enBtnTipo, "ENABLE";
          |C_M #dsarw071#9, 1, "S";
     |FINSI;
     |PINTA #dsarw071#9;

     |SI #dsarw071#10 = "S";
          #dsarw071#11 = "N";
          |PINTA #dsarw071#11;
          |HAZ Tipo0C11w071;
     |FINSI;
|FPRC;

|PROCESO Tipo66C8Fw71;  |TIPO 66;
     |ABRE #101;
     #101#0 = #971#8;
     |LEE 000#101=;
     |CONSULTA_CLAVE #1#101;
     |SI FSalida = 0;
         #971#8 = #101#0;  |PINTA #971#8;
     |FINSI;
     |CIERRA #101;
|FPRC;

|PROCESO Tipo0C8Fw71;   |TIPO 0;
     |SI #971#8 = "          ";  |ACABA;  |FINSI;

     |ABRE #101;
     #101#0 = #971#8;
     |LEE 000#101=;
     |SI FSalida ! 0;
         |MENAV "0000No existe el usuario.";
         |ERROR;
     |FINSI;
     |CIERRA #101;
|FPRC;

|PROCESO Tipo0C4Fw71;
     |SI #1#8   = "N";  |ACABA;  |FINSI;
     |SI FSalida  = 2;  |ACABA;  |FINSI;
     |SI #1#203 = "S"; |Y #971#10 = "S";  |ACABA; |FINSI;

     |ABRE #4;
     #dsarm004#0 = #971#2;
     #dsarm004#1 = #971#3;
     #dsarm004#2 = #971#4;
     |LEE 000#4=;
     |SI FSalida ! 0;
          |MENAV "    Tipo inexistente"; |ERROR;
          #971#7 = "";
     |SINO;
          #971#7 = #dsarm004#3;
     |FINSI;
     |CIERRA #4;

     |PINTA #971#7;
|FPRC;

|PROCESO Tipo0C3Fw71;
     |SI #1#8   = "N";  |ACABA;  |FINSI;
     |SI FSalida  = 2;  |ACABA;  |FINSI;
     |SI #1#203 = "S"; |Y #971#10 = "S";  |ACABA; |FINSI;

     |ABRE #3;
     #3#0 = #971#2;
     #3#1 = #971#3;
     |LEE 000#3=;
     |SI FSalida ! 0;
          |MENAV "    Subgrupo inexistente"; |ERROR;
          #971#6 = "";
     |SINO;
          #971#6 = #3#2;
     |FINSI;
     |CIERRA #3;

     |PINTA #971#6;
|FPRC;

|PROCESO Tipo0C2Fw71;
     |SI FSalida  = 2;  |ACABA;  |FINSI;
     |SI #1#203 = "S"; |Y #971#10 = "S";  |ACABA; |FINSI;

     |ABRE #2;
     #2#0 = #971#2;
     |LEE 000#2=;
     |SI FSalida ! 0;
          |MENAV "    Grupo inexistente"; |ERROR;
          #971#5 = "";
     |SINO;
          #971#5 = #2#1;
     |FINSI;
     |CIERRA #2;

     |PINTA #971#5;
|FPRC;

|PROCESO Tipo0C0Fw71;  |TIPO 0;
     aAlfa = #971#0;   |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000Introduzca una carpeta contenedora";
     |FINSI;
|FPRC;

|PROCESO Carpeta;
     |HAZ Traete_dsselect;

     aAux      = eaUnidad + ":\DOCUMENTOS\DSARCHI\";
     aPrograma = aAux + "dsselect.exe";

     aBorra = aAux + "dsselect.ini";   |RFBORRA aBorra;
     aBorra = aAux + "dsselect.txt";   |RFBORRA aBorra;

     aEjecuta = aAux + "dsselect.ini";
     |XABRE "CW", aEjecuta, nHandle;
     |SI FSalida < 0;
          aMensaje = "0000Error. Problemas al crear " + aEjecuta;
          |MENAV aMensaje;
          |ACABA;
     |SINO;
          aAlfa  = #971#0;  |QBF aAlfa;
          |SI aAlfa = "";  aAlfa = eaUnidad + ":";  |FINSI;

          aLinea = &34 + aAlfa + &34 + " " + &34 + aBorra + &34 + " C";
          |XGRABA nHandle, aLinea;
          |XCIERRA nHandle;
     |FINSI;

     aEjecuta = aPrograma;
     |RSYSTEM aEjecuta;

     aAbre = aAux + "dsselect.txt";
     |XABRE "CU", aAbre, nHandle;
     |SI FSalida < 0;
          aPath = "";
     |SINO;
          |XLEE nHandle, 250, aPath;
          |SI FSalida < 0
               aPath = "";
          |FINSI;
     |FINSI;
     |XCIERRA nHandle;

     |QBF aPath;
     aAlfa = aPath % -401;
     |SI aAlfa = ".";
         |MENAV "0000Por favor seleccione una carpeta y no un fichero.";
     |FINSI;

     aBorra = aAux + "dsselect.txt";   |RFBORRA aBorra;

     #971#0 = aPath + "\";  |PINTA #971#0;
|FPRC;

|PROCESO Ubicacion;
     |SI #1#8 = "S";
          enGrupoTres = 0;
          enSubGTres  = 0;
          enTipoTres  = 0;
          aEjecuta = "dsarz003;DAMETRE";
          |SUB_EJECUTA_NP aEjecuta;
          |SI enGrupoTres ! 0;
               #971#2 = enGrupoTres;    |PINTA #971#2;
               #971#3 = enSubGTres;     |PINTA #971#3;
               #971#4 = enTipoTres;     |PINTA #971#4;

               |HAZ Tipo0C2Fw71;
               |HAZ Tipo0C3Fw71;
               |HAZ Tipo0C4Fw71;
          |FINSI;
     |SINO;
          |ABRE #2;
          |CONSULTA_CLAVE #1#2;
          |SI FSalida = 0;
               #971#2 = #2#0;    |PINTA #971#2;
               #971#3 = 1;       |PINTA #971#3;
               #971#4 = 1;       |PINTA #971#4;

               |HAZ Tipo0C2Fw71;
          |FINSI;
          |CIERRA #2;
     |FINSI;
|FPRC;
