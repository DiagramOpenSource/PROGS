|FICHEROS;
     n43m0001;
     n43m0002;
     n43m0105;

     n43w0006;
     n43w0011;

     canempre@;
     cacuenta@;
|FIN;

|VARIABLES;
     n0Vent              = 0;
     n1Vent              = 0;
     nGrid2              = -1;
     nGrid11             = -1;
     nBtnCMov            = 0;
     nBtnMAsi            = 0;
     nBtnCont            = 0;

     nSwGrid             = 0;
     nRango              = 0;
     nConta              = 0;
     nResto              = 0;
     nVeces              = 0;
     nCmp                = 0;

     aFic                = "";
     aEsc1               = "";
     aEsc2               = "";
     aRetu               = "";
     aTecla              = "";
     aAlfa               = "";
     aEjec               = "";
     aBase               = "";
     aMas                = "";

     aFondo              = "";
     aColor              = "";

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     &enEmp              = 0;
     &eaEnt              = "";
     &eaOfi              = "";
     &eaCta              = "";
     &eaPaq              = "";
     &efOpe              = @;
     &enMov              = 0;
     &enDoc              = 0;
     &eaCuenta           = "";
     &eaNCuenta          = "";
     &enEje              = 0;
     &enPer              = 0;
     &enOk               = 0;

     &eaAmarillo         = "";
     &eaAzulClaro        = "";
     &eaAzulOscuro       = "";
     &eaGris             = "";
     &eaMarengo          = "";
     &eaNegro            = "";
     &eaRojo             = "";
     &eaVerde            = "";
|FIN;

|PROCESO EnablaBtnCont;
     |ESTADO_CONTROL nBtnCont, "DISABLE";

     |SI #n43m0002#30 = "S/Contenido ";  |ACABA;  |FINSI;
     |SI #n43m0002#34 = "S/Contenido ";  |ACABA;  |FINSI;
     |SI #n43m0002#32 = 0;               |ACABA;  |FINSI;
     |SI #n43m0002#36 = 0;               |ACABA;  |FINSI;
     |SI #n43m0002#27 = 0;               |ACABA;  |FINSI;
     |SI #n43m0002#28 = "01.01.0000";    |ACABA;  |FINSI;

     |SI #n43m0002#29 ! 0;               |ACABA;  |FINSI;

     |ESTADO_CONTROL nBtnCont, "ENABLE";
|FPRC;

|PROCESO Baja2;
     #n43m0002#0 = #n43m0105#3;
     #n43m0002#1 = #n43m0105#0;
     #n43m0002#2 = #n43m0105#1;
     #n43m0002#3 = #n43m0105#2;
     #n43m0002#4 = "01.01.0000";
     #n43m0002#5 = 1;
|FPRC;

|PROCESO Alta2;
     #n43m0002#0 = #n43m0105#3;
     #n43m0002#1 = #n43m0105#0;
     #n43m0002#2 = #n43m0105#1;
     #n43m0002#3 = #n43m0105#2;
     #n43m0002#4 = "31.12.2999";
     #n43m0002#5 = 9999;
|FPRC;

|PROCESO Evnt11;
     |SI FSalida = 1;  |Y nSwGrid = 0;
         nSwGrid = 11;
     |FINSI;

     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#n43w0011.=;

         |SI nSwGrid = 2;  |ACABA;  |FINSI;

         #n43m0002#0 = #n43w0011#0;
         #n43m0002#1 = #n43w0011#1;
         #n43m0002#2 = #n43w0011#2;
         #n43m0002#3 = #n43w0011#3;
         #n43m0002#4 = #n43w0011#4;
         #n43m0002#5 = #n43w0011#5;
         |LEE 000#n43m0002.=;

         |REFRESCACONTROL nGrid2;

         |HAZ EnablaBtnCont;
     |FINSI;

     |SI FSalida = 4;
         nSwGrid = 11;
     |FINSI;
|FPRC;

|PROCESO ConsMov;
     |VENTANA 0501, 3699, -1, 16, "Datos movimiento";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |PTEC 802; |PAUSA;

     |DDEFECTO #n43w0006;
     |PARA nCmp = 0;  |SI nCmp [ 26;  |HACIENDO nCmp = nCmp + 1;
           #n43w0006#nCmp#  = #n43m0002#nCmp#;
     |SIGUE;

     #n43w0006#27  = #n43m0002#27;
     #n43w0006#28  = #n43m0002#28;
     #n43w0006#29  = #n43m0002#29;
     #n43w0006#40  = #n43m0002#38;
     #n43w0006#41  = #n43m0002#39;

     |SI #n43m0002#13 = "1";
         #n43w0006#30 = "";
         #n43w0006#31 = #n43m0002#30;
         #n43w0006#32 = #n43m0002#31;
         #n43w0006#33 = #n43m0002#32;
         #n43w0006#34 = #n43m0002#33;

         #n43w0006#35 = #n43m0002#34;
         #n43w0006#36 = "";
         #n43w0006#37 = #n43m0002#35;
         #n43w0006#38 = #n43m0002#36;
         #n43w0006#39 = #n43m0002#37;
     |FINSI;

     |SI #n43m0002#13 = "2";
         #n43w0006#31 = "";
         #n43w0006#30 = #n43m0002#30;
         #n43w0006#32 = #n43m0002#31;
         #n43w0006#33 = #n43m0002#32;
         #n43w0006#34 = #n43m0002#33;

         #n43w0006#35 = "";
         #n43w0006#36 = #n43m0002#34;
         #n43w0006#37 = #n43m0002#35;
         #n43w0006#38 = #n43m0002#36;
         #n43w0006#39 = #n43m0002#37;
     |FINSI;

     |PINPA #0#n43w0006;
     |PINDA #0#n43w0006;

     |LEETECLA aAlfa;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     nSwGrid = 2;
     |FOCOTECLADO nGrid2;
|FPRC;

|PROCESO Evnt2;
     |SI FSalida = 1; |Y nSwGrid = 0;
         nSwGrid = 2;
     |FINSI;

     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#n43m0002.=;

         |HAZ EnablaBtnCont;

         |SI nSwGrid = 11;  |ACABA;  |FINSI;

         #n43w0011#0 = #n43m0002#0;
         #n43w0011#1 = #n43m0002#1;
         #n43w0011#2 = #n43m0002#2;
         #n43w0011#3 = #n43m0002#3;
         #n43w0011#4 = #n43m0002#4;
         #n43w0011#5 = #n43m0002#5;
         #n43w0011#6 = 1;
         |LEE 000#n43w0011.=;

         |REFRESCACONTROL nGrid11;
     |FINSI;

     |SI FSalida = 4;
         nSwGrid = 2;
     |FINSI;
|FPRC;

|PROCESO CargaReg1;
     |SI #n43m0002#13 = "1";
         #n43w0011#9  = #n43m0002#30;
         #n43w0011#10 = #n43m0002#31;

         |SI #n43w0011#9  = "            ";
             #n43w0011#9  = #n43m0105#5;
         |FINSI;

         eaCuenta = #n43w0011#9;  |HAZ LeeCuenta;

         #n43w0011#9  = eaCuenta;
         #n43w0011#10 = eaNCuenta;
         #n43m0002#30 = #n43w0011#9;
         #n43m0002#31 = #n43w0011#10;
     |FINSI;

     |SI #n43m0002#13 = "2";
         #n43w0011#8  = #n43m0002#30;
         #n43w0011#10 = #n43m0002#31;

         |SI #n43w0011#8  = "            ";
             #n43w0011#8  = #n43m0105#5;
         |FINSI;

         eaCuenta = #n43w0011#8;  |HAZ LeeCuenta;

         #n43w0011#8  = eaCuenta;
         #n43w0011#10 = eaNCuenta;
         #n43m0002#30 = #n43w0011#8;
         #n43m0002#31 = #n43w0011#10;
     |FINSI;

     #n43w0011#11 = #n43m0002#15;
     #n43w0011#12 = #n43m0002#32;
     #n43w0011#13 = #n43m0002#33;
     |SI #n43w0011#12 = 0;
         #n43w0011#13 = "Concepto no definido";
     |FINSI;

     #n43w0011#7  = #n43m0002#28;
     #n43w0011#14 = #n43m0002#38;
     #n43w0011#15 = #n43m0002#39;
|FPRC;

|PROCESO CargaReg2;
     |SI #n43m0002#13 = "2";
         #n43w0011#9  = #n43m0002#34;
         #n43w0011#10 = #n43m0002#35;

         |SI #n43w0011#9  = "            ";
             #n43w0011#9  = "S/Contenido";
             #n43w0011#10 = "Cuenta no configurada";
         |FINSI;
     |FINSI;

     |SI #n43m0002#13 = "1";
         #n43w0011#8  = #n43m0002#34;
         #n43w0011#10 = #n43m0002#35;

         |SI #n43w0011#8  = "            ";
             #n43w0011#8  = "S/Contenido";
             #n43w0011#10 = "Cuenta no configurada";
         |FINSI;
     |FINSI;

     #n43w0011#11 = #n43m0002#15;
     #n43w0011#12 = #n43m0002#36;
     #n43w0011#13 = #n43m0002#37;
     |SI #n43w0011#12 = 0;
         #n43w0011#13 = "Concepto no definido";
     |FINSI;

     #n43w0011#7  = #n43m0002#28;
     #n43w0011#14 = #n43m0002#38;
     #n43w0011#15 = #n43m0002#39;
|FPRC;

|PROCESO n43m0002;
     nConta = nConta + 1;
     nResto = nConta $ 2;

     aColor = eaMarengo;
     aFondo = eaAzulOscuro;
     |SI nResto = 0;
         aFondo = eaAzulClaro;
     |FINSI;

     |DDEFECTO #n43w0011;
     #n43w0011#0  = #n43m0002#0;
     #n43w0011#1  = #n43m0002#1;
     #n43w0011#2  = #n43m0002#2;
     #n43w0011#3  = #n43m0002#3;
     #n43w0011#4  = #n43m0002#4;
     #n43w0011#5  = #n43m0002#5;
     #n43w0011#6  = 1;

     |HAZ CargaReg1;

     #n43w0011#16 = aColor + ";" + aFondo;

     |GRABA 020#n43w0011.n;
     |LIBERA #n43w0011;

     |DDEFECTO #n43w0011;
     #n43w0011#0  = #n43m0002#0;
     #n43w0011#1  = #n43m0002#1;
     #n43w0011#2  = #n43m0002#2;
     #n43w0011#3  = #n43m0002#3;
     #n43w0011#4  = #n43m0002#4;
     #n43w0011#5  = #n43m0002#5;
     #n43w0011#6  = 2;

     |HAZ CargaReg2;

     #n43w0011#16 = aColor + ";" + aFondo;

     |GRABA 020#n43w0011.n;
     |LIBERA #n43w0011;

     #n43m0002#40 = "";
     |SI #n43m0002#29 ! 0;
         #n43m0002#40 = eaMarengo + ";" + eaVerde;
     |FINSI;

     |GRABA 020#n43m0002.a;
     |LIBERA #n43m0002;
|FPRC;

|DEFBUCLE n43m0002;
     #n43m0002#1;
     ;
     #n43m0105#3, #n43m0105#0, #n43m0105#1, #n43m0105#2, "01.01.0000",    1;
     #n43m0105#3, #n43m0105#0, #n43m0105#1, #n43m0105#2, "31.12.2999", 9999;
     ;
     NULL, n43m0002;
|FIN;

|PROCESO ModContagen;
     |SI #n43m0002#29 ! 0;
         |CONFI "0000NEl movimiento est  contabilizado, quiere borrar la contabilizaci¢n y modificar los datos contables";
         |SI FSalida ! 0;  |ACABA;  |FINSI;
     |FINSI;

     enOk   = 0;
     aAlfa = #n43m0002#8 % 402;   enPer = aAlfa;
     aAlfa = #n43m0002#8 % -102;  enEje = aAlfa;
     |HAZ BuscaRegCanempre;

     |SI enOk = 0;
         |MENAV "0000No existe una contabilidad definida con este ejercicio";
         |ACABA;
     |FINSI;

     |VENTANA 0501, 0501, -1, -1, "";
     n1Vent = FSalida;

     efOpe = #n43m0002#4;
     enMov = #n43m0002#5;
     aEjec = ":contagen/x43z0001 canempr1 " + (("00000" + #n43m0001#0) % -105) + enPer;
     |SUB_EJECUTA aEjec;

     |FINVENTANA n1Vent;

     |LEE 000#n43m0002.=;

     #n43w0011#0  = #n43m0002#0;
     #n43w0011#1  = #n43m0002#1;
     #n43w0011#2  = #n43m0002#2;
     #n43w0011#3  = #n43m0002#3;
     #n43w0011#4  = #n43m0002#4;
     #n43w0011#5  = #n43m0002#5;
     #n43w0011#6  = 1;
     |LEE 000#n43w0011.=;
     |SI FSalida = 0;
         |HAZ CargaReg1;

         |GRABA 000#n43w0011.a;
     |FINSI;

     #n43w0011#0  = #n43m0002#0;
     #n43w0011#1  = #n43m0002#1;
     #n43w0011#2  = #n43m0002#2;
     #n43w0011#3  = #n43m0002#3;
     #n43w0011#4  = #n43m0002#4;
     #n43w0011#5  = #n43m0002#5;
     #n43w0011#6  = 2;
     |LEE 000#n43w0011.=;
     |SI FSalida = 0;
         |HAZ CargaReg2;

         |GRABA 000#n43w0011.a;
     |FINSI;

    |REFRESCACONTROL nGrid2;
|FPRC;

|PROCESO ModAgicont;
|FPRC;

|PROCESO ModAsiento;
     |SI eaPaq = "BASICA";
         |HAZ ModContagen;
     |FINSI;

     |SI eaPaq = "AGICLI";
         |HAZ ModAgicont;
     |FINSI;

     nSwGrid = 2;
     |REFRESCACONTROL nGrid2;
     |FOCOTECLADO nGrid2;
|FPRC;

|PROCESO ConContagen;
     enOk   = 0;
     aAlfa = #n43m0002#8 % 402;   enPer = aAlfa;
     aAlfa = #n43m0002#8 % -102;  enEje = aAlfa;
     |HAZ BuscaRegCanempre;

     |SI enOk = 0;
         |MENAV "0000No existe una contabilidad definida con este ejercicio";
         |ACABA;
     |FINSI;

     |VENTANA 0501, 0501, -1, -1, "";
     n1Vent = FSalida;

     efOpe = #n43m0002#4;
     enMov = #n43m0002#5;
     aEjec = ":contagen/x43z0002 canempr1 " + (("00000" + #n43m0001#0) % -105) + enPer;
     |SUB_EJECUTA aEjec;

     |FINVENTANA n1Vent;

     |LEE 101#n43m0002.=;
     |SI FSalida = 0;
         #n43m0002#29 = enDoc;

         |SI #n43m0002#29 ! 0;
             #n43m0002#40 = eaMarengo + ";" + eaVerde;
         |FINSI;

         |GRABA 020#n43m0002.a;
         |LIBERA #n43m0002;
     |FINSI;

     |REFRESCACONTROL nGrid2;
|FPRC;

|PROCESO ConAgicont;
|FPRC;

|PROCESO Contabilizar;
     |SI eaPaq = "BASICA";
         |HAZ ConContagen;
     |FINSI;

     |SI eaPaq = "AGICLI";
         |HAZ ConAgicont;
     |FINSI;

     nSwGrid = 2;
     |REFRESCACONTROL nGrid2;
     |FOCOTECLADO nGrid2;
|FPRC;

|PROCESO Reglas;
     |VENTANA 0501, 0501, -1, 16, "";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |PTEC 802; |PAUSA;

     |SUB_EJECUTA "n43z0007";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     nSwGrid = 2;
     |FOCOTECLADO nGrid2;
|FPRC;

|PROCESO n43w0011B;
     |BORRA 020#n43w0011.a;
     |LIBERA #n43w0011;
|FPRC;

|DEFBUCLE n43w0011B;
     #n43w0011#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, n43w0011B;
|FIN;

|PROCESO EjecutarReglas;
     |VENTANA 0501, 0501, -1, 16, "";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |PTEC 802; |PAUSA;

     |SUB_EJECUTA "n43z0009";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |VENTANA 0501, 0540, -1, 16, "Procesando informaci¢n";
     n0Vent = FSalida;
     |PTEC 802; |PAUSA;

     nConta = 0;
     |BUCLE n43w0011B;
     |BUCLE n43m0002;

     |FINVENTANA n0Vent;

     |REFRESCACONTROL nGrid11;

     nSwGrid = 2;
     |FOCOTECLADO nGrid2;
|FPRC;

|PROGRAMA;
     aAlfa = "Propuesta ";
     aAlfa = aAlfa  + "(Empresa: " + (("00000" + #n43m0001#0) % -105);
     aAlfa = aAlfa  + " Entidad: " + #n43m0002#1;
     aAlfa = aAlfa  + " Oficina: " + #n43m0002#2;
     aAlfa = aAlfa  + " Cuenta: " + #n43m0002#3;
     aAlfa = aAlfa  + ")";
     |VENTANA 0501, 3799, -1, 16, aAlfa;
     n0Vent = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Consulta", 1602, 1612, ConsMov;
     nBtnCMov = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Modificar asiento", 1614, 1630, ModAsiento;
     nBtnMAsi = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Contabilizar", 1632, 1644, Contabilizar;
     nBtnCont = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Reglas", 1688, 1698, Reglas;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Ejecutar reglas", 1670, 1686, EjecutarReglas;

     |ESTADO_CONTROL nBtnCont, "DISABLE";

     nSwGrid  = 2;
     nRango   = 2 + 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#n43m0002, nRango, 0502, 1598, Baja2, Alta2, Evnt2;
     nGrid2 = FSalida;

     |LINEAL_SIMPLE #1#n43w0011, nRango, 1802, 3598, NULL, NULL, Evnt11;
     nGrid11 = FSalida;

     nSwGrid = 2;
     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid2;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FINVENTANA n0Vent;

     |PULSATECLA;
|FPRO;

|PROCESO T80;  |TIPO 80;
     |HAZ CargaColores;

     aFic = "n43m0002" + Usuario;
     |NOME_DAT #n43w0011#aFic#;
     |ABRE #n43w0011;  |CIERRA #n43w0011;  |DELINDEX #n43w0011;

     |ABRE #n43m0001;
     #n43m0001#0 = enEmp;
     |LEE 000#n43m0001.=;
     |SI FSalida ! 0;  |DDEFECTO #n43m0001;  |FINSI;
     |CIERRA #n43m0001;

     |ABRE #n43m0105;
     #n43m0105#0 = eaEnt;
     #n43m0105#1 = eaOfi;
     #n43m0105#2 = eaCta;
     |LEE 000#n43m0105.=;
     |SI FSalida ! 0;  |DDEFECTO #n43m0105;  |FINSI;
     |CIERRA #n43m0105;

     |ABRET #n43m0002;
     |ABRET #n43w0011;

     |VENTANA 0501, 0540, -1, 16, "Procesando informaci¢n";
     n0Vent = FSalida;
     |PTEC 802; |PAUSA;

     nConta = 0;
     |BUCLE n43m0002;

     |SUB_EJECUTA "n43z0009";

     nConta = 0;
     |BUCLE n43w0011B;
     |BUCLE n43m0002;

     |FINVENTANA n0Vent;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #n43m0002;
     |CIERRAT #n43w0011;
     |DELINDEX #n43w0011;
|FPRC;
