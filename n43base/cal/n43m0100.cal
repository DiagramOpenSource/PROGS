|FICHEROS;
     n43m0100;
     n43m0104;
|FIN;

|VARIABLES;
     nHandle             = 0;
     nLong               = 0;
     nCampo              = 0;
     nCaracter           = 0;
     nPos                = 0;

     aAlfa               = "";
     aBase               = "";
     aAbre               = "";
     aCadena             = "";
     aLong               = "";
     aTab                = "";
     aCarac1             = "";
     aCampoA             = "";
     aCampoB             = "";
     aCampoC             = "";
|FIN;

|PROGRAMA;
     |CONSULTA_CLAVE #1#n43m0100;
|FPRO;

|PROCESO GrabaReg;
     |QBF aCampoA;
     |QBF aCampoB;

     |SI aCampoA = "";  |ACABA;  |FINSI;

     #n43m0100#0 = aCampoA;
     |LEE 000#n43m0100.=;
     |SI FSalida ! 0;
         |DDEFECTO #n43m0100;
         #n43m0100#0 = aCampoA;
         |GRABA 020#n43m0100.b;
     |FINSI;

     #n43m0100#1 = aCampoB;

     |GRABA 020#n43m0100.a;
     |LIBERA #n43m0100;
|FPRC;

|PROCESO GrabaReg104;
     |QBF aCampoA;
     |QBF aCampoB;
     |QBF aCampoC;

     |SI aCampoA = "";  |ACABA;  |FINSI;

     aCampoA = ("0000" + aCampoA) % -104;

     #n43m0104#0 = aCampoA;
     #n43m0104#1 = aCampoB;
     |LEE 000#n43m0104.=;
     |SI FSalida ! 0;
         |DDEFECTO #n43m0104;
         #n43m0104#0 = aCampoA;
         #n43m0104#1 = aCampoB;
         |GRABA 020#n43m0104.b;
     |FINSI;

     #n43m0104#2 = aCampoC > "";

     |GRABA 020#n43m0104.a;
     |LIBERA #n43m0104;
|FPRC;

|PROCESO RecogeCSV;
     |DBASE aBase;

     aAbre = aBase + "documentos/patrones/conceptoscomunes.csv";
     |XABRE "", aAbre, nHandle;
     |PARA;  |SI FSalida ] 0;  |HACIENDO;
          |XLEE nHandle, 250, aAlfa;
          |SI FSalida < 0;  |SAL;  |FINSI;

          aCampoA  = "";
          aCampoB  = "";

          aCadena = aAlfa;  |QBF aCadena;
          aLong   = aCadena % 0;
          nLong   = aLong;
          nCampo  = 1;
          aTab    = ";";

          |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
                nPos    = (100 * nCaracter) + 1;
                aCarac1 = aCadena % nPos;
                |SI aCarac1 = aTab;
                    nCampo = nCampo + 1;
                |SINO;
                    |SI nCampo = 1;  aCampoA  = aCampoA  + aCarac1;  |FINSI;
                    |SI nCampo = 2;  aCampoB  = aCampoB  + aCarac1;  |FINSI;

                    |SI nCampo > 2;  |SAL;  |FINSI;
                |FINSI;
          |SIGUE;

          |HAZ GrabaReg;
     |SIGUE;
     |XCIERRA nHandle;

     aAbre = aBase + "documentos/patrones/conceptospropios.csv";
     |XABRE "", aAbre, nHandle;
     |PARA;  |SI FSalida ] 0;  |HACIENDO;
          |XLEE nHandle, 250, aAlfa;
          |SI FSalida < 0;  |SAL;  |FINSI;

          aCampoA  = "";
          aCampoB  = "";
          aCampoC  = "";

          aCadena = aAlfa;  |QBF aCadena;
          aLong   = aCadena % 0;
          nLong   = aLong;
          nCampo  = 1;
          aTab    = ";";

          |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
                nPos    = (100 * nCaracter) + 1;
                aCarac1 = aCadena % nPos;
                |SI aCarac1 = aTab;
                    nCampo = nCampo + 1;
                |SINO;
                    |SI nCampo = 1;  aCampoA  = aCampoA  + aCarac1;  |FINSI;
                    |SI nCampo = 2;  aCampoB  = aCampoB  + aCarac1;  |FINSI;
                    |SI nCampo = 3;  aCampoC  = aCampoC  + aCarac1;  |FINSI;

                    |SI nCampo > 3;  |SAL;  |FINSI;
                |FINSI;
          |SIGUE;

          |HAZ GrabaReg104;
     |SIGUE;
     |XCIERRA nHandle;
|FPRC;

|PROCESO T80;  |TIPO 80;
     |ABRET #n43m0100;

     |LEE 000#n43m0100.p;
     |SI FSalida ! 0;
         |ABRET #n43m0104;
         |HAZ RecogeCSV;
         |CIERRAT #n43m0104;
     |FINSI;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #n43m0100;
|FPRC;
