|FICHEROS;
     n43m0001;
     n43m0002;

     canempre@;
     cacuenta@;
     dsmom030@;
|FIN;

|VARIABLES;
     aAlfa                = "";
     aBase                = "";
     aMas                 = "";
     aFic                 = "";

     &eaPaq               = "";
     &eaCuenta            = "";
     &eaNCuenta           = "";
     &enConcepto          = 0;
     &eaConcepto          = "";
     &enEje               = 0;
     &enPer               = 0;
     &enOk                = 0;
     &eaDep               = "";
     &eaSubDep            = "";
|FIN;

|PROCESO LeeCanempre;
     |SELECT #4#canempre@;
     #canempre@#2  = #n43m0001#0;
     #canempre@#26 = enEje;
     |LEE 000#canempre@.=;
     |SI FSalida = 0;
         |SI #canempre@#11 = 1;
             enPer = #canempre@#3;

             |SI #canempre@#24 = "S";  eaDep    = #canempre@#30;  |FINSI;
             |SI #canempre@#22 = "S";  eaSubDep = #canempre@#31;  |FINSI;

             enOk  = 1;  |ACABA;
         |FINSI;

         |SI enPer ] #canempre@#11;
             enPer = #canempre@#3;

             |SI #canempre@#24 = "S";  eaDep    = #canempre@#30;  |FINSI;
             |SI #canempre@#22 = "S";  eaSubDep = #canempre@#31;  |FINSI;

             enOk  = 1;  |ACABA;
         |FINSI;
     |FINSI;

     #canempre@#2  = #n43m0001#0;
     #canempre@#26 = enEje - 1;
     |LEE 000#canempre@.=;
     |SI FSalida = 0;
         |SI #canempre@#11 = 1;
             |ACABA;
         |FINSI;

         |SI enPer [ #canempre@#12;
             enPer = #canempre@#3;

             |SI #canempre@#24 = "S";  eaDep    = #canempre@#30;  |FINSI;
             |SI #canempre@#22 = "S";  eaSubDep = #canempre@#31;  |FINSI;

             enOk  = 1;  |ACABA;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaRegCanempre;
     |DBASS aBase;  |QBF aBase;
     aMas = aBase + "contagen/def/canempre.mas";
     |CARGA_DEF aMas, canempre@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #canempre@;

     eaDep    = "";
     eaSubDep = "";
     |HAZ LeeCanempre;

     |CIERRA #canempre@;
     |DESCARGA_DEF #canempre@;
|FPRC;

|PROCESO LeeCuentaContagen;
     enOk  = 0;
     aAlfa = #n43m0002#8 % 402;   enPer = aAlfa;
     aAlfa = #n43m0002#8 % -102;  enEje = aAlfa;
     |HAZ BuscaRegCanempre;

     |SI enOk = 0;  |ACABA;  |FINSI;

     |DBASS aBase;  |QBF aBase;
     aMas = aBase + "contagen/def/cacuenta.mas";
     |CARGA_DEF aMas, cacuenta@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aFic = aBase + "contagen/fich/" + (("00000" + #n43m0001#0) % -105) + enPer + "/";
     |PATH_DAT #cacuenta@#aFic#;

     |ABRE #cacuenta@;
     #cacuenta@#0 = eaCuenta;
     |LEE 000#cacuenta@.=;
     |SI FSalida ! 0;  |DDEFECTO #cacuenta@;  |FINSI;
     |CIERRA #cacuenta@;

     eaCuenta  = #cacuenta@#0;   |QBF eaCuenta;
     eaNCuenta = #cacuenta@#2;   |QBF eaNCuenta;

     |DESCARGA_DEF #cacuenta@;

     |SI eaCuenta = "";
         eaCuenta  = "S/Contenido";
         eaNCuenta = "Cuenta no configurada";
     |FINSI;

     |SI eaNCuenta = "";
         eaNCuenta = "Sin descripci¢n";
     |FINSI;
|FPRC;

|PROCESO LeeCuentaAgicont;
|FPRC;

|PROCESO LeeCuenta;
     |SI eaPaq = "BASICA";
         |HAZ LeeCuentaContagen;
     |FINSI;

     |SI eaPaq = "AGICLI";
         |HAZ LeeCuentaAgicont;
     |FINSI;
|FPRC;

|PROCESO LeeConceptoContagen;
     |DBASS aBase;  |QBF aBase;
     aMas = aBase + "modelos/def/dsmom030.mas";
     |CARGA_DEF aMas, dsmom030@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aFic = aBase + "modelos/fich/";
     |PATH_DAT #dsmom030@#aFic#;

     |ABRE #dsmom030@;
     #dsmom030@#0 = enConcepto;
     |LEE 000#dsmom030@.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom030@;  |FINSI;
     |CIERRA #dsmom030@;

     enConcepto = #dsmom030@#0;
     eaConcepto = #dsmom030@#1;

     |DESCARGA_DEF #dsmom030@;
|FPRC;

|PROCESO LeeConceptoAgicont;
|FPRC;

|PROCESO LeeConcepto;
     |SI eaPaq = "BASICA";
         |HAZ LeeConceptoContagen;
     |FINSI;

     |SI eaPaq = "AGICLI";
         |HAZ LeeConceptoAgicont;
     |FINSI;
|FPRC;
