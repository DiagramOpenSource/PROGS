|FICHEROS;
     n43m0001;
     n43m0102;
     n43m0106;
     n43m0107;

     n107der@ #1;
     n107izq@ #2;
|FIN;

|VARIABLES;
     n0Vent              = 0;
     n1Vent              = 0;
     nRango              = 0;
     nGridDer            = 0;
     nGridIzq            = 0;
     nBtnIzq             = 0;
     nBtnDer             = 0;
     nBtnSub             = 0;
     nBtnBaj             = 0;
     nBtnEdi             = 0;
     nBtnEli             = 0;
     nCmp                = 0;
     nOrden              = 0;
     nOrden1             = 0;
     nOrden2             = 0;
     nReg                = 0;
     nCmp1               = 0;
     nCmp2               = 0;

     aBase               = "";
     aMas                = "";
     aAlfa               = "";
     aTecla              = "";
     aEsc1               = "";
     aEsc2               = "";
     aRetu               = "";
     aQGrid              = "";

 {-1}aVent               = "";
     aVent1              = 0;
     aVent2              = 0;
     aVent3              = 0;
     aVent4              = 0;
     aVent5              = "";

     &enEmp              = 0;
     &eaEnt              = "";
     &enRegla            = 0;
|FIN;

|PROCESO BajaIzq;
     #n107izq@#0 = #n43m0001#0;
     #n107izq@#1 = #n43m0102#0;
     #n107izq@#3 = "S";
     #n107izq@#4 = 0;
|FPRC;

|PROCESO AltaIzq;
     #n107izq@#0 = #n43m0001#0;
     #n107izq@#1 = #n43m0102#0;
     #n107izq@#3 = "S";
     #n107izq@#4 = 9999;
|FPRC;

|PROCESO BajaDer;
     #n107der@#0 = #n43m0001#0;
     #n107der@#1 = #n43m0102#0;
     #n107der@#3 = "N";
     #n107der@#4 = 0;
|FPRC;

|PROCESO AltaDer;
     #n107der@#0 = #n43m0001#0;
     #n107der@#1 = #n43m0102#0;
     #n107der@#3 = "N";
     #n107der@#4 = 9999;
|FPRC;

|PROCESO EvntIzq;
     |SI FSalida = 1; |O FSalida = 2;
         |LEE 000#n107izq@.=;

         |ESTADO_CONTROL nBtnIzq, "DISABLE";
         |ESTADO_CONTROL nBtnDer, "ENABLE";
         |ESTADO_CONTROL nBtnSub, "ENABLE";
         |ESTADO_CONTROL nBtnBaj, "ENABLE";
         |ESTADO_CONTROL nBtnEdi, "ENABLE";
         |ESTADO_CONTROL nBtnEli, "ENABLE";

         aQGrid = "IZQ";
     |FINSI;
|FPRC;

|PROCESO EvntDer;
     |SI FSalida = 1; |O FSalida = 2;
         |LEE 000#n107der@.=;

         |ESTADO_CONTROL nBtnIzq, "ENABLE";
         |ESTADO_CONTROL nBtnDer, "DISABLE";
         |ESTADO_CONTROL nBtnSub, "ENABLE";
         |ESTADO_CONTROL nBtnBaj, "ENABLE";
         |ESTADO_CONTROL nBtnEdi, "ENABLE";
         |ESTADO_CONTROL nBtnEli, "ENABLE";

         aQGrid = "DER";
     |FINSI;
|FPRC;

|PROCESO AlaIzq;
     |LEE 101#n107der@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;


     nOrden1 = #n107der@#4;
     nOrden  = 1;

     |SELECT #2#n107izq@;
     #n107izq@#0 = #n43m0001#0;
     #n107izq@#1 = #n43m0102#0;
     #n107izq@#3 = "S";
     #n107izq@#4 = 9999;
     |LEE 000#n107izq@.];
     |SI FSalida = 0;
         |LEE 000#n107izq@.a;
     |SINO;
         |LEE 000#n107izq@.u;
     |FINSI;

     |SI FSalida = 0;  |Y #n107izq@#0 = #n43m0001#0;
                       |Y #n107izq@#1 = #n43m0102#0;
                       |Y #n107izq@#3 = "S";

         nOrden = #n107izq@#4 + 1;
         |SI nOrden > 9999;  nOrden = 9999;  |FINSI;
     |FINSI;

     #n107der@#3 = "S";
     #n107der@#4 = nOrden;
     |GRABA 020#n107der@.a;
     |LIBERA #n107der@;

     #n107der@#3 = "N";
     #n107der@#4 = nOrden1;
     |LEE 000#n107der@.];

     |REFRESCACONTROL nGridIzq;  |PULSATECLA;
     |REFRESCACONTROL nGridDer;  |PULSATECLA;

     |FOCOTECLADO nGridDer;      |PULSATECLA;
|FPRC;

|PROCESO AlaDer;
     |LEE 101#n107izq@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nOrden1 = #n107izq@#4;
     nOrden  = 1;

     |SELECT #2#n107der@;
     #n107der@#0 = #n43m0001#0;
     #n107der@#1 = #n43m0102#0;
     #n107der@#3 = "N";
     #n107der@#4 = 9999;
     |LEE 000#n107der@.];
     |SI FSalida = 0;
         |LEE 000#n107der@.a;
     |SINO;
         |LEE 000#n107der@.u;
     |FINSI;

     |SI FSalida = 0;  |Y #n107der@#0 = #n43m0001#0;
                       |Y #n107der@#1 = #n43m0102#0;
                       |Y #n107der@#3 = "N";
         nOrden = #n107der@#4 + 1;
         |SI nOrden > 9999;  nOrden = 9999;  |FINSI;
     |FINSI;

     #n107izq@#3 = "N";
     #n107izq@#4 = nOrden;
     |GRABA 020#n107izq@.a;
     |LIBERA #n107izq@;

     #n107izq@#3 = "S";
     #n107izq@#4 = nOrden1;
     |LEE 000#n107izq@.];

     |REFRESCACONTROL nGridDer;  |PULSATECLA;
     |REFRESCACONTROL nGridIzq;  |PULSATECLA;

     |FOCOTECLADO nGridIzq;      |PULSATECLA;
|FPRC;

|PROCESO ParribaIzq;
     |LEE 000#n107izq@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nReg    = #n107izq@#2;
     nOrden1 = #n107izq@#4;
     |LEE 101#n107izq@.a;
     |SI FSalida ! 0;  |O #n107izq@#0 ! #n43m0001#0;
                       |O #n107izq@#1 ! #n43m0102#0;
                       |O #n107izq@#3 ! "S";
         |ACABA;
     |FINSI;

     nOrden2 = #n107izq@#4;

     #n107izq@#4 = nOrden1;
     |GRABA 020#n107izq@.a;
     |LIBERA #n107izq@;

     |SELECT #1#n107izq@;
     #n107izq@#0 = #n43m0001#0;
     #n107izq@#1 = #n43m0102#0;
     #n107izq@#2 = nReg;
     |LEE 101#n107izq@.=;

     #n107izq@#4 = nOrden2;
     |GRABA 020#n107izq@.a;
     |LIBERA #n107izq@;

     |SELECT #2#n107izq@;
     |LEE 000#n107izq@.=;

     |REFRESCACONTROL nGridDer;   |PULSATECLA;
     |REFRESCACONTROL nGridIzq;   |PULSATECLA;

     |FOCOTECLADO nGridIzq;       |PULSATECLA;
|FPRC;

|PROCESO ParribaDer;
     |LEE 000#n107der@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nReg    = #n107der@#2;
     nOrden1 = #n107der@#4;
     |LEE 101#n107der@.a;
     |SI FSalida ! 0;  |O #n107der@#0 ! #n43m0001#0;
                       |O #n107der@#1 ! #n43m0102#0;
                       |O #n107der@#3 ! "N";
         |ACABA;
     |FINSI;

     nOrden2 = #n107der@#4;

     #n107der@#4 = nOrden1;
     |GRABA 020#n107der@.a;
     |LIBERA #n107der@;

     |SELECT #1#n107der@;
     #n107der@#0 = #n43m0001#0;
     #n107der@#1 = #n43m0102#0;
     #n107der@#2 = nReg;
     |LEE 101#n107der@.=;

     #n107der@#4 = nOrden2;
     |GRABA 020#n107der@.a;
     |LIBERA #n107der@;

     |SELECT #2#n107der@;
     |LEE 000#n107der@.=;

     |REFRESCACONTROL nGridIzq;   |PULSATECLA;
     |REFRESCACONTROL nGridDer;   |PULSATECLA;

     |FOCOTECLADO nGridDer;       |PULSATECLA;
|FPRC;

|PROCESO Parriba;
     |SI aQGrid = "IZQ";
         |HAZ ParribaIzq;

         |FOCOTECLADO nGridIzq;
     |FINSI;

     |SI aQGrid = "DER";
         |HAZ ParribaDer;

         |FOCOTECLADO nGridDer;
     |FINSI;
|FPRC;

|PROCESO PabajoIzq;
     |LEE 000#n107izq@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nReg    = #n107izq@#2;
     nOrden1 = #n107izq@#4;
     |LEE 101#n107izq@.s;
     |SI FSalida ! 0;  |O #n107izq@#0 ! #n43m0001#0;
                       |O #n107izq@#1 ! #n43m0102#0;
                       |O #n107izq@#3 ! "S";
         |ACABA;
     |FINSI;

     nOrden2 = #n107izq@#4;

     #n107izq@#4 = nOrden1;
     |GRABA 020#n107izq@.a;
     |LIBERA #n107izq@;

     |SELECT #1#n107izq@;
     #n107izq@#0 = #n43m0001#0;
     #n107izq@#1 = #n43m0102#0;
     #n107izq@#2 = nReg;
     |LEE 101#n107izq@.=;

     #n107izq@#4 = nOrden2;
     |GRABA 020#n107izq@.a;
     |LIBERA #n107izq@;

     |SELECT #2#n107izq@;
     |LEE 000#n107izq@.=;

     |REFRESCACONTROL nGridDer;  |PULSATECLA;
     |REFRESCACONTROL nGridIzq;  |PULSATECLA;

     |FOCOTECLADO nGridIzq;      |PULSATECLA;
|FPRC;

|PROCESO PabajoDer;
     |LEE 000#n107der@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nReg    = #n107der@#2;
     nOrden1 = #n107der@#4;
     |LEE 101#n107der@.s;
     |SI FSalida ! 0;  |O #n107der@#0 ! #n43m0001#0;
                       |O #n107der@#1 ! #n43m0102#0;
                       |O #n107der@#3 ! "N";
         |ACABA;
     |FINSI;

     nOrden2 = #n107der@#4;

     #n107der@#4 = nOrden1;
     |GRABA 020#n107der@.a;
     |LIBERA #n107der@;

     |SELECT #1#n107der@;
     #n107der@#0 = #n43m0001#0;
     #n107der@#1 = #n43m0102#0;
     #n107der@#2 = nReg;
     |LEE 101#n107der@.=;

     #n107der@#4 = nOrden2;
     |GRABA 020#n107der@.a;
     |LIBERA #n107der@;

     |SELECT #2#n107der@;
     |LEE 000#n107der@.=;

     |REFRESCACONTROL nGridIzq;  |PULSATECLA;
     |REFRESCACONTROL nGridDer;  |PULSATECLA;

     |FOCOTECLADO nGridDer;      |PULSATECLA;
|FPRC;

|PROCESO Pabajo;
     |SI aQGrid = "IZQ";
         |HAZ PabajoIzq;

         |FOCOTECLADO nGridIzq;
     |FINSI;

     |SI aQGrid = "DER";
         |HAZ PabajoDer;

         |FOCOTECLADO nGridDer;
     |FINSI;
|FPRC;

|PROCESO n107izq_Orden;
     nOrden = nOrden + 1;

     #n43m0107#0 = #n107izq@#0;
     #n43m0107#1 = #n107izq@#1;
     #n43m0107#2 = #n107izq@#2;
     |LEE 101#n43m0107.=
     |SI FSalida = 0;
         #n43m0107#4 = nOrden;
         |GRABA 020#n43m0107.a;
         |LIBERA #n43m0107;
     |FINSI;
|FPRC;

|PROCESO RenumeraIzq;
     nOrden = 0;
     #n107izq@#0 = #n43m0001#0;
     #n107izq@#1 = #n43m0102#0;
     #n107izq@#3 = "S";
     #n107izq@#4 = 1;
     |LEE 000#n107izq@.];
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #n107izq@#0 ! #n43m0001#0;
           |O #n107izq@#1 ! #n43m0102#0;
               |SAL;
          |FINSI;

          |SI #n107izq@#3 ! "S";
               |SAL;
          |FINSI;

          |HAZ n107izq_Orden;

          |LEE 000#n107izq@.s;
     |SIGUE;
|FPRC;

|PROCESO n107der_Orden;
     nOrden = nOrden + 1;

     #n43m0107#0 = #n107der@#0;
     #n43m0107#1 = #n107der@#1;
     #n43m0107#2 = #n107der@#2;
     |LEE 101#n43m0107.=
     |SI FSalida = 0;
         #n43m0107#4 = nOrden;
         |GRABA 020#n43m0107.a;
         |LIBERA #n43m0107;
     |FINSI;
|FPRC;

|PROCESO RenumeraDer;
     nOrden = 0;
     #n107der@#0 = #n43m0001#0;
     #n107der@#1 = #n43m0102#0;
     #n107der@#3 = "N";
     #n107der@#4 = 1;
     |LEE 000#n107der@.];
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #n107der@#0 ! #n43m0001#0;
           |O #n107der@#1 ! #n43m0102#0;
              |SAL;
          |FINSI;

          |SI #n107der@#3 ! "N";
               |SAL;
          |FINSI;

          |HAZ n107der_Orden;

          |LEE 000#n107der@.s;
     |SIGUE;
|FPRC;

|PROCESO Crear;
     |VENTANA 0501, 0501, -1, 16, "";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |PTEC 802; |PAUSA;

     enRegla = 0;
     |SUB_EJECUTA "n43z0008";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |HAZ RenumeraIzq;

     |REFRESCACONTROL nGridIzq;  |PULSATECLA;
     |FOCOTECLADO nGridIzq;      |PULSATECLA;
|FPRC;

|PROCESO Editar;
     |VENTANA 0501, 0501, -1, 16, "";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |PTEC 802; |PAUSA;

     |SI aQGrid = "IZQ";  enRegla = #n107izq@#2;  |FINSI;
     |SI aQGrid = "DER";  enRegla = #n107der@#2;  |FINSI;

     |SUB_EJECUTA "n43z0008";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |SI aQGrid = "IZQ";
         |REFRESCACONTROL nGridIzq;  |PULSATECLA;
         |FOCOTECLADO nGridIzq;      |PULSATECLA;
     |FINSI;

     |SI aQGrid = "DER";
         |REFRESCACONTROL nGridDer;  |PULSATECLA;
         |FOCOTECLADO nGridDer;      |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO EliminaIzq;
     aAlfa = "0000NDesea eliminar la regla " + #n107izq@#5;  |QBF aAlfa;
     |CONFI aAlfa;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#n107izq@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BORRA 020#n107izq@.a;
     |LIBERA #n107izq@;
|FPRC;

|PROCESO EliminaDer;
     aAlfa = "0000NDesea eliminar la regla " + #n107der@#5;  |QBF aAlfa;
     |CONFI aAlfa;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#n107der@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BORRA 020#n107der@.a;
     |LIBERA #n107der@;
|FPRC;

|PROCESO Eliminar;
     |SI aQGrid = "IZQ";
         |HAZ EliminaIzq;

         |REFRESCACONTROL nGridIzq;   |PULSATECLA;

         |FOCOTECLADO nGridIzq;       |PULSATECLA;
     |FINSI;

     |SI aQGrid = "DER";
         |HAZ EliminaDer;

         |REFRESCACONTROL nGridDer;   |PULSATECLA;

         |FOCOTECLADO nGridDer;       |PULSATECLA;
     |FINSI;
|FPRC;

|PROGRAMA;
     aAlfa = "Reglas: Empresa " + (("00000" + #n43m0001#0) % -105) + " " + #n43m0001#1;  |QBF aAlfa;
     aAlfa = aAlfa + "/ Entidad " + #n43m0102#0 + " " + #n43m0102#1;  |QBF aAlfa;
     |VENTANA 0501, 3599, -1, 16, aAlfa;
     n0Vent = FSalida;

     |CONTROL_SIMPLE 0, "LABEL,{{16}}Reglas activas", 1002, 1047, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Reglas disponibles", 1058, 1099, NULL;

     |CONTROL_SIMPLE 0, "BOTON,Crear regla", 0602, 0715, Crear;

     |CONTROL_SIMPLE 0, "BOTON,Editar regla", 0618, 0731, Editar;
     nBtnEdi = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Eliminar regla", 0634, 0747, Eliminar;
     nBtnEli = FSalida;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}A¤adir", 1347, 1356, NULL;
     |CONTROL_SIMPLE 0, "BOTON,{{201}}", 1448, 1552, AlaIzq;
     nBtnIzq = FSalida;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}Eliminar", 1847, 1856, NULL;
     |CONTROL_SIMPLE 0, "BOTON,{{202}}", 1948, 2052, AlaDer;
     nBtnDer = FSalida;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}Subir", 2347, 2356, NULL;
     |CONTROL_SIMPLE 0, "BOTON,{{231}}", 2448, 2552, Parriba;
     nBtnSub = FSalida;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}Bajar", 2847, 2856, NULL;
     |CONTROL_SIMPLE 0, "BOTON,{{232}}", 2948, 3052, Pabajo;
     nBtnBaj = FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #2#n107izq@, nRango, 1102, 3342, BajaIzq, AltaIzq, EvntIzq;
     nGridIzq = FSalida;

     |LINEAL_SIMPLE #2#n107der@, nRango, 1158, 3398, BajaDer, AltaDer, EvntDer;
     nGridDer = FSalida;

     |PULSATECLA;

     |ESTADO_CONTROL nBtnEdi, "DISABLE";
     |ESTADO_CONTROL nBtnEli, "DISABLE";
     |ESTADO_CONTROL nBtnIzq, "DISABLE";
     |ESTADO_CONTROL nBtnDer, "DISABLE";
     |ESTADO_CONTROL nBtnSub, "DISABLE";
     |ESTADO_CONTROL nBtnBaj, "DISABLE";

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGridIzq;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FINVENTANA n0Vent;
|FPRO;

|PROCESO n43m0106;
     #n43m0107#0 = #n43m0001#0;
     |PARA nCmp1 = 0;  |SI nCmp1 [ 43;  |HACIENDO nCmp1 = nCmp1 + 1;
           nCmp2 = nCmp1 + 1;

           #n43m0107#nCmp2# = #n43m0106#nCmp1#;
     |SIGUE;

     |GRABA 020#n43m0107.n;
     |LIBERA #n43m0107;
|FPRC;

|DEFBUCLE n43m0106;
     #n43m0106#1;
     ;
     #n43m0102#0, 0000;
     #n43m0102#0, 9999;
     ;
     NULL, n43m0106;
|FIN;

|PROCESO T80;  |TIPO 80;
     |ABRE #n43m0001;
     #n43m0001#0 = enEmp;
     |LEE 000#n43m0001.=;
     |SI FSalida ! 0;  |DDEFECTO #n43m0001;  |FINSI;
     |CIERRA #n43m0001;

     |ABRE #n43m0102;
     #n43m0102#0 = eaEnt;
     |LEE 000#n43m0102.=;
     |SI FSalida ! 0;  |DDEFECTO #n43m0102;  |FINSI;
     |CIERRA #n43m0102;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/n43m0107.mas";
     |CARGA_DEF aMas, n107izq@;
     |CARGA_DEF aMas, n107der@;

     |ABRET #n43m0107;
     |ABRET #n107izq@;
     |ABRET #n107der@;

     #n43m0107#0 = #n43m0001#0;
     #n43m0107#1 = #n43m0102#0;
     #n43m0107#2 = 1;
     |LEE 101#n43m0107.];
     |SI FSalida ! 0;
         |BUCLE n43m0106;
     |FINSI;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |HAZ RenumeraIzq;
     |HAZ RenumeraDer;

     |CIERRAT #n43m0107;
     |CIERRAT #n107izq@;
     |CIERRAT #n107der@;

     |DESCARGA_DEF #n107der@;
     |DESCARGA_DEF #n107izq@;
|FPRC;
