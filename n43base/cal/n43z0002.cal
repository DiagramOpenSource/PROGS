|FICHEROS;
     n43m0001;
     n43m0002;
     n43m0003;
     n43m0004;

     n43m0100;
     n43m0101;
     n43m0102;
     n43m0103;
     n43m0104;
     n43m0105;
     n43m9000;
|FIN;

|VARIABLES;
     n1Vent              = 0;
     nLong               = 0;
     nCarac              = 0;
     nPos                = 0;
     nHandle             = 0;
     nVeces              = 0;
     nPorce              = 0;
     nReg                = 0;
     nCodImp             = 0;
     nCampo              = 0;
     nCmp                = 0;
     nCmp1               = 0;
     nCmp2               = 0;
     nCmp3               = 0;
     nCmp4               = 0;
     nTCampo             = 0;
     nMov                = 0;
     nOk                 = 0;
     nCheq               = 0;
     nHay                = 0;
     nTDeb               = 0;
     nTHab               = 0;
     nImpo               = 0;
     nRepe               = 0;
     nTRepe              = 0;
     nTGrab              = 0;
     nTRegi              = 0;

     aAlfa               = "";
     aAlfa1              = "";
     aCmp1               = "";
     aCmp2               = "";
     aCmp3               = "";
     aCmp4               = "";
     aCmp5               = "";
     aCmp6               = "";
     aCmp7               = "";
     aCmp8               = "";
     aCmp9               = "";
     aCmp10              = "";
     aCmp11              = "";
     aCmp12              = "";
     aCmp13              = "";
     aParam1             = "";
     aParam2             = "";
     aParam3             = "";
     aProg               = "";
     aFic                = "";
     aFicOri             = "";
     aFicBrowse          = "";
     aFicTmp             = "";
     aFicSub             = "";
     aVer1               = "";
     aVer2               = "";
     aOri                = "";
     aDes                = "";
     aBaseN43            = "";
     aPathLocal          = "";
     aPathDoc            = "";
     aLong               = "";
     aIP                 = "";
     aAbre               = "";
     aLinea              = "";
     aRuta               = "";
     aCaracter           = "";
     aVar                = "";
     aLee                = "";
     aC10                = "";
     aC13                = "";
     aCarac              = "";
     aQQ                 = "";
     aTipo               = "";
     aExt                = "";
     aHora               = "";
     aUsuario            = "";
     aPathPdt            = "";
     aPathRea            = "";
     aDir                = "";
     aInci               = "";

     fFecha              =  @;
     fFechaOpe           =  @;

     {1}aConte           = "";

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     &eaUnidadBasico     = "";
     &eaAlfa             = "";
     &enEmp              = 0;
     &eaEnt              = "";
     &eaOfi              = "";
     &eaNegro            = "";
     &eaRojo             = "";
|FIN;

|PROCESO AbreVtn;
     |VENTANA 0501, 0540, -1, 16, "Realizando la importaci¢n";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;
|FPRC;

|PROCESO CierraVtn;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|| Importacion de ficheros -------------------------------------------------

|PROCESO CopiaFichero;
     aOri = aAbre;
     aDes = aPathRea + aFic;
     |COPIA_FICHERO aOri, aDes;

     |FBORRA aOri;
|FPRC;

|PROCESO Graba9000;
     #n43m9000#0 = fFecha;
     #n43m9000#1 = aHora;
     #n43m9000#2 = aFicOri;
     #n43m9000#3 = 9999;
     |LEE 000#n43m9000.];
     |SI FSalida = 0;
         |LEE 000#n43m9000.a;
     |SINO;
         |LEE 000#n43m9000.u;
     |FINSI;

     aAlfa = #n43m9000#2;  |QBF aAlfa;
     nReg  = 1;
     |SI FSalida = 0;  |Y #n43m9000#0  = fFecha;
                       |Y #n43m9000#1  = aHora;
                       |Y aAlfa        = aFicOri;
         nReg = #n43m9000#3 + 1;
     |FINSI;


     |DDEFECTO #n43m9000;
     #n43m9000#0 = fFecha;
     #n43m9000#1 = aHora;
     #n43m9000#2 = aFicOri;
     #n43m9000#3 = nReg;
     #n43m9000#4 = aInci;

     |GRABA 020#n43m9000.n;
     |LIBERA #n43m9000;
|FPRC;

|PROCESO Tipo11Cheq;
     |DDEFECTO #n43m0004;

     nOk    = 0;
     aCmp2  = aLee % 304;
     aCmp3  = aLee % 704;
     aCmp4  = aLee % 1110;

     #n43m0102#0 = aCmp2;
     |LEE 000#n43m0102.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #n43m0103#0 = aCmp2;
     #n43m0103#1 = aCmp3;
     |LEE 000#n43m0103.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #n43m0105#0 = aCmp2;
     #n43m0105#1 = aCmp3;
     #n43m0105#2 = aCmp4;
     |LEE 000#n43m0105.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nHay = 1;
     nOk  = 1;
|FPRC;

|PROCESO Tipo11;
     || Registro de cabecera de cuenta

     nOk    = -1;
     nRepe  = 0;
     nTRegi = 0;
     nTGrab = 0;
     nTRepe = 0;

     aCmp2  = aLee % 304;
     aCmp3  = aLee % 704;
     aCmp4  = aLee % 1110;
     aCmp5  = aLee % 2106;
     aCmp6  = aLee % 2706;
     aCmp7  = aLee % 3301;
     aCmp8  = aLee % 3414;
     aCmp9  = aLee % 4803;
     aCmp10 = aLee % 5101;
     aCmp11 = aLee % 5226;
     aCmp12 = aLee % 7803;

     aCmp5  = (aCmp5 % 503) + "." + (aCmp5 % 302) + ".20" + (aCmp5 % 102);
     aCmp6  = (aCmp6 % 503) + "." + (aCmp6 % 302) + ".20" + (aCmp6 % 102);

     #n43m0102#0 = aCmp2;
     |LEE 000#n43m0102.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #n43m0103#0 = aCmp2;
     #n43m0103#1 = aCmp3;
     |LEE 000#n43m0103.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #n43m0105#0 = aCmp2;
     #n43m0105#1 = aCmp3;
     #n43m0105#2 = aCmp4;
     |LEE 000#n43m0105.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #n43m0004#0 = #n43m0105#3;
     #n43m0004#1 = #n43m0105#0;
     #n43m0004#2 = #n43m0105#1;
     #n43m0004#3 = #n43m0105#2;
     #n43m0004#4 = 9999;
     |LEE 000#n43m0004.];
     |SI FSalida = 0;
         |LEE 000#n43m0004.a;
     |SINO;
         |LEE 000#n43m0004.u;
     |FINSI;

     nCodImp = 1;
     |SI FSalida = 0;  |Y #n43m0004#0  = #n43m0105#3;
                       |Y #n43m0004#1  = #n43m0105#0;
                       |Y #n43m0004#2  = #n43m0105#1;
                       |Y #n43m0004#3  = #n43m0105#2;
         nCodImp = #n43m0004#4 + 1;
     |FINSI;

     |DDEFECTO #n43m0004;
     #n43m0004#0  = #n43m0105#3;
     #n43m0004#1  = #n43m0105#0;
     #n43m0004#2  = #n43m0105#1;
     #n43m0004#3  = #n43m0105#2;
     #n43m0004#4  = nCodImp;
     #n43m0004#5  = fFecha;
     #n43m0004#6  = aHora;
     #n43m0004#7  = "";
     #n43m0004#8  = aFicOri;
     #n43m0004#9  = aCmp5;
     #n43m0004#10 = aCmp6;
     #n43m0004#11 = aCmp7;
     #n43m0004#13 = aCmp8;
     #n43m0004#14 = aCmp9;
     #n43m0004#16 = aCmp10;
     #n43m0004#17 = aCmp11;
     #n43m0004#18 = aCmp12;

     #n43m0004#13 = #n43m0004#13 / 100;

     #n43m0004#15 = #n43m0101#1;

     |SI #n43m0004#11 = "1"; #n43m0004#12 = "Deudor";    |FINSI;
     |SI #n43m0004#11 = "2"; #n43m0004#12 = "Acreedor";  |FINSI;

     |GRABA 020#n43m0004.n;
     |LIBERA #n43m0004;

     nOk    = 0;
     nMov   = 0;
|FPRC;

|PROCESO Tipo22;
     || Registro principal de movimientos

     nTRegi = nTRegi + 1;

     aCmp2  = aLee % 304;
     aCmp3  = aLee % 704;
     aCmp4  = aLee % 1106;
     aCmp5  = aLee % 1706;
     aCmp6  = aLee % 2302;
     aCmp7  = aLee % 2503;
     aCmp8  = aLee % 2801;
     aCmp9  = aLee % 2914;
     aCmp10 = aLee % 4310;
     aCmp11 = aLee % 5328;

     aCmp4  = (aCmp4 % 503) + "." + (aCmp4 % 302) + ".20" + (aCmp4 % 102);
     aCmp5  = (aCmp5 % 503) + "." + (aCmp5 % 302) + ".20" + (aCmp5 % 102);

     fFechaOpe = aCmp4;

     #n43m0100#0  = aCmp6;
     |LEE 000#n43m0100.=;
     |SI FSalida ! 0;  |DDEFECTO #n43m0100;  |FINSI;

     |SELECT #2#n43m0002;
     #n43m0002#0  = #n43m0004#0;
     #n43m0002#1  = #n43m0004#1;
     #n43m0002#2  = #n43m0004#2;
     #n43m0002#3  = #n43m0004#3;
     #n43m0002#4  = fFechaOpe;
     #n43m0002#6  = aCmp2;
     #n43m0002#7  = aCmp3;
     #n43m0002#8  = aCmp5;
     #n43m0002#9  = aCmp6;
     #n43m0002#11 = aCmp7;
     #n43m0002#15 = aCmp9;
     #n43m0002#15 = #n43m0002#15 / 100;
     #n43m0002#16 = aCmp10;
     #n43m0002#17 = aCmp11;
     |LEE 000#n43m0002.=;
     |SI FSalida = 0;
         |SI #n43m0002#41 ! fFecha;  |O  #n43m0002#42 ! aHora;
             nRepe  = 1;
             nTRepe = nTRepe + 1;
             |ACABA;
         |FINSI;
     |FINSI;

     nTGrab = nTGrab + 1;
     nMov   = nMov + 1;

     |SELECT #1#n43m0002;

     |DDEFECTO #n43m0002;
     #n43m0002#0  = #n43m0004#0;
     #n43m0002#1  = #n43m0004#1;
     #n43m0002#2  = #n43m0004#2;
     #n43m0002#3  = #n43m0004#3;
     #n43m0002#4  = fFechaOpe;
     #n43m0002#5  = nMov;
     #n43m0002#6  = aCmp2;
     #n43m0002#7  = aCmp3;
     #n43m0002#8  = aCmp5;
     #n43m0002#9  = aCmp6;
     #n43m0002#11 = aCmp7;
     #n43m0002#13 = aCmp8;
     #n43m0002#15 = aCmp9;
     #n43m0002#16 = aCmp10;
     #n43m0002#17 = aCmp11;

     #n43m0002#10 = #n43m0100#1;
     #n43m0002#15 = #n43m0002#15 / 100;

     |SI #n43m0002#13 = "1";
         #n43m0002#14 = "Apuntes Debe";
     |FINSI;

     |SI #n43m0002#13 = "2";
         #n43m0002#14 = "Apuntes Haber";
     |FINSI;

     #n43m0104#0 = #n43m0002#1;
     #n43m0104#1 = #n43m0002#11;
     |LEE 000#n43m0104.=;
     |SI FSalida ! 0;
         |DDEFECTO #n43m0104;
         #n43m0104#0 = #n43m0002#1;
         #n43m0104#1 = #n43m0002#11;

         |GRABA 020#n43m0104.n;
         |LIBERA #n43m0104;
     |FINSI;

     #n43m0002#12 = #n43m0104#2;
     #n43m0002#41 = fFecha;
     #n43m0002#42 = aHora;

     |GRABA 020#n43m0002.n;
     |LIBERA #n43m0002;
|FPRC;

|PROCESO Tipo23;
     || Registro complementarios de conceptos hasta cinco movimientos

     aCmp2  = aLee % 302;
     aCmp3  = aLee % 576;

     #n43m0002#0  = #n43m0004#0;
     #n43m0002#1  = #n43m0004#1;
     #n43m0002#2  = #n43m0004#2;
     #n43m0002#3  = #n43m0004#3;
     #n43m0002#4  = fFechaOpe;
     #n43m0002#5  = nMov;
     |LEE 101#n43m0002.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nCmp = aCmp2;
     nCmp = 17 + nCmp;
     |SI nCmp > 22;  |ACABA;  |FINSI;

     #n43m0002#nCmp# = aCmp3;

     |GRABA 020#n43m0002.a;
     |LIBERA #n43m0002;
|FPRC;

|PROCESO Tipo24;
     || Registro complementarios de informacion de equivalencia de importe apunte

     aCmp2  = aLee % 302;
     aCmp3  = aLee % 503;
     aCmp4  = aLee % 814;
     aCmp5  = aLee % 2259;

     #n43m0101#0  = aCmp3;
     |LEE 000#n43m0101.=;
     |SI FSalida ! 0;  |DDEFECTO #n43m0101;  |FINSI;

     #n43m0002#0  = #n43m0004#0;
     #n43m0002#1  = #n43m0004#1;
     #n43m0002#2  = #n43m0004#2;
     #n43m0002#3  = #n43m0004#3;
     #n43m0002#4  = fFechaOpe;
     #n43m0002#5  = nMov;
     |LEE 101#n43m0002.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #n43m0002#23 = aCmp3;
     #n43m0002#25 = aCmp4;
     #n43m0002#26 = aCmp5;

     #n43m0002#24 = #n43m0101#1;
     #n43m0002#25 = #n43m0002#25  / 100;

     |GRABA 020#n43m0002.a;
     |LIBERA #n43m0002;
|FPRC;

|PROCESO n43m0002;
     |SI #n43m0002#13 = "1";
         #n43m0003#8 = #n43m0003#8 - #n43m0002#15;
     |FINSI;

     |SI #n43m0002#13 = "2";
         #n43m0003#8 = #n43m0003#8 + #n43m0002#15;
     |FINSI;
|FPRC;

|DEFBUCLE n43m0002;
     #n43m0002#1;
     ;
     #n43m0105#3, #n43m0105#0, #n43m0105#1, #n43m0105#2, "01.01.0000", 0;
     #n43m0105#3, #n43m0105#0, #n43m0105#1, #n43m0105#2, "31.12.2999", 9999;
     ;
     NULL, n43m0002;
|FIN;

|PROCESO Tipo33;
     || Registro de final de cuenta

     aCmp2  = aLee % 304;
     aCmp3  = aLee % 704;
     aCmp4  = aLee % 1110;
     aCmp5  = aLee % 2105;
     aCmp6  = aLee % 2614;
     aCmp7  = aLee % 4005;
     aCmp8  = aLee % 4514;
     aCmp9  = aLee % 5901;
     aCmp10 = aLee % 6014;
     aCmp11 = aLee % 7403;
     aCmp12 = aLee % 7704;

     #n43m0004#0 = #n43m0105#3;
     #n43m0004#1 = #n43m0105#0;
     #n43m0004#2 = #n43m0105#1;
     #n43m0004#3 = #n43m0105#2;
     #n43m0004#4 = nCodImp;
     |LEE 101#n43m0004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #n43m0101#0  = aCmp11;
     |LEE 000#n43m0101.=;
     |SI FSalida ! 0;  |DDEFECTO #n43m0101;  |FINSI;

     #n43m0004#19 = aCmp5;
     #n43m0004#20 = aCmp6;
     #n43m0004#21 = aCmp7;
     #n43m0004#22 = aCmp8;
     #n43m0004#23 = aCmp9;
     |SI #n43m0004#23 = "1"; #n43m0004#24 = "Deudor";    |FINSI;
     |SI #n43m0004#23 = "2"; #n43m0004#24 = "Acreedor";  |FINSI;
     #n43m0004#25 = aCmp10;
     #n43m0004#26 = aCmp11;
     #n43m0004#27 = #n43m0101#1;
     #n43m0004#28 = aCmp12;

     #n43m0004#20 = #n43m0004#20 / 100;
     #n43m0004#22 = #n43m0004#22 / 100;
     #n43m0004#25 = #n43m0004#25 / 100;

     #n43m0003#0 = #n43m0105#3;
     #n43m0003#1 = #n43m0105#0;
     #n43m0003#2 = #n43m0105#1;
     #n43m0003#3 = #n43m0105#2;
     |LEE 101#n43m0003.=;
     |SI FSalida ! 0;
         |DDEFECTO #n43m0003;
         #n43m0003#0 = #n43m0105#3;
         #n43m0003#1 = #n43m0105#0;
         #n43m0003#2 = #n43m0105#1;
         #n43m0003#3 = #n43m0105#2;
         |GRABA 020#n43m0003.b;
     |FINSI;

     nImpo = #n43m0004#13;
     |SI #n43m0004#11 = "1"; nImpo = -nImpo;  |FINSI;

     |SI #n43m0003#4 > #n43m0004#9;  |O #n43m0003#4 = "01.01.0000";
         #n43m0003#4 = #n43m0004#9;
         #n43m0003#5 = nImpo ! 2;
     |FINSI;

     nImpo = #n43m0004#25;
     |SI #n43m0004#23 = "1"; nImpo = -nImpo;  |FINSI;

     |SI #n43m0003#6 [ #n43m0004#10;
         #n43m0003#6 = #n43m0004#10;
         #n43m0003#7 = nImpo ! 2;
     |FINSI;

     #n43m0003#8 = #n43m0003#5;
     |BUCLE n43m0002;

     |GRABA 020#n43m0003.a;
     |LIBERA #n43m0003;

     aInci = "";

     |LEE 101#n43m0105.=;
     |SI FSalida = 0;
         #n43m0105#8 = "";
         |SI #n43m0003#7 ! #n43m0003#8;
             aInci = "Saldo descuadrado. ";
             #n43m0105#8 = eaNegro + ";" + eaRojo;
         |FINSI;
         |GRABA 020#n43m0105.a;
         |LIBERA #n43m0105;
     |FINSI;

     aInci = aInci + "Total registros leidos: " + nTRegi;
     aInci = aInci + " Grabados: " + nTGrab;
     aInci = aInci + " Repetidos: " + nTRepe;

     #n43m0004#7 = aInci;

     |GRABA 020#n43m0004.a;
     |LIBERA #n43m0004;
|FPRC;

|PROCESO Tipo88;
     || Registro fin de fichero

     aCmp2  = aLee % 320;
     aCmp3  = aLee % 2106;
     aCmp4  = aLee % 2754;
|FPRC;

|PROCESO SacaDatos;
     aCmp1  = aLee % 102;

     |SI nCheq = 1;
         |SI aCmp1 = "11";
             |HAZ Tipo11Cheq;

             |SI nOk = 0;
                 aInci = "Entidad: " + aCmp2;
                 aInci = aInci + " Oficina: " + aCmp3;
                 aInci = aInci + " Cuenta: " + aCmp4;
                 aInci = aInci + " No est  configurada.";

                 |HAZ Graba9000;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nCheq = 0;
         |SI aCmp1 = "11";  |HAZ Tipo11;  |FINSI;
         |SI aCmp1 = "22";  |HAZ Tipo22;  |FINSI;

         |SI nRepe = 0;
             |SI aCmp1 = "23";  |HAZ Tipo23;  |FINSI;
             |SI aCmp1 = "24";  |HAZ Tipo24;  |FINSI;
         |FINSI;

         |SI aCmp1 = "33";  |HAZ Tipo33;  |FINSI;

         |SI aCmp1 = "88";  |HAZ Tipo88;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO LeeFichero;
     |HORA aHora;
     fFecha  = ~;

     nOk     = -1;
     aFic    = aAbre - aPathPdt;
     aFicOri = aFic % 2599;  |QBF aFicOri;
     nCheq   = 1;
     nHay    = 0;
     |XABRE "", aAbre, nHandle;
     |PARA;  |SI;  |HACIENDO;
          |XLEE nHandle, 255, aLee;
          |SI FSalida [ 0;  |SAL;  |FINSI;

          |HAZ SacaDatos;
     |SIGUE;
     |XCIERRA nHandle;

     |SI nOk = -1;
         aInci = "El fichero no se ajusta al formato";
         |HAZ Graba9000;

         |HAZ CopiaFichero;

         |ACABA;
     |FINSI;

     |SI nHay = 0;
         |ACABA;
     |FINSI;

     nCheq = 0;
     |XABRE "", aAbre, nHandle;
     |PARA;  |SI;  |HACIENDO;
          |XLEE nHandle, 255, aLee;
          |SI FSalida [ 0;  |SAL;  |FINSI;

          |HAZ SacaDatos;
     |SIGUE;
     |XCIERRA nHandle;

     |HAZ CopiaFichero;
|FPRC;

|PROCESO BuscaFicheros;
     aDir = aPathPdt + "*.*";

     |_PDIR aDir;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          aAbre = aDir;
          |HAZ LeeFichero;

          |_SDIR aDir;
     |SIGUE;
|FPRC;


|| Subidas de ficheros ------------------------------------------------------

|PROCESO PonDsselect;
     aVer1   = "";
     aVer2   = "";
     aConte  = aBaseN43 + "plugins/dsselect.exe";
     |ESPECIFICA "MD5", aConte;
     aVer1 = FSalida;

     aConte  = aPathLocal + "dsselect.exe";
     |ESPECIFICA "REMOTOMD5", aConte;
     aVer2 = FSalida;

     |SI aVer1 ! aVer2;
         aOri = aBaseN43 + "plugins/dsselect.exe";
         aDes = aPathLocal + "dsselect.exe";

         |SI aIP = "";
             |COPIA_FICHERO aOri, aDes;
         |SINO;
             |ENVIA_FICHERO aOri, aDes;
         |FINSI;

         aAlfa = aPathLocal + "dsselect.exe";
         |XABRE "EC", aAlfa, 0;
         |SI FSalida < 0;
             |MENAV "0000No encuentro el explorador de ficheros, por favor consulte con su administrador informatico.";
             |ACABA;
         |FINSI;
     |FINSI;

     nOk = 1;
|FPRC;

|PROCESO SubeFichero;
     |MENAV "0000A continuaci¢n busque y seleccione el fichero a importar";

     nOk = 0;
     |HAZ PonDsselect;
     |SI nOk = 0;  |ACABA;  |FINSI;

     aProg = aPathLocal + "dsselect.exe " + aPathLocal + "dsselect.ini";

     aAlfa = aPathLocal + "dsselect.txt";  |RFBORRA aAlfa;
     aAlfa = aPathLocal + "dsselect.ini";  |RFBORRA aAlfa;

     aAbre = aPathLocal + "dsselect.ini";
     |XABRE "CW", aAbre, nHandle;
     |SI FSalida ] 0;
          aLinea = &34 + aPathLocal + &34 + " " + &34 + aPathLocal + "dsselect.txt" + &34;
          |XGRABA nHandle, aLinea;
     |FINSI;
     |XCIERRA nHandle;

     |RSYSTEM aProg;
     |PULSATECLA;

     aRuta = "";
     aAbre = aPathLocal + "dsselect.txt";
     |XABRE "CU", aAbre, nHandle;
     |SI FSalida ] 0;
         |XLEE nHandle, 250, aRuta;
     |FINSI;
     |XCIERRA nHandle;

     aAlfa = aPathLocal + "dsselect.txt";
     |RFBORRA aAlfa;

     |PULSATECLA;

     |QBF aRuta;
     |SI aRuta = "";
         nOk = 0;
         |ACABA;
     |FINSI;

     aAlfa      = aRuta;
     aFicBrowse = "";
     aFic       = "";
     aLong      = aAlfa % 0;
     nLong      = aLong;
     |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos       = (nCarac * 100) + 1;
           aCaracter  = aAlfa % nPos;
           aFicBrowse = aFicBrowse + aCaracter;
           aFic       = aFic + aCaracter;

           |SI aCaracter = "/";  |O aCaracter = "\";
               aFic = "";
           |FINSI;
     |SIGUE;

     nOk   = 0;
     aAlfa = aPathLocal + "*.txt";
     |R_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |RFBORRA aAlfa;

          |R_SDIR aAlfa;
     |SIGUE;

     |XABRE "C", aFicBrowse, nHandle;
     |XLEE nHandle, 255, aLee;
     |XCIERRA nHandle;

     aAlfa = aLee % 102;
     |SI aAlfa ! "11";
         |MENAV "0000Formato de fichero Norma 43 no v lido";
         |ACABA;
     |FINSI;

     fFecha = ~;
     |HORA aHora;
     aUsuario = Usuario % 810;  |QBF aUsuario;
     aUsuario = (aUsuario + "__________") % 110;

     aFicSub = (fFecha % -104) + (fFecha % 402) + (fFecha % 102);
     aFicSub = aFicSub + (aHora % 102) + (aHora % 402) + (aHora % 702);
     aFicSub = aFicSub + aUsuario;
     aFicSub = aFicSub + aFic;

     aOri  = aFicBrowse;
     aDes  = aPathPdt + aFicSub;
     |SI aIP = "";
         |COPIA_FICHERO aOri, aDes;

         |XABRE "CE", aDes, 0;
     |SINO;
         |RECIBE_FICHERO aOri, aDes;

         |XABRE "E", aDes, nHandle;
     |FINSI;

     |SI FSalida ! 0;
         |MENAV "0000No se ha podido subir el documento, reint‚ntelo de nuevo por favor";
     |SINO;
         |MENAV "0000Documento subido";
     |FINSI;
|FPRC;

|| --------------------------------------------------------------------------

|PROGRAMA;
     |SI PARAMETRO = "SUBIR";
         |HAZ SubeFichero;
         |ACABA;
     |FINSI;

     |HAZ AbreVtn;
     |HAZ BuscaFicheros;
     |HAZ CierraVtn;
|FPRO;

|PROCESO T80;  |TIPO 80;
     aIP      = "";
     |IP_REMOTO aIP;

     |DBASE aBaseN43;

     |HAZ CargaColores;
     |HAZ LeeUnidadBasico;
     aPathLocal = eaUnidadBasico + "\documentos";   |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\tmp";              |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\";

     aPathPdt = aBaseN43 + "documentos";             |MKDIR aPathPdt;
     aPathPdt = aBaseN43 + "documentos/pendientes";  |MKDIR aPathPdt;
     aPathPdt = aBaseN43 + "documentos/pendientes/";

     aPathRea = aBaseN43 + "documentos";             |MKDIR aPathRea;
     aPathRea = aBaseN43 + "documentos/realizados";  |MKDIR aPathRea;
     aPathRea = aBaseN43 + "documentos/realizados/";

     |ABRET #n43m0001;
     |ABRET #n43m0002;
     |ABRET #n43m0003;
     |ABRET #n43m0004;

     |ABRET #n43m0100;
     |ABRET #n43m0101;
     |ABRET #n43m0102;
     |ABRET #n43m0103;
     |ABRET #n43m0104;
     |ABRET #n43m0105;
     |ABRET #n43m9000;
|FPRC;

|PROCESO T90;  |TIPO 90;
     aAlfa = aPathLocal + "*.txt";
     |R_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |RFBORRA aAlfa;

          |R_SDIR aAlfa;
     |SIGUE;

     |CIERRAT #n43m0001;
     |CIERRAT #n43m0002;
     |CIERRAT #n43m0003;
     |CIERRAT #n43m0004;

     |CIERRAT #n43m0100;
     |CIERRAT #n43m0101;
     |CIERRAT #n43m0102;
     |CIERRAT #n43m0103;
     |CIERRAT #n43m0104;
     |CIERRAT #n43m0105;
     |CIERRAT #n43m9000;
|FPRC;
