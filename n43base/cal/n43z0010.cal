|FICHEROS;
     n43m0001;
     n43m0002;
     n43m0105;

     n43m0002@;
     camaasic@;
     camaasil@;
     cacuenta@;
|FIN;

|VARIABLES;
     n0Vent              = 0;
     nDia                = 0;
     nDoc                = 0;
     nLin                = 0;

     aBase               = "";
     aMas                = "";
     aAlfa               = "";
     aDef                = "";
     aFic                = "";

     fFec                = @;

     &enEmp              = 0;
     &eaEnt              = "";
     &eaOfi              = "";
     &eaCta              = "";
     &enPer              = 0;
     &enEje              = 0;
     &enOk               = 0;
     &eaAmarillo         = "";
     &eaAzulClaro        = "";
     &eaAzulOscuro       = "";
     &eaGris             = "";
     &eaMarengo          = "";
     &eaNegro            = "";
     &eaRojo             = "";
     &eaVerde            = "";
|FIN;

|PROCESO camaasilBusca1;
     #n43m0002@#0  = #n43m0002#0;
     #n43m0002@#27 = #camaasil@#0;
     #n43m0002@#28 = #camaasil@#1;
     #n43m0002@#29 = #camaasil@#2;
     |LEE 000#n43m0002@.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     nDia = #camaasil@#0;
     fFec = #camaasil@#1;
     nDoc = #camaasil@#2;

     enOk = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE camaasilBusca1;
     #camaasil@#3004;
     9;
     #n43m0002#30, #n43m0002#28, 000000, 0000, #n43m0002#15;
     #n43m0002#30, #n43m0002#28, 999999, 9999, #n43m0002#15;
     ;
     NULL, camaasilBusca1;
|FIN;

|PROCESO camaasilAsigna;
     nLin = nLin + 1;
     |SI nLin = 3;
         |ERROR10;
         |ACABA;
     |FINSI;

     #n43m0002#38 = #camaasil@#21;
     #n43m0002#39 = #camaasil@#28;

     |SI #n43m0002#30 ! #camaasil@#4;
         #cacuenta@#0 = #camaasil@#4;
         |LEE 000#cacuenta@.=;
         |SI FSalida ! 0;  |DDEFECTO #cacuenta@;  |FINSI;

         #n43m0002#34 = #camaasil@#4;
         #n43m0002#35 = #cacuenta@#2;
         #n43m0002#36 = #camaasil@#6;
         #n43m0002#37 = #camaasil@#7;
      |FINSI;
|FPRC;

|DEFBUCLE camaasilAsigna;
     #camaasil@#1004;
     ;
     nDia, fFec, nDoc, 0000;
     nDia, fFec, nDoc, 9999;
     ;
     NULL, camaasilAsigna;
|FIN;

|PROCESO n43m0002Busca1;
     enOk  = 0;
     aAlfa = #n43m0002#8 % 402;   enPer = aAlfa;
     aAlfa = #n43m0002#8 % -102;  enEje = aAlfa;
     |HAZ BuscaRegCanempre;

     |SI enOk = 0;  |ACABA;  |FINSI;

     |DBASS aBase;  |QBF aBase;
     aMas = aBase + "contagen/def/camaasil.mas";
     |CARGA_DEF aMas, camaasil@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aFic = aBase + "contagen/fich/" + (("00000" + #n43m0001#0) % -105) + enPer + "/";
     |PATH_DAT #camaasil@#aFic#;

     enOk  = 0;
     |BUCLE camaasilBusca1;

     |SI enOk = 0;
         |DESCARGA_DEF #camaasil@;
         |ACABA;
     |FINSI;

     aMas = aBase + "contagen/def/cacuenta.mas";
     |CARGA_DEF aMas, cacuenta@;

     |PATH_DAT #cacuenta@#aFic#;

     nLin = 0;
     |ABRE #cacuenta@;
     |BUCLE camaasilAsigna;
     |CIERRA #cacuenta@;

     |DESCARGA_DEF #cacuenta@;
     |DESCARGA_DEF #camaasil@;

     #n43m0002#27 = nDia;
     #n43m0002#28 = fFec;
     #n43m0002#29 = nDoc;
     #n43m0002#43 = "4";
     #n43m0002#40 =  eaMarengo + ";" + eaVerde;

     |GRABA 020#n43m0002.a;
     |LIBERA #n43m0002;
|FPRC;

|DEFBUCLE n43m0002Busca1;
     #n43m0002#1;
     43;
     #n43m0105#3, #n43m0105#0, #n43m0105#1, #n43m0105#2, "01.01.0000",    1, "2";
     #n43m0105#3, #n43m0105#0, #n43m0105#1, #n43m0105#2, "31.12.2999", 9999, "3";
     be;
     NULL, n43m0002Busca1;
|FIN;

|PROCESO n43m0002Busca2;
     enOk  = 0;
     aAlfa = #n43m0002#8 % 402;   enPer = aAlfa;
     aAlfa = #n43m0002#8 % -102;  enEje = aAlfa;
     |HAZ BuscaRegCanempre;

     |SI enOk = 0;  |ACABA;  |FINSI;

     |DBASS aBase;  |QBF aBase;
     aMas = aBase + "contagen/def/camaasic.mas";
     |CARGA_DEF aMas, camaasic@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aFic = aBase + "contagen/fich/" + (("00000" + #n43m0001#0) % -105) + enPer + "/";
     |PATH_DAT #camaasic@#aFic#;

     |ABRE #camaasic@;
     #camaasic@#0 = #n43m0002#27;
     #camaasic@#1 = #n43m0002#28;
     #camaasic@#2 = #n43m0002#29;
     |LEE 000#camaasic@.=;
     |SI FSalida ! 0; |O #camaasic@#4 ! #n43m0002#15;
         #n43m0002#29 = 0;
         #n43m0002#40 = eaMarengo + ";" + eaAzulOscuro;
         #n43m0002#43 = "3";
         |GRABA 020#n43m0002.a;
         |LIBERA #n43m0002;
     |FINSI;
     |CIERRA #camaasic@;

     |DESCARGA_DEF #camaasic@;
|FPRC;

|DEFBUCLE n43m0002Busca2;
     #n43m0002#1;
     43;
     #n43m0105#3, #n43m0105#0, #n43m0105#1, #n43m0105#2, "01.01.0000",    1, "4";
     #n43m0105#3, #n43m0105#0, #n43m0105#1, #n43m0105#2, "31.12.2999", 9999, "4";
     be;
     NULL, n43m0002Busca2;
|FIN;

|PROGRAMA;
     |BUCLE n43m0002Busca1;
     |BUCLE n43m0002Busca2;
|FPRO;

|PROCESO T80;  |TIPO 80;
     |HAZ CargaColores;

     |ABRE #n43m0001;
     #n43m0001#0 = enEmp;
     |LEE 000#n43m0001.=;
     |SI FSalida ! 0;  |DDEFECTO #n43m0001;  |FINSI;
     |CIERRA #n43m0001;

     |ABRE #n43m0105;
     #n43m0105#0 = eaEnt;
     #n43m0105#1 = eaOfi;
     #n43m0105#2 = eaCta;
     |LEE 000#n43m0105.=;
     |SI FSalida ! 0;  |DDEFECTO #n43m0105;  |FINSI;
     |CIERRA #n43m0105;

     |DDEF aDef;  |QBF aDef;

     |VENTANA 0501, 0540, -1, 16, "Chequeando integridad";
     n0Vent = FSalida;
     |PTEC 802; |PAUSA;

     aMas = aDef + "n43m0002.mas";
     |CARGA_DEF aMas, n43m0002@;

     |ABRET #n43m0002;
     |ABRET #n43m0002@;  |SELECT #4#n43m0002@;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #n43m0002;
     |CIERRAT #n43m0002@;
|FPRC;
