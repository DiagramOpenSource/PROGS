|FICHEROS;
     n43m0001;
     n43m0002;
     n43m0003;

     n43m0102;
     n43m0103;
     n43m0105;
     n43m9000;

     n43w0006;
     n43w0009,MANTE;
|FIN;

|VARIABLES;
     n0Vent              = 0;
     n1Vent              = 0;
     n2Vent              = 0;
     nGrid1              = -1;
     nGrid105            = -1;
     nCmp                = -1;

     nBtnActi            = -1;
     nBtnDesa            = -1;
     nBtnNBan            = -1;
     nBtnDBan            = -1;
     nBtnIBan            = -1;
     nBtnCBan            = -1;
     nBtnDLot            = -1;
     nBtnCLot            = -1;
     nBtnCCta            = -1;
     nBtnMovi            = -1;
     nBtnCble            = -1;
     nBtnDImp            = -1;
     nBtnCSal            = -1;

     nRango              = 0;
     nEje                = 0;
     nPer                = 0;
     nLot                = 0;
     nOk                 = 0;
     nLong               = 0;
     nCarac              = 0;
     nPos                = 0;
     nHandle             = 0;
     nPtec               = 1;
     nSeg                = 0;
     nOpcion             = 0;
     nFSalida            = 0;
     nTreeUti            = 0;

     aEsc1               = "";
     aEsc2               = "";
     aRetu               = "";
     aTecla              = "";
     aAlfa               = "";
     aEjecuta            = "";
     aOri                = "";
     aDes                = "";
     aBase               = "";
     aPath               = "";
     aPathLocal          = "";
     aVer1               = "";
     aVer2               = "";
     aPathPlugins        = "";
     aApi                = "";
     aLogSincro          = "";
     aAse                = "";
     aLong               = "";
     aCaracter           = "";
     aEjeSincro          = "";
     aLee                = "";
     aMas                = "";
     aTipoLbl            = "";
     aConten             = "";
     aTo                 = "";
     aBaseMensaje        = "";
     aFrom               = "";
     aAsunto             = "";
     aAbreTXT            = "";
     aIP                 = "";
     aSalida             = "";
     aMensaje            = "";
     aHora               = "";
     aFecha              = "";
     aFicTmp             = "";
     aContenido          = "";
     aAbre               = "";
     aOpcion             = "";

     fFecha              = @;

  {1}aConte              = "";

     {-1}sTree           = 0;
         sT_nID          = 0;
         sT_nOper        = 0;
         sT_aData        = "";

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     &enEmp              = 0;
     &eaEnt              = "";
     &eaOfi              = "";
     &enLot              = 0;
     &eaCta              = "";
     &enEje              = 0;
     &eaUnidadBasico     = "";
     &eaPaq              = "";

     &eaModoNet          = "";
     &eaUsuNet           = "";
     &eaBaseNet          = "";
     &eaFechaNet         = "";
     &eaEmpNet           = "";
     &eaBaseAplis        = "";
|FIN;

|| Utilidades ------------------------------------------------------------

|PROCESO CargaArbol;
     aOpcion = aOpcion + &13 + &10;
     |XGRABA nHandle, aOpcion;
|FPRC;

|PROCESO EvntTree;
     aContenido = Contenido;

     |SI FEntrada = 0;
         |ACABA;
     |FINSI;

     |VENTANA 0501, 0501, -1, 16, "";
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |PTEC 802; |PAUSA;

     |SI aContenido = "1";  |SUB_EJECUTA "n43z0002;SUBIR";  |FINSI;
     |SI aContenido = "2";  |SUB_EJECUTA "n43z0002;IMPOR";  |FINSI;
     |SI aContenido = "3";
         |ABRE #n43m9000;
         |CONSULTA_CLAVE #2#n43m9000;
         |CIERRA #n43m9000;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;

     |REFRESCACONTROL nGrid1;  |PULSATECLA;

     |FOCOTECLADO nTreeUti;
|FPRC;

|PROCESO Utilidades;
     |VENTANA 0501, 1550, -1, 16, "Utilidades";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |DBASE aBase;  |QBF aBase;
     aAlfa = aBase + "tmp";      |MKDIR aAlfa;

     sT_nID   = nTreeUti;
     sT_nOper = 0;

     aAbre = aPathLocal + "tree" + Usuario + ".txt";
     |XABRE "WBC", aAbre, nHandle;

     nOpcion = 0;

     nOpcion  = nOpcion + 1;
     aOpcion  = nOpcion + ":Subir fichero N43 para ser importado {{1}}";
     |HAZ CargaArbol;

     nOpcion  = nOpcion + 1;
     aOpcion  = nOpcion + ":Importar ficheros N43 {{2}}";
     |HAZ CargaArbol;

     nOpcion  = nOpcion + 1;
     aOpcion  = nOpcion + ":Incidencias de la importaci¢n N43 {{3}}";
     |HAZ CargaArbol;

     |XCIERRA nHandle;

     aAlfa = "TREECTRL, Tabla de contenidos {{" + aAbre + "}}";
     |CONTROL_SIMPLE 0, aAlfa, 0602, 1348, EvntTree;
     nTreeUti = FSalida;

     |RFBORRA aAbre;

     sT_nID   = nTreeUti;
     sT_nOper = 2;
     sT_aData = "1:";

     |ESPECIFICA "COMMANDCONTROL", sTree;

     |PULSATECLA;
     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}saliR," + nTreeUti;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;

     |FINVENTANA n1Vent;

     |FOCOTECLADO nGrid1;
|FPRC;

|| Grid2 -----------------------------------------------------------------

|PROCESO Baja2;
     #n43m0002#0 = #n43m0001#0;
     #n43m0002#1 = #n43m0105#0;
     #n43m0002#2 = #n43m0105#1;
     #n43m0002#3 = #n43m0105#2;
     #n43m0002#4 = "01.01.0000";
     #n43m0002#5 = 1;
|FPRC;

|PROCESO Alta2;
     #n43m0002#0 = #n43m0001#0;
     #n43m0002#1 = #n43m0105#0;
     #n43m0002#2 = #n43m0105#1;
     #n43m0002#3 = #n43m0105#2;
     #n43m0002#4 = "31.12.2999";
     #n43m0002#5 = 9999;
|FPRC;


|| Grid105 -----------------------------------------------------------------

|PROCESO DatosImp;
     enEmp = #n43m0001#0;
     eaEnt = #n43m0105#0;
     eaOfi = #n43m0105#1;
     eaCta = #n43m0105#2;

     |VENTANA 0501, 0501, -1, -1, "";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |PTEC 802; |PAUSA;

     |SUB_EJECUTA "n43m0004";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |FOCOTECLADO nGrid105;
|FPRC;

|PROCESO CtrlSaldos;
     |VENTANA 0501, 1299, -1, 16, "Control de saldos";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |PTEC 802; |PAUSA;

     #n43m0003#0 = #n43m0001#0;
     #n43m0003#1 = #n43m0105#0;
     #n43m0003#2 = #n43m0105#1;
     #n43m0003#3 = #n43m0105#2;
     |LEE 000#n43m0003.=;

     |PINPA #0#n43m0003;
     |PINDA #0#n43m0003;

     |LEETECLA aAlfa;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |FOCOTECLADO nGrid105;
|FPRC;

|PROCESO Configuracion;
     |VENTANA 0501, 1147, -1, 16, "Configuracion";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |PTEC 802; |PAUSA;

     |LEE 101#n43m0105.=;

     #n43w0009#0 = #n43m0105#5;
     #n43w0009#1 = #n43m0105#9;

     |PINPA #0#n43w0009;
     |PINDA #0#n43w0009;

     enEmp = #n43m0001#0;

     |ENDATOS #1#n43w0009;
     |SI FSalida = 0;
         #n43m0105#5 = #n43w0009#0;
         #n43m0105#9 = #n43w0009#1;
         |GRABA 020#n43m0105.a;
     |FINSI;
     |LIBERA #n43m0105;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |REFRESCACONTROL nGrid105;
     |FOCOTECLADO nGrid105;
|FPRC;

|PROCESO Propuesta;
     enEmp = #n43m0105#3;
     eaEnt = #n43m0105#0;
     eaOfi = #n43m0105#1;
     eaCta = #n43m0105#2;

     |VENTANA 0501, 0501, -1, -1, "";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |PTEC 802; |PAUSA;

     |SUB_EJECUTA "n43z0003";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |FOCOTECLADO nGrid105;
|FPRC;

|PROCESO ConsMov;
     |VENTANA 0501, 3699, -1, 16, "Datos movimiento";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |PTEC 802; |PAUSA;

     |DDEFECTO #n43w0006;
     |PARA nCmp = 0;  |SI nCmp [ 26;  |HACIENDO nCmp = nCmp + 1;
           #n43w0006#nCmp#  = #n43m0002#nCmp#;
     |SIGUE;

     |PINPA #0#n43w0006;
     |PINDA #0#n43w0006;

     |LEETECLA aAlfa;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO Movimientos;
     |PARA;  |SI;  |HACIENDO;
          |CONSULTA_F_CLAVE #1#n43m0002, Baja2, Alta2;
          |SI FSalida = 0;
              |HAZ ConsMov;
          |SINO;
              |CONFI "0000SQuiere salir de la consulta";
              |SI FSalida = 0;
                  |SAL;
              |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Baja105;
     #n43m0105#3 = #n43m0001#0;
     #n43m0105#0 = "";
     #n43m0105#1 = "";
     #n43m0105#2 = "";
|FPRC;

|PROCESO Alta105;
     #n43m0105#3 = #n43m0001#0;
     #n43m0105#0 = "zzzz";
     #n43m0105#1 = "zzzz";
     #n43m0105#2 = "z"* 10;
|FPRC;

|PROCESO Evnt105;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#n43m0105.=;

         |ESTADO_CONTROL nBtnMovi, "ENABLE";
         |ESTADO_CONTROL nBtnCble, "ENABLE";
         |ESTADO_CONTROL nBtnDImp, "ENABLE";
         |ESTADO_CONTROL nBtnCSal, "ENABLE";
     |FINSI;

     |SI FSalida = 4;
||         |HAZ ConsCta;
     |FINSI;
|FPRC;

|| Grid1 -------------------------------------------------------------------

|PROCESO Baja1N;
     #n43m0001#3 = "N";
     #n43m0001#0 = 00001;
|FPRC;

|PROCESO Alta1N;
     #n43m0001#3 = "N";
     #n43m0001#0 = 99999;
|FPRC;

|PROCESO Habilita;
     |CONFI "0000SSeguro que quiere activar la empresa seleccionada.";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SELECT #1#n43m0001;
     |LEE 101#n43m0001.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #n43m0001#3 = "S";
     |GRABA 020#n43m0001.a;
     |LIBERA #n43m0001;

/*
     eaModoNet     = "Habilitado nuevo acceso";
     eaUsuNet      = Usuario % 810; |QBF eaUsuNet;
     fFecha        = ~;
     aFecha        = fFecha;
     eaFechaNet    = aFecha + " " + aHora;
     eaEmpNet      = ("00000" + #n43m0001#0) % -105;
     eaEmpNet      = eaEmpNet + " / " + #n43m0001#1;   |QBF eaEmpNet;
     eaEmpNet      = eaEmpNet + " / " + #n43m0001#2;   |QBF eaEmpNet;

     |HAZ EnviaNotificacion;
*/
|FPRC;

|PROCESO ActivarEmp;
     |SALVA_DATOS #n43m0001;

     #n43m0001#3 = "N";
     #n43m0001#0 = 1;
     |LEE 000#n43m0001.];
     |SI FSalida ! 0;  |O #n43m0001#3 ! "N";
         |MENAV "0000No hay empresas desactivadas";
     |SINO;
         |CONSULTA_F_CLAVE #3#n43m0001, Baja1N, Alta1N;
         |SI FSalida = 0;
             |HAZ Habilita;
         |FINSI;
     |FINSI;

     |REPON_DATOS #n43m0001;

     |SELECT #3#n43m0001;
     |LEE 000#n43m0001.=;

     |REFRESCACONTROL nGrid1;
     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO DesactivarEmp;
     |CONFI "0000NEst  seguro que quiere desactivar la empresa";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SELECT #1#n43m0001;
     |LEE 101#n43m0001.=;
     |SI FSalida = 0;
         #n43m0001#3 = "N";
         |GRABA 020#n43m0001.a;
         |LIBERA #n43m0001;

/*
         eaModoNet     = "Acceso quitado ";
         eaUsuNet      = Usuario % 810; |QBF eaUsuNet;
         fFecha        = ~;
         aFecha        = fFecha;
         eaFechaNet    = aFecha + " " + aHora;
         eaEmpNet      = ("00000" + #n43m0001#0) % -105;
         eaEmpNet      = eaEmpNet + " / " + #n43m0001#1;   |QBF eaEmpNet;
         eaEmpNet      = eaEmpNet + " / " + #n43m0001#2;   |QBF eaEmpNet;
         |HAZ EnviaNotificacion;
*/
     |FINSI;

     |SELECT #3#n43m0001;
     |LEE 000#n43m0001.=;

     |REFRESCACONTROL nGrid1;
     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO Baja1;
     #n43m0001#3 = "S";
     #n43m0001#0 = 00001;
|FPRC;

|PROCESO Alta1;
     #n43m0001#3 = "S";
     #n43m0001#0 = 99999;
|FPRC;

|PROCESO Evnt1;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#n43m0001.=;

         |ESTADO_CONTROL nBtnMovi, "DISABLE";
         |ESTADO_CONTROL nBtnCble, "DISABLE";
         |ESTADO_CONTROL nBtnDImp, "DISABLE";
         |ESTADO_CONTROL nBtnCSal, "DISABLE";

         |REFRESCACONTROL nGrid105;
     |FINSI;
|FPRC;

|PROGRAMA;
     |VENTANA 0501, 3599, -1, 16, "Bandeja control cuentas corrientes";
     n0Vent = FSalida;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}Empresas", 0502, 0520, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{15}}Cuentas corrientes", 2402, 2420, NULL;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Activar empresa", 2280, 2298, ActivarEmp;
     nBtnActi  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Desactivar empresa", 2260, 2277, DesactivarEmp;
     nBtnDesa = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Movimientos", 3364, 3376, Movimientos;
     nBtnMovi = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Propuesta contable", 3378, 3398, Propuesta;
     nBtnCble = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Datos importaci¢n", 3302, 3320, DatosImp;
     nBtnDImp = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Control de saldos", 3322, 3338, CtrlSaldos;
     nBtnCSal = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Configuraci¢n", 3340, 3355, Configuracion;
     nBtnCSal = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Utilidades", 3502, 3514, Utilidades;

     |ESTADO_CONTROL nBtnMovi, "DISABLE";
     |ESTADO_CONTROL nBtnCble, "DISABLE";
     |ESTADO_CONTROL nBtnDImp, "DISABLE";
     |ESTADO_CONTROL nBtnCSal, "DISABLE";

     nRango   = 2 + 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #2#n43m0105, nRango, 2502, 3298, Baja105, Alta105, Evnt105;
     nGrid105 = FSalida;

     |LINEAL_SIMPLE #3#n43m0001, nRango, 0602, 2198, Baja1, Alta1, Evnt1;
     nGrid1 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid1;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FINVENTANA n0Vent;

     |PULSATECLA;
|FPRO;

|PROCESO T80;  |TIPO 80;
     |HAZ DimePaquete;

     |ABRET #n43m0001;
     |ABRET #n43m0002;
     |ABRET #n43m0003;

     |ABRET #n43m0102;
     |ABRET #n43m0103;
     |ABRET #n43m0105;

     |HAZ LeeUnidadBasico;

     aIP        = "";
     |IP_REMOTO aIP;

     aPathLocal = eaUnidadBasico + "\documentos";   |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\n43base";          |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\";
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #n43m0001;
     |CIERRAT #n43m0002;
     |CIERRAT #n43m0003;

     |CIERRAT #n43m0102;
     |CIERRAT #n43m0103;
     |CIERRAT #n43m0105;
|FPRC;
