|FICHEROS;
     program@ #0;

     dsmom001  #1;
     dsmom004  #4;
     dsmom005  #5;
     dsmom006  #6;
     dsmom008  #8;
     dsmom070  #70;
     dsmow016  #423;

     dsmoc349  #349;
     dsmo2347  #247;
     dsm180li  #180;
     dsm190li  #190;
     dsm193li  #193;
     dsm193ga  #194;
     dsm296li  #296;
     dsmoc110  #110;
     dsmoc115  #115;
     dsmoc123  #123;
     dsmoc216  #216;
     dsmow067  #100;
     dsmom025  #25;
     dsmoy027  #27;
     dsmoy020  #20;
     dsmoy021  #21;
     dsmow056  #956;
     dsmow099  #959;
     dsm18402  #445;
     dsm18404  #446;
     dsm18407  #447;
     dsm18430  #448;

     &haciend@ #706;
     :/basica/def/agihacie #707;
     :/integral/def/dsam0102 #708;

     &regisnif@ #709;
     :/basica/def/agim0003   #710;
     :/integral/def/dsam0103 #711;

     &clientes@ #715;
     :/basica/def/agifigen   #716;
     :/integral/def/dsam0000 #717;

     &datosper@ #718;
     :/integral/def/dsam0003 #719;

     &bancosc@ #720;
     :/basica/def/agibanco #721;
     :/integral/def/dsam0116 #722;
|FIN;

|VARIABLES;
     aPrograma      = "";
     aPathModelo    = "";
     aDef           = "";
     aAlfa          = "";
     aEscape        = "";
     aAvance        = "";
     aRetroceso     = "";
     aQueQuiero     = "";
     aNumPanta      = "";
     aLong          = "";
     aCampo         = "";
     aBase          = "";

     nPanta         = 0;
     nNumPanta      = 0;
     nLong          = 0;
     nPosi          = 0;
     nConta         = 0;
     nCampo         = 0;
     nContador      = 0;
     nSinDatos      = 0;
     nCanal         = 0;
     nActivi        = 0;
     nRegulacion    = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Tipo88;  |TIPO 88;
     aPrograma = FSalida % -108;

     |SI aPrograma = "dsmoc349";  |REFERENCIA_DEF program@, #349;  |FINSI;
     |SI aPrograma = "dsmo2347";  |REFERENCIA_DEF program@, #247;  |FINSI;
     |SI aPrograma = "dsmow016";  |REFERENCIA_DEF program@, #423;  |FINSI;
     |SI aPrograma = "dsmoc110";  |REFERENCIA_DEF program@, #110;  |FINSI;
     |SI aPrograma = "dsmoc115";  |REFERENCIA_DEF program@, #115;  |FINSI;
     |SI aPrograma = "dsmoc123";  |REFERENCIA_DEF program@, #123;  |FINSI;
     |SI aPrograma = "dsmoc216";  |REFERENCIA_DEF program@, #216;  |FINSI;
     |SI aPrograma = "dsm180li";  |REFERENCIA_DEF program@, #180;  |FINSI;
     |SI aPrograma = "dsm190li";  |REFERENCIA_DEF program@, #190;  |FINSI;
     |SI aPrograma = "dsm193li";  |REFERENCIA_DEF program@, #193;  |FINSI;
     |SI aPrograma = "dsm193ga";  |REFERENCIA_DEF program@, #194;  |FINSI;
     |SI aPrograma = "dsm296li";  |REFERENCIA_DEF program@, #296;  |FINSI;
     |SI aPrograma = "dsmow067";  |REFERENCIA_DEF program@, #100;  |FINSI;
     |SI aPrograma = "dsmom025";  |REFERENCIA_DEF program@, #25;   |FINSI;
     |SI aPrograma = "dsmom070";  |REFERENCIA_DEF program@, #70;   |FINSI;
     |SI aPrograma = "dsmoy027";  |REFERENCIA_DEF program@, #27;   |FINSI;
     |SI aPrograma = "dsmoy020";  |REFERENCIA_DEF program@, #20;   |FINSI;
     |SI aPrograma = "dsmoy021";  |REFERENCIA_DEF program@, #21;   |FINSI;
     |SI aPrograma = "dsmow056";  |REFERENCIA_DEF program@, #956;  |FINSI;
     |SI aPrograma = "dsmow099";  |REFERENCIA_DEF program@, #959;  |FINSI;
     |SI aPrograma = "dsm18402";  |REFERENCIA_DEF program@, #445;  |FINSI;
     |SI aPrograma = "dsm18404";  |REFERENCIA_DEF program@, #446;  |FINSI;
     |SI aPrograma = "dsm18407";  |REFERENCIA_DEF program@, #447;  |FINSI;
     |SI aPrograma = "dsm18430";  |REFERENCIA_DEF program@, #448;  |FINSI;

     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         ||Desactivado

         |MODO_RELACION #0, 1, "agihacie", "N", "N";
         |MODO_RELACION #0, 1, "agim0003", "N", "N";
         |MODO_RELACION #0, 1, "agibanco", "N", "N";

         |MODO_RELACION #0, 1, "agihacie", "X", "X";
         |MODO_RELACION #0, 1, "agim0003", "X", "X";
         |MODO_RELACION #0, 1, "agibanco", "X", "X";

         || Activado

         |MODO_RELACION #0, 0, "dsam0102", "X", "X";
         |MODO_RELACION #0, 0, "dsam0103", "X", "X";
         |MODO_RELACION #0, 0, "dsam0116", "X", "X";

         |MODO_RELACION #0, 1, "dsam0102", "S", "S";
         |MODO_RELACION #0, 1, "dsam0103", "S", "S";
         |MODO_RELACION #0, 1, "dsam0116", "S", "S";

         |REFERENCIA_DEF haciend@,  #708;
         |REFERENCIA_DEF regisnif@, #711;
         |REFERENCIA_DEF bancosc@,  #722;
     |SINO;
         |MODO_RELACION #0, 1, "dsam0102", "N", "N";
         |MODO_RELACION #0, 1, "dsam0103", "N", "N";
         |MODO_RELACION #0, 1, "dsam0116", "N", "N";

         |MODO_RELACION #0, 1, "dsam0102", "X", "X";
         |MODO_RELACION #0, 1, "dsam0103", "X", "X";
         |MODO_RELACION #0, 1, "dsam0116", "X", "X";

         |MODO_RELACION #0, 0, "agihacie", "X", "X";
         |MODO_RELACION #0, 0, "agim0003", "X", "X";
         |MODO_RELACION #0, 0, "agibanco", "X", "X";

         |MODO_RELACION #0, 1, "agihacie", "S", "S";
         |MODO_RELACION #0, 1, "agim0003", "S", "S";
         |MODO_RELACION #0, 1, "agibanco", "S", "S";

         |REFERENCIA_DEF haciend@,  #707;
         |REFERENCIA_DEF regisnif@, #710;
         |REFERENCIA_DEF bancosc@,  #721;
     |FINSI;
|FPRC;

|PROCESO PintaPantalla;
     |SI nPanta < 0;   nPanta = 0;                   |FINSI;
     |SI nPanta = 0;   |PINPA #00#0;  |PINDA #00#0;  |FINSI;
     |SI nPanta = 1;   |PINPA #01#0;  |PINDA #01#0;  |FINSI;
     |SI nPanta = 2;   |PINPA #02#0;  |PINDA #02#0;  |FINSI;
     |SI nPanta = 3;   |PINPA #03#0;  |PINDA #03#0;  |FINSI;
     |SI nPanta = 4;   |PINPA #04#0;  |PINDA #04#0;  |FINSI;
     |SI nPanta = 5;   |PINPA #05#0;  |PINDA #05#0;  |FINSI;
     |SI nPanta = 6;   |PINPA #06#0;  |PINDA #06#0;  |FINSI;
     |SI nPanta = 7;   |PINPA #07#0;  |PINDA #07#0;  |FINSI;
     |SI nPanta = 8;   |PINPA #08#0;  |PINDA #08#0;  |FINSI;
     |SI nPanta = 9;   |PINPA #09#0;  |PINDA #09#0;  |FINSI;
     |SI nPanta = 10;  |PINPA #10#0;  |PINDA #10#0;  |FINSI;
     |SI nPanta = 11;  |PINPA #11#0;  |PINDA #11#0;  |FINSI;
     |SI nPanta = 12;  |PINPA #12#0;  |PINDA #12#0;  |FINSI;
     |SI nPanta = 13;  |PINPA #13#0;  |PINDA #13#0;  |FINSI;
     |SI nPanta = 14;  |PINPA #14#0;  |PINDA #14#0;  |FINSI;
|FPRC;

|PROCESO NoVisual;
     |QBF eaNoVisu;
     |SI eaNoVisu ! "";
         aLong = eaNoVisu % 0;
         nLong = aLong;
         |PARA nConta = 1;  |SI nConta [ nLong;  |HACIENDO nConta = nConta + 3;
               nPosi  = (nConta * 100) + 3
               aCampo = eaNoVisu % nPosi;
               nCampo = aCampo;

               |C_V #0nCampo, 1, "N";
               |C_M #0nCampo, 1, "N";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO PintaDatos;
     enCodCli = enEmpresa;
     |HAZ LeePersona;

     aAlfa = (("00000" + enEmpresa) % -105) + " " + #715#2;
     |SI enActividad = 0;
         aAlfa = aAlfa + " EMISION";
     |SINO;
         aAlfa = aAlfa + " Actividad: " + enActividad;
     |FINSI;
     aAlfa = aAlfa + " Periodo: " + enPeriodo + " / " + enEjer;

     |ATRI I;
     |PINTA 2401, aAlfa;
     |ATRI i;
|FPRC;

|PROCESO SacaPantallas;
     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/" + eaNomDef + ".mas";
     |CARGA_DEF aDef, program@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + eaNomDef;
         |MENAV aAlfa;
         |ERROR;
     |FINSI;

     aQueQuiero = "|NP";
     aNumPanta  = #program@#aQueQuiero#;
     nNumPanta  = aNumPanta;
     nNumPanta  = nNumPanta - 1;

     aEscape    = &255 + "806";
     aAvance    = &255 + "815";
     aRetroceso = &255 + "814";

     |SI nNumPanta ] 1;
         |MENSA "0000 Av.Pag Pant.Siguiente. Re.Pag Pant.Anterior. ESC Salir.";
     |SINO;
         |MENSA "      ESC Salir.";
     |FINSI;

     |ABRE #0;
     #0#0 = enEmpresa;
     #0#1 = enEjer;
     #0#2 = enPeriodo;
     #0#3 = enModelo;
     #0#4 = enComplem;
     #0#5 = enActividad;
     |LEE 000#0=;
     |SI FSalida ! 0;
         |MENAV "     No existe Registro.";
         |CIERRA #0;
         |DESCARGA_DEF #program@;
         |ACABA;
     |FINSI;
     |CIERRA #0;

     |SI enActividad ! 0;  |HAZ NoVisual;  |FINSI;

     |PUSHV 0401 2380;
     |PINPA #0#0;
     |PINDA #0#0;

     |HAZ PintaDatos;

     nPanta = 0;
     |PARA;  |SI;  |HACIENDO;
          |LEETECLA aAlfa;
          |SI aAlfa = aEscape;  |SAL;  |FINSI;
          |SI aAlfa = aAvance;
              |SI nPanta < nNumPanta;
                  nPanta = nPanta + 1;
                  |HAZ PintaPantalla;
             |FINSI;
          |FINSI;

          |SI aAlfa = aRetroceso;
              |SI nPanta [ nNumPanta;
                  nPanta = nPanta - 1;
                  |HAZ PintaPantalla;
              |FINSI;
          |FINSI;
     |SIGUE;
     |POPV;

     |DESCARGA_DEF #program@;
|FPRC;


|PROCESO UltimoPeriodo;
     |ABRE #5;
     |ABRE #6;
     #6#0 = enEmpresa;
     #6#1 = enModelo;
     |LEE 040#6=;
     |SI FSalida = 0;
         eaUltimoPer = #6#12;
     |SINO;
         #5#0 = enModelo;
         |LEE 040#5=;
         |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;

         eaUltimoPer = #5#11;
     |FINSI;
     |CIERRA #5;
     |CIERRA #6;
|FPRC;

|PROCESO EntraModelo;
     |SI #8#12 = 110;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmod110";  |FINSI;
         |SI enActividad ! 0; |SUB_EJECUTA_NP "dsmoc110";  |FINSI;
     |FINSI;

     |SI #8#12 = 115;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmod115";  |FINSI;
         |SI enActividad ! 0; |SUB_EJECUTA_NP "dsmoc115";  |FINSI;
     |FINSI;

     |SI #8#12 = 123;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmod123";  |FINSI;
         |SI enActividad ! 0; |SUB_EJECUTA_NP "dsmoc123";  |FINSI;
     |FINSI;

     |SI #8#12 = 216;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmod216";  |FINSI;
         |SI enActividad ! 0; |SUB_EJECUTA_NP "dsmoc216";  |FINSI;
     |FINSI;

     |SI #8#12 = 300;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmod300";  |FINSI;
         |SI enActividad ! 0; |SUB_EJECUTA_NP "dsmociva";  |FINSI;
     |FINSI;

     |SI #8#12 = 320;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmod320";  |FINSI;
         |SI enActividad ! 0; |SUB_EJECUTA_NP "dsmociva";  |FINSI;
     |FINSI;

     |SI #8#12 = 330;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmod330";  |FINSI;
         |SI enActividad ! 0; |SUB_EJECUTA_NP "dsmociva";  |FINSI;
     |FINSI;

     |SI #8#12 = 332;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmod332";  |FINSI;
         |SI enActividad ! 0; |SUB_EJECUTA_NP "dsmociva";  |FINSI;
     |FINSI;

     |SI #8#12 = 130;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmod130";  |FINSI;
         |SI enActividad ! 0; |SUB_EJECUTA_NP "dsmoc130";  |FINSI;
     |FINSI;

     |SI #8#12 = 310;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmod310";  |FINSI;
         |SI enActividad ! 0; |SUB_EJECUTA_NP "dsmoc310";  |FINSI;
     |FINSI;

     |SI #8#12 = 131;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmod131";  |FINSI;
         |SI enActividad ! 0; |SUB_EJECUTA_NP "dsmoc131";  |FINSI;
     |FINSI;

     |SI #8#12 = 370;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmod370";  |FINSI;
     |FINSI;

     |SI #8#12 = 349;
         enModelo349 = 349;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmod349";  |FINSI;
         |SI enActividad ! 0; |SUB_EJECUTA_NP "dsmoc349";  |FINSI;
     |FINSI;

     |SI #8#12 = 347;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsmo1347";  |FINSI;
     |FINSI;

     |SI #8#12 = 180;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsm180ca";  |FINSI;
     |FINSI;

     |SI #8#12 = 184;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsm18401";  |FINSI;
     |FINSI;

     |SI #8#12 = 190;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsm190ca";  |FINSI;
     |FINSI;

     |SI #8#12 = 193;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsm193ca";  |FINSI;
     |FINSI;

     |SI #8#12 = 296;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsm296ca";  |FINSI;
     |FINSI;

     |SI #8#12 = 390;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsm39001";  |FINSI;
     |FINSI;

     |SI #8#12 = 392;
         |SI enActividad = 0; |SUB_EJECUTA_NP "dsm39201";  |FINSI;
     |FINSI;
|FPRC;

|PROCESO ChequeaSitua;
     enActividad   = #8#5;
     enTipoEntrada = 99;
     enExistencia  = 0;

     |SI #8#5 ! 0;  |Y #8#5 ! 99;
         nContador = nContador + 1;
     |FINSI;

     |HAZ EntraModelo;

     |SI #8#5 = 0;   |ACABA;  |FINSI;

     |SI enExistencia = 0;
         |SI #8#5 = 99;
             nRegulacion = 1;
             |ACABA;
         |FINSI;

         nSinDatos = nSinDatos + 1;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom008;
     #8#1;
     ;
     #4#0, #4#1, #4#2, #4#3, #4#4, 00;
     #4#0, #4#1, #4#2, #4#3, #4#4, 99;
     ;
     NULL, ChequeaSitua;
|FIN;

|PROCESO ChequeaSituacion;
     |MENSA "      Recalculando Planing";

     enExistencia = 0;
     nSinDatos    = 0;
     nContador    = 0;
     nRegulacion  = 0;
     enResultado  = 0;
     nActivi      = enActividad;

     |BUCLE dsmom008;

     enActividad  = nActivi;

     |SI nSinDatos = 0;  |Y nRegulacion = 0;
         #4#17 = "SIN DATOS";
         #4#7  = " ";
         #4#9  = " ";
         #4#11 = " ";
         #4#13 = " ";
     |FINSI;

     |SI nRegulacion = 1;
         #4#17 = "PARCIALES";
         #4#7  = "X";
     |FINSI;

     |SI nSinDatos ! 0;  |Y nSinDatos ! nContador;
         #4#17 = "PARCIALES";
         #4#7  = "X";
     |FINSI;

     |SI nSinDatos = nContador;  |Y nSinDatos ! 0;
         #4#7  = "X";
         #4#8  = ~;
         #4#17 = "COMPLETADO";
     |FINSI;

     #4#15 = enResultado;
     #4#16 = eaUltimoPer;
|FPRC;

|PROCESO Refresco;
     |PONCONTROL 23, "SI";
|FPRC;

|PROCESO SinBarra;  |TIPO 5;
     FSalida = "SINBARRA";
|FPRC;

|PROCESO LeePersona;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
          enSwDeDonde = 1;
          |REFERENCIA_DEF clientes@, #717;
          |REFERENCIA_DEF datosper@, #719;
     |SINO;
         enSwDeDonde = 0;
         |REFERENCIA_DEF clientes@,  #716;
         |REFERENCIA_DEF datosper@,  #716;
     |FINSI;

     |ABRE #715;
     #715#0 = enCodCli;
     |LEE 040#715=;
     |SI FSalida ! 0; |DDEFECTO #715; |FINSI;
     |CIERRA #715;

     |ABRE #718;
     #718#0 = enCodCli;
     |LEE 040#718=;
     |SI FSalida ! 0; |DDEFECTO #718; |FINSI;
     |CIERRA #718;
|FPRC;

|PROCESO LeeHacienda;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         |REFERENCIA_DEF haciend@, #708;
     |SINO;
         |REFERENCIA_DEF haciend@,  #707;
     |FINSI;

     |ABRE #706;
     #706#0 = enCodDeleg;
     #706#1 = enCodAdmin;
     |LEE 040#706=;
     |SI FSalida ! 0; |DDEFECTO #706; |FINSI;
     |CIERRA #706;
|FPRC;

|PROCESO LeeNifs;
     eswNif = 0;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         enSwDeDonde = 1;
         |REFERENCIA_DEF regisnif@, #711;
     |SINO;
         enSwDeDonde = 0;
         |REFERENCIA_DEF regisnif@, #710;
     |FINSI;

     |ABRE #709;
     #709#0 = eaCodNif;
     |LEE 040#709=;
     |SI FSalida ! 0; |DDEFECTO #709; eswNif = 1; |FINSI;
     |CIERRA #709;
|FPRC;

|PROCESO LeeBancoCliente;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
          enSwDeDonde = 1;
          |REFERENCIA_DEF bancosc@, #722;
     |SINO;
          enSwDeDonde = 0;
          |REFERENCIA_DEF bancosc@, #721;
     |FINSI;

     |ABRE #720;
     #720#0 = enCodBanco;
     |LEE 040#720=;
     |SI FSalida ! 0; |DDEFECTO #720; |FINSI;
     |CIERRA #720;
|FPRC;
