|FICHEROS;
     dsmozpas #0;
     dsmom004 #4;
     dsmom008 #8;
     dsmom027 #27;
     dsmom029 #29;
     dsmom080 #80;
     dsmom082 #82;

     dsmom030 #30;
     dsmociva #300;
     dsmocivp #165;
     dsmoc349 #349;

     :/contagen/def/canempre #101;
     :/contagen/def/camaniva #102;
     :/contagen/def/caivalin #103;
     :/contagen/def/caivaasi #104;
     :/contagen/def/caivam03 #105;

     :/basica/def/agicen14 #214;

     &regisnif@ #709;

     dsmow013 #999,MANTE;

     espejo1@ #1300;
|FIN;

|VARIABLES;
     aAlfa1         = "";
     aAlfa          = "";
     aPathModelo    = "";
     aDef           = "";
     aTipo          = "";

     nEjer          = 0;
     nDPeriodo      = 0;
     nHPeriodo      = 0;
     nCampo         = 0;
     nCampo1        = 0;
     nCampo11       = 0;
     nCampo2        = 0;
     nCampo22       = 0;
     nCampo3        = 0;
     nCampo33       = 0;
     nSwEsta        = 0;
     nGrupo         = 0;
     nSubGrupo      = 0;
     nDepar         = 0;
     nBaseImpo      = 0;
     nPorce         = 0;
     nCuota         = 0;
     nPeriodo       = 0;
     nModelo        = 0;
     nSwPasa        = 0;
     nCompensado    = 0;
     nBaseImpo349   = 0;
     nCuota349      = 0;
     nModBucle      = 0;
     nAnyo          = 0;

     nSwSi  = 0;
     nNume  = 0;
     nNume1 = 0;
     nNume2 = 0;
     nCanti = 0;
     nDepartamento = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Graba349;
     nModelo       = enModelo;
     enTipoEntrada = 95;
     enModelo      = 349;
     eaNombreAct   = #999#6;
     enModelo349   = #999#7;
     |SUB_EJECUTA "dsmoc349";

     eaCodNif = #102#14;
     |HAZ LeeNifs;

     |ABRE #349;
     #349#0  = enEmpresa;
     #349#1  = enEjer;
     #349#2  = enPeriodo;
     #349#3  = enModelo;
     #349#4  = enComplem;
     #349#5  = enActividad;
     #349#6  = aTipo;
     #349#7  = #102#14;
     #349#25 = 0;
     #349#26 = 0;
     |SI aTipo = "ER"; |O aTipo = "AR";
         |SI #105#5 ! 0;
             #349#25 = #105#5; || Ejercicio Declarado;
             #349#26 = #105#4;
         |FINSI;
     |FINSI;
     |LEE 101#349=;
     |SI FSalida ! 0;
         |DDEFECTO #349;
         #349#0  = enEmpresa;
         #349#1  = enEjer;
         #349#2  = enPeriodo;
         #349#3  = enModelo;
         #349#4  = enComplem;
         #349#5  = enActividad;
         #349#6  = aTipo;
         #349#7  = #102#14;
         #349#25 = 0;
         #349#26 = 0;
         |SI aTipo = "ER"; |O aTipo = "AR";
             |SI #105#5 ! 0;
                 #349#25 = #105#5; || Ejercicio Declarado;
                 #349#26 = #105#4;
                 #349#27 = #105#6;
             |FINSI;
         |FINSI;
         |SI #709#12 !  "   ";  #349#8  = #709#12;  |FINSI;
         #349#9  = #709#1;
         |GRABA 020#349b;
     |FINSI;

     |SI #349#6 = "A "; |O #349#6 = "AR";
         nSwEsta = 0;
         |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #349nCampo2 = nPorce;
                   #349nCampo1 = #349nCampo1 + nBaseImpo349;
                   #349nCampo2 = nPorce;
                   #349nCampo3 = #349nCampo3 + nCuota349;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;

         |SI nSwEsta = 0;
             |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
                   nCampo1 = nCampo2 - 1;
                   nCampo3 = nCampo2 + 1;
                   |SI #349nCampo2 = 0; |Y #349nCampo1 = 0;  |Y #349nCampo3 = 0;
                       #349nCampo1 = #349nCampo1 + nBaseImpo349;
                       #349nCampo2 = nPorce;
                       #349nCampo3 = #349nCampo3 + nCuota349;
                       nSwEsta = 1;
                       |SAL;
                   |FINSI;
              |SIGUE;
         |FINSI;

         |SI nSwEsta = 0;
             #349#19 = #349#19 + nBaseImpo349;
             #349#20 = 0;
             #349#21 = #349#21 + nCuota349;
         |FINSI;

         #349#22 = #349#10 + #349#13 + #349#16 + #349#19;
     |SINO;
         #349#22 = #349#22 + nBaseImpo349;
     |FINSI;

     |SI aTipo = "ER"; |O aTipo = "AR";
         #349#24 = "-";
     |FINSI;
     |GRABA 020#349a;
     |LIBERA #349;
     |CIERRA #349;

     enModelo = nModelo;
|FPRC;

|PROCESO PonCasilla;
     |SI #103#5 = "N";     |ACABA;  |FINSI;

     nDepartamento = nDepar;
     |SI #999#1 ! nDepar;
         |SI #103#29 = "N";  || no es iva comun
             |ACABA;
         |FINSI;
         |SI enActividad ! enActPrinci;  || si no es la principal, nada
             |ACABA;
         |FINSI;
         nNume = enActividad;
         enActividad = nDepar;
         |HAZ eTipoEmpModelo;
         enActividad = nNume;
         |SI enSwTipoAct = 1;
             |ACABA;            || se pasa en la actividad correspondiente
         |FINSI;
         nDepartamento = enActividad;
     |FINSI;

     #300#0  = enEmpresa;
     #300#1  = enEjer;
     #300#2  = enPeriodo;
     #300#3  = enModelo;
     #300#4  = enComplem;
     #300#5  = enActividad;
     #300#6  = nGrupo;
     #300#7  = nSubGrupo;
     |LEE 101#300=;
     |SI FSalida = 0;
         |SI #300#11 = 0;
             |SI nPorce = 0;  |Y nCuota = 0;  |ACABA;  |FINSI;
             nSwEsta = 0;
             |PARA nCampo2 = 15;  |SI nCampo2 [ 24;  |HACIENDO nCampo2 = nCampo2 + 3;
                   nCampo1 = nCampo2 - 1;
                   nCampo3 = nCampo2 + 1;
                   |SI #300nCampo2 = nPorce;
                       #300nCampo1 = #300nCampo1 + nBaseImpo;
                       #300nCampo2 = nPorce;
                       #300nCampo3 = #300nCampo3 + nCuota;
                       nSwEsta = 1;
                       |SAL;
                   |FINSI;
             |SIGUE;

             |SI nSwEsta = 0;
                 |PARA nCampo2 = 15;  |SI nCampo2 [ 24;  |HACIENDO nCampo2 = nCampo2 + 3;
                       nCampo1 = nCampo2 - 1;
                       nCampo3 = nCampo2 + 1;
                       |SI #300nCampo2 = 0; |Y #300nCampo1 = 0;  |Y #300nCampo3 = 0;
                           #300nCampo1 = #300nCampo1 + nBaseImpo;
                           #300nCampo2 = nPorce;
                           #300nCampo3 = #300nCampo3 + nCuota;
                           nSwEsta = 1;
                           |SAL;
                       |FINSI;
                 |SIGUE;
             |FINSI;

             |SI nSwEsta = 0;
                 #300#23 = #300#23 + nBaseImpo;
                 #300#24 = 0;
                 #300#25 = #300#25 + nCuota;
             |FINSI;

             #300#12 = #300#14 + #300#17 + #300#20 + #300#23;
             #300#13 = #300#16 + #300#19 + #300#22 + #300#25;
         |SINO;
             #300#12 = #300#12 + nBaseImpo;
         |FINSI;

         |GRABA 020#300a;
         |LIBERA #300;
     |FINSI;

     |SI #300#6 = 1;  |Y #300#7 = 5;
         |SI nPorce = 0;  |Y nCuota = 0;  |ACABA;  |FINSI;
         nCuota349    = nCuota;
         nBaseImpo349 = nBaseImpo;
         aTipo = "A";
         |SI nCuota < 0; |O nBaseImpo < 0;
             nCuota349    = - nCuota;
             nBaseImpo349 = - nBaseImpo;
             aTipo = "AR";
         |FINSI;
         |HAZ Graba349;
     |FINSI;

     |SI #300#6 = 3;  |Y #300#7 = 9;
         nCuota349    = nCuota;
         nBaseImpo349 = nBaseImpo;
         aTipo = "E";
         |SI nCuota < 0; |O nBaseImpo < 0;
             nCuota349    = - nCuota;
             nBaseImpo349 = - nBaseImpo;
             aTipo = "ER";
         |FINSI;
         |HAZ Graba349;
     |FINSI;
|FPRC;

|PROCESO GrupoSubvencion;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #30#75;
     nCuota    = (nBaseImpo % #30#75) ! EURODBMOD;
     nBaseImpo = 0;

     aAlfa = #103#5;
     #103#5 = "S";
     nGrupo    = 2;
     |SI #30#28 = 0; |O #30#28 = 11;
         nSubGrupo = 11;
         |HAZ PonCasilla;
     |SINO;
         nBaseImpo = 0;
         nCuota    = - nCuota;
         nSubGrupo = #30#28;
         |HAZ PonCasilla;
     |FINSI;
     #103#5 = aAlfa;

     nCampo = 0;
     |SI nSubGrupo = 1;   nCampo = 7;   |FINSI;
     |SI nSubGrupo = 2;   nCampo = 8;   |FINSI;
     |SI nSubGrupo = 3;   nCampo = 9;   |FINSI;
     |SI nSubGrupo = 4;   nCampo = 10;  |FINSI;
     |SI nSubGrupo = 5;   nCampo = 11;  |FINSI;
     |SI nSubGrupo = 6;   nCampo = 12;  |FINSI;
     |SI nSubGrupo = 7;   nCampo = 13;  |FINSI;

     |SI #30#73 = "S";  |Y nCampo ! 0;
         #27nCampo = #27nCampo + nCuota;
     |FINSI;

     |SI #30#26 ! 0; nSwPasa = 1;  |HAZ Grupo1;  |FINSI;
     |SI #30#30 ! 0; nSwPasa = 1;  |HAZ Grupo3;  |FINSI;
     |SI #30#32 ! 0; nSwPasa = 1;  |HAZ Grupo4;  |FINSI;
     |SI #30#34 ! 0; nSwPasa = 1;  |HAZ Grupo5;  |FINSI;
     |SI #30#36 ! 0; nSwPasa = 1;  |HAZ Grupo6;  |FINSI;
|FPRC;

|PROCESO Grupo1;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 1;
     nSubGrupo = #30#26;
     |HAZ PonCasilla;

     |SI #30#73 = "S";
         |SI nCuota ! 0;  #27#4 = #27#4 + nBaseImpo;  |FINSI;
         |SI nCuota = 0;  #27#5 = #27#5 + nBaseImpo;  |FINSI;
     |FINSI;

     |SI #103#10 ! 0;
         nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
         nPorce    = #103#9;
         nCuota    = (#103#10 / enConversor) ! EURODBMOD;
         nGrupo    = 1;
         nSubGrupo = 10;
         |HAZ PonCasilla;
     |FINSI;
|FPRC;

|PROCESO Grupo2;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 2;
     nSubGrupo = #30#28;
     |HAZ PonCasilla;

     nCampo = 0;

     |SI nSubGrupo = 1;   nCampo = 7;   |FINSI;
     |SI nSubGrupo = 2;   nCampo = 8;   |FINSI;
     |SI nSubGrupo = 3;   nCampo = 9;   |FINSI;
     |SI nSubGrupo = 4;   nCampo = 10;  |FINSI;
     |SI nSubGrupo = 5;   nCampo = 11;  |FINSI;
     |SI nSubGrupo = 6;   nCampo = 12;  |FINSI;
     |SI nSubGrupo = 7;   nCampo = 13;  |FINSI;

     |SI #30#73 = "S";  |Y nCampo ! 0;
         #27nCampo = #27nCampo + nCuota;
     |FINSI;
|FPRC;

|PROCESO Grupo3;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 8;
     nSubGrupo = #30#30;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo4;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 9;
     nSubGrupo = #30#32;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo5;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 3;
     nSubGrupo = #30#34;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo6;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 4;
     nSubGrupo = #30#36;
     |HAZ PonCasilla;
|FPRC;

|PROCESO LeeLinea;
    aAlfa1 = #103#30; |QBF aAlfa1; |SI aAlfa1 = ""; #103#30 = #102#10; |FINSI;
    |SI aMulDep = "S";
        nDepar = #103#30;
        |SI nDepar = 0;  nDepar = 1;   |FINSI;
        |ABRE #214;
        #214#0 = #999#0;
        #214#1 = nDepar;
        |LEE 040#214=;
        |SI FSalida ! 0;  nDepar = 1;  |FINSI;
        |CIERRA #214;
        nDepartamento = nDepar;
    |FINSI;

     nSwPasa = 0;
     #30#0 = #103#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #30#4 = "N";  |ACABA;  |FINSI;

     |SI #30#74 = "N";
         |SI #30#26 ! 0; nSwPasa = 1;  |HAZ Grupo1;  |FINSI;
         |SI #30#28 ! 0; nSwPasa = 1;  |HAZ Grupo2;  |FINSI;
         |SI #30#30 ! 0; nSwPasa = 1;  |HAZ Grupo3;  |FINSI;
         |SI #30#32 ! 0; nSwPasa = 1;  |HAZ Grupo4;  |FINSI;
         |SI #30#34 ! 0; nSwPasa = 1;  |HAZ Grupo5;  |FINSI;
         |SI #30#36 ! 0; nSwPasa = 1;  |HAZ Grupo6;  |FINSI;
     |SINO;
         |SI #30#0 > 800; |Y #30#0 < 900;
             nSwPasa = 1; |HAZ GrupoSubvencion;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE caivalin;
     #103#1;
     ;
     #102#0, #102#1, 01;
     #102#0, #102#1, 99;
     ;
     NULL, LeeLinea;
|FIN;

|PROCESO LeeCabecera;
    nDepar = #102#10;
    |SI aMulDep ! "S";
        |SI nDepar = 0;  nDepar = 1;   |FINSI;
    |FINSI;

    |ABRE #214;
    #214#0 = #999#0;
    #214#1 = nDepar;
    |LEE 040#214=;
    |SI FSalida ! 0;  nDepar = 1;  |FINSI;
    |CIERRA #214;

     |ABRE #105;
     |DDEFECTO #105;
     #105#0 = #102#0;
     #105#1 = #102#1;
     |LEE 040#105=;
     |CIERRA #105;

     nDepartamento = nDepar;
     |BUCLE caivalin;

     |SI #999#1 ! nDepartamento;  |ACABA;  |FINSI;

     |SI nSwPasa = 0;  |ACABA;  |FINSI;

     |SI #102#40 = 0;  #102#40 = nHPeriodo;  |FINSI;

     |GRABA 020#102a;
     |LIBERA #102;
|FPRC;

|DEFBUCLE camaniva;
     #102#1;
     5;
     00, 0000000000, nDPeriodo;
     99, 9999999999, nHPeriodo;
     be;
     NULL, LeeCabecera;
|FIN;

|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
|PROCESO Compensa165;

   |ABRE #165;
   #165#0 = #1300#0;
   #165#1 = #1300#1;
   #165#2 = #300#2;
   #165#3 = #1300#3;
   #165#4 = #1300#4;
   #165#5 = #1300#5;
   #165#6 = #1300#6;
   #165#7 = #1300#7;
   |LEE 101#165=;
   |SI FSalida ! 0;
       |DDEFECTO #165;
       #165#0 = #1300#0;
       #165#1 = #1300#1;
       #165#2 = #300#2;
       #165#3 = #1300#3;
       #165#4 = #1300#4;
       #165#5 = #1300#5;
       #165#6 = #1300#6;
       #165#7 = #1300#7;
       |GRABA 020#165b;
   |FINSI;
   #165#10 = #165#10 - #1300#10;
   #165#12 = #165#12 - #1300#12;

   #165#13 = #165#13 - #1300#13;
   #165#15 = #165#15 - #1300#15;

   #165#16 = #165#16 - #1300#16;
   #165#18 = #165#18 - #1300#18;

   #165#19 = #165#19 - #1300#19;
   #165#21 = #165#21 - #1300#21;

   #165#8 = #165#10 + #165#13 + #165#16 + #165#19;
   #165#9 = #165#12 + #165#15 + #165#18 + #165#21;

   |GRABA 020#165a;
   |LIBERA #165;
   |CIERRA #165;
|FPRC;

|DEFBUCLE dsmocivp;
     #1300#1008;
     ;
     #300#0, #300#1, 1,        #300#3, #300#4, #300#5, 2, 00;
     #300#0, #300#1, nPeriodo, #300#3, #300#4, #300#5, 2, 99;
     ;
     NULL, Compensa165;
|FIN;

|PROCESO CalResto;
  nNume1 = (nCanti % enNPro1) ! EURODBMOD;
  nNume2 = (nCanti % enNPro2) ! EURODBMOD;

  nCanti = nNume1 - nNume2;
|FPRC;

|PROCESO Cal_dsmocivp;

   |SI enEjer ] enEjerPro; |ACABA; |FINSI; || calculo anterior

   |SI enPeriodo ! 12; |ACABA; |FINSI;
   |SI enSwPorCom = 0; |ACABA; |FINSI;

   |SI #1300#7 = 5; |O #1300#7 = 6; |O #1300#7 ] 10; |ACABA; |FINSI;


   |ABRE #165;
   #165#0 = #300#0;
   #165#1 = #300#1;
   #165#2 = #300#2;
   #165#3 = #300#3;
   #165#4 = #300#4;
   #165#5 = #300#5;
   #165#6 = #300#6;
   #165#7 = #300#7;
   |LEE 101#165=;
   |SI FSalida ! 0;
       |DDEFECTO #165;
       #165#0 = #300#0;
       #165#1 = #300#1;
       #165#2 = #300#2;
       #165#3 = #300#3;
       #165#4 = #300#4;
       #165#5 = #300#5;
       #165#6 = #300#6;
       #165#7 = #300#7;
       |GRABA 020#165b;
   |FINSI;

   nCanti  = #1300#14; |HAZ CalResto; #165#10 = #165#10 + nCanti;
   #165#11 = #1300#15;
   nCanti  = #1300#16; |HAZ CalResto; #165#12 = #165#12 + nCanti;

   nCanti  = #1300#17; |HAZ CalResto; #165#13 = #165#13 + nCanti;
   #165#14 = #1300#18;
   nCanti  = #1300#19; |HAZ CalResto; #165#15 = #165#15 + nCanti;

   nCanti  = #1300#20; |HAZ CalResto; #165#16 = #165#16 + nCanti;
   #165#17 = #1300#21;
   nCanti  = #1300#22; |HAZ CalResto; #165#18 = #165#18 + nCanti;

   nCanti  = #1300#23; |HAZ CalResto; #165#19 = #165#19 + nCanti;
   #165#20 = #1300#24;
   nCanti  = #1300#25; |HAZ CalResto; #165#21 = #165#21 + nCanti;

   #165#8 = #165#10 + #165#13 + #165#16 + #165#19;
   #165#9 = #165#12 + #165#15 + #165#18 + #165#21;

   |GRABA 020#165a;
   |LIBERA #165;
   |CIERRA #165;
   nSwSi = 1;
|FPRC;

|| /////////////////////////////////////////////////////////////////////
|PROCESO Compensa300;
     |SI #1300#6 = 5;  |ACABA;  |FINSI;

     |SI #1300#6 = 2; |Y enEjer < enEjerPro;
         enActividad = #1300#5;
         enPerPro    = #1300#2;
         |SI enPeriodo = 12; |Y enSwPorCom = 1;
             |HAZ eVeoPrAplicada;
         |FINSI;
     |FINSI;

     #300#0 = #1300#0;
     #300#1 = #1300#1;
     #300#2 = #999#3;
     #300#3 = #999#7;
     #300#4 = #999#4;
     #300#5 = #1300#5;
     #300#6 = #1300#6;
     #300#7 = #1300#7;
     |LEE 101#300=;
     |SI FSalida = 0;

         |SI #1300#6 = 2; |HAZ Cal_dsmocivp; |FINSI;

         |SI #300#15 = 0;  |Y #300#18 = 0;  |Y #300#21 = 0;  |Y #300#24 = 0;
             #300#15 = #1300#15;
             #300#18 = #1300#18;
             #300#21 = #1300#21;
             #300#24 = #1300#24;
         |FINSI;

         |SI #300#12 ! 0;  |Y #300#14 = 0;  |Y #300#17 = 0; |Y #300#20 = 0;  |Y #300#23 = 0;
             #300#12 = #300#12 - #1300#12;
         |SINO;
             |PARA nCampo2 = 15;  |SI nCampo2 [ 24;  |HACIENDO nCampo2 = nCampo2 + 3;
                   nCampo1     = nCampo2 - 1;
                   nCampo3     = nCampo2 + 1;
                   nCompensado = 0;
                   |PARA nCampo22 = 15;  |SI nCampo22 [ 24;  |HACIENDO nCampo22 = nCampo22 + 3;
                         nCampo11 = nCampo22 - 1;
                         nCampo33 = nCampo22 + 1;
                         |SI #300nCampo22 = #1300nCampo2;
                             #300nCampo11 = #300nCampo11 - #1300nCampo1;
                             #300nCampo33 = #300nCampo33 - #1300nCampo3;
                             nCompensado = 1;
                             |SAL;
                         |FINSI;
                    |SIGUE;

                    |SI nCompensado = 0;
                        |SI #300#14 = 0;  |Y #300#15 = 0;  |Y #300#16 = 0;
                            #300#14     = #300#14 - #1300nCampo1;
                            #300#15     = #1300nCampo2;
                            #300#16     = #300#16 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#17 = 0;  |Y #300#18 = 0;  |Y #300#19 = 0;
                            #300#17     = #300#17 - #1300nCampo1;
                            #300#18     = #1300nCampo2;
                            #300#19     = #300#19 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#20 = 0;  |Y #300#21 = 0;  |Y #300#22 = 0;
                            #300#20     = #300#20 - #1300nCampo1;
                            #300#21     = #1300nCampo2;
                            #300#22     = #300#22 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#23 = 0;  |Y #300#24 = 0;  |Y #300#25 = 0;
                            #300#23     = #300#23 - #1300nCampo1;
                            #300#24     = #1300nCampo2;
                            #300#25     = #300#25 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;
             |SIGUE;

             #300#12 = #300#14 + #300#17 + #300#20 + #300#23;
             #300#13 = #300#16 + #300#19 + #300#22 + #300#25;
         |FINSI;

         |GRABA 020#300a;
         |LIBERA #300;
     |FINSI;
|FPRC;

|DEFBUCLE dsmociva;
     #1300#1008;
     ;
     #999#0, #999#2, nPeriodo, nModBucle, 00, #999#1, 1, 00;
     #999#0, #999#2, nPeriodo, nModBucle, 99, #999#1, 9, 99;
     ;
     NULL, Compensa300;
|FIN;

|PROCESO Compensa349;
||     |SI #1300#6 ! "A "; |Y #1300#6 ! "E ";  |ACABA;  |FINSI;

     #349#0  = #1300#0;
     #349#1  = #1300#1;
     #349#2  = #999#3;
     #349#3  = #1300#3;
     #349#4  = #1300#4;
     #349#5  = #1300#5;
     #349#6  = #1300#6;
     #349#7  = #1300#7;
     #349#25 = #1300#25;
     #349#26 = #1300#26;
     |LEE 101#349=;
     |SI FSalida = 0;
         #349#22 = #349#22 - #1300#22;

         |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
                      nCampo11 = nCampo22 - 1;
                      nCampo33 = nCampo22 + 1;
                      |SI #349nCampo22 = #1300nCampo2;
                          #349nCampo11 = #349nCampo11 - #1300nCampo1;
                          #349nCampo33 = #349nCampo33 - #1300nCampo3;
                          |SAL;
                      |FINSI;
                |SIGUE;
         |SIGUE;

         |GRABA 020#349a;
         |LIBERA #349;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc349;
     #1300#1010;
     ;
     #999#0, #999#2, nPeriodo, 349, 0, #999#1, "A ", 0000, 0, "            ";
     #999#0, #999#2, nPeriodo, 349, 0, #999#1, "E ", 9999, 9, "zzzzzzzzzzzz";
     ;
     NULL, Compensa349;
|FIN;

|PROCESO BorraCero349;
||     |SI #349#6 ! "A "; |Y #349#6 ! "E ";  |ACABA;  |FINSI;
     |SI #349#22 ! 0;   |ACABA;  |FINSI;

     |BORRA 020#349a;
     |LIBERA #349;
|FPRC;

|DEFBUCLE dsmoc349Cero;
     #349#1;
     ;
     #999#0, #999#2, #999#3, 349, 0, #999#1, "A ", 0000, 0, "            ";
     #999#0, #999#2, #999#3, 349, 0, #999#1, "E ", 9999, 9, "zzzzzzzzzzzz";
     be;
     NULL, BorraCero349;
|FIN;

|PROCESO Contabilidad;

     enEmpresa   = #999#0;
     enEjer      = #999#2;
     enSwOpPar   = 0;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         aAlfa = #999#2;
         aAlfa = aAlfa % -102;
         nEjer = aAlfa;

         |ABRE #101;
         |SELECT #4#101;
         #101#2  = #999#0;
         #101#26 = nEjer;
         |LEE 040#101=;
         |SI FSalida ! 0;  |CIERRA #101;  |ACABA;   |FINSI;
         |CIERRA #101;

         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";

         enEmpresa  = #101#2;
         enPerConta = #101#3;
         eaLaMonEmp = #101#28;
     |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
     |FINSI;
     |HAZ EnConversor;


     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;
     |PATH_DAT #105 aPathConta;

     |ABRE #104;
     |LEE 040#104p;
     |SI FSalida ! 0;  |DDEFECTO #104;  |FINSI;
     |CIERRA #104;
     aMulDep = #104#132;

     |SI #104#46 = "T";
         |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
         |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
         |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
         |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
         |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
         |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
         |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
     |SINO;
         |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
         |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
         |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
         |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
         |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
         |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
         |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
         |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
         |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
         |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
     |FINSI;

     |ABRE #27;
     #27#0 = #999#0;
     #27#1 = #999#2;
     |LEE 101#27=;
     |SI FSalida ! 0;
         |DDEFECTO #27;
         #27#0 = #999#0;
         #27#1 = #999#2;
         |GRABA 020#27b;
     |FINSI;

     |PDEFECTO #27, 4, 39;

     |ABRE #30;
     |BUCLE camaniva;
     |CIERRA #30;

     |GRABA 020#27a;
     |LIBERA #27;
     |CIERRA #27;

     |SI enSwPartido = 1;
         enSwOpPar   = 1;
         |HAZ FinalPartido;
     |FINSI;

|FPRC;

|PROCESO Anterior300;
     #300#0 = #1300#0;
     #300#1 = #999#2;
     #300#2 = #999#3;
     #300#3 = #1300#3;
     #300#4 = #1300#4;
     #300#5 = #1300#5;
     #300#6 = #1300#6;
     #300#7 = #1300#7;
     |LEE 101#300=;
     |SI FSalida ! 0;
         |DDEFECTO #300;
         #300#0 = #1300#0;
         #300#1 = #999#2;
         #300#2 = #999#3;
         #300#3 = #1300#3;
         #300#4 = #1300#4;
         #300#5 = #1300#5;
         #300#6 = #1300#6;
         #300#7 = #1300#7;
         |GRABA 020#300b;
     |FINSI;

     |PARA nCampo = 8;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
           #300nCampo = #1300nCampo;
     |SIGUE;

     |GRABA 020#300a;
     |LIBERA #300;
|FPRC;

|DEFBUCLE dsmocivaA;
     #1300#1008;
     ;
     #999#0, nAnyo, nPeriodo, 300, 00, #999#1, 1, 00;
     #999#0, nAnyo, nPeriodo, 300, 99, #999#1, 9, 99;
     ;
     NULL, Anterior300;
|FIN;

|PROCESO PaseAnterior300;
     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/dsmociva.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nAnyo = #999#2;
     |SI #999#3 = 3;
         nAnyo = #999#2 - 1;
         nPeriodo = 12;
     |SINO;
         nPeriodo = #999#3 - 3;
     |FINSI;

     |ABRE #300;
     |BUCLE dsmocivaA;
     |CIERRA #300;

     |DESCARGA_DEF #espejo1@;
|FPRC;

|PROCESO PaseContabilidad;
     |SI enActividad ! 99;
         |HAZ Contabilidad;
     |FINSI;

     |SI #999#3 ! 1;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmociva.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida = 0;
             |PARA nPeriodo = 1;  |SI nPeriodo < #999#3;  |HACIENDO nPeriodo = nPeriodo + 1;
                   enPerPro = -1;
                   |SI #999#7 = 300;  |O #999#7 = 370;
                       nModBucle = 300;  |BUCLE dsmociva;
                       nModBucle = 370;  |BUCLE dsmociva;
                   |SINO;
                       nModBucle = #999#7;  |BUCLE dsmociva;
                   |FINSI;
             |SIGUE;
         |FINSI;
         |DESCARGA_DEF #espejo1@;

         |SI enPeriodo = 12; |Y enSwPorCom = 1;
             |DBASE aPathModelo;  |QBT aPathModelo;
             aDef = aPathModelo + "def/dsmocivp.mas";
             |CARGA_DEF aDef, espejo1@;
             |SI FSalida = 0;
                 nPeriodo = #999#3 - 1;
                 |BUCLE dsmocivp;
             |FINSI;
             |DESCARGA_DEF #espejo1@;
         |FINSI;

         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc349.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida = 0;
             |ABRE #349;
             |PARA nPeriodo = 1;  |SI nPeriodo < #999#3;  |HACIENDO nPeriodo = nPeriodo + 1;
                   |BUCLE dsmoc349;
             |SIGUE;
             |CIERRA #349;
         |FINSI;

         |DESCARGA_DEF #espejo1@;

         |BUCLE dsmoc349Cero;
     |FINSI;
|FPRC;


|PROCESO Pase300;

     enEmpresa = #999#0;
     |HAZ eLaActivPrin;

     nSwSi = 0;
     |DDEFECTO #8;
     |ABRE #8;
     #8#0 = #999#0;
     #8#1 = #999#2;
     #8#2 = #999#3;
     #8#3 = #999#7;
     #8#4 = 0;
     #8#5 = #999#1;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS";
         |GRABA 020#8a;

         enEmpresa     = #8#0;
         enEjer        = #8#1;
         enPeriodo     = #8#2;
         enModelo      = #8#3;
         enComplem     = #8#4;
         enActividad   = #8#5;
         enTipoEntrada = 97;
         |SUB_EJECUTA_NP "dsmociva";
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = 0;
     enActividad   = #999#1;
     enTipoEntrada = 90;
     |SUB_EJECUTA_NP "dsmociva";

     enNPro1 = nProrrata;
     |ABRE #300;
     |SI enAnterior = 1;         || Recogida de un Periodo Anterior
         |HAZ PaseAnterior300;
     |SINO;
         |HAZ PaseContabilidad;
     |FINSI;
     |CIERRA #300;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = 0;
     enActividad   = #999#1;
     enTipoEntrada = 96;
     eaNombreAct   = #999#6;
     enModelo349   = #999#7;
     |SUB_EJECUTA_NP "dsmoc349";

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = 0;
     enActividad   = #999#1;
     enTipoEntrada = 95;
     |SUB_EJECUTA_NP "dsmociva";

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = 0;
     enActividad   = #999#1;
     enTipoEntrada = 91;
     |SUB_EJECUTA_NP "dsmociva";

     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = 0;
     |LEE 101#4=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         #4#9 = " ";
         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;

     |SI nSwSi = 0;
         |ABRE #8;
         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = enPeriodo;
         #8#3 = enModelo;
         #8#4 = enComplem;
         #8#5 = enActividad;
         |LEE 101#8=;
         |SI FSalida = 0;
             #8#13 = "N";
             |GRABA 020#8a;
         |FINSI;
         |LIBERA #8;
         |CIERRA #8;
     |SINO;
         |HAZ GraboRestoPror;
     |FINSI;
|FPRC;
