|FICHEROS;
     dsmoy054 #0;

     :/basica/def/agifigen    #10;
     :/basica/def/agiprovi    #11;
     :/basica/def/agipobla    #12;
     :/basica/def/agim0024    #13;

     :/integral/def/dsam0000  #20;
     :/integral/def/dsam0100  #21;
     :/integral/def/dsam0101  #22;
     :/integral/def/dsam0005  #23;


     pdfimtmp #100;
     pdfdocca;
     pdfdocli;
|FIN;

|VARIABLES;
     aBase = "";
     nCanal = 0;
     enSwDeDonde = 0;
     aValor = "";
     aCampo = "";
     &aArchivo = "";
     swCarga = 0;
     &aID = "";

     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aAlfa4 = "";
     aAlfa5 = "";
     aMes = "";

     aCif = "";
     aRazonSocial = "";
     aNombre = "";
     aSigla = "";
     aDireccion = "";
     aNumero = "";
     aEscalera = "";
     aPiso = "";
     aPuerta = "";
     aProvincia = "";
     aPoblacion = "";
     aCodPostal = "";
     aTelefono = "";

     rNif = "";
     rNombre = "";
     rDireccion = "";
     rNumero = "";
     rEscalera = "";
     rPiso = "";
     rPuerta = "";
     rProvincia = "";
     rPoblacion = "";
     rCodPostal = "";
     rTelefono = "";

     eNombre = "";
     eSigla = "";
     eDireccion = "";
     eNumero = "";
     eEscalera = "";
     ePiso = "";
     ePuerta = "";
     eProvincia = "";
     ePoblacion = "";
     eCodPostal = "";
     eRazonSocial = "";

     aLongitud = "";
     nLongitud = "";
     aCaracter = "";
     aCaracterSal = "";
     aCadena = "";
     aCadenaSal = "";
     nPos = 0;
     nBusca = 0;
     nAscii = 0;
|FIN;

|PROCESO Poblacion_Basica;
     #11#0 = #10#19;
     |LEE 000#11=;
     |SI FSalida = 0;
          aProvincia = #11#1;
          #12#0 = #11#0;
          #12#1 = #10#20;
          |LEE 000#12=;
          |SI FSalida = 0;
               aPoblacion = #12#2;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO pob_int;
     #21#0 = #20#25;
     |LEE 000#21=;
     |SI FSalida = 0;
          aProvincia = #21#1;
          #22#0 = #21#0;
          #22#1 = #20#26;
          |LEE 000#22=;
          |SI FSalida = 0;
               aPoblacion = #22#2;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO pob_int_notif;
     #21#0 = #23#9;
     |LEE 000#21=;
     |SI FSalida = 0;
          eProvincia = #21#1;
          #22#0 = #21#0;
          #22#1 = #23#10;
          |LEE 000#22=;
          |SI FSalida = 0;
               ePoblacion = #22#2;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Domic_Notif;
     |SI #0#10 = 1; |ACABA;   |FINSI;
     |SI enSwDeDonde = 1;
          #23#0 = #0#0;
          #23#1 = 99;
          |LEE 000#23=;
          |SI FSalida = 0;
               eRazonSocial = aRazonSocial;    || Nombre
               eSigla = #23#3;         || Sigla Direccion
               eDireccion = #23#4;     || Direccion
               eNumero = #23#5;         || Numero
               eEscalera = #23#6;       || Escalera
               ePiso = #23#7;           || Piso
               ePuerta = #23#8;         || Puerta
               aAlfa1 = #23#9;          || Provincia
               aAlfa1 = "00" + aAlfa1;
               aAlfa1 = aAlfa1 % -102;
               aAlfa2 = #23#10;         || Localidad
               aAlfa2 = "000" + aAlfa2;
               aAlfa2 = aAlfa2 % -103;
               eCodPostal = aAlfa1 + aAlfa2;
               |HAZ pob_int_notif;
          |FINSI;
     |SINO;
          eRazonSocial = aRazonSocial;    || Nombre
          eSigla = aSigla;         || Sigla Direccion
          eDireccion = aDireccion;     || Direccion
          eNumero = aNumero;         || Numero
          eEscalera = aEscalera;       || Escalera
          ePiso = aPiso;           || Piso
          ePuerta = aPuerta;         || Puerta
          eCodPostal = aCodPostal;
          eProvincia = aProvincia;
          ePoblacion = aPoblacion;
     |FINSI;
|FPRC;

|PROCESO Datos_Rep;
     |SI #13#15 = "R"; |O #13#15 = "D";
          rNif = #13#3;            || NIF
          rNombre = #13#4;         || Nombre
          rDireccion = #13#7;      || Direccion
          rNumero = #13#8;         || Numero
          || rEscalera = #20#22;       || Escalera
          || rPiso = #20#23;           || Piso
          || rPuerta = #20#24;         || Puerta
          aAlfa1 = #13#9;          || Provincia
          aAlfa1 = "00" + aAlfa1;
          aAlfa1 = aAlfa1 % -102;
          aAlfa2 = #13#10;         || Localidad
          aAlfa2 = "000" + aAlfa2;
          aAlfa2 = aAlfa2 % -103;
          rCodPostal = aAlfa1 + aAlfa2;
          rPoblacion = #13#11;
          rProvincia = #13#12;
          rTelefono = #13#13;      || Telefono
     |FINSI;
|FPRC;

|DEFBUCLE Datos_Rep;
     #13#1;
     ;
     #0#0,  1,  1;
     #0#0, 99, 99;
     ;
     NULL, Datos_Rep;
|FIN;

|PROCESO Datos_Empresa;
     |SI enSwDeDonde = 1;
          #20#0 = #0#0;       || el dsam000: Integral
          |LEE 000#20=;
          |SI FSalida ! 0;
               aAlfa1 = #0#0;
               aAlfa1 = "00000" + aAlfa1;
               aAlfa1 = aAlfa1 % -105;
               aAlfa2 = "    La Empresa " + aAlfa1 + " no existe";
               |MENAV aAlfa2;
          |SINO;
               aCif = #20#3;            || CIF
               aRazonSocial = #20#1;    || Nombre
               aNombre = #20#2;         || Nombre Comercial
               aSigla = #20#19;         || Sigla Direccion
               aDireccion = #20#20;     || Direccion
               aNumero = #20#21;         || Numero
               aEscalera = #20#22;       || Escalera
               aPiso = #20#23;           || Piso
               aPuerta = #20#24;         || Puerta
               aAlfa1 = #20#25;          || Provincia
               aAlfa1 = "00" + aAlfa1;
               aAlfa1 = aAlfa1 % -102;
               aAlfa2 = #20#26;         || Localidad
               aAlfa2 = "000" + aAlfa2;
               aAlfa2 = aAlfa2 % -103;
               aCodPostal = aAlfa1 + aAlfa2;
               |HAZ pob_int;
               aTelefono = #20#54;      || Telefono
          |FINSI;
     |SINO;
          #10#0 = #0#0;
          |LEE 000#10=;
          |SI FSalida ! 0;
               aAlfa1 = #0#0;
               aAlfa1 = "00000" + aAlfa1;
               aAlfa1 = aAlfa1 % -105;
               aAlfa2 = "    La Empresa " + aAlfa1 + " no existe";
               |MENAV aAlfa2;
          |SINO;
               aCif = #10#13;           || CIF
               aRazonSocial = #10#1;    || Razon Social
               aNombre = #10#2;         || Nombre
               aSigla = #10#3;          || Sigla Direccion
               aDireccion = #10#4;      || Direccion
               aNumero = #10#5;         || Numero
               aEscalera = #10#6;       || Escalera
               aPiso = #10#7;           || Piso
               aPuerta = #10#8;         || Puerta
               aAlfa1 = #10#9;          || Provincia
               aAlfa1 = "00" + aAlfa1;
               aAlfa1 = aAlfa1 % -102;
               aAlfa2 = #10#10;         || Localidad
               aAlfa2 = "000" + aAlfa2;
               aAlfa2 = aAlfa2 % -103;
               aCodPostal = aAlfa1 + aAlfa2;
               |HAZ Poblacion_Basica;
               aTelefono = #10#14;      || Telefono
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DeDonde;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
          enSwDeDonde = 1;
          |ABRE #20;
          |ABRE #21;
          |ABRE #22;
          |ABRE #23;
     |SINO;
          enSwDeDonde = 0;
          |ABRE #10;
          |ABRE #11;
          |ABRE #12;
          |ABRE #13;
     |FINSI;
|FPRC;

|PROCESO PintaEmpresa;
     |SI enSwDeDonde = 1;
          #20#0 = #0#0;
          |LEE 000#20=;
          |SI FSalida = 0;
               |PINTA 1138, #20#1;
          |SINO;
               |MENAV "    Codigo de empresa no existe";
               |ERROR;
          |FINSI;
     |SINO;
          #10#0 = #0#0;
          |LEE 000#10=;
          |SI FSalida = 0;
               |PINTA 1138, #10#1;
          |SINO;
               |MENAV "    Codigo de empresa no existe";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Periodo;
     aMes = "00" + aMes;
     aMes = aMes % -102;
     |SI aMes = "01"; aMes = "Enero     "; |FINSI;
     |SI aMes = "02"; aMes = "Febrero   "; |FINSI;
     |SI aMes = "03"; aMes = "Marzo     "; |FINSI;
     |SI aMes = "04"; aMes = "Abril     "; |FINSI;
     |SI aMes = "05"; aMes = "Mayo      "; |FINSI;
     |SI aMes = "06"; aMes = "Junio     "; |FINSI;
     |SI aMes = "07"; aMes = "Julio     "; |FINSI;
     |SI aMes = "08"; aMes = "Agosto    "; |FINSI;
     |SI aMes = "09"; aMes = "Septiembre"; |FINSI;
     |SI aMes = "10"; aMes = "Octubre   "; |FINSI;
     |SI aMes = "11"; aMes = "Noviembre "; |FINSI;
     |SI aMes = "12"; aMes = "Diciembre "; |FINSI;
|FPRC;

|PROCESO sustituye2;
     nAscii = & aCaracter;
     aCaracterSal = aCaracter;
     ||SI nAscii = 160;
     |SI nAscii = 225;
          aCaracterSal = "\341";        || la a con tilde
     |FINSI;
     ||SI nAscii = 160;
     |SI nAscii = 233;
          aCaracterSal = "\351";        || la e con tilde
     |FINSI;
     ||SI nAscii = 160;
     |SI nAscii = 237;
          aCaracterSal = "\355";        || la i con tilde
     |FINSI;
     ||SI nAscii = 160;
     |SI nAscii = 243;
          aCaracterSal = "\363";        || la o con tilde
     |FINSI;
     ||SI nAscii = 160;
     |SI nAscii = 250;
          aCaracterSal = "\372";        || la u con tilde
     |FINSI;
     ||SI nAscii = 160;
     |SI nAscii = 241;
          aCaracterSal = "\361";        || la ¤ con tilde
     |FINSI;
|FPRC;

|PROCESO sustituye;
     aCadenaSal = "";
     aLongitud = aCadena % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
          nBusca = (nPos * 100) + 1;
          aCaracter = aCadena % nBusca;
          |HAZ sustituye2;
          aCadenaSal = aCadenaSal + aCaracterSal;
     |SIGUE;
|FPRC;

|PROCESO CargaCampos;
     aValor = "";
     aCampo = #pdfdocli#2;
     aCadena = aCampo;
     |QBF aCadena;
     |HAZ sustituye;
     aCampo = aCadenaSal;
     |QBF aCampo;
     |SI aCampo = "delegaci\363n";  ||  delegacion
          aValor = #0#8;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "nota";   ||  Hojas adicionales
          aValor = #0#1;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "antecedentes";  ||  antecedentes
          aAlfa2 = #0#2; |QBF aAlfa2;
          aAlfa3 = #0#3; |QBF aAlfa3;
          aAlfa4 = #0#4; |QBF aAlfa4;
          aAlfa5 = #0#5; |QBF aAlfa5;
          aValor = "Se ha presentado el alta en I.A.E., con el modelo 703, n\372mero de refe";
          aValor = aValor + "rencia " + aAlfa2 +",\en fecha " + aAlfa3 + ", en el ep\355grafe " + aAlfa4 + ", de\";
          aValor = aValor + " la secci\363n " + aAlfa5 + "."
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "solicita";  || solicita (marcar una X)
          aValor = "X" ;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "documentaci\363n";  || documentacion (va fijo)
          aValor = "Fotocopia del modelo 703";
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "p\341ginas";  || paginas (una, va fijo)
          aValor = "1";
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "lugar";  ||
          aAlfa1 = #0#6;
          |QBF aAlfa1;
          aValor = aAlfa1;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "d\355a";  ||
          aAlfa1 = #0#7
          aAlfa1 = aAlfa1 % 102;
          aValor = aAlfa1;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "mes";  ||
          aAlfa1 = #0#7
          aMes = aAlfa1 % 402;
          |HAZ Periodo;
          aValor = aMes;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "a\361o";  ||
          aAlfa1 = #0#7
          aAlfa1 = aAlfa1 % 704;
          aValor = aAlfa1;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "\363rgano";  ||
          aValor = "Gesti\363n del IAE";
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "nif";  ||
          aValor = aCif;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "apellidos";  ||xxx
          aValor = aRazonSocial;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "calle";  ||
          aValor = aSigla + " " + aDireccion;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "n\372mero";  ||
          aValor = aNumero;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "escalera";  ||
          aValor = aEscalera;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "piso";  ||
          aValor = aPiso;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "puerta";  ||
          aValor = aPuerta;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "postal";  ||
          aValor = aCodPostal;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "municipio";  ||
          aValor = aPoblacion;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "provincia";  ||
          aValor = aProvincia;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "tel\351fono";  ||
          aValor = aTelefono;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "nif1";  ||
          aValor = rNif;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "apellidos2";  ||xxx
          aValor = rNombre;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "calle2";  ||
          aValor =  rDireccion;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "n\372mero2";  ||
          aValor = rNumero;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "escalera2";  ||
          aValor = rEscalera;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "piso2";  ||
          aValor = rPiso;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "puerta2";  ||
          aValor = rPuerta;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "postal2";  ||
          aValor = rCodPostal;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "municipio2";  ||
          aValor = rPoblacion;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "provincia2";  ||
          aValor = rProvincia;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "tel\351fono2";  ||
          aValor = rTelefono;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "apellidos1";  ||xxx
          aValor = eRazonSocial;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "calle1";  ||
          aValor =  eSigla + " " + eDireccion;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "n\372mero1";  ||
          aValor = eNumero;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "escalera1";  ||
          aValor = eEscalera;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "piso1";  ||
          aValor = ePiso;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "puerta1";  ||
          aValor = ePuerta;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "postal1";  ||
          aValor = eCodPostal;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "municipio1";  ||
          aValor = ePoblacion;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "povincia1";  ||
          aValor = eProvincia;
          |HAZ GrabaTemporal;
     |FINSI;
|FPRC;

|PROCESO GrabaTemporal;
     #pdfimtmp#0 = aCampo;
     #pdfimtmp#1 = aValor;
     |GRABA 020#pdfimtmp.n;
|FPRC;

|DEFBUCLE GrabaTemporal;
     #pdfdocli#1;
     ;
     aArchivo,   1;
     aArchivo, 999;
     ;
     NULL, CargaCampos;
|FIN;

|PROCESO CargaTemporal;
     #pdfdocca#0 = aArchivo;
     |LEE 000#pdfdocca.=;
     |SI FSalida ! 0;
          aAlfa1 = "    Archivo " + aArchivo + " no encontrado en el Mantenimiento ";
          aAlfa1 = aAlfa1 + "de ficheros PDF.";
          |MENAV aAlfa1;
          |ACABA;
          swCarga = 0;
     |SINO;
          aID = #pdfdocca#2;
     |FINSI;
     |BUCLE GrabaTemporal;
|FPRC;

|PROCESO BuscaArchivo;
     aArchivo = "exencion.pdf";
|FPRC;

|PROCESO ImpresionPDF;
     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("c" + aAlfa1) % 108;
     |NOME_DAT #100 aAlfa1;
     |DELINDEX #pdfimtmp;
     |ABRE #pdfimtmp;
     |ABRE #pdfdocca;
     |ABRE #pdfdocli;

     |HAZ BuscaArchivo;
     |HAZ CargaTemporal;

     |CIERRA #pdfimtmp;
     |CIERRA #pdfdocca;
     |CIERRA #pdfdocli;

     |SUB_EJECUTA "pdfimpre";
|FPRC;

|PROCESO Cierra;
     |SI enSwDeDonde = 1;
          |CIERRA #20;
          |CIERRA #21;
          |CIERRA #22;
          |CIERRA #23;
     |SINO;
          |CIERRA #10;
          |CIERRA #11;
          |CIERRA #12;
          |CIERRA #13;
     |FINSI;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "MODELOS PARA SOLICITUD DE EXENCION DE PAGO DEL I.A.E.";
     |ABRE #0;
     |LEE 110#0p;
     |SI FSalida ! 0;
          |DDEFECTO #0;
          |GRABA 020#0b;
     |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |HAZ DeDonde;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |HAZ Datos_Empresa;
          |BUCLE Datos_Rep;
          |HAZ Domic_Notif;
          |HAZ Cierra;
          |HAZ ImpresionPDF;
     |FINSI;
     |GRABA 020#0a;
     |LIBERA #0;
|FPRO;
