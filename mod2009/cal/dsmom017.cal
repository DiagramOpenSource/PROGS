|FICHEROS;
     dsmom017 #17,MANTE;
     dsmom004 #4;
     dsmom008 #8;
     dsmom018 #18;
     dsmom019 #19;
     dsmom020 #20;
     dsmom021 #21;
     dsmom039 #39;
     dsmoc131 #131;
     dsmoc310 #310;
     dsmom030 #30;
     dsmom041 #41;
     dsmom046 #46;

     dsmoc349 #349;

     :/contagen/def/canempre #101;
     :/contagen/def/camaniva #102;
     :/contagen/def/caivalin #103;
     :/contagen/def/caivaasi #104;
     :/contagen/def/caivam03 #105;

     :/basica/def/agicen14 #214;

     &regisnif@ #709;

     espejo1@ #1300;
|FIN;

|VARIABLES;
     aAlfa      = "";

     nTecla      = 0;
     nSw310      = 0;
     nSw131      = 0;
     nPer        = 0;
     nImporte    = 0;
     nImporte1   = 0;
     nImporte2   = 0;
     nImporte3   = 0;
     nPeriodo    = 0;
     nMod        = 0;
     nModelo     = 0;
     nSwEsta     = 0;
     nCampo1     = 0;
     nCampo2     = 0;
     nCampo3     = 0;
     nPorce      = 0;
     nBaseImpo   = 0;
     nCuota      = 0;
     nTotal      = 0;
     nGrupo      = 0;
     nDepar      = 0;
     nEjer       = 0;
     nAnyoEjer   = 0;
     nAnyoCompra = 0;
     nAnyoHasta  = 0;
     nCampo22    = 0;
     nCampo11    = 0;
     nCampo33    = 0;

     aTipo       = "";
     aPathModelo = "";
     aDef        = "";
     nTPRepar    = 0;
     nExRepar    = 0;
     nIgual      = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Graba349_310;
     nModelo       = enModelo;
     enTipoEntrada = 95;
     enModelo      = 349;
     eaNombreAct   = #214#4;
     enModelo349   = 310;
     |SUB_EJECUTA "dsmoc349";

     eaCodNif = #102#14;
     |HAZ LeeNifs;

     |ABRE #349;
     #349#0  = enEmpresa;
     #349#1  = enEjer;
     #349#2  = enPeriodo;
     #349#3  = enModelo;
     #349#4  = enComplem;
     #349#5  = enActividad;
     #349#6  = aTipo;
     #349#7  = #102#14;
     #349#25 = 0;
     #349#26 = 0;
     |SI aTipo = "ER"; |O aTipo = "AR";
         |SI #105#5 ! 0;
             #349#25 = #105#5; || Ejercicio Declarado;
             #349#26 = #105#4;
         |FINSI;
     |FINSI;
     |LEE 101#349=;
     |SI FSalida ! 0;
         |DDEFECTO #349;
         #349#0  = enEmpresa;
         #349#1  = enEjer;
         #349#2  = enPeriodo;
         #349#3  = enModelo;
         #349#4  = enComplem;
         #349#5  = enActividad;
         #349#6  = aTipo;
         #349#7  = #102#14;
         |SI #709#12 !  "   ";  #349#8  = #709#12;  |FINSI;
         #349#9  = #709#1;
         #349#25 = 0;
         #349#26 = 0;
         |SI aTipo = "ER"; |O aTipo = "AR";
             |SI #105#5 ! 0;
                 #349#25 = #105#5; || Ejercicio Declarado;
                 #349#26 = #105#4;
                 #349#27 = #105#6;
             |FINSI;
         |FINSI;
         |GRABA 020#349b;
     |FINSI;

     |SI #349#6 = "A ";
         nSwEsta = 0;
         |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #349nCampo2 = nPorce;
                   #349nCampo1 = #349nCampo1 + nBaseImpo;
                   #349nCampo2 = nPorce;
                   #349nCampo3 = #349nCampo3 + nCuota;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;

         |SI nSwEsta = 0;
             |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
                   nCampo1 = nCampo2 - 1;
                   nCampo3 = nCampo2 + 1;
                   |SI #349nCampo2 = 0; |Y #349nCampo1 = 0;  |Y #349nCampo3 = 0;
                       #349nCampo1 = #349nCampo1 + nBaseImpo;
                       #349nCampo2 = nPorce;
                       #349nCampo3 = #349nCampo3 + nCuota;
                       nSwEsta = 1;
                       |SAL;
                   |FINSI;
              |SIGUE;
         |FINSI;

         |SI nSwEsta = 0;
             #349#19 = #349#19 + nBaseImpo;
             #349#20 = 0;
             #349#21 = #349#21 + nCuota;
         |FINSI;

         #349#22 = #349#10 + #349#13 + #349#16 + #349#19;
     |SINO;
         #349#22 = #349#22 + nBaseImpo;
     |FINSI;

     |GRABA 020#349a;
     |LIBERA #349;
     |CIERRA #349;

     enModelo = nModelo;
|FPRC;

|PROCESO Grupo3_310;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nTotal    = ((#103#6 + #103#8 + #103#10) / enConversor) ! EURODBMOD;

     |SI #30#30 = 2;
         #310#10 = #310#10 + nCuota;
         aTipo = "A";
         |HAZ Graba349_310;
     |FINSI;

    |SI #30#30 = 4;   #310#11 = #310#11 + nCuota;   |FINSI;
    |SI #30#30 = 3;   #310#12 = #310#12 + nCuota;   |FINSI;
|FPRC;

|PROCESO Grupo4_310;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;

     |SI #30#32 = 3;   #310#13 = #310#13 + nCuota;   |FINSI;
|FPRC;

|PROCESO Grupo5_310;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 3;

     |SI #30#34 = 9;                       || Entregas Intracomunitarias
         #310#15 = #310#15 + nCuota;
         aTipo = "E";
         |HAZ Graba349_310;
     |FINSI;
|FPRC;

|PROCESO LeeLinea;
     |SI aMulDep = "S";
         aDepIva = #103#30; |QBF aDepIva; |SI aDepIva = ""; #103#30 = #102#10; |FINSI;
         nDepar = #103#30;
         |SI nDepar = 0;  nDepar = 1;   |FINSI;

         |ABRE #214;
         #214#0 = #19#0;
         #214#1 = nDepar;
         |LEE 040#214=;
         |SI FSalida ! 0;  nDepar = 1;  |FINSI;
         |CIERRA #214;
         |SI #19#3 ! nDepar;  |ACABA;  |FINSI;
     |FINSI;

     |SI #103#5 = "N"; |ACABA;  |FINSI;

     #30#0 = #103#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #30#4  = "N";    |ACABA;  |FINSI;

     |SI #30#30 ! 0; |HAZ Grupo3_310;  |FINSI;
     |SI #30#32 ! 0; |HAZ Grupo4_310;  |FINSI;
     |SI #30#34 ! 0; |HAZ Grupo5_310;  |FINSI;
|FPRC;

|DEFBUCLE caivalin;
     #103#1;
     ;
     #102#0, #102#1, 01;
     #102#0, #102#1, 99;
     ;
     NULL, LeeLinea;
|FIN;

|PROCESO LeeCabecera;
     |SI aMulDep ! "S";
         nDepar = #102#10;
         |SI nDepar = 0;  nDepar = 1;   |FINSI;

         |ABRE #214;
         #214#0 = #19#0;
         #214#1 = nDepar;
         |LEE 040#214=;
         |SI FSalida ! 0;  nDepar = 1;  |FINSI;
         |CIERRA #214;
         |SI #19#3 ! nDepar;  |ACABA;  |FINSI;
     |FINSI;

     |ABRE #105;
     |DDEFECTO #105;
     #105#0 = #102#0;
     #105#1 = #102#1;
     |LEE 040#105=;
     |CIERRA #105;

     |BUCLE caivalin;
     |LIBERA #102;
|FPRC;

|DEFBUCLE camaniva;
     #102#1;
     5;
     00, 0000000000, 01;
     99, 9999999999, 12;
     be;
     NULL, LeeCabecera;
|FIN;

|PROCESO PaseContab;
     enModelo      = nMod;
     enTipoEntrada = 97;
     enModelo349   = 310;
     |SUB_EJECUTA_NP "dsmoc349";

     enModelo      = nMod;

     #310#10 = 0;
     #310#11 = 0;
     #310#12 = 0;
     #310#13 = 0;
     #310#14 = 0;
     #310#15 = 0;

     aAlfa = #19#1;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     enEmpresa   = #19#0;
     enEjer      = #19#1;
     enSwOpPar   = 0;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         aAlfa = #19#1;
         aAlfa = aAlfa % -102;
         nEjer = aAlfa;

         |ABRE #101;
         |SELECT #4#101;
         #101#2  = #19#0;
         #101#26 = nEjer;
         |LEE 040#101=;
         |SI FSalida ! 0;  |CIERRA #101;  |ACABA;   |FINSI;
         |CIERRA #101;

         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";

         enEmpresa  = #101#2;
         enPerConta = #101#3;
         eaLaMonEmp = #101#28;
     |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
     |FINSI;
     |HAZ EnConversor;

     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;
     |PATH_DAT #105 aPathConta;
     |ABRE #caivaasi;
     |DDEFECTO #caivaasi;
     |LEE 000#caivaasi.p;
     |CIERRA #caivaasi;
     aMulDep = #caivaasi#132;

     |ABRE #30;
     |BUCLE camaniva;
     |CIERRA #30;

     |SI enSwPartido = 1;
         enSwOpPar   = 2;
         |HAZ FinalPartido;
     |FINSI;
|FPRC;

|PROCESO LeoDsmom046;
 nExRepar = 1;
 |SI #46#1  = #19#3;
     nIgual = 1;
     nTPRepar = #46#5;
 |FINSI;
|FPRC;

|DEFBUCLE LeoDsmom046;
 #46#1;
 ;
 #41#0, #41#2, #41#3, 01;
 #41#0, #41#2, #41#3, 99;
 e;
 NULL, LeoDsmom046;
|FIN;

|PROCESO Regulariza;
  nTPRepar = 0;
  nExRepar = 0;
  nIgual   = 0;

  |BUCLE LeoDsmom046;
  |SI nExRepar = 0;
      |SI #41#1 = #19#3; nIgual = 1; nTPRepar = 100; |FINSI;
  |FINSI;
  |SI nIgual = 0; |ACABA; |FINSI;  ||No pertenece a la actividad

  ||                            |SI #41#1 ! #19#3;  |ACABA;  |FINSI;

  |SI nTPRepar ! 100;
       #41#10   = (#41#10   % nTPRepar) ! EURODBMOD;
  |FINSI;


     nAnyoEjer = #19#1;

     aAlfa           = #41#27 % -104;
     nAnyoCompra     = aAlfa;

     |SI nAnyoEjer   = nAnyoCompra;   |ACABA;  |FINSI;
     |SI #41#27      ] "01.01.1998";  |ACABA;  |FINSI;
     |SI nAnyoCompra < 1994;          |ACABA;  |FINSI;

     nAnyoHasta = nAnyoCompra + 5;

     |SI nAnyoEjer ] nAnyoHasta;  |ACABA;  |FINSI;

     #310#14 = #310#14 + ((#41#10 % 16) / 5);
|FPRC;

|DEFBUCLE dsmom041;
     #41#1;
     ;
     #19#0, "        ", 00;
     #19#0, "zzzzzzzz", 99;
     ;
     NULL, Regulariza;
|FIN;

|PROCESO Amortizacion;
     |BUCLE dsmom041;
|FPRC;

|PROCESO BajaTrabajador;
     |BORRA 020#20a;
     |LIBERA #20;
|FPRC;

|DEFBUCLE dsmom020;
     #20#1;
     ;
     #17#0, #17#1, #17#2, #17#3, 000;
     #17#0, #17#1, #17#2, #17#3, 999;
     be;
     NULL, BajaTrabajador;
|FIN;

|PROCESO BajaElemFecha;
     |BORRA 020#39a;
     |LIBERA #39;
|FPRC;

|DEFBUCLE dsmom039;
     #39#1;
     ;
     #17#0, #17#1, #17#2, #17#3, 000;
     #17#0, #17#1, #17#2, #17#3, 999;
     be;
     NULL, BajaElemFecha;
|FIN;

|PROCESO BajaElemento;
     |BORRA 020#21a;
     |LIBERA #21;
|FPRC;

|DEFBUCLE dsmom021;
     #21#1;
     ;
     #17#0, #17#1, #17#2, #17#3, 000;
     #17#0, #17#1, #17#2, #17#3, 999;
     be;
     NULL, BajaElemento;
|FIN;

|PROCESO Baja131;
     |DDEFECTO #8;
     |ABRE #8;
     #8#0 = #17#0;
     #8#1 = #17#1;
     #8#2 = nPer;
     #8#3 = 131;
     #8#4 = 0;
     #8#5 = #17#3;
     |LEE 040#8=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     enEmpresa     = #8#0;
     enEjer        = #8#1;
     enPeriodo     = #8#2;
     enModelo      = #8#3;
     enComplem     = #8#4;
     enActividad   = #8#5;
     eaComunidad   = #8#9;
     eaComunero    = #8#10;
     enTipoEntrada = 97;
     |SUB_EJECUTA_NP "dsmoc131";

     #8#0 = #17#0;
     #8#1 = #17#1;
     #8#2 = nPer;
     #8#3 = 131;
     #8#4 = 0;
     #8#5 = #17#3;
     |LEE 101#8=;

     #8#11 = "SIN DATOS";
     |GRABA 020#8a;
     |LIBERA #8;

     |ABRE #4;
     #4#0 = #17#0;
     #4#1 = #17#1;
     #4#2 = nPer;
     #4#3 = enModelo;
     #4#4 = 0;
     |LEE 101#4=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;
     |CIERRA #8;

     enEmpresa   = #17#0;
     enEjer      = #17#1;
     enActividad = #17#3;
|FPRC;

|PROCESO Baja310;
     |DDEFECTO #8;
     nMod = 310;

     |ABRE #8;
     #8#0 = #17#0;
     #8#1 = #17#1;
     #8#2 = nPer;
     #8#3 = 370;
     #8#4 = 0;
     #8#5 = #17#3;
     |LEE 040#8=;
     |SI FSalida = 0;  nMod = 370;  |FINSI;
     |CIERRA #8;

     enEmpresa     = #8#0;
     enEjer        = #8#1;
     enPeriodo     = #8#2;
     enModelo      = nMod;
     enComplem     = #8#4;
     enActividad   = #8#5;
     enTipoEntrada = 97;
     |SUB_EJECUTA_NP "dsmoc310";


     |ABRE #8;
     #8#0 = #17#0;
     #8#1 = #17#1;
     #8#2 = nPer;
     #8#3 = nMod;
     #8#4 = 0;
     #8#5 = #17#3;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS";
         |GRABA 020#8a;
         |LIBERA #8;
     |FINSI;
     |CIERRA #8;

     |ABRE #4;
     #4#0 = #17#0;
     #4#1 = #17#1;
     #4#2 = nPer;
     #4#3 = nMod;
     #4#4 = 0;
     |LEE 101#4=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         |GRABA 020#4a;
         |LIBERA #4;
         |CIERRA #4;
     |FINSI;
|FPRC;

|PROCESO BajaModulo;
     nSw310 = 0;
     nSw131 = 0;

     |ABRE #4;

     |PARA nPer = 3;  |SI nPer [ 12;  |HACIENDO nPer = nPer + 3;
           #4#0 = #17#0;
           #4#1 = #17#1;
           #4#2 = nPer;
           #4#3 = 310;
           #4#4 = #17#2;
           |LEE 040#4=;
           |SI FSalida ! 0;
               #4#0 = #17#0;
               #4#1 = #17#1;
               #4#2 = nPer;
               #4#3 = 370;
               #4#4 = #17#2;
               |LEE 040#4=;
               |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
           |FINSI;

           |SI #4#9  = "X";  nSw310 = 2;  |FINSI;
           |SI #4#11 = "X";  nSw310 = 1;  |FINSI;
           |SI #4#13 = "X";  nSw310 = 1;  |FINSI;
     |SIGUE;

     |PARA nPer = 3;  |SI nPer [ 12;  |HACIENDO nPer = nPer + 3;
           #4#0 = #17#0;
           #4#1 = #17#1;
           #4#2 = nPer;
           #4#3 = 131;
           #4#4 = #17#2;
           |LEE 040#4=;
           |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;

           |SI #4#9  = "X";  nSw131 = 2;  |FINSI;
           |SI #4#11 = "X";  nSw131 = 1;  |FINSI;
           |SI #4#13 = "X";  nSw131 = 1;  |FINSI;
     |SIGUE;

     |CIERRA #4;

     |SI nSw310 = 1;  |O nSw131 = 1;
         |MENAV "     Modelo ya Remesado o Archivado. No se puede Modificar";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI nSw310 = 2;  |O nSw131 = 2;
         |CONFI "0000NModelo ya Impreso, Esta Seguro de la Baja : ";
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;
     |SINO;
         |CONFI "0000N Esta Seguro de la Baja : ";
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |LEE 101#17=;
     |SI FSalida = 0;
         #17#9  = "N";
         #17#10 = "N";
         #17#11 = "N";
         #17#13 = "SIN DATOS";
         #17#15 = 0;
         #17#16 = 0;
         #17#17 = 0;
         #17#18 = 0;
         #17#19 = 0;
         #17#20 = 0;
         #17#21 = 0;
         #17#22 = 0;
         #17#23 = 0;
         #17#24 = 0;
         |GRABA 020#17a;
     |FINSI;
     |LIBERA #17;

     |BUCLE dsmom020;
     |BUCLE dsmom021;
     |BUCLE dsmom039;

     |ABRE #18;
     #18#0 = #17#0;
     #18#1 = #17#1;
     #18#2 = #17#2;
     #18#3 = #17#3;
     |LEE 101#18=;
     |SI FSalida = 0;
         |BORRA 020#18a;
         |LIBERA #18;
     |FINSI;
     |CIERRA #18;

     |ABRE #19;
     #19#0 = #17#0;
     #19#1 = #17#1;
     #19#2 = #17#2;
     #19#3 = #17#3;
     |LEE 101#19=;
     |SI FSalida = 0;
         |BORRA 020#19a;
         |LIBERA #19;
     |FINSI;
     |CIERRA #19;

     |PARA nPer = 3;  |SI nPer [ 12;  |HACIENDO nPer = nPer + 3;
           |HAZ Baja310;
     |SIGUE;

     |PARA nPer = 3;  |SI nPer [ 12;  |HACIENDO nPer = nPer + 3;
           |HAZ Baja131;
     |SIGUE;
|FPRC;

|PROCESO GrabaTrabajo131;
     enEmpresa   = #17#0;
     enEjer      = #17#1;
     enActividad = #17#3;
     nPeriodo    = enPeriodo;

     |ABRE #131;
     #131#0 = enEmpresa;
     #131#1 = enEjer;
     #131#2 = enPeriodo;
     #131#3 = 131;
     #131#4 = 0;
     #131#5 = enActividad;
     |LEE 101#131=;
     |SI FSalida ! 0;
         |DDEFECTO #131;
         #131#0 = enEmpresa;
         #131#1 = enEjer;
         #131#2 = enPeriodo;
         #131#3 = 131;
         #131#4 = 0;
         #131#5 = enActividad;
         |GRABA 020#131b;
     |FINSI;

     #131#6  = #17#5;
     #131#7  = #17#8;
     #131#8  = #17#12;
     |SI #17#12 = "N";
         #131#9  = nImporte1;
         #131#10 = nImporte2;
         #131#11 = nImporte3;
     |FINSI;
     |GRABA 020#131a;
     |LIBERA #131;
     |CIERRA #131;

     enEmpresa     = #17#0;
     enEjer        = #17#1;
     enActividad   = #17#3;
     enTipoEntrada = 98;
     enModelo      = 131;
     enComplem     = 0;
     |SUB_EJECUTA_NP "dsmoc131";

     enEmpresa     = #17#0;
     enEjer        = #17#1;
     enActividad   = #17#3;
     enModelo      = 131;
     enComplem     = 0;
     enPeriodo     = nPeriodo;

     |ABRE #8;
     #8#0 = #17#0;
     #8#1 = #17#1;
     #8#2 = enPeriodo;
     #8#3 = 131;
     #8#4 = 0;
     #8#5 = #17#3;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "COMPLETADO";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;

     |ABRE #4;
     #4#0 = #17#0;
     #4#1 = #17#1;
     #4#2 = enPeriodo;
     #4#3 = 131;
     #4#4 = 0;
     |LEE 101#4=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO Grabamoc131;
     |ABRE #18;
     #18#0 = #17#0;
     #18#1 = #17#1;
     #18#2 = #17#2;
     #18#3 = #17#3;
     |LEE 040#18=;
     |SI FSalida ! 0;  |CIERRA #18;  |ACABA;  |FINSI;
     |CIERRA #18;

     |SI #18#120 = 0;  |Y #18#121 = 0;
         #18#107 = 0;
         #18#108 = 0;
         #18#109 = 0;
         #18#110 = 0;
     |FINSI;

     |ABRE #131;
     |SI #18#107 ! 0;
         |SI #18#129 = "N";
             enPeriodo = 3;
             nImporte1 = #18#122;
             nImporte2 = #18#119;
             nImporte3 = #18#125;
             |HAZ GrabaTrabajo131;
         |FINSI;
     |SINO;
         nPer = 3;
         |HAZ Baja131;
     |FINSI;

     |SI #18#108 ! 0;
         |SI #18#130 = "N";
             enPeriodo = 6;
             nImporte1 = #18#122;
             nImporte2 = #18#119;
             nImporte3 = #18#126;
             |HAZ GrabaTrabajo131;
         |FINSI;
     |SINO;
         nPer = 6;
         |HAZ Baja131;
     |FINSI;

     |SI #18#109 ! 0;
         |SI #18#131 = "N";
             enPeriodo = 9;
             nImporte1 = #18#122;
             nImporte2 = #18#119;
             nImporte3 = #18#127;
             |HAZ GrabaTrabajo131;
         |FINSI;
     |SINO;
         nPer = 9;
         |HAZ Baja131;
     |FINSI;

     |SI #18#110 ! 0;
         |SI #18#132 = "N";
             enPeriodo = 12;
             nImporte1 = #18#122;
             nImporte2 = #18#119;
             nImporte3 = #18#128;
             |HAZ GrabaTrabajo131;
         |FINSI;
     |SINO;
         nPer = 12;
         |HAZ Baja131;
     |FINSI;
     |CIERRA #131;
|FPRC;

|PROCESO Compensa310;
     #310#0 = #1300#0;
     #310#1 = #1300#1;
     #310#2 = 12;
     #310#3 = #1300#3;
     #310#4 = #1300#4;
     #310#5 = #1300#5;
     |LEE 101#310=;
     |SI FSalida = 0;
         #310#10 = #310#10 - #1300#10;
         #310#11 = #310#11 - #1300#11;
         #310#12 = #310#12 - #1300#12;
         #310#13 = #310#13 - #1300#13;
         #310#14 = #310#14 - #1300#14;
         #310#15 = #310#15 - #1300#15;
         |GRABA 020#310a;
         |LIBERA #310;
    |FINSI;
|FPRC;

|DEFBUCLE dsmoc310;
     #1300#1006;
     ;
     enEmpresa, enEjer, nPeriodo, 310, 0, enActividad;
     enEmpresa, enEjer, nPeriodo, 310, 0, enActividad;
     ;
     NULL, Compensa310;
|FIN;

|PROCESO Compensa349_310;
     |SI #1300#6 ! "A "; |Y #1300#6 ! "E ";  |ACABA;  |FINSI;

     #349#0  = #1300#0;
     #349#1  = #1300#1;
     #349#2  = 12;
     #349#3  = #1300#3;
     #349#4  = #1300#4;
     #349#5  = #1300#5;
     #349#6  = #1300#6;
     #349#7  = #1300#7;
     #349#25 = #1300#25;
     #349#26 = #1300#26;
     |LEE 101#349=;
     |SI FSalida = 0;
         #349#22 = #349#22 - #1300#22;

         |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
                      nCampo11 = nCampo22 - 1;
                      nCampo33 = nCampo22 + 1;
                      |SI #349nCampo22 = #1300nCampo2;
                          #349nCampo11 = #349nCampo11 - #1300nCampo1;
                          #349nCampo33 = #349nCampo33 - #1300nCampo3;
                          |SAL;
                      |FINSI;
                |SIGUE;
         |SIGUE;

         |GRABA 020#349a;
         |LIBERA #349;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc349_310;
     #1300#1010;
     ;
     enEmpresa,enEjer,nPeriodo,349,0,enActividad,"A ",0000,0,"            ";
     enEmpresa,enEjer,nPeriodo,349,0,enActividad,"E ",9999,9,"zzzzzzzzzzzz";
     ;
     NULL, Compensa349_310;
|FIN;

|PROCESO BorraCero349_310;
     |SI #349#6 ! "A "; |Y #349#6 ! "E ";  |ACABA;  |FINSI;
     |SI #349#22 ! 0;   |ACABA;  |FINSI;

     |BORRA 020#349a;
     |LIBERA #349;
|FPRC;

|DEFBUCLE dsmoc349Cero310;
     #349#1;
     ;
     enEmpresa,enEjer,enPeriodo,349,0,enActividad,"A ",0000,0,"            ";
     enEmpresa,enEjer,enPeriodo,349,0,enActividad,"E ",9999,9,"zzzzzzzzzzzz";
     be;
     NULL, BorraCero349_310;
|FIN;

|PROCESO GrabaTrabajo310;
     nMod = 310;

     |ABRE #8;
     #8#0 = #17#0;
     #8#1 = #17#1;
     #8#2 = enPeriodo;
     #8#3 = 370;
     #8#4 = 0;
     #8#5 = #17#3;
     |LEE 040#8=;
     |SI FSalida = 0;  nMod = 370;  |FINSI;
     |CIERRA #8;

     |ABRE #310;
     #310#0 = enEmpresa;
     #310#1 = enEjer;
     #310#2 = enPeriodo;
     #310#3 = nMod;
     #310#4 = 0;
     #310#5 = enActividad;
     |LEE 101#310=;
     |SI FSalida ! 0;
         |DDEFECTO #310;
         #310#0 = enEmpresa;
         #310#1 = enEjer;
         #310#2 = enPeriodo;
         #310#3 = nMod;
         #310#4 = 0;
         #310#5 = enActividad;
         |GRABA 020#310b;
     |FINSI;

     |SI enPeriodo = 12;
         |HAZ PaseContab;
         |HAZ Amortizacion;
     |FINSI;

     #310#6 = #17#5;
     #310#7 = #17#8;
     #310#8 = #17#12;
     #310#9 = nImporte;
     |GRABA 020#310a;
     |LIBERA #310;

     |SI enPeriodo = 12;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc310.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida = 0;
             |PARA nPeriodo = 1;  |SI nPeriodo < 12;  |HACIENDO nPeriodo = nPeriodo + 1;
                   |BUCLE dsmoc310;
             |SIGUE;
         |FINSI;
         |DESCARGA_DEF #espejo1@;

         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc349.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida = 0;
             |ABRE #349;
             |PARA nPeriodo = 1;  |SI nPeriodo < 12;  |HACIENDO nPeriodo = nPeriodo + 1;
                   |BUCLE dsmoc349_310;
             |SIGUE;
             |CIERRA #349;
         |FINSI;

         |DESCARGA_DEF #espejo1@;

         |BUCLE dsmoc349Cero310;

         enModelo      = 349;
         enComplem     = 0;
         enTipoEntrada = 96;
         enModelo349   = 310;
         |SUB_EJECUTA_NP "dsmoc349";
     |FINSI;

     |CIERRA #310;

     enTipoEntrada = 98;
     enModelo      = nMod;
     enComplem     = 0;
     |SUB_EJECUTA_NP "dsmoc310";

     |ABRE #4;
     #4#0 = #17#0;
     #4#1 = #17#1;
     #4#2 = enPeriodo;
     #4#3 = nMod;
     #4#4 = 0;
     |LEE 101#4=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO Grabamoc310;
     |ABRE #19;
     #19#0 = #17#0;
     #19#1 = #17#1;
     #19#2 = #17#2;
     #19#3 = #17#3;
     |LEE 040#19=;
     |SI FSalida ! 0;  |CIERRA #19;  |ACABA;  |FINSI;
     |CIERRA #19;

     |SI #19#117 = 0;  |Y #19#118 = 0;
         #19#107 = 0;
         #19#108 = 0;
         #19#109 = 0;
         #19#110 = 0;
     |FINSI;

     |ABRE #310;
     |SI #19#107 ! 0;
         |SI #19#143 = "N";
             enPeriodo = 3;
                               nImporte  = #19#139;
             |SI #19#148 ! 0;  nImporte  = #19#148;  |FINSI;
             |HAZ GrabaTrabajo310;
         |FINSI;
     |SINO;
         nPer = 3;
         |HAZ Baja310;
     |FINSI;

     |SI #19#108 ! 0;
         |SI #19#144 = "N";
             enPeriodo = 6;
                               nImporte  = #19#140;
             |SI #19#149 ! 0;  nImporte  = #19#149;  |FINSI;
             |HAZ GrabaTrabajo310;
         |FINSI;
     |SINO;
         nPer = 6;
         |HAZ Baja310;
     |FINSI;

     |SI #19#109 ! 0;
         |SI #19#145 = "N";
             enPeriodo = 9;
                               nImporte  = #19#141;
             |SI #19#150 ! 0;  nImporte  = #19#150;  |FINSI;
             |HAZ GrabaTrabajo310;
         |FINSI;
     |SINO;
         nPer = 9;
         |HAZ Baja310;
     |FINSI;

     |SI #19#116 ! 0;
         |SI #19#146 = "N";
             enPeriodo = 12;
             nImporte  = #19#142;
             |HAZ GrabaTrabajo310;
         |FINSI;
     |SINO;
         nPer = 12;
         |HAZ Baja310;
     |FINSI;
     |CIERRA #310;
|FPRC;

|PROCESO Tipo12m017;  |TIPO 12;
|FPRC;

|PROCESO Tipo11m017;  |TIPO 11;
     nTecla = FSalida;
     |SI nTecla ! 10;  |Y nTecla ! 16;  |Y nTecla ! 11;  |ACABA;  |FINSI;

     |SI nTecla = 11;
         |SI #17#12 = "S";
             |MENAV "     No hay desgloses en Agricolas";
             |HAZ Refresco;
             |ACABA;
         |FINSI;

         |C_M #17#9,  1, "S";
         |C_M #17#10, 1, "S";
         |C_M #17#11, 1, "S";

         |LEE 101#17=;
         |ENDATOS #1#17;
         |SI FSalida = 0;
             |GRABA 020#17a;
         |FINSI;
         |LIBERA #17;

         |HAZ Refresco;

         |C_M #17#9,  1, "N";
         |C_M #17#10, 1, "N";
         |C_M #17#11, 1, "N";
         |ACABA;
     |FINSI;

     |SI nTecla = 16;
         |HAZ BajaModulo;
         |HAZ Refresco;
         |ACABA;
     |FINSI;

     |ABRE #4;
     |ABRE #19;
     |PARA nPer = 3;  |SI nPer [ 12;  |HACIENDO nPer = nPer + 3;
           #4#0 = #17#0;
           #4#1 = #17#1;
           #4#2 = nPer;
           #4#3 = 310;
           #4#4 = #17#2;
           |LEE 040#4=;
           |SI FSalida = 0;
               aAlfa = "N";
               |SI #4#9  = "X";  aAlfa = "S";  |FINSI;

               #19#0 = #17#0;
               #19#1 = #17#1;
               #19#2 = #17#2;
               #19#3 = #17#3;
               |LEE 101#19=;
               |SI FSalida = 0;
                   |SI nPer = 3;   #19#143 = aAlfa;  |FINSI;
                   |SI nPer = 6;   #19#144 = aAlfa;  |FINSI;
                   |SI nPer = 9;   #19#145 = aAlfa;  |FINSI;
                   |SI nPer = 12;  #19#146 = aAlfa;  |FINSI;
                   |GRABA 020#19a;
                   |LIBERA #19;
               |FINSI;
           |SINO;
               #4#0 = #17#0;
               #4#1 = #17#1;
               #4#2 = nPer;
               #4#3 = 370;
               #4#4 = #17#2;
               |LEE 040#4=;
               |SI FSalida = 0;
                   aAlfa = "N";
                   |SI #4#9  = "X";  aAlfa = "S";  |FINSI;

                   #19#0 = #17#0;
                   #19#1 = #17#1;
                   #19#2 = #17#2;
                   #19#3 = #17#3;
                   |LEE 101#19=;
                   |SI FSalida = 0;
                       |SI nPer = 3;   #19#143 = aAlfa;  |FINSI;
                       |SI nPer = 6;   #19#144 = aAlfa;  |FINSI;
                       |SI nPer = 9;   #19#145 = aAlfa;  |FINSI;
                       |SI nPer = 12;  #19#146 = aAlfa;  |FINSI;
                       |GRABA 020#19a;
                       |LIBERA #19;
                   |FINSI;
               |FINSI;
           |FINSI;
     |SIGUE;
     |CIERRA #19;

     |ABRE #18;
     |PARA nPer = 3;  |SI nPer [ 12;  |HACIENDO nPer = nPer + 3;
           #4#0 = #17#0;
           #4#1 = #17#1;
           #4#2 = nPer;
           #4#3 = 131;
           #4#4 = #17#2;
           |LEE 040#4=;
           |SI FSalida = 0;
               aAlfa = "N";
               |SI #4#9  = "X";  aAlfa = "S";  |FINSI;

               #18#0 = #17#0;
               #18#1 = #17#1;
               #18#2 = #17#2;
               #18#3 = #17#3;
               |LEE 101#18=;
               |SI FSalida = 0;
                   |SI nPer = 3;   #18#129 = aAlfa;  |FINSI;
                   |SI nPer = 6;   #18#130 = aAlfa;  |FINSI;
                   |SI nPer = 9;   #18#131 = aAlfa;  |FINSI;
                   |SI nPer = 12;  #18#132 = aAlfa;  |FINSI;
                   |GRABA 020#18a;
                   |LIBERA #18;
               |FINSI;
           |FINSI;
     |SIGUE;
     |CIERRA #18;
     |CIERRA #4;

     enEmpresa   = #17#0;
     enActividad = #17#3;
     eaCodEpi2   = #17#5;
     enCodEpi3   = #17#6;
     enEjer      = #17#1;
     eaNombreEmp = #17#7;
     eaNombreAct = #17#8;
     eaDesTrab   = #17#9;
     eaDesElem   = #17#10;
     eaDesInve   = #17#11;
     eaAgricola  = #17#12;
     enDiaTrimP1 = #17#15;
     enDiaTrimP2 = #17#16;
     enDiaTrimP3 = #17#17;
     enDiaTrimP4 = #17#18;
     enDiaTrimD1 = #17#20;
     enDiaTrimD2 = #17#21;
     enDiaTrimD3 = #17#22;
     enDiaTrimD4 = #17#23;

     aAlfa    = enEjer;
     aAlfa    = "01.01." + aAlfa;
     efFechaI = aAlfa;
     |ABRE #214;
     |DDEFECTO #214;
     #214#0 = enEmpresa;
     #214#1 = enActividad;
     |LEE 001#214=;
     |CIERRA #214;
     |SI #214#5 > efFechaI; efFechaI = #214#5; |FINSI;

     |SUB_EJECUTA_NP "dsmoz006";

     |LEE 101#17=;
     |SI FSalida = 0;
         #17#15 = enDiaTrimP1;
         #17#16 = enDiaTrimP2;
         #17#17 = enDiaTrimP3;
         #17#18 = enDiaTrimP4;
         #17#19 = #17#15 + #17#16 + #17#17 + #17#18;

         #17#20 = enDiaTrimD1;
         #17#21 = enDiaTrimD2;
         #17#22 = enDiaTrimD3;
         #17#23 = enDiaTrimD4;
         #17#24 = #17#20 + #17#21 + #17#22 + #17#23;
         #17#9  = eaDesTrab;
         #17#10 = eaDesElem;

         #17#13 = "EXISTENTE";  |PINTA #17#13;

         |GRABA 020#17a;

         |HAZ Grabamoc310;
         |HAZ Grabamoc131;
    |FINSI;
    |LIBERA #17;

    |HAZ Refresco;
|FPRC;
