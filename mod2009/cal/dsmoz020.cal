|FICHEROS;
     dsmoz020 #0;
     dsmom037 #37;

     dsmoc110 #110;

     dsmow105 #999;
|FIN;

|VARIABLES;
     nCambiar     = 0;
     aFichero     = "";
     &eaExtension = "";
     &eaPrograma  = "";
     nAlguno      = 0;
|FIN;

|PROCESO dsmoc110A;
     |SI #110#8 = #0#0;  |Y #110#9 = #0#1;
         nCambiar = 0;

         |SI #110#11 ! 0;
             #0#4 = ((#110#11 * 100) / #110#10) ! 2;
             |SI #0#4 < 0;     #0#4     = -#0#4;    |FINSI;
             |SI #0#4 < 1.90;  nCambiar = 1;        |FINSI;


||             #0#3 = (#110#11 - ((#110#10 % 1) ! 2)) ! 2;
||             |SI #0#3 < 0;     #0#3     = -#0#3;    |FINSI;
||             |SI #0#3 = 0.01;  nCambiar = 1;        |FINSI;
||             |SI #0#3 = 0;     nCambiar = 1;        |FINSI;
         |FINSI;

         |SI #110#16 ! 0;
             #0#4 = ((#110#16 * 100) / #110#15) ! 2;
             |SI #0#4 < 0;     #0#4     = -#0#4;    |FINSI;
             |SI #0#4 < 1.90;  nCambiar = 1;        |FINSI;

||             #0#3   = #110#16 - ((#110#15 % 1) ! 2);

||             |SI #0#3 < 0;     #0#3     = -#0#3;    |FINSI;
||             |SI #0#3 = 0.01;  nCambiar = 1;        |FINSI;
||             |SI #0#3 = 0;     nCambiar = 1;        |FINSI;
         |FINSI;

         |SI #110#21 ! 0;
             #0#4 = ((#110#21 * 100) / #110#20) ! 2;
             |SI #0#4 < 0;     #0#4     = -#0#4;    |FINSI;
             |SI #0#4 < 1.90;  nCambiar = 1;        |FINSI;

||             #0#3   = #110#21 - ((#110#20 % 1) ! 2);

||             |SI #0#3 < 0;     #0#3     = -#0#3;    |FINSI;
||             |SI #0#3 = 0.01;  nCambiar = 1;        |FINSI;
||             |SI #0#3 = 0;     nCambiar = 1;        |FINSI;
         |FINSI;

         |SI nCambiar = 1;
             #110#8 = "H";
             #110#9 = "04";
             |GRABA 020#110n;
             |LIBERA #110;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #110#8 = "I";  |Y #110#9 = "  ";
         #110#8 = "I";
         #110#9 = "02";
         |GRABA 020#110n;
         |LIBERA #110;
         |ACABA;
     |FINSI;

     |SI #110#8 = "K";  |Y #110#9 = "  ";
         #110#8 = "K";
         #110#9 = "01";
         |GRABA 020#110n;
         |LIBERA #110;
         |ACABA;
     |FINSI;

     |SI #110#8 = "N";
         #110#8 = "K";
         #110#9 = "02";
         |GRABA 020#110n;
         |LIBERA #110;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc110A;
     #110#1;
     ;
     00000, 2007, 00, 000, 00, 00, "            ", 0000, " ", "  ";
     99999, 2007, 99, 999, 99, 99, "zzzzzzzzzzzz", 9999, "z", "zz";
     be;
     NULL, dsmoc110A;
|FIN;

|PROCESO dsmoc110B;
     |SI #110#8 = #0#0;  |Y #110#9 = #0#1;
         nCambiar = 0;

         |SI #110#11 ! 0;
             #0#4 = ((#110#11 * 100) / #110#10) ! 2;
             |SI #0#4 < 0;     #0#4     = -#0#4;    |FINSI;
             |SI #0#4 < 1.90;  nCambiar = 1;        |FINSI;

||             #0#3   = #110#11 - ((#110#10 % 1) ! 2);

||             |SI #0#3 < 0;     #0#3     = -#0#3;    |FINSI;
||             |SI #0#3 = 0.01;  nCambiar = 1;        |FINSI;
||             |SI #0#3 = 0;     nCambiar = 1;        |FINSI;
         |FINSI;

         |SI #110#16 ! 0;
             #0#4 = ((#110#16 * 100) / #110#15) ! 2;
             |SI #0#4 < 0;     #0#4     = -#0#4;    |FINSI;
             |SI #0#4 < 1.90;  nCambiar = 1;        |FINSI;

||             #0#3   = #110#16 - ((#110#15 % 1) ! 2);

||             |SI #0#3 < 0;     #0#3     = -#0#3;    |FINSI;
||             |SI #0#3 = 0.01;  nCambiar = 1;        |FINSI;
||             |SI #0#3 = 0;     nCambiar = 1;        |FINSI;
         |FINSI;

         |SI #110#21 ! 0;
             #0#4 = ((#110#21 * 100) / #110#20) ! 2;
             |SI #0#4 < 0;     #0#4     = -#0#4;    |FINSI;
             |SI #0#4 < 1.90;  nCambiar = 1;        |FINSI;

||             #0#3   = #110#21 - ((#110#20 % 1) ! 2);

||             |SI #0#3 < 0;     #0#3     = -#0#3;    |FINSI;
||             |SI #0#3 = 0.01;  nCambiar = 1;        |FINSI;
||             |SI #0#3 = 0;     nCambiar = 1;        |FINSI;
         |FINSI;

         |SI nCambiar = 1;
             |BORRA 020#110a;
             |LIBERA #110;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #110#8 = "I";  |Y #110#9 = "  ";
         |BORRA 020#110a;
         |LIBERA #110;
         |ACABA;
     |FINSI;

     |SI #110#8 = "K";  |Y #110#9 = "  ";
         |BORRA 020#110a;
         |LIBERA #110;
         |ACABA;
     |FINSI;

     |SI #110#8 = "N";
         |BORRA 020#110a;
         |LIBERA #110;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc110B;
     #110#1;
     ;
     00000, 2007, 00, 000, 00, 00, "            ", 0000, " ", "  ";
     99999, 2007, 99, 999, 99, 99, "zzzzzzzzzzzz", 9999, "z", "zz";
     be;
     NULL, dsmoc110B;
|FIN;

|PROCESO GrabaAuxi;
  #999#0 = #110#0;
  #999#1 = #110#1;
  #999#2 = #110#2;
  #999#3 = #110#3;
  #999#4 = #110#4;
  #999#5 = #110#5;
  #999#6 = #110#6;
  #999#7 = #110#7;
  #999#8 = "H";
  #999#9 = "04";
  |GRABA 040#999n;
  nAlguno = 1;
|FPRC;

|PROCESO nuevo110A;
    #110#8 = #0#0;
    #110#9 = #0#1;
    |GRABA 040#110n;
    |SI FSalida ! 0;
        |HAZ GrabaAuxi;
    |FINSI;
    |LIBERA #110;
|FPRC;

|DEFBUCLE nuevo110A;
     #110#1;
     ;
     00000, 2007, 00, 000, 00, 00, "            ", 0000, "H", "04";
     99999, 2007, 99, 999, 99, 99, "zzzzzzzzzzzz", 9999, "H", "04";
     be;
     NULL, nuevo110A;
|FIN;

|PROCESO nuevo110B;
  #999#0 = #110#0;
  #999#1 = #110#1;
  #999#2 = #110#2;
  #999#3 = #110#3;
  #999#4 = #110#4;
  #999#5 = #110#5;
  #999#6 = #110#6;
  #999#7 = #110#7;
  #999#8 = #110#8;
  #999#9 = #110#9;
  |LEE 000#999=;
  |SI FSalida ! 0;
      |BORRA 020#110a;
  |FINSI;
  |LIBERA #110;
|FPRC;

|DEFBUCLE nuevo110B;
     #110#1;
     ;
     00000, 2007, 00, 000, 00, 00, "            ", 0000, "H", "04";
     99999, 2007, 99, 999, 99, 99, "zzzzzzzzzzzz", 9999, "H", "04";
     be;
     NULL, nuevo110B;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |SI #0#0 = "H";  |Y #0#1 = "04";
         |MENAV "0000  Clave perceptora errorea.";
         |ACABA;
     |FINSI;

     |ABRE #37;
     #37#0 = "H";
     #37#1 = "04";
     |LEE 000#37=;
     |SI FSalida ! 0;
         |MENAV "0000 Hay una nueva clave IRPF, se va a proceder a instalar el fichero";

         |CIERRA #37;
         eaExtension = "mod";
         eaPrograma  = "dsmom037";
         |SUB_EJECUTA_NP ":basica/dspatron";

         |ABRE #37;
         #37#0 = "H";
         #37#1 = "04";
         |LEE 000#37=;
         |SI FSalida = 0;
             |MENAV "0000 El fichero se ha instalado satisfactoriamente.";
         |SINO;
             |MENAV "0000 El fichero no se ha instalado, por favor instale la aplicacion ipbasica";
             |CIERRA #37;
             |ACABA;
         |FINSI;
     |FINSI;
     |CIERRA #37;

     aFichero = ("20" + Usuario) % 108;
     |NOME_DAT #999 aFichero;
     |DELINDEX #999;

     |ABRE #999;
     |BUCLE nuevo110A;
     |BUCLE nuevo110B;
     |CIERRA #999;

     |BUCLE dsmoc110A;
     |BUCLE dsmoc110B;

     |DELINDEX #999;

     |SI nAlguno = 1;
         |CUADRO 1225 1661;
         |ATRI R;
         |PINTA 1326, " ES CONVENIENTE SACAR  EL  INFORME ";
         |PINTA 1426, " DE COMPROBACION DE % IRPF PARA LA ";
         |PINTA 1526, " CLAVE PERCEPTORA  H-04.           ";
         |ATRI 0;
         |PAUSA;
     |FINSI;
|FPRC;
