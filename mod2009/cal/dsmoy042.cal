|FICHEROS;
   dsmoy042 #0;
   dsmom041 #41;
   dsmom042 #42;
   dsmom040 #40;
   dsmom100 #100;
   :/contagen/def/caconimp #306;  || configuracion impresiones
   dsmow030 #900;

   dsmow106 #906;
|FIN;

|VARIABLES;
   nLaEmpresa = 0;
   fecsys = @;
   &entrada = 1;
   &ulti    = "";
   informe  = "dsmoy042";
   bueno    = 0;
   &amor    = 0;
   &resid   = 0;
   &lintot  = 0;
   &linnor  = 0;
   &linant  = 0;
   &totval  = 0;
   &totamo  = 0;
   &totano  = 0;
   &totres  = 0;
   &linanyo = 0;
   &anyo1   = 0;
   &anyo2   = 0;
   &anyo3   = 0;
   &anyo4   = 0;
   &anyo5   = 0;
   &anyo6   = 0;
   &anyo7   = 0;
   &anyo8   = 0;
   &a1      = 0;
   &a2      = 0;
   &a3      = 0;
   &a4      = 0;
   &a5      = 0;
   &a6      = 0;
   &a7      = 0;
   &a8      = 0;
   &t1      = 0;
   &t2      = 0;
   &t3      = 0;
   &t4      = 0;
   &t5      = 0;
   &t6      = 0;
   &t7      = 0;
   &t8      = 0;
   &e1      = 0;
   &e2      = 0;
   &e3      = 0;
   &e4      = 0;
   &e5      = 0;
   &e6      = 0;
   &e7      = 0;
   &e8      = 0;
   nombre = "";
   alfa1 = "";
   &am_ti = "FISCAL";
   &fec = @;
   aFichero  = "";
   nCampo    = 0;
   nDEmpresa = 0;
   nHEmpresa = 0;
   nDActividad = 0;
   nHActividad = 0;
   swCuenta = 0;
   swPrimero = 0;
   swBueno = 0;
   &nCamSel = 23;
   &nCamTip = 38;
   aAlfa1 = "";
   aAlfa2 = "";
   aPath  = "";

   nAnyV  = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;
|INCLUYE i_varlib;
|INCLUYE i_numamo;
|INCLUYE i_selcon;

|| //////////////////// Calculos de Pantalla \\\\\\\\\\\\\\\\\\\\\\\\\\
|PROCESO DatosEmp; |TIPO 7;

   |DDEFECTO #306;

   |ABRE #100;
   |LEE 040#100p;
   |SI FSalida = 0;
       aAlfa1 = #100#1; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
       aAlfa2 = #100#2; |QBF aAlfa2; aAlfa2 = ("0"     + aAlfa2) % -101;
       |DBASS aPath; |QBT aPath;
       aPathConta = aPath + "contagen/fich/" + aAlfa1 + aAlfa2 + "/";

       |PATH_DAT #306 aPathConta;

       |ABRE #306;
       #306#0 = 1;
       |LEE 000#306=;
       |CIERRA #306;
   |FINSI;
   |CIERRA #100;

   #0#40  = #306#7; |PINTA #0#40;
   aAlfa1 = #306#8; |C_M #0#40,1,aAlfa1;
|FPRC;

|CALCULO Tipo7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#7  = enEmpresa; |PINTA #0#7;
         #0#8 = enEmpresa;  |PINTA #0#8;

         |C_M #0#7, 1, "N";
         |C_M #0#8, 1, "N";
     |FINSI;

|FCAL;

|CALCULO Parrilla;
     |SI #0#7 = 0;
         #0#7 = 0;  |PINTA #0#7;
         #0#8 = 0;  |PINTA #0#8;  |C_M #0#8, 1, "N";
         |PARA nCampo = 9;  |SI nCampo [ 20;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#7, 1, "S";
             |C_M #0#8, 1, "S";
         |FINSI;

         |PARA nCampo = 9;  |SI nCampo [ 20;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 20;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 20;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO numamo; |TIPO 0;
   x_alfa1 = #0Campo;
   |HAZ x_punto;
   #0Campo = x_alfa1;
   |PINTA #0Campo;
|FCAL;

|CALCULO cuenta; |TIPO 0;
     salidas  = FSalida;

     |ABRE #100;
     |LEE 040#100p;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;
     |CIERRA #100;

     nLaEmpresa = enEmpresa;

     enEmpresa  = #100#1;
     enPerConta = #100#2;

     eaCuenta = #0Campo;
     |HAZ FiltraPuntos;
     #0Campo = eaCuenta;
     |PINTA #0Campo;
     enEmpresa = nLaEmpresa;
|FCAL;

|CALCULO defecto; |TIPO 7;
   fecsys =  ~;
   alfa1 = fecsys;
   alfa1 = alfa1 % -104;
   #0Campo = alfa1;
   |PINTA #0Campo;
|FCAL;

|CALCULO Tipo3;  |TIPO 3;
     |HAZ LeeEURODBMOD;

     aFichero = "6w" + Usuario;
     |NOME_DAT #906 aFichero;

     enDatos = 0; |SI #0#40 = "S"; enDatos = 1; |FINSI;
     enEjer = #0#5;
     aAlfa1 = #0#5; aAlfa1 = "01.01." + aAlfa1; efDFecha = aAlfa1;
     aAlfa1 = #0#5; aAlfa1 = "31.12." + aAlfa1; efHFecha = aAlfa1;
     eaTituloL = "INFORME ANUAL DE AMORTIZACION FISCAL";

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |MENAV "0000 Recuerde seleccionar el papel de la impresora en Horizontal";

     |INFOR informe;
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     nDActividad = #0#21;
     nHActividad = #0#22;
     aAlfa1 = #0#5;
     aAlfa1 = "31.12." + aAlfa1;
     efFecTope = aAlfa1;

     |SI #0#7 ! 0;
         nDEmpresa = #0#7;
         nHEmpresa = #0#8;
         |HAZ imprimir;
     |SINO;
         |PARA nCampo = 9; |SI nCampo [ 20;  |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo ! 0;
                   nDEmpresa = #0nCampo;
                   nHEmpresa = #0nCampo;
                   |HAZ imprimir;
               |FINSI;
         |SIGUE;
     |FINSI;
     |FININF;
     |FINIMP;
     |DELINDEX #906;
|FCAL;

|| //////////////////// Procesos del Informe  \\\\\\\\\\\\\\\\\\\\\\\\\\
|PROCESO acumano;
      |SI anyo1 = #42#5; a1 = a1 + #42#7; |FINSI;
      |SI anyo2 = #42#5; a2 = a2 + #42#7; |FINSI;
      |SI anyo3 = #42#5; a3 = a3 + #42#7; |FINSI;
      |SI anyo4 = #42#5; a4 = a4 + #42#7; |FINSI;
      |SI anyo5 = #42#5; a5 = a5 + #42#7; |FINSI;
      |SI anyo6 = #42#5; a6 = a6 + #42#7; |FINSI;
      |SI anyo7 = #42#5; a7 = a7 + #42#7; |FINSI;
      |SI anyo8 ] #42#5; a8 = a8 + #42#7; |FINSI;

      |SI #42#5 [ anyo1;
          resid = (resid - #42#7) ! EURODBMOD;
          |SI nAnyV ! 0;     || Esta vendido
              |SI #42#5 ] nAnyV;
                  resid = 0;
              |FINSI;
          |FINSI;
     |FINSI;

|FPRC;

|DEFBUCLE LasLineas;
 #42#1;
 6;
 #41#0,#41#2,#41#3,001,"A";
 #41#0,#41#2,#41#3,999,"A";
 e;
 NULL, acumano;
|FIN;

|PROCESO LaImpresion;
   |SI #0#6 = "N";
       |SI #41#25 = "N"; |ACABA; |FINSI;
   |FINSI;

   |SI swPrimero = 0;  ||Controla el primer pase
       swPrimero = 1;
       enEmpresa   = #41#0;
       eaNombreEmp = #41#32;
       ulti        = #41#5;       || Cuenta de Gastos
       swCuenta    = 0;

       swBueno = 0;
       |HAZ LaSelEmpresa;
       |SI enSwSelEmp = 1;
           swBueno = 1;
       |SINO;
           |SI enDatos = 1; enActividad = 0;  |HAZ DatosEmpr_w30; |FINSI;
       |FINSI;
       |HAZ ponceroE;
   |FINSI;

   |SI enEmpresa ! #41#0; || Controla la Ruptura por Empresas
       |SI swCuenta = 1;
           |SI #0#39 = 1;
               lintot = 1;
               |PRINT;
           |FINSI;
           |PIEINF; || imprime el pie del informe
       |FINSI;
       enEmpresa   = #41#0;
       eaNombreEmp = #41#32;
       ulti        = #41#5;       || Cuenta de Gastos
       swCuenta    = 0;
       swBueno = 0;
       |HAZ LaSelEmpresa;
       |SI enSwSelEmp = 1;
           swBueno = 1;
       |SINO;
           |SI enDatos = 1; enActividad = 0;  |HAZ DatosEmpr_w30; |FINSI;
       |FINSI;
       |HAZ ponceroE;
   |FINSI;
   |SI swBueno = 1; |ACABA; |FINSI;

   |SI swCuenta =  0;   || Primera cuenta de esta Empresa
       lintot = 0;
       linnor = 1;
       linant = 0;
   |SINO;
        |SI #41#5 ! ulti;
            |SI #0#39 = 1;
                lintot = 1;     || imprime linea de totales
                |PRINT;
            |FINSI;
            |HAZ poncero;
            lintot = 0;
            linant = 0;
            linnor = 1;     || imprime primera linea de cuenta
        |SINO;
            lintot = 0;
            linnor = 0;
            linant = 1;
            |SI #0#39 = 2;
                linnor = 1;
                linant = 0;
            |FINSI;
         |FINSI;
    |FINSI;

    nAnyV = 0;
    |SI #41#26 > "01.01.1000";   || Esta vendido;
         aAlfa1 = #41#26;
         aAlfa1 = aAlfa1 % -104;
         nAnyV  = aAlfa1;
    |FINSI;
    swCuenta = 1;
    ulti     = #41#5;               || Cod. de Cuenta;
    a1 = 0;  a2 = 0;  a3 = 0;  a4 = 0;  a5 = 0;  a6 = 0;  a7 = 0;  a8 = 0;
    amor  = #41#15;
    resid = #41#10;
    |BUCLE LasLineas; || lee las lineas de esta cabecera
    |PRINT;
    totval = totval + #41#10;   || acumula valor inicial;
    totamo = totamo + amor;     || acumula amortizacion;
    t1 = t1 + a1;              || acumula amortizacion en a¤o final;
    t2 = t2 + a2;              || acumula amortizacion en a¤o -1;
    t3 = t3 + a3;              || acumula amortizacion en a¤o -2;
    t4 = t4 + a4;              || acumula amortizacion en a¤o -3;
    t5 = t5 + a5;              || acumula amortizacion en a¤o -4;
    t6 = t6 + a6;              || acumula amortizacion en a¤o -5;
    t7 = t7 + a7;              || acumula amortizacion en a¤o -6;
    t8 = t8 + a8;              || acumula amortizacion en a¤o -7;
    totres = totres + resid;   || acumula valor residual;
    lintot = 0;
    linnor = 0;
    linant = 0;
    e1 = e1 + a1;              || acumula amortizacion en a¤o final;
    e2 = e2 + a2;              || acumula amortizacion en a¤o -1;
    e3 = e3 + a3;              || acumula amortizacion en a¤o -2;
    e4 = e4 + a4;              || acumula amortizacion en a¤o -3;
    e5 = e5 + a5;              || acumula amortizacion en a¤o -4;
    e6 = e6 + a6;              || acumula amortizacion en a¤o -5;
    e7 = e7 + a7;              || acumula amortizacion en a¤o -6;
    e8 = e8 + a8;              || acumula amortizacion en a¤o -7;
|FPRC;

|PROCESO LaImpresion_Aux;
 eaCuenta = #906#8;
 |SI #0#41 < 2008; eaCuenta = #906#5; |FINSI;

 |DDEFECTO #41;
 #41#0 = #906#0;
 #41#2 = #906#2;
 #41#3 = #906#3;
 |LEE 041#41=;
 |SI FSalida ! 0; |ACABA; |FINSI;

 #41#5 = eaCuenta;
 |SI #41#5 < #0#0;  |O #41#5 > #0#1; |ACABA; |FINSI;

 |HAZ LaImpresion;
|FPRC;

|DEFBUCLE dsmoy042_90;
   #906#2;
   1;
   nDEmpresa, #0#0, #0#2, #0#36, nDActividad;
   nHEmpresa, #0#1, #0#3, #0#37, nHActividad;
   e;
   NULL,LaImpresion_Aux;
|FIN;

|DEFBUCLE dsmoy042_08;
   #906#3;
   1;
   nDEmpresa, #0#0, #0#2, #0#36, nDActividad;
   nHEmpresa, #0#1, #0#3, #0#37, nHActividad;
   e;
   NULL,LaImpresion_Aux;
|FIN;

|DEFBUCLE dsmoy042E;
   #906#1;
   1;
   nDEmpresa,#0#2,#0#36,nDActividad;
   nHEmpresa,#0#3,#0#37,nHActividad;
   e;
   NULL, LaImpresion_Aux;
|FIN;

|PROCESO LeeAmor0;
   |SI #0#6 = "N";
       |SI #41#25 = "N"; |ACABA; |FINSI;
   |FINSI;

   |SI enEmpresa ! #41#0; || Controla la Ruptura por Empresas
       enEmpresa   = #41#0;
       swBueno = 0;
       |HAZ LaSelEmpresa;
       |SI enSwSelEmp = 1;
           swBueno = 1;
       |SINO;
           |HAZ AntCambioCta;
       |FINSI;
   |FINSI;
   |SI swBueno = 1; |ACABA; |FINSI;

   #906#0 = #41#0;
   #906#1 = #41#1;
   #906#2 = #41#2;
   #906#3 = #41#3;
   |LEE 101#906=;
   |SI FSalida ! 0;
       #906#0 = #41#0;
       #906#1 = #41#1;
       #906#2 = #41#2;
       #906#3 = #41#3;
       #906#4 = #41#27;
       |GRABA 020#906b;
   |FINSI;

   aAlfa1 = #41#27;
   aAlfa1 = #41#27; aAlfa1 = aAlfa1 % -104;
   enEjerCam  = aAlfa1;
   #906#5 = #41#5;
   #906#8 = #41#5;
   |SI enEjerCam < 2008;
       eaCuenta  = #906#5;
       |HAZ CambioCta;
       #906#8 = eaCta2008;
   |FINSI;
   |GRABA 020#906a;
   |LIBERA #906;
|FPRC;

|DEFBUCLE LeeAmor;
 #41#1;
 1;
 nDEmpresa, #0#2, #0#36,nDActividad;
 nHEmpresa, #0#3, #0#37,nHActividad;
 e;
 NULL, LeeAmor0;
|FIN;

|PROCESO imprimir;

      |DELINDEX #906;
      enEmpresa = -1;
      |ABRE #906;
      |BUCLE LeeAmor;
      |CIERRA #906;

      swPrimero = 0;
      swCuenta = 0;
      bueno = 0;
      anyo1 = #0#5;
      anyo2 = #0#5-1;
      anyo3 = #0#5-2;
      anyo4 = #0#5-3;
      anyo5 = #0#5-4;
      anyo6 = #0#5-5;
      anyo7 = #0#5-6;
      anyo8 = #0#5-7;
      fec   = #0#4

      swBueno = 0;
      |ABRE #41;
      |SI #0#39 = 1;
          |SI #0#41 ] 2008; |BUCLE dsmoy042_08; |FINSI;
          |SI #0#41 < 2008; |BUCLE dsmoy042_90; |FINSI;
      |FINSI;
      |SI #0#39 = 2; |BUCLE dsmoy042E; |FINSI;
      |CIERRA #41;

      |SI swCuenta = 1;
          |SI #0#39 = 1;
              lintot = 1;
              |PRINT;
          |FINSI;
          |PIEINF; || imprime el pie del informe
      |FINSI;
      |HAZ poncero;
|FPRC;

|PROCESO poncero;
   totval = 0;
   totamo = 0;
   t1 = 0;
   t2 = 0;
   t3 = 0;
   t4 = 0;
   t5 = 0;
   t6 = 0;
   t7 = 0;
   t8 = 0;
   totres = 0;
|FPRC;

|PROCESO ponceroE;
   totval = 0;
   totamo = 0;
   e1 = 0;
   e2 = 0;
   e3 = 0;
   e4 = 0;
   e5 = 0;
   e6 = 0;
   e7 = 0;
   e8 = 0;
   totres = 0;
|FPRC;
