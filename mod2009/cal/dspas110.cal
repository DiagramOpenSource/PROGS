|FICHEROS;
     dsmozpas #0;
     dsmom002 #2;
     dsmom004 #4;
     dsmom008 #8;
     dsmom026 #26;
     dsmom030 #30;
     dsmoc110 #100;

     :/contagen/def/canempre #101;
     :/contagen/def/camaniva #102;
     :/contagen/def/caivalin #103;
     :/contagen/def/caivaasi #104;

     :/laboral/def/labtraba  #200;
     :/laboral/def/nomhicca  #201;
     :/laboral/def/nomhicli  #202;
     :/laboral/def/labempre  #203;
     :/laboral/def/nomconli  #204;
     :/laboral/def/nomhiatr  #205;

     :/basica/def/agitab99   #99;

     dsmow013 #999,MANTE;
     espejo1@ #1300;
|FIN;

|VARIABLES;
     nSw               = 0;
     aTodoCero         = "";
     aNombreTrabajador = "";
     aExtranjero       = "";
     aCadena           = "";
     nMesLugar         = 0;
     fFechaCamaniva    = @;
     nImporteBaseI     = 0;
     nImporteRetencion = 0;
     aEspecie          = "";
     aRepercute        = "";
     aClave            = "";
     aSubClave         = "";
     aDni              = "";
     aDn               = "            ";
     aHn               = "zzzzzzzzzzzz";
     aPeriodicidad     = "";

     aAlfa             = "";
     aAlfa1            = "";
     aPathModelo       = "";
     aPathLaboral      = "";
     aDef              = "";
     aTipo             = "";
     aBase             = "";

     nEjer             = 0;
     nEjerAt           = 0;
     nDPeriodo         = 0;
     nHPeriodo         = 0;
     nCampo1           = 0;
     nCampo11          = 0;
     nCampo2           = 0;
     nCampo22          = 0;
     nCampo3           = 0;
     nCampo33          = 0;
     nSwEsta           = 0;
     nGrupo            = 0;
     nSubGrupo         = 0;
     nDepar            = 0;
     nBaseImpo         = 0;
     nPorce            = 0;
     nCuota            = 0;
     nPeriodo          = 0;
     nModelo           = 0;
     nSwPasa           = 0;
     nLineaIrpf        = 0;
     nDComplem         = 0;
     nHComplem         = 0;
     nHayPase          = 0;
     nHandle           = 0;
     nHay              = 0;
     nPorGrupos        = 0;
     nEmpresa          = 0;
     nDevengo          = 0;
     nAtrasos          = 0;
     nAnyo             = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO MiraCampos110;
     aTodoCero = "S";
     |PARA nCampo1 = 10;  |SI nCampo1 [ 24;  |HACIENDO nCampo1 = nCampo1 + 1;
          |SI #100nCampo1 ! 0;
               aTodoCero = "N";
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Grabadsmoc110;
     |SI aClave  = " ";  |Y aSubClave = "  ";  |ACABA;  |FINSI;

     |SI aExtranjero = "e";  |ACABA;  |FINSI;

     |ABRE #2;
     #2#0 = enEmpresa;
     #2#1 = enActividad;
     #2#2 = 110;
     |LEE 040#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     aPeriodicidad = "T";
     |SI #2#7 = "MENSUAL   ";  aPeriodicidad = "M";  |FINSI;

     #100#0 = enEmpresa;
     #100#1 = enEjer;
     #100#2 = enPeriodo;
     #100#3 = enModelo;
     #100#4 = enComplem;
     #100#5 = enActividad;
     #100#6 = aDni;
     #100#7 = nDevengo;
     #100#8 = aClave;
     #100#9 = aSubClave;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0 = enEmpresa;
         #100#1 = enEjer;
         #100#2 = enPeriodo;
         #100#3 = enModelo;
         #100#4 = enComplem;
         #100#5 = enActividad;
         #100#6 = aDni;
         #100#7 = nDevengo;
         #100#8 = aClave;
         #100#9 = aSubClave;
         |GRABA 020#100b;
     |FINSI;

     |SI aPeriodicidad ! "T";
          |SI aEspecie = "N";
               #100#10 = #100#10 + nImporteBaseI;
               #100#11 = #100#11 + nImporteRetencion;
          |SINO;
               #100#12 = #100#12 + nImporteBaseI;
               |SI aRepercute = "N";
                    #100#13 = #100#13 + nImporteRetencion;
               |SINO;
                    #100#14 = #100#14 + nImporteRetencion;
               |FINSI;
          |FINSI;
     |SINO;
          |SI aEspecie = "N";
               |SI nMesLugar = 1; |O nMesLugar = 4;
                |O nMesLugar = 7; |O nMesLugar = 10;
                    #100#10 = #100#10 + nImporteBaseI;
                    #100#11 = #100#11 + nImporteRetencion;
               |FINSI;

               |SI nMesLugar = 2; |O nMesLugar = 5;
                |O nMesLugar = 8; |O nMesLugar = 11;
                    #100#15 = #100#15 + nImporteBaseI;
                    #100#16 = #100#16 + nImporteRetencion;
               |FINSI;

               |SI nMesLugar = 3; |O nMesLugar = 6;
                |O nMesLugar = 9; |O nMesLugar = 12;
                    #100#20 = #100#20 + nImporteBaseI;
                    #100#21 = #100#21 + nImporteRetencion;
               |FINSI;
          |SINO;
               |SI nMesLugar = 1;|O nMesLugar = 4;
                |O nMesLugar = 7; |O nMesLugar = 10;
                    #100#12 = #100#12 + nImporteBaseI;
                    |SI aRepercute = "N";
                         #100#13 = #100#13 + nImporteRetencion;
                    |SINO;
                         #100#14 = #100#14 + nImporteRetencion;
                    |FINSI;
               |FINSI;

               |SI nMesLugar = 2; |O nMesLugar = 5;
                |O nMesLugar = 8; |O nMesLugar = 11;
                    #100#17 = #100#17 + nImporteBaseI;
                    |SI aRepercute = "N";
                         #100#18 = #100#18 + nImporteRetencion;
                    |SINO;
                         #100#19 = #100#19 + nImporteRetencion;
                    |FINSI;
               |FINSI;

               |SI nMesLugar = 3; |O nMesLugar = 6;
                |O nMesLugar = 9; |O nMesLugar = 12;
                    #100#22 = #100#22 + nImporteBaseI;
                    |SI aRepercute = "N";
                         #100#23 = #100#23 + nImporteRetencion;
                    |SINO;
                         #100#24 = #100#24 + nImporteRetencion;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     #100#29 = aNombreTrabajador;

     |GRABA 020#100a;
     |LIBERA #100;
|FPRC;

|PROCESO LeeLinea110;
     #30#0 = #103#18;
     |LEE 000#30=;
     |SI FSalida!0;
         #30#0 = #103#3;
         |LEE 000#30=;
         |SI FSalida!0;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #30#5  ! "S";  |ACABA;  |FINSI;
     |SI #30#38 ! 190;  |ACABA;  |FINSI;

     aClave            = #30#42;
     aSubClave         = #30#43;
     nDevengo          = 0;

     |SI #99#8 = "L";     ||Ya hemos pasado las nominas desde Laboral
         |SI aClave = "A"; |O aClave = "L";
             |ACABA;
         |FINSI;
     |FINSI;

     aDni              = #102#14;

     nImporteBaseI     = (#103#20 / enConversor) ! EURODBMOD;
     nImporteRetencion = (#103#22 / enConversor) ! EURODBMOD;

     fFechaCamaniva    = #102#8;
     aCadena           = fFechaCamaniva % 402;
     nMesLugar         = aCadena;
     aNombreTrabajador = #102#13;
     aExtranjero       = "";
     |DDEFECTO #200;

     |SI #103#26 = "0";  |O #103#27 = "0";
         |SI aPathLaboral ! "";
             nLineaIrpf = nLineaIrpf + 1;
             |ABRE #200;
             |SELECT #5#200;
             #200#0 = nEmpresa;
             #200#7 = #102#14;
             |LEE 040#200=;
             |SI FSalida ! 0;  |DDEFECTO #200;  |FINSI;
             |CIERRA #200;

             |SI nLineaIrpf = 1;
                 #103#26 = #200#105;
                 #103#27 = #200#108;
             |FINSI;

             |SI nLineaIrpf = 2;
                 #103#26 = #200#106;
                 #103#27 = #200#109;
             |FINSI;

             |SI nLineaIrpf = 3;
                 #103#26 = #200#107;
                 #103#27 = #200#110;
             |FINSI;

             |GRABA 020#103a;
         |FINSI;
     |FINSI;

     aEspecie   = #103#26;
     aRepercute = #103#27;

     |LIBERA #103;

     |SI nImporteBaseI ! 0; |O nImporteRetencion ! 0;
          |HAZ Grabadsmoc110;
     |FINSI;
|FPRC;

|DEFBUCLE caivalin110;
     #103#1;
     ;
     #102#0, #102#1, 01;
     #102#0, #102#1, 99;
     be;
     NULL, LeeLinea110;
|FIN;

|PROCESO LeeCabecera110;
     nLineaIrpf = 0;
     |BUCLE caivalin110;
     |LIBERA #102;
|FPRC;

|DEFBUCLE camaniva110;
     #102#1;
     5;
     00, 0000000000, nDPeriodo;
     99, 9999999999, nHPeriodo;
     be;
     NULL, LeeCabecera110;
|FIN;

|PROCESO DesdeContabilidad;

     |SI enSwPartido = 0;
         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";

         enEmpresa  = nEmpresa;
         enPerConta = #101#3;
         eaLaMonEmp = #101#28;
      |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
      |FINSI;
      |HAZ EnConversor;


     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;
     |ABRE #caivaasi;
     |DDEFECTO #caivaasi;
     |LEE 000#caivaasi.p;
     |CIERRA #caivaasi;
     aMulDep = #caivaasi#132;

     |ABRE #30;
     |BUCLE camaniva110;
     |CIERRA #30;

     |SI enSwPartido = 1;
         enSwOpPar   = 2;
         |HAZ FinalPartido;
     |FINSI;
|FPRC;

|PROCESO nomhicli;
     #204#0 = #200#87;
     #204#2 = #202#4;
     |LEE 101#204=;
     |SI FSalida = 0;
         |SI #204#8 = 0;  |ACABA;  |FINSI;

         |SI #204#13 = "  ";
             #204#13 = "01";
             |GRABA 020#204a;
         |FINSI;

         aClave            = "L";
         aSubClave         = #204#13;
         aEspecie          = "N";
         aRepercute        = "N";
         nImporteBaseI     = #202#11 * #202#10;
         nImporteRetencion = 0;
         |HAZ Grabadsmoc110;
     |SINO;
         aAlfa1 = "0000Concepto [" + #204#0 + "." + #204#2 + "] inaccesible ...";
         |SI #204#2 ! 431;
             |MENAV aAlfa1;
         |SINO;
              aClave            = "L";
              aSubClave         = #204#13;
              aEspecie          = "N";
              aRepercute        = "N";
              nImporteBaseI     = #202#11 * #202#10;
              nImporteRetencion = 0;
              |HAZ Grabadsmoc110;
         |FINSI;
     |FINSI;

     |LIBERA #204;
|FPRC;

|DEFBUCLE nomhicli;
     #202#1;
     ;
     #201#0, #201#1, #201#66, #201#2, #201#3, 411;
     #201#0, #201#1, #201#66, #201#2, #201#3, 499;
     ;
     NULL, nomhicli;
|FIN;

|PROCESO nomhicca;
     nDevengo = 0;

     |SI nAtrasos = 1;
         |SI #205#1 ! #205#3;
             nDevengo = #205#3;
         |FINSI;
     |FINSI;

     #203#0 = #201#0;
     |LEE 000#203=;
     |SI FSalida ! 0;  |DDEFECTO #203; |FINSI;

     #200#0 = #201#0;
     #200#1 = #201#1;
     |LEE 000#200=;
     |SI FSalida ! 0;  |DDEFECTO #200; |FINSI;

     aNombreTrabajador = #200#2;
     aDni              = #200#7;
     aExtranjero       = #200#42;
     nMesLugar         = #201#2;

     aClave            = #200#99;
     aSubClave         = #200#102;
     aEspecie          = #200#105;
     aRepercute        = #200#108;
     nImporteBaseI     = #201#14 + #201#16;
     nImporteRetencion = #201#15 + #201#17;
     |HAZ Grabadsmoc110;

     aClave            = #200#100;
     aSubClave         = #200#103;
     aEspecie          = #200#106;
     aRepercute        = #200#109;
     nImporteBaseI     = #201#108;
     nImporteRetencion = #201#110;
     |HAZ Grabadsmoc110;

     aClave            = #200#101;
     aSubClave         = #200#104;
     aEspecie          = #200#107;
     aRepercute        = #200#110;
     nImporteBaseI     = #201#109;
     nImporteRetencion = #201#111;
     |HAZ Grabadsmoc110;

     |SI #201#18 ! 0;
         |BUCLE nomhicli;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca;
     #201#1;
     ;
     nEmpresa, 00001, nEjer, nDPeriodo, 0;
     nEmpresa, 99999, nEjer, nHPeriodo, 4;
     ;
     NULL, nomhicca;
|FIN;

|DEFBUCLE nomhiccaA;
     #201#1;
     ;
     #205#0, 00001, nEjerAt, 01, #205#2;
     #205#0, 99999, nEjerAt, 12, #205#2;
     ;
     NULL, nomhicca;
|FIN;

|PROCESO nomhiatr;
     |SI #205#4 > nHPeriodo;  |ACABA;  |FINSI;

     |SI #205#4 = 0;
         #205#4 = enPeriodo;
         |GRABA 020#205a;
         |LIBERA #205;
     |FINSI;

     aAlfa   = #205#3;
     aAlfa   = aAlfa % -102;
     nEjerAt = aAlfa;
     |BUCLE nomhiccaA;
|FPRC;

|DEFBUCLE nomhiatr;
     #205#1;
     ;
     nEmpresa, #0#3, 5, 0000;
     nEmpresa, #0#3, 9, 9999;
     be;
     NULL, nomhiatr;
|FIN;

|PROCESO DesdeNominas;
     |PATH_DAT #201 aPathLaboral;
     |PATH_DAT #202 aPathLaboral;
     |PATH_DAT #204 aPathLaboral;

     |ABRE #200;
     |ABRE #203;
     |ABRE #204;
     nAtrasos = 0;  |BUCLE nomhicca;
     nAtrasos = 1;  |BUCLE nomhiatr;
     |CIERRA #200;
     |CIERRA #203;
     |CIERRA #204;
|FPRC;

|PROCESO NuevoContable; || Si es Laboral, y tiene contabilidad, podremos
                        || pasar los profesionales

         enEmpresa = nEmpresa;
         enSwOpPar = 0;
         nSw       = 0;
         |HAZ SituaEmpresa;
         |SI enSwPartido = 0;
             |ABRE #101;
             |SELECT #4#101;
             #101#2  = nEmpresa;
             #101#26 = nEjer;
             |LEE 040#101=;
             |SI FSalida = 0; nSw = 1; |FINSI;
             |CIERRA #101;
         |SINO;
              nSw = 1;
         |FINSI;
         |SI nSw = 1;
             |SI aPeriodicidad = "T";
                 |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
                 |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
                 |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
                 |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
                 |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
                 |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
                 |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
                 |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
                 |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
                 |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
                 |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
                 |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SINO;
                 |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
                 |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
                 |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
                 |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
                 |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
                 |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
                 |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
                 |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
                 |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
                 |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
                 |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
                 |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
             |FINSI;
             |HAZ DesdeContabilidad;
        |FINSI;
        enEmpresa = #999#0;
|FPRC;

|PROCESO PorDonde;
     |ABRE #99;
     #99#0 = 110;
     |LEE 040#99=;
     |SI FSalida ! 0;  |DDEFECTO #99;  |FINSI;
     |CIERRA #99;

     aPathLaboral = "";
     |DBASS aBase;   |QBF aBase;
     aAlfa = aBase + "laboral/def/labempre.mas";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida ] 0;
         aPathLaboral = aBase + "laboral/fich/";
     |FINSI;

     |ABRE #2;
     #2#0 = enEmpresa;
     #2#1 = enActividad;
     #2#2 = 110;
     |LEE 040#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     aPeriodicidad = "T";
     |SI #2#7 = "MENSUAL   ";  aPeriodicidad = "M";  |FINSI;

     |ABRE #100;

     |SI #99#8 = "L"; |O #99#8 = "G";
         |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
         |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
         |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
         |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
         |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
         |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
         |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
         |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
         |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
         |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;

         |DBASS aBase;   |QBF aBase;
         aAlfa = aBase + "laboral/def/labempre.mas";
         |XABRE "E", aAlfa, nHandle;
         |SI FSalida ] 0;
             aPathLaboral = aBase + "laboral/fich/";
             |HAZ DesdeNominas;
             nHayPase = 2;
             |SI #99#8 = "L";
                 |HAZ NuevoContable;
             |FINSI;
         |FINSI;
     |SINO;

         enEmpresa = nEmpresa;
         enSwOpPar = 0;
         nSw       = 0;
         |HAZ SituaEmpresa;
         |SI enSwPartido = 0;
             |ABRE #101;
             |SELECT #4#101;
             #101#2  = nEmpresa;
             #101#26 = nEjer;
             |LEE 040#101=;
             |SI FSalida = 0; nSw = 1; |FINSI;
             |CIERRA #101;
         |SINO;
              nSw = 1;
         |FINSI;
         |SI nSw = 1;
             |SI aPeriodicidad = "T";
                 |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
                 |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
                 |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
                 |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
                 |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
                 |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
                 |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
                 |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
                 |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
                 |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
                 |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
                 |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SINO;
                 |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
                 |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
                 |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
                 |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
                 |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
                 |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
                 |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
                 |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
                 |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
                 |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
                 |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
                 |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
             |FINSI;

             |HAZ DesdeContabilidad;
             nHayPase = 1;
         |SINO;
             enEmpresa = #999#0;
             |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
             |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
             |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
             |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
             |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
             |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;

             |DBASS aBase;   |QBF aBase;
             aAlfa = aBase + "laboral/def/labempre.mas";
             |XABRE "E", aAlfa, nHandle;
             |SI FSalida ] 0;
                 aPathLaboral = aBase + "laboral/fich/";
                 |HAZ DesdeNominas;
                 nHayPase = 2;
             |FINSI;
         |FINSI;
         enEmpresa = #999#0;
     |FINSI;

     |CIERRA #100;
|FPRC;

|PROCESO dsmom026;
     nEmpresa = #26#1;
     |HAZ PorDonde;
|FPRC;

|DEFBUCLE dsmom026;
     #26#1;
     ;
     #999#0, 00001;
     #999#0, 99999;
     ;
     NULL, dsmom026;
|FIN;

|PROCESO OrganizaPase110;
     nPorGrupos = 0;
     |ABRE #26;
     #26#0 = #999#0;
     #26#1 = 0;
     |LEE 040#26];
     |SI FSalida = 0;  |Y #26#0 = #999#0;
         nPorGrupos = 1;
     |FINSI;
     |CIERRA #26;

     |SI nPorGrupos = 0;
         nEmpresa = #999#0;
         |HAZ PorDonde;
     |SINO;
         |BUCLE dsmom026;
     |FINSI;
|FPRC;

|PROCESO BorrarCeros;
     |HAZ MiraCampos110;  || mira si son todos = 0 o no
     |SI aTodoCero = "S";
         |BORRA 020#100a;
         |LIBERA #100;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc110B;
     #100#1;
     ;
     #999#0, #999#2, #999#3, #999#7, #999#9, #999#1, aDn, 0,    " ", "  ";
     #999#0, #999#2, #999#3, #999#7, #999#9, #999#1, aHn, 9999, "z", "zz";
     be;
     NULL, BorrarCeros;
|FIN;

|PROCESO Compensa110;
     nHay  = 0;

     #100#0  = #1300#0;
     #100#1  = #1300#1;
     #100#2  = #999#3;
     #100#3  = #1300#3;
     #100#4  = #999#9;
     #100#5  = #1300#5;
     #100#6  = #1300#6;
     #100#7  = #1300#7;
     #100#8  = #1300#8;
     #100#9  = #1300#9;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0  = #1300#0;
         #100#1  = #1300#1;
         #100#2  = #999#3;
         #100#3  = #1300#3;
         #100#4  = #999#9;
         #100#5  = #1300#5;
         #100#6  = #1300#6;
         #100#7  = #1300#7;
         #100#8  = #1300#8;
         #100#9  = #1300#9;
         #100#29 = #1300#29;
         |GRABA 020#100b;

         nHay = 1;
     |SINO;
         |HAZ MiraCampos110;
         |SI aTodoCero = "S";
             nHay = 1;
         |FINSI;
     |FINSI;

     |SI nHayPase = 1;  nHay = 0;  |FINSI;

     |SI nHay = 1; |Y #100#7 ! 0;
         nHay = 0;  || Tique de Serna: 98/1518 (09.01.2007)
     |FINSI;

     |SI nHay = 1;
         |PARA nCampo1 = 10;  |SI nCampo1 [ 24;  |HACIENDO nCampo1 = nCampo1 + 1;
               #100nCampo1 = #100nCampo1 + #1300nCampo1;
         |SIGUE;
     |FINSI;

     |PARA nCampo1 = 10;  |SI nCampo1 [ 24;  |HACIENDO nCampo1 = nCampo1 + 1;
           #100nCampo1 = #100nCampo1 - #1300nCampo1;
     |SIGUE;

     |GRABA 020#100a;
     |LIBERA #100;

     |HAZ MiraCampos110;  || mira si son todos = 0 o no

     |SI aTodoCero = "S";
         |SI nHay = 0;
             |BORRA 020#100a;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Bdsmoc110;
     #1300#1010;
     ;
     #999#0, #999#2, nPeriodo, 110, nDComplem, #999#1, aDn, 0,    " ", "  ";
     #999#0, #999#2, nPeriodo, 110, nHComplem, #999#1, aHn, 9999, "z", "zz";
     ;
     NULL, Compensa110;
|FIN;

|PROCESO Anterior110;
     #100#0  = #1300#0;
     #100#1  = #999#2;
     #100#2  = #999#3;
     #100#3  = #1300#3;
     #100#4  = #999#9;
     #100#5  = #1300#5;
     #100#6  = #1300#6;
     #100#7  = #1300#7;
     #100#8  = #1300#8;
     #100#9  = #1300#9;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0  = #1300#0;
         #100#1  = #999#2;
         #100#2  = #999#3;
         #100#3  = #1300#3;
         #100#4  = #999#9;
         #100#5  = #1300#5;
         #100#6  = #1300#6;
         #100#7  = #1300#7;
         #100#8  = #1300#8;
         #100#9  = #1300#9;
         #100#29 = #1300#29;
         |GRABA 020#100n;
    |FINSI;
    |LIBERA #100;
|FPRC;

|DEFBUCLE dsmoc110A;
     #1300#1010;
     ;
     #999#0, nAnyo, nPeriodo, 110, nDComplem, #999#1, aDn, 0,    " ", "  ";
     #999#0, nAnyo, nPeriodo, 110, nHComplem, #999#1, aHn, 9999, "z", "zz";
     ;
     NULL, Anterior110;
|FIN;

|PROCESO dsmom002_110;
     |ERROR10;
|FPRC;

|DEFBUCLE dsmom002_110;
     #2#1;
     ;
     #999#0,  1, 110;
     #999#0, 98, 110;
     ;
     NULL, dsmom002_110;
|FIN;

|PROCESO PaseAnterior110;
     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/dsmoc110.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BUCLE dsmom002_110;

     |SI FSalida ! 0;  |O #2#0 ! #999#0;  |O #2#2 ! 110;
         |DDEFECTO #2;
     |FINSI;

     nAnyo = #999#2;
     |SI #2#7 = "TRIMESTRAL";
         |SI #999#3 = 3;
             nAnyo = #999#2 - 1;
             nPeriodo = 12;
         |SINO;
             nPeriodo = #999#3 - 3;
         |FINSI;
     |SINO;
         |SI #999#3 = 1;
             nAnyo = #999#2 - 1;
             nPeriodo = 12;
         |SINO;
             nPeriodo = #999#3 - 1;
         |FINSI;
     |FINSI;

     |ABRE #100;
     |BUCLE dsmoc110A;
     |CIERRA #100;

     |DESCARGA_DEF #espejo1@;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #999#9;
     enActividad   = #999#1;
     enTipoEntrada = 98;
     eaNombreAct   = #999#6;
     |SUB_EJECUTA_NP "dsmoc110";

     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = #999#9;
     |LEE 101#4=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB
         #4#9 = " ";
         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO Pase110;
     || borrar dsmoc110 y dsmod110

     |DDEFECTO #8;
     |ABRE #8;
     #8#0 = #999#0;
     #8#1 = #999#2;
     #8#2 = #999#3;
     #8#3 = #999#7;
     #8#4 = #999#9;
     #8#5 = #999#1;
     |LEE 101#8=;
     |SI FSalida = 0;  |Y enAnterior = 0;
         #8#11 = "SIN DATOS";
         |GRABA 020#8a;

         enEmpresa     = #8#0;
         enEjer        = #8#1;
         enPeriodo     = #8#2;
         enModelo      = #8#3;
         enComplem     = #8#4;
         enActividad   = #8#5;
         enTipoEntrada = 97;
         |SUB_EJECUTA_NP "dsmoc110";
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;

     |SI enAnterior = 1;         || Recogida de un Periodo Anterior
         |HAZ PaseAnterior110;

         |ACABA;
     |FINSI;

     |ABRET #100;

     aAlfa = #999#2;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #999#9;
     enActividad   = #999#1;
     nHayPase      = 0;

     |HAZ OrganizaPase110;

     |SI nHayPase = 0;
         enEmpresa     = #999#0;
         enEjer        = #999#2;
         enPeriodo     = #999#3;
         enModelo      = #999#7;
         enComplem     = #999#9;
         enActividad   = #999#1;
         enTipoEntrada = 98;
         eaNombreAct   = #999#6;
         |SUB_EJECUTA_NP "dsmoc110";
         |CIERRAT #100;
         |CIERRA #101;
         |ACABA;
     |FINSI;

     |SI #999#3 ! 1;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc110.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida = 0;
             nHComplem = enComplem;  || miro el ultimo complementario
                                     || de los periodos anteriores 14_1285
             |PARA nPeriodo = 1;  |SI nPeriodo < #999#3;  |HACIENDO nPeriodo = nPeriodo + 1;
                   nDComplem = -1;
                   |ABRE #1300;
                   |DDEFECTO #1300;
                   #1300#0 = #999#0;
                   #1300#1 = #999#2;
                   #1300#2 = nPeriodo
                   #1300#3 = 110;
                   #1300#4 = 99;
                   |LEE 040#1300];
                   |SI FSalida = 0;
                       |LEE 040#1300a;
                    |SINO;
                       |LEE 040#1300u;
                   |FINSI;
                   |SI FSalida = 0; |Y #1300#0 = #999#0; |Y #1300#1 = #999#2;
                             |Y #1300#2 = nPeriodo; |Y #1300#3 = 110;
                                nDComplem = #1300#4;
                                nHComplem = #1300#4;
                   |FINSI;
                   |CIERRA #1300;
                   |SI nDComplem ] 0; |BUCLE Bdsmoc110; |FINSI;
             |SIGUE;

             |SI #999#9 ! 0; ||las complementarias son en realidad sustitutivas
                             ||por tanto no restamos lo de las comp. anteriores
                             ||Lopez Andres: 14_1285
                 nDComplem = 0;
                 nHComplem = enComplem - 1;
                 nPeriodo  = #999#3;
||                 |BUCLE Bdsmoc110;
             |FINSI;
         |FINSI;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     |CIERRAT #100;

     |SI nHayPase = 2; |Y #999#1 ! 99; |BUCLE dsmoc110B; |FINSI; ||si viene de nominas
                                       ||Socer y Serna 18.10.2007
     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #999#9;
     enActividad   = #999#1;
     enTipoEntrada = 98;
     eaNombreAct   = #999#6;
     |SUB_EJECUTA_NP "dsmoc110";

     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = #999#9;
     |LEE 101#4=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         #4#9 = " ";
         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;
|FPRC;
