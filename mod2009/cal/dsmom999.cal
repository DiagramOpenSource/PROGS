|FICHEROS;
     dsmom999 #999;
     dsmow700 #970,MANTE;
|FIN;

|VARIABLES;
     aFichero     = "";
     aEti1        = "";
     aEti2        = "";
     aCaracter10  = "";
     aCaracter13  = "";
     aAbre        = "";
     aCadenaTexto = "";
     aCaracter    = "";

     nCampo      = 0;
     nHandle     = 0;
     nClave2     = 0;
     nClave3     = 0;
     nClave4     = 0;
     nClave5     = 0;
     nClave6     = 0;
     nClave7     = 0;
     nClave8     = 0;
     nClave9     = 0;
     nClave10    = 0;
     nClave11    = 0;
|FIN;

|PROCESO CreaModelos;
     #970#0 = 390;  #970#1 = 2004;  |GRABA 020#970n;  |LIBERA #970;
     #970#0 = 390;  #970#1 = 2005;  |GRABA 020#970n;  |LIBERA #970;
     #970#0 = 390;  #970#1 = 2006;  |GRABA 020#970n;  |LIBERA #970;
     #970#0 = 390;  #970#1 = 2007;  |GRABA 020#970n;  |LIBERA #970;
     #970#0 = 390;  #970#1 = 2008;  |GRABA 020#970n;  |LIBERA #970;
|FPRC;

|RUTINA Baja970;
     #970#0 = 0;
     #970#1 = 0;
|FRUT;

|RUTINA Alta970;
     #970#0 = 999;
     #970#1 = 9999;
|FRUT;

|RUTINA Baja999;
     #999#0  = #970#0;
     #999#1  = #970#1;
     #999#2  = 0;
     #999#3  = 0;
     #999#4  = 0;
     #999#5  = 0;
     #999#6  = 0;
     #999#7  = 0;
     #999#8  = 0;
     #999#9  = 0;
     #999#10 = 0;
     #999#11 = 0;
|FRUT;

|RUTINA Alta999;
     #999#0  = #970#0;
     #999#1  = #970#1;
     #999#2  = 99;
     #999#3  = 99;
     #999#4  = 99;
     #999#5  = 99;
     #999#6  = 99;
     #999#7  = 99;
     #999#8  = 99;
     #999#9  = 99;
     #999#10 = 99;
     #999#11 = 99;
|FRUT;

|PROCESO dsmom999;
     |BORRA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE dsmom999;
     #999#1;
     ;
     #970#0, #970#1, 00, 00, 00, 00, 00, 00, 00, 00, 00, 00;
     #970#0, #970#1, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99;
     be;
     NULL, dsmom999;
|FIN;

|PROCESO CargaCadena;
     |SI nCampo = 0;   nClave2  = aCadenaTexto;  |FINSI;
     |SI nCampo = 1;   nClave3  = aCadenaTexto;  |FINSI;
     |SI nCampo = 2;   nClave4  = aCadenaTexto;  |FINSI;
     |SI nCampo = 3;   nClave5  = aCadenaTexto;  |FINSI;
     |SI nCampo = 4;   nClave6  = aCadenaTexto;  |FINSI;
     |SI nCampo = 5;   nClave7  = aCadenaTexto;  |FINSI;
     |SI nCampo = 6;   nClave8  = aCadenaTexto;  |FINSI;
     |SI nCampo = 7;   nClave9  = aCadenaTexto;  |FINSI;
     |SI nCampo = 8;   nClave10 = aCadenaTexto;  |FINSI;
     |SI nCampo = 9;   nClave11 = aCadenaTexto;  |FINSI;
     |SI nCampo = 10;  aEti1    = aCadenaTexto;  |FINSI;
     |SI nCampo = 11;  aEti2    = aCadenaTexto;  |FINSI;
|FPRC;

|PROCESO GrabaCadena;
     #999#0  = #970#0;
     #999#1  = #970#1;
     #999#2  = nClave2;
     #999#3  = nClave3;
     #999#4  = nClave4;
     #999#5  = nClave5;
     #999#6  = nClave6;
     #999#7  = nClave7;
     #999#8  = nClave8;
     #999#9  = nClave9;
     #999#10 = nClave10;
     #999#11 = nClave11;
     #999#12 = aEti1;
     #999#13 = aEti2;
     |GRABA 020#999n;
     |LIBERA #999;

     nClave2  = 0;
     nClave3  = 0;
     nClave4  = 0;
     nClave5  = 0;
     nClave6  = 0;
     nClave7  = 0;
     nClave8  = 0;
     nClave9  = 0;
     nClave10 = 0;
     nClave11 = 0;
     aEti1    = "";
     aEti2    = "";
|FPRC;

|PROCESO Recoge;
     |PUSHV 0501 2380;

     |BLANCO 0501 2380;
     |PINTA 1025, "RECOGIENDO DATOS";

     aCaracter10 = &10;
     aCaracter13 = &13;
     aAbre       = "/Cajon/Hacienda/XML/" + #970#0 + #970#1 + ".txt";
     nCampo      = 0;
     |XABRE "ACB", aAbre, nHandle;
     |SI FSalida ] 0;
         |BUCLE dsmom999;

         |ABRE #999;
         |PARA;  |SI;  |HACIENDO;
              |XLEE nHandle, 1, aCaracter;
              |SI FSalida [ 0;  |SAL;  |FINSI;

              |SI aCaracter = aCaracter10;
                  |HAZ GrabaCadena;
                  nCampo       = 0;
                  aCadenaTexto = "";
              |FINSI;

              |SI aCaracter = aCaracter13;
                  |HAZ CargaCadena;
                  nCampo       = nCampo + 1;
                  aCadenaTexto = "";
              |FINSI;

              |SI aCaracter ! aCaracter10;  |Y aCaracter ! aCaracter13;
                  |SI aCaracter = "|";
                      |HAZ CargaCadena;
                      nCampo       = nCampo + 1;
                      aCadenaTexto = "";
                  |SINO;
                      aCadenaTexto = aCadenaTexto + aCaracter;
                  |FINSI;
              |FINSI;
         |SIGUE;
     |FINSI;
     |XCIERRA nHandle;
     |CIERRA #999;

     |POPV;
|FPRC;

|PROCESO Tipo7w700;  |TIPO 7;
     |ENTLINEAL #1#999, -3, 7, 22, 0, Baja999, Alta999;
|FPRC;

|PROCESO Tipo11w700;  |TIPO 11;
     |SI FSalida = 18;  |HAZ Recoge; |ACABA;  |FINSI;

     |SI FSalida = 10;
         |ENTLINEAL #1#999, -3, 4, 22, 0, Baja999, Alta999;
     |FINSI;
|FPRC;

|PROGRAMA;
     aFichero = ("70" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #970 aFichero;
     |ABRE #970;  |CIERRA #970;  |DELINDEX #970;

     |ABRE #970;
     |HAZ CreaModelos;
     |CIERRA #970;

     |PINPA #0#999;

     |ENTLINEAL #1#970, -1, 4, 22, 0, Baja970, Alta970;

     |DELINDEX #970;
|FPRO;
