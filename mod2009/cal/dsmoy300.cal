|FICHEROS;
     dsmoy000 #0;
     dsmom004 #4;
     dsmom107 #107;
     dsmow600 #600;
     dsmow601 #601,MANTE;

     dsmod300 #300;
     dsmow014 #999;
     dsmow505 #505;
     dsmow519 #519;
     dsmow544 #544;
     dsmow574 #574;

     &regisnif@ #709;
     &clientes@ #715;
     &datosper@ #718;
|FIN;

|VARIABLES;
|FIN;

|INCLUYE i_varemi;

|PROCESO Registro300_2001;
     |SI nTecla = 1;
         aAbre = eaPathEmision + "300" + (("00000" + #999#0) % -105) + ".TXT";
         |XABRE "BW", aAbre, nHandle2;
     |FINSI;

     |ABRE #300;
     #300#0 = #4#0;
     #300#1 = #4#1;
     #300#2 = #4#2;
     #300#3 = #4#3;
     #300#4 = #4#4;
     #300#5 = 0;
     |LEE 040#300=;
     |SI FSalida ! 0;  |CIERRA #300;  |ACABA;  |FINSI;
     |CIERRA #300;

     enCodCli = #300#0;
     |HAZ LeePersona;

     |DDEFECTO #505;
     |SI eaMoneda = "PESETAS";
         #505#1    = "300";
     |SINO;
         #505#1    = "303";
     |FINSI;

     #505#2  = "01";
     #505#3  = "";

     |SI enSwDeDonde = 1;
         #505#4   = (("00" + #715#15) % -102) + (("000" + #715#16) % -103);
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #505#5   = eaVarDni;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = aAlfa1;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #505#6 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #505#7 = eaAlfa;
         |SINO;
             eaAlfa = #715#1;  |HAZ QuitaRaros;  #505#6  = eaAlfa;
             #505#7  = ".";
         |FINSI;
         #505#8  = #715#29;
         eaAlfa  = #715#30;  |HAZ QuitaRaros;  #505#9 = eaAlfa;
         #505#10 = #715#31 % 104;
         #505#11 = #715#32;
         #505#12 = #715#33;
         #505#13 = #715#34;
         #505#14 = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
         eaAlfa  = #715#37;  |HAZ QuitaRaros;      #505#15 = eaAlfa;
         eaAlfa  = #715#38;  |HAZ QuitaRaros;      #505#16 = eaAlfa;
         eaAlfa  = #715#54;  |HAZ QuitaRarosTfno;  #505#17 = eaAlfa;

         eaDeleg     = #715#17;
         eaAdmin     = #715#18;

         |SI #300#64 ! 0;
             enModelo = 300;  enForzar = 1;  |HAZ CogeDatosBancos;

             #505#57 = eaEntidad;
             #505#58 = eaOficina;
             #505#59 = eaDC;
             #505#60 = eaCuenta;
         |FINSI;

         |SI #300#65 ! 0;
             enModelo = 300;  enForzar = 0;  |HAZ CogeDatosBancos;

             |SI eaFormaPago = "1";  #505#61 = "X";  |FINSI;
             |SI eaFormaPago ! "1";  #505#62 = "X";  |FINSI;

             #505#64 = eaEntidad;
             #505#65 = eaOficina;
             #505#66 = eaDC;
             #505#67 = eaCuenta;
         |FINSI;
     |SINO;
         #505#4   = (("00" + #715#63) % -102) + (("000" + #715#64) % -103);
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #505#5   = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;      #505#6  = eaAlfa;
         #505#7   = ".";
         #505#8   = #715#3;
         eaAlfa   = #715#4;  |HAZ QuitaRaros;      #505#9 = eaAlfa;
         #505#10 = #715#5 % 104;
         #505#11 = #715#6;
         #505#12 = #715#7;
         #505#13 = #715#8;
         #505#14 = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
         eaAlfa  = #715#11;  |HAZ QuitaRaros;     #505#15 = eaAlfa;
         eaAlfa  = #715#12;  |HAZ QuitaRaros;     #505#16 = eaAlfa;
         eaAlfa  = #715#14;  |HAZ QuitaRarosTfno; #505#17 = eaAlfa;

         eaDeleg     = #715#91;
         eaAdmin     = #715#92;

         |SI #300#64 ! 0;
             |SI #715#84 ! "                    ";
                 #505#57 = #715#81;
                 #505#58 = #715#82;
                 #505#59 = #715#83;
                 #505#60 = #715#84 % 110;
             |FINSI;
         |FINSI;

         |SI #300#65 ! 0;
             |SI #715#84 = "                    ";
                 #505#61  = "X";
             |SINO;
                 #505#62  = "X";
                 #505#64 = #715#81;
                 #505#65 = #715#82;
                 #505#66 = #715#83;
                 #505#67 = #715#84 % 110;
             |FINSI;
         |FINSI;
     |FINSI;

     #505#18  = #300#1;

     |SI #300#2 = 3;   #505#19 = 1;  |FINSI;
     |SI #300#2 = 6;   #505#19 = 2;  |FINSI;
     |SI #300#2 = 9;   #505#19 = 3;  |FINSI;
     |SI #300#2 = 12;  #505#19 = 4;  |FINSI;

     enNume = #300#6;   |HAZ Conver12;  #505#20 = eaAlfa;
     nNume  = #300#7  * 100;      #505#21 = ("0000" + nNume) % -104;
     enNume = #300#8;   |HAZ Conver12;  #505#22 = eaAlfa;

     enNume = #300#9;   |HAZ Conver12;  #505#23 = eaAlfa;
     nNume  = #300#10 * 100;      #505#24 = ("0000" + nNume) % -104;
     enNume = #300#11;  |HAZ Conver12;  #505#25 = eaAlfa;

     enNume = #300#12;  |HAZ Conver12;  #505#26 = eaAlfa;
     nNume  = #300#13 * 100;      #505#27 = ("0000" + nNume) % -104;
     enNume = #300#14;  |HAZ Conver12;  #505#28 = eaAlfa;

     enNume = #300#15;  |HAZ Conver12;  #505#29 = eaAlfa;
     nNume  = #300#16 * 100;      #505#30 = ("0000" + nNume) % -103;
     enNume = #300#17;  |HAZ Conver12;  #505#31 = eaAlfa;

     enNume = #300#18;  |HAZ Conver12;  #505#32 = eaAlfa;
     nNume  = #300#19 * 100;      #505#33 = ("0000" + nNume) % -103;
     enNume = #300#20;  |HAZ Conver12;  #505#34 = eaAlfa;

     enNume = #300#21;  |HAZ Conver12;  #505#35 = eaAlfa;
     nNume  = #300#22 * 100;      #505#36 = ("0000" + nNume) % -103;
     enNume = #300#23;  |HAZ Conver12;  #505#37 = eaAlfa;

     enNume = #300#24 + #300#27 + #300#30;  |HAZ Conver12;
                                  #505#38 = eaAlfa;
     enNume = #300#26 + #300#29 + #300#32;  |HAZ Conver12;
                                  #505#39 = eaAlfa;

     enNume = #300#33;  |HAZ Conver12;  #505#40 = eaAlfa;
     enNume = #300#39;  |HAZ Conver12;  #505#41 = eaAlfa;
     enNume = #300#45;  |HAZ Conver12;  #505#42 = eaAlfa;
     enNume = #300#51;  |HAZ Conver12;  #505#43 = eaAlfa;
     enNume = #300#53;  |HAZ Conver12;  #505#44 = eaAlfa;
     enNume = #300#54;  |HAZ Conver12;  #505#45 = eaAlfa;
     enNume = #300#55;  |HAZ Conver12;  #505#46 = eaAlfa;
     enNume = #300#56;  |HAZ Conver12;  #505#47 = eaAlfa;
     nNume = #300#57 * 100;      #505#48 = ("0000" + nNume) % -105;
     enNume = #300#58;  |HAZ Conver12;  #505#49 = eaAlfa;
     enNume = #300#59;  |HAZ Conver12;  #505#50 = eaAlfa;
     enNume = #300#60;  |HAZ Conver12;  #505#51 = eaAlfa;
     enNume = #300#61;  |HAZ Conver12;  #505#52 = eaAlfa;
     enNume = #300#62;  |HAZ Conver12;  #505#53 = eaAlfa;
     enNume = #300#63;  |HAZ Conver12;  #505#54 = eaAlfa;
     |SI #300#33 = 0;  |Y #300#55 = 0;
         #505#55 = "X";
     |FINSI;
     enNume = #300#64;  |HAZ Conver12;  #505#56 = eaAlfa;
     enNume = #300#65;  |HAZ Conver12;  #505#63 = eaAlfa;

     eaAlfa = #0#7;  |HAZ FechaBonito;
     #505#68 = eaDiaB;
     #505#69 = eaMesB;
     #505#70 = eaAnyoB;
     #505#71 = &13 + &10;

     |SI nTecla = 1;
         aAlfa = "";
         |PARA nCampo = 1;  |SI nCampo [ 71;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #505nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         |XCIERRA nHandle2;

         eaFOrigen  = eaPathEmision + "300" + (("00000" + #999#0) % -105) + ".TXT";
         eaFDestino = eaPathLanza + "300" + (("00000" + #999#0) % -105) + ".TXT";
         |HAZ CopiaFichero;

         |FBORRA eaFOrigen;

         aAlfa = "del err" + (("00000" + #999#0) % -105) + ".TXT" + &13 + &10;
         |XGRABA nHandle1, aAlfa;

         aAlfa = "wait mipf " + "300" + (("00000" + #999#0) % -105) + ".TXT";

         |SI #600#0 = "N";  aAlfa = aAlfa + " s";  |FINSI;
         |SI #600#1 = "S";  aAlfa = aAlfa + " a";  |FINSI;
         aAlfa = aAlfa + " " + #600#2;
         aAlfa = aAlfa + &13 + &10;
         |XGRABA nHandle1, aAlfa;

         aAlfa = "move errores.txt err" + (("00000" + #999#0) % -105) + ".TXT" + &13 + &10;
         aAlfa = aAlfa + &13 + &10;

         |XGRABA nHandle1, aAlfa;
     |FINSI;

     |SI nTecla = 4;
         |PRINT;
         |PIEINF;
     |FINSI;
|FPRC;

|PROCESO Internet300_2001;
     |ABRE #300;
     #300#0 = #4#0;
     #300#1 = #4#1;
     #300#2 = #4#2;
     #300#3 = #4#3;
     #300#4 = #4#4;
     #300#5 = 0;
     |LEE 040#300=;
     |SI FSalida ! 0;  |CIERRA #300;  |ACABA;  |FINSI;
     |CIERRA #300;

     aAbre = eaPathEmision + "300" + (("00000" + #999#0) % -105) + ".TXT";
     |XABRE "BW", aAbre, nHandle2;

     enCodCli = #300#0;
     |HAZ LeePersona;

     |DDEFECTO #519;
     |SI eaMoneda = "PESETAS";
         #519#2    = "P";
     |SINO;
         #519#2    = "E";
     |FINSI;

     #519#1  = "300";

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;    #519#3  = eaVarDni;
         eaAlfa = #715#57;  |HAZ QuitaRaros;       #519#4  = eaAlfa;
         eaAlfa = #715#53;  |HAZ QuitaRaros;       #519#45 = eaAlfa;
         eaAlfa = #715#54;  |HAZ QuitaRarosTfno;   #519#46 = eaAlfa;

         |SI #300#64 ! 0;
             enModelo = 300;  enForzar = 1;  |HAZ CogeDatosBancos;

             #519#41 = eaEntidad;
             #519#42 = eaOficina;
             #519#43 = eaDC;
             #519#44 = eaCuenta;
         |FINSI;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #519#3  = eaVarDni;
         eaAlfa   = #715#1;   |HAZ QuitaRaros;     #519#45 = eaAlfa;
         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno; #519#46 = eaAlfa;

         |SI #300#64 ! 0;
             #519#4  = "D";
             |SI #715#84 ! "                    ";
                 #519#41 = #715#81;
                 #519#42 = #715#82;
                 #519#43 = #715#83;
                 #519#44 = #715#84 % 110;
             |FINSI;
         |FINSI;
     |FINSI;

     #519#5 = #300#1;

     |SI #300#2 = 3;   #519#6 = "1T";  |FINSI;
     |SI #300#2 = 6;   #519#6 = "2T";  |FINSI;
     |SI #300#2 = 9;   #519#6 = "3T";  |FINSI;
     |SI #300#2 = 12;  #519#6 = "4T";  |FINSI;


     enNume = #300#6;   |HAZ Conver17;  #519#7  = eaAlfa;
     nNume  = #300#7  * 100;      #519#8 = ("0000" + nNume) % -104;
     enNume = #300#8;   |HAZ Conver17;  #519#9  = eaAlfa;

     enNume = #300#9;   |HAZ Conver17;  #519#10 = eaAlfa;
     nNume  = #300#10 * 100;      #519#11 = ("0000" + nNume) % -104;
     enNume = #300#11;  |HAZ Conver17;  #519#12 = eaAlfa;

     enNume = #300#12;  |HAZ Conver17;  #519#13 = eaAlfa;
     nNume  = #300#13 * 100;      #519#14 = ("0000" + nNume) % -104;
     enNume = #300#14;  |HAZ Conver17;  #519#15 = eaAlfa;

     enNume = #300#15;  |HAZ Conver17;  #519#16 = eaAlfa;
     nNume  = #300#16 * 100;      #519#17 = ("0000" + nNume) % -104;
     enNume = #300#17;  |HAZ Conver17;  #519#18 = eaAlfa;

     enNume = #300#18;  |HAZ Conver17;  #519#19 = eaAlfa;
     nNume  = #300#19 * 100;      #519#20 = ("0000" + nNume) % -104;
     enNume = #300#20;  |HAZ Conver17;  #519#21 = eaAlfa;

     enNume = #300#21;  |HAZ Conver17;  #519#22 = eaAlfa;
     nNume  = #300#22 * 100;      #519#23 = ("0000" + nNume) % -104;
     enNume = #300#23;  |HAZ Conver17;  #519#24 = eaAlfa;

     enNume = #300#24 + #300#27 + #300#30;  |HAZ Conver17;
                                  #519#25 = eaAlfa;
     enNume = #300#26 + #300#29 + #300#32;  |HAZ Conver17;
                                  #519#26 = eaAlfa;

     enNume = #300#33;  |HAZ Conver17;  #519#27 = eaAlfa;
     enNume = #300#39;  |HAZ Conver17;  #519#28 = eaAlfa;
     enNume = #300#45;  |HAZ Conver17;  #519#29 = eaAlfa;
     enNume = #300#51;  |HAZ Conver17;  #519#30 = eaAlfa;
     enNume = #300#53;  |HAZ Conver17;  #519#31 = eaAlfa;
     enNume = #300#54;  |HAZ Conver17;  #519#32 = eaAlfa;
     enNume = #300#55;  |HAZ Conver17;  #519#33 = eaAlfa;
     enNume = #300#56;  |HAZ Conver17;  #519#34 = eaAlfa;
     nNume  = #300#57 * 100;      #519#35 = ("00000" + nNume) % -105;
     enNume = #300#58;  |HAZ Conver17;  #519#36 = eaAlfa;
     enNume = #300#59;  |HAZ Conver17;  #519#37 = eaAlfa;
     enNume = #300#60;  |HAZ Conver17;  #519#38 = eaAlfa;
     enNume = #300#61;  |HAZ Conver17;  #519#39 = eaAlfa;
     enNume = #300#62;  |HAZ Conver17;  #519#40 = eaAlfa;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 50;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #519nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     eaFOrigen  = eaPathEmision + "300" + (("00000" + #999#0) % -105) + ".TXT";
     eaFDestino = eaPathInternet + "300" + (("00000" + #999#0) % -105) + ".TXT";
     |HAZ CopiaFichero;

     |FBORRA eaFOrigen;

     enImpReal  = #300#56;  ||Casilla 28
     enCas21    = #300#33;
     enCas27    = #300#55;
     enCas31    = #300#59;
     enCas34    = #300#62;
     enIngresar = #300#65;
     enDevolver = #300#64;
     enCompensar= #300#63;
     |HAZ GrabaImpreso;
|FPRC;

|PROCESO CargaImprime300;
     aAlfa = "del err" + (("00000" + #999#0) % -105) + ".TXT" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "wait mipf32 ";
     aAlfa = aAlfa + "/E:300" + (("00000" + #999#0) % -105) + ".TXT ";
     aAlfa = aAlfa + "/R:err" + (("00000" + #999#0) % -105) + ".TXT ";
     |SI eaImpresora ! "";
         aAlfa = aAlfa + "/I:" + &34 + eaImpresora + &34;
     |FINSI;
     aAlfa = aAlfa + " /C:" + #601#0;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO TDeclaracion300;
     |SI #300#64 ! 0;
         enModelo = 300;  enForzar = 1;  |HAZ CogeDatosBancos;

         #544#58 = eaEntidad;
         #544#59 = eaOficina;
         #544#60 = eaDC;
         #544#61 = eaCuenta;
     |FINSI;

     |SI #300#65 ! 0;
         enModelo = 300;  enForzar = 0;  |HAZ CogeDatosBancos;

         |SI eaFormaPago = "1";  #544#62 = "X";  |FINSI;
         |SI eaFormaPago ! "1";  #544#63 = "X";  |FINSI;

         #544#65 = eaEntidad;
         #544#66 = eaOficina;
         #544#67 = eaDC;
         #544#68 = eaCuenta;
     |FINSI;

     #544#4  = "";
     |SI nTecla ! 3;
         |SI #300#33 = 0;  |Y #300#55 = 0;  |Y #300#62 = 0;
             #544#4 = "N";
         |FINSI;
     |SINO;
         |SI #300#63 ! 0;  #544#4 = "C";  |FINSI;
         |SI #300#64 ! 0;  #544#4 = "D";  |FINSI;

         |SI #300#65 ! 0;
                                     #544#4 = "I";
             |SI eaFormaPago = "3";  #544#4 = "U";  |FINSI;
             |SI eaFormaPago = "4";  #544#4 = "A";  |FINSI;
             |SI eaFormaPago = "5";  #544#4 = "E";  |FINSI;
         |FINSI;

         |SI #300#33 = 0;  |Y #300#55 = 0;  |Y #300#62 = 0; |Y #300#59 = 0;
             #544#4 = "N";
         |FINSI;

         |SI #300#2 = 12;  |Y #300#1 = 2007;  |Y #300#65 ! 0;
                                      aAlfa  = "0";
             |SI eaFormaPago = "1"    aAlfa  = "1";  |FINSI;
             |SI eaFormaPago = "2";   aAlfa  = "2";  |FINSI;
             |SI eaFormaPago = "3";   aAlfa  = "3";  |FINSI;
             |SI eaFormaPago = "4";   aAlfa  = "4";  |FINSI;
             |SI eaFormaPago = "5";   aAlfa  = "5";  |FINSI;

             #544#62 = aAlfa;
             #544#63 = "";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Carga300_2002;
     |SI nTecla = 1;  |O nTecla = 3;
         aAbre = eaPathEmision + "300" + (("00000" + #999#0) % -105) + ".TXT";
         |XABRE "BW", aAbre, nHandle2;
     |FINSI;

     |ABRE #300;
     #300#0 = #4#0;
     #300#1 = #4#1;
     #300#2 = #4#2;
     #300#3 = #4#3;
     #300#4 = #4#4;
     #300#5 = 0;
     |LEE 040#300=;
     |SI FSalida ! 0;  |CIERRA #300;  |ACABA;  |FINSI;
     |CIERRA #300;

     enCodCli = #300#0;
     |HAZ LeePersona;

     |DDEFECTO #544;

     #544#1  = "300";
     #544#2  = "01";
     #544#3  = "";

     |SI enSwDeDonde = 1;
         #544#5   = (("00" + #715#15) % -102) + (("000" + #715#16) % -103);
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #544#6  = eaVarDni;
         eaAlfa   = #715#57; |HAZ QuitaRaros;     #544#7  = eaAlfa;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = aAlfa1;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #544#8 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #544#9 = eaAlfa;
         |SINO;
             eaAlfa = #715#1;  |HAZ QuitaRaros;  #544#8  = eaAlfa;
             #544#9  = ".";
         |FINSI;
         #544#10 = #715#29;
         eaAlfa  = #715#30;  |HAZ QuitaRaros;  #544#11 = eaAlfa;
         #544#12 = #715#31 % 104;
         #544#13 = #715#32;
         #544#14 = #715#33;
         #544#15 = #715#34;
         #544#16 = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
         eaAlfa  = #715#37;  |HAZ QuitaRaros;      #544#17 = eaAlfa;
         eaAlfa  = #715#38;  |HAZ QuitaRaros;      #544#18 = eaAlfa;
         eaAlfa  = #715#54;  |HAZ QuitaRarosTfno;  #544#19 = eaAlfa;
         eaAlfa  = #715#53;  |HAZ QuitaRaros;      #544#69 = eaAlfa;
         eaAlfa  = #715#54;  |HAZ QuitaRarosTfno;  #544#70 = eaAlfa;
         eaDeleg = #715#17;
         eaAdmin = #715#18;
     |SINO;
         #544#5   = (("00" + #715#63) % -102) + (("000" + #715#64) % -103);
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #544#6   = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;      #544#8   = eaAlfa;
         #544#9   = ".";
         #544#10  = #715#3;
         eaAlfa   = #715#4;  |HAZ QuitaRaros;      #544#11  = eaAlfa;
         #544#12 = #715#5 % 104;
         #544#13 = #715#6;
         #544#14 = #715#7;
         #544#15 = #715#8;
         #544#16 = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
         eaAlfa  = #715#11;  |HAZ QuitaRaros;     #544#17 = eaAlfa;
         eaAlfa  = #715#12;  |HAZ QuitaRaros;     #544#18 = eaAlfa;
         eaAlfa  = #715#14;  |HAZ QuitaRarosTfno; #544#19 = eaAlfa;
         eaAlfa  = #715#1;   |HAZ QuitaRaros;     #544#69 = eaAlfa;
         eaAlfa  = #715#14;  |HAZ QuitaRarosTfno; #544#70 = eaAlfa;
         eaDeleg = #715#91;
         eaAdmin = #715#92;
     |FINSI;

     #544#20  = #300#1;

     |SI #300#2 = 3;   #544#21 = "1T";  |FINSI;
     |SI #300#2 = 6;   #544#21 = "2T";  |FINSI;
     |SI #300#2 = 9;   #544#21 = "3T";  |FINSI;
     |SI #300#2 = 12;  #544#21 = "4T";  |FINSI;

     enNume = #300#6;   |HAZ Conver13;   #544#22 = eaAlfa;
     enNume = #300#7 * 100;              #544#23 = ("0000" + enNume) % -104;
     enNume = #300#8;   |HAZ Conver13;   #544#24 = eaAlfa;

     enNume = #300#9;   |HAZ Conver13;   #544#25 = eaAlfa;
     enNume = #300#10 * 100;             #544#26 = ("0000" + enNume) % -104;
     enNume = #300#11;  |HAZ Conver13;   #544#27 = eaAlfa;

     enNume = #300#12;  |HAZ Conver13;   #544#28 = eaAlfa;
     enNume = #300#13 * 100;             #544#29 = ("0000" + enNume) % -104;
     enNume = #300#14;  |HAZ Conver13;   #544#30 = eaAlfa;

     enNume = #300#15;  |HAZ Conver13;   #544#31 = eaAlfa;
     enNume = #300#16 * 100;             #544#32 = ("0000" + enNume) % -103;
     enNume = #300#17;  |HAZ Conver13;   #544#33 = eaAlfa;

     enNume = #300#18;  |HAZ Conver13;   #544#34 = eaAlfa;
     enNume = #300#19 * 100;             #544#35 = ("0000" + enNume) % -103;
     enNume = #300#20;  |HAZ Conver13;   #544#36 = eaAlfa;

     enNume = #300#21;  |HAZ Conver13;   #544#37 = eaAlfa;
     enNume = #300#22 * 100;             #544#38 = ("0000" + enNume) % -103;
     enNume = #300#23;  |HAZ Conver13;   #544#39 = eaAlfa;

     enNume = #300#24 + #300#27 + #300#30;  |HAZ Conver13;
                                  #544#40 = eaAlfa;
     enNume = #300#26 + #300#29 + #300#32;  |HAZ Conver13;
                                  #544#41 = eaAlfa;

     enNume = #300#33;  |HAZ Conver13;  #544#42 = eaAlfa;
     enNume = #300#39;  |HAZ Conver13;  #544#43 = eaAlfa;
     enNume = #300#45;  |HAZ Conver13;  #544#44 = eaAlfa;
     enNume = #300#51;  |HAZ Conver13;  #544#45 = eaAlfa;
     enNume = #300#53;  |HAZ Conver13;  #544#46 = eaAlfa;
     enNume = #300#54;  |HAZ Conver13;  #544#47 = eaAlfa;
     enNume = #300#55;  |HAZ Conver13;  #544#48 = eaAlfa;
     enNume = #300#56;  |HAZ Conver13;  #544#49 = eaAlfa;
     nNume  = #300#57 * 100;            #544#50 = ("00000" + nNume) % -105;
     enNume = #300#58;  |HAZ Conver13;  #544#51 = eaAlfa;
     enNume = #300#59;  |HAZ Conver13;  #544#52 = eaAlfa;
     enNume = #300#60;  |HAZ Conver13;  #544#53 = eaAlfa;
     enNume = #300#61;  |HAZ Conver13;  #544#54 = eaAlfa;
     enNume = #300#62;  |HAZ Conver13;  #544#55 = eaAlfa;
     enNume = #300#63;  |HAZ Conver13;  #544#56 = eaAlfa;
     enNume = #300#64;  |HAZ Conver13;  #544#57 = eaAlfa;
     enNume = #300#65;  |HAZ Conver13;  #544#64 = eaAlfa;

     |HAZ TDeclaracion300;

     eaAlfa = #0#7;  |HAZ FechaBonito;
     #544#75 = eaDiaB;
     #544#76 = eaMesB;
     #544#77 = eaAnyoB;
     #544#78 = &13 + &10;

     |SI nTecla = 1;
         #544#7  = "";
         #544#69 = "";
         #544#70 = "";
         #544#71 = "";
         #544#72 = "";
         #544#73 = "";
         #544#74 = "";
         nTCampo = 78;
     |FINSI;

     |SI nTecla = 3;
         || Esto es porque dicen que en internet no lo quiere a
         || cero.

         |SI #544#23 = "0000";  #544#23 = "    ";  |FINSI;
         |SI #544#26 = "0000";  #544#26 = "    ";  |FINSI;
         |SI #544#29 = "0000";  #544#29 = "    ";  |FINSI;
         |SI #544#32 = "000";   #544#32 = "   ";   |FINSI;
         |SI #544#35 = "000";   #544#35 = "   ";   |FINSI;
         |SI #544#38 = "000";   #544#38 = "   ";   |FINSI;

         #544#2  = "";
         #544#3  = "";
         #544#5  = "";
         #544#8  = "";
         #544#9  = "";
         #544#10 = "";
         #544#11 = "";
         #544#12 = "";
         #544#13 = "";
         #544#14 = "";
         #544#15 = "";
         #544#16 = "";
         #544#17 = "";
         #544#18 = "";
         #544#19 = "";
         #544#75 = "";
         #544#76 = "";
         #544#77 = "";
         #544#78 = "";
         nTCampo = 77;
     |FINSI;

     |SI nTecla = 1;  |O nTecla = 3;
         aAlfa = "";
         |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
               nGraba = 0;
               |SI #300#2 = 12;  |Y #300#1 = 2007;  |Y nCampo = 63;  |Y nTecla = 3;
                   nGraba = 1;
               |FINSI;

               |SI nGraba = 0;
                   aAlfa = #544nCampo;
                   |XGRABA nHandle2, aAlfa;
               |FINSI;
         |SIGUE;
         |XCIERRA nHandle2;

         |SI nTecla = 1;
             eaFOrigen  = eaPathEmision + "300" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza + "300" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             |HAZ CargaImprime300;
         |FINSI;

         enImpReal  = #300#56;  ||Casilla 28
         enCas21    = #300#33;
         enCas27    = #300#55;
         enCas31    = #300#59;
         enCas34    = #300#62;
         enIngresar = #300#65;
         enDevolver = #300#64;
         enCompensar= #300#63;

         |SI nTecla = 3;
             eaFOrigen  = eaPathEmision + "300" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathInternet + "300" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             |HAZ GrabaImpreso;
         |FINSI;
     |SINO;
         |PRINT;
         |PIEINF;
     |FINSI;
|FPRC;

|PROCESO TDeclaracion300_2008;
     |SI #300#64 ! 0;
         enModelo = 300;  enForzar = 1;  |HAZ CogeDatosBancos;

         #574#51 = eaEntidad;
         #574#52 = eaOficina;
         #574#53 = eaDC;
         #574#54 = eaCuenta;
     |FINSI;

     |SI #300#65 ! 0;
         enModelo = 300;  enForzar = 0;  |HAZ CogeDatosBancos;

                                 aAlfa  = "0";
         |SI eaFormaPago = "1";  aAlfa  = "1";  |FINSI;
         |SI eaFormaPago = "2";  aAlfa  = "2";  |FINSI;
         |SI eaFormaPago = "3";  aAlfa  = "3";  |FINSI;
         |SI eaFormaPago = "4";  aAlfa  = "4";  |FINSI;
         |SI eaFormaPago = "5";  aAlfa  = "5";  |FINSI;

         #574#55 = aAlfa;
         #574#57 = eaEntidad;
         #574#58 = eaOficina;
         #574#59 = eaDC;
         #574#60 = eaCuenta;
     |FINSI;

     #574#4  = "";
     |SI nTecla ! 3;
         |SI #300#33 = 0;  |Y #300#55 = 0;  |Y #300#62 = 0;
             #574#4 = "N";
         |FINSI;

         |SI #300#63 = 0;
             |SI nTecla = 1; |Y #574#55 ! "1"; |Y #574#55 ! "0";
                  #574#55 = "2";
             |FINSI;
         |FINSI;
     |SINO;
         |SI #300#63 ! 0;  #574#4 = "C";  |FINSI;
         |SI #300#64 ! 0;  #574#4 = "D";  |FINSI;
         |SI #300#65 ! 0;
                                     #574#4 = "I";
             |SI eaFormaPago = "3";  #574#4 = "U";  |FINSI;
             |SI eaFormaPago = "4";  #574#4 = "A";  |FINSI;
             |SI eaFormaPago = "5";  #574#4 = "E";  |FINSI;
         |FINSI;

         |SI #300#33 = 0;  |Y #300#55 = 0;  |Y #300#62 = 0; |Y #300#59 = 0;
             #574#4 = "N";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Carga300_2008;
     |SI nTecla = 1;  |O nTecla = 3;
         aAbre = eaPathEmision + "300" + (("00000" + #999#0) % -105) + ".TXT";
         |XABRE "BW", aAbre, nHandle2;
     |FINSI;

     |ABRE #300;
     #300#0 = #4#0;
     #300#1 = #4#1;
     #300#2 = #4#2;
     #300#3 = #4#3;
     #300#4 = #4#4;
     #300#5 = 0;
     |LEE 040#300=;
     |SI FSalida ! 0;  |CIERRA #300;  |ACABA;  |FINSI;
     |CIERRA #300;

     enCodCli = #300#0;
     |HAZ LeePersona;

     |DDEFECTO #574;

     #574#1  = "300";
     #574#2  = "01";
     #574#3  = "";

     |SI enSwDeDonde = 1;
         #574#5   = (("00" + #715#15) % -102) + (("000" + #715#16) % -103);
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #574#6  = eaVarDni;
         eaAlfa   = #715#57; |HAZ QuitaRaros;     #574#7  = eaAlfa;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = aAlfa1;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #574#8 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #574#9 = eaAlfa;
         |SINO;
             eaAlfa = #715#1;  |HAZ QuitaRaros;  #574#8  = eaAlfa;
             #574#9  = ".";
         |FINSI;

         eaAlfa  = #715#53;  |HAZ QuitaRaros;      #574#63 = eaAlfa;
         eaAlfa  = #715#54;  |HAZ QuitaRarosTfno;  #574#64 = eaAlfa;
         eaAlfa  = #715#37;  |HAZ QuitaRaros;      #574#69 = eaAlfa;

         eaDeleg = #715#17;
         eaAdmin = #715#18;
     |SINO;
         #574#5   = (("00" + #715#63) % -102) + (("000" + #715#64) % -103);
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #574#6   = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;      #574#8   = eaAlfa;
         #574#9   = ".";

         eaAlfa   = #715#1;   |HAZ QuitaRaros;      #574#63 = eaAlfa;
         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;  #574#64 = eaAlfa;
         eaAlfa   = #715#11;  |HAZ QuitaRaros;      #574#69 = eaAlfa;

         eaDeleg  = #715#91;
         eaAdmin  = #715#92;
     |FINSI;

     #574#10  = #300#1;

     |SI #300#2 = 3;   #574#11 = "1T";  |FINSI;
     |SI #300#2 = 6;   #574#11 = "2T";  |FINSI;
     |SI #300#2 = 9;   #574#11 = "3T";  |FINSI;
     |SI #300#2 = 12;  #574#11 = "4T";  |FINSI;

     enNume = #300#6;   |HAZ Conver13;   #574#12 = eaAlfa;
     enNume = #300#7 * 100;              #574#13 = ("0000" + enNume) % -104;
     enNume = #300#8;   |HAZ Conver13;   #574#14 = eaAlfa;

     enNume = #300#9;   |HAZ Conver13;   #574#15 = eaAlfa;
     enNume = #300#10 * 100;             #574#16 = ("0000" + enNume) % -104;
     enNume = #300#11;  |HAZ Conver13;   #574#17 = eaAlfa;

     enNume = #300#12;  |HAZ Conver13;   #574#18 = eaAlfa;
     enNume = #300#13 * 100;             #574#19 = ("0000" + enNume) % -104;
     enNume = #300#14;  |HAZ Conver13;   #574#20 = eaAlfa;

     enNume = #300#15;  |HAZ Conver13;   #574#21 = eaAlfa;
     enNume = #300#16 * 100;             #574#22 = ("0000" + enNume) % -103;
     enNume = #300#17;  |HAZ Conver13;   #574#23 = eaAlfa;

     enNume = #300#18;  |HAZ Conver13;   #574#24 = eaAlfa;
     enNume = #300#19 * 100;             #574#25 = ("0000" + enNume) % -103;
     enNume = #300#20;  |HAZ Conver13;   #574#26 = eaAlfa;

     enNume = #300#21;  |HAZ Conver13;   #574#27 = eaAlfa;
     enNume = #300#22 * 100;             #574#28 = ("0000" + enNume) % -103;
     enNume = #300#23;  |HAZ Conver13;   #574#29 = eaAlfa;

     enNume = #300#24 + #300#27 + #300#30;  |HAZ Conver13;
                                  #574#30 = eaAlfa;
     enNume = #300#26 + #300#29 + #300#32;  |HAZ Conver13;
                                  #574#31 = eaAlfa;

     enNume = #300#33;  |HAZ Conver13;  #574#32 = eaAlfa;
     enNume = #300#39;  |HAZ Conver13;  #574#33 = eaAlfa;
     enNume = #300#45;  |HAZ Conver13;  #574#34 = eaAlfa;
     enNume = #300#51;  |HAZ Conver13;  #574#35 = eaAlfa;
     enNume = #300#53;  |HAZ Conver13;  #574#36 = eaAlfa;
     enNume = #300#54;  |HAZ Conver13;  #574#37 = eaAlfa;
     enNume = #300#68;  |HAZ Conver13;  #574#38 = eaAlfa;
     enNume = #300#55;  |HAZ Conver13;  #574#39 = eaAlfa;
     enNume = #300#56;  |HAZ Conver13;  #574#40 = eaAlfa;
     nNume  = #300#57 * 100;            #574#41 = ("00000" + nNume) % -105;
     enNume = #300#58;  |HAZ Conver13;  #574#42 = eaAlfa;
     enNume = #300#59;  |HAZ Conver13;  #574#43 = eaAlfa;
     enNume = #300#60;  |HAZ Conver13;  #574#44 = eaAlfa;
     enNume = #300#61;  |HAZ Conver13;  #574#45 = eaAlfa;
     enNume = #300#69;  |HAZ Conver13;  #574#46 = eaAlfa;
     enNume = #300#70;  |HAZ Conver13;  #574#47 = eaAlfa;
     enNume = #300#62;  |HAZ Conver13;  #574#48 = eaAlfa;
     enNume = #300#63;  |HAZ Conver13;  #574#49 = eaAlfa;
     enNume = #300#64;  |HAZ Conver13;  #574#50 = eaAlfa;
     enNume = #300#65;  |HAZ Conver13;  #574#56 = eaAlfa;

     |HAZ TDeclaracion300_2008;

     |SI #300#4 > 0;
         #574#61 = #4#20;
         #574#62 = #4#21;
     |FINSI;

     eaAlfa  = #0#7;  |HAZ FechaBonito;

     #574#70 = eaDiaB;
     #574#71 = eaMesB;
     #574#72 = eaAnyoB;
     #574#73 = &13 + &10;

     |SI nTecla = 1;
         #574#7  = "";
         #574#61 = "";
         #574#63 = "";
         #574#64 = "";
         #574#65 = "";
         #574#66 = "";
         #574#67 = "";
         #574#68 = "";
         nTCampo = 73;
     |FINSI;

     |SI nTecla = 3;
         || Esto es porque dicen que en internet no lo quiere a
         || cero.

         |SI #574#13 = "0000";  #574#13 = "    ";  |FINSI;
         |SI #574#16 = "0000";  #574#16 = "    ";  |FINSI;
         |SI #574#19 = "0000";  #574#19 = "    ";  |FINSI;
         |SI #574#22 = "000";   #574#22 = "   ";   |FINSI;
         |SI #574#25 = "000";   #574#25 = "   ";   |FINSI;
         |SI #574#28 = "000";   #574#28 = "   ";   |FINSI;

         #574#2  = "";
         #574#3  = "";
         #574#5  = "";
         #574#8  = "";
         #574#9  = "";
         #574#69 = "";
         #574#70 = "";
         #574#71 = "";
         #574#72 = "";
         #574#73 = "";
         nTCampo = 72;
     |FINSI;

     |SI nTecla = 1;  |O nTecla = 3;
         aAlfa = "";
         |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #574nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         |XCIERRA nHandle2;

         |SI nTecla = 1;
             eaFOrigen  = eaPathEmision + "300" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza + "300" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             |HAZ CargaImprime300;
         |FINSI;

         enImpReal  = #300#56;  ||Casilla 28
         enCas21    = #300#33;
         enCas27    = #300#55;
         enCas31    = #300#59;
         enCas34    = #300#62;
         enIngresar = #300#65;
         enDevolver = #300#64;
         enCompensar= #300#63;

         |SI nTecla = 3;
             eaFOrigen  = eaPathEmision + "300" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathInternet + "300" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             |HAZ GrabaImpreso;
         |FINSI;
     |SINO;
         |PRINT;
         |PIEINF;
     |FINSI;
|FPRC;

|PROCESO QueHacemos300;
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |SI #999#5 = 300;
         |SI #0#6 [ 2001;
             |SI nTecla ! 3;
                 |HAZ Registro300_2001;
             |SINO;
                 |HAZ Internet300_2001;
             |FINSI;

             |ACABA;
         |FINSI;

         |SI #0#6 [ 2007;
             |HAZ Carga300_2002;
         |FINSI;

         |SI #0#6 ] 2008;
             |HAZ Carga300_2008;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmow014C300;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos300;
|FIN;

|DEFBUCLE dsmow014N300;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos300;
|FIN;

|PROCESO AbreImprime300;
     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "CD " + eaPathLanza + &13 + &10;    |XGRABA nHandle1, aAlfa;

     aAlfa    = #0#6;
     aAlfa    = aAlfa % -102;
     aVersion = "";

     |SI #0#6 ] 2008;
         aVersion = "01";
         |SI #0#6 = 2008;
             |SI #0#4 ] 4;
                 aVersion = "02";
             |FINSI;
         |FINSI;
     |FINSI;

     |SI aVersion = "";
         aAlfa = "ZLS" + aAlfa + "MPF.EXE -y" + &13 + &10;
     |SINO;
         aAlfa = "Z" + aAlfa + aVersion + "MPF.EXE -y" + &13 + &10;
     |FINSI;
     |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO EmiteEsto300_2001;
     aAlfa = "DEL die*.*" + &13 + &10;  |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.exe"  + &13 + &10;  |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.tab"  + &13 + &10;  |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.imp"  + &13 + &10;  |XGRABA nHandle1, aAlfa;
     |XCIERRA nHandle1;

     |HAZ Copiampf;

     aAlfa = eaPathLanza + "IMPRIME";
     |RSYSTEM aAlfa;

     eaFichError = "err";
     eaFichDatos = #0#0;
     eaFichAuxil = "";

     |HAZ BuscaErroresL;
|FPRC;

|PROCESO EmiteEsto300_2002;
     aAlfa = "DEL *.wmf" + &13 + &10;             |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.tab"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.dll"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errorm~1.txt" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errormipf.txt"  + &13 + &10;    |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errmipf.txt"  + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.exe"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     |XCIERRA nHandle1;

     |HAZ Copiampf;

     aAlfa = eaPathLanza + "IMPRIME";
     |RSYSTEM aAlfa;

     eaFichError = "err";
     eaFichDatos = #0#0;
     eaFichAuxil = "";

     |HAZ BuscaErroresL;
|FPRC;

|PROCESO Boton3001;
     |PTEC 824;
|FPRC;

|PROCESO Boton3002;
     |PTEC 825;
|FPRC;

|PROCESO Boton3003;
     |PTEC 826;
|FPRC;

|PROCESO Boton3004;
     |PTEC 827;
|FPRC;

|PROCESO Boton3005;
     |PTEC 806;
|FPRC;

|PROCESO Botones300;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision Papel Oficial Laser          ", 0513, 0754, Boton3001;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Emision Papel Oficial Continuo       ", 0913, 1154, Boton3002;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Presentacion Telematica              ", 1313, 1554, Boton3003;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Informe de Comprobacion              ", 1713, 1954, Boton3004;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton3005;
     nBoton5 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTecla = 1;   |SAL;  |FINSI;
         |SI aTecla = aF3;  nTecla = 2;   |SAL;  |FINSI;
         |SI aTecla = aF4;  nTecla = 3;   |SAL;  |FINSI;
         |SI aTecla = aF5;  nTecla = 4;   |SAL;  |FINSI;
         |SI aTecla = aF6;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;

     |PULSATECLA;
|FPRC;

|PROGRAMA;
     aFichero = ("000" + Usuario) % 108;
     |NOME_DAT #0 aFichero;

     aFichero = ("imp" + Usuario) % 108;
     |NOME_DAT #999 aFichero;

     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     |ABRE #0;
     |LEE 000#0p;
     |CIERRA #0;

     enSwTrata      = 0;
     enCambiaMoneda = 1;

     |SI eaParametro ! "300C";
         |HAZ Botones300;
     |SINO;
         nTecla = 4;
     |FINSI;

     |SI nTecla = 0;  |ACABA;  |FINSI;

     |SI nTecla = 1;

         |HAZ CompruebaEjecutable;
         |SI enError = 1;  |ACABA;  |FINSI;

         |SI #0#6 [ 2001;
             |PARA;  |SI;  |HACIENDO;
                  |DDEFECTO #600;
                  |PINPA #0#600;
                  |PINDA #0#600;
                  |ENDATOS #1#600;
                  |SI FSalida = 0;
                      |HAZ AbreImprime300;
                      |SAL;
                  |FINSI;
             |SIGUE;
         |SINO;
             |PARA;  |SI;  |HACIENDO;
                  |DDEFECTO #601;

                  #601#0 = #107#5;
                  #601#1 = #107#7;

                  |C_M #601#0, 1, "S";
                  |C_M #601#1, 1, "S";
                  |SI #107#6 = "N";  |C_M #601#0, 1, "N";  |FINSI;
                  |SI #107#8 = "N";  |C_M #601#1, 1, "N";  |FINSI;

                  nPedirPanta = 0;
                  |SI #107#6 = "N";  |Y #107#8 = "N";  |Y #107#7 = "N";
                      nPedirPanta = 1;
                  |FINSI;

                  FSalida = 0;
                  |SI nPedirPanta = 0;
                      |PINPA #0#601;
                      |PINDA #0#601;
                      |ENDATOS #1#601;
                  |FINSI;

                  |SI FSalida = 0;
                      |HAZ AbreImprime300;
                      |SAL;
                  |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;

     |SI nTecla = 2;
         |MENAV "     Opcion no instalada";
         |ACABA;
     |FINSI;

     |SI nTecla = 4;
         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |SI #0#6 [ 2001;                   |INFOR "m300co01";  |FINSI;
         |SI #0#6 ] 2002;  |Y #0#6 [ 2007;  |INFOR "m300co02";  |FINSI;
         |SI #0#6 ] 2008;                   |INFOR "m300co04";  |FINSI;

         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     nSwLee = 0;
     |SI #0#8 = "C";
         |BUCLE dsmow014C300;
     |SINO;
         |BUCLE dsmow014N300;
     |FINSI;

     |SI nTecla = 1;
         |SI #0#6 [ 2001;
             |HAZ EmiteEsto300_2001;
         |FINSI;

         |SI #0#6 ] 2002;
             |HAZ EmiteEsto300_2002;
         |FINSI;
     |FINSI;

     |SI nTecla = 3;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;

     |SI nTecla = 4;
         |FININF;
         |FINIMP;
     |FINSI;
|FPRO;
