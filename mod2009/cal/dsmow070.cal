|FICHEROS;
     dsmoc349 #349;
     dsmod349 #350;

     dsmow070 #970,MANTE;
|FIN;

|VARIABLES;
     nContenido     = 0;
     nCampo1        = 0;
     nCampo2        = 0;
     nCampo3        = 0;
     nCampo11       = 0;
     nCampo22       = 0;
     nCampo33       = 0;
     nSwAcum        = 0;
     nAntIVA        = 0;
     nPon           = 0;
     &EURODB        = 2;
     aD             = "";
     aH             = "";
     nDPeriodo      = 0;
     nHPeriodo      = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO TotalIva;
     nContenido = Contenido;
     |SI nContenido = #970Campo;  |ACABA;  |FINSI;

     |SI Campo = 0;   nCampo1 = 0;   nCampo2 = 1;   nCampo3 = 2;   |FINSI;
     |SI Campo = 3;   nCampo1 = 3;   nCampo2 = 4;   nCampo3 = 5;   |FINSI;
     |SI Campo = 6;   nCampo1 = 6;   nCampo2 = 7;   nCampo3 = 8;   |FINSI;
     |SI Campo = 9;   nCampo1 = 9;   nCampo2 = 10;  nCampo3 = 11;  |FINSI;
     |SI Campo = 12;  nCampo1 = 12;  nCampo2 = 13;  nCampo3 = 14;  |FINSI;
     |SI Campo = 15;  nCampo1 = 15;  nCampo2 = 16;  nCampo3 = 17;  |FINSI;
     |SI Campo = 18;  nCampo1 = 18;  nCampo2 = 19;  nCampo3 = 20;  |FINSI;

     |SI Campo = 1;   nCampo1 = 0;   nCampo2 = 1;   nCampo3 = 2;   |FINSI;
     |SI Campo = 4;   nCampo1 = 3;   nCampo2 = 4;   nCampo3 = 5;   |FINSI;
     |SI Campo = 7;   nCampo1 = 6;   nCampo2 = 7;   nCampo3 = 8;   |FINSI;
     |SI Campo = 10;  nCampo1 = 9;   nCampo2 = 10;  nCampo3 = 11;  |FINSI;
     |SI Campo = 13;  nCampo1 = 12;  nCampo2 = 13;  nCampo3 = 14;  |FINSI;
     |SI Campo = 16;  nCampo1 = 15;  nCampo2 = 16;  nCampo3 = 17;  |FINSI;
     |SI Campo = 19;  nCampo1 = 18;  nCampo2 = 19;  nCampo3 = 20;  |FINSI;

     #970nCampo3 = #970nCampo1 % #970nCampo2;
     |PINTA #970nCampo3;
|FPRC;

|PROCESO Totales;
     #970#21 = #970#2  + #970#5 + #970#8 + #970#11 + #970#14 + #970#17 + #970#20;
     #970#23 = #970#21 - #970#22;

     |PINTA #970#21;
     |PINTA #970#23;
|FPRC;


|PROCESO PonIvas;
     nSwAcum = 0;
     |PARA nCampo2 = 1;  |SI nCampo2 [ 7;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #970nCampo2 = #349nCampo22;
               |SI #349#6 = "A ";
                   #970nCampo1 = #970nCampo1 + #349nCampo11;
                   #970nCampo3 = #970nCampo3 + #349nCampo33;
               |SINO;
                   |SI #349#24 = "-";
                       #970nCampo1 = #970nCampo1 - (#349nCampo11 - #349#27);
                       #970nCampo3 = #970nCampo3 - (#349nCampo33 - nAntIVA);
                   |SINO;
                       #970nCampo1 = #970nCampo1 + (#349nCampo11 - #349#27);
                       #970nCampo3 = #970nCampo3 + (#349nCampo33 - nAntIVA);
                   |FINSI;
               |FINSI;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 1;  |ACABA;  |FINSI;

     |PARA nCampo2 = 1;  |SI nCampo2 [ 7;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #970nCampo2 = 0;
               |SI #349#6 = "A ";
                   #970nCampo1 = #970nCampo1 + #349nCampo11;
                   #970nCampo2 = #349nCampo22;
                   #970nCampo3 = #970nCampo3 + #349nCampo33;
               |SINO;
                   |SI #349#24 = "-";
                       #970nCampo1 = #970nCampo1 - (#349nCampo11 - #349#27);
                       #970nCampo2 = #349nCampo22;
                       #970nCampo3 = #970nCampo3 - (#349nCampo33 - nAntIVA);
                   |SINO;
                       #970nCampo1 = #970nCampo1 + (#349nCampo11 - #349#27);
                       #970nCampo2 = #349nCampo22;
                       #970nCampo3 = #970nCampo3 + (#349nCampo33 - nAntIVA);
                   |FINSI;
               |FINSI;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 1;  |ACABA;  |FINSI;
|FPRC;


|PROCESO Calcu349;

     |SI #349#6 = "A ";
         |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo11 ! 0;  |O #349nCampo33 ! 0;
                   |HAZ PonIvas;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI #349#6 = "AR";
         nPon = 0;
         |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo11 ! 0;  |O #349nCampo33 ! 0;
                   nAntIVA = (#349#27 * #349nCampo22 / 100) ! EURODB;
                   |HAZ PonIvas;
                   nPon = 1;
               |FINSI;
         |SIGUE;

         |SI nPon = 0;  |Y #349#27 ! 0;
             nCampo22 = 11;
             nCampo11 = nCampo22 - 1;
             nCampo33 = nCampo22 + 1;
             nAntIVA  = 0;
             |HAZ PonIvas;
         |FINSI;

     |FINSI;

|FPRC;

|DEFBUCLE dsmoc349A;
     #349#1;
     ;
     enEmpresa, enEjer, nDPeriodo, 349, enDComple, enActividad, "A ", 0000, 0, aD;
     enEmpresa, enEjer, nHPeriodo, 349, enHComple, enActividad, "Az", 9999, 9, aH;
     ;
     NULL, Calcu349;
|FIN;

|PROCESO dsmod349;
     |SI #350#4 ! 0;
         |SI #350#12 = "C";
             enHComple = #350#4;
         |SINO;
             enDComple = #350#4;
             enHComple = #350#4;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmod349;
    #350#1;
    ;
    enEmpresa, enEjer, enPeriodo, 349, 00, 00;
    enEmpresa, enEjer, enPeriodo, 349, 99, 00;
    ;
    NULL, dsmod349;
|FIN;

|PROCESO Que349;
     enDComple = 0;
     enHComple = 0;
     |BUCLE dsmod349;

     eaTipo349     = "A";
     eaComunidad   = "N";
     eaComunero    = "N";
     enTipoEntrada = 1;
     enModelo349   = 309;
     |SUB_EJECUTA_NP "dsmoc349";
     eaTipo349     = "";

     #970#0 = 0; #970#1 = 0;
     #970#2 = 0; #970#3 = 0;
     #970#4 = 0; #970#5 = 0;
     #970#6 = 0; #970#7 = 0;
     #970#8 = 0;

     aD = "            ";
     aH = "zzzzzzzzzzzz";
     |SI enPeriodo = 99;
         nDPeriodo = 01;
         nHPeriodo = 12;
     |SINO;
         |SI enPeriodo = 3;    nDPeriodo = 1;   nHPeriodo = 3;   |FINSI;
         |SI enPeriodo = 6;    nDPeriodo = 4;   nHPeriodo = 6;   |FINSI;
         |SI enPeriodo = 9;    nDPeriodo = 7;   nHPeriodo = 9;   |FINSI;
         |SI enPeriodo = 12;   nDPeriodo = 10;  nHPeriodo = 12;  |FINSI;
     |FINSI;

     |BUCLE dsmoc349A;

     |HAZ Totales;
     |PINDA #0#970;
|FPRC;

|PROCESO Tipo12w70;  |TIPO 12;
|FPRC;
