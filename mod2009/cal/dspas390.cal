|FICHEROS;
     dsmozpas #0;
     dsmom002 #2;
     dsmom004 #4;
     dsmom008 #8;
     dsmom016 #16;
     dsmom017 #17;
     dsmom019 #19;
     dsmom030 #30;
     dsmom033 #33;

     dsmom047 #47;
     dsmom080 #80;
     dsmom081 #81;
     dsmom082 #82;
     dsmom083 #83;

     dsmod300 #301;
     dsmod330 #330;
     dsmod370 #370;
     dsmod310 #310;
     dsmoc311 #311;

     dsm39001 #390;
     dsm39002 #490;
     dsm39003 #590;
     dsm39004 #690;
     dsmociva #300;
     dsmocivp #165;

     :/contagen/def/canempre #101;
     :/contagen/def/camaniva #102;
     :/contagen/def/caivalin #103;
     :/contagen/def/caivaasi #104;

     :/basica/def/agicen14 #214;

     &regisnif@ #709;
     dsmow013 #999,MANTE;
|FIN;

|VARIABLES;
     aAlfa1       = "";
     nSwHay300    = 0;
     nSwHay310    = 0;
     nCampo1      = 0;
     nCampo2      = 0;
     nCampo3      = 0;
     nCampo4      = 0;
     nCampo5      = 0;
     nCampo6      = 0;
     nCampo11     = 0;
     nCampo22     = 0;
     nCampo33     = 0;
     nSwAcum      = 0;
     nAtri        = 0;
     nContAtri    = 0;
     nError       = 0;
     nLinea       = 0;
     nPeriodo     = 0;
     nCampo       = 0;
     nCodigo      = 0;
     nCultivo     = 0;
     nDepar       = 0;
     nDPeriodo    = 0;
     nHPeriodo    = 0;
     nEjer        = 0;
     nUni1        = 0;
     nUni2        = 0;
     nUni3        = 0;
     nUni4        = 0;
     nUni5        = 0;
     nUni6        = 0;
     nUni7        = 0;
     nUni8        = 0;
     nUni9        = 0;
     nFactor      = 0;
     nTotal       = 0;
     nNume        = 0;
     nResta       = 0;
     nT300C       = 0;
     nT300C1      = 0;
     nT300C2      = 0;
     nT300C3      = 0;
     nT300C4      = 0;
     nT300C5      = 0;
     nT300C6      = 0;
     nT300C7      = 0;
     nT300C8      = 0;
     nT300C9      = 0;
     nPasa        = 0;

     aAlfa        = "";
     nBaseMas     = 0;
     nCuotaMas    = 0;
     nLaPro       = 0;
     nProrraDif   = 0;
     nPro         = 0;
     nSwP0 = 0; nSwP1 = 0; nSwP2 = 0; nSwP3 = 0;
     nSwP4 = 0; nSwP5 = 0; nSwP6 = 0; nSwP7 = 0;
     nM = 0;

     aCNAE   = "";
     nSwEsta = 0;
     nPara1  = 0;
     nQuants = 0;
     nPrim   = 0;
     nT7     = 0;
     nT9     = 0;
     nSwLimpio = 0;
     nErrorSinImporte = 0;
     aSubde   = "";

|FIN;

|INCLUYE i_variar;

|PROCESO GrabaIVA;
     nLaPro    = nProrrata;
     nProrrata = 100;

     |SI #300#6 = 2;  |Y #300#7 ! 8; |Y #300#7 ! 11;
         |SI enEjer ] enEjerPro;
             nProrrata = nLaPro;
         |SINO;
              |SI #300#3 = 300;
                   |ABRE #301;
                   #301#0 = #300#0;
                   #301#1 = #300#1;
                   #301#2 = #300#2;
                   #301#3 = #300#3;
                   #301#4 = #300#4;
                   #301#5 = 0;
                   |LEE 040#301=;
                   |SI FSalida ! 0;  |DDEFECTO #301;  |FINSI;
                   |CIERRA #301;

                   nProrrata = #301#66;
              |FINSI;

              |SI #300#3 = 330;
                   |ABRE #330;
                   #330#0 = #300#0;
                   #330#1 = #300#1;
                   #330#2 = #300#2;
                   #330#3 = #300#3;
                   #330#4 = #300#4;
                   #330#5 = 0;
                   |LEE 040#330=;
                   |SI FSalida ! 0;  |DDEFECTO #330;  |FINSI;
                   |CIERRA #330;

                   nProrrata = #330#70;
              |FINSI;

              |SI #300#3 = 370;
                   |ABRE #370;
                   #370#0 = #300#0;
                   #370#1 = #300#1;
                   #370#2 = #300#2;
                   #370#3 = #300#3;
                   #370#4 = #300#4;
                   #370#5 = 0;
                   |LEE 040#370=;
                   |SI FSalida ! 0;  |DDEFECTO #370;  |FINSI;
                   |CIERRA #370;

                   nProrrata = #370#87;
              |FINSI;

         |FINSI;
     |FINSI;

     |SI #300#6 = 2;  |Y #300#7 = 5;   nProrrata = 100;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 6;   nProrrata = 100;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 ] 11;  nProrrata = 100;  |FINSI;

     |SI #300nCampo2 = 0;
         |SI #300nCampo1 ! 0;  |O #300nCampo3 ! 0;
             #490#21 = #490#21 + #300nCampo1;
             #490#22 = -1;
             #490#23 = #490#23 + ((#300nCampo3 % nProrrata) ! 2) + #165nCampo5;
             nProrraDif = nProrrata;
             nProrrata  = nLaPro;
             |ACABA;
         |FINSI;
     |FINSI;

     nSwAcum = 0;
     |PARA nCampo11  = 12;  |SI nCampo11 [ 21;  |HACIENDO nCampo11 = nCampo11 + 3;
           nCampo22 = nCampo11 + 1;
           nCampo33 = nCampo11 + 2;

           |SI #490nCampo22 = #300nCampo2;
               #490nCampo11 = #490nCampo11 + #300nCampo1;
               #490nCampo33 = #490nCampo33 + ((#300nCampo3 % nProrrata) ! 2) + #165nCampo5;
               nSwAcum = 1;
               |SAL;
            |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo11  = 12;  |SI nCampo11 [ 21;  |HACIENDO nCampo11 = nCampo11 + 3;
               nCampo22 = nCampo11 + 1;
               nCampo33 = nCampo11 + 2;
               |SI #490nCampo22 = 0;
                   #490nCampo11 = #300nCampo1;
                   #490nCampo22 = #300nCampo2;
                   #490nCampo33 = ((#300nCampo3 % nProrrata) ! 2) + #165nCampo5;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         #490#21 = #490#21 + #300nCampo1;
         #490#22 = -1;
         #490#23 = #490#23 + ((#300nCampo3 % nProrrata) ! 2) + #165nCampo5;
     |FINSI;

     nProrraDif = nProrrata;
     nProrrata  = nLaPro;
|FPRC;

|PROCESO LeeRestoPror;
  |DDEFECTO #165;
  nBaseMas = 0;
  nCuotaMas = 0;

  |DDEFECTO #165;
  |SI #300#6 = 2;

      |SI #300#7 ! 5; |Y #300#7 ! 6;
          |ABRE #165;
          |DDEFECTO #165;
          #165#0 = #300#0;
          #165#1 = #300#1;
          #165#2 = #300#2;
          #165#3 = #300#3;
          #165#4 = #300#4;
          #165#5 = #300#5;
          #165#6 = #300#6;
          #165#7 = #300#7;
          |LEE 001#165=;
          |SI FSalida = 0;
              nBaseMas  = #165#10 + #165#13 + #165#16 + #165#19;
              nCuotaMas = #165#12 + #165#15 + #165#18 + #165#21;
          |FINSI;
          |CIERRA #165;
      |FINSI;

      |SI enEjer ] enEjerPro;
          nCuotaMas = 0;
          |SI eaDesg109 = "S";
              |SI #300#7 = 1; |Y nSwP1 = 0; nCuotaMas = - enImpProrrat1; nSwP1 = 1; |FINSI;
              |SI #300#7 = 2; |Y nSwP2 = 0; nCuotaMas = - enImpProrrat2; nSwP2 = 1; |FINSI;
              |SI #300#7 = 3; |Y nSwP3 = 0; nCuotaMas = - enImpProrrat3; nSwP3 = 1; |FINSI;
              |SI #300#7 = 4; |Y nSwP4 = 0; nCuotaMas = - enImpProrrat4; nSwP4 = 1; |FINSI;
              |SI #300#7 = 5; |Y nSwP5 = 0; nCuotaMas = - enImpProrrat5; nSwP5 = 1; |FINSI;
              |SI #300#7 = 6; |Y nSwP6 = 0; nCuotaMas = - enImpProrrat6; nSwP6 = 1; |FINSI;
              |SI #300#7 = 7; |Y nSwP7 = 0; nCuotaMas = - enImpProrrat7; nSwP7 = 1; |FINSI;
          |SINO;
              |SI #300#7 = 1; |Y nSwP0 = 0; nCuotaMas = - enImpProrrata; nSwP0 = 1; |FINSI;
          |FINSI;
          #165#9  = 0;
          #165#12 = nCuotaMas;
          |SI nCuotaMas ! 0;
              #165#9 = nCuotaMas;
          |FINSI;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO LeeEl47;
     |ABRE #47;
     #47#0 = enEmpresa;
     #47#1 = enEjer;
     #47#2 = nPeriodo;
     #47#3 = nM;
     #47#4 = 0;
     #47#5 = 0;
     |LEE 040#47=;
     |SI FSalida ! 0;
         |DDEFECTO #47;
         |CIERRA #47;
         |ACABA;
     |FINSI;
     |CIERRA #47;
     enImpProrrat1 = enImpProrrat1 + #47#6;
     enImpProrrat2 = enImpProrrat2 + #47#7;
     enImpProrrat3 = enImpProrrat3 + #47#8;
     enImpProrrat4 = enImpProrrat4 + #47#9;
     enImpProrrat5 = enImpProrrat5 + #47#10;
     enImpProrrat6 = enImpProrrat6 + #47#11;
     enImpProrrat7 = enImpProrrat7 + #47#12;
     enImpProrrata = enImpProrrata + (#47#6 + #47#7 + #47#8 + #47#9 + #47#10 + #47#11 + #47#12);
|FPRC;

|PROCESO Graba390_2;
     |SI #300#6 = 2;  |Y #300#7 = 10;  |Y #390#1 ] 2008;
         |SI #300#12 ! 0;  |O #300#13 ! 0;
             |SI #300#16 = 0;  |Y #300#19 = 0;  |Y #300#22 = 0;  |Y #300#25 = 0;
                 #300#12 = 0;
                 #300#13 = 0;
                 |GRABA 020#300a;
                 |LIBERA #300;
                 |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #300#6 = 2;  |Y #300#7 = 11;  |Y #390#1 ] 2008;
         |ACABA;
     |FINSI;

     |SI #300#6 = 2;  |Y #300#7 = 12;  |Y #390#1 ] 2008;
         |ACABA;
     |FINSI;

     |HAZ LeeRestoPror;

     |SI #300#12 ! 0;  |O #300#13 ! 0; |O nCuotaMas ! 0;
         #490#0 = #390#0;
         #490#1 = #390#1;
         #490#2 = #390#2;
         #490#3 = #390#3;
         #490#4 = #300#6;
         #490#5 = #300#7;
         |LEE 101#490=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |SI #490#4 = 5;  |Y #490#5 = 1;
             nAtri     = nAtri     + #490#10;
             nContAtri = nContAtri + 1;
             #490#10   = nAtri / nContAtri;
             |SI #490#10 ! 100;
                 #390#55 = #490#10;
             |FINSI;
         |SINO;
              |PARA nCampo1 = 14;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
                   nCampo2 = nCampo1 + 1;
                   nCampo3 = nCampo1 + 2;
                   nCampo4 = nCampo1 - 4;
                   nCampo5 = nCampo3 - 4;
                   |SI #300nCampo1 ! 0;  |O #300nCampo2 ! 0;  |O #300nCampo3 ! 0;
                       |O #165nCampo5 ! 0;
                       |HAZ GrabaIVA;
                   |FINSI;
             |SIGUE;


             |SI #300#6 = 2;  |Y #300#7 ! 10;  |Y #300#7 ! 11; |Y #300#7 ! 12;
                 |SI #300#13 ! 0; |Y #300#12 = 0; |Y #300#7 < 8;
                     nErrorSinImporte = 1;
                 |FINSI;
                 |SI #300#6 = 2;  |Y #300#7 = 1;
                     nT300C1 = nT300C1 + (((#300#13 % nProrraDif) ! 2) + #165#9) ! 2;
                 |FINSI;

                 |SI #300#6 = 2;  |Y #300#7 = 2;
                     nT300C2 = nT300C2 + (((#300#13 % nProrraDif) ! 2) + #165#9) ! 2;
                 |FINSI;

                 |SI #300#6 = 2;  |Y #300#7 = 3;
                     nT300C3 = nT300C3 + (((#300#13 % nProrraDif) ! 2) + #165#9) ! 2;
                 |FINSI;

                 |SI #300#6 = 2;  |Y #300#7 = 4;
                     nT300C4 = nT300C4 + (((#300#13 % nProrraDif) ! 2) + #165#9) ! 2;
                 |FINSI;

                 |SI #300#6 = 2;  |Y #300#7 = 5;
                     nT300C5 = nT300C5 + (((#300#13 % nProrraDif) ! 2) + #165#9) ! 2;
                 |FINSI;

                 |SI #300#6 = 2;  |Y #300#7 = 6;
                     nT300C6 = nT300C6 + (((#300#13 % nProrraDif) ! 2) + #165#9) ! 2;
                 |FINSI;

                 |SI #300#6 = 2;  |Y #300#7 = 7;
                     nT300C7 = nT300C7 + (((#300#13 % nProrraDif) ! 2) + #165#9) ! 2;
                 |FINSI;

                 |SI #300#6 = 2;  |Y #300#7 = 8;
                     nT300C8 = nT300C8 + (((#300#13 % nProrraDif) ! 2) + #165#9) ! 2;
                 |FINSI;

                 |SI #300#6 = 2;  |Y #300#7 = 9;
                     nT300C9 = nT300C9 + (((#300#13 % nProrraDif) ! 2) + #165#9) ! 2;
                 |FINSI;

                 #490#11 = #490#14 + #490#17 + #490#20 + #490#23;

                 nT300C  = 0;

                 |SI #300#7 = 1;   nT300C = nT300C1;   |FINSI;
                 |SI #300#7 = 2;   nT300C = nT300C2;   |FINSI;
                 |SI #300#7 = 3;   nT300C = nT300C3;   |FINSI;
                 |SI #300#7 = 4;   nT300C = nT300C4;   |FINSI;
                 |SI #300#7 = 5;   nT300C = nT300C5;   |FINSI;
                 |SI #300#7 = 6;   nT300C = nT300C6;   |FINSI;
                 |SI #300#7 = 7;   nT300C = nT300C7;   |FINSI;
                 |SI #300#7 = 8;   nT300C = nT300C8;   |FINSI;
                 |SI #300#7 = 9;   nT300C = nT300C9;   |FINSI;

                 nResta = nT300C - #490#11;
                 |SI nResta ! 0;
                     |PARA nCampo11  = 14;  |SI nCampo11 [ 23;  |HACIENDO nCampo11 = nCampo11 + 3;
                           |SI #490nCampo11 ! 0;
                               #490nCampo11 = #490nCampo11 + nResta;
                               |SAL;
                           |FINSI;
                     |SIGUE;
                 |FINSI;
             |FINSI;

             |PARA nCampo1 = 13;  |SI nCampo1 [ 22;  |HACIENDO nCampo1 = nCampo1 + 3;
                   |SI #490nCampo1 = -1;  #490nCampo1 = 0;  |FINSI;
             |SIGUE;

             |SI #490#12 ! 0;  |O #490#15 ! 0;  |O #490#18 ! 0;  |O #490#21 ! 0;
                 #490#10 = #490#12 + #490#15 + #490#18 + #490#21;
                 #490#11 = #490#14 + #490#17 + #490#20 + #490#23;
             |SINO;
                 #490#10 = #490#10 + #300#12;
                 #490#11 = #490#11 + #300#13;
             |FINSI;
         |FINSI;

         |GRABA 020#490a;
         |LIBERA #490;

         nSwHay300 = 1;
     |FINSI;
     |LIBERA #300;
|FPRC;

|DEFBUCLE dsmociva;
     #300#1;
     ;
     #4#0, #4#1, #4#2, #4#3, 00, 01, 0,  0;
     #4#0, #4#1, #4#2, #4#3, 99, 99, 9, 99;
     be;
     NULL, Graba390_2;
|FIN;

|PROCESO BorraVarDed;
     nT300C    = 0;
     nT300C1   = 0;
     nT300C2   = 0;
     nT300C3   = 0;
     nT300C4   = 0;
     nT300C5   = 0;
     nT300C6   = 0;
     nT300C7   = 0;
     nT300C8   = 0;
     nT300C9   = 0;
|FPRC;

|PROCESO Graba390_3;
     #17#0 = #19#0;
     #17#1 = #19#1;
     #17#2 = #19#2;
     #17#3 = #19#3;
     |LEE 040#17=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #16#0  = #17#4;
     #16#1  = #17#5;
     #16#41 = #17#6;
     #16#2  = #17#1;
     |LEE 040#16=;
     |SI FSalida ! 0;  |DDEFECTO #16;  |FINSI;

     |ABRE #2;
     #2#0 = #19#0; || Empresa
     #2#1 = #19#3; || Actividad
     #2#2 = 310;
     |LEE 040#2=;
     |SI FSalida ! 0;
         |CIERRA #2;
         |ACABA;
     |FINSI;
     |CIERRA #2;
     |SI #2#8 > "01.01.1900";
         aAlfa = #2#8; aAlfa = aAlfa % -104; nNume = aAlfa;
         |SI nNume > #19#1; |ACABA; |FINSI;
     |FINSI;
     |SI #2#9 > "01.01.1900";
         aAlfa = #2#9; aAlfa = aAlfa % -104; nNume = aAlfa;
         |SI nNume < #19#1; |ACABA; |FINSI;
     |FINSI;

     |PARA nPeriodo = 3; |SI nPeriodo [ 12;  |HACIENDO nPeriodo = nPeriodo + 3;
           nError = 0;
           #4#0   = #390#0;
           #4#1   = #390#1;
           #4#2   = nPeriodo;
           #4#3   = 310;
           #4#4   = 0;
           |LEE 040#4=;
           |SI FSalida = 0;
               |SI #4#7 = "X";  |Y #4#9 = " ";  |Y enSwCheq390 = 0;
                   nError = 1;
               |FINSI;
           |SINO;
               nError = 2;
           |FINSI;

           |SI nError > 0;
               #4#0   = #390#0;
               #4#1   = #390#1;
               #4#2   = nPeriodo;
               #4#3   = 370;
               #4#4   = 0;
               |LEE 040#4=;
               |SI FSalida = 0;
                   |SI #4#7 = "X";  |Y #4#9 = " ";  |Y enSwCheq390 = 0;
                       nError = 1;
                   |SINO;
                       nError  = 0;
                   |FINSI;
               |SINO;
                   |SI nError = 2; nError = 0;  |FINSI;
              |FINSI;
           |FINSI;

           |SI nError = 1;
               aAlfa = "    Modelos sin Imprimir, Empresa = " + #4#0 + ", Pase Abortado";
               |MENAV aAlfa;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     nLinea = nLinea + 1;
     #590#0 = #390#0;
     #590#1 = #390#1;
     #590#2 = #390#2;
     #590#3 = #390#3;
     #590#4 = nLinea;
     #590#5 = #17#5;

     nUni1    = #19#48;
     nTotal   = #19#15 * #19#48;
     |SI nTotal ! #19#59;  nUni1 = #19#59 / #19#15;  |FINSI;

     nUni2   = #19#49;
     nTotal  = #19#16 * #19#49;
     |SI nTotal ! #19#60;  nUni2 = #19#60 / #19#16;  |FINSI;

     nUni3   = #19#50;
     nTotal  = #19#17 * #19#50;
     |SI nTotal ! #19#61;  nUni3 = #19#61 / #19#17;  |FINSI;

     nUni4   = #19#51;
     nTotal  = #19#18 * #19#51;
     |SI nTotal ! #19#62;  nUni4 = #19#62 / #19#18;  |FINSI;

     nUni5   = #19#52;
     nTotal  = #19#19 * #19#52;
     |SI nTotal ! #19#63;  nUni5 = #19#63 / #19#19;  |FINSI;

     nUni6   = #19#53;
     nTotal  = #19#20 * #19#53;
     |SI nTotal ! #19#64;  nUni6 = #19#64 / #19#20;  |FINSI;

     nUni7   = #19#54;
     nTotal  = #19#21 * #19#54;
     |SI nTotal ! #19#65;  nUni7 = #19#65 / #19#21;  |FINSI;

     nUni8   = #19#55;
     nTotal  = #19#22 * #19#55;
     |SI nTotal ! #19#66;  nUni8 = #19#66 / #19#22;  |FINSI;

     nUni9   = #19#56;
     nTotal  = #19#23 * #19#56;
     |SI nTotal ! #19#67;  nUni9 = #19#67 / #19#23;  |FINSI;

     |SI #19#132 ! 0;
         |PARA nCampo = 4;  |SI nCampo [ 11;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #19nCampo;  |QBF aAlfa;
               |SI aAlfa = "";
                   |SI nCampo = 4;
                       nUni1  = #19#124 + #19#126 + #19#128 + #19#130;
                       #19#59 = #19#132;
                   |FINSI;
                   |SI nCampo = 5;
                       nUni2  = #19#124 + #19#126 + #19#128 + #19#130;
                       #19#60 = #19#132;
                   |FINSI;
                   |SI nCampo = 6;
                       nUni3  = #19#124 + #19#126 + #19#128 + #19#130;
                       #19#61 = #19#132;
                   |FINSI;
                   |SI nCampo = 7;
                       nUni4  = #19#124 + #19#126 + #19#128 + #19#130;
                       #19#62 = #19#132;
                   |FINSI;
                   |SI nCampo = 8;
                       nUni5  = #19#124 + #19#126 + #19#128 + #19#130;
                       #19#63 = #19#132;
                   |FINSI;
                   |SI nCampo = 9;
                       nUni6  = #19#124 + #19#126 + #19#128 + #19#130;
                       #19#64 = #19#132;
                   |FINSI;
                   |SI nCampo = 10;
                       nUni7  = #19#124 + #19#126 + #19#128 + #19#130;
                       #19#65 = #19#132;
                   |FINSI;
                   |SI nCampo = 11;
                       nUni8  = #19#124 + #19#126 + #19#128 + #19#130;
                       #19#66 = #19#132;
                   |FINSI;

                   |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;

     |PARA nCampo = 4;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 4;
           nNume = #16nCampo;
           |SI nNume = 3;  |O nNume = 28;  |O nNume = 10;
               nFactor = 100;
               |SI nNume = 10;  nFactor = 1000;  |FINSI;

               |SI nCampo = 4;   nUni1 = nUni1 / nFactor;  |FINSI;
               |SI nCampo = 8;   nUni2 = nUni2 / nFactor;  |FINSI;
               |SI nCampo = 12;  nUni3 = nUni3 / nFactor;  |FINSI;
               |SI nCampo = 16;  nUni4 = nUni4 / nFactor;  |FINSI;
               |SI nCampo = 20;  nUni5 = nUni5 / nFactor;  |FINSI;
               |SI nCampo = 24;  nUni6 = nUni6 / nFactor;  |FINSI;
               |SI nCampo = 28;  nUni7 = nUni7 / nFactor;  |FINSI;
               |SI nCampo = 32;  nUni8 = nUni8 / nFactor;  |FINSI;
               |SI nCampo = 36;  nUni9 = nUni9 / nFactor;  |FINSI;
           |FINSI;
     |SIGUE;

     |SI #590#5 = "6441"; |O #590#5 = "6442"; |O #590#5 = "6443"; |O #590#5 = "6446";
         #590#6  = nUni1 + nUni2 + nUni3;
         #590#7  = #19#59 + #19#60 + #19#61;

         #590#8  = nUni4 + nUni5 + nUni6;
         #590#9  = #19#62 + #19#63 + #19#64;

         #590#10 = nUni7;
         #590#11 = #19#65;

         #590#12 = nUni8;
         #590#13 = #19#66;

         #590#14 = nUni9;
         #590#15 = #19#67;
     |SINO;
         #590#6  = nUni1 + nUni2;
         #590#7  = #19#59 + #19#60

         #590#8  = nUni3;
         #590#9  = #19#61;

         #590#10 = nUni4;
         #590#11 = #19#62;

         #590#12 = nUni5;
         #590#13 = #19#63;

         #590#14 = nUni6;
         #590#15 = #19#64;

         #590#16 = nUni7;
         #590#17 = #19#65;

         #590#18 = nUni8;
         #590#19 = #19#66;
     |FINSI;

     #590#20 = #19#118;
     #590#21 = #19#135;
     #590#22 = #19#120;
     #590#23 = #19#136;

     #590#24 = 0;
     |SI #590#6  ! 0;  |O #590#8  ! 0;  |O #590#10 ! 0;
     |O  #590#12 ! 0;  |O #590#14 ! 0;  |O #590#16 ! 0;  |O #590#18 ! 0;
         #590#24 = #19#122;
     |FINSI;

     #590#25 = #19#147;
     #590#26 = #19#137;
     #590#27 = #19#138;
     |GRABA 020#590n;
     |LIBERA #590;

     nSwHay310 = 1;
|FPRC;

|DEFBUCLE dsmom019;
     #19#1;
     ;
     #390#0, #390#1, 00, 00;
     #390#0, #390#1, 99, 99;
     ;
     NULL, Graba390_3;
|FIN;

|PROCESO Errores;
     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enModelo      = #999#7;
     enComplem     = #4#4;
     enTipoEntrada = 3;
     enMensa       = 1;
     |SUB_EJECUTA_NP "dsm39001";

     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = #999#9;
     |LEE 101#4=;
     |SI FSalida = 0;
         #4#7  = " ";
         #4#8  = ~;
         #4#15 = 0;
         #4#17 = "SIN DATOS";

         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO Grupo3_390;
     |SI #30#30 ! 1;   |ACABA;  |FINSI;

     #33#0 = aSubde;
     |LEE 001#33=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |SI #33#6   = 0;  |ACABA;  |FINSI;

     #390nCampo2 = #390nCampo2 + ((#103#6 / enConversor) ! EURODBMOD);
     #390nCampo3 = #33#6;
     #390nCampo4 = #390nCampo2 * #33#6;
     nPasa       = 1;
|FPRC;

|PROCESO Grupo4_390;
     |SI #30#32 = 2;
         #390nCampo5 = #390nCampo5 + ((#103#8 / enConversor) ! EURODBMOD);
         nPasa       = 1;
     |FINSI;
|FPRC;

|PROCESO LeeLineaGanadera;
     aAlfa1 = #103#30; |QBF aAlfa1;
     |SI aAlfa1 = "";
         #103#30 = #102#10;
         aAlfa1 = #103#31; |QBF aAlfa1; |SI aAlfa1 = ""; #103#31 = #102#11; |FINSI;
     |FINSI;
     |SI aMulDep = "S";
         aSubde = #103#31;
         nDepar = #103#30;
         |SI nDepar = 0;  nDepar = 1;   |FINSI;

         |ABRE #214;
         #214#0 = #999#0;
         #214#1 = nDepar;
         |LEE 040#214=;
         |SI FSalida ! 0;  nDepar = 1;  |FINSI;
         |CIERRA #214;

         |SI #214#9 ! 6;  |Y #214#9 ! 7; |Y #214#9 ! 11; |Y #214#9 ! 12;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI aSubde  = "   ";  |ACABA;  |FINSI;
     |SI #103#5  = "N";    |ACABA;  |FINSI;

     #30#0 = #103#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #30#4 = "N";  |ACABA;  |FINSI;

     nCodigo  = 0;
     nCultivo = aSubde;

     |SI nCultivo = 11;   nCodigo = 8;  |FINSI;
     |SI nCultivo = 12;   nCodigo = 9;  |FINSI;
     |SI nCultivo = 38;   nCodigo = 4;  |FINSI;
     |SI nCultivo = 39;   nCodigo = 4;  |FINSI;
     |SI nCultivo = 72;   nCodigo = 1;  |FINSI;
     |SI nCultivo = 73;   nCodigo = 1;  |FINSI;
     |SI nCultivo = 74;   nCodigo = 3;  |FINSI;
     |SI nCultivo = 76;   nCodigo = 4;  |FINSI;
     |SI nCultivo = 77;   nCodigo = 4;  |FINSI;
     |SI nCultivo = 78;   nCodigo = 8;  |FINSI;
     |SI nCultivo = 79;   nCodigo = 8;  |FINSI;
     |SI nCultivo = 80;   nCodigo = 1;  |FINSI;
     |SI nCultivo = 81;   nCodigo = 1;  |FINSI;
     |SI nCultivo = 116;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 117;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 120;  nCodigo = 1;  |FINSI;
     |SI nCultivo = 121;  nCodigo = 1;  |FINSI;
     |SI nCultivo = 122;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 123;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 124;  nCodigo = 3;  |FINSI;
     |SI nCultivo = 125;  nCodigo = 3;  |FINSI;
     |SI nCultivo = 130;  nCodigo = 8;  |FINSI;
     |SI nCultivo = 131;  nCodigo = 8;  |FINSI;
     |SI nCultivo = 186;  nCodigo = 2;  |FINSI;
     |SI nCultivo = 193;  nCodigo = 2;  |FINSI;
     |SI nCultivo = 194;  nCodigo = 14; |FINSI;
     |SI nCultivo = 195;  nCodigo = 2;  |FINSI;
     |SI nCultivo = 196;  nCodigo = 14; |FINSI;
     |SI nCultivo = 197;  nCodigo = 2;  |FINSI;
     |SI nCultivo = 198;  nCodigo = 14; |FINSI;
     |SI nCultivo = 326;  nCodigo = 8;  |FINSI;
     |SI nCultivo = 327;  nCodigo = 8;  |FINSI;

     |SI nCodigo  = 0;  |ACABA;  |FINSI;

     nCampo1 = 0;
     |PARA nCampo = 14;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 6;
           |SI #390nCampo = nCodigo;
               nCampo1 = nCampo;
               |SAL;
           |FINSI;
           |SI #390nCampo = 0;
               nCampo1 = nCampo;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nCampo1 = 0;  |ACABA;  |FINSI;

     nCampo2 = nCampo1 + 1;
     nCampo3 = nCampo1 + 2;
     nCampo4 = nCampo1 + 3;
     nCampo5 = nCampo1 + 4;
     nCampo6 = nCampo1 + 5;

     #390nCampo1 = nCodigo;

     |SI #30#30 ! 0; |HAZ Grupo3_390;  |FINSI;
     |SI #30#32 ! 0; |HAZ Grupo4_390;  |FINSI;
|FPRC;

|DEFBUCLE caivalin390;
     #103#1;
     ;
     #102#0, #102#1, 01;
     #102#0, #102#1, 99;
     ;
     NULL, LeeLineaGanadera;
|FIN;

|PROCESO LeeGanadera;
     nDepar = #102#10;
     aSubde = #102#11;
     |SI aMulDep ! "S";
         |SI nDepar = 0;  nDepar = 1;   |FINSI;

         |ABRE #214;
         #214#0 = #999#0;
         #214#1 = nDepar;
         |LEE 040#214=;
         |SI FSalida ! 0;  nDepar = 1;  |FINSI;
         |CIERRA #214;

         |SI #214#9 ! 6;  |Y #214#9 ! 7; |Y #214#9 ! 11; |Y #214#9 ! 12;
             |LIBERA #102;
             |ACABA;
         |FINSI;
     |FINSI;

     |BUCLE caivalin390;
     |LIBERA #102;
|FPRC;

|DEFBUCLE camaniva390;
     #102#1;
     5;
     00, 0000000000, nDPeriodo;
     99, 9999999999, nHPeriodo;
     be;
     NULL, LeeGanadera;
|FIN;

|PROCESO AcumulaAgricultura;
     nCultivo = #311#6;

     |SI nCultivo = 11;   nCodigo = 8;  |FINSI;
     |SI nCultivo = 12;   nCodigo = 9;  |FINSI;
     |SI nCultivo = 38;   nCodigo = 4;  |FINSI;
     |SI nCultivo = 39;   nCodigo = 4;  |FINSI;
     |SI nCultivo = 72;   nCodigo = 1;  |FINSI;
     |SI nCultivo = 73;   nCodigo = 1;  |FINSI;
     |SI nCultivo = 74;   nCodigo = 3;  |FINSI;
     |SI nCultivo = 76;   nCodigo = 4;  |FINSI;
     |SI nCultivo = 77;   nCodigo = 4;  |FINSI;
     |SI nCultivo = 78;   nCodigo = 8;  |FINSI;
     |SI nCultivo = 79;   nCodigo = 8;  |FINSI;
     |SI nCultivo = 80;   nCodigo = 1;  |FINSI;
     |SI nCultivo = 81;   nCodigo = 1;  |FINSI;
     |SI nCultivo = 116;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 117;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 120;  nCodigo = 1;  |FINSI;
     |SI nCultivo = 121;  nCodigo = 1;  |FINSI;
     |SI nCultivo = 122;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 123;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 124;  nCodigo = 3;  |FINSI;
     |SI nCultivo = 125;  nCodigo = 3;  |FINSI;
     |SI nCultivo = 130;  nCodigo = 8;  |FINSI;
     |SI nCultivo = 131;  nCodigo = 8;  |FINSI;
     |SI nCultivo = 186;  nCodigo = 2;  |FINSI;
     |SI nCultivo = 193;  nCodigo = 2;  |FINSI;
     |SI nCultivo = 194;  nCodigo = 14; |FINSI;
     |SI nCultivo = 195;  nCodigo = 2;  |FINSI;
     |SI nCultivo = 196;  nCodigo = 14; |FINSI;
     |SI nCultivo = 197;  nCodigo = 2;  |FINSI;
     |SI nCultivo = 198;  nCodigo = 14; |FINSI;
     |SI nCultivo = 326;  nCodigo = 8;  |FINSI;
     |SI nCultivo = 327;  nCodigo = 8;  |FINSI;
     |SI nCodigo  = 0;    nCodigo = 1;  |FINSI;

     nCampo1 = 0;
     |PARA nCampo = 14;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 6;
           |SI #390nCampo = nCodigo;
               nCampo1 = nCampo;
               |SAL;
           |FINSI;
           |SI #390nCampo = 0;
               nCampo1 = nCampo;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nCampo1 = 0;  |ACABA;  |FINSI;

     nCampo2 = nCampo1 + 1;
     nCampo3 = nCampo1 + 2;
     nCampo4 = nCampo1 + 3;
     nCampo5 = nCampo1 + 4;
     nCampo6 = nCampo1 + 5;

     #390nCampo1 = nCodigo;
     #390nCampo2 = #390nCampo2 + #311#8;
     #390nCampo3 = #311#9;
     #390nCampo4 = #390nCampo2 * #390nCampo3;
     #390nCampo5 = #390nCampo5 + #311#11;
     #390nCampo6 = #390nCampo4 - ((#390nCampo4 % 1) + #390nCampo5);

     nSwHay310 = 1;
|FPRC;

|DEFBUCLE dsmoc311;
     #311#1;
     ;
     #390#0, #390#1, 12, 310, 00, 00, 001;
     #390#0, #390#1, 12, 310, 99, 99, 999;
     ;
     NULL, AcumulaAgricultura;
|FIN;

|PROCESO PasaContabilidad;
     aAlfa = #390#1;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     enEmpresa   = #390#0;
     enEjer      = #390#1;
     enSwOpPar   = 0;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         aAlfa = #390#1;
         aAlfa = aAlfa % -102;
         nEjer = aAlfa;

         |ABRE #101;
         |SELECT #4#101;
         #101#2  = #390#0;
         #101#26 = nEjer;
         |LEE 040#101=;
         |SI FSalida ! 0;  |CIERRA #101;  |ACABA;   |FINSI;
         |CIERRA #101;

         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";

         enEmpresa  = #101#2;
         enPerConta = #101#3;
         eaLaMonEmp = #101#28;
     |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
     |FINSI;
     |HAZ EnConversor;

     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;

     |ABRE #104;
     |LEE 040#104p;
     |SI FSalida ! 0;  |DDEFECTO #104;  |FINSI;
     |CIERRA #104;
     aMulDep = #104#132;

     |SI #104#46 = "T";
          nDPeriodo = 1;  nHPeriodo = 4;
     |SINO;
          nDPeriodo = 1;  nHPeriodo = 12;
     |FINSI;

     |ABRE #30;
     |ABRE #33;

     |BUCLE camaniva390;

     |CIERRA #30;
     |CIERRA #33;

     |SI enSwPartido = 1;
         enSwOpPar   = 2;
         |HAZ FinalPartido;
     |FINSI;

     |PARA nCampo = 14;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 6;
           |SI #390nCampo ! 0;
               nCampo1 = nCampo;
               nCampo2 = nCampo + 1;
               nCampo3 = nCampo + 2;
               nCampo4 = nCampo + 3;
               nCampo5 = nCampo + 4;
               nCampo6 = nCampo + 5;

               #390nCampo4   = #390nCampo2 * #390nCampo3;
               #390nCampo6   = #390nCampo4 - ((#390nCampo4 % 1) + #390nCampo5);
               nSwHay310 = 1;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Saca300;
     #390#8  = #390#8 + #301#65;

     |SI #301#2 = 12;
         #390#10 = #390#10 + #301#63;
         #390#11 = #390#11 + #301#64;
     |FINSI;
|FPRC;

|DEFBUCLE dsmod300;
     #301#1;
     ;
     #4#0, #4#1, #4#2, #4#3, 00, 0;
     #4#0, #4#1, #4#2, #4#3, 99, 9;
     ;
     NULL, Saca300;
|FIN;

|PROCESO Saca330;
     #390#8  = #390#8 + #330#69;
     #390#9  = #390#9 + #330#68;

     |SI #330#2 = 12;
         #390#10 = #390#10 + #330#67;
         #390#11 = #390#11 + #330#68;

     |FINSI;
|FPRC;

|DEFBUCLE dsmod330;
     #330#1;
     ;
     #4#0, #4#1, #4#2, #4#3, 00, 0;
     #4#0, #4#1, #4#2, #4#3, 99, 9;
     ;
     NULL, Saca330;
|FIN;

|PROCESO Saca370;
     |ABRE #370;
     #370#0 = #4#0;
     #370#1 = #4#1;
     #370#2 = #4#2;
     #370#3 = #4#3;
     #370#4 = #4#4;
     #370#5 = 0;
     |LEE 040#370=;
     |SI FSalida ! 0;  |DDEFECTO #370;  |FINSI;
     |CIERRA #370;

     #390#46 = #390#46 + #370#72;
     #390#47 = #390#47 + #370#74;
     #390#48 = #390#48 + #370#73;
     #390#50 = #390#50 + #370#76;
     #390#51 = #390#51 + #370#77;

     #390#8  = #390#8 + #370#86;


     |SI #370#2 = 12;
         #390#10 = #390#10 + #370#84;
         #390#11 = #390#11 + #370#85;

     |FINSI;
|FPRC;

|DEFBUCLE dsmod370;
     #370#1;
     ;
     #4#0, #4#1, #4#2, #4#3, 00, 0;
     #4#0, #4#1, #4#2, #4#3, 99, 9;
     ;
     NULL, Saca370;
|FIN;


|PROCESO ControlaRegGeneral;
     |HAZ BorraVarDed;

     |ABRE #490;
     |PARA nPeriodo = 1; |SI nPeriodo [ 12;  |HACIENDO nPeriodo = nPeriodo + 1;
           |SI nPeriodo = 3;  |O nPeriodo = 6;  |O nPeriodo = 9;  |O nPeriodo = 12;
               nError = 0;
               nErrorSinImporte = 0;
               #4#0   = #390#0;
               #4#1   = #390#1;
               #4#2   = nPeriodo;
               #4#3   = 300;
               #4#4   = 0;
               |LEE 040#4=;
               |SI FSalida = 0;
                   |SI #4#7 = "X";  |Y #4#9 = " ";  |Y enSwCheq390 = 0;
                       nError = 1;
                   |SINO;
                       enPeriodo = nPeriodo;
                       |HAZ  eLeeLaPro390;
                       nPro = nProrrata; |SI enEjer ] enEjerPro; nProrrata = 100; |FINSI;
                       nSwP0 = 0; nSwP1 = 0; nSwP2 = 0; nSwP3 = 0;
                       nSwP4 = 0; nSwP5 = 0; nSwP6 = 0; nSwP7 = 0;
                       nM = 300; |HAZ LeeEl47;
                       |BUCLE dsmociva;
                       |BUCLE dsmod300;
                   |FINSI;
               |SINO;
                   nError = 2;
               |FINSI;

               |SI nError > 0;
                   #4#0   = #390#0;
                   #4#1   = #390#1;
                   #4#2   = nPeriodo;
                   #4#3   = 370;
                   #4#4   = 0;
                   |LEE 040#4=;
                   |SI FSalida = 0;
                       |SI #4#7 = "X";  |Y #4#9 = " ";  |Y enSwCheq390 = 0;
                           nError = 1;
                       |SINO;
                           nError  = 0;
                           enPeriodo = nPeriodo;
                           |HAZ  eLeeLaPro390;
                           nPro = nProrrata; |SI enEjer ] enEjerPro; nProrrata = 100; |FINSI;
                           nSwP0 = 0; nSwP1 = 0; nSwP2 = 0; nSwP3 = 0;
                           nSwP4 = 0; nSwP5 = 0; nSwP6 = 0; nSwP7 = 0;
                           nM = 370; |HAZ LeeEl47;
                           |BUCLE dsmociva;
                           |BUCLE dsmod370;
                       |FINSI;
                   |SINO;
                       |SI nError = 2; nError = 0;  |FINSI;
                   |FINSI;
               |FINSI;

               |SI nError = 1;
                   aAlfa = "    Modelos sin Imprimir, Empresa = " + #4#0 + ", Pase Abortado";
                   |MENAV aAlfa;
                   |SAL;
               |FINSI;
               |SI nErrorSinImporte = 1;
                   aAlfa = "    Atencion. Faltan bases de IVA Soportado en el Periodo = " + nPeriodo + " de la Empresa = " + #4#0;
                   |MENAV aAlfa;
               |FINSI;
           |FINSI;

           nError = 0;
           #4#0   = #390#0;
           #4#1   = #390#1;
           #4#2   = nPeriodo;
           #4#3   = 330;
           #4#4   = 0;
           |LEE 040#4=;
           |SI FSalida = 0;
               |SI #4#7 = "X";  |Y #4#9 = " ";  |Y enSwCheq390 = 0;
                   nError = 1;
               |SINO;
                   enPeriodo = nPeriodo;
                   |HAZ  eLeeLaPro390;
                   nPro = nProrrata; |SI enEjer ] enEjerPro; nProrrata = 100; |FINSI;
                   nSwP0 = 0; nSwP1 = 0; nSwP2 = 0; nSwP3 = 0;
                   nSwP4 = 0; nSwP5 = 0; nSwP6 = 0; nSwP7 = 0;
                   nM = 330; |HAZ LeeEl47;
                   |BUCLE dsmociva;
                   |BUCLE dsmod330;
               |FINSI;
           |FINSI;

           |SI nError = 1;
               aAlfa = "    Modelos sin Imprimir, Empresa = " + #4#0 + ", Pase Abortado";
               |MENAV aAlfa;
               |SAL;
           |FINSI;
     |SIGUE;
     |CIERRA #490;
|FPRC;

|PROCESO CargaDevengado;
     #4#0   = #310#0;
     #4#1   = #310#1;
     #4#2   = #310#2;
     #4#3   = 310;
     #4#4   = 0;
     |LEE 040#4=;
     |SI FSalida ! 0;
         |BORRA 020#310a;
         |LIBERA #310;

         |ACABA;
     |FINSI;

     #4#0   = #310#0;
     #4#1   = #310#1;
     #4#2   = #310#2;
     #4#3   = 310;
     #4#4   = #310#4 + 1;
     |LEE 040#4=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #390#46 = #390#46 + #310#27;
     #390#47 = #390#47 + #310#29;
     #390#48 = #390#48 + #310#28;
     #390#50 = #390#50 + #310#31;
     #390#51 = #390#51 + #310#32;

     #390#8  = #390#8 + #310#40 + #310#41;

     |SI #310#2 = 12;
         #390#10 = #390#10 + #310#38;
         #390#11 = #390#11 + #310#39;
     |FINSI;
     |LIBERA #310;
|FPRC;

|DEFBUCLE dsmod310;
     #310#1;
     ;
     #390#0, #390#1, 01, 310, 00, 00;
     #390#0, #390#1, 12, 310, 99, 00;
     be;
     NULL, CargaDevengado;
|FIN;

|PROCESO ControlaRegSimplificado;
     nSwHay310 = 0;
     nLinea    = 0;
     |ABRE #590;
     |ABRE #17;
     |ABRE #16;
     |ABRE #4;
     |BUCLE dsmom019;
     |CIERRA #16;
     |CIERRA #17;
     |CIERRA #590;
     |SI nError = 1; |ACABA;  |FINSI;

     nPasa = 0;
     |HAZ PasaContabilidad;  || Modelo Ganaderas

     |SI nPasa = 0;
         |BUCLE dsmoc311;
     |FINSI;

     |PARA nPeriodo = 3; |SI nPeriodo [ 12;  |HACIENDO nPeriodo = nPeriodo + 3;
           nError = 0;
           #4#0   = #390#0;
           #4#1   = #390#1;
           #4#2   = nPeriodo;
           #4#3   = 310;
           #4#4   = 0;
           |LEE 040#4=;
           |SI FSalida = 0;
               |SI #4#7 = "X";  |Y #4#9 = " ";  |Y enSwCheq390 = 0;
                   nError = 1;
               |FINSI;
           |SINO;
               nError = 2;
           |FINSI;

           |SI nError > 0;
               #4#0   = #390#0;
               #4#1   = #390#1;
               #4#2   = nPeriodo;
               #4#3   = 370;
               #4#4   = 0;
               |LEE 040#4=;
               |SI FSalida = 0;
                   |SI #4#7 = "X";  |Y #4#9 = " ";  |Y enSwCheq390 = 0;
                       nError = 1;
                   |SINO;
                       nError  = 0;
                   |FINSI;
               |SINO;
                   |SI nError = 2; nError = 0;  |FINSI;
              |FINSI;
           |FINSI;

           |SI nError = 1;
               nError = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nError = 1;
         aAlfa = "    Modelos sin Imprimir, Empresa = " + #4#0 + ", Pase Abortado";
         |MENAV aAlfa;
     |SINO;
         |BUCLE dsmod310;
     |FINSI;
     |CIERRA #4;
|FPRC;

|| ..........Todo Lineal de Prorratas

|PROCESO Resto690;
 |SI nSwLimpio = 0;
     |SI nPrim ! #690#4;
         nT9 = (nT9 - #690#7) ! EURODBMOD;
         nT7 = (nT7 - #690#8) ! EURODBMOD;
     |FINSI;
 |SINO;
     |SI #690#10 = 100;
         |BORRA 020#690a;
     |FINSI;
 |FINSI;
 |LIBERA #690;
|FPRC;

|DEFBUCLE Resto690;
 #690#1;
 ;
 enEmpresa, enEjer, #390#2, #390#3, 01;
 enEmpresa, enEjer, #390#2, #390#3, 98;
 be;
 NULL, Resto690;
|FIN;

|PROCESO GraboUna;

 |ABRE #690;
 |DDEFECTO #690;
 #690#0 = enEmpresa;
 #690#1 = enEjer;
 #690#2 = #390#2;
 #690#3 = #390#3;
 #690#4 = nPrim;
 |LEE 101#690=;
 |SI FSalida ! 0;
     |DDEFECTO #690;
     #690#0 = enEmpresa;
     #690#1 = enEjer;
     #690#2 = #390#2;
     #690#3 = #390#3;
     #690#4 = nPrim;
     |GRABA 020#690b;
 |FINSI;

 |SI aCNAE ! ""; |Y #690##6 = "     "; #690#6 = aCNAE; |FINSI;
 |SI nT9 ! #690#7; |O nT7 ! #690#8;
     #690#10 = #80#32;  || % prorrata
 |FINSI;
 #690#7  = nT9;     || Totales
 #690#8  = nT7;     || Con derecho a deducir

 |GRABA 020#690a;
 |CIERRA #690;
|FPRC;

|PROCESO ComprueboEsta;
  nSwEsta = 0;
  |PARA nPara1 = 63;  |SI nPara1 [ 83;  |HACIENDO nPara1 = nPara1 + 4;
        |SI #390nPara1 = #81#2;
            nSwEsta = 1;
            |SAL;
        |FINSI;
  |SIGUE;
|FPRC;

|PROCESO Leem081;

 |DDEFECTO #690;
 #690#0 = enEmpresa;
 #690#1 = enEjer;
 #690#2 = #390#2;
 #690#3 = #390#3;
 #690#4 = #81#2;
 |LEE 101#690=;
 |SI FSalida ! 0;
     |DDEFECTO #690;
     #690#0 = enEmpresa;
     #690#1 = enEjer;
     #690#2 = #390#2;
     #690#3 = #390#3;
     #690#4 = #81#2;
     #690#5 = #81#3;
     #690#6 = #81#4;
     |GRABA 020#690b;
 |FINSI;
 |SI aCNAE = ""; |Y #81#4 ! "     ";
     aCNAE = #81#4;
 |FINSI;
 |SI aCNAE ! ""; |Y #81#4 = "     ";
     #81#4 = aCNAE;
 |FINSI;

 #690#7  = #81#9;  || Totales
 #690#8  = #81#7;  || Con derecho a deducir
 #690#9  = #80#4;  || tipo prorrata
 #690#10 = #81#6;  || % prorrata

 |SI #81#2 = 0;
     |BORRA 020#690a;
     |LIBERA #690;
     |ACABA;
 |FINSI;

 |SI #81#2 = 99;
     |SI #690#7 = 0; |Y #690#8 = 0;
         |BORRA 020#690a;
     |SINO;
         |GRABA 020#690a;
     |FINSI;
     |LIBERA #690;
     |ACABA;
 |FINSI;

 |HAZ ComprueboEsta;
 |SI enAdTodas = 1;
     |SI nSwEsta = 0;
         |BORRA 020#690a;
         |LIBERA #690;
         |ACABA;
     |FINSI;
 |FINSI;

 |GRABA 020#690a;
 |LIBERA #690;

 nQuants = nQuants + 1;
 |SI nPrim = 0; nPrim = #81#2; |FINSI;
|FPRC;

|DEFBUCLE Leem081;
 #81#1;
 ;
 #80#0, #80#1, 00;
 #80#0, #80#1, 99;
 ;
 NULL, Leem081;
|FINSI;

|PROCESO CreaLinProrrata;
 aCNAE = "";
 |ABRE #80;
 #80#0 = enEmpresa;
 #80#1 = enEjer;
 |LEE 040#80=;
 |SI FSalida ! 0;
     |CIERRA #80;
     |ACABA;
 |FINSI;
 |CIERRA #80;
 |SI #80#4 = "N"; |ACABA; |FINSI;
 |SI #80#4 = "G"; |Y #80#5 = 100; |ACABA; |FINSI;

 nQuants = 0;
 nPrim   = 0;
 |ABRE #690;
 |BUCLE Leem081;
 |CIERRA #690;

 |SI #80#4 = "E"; |Y nQuants ! 0;
     nT7 = #80#6;
     nT9 = #80#8;
     |SI nQuants = 1;
         |HAZ GraboUna;
     |SINO;
         |BUCLE Resto690;
         |HAZ GraboUna;
     |FINSI;
     |SI enAdTodas = 1;
         nSwLimpio = 1;
         |BUCLE Resto690;
         nSwLimpio = 0;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO Pase390;
     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = #999#9;
     |LEE 040#4=;
     |SI FSalida ! 0;  |CIERRA #4; |ACABA;   |FINSI;
     |CIERRA #4;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enModelo      = #999#7;
     enComplem     = #4#4;
     enTipoEntrada = 3;
     enMensa       = 1;
     |SUB_EJECUTA_NP "dsm39001";

     enTipoEntrada = 95;
     |SUB_EJECUTA_NP "dsm39001";

     |ABRE #390;
     #390#0  = enEmpresa;
     #390#1  = enEjer;
     #390#2  = enModelo;
     #390#3  = enComplem;
     |LEE 101#390=;
     |SI FSalida ! 0;  |CIERRA #390;  |ACABA;  |FINSI;

     |ABRE #4;

     nError    = 0;
     nAtri     = 0;
     nContAtri = 0;


     |HAZ ControlaRegGeneral;
     |SI nError = 1;  |LIBERA #390; |HAZ Errores;  |ACABA;  |FINSI;

     |HAZ ControlaRegSimplificado;
     |SI nError = 1;  |LIBERA #390; |HAZ Errores;  |ACABA;  |FINSI;

     |SI nSwHay300 = 0;  |Y nSwHay310 = 0;
         |LIBERA #390;
         |CIERRA #390;
         |HAZ Errores;
         |MENAV "      Seleccion Vacia";
         |ACABA;
     |FINSI;

     |GRABA 020#390a;
     |LIBERA #390;
     |CIERRA #390;

     |HAZ CreaLinProrrata;

     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = #999#9;
     |LEE 040#4=;
     |SI FSalida ! 0;  |CIERRA #4; |ACABA;   |FINSI;
     |CIERRA #4;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enModelo      = #999#7;
     enComplem     = #4#4;
     enTipoEntrada = 95;
     enMensa       = 1;
     |SUB_EJECUTA_NP "dsm39001";

     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = #999#9;
     |LEE 101#4=;
     |SI FSalida = 0;
         #4#7  = "X";
         #4#8  = ~;
         #4#15 = 0;
         #4#17 = "COMPLETADO";

         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;
|FPRC;
