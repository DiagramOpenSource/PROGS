|FICHEROS;
     dsmod110 #0;
     dsm190li #190;
     dsmom037 #37;
     dsmod110@ #900;
     dsmom004 #4;
|FIN;

|VARIABLES;
     aBase      = "";
     aDef       = "";
     aAlfa      = "";

     &eaExtension = "";
     &eaPrograma  = "";
|FIN;

|INCLUYE i_variar;

|PROCESO Justificante;  |TIPO 7;
     |SI #0#30 = "             ";  |Y #0#4 ! 0;
         |ABRE #4;
         #4#0 = #0#0;
         #4#1 = #0#1;
         #4#2 = #0#2;
         #4#3 = #0#3;
         #4#4 = #0#4 - 1;
         |LEE 000#4=;
         |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
         |CIERRA #4;

         #0#30 = #4#19;  |PINTA #0#30;
     |FINSI;

     |C_M #0#30, 1, "N";
     |SI #0#4 ! 0;
         |C_M #0#30, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Totales;
     #0#27 = #0#8 + #0#11 + #0#14 + #0#17 + #0#20 + #0#23 + #0#26 + #0#33 + #0#36;
     #0#29 = #0#27 - #0#28;

     |PINTA #0#27;
     |PINTA #0#29;
|FPRC;

|PROCESO dsm190li;
     #37#0 = #190#8;
     #37#1 = #190#9;
     |LEE 040#37=;
     |SI FSalida ! 0;  |DDEFECTO #37;  |FINSI;

     |SI #37#3 = 0;  |ACABA;  |FINSI;

     |SI #37#3 = 1;
         |SI #190#16 ! 0;  |O #190#17 ! 0;
             #0#6 = #0#6 + 1;
             #0#7 = #0#7 + #190#16;
             #0#8 = #0#8 + #190#17;
         |FINSI;

         |SI #190#18 ! 0;  |O #190#19 ! 0;  |O #190#20 ! 0;
             #0#9  = #0#9 + 1;
             #0#10 = #0#10 + #190#18;
             #0#11 = #0#11 + #190#19 + #190#20;
         |FINSI;
     |FINSI;

     |SI #37#3 = 2;
         |SI #190#16 ! 0;  |O #190#17 ! 0;
             #0#12 = #0#12 + 1;
             #0#13 = #0#13 + #190#16;
             #0#14 = #0#14 + #190#17;
         |FINSI;

         |SI #190#18 ! 0;  |O #190#19 ! 0;  |O #190#20 ! 0;
             #0#15 = #0#15 + 1;
             #0#16 = #0#16 + #190#18;
             #0#17 = #0#17 + #190#19 + #190#20;
         |FINSI;
     |FINSI;

     |SI #37#3 = 3;
         |SI #190#16 ! 0;  |O #190#17 ! 0;
             #0#18 = #0#18 + 1;
             #0#19 = #0#19 + #190#16;
             #0#20 = #0#20 + #190#17;
         |FINSI;

         |SI #190#18 ! 0;  |O #190#19 ! 0;  |O #190#20 ! 0;
             #0#21 = #0#21 + 1;
             #0#22 = #0#22 + #190#18;
             #0#23 = #0#23 + #190#19 + #190#20;
         |FINSI;
     |FINSI;

     |SI #37#3 = 4;
         |SI #190#16 ! 0;  |O #190#17 ! 0;
          |O #190#18 ! 0;  |O #190#19 ! 0;  |O #190#20 ! 0;
             #0#24 = #0#24 + 1;
             #0#25 = #0#19 + #190#16 + #190#18;
             #0#26 = #0#20 + #190#17 + #190#19 + #190#20;
         |FINSI;
     |FINSI;

     |SI #37#3 = 5;
         |SI #190#16 ! 0;  |O #190#17 ! 0;
             #0#31 = #0#31 + 1;
             #0#32 = #0#32 + #190#16;
             #0#33 = #0#33 + #190#17;
         |FINSI;

         |SI #190#18 ! 0;  |O #190#19 ! 0;  |O #190#20 ! 0;
             #0#34 = #0#34 + 1;
             #0#35 = #0#35 + #190#18;
             #0#36 = #0#36 + #190#19 + #190#20;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsm190li;
     #190#1;
     ;
     #0#0, #0#1, 99, 190, 00, 0, "            ", 0000, " ", "  ", 0;
     #0#0, #0#1, 99, 190, 00, 0, "zzzzzzzzzzzz", 9999, "z", "zz", 9;
     ;
     NULL, dsm190li;
|FIN;

|PROCESO dsmod110;
     #0#7  = #0#7  - #900#7;
     #0#8  = #0#8  - #900#8;
     #0#10 = #0#10 - #900#10;
     #0#11 = #0#11 - #900#11;

     #0#13 = #0#13 - #900#13;
     #0#14 = #0#14 - #900#14;
     #0#16 = #0#16 - #900#16;
     #0#17 = #0#17 - #900#17;

     #0#19 = #0#19 - #900#19;
     #0#20 = #0#20 - #900#20;
     #0#22 = #0#22 - #900#22;
     #0#23 = #0#23 - #900#23;

     #0#25 = #0#25 - #900#25;
     #0#26 = #0#26 - #900#26;

     #0#32 = #0#32 - #900#32;
     #0#33 = #0#33 - #900#32;
     #0#35 = #0#35 - #900#32;
     #0#36 = #0#36 - #900#32;
|FPRC;

|DEFBUCLE dsmod110;
     #900#1006;
     ;
     #0#0, #0#1, 01, 110, 00, 00;
     #0#0, #0#1, 11, 110, 99, 99;
     ;
     NULL, dsmod110;
|FIN;

|PROCESO SacaPantallas110;
     enEntrada = 1;
     |PUSHV 0401 2380;

     |ABRE #0;
     #0#0 = enEmpresa;
     #0#1 = enEjer;
     #0#2 = enPeriodo;
     #0#3 = enModelo;
     #0#4 = enComplem;
     #0#5 = enActividad;
     |LEE 101#0=;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         |GRABA 020#0b;
     |FINSI;

     |SI enPeriodo = 12;
         |CONFI "0000NDesea Regularizacion de los Periodos Anteriores con el Modelo 190.";
         |SI FSalida = 0;
             |PDEFECTO #0, 6, 30;
             |ABRE #37;
             |BUCLE dsm190li;
             |CIERRA #37;

             |DBASE aBase;  |QBT aBase;
             aDef = aBase + "def/dsmod110.mas";
             |CARGA_DEF aDef, dsmod110@;
             |SI FSalida ! 0;
                 aAlfa = "     Error en cargar el Def dsmod110";
                 |MENAV aAlfa;
             |SINO;
                 |BUCLE dsmod110;
             |FINSI;
             |DESCARGA_DEF #dsmod110@;
         |FINSI;
     |FINSI;

     |PINPA #0#0;
     |PINDA #0#0;

     |ENDATOS #2#0;
     |SI FSalida = 0; |Y #0#29 ! 0;
         |GRABA 020#0a;
     |SINO;
        |CONFI "0000NEl Importe es igual a Cero, desea Impreso SIN Actividad ";
        |SI FSalida = 0;
            |GRABA 020#0a;
        |SINO;
            enEntrada = 0;
            |BORRA 020#0a;
        |FINSI;
     |FINSI;

     |LIBERA #0;
     |CIERRA #0;
     |POPV;
|FPRC;

|PROGRAMA;
     |ABRE #37;
     #37#0 = "L";
     #37#1 = "21";
     |LEE 000#37=;
     |SI FSalida ! 0;
         |MENAV "0000 Hay una nueva clave IRPF, se va a proceder a instalar el fichero";

         |CIERRA #37;
         eaExtension = "mod";
         eaPrograma  = "dsmom037";
         |SUB_EJECUTA_NP ":basica/dspatron";

         |ABRE #37;
         #37#0 = "L";
         #37#1 = "21";
         |LEE 000#37=;
         |SI FSalida = 0;
             |MENAV "0000 El fichero se ha instalado satisfactoriamente.";
         |SINO;
             |MENAV "0000 El fichero no se ha instalado, por favor instale la aplicacion ipbasica";
         |FINSI;
     |FINSI;
     |CIERRA #37;

     eaNomDef  = "dsmod110";

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
         |CABEZA "Modelo 0";
         |SI enComplem = 0;
              |HAZ SacaPantallas;
         |SINO;
             |ABRE #0;
             #0#0 = enEmpresa;
             #0#1 = enEjer;
             #0#2 = enPeriodo;
             #0#3 = enModelo;
             #0#4 = enComplem;
             #0#5 = enActividad;
             |LEE 101#0=;
             |SI FSalida ! 0;  |ACABA;  |FINSI;
             |PINPA #0#0;
             |PINDA #0#0;
             |ENDATOS #1#0;
             |SI FSalida = 0;
                 |GRABA 020#0a;
             |FINSI;
             |LIBERA #0;
             |CIERRA #0;
         |FINSI;
         |ACABA;
     |FINSI;

     |SI enTipoEntrada = 1;              || Alta del Modelo
          |CABEZA "Modelo 110";
          |HAZ SacaPantallas110;
          enResultado = #0#29;
          |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         |LEE 040#0=;
         |SI FSalida ! 0;  enExistencia = 1;  |DDEFECTO #0; |FINSI;
         |CIERRA #0;

         |SI enActividad = 0;  enResultado = #0#29;  |FINSI;
     |FINSI;
|FPRO;
