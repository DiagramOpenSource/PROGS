|FICHEROS;
     dsmoz059 #0;
     dsmom051 #51;  || Mant. Valores por Empresas
     dsmom052 #52;  || Socios
     dsmom053 #53;  || Comuneros

     :/basica/def/agim0019 #119;  || Registro de Sociedades
     dsmow060 #99,MANTE;  ||Temporal V.Empresas Pantalla
|FIN;

|VARIABLES;
     nEstado   = 0;
     nCampo    = 0;
     nDEmpresa = 0;
     nHEmpresa = 0;
     nPeriodo  = 0;
     nEjer     = 0;
     aAlfa1    = "";
     aAlfa2    = "";
     aFichero  = "";
     aPath     = "";

     swExiste = 0;
     swSocie  = 0;
     &nEmpres  = 0;
     &nRegis   = 0;
     fFecha     = @;
     fLaFecha   = @;

     nNume1  = 0;
     nNume2  = 0;
     aAlfa  = "";
     aAlfa1 = "";
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\
|PROCESO Tipo7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#0 = enEmpresa;  |PINTA #0#0;
         #0#1 = enEmpresa;  |PINTA #0#1;

         |C_M #0#0, 1, "N";
         |C_M #0#1, 1, "N";
     |FINSI;
     fLaFecha = ~;
     aAlfa1 = fLaFecha; aAlfa1 = aAlfa1 % -104;
     #0#14 = aAlfa1;
     |PINTA #0#14;
|FPRC;

|PROCESO Parrilla;
     |SI #0#0 = 0;
         #0#0 = 0;  |PINTA #0#0;
         #0#1 = 0;  |PINTA #0#1;  |C_M #0#1, 1, "N";
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#0, 1, "S";
             |C_M #0#1, 1, "S";
         |FINSI;

         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|| /////////////////////// //////////////////////////////////////////////////
|PROCESO CreaValor0;
  aAlfa1      = #0#15;
  enEjerBajaM = 0;
  nEmpres     = #51#0;
  |HAZ LosDatosEmpresa;
  |SI enEjerBajaM > 0; |Y enEjerBajaM [ #0#14;
      aAlfa1 = "S";
  |FINSI;

  #99#0 = #51#0;
      #99#1 = #51#1;
      |LEE 101#99=;
      |SI FSalida ! 0;
          |DDEFECTO #99;
          #99#0 = #51#0;
          #99#1 = #51#1;
          |GRABA 020#99b;
      |FINSI;
      #99#2 = #51#2;
      #99#3 = #51#3;
      #99#4 = #51#12;
      #99#5 = #51#21;
      #99#6 = #51#23;
      #99#7 = #51#25;
      #99#8 = #51#27;
      #99#9 = #51#29;
      |GRABA 020#99a;
      |LIBERA #99;
  |FINSI;
|FPRC;

|DEFBUCLE CreaValor;
    #51#1;
    ;
    nDEmpresa, enEjer;
    nHEmpresa, enEjer;
    e;
    NULL, CreaValor;
|FIN;

|PROCESO Calcular;
  |ABRE #99;
  |BUCLE CreaValor;
  |CIERRA #99;
|FPRC;

|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

|| .....................................................................
|PROCESO BorraComun0;
  |BORRA 020#53a;
  |LIBERA #53;
|FPRC;

|DEFBUCLE BorraComun;
    #53#1;
    ;
    #51#0, #51#1, 01, 00001;
    #51#0, #51#1, 99, 99999;
    be;
    NULL, BorraComun0;
|FIN;

|PROCESO BorraSocio0;
  |PDEFECTO #52, 5,11;
  |GRABA 020#52a;
  |LIBERA #52;
|FPRC;

|DEFBUCLE BorraSocio;
    #52#1;
    ;
    #51#0, #51#1, 001;
    #51#0, #51#1, 999;
    be;
    NULL, BorraSocio0;
|FIN;

|PROCESO Borrar0;
  |BUCLE BorraSocio;
  |BUCLE BorraComun;
  |PDEFECTO #51, 12, 33;
  |GRABA 020#51a;
  |LIBERA #51;
|FPRC;

|DEFBUCLE BCalculoAnt;    || Borrado Calculo Anterior
    #51#1;
    ;
    nDEmpresa, enEjer;
    nHEmpresa, enEjer;
    be;
    NULL, Borrar0;
|FIN;
|| .....................................................................

|RUTINA ClaveBaja99;
 #99#0 = 00001;
 #99#1 = enEjer;
|FRUT;

|RUTINA ClaveAlta99;
 #99#0 = 99999;
 #99#1 = enEjer;
|FRUT;

|PROCESO Tipo3;  |TIPO 3;

     aFichero = ("60" + Usuario) % 108;
     |NOME_DAT #99 aFichero;
     |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

     enEjer      = #0#14;        || A¤o Calculo

     aAlfa1      = #0#14;
     aAlfa1      = aAlfa1 % -104;
     aAlfa1      = "01.01."+ aAlfa1;
     fFecha      = aAlfa1;

     |SI #0#0 ! 0;
         nDEmpresa = #0#0;
         nHEmpresa = #0#1;
         |HAZ Calcular;
     |SINO;
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               nDEmpresa = #0nCampo;
               nHEmpresa = #0nCampo;
               |HAZ Calcular;         || Calcular Valor
         |SIGUE;
     |FINSI;
     |ENTLINEAL #1#99, -1, 4, 22, 1, ClaveBaja99, ClaveAlta99;
     |SI FSalida = 0;
         |CONFI "    Borrar Seleccion ";
         |SI FSalida = 0;
             |HAZ Borrar;
         |FINSI;
     |FINSI;
     |DELINDEX #99;
|FPRC;

|| =========================================================================
|PROCESO CuentoA;
 |SI #agicen14#5 > "01.01.0000";
     |SI #agicen14#5 > fFecha;  |ACABA;  |FINSI;
 |FINSI;
 |SI #agicen14#6 > "01.01.0000";
     |SI #agicen14#6 < fFecha;  |ACABA;  |FINSI;
 |FINSI;
 |SI #agicen14#9 ] 8; |Y #agicen14#9 [ 12;
     nNumAct = nNumAct + 1;
 |FINSI;
|FPRC;

|DEFBUCLE CuentoA;
 #114#1;
 ;
 enEmpresa,00;
 enEmpresa,99;
 e;
 NULL, CuentoA;
|FIN;

|PROCESO CuentoAct;
  nNumAct = 0;
  |BUCLE CuentoA;
  |SI nNumAct = 0;
      nNumAct = 1;
  |FINSI;
|FPRC;

|PROCESO LosDatosEmpresa;
  enEjerBajaM = 0;
    swExiste = 0;
    nRegis   = 0;
    |ABRE #agim0019;
    #agim0019#0 = nEmpresa; || Empresa
    #agim0019#1 = 99;
    |LEE 041#agim0019.];
    |SI FSalida = 0;
        |SI #agim0019#0 ! nEmpres;
            |LEE 041#agim0019.a;
            |SI FSalida = 0; |Y #agim0019#0 = nEmpres;
                swExiste = 1;
            |FINSI;
        |SINO;
            swExiste = 1;
        |FINSI;
    |FINSI;
    |SI swExiste = 1;
        nRegis = #agim0019#1;  ||Registre
        |SI #agim0019#12 > "01.01.1000";
            aAlfa1 = #agim0019#12; aAlfa1 = aAlfa1 % -104; enEjerBajaM = aAlfa1;
        |FINSI;
    |FINSI;
    |CIERRA #agim0019;
|FPRC;
