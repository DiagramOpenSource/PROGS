|FICHEROS;
     dsmo1347 #1;
     dsmo2347 #2,MANTE;
     dsmo3347 #3,MANTE;
     :/basica/def/agicen17 #117;
     :/basica/def/agicen14 #114;

     reflejo@ #33;
|FIN;

|VARIABLES;
     aPathModelo = "";
     aDef        = "";
     aAlfa       = "";

     nForma      = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO PintaClave2;
     |ATRI S;
     |PINTA 0839, #1#16;   |PINTA 0845, #1#17;
     |ATRI s;
|FPRC;

|PROCESO Tipo2mo3347;  |TIPO 2;
     #1#16 = #1#16 +. 1;
     #1#17 = #1#17 +. #3#10;

     |HAZ PintaClave2;
|FPRC;

|RUTINA ClaveBaja117;
     #117#0 = #3#0;
     #117#1 = 01;
     #117#2 = 01;
|FRUT;

|RUTINA ClaveAlta117;
     #117#0 = #3#0;
     #117#1 = 99;
     #117#2 = 99;
|FRUT;

|RUTINA ClaveBaja114;
     #114#0 = #3#0;
     #114#1 = 01;
|FRUT;

|RUTINA ClaveAlta114;
     #114#0 = #3#0;
     #114#1 = 99;
|FRUT;

|RUTINA ClaveBaja331;
     #33#0 = #1#0;
     #33#1 = #1#1;
     #33#2 = #1#2;
     #33#3 = #1#3;
     #33#4 = #1#4;
     #33#7 = "            ";
|FRUT;

|RUTINA ClaveAlta331;
     #33#0 = #1#0;
     #33#1 = #1#1;
     #33#2 = #1#2;
     #33#3 = #1#3;
     #33#4 = #1#4;
     #33#7 = "zzzzzzzzzzzz";
|FRUT;

|RUTINA ClaveBaja332;
     #33#0 = #1#0;
     #33#1 = #1#1;
     #33#2 = #1#2;
     #33#3 = #1#3;
     #33#4 = #1#4;
     #33#8 = "                                        ";
|FRUT;

|RUTINA ClaveAlta332;
     #33#0 = #1#0;
     #33#1 = #1#1;
     #33#2 = #1#2;
     #33#3 = #1#3;
     #33#4 = #1#4;
     #33#8 = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
|FRUT;

|PROCESO Tipo11mo3347;  |TIPO 11;
     |SI FSalida = 10;
         |ABRE #117;
         #117#0 = #3#0;
         #117#1 = 0;
         #117#2 = 0;
         |LEE 040#117];
         |SI FSalida = 0;  |Y #117#0 = #3#0;
             |C_M #117#2, 1, "S";
             |CONSULTA_F_CLAVE #1#117, ClaveBaja117, ClaveAlta117;

             #3#5 = #117#1;   |PINTA #3#5;
             #3#6 = #117#2;   |PINTA #3#6;
             #3#7 = #117#4;   |PINTA #3#7;
             #3#8 = #117#5;   |PINTA #3#8;
             #3#9 = #117#3;   |PINTA #3#9;
         |SINO;
             |MENAV "     No existen Referencias Catastrales en la Empresa.";
         |FINSI;
         |CIERRA #117;
         |ERROR;
     |FINSI;

     |SI FSalida = 11;
         |ABRE #114;
         #114#0 = #3#0;
         #114#1 = 0;
         |LEE 040#114];
         |SI FSalida = 0;  |Y #114#0 = #3#0;
             |CONSULTA_F_CLAVE #1#114, ClaveBaja114, ClaveAlta114;

             #3#5 = #114#1;   |PINTA #3#5;
         |SINO;
             |MENAV "     No existen Actividades en la Empresa.";
         |FINSI;
         |CIERRA #114;
         |ERROR;
     |FINSI;

     |SI FSalida = 12;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmo3347.mas";
         |CARGA_DEF aDef, reflejo@;
         |SI FSalida ! 0;
             aAlfa = "     Error en cargar el Def dsmo3347.mas";
             |MENAV aAlfa;
             |ERROR;
         |FINSI;

         |PUSHV 0501 2380;
         |ATRI P;
         |PINTA 0703, "MODO CONSULTA  <ORDENADO POR DNI>";
         |ATRI p;
         |ENTLINEAL #2#33, -6, 4, 22, 0, ClaveBaja331, ClaveAlta331;
         |POPV;

         |DESCARGA_DEF #reflejo@;

         |ERROR;
     |FINSI;

     |SI FSalida = 13;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmo3347.mas";
         |CARGA_DEF aDef, reflejo@;
         |SI FSalida ! 0;
             aAlfa = "     Error en cargar el Def dsmo3347.mas";
             |MENAV aAlfa;
             |ERROR;
         |FINSI;

         |PUSHV 0501 2380;
         |ATRI P;
         |PINTA 0703, "MODO CONSULTA  <ORDENADO POR NOMBRE>";
         |ATRI p;
         |ENTLINEAL #3#33, -6, 4, 22, 0, ClaveBaja332, ClaveAlta332;
         |POPV;

         |DESCARGA_DEF #reflejo@;

         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Actividad;
     |ABRE #114;
     #114#0 = #3#0;
     #114#1 = #3#5;
     |LEE 040#114=;
     |SI FSalida ! 0;
         |MENAV "     No existe la Actividad en la Empresa.";
         |ERROR;
     |FINSI;
     |CIERRA #114;
|FPRC;

|PROCESO PonDatos;  |TIPO 0;
     |ABRE #117;
     #117#0 = #3#0;
     #117#1 = #3#5;
     #117#2 = #3#6;
     |LEE 040#117=;
     |SI FSalida = 0;
         #3#7 = #117#4;   |PINTA #3#7;
         #3#8 = #117#5;   |PINTA #3#8;
         #3#9 = #117#3;   |PINTA #3#9;
     |SINO;
         |CONFI "     No existe la Referencia Catastral en la Actividad. Desea darla de Alta : ";
         |SI FSalida = 0;
             enEmpresa   = #3#0;
             enActividad = #3#5;
             |SUB_EJECUTA ":basica/agicen17";
         |FINSI;
         |ERROR;
     |FINSI;
     |CIERRA #117;
|FPRC;
