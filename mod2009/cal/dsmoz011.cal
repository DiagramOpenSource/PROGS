|FICHEROS;
     dsmoz011 #0;
     dsmom023 #23;
     dsmom024 #24;
     :/basica/def/agitab99 #99;
|FIN;

|VARIABLES;
   nDEmpresa = 0;
   nHEmpresa = 0;
   nDEjercic = 0;
   nHEjercic = 0;
   aAlfa1    = "";

|FIN;

|INCLUYE i_variar;
|INCLUYE i_modhis;


|| .... Proceso que suma para el total
|PROCESO total;
 aAlfa1 = #24#3; |QBF aAlfa1;
 aAlfa1 = aAlfa1 % 101;
 |SI #24#9 ! 0;
     #24#8 = #24#9;
 |SINO;
     #24#8 = -(#24#10 + #24#11);
 |FINSI;
 |SI aAlfa1 ! "3";
     #24#13 = #24#8;
     #24#14 = 0;
     #24#15 = 0;
     #24#16 = 0;
     #24#17 = 0;
 |FINSI;

 #23#4 = #23#4 + #24#9;
 #23#5 = #23#5 + #24#10;
 #23#6 = #23#4 - #23#5;
|FPRC;

|DEFBUCLE total;
 #24#1;
 ;
 #23#0, #23#1, 00, #23#2, 00;
 #23#0, #23#1, 99, #23#2, 99;
 ;
 NULL, total;
|FIN;

|| .... Proceso que elimina de Historico los modelos que no sirven
|PROCESO Borra024_P;
 |BORRA 020#24a;
 |LIBERA #24;
|FPRC;

|DEFBUCLE Borra024_P;
     #24#1;
     ;
     #23#0, #23#1, 00, #23#2, 00;
     #23#0, #23#1, 99, #23#2, 99;
     be;
     NULL, Borra024_P;
|FIN;

|PROCESO Borra023_P;
   enModelo = #23#2;
   |HAZ SelModelo;
   |SI nSwModHis = 0;
       |BUCLE Borra024_P;
       |BORRA 020#23a;
   |SINO;
       |HAZ LeoMod;
       #23#3 = #99#1;
       #23#4 = 0;
       #23#5 = 0;
       #23#6 = 0;
       |BUCLE total;
       |GRABA 020#23a;
   |FINSI;
   |LIBERA #23;
|FPRC;

|DEFBUCLE elCalculo;
     #23#1;
     ;
     nDEmpresa, nDEjercic, 000;
     nHEmpresa, nHEjercic, 999;
     be;
     NULL, Borra023_P;
|FIN;

|CALCULO ElProceso; |TIPO 3;
   |SI #0#0 = "N";
       |ACABA;
   |FINSI;

   nDEmpresa = 00001; nHEmpresa = 99999;
   nDEjercic = 1900;  nHEjercic = 2099;
   |BUCLE elCalculo;

|FCAL;

|PROCESO LeoMod;
   |ABRE #99;
   #99#0 = #23#2;
   |LEE 040#99=;
   |SI FSalida ! 0;
       |DDEFECTO #99;
   |FINSI;
   |CIERRA #99;
|FPRC;
