|FICHEROS;
     dsmoy019 #0;
     dsmom002 #2;
     dsmom026 #26;
     dsmoc110 #110;

     :/basica/def/agifigen   #300;

     :/laboral/def/labtraba  #200;
     :/laboral/def/nomhicca  #201;
     :/laboral/def/nomhicli  #202;
     :/laboral/def/labempre  #203;
     :/laboral/def/nomconli  #204;
     :/laboral/def/nomhiatr  #205;
     :/laboral/def/nomconca  #206;
     :/laboral/def/labcentr  #207;
     :/laboral/def/nomcenes  #208;
     :/laboral/def/nomnotay  #215;

     dsmow019 #100;
|FIN;

|VARIABLES;
     nCampo            = 0;
     nDEmpresa         = 0;
     nHEmpresa         = 0;
     nHandle           = 0;
     nEjer             = 0;
     nCentro           = 0;
     nEmpresa          = 0;
     nDPeriodo         = 0;
     nHPeriodo         = 0;
     nImporteBaseI     = 0;
     nImporteRetencion = 0;
     nImporteSSocial   = 0;
     ded_not           = 0;
     nImporteSSTrabaja = 0;
     nMesLugar         = 0;
     nPeriodo          = 0;
     nDevengo          = 0;
     nAtrasos          = 0;
     nEjerAt           = 0;
     nPerLugar         = 0;
     nHay              = 0;

     aPathLaboral      = "";
     aBase             = "";
     aAlfa             = "";
     aFichero          = "";
     aEjer             = "";
     aEspecie          = "";
     aRepercute        = "";
     aClave            = "";
     aSubClave         = "";
     aDni              = "";
     aNombreTrabajador = "";
     aPeriodicidad     = "";

     fFecha            = @;
     notaria           = 0;

     nNume1            = 0;
     nNume2            = 0;
     nNume3            = 0;
     nNume4            = 0;

     &nSwl1 = 0;
     &nSwl2 = 0;
     &nSwl3 = 0;
     &nSwl4 = 0;
     &nSwl5 = 0;
     &nSwl6 = 0;
     &nSwl7 = 0;
     &nSwl8 = 0;
     &nSwl9 = 0;
     &nSwl10 = 0;

     &aNumEmp = "";
     &aNomEmp = "";
     aNroAfiliacion = "";
     cta_co = "";

     nExism002 = 0;
     fFecIni   = @;
     fFecFin   = @;

     aAlfa1    = "";
     aAlfa2    = "";
     aAlfa3    = "";

     nDComplem = 0;
     nHComplem = 0;
     Periodo   = 0;
     nImporteLiquido = 0;
|FIN;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO Trabajador;
     |C_M #0#18, 1, "S";
     |SI #0#17 = 0;
         |C_M #0#18, 1, "N";  #0#18 = 99999;  |PINTA #0#18;
     |FINSI;
|FPRC;

|PROCESO Periodo;
     nCampo = Campo + 1;
     #0nCampo = "          ";
     |SI #0Campo = 1;   #0nCampo = "ENERO     ";  |FINSI;
     |SI #0Campo = 2;   #0nCampo = "FEBRERO   ";  |FINSI;
     |SI #0Campo = 3;   #0nCampo = "MARZO     ";  |FINSI;
     |SI #0Campo = 4;   #0nCampo = "ABRIL     ";  |FINSI;
     |SI #0Campo = 5;   #0nCampo = "MAYO      ";  |FINSI;
     |SI #0Campo = 6;   #0nCampo = "JUNIO     ";  |FINSI;
     |SI #0Campo = 7;   #0nCampo = "JULIO     ";  |FINSI;
     |SI #0Campo = 8;   #0nCampo = "AGOSTO    ";  |FINSI;
     |SI #0Campo = 9;   #0nCampo = "SEPTIEMBRE";  |FINSI;
     |SI #0Campo = 10;  #0nCampo = "OCTUBRE   ";  |FINSI;
     |SI #0Campo = 11;  #0nCampo = "NOVIEMBRE ";  |FINSI;
     |SI #0Campo = 12;  #0nCampo = "DICIEMBRE ";  |FINSI;

     |SI #0nCampo = "          ";
         |MENAV "     Periodo Incorrecto.";
         |ERROR;
     |FINSI;

     |PINTA #0nCampo;

     |SI Campo = 0;
         fFecha = ~;
         aAlfa  = fFecha % -104;
         #0#2   = aAlfa;
         |PINTA #0#2;
     |FINSI;
|FPRC;

|PROCESO Parrilla;
     |SI #0#3 = 0;
         #0#3 = 0;  |PINTA #0#3;
         #0#4 = 0;  |PINTA #0#4;  |C_M #0#4, 1, "N";
         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |C_M #0#3, 1, "S";
         |C_M #0#4, 1, "S";

         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|PROCESO VerM002;
 |SI #2#8 > "01.01.1900";
     |SI #2#8 > fFecFin;  |ACABA;  |FINSI;
 |FINSI;
 |SI #2#9 > "01.01.1900";
     |SI #2#9 < fFecIni;  |ACABA;  |FINSI;
 |FINSI;
 nExism002 = 0;
|FPRC;

|DEFBUCLE VerM002;
 #2#1;
 ;
 nEmpresa, 01, 110;
 nEmpresa, 99, 110;
 e;
 NULL, VerM002;
|FIN;

|PROCESO GrabaTemporal1;
     |SI aClave = " ";  |Y aSubClave = "  ";  |ACABA;  |FINSI;

     #100#0     = #300#0;
     #100#1     = aDni;
     #100#2     = nDevengo;
     #100#3     = aClave;
     #100#4     = aSubClave;
     |LEE 001#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0     = #300#0;
         #100#1     = aDni;
         #100#2     = nDevengo;
         #100#3     = aClave;
         #100#4     = aSubClave;
         |GRABA 020#100c;
     |FINSI;

     #100#5        = aNombreTrabajador;
     #100#99       = aNroAfiliacion;

                        nPerLugar = #201#2;
||   |SI nDevengo ! 0;  nPerLugar = #205#4;  |FINSI;
     |SI nAtrasos = 1;  nPerLugar = #205#4;  |FINSI;

     |SI nAtrasos = 1;

         nMesLugar     = nPerLugar + 99;
         #100nMesLugar = #100nMesLugar + nImporteBaseI;
         #100#112      = #100#112       + nImporteBaseI;

         nMesLugar     = nPerLugar + 112;
         #100nMesLugar = #100nMesLugar + nImporteRetencion;
         #100#125      = #100#125      + nImporteRetencion;

         nMesLugar     = nPerLugar + 125;
         #100nMesLugar = #100nMesLugar + nImporteSSTrabaja;
         #100#138      = #100#138      + nImporteSSTrabaja;

     |SINO;

          |SI aClave ! "L";  |Y aSubClave ! "01";
              nMesLugar     = nPerLugar + 5;
              #100nMesLugar = #100nMesLugar + nImporteBaseI;
              #100#18       = #100#18       + nImporteBaseI;

              nMesLugar     = nPerLugar + 18;
              #100nMesLugar = #100nMesLugar + nImporteRetencion;
              #100#31       = #100#31       + nImporteRetencion;
          |SINO;
               nMesLugar     = nPerLugar + 31;
               #100nMesLugar = #100nMesLugar + nImporteBaseI;
               #100#44       = #100#44       + nImporteBaseI;
          |FINSI;

          nMesLugar     = nPerLugar + 85;
          #100nMesLugar = #100nMesLugar + nImporteSSTrabaja;
          #100#98       = #100#98       + nImporteSSTrabaja;
    |FINSI;

    nMesLugar     = nPerLugar + 138;
    #100nMesLugar = #100nMesLugar + nImporteLiquido;
    #100#151      = #100#151      + nImporteLiquido;

     #100#71 = #300#1;
     #100#72 = #201#1;

     |GRABA 020#100a;
     |LIBERA #100;

     nImporteBaseI     = 0;
     nImporteRetencion = 0;
     nImporteSSocial   = 0;
     nImporteSSTrabaja = 0;
     nImporteLiquido   = 0;
     ded_not           = 0;
|FPRC;

|PROCESO nomhicli;
     #204#0 = #200#87;
     #204#2 = #202#4;
     |LEE 101#204=;
     |SI FSalida = 0;
         |SI #204#8 = 0;  |ACABA;  |FINSI;

         |SI #204#13 = "  ";
             #204#13 = "01";
             |GRABA 020#204a;
         |FINSI;

         aClave            = "L";
         aSubClave         = #204#13;
         aEspecie          = "N";
         aRepercute        = "N";
         nImporteBaseI     = #202#11 * #202#10;
         nImporteRetencion = 0;
         |HAZ GrabaTemporal1;
     |FINSI;

     |LIBERA #204;
|FPRC;

|DEFBUCLE nomhicli;
     #202#1;
     ;
     #201#0, #201#1, #201#66, #201#2, #201#3, 411;
     #201#0, #201#1, #201#66, #201#2, #201#3, 499;
     ;
     NULL, nomhicli;
|FIN;

|PROCESO SSTrabaja;
     |ABRE #215;
     #215#0 = nEmpresa;
     #215#1 = nCentro;
     |LEE 000#215=;
     |SI FSalida ! 0;
         #215#2 = 0;       || (%) a cero
     |FINSI;
     notaria = #215#2;
     |CIERRA #215;

     ded_not  = (#201#48 < notaria) ! 2;
     nImporteSSTrabaja = (ded_not+#201#49+#201#50+#201#51);           || deduc.S.S.
|FPRC;

|PROCESO nomhicca;
     nDevengo = 0;

     |SI nAtrasos = 1;
         |SI #205#1 ! #205#3;
              nDevengo = #205#3;
         |FINSI;
     |FINSI;

     #203#0 = #201#0;
     |LEE 000#203=;
     |SI FSalida ! 0;  |DDEFECTO #203; |FINSI;

     #200#0 = #201#0;
     #200#1 = #201#1;
     |LEE 000#200=;
     |SI FSalida ! 0;  |DDEFECTO #200; |FINSI;
     nCentro = #200#77;

     aNombreTrabajador = #200#2;
     aDni              = #200#7;
     aNroAfiliacion    = #200#75;
     |QBF aNroAfiliacion;

     aClave            = #200#99;
     aSubClave         = #200#102;
     aEspecie          = #200#105;
     aRepercute        = #200#108;
     nImporteBaseI     = #201#14 + #201#16;
     nImporteRetencion = #201#15 + #201#17;
     nImporteSSocial   = #201#45;
     nImporteLiquido   = #201#155;
     |HAZ SSTrabaja;
     |HAZ GrabaTemporal1;

     aClave            = #200#100;
     aSubClave         = #200#103;
     aEspecie          = #200#106;
     aRepercute        = #200#109;
     nImporteBaseI     = #201#108;
     nImporteRetencion = #201#110;
     |HAZ GrabaTemporal1;

     aClave            = #200#101;
     aSubClave         = #200#104;
     aEspecie          = #200#107;
     aRepercute        = #200#110;
     nImporteBaseI     = #201#109;
     nImporteRetencion = #201#111;
     |HAZ GrabaTemporal1;

     |SI #201#18 ! 0;
         |BUCLE nomhicli;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca;
     #201#1;
     ;
     nEmpresa, #0#17, nEjer, nDPeriodo, 0;
     nEmpresa, #0#18, nEjer, nHPeriodo, 4;
     ;
     NULL, nomhicca;
|FIN;

|DEFBUCLE nomhiccaA;
     #201#1;
     ;
     #205#0, #0#17, nEjerAt, 01, #205#2;
     #205#0, #0#18, nEjerAt, 12, #205#2;
     ;
     NULL, nomhicca;
|FIN;

|PROCESO nomhiatr;
     |SI #205#4 = 0;  |ACABA;  |FINSI;

     |SI #205#4 < nDPeriodo;  |ACABA;  |FINSI;
     |SI #205#4 > nHPeriodo;  |ACABA;  |FINSI;

     aAlfa   = #205#3;
     aAlfa   = aAlfa % -102;
     nEjerAt = aAlfa;
     |BUCLE nomhiccaA;
|FPRC;

|DEFBUCLE nomhiatr;
     #205#1;
     ;
     nEmpresa, #0#2, 5, 0000;
     nEmpresa, #0#2, 9, 9999;
     ;
     NULL, nomhiatr;
|FIN;

|PROCESO dsmom026;
     nEmpresa = #26#1;
     |SI #0#120 = "S";
         nExism002 = 1;
         |BUCLE VerM002;
         |SI nExism002 = 1; |ACABA; |FINSI; ||miro si existe modelo
     |FINSI;
     nAtrasos = 0;  |BUCLE nomhicca;
     nAtrasos = 1;  |BUCLE nomhiatr;
|FPRC;

|DEFBUCLE dsmom026;
     #26#1;
     ;
     #300#0, 00001;
     #300#0, 99999;
     ;
     NULL, dsmom026;
|FIN;

|PROCESO agifigen;
     |SELECT #1#26;
     #26#0 = #300#0;
     #26#1 = 0;
     |LEE 040#26];
     |SI FSalida = 0;  |Y  #26#0 = #300#0;
         |BUCLE dsmom026;
         |ACABA;
     |FINSI;

     |SELECT #3#26;
     #26#1 = #300#0;
     |LEE 040#26=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     nEmpresa = #300#0;
     |SI #0#120 = "S";
         nExism002 = 1;
         |BUCLE VerM002;
         |SI nExism002 = 1; |ACABA; |FINSI; ||miro si existe modelo
     |FINSI;

     nAtrasos = 0;  |BUCLE nomhicca;
     nAtrasos = 1;  |BUCLE nomhiatr;
|FPRC;

|DEFBUCLE agifigen;
     #300#1;
     ;
     #0#3;
     #0#4;
     ;
     NULL, agifigen;
|FIN;

|| /////////////////////////////////////////////////////////

|PROCESO SumaBaseN;
     |SI aPeriodicidad = "T";
         |SI #110#2 = 3;
             #100#45 = #100#45 + #110#10 + #110#12;  || Base
             #100#46 = #100#46 + #110#15 + #110#17;
             #100#47 = #100#47 + #110#20 + #110#22;

             #100#58 = #100#58 + #110#11 + (#110#13 + #110#14);
             #100#59 = #100#59 + #110#16 + (#110#18 + #110#19);
             #100#60 = #100#60 + #110#21 + (#110#23 + #110#24);
         |FINSI;

         |SI #110#2 = 6;
             #100#48 = #100#48 + #110#10 + #110#12;
             #100#49 = #100#49 + #110#15 + #110#17;
             #100#50 = #100#50 + #110#20 + #110#22;

             #100#61 = #100#61 + #110#11 + (#110#13 + #110#14);
             #100#62 = #100#62 + #110#16 + (#110#18 + #110#19);
             #100#63 = #100#63 + #110#21 + (#110#23 + #110#24);
         |FINSI;

         |SI #110#2 = 9;
             #100#51 = #100#51 + #110#10 + #110#12;
             #100#52 = #100#52 + #110#15 + #110#17;
             #100#53 = #100#53 + #110#20 + #110#22;

             #100#64 = #100#64 + #110#11 + (#110#13 + #110#14);
             #100#65 = #100#65 + #110#16 + (#110#18 + #110#19);
             #100#66 = #100#66 + #110#21 + (#110#23 + #110#24);
         |FINSI;

         |SI #110#2 = 12;
             #100#54 = #100#54 + #110#10 + #110#12;
             #100#55 = #100#55 + #110#15 + #110#17;
             #100#56 = #100#56 + #110#20 + #110#22;

             #100#67 = #100#67 + #110#11 + (#110#13 + #110#14);
             #100#68 = #100#68 + #110#16 + (#110#18 + #110#19);
             #100#69 = #100#69 + #110#21 + (#110#23 + #110#24);
         |FINSI;

         #100#57 = 0;
         |PARA nCampo = 45;  |SI nCampo [ 56;  |HACIENDO nCampo = nCampo + 1;
               #100#57 = #100#57 + #100nCampo;
         |SIGUE;

         #100#70 = 0;
         |PARA nCampo = 58;  |SI nCampo [ 69;  |HACIENDO nCampo = nCampo + 1;
               #100#70 = #100#70 + #100nCampo;
         |SIGUE;
     |SINO;
         nMesLugar = 44 + #110#2;
         #100nMesLugar = #100nMesLugar + #110#10 + #110#12 + #110#15 + #110#17 + #110#20 + #110#22;
         #100#57       = #100#57       + #110#10 + #110#12 + #110#15 + #110#17 + #110#20 + #110#22;

         nMesLugar = 57 + #110#2;
         #100nMesLugar = #100nMesLugar + #110#11 + (#110#13 + #110#14);
         #100nMesLugar = #100nMesLugar + #110#16 + (#110#18 + #110#19);
         #100nMesLugar = #100nMesLugar + #110#21 + (#110#22 + #110#24);

         #100#70       = #100#70       + #110#11 + (#110#13 + #110#14);
         #100#70       = #100#70       + #110#16 + (#110#18 + #110#19);
         #100#70       = #100#70       + #110#21 + (#110#22 + #110#24);
     |FINSI;
|FPRC;

|PROCESO SumaBaseX;
     |SI aPeriodicidad = "T";
         |SI #110#2 = 3;
             #100#73 = #100#73 + #110#10 + #110#12;  || Base
             #100#74 = #100#74 + #110#15 + #110#17;
             #100#75 = #100#75 + #110#20 + #110#22;
         |FINSI;

         |SI #110#2 = 6;
             #100#76 = #100#76 + #110#10 + #110#12;
             #100#77 = #100#77 + #110#15 + #110#17;
             #100#78 = #100#78 + #110#20 + #110#22;
         |FINSI;

         |SI #110#2 = 9;
             #100#79 = #100#79 + #110#10 + #110#12;
             #100#80 = #100#80 + #110#15 + #110#17;
             #100#81 = #100#81 + #110#20 + #110#22;
         |FINSI;

         |SI #110#2 = 12;
             #100#82 = #100#82 + #110#10 + #110#12;
             #100#83 = #100#83 + #110#15 + #110#17;
             #100#84 = #100#84 + #110#20 + #110#22;
         |FINSI;

         #100#85 = 0;
         |PARA nCampo = 73;  |SI nCampo [ 84;  |HACIENDO nCampo = nCampo + 1;
               #100#85 = #100#85 + #100nCampo;
         |SIGUE;
     |SINO;
         nMesLugar = 72 + #110#2;
         #100nMesLugar = #100nMesLugar + #110#10 + #110#12 + #110#15 + #110#17 + #110#20 + #110#22;
         #100#85       = #100#85       + #110#10 + #110#12 + #110#15 + #110#17 + #110#20 + #110#22;
     |FINSI;
|FPRC;

|PROCESO MiraEmp;
     |ABRE #300;
     |DDEFECTO #300;
     #300#0 = #110#0;
     |LEE 040#300=;
     |CIERRA #300;
     #100#71 = #300#1;
|FPRC;

|PROCESO labtraba;
     |SI #200#1 ] #0#17;  |Y #200#1 [ #0#18;
         nHay = 1;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #200#5;
     ;
     #110#0, #110#6;
     #110#0, #110#6;
     ;
     NULL, labtraba;
|FIN;

|PROCESO Graba110;
     |SI #0#17 ! 0;
         nHay = 0;
         |BUCLE labtraba;
         |SI nHay = 0;   |ACABA;  |FINSI;
     |FINSI;

     nExism002 = 0;
     |SI #110#5 ! 99;
         |ABRE #2;
         |SELECT #1#2;
         #2#0 = #110#0;
         #2#1 = #110#5;
         #2#2 = 110;
         |LEE 040#2=;
         |SI FSalida ! 0;  |DDEFECTO #2; nExism002 = 1; |FINSI;
         |CIERRA #2;
     |SINO;
         |ABRE #2;
         |SELECT #2#2;
         #2#0 = #110#0;
         #2#2 = 110;
         #2#1 = 1;
         |LEE 040#2];
         |SI FSalida ! 0;    |DDEFECTO #2; nExism002 = 1; |FINSI;
         |SI #2#0 ! #110#0;  |DDEFECTO #2; nExism002 = 1; |FINSI;
         |SI #2#2 ! 110;     |DDEFECTO #2; nExism002 = 1; |FINSI;
         |CIERRA #2;
     |FINSI;
     |SI #0#120 = "S";
         |SI nExism002 = 0; nExism002 = 1; |HAZ VerM002; |FINSI;
         |SI nExism002 = 1; |ACABA; |FINSI;
     |FINSI;
     #100#0     = #110#0;
     #100#1     = #110#6;
     #100#2     = #110#7;
     #100#3     = #110#8;
     #100#4     = #110#9;
     |LEE 001#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0     = #110#0;
         #100#1     = #110#6;
         #100#2     = #110#7;
         #100#3     = #110#8;
         #100#4     = #110#9;
         #100#5     = #110#29;
         |HAZ MiraEmp;
         |GRABA 020#100c;
     |FINSI;

     aPeriodicidad = "T";
     |SI #2#7 = "MENSUAL   ";  aPeriodicidad = "M";  |FINSI;

     |SI aPeriodicidad = "T";
         |SI #0#0 = 1;   nPeriodo = 3;   |FINSI;
         |SI #0#0 = 2;   nPeriodo = 3;   |FINSI;
         |SI #0#0 = 3;   nPeriodo = 3;   |FINSI;
         |SI #0#0 = 4;   nPeriodo = 6;   |FINSI;
         |SI #0#0 = 5;   nPeriodo = 6;   |FINSI;
         |SI #0#0 = 6;   nPeriodo = 6;   |FINSI;
         |SI #0#0 = 7;   nPeriodo = 9;   |FINSI;
         |SI #0#0 = 8;   nPeriodo = 9;   |FINSI;
         |SI #0#0 = 9;   nPeriodo = 9;   |FINSI;
         |SI #0#0 = 10;  nPeriodo = 12;  |FINSI;
         |SI #0#0 = 11;  nPeriodo = 12;  |FINSI;
         |SI #0#0 = 12;  nPeriodo = 12;  |FINSI;
     |SINO;
         nPeriodo = #0#0;
     |FINSI;

     |SI #110#2 < #0#118;    |ACABA;  |FINSI;
     |SI #110#2 > nPeriodo;  |ACABA;  |FINSI;


     |SI #110#8 ! "L";
         |HAZ SumaBaseN;
     |SINO;
         |HAZ SumaBaseX;
     |FINSI;

     |GRABA 020#100a;
     |LIBERA #100;
|FPRC;

/*  no puedo leerlos todos
|DEFBUCLE dsmoc110;
     #110#1;
     ;
     #0#3, #0#2, 01, 110, 00, 01, "            ", 0000, " ", "  ";
     #0#4, #0#2, 12, 110, 99, 99, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, Graba110;
|FIN;
*/

|DEFBUCLE dsmoc110;
     #110#1;
     ;
     #300#0, #0#2, Periodo, 110, nDComplem, 01, "            ", 0000, " ", "  ";
     #300#0, #0#2, Periodo, 110, nHComplem, 99, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, Graba110;
|FIN;

|PROCESO agifigen_110;
    || miro el ultimo complementario
    || de los periodos anteriores 14_1285

    |PARA Periodo = 1;  |SI Periodo [ 12;  |HACIENDO Periodo = Periodo + 1;
          nDComplem = -1;
          |ABRE #110;
          |DDEFECTO #110;
          #110#0 = #300#0;
          #110#1 = #0#2;
          #110#2 = Periodo
          #110#3 = 110;
          #110#4 = 99;
          |LEE 040#110];
          |SI FSalida = 0;
              |LEE 040#110a;
          |SINO;
              |LEE 040#110u;
          |FINSI;
          |SI FSalida = 0; |Y #110#0 = #300#0; |Y #110#1 = #0#2;
                   |Y #110#2 = Periodo; |Y #110#3 = 110;
                       nDComplem = #110#4;
                       nHComplem = #110#4;
          |FINSI;
          |CIERRA #110;
          |SI nDComplem ] 0; |BUCLE dsmoc110; |FINSI;
  |SIGUE;
|FPRC;

|DEFBUCLE agifigen_110;
     #300#1;
     ;
     #0#3;
     #0#4;
     ;
     NULL, agifigen_110;
|FIN;

|| ... ... ... ... ... ... ... ... Proceso para Imprimir Auxiliar
|PROCESO Imprime;

     |SI nEmpresa ! #100#0;  |Y nEmpresa ! 0;
         |PIEINF;
         |PDEFECTO #0, 26,117;
     |FINSI;

     nEmpresa = #100#0;
     aNumEmp  = nEmpresa; |QBF aNumEmp;
     aNumEmp  = ("00000" + aNumEmp) % -105;
     aNomEmp  = #100#71;

     nSwl1 = 1; nSwl2 = 1; nSwl3 = 1;
     nSwl4 = 1; nSwl5 = 1; nSwl6 = 1;
     nSwl7 = 1; nSwl8 = 1; nSwl9 = 1;
     nSwl10 = 1;

|| ... SW para imprimir
     |PARA nNume1 = 1; |SI nNume1 [ 13; |HACIENDO nNume1 = nNume1 + 1;

           nNume3 = 5  + nNume1;                  || Base
           |SI #100nNume3 ! 0; nSwl1 = 0; |FINSI;

           nNume3 = 18 + nNume1;                  || Retencion
           |SI #100nNume3 ! 0; nSwl2 = 0; |FINSI;

           nNume3 = 85 + nNume1;                  || S.Social
           |SI #100nNume3 ! 0; nSwl3 = 0; |FINSI;

           nNume3 = 31 + nNume1;                  || Base Exenta
           |SI #100nNume3 ! 0; nSwl4 = 0; |FINSI;

           nNume3 = 44 + nNume1;                  || Base 110
           |SI #100nNume3 ! 0; nSwl5 = 0; |FINSI;

           nNume3 = 72 + nNume1;                  || Base Exenta 110
           |SI #100nNume3 ! 0; nSwl6 = 0; |FINSI;

           nNume3 = 57 + nNume1;
           |SI #100nNume3 ! 0; nSwl7 = 0; |FINSI;

          nNume3 = 99 + nNume1;
           |SI #100nNume3 ! 0; nSwl8 = 0; |FINSI;  || Base atrasos

           nNume3 = 112 + nNume1;
           |SI #100nNume3 ! 0; nSwl9 = 0; |FINSI;  || Retencion atrasos

           nNume3 = 125 + nNume1;
           |SI #100nNume3 ! 0; nSwl10 = 0; |FINSI;  || S.Social atrasos

  |SIGUE;

  |PRINT;

|| ... Sumas
     |PARA nNume1 = 1; |SI nNume1 [ 13; |HACIENDO nNume1 = nNume1 + 1;

           nNume2 = 25 + nNume1;   || base
           nNume3 = 5  + nNume1;
           nNume4 = 99 + nNume1;   || base Atrasos
           #0nNume2 = #0nNume2 + #100nNume3 + #100nNume4;

           nNume2 = 38  + nNume1;   || retenciones
           nNume3 = 18  + nNume1;
           nNume4 = 112 + nNume1;   || retenciones Atrasos
           #0nNume2 = #0nNume2 + #100nNume3 + #100nNume4;

           nNume2 = 51  + nNume1;   || S.Social
           nNume3 = 85  + nNume1;
           nNume4 = 125 + nNume1;   || S.Social Atrasos
           #0nNume2 = #0nNume2 + #100nNume3 + #100nNume4;

           nNume2 = 64 + nNume1;   || Exenta
           nNume3 = 31 + nNume1;
           #0nNume2 = #0nNume2 + #100nNume3;

           nNume2 = 77 + nNume1;   || Tc1
           nNume3 = 44 + nNume1;
           #0nNume2 = #0nNume2 + #100nNume3;

           nNume2 = 103 + nNume1;   || Tc1  Exenta
           nNume3 = 72  + nNume1;
           #0nNume2 = #0nNume2 + #100nNume3;

           nNume2 = 90 + nNume1;   || Tc1
           nNume3 = 57 + nNume1;
           #0nNume2 = #0nNume2 + #100nNume3;

           nNume2 = 120 + nNume1;   || Liquido
           nNume3 = 138 + nNume1;
           #0nNume2 = #0nNume2 + #100nNume3;
  |SIGUE;
|FPRC;

|PROCESO cta_cotizacion;
|SI #200#45 = "087";|O #200#45 = "097";|O #200#45 = "085";
                    |O #200#45 = "064";|O #200#45 = "065";
     |DDEFECTO #208;
     #208#0 = #200#0;
     #208#13= #200#77;
     |SI #200#45 = "097";|O #200#45 = "085";
          #208#1 = "87";
     |SINO;
          |SI #200#45 = "065";
               #208#1 = "64";
          |SINO;
               #208#1 = #200#45 % 2;
          |FINSI;
     |FINSI;
     |LEE 000#208.=;
     cta_co = #208#10;   || cta.cto. del centro de trabajo especial
|SINO;
     cta_co = #203#13;   || cta.cot. de la empresa
     |DDEFECTO #207;
     #207#0 = #200#0;
     #207#1 = #200#77;
     |LEE 000#207=;
     |SI #203#45 = "S";
          cta_co = #207#10;   || cta.cot. centro de trabajo
     |FINSI;
|FINSI;
|FPRC;

|PROCESO ordena;
     |DDEFECTO #203;
     #203#0 = #200#0;
     |LEE 000#203=;

     |DDEFECTO #206;
     #206#0 = #200#87;
     |LEE 000#206=;

     |HAZ cta_cotizacion;
     #0#117 = cta_co;
|FPRC;

|DEFBUCLE dsmow019_portc2;
     #100#1;
     ;
     00000, "            ", 0000, " ", "  ";
     99999, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, ordena, NULL, NULL, NULL, Imprime;
     #100#0, #100#99, #100#72;
|FIN;

|DEFBUCLE dsmow019_pornom;
     #100#1;
     ;
     00000, "            ", 0000, " ", "  ";
     99999, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, NULL, NULL, NULL, NULL, Imprime;
     #100#0, #100#5, #100#99, #100#72;
|FIN;

|DEFBUCLE dsmow019_porcod;
     #100#1;
     ;
     00000, "            ", 0000, " ", "  ";
     99999, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, NULL, NULL, NULL, NULL, Imprime;
     #100#0, #100#72;
|FIN;

|DEFBUCLE dsmow019_pornif;
     #100#1;
     ;
     00000, "            ", 0000, " ", "  ";
     99999, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, Imprime;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |MENAV "0000 Recuerde seleccionar el papel de la impresora en Horizontal";

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "dsmoy019";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     aFichero = ("19" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #100 aFichero;
     |ABRE #100;  |CIERRA #100;  |DELINDEX #100;

     nDPeriodo = #0#118;
     nHPeriodo = #0#0;
     aEjer     = #0#2;
     aEjer     = aEjer % -102;
     nEjer     = aEjer;

     aAlfa1 = #0#2;
     aAlfa2 = #0#118; |QBF aAlfa2; aAlfa2 = ("00" + aAlfa2) % -102;
     aAlfa1 = "01."+ aAlfa2 + "." + aAlfa1; fFecIni = aAlfa1;

     aAlfa1 = #0#2;
     aAlfa2 = #0#0; |QBF aAlfa2; aAlfa2 = ("00" + aAlfa2) % -102;
     aAlfa3 = "31.";
     |SI #0#0 = 4; |O #0#0 = 6; |O #0##0 = 9; #0#0 = 11;  aAlfa3 = "30.";  |FINSI;
     |SI #0#0 = 2;
         aAlfa3 = "28."; nNume1 = #0#2 / 4; nNume2 = (#0#2/4) ! 0;
         |SI nNume1 = nNume2; aAlfa3 = "29."; |FINSI;
     |FINSI;
     aAlfa1 = aAlfa3 + aAlfa2 + "." + aAlfa1; fFecFin = aAlfa1;

     |ABRE #100;
     |ABRE #200;
     |ABRE #203;
     |ABRE #204;
     |ABRE #206;

     |ABRET #26;
     |SI #0#3 ! 0;
         |BUCLE agifigen;
         |BUCLE agifigen_110;
         || ... |BUCLE dsmoc110;
     |SINO;
         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo ! 0;
                   #0#3 = #0nCampo;
                   #0#4 = #0nCampo;
                   |BUCLE agifigen;
                   |BUCLE agifigen_110;
                   || ... |BUCLE dsmoc110;
               |FINSI;
         |SIGUE;
     |FINSI;
     |CIERRAT #26;
     |CIERRA #100;
     |CIERRA #200;
     |CIERRA #203;
     |CIERRA #204;
     |CIERRA #206;

     nEmpresa = 0;
     |PDEFECTO #0, 26,117;


     |SI #0#22 = 1; |BUCLE dsmow019_porcod; |FINSI;
     |SI #0#22 = 2; |BUCLE dsmow019_pornom; |FINSI;
     |SI #0#22 = 3; |BUCLE dsmow019_portc2; |FINSI;
     |SI #0#22 = 4; |BUCLE dsmow019_pornif; |FINSI;

     |SI nEmpresa ! 0;  |PIEINF;  |FINSI;
     |FININF;
     |FINIMP;

     |DELINDEX #100;
|FPRC;

|PROGRAMA;
     |DBASS aBase;  |QBF aBase;
     aPathLaboral = aBase + "laboral/def/nomhicca.mas";
     |XABRE "E", aPathLaboral, nHandle;
     |SI FSalida < 0;
         |MENAV "    No existe la Gestion Laboral. ....";
         |ACABA;
     |FINSI;

     aPathLaboral = aBase + "laboral/fich/";
     |PATH_DAT #201 aPathLaboral;
     |PATH_DAT #202 aPathLaboral;
     |PATH_DAT #204 aPathLaboral;
     |PATH_DAT #206 aPathLaboral;
     |PATH_DAT #215 aPathLaboral;

     |MANTE #0;
|FPRO;
