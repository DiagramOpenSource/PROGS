|FICHEROS;
     dsmoz007 #0;
     dsmom004 #4;
     dsmom101 #101;
     dsmom102 #102;
     dsmod045 #45;
     dsmod309 #309;

     :/basica/def/agitab99 #99;

     dsmow018 #999;

     &clientes@ #715;
|FIN;

|VARIABLES;
     nChequeo = 0;
     nAnyo    = 0;
     nMes     = 0;

     nSwPlan  = 0;
     &enEmpresa = 0;
     &enPeriodo = 0;
     &enEjer    = 0;
|FIN;

|INCLUYE i_varemi;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO Modelo;
     |SI eaParametro = "311";  |O eaParametro = "311C";
      |O eaParametro = "371";  |O eaParametro = "371C";
         |ACABA;
     |FINSI;

     |ABRE #99;
     #99#0 = #0#0;
     |LEE 040#99=;
     |SI FSalida ! 0;  |DDEFECTO #99;  |FINSI;
     |CIERRA #99;

     |SI #99#4 = "N";
         |SI #99#0 ! 180;  |Y #99#0 ! 190;  |Y #99#0 ! 390;  |Y #99#0 ! 193;
          |Y #99#0 ! 184;  |Y #99#0 ! 296;
             |MENAV "     Modelo sin Activar.";
             |ERROR;
         |FINSI;
     |FINSI;

     #0#4 = 0;
     |SI #0#0 = 180;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 184;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 190;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 193;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 296;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 390;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 392;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 347;  #0#4 = 99;  |FINSI;

     |SI #0#4 = 99;
         |C_M #0#4, 1, "N";
         |PINTA #0#4;
         |HAZ Periodo;
     |SINO;
         fFecha = ~;
         aAlfa  = fFecha % 402;   nMes  = aAlfa;
         aAlfa  = fFecha % -104;  nAnyo = aAlfa;
         |SI #99#5 = "T";  |O #99#5 = "C";
             |SI nMes [ 3;
                 #0#4 = 4;
                 #0#6 = nAnyo - 1;
                 |HAZ Periodo;
                 |PINTA #0#4;
                 |PINTA #0#6;
                 |ACABA;
             |FINSI;

             |SI nMes [ 6;
                 #0#4 = 3;
                 #0#6 = nAnyo;
                 |HAZ Periodo;
                 |PINTA #0#4;
                 |PINTA #0#6;
                 |ACABA;
             |FINSI;

             |SI nMes [ 9;
                 #0#4 = 6;
                 #0#6 = nAnyo;
                 |HAZ Periodo;
                 |PINTA #0#4;
                 |PINTA #0#6;
                 |ACABA;
             |FINSI;

             |SI nMes [ 12;
                 #0#4 = 9;
                 #0#6 = nAnyo;
                 |HAZ Periodo;
                 |PINTA #0#4;
                 |PINTA #0#6;
                 |ACABA;
             |FINSI;
         |FINSI;

         |SI #99#5 = "A";
             #0#4 = 99;
             #0#6 = nAnyo - 1;
             |HAZ Periodo;
             |PINTA #0#4;
             |PINTA #0#6;
         |FINSI;

         |SI #99#5 = "M";
             |SI nMes = 1;
                 #0#4 = 12;
                 #0#6 = nAnyo - 1;
                 |HAZ Periodo;
             |SINO;
                 #0#4 = nMes - 1;
                 #0#6 = nAnyo;
                 |HAZ Periodo;
             |FINSI;
             |PINTA #0#4;
             |PINTA #0#6;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Periodo;
     |SI #0#4 = 1;   #0#5 = "ENERO     ";  |FINSI;
     |SI #0#4 = 2;   #0#5 = "FEBRERO   ";  |FINSI;
     |SI #0#4 = 3;   #0#5 = "MARZO     ";  |FINSI;
     |SI #0#4 = 4;   #0#5 = "ABRIL     ";  |FINSI;
     |SI #0#4 = 5;   #0#5 = "MAYO      ";  |FINSI;
     |SI #0#4 = 6;   #0#5 = "JUNIO     ";  |FINSI;
     |SI #0#4 = 7;   #0#5 = "JULIO     ";  |FINSI;
     |SI #0#4 = 8;   #0#5 = "AGOSTO    ";  |FINSI;
     |SI #0#4 = 9;   #0#5 = "SEPTIEMBRE";  |FINSI;
     |SI #0#4 = 10;  #0#5 = "OCTUBRE   ";  |FINSI;
     |SI #0#4 = 11;  #0#5 = "NOVIEMBRE ";  |FINSI;
     |SI #0#4 = 12;  #0#5 = "DICIEMBRE ";  |FINSI;
     |SI #0#4 = 99;  #0#5 = "ANUAL     ";  |FINSI;

     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#6   = aAlfa;

     |PINTA #0#5;
     |PINTA #0#6;
|FPRC;

|PROCESO Desarchivar;
     |C_M #0#7, 1, "S";
     |SI #0#8 = "D";
         |C_M #0#7, 1, "N";
         #0#7 = "01.01.0000";  |PINTA #0#7;
     |FINSI;
|FPRC;

|PROCESO Planillas;
     |C_M #0#36, 1, "S";

     #0#10 = 1;      |PINTA #0#10;  |C_M #0#10, 1, "N";
     #0#11 = 99999;  |PINTA #0#11;  |C_M #0#11, 1, "N";
     |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
          |C_M #0nCampo, 1, "N";
     |SIGUE;
|FPRC;

|PROCESO Parrilla;
     #0#10 = 1;      |PINTA #0#10;  |C_M #0#10, 1, "N";
     #0#11 = 99999;  |PINTA #0#11;  |C_M #0#11, 1, "N";
     #0#36 = 0;  |PINTA #0#36;  |C_M #0#36, 1, "N";
     |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
          |C_M #0nCampo, 1, "S";
     |SIGUE;
|FPRC;

|PROCESO DesdeHasta;
     |C_M #0#10, 1, "S";
     |C_M #0#11, 1, "S";
     #0#36 = 0;  |PINTA #0#36;  |C_M #0#36, 1, "N";

     |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "N";
           #0nCampo = 0;  |PINTA #0nCampo;
     |SIGUE;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO BotonParrilla;
     |CONTROL_SIMPLE 0, "LBOTON,F2 Seleccion Empresas Desde-Hasta", 2007, 2039, Boton1;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3 Seleccion Empresas Parrilla   ", 2107, 2139, Boton2;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F4 Seleccion por Planillas       ", 2207, 2239, Boton3;
     nBoton3 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  |HAZ DesdeHasta;  |SAL;  |FINSI;
         |SI aTecla = aF3;  |HAZ Parrilla;    |SAL;  |FINSI;
         |SI aTecla = aF4;  |HAZ Planillas;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;

     |PULSATECLA;
|FPRC;

|PROCESO MiraPlanilla;  |TIPO 0;
     |SI #0#36 = 0;  |ACABA;  |FINSI;

     |ABRE #101;
     #101#0 = #0#36;
     |LEE 040#101=;
     |SI FSalida ! 0;
         |MENAV "     Registro de Planilla Inexistente.";
         |ERROR;
     |FINSI;
     |CIERRA #101;
|FPRC;

|PROCESO GrabaTempo;
     nSwEsta = 1;

     |SI #0#36 ! 0;
         nSwEsta = 0;
         |ABRE #102;
         #102#0 = #0#36;
         #102#1 = #4#0;
         |LEE 040#102=;
         |SI FSalida = 0;
             nSwEsta = 1;
         |FINSI;
         |CIERRA #102;
     |FINSI;

     |SI #0#12 ! 0;
         nSwEsta = 0;
         |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo = #4#0;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;  |ACABA;  |FINSI;

     enCodCli = #4#0;
     |HAZ LeePersona;

     #999#0  = #4#0;
     #999#7  = #4#4;
     |LEE 101#999=;
     |SI FSalida ! 0;
         |DDEFECTO #999;
         #999#0  = #4#0;
         #999#7  = #4#4;
         |GRABA 020#999b;
     |FINSI;

     #999#1  = #4#1;
     #999#2  = #4#2;
     #999#3  = #715#1;
     #999#4  = #0#5;
     #999#5  = #0#0;
     #999#6  = "S";
     #999#7  = #4#4;
     |GRABA 020#999a;
     |LIBERA #999;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE dsmom004;
     #4#1;
     7, 9, 13;
     #0#10, #0#6, #0#4, #0#0, 00, "X", "X", aArchivo;
     #0#11, #0#6, #0#4, #0#0, 99, "X", "X", aArchivo;
     ;
     NULL, GrabaTempo;
|FIN;

|PROCESO GrabaTempo309;
     |SI nChequeo = 1;
         |SI #0#8 = "D";
             #309#16 = "";
             #309#17 = "01.01.0000";
         |SINO;
             #309#16 = "X";
             #309#17 = #0#7;
         |FINSI;
         |GRABA 020#309a;
         |LIBERA #309;

         |ACABA;
     |FINSI;

     nSwEsta = 1;

     |SI #0#36 ! 0;
         nSwEsta = 0;
         |ABRE #102;
         #102#0 = #0#36;
         #102#1 = #309#0;
         |LEE 040#102=;
         |SI FSalida = 0;
             nSwEsta = 1;
         |FINSI;
         |CIERRA #102;
     |FINSI;

     |SI #0#12 ! 0;
         nSwEsta = 0;
         |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo = #309#0;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;  |ACABA;  |FINSI;

     enCodCli = #309#0;
     |HAZ LeePersona;

     #999#0  = #309#0;
     #999#7  = #309#4;
     |LEE 101#999=;
     |SI FSalida ! 0;
         |DDEFECTO #999;
         #999#0  = #309#0;
         #999#7  = #309#4;
         |GRABA 020#999b;
     |FINSI;

     #999#1  = #309#2;
     #999#2  = #309#3;
     #999#3  = #715#1;
     #999#4  = #0#5;
     #999#5  = #0#0;
     #999#6  = "S";
     #999#7  = #309#4;
     |GRABA 020#999a;
     |LIBERA #999;

     nSwGraba = 1;

     |LIBERA #309;
|FPRC;

|DEFBUCLE dsmod309;
     #309#1;
     9, 11, 16;
     #0#10, 01, #0#6, #0#4, 00, 01, "X", "X", aArchivo;
     #0#11, 98, #0#6, #0#4, 99, 99, "X", "X", aArchivo;
     be;
     NULL, GrabaTempo309;
|FIN;

|PROCESO GrabaTempo045;
     |SI nChequeo = 1;
         |SI #0#8 = "D";
             #45#16 = "";
             #45#17 = "01.01.0000";
         |SINO;
             #45#16 = "X";
             #45#17 = #0#7;
         |FINSI;
         |GRABA 020#45a;
         |LIBERA #45;

         |ACABA;
     |FINSI;

     nSwEsta = 1;

     |SI #0#36 ! 0;
         nSwEsta = 0;
         |ABRE #102;
         #102#0 = #0#36;
         #102#1 = #45#0;
         |LEE 040#102=;
         |SI FSalida = 0;
             nSwEsta = 1;
         |FINSI;
         |CIERRA #102;
     |FINSI;

     |SI #0#12 ! 0;
         nSwEsta = 0;
         |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo = #45#0;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;  |ACABA;  |FINSI;

     enCodCli = #45#0;
     |HAZ LeePersona;

     #999#0  = #45#0;
     #999#7  = #45#4;
     |LEE 101#999=;
     |SI FSalida ! 0;
         |DDEFECTO #999;
         #999#0  = #45#0;
         #999#7  = #45#4;
         |GRABA 020#999b;
     |FINSI;

     #999#1  = #45#2;
     #999#2  = #45#3;
     #999#3  = #715#1;
     #999#4  = #0#5;
     #999#5  = #0#0;
     #999#6  = "S";
     #999#7  = #45#4;
     |GRABA 020#999a;
     |LIBERA #999;

     nSwGraba = 1;

     |LIBERA #45;
|FPRC;

|DEFBUCLE dsmod045;
     #045#1;
     9, 11, 16;
     #0#10, 00001, #0#6, #0#4, 00, "X", "X", aArchivo;
     #0#11, 99999, #0#6, #0#4, 99, "X", "X", aArchivo;
     be;
     NULL, GrabaTempo045;
|FIN;

|RUTINA ClaveBaja999;
     #999#0 = 1;
     #999#7 = 00;
|FRUT;

|RUTINA ClaveAlta999;
     #999#0 = 99999;
     #999#7 = 99;
|FRUT;

|PROCESO GrabaArchivo;
     |SI #999#5 ! 309; |Y #999#5 ! 45;
         #4#0 = #999#0;
         #4#1 = #999#1;
         #4#2 = #999#2;
         #4#3 = #999#5;
         #4#4 = #999#7;
         |LEE 101#4=;
         |SI FSalida = 0;
             |SI #0#8 = "D";
                 #4#13 = "";
                 #4#14 = "01.01.0000";
             |SINO;
                 #4#13 = "X";
                 #4#14 = #0#7;
             |FINSI;
             |GRABA 020#4a;
             |LIBERA #4;
         |FINSI;
     |SINO;
         |SI #0#0 = 309; nChequeo = 1;  |BUCLE dsmod309; |FINSI;
         |SI #0#0 = 45;  nChequeo = 1;  |BUCLE dsmod045; |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmow014M;
     #999#1;
     6;
     00000, 00, "S";
     99999, 99, "S";
     ;
     NULL, GrabaArchivo;
|FIN;

|PROCESO MiraCuantos;
     enSwHay = enSwHay + 1;
|FPRC;

|DEFBUCLE dsmow014C;
     #999#1;
     6;
     00000, 00,"S";
     99999, 99, "S";
     ;
     NULL, MiraCuantos;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     aFichero = ("arc" + Usuario) % 108;
     |NOME_DAT #999 aFichero;
     |ABRE #999;  |CIERRA #999;  |DELINDEX #999;

     nSwGraba = 0;

     aArchivo = " ";
     |SI #0#8 = "D";  aArchivo = "X";  |FINSI;

     |ABRE #999;
     |SI #0#0 ! 309; |Y #0#0 ! 45;
         |BUCLE dsmom004;
     |SINO;
         |SI #0#0 = 309; nChequeo = 0;  |BUCLE dsmod309; |FINSI;
         |SI #0#0 = 045; nChequeo = 0;  |BUCLE dsmod045; |FINSI;
     |FINSI;
     |CIERRA #999;

     |SI nSwGraba = 1;
         |SI nSwPlan = 0;
             |HAZ PonBoton;
             |ENTLINEAL #1#999, -1, 4, 22, 1, ClaveBaja999, ClaveAlta999;
             |HAZ QuitaBoton;
         |FINSI;

         enSwHay = 0;
         |BUCLE dsmow014C;
     |SINO;
         |MENAV "     Seleccion Vacia.";
         |DELINDEX #999;
         |ACABA;
     |FINSI;

     |SI enSwHay = 0;
         |MENAV "      Seleccion Vacia";
     |SINO;
         |ABRE #4;
         |BUCLE dsmow014M;
         |CIERRA #4;
     |FINSI;

     |DELINDEX #999;
|FPRC;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROCESO Boton2;
     |PTEC 825;
|FPRC;

|PROCESO Boton3;
     |PTEC 826;
|FPRC;

|PROGRAMA;
     eaParametro = PARAMETRO;  |QBF eaParametro;
     |SI eaParametro ! "";

         nSwPlan = 0;
         aAlfa   = eaParametro - "PLANING";
         |SI aAlfa ! eaParametro;
             nSwPlan = 1;
             eaParametro = aAlfa;
         |FINSI;

         |DDEFECTO #0;

         aAlfa = eaParametro % 103;
         #0#0  = aAlfa;
         |SI eaParametro = "311";  |O eaParametro = "311C";
             #0#0 = "310";
             #0#4 = "12";
             |C_M #0#4, 1, "N";
         |FINSI;

         |SI eaParametro = "371";  |O eaParametro = "371C";
             #0#0 = "370";
             #0#4 = "12";
             |C_M #0#4, 1, "N";
         |FINSI;

         |C_M #0#0, 1, "N";
         |SI nSwPlan = 0;
             |PINPA #0#0;
             |PINDA #0#0;
             |ENDATOS #1#0;
         |SINO;

              #0#4  = enPeriodo;
              #0#6  = enEjer;
              #0#8  = "A";
              #0#10 = enEmpresa;
              #0#11 = enEmpresa;

              |PUSHV 0501 2380;
              |BLANCO 1025 1240;
              |ATRI R;
              |PINTA 1026, " FECHA ARCHIVO ";
              |ATRI r;
              |CUADRO 0925 1240;

              fFecha = ~;
              fFecha = 1128 ? 1;

              #0#7 = fFecha;

              |POPV;

              |HAZ Tipo3;
              |ACABA;
         |FINSI;

     |SINO;

         |MANTE #0;

     |FINSI;

     |PULSATECLA;
|FPRO;
