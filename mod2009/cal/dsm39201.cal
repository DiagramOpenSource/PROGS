|FICHEROS;
     dsm39201 #1;
     dsm39202 #2;
     dsm39203 #3;
     dsm39204 #4,MANTE;
     dsmow066 #166;
     dsmow068 #168;

     dsmom004 #104;
     dsmom103 #103;
     dsmod320 #320;
     dsmod332 #332;

     dsmom007 #7;

     :/basica/def/agicen14 #100;
|FIN;

|VARIABLES;
     nCampo     = 0;
     nCampo1    = 0;
     nCampo2    = 0;
     nCampo3    = 0;
     nSwChequea = 0;
     nBorra     = 0;
     nComp      = 0;
     nBoton1    = -1;
     nBoton2    = -1;
     nBoton3    = -1;
     nBoton4    = -1;
     nBoton5    = -1;
     nBoton6    = -1;
     nBoton7    = -1;
     nBoton8    = -1;
     nBoton9    = -1;
     nValor     = -1;
     nValor2    = -1;
     nTecla     = -1;
     nCompensar = 0;
     nAnyo      = 0;
     nSwHay     = 0;
     nGrupo     = 0;
     nModo      = 0;

     aTecla     = "";
     aAlfa      = "";
     aEsc1      = "";
     aEsc2      = "";
     aRetu      = "";
     aF2        = "";
     aF3        = "";
     aF4        = "";
     aF5        = "";
     aF6        = "";
     aF7        = "";
     aF8        = "";
     aF9        = "";

     nOtro      = 0;
     nElUltim   = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO PulsaF2;
     |PTEC 824;
|FPRC;

|PROCESO PulsaF3;
     |PTEC 825;
|FPRC;

|PROCESO PulsaF4;
     |PTEC 826;
|FPRC;

|PROCESO PulsaF5;
     |PTEC 827;
|FPRC;

|PROCESO PulsaF6;
     |PTEC 828;
|FPRC;

|PROCESO PulsaF7;
     |PTEC 829;
|FPRC;

|PROCESO PulsaF8;
     |PTEC 830;
|FPRC;

|PROCESO PulsaF9;
     |PTEC 831;
|FPRC;

|PROCESO DesapareceBotones;
     |SI nBoton1 ! -1;  |ESTADO_CONTROL nBoton1, "HIDE";  |FINSI;
     |SI nBoton2 ! -1;  |ESTADO_CONTROL nBoton2, "HIDE";  |FINSI;
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "HIDE";  |FINSI;
     |SI nBoton4 ! -1;  |ESTADO_CONTROL nBoton4, "HIDE";  |FINSI;
     |SI nBoton5 ! -1;  |ESTADO_CONTROL nBoton5, "HIDE";  |FINSI;
     |SI nBoton6 ! -1;  |ESTADO_CONTROL nBoton6, "HIDE";  |FINSI;
     |SI nBoton7 ! -1;  |ESTADO_CONTROL nBoton7, "HIDE";  |FINSI;
     |SI nBoton8 ! -1;  |ESTADO_CONTROL nBoton8, "HIDE";  |FINSI;
     |SI nBoton9 ! -1;  |ESTADO_CONTROL nBoton9, "HIDE";  |FINSI;
|FPRC;

|PROCESO ApareceBotones;
     |SI nBoton1 ! -1;  |ESTADO_CONTROL nBoton1, "SHOW";  |FINSI;
     |SI nBoton2 ! -1;  |ESTADO_CONTROL nBoton2, "SHOW";  |FINSI;
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "SHOW";  |FINSI;
     |SI nBoton4 ! -1;  |ESTADO_CONTROL nBoton4, "SHOW";  |FINSI;
     |SI nBoton5 ! -1;  |ESTADO_CONTROL nBoton5, "SHOW";  |FINSI;
     |SI nBoton6 ! -1;  |ESTADO_CONTROL nBoton6, "SHOW";  |FINSI;
     |SI nBoton7 ! -1;  |ESTADO_CONTROL nBoton7, "SHOW";  |FINSI;
     |SI nBoton8 ! -1;  |ESTADO_CONTROL nBoton8, "SHOW";  |FINSI;
     |SI nBoton9 ! -1;  |ESTADO_CONTROL nBoton9, "SHOW";  |FINSI;
|FPRC;

|PROCESO QuitaBotones;
     |SI nBoton1 ! -1;  |FIN_CONTROL_WINDOWS nBoton1;  nBoton1 = -1;  |FINSI;
     |SI nBoton2 ! -1;  |FIN_CONTROL_WINDOWS nBoton2;  nBoton2 = -1;  |FINSI;
     |SI nBoton3 ! -1;  |FIN_CONTROL_WINDOWS nBoton3;  nBoton3 = -1;  |FINSI;
     |SI nBoton4 ! -1;  |FIN_CONTROL_WINDOWS nBoton4;  nBoton4 = -1;  |FINSI;
     |SI nBoton5 ! -1;  |FIN_CONTROL_WINDOWS nBoton5;  nBoton5 = -1;  |FINSI;
     |SI nBoton6 ! -1;  |FIN_CONTROL_WINDOWS nBoton6;  nBoton6 = -1;  |FINSI;
     |SI nBoton7 ! -1;  |FIN_CONTROL_WINDOWS nBoton7;  nBoton7 = -1;  |FINSI;
     |SI nBoton8 ! -1;  |FIN_CONTROL_WINDOWS nBoton8;  nBoton8 = -1;  |FINSI;
     |SI nBoton9 ! -1;  |FIN_CONTROL_WINDOWS nBoton9;  nBoton9 = -1;  |FINSI;

     |PULSATECLA;
|FPRC;

|RUTINA ClaveBaja2Gnral;
     #2#0  = #1#0;
     #2#1  = #1#1;
     #2#2  = #1#2;
     #2#3  = #1#3;
     #2#24 = 0;
     #2#25 = 0;
|FRUT;

|RUTINA ClaveAlta2Gnral;
     #2#0  = #1#0;
     #2#1  = #1#1;
     #2#2  = #1#2;
     #2#3  = #1#3;
     #2#24 = 2;
     #2#25 = 99;
|FRUT;

|PROCESO FuncionF2;
     |HAZ DesapareceBotones;

     |PUSHV 0401 2380;
     |ENTLINEAL #2#2, -6, 4, 22, 1, ClaveBaja2Gnral, ClaveAlta2Gnral;
     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF3aF5;
     |HAZ DesapareceBotones;

     |PUSHV 0501 2380;

     |ABRE #3;
     #3#0 = #1#0;
     #3#1 = #1#1;
     #3#2 = #1#2;
     #3#3 = #1#3;
     #3#4 = nGrupo;
     |LEE 101#3=;
     |SI FSalida ! 0;
         |DDEFECTO #3;
         #3#0 = #1#0;
         #3#1 = #1#1;
         #3#2 = #1#2;
         #3#3 = #1#3;
         #3#4 = nGrupo;
         |GRABA 020#3b;
     |FINSI;

     |PINPA #0#3;
     |PINDA #0#3;
     |SI nModo ! 4;
         |ENDATOS #1#3;
         |SI FSalida = 0;
             |GRABA 020#3a;
         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;
     |LIBERA #3;
     |CIERRA #3;

     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF6;
     |HAZ DesapareceBotones;
     |PUSHV 0501 2380;

     #1#13   = #1#4;
     #1#20   = #1#4;

     #166#0  = #1#13;
     #166#1  = #1#14;
     #166#2  = #1#5;
     #166#3  = #1#15;
     #166#4  = #1#16;
     #166#5  = #1#17;
     #166#6  = #1#18;
     #166#7  = #1#19;
     #166#8  = #1#20;
     #166#9  = #1#21;
     #166#10 = #1#22;
     #166#11 = #1#6;
     #166#12 = #1#7;
     #166#13 = #1#8;
     #166#14 = #1#9;
     #166#15 = #1#10;

     |PINPA #0#166;
     |PINDA #0#166;

     |SI nModo ! 4;
         |ENDATOS #1#166;
         |SI FSalida = 0;
             #1#13 = #166#0;
             #1#14 = #166#1;
             #1#15 = #166#3;
             #1#16 = #166#4;
             #1#17 = #166#5;
             #1#18 = #166#6;
             #1#19 = #166#7;
             #1#20 = #166#8;
             #1#21 = #166#9;
             #1#22 = #166#10;
             #1#7  = #166#12;
             #1#8  = #166#13;
             #1#9  = #166#14;
             #1#10 = #166#15;
         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;

     |POPV;
     |HAZ ApareceBotones;
|FPRC;

|RUTINA ClaveBaja2Oper;
     #2#0  = #1#0;
     #2#1  = #1#1;
     #2#2  = #1#2;
     #2#3  = #1#3;
     #2#24 = 3;
     #2#25 = 0;
|FRUT;

|RUTINA ClaveAlta2Oper;
     #2#0  = #1#0;
     #2#1  = #1#1;
     #2#2  = #1#2;
     #2#3  = #1#3;
     #2#24 = 4;
     #2#25 = 99;
|FRUT;

|PROCESO FuncionF7;
     |HAZ DesapareceBotones;

     |PUSHV 0401 2380;
     |ENTLINEAL #2#2, -6, 4, 22, 1, ClaveBaja2Oper, ClaveAlta2Oper;
     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF8;
     |HAZ DesapareceBotones;

     |PUSHV 0501 2380;

     |PARA nCampo1 = 23;  |SI nCampo1 [ 53;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 - 23;

           #168nCampo2 = #1nCampo1;
     |SIGUE;

     |PINPA #0#168;
     |PINDA #0#168;
     |SI nModo ! 4;
         |ENDATOS #1#168;
         |SI FSalida = 0;
             |PARA nCampo1 = 23;  |SI nCampo1 [ 53;  |HACIENDO nCampo1 = nCampo1 + 1;
                   nCampo2   = nCampo1 - 23;
                   #1nCampo1 = #168nCampo2;
             |SIGUE;
         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;

     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|RUTINA ClaveBaja4;
     #4#0 = #1#0;
     #4#1 = #1#1;
     #4#2 = #1#2;
     #4#3 = #1#3;
     #4#4 = 1;
|FRUT;

|RUTINA ClaveAlta4;
     #4#0 = #1#0;
     #4#1 = #1#1;
     #4#2 = #1#2;
     #4#3 = #1#3;
     #4#4 = 99;
|FRUT;


|PROCESO NoB_Cnae2;
      |SI FSalida = 2; |ACABA; |FINSI;
      |SI  #4#6 = "    "; |Y #4#10 ! 100; |Y #4#10 ! 0;
           |MENAV "    Error. Informe CNAE de la Actividad";
           |PTEC 808; |PTEC 808;
           |PTEC 808; |PTEC 808;
           |ERROR;
      |FINSI;
|FPRC;

|PROCESO FuncionF9;
     |HAZ DesapareceBotones;

     |PUSHV 0401 2380;
     |ENTLINEAL #1#4, -5, nModo, 22, 1, ClaveBaja4, ClaveAlta4;
     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO BotonGeneral;  |TIPO 7;
     |CONTROL_SIMPLE 0, "BOTON,F2 Reg.General", 0826, 0840, PulsaF2;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F3 Grupo 1", 0842, 0852, PulsaF3;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F4 Grupo 2", 0854, 0864, PulsaF4;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F5 Grupo 3", 0866, 0876, PulsaF5;
     nBoton5 = FSalida;
|FPRC;

|PROCESO SacaGeneral;
     nTecla = FSalida;

     |SI nTecla ! 10;  |Y  nTecla ! 11;  |Y  nTecla ! 12;  |Y  nTecla ! 13;
      |Y nTecla ! 16;  |Y  nTecla ! 17;
         |SI nBoton2 ! -1;  |FIN_CONTROL_WINDOWS nBoton2;  nBoton2 = -1;  |FINSI;
         |SI nBoton3 ! -1;  |FIN_CONTROL_WINDOWS nBoton3;  nBoton3 = -1;  |FINSI;
         |SI nBoton4 ! -1;  |FIN_CONTROL_WINDOWS nBoton4;  nBoton4 = -1;  |FINSI;
         |SI nBoton5 ! -1;  |FIN_CONTROL_WINDOWS nBoton5;  nBoton5 = -1;  |FINSI;
         |PULSATECLA;

         FSalida = 0;
     |FINSI;

     |SI nTecla = 10;
         |HAZ FuncionF2;
         |ERROR;
     |FINSI;

     |SI nTecla = 11;
         nGrupo = 1;
         |HAZ FuncionF3aF5;
         |ERROR;
     |FINSI;

     |SI nTecla = 12;
         nGrupo = 2;
         |HAZ FuncionF3aF5;
         |ERROR;
     |FINSI;

     |SI nTecla = 13;
         nGrupo = 3;
         |HAZ FuncionF3aF5;
         |ERROR;
     |FINSI;

     |SI nTecla = 16;
         |HAZ FuncionF8;
         |ERROR;
     |FINSI;

     |SI nTecla = 17;
         |HAZ FuncionF9;
         |ERROR;
     |FINSI;

     nValor2 = 0;

     |ABRE #2;
     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = #1#2;
     #2#3 = #1#3;
     #2#4 = 1;
     #2#5 = 13;
     |SELECT #1#2;
     |LEE 040#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     nValor = #2#11;

     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = #1#2;
     #2#3 = #1#3;
     #2#4 = 2;
     |SI #1#1 [ 2007;  #2#5 = 12;  |FINSI;
     |SI #1#1 ] 2008;  #2#5 = 13;  |FINSI;
     |SELECT #1#2;
     |LEE 040#2=;
     |SI FSalida = 0;
         nValor2 = #2#11;
     |FINSI;

     nValor = nValor - nValor2;

     |CIERRA #2;

     #1#4 = nValor;

     |SI enTipoEntrada ! 95;  |PINTA #1#4;  |FINSI;
|FPRC;

|PROCESO BotonResultados;  |TIPO 7;
     |CONTROL_SIMPLE 0, "BOTON,F6 Resultados", 0826, 0840, PulsaF6;
     nBoton6 = FSalida;
|FPRC;

|PROCESO RecogeAnterior;
     nCompensar = nCompensar + #103#5;
     nSwHay     = 1;
|FPRC;

|DEFBUCLE dsmom103;
     #103#1;
     ;
     000, #1#0, 00, nAnyo, 12;
     999, #1#0, 99, nAnyo, 12;
     ;
     NULL, RecogeAnterior;
|FIN;

|PROCESO LeeComp332;
    nElUltim = #332#67;
    nSwHay   = 1;
|FPRC;

|DEFBUCLE LeeComp332;
 #332#1;
 ;
 #1#0, nOtro, 12, 332, 00, 0;
 #1#0, nOtro, 12, 332, 99, 0;
 e;
 NULL, LeeComp332;
|FIN;

|PROCESO LeeComp320;
    nElUltim = #320#65;
    nSwHay   = 1;
|FPRC;

|DEFBUCLE LeeComp320;
 #320#1;
 ;
 #1#0, nOtro, 12, 320, 00, 0;
 #1#0, nOtro, 12, 320, 99, 0;
 e;
 NULL, LeeComp320;
|FIN;

|PROCESO Compensacion;
     nCompensar = 0;
     nSwHay     = 0;

     nOtro    = #1#1 - 1;
     nElUltim = 0;
     |BUCLE LeeComp320;
     nCompensar = nCompensar + nElUltim;

     nElUltim = 0;
     |BUCLE LeeComp332;
     nCompensar = nCompensar + nElUltim;

     |SI nCompensar = 0;
         nAnyo = #1#1 - 1;
         |BUCLE dsmom103;
     |FINSI;

     |SI nCompensar ! 0;  |ACABA;  |FINSI;
     |SI nSwHay     = 1;  |ACABA;  |FINSI;

     |ABRE #320;
     #320#0 = #1#0;
     #320#1 = #1#1;
     #320#2 = 1;
     #320#3 = 320;
     #320#4 = 0;
     #320#5 = 0;
     |LEE 040#332=;
     |SI FSalida = 0;
         nCompensar = nCompensar + #332#59;
     |FINSI;
     |CIERRA #320;

     |ABRE #332;
     #332#0 = #1#0;
     #332#1 = #1#1;
     #332#2 = 1;
     #332#3 = 332;
     #332#4 = 0;
     #332#5 = 0;
     |LEE 040#332=;
     |SI FSalida = 0;
         nCompensar = nCompensar + #332#59;
     |FINSI;
     |CIERRA #332;
|FPRC;

|PROCESO SacaResultados;
     nTecla = FSalida;

     |SI #1#14 = 0;  |Y #1#22 = 0;
         |HAZ Compensacion;
         #1#14 = nCompensar;
         #1#22 = nCompensar;
     |FINSI;

     |SI nTecla = 14;
         |HAZ FuncionF6;

         |ERROR;
     |FINSI;

     |SI nTecla = 16;
         |HAZ FuncionF8;
     |FINSI;

     |SI nTecla = 17;
         |HAZ FuncionF9;
     |FINSI;

     |SI nTecla ! 14;  |Y nTecla ! 16;  |Y nTecla ! 17;
         |FIN_CONTROL_WINDOWS nBoton6;  nBoton6 = -1;
         |PULSATECLA;
     |FINSI;

     |SI #1#15 ! 0;
         #1#20  = #1#4;
         #1#6   = #1#21 - #1#22;

         #1#13  = 0;
         #1#14  = 0;
         #1#5   = 0;
     |SINO;
         #1#13  = #1#4;
         #1#5   = #1#13 - #1#14;

         #1#20  = 0;
         #1#21  = 0;
         #1#22  = 0;
         #1#6   = 0;
     |FINSI;

     |SI enTipoEntrada ! 95;
         |PINTA #1#5;
         |PINTA #1#6;
         |PINTA #1#7;
         |PINTA #1#8;
         |PINTA #1#9;
         |PINTA #1#10;
     |FINSI;
|FPRC;


|PROCESO BotonOperaciones;  |TIPO 7;
     |CONTROL_SIMPLE 0, "BOTON,F7 Operaciones", 0826, 0840, PulsaF7;
     nBoton7 = FSalida;
|FPRC;

|PROCESO SacaOperaciones;
     nTecla = FSalida;

     |SI nTecla = 15;
         |HAZ FuncionF7;
         |ERROR;
     |FINSI;

     |SI nTecla = 16;
         |HAZ FuncionF8;
         |ERROR;
     |FINSI;

     |SI nTecla = 17;
         |HAZ FuncionF9;
         |ERROR;
     |FINSI;

     |SI nTecla ! 15;   |Y nTecla ! 16;  |Y nTecla ! 17;
         |FIN_CONTROL_WINDOWS nBoton7;  nBoton7 = -1;
         |PULSATECLA;
     |FINSI;

     |ABRE #2;
     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = #1#2;
     #2#3 = #1#3;
     #2#4 = 3;
     #2#5 = 15;
     |SELECT #1#2;
     |LEE 040#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     nValor = #2#10;
     |CIERRA #2;

     #1#11 = nValor;
     |SI enTipoEntrada ! 95;
         |PINTA #1#11;
     |FINSI;
|FPRC;

|PROCESO Justificante;  |TIPO 7;
     |SI #1#3 = 0;
         #1#12 = "";  |PINTA #1#12;
         |C_M #1#12, 1, "N";
         |ACABA;
     |FINSI;
     |C_M #1#12, 1, "S";
|FPRC;

|PROCESO Tipo12m39201;  |TIPO 12;
|FPRC;

|PROCESO GrabaRegistro;
     |DDEFECTO #2;
     #2#0  = #1#0;
     #2#1  = #1#1;
     #2#2  = #1#2;
     #2#3  = #1#3;
     #2#4  = #7#0;
     #2#5  = #7#1;
     |LEE 101#2=;
     |SI FSalida ! 0;
         |DDEFECTO #2;
         #2#0  = #1#0;
         #2#1  = #1#1;
         #2#2  = #1#2;
         #2#3  = #1#3;
         #2#4  = #7#0;
         #2#5  = #7#1;

         |SI #7#0 = 5;  |Y #7#1 = 1;
             #2#10 = 100;
         |FINSI;

         |GRABA 020#2b;
     |FINSI;

     #2#6  = #7#2;
     #2#7  = #7#3;
     #2#9  = #7#5;

     |SI #2#4 = 1;  |Y #2#5 = 8;  |Y #1#1 ] 2007;
         #2#6 = "Mod.bases y cuotas concurso de acreedores ........";
     |FINSI;

     |SI #2#4 = 1;  |Y #2#5 = 12;  |Y #1#1 ] 2007;
         #2#6 = "Modificacion rec.equiv.concurso de acreedores ....";
     |FINSI;

     |SI #2#4 = 1;  |Y #2#5 = 4;  |Y #1#1 ] 2008;
         #2#6 = "Operaciones intragrupo ...........................";
     |FINSI;

     #2#24 = #7#0;
     #2#25 = #7#1;

     |SI #1#1 ] 2006;
         |SI #7#0 = 3;  |Y  #7#1 = 1;   #2#24 = 3;  #2#25 = 1;  |FINSI;
         |SI #7#0 = 3;  |Y  #7#1 = 9;   #2#24 = 3;  #2#25 = 2;  |FINSI;
         |SI #7#0 = 3;  |Y  #7#1 = 10;  #2#24 = 3;  #2#25 = 3;  |FINSI;
         |SI #7#0 = 3;  |Y  #7#1 = 11;  #2#24 = 3;  #2#25 = 4;  |FINSI;
         |SI #7#0 = 3;  |Y  #7#1 = 12;  #2#24 = 3;  #2#25 = 5;  |FINSI;
         |SI #7#0 = 4;  |Y  #7#1 = 5;   #2#24 = 3;  #2#25 = 6;  |FINSI;
         |SI #7#0 = 4;  |Y  #7#1 = 7;   #2#24 = 3;  #2#25 = 7;  |FINSI;
         |SI #7#0 = 3;  |Y  #7#1 = 8;   #2#24 = 3;  #2#25 = 8;  |FINSI;


         |SI #7#0 = 3;  |Y  #7#1 = 5;   #2#24 = 3;  #2#25 = 9;  |FINSI;
         |SI #7#0 = 3;  |Y  #7#1 = 6;   #2#24 = 3;  #2#25 = 10; |FINSI;
         |SI #7#0 = 3;  |Y  #7#1 = 13;  #2#24 = 3;  #2#25 = 13; |FINSI;
         |SI #7#0 = 3;  |Y  #7#1 = 14;  #2#24 = 3;  #2#25 = 14; |FINSI;
         |SI #7#0 = 3;  |Y  #7#1 = 15;  #2#24 = 3;  #2#25 = 15; |FINSI;
     |FINSI;

     |GRABA 020#2a;
     |LIBERA #2;
|FPRC;

|PROCESO dsmom007;
     |SI #7#4 = 1;  |ACABA;  |FINSI;

     |SI #1#1 ] 2006;
         |SI #7#0 = 3;  |Y  #7#1 = 4;   |ACABA;  |FINSI;
         |SI #7#0 = 3;  |Y  #7#1 = 7;   |ACABA;  |FINSI;
     |FINSI;

     |SI #7#0 = 2;  |Y #7#1 = 10;
         |SI #1#1 [ 2007;
             #7#2 = "      Suma de deducciones ........................";
             #7#3 = "T";
             #7#4 = 0;
             #7#5 = 2;
             #7#6 = 0;
             #7#7 = 0;
         |SINO;
             #7#2 = "Regularizacion aplicacion porcentaje def.prorrata";
             #7#3 = "D";
             #7#4 = 0;
             #7#5 = 0;
             #7#6 = 0;
             #7#7 = 0;
         |FINSI;

         |HAZ GrabaRegistro;
         |ACABA;
     |FINSI;

     |SI #7#0 = 2;  |Y #7#1 = 11;  |Y #1#1 ] 2008;
         #7#2 = "Ops.interiores intragrupo bienes y serv.ctes. ...";
         #7#3 = "D";
         #7#4 = 0;
         #7#5 = 0;
         #7#6 = 0;
         #7#7 = 0;
         |HAZ GrabaRegistro;
     |FINSI;

     |SI #7#0 = 2;  |Y #7#1 = 12;  |Y #1#1 ] 2008;
         #7#0 = 2;
         #7#1 = 12;
         #7#2 = "Ops.interiores intragrupo con bienes inversion ..";
         #7#3 = "D";
         #7#4 = 0;
         #7#5 = 0;
         #7#6 = 0;
         #7#7 = 0;
         |HAZ GrabaRegistro;

         #7#0 = 2;
         #7#1 = 13;
         #7#2 = "      Total de deducciones .......................";
         #7#3 = "T";
         #7#4 = 0;
         #7#5 = 2;
         #7#6 = 0;
         #7#7 = 0;
         |HAZ GrabaRegistro;

         #7#0 = 2;
         #7#1 = 11;
         |ACABA;
     |FINSI;

     |SI #7#0 = 4;  |Y #7#1 = 8;  |Y #1#1 ] 2008;
         |HAZ GrabaRegistro;

         #7#0 = 4;
         #7#1 = 16;
         #7#2 = "Serv.localizados en el territorio inv.suj.pasivo ";
         #7#3 = "D";
         #7#4 = 0;
         #7#5 = 1;
         #7#6 = 4;
         #7#7 = 4;
         |HAZ GrabaRegistro;

         #7#0 = 4;
         #7#1 = 8;
         |ACABA;
     |FINSI;

     |HAZ GrabaRegistro;
|FPRC;

|DEFBUCLE dsmom007;
     #7#1;
     ;
     0, 00;
     5, 99;
     ;
     NULL, dsmom007;
|FIN;

|PROCESO PonActividad;
     aAlfa = #100#6 % -104;
     |SI aAlfa ! "0000";
         aAlfa = "01.01." + #1#1;
         |SI #100#6 < aAlfa;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #100#7 = 1;   |ACABA;  |FINSI;
     |SI #100#7 = 2;   |ACABA;  |FINSI;
     |SI #100#7 = 4;   |ACABA;  |FINSI;
     |SI #100#7 = 5;   |ACABA;  |FINSI;
     |SI #100#7 = 6;   |ACABA;  |FINSI;
     |SI #100#7 = 7;   |ACABA;  |FINSI;
     |SI #100#7 = 8;   |ACABA;  |FINSI;
     |SI #100#7 = 9;   |ACABA;  |FINSI;
     |SI #100#7 = 10;  |ACABA;  |FINSI;
     |SI #100#7 = 11;  |ACABA;  |FINSI;

     |PARA nCampo = 23;  |SI nCampo [ 43;  |HACIENDO nCampo = nCampo + 4;
           nCampo1 = nCampo + 1;
           nCampo2 = nCampo + 2;
           nCampo3 = nCampo + 3;
           |SI #1nCampo  = 0;
               #1nCampo  = #100#1;
               #1nCampo1 = #100#3;
               #1nCampo2 = #100#4;

               |SI #100#7  = 11;  |O #100#7 = 13;
                   #1#47 = "X";
               |FINSI;

               |SI #100#16 = 1;  |O #100#16 = 2;  #1nCampo3 = 1;  |FINSI;
               |SI #100#16 = 4;  |O #100#16 = 5;  #1nCampo3 = 2;  |FINSI;
               |SI #100#3  = "8612";              #1nCampo3 = 3;  |FINSI;
               |SI #100#16 = 3;                   #1nCampo3 = 1;  |FINSI;
               |SI #100#16 = 6;                   #1nCampo3 = 6;  |FINSI;

               |SI #100#3 = "9999";  |Y #100#16 = 3;
                   #1nCampo3 = 4;
               |FINSI;

               |SI #100#3 = "9999";  |Y #100#16 = 6;
                   #1nCampo3 = 6;
               |FINSI;

               |SI #1nCampo3 = 0;  |O #1nCampo3 = 4;  |O #1nCampo3 = 5;
                |O #1nCampo3 = 6;
                   #1nCampo1 = "";
               |FINSI;

               |SAL;
           |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE agicen14;
     #100#1;
     ;
     #1#0, 01;
     #1#0, 99;
     ;
     NULL, PonActividad;
|FIN;

|PROCESO DatosEstadisticos;
     |BUCLE agicen14;
|FPRC;

|PROCESO Borra02;
     |BORRA 020#2a;
     |LIBERA #2;
|FPRC;

|DEFBUCLE dsm39202B;
     #2#1;
     ;
     #1#0, #1#1, #1#2, #1#3, 0, 00;
     #1#0, #1#1, #1#2, #1#3, 9, 99;
     ;
     NULL, Borra02;
|FIN;

|PROCESO Borra03;
     |BORRA 020#3a;
     |LIBERA #3;
|FPRC;

|DEFBUCLE dsm39203B;
     #3#1;
     ;
     #1#0, #1#1, #1#2, #1#3, 1;
     #1#0, #1#1, #1#2, #1#3, 3;
     ;
     NULL, Borra03;
|FIN;

|PROCESO Borra04;
     |BORRA 020#4a;
     |LIBERA #4;
|FPRC;

|DEFBUCLE dsm39204B;
     #4#1;
     ;
     #1#0, #1#1, #1#2, #1#3, 00;
     #1#0, #1#1, #1#2, #1#3, 99;
     ;
     NULL, Borra04;
|FIN;

|PROCESO Recalculo;
     |ABRE #2;
     |SELECT #2#2;
     |HAZ Totales;
     |SELECT #1#2;
     |CIERRA #2;

     |HAZ SacaGeneral;
     |HAZ SacaResultados;
     |HAZ SacaOperaciones;
|FPRC;

|PROCESO CompruebaVersion;
     |ABRE #7;

     #7#0 = 3;
     #7#1 = 1;
     |LEE 101#7=;
     |SI FSalida = 0;  |Y #7#4 = 0;
         |CIERRA #7;
         |ACABA;
     |FINSI;

     #7#0 = 3;
     #7#1 = 1;
     |LEE 101#7=;
     |SI FSalida = 0;
         #7#4 = 0;
         #7#5 = 1;
         #7#6 = 3;
         #7#7 = 3;
         |GRABA 020#7a;
         |LIBERA #7;
      |FINSI;

     #7#0 = 3;
     #7#1 = 5;
     |LEE 101#7=;
     |SI FSalida = 0;
         #7#4 = 0;
         #7#5 = 1;
         #7#6 = 3;
         #7#7 = 3;
         |GRABA 020#7a;
         |LIBERA #7;
      |FINSI;

     #7#0 = 3;
     #7#1 = 6;
     |LEE 101#7=;
     |SI FSalida = 0;
         #7#4 = 0;
         #7#5 = 1;
         #7#6 = 3;
         #7#7 = 3;
         |GRABA 020#7a;
         |LIBERA #7;
     |FINSI;
     |CIERRA #7;
|FPRC;

|PROCESO dsm39201_2;
     nValor  = 0;
     nValor2 = 0;

     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = #1#2;
     #2#3 = #1#3;
     #2#4 = 2;
     #2#5 = 11;
     |LEE 101#2=;
     |SI FSalida = 0;
         #2#10   = 0;
         #2#11   = 0;
         #2#12   = 0;
         #2#13   = 0;
         #2#14   = 0;
         #2#15   = 0;
         #2#16   = 0;
         #2#17   = 0;
         #2#18   = 0;
         #2#19   = 0;
         #2#20   = 0;
         #2#21   = 0;
         #2#22   = 0;
         #2#23   = 0;
         |GRABA 020#2a;
         |LIBERA #2;
     |FINSI;

     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = #1#2;
     #2#3 = #1#3;
     #2#4 = 2;
     #2#5 = 12;
     |LEE 101#2=;
     |SI FSalida = 0;
         nValor  = #2#10;
         nValor2 = #2#11;
         #2#10   = 0;
         #2#11   = 0;
         |GRABA 020#2a;
         |LIBERA #2;
     |FINSI;

     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = #1#2;
     #2#3 = #1#3;
     #2#4 = 2;
     #2#5 = 13;
     |LEE 101#2=;
     |SI FSalida ! 0;
         |DDEFECTO #2;
         #2#0  = #1#0;
         #2#1  = #1#1;
         #2#2  = #1#2;
         #2#3  = #1#3;
         #2#4  = 2;
         #2#5  = 13;
         #2#6  = "      Total de deducciones .......................";
         #2#7  = "T";
         #2#9  = 2;
         |GRABA 020#2b;
     |FINSI;

     #2#10 = nValor;
     #2#11 = nValor2;
     |GRABA 020#2a;
     |LIBERA #2;

     nSwHay = 1;
|FPRC;

|DEFBUCLE dsm39201_2;
     #1#2;
     ;
     0, 2008;
     0, 2008;
     ;
     NULL, dsm39201_2;
|FIN;

|PROCESO dsm39201_1;
     #1#54 = 1;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE dsm39201_1;
     #1#1;
     54;
     00000, 2008, 392, 00, 0;
     99999, 2008, 392, 99, 0;
     be;
     NULL, dsm39201_1;
|FIN;

|PROCESO ControlaVersion;
     nSwHay = 0;
     |ABRE #2;
     |BUCLE dsm39201_2;
     |CIERRA #2;

     |SI nSwHay = 1;
         |BUCLE dsm39201_1;
     |FINSI;
|FPRC;

|PROGRAMA;
     |SI enEjer ] 2006;
         |HAZ CompruebaVersion;
     |FINSI;

     |SI enEjer ] 2008;
         |HAZ ControlaVersion;
     |FINSI;

     |HAZ LeeEURODBMOD;

     |HAZ LeeCtrlProrr;
     enResultado = 0;
     eaNomDef    = "dsm39201";
     nModo       = 2;

|| \\\\\\ Alta del Modelo ////////

     |SI enTipoEntrada = 1;              || Consulta del Modelo
         |CABEZA "Modelo 392";
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enModelo;
         #1#3 = enComplem;
         |LEE 040#1=;
         |SI FSalida ! 0;
             |DDEFECTO #1;
             #1#0 = enEmpresa;
             #1#1 = enEjer;
             #1#2 = enModelo;
             #1#3 = enComplem;
             |GRABA 020#1b;

             |HAZ DatosEstadisticos;
         |FINSI;

         |ABRE #2;
         |SELECT #1#2;
         |BUCLE dsmom007;
         |CIERRA #2;

         |SI #1#12 = "             ";  |Y #1#3 ! 0;
             |ABRE #104;
             #104#0 = #1#0;
             #104#1 = #1#1;
             #104#2 = 99;
             #104#3 = #1#2;
             #104#4 = #1#3 - 1;
             |LEE 000#104=;
             |SI FSalida ! 0;  |DDEFECTO #104;  |FINSI;
             |CIERRA #104;

             #1#12 = #104#19;
         |FINSI;

         |PINPA #0#1;
         |PINDA #0#1;
         |HAZ PintaDatos;

         |CONTROL_SIMPLE 0, "BOTON,F8 Datos Estadisticos  ", 0803, 0824, PulsaF8;
         nBoton8 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F9  Prorratas ", 2268, 2278, PulsaF9;
         nBoton9 = FSalida;

         |ENDATOS #1#1;

         |HAZ QuitaBotones;

         |SI #1#4  = 0;  |Y #1#5  = 0;  |Y #1#6  = 0;  |Y #1#7  = 0;
          |Y #1#8  = 0;  |Y #1#9  = 0;  |Y #1#10 = 0;  |Y #1#11 = 0;
             |BUCLE dsm39202B;
             |BUCLE dsm39203B;
             |BUCLE dsm39204B;

             |BORRA 020#1a;
             enEntrada = 0;
         |SINO;
             |GRABA 020#1a;
             enEntrada = 1;
         |FINSI;
         |LIBERA #1;
         |CIERRA #1;

         |ACABA;
     |FINSI;

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
         nModo = 4;

         |CABEZA "Modelo 392";
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enModelo;
         #1#3 = enComplem;
         |LEE 040#1=;
         |SI FSalida ! 0;
             |MENAV "      No existe Registro.";
             |CIERRA #1;
             |ACABA;
         |FINSI;

         |PINPA #0#1;
         |PINDA #0#1;
         |HAZ PintaDatos;

         |CONTROL_SIMPLE 0, "BOTON,F2 R.Gnl", 0803, 0809, PulsaF2;
         nBoton1 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F3 Grupo 1", 0811, 0818, PulsaF3;
         nBoton2 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F4 Grupo 2", 0820, 0827, PulsaF4;
         nBoton3 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F5 Grupo 3", 0829, 0836, PulsaF5;
         nBoton4 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F6 Res.", 0838, 0845, PulsaF6;
         nBoton5 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F7 Ope.", 0847, 0854, PulsaF7;
         nBoton6 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F8 D.Est.", 0856, 0863, PulsaF8;
         nBoton7 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F9 Pror.", 0865, 0872, PulsaF9;
         nBoton8 = FSalida;

         aEsc1  = &255 + "806";
         aEsc2  = &255 + "807";
         aRetu  = &255 + "802";
         aF2    = &255 + "824";
         aF3    = &255 + "825";
         aF4    = &255 + "826";
         aF5    = &255 + "827";
         aF6    = &255 + "828";
         aF7    = &255 + "829";
         aF8    = &255 + "830";
         aF9    = &255 + "831";

         |PARA; |SI;  |HACIENDO;
             |LEETECLA aTecla;
             |SI aTecla = aEsc1; |SAL;  |FINSI;
             |SI aTecla = aEsc2; |SAL;  |FINSI;
             |SI aTecla = aRetu; |SAL;  |FINSI;

             |SI aTecla = aF2;               |HAZ FuncionF2;     |FINSI;
             |SI aTecla = aF3;  nGrupo = 1;  |HAZ FuncionF3aF5;  |FINSI;
             |SI aTecla = aF4;  nGrupo = 2;  |HAZ FuncionF3aF5;  |FINSI;
             |SI aTecla = aF5;  nGrupo = 3;  |HAZ FuncionF3aF5;  |FINSI;
             |SI aTecla = aF6;               |HAZ FuncionF6;     |FINSI;
             |SI aTecla = aF7;               |HAZ FuncionF7;     |FINSI;
             |SI aTecla = aF8;               |HAZ FuncionF8;     |FINSI;
             |SI aTecla = aF9;               |HAZ FuncionF9;     |FINSI;
         |SIGUE;

         |HAZ QuitaBotones;

         |CIERRA #1;

         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              || Baja del Modelo
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enModelo;
         #1#3 = enComplem;
         |LEE 040#1=;
         |SI FSalida ! 0;
             |SI enMensa = 0;
                 |MENAV "      No existe Registro.";
             |FINSI;
             |CIERRA #1;
             |ACABA;
         |FINSI;

         |BUCLE dsm39202B;
         |BUCLE dsm39203B;
         |BUCLE dsm39204B;

         |BORRA 020#1a;
         |LIBERA #1;

         |CIERRA #1;

         |ACABA;
     |FINSI;

|| \\\\\\ Alta desde el Pase del Modelo

     |SI enTipoEntrada = 95;
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enModelo;
         #1#3 = enComplem;
         |LEE 040#1=;
         |SI FSalida ! 0;
             |DDEFECTO #1;
             #1#0 = enEmpresa;
             #1#1 = enEjer;
             #1#2 = enModelo;
             #1#3 = enComplem;
             |GRABA 020#1b;

             |HAZ DatosEstadisticos;
         |FINSI;

         |ABRE #2;
         |SELECT #1#2;
         |BUCLE dsmom007;
         |CIERRA #2;

         |HAZ Recalculo;
         |GRABA 020#1a;

         |LIBERA #1;
         |CIERRA #1;

         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enModelo;
         #1#3 = enComplem;
         |LEE 040#1=;
         |SI FSalida ! 0;  enExistencia = 1;  |FINSI;
         |CIERRA #1;

         |SI enActividad = 0;  enResultado = 0;  |FINSI;
     |FINSI;
|FPRO;
