|FICHEROS;
     dsmoy000 #0;
     dsmom004 #4;
     dsmom107 #107;
     dsmow600 #600;
     dsmow601 #601,MANTE;

     dsmod130 #130;
     dsmow014 #999;
     dsmow506 #506;
     dsmow507 #507;
     dsmow521 #521;
     dsmow542 #542;
     dsmow570 #570;
     dsmow576 #576;

     &regisnif@ #709;
     &clientes@ #715;
     &datosper@ #718;
|FIN;

|VARIABLES;
   nImporte = 0;
|FIN;

|INCLUYE i_varemi;

|PROCESO Registro130_2001;
     |DDEFECTO #506;

     #506#1  = "130";
     #506#2  = "01";
     #506#3  = "";

     |SI enSwDeDonde = 1;
         #506#4   = (("00" + #715#15) % -102) + (("000" + #715#16) % -103);
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #506#5   = eaVarDni;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = aAlfa1;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #506#6 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #506#7 = eaAlfa;
         |SINO;
             eaAlfa = #715#1;  |HAZ QuitaRaros;  #506#6  = eaAlfa;
             #506#7  = ".";
         |FINSI;
         #506#8  = #715#29;
         eaAlfa  = #715#30;  |HAZ QuitaRaros;  #506#9 = eaAlfa;
         #506#10 = #715#31 % 104;
         #506#11 = #715#32;
         #506#12 = #715#33;
         #506#13 = #715#34;
         #506#14 = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
         eaAlfa  = #715#37;  |HAZ QuitaRaros;      #506#15 = eaAlfa;
         eaAlfa  = #715#38;  |HAZ QuitaRaros;      #506#16 = eaAlfa;
         eaAlfa  = #715#54;  |HAZ QuitaRarosTfno;  #506#17 = eaAlfa;

         eaDeleg     = #715#17;
         eaAdmin     = #715#18;

         |SI #130#17 > 0;
             enModelo = 130;  enForzar = 0;  |HAZ CogeDatosBancos;

             |SI eaFormaPago = "1";  #506#34 = "X";  |FINSI;
             |SI eaFormaPago ! "1";  #506#35 = "X";  |FINSI;

             #506#36 = eaEntidad;
             #506#37 = eaOficina;
             #506#38 = eaDC;
             #506#39 = eaCuenta;
         |FINSI;
     |SINO;
         #506#4   = (("00" + #715#63) % -102) + (("000" + #715#64) % -103);
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #506#5   = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;      #506#6  = eaAlfa;
         #506#7   = ".";
         #506#8   = #715#3;
         eaAlfa   = #715#4;  |HAZ QuitaRaros;      #506#9 = eaAlfa;
         #506#10 = #715#5 % 104;
         #506#11 = #715#6;
         #506#12 = #715#7;
         #506#13 = #715#8;
         #506#14 = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
         eaAlfa  = #715#11;  |HAZ QuitaRaros;     #506#15 = eaAlfa;
         eaAlfa  = #715#12;  |HAZ QuitaRaros;     #506#16 = eaAlfa;
         eaAlfa  = #715#14;  |HAZ QuitaRarosTfno; #506#17 = eaAlfa;

         eaDeleg     = #715#91;
         eaAdmin     = #715#92;

         |SI #130#17 > 0;
             |SI #715#84 = "                    ";
                 #506#34  = "X";
             |SINO;
                 #506#35  = "X";
                 #506#36 = #715#81;
                 #506#37 = #715#82;
                 #506#38 = #715#83;
                 #506#39 = #715#84 % 110;
             |FINSI;
         |FINSI;
     |FINSI;

     #506#18  = #130#1;

     |SI #130#2 = 3;   #506#19 = 1;  |FINSI;
     |SI #130#2 = 6;   #506#19 = 2;  |FINSI;
     |SI #130#2 = 9;   #506#19 = 3;  |FINSI;
     |SI #130#2 = 12;  #506#19 = 4;  |FINSI;


     enNume = #130#6;   |HAZ Conver12;  #506#20 = eaAlfa;
     enNume = #130#7;   |HAZ Conver12;  #506#21 = eaAlfa;
     enNume = #130#8;   |HAZ Conver12;  #506#22 = eaAlfa;
     enNume = #130#9;   |HAZ Conver12;  #506#23 = eaAlfa;
     enNume = #130#10;  |HAZ Conver12;  #506#24 = eaAlfa;
     enNume = #130#11;  |HAZ Conver12;  #506#25 = eaAlfa;
     enNume = #130#12;  |HAZ Conver12;  #506#26 = eaAlfa;
     enNume = #130#13;  |HAZ Conver12;  #506#27 = eaAlfa;
     enNume = #130#14;  |HAZ Conver12;  #506#28 = eaAlfa;
     enNume = #130#15;  |HAZ Conver12;  #506#29 = eaAlfa;
     enNume = #130#16;  |HAZ Conver12;  #506#30 = eaAlfa;
     enNume = #130#17;  |HAZ Conver12;  #506#31 = eaAlfa;

     |SI #130#17 [ 0;
         #506#32 = "X";
         enNume = 0;  |HAZ Conver12;  #506#33 = eaAlfa;
     |SINO;
         enNume = #130#17;  |HAZ Conver12;  #506#33 = eaAlfa;
     |FINSI;

     eaAlfa = #0#7;  |HAZ FechaBonito;
     #506#40 = #506#15;
     #506#41 = eaDiaB;
     #506#42 = eaMesB;
     #506#43 = eaAnyoB;
     #506#44 = &13 + &10;
|FPRC;

|PROCESO Internet130_2001;
     |DDEFECTO #521;

     #521#1  = "130";
     #521#2  = "P";

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;    #521#3  = eaVarDni;
         eaAlfa = #715#57;  |HAZ QuitaRaros;       #521#4  = eaAlfa;
         eaAlfa = #715#53;  |HAZ QuitaRaros;       #521#23 = eaAlfa;
         eaAlfa = #715#54;  |HAZ QuitaRarosTfno;   #521#24 = eaAlfa;
         eaAlfa = #715#1;   |HAZ QuitaRaros;       #521#25 = eaAlfa;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #521#3  = eaVarDni;
         eaAlfa   = #715#1;   |HAZ QuitaRaros;     #521#23 = eaAlfa;
         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno; #521#24 = eaAlfa;
         eaAlfa   = #715#1;   |HAZ QuitaRaros;     #521#25 = eaAlfa;
     |FINSI;

     #521#5 = #130#1;

     |SI #130#2 = 3;   #521#6 = "1T";  |FINSI;
     |SI #130#2 = 6;   #521#6 = "2T";  |FINSI;
     |SI #130#2 = 9;   #521#6 = "3T";  |FINSI;
     |SI #130#2 = 12;  #521#6 = "4T";  |FINSI;

     enNume = #130#6;   |HAZ Conver17;  #521#07 = eaAlfa;
     enNume = #130#7;   |HAZ Conver17;  #521#08 = eaAlfa;
     enNume = #130#8;   |HAZ Conver17;  #521#09 = eaAlfa;
     enNume = #130#9;   |HAZ Conver17;  #521#10 = eaAlfa;
     enNume = #130#10;  |HAZ Conver17;  #521#11 = eaAlfa;
     enNume = #130#11;  |HAZ Conver17;  #521#12 = eaAlfa;
     enNume = #130#12;  |HAZ Conver17;  #521#13 = eaAlfa;
     enNume = #130#13;  |HAZ Conver17;  #521#14 = eaAlfa;
     enNume = #130#14;  |HAZ Conver17;  #521#15 = eaAlfa;
     enNume = #130#15;  |HAZ Conver17;  #521#16 = eaAlfa;
     enNume = #130#16;  |HAZ Conver17;  #521#17 = eaAlfa;
     enNume = #130#17;  |HAZ Conver17;  #521#18 = eaAlfa;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #521nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |PARA nCampo = 23;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #521nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;

     eaFOrigen  = eaPathEmision + "130" + (("00000" + #999#0) % -105) + ".TXT";
     eaFDestino = eaPathInternet + "130" + (("00000" + #999#0) % -105) + ".TXT";
     |HAZ CopiaFichero;

     |FBORRA eaFOrigen;

     |XCIERRA nHandle2;

     eaFOrigen  = eaPathEmision + "130" + (("00000" + #999#0) % -105) + ".TXT";
     eaFDestino = eaPathInternet + "130" + (("00000" + #999#0) % -105) + ".TXT";
     |HAZ CopiaFichero;

     |FBORRA eaFOrigen;

     |HAZ GrabaImpreso;
|FPRC;

|PROCESO Registro132_2001;
     |DDEFECTO #507;

     #507#1  = "132";
     #507#2  = "01";
     #507#3  = "";

     |SI enSwDeDonde = 1;
         #507#4   = (("00" + #715#15) % -102) + (("000" + #715#16) % -103);
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #507#5   = eaVarDni;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = aAlfa1;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #507#6 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #507#7 = eaAlfa;
         |SINO;
             eaAlfa = #715#1;  |HAZ QuitaRaros;  #507#6  = eaAlfa;
             #507#7  = ".";
         |FINSI;
         #507#8  = #715#29;
         eaAlfa  = #715#30;  |HAZ QuitaRaros;  #507#9 = eaAlfa;
         #507#10 = #715#31 % 104;
         #507#11 = #715#32;
         #507#12 = #715#33;
         #507#13 = #715#34;
         #507#14 = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
         eaAlfa  = #715#37;  |HAZ QuitaRaros;      #507#15 = eaAlfa;
         eaAlfa  = #715#38;  |HAZ QuitaRaros;      #507#16 = eaAlfa;
         eaAlfa  = #715#54;  |HAZ QuitaRarosTfno;  #507#17 = eaAlfa;

         eaDeleg     = #715#17;
         eaAdmin     = #715#18;

         |SI #130#17 > 0;
             enModelo = 130;  enForzar = 0;  |HAZ CogeDatosBancos;

             |SI eaFormaPago = "1";  #507#35 = "X";  |FINSI;
             |SI eaFormaPago ! "1";  #507#36 = "X";  |FINSI;

             #507#37 = eaEntidad;
             #507#38 = eaOficina;
             #507#39 = eaDC;
             #507#40 = eaCuenta;
         |FINSI;
     |SINO;
         #507#4   = (("00" + #715#63) % -102) + (("000" + #715#64) % -103);
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #507#5   = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;      #507#6  = eaAlfa;
         #507#7   = ".";
         #507#8   = #715#3;
         eaAlfa   = #715#4;  |HAZ QuitaRaros;      #507#9 = eaAlfa;
         #507#10 = #715#5 % 104;
         #507#11 = #715#6;
         #507#12 = #715#7;
         #507#13 = #715#8;
         #507#14 = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
         eaAlfa  = #715#11;  |HAZ QuitaRaros;     #507#15 = eaAlfa;
         eaAlfa  = #715#12;  |HAZ QuitaRaros;     #507#16 = eaAlfa;
         eaAlfa  = #715#14;  |HAZ QuitaRarosTfno; #507#17 = eaAlfa;

         eaDeleg     = #715#91;
         eaAdmin     = #715#92;

         |SI #130#17 > 0;
             |SI #715#84 = "                    ";
                 #507#35  = "X";
             |SINO;
                 #507#36  = "X";
                 #507#37 = #715#81;
                 #507#38 = #715#82;
                 #507#39 = #715#83;
                 #507#40 = #715#84 % 110;
             |FINSI;
         |FINSI;
     |FINSI;

     #507#18  = #130#1;

     |SI #130#2 = 3;   #507#19 = 1;  |FINSI;
     |SI #130#2 = 6;   #507#19 = 2;  |FINSI;
     |SI #130#2 = 9;   #507#19 = 3;  |FINSI;
     |SI #130#2 = 12;  #507#19 = 4;  |FINSI;

     enNume = #130#6;   |HAZ Conver12;  #507#20 = eaAlfa;
     enNume = #130#7;   |HAZ Conver12;  #507#21 = eaAlfa;
     enNume = #130#8;   |HAZ Conver12;  #507#22 = eaAlfa;
     enNume = #130#9;   |HAZ Conver12;  #507#23 = eaAlfa;
     enNume = #130#10;  |HAZ Conver12;  #507#24 = eaAlfa;
     enNume = #130#11;  |HAZ Conver12;  #507#25 = eaAlfa;
     enNume = #130#12;  |HAZ Conver12;  #507#26 = eaAlfa;
     enNume = #130#13;  |HAZ Conver12;  #507#27 = eaAlfa;
     enNume = #130#14;  |HAZ Conver12;  #507#28 = eaAlfa;
     enNume = #130#15;  |HAZ Conver12;  #507#29 = eaAlfa;
     enNume = #130#16;  |HAZ Conver12;  #507#30 = eaAlfa;
     enNume = #130#17;  |HAZ Conver12;  #507#31 = eaAlfa;
     enNume = 0;        |HAZ Conver12;  #507#32 = eaAlfa;
     enNume = #130#17;  |HAZ Conver12;  #507#33 = eaAlfa;

     |SI #130#17 [ 0;
         #507#41 = "X";
         enNume = 0;        |HAZ Conver12;  #507#34 = eaAlfa;
     |SINO;
         enNume = #130#17;  |HAZ Conver12;  #507#34 = eaAlfa;
     |FINSI;

     eaAlfa  = #0#7;  |HAZ FechaBonito;
     #507#44 = #507#15;
     #507#45 = eaDiaB;
     #507#46 = eaMesB;
     #507#47 = eaAnyoB;
     #507#48 = &13 + &10;
|FPRC;

|PROCESO Internet132_2001;
     |DDEFECTO #521;

     #521#1  = "130";
     #521#2  = "E";

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;    #521#3  = eaVarDni;
         eaAlfa = #715#57;  |HAZ QuitaRaros;       #521#4  = eaAlfa;
         eaAlfa = #715#53;  |HAZ QuitaRaros;       #521#23 = eaAlfa;
         eaAlfa = #715#54;  |HAZ QuitaRarosTfno;   #521#24 = eaAlfa;
         eaAlfa = #715#1;   |HAZ QuitaRaros;       #521#25 = eaAlfa;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #521#3  = eaVarDni;
         eaAlfa   = #715#1;   |HAZ QuitaRaros;     #521#23 = eaAlfa;
         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno; #521#24 = eaAlfa;
         eaAlfa   = #715#1;   |HAZ QuitaRaros;     #521#25 = eaAlfa;
     |FINSI;

     #521#5 = #130#1;

     |SI #130#2 = 3;   #521#6 = "1T";  |FINSI;
     |SI #130#2 = 6;   #521#6 = "2T";  |FINSI;
     |SI #130#2 = 9;   #521#6 = "3T";  |FINSI;
     |SI #130#2 = 12;  #521#6 = "4T";  |FINSI;

     enNume = #130#6;   |HAZ Conver17;  #521#07 = eaAlfa;
     enNume = #130#7;   |HAZ Conver17;  #521#08 = eaAlfa;
     enNume = #130#8;   |HAZ Conver17;  #521#09 = eaAlfa;
     enNume = #130#9;   |HAZ Conver17;  #521#10 = eaAlfa;
     enNume = #130#10;  |HAZ Conver17;  #521#11 = eaAlfa;
     enNume = #130#11;  |HAZ Conver17;  #521#12 = eaAlfa;
     enNume = #130#12;  |HAZ Conver17;  #521#13 = eaAlfa;
     enNume = #130#13;  |HAZ Conver17;  #521#14 = eaAlfa;
     enNume = #130#14;  |HAZ Conver17;  #521#15 = eaAlfa;
     enNume = #130#15;  |HAZ Conver17;  #521#16 = eaAlfa;
     enNume = #130#16;  |HAZ Conver17;  #521#17 = eaAlfa;
     enNume = #130#17;  |HAZ Conver17;  #521#18 = eaAlfa;
     enNume = 0;        |HAZ Conver17;  #521#19 = eaAlfa;
     enNume = #130#17;  |HAZ Conver17;  #521#20 = eaAlfa;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #521nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     eaFOrigen  = eaPathEmision + "130" + (("00000" + #999#0) % -105) + ".TXT";
     eaFDestino = eaPathInternet + "130" + (("00000" + #999#0) % -105) + ".TXT";
     |HAZ CopiaFichero;

     |FBORRA eaFOrigen;

     |HAZ GrabaImpreso;
|FPRC;

|PROCESO Carga130_2001;
     |SI eaMoneda = "PESETAS";
         |SI nTecla = 3;
             |HAZ Internet130_2001;
         |SINO;
             |HAZ Registro130_2001;
         |FINSI;

         |SI nTecla = 1;
             aAlfa = "";
             |PARA nCampo = 1;  |SI nCampo [ 44;  |HACIENDO nCampo = nCampo + 1;
                   aAlfa = #506nCampo;
                   |XGRABA nHandle2, aAlfa;
             |SIGUE;
             |XCIERRA nHandle2;

             eaFOrigen  = eaPathEmision + "130" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza + "130" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;
         |FINSI;
     |SINO;
         |SI nTecla = 4;
             |HAZ Registro130_2001;
         |SINO;
             |SI nTecla = 3;
                |HAZ Internet132_2001;
             |SINO;
                |HAZ Registro132_2001;
             |FINSI;
         |FINSI;

         |SI nTecla = 1;
             aAlfa = "";
             |PARA nCampo = 1;  |SI nCampo [ 48;  |HACIENDO nCampo = nCampo + 1;
                   aAlfa = #507nCampo;
                   |XGRABA nHandle2, aAlfa;
             |SIGUE;
             |XCIERRA nHandle2;

             eaFOrigen  = eaPathEmision + "130" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza + "130" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;
         |FINSI;
     |FINSI;

     |SI nTecla = 1;
         aAlfa = "del err" + (("00000" + #999#0) % -105) + ".TXT" + &13 + &10;
         |XGRABA nHandle1, aAlfa;

         aAlfa = "wait mipf " + "130" + (("00000" + #999#0) % -105) + ".TXT";

         |SI #600#0 = "N";  aAlfa = aAlfa + " s";  |FINSI;
         |SI #600#1 = "S";  aAlfa = aAlfa + " a";  |FINSI;
         aAlfa = aAlfa + " " + #600#2;
         aAlfa = aAlfa + &13 + &10;
         |XGRABA nHandle1, aAlfa;

         aAlfa = "move errores.txt err" + (("00000" + #999#0) % -105) + ".TXT" + &13 + &10;
         aAlfa = aAlfa + &13 + &10;

         |XGRABA nHandle1, aAlfa;
     |FINSI;

     |SI nTecla = 4;
         |PRINT;
         |PIEINF;
     |FINSI;
|FPRC;


|PROCESO CargaImprime130;
     aAlfa = "del err" + (("00000" + #999#0) % -105) + ".TXT" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "wait mipf32 ";
     aAlfa = aAlfa + "/E:130" + (("00000" + #999#0) % -105) + ".TXT ";
     aAlfa = aAlfa + "/R:err" + (("00000" + #999#0) % -105) + ".TXT ";
     |SI eaImpresora ! "";
         aAlfa = aAlfa + "/I:" + &34 + eaImpresora + &34;
     |FINSI;
     aAlfa = aAlfa + " /C:" + #601#0;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO TDeclaracion130;
     |SI nImporte > 0;
         enNume = nImporte;  |HAZ Conver13;  #542#36 = eaAlfa;

         enModelo = 130;   enForzar = 0;   |HAZ CogeDatosBancos;

         |SI eaFormaPago = "1";  #542#37 = "X";  |FINSI;
         |SI eaFormaPago ! "1";  #542#38 = "X";  |FINSI;

         #542#39 = eaEntidad;
         #542#40 = eaOficina;
         #542#41 = eaDC;
         #542#42 = eaCuenta;
     |SINO;
         enNume  = 0;  |HAZ Conver13;  #542#36 = eaAlfa;
     |FINSI;

     #542#4 = "";
     |SI nTecla ! 3;
         |SI nImporte [ 0;  #542#4 = "N";  |FINSI;
     |SINO;
         #542#4 = "N";
         |SI nImporte > 0;  #542#4 = "I";  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Carga130_2002;
     enCodCli = #130#0;
     |HAZ LeePersona;

     |DDEFECTO #542;

     #542#1  = "130";
     #542#2  = "01";
     #542#3  = "";

     |SI enSwDeDonde = 1;
         #542#5   = (("00" + #715#15) % -102) + (("000" + #715#16) % -103);
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #542#6  = eaVarDni;
         eaAlfa   = #715#57;  |HAZ QuitaRaros;    #542#7  = eaAlfa;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = aAlfa1;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #542#8 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #542#9 = eaAlfa;
         |SINO;
             eaAlfa = #715#1;  |HAZ QuitaRaros;  #542#8  = eaAlfa;
             #542#9  = ".";
         |FINSI;
         #542#10 = #715#29;
         eaAlfa  = #715#30;  |HAZ QuitaRaros;  #542#11 = eaAlfa;
         #542#12 = #715#31 % 104;
         #542#13 = #715#32;
         #542#14 = #715#33;
         #542#15 = #715#34;
         #542#16 = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
         eaAlfa  = #715#37;  |HAZ QuitaRaros;       #542#17 = eaAlfa;
         eaAlfa  = #715#38;  |HAZ QuitaRaros;       #542#18 = eaAlfa;
         eaAlfa  = #715#54;  |HAZ QuitaRarosTfno;   #542#19 = eaAlfa;
         eaAlfa  = #715#53;  |HAZ QuitaRaros;       #542#45 = eaAlfa;
         eaAlfa  = #715#54;  |HAZ QuitaRarosTfno;   #542#46 = eaAlfa;
         eaDeleg = #715#17;
         eaAdmin = #715#18;
     |SINO;
         #542#5   = (("00" + #715#63) % -102) + (("000" + #715#64) % -103);
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #542#6   = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;      #542#8   = eaAlfa;
         #542#9   = ".";
         #542#10  = #715#3;
         eaAlfa   = #715#4;  |HAZ QuitaRaros;      #542#11  = eaAlfa;
         #542#12 = #715#5 % 104;
         #542#13 = #715#6;
         #542#14 = #715#7;
         #542#15 = #715#8;
         #542#16 = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
         eaAlfa  = #715#11;  |HAZ QuitaRaros;     #542#17 = eaAlfa;
         eaAlfa  = #715#12;  |HAZ QuitaRaros;     #542#18 = eaAlfa;
         eaAlfa  = #715#14;  |HAZ QuitaRarosTfno; #542#19 = eaAlfa;
         eaAlfa  = #715#1;   |HAZ QuitaRaros;     #542#45 = eaAlfa;
         eaAlfa  = #715#14;  |HAZ QuitaRarosTfno; #542#46 = eaAlfa;
         eaDeleg = #715#91;
         eaAdmin = #715#92;
     |FINSI;

     #542#20  = #130#1;

     |SI #130#2 = 3;   #542#21 = "1T";  |FINSI;
     |SI #130#2 = 6;   #542#21 = "2T";  |FINSI;
     |SI #130#2 = 9;   #542#21 = "3T";  |FINSI;
     |SI #130#2 = 12;  #542#21 = "4T";  |FINSI;


     enNume = #130#6;   |HAZ Conver13;  #542#22 = eaAlfa;
     enNume = #130#7;   |HAZ Conver13;  #542#23 = eaAlfa;
     enNume = #130#8;   |HAZ Conver13;  #542#24 = eaAlfa;
     enNume = #130#9;   |HAZ Conver13;  #542#25 = eaAlfa;
     enNume = #130#10;  |HAZ Conver13;  #542#26 = eaAlfa;
     enNume = #130#11;  |HAZ Conver13;  #542#27 = eaAlfa;
     enNume = #130#12;  |HAZ Conver13;  #542#28 = eaAlfa;
     enNume = #130#13;  |HAZ Conver13;  #542#29 = eaAlfa;
     enNume = #130#14;  |HAZ Conver13;  #542#30 = eaAlfa;
     enNume = #130#15;  |HAZ Conver13;  #542#31 = eaAlfa;
     enNume = #130#16;  |HAZ Conver13;  #542#32 = eaAlfa;
     enNume = #130#17;  |HAZ Conver13;  #542#33 = eaAlfa;
     |SI #130#4 ! 0;
         nImporte = #130#17 - #130#18;
         enNume = #130#18;           |HAZ Conver13;  #542#34 = eaAlfa;
         enNume = #130#17 - #130#18; |HAZ Conver13;  #542#35 = eaAlfa;
     |SINO;
         nImporte = #130#17;
         enNume = 0;        |HAZ Conver13;  #542#34 = eaAlfa;
         enNume = #130#17;  |HAZ Conver13;  #542#35 = eaAlfa;
     |FINSI;

     |HAZ TDeclaracion130;

     |SI #130#4 > 0;
         #542#43 = #4#20;
         #542#44 = #4#21;
     |FINSI;

     eaAlfa  = #0#7;  |HAZ FechaBonito;
     #542#51 = #542#17;
     #542#52 = eaDiaB;
     #542#53 = eaMesB;
     #542#54 = eaAnyoB;
     #542#55 = &13 + &10;

     |SI nTecla = 1;
         #542#7  = "";
         #542#43 = "";
         #542#45 = "";
         #542#46 = "";
         #542#47 = "";
         #542#48 = "";
         #542#49 = "";
         #542#50 = "";
         nTCampo = 55;
     |FINSI;

     |SI nTecla = 3;
         #542#2  = "";
         #542#3  = "";
         #542#5  = "";
         #542#8  = "";
         #542#9  = "";
         #542#10 = "";
         #542#11 = "";
         #542#12 = "";
         #542#13 = "";
         #542#14 = "";
         #542#15 = "";
         #542#16 = "";
         #542#17 = "";
         #542#18 = "";
         #542#19 = "";
         #542#37 = "";
         #542#38 = "";
         #542#39 = "";
         #542#40 = "";
         #542#41 = "";
         #542#42 = "";
         #542#51 = "";
         #542#52 = "";
         #542#53 = "";
         #542#54 = "";
         #542#55 = "";
         nTCampo = 54;
     |FINSI;

     |SI nTecla = 1;  |O nTecla = 3;
         aAlfa = "";
         |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #542nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         |XCIERRA nHandle2;

         |SI nTecla = 1;
             eaFOrigen  = eaPathEmision + "130" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza + "130" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             |HAZ CargaImprime130;
         |FINSI;

         |SI nTecla = 3;
             eaFOrigen  = eaPathEmision + "130" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathInternet + "130" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             |HAZ GrabaImpreso;
         |FINSI;
     |SINO;
         |PRINT;
         |PIEINF;
     |FINSI;
|FPRC;

|PROCESO TDeclaracion130_2007;
     |SI nImporte > 0;
         enNume = nImporte;  |HAZ Conver13;  #570#26 = eaAlfa;

         enModelo = 130;   enForzar = 0;   |HAZ CogeDatosBancos;

                                 #570#27 = "0";
         |SI eaFormaPago = "1";  #570#27 = "1";  |FINSI;
         |SI eaFormaPago = "2";  #570#27 = "2";  |FINSI;
         |SI eaFormaPago = "3";  |O eaFormaPago = "4";  |O eaFormaPago = "5";
                                 #570#27 = "2";
             |SI nTecla = 3;     #570#27 = eaFormaPago;  |FINSI;
         |FINSI;

         #570#28 = eaEntidad;
         #570#29 = eaOficina;
         #570#30 = eaDC;
         #570#31 = eaCuenta;
     |SINO;
         enNume  = 0;  |HAZ Conver13;  #570#26 = eaAlfa;
                                       #570#27 = "0";
     |FINSI;

     #570#4 = "";
     |SI nTecla ! 3;
         |SI nImporte [ 0;  #570#4 = "N";  |FINSI;
     |SINO;
         #570#4 = "N";
         |SI nImporte > 0;
                                      #570#4 = "I";
             |SI eaFormaPago = "3";    #570#4 = "U";  |FINSI;
             |SI eaFormaPago = "4";    #570#4 = "A";  |FINSI;
             |SI eaFormaPago = "5";    #570#4 = "E";  |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Carga130_2007;
     enCodCli = #130#0;
     |HAZ LeePersona;

     |DDEFECTO #570;

     #570#1  = "130";
     #570#2  = "01";
     #570#3  = "";

     |SI enSwDeDonde = 1;
         #570#5   = (("00" + #715#15) % -102) + (("000" + #715#16) % -103);
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #570#6  = eaVarDni;
         eaAlfa   = #715#57;  |HAZ QuitaRaros;    #570#7  = eaAlfa;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = aAlfa1;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #570#8 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #570#9 = eaAlfa;
         |SINO;
             eaAlfa = #715#1;  |HAZ QuitaRaros;  #570#8  = eaAlfa;
             #570#9  = ".";
         |FINSI;
         eaAlfa  = #715#53;  |HAZ QuitaRaros;       #570#34 = eaAlfa;
         eaAlfa  = #715#54;  |HAZ QuitaRarosTfno;   #570#35 = eaAlfa;
         eaAlfa  = #715#37;  |HAZ QuitaRaros;       #570#40 = eaAlfa;
         eaDeleg = #715#17;
         eaAdmin = #715#18;
     |SINO;
         #570#5   = (("00" + #715#63) % -102) + (("000" + #715#64) % -103);
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #570#6   = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;      #570#8   = eaAlfa;
         #570#9   = ".";
         eaAlfa  = #715#1;   |HAZ QuitaRaros;     #570#34 = eaAlfa;
         eaAlfa  = #715#14;  |HAZ QuitaRarosTfno; #570#35 = eaAlfa;
         eaAlfa  = #715#11;  |HAZ QuitaRaros;     #570#40 = eaAlfa;
         eaDeleg = #715#91;
         eaAdmin = #715#92;
     |FINSI;

     #570#10  = #130#1;

     |SI #130#2 = 3;   #570#11 = "1T";  |FINSI;
     |SI #130#2 = 6;   #570#11 = "2T";  |FINSI;
     |SI #130#2 = 9;   #570#11 = "3T";  |FINSI;
     |SI #130#2 = 12;  #570#11 = "4T";  |FINSI;

     #130#12 = #130#9 - #130#10 - #130#11;
     #130#16 = 0;
     |SI #130#14 > 0;
         #130#16 = #130#14 - #130#15;
     |FINSI;

     enNume = #130#6;   |HAZ Conver13;  #570#12 = eaAlfa;
     enNume = #130#7;   |HAZ Conver13;  #570#13 = eaAlfa;
     enNume = #130#8;   |HAZ Conver13;  #570#14 = eaAlfa;
     enNume = #130#9;   |HAZ Conver13;  #570#15 = eaAlfa;
     enNume = #130#10;  |HAZ Conver13;  #570#16 = eaAlfa;
     enNume = #130#11;  |HAZ Conver13;  #570#17 = eaAlfa;
     enNume = #130#12;  |HAZ Conver13;  #570#18 = eaAlfa;
     enNume = #130#13;  |HAZ Conver13;  #570#19 = eaAlfa;
     enNume = #130#14;  |HAZ Conver13;  #570#20 = eaAlfa;
     enNume = #130#15;  |HAZ Conver13;  #570#21 = eaAlfa;
     enNume = #130#16;  |HAZ Conver13;  #570#22 = eaAlfa;
     enNume = #130#17;  |HAZ Conver13;  #570#23 = eaAlfa;
     |SI #130#4 ! 0;
         nImporte = #130#17 - #130#18;
         enNume = #130#18;  |HAZ Conver13;  #570#24 = eaAlfa;
         enNume = #130#17 - #130#18; |HAZ Conver13;  #570#25 = eaAlfa;
     |SINO;
         nImporte = #130#17;
         enNume = 0;        |HAZ Conver13;  #570#24 = eaAlfa;
         enNume = #130#17;  |HAZ Conver13;  #570#25 = eaAlfa;
     |FINSI;

     |HAZ TDeclaracion130_2007;

     |SI #130#4 > 0;
         #570#32 = #4#20;
         #570#33 = #4#21;
     |FINSI;

     eaAlfa  = #0#7;  |HAZ FechaBonito;
     #570#41 = eaDiaB;
     #570#42 = eaMesB;
     #570#43 = eaAnyoB;
     #570#44 = &13 + &10;

     |SI nTecla = 1;
         #570#7  = "";
         #570#32 = "";
         #570#34 = "";
         #570#35 = "";
         #570#36 = "";
         #570#37 = "";
         #570#38 = "";
         #570#39 = "";
         nTCampo = 44;
     |FINSI;

     |SI nTecla = 3;
         #570#2  = "";
         #570#3  = "";
         #570#5  = "";
         #570#40 = "";
         #570#41 = "";
         #570#42 = "";
         #570#43 = "";
         #570#44 = "";
         nTCampo = 43;
     |FINSI;

     |SI nTecla = 1;  |O nTecla = 3;
         aAlfa = "";
         |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #570nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         |XCIERRA nHandle2;

         |SI nTecla = 1;
             eaFOrigen  = eaPathEmision + "130" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza + "130" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             |HAZ CargaImprime130;
         |FINSI;

         |SI nTecla = 3;
             eaFOrigen  = eaPathEmision + "130" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathInternet + "130" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             |HAZ GrabaImpreso;
         |FINSI;
     |SINO;
         |PRINT;
         |PIEINF;
     |FINSI;
|FPRC;

|PROCESO TDeclaracion130_2008_04;
     |SI nImporte > 0;
         enNume = nImporte;  |HAZ Conver13;  #576#30 = eaAlfa;

         enModelo = 130;   enForzar = 0;   |HAZ CogeDatosBancos;

                                 #576#31 = "0";
         |SI eaFormaPago = "1";  #576#31 = "1";  |FINSI;
         |SI eaFormaPago = "2";  #576#31 = "2";  |FINSI;
         |SI eaFormaPago = "3";  |O eaFormaPago = "4";  |O eaFormaPago = "5";
                                 #576#31 = "2";
             |SI nTecla = 3;     #576#31 = eaFormaPago;  |FINSI;
         |FINSI;

         #576#32 = eaEntidad;
         #576#33 = eaOficina;
         #576#34 = eaDC;
         #576#35 = eaCuenta;
    |SINO;
         enNume  = 0;  |HAZ Conver13;  #576#30 = eaAlfa;

                                           #576#31 = "0";
         |SI nImporte < 0; |Y #130#2 ! 12; #576#36 = "X"; |FINSI;
    |FINSI;

     #576#4 = "";
     |SI nTecla ! 3;
         |SI nImporte [ 0; |Y #576#36 = " ";
             #576#4 = "N";
         |FINSI; || negativo en el ultimo
     |SINO;
         #576#4 = "N";

        |SI nImporte > 0;
                                    #576#4 = "I";
            |SI eaFormaPago = "3";  #576#4 = "U";  |FINSI;
            |SI eaFormaPago = "4";  #576#4 = "A";  |FINSI;
            |SI eaFormaPago = "5";  #576#4 = "E";  |FINSI;
        |FINSI;

        |SI nImporte < 0;  |Y #130#2 ! 12; #576#4 = "B";  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Carga130_2008_04;
     enCodCli = #130#0;
     |HAZ LeePersona;

     |DDEFECTO #576;

     #576#1  = "130";
     #576#2  = "01";
     #576#3  = "";

     |SI enSwDeDonde = 1;
         #576#5   = (("00" + #715#15) % -102) + (("000" + #715#16) % -103);
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #576#6  = eaVarDni;
         eaAlfa   = #715#57;  |HAZ QuitaRaros;    #576#7  = eaAlfa;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = aAlfa1;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #576#8 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #576#9 = eaAlfa;
         |SINO;
             eaAlfa = #715#1;  |HAZ QuitaRaros;  #576#8  = eaAlfa;
             #576#9  = ".";
         |FINSI;
         eaAlfa  = #715#53;  |HAZ QuitaRaros;       #576#39 = eaAlfa;
         eaAlfa  = #715#54;  |HAZ QuitaRarosTfno;   #576#40 = eaAlfa;
         eaAlfa  = #715#37;  |HAZ QuitaRaros;       #576#45 = eaAlfa;
         eaDeleg = #715#17;
         eaAdmin = #715#18;
     |SINO;
         #576#5   = (("00" + #715#63) % -102) + (("000" + #715#64) % -103);
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #576#6   = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;      #576#8   = eaAlfa;
         #576#9   = ".";
         eaAlfa  = #715#1;   |HAZ QuitaRaros;     #576#39 = eaAlfa;
         eaAlfa  = #715#14;  |HAZ QuitaRarosTfno; #576#40 = eaAlfa;
         eaAlfa  = #715#11;  |HAZ QuitaRaros;     #576#45 = eaAlfa;
         eaDeleg = #715#91;
         eaAdmin = #715#92;
     |FINSI;

     #576#10  = #130#1;

     |SI #130#2 = 3;   #576#11 = "1T";  |FINSI;
     |SI #130#2 = 6;   #576#11 = "2T";  |FINSI;
     |SI #130#2 = 9;   #576#11 = "3T";  |FINSI;
     |SI #130#2 = 12;  #576#11 = "4T";  |FINSI;

     #130#12 = #130#9 - #130#10 - #130#11;
     #130#16 = 0;
     |SI #130#14 > 0;
         #130#16 = #130#14 - #130#15;
     |FINSI;

     enNume = #130#6;   |HAZ Conver13;  #576#12 = eaAlfa;
     enNume = #130#7;   |HAZ Conver13;  #576#13 = eaAlfa;
     enNume = #130#8;   |HAZ Conver13;  #576#14 = eaAlfa;
     enNume = #130#9;   |HAZ Conver13;  #576#15 = eaAlfa;
     enNume = #130#10;  |HAZ Conver13;  #576#16 = eaAlfa;
     enNume = #130#11;  |HAZ Conver13;  #576#17 = eaAlfa;
     enNume = #130#12;  |HAZ Conver13;  #576#18 = eaAlfa;
     enNume = #130#13;  |HAZ Conver13;  #576#19 = eaAlfa;
     enNume = #130#14;  |HAZ Conver13;  #576#20 = eaAlfa;
     enNume = #130#15;  |HAZ Conver13;  #576#21 = eaAlfa;
     enNume = #130#16;  |HAZ Conver13;  #576#22 = eaAlfa;
     enNume = #130#17;  |HAZ Conver13;  #576#23 = eaAlfa;

     enNume = #130#19;  |HAZ Conver13;  #576#24 = eaAlfa;
     enNume = #130#20;  |HAZ Conver13;  #576#25 = eaAlfa;
     enNume = #130#21;  |HAZ Conver13;  #576#26 = eaAlfa;
     enNume = #130#22;  |HAZ Conver13;  #576#27 = eaAlfa;
     enNume = #130#18;  |HAZ Conver13;  #576#28 = eaAlfa;
     enNume = #130#23;  |HAZ Conver13;  #576#29 = eaAlfa;

     nImporte = #130#23;
     |HAZ TDeclaracion130_2008_04;

     |SI #130#4 > 0;
         #576#37 = #4#20;
         #576#38 = #4#21;
     |FINSI;

     eaAlfa  = #0#7;  |HAZ FechaBonito;
     #576#46 = eaDiaB;
     #576#47 = eaMesB;
     #576#48 = eaAnyoB;
     #576#49 = &13 + &10;

     |SI nTecla = 1;
         #576#7  = "";
         #576#37 = "";
         #576#39 = "";
         #576#40 = "";
         #576#41 = "";
         #576#42 = "";
         #576#43 = "";
         #576#44 = "";
         nTCampo = 49;
     |FINSI;

     |SI nTecla = 3;
         #576#2  = "";
         #576#3  = "";
         #576#5  = "";
         #576#45 = "";
         #576#46 = "";
         #576#47 = "";
         #576#48 = "";
         #576#49 = "";
         nTCampo = 48;
     |FINSI;

     |SI nTecla = 1;  |O nTecla = 3;
         aAlfa = "";
         |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #576nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         |XCIERRA nHandle2;

         |SI nTecla = 1;
             eaFOrigen  = eaPathEmision + "130" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza + "130" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             |HAZ CargaImprime130;
         |FINSI;

         |SI nTecla = 3;
             eaFOrigen  = eaPathEmision + "130" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathInternet + "130" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             |HAZ GrabaImpreso;
         |FINSI;
     |SINO;
         |PRINT;
         |PIEINF;
     |FINSI;
|FPRC;

|PROCESO QueHacemos130;
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #130;
     #130#0 = #4#0;
     #130#1 = #4#1;
     #130#2 = #4#2;
     #130#3 = #4#3;
     #130#4 = #4#4;
     #130#5 = 0;
     |LEE 040#130=;
     |SI FSalida ! 0;  |CIERRA #130;  |ACABA;  |FINSI;
     |CIERRA #130;

     |SI nTecla = 1;  |O nTecla = 3;
         aAbre = eaPathEmision + "130" + (("00000" + #999#0) % -105) + ".TXT";
         |XABRE "BW", aAbre, nHandle2;
     |FINSI;

     enCodCli = #130#0;
     |HAZ LeePersona;

     |SI #0#6 [ 2001;
         |HAZ Carga130_2001;
     |FINSI;

     |SI #0#6 ] 2002;  |Y #0#6 [ 2006;
         |HAZ Carga130_2002;
     |FINSI;

     |SI #0#6 = 2007;
         |HAZ Carga130_2007;
     |FINSI;

     |SI #0#6 ] 2008;
         |SI #0#4 ] 4;
             |HAZ Carga130_2008_04;
         |SINO;
             |HAZ Carga130_2007;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmow014C130;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos130;
|FIN;

|DEFBUCLE dsmow014N130;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos130;
|FIN;

|PROCESO AbreImprime130;
     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "CD " + eaPathLanza + &13 + &10;    |XGRABA nHandle1, aAlfa;

     aAlfa    = #0#6;
     aAlfa    = aAlfa % -102;
     aVersion = "";

     |SI #0#6 ] 2008;
         aVersion = "01";
         |SI #0#6 = 2008;
             |SI #0#4 ] 4;
                 aVersion = "02";
             |FINSI;
         |FINSI;
     |FINSI;

     |SI aVersion = "";
         aAlfa = "ZLS" + aAlfa + "MPF.EXE -y" + &13 + &10;
     |SINO;
         aAlfa = "Z" + aAlfa + aVersion + "MPF.EXE -y" + &13 + &10;
     |FINSI;
     |XGRABA nHandle1, aAlfa;

     |SI #0#6 ] 2002;
         aAlfa = "MOVE ERRORM~1.TXT ERRORMIPF.TXT" + &13 + &10;      |XGRABA nHandle1, aAlfa;
         aAlfa = "MOVE EAN128~1.DLL EAN128_32.DLL" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     |FINSI;
|FPRC;

|PROCESO EmiteEsto130_2001;
     aAlfa = "DEL die*.*" + &13 + &10;  |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.exe"  + &13 + &10;  |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.tab"  + &13 + &10;  |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.imp"  + &13 + &10;  |XGRABA nHandle1, aAlfa;
     |XCIERRA nHandle1;

     |DBASS aModelos;  |QBT aModelos;
     aModelos   = aModelos + "basica/";
     eaFOrigen  = aModelos + "patrones/zls01mpf.exe";
     eaFDestino = eaPathLanza + "zls01mpf.exe";
     |HAZ CopiaFichero;

     aAlfa = eaPathLanza + "IMPRIME";
     |RSYSTEM aAlfa;

     eaFichError = "err";
     eaFichDatos = #0#0;
     eaFichAuxil = "";

     |HAZ BuscaErroresL;
|FPRC;

|PROCESO EmiteEsto130_2002;
     aAlfa = "DEL *.wmf" + &13 + &10;             |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.tab"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.dll"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errorm~1.txt" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errormipf.txt"  + &13 + &10;    |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errmipf.txt"  + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.exe"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     |XCIERRA nHandle1;

     |HAZ Copiampf;


     aAlfa = eaPathLanza + "IMPRIME";
     |RSYSTEM aAlfa;

     eaFichError = "err";
     eaFichDatos = #0#0;
     eaFichAuxil = "";

     |HAZ BuscaErroresL;
|FPRC;

|PROCESO Boton1301;
     |PTEC 824;
|FPRC;

|PROCESO Boton1302;
     |PTEC 825;
|FPRC;

|PROCESO Boton1303;
     |PTEC 826;
|FPRC;

|PROCESO Boton1304;
     |PTEC 827;
|FPRC;

|PROCESO Boton1305;
     |PTEC 806;
|FPRC;

|PROCESO Botones130;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision Papel Oficial Laser          ", 0513, 0754, Boton1301;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Emision Papel Oficial Continuo       ", 0913, 1154, Boton1302;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Presentacion Telematica              ", 1313, 1554, Boton1303;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Informe de Comprobacion              ", 1713, 1954, Boton1304;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton1305;
     nBoton5 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTecla = 1;   |SAL;  |FINSI;
         |SI aTecla = aF3;  nTecla = 2;   |SAL;  |FINSI;
         |SI aTecla = aF4;  nTecla = 3;   |SAL;  |FINSI;
         |SI aTecla = aF5;  nTecla = 4;   |SAL;  |FINSI;
         |SI aTecla = aF6;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;

     |PULSATECLA;
|FPRC;

|PROGRAMA;
     aFichero = ("000" + Usuario) % 108;
     |NOME_DAT #0 aFichero;

     aFichero = ("imp" + Usuario) % 108;
     |NOME_DAT #999 aFichero;

     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     |ABRE #0;
     |LEE 000#0p;
     |CIERRA #0;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |SI eaParametro ! "130C";
         |HAZ Botones130;
     |SINO;
         nTecla = 4;
     |FINSI;

     |SI nTecla = 0;  |ACABA;  |FINSI;

     |SI nTecla = 1;
         |HAZ CompruebaEjecutable;
         |SI enError = 1;  |ACABA;  |FINSI;

         |SI #0#6 [ 2001;
             |PARA;  |SI;  |HACIENDO;
                  |DDEFECTO #600;
                  |PINPA #0#600;
                  |PINDA #0#600;
                  |ENDATOS #1#600;
                  |SI FSalida = 0;
                      |HAZ AbreImprime130;
                      |SAL;
                  |FINSI;
             |SIGUE;
         |SINO;
             |PARA;  |SI;  |HACIENDO;
                  #601#0 = #107#5;
                  #601#1 = #107#7;

                  |C_M #601#0, 1, "S";
                  |C_M #601#1, 1, "S";
                  |SI #107#6 = "N";  |C_M #601#0, 1, "N";  |FINSI;
                  |SI #107#8 = "N";  |C_M #601#1, 1, "N";  |FINSI;

                  nPedirPanta = 0;
                  |SI #107#6 = "N";  |Y #107#8 = "N";  |Y #107#7 = "N";
                      nPedirPanta = 1;
                  |FINSI;

                  FSalida = 0;
                  |SI nPedirPanta = 0;
                      |PINPA #0#601;
                      |PINDA #0#601;
                      |ENDATOS #1#601;
                  |FINSI;

                  |SI FSalida = 0;
                      |HAZ AbreImprime130;
                      |SAL;
                  |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;

     |SI nTecla = 2;
         |MENAV "     Opcion no instalada";
         |ACABA;
     |FINSI;

     |SI nTecla = 4;
         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |SI #0#6 ] 2008;
             |SI #0#4 ] 4;
                 |INFOR "m130co04";
             |SINO;
                 |INFOR "m130co03";
             |FINSI;
         |FINSI;
         |SI #0#6 = 2007; |INFOR "m130co03";  |FINSI;
         |SI #0#6 ] 2002; |Y #0#6 [ 2006;  |INFOR "m130co02";  |FINSI;
         |SI #0#6 [ 2001;  |INFOR "m130co01";  |FINSI;

         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     nSwLee = 0;
     |SI #0#8 = "C";
         |BUCLE dsmow014C130;
     |SINO;
         |BUCLE dsmow014N130;
     |FINSI;

     |SI nTecla = 1;
         |SI #0#6 [ 2001;
             |HAZ EmiteEsto130_2001;
         |FINSI;

         |SI #0#6 ] 2002;
             |HAZ EmiteEsto130_2002;
         |FINSI;
     |FINSI;

     |SI nTecla = 3;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;

     |SI nTecla = 4;
         |FININF;
         |FINIMP;
     |FINSI;
|FPRO;
