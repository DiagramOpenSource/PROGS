|FICHEROS;
    dsmoy027 #0;

    dsmom001 #1;
    dsmom004 #4;
    dsmom038 #38;

    dsm193ca #193;
    dsm193li #194;
    dsmom107 #107;

    :/basica/def/agim0024 #24;
    :/basica/def/agim0026 #26;
    :/basica/def/agim0029 #29;

    :/integral/def/dsam0003 #300;

    &regisnif@ #709;
    &clientes@ #715;

    dsmow036 #36;
    dsmow014 #999;
|FIN;

|VARIABLES;
     &eaParam  = "";
     nSwGraba  = 0;
     nCampo    = 0;
     nDEmpresa = 0;
     nHEmpresa = 0;
     nEjer     = 0;

     informe = "";
     aAlfa1    = "";
     aAlfa2    = "";
     aAlfa3    = "";
     aFichero  = "";
     aPath     = "";
     eaMoneda = "";
     &eaTMoneda = "";
     aElDni    = "";
     aAlfa     = "";

     &periodo = 0;
     &codemp = "";
     &nomrep = "";
     &dnirep = "";
     &carrep = "";
     &nomemp = "";
     &dniemp = "";
     &domemp = "";
     &munemp = "";
     &cpoemp = "";
     &proemp = "";
     &nomtra = "";
     &dnitra = "";
     &domtra = "";
     &muntra = "";
     &cpotra = "";
     &protra = "";

     fecsys  = @;
     &fletra = "";
     &fprese = @;

     nContador = 0;
     aSClave  = "";
     aClave   = "";
     aClave1  = "";
     aClave2  = "";
     aClave3  = "";

     &tbases1 = 0;
     &tbases2 = 0;
     &tbases3 = 0;
     &tbases4 = 0;
     &tbases5 = 0;
     &tbases6 = 0;
     &treten1 = 0;
     &treten2 = 0;
     &treten3 = 0;
     &treten4 = 0;
     &treten5 = 0;
     &treten6 = 0;
     &trep1 = 0;
     &trep2 = 0;
     &trep3 = 0;
     &trep4 = 0;
     &tdescue = 0;
     &texenta = 0;
     &letrai = 0;
     &clave1  = "";
     &clave2  = "";
     &clave3  = "";
     &clave4  = "";
     &especie1    = "";
     &especie2    = "";
     &especie3    = "";
     &xespe4      = "";
     &xespe5      = "";
     &xespe6      = "";
     &xespe7      = "";
     &eaPathIntegral = "";
     &eaCodRenta     = "";

     SwPrimer  = 0;
      enSwHay  = 0;
     sw_valido = 0;
     nVale     = 0;
     nHayRepre = 0;
     nLectura  = 0;
     nDComple  = 0;
     nHComple  = 0;
     aBase     = "";
     nCanal    = 0;
     aCampo10  = "";
|FIN;

|INCLUYE i_variar;
|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO CodigoRenta;
     |DBASS aBase;  |QBF aBase;
     aAlfa = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathIntegral  = aBase + "integral/";
     |FINSI;

     |C_M #0#33, 1, "S";
     |SI eaPathIntegral = "";
         |C_M #0#33, 1, "N";  #0#33 = "N";  |PINTA #0#33;
     |SINO;
         |SI #0#15 = 1;
             |C_M #0#33, 1, "N";  #0#33 = "N";  |PINTA #0#33;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO T7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#0 = enEmpresa;  |PINTA #0#0;
         #0#1 = enEmpresa;  |PINTA #0#1;

         |C_M #0#0, 1, "N";
         |C_M #0#1, 1, "N";
     |FINSI;
     aAlfa1 = #0#16; aAlfa1 = aAlfa1 % -104;
     #0#14 = aAlfa1;
     #0#14 = #0#14 - 1;
     |PINTA #0#14;
|FPRC;

|PROCESO Parrilla;
     |SI #0#0 = 0;
         #0#0 = 0;  |PINTA #0#0;
         #0#1 = 0;  |PINTA #0#1;  |C_M #0#1, 1, "N";
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#0, 1, "S";
             |C_M #0#1, 1, "S";
         |FINSI;

         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO DesdeDni;
     |SI #0#19 = "            ";
         #0#20 = "zzzzzzzzzzzz";  |C_M #0#20,1,"N"; |PINTA #0#20;
         |PARA nCampo = 21;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |C_M #0#20,1,"S";
         |PARA nCampo = 21;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = ""; |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasDni;
     |SI #0Campo = "            ";
         |PARA nCampo = Campo + 1;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = "";  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;


|PROCESO leecargo;
 |ABRE #29;
 #29#0 = #0Campo;
 |LEE 001#29=;
 |SI FSalida = 0;
     #0#17 = #29#1; |PINTA #0#17;
 |FINSI;
 |CIERRA #29;
|FPRC;

|| /////////////////////// //////////////////////////////////////////////////
|| /////////////////////// PROCESOS DE INFORMES \\\\\\\\\\\\\\\\\\\\\
|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

|PROCESO ElTrabajador;
 especie1 = "";
 especie2 = "";
 especie3 = "";
 xespe4   = "N";
 xespe5   = "N";
 xespe6   = "";
 xespe7   = "";

 tbases1 = 0;
 tbases2 = 0;
 tbases3 = 0;
 tbases4 = 0;
 tbases5 = 0;
 tbases6 = 0;

 treten1 = 0;
 treten2 = 0;
 treten3 = 0;
 treten4 = 0;
 treten5 = 0;
 treten6 = 0;

 trep1 = 0;
 trep2 = 0;
 trep3 = 0;
 trep4 = 0;

 tdescue = 0;
 texenta = 0;
 aClave1 = "";
 aClave2 = "";
 aClave3 = "";
 aClave  = "";

 nContador = 0;

 aElDni = #194#6;

 eaCodNif = #194#6;
 |HAZ LeeNifs;

 nomtra = #709#1;
 dnitra = aElDni;

 aAlfa1 = #709#9; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa1 = aAlfa1 + " "; |FINSI;
 aAlfa2 = #709#2; |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa2 = aAlfa2 + " "; |FINSI;
 aAlfa3 = #709#3;
 domtra = aAlfa1 + aAlfa2 + aAlfa3;
 muntra = #709#6;
 protra = #709#7;

 aAlfa1 = #709#4; |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
 aAlfa2 = #709#5; |QBF aAlfa2; aAlfa2 = ("000" + aAlfa2) % -103;
 cpotra = aAlfa1 + aAlfa2;

 eaCodRenta = "";
 |SI #0#33 = "S";
     |HAZ LeeCodRenta;
 |FINSI;
|FPRC;

|| **********************************************************************
____________________________________/ CALCULOS DE LECTURA E IMPRESION


||/////////////////////////////////////////////////////////////////////////
||///// Calculos para el Tipo 1 de Informe ////////////////////////////////
||/////////////////////////////////////////////////////////////////////////
|PROCESO Imprimir;
     letrai = 0;
     clave1 = aClave1;
     clave2 = aClave2;
     clave3 = aClave3;
     |PRINT;
     |PIEINF;
|FPRC;

|PROCESO Man193Li;
 |SI #0#19 = "            ";
     nVale = 0;
     |PARA nCampo = 21; |SI nCampo [ 28; |HACIENDO nCampo = nCampo + 1;
           |SI #0nCampo ! "            ";
               nVale = 1;
               |SI #0nCampo = #194#6;
                   nVale = 2;
                   |SAL;
               |FINSI;
           |FINSI;
     |SIGUE;
 |FINSI;
 |SI nVale = 1; |ACABA; |FINSI;

 |SI SwPrimer = 0;
     |HAZ ElTrabajador;
     SwPrimer = 1;
 |FINSI;

 |SI aElDni ! #194#6;
     |HAZ Imprimir;
     |HAZ ElTrabajador;
 |FINSI;

|| ............................. Sumo Cantidades donde van
     |SI aClave ! #194#8;
         aClave = #194#8;
         nContador = nContador + 1;
     |FINSI;

     |SI nContador > 3;  |ERROR10;  |ACABA;  |FINSI;

     tdescue = tdescue + #194#22;                 || seg.social

     aCampo10 = "N"; |SI #194#10 = 2; aCampo10 = "S"; |FINSI;

     |SI aClave1 = "";
         |HAZ Suma1;
     |SINO;
         |SI aClave1 = #194#8;
             |HAZ Suma1;
         |SINO;
             |SI aClave2 = "";
                 |HAZ Suma2;
             |SINO;
                 |SI aClave2 = #194#8;
                     |HAZ Suma2;
                 |SINO;
                     |HAZ Suma3;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
     |SI #194#8 = "B";
         |SI #194#27 ! 0; |O #194#28 ! 0;
             |SI aCampo10 = "S";
                  trep3 = trep3 + #194#27;
                  trep4 = trep4 + #194#28;
                  xespe5 = "S";
                  xespe7 = "En Especie";
             |SINO;
                  trep1 = trep1 + #194#27;
                  trep2 = trep2 + #194#28;
                  xespe5 = "S";
                  xespe6 = "Dinerarias"
             |FINSI;
         |FINSI;
    |FINSI;

|FPRC;

|PROCESO Suma1;
         |SI aCampo10 = "N";
             tbases1 = tbases1 + #194#23;     || bases
             treten1 = treten1 + #194#25;     || cuota
         |SINO;
             tbases4 = tbases4 + #194#23;     || bases
             treten4 = treten4 + #194#25;     || cuota
             xespe4 = "S";
         |FINSI;
         aClave1 = #194#8;
|FPRC;

|PROCESO Suma2;
         |SI aCampo10 = "N";
             tbases2 = tbases2 + #194#23;     || bases
             treten2 = treten2 + #194#25;     || cuota
         |SINO;
             tbases5 = tbases5 + #194#23;     || bases
             treten5 = treten5 + #194#25;     || cuota
             xespe4 = "S";
         |FINSI;
         aClave2 = #194#8;
|FPRC;

|PROCESO Suma3;
         |SI aCampo10 = "N";
             tbases3 = tbases3 + #194#23;     || bases
             treten3 = treten3 + #194#25;     || cuota
         |SINO;
             tbases6 = tbases6 + #194#23;     || bases
             treten6 = treten6 + #194#25;     || cuota
             xespe4 = "S";
         |FINSI;
         aClave3 = #194#8;
|FPRC;

|DEFBUCLE Man193Li;
     #194#1;
     ;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,#0#19,0000,"A","  ",1;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,#0#20,9999,"C","zz",2;
     ;
     NULL, Man193Li;
|FIN;

||/////////////////////////////////////////////////////////////////////////
||///// Calculos para el Tipo 2 de Informe ////////////////////////////////
||/////////////////////////////////////////////////////////////////////////
|PROCESO LeeCodRenta;

 eaCodRenta = "";
     |ABRE #300;
     |SELECT #2#300;
     #300#1 = aElDni;
     |LEE 040#300=;
     |SI FSalida = 0;
         eaCodRenta = "Codigo de Renta : " + (("00000" + #300#0) % -105);
     |SINO;
         |SELECT #3#300;
         #300#35 = #36#0;
         |LEE 040#300=;
         |SI FSalida = 0;
             eaCodRenta = "Codigo de Renta : " + (("00000" + #300#0) % -105);
         |FINSI;
     |FINSI;
     |CIERRA #300;

|FPRC;

|PROCESO ElAuxw36;
 |SI SwPrimer = 0; |O aElDni ! #36#0;
     #194#6  = #36#0;
     |HAZ ElTrabajador;
     SwPrimer = 1;
 |FINSI;

 |ABRE #38;
 |DDEFECTO #38;
 #38#0 = #36#1;
 #38#1 = #36#2;
 |LEE 001#38=;
 |CIERRA #38;

 |PRINT;
 |PIEINF;
|FPRC;

|DEFBUCLE ElAuxw36;
 #36#1;
 ;
 "            ", " ", "  ";
 "zzzzzzzzzzzz", "z", "zz";
 ;
 NULL, ElAuxw36;
|FIN;

|PROCESO Imprimir_2;
   aElDni = "";
   SwPrimer = 0;
   aElDni   = "";
   |BUCLE ElAuxw36;
|FPRC;

||\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
|PROCESO FechaPres;
 |ABRE #4;
 #4#0 = #193#0;
 #4#1 = #193#1;
 #4#2 = #193#2;
 #4#3 = #193#3;
 #4#4 = #193#4;
 |LEE 000#4=;
 fprese = #4#10;
 |CIERRA #4;
|FPRC;


|PROCESO BuscaCargo193;
   nomrep = #26#4;
   dnirep = #26#3;
   carrep = #26#17;
|FPRC;

|DEFBUCLE agim0026;
    #26#1;
    16;
    #193#0, 01, 01, #0#32;
    #193#0, 99, 99, #0#32;
    ;
    NULL, BuscaCargo193;
|FIN;

|PROCESO BuscaCargo193R;
     nomrep = #24#4;
     dnirep = #24#3;
     carrep = "REPRESENTANTE";
     nHayRepre = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE agim0024;
     #24#2;
     ;
     #193#0, 99, 01;
     #193#0, 01, 99;
     ;
     NULL, BuscaCargo193R;
|FIN;

|PROCESO BuscaComuneros;
     aAlfa = "31.12." + #193#1;
     |SI #1#8 > aAlfa;  |ACABA;  |FINSI;

     aAlfa = "01.01." + #193#1;
     |SI #1#9 ! "01.01.0000";
         |SI #1#9 < aAlfa;  |ACABA;  |FINSI;
     |FINSI;

     nHayRepre = 1;

     enCodCli = #1#3;
     |HAZ LeePersona;

     |SI enSwDeDonde = 1;
         nomrep = #715#1;
         dnirep = #715#3;
         carrep = "REPRESENTANTE";
     |SINO;
         nomrep = #715#1;
         dnirep = #715#13;
         carrep = "REPRESENTANTE";
     |FINSI;

     |ERROR10;
|FPRC;

|DEFBUCLE dsmom001;
     #1#1;
     ;
     #193#0, 01, 0001;
     #193#0, 99, 9999;
     ;
     NULL, BuscaComuneros;
|FIN;

|PROCESO Man193Li_2;
     |SI #0#19 = "            ";
         nVale = 0;
         |PARA nCampo = 21; |SI nCampo [ 28; |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo ! "            ";
                   nVale = 1;
                   |SI #0nCampo = #194#6;
                       nVale = 2;
                       |SAL;
                   |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;

     |SI nVale = 1; |ACABA; |FINSI;

     |SI SwPrimer = 0; |O aElDni ! #194#6;
         aElDni = #194#6;
         SwPrimer = 1;
     |FINSI;

     || ............................. Sumo Cantidades donde van

     aClave  = #194#8;
     aSClave = #194#9;

     #36#0 = aElDni;
     #36#1 = aClave;
     #36#2 = aSClave;
     |LEE 001#36=;
     |SI FSalida ! 0;
         |DDEFECTO #36;
         #36#0 = aElDni;
         #36#1 = aClave;
         #36#2 = aSClave;
         |GRABA 020#36c;
     |FINSI;

     |SI #194#7 ! 0;
          |SI #36#13 = 0; |O #36#13 = #194#7;
              #36#13 = #194#7;
              #36#14 = #36#14 + #194#25;
              #36#15 = #36#15 + #194#23;
             |SINO;
                 |SI #36#16 = 0; |O #36#16 = #194#7;
                     #36#16 = #194#7;
                     #36#17 = #36#17 + #194#25;
                     #36#18 = #36#18 + #194#23;
                 |SINO;
                     |SI #36#19 = 0; |O #36#19 = #194#7;
                         #36#19 = #194#7;
                         #36#20 = #36#20 + #194#25;
                         #36#21 = #36#21 + #194#23;
                     |SINO;
                         |SI #36#22 = 0; |O #36#22 = #194#7;
                             #36#22 = #194#7;
                             #36#23 = #36#23 + #194#25;
                             #36#24 = #36#24 + #194#23;
                         |FINSI;
                     |FINSI;
                 |FINSI;
             |FINSI;
     |SINO;
             |SI #194#10 = 1;
                 #36#3 = #36#3 + #194#23;
                 #36#4 = #36#4 + #194#25;
             |FINSI;
             |SI #194#10 = 2;
                 #36#5 = #36#5 + #194#23;
                 #36#6 = #36#6 + #194#25;
                 #36#7 = #36#7 + #194#26;
             |FINSI;
     |FINSI;

     #36#8 = #36#8 + #194#22;

     |GRABA 020#36a;
|FPRC;

|DEFBUCLE Man193Li_2;
     #194#1;
     ;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,#0#19,0000,"A","  ",1;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,#0#20,9999,"C","zz",2;
     ;
     NULL, Man193Li_2;
|FIN;

|PROCESO Man193C;
     |SI nLectura = 0;
         |SI #193#4 ! 0;
             |SI #193#14 = "S";
                 nDComple = #193#4;
                 nHComple = #193#4;
             |SINO;
                 nHComple = #193#4;
             |FINSI;
         |SINO;
             nDComple = #193#4;
             nHComple = #193#4;
         |FINSI;
         |ACABA;
     |FINSI;

     codemp = "";
     nomrep = "";
     dnirep = "";
     carrep = "";
     nomemp = "";
     dniemp = "";
     domemp = "";
     munemp = "";
     cpoemp = "";
     proemp = "";

     |SI #107#1 = "S";
         |BUCLE agim0026;
     |SINO;
         nHayRepre = 0;
         |BUCLE agim0024;
         |SI nHayRepre = 0;
             |BUCLE dsmom001;
             |SI nHayRepre = 0;
                 nomrep  = #999#3;
                 carrep  = "TITULAR";
             |FINSI;
         |FINSI;
    |FINSI;

    codemp = #193#0; |QBF codemp; codemp = ("00000" + codemp) % -105;
    enCodCli = #193#0;
    |HAZ LeePersona;

    |SI enSwDeDonde = 1;
          nomemp = #715#2;
          dniemp = #715#3;
          aAlfa1 = #715#29; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa1 = aAlfa1 + " "; |FINSI;
          aAlfa2 = #715#30; |QBF aAlfa2; aAlfa2 = aAlfa2 + " ";
          aAlfa3 = #715#31;
          domemp = aAlfa1 + aAlfa2 + aAlfa3;
          munemp = #715#37;
          aAlfa1 = #715#35;  |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
          aAlfa2 = #715#36; |QBF aAlfa2; aAlfa2 = ("000" + aAlfa2) % -103;
          cpoemp = aAlfa1 + aAlfa2;
          proemp = #715#38;
     |SINO;
          nomemp = #715#1;
          dniemp = #715#13;
          aAlfa1 = #715#3; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa1 = aAlfa1 + " "; |FINSI;
          aAlfa2 = #715#4; |QBF aAlfa2; aAlfa2 = aAlfa2 + " ";
          aAlfa3 = #715#5;
          domemp = aAlfa1 + aAlfa2 + aAlfa3;
          munemp = #715#11;
          aAlfa1 = #715#9;  |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
          aAlfa2 = #715#10; |QBF aAlfa2; aAlfa2 = ("000" + aAlfa2) % -103;
          cpoemp = aAlfa1 + aAlfa2;
          proemp = #715#12;
     |FINSI;

     periodo = #0#14;

     aAlfa1 = #0#16;
     fecsys = aAlfa1 % 2;    || pasa la fecha a letras
     fletra = fecsys % 11;   || coge la parte literal de la fecha
     aAlfa1 = munemp; |QBF aAlfa1;
     fletra = aAlfa1 + ", a " + fletra;  || une la localidad a la fecha literal
     |HAZ FechaPres;

     |SI #0#15 = 1;
         SwPrimer = 0;
         aElDni   = "";
         |BUCLE Man193Li;
         |SI SwPrimer = 1;
             |HAZ Imprimir;
         |FINSI;
    |SINO;
         |DELINDEX #36;
         SwPrimer = 0;
         aElDni   = "";
         |ABRE #36;
         |BUCLE Man193Li_2;
         |CIERRA #36;
         |SI SwPrimer = 1;
             |HAZ Imprimir_2;
         |FINSI;
    |FINSI;
|FPRC;

|DEFBUCLE Man193C;
     #193#1;
     ;
     #999#0, #999#1, #999#2, #0#30, nDComple, 00;
     #999#0, #999#1, #999#2, #0#30, nHComple, 99;
     ;
     NULL, Man193C;
|FIN;

|PROCESO Imprime;
    enEmpresa = #999#0;
    enSwHay   = enSwHay + 1;

    nDComple  = 0;
    nHComple  = 99;

    nLectura  = 0;  |BUCLE Man193C;
    nLectura  = 1;  |BUCLE Man193C;
|FPRC;

|DEFBUCLE dsmow014M;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, Imprime;
|FIN;

|| ///////////////////////////////////////////////////
|PROCESO GrabaTempo;
    enCodCli = #4#0;
    |HAZ LeePersona;

    #999#0  = #4#0;
    #999#1  = #4#1;
    #999#2  = #4#2;
    |LEE 101#999=;
    |SI FSalida ! 0;
        |DDEFECTO #999;
        #999#0  = #4#0;
        #999#1  = #4#1;
        #999#2  = #4#2;
        |GRABA 020#999b;
    |FINSI;

    #999#3  = #715#1;
    #999#4  = "ANUAL";
    #999#5  = #0#30;
    #999#6  = "S";
    #999#7  = #4#4;
    |GRABA 020#999a;
    |LIBERA #999;

    nSwGraba = 1;
|FPRC;

|DEFBUCLE dsmom004;
     #4#1;
     ;
     nDEmpresa, #0#14, #0#31, #0#30, 00;
     nHEmpresa, #0#14, #0#31, #0#30, 99;
     ;
     NULL, GrabaTempo;
|FIN;

|PROCESO IT3;  |TIPO 3;
     |SI #0#29 = "PESETAS";
         eaTMoneda = "Ptas.";
     |SINO;
         eaTMoneda = "Euros";
     |FINSI;
     eaMoneda = #0#29;

     #0#15 = 1; || Formato (1)

     informe =  "dsmoy027";
     || .. |SI #0#15 = 2; informe = "dsmoy127";  |FINSI;

     enEjer      = #0#14;        || A¤o Calculo
     aAlfa1      = #0#14;
     aAlfa1      = aAlfa1 % -102;
     nEjer       = aAlfa1;       || Dos ultimos digitos del A¤o

     aFichero = ("cer" + Usuario) % 108;
     |NOME_DAT #999 aFichero;
     |ABRE #999;  |CIERRA #999;  |DELINDEX #999;

     aFichero = ("w36" + Usuario) % 108;
     |NOME_DAT #36 aFichero;

     nSwGraba = 0;
     |ABRE #999;
     |SI #0#0 ! 0;
         nDEmpresa = #0#0;
         nHEmpresa = #0#1;
         |BUCLE dsmom004;
     |SINO;
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               nDEmpresa = #0nCampo;
               nHEmpresa = #0nCampo;
               |BUCLE dsmom004;
         |SIGUE;
     |FINSI;
     |CIERRA #999;

     |SI nSwGraba = 0;
          |MENAV "     Seleccion Vacia.";
          |DELINDEX #36;
          |DELINDEX #999;
          |ACABA;
     |FINSI;

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR informe;
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

     |ABRE #193;
     enSwHay = 0;
     |BUCLE dsmow014M;
     |CIERRA #193;
     |FININF;
     |FINIMP;

     |DELINDEX #36;
     |DELINDEX #999;
|FPRC;

||............... PROGRAMA ......................................

|PROGRAMA;

     eaParam = PARAMETRO; |QBF eaParam;
     |SI eaParam = "";
         eaParam = "193";
     |FINSI;
     #0#30 = eaParam;
     #0#31 = 99;

     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     |SI enEmpresa ! 0;
         |DDEFECTO #0;
         #0#0  = enEmpresa;
         #0#1  = enEmpresa;
         #0#14 = enEjer;
         |HAZ IT3;
     |SINO;
         |CLS;
         |MANTE #0;
     |FINSI;
|FPRO;
