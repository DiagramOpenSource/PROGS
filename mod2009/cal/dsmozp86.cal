|FICHEROS;
     dsmozp86 #0;

     dsmom030 #30;

     dsmom080 #80;
     dsmom081 #81;
     dsmom082 #82;
     dsmom083 #83;

     :/basica/def/agifigen #118;
     dsmod300 #300;
     dsmociva #400;
|FIN;

|VARIABLES;

     nDEmpresa = 0;
     nHEmpresa = 0;
     aDNom     = "";
     aHNom     = "";
     nEjer       = 0;
     nDPeriodo   = 0;
     nHPeriodo   = 0;
     nCampo      = 0;

     fFecIni     = @;
     fFecFin     = @;
     nSwAlgun    = 0;
     nSwPrint    = 0;
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aAlfa3      = "";
     aAlfa4      = "";
     fLaFecha    = @;
     &aEmpresa   = "";
     &eaNom      = "";
     &eaNif      = "";
     &nSwFich    = 0;
     aParam      = "";
     nSwSal      = 0;

     nPara1    = 0;
     nAnterior = 0;
     nPeriodo  = 0;
     nEst800   = 0;
     &enEjercicio = 0;
     aPassword  = "";

     fich_alta  = "";
     fich_copi  = "";
     aTraba1    = "";
     aTemporal1 = "";
     aTemporal2 = "";
|FIN;

|INCLUYE i_variar;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\
|CALCULO Eano; |TIPO 7;
|FCAL;

|PROCESO Periodo;
|FPRC;

|PROCESO Parrilla;
|FPRC;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|| **************************************************************************
|PROCESO LeePerAct;
  |SI #83#3 = 12;
      |BORRA 020#83a;
  |FINSI;
  |LIBERA #83;
|FPRC;

|DEFBUCLE LeePerAct;
 #83#1;
 ;
 #80#0, #80#1, 00, 12;
 #80#0, #80#1, 99, 12;
 be;
 NULL, LeePerAct;
|FIN;

|PROCESO LEmpresa;
  enEmpresa = #118#0;
  aEmpresa = #118#0; |QBF aEmpresa;
  aEmpresa = ("00000" + aEmpresa) % -105;
  eaNom    = #118#1;
  eaNif    = #118#13;

  |ABRE #80;
  |DDEFECTO #80;
  #80#0 = enEmpresa;
  #80#1 = enEjer;
  |LEE 001#80=;
  |SI FSalida ! 0;
      |CIERRA #80;
  |SINO;
      |CIERRA #80;

      |PINTA 2119, #80#0;
      |PINTA 2125, #118#1;
      |ABRE #82;
      |PARA nPara1 = 3; |SI nPara1 [ 12; |HACIENDO nPara1 = nPara1 + 3;
           #82#0 = #80#0;
           #82#1 = #80#1;
           #82#2 = nPara1;
           |LEE 001#82=;
           |SI FSalida = 0;
               |SI nPara1 = 12;
                   |BORRA 020#82a;
               |SINO;
                   #82#61 = "S";
                   |GRABA 020#82a;
               |FINSI;
           |FINSI;
           |LIBERA #82;
      |SIGUE;
      |CIERRA #82;
      |BUCLE LeePerAct;

      enPeriodo = 9;
      |SUB_EJECUTA_NP "dsmozp81;todo";
  |FINSI;
  #0#16 = "S";
  |SUB_EJECUTA_NP ":contagen/capasz01;808";
|FPRC;

|DEFBUCLE agifigen;
 #118#1;
 ;
 nDEmpresa;
 nHEmpresa;
 e;
 NULL, LEmpresa;
|FIN;


|PROCESO Varia800;
 |DDEFECTO #30;
 #30#1  = "SUBVENCION INMOVILIZADO";
 #30#4  = "S";
 #30#12 = 01;
 #30#13 = "LIBRO DE FACTURAS EMITIDAS";
 #30#17 = "S";
 #30#19 = "S";
 #30#20 = "740000000000";
 #30#21 = "SUBVENCIONES OFICIALES A EXPLOTCION";
 #30#22 = #30#20;
 #30#23 = #30#21;
 #30#24 = 02;
 #30#25 = "REGIMEN GENERAL U ORDINARIO";
 #30#78 =  1;
 #30#79 =  3;
 #30#80 =  4;
 #30#81 =  5;
 #30#82 =  6;
 #30#83 =  7;
 #30#84 =  8;
 #30#85 =  9;
 #30#86 = 10;
 #30#87 = 11;
 #30#88 = 12;
 #30#83 = 13;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;

     |SI #0#15 = "N"; |ACABA; |FINSI;

     enEjercicio = #0#3;
     |HAZ CopiaSeguridad;

     |ABRE #30;
     #30#0 = 808;
     |LEE 001#30=;
     |SI FSalida = 0;
         |BORRA 020#30a;
     |FINSI;

     |DDEFECTO #30;
     #30#0 = 806;
     |LEE 001#30=;
     nEst800 = FSalida;
     |SI nEst800 ! 0;
         #30#0 = 807;
         |LEE 001#30=;
         nEst800 = FSalida;
     |FINSI;
     |SI nEst800 ! 0;  |HAZ Varia800; |FINSI;

     #30#0  = 808;
     #30#2  = "SUBVENCION OFICIAL PARA LA ADQUISICION DEL INMOVILIZADO, O BIEN CON-";
     #30#3  = "CRETO, LA CUAL ENTRA EN EL CALCULO DE PRORRATA SI PROCEDE APLICARLA ";
     #30#73 = "U";
     #30#74 = "N";
     |GRABA 020#30n;
     |CIERRA #30;

     |CUADRO 2008 2266;
     |PINTA 2109, "Empresa:";

     aAlfa1 = #0#3;
     aAlfa1 = "01.01." + aAlfa1; fFecIni = aAlfa1;
     aAlfa1 = #0#3;
     aAlfa1 = "31.12." + aAlfa1; fFecFin = aAlfa1;

     nDPeriodo = 01;
     nHPeriodo = 12;
     enEjer    = #0#3;
     nDEmpresa = #0#4;
     nHEmpresa = #0#5;

     |IMPRE 0;

     |BUCLE agifigen;

     |FINIMP;
|FPRC;


|| ************************************************************
|PROCESO copiando;
  aTemporal1 = fich_copi + aTraba1 + ".ixx";
  aTemporal2 = fich_alta + aTraba1 + ".ixx";
  |COPIA_FICHERO aTemporal1,aTemporal2;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  aTemporal1 = fich_copi + aTraba1 + ".dat";
  aTemporal2 = fich_alta + aTraba1 + ".dat";
  |COPIA_FICHERO aTemporal1,aTemporal2;
  |SI FSalida ! 0;
      aTemporal2 = fich_alta + aTraba1 + ".ixx";
      |FBORRA aTemporal2;
      |ACABA;
  |FINSI;
  aTemporal1 = fich_copi + aTraba1 + ".ddx";
  aTemporal2 = fich_alta + aTraba1 + ".ddx";
  |COPIA_FICHERO aTemporal1,aTemporal2;
|FPRC;

|PROCESO CopiaSeguridad;

 |DFICB fich_copi;
 fich_alta = fich_copi + "segur";
 |MKDIR fich_alta;
 fich_alta = fich_alta + "/";

 aTraba1 = "dsmom080";  |HAZ copiando;
 aTraba1 = "dsmom081";  |HAZ copiando;
 aTraba1 = "dsmom082";  |HAZ copiando;
 aTraba1 = "dsmom083";  |HAZ copiando;
|FPRC;

|| ************************************************************

|PROGRAMA;

  aParam = PARAMETRO;
  |QBF aParam;

  |ABRE #0;
  |LEE 101#0p;
  |SI FSalida = 0;

      |SI #0#16 = "S"; |Y aParam = "";
          |CLS;
          |CUADRO 0501 2380;
          |BLANCO 0602 2279;
          |ATRI P; |PINTA 1025, "Proceso Ya Ejecutado!"; |ATRI 0;
          |PINTA 1310, "Para continuar introduzca Password: ";
          E_inf = "";
          E_sup = "20";
          aPassword = 1346 ? -1;
          |SI aPassword ! "<MYPASWD>   ";
              |MENAV "     Permiso denegado.";
          |SINO;
              #0#16 = "N";
          |FINSI;
       |FINSI;
       |SI #0#16 = "S";
           |LIBERA #0;
           |CIERRA #0;
           |ACABA;
       |FINSI;
  |SINO;
      |GRABA 020#0b;
  |FINSI;

  |SI aParam = "";
      |CLS;
      |PINPA #0#0;
      |PINDA #0#0;
      |ENDATOS #1#0;
  |SINO;
      |DDEFECTO #0;
      #0#15 = "S";
      |HAZ Tipo3;
  |FINSI;

  |GRABA 020#0a;
  |LIBERA #0;
  |CIERRA #0;
|FPRO;
