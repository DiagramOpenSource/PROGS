|FICHEROS;
     dsmoy000 #0;
     dsmom003 #3;
     dsmom004 #4;
     dsmom023 #23;
     dsmom024 #24;
     dsmom082 #82;
     dsmom108 #108;

     dsmow052 #952,MANTE;
     dsmow014 #999;
     :/integral/def/dsam0107 #107;
     :/integral/def/dsam0009 #109;

     dsmom107 #207; || control Modelos
     &clientes@ #715;
|FIN;

|VARIABLES;
     aDocRemoto    = "";
     aDocServidor  = "";
     aIPRemoto     = "";
     aPathMod      = "";
     aCarac        = "";
     aBarra        = "";
     aLongitud     = "";
     aJusti        = "";
     aExt          = "";
     aFich         = "";
     aFich1        = "";
     aFich2        = "";
     aPathLocal    = "";
     aPathServidor = "";
     aVersionBasico= "";
     aVersionJava  = "";
     aEjecutaJava  = "";

     nCaracter     = 0;
     nLongitud     = 0;
     nCanal        = 0;
     nHandleEjec   = 0;
     nHandError    = 0;
     nDelBucle     = 0;
     nEstadoM23    = 0;
     nCopia        = 0;
     nHandle       = 0;

     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDEjer    = 0;
     &enHEjer    = 0;
     &enDModelo  = 0;
     &enHModelo  = 0;
     &enHandle   = 0;
     &eaNomEnt   = "";
     &eaNomOfi   = "";

     {1}aContiene    = "";
     {1}version      = "";
|FIN;

|INCLUYE i_varemi;
|INCLUYE i_modhis;

|PROCESO Conver10;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = ("0000000000" + enNume) % -110;
     |SINO;
         enNume  = -enNume;
         eaAlfa = ("0000000000" + enNume) % -109;
         eaAlfa = "N" + eaAlfa;
     |FINSI;
|FPRC;

|PROCESO Conver12;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = ("000000000000" + enNume) % -112;
     |SINO;
         enNume  = -enNume;
         eaAlfa = ("000000000000" + enNume) % -111;
         eaAlfa = "N" + eaAlfa;
     |FINSI;
|FPRC;

|PROCESO Conver13;
     |SI #0#0 = 390;  |O #0#0 = 392;
         |SI #0#6 ] 2004;
             |SI enNume = 0;
                 eaAlfa = ("0000000000000" + enNume) % -113;
             |SINO;
                 eaAlfa = enNume;
             |FINSI;

             |ACABA;
         |FINSI;
     |FINSI;

     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = ("0000000000000" + enNume) % -113;
     |SINO;
         enNume  = -enNume;
         eaAlfa = ("000000000000" + enNume) % -112;
         eaAlfa = "N" + eaAlfa;
     |FINSI;
|FPRC;

|PROCESO Conver12Signo;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaSigno = " ";
         eaAlfa  = ("0000000000000" + enNume) % -112;
     |SINO;
         eaSigno = "N";
         enNume  = -enNume;
         eaAlfa  = ("0000000000000" + enNume) % -112;
     |FINSI;
|FPRC;

|PROCESO Conver13Signo;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaSigno = " ";
         eaAlfa  = ("0000000000000" + enNume) % -113;
     |SINO;
         eaSigno = "N";
         enNume  = -enNume;
         eaAlfa  = ("0000000000000" + enNume) % -113;
     |FINSI;
|FPRC;

|PROCESO Conver15;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = ("000000000000000" + enNume) % -115;
     |SINO;
         enNume  = -enNume;
         eaAlfa = ("00000000000000" + enNume) % -114;
         eaAlfa = "N" + eaAlfa;
     |FINSI;
|FPRC;

|PROCESO Conver15Signo;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaSigno = " ";
         eaAlfa  = ("000000000000000" + enNume) % -115;
     |SINO;
         eaSigno = "N";
         enNume  = -enNume;
         eaAlfa = ("000000000000000" + enNume) % -115;
     |FINSI;
|FPRC;

|PROCESO Conver17;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = ("00000000000000000" + enNume) % -117;
     |SINO;
         enNume  = -enNume;
         eaAlfa = ("0000000000000000" + enNume) % -116;
         eaAlfa = "N" + eaAlfa;
     |FINSI;
|FPRC;

|PROCESO QuitaRaros;
     nEspa   = 0;
     aCadena = "";
     aLong   = eaAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           |SI aCaracter = ",";  aCaracter = "";   nEspa = nEspa + 1;  |FINSI;

           |SI #0#0 ! 347;  |Y #0#0 ! 390;  |Y #0#0 ! 392;
               |SI aCaracter = ".";  aCaracter = " ";  |FINSI;
           |FINSI;

           |SI #0#0 = 390;  |O #0#0 = 392;
               |SI #0#6 [ 2003;
                   |SI aCaracter = ".";  aCaracter = " ";  |FINSI;
               |FINSI;
           |FINSI;

           |SI aCaracter = "/";  aCaracter = " ";  |FINSI;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &209; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena + (" " * nEspa);

     eaAlfa = eaAlfa > eaAlfa;
|FPRC;

|PROCESO QuitaRarosTfno;
     aCadena = eaAlfa % 101;
     |SI aCadena = "0";
         eaAlfa = eaAlfa % 215;
     |FINSI;

     aCadena = "";
     aLong   = eaAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           |SI aCaracter = "0";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "1";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "2";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "3";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "4";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "5";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "6";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "7";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "8";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "9";  aCadena = aCadena + aCaracter;  |FINSI;
     |SIGUE;
     eaAlfa = aCadena;  |QBT eaAlfa;
     eaAlfa = eaAlfa > eaAlfa;
|FPRC;

|PROCESO LeeTelefono;
     |ABRE #107;
     #107#0 = eaAlfa;
     #107#1 = enLinea;
     |LEE 040#107=;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     eaAlfa = #107#4;  |HAZ QuitaRarosTfno;
|FPRC;

|PROCESO FechaBonito;
     aAlfa1 = eaAlfa % 102;
     aAlfa2 = eaAlfa % 402;
     aAlfa3 = eaAlfa % 704;

     |SI aAlfa2 = "01";  aAlfa2 = "ENERO     ";  |FINSI;
     |SI aAlfa2 = "02";  aAlfa2 = "FEBRERO   ";  |FINSI;
     |SI aAlfa2 = "03";  aAlfa2 = "MARZO     ";  |FINSI;
     |SI aAlfa2 = "04";  aAlfa2 = "ABRIL     ";  |FINSI;
     |SI aAlfa2 = "05";  aAlfa2 = "MAYO      ";  |FINSI;
     |SI aAlfa2 = "06";  aAlfa2 = "JUNIO     ";  |FINSI;
     |SI aAlfa2 = "07";  aAlfa2 = "JULIO     ";  |FINSI;
     |SI aAlfa2 = "08";  aAlfa2 = "AGOSTO    ";  |FINSI;
     |SI aAlfa2 = "09";  aAlfa2 = "SEPTIEMBRE";  |FINSI;
     |SI aAlfa2 = "10";  aAlfa2 = "OCTUBRE   ";  |FINSI;
     |SI aAlfa2 = "11";  aAlfa2 = "NOVIEMBRE ";  |FINSI;
     |SI aAlfa2 = "12";  aAlfa2 = "DICIEMBRE ";  |FINSI;

     |QBF aAlfa2;
     eaFechaB = aAlfa1 + " de " + aAlfa2 + " de " + aAlfa3;
     eaDiaB   = aAlfa1;
     eaMesB   = aAlfa2;
     eaAnyoB  = aAlfa3;
|FPRC;

|PROCESO TraeWait;
     aPathLocal  = eaPathLanza;

     |DBASE aPathPdf;  |QBT aPathPdf;
     aPathPdf = aPathPdf + "modelospdf";                    |MKDIR aPathPdf;
     aOrigen  = aPathPdf   + "/wait.exe";
     aDestino = aPathLocal + "wait.exe";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;

     aOrigen  = aPathPdf   + "/dsprint.exe";
     aDestino = aPathLocal + "dsprint.exe";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CopiaFichero;
     aAlfa = "";
     |IP_REMOTO aAlfa;  |QBT aAlfa;
     |SI aAlfa ! "";
         |ENVIA_FICHERO eaFOrigen, eaFDestino;
     |SINO;
         |COPIA_FICHERO eaFOrigen, eaFDestino;
     |FINSI;
|FPRC;

|PROCESO CopiaFicheroXml;
     aContiene1 = eaFDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaFOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     nCopia    = 0;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaFOrigen, eaFDestino;
         |SINO;
             |COPIA_FICHERO eaFOrigen, eaFDestino;
         |FINSI;
         nCopia = 1;
     |FINSI;

     |XABRE "EC", eaFDestino, nHandleEjec;
     |SI FSalida < 0;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaFOrigen, eaFDestino;
         |SINO;
             |COPIA_FICHERO eaFOrigen, eaFDestino;
         |FINSI;
     |FINSI;

     |XABRE "EC", eaFDestino, nHandleEjec;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |SI nCopia = 1;
         |RDESCOMPRIME eaFDestino;

         eaFDestino = (eaFDestino - ".tgz") + ".tar";
         aPathMod   = eaPathLanza;
         |RDETAR eaFDestino, aPathMod;

         |RFBORRA eaFDestino;
     |FINSI;
|FPRC;

|RUTINA ClaveBaja952;
     #952#0 = "            ";
|FRUT;

|RUTINA ClaveAlta952;
     #952#0 = "zzzzzzzzzzzz";
|FRUT;

|PROCESO Tipo11w052;  |TIPO 11;
     |SI FSalida = 10;
         |SI eaExtension = "";
             aAlfa = "EDIT " + aPathSesion + #952#0;
         |SINO;
             aAlfa = "START " + aPathSesion + #952#0;
         |FINSI;

         |RSYSTEM aAlfa;
     |FINSI;

     |SI FSalida = 11;
         |SI #952#1 ! 0;
             aFichero = eaFichDatos + (#952#0 % 0412);
         |SINO;
             aFichero = eaFichDatos;
         |FINSI;

         |SI eaExtension = "";
             aAlfa = "EDIT " + aPathSesion + aFichero;
         |SINO;
             aAlfa = "START " + aPathSesion + aFichero;
         |FINSI;

         |RSYSTEM aAlfa;
     |FINSI;

     |SI FSalida = 12;
         |SI eaFichAuxil = "";  |ACABA;  |FINSI;

         |SI #952#1 ! 0;
             aFichero = eaFichAuxil + (#952#0 % 0412);
         |SINO;
             aFichero = eaFichAuxil;
         |FINSI;

         |SI eaExtension = "";
             aAlfa = "EDIT " + aPathSesion + aFichero;
         |SINO;
             aAlfa = "START " + aPathSesion + aFichero;
         |FINSI;

         |RSYSTEM aAlfa;
     |FINSI;
|FPRC;

|PROCESO BorraDirectorio;
     aDirSesion  = eaPathLanza;
     aFichero    = aDirSesion + "*";  |QBT aFichero;
     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;
            aAlfa = (aFichero % -104) < "";
            |SI aAlfa ! ".exe";   |Y aAlfa ! ".tgz";
             |Y aAlfa ! ".jar";   |Y aAlfa ! ".bat";
                |RFBORRA aFichero;
            |FINSI;
            |R_SDIR aFichero;
     |SIGUE;
|FPRC;

|PROCESO QuitaPath;
     aLong  = aFichero % 0;
     nLong  = aLong;
     aError = "";
     |PARA nCaracter = 1; |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (nCaracter * 100) + 1;
           aCaracter = aFichero % nPos;
           |SI aCaracter = "/";  |O aCaracter = "\";
               aError = "";
           |SINO;
               aError = aError + aCaracter;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO GrabaResumen;
  enModelo = #4#3;
  |HAZ SelModelo;
  |SI nSwModHis = 0; |ACABA; |FINSI;

  |ABRE #24;
  |ABRE #23;

  |ABRE #3;
  #3#0 = #4#0;
  #3#1 = #4#1;
  #3#2 = #4#2;
  |LEE 001#3=;
  |SI FSalida ! 0;    |DDEFECTO #3;  |FINSI;
  |CIERRA #3;

  #23#0 = #4#0;
  #23#1 = #4#1;
  #23#2 = #4#3;
  |LEE 101#23=;
  nEstadoM23 = FSalida;
  |SI nEstadoM23 ! 0;
      |DDEFECTO #23;
      #23#0 = #4#0;
      #23#1 = #4#1;
      #23#2 = #4#3;
      #23#3 = #0#1;
      |GRABA 020#23b;
  |FINSI;

  #24#0 = #4#0;
  #24#1 = #4#1;
  #24#2 = #4#2;
  #24#3 = #4#3;
  #24#4 = #4#4;
  |LEE 141#24=;
  |SI FSalida ! 0;
      |DDEFECTO #24;
      #24#0  = #4#0;
      #24#1  = #4#1;
      #24#2  = #4#2;
      #24#3  = #4#3;
      #24#4  = #4#4;
      #24#12 = #3#3;
      |GRABA 020#24b;
  |FINSI;

  #24#6 = #4#7;   ||Entrada
  #24#7 = #4#8;   ||Fecha Entrada
  #24#8 = #4#15;  ||Resultado
  |SI #24#8 ] 0;
      #24#9 = #24#8;
      #24#10 = 0;
      #24#11 = 0;
  |SINO;
       #24#9  = 0;
       aAlfa = #4#16; |QBF aAlfa;
       |SI aAlfa ! "";
           #24#11 = - #24#8;
           #24#10 = 0;
       |SINO;
           #24#10 = - #24#8;
           #24#11 = 0;
       |FINSI;
   |FINSI;

   aAlfa = #24#3; aAlfa = aAlfa % 101;
   |SI aAlfa ! "3";
       enImpReal = #24#8;
   |SINO;
       #24#9  = enIngresar;
       #24#10 = enDevolver;
       #24#11 = enCompensar;
       #24#13 = enImpReal;
       #24#14 = enCas21;
       #24#15 = enCas27;
       #24#16 = enCas31;
       #24#17 = enCas34;
   |FINSI;
   #24#13 = enImpReal;
   |GRABA 020#24a;
   |LIBERA #24;
   |CIERRA #24;

   |SI nEstadoM23 ! 0;
       #23#4 = #23#4 + #24#9;
       #23#5 = #23#5 + #24#10;
       #23#6 = #23#4 - #23#5;
       |GRABA 020#23a;
   |FINSI;
   |LIBERA #23;
   |CIERRA #23;

   |SI nEstadoM23 = 0;
       enDEmpresa = #23#0; enHEmpresa = #23#0;
       enDEjer    = #23#1; enHEjer    = #23#1;
       enDModelo  = #23#2; enHModelo  = #23#2;
       |HAZ ReCalculaHis;
   |FINSI;

   enImpReal = 0;
   enCas21 = 0;
   enCas27 = 0;
   enCas31 = 0;
   enCas34 = 0;
   enIngresar = 0;
   enDevolver = 0;
   enCompensar= 0;
|FPRC;

|PROCESO DesGrabaImpreso;
     |ABRE #207;
     |DDEFECTO #207;
     |LEE 000#207p;
     |CIERRA #207;

     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 101#4=;
     |SI FSalida = 0;
         #4#9  = " ";
         #4#10 = "01.01.0000";
         #4#19 = "";
         |SI #207#15 = "S";
             #4#13 = "";
             #4#14 = "01.01.0000";
         |FINSI;
         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;
     |SI #4#3 = 300;  |O #4#3 = 370;  |O #4#3 = 320;
         |O #4#3 = 330;  |O #4#3 = 332;
            |ABRE #82;
            #82#0 = #4#0;
            #82#1 = #4#1;
            #82#2 = #4#2;
            |LEE 141#82=;
            |SI FSalida = 0;
                #82#61 = "S";
                |GRABA 020#82a;
            |FINSI;
            |LIBERA #82;
            |CIERRA #82;
     |FINSI;
|FPRC;

|PROCESO GrabaImpreso;
     |ABRE #207;
     |DDEFECTO #207;
     |LEE 000#207p;
     |CIERRA #207;

     |SI enInternet ! 0;
         |SI enModelo = 347;
             aOrigen    = aDirSesion + eaFichDatos + (("00000" + #999#0) % -105) + ".txt";
             aDestino   = eaPathInternet + eaFichDatos + (("00000" + #999#0) % -105) + ".txt";
             |RCOPIA_FICHERO aOrigen, aDestino;

             |RFBORRA aOrigen;
         |FINSI;

         aAlfa = aDirSesion + "AUXILIAR.TXT";
         |RFBORRA aAlfa;

         aAlfa = aDirSesion + "jus" + (("00000" + #999#0) % -105) + ".xml";
         |RFBORRA aAlfa;

         aAlfa = aDirSesion + eaFichError + #0#6 + ".RST";
         |RFBORRA aAlfa;

         aAlfa = aDirSesion + eaFichError + (("00000" + #999#0) % -105) + ".RST";
         |RFBORRA aAlfa;
     |FINSI;

     aJusti  = "";

     |SI enInternet = 0;
         aAbre   = aDirSesion + "jus" + (("00000" + #999#0) % -105) + ".xml";
         |XABRE "C", aAbre, nHandleEjec;
         |SI FSalida ] 0;
             |PARA;  |SI FSalida ] 0;  |HACIENDO;
                  |XLEE nHandleEjec, 250, aAlfa;

                  aAlfa = aAlfa - "<Justif>";
                  |SI FSalida ! 0;
                      aAlfa  = aAlfa - "</Justif>";  |QBT aAlfa;
                      aAlfa  = aAlfa - "<RST>";      |QBT aAlfa;
                      aAlfa  = aAlfa - "</RST>";     |QBT aAlfa;
                      aJusti = aAlfa % -113;
                      |SAL;
                  |FINSI;
              |SIGUE;
         |FINSI;
         |XCIERRA nHandleEjec;

         |RFBORRA aAbre;

         |SI aJusti = "";
             aAbre   = aDirSesion + eaFichError + (("00000" + #999#0) % -105) + ".RST";
             |XABRE "C", aAbre, nHandleEjec;
             |SI FSalida ] 0;
                 |XLEE nHandleEjec, 250, aJusti;
             |FINSI;
             |XCIERRA nHandleEjec;

             |RFBORRA aAbre;
         |FINSI;
     |FINSI;

     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 101#4=;
     |SI FSalida = 0;
         #4#9  = "X";
         #4#10 = #0#7;
         #4#19 = aJusti;
         |SI #207#15 = "S";
             #4#13 = "X";
             #4#14 = #0#7;
         |FINSI;
         |GRABA 020#4a;
         |LIBERA #4;
         || .. |SI nDelBucle = 0; |HAZ GrabaResumen; |FINSI;
         |HAZ GrabaResumen;
     |FINSI;
     |CIERRA #4;

     |SI #4#3 = 300;  |O #4#3 = 370;  |O #4#3 = 320;
         |O #4#3 = 330;  |O #4#3 = 332;
            |ABRE #82;
            #82#0 = #4#0;
            #82#1 = #4#1;
            #82#2 = #4#2;
            |LEE 141#82=;
            |SI FSalida = 0;
                #82#61 = "N";
                |GRABA 020#82a;
            |FINSI;
            |LIBERA #82;
            |CIERRA #82;
     |FINSI;
|FPRC;

|DEFBUCLE dsmow014G;
     #999#1;
     6;
     00001, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, GrabaImpreso;
|FIN;

|PROCESO ErroresValidacion;
     |ABRE #999;

     enError     = 0;
     aDirSesion  = eaPathLanza;
     aPathSesion = eaPathLanza;
     aPathInter  = eaPathLanza + "AInternet"; |RMKDIR aPathInter;
     aPathInter  = aPathInter + "\";

     aAlfa = aDirSesion + "imprime.bat";
     |RFBORRA aAlfa;

     aFichero    = aPathInter + eaFichDatos + "*.bue";  |QBT aFichero;
     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |RFBORRA aFichero;

            |R_SDIR aFichero;
     |SIGUE;

     aFichero    = aDirSesion + eaFichDatos + "*.txt";  |QBT aFichero;
     enBuenos    = 0;
     enMalos     = 0;

     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |HAZ QuitaPath;

            aAlfa  = aError % 405;
            #999#0 = aAlfa;
            |LEE 040#999=;
            |SI FSalida = 0;
                aAlfa = aDirSesion + eaFichError + (aError % 405) + ".txt";
                |XABRE "EC", aAlfa, nHandError;
                |SI FSalida < 0;
                    enBuenos = enBuenos + 1;
                    aOrigen  = aFichero;
                    aDestino = aPathInter + eaFichDatos + (aError % 405) + ".bue";
                    |RCOPIA_FICHERO aOrigen, aDestino;

                    |RFBORRA aOrigen;

                    aAlfa = aDirSesion + eaFichError + (aError % 405) + ".RST";
                    |RFBORRA aAlfa;

                    |SI eaFichAuxil ! "";
                        aAlfa = aDirSesion + eaFichAuxil + (aError % 405) + ".txt";
                        |RFBORRA aAlfa;
                    |FINSI;
                |SINO;
                    enMalos = enMalos + 1;
                |FINSI;
            |FINSI;
            |R_SDIR aFichero;
     |SIGUE;
     |CIERRA #999;

     |SI enMalos = 0;
         nDelBucle = 1; |BUCLE dsmow014G; nDelBucle = 0;
         |ACABA;
     |FINSI;

     aFichero = ("52" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #952 aFichero;
     |ABRE #952;  |CIERRA #952;  |DELINDEX #952;

     |ABRE #952;
     |ABRE #999;

     aFichero    = aDirSesion + eaFichError + "*.txt";  |QBT aFichero;
     nHePasado   = 0;

     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |HAZ QuitaPath;
            aAlfa  = aError % 405;
            #999#0 = aAlfa;
            |LEE 040#999=;
            |SI FSalida = 0;
                nHePasado  = 1;
                #952#0     = aError;
                #952#1     = #999#0;
                #952#2     = #999#3;
                |GRABA 040#952n;
                |LIBERA #952;
            |FINSI;
            |R_SDIR aFichero;
     |SIGUE;
     |CIERRA #952;
     |CIERRA #999;

     |SI nHePasado = 0;
         |DELINDEX #952;

         nDelBucle = 1; |BUCLE dsmow014G; nDelBucle = 0;

         |ACABA;
     |FINSI;

     |PUSHV 0501 2380;
     enError = 1;
     |ENTLINEAL #1#952, -1, 4, 22, 1, ClaveBaja952, ClaveAlta952;
     |POPV;

     |ABRE #952;
     |ABRE #999;

     aFichero    = aDirSesion + eaFichDatos + "*.txt";  |QBT aFichero;
     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |HAZ QuitaPath;
            aError = eaFichError + (aError % 0412);
            aAlfa  = aError;
            #952#0 = aAlfa;
            |LEE 040#952=;
            |SI FSalida ! 0;
                aAlfa = aDirSesion + eaFichDatos + (aError % 0412);
                |RFBORRA aAlfa;

                aAlfa = aDirSesion + eaFichError + (aError % 0405) + ".RST";
                |RFBORRA aAlfa;

                |SI eaFichAuxil ! "";
                    aAlfa = aDirSesion + eaFichAuxil + (aError % 0412);
                    |RFBORRA aAlfa;
                |FINSI;

                aAlfa = aError % 0405;
                #999#0 = aAlfa;
                |LEE 040#999=;
                |SI FSalida = 0;
                    |HAZ GrabaImpreso;
                |FINSI;
            |SINO;
                aAlfa = aError % 0405;
                #999#0 = aAlfa;
                |LEE 040#999=;
                |SI FSalida = 0;
                    |HAZ DesGrabaImpreso;

                    aAlfa = aDirSesion + eaFichDatos + (aError % 0412);
                    |RFBORRA aAlfa;

                    aAlfa = aDirSesion + eaFichError + (aError % 0405) + ".TXT";
                    |RFBORRA aAlfa;

                    |SI eaFichAuxil ! "";
                        aAlfa = aDirSesion + eaFichAuxil + (aError % 0412);
                        |RFBORRA aAlfa;
                    |FINSI;
                |FINSI;
            |FINSI;
            |R_SDIR aFichero;
     |SIGUE;
     |CIERRA #952;
     |CIERRA #999;

     |DELINDEX #952;

     aAlfa = aDirSesion + "imprime.bat";
     |RFBORRA aAlfa;
|FPRC;

|PROCESO BuscaErroresL;
     |SI enValidacion = 1;
         |HAZ ErroresValidacion;
         |ACABA;
     |FINSI;

     aFichero = ("52" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #952 aFichero;
     |ABRE #952;  |CIERRA #952;  |DELINDEX #952;

     |ABRE #952;
     |ABRE #999;

     enError      = 0;
     nHePasado    = 0;
     aDirSesion   = eaPathLanza;
     aPathSesion  = eaPathLanza;
     |SI eaExtension = "";
         aFichero    = aDirSesion + eaFichError + "*.txt";  |QBT aFichero;
     |SINO;
         aFichero    = aDirSesion + eaFichError + "*.xml";  |QBT aFichero;
     |FINSI;

     aAlfa = aDirSesion + "imprime.bat";
     |RFBORRA aAlfa;

     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |HAZ QuitaPath;

            aAlfa  = aError % 405;
            #999#0 = aAlfa;
            |LEE 040#999=;
            |SI FSalida = 0;
                nHePasado  = 1;
                #952#0     = aError;
                #952#1     = #999#0;
                #952#2     = #999#3;
                |GRABA 040#952n;
                |LIBERA #952;
            |SINO;
                aAlfa  = aError % 404;
                nNume  = aAlfa;
                |SI #999#1 = nNume;
                    nHePasado  = 1;
                    #952#0     = aError;
                    #952#1     = 0;
                    #952#2     = "SOPORTE MAGNETICO";
                    |GRABA 040#952n;
                    |LIBERA #952;
                |FINSI;
            |FINSI;
            |R_SDIR aFichero;
     |SIGUE;
     |CIERRA #952;
     |CIERRA #999;

     |SI nHePasado = 0;
         |SI eaExtension ! "";
             nDelBucle = 1; |BUCLE dsmow014G; nDelBucle = 0;
             |HAZ BorraDirectorio;
             |ACABA;
         |FINSI;

         aFichero    = aDirSesion + "*.*";  |QBT aFichero;
         |R_PDIR aFichero;
         |PARA; |SI; |HACIENDO;
                |SI FSalida ! 0; |SAL; |FINSI;

                aAlfa  = aFichero < "";
                aAlfa1 = aAlfa - "auxiliar.txt";
                |SI aAlfa = aAlfa1;
                    |SI enInternet ! 0;
                        aInter = aAlfa % -112;
                        aAlfa = (aInter % 103) < "";
                        |SI aAlfa = "int";
                            eaFOrigen  = aFichero;
                            eaFDestino = eaPathInternet + aInter;
                            |RCOPIA_FICHERO eaFOrigen, eaFDestino;
                        |FINSI;
                    |FINSI;

                    aExt = (aFichero % -103) < "";
                    aFich = aFichero % -1003;
                    aFich1 = aFichero % -904;
                    aFich2 = aFichero % -704;
                    |SI aExt ! "rst";  |Y aExt ! "exe";
                        |SI enInternet = 0;
                            |RFBORRA aFichero;
                        |SINO;
                            |SI aFich ! "opa"; |Y aFich1 ! "rtpa";
                            |Y aFich2 ! "ce20";
                                |RFBORRA aFichero;
                            |FINSI;
                        |FINSI;
                    |FINSI;
                |FINSI;
               |R_SDIR aFichero;
         |SIGUE;

         |DELINDEX #952;

         nDelBucle = 1; |BUCLE dsmow014G; nDelBucle = 0;

         |ACABA;
     |FINSI;

     |PUSHV 0501 2380;
     enError = 1;
     |ENTLINEAL #1#952, -1, 4, 22, 1, ClaveBaja952, ClaveAlta952;
     |POPV;

     |ABRE #952;
     |ABRE #999;
     aFichero    = aDirSesion + "*.*";  |QBT aFichero;

     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |HAZ QuitaPath;
            aAlfa  = (aError % 103) < "";
            |SI aAlfa = eaFichError;
                aAlfa  = (aError % -103) < "";
                |SI aAlfa = "rst";
                    aAlfa = aError % 0405;
                    #999#0 = aAlfa;
                    |LEE 040#999=;
                    |SI FSalida = 0;
                        |HAZ GrabaImpreso;
                    |FINSI;
                |SINO;
                    #952#0 = aError;
                    |LEE 040#952=;
                    |SI FSalida = 0;
                        aAlfa = aError % 0405;
                        #999#0 = aAlfa;
                        |LEE 040#999=;
                        |SI FSalida = 0;
                            |HAZ DesGrabaImpreso;
                        |FINSI;
                    |FINSI;
                |FINSI;
            |FINSI;

            |R_SDIR aFichero;
     |SIGUE;
     |CIERRA #952;
     |CIERRA #999;

     |HAZ BorraDirectorio;
|FPRC;

|PROCESO BuscaErroresS;
     enError = 1;
     aAlfa = eaPathLanza + "ERRORES.TXT";
     |XABRE "C", aAlfa, nHandle1;
     |SI FSalida < 0;
         enError = 0;
         nDelBucle = 1; |BUCLE dsmow014G; nDelBucle = 0;
     |FINSI;
     |XCIERRA  nHandle1;
|FPRC;

|PROCESO QuitaBlanco;
     |ET aCadena;
         |QBF aParaQuitar;
         |SI aParaQuitar ! "";
             aCaracter = aParaQuitar % 101;
             |SI aCaracter = " ";
                 aParaQuitar = aParaQuitar % 240;
                 |VETE aCadena;
             |FINSI;
         |FINSI;
|FPRC;

|PROCESO SeparaNombre;
     || Busca una coma en la aCadena

     eaCadena1 = "";
     eaCadena2 = "";
     eaCadena3 = "";

     nBlanco1 = 0;
     nBlanco2 = 0;
     nComa    = 0;

     |PARA nPara = 1; |SI nPara [ 40; |HACIENDO nPara = nPara + 1;
           nPosi = nPara * 100 + 1;
           aCaracter = eaCadena % nPosi;

           |SI aCaracter = ","; nComa = nPara; |SAL; |FINSI;
     |SIGUE;

     |SI nComa = 0;
         || Si no hay coma busca el primer blanco empezando por detras

         aLongAlfa = eaCadena % 0;
         nLongNume = aLongAlfa;

         |PARA nPara = nLongNume; |SI nPara ] 1; |HACIENDO nPara = nPara - 1;
               nPosi = nPara * 100 + 1;
               aCaracter = eaCadena % nPosi;
               |SI aCaracter = " "; nComa = nPara; |SAL; |FINSI;
         |SIGUE;
     |FINSI;

     || Coge los dos primeros aCaracteres del segundo apellido

     nBlanco1  = nComa - 1;
     nPosi     = nBlanco1 + 100;
     eaCadena2  = eaCadena % nPosi;
     aLongAlfa = eaCadena2 % 0;
     nLongNume = aLongAlfa;

     |PARA nPara = nLongNume; |SI nPara ] 1; |HACIENDO nPara = nPara - 1;
           nPosi = nPara * 100 + 1;
           aCaracter = eaCadena2 % nPosi;
           |SI aCaracter = " "; nBlanco1 = nPara; |SAL; |FINSI;
     |SIGUE;

     nBlanco1 = nBlanco1 + 1;
     nPosi    = nBlanco1 * 100 + nLongNume;
     eaCadena2 = eaCadena2 % nPosi;

     || Coge las dos primeros caracteres del primer apellido

     nBlanco1 = nBlanco1 - 1;
     nPosi    = 100 + nBlanco1;
     eaCadena1 = eaCadena % nPosi;

     || Recoge los dos primero aCaracteres de Nombre

     nPosi    = ((nComa + 1) * 100) + 40;
     eaCadena3 = eaCadena % nPosi;

     aParaQuitar = eaCadena1; |HAZ QuitaBlanco; eaCadena1 = aParaQuitar;
     aParaQuitar = eaCadena2; |HAZ QuitaBlanco; eaCadena2 = aParaQuitar;
     aParaQuitar = eaCadena3; |HAZ QuitaBlanco; eaCadena3 = aParaQuitar;

     |QBF eaCadena1;
     |QBF eaCadena2;
     |QBF eaCadena3;
|FPRC;

|PROCESO Copiampf2007;
     aAlfa   = #0#6;
     aAlfa   = aAlfa % -102;
     enError = 0;

     eaFOrigen  = aModelos + "patrones/zls" + aAlfa + "mpf.exe";
     |XABRE "E", eaFOrigen, nHandleEjec;
     |SI FSalida < 0;
         aAlfa1 =  "      No existe el ejecutable zls" + aAlfa + "mpf.exe pongase en contacto con su distribuidor";
         |MENAV aAlfa1;
         enError = 1;
         |ACABA;
     |FINSI;

     eaFDestino = eaPathLanza + "zls" + aAlfa + "mpf.exe";

     |HAZ CopiaFichero;
|FPRC;

|PROCESO Copiampf2008;

     aAlfa    = #0#6;
     aAlfa    = aAlfa % -102;
     enError  = 0;
     aVersion = "01";

     |SI #0#6 = 2008;  |Y #0#4 ] 4;
         aVersion = "02";
     |FINSI;

     eaFOrigen  = aModelos + "patrones/z" + aAlfa + aVersion + "mpf.exe";
     |XABRE "E", eaFOrigen, nHandleEjec;
     |SI FSalida < 0;
         aAlfa1 =  "      No existe el ejecutable zls" + aAlfa + "mpf.exe pongase en contacto con su distribuidor";
         |MENAV aAlfa1;
         enError = 1;
         |ACABA;
     |FINSI;

     eaFDestino = eaPathLanza + "z" + aAlfa + aVersion + "mpf.exe";

     |HAZ CopiaFichero;
|FPRC;

|PROCESO Copiampf;
     |DBASS aModelos;  |QBT aModelos;
     aModelos = aModelos + "basica/";

     |SI #0#6 [ 2007;
         |HAZ Copiampf2007;
     |SINO;
         |HAZ Copiampf2008;
     |FINSI;
|FPRC;

|PROCESO CompruebaEjecutable2007;
     |DBASS aModelos;  |QBT aModelos;
     aModelos = aModelos + "basica/";

     aAlfa   = #0#6;
     aAlfa   = aAlfa % -102;
     enError = 0;

     eaFOrigen  = aModelos + "patrones/zls" + aAlfa + "mpf.exe";
     |XABRE "E", eaFOrigen, nHandleEjec;
     |SI FSalida < 0;
         aAlfa1 =  "      No existe el ejecutable zls" + aAlfa + "mpf.exe pongase en contacto con su distribuidor";
         |MENAV aAlfa1;
         enError = 1;
     |FINSI;
|FPRC;

|PROCESO CompruebaEjecutable2008;
     |DBASS aModelos;  |QBT aModelos;
     aModelos = aModelos + "basica/";

     aAlfa    = #0#6;
     aAlfa    = aAlfa % -102;
     enError  = 0;
     aVersion = "01";

     |SI #0#6 = 2008;  |Y #0#4 ] 4;
         aVersion = "02";
     |FINSI;

     eaFOrigen  = aModelos + "patrones/z" + aAlfa + aVersion + "mpf.exe";
     |XABRE "E", eaFOrigen, nHandleEjec;
     |SI FSalida < 0;
         aAlfa1 =  "      No existe el ejecutable z" + aAlfa + aVersion + "mpf.exe pongase en contacto con su distribuidor";
         |MENAV aAlfa1;
         enError = 1;
     |FINSI;
|FPRC;

|PROCESO CompruebaEjecutable;
     |SI #0#6 [ 2007;
         |HAZ CompruebaEjecutable2007;
     |SINO;
         |HAZ CompruebaEjecutable2008;
     |FINSI;
|FPRC;

|PROCESO CogeBancoIntegral;
     enBanco     = 0;
     eaEntidad   = "";
     eaOficina   = "";
     eaDC        = "";
     eaCuenta    = "";
     eaNomEnt    = "";
     eaNomOfi    = "";
     eaFormaPago = "";

     |ABRE #109;

     #109#0 = #715#0;
     #109#1 = enModelo;
     |LEE 040#109=;
     |SI FSalida = 0;
         |CIERRA #109;

         |SI #109#9 = 1;  |O #109#8 = "          ";
             eaFormaPago = "1";
         |SINO;
             eaFormaPago = #109#9;
             eaEntidad   = #109#5;
             eaOficina   = #109#6;
             eaDC        = #109#7;
             eaCuenta    = #109#8;
             eaNomEnt    = #109#4;
             eaNomOfi    = #109#10;
         |FINSI;

         |SI enForzar = 1;
             enBanco     = #109#3;
             eaEntidad   = #109#5;
             eaOficina   = #109#6;
             eaDC        = #109#7;
             eaCuenta    = #109#8;
             eaNomEnt    = #109#4;
             eaNomOfi    = #109#10;
             eaFormaPago = #109#9;
         |FINSI;

         |ACABA;
     |FINSI;

     #109#0 = #715#0;
     #109#1 = 999;
     |LEE 040#109=;
     |SI FSalida = 0;
         |CIERRA #109;

         |SI #109#9 = 1;  |O #109#8 = "          ";
             eaFormaPago = "1";
         |SINO;
             eaFormaPago = #109#9;
             eaEntidad   = #109#5;
             eaOficina   = #109#6;
             eaDC        = #109#7;
             eaCuenta    = #109#8;
             eaNomEnt    = #109#4;
             eaNomOfi    = #109#10;
         |FINSI;

         |SI enForzar = 1;
             enBanco     = #109#3;
             eaFormaPago = #109#9;
             eaEntidad   = #109#5;
             eaOficina   = #109#6;
             eaDC        = #109#7;
             eaCuenta    = #109#8;
             eaNomEnt    = #109#4;
             eaNomOfi    = #109#10;
         |FINSI;

         |ACABA;
     |FINSI;
     |CIERRA #109;

     |SI #715#104 = 1;  |O #715#93 = "          ";
         eaFormaPago = "1";
     |SINO;
         eaFormaPago = #715#104;
         eaEntidad   = #715#90;
         eaOficina   = #715#91;
         eaDC        = #715#92;
         eaCuenta    = #715#93;
         eaNomEnt    = #715#89;
         eaNomOfi    = "";
     |FINSI;

     |SI enForzar = 1;
         eaFormaPago = #715#104;
         eaEntidad   = #715#90;
         eaOficina   = #715#91;
         eaDC        = #715#92;
         eaCuenta    = #715#93;
         enBanco     = #715#88;
         eaNomEnt    = #715#89;
         eaNomOfi    = "";
     |FINSI;
|FPRC;

|PROCESO CogeBancoBasica;
     |SI #715#95 = 1;  |O #715#84 = "                    ";
         eaFormaPago = "1";
     |SINO;
         eaFormaPago = #715#95;
         eaEntidad   = #715#81;
         eaOficina   = #715#82;
         eaDC        = #715#83;
         eaCuenta    = #715#84 % 110;
         enBanco     = #715#79;
         eaNomEnt    = #715#80;
         eaNomOfi    = "";
    |FINSI;
|FPRC;

|PROCESO CogeDatosBancos;
     |SI enSwDeDonde = 1;
         |HAZ CogeBancoIntegral;
     |SINO;
         |HAZ CogeBancoBasica;
     |FINSI;
|FPRC;

|PROCESO LeeJava;
     enError = 0;
     aAbre   = "C:\Archivos de programa\Java\" + aVersionJava + "\bin\java.exe";

     |XABRE "EC", aAbre, nHandleEjec;
     |SI FSalida < 0;  enError = 1;  |ACABA;  |FINSI;
|FPRC;

|PROCESO BuscaJava;
     |SI #0#6 [ 2006;
         aVersionBasico = "111";
         aVersionJava   = "j2re1.4.2_04";
         aEjecutaJava   = "zjava_1_4_2_04.exe";
     |FINSI;

     |SI #0#6 = 2007;
         aVersionBasico = "221";
         aVersionJava   = "jre1.6.0_03";
         aEjecutaJava   = "zjava_1_6_0_03.exe";
     |FINSI;

     |SI #0#6 ] 2008;
         aVersionBasico = "230";
         aVersionJava   = "jre1.6.0_03";
         aEjecutaJava   = "zjava_1_6_0_03.exe";
     |FINSI;

     |HAZ LeeJava;
     |SI enError = 1;
         aAlfa = "0000 No tiene instalada la Maquina Virtual para Java Version " + aVersionJava + ". Se va a proceder a instalar";
         |MENAV aAlfa;

         aPathModelo = eaPathLanza;
         aPathLocal  = eaPathLanza;
         |HAZ TraeWait;

         |DBASS aModelos;  |QBT aModelos;
         aModelos = aModelos + "basica/";
         eaFOrigen  = aModelos + "patrones/" + aEjecutaJava;
         eaFDestino = aPathModelo +  aEjecutaJava;
         |HAZ CopiaFichero;

         aAbre = aPathModelo + "Ejecuta.bat";
         |XABRE "CBW", aAbre, nHandle1;

         aAlfa = "CD " + aPathModelo + &13 + &10;
         |XGRABA nHandle1, aAlfa;

         aAlfa = "wait " + aEjecutaJava + &13 + &10;
         |XGRABA nHandle1, aAlfa;

         |XCIERRA nHandle1;

         |RSYSTEM aAbre;

         |RFBORRA aAbre;
         |RFBORRA eaFDestino;

         |HAZ LeeJava;
         |SI enError = 1;
              aAlfa = "0000 No tiene instalada la Maquina Virtual para Java Version " + aVersionJava + ". Proceso Interrumpido";
              |MENAV aAlfa;
              |ACABA;
         |FINSI;
     |FINSI;

     aAlfa  = "C:\Archivos de programa\Java\" + aVersionJava;
     eaDirJava = "SET JAVA_HOME=" + aAlfa;  |QBF eaDirJava;
|FPRC;

|PROCESO TraeBasico;
     aPathLocal = "C:\MODELOS";                                |RMKDIR aPathLocal;
     aPathLocal = "C:\MODELOS\JAVA";                           |RMKDIR aPathLocal;
     aPathLocal = "C:\MODELOS\JAVA\VERSION" + aVersionBasico;  |RMKDIR aPathLocal;
     aPathLocal = "C:\MODELOS\JAVA\VERSION" + aVersionBasico + "\";

     |DBASS aPathServidor;   |QBF aPathServidor;
     aPathServidor = aPathServidor + "basica/patrones/";

     aOrigen    = aPathServidor + "mivinf" + aVersionBasico + ".tgz";
     aDestino   = aPathLocal + "mivinf" + aVersionBasico + ".tgz";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     nCopia    = 0;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
         nCopia = 1;
     |FINSI;

     enBasico = 0;
     |XABRE "EC", aDestino, nHandleEjec;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |SI nCopia = 1;
         |RDESCOMPRIME aDestino;

         aDestino = (aDestino - ".tgz") + ".tar";
         |RDETAR aDestino, aPathLocal;

         |RFBORRA aDestino;
     |FINSI;

     enBasico = 1;
|FPRC;

|PROCESO TraeModelo;
     |SI enBasico = 0;  |ACABA;  |FINSI;

     aAlfa   = #0#6;
     aAlfa   = aAlfa % -102;

     aOrigen    = aPathServidor + "zls" + aAlfa + #0#0 + ".tgz";
     aDestino   = aPathLocal    + "zls" + aAlfa + #0#0 + ".tgz";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     nCopia    = 0;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
         nCopia = 1;
     |FINSI;

     |XABRE "EC", aDestino, nHandleEjec;
     |SI FSalida < 0;  enBasico = 0;  |ACABA;  |FINSI;

     |SI nCopia = 1;
         |RDESCOMPRIME aDestino;

         aDestino = (aDestino - ".tgz") + ".tar";
         |RDETAR aDestino, aPathLocal;

         |RFBORRA aDestino;
     |FINSI;
|FPRC;

|PROCESO PresentaJava;
     aPathLocal = eaPathLanza;

     aAbre = aPathLocal + eaTipoP;
     |XABRE "EC", aAbre, nHandle1;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |HAZ LocalizaAcrobat;
     |SI enError ! 0;  |ACABA;  |FINSI;

     |HAZ TraeWait;

     aAbre = aPathLocal + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "C:" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "CD " + aPathLocal + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     |SI eaModoImpre = "I";
         aAlfa = "wait dsprint " + eaTipoP + &13 + &10;
         |XGRABA nHandle1, aAlfa;
     |FINSI;

     |SI eaModoImpre = "P";
         aAlfa = "wait " + eaPathAcrobat + " " + eaTipoP + &13 + &10;
         |XGRABA nHandle1, aAlfa;
     |FINSI;

     |XCIERRA nHandle1;

     |RSYSTEM aAbre;
     |RFBORRA aAbre;

     |DBASE aPathPdf;  |QBT aPathPdf;
     aPathPdf = aPathPdf + "modelospdf";
     aPathPdf = aPathPdf + "/" + #0#0;                      |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/" + #0#6;                      |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/99";                           |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/" + (("00" + #999#7) % -102);  |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/";

     aOrigen  = aPathLocal + eaTipoP;
     aDestino = aPathPdf   + #0#0 + (("00000" + #999#0) % -105) + ".pdf";

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aIPRemoto ! "";
         |RECIBE_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |RFBORRA aOrigen;
|FPRC;

|PROCESO BorraPdf;
     |DBASE aPathPdf;  |QBT aPathPdf;
     aPathPdf = aPathPdf + "modelospdf";
     aPathPdf = aPathPdf + "/" + #0#0;                      |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/" + #0#6;                      |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/99";                           |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/" + (("00" + #999#7) % -102);  |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/";

     aAlfa    = aPathPdf   + #0#0 + (("00000" + #999#0) % -105) + ".pdf";
     |FBORRA aAlfa;
|FPRC;

|PROCESO LineaShellJava;
     |HAZ BorraPdf;

     enBasico = 0;
     |HAZ BuscaJava;
     |SI enError = 1;  |ACABA;  |FINSI;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "CBW", aAbre, enHandle;

     aAlfa = "CD \" + &13 + &10;                 |XGRABA enHandle, aAlfa;
     aAlfa = "CD MODELOS" + &13 + &10;           |XGRABA enHandle, aAlfa;
     aAlfa = "CD JAVA" + &13 + &10;              |XGRABA enHandle, aAlfa;
     aAlfa = "CD VERSION" + aVersionBasico + &13 + &10;        |XGRABA enHandle, aAlfa;

     |SI eaTipoR ! "";
         aAlfa = "DEL " + eaPathLanza + eaTipoR + &13 + &10;
         |XGRABA enHandle, aAlfa;
     |FINSI;

     |SI eaTipoP ! "";
         aAlfa = "DEL " + eaPathLanza + eaTipoP + &13 + &10;
         |XGRABA enHandle, aAlfa;
     |FINSI;

     aAlfa = eaDirJava + &13 + &10;
     |XGRABA enHandle, aAlfa;

     aAlfa = &34 + "%JAVA_HOME%\bin\java" + &34 + " -jar C:\MODELOS\JAVA\VERSION" + aVersionBasico + "\plataformamodulosinformativas.jar ";

     |SI eaTipoV ! "S";
         aAlfa = aAlfa + "/E:" + eaPathLanza + eaTipoE + " ";
         aAlfa = aAlfa + "/R:" + eaPathLanza + eaTipoR + " ";
         aAlfa = aAlfa + "/P:" + eaPathLanza + eaTipoP + " ";
         aAlfa = aAlfa + "/C:" + eaTipoC + " ";
         aAlfa = aAlfa + "/A:" + eaPathLanza + eaTipoA + " ";
     |SINO;
         aAlfa = aAlfa + "/E:" + eaPathLanza + eaTipoE + " ";
         aAlfa = aAlfa + "/V:S ";
         aAlfa = aAlfa + "/R:" + eaPathLanza + eaTipoR + " ";
     |FINSI;

     |SI #0#6 ] 2008;
         aAlfa = aAlfa + "/M:S ";
     |FINSI;

     aAlfa = aAlfa + &13 + &10;
     |XGRABA enHandle, aAlfa;

     |XCIERRA enHandle;

     |HAZ TraeBasico;
     |HAZ TraeModelo;

     |SI enBasico = 0;  |ACABA;  |FINSI;

     aAlfa = eaPathLanza + "imprime.bat";
     |RSYSTEM aAlfa;

     |SI eaTipoV ! "S";
         |HAZ PresentaJava;
     |FINSI;
|FPRC;

|PROCESO Acrobat;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |ABRE #108;
     #108#0 = aIPRemoto;
     |LEE 101#108=;
     |SI FSalida ! 0;
         |DDEFECTO #108;
         #108#0 = aIPRemoto;
         |GRABA 020#108b;
     |FINSI;

     eaPathAcrobat = #108#1;  |QBF eaPathAcrobat;
     |SI eaPathAcrobat = "";
         eaPathAcrobat = "AcroRd32.exe";
     |FINSI;

     eaPathAcrobat = "F" + eaPathAcrobat;
     |BROWSE eaPathAcrobat;
     eaPathAcrobat = eaPathAcrobat % 290;  |QBF eaPathAcrobat;

     |SI eaPathAcrobat ! "";
         #108#1 = eaPathAcrobat;
     |FINSI;

     |GRABA 020#108a;
     |LIBERA #108;
     |CIERRA #108;
|FPRC;

|PROCESO LeeUnidad;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |ABRE #108;
     #108#0 = aIPRemoto;
     |LEE 000#108=;
     |SI FSalida ! 0;  |DDEFECTO #108;  |FINSI;
     |CIERRA #108;

     |SI #108#2 = " "; #108#2 = "C";  |FINSI;

     aAlfa   = #108#2 + ":\AEAT";
     |RMKDIR aAlfa;

     aAlfa   = aAlfa + "\comprueba.txt";
     |XABRE "AC", aAlfa, nHandle;
     |SI FSalida < 0;
         eaUnidad = "";
     |SINO;
        |XCIERRA nHandle;
        |RFBORRA aAlfa;

        eaUnidad = #108#2 + ":";
    |FINSI;
|FPRC;
