|FICHEROS;
   dsmoy029 #0;

   dsmo1347 #347;
   dsmo2347 #348;
   dsmo3347 #351;

  :/basica/def/agicen14 #114;
  :/basica/def/agifigen #118;
  :/basica/def/agim0019 #119;
  :/basica/def/agifige1 #120;

   dsmow032 #900;          ||Def de impresion
   dsmow089 #999;
|FIN;

|VARIABLES;

   informe    = "dsmoy029";
   aFichero   = "";
   nCampo     = 0;
   nDEmpresa  = 0;
   nHEmpresa  = 0;

   aAlfa1 = "";
   aAlfa2 = "";
   aAlfa3 = "";
   nPara1 = 0;
   nPara2 = 0;
   nNume1 = 0;
   nNume2 = 0;
   nNume3 = 0;
   nNume4 = 0;
   fFecha  = @;

   efDFecha  = @;
   efHFecha  = @;

   nPin1    = 0;
   aPin1    = "";
   efPn10   = @;
   efPn11   = @;
   swExiste = 0;
   swNoExis = 0;

   &nSwLinea = 0;
   &nSwPrim   = 0;
   nSwPrint  = 0;
   nSwGraba  = 0;
   aNIF      = "";
   aNIFCP    = "";
   aNif      = "";
   nSwSi     = 0;
   &eaTexFin = "";

   aNomClave = "";
   nCampo8   = 0;
   aClave    = "";
   nExiste   = 0;
|FIN;

|INCLUYE i_variar;

|| //////////////////// Calculos de Pantalla \\\\\\\\\\\\\\\\\\\\\\\\\\

|CALCULO Tipo7;  |TIPO 7;
     fFecha = ~; aAlfa1 = fFecha;
     aAlfa1 = aAlfa1 % -104;
     #0#0 = aAlfa1; #0#0 = #0#0 - 1;
     |PINTA #0#0;
     |SI enEmpresa ! 0;
         #0#1  = enEmpresa;  |PINTA #0#1;
         #0#2  = enEmpresa;  |PINTA #0#2;

         |C_M #0#1, 1, "N";
         |C_M #0#2, 1, "N";
     |FINSI;
|FCAL;

|CALCULO Parrilla; |TIPO 0;
     |SI #0#1 = 0;
         #0#1 = 0;  |PINTA #0#1;
         #0#2 = 0;  |PINTA #0#2;  |C_M #0#2, 1, "N";
         |PARA nCampo = 3;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#1, 1, "S";
             |C_M #0#2, 1, "S";
         |FINSI;

         |PARA nCampo = 3;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO NoMasEmpresas; |TIPO 0;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|PROCESO DesdeDni;
     |SI #0#23 = "            ";
         #0#24 = "zzzzzzzzzzzz";  |C_M #0#24,1,"N"; |PINTA #0#24;
         |PARA nCampo = 25;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |C_M #0#24,1,"S";
         |PARA nCampo = 25;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = ""; |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasDni;
     |SI #0Campo = "            ";
         |PARA nCampo = Campo + 1;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = "";  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|| **********************************************************************************
|PROCESO LeoCliAse;
 nExiste = 0;
 |ABRE #120;
 |SELECT #4#120;
 |DDEFECTO #120;
 #120#13 = #999#0;  ||Nif
 |LEE 001#120=;
 |SI FSalida = 0;
     nExiste = 1;
     #0#56   = #120#0;
 |FINSI;
 |SELECT #1#120;
 |CIERRA #120;
|FPRC;

|PROCESO LeoAuxiliar;
 aAlfa1 = "";
 nNume1 = 44;
 |SI #999#9 = "A"; nNume1 = 44; |FINSI;
 |SI #999#9 = "B"; nNume1 = 45; |FINSI;
 |SI #999#9 = "C"; nNume1 = 46; aAlfa1 = "(C)"; |FINSI;
 |SI #999#9 = "D"; nNume1 = 46; aAlfa1 = "(D)"; |FINSI;
 |SI #999#9 = "E"; nNume1 = 46; aAlfa1 = "(E)"; |FINSI;
 |SI #999#9 = "F"; nNume1 = 46; aAlfa1 = "(F)"; |FINSI;
 |SI #999#9 = "G"; nNume1 = 46; aAlfa1 = "(G)"; |FINSI;

 aAlfa2 = "";
 nNume2 = 50;
 |SI #999#10 = "A"; nNume2 = 50; |FINSI;
 |SI #999#10 = "B"; nNume2 = 51; |FINSI;
 |SI #999#10 = "C"; nNume2 = 52; aAlfa2 = "(C)"; |FINSI;
 |SI #999#10 = "D"; nNume2 = 52; aAlfa2 = "(D)"; |FINSI;
 |SI #999#10 = "E"; nNume2 = 52; aAlfa2 = "(E)"; |FINSI;
 |SI #999#10 = "F"; nNume2 = 52; aAlfa2 = "(F)"; |FINSI;
 |SI #999#10 = "G"; nNume2 = 52; aAlfa2 = "(G)"; |FINSI;

 nSwLinea = 0;
 |PDEFECTO #0,42,64;
 #0#42    = #999#0;
 #0#43    = #999#6;
 |SI #999#7 = "S";
     #0nNume1 = #999#8;
     #0#47    = aAlfa1;
     #0#48    = #999#3;
     #0#49    = #999#4;
 |FINSI;
 |SI #999#1 ! 0;
     #0nNume2 = #999#5;
     #0#53    = aAlfa2;
     #0#54    = #999#3;
     #0#55    = #999#4;
     #0#56    = #999#1;
 |FINSI;

 |SI #999#7 ! "S"; |O #999#1 = 0;
     #0#57 = "NC";
     |SI #999#7 ! "S";
         || Yo como cliente, no estoy en el otro cliente de la asesoria
         |SI #999#2 = "A"; nNume3 = 58; |FINSI;
         |SI #999#2 = "B"; nNume3 = 59; |FINSI;
         |SI #999#2 = "R"; nNume3 = 60; |FINSI;
         #0nNume3 = "*IMP.CERO**";
         nSwLinea = 1;
     |SINO;
         || ... Este cliente mio, es o no de la Asesoria?
         |HAZ LeoCliAse;
         |SI nExiste = 0;
             #0#57 = "OK";  || No es cliente, por tanto esta bien chequeado
         |SINO;
             || ... Es cliente de esta asesoria, y no tiene el importe declarado
             |SI #999#2 = "A"; nNume3 = 62; |FINSI;
             |SI #999#2 = "B"; nNume3 = 61; |FINSI;
             |SI #999#2 = "R"; nNume3 = 63; |FINSI;
             #0nNume3 = "*IMP.CERO**";
             nSwLinea = 2;
         |FINSI;
     |FINSI;
 |SINO;
     #0#57 = "OK";
     |SI #999#5 ! #999#8; #0#57 = "ER"; |FINSI;
 |FINSI;

 |PRINT;
 nSwPrint = 1;
|FPRC;


|DEFBUCLE LeoAuxiliar;
 #999#1;
 ;
 "            ", " ", " ", " ";
 "zzzzzzzzzzzz", "z", "z", "z";
 ;
 NULL, LeoAuxiliar;
|FIN;

|| **********************************************************************************
|PROCESO GrabaAuxiliar;
 #999#0 = aNIFCP;
 #999#2 = aClave;
 #999#3 = #348#8;
 #999#4 = #348#9;
 |LEE 101#999=;
 |SI FSalida ! 0;
     |DDEFECTO #999;
     #999#0 = aNIFCP;
     #999#2 = aClave;
     #999#3 = #348#8;
     #999#4 = #348#9;
     #999#6 = aNomClave;
     |GRABA 020#999b;
 |FINSI;
 |SI nCampo8 = 5;
     #999#1  = #348#0;
     #999#5  = #348#12;
     #999#10 = #348#6;
 |FINSI;
 |SI nCampo8 = 8;
     #999#7 = "S";
     #999#8  = #348#12;
     #999#9  = #348#6;
 |FINSI;
 |GRABA 020#999a;
 |LIBERA #999;
 nSwGraba = 1;
|FPRC;

|PROCESO SelecNif;
 nSwSi = 0;
 |SI #0#23 ] "            ";
     |SI aNif ] #0#23; |Y aNif [ #0#24;
         nSwSi = 1;
     |FINSI;
 |SINO;
     |SI #0#25 ! "            "; |Y #0#25 = aNif; nSwSi = 1; |FINSI;
     |SI #0#26 ! "            "; |Y #0#26 = aNif; nSwSi = 1; |FINSI;
     |SI #0#27 ! "            "; |Y #0#27 = aNif; nSwSi = 1; |FINSI;
     |SI #0#28 ! "            "; |Y #0#28 = aNif; nSwSi = 1; |FINSI;
     |SI #0#29 ! "            "; |Y #0#29 = aNif; nSwSi = 1; |FINSI;
     |SI #0#30 ! "            "; |Y #0#30 = aNif; nSwSi = 1; |FINSI;
     |SI #0#31 ! "            "; |Y #0#31 = aNif; nSwSi = 1; |FINSI;
     |SI #0#32 ! "            "; |Y #0#32 = aNif; nSwSi = 1; |FINSI;
 |FINSI;
|FPRC;

|PROCESO LeoMi347;
 nSwSi  = 0;
 aAlfa1 = "";
 |SI #348#6 = "A"; |Y #0#35 = "S"; nSwSi = 1; nNume1 = 44; |FINSI;
 |SI #348#6 = "B"; |Y #0#36 = "S"; nSwSi = 1; nNume1 = 45; |FINSI;
 |SI #348#6 = "C"; |Y #0#37 = "S"; nSwSi = 1; nNume1 = 46; aAlfa1 = "(C)"; |FINSI;
 |SI #348#6 = "D"; |Y #0#38 = "S"; nSwSi = 1; nNume1 = 46; aAlfa1 = "(D)"; |FINSI;
 |SI #348#6 = "E"; |Y #0#39 = "S"; nSwSi = 1; nNume1 = 46; aAlfa1 = "(E)"; |FINSI;
 |SI #348#6 = "F"; |Y #0#40 = "S"; nSwSi = 1; nNume1 = 46; aAlfa1 = "(F)"; |FINSI;
 |SI #348#6 = "G"; |Y #0#41 = "S"; nSwSi = 1; nNume1 = 46; aAlfa1 = "(G)"; |FINSI;

 |SI nSwSi = 0; |ACABA; |FINSI;

 aNif = #348#7;
 |HAZ SelecNif;
 |SI nSwSi = 0; |ACABA; |FINSI;

 aNIFCP    = #348#7;
 aNomClave = #348#11;
 nCampo8   = 8;
 aClave    = "R";
 |SI #348#6 = "A"; |O #348#6 = "B"; aClave = #348#6; |FINSI;
 |HAZ GrabaAuxiliar;
|FPRC;

|DEFBUCLE LeoMi347;
 #348#3;
 ;
 enEmpresa, #0#0, 99, 347, 00, 00, "            ", " ";
 enEmpresa, #0#0, 99, 347, 99, 99, "zzzzzzzzzzzz", "z";
 ;
 NULL, LeoMi347;
|FIN;

|PROCESO BuscoMiNif;
 nSwSi = 0;
 |SI #348#6 = "B"; |Y #0#35 = "S"; nSwSi = 1; |FINSI;
 |SI #348#6 = "A"; |Y #0#36 = "S"; nSwSi = 1; |FINSI;
 |SI #348#6 = "C"; |Y #0#37 = "S"; nSwSi = 1; |FINSI;
 |SI #348#6 = "D"; |Y #0#38 = "S"; nSwSi = 1; |FINSI;
 |SI #348#6 = "E"; |Y #0#39 = "S"; nSwSi = 1; |FINSI;
 |SI #348#6 = "F"; |Y #0#40 = "S"; nSwSi = 1; |FINSI;
 |SI #348#6 = "G"; |Y #0#41 = "S"; nSwSi = 1; |FINSI;
 |SI nSwSi = 0; |ACABA; |FINSI;

 |ABRE #120;
 |DDEFECTO #120;
 #120#0 = #348#0;
 |LEE 001#120=;
 |CIERRA #120;

 aNif = #120#13;
 |HAZ SelecNif;
 |SI nSwSi = 0; |ACABA; |FINSI;

 aNIFCP    = #120#13;
 aNomClave = #120#1;
 nCampo8   = 5;
 aClave    = "R";
 |SI #348#6 = "A"; aClave = "B"; |FINSI;
 |SI #348#6 = "B"; aClave = "A"; |FINSI;
 |HAZ GrabaAuxiliar;
|FPRC;

|DEFBUCLE BuscoMiNif;
 #348#1;
 ;
 00001, #0#0, 99, 347, 00, 00, " ", aNIF, " ", " ";
 99999, #0#0, 99, 347, 99, 99, "z", aNIF, "z", "z";
 ;
 NULL, BuscoMiNif;
|FIN;

|PROCESO agifigen;
  enEmpresa = #118#0;
  |HAZ LeeDatosEmpresa;
  aNIF = #900#1;

  |DELINDEX #999;
  |SI aNIF [ "               "; |ACABA; |FINSI;

  |ABRE #999;
  |BUCLE BuscoMiNif;
  |BUCLE LeoMi347;
  |CIERRA #999;

  aNIFCP   = "";
  nSwPrim  = 0;
  nSwPrint = 0;
  |BUCLE LeoAuxiliar;
  |SI nSwPrint = 1;
      |PIEINF;
  |FINSI;
|FPRC;

|DEFBUCLE agifigen;
  #118#1;
  ;
  nDEmpresa;
  nHEmpresa;
  ;
  NULL, agifigen;
|FIN;


|CALCULO Tipo3;  |TIPO 3;

    enEjer = #0#0;
    aAlfa2 = #0#0;
    aAlfa1 = "01.01." + aAlfa2;
    aAlfa2 = "31.12." + aAlfa2;
    efDFecha  = aAlfa1;     efHFecha  = aAlfa2;

    aFichero = ("w8" + Usuario) % -108;
    |NOME_DAT #999 aFichero;

    |IMPRE 0;
    |SI FSalida ! 0;  |ACABA;  |FINSI;
    |INFOR informe;
    |SI FSalida ! 0;  |FINIMP; |ACABA;  |FINSI;

    |SI #0#1 ! 0;
        nDEmpresa = #0#1;
        nHEmpresa = #0#2;
        |BUCLE agifigen;
    |SINO;
        |PARA nCampo = 3;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
              |SI #0nCampo ! 0;
                  nDEmpresa = #0nCampo;
                  nHEmpresa = #0nCampo;
                  |BUCLE agifigen;
              |FINSI;
        |SIGUE;
    |FINSI;

    |FININF;
    |FINIMP;
|FCAL;

|| **********************************************************************************
|| **********************************************************************************
|| **********************************************************************************

|PROCESO LeeDatosEmpresa;

  |DDEFECTO #900;

  #900#0 = enEmpresa;
  nPin1 = 0;
  aPin1 = "";
  efPn10 = "01.01.0000";
  efPn11 = "01.01.0000";

  || Lee Primera Actividad
    swNoExis = 0;
    |ABRE #agicen14;
    #agicen14#0 = #900#0; || Empresa
    #agicen14#1 = 00;
    |LEE 041#agicen14.];
    |SI FSalida = 0; |Y #agicen14#0 = #900#0;
        #900#5 = #agicen14#9;
        #900#6 = #agicen14#10;
        #900#7 = #agicen14#7;
        #900#8 = #agicen14#8;
        efPn10 = #agicen14#5;
        efPn11 = #agicen14#6;
        enActividad = #agicen14#1;

        #900#15 = #agicen14#1;   ||Act.
        #900#16 = #agicen14#2;   ||Tipo Epig.
        #900#17 = #agicen14#3;   ||Epigrafe
        #900#18 = #agicen14#4;   ||Descripcion Actividad
        #900#19 = #agicen14#5;   ||Fecha Inicio
        #900#20 = #agicen14#6;   ||Fecha Fin
        #900#21 = #agicen14#11;  ||Sector actividad
        #900#22 = #agicen14#12;  ||Sector actividad
        #900#23 = #agicen14#16;  ||Tipo Actividad
        #900#24 = #agicen14#17;  ||Descripcion Tipo Actividad
        #900#51 = #agicen14#20;  ||CNAE
    |SINO;
        |CIERRA #agicen14;
        swNoExis = 1;
        |ACABA;
    |FINSI;
    |CIERRA #agicen14;

 || Lee Ficha Sociedades
    swExiste = 0;
    |ABRE #agim0019;
    #agim0019#0 = #900#0; || Empresa
    #agim0019#1 = 99;
    |LEE 041#agim0019.];
    |SI FSalida = 0;
        |SI #agim0019#0 ! #900#0;
            |LEE 041#agim0019.a;
            |SI FSalida = 0; |Y #agim0019#0 = #900#0;
                swExiste = 1;
            |FINSI;
        |SINO;
            swExiste = 1;
        |FINSI;
    |FINSI;
    |SI swExiste = 1;
        efPn10 = #agim0019#7;      || Fecha Activa
        efPn11 = #agim0019#55;     || Fecha Inactiva
        nPin1 = #agim0019#4;
        aPin1 = #agim0019#5;
    |FINSI;
    |CIERRA #agim0019;

        efPn10  = #agifigen#93;
        efPn11  = #agifigen#94;
        nPin1   = #agifigen#87;
        aPin1   = #agifigen#88;
        #900#1 = #agifigen#13;  || Nif
        #900#2 = #agifigen#1;   || Nombre
    |SI efPn10 [ "01.01.1900"; efPn10 = "01.01.0000"; |FINSI;
    |SI efPn11 [ "01.01.1900"; efPn11 = "01.01.0000"; |FINSI;
    #900#3 = nPin1;
    #900#4 = aPin1;
    #900#9 = efPn10;
    #900#10 = efPn11;

    #900#11 = "ACTIVA";
    |SI #agifigen#94 > "01.01.1000";
        #900#11 = "INACTIVA";
    |FINSI;
    #900#12 = #0#0;                                   || Ejercicio
    #900#13 = efDFecha;
    #900#14 = efHFecha;

    #900#50 = #0#34; ||Titulo del Libro
|FPRC;
