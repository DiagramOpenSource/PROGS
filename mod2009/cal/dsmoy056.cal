|FICHEROS;
     dsmoy056 #0;
     dsmom004 #104;

     dsm18401 #1;
     dsm18403 #3;
     dsm18405 #5;
     dsm18406 #6;
     dsm18407 #7;
     dsm18408 #8;
     dsm18409 #9;
     dsm18414 #14;
     dsm18430 #30;
     dsm18431 #31;
     dsmow014 #999;

    &regisnif@ #709;
    &clientes@ #715;

    :/basica/def/wordm000 #400;
|FIN;

|VARIABLES;
     nCampo         = 0;
     nSwGraba       = 0;
     nDEmpresa      = 0;
     nHEmpresa      = 0;
     nDComple       = 0;
     nHComple       = 0;
     nLectura       = 0;
     nWord1         = -1;
     nHandle        = 0;
     nLen           = 0;
     nPos           = 0;
     nPrimero       = 0;
     nCampos        = 0;
     nRdtos1        = 0;
     nRdtos2        = 0;
     nRdtos3        = 0;
     nRdtos4        = 0;
     nRdtos5        = 0;
     nRdtos6        = 0;
     nRdtos7        = 0;
     nRdtos8        = 0;
     nBytes         = 0;

     aFichero       = "";
     aAlfa          = "";
     aAlfa1         = "";
     aAlfa2         = "";
     aAlfa3         = "";
     aBase          = "";
     aOrigen        = "";
     aDestino       = "";
     aIPRemoto      = "";
     aAbre1         = "";
     aAbre2         = "";
     aPath          = "";
     aPathDoc       = "";
     aCadena        = "";
     aLen           = "";
     aAsigna        = "";
     aCaracter      = "";
     aIdenti        = "";
     aDocumento1    = "";
     aDocumento2    = "";
     aQueQuiero     = "";

     fFecha         = @;

    &enEmpresa      = 0;
    &enCodCli       = 0;
    &eaImporte      = "";
    &enNume         = 0;
|FIN;

|| Procesos de la Pantalla __________________________________________________

|PROCESO ElAny; |TIPO 7;
     fFecha = ~;
     aAlfa1 = fFecha;
     aAlfa1 = aAlfa1 % -104;
     #0#14 = aAlfa1;
     #0#14 = #0#14 - 1;
     |PINTA #0#14;
|FPRC;

|PROCESO Tipo7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#0 = enEmpresa;  |PINTA #0#0;
         #0#1 = enEmpresa;  |PINTA #0#1;

         |C_M #0#0, 1, "N";
         |C_M #0#1, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Parrilla;
     |SI #0#0 = 0;
         #0#0 = 0;  |PINTA #0#0;
         #0#1 = 0;  |PINTA #0#1;  |C_M #0#1, 1, "N";
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#0, 1, "S";
             |C_M #0#1, 1, "S";
         |FINSI;

         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|| _________________________________________________________________________

|PROCESO AbreWord;
     aAlfa = "C:/MODELOS";                   |RMKDIR aAlfa;
     aAlfa = "C:/MODELOS/DOCUMENTOS";        |RMKDIR aAlfa;

     |DBASS aBase;
     aOrigen   = aBase + "basica/word/word0046.doc";
     aDestino  = "C:/MODELOS/DOCUMENTOS/word0046.doc";

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     nWord1      = 1;
     aAbre1      = aDestino;
     aDocumento1 = aAbre1;

     |MENSA "      Abriendo Documento";

     |WORD_ABRE nWord1, aAbre1;
     |WORD_PROPIEDADES nWord1, "Visible", "NO";

     |MENSA "      Cargando Variables al Documento";
|FPRC;

|PROCESO Asigna;
     aCadena = "";
     aLen    = aAsigna % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aAsigna % nPos;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &241; |FINSI;
           |SI aCaracter = " ";  aCaracter = &225; |FINSI;
           |SI aCaracter = "‚";  aCaracter = &233; |FINSI;
           |SI aCaracter = "¡";  aCaracter = &237; |FINSI;
           |SI aCaracter = "¢";  aCaracter = &243; |FINSI;
           |SI aCaracter = "£";  aCaracter = &250; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     aAsigna = aCadena;

     |WORD_ASIGNA_TEXTO nWord1,  aIdenti, aAsigna;

     |SI aIdenti = "!#131#";
         aIdenti = "!!@#131#";
         |WORD_ASIGNA_TEXTO nWord1,  aIdenti, aAsigna;
     |FINSI;
|FPRC;

|PROCESO PonVariables;
     |PARA nCampos = 16;  |SI nCampos [ 133;  |HACIENDO nCampos = nCampos + 1;
           aQueQuiero = "|C" + (("000" + nCampos) % -103) + "NOMBRE";
           aIdenti    = "!" + #0#aQueQuiero#;
           aAsigna    = #0nCampos;  |QBF aAsigna;

           aQueQuiero = "|C" + (("000" + nCampos) % -103) + "TIPO";
           aAlfa      =  #0#aQueQuiero#;
           |SI aAlfa  = "N";
               enNume    = #0nCampos;
               |HAZ SeparaImporte;
               aAsigna   = eaImporte;
           |FINSI;

           |HAZ Asigna;
     |SIGUE;
|FPRC;

|PROCESO CierraWord;
     |MENSA "      Imprimiendo";

     |PULSATECLA;
     |WORD_IMPRIME nWord1, "";
     |WORD_PROPIEDADES nWord1, "Visible", "NO";

     |SLEEP 10;

     |MENSA "      Cerrando Documento";

     |WORD_SALVA nWord1, "";

     |RFBORRA aDocumento1;
|FPRC;

|PROCESO dsm18403;
     |SI #3#4 = "N";
         |SI #3#5 = "ES";
             #0#23 = #0#23 + #3#6;
             #0#24 = #0#24 + #3#7;
             #0#25 = #0#25 + #3#8;
         |SINO;
             #0#26 = #0#26 + #3#6;
             #0#27 = #0#27 + #3#7;
             #0#28 = #0#28 + #3#8;
         |FINSI;
     |SINO;
         |SI #0#29 = 0;  |O #0#29 = #3#9;
             #0#29 = #3#9;
             #0#30 = #0#30 + #3#10;
             |ACABA;
         |FINSI;

         #0#31 = #3#9;
         #0#32 = #0#32 + #3#10;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18403;
     #3#1;
     ;
     #1#0, #1#1, #1#3, 001;
     #1#0, #1#1, #1#3, 999;
     ;
     NULL, dsm18403;
|FIN;

|PROCESO dsm18405;
     |SI #5#4 = "N";
         |SI #5#5 = "ES";
             #0#33 = #0#33 + #5#6;
             #0#34 = #0#34 + #5#7;
             #0#35 = #0#35 + #5#8;
         |SINO;
             #0#36 = #0#36 + #5#6;
             #0#37 = #0#37 + #5#7;
             #0#38 = #0#38 + #5#8;
         |FINSI;
     |SINO;
         |SI #0#39 = 0;  |O #0#39 = #5#9;
             #0#39 = #5#9;
             #0#40 = #0#40 + #5#10;
             |ACABA;
         |FINSI;

         #0#41 = #5#9;
         #0#42 = #0#42 + #5#10;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18405;
     #5#1;
     ;
     #1#0, #1#1, #1#3, 001;
     #1#0, #1#1, #1#3, 999;
     ;
     NULL, dsm18405;
|FIN;

|PROCESO dsm18431;
     |SI #31#4 = "ES";
         |SI #31#9 = "N";
             nRdtos1 = nRdtos1 + #31#6;
             nRdtos2 = nRdtos2 + #31#7;
             nRdtos3 = nRdtos3 + #31#8;
         |SINO;
             nRdtos4 = nRdtos4 + #31#8;
         |FINSI;
     |SINO;
         |SI #31#9 = "N";
             nRdtos5 = nRdtos5 + #31#6;
             nRdtos6 = nRdtos6 + #31#7;
             nRdtos7 = nRdtos7 + #31#8;
         |SINO;
             nRdtos8 = nRdtos8 + #31#8;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18431;
     #31#1;
     ;
     #6#0, #6#1, #6#2, #6#3, "  ";
     #6#0, #6#1, #6#2, #6#3, "zz";
     ;
     NULL, dsm18431;
|FIN;

|PROCESO dsm18406;
     nRdtos1 = 0;
     nRdtos2 = 0;
     nRdtos3 = 0;
     nRdtos4 = 0;
     nRdtos5 = 0;
     nRdtos6 = 0;
     nRdtos7 = 0;
     nRdtos8 = 0;
     |BUCLE dsm18431;

     |SI #6#7 ! 0;  |O #6#8 ! 0;  |O #6#9 ! 0;
         |SI #0#45 = "    ";
             #0#43 = #6#4;
             #0#44 = #6#5;
             #0#45 = #6#6;
             #0#46 = nRdtos1;
             #0#47 = nRdtos2;
             #0#48 = nRdtos3;
             #0#49 = nRdtos4;
         |SINO;
             #0#50 = #6#4;
             #0#51 = #6#5;
             #0#52 = #6#6;
             #0#53 = #0#53 + nRdtos1;
             #0#54 = #0#54 + nRdtos2;
             #0#55 = #0#55 + nRdtos3;
             #0#56 = #0#56 + nRdtos4;
         |FINSI;
     |FINSI;

     |SI #6#10 ! 0;  |O #6#11 ! 0;  |O #6#12 ! 0;
         #0#57 = #6#4;
         #0#58 = #6#5;
         #0#59 = #6#6;
         #0#60 = #0#60 + nRdtos5;
         #0#61 = #0#61 + nRdtos6;
         #0#62 = #0#62 + nRdtos7;
         #0#63 = #0#63 + nRdtos8;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18406;
     #6#1;
     ;
     #1#0, #1#1, #1#3, 001;
     #1#0, #1#1, #1#3, 999;
     ;
     NULL, dsm18406;
|FIN;

|PROCESO dsm18408;
     |SI #8#4 = "ES";
         #0#64 = "ES";
         |SI #8#5 = "G";
             #0#65 = #0#65 + #8#6;
         |SINO;
             #0#66 = #0#66 + #8#6;
         |FINSI;
     |SINO;
         |SI #0#67 = "  ";
             #0#67 = #8#4;
         |FINSI;
         |SI #8#5 = "G";
             #0#68 = #0#68 + #8#6;
         |SINO;
             #0#69 = #0#69 + #8#6;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18408;
     #8#1;
     ;
     #1#0, #1#1, #1#3, 001;
     #1#0, #1#1, #1#3, 999;
     ;
     NULL, dsm18408;
|FIN;

|PROCESO dsm18409;
     |SI #9#5 = "ES";
         |SI #9#9 = "N";
             |SI #9#6 = "G";
                 #0#70 = #0#70 + #9#7;
             |SINO;
                 #0#71 = #0#71 + #9#7;
             |FINSI;
         |SINO;
             |SI #9#4 = "N";
                 |SI #9#6 = "G";
                     #0#75 = #0#75 + #9#7;
                 |SINO;
                     #0#76 = #0#76 + #9#7;
                 |FINSI;
             |SINO;
                 |SI #9#6 = "G";
                     #0#80 = #0#80 + #9#7;
                 |SINO;
                     #0#80 = #0#81 + #9#7;
                 |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         |SI #9#9 = "N";
             |SI #0#72 = "  ";  #0#72 = #9#5;  |FINSI;
             |SI #9#6 = "G";
                 #0#73 = #0#73 + #9#7;
             |SINO;
                 #0#74 = #0#74 + #9#7;
             |FINSI;
         |SINO;
             |SI #9#4 = "N";
                 |SI #0#77 = "  ";  #0#77 = #9#5;  |FINSI;

                 |SI #9#6 = "G";
                     #0#78 = #0#78 + #9#7;
                 |SINO;
                     #0#79 = #0#79 + #9#7;
                 |FINSI;
             |SINO;
                 |SI #0#82 = "  ";  #0#82 = #9#5;  |FINSI;

                 |SI #9#6 = "G";
                     #0#83 = #0#83 + #9#7;
                 |SINO;
                     #0#84 = #0#84 + #9#7;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18409;
     #9#1;
     ;
     #1#0, #1#1, #1#3, 001;
     #1#0, #1#1, #1#3, 999;
     ;
     NULL, dsm18409;
|FIN;

|PROCESO dsm18430;
     |PDEFECTO #0, 102, 129;

     #0#102 = #30#4;
     #0#103 = #30#2;
     #0#104 = #30#5;
     #0#107 = #30#11;
     #0#108 = #30#12;
     #0#109 = #30#13;
     #0#110 = #30#14;
     #0#111 = #30#15;
     #0#112 = #30#16;
     #0#113 = #30#17;
     #0#114 = #30#19;
     #0#115 = #30#20;
     #0#116 = #30#21;
     #0#117 = #30#22;

     |SI #30#23 = "X";
         #0#118 = #30#25;
         #0#119 = #30#26;
         #0#120 = #30#27;
         #0#121 = #30#28;
         #0#122 = #30#29;
         #0#123 = #30#30;
     |FINSI;

     |SI #30#24 = "X";
         #0#124 = #30#25;
         #0#125 = #30#26;
         #0#126 = #30#27;
         #0#127 = #30#28;
         #0#128 = #30#29;
         #0#129 = #30#30;
     |FINSI;

     #0#130 = #30#31;

     |HAZ AbreWord;
     |HAZ PonVariables;
     |HAZ CierraWord;
|FPRC;

|DEFBUCLE dsm18430;
     #30#1;
     ;
     #1#0, #1#1, #1#3, 001;
     #1#0, #1#1, #1#3, 999;
     ;
     NULL, dsm18430;
|FIN;

|PROCESO dsm18401;
     |SI nLectura = 0;
         |SI #1#3 ! 0;
             |SI #1#5 = "S";
                 nDComple = #1#3;
                 nHComple = #1#3;
             |SINO;
                 nHComple = #1#3;
             |FINSI;
         |SINO;
             nDComple = #1#3;
             nHComple = #1#3;
         |FINSI;
         |ACABA;
     |FINSI;

     #0#16  = #1#26;
     #0#17  = #1#25;
     #0#18  = #1#9;
     #0#19  = #1#14;
     #0#20  = #1#10;
     #0#21  = #1#11;
     #0#22  = #1#8;
     #0#85  = #1#38;
     #0#86  = #1#39;
     #0#87  = #1#40;
     #0#88  = #1#41;
     #0#89  = #1#42;
     #0#90  = #1#43;
     #0#91  = #1#44;
     #0#92  = #1#45;
     #0#93  = #1#46;
     #0#94  = #1#47;
     #0#95  = #1#48;
     #0#96  = #1#49;
     #0#97  = #1#50;
     #0#98  = #1#51;
     #0#99  = #1#52;
     #0#100 = #1#53;
     #0#101 = #1#54;

     aAlfa1 = #0#15 % 102;
     aAlfa2 = #0#15 % 402;
     aAlfa3 = #0#15 % -104;

     |SI aAlfa2 = "01";  aAlfa2 = "Enero";      |FINSI;
     |SI aAlfa2 = "02";  aAlfa2 = "Febrero";    |FINSI;
     |SI aAlfa2 = "03";  aAlfa2 = "Marzo";      |FINSI;
     |SI aAlfa2 = "04";  aAlfa2 = "Abril";      |FINSI;
     |SI aAlfa2 = "05";  aAlfa2 = "Mayo";       |FINSI;
     |SI aAlfa2 = "06";  aAlfa2 = "Junio";      |FINSI;
     |SI aAlfa2 = "07";  aAlfa2 = "Julio";      |FINSI;
     |SI aAlfa2 = "08";  aAlfa2 = "Agosto";     |FINSI;
     |SI aAlfa2 = "09";  aAlfa2 = "Septiembre"; |FINSI;
     |SI aAlfa2 = "10";  aAlfa2 = "Octubre";    |FINSI;
     |SI aAlfa2 = "11";  aAlfa2 = "Noviembre";  |FINSI;
     |SI aAlfa2 = "12";  aAlfa2 = "Diciembre";  |FINSI;

     #0#132 = aAlfa1 + " de " + aAlfa2 + " de " + aAlfa3;
     #0#133 = #0#14;

     |BUCLE dsm18403;
     |BUCLE dsm18405;
     |BUCLE dsm18406;
     |BUCLE dsm18408;
     |BUCLE dsm18409;

     |BUCLE dsm18430;
|FPRC;

|DEFBUCLE dsm18401;
     #1#1;
     ;
     #999#0, #999#1, 184, nDComple;
     #999#0, #999#1, 184, nHComple;
     ;
     NULL, dsm18401;
|FIN;

|PROCESO dsmow014;
    |PDEFECTO #0, 16, 134;

    nDComple  = 0;
    nHComple  = 99;

    nLectura  = 0;  |BUCLE dsm18401;
    nLectura  = 1;  |BUCLE dsm18401;
|FPRC;

|DEFBUCLE dsmow014;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, dsmow014;
|FIN;

|PROCESO GrabaTempo;
    enCodCli = #104#0;
    |HAZ LeePersona;

    #999#0  = #104#0;
    #999#1  = #104#1;
    #999#2  = #104#2;
    |LEE 101#999=;
    |SI FSalida ! 0;
        |DDEFECTO #999;
        #999#0  = #104#0;
        #999#1  = #104#1;
        #999#2  = #104#2;
        |GRABA 020#999b;
    |FINSI;

    #999#3  = #715#1;
    #999#4  = "ANUAL";
    #999#5  = #0#30;
    #999#6  = "S";
    #999#7  = #104#4;
    |GRABA 020#999a;
    |LIBERA #999;

    nSwGraba = 1;
|FPRC;

|DEFBUCLE dsmom004;
     #104#1;
     ;
     nDEmpresa, #0#14, 99, 184, 00;
     nHEmpresa, #0#14, 99, 184, 99;
     ;
     NULL, GrabaTempo;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |DBASS aPath; |QBF aPath;
     aPathDoc = aPath + "basica/word/";

     nBytes = 0;
     aAbre1 = aPathDoc + "word0046.doc";
     |XABRE "B", aAbre1, nHandle;
     |SI FSalida < 0;
         nBytes = 1;
     |SINO;
         nBytes = 0;
         |XPOSICION nHandle, nBytes, 2;
     |FINSI;
     |XCIERRA nHandle;

     |SI nBytes = 1;  |O nBytes = 105984;
         |ABRE #400;
         #400#0 = "modelos";
         #400#1 = "dsmoy056";
         #400#2 = "word0046.doc";
         |LEE 101#400=;
         |SI FSalida = 0;
             |BORRA 020#400a;
             |LIBERA #400;
             |FBORRA aAbre1;
         |FINSI;
         |CIERRA #400;

         |SUB_EJECUTA_NP ":basica/wordm000;CREALOS";
     |FINSI;

     |DBASS aPath; |QBF aPath;
     aPathDoc = aPath + "basica/word/";

     aAbre1 = aPathDoc + "word0046.doc";
     |XABRE "E", aAbre1, nHandle;
     |SI FSalida < 0;
         |MENAV "     Instale Ficheros patrones (Documentos en Word)";
         |ACABA;
     |FINSI;

     aFichero = ("cer" + Usuario) % 108;
     |NOME_DAT #999 aFichero;
     |ABRE #999;  |CIERRA #999;  |DELINDEX #999;

     nSwGraba = 0;
     |ABRE #999;
     |SI #0#0 ! 0;
         nDEmpresa = #0#0;
         nHEmpresa = #0#1;
         |BUCLE dsmom004;
     |SINO;
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               nDEmpresa = #0nCampo;
               nHEmpresa = #0nCampo;
               |BUCLE dsmom004;
         |SIGUE;
     |FINSI;
     |CIERRA #999;

     |SI nSwGraba = 0;
          |MENAV "     Seleccion Vacia.";
          |DELINDEX #999;
          |ACABA;
     |FINSI;

     nPrimero = 0;
     nWord1   = -1;

     |BUCLE dsmow014;


     |DELINDEX #999;
|FPRC;
