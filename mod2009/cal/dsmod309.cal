|FICHEROS;
     dsmod309 #309,MANTE;

     dsmoc349 #349;

     dsmow056 #956;
     dsmow057 #957;
     dsmow058 #958;
     dsmow059 #959;
     dsmow070 #970;
     dsmow069 #999,MANTE;
     dsmow518 #518;

     dsmom030 #30;

     :/contagen/def/canempre #101;
     :/contagen/def/camaniva #102;
     :/contagen/def/caivalin #103;
     :/contagen/def/caivaasi #104;
     :/contagen/def/caivam03 #105;

     :/basica/def/agicen14 #214;

     referen@   #800;
     espejo1@   #1300;
     &clientes@ #715;
     &datosper@ #718;
     &regisnif@ #709;
|FIN;

|VARIABLES;
     nForma            = 0;
     nModo             = 0;
     nCampo1           = 0;
     nCampo2           = 0;
     nCampo3           = 0;
     nCampo11          = 0;
     nCampo22          = 0;
     nCampo33          = 0;
     nPorce            = 0;
     nBaseImpo         = 0;
     nCuota            = 0;
     nCompl            = 0;
     nSwPasa           = 0;
     nDepar            = 0;
     nDPeriodo         = 0;
     nHPeriodo         = 0;
     nEjer             = 0;
     nCompensado       = 0;
     nChequeo          = 0;

     aJustif           = "";
     aBase             = "";
     aMas              = "";
     aPathConta        = "";

     fFechaEmi         = @;

     &enConversor      = 0;
     &enEmpresa        = 0;
     &enPerConta       = 0;
     &eaLaMonEmp       = 0;
     &enControla       = 0;

     &enEjer           = 0;
     &enSwOpPar        = 0;
     &enPeriodoPar     = 0;
     &enSwPartido      = 0;
     &swerror          = 0;

     &nPer349        = 0;
     nBaseImpo349    = 0;
     nCuota349       = 0;
     &enPeriodo      = 0;
     &enActividad    = 0;
     &enTipoEntrada  = 0;
     aTipo           = "";
     nModelo         = 0;
     &eaNombreAct    = 0;
     &enModelo349    = 0;
     &enComplem      = 0;
     nPeriodo        = 0;
     nEntrada        = 0;
     &eaCaptura      = "";
     &eaComunidad    = "";
     &eaComunero     = "";

     aMulDep         = "";
|FIN;

|INCLUYE i_varemi;

|PROCESO Baja349;
     nModelo       = enModelo;
     enTipoEntrada = 3;
     enModelo      = 349;
     eaNombreAct   = #309#8;
     enModelo349   = 309;
     enPeriodo     = nPer349;
     |SUB_EJECUTA "dsmoc349";
     enModelo      = nModelo;
|FPRC;


|PROCESO Graba349;
     nModelo       = enModelo;
     enTipoEntrada = 95;
     enModelo      = 349;
     eaNombreAct   = #309#8;
     enModelo349   = 309;
     enPeriodo     = nPer349;
     |SUB_EJECUTA "dsmoc349";

     eaCodNif = #102#14;
     |HAZ LeeNifs;

     |ABRE #349;
     #349#0  = enEmpresa;
     #349#1  = enEjer;
     #349#2  = nPer349;
     #349#3  = enModelo;
     #349#4  = enComplem;
     #349#5  = enActividad;
     #349#6  = aTipo;
     #349#7  = #102#14;
     #349#25 = 0;
     #349#26 = 0;
     |SI aTipo = "ER"; |O aTipo = "AR";
         |SI #105#5 ! 0;
             #349#25 = #105#5; || Ejercicio Declarado;
             #349#26 = #105#4;
         |FINSI;
     |FINSI;
     |LEE 101#349=;
     |SI FSalida ! 0;
         |DDEFECTO #349;
         #349#0  = enEmpresa;
         #349#1  = enEjer;
         #349#2  = nPer349;
         #349#3  = enModelo;
         #349#4  = enComplem;
         #349#5  = enActividad;
         #349#6  = aTipo;
         #349#7  = #102#14;
         #349#25 = 0;
         #349#26 = 0;
         |SI aTipo = "ER"; |O aTipo = "AR";
             |SI #105#5 ! 0;
                 #349#25 = #105#5; || Ejercicio Declarado;
                 #349#26 = #105#4;
                 #349#27 = #105#6;
             |FINSI;
         |FINSI;
         |SI #709#12 !  "   ";  #349#8  = #709#12;  |FINSI;
         #349#9  = #709#1;
         |GRABA 020#349b;
     |FINSI;

     |SI #349#6 = "A "; |O #349#6 = "AR";
         nSwEsta = 0;
         |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #349nCampo2 = nPorce;
                   #349nCampo1 = #349nCampo1 + nBaseImpo349;
                   #349nCampo2 = nPorce;
                   #349nCampo3 = #349nCampo3 + nCuota349;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;

         |SI nSwEsta = 0;
             |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
                   nCampo1 = nCampo2 - 1;
                   nCampo3 = nCampo2 + 1;
                   |SI #349nCampo2 = 0; |Y #349nCampo1 = 0;  |Y #349nCampo3 = 0;
                       #349nCampo1 = #349nCampo1 + nBaseImpo349;
                       #349nCampo2 = nPorce;
                       #349nCampo3 = #349nCampo3 + nCuota349;
                       nSwEsta = 1;
                       |SAL;
                   |FINSI;
              |SIGUE;
         |FINSI;

         |SI nSwEsta = 0;
             #349#19 = #349#19 + nBaseImpo349;
             #349#20 = 0;
             #349#21 = #349#21 + nCuota349;
         |FINSI;

         #349#22 = #349#10 + #349#13 + #349#16 + #349#19;
     |SINO;
         #349#22 = #349#22 + nBaseImpo349;
     |FINSI;

     |GRABA 020#349a;
     |LIBERA #349;
     |CIERRA #349;

     enModelo = nModelo;
|FPRC;

|PROCESO PonRecargo;
     nSwEsta = 0;
     |PARA nCampo2 = 58;  |SI nCampo2 [ 67;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #309nCampo2 = nPorce;
               #309nCampo1 = #309nCampo1 + nBaseImpo;
               #309nCampo2 = nPorce;
               #309nCampo3 = #309nCampo3 + nCuota;
               nSwEsta = 1;
                |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwEsta = 0;
         |PARA nCampo2 = 58;  |SI nCampo2 [ 67;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #309nCampo2 = 0; |Y #309nCampo1 = 0;  |Y #309nCampo3 = 0;
                   #309nCampo1 = #309nCampo1 + nBaseImpo;
                   #309nCampo2 = nPorce;
                   #309nCampo3 = #309nCampo3 + nCuota;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;
         #309#66 = #309#66 + nBaseImpo;
         #309#67 = 0;
         #309#68 = #309#68 + nCuota;
     |FINSI;
|FPRC;

|PROCESO PonIVA;
     nSwEsta = 0;
     |PARA nCampo2 = 49;  |SI nCampo2 [ 55;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #309nCampo2 = nPorce;
               #309nCampo1 = #309nCampo1 + nBaseImpo;
               #309nCampo2 = nPorce;
               #309nCampo3 = #309nCampo3 + nCuota;
               nSwEsta = 1;
                |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwEsta = 0;
         |PARA nCampo2 = 49;  |SI nCampo2 [ 55;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #309nCampo2 = 0; |Y #309nCampo1 = 0;  |Y #309nCampo3 = 0;
                   #309nCampo1 = #309nCampo1 + nBaseImpo;
                   #309nCampo2 = nPorce;
                   #309nCampo3 = #309nCampo3 + nCuota;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;
         #309#54 = #309#54 + nBaseImpo;
         #309#55 = 0;
         #309#56 = #309#56 + nCuota;
     |FINSI;

     |SI #103#10 ! 0;
         nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
         nPorce    = #103#9;
         nCuota    = (#103#10 / enConversor) ! EURODBMOD;
         |HAZ PonRecargo;
     |FINSI;
|FPRC;

|PROCESO LeeLinea309;
    ||  |SI #103#5 = "N"; |ACABA;  |FINSI;  ||Paco Hellin 1243_1310

    aAlfa1 = #103#30; |QBF aAlfa1; |SI aAlfa1 = ""; #103#30 = #102#10; |FINSI;
    |SI aMulDep = "S";
        nDepar = #103#30;
        |SI nDepar = 0;  nDepar = 1;   |FINSI;
        |SI nChequeo = 0;
            |ABRE #214;
            #214#0 = #309#0;
            #214#1 = nDepar;
            |LEE 040#214=;
            |SI FSalida ! 0;  nDepar = 1;  |FINSI;
            |CIERRA #214;
        |FINSI;
        |SI #309#1 ! nDepar;  |ACABA;  |FINSI;
    |FINSI;

     #30#0 = #103#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #30#4 = "N";  |ACABA;  |FINSI;

     |SI #30#0 ! 611;  |Y #30#0 ! 615;  |Y #30#0 ! 619;  |Y #30#0 ! 622;
      |Y #30#0 ! 612;  |Y #30#0 ! 616;  |Y #30#0 ! 620;  |Y #30#0 ! 623;
         |ACABA;
     |FINSI;

     |SI nChequeo = 1;
         enControla = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI #30#0 = 611;  |O #30#0 = 615;  |O #30#0 = 619;  |O #30#0 = 622;
         #309#28 = "X";
     |FINSI;

     |SI #30#0 = 612;  |O #30#0 = 616;  |O #30#0 = 620;  |O #30#0 = 623;
         #309#29 = "X";
     |FINSI;

     |SI #30#0 = 611;  |O #30#0 = 612;
         nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
         nPorce    = 4;
         nCuota    = ((#103#6 % nPorce) / enConversor) ! EURODBMOD;
         |HAZ PonRecargo;

         nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
         nPorce    = 16;
         nCuota    = ((#103#6 % nPorce) / enConversor) ! EURODBMOD;
         nSwPasa   = 1;
         |HAZ PonIVA;
     |FINSI;

     |SI #30#0 = 615;  |O #30#0 = 616;  |O #30#0 = 620;  |O #30#0 = 623;
         nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
         nPorce    = 16;
         nCuota    = ((#103#6 % nPorce) / enConversor) ! EURODBMOD;
         nSwPasa   = 1;
         |HAZ PonIVA;
     |FINSI;

     |SI #30#0 = 619;  |O #30#0 = 622;
         nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
         nPorce    = 7;
         nCuota    = ((#103#6 % nPorce) / enConversor) ! EURODBMOD;
         nSwPasa   = 1;
         |HAZ PonIVA;
     |FINSI;

     |SI nPorce = 0;  |Y nCuota = 0;  |ACABA;  |FINSI;
     nCuota349    = nCuota;
     nBaseImpo349 = nBaseImpo;
     aTipo = "A";
     |SI nCuota < 0; |O nBaseImpo < 0;
         nCuota349    = - nCuota;
         nBaseImpo349 = - nBaseImpo;
         aTipo = "AR";
     |FINSI;
     |HAZ Graba349;
|FPRC;

|DEFBUCLE caivalin309;
     #103#1;
     ;
     #102#0, #102#1, 01;
     #102#0, #102#1, 99;
     ;
     NULL, LeeLinea309;
|FIN;

|PROCESO LeeCabecera309;

     |SI aMulDep ! "S";
         nDepar = #102#10;
         |SI nDepar = 0;  nDepar = 1;   |FINSI;

         |SI nChequeo = 0;
             |ABRE #214;
             #214#0 = #309#0;
             #214#1 = nDepar;
             |LEE 040#214=;
             |SI FSalida ! 0;  nDepar = 1;  |FINSI;
             |CIERRA #214;
         |FINSI;
         |SI #309#1 ! nDepar;  |ACABA;  |FINSI;
     |FINSI;

     |ABRE #105;
     |DDEFECTO #105;
     #105#0 = #102#0;
     #105#1 = #102#1;
     |LEE 040#105=;
     |CIERRA #105;

     |BUCLE caivalin309;

     |SI enControla = 1;  |Y nChequeo = 1;
         |ERROR10;
     |FINSI;
     |LIBERA #102;
|FPRC;

|DEFBUCLE camaniva309;
     #102#1;
     5;
     00, 0000000000, nDPeriodo;
     99, 9999999999, nHPeriodo;
     be;
     NULL, LeeCabecera309;
|FIN;

|PROCESO dsmod309C;
     |SI #800#3 > #309#3;  |ACABA;  |FINSI;

     |SI #309#3 = #800#3;  |Y  #309#4 = #800#4;  |Y #309#5 = #800#5;
         |ACABA;
     |FINSI;

     |PARA nCampo2 = 49;  |SI nCampo2 [ 55;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1     = nCampo2 - 1;
           nCampo3     = nCampo2 + 1;
           nCompensado = 0;
           |PARA nCampo22 = 49;  |SI nCampo22 [ 55;  |HACIENDO nCampo22 = nCampo22 + 3;
                 nCampo11 = nCampo22 - 1;
                 nCampo33 = nCampo22 + 1;
                 |SI #309nCampo22 = #800nCampo2;
                     #309nCampo11 = #309nCampo11 - #800nCampo1;
                     #309nCampo33 = #309nCampo33 - #800nCampo3;
                     nCompensado = 1;
                     |SAL;
                 |FINSI;
           |SIGUE;

           |SI nCompensado = 0;
               |SI #309#48 = 0;  |Y #309#49 = 0;  |Y #309#50 = 0;
                   #309#48 = #309#48 - #800nCampo1;
                   #309#49 = #800nCampo2;
                   #309#50 = #309#50 - #800nCampo3;
                   nCompensado = 1;
               |FINSI;
           |FINSI;

           |SI nCompensado = 0;
               |SI #309#51 = 0;  |Y #309#52 = 0;  |Y #309#53 = 0;
                   #309#51 = #309#51 - #800nCampo1;
                   #309#52 = #800nCampo2;
                   #309#53 = #309#53 - #800nCampo3;
                   nCompensado = 1;
               |FINSI;
           |FINSI;

           |SI nCompensado = 0;
               |SI #309#54 = 0;  |Y #309#55 = 0;  |Y #309#56 = 0;
                   #309#54 = #309#54 - #800nCampo1;
                   #309#55 = #800nCampo2;
                   #309#56 = #309#56 - #800nCampo3;
                   nCompensado = 1;
               |FINSI;
           |FINSI;
     |SIGUE;

     |PARA nCampo2 = 58;  |SI nCampo2 [ 67;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1     = nCampo2 - 1;
           nCampo3     = nCampo2 + 1;
           nCompensado = 0;
           |PARA nCampo22 = 58;  |SI nCampo22 [ 67;  |HACIENDO nCampo22 = nCampo22 + 3;
                 nCampo11 = nCampo22 - 1;
                 nCampo33 = nCampo22 + 1;
                 |SI #309nCampo22 = #800nCampo2;
                     #309nCampo11 = #309nCampo11 - #800nCampo1;
                     #309nCampo33 = #309nCampo33 - #800nCampo3;
                     nCompensado = 1;
                     |SAL;
                 |FINSI;
           |SIGUE;

           |SI nCompensado = 0;
               |SI #309#57 = 0;  |Y #309#58 = 0;  |Y #309#59 = 0;
                   #309#57 = #309#57 - #800nCampo1;
                   #309#58 = #800nCampo2;
                   #309#59 = #309#59 - #800nCampo3;
                   nCompensado = 1;
               |FINSI;
           |FINSI;

           |SI nCompensado = 0;
               |SI #309#60 = 0;  |Y #309#61 = 0;  |Y #309#62 = 0;
                   #309#60 = #309#60 - #800nCampo1;
                   #309#61 = #800nCampo2;
                   #309#62 = #309#62 - #800nCampo3;
                   nCompensado = 1;
               |FINSI;
           |FINSI;

           |SI nCompensado = 0;
               |SI #309#63 = 0;  |Y #309#64 = 0;  |Y #309#65 = 0;
                   #309#63 = #309#63 - #800nCampo1;
                   #309#64 = #800nCampo2;
                   #309#65 = #309#65 - #800nCampo3;
                   nCompensado = 1;
               |FINSI;
           |FINSI;

           |SI nCompensado = 0;
               |SI #309#66 = 0;  |Y #309#67 = 0;  |Y #309#68 = 0;
                   #309#66 = #309#66 - #800nCampo1;
                   #309#67 = #800nCampo2;
                   #309#68 = #309#68 - #800nCampo3;
                   nCompensado = 1;
               |FINSI;
           |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmod309C;
     #800#1006;
     ;
     #309#0, #309#1, #309#2, 00, 00, 01;
     #309#0, #309#1, #309#2, 99, 99, 99;
     ;
     NULL, dsmod309C;
|FIN;

|PROCESO Compensa349;
     |SI #1300#6 ! "A "; |Y #1300#6 ! "E ";  |ACABA;  |FINSI;

     #349#0  = #1300#0;
     #349#1  = #1300#1;
     #349#2  = nPer349;
     #349#3  = #1300#3;
     #349#4  = #1300#4;
     #349#5  = #1300#5;
     #349#6  = #1300#6;
     #349#7  = #1300#7;
     #349#25 = #1300#25;
     #349#26 = #1300#26;
     |LEE 101#349=;
     |SI FSalida = 0;
         #349#22 = #349#22 - #1300#22;

         |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
                      nCampo11 = nCampo22 - 1;
                      nCampo33 = nCampo22 + 1;
                      |SI #349nCampo22 = #1300nCampo2;
                          #349nCampo11 = #349nCampo11 - #1300nCampo1;
                          #349nCampo33 = #349nCampo33 - #1300nCampo3;
                          |SAL;
                      |FINSI;
                |SIGUE;
         |SIGUE;

         |GRABA 020#349a;
         |LIBERA #349;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc349;
     #1300#1010;
     ;
     #309#0, #309#2, nPeriodo, 349, 0, #309#1, "A ", 0000, 0, "            ";
     #309#0, #309#2, nPeriodo, 349, 0, #309#1, "E ", 9999, 9, "zzzzzzzzzzzz";
     ;
     NULL, Compensa349;
|FIN;

|PROCESO BorraCero349;
     |SI #349#6 ! "A "; |Y #349#6 ! "E ";  |ACABA;  |FINSI;
     |SI #349#22 ! 0;   |ACABA;  |FINSI;

     |BORRA 020#349a;
     |LIBERA #349;
|FPRC;

|DEFBUCLE dsmoc349Cero;
     #349#1;
     ;
     #309#0, #309#2, nPer349, 349, 0, #309#1, "A ", 0000, 0, "            ";
     #309#0, #309#2, nPer349, 349, 0, #309#1, "E ", 9999, 9, "zzzzzzzzzzzz";
     be;
     NULL, BorraCero349;
|FIN;

|PROCESO PaseContab;  |TIPO 0;

     |SI #309#11 = "X";
         |ACABA;
     |FINSI;

     eaCaptura    = "REGISTROS";
     enEmpresa    = #309#0;
     enEjer       = #309#2;
     enPeriodo    = #309#3;
     enModelo     = 309;
     enComplem    = #309#4;
     enActividad  = #309#1;
     eaNombreAct  = #309#8;
     enModelo349  = 309;
     enSwOpPar    = 0;
     |HAZ SituaEmpresa;
     |SI swerror = 1;
         eaCaptura = "MANUAL";
         |ACABA;
     |FINSI;

     |CONFI "0000NDesea realizar el pase desde Contabilidad.";
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

||      |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         aAlfa = #309#2;
         aAlfa = aAlfa % -102;
         nEjer = aAlfa;

         |ABRE #101;
         |SELECT #4#101;
         #101#2  = #309#0;
         #101#26 = nEjer;
         |LEE 040#101=;
         |SI FSalida ! 0;  |CIERRA #101;  |ACABA;   |FINSI;
         |CIERRA #101;

         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";

         enEmpresa  = #101#2;
         enPerConta = #101#3;
         eaLaMonEmp = #101#28;
     |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
     |FINSI;
     |HAZ Baja349;

     |HAZ EnConversor;
     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;
     |PATH_DAT #105 aPathConta;
     |ABRE #caivaasi;
     |DDEFECTO #caivaasi;
     |LEE 000#caivaasi.p;
     |CIERRA #caivaasi;
     aMulDep = #caivaasi#132;

     |SI #999#5 = "T";
         |SI #309#3 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   nPer349 = 3; |FINSI;
         |SI #309#3 = 2;   nDPeriodo = 1;  nHPeriodo = 1;   nPer349 = 3; |FINSI;
         |SI #309#3 = 3;   nDPeriodo = 1;  nHPeriodo = 1;   nPer349 = 3; |FINSI;
         |SI #309#3 = 4;   nDPeriodo = 1;  nHPeriodo = 2;   nPer349 = 6; |FINSI;
         |SI #309#3 = 5;   nDPeriodo = 1;  nHPeriodo = 2;   nPer349 = 6; |FINSI;
         |SI #309#3 = 6;   nDPeriodo = 1;  nHPeriodo = 2;   nPer349 = 6; |FINSI;
         |SI #309#3 = 7;   nDPeriodo = 1;  nHPeriodo = 3;   nPer349 = 9; |FINSI;
         |SI #309#3 = 8;   nDPeriodo = 1;  nHPeriodo = 3;   nPer349 = 9; |FINSI;
         |SI #309#3 = 9;   nDPeriodo = 1;  nHPeriodo = 3;   nPer349 = 9; |FINSI;
         |SI #309#3 = 10;  nDPeriodo = 1;  nHPeriodo = 4;   nPer349 = 12;|FINSI;
         |SI #309#3 = 11;  nDPeriodo = 1;  nHPeriodo = 4;   nPer349 = 12;|FINSI;
         |SI #309#3 = 12;  nDPeriodo = 1;  nHPeriodo = 4;   nPer349 = 12;|FINSI;

     |SINO;
         |SI #309#3 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
         |SI #309#3 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
         |SI #309#3 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #309#3 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SI #309#3 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
         |SI #309#3 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
         |SI #309#3 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
         |SI #309#3 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
         |SI #309#3 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
         |SI #309#3 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
         |SI #309#3 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
         |SI #309#3 ] 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
         nPer349 = 12;
     |FINSI;

     |PDEFECTO #309, 48, 72;

     nChequeo = 0;

     |ABRE #30;
     |BUCLE camaniva309;
     |CIERRA #30;

     |SI enSwPartido = 1;
         enSwOpPar   = 2;
         |HAZ FinalPartido;
     |FINSI;

     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/dsmod309.mas";
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     |BUCLE dsmod309C;

     |DESCARGA_DEF #referen@;

     |DBASE aPathModelo;  |QBT aPathModelo;  || Nuevo 349
     aDef = aPathModelo + "def/dsmoc349.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         |ABRE #349;
         |PARA nPeriodo = 1;  |SI nPeriodo < nPer349;  |HACIENDO nPeriodo = nPeriodo + 1;
               |BUCLE dsmoc349;
         |SIGUE;
         |CIERRA #349;
     |FINSI;
     |DESCARGA_DEF #espejo1@;
     |BUCLE dsmoc349Cero;

     #309#69 = #309#50 + #309#53 + #309#56 + #309#59 + #309#62 + #309#65 + #309#68;
     #309#71 = #309#69 - #309#70;

     |ABRE #214;
     #214#0 = #309#0;
     #214#1 = #309#1;
     |LEE 040#214=;
     |SI FSalida ! 0;  |DDEFECTO #214;  |FINSI;
     |CIERRA #214;

     |SI #214#7 = 9;  #309#22 = "X";  |FINSI;
     |SI #214#7 = 3;  #309#23 = "X";  |FINSI;

     |SI #309#69 = 0;
         |CONFI "0000SSin movimientos en Contabilidad. Continuar";
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;
     |C_M #309#6, 1, "N";
     |PINTA #309#18;
|FPRC;

|PROCESO ControlaContab;  |TIPO 0;

     enEmpresa   = #999#0;
     enEjer      = #999#2;
     enSwOpPar   = 0;
     enModelo    = 309;
     enComplem   = 00;
     enActividad = #999#1;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         aAlfa = #999#2;
         aAlfa = aAlfa % -102;
         nEjer = aAlfa;

         |ABRE #101;
         |SELECT #4#101;
         #101#2  = #999#0;
         #101#26 = nEjer;
         |LEE 040#101=;
         |SI FSalida ! 0;  |CIERRA #101;  |ACABA;   |FINSI;
         |CIERRA #101;

         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";

         enEmpresa  = #101#2;
         enPerConta = #101#3;
         eaLaMonEmp = #101#28;
     |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
     |FINSI;
     |HAZ EnConversor;

     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;
     |PATH_DAT #105 aPathConta;
     |ABRE #caivaasi;
     |DDEFECTO #caivaasi;
     |LEE 000#caivaasi.p;
     |CIERRA #caivaasi;
     aMulDep = #caivaasi#132;

     |SI #999#5 = "T";
         nDPeriodo = 1;  nHPeriodo = 4;
     |SINO;
         nDPeriodo = 1;  nHPeriodo = 12;
     |FINSI;

     nChequeo = 1;

     #309#0 = #999#0;
     #309#1 = #999#1;
     #309#2 = #999#2;

     |ABRE #30;
     |BUCLE camaniva309;
     |CIERRA #30;
     |SI enSwPartido = 1;
         enSwOpPar   = 2;
         |HAZ FinalPartido;
     |FINSI;
|FPRC;

|PROCESO Periodo;
     |SI #999#5 = "T";
         |SI #309#3 ! 3;  |Y #309#3 ! 6;  |Y #309#3 ! 9; |Y #309#3 ! 12;
             |MENAV "     El Modelo lo tiene configurado Trimestral debe ser debe 3, 6, 9 o 12";
             |ERROR;
         |FINSI;
         nPer349 = #309#3;
     |FINSI;

     |SI #999#5 = "A";
         |SI #309#3 ! 99;
             |MENAV "     El Modelo lo tiene configurado Anual debe ser debe 99";
             |ERROR;
         |FINSI;
         nPer349 = 12;
     |FINSI;
|FPRC;

|PROCESO Tipo1_309; |TIPO 1;
 nEntrada = (FEntrada / 100) ! 0;
 |SI nEntrada = 3;
     enEmpresa   = #309#0;
     enEjer      = #309#2;
     enPeriodo   = #309#3;
     enModelo    = 309;
     enComplem   = #309#4;
     enActividad = #309#1;
     |HAZ Baja349;
 |FINSI;
|FPRC;

|PROCESO Boton1;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton4, "HIDE";
     |ESTADO_CONTROL nBoton5, "HIDE";
     |ESTADO_CONTROL nBoton6, "HIDE";
     |ESTADO_CONTROL nBoton7, "HIDE";

     |PUSHV 0501 2380;
     #956#0 = #309#19;
     #956#1 = #309#20;
     #956#2 = #309#21;
     |PINPA #0#956;
     |PINDA #0#956;
     |ENDATOS #1#956;
     |SI FSalida = 0;
         #309#19 = #956#0;
         #309#20 = #956#1;
         #309#21 = #956#2;
     |FINSI;
     |POPV;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton4, "SHOW";
     |ESTADO_CONTROL nBoton5, "SHOW";
     |ESTADO_CONTROL nBoton6, "SHOW";
     |ESTADO_CONTROL nBoton7, "SHOW";
|FPRC;

|PROCESO Boton2;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton4, "HIDE";
     |ESTADO_CONTROL nBoton5, "HIDE";
     |ESTADO_CONTROL nBoton6, "HIDE";
     |ESTADO_CONTROL nBoton7, "HIDE";

     |PUSHV 0501 2380;
     #957#0 = #309#22;
     #957#1 = #309#23;
     #957#2 = #309#24;
     #957#3 = #309#25;
     #957#4 = #309#26;
     #957#5 = #309#27;
     |PINPA #0#957;
     |PINDA #0#957;
     |ENDATOS #1#957;
     |SI FSalida = 0;
         #309#22 = #957#0;
         #309#23 = #957#1;
         #309#24 = #957#2;
         #309#25 = #957#3;
         #309#26 = #957#4;
         #309#27 = #957#5;
     |FINSI;
     |POPV;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton4, "SHOW";
     |ESTADO_CONTROL nBoton5, "SHOW";
     |ESTADO_CONTROL nBoton6, "SHOW";
     |ESTADO_CONTROL nBoton7, "SHOW";
|FPRC;

|PROCESO Boton3;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton4, "HIDE";
     |ESTADO_CONTROL nBoton5, "HIDE";
     |ESTADO_CONTROL nBoton6, "HIDE";
     |ESTADO_CONTROL nBoton7, "HIDE";

     |PUSHV 0501 2380;
     #958#0 = #309#28;
     #958#1 = #309#29;
     #958#2 = #309#30;
     #958#3 = #309#31;
     #958#4 = #309#32;
     #958#5 = #309#33;
     |PINPA #0#958;
     |PINDA #0#958;
     |ENDATOS #1#958;
     |SI FSalida = 0;
         #309#28 = #958#0;
         #309#29 = #958#1;
         #309#30 = #958#2;
         #309#31 = #958#3;
         #309#32 = #958#4;
         #309#33 = #958#5;
     |FINSI;
     |POPV;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton4, "SHOW";
     |ESTADO_CONTROL nBoton5, "SHOW";
     |ESTADO_CONTROL nBoton6, "SHOW";
     |ESTADO_CONTROL nBoton7, "SHOW";
|FPRC;

|PROCESO Boton11;
     |ESTADO_CONTROL nBoton11, "HIDE";
     |ESTADO_CONTROL nBoton12, "HIDE";
     |ESTADO_CONTROL nBoton13, "HIDE";
     |ESTADO_CONTROL nBoton14, "HIDE";

     |PUSHV 0501 2380;
     |PINPA #0#959;

     |C_M #959#5,  1, "N";  |C_V #959#5,  1, "N";
     |C_M #959#6,  1, "N";  |C_V #959#6,  1, "N";
     |C_M #959#7,  1, "N";  |C_V #959#7,  1, "N";
     |C_M #959#8,  1, "N";  |C_V #959#8,  1, "N";
     |C_M #959#9,  1, "N";  |C_V #959#9,  1, "N";
     |C_M #959#10, 1, "N";  |C_V #959#10, 1, "N";
     |C_M #959#11, 1, "N";  |C_V #959#11, 1, "N";
     |C_M #959#12, 1, "N";  |C_V #959#12, 1, "N";
     |C_M #959#13, 1, "N";  |C_V #959#13, 1, "N";

     |C_M #959#0,  1, "S";  |C_V #959#0,  1, "S";  |C_P #959#0, 1, 1350;
     |C_M #959#1,  1, "S";  |C_V #959#1,  1, "S";  |C_P #959#1, 1, 1450;
     |C_M #959#2,  1, "S";  |C_V #959#2,  1, "S";  |C_P #959#2, 1, 1550;
     |C_M #959#3,  1, "S";  |C_V #959#3,  1, "S";  |C_P #959#3, 1, 1650;
     |C_M #959#4,  1, "S";  |C_V #959#4,  1, "S";  |C_P #959#4, 1, 1750;

     |ATRI S;  |PINTA 1124, "Vehiculos                 ";  |ATRI s;
     |PINTA 1324, "Marca ..................: ";
     |PINTA 1424, "Tipo ...................: ";
     |PINTA 1524, "Modelo (Denom.Comercial): ";
     |PINTA 1624, "N§.Identif. (Bastidor) .: ";
     |PINTA 1724, "Clasificacion ..........: ";

     #959#0 = #309#34;
     #959#1 = #309#35;
     #959#2 = #309#36;
     #959#3 = #309#37;
     #959#4 = #309#38;
     |PINDA #0#959;
     |ENDATOS #1#959;
     |SI FSalida = 0;
         #309#34 = #959#0;
         #309#35 = #959#1;
         #309#36 = #959#2;
         #309#37 = #959#3;
         #309#38 = #959#4;
     |FINSI;

     |POPV;

     |ESTADO_CONTROL nBoton11, "SHOW";
     |ESTADO_CONTROL nBoton12, "SHOW";
     |ESTADO_CONTROL nBoton13, "SHOW";
     |ESTADO_CONTROL nBoton14, "SHOW";
|FPRC;

|PROCESO Boton12;
     |ESTADO_CONTROL nBoton11, "HIDE";
     |ESTADO_CONTROL nBoton12, "HIDE";
     |ESTADO_CONTROL nBoton13, "HIDE";
     |ESTADO_CONTROL nBoton14, "HIDE";

     |PUSHV 0501 2380;
     |PINPA #0#959;

     |C_M #959#0,  1, "N";  |C_V #959#0,  1, "N";
     |C_M #959#1,  1, "N";  |C_V #959#1,  1, "N";
     |C_M #959#2,  1, "N";  |C_V #959#2,  1, "N";
     |C_M #959#3,  1, "N";  |C_V #959#3,  1, "N";
     |C_M #959#4,  1, "N";  |C_V #959#4,  1, "N";
     |C_M #959#9,  1, "N";  |C_V #959#9,  1, "N";
     |C_M #959#10, 1, "N";  |C_V #959#10, 1, "N";
     |C_M #959#11, 1, "N";  |C_V #959#11, 1, "N";
     |C_M #959#12, 1, "N";  |C_V #959#12, 1, "N";
     |C_M #959#13, 1, "N";  |C_V #959#13, 1, "N";

     |C_M #959#5,  1, "S";  |C_V #959#5,  1, "S";  |C_P #959#5, 1, 1350;
     |C_M #959#6,  1, "S";  |C_V #959#6,  1, "S";  |C_P #959#6, 1, 1450;
     |C_M #959#7,  1, "S";  |C_V #959#7,  1, "S";  |C_P #959#7, 1, 1550;
     |C_M #959#8,  1, "S";  |C_V #959#8,  1, "S";  |C_P #959#8, 1, 1650;

     |ATRI S;  |PINTA 1124, "Embarcaciones             ";  |ATRI s;
     |PINTA 1324, "Fabricante .............: ";
     |PINTA 1424, "Tipo-Modelo ............: ";
     |PINTA 1524, "N§.Identif. (Construc.) : ";
     |PINTA 1624, "Eslora maxima ..........: ";

     #959#5 = #309#39;
     #959#6 = #309#40;
     #959#7 = #309#41;
     #959#8 = #309#42;
     |PINDA #0#959;
     |ENDATOS #1#959;
     |SI FSalida = 0;
         #309#39 = #959#5;
         #309#40 = #959#6;
         #309#41 = #959#7;
         #309#42 = #959#8;
     |FINSI;

     |POPV;

     |ESTADO_CONTROL nBoton11, "SHOW";
     |ESTADO_CONTROL nBoton12, "SHOW";
     |ESTADO_CONTROL nBoton13, "SHOW";
     |ESTADO_CONTROL nBoton14, "SHOW";
|FPRC;

|PROCESO Boton13;
     |ESTADO_CONTROL nBoton11, "HIDE";
     |ESTADO_CONTROL nBoton12, "HIDE";
     |ESTADO_CONTROL nBoton13, "HIDE";
     |ESTADO_CONTROL nBoton14, "HIDE";

     |PUSHV 0501 2380;
     |PINPA #0#959;

     |C_M #959#0,  1, "N";  |C_V #959#0,  1, "N";
     |C_M #959#1,  1, "N";  |C_V #959#1,  1, "N";
     |C_M #959#2,  1, "N";  |C_V #959#2,  1, "N";
     |C_M #959#3,  1, "N";  |C_V #959#3,  1, "N";
     |C_M #959#4,  1, "N";  |C_V #959#4,  1, "N";
     |C_M #959#5,  1, "N";  |C_V #959#5,  1, "N";
     |C_M #959#6,  1, "N";  |C_V #959#6,  1, "N";
     |C_M #959#7,  1, "N";  |C_V #959#7,  1, "N";
     |C_M #959#8,  1, "N";  |C_V #959#8,  1, "N";

     |C_M #959#9,  1, "S";  |C_V #959#9,  1, "S";  |C_P #959#9,  1, 1350;
     |C_M #959#10, 1, "S";  |C_V #959#10, 1, "S";  |C_P #959#10, 1, 1450;
     |C_M #959#11, 1, "S";  |C_V #959#11, 1, "S";  |C_P #959#11, 1, 1550;
     |C_M #959#12, 1, "S";  |C_V #959#12, 1, "S";  |C_P #959#12, 1, 1650;
     |C_M #959#13, 1, "S";  |C_V #959#13, 1, "S";  |C_P #959#13, 1, 1750;

     |ATRI S;  |PINTA 1124, "Aeronaves                 ";  |ATRI s;
     |PINTA 1324, "Fabricante .............: ";
     |PINTA 1424, "Marca-Tipo-Modelo ......: ";
     |PINTA 1524, "N§. Serie ..............: ";
     |PINTA 1624, "A¤o Fabricacion ........: ";
     |PINTA 1724, "Peso maximo despegue Kg.: ";

     #959#9  = #309#43;
     #959#10 = #309#44;
     #959#11 = #309#45;
     #959#12 = #309#46;
     #959#13 = #309#47;
     |PINDA #0#959;
     |ENDATOS #1#959;
     |SI FSalida = 0;
         #309#43 = #959#9;
         #309#44 = #959#10;
         #309#45 = #959#11;
         #309#46 = #959#12;
         #309#47 = #959#13;
     |FINSI;

     |POPV;

     |ESTADO_CONTROL nBoton11, "SHOW";
     |ESTADO_CONTROL nBoton12, "SHOW";
     |ESTADO_CONTROL nBoton13, "SHOW";
     |ESTADO_CONTROL nBoton14, "SHOW";
|FPRC;

|PROCESO Boton4;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton4, "HIDE";
     |ESTADO_CONTROL nBoton5, "HIDE";
     |ESTADO_CONTROL nBoton6, "HIDE";
     |ESTADO_CONTROL nBoton7, "HIDE";

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Vehiculos ", 1024, 1179, Boton11;
     nBoton11 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Embarcaciones ", 1224, 1379, Boton12;
     nBoton12 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Aeronaves ", 1424, 1579, Boton13;
     nBoton13 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Salir", 2224, 2279, Boton7;
     nBoton14 = FSalida;

     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  |HAZ Boton11;  |FINSI;
         |SI aTecla = aF3;  |HAZ Boton12;  |FINSI;
         |SI aTecla = aF4;  |HAZ Boton13;  |FINSI;
         |SI aTecla = aF8;  |SAL;          |FINSI;
     |SIGUE;

     aTecla = "";

     |FIN_CONTROL_WINDOWS nBoton11;
     |FIN_CONTROL_WINDOWS nBoton12;
     |FIN_CONTROL_WINDOWS nBoton13;
     |FIN_CONTROL_WINDOWS nBoton14;

     |PULSATECLA;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton4, "SHOW";
     |ESTADO_CONTROL nBoton5, "SHOW";
     |ESTADO_CONTROL nBoton6, "SHOW";
     |ESTADO_CONTROL nBoton7, "SHOW";
|FPRC;

|PROCESO Boton5;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton4, "HIDE";
     |ESTADO_CONTROL nBoton5, "HIDE";
     |ESTADO_CONTROL nBoton6, "HIDE";
     |ESTADO_CONTROL nBoton7, "HIDE";

     |PUSHV 0501 2380;
     |PARA nCampo1 = 0;  |SI nCampo1 [ 24;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 + 48;
           #970nCampo1 = #309nCampo2;
     |SIGUE;

     |C_M #970#22, 1, "S";  |C_V #970#22, 1, "S";
     |C_M #970#24, 1, "S";  |C_V #970#24, 1, "S";
     |SI #309#4 = 0;
         #970#22 = 0;
         |C_M #970#22, 1, "N";  |C_V #970#22, 1, "N";
         |C_M #970#24, 1, "N";  |C_V #970#24, 1, "N";
     |FINSI;

     enEmpresa    = #309#0;
     enEjer       = #309#2;
     enActividad  = #309#1;
     enPeriodo    = #309#3;
     enComplem    = #309#4;
     enModelo     = 309;
     eaNombreAct  = #309#8;
     enModelo349  = 309;

     |PINPA #0#970;
     |PINDA #0#970;
     |ENDATOS #1#970;
     |SI FSalida = 0;
         |PARA nCampo1 = 0;  |SI nCampo1 [ 24;  |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2 = nCampo1 + 48;
               #309nCampo2 = #970nCampo1;
         |SIGUE;
     |FINSI;
     |POPV;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton4, "SHOW";
     |ESTADO_CONTROL nBoton5, "SHOW";
     |ESTADO_CONTROL nBoton6, "SHOW";
     |ESTADO_CONTROL nBoton7, "SHOW";
|FPRC;

|PROCESO CargaEmpresa;
     enCodCli = #309#0;
     |HAZ LeePersona;

     |DDEFECTO #518;

     enCalcCif = 0;

     |SI enSwDeDonde = 1;
         #518#4   = (("00" + #715#15) % -102) + (("000" + #715#16) % -103);
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #518#5   = eaVarDni;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = aAlfa1;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #518#6 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #518#7 = eaAlfa;
         |SINO;
             eaAlfa = #715#1;  |HAZ QuitaRaros;  #518#6  = eaAlfa;
             #518#7  = ".";
         |FINSI;
         #518#8  = #715#29;
         eaAlfa  = #715#30;  |HAZ QuitaRaros;  #518#9 = eaAlfa;
         #518#10 = #715#31 % 104;
         #518#11 = #715#32;
         #518#12 = #715#33;
         #518#13 = #715#34;
         #518#14 = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
         eaAlfa  = #715#37;  |HAZ QuitaRaros;      #518#15 = eaAlfa;
         eaAlfa  = #715#38;  |HAZ QuitaRaros;      #518#16 = eaAlfa;
         eaAlfa  = #715#54;  |HAZ QuitaRarosTfno;   #518#17 = eaAlfa;

         eaDeleg     = #715#17;
         eaAdmin     = #715#18;
     |SINO;
         #518#4   = (("00" + #715#63) % -102) + (("000" + #715#64) % -103);
         eaVarDni = #715#13;  |HAZ CalculameDNI;    #518#5   = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;      #518#6  = eaAlfa;
         #518#7   = ".";
         #518#8   = #715#3;
         eaAlfa   = #715#4;  |HAZ QuitaRaros;      #518#9 = eaAlfa;
         #518#10 = #715#5 % 104;
         #518#11 = #715#6;
         #518#12 = #715#7;
         #518#13 = #715#8;
         #518#14 = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
         eaAlfa  = #715#11;  |HAZ QuitaRaros;     #518#15 = eaAlfa;
         eaAlfa  = #715#12;  |HAZ QuitaRaros;     #518#16 = eaAlfa;
         eaAlfa  = #715#14;  |HAZ QuitaRarosTfno; #518#17 = eaAlfa;

         eaDeleg     = #715#91;
         eaAdmin     = #715#92;
     |FINSI;

     #518#18  = #309#2;
     |SI #309#3 = 3;   #518#19 = "1T";  |FINSI;
     |SI #309#3 = 6;   #518#19 = "2T";  |FINSI;
     |SI #309#3 = 9;   #518#19 = "3T";  |FINSI;
     |SI #309#3 = 12;  #518#19 = "4T";  |FINSI;
     |SI #309#3 = 99;  #518#19 = "OA";  |FINSI;

     |PUSHV 0501 2380;

     |BLANCO 1023 2380;
     |CUADRO 1023 2380;

     E_inf   = "";
     E_sup   = "10";

     |PINTA 1525, "Introduzca la Fecha de Emision del Modelo";
     fFechaEmi = ~;
     fFechaEmi = 1745 ? 1;

     eaAlfa  = fFechaEmi;  |HAZ FechaBonito;
     #518#31 = eaDiaB;
     #518#32 = eaMesB;
     #518#33 = eaAnyoB;

     |POPV;
|FPRC;

|PROCESO Boton6;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton4, "HIDE";
     |ESTADO_CONTROL nBoton5, "HIDE";
     |ESTADO_CONTROL nBoton6, "HIDE";
     |ESTADO_CONTROL nBoton7, "HIDE";

     |IMPRE 0;
     |SI FSalida = 0;
         |INFOR "m309ch01";
         |SI FSalida = 0;
             |HAZ CargaEmpresa;

             |MENAV "      Coloque Impreso 309 y pulse una tecla para continuar";

             |PRINT;
             |PIEINF;
             |FININF;

             #309#11 = "X";
             #309#12 = fFechaEmi;
         |FINSI;
         |FINIMP;
     |FINSI;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton4, "SHOW";
     |ESTADO_CONTROL nBoton5, "SHOW";
     |ESTADO_CONTROL nBoton6, "SHOW";
     |ESTADO_CONTROL nBoton7, "SHOW";
|FPRC;

|PROCESO Boton7;
     |PTEC  806;
|FPRC;

|PROCESO CargaComple;
     |ABRE #800;
     |PARA nCompl = #309#4 - 1;  |SI nCompl ] 0;  |HACIENDO nCompl = nCompl - 1;
           #800#0 = #309#0;
           #800#1 = #309#1;
           #800#2 = #309#2;
           #800#3 = #309#3;
           #800#4 = nCompl;
           #800#5 = #309#5;
           |LEE 040#800=;
           |SI FSalida = 0;
               |PARA nCampo1 = 19;  |SI nCampo1 [ 47;  |HACIENDO nCampo1 = nCampo1 + 1;
                     #309nCampo1 = #800nCampo1;
               |SIGUE;
               #309#70 = #800#71;
               |SAL;
           |FINSI;
     |SIGUE;
     |CIERRA #800;
|FPRC;

|PROCESO Tipo2;  |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
         |SI #309#13 = "X";  |O #309#16 = "X";
             |MENAV "     Modelo Remesado o Archivado. No se puede dar de baja.";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     nForma = 0 +. 1;
     |SI nForma < 0;  |ACABA;  |FINSI;

     |PUSHV 0501 2380;

     |BLANCO 1023 2380;
     |CUADRO 1023 2380;

     |SI #309#4 ! 0;
         |SI #309#9 = " ";
             |DBASE aBase;  |QBF aBase;
             aMas = aBase + "def/dsmod309.mas";
             |CARGA_DEF aMas, referen@;
             |SI FSalida = 0;
                 |HAZ CargaComple;
                 |DESCARGA_DEF #referen@;
             |FINSI;
         |FINSI;

         |SI #309#72 = "             ";
             |PINTA 1525, "Introduzca numero justificante declaracion anterior";

             E_inf   = "";
             E_sup   = "13";

             aJustif = "";
             aJustif = 1745 ? 1;
             #309#72 = aJustif;

             |BLANCO 1023 2380;
             |CUADRO 1023 2380;
         |FINSI;
     |FINSI;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Transmitente ", 1024, 1179, Boton1;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Situacion Tributaria", 1224, 1379, Boton2;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Hecho Imponible", 1424, 1579, Boton3;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Datos Tecnicos ", 1624, 1779, Boton4;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F6> Liquidacion ", 1824, 1979, Boton5;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F7> Emision Modelo ", 2024, 2179, Boton6;
     nBoton6 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Salir", 2224, 2279, Boton7;
     nBoton7 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "828";
     aF7 = &255 + "829";
     aF8 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  |HAZ Boton1;  |FINSI;
         |SI aTecla = aF3;  |HAZ Boton2;  |FINSI;
         |SI aTecla = aF4;  |HAZ Boton3;  |FINSI;
         |SI aTecla = aF5;  |HAZ Boton4;  |FINSI;
         |SI aTecla = aF6;  |HAZ Boton5;  |FINSI;
         |SI aTecla = aF7;  |HAZ Boton6;  |FINSI;
         |SI aTecla = aF8;  |SAL;         |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |FIN_CONTROL_WINDOWS nBoton7;

     |PULSATECLA;

     |POPV;

     aAlfa = #309#36;  |QBF aAlfa;
     |SI aAlfa ! "";  #309#6 = #309#36;  |FINSI;

     aAlfa = #309#40;  |QBF aAlfa;
     |SI aAlfa ! "";  #309#6 = #309#40;  |FINSI;

     aAlfa = #309#44;  |QBF aAlfa;
     |SI aAlfa ! "";  #309#6 = #309#44;  |FINSI;

     #309#7  = #999#3;
     #309#8  = #999#4;
     #309#9  = "X";
     #309#10 = ~;
     #309#18 = #309#71;

     |PINTA #309#6;
     |PINTA #309#9;
     |PINTA #309#71;
|FPRC;
