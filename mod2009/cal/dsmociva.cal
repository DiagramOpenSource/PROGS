|FICHEROS;
     dsmociva #0;
     dsmom007 #7;
     dsmom004 #4;
     dsmom005 #5;
     dsmom006 #6;
     dsmom008 #8;
     dsmom027 #27;
     dsmom028 #28;
     dsmom029 #29;
     dsmom047 #47;
     dsmom048 #148;

     dsmom080 #80;
     dsmom082 #82;

     dsmom103 #103;
     dsmom109 #109;

     dsmoc349 #349;
     dsmod300 #300;
     dsmod320 #320;
     dsmod330 #330;
     dsmod332 #332;
     dsmod370 #370;
     dsmod349 #350;
     dsmow002 #99;

     dsmocivp #165;

     :/contagen/def/canempre #400;
     :/contagen/def/camaniva #401;
     :/basica/def/agicen14 #402;

     dsmociva@ #999;
     dsmod300@ #1300;
|FIN;

|VARIABLES;
     nPer1   = 0;
     nPer2   = 0;
     swerror = 0;
     fDFecha = @;
     fHFecha = @;
     nCampo68      = 0;
     nCampo1       = 0;
     nCampo2       = 0;
     nCampo3       = 0;
     nCampo11      = 0;
     nCampo22      = 0;
     nCampo33      = 0;
     nValor1       = 0;
     nValor2       = 0;
     nAntIVA       = 0;
     nGrupo        = 0;
     nSubGrupo     = 0;
     nPeriodoMin   = 0;
     nEjerAnt      = 0;
     nSwAcum       = 0;
     nDesde        = 0;
     nHasta        = 0;
     nContador     = 0;
     nResult       = 0;
     nSwGraba      = 0;
     nAnyo         = 0;
     nPer          = 0;
     nTipo         = 0;
     nPeriodo      = 0;
     nDepar        = 0;
     nEjer         = 0;
     nModBucle     = 0;
     nPorCalculado = 0;
     nPon          = 0;
     nEl62         = 0;
     nHComple      = 0;


     aAlfa       = "";
     aAlfa1      = "";
     aTecla      = "";
     aBase       = "";
     aMas        = "";

     &EURODB     = 0;
     &enPregunta = 0;

    nSwOpe29     = 0;
    aPerNom      = "";
    nCuotaMas    = 0;
    nBaseMas     = 0;
    nDPer        = 0;
    nHPer        = 0;

    &eaExtension = "";
    &eaPrograma  = "";

    nNume1 = 0;
    nNume2 = 0;
    swpase = 0;
    nPro   = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO LeeCasilla;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = nGrupo;
     #0#7  = nSubGrupo;
     |LEE 040#0=;
     |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
|FPRC;

|| ///////////////// Procesos Grabacion de Modelos \\\\\\\\\\\\\\\\\\\\

|PROCESO EjerAnt;
      nEjerAnt = nEjerAnt + #103#5;
|FPRC;

|DEFBUCLE dsmom103;
     #103#1;
     ;
     enModelo, enEmpresa, 00, nAnyo, nPer;
     enModelo, enEmpresa, 99, nAnyo, nPer;
     ;
     NULL, EjerAnt;
|FIN;

|| ... Modificacion del a compensar anterior, si tiene complementarias
|PROCESO LeeComplem;
  |SI enModelo = 332; nEjerAnt = #332#67; |FINSI;
  |SI enModelo = 330; nEjerAnt = #330#67; |FINSI;
  |SI enModelo = 320; nEjerAnt = #320#65; |FINSI;
  |SI enModelo = 300; nEjerAnt = #300#63; |FINSI;
|FPRC;

|DEFBUCLE LeeCompl332;
  #332#1;
  ;
  enEmpresa, #4#1, #4#2, enModelo, 00, 00;
  enEmpresa, #4#1, #4#2, enModelo, 99, 00;
  ;
  NULL, LeeComplem;
|FIN;

|DEFBUCLE LeeCompl330;
  #330#1;
  ;
  enEmpresa, #4#1, #4#2, enModelo, 00, 00;
  enEmpresa, #4#1, #4#2, enModelo, 99, 00;
  ;
  NULL, LeeComplem;
|FIN;

|DEFBUCLE LeeCompl320;
  #320#1;
  ;
  enEmpresa, #4#1, #4#2, enModelo, 00, 00;
  enEmpresa, #4#1, #4#2, enModelo, 99, 00;
  ;
  NULL, LeeComplem;
|FIN;

|DEFBUCLE LeeCompl300;
  #300#1;
  ;
  enEmpresa, #4#1, #4#2, enModelo, 00, 00;
  enEmpresa, #4#1, #4#2, enModelo, 99, 00;
  ;
  NULL, LeeComplem;
|FIN;

|PROCESO RecogeAnter;
     nPeriodoMin = 1;
     |SI enModelo = 300; nPeriodoMin = 3;  |FINSI;

     |ABRE #4;
     #4#0 = enEmpresa;
     #4#3 = enModelo;
     #4#4 = enComplem;
     |SI enPeriodo = nPeriodoMin;
         nAnyo = enEjer - 1;
         nPer  = 12;
     |SINO;
         nAnyo = enEjer;
         nPer  = enPeriodo - nPeriodoMin;
     |FINSI;

     #4#0 = enEmpresa;
     #4#1 = nAnyo;
     #4#2 = nPer;
     #4#3 = enModelo;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;

     |CIERRA #4;

     nEjerAnt = 0;
     |SI enModelo = 300;
         |CIERRA #300;
         |BUCLE LeeCompl300;
         |ABRE #300;
    |FINSI;

     |SI enModelo = 320;
         |CIERRA #320;
         |BUCLE LeeCompl320;
         |ABRE #320;
    |FINSI;

    |SI enModelo = 330;
         |CIERRA #330;
         |BUCLE LeeCompl330;
         |ABRE #330;
    |FINSI;

    |SI enModelo = 332;
         |CIERRA #332;
         |BUCLE LeeCompl332;
         |ABRE #332;
     |FINSI;

    |SI nEjerAnt = 0;
         |BUCLE dsmom103;
     |FINSI;

     |ABRE #47;
     #47#0 = enEmpresa;
     #47#1 = enEjer;
     #47#2 = enPeriodo;
     #47#3 = enModelo;
     #47#4 = enComplem;
     #47#5 = 0;
     |LEE 040#47=;
     |SI FSalida ! 0;  |DDEFECTO #47;  |FINSI;
     |CIERRA #47;

     |ABRE #28;
     #28#0 = enEmpresa;
     #28#1 = enEjer;
     #28#2 = enPeriodo;
     #28#3 = enModelo;
     #28#4 = enComplem;
     #28#5 = 0;
     |LEE 040#28=;
     |SI FSalida ! 0;  |DDEFECTO #28;  |FINSI;
     |CIERRA #28;

     |SI #28#7 = "N";  |ACABA;  |FINSI;

     nEjerAnt = nEjerAnt - #28#6;
     |SI nEjerAnt < 0;  nEjerAnt = 0;  |FINSI;
|FPRC;

|| ///////// Modelo 300 \\\\\\\\\\\\

|PROCESO GrabaDevengado300;
     |SI #0nCampo3 = 0;  |ACABA;  |FINSI;
     nSwAcum       = 0;

     |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
           nCampo11 = nCampo33 - 2;
           nCampo22 = nCampo33 - 1;
           |SI #300nCampo22 = #0nCampo2;
               #300nCampo11 = #300nCampo11 + #0nCampo1;
               #300nCampo33 = #300nCampo33 + #0nCampo3;
               nSwAcum = 1;
               |SAL;
            |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
               nCampo11 = nCampo33 - 2;
               nCampo22 = nCampo33 - 1;
               |SI #300nCampo22 = 0;
                   #300nCampo11 = #0nCampo1;
                   #300nCampo22 = #0nCampo2;
                   #300nCampo33 = #0nCampo3;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         nCampo11     = nHasta - 2;
         nCampo22     = nHasta - 1;
         nCampo33     = nHasta;

         #300nCampo11 = #300nCampo11 + #0nCampo1;
         #300nCampo22 = -1;
         #300nCampo33 = #300nCampo33 + #0nCampo3;
     |FINSI;
|FPRC;

|PROCESO GrabaDeducible300;

     |SI nDesde = 34; |Y nHasta = -2;   ||inversion
         nHasta = nDesde + 1;
         #300nDesde = #300nDesde - (#0#14 + #0#17 + #0#20 + #0#23);
         #300nHasta = #300nHasta - (#0#16 + #0#19 + #0#22 + #0#25);
         |ACABA;
     |FINSI;

     |SI nHasta ! -1;
         nHasta = nDesde + 1;
     |FINSI;


     |SI nDesde ! 46;  |Y nDesde ! 48;
         |SI nHasta ! -1;
             #300nDesde = #300nDesde + ((#0#14 + #0#17 + #0#20 + #0#23) % nProrrata) + nBaseMas;
             #300nHasta = #300nHasta + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |SINO;
             #300nDesde = #300nDesde + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |FINSI;
     |SINO;
         #300nDesde = #300nDesde + (#0#14 + #0#17 + #0#20 + #0#23);
         #300nHasta = #300nHasta + (#0#16 + #0#19 + #0#22 + #0#25);
     |FINSI;
|FPRC;

|PROCESO Graba300;
     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 1;  |Y #0#7 [ 4;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 6;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 7;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 8;   nDesde =  8;  nHasta = 14;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 5;   nDesde = 26;  nHasta = 32;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 10;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 11;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 12;  nDesde = 17;  nHasta = 23;  |FINSI;

     |SI nDesde ! 0;
         |PARA nCampo1 = 14;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;  |O #0nCampo3 ! 0;
                   |HAZ GrabaDevengado300;
               |FINSI;
         |SIGUE;
     |FINSI;

     |PARA nCampo1 = 7;  |SI nCampo1 [ 31;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #300nCampo1 = -1;  #300nCampo1 = 0;  |FINSI;
     |SIGUE;

     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 2;  |Y #0#7 = 1;   nDesde = 34;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 2;   nDesde = 36;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 3;   nDesde = 40;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 4;   nDesde = 42;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 5;   nDesde = 46;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 6;   nDesde = 48;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 7;   nDesde = 52;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 9;   nDesde = 54;  nHasta = -1;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 11;  nDesde = 34;  nHasta = -2;  |FINSI;

     |SI #0#6 = 2;  |Y #0#7 = 10;
         |SI #0#1 ] 2008;
             nDesde = 68;  nHasta = -1;
         |FINSI;
     |FINSI;

     |SI nDesde ! 0;
         |HAZ GrabaDeducible300;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 9;
         #300#60 = #300#60 + #0#12;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 1;
         #300#57   = #300#57 + #0#12;
         nContador = nContador + 1;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 2;
         #300#61   = #300#61 + #0#12;
     |FINSI;
|FPRC;

|| ///////// Modelo 320 \\\\\\\\\\\\

|PROCESO GrabaDevengado320;
     |SI #0nCampo3 = 0;  |ACABA;  |FINSI;
     nSwAcum       = 0;

     |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
           nCampo11 = nCampo33 - 2;
           nCampo22 = nCampo33 - 1;
           |SI #320nCampo22 = #0nCampo2;
               #320nCampo11 = #320nCampo11 + #0nCampo1;
               #320nCampo33 = #320nCampo33 + #0nCampo3;
               nSwAcum = 1;
               |SAL;
            |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
               nCampo11 = nCampo33 - 2;
               nCampo22 = nCampo33 - 1;
               |SI #320nCampo22 = 0;
                   #320nCampo11 = #0nCampo1;
                   #320nCampo22 = #0nCampo2;
                   #320nCampo33 = #0nCampo3;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         nCampo11     = nHasta - 2;
         nCampo22     = nHasta - 1;
         nCampo33     = nHasta;

         #320nCampo11 = #320nCampo11 + #0nCampo1;
         #320nCampo22 = -1;
         #320nCampo33 = #320nCampo33 + #0nCampo3;
     |FINSI;
|FPRC;

|PROCESO GrabaDeducible320;
     |SI nDesde = 34; |Y nHasta = -2;   ||inversion
         nHasta = nDesde + 1;
         #320nDesde = #320nDesde - (#0#14 + #0#17 + #0#20 + #0#23);
         #320nHasta = #320nHasta - (#0#16 + #0#19 + #0#22 + #0#25);
         |ACABA;
     |FINSI;

     |SI nHasta ! -1;
         nHasta = nDesde + 1;
     |FINSI;

     |SI nDesde ! 46;  |Y nDesde ! 48;
         |SI nHasta ! -1;
             #320nDesde = #320nDesde + ((#0#14 + #0#17 + #0#20 + #0#23) % nProrrata) + nBaseMas;
             #320nHasta = #320nHasta + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |SINO;
             #320nDesde = #320nDesde + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |FINSI;
     |SINO;
         #320nDesde = #320nDesde + (#0#14 + #0#17 + #0#20 + #0#23);
         #320nHasta = #320nHasta + (#0#16 + #0#19 + #0#22 + #0#25);
     |FINSI;
|FPRC;

|PROCESO Graba320;
     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 1;  |Y #0#7 [ 4;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 6;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 7;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 8;   nDesde =  8;  nHasta = 14;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 5;   nDesde = 26;  nHasta = 32;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 10;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 11;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 12;  nDesde = 17;  nHasta = 23;  |FINSI;

     |SI nDesde ! 0;
         |PARA nCampo1 = 14;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;  |O #0nCampo3 ! 0;
                   |HAZ GrabaDevengado320;
               |FINSI;
         |SIGUE;
     |FINSI;

     |PARA nCampo1 = 7;  |SI nCampo1 [ 31;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #320nCampo1 = -1;  #320nCampo1 = 0;  |FINSI;
     |SIGUE;

     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 2;  |Y #0#7 = 1;   nDesde = 34;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 2;   nDesde = 36;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 3;   nDesde = 40;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 4;   nDesde = 42;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 5;   nDesde = 46;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 6;   nDesde = 48;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 7;   nDesde = 52;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 9;   nDesde = 54;  nHasta = -1;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 11;  nDesde = 34;  nHasta = -2;  |FINSI;

     |SI nDesde ! 0;
         |HAZ GrabaDeducible320;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 9;
         #320#60 = #320#60 + #0#12;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 10;
         #320#61 = #320#61 + #0#12;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 11;
         #320#62 = #320#62 + #0#12;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 1;
         #320#57   = #320#57 + #0#12;
         nContador = nContador + 1;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 2;
         #320#63   = #320#63 + #0#12;
     |FINSI;
|FPRC;

|| ///////// Modelo 330 \\\\\\\\\\\\

|PROCESO GrabaDevengado330;
     |SI #0nCampo3 = 0;  |ACABA;  |FINSI;
     nSwAcum       = 0;

     |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
           nCampo11 = nCampo33 - 2;
           nCampo22 = nCampo33 - 1;
           |SI #330nCampo22 = #0nCampo2;
               #330nCampo11 = #330nCampo11 + #0nCampo1;
               #330nCampo33 = #330nCampo33 + #0nCampo3;
               nSwAcum = 1;
               |SAL;
            |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
               nCampo11 = nCampo33 - 2;
               nCampo22 = nCampo33 - 1;
               |SI #330nCampo22 = 0;
                   #330nCampo11 = #0nCampo1;
                   #330nCampo22 = #0nCampo2;
                   #330nCampo33 = #0nCampo3;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         nCampo11     = nHasta - 2;
         nCampo22     = nHasta - 1;
         nCampo33     = nHasta;

         #330nCampo11 = #330nCampo11 + #0nCampo1;
         #330nCampo22 = -1;
         #330nCampo33 = #330nCampo33 + #0nCampo3;
     |FINSI;
|FPRC;

|PROCESO GrabaDeducible330;
     |SI nDesde = 34; |Y nHasta = -2;   ||inversion
         nHasta = nDesde + 1;
         #330nDesde = #330nDesde - (#0#14 + #0#17 + #0#20 + #0#23);
         #330nHasta = #330nHasta - (#0#16 + #0#19 + #0#22 + #0#25);
         |ACABA;
     |FINSI;

     |SI nHasta ! -1;
         nHasta = nDesde + 1;
     |FINSI;

     |SI nDesde ! 46;  |Y nDesde ! 48;
         |SI nHasta ! -1;
             #330nDesde = #330nDesde + ((#0#14 + #0#17 + #0#20 + #0#23) % nProrrata) + nBaseMas;
             #330nHasta = #330nHasta + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |SINO;
             #330nDesde = #330nDesde + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |FINSI;
     |SINO;
         #330nDesde = #330nDesde + (#0#14 + #0#17 + #0#20 + #0#23);
         #330nHasta = #330nHasta + (#0#16 + #0#19 + #0#22 + #0#25);
     |FINSI;
|FPRC;

|PROCESO Graba330;
     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 1;  |Y #0#7 [ 4;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 6;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 7;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 8;   nDesde =  8;  nHasta = 14;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 5;   nDesde = 26;  nHasta = 32;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 10;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 11;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 12;  nDesde = 17;  nHasta = 23;  |FINSI;

     |SI nDesde ! 0;
         |PARA nCampo1 = 14;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;  |O #0nCampo3 ! 0;
                   |HAZ GrabaDevengado330;
               |FINSI;
         |SIGUE;
     |FINSI;

     |PARA nCampo1 = 7;  |SI nCampo1 [ 31;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #330nCampo1 = -1;  #330nCampo1 = 0;  |FINSI;
     |SIGUE;

     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 2;  |Y #0#7 = 1;   nDesde = 34;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 2;   nDesde = 36;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 3;   nDesde = 40;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 4;   nDesde = 42;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 5;   nDesde = 46;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 6;   nDesde = 48;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 7;   nDesde = 52;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 9;   nDesde = 54;  nHasta = -1;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 11;  nDesde = 34;  nHasta = -2;  |FINSI;

     |SI nDesde ! 0;
         |HAZ GrabaDeducible330;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 9;
         #330#60 = #330#60 + #0#12;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 10;
         #330#61 = #330#61 + #0#12;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 11;
         #330#62 = #330#62 + #0#12;
     |FINSI;

     |SI #0#6 = 4;  |Y #0#7 = 6;
         #330#62 = #330#62 + #0#12;
     |FINSI;

     |SI #0#6 = 4;  |Y #0#7 = 5;
         #330#63 = #330#63 + #0#12;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 1;
         #330#57   = #330#57 + #0#12;
         nContador = nContador + 1;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 2;
         #330#65   = #330#65 + #0#12;
     |FINSI;
|FPRC;

|| ///////// Modelo 332 \\\\\\\\\\\\

|PROCESO GrabaDevengado332;
     |SI #0nCampo3 = 0;  |ACABA;  |FINSI;
     nSwAcum       = 0;

     |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
           nCampo11 = nCampo33 - 2;
           nCampo22 = nCampo33 - 1;
           |SI #332nCampo22 = #0nCampo2;
               #332nCampo11 = #332nCampo11 + #0nCampo1;
               #332nCampo33 = #332nCampo33 + #0nCampo3;
               nSwAcum = 1;
               |SAL;
            |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
               nCampo11 = nCampo33 - 2;
               nCampo22 = nCampo33 - 1;
               |SI #332nCampo22 = 0;
                   #332nCampo11 = #0nCampo1;
                   #332nCampo22 = #0nCampo2;
                   #332nCampo33 = #0nCampo3;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         nCampo11     = nHasta - 2;
         nCampo22     = nHasta - 1;
         nCampo33     = nHasta;

         #332nCampo11 = #332nCampo11 + #0nCampo1;
         #332nCampo22 = -1;
         #332nCampo33 = #332nCampo33 + #0nCampo3;
     |FINSI;
|FPRC;

|PROCESO GrabaDeducible332;
     |SI nDesde = 34; |Y nHasta = -2;   ||inversion
         nHasta = nDesde + 1;
         #332nDesde = #332nDesde - (#0#14 + #0#17 + #0#20 + #0#23);
         #332nHasta = #332nHasta - (#0#16 + #0#19 + #0#22 + #0#25);
         |ACABA;
     |FINSI;

     |SI nHasta ! -1;
         nHasta = nDesde + 1;
     |FINSI;

     |SI nDesde ! 46;  |Y nDesde ! 48;
         |SI nHasta ! -1;
             #332nDesde = #332nDesde + ((#0#14 + #0#17 + #0#20 + #0#23) % nProrrata) + nBaseMas;
             #332nHasta = #332nHasta + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |SINO;
             #332nDesde = #332nDesde + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |FINSI;
     |SINO;
         #332nDesde = #332nDesde + (#0#14 + #0#17 + #0#20 + #0#23);
         #332nHasta = #332nHasta + (#0#16 + #0#19 + #0#22 + #0#25);
     |FINSI;
|FPRC;

|PROCESO Graba332;
     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 1;  |Y #0#7 [ 4;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 6;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 7;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 8;   nDesde =  8;  nHasta = 14;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 5;   nDesde = 26;  nHasta = 32;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 10;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 11;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 12;  nDesde = 17;  nHasta = 23;  |FINSI;

     |SI nDesde ! 0;
         |PARA nCampo1 = 14;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;  |O #0nCampo3 ! 0;
                   |HAZ GrabaDevengado332;
               |FINSI;
         |SIGUE;
     |FINSI;

     |PARA nCampo1 = 7;  |SI nCampo1 [ 31;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #332nCampo1 = -1;  #332nCampo1 = 0;  |FINSI;
     |SIGUE;

     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 2;  |Y #0#7 = 1;   nDesde = 34;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 2;   nDesde = 36;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 3;   nDesde = 40;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 4;   nDesde = 42;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 5;   nDesde = 46;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 6;   nDesde = 48;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 7;   nDesde = 52;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 9;   nDesde = 54;  nHasta = -1;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 11;  nDesde = 34;  nHasta = -2;  |FINSI;

     |SI nDesde ! 0;
         |HAZ GrabaDeducible332;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 9;
         #332#60 = #332#60 + #0#12;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 10;
         #332#61 = #332#61 + #0#12;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 11;
         #332#62 = #332#62 + #0#12;
     |FINSI;

     |SI #0#6 = 4;  |Y #0#7 = 6;
         #332#62 = #332#62 + #0#12;
     |FINSI;

     |SI #0#6 = 4;  |Y #0#7 = 5;
         #332#63 = #332#63 + #0#12;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 1;
         #332#57   = #332#57 + #0#12;
         nContador = nContador + 1;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 2;
         #332#65   = #332#65 + #0#12;
     |FINSI;
|FPRC;

|PROCESO GrabaModelo;
     |SI #0#6 = 5;  |Y #0#7 = 6;  |Y #0#12 ! 0;
         nEjerAnt = #0#12;
     |FINSI;

     enImpIvaSop = 0;
     enImpIvaSub = 0;
     enIvaSopDed = 0;

     nBaseMas  = 0;
     nCuotaMas = 0;

     |SI #0#6 = 2;
         |SI #0#7 ! 5; |Y #0#7 ! 6;
             |HAZ LeeRestoPror;

             |SI #0#1 [ 2007;
                 |SI #0#7 ! 10; |Y #0#7 ! 11; |Y #0#7 ! 12;
                     enIvaSopDed = (#0#16 + #0#19 + #0#22 + #0#25) % nProrrata + nCuotaMas;
                 |FINSI;

                 |SI #0#7 = 10;
                    enImpIvaSop = #0#13 + nCuotaMas;
                 |FINSI;

                 |SI #0#7 = 11;
                     enImpIvaSub = #0#13;
                     enIvaSopDed = - (#0#16 + #0#19 + #0#22 + #0#25);
                 |FINSI;
             |FINSI;

             |SI #0#1 ] 2008;
                 |SI #0#7 ! 11; |Y #0#7 ! 12;
                     enIvaSopDed = (#0#16 + #0#19 + #0#22 + #0#25) % nProrrata + nCuotaMas;
                     enImpIvaSop = #0#13 + nCuotaMas;
                 |FINSI;

                 |SI #0#7 = 11;
                     enImpIvaSub = #0#13;
                     enIvaSopDed = - (#0#16 + #0#19 + #0#22 + #0#25);
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI #0#7 = 12; |ACABA; |FINSI;
     |FINSI;

     |SI #0#12 = 0;  |Y #0#13 = 0;  |Y nCuotaMas = 0; |ACABA;  |FINSI;

     |SI enModelo = 300;   |HAZ Graba300;   |FINSI;
     |SI enModelo = 320;   |HAZ Graba320;   |FINSI;
     |SI enModelo = 330;   |HAZ Graba330;   |FINSI;
     |SI enModelo = 332;   |HAZ Graba332;   |FINSI;

     nSwGraba = 1;
     |SI enImpIvaSop ! 0; |O enImpIvaSub ! 0; |O enIvaSopDed ! 0; |O swpase = 0;
         |SI enEjer < enEjerPro; |HAZ Grabarm029; |FINSI;
         swpase = 1;
     |FINSI;
|FPRC;

|DEFBUCLE dsmociva;
     #0#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 01, 0,  0;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 99, 9, 99;
     be;
     NULL, GrabaModelo;
|FIN;

|PROCESO LeeRestoPror;

 |ABRE #165;
 #165#0 = #0#0;
 #165#1 = #0#1;
 #165#2 = #0#2;
 #165#3 = #0#3;
 #165#4 = #0#4;
 #165#5 = #0#5;
 #165#6 = #0#6;
 #165#7 = #0#7;
 |LEE 001#165=;
 |SI FSalida = 0;
     nBaseMas  = #165#10 + #165#13 + #165#16 + #165#19;
     nCuotaMas = #165#12 + #165#15 + #165#18 + #165#21;
 |FINSI;
 |CIERRA #165;
|FPRC;

|PROCESO dsmod300Otros;
     #300#70 = #300#70 + #1300#65;
|FPRC;

|DEFBUCLE dsmod300Otros;
     #1300#1006;
     ;
     #300#0, #300#1, #300#2, #300#3,        0, #300#5;
     #300#0, #300#1, #300#2, #300#3, nHComple, #300#5;
     ;
     NULL, dsmod300Otros;
|FIN;

|PROCESO CapturaOtros300;
     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsmod300.mas";
     |CARGA_DEF aMas, dsmod300@;

     nHComple = #300#4 - 1;
     #300#70  = 0;

     |BUCLE dsmod300Otros;

     |DESCARGA_DEF #dsmod300@;
|FPRC;

|PROCESO Totales300;
     #300#67 = eaProrrat;
     #300#66 = nPro;

     #300#33 = #300#8  + #300#11 + #300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32;

|| aplicar nueva Prorrata
     |SI enEjer ] enEjerPro;
          |SI eaDesg109 = "N";
              #300#35 = #300#35 - enImpProrrata;
          |SINO;
              #300#35 = #300#35 - enImpProrrat1;
              #300#37 = #300#37 - enImpProrrat2;
              #300#41 = #300#41 - enImpProrrat3;
              #300#43 = #300#43 - enImpProrrat4;
              #300#47 = #300#47 - enImpProrrat5;
              #300#49 = #300#49 - enImpProrrat6;
              #300#53 = #300#53 - enImpProrrat7;
          |FINSI;
     |FINSI;
|| ....
|| Regularizacion Manual
     #300#35 = #300#35 - #47#6;
     #300#37 = #300#37 - #47#7;
     #300#41 = #300#41 - #47#8;
     #300#43 = #300#43 - #47#9;
     #300#47 = #300#47 - #47#10;
     #300#49 = #300#49 - #47#11;
     #300#53 = #300#53 - #47#12;
|| ....

     #300#38 = #300#34 + #300#36;
     #300#39 = #300#35 + #300#37;
     #300#44 = #300#40 + #300#42;
     #300#45 = #300#41 + #300#43;
     #300#50 = #300#46 + #300#48;
     #300#51 = #300#47 + #300#49;
     #300#55 = #300#39 + #300#45 + #300#51 + #300#53 + #300#54 + #300#68;

     #300#57 = #300#57 / nContador;
     #300#56 = #300#33 - #300#55;
     #300#58 = #300#56 % #300#57;
     #300#62 = #300#58 - #300#59 + #300#61;

     |SI #300#1 ] 2008;
         #300#69 = #300#58 - #300#59 + #300#61;

         |SI #300#4 > 0;
             |HAZ CapturaOtros300;
             nEl62 = #300#69 - #300#70;
             |SI nEl62 < 0;
                 |MENAV "    RECUERDE. Si el resultado NO es a INGRESAR, NO procede declaracion complementaria";
             |FINSI;
         |FINSI;

         #300#62 = #300#69 - #300#70;
     |FINSI;

     |SI #300#62 > 0;
         #300#65 = #300#62;
         #300#63 = 0;
         #300#64 = 0;
     |SINO;
         |SI #300#2 = 12;
             |HAZ UltimoPeriodo;
             |SI eaUltimoPer = "COMPENSAR";
                 #300#63 = -#300#62;
                 #300#64 = 0;
                 #300#65 = 0;
             |SINO;
                 #300#64 = -#300#62;
                 #300#63 = 0;
                 #300#65 = 0;
             |FINSI;
         |SINO;
             #300#63 = -#300#62;
             #300#64 = 0;
             #300#65 = 0;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Modelo300;
     |ABRE #300;

     #300#0 = enEmpresa;
     #300#1 = enEjer;
     #300#2 = enPeriodo;
     #300#3 = enModelo;
     #300#4 = enComplem;
     #300#5 = 0;
     |LEE 101#300=;
     |SI FSalida ! 0;
         |HAZ RecogeAnter;
         |DDEFECTO #300;
         #300#0 = enEmpresa;
         #300#1 = enEjer;
         #300#2 = enPeriodo;
         #300#3 = enModelo;
         #300#4 = enComplem;
         #300#5 = 0;

         #300#59 = nEjerAnt;
         #300#57 = 0;
         |GRABA 020#300b;
     |FINSI;

     nEjerAnt  = #300#59;
     nContador = 0;
     nSwGraba  = 0;

     |BUCLE dsmociva;

     |SI nSwGraba = 1;
         #300#59 = nEjerAnt;
         |HAZ Totales300;
         enIvaSopDed = #300#55;
         |GRABA 020#300a;
     |SINO;
         #300#55 = 0;
         |BORRA 020#300a;
     |FINSI;

     |LIBERA #300;
     |CIERRA #300;
|FPRC;

|PROCESO Totales320;
     #320#68 = nPro;
     #320#69 = eaProrrat;

     #320#33 = #320#8  + #320#11 + #320#14 + #320#17 + #320#20 + #320#23 + #320#26 + #320#29 + #320#32;

     |SI enEjer ] enEjerPro;
          |SI eaDesg109 = "N";
              #320#35 = #320#35 - enImpProrrata;
          |SINO;
              #320#35 = #320#35 - enImpProrrat1;
              #320#37 = #320#37 - enImpProrrat2;
              #320#41 = #320#41 - enImpProrrat3;
              #320#43 = #320#43 - enImpProrrat4;
              #320#47 = #320#47 - enImpProrrat5;
              #320#49 = #320#49 - enImpProrrat6;
              #320#53 = #320#53 - enImpProrrat7;
          |FINSI;
     |FINSI;

|| Regularizacion Manual
     #320#35 = #320#35 - #47#6;
     #320#37 = #320#37 - #47#7;
     #320#41 = #320#41 - #47#8;
     #320#43 = #320#43 - #47#9;
     #320#47 = #320#47 - #47#10;
     #320#49 = #320#49 - #47#11;
     #320#53 = #320#53 - #47#12;
|| ....
     #320#38 = #320#34 + #320#36;
     #320#39 = #320#35 + #320#37;
     #320#44 = #320#40 + #320#42;
     #320#45 = #320#41 + #320#43;
     #320#50 = #320#46 + #320#48;
     #320#51 = #320#47 + #320#49;
     #320#55 = #320#39 + #320#45 + #320#51 + #320#53 + #320#54;

     #320#56 = #320#33 - #320#55;
     #320#57 = #320#57 / nContador;
     #320#58 = #320#56 % #320#57;
     #320#64 = #320#58 - #320#59 + #320#63;

     |SI #320#64 > 0;
         #320#67 = #320#64;
         #320#65 = 0;
         #320#66 = 0;
     |SINO;
         |SI #320#2 = 12;
             |HAZ UltimoPeriodo;
             |SI eaUltimoPer = "COMPENSAR";
                 #320#65 = -#320#64;
                 #320#66 = 0;
                 #320#67 = 0;
             |SINO;
                 #320#66 = -#320#64;
                 #320#65 = 0;
                 #320#67 = 0;
             |FINSI;
         |SINO;
             #320#65 = -#320#64;
             #320#66 = 0;
             #320#67 = 0;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Modelo320;
     |ABRE #320;

     #320#0 = enEmpresa;
     #320#1 = enEjer;
     #320#2 = enPeriodo;
     #320#3 = enModelo;
     #320#4 = enComplem;
     #320#5 = 0;
     |LEE 101#320=;
     |SI FSalida ! 0;
         |HAZ RecogeAnter;
         |DDEFECTO #320;
         #320#0 = enEmpresa;
         #320#1 = enEjer;
         #320#2 = enPeriodo;
         #320#3 = enModelo;
         #320#4 = enComplem;
         #320#5 = 0;

         #320#57 = 0;
         #320#59 = nEjerAnt;

         |GRABA 020#320b;
     |FINSI;

     nEjerAnt  = #320#59;
     nContador = 0;
     nSwGraba  = 0;
     |BUCLE dsmociva;

     |SI nSwGraba = 1;
         #320#59 = nEjerAnt;
         |HAZ Totales320;
         enIvaSopDed = #320#55;
         |GRABA 020#320a;
     |SINO;
         |BORRA 020#320a;
     |FINSI;

     |LIBERA #320;
     |CIERRA #320;
|FPRC;

|PROCESO Totales330;
     #330#70 = nPro;
     #330#71 = eaProrrat;

     #330#33 = #330#8  + #330#11 + #330#14 + #330#17 + #330#20 + #330#23 + #330#26 + #330#29 + #330#32;

|| aplicar nueva Prorrata
     |SI enEjer ] enEjerPro;
          |SI eaDesg109 = "N";
              #330#35 = #330#35 - enImpProrrata;
          |SINO;
              #330#35 = #330#35 - enImpProrrat1;
              #330#37 = #330#37 - enImpProrrat2;
              #330#41 = #330#41 - enImpProrrat3;
              #330#43 = #330#43 - enImpProrrat4;
              #330#47 = #330#47 - enImpProrrat5;
              #330#49 = #330#49 - enImpProrrat6;
              #330#53 = #330#53 - enImpProrrat7;
          |FINSI;
     |FINSI;
|| ....
|| Regularizacion Manual
     #330#35 = #330#35 - #47#6;
     #330#37 = #330#37 - #47#7;
     #330#41 = #330#41 - #47#8;
     #330#43 = #330#43 - #47#9;
     #330#47 = #330#47 - #47#10;
     #330#49 = #330#49 - #47#11;
     #330#53 = #330#53 - #47#12;
|| ....

     #330#38 = #330#34 + #330#36;
     #330#39 = #330#35 + #330#37;
     #330#44 = #330#40 + #330#42;
     #330#45 = #330#41 + #330#43;
     #330#50 = #330#46 + #330#48;
     #330#51 = #330#47 + #330#49;
     #330#55 = #330#39 + #330#45 + #330#51 + #330#53 + #330#54;

     #330#56 = #330#33 - #330#55;
     #330#57 = #330#57 / nContador;
     #330#58 = #330#56 % #330#57;
     #330#66 = #330#58 - #330#59 + #330#65;

     |SI #330#66 > 0;
         #330#69 = #330#66;
         #330#64 = 0;
         #330#67 = 0;
         #330#68 = 0;
     |SINO;
         |SI #330#2 = 12;
             nResult = -#330#66;
             #330#64 = (#330#60 + #330#61 + #330#62 + #330#63) % 16;

             |HAZ UltimoPeriodo;
             |SI eaUltimoPer = "COMPENSAR";
                 #330#67 = -#330#66;
                 #330#68 = 0;
                 #330#69 = 0;
             |SINO;
                 #330#68 = -#330#66;
                 #330#67 = 0;
                 #330#69 = 0;
             |FINSI;

             |ACABA;
         |FINSI;

         nResult = -#330#66;
         #330#64 = (#330#60 + #330#61 + #330#62 + #330#63) % 16;
         |SI #330#64 < 0;         #330#64 = 0;         |FINSI;
         |SI #330#68 = 0;         #330#68 =  #330#64;  |FINSI;
         |SI #330#68 > #330#64;   #330#68 =  #330#64;  |FINSI;
         |SI #330#68 > nResult;   #330#68 =  nResult;  |FINSI;

         #330#67 = nResult - #330#68;

         |SI #330#64 = 0;  |ACABA;  |FINSI;

         |SI enPregunta = 1;
             #330#68 = enDevolver;
             #330#67 = nResult - #330#68;
             |ACABA;
         |FINSI;

         |PUSHV 0501 2380;
         |CUADRO 1220 1752;
         |BLANCO 1321 1651;

         |ATRI S;
         |PINTA 1321, "Resultado ........: ";
         |PINTA 1421, "Maximo a Devolver : ";
         |PINTA 1521, "A Devolver .......: ";
         |PINTA 1621, "A Compensar ......: ";
         |ATRI s;

         |PINTA 1341, #330#66;
         |PINTA 1441, #330#64;
         |PINTA 1541, #330#68;
         |PINTA 1641, #330#67;

         E_inf = "0.?EURO";
         E_sup = "99999999999";

         nCampo68 = #330#68;

         |ET Campo68_330;
             nCampo68 = 1541 ? 1;
             |SI nCampo68 > #330#64;
                 |MENAV "     Maximo a Devolver superado.";
                 nCampo68 = #330#64;
                 |VETE Campo68_330;
             |FINSI;

         #330#68 = nCampo68;
         #330#67 = nResult - #330#68;
         |PINTA 1641, #330#67;

         |POPV;
     |FINSI;
|FPRC;

|PROCESO Modelo330;
     |ABRE #330;

     #330#0 = enEmpresa;
     #330#1 = enEjer;
     #330#2 = enPeriodo;
     #330#3 = enModelo;
     #330#4 = enComplem;
     #330#5 = 0;
     |LEE 101#330=;
     |SI FSalida ! 0;
         |HAZ RecogeAnter;

         |DDEFECTO #330;
         #330#0 = enEmpresa;
         #330#1 = enEjer;
         #330#2 = enPeriodo;
         #330#3 = enModelo;
         #330#4 = enComplem;
         #330#5 = 0;

         #330#57 = 0;
         #330#59 = nEjerAnt;

         |GRABA 020#330b;
     |FINSI;

     nEjerAnt  = #330#59;
     nContador = 0;
     nSwGraba  = 0;
     |BUCLE dsmociva;

     |SI nSwGraba = 1;
         #330#59 = nEjerAnt;
         |HAZ Totales330;
         enIvaSopDed = #330#55;
         |GRABA 020#330a;
     |SINO;
         |BORRA 020#330a;
     |FINSI;
     |LIBERA #330;
     |CIERRA #330;
|FPRC;

|PROCESO Totales332;
     #332#70 = nPro;
     #332#71 = eaProrrat;

     #332#33 = #332#8  + #332#11 + #332#14 + #332#17 + #332#20 + #332#23 + #332#26 + #332#29 + #332#32;

|| aplicar nueva Prorrata
     |SI enEjer ] enEjerPro;
          |SI eaDesg109 = "N";
              #332#35 = #332#35 - enImpProrrata;
          |SINO;
              #332#35 = #332#35 - enImpProrrat1;
              #332#37 = #332#37 - enImpProrrat2;
              #332#41 = #332#41 - enImpProrrat3;
              #332#43 = #332#43 - enImpProrrat4;
              #332#47 = #332#47 - enImpProrrat5;
              #332#49 = #332#49 - enImpProrrat6;
              #332#53 = #332#53 - enImpProrrat7;
          |FINSI;
     |FINSI;
|| ...
|| Regularizacion Manual
     #332#35 = #332#35 - #47#6;
     #332#37 = #332#37 - #47#7;
     #332#41 = #332#41 - #47#8;
     #332#43 = #332#43 - #47#9;
     #332#47 = #332#47 - #47#10;
     #332#49 = #332#49 - #47#11;
     #332#53 = #332#53 - #47#12;
|| ....
     #332#38 = #332#34 + #332#36;
     #332#39 = #332#35 + #332#37;
     #332#44 = #332#40 + #332#42;
     #332#45 = #332#41 + #332#43;
     #332#50 = #332#46 + #332#48;
     #332#51 = #332#47 + #332#49;
     #332#55 = #332#39 + #332#45 + #332#51 + #332#53 + #332#54;

     #332#56 = #332#33 - #332#55;
     #332#57 = #332#57 / nContador;
     #332#58 = #332#56 % #332#57;
     #332#66 = #332#58 - #332#59 + #332#65;

     |SI #332#66 > 0;
         #332#69 = #332#66;
         #332#64 = 0;
         #332#67 = 0;
         #332#68 = 0;
     |SINO;
         |SI #332#2 = 12;
             nResult = -#332#66;
             #332#64 = (#332#60 + #332#61 + #332#62 + #332#63) % 16;

             |HAZ UltimoPeriodo;
             |SI eaUltimoPer = "COMPENSAR";
                 #332#67 = -#332#66;
                 #332#68 = 0;
                 #332#69 = 0;
             |SINO;
                 #332#68 = -#332#66;
                 #332#67 = 0;
                 #332#69 = 0;
             |FINSI;

             |ACABA;
         |FINSI;

         nResult = -#332#66;
         #332#64 = (#332#60 + #332#61 + #332#62 + #332#63) % 16;
         |SI #332#64 < 0;         #332#64 = 0;         |FINSI;
         |SI #332#68 = 0;         #332#68 =  #332#64;  |FINSI;
         |SI #332#68 > #332#64;   #332#68 =  #332#64;  |FINSI;
         |SI #332#68 > nResult;   #332#68 =  nResult;  |FINSI;

         #332#67 = nResult - #332#68;

         |SI #332#64 = 0;  |ACABA;  |FINSI;

         |SI enPregunta = 1;
             #332#68 = enDevolver;
             #332#67 = nResult - #330#68;
             |ACABA;
         |FINSI;

         |PUSHV 0501 2380;
         |CUADRO 1220 1752;
         |BLANCO 1321 1651;

         |ATRI S;
         |PINTA 1321, "Resultado ........: ";
         |PINTA 1421, "Maximo a Devolver : ";
         |PINTA 1521, "A Devolver .......: ";
         |PINTA 1621, "A Compensar ......: ";
         |ATRI s;

         |PINTA 1341, #332#66;
         |PINTA 1441, #332#64;
         |PINTA 1541, #332#68;
         |PINTA 1641, #332#67;

         E_inf = "0.?EURO";
         E_sup = "99999999999";

         nCampo68 = #332#68;

         |ET Campo68_332;
             nCampo68 = 1541 ? 1;
             |SI nCampo68 > #332#64;
                 |MENAV "     Maximo a Devolver superado.";
                 nCampo68 = #332#64;
                 |VETE Campo68_332;
             |FINSI;

         #332#68 = nCampo68;
         #332#67 = nResult - #332#68;
         |PINTA 1641, #332#67;

         |POPV;
     |FINSI;
|FPRC;

|PROCESO Modelo332;
     |ABRE #332;

     #332#0 = enEmpresa;
     #332#1 = enEjer;
     #332#2 = enPeriodo;
     #332#3 = enModelo;
     #332#4 = enComplem;
     #332#5 = 0;
     |LEE 101#332=;
     |SI FSalida ! 0;
         |HAZ RecogeAnter;

         |DDEFECTO #332;
         #332#0 = enEmpresa;
         #332#1 = enEjer;
         #332#2 = enPeriodo;
         #332#3 = enModelo;
         #332#4 = enComplem;
         #332#5 = 0;

         #332#57 = 0;
         #332#59 = nEjerAnt;

         |GRABA 020#332b;
     |FINSI;

     nEjerAnt  = #332#59;
     nContador = 0;
     nSwGraba  = 0;
     |BUCLE dsmociva;

     |SI nSwGraba = 1;
         #332#59 = nEjerAnt;
         |HAZ Totales332;
         enIvaSopDed = #332#55;
         |GRABA 020#332a;
     |SINO;
         |BORRA 020#332a;
     |FINSI;
     |LIBERA #332;
     |CIERRA #332;
|FPRC;

|PROCESO aPerNom;
     |SI enPeriodo = 1;   aPerNom = "ENERO     ";  |FINSI;
     |SI enPeriodo = 2;   aPerNom = "FEBRERO   ";  |FINSI;
     |SI enPeriodo = 3;   aPerNom = "MARZO     ";  |FINSI;
     |SI enPeriodo = 4;   aPerNom = "ABRIL     ";  |FINSI;
     |SI enPeriodo = 5;   aPerNom = "MAYO      ";  |FINSI;
     |SI enPeriodo = 6;   aPerNom = "JUNIO     ";  |FINSI;
     |SI enPeriodo = 7;   aPerNom = "JULIO     ";  |FINSI;
     |SI enPeriodo = 8;   aPerNom = "AGOSTO    ";  |FINSI;
     |SI enPeriodo = 9;   aPerNom = "SEPTIEMBRE";  |FINSI;
     |SI enPeriodo = 10;  aPerNom = "OCTUBRE   ";  |FINSI;
     |SI enPeriodo = 11;  aPerNom = "NOVIEMBRE ";  |FINSI;
     |SI enPeriodo = 12;  aPerNom = "DICIEMBRE ";  |FINSI;
     |SI enPeriodo = 99;  aPerNom = "ANUAL     ";  |FINSI;
|FPRC;

|PROCESO dsmom029;
 |SI nSwOpe29 = 0;
     |SI #29#9 = 0;
         #27#39 = #27#39 + #29#3;
         #27#40 = #27#40 + #29#5;
         #27#44 = #27#44 + #29#8;
     |FINSI;
 |SINO;
     |BORRA 020#29a;
 |FINSI;
 |LIBERA #29;
|FPRC;

|DEFBUCLE dsmom029;
   #29#1;
   ;
   enEmpresa, enEjer, nDPer, 00;
   enEmpresa, enEjer, nHPer, 00;
   be;
   NULL, dsmom029;
|FIN;

|PROCESO DeclaradoProrrata300;
     #27#23 = #27#23 + #300#35;
     #27#24 = #27#24 + #300#37;
     #27#25 = #27#25 + #300#41;
     #27#26 = #27#26 + #300#43;
     #27#27 = #27#27 + #300#47;
     #27#28 = #27#28 + #300#49;
     #27#29 = #27#29 + #300#53;
|FPRC;

|DEFBUCLE dsmod300;
     #300#1;
     ;
     enEmpresa, enEjer,  1, 300, 00, 00;
     enEmpresa, enEjer, 12, 300, 99, 99;
     ;
     NULL, DeclaradoProrrata300;
|FIN;

|PROCESO DeclaradoProrrata370;
     #27#23 = #27#23 + #370#35;
     #27#24 = #27#24 + #370#37;
     #27#25 = #27#25 + #370#41;
     #27#26 = #27#26 + #370#43;
     #27#27 = #27#27 + #370#47;
     #27#28 = #27#28 + #370#49;
     #27#29 = #27#29 + #370#53;
|FPRC;

|DEFBUCLE dsmod370;
     #370#1;
     ;
     enEmpresa, enEjer,  1, 370, 00, 00;
     enEmpresa, enEjer, 12, 370, 99, 99;
     ;
     NULL, DeclaradoProrrata370;
|FIN;

|PROCESO DeclaradoProrrata320;
     #27#23 = #27#23 + #320#35;
     #27#24 = #27#24 + #320#37;
     #27#25 = #27#25 + #320#41;
     #27#26 = #27#26 + #320#43;
     #27#27 = #27#27 + #320#47;
     #27#28 = #27#28 + #320#49;
     #27#29 = #27#29 + #320#53;
|FPRC;

|DEFBUCLE dsmod320;
     #320#1;
     ;
     enEmpresa, enEjer,  1, 320, 00, 00;
     enEmpresa, enEjer, 12, 320, 99, 99;
     ;
     NULL, DeclaradoProrrata370;
|FIN;

|PROCESO DeclaradoProrrata330;
     #27#23 = #27#23 + #330#35;
     #27#24 = #27#24 + #330#37;
     #27#25 = #27#25 + #330#41;
     #27#26 = #27#26 + #330#43;
     #27#27 = #27#27 + #330#47;
     #27#28 = #27#28 + #330#49;
     #27#29 = #27#29 + #330#53;
|FPRC;

|DEFBUCLE dsmod330;
     #330#1;
     ;
     enEmpresa, enEjer,  1, 330, 00, 00;
     enEmpresa, enEjer, 12, 330, 99, 99;
     ;
     NULL, DeclaradoProrrata330;
|FIN;

|PROCESO DeclaradoProrrata332;
     #27#23 = #27#23 + #332#35;
     #27#24 = #27#24 + #332#37;
     #27#25 = #27#25 + #332#41;
     #27#26 = #27#26 + #332#43;
     #27#27 = #27#27 + #332#47;
     #27#28 = #27#28 + #332#49;
     #27#29 = #27#29 + #332#53;
|FPRC;

|DEFBUCLE dsmod332;
     #332#1;
     ;
     enEmpresa, enEjer,  1, 330, 00, 00;
     enEmpresa, enEjer, 12, 330, 99, 99;
     ;
     NULL, DeclaradoProrrata332;
|FIN;

|PROCESO TotalProrrata;

     #27#6  = #27#4 + #27#5;
     nNume1 = ((#27#4 / #27#6) * 100) ! 2;
     nNume2 = nNume1 ! 0;
     |SI nNume2 < nNume1;
         nNume2 = nNume1 ! 0 + 1;
     |FINSI;
     #27#3  = nNume2;
     |SI #27#3 > 100; #27#3 = 100; |FINSI;

     #27#15 = #27#7  % #27#2;
     #27#16 = #27#8  % #27#2;
     #27#17 = #27#9  % #27#2;
     #27#18 = #27#10 % #27#2;
     #27#19 = #27#11 % #27#2;
     #27#20 = #27#12 % #27#2;
     #27#21 = #27#13 % #27#2;

     nDPer = 1;
     nHPer = 12;
     nSwOpe29 = 0;
     |BUCLE dsmod300;
     |BUCLE dsmod370;
     |BUCLE dsmod320;
     |BUCLE dsmod330;
     |BUCLE dsmod332;
     |BUCLE dsmom029;

     #27#31 = #27#15 - #27#23;
     #27#32 = #27#16 - #27#24;
     #27#33 = #27#17 - #27#25;
     #27#34 = #27#18 - #27#26;
     #27#35 = #27#19 - #27#27;
     #27#36 = #27#20 - #27#28;
     #27#37 = #27#21 - #27#29;

     #27#14 = #27#7  + #27#8  + #27#9  + #27#10 + #27#11 + #27#12 + #27#13;
     #27#22 = #27#15 + #27#16 + #27#17 + #27#18 + #27#19 + #27#20 + #27#21;
     #27#30 = #27#23 + #27#24 + #27#25 + #27#26 + #27#27 + #27#28 + #27#29;
     #27#38 = #27#31 + #27#32 + #27#33 + #27#34 + #27#35 + #27#36 + #27#37;

     #27#41 = #27#39 - #27#40;
|FPRC;


|PROCESO Registro0;
     |SI enModelo ! 370;
         |HAZ eLeeLaProrrata;
         nPro = nProrrata;
         |SI enEjer ] enEjerPro; nProrrata = 100; |FINSI;
     |FINSI;

     |SI enModelo = 300;
         |ABRE #300;
         #300#0 = enEmpresa;
         #300#1 = enEjer;
         #300#2 = enPeriodo;
         #300#3 = enModelo;
         #300#4 = enComplem;
         #300#5 = 0;
         |LEE 101#300=;
         |SI FSalida = 0;
             |BORRA 020#300a;
         |FINSI;
         |LIBERA #300;
         |CIERRA #300;
     |FINSI;

     |SI enModelo = 320;
         |ABRE #320;
         #320#0 = enEmpresa;
         #320#1 = enEjer;
         #320#2 = enPeriodo;
         #320#3 = enModelo;
         #320#4 = enComplem;
         #320#5 = 0;
         |LEE 101#320=;
         |SI FSalida = 0;
             |BORRA 020#320a;
         |FINSI;
         |LIBERA #320;
         |CIERRA #320;
     |FINSI;

     |SI enModelo = 330;
         |ABRE #330;
         #330#0 = enEmpresa;
         #330#1 = enEjer;
         #330#2 = enPeriodo;
         #330#3 = enModelo;
         #330#4 = enComplem;
         #330#5 = 0;
         |LEE 101#330=;
         |SI FSalida = 0;
             |BORRA 020#330a;
         |FINSI;
         |LIBERA #330;
         |CIERRA #330;
     |FINSI;

     |SI enModelo = 332;
         |ABRE #332;
         #332#0 = enEmpresa;
         #332#1 = enEjer;
         #332#2 = enPeriodo;
         #332#3 = enModelo;
         #332#4 = enComplem;
         #332#5 = 0;
         |LEE 101#332=;
         |SI FSalida = 0;
             |BORRA 020#332a;
         |FINSI;
         |LIBERA #332;
         |CIERRA #332;
     |FINSI;

     |SI enModelo = 370;
         |ABRE #370;
         #370#0 = enEmpresa;
         #370#1 = enEjer;
         #370#2 = enPeriodo;
         #370#3 = enModelo;
         #370#4 = enComplem;
         #370#5 = 0;
         |LEE 101#370=;
         |SI FSalida = 0;
             |BORRA 020#370a;
         |FINSI;
         |LIBERA #370;
         |CIERRA #370;
     |FINSI;

     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = enPeriodo;
     #8#3 = enModelo;
     #8#4 = enComplem;
     #8#5 = 0;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS ";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;

     |SI enEjer < enEjerPro;   || de antes
         nDPer = enPeriodo;
         nHPer = enPeriodo;
         nSwOpe29 = 1;
         |BUCLE dsmom029;
     |FINSI;

     nSwGraba = 0;

     eaProrr29     = eaProrrat;
     enImpIvaSop   = 0;
     enIvaSopDed   = 0;
     enImpIvaSub   = 0;
     |SI enModelo = 300;  |HAZ Modelo300;  |FINSI;
     |SI enModelo = 320;  |HAZ Modelo320;  |FINSI;
     |SI enModelo = 330;  |HAZ Modelo330;  |FINSI;
     |SI enModelo = 332;  |HAZ Modelo332;  |FINSI;
     |SI enModelo = 370;
         nTipo         = enTipoEntrada;
         enTipoEntrada = 98;
         |SUB_EJECUTA_NP "dsmod370";
         enTipoEntrada = nTipo;
         nSwGraba      = enExistencia;
     |FINSI;

     |SI nSwGraba = 1;
         |ABRE #8;
         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = enPeriodo;
         #8#3 = enModelo;
         #8#4 = enComplem;
         #8#5 = 0;
         |LEE 101#8=;
         |SI FSalida = 0;
             #8#11 = "EXISTENTE";
             |GRABA 020#8a;
         |FINSI;
         |LIBERA #8;
         |CIERRA #8;
     |FINSI;

     |SI enEjer ] enEjerPro;  || Calculo Nuevo de Prorrata
         |ACABA;
     |FINSI;

     |ABRE #27;
     #27#0 = enEmpresa;
     #27#1 = enEjer;
     |LEE 101#27=;
     |SI FSalida ! 0;
         |DDEFECTO #27;
         #27#0 = enEmpresa;
         #27#1 = enEjer;
         |GRABA 020#27b;
     |FINSI;

     |PDEFECTO #27, 15, 41;
     |HAZ TotalProrrata;

     |GRABA 020#27a;
     |LIBERA #27;

     nPorCalculado = #27#3;

     |SI enPeriodo = 12; |Y enSwProrr < 2;
         #27#0 = enEmpresa;
         #27#1 = enEjer + 1;
         |LEE 101#27=;
         |SI FSalida ! 0;
             |DDEFECTO #27;
             #27#0 = enEmpresa;
             #27#1 = enEjer + 1;
             |GRABA 020#27b;
         |FINSI;

         |SI #27#2 ! nPorCalculado;
             |SI enPregunta = 0;
                 aAlfa = "0000 El Porcentaje de Prorrata para el Ejercicio que viene ha sido Actualizado.";
                 aAlfa = aAlfa + " Empresa " + (("00000" + #27#0) % -105) + " / " + #27#1;
                 |MENAV aAlfa;
             |FINSI;
             #27#2 = nPorCalculado;
         |FINSI;
         |GRABA 020#27a;
         |LIBERA #27;

         #27#0 = enEmpresa;
         #27#1 = enEjer;
         |LEE 101#27=;

     |FINSI;

     |CIERRA #27;

|FPRC;

|| ///////////////// Procesos del Entlineal \\\\\\\\\\\\\\\\\\\\

|PROCESO Total1_9;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 1;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 2;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 3;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 4;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 5;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 6;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 7;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 8;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 1;
     #0#7  = 9;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         #0#13 = nValor2;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total1_13;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 10;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 11;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 12;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 1;
     #0#7  = 13;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         #0#13 = nValor2;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_1;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 1;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 1;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 1;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 1;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_4;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 4;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_5;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 5;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_6;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 6;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_7;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 7;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total2_10;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 2;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 5;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 6;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 7;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 8;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     |SI enEjer [ 2007;
         #0#0  = enEmpresa;
         #0#1  = enEjer;
         #0#2  = enPeriodo;
         #0#3  = enModelo;
         #0#4  = enComplem;
         #0#5  = enActividad;
         #0#6  = 2;
         #0#7  = 10;
         |LEE 101#0=;
         |SI FSalida = 0;
             #0#12 = nValor1;
             #0#13 = nValor2;
             |GRABA 020#0a;
             |LIBERA #0;
         |FINSI;
     |FINSI;

     |SI enEjer ] 2008;
         nGrupo    = 2;  nSubGrupo = 10;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;
     |FINSI;

|| Importante los dos nuevos datos de Iva Soportado
     nGrupo    = 2;  nSubGrupo = 11;   |HAZ LeeCasilla;
     nValor1   = nValor1 - #0#12;
     nValor2   = nValor2 - #0#13;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 2;
     #0#7  = 12;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         #0#13 = nValor2;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_15;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 3;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 5;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 6;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 7;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 8;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 10;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 11;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 12;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 13;   |HAZ LeeCasilla;
     nValor1   = nValor1 - #0#12;

     nGrupo    = 3;  nSubGrupo = 14;   |HAZ LeeCasilla;
     nValor1   = nValor1 - #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 15;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Totales;
     |HAZ Total1_9;   || Total Bases y Cuotas I.V.A.
     |HAZ Total1_13;  || Total Bases y Cuotas I.V.A. y Recargo

     |SI enModelo = 300;  |O enModelo = 330;  |O enModelo = 370;
         |HAZ Total3_1;   || Operaciones en Regimen General
     |FINSI;

     |SI enModelo = 320;  |O enModelo = 332;
         |HAZ Total3_4;   || Operaciones en Regimen Ordinario
         |HAZ Total3_5;   || Operaciones en Regimen especial bienes usados etc.
         |HAZ Total3_6;   || Operaciones en Regimen especial Agencias Viajes
         |HAZ Total3_7;   || Operaciones en Determinacion Proporcional
     |FINSI;

     |HAZ Total2_10;  || Suma de Deducciones
     |HAZ Total3_15;  || Total Volumnen de Operaciones

     |SI enTipoEntrada ! 95;
         |HAZ Refresco;
     |FINSI;
|FPRC;

|PROCESO Tipo7;  |TIPO 7;
     |PINTA #0#12;
     |PINTA #0#13;

     |SI eaCaptura = "REGISTROS "; |Y enActividad ! 99;
         |SI #0#11 = 2;
             |MENSA "     ";
         |FINSI;
         |SI #0#11 = 0;
             |MENSA "     Pulse <F2> para Introduccion de Bases y Cuotas";
         |FINSI;
         |SI #0#11 = 1;
             |MENSA "     Pulse <F2> para Introduccion del Importe";
         |FINSI;
    |SINO;
         |SI #0#6 = 1; |O #0#6 = 3;
             |SI #0#11 = 2;
                 |MENSA "    Pulse <F5> para Introducir Datos Subvenciones";
             |FINSI;
                 |SI #0#11 = 0;
                     |MENSA "     <F2> Introd. de Bases y Cuotas, <F5> Introd. de Subvenciones";
                 |FINSI;
                 |SI #0#11 = 1;
                     |MENSA "     <F2> para Introd. del Importe, <F5> Introd. de Subvenciones";
                 |FINSI;
         |SINO;
             |SI #0#11 = 2;
                 |MENSA "     ";
             |FINSI;
             |SI #0#11 = 0;
                 |MENSA "     Pulse <F2> para Introduccion de Bases y Cuotas";
             |FINSI;
             |SI #0#11 = 1;
                 |MENSA "     Pulse <F2> para Introduccion del Importe";
             |FINSI;
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO PonIvas;
     nSwAcum = 0;
     |PARA nCampo2 = 15;  |SI nCampo2 [ 24;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #0nCampo2 = #349nCampo22;
               |SI #349#6 = "A ";
                   #0nCampo1 = #0nCampo1 + #349nCampo11;
                   #0nCampo3 = #0nCampo3 + #349nCampo33;
               |SINO;
                   |SI #349#24 = "-";
                       #0nCampo1 = #0nCampo1 - (#349nCampo11 - #349#27);
                       #0nCampo3 = #0nCampo3 - (#349nCampo33 - nAntIVA);
                   |SINO;
                       #0nCampo1 = #0nCampo1 + (#349nCampo11 - #349#27);
                       #0nCampo3 = #0nCampo3 + (#349nCampo33 - nAntIVA);
                   |FINSI;
               |FINSI;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 1;  |ACABA;  |FINSI;

     |PARA nCampo2 = 15;  |SI nCampo2 [ 24;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #0nCampo2 = 0;
               |SI #349#6 = "A ";
                   #0nCampo1 = #0nCampo1 + #349nCampo11;
                   #0nCampo2 = #349nCampo22;
                   #0nCampo3 = #0nCampo3 + #349nCampo33;
               |SINO;
                   |SI #349#24 = "-";
                       #0nCampo1 = #0nCampo1 - (#349nCampo11 - #349#27);
                       #0nCampo2 = #349nCampo22;
                       #0nCampo3 = #0nCampo3 - (#349nCampo33 - nAntIVA);
                   |SINO;
                       #0nCampo1 = #0nCampo1 + (#349nCampo11 - #349#27);
                       #0nCampo2 = #349nCampo22;
                       #0nCampo3 = #0nCampo3 + (#349nCampo33 - nAntIVA);
                   |FINSI;
               |FINSI;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 1;  |ACABA;  |FINSI;

     #0#23 = #0#23 + #349nCampo11;
     #0#24 = -1;
     #0#25 = #0#25 + #349nCampo33;
|FPRC;

|PROCESO Calcu349;
     |SI #349#6 = "A ";
         |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo11 ! 0;  |O #349nCampo33 ! 0;
                   |HAZ PonIvas;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI #349#6 = "AR";
         || .... Quitado por Luis Lopez 23.10.2003
         || ... ...  |SI #349#1 = #349#25;   || ... Cuando pertecene al mismo ejercicio
         nPon = 0;
         |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo11 ! 0;  |O #349nCampo33 ! 0;
                   nAntIVA = (#349#27 * #349nCampo22 / 100) ! EURODB;
                   |HAZ PonIvas;
                   nPon = 1;
               |FINSI;
         |SIGUE;

         |SI nPon = 0;  |Y #349#27 ! 0;
             nCampo22 = 11;
             nCampo11 = nCampo22 - 1;
             nCampo33 = nCampo22 + 1;
             nAntIVA  = 0;
             |HAZ PonIvas;
         |FINSI;

         || ... ... |FINSI;
     |FINSI;

     |SI #349#6 = "E ";
         #0#12 = #0#12 + #349#22;
     |FINSI;

     |SI #349#6 = "ER";
         || .... Quitado por Luis Lopez 23.10.2003
         || ... ... |SI #349#1 = #349#25;   || ... Cuando pertecene al mismo ejercicio
         |SI #349#24 = "-";  || ... Restamos la base anterior
             #0#12 = #0#12 - (#349#22 - #349#27);
         |SINO;
             #0#12 = #0#12 + (#349#22 - #349#27);
         |FINSI;
         || ... ... |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc349A;
     #349#1;
     ;
     #0#0, #0#1, #0#2, 349, enDComple, #0#5, "A ", 0000, 0, "            ";
     #0#0, #0#1, #0#2, 349, enHComple, #0#5, "Az", 9999, 9, "zzzzzzzzzzzz";
     ;
     NULL, Calcu349;
|FIN;

|PROCESO dsmod349;
     |SI #350#4 ! 0;
         |SI #350#12 = "C";
             enHComple = #350#4;
         |SINO;
             enDComple = #350#4;
             enHComple = #350#4;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmod349;
    #350#1;
    ;
    #0#0, #0#1, #0#2, 349, 00, 00;
    #0#0, #0#1, #0#2, 349, 99, 00;
    ;
    NULL, dsmod349;
|FIN;

|PROCESO Adquisiciones;
     |ABRE #8;
     #8#0 = #0#0;
     #8#1 = #0#1;
     #8#2 = #0#2;
     #8#3 = #0#3;
     #8#4 = #0#4;
     #8#5 = #0#5;
     |LEE 040#8=;
     |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
     |CIERRA #8;

     |SI #0#4 = 0;
         enDComple = 0;
         enHComple = 0;
         |BUCLE dsmod349;
     |SINO;
         enDComple = #0#4;
         enHComple = #0#4;
     |FINSI;

     nTipo         = enTipoEntrada;
     enEmpresa     = #0#0;
     enEjer        = #0#1;
     enPeriodo     = #0#2;
     enComplem     = #0#4;
     enActividad   = #0#5;
     eaTipo349     = "A";
     eaNombreAct   = #8#6;
     eaCaptura     = #8#7;
     eaComunidad   = #8#9;
     eaComunero    = #8#10;
     enTipoEntrada = 1;
     enModelo349   = #0#3;
     |SUB_EJECUTA_NP "dsmoc349";
     enTipoEntrada = nTipo;
     eaTipo349     = "";

     |PDEFECTO #0, 12, 26;

     |BUCLE dsmoc349A;

     #0#12 = #0#14 + #0#17 + #0#20 + #0#23;
     #0#13 = #0#16 + #0#19 + #0#22 + #0#25;

     |SI #0#7 = 5;
         |CONFI "0000SLo Computamos al IVA DEDUCIBLE";
         |SI FSalida = 0;
             |DBASE aBase;  |QBF aBase;
             aMas = aBase + "def/dsmociva.mas";
             |CARGA_DEF aMas, dsmociva@;
             |SI FSalida = 0;
                 |ABRE #999;
                 #999#0 = #0#0;
                 #999#1 = #0#1;
                 #999#2 = #0#2;
                 #999#3 = #0#3;
                 #999#4 = #0#4;
                 #999#5 = #0#5;
                 #999#6 = 2;
                 #999#7 = 5;
                 |LEE 101#999=;
                 |SI FSalida = 0;
                     |PARA nCampo1 = 12;  |SI nCampo1 [ 25;  |HACIENDO nCampo1 = nCampo1 + 1;
                           #999nCampo1 = #0nCampo1;
                     |SIGUE;
                     |GRABA 020#999a;
                     |LIBERA #999;
                 |FINSI;
                 |CIERRA #999;
                 |DESCARGA_DEF #dsmociva@;
             |FINSI;
         |FINSI;
     |FINSI;

     enEmpresa     = #0#0;
     enEjer        = #0#1;
     enPeriodo     = #0#2;
     enComplem     = #0#4;
     enActividad   = #0#5;
|FPRC;

|DEFBUCLE dsmoc349E;
     #349#1;
     ;
     #0#0, #0#1, #0#2, 349, enDComple, #0#5, "E ", 0000, 0, "            ";
     #0#0, #0#1, #0#2, 349, enHComple, #0#5, "Ez", 9999, 9, "zzzzzzzzzzzz";
     ;
     NULL, Calcu349;
|FIN;

|PROCESO Entregas;
     |ABRE #8;
     #8#0 = #0#0;
     #8#1 = #0#1;
     #8#2 = #0#2;
     #8#3 = #0#3;
     #8#4 = #0#4;
     #8#5 = #0#5;
     |LEE 040#8=;
     |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
     |CIERRA #8;

     |SI #0#4 = 0;
         enDComple = 0;
         enHComple = 0;
         |BUCLE dsmod349;
     |SINO;
         enDComple = #0#4;
         enHComple = #0#4;
     |FINSI;

     nTipo         = enTipoEntrada;
     eaTipo349     = "E";
     eaNombreAct   = #8#6;
     eaCaptura     = #8#7;
     eaComunidad   = #8#9;
     eaComunero    = #8#10;
     enTipoEntrada = 1;
     enModelo349   = #0#3;
     |SUB_EJECUTA_NP "dsmoc349";
     enTipoEntrada = nTipo;
     eaTipo349     = "";

     #0#12 = 0;
     |BUCLE dsmoc349E;

     enEmpresa     = #0#0;
     enEjer        = #0#1;
     enPeriodo     = #0#2;
     enComplem     = #0#4;
     enActividad   = #0#5;
|FPRC;

|PROCESO InfSubvencion;
  |SI eaCaptura = "REGISTROS "; |Y enActividad ! 99; |ACABA;  |FINSI;
  |SUB_EJECUTA_NP "dsmom048";
|FPRC;

|PROCESO Introduccion;  |TIPO 11;
     |SI FSalida       ! 10;  |Y FSalida ! 13; |ACABA;  |FINSI;
     |SI FSalida       = 13;
         |HAZ InfSubvencion;
         |ERROR;
         |ACABA;
     |FINSI;
     |SI enTipoEntrada = 4;
          |SI #0#6 = 1;  |Y #0#7 = 5;
              |ACABA;
          |SINO;
              |PUSHV 0501 2380;
              #99#0 = #0#8;
              |PARA nCampo1 = 14;  |SI nCampo1 [ 25;  |HACIENDO nCampo1 = nCampo1 + 1;
                    nCampo2 = nCampo1 - 10;
                    #99nCampo2 = #0nCampo1;
              |SIGUE;
              |PINPA #0#99;
              |PINDA #0#99;
              |LEETECLA aTecla;

              |POPV;
          |FINSI;

          |ACABA;
     |FINSI;

     |LEE 101#0=;

     |SI  #0#11 = 0;
          |SI #0#6 = 1;  |Y #0#7 = 5;
              |HAZ Adquisiciones;
          |SINO;
              #99#0 = #0#8;
              |PARA nCampo1 = 14;  |SI nCampo1 [ 25;  |HACIENDO nCampo1 = nCampo1 + 1;
                    nCampo2 = nCampo1 - 10;
                    #99nCampo2 = #0nCampo1;
              |SIGUE;

              |PUSHV 0501 2380;
              |PINPA #0#99;
              |PINDA #0#99;
              |ENDATOS #1#99;
              |SI FSalida = 0;
                  |PARA nCampo1 = 14;  |SI nCampo1 [ 25;  |HACIENDO nCampo1 = nCampo1 + 1;
                        nCampo2 = nCampo1 - 10;
                        #0nCampo1 = #99nCampo2;
                  |SIGUE;
              |FINSI;

              |POPV;

              #0#12 = #0#14 + #0#17 + #0#20 + #0#23;
              #0#13 = #0#16 + #0#19 + #0#22 + #0#25;
          |FINSI;
     |FINSI;

     |SI  #0#11 = 1;
          |SI #0#6 = 3;  |Y #0#7 = 9;
              |HAZ Entregas;
          |SINO;
              |ENCAMPO #12#0;
          |FINSI;
     |FINSI;

     |PINTA #0#12;
     |PINTA #0#13;

     |GRABA 020#0a;
     |LIBERA #0;

     |SALVA_DATOS #0;

     |HAZ Totales;

     |REPON_DATOS #0;
|FPRC;

|PROCESO Tipo5;  |TIPO 5;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 1;
     #0#7  = 0;
     |LEE 040#0=;

     |LINEAS_BI_ATRI #0#9, S, N, -1;
|FPRC;

|PROCESO GrabaRegistros;
     |SI enModelo = 300;  |O enModelo = 330;  |O enModelo = 370;
         |SI #7#4 = 2;  |ACABA;  |FINSI;
     |SINO;
         |SI #7#4 = 1;  |ACABA;  |FINSI;
     |FINSI;

     |SI #7#0 = 2;  |Y #7#1 = 10;
         |SI #0#1 [ 2007;
             #7#2 = "      Suma de deducciones ........................";
             #7#3 = "T";
             #7#4 = 0;
             #7#5 = 2;
             #7#6 = 0;
             #7#7 = 0;
         |SINO;
             #7#2 = "Regularizacion aplicacion porcentaje def.prorrata";
             #7#3 = "D";
             #7#4 = 0;
             #7#5 = 0;
             #7#6 = 0;
             #7#7 = 0;
         |FINSI;
     |FINSI;

     |DDEFECTO #0;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = #7#0;
     #0#7  = #7#1;
     #0#8  = #7#2;
     #0#9  = #7#3;
     #0#11 = #7#5;

     |SI #7#0 = 5;  |Y #7#1 = 1;
         #0#12 = 100;
     |FINSI;

     |GRABA 020#0n;
     |LIBERA #0;
|FPRC;

|DEFBUCLE dsmom007;
     #7#1;
     ;
     0, 00;
     5, 99;
     ;
     NULL, GrabaRegistros;
|FIN;

|RUTINA ClaveBaja0;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 0;
     #0#7  = 0;
|FRUT;

|RUTINA ClaveAlta0;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 9;
     #0#7  = 99;
|FRUT;

|PROCESO BajaMod048;
     |BORRA 020#148a;
     |LIBERA #148;
|FPRC;

|DEFBUCLE dsmom048B;
     #148#1;
     ;
     enEmpresa, enEjer, enPeriodo, 000, enComplem, enActividad;
     enEmpresa, enEjer, enPeriodo, 999, enComplem, enActividad;
     be;
     NULL, BajaMod048;
|FIN;

|PROCESO BajaModeloPro;
     |BORRA 020#165a;
     |LIBERA #165;
|FPRC;

|DEFBUCLE dsmocivpB;
     #165#1;
     ;
     enEmpresa, enEjer, enPeriodo, 000, enComplem, enActividad, 0,  0;
     enEmpresa, enEjer, enPeriodo, 999, enComplem, enActividad, 9, 99;
     be;
     NULL, BajaModeloPro;
|FIN;

|PROCESO BajaModelo;
     |BORRA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE dsmocivaB;
     #0#1;
     ;
     enEmpresa, enEjer, enPeriodo, 000, enComplem, enActividad, 0,  0;
     enEmpresa, enEjer, enPeriodo, 999, enComplem, enActividad, 9, 99;
     be;
     NULL, BajaModelo;
|FIN;

|PROCESO LeeCabecera;
     nDepar = #401#10;
     |SI nDepar = 0;  nDepar = 1;   |FINSI;

     |ABRE #402;
     #402#0 = enEmpresa;
     #402#1 = nDepar;
     |LEE 040#402=;
     |SI FSalida ! 0;  nDepar = 1;  |FINSI;
     |CIERRA #402;

     |SI enActividad ! nDepar;  |ACABA;  |FINSI;

     #401#40 = 0;
     |GRABA 020#401a;
|FPRC;

|DEFBUCLE camaniva;
     #401#1;
     40,4;
     00, 0000000000, nPeriodo, fDFecha;
     99, 9999999999, nPeriodo, fHFecha;
     be;
     NULL, LeeCabecera;
|FIN;

|PROCESO BajaRegistros;
     |SI eaCaptura ! "REGISTROS ";  |ACABA;  |FINSI;

     |SI enModelo = 300;
         |SI enPeriodo = 3;   nPeriodo = 1;  |FINSI;
         |SI enPeriodo = 6;   nPeriodo = 2;  |FINSI;
         |SI enPeriodo = 9;   nPeriodo = 3;  |FINSI;
         |SI enPeriodo = 12;  nPeriodo = 4;  |FINSI;
     |SINO;
         nPeriodo = enPeriodo;
     |FINSI;

     aAlfa = enEjer; aAlfa1 = "01.01." + aAlfa; fDFecha = aAlfa1;
                     aAlfa1 = "31.12." + aAlfa; fHFecha = aAlfa1;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     nPer1   = -1;
     nPer2   = -1;
     swerror = 0;
     enSwPartido = 0;
     |ABRE #400;
     |SELECT #4#400;
     #400#2  = enEmpresa;
     #400#26 = nEjer;
     |LEE 040#400=;
     |SI FSalida = 0;
         nPer1 = #400#3;
         |SI #400#11 ! 1;
              enSwPartido = 1;
         |FINSI;
     |SINO;
         swerror = 1;
     |FINSI;
     |SI enSwPartido = 1; |O swerror = 1;
         #400#2  = enEmpresa;
         #400#26 = nEjer - 1; |SI #400#26 < 0; #400#26 = 99; |FINSI;
         |LEE 040#400=;
         |SI FSalida = 0;
             |SI #400#11 ! 1;
                 nPer2 = #400#3;
                 enSwPartido = 1;
                 swerror     = 0;
             |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #400;
     |SI swerror = 1; |ACABA; |FINSI;
     |SI enSwPartido = 0;
         fDFecha = "01.01.1900";
         fHFecha = "31.12.2099";
     |FINSI;

     |SI nPer1 ! -1;
         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #400#2) % -105) + nPer1 + "/";

         |PATH_DAT #401 aPathConta;

         |BUCLE camaniva;
     |FINSI;


     |SI nPer2 ! -1;
         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #400#2) % -105) + nPer2 + "/";

         |PATH_DAT #401 aPathConta;

         |BUCLE camaniva;
     |FINSI;

|FPRC;

|PROCESO Baja349;
     enModelo349   = enModelo;
     |SUB_EJECUTA_NP "dsmoc349";
|FPRC;

|PROCESO Grabamom008;
     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = enPeriodo;
     #8#3 = enModelo;
     #8#4 = enComplem;
     #8#5 = enActividad;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "COMPLETADO";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;
|FPRC;

|PROGRAMA;

  |HAZ LeeCtrlProrr;

  eaNomDef = "dsmociva";

  |ABRE #7;
  #7#0 = 2;
  #7#1 = 11;
  |LEE 040#7=;
  |SI FSalida ! 0;
      |CIERRA #7;
      eaExtension = "mod";
      eaPrograma  = "dsmom007";
      |SUB_EJECUTA_NP ":basica/dspatron";
  |SINO;
      |CIERRA #7;
  |FINSI;

|| \\\\\\ Consulta del Modelo

    |SI enTipoEntrada = 4;              || Existencia del Modelo ????
         |CABEZA "Trabajo Modelo 300";
         |ABRE #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         #0#6 = 0;
         #0#7 = 0;
         |LEE 040#0];
         |SI FSalida ! 0;  |O #0#0 ! enEmpresa;  |O #0#1 ! enEjer; |O #0#2 ! enPeriodo;
          |O #0#3 ! enModelo;  |O #0#4 ! enComplem; |O #0#5 ! enActividad;
             |MENAV "     No existe el Registro.";
             |CIERRA #0;
             |ACABA;
         |FINSI;
         |CIERRA #0;

         |HAZ PintaDatos;

         |ENTLINEAL #1#0, -8, 4, 22, 1, ClaveBaja0, ClaveAlta0;
         |ACABA;
     |FINSI;


|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              ||Baja del Modelo
         |BUCLE dsmocivpB;
         |BUCLE dsmocivaB;
         |BUCLE dsmom048B;
         |HAZ BajaRegistros;
         |HAZ eBajaProrrata;
         |HAZ Baja349;
         |HAZ Registro0;
         |ACABA;
     |FINSI;

|| Creacion unicamente del Modelo

     |SI enTipoEntrada = 90;              || Creacion Solamente
         |ABRE #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         #0#6 = 0;
         #0#7 = 0;
         |LEE 040#0];
         |SI FSalida ! 0;  |O #0#0 ! enEmpresa;  |O #0#1 ! enEjer; |O #0#2 ! enPeriodo;
          |O #0#3 ! enModelo;  |O #0#4 ! enComplem; |O #0#5 ! enActividad;
             |BUCLE dsmom007;
         |FINSI;
         |CIERRA #0;

         |ACABA;
     |FINSI;

|| Creacion unicamente del Modelo de Impresion

     |SI enTipoEntrada = 91;
         |HAZ Grabamom008;
         |HAZ Registro0;
         |ACABA;
     |FINSI;

|| Calcula unicamente del Modelo de Trabajo

     |SI enTipoEntrada = 95;              || Calculo del dsmociva
         |ABRE #0;
         |HAZ Totales;
         |CIERRA #0;

         |HAZ Grabamom008;
         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo desde planillas ////////

     |SI enTipoEntrada = 97;              ||Baja del Modelo
         |BUCLE dsmocivpB;
         |BUCLE dsmocivaB;
         |BUCLE dsmom048B;
         |HAZ eBajaProrrata;
         |HAZ Baja349;
         |HAZ Registro0;
         |ACABA;
     |FINSI;


|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         #0#6 = 0;
         #0#7 = 0;
         |LEE 040#0];
         |SI FSalida ! 0;  |O #0#0 ! enEmpresa;  |O #0#1 ! enEjer; |O #0#2 ! enPeriodo;
          |O #0#3 ! enModelo;  |O #0#4 ! enComplem; |O #0#5 ! enActividad;
             enExistencia = 1;
         |FINSI;
         |CIERRA #0;

         |ACABA;
     |FINSI;


|| \\\\\\ Modificacion y Alta del Modelo de Trabajo

     |CABEZA "Trabajo Modelo 300";

     |ABRE #0;
     #0#0 = enEmpresa;
     #0#1 = enEjer;
     #0#2 = enPeriodo;
     #0#3 = enModelo;
     #0#4 = enComplem;
     #0#5 = enActividad;
     #0#6 = 0;
     #0#7 = 0;
     |LEE 040#0];
     |SI FSalida ! 0;  |O #0#0 ! enEmpresa;  |O #0#1 ! enEjer; |O #0#2 ! enPeriodo;
      |O #0#3 ! enModelo;  |O #0#4 ! enComplem; |O #0#5 ! enActividad;
         |BUCLE dsmom007;
     |FINSI;
     |CIERRA #0;

     |HAZ PintaDatos;

     |ENTLINEAL #1#0, -8, 4, 22, 1, ClaveBaja0, ClaveAlta0;
     enEntrada = 1;

     |HAZ Registro0;

     |SI enPlanillas = 1;
         |HAZ Grabamom008;
     |FINSI;
|FPRO;
