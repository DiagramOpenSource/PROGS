|FICHEROS;
     dsmozpas #0;
     dsmom004 #4;
     dsmom008 #8;
     dsm190li #191;
     dsmoc110 #110;

     :/basica/def/agidanif #3;

     &regisnif@ #709;
     dsmow013 #999,MANTE;
|FIN;

|VARIABLES;
     nOp          = 0;
     nLaImpresora = 0;
     nSwHay       = 0;
     nSumaCampo1  = 0;
     nSumaCampo2  = 0;
     nSumaCampo3  = 0;
     nSumaCampo4  = 0;
     nSumaCampo5  = 0;
     nSumaCampo6  = 0;
     nTRelacion   = 0;
     nSuma        = 0;
     nCampoD      = 0;

     aVariable    = "";

     &enError     = 0;

     nDComplem    = 0;
     nHComplem    = 0;
     Periodo      = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO GrabaPerceptor190;
     |SI #110#6 = "PASEANTERIOR";  |ACABA;  |FINSI;
     |SI #110#6 = "MANUAL      ";  |ACABA;  |FINSI;

     nSumaCampo1  = #110#10 + #110#15 + #110#20;
     nSumaCampo2  = #110#11 + #110#16 + #110#21;
     nSumaCampo3  = #110#12 + #110#17 + #110#22;
     nSumaCampo4  = #110#13 + #110#18 + #110#23;
     nSumaCampo5  = #110#14 + #110#19 + #110#24;

     |SI nSumaCampo5 > nSumaCampo4;
         nSumaCampo4 = nSumaCampo4 + nSumaCampo5;
     |SINO;
         |SI nSumaCampo5 ! 0;  |Y  nSumaCampo4 = 0;
             nSumaCampo4 = nSumaCampo4 + nSumaCampo5;
         |FINSI;
     |FINSI;

     nSuma = nSumaCampo1 + nSumaCampo2 + nSumaCampo3 +  nSumaCampo4;
     nSuma = nSuma       + nSumaCampo6 + #110#25 + #110#26 + #110#27 + #110#28;

     |SI nSuma = 0;  |ACABA;  |FINSI;

     enImporte1 = 0;
     enImporte2 = 0;
     enImporte3 = 0;
     enImporte4 = 0;

     #191#0  = #110#0;
     #191#1  = #110#1;
     #191#6  = #110#6;
     #191#7  = #110#7;
     enError = 1;
     |HAZ GrabaDatosNif;

     #191#0  = #110#0;
     #191#1  = #110#1;
     #191#6  = #110#6;

     |ABRE #3;
     #3#0  = #191#6;
     #3#1  = 1;
     |LEE 040#3=;
     |SI FSalida ! 0;  |DDEFECTO #3; |FINSI;
     |CIERRA #3;

     nTRelacion = #3#36;

     #191#0  = #110#0;
     #191#1  = #110#1;
     #191#2  = 99;
     #191#3  = 190;
     #191#4  = enComplem;
     #191#5  = 0;
     #191#6  = #110#6;
     #191#7  = #110#7;
     #191#8  = #110#8;
     #191#9  = #110#9;
     #191#10 = 0;
     |SI #191#8 = "A";  #191#10 = nTRelacion;  |FINSI;
     |LEE 101#191=;
     |SI FSalida ! 0;
         |DDEFECTO #191;
         #191#0  = #110#0;
         #191#1  = #110#1;
         #191#2  = 99;
         #191#3  = 190;
         #191#4  = enComplem;
         #191#5  = 0;
         #191#6  = #110#6;
         #191#7  = #110#7;
         #191#8  = #110#8;
         #191#9  = #110#9;
         #191#10 = 0;
         |SI #191#8 = "A";  #191#10 = nTRelacion;  |FINSI;

         eaCodNif = #191#6;
         |HAZ LeeNifs;

         #191#12 = #709#1;
         #191#13 = #709#4;

         |HAZ CalculaDatosNif;

         |SI #191#8 ! "A"; |Y #191#8 ! "B";  |Y #191#8 ! "C";  |Y #191#8 ! "D";
             #191#14 = 0;  #191#21 = 0;  #191#22 = 0;  #191#23 = 0;
             #191#24 = 0;  #191#25 = 0;  #191#26 = 0;

             |PARA nCampoD = 28;  |SI nCampoD [ 38;  |HACIENDO nCampoD = nCampoD + 1;
                   #191nCampoD = 0;
             |SIGUE;

             |PARA nCampoD = 41;  |SI nCampoD [ 60;  |HACIENDO nCampoD = nCampoD + 1;
                   #191nCampoD = 0;
             |SIGUE;
         |FINSI;

         |SI #191#26 ! 2;
             #191#27 = "";
         |FINSI;

         |GRABA 020#191b;
     |FINSI;

     |SI enMasivo = 0;
         |SI #191#8 = "A"; |O #191#8 = "B";  |O #191#8 = "C";  |O #191#8 = "D";
             |SI #191#14 = 0;  |O #191#26 = 0;
                 aVariable = "NIF : " + #191#6 + " REVISAR DATOS PERSONALES, PUEDEN ESTAR INCOMPLETOS";
                 |SI nLaImpresora = 0; |HAZ LaImprMasivo; |FINSI;
                 |IMPRIME aVariable;
             |SINO;
                 |SI enError = 1;
                     aVariable = "NIF : " + #191#6 + " REVISAR DATOS PERSONALES, PUEDEN ESTAR INCOMPLETOS";
                     |SI nLaImpresora = 0; |HAZ LaImprMasivo; |FINSI;
                     |IMPRIME aVariable;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     #191#16 = #191#16 + nSumaCampo1;
     #191#17 = #191#17 + nSumaCampo2;
     #191#18 = #191#18 + nSumaCampo3;
     #191#19 = #191#19 + nSumaCampo4;
     #191#20 = #191#20 + nSumaCampo5;

     |SI #110#5 ! 99;
         |SI enImporte1 ! 0; |O enImporte2 ! 0; |O enImporte3 ! 0; |O enImporte4 ! 0;
             #191#21 = enImporte1;
             #191#22 = enImporte2;
             #191#23 = enImporte3;
             #191#24 = enImporte4;
         |SINO;
             #191#21 = #191#21 + #110#25;
             #191#22 = #191#22 + #110#26;
             #191#23 = #191#23 + #110#27;
             #191#24 = #191#24 + #110#28;
         |FINSI;
     |FINSI;

     |SI #191#8 ! "A"; |Y #191#8 ! "B";  |Y #191#8 ! "C";  |Y #191#8 ! "D";
         #191#14 = 0;
         #191#21 = 0;
         #191#22 = 0;
         #191#23 = 0;
         #191#24 = 0;
         #191#25 = 0;
         #191#26 = 0;

         |PARA nCampoD = 28;  |SI nCampoD [ 38;  |HACIENDO nCampoD = nCampoD + 1;
               #191nCampoD = 0;
         |SIGUE;

         |PARA nCampoD = 41;  |SI nCampoD [ 60;  |HACIENDO nCampoD = nCampoD + 1;
               #191nCampoD = 0;
         |SIGUE;
     |FINSI;

     |SI #191#16 ! 0; |O #191#17 ! 0; |O #191#18 ! 0;
         |O #191#19 ! 0; |O #191#20 ! 0; |O #191#21 ! 0;
           |O #191#22 ! 0; |O #191#23 ! 0; |O #191#24 ! 0;
            |GRABA 020#191a;
         nSwHay = 1;
     |SINO;
         |BORRA 020#191a;
     |FINSI;
     |LIBERA #191;
|FPRC;

|DEFBUCLE dsmoc110;
     #110#1;
     ;
     #999#0, #999#2, Periodo, 110, nDComplem, 01, "            ", 0000, " ", "  ";
     #999#0, #999#2, Periodo, 110, nHComplem, 99, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, GrabaPerceptor190;
|FIN;

/*  Antes de complementarias
|DEFBUCLE dsmoc110;
     #110#1;
     ;
     #999#0, #999#2, 00, 110, 00, 01, "            ", 0000, " ", "  ";
     #999#0, #999#2, 99, 110, 99, 99, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, GrabaPerceptor190;
|FIN;
*/

|PROCESO GrabaPerceptor190Reg;
     |SI #110#6 = "PASEANTERIOR";  |ACABA;  |FINSI;
     |SI #110#6 = "MANUAL      ";  |ACABA;  |FINSI;

     nSumaCampo1  = #110#10 + #110#15 + #110#20;
     nSumaCampo2  = #110#11 + #110#16 + #110#21;
     nSumaCampo3  = #110#12 + #110#17 + #110#22;
     nSumaCampo4  = #110#13 + #110#18 + #110#23;
     nSumaCampo5  = #110#14 + #110#19 + #110#24;

     |SI nSumaCampo5 > nSumaCampo4;
         nSumaCampo4 = nSumaCampo4 + nSumaCampo5;
     |SINO;
         |SI nSumaCampo5 ! 0;  |Y  nSumaCampo4 = 0;
             nSumaCampo4 = nSumaCampo4 + nSumaCampo5;
         |FINSI;
     |FINSI;

     nSuma = nSumaCampo1 + nSumaCampo2 + nSumaCampo3 +  nSumaCampo4
     nSuma = nSuma       + nSumaCampo6 + #110#25 + #110#26 + #110#27 + #110#28;

     |SI nSuma = 0;  |ACABA;  |FINSI;

     enImporte1 = 0;
     enImporte2 = 0;
     enImporte3 = 0;
     enImporte4 = 0;

     #191#0  = #110#0;
     #191#1  = #110#1;
     #191#6  = #110#6;
     #191#7  = #110#7;
     enError = 1;
     |HAZ GrabaDatosNif;

     #191#0  = #110#0;
     #191#1  = #110#1;
     #191#6  = #110#6;

     |ABRE #3;
     #3#0  = #191#6;
     #3#1  = 1;
     |LEE 040#3=;
     |SI FSalida ! 0;  |DDEFECTO #3; |FINSI;
     |CIERRA #3;

     nTRelacion = #3#36;

     #191#0  = #110#0;
     #191#1  = #110#1;
     #191#2  = 99;
     #191#3  = 190;
     #191#4  = enComplem;
     #191#5  = 0;
     #191#6  = #110#6;
     #191#7  = #110#7;
     #191#8  = #110#8;
     #191#9  = #110#9;
     #191#10 = 0;
     |SI #191#8 = "A";  #191#10 = nTRelacion;  |FINSI;
     |LEE 101#191=;
     |SI FSalida ! 0;
         |DDEFECTO #191;
         #191#0  = #110#0;
         #191#1  = #110#1;
         #191#2  = 99;
         #191#3  = 190;
         #191#4  = enComplem;
         #191#5  = 0;
         #191#6  = #110#6;
         #191#7  = #110#7;
         #191#8  = #110#8;
         #191#9  = #110#9;
         #191#10 = 0;
         |SI #191#8 = "A";  #191#10 = nTRelacion;  |FINSI;

         eaCodNif = #191#6;
         |HAZ LeeNifs;

         #191#12 = #709#1;
         #191#13 = #709#4;

         |HAZ CalculaDatosNif;

         |SI #191#8 ! "A"; |Y #191#8 ! "B";  |Y #191#8 ! "C";  |Y #191#8 ! "D";
             #191#14 = 0;  #191#21 = 0;  #191#22 = 0;  #191#23 = 0;
             #191#24 = 0;  #191#25 = 0;  #191#26 = 0;

             |PARA nCampoD = 28;  |SI nCampoD [ 38;  |HACIENDO nCampoD = nCampoD + 1;
                   #191nCampoD = 0;
             |SIGUE;

             |PARA nCampoD = 41;  |SI nCampoD [ 60;  |HACIENDO nCampoD = nCampoD + 1;
                   #191nCampoD = 0;
             |SIGUE;
         |FINSI;

         |SI #191#26 ! 2;
             #191#27 = "";
         |FINSI;

         |GRABA 020#191b;
     |SINO;
         enImporte1 = 0;
         enImporte2 = 0;
         enImporte3 = 0;
         enImporte4 = 0;
     |FINSI;

     #191#21 = #191#21 + #110#25 + enImporte1;
     #191#22 = #191#22 + #110#26 + enImporte2;
     #191#23 = #191#23 + #110#27 + enImporte3;
     #191#24 = #191#24 + #110#28 + enImporte4;

     |SI #191#8 ! "A"; |Y #191#8 ! "B";  |Y #191#8 ! "C";  |Y #191#8 ! "D";
         #191#14 = 0;
         #191#21 = 0;
         #191#22 = 0;
         #191#23 = 0;
         #191#24 = 0;
         #191#25 = 0;
         #191#26 = 0;

         |PARA nCampoD = 28;  |SI nCampoD [ 38;  |HACIENDO nCampoD = nCampoD + 1;
               #191nCampoD = 0;
         |SIGUE;

         |PARA nCampoD = 41;  |SI nCampoD [ 60;  |HACIENDO nCampoD = nCampoD + 1;
               #191nCampoD = 0;
         |SIGUE;
     |FINSI;
     |GRABA 020#191a;
     |LIBERA #191;
     nSwHay = 1;
|FPRC;

/*  Antes de complementarias
|DEFBUCLE dsmoc110Reg;
     #110#1;
     ;
     #999#0, #999#2, 00, 110, 00, 99, "            ", 0000, " ", "  ";
     #999#0, #999#2, 99, 110, 99, 99, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, GrabaPerceptor190Reg;
|FIN;
*/

|DEFBUCLE dsmoc110Reg;
     #110#1;
     ;
     #999#0, #999#2, Periodo, 110, nDComplem, 99, "            ", 0000, " ", "  ";
     #999#0, #999#2, Periodo, 110, nHComplem, 99, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, GrabaPerceptor190Reg;
|FIN;

|PROCESO LaImprMasivo;
     |SI enMasivo = 0; |Y nLaImpresora = 0;
         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;
         nLaImpresora = 1;
     |FINSI;
|FPRC;

|PROCESO Pase190;
||     |SI enMasivo = 0;
||         |IMPRE 0;
||         |SI FSalida ! 0;  |ACABA;  |FINSI;
||     |FINSI;

     nLaImpresora = 0;
     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = #999#9;
     |LEE 040#4=;
     |SI FSalida ! 0;  |CIERRA #4; |ACABA;   |FINSI;
     |CIERRA #4;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #4#4;
     enActividad   = 0;
     enTipoEntrada = 3;
     enMensa       = 1;
     |SUB_EJECUTA_NP "dsm190ca";

     |ABRE #191;
     |PARA Periodo = 1;  |SI Periodo [ 12;  |HACIENDO Periodo = Periodo + 1;
           nDComplem = -1;
           |ABRE #110;
           |DDEFECTO #110;
           #110#0 = #999#0;
           #110#1 = #999#2;
           #110#2 = Periodo
           #110#3 = 110;
           #110#4 = 99;
           |LEE 040#110];
           |SI FSalida = 0;
               |LEE 040#110a;
           |SINO;
               |LEE 040#110u;
           |FINSI;
           |SI FSalida = 0; |Y #110#0 = #999#0; |Y #110#1 = #999#2;
                    |Y #110#2 = Periodo; |Y #110#3 = 110;
                        nDComplem = #110#4;
                        nHComplem = #110#4;
           |FINSI;
           |CIERRA #110;
           |SI nDComplem ] 0;
              |BUCLE dsmoc110;
              |BUCLE dsmoc110Reg;       || por el 110.
           |FINSI;
     |SIGUE;
|| ..    |BUCLE dsmoc110;          || No los leo todos por las complementarias
|| ..    |BUCLE dsmoc110Reg;       || por el 110.
     |CIERRA #191;

     |SI nSwHay = 0;
         |SI enMasivo = 0;
             |MENAV "      Seleccion Vacia";
             |CONFI "0000NDesea Crear el Modelo sin Actividad ";
             |SI FSalida ! 0;  |ACABA;  |FINSI;
         |SINO;
             |ACABA;
         |FINSI;
     |FINSI;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #4#4;
     enActividad   = 0;
     enTipoEntrada = 98;
     enMensa       = 1;
     |SUB_EJECUTA_NP "dsm190ca";

     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = #999#9;
     |LEE 101#4=;
     |SI FSalida = 0;
         #4#7  = "X";
         #4#8  = ~;
         #4#15 = 0;
         #4#17 = "COMPLETADO";

         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;

     |SI enMasivo = 0; |Y nLaImpresora = 1;
         |FINIMP;
     |FINSI;
|FPRC;
