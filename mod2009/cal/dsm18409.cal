|FICHEROS;
   dsm18409 #0;

   dsm18401 #10;
|FIN;

|VARIABLES;
   &enEmpresa = 0; &enEjer     = 0; &eaFichero = ""; &enCampo = 0;
   &eaTabla = "";  &enPosicion = 0; &eaDestino = ""; &enComp = 0;
   &eaAlfa  = "";  &enError    = 0; &enTotalCas = 0; &eaTitulo = "";

   nSwError = 0;
   nLCod  = 0;
   nLDes  = 0;
   nCampo = 0;
   nCalc  = 0;
   nLinea = 0;

   aAlfa  = "";
   aAlfa1 = "";
   aAlfa2 = "";
   aPais  = "";
   aTipo  = "";
   aAfect = "";
   aReduc = "";
|FIN;

|PROCESO SacaPais09; |TIPO 7;
   eaTabla = "ztabla05.txt";  nLCod = 2; nLDes = 30; |HAZ CargaTabla;
   |MENSA "    <F2> Consulta paises ";
|FPRC;

|PROCESO CompPais09;

     |SI #dsm18409#5 = "  "; #dsm18409#5 = "ES"; |FINSI;

     |MENSA "     ";
     nCampo   = Campo + 1;

     |SI FSalida = 10;
         enPosicion = 20;
         |HAZ SacaTabla;
         nCalc = 100 + nLCod;
         aAlfa1   = eaDestino % nCalc;
         #0Campo  = aAlfa1; |PINTA #0Campo;
     |FINSI;

     enComp = nLCod;
     aAlfa = "|C" + (("000" + Campo) % -103) + "TIPO"; aAlfa1 = #0aAlfa;
     aAlfa = #0Campo; |QBF aAlfa;
     |SI aAlfa1 = "N"; nCalc = - (100 + nLCod); aAlfa = (("0" * enComp) + aAlfa) % nCalc; |FINSI;
     |SI aAlfa1 ! "N"; nCalc = 100 + nLCod;     aAlfa = (aAlfa + (" " * enComp)) % nCalc; |FINSI;
     eaAlfa = aAlfa;
     |HAZ CompruebaTabla;

     |SI enError = 1;
         |MENAV "0000 Contenido Incorrecto. Consulta la Tabla con F2";
         |ERROR;
         |PULSATECLA;
         |ACABA;
     |FINSI;

     nCalc = 100 + nLCod;                 aAlfa1   = eaDestino % nCalc;
     nCalc = ((nLCod + 2) * 100) + nLDes; aAlfa2   = eaDestino % nCalc;
     #0Campo  = aAlfa1;
     |C_P #0Campo,0,nCalc; nCalc = nCalc + nLCod + 1;
     |PINTA #0Campo;
     #dsm18409#10 = aAlfa2; |PINTA #dsm18409#10;

     |HAZ FinTabla;
|FPRC;

|PROCESO MiraTipo;
   |SI #dsm18409#9 = "S"; |Y #dsm18409#6 = "P";
      |MENAV "    Solo las ganancias tienen derecho a reduccion ";
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO Pais09;
   |SI FSalida = 2; |ACABA; |FINSI;
   aPais = #dsm18409#5;  nLinea = #dsm18409#3; aTipo = #dsm18409#6;
   aReduc = #dsm18409#9; aAfect = #dsm18409#4;

   nSwError = 0;
   |SALVA_FICHA #dsm18409;
   #dsm18409#0 = #dsm18401#0;
   #dsm18409#1 = #dsm18401#1;
   #dsm18409#2 = #dsm18401#3;
   #dsm18409#3 = 1;
   |LEE 000#dsm18409.];
   |PARA; |SI FSalida = 0; |Y #dsm18409#0 = #dsm18401#0; |Y #dsm18409#1 = #dsm18401#1;
           |Y #dsm18409#2 = #dsm18401#3; |HACIENDO;
      aAlfa = #dsm18409#5;
      |SI aAlfa = aPais; |Y #dsm18409#6 = aTipo; |Y #dsm18409#9 = aReduc;
       |Y #dsm18409#4 = aAfect; |Y #dsm18409#3 ! nLinea;
          nSwError = 1; |SAL;
      |FINSI;
      |LEE 000#dsm18409.s;
   |SIGUE;
   |REPON_FICHA #dsm18409;

   |SI nSwError ! 0;
      |SI #dsm18409#5 = "G";
         |MENAV "    Ya existe una linea de ganancias con ese Pais";
      |SINO;
         |MENAV "    Ya existe una linea de perdidas con ese Pais";
      |FINSI;
      |ERROR;
      |HAZ SacaPais09;
   |FINSI;

   |SI #dsm18409#5 = "ES";
      #dsm18409#8 = "S";  |PINTA #dsm18409#8;
      |C_M #dsm18409#8, 1, "N";
   |SINO;
      |C_M #dsm18409#8, 1, "S";
   |FINSI;
|FPRC;
