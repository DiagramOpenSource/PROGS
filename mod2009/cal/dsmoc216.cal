|FICHEROS;
     dsmoc216 #0;
     dsmom002 #2;
     dsmod216 #216;
     dsmom004 #4;
     dsmom008 #8;

     dsmow133 #933,MANTE;

     &regisnif@ #709;

     linea216@ #902;
|FIN;

|VARIABLES;
     nGrupo        = 0;
     i             = 0;
     nMod          = 216;
     aDn           = "            ";
     aHn           = "zzzzzzzzzzzz";
     fDd           = @;
     fHd           = @;
     aTipoCaptura  ="";
     nSwEsta       = 0;
     nEjerAnt      = 0;
     nPer          = 0;
     nSwGraba      = 0;
     nTipo         = 0;
     nIngre        = 0;
     nPeriodo      = 0;
     nEl8          = 0;
     nHComple      = 0;
     nLCod         = 0;
     nCalc         = 0;
     nGrabaAct     = 0;
     nNume         = 0;
     nModo         = 0;

     aPeriodo      = "";
     aPathModelo   = "";
     aDef          = "";
     aAlfa         = "";
     aAlfa1        = "";
     aAlfa2        = "";
     aPeriodicidad = "";
     aDNIAnt       = "";
     aBase         = "";
     aMas          = "";

     &eaAlfa       = "";
     &enError      = 0;
     &eaTabla      = "";
     &enPosicion   = 0;
     &eaDestino    = "";
     &enComp       = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Tipo0C7;  |TIPO 0;
     aAlfa = #0#7 % -104;
     nNume = aAlfa;

     |SI nNume ! #0#1;
||         |MENAV "0000Fecha erronea. El año debe ser igual al del modelo.";
||         |ERROR;
     |FINSI;
|FPRC;

|PROCESO SacaClave; |TIPO 7;
     eaTabla = "ztabla09.txt";  nLCod = 1; |HAZ CargaTabla;
|FPRC;

|PROCESO CompClaveF11; |TIPO 11;
     |SI FSalida = 10;
         enPosicion = 10;
         |HAZ SacaTabla;
         nCalc = 100 + nLCod;
         aAlfa1   = eaDestino % nCalc;
         #0Campo  = aAlfa1;  |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO CompClave;  |TIPO 0;
     enComp = nLCod;
     aAlfa = "|C" + (("000" + Campo) % -103) + "TIPO"; aAlfa1 = #0aAlfa;
     aAlfa = #0Campo; |QBF aAlfa;
     |SI aAlfa1 = "N"; nCalc = - (100 + nLCod); aAlfa = (("0" * enComp) + aAlfa) % nCalc; |FINSI;
     |SI aAlfa1 ! "N"; nCalc = 100 + nLCod;     aAlfa = (aAlfa + (" " * enComp)) % nCalc; |FINSI;
     eaAlfa = aAlfa;
     |HAZ CompruebaTabla;

     |SI enError = 1;
         |MENAV "0000 Contenido Incorrecto. Consulta la Tabla con F2";
         |ERROR;
         |PULSATECLA;
         |ACABA;
     |FINSI;

     nCalc = 100 + nLCod;                 aAlfa1   = eaDestino % nCalc;
     #0Campo  = aAlfa1;
     |C_P #0Campo,0,nCalc; nCalc = nCalc + nLCod + 1;
     |PINTA #0Campo;

     |HAZ FinTabla;
|FPRC;

|PROCESO Tipo7C11; |TIPO 7;
     nModo = (FEntrada / 100) ! 1;
     |SI nModo ! 1;  |ACABA;  |FINSI;

     #0#11 = 1;
     |SI #0#10 = 3;  |O #0#10 = 4;  |O #0#10 = 5;
         #0#11 = 2;
     |FINSI;

     |PINTA #0#11;
|FPRC;

|PROCESO SacaSubClave; |TIPO 7;
     eaTabla = "ztabla10.txt";  nLCod = 2; |HAZ CargaTabla;
|FPRC;

|PROCESO CompSubClaveF11; |TIPO 11;
     |SI FSalida = 10;
         enPosicion = 10;
         |HAZ SacaTabla;
         nCalc = 100 + nLCod;
         aAlfa1   = eaDestino % nCalc;
         #0Campo  = aAlfa1;  |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO CompSubClave;  |TIPO 0;
     enComp = nLCod;
     aAlfa = "|C" + (("000" + Campo) % -103) + "TIPO"; aAlfa1 = #0aAlfa;
     aAlfa = #0Campo; |QBF aAlfa;
     |SI aAlfa1 = "N"; nCalc = - (100 + nLCod); aAlfa = (("0" * enComp) + aAlfa) % nCalc; |FINSI;
     |SI aAlfa1 ! "N"; nCalc = 100 + nLCod;     aAlfa = (aAlfa + (" " * enComp)) % nCalc; |FINSI;
     eaAlfa = aAlfa;
     |HAZ CompruebaTabla;

     |SI enError = 1;
         |MENAV "0000 Contenido Incorrecto. Consulta la Tabla con F2";
         |ERROR;
         |PULSATECLA;
         |ACABA;
     |FINSI;

     nCalc = 100 + nLCod;                 aAlfa1   = eaDestino % nCalc;
     #0Campo  = aAlfa1;
     |C_P #0Campo,0,nCalc; nCalc = nCalc + nLCod + 1;
     |PINTA #0Campo;

     |HAZ FinTabla;
|FPRC;

|PROCESO linea216;
     aAlfa1 = #902#22;  |QBF aAlfa1;
     aAlfa2 = #902#24;  |QBF aAlfa2;
     |SI aAlfa1 = "";   |Y aAlfa2 = "";
         |ACABA;
     |FINSI;

     #0#16 = #902#16;
     #0#17 = #902#17;
     #0#18 = #902#18;
     #0#22 = #902#22;
     #0#23 = #902#23;
     #0#24 = #902#24;
     #0#25 = #902#25;
     #0#26 = #902#26;
     #0#27 = #902#27;
     #0#28 = #902#28;
     #0#29 = #902#29;
     #0#19 = #902#19;
     #0#30 = #902#30;
     #0#21 = #902#21;
     #0#31 = #902#31;
|FPRC;

|DEFBUCLE linea216;
     #902#2001;
     ;
     #0#6;
     #0#6;
     ;
     NULL, linea216;
|FIN;

|PROCESO DatosComplementarios;
     |SI nModo = 1;
         aAlfa1 = #0#22;  |QBF aAlfa1;
         aAlfa2 = #0#24;  |QBF aAlfa2;
         |SI aAlfa1 = "";   |Y aAlfa2 = "";
             |DBASE aMas;  |QBF aMas;
             aMas = aMas + "def/dsmoc216.mas";
             |CARGA_DEF aMas, linea216@;

             |BUCLE linea216;

             |DESCARGA_DEF #linea216@;
         |FINSI;

         aAlfa1 = #0#22;  |QBF aAlfa1;
         aAlfa2 = #0#24;  |QBF aAlfa2;

         |SI aAlfa1 = "";   |Y aAlfa2 = "";
             #0#19 = #709#12;
             #0#22 = #709#2;
             #0#24 = #709#6;
             #0#25 = #709#7;
         |FINSI;
     |FINSI;

     |PUSHV 0501 2480;
     |PINPA #0#933;

     #933#0  = #0#16;
     #933#1  = #0#17;
     #933#2  = #0#18;
     #933#3  = #0#22;
     #933#4  = #0#23;
     #933#5  = #0#24;
     #933#6  = #0#25;
     #933#7  = #0#26;
     #933#8  = #0#27;
     #933#9  = #0#28;
     #933#10 = #0#29;
     #933#11 = #0#19;
     #933#12 = #0#30;
     #933#13 = #0#21;
     #933#14 = #0#31;

     |PINDA #0#933;

     |SI nModo = 1;
         |ENDATOS #1#933;
         |SI FSalida = 0;
             #0#16 = #933#0;
             #0#17 = #933#1;
             #0#18 = #933#2;
             #0#22 = #933#3;
             #0#23 = #933#4;
             #0#24 = #933#5;
             #0#25 = #933#6;
             #0#26 = #933#7;
             #0#27 = #933#8;
             #0#28 = #933#9;
             #0#29 = #933#10;
             #0#19 = #933#11;
             #0#30 = #933#12;
             #0#21 = #933#13;
             #0#31 = #933#14;
         |FINSI;
     |SINO;
         |PAUSA;
     |FINSI;

     |POPV;

     |PINTA #0#16;
     |PINTA #0#17;
     |PINTA #0#18;
     |PINTA #0#19;
|FPRC;

|PROCESO PonNombre;  |TIPO 7;
     |SI #0#6 = "MANUAL      ";  |ACABA;  |FINSI;

     eaCodNif = #0#6;
     |HAZ LeeNifs;

     #0#16 = #709#1;

     nModo = 1;
     |HAZ DatosComplementarios;
|FPRC;

|PROCESO TotRetencion;
     |SI #0Campo = Contenido;  |ACABA;  |FINSI;

     #0#14 = #0#12 % #0#13;  |PINTA #0#14;
|FPRC;

|PROCESO Tipo7;  |TIPO 7;
     |SI #0#6 ! "MANUAL      ";
         |C_M #0#20, 1, "N";  |C_V #0#20, 1, "N";
     |SINO;
         |C_M #0#20, 1, "S";  |C_V #0#20, 1, "S";
         #0#16 = "";
         #0#17 = "";
         #0#18 = "";
         #0#19 = "";
     |FINSI;

     |C_M #0#12, 1, "S";
     |C_M #0#13, 1, "S";
     |C_M #0#14, 1, "S";
     |C_M #0#15, 1, "S";

     |SI #0#11 = 1;
         |C_M #0#15, 1, "N";  #0#15 = 0;
     |FINSI;

     |SI #0#11 = 2;
         |C_M #0#12, 1, "N";  #0#12 = 0;
         |C_M #0#13, 1, "N";  #0#13 = 0;
         |C_M #0#14, 1, "N";  #0#14 = 0;
     |FINSI;

     |PINTA #0#12;
     |PINTA #0#13;
     |PINTA #0#14;
     |PINTA #0#15;
     |PINTA #0#16;
     |PINTA #0#17;
     |PINTA #0#18;
     |PINTA #0#19;
     |PINTA #0#20;
|FPRC;

|PROCESO Dnimoc216;  |TIPO 11;
     |SI FSalida = 10;
         eaVarDni  = #0Campo;
         enCalcCif = 1;
         |HAZ CalculameDNI;
         #0Campo = eaVarDni;
         |PINTA #0Campo;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO MiraDnimoc216;  |TIPO 6;
     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculameDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #0Campo ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaModelo;
     |SI #0#5 = enActividad;  nGrabaAct = 1;  |FINSI;

     nSwGraba = 1;

     |SI #0#6 ! "            ";
         |SI #0#6 ! "MANUAL      ";
             |SI #0#11 = 1;  #216#6 = #216#6 + 1;  |FINSI;
             |SI #0#11 = 2;  #216#9 = #216#9 + 1;  |FINSI;
         |FINSI;

         |SI #0#6 = "MANUAL      ";
             |SI #0#11 = 1;  #216#6 = #0#20;  |FINSI;
             |SI #0#11 = 2;  #216#9 = #0#20;  |FINSI;
         |FINSI;
     |FINSI;

     |SI #0#11 = 1;
         #216#7  = #216#7 + #0#12;
         #216#8  = #216#8 + #0#14;
     |FINSI;

     |SI #0#11 = 2;
         #216#10 = #216#10 + #0#15;
     |FINSI;

     #216#11 = #216#8;
     |SI #216#11 < 0;  #216#11 = 0;  |FINSI;
|FPRC;

|DEFBUCLE dsmoc216;
     #0#1;
     ;
     enEmpresa,enEjer,enPeriodo,nMod,enComplem,01,aDn,fDd,1," ",00,1;
     enEmpresa,enEjer,enPeriodo,nMod,enComplem,99,aHn,fHd,2,"z",99,2;
     be;
     NULL, GrabaModelo;
|FIN;

|PROCESO GrabaRegistro0;
     |SI enModelo = 216;
         |ABRE #216;
         #216#0 = enEmpresa;
         #216#1 = enEjer;
         #216#2 = enPeriodo;
         #216#3 = enModelo;
         #216#4 = enComplem;
         #216#5 = 0;
         |LEE 101#216=;
         |SI FSalida = 0;
             |BORRA 020#216a;
         |FINSI;
         |LIBERA #216;
     |FINSI;

     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = enPeriodo;
     #8#3 = enModelo;
     #8#4 = enComplem;
     #8#5 = 0;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS ";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;
|FPRC;

|PROCESO BajaModelo;
     |BORRA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE dsmoc216B;
     #0#1;
     ;
     enEmpresa,enEjer,enPeriodo,nMod,enComplem,01,aDn,fDd,1," ",00,1;
     enEmpresa,enEjer,enPeriodo,nMod,enComplem,99,aHn,fHd,2,"z",99,2;
     be;
     NULL, BajaModelo;
|FIN;

|PROCESO BorraRegistros;
     |BUCLE dsmoc216B;
     |HAZ GrabaRegistro0;

     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = nPer;
     #8#3 = 216;
     #8#4 = enComplem;
     #8#5 = enActividad;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;
|FPRC;

|PROCESO GrabaTodo;
     |ABRE #216;
     #216#0 = enEmpresa;
     #216#1 = enEjer;
     #216#2 = enPeriodo;
     #216#3 = enModelo;
     #216#4 = enComplem;
     #216#5 = 0;
     |LEE 101#216=;
     |SI FSalida = 0;
          |BORRA 020#216a;
     |FINSI;

     |DDEFECTO #216;
     #216#0 = enEmpresa;
     #216#1 = enEjer;
     #216#2 = enPeriodo;
     #216#3 = enModelo;
     #216#4 = enComplem;
     #216#5 = 0;

     nGrabaAct = 0;
     nSwGraba  = 0;
     |BUCLE dsmoc216;
     |SI nSwGraba = 0;
         |MENAV "0000 No hay Registros ";
     |SINO;
         |GRABA 020#216n;
         |LIBERA #216;

         |ABRE #8;
         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = enPeriodo;
         #8#3 = enModelo;
         #8#4 = enComplem;
         #8#5 = enActividad;
         |LEE 101#8=;
         |SI FSalida = 0;
             |SI nGrabaAct = 1;
                 #8#11 = "COMPLETADO";
             |SINO;
                 #8#11 = "SIN DATOS ";
             |FINSI;
             |GRABA 020#8a;
         |FINSI;
         |LIBERA #8;

         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = enPeriodo;
         #8#3 = enModelo;
         #8#4 = enComplem;
         #8#5 = 0;
         |LEE 101#8=;
         |SI FSalida = 0;
             #8#11 = "EXISTENTE";
             |GRABA 020#8a;
         |FINSI;
         |LIBERA #8;
         |CIERRA #8;
     |FINSI;
     |CIERRA #216;
|FPRC;

|PROCESO AltaModelo;
     |HAZ PintaDatos;
     |ENTLINEAL #1#0, -7, 2, 22, 1, ClaveBaja0, ClaveAlta0;
     |HAZ GrabaTodo;
|FPRC;

|RUTINA ClaveBaja0;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = "            ";
     #0#7  = "01.01.0000";
     #0#8  = 1;
     #0#9  = " ";
     #0#10 = 01;
     #0#11 = 0;
|FRUT;

|RUTINA ClaveAlta0;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = "zzzzzzzzzzzz";
     #0#7  = "31.12.9999";
     #0#8  = 2;
     #0#9  = "z";
     #0#10 = 99;
     #0#11 = 2;
|FRUT;

|PROCESO TipoCaptura;
     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = enPeriodo;
     #8#3 = enModelo;
     #8#4 = enComplem;
     #8#5 = enActividad;
     |LEE 101#8=;
     |SI FSalida = 0;
          aTipoCaptura = #8#7;
          |QBF aTipoCaptura;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROGRAMA;
     eaNoVisu = "";
     eaNomDef = "dsmoc216";
     fDd      = "01.01.0000";
     fHd      = "31.12.2999";

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
          |HAZ PintaDatos;
          |ENTLINEAL #1#0, -12, 4, 22, 1, ClaveBaja0, ClaveAlta0;
          |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              ||Baja del Modelo
         |HAZ BorraRegistros;
         |ABRE #0;
         |HAZ GrabaTodo;
         |CIERRA #0;
         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo desde Modulo////////

     |SI enTipoEntrada = 97;              ||Baja del Modelo
         |HAZ BorraRegistros;
         |ACABA;
     |FINSI;

|| \\\\\\ Alta o Modificacion del Modelo ////////

     |SI enTipoEntrada = 1;              || Alta del Modelo
         |CABEZA "Modelo Trabajo 216";
         |HAZ AltaModelo;
         |ACABA;
     |FINSI;

|| \\\\\\ Grabacion del Modelo desde el Exterior

     |SI enTipoEntrada = 98;
         |ABRE #0;
         |HAZ GrabaTodo;
         |CIERRA #0;
         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #0;
         #0#0  = enEmpresa;
         #0#1  = enEjer;
         #0#2  = enPeriodo;
         #0#3  = enModelo;
         #0#4  = enComplem;
         #0#5  = enActividad;
         #0#6  = "            ";
         #0#7  = "01.01.0000";
         #0#8  = 1;
         #0#9  = " ";
         #0#10 = 0;
         #0#11 = 0;
         |LEE 000#0];
         |SI FSalida ! 0;  |O #0#0 ! enEmpresa;  |O #0#1 ! enEjer; |O #0#2 ! enPeriodo;
         |O #0#3 ! enModelo;  |O #0#4 ! enComplem; |O #0#5 ! enActividad;
             enExistencia = 1;
         |FINSI;
         |CIERRA #0;
     |FINSI;
|FPRO;
