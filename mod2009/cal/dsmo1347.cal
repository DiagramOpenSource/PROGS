|FICHEROS;
     dsmo1347 #1;
     dsmo2347 #2;
     dsmo3347 #3;
     dsmom004 #4;
|FIN;

|VARIABLES;
     nSwChequea = 0;
     nSuma      = 0;
     nBorra     = 0;
     nTopeA     = 0;
     nTopeB     = 0;
     nTopeC     = 0;
     nTopeD     = 0;
     nTopeE     = 0;
     nCampo     = 0;
     nComp      = 0;

{-1} aMenu   = "";
     aMenu1  = "1057";
     aMenu2  = "1";
     aMenu3  = "9";
     aMenu4  = "A (Compras)         ";
     aMenu5  = "B (Ventas)          ";
     aMenu6  = "C (Cobros Ctas.Ter.)";
     aMenu7  = "D (Adq.Bienes y Ser)";
     aMenu8  = "E (Subvenciones)    ";
     aMenu9  = "F (Ventas Agencias) ";
     aMenu10 = "G (Compras Agencias)";
     aMenu11 = "Arrendamientos      ";
     aMenu12 = "Cabecera Manual     ";
|FIN;

|INCLUYE i_variar;

|RUTINA ClaveBaja2;
     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = #1#2;
     #2#3 = #1#3;
     #2#4 = #1#4;
     #2#5 = #1#5;
     #2#6 = eaClave347;
     #2#7 = "            ";
     #2#8 = "N";
     #2#9 = "N";
|FRUT;

|RUTINA ClaveAlta2;
     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = #1#2;
     #2#3 = #1#3;
     #2#4 = #1#4;
     #2#5 = #1#5;
     #2#6 = eaClave347;
     #2#7 = "zzzzzzzzzzzz";
     #2#8 = "S";
     #2#9 = "S";
|FRUT;

|PROCESO Lineal1;
     |PINPA #0#2;
     |HAZ PintaClave;

     |SI enTipoEntrada = 4;
         |ENTLINEAL #1#2, -8, 4, 22, 0, ClaveBaja2, ClaveAlta2;
     |SINO;
         |ENTLINEAL #1#2, -8, 2, 22, 0, ClaveBaja2, ClaveAlta2;
     |FINSI;
|FPRC;

|RUTINA ClaveBaja3;
     #3#0 = #1#0;
     #3#1 = #1#1;
     #3#2 = #1#2;
     #3#3 = #1#3;
     #3#4 = #1#4;
     #3#5 = 01;
     #3#6 = 01;
|FRUT;

|RUTINA ClaveAlta3;
     #3#0 = #1#0;
     #3#1 = #1#1;
     #3#2 = #1#2;
     #3#3 = #1#3;
     #3#4 = #1#4;
     #3#5 = 99;
     #3#6 = 99;
|FRUT;

|PROCESO Lineal2;
     |PINPA #0#3;
     |HAZ PintaClave2;

     |SI enTipoEntrada = 4;
         |ENTLINEAL #1#3, -6, 4, 22, 0, ClaveBaja3, ClaveAlta3;
     |SINO;
         |ENTLINEAL #1#3, -6, 2, 22, 0, ClaveBaja3, ClaveAlta3;
     |FINSI;
|FPRC;

|PROCESO Recalcula2;
     |SI nBorra = 1;
         |BORRA 020#2a;
         |LIBERA #2;
         |ACABA;
     |FINSI;

     |SI nSwChequea = 0;
         nSwChequea = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI #2#6 = "A";  |Y #2#12 < nTopeA;
         |BORRA 020#2a;
         |LIBERA #2;
         |ACABA;
     |FINSI;

     |SI #2#6 = "B";  |Y #2#12 < nTopeB;
         |BORRA 020#2a;
         |LIBERA #2;
         |ACABA;
     |FINSI;

     |SI #2#6 = "C";  |Y #2#12 < nTopeC;
         |BORRA 020#2a;
         |LIBERA #2;
         |ACABA;
     |FINSI;

     |SI #2#6 = "D";  |Y #2#12 < nTopeD;
         |BORRA 020#2a;
         |LIBERA #2;
         |ACABA;
     |FINSI;

     |SI #2#6 = "E";  |Y #2#12 < nTopeE;
         |BORRA 020#2a;
         |LIBERA #2;
         |ACABA;
     |FINSI;

     |SI #2#6 = "B";  |Y #2#9 = "S";
         |BORRA 020#2a;
         |LIBERA #2;
         |ACABA;
     |FINSI;

     |HAZ Tipo2mo2347;
|FPRC;

|DEFBUCLE dsmoc2347;
     #2#1;
     ;
     #1#0, #1#1, #1#2, #1#3, #1#4, #1#5, " ", "            ", "N", "N";
     #1#0, #1#1, #1#2, #1#3, #1#4, #1#5, "z", "zzzzzzzzzzzz", "S", "S";
     be;
     NULL, Recalcula2;
|FIN;

|PROCESO Recalcula3;
     |SI nBorra = 1;
         |BORRA 020#3a;
         |LIBERA #3;
         |ACABA;
     |FINSI;

     |SI nSwChequea = 0;
         nSwChequea = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI #3#10 = 0;
         |BORRA 020#3a;
         |LIBERA #3;
         |ACABA;
     |FINSI;

     #1#16 = #1#16 + 1;
     #1#17 = #1#17 + #3#10;

     |ABRE #2;
     #2#0 = #3#0;
     #2#1 = #3#1;
     #2#2 = #3#2;
     #2#3 = #3#3;
     #2#4 = #3#4;
     #2#5 = 0;
     #2#6 = "B";
     #2#7 = #3#7;
     #2#8 = "N";
     #2#9 = "S";
     |LEE 101#2=;
     |SI FSalida ! 0;
         |DDEFECTO #2;
         #2#0  = #3#0;
         #2#1  = #3#1;
         #2#2  = #3#2;
         #2#3  = #3#3;
         #2#4  = #3#4;
         #2#5  = 0;
         #2#6  = "B";
         #2#7  = #3#7;
         #2#8  = "N";
         #2#9  = "S";
         #2#10 = #3#11;
         #2#11 = #3#8;
         #2#12 = #3#10;
         |GRABA 020#2n;

         #1#8  = #1#8  + 1;
         #1#9  = #1#9  + #3#10;
     |SINO;
         #2#12 = #2#12 + #3#10;
         |GRABA 020#2a;

         #1#9  = #1#9  + #3#10;
     |FINSI;
     |LIBERA #2;
     |CIERRA #2;
|FPRC;

|DEFBUCLE dsmoc3347;
     #3#1;
     ;
     #1#0, #1#1, #1#2, #1#3, #1#4, 01, 01;
     #1#0, #1#1, #1#2, #1#3, #1#4, 99, 99;
     be;
     NULL, Recalcula3;
|FIN;

|PROCESO Recalculo;
         nSwChequea = 0;  |BUCLE dsmoc2347;
     |SI nSwChequea = 0;  |BUCLE dsmoc3347;  |FINSI;

     |SI nSwChequea = 0;  |ACABA;  |FINSI;

     |PDEFECTO #1, 6,  18;
     |PDEFECTO #1, 20, 24;

     |BUCLE dsmoc2347;
     |BUCLE dsmoc3347;
|FPRC;

|PROCESO Manual;
         nSwChequea = 0;  |BUCLE dsmoc2347;
     |SI nSwChequea = 0;  |BUCLE dsmoc3347;  |FINSI;

     |SI nSwChequea ! 0;
         |MENAV "     No puedo dejar entrada manual, ya que hay lineas introducidas.";
         |ACABA;
     |FINSI;

     |C_M #1#6,  1, "S";  |C_M #1#7,  1, "S";
     |C_M #1#8,  1, "S";  |C_M #1#9,  1, "S";
     |C_M #1#10, 1, "S";  |C_M #1#11, 1, "S";
     |C_M #1#12, 1, "S";  |C_M #1#13, 1, "S";
     |C_M #1#14, 1, "S";  |C_M #1#15, 1, "S";
     |C_M #1#16, 1, "S";  |C_M #1#17, 1, "S";
     |C_M #1#20, 1, "S";  |C_M #1#21, 1, "S";
     |C_M #1#22, 1, "S";  |C_M #1#23, 1, "S";

     |ENDATOS #1#1;

     |C_M #1#6,  1, "N";  |C_M #1#7,  1, "N";
     |C_M #1#8,  1, "N";  |C_M #1#9,  1, "N";
     |C_M #1#10, 1, "N";  |C_M #1#11, 1, "N";
     |C_M #1#12, 1, "N";  |C_M #1#13, 1, "N";
     |C_M #1#14, 1, "N";  |C_M #1#15, 1, "N";
     |C_M #1#16, 1, "N";  |C_M #1#17, 1, "N";
     |C_M #1#20, 1, "N";  |C_M #1#21, 1, "N";
     |C_M #1#22, 1, "N";  |C_M #1#23, 1, "N";
|FPRC;

|PROCESO Menug;
     |PARA; |SI; |HACIENDO;
            |PUSHV 0501 2380;
            |MENUG aMenu;
            aMenu2 = FSalida;
            |SI aMenu2 ] "1"; |Y aMenu2 [ "9";
                |SI aMenu2 = 1; eaClave347 = "A";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 2; eaClave347 = "B";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 3; eaClave347 = "C";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 4; eaClave347 = "D";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 5; eaClave347 = "E";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 6; eaClave347 = "F";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 7; eaClave347 = "G";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 8;                       |HAZ Lineal2;    |FINSI;
                |SI aMenu2 = 9; |Y enTipoEntrada ! 4; |HAZ Manual;     |FINSI;
                |HAZ Recalculo;
            |SINO;
                |POPV;
                |SAL;
            |FINSI;
            |POPV;
            |PINDA #0#1;
     |SIGUE;
     |PINDA #0#1;
|FPRC;

|PROCESO Traedsmoc2347;
     #2#4 = #1#4;
     |GRABA 020#2n;
     |LIBERA #2;
|FPRC;

|DEFBUCLE dsmoc2347T;
     #2#1;
     ;
     #1#0, #1#1, #1#2, #1#3, nComp, #1#5, " ", "            ", "N", "N";
     #1#0, #1#1, #1#2, #1#3, nComp, #1#5, "z", "zzzzzzzzzzzz", "S", "S";
     be;
     NULL, Traedsmoc2347;
|FIN;

|PROCESO Traedsmoc3347;
     #3#4 = #1#4;
     |GRABA 020#3n;
     |LIBERA #3;
|FPRC;

|DEFBUCLE dsmoc3347T;
     #3#1;
     ;
     #1#0, #1#1, #1#2, #1#3, nComp, 01, 01;
     #1#0, #1#1, #1#2, #1#3, nComp, 99, 99;
     be;
     NULL, Traedsmoc3347;
|FIN;

|PROCESO Justificante;
     |SI #1#4 = 0;  |ACABA;  |FINSI;

     |SI #1#19 ! "C";  |Y #1#19 ! "S";
         |MENAV "      Introduzca Complementaria o Sustitutoria";
         |ERROR;
     |FINSI;

     |C_M #1#18, 1, "N";
     |SI #1#19 = "S";
         |C_M #1#18, 1, "S";

         |SI #1#18 = "             ";
             |ABRE #4;
             #4#0 = #1#0;
             #4#1 = #1#1;
             #4#2 = #1#2;
             #4#3 = #1#3;
             #4#4 = #1#4 - 1;
             |LEE 000#4=;
             |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
             |CIERRA #4;

             #1#18 = #4#19;  |PINTA #1#18;
         |FINSI;
     |SINO;
         #1#18 = "";  |PINTA #1#18;
     |FINSI;

     |SI #1#19 = "S";
         nSuma = 0;
         |PARA nCampo = 6;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               nSuma = nSuma + #1nCampo;
         |SIGUE;

         |SI nSuma = 0;
             nComp = #1#4 - 1;
             |BUCLE dsmoc2347T;
             |BUCLE dsmoc3347T;

             |HAZ Recalculo;

             |PINPA #0#1;
             |PINDA #0#1;
             |HAZ PintaDatos;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo12moc1347;  |TIPO 12;
|FPRC;

|PROGRAMA;
     |HAZ LeeEURODBMOD;

     eaNomDef    = "dsmo1347";
     enResultado = 0;

     |SI EURODBMOD ! 0;
         nTopeA  = 3005.06;
         nTopeB  = 3005.06;
         nTopeC  = 300.51;
         nTopeD  = 3005.06;
         nTopeE  = 3005.06;
     |SINO;
         nTopeA  = 500000;
         nTopeB  = 500000;
         nTopeC  = 50000;
         nTopeD  = 50000;
         nTopeE  = 50000;
     |FINSI;

|| \\\\\\ Alta del Modelo ////////

     |SI enTipoEntrada = 1;              || Consulta del Modelo
         |CABEZA "Modelo 347";
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enPeriodo;
         #1#3 = enModelo;
         #1#4 = enComplem;
         #1#5 = enActividad;
         |LEE 040#1=;
         |SI FSalida ! 0;
             |DDEFECTO #1;
             #1#0 = enEmpresa;
             #1#1 = enEjer;
             #1#2 = enPeriodo;
             #1#3 = enModelo;
             #1#4 = enComplem;
             #1#5 = enActividad;
             |GRABA 020#1b;
         |FINSI;

         |PINPA #0#1;
         |PINDA #0#1;
         |HAZ PintaDatos;

         |SI #1#4 ! 0;
             |C_M #1#19, 1, "S";
             |ENDATOS #1#1;
         |FINSI;

         |HAZ Menug;

         nSuma = #1#6  + #1#7  + #1#8  + #1#9  + #1#10 + #1#11 + #1#12 + #1#13;
         nSuma = nSuma + #1#14 + #1#15 + #1#16 + #1#17 + #1#20 + #1#21 + #1#22 + #1#23;

         |SI nSuma = 0;
             |BORRA 020#1a;
             enEntrada = 0;
         |SINO;
             |GRABA 020#1a;
             enEntrada = 1;
         |FINSI;
         |LIBERA #1;
         |CIERRA #1;

         |ACABA;
     |FINSI;

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
         |CABEZA "Modelo 347";
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enPeriodo;
         #1#3 = enModelo;
         #1#4 = enComplem;
         #1#5 = enActividad;
         |LEE 040#1=;
         |SI FSalida ! 0;
             |MENAV "      No existe Registro.";
             |CIERRA #1;
             |ACABA;
         |FINSI;

         |PINPA #0#1;
         |PINDA #0#1;
         |HAZ PintaDatos;

         |HAZ Menug;

         |CIERRA #1;

         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              || Baja del Modelo
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enPeriodo;
         #1#3 = enModelo;
         #1#4 = enComplem;
         #1#5 = enActividad;
         |LEE 040#1=;
         |SI FSalida ! 0;
             |SI enMensa = 0;
                 |MENAV "      No existe Registro.";
             |FINSI;
             |CIERRA #1;
             |ACABA;
         |FINSI;

         nBorra = 1;  |BUCLE dsmoc2347;
                      |BUCLE dsmoc3347;
         nBorra = 0;

         |BORRA 020#1a;
         |LIBERA #1;

         |CIERRA #1;

         |ACABA;
     |FINSI;

|| \\\\\\ Alta desde el Pase del Modelo

     |SI enTipoEntrada = 98;
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enPeriodo;
         #1#3 = enModelo;
         #1#4 = enComplem;
         #1#5 = enActividad;
         |LEE 040#1=;
         |SI FSalida ! 0;
             #1#0 = enEmpresa;
             #1#1 = enEjer;
             #1#2 = enPeriodo;
             #1#3 = enModelo;
             #1#4 = enComplem;
             #1#5 = enActividad;
             |GRABA 020#1b;
         |FINSI;

         |HAZ Recalculo;
         |GRABA 020#1a;

         |LIBERA #1;
         |CIERRA #1;

         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enPeriodo;
         #1#3 = enModelo;
         #1#4 = enComplem;
         #1#5 = enActividad;
         |LEE 040#1=;
         |SI FSalida ! 0;  enExistencia = 1;  |FINSI;
         |CIERRA #1;

         |SI enActividad = 0;  enResultado = 0;  |FINSI;
     |FINSI;
|FPRO;
