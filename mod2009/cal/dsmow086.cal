|FICHEROS;
     dsmozp81 #0;

     dsmom029 #29;
     dsmow086 #82,MANTE;
     :/basica/def/agifigen #1000;
     :/basica/def/agicen14 #1014;
     reflejo@ #182;
|FIN;

|VARIABLES;
     nNume1      = 0;
     nNume2      = 0;
     &nAny       = 0;
     &aTipoPr    = "";
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aAlfa3      = "";
     nEjer         = 0;
     nEjerCalculo  = 0;
     nEjerAntes    = 0;

     fFecIni   = @;
     fFecFin   = @;
     nInkey    = 0;
     esalta    = 0;
     esaltaL   = 0;
     nSwSal    = 0;

     &nSwOpm81   = 0;
     &nSwOpe83   = 0;
     &nSwOpe84   = 0;
     &aGrupoSuma = "";
     nTP100      = 0;
     &aDGrupo    = "";
     &aHGrupo    = "";
     aBlanc      = "";

     &aEl50      = "";
     &aEl15      = "";

     &aFichw82   = "";
     &nSwLinea   = 0;
     &eaCam1     = "";
     &eaCam2     = "";
     &eaCam3     = "";
     &enCam4     = 0;
     &eaCa4      = "";
     &eaCam8     = "";
     &enCam10    = 0;
     &enCam11    = 0;
     &enCam12    = 0;
     &enCam13    = 0;
     &eaCam15    = "";

     aBase = "";
     aDef  = "";
     nDEmp = 0;
     nHEmp = 0;
     nDAct = 0;
     nHAct = 0;
     informe = "";
     inform1 = "dsmow082";
     inform2 = "dsmow084";

     nIva3 = 0;
     nIva5 = 0;
     nIva8 = 0;
|FIN;

|INCLUYE i_variar;

**************************************************************************
|PROCESO CambioLit;
     |SI nNume1 ! 0;
         nNume1 = nNume1 * 100;
         aAlfa1 = nNume1; |QBF aAlfa1;

         aAlfa2 = aAlfa1 % 0;
         nNume2 = aAlfa2;
         nNume2 = nNume2 - 2;

         aAlfa2 = aAlfa1 % -102;
         |SI nNume2 > 0;
             nNume2 = nNume2 + 100;
             aAlfa3 = aAlfa1 % nNume2;
         |SINO;
             aAlfa3 = "0";
         |FINSI;

         aAlfa1 = aAlfa3 + "." + aAlfa2;
         aAlfa1 = ("      " + aAlfa1) % -106;
     |SINO;
         aAlfa1 = "  0.00";
     |FINSI;
|FPRC;

|PROCESO ElCam6;
     nNume1 = aEl50;
     |HAZ CambioLit;
     aEl50 = aAlfa1;
     nNume1 = aEl15;
     |HAZ CambioLit;
     aEl15 = aAlfa1;
|FPRC;


|CALCULO Siesgeneral; |TIPO 0;
 |SI #82#3 = "G";
     |C_M #82#4,1,"S";
 |SINO;
     |C_M #82#4,1,"N";
 |FINSI;
|FCAL;

|PROCESO MTipo5;
|FPRC;

|PROCESO PintaCab;
        aBlanc = " " * 79;
        |PINTA 0601, aBlanc;
        |PINTA 0701, aBlanc;
        |PINTA 0801, aBlanc;
        |PINTA 0702, "Empresa: "; |PINTA 0711, #82#1;
        |C_A #82#2,1,80; |PINTA 0717, #82#2; |C_A #82#2,1,19;
        |PINTA 0759, "NIF: "; |PINTA 0764, #82#15;
|FPRC;

|CALCULO Modifica; |TIPO 11;
    nInkey    = FSalida;

    enEmpresa = #82#1;
    nAny      = #0#0;
    |SI nInkey <10; |O nInkey > 16;
        |ACABA;
    |FINSI;

    |PUSHV 0501 2380;
    |LEE 001#82=;

    |SI nInkey = 10; || (F2)
        |HAZ PintaCab;
        enModo    = 4;
        |SUB_EJECUTA_NP ":basica/agicen14";
    |FINSI;

    |SI nInkey = 11; || (F3)

        || nSwSal = 0;
        || |PINPA #0#84;
        || ENTLINEAL #1#84, -3, 4, 20, 0, ClaveBajaL, ClaveAltaL;
    |FINSI;

    |SI nInkey = 12; |O nInkey = 13;      || (F4 / F5)
        || |HAZ PintaCab;
        || |HAZ ConsultaGE;
    |FINSI;
    |POPV;

    |SI nInkey = 14;

        |LEE 001#82=;
        |SI #82#8 = "S";
            #82#8 = "N";
        |SINO;
            #82#8 = "S";
        |FINSI;
        |PINTA #82#8;
        |GRABA 020#82a;

    |FINSI;

    |SI nInkey = 15; |O nInkey = 16;      || (F6/F7)
        || |HAZ Imprimir;
    |FINSI;

    |ERROR;
|FCAL;

|CALCULO VerActividad;  |TIPO 7;
|FCAL;

/*
|CALCULO VerSector;  |TIPO 7;
    nSwSal = 1;
    |ENTLINEAL #3#83, -4, 7, 20, 0, ClaveBajaL83, ClaveAltaL83;
|FCAL;

|CALCULO Verw83; |TIPO 11;
    |SI FSalida = 10;
        nSwSal = 0;
        |ENTLINEAL #3#83, -4, 4, 20, 0, ClaveBajaL83, ClaveAltaL83;
    |FINSI;
|FCAL;
*/

|| ************************************************************************
|CALCULO SalgoYa;  |TIPO 7;
     |SI nSwSal = 1;  |PTEC 807;  |FINSI;
|FCAL;

|| ************************************************************************
/*
|PROCESO LeoInfw83;
 |SI eaCa4 = ""; eaCa4 = #83#13; |FINSI;
 |PRINT;
|FPRC;

|DEFBUCLE LeoInfw83;
 #83#1;
 16;
 #0#0, enEmpresa, 01, #84#2;
 #0#0, enEmpresa, 99, #84#2;
 ;
 NULL, LeoInfw83;
|FIN;

|PROCESO LeoInfw84;
 eaCa4 = "";
 nSwLinea = 0;
 |BUCLE LeoInfw83;
 nSwLinea = 1;
 |PRINT;
|FPRC;

|DEFBUCLE LeoInfw84;
 #84#1;
 ;
 #0#0, enEmpresa, " ";
 #0#0, enEmpresa, "z";
 ;
 NULL, LeoInfw84;
|FIN;

|PROCESO LeoReflejo;

 enEmpresa = #182#1;
 nSwLinea  = 0;
 eaCam1    = #182#1; |QBF eaCam1;
 eaCam1    = ("00000" + eaCam1) % -105;
 eaCam2    = #182#2;
 eaCam3    = #182#3;
 enCam4    = #182#4;
 eaCam8    = "NO";
 |SI #182#8 = "S";
     eaCam8 = "SI";
 |FINSI;
 enCam10   = #182#10;
 enCam11   = #182#11;
 enCam12   = #182#12;
 enCam13   = #182#13;
 eaCam15   = #182#15;

 |SI nInkey = 16;
     |BUCLE LeoInfw84;
 |SINO;
     |PRINT;
 |FINSI;
|FPRC;

|DEFBUCLE LeoReflejo;
 #182#1002;
 ;
 #0#0, nDEmp;
 #0#0, nHEmp;
 ;
 NULL, LeoReflejo;
|FIN;

|PROCESO Imprimir;

   |DBASE aBase;  |QBT aBase;
   aDef = aBase + "def/dsmow082.mas";
   |CARGA_DEF aDef, reflejo@;
   |SI FSalida ! 0;
       aAlfa = "     Error en cargar el Def dsmow082";
       |MENAV aAlfa;
       |ACABA;
   |FINSI;
   |NOME_DAT #182 aFichw82;

   |IMPRE 0;
   |SI FSalida ! 0;
       |DESCARGA_DEF #reflejo@;
       |ACABA;
   |FINSI;

   informe = inform1;
   nDEmp   = 1;
   nHEmp   = 99999;
   |SI nInkey = 16;
       informe = inform2;
       nDEmp   = enEmpresa;
       nHEmp   = enEmpresa;
   |FINSI;

   |INFOR informe;
   |SI FSalida ! 0;
       |FINIMP;
       |DESCARGA_DEF #reflejo@;
       |ACABA;
   |FINSI;

   |BUCLE LeoReflejo;

   |PIEINF;
   |FININF;
   |FINIMP;
   |DESCARGA_DEF #reflejo@;
|FPRC;

|| ***********************************************************************
|PROCESO BorroProv81;

 |ABRE #81;
 #81#0 = #83#1;
 #81#1 = #83#0;
 #81#2 = #83#2;
 |LEE 101#81=;
 |SI FSalida = 0;
     |BORRA 020#81a;
 |FINSI;
 |LIBERA #81;
 |CIERRA #81;

  |ABRE #29;
  #29#0 = enEmpresa;
  #29#1 = nAny;
  #29#2 = 12;
  #29#9 = #81#2;
  |LEE 001#29=;
  |SI FSalida = 0;
      |BORRA 020#29a;
  |FINSI;
  |CIERRA #29;
|FPRC;

|DEFBUCLE BorroProv81;
 #83#1;
 ;
 #82#0, #82#1, 01;
 #82#0, #82#1, 99;
 ;
 NULL, BorroProv81;
|FIN;

|PROCESO GraboProv81;

 |ABRE #81;
 #81#0 = #83#1;
 #81#1 = #83#0;
 #81#2 = #83#2;
 |LEE 101#81=;
 |SI FSalida ! 0;
     |DDEFECTO #81;
     #81#0 = #83#1;
     #81#1 = #83#0;
     #81#2 = #83#2;
     #81#3 = #83#3;
     #81#4 = #83#4;
     #81#5 = 100;
     |GRABA 020#81b;
 |FINSI;

     #81#6  = #83#9;
     #81#7  = #83#6;
     #81#8  = #83#7;
     #81#10 = #83#15;
     #81#11 = #83#17;
     #81#12 = #83#28;
     #81#13 = #83#18;
     #81#14 = #81#11 - #81#13;
     #81#9  = #81#7 + #81#8 + #81#10 + #81#41;

     enActividad = #81#2;
     |HAZ Registro29;

 |GRABA 020#81a;
 |LIBERA #81;
 |CIERRA #81;
|FPRC;

|DEFBUCLE GraboProv81;
 #83#1;
 ;
 #82#0, #82#1, 01;
 #82#0, #82#1, 99;
 ;
 NULL, GraboProv81;
|FIN;

|PROCESO Baja81;
 #81#0 = enEmpresa;
 #81#1 = nAny;
 #81#2 = 01;
|FPRC;

|PROCESO Alta81;
 #81#0 = enEmpresa;
 #81#1 = nAny;
 #81#2 = 99;
|FPRC;

|PROCESO Baja29;
 #29#0 = enEmpresa;
 #29#1 = #0#0;
 #29#2 = 01;
 #29#9 = nDAct;
|FPRC;

|PROCESO Alta29;
 #29#0 = enEmpresa;
 #29#1 = #0#0;
 #29#2 = 99;
 #29#9 = nHAct;
|FPRC;

|PROCESO Verel29; |TIPO 7;
    nDAct = #81#2;
    nHAct = #81#2;
    |ENTLINEAL #2#29, -4, 7, 20, 0, Baja29, Alta29;
|FPRC;

|PROCESO Entrarel29; |TIPO 11;
  |SI FSalida = 10;
      nDAct = #81#2;
      nHAct = #81#2;
      |ENTLINEAL #2#29, -4, 4, 20, 0, Baja29, Alta29;
  |FINSI;
|FPRC;

|PROCESO ConsultaGE;

 |SI nInkey = 12;
      |ABRE #80;
      #80#0 = enEmpresa;
      #80#1 = #0#0;
      |LEE 001#80=;
      |SI FSalida ! 0;
          |DDEFECTO #80;
          #80#0 = enEmpresa;
          #80#1 = #0#0;
      |FINSI;
      #80#4 = #82#3;  || Definitivo
      #80#5 = #82#4;  || definitivo
      #80#6 = #82#5;
      #80#7 = #82#6;
      #80#9 = #82#9;
      #80#10 = #82#10;  || Iva Soportado
      #80#11 = #82#13;  || Iva Subvencion
      #80#12 = #82#11;  || Iva Deducido
      #80#13 = #82#12;  || Diferencia
      #80#8 = #80#6 + #80#7 + #80#8 + #80#43;
      enActividad = 0;
      |HAZ Registro29;

      |PINPA #0#80;
      |PINDA #0#80;
      |ENTLINEAL #2#29, -4, 4, 20, 0, Baja29, Alta29;

      |ABRE #29;
      #29#0 = enEmpresa;
      #29#1 = nAny;
      #29#2 = 12;
      #29#9 = 0;
      |LEE 001#29=;
      |SI FSalida = 0;
          |BORRA 020#29a;
      |FINSI;
      |CIERRA #29;
 |FINSI;

 |SI nInkey = 13;
     |SI #82#4 = "E";
         |BUCLE GraboProv81;
         |C_P #29#2, 1, 1514; |C_P #29#3, 1, 1526;
         |C_P #29#4, 1, 1538; |C_P #29#5, 1, 1557;
         |C_P #29#6, 1, 1569; |C_P #29#7, 1, 1517; |C_A #29#7,1,8;
         |C_P #29#8, 1, 1545;

         |PINPA #0#81;
         |ENTLINEAL #1#81, -3, 4, 22, 0, Baja81, Alta81;
         |C_P #29#2, 1, 1503; |C_P #29#3, 1, 1519;
         |C_P #29#4, 1, 1532; |C_P #29#5, 1, 1554;
         |C_P #29#6, 1, 1568; |C_P #29#7, 1, 1506; |C_A #29#7,1,80;
         |C_P #29#8, 1, 1540;

         |BUCLE BorroProv81;
     |SINO;
         |MENAV "    NO EXISTE CALCULO DE PRORRATA ESPECIAL";
     |FINSI;

 |FINSI;

|FPRC;

|PROCESO Leem029;
 |SI #29#2 ! 12;
     nIva3 = nIva3 + #29#3;
     nIva5 = nIva5 + #29#5;
     nIva8 = nIva8 + #29#8;
 |FINSI;
|FPRC;

|DEFBUCLE Leem029;
 #29#1;
 ;
 enEmpresa, #0#0, 01, nDAct;
 enEmpresa, #0#0, 99, nHAct;
 ;
 NULL, Leem029;
|FIN;

|PROCESO Registro29;

 nDAct = enActividad;
 nHAct = enActividad;
 nIva3 = 0;
 nIva5 = 0;
 nIva8 = 0;
 |BUCLE Leem029;

 |ABRE #29;
 #29#0 = enEmpresa;
 #29#1 = nAny;
 #29#2 = 12;
 #29#9 = enActividad;
 |LEE 101#29=;
 |SI FSalida ! 0;
     |DDEFECTO #29;
     #29#0 = enEmpresa;
     #29#1 = nAny;
     #29#2 = 12;
     #29#7 = "DICIEMBRE";
     #29#9 = enActividad;
     |GRABA 020#29b;
 |FINSI;
 |SI enActividad = 0;
     #29#3 = #82#10 - nIva3;
     #29#4 = #82#4;
     #29#5 = #82#11 - nIva5;
     #29#8 = #82#13 - nIva8;
     #29#6 = #29#3 - #29#5;
 |SINO;
     #29#3 = #83#17 - nIva3;
     #29#4 = #83#9;
     #29#5 = #83#18 - nIva5;
     #29#8 = #83#28 - nIva8;
     #29#6 = #29#3 - #29#5;
 |FINSI;
 |GRABA 020#29a;
 |LIBERA #29;
 |CIERRA #29;
|FPRC;
*/
