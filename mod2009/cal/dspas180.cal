|FICHEROS;
     dsmozpas #0;
     dsmom004 #4;
     dsmom008 #8;
     dsm180li #2;
     dsmoc115 #115;

     &regisnif@ #709;
     dsmow013 #999,MANTE;
|FIN;

|VARIABLES;
     nSwHay       = 0;
     nSumaBaseDin = 0;
     nSumaBaseEsp = 0;
     nSumaReteDin = 0;
     nSumaReteEsp = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO GrabaPerceptor180;
     |SI #115#6 = "PASEANTERIOR";  |ACABA;  |FINSI;

     nSumaBaseDin = (#115#8  + #115#14 + #115#20) ! 2;
     nSumaBaseEsp = (#115#11 + #115#17 + #115#23) ! 2;
     nSumaReteDin = (#115#10 + #115#16 + #115#22) ! 2;
     nSumaReteEsp = (#115#13 + #115#19 + #115#25) ! 2;

     eaCodNif = #115#6;
     |HAZ LeeNifs;

     |SI nSumaBaseDin ! 0;  |O nSumaReteDin ! 0;
         #2#0 = #115#0;
         #2#1 = #115#1;
         #2#2 = 99;
         #2#3 = 180;
         #2#4 = enComplem;
         #2#5 = 0;
         #2#6 = #115#6;
         #2#7 = 1;
         #2#8 = #115#7;
         |LEE 101#2=;
         |SI FSalida ! 0;
             |DDEFECTO #2;
             #2#0  = #115#0;
             #2#1  = #115#1;
             #2#2  = 99;
             #2#3  = 180;
             #2#4  = enComplem;
             #2#5  = 0;
             #2#6  = #115#6;
             #2#7  = 1;
             #2#8  = #115#7;
             #2#14 = #709#4;
             |GRABA 020#2b;
         |FINSI;
         #2#10 = #115#26;
         #2#11 = #2#11 + nSumaBaseDin;
         #2#13 = #2#13 + nSumaReteDin;
         #2#12 = (#2#13 * 100) / #2#11;
         |GRABA 020#2a;
         |LIBERA #2;
         nSwHay = 1;
     |FINSI;

     |SI nSumaBaseEsp ! 0;  |O nSumaReteEsp ! 0;
         #2#0 = #115#0;
         #2#1 = #115#1;
         #2#2 = 99;
         #2#3 = 180;
         #2#4 = enComplem;
         #2#5 = 0;
         #2#6 = #115#6;
         #2#7 = 2;
         #2#8 = #115#7;
         |LEE 101#2=;
         |SI FSalida ! 0;
             |DDEFECTO #2;
             #2#0  = #115#0;
             #2#1  = #115#1;
             #2#2  = 99;
             #2#3  = 180;
             #2#4  = enComplem;
             #2#5  = 0;
             #2#6  = #115#6;
             #2#7  = 2;
             #2#8  = #115#7;
             #2#14 = #709#4;
             |GRABA 020#2b;
         |FINSI;
         #2#10 = #115#26;
         #2#11 = #2#11 + nSumaBaseEsp;
         #2#13 = #2#13 + nSumaReteEsp;
         #2#12 = (#2#13 * 100) / #2#11;
         |GRABA 020#2a;
         |LIBERA #2;
         nSwHay = 1;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc115;
     #115#1;
     ;
     #999#0, #999#2, 00, 115, 00, 01, "            ", 0000;
     #999#0, #999#2, 99, 115, 99, 99, "zzzzzzzzzzzz", 9999;
     ;
     NULL, GrabaPerceptor180;
|FIN;

|PROCESO Pase180;
     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = #999#9;
     |LEE 040#4=;
     |SI FSalida ! 0;  |CIERRA #4; |ACABA;   |FINSI;
     |CIERRA #4;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #4#4;
     enActividad   = 0;
     enTipoEntrada = 3;
     enMensa       = 1;
     |SUB_EJECUTA_NP "dsm180ca";

     |ABRE #2;
     |BUCLE dsmoc115;
     |CIERRA #2;

     |SI nSwHay = 0;
         |MENAV "      Seleccion Vacia";
         |CONFI "0000NDesea Crear el Modelo sin Actividad ";
         |SI FSalida ! 0;  |ACABA;  |FINSI;
     |FINSI;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #4#4;
     enActividad   = 0;
     enTipoEntrada = 98;
     enMensa       = 1;
     |SUB_EJECUTA_NP "dsm180ca";

     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = #999#9;
     |LEE 101#4=;
     |SI FSalida = 0;
         #4#7  = "X";
         #4#8  = ~;
         #4#15 = 0;
         #4#17 = "COMPLETADO";

         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;
|FPRC;
