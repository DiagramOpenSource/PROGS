|| borrar todo lo que es referente a otros modelos diferentes al 300

|FICHEROS;
     dsmociva #0;
     dsmom007 #7;
     dsmom004 #4;
     dsmom008 #8;
     dsmom027 #27;
     dsmom028 #28;
     dsmom080 #80;
     dsmom081 #81;
     dsmom047 #47;

     dsmom103 #103;
     dsmom109 #109;

     dsmod300 #300;
     dsmod320 #320;
     dsmod330 #330;
     dsmod332 #332;
     dsmod370 #370;

     dsmow002 #99;

     :/basica/def/agicen14 #402;

     dsmocivp #165;
|FIN;

|VARIABLES;
     nCampo68    = 0;
     nCampo1     = 0;
     nCampo2     = 0;
     nCampo3     = 0;
     nCampo11    = 0;
     nCampo22    = 0;
     nCampo33    = 0;
     nValor1     = 0;
     nValor2     = 0;
     nGrupo      = 0;
     nSubGrupo   = 0;
     nPeriodoMin = 0;
     nEjerAnt    = 0;
     nSwAcum     = 0;
     nDesde      = 0;
     nHasta      = 0;
     nContador   = 0;
     nResult     = 0;
     nSwGraba    = 0;
     nAnyo       = 0;
     nPer        = 0;
     nTipo       = 0;
     nPeriodo    = 0;
     nDepar      = 0;
     nEjer       = 0;

     aAlfa       = "";

     &aFitxer300 = "";
     &aFitxer301 = "";
     &enPregunta = 0;

     nCuotaMas = 0;
     nBaseMas = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO BajaModelo;
     |BORRA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE dsmocivaB;
     #0#1;
     ;
     enEmpresa, enEjer, enPeriodo, 000, enComplem, enActividad, 0,  0;
     enEmpresa, enEjer, enPeriodo, 999, enComplem, enActividad, 9, 99;
     be;
     NULL, BajaModelo;
|FIN;


|PROCESO LeeCasilla;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = nGrupo;
     #0#7  = nSubGrupo;
     |LEE 040#0=;
     |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
|FPRC;

|| ///////////////// Procesos Grabacion de Modelos \\\\\\\\\\\\\\\\\\\\

|PROCESO EjerAnt;
      nEjerAnt = nEjerAnt + #103#5;
|FPRC;

|DEFBUCLE dsmom103;
     #103#1;
     ;
     enModelo, enEmpresa, 00, nAnyo, nPer;
     enModelo, enEmpresa, 99, nAnyo, nPer;
     ;
     NULL, EjerAnt;
|FIN;

|PROCESO RecogeAnter;
     nPeriodoMin = 1;
     |SI enModelo = 300; nPeriodoMin = 3;  |FINSI;

     |ABRE #4;
     #4#0 = enEmpresa;
     #4#3 = enModelo;
     #4#4 = enComplem;
     |SI enPeriodo = nPeriodoMin;
         nAnyo = enEjer - 1;
         nPer  = 12;
     |SINO;
         nAnyo = enEjer;
         nPer  = enPeriodo - nPeriodoMin;
     |FINSI;

     #4#0 = enEmpresa;
     #4#1 = nAnyo;
     #4#2 = nPer;
     #4#3 = enModelo;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;

     nEjerAnt = 0;
     |SI #4#15 < 0;
         |SI enPeriodo ! nPeriodoMin;
             nEjerAnt = -#4#15;
         |SINO;
             |HAZ UltimoPeriodo;
             |SI eaUltimoPer = "COMPENSAR";
                 nEjerAnt = -#4#15;
             |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #4;

     |SI nEjerAnt = 0;
         |BUCLE dsmom103;
     |FINSI;

     |SI enModelo = 330;
         #330#0 = enEmpresa;
         #330#1 = #4#1;
         #330#2 = #4#2;
         #330#3 = enModelo;
         #330#4 = enComplem;
         #330#5 = 0;
         |LEE 040#330=;
         |SI FSalida ! 0;  |DDEFECTO #330;  |FINSI;

         nEjerAnt = #330#67;
     |FINSI;

     |SI enModelo = 332;
         #332#0 = enEmpresa;
         #332#1 = #4#1;
         #332#2 = #4#2;
         #332#3 = enModelo;
         #332#4 = enComplem;
         #332#5 = 0;
         |LEE 040#332=;
         |SI FSalida ! 0;  |DDEFECTO #332;  |FINSI;

         nEjerAnt = #332#67;
     |FINSI;

     |ABRE #47;
     #47#0 = enEmpresa;
     #47#1 = enEjer;
     #47#2 = enPeriodo;
     #47#3 = enModelo;
     #47#4 = enComplem;
     #47#5 = 0;
     |LEE 040#47=;
     |SI FSalida ! 0;  |DDEFECTO #47;  |FINSI;
     |CIERRA #47;

     |ABRE #28;
     #28#0 = enEmpresa;
     #28#1 = enEjer;
     #28#2 = enPeriodo;
     #28#3 = enModelo;
     #28#4 = enComplem;
     #28#5 = 0;
     |LEE 040#28=;
     |SI FSalida ! 0;  |DDEFECTO #28;  |FINSI;
     |CIERRA #28;

     |SI #28#7 = "N";  |ACABA;  |FINSI;

     nEjerAnt = nEjerAnt - #28#6;
     |SI nEjerAnt < 0;  nEjerAnt = 0;  |FINSI;
|FPRC;

|| ///////// Modelo 300 \\\\\\\\\\\\

|PROCESO GrabaDevengado300;
     |SI #0nCampo3 = 0;  |ACABA;  |FINSI;
     nSwAcum       = 0;

     |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
           nCampo11 = nCampo33 - 2;
           nCampo22 = nCampo33 - 1;
           |SI #300nCampo22 = #0nCampo2;
               #300nCampo11 = #300nCampo11 + #0nCampo1;
               #300nCampo33 = #300nCampo33 + #0nCampo3;
               nSwAcum = 1;
               |SAL;
            |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
               nCampo11 = nCampo33 - 2;
               nCampo22 = nCampo33 - 1;
               |SI #300nCampo22 = 0;
                   #300nCampo11 = #0nCampo1;
                   #300nCampo22 = #0nCampo2;
                   #300nCampo33 = #0nCampo3;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         nCampo11     = nHasta - 2;
         nCampo22     = nHasta - 1;
         nCampo33     = nHasta;

         #300nCampo11 = #300nCampo11 + #0nCampo1;
         #300nCampo22 = -1;
         #300nCampo33 = #300nCampo33 + #0nCampo3;
     |FINSI;
|FPRC;

|PROCESO GrabaDeducible300;
     |SI nDesde = 34; |Y nHasta = -2;   ||inversion
         nHasta = nDesde + 1;
         #300nDesde = #300nDesde - (#0#14 + #0#17 + #0#20 + #0#23);
         #300nHasta = #300nHasta - (#0#16 + #0#19 + #0#22 + #0#25);
         |ACABA;
     |FINSI;

     |SI nHasta ! -1;
         nHasta = nDesde + 1;
     |FINSI;

     |SI nDesde ! 46;  |Y nDesde ! 48;
         |SI nHasta ! -1;
             #300nDesde = #300nDesde + ((#0#14 + #0#17 + #0#20 + #0#23) % nProrrata) + nBaseMas;
             #300nHasta = #300nHasta + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |SINO;
             #300nDesde = #300nDesde + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |FINSI;
     |SINO;
         #300nDesde = #300nDesde + (#0#14 + #0#17 + #0#20 + #0#23);
         #300nHasta = #300nHasta + (#0#16 + #0#19 + #0#22 + #0#25);
     |FINSI;
|FPRC;

|PROCESO Graba300;
     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 1;  |Y #0#7 [ 4;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 6;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 7;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 8;   nDesde =  8;  nHasta = 14;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 5;   nDesde = 26;  nHasta = 32;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 10;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 11;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 12;  nDesde = 17;  nHasta = 23;  |FINSI;

     |SI nDesde ! 0;
         |PARA nCampo1 = 14;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;  |O #0nCampo3 ! 0;
                   |HAZ GrabaDevengado300;
               |FINSI;
         |SIGUE;
     |FINSI;

     |PARA nCampo1 = 7;  |SI nCampo1 [ 31;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #300nCampo1 = -1;  #300nCampo1 = 0;  |FINSI;
     |SIGUE;

     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 2;  |Y #0#7 = 1;   nDesde = 34;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 2;   nDesde = 36;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 3;   nDesde = 40;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 4;   nDesde = 42;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 5;   nDesde = 46;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 6;   nDesde = 48;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 7;   nDesde = 52;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 9;   nDesde = 54;  nHasta = -1;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 11;  nDesde = 34;  nHasta = -2;  |FINSI;

     |SI nDesde ! 0;
         |HAZ GrabaDeducible300;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 9;
         #300#60 = #300#60 + #0#12;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 1;
         #300#57   = #300#57 + #0#12;
         nContador = nContador + 1;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 2;
         #300#61   = #300#61 + #0#12;
     |FINSI;
|FPRC;

|| ///////// Modelo 320 \\\\\\\\\\\\

|PROCESO GrabaDevengado320;
     |SI #0nCampo3 = 0;  |ACABA;  |FINSI;
     nSwAcum       = 0;

     |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
           nCampo11 = nCampo33 - 2;
           nCampo22 = nCampo33 - 1;
           |SI #320nCampo22 = #0nCampo2;
               #320nCampo11 = #320nCampo11 + #0nCampo1;
               #320nCampo33 = #320nCampo33 + #0nCampo3;
               nSwAcum = 1;
               |SAL;
            |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
               nCampo11 = nCampo33 - 2;
               nCampo22 = nCampo33 - 1;
               |SI #320nCampo22 = 0;
                   #320nCampo11 = #0nCampo1;
                   #320nCampo22 = #0nCampo2;
                   #320nCampo33 = #0nCampo3;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         nCampo11     = nHasta - 2;
         nCampo22     = nHasta - 1;
         nCampo33     = nHasta;

         #320nCampo11 = #320nCampo11 + #0nCampo1;
         #320nCampo22 = -1;
         #320nCampo33 = #320nCampo33 + #0nCampo3;
     |FINSI;
|FPRC;

|PROCESO GrabaDeducible320;
     |SI nDesde = 34; |Y nHasta = -2;   ||inversion
         nHasta = nDesde + 1;
         #320nDesde = #320nDesde - (#0#14 + #0#17 + #0#20 + #0#23);
         #320nHasta = #320nHasta - (#0#16 + #0#19 + #0#22 + #0#25);
         |ACABA;
     |FINSI;

     |SI nHasta ! -1;
         nHasta = nDesde + 1;
     |FINSI;

     |SI nDesde ! 46;  |Y nDesde ! 48;
         |SI nHasta ! -1;
             #320nDesde = #320nDesde + ((#0#14 + #0#17 + #0#20 + #0#23) % nProrrata) + nBaseMas;
             #320nHasta = #320nHasta + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |SINO;
             #320nDesde = #320nDesde + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |FINSI;
     |SINO;
         #320nDesde = #320nDesde + (#0#14 + #0#17 + #0#20 + #0#23);
         #320nHasta = #320nHasta + (#0#16 + #0#19 + #0#22 + #0#25);
     |FINSI;
|FPRC;

|PROCESO Graba320;
     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 1;  |Y #0#7 [ 4;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 6;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 7;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 8;   nDesde =  8;  nHasta = 14;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 5;   nDesde = 26;  nHasta = 32;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 10;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 11;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 12;  nDesde = 17;  nHasta = 23;  |FINSI;

     |SI nDesde ! 0;
         |PARA nCampo1 = 14;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;  |O #0nCampo3 ! 0;
                   |HAZ GrabaDevengado320;
               |FINSI;
         |SIGUE;
     |FINSI;

     |PARA nCampo1 = 7;  |SI nCampo1 [ 31;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #320nCampo1 = -1;  #320nCampo1 = 0;  |FINSI;
     |SIGUE;

     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 2;  |Y #0#7 = 1;   nDesde = 34;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 2;   nDesde = 36;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 3;   nDesde = 40;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 4;   nDesde = 42;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 5;   nDesde = 46;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 6;   nDesde = 48;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 7;   nDesde = 52;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 9;   nDesde = 54;  nHasta = -1;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 11;  nDesde = 34;  nHasta = -2;  |FINSI;

     |SI nDesde ! 0;
         |HAZ GrabaDeducible320;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 9;
         #320#60 = #320#60 + #0#12;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 10;
         #320#61 = #320#61 + #0#12;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 11;
         #320#62 = #320#62 + #0#12;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 1;
         #320#57   = #320#57 + #0#12;
         nContador = nContador + 1;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 2;
         #320#63   = #320#63 + #0#12;
     |FINSI;
|FPRC;

|| ///////// Modelo 330 \\\\\\\\\\\\

|PROCESO GrabaDevengado330;
     |SI #0nCampo3 = 0;  |ACABA;  |FINSI;
     nSwAcum       = 0;

     |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
           nCampo11 = nCampo33 - 2;
           nCampo22 = nCampo33 - 1;
           |SI #330nCampo22 = #0nCampo2;
               #330nCampo11 = #330nCampo11 + #0nCampo1;
               #330nCampo33 = #330nCampo33 + #0nCampo3;
               nSwAcum = 1;
               |SAL;
            |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
               nCampo11 = nCampo33 - 2;
               nCampo22 = nCampo33 - 1;
               |SI #330nCampo22 = 0;
                   #330nCampo11 = #0nCampo1;
                   #330nCampo22 = #0nCampo2;
                   #330nCampo33 = #0nCampo3;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         nCampo11     = nHasta - 2;
         nCampo22     = nHasta - 1;
         nCampo33     = nHasta;

         #330nCampo11 = #330nCampo11 + #0nCampo1;
         #330nCampo22 = -1;
         #330nCampo33 = #330nCampo33 + #0nCampo3;
     |FINSI;
|FPRC;

|PROCESO GrabaDeducible330;
     |SI nDesde = 34; |Y nHasta = -2;   ||inversion
         nHasta = nDesde + 1;
         #330nDesde = #330nDesde - (#0#14 + #0#17 + #0#20 + #0#23);
         #330nHasta = #330nHasta - (#0#16 + #0#19 + #0#22 + #0#25);
         |ACABA;
     |FINSI;

     |SI nHasta ! -1;
         nHasta = nDesde + 1;
     |FINSI;

     |SI nDesde ! 46;  |Y nDesde ! 48;
         |SI nHasta ! -1;
             #330nDesde = #330nDesde + ((#0#14 + #0#17 + #0#20 + #0#23) % nProrrata) + nBaseMas;
             #330nHasta = #330nHasta + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |SINO;
             #330nDesde = #330nDesde + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |FINSI;
     |SINO;
         #330nDesde = #330nDesde + (#0#14 + #0#17 + #0#20 + #0#23);
         #330nHasta = #330nHasta + (#0#16 + #0#19 + #0#22 + #0#25);
     |FINSI;
|FPRC;

|PROCESO Graba330;
     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 1;  |Y #0#7 [ 4;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 6;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 7;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 8;   nDesde =  8;  nHasta = 14;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 5;   nDesde = 26;  nHasta = 32;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 10;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 11;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 12;  nDesde = 17;  nHasta = 23;  |FINSI;

     |SI nDesde ! 0;
         |PARA nCampo1 = 14;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;  |O #0nCampo3 ! 0;
                   |HAZ GrabaDevengado330;
               |FINSI;
         |SIGUE;
     |FINSI;

     |PARA nCampo1 = 7;  |SI nCampo1 [ 31;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #330nCampo1 = -1;  #330nCampo1 = 0;  |FINSI;
     |SIGUE;

     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 2;  |Y #0#7 = 1;   nDesde = 34;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 2;   nDesde = 36;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 3;   nDesde = 40;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 4;   nDesde = 42;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 5;   nDesde = 46;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 6;   nDesde = 48;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 7;   nDesde = 52;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 9;   nDesde = 54;  nHasta = -1;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 11;   nDesde = 34;  nHasta = -2;  |FINSI;

     |SI nDesde ! 0;
         |HAZ GrabaDeducible330;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 9;
         #330#60 = #330#60 + #0#12;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 10;
         #330#61 = #330#61 + #0#12;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 11;
         #330#62 = #330#62 + #0#12;
     |FINSI;

     |SI #0#6 = 4;  |Y #0#7 = 6;
         #330#62 = #330#62 + #0#12;
     |FINSI;

     |SI #0#6 = 4;  |Y #0#7 = 5;
         #330#63 = #330#63 + #0#12;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 1;
         #330#57   = #330#57 + #0#12;
         nContador = nContador + 1;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 2;
         #330#65   = #330#65 + #0#12;
     |FINSI;
|FPRC;

|| ///////// Modelo 332 \\\\\\\\\\\\

|PROCESO GrabaDevengado332;
     |SI #0nCampo3 = 0;  |ACABA;  |FINSI;
     nSwAcum       = 0;

     |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
           nCampo11 = nCampo33 - 2;
           nCampo22 = nCampo33 - 1;
           |SI #332nCampo22 = #0nCampo2;
               #332nCampo11 = #332nCampo11 + #0nCampo1;
               #332nCampo33 = #332nCampo33 + #0nCampo3;
               nSwAcum = 1;
               |SAL;
            |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
               nCampo11 = nCampo33 - 2;
               nCampo22 = nCampo33 - 1;
               |SI #332nCampo22 = 0;
                   #332nCampo11 = #0nCampo1;
                   #332nCampo22 = #0nCampo2;
                   #332nCampo33 = #0nCampo3;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         nCampo11     = nHasta - 2;
         nCampo22     = nHasta - 1;
         nCampo33     = nHasta;

         #332nCampo11 = #332nCampo11 + #0nCampo1;
         #332nCampo22 = -1;
         #332nCampo33 = #332nCampo33 + #0nCampo3;
     |FINSI;
|FPRC;

|PROCESO GrabaDeducible332;
     |SI nDesde = 34; |Y nHasta = -2;   ||inversion
         nHasta = nDesde + 1;
         #332nDesde = #332nDesde - (#0#14 + #0#17 + #0#20 + #0#23);
         #332nHasta = #332nHasta - (#0#16 + #0#19 + #0#22 + #0#25);
         |ACABA;
     |FINSI;

     |SI nHasta ! -1;
         nHasta = nDesde + 1;
     |FINSI;

     |SI nDesde ! 46;  |Y nDesde ! 48;
         |SI nHasta ! -1;
             #332nDesde = #332nDesde + ((#0#14 + #0#17 + #0#20 + #0#23) % nProrrata) + nBaseMas;
             #332nHasta = #332nHasta + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |SINO;
             #332nDesde = #332nDesde + ((#0#16 + #0#19 + #0#22 + #0#25) % nProrrata) + nCuotaMas;
         |FINSI;
     |SINO;
         #332nDesde = #332nDesde + (#0#14 + #0#17 + #0#20 + #0#23);
         #332nHasta = #332nHasta + (#0#16 + #0#19 + #0#22 + #0#25);
     |FINSI;
|FPRC;

|PROCESO Graba332;
     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 1;  |Y #0#7 [ 4;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 6;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 7;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 8;   nDesde =  8;  nHasta = 14;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 5;   nDesde = 26;  nHasta = 32;  |FINSI;

     |SI #0#6 = 1;  |Y #0#7 = 10;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 11;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #0#6 = 1;  |Y #0#7 = 12;  nDesde = 17;  nHasta = 23;  |FINSI;

     |SI nDesde ! 0;
         |PARA nCampo1 = 14;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;  |O #0nCampo3 ! 0;
                   |HAZ GrabaDevengado332;
               |FINSI;
         |SIGUE;
     |FINSI;

     |PARA nCampo1 = 7;  |SI nCampo1 [ 31;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #332nCampo1 = -1;  #332nCampo1 = 0;  |FINSI;
     |SIGUE;

     nDesde = 0;
     nHasta = 0;

     |SI #0#6 = 2;  |Y #0#7 = 1;   nDesde = 34;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 2;   nDesde = 36;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 3;   nDesde = 40;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 4;   nDesde = 42;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 5;   nDesde = 46;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 6;   nDesde = 48;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 7;   nDesde = 52;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 9;   nDesde = 54;  nHasta = -1;  |FINSI;
     |SI #0#6 = 2;  |Y #0#7 = 11;   nDesde = 54;  nHasta = -2;  |FINSI;

     |SI nDesde ! 0;
         |HAZ GrabaDeducible332;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 9;
         #332#60 = #332#60 + #0#12;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 10;
         #332#61 = #332#61 + #0#12;
     |FINSI;

     |SI #0#6 = 3;  |Y #0#7 = 11;
         #332#62 = #332#62 + #0#12;
     |FINSI;

     |SI #0#6 = 4;  |Y #0#7 = 6;
         #332#62 = #332#62 + #0#12;
     |FINSI;

     |SI #0#6 = 4;  |Y #0#7 = 5;
         #332#63 = #332#63 + #0#12;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 1;
         #332#57   = #332#57 + #0#12;
         nContador = nContador + 1;
     |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 2;
         #332#65   = #332#65 + #0#12;
     |FINSI;
|FPRC;

|PROCESO GrabaModelo;
     nBaseMas  = 0;
     nCuotaMas = 0;
     |SI #0#6 = 2;
         |SI #0#7 ! 5; |Y #0#7 ! 6;
             |HAZ LeeRestoPror;
         |FINSI;
     |FINSI;

     |SI #0#12 = 0;  |Y #0#13 = 0;  |ACABA;  |FINSI;

     |SI #0#6 = 5;  |Y #0#7 = 6;  |Y #0#12 ! 0;
         nEjerAnt = #0#12;
     |FINSI;

     |SI enModelo = 300;   |HAZ Graba300;   |FINSI;
     |SI enModelo = 320;   |HAZ Graba320;   |FINSI;
     |SI enModelo = 330;   |HAZ Graba330;   |FINSI;
     |SI enModelo = 332;   |HAZ Graba332;   |FINSI;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE dsmociva;
     #0#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 01, 0,  0;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 99, 9, 99;
     be;
     NULL, GrabaModelo;
|FIN;

|PROCESO LeeRestoPror;

 |ABRE #165;
 #165#0 = #0#0;
 #165#1 = #0#1;
 #165#2 = #0#2;
 #165#3 = #0#3;
 #165#4 = #0#4;
 #165#5 = #0#5;
 #165#6 = #0#6;
 #165#7 = #0#7;
 |LEE 001#165=;
 |SI FSalida = 0;
     nBaseMas  = #165#10 + #165#13 + #165#16 + #165#19;
     nCuotaMas = #165#12 + #165#15 + #165#18 + #165#21;
 |FINSI;
 |CIERRA #165;
|FPRC;

|PROCESO Totales300;
     #300#33 = #300#8  + #300#11 + #300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32;

     |SI enEjer ] enEjerPro;
          |SI #109#36 = "N";
              #300#35 = #300#35 - enImpProrrata;
          |SINO;
              #300#35 = #300#35 - enImpProrrat1;
              #300#37 = #300#37 - enImpProrrat2;
              #300#41 = #300#41 - enImpProrrat3;
              #300#43 = #300#43 - enImpProrrat4;
              #300#47 = #300#47 - enImpProrrat5;
              #300#49 = #300#49 - enImpProrrat6;
              #300#53 = #300#53 - enImpProrrat7;
          |FINSI;
     |FINSI;
|| ....
|| Regularizacion Manual
     #300#35 = #300#35 - #47#6;
     #300#37 = #300#37 - #47#7;
     #300#41 = #300#41 - #47#8;
     #300#43 = #300#43 - #47#9;
     #300#47 = #300#47 - #47#10;
     #300#49 = #300#49 - #47#11;
     #300#53 = #300#53 - #47#12;
|| ....

     #300#38 = #300#34 + #300#36;
     #300#39 = #300#35 + #300#37;
     #300#44 = #300#40 + #300#42;
     #300#45 = #300#41 + #300#43;
     #300#50 = #300#46 + #300#48;
     #300#51 = #300#47 + #300#49;
     #300#55 = #300#39 + #300#45 + #300#51 + #300#53 + #300#54;

     #300#57 = #300#57 / nContador;
     #300#56 = #300#33 - #300#55;
     #300#58 = #300#56 % #300#57;
     #300#62 = #300#58 - #300#59 + #300#61;

     |SI #300#62 > 0;
         #300#65 = #300#62;
         #300#63 = 0;
         #300#64 = 0;
     |SINO;
         |SI #300#2 = 12;
             |HAZ UltimoPeriodo;
             |SI eaUltimoPer = "COMPENSAR";
                 #300#63 = -#300#62;
                 #300#64 = 0;
                 #300#65 = 0;
             |SINO;
                 #300#64 = -#300#62;
                 #300#63 = 0;
                 #300#65 = 0;
             |FINSI;
         |SINO;
             #300#63 = -#300#62;
             #300#64 = 0;
             #300#65 = 0;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Modelo300;
     |ABRE #300;

     #300#0 = enEmpresa;
     #300#1 = enEjer;
     #300#2 = enPeriodo;
     #300#3 = enModelo;
     #300#4 = enComplem;
     #300#5 = 0;
     |LEE 101#300=;
     |SI FSalida ! 0;
         |DDEFECTO #300;
         #300#0 = enEmpresa;
         #300#1 = enEjer;
         #300#2 = enPeriodo;
         #300#3 = enModelo;
         #300#4 = enComplem;
         #300#5 = 0;

         |HAZ RecogeAnter;
         #300#59 = nEjerAnt;
         #300#57 = 0;
         |GRABA 020#300b;
     |FINSI;

     nEjerAnt  = #300#59;
     nContador = 0;
     nSwGraba  = 0;
     |BUCLE dsmociva;

     |SI nSwGraba = 1;
         #300#59 = nEjerAnt;
         |HAZ Totales300;
         |GRABA 020#300a;
     |SINO;
         |BORRA 020#300a;
     |FINSI;
     |LIBERA #300;
     |CIERRA #300;
|FPRC;

|PROCESO Totales320;
     #320#33 = #320#8  + #320#11 + #320#14 + #320#17 + #320#20 + #320#23 + #320#26 + #320#29 + #320#32;

     |SI enEjer ] enEjerPro;
          |SI #109#36 = "N";
              #320#35 = #320#35 - enImpProrrata;
          |SINO;
              #320#35 = #320#35 - enImpProrrat1;
              #320#37 = #320#37 - enImpProrrat2;
              #320#41 = #320#41 - enImpProrrat3;
              #320#43 = #320#43 - enImpProrrat4;
              #320#47 = #320#47 - enImpProrrat5;
              #320#49 = #320#49 - enImpProrrat6;
              #320#53 = #320#53 - enImpProrrat7;
          |FINSI;
     |FINSI;

|| Regularizacion Manual
     #320#35 = #320#35 - #47#6;
     #320#37 = #320#37 - #47#7;
     #320#41 = #320#41 - #47#8;
     #320#43 = #320#43 - #47#9;
     #320#47 = #320#47 - #47#10;
     #320#49 = #320#49 - #47#11;
     #320#53 = #320#53 - #47#12;
|| ....
     #320#38 = #320#34 + #320#36;
     #320#39 = #320#35 + #320#37;
     #320#44 = #320#40 + #320#42;
     #320#45 = #320#41 + #320#43;
     #320#50 = #320#46 + #320#48;
     #320#51 = #320#47 + #320#49;
     #320#55 = #320#39 + #320#45 + #320#51 + #320#53 + #320#54;

     #320#56 = #320#33 - #320#55;
     #320#57 = #320#57 / nContador;
     #320#58 = #320#56 % #320#57;
     #320#64 = #320#58 - #320#59 + #320#63;

     |SI #320#64 > 0;
         #320#67 = #320#64;
         #320#65 = 0;
         #320#66 = 0;
     |SINO;
         |SI #320#2 = 12;
             |HAZ UltimoPeriodo;
             |SI eaUltimoPer = "COMPENSAR";
                 #320#65 = -#320#64;
                 #320#66 = 0;
                 #320#67 = 0;
             |SINO;
                 #320#66 = -#320#64;
                 #320#65 = 0;
                 #320#67 = 0;
             |FINSI;
         |SINO;
             #320#65 = -#320#64;
             #320#66 = 0;
             #320#67 = 0;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Modelo320;
     |ABRE #320;

     #320#0 = enEmpresa;
     #320#1 = enEjer;
     #320#2 = enPeriodo;
     #320#3 = enModelo;
     #320#4 = enComplem;
     #320#5 = 0;
     |LEE 101#320=;
     |SI FSalida ! 0;
         |DDEFECTO #320;
         #320#0 = enEmpresa;
         #320#1 = enEjer;
         #320#2 = enPeriodo;
         #320#3 = enModelo;
         #320#4 = enComplem;
         #320#5 = 0;

         |HAZ RecogeAnter;
         #320#57 = 0;
         #320#59 = nEjerAnt;

         |GRABA 020#320b;
     |FINSI;

     nEjerAnt  = #320#59;
     nContador = 0;
     nSwGraba  = 0;
     |BUCLE dsmociva;

     |SI nSwGraba = 1;
         #320#59 = nEjerAnt;
         |HAZ Totales320;
         |GRABA 020#320a;
     |SINO;
         |BORRA 020#320a;
     |FINSI;
     |LIBERA #320;
     |CIERRA #320;
|FPRC;

|PROCESO Totales330;
     #330#33 = #330#8  + #330#11 + #330#14 + #330#17 + #330#20 + #330#23 + #330#26 + #330#29 + #330#32;
|| aplicar nueva Prorrata
     |SI enEjer ] enEjerPro;
          |SI #109#36 = "N";
              #330#35 = #330#35 - enImpProrrata;
          |SINO;
              #330#35 = #330#35 - enImpProrrat1;
              #330#37 = #330#37 - enImpProrrat2;
              #330#41 = #330#41 - enImpProrrat3;
              #330#43 = #330#43 - enImpProrrat4;
              #330#47 = #330#47 - enImpProrrat5;
              #330#49 = #330#49 - enImpProrrat6;
              #330#53 = #330#53 - enImpProrrat7;
          |FINSI;
     |FINSI;
|| ....
|| Regularizacion Manual
     #330#35 = #330#35 - #47#6;
     #330#37 = #330#37 - #47#7;
     #330#41 = #330#41 - #47#8;
     #330#43 = #330#43 - #47#9;
     #330#47 = #330#47 - #47#10;
     #330#49 = #330#49 - #47#11;
     #330#53 = #330#53 - #47#12;
|| ....

     #330#38 = #330#34 + #330#36;
     #330#39 = #330#35 + #330#37;
     #330#44 = #330#40 + #330#42;
     #330#45 = #330#41 + #330#43;
     #330#50 = #330#46 + #330#48;
     #330#51 = #330#47 + #330#49;
     #330#55 = #330#39 + #330#45 + #330#51 + #330#53 + #330#54;

     #330#56 = #330#33 - #330#55;
     #330#57 = #330#57 / nContador;
     #330#58 = #330#56 % #330#57;
     #330#66 = #330#58 - #330#59 + #330#65;

     |SI #330#66 > 0;
         #330#69 = #330#66;
         #330#64 = 0;
         #330#67 = 0;
         #330#68 = 0;
     |SINO;
         |SI #330#2 = 12;
             |HAZ UltimoPeriodo;
             |SI eaUltimoPer = "COMPENSAR";
                 #330#67 = -#330#66;
                 #330#68 = 0;
                 #330#69 = 0;
             |SINO;
                 #330#68 = -#330#66;
                 #330#67 = 0;
                 #330#69 = 0;
             |FINSI;

             |ACABA;
         |FINSI;

         nResult = -#330#66;
         #330#64 = (#330#60 + #330#61 + #330#62 + #330#63) % 16;
         |SI #330#64 < 0;         #330#64 = 0;         |FINSI;
         |SI #330#68 = 0;         #330#68 =  #330#64;  |FINSI;
         |SI #330#68 > #330#64;   #330#68 =  #330#64;  |FINSI;
         |SI #330#68 > nResult;   #330#68 =  nResult;  |FINSI;

         #330#67 = nResult - #330#68;

         |SI #330#64 = 0;  |ACABA;  |FINSI;

         |SI enPregunta = 1;
             #330#68 = enDevolver;
             #330#67 = nResult - #330#68;
             |ACABA;
         |FINSI;

         |PUSHV 0501 2380;
         |CUADRO 1220 1752;
         |BLANCO 1321 1651;

         |ATRI S;
         |PINTA 1321, "Resultado ........: ";
         |PINTA 1421, "Maximo a Devolver : ";
         |PINTA 1521, "A Devolver .......: ";
         |PINTA 1621, "A Compensar ......: ";
         |ATRI s;

         |PINTA 1341, #330#66;
         |PINTA 1441, #330#64;
         |PINTA 1541, #330#68;
         |PINTA 1641, #330#67;

         E_inf = "0.?EURO";
         E_sup = "99999999999";

         nCampo68 = #330#68;

         |ET Campo68_330;
             nCampo68 = 1541 ? 1;
             |SI nCampo68 > #330#64;
                 |MENAV "     Maximo a Devolver superado.";
                 nCampo68 = #330#64;
                 |VETE Campo68_330;
             |FINSI;

         #330#68 = nCampo68;
         #330#67 = nResult - #330#68;
         |PINTA 1641, #330#67;

         |POPV;
     |FINSI;
|FPRC;

|PROCESO Modelo330;
     |ABRE #330;

     #330#0 = enEmpresa;
     #330#1 = enEjer;
     #330#2 = enPeriodo;
     #330#3 = enModelo;
     #330#4 = enComplem;
     #330#5 = 0;
     |LEE 101#330=;
     |SI FSalida ! 0;
         |HAZ RecogeAnter;

         |DDEFECTO #330;
         #330#0 = enEmpresa;
         #330#1 = enEjer;
         #330#2 = enPeriodo;
         #330#3 = enModelo;
         #330#4 = enComplem;
         #330#5 = 0;

         #330#57 = 0;
         #330#59 = nEjerAnt;

         |GRABA 020#330b;
     |FINSI;

     nEjerAnt  = #330#59;
     nContador = 0;
     nSwGraba  = 0;
     |BUCLE dsmociva;

     |SI nSwGraba = 1;
         #330#59 = nEjerAnt;
         |HAZ Totales330;
         |GRABA 020#330a;
     |SINO;
         |BORRA 020#330a;
     |FINSI;
     |LIBERA #330;
     |CIERRA #330;
|FPRC;

|PROCESO Totales332;
     #332#33 = #332#8  + #332#11 + #332#14 + #332#17 + #332#20 + #332#23 + #332#26 + #332#29 + #332#32;

|| aplicar nueva Prorrata
     |SI enEjer ] enEjerPro;
          |SI #109#36 = "N";
              #332#35 = #332#35 - enImpProrrata;
          |SINO;
              #332#35 = #332#35 - enImpProrrat1;
              #332#37 = #332#37 - enImpProrrat2;
              #332#41 = #332#41 - enImpProrrat3;
              #332#43 = #332#43 - enImpProrrat4;
              #332#47 = #332#47 - enImpProrrat5;
              #332#49 = #332#49 - enImpProrrat6;
              #332#53 = #332#53 - enImpProrrat7;
          |FINSI;
     |FINSI;
|| ...
|| Regularizacion Manual
     #332#35 = #332#35 - #47#6;
     #332#37 = #332#37 - #47#7;
     #332#41 = #332#41 - #47#8;
     #332#43 = #332#43 - #47#9;
     #332#47 = #332#47 - #47#10;
     #332#49 = #332#49 - #47#11;
     #332#53 = #332#53 - #47#12;
|| ....
     #332#38 = #332#34 + #332#36;
     #332#39 = #332#35 + #332#37;
     #332#44 = #332#40 + #332#42;
     #332#45 = #332#41 + #332#43;
     #332#50 = #332#46 + #332#48;
     #332#51 = #332#47 + #332#49;
     #332#55 = #332#39 + #332#45 + #332#51 + #332#53 + #332#54;

     #332#56 = #332#33 - #332#55;
     #332#57 = #332#57 / nContador;
     #332#58 = #332#56 % #332#57;
     #332#66 = #332#58 - #332#59 + #332#65;

     |SI #332#66 > 0;
         #332#69 = #332#66;
         #332#64 = 0;
         #332#67 = 0;
         #332#68 = 0;
     |SINO;
         |SI #332#2 = 12;
             |HAZ UltimoPeriodo;
             |SI eaUltimoPer = "COMPENSAR";
                 #332#67 = -#332#66;
                 #332#68 = 0;
                 #332#69 = 0;
             |SINO;
                 #332#68 = -#332#66;
                 #332#67 = 0;
                 #332#69 = 0;
             |FINSI;

             |ACABA;
         |FINSI;

         nResult = -#332#66;
         #332#64 = (#332#60 + #332#61 + #332#62 + #332#63) % 16;
         |SI #332#64 < 0;         #332#64 = 0;         |FINSI;
         |SI #332#68 = 0;         #332#68 =  #332#64;  |FINSI;
         |SI #332#68 > #332#64;   #332#68 =  #332#64;  |FINSI;
         |SI #332#68 > nResult;   #332#68 =  nResult;  |FINSI;

         #332#67 = nResult - #332#68;

         |SI #332#64 = 0;  |ACABA;  |FINSI;

         |SI enPregunta = 1;
             #332#68 = enDevolver;
             #332#67 = nResult - #330#68;
             |ACABA;
         |FINSI;

         |PUSHV 0501 2380;
         |CUADRO 1220 1752;
         |BLANCO 1321 1651;

         |ATRI S;
         |PINTA 1321, "Resultado ........: ";
         |PINTA 1421, "Maximo a Devolver : ";
         |PINTA 1521, "A Devolver .......: ";
         |PINTA 1621, "A Compensar ......: ";
         |ATRI s;

         |PINTA 1341, #332#66;
         |PINTA 1441, #332#64;
         |PINTA 1541, #332#68;
         |PINTA 1641, #332#67;

         E_inf = "0.?EURO";
         E_sup = "99999999999";

         nCampo68 = #332#68;

         |ET Campo68_332;
             nCampo68 = 1541 ? 1;
             |SI nCampo68 > #332#64;
                 |MENAV "     Maximo a Devolver superado.";
                 nCampo68 = #332#64;
                 |VETE Campo68_332;
             |FINSI;

         #332#68 = nCampo68;
         #332#67 = nResult - #332#68;
         |PINTA 1641, #332#67;

         |POPV;
     |FINSI;
|FPRC;

|PROCESO Modelo332;
     |ABRE #332;

     #332#0 = enEmpresa;
     #332#1 = enEjer;
     #332#2 = enPeriodo;
     #332#3 = enModelo;
     #332#4 = enComplem;
     #332#5 = 0;
     |LEE 101#332=;
     |SI FSalida ! 0;
         |HAZ RecogeAnter;

         |DDEFECTO #332;
         #332#0 = enEmpresa;
         #332#1 = enEjer;
         #332#2 = enPeriodo;
         #332#3 = enModelo;
         #332#4 = enComplem;
         #332#5 = 0;

         #332#57 = 0;
         #332#59 = nEjerAnt;

         |GRABA 020#332b;
     |FINSI;

     nEjerAnt  = #332#59;
     nContador = 0;
     nSwGraba  = 0;
     |BUCLE dsmociva;

     |SI nSwGraba = 1;
         #332#59 = nEjerAnt;
         |HAZ Totales332;
         |GRABA 020#332a;
     |SINO;
         |BORRA 020#332a;
     |FINSI;
     |LIBERA #332;
     |CIERRA #332;
|FPRC;

|PROCESO Registro0;

     |HAZ eLeeLaProrrata;
     |SI enEjer ] enEjerPro; nProrrata = 100; |FINSI;
     |SI enSwProrr = 3;
         nProrrata = 100;
         enImpProrrata = 0;
         enImpProrrat1 = 0;
         enImpProrrat2 = 0;
         enImpProrrat3 = 0;
         enImpProrrat4 = 0;
         enImpProrrat5 = 0;
         enImpProrrat6 = 0;
         enImpProrrat7 = 0;
         enImpProrrat8 = 0;
     |FINSI;

     |SI enModelo = 300;
         |ABRE #300;
         #300#0 = enEmpresa;
         #300#1 = enEjer;
         #300#2 = enPeriodo;
         #300#3 = enModelo;
         #300#4 = enComplem;
         #300#5 = 0;
         |LEE 101#300=;
         |SI FSalida = 0;
             |BORRA 020#300a;
         |FINSI;
         |LIBERA #300;
         |CIERRA #300;
     |FINSI;

     |SI enModelo = 320;
         |ABRE #320;
         #320#0 = enEmpresa;
         #320#1 = enEjer;
         #320#2 = enPeriodo;
         #320#3 = enModelo;
         #320#4 = enComplem;
         #320#5 = 0;
         |LEE 101#320=;
         |SI FSalida = 0;
             |BORRA 020#320a;
         |FINSI;
         |LIBERA #320;
         |CIERRA #320;
     |FINSI;

     |SI enModelo = 330;
         |ABRE #330;
         #330#0 = enEmpresa;
         #330#1 = enEjer;
         #330#2 = enPeriodo;
         #330#3 = enModelo;
         #330#4 = enComplem;
         #330#5 = 0;
         |LEE 101#330=;
         |SI FSalida = 0;
             |BORRA 020#330a;
         |FINSI;
         |LIBERA #330;
         |CIERRA #330;
     |FINSI;

     |SI enModelo = 332;
         |ABRE #332;
         #332#0 = enEmpresa;
         #332#1 = enEjer;
         #332#2 = enPeriodo;
         #332#3 = enModelo;
         #332#4 = enComplem;
         #332#5 = 0;
         |LEE 101#332=;
         |SI FSalida = 0;
             |BORRA 020#332a;
         |FINSI;
         |LIBERA #332;
         |CIERRA #332;
     |FINSI;

     |SI enModelo = 370;
         |ABRE #370;
         #370#0 = enEmpresa;
         #370#1 = enEjer;
         #370#2 = enPeriodo;
         #370#3 = enModelo;
         #370#4 = enComplem;
         #370#5 = 0;
         |LEE 101#370=;
         |SI FSalida = 0;
             |BORRA 020#370a;
         |FINSI;
         |LIBERA #370;
         |CIERRA #370;
     |FINSI;

     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = enPeriodo;
     #8#3 = enModelo;
     #8#4 = enComplem;
     #8#5 = 0;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS ";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;

     nSwGraba = 0;

     |SI enModelo = 300;  |HAZ Modelo300;  |FINSI;
     |SI enModelo = 320;  |HAZ Modelo320;  |FINSI;
     |SI enModelo = 330;  |HAZ Modelo330;  |FINSI;
     |SI enModelo = 332;  |HAZ Modelo332;  |FINSI;
     |SI enModelo = 370;
         nTipo         = enTipoEntrada;
         enTipoEntrada = 98;
         |SUB_EJECUTA_NP "dsmod370";
         enTipoEntrada = nTipo;
         nSwGraba      = enExistencia;
     |FINSI;

     |SI nSwGraba = 1;
         |ABRE #8;
         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = enPeriodo;
         #8#3 = enModelo;
         #8#4 = enComplem;
         #8#5 = 0;
         |LEE 101#8=;
         |SI FSalida = 0;
             #8#11 = "EXISTENTE";
             |GRABA 020#8a;
         |FINSI;
         |LIBERA #8;
         |CIERRA #8;
     |FINSI;
|FPRC;

|| ///////////////// Procesos del Entlineal \\\\\\\\\\\\\\\\\\\\

|PROCESO Total1_9;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 1;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 2;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 3;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 4;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 5;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 6;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 7;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 8;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 1;
     #0#7  = 9;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         #0#13 = nValor2;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total1_13;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 10;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 11;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 12;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 1;
     #0#7  = 13;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         #0#13 = nValor2;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_1;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 1;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 1;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 1;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 1;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_4;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 4;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_5;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 5;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_6;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 6;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_7;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 7;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total2_10;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 2;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 5;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 6;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 7;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 8;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     |SI enEjer [ 2007;
         #0#0  = enEmpresa;
         #0#1  = enEjer;
         #0#2  = enPeriodo;
         #0#3  = enModelo;
         #0#4  = enComplem;
         #0#5  = enActividad;
         #0#6  = 2;
         #0#7  = 10;
         |LEE 101#0=;
         |SI FSalida = 0;
             #0#12 = nValor1;
             #0#13 = nValor2;
             |GRABA 020#0a;
             |LIBERA #0;
         |FINSI;
     |FINSI;

     |SI enEjer ] 2008;
         nGrupo    = 2;  nSubGrupo = 10;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;
     |FINSI;

     nGrupo    = 2;  nSubGrupo = 11;   |HAZ LeeCasilla;
     nValor1   = nValor1 - #0#12;
     nValor2   = nValor2 - #0#13;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 2;
     #0#7  = 12;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         #0#13 = nValor2;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_15;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 3;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 5;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 6;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 7;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 8;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 10;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 11;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 12;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 13;   |HAZ LeeCasilla;
     nValor1   = nValor1 - #0#12;

     nGrupo    = 3;  nSubGrupo = 14;   |HAZ LeeCasilla;
     nValor1   = nValor1 - #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 15;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Totales;
     |HAZ Total1_9;   || Total Bases y Cuotas I.V.A.
     |HAZ Total1_13;  || Total Bases y Cuotas I.V.A. y Recargo

     |SI enModelo = 300;  |O enModelo = 330;  |O enModelo = 370;
         |HAZ Total3_1;   || Operaciones en Regimen General
     |FINSI;

     |SI enModelo = 320;  |O enModelo = 332;
         |HAZ Total3_4;   || Operaciones en Regimen Ordinario
         |HAZ Total3_5;   || Operaciones en Regimen especial bienes usados etc.
         |HAZ Total3_6;   || Operaciones en Regimen especial Agencias Viajes
         |HAZ Total3_7;   || Operaciones en Determinacion Proporcional
     |FINSI;

     |HAZ Total2_10;  || Suma de Deducciones
     |HAZ Total3_15;  || Total Volumnen de Operaciones

     |SI enTipoEntrada ! 95;
         |HAZ Refresco;
     |FINSI;
|FPRC;

|PROCESO GrabaRegistros;
     |SI enModelo = 300;  |O enModelo = 330;  |O enModelo = 370;
         |SI #7#4 = 2;  |ACABA;  |FINSI;
     |SINO;
         |SI #7#4 = 1;  |ACABA;  |FINSI;
     |FINSI;

     |SI #7#0 = 2;  |Y #7#1 = 10;
         |SI #0#1 [ 2007;
             #7#2 = "      Suma de deducciones ........................";
             #7#3 = "T";
             #7#4 = 0;
             #7#5 = 2;
             #7#6 = 0;
             #7#7 = 0;
         |SINO;
             #7#2 = "Regularizacion aplicacion porcentaje def.prorrata";
             #7#3 = "D";
             #7#4 = 0;
             #7#5 = 0;
             #7#6 = 0;
             #7#7 = 0;
         |FINSI;
     |FINSI;

     |DDEFECTO #0;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = #7#0;
     #0#7  = #7#1;
     #0#8  = #7#2;
     #0#9  = #7#3;
     #0#11 = #7#5;

     |SI #7#0 = 5;  |Y #7#1 = 1;
         #0#12 = 100;
     |FINSI;

     |GRABA 020#0n;
     |LIBERA #0;
|FPRC;

|DEFBUCLE dsmom007;
     #7#1;
     ;
     0, 00;
     5, 99;
     ;
     NULL, GrabaRegistros;
|FIN;

|PROCESO dsmociva;             ||Atencion
    |NOME_DAT #0   aFitxer300;
    |NOME_DAT #300 aFitxer301;

     eaNomDef = "dsmociva";

|| \\\\\\ Baja del Modelo desde planillas ////////

     |SI enTipoEntrada = 97;              ||Baja del Modelo
         |BUCLE dsmocivaB;
         |HAZ Registro0;
         |ACABA;
     |FINSI;

|| Creacion unicamente del Modelo

     |SI enTipoEntrada = 90;              || Creacion Solamente
         |ABRE #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         #0#6 = 0;
         #0#7 = 0;
         |LEE 040#0];
         |SI FSalida ! 0;  |O #0#0 ! enEmpresa;  |O #0#1 ! enEjer; |O #0#2 ! enPeriodo;
          |O #0#3 ! enModelo;  |O #0#4 ! enComplem; |O #0#5 ! enActividad;
             |BUCLE dsmom007;
         |FINSI;
         |CIERRA #0;

         |ACABA;
     |FINSI;

|| Creacion unicamente del Modelo de Impresion

     |SI enTipoEntrada = 91;
         |HAZ Registro0;
         |ACABA;
     |FINSI;

|| Calcula unicamente del Modelo de Trabajo

     |SI enTipoEntrada = 95;              || Calculo del dsmociva
         |ABRE #0;
         |HAZ Totales;
         |CIERRA #0;
     |FINSI;
|FPRC;
