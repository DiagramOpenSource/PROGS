|FICHEROS;
     dsm39001 #1;
     dsm39002 #2,MANTE;
     dsmow002 #99;
|FIN;

|VARIABLES;
     nCampo68    = 0;
     nCampo1     = 0;
     nCampo2     = 0;
     nCampo3     = 0;
     nCampo11    = 0;
     nCampo22    = 0;
     nCampo33    = 0;
     nValor1     = 0;
     nValor2     = 0;
     nGrupo      = 0;
     nSubGrupo   = 0;
     nPeriodoMin = 0;
     nEjerAnt    = 0;
     nSwAcum     = 0;
     nDesde      = 0;
     nHasta      = 0;
     nContador   = 0;
     nResult     = 0;
     nSwGraba    = 0;
     nAnyo       = 0;
     nPer        = 0;
     nTipo       = 0;
     nPeriodo    = 0;
     nDepar      = 0;
     nEjer       = 0;

     aAlfa       = "";
     aTecla      = "";
|FIN;

|INCLUYE i_variar;

|| ///////////////// Procesos del Entlineal \\\\\\\\\\\\\\\\\\\\

|PROCESO LeeCasilla;
     #2#0   = #1#0;
     #2#1   = #1#1;
     #2#2   = #1#2;
     #2#3   = #1#3;
     #2#24  = nGrupo;
     #2#25  = nSubGrupo;
     |LEE 040#2=;
     |SI FSalida ! 0;
         |DDEFECTO #2;
     |SINO;
         |SI nGrupo = 3; |Y nSubGrupo ] 1; |Y nSubGrupo [ 14;
             |SI #2#10 < 0;
                 |PDEFECTO #2, 10, 24;
                 |GRABA 020#2a;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Total1_9;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 1;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 1;  nSubGrupo = 2;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 1;  nSubGrupo = 3;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 1;  nSubGrupo = 4;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 1;  nSubGrupo = 5;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 1;  nSubGrupo = 6;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 1;  nSubGrupo = 7;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 1;  nSubGrupo = 8;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     #2#0   = #1#0;
     #2#1   = #1#1;
     #2#2   = #1#2;
     #2#3   = #1#3;
     #2#24  = 1;
     #2#25  = 9;
     |LEE 101#2=;
     |SI FSalida = 0;
         #2#10 = nValor1;
         #2#11 = nValor2;
         |GRABA 020#2a;
         |LIBERA #2;
     |FINSI;
|FPRC;

|PROCESO Total1_13;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 1;  nSubGrupo = 10;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 1;  nSubGrupo = 11;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 1;  nSubGrupo = 12;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     #2#0  = #1#0;
     #2#1  = #1#1;
     #2#2  = #1#2;
     #2#3  = #1#3;
     #2#24 = 1;
     #2#25 = 13;
     |LEE 101#2=;
     |SI FSalida = 0;
         #2#10 = nValor1;
         #2#11 = nValor2;
         |GRABA 020#2a;
         |LIBERA #2;
     |FINSI;
|FPRC;

|PROCESO Total3_1;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 1;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 1;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 1;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     #2#0  = #1#0;
     #2#1  = #1#1;
     #2#2  = #1#2;
     #2#3  = #1#3;
     #2#24 = 3;
     #2#25 = 1;
     |LEE 101#2=;
     |SI FSalida = 0;
         #2#10 = nValor1 + #2#11;
         |GRABA 020#2a;
         |LIBERA #2;
     |FINSI;
|FPRC;

|PROCESO Total2_10;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 2;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 2;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 2;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 2;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 2;  nSubGrupo = 5;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 2;  nSubGrupo = 6;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 2;  nSubGrupo = 7;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 2;  nSubGrupo = 8;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     nGrupo    = 2;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;
     nValor2   = nValor2 + #2#11;

     |SI #1#1 ] 2008;
         nGrupo    = 2;  nSubGrupo = 10;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #2#10;
         nValor2   = nValor2 + #2#11;

         nGrupo    = 2;  nSubGrupo = 11;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #2#10;
         nValor2   = nValor2 + #2#11;

         nGrupo    = 2;  nSubGrupo = 12;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #2#10;
         nValor2   = nValor2 + #2#11;
    |SINO;
         #2#0  = #1#0;
         #2#1  = #1#1;
         #2#2  = #1#2;
         #2#3  = #1#3;
         #2#24 = 2;
         #2#25 = 10;
         |LEE 101#2=;
         |SI FSalida = 0;
             #2#10 = nValor1;
             #2#11 = nValor2;
             |GRABA 020#2a;
             |LIBERA #2;
         |FINSI;

         nGrupo    = 2;  nSubGrupo = 11;   |HAZ LeeCasilla;
         nValor1   = nValor1 - #2#10;
         nValor2   = nValor2 - #2#11;
    |FINSI;

     #2#0  = #1#0;
     #2#1  = #1#1;
     #2#2  = #1#2;
     #2#3  = #1#3;
     #2#24 = 2;
     |SI #1#1 [ 2007;  #2#25 = 12;  |FINSI;
     |SI #1#1 ] 2008;  #2#25 = 13;  |FINSI;
     |LEE 101#2=;
     |SI FSalida = 0;
         #2#10 = nValor1;
         #2#11 = nValor2;
         |GRABA 020#2a;
         |LIBERA #2;
     |FINSI;
|FPRC;

|PROCESO Total3_15;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 3;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 3;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 3;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 3;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 3;  nSubGrupo = 5;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 3;  nSubGrupo = 6;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 3;  nSubGrupo = 7;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 3;  nSubGrupo = 8;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 3;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 3;  nSubGrupo = 10;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 3;  nSubGrupo = 11;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 3;  nSubGrupo = 12;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #2#10;

     nGrupo    = 3;  nSubGrupo = 13;   |HAZ LeeCasilla;
     nValor1   = nValor1 - #2#10;

     nGrupo    = 3;  nSubGrupo = 14;   |HAZ LeeCasilla;
     nValor1   = nValor1 - #2#10;

     #2#0  = #1#0;
     #2#1  = #1#1;
     #2#2  = #1#2;
     #2#3  = #1#3;
     #2#24 = 3;
     #2#25 = 15;
     |LEE 101#2=;
     |SI FSalida = 0;
         #2#10 = nValor1;
         |GRABA 020#2a;
         |LIBERA #2;
     |FINSI;
|FPRC;

|PROCESO Totales;
     |HAZ Total1_9;   || Total Bases y Cuotas I.V.A.
     |HAZ Total1_13;  || Total Bases y Cuotas I.V.A. y Recargo

     |HAZ Total3_1;   || Operaciones en Regimen General
     |HAZ Total2_10;  || Suma de Deducciones
     |HAZ Total3_15;  || Total Volumnen de Operaciones

     |SI enTipoEntrada ! 95;  |HAZ Refresco;  |FINSI;
|FPRC;

|PROCESO Tipo7;  |TIPO 7;
     |PINTA #2#10;
     |PINTA #2#11;

     |SI #2#9 = 2;
         |MENSA "     ";
     |FINSI;

     |SI #2#9 = 0;
         |MENSA "     Pulse <F2> para Introduccion de Bases y Cuotas";
     |FINSI;

     |SI #2#9 = 1;
         |MENSA "     Pulse <F2> para Introduccion del Importe";
     |FINSI;
|FPRC;

|PROCESO Introduccion;  |TIPO 11;
     |SI FSalida       ! 10;  |ACABA;  |FINSI;

     |SI enTipoEntrada = 4;
         |SI #2#9 ! 0;
             |ACABA;
         |SINO;
              #99#0 = #2#6;
              |PARA nCampo1 = 12;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 1;
                    nCampo2 = nCampo1 - 8;
                    #99nCampo2 = #2nCampo1;
              |SIGUE;
              |PUSHV 0501 2380;
              |PINPA #0#99;
              |PINDA #0#99;
              |LEETECLA aTecla;

              |POPV;
          |FINSI;

          |ACABA;
     |FINSI;

     |LEE 101#2=;

     |SI #2#9 = 0;
          #99#0 = #2#6;
          |PARA nCampo1 = 12;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 1;
                nCampo2 = nCampo1 - 8;
                #99nCampo2 = #2nCampo1;
          |SIGUE;

          |PUSHV 0501 2380;
          |PINPA #0#99;
          |PINDA #0#99;
          |ENDATOS #1#99;
          |SI FSalida = 0;
              |PARA nCampo1 = 12;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 1;
                    nCampo2 = nCampo1 - 8;
                    #2nCampo1 = #99nCampo2;
              |SIGUE;
          |FINSI;

          |POPV;

          #2#10 = #2#12 + #2#15 + #2#18 + #2#21;
          #2#11 = #2#14 + #2#17 + #2#20 + #2#23;
     |FINSI;

     |SI #2#9 = 1;
          |SI #2#24 = 3;  |Y #2#25 = 1;
              |CONFI "0000NDesea introducir mas o menos importe a las Operaciones en Regimen General";
              |SI FSalida = 0;
                  |ENCAMPO #11#2;
              |FINSI;
          |SINO;
              |ENCAMPO #10#2;
          |FINSI;
     |FINSI;

     |PINTA #2#10;
     |PINTA #2#11;

     |GRABA 020#2a;
     |LIBERA #2;

     |SALVA_DATOS #2;

     |HAZ Totales;

     |REPON_DATOS #2;
|FPRC;

|PROCESO Tipo5;  |TIPO 5;
     #2#0  = #1#0;
     #2#1  = #1#1;
     #2#2  = #1#2;
     #2#3  = #1#3;
     #2#24 = 1;
     #2#25 = 0;
     |LEE 040#2=;

     |LINEAS_BI_ATRI #2#7, S, N, -1;
|FPRC;
