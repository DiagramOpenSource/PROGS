|FICHEROS;
     dsmozprq #0;

     dsmociva #1;
     dsmom027 #27;
     dsmom029 #29;

     dsmod300 #300;
     dsmod320 #320;
     dsmod330 #330;
     dsmod332 #332;
     dsmod370 #370;
|FIN;

|VARIABLES;
     aParametro = "";
     aAlfa      = "";

     nCampo        = 0;
     nDEmpresa     = 0;
     nHEmpresa     = 0;
     nDEjer        = 0;
     nHEjer        = 0;

     nImp1         = 0;
     nImp2         = 0;
     nImp3         = 0;

     fFecha    = @;

     nEmpresa  = 0;
     nEjer     = 0;
     nPerio    = 0;
|FIN;

|INCLUYE i_variar;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO Ejercicio;  |TIPO 7;
     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#0   = aAlfa;
     #0#0   = #0#0 - 1;
     |PINTA #0#0;
|FPRC;

|PROCESO Parrilla;
     |SI #0#1 = 0;
         #0#1 = 0;  |PINTA #0#1;
         #0#2 = 0;  |PINTA #0#2;  |C_M #0#2, 1, "N";
         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI nEmpresa = 0;
             |C_M #0#1, 1, "S";
             |C_M #0#2, 1, "S";
         |FINSI;

         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|PROCESO Graba29;
 #29#0 = nEmpresa;
 #29#1 = nEjer;
 #29#2 = nPerio;
 #29#9 = 00;
 |LEE 101#29=;
 |SI FSalida ! 0;
      |DDEFECTO #29;
      #29#0 = nEmpresa;
      #29#1 = nEjer;
      #29#2 = nPerio;
      |SI nPerio = 1;   #29#7 = "ENERO     ";  |FINSI;
      |SI nPerio = 2;   #29#7 = "FEBRERO   ";  |FINSI;
      |SI nPerio = 3;   #29#7 = "MARZO     ";  |FINSI;
      |SI nPerio = 4;   #29#7 = "ABRIL     ";  |FINSI;
      |SI nPerio = 5;   #29#7 = "MAYO      ";  |FINSI;
      |SI nPerio = 6;   #29#7 = "JUNIO     ";  |FINSI;
      |SI nPerio = 7;   #29#7 = "JULIO     ";  |FINSI;
      |SI nPerio = 8;   #29#7 = "AGOSTO    ";  |FINSI;
      |SI nPerio = 9;   #29#7 = "SEPTIEMBRE";  |FINSI;
      |SI nPerio = 10;  #29#7 = "OCTUBRE   ";  |FINSI;
      |SI nPerio = 11;  #29#7 = "NOVIEMBRE ";  |FINSI;
      |SI nPerio = 12;  #29#7 = "DICIEMBRE ";  |FINSI;
      |SI nPerio = 99;  #29#7 = "ANUAL     ";  |FINSI;
      #29#9 = 0;
      |GRABA 020#29b;
 |FINSI;

 #29#3 = #29#3 + nImp1;
 #29#4 = enProrr29;
 #29#5 = #29#5 + nImp2;
 #29#6 = #29#3 - #29#5;
 |SI #29#6 = 0; #29#4 = 100; |FINSI;
 #29#8 = #29#8 + nImp3;

 |GRABA 020#29a;
 |LIBERA #29;
 #27#39 = #27#39 + nImp1;
 #27#40 = #27#40 + nImp2;
 #27#44 = #27#44 + nImp3;
|FPRC;

|PROCESO dsmociva0;
     nPerio      = #1#2;
     nImp1       = 0;
     nImp2       = 0;
     nImp3       = 0;
     |SI #1#7 = 11;
         nImp3 = #1#13;
     |SINO;
         nImp1 = #1#13;
     |FINSI;
     |HAZ Graba29;
|FPRC;

|DEFBUCLE dsmociva0;
     #1#1;
     ;
     nEmpresa, nEjer, 00, 300, 00, 00, 2, 10;
     nEmpresa, nEjer, 99, 370, 99, 99, 2, 11;
     be;
     NULL, dsmociva0;
|FIN;


|PROCESO DP300;
     nPerio = #300#2;
     nImp1  = 0;
     nImp2  = #300#55;
     |HAZ Graba29;
|FPRC;

|DEFBUCLE dsmod300;
     #300#1;
     ;
     nEmpresa, nEjer,  1, 300, 00, 00;
     nEmpresa, nEjer, 12, 300, 99, 99;
     ;
     NULL, DP300;
|FIN;

|PROCESO DP370;
     nPerio = #370#2;
     nImp1     = 0;
     nImp2     = #370#55;
     |HAZ Graba29;
|FPRC;

|DEFBUCLE dsmod370;
     #370#1;
     ;
     nEmpresa, nEjer,  1, 370, 00, 00;
     nEmpresa, nEjer, 12, 370, 99, 99;
     ;
     NULL, DP370;
|FIN;

|PROCESO DP320;
     nPerio = #320#2;
     nImp1     = 0;
     nImp2     = #320#55;
     |HAZ Graba29;
|FPRC;

|DEFBUCLE dsmod320;
     #320#1;
     ;
     nEmpresa, nEjer,  1, 320, 00, 00;
     nEmpresa, nEjer, 12, 320, 99, 99;
     ;
     NULL, DP370;
|FIN;

|PROCESO DP330;
     nPerio = #330#2;
     nImp1     = 0;
     nImp2     = #330#55;
     |HAZ Graba29;
|FPRC;

|DEFBUCLE dsmod330;
     #330#1;
     ;
     nEmpresa, nEjer,  1, 330, 00, 00;
     nEmpresa, nEjer, 12, 330, 99, 99;
     ;
     NULL, DP330;
|FIN;

|PROCESO DP332;
     nPerio = #332#2;
     nImp1     = 0;
     nImp2     = #332#55;
     |HAZ Graba29;
|FPRC;

|DEFBUCLE dsmod332;
     #332#1;
     ;
     nEmpresa, nEjer,  1, 330, 00, 00;
     nEmpresa, nEjer, 12, 330, 99, 99;
     ;
     NULL, DP332;
|FIN;

|PROCESO Borrar29;
  |BORRA 020#29a;
  |LIBERA #29;
|FPRC;

|DEFBUCLE Borrar29;
 #29#1;
 ;
 #27#0, #27#1, 01, 00;
 #27#0, #27#1, 99, 00;
 be;
 NULL, Borrar29;
|FIN;

|PROCESO LasProrratas;

   |SI #27#2 [ 0;      #27#2 = 100;  |FINSI;
   |SI enSwProrr = 2;  #27#2 = 100;  |FINSI;
   |SI #27#2 > 100;    #27#2 = 100;  |FINSI;
   #27#42 = #27#2;
   #27#39 = 0;
   #27#40 = 0;

   |BUCLE Borrar29;

    nEmpresa  = #27#0;
    nEjer     = #27#1;
    nImp1     = 0;
    nImp2     = 0;
    nImp3     = 0;
    enProrr29 = #27#2;

    |ABRE #29;
    |BUCLE dsmociva0;
    |BUCLE dsmod300;
    |BUCLE dsmod370;
    |BUCLE dsmod320;
    |BUCLE dsmod330;
    |BUCLE dsmod332;
    |CIERRA #29;

    |GRABA 020#27a;
    |LIBERA #27;
|FPRC;

|DEFBUCLE LasProrratas;
 #27#1;
 ;
 nDEmpresa, nDEjer;
 nHEmpresa, nHEjer;
 be;
 NULL, LasProrratas;
|FIN;

|PROCESO Tipo3;  |TIPO 3;

     nDEjer = #0#0; nHEjer = #0#0;

     |SI aParametro ! "";
         nDEjer = 1990;
         nHEjer = 2099;
     |FINSI;

     |SI #0#1 ! 0;
         nDEmpresa = #0#1;
         nHEmpresa = #0#2;
         |BUCLE LasProrratas;
     |SINO;
         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               nDEmpresa = #0nCampo;
               nHEmpresa = #0nCampo;
               |BUCLE LasProrratas;
         |SIGUE;
     |FINSI;
|FPRC;


|PROGRAMA;
 aParametro = PARAMETRO;
 |QBF aParametro;

 |SI aParametro = "";
     |HAZ LeeCtrlProrr;
     |MANTE #0;
 |SINO;
     #0#1 = 00001;
     #0#2 = 99999;
     |HAZ Tipo3;
 |FINSI;
|FPRO;
