|FICHEROS;
     :/contagen/def/cacuenta #300;
     :/contagen/def/ca8m0003 #403;
     :/contagen/def/ca8ctrle #400;  ||Control Empresa
     :/contagen/def/ca8comay #401;  ||Control Empresa
     :/contagen/def/ca8eqmay #402;  ||Control Empresa

     :/contagen/def/canempre #330;
|FIN;

|VARIABLES;
 aAlfa1 = "";
 aAlfa2 = "";
 aAlfa3 = "";
 nNume1 = 0;
 nNume2 = 0;
 nNume3 = 0;
 nHay   = 0;
 uno    = "";
 dos    = "";
 nLong1 = 0;
 nLong2 = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|PROCESO AntCambioCta;  || situa la tabla
  |ABRE #400;
  |DDEFECTO #400;
  #400#0 = enEmpresa;
  #400#1 = enPerConta;
  |LEE 001#400=;
  |SI FSalida = 0;
      eNum2008 = #400#2;
  |SINO;
      #400#0 = enEmpresa;
      #400#1 = 0;
      |LEE 001#400];
      |SI FSalida = 0; |Y #400#0 = enEmpresa;
          eNum2008 = #400#2;
      |FINSI;
  |FINSI;
  |CIERRA #400;

  aAlfa1 = aPathConta;
  nNume1 = enPerConta;

  eaPath2008 = "";
  enPer2008  = -1;
  |ABRE #330;
  |SELECT #4#330;
  #330#2  = enEmpresa;
  #330#26 = 8;  || Ejercicio 2008
  |LEE 041#330=;
  |SI FSalida = 0;
      enPer2008 = #330#3;
  |FINSI;
  |CIERRA #330;

  |SI enPer2008 ! -1;
      enPerConta = enPer2008;
      enSwSinMen = 1;
      |HAZ LeeEmpConta;
      eaPath2008 = aPathConta;
      nLongMax = MaximoDigitos;
  |FINSI;
  enPerConta = nNume1;
  aPathConta = aAlfa1;
|FPRC;

|PROCESO CambioCta;
  |QBF eaCuenta;
  eaCta2008 = eaCuenta;
  eaNom2008 = eaNomCta;
  eaCta1990 = eaCuenta;
  eaNom1990 = eaNomCta;

  |SI eaPath2008 = ""; |ACABA; |FINSI; || no hay empresa del 2008, no hay cambio

  nHay = 0;

  |PATH_DAT #403 eaPath2008;

  |ABRE #403;
  |DDEFECTO #403;
  |SI enEjerCam ] 2008;
      |SELECT #2#403;
      #403#2 = eaCuenta;
      |LEE 041#403];
      |SI FSalida = 0; |Y #403#2 = eaCuenta;
          eaCta2008 = #403#2;
          eaNom2008 = #403#3;
          eaCta1990 = #403#0;
          eaNom1990 = #403#1;
          nHay = 1;
      |SINO;
          eaCta1990 = "";
          eaNom1990 = "";
      |FINSI;
      |SELECT #1#403;
  |SINO;
       #403#0 = eaCuenta;
       |LEE 041#403=;
       |SI FSalida = 0;
           eaCta2008 = #403#2;
           eaNom2008 = #403#3;
           eaCta1990 = #403#0;
           eaNom1990 = #403#1;
           nHay = 1;
       |FINSI;
  |FINSI;
  |CIERRA #403;

  |SI nHay = 0; |Y enEjerCam < 2008; || Lo transformo ahora
      |ABRE #402;
      |DDEFECTO #402;

      uno = eaCuenta; |QBF uno;
      dos = uno + "000000000000";

      uno = dos % A104; nLong1 = 4;
      #402#0 = eNum2008;
      #402#1 = uno;
      |LEE 040#402=;
      |SI FSalida = 0;  |HAZ Datos;  |ACABA;  |FINSI;

      uno = dos % A103; nLong1 = 3;
      #402#0 = eNum2008;
      #402#1 = uno;
      |LEE 040#402=;
      |SI FSalida = 0;  |HAZ Datos;  |ACABA;  |FINSI;

      uno = dos % A102; nLong1 = 2;
      #402#0 = eNum2008;
      #402#1 = uno;
      |LEE 040#402=;
      |SI FSalida = 0;  |HAZ Datos;  |ACABA;  |FINSI;

      uno = dos % A101; nLong1 = 1;
      #402#0 = eNum2008;
      #402#1 = uno;
      |LEE 040#402=;
      |SI FSalida = 0;
          |HAZ Datos;
      |SINO;
          eaCta2008 = "PDTE";
          eaNom2008 = "No existe Tabla equivalencia";
          |CIERRA #402;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO Datos;
   eaPlan8  = #402#3;
   |QBF eaPlan8;
   |CIERRA #402;

   aAlfa1 = eaPlan8 % 0;
   nNume1 = aAlfa1;     || Longitud del Cambio
   nNume2 = nNume1 + 100; nLong2 = nNume1;

   |SI eaPlan8 = "PDTE";
       eaCta2008 = eaPlan8;
       eaNom2008 = #402#4;
       |ACABA;
   |FINSI;

   nNume3 = 0 - ((nLongMax - nLong2) + 100)
   aAlfa1 = eaCuenta % nNume2;
   aAlfa2 = eaCuenta % nNume3;

   |SI aAlfa1 = eaPlan8;
       eaCta2008 = eaCuenta;
   |SINO;
       eaCta2008 = eaPlan8 + aAlfa2;
   |FINSI;
|FPRC;
