|FICHEROS;
   dsmoz036 #0;
   dsmom041 #41;
   dsmom042 #42;

   :/contagen/def/cafinanc #360;
   :/contagen/def/cafinanl #361;
|FIN;

|VARIABLES;
  inkey      = 0;
  aAlfa1     = "";
  nNume1     = 0;
  nPara1     = 0;
  aFichero   = "";
  &eaDElem   = "";
  &eaHElem   = "";
  &enDNEle   = 0;
  &enHNEle   = 0;
  &enDeAqui  = 0;

   &aComVen = "";
   &enSwBien = 0;
   &aCamp1 = "";
   &nCamp2 = 0;
   &fCamp3 = @;
   &nCamp4 = 0;
   &nCamp5 = 0;
   &aCamp6 = "";
   &nCamp7 = 0;
   &aCamp8 = "";
   &nCamp9 = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;  || Variables de Contabilidad

**************************************************************************
|PROCESO LeeLasLineas;
 |PARA nPara1 = 0; |SI nPara1 [ 33; |HACIENDO nPara1 = nPara1 + 1;
       #0nPara1 = #41nPara1;
 |SIGUE;

 |SI #0#11 = "N";  #0#47 = "NUEVA";  |SINO;  #0#47 = "USADA"; |FINSI;

 |SI #0#24 = "P";  #0#48 = "PERIODICA";  |SINO;  #0#48 = "ANUAL";  |FINSI;

 |PARA nPara1 = 4; |SI nPara1 [ 16; |HACIENDO nPara1 = nPara1 + 1;
       nNume1 = nPara1 + 30;
       #0nNume1 = #42nPara1;
 |SIGUE;

 |PARA nPara1 = 34; |SI nPara1 [ 38; |HACIENDO nPara1 = nPara1 + 1;
       nNume1 = nPara1 + 15;
       #0nNume1 = #41nPara1;
 |SIGUE;

 |GRABA 020#0n;
|FPRC;

|DEFBUCLE LeeLasLineas;
 #42#1;
 ;
 #41#0, #41#2, #41#3, 001;
 #41#0, #41#2, #41#3, 999;
 e;
 NULL, LeeLasLineas;
|FIN;

**************************************************************************

|RUTINA ClaveBaja0;
     #0#0  = enEmpresa;
     #0#2  = #41#2;
     #0#3  = #41#3;
     #0#34 = 001;
|FRUT;

|RUTINA ClaveAlta0;
     #0#0  = enEmpresa;
     #0#2  = #41#2;
     #0#3  = #41#3;
     #0#34 = 999;
|FRUT;
|| *********************************************************************

|PROGRAMA;
 eaHElem = eaDElem;
 enHNEle = enDNEle;
 |ABRE #41;
 #41#0 = enEmpresa;
 #41#2 = eaDElem;
 #41#3 = enDNEle;
 |LEE 001#41=;
 |SI FSalida ! 0;
     |MENAV "    Error No existe Elemento en el Fichero ";
     |CIERRA #41;
     |ACABA;
 |FINSI;
 |CIERRA #41;

 |PINPA #0#0;
 |HAZ Analitica;
 |SI enSwAna = 1;
     |C_V #0#49,1,"S";
     |C_M #0#49,1,"S";
     |ATRI P; |PINTA 1119, "Ana: "; |ATRI 0;
 |SINO;
     |C_V #0#49,1,"N";
     |C_M #0#49,1,"N";
     |PINTA 1119, "     ";
 |FINSI;

 aFichero = ("z36" + Usuario) % 108;
 |NOME_DAT #0 aFichero;
 |ABRE #0;  |CIERRA #0;  |DELINDEX #0;

 |ABRE #0;
 |BUCLE LeeLasLineas;
 |CIERRA #0;

 |PINDA #0#0;

 |ENTLINEAL #1#0, -4, 5, 22, 0, ClaveBaja0, ClaveAlta0;

 |DELINDEX #0;
|FPRO;

|| ***************************************************************************
|CALCULO eltipo7; |TIPO 7;
 |SI #0#36 ! "A";
     aAlfa1 = "    <F3> consultar Factura de Compra o Venta / <F4> Imprimir Ficha";
     |SI #41#36 ! 0;
         aAlfa1 = "    <F3> consultar Operacion Financiera / <F4> Imprimir Ficha";
     |FINSI;
 |SINO;
     aAlfa1 = "    <F4> Imprimir Ficha";
 |FINSI;
 |MENSA aAlfa1;
|FCAL;

|CALCULO lacons_Linea; |TIPO 11;
 inkey = FSalida;

 |SI inkey = 11; |Y #0#36 ! "A";
     |SI #0#51 = 0; |O #0#36 = "V";
         |HAZ ConsulFactura;
     |SINO;
         |SI enDeAqui = 0; |HAZ ConsulOpera; |FINSI;
     |FINSI;
     |ERROR;
 |FINSI;
 |SI inkey = 12;
     |SUB_EJECUTA_NP "dsmoy041";
     |ERROR;
 |FINSI;
|FCAL;

|PROCESO ConsulFactura;
    aComVen     = #0#36; ||Compra o venta
    enEmpresa   = #0#0;
    enActividad = #0#1;
    enEjer      = #0#35;
    eaElemento  = #0#2;
    enElemeNum  = #0#3;
    aCamp1      = #0#4;
    nCamp2      = #0#34;  || linea
    fCamp3      = #0#39;
    nCamp4      = #0#37;
    nCamp5      = #0#42;
    aCamp6      = #0#40;
    nCamp7      = #0#44;
    aCamp8      = #0#45;
    nCamp9      = #0#46;
    enSwBien    = -1;
    |SUB_EJECUTA_NP "dsmoz038";
|FPRC;

|RUTINA ClaveBaja361;
 #361#0 = #360#0;
 #361#1 = #360#1;
 #361#2 = 001;
|FRUT;

|RUTINA ClaveAlta361;
 #361#0 = #360#0;
 #361#1 = #360#1;
 #361#2 = 999;
|FRUT;


|PROCESO ConsulOpera;
   |ABRE #360;
   #360#0 = enEmpresa;
   #360#1 = #0#51;
   |LEE 001#360=;
   |SI FSalida ! 0;
       |MENAV "    No existe Operacion Financiera";
       |CIERRA #360;
       |ACABA;
   |FINSI;

   |PUSHV 0501 2380;
   |PINPA #0#360;
   |PINDA #0#360;
   |ENTLINEAL #1#361, -3, 4, 22, 1, ClaveBaja361, ClaveAlta361
   |CIERRA #360;
   |CLS;
   |POPV;
|FPRC;
