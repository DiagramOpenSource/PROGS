|FICHEROS;
     dsmozp81 #0;

     dsmom002 #2;
     dsmom004 #4;
     dsmom008 #8;

     dsmom080 #80;
     dsmom081 #81;
     dsmom082 #82;
     dsmom083 #83;

     dsmom107 #107;
     dsmom109 #109;
     dsmociva #300;

     dsmow086 #982,MANTE;
     dsmow087 #983,MANTE;

     dsmom030 #30;

     :/contagen/def/canempre #101;
     :/contagen/def/camaniva #102;
     :/contagen/def/caivalin #103;
     :/contagen/def/caivaasi #104;

     :/basica/def/agifigen #1000;
     :/basica/def/agicen14 #1014;
|FIN;

|VARIABLES;
     &eaPathBasica = "";
     aBase       = "";
     aPathModelo = "";
     aDef        = "";
     &aFichw82   = "";
     aFichero    = "";
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aAlfa3      = "";
     nNume1      = 0;
     nNume2      = 0;
     nPara1      = 0;
     nPara2      = 0;
     fFecha      = @;

     nModp81       = 0;
     nCampo        = 0;
     nDEmpresa     = 0;
     nHEmpresa     = 0;
     enGraba       = 0;
     nBaseImpo     = 0;
     nCuota        = 0;
     nDPeriodo     = 0;
     nHPeriodo     = 0;
     nEjer         = 0;

     nSwConPro   = 0;
     fFecIni     = @;
     fFecFin     = @;

     nSwContab   = 0;
     nSw         = 0;
     nReg109     = 0;
     nNumAct     = 0;
     nDepar      = 0;

     nSwSi       = 0;
     nIvaComun   = 0;
     nBuscoMod   = 0;
     nSwMod      = 0;
     aDComun     = "";
     aHComun     = "";
     nVentaSuI   = 0;
     nSwOpe82    = 0;
     &nSwOpe83   = 0;
     nIvaSop     = 0;
     nIvaSub     = 0;
     nIvaSop1    = 0;
     nIvaSop2    = 0;
     nIvaSop3    = 0;
     nIvaSop4    = 0;
     nIvaSop5    = 0;
     nIvaSop6    = 0;
     nIvaSop7    = 0;
     nIvaSop8    = 0;

     aTipo       = "";
     aLit        = "";
     nActivMas   = 0;
     aCNAE       = "";
     &aTipoPr    = "";
     &nTp100     = 0;
     &nAny       = 0;
     aParam      = "";
     nTodo       = 0;
     nCuenta     = 0;
     nSwComunero = 0;
     nSwPrimAct  = 0;
     nUnError    = 0;

    nReg99       = 0;
    nActiv       = 0;
    nBaja        = 0;
    nOpBa        = 0;
    nActiv1      = 0;

|FIN;

|INCLUYE i_variar;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO despuesejer; |TIPO 0;
 |SI #0#0 < enEjerPro;
     |PUSHV 0501 0880;
     |CUADRO 0512 0866;
     |ATRI P;
     |PINTA 0613, " EL CALCULO DEL IMPORTE DE PRORRATA POR ESTE PROCESO ";
     |PINTA 0713, " DE EJERCICIO ANTERIOR AL 2005 PUEDE NO SER CORRECTO.";
     |ATRI 0;
     |CONFI "0000NContinuar con el Proceso ";
     |SI FSalida ! 0;
         #0#0 = enEjerPro; |PINTA #0#0;
         |ERROR;
     |FINSI;
     |POPV;
 |FINSI;
|FPRC;

|PROCESO Ejercicio;  |TIPO 7;
     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#0   = aAlfa;
     |PINTA #0#0;
     aAlfa  = fFecha % 402;
     nNume1 = aAlfa;
     #0#15 = 12;
     |SI nNume1 ] 3; |Y nNume1 [ 5;  #0#15 = 3;  |FINSI;
     |SI nNume1 ] 6; |Y nNume1 [ 8;  #0#15 = 6;  |FINSI;
     |SI nNume1 ] 9; |Y nNume1 [ 11; #0#15 = 9;  |FINSI;
     |PINTA #0#15;
|FPRC;

|PROCESO Periodo;
     |HAZ NomPeriodo;
     |SI #0#16 = "          ";
         |MENAV "     Periodo Incorrecto.";
         |ERROR;
     |FINSI;

     |PINTA #0#15;
     |PINTA #0#16;
|FPRC;

|PROCESO NomPeriodo;
     #0#16 = "          ";
     |SI #0#15 = 1;   #0#16 = "ENERO     ";  |FINSI;
     |SI #0#15 = 2;   #0#16 = "FEBRERO   ";  |FINSI;
     |SI #0#15 = 3;   #0#16 = "MARZO     ";  |FINSI;
     |SI #0#15 = 4;   #0#16 = "ABRIL     ";  |FINSI;
     |SI #0#15 = 5;   #0#16 = "MAYO      ";  |FINSI;
     |SI #0#15 = 6;   #0#16 = "JUNIO     ";  |FINSI;
     |SI #0#15 = 7;   #0#16 = "JULIO     ";  |FINSI;
     |SI #0#15 = 8;   #0#16 = "AGOSTO    ";  |FINSI;
     |SI #0#15 = 9;   #0#16 = "SEPTIEMBRE";  |FINSI;
     |SI #0#15 = 10;  #0#16 = "OCTUBRE   ";  |FINSI;
     |SI #0#15 = 11;  #0#16 = "NOVIEMBRE ";  |FINSI;
     |SI #0#15 = 12;  #0#16 = "DICIEMBRE ";  |FINSI;
     |SI #0#15 = 99;  #0#16 = "ANUAL     ";  |FINSI;
|FPRC;

|PROCESO Parrilla;
     |SI #0#1 = 0;
         #0#1 = 0;  |PINTA #0#1;
         #0#2 = 0;  |PINTA #0#2;  |C_M #0#2, 1, "N";
         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#1, 1, "S";
             |C_M #0#2, 1, "S";
         |FINSI;

         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;
||*****************************************************************************
|| ////////////////////////////////////////////////////////// CALCULOS
|| .........................................................................
|| ................DATOS DESDE CONTABILIDAD ................................
|| .........................................................................
|PROCESO Borra_var;
      nIvaSop  = 0;
      nIvaSop1 = 0;
      nIvaSop2 = 0;
      nIvaSop3 = 0;
      nIvaSop4 = 0;
      nIvaSop5 = 0;
      nIvaSop6 = 0;
      nIvaSop7 = 0;
      nIvaSop8 = 0;
      nIvaSub  = 0;
      nVentaSuI = 0;
|FPRC;

|PROCESO GraboIvaComun;
    |ABRE #983;
    |DDEFECTO #983;
    #983#0 = #0#0;
    #983#1 = enEmpresa;
    #983#2 = 00;
    |LEE 001#983=;
    |SI FSalida ! 0;
       |DDEFECTO #983;
       #983#0  = #0#0;
       #983#1  = enEmpresa;
       #983#2  = 00;
       #983#3  = "IVA DEDUCIBLE OPERACIONES COMUNES ";
       #983#4  = "";
       #983#5  = "";
       |GRABA 020#983b;
    |FINSI;
    #983#18 = #983#18 + #0#24;
    #983#19 = #982#5;

    #983#24 = #983#24 + #0#17;
    #983#25 = #983#25 + #0#18;
    #983#26 = #983#26 + #0#19;
    #983#27 = #983#27 + #0#20;
    #983#28 = #983#28 + #0#21;
    #983#29 = #983#29 + #0#22;
    #983#30 = #983#30 + #0#23;

    #983#59 = #983#59 + #0#25;  || Simplificado
    |GRABA 020#983a;
    |CIERRA #983;
|FPRC;

|PROCESO Grupo2;
   || ... |SI #30#73="N";|ACABA;|FINSI; como en el pase, sin mirar este campo

    |SI #103#29 = "N";
         nIvaSop = nIvaSop + nCuota;
         |SI #30#28 = 1; nIvaSop1 = nIvaSop1 + nCuota; |FINSI;
         |SI #30#28 = 2; nIvaSop2 = nIvaSop2 + nCuota; |FINSI;
         |SI #30#28 = 3; nIvaSop3 = nIvaSop3 + nCuota; |FINSI;
         |SI #30#28 = 4; nIvaSop4 = nIvaSop4 + nCuota; |FINSI;
         |SI #30#28 = 5; nIvaSop5 = nIvaSop5 + nCuota; |FINSI;
         |SI #30#28 = 6; nIvaSop6 = nIvaSop6 + nCuota; |FINSI;
         |SI #30#28 = 7; nIvaSop7 = nIvaSop7 + nCuota; |FINSI;
    |SINO;
         #0#24 = #0#24 + nCuota;
         |SI #30#28 = 1; #0#17 = #0#17 + nCuota; |FINSI;
         |SI #30#28 = 2; #0#18 = #0#18 + nCuota; |FINSI;
         |SI #30#28 = 3; #0#19 = #0#19 + nCuota; |FINSI;
         |SI #30#28 = 4; #0#20 = #0#20 + nCuota; |FINSI;
         |SI #30#28 = 5; #0#21 = #0#21 + nCuota; |FINSI;
         |SI #30#28 = 6; #0#22 = #0#22 + nCuota; |FINSI;
         |SI #30#28 = 7; #0#23 = #0#23 + nCuota; |FINSI;
         nIvaComun = 1;
    |FINSI;
|FPRC;

|PROCESO Grupo4;
   || ... |SI #30#73="N";|ACABA;|FINSI; como en el pase, sin mirar este campo

    |SI #103#29 = "N";
         nIvaSop  = nIvaSop + nCuota;
         nIvaSop8 = nIvaSop8 + nCuota;
    |SINO;
         #0#24 = #0#24 + nCuota;
         #0#25 = #0#25 + nCuota;
         nIvaComun = 1;
    |FINSI;
|FPRC;

|PROCESO LeeLinea;
     aAlfa1 = #103#30; |QBF aAlfa1; |SI aAlfa1 = ""; #103#30 = #102#10; |FINSI;
     |SI aMulDep = "S";
         nDepar = #103#30;
         |SI nDepar = 0; nDepar = 1; |FINSI;
         |SI enActividad ! nDepar; |ACABA; |FINSI;
     |FINSI;

     #30#0 = #103#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;

     |SI #30#4 = "N";  |ACABA;  |FINSI;

     |SI #30#74 = "N";
         |SI #103#5 = "N"; |ACABA; |FINSI;  || si no es deducible, nada
         |SI #30#28 ! 0;   |HAZ Grupo2; |FINSI;
         |SI #30#32 ! 0;   |HAZ Grupo4; |FINSI;
     |SINO;

         nVentaSuI = nVentaSuI + nBaseImpo;
         nCuota    = (nBaseImpo % #30#75) ! EURODBMOD;
         nIvaSub   = nIvaSub + nCuota;
         |SI #30#28 ! 0; |Y #30#28 ! 11;
             nCuota = -nCuota;
             |HAZ Grupo2;
         |FINSI;

     |FINSI;
|FPRC;

|DEFBUCLE caivalin_sop;
     #103#1;
     29;                                  || Iva comun y deducible
     #102#0, #102#1, 01, aDComun;
     #102#0, #102#1, 99, aHComun;
     ;
     NULL, LeeLinea;
|FIN;

|DEFBUCLE caivalin_rep;
     #103#1;
     3;
     #102#0, #102#1, 01, 800;
     #102#0, #102#1, 99, 899;
     ;
     NULL, LeeLinea;
|FIN;

|PROCESO LeeCabecera;

     |SI aParam ! "";
         |SI #102#40 = 0; |O #102#40 > nHPeriodo;
             |ACABA;
         |FINSI;
     |FINSI;
     |SI aMulDep ! "S";
         nDepar = #102#10;
         |SI nDepar = 0; nDepar = 1; |FINSI;
         |SI enActividad ! nDepar; |ACABA; |FINSI;
     |FINSI;

     |SI #102#36 = "R"; |BUCLE caivalin_rep; |FINSI;
     |SI #102#36 = "S"; |BUCLE caivalin_sop; |FINSI;
|FPRC;

|DEFBUCLE camaniva;
     #102#1;
     5,36;
     00, 0000000000, nDPeriodo, "R";
     99, 9999999999, nHPeriodo, "S";
     e;
     NULL, LeeCabecera;
|FIN;

|PROCESO FicherosConta;

     |SI nSwPrimAct = 1;
         |SI enSwPartido = 1;
             |VETE Seguir;
         |FINSI;
     |FINSI;

     nSwContab = 0;
     enSwOpPar = 0;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;

         |ABRE #101;
         |SELECT #4#101;
         #101#2  = enEmpresa;
         #101#26 = nEjer;
         |LEE 040#101=;
         |SI FSalida ! 0;  |CIERRA #101;  |ACABA;   |FINSI;
         |SELECT #1#101;
         |CIERRA #101;

         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";

         enEmpresa  = #101#2;
         enPerConta = #101#3;
         eaLaMonEmp = #101#28;
     |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
     |FINSI;
     |HAZ EnConversor;
|ET Seguir;
     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;

     |ABRE #104;
     |LEE 040#104p;
     |SI FSalida ! 0;  |DDEFECTO #104;  |FINSI;
     aMulDep = #104#132;
     |CIERRA #104;

     nDPeriodo = 1;
     |SI #104#46 = "T";
         |SI enPeriodo [ 3;                     nHPeriodo = 1; |FINSI;
         |SI enPeriodo > 3;  |Y enPeriodo [ 6;  nHPeriodo = 2; |FINSI;
         |SI enPeriodo > 6;  |Y enPeriodo [ 9;  nHPeriodo = 3; |FINSI;
         |SI enPeriodo ] 10;                    nHPeriodo = 4; |FINSI;
     |SINO;
         nHPeriodo = enPeriodo;
     |FINSI;
     nSwContab = 1;
     #982#37   = enPerConta;
     nSwPrimAct = 1;
|FPRC;

|PROCESO dsmociva;
   |SI #300#7 = 11;
       nVentaSuI =  nVentaSuI + #300#12;
       nIvaSub   =  nIvaSub   + #300#13;
   |FINSI;
   |SI #300#7 = 1; nIvaSop = nIvaSop + #300#13; nIvaSop1 = nIvaSop1 + #300#13; |FINSI;
   |SI #300#7 = 2; nIvaSop = nIvaSop + #300#13; nIvaSop2 = nIvaSop2 + #300#13; |FINSI;
   |SI #300#7 = 3; nIvaSop = nIvaSop + #300#13; nIvaSop3 = nIvaSop3 + #300#13; |FINSI;
   |SI #300#7 = 4; nIvaSop = nIvaSop + #300#13; nIvaSop4 = nIvaSop4 + #300#13; |FINSI;
   |SI #300#7 = 5; nIvaSop = nIvaSop + #300#13; nIvaSop5 = nIvaSop5 + #300#13; |FINSI;
   |SI #300#7 = 6; nIvaSop = nIvaSop + #300#13; nIvaSop6 = nIvaSop6 + #300#13; |FINSI;
   |SI #300#7 = 7; nIvaSop = nIvaSop + #300#13; nIvaSop7 = nIvaSop7 + #300#13; |FINSI;

   |SI enActividad = 99; nReg99 = 1; |FINSI;
|FPRC;

|DEFBUCLE dsmociva;
    #300#1;
    ;
    enEmpresa, #0#0,        01, nModp81, 00, enActividad, 2, 00;
    enEmpresa, #0#0, enPeriodo, nModp81, 99, enActividad, 2, 99;
    ;
    NULL, dsmociva;
|FIN;

|PROCESO LeeElModelo;
 |SI #2#8 > "01.01.0000";
     |SI #2#8 > fFecFin;  |ACABA;  |FINSI;
 |FINSI;
 |SI #2#9 > "01.01.0000";
     |SI #2#9 < fFecIni;  |ACABA;  |FINSI;
 |FINSI;

 nModp81 = #2#2;

 |SI nBuscoMod = 1;
     |SI nModp81 = 300; |O nModp81 = 320; |O nModp81 = 330; |O nModp81 = 332;
         |O nModp81 = 310; |O nModp81 = 311; |O nModp81 = 370;
            nSwMod = 1;
            |ERROR10;
     |FINSI;
     |ACABA;
 |FINSI;

 |SI nModp81 = 300; |O nModp81 = 320; |O nModp81 = 330; |O nModp81 = 332;
     |BUCLE dsmociva;
 |FINSI;
 |SI nModp81 = 310; |O nModp81 = 311;
     || ... Lee el 310
 |FINSI;
 |SI nModp81 = 370;
     |BUCLE dsmociva;
     || ... Lee el 310
 |FINSI;
|FPRC;

|DEFBUCLE LeeElModelo;
  #2#1;
  ;
  enEmpresa, enActividad, 300;
  enEmpresa, enActividad, 371;
  ;
  NULL, LeeElModelo;
|FIN;

|PROCESO ActivRegul99;  || Proceso nuevo para el calculo de la regul.

      nReg99   = 0;
      enActividad = 99;
      |HAZ Borra_var;

      nModp81 = 300; |BUCLE dsmociva;
      nModp81 = 320; |BUCLE dsmociva;
      nModp81 = 330; |BUCLE dsmociva;
      nModp81 = 332; |BUCLE dsmociva;
      nModp81 = 370; |BUCLE dsmociva;

      |SI nReg99 = 1;
          |ABRE #983;
          |DDEFECTO #983;
          #983#0 = #0#0;
          #983#1 = enEmpresa;
          #983#2 = 99;
          |LEE 101#983=;
          |SI FSalida ! 0;
              |DDEFECTO #983;
              #983#0  = #0#0;
              #983#1  = enEmpresa;
              #983#2  = 99;
              #983#3  = "REGISTRO DE REGULARIZACION";
              #983#4  = "";
              #983#19  = #982#5;
              |GRABA 020#983b;
          |FINSI;
          #983#17 = #983#17 + nIvaSub;
          #983#18 = #983#18 + nIvaSop;

          #983#24 = #983#24 + nIvaSop1;
          #983#25 = #983#25 + nIvaSop2;
          #983#26 = #983#26 + nIvaSop3;
          #983#27 = #983#27 + nIvaSop4;
          #983#28 = #983#28 + nIvaSop5;
          #983#29 = #983#29 + nIvaSop6;
          #983#30 = #983#30 + nIvaSop7;
          #983#59 = #983#59 + nIvaSop8;
          |GRABA 020#983a;
          |CIERRA #983;
     |FINSI;
|FPRC;

|| ================================ Proceso Principal
|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
|PROCESO ElCalcul;

  #983#20 = #983#18 % #983#19;

  #983#31 = #983#24 % #983#19;
  #983#32 = #983#25 % #983#19;
  #983#33 = #983#26 % #983#19;
  #983#34 = #983#27 % #983#19;
  #983#35 = #983#28 % #983#19;
  #983#36 = #983#29 % #983#19;
  #983#37 = #983#30 % #983#19;
  #983#60 = #983#59 % #983#19; || simplificado
  #983#20 = #983#18 % #983#19;

  |SI enPeriodo = 12;

      #983#22 = #983#20 - #983#21;

      #983#45 = #983#31 - #983#38;
      #983#46 = #983#32 - #983#39;
      #983#47 = #983#33 - #983#40;
      #983#48 = #983#34 - #983#41;
      #983#49 = #983#35 - #983#42;
      #983#50 = #983#36 - #983#43;
      #983#51 = #983#37 - #983#44;

      #983#62 = #983#60 - #983#61;

  |SINO;
      #983#22 = #983#20;

      #983#45 = #983#31;
      #983#46 = #983#32;
      #983#47 = #983#33;
      #983#48 = #983#34;
      #983#49 = #983#35;
      #983#50 = #983#36;
      #983#51 = #983#37;

      #983#62 = #983#60;
  |FINSI;

  #983#23 = #983#18 - #983#20;

  #983#52 = #983#24 - #983#31;
  #983#53 = #983#25 - #983#32;
  #983#54 = #983#26 - #983#33;
  #983#55 = #983#27 - #983#34;
  #983#56 = #983#28 - #983#35;
  #983#57 = #983#29 - #983#36;
  #983#58 = #983#30 - #983#37;

  #983#63 = #983#59 - #983#60;

|FPRC;

|PROCESO Antesm083;
 |SI #83#3 = enPeriodo;
     |ACABA;
 |FINSI;

 #983#17 = #983#17 - #83#9;

 |SI #83#3 ! 12;
     #83#40 = #83#17; #83#41 = #83#18;
     #83#42 = #83#19; #83#43 = #83#20;
     #83#44 = #83#17; #83#45 = #83#22;
     #83#46 = #83#23; #83#59 = #83#56;
 |FINSI;

 |SI enPeriodo ! 12;

     #983#18 = #983#18 - #83#4;

     #983#24 = #983#24 - #83#10;
     #983#25 = #983#25 - #83#11;
     #983#26 = #983#26 - #83#12;
     #983#27 = #983#27 - #83#13;
     #983#28 = #983#28 - #83#14;
     #983#29 = #983#29 - #83#15;
     #983#30 = #983#30 - #83#16;

     #983#59 = #983#59 - #83#55;  ||simplificado
 |FINSI;

 #983#21 = #983#21 + #83#39;  ||Acumulado deducido periodo

 #983#38 = #983#38 + #83#40;
 #983#39 = #983#39 + #83#41;
 #983#40 = #983#40 + #83#42;
 #983#41 = #983#41 + #83#43;
 #983#42 = #983#42 + #83#44;
 #983#43 = #983#43 + #83#45;
 #983#44 = #983#44 + #83#46;

 #983#61 = #983#61 + #83#59;
|FPRC;

|DEFBUCLE Antesm083;
 #83#1;
 ;
 enEmpresa, #0#0, enActividad, 01;
 enEmpresa, #0#0, enActividad, enPeriodo;
 e;
 NULL, Antesm083;
|FIN;

|PROCESO LeeElAux83;

  enActividad = #983#2;

  |SI nSwOpe83 = 0;   || = Calcular las Cuotas por Actividad

      |SI enActividad = 99; |O enActividad = 00; |ACABA; |FINSI;

      |HAZ Borra_var;

      aAlfa1 = #983#16; |QBF aAlfa1;
      |SI aAlfa1 = "REGISTROS";

          |HAZ FicherosConta
          |SI nSwContab = 0;  |ACABA;  |FINSI;

          nSwMod      = 0;
          nBuscoMod   = 1;
          |BUCLE LeeElModelo;
          aDComun = "N"; aHComun = "S";
          |SI nSwMod = 0; aDComun = "S"; |FINSI; ||Solo comun

          |ABRE #30;
          |BUCLE camaniva;
          |CIERRA #30;

      |SINO;
         nBuscoMod   = 0;
         |BUCLE LeeElModelo
      |FINSI;

      #983#17 = #983#17 + nIvaSub;
      #983#18 = #983#18 + nIvaSop;

      #983#24 = #983#24 + nIvaSop1;
      #983#25 = #983#25 + nIvaSop2;
      #983#26 = #983#26 + nIvaSop3;
      #983#27 = #983#27 + nIvaSop4;
      #983#28 = #983#28 + nIvaSop5;
      #983#29 = #983#29 + nIvaSop6;
      #983#30 = #983#30 + nIvaSop7;
      #983#59 = #983#59 + nIvaSop8;
      |GRABA 020#983a;
  |FINSI;

  |SI nSwOpe83 = 1;   || = Calcular las Cuotas por Actividad
      |BUCLE Antesm083;
      |HAZ ElCalcul;
      |GRABA 020#983a;
  |FINSI;

  |SI nSwOpe83 = 2;   || = Total Empresa
      |SI #983#17 ! 0; |O #983#18 ! 0; |O #983#20 ! 0;
          #982#36 = "S";
      |FINSI;

      #982#13 = #982#13 + #983#17;  || subvenciones
      #982#10 = #982#10 + #983#18;  || total deducible
      #982#11 = #982#11 + #983#20;  || deducido
      #982#12 = #982#10 - #982#11;  || diferencia
      #982#14 = #982#14 + #983#21;  || Acumulado
      #982#15 = #982#15 + #983#22;  || este periodo

      #982#18 = #982#18 + #983#24;
      #982#19 = #982#19 + #983#25;
      #982#20 = #982#20 + #983#26;
      #982#21 = #982#21 + #983#27;
      #982#22 = #982#22 + #983#28;
      #982#23 = #982#23 + #983#29;
      #982#24 = #982#24 + #983#30;
      #982#34 = #982#34 + #983#59; ||simpli

      #982#25 = #982#25 + #983#31;
      #982#26 = #982#26 + #983#32;
      #982#27 = #982#27 + #983#33;
      #982#28 = #982#28 + #983#34;
      #982#29 = #982#29 + #983#35;
      #982#30 = #982#30 + #983#36;
      #982#31 = #982#31 + #983#37;

      #982#35 = #982#35 + #983#60;

  |FINSI;
|FPRC;

|DEFBUCLE LeeElAux83;
 #983#1;
 ;
 #0#0, enEmpresa, 00;
 #0#0, enEmpresa, 99;
 ;
 NULL, LeeElAux83;
|FIN;

|PROCESO GraboDatos;
    enEmpresa = #982#1;

    |SI nSwOpe82 = 0;   || Calculo de Las cuotas de Iva  por actividad
        nSwPrimAct  = 0;
        enSwPartido = 0;

        |PDEFECTO #0, 17, 26;
        nIvaComun = 0;
        nSwOpe83  = 0;
        |BUCLE LeeElAux83;

        |HAZ ActivRegul99;

        |SI nIvaComun = 1;
            |HAZ GraboIvaComun;
        |FINSI;

        |GRABA 020#982a;
        |LIBERA #982;
        nCuenta = nCuenta + 1;

        |SI enSwPartido = 1;
            enSwOpPar   = 2;
            |HAZ FinalPartido;
        |FINSI;

        |ACABA;
    |FINSI;

    |SI nSwOpe82 = 1;   || Diferencia
        |PDEFECTO #0, 17, 26;
        nSwOpe83  = 1;
        |BUCLE LeeElAux83;

        nSwOpe83 = 2;
        #982#36 = "N";
        |BUCLE LeeElAux83;

        |SI #982#3 ! "E"; |Y #982#4 = 100; |Y #982#13 = 0; |Y #982#12 = 0;
            #982#36 = "N";
        |FINSI;
        |SI nCuenta = 1; #982#36 = "S"; |FINSI;

        |GRABA 020#982a;
        |LIBERA #982;

    |FINSI;
|FPRC;

|DEFBUCLE dsmow082;
 #982#1;
 ;
 #0#0, 00001;
 #0#0, 99999;
 ;
 NULL, GraboDatos;
|FIN;

|| ========================================================================
|| ============= Primera Parte, ver que empresas tiene que aplicar Prorrata
|| ========================================================================
|| ................. Grabo registro por Empresa
|PROCESO GraboAx82;
    |DDEFECTO #982;
    #982#0  = #0#0;
    #982#1  = enEmpresa;
    #982#2  = #1000#1;
    |SI enPeriodo = 12;
        #982#3  = #80#4;
        #982#4  = #80#5;
        #982#5  = #80#32;
    |SINO;
        #982#3  = #80#2;
        #982#4  = #80#3;
        #982#5  = #80#31;
    |FINSI;
    #982#6  = #1000#13;
    #982#17 = nNumAct;
    #982#32 = #0#15;
    #982#33 = #0#16;
    #982#7  = #82#61;
    #982#8  = #82#30;  ||aplicado S/N
    #982#38 = nSwComunero;
    |GRABA 000#982n;
    enGraba = 1;

|FPRC;

|| ... Grabo Registro por Empresa-Actividad

|PROCESO GrAux83_00y99;
     |ABRE #81;
     #81#0 = enEmpresa;
     #81#1 = #0#0;
     #81#2 = nActiv;
     |LEE 001#81=;
     |SI FSalida = 0;
         nSwSi = 1;
     |SINO;
         |SI enPeriodo ! 12;
             #81#0 = enEmpresa;
             #81#1 = #0#0 - 1;
             #81#2 = nActiv;
             |LEE 001#81=;
             |SI FSalida = 0;
                 #81#0 = enEmpresa;
                 #81#1 = #0#0;
                 #81#2 = nActiv;
                 #81#5 = #81#6;
                 |PDEFECTO #81,6,40;
                 |GRABA 020#81b;
                 nSwSi = 1;
             |FINSI;
         |FINSI;
    |FINSI;
    |CIERRA #81;
    |SI nSwSi = 1;
        |DDEFECTO #983;
        #983#0 = #0#0;
        #983#1 = enEmpresa;
        #983#2 = nActiv;
        |LEE 001#983=;
        |SI FSalida ! 0;
            |DDEFECTO #983;
            #983#0 = #0#0;
            #983#1 = enEmpresa;
            #983#2 = nActiv;
            #983#3 = #81#3;  ||Nombre actividad
            #983#4 = #81#4;  || cnae
            |SI enPeriodo = 12;
                #983#19 = #81#6;
            |SINO;
                #983#19 = #81#5;
            |FINSI;
            |SI #983#19 = 0; #983#19 = 100; |FINSI;
            |GRABA 020#983c;
       |FINSI;
  |FINSI;
|FPRC;

|PROCESO GraboAux83;

     nSwSi = 0;
     |ABRE #81;
     #81#0 = enEmpresa;
     #81#1 = #0#0;
     #81#2 = nDepar;
     |LEE 001#81=;
     |SI FSalida = 0;
         nSwSi = 1;
     |SINO;
         |SI enPeriodo ! 12;
             #81#0 = enEmpresa;
             #81#1 = #0#0 - 1;
             #81#2 = nDepar;
             |LEE 001#81=;
             |SI FSalida = 0;
                 #81#0 = enEmpresa;
                 #81#1 = #0#0;
                 #81#2 = nDepar;
                 #81#5 = #81#6;
                 |PDEFECTO #81,6,40;
                 |GRABA 020#81b;
                 nSwSi = 1;
             |FINSI;
         |FINSI;
    |FINSI;
    |CIERRA #81;
    |SI nSwSi = 0;
        #81#5 = #80#3;
        #81#6 = #80#5;
    |FINSI;
    |SI #80#2 ! "E";
        |SI #81#5 ! #80#3; #81#5 = #80#3; |FINSI;
    |FINSI;
    |SI #80#4 ! "E";
        |SI #81#6 ! #80#5; #81#6 = #80#5; |FINSI;
    |FINSI;

    |SI #81#5 > 100; #81#5 = 100; |FINSI;
    |SI #81#6 > 100; #81#6 = 100; |FINSI;

    |DDEFECTO #983;
    #983#0 = #0#0;
    #983#1 = enEmpresa;
    #983#2 = nDepar;
    |LEE 001#983=;
    |SI FSalida ! 0;
        |DDEFECTO #983;
        #983#0 = #0#0;
        #983#1 = enEmpresa;
        #983#2 = nDepar;
        #983#3 = #1014#4;   ||Nombre actividad
        #983#4 = #1014#20;  || cnae
        #983#5 = #1014#3;   || epigrafe
        #983#6 = #1014#7;   || iva
        #983#7 = #1014#8;
        #983#8  = #1000#87;
        #983#9  = #1000#88;
        #983#10 = #1014#9;
        #983#11 = #1014#10;
        #983#12 = #1014#16;
        #983#13 = #1014#17;
        |SI #1014#5 > "01.01.0000"; #983#14 = #1014#5; |FINSI;
        |SI #1014#6 > "01.01.0000"; #983#15 = #1014#6; |FINSI;
        #983#16 = #1014#15;

        |SI enPeriodo = 12;
            #983#19 = #81#6;
        |SINO;
            #983#19 = #81#5;
        |FINSI;

        |GRABA 020#983c;
    |FINSI;
|FPRC;


|PROCESO PrimerFiltro;  || Mas de una Actividad
 |SI #1014#5 > "01.01.0000";
     |SI #1014#5 > fFecFin;  |ACABA;  |FINSI;
 |FINSI;
 |SI #1014#6 > "01.01.0000";
     |SI #1014#6 < fFecIni;  |ACABA; |FINSI; || Baja
 |FINSI;

 |SI #1014#14 = "S"; nSwComunero = 1; |ACABA; |FINSI;  || dia 08.06.2005 comunero

 nDepar = #1014#1;
 |HAZ GraboAux83;
 nNumAct = nNumAct + 1;
|FPRC;

|DEFBUCLE LeeActividades;
 #1014#1;
 ;
 enEmpresa, 01;
 enEmpresa, 99;
 ;
 NULL, PrimerFiltro;
|FIN;

|| ..........................................
|PROCESO MirarFiltros;
     enEmpresa = #1000#0;

     nSwSi = 0;     ||Lee Calculo de Prorrata
     |ABRE #80;
     |DDEFECTO #80;
     #80#0 = enEmpresa;
     #80#1 = #0#0;
     |LEE 001#80=;
     |SI FSalida = 0;
         nSwSi = 1;
     |SINO;
         |SI enPeriodo ! 12;
             #80#0 = enEmpresa;
             #80#1 = #0#0 - 1;
             |LEE 001#80=;
             |SI FSalida = 0;
                 #80#0 = enEmpresa;
                 #80#1 = #0#0;
                 #80#2 = #80#4;
                 #80#3 = #80#5;
                 |PDEFECTO #80, 4, 31;
                 #80#31 = #80#32;
                 |PDEFECTO #80,32, 43;
                 |GRABA 020#80b;
                 nSwSi = 1;
             |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #80;

     |SI #80#2 = "N"; #80#3 = 100; |FINSI;
     |SI #80#4 = "N"; #80#5 = 100; |FINSI;
     |SI #80#3  > 100; #80#3  = 100; |FINSI;
     |SI #80#5  > 100; #80#5  = 100; |FINSI;
     |SI #80#31 > 100; #80#31 = 100; |FINSI;
     |SI #80#32 > 100; #80#32 = 100; |FINSI;

     |ABRE #82;
     |DDEFECTO #82;
     #82#0 = enEmpresa;
     #82#1 = #0#0;
     #82#2 = #0#15;
     |LEE 001#82=;
     |SI FSalida ! 0;
         |SI aParam = "todo";  nUnError = 1;  |FINSI;
     |FINSI;
     |CIERRA #82;
     |SI #82#61 = "N"; |Y nUnError = 0; |Y #82#2 ! 12; nSwSi = 0; |FINSI;  || no vuelvo a calcular

     |SI #82#4 > 100; #82#4 = 100; |FINSI;

     |SI nSwSi = 1;
         nNumAct     = 0;
         nSwComunero = 0;
         |ABRE #983;
         |BUCLE LeeActividades;   || Graba Actividades
         nActiv = 00; |HAZ GrAux83_00y99;
         nActiv = 99; |HAZ GrAux83_00y99;
         |CIERRA #983;

         |HAZ GraboAx82;
     |FINSI;
|FPRC;

|DEFBUCLE agifigen;
 #1000#1;
 ;
 nDEmpresa;
 nHEmpresa;
 ;
 NULL, MirarFiltros;
|FIN;

|| ========================================================================
|PROCESO Sup180;
 #982#0 = #0#0;
 #982#1 = 0;
 #982#36 = "S";
|FPRC;

|PROCESO Inf180;
 #982#0 = #0#0;
 #982#1 = 99999;
 #982#36 = "S";
|FPRC;


|PROCESO Tipo3;  |TIPO 3;

    aAlfa     = #0#0;
    aAlfa     = aAlfa % -102;
    nEjer     = aAlfa;       || ejercicio contable de canempre
    enEjer    = #0#0;
    enPeriodo = #0#15;

    |HAZ LeeCtrlProrr;

     aAlfa1 = #0#0;
     aAlfa1 = "01.01." + aAlfa1; fFecIni = aAlfa1;
     aAlfa1 = #0#0;
     aAlfa1 = "31.12." + aAlfa1; fFecFin = aAlfa1;

     nCuenta = 0;
     |ABRE #982;
     |SI #0#1 ! 0;
         nDEmpresa = #0#1;
         nHEmpresa = #0#2;
         |BUCLE agifigen;
     |SINO;
         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               nDEmpresa = #0nCampo;
               nHEmpresa = #0nCampo;
               |BUCLE agifigen;
         |SIGUE;
     |FINSI;
     |CIERRA #982;

     |SI enGraba = 1;

         nSwOpe82 = 0;
         |BUCLE dsmow082;  ||totales

         nSwOpe82 = 1;
         |BUCLE dsmow082;  ||Calculo

         |SI enSinPantalla = 0;
             |PINPA #0#982;
             |SI enPeriodo = 12;
                 |ATRI S; |PINTA 1221, "Acumulados total de Ejercicio "; |ATRI 0;
             |FINSI;
             |ENTLINEAL #2#982, -3, 4, 22, 0, Sup180, Inf180;
             |SI FSalida = 0;
                 |CONFI "    SCONFORME CON LOS CALCULOS REALIZADOS S/N";
                 |SI FSalida = 0;
                     |HAZ PasaDatosBuenos;
                 |FINSI;
              |FINSI;
         |SINO;
              |HAZ PasaDatosBuenos;
         |FINSI;
     |SINO;
         |SI enSinPantalla = 0;
             |MENAV "     Seleccion Vacia.";
         |FINSI;
     |FINSI;

|FPRC;


|PROGRAMA;
     nActiv1 = enActividad;
     aParam = PARAMETRO; |QBF aParam;

     |SI aParam = "";
        |ABRE #107;
        |DDEFECTO #107;
        |LEE 040#107p;
        |CIERRA #107;
        |SI #107#9 = "N"; |ACABA; |FINSI;
     |FINSI;

     aFichw82 = ("86w" + Usuario) % 108;
     |NOME_DAT #982 aFichw82;
     aFichero = ("87w" + Usuario) % 108;
     |NOME_DAT #983 aFichero;

     |DELINDEX #982;
     |DELINDEX #983;

     |SI enEmpresa ! 0;
         |DDEFECTO #0;
         #0#0  = enEjer;
         #0#1  = enEmpresa;
         #0#2  = enEmpresa;
         |SI aParam = "todo";
             nTodo = enPeriodo;
             |PARA enPeriodo = 3; |SI enPeriodo [ nTodo; |HACIENDO enPeriodo = enPeriodo + 3;
                   enSinPantalla = 1;
                   #0#15 = enPeriodo;
                   |HAZ NomPeriodo;
                   |HAZ Tipo3;
                   |DELINDEX #982;
                   |DELINDEX #983;
                   enSinPantalla = 0;
             |SIGUE;
             enPeriodo = nTodo;
         |SINO;
             #0#15 = enPeriodo;
             |HAZ NomPeriodo;
             |HAZ Tipo3;
         |FINSI;
    |SINO;
         |MANTE #0;
    |FINSI;

    |DELINDEX #982;
    |DELINDEX #983;
    enActividad = nActiv1;
|FPRO;

|| **************************************************************************
|| .... .... ... .. .. ACTUALIZA FICHERO CORRECTO
|PROCESO SiExis83;
 |SI nOpBa = 0;
     |SI enPeriodo ! #83#3;
         nBaja = 1;
     |SINO;
         |PDEFECTO #83,4,61;
         |GRABA 020#83a;
     |FINSI;
 |FINSI;
 |SI nOpBa = 1;
     |BORRA 020#83a;
 |FINSI;
 |LIBERA #83;
|FPRC;

|DEFBUCLE SiExis83;
 #83#1;
 ;
 #81#0,#81#1,#81#2,01;
 #81#0,#81#1,#81#2,enPeriodo;
 be;
 NULL, SiExis83;
|FIN;

|PROCESO SiExiste;
 #983#0 = #81#1;
 #983#1 = #81#0;
 #983#2 = #81#2;
 |LEE 101#983=;
 |SI FSalida ! 0;
     nBaja = 0;
     nOpBa = 0;
     |BUCLE SiExis83;
     |SI nBaja = 0;
         nOpBa = 1;
         |BUCLE SiExis83;
         |BORRA 020#81a;
     |FINSI;
 |FINSI;
 |LIBERA #81;
|FPRC;

|DEFBUCLE SiExiste;
 #81#1;
 ;
 #982#1, #982#0, 00;
 #982#1, #982#0, 99;
 be;
 NULL, SiExiste;
|FIN;

|PROCESO LeeActPerio;


  #81#12 = #81#12 + #83#9; || Iva subvenciones

  #83#31 = #0#24;

  #83#32 = #0#17;
  #83#33 = #0#18;
  #83#34 = #0#19;
  #83#35 = #0#20;
  #83#36 = #0#21;
  #83#37 = #0#22;
  #83#38 = #0#23;
  #83#58 = #0#25; || simp

 |SI #83#3 ! 12;
     #83#40 = #83#17; #83#41 = #83#18;
     #83#42 = #83#19; #83#43 = #83#20;
     #83#44 = #83#17; #83#45 = #83#22;
     #83#46 = #83#23;
 |FINSI;
  |SI #83#3 ! 12;
      #81#11 = #81#11 + #83#4;
      #81#13 = #81#13 + #83#6;

      #81#16 = #81#16 + #83#10;
      #81#17 = #81#17 + #83#11;
      #81#18 = #81#18 + #83#12;
      #81#19 = #81#19 + #83#13;
      #81#20 = #81#20 + #83#14;
      #81#21 = #81#21 + #83#15;
      #81#22 = #81#22 + #83#16;
      #81#37 = #81#37 + #83#55;

      #81#23 = #81#23 + #83#17;
      #81#24 = #81#24 + #83#18;
      #81#25 = #81#25 + #83#19;
      #81#26 = #81#26 + #83#20;
      #81#27 = #81#27 + #83#21;
      #81#28 = #81#28 + #83#22;
      #81#29 = #81#29 + #83#23;
      #81#38 = #81#38 + #83#56;

  |SINO;

      |SI #83#3 = enPeriodo;
          #83#47 = #81#11;
          #83#48 = #81#16;
          #83#49 = #81#17;
          #83#50 = #81#18;
          #83#51 = #81#19;
          #83#52 = #81#20;
          #83#53 = #81#21;
          #83#54 = #81#22;
          #83#60 = #81#37;

          #81#11 = #83#4;
          #81#13 = #83#6;

          #81#16 = #83#10;
          #81#17 = #83#11;
          #81#18 = #83#12;
          #81#19 = #83#13;
          #81#20 = #83#14;
          #81#21 = #83#15;
          #81#22 = #83#16;
          #81#37 = #83#55;

          #81#23 = #83#17;
          #81#24 = #83#18;
          #81#25 = #83#19;
          #81#26 = #83#20;
          #81#27 = #83#21;
          #81#28 = #83#22;
          #81#29 = #83#23;
          #81#38 = #83#56;
     |FINSI;
  |FINSI;

  #81#14 = #81#11 - #81#13;

  #81#30 = #81#16 - #81#23;
  #81#31 = #81#17 - #81#24;
  #81#32 = #81#18 - #81#25;
  #81#33 = #81#19 - #81#26;
  #81#34 = #81#20 - #81#27;
  #81#35 = #81#21 - #81#28;
  #81#36 = #81#22 - #81#29;
  #81#39 = #81#37 - #81#38;

  #0#24 = #0#24 + #83#39;

  #0#17 = #0#17 + #83#40;
  #0#18 = #0#18 + #83#41;
  #0#19 = #0#19 + #83#42;
  #0#20 = #0#20 + #83#43;
  #0#21 = #0#21 + #83#44;
  #0#22 = #0#22 + #83#45;
  #0#23 = #0#23 + #83#46;
  #0#25 = #0#25 + #83#59;

  |GRABA 020#83a;
  |LIBERA #83;

|FPRC;

|DEFBUCLE LeeActPerio;
 #83#1;
 ;
 #81#0, #81#1, #81#2, 01;
 #81#0, #81#1, #81#2, 12;
 ;
 NULL, LeeActPerio;
|FIN;

|PROCESO ActActividad;

 #81#0 = enEmpresa;
 #81#1 = nAny;
 #81#2 = #983#2;
 |LEE 101#81=;
 |SI FSalida ! 0;
     |DDEFECTO #81;
     #81#0 = enEmpresa;
     #81#1 = nAny;
     #81#2 = #983#2;
     #81#3 = #983#3;
     #81#4 = #983#4;
     |SI enPeriodo = 12;
         #81#6 = #983#19;
     |SINO;
         #81#5 = #983#19;
     |FINSI;
     |GRABA 020#81b;
 |FINSI;

 |SI enPeriodo = 12;
     #81#6 = #983#19;
 |SINO;
     #81#5 = #983#19;
 |FINSI;

 |ABRE #83;
 #83#0 = enEmpresa;
 #83#1 = nAny;
 #83#2 = #81#2;
 #83#3 = enPeriodo;
 |LEE 101#83=;
 |SI FSalida ! 0;
     #83#0 = enEmpresa;
     #83#1 = nAny;
     #83#2 = #81#2;
     #83#3 = enPeriodo;
     |GRABA 020#83b;
 |FINSI;

 |PDEFECTO #83, 4, 61;
 #83#8 = #0#16;

 #83#4  = #983#18; ||iva total

 #83#10 = #983#24;
 #83#11 = #983#25;
 #83#12 = #983#26;
 #83#13 = #983#27;
 #83#14 = #983#28;
 #83#15 = #983#29;
 #83#16 = #983#30;
 #83#55 = #983#59;

 #83#5  = #983#19; || % por cien

 #83#31 = #983#21; || Acumulado

 #83#32 = #983#38;
 #83#33 = #983#39;
 #83#34 = #983#40;
 #83#35 = #983#41;
 #83#36 = #983#42;
 #83#37 = #983#43;
 #83#38 = #983#44;
 #83#58 = #983#61;

 #83#6  = #983#20; || deducido

 #83#17 = #983#31;
 #83#18 = #983#32;
 #83#19 = #983#33;
 #83#20 = #983#34;
 #83#21 = #983#35;
 #83#22 = #983#36;
 #83#23 = #983#37;
 #83#56 = #983#60;

 #83#7  = #983#18 - #983#20;

 #83#24 = #983#24 - #983#31;
 #83#25 = #983#25 - #983#32;
 #83#26 = #983#26 - #983#33;
 #83#27 = #983#27 - #983#34;
 #83#28 = #983#28 - #983#35;
 #83#29 = #983#29 - #983#36;
 #83#30 = #983#30 - #983#37;
 #83#57 = #983#59 - #983#60;

 #83#39 = #983#22; || ese periodo

 #83#40 = #983#45; || ese periodo
 #83#41 = #983#46; || ese periodo
 #83#42 = #983#47; || ese periodo
 #83#43 = #983#48; || ese periodo
 #83#44 = #983#49; || ese periodo
 #83#45 = #983#50; || ese periodo
 #83#46 = #983#51; || ese periodo
 #83#59 = #983#62; || ese periodo

 #83#8  = #0#16;
 #83#9  = #983#17;

 |SI #982#8 = "N";
     #83#39 = #83#4;

     #83#40 = #83#10; #83#41 = #83#11;
     #83#42 = #83#12; #83#43 = #83#13;
     #83#44 = #83#14; #83#45 = #83#15;
     #83#46 = #83#16; #83#59 = #83#55;

     #83#7 = 0;

     #83#24 = 0; #83#25 = 0;
     #83#26 = 0; #83#27 = 0;
     #83#28 = 0; #83#29 = 0;
     #83#30 = 0; #83#57 = 0;

     |SI enPeriodo = 12;
         #83#39 = #83#4 - #83#31;

         #83#40 = #83#10 - #83#32;
         #83#41 = #83#11 - #83#33;
         #83#42 = #83#12 - #83#34;
         #83#43 = #83#13 - #83#35;
         #83#44 = #83#14 - #83#36;
         #83#45 = #83#15 - #83#37;
         #83#46 = #83#16 - #83#38;
         #83#59 = #83#55 - #83#58;
     |FINSI;
 |FINSI;
 |GRABA 020#83a;

 #82#3 = #82#3 + #83#4;
 #82#8 = #82#8 + #83#9;

 #82#9  = #82#9  + #83#10;
 #82#10 = #82#10 + #83#11;
 #82#11 = #82#11 + #83#12;
 #82#12 = #82#12 + #83#13;
 #82#13 = #82#13 + #83#14;
 #82#14 = #82#14 + #83#15;
 #82#15 = #82#15 + #83#16;
 #82#55 = #82#55 + #83#55;

 #82#5 = #82#5 + #83#6;

 #82#16 = #82#16 + #83#17;
 #82#17 = #82#17 + #83#18;
 #82#18 = #82#18 + #83#19;
 #82#19 = #82#19 + #83#20;
 #82#20 = #82#20 + #83#21;
 #82#21 = #82#21 + #83#22;
 #82#22 = #82#22 + #83#23;
 #82#56 = #82#56 + #83#56;

 #82#6 = #82#6 + #83#7;

 #82#23 = #82#23 + #83#24;
 #82#24 = #82#24 + #83#25;
 #82#25 = #82#25 + #83#26;
 #82#26 = #82#26 + #83#27;
 #82#27 = #82#27 + #83#28;
 #82#28 = #82#28 + #83#29;
 #82#29 = #82#29 + #83#30;
 #82#57 = #82#57 + #83#57;

 #82#30 = #982#8;

 #82#39 = #82#39 + #83#39;

 #82#40 = #82#40 + #83#40;
 #82#41 = #82#41 + #83#41;
 #82#42 = #82#42 + #83#42;
 #82#43 = #82#43 + #83#43;
 #82#44 = #82#44 + #83#44;
 #82#45 = #82#45 + #83#45;
 #82#46 = #82#46 + #83#46;
 #82#59 = #82#59 + #83#59;

 |LIBERA #83;
 |CIERRA #83;

 |PDEFECTO #0,17,26;
 #81#11 = 0; #81#12 = 0;
 #81#13 = 0; #81#14 = 0;
 |PDEFECTO #81,16,40;

 |BUCLE LeeActPerio;

 |GRABA 020#81a;
 |LIBERA #81;
|FPRC;

|DEFBUCLE ActActividad;
 #983#1;
 ;
 #982#0, #982#1, 00;
 #982#0, #982#1, 99;
 ;
 NULL, ActActividad;
|FIN;

|PROCESO ActPeriodos;

  #80#11 = #80#11 + #82#8;

  #82#31 = #0#24;

  #82#32 = #0#17;
  #82#33 = #0#18;
  #82#34 = #0#19;
  #82#35 = #0#20;
  #82#36 = #0#21;
  #82#37 = #0#22;
  #82#38 = #0#23;
  #82#58 = #0#25;

 |SI #82#2 ! 12;
     #82#40 = #82#16; #82#41 = #82#17;
     #82#42 = #82#18; #82#43 = #82#19;
     #82#44 = #82#20; #82#45 = #82#21;
     #82#46 = #82#22;
 |FINSI;

  |SI #82#2 ! 12;
      #80#10 = #80#10 + #82#3;

      #80#17 = #80#17 + #82#9;
      #80#18 = #80#18 + #82#10;
      #80#19 = #80#19 + #82#11;
      #80#20 = #80#20 + #82#12;
      #80#21 = #80#21 + #82#13;
      #80#22 = #80#22 + #82#14;
      #80#23 = #80#23 + #82#15;
      #80#40 = #80#40 + #82#55;

  |SINO;
      |SI #82#2 = enPeriodo;

          #82#47 = #80#10;
          #82#48 = #80#17;
          #82#49 = #80#18;
          #82#50 = #80#19;
          #82#51 = #80#20;
          #82#52 = #80#21;
          #82#53 = #80#22;
          #82#54 = #80#23;
          #82#60 = #80#40;

          #80#10 = #82#3;

          #80#17 = #82#9;
          #80#18 = #82#10;
          #80#19 = #82#11;
          #80#20 = #82#12;
          #80#21 = #82#13;
          #80#22 = #82#14;
          #80#23 = #82#15;
          #80#40 = #82#55;

      |FINSI;
  |FINSI;

  #80#12 = #80#12 + #82#39;

  #80#24 = #80#24 + #82#40;
  #80#25 = #80#25 + #82#41;
  #80#26 = #80#26 + #82#42;
  #80#27 = #80#27 + #82#43;
  #80#28 = #80#28 + #82#44;
  #80#29 = #80#29 + #82#45;
  #80#30 = #80#30 + #82#46;
  #80#41 = #80#41 + #82#59;

  #80#13 = #80#10 - #80#12;

  #80#33 = #80#17 - #80#24;
  #80#34 = #80#18 - #80#25;
  #80#35 = #80#19 - #80#26;
  #80#36 = #80#20 - #80#27;
  #80#37 = #80#21 - #80#28;
  #80#38 = #80#22 - #80#29;
  #80#39 = #80#23 - #80#30;
  #80#42 = #80#40 - #80#41;

  #0#24 = #0#24 + #82#39;

  #0#17 = #0#17 + #82#40;
  #0#18 = #0#18 + #82#41;
  #0#19 = #0#19 + #82#42;
  #0#20 = #0#20 + #82#43;
  #0#21 = #0#21 + #82#44;
  #0#22 = #0#22 + #82#45;
  #0#23 = #0#23 + #82#46;
  #0#25 = #0#25 + #82#59;

  |GRABA 020#82a;
  |LIBERA #82;

|FPRC;

|DEFBUCLE ActPeriodos;
 #82#1;
 ;
 enEmpresa, nAny, 01;
 enEmpresa, nAny, 12;
 be;
 NULL, ActPeriodos;
|FIN;


|PROCESO Leew82_Aux82;

 enEmpresa = #982#1;
 nAny      = #982#0;

 #80#0 = enEmpresa;  || cliente
 #80#1 = nAny;       || a¤o
 |LEE 101#80=;
 |SI FSalida ! 0;
     |DDEFECTO #80;
     #80#0 = enEmpresa;
     #80#1 = nAny;
     |SI enPeriodo = 12;
         #80#4 = #982#3;
         #80#5 = #982#4;
     |SINO;
         #80#2 = #982#3;
         #80#3 = #982#4;
     |FINSI;
     |GRABA 020#80b;
 |FINSI;

 |ABRE #82;
 #82#0 = enEmpresa;
 #82#1 = nAny;
 #82#2 = enPeriodo;
 |LEE 101#82=;
 |SI FSalida ! 0;
     |DDEFECTO #82;
     #82#0 = enEmpresa;
     #82#1 = nAny;
     #82#2 = enPeriodo;
     |GRABA 020#82b;
 |FINSI;

 |PDEFECTO #82, 3, 61;
 #82#7  = #0#16;
 #82#4  = #982#5;

 |ABRE #983;
 |BUCLE SiExiste;
 |CIERRA #983;

 |BUCLE ActActividad;

 #82#61 = "S";
 |GRABA 020#82a;
 |LIBERA #82;
 |CIERRA #82;

 #80#10 = 0; #80#11 = 0;
 #80#12 = 0; #80#13 = 0;
 |PDEFECTO #80,17,31;
 |PDEFECTO #80,33,43;

 |PDEFECTO #0,17,26;
 |BUCLE ActPeriodos;

 |GRABA 020#80a;
 |LIBERA #80;

|FPRC;


|DEFBUCLE Leew82_Aux82;
 #982#1;
 ;
 #0#0, 00001;
 #0#0, 99999;
 ;
 NULL, Leew82_Aux82;
|FIN;

|PROCESO PasaDatosBuenos;
  |ABRE #80;
  |ABRE #81;
  |BUCLE Leew82_Aux82;
  |CIERRA #80;
  |CIERRA #81;
|FPRC;
