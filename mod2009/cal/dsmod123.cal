|FICHEROS;
     dsmod123 #0;
     dsmom002 #2;

     dsmod123@ #1123;
|FIN;

|VARIABLES;
     nSuma     = 0;
     nIngresos = 0;
     nPeriodo  = 0;
     nHComple  = 0;
     nEl8      = 0;

     aPeriodo  = "";
     aBase     = "";
     aMas      = "";
|FIN;

|INCLUYE i_variar;


|PROCESO Tipo3;  |TIPO 3;
     |SI #0#4 > 0;
         nEl8 = #0#13 - #0#14;
         |SI nEl8 < 0;
             |MENAV "    RECUERDE. Si el resultado NO es a INGRESAR, NO procede declaracion complementaria";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaPeriodo;
     |SI #2#7 = "MENSUAL   ";
         aPeriodo = "M";
     |SINO;
         aPeriodo = "T";
     |FINSI;
|FPRC;

|DEFBUCLE dsmom002;
     #2#1;
     ;
     enEmpresa, 01, 123;
     enEmpresa, 98, 123;
     ;
     NULL, BuscaPeriodo;
|FIN;

|PROCESO dsmod123Otros;
     #0#14 = #0#14 + #1123#11;
|FPRC;

|DEFBUCLE dsmod123Otros;
     #1123#1006;
     ;
     #0#0, #0#1, #0#2, #0#3,        0, #0#5;
     #0#0, #0#1, #0#2, #0#3, nHComple, #0#5;
     ;
     NULL, dsmod123Otros;
|FIN;

|PROCESO CapturaOtros123;
     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsmod123.mas";
     |CARGA_DEF aMas, dsmod123@;

     nHComple = #0#4 - 1;
     #0#14    = 0;

     |BUCLE dsmod123Otros;

     |DESCARGA_DEF #dsmod123@;
|FPRC;

|PROCESO Totales;
     #0#12  = nIngresos + #0#8;
     #0#10  = #0#9 - #0#12;
     |SI #0#10 < 0;  #0#10 = 0;  |FINSI;

     |SI #0#1 [ 2007;
         #0#11 = #0#8 + #0#10;
         #0#13 = 0;
         #0#14 = 0;
     |SINO;
         #0#13 = #0#8 + #0#10;
         #0#14 = 0;

         |SI #0#4 > 0;
             |HAZ CapturaOtros123;
         |FINSI;

         #0#11 = #0#13 - #0#14;
     |FINSI;

     |PINTA #0#10;
     |PINTA #0#11;
     |PINTA #0#12;
     |PINTA #0#13;
     |PINTA #0#14;
|FPRC;

|PROCESO SacaPantallas123;
     enEntrada = 1;
     |PUSHV 0401 2380;

     |ABRE #0;
     nIngresos = 0;
     aPeriodo   = "T";
     |BUCLE dsmom002;
     |SI aPeriodo = "T";
         |SI #0#2 ! 3;
             |PARA nPeriodo = 3;  |SI nPeriodo < enPeriodo;  |HACIENDO nPeriodo = nPeriodo + 3;
                   #0#0 = enEmpresa;
                   #0#1 = enEjer;
                   #0#2 = nPeriodo
                   #0#3 = enModelo;
                   #0#4 = enComplem;
                   #0#5 = enActividad;
                   |LEE 040#0=;
                   |SI FSalida = 0;
                       |SI #0#11 > 0;
                           nIngresos = nIngresos + #0#8;
                       |FINSI;
                   |FINSI;
              |SIGUE;
         |FINSI;
     |SINO;
         |SI #0#2 ! 1;
             |PARA nPeriodo = 1;  |SI nPeriodo < enPeriodo;  |HACIENDO nPeriodo = nPeriodo + 1;
                   #0#0 = enEmpresa;
                   #0#1 = enEjer;
                   #0#2 = nPeriodo
                   #0#3 = enModelo;
                   #0#4 = enComplem;
                   #0#5 = enActividad;
                   |LEE 040#0=;
                   |SI FSalida = 0;
                       |SI #0#11 > 0;
                           nIngresos = nIngresos + #0#8;
                       |FINSI;
                   |FINSI;
              |SIGUE;
         |FINSI;
     |FINSI;

     #0#0 = enEmpresa;
     #0#1 = enEjer;
     #0#2 = enPeriodo;
     #0#3 = enModelo;
     #0#4 = enComplem;
     #0#5 = enActividad;
     |LEE 101#0=;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         |GRABA 020#0b;
     |FINSI;

     #0#12 = #0#8 + nIngresos;

     |PINPA #0#0;
     |PINDA #0#0;

     |ENDATOS #2#0;
     nSuma = #0#6 + #0#7 + #0#8 + #0#9 + #0#10 + #0#11;
     |SI FSalida=0; |Y nSuma ! 0;
         |GRABA 020#0a;
     |SINO;
         enEntrada = 0;
         |BORRA 020#0a;
     |FINSI;

     |LIBERA #0;
     |CIERRA #0;
     |POPV;
|FPRC;


|PROGRAMA;
     eaNomDef  = "dsmod123";

     enEntrada = 0;

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
          |CABEZA "Modelo 123";
          |HAZ SacaPantallas;
          |ACABA;
     |FINSI;

     |SI enTipoEntrada = 1;              || Alta del Modelo
          |CABEZA "Modelo 123";
          |HAZ SacaPantallas123;
          enResultado = #0#11;
          |ACABA;
     |FINSI;

     |SI enTipoEntrada = 3;              || Baja del Modelo
         |ABRE #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         |LEE 101#0=;
         |SI FSalida = 0;
             |BORRA 020#0a;
         |FINSI;
         |LIBERA #0;
         |CIERRA #0;
         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         |LEE 040#0=;
         |SI FSalida ! 0;  enExistencia = 1;  |DDEFECTO #0; |FINSI;
         |CIERRA #0;

         |SI enActividad = 0;  enResultado = #0#11;  |FINSI;
     |FINSI;
|FPRO;
