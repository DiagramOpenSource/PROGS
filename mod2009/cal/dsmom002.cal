|FICHEROS;
     dsmom002 #0;
     dsmom005 #5;
     dsmom006 #6;
     :/basica/def/agicen14 #114;
     :/basica/def/agitab11 #111;
     :/basica/def/agitab13 #113;
     :/basica/def/agitab99 #199;
     dsmow001 #900;
|FIN;

|VARIABLES;
      aFichero    = "";
      aTipo       = "";

      nSwGraba     = 0;
      nSwSalir     = 0;
      nModelo      = 0;
      nSwObligados = 0;
      nCodigo      = 0;

 {-1} aMenu       = "";
      aMenu1      = "1262";
      aMenu2      = "1";
      aMenu3      = "3";
      aMenu4      = "TRIMESTRAL";
      aMenu5      = "ANUAL     ";
      aMenu6      = "MENSUAL   ";

      &eaPrograma = "";
|FIN;

|INCLUYE i_variar;

|PROCESO FechaBaja;
     |SI #0#9 ! Contenido;
         enCambio = 1;
     |FINSI;
|FPRC;

|PROCESO Obliga11;
     #5#0 = #111#1;
     |LEE 040#5=;
     |SI FSalida ! 0;     |ACABA;  |FINSI;
     |SI #5#4    = "N";   |ACABA;  |FINSI;

     #0#0 = enEmpresa;
     #0#1 = enActividad;
     #0#2 = #111#1;
     |LEE 101#0=;
     |SI FSalida ! 0;
         #0#0  = enEmpresa;
         #0#1  = enActividad;
         #0#2  = #111#1;
         #0#10 = 1;
         |GRABA 020#0b;
     |FINSI;

     |ABRE #114;
     #114#0 = #0#0;
     #114#1 = #0#1;
     |LEE 040#114=;
     |SI FSalida ! 0;  |DDEFECTO #114;  |FINSI;
     |CIERRA #114;

     aTipo  = #5#5;
     #6#0   = enEmpresa;
     #6#1   = #111#1;
     |LEE 040#6=;
     |SI FSalida = 0;  aTipo = #6#6;  |FINSI;

     #0#3 = #5#1;
     #0#4 = #5#2;
     #0#5 = #5#3;
     #0#6 = eaNombreAct;

     |SI aTipo = "T";  #0#7 = "TRIMESTRAL";  |FINSI;
     |SI aTipo = "A";  #0#7 = "ANUAL     ";  |FINSI;
     |SI aTipo = "M";  #0#7 = "MENSUAL   ";  |FINSI;
     |SI aTipo = "C";  #0#7 = "SELECCIONA";  |FINSI;

     #0#8  = #114#5;
     #0#9  = #114#6;
     #0#10 = 1;

     |GRABA 020#0a;
     |LIBERA #0;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE agitab11_O;
     #111#1;
     5;
     #114#7, 000, "S";
     #114#7, 999, "S";
     ;
     NULL, Obliga11;
|FIN;

|PROCESO Obliga13;
     #5#0 = #113#1;
     |LEE 040#5=;
     |SI FSalida ! 0;     |ACABA;  |FINSI;
     |SI #5#4    = "N";   |ACABA;  |FINSI;

     #0#0 = enEmpresa;
     #0#1 = enActividad;
     #0#2 = #113#1;
     |LEE 101#0=;
     |SI FSalida ! 0;
         #0#0  = enEmpresa;
         #0#1  = enActividad;
         #0#2  = #113#1;
         #0#10 = 1;
         |GRABA 020#0b;
     |FINSI;

     |ABRE #114;
     #114#0 = #0#0;
     #114#1 = #0#1;
     |LEE 040#114=;
     |SI FSalida ! 0;  |DDEFECTO #114;  |FINSI;
     |CIERRA #114;

     aTipo  = #5#5;
     #6#0   = enEmpresa;
     #6#1   = #113#1;
     |LEE 040#6=;
     |SI FSalida = 0;  aTipo = #6#6;  |FINSI;

     #0#3 = #5#1;
     #0#4 = #5#2;
     #0#5 = #5#3;
     #0#6 = eaNombreAct;

     |SI aTipo = "T";  #0#7 = "TRIMESTRAL";  |FINSI;
     |SI aTipo = "A";  #0#7 = "ANUAL     ";  |FINSI;
     |SI aTipo = "M";  #0#7 = "MENSUAL   ";  |FINSI;
     |SI aTipo = "C";  #0#7 = "SELECCIONA";  |FINSI;

     #0#8  = #114#5;
     #0#9  = #114#6;
     #0#10 = 1;

     |GRABA 020#0a;
     |LIBERA #0;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE agitab13_O;
     #113#1;
     5;
     #114#9, 000, "S";
     #114#9, 999, "S";
     ;
     NULL, Obliga13;
|FIN;

|PROCESO PonObligados;
     |ABRE #5;
     |ABRE #6;
     |BUCLE agitab11_O;
     |BUCLE agitab13_O;
     |CIERRA #5;
     |CIERRA #6;
|FPRC;

|PROCESO CreaTempo11;
     #5#0 = #111#1;
     |LEE 040#5=;
     |SI FSalida ! 0;     |ACABA;  |FINSI;
     |SI #5#4    = "N";   |ACABA;  |FINSI;

     |DDEFECTO #900;
     #900#0 = #5#0;
     #900#1 = #5#1;
     #900#2 = #5#2;
     #900#3 = #5#3;
     #900#6 = #5#5;

     #6#0   = enEmpresa;
     #6#1   = #111#1;
     |LEE 040#6=;
     |SI FSalida = 0;  #900#6 = #6#6;  |FINSI;

     #0#0   = enEmpresa;
     #0#1   = enActividad;
     #0#2   = #5#0;
     |LEE 040#0=;
     |SI FSalida ! 0;
         #900#4 = " ";
         #900#5 = "*";
         #900#7 = #114#5;
         #900#8 = #114#6;
         #900#9 = "";
     |SINO;
         #900#4 = "*";
         #900#5 = " ";
         #900#7 = #0#8;
         #900#8 = #0#9;
         #900#9 = #0#7;
     |FINSI;

     |GRABA 020#900n;
     |LIBERA #900;
|FPRC;

|DEFBUCLE agitab11;
     #111#1;
     ;
     #114#7, 000;
     #114#7, 999;
     ;
     NULL, CreaTempo11;
|FIN;

|PROCESO CreaTempo13;
     #5#0 = #113#1;
     |LEE 040#5=;
     |SI FSalida ! 0;     |ACABA;  |FINSI;
     |SI #5#4    = "N";   |ACABA;  |FINSI;

     |DDEFECTO #900;
     #900#0 = #5#0;
     #900#1 = #5#1;
     #900#2 = #5#2;
     #900#3 = #5#3;
     #900#6 = #5#5;

     #6#0   = enEmpresa;
     #6#1   = #113#1;
     |LEE 040#6=;
     |SI FSalida = 0;  #900#6 = #6#6;  |FINSI;

     #0#0   = enEmpresa;
     #0#1   = enActividad;
     #0#2   = #5#0;
     |LEE 040#0=;
     |SI FSalida ! 0;
         #900#4 = " ";
         #900#5 = "*";
         #900#7 = #114#5;
         #900#8 = #114#6;
         #900#9 = "";
     |SINO;
         #900#4 = "*";
         #900#5 = " ";
         #900#7 = #0#8;
         #900#8 = #0#9;
         #900#9 = #0#7;
     |FINSI;

     |GRABA 020#900n;
     |LIBERA #900;
|FPRC;

|DEFBUCLE agitab13;
     #113#1;
     ;
     #114#9, 000;
     #114#9, 999;
     ;
     NULL, CreaTempo13;
|FIN;

|PROCESO GrabaFijo;
     |SI nModelo = 193;
         |ABRE #199;
         #199#0 = nModelo;
         |LEE 101#199=;
         |SI FSalida = 0;
             |SI #199#4 = "N";
                 #199#4 = "S";
                 |GRABA 020#199a;
             |FINSI;
             |LIBERA #199;
         |FINSI;
         |CIERRA #199;

         #5#0 = nModelo;
         |LEE 101#5=;
         |SI FSalida = 0;
             |SI #5#4 = "N";
                 #5#4 = "S";
                 |GRABA 020#5a;
             |FINSI;
             |LIBERA #5;
         |FINSI;
     |FINSI;

     |SI nModelo = 216;
         |ABRE #199;
         #199#0 = nModelo;
         |LEE 101#199=;
         |SI FSalida = 0;
             |SI #199#4 = "N";
                 #199#4 = "S";
                 #199#5 = "C";
                 #199#6 = "F";
                 #199#7 = "N";
                 #199#8 = "N";
                 |GRABA 020#199a;
             |FINSI;
             |LIBERA #199;
         |FINSI;
         |CIERRA #199;

         #5#0 = nModelo;
         |LEE 101#5=;
         |SI FSalida = 0;
             |SI #5#4 = "N";
                 #5#4 = "S";
                 #5#5 = "C";
                 #5#6 = "SELECCIONA";
                 #5#7 = "C";
                 #5#8 = "ACT.+ REG.";
                 |GRABA 020#5a;
             |FINSI;
             |LIBERA #5;
         |FINSI;
     |FINSI;

     |SI nModelo = 296;
         |ABRE #199;
         #199#0 = nModelo;
         |LEE 101#199=;
         |SI FSalida = 0;
             |SI #199#4 = "N";
                 #199#4 = "S";
                 |GRABA 020#199a;
             |FINSI;
             |LIBERA #199;
         |FINSI;
         |CIERRA #199;

         #5#0 = nModelo;
         |LEE 101#5=;
         |SI FSalida = 0;
             |SI #5#4 = "N";
                 #5#4 = "S";
                 |GRABA 020#5a;
             |FINSI;
             |LIBERA #5;
         |FINSI;
     |FINSI;

     #5#0 = nModelo;
     |LEE 040#5=;
     |SI FSalida ! 0;     |ACABA;  |FINSI;
     |SI #5#4    = "N";   |ACABA;  |FINSI;

     |DDEFECTO #900;

     #900#0 = #5#0;
     |LEE 040#900=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #900#0 = #5#0;
     #900#1 = #5#1;
     #900#2 = #5#2;
     #900#3 = #5#3;
     #900#6 = #5#5;

     #6#0   = enEmpresa;
     #6#1   = nModelo;
     |LEE 040#6=;
     |SI FSalida = 0;  #900#6 = #6#6;  |FINSI;

     #0#0   = enEmpresa;
     #0#1   = enActividad;
     #0#2   = #5#0;
     |LEE 040#0=;
     |SI FSalida ! 0;
         #900#4 = " ";
         #900#5 = "*";
         #900#7 = #114#5;
         #900#8 = #114#6;
         #900#9 = "";
     |SINO;
         #900#4 = "*";
         #900#5 = " ";
         #900#7 = #0#8;
         #900#8 = #0#9;
         #900#9 = #0#7;
     |FINSI;

     |GRABA 020#900n;
     |LIBERA #900;
|FPRC;

|PROCESO PonFijos;
     nModelo = 110;  |HAZ GrabaFijo;
     nModelo = 115;  |HAZ GrabaFijo;
     nModelo = 123;  |HAZ GrabaFijo;
     nModelo = 216;  |HAZ GrabaFijo;
     nModelo = 180;  |HAZ GrabaFijo;
     nModelo = 190;  |HAZ GrabaFijo;
     nModelo = 193;  |HAZ GrabaFijo;
     nModelo = 296;  |HAZ GrabaFijo;
|FPRC;

|PROCESO CreaModelo;
     #0#0 = enEmpresa;
     #0#1 = enActividad;
     #0#2 = #900#0;
     |LEE 101#0=;
     |SI FSalida ! 0;
         #0#0  = enEmpresa;
         #0#1  = enActividad;
         #0#2  = #900#0;
         #0#10 = 1;
         |GRABA 020#0b;
     |FINSI;

     #0#3 = #900#1;
     #0#4 = #900#2;
     #0#5 = #900#3;
     #0#6 = eaNombreAct;

     |SI #900#6 = "T";  #0#7 = "TRIMESTRAL";  |FINSI;
     |SI #900#6 = "A";  #0#7 = "ANUAL     ";  |FINSI;
     |SI #900#6 = "M";  #0#7 = "MENSUAL   ";  |FINSI;
     |SI #900#6 = "C";  #0#7 = "SELECCIONA";  |FINSI;

     |SI #900#9 ! "          ";  #0#7 = #900#9;  |FINSI;

     #0#8 = #900#7;
     #0#9 = #900#8;

     |GRABA 020#0a;
     |LIBERA #0;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE dsmow001;
     #900#1;
     4;
     000, "*";
     999, "*";
     ;
     NULL, CreaModelo;
|FIN;

|PROCESO BorraModelo;
     |BORRA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE dsmom002B;
     #0#1;
     ;
     enEmpresa, enActividad, 000;
     enEmpresa, enActividad, 999;
     be;
     NULL, BorraModelo;
|FIN;

|RUTINA ClaveBaja900;
     #900#0 = 000;
|FRUT;

|RUTINA ClaveAlta900;
     #900#0 = 999;
|FRUT;

|PROCESO CreaModelos;
     nSwGraba = 0;

     |ABRE #114;
     #114#0 = enEmpresa;
     #114#1 = enActividad;
     |LEE 040#114=;
     |SI FSalida ! 0;  |CIERRA #114;  |ACABA;  |FINSI;
     |CIERRA #114;

     |SI nSwObligados = 1;
         |ABRE #0;
         |HAZ PonObligados;
         |CIERRA #0;
         |SI nSwGraba ! 0;  |ACABA;  |FINSI;
     |FINSI;

     aFichero = ("01" + Usuario) % 108;
     |NOME_DAT #900 aFichero;
     |ABRE #900;  |CIERRA #900;  |DELINDEX #900;

     |ABRE #900;
     |ABRE #5;
     |ABRE #6;
     |BUCLE agitab11;
     |BUCLE agitab13;
     |HAZ PonFijos;
     |CIERRA #900;
     |CIERRA #5;
     |CIERRA #6;

     |PUSHV 0501 2380;
     |ENTLINEAL #1#900, -1, 4, 22, 1, ClaveBaja900, ClaveAlta900;
     |POPV;

     |BUCLE dsmom002B;

     |ABRE #0;
     |BUCLE dsmow001;
     |CIERRA #0;

     |DELINDEX #900;
|FPRC;

|PROCESO RefrescaMod;  |TIPO 11;
     |SI FSalida = 10;
         nSwObligados = 0;
         |HAZ CreaModelos;

         nSwSalir = 1;
         |PTEC 807;
     |FINSI;

     |SI FSalida = 11;
         |SI #0#7 ! "SELECCIONA";  |ACABA;  |FINSI;

         |LEE 101#0=;

         |PUSHV 0501 2380;
         |PARA; |SI; |HACIENDO;
                |MENUG aMenu;
                aMenu2 = FSalida;

                |SI aMenu2 = "1";   #0#7 = aMenu4;  |SAL;  |FINSI;
                |SI aMenu2 = "2";   #0#7 = aMenu5;  |SAL;  |FINSI;
                |SI aMenu2 = "3";   #0#7 = aMenu6;  |SAL;  |FINSI;
         |SIGUE;
         |POPV;

         |GRABA 020#0a;
         |LIBERA #0;

         |PINTA #0#7;
         |ERROR;
     |FINSI;
|FPRC;

|RUTINA ClaveBaja0;
     #0#0 = enEmpresa;
     #0#1 = enActividad;
     #0#2 = 000;
|FRUT;

|RUTINA ClaveAlta0;
     #0#0 = enEmpresa;
     #0#1 = enActividad;
     #0#2 = 999;
|FRUT;

|PROCESO Selecciona;
     nSwSalir = 1;
|FPRC;

|DEFBUCLE dsmom002;
     #0#1;
     7;
     enEmpresa, enActividad, 000, "SELECCIONA";
     enEmpresa, enActividad, 999, "SELECCIONA";
     ;
     NULL, Selecciona;
|FIN;

|PROCESO RecalculaFechas;
     |ABRE #114;
     #114#0 = #0#0;
     #114#1 = #0#1;
     |LEE 040#114=;
     |SI FSalida ! 0;
         |BORRA 020#0a;
         |LIBERA #0;

         |CIERRA #114;
         |ACABA;
     |FINSI;
     |CIERRA #114;

     #0#8  = #114#5;
     #0#9  = #114#6;
     #0#10 = 1;
     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE dsmom002R;
     #0#1;
     10;
     00000, 00, 000, 0;
     99999, 99, 999, 0;
     ;
     NULL, RecalculaFechas;
|FIN;

|PROCESO PonFechas;
     |ABRE #0;
     |LEE 040#0p;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #0;

     |SI #0#10 = 0;
         |BUCLE dsmom002R;   || Recalculo de Fechas;
     |FINSI;
|FPRC;

|PROCESO Graba113;
     #113#0 = nCodigo;
     #113#1 = 184;
     |LEE 000#113=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #113#0 = nCodigo;
     #113#1 = 184;
     #113#2 = #199#1;
     #113#3 = #199#2;
     #113#4 = #199#3;
     #113#5 = "N";
     |GRABA 020#113n;
     |LIBERA #113;
|FPRC;

|PROCESO MiraEl184;
     |ABRE #199;
     #199#0 = 184;
     |LEE 000#199=;
     |SI FSalida = 0;
         |CIERRA #199;
         |ACABA;
     |FINSI;

     |DDEFECTO #199;
     #199#0 = 184;
     #199#1 = "MODELO 184 - IRPF";
     #199#2 = "DECLARACION ANUAL DE ENTIDADES EN REGIMEN DE ATRIBUCION DE RENTAS";
     #199#3 = "DECLARACION INFORMATIVA";
     #199#4 = "S";
     #199#5 = "A";
     #199#6 = "M";
     #199#7 = "N";
     #199#8 = "N";
     |GRABA 020#199n;
     |LIBERA #199;
     |CIERRA #199;

     eaPrograma = "dsmom002";
     |SUB_EJECUTA_NP "dsmom005";

     |ABRE #113;
     nCodigo = 8;   |HAZ Graba113;
     nCodigo = 9;   |HAZ Graba113;
     nCodigo = 10;  |HAZ Graba113;
     nCodigo = 11;  |HAZ Graba113;
     nCodigo = 12;  |HAZ Graba113;
     nCodigo = 18;  |HAZ Graba113;
     |CIERRA #113;
|FPRC;

|PROGRAMA;
     |HAZ MiraEl184;

     nSwGraba = 1;

     |HAZ PonFechas;

     |ABRE #0;
     #0#0 = enEmpresa;
     #0#1 = enActividad;
     #0#2 = 000;
     |LEE 040#0];
     |SI FSalida ! 0;  |O #0#0 ! enEmpresa;  |O #0#1 ! enActividad;
         |CIERRA #0;
         nSwObligados = 1;
         |HAZ CreaModelos;
     |FINSI;
     |CIERRA #0;

     |SI nSwGraba = 0;  |ACABA;  |FINSI;

     |ET Arriba;
         |ENTLINEAL #1#0, -3, 2, 22, 1, ClaveBaja0, ClaveAlta0;
         |SI nSwSalir = 1;
             nSwSalir = 0;
             |VETE Arriba;
         |FINSI;

         nSwSalir = 0;
         |BUCLE dsmom002;
         |SI nSwSalir = 1;
             |MENAV "     Hay algun modelo sin seleccionar Periodicidad.";
             nSwSalir = 0;
             |VETE Arriba;
         |FINSI;
|FPRO;
