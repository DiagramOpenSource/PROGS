|FICHEROS;
   dsmoy061 #0;

   dsmom041 #41;
   dsmom040 #40;

   dsmom100 #100;
   dsmom107 #107;

   :/basica/def/agicen14 #114;
   :/basica/def/agim0019 #119;

   :/contagen/def/canempre #300;

   dsmow030 #900;
|FIN;

|VARIABLES;
   &entrada = 1;
   aAlfa1     = "";
   aAlfa2     = "";
   informe    = "dsmoy061";

   nCampo      = 0;
   nDEmpresa   = 0;
   nHEmpresa   = 0;
   nDActividad = 0;
   nHActividad = 0;
   swBueno     = 0;
   nLaEmpresa  = 0;
   &nCamSel    = 21;
   &nCamTip    = 36;

   fFecha      = @;

   aPath       = "";
   nBueno      = 0;
   nPeriodo    = 0;
   fDFecha     = @;
   fHFecha     = @;
   &enImA      = 0;
   &enImD      = 0;

   nVAnyo = 0;
   nEjerV   = 0;
   nEjerC   = 0;
   nHay     = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;
|INCLUYE i_varlib;
|INCLUYE i_numamo;
|INCLUYE i_selcon;

|| //////////////////// Calculos de Pantalla \\\\\\\\\\\\\\\\\\\\\\\\\\
|CALCULO Tipo7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#5  = enEmpresa;  |PINTA #0#5;
         #0#6  = enEmpresa;  |PINTA #0#6;

         |C_M #0#5, 1, "N";
         |C_M #0#6, 1, "N";
     |FINSI;
|FCAL;

|CALCULO Parrilla;
     |SI #0#5 = 0;
         #0#5 = 0;  |PINTA #0#5;
         #0#6 = 0;  |PINTA #0#6;  |C_M #0#6, 1, "N";
         |PARA nCampo = 7;  |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#5, 1, "S";
             |C_M #0#6, 1, "S";
         |FINSI;

         |PARA nCampo = 7;  |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO numamo; |TIPO 0;
   x_alfa1 = #0Campo;
   |HAZ x_punto;
   #0Campo = x_alfa1;
   |PINTA #0Campo;
|FCAL;

|CALCULO cuenta; |TIPO 0;
     salidas  = FSalida;

     |ABRE #100;
     |LEE 040#100p;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;
     |CIERRA #100;

     nLaEmpresa = enEmpresa;
     enEmpresa  = #100#1;
     enPerConta = #100#2;

     eaCuenta = #0Campo;
     |HAZ FiltraPuntos;
     #0Campo = eaCuenta;
     |PINTA #0Campo;
     enEmpresa = nLaEmpresa;
|FCAL;

|| **************************************************************
|| //////////////////// Procesos del Informe  \\\\\\\\\\\\\\\\\\\\\\\\\\

|PROCESO LaImpresion;

   |SI nLaEmpresa ! #41#0;
       |SI nHay = 1;
           |PIEINF;
           nHay = 0;
       |FINSI;
       nLaEmpresa = #41#0;
       enEmpresa  = #41#0;
       swBueno = 0;
       |HAZ LaSelEmpresa;
       |SI enSwSelEmp = 1;
           swBueno = 1;
       |SINO;
           |HAZ AntCambioCta;
       |FINSI;
   |FINSI;
   |SI swBueno = 1; |ACABA; |FINSI;

   |HAZ LeeDatosEmpresa;

   |SI #0#4 = "N";
       |SI #41#25 = "N"; |ACABA; |FINSI;
   |FINSI;
   |SI #0#37 ! "T";
       |SI #0#37 ! #41#40; |ACABA; |FINSI;
   |FINSI;

   aAlfa1  = #41#27; aAlfa1 = aAlfa1 % -104;
   nEjerC  = aAlfa1;
   nEjerV  = 0;
   |SI #41#26 > "01.01.0000";
       aAlfa1 = #41#26; aAlfa1 = aAlfa1 % -104;
       nEjerV = aAlfa1;
   |FINSI;

   |DDEFECTO #40;
   #40#0 = #41#0;
   #40#2 = #41#18;
   |LEE 001#40=;

   enEjerCam = nEjerC;
   eaCuenta  = #41#5;
   |HAZ CambioCta;
   |SI enEjerCam ] 2008;
       eaCta1990 = "";
   |FINSI;
   |SI eaCta2008 ] #0#0; |Y eaCta2008 [ #0#1;
       |PRINT;
       nHay = 1;
   |FINSI;
|FPRC;

|DEFBUCLE dsmoy041;
   #41#1;
   1;                                    || 2 = campo elemento + Actividad
   nDEmpresa,#0#2,#0#34,nDActividad;     || clave 4 + elemento
   nHEmpresa,#0#3,#0#35,nHActividad;
   e;
   NULL, LaImpresion;
|FIN;

|PROCESO imprimir;
      |ABRE #40;
      nLaEmpresa = -1;
      swBueno    = 0;
      nHay       = 0;
      |BUCLE dsmoy041;
      |SI nHay = 1;
          |PIEINF;
      |FINSI;
      |CIERRA #40;
|FPRC;

|CALCULO Tipo3;  |TIPO 3;

    |DBASS aPath; |QBT aPath;
    aPathConta    = aPath + "contagen/fich/";
    |PATH_DAT #300 aPathConta;

    |SI #0#38 = "S";
       |MENAV "0000 Recuerde seleccionar el papel de la impresora en Horizontal";
    |FINSI;

    |IMPRE 0;
    |SI FSalida ! 0;  |ACABA;  |FINSI;

    informe = "dsmoy061";
    |SI #0#38 = "S"; informe = "dsmoys61"; |FINSI;
    |INFOR informe;
    |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     nDActividad = #0#19;
     nHActividad = #0#20;
     efFecTope   = ~;

     |SI #0#5 ! 0;
         nDEmpresa = #0#5;
         nHEmpresa = #0#6;
         |HAZ imprimir;
     |SINO;
         |PARA nCampo = 7; |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
               nDEmpresa = #0nCampo;
               nHEmpresa = #0nCampo;
               |HAZ imprimir;
         |SIGUE;
     |FINSI;
     |FININF;
     |FINIMP;
|FCAL;

|PROCESO LeeDatosEmpresa;
  fFecha = ~;
  aAlfa1 = fFecha;
  aAlfa1 = aAlfa1 % -104;
  enEjer = aAlfa1;

  |DDEFECTO #900;
  #900#0 = enEmpresa;
  eaInac = #0#21; eaInac = "S";
  eaTituloL = "";
  enActividad = #41#1;
  |HAZ DatosEmpr_w30;

  |HAZ Analitica;
  eaInac = #0#21;
|FPRC;
