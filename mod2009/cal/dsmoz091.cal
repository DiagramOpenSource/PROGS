|FICHEROS;
 dsmoz091 #0;
 dsmom057 #57;
 dsmom058 #58;
 espejo@  #158;
|FIN;


|VARIABLES;
  aAlfa1     = "";
  nNume1     = 0;
  fFecha     = @;
  aMas       = "";
  aDef       = "";
  aFichero   = "";
  aDTipo     = "";
  aHTipo     = "";
  aTipo      = "";
  sw         = 0;
  aQueQuiero = "";
  aTitulo    = "";
  aNumCampos = "";
  nNumCampos = 0;
  nCampo     = 0;
  nLinea     = 0;
|FIN;

|INCLUYE i_variar;

|CALCULO Defecto; |TIPO 7;
  fFecha = ~;
  aAlfa1 = fFecha; aAlfa1 = aAlfa1 % -104;
  nNume1 = aAlfa1;
  #0#1 = nNume1 - 1;
  |PINTA #0#1;
|FCAL;

|CALCULO Existe; |TIPO 0;
 |ABRE #57;
 #57#0 = #0#1;
 |LEE 001#57=;
 |SI FSalida ! 0;
     |MENAV "    Error.! No existe Fichero de control de este Ejercicio";
     |ERROR;
 |FINSI;
 |CIERRA #57;
|FCAL;
|| ********************************************************************
|PROCESO LeoDespues0;
 |PARA nCampo = 0;  |SI nCampo [ nNumCampos;  |HACIENDO nCampo = nCampo + 1;
       #58nCampo = #158nCampo;
 |SIGUE;
 |GRABA 020#58n;
|FPRC;

|DEFBUCLE LeoDespues;
 #158#1003;
 ;
 #0#1, aDTipo, 001;
 #0#1, aHTipo, 999;
 ;
 NULL, LeoDespues0;
|FIN;


|PROCESO BorraLineas0;

 |SI sw = 0;
     sw = 1;
     nLinea = 1;
     aTipo = #58#1;
 |FINSI;

 |SI aTipo ! #58#1;
     nLinea = 1;
     aTipo  = #58#1;
 |FINSI;

 |PARA nCampo = 0;  |SI nCampo [ nNumCampos;  |HACIENDO nCampo = nCampo + 1;
       #158nCampo = #58nCampo;
 |SIGUE;
 #158#2 = nLinea;
 nLinea = nLinea + #0#2;
 |GRABA 020#158n;

 |BORRA 020#58a;
 |LIBERA #58;
|FPRC;

|DEFBUCLE LeoPrimero;
 #58#1;
 ;
 #0#1, aDTipo, 001;
 #0#1, aHTipo, 999;
 be;
 NULL, BorraLineas0;
|FIN;


|CALCULO Renumero; |TIPO 3;
  |SI #0#0 = "N"; |ACABA; |FINSI;

  |DBASE aMas;
  aDef = aMas + "def/dsmom058";
  |CARGA_DEF aDef, espejo@;
  |SI FSalida ! 0;
      |ACABA;
  |FINSI;
  aFichero = ("2e" + Usuario) % 108;
  |NOME_DAT #158 aFichero;
  |DELINDEX #158;

  aQueQuiero = "|NC";
  aNumCampos = #58#aQueQuiero#;
  nNumCampos = aNumCampos;
  nNumCampos = nNumCampos - 1;

  aDTipo = #0#3;
  aHTipo = #0#3;
  |SI #0#3 = 4; aDTipo = "5";  aHTipo = "5"; |FINSI;
  |SI #0#3 = 0; aDTipo = " ";  aHTipo = "z"; |FINSI;
  sw     = 0;
  aTipo  = "";

  |ABRE #158;
  |BUCLE LeoPrimero;
  |CIERRA #158;

  |ABRE #58;
  |BUCLE LeoDespues;
  |CIERRA #58;

  |DELINDEX #158;
  |DESCARGA_DEF #158;
|FCAL;
