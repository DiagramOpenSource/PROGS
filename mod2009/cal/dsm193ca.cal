|FICHEROS;
     dsm193ca #193;
     dsm193li #194;
     dsm193ga #195;
     dsmom038 #38;
     dsmom004 #4;
|FIN;

|VARIABLES;
     nSwChequea1= 0;
     nSwChequea2= 0;
     nBorra     = 0;
     nComp      = 0;
     nSuma      = 0;
     nBoton1    = 0;
     nBoton2    = 0;
     nBoton3    = -1;
     aTecla     = "";

     &eaExtension = "";
     &eaPrograma  = "";
|FIN;

|INCLUYE i_variar;

|RUTINA ClaveBaja2;
     #194#0  = #193#0;
     #194#1  = #193#1;
     #194#2  = #193#2;
     #194#3  = #193#3;
     #194#4  = #193#4;
     #194#5  = #193#5;
     #194#6  = "            ";
     #194#7  = 0000;
     #194#8  = " ";
     #194#9  = "  ";
     #194#10 = 1;
|FRUT;

|RUTINA ClaveAlta2;
     #194#0  = #193#0;
     #194#1  = #193#1;
     #194#2  = #193#2;
     #194#3  = #193#3;
     #194#4  = #193#4;
     #194#5  = #193#5;
     #194#6  = "zzzzzzzzzzzz";
     #194#7  = 9999;
     #194#8  = "z";
     #194#9  = "zz";
     #194#10 = 2;
|FRUT;

|RUTINA ClaveBaja3;
     #195#0  = #193#0;
     #195#1  = #193#1;
     #195#2  = #193#2;
     #195#3  = #193#3;
     #195#4  = #193#4;
     #195#5  = #193#5;
     #195#6  = "            ";
|FRUT;

|RUTINA ClaveAlta3;
     #195#0  = #193#0;
     #195#1  = #193#1;
     #195#2  = #193#2;
     #195#3  = #193#3;
     #195#4  = #193#4;
     #195#5  = #193#5;
     #195#6  = "zzzzzzzzzzzz";
|FRUT;

|PROCESO Boton1;
     |PUSHV 0501 2380;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "HIDE";  |FINSI;

     |PINPA #0#194;

     |ABRE #38;
     |LEE 040#38p;
     |SI FSalida ! 0;
         eaExtension = "mod";
         eaPrograma  = "dsmom038";
         |SUB_EJECUTA_NP ":basica/dspatron";
     |FINSI;
     |CIERRA #38;

     |ABRE #38;
     #38#0 = "D";
     #38#1 = "01";
     |LEE 000#38=;
     |SI FSalida ! 0;
         |MENAV "0000 Hay una nueva clave IRPF, se va a proceder a instalar el fichero";

         |CIERRA #38;
         eaExtension = "mod";
         eaPrograma  = "dsmom038";
         |SUB_EJECUTA_NP ":basica/dspatron";

         |ABRE #38;
         #38#0 = "D";
         #38#1 = "01";
         |LEE 000#38=;
         |SI FSalida = 0;
             |MENAV "0000 El fichero se ha instalado satisfactoriamente.";
         |SINO;
             |MENAV "0000 El fichero no se ha instalado, por favor instale la aplicacion ipbasica";
         |FINSI;
     |FINSI;
     |CIERRA #38;

     |SI enTipoEntrada = 4;
         |ENTLINEAL #1#194, -7, 4, 22, 0, ClaveBaja2, ClaveAlta2;
     |SINO;
         |ENTLINEAL #1#194, -7, 2, 22, 0, ClaveBaja2, ClaveAlta2;
     |FINSI;

     |PULSATECLA;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "SHOW";  |FINSI;
     |POPV;

     |PINTA #193#6;
     |PINTA #193#7;
     |PINTA #193#8;
     |PINTA #193#9;
     |PINTA #193#10;
     |PINTA #193#11;
     |PINTA #193#12;
|FPRC;

|PROCESO Boton2;
     |PUSHV 0501 2380;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "HIDE";  |FINSI;

     |PINPA #0#195;

     |SI enTipoEntrada = 4;
         |ENTLINEAL #1#195, -7, 4, 22, 0, ClaveBaja3, ClaveAlta3;
     |SINO;
         |ENTLINEAL #1#195, -7, 2, 22, 0, ClaveBaja3, ClaveAlta3;
     |FINSI;

     |PULSATECLA;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "SHOW";  |FINSI;
     |POPV;

     |PINTA #193#6;
     |PINTA #193#7;
     |PINTA #193#8;
     |PINTA #193#9;
     |PINTA #193#10;
     |PINTA #193#11;
     |PINTA #193#12;
|FPRC;

|PROCESO RecalculaLi;
     |SI nBorra = 1;
         |BORRA 020#194a;
         |LIBERA #194;
         |ACABA;
     |FINSI;

     |SI nSwChequea1 = 0;
         nSwChequea1 = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |HAZ Tipo2m193li;
|FPRC;

|DEFBUCLE dsm193li;
     #194#1;
     ;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,"            ",0000," ","  ", 0;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,"zzzzzzzzzzzz",9999,"z","zz", 3;
     be;
     NULL, RecalculaLi;
|FIN;

|PROCESO RecalculaGa;
     |SI nBorra = 1;
         |BORRA 020#195a;
         |LIBERA #195;
         |ACABA;
     |FINSI;

     |SI nSwChequea2 = 0;
         nSwChequea2 = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |HAZ Tipo2m193ga;
|FPRC;

|DEFBUCLE dsm193ga;
     #195#1;
     ;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,"            ";
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,"zzzzzzzzzzzz";
     be;
     NULL, RecalculaGa;
|FIN;

|PROCESO Recalculo;
     nSwChequea1 = 0;  |BUCLE dsm193li;
     nSwChequea2 = 0;  |BUCLE dsm193ga;

     |SI nSwChequea1 = 0;  |Y nSwChequea2 = 0;
         |ACABA;
     |FINSI;

     #193#6  = 0;
     #193#7  = 0;
     #193#8  = 0;
     #193#9  = 0;
     #193#10 = 0;
     #193#11 = 0;
     #193#12 = 0;

     |BUCLE dsm193li;
     |BUCLE dsm193ga;
|FPRC;

|PROCESO Traedsm193li;
     #194#4 = #193#4;
     |GRABA 020#194n;
     |LIBERA #194;
|FPRC;

|DEFBUCLE dsm193liT;
     #194#1;
     ;
     #193#0,#193#1,#193#2,#193#3,nComp,#193#5,"            ",0000," ","  ",0;
     #193#0,#193#1,#193#2,#193#3,nComp,#193#5,"zzzzzzzzzzzz",9999,"z","zz",2;
     be;
     NULL, Traedsm193li;
|FIN;

|PROCESO Traedsm193ga;
     #195#4 = #193#4;
     |GRABA 020#195n;
     |LIBERA #195;
|FPRC;

|DEFBUCLE dsm193gaT;
     #195#1;
     ;
     #193#0,#193#1,#193#2,#193#3,nComp,#193#5,"            ";
     #193#0,#193#1,#193#2,#193#3,nComp,#193#5,"zzzzzzzzzzzz";
     be;
     NULL, Traedsm193ga;
|FIN;

|PROCESO Justificante;
     |SI #193#4 = 0;  |ACABA;  |FINSI;

     |SI #193#14 ! "C";  |Y #193#14 ! "S";
         |MENAV "      Introduzca Complementaria o Sustitutoria";
         |ERROR;
     |FINSI;

     |C_M #193#13, 1, "N";
     |SI #193#14 = "S";
         |C_M #193#13, 1, "S";

         |SI #193#13 = "             ";
             |ABRE #4;
             #4#0 = #193#0;
             #4#1 = #193#1;
             #4#2 = #193#2;
             #4#3 = #193#3;
             #4#4 = #193#4 - 1;
             |LEE 000#4=;
             |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
             |CIERRA #4;

             #193#13 = #4#19;  |PINTA #193#13;
         |FINSI;
     |SINO;
         #193#13 = "";  |PINTA #193#13;
     |FINSI;

     |SI #193#14 = "S";
         nSuma = 0;
         nSuma = #193#6 + #193#7 + #193#8 + #193#9 + #193#10 + #193#11 + #193#12;

         |SI nSuma = 0;
             nComp = #193#4 - 1;
             |BUCLE dsm193liT;
             |BUCLE dsm193gaT;

             |HAZ Recalculo;

             |PINPA #0#193;
             |PINDA #0#193;
             |HAZ PintaDatos;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Boton3;
     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton3, "DISABLE";

     |HAZ Recalculo;
     |PINTA #193#6;
     |PINTA #193#7;
     |PINTA #193#8;
     |PINTA #193#9;
     |PINTA #193#10;
     |PINTA #193#11;
     |PINTA #193#12;

     |ESTADO_CONTROL nBoton1, "ENABLE";
     |ESTADO_CONTROL nBoton2, "ENABLE";
     |ESTADO_CONTROL nBoton3, "ENABLE";
|FPRC;

|PROCESO Tipo12moc1193;  |TIPO 12;
|FPRC;

|PROGRAMA;
     |HAZ LeeEURODBMOD;

     eaNomDef    = "dsm193ca";
     enResultado = 0;

|| \\\\\\ Alta del Modelo ////////

     |SI enTipoEntrada = 1;              || Consulta del Modelo
         |CABEZA "Modelo 193";
         |ABRE #193;
         #193#0 = enEmpresa;
         #193#1 = enEjer;
         #193#2 = enPeriodo;
         #193#3 = enModelo;
         #193#4 = enComplem;
         #193#5 = enActividad;
         |LEE 040#193=;
         |SI FSalida ! 0;
             |DDEFECTO #193;
             #193#0 = enEmpresa;
             #193#1 = enEjer;
             #193#2 = enPeriodo;
             #193#3 = enModelo;
             #193#4 = enComplem;
             #193#5 = enActividad;
             |GRABA 020#193b;
         |FINSI;

         |PINPA #0#193;
         |PINDA #0#193;
         |HAZ PintaDatos;

         |CONTROL_SIMPLE 0, "BOTON,  Entrada Perceptores  ", 0955, 1079, Boton1;
         nBoton1 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,  Entrada Gastos  ", 1255, 1379, Boton2;
         nBoton2 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,  Recalculo Perceptores ", 1555, 1779, Boton3;
         nBoton3 = FSalida;

         |C_M #193#14, 1, "N";
         |SI #193#4 ! 0;
             |C_M #193#14, 1, "S";
         |FINSI;

         |ENDATOS #1#193;

         |LEETECLA aTecla;

         |FIN_CONTROL_WINDOWS nBoton1;
         |FIN_CONTROL_WINDOWS nBoton2;
         |FIN_CONTROL_WINDOWS nBoton3;

         |PULSATECLA;

         nSuma = #193#6  + #193#7  + #193#8 + #193#9 + #193#10 + #193#11 + #193#12;

         |SI nSuma = 0;
             |BORRA 020#193a;
             enEntrada = 0;
         |SINO;
             |GRABA 020#193a;
             enEntrada = 1;
         |FINSI;
         |LIBERA #193;
         |CIERRA #193;

         |ACABA;
     |FINSI;

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
         |CABEZA "Modelo 193";
         |ABRE #193;
         #193#0 = enEmpresa;
         #193#1 = enEjer;
         #193#2 = enPeriodo;
         #193#3 = enModelo;
         #193#4 = enComplem;
         #193#5 = enActividad;
         |LEE 040#193=;
         |SI FSalida ! 0;
             |MENAV "      No existe Registro.";
             |CIERRA #193;
             |ACABA;
         |FINSI;

         |PINPA #0#193;
         |PINDA #0#193;
         |HAZ PintaDatos;

         |CONTROL_SIMPLE 0, "BOTON,  Entrada Perceptores  ", 0955, 1079, Boton1;
         nBoton1 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,  Entrada Gastos  ", 1255, 1379, Boton2;
         nBoton2 = FSalida;

         |LEETECLA aTecla;

         |FIN_CONTROL_WINDOWS nBoton1;
         |FIN_CONTROL_WINDOWS nBoton2;
         |PULSATECLA;

         |CIERRA #193;

         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              || Baja del Modelo
         |ABRE #193;
         #193#0 = enEmpresa;
         #193#1 = enEjer;
         #193#2 = enPeriodo;
         #193#3 = enModelo;
         #193#4 = enComplem;
         #193#5 = enActividad;
         |LEE 040#193=;
         |SI FSalida ! 0;
             |SI enMensa = 0;
                 |MENAV "      No existe Registro.";
             |FINSI;
             |CIERRA #193;
             |ACABA;
         |FINSI;

         nBorra = 1;  |BUCLE dsm193li;
         nBorra = 1;  |BUCLE dsm193ga;
         nBorra = 0;

         |BORRA 020#193a;
         |LIBERA #193;

         |CIERRA #193;

         |ACABA;
     |FINSI;

|| \\\\\\ Alta desde el Pase del Modelo

     |SI enTipoEntrada = 98;
         |ABRE #193;
         #193#0 = enEmpresa;
         #193#1 = enEjer;
         #193#2 = enPeriodo;
         #193#3 = enModelo;
         #193#4 = enComplem;
         #193#5 = enActividad;
         |LEE 040#193=;
         |SI FSalida ! 0;
             #193#0  = enEmpresa;
             #193#1  = enEjer;
             #193#2  = enPeriodo;
             #193#3  = enModelo;
             #193#4  = enComplem;
             #193#5  = enActividad;
             #193#15 = "S";
             |GRABA 020#193b;
         |FINSI;

         |HAZ Recalculo;
         |GRABA 020#193a;

         |LIBERA #193;
         |CIERRA #193;

         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #193;
         #193#0 = enEmpresa;
         #193#1 = enEjer;
         #193#2 = enPeriodo;
         #193#3 = enModelo;
         #193#4 = enComplem;
         #193#5 = enActividad;
         |LEE 040#193=;
         |SI FSalida ! 0;  enExistencia = 1;  |FINSI;
         |CIERRA #193;

         |SI enActividad = 0;  enResultado = 0;  |FINSI;
     |FINSI;
|FPRO;
