|FICHEROS;
     dsmozp85 #0;

     dsmom080 #80;
     dsmom081 #81;
     dsmom082 #82;
     dsmom083 #83;

     :/basica/def/agifigen #118;
     dsmod300 #300;
     dsmociva #400;
|FIN;

|VARIABLES;
     nDEmpresa = 0;
     nHEmpresa = 0;
     aDNom     = "";
     aHNom     = "";
     nEjer          = 0;
     nDPeriodo      = 0;
     nHPeriodo      = 0;
     nCampo         = 0;

     fFecIni     = @;
     fFecFin     = @;
     nSwAlgun    = 0;
     nSwPrint    = 0;
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aAlfa3      = "";
     aAlfa4      = "";
     fLaFecha    = @;
     &aEmpresa   = "";
     &eaNom      = "";
     &eaNif      = "";
     &nSwFich    = 0;
     aParam      = "";
     nSwSal      = 0;

     nPara1    = 0;
     nAnterior = 0;
     nPeriodo  = 0;
|FIN;

|INCLUYE i_variar;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\
|CALCULO Eano; |TIPO 7;
 fLaFecha = ~;
 aAlfa1 = fLaFecha; aAlfa1 = aAlfa1 % -104;
 #0#3 = aAlfa1;
 |PINTA #0#3;
|FCAL;

|PROCESO Periodo;
     #0#2 = "          ";
     |SI #0#1 = 1;   #0#2 = "ENERO     ";  |FINSI;
     |SI #0#1 = 2;   #0#2 = "FEBRERO   ";  |FINSI;
     |SI #0#1 = 3;   #0#2 = "MARZO     ";  |FINSI;
     |SI #0#1 = 4;   #0#2 = "ABRIL     ";  |FINSI;
     |SI #0#1 = 5;   #0#2 = "MAYO      ";  |FINSI;
     |SI #0#1 = 6;   #0#2 = "JUNIO     ";  |FINSI;
     |SI #0#1 = 7;   #0#2 = "JULIO     ";  |FINSI;
     |SI #0#1 = 8;   #0#2 = "AGOSTO    ";  |FINSI;
     |SI #0#1 = 9;   #0#2 = "SEPTIEMBRE";  |FINSI;
     |SI #0#1 = 10;  #0#2 = "OCTUBRE   ";  |FINSI;
     |SI #0#1 = 11;  #0#2 = "NOVIEMBRE ";  |FINSI;
     |SI #0#1 = 12;  #0#2 = "DICIEMBRE ";  |FINSI;
     |SI #0#1 = 99;  #0#2 = "EJERCICIO ";  |FINSI;

     |SI #0#2 = "          ";
         |MENAV "     Periodo Incorrecto.";
         |ERROR;
     |FINSI;
     |PINTA #0#2;
|FPRC;

|PROCESO Parrilla;
|FPRC;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|| **************************************************************************
|PROCESO Leed300;
   #82#5 = #82#5 + #300#35 + #300#37 + #300#41 + #300#43 + #300#47 + #300#49;
   #82#16 = #82#16 + #300#35;
   #82#17 = #82#17 + #300#37;
   #82#18 = #82#18 + #300#41;
   #82#19 = #82#19 + #300#43;
   #82#20 = #82#20 + #300#47;
   #82#21 = #82#21 + #300#49;
   #82#22 = #82#22 + #300#53;
|FPRC;

|DEFBUCLE Leed300;
 #300#1;
 ;
 enEmpresa, enEjer, #82#2, 000, 00, 00;
 enEmpresa, enEjer, #82#2, 999, 99, 99;
 e;
 NULL, Leed300;
|FIN;

|| ************************************************************************
|PROCESO dsmociva;
 #82#3 = #82#3 + #400#13;
 |SI #400#7 = 1; #82#9  = #82#9  + #400#13; |FINSI;
 |SI #400#7 = 2; #82#10 = #82#10 + #400#13; |FINSI;
 |SI #400#7 = 3; #82#11 = #82#11 + #400#13; |FINSI;
 |SI #400#7 = 4; #82#12 = #82#12 + #400#13; |FINSI;
 |SI #400#7 = 5; #82#13 = #82#13 + #400#13; |FINSI;
 |SI #400#7 = 6; #82#14 = #82#14 + #400#13; |FINSI;
 |SI #400#7 = 7; #82#15 = #82#15 + #400#13; |FINSI;
|FPRC;

|DEFBUCLE Leedsmociva;
    #400#1;
    ;
    enEmpresa, enEjer, nPeriodo, 300, 00, 01, 2, 00;
    enEmpresa, enEjer, nPeriodo, 300, 99, 99, 2, 07;
    ;
    NULL, dsmociva;
|FIN;


|PROCESO LPeriodos;

     nPeriodo = #82#2;

     #82#3  = 0; |PDEFECTO #82,9,30;
     #82#5  = 0; |PDEFECTO #82,30,55;
     |BUCLE Leed300;
     |BUCLE Leedsmociva;

     #82#31 = #0#13;
     #82#32 = #0#6;
     #82#33 = #0#7;
     #82#34 = #0#8;
     #82#35 = #0#9;
     #82#36 = #0#10;
     #82#37 = #0#11;
     #82#38 = #0#12;

     #82#6  = #82#3 - #82#5;
     #82#23 = #82#9  - #82#16;
     #82#24 = #82#10 - #82#17;
     #82#25 = #82#11 - #82#18;
     #82#26 = #82#12 - #82#19;
     #82#27 = #82#13 - #82#20;
     #82#28 = #82#14 - #82#21;
     #82#29 = #82#15 - #82#22;

     #0#13  = #82#31 + #82#5;
     #0#6   = #82#32 + #82#16;
     #0#7   = #82#33 + #82#17;
     #0#8   = #82#34 + #82#18;
     #0#9   = #82#35 + #82#19;
     #0#10  = #82#36 + #82#20;
     #0#11  = #82#37 + #82#21;
     #0#12  = #82#38 + #82#22;

     #82#39 = #82#5;
     #82#40 = #82#16;
     #82#41 = #82#17;
     #82#42 = #82#18;
     #82#43 = #82#19;
     #82#44 = #82#20;
     #82#45 = #82#21;
     #82#46 = #82#22;

     |GRABA 020#82a
     |LIBERA #82;

     |ABRE #83;
     #83#0 = #82#0;
     #83#1 = #82#1;
     #83#2 = 01;
     #83#3 = #82#2;
     |LEE 101#83=;
     |SI FSalida ! 0;
         |DDEFECTO #83;
         #83#0 = #82#0;
         #83#1 = #82#1;
         #83#2 = 01;
         #83#3 = #82#2;
         |GRABA 020#83b;
     |FINSI;
     #83#4  = #82#3;
     #83#10 = #82#9;
     #83#11 = #82#10;
     #83#12 = #82#11;
     #83#13 = #82#12;
     #83#14 = #82#13;
     #83#15 = #82#14;
     #83#16 = #82#15;

     #83#6  = #82#5;
     #83#17 = #82#16;
     #83#18 = #82#17;
     #83#19 = #82#18;
     #83#20 = #82#19;
     #83#21 = #82#20;
     #83#22 = #82#21;
     #83#23 = #82#22;

     #83#7  = #82#6;
     #83#24 = #82#23;
     #83#25 = #82#24;
     #83#26 = #82#25;
     #83#27 = #82#26;
     #83#28 = #82#27;
     #83#29 = #82#28;
     #83#30 = #82#29;

     |PARA nPara1 = 31; |SI nPara1 [ 46; |HACIENDO nPara1 = nPara1 + 1;
           #83nPara1 = #82nPara1;
     |SIGUE;
     #83#31 = #82#31;
     #83#39 = #82#39;
     |GRABA 020#83a;
     |LIBERA #83;
     |CIERRA #83;
|FPRC;

|DEFBUCLE LosPeriodos;
 #82#1;
 ;
 #80#0, #80#1, nDPeriodo;
 #80#0, #80#1, nHPeriodo;
 be;
 NULL, LPeriodos;
|FIN;

|PROCESO LEmpresa;
  enEmpresa = #118#0;
  aEmpresa = #118#0; |QBF aEmpresa;
  aEmpresa = ("00000" + aEmpresa) % -105;
  eaNom    = #118#1;
  eaNif    = #118#13;

  |DDEFECTO #80;
  #80#0 = enEmpresa;
  #80#1 = enEjer;
  |LEE 001#80=;
  |SI FSalida ! 0; |ACABA; |FINSI;

  |PDEFECTO #0,6,15;
  |BUCLE LosPeriodos;

|FPRC;

|DEFBUCLE agifigen;
 #118#1;
 ;
 nDEmpresa;
 nHEmpresa;
 e;
 NULL, LEmpresa;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     aAlfa1 = #0#3;
     aAlfa1 = "01.01." + aAlfa1; fFecIni = aAlfa1;
     aAlfa1 = #0#3;
     aAlfa1 = "31.12." + aAlfa1; fFecFin = aAlfa1;

     aDNom = " " * 40;
     aHNom = "z" * 40;
     nDPeriodo = 01;
     nHPeriodo = 11;
     |SI #0#1 ! 99;
         nDPeriodo = #0#1;
         nHPeriodo = #0#1;
     |FINSI;
     enEjer = #0#3;


     nDEmpresa = #0#4;
     nHEmpresa = #0#4;
     |ABRE #80;
     |BUCLE agifigen;
     |CIERRA #80;

|FPRC;
|| ************************************************************

|PROGRAMA;
  aParam = PARAMETRO; |QBF aParam;

  |SI aParam = "";
      |MANTE #0;
  |SINO;
      |DDEFECTO #0;
      #0#1 = enPeriodo;
      #0#3 = enEjer;
      |HAZ Tipo3;
  |FINSI;
|FPRO;
