|FICHEROS;
     dsmoc115 #0;
     dsmom002 #2;
     dsmod115 #115;
     dsmom004 #4;
     dsmom008 #8;
     dsmom037 #37;

     &regisnif@ #709;
|FIN;

|VARIABLES;
     nCampo1       = 0;
     nCampo2       = 0;
     nGrupo        = 0;
     nSuma         = 0;
     i             = 0;
     nMod          = 115;
     aDn           = "            ";
     aHn           = "zzzzzzzzzzzz";
     nDd           = 0;
     nHd           = 9999;
     aTipoCaptura  = "";
     nSwEsta       = 0;
     nEjerAnt      = 0;
     nPer          = 0;
     nSwGraba      = 0;
     nTipo         = 0;

     aPathModelo   = "";
     aDef          = "";
     aAlfa         = "";
     aPeriodicidad ="";
     nNume         = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Tipo7;  |TIPO 7;
     |SI #0#6 ! "MANUAL      ";
         |C_M #0#27, 1, "N";  |C_V #0#27, 1, "N";
     |SINO;
         |C_M #0#27, 1, "S";  |C_V #0#27, 1, "S";
     |FINSI;

     |PINTA #0#27;
|FPRC;

|PROCESO CalculaRetencion; |TIPO 0;
     nCampo1=Campo-1;
     nCampo2=Campo+1;
     #0nCampo2=#0nCampo1 % #0Campo;
     |PINTA #0nCampo2;
|FPRC;


|PROCESO Modificables; |TIPO 7;
     |ABRE #2;
     #2#0=enEmpresa;
     #2#1=enActividad;
     #2#2=enModelo;
     |LEE 000#2=;
     |SI FSalida=0;
          aPeriodicidad=#2#7;
          |QBF aPeriodicidad;
     |SINO;
          aPeriodicidad="TRIMESTRAL";
     |FINSI;
     |CIERRA #2;

     |SI aPeriodicidad!"TRIMESTRAL";
          |PARA i=14;|SI i[25;|HACIENDO i=i+1;
               |CAMPO_MODIFICA #0i,1,"N";
          |SIGUE;
     |FINSI;

     |SI #0#6 ! "MANUAL      ";
         |C_M #0#27, 1, "N";  |C_V #0#27, 1, "N";
     |SINO;
         |C_M #0#27, 1, "S";  |C_V #0#27, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Dnimoc115;  |TIPO 11;
     |SI FSalida = 10;
         eaVarDni  = #0Campo;
         enCalcCif = 0;
         |HAZ CalculameDNI;
         #0Campo = eaVarDni;
         |PINTA #0Campo;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO MiraDnimoc115;  |TIPO 6;
     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculameDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #0Campo ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PonNombre;  |TIPO 7;
     aAlfa = #0#26;  |QBF aAlfa;
     |SI aAlfa = "";
         eaCodNif = #0#6;
         |HAZ LeeNifs;
         #0#26 = #709#1;
         |PINTA #0#26;
     |FINSI;
|FPRC;

|PROCESO GrabaModelo;
     nSwGraba = 1;

     |SI #0#6 ! "            ";
         |SI #0#6 ! "PASEANTERIOR";  |Y #0#6 ! "MANUAL      ";
             #115#6 = #115#6 + 1;
         |FINSI;

         |SI #0#6 = "PASEANTERIOR";
             |SI #0#8 > 0;  |O #0#11 > 0;
                 #115#6 = #115#6 + 1;
             |FINSI;
         |FINSI;

         |SI #0#6 = "MANUAL      ";
             #115#6 = #0#27;
         |FINSI;
     |FINSI;

     #115#7  = #115#7 + #0#8  + #0#11 + #0#14 + #0#17 + #0#20 + #0#23;
     #115#8  = #115#8 + #0#10 + #0#13 + #0#16 + #0#19 + #0#22 + #0#25;
     #115#9  = 0;
     #115#10 = #115#8 - #115#9;
|FPRC;

|DEFBUCLE dsmoc115;
     #0#1;
     ;
     enEmpresa, enEjer, enPeriodo, nMod, enComplem, 01, aDn, nDd;
     enEmpresa, enEjer, enPeriodo, nMod, enComplem, 99, aHn, nHd;
     be;
     NULL, GrabaModelo;
|FIN;

|PROCESO GrabaRegistro0;
     |SI enModelo = 115;
         |ABRE #115;
         #115#0 = enEmpresa;
         #115#1 = enEjer;
         #115#2 = enPeriodo;
         #115#3 = enModelo;
         #115#4 = enComplem;
         #115#5 = 0;
         |LEE 101#115=;
         |SI FSalida = 0;
             |BORRA 020#115a;
         |FINSI;
         |LIBERA #115;
     |FINSI;

     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = enPeriodo;
     #8#3 = enModelo;
     #8#4 = enComplem;
     #8#5 = 0;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS ";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;
|FPRC;

|PROCESO BajaModelo;
     |BORRA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE dsmoc115B;
     #0#1;
     ;
     enEmpresa, enEjer, enPeriodo, nMod, enComplem, enActividad, aDn, nDd;
     enEmpresa, enEjer, enPeriodo, nMod, enComplem, enActividad, aHn, nHd;
     be;
     NULL, BajaModelo;
|FIN;

|PROCESO BorraRegistros;
     |BUCLE dsmoc115B;
     |HAZ GrabaRegistro0;

     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = nPer;
     #8#3 = 115;
     #8#4 = enComplem;
     #8#5 = enActividad;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;
|FPRC;

|PROCESO GrabaTodo;
     |ABRE #115;
     #115#0 = enEmpresa;
     #115#1 = enEjer;
     #115#2 = enPeriodo;
     #115#3 = enModelo;
     #115#4 = enComplem;
     #115#5 = 0;
     |LEE 101#115=;
     |SI FSalida = 0;
          |BORRA 020#115a;
     |FINSI;

     |DDEFECTO #115;
     #115#0 = enEmpresa;
     #115#1 = enEjer;
     #115#2 = enPeriodo;
     #115#3 = enModelo;
     #115#4 = enComplem;
     #115#5 = 0;

     nSwGraba = 0;
     |BUCLE dsmoc115;
     |SI nSwGraba = 0;
         FSalida = 0;
         |SI enDesdePase = 0;
             |SI enMasivo = 1;
                 aAlfa = ("00000" + enEmpresa) % -105;
                 aAlfa = aAlfa + " " + eaNombreEmp; |QBF aAlfa;
                 aAlfa = "0000N"+ aAlfa + ". No hay reg. NIF desea Impreso SIN Actividad ";
            |SINO;
                 aAlfa = "0000NNo hay registros de NIF desea Impreso SIN Actividad ";
            |FINSI;
            |CONFI aAlfa;
            nNume = FSalida;
            |SI enMasivo = 1; |Y enFichW103 ! 0;
                eaCa8103 = "S"; |SI nNume ! 0; eaCa8103 = "N"; |FINSI;
                |HAZ eGrabaW103;
            |FINSI;
            FSalida = nNume;
         |FINSI;
         |SI FSalida = 0;
             |ABRE #0;
             |DDEFECTO #0;
             #0#0 = enEmpresa;
             #0#1 = enEjer;
             #0#2 = enPeriodo;
             #0#3 = enModelo;
             #0#4 = enComplem;
             #0#5 = enActividad;
             #0#6 = "            ";
             #0#7 = 0000;
             |LEE 101#0=;
             || ....................... |GRABA 020#0n; No se porque se grababa antes
             |SI FSalida ! 0;
                 |GRABA 020#0b;
             |FINSI;
             |GRABA 020#0a;
             |LIBERA #0;
             |CIERRA #0;
             nSwGraba = 1;
         |FINSI;
     |FINSI;

     |SI nSwGraba ! 0;
         |SI #115#4 ! 0;  |Y #115#11 = "             ";
             |ABRE #4;
             #4#0 = #115#0;
             #4#1 = #115#1;
             #4#2 = #115#2;
             #4#3 = #115#3;
             #4#4 = #115#4 - 1;
             |LEE 000#4=;
             |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
             |CIERRA #4;

             #115#11 = #4#19;
         |FINSI;

          |GRABA 020#115n;
          |LIBERA #115;

          |ABRE #8;
          #8#0 = enEmpresa;
          #8#1 = enEjer;
          #8#2 = enPeriodo;
          #8#3 = enModelo;
          #8#4 = enComplem;
          #8#5 = enActividad;
          |LEE 101#8=;
          |SI FSalida = 0;
               #8#11 = "COMPLETADO";
               |GRABA 020#8a;
          |FINSI;
          |LIBERA #8;

          #8#0 = enEmpresa;
          #8#1 = enEjer;
          #8#2 = enPeriodo;
          #8#3 = enModelo;
          #8#4 = enComplem;
          #8#5 = 0;
          |LEE 101#8=;
          |SI FSalida = 0;
               #8#11 = "EXISTENTE";
               |GRABA 020#8a;
          |FINSI;
          |LIBERA #8;
          |CIERRA #8;
     |FINSI;
     |CIERRA #115;
|FPRC;

|PROCESO AltaModelo;
     |ABRET #0;
     |HAZ PintaDatos;
     |ENTLINEAL #1#0, -7, 2, 22, 1, ClaveBaja0, ClaveAlta0;
     |CIERRAT #0;

     |HAZ GrabaTodo;
|FPRC;

|RUTINA ClaveBaja0;
     #0#0 = enEmpresa;
     #0#1 = enEjer;
     #0#2 = enPeriodo;
     #0#3 = enModelo;
     #0#4 = enComplem;
     #0#5 = enActividad;
     #0#6 = "            ";
     #0#7 = 0000;
|FRUT;

|RUTINA ClaveAlta0;
     #0#0 = enEmpresa;
     #0#1 = enEjer;
     #0#2 = enPeriodo;
     #0#3 = enModelo;
     #0#4 = enComplem;
     #0#5 = enActividad;
     #0#6 = "zzzzzzzzzzzz";
     #0#7 = 9999;
|FRUT;

|PROCESO TipoCaptura;
     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = enPeriodo;
     #8#3 = enModelo;
     #8#4 = enComplem;
     #8#5 = enActividad;
     |LEE 101#8=;
     |SI FSalida = 0;
          aTipoCaptura = #8#7;
          |QBF aTipoCaptura;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROGRAMA;
     eaNoVisu = "";
     eaNomDef = "dsmoc115";

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
          |HAZ PintaDatos;
          |ENTLINEAL #1#0, -7, 4, 22, 1, ClaveBaja0, ClaveAlta0;
          |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              ||Baja del Modelo
         |HAZ BorraRegistros;
         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo desde Modulo////////

     |SI enTipoEntrada = 97;              ||Baja del Modelo
         |HAZ BorraRegistros;
         |ACABA;
     |FINSI;

|| \\\\\\ Alta o Modificacion del Modelo ////////

     |SI enTipoEntrada = 1;              || Alta del Modelo
         |CABEZA "Modelo Trabajo 115";
         |HAZ AltaModelo;
         |ACABA;
     |FINSI;

|| \\\\\\ Grabacion del Modelo desde el Exterior

     |SI enTipoEntrada = 98;
         |ABRET #0;
         |HAZ GrabaTodo;
         |CIERRAT #0;
         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         #0#6 = "            ";
         #0#7 = 0;
         |LEE 040#0];
         |SI FSalida ! 0;  |O #0#0 ! enEmpresa;  |O #0#1 ! enEjer; |O #0#2 ! enPeriodo;
          |O #0#3 ! enModelo;  |O #0#4 ! enComplem; |O #0#5 ! enActividad;
             enExistencia = 1;
         |FINSI;
         |CIERRA #0;
     |FINSI;
|FPRO;
