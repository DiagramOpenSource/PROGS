|FICHEROS;
    repatrim #0;
    retotpat #1;
    retabla3 #2;
    redatcon #3;
    retotren #4;
    reliquid #10;
    recapinm #89;
    reactafe #90;
    rectacor #91;
    revalono #92;
    revalore #93;
    reempagr #94;
    reempedi #95;
    reempmod #96;
    reemprco #97;
    reproedi #98;
    reprofco #99;
|FIN;

|VARIABLES;
    nume1 = 0;
    Letra = "";
|FIN;

|INCLUYE i_varcal;

|PROCESO El90;
   |SI Letra = #90#53; |Y #0#2 = #90#54;
       |SI #90#38 ! 0; coefi = #90#38; tipo = "T"; |HAZ grabapat; |FINSI;
       |SI #90#39 ! 0; coefi = #90#39; tipo = "C"; |HAZ grabapat; |FINSI;
       |SI #90#40 ! 0; coefi = #90#40; tipo = "1"; |HAZ grabapat; |FINSI;
       |SI #90#41 ! 0; coefi = #90#41; tipo = "2"; |HAZ grabapat; |FINSI;
       |SI #90#42 ! 0; coefi = #90#42; tipo = "3"; |HAZ grabapat; |FINSI;
       |SI #90#43 ! 0; coefi = #90#43; tipo = "4"; |HAZ grabapat; |FINSI;
   |FINSI;

   |SI Letra = #90#56; |Y #0#2 = #90#57;
       |SI #90#38 ! 0; coefi = #90#38; tipo = "T"; |HAZ grabapat; |FINSI;
       |SI #90#39 ! 0; coefi = #90#39; tipo = "C"; |HAZ grabapat; |FINSI;
       |SI #90#40 ! 0; coefi = #90#40; tipo = "1"; |HAZ grabapat; |FINSI;
       |SI #90#41 ! 0; coefi = #90#41; tipo = "2"; |HAZ grabapat; |FINSI;
       |SI #90#42 ! 0; coefi = #90#42; tipo = "3"; |HAZ grabapat; |FINSI;
       |SI #90#43 ! 0; coefi = #90#43; tipo = "4"; |HAZ grabapat; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE PReactafe;
#90#1;
;
#0#0, 00;
#0#0, 99;
;
NULL, El90;
|FIN;

|PROCESO El89;
   |SI Letra = #89#73; |Y #0#2 = #89#74;
       |SI #89#49 ! 0; coefi = #89#49; tipo = "T"; |HAZ grabapat; |FINSI;
       |SI #89#50 ! 0; coefi = #89#50; tipo = "C"; |HAZ grabapat; |FINSI;
       |SI #89#51 ! 0; coefi = #89#51; tipo = "1"; |HAZ grabapat; |FINSI;
       |SI #89#52 ! 0; coefi = #89#52; tipo = "2"; |HAZ grabapat; |FINSI;
       |SI #89#53 ! 0; coefi = #89#53; tipo = "3"; |HAZ grabapat; |FINSI;
       |SI #89#54 ! 0; coefi = #89#54; tipo = "4"; |HAZ grabapat; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE PRecapinm;
#89#1;
;
#0#0, 00;
#0#0, 99;
;
NULL, El89;
|FIN;

|PROCESO El91;
   |SI Letra = #91#29; |Y #0#2 = #91#30;
       |SI #91#7  ! 0; coefi = #91#7;  tipo = "T"; |HAZ grabapat; |FINSI;
       |SI #91#8  ! 0; coefi = #91#8;  tipo = "C"; |HAZ grabapat; |FINSI;
       |SI #91#9  ! 0; coefi = #91#9;  tipo = "1"; |HAZ grabapat; |FINSI;
       |SI #91#10 ! 0; coefi = #91#10; tipo = "2"; |HAZ grabapat; |FINSI;
       |SI #91#11 ! 0; coefi = #91#11; tipo = "3"; |HAZ grabapat; |FINSI;
       |SI #91#12 ! 0; coefi = #91#12; tipo = "4"; |HAZ grabapat; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE PRectacor;
#91#1;
;
#0#0, 00;
#0#0, 99;
;
NULL, El91;
|FIN;

|PROCESO El92;
   |SI Letra = #92#45; |Y #0#2 = #92#47;
       |SI #92#7  ! 0; coefi = #92#7;  tipo = "T"; |HAZ grabapat; |FINSI;
       |SI #92#8  ! 0; coefi = #92#8;  tipo = "C"; |HAZ grabapat; |FINSI;
       |SI #92#9  ! 0; coefi = #92#9;  tipo = "1"; |HAZ grabapat; |FINSI;
       |SI #92#10 ! 0; coefi = #92#10; tipo = "2"; |HAZ grabapat; |FINSI;
       |SI #92#11 ! 0; coefi = #92#11; tipo = "3"; |HAZ grabapat; |FINSI;
       |SI #92#12 ! 0; coefi = #92#12; tipo = "4"; |HAZ grabapat; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE PRevalono;
#92#1;
;
#0#0, 00;
#0#0, 99;
;
NULL, El92;
|FIN;

|PROCESO El93;
   |SI Letra = #93#43; |Y #0#2 = #93#44;
       |SI #93#7  ! 0; coefi = #93#7;  tipo = "T"; |HAZ grabapat; |FINSI;
       |SI #93#8  ! 0; coefi = #93#8;  tipo = "C"; |HAZ grabapat; |FINSI;
       |SI #93#9  ! 0; coefi = #93#9;  tipo = "1"; |HAZ grabapat; |FINSI;
       |SI #93#10 ! 0; coefi = #93#10; tipo = "2"; |HAZ grabapat; |FINSI;
       |SI #93#11 ! 0; coefi = #93#11; tipo = "3"; |HAZ grabapat; |FINSI;
       |SI #93#12 ! 0; coefi = #93#12; tipo = "4"; |HAZ grabapat; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE PRevalore;
#93#1;
;
#0#0, 00;
#0#0, 99;
;
NULL, El93;
|FIN;

|PROCESO El94;
   |SI Letra = #94#35; |Y #0#2 = #94#36;
       |SI #94#7  ! 0; coefi = #94#7;  tipo = "T"; |HAZ grabapat; |FINSI;
       |SI #94#8  ! 0; coefi = #94#8;  tipo = "C"; |HAZ grabapat; |FINSI;
       |SI #94#9  ! 0; coefi = #94#9;  tipo = "1"; |HAZ grabapat; |FINSI;
       |SI #94#10 ! 0; coefi = #94#10; tipo = "2"; |HAZ grabapat; |FINSI;
       |SI #94#11 ! 0; coefi = #94#11; tipo = "3"; |HAZ grabapat; |FINSI;
       |SI #94#12 ! 0; coefi = #94#12; tipo = "4"; |HAZ grabapat; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE PReempagr;
#94#1;
;
#0#0, 00;
#0#0, 99;
;
NULL, El94;
|FIN;

|PROCESO El95;
   |SI Letra = #95#58; |Y #0#2 = #95#59;
       |SI #95#7  ! 0; coefi = #95#7;  tipo = "T"; |HAZ grabapat; |FINSI;
       |SI #95#8  ! 0; coefi = #95#8;  tipo = "C"; |HAZ grabapat; |FINSI;
       |SI #95#9  ! 0; coefi = #95#9;  tipo = "1"; |HAZ grabapat; |FINSI;
       |SI #95#10 ! 0; coefi = #95#10; tipo = "2"; |HAZ grabapat; |FINSI;
       |SI #95#11 ! 0; coefi = #95#11; tipo = "3"; |HAZ grabapat; |FINSI;
       |SI #95#12 ! 0; coefi = #95#12; tipo = "4"; |HAZ grabapat; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE PReempedi;
#95#1;
;
#0#0, 00;
#0#0, 99;
;
NULL, El95;
|FIN;

|PROCESO El96;
   |SI Letra = #96#66; |Y #0#2 = #96#67;
       |SI #96#7  ! 0; coefi = #96#7;  tipo = "T"; |HAZ grabapat; |FINSI;
       |SI #96#8  ! 0; coefi = #96#8;  tipo = "C"; |HAZ grabapat; |FINSI;
       |SI #96#9  ! 0; coefi = #96#9;  tipo = "1"; |HAZ grabapat; |FINSI;
       |SI #96#10 ! 0; coefi = #96#10; tipo = "2"; |HAZ grabapat; |FINSI;
       |SI #96#11 ! 0; coefi = #96#11; tipo = "3"; |HAZ grabapat; |FINSI;
       |SI #96#12 ! 0; coefi = #96#12; tipo = "4"; |HAZ grabapat; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE PReempmod;
#96#1;
;
#0#0, 00;
#0#0, 99;
;
NULL, El96;
|FIN;

|PROCESO El97;
   |SI Letra = #97#49; |Y #0#2 = #97#50;
       |SI #97#7  ! 0; coefi = #97#7;  tipo = "T"; |HAZ grabapat; |FINSI;
       |SI #97#8  ! 0; coefi = #97#8;  tipo = "C"; |HAZ grabapat; |FINSI;
       |SI #97#9  ! 0; coefi = #97#9;  tipo = "1"; |HAZ grabapat; |FINSI;
       |SI #97#10 ! 0; coefi = #97#10; tipo = "2"; |HAZ grabapat; |FINSI;
       |SI #97#11 ! 0; coefi = #97#11; tipo = "3"; |HAZ grabapat; |FINSI;
       |SI #97#12 ! 0; coefi = #97#12; tipo = "4"; |HAZ grabapat; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE PReemprco;
#97#1;
;
#0#0, 00;
#0#0, 99;
;
NULL, El97;
|FIN;

|PROCESO El98;
   |SI Letra = #98#40; |Y #0#2 = #98#41;
       |SI #98#7  ! 0; coefi = #98#7;  tipo = "T"; |HAZ grabapat; |FINSI;
       |SI #98#8  ! 0; coefi = #98#8;  tipo = "C"; |HAZ grabapat; |FINSI;
       |SI #98#9  ! 0; coefi = #98#9;  tipo = "1"; |HAZ grabapat; |FINSI;
       |SI #98#10 ! 0; coefi = #98#10; tipo = "2"; |HAZ grabapat; |FINSI;
       |SI #98#11 ! 0; coefi = #98#11; tipo = "3"; |HAZ grabapat; |FINSI;
       |SI #98#12 ! 0; coefi = #98#12; tipo = "4"; |HAZ grabapat; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE PReproedi;
#98#1;
;
#0#0, 00;
#0#0, 99;
;
NULL, El98;
|FIN;

|PROCESO El99;
   |SI Letra = #99#47; |Y #0#2 = #99#48;
       |SI #99#7  ! 0; coefi = #99#7;  tipo = "T"; |HAZ grabapat; |FINSI;
       |SI #99#8  ! 0; coefi = #99#8;  tipo = "C"; |HAZ grabapat; |FINSI;
       |SI #99#9  ! 0; coefi = #99#9;  tipo = "1"; |HAZ grabapat; |FINSI;
       |SI #99#10 ! 0; coefi = #99#10; tipo = "2"; |HAZ grabapat; |FINSI;
       |SI #99#11 ! 0; coefi = #99#11; tipo = "3"; |HAZ grabapat; |FINSI;
       |SI #99#12 ! 0; coefi = #99#12; tipo = "4"; |HAZ grabapat; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE PReprofco;
#99#1;
;
#0#0, 00;
#0#0, 99;
;
NULL, El98;
|FIN;

|PROCESO calculo;
  tipo  = #0#3;
  coefi = 100;

  Letra = #0#1;

  |SI #0#1 = "D1";  Letra = "E1";  |FINSI;
  |SI #0#1 = "E1";  Letra = "F1";  |FINSI;
  |SI #0#1 = "E2";  Letra = "F2";  |FINSI;
  |SI #0#1 = "F1";  Letra = "G1";  |FINSI;
  |SI #0#1 = "F2";  Letra = "G2";  |FINSI;
  |SI #0#1 = "F3";  Letra = "G3";  |FINSI;
  |SI #0#1 = "F4";  Letra = "G4";  |FINSI;
  |SI #0#1 = "F5";  Letra = "H1";  |FINSI;
  |SI #0#1 = "F6";  Letra = "H2";  |FINSI;

|SI #0#3 = "V";
    |SI #0#1 = "A1"; |O #0#1 = "B1";
        SwEncuentro = 0;     |BUCLE PRecapinm;
        |SI SwEncuentro = 0; |BUCLE PReactafe; |FINSI;
    |FINSI;

    |SI #0#1 = "C1";
        SwEncuentro = 0;     |BUCLE PReempagr;
        |SI SwEncuentro = 0; |BUCLE PReempedi; |FINSI;
        |SI SwEncuentro = 0; |BUCLE PReempmod; |FINSI;
        |SI SwEncuentro = 0; |BUCLE PReemprco; |FINSI;
        |SI SwEncuentro = 0; |BUCLE PReproedi; |FINSI;
        |SI SwEncuentro = 0; |BUCLE PReprofco; |FINSI;
    |FINSI;

    |SI #0#1 = "C2"; |O #0#1 = "C3";
        SwEncuentro = 0;     |BUCLE PReactafe;
    |FINSI;

    |SI #0#1 = "D1"; |O #0#1 = "E1"; |O #0#1 = "E2"; |O #0#1 = "F1";
     |O #0#1 = "F2"; |O #0#1 = "F3"; |O #0#1 = "F4"; |O #0#1 = "F5";
     |O #0#1 = "F6";
        SwEncuentro = 0;     |BUCLE PRectacor;
        |SI SwEncuentro = 0; |BUCLE PRevalore; |FINSI;
        |SI SwEncuentro = 0; |BUCLE PRevalono; |FINSI;
    |FINSI;

    |SI #0#1 = "H1";
        SwEncuentro = 0;     |BUCLE PRectacor;
    |FINSI;

    |ACABA;
|FINSI;

|SI #0#3 = "G";
    tipo = "T"; coefi = 50; |HAZ grabapat;
    tipo = "C"; coefi = 50; |HAZ grabapat;
|SINO;
    |HAZ grabapat;
|FINSI;
|FPRC;

|PROCESO liquida_07;
|DDEFECTO #4;
    #4#0 = #1#0;
    #4#141 = #1#28;
|LEE 000#4=;             || lee retotren

|DDEFECTO #3;
    #3#0 = #1#0;
|LEE 000#3=;             || lee redatcon

    #1#18 = 0;
|PARA x = 1; |SI x [ 17; |HACIENDO x = x + 1;
        #1#18 = #1#18 + #1x;
|SIGUE;
    #1#18 = #1#18 + #1#44 + #1#45;      || total bienes y derechos exentos
    #1#20 = #1#18 - #1#19;              || base imponible
|SI #3#4 = "S";                              || si es residente
    |SI #4#39 = 0; #1#21 = 17000000; |FINSI; || reduccion 17 millones
    |SI #4#39 ! 0; #1#21 = 17000000; |FINSI;
|SINO;
        #1#21 = 0;
|FINSI;

    #1#22 = #1#20 - #1#21;              || base liquidable
|SI #1#22 < 0; #1#22 = 0; |FINSI;

    sw = 0;
    pepe = 0;
    pepa = 0;
    pepi = 0;
|PARA pepe = 8;|SI pepe ] 1; |HACIENDO pepe = pepe - 1;
    |SI #1#22 ] #2pepe; |Y sw = 0;
            pepa  = pepe + 16;
            pepi  = pepe + 8;
            #1#24 = #2pepe;        || hasta
            #1#26 = #2pepa;        || porcentaje
            #1#29 = #2pepi;        || cuota hasta
            sw = 1;
            pepe = 0;
    |FINSI;
|SIGUE;
|SI sw = 0; #1#26 = #2#24; |FINSI;
    #1#25 = #1#22 - #1#24;              || resto
    #1#27 = #1#25 % #1#26;              || cuota resto
    #1#23 = #1#29 + #1#27;              || cuota integra

|SI #3#4 ! "N";
        #1#31 = #1#23 - ((((#1#23 * 100) / #1#20) * #1#31) / 100);
    |SI swrenta = 0;
            #1#30 = #4#85;
            #1#33 = (#4#32 + #4#54) % 70;
    |FINSI;
    |SI #1#30 < 0; #1#30 = 0; |FINSI;
        #1#32 = #1#30 + #1#31;
    |SI #1#33 < 0; #1#33 = 0; |FINSI;
    |SI #1#33 ] #1#32;
            #1#36 = #1#23;
            #1#34 = 0;
            #1#35 = 0;
    |SINO;
            #1#34 = #1#32 - #1#33;
            #1#35 = #1#23 % 80;
            resta = #1#34;
        |SI resta > #1#35; resta = #1#35; |FINSI;
            #1#36 = #1#23 - resta;
    |FINSI;
|SINO;
        #1#30 = 0; #1#31 = 0; #1#32 = 0;
        #1#33 = 0; #1#34 = 0; #1#35 = 0;
        #1#36 = #1#23;
|FINSI;

    #1#49 = (#1#36 - (#1#36 $ #1#22)) / #1#22;         || parte entera TM
    #1#50 = (((#1#36 $ #1#22) / #1#22) * 100) ! 0;     || parte decimal TM

    nume1 = #1#26 * 100;
    #1#51 = (nume1 - (nume1 $ 100)) / 100;             || parte entera CI
    #1#52 = nume1 $ 100;                               || parte decimal CI

    #1#43 = (#1#36 / #1#22) * #1#43;
    #1#37 = #1#42;
|SI #1#37 > #1#43; #1#37 = #1#43; |FINSI;
    #1#39 = (#1#38 * #1#36) / #1#20;

    #1#40     = #1#39 % 50;
    LimiteMio = #1#36 % 50;
|SI #1#40 > LimiteMio; #1#40 = LimiteMio; |FINSI;

    #1#41 = #1#36 - #1#37 - #1#40;
|GRABA 020#1a;
|LIBERA #1;

|DDEFECTO #10;
    #10#0 = #1#0;
|LEE 101#10=;
  FEstado = FSalida;

|SI #1#22 > 0;
    |SI #1#28 = "T";     #10#29 = "S"; #10#35 = #1#41; |FINSI;
    |SI #1#28 = "C";     #10#30 = "S"; #10#36 = #1#41; |FINSI;
    |SI #1#28 = "1";     #10#31 = "S"; #10#37 = #1#41; |FINSI;
    |SI #1#28 = "2";     #10#32 = "S"; #10#38 = #1#41; |FINSI;
    |SI #1#28 = "3";     #10#33 = "S"; #10#39 = #1#41; |FINSI;
    |SI #1#28 = "4";     #10#34 = "S"; #10#40 = #1#41; |FINSI;
    |SI FEstado = 0;     |GRABA 020#10a;     |FINSI;
    |SI FEstado ! 0;     |GRABA 020#10n;     |FINSI;
|FINSI;

|LIBERA #10;
|FPRC;

|PROCESO grabapat;
|DDEFECTO #1;
    #1#0 = #0#0;
    #1#28 = tipo;
|LEE 101#1=;
    FEstad1 = FSalida;

|SI #0#1 = "A1"; #1#1  = #1#1  + (#0#9  % coefi); |FINSI;   || A
|SI #0#1 = "B1"; #1#2  = #1#2  + (#0#9  % coefi); |FINSI;   || B
|SI #0#1 = "C1"; #1#53 = #1#53 + (#0#9  % coefi); |FINSI;   || C1
|SI #0#1 = "C1"; #1#3  = #1#3  + (#0#9  % coefi); |FINSI;   || C
|SI #0#1 = "C2"; #1#54 = #1#54 + (#0#9  % coefi); |FINSI;   || C2
|SI #0#1 = "C2"; #1#3  = #1#3  + (#0#9  % coefi); |FINSI;   || C
|SI #0#1 = "C3"; #1#46 = #1#46 + (#0#9  % coefi); |FINSI;   || D
|SI #0#1 = "D1"; #1#4  = #1#4  + (#0#9  % coefi); |FINSI;   || E
|SI #0#1 = "E1"; #1#5  = #1#5  + (#0#9  % coefi); |FINSI;   || F1
|SI #0#1 = "E2"; #1#6  = #1#6  + (#0#9  % coefi); |FINSI;   || F2
|SI #0#1 = "F1"; #1#7  = #1#7  + (#0#9  % coefi); |FINSI;   || G1
|SI #0#1 = "F2"; #1#8  = #1#8  + (#0#9  % coefi); |FINSI;   || G2
|SI #0#1 = "F3"; #1#44 = #1#44 + (#0#9  % coefi); |FINSI;   || G3
|SI #0#1 = "F4"; #1#45 = #1#45 + (#0#9  % coefi); |FINSI;   || G4
|SI #0#1 = "F5"; #1#47 = #1#47 + (#0#9  % coefi); |FINSI;   || H1
|SI #0#1 = "F6"; #1#48 = #1#48 + (#0#9  % coefi); |FINSI;   || H2
|SI #0#1 = "G1"; #1#9  = #1#9  + (#0#9  % coefi); |FINSI;   || I
|SI #0#1 = "H1"; #1#10 = #1#10 + (#0#9  % coefi); |FINSI;   || J
|SI #0#1 = "I1"; #1#11 = #1#11 + (#0#9  % coefi); |FINSI;   || K
|SI #0#1 = "J1"; #1#12 = #1#12 + (#0#9  % coefi); |FINSI;   || L
|SI #0#1 = "K1"; #1#13 = #1#13 + (#0#9  % coefi); |FINSI;   || M
|SI #0#1 = "L1"; #1#14 = #1#14 + (#0#9  % coefi); |FINSI;   || N
|SI #0#1 = "M1"; #1#15 = #1#15 + (#0#9  % coefi); |FINSI;   || O
|SI #0#1 = "N1"; #1#16 = #1#16 + (#0#9  % coefi); |FINSI;   || P
|SI #0#1 = "O1"; #1#17 = #1#17 + (#0#9  % coefi); |FINSI;   || Q
|SI #0#1 = "U1"; #1#19 = #1#19 + (#0#9  % coefi); |FINSI;   || DEUDAS
|SI #0#1 = "V1"; #1#31 = #1#31 + (#0#9  % coefi); |FINSI;   || parte c.integ.
|SI #0#1 = "V2"; #1#42 = #1#42 + (#0#9  % coefi); |FINSI;   || imp.extranjero
|SI #0#1 = "V2"; #1#43 = #1#43 + (#0#13 % coefi); |FINSI;   || % valor bienes
|SI #0#1 = "V3"; #1#38 = #1#38 + (#0#9  % coefi); |FINSI;   || ceuta-melilla
|SI #0#1 = "V4";
        swrenta = 1;
        #1#30 = #1#30 + (#0#13  % coefi);                   || c.integ.
        #1#33 = #1#33 + (#0#9   % coefi);                   || limite conjun.
|FINSI;

|SI FEstad1 = 0;    |GRABA 020#1a; |FINSI;
|SI FEstad1 ! 0;    |GRABA 020#1n; |FINSI;
|LIBERA #1;
|FPRC;

|DEFBUCLE repatrim;
 #0#1;
 ;
 empresa, desde,   1;
 emprefi, hasta, 999;
 ;
 NULL, calculo;
|FIN;

|DEFBUCLE liquida;
 #1#1;
 ;
 empresa, " ";
 emprefi, "z";
 be;
 NULL, liquida_07;
|FIN;

|PROCESO recalcu7;
swrenta = 0;
|ABRE #1;
|BUCLE repatrim;
|CIERRA #1;

|DDEFECTO #2;
|ABRE #2;
|LEE 000#2p;
|CIERRA #2;

|ABRE #3;
|ABRE #4;
|ABRE #10;
|BUCLE liquida;
|CIERRA #4;
|CIERRA #3;
|CIERRA #10;
|FPRC;
