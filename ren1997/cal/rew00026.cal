|FICHEROS;
     redatcon #1;
     rehacien #2;
     repoblac #4;
     retotren #5;
     rew00001 #99;
     rew00026 #617;
|FIN;

|VARIABLES;
     Cuenta       = "";
     XCampos      = 0;
     NSecuencial  = "";
     Field        = "";

     &VEmpresa    = 0;
     &VTipo       = "";
     &DiaInf      = "";
     &MesInf      = "";
     &EjerInf     = "";
     &NCopia      = 0;
     &VSwCarga    = 0;
     &VTemporal0  = "";
     &VTemporal17 = "";

{200}&NEmpresas  = "";
|FIN;

|INCLUYE i_utilid;

|PROCESO LeeFicheros;
  |ABRE #99;
  #99#0 = VEmpresa;
  #99#1 = VTipo;
  |LEE 040#99=;
  |SI FSalida ! 0; |DDEFECTO #99; |FINSI;
  |CIERRA #99;

  |ABRE #1;
  #1#0 = #99#0;
  |LEE 040#1=;
  |SI FSalida ! 0; |DDEFECTO #1; |FINSI;
  |CIERRA #1;

  |ABRE #2;
  #2#0 = #1#40;
  #2#1 = #1#41;
  |LEE 040#2=;
  |SI FSalida ! 0; |DDEFECTO #2; |FINSI;
  |CIERRA #2;

  |ABRE #4;
  #4#0 = #1#12;
  #4#1 = #1#13;
  |LEE 040#4=;
  |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
  |CIERRA #4;

  |ABRE #5;
  #5#0   = #99#0;
  #5#141 = #99#1;
  |LEE 040#5=;
  |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
  |CIERRA #5;
|FPRC;

|PROCESO CargaHoja17;
  |HAZ LeeFicheros;

  #617#0 = 0;
  |LIBERA #617;
  |LEE 140#617=;
  |SI FSalida ! 0;
      |DDEFECTO #617;
      #617#0 = 0;
      |GRABA 140#617b;
  |FINSI;

  #617#49 = #2#2;
  #617#50 = #2#3;
  #617#51 = (("00" + #2#0) % -102) + (("000" + #2#1) % -103);
  #617#52 = #99#7;
  #617#53 = #99#3;
  #617#54 = #99#0;
  #617#4  = #1#6;
  #617#5  = #1#7;
  #617#6  = #1#8;
  #617#7  = #1#9;
  #617#8  = #1#10;
  #617#9  = #1#11;
  #617#10 = #1#15;
  #617#11 = #1#14;
  #617#12 = #4#2;
  #617#13 = (("00" + #1#12) % -102) + (("000" + #1#13) % -103);

  |SI #99#1 = "A"; |O #99#1 = "T";
      #617#14 = #1#29;
      #617#15 = #1#212 + #1#213;
      #617#16 = #1#214;
  |FINSI;

  |SI #99#1 = "C";
      #617#14 = #1#2;
      #617#15 = #1#209 + #1#210;
      #617#16 = #1#211;
  |FINSI;

  #617#17 = #5#139;

  |SI #5#139 > 0; #617#22 = "X"; |FINSI;

  |SI #99#1 = "A";
      Cuenta  = #1#174; |QBF Cuenta;

      |SI #5#139 > 0;
          |SI #1#110 = "S"; #617#22 = " "; #617#23 = "X"; #617#31 = " "; |FINSI;
          |SI #1#110 = "s"; #617#22 = " "; #617#23 = " "; #617#31 = "X"; |FINSI;
      |SINO;
          #617#37 = " ";
          #617#38 = " ";
          |SI #1#117 = "S"; #617#37 = "X"; |SINO;  #617#38 = "X";|FINSI;
      |FINSI;
  |FINSI;

  |SI #99#1 = "T";
      Cuenta  = #1#175; |QBF Cuenta;

      |SI #5#139 > 0;
          |SI #1#111 = "S"; #617#22 = " "; #617#23 = "X"; #617#31 = " "; |FINSI;
          |SI #1#111 = "s"; #617#22 = " "; #617#23 = " "; #617#31 = "X"; |FINSI;
      |SINO;
          #617#37 = " ";
          #617#38 = " ";
          |SI #1#118 = "S"; #617#37 = "X"; |SINO;  #617#38 = "X";|FINSI;
      |FINSI;
  |FINSI;

  |SI #99#1 = "C";
      Cuenta  = #1#176; |QBF Cuenta;

      |SI #5#139 > 0;
          |SI #1#112 = "S"; #617#22 = " "; #617#23 = "X"; #617#31 = " "; |FINSI;
          |SI #1#112 = "s"; #617#22 = " "; #617#23 = " "; #617#31 = "X"; |FINSI;
      |SINO;
          #617#37 = " ";
          #617#38 = " ";
          |SI #1#119 = "S"; #617#37 = "X"; |SINO;  #617#38 = "X";|FINSI;
      |FINSI;
  |FINSI;

  |SI #99#1 = "1";
      Cuenta  = #1#177; |QBF Cuenta;

      |SI #5#139 > 0;
          |SI #1#113 = "S"; #617#22 = " "; #617#23 = "X"; #617#31 = " "; |FINSI;
          |SI #1#113 = "s"; #617#22 = " "; #617#23 = " "; #617#31 = "X"; |FINSI;
      |SINO;
          #617#37 = " ";
          #617#38 = " ";
          |SI #1#120 = "S"; #617#37 = "X"; |SINO;  #617#38 = "X";|FINSI;
      |FINSI;
  |FINSI;

  |SI #99#1 = "2";
      Cuenta  = #1#178; |QBF Cuenta;

      |SI #5#139 > 0;
          |SI #1#114 = "S"; #617#22 = " "; #617#23 = "X"; #617#31 = " "; |FINSI;
          |SI #1#114 = "s"; #617#22 = " "; #617#23 = " "; #617#31 = "X"; |FINSI;
      |SINO;
          #617#37 = " ";
          #617#38 = " ";
          |SI #1#121 = "S"; #617#37 = "X"; |SINO;  #617#38 = "X";|FINSI;
      |FINSI;
  |FINSI;

  |SI #99#1 = "3";
      Cuenta  = #1#179; |QBF Cuenta;

      |SI #5#139 > 0;
          |SI #1#115 = "S"; #617#22 = " "; #617#23 = "X"; #617#31 = " "; |FINSI;
          |SI #1#115 = "s"; #617#22 = " "; #617#23 = " "; #617#31 = "X"; |FINSI;
      |SINO;
          #617#37 = " ";
          #617#38 = " ";
          |SI #1#122 = "S"; #617#37 = "X"; |SINO;  #617#38 = "X";|FINSI;
      |FINSI;
  |FINSI;

  |SI #99#1 = "4";
      Cuenta  = #1#180; |QBF Cuenta;

      |SI #5#139 > 0;
          |SI #1#116 = "S"; #617#22 = " "; #617#23 = "X"; #617#31 = " "; |FINSI;
          |SI #1#116 = "s"; #617#22 = " "; #617#23 = " "; #617#31 = "X"; |FINSI;
      |SINO;
          #617#37 = " ";
          #617#38 = " ";
          |SI #1#123 = "S"; #617#37 = "X"; |SINO;  #617#38 = "X";|FINSI;
      |FINSI;
  |FINSI;

  |QBF Cuenta;
  Cuenta = (Cuenta + (" " * 20)) 120;

  |SI #617#22 = "X"; #617#24 = #5#139;      |FINSI;
  |SI #617#23 = "X";  |O #617#31 = "X";
      #617#24 = #5#139 % 60;
      #617#32 = #5#139 % 40;
  |FINSI;
  |SI #617#31 = "X";
      #617#33 = Cuenta % 104;
      #617#34 = Cuenta % 504;
      #617#35 = Cuenta % 902;
      #617#36 = Cuenta % 1110;
  |FINSI;

  |SI #5#139 < 0;
      #617#39 = -#5#139;
      #617#40 = Cuenta % 104;
      #617#41 = Cuenta % 504;
      #617#42 = Cuenta % 902;
      #617#43 = Cuenta % 1110;
  |FINSI;

  #617#27 = Cuenta % 104;
  #617#28 = Cuenta % 504;
  #617#29 = Cuenta % 902;
  #617#30 = Cuenta % 1110;
  #617#44 = #1#14;
  #617#45 = DiaInf;
  #617#46 = MesInf;
  #617#47 = EjerInf;

  |GRABA 140#617a;
|FPRC;

|PROCESO GrabaH17M100;
  |HAZ BorraCampos;

  ICampos = Campos1 <-;
  |PARA XCampos = 1;  |SI XCampos [ 48;  |HACIENDO XCampos = XCampos + 1;
        Campos = #617XCampos;
        ICampos = ICampos + 1;
  |SIGUE;

  ICampos = Campos1  <-;                                    Campos = "100";
  ICampos = Campos2  <-;                                    Campos = "17";
  |SI VSwCarga = 101;
      ICampos = Campos1  <-;                                    Campos = "101";
      ICampos = Campos2  <-;                                    Campos = "06";
  |FINSI;
  |SI VSwCarga = 103;
      ICampos = Campos1  <-;                                    Campos = "103";
      ICampos = Campos2  <-;                                    Campos = "03";
  |FINSI;

  ICampos = Campos3  <-;                                    Campos = " ";
  ICampos = Campos14 <-; CampoDni = Campos;  |HAZ LetraDni; Campos = CampoDni;
  ICampos = Campos17 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos18 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos19 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos20 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos21 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos24 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos32 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos39 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos48 <-; Valfa    = &13 + &10;                    Campos = Valfa;

  INEmpresas = NEmpresas1 <-;
  INEmpresas = INEmpresas + NCopia;

  Pos = -1;
  NSecuencial = "r+b " + NEmpresas;
  |FABRE NSecuencial;
  |SI FSalida < 0;
      NSecuencial = "wb  " + NEmpresas;
      |FABRE NSecuencial;
  |FINSI;

  Handle = FSalida;
  |SI FSalida ] 0;
      |PARA; |SI; |HACIENDO;
           Field = Handle + " 255";
           |FLEE Field;
           |SI FSalida [ 0;  |SAL;  |FINSI;
      |SIGUE;
  |FINSI;

  ICampos = Campos1 <-;
  |PARA XPara = 1; |SI XPara [ 48; |HACIENDO XPara = XPara + 1;
        Variable = Handle + " " + Campos;
        |FGRABA Variable;
        ICampos  = ICampos + 1;
  |SIGUE;
  |FCIERRA Handle;
|FPRC;

|PROGRAMA;
  |NOME_DAT #99  VTemporal0;
  |NOME_DAT #617 VTemporal17;

  |SI VSwCarga = 0;  |O VSwCarga = 1;
      |ABRE #617;  |CIERRA #617;  |DELINDEX #617;
      |ABRE #617;
      |HAZ CargaHoja17;
      |CIERRA #617;
  |FINSI;

  |SI VSwCarga ] 100;
      |ABRE #617;
      #617#0 = 0;
      |LEE 040#617=;
      |SI FSalida = 0;
          |HAZ GrabaH17M100;
      |FINSI;
      |CIERRA #617;
  |FINSI;
|FPRO;
