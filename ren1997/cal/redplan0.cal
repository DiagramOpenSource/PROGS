|FICHEROS;
    redplan0 #00;
    redplan1 #01;
    redplan2 #02;
    redplan3 #03;
    redplan4 #04;
    redatcon #15;   || contribuyentes
    repartid #16;   || rentas partidas
    repoblac #17;   || provinciero
    reauxpai #18;   || auxiliar paises
    rerendtr #19;   || rendimientos del trabajo
    recapinm #20;   || capital inmobiliario
    revalore #21;   || valores en bolsa
    revalono #22;   || valores no bolsa
    rectacor #23;   || ctas. ctes.
    retransp #24;   || transpariencia fiscal
    reeplan0 #30;   || reverso emision
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    dia = 0;
    mes = 0;
    cuantas = 0;
    prov_fisca = "";
    prov_envio = "";
    total = 0;
    FEstado = 0;
|FIN;

|INCLUYE i_consul;

****************************************************************************
    CARGA DE CAPITAL MOBILIARIO
****************************************************************************

|| ----------------------------------- transparencia fiscal

|PROCESO lee_transp1;
    cuantas = cuantas + 1;
|SI cuantas [ 5;

          || primer apartado
        nume1 = cuantas +  79;   #3nume1 = #24#3;      || perceptor
        nume1 = cuantas +  84;   #3nume1 = #24#23;     || periodo
        nume1 = cuantas +  89;   #3nume1 = #24#4;      || declaracion
        nume1 = cuantas +  94;   #3nume1 = #24#5;      || titularidad
        nume1 = cuantas +  99;   #3nume1 = #24#6;      || a¤os usufructuario
        nume1 = cuantas + 104;   #3nume1 = #24#7;      || <T>
        nume1 = cuantas + 109;   #3nume1 = #24#8;      || <C>
        nume1 = cuantas + 114;   #3nume1 = #24#9;      || <1>
        nume1 = cuantas + 119;   #3nume1 = #24#10;     || <2>
        nume1 = cuantas + 124;   #3nume1 = #24#11;     || <3>
        nume1 = cuantas + 129;   #3nume1 = #24#12;     || <4>
        nume1 = cuantas + 134;   #3nume1 = "";         || codigo
        nume1 = cuantas + 139;   #3nume1 = #24#13;     || descripcion
        nume1 = cuantas + 144;   #3nume1 = 0;          || unidades
        nume1 = cuantas + 149;   #3nume1 = 0;          || precio coste
        nume1 = cuantas + 154;   #3nume1 = "";         || fecha compra
        nume1 = cuantas + 159;   #3nume1 = 0;          || cot.ult.tr.
        nume1 = cuantas + 164;   #3nume1 = 0;          || dividendos
        nume1 = cuantas + 169;   #3nume1 = 0;          || retencion
        nume1 = cuantas + 174;   #3nume1 = 0;          || gtos. custodia
        nume1 = cuantas + 179;   #3nume1 = 0;          || otros gtos.

          || segundo apartado
        nume1 = cuantas -   1;   #4nume1 = "  ";       || tipo rendimiento
        nume1 = cuantas +   4;   #4nume1 = 0;          || valor patrimonial
        nume1 = cuantas +   9;   #4nume1 = 0;          || a¤os
        nume1 = cuantas +  14;   #4nume1 = " ";        || reducc./increm.
        nume1 = cuantas +  19;   #4nume1 = 0;          || valor capitalizado
        nume1 = cuantas +  24;   #4nume1 = 0;          || valor nominal
        nume1 = cuantas +  29;   #4nume1 = " ";        || auditada
        nume1 = cuantas +  34;   #4nume1 = " ";        || fondo/otros
        nume1 = cuantas +  39;   #4nume1 = "";         || fecha venta
        nume1 = cuantas +  44;   #4nume1 = 0;          || numero
        nume1 = cuantas +  49;   #4nume1 = 0;          || precio compra
        nume1 = cuantas +  54;   #4nume1 = 0;          || precio venta

          || tercer apartado
        nume1 = cuantas +  59;   #4nume1 = #24#16;     || b.imponible
        nume1 = cuantas +  64;   #4nume1 = #24#17;     || ded.interso
        nume1 = cuantas +  69;   #4nume1 = #24#18;     || imp.inter.
        nume1 = cuantas +  74;   #4nume1 = #24#19;     || renta bonif.
        nume1 = cuantas +  79;   #4nume1 = #24#20;     || inversiones
        nume1 = cuantas +  84;   #4nume1 = #24#21;     || retenciones
|FINSI;
|FPRC;

|DEFBUCLE lee_trans;
 #24#1;
 ;
 #15#0,  1;
 #15#0, 99;
 e;
 NULL, lee_transp1;
|FIN;

|| ----------------------------------- cuentas corrientes

|PROCESO lee_ctaco1;
    cuantas = cuantas + 1;
|SI cuantas [ 5;

          || primer apartado
        nume1 = cuantas +  79;   #3nume1 = #23#3;      || perceptor
        nume1 = cuantas +  84;   #3nume1 = #23#25;     || periodo
        nume1 = cuantas +  89;   #3nume1 = #23#4;      || declaracion
        nume1 = cuantas +  94;   #3nume1 = #23#5;      || titularidad
        nume1 = cuantas +  99;   #3nume1 = #23#6;      || a¤os usufructuario
        nume1 = cuantas + 104;   #3nume1 = #23#7;      || <T>
        nume1 = cuantas + 109;   #3nume1 = #23#8;      || <C>
        nume1 = cuantas + 114;   #3nume1 = #23#9;      || <1>
        nume1 = cuantas + 119;   #3nume1 = #23#10;     || <2>
        nume1 = cuantas + 124;   #3nume1 = #23#11;     || <3>
        nume1 = cuantas + 129;   #3nume1 = #23#12;     || <4>
        nume1 = cuantas + 134;   #3nume1 = #23#24;     || codigo
        nume1 = cuantas + 139;   #3nume1 = #23#14;     || descripcion
        nume1 = cuantas + 144;   #3nume1 = 0;          || unidades
        nume1 = cuantas + 149;   #3nume1 = 0;          || precio coste
        nume1 = cuantas + 154;   #3nume1 = "";         || fecha compra
        nume1 = cuantas + 159;   #3nume1 = 0;          || cot.ult.tr.
        nume1 = cuantas + 164;   #3nume1 = #23#17;     || dividendos
        nume1 = cuantas + 169;   #3nume1 = #23#18;     || retencion
        nume1 = cuantas + 174;   #3nume1 = #23#21;     || gtos. custodia
        nume1 = cuantas + 179;   #3nume1 = #23#22;     || otros gtos.

          || segundo apartado
        nume1 = cuantas -   1;   #4nume1 = #23#13;     || tipo rendimiento
        nume1 = cuantas +   4;   #4nume1 = #23#16;     || valor patrimonial
        nume1 = cuantas +   9;   #4nume1 = #23#27;     || a¤os
        nume1 = cuantas +  14;   #4nume1 = #23#26;     || reducc./increm.
        nume1 = cuantas +  19;   #4nume1 = 0;          || valor capitalizado
        nume1 = cuantas +  24;   #4nume1 = 0;          || valor nominal
        nume1 = cuantas +  29;   #4nume1 = " ";        || auditada
        nume1 = cuantas +  34;   #4nume1 = " ";        || fondo/otros
        nume1 = cuantas +  39;   #4nume1 = "";         || fecha venta
        nume1 = cuantas +  44;   #4nume1 = 0;          || numero
        nume1 = cuantas +  49;   #4nume1 = 0;          || precio compra
        nume1 = cuantas +  54;   #4nume1 = 0;          || precio venta

          || tercer apartado
        nume1 = cuantas +  59;   #4nume1 = 0;          || b.imponible
        nume1 = cuantas +  64;   #4nume1 = 0;          || ded.interso
        nume1 = cuantas +  69;   #4nume1 = 0;          || imp.inter.
        nume1 = cuantas +  74;   #4nume1 = 0;          || renta bonif.
        nume1 = cuantas +  79;   #4nume1 = 0;          || inversiones
        nume1 = cuantas +  84;   #4nume1 = 0;          || retenciones
|FINSI;
|FPRC;

|DEFBUCLE lee_ctaco;
 #23#1;
 ;
 #15#0,  1;
 #15#0, 99;
 e;
 NULL, lee_ctaco1;
|FIN;

|| ----------------------------------- valores no bolsa

|PROCESO valno1;
    cuantas = cuantas + 1;
|SI cuantas [ 5;
          || primer apartado
        nume1 = cuantas +  79;   #3nume1 = #22#3;      || perceptor
        nume1 = cuantas +  84;   #3nume1 = #22#34;     || periodo
        nume1 = cuantas +  89;   #3nume1 = #22#4;      || declaracion
        nume1 = cuantas +  94;   #3nume1 = #22#5;      || titularidad
        nume1 = cuantas +  99;   #3nume1 = #22#6;      || a¤os usufructuario
        nume1 = cuantas + 104;   #3nume1 = #22#7;      || <T>
        nume1 = cuantas + 109;   #3nume1 = #22#8;      || <C>
        nume1 = cuantas + 114;   #3nume1 = #22#9;      || <1>
        nume1 = cuantas + 119;   #3nume1 = #22#10;     || <2>
        nume1 = cuantas + 124;   #3nume1 = #22#11;     || <3>
        nume1 = cuantas + 129;   #3nume1 = #22#12;     || <4>
        nume1 = cuantas + 134;   #3nume1 = #22#13;     || codigo
        nume1 = cuantas + 139;   #3nume1 = #22#14;     || descripcion
        nume1 = cuantas + 144;   #3nume1 = #22#16;     || unidades
        nume1 = cuantas + 149;   #3nume1 = #22#17;     || precio coste
        nume1 = cuantas + 154;   #3nume1 = #22#18;     || fecha compra
        nume1 = cuantas + 159;   #3nume1 = 0;          || cot.ult.tr.
        nume1 = cuantas + 164;   #3nume1 = #22#19;     || dividendos
        nume1 = cuantas + 169;   #3nume1 = #22#20;     || retencion
        nume1 = cuantas + 174;   #3nume1 = #22#21;     || gtos. custodia
        nume1 = cuantas + 179;   #3nume1 = #22#22;     || otros gtos.
          || segundo apartado
        nume1 = cuantas -   1;   #4nume1 = "  ";       || tipo rendimiento
        nume1 = cuantas +   4;   #4nume1 = #22#43;     || valor patrimonial
        nume1 = cuantas +   9;   #4nume1 = 0;          || a¤os
        nume1 = cuantas +  14;   #4nume1 = " ";        || reducc./increm.
        nume1 = cuantas +  19;   #4nume1 = #22#31;     || valor capitalizado
        nume1 = cuantas +  24;   #4nume1 = #22#46;     || valor nominal
        nume1 = cuantas +  29;   #4nume1 = #22#30;     || auditada
        nume1 = cuantas +  34;   #4nume1 = #22#29;     || fondo/otros
        alfa1 = "";
        nume2 = 0;
        nume3 = 0;
        nume4 = 0;
        total = #22#27 + #22#28;
    |SI total!#22#27;|Y total!#22#28;                  || (si hay varias)
            alfa1 = "- VARIOS -";
        |SI #22#29 = "O";
                nume2 = #22#25 + #22#26;
                nume3 = ( (#22#25*#22#27) + (#22#26*#22#28) );
                nume3 = nume3 / nume2;
                nume4 = 0;
        |FINSI;
        |SI #22#29 = "F";
                nume2 = 0;
                nume3 = #22#27 + #22#28;
                nume4 = #22#35 + #22#36;
        |FINSI;
    |SINO;
        |SI #22#29 = "O";
                nume4 = 0;
            |SI #22#25!0; nume2=#22#25; nume3=#22#27; alfa1=#22#23; |FINSI;
            |SI #22#26!0; nume2=#22#26; nume3=#22#28; alfa1=#22#24; |FINSI;
        |FINSI;
        |SI #22#29 = "F";
                nume2 = 0;
            |SI #22#27!0; nume3=#22#27; nume4=#22#35; alfa1=#22#23; |FINSI;
            |SI #22#28!0; nume3=#22#28; nume4=#22#36; alfa1=#22#24; |FINSI;
        |FINSI;
    |FINSI;
        nume1 = cuantas +  39;   #4nume1 = alfa1;      || fecha venta
        nume1 = cuantas +  44;   #4nume1 = nume2;      || numero
        nume1 = cuantas +  49;   #4nume1 = nume4;      || precio compra
        nume1 = cuantas +  54;   #4nume1 = nume3;      || precio venta
          || tercer apartado
        nume1 = cuantas +  59;   #4nume1 = 0;          || b.imponible
        nume1 = cuantas +  64;   #4nume1 = 0;          || ded.interso
        nume1 = cuantas +  69;   #4nume1 = 0;          || imp.inter.
        nume1 = cuantas +  74;   #4nume1 = 0;          || renta bonif.
        nume1 = cuantas +  79;   #4nume1 = 0;          || inversiones
        nume1 = cuantas +  84;   #4nume1 = 0;          || retenciones
|FINSI;
|FPRC;

|DEFBUCLE lee_valno;
 #22#1;
 ;
 #15#0,  1;
 #15#0, 99;
 e;
 NULL, valno1;
|FIN;

|| ----------------------------------- valores en bolsa

|PROCESO valsi0;
    cuantas = 0;
|FPRC;

|PROCESO valsi1;
    cuantas = cuantas + 1;
|SI cuantas [ 5;

          || primer apartado
        nume1 = cuantas +  79;   #3nume1 = #21#3;      || perceptor
        nume1 = cuantas +  84;   #3nume1 = #21#34;     || periodo
        nume1 = cuantas +  89;   #3nume1 = #21#4;      || declaracion
        nume1 = cuantas +  94;   #3nume1 = #21#5;      || titularidad
        nume1 = cuantas +  99;   #3nume1 = #21#6;      || a¤os usufructuario
        nume1 = cuantas + 104;   #3nume1 = #21#7;      || <T>
        nume1 = cuantas + 109;   #3nume1 = #21#8;      || <C>
        nume1 = cuantas + 114;   #3nume1 = #21#9;      || <1>
        nume1 = cuantas + 119;   #3nume1 = #21#10;     || <2>
        nume1 = cuantas + 124;   #3nume1 = #21#11;     || <3>
        nume1 = cuantas + 129;   #3nume1 = #21#12;     || <4>
        nume1 = cuantas + 134;   #3nume1 = #21#13;     || codigo
        nume1 = cuantas + 139;   #3nume1 = #21#14;     || descripcion
        nume1 = cuantas + 144;   #3nume1 = #21#16;     || unidades
        nume1 = cuantas + 149;   #3nume1 = #21#17;     || precio coste
        nume1 = cuantas + 154;   #3nume1 = #21#18;     || fecha compra
        nume1 = cuantas + 159;   #3nume1 = #21#19;     || cot.ult.tr.
        nume1 = cuantas + 164;   #3nume1 = #21#20;     || dividendos
        nume1 = cuantas + 169;   #3nume1 = #21#21;     || retencion
        nume1 = cuantas + 174;   #3nume1 = #21#22;     || gtos. custodia
        nume1 = cuantas + 179;   #3nume1 = #21#23;     || otros gtos.

          || segundo apartado
        nume1 = cuantas -   1;   #4nume1 = "  ";       || tipo rendimiento
        nume1 = cuantas +   4;   #4nume1 = #21#41;     || valor patrimonial
        nume1 = cuantas +   9;   #4nume1 = 0;          || a¤os
        nume1 = cuantas +  14;   #4nume1 = " ";        || reducc./increm.
        nume1 = cuantas +  19;   #4nume1 = 0;          || valor capitalizado
        nume1 = cuantas +  24;   #4nume1 = 0;          || valor nominal
        nume1 = cuantas +  29;   #4nume1 = " ";        || auditada
        nume1 = cuantas +  34;   #4nume1 = " ";        || fondo/otros
        alfa1 = "";
        nume2 = 0;
        nume3 = 0;
        total = #21#27 + #21#28 + #21#29;
    |SI total!#21#27;|Y total!#21#28;|Y total!#21#29;  || (si hay varias)
            nume2 = #21#27 + #21#28 + #21#29;
            nume3 = ( (#21#30*#21#27) + (#21#31*#21#28) + (#21#32*#21#29) );
            nume3 = nume3 / nume2;
            alfa1 = "- VARIOS -";
    |SINO;
        |SI #21#27!0;  nume2=#21#27; nume3=#21#30; alfa1=#21#24; |FINSI;
        |SI #21#28!0;  nume2=#21#28; nume3=#21#31; alfa1=#21#25; |FINSI;
        |SI #21#29!0;  nume2=#21#29; nume3=#21#32; alfa1=#21#26; |FINSI;
    |FINSI;
        nume1 = cuantas +  39;   #4nume1 = alfa1;      || fecha venta
        nume1 = cuantas +  44;   #4nume1 = nume2;      || numero
        nume1 = cuantas +  49;   #4nume1 = 0;          || precio compra
        nume1 = cuantas +  54;   #4nume1 = nume3;      || precio venta

          || tercer apartado
        nume1 = cuantas +  59;   #4nume1 = 0;          || b.imponible
        nume1 = cuantas +  64;   #4nume1 = 0;          || ded.interso
        nume1 = cuantas +  69;   #4nume1 = 0;          || imp.inter.
        nume1 = cuantas +  74;   #4nume1 = 0;          || renta bonif.
        nume1 = cuantas +  79;   #4nume1 = 0;          || inversiones
        nume1 = cuantas +  84;   #4nume1 = 0;          || retenciones
|FINSI;
|FPRC;

|DEFBUCLE lee_valsi;
 #21#1;
 ;
 #15#0,  1;
 #15#0, 99;
 e;
 valsi0, valsi1;
|FIN;

|PROCESO carga_4;
|BUCLE lee_valsi;
|BUCLE lee_valno;
|BUCLE lee_ctaco;
|BUCLE lee_trans;
|FPRC;

****************************************************************************
    CARGA DE CAPITAL INMOBILIARIO
****************************************************************************

|PROCESO inmobi0;
    cuantas = 0;
|FPRC;

|PROCESO inmobi1;
    cuantas = cuantas + 1;
|SI cuantas [ 4;
        nume1 = cuantas +  53;   #2nume1 = #20#2;      || perceptor
        nume1 = cuantas +  57;   #2nume1 = #20#59;     || periodo
        nume1 = cuantas +  61;   #2nume1 = #20#48;     || declaracion
        nume1 = cuantas +  65;   #2nume1 = #20#15;     || titularidad
        nume1 = cuantas +  69;   #2nume1 = #20#16;     || a¤os usufructuario
        nume1 = cuantas +  73;   #2nume1 = #20#49;     || <T>
        nume1 = cuantas +  77;   #2nume1 = #20#50;     || <C>
        nume1 = cuantas +  81;   #2nume1 = #20#51;     || <1>
        nume1 = cuantas +  85;   #2nume1 = #20#52;     || <2>
        nume1 = cuantas +  89;   #2nume1 = #20#53;     || <3>
        nume1 = cuantas +  93;   #2nume1 = #20#54;     || <4>
        nume1 = cuantas +  97;   #2nume1 = #20#5;      || situacion
        nume1 = cuantas + 101;   #2nume1 = #20#12;     || secano
        nume1 = cuantas + 105;   #2nume1 = #20#11;     || regadio
        nume1 = cuantas + 109;   #2nume1 = #20#4;      || rustica/urbana
        nume1 = cuantas + 113;   #2nume1 = #20#13;     || destino
        nume1 = cuantas + 117;   #2nume1 = #20#8;      || valor catastral
        nume1 = cuantas + 121;   #2nume1 = #20#9;      || IBI
        nume1 = cuantas + 125;   #2nume1 = #20#10;     || intereses
        nume1 = cuantas + 129;   #2nume1 = #20#14;     || inversiones
        nume1 = cuantas + 133;   #2nume1 = #20#17;     || precio compra
        nume1 = cuantas + 137;   #2nume1 = #20#18;     || fecha compra
        nume1 = cuantas + 141;   #2nume1 = #20#19;     || valor comprobado
        nume1 = cuantas + 145;   #2nume1 = #20#20;     || gastos adquisicion
        nume1 = cuantas + 149;   #2nume1 = #20#33;     || valor terreno
        nume1 = cuantas + 153;   #2nume1 = #20#32;     || (%) amortizacion
        nume1 = cuantas -   1;   #3nume1 = #20#21;     || alquiler
        nume1 = cuantas +   3;   #3nume1 = #20#22;     || familiares
        nume1 = cuantas +   7;   #3nume1 = #20#23;     || imp. alquiler
        nume1 = cuantas +  11;   #3nume1 = #20#24;     || aprovech.
        nume1 = cuantas +  15;   #3nume1 = #20#25;     || otros ingresos
        nume1 = cuantas +  19;   #3nume1 = #20#26;     || otros tributos
        nume1 = cuantas +  23;   #3nume1 = #20#28;     || primas seguros
        nume1 = cuantas +  27;   #3nume1 = #20#29;     || conservacion
        nume1 = cuantas +  31;   #3nume1 = #20#30;     || amortizacion
        nume1 = cuantas +  35;   #3nume1 = #20#27;     || otros gastos
        nume1 = cuantas +  39;   #3nume1 = #20#31;     || venta
        nume1 = cuantas +  43;   #3nume1 = #20#34;     || fecha venta
        nume1 = cuantas +  47;   #3nume1 = #20#35;     || valor venta
        nume1 = cuantas +  51;   #3nume1 = #20#36;     || gastos venta
        nume1 = cuantas +  55;   #3nume1 = #20#37;     || reinversion
        nume1 = cuantas +  59;   #3nume1 = #20#55;     || a plazos
        nume1 = cuantas +  63;   #3nume1 = #20#56;     || cobrado
        total = #20#41 + #20#42 + #20#43;
        alfa1 = #20#38;
        alfa2 = #20#44;
    |SI total!#20#41;|Y total!#20#42;|Y total!#20#43;  || (si hay varias)
            alfa1 = "--VARIOS--";
            alfa2 = "";
    |FINSI;
        nume1 = cuantas +  67;   #3nume1 = alfa1;      || fecha mejora
        nume1 = cuantas +  71;   #3nume1 = total;      || importe mejora
        nume1 = cuantas +  75;   #3nume1 = alfa2;      || descripcion mejora
|SINO;
        #2#057 = "";          || perceptor
        #2#061 = "";          || periodo
        #2#065 = "";          || declaracion
        #2#069 = "";          || titularidad
        #2#073 = "";          || a¤os usufructuario
        #2#077 = 0;           || <T>
        #2#081 = 0;           || <C>
        #2#085 = 0;           || <1>
        #2#089 = 0;           || <2>
        #2#093 = 0;           || <3>
        #2#097 = 0;           || <4>
        #2#101 = "--- VARIOS ---";;      || situacion
        #2#105 = #2#105 + #20#12;     || secano
        #2#109 = #2#109 + #20#11;     || regadio
        #2#113 = "";     || rustica/urbana
        #2#117 = "";     || destino
        #2#121 = #2#121 + #20#8;      || valor catastral
        #2#125 = #2#125 + #20#9;      || IBI
        #2#129 = #2#129 + #20#10;     || intereses
        #2#133 = #2#133 + #20#14;     || inversiones
        #2#137 = #2#137 + #20#17;     || precio compra
        #2#141 = #20#18; || fecha compra
        #2#145 = #2#145 + #20#19;     || valor comprobado
        #2#149 = #2#149 + #20#20;     || gastos adquisicion
        #2#153 = #2#153 + #20#33;     || valor terreno
        #2#157 = #20#32;              || (%) amortizacion
        #3#003 = "";     || alquiler
        #3#007 = "";     || familiares
        #3#011 = #3#011 + #20#23;     || imp. alquiler
        #3#015 = #3#015 + #20#24;     || aprovech.
        #3#019 = #3#019 + #20#25;     || otros ingresos
        #3#023 = #3#023 + #20#26;     || otros tributos
        #3#027 = #3#027 + #20#28;     || primas seguros
        #3#031 = #3#031 + #20#29;     || conservacion
        #3#035 = #3#035 + #20#30;     || amortizacion
        #3#039 = #3#039 + #20#27;     || otros gastos
        #3#043 = "";                  || venta
        #3#047 = "";                  || fecha venta
        #3#051 = #3#051 + #20#35;     || valor venta
        #3#055 = #3#055 + #20#36;     || gastos venta
        #3#059 = #3#059 + #20#37;     || reinversion
        #3#063 = "";                  || a plazos
        #3#067 = #3#067 + #20#56;     || cobrado
        total = #20#41 + #20#42 + #20#43;
        #3#071 = "";         || fecha mejora
        #3#075 = #3#075 + total;      || importe mejora
        #3#079 = "";         || descripcion mejora
|FINSI;
|FPRC;

|DEFBUCLE lee_inmobi;
 #20#1;
 ;
 #15#0,  1;
 #15#0, 99;
 e;
 inmobi0, inmobi1;
|FIN;

|PROCESO carga_3;
|BUCLE lee_inmobi;
|FPRC;

****************************************************************************
    CARGA DE RENDIMIENTOS DEL TRABAJO
****************************************************************************

|PROCESO rendi0;
    cuantas = 0;
|FPRC;

|PROCESO rendi1;
    cuantas = cuantas + 1;
|SI cuantas [ 3;
        nume1 = cuantas -  1;   #2nume1 = #19#2;   || 'U'
        nume1 = cuantas +  2;   #2nume1 = #19#29;  || 'P'
        nume1 = cuantas +  5;   #2nume1 = #19#28;  || 'A'
        nume1 = cuantas +  8;   #2nume1 = #19#4;   || entidad
        nume1 = cuantas + 11;   #2nume1 = #19#7;   || rend. integros
        nume1 = cuantas + 14;   #2nume1 = #19#9;   || imp. retenciones
        nume1 = cuantas + 17;   #2nume1 = #19#17;  || s.s.
        nume1 = cuantas + 20;   #2nume1 = #19#18;  || colegio huerfanos
        nume1 = cuantas + 23;   #2nume1 = #19#19;  || sindicatos
        nume1 = cuantas + 26;   #2nume1 = #19#10;  || entidad p.p.
        nume1 = cuantas + 29;   #2nume1 = #19#11;  || aportacion empleado
        nume1 = cuantas + 32;   #2nume1 = #19#12;  || aportacion empresa
        nume1 = cuantas + 35;   #2nume1 = #19#13;  || mutalidad
        nume1 = cuantas + 38;   #2nume1 = #19#21;  || dchos. const.
        nume1 = cuantas + 41;   #2nume1 = #19#22;  || ingr. integros
        nume1 = cuantas + 44;   #2nume1 = #19#23;  || retenciones
        nume1 = cuantas + 47;   #2nume1 = #19#24;  || gtos. deducibles
        nume1 = cuantas + 50;   #2nume1 = #19#25;  || nro. a¤os
|SINO;
        #2#02 = "";      || 'U'
        #2#05 = "";      || 'P'
        #2#08 = "";      || 'A'
        #2#11 = "--- VARIOS ---";  || entidad
        #2#14 = #2#14+#19#7;   || rend. integros
        #2#17 = #2#17+#19#9;   || imp. retenciones
        #2#20 = #2#20+#19#17;  || s.s.
        #2#23 = #2#23+#19#18;  || colegio huerfanos
        #2#26 = #2#26+#19#19;  || sindicatos
        #2#29 = #2#29+#19#10;  || entidad p.p.
        #2#32 = #2#32+#19#11;  || aportacion empleado
        #2#35 = #2#35+#19#12;  || aportacion empresa
        #2#38 = #2#38+#19#13;  || mutalidad
        #2#41 = #2#41+#19#21;  || dchos. const.
        #2#44 = #2#44+#19#22;  || ingr. integros
        #2#47 = #2#47+#19#23;  || retenciones
        #2#50 = #2#50+#19#24;  || gtos. deducibles
        #2#53 = #2#53+#19#25;  || nro. a¤os
|FINSI;
|FPRC;

|DEFBUCLE lee_rendi;
 #19#1;
 ;
 #15#0,  1;
 #15#0, 99;
 e;
 rendi0, rendi1;
|FIN;

|PROCESO carga_2;
|BUCLE lee_rendi;
|FPRC;

****************************************************************************
    CARGA DE DATOS CONTRIBUYENTE
****************************************************************************

|PROCESO carga_1;        || datos contribuyente
    #1#00 = #15#0;  || codigo
    #1#01 = "";     || 'sit' ¨...?

    #1#02 = #15#1;  || apell. titular
    #1#03 = #15#28; || apell. conyuge
     nume1 = #15#098 + 57;   #1#04 = #15nume1; || apell. otros 1
     nume1 = #15#099 + 57;   #1#05 = #15nume1; || apell. otros 2
     nume1 = #15#100 + 57;   #1#06 = #15nume1; || apell. otros 3
     nume1 = #15#101 + 57;   #1#07 = #15nume1; || apell. otros 4

    #1#08 = #15#2;  || dni titular
    #1#09 = #15#29; || dni conyuge
     nume1 = #15#098 + 47;   #1#10 = #15nume1; || dni otros 1
     nume1 = #15#099 + 47;   #1#11 = #15nume1; || dni otros 2
     nume1 = #15#100 + 47;   #1#12 = #15nume1; || dni otros 3
     nume1 = #15#101 + 47;   #1#13 = #15nume1; || dni otros 4

    #1#14 = #15#3;  || a¤o titular
    #1#15 = #15#30; || a¤o conyuge
     nume1 = #15#098 + 67;  #1#16 = #15nume1; || a¤o otros 1
     nume1 = #15#099 + 67;  #1#17 = #15nume1; || a¤o otros 2
     nume1 = #15#100 + 67;  #1#18 = #15nume1; || a¤o otros 3
     nume1 = #15#101 + 67;  #1#19 = #15nume1; || a¤o otros 4

|PARA nume1 = 20; |SI nume1 [ 25; |HACIENDO nume1 = nume1 + 1;
        nume2 = nume1;       nume3 = nume2 + 84;
        #1nume2 = #15nume3;                            || <1>
        nume2 = nume1 +  6;  nume3 = nume2 + 85;
        #1nume2 = #15nume3;                            || <2>
        nume2 = nume1 + 12;  nume3 = nume2 + 86;
        #1nume2 = #15nume3;                            || <3>
        nume2 = nume1 + 18;  nume3 = nume2 + 94;
        #1nume2 = #15nume3;                            || <6>
        nume2 = nume1 + 24;  nume3 = nume2 + 81;
        #1nume2 = #15nume3;                            || <5>
|SIGUE;
    #1#38 = #15#140;          || <4> titular
    #1#39 = #15#141;          || <4> conyuge
    #1#56 = #15#138;          || <7> titular
    #1#57 = #15#139;          || <7> conyuge

    #1#62 = #15#5;            || minusvalido titular
    #1#63 = #15#31;           || minusvalido conyuge
     nume1 = #15#098 + 87;  #1#64 = #15nume1;         || minusvalido otros 1
     nume1 = #15#099 + 87;  #1#65 = #15nume1;         || minusvalido otros 2
     nume1 = #15#100 + 87;  #1#66 = #15nume1;         || minusvalido otros 3
     nume1 = #15#101 + 87;  #1#67 = #15nume1;         || minusvalido otros 4
     nume1 = #15#098 + 163;  #1#68 = #15nume1;         || clave familiar 1
     nume1 = #15#099 + 163;  #1#69 = #15nume1;         || clave familiar 2
     nume1 = #15#100 + 163;  #1#70 = #15nume1;         || clave familiar 3
     nume1 = #15#101 + 163;  #1#71 = #15nume1;         || clave familiar 4

     nume1 = #15#098 + 77;  #1#72 = #15nume1;         || parentesco 1
     nume1 = #15#099 + 77;  #1#73 = #15nume1;         || parentesco 2
     nume1 = #15#100 + 77;  #1#74 = #15nume1;         || parentesco 3
     nume1 = #15#101 + 77;  #1#75 = #15nume1;         || parentesco 4

    #1#76 = dia;         || dia matrimonio/fallecimiento
    #1#77 = mes;         || mes matrimonio/fallecimiento
    #1#78 = #16#3;       || clave matrimonio/fallecimiento
    #1#79 = #15#175;     || cta.cte. titular
    #1#80 = #15#176;     || cta.cte. conyuge
    #1#81 = #15#177;     || cta.cte. otros 1
    #1#82 = #15#178;     || cta.cte. otros 2
    #1#83 = #15#179;     || cta.cte. otros 3
    #1#84 = #15#180;     || cta.cte. otros 4
    #1#85 = #15#6;       || cl fiscal
    #1#86 = #15#17;      || cl envio
    #1#87 = #15#7;       || calle fiscal
    #1#88 = #15#18;      || calle envio
    #1#89 = #15#8;       || numero fiscal
    #1#90 = #15#19;      || numero envio
    #1#91 = #15#9;       || escalera fiscal
    #1#92 = #15#20;      || escalera envio
    #1#93 = #15#10;      || piso fiscal
    #1#94 = #15#21;      || piso envio
    #1#95 = #15#11;      || puerta fiscal
    #1#96 = #15#22;      || puerta envio
    #1#97 = #15#14;      || poblacion fiscal
    #1#98 = #15#25;      || poblacion envio
    #1#99 = #15#16;      || codigo postal fiscal
    #1#100= #15#22;      || codigo postal envio
    #1#101= prov_fisca;  || provincia fiscal
    #1#102= prov_envio;  || provincia envio
    #1#103= #15#15;      || telefono fiscal
    #1#104= #15#26;      || telefono envio
        alfa1 = #15#40;  alfa1 =  "00" + alfa1;  alfa1 = alfa1 % -102;
        alfa2 = #15#41;  alfa2 = "000" + alfa2;  alfa2 = alfa2 % -103;
    #1#105= alfa1 + alfa2;    || codigo adminis. fiscal
    #1#106= alfa1 + alfa2;    || codigo adminis. envio
    #1#107= #15#43;           || adminis. fiscal
    #1#108= #15#43;           || adminis. envio
    #1#109= #18#01;           || pais
    #1#110= #15#192;          || f/j extranjeros
|FPRC;

****************************************************************************
    PROCESOS DE LECTURA
****************************************************************************

|PROCESO lee_partidas;
|ABRE #16;
    #16#0 = #15#0;
|LEE 001#16=;
|SI FSalida ! 0;
    |DDEFECTO #16;
        dia = 0;
        mes = 0;
|SINO;
    |SI #16#3 = 1;  alfa1=#16#6;  |SINO;  alfa1=#16#4;  |FINSI;
        alfa2 = alfa1 % 102;   dia = alfa2;
        alfa2 = alfa1 % 402;   mes = alfa2;
|FINSI;
|CIERRA #16;
|FPRC;

|PROCESO lee_provincia;
|ABRE #17;
    #17#0 = #15#12;
    #17#1 = #15#13;
|LEE 001#17=;
|SI FSalida ! 0;
    |DDEFECTO #17;
|FINSI;
    prov_fisca = #17#2;
    #17#0 = #15#23;
    #17#1 = #15#24;
|LEE 001#17=;
|SI FSalida ! 0;
    |DDEFECTO #17;
|FINSI;
    prov_envio = #17#2;
|CIERRA #17;
|FPRC;

|PROCESO lee_pais;
|ABRE #18;
    #18#0 = #15#193;
|LEE 001#18=;
|SI FSalida ! 0;
    |DDEFECTO #18;
|FINSI;
|CIERRA #18;
|FPRC;

|PROCESO cargando;
|DDEFECTO #1;
|DDEFECTO #2;
|DDEFECTO #3;
|DDEFECTO #4;
|HAZ lee_partidas;
|HAZ lee_provincia;
|HAZ lee_pais;
|HAZ carga_1;       || datos contribuyente
|HAZ carga_2;       || 'otros trab.'
|HAZ carga_3;       || capital inmobiliario
|HAZ carga_4;       || capital mobiliario
|INFOR "redplan0";
|PRINT;
|PIEINF;
|FININF;
|FPRC;

|DEFBUCLE lee_contri;
 #15#1;
 ;
 #0#0;
 #0#1;
 e;
 NULL, cargando;
|FIN;

|PROCESO emite; |TIPO 3;
|IMPRE 0;
|SI FSalida = 0;
    |BUCLE lee_contri;
    |HAZ gra_reverso;
|SINO;
    |MENAV "    ATENCION!!! Proceso abortado ...";
|FINSI;
|FINIMP;
|FPRC;

|PROCESO gra_reverso;
|ABRE #30;
|LEE 101#30p;
    FEstado = FSalida;
    #30#0 = #0#0;
    #30#1 = #0#1;
|SI FEstado ! 0;  |GRABA 020#30n;  |FINSI;
|SI FEstado = 0;  |GRABA 020#30a;  |FINSI;
|LIBERA #30;
|CIERRA #30;
|FPRC;
