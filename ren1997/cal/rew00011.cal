|FICHEROS;
     retotren #5;
     retotrea #6;
     rew00001 #99;
     rew00010 #601;
     rew00011 #602;
|FIN;

|VARIABLES;
      XCampos     = 0;
      NSecuencial = "";
      Field       = "";
      Suma        = 0;

     &VEmpresa   = 0;
     &VTipo      = "";
     &NCopia     = 0;
     &VSwCarga   = 0;
     &VTemporal0 = "";
     &VTemporal1 = "";
     &VTemporal2 = "";

{200}&NEmpresas  = "";
|FIN;

|INCLUYE i_utilid;

||

|PROCESO LeeFicheros;
  |ABRE #99;
  #99#0 = VEmpresa;
  #99#1 = VTipo;
  |LEE 040#99=;
  |SI FSalida ! 0; |DDEFECTO #99; |FINSI;
  |CIERRA #99;

  |ABRE #5;
  #5#0   = #99#0;
  #5#141 = #99#1;
  |LEE 040#5=;
  |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
  |CIERRA #5;

  |ABRE #6;
  #6#0 = #99#0;
  #6#1 = #99#1;
  |LEE 040#6=;
  |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
  |CIERRA #6;
|FPRC;

|PROCESO CargaHoja2;
  |HAZ LeeFicheros;

  #602#0 = 0;
  |LIBERA #602;
  |LEE 140#602=;
  |SI FSalida ! 0;
      |DDEFECTO #602;
      #602#0 = 0;
      |GRABA 140#602b;
  |FINSI;

  #602#42 = #99#7;
  #602#43 = #99#3;
  #602#4  = #5#43  + #5#156;
  #602#5  = #5#44  + #5#152 + #5#45  + #5#158;
  #602#6  = #5#39  + #5#6;
  #602#7  = #5#147 + #5#149;
  #602#8  = #5#148;
  #602#9  = #5#7;
  #602#10 = #5#8;
  #602#11 = #5#157;
  #602#12 = #5#160;
  #602#13 = #5#159;
  #602#14 = #602#11 + #602#12 + #602#13;
  #602#15 = #5#150;
  #602#16 = #5#151;
  #602#17 = #5#153;
  #602#18 = #5#154;
  #602#19 = #5#155;
  #602#20 = #602#15 + #602#16 + #602#17 + #602#18 + #602#19;
  #602#21 = #5#9;
  #602#22 = #6#3;
  #602#23 = #6#9;
  #602#24 = #6#2;
  #602#25 = #6#8;
  #602#26 = #6#4;
  #602#27 = #6#10;
  #602#28 = #6#5;
  #602#29 = #6#11;
  #602#30 = #6#6  + #6#7;
  #602#31 = #6#12 + #6#13;
  #602#32 = #5#132;
  #602#33 = #5#10;
  #602#34 = #5#11;
  #602#35 = #6#14;
  #602#36 = #6#15;
  #602#37 = #5#12;
  #602#38 = #602#33 + #602#34 - #602#37;
  #602#39 = #6#22;
  #602#40 = #5#13;

  |GRABA 140#602a;
|FPRC;

|PROCESO GrabaH02M100;
  |HAZ BorraCampos;

  ICampos = Campos1 <-;
  |PARA XCampos = 1;  |SI XCampos [ 40;  |HACIENDO XCampos = XCampos + 1;
        Campos = #602XCampos;
        ICampos = ICampos + 1;
  |SIGUE;

  ICampos = Campos1  <-;                                    Campos = "100";
  ICampos = Campos2  <-;                                    Campos = "02";
  ICampos = Campos3  <-;                                    Campos = " ";
  ICampos = Campos41 <-; Valfa = &13 + &10;                 Campos = Valfa;

  ICampos = Campos4 <-;
  |PARA XCampos = 4;  |SI XCampos [ 40;  |HACIENDO XCampos = XCampos + 1;
        CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
        ICampos = ICampos + 1;
  |SIGUE;

  INEmpresas = NEmpresas1 <-;
  INEmpresas = INEmpresas + NCopia;

  Pos = -1;
  NSecuencial = "r+b " + NEmpresas;
  |FABRE NSecuencial;
  |SI FSalida < 0;
      NSecuencial = "wb  " + NEmpresas;
      |FABRE NSecuencial;
  |FINSI;

  Handle = FSalida;
  |SI FSalida ] 0;
      |PARA; |SI; |HACIENDO;
           Field = Handle + " 255";
           |FLEE Field;
           |SI FSalida [ 0;  |SAL;  |FINSI;
      |SIGUE;
  |FINSI;

  ICampos = Campos1 <-;
  |PARA XPara = 1; |SI XPara [ 41; |HACIENDO XPara = XPara + 1;
        Variable = Handle + " " + Campos;
        |FGRABA Variable;
        ICampos  = ICampos + 1;
  |SIGUE;
  |FCIERRA Handle;
|FPRC;

|PROCESO GrabaH01M101;
  |HAZ BorraCampos;

  ICampos = Campos1 <-;
  |PARA XCampos = 1;  |SI XCampos [ 61;  |HACIENDO XCampos = XCampos + 1;
        Campos = #601XCampos;
        ICampos = ICampos + 1;
  |SIGUE;

  ICampos = Campos62 <-;  Campos = #602#4;
  ICampos = Campos63 <-;  Campos = #602#5;
  ICampos = Campos64 <-;  Campos = #602#6;
  ICampos = Campos65 <-;  Campos = #602#7;
  ICampos = Campos66 <-;  Campos = #602#8;
  ICampos = Campos67 <-;  Campos = #602#9;
  ICampos = Campos68 <-;  Campos = #602#10;

  ICampos = Campos1  <-;                                    Campos = "101";
  ICampos = Campos2  <-;                                    Campos = "01";
  ICampos = Campos3  <-;                                    Campos = " ";
  ICampos = Campos69 <-; Valfa = &13 + &10;                 Campos = Valfa;

  ICampos = Campos50 <-;
  |PARA XCampos = 50;  |SI XCampos [ 68;  |HACIENDO XCampos = XCampos + 1;
        CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
        ICampos = ICampos + 1;
  |SIGUE;

  INEmpresas = NEmpresas1 <-;
  INEmpresas = INEmpresas + NCopia;

  Pos = -1;
  NSecuencial = "r+b " + NEmpresas;
  |FABRE NSecuencial;
  |SI FSalida < 0;
      NSecuencial = "wb  " + NEmpresas;
      |FABRE NSecuencial;
  |FINSI;

  Handle = FSalida;
  |SI FSalida ] 0;
      |PARA; |SI; |HACIENDO;
           Field = Handle + " 255";
           |FLEE Field;
           |SI FSalida [ 0;  |SAL;  |FINSI;
      |SIGUE;
  |FINSI;

  ICampos = Campos1 <-;
  |PARA XPara = 1; |SI XPara [ 69; |HACIENDO XPara = XPara + 1;
        Variable = Handle + " " + Campos;
        |FGRABA Variable;
        ICampos  = ICampos + 1;
  |SIGUE;
  |FCIERRA Handle;
|FPRC;

|PROCESO GrabaH01M103;
  |HAZ BorraCampos;

  ICampos = Campos1 <-;
  |PARA XCampos = 1;  |SI XCampos [ 38;  |HACIENDO XCampos = XCampos + 1;
        Campos = #601XCampos;
        ICampos = ICampos + 1;
  |SIGUE;

  ICampos = Campos39 <-;  Campos = #601#40;
  ICampos = Campos40 <-;  Campos = #601#41;
  ICampos = Campos41 <-;  Campos = #601#42;
  ICampos = Campos42 <-;  Campos = #601#43;
  ICampos = Campos43 <-;  Campos = #601#44;
  ICampos = Campos44 <-;  Campos = #601#45;
  ICampos = Campos45 <-;  Campos = #601#46;
  ICampos = Campos46 <-;  Campos = #601#47;
  ICampos = Campos47 <-;  Campos = #601#50;
  ICampos = Campos48 <-;  Campos = #601#51;
  ICampos = Campos49 <-;  Campos = #601#52;
  ICampos = Campos50 <-;  Campos = #601#53;
  ICampos = Campos51 <-;  Campos = #601#54;
  ICampos = Campos52 <-;  Campos = #601#55;
  ICampos = Campos53 <-;  Campos = #601#56;
  ICampos = Campos54 <-;  Campos = #601#57;
  ICampos = Campos55 <-;  Campos = #601#58;
  ICampos = Campos56 <-;  Campos = #601#59;
  ICampos = Campos57 <-;  Campos = #601#60;
  ICampos = Campos58 <-;  Campos = #601#61;

  ICampos = Campos59 <-;  Campos = #602#4;
  ICampos = Campos60 <-;  Campos = #602#5;
  ICampos = Campos61 <-;  Campos = #602#6;
  ICampos = Campos62 <-;  Campos = #602#7;
  ICampos = Campos63 <-;  Campos = #602#8;
  ICampos = Campos64 <-;  Campos = #602#9;
  ICampos = Campos65 <-;  Campos = #602#10;
  ICampos = Campos66 <-;  Campos = #602#22;
  ICampos = Campos67 <-;  Campos = #602#23;
  ICampos = Campos68 <-;  Campos = #602#24;
  ICampos = Campos69 <-;  Campos = #602#25;
  ICampos = Campos70 <-;  Campos = #602#32;
  ICampos = Campos71 <-;  Campos = #602#33;
  ICampos = Campos72 <-;  Campos = #602#34;
  ICampos = Campos73 <-;  Campos = #602#37;
  ICampos = Campos74 <-;  Campos = #602#38;
  ICampos = Campos75 <-;  Campos = #602#39;
  ICampos = Campos76 <-;  Campos = #602#40;

  ICampos = Campos1  <-;                                    Campos = "103";
  ICampos = Campos2  <-;                                    Campos = "01";
  ICampos = Campos3  <-;                                    Campos = " ";
  ICampos = Campos77 <-; Valfa = &13 + &10;                 Campos = Valfa;

  ICampos = Campos47 <-;
  |PARA XCampos = 47;  |SI XCampos [ 76;  |HACIENDO XCampos = XCampos + 1;
        CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
        ICampos = ICampos + 1;
  |SIGUE;

  INEmpresas = NEmpresas1 <-;
  INEmpresas = INEmpresas + NCopia;

  Pos = -1;
  NSecuencial = "r+b " + NEmpresas;
  |FABRE NSecuencial;
  |SI FSalida < 0;
      NSecuencial = "wb  " + NEmpresas;
      |FABRE NSecuencial;
  |FINSI;

  Handle = FSalida;
  |SI FSalida ] 0;
      |PARA; |SI; |HACIENDO;
           Field = Handle + " 255";
           |FLEE Field;
           |SI FSalida [ 0;  |SAL;  |FINSI;
      |SIGUE;
  |FINSI;

  ICampos = Campos1 <-;
  |PARA XPara = 1; |SI XPara [ 77; |HACIENDO XPara = XPara + 1;
        Variable = Handle + " " + Campos;
        |FGRABA Variable;
        ICampos  = ICampos + 1;
  |SIGUE;
  |FCIERRA Handle;
|FPRC;

|PROGRAMA;
  |NOME_DAT #99  VTemporal0;
  |NOME_DAT #601 VTemporal1;
  |NOME_DAT #602 VTemporal2;

  |SI VSwCarga = 0; |O VSwCarga = 1;
      |ABRE #602;  |CIERRA #602;  |DELINDEX #602;
      |ABRE #602;
      |HAZ CargaHoja2;
      |CIERRA #602;
  |FINSI;

  |SI VSwCarga = 100;
      |ABRE #602;
      #602#0 = 0;
      |LEE 040#602=;
      |SI FSalida = 0;
          Suma = #602#6 + #602#9  + #602#10 + #602#14 + #602#20 + #602#21;
          Suma = Suma   + #602#32 + #602#33 + #602#34 + #602#37 + #602#38;
          Suma = Suma   + #602#39 + #602#40;
          |SI Suma ! 0;  |HAZ GrabaH02M100;  |FINSI;
      |FINSI;
      |CIERRA #602;
  |FINSI;

  |SI VSwCarga = 101;
      |ABRE #601;
      #601#0 = 0;
      |LEE 040#601=;
      |SI FSalida ! 0;
          |DDEFECTO #601;
      |FINSI;
      |CIERRA #601;

      |ABRE #602;
      #602#0 = 0;
      |LEE 040#602=;
      |SI FSalida ! 0;
          |DDEFECTO #602;
      |FINSI;
      |CIERRA #602;

      |HAZ GrabaH01M101;
  |FINSI;

  |SI VSwCarga = 103;
      |ABRE #601;
      #601#0 = 0;
      |LEE 040#601=;
      |SI FSalida ! 0;
          |DDEFECTO #601;
      |FINSI;
      |CIERRA #601;

      |ABRE #602;
      #602#0 = 0;
      |LEE 040#602=;
      |SI FSalida ! 0;
          |DDEFECTO #602;
      |FINSI;
      |CIERRA #602;

      |HAZ GrabaH01M103;
  |FINSI;
|FPRO;
