|FICHEROS;
     redatcon #1;
     rehacien #2;
     rerenpre #3;
     repoblac #4;
     retotren #5;
     recofisc #37;
     rerendtr #20;
     rew00001 #99;
     rew00010 #601;
|FIN;

|VARIABLES;
      Perce      = "";
      Casilla    = 0;
      Contador1  = 0;
      CamParie   = 0;
      EsNif      = 0;
      EsNombre   = 0;
      EsParent   = 0;
      EsNacimi   = 0;
      EsAnyo     = 0;
      EsDe        = 0;
      NombreFa    = "";
      NoFamili    = 0;
      XCampos     = 0;
      NSecuencial = "";
      Field       = "";
      Coefi       = 0;
      Fechad      = @;
      Fechah      = @;
      EsMinu      = 0;

     &VEmpresa   = 0;
     &VTipo      = "";
     &NCopia     = 0;
     &VSwCarga   = 0;
     &VTemporal0 = "";
     &VTemporal1 = "";
     &Tippar     = 0;
     &Parte1     = 0;
     &Parte2     = 0;
     &Muerto     = "";
     &Fecpar     = @;

{200}&NEmpresas  = "";
|FIN;

|INCLUYE i_sepnom;
|INCLUYE i_utilid;

|| ***********************************************
|| RENTAS NORMALES
|| ***********************************************

|PROCESO CargaA;
  |SI VSwCarga = 0;  #601#52 = #601#52 + #20#15;            |FINSI;
  |SI VSwCarga = 1;  #601#52 = #601#52 + (#20#15 % Coefi);  |FINSI;
|FPRC;

|PROCESO RendTrabN;
  |SI #20#28 = "X"; |ACABA; |FINSI;

  |SI #99#1 = "A"; Perce = #20#3; |SINO; Perce = "TITULAR"; |FINSI;

  |SI #99#1 = "A";     || Si es conjunta
      |HAZ CargaA;
      |ACABA;
  |FINSI;

  |SI #99#1 = "T";     || Si es Titular
      |SI #20#2 = "T"; |HAZ CargaA; |ACABA; |FINSI;
  |FINSI;

  |SI #99#1 = "C";     || Si es Conyuge
      |SI #20#2 = "C"; |HAZ CargaA; |ACABA; |FINSI;
  |FINSI;

  |SI #99#1 = "1";     || Si es 1§ Familiar
      |SI #20#2 = "1"; |HAZ CargaA; |ACABA; |FINSI;
  |FINSI;

  |SI #99#1 = "2";     || Si es 2§ Familiar
      |SI #20#2 = "2"; |HAZ CargaA; |ACABA; |FINSI;
  |FINSI;

  |SI #99#1 = "3";     || Si es 3§ Familiar
      |SI #20#2 = "3"; |HAZ CargaA; |ACABA; |FINSI;
  |FINSI;

  |SI #99#1 = "4";     || Si es 4§ Familiar
      |SI #20#2 = "4"; |HAZ CargaA; |ACABA; |FINSI;
  |FINSI;
|FPRC;

|PROCESO RendTrabP;
  |SI #20#28 = "X"; |ACABA; |FINSI;
  Coefi = 100;
  |SI #99#1 = "A"; Perce = #20#3; |SINO; Perce = "TITULAR"; |FINSI;

  |SI #99#1 = "A";     || Si es conjunta
      |SI Tippar = 1;  || Matrimonio
          |SI #20#29 = 1; |ACABA; |FINSI;
          |SI #20#29 = 0; Coefi = 100 * Parte2; |FINSI;
          |SI #20#29 = 2; Coefi = 100;          |FINSI;
      |FINSI;
      |SI Tippar = 3; || Separada
          |SI #20#29 = 2; |ACABA; |FINSI;
          |SI #20#29 = 0; Coefi = 100 * Parte1; |FINSI;
          |SI #20#29 = 1; Coefi = 100;          |FINSI;
      |FINSI;
      |SI Tippar = 2; || Muerto
          |SI #20#29 = 0;
              |SI #20#2 = "T"; |Y Muerto = "T";
                  Coefi = 100;
              |SINO;
                  |SI #20#2 = "C"; |Y Muerto = "C";
                      Coefi = 100;
                  |SINO;
                      Coefi = 100 * Parte1;
                  |FINSI;
              |FINSI;
           |SINO;
               |SI #20#29 = 1;
                   Coefi = 100;
               |SINO;
                   |ACABA;
               |FINSI;
           |FINSI;
      |FINSI;
      |HAZ CargaA;
      |ACABA;
  |FINSI;

  |SI #99#1 = "T";     || Si es Titular
      |SI Tippar = 1;  || Matrimonio
          |SI #20#29 = 0; Coefi = 100 * Parte1; |FINSI;
          |SI #20#29 = 1; Coefi = 100;          |FINSI;
          |SI #20#29 = 2; |ACABA;               |FINSI;
      |FINSI;
      |SI Tippar = 2;  || Muerto
          |SI #5#213 = 1;
              |SI #20#29 = 0; Coefi = 100 * Parte2; |FINSI;
              |SI #20#29 = 1; |ACABA;               |FINSI;
              |SI #20#29 = 2; Coefi = 100;          |FINSI;
          |FINSI;
          |SI #5#213 = 2; Coefi = 100; |FINSI;
      |FINSI;
      |SI Tippar = 3;  || Separacion
          |SI #20#29 = 0; Coefi = 100 * Parte2; |FINSI;
          |SI #20#29 = 2; Coefi = 100;          |FINSI;
          |SI #20#29 = 1; |ACABA;               |FINSI;
      |FINSI;
      |SI #20#2 = "T"; |HAZ CargaA; |ACABA; |FINSI;
  |FINSI;

  |SI #99#1 = "C";     || Si es Conyuge
      |SI Tippar = 1;  || Matrimonio
          |SI #20#29 = 0; Coefi = 100 * Parte1; |FINSI;
          |SI #20#29 = 1; Coefi = 100;          |FINSI;
          |SI #20#29 = 2; |ACABA;               |FINSI;
      |FINSI;
      |SI Tippar = 2;  || Muerto
          |SI #5#213 = 1;
              |SI #20#29 = 0; Coefi = 100 * Parte2; |FINSI;
              |SI #20#29 = 1; |ACABA;               |FINSI;
              |SI #20#29 = 2; Coefi = 100;          |FINSI;
          |FINSI;
          |SI #5#213 = 2; Coefi = 100; |FINSI;
      |FINSI;
      |SI Tippar = 3;  || Separacion
          |SI #20#29 = 0; Coefi = 100 * Parte2; |FINSI;
          |SI #20#29 = 2; Coefi = 100;          |FINSI;
          |SI #20#29 = 1; |ACABA;               |FINSI;
      |FINSI;
      |SI #20#2 = "C"; |HAZ CargaA; |ACABA; |FINSI;
  |FINSI;
|FPRC;

|PROCESO RendTrab;
  |SI VSwCarga = 0;  |HAZ RendTrabN;  |FINSI;
  |SI VSwCarga = 1;  |HAZ RendTrabP;  |FINSI;
|FPRC;

|DEFBUCLE rerendtr;
  #20#1;
  ;
  #99#0, 01;
  #99#0, 99;
  e;
  NULL, RendTrab;
|FIN;

|PROCESO LeeFicheros;
  |ABRE #99;
  #99#0 = VEmpresa;
  #99#1 = VTipo;
  |LEE 040#99=;
  |SI FSalida ! 0; |DDEFECTO #99; |FINSI;
  |CIERRA #99;

  |ABRE #1;
  #1#0 = #99#0;
  |LEE 040#1=;
  |SI FSalida ! 0; |DDEFECTO #1; |FINSI;
  |CIERRA #1;

  |ABRE #2;
  #2#0 = #1#40;
  #2#1 = #1#41;
  |LEE 040#2=;
  |SI FSalida ! 0; |DDEFECTO #2; |FINSI;
  |CIERRA #2;

  |ABRE #3;
  #3#0 = #1#44;
  |LEE 040#3=;
  |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
  |CIERRA #3;

  |ABRE #4;
  #4#0 = #1#12;
  #4#1 = #1#13;
  |LEE 040#4=;
  |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
  |CIERRA #4;

  |ABRE #5;
  #5#0   = #99#0;
  #5#141 = #99#1;
  |LEE 040#5=;
  |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
  |CIERRA #5;

  |ABRE #37;
  #37#0 = #1#12;
  |LEE 040#37=;
  |SI FSalida ! 0; |DDEFECTO #37; |FINSI;
  |CIERRA #37;
|FPRC;

|PROCESO CargaHoja1;
  |HAZ LeeFicheros;

  #601#0 = 0;
  |LIBERA #601;
  |LEE 140#601=;
  |SI FSalida ! 0;
      |DDEFECTO #601;
      #601#0 = 0;
      |GRABA 140#601b;
  |FINSI;

  |BUCLE rerendtr;

  #601#4   = (("00" + #2#0) % -102) + (("000" + #2#1) % -103);
  #601#8   = #1#6 + " " + #1#7;
  #601#9   = #1#8;
  #601#10  = #1#14;
  #601#11  = #4#2;
  #601#12  = (("00" + #1#12) % -102) + (("000" + #1#13) % -103);

  |SI #1#37 = "X";  #601#20 = "3";  |FINSI;
  |SI #1#38 = "X";  #601#20 = "4";  |FINSI;
  |SI #1#39 = "X";  #601#20 = "5";  |FINSI;
  |SI #1#34 = "X";  #601#37 = "1";  |FINSI;
  |SI #1#36 = "X";  #601#37 = "1";  |FINSI;
  |SI #1#35 = "X";  #601#37 = "2";  |FINSI;
  |SI #1#4  = "N";  #601#39 = "X";  |FINSI;

  #601#38  = ("00" + #37#3) % -102;
  #601#40  = #3#2;
  #601#41  = #3#1;
  #601#42  = (("00" + #3#5) % -102) + (("000" + #3#6) % -103);
  #601#43  = #3#3;
  #601#44  = #3#4;
  #601#45  = #3#7;
  #601#46  = #3#8;

  |SI #1#32 = "X";  #601#47  = "6";  |FINSI;
  |SI #1#33 = "X";  #601#47  = "7";  |FINSI;

  #601#50  = #5#130;
  #601#51  = #5#1;
  #601#53  = #5#131;
  #601#54  = #5#2;
  #601#55  = #5#142;
  #601#56  = #5#143;
  #601#57  = #5#144;
  #601#58  = #5#145;
  #601#59  = #5#3;
  #601#60  = #5#4;
  #601#61  = #5#5;
  #601#65  = #99#0;
  #601#63  = #2#2;
  #601#64  = #2#3;

  |SI #601#4  = "00000";  #601#4  = "     ";  |FINSI;
  |SI #601#12 = "00000";  #601#12 = "     ";  |FINSI;
  |SI #601#42 = "00000";  #601#42 = "     ";  |FINSI;

  |SI #99#1 = "1"; |O #99#1 = "2"; |O #99#1 = "3"; |O #99#1 = "4";
      |SI #1#98 ! 0; |Y #99#1 = "1";
          Casilla = 47 + #1#98; #601#5 = #1Casilla;
          Casilla = 57 + #1#98; Cadena = #1Casilla;  |HAZ SeparaNombre;
          #601#6  = Cadena1 + " " + Cadena2;
          #601#7  = Cadena3;
          #601#66 = Cadena1 + " " + Cadena2 + " " + Cadena3;
      |FINSI;

      |SI #1#99 ! 0; |Y #99#1 = "2";
          Casilla = 47 + #1#99; #601#5 = #1Casilla;
          Casilla = 57 + #1#99; Cadena = #1Casilla;  |HAZ SeparaNombre;
          #601#6   = Cadena1 + " " + Cadena2;
          #601#7   = Cadena3;
          #601#66  = Cadena1 + " " + Cadena2 + " " + Cadena3;
      |FINSI;

      |SI #1#100 ! 0; |Y #99#1 = "3";
          Casilla = 47 + #1#100; #601#5 = #1Casilla;
          Casilla = 57 + #1#100; Cadena = #1Casilla;  |HAZ SeparaNombre;
          #601#6   = Cadena1 + " " + Cadena2;
          #601#7   = Cadena3;
          #601#66  = Cadena1 + " " + Cadena2 + " " + Cadena3;
      |FINSI;

      |SI #1#101 ! 0; |Y #99#1 = "4";
          Casilla = 47 + #1#101; #601#5 = #1Casilla;
          Casilla = 57 + #1#101; Cadena = #1Casilla;  |HAZ SeparaNombre;
          #601#6   = Cadena1 + " " + Cadena2;
          #601#7   = Cadena3;
          #601#66  = Cadena1 + " " + Cadena2 + " " + Cadena3;
      |FINSI;

      |GRABA 140#601a;
      |ACABA;
  |FINSI;

  |SI #99#1 = "A"; |O #99#1 = "T";
      #601#5   = #1#2;
      Cadena1  = #1#209;  |QBF Cadena1;
      Cadena2  = #1#210;  |QBF Cadena2;
      Cadena3  = #1#211;  |QBF Cadena3;
      #601#6   = Cadena1 + " " + Cadena2;
      #601#7   = Cadena3;
      #601#66  = Cadena1 + " "  + Cadena2 + " " +  Cadena3;

      #601#17  = #1#29;
      Cadena1  = #1#212;  |QBF Cadena1;
      Cadena2  = #1#213;  |QBF Cadena2;
      Cadena3  = #1#214;  |QBF Cadena3;
      #601#18  = Cadena1 + " " + Cadena2;
      #601#19  = Cadena3;
      #601#67  = Cadena1 + " " + Cadena2 + " " + Cadena3;
  |FINSI;

  |SI #99#1 = "C";
      #601#5   = #1#29;
      Cadena1  = #1#212;  |QBF Cadena1;
      Cadena2  = #1#213;  |QBF Cadena2;
      Cadena3  = #1#214;  |QBF Cadena3;
      #601#6   = Cadena1 + " " + Cadena2;
      #601#7   = Cadena3;
      #601#66  = Cadena1 + " "  + Cadena2 + " " +  Cadena3;

      #601#17  = #1#2;
      Cadena1  = #1#209;  |QBF Cadena1;
      Cadena2  = #1#210;  |QBF Cadena2;
      Cadena3  = #1#211;  |QBF Cadena3;
      #601#18  = Cadena1 + " " + Cadena2;
      #601#19  = Cadena3;
      #601#67  = Cadena1 + " "  + Cadena2 + " " +  Cadena3;
  |FINSI;

  Contador1 = 0;
  CamParie  = 20;
  |PARA XCampos = 164; |SI XCampos [ 173; |HACIENDO XCampos = XCampos + 1;
        EsNif    = XCampos - 116;
        EsNombre = XCampos - 106;
        EsParent = XCampos - 86;
        EsNacimi = XCampos - 96;
        EsDe     = XCampos - 10;
        NombreFa = #1EsNombre; |QBF NombreFa;
        EsAnyo   = #1EsNacimi;
        EsAnyo   = 1997 - EsAnyo;

        NoFamili = 0;
        |SI #99#1 ! "A"; |Y #1EsDe ! "A";
            |SI #1EsDe ! #99#1; NoFamili = 1; |FINSI;
        |FINSI;

        |SI NombreFa ! ""; |Y #1XCampos = "H"; |Y EsAnyo < 18; |Y NoFamili = 0;
            Contador1  = Contador1 + 1;
            CamParie   = CamParie + 1;  #601CamParie = #1EsNif;
            CamParie   = CamParie + 1;  #601CamParie = #1EsNombre;
            CamParie   = CamParie + 1;  #601CamParie = #1EsParent;
            CamParie   = CamParie + 1;  #601CamParie = #1EsNacimi;
        |FINSI;
        |SI  Contador1 = 4;  |SAL;  |FINSI;
  |SIGUE;

  |SI Contador1 < 4;
      |PARA XCampos = 164; |SI XCampos [ 173; |HACIENDO XCampos = XCampos + 1;
            EsNif    = XCampos - 116;
            EsNombre = XCampos - 106;
            EsParent = XCampos - 86;
            EsNacimi = XCampos - 96;
            EsDe     = XCampos - 10;
            EsMinu   = XCampos - 76;

            NombreFa = #1EsNombre; |QBF NombreFa;
            EsAnyo   = #1EsNacimi;
            EsAnyo   = 1997 - EsAnyo;

            NoFamili = 0;
            |SI #99#1 ! "A"; |Y #1EsDe ! "A";
                |SI #1EsDe ! #99#1; NoFamili = 1; |FINSI;
            |FINSI;

            ||SI NombreFa ! ""; |Y #1XCampos ! "H"; |Y NoFamili = 0;
               || Contador1  = Contador1 + 1;
               || CamParie   = CamParie + 1;  #601CamParie = #1EsNif;
               || CamParie   = CamParie + 1;  #601CamParie = #1EsNombre;
               || CamParie   = CamParie + 1;  #601CamParie = #1EsParent;
               || CamParie   = CamParie + 1;  #601CamParie = #1EsNacimi;
            ||FINSI;

           |SI  Contador1 = 4;  |SAL;  |FINSI;

           |SI NombreFa ! ""; |Y #1XCampos = "H"; |Y EsAnyo > 18; |Y #1EsMinu ! "N";  |Y NoFamili = 0;
               Contador1  = Contador1 + 1;

               CamParie   = CamParie + 1;  #601CamParie = #1EsNif;
               CamParie   = CamParie + 1;  #601CamParie = #1EsNombre;
               CamParie   = CamParie + 1;  #601CamParie = #1EsParent;
               CamParie   = CamParie + 1;  #601CamParie = #1EsNacimi;
           |FINSI;
           |SI  Contador1 = 4;  |SAL;  |FINSI;
      |SIGUE;
  |FINSI;

  |GRABA 140#601a;
|FPRC;

|PROCESO CargaHoja1P;
  |HAZ LeeFicheros;

  #601#0 = 0;
  |LIBERA #601;
  |LEE 140#601=;
  |SI FSalida ! 0;
      |DDEFECTO #601;
      #601#0 = 0;
      |GRABA 140#601b;
  |FINSI;

  |BUCLE rerendtr;

  #601#4   = (("00" + #2#0) % -102) + (("000" + #2#1) % -103);
  #601#8   = #1#6 + " " + #1#7;
  #601#9   = #1#8;
  #601#10  = #1#14;
  #601#11  = #4#2;
  #601#12  = (("00" + #1#12) % -102) + (("000" + #1#13) % -103);

  |SI #5#140 = "I"; #601#37 = "1"; |FINSI;
  |SI #5#140 = "C"; #601#37 = "2"; |FINSI;
  |SI #1#4  = "N";  #601#39 = "X"; |FINSI;

  #601#38  = ("00" + #37#3) % -102;
  #601#40  = #3#2;
  #601#41  = #3#1;
  #601#42  = (("00" + #3#5) % -102) + (("000" + #3#6) % -103);
  #601#43  = #3#3;
  #601#44  = #3#4;
  #601#45  = #3#7;
  #601#46  = #3#8;

  |SI #1#32 = "X";  #601#47  = "6";  |FINSI;
  |SI #1#33 = "X";  #601#47  = "7";  |FINSI;

  #601#50  = #5#130;
  #601#51  = #5#1;
  #601#53  = #5#131;
  #601#54  = #5#2;
  #601#55  = #5#142;
  #601#56  = #5#143;
  #601#57  = #5#144;
  #601#58  = #5#145;
  #601#59  = #5#3;
  #601#60  = #5#4;
  #601#61  = #5#5;
  #601#65  = #99#0;
  #601#63  = #2#2;
  #601#64  = #2#3;

  |SI #601#4  = "00000";  #601#4  = "     ";  |FINSI;
  |SI #601#12 = "00000";  #601#12 = "     ";  |FINSI;
  |SI #601#42 = "00000";  #601#42 = "     ";  |FINSI;

  |SI #99#1 = "A"; |O #99#1 = "T";
      |SI #99#1 = "A";
          |SI Tippar = 1; Fechad = Fecpar + 1;   Fechah = "31.12.1997"; |FINSI;
          |SI Tippar = 3; Fechad = "01.01.1997"; Fechah = Fecpar;       |FINSI;
          |SI Tippar = 2; Fechad = "01.01.1997"; Fechah = Fecpar;       |FINSI;

          Cadena1  = #1#209;  |QBF Cadena1;
          Cadena2  = #1#210;  |QBF Cadena2;
          Cadena3  = #1#211;  |QBF Cadena3;
          #601#5   = #1#2;
          #601#6   = Cadena1 + " " + Cadena2;
          #601#7   = Cadena3;
          #601#66  = Cadena1 + " "  + Cadena2 + " " +  Cadena3;

          #601#17  = #1#29;
          Cadena1  = #1#212;  |QBF Cadena1;
          Cadena2  = #1#213;  |QBF Cadena2;
          Cadena3  = #1#214;  |QBF Cadena3;
          #601#18  = Cadena1 + " " + Cadena2;
          #601#19  = Cadena3;
          #601#67  = Cadena1 + " " + Cadena2 + " " + Cadena3;
      |FINSI;

      |SI #99#1 = "T";
          |SI Tippar = 1; Fechad = "01.01.1997"; Fechah = Fecpar;       |FINSI;
          |SI Tippar = 3; Fechad = Fecpar + 1;   Fechah = "31.12.1997"; |FINSI;
          |SI Tippar = 2;
              |SI Muerto = "T";
                   Fechad = "01.01.1997"; Fechah = Fecpar;
                   #601#17  = #1#29;
                   Cadena1  = #1#212;  |QBF Cadena1;
                   Cadena2  = #1#213;  |QBF Cadena2;
                   Cadena3  = #1#214;  |QBF Cadena3;
                   #601#18  = Cadena1 + " " + Cadena2;
                   #601#19  = Cadena3;
                   #601#67  = Cadena1 + " " + Cadena2 + " " + Cadena3;
              |SINO;
                  |SI #1#103 ! " ";
                      Fechad = Fecpar + 1;
                      Fechah = "31.12.1997";
                  |FINSI;
              |FINSI;
          |FINSI;

          Cadena1  = #1#209;  |QBF Cadena1;
          Cadena2  = #1#210;  |QBF Cadena2;
          Cadena3  = #1#211;  |QBF Cadena3;
          #601#5   = #1#2;
          #601#6   = Cadena1 + " " + Cadena2;
          #601#7   = Cadena3;
          #601#66  = Cadena1 + " "  + Cadena2 + " " +  Cadena3;
      |FINSI;
  |FINSI;

  |SI #99#1 = "C";
      |SI Tippar = 1; Fechad = "01.01.1997"; Fechah = Fecpar;       |FINSI;
      |SI Tippar = 3; Fechad = Fecpar + 1;   Fechah = "31.12.1997"; |FINSI;
      |SI Tippar = 2;
          |SI Muerto = "C";
              Fechad = "01.01.1997"; Fechah = Fecpar;
              #601#17  = #1#2;
              Cadena1  = #1#209;  |QBF Cadena1;
              Cadena2  = #1#210;  |QBF Cadena2;
              Cadena3  = #1#211;  |QBF Cadena3;
              #601#18  = Cadena1 + " " + Cadena2;
              #601#19  = Cadena3;
              #601#67  = Cadena1 + " "  + Cadena2 + " " +  Cadena3;
          |SINO;
              |SI #1#103 ! " ";
                  Fechad = Fecpar + 1;
                  Fechah = "31.12.1997";
              |FINSI;
          |FINSI;
      |FINSI;

      #601#5   = #1#29;
      Cadena1  = #1#212;  |QBF Cadena1;
      Cadena2  = #1#213;  |QBF Cadena2;
      Cadena3  = #1#214;  |QBF Cadena3;
      #601#6   = Cadena1 + " " + Cadena2;
      #601#7   = Cadena3;
      #601#66  = Cadena1 + " "  + Cadena2 + " " +  Cadena3;
  |FINSI;

  |SI #601#17 ! "         ";
      |SI #1#37 = "X";  #601#20 = "3";  |FINSI;
      |SI #1#38 = "X";  #601#20 = "4";  |FINSI;
      |SI #1#39 = "X";  #601#20 = "5";  |FINSI;
  |FINSI;

  #601#13 = Fechad % 102;
  #601#14 = Fechad % 402;
  #601#15 = Fechah % 102;
  #601#16 = Fechah % 402;

  Contador1 = 0;
  CamParie  = 20;
  |PARA XCampos = 164; |SI XCampos [ 173; |HACIENDO XCampos = XCampos + 1;
        EsNif    = XCampos - 116;
        EsNombre = XCampos - 106;
        EsParent = XCampos - 86;
        EsNacimi = XCampos - 96;
        EsDe     = XCampos - 10;
        NombreFa = #1EsNombre; |QBF NombreFa;
        EsAnyo   = #1EsNacimi;
        EsAnyo   = 1997 - EsAnyo;

        NoFamili = 0;
        |SI #99#1 ! "A"; |Y #1EsDe ! "A";
            |SI #1EsDe ! #99#1; NoFamili = 1; |FINSI;
        |FINSI;

        |SI NombreFa ! ""; |Y #1XCampos = "H"; |Y EsAnyo < 18; |Y NoFamili = 0;
            Contador1  = Contador1 + 1;
            CamParie   = CamParie + 1;  #601CamParie = #1EsNif;
            CamParie   = CamParie + 1;  #601CamParie = #1EsNombre;
            CamParie   = CamParie + 1;  #601CamParie = #1EsParent;
            CamParie   = CamParie + 1;  #601CamParie = #1EsNacimi;
        |FINSI;
        |SI  Contador1 = 4;  |SAL;  |FINSI;
  |SIGUE;

  |SI Contador1 < 4;
      |PARA XCampos = 164; |SI XCampos [ 173; |HACIENDO XCampos = XCampos + 1;
            EsNif    = XCampos - 116;
            EsNombre = XCampos - 106;
            EsParent = XCampos - 86;
            EsNacimi = XCampos - 96;
            EsDe     = XCampos - 10;

            NombreFa = #1EsNombre; |QBF NombreFa;
            EsAnyo   = #1EsNacimi;
            EsAnyo   = 1997 - EsAnyo;

            NoFamili = 0;
            |SI #99#1 ! "A"; |Y #1EsDe ! "A";
                |SI #1EsDe ! #99#1; NoFamili = 1; |FINSI;
            |FINSI;

            |SI NombreFa ! ""; |Y #1XCampos ! "H"; |Y NoFamili = 0;
                Contador1  = Contador1 + 1;
                CamParie   = CamParie + 1;  #601CamParie = #1EsNif;
                CamParie   = CamParie + 1;  #601CamParie = #1EsNombre;
                CamParie   = CamParie + 1;  #601CamParie = #1EsParent;
                CamParie   = CamParie + 1;  #601CamParie = #1EsNacimi;
           |FINSI;

           |SI  Contador1 = 4;  |SAL;  |FINSI;

           |SI NombreFa ! ""; |Y #1XCampos = "H"; |Y EsAnyo > 18; |Y NoFamili = 0;
               Contador1  = Contador1 + 1;

               CamParie   = CamParie + 1;  #601CamParie = #1EsNif;
               CamParie   = CamParie + 1;  #601CamParie = #1EsNombre;
               CamParie   = CamParie + 1;  #601CamParie = #1EsParent;
               CamParie   = CamParie + 1;  #601CamParie = #1EsNacimi;
           |FINSI;
           |SI  Contador1 = 4;  |SAL;  |FINSI;
      |SIGUE;
  |FINSI;

  |GRABA 140#601a;
|FPRC;

|| **********************************************************
|| GRABA SECUENCIAL
|| **********************************************************

|PROCESO GrabaH01M100;
  |HAZ BorraCampos;

  ICampos = Campos1 <-;
  |PARA XCampos = 1;  |SI XCampos [ 62;  |HACIENDO XCampos = XCampos + 1;
        Campos = #601XCampos;
        ICampos = ICampos + 1;
  |SIGUE;

  ICampos = Campos1  <-;                                    Campos = "100";
  ICampos = Campos2  <-;                                    Campos = "01";
  ICampos = Campos5  <-; CampoDni = Campos;  |HAZ LetraDni; Campos = CampoDni;
  ICampos = Campos17 <-; CampoDni = Campos;  |HAZ LetraDni; Campos = CampoDni;
  ICampos = Campos21 <-; CampoDni = Campos;  |HAZ LetraDni; Campos = CampoDni;
  ICampos = Campos25 <-; CampoDni = Campos;  |HAZ LetraDni; Campos = CampoDni;
  ICampos = Campos29 <-; CampoDni = Campos;  |HAZ LetraDni; Campos = CampoDni;
  ICampos = Campos33 <-; CampoDni = Campos;  |HAZ LetraDni; Campos = CampoDni;
  ICampos = Campos40 <-; CampoDni = Campos;  |HAZ LetraDni; Campos = CampoDni;
  ICampos = Campos62 <-; Valfa    = &13 + &10;              Campos = Valfa;

  ICampos = Campos50 <-;
  |PARA XCampos = 50;  |SI XCampos [ 61;  |HACIENDO XCampos = XCampos + 1;
        CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
        ICampos = ICampos + 1;
  |SIGUE;

  INEmpresas = NEmpresas1 <-;
  INEmpresas = INEmpresas + NCopia;

  Pos = -1;
  NSecuencial = "r+b " + NEmpresas;
  |FABRE NSecuencial;
  |SI FSalida < 0;
      NSecuencial = "wb  " + NEmpresas;
      |FABRE NSecuencial;
  |FINSI;

  Handle = FSalida;
  |SI FSalida ] 0;
      |PARA; |SI; |HACIENDO;
           Field = Handle + " 255";
           |FLEE Field;
           |SI FSalida [ 0;  |SAL;  |FINSI;
      |SIGUE;
  |FINSI;

  ICampos = Campos1 <-;
  |PARA XPara = 1; |SI XPara [ 62; |HACIENDO XPara = XPara + 1;
         Variable = Handle + " " + Campos;
        |FGRABA Variable;
        ICampos  = ICampos + 1;
  |SIGUE;
  |FCIERRA Handle;
|FPRC;

|| ***********************************************
|| PROGRAMA
|| ***********************************************

|PROGRAMA;
  |NOME_DAT #99  VTemporal0;
  |NOME_DAT #601 VTemporal1;

  |SI VSwCarga = 0;
      |ABRE #601;  |CIERRA #601;  |DELINDEX #601;
      |ABRE #601;
      |HAZ CargaHoja1;
      |CIERRA #601;
  |FINSI;

  |SI VSwCarga = 1;
      |ABRE #601;  |CIERRA #601;  |DELINDEX #601;
      |ABRE #601;
      |HAZ CargaHoja1P;
      |CIERRA #601;
  |FINSI;

  |SI VSwCarga = 100;
      |ABRE #601;
      #601#0 = 0;
      |LEE 040#601=;
      |SI FSalida = 0;
          |HAZ GrabaH01M100;
      |FINSI;
      |CIERRA #601;
  |FINSI;
|FPRO;
