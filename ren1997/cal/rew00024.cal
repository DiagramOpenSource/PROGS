|FICHEROS;
     retotren #5;
     retotrea #6;
     rew00001 #99;
     rew00024 #615;
|FIN;

|VARIABLES;
      XCampos     = 0;
      Porce       = 0;
      PorcNaci    = 0;

      NSecuencial = "";
      Field       = "";

     &VEmpresa    = 0;
     &VTipo       = "";
     &NCopia      = 0;
     &VSwCarga    = 0;
     &VTemporal0  = "";
     &VTemporal15 = "";

{200}&NEmpresas  = "";
|FIN;

|INCLUYE i_utilid;

|PROCESO LeeFicheros;
  |ABRE #99;
  #99#0 = VEmpresa;
  #99#1 = VTipo;
  |LEE 040#99=;
  |SI FSalida ! 0; |DDEFECTO #99; |FINSI;
  |CIERRA #99;

  |ABRE #5;
  #5#0   = #99#0;
  #5#141 = #99#1;
  |LEE 040#5=;
  |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
  |CIERRA #5;

  |ABRE #6;
  #6#0 = #99#0;
  #6#1 = #99#1;
  |LEE 040#6=;
  |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
  |CIERRA #6;
|FPRC;

|PROCESO CargaHoja15;
  |HAZ LeeFicheros;

  #615#0 = 0;
  |LIBERA #615;
  |LEE 140#615=;
  |SI FSalida ! 0;
      |DDEFECTO #615;
      #615#0 = 0;
      |GRABA 140#615b;
  |FINSI;

  |SI #5#140 = "I"; #615#4 = "X"; |FINSI;
  |SI #5#140 = "C"; #615#5 = "X"; |FINSI;

  #615#6  = #6#50;
  #615#7  = #6#51;
  #615#8  = #6#52;
  #615#9  = #6#53;

  CantiNum = #6#251;  |HAZ Decimales;
  Valfa1   = ("00" + ParteEntera)  % -102;
  Valfa2   = ("00" + ParteDecimal) % -102;
  #615#10 = Valfa1;
  #615#11 = Valfa2;

  #615#12 = #6#54;
  #615#13 = #6#55;
  #615#14 = #6#56;
  #615#15 = #6#57;

  CantiNum = #6#252;  |HAZ Decimales;
  Valfa1   = ("00" + ParteEntera)  % -102;
  Valfa2   = ("00" + ParteDecimal) % -102;
  #615#16 = Valfa1;
  #615#17 = Valfa2;
  #615#18 = #6#58;
  #615#19 = #6#59;
  #615#20 = #6#60;
  #615#21 = #6#61;
  #615#22 = #6#62;
  #615#23 = #6#63;

  CantiNum = #6#253;  |HAZ Decimales;
  Valfa1   = ("00" + ParteEntera)  % -102;
  Valfa2   = ("00" + ParteDecimal) % -102;
  #615#24 = Valfa1;
  #615#25 = Valfa2;

  #615#26 = #6#64;
  #615#27 = #6#65;
  #615#28 = #6#66;
  #615#29 = #6#67;

  CantiNum = #6#254;  |HAZ Decimales;
  Valfa1   = ("00" + ParteEntera)  % -102;
  Valfa2   = ("00" + ParteDecimal) % -102;
  #615#30 = Valfa1;
  #615#31 = Valfa2;
  #615#32 = #6#68;
  #615#33 = #6#69;

  CantiNum = #6#70;  |HAZ Decimales;
  Valfa1   = ("00" + ParteEntera)  % -102;
  Valfa2   = ("00" + ParteDecimal) % -102;
  #615#34 = Valfa1;
  #615#35 = Valfa2;
  #615#36 = #6#71;

  CantiNum = #6#72;  |HAZ Decimales;
  Valfa1   = ("00" + ParteEntera)  % -102;
  Valfa2   = ("00" + ParteDecimal) % -102;
  #615#37 = Valfa1;
  #615#38 = Valfa2;
  #615#39 = #6#73;

  CantiNum = #6#74;  |HAZ Decimales;
  Valfa1   = ("00" + ParteEntera)  % -102;
  Valfa2   = ("00" + ParteDecimal) % -102;
  #615#40 = Valfa1;
  #615#41 = Valfa2;
  #615#42 = #6#75;

  CantiNum = #6#76;  |HAZ Decimales;
  Valfa1   = ("00" + ParteEntera)  % -102;
  Valfa2   = ("00" + ParteDecimal) % -102;
  #615#43 = Valfa1;
  #615#44 = Valfa2;
  #615#45 = #6#77;

  #615#46 = #6#78;
  #615#47 = #6#79;
  #615#48 = #6#80;
  #615#49 = #6#81;
  #615#50 = #6#82;
  #615#51 = #6#83;
  #615#52 = #5#64;

  CantiNum = #5#65;  |HAZ Decimales;
  Valfa1   = ("00" + ParteEntera)  % -102;
  Valfa2   = ("00" + ParteDecimal) % -102;
  #615#53 = Valfa1;
  #615#54 = Valfa2;

  CantiNum = #5#66;  |HAZ Decimales;
  Valfa1   = ("00" + ParteEntera)  % -102;
  Valfa2   = ("00" + ParteDecimal) % -102;
  #615#55 = Valfa1;
  #615#56 = Valfa2;

  #615#57 = #5#67;
  #615#58 = #5#80;
  #615#59 = #6#84;
  #615#60 = #6#85;
  #615#61 = #5#85;

  #615#63 = #99#7;
  #615#64 = #99#3;

  |GRABA 140#615a;
|FPRC;

|PROCESO GrabaH15M100;
  |HAZ BorraCampos;

  ICampos = Campos1 <-;
  |PARA XCampos = 1;  |SI XCampos [ 62;  |HACIENDO XCampos = XCampos + 1;
         Campos = #615XCampos;
        ICampos = ICampos + 1;
  |SIGUE;

  ICampos = Campos1  <-;                                    Campos = "100";
  ICampos = Campos2  <-;                                    Campos = "15";
  ICampos = Campos6  <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos7  <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos8  <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos9  <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos12 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos13 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos14 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos15 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos18 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos19 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos20 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos21 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos22 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos23 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos26 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos27 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos28 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos29 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos32 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos33 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos36 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos39 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos42 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos45 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos46 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos47 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos48 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos49 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos50 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos51 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos52 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos57 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos58 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos59 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos60 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos61 <-; CantiNum = Campos;  |HAZ CambiCantiD10;  Campos = CantiAlfa;
  ICampos = Campos62 <-; Valfa = &13 + &10;                 Campos = Valfa;


  INEmpresas = NEmpresas1 <-;
  INEmpresas = INEmpresas + NCopia;

  Pos = -1;
  NSecuencial = "r+b " + NEmpresas;
  |FABRE NSecuencial;
  |SI FSalida < 0;
      NSecuencial = "wb  " + NEmpresas;
      |FABRE NSecuencial;
  |FINSI;

  Handle = FSalida;
  |SI FSalida ] 0;
      |PARA; |SI; |HACIENDO;
           Field = Handle + " 255";
           |FLEE Field;
           |SI FSalida [ 0;  |SAL;  |FINSI;
      |SIGUE;
  |FINSI;

  ICampos = Campos1 <-;
  |PARA XPara = 1; |SI XPara [ 62; |HACIENDO XPara = XPara + 1;
        Variable = Handle + " " + Campos;
        |FGRABA Variable;
        ICampos  = ICampos + 1;
  |SIGUE;
  |FCIERRA Handle;
|FPRC;

|PROGRAMA;
  |NOME_DAT #99  VTemporal0;
  |NOME_DAT #615 VTemporal15;

  |SI VSwCarga = 0;  |O VSwCarga = 1;
      |ABRE #615;  |CIERRA #615;  |DELINDEX #615;
      |ABRE #615;
      |HAZ CargaHoja15;
      |CIERRA #615;
  |FINSI;

  |SI VSwCarga = 100;
      |ABRE #615;
      #615#0 = 0;
      |LEE 040#615=;
      |SI FSalida = 0;
          |HAZ GrabaH15M100;
      |FINSI;
      |CIERRA #615;
  |FINSI;
|FPRO;
