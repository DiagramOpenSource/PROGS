|FICHEROS;
     reemi102 #0;
     redatcon #1;
     retotren #5;
     repartid #8;
     repant50 #90;

     rew00001 #99,MANTE;

     rew00026 #617;
|FIN;

|VARIABLES;
     CFBase      = "";
     CFAbre      = "";
     Hoja        = 0;
     NombreInf   = "";
     XCampos     = 0;
     NFamiliar   = 0;
     SwEstar     = 0;
     Tempo       = "";
     Modifica    = "";
     NombreImpre = "";
     Casilla     = 0;
     DEmpre      = 0;
     HEmpre      = 0;
     Fefin       = @;
     Feini       = @;
     Dias        = 0;
     Valfa       = "";

     &Tippar      = 0;
     &Parte1      = 0;
     &Parte2      = 0;
     &Muerto      = "";
     &Fecpar      = @;
     &DiaInf     = "";
     &MesInf     = "";
     &EjerInf    = "";
     &VEmpresa    = 0;
     &VTipo       = "";
     &VSwCarga    = 0;
     &VTemporal0  = "";
     &VTemporal17 = "";

{200}&NEmpresas  = "";
|FIN;

|INCLUYE i_husuar;

|| **************************************************************************
||                           PROCESOS DEL PROGRAMA
|| **************************************************************************

|PROCESO Mayus;
  #0Campo = #0Campo > #0Campo;  |PINTA #0Campo;
|FPRC;

|PROCESO Seleccion; |TIPO 0;
  |SI #0#0 = "S";
      |CAMPO_MODIFICA #0#01, 1, "S";
      |CAMPO_MODIFICA #0#02, 1, "S";

      |PARA XCampos = 3; |SI XCampos [ 32; |HACIENDO XCampos = XCampos + 1;
            #0XCampos = 0; |PINTA #0XCampos;
            |CAMPO_MODIFICA #0XCampos, 1, "N";
      |SIGUE;
  |SINO;
      #0#1 = 00001; |PINTA #0#1;    |CAMPO_MODIFICA #0#01, 1, "N";
      #0#2 = 99999; |PINTA #0#2;    |CAMPO_MODIFICA #0#02, 1, "N";

      |PARA XCampos = 3; |SI XCampos [ 32; |HACIENDO XCampos = XCampos + 1;
            |CAMPO_MODIFICA #0XCampos, 1, "S";
      |SIGUE;
  |FINSI;
|FPRC;

||********************************
|| PROCESOS DE LECTURAS Y REPARTOS
||********************************

|PROCESO PonTemporales;
  Valfa = "";  Tempo = "";
  |DFICE Valfa;
  Tempo = "";   |TEMPO Tempo; VTemporal17 = Tempo - Valfa;
|FPRC;

|PROCESO BorraTemporales;
  Valfa = "";  Tempo = "";
  |DFICE Valfa;

  Tempo = Valfa + VTemporal17;           |FBORRA Tempo;
  Tempo = Valfa + VTemporal17 + ".dat";  |FBORRA Tempo;
  Tempo = Valfa + VTemporal17 + ".ddx";  |FBORRA Tempo;
  Tempo = Valfa + VTemporal17 + ".ixx";  |FBORRA Tempo;
|FPRC;

|PROCESO GrabaCliente;
  |SI XCampos > 1;  |ACABA;  |FINSI;

  HContribu  = #99#0;
  HNombre    = #99#3;
  HLinea     = 0;
  HPrograma  = "(reemi100) IMPRESION MODELO 102";
  HTipo      = "IMPRESION FICHA";
  HRdto      = #617#32;
  |SI #99#1  = "A"; HPerceptor = "CONJUNTA";    |FINSI;
  |SI #99#1  = "T"; HPerceptor = "TITULAR";     |FINSI;
  |SI #99#1  = "C"; HPerceptor = "CONYUGE";     |FINSI;
  |SI #99#1  = "1"; HPerceptor = "1§ FAMILIAR"; |FINSI;
  |SI #99#1  = "2"; HPerceptor = "2§ FAMILIAR"; |FINSI;
  |SI #99#1  = "3"; HPerceptor = "3§ FAMILIAR"; |FINSI;
  |SI #99#1  = "4"; HPerceptor = "4§ FAMILIAR"; |FINSI;

  |HAZ AltaHistorico;

  |ABRE #1;
  |LIBERA #1;
  #1#0 = #99#0;
  |LEE 140#1=;
  |SI FSalida ! 0; |CIERRA #1; |ACABA; |FINSI;

  |SI #99#1 = "A";  #1#131 = "S";  |FINSI;
  |SI #99#1 = "T";  #1#132 = "S";  |FINSI;
  |SI #99#1 = "C";  #1#133 = "S";  |FINSI;
  |SI #99#1 = "1";  #1#134 = "S";  |FINSI;
  |SI #99#1 = "2";  #1#135 = "S";  |FINSI;
  |SI #99#1 = "3";  #1#136 = "S";  |FINSI;
  |SI #99#1 = "4";  #1#137 = "S";  |FINSI;

  |GRABA 140#1a;
  |LIBERA #1;
  |CIERRA #1;
|FPRC;

|PROCESO CargaHojas;
  VSwCarga = 0;

  |ABRE #1;
  #1#0 = #99#0;
  |LEE 040#1=;
  |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
  |CIERRA #1;

  |SI #1#143 = "S";
      |ABRE #8;
      #8#0 = #1#0;
      |LEE 040#8=;
      |SI FSalida ! 0; |ACABA; |FINSI;
      |CIERRA #8;

      Tippar   = #8#3;
      Muerto   = #8#5;
      |SI #8#3 = 2; Fecpar = #8#4; |SINO; Fecpar = #8#6; |FINSI;
      Feini    = "01.01.1997";
      Fefin    = Fecpar;
      Dias     = Fefin - Feini + 1;
      Parte1   = ((100 * Dias) / 36500) ! 4;
      Parte2   = 1 - Parte1;
      VSwCarga = 1;
  |FINSI;

  |SUB_EJECUTA "rew00026";
|FPRC;

|PROCESO HojaAHoja;
  |ET Comienzo;

  CFBase    = "";
  |DIRECTORIO CFBase;

  Impresora = NombreImpre;
  CFAbre = Usuario % 810;
  CFAbre = CFBase + "/spool/" + CFAbre + ".spo";
  |FBORRA CFAbre;

  |PTEC 802;
  |PTEC 802;

  |IMPRE 0;
  |SI FSalida ! 0;
      |MENAV "      Problemas con impresora";
      |FINIMP;
      |VETE Comienzo;
  |FINSI;

  NombreInf = "m102ch01";

  |INFOR NombreInf;
  |SI FSalida ! 0;  |FINIMP; |ACABA;  |FINSI;

  |PRINT;  |PIEINF;  |FININF;  |FINIMP;

  |CONFI "2400NDesea repetir la hoja : ";
  |SI FSalida = 0; |VETE Comienzo; |FINSI;
|FPRC;

|PROCESO Continuo;
  NombreInf = "m102ch01";

  |INFOR NombreInf;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  |PRINT;  |PIEINF;  |FININF;
|FPRC;

|PROCESO Impresion;
  |SI #0#56 = "H";  |HAZ HojaAHoja;  |FINSI;
  |SI #0#56 = "C";  |HAZ Continuo;   |FINSI;
|FPRC;

|PROCESO Hoja102;
  |NOME_DAT #617 VTemporal17;
  |ABRE #617; #617#0 = 0; |LEE 040#617=; |SI FSalida ! 0; |DDEFECTO #617; |FINSI; |CIERRA #617;

  |HAZ Impresion;
|FPRC;

|PROCESO ImprimeLos;
  |PINPA #0#90;
  #90#0 = #99#0;  |PINTA #90#0;
  #90#1 = #99#3;  |PINTA #90#1;

  VEmpresa = #99#0;
  VTipo    = #99#1;

  |PARA XCampos = 1; |SI XCampos [ #99#4; |HACIENDO XCampos = XCampos + 1;
        #90#3 = XCampos;  |PINTA #90#3;

        |HAZ PonTemporales;
        |HAZ CargaHojas;
        |HAZ Hoja102;
        |HAZ GrabaCliente;
        |HAZ  BorraTemporales;
  |SIGUE;
|FPRC;

|DEFBUCLE rew00001;
  #99#1;
  5;
  00000, " ", "S";
  99999, "z", "S";
  ;
  NULL, ImprimeLos;
|FIN;

******************** Tipo de Impresion

|PROCESO CargaFecha;
  DiaInf  = #0#33 % 102;
  MesInf  = #0#33 % 402;
  EjerInf = #0#33 % -101;

  |SI MesInf = "01"; MesInf = "Enero     "; |FINSI;
  |SI MesInf = "02"; MesInf = "Febrero   "; |FINSI;
  |SI MesInf = "03"; MesInf = "Marzo     "; |FINSI;
  |SI MesInf = "04"; MesInf = "Abril     "; |FINSI;
  |SI MesInf = "05"; MesInf = "Mayo      "; |FINSI;
  |SI MesInf = "06"; MesInf = "Junio     "; |FINSI;
  |SI MesInf = "07"; MesInf = "Julio     "; |FINSI;
  |SI MesInf = "08"; MesInf = "Agosto    "; |FINSI;
  |SI MesInf = "09"; MesInf = "Septiembre"; |FINSI;
  |SI MesInf = "10"; MesInf = "Octubre   "; |FINSI;
  |SI MesInf = "11"; MesInf = "Noviembre "; |FINSI;
  |SI MesInf = "12"; MesInf = "Diciembre "; |FINSI;
|FPRC;

******************** Grabacion del Indexado a Imprimir

|PROCESO GrabaTempo;
  #5#0   = #1#0;
  #5#141 = "A";
  |LEE 040#5=;
  |SI #1#110 = "S"; |O #1#110 = "s";
      |SI #1#131 = #0#36; |Y FSalida = 0; |Y #5#139 > 0;
          #99#0 = #1#0;
          #99#1 = "A";
          #99#2 = "CONJUNTA";
          #99#3 = #1#1;
          #99#4 = #0#37;
          #99#5 = "S";
          #99#6 = 1;
          #99#7 = #1#2;
          |GRABA 040#99n;
          SwEstar = 1;
      |FINSI;
  |FINSI;

  #5#0   = #1#0;
  #5#141 = "T";
  |LEE 040#5=;
  |SI #1#111 = "S"; |O #1#111 = "s";
      |SI #1#132 = #0#36; |Y FSalida = 0; |Y #5#139 > 0;
          #99#0 = #1#0;
          #99#1 = "T";
          #99#2 = "TITULAR";
          #99#3 = #1#1;
          #99#4 = #0#37;
          #99#5 = "S";
          #99#6 = 1;
          #99#7 = #1#2;
          |GRABA 040#99n;
          SwEstar = 1;
      |FINSI;
  |FINSI;

  #5#0   = #1#0;
  #5#141 = "C";
  |LEE 040#5=;
  |SI #1#112 = "S"; |O #1#112 = "s";
      |SI #1#133 = #0#36; |Y FSalida = 0; |Y #5#139 > 0;
          #99#0 = #1#0;
          #99#1 = "C";
          #99#2 = "CONYUGE";
          #99#3 = #1#28;
          #99#4 = #0#37;
          #99#5 = "S";
          #99#6 = 1;
          #99#7 = #1#29;
          |GRABA 040#99n;
          SwEstar = 1;
      |FINSI;
  |FINSI;

  #5#0   = #1#0;
  #5#141 = "1";
  |LEE 040#5=;
  |SI #1#113 = "S"; |O #1#113 = "s";
      |SI #1#134 = #0#36; |Y FSalida = 0; |Y #5#139 > 0;
          #99#0 = #1#0;
          #99#1 = "1";
          #99#2 = "1. FAMILIAR";
          NFamiliar = 57 + #1#98;    #99#3 = #1NFamiliar;
          #99#4 = #0#37;
          #99#5 = "S";
          #99#6 = 1;
           NFamiliar  = 47 + #1#98;    #99#7 = #1 NFamiliar;
          |GRABA 040#99n;
          SwEstar = 1;
      |FINSI;
  |FINSI;

  #5#0   = #1#0;
  #5#141 = "2";
  |LEE 040#5=;
  |SI #1#114 = "S"; |O #1#114 = "s";
      |SI #1#135 = #0#36; |Y FSalida = 0; |Y #5#139 > 0;
          #99#0 = #1#0;
          #99#1 = "2";
          #99#2 = "2. FAMILIAR";
          NFamiliar  = 57 + #1#99;    #99#3 = #1NFamiliar;
          #99#4 = #0#37;
          #99#5 = "S";
          #99#6 = 1;
          NFamiliar  = 47 + #1#99;    #99#7 = #1NFamiliar;
          |GRABA 040#99n;
          SwEstar = 1;
      |FINSI;
  |FINSI;

  #5#0   = #1#0;
  #5#141 = "3";
  |LEE 040#5=;
  |SI #1#115 = "S"; |O #1#115 = "s";
      |SI #1#136 = #0#36; |Y FSalida = 0; |Y #5#139 > 0;
          #99#0 = #1#0;
          #99#1 = "3";
          #99#2 = "3. FAMILIAR";
          NFamiliar  = 57 + #1#100;    #99#3 = #1NFamiliar;
          #99#4 = #0#37;
          #99#5 = "S";
          #99#6 = 1;
          NFamiliar  = 47 + #1#100;    #99#7 = #1NFamiliar;
          |GRABA 040#99n;
          SwEstar = 1;
      |FINSI;
  |FINSI;

  #5#0   = #1#0;
  #5#141 = "4";
  |LEE 040#5=;
  |SI #1#116 = "S"; |O #1#116 = "s";
      |SI #1#137 = #0#36; |Y FSalida = 0; |Y #5#139 > 0;
          #99#0 = #1#0;
          #99#1 = "4";
          #99#2 = "4. FAMILIAR";
          NFamiliar  = 57 + #1#101;    #99#3 = #1NFamiliar;
          #99#4 = #0#37;
          #99#5 = "S";
          #99#6 = 1;
          NFamiliar  = 47 + #1#101;    #99#7 = #1NFamiliar;
          |GRABA 040#99n;
          SwEstar = 1;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE redatcon;
  #1#1;
  ;
  DEmpre;
  HEmpre;
  ;
  NULL, GrabaTempo;
|FIN;

|RUTINA inferior;
  #99#0 = 1;
  #99#1 = " ";
|FRUT;

|RUTINA superior;
  #99#0 = 99999;
  #99#1 = "z";
|FRUT;

|PROCESO CargaTempo;
  Valfa = "";
  Tempo = "";
  |DFICE Valfa;
  |TEMPO Tempo; VTemporal0 = Tempo - Valfa; |NOME_DAT #99 VTemporal0;
  |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

  |ABRE #5;
  |ABRE #99;
  SwEstar = 0;
  |SI #0#0 = "S";
      DEmpre = #0#1;
      HEmpre = #0#2;
      |BUCLE redatcon;
  |SINO;
      |PARA XCampos = 3; |SI XCampos [ 32; |HACIENDO XCampos = XCampos + 1;
            |SI #0XCampos ! 0;
                DEmpre = #0XCampos;
                HEmpre = #0XCampos;
                |BUCLE redatcon;
            |FINSI;
      |SIGUE;
  |FINSI;
  |CIERRA #99;
  |CIERRA #5;

  |SI SwEstar = 0; |ACABA; |FINSI;

  |SI #0#35 = "N"; |ACABA; |FINSI;

  |ENTLINEAL #1#99, 1, 4, 19, 1, inferior, superior;
|FPRC;

******************** Proceso Marcar y Desmarcar el Entlineal

|PROCESO funcion1; |TIPO 11;
  |SI FSalida ! 9; |ACABA; |FINSI;

  |LIBERA #99;
  |LEE 140#99=;

  |SI #99#5 = "S"; #99#5 = "N"; |SINO; #99#5 = "S"; |FINSI;
  |PINTA #99#5;
  |GRABA 140#99a;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
  |IMPRE 0;
  |SI FSalida ! 0; |ACABA; |FINSI;
  |SI #0#56 = "H";  |FINIMP;  |FINSI;

  |HAZ CargaFecha;
  |HAZ CargaTempo;

  |SI SwEstar = 0;
      |DFICE Valfa;
      Tempo = Valfa + VTemporal0;           |FBORRA Tempo;
      Tempo = Valfa + VTemporal0 + ".dat";  |FBORRA Tempo;
      Tempo = Valfa + VTemporal0 + ".ddx";  |FBORRA Tempo;
      Tempo = Valfa + VTemporal0 + ".ixx";  |FBORRA Tempo;
      |ACABA;
  |FINSI;

  |BUCLE rew00001;

  |DFICE Valfa;
  Tempo = Valfa + VTemporal0;           |FBORRA Tempo;
  Tempo = Valfa + VTemporal0 + ".dat";  |FBORRA Tempo;
  Tempo = Valfa + VTemporal0 + ".ddx";  |FBORRA Tempo;
  Tempo = Valfa + VTemporal0 + ".ixx";  |FBORRA Tempo;

  |SI #0#56 = "C";   |FINIMP;  |FINSI;
|FPRC;
