|FICHEROS;
     ettemite #0;
     ettpedi1 #1;         || pedidos cabs.
     ettpedi2 #2;         || pedidos lins.
     ettclien #3;         || clientes
     ettperso #4;         || personal
     ettemitm #10,MANTE;  || seleccion emisiones

     ettcontr;
     labtraba;
|FIN;

|VARIABLES;
     aAlfa = "";
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;

    opcion1 = 0;
    opcion2 = 0;
{-1}menu = "";
    menu1 = "1426";
    menu2 = "1";
    menu3 = "2";
    menu4 = " Contrato Puesta Disposicion. ";
    menu5 = " Partes de Horas Trabajadas. ";
    /*
    menu5 = " Contrato Laboral. ";
    menu6 = " Partes de Horas Trabajadas. ";
    menu7 = " Partes de Alta TA2/2 (Altas). ";
    menu8 = " Partes de Alta TA2/2 (Bajas). ";
    menu9 = " Prorroga Laboral. ";
    menu10= " Ampliacion/Disminucion Jornada. ";
    */
{-1}submenu = "";
    submenu1 = "2300";
    submenu2 = "1";
    submenu3 = "";
    submenu4 = "IR";
    submenu5 = " Imprimir pendientes ";
    submenu6 = " Repetir ya impresos ";

    &hpedido = 0;
    &hperson = 0;
    &hcopias = 0;
    &hfirmas = @;
    &hfallos = 0;
    demite1 = "";
    demite2 = "";
    demite3 = "";
    demite4 = "";
    demite5 = "";
    hemite1 = "";
    hemite2 = "";
    hemite3 = "";
    hemite4 = "";
    hemite5 = "";
    linea = 0;
    sw_imprime = 0;
    &marcados = 0;

     &aRutaExt = "";
     &aPathDestino = "";
     &aFichExt = "";
     &nContador = 0;
     &aPathLocFDF = "";

     aAlfa1 = "";
     {1}aContiene  = "";
     &eaDSMAC = "";

     aParam = "";
     swTodos = 0;
     nEstoyEn = 0;
     aFechaAlta = "";
     nMesAlta = 0;
     nAnyAlta = 0;
     aFechaBaja = "";
     nMesBaja = 0;
     nAnyBaja = 0;
     swSigue = 0;
     aFich = "";

     &enEmpLab = 0;
     &enTraLab = 0;
     &enMes = 0;
     &enAny = 0;
     swSal = 0;
     nTecla = 0;
|FIN;
____________________________________/
|PROCESO Masiva;
     |SI aRutaExt = "";
          || si los contratos ya estaban en el GAD, esta variable viene vacia
          || porque se asigna en el pdfimpre

          aAlfa = aPathDestino + "dsarchi/pdftk.exe ";
          aAlfa = aAlfa + aPathDestino + "contrato_?????_?????_U.pdf ";
          aAlfa = aAlfa + "cat output " + aPathDestino + "contratos_masivo.pdf";
          aRutaExt = aAlfa;
          aFichExt = aPathDestino + "contratos_masivo.pdf";
     |FINSI;

     |MENSA "    Realizando la union de todos los contratos en un PDF";
     |RSYSTEM aRutaExt;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     |RSYSTEM aFichExt;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     |MENSA "     ";
|FPRC;

|PROCESO impresion1;
     hpedido = #10#1;
     hperson = #10#8;
     hfallos = 0;

     |SI aParam = "C";
          |HAZ Contrato;
     |FINSI;
/*
     |SI aParam = "P";
          enEmpLab = #ettcontr#4;
          enTraLab = #10#5;
          enMes = #0#9;
          enAny = #0#10;
          |SUB_EJECUTA "ettempar";
     |FINSI;
*/
/*
|SI opcion1 = 1;    |SUB_EJECUTA "ettemcpd"; |FINSI;
|SI opcion1 = 2;    |SUB_EJECUTA "ettemcto"; |FINSI;
|SI opcion1 = 3;    |SUB_EJECUTA "ettempar"; |FINSI;
|SI opcion1 = 4;    |SUB_EJECUTA "ettemta2"; |FINSI;
|SI opcion1 = 5;    |SUB_EJECUTA "ettemtb2"; |FINSI;
|SI opcion1 = 6;    |SUB_EJECUTA "ettempro"; |FINSI;
|SI opcion1 = 7;    |SUB_EJECUTA "ettemjor"; |FINSI;
*/
|FPRC;

|DEFBUCLE impresion;
     #10#2;
     ;
     "***", 00001;
     "***", 99999;
     ;
     NULL, impresion1;
|FIN;

|PROCESO min;
/*
|SI FSalida = "POSICION";
        #10#0 = (((linea - (linea $ 10)) / 10) * 10) + 1;
|SINO;
        #10#0 = 1;
|FINSI;
*/
        #10#3 = 1;
|FPRC;

|PROCESO max;
    #10#3 = 9999;
|FPRC;

|PROCESO Borrador;
     |R_PDIR aAlfa;
     |SI FSalida = 0;
          |PARA; |SI FSalida = 0; |HACIENDO;
               aAlfa1 = aAlfa;
               |RFBORRA aAlfa1;
               |R_SDIR aAlfa;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO LimpiaSpoolPDF;
     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     aPathDestino = aContiene1;
     |QBF aPathDestino;
     aPathDestino = aPathDestino + "spoolpdf/";
     |RMKDIR aPathDestino;       || lo creo primero de nada, por si no hubiera

     aPathLocFDF = aPathDestino;  || aqui va la plantilla y el FDF local

     || borro restos de contratos anteriores,

     aAlfa = aPathLocFDF + "contrato*";
     |HAZ Borrador;
|FPRC;

|PROCESO cierra_tmp;
     |CIERRA #1;
     |CIERRA #3;
     |CIERRA #4;
     |CIERRA #10;

     |PUSHV 0501 2380;
     |PINPA #0#10;
/*
     |ATRI R;
     |PINTA 0618, alfa1;
     |ATRI 0;
*/
     sw_imprime = 0;
     |HAZ pinta_marcados;
     swSal = 0;
     |PARA; |SI; |HACIENDO;
          |ENTLINEAL #1#10, 1, 4, 22, 0, min, max;
          |SI sw_imprime = 0;
               |CONFI "    S¿Desea salir del lineal de trabajadores?";
          |FINSI;
          |SI FSalida = 0; |O sw_imprime = 1;
               swSal = 1;
               |SAL;
          |FINSI;
     |SIGUE;
     |POPV;
     nContador = 0;

     |SI sw_imprime = 1;
          |SI aParam = "C";
               |HAZ LimpiaSpoolPDF;
               |BUCLE impresion;

               |SI marcados > 1;
                    |HAZ Masiva;
               |FINSI;
          |FINSI;

          |SI aParam = "P";
               enEmpLab = #ettcontr#4;
               enMes = #0#9;
               enAny = #0#10;
               |SUB_EJECUTA "ettempar";
          |FINSI;
     |FINSI;

     |DELINDEX #10;
|FPRC;

|PROCESO pinta_marcados;
     alfa1 = marcados;  alfa1 = ("    " + marcados) % -104;
     |ATRI S;   |PINTA 1018, alfa1; |ATRI 0;
|FPRC;

|PROCESO Todos;
     |SI swTodos = 1;
          #10#9 = "***";
          marcados = marcados + 1;
     |SINO;
          #10#9 = "   ";
          marcados = 0;
     |FINSI;
     |GRABA 000#10a;
     |PINTA #10#9;
|FPRC;

|DEFBUCLE Todos;
     #10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Todos;
|FIN;

|PROCESO Marca; |TIPO 0;
     nTecla = FSalida;
     |SI FSalida = 9;
     |O FSalida = 13;
     |O FSalida = 0;
          |SI #10#9 = "***";
               #10#9 = "   ";
               marcados = marcados - 1;
          |SINO;
               #10#9 = "***";
               marcados = marcados + 1;
          |FINSI;
          |GRABA 000#10a;
          |PINTA #10#9;
          |HAZ pinta_marcados;
     |FINSI;
     |SI FSalida = 14;
          marcados = 0;
          nEstoyEn = #10#3;
          |SI swTodos = 0;
               swTodos = 1;
          |SINO;
               swTodos = 0;
          |FINSI;
          |BUCLE Todos;
          #10#3 = nEstoyEn;
          |LEE 000#10=;
          |PONCONTROL 23, "si";
          |HAZ pinta_marcados;
     |FINSI;
     |SI FSalida = 10;
          |SI marcados > 0;
               sw_imprime = 1;
               |PTEC 807;
          |SINO;
               |MENAV "      No hay ningun registro marcado para imprimir ...";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tipo11; |TIPO 11;
     |HAZ Marca;
|FPRC;

|PROCESO CompruebaFechas;
     aFechaAlta = #labtraba#36;
     aAlfa = aFechaAlta % 402;
     nMesAlta = aAlfa;
     aAlfa = aFechaAlta % -104;
     nAnyAlta = aAlfa;

     aFechaBaja = #labtraba#37;
     |QBF aFechaBaja;
     |SI aFechaBaja = ""; |O aFechaBaja = "..........";
          aFechaBaja = "";
     |SINO;
          aAlfa = aFechaBaja % 402;
          nMesBaja = aAlfa;
          aAlfa = aFechaBaja % -104;
          nAnyBaja = aAlfa;
     |FINSI;

     swSigue = 0;
     |SI nAnyAlta < #0#10;
          swSigue = 1;
     |FINSI;
     |SI nAnyAlta = #0#10;
          |SI nMesAlta [ #0#9;
               swSigue = 1;
          |FINSI;
     |FINSI;

     |SI aFechaBaja = "";
          swSigue = swSigue + 1;
     |SINO;
          |SI nAnyBaja > #0#10;
               swSigue = swSigue + 1;
          |FINSI;
          |SI nAnyBaja = #0#10;
               |SI nMesBaja ] #0#9;
                    swSigue = swSigue + 1;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO graba_tmp;
     |DDEFECTO #1;  #1#0 = #2#0;   |LEE 020#1=;   || lee pedidos cabs.
     |DDEFECTO #3;  #3#0 = #1#2;   |LEE 020#3=;   || lee cliente
     |DDEFECTO #4;  #4#0 = #2#2;   |LEE 020#4=;   || lee personal

     |DDEFECTO #labtraba;
     #labtraba#0 = #ettcontr#4;
     #labtraba#1 = #2#24;
     |LEE 000#labtraba.=;

     || compruebo segun las fechas de alta y baja si he de imprimir partes
     || cuando pida los partes claro

     |SI aParam = "P";
          swSigue = 0;
          |HAZ CompruebaFechas;
          |SI swSigue ! 2;
               |ACABA;
          |FINSI;
     |FINSI;

     linea = linea + 1;
     |DDEFECTO #10;
     #10#0 = linea;       || guia
     #10#1 = #2#0;        || pedido
     #10#2 = #1#1;        || fecha pedido
     #10#3 = #2#2;        || codigo trabajador
     #10#4 = #1#2;        || codigo cliente
     #10#5 = #2#24;       || codigo AGINOM
     #10#6 = #4#2;        || nombre trabajador
     #10#7 = #3#1;        || nombre cliente
     #10#8 = #2#1;        || linea pedido
     #10#9 = "   ";       || seleccionado S/N
     #10#10 = #labtraba#36;
     #10#11 = #labtraba#37;

|| |SI opcion2 = 1;    #10#9 = "<*>"; marcados = linea;   |FINSI;
|||SI opcion2 = 2;    #10#9 = "<->"; marcados = 0;       |FINSI;
     |GRABA 020#10n;
     /*
     |SI FSalida = 0;
          seleccio = 1;
     |FINSI;
     */
|FPRC;

|PROCESO abre_tmp;
     linea = 0;
     seleccio = 0;
     alfa1 = Usuario;     |QBT alfa1;
     |NOME_DAT #10 alfa1;
     |DELINDEX #10;
     |ABRE #1;
     |ABRE #3;
     |ABRE #4;
     |ABRE #10;
|FPRC;

|DEFBUCLE seleccion;     || codigo aginom, seleccionado S/N, impresos S/N
     #2#1;
     || 24, 27, 28, 29, 30, 31, 32;
     || #0#8,     1,     1, "S", demite1, demite2, demite3, demite4, demite5;
     || #0#8, 99999, 99999, "S", hemite1, hemite2, hemite3, hemite4, hemite5;
     ;
     #0#8, 00001;
     #0#8, 99999;
     ;
     NULL, graba_tmp;
|FIN;

|PROCESO selecciona;
/*
     demite1 = " ";   hemite1 = "z";
     demite2 = " ";   hemite2 = "z";
     demite3 = " ";   hemite3 = "z";
     demite4 = " ";   hemite4 = "z";
     demite5 = " ";   hemite5 = "z";
     |SI opcion2 = 1;         || imprimir
          |SI opcion1 = 1;     demite1 = "N"; hemite1 = "N"; |FINSI;
          |SI opcion1 = 2;     demite3 = "N"; hemite3 = "N"; |FINSI;

     |SI opcion1 = 2;     demite2 = "N"; hemite2 = "N"; |FINSI;
     |SI opcion1 = 3;     demite3 = "N"; hemite3 = "N"; |FINSI;
     |SI opcion1 = 4;     demite4 = "N"; hemite4 = "N"; |FINSI;
     |SI opcion1 = 5;     demite5 = "N"; hemite5 = "N"; |FINSI;

     |FINSI;
     |SI opcion2 = 2;         || reimprimir
          |SI opcion1 = 1;     demite1 = "S"; hemite1 = "S"; |FINSI;
          |SI opcion1 = 2;     demite3 = "S"; hemite3 = "S"; |FINSI;

    |SI opcion1 = 2;     demite2 = "S"; hemite2 = "S"; |FINSI;
    |SI opcion1 = 3;     demite3 = "S"; hemite3 = "S"; |FINSI;
    |SI opcion1 = 4;     demite4 = "S"; hemite4 = "S"; |FINSI;
    |SI opcion1 = 5;     demite5 = "S"; hemite5 = "S"; |FINSI;
     |FINSI;
*/

     |HAZ abre_tmp;
     |ABRE #ettcontr; |LEE 000#ettcontr.p; |CIERRA #ettcontr;
     |ABRE #labtraba;
     |BUCLE seleccion;
     |CIERRA #labtraba;
     |HAZ cierra_tmp;
|FPRC;

|PROCESO Tipo8; |TIPO 8;
     |CAMPO_ANCHO #ettpedi1#104, 1, 42;
|FPRC;

|PROCESO PintaCliente;
     #0#11 = #0#2;
     |PINTA #0#11;

     |ABRE #ettclien;
     #ettclien#0 = #0#11;
     |LEE 000#ettclien.=;
     #0#12 = #ettclien#1;
     |PINTA #0#12;
     |CIERRA #ettclien;
|FPRC;

|PROCESO RutasOtrasAp;
     || el programa esta linkado a la ett, pongo esto, para hacer los PATH_DAT
     |DBASS aFich;
     |QBF aFich;
     aFich = aFich + "laboral/fich/";
     |PATH_DAT #labtraba#aFich#;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;
     |QBF aParam;
     |CLS;
     |PINPA #0#0;

     |ABRE #0;
     |DDEFECTO #0;
     |LEE 000#0p;
     |SI FSalida = 0;
          |BORRA 020#0a;
     |FINSI;

     |PINDA #0#0;

     |SI aParam = "C";
          |CABEZA "EMISION DE CPDs";
          |ATRI R;
          |PINTA 0518, " EMISION DE CONTRATOS DE PUESTA A DISPOSICION ";
          |ATRI 0;

          |CAMPO_MODIFICA #0#3, 1, "N";
          |CAMPO_MODIFICA #0#9, 1, "N";
          |CAMPO_MODIFICA #0#10, 1, "N";

          |CAMPO_VISUAL #0#3, 1, "N";
          |CAMPO_VISUAL #0#9, 1, "N";
          |CAMPO_VISUAL #0#10, 1, "N";

          |PINTA 1005, "                                          ";
          |PINTA 1103, "ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";
          |PINTA 1203, "                                                                            ";
          |PINTA 1303, "                                                                            ";
     |FINSI;
     |SI aParam = "P";
          |CABEZA "EMISION DE PARTES";
          |ATRI R;
          |PINTA 0521, " EMISION DE PARTES DE HORAS DE TRABAJO ";
          |ATRI 0;

          |CAMPO_MODIFICA #0#9, 1, "S";
          |CAMPO_MODIFICA #0#10, 1, "S";

          |CAMPO_VISUAL #0#9, 1, "S";
          |CAMPO_VISUAL #0#10, 1, "S";

          |PINTA 1105, "Periodo emisi¢n partes:    /             ";

          |PINTA #0#9;
          |PINTA #0#10;
     |FINSI;

     |ENDATOS #1#0;

     |SI FSalida = 0;
          hfirmas = #0#0;
          |SI aParam = "C";
               hcopias = #0#1;
          |SINO;
               hcopias = #0#3;
          |FINSI;
          opcion1 = 0;
          opcion2 = 0;

          |HAZ selecciona;
     |FINSI;

     |GRABA 000#0n;
     |CIERRA #0;

/*
          |PARA; |SI; |HACIENDO;
               |ATRI R;    |MENSA "    Eliga Impreso";   |ATRI 0;
               |MENUG menu;
               opcion1 = FSalida;
               |SI opcion1 ] 1;|Y opcion1 [ 2;
                    |ATRI R;
                    |PINTA 1421, "   ";
                    |PINTA 1521, "   ";
                    |ATRI 0;
                    menu2 = opcion1;
                    hfirmas = #0#0;
                    |SI aParam = "C";
                         hcopias = #0#1;
                    |SINO;
                         hcopias = #0#3;
                    |FINSI;
                    opcion2 = 0;

                    |HAZ selecciona;
                    |SI opcion1 ! 6;|Y opcion1 ! 7;
                         |PARA; |SI; |HACIENDO;
                              |HAZ selecciona;

                              |ATRI R;     |MENSA "    Eliga Metodo";   |ATRI 0;
                              |MENU submenu;
                              |ATRI R;     |BLIN 4;                     |ATRI 0;
                              opcion2 = FSalida;
                              |SI opcion2 ] 1;|Y opcion2 [ 2;
                                   submenu2 = opcion2;
                                   |HAZ selecciona;
                              |SINO;
                                   |SAL;
                              |FINSI;
                         |SIGUE;
                    |SINO;
                         |HAZ selecciona;
                    |FINSI;
               |SINO;
                    |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;
*/
|FPRO;
