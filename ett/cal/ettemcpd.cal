|FICHEROS;
    ettemcpd #0;    || emision cpd
    ettpedi1 #1;    || pedidos cabs.
    ettpedi2 #2;    || pedidos lins.

    labempre #10;   || empresas AGINOM
    labtraba #12;   || trabajadores AGINOM
    ettcontr #13;   || control AGIETT
    ettclien #14;   || clientes AGIETT
    ettprovi #15;   || provincias AGIETT
    ettperso #16;   || personal AGIETT
    ettpuest #17;   || puestos AGIETT
    etttarca #18;   || tarifas cabs. AGIETT
    asfpagos #19;   || formas de pago FACGES
    asbancli #20;   || bancos clientes FACGES
    ettemct1;
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;

    &hpedido = 0;
    &hperson = 0;
    &hcopias = 0;
    &hfirmas = @;
    &hfallos = 0;
    informe = "";
    &fpago = "";
    &banco = "";
    &finaliza = "";
    &supuesto1 = "";
    &supuesto2 = "";
    &supuesto3 = "";
    &supuesto4 = "";
    &titulo1   = "";
    &Comodin   = "";
    &aVengode = "";
    &aFechaFin = "";
    &aTipoIndem = "";
|FIN;
____________________________________/
|PROCESO informes;
|SI hfallos = 0;         || si da error algun informe no continua
    |INFOR informe;
    |SI FSalida = 0;
        |PRINT;
        |PIEINF;
            #2#28 = "S"; || impreso SI
        |GRABA 020#2a;
    |SINO;
            alfa1 = "    AVISO: Problemas con el informe [" + informe + "] ...";
        |MENAV alfa1;
            hfallos = 1;
    |FINSI;
    |FININF;
|FINSI;
|FPRC;

|PROCESO pedidos_lins;
    supuesto1 = #1#74 % 170;  supuesto2 = #1#74 % -150;
    supuesto3 = #1#75 % 170;  supuesto4 = #1#75 % -150;

    hfallos = 0;
     || ESTO ES NUEVO PARA METER LOS ULTIMOS CAMPOS PEDIDOS
    |MODULO aVengode;
    aFechaFin = #0#7;
    |SI #2#57 = "H";
        aTipoIndem = "Hora";
    |SINO;
        aTipoIndem = "Mes";
    |FINSI;
    Comodin = "ettemct1.tab;" + #13#3 + "," + #13#4 + "," + #2#24; |SUB_EJECUTA_NP Comodin;
    |ABRE #ettemct1;
    #ettemct1#5 = #13#4;
    #ettemct1#6 = #2#24;
    |LEE 000#ettemct1.=;
    hfallos = 0;

|PARA para1 = 1; |SI para1 [ hcopias; |HACIENDO para1 = para1 + 1;
        informe = "ett01cpd"; |HAZ informes;
        informe = "ett02cpd"; |HAZ informes;
        informe = "ett03cpd"; |HAZ informes;
        informe = "ett04cpd"; |HAZ informes;
        informe = "ett05cpd"; |HAZ informes;
|SIGUE;
|FPRC;

|PROCESO lectura_varios;
 |SI #2#35 = "H" ; titulo1 = "a la hora  "; |FINSI;
 |SI #2#35 = "S" ; titulo1 = "a la semana"; |FINSI;
 |SI #2#35 = "M" ; titulo1 = "al mes     "; |FINSI;
|DDEFECTO #10;
|ABRE #10;
    #10#0 = #13#4;
|LEE 000#10=;            || lee empresas AGINOM
|CIERRA #10;

|DDEFECTO #12;
|ABRE #12;
    #12#0 = #13#4;
    #12#1 = #2#24;
|LEE 000#12=;            || lee trabajadores AGINOM
|CIERRA #12;

|SI #1#6 = "00.00.0000"; #1#6 = "01.01.1900"; |FINSI;  || error en AGISYS-V
    fech1 = #1#6 % 2;
    alfa1 = fech1;
    alfa1 = alfa1 % 11;
    finaliza = "hasta el " + alfa1;
|SI #12#45 = "14";  finaliza = "hasta el t‚rmino de la obra o servicio.";   |FINSI;
|SI #12#45 = "16";  finaliza = "hasta la incorporaci¢n del trabajador sustituido."; |FINSI;

|DDEFECTO #14;
|ABRE #14;
    #14#0 = #1#2;
|LEE 000#14=;            || lee cliente AGIETT
|CIERRA #14;

|DDEFECTO #15;
|ABRE #15;
    #15#0 = #14#5;
|LEE 000#15=;            || lee provincia AGIETT
|CIERRA #15;

|DDEFECTO #16;
|ABRE #16;
    #16#0 = #2#2;
|LEE 000#16=;            || lee personal AGIETT
|CIERRA #16;

|DDEFECTO #17;
|ABRE #17;
    #17#0 = #1#59;
|LEE 000#17=;            || lee puestos AGIETT
|CIERRA #17;

|DDEFECTO #18;
|ABRE #18;
    #18#0 = #2#16;
    #18#1 = #2#17;
|LEE 000#18=;            || lee tarifa cabs. AGIETT
|CIERRA #18;

|DDEFECTO #19;
|ABRE #19;
    #19#0 = #14#26;
|LEE 000#19=;            || lee formas de pago FACGES
    fpago = #19#1;
|CIERRA #19;

|DDEFECTO #20;
|ABRE #20;
    #20#0 = #14#24;
|LEE 000#20=;            || lee bancos cliente FACGES
    banco = #20#1;
|CIERRA #20;
|FPRC;

|PROCESO tipo8;
|ABRE #13;
|LEE 000#13p;
|SI FSalida = 0;
        alfa1 = #13#3;    |QBF alfa1;
        alfa1 = alfa1 + "/fich/";
    |PATH_DAT #10 alfa1;
    |PATH_DAT #12 alfa1;

        alfa1 = #13#1;    |QBF alfa1;
        alfa1 = alfa1 + "/fich/";
        alfa2 = #13#2;    |QBF alfa2;   alfa2 = ("00" + alfa2) % -102;
        alfa1 = alfa1 + alfa2 + "/";
    |PATH_DAT #19 alfa1;
    |PATH_DAT #20 alfa1;
|SINO;
    |MENAV "    Control AGIETT sin definir ...";
|FINSI;
|CIERRA #13;
|FPRC;

|PROGRAMA;
    hfallos = 1;
|ABRE #1;
|ABRE #2;
    #1#0 = hpedido;
|LEE 020#1=;
|SI FSalida = 0;
        #2#0 = hpedido;
        #2#1 = hperson;
    |LEE 121#2=;
    |SI FSalida = 0;
        |HAZ tipo8;
        |HAZ lectura_varios;
        |DDEFECTO #0;
            #0#0 = #1#0;      || codigo pedido
            #0#1 = #1#1;      || fecha pedido
            #0#2 = #16#0;     || codigo trabajador
            #0#3 = #16#2;     || nombre trabajador
            #0#4 = #14#0;     || codigo cliente
            #0#5 = #14#1;     || nombre cliente
            #0#6 = #1#5;      || desde contrato
            #0#7 = #1#6;      || hasta contrato
            #0#8 = #17#0;     || codigo puesto
            #0#9 = #17#1;     || nombre puesto
        |PUSHV 0501 2380;
        |PINPA #0#0;
        |PINDA #0#0;
        |CONFI "    SConfirme la impresion (S/N): ";
        |PARA; |SI FSalida = 0; |HACIENDO;
            |IMPRE 0;
            |SI FSalida = 0;
                |ATRI P;
                |PINTA 2402, "Imprimiendo ...";
                |ATRI 0;
                |HAZ pedidos_lins;
            |SINO;
                |MENAV "    Proceso abortado ...";
            |FINSI;
            |FINIMP;
            |BLIN 24;
            |CONFI "    NRepetir la impresion (S/N): ";
        |SIGUE;
        |POPV;
    |FINSI;
    |LIBERA #2;
|FINSI;
|CIERRA #1;
|CIERRA #2;
|FPRO;
