|FICHEROS;
    ettemjor #0;    || emision prorrogas
    ettpedi1 #1;    || pedidos cabs.
    ettpedi2 #2;    || pedidos lins.
    ettparte #3;    || partes de horas cabs.
    ettparli #4;    || partes de horas lins.

    labempre #10;   || empresas AGINOM
    labtraba #12;   || trabajadores AGINOM
    ettcontr #13;   || control AGIETT
    ettclien #14;   || clientes AGIETT
    ettprovi #15;   || provincias AGIETT
    ettperso #16;   || personal AGIETT
    ettpuest #17;   || puestos AGIETT
    etttarca #18;   || tarifas cabs. AGIETT
    labregis #19;   || registro contratos AGINOM
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    nume5 = 0;
    nume6 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;

    &hpedido = 0;
    &hperson = 0;
    &hcopias = 0;
    &hfirmas = @;
    &hfallos = 0;

    informe = "";
    contador = 0;
    sw_repite = 0;
    &tipocambio = "";
    &contra = "";
    &pobla = "";
|FIN;
____________________________________/
|PROCESO mayus; |TIPO 0;
    #0Campo = #0Campo > #0Campo;
|PINTA #0Campo;

|SI #0#12 = "A";    tipocambio = "ampliaci¢n ";   |FINSI;
|SI #0#12 = "D";    tipocambio = "disminuci¢n";   |FINSI;
|FPRC;

|PROCESO def_hasta; |TIPO 7;
|SI #2#30 = "N";
        #0#7 = #0#6 + 0.001;       || fecha inicial mas 1 mes
|SINO;
        #0#7 = #2#33;              || fecha ultimo parte
|FINSI;
|PINTA #0#7;
|FPRC;

|PROCESO fec_hasta; |TIPO 0;
|SI #0#7 < #0#6;
    |MENAV "    La fecha final PROVISIONAL debera ser mayor o igual que la inicial ...";
    |ERROR;
|FINSI;
|SI #0#7 < #2#33;
    |MENAV "    La fecha final PROVISIONAL debera ser mayor o igual que la anterior ...";
        #0#7 = #2#33;
    |PINTA #0#7;
    |ERROR;
|FINSI;
|FPRC;
____________________________________/
|PROCESO informes;
|SI hfallos = 0;         || si da error algun informe no continua
    |INFOR informe;
    |SI FSalida = 0;
        |PRINT;
        |PIEINF;
    |SINO;
            alfa1 = "    AVISO: Problemas con el informe [" + informe + "] ...";
        |MENAV alfa1;
            hfallos = 1;
    |FINSI;
    |FININF;
|FINSI;
|FPRC;

|PROCESO imprime;
    seleccio = 1;
    hfallos = 0;
|PARA para1 = 1; |SI para1 [ hcopias; |HACIENDO para1 = para1 + 1;
        informe = "ett01jor"; |HAZ informes;
        informe = "ett02jor"; |HAZ informes;
|SIGUE;
|FPRC;

|PROCESO duracion;
    contra = "";
|SI #19#9 ! 0;
        contra = #19#9;
        contra = contra + " mes";
    |SI #19#9 > 1;
            contra = contra + "es";
    |FINSI;
|SINO;
        contra = "...........";
|FINSI;
|SI #19#10 ! 0;
    |SI #19#9 ! 0;
            contra = contra + " y ";
    |FINSI;
        contra = contra + #19#10;
        contra = contra + " dia";
    |SI #19#10 > 1;
            contra = contra + "s";
    |FINSI;
|SINO;
        contra = contra + "............";
|FINSI;
|FPRC;

|PROCESO lectura_varios;
|DDEFECTO #10;
|ABRE #10;
    #10#0 = #13#4;
|LEE 000#10=;            || lee empresas AGINOM
|CIERRA #10;
    pobla = #10#6;   |QBF pobla;
    pobla = "En " + pobla;
    alfa1 = " " * 30;
    pobla = (alfa1 + pobla) % -132;

|DDEFECTO #12;
|ABRE #12;
    #12#0 = #13#4;
    #12#1 = #2#24;
|LEE 000#12=;            || lee trabajadores AGINOM
|CIERRA #12;

|DDEFECTO #14;
|ABRE #14;
    #14#0 = #1#2;
|LEE 000#14=;            || lee cliente AGIETT
|CIERRA #14;

|DDEFECTO #15;
|ABRE #15;
    #15#0 = #14#5;
|LEE 000#15=;            || lee provincia AGIETT
|CIERRA #15;

|DDEFECTO #16;
|ABRE #16;
    #16#0 = #2#2;
|LEE 000#16=;            || lee personal AGIETT
|CIERRA #16;

|DDEFECTO #17;
|ABRE #17;
    #17#0 = #1#59;
|LEE 000#17=;            || lee puestos AGIETT
|CIERRA #17;

|DDEFECTO #18;
|ABRE #18;
    #18#0 = #2#16;
    #18#1 = #2#17;
|LEE 000#18=;            || lee tarifa cabs. AGIETT
|CIERRA #18;
|FPRC;

|PROCESO tipo8;
|ABRE #13;
|LEE 000#13p;
|SI FSalida = 0;
        alfa1 = #13#3;    |QBF alfa1;
        alfa1 = alfa1 + "/fich/";
    |PATH_DAT #10 alfa1;
    |PATH_DAT #12 alfa1;
    |PATH_DAT #19 alfa1;
|SINO;
    |MENAV "    Control AGIETT sin definir ...";
|FINSI;
|CIERRA #13;
|FPRC;

|PROCESO emite;
|ABRE #19;
|SELECT #1#19;
    #19#0 = contador;
|LEE 121#19=;
|SI FSalida = 0;
    |DDEFECTO #0;
        #0#0 = #1#0;     || codigo pedido
        #0#1 = #1#1;     || fecha pedido
        #0#2 = #16#0;    || codigo trabajador
        #0#3 = #16#2;    || nombre trabajador
        #0#4 = #14#0;    || codigo cliente
        #0#5 = #14#1;    || nombre cliente
        #0#6 = #1#5;     || desde contrato
        #0#7 = #1#6;     || hasta contrato
        #0#8 = #17#0;    || codigo puesto
        #0#9 = #17#1;    || nombre puesto
        #0#13 = #0#6;    || jornada desde
        #0#14 = #0#7;    || jornada hasta
    |PUSHV 0501 2380;
    |PINPA #0#0;
    |PINDA #0#0;
        sw_repite = 0;
    |ENDATOS #1#0;
        FEstado = FSalida;
    |PARA; |SI FEstado = 0; |HACIENDO;
        |IMPRE 0;
        |SI FSalida = 0;
            |ATRI P;
            |PINTA 2402, "Imprimiendo ...";
            |ATRI 0;
            |HAZ imprime;
        |SINO;
            |MENAV "    Proceso abortado ...";
        |FINSI;
        |FINIMP;
            sw_repite = 1;
        |BLIN 24;
        |CONFI "    NRepetir la impresion (S/N): ";
            FEstado = FSalida;
    |SIGUE;
    |POPV;
|FINSI;
|LIBERA #19;
|CIERRA #19;
|FPRC;

|PROCESO lee_registro;
    contador = -1;
|ABRE #19;
|SELECT #2#19;
    #19#1 = #13#4;
    #19#2 = #2#24;
|LEE 000#19=;
|SI FSalida = 0;
    |SI #19#8 ! "..........";|Y #19#8 ! "          ";
            contador = #19#0;
    |SINO;
            contador = -2;
    |FINSI;
|FINSI;
|CIERRA #19;
|FPRC;

|PROGRAMA;
    hfallos = 1;
|ABRE #1;
|ABRE #2;
|ABRE #3;
|ABRE #4;
    #1#0 = hpedido;
|LEE 020#1=;                       || lee pedido cabs.
|SI FSalida = 0;
        #2#0 = hpedido;
        #2#1 = hperson;
    |LEE 121#2=;                   || lee pedido lins.
    |SI FSalida = 0;
        |HAZ tipo8;                || lee control y cambia path's
        |HAZ lectura_varios;       || lee resto ficheros
        |HAZ lee_registro;         || lee registro contratos
        |SI contador > -1;         || si existe contrato inicial
            |HAZ duracion;         || literal dias duracion
            |HAZ emite;            || emite los documentos
        |SINO;
            |SI contador = -1;
                    alfa1 = "    Trabajador:["+#12#0+"]-["+#12#1+"] sin contrato inicial registrado.";
            |FINSI;
            |SI contador = -2;
                    alfa1 = "    Trabajador:["+#12#0+"]-["+#12#1+"] sin fecha final en contrato inicial.";
            |FINSI;
            |MENAV alfa1;
        |FINSI;
    |FINSI;
    |LIBERA #2;
|FINSI;
|CIERRA #1;
|CIERRA #2;
|CIERRA #3;
|CIERRA #4;
|FPRO;
