|FICHEROS;
     dsm30301;
     dsm30302;
     dsm30303;
     dsm30304;
     dsm30305;

     dsmod303;
     dsmod310;
     dsmod370;
     dsmom103;

     dsmom004;
     dsmom008;
     dsmom016;
     dsmom017;
     dsmom019;
     dsmom028;
     dsmom047;
     dsmom085;
     dsmom086;
     dsmom087;
     dsmom033;
     dsmom133;

     dsmociva;
     dsmocivp;
     dsmoc310;
     dsmoc311;

     dsmow205;
     dsmow224;
     dsmow227;
     dsmow206;
     dsmow207;
     dsmow208;
     dsmow209;
     dsmow210;
     dsmow212;
     dsmow213,MANTE;

     dsmow220,MANTE;
     dsmow221,MANTE;
     dsmow222,MANTE;
     dsmow223,MANTE;

     :basica/agicen14;
     :basica/agicen30;

     &clientes@;
     dsm30301@;
     espejo@;
|FIN;

|VARIABLES;
     aEsc                = "";
     aRetu               = "";
     aTecla              = "";
     aEsc1               = "";
     aEsc2               = "";
     aAlfa               = "";
     aAlfa1              = "";
     aOrigen             = "";
     aDestino            = "";
     aDocServidor        = "";
     aDocRemoto          = "";
     aIPRemoto           = "";
     aEjecuta            = "";
     aBase               = "";
     aRutaOrigen         = "";
     aRutaDestino        = "";
     aFicheroTar         = "";
     aFicheroTxt         = "";
     aFicheroTgz         = "";
     aAbre               = "";
     aBuscar             = "";
     aRefresca           = "";
     aMas                = "";
     aGuardo8            = "";
     aGuardo9            = "";
     aGuardo12           = "";
     aGuardo13           = "";
     aGuardo14           = "";
     aGuardo15           = "";
     nGuardo76           = 0;
     nGuardo77           = 0;
     aGuardo130          = "";
     aGuardo131          = "";
     aGuardo132          = "";
     aGuardo144          = "";
     nVentana            = 0;
     nVentTrab           = -1;
     nRango              = 0;
     nModo               = 0;
     nHandle             = 0;
     nHandleTgz          = 0;
     nLinea              = 0;
     nPanta303           = 0;
     nPanta205           = -1;
     nPanta224           = -1;
     nPanta227           = -1;
     nPanta212           = -1;
     nPanta213           = -1;
     nPanta220           = -1;
     nPanta221           = -1;
     nPanta222           = -1;
     nPanta223           = -1;
     nPintaSalir         = 0;
     nEjerAnt            = 0;
     nAnyo               = 0;
     nPer                = 0;
     nPro                = 0;
     nContador           = 0;
     nIVA1               = 0;
     nIVA2               = 0;
     nIVA3               = 0;
     nIVA4               = 0;
     nIVA5               = 0;
     nIVA6               = 0;
     nLSimpl             = 0;
     nLRGral             = 0;
     nLRGral99           = 0;
     nBaseMas            = 0;
     nCuotaMas           = 0;
     nCampo1             = 0;
     nCampo2             = 0;
     nCampo3             = 0;
     nCampo11            = 0;
     nCampo22            = 0;
     nCampo33            = 0;
     nUltEpi             = 0;
     nDesde              = 0;
     nHasta              = 0;
     nSwAcum             = 0;
     nIVA                = 0;
     nTotal              = 0;
     nTotal303           = 0;
     nNegativo           = 0;
     nNegativoC          = 0;
     nNegativoD          = 0;
     nNegativoI          = 0;
     nHComple            = 0;
     nCampo              = 0;
     nFactor             = 0;
     nNume               = 0;
     nNume1              = 0;
     nNume2              = 0;
     nNume3              = 0;
     nNume4              = 0;
     nRes                = 0;
     nUni1               = 0;
     nUni2               = 0;
     nUni3               = 0;
     nUni4               = 0;
     nUni5               = 0;
     nUni6               = 0;
     nUni7               = 0;
     nUni8               = 0;
     nUni9               = 0;
     nBtn8               = 0;
     nBtn9               = 0;
     nBtn12              = 0;
     nBtn13              = 0;
     nBtn131             = 0;
     nBtn132             = 0;
     nBtn14              = 0;
     nBtn15              = 0;
     nBtn151             = 0;
     nBtn152             = 0;
     nBtnVal             = 0;
     nBtnCan             = 0;
     nBtnMod213          = 0;
     nBtnMod220          = 0;
     nBtnMod221          = 0;
     nBtnMod222          = 0;
     nBtnMod223          = 0;

     nTree               = -1;
     nGrid02             = -1;
     nGrid03             = -1;
     nGrid04             = -1;
     nIdSalir            = -1;
     nDCampo             = 0;
     nHCampo             = 0;
     nModAnter           = 0;
     nPeriodoMin         = 0;

     fFecha              = @;
     nEstado             = 0;
     nOpera              = 0;
     nOk                 = 0;
     nSw                 = 0;
     aCNAE               = "";
     nQuants             = 0;
     nPrim               = 0;
     nDepar              = 0;
     nTpComun            = 0;
     nPeriodo            = 0;
     nSector             = 0;
     nM                  = 0;
     nTp100a             = 0;

     {2}nNivel           = 0;

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     {-1}sTree           = 0;
         sT_nID          = 0;
         sT_nOper        = 0;
         sT_aData        = "";

     nImporte1 = 0;
     nImporte2 = 0;

     &eaUnidadBasico     = "";
     &eMensa             = 0;
     &enNoMod390         = 0;
|FIN;

|INCLUYE i_variar;


|| ..........Todo Lineal de Prorratas y grupos

|PROCESO grupos123;
     |SI #dsmociva#7 = 0; |O #dsmociva#7 = 12; |ACABA; |FINSI;

     nSector = 1;
     nTp100a  = 100;
     #dsmom086#0 = #dsmociva#0;
     #dsmom086#1 = #dsmociva#1;
     #dsmom086#2 = #dsmociva#5;  ||Actividad
     |LEE 041#dsmom086.=;
     |SI FSalida = 0;
         nSector = #dsmom086#15;
         nTp100a = #dsmom086#6;
     |FINSI;
     |SI nSector > 2; nSector = 2; |FINSI;

     #dsmom087#0 = #dsmociva#0;
     #dsmom087#1 = #dsmociva#1;
     #dsmom087#2 = #dsmociva#2;
     #dsmom087#3 = #dsmociva#3;
     #dsmom087#4 = #dsmociva#4;
     #dsmom087#5 = #dsmociva#5;
     #dsmom087#6 = #dsmociva#6;
     #dsmom087#7 = #dsmociva#7;
     |LEE 041#dsmom087.=;
     |SI FSalida = 0;
         #dsmociva#13 = (#dsmom087#12 % nTp100a) ! 2 + (#dsmom087#37 % nTpComun) ! 2;  ||la actividad
     |FINSI;

     |SI #dsmociva#12 ! 0;  |O #dsmociva#13 ! 0;
         nQuants = 1;
         #dsm30305#0 = #dsm30301#0;
         #dsm30305#1 = #dsm30301#1;
         #dsm30305#2 = #dsm30301#3;
         #dsm30305#3 = #dsm30301#4;
         #dsm30305#4 = nSector;
         |LEE 101#dsm30305.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsm30305;
             #dsm30305#0 = #dsm30301#0;
             #dsm30305#1 = #dsm30301#1;
             #dsm30305#2 = #dsm30301#3;
             #dsm30305#3 = #dsm30301#4;
             #dsm30305#4 = nSector;
             |GRABA 020#dsm30305.b;
         |FINSI;
         nCampo1 = 0;
         |SI #dsmociva#7 = 1;  nCampo1 =  5; |FINSI;
         |SI #dsmociva#7 = 14; nCampo1 =  5; |FINSI;
         |SI #dsmociva#7 = 2;  nCampo1 =  7; |FINSI;
         |SI #dsmociva#7 = 15; nCampo1 =  7; |FINSI;
         |SI #dsmociva#7 = 3;  nCampo1 =  9; |FINSI;
         |SI #dsmociva#7 = 4;  nCampo1 = 11; |FINSI;
         |SI #dsmociva#7 = 5;  nCampo1 = 13; |FINSI;
         |SI #dsmociva#7 = 13; nCampo1 = 13; |FINSI;
         |SI #dsmociva#7 = 6;  nCampo1 = 15; |FINSI;
         |SI #dsmociva#7 = 7;  nCampo1 = 17; |FINSI;
         |SI #dsmociva#7 = 8;  nCampo1 = 19; |FINSI;
         |SI #dsmociva#7 = 17; nCampo1 = 19; |FINSI;
         |SI #dsmociva#7 = 16; nCampo1 = 19; |FINSI;
         |SI #dsmociva#7 = 9;  nCampo1 = -1; nCampo2 = 21; |FINSI;

         |SI nCampo1 ! 0;
             |SI nCampo1 ! -1;
                 nCampo2 = nCampo1 + 1;
                 #dsm30305#nCampo1# = #dsm30305#nCampo1# + #dsmociva#12;
             |FINSI;
             #dsm30305#nCampo2# = #dsm30305#nCampo2# + #dsmociva#13;
         |FINSI;

         #dsm30305#22 = #dsm30305#6  + #dsm30305#8  + #dsm30305#10 + #dsm30305#12 + #dsm30305#14 + #dsm30305#16;
         #dsm30305#22 = #dsm30305#22 + #dsm30305#18 + #dsm30305#20 + #dsm30305#21;

         |GRABA 020#dsm30305.a;
         |LIBERA #dsm30305;
     |FINSI;
     |LIBERA #dsmociva;
|FPRC;

|DEFBUCLE dsmociva_grupo;
     #dsmociva#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 01, 2,  0;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 98, 2, 99;
     be;
     NULL, grupos123;
|FIN;

|PROCESO PaseGrupos123;
     nQuants = 0;

     |ABRE #dsm30305;
     |ABRE #dsmom086;
     |ABRE #dsmom087;
     |ABRE #dsmom004;
     |PARA nPeriodo = 1; |SI nPeriodo [ 12;  |HACIENDO nPeriodo = nPeriodo + 1;
           #dsmom004#0   = #dsm30301#0;
           #dsmom004#1   = #dsm30301#1;
           #dsmom004#2   = nPeriodo;
           #dsmom004#3   = 303;
           #dsmom004#4   = 99;
           |LEE 000#dsmom004.];
           |SI FSalida = 0;
               |LEE 000#dsmom004.a;
           |SINO;
               |LEE 000#dsmom004.u;
           |FINSI;

           |SI FSalida = 0;  |Y #dsmom004#0 = #dsm30301#0;      |Y #dsmom004#1 = #dsm30301#1;
                             |Y #dsmom004#2   = nPeriodo;  |Y #dsmom004#3 = 303;
                   nM = 303;
                   |BUCLE dsmociva_grupo;
           |FINSI;
     |SIGUE;

     |CIERRA #dsmom004;
     |CIERRA #dsmom087;
     |CIERRA #dsmom086;
     |CIERRA #dsm30305;
|FPRC;

|PROCESO Leem086;
       nDepar = #dsmom086#2;

|| ... |SI enAdTodas = 1; |Y #dsmom086#6 = 100; |ACABA; |FINSI; esto solo 390

       nLinea = nLinea + 1;
       |DDEFECTO #dsm30304;
       #dsm30304#0 = enEmpresa;
       #dsm30304#1 = enEjer;
       #dsm30304#2 = #dsm30301#3;
       #dsm30304#3 = #dsm30301#4;
       #dsm30304#4 = nDepar;
       |LEE 101#dsm30304.=;
       |SI FSalida ! 0;
           |SELECT #1#dsm30304;
           |DDEFECTO #dsm30304;
           #dsm30304#0 = enEmpresa;
           #dsm30304#1 = enEjer;
           #dsm30304#2 = #dsm30301#3;
           #dsm30304#3 = #dsm30301#4;
           #dsm30304#4 = nDepar;
           #dsm30304#5 = #dsmom086#3;
           #dsm30304#6 = #dsmom086#4;
           #dsm30304#11 = nLinea;
           |GRABA 020#dsm30304.b;
       |FINSI;
       |SI aCNAE = ""; |Y #dsmom086#4 ! "     ";
           aCNAE = #dsmom086#4;
       |FINSI;
       |SI aCNAE ! ""; |Y #dsmom086#4 = "     ";
           #dsmom086#4 = aCNAE;
       |FINSI;

       #dsm30304#7  = #dsmom086#9;  || Totales
       #dsm30304#8  = #dsmom086#7;  || Con derecho a deducir
       #dsm30304#9  = #dsmom085#4;  || tipo prorrata
       #dsm30304#10 = #dsmom086#6;  || % prorrata

       |SI #dsm30304#10 = 100; |Y #dsm30304#9 = "G";
           #dsm30304#7  = 0;  || Totales
           #dsm30304#8  = 0;  || Con derecho a deducir
       |FINSI;

       |GRABA 020#dsm30304.a;
       |LIBERA #dsm30304;

       nQuants = nQuants + 1;
       |SI nPrim = 0; nPrim = #dsmom086#2; |FINSI;
|FPRC;

|DEFBUCLE Leem086;
   #dsmom086#1;
   ;
   #dsmom085#0, #dsmom085#1, 01;
   #dsmom085#0, #dsmom085#1, 98;
   e;
   NULL, Leem086;
|FINSI;

|PROCESO CreaLinProrrata;
   aCNAE = "";
   |ABRE #dsmom085;
   #dsmom085#0 = enEmpresa;
   #dsmom085#1 = enEjer;
   |LEE 040#dsmom085.=;
   |SI FSalida ! 0;
       |CIERRA #dsmom085;
       |ACABA;
   |FINSI;
   |CIERRA #dsmom085;
   |SI #dsmom085#4 = "N"; |ACABA; |FINSI;

   nTpComun = #dsmom085#17;
   nQuants = 0;
   nPrim   = 0;
   |ABRE #dsm30304;
   |BUCLE Leem086;
   |CIERRA #dsm30304;

   |SI #dsmom085#4 = "G"; |Y #dsmom085#5 = 100;
       |ACABA;
   |FINSI;

   |SI nQuants ! 0;
       |HAZ PaseGrupos123;
   |FINSI;
|FPRC;

|PROCESO EjerAnt;
      nEjerAnt = nEjerAnt + #dsmom103#5;
|FPRC;

|DEFBUCLE dsmom103;
     #dsmom103#1;
     ;
     enModelo, enEmpresa, 00, nAnyo, nPer;
     enModelo, enEmpresa, 99, nAnyo, nPer;
     ;
     NULL, EjerAnt;
|FIN;

|PROCESO LeeComplem;
     |SI nModAnter = 303; nEjerAnt = #dsmod303#61; |FINSI;
     |SI nModAnter = 310; nEjerAnt = #dsmod310#38; |FINSI;
     |SI nModAnter = 370; nEjerAnt = #dsmod370#84;  |FINSI;
|FPRC;

|DEFBUCLE LeeCompl303;
     #dsmod303#1;
     ;
     enEmpresa, #dsmom004#1, #dsmom004#2, nModAnter, 00, 00;
     enEmpresa, #dsmom004#1, #dsmom004#2, nModAnter, 99, 00;
     ;
     NULL, LeeComplem;
|FIN;

|DEFBUCLE LeeCompl310;
     #dsmod310#1;
     ;
     enEmpresa, #dsmom004#1, #dsmom004#2, nModAnter, 00, 00;
     enEmpresa, #dsmom004#1, #dsmom004#2, nModAnter, 99, 00;
     ;
     NULL, LeeComplem;
|FIN;

|DEFBUCLE LeeCompl370;
     #dsmod370#1;
     ;
     enEmpresa, #dsmom004#1, #dsmom004#2, nModAnter, 00, 00;
     enEmpresa, #dsmom004#1, #dsmom004#2, nModAnter, 99, 00;
     ;
     NULL, LeeComplem;
|FIN;

|PROCESO LeeComplem30301;
     nEjerAnt = #dsm30301#89;
|FPRC;

|DEFBUCLE LeeCompl30301;
     #dsm30301#1;
     ;
     enEmpresa, #dsmom004#1, #dsmom004#2, nModAnter, 00, 00;
     enEmpresa, #dsmom004#1, #dsmom004#2, nModAnter, 99, 00;
     ;
     NULL, LeeComplem30301;
|FIN;

|PROCESO RecogeAnter;
     nPeriodoMin = 1;

     |ABRE #dsmom004;
     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = enEjer;
     #dsmom004#2 = enPeriodo;
     #dsmom004#3 = enModelo;
     #dsmom004#4 = enComplem;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;

     |SI #dsmom004#22 = "M";
         nPeriodoMin = 1;
     |SINO;
         nPeriodoMin = 3;
     |FINSI;

     |SI enPeriodo = nPeriodoMin;
         nAnyo     = enEjer - 1;
         nPer      = 12;
     |SINO;
         nAnyo     = enEjer;
         nPer      = enPeriodo - nPeriodoMin;
     |FINSI;

     nModAnter   = 0;
     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = nAnyo;
     #dsmom004#2 = nPer;
     #dsmom004#3 = 303;
     #dsmom004#4 = 0;
     |LEE 040#dsmom004.=;
     |SI FSalida = 0;  nModAnter = #dsmom004#3;  |FINSI;

     |SI nAnyo = 2013;
         |SI nModAnter = 0;
             #dsmom004#0 = enEmpresa;
             #dsmom004#1 = nAnyo;
             #dsmom004#2 = nPer;
             #dsmom004#3 = 310;
             #dsmom004#4 = 0;
             |LEE 040#dsmom004.=;
             |SI FSalida = 0;  nModAnter = #dsmom004#3;  |FINSI;
         |FINSI;

         |SI nModAnter = 0;
             #dsmom004#0 = enEmpresa;
             #dsmom004#1 = nAnyo;
             #dsmom004#2 = nPer;
             #dsmom004#3 = 370;
             #dsmom004#4 = 0;
             |LEE 040#dsmom004.=;
             |SI FSalida = 0;  nModAnter = #dsmom004#3;  |FINSI;
         |FINSI;
     |FINSI;

     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = nAnyo;
     #dsmom004#2 = nPer;
     #dsmom004#3 = nModAnter;
     #dsmom004#4 = 0;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom004;
         #dsmom004#0 = enEmpresa;
         #dsmom004#1 = nAnyo;
         #dsmom004#2 = nPer;
         #dsmom004#3 = nModAnter;
     |FINSI;
     |CIERRA #dsmom004;

     nEjerAnt = 0;
     |SI nModAnter = 303;
         |SI #dsmom004#1 [ 2013;
             |BUCLE LeeCompl303;
         |FINSI;

         |SI #dsmom004#1 ] 2014;
             |BUCLE LeeCompl30301;
         |FINSI;
     |FINSI;

     |SI nModAnter = 310;
         |BUCLE LeeCompl310;
     |FINSI;

     |SI nModAnter = 370;
         |BUCLE LeeCompl370;
     |FINSI;

     |SI nEjerAnt = 0;
         |BUCLE dsmom103;
     |FINSI;

     |ABRE #dsmom047;
     #dsmom047#0 = enEmpresa;
     #dsmom047#1 = enEjer;
     #dsmom047#2 = enPeriodo;
     #dsmom047#3 = enModelo;
     #dsmom047#4 = enComplem;
     #dsmom047#5 = 0;
     |LEE 040#dsmom047.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom047;  |FINSI;
     |CIERRA #dsmom047;

     |ABRE #dsmom028;
     |DDEFECTO #dsmom028;
     #dsmom028#0 = enEmpresa;
     #dsmom028#1 = enEjer;
     #dsmom028#2 = enPeriodo;
     #dsmom028#3 = enModelo;
     #dsmom028#4 = enComplem;
     #dsmom028#5 = 0;
     |LEE 040#dsmom028.=;
     |CIERRA #dsmom028;

     |SI #dsmom028#7 = "N";  #dsmom028#6 = 0; |FINSI;

     nEjerAnt = nEjerAnt - #dsmom028#6;
     |SI nEjerAnt < 0;  nEjerAnt = 0;  |FINSI;
|FPRC;

|PROCESO GrabaPrescripcion;

     |ABRE #dsmom028;
     |DDEFECTO #dsmom028;
     #dsmom028#0 = enEmpresa;
     #dsmom028#1 = enEjer;
     #dsmom028#2 = enPeriodo;
     #dsmom028#3 = enModelo;
     #dsmom028#4 = enComplem;
     #dsmom028#5 = 0;
     |LEE 040#dsmom028.=;
     |SI FSalida ! 0; |O #dsmom028#7 ! "S";
         |CIERRA #dsmom028;
         |ACABA;
     |FINSI;

     nEjerAnt = nEjerAnt + #dsmom028#6;

     nImporte1 = #dsm30301#83 + #dsm30301#95 + #dsm30301#85;

     |ABRE #dsmom004;
     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = enEjer;
     #dsmom004#2 = enPeriodo;
     #dsmom004#3 = enModelo;
     #dsmom004#4 = enComplem;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;
     |CIERRA #dsmom004;

     |SI nImporte1 ] 0;
         nImporte2 = nImporte1 - #dsmom028#8;
         |SI nImporte2 ] 0;
             #dsmom028#6 = 0;
         |SINO;
             #dsmom028#6 = - nImporte2;
         |FINSI;
     |SINO;
        #dsmom028#6 = #dsmom028#8;
     |FINSI;

     |SI #dsmom004#23 = "S"; |O #dsm30301#2 = 12;
         |HAZ UltimoPeriodo;
         |SI eaUltimoPer = "DEVOLVER ";
             #dsmom028#6 = 0;
         |FINSI;
     |FINSI;

     nEjerAnt = nEjerAnt - #dsmom028#6;

     |GRABA 020#dsmom028.a;
     |LIBERA #dsmom028;
     |CIERRA #dsmom028;
|FPRC;

|PROCESO AcumPorIVA;
     |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
           nCampo11 = nCampo33 - 2;
           nCampo22 = nCampo33 - 1;
           |SI #dsm30301#nCampo22# = nIVA;
               #dsm30301#nCampo11# = #dsm30301#nCampo11# + #dsmociva#nCampo1#;
               #dsm30301#nCampo33# = #dsm30301#nCampo33# + #dsmociva#nCampo3#;
               nSwAcum = 1;

               |SI nIVA ! #dsmociva#nCampo2#;
                   |SI nCampo22 = 17;  nIVA1  = 1;  |FINSI;
                   |SI nCampo22 = 20;  nIVA2  = 1;  |FINSI;
                   |SI nCampo22 = 23;  nIVA3  = 1;  |FINSI;
                   |SI nCampo22 = 32;  nIVA4  = 1;  |FINSI;
                   |SI nCampo22 = 35;  nIVA5  = 1;  |FINSI;
                   |SI nCampo22 = 38;  nIVA6  = 1;  |FINSI;
               |FINSI;
               |SAL;
            |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
               nCampo11 = nCampo33 - 2;
               nCampo22 = nCampo33 - 1;
               |SI #dsm30301#nCampo22# = 0;
                   #dsm30301#nCampo11# = #dsmociva#nCampo1#;
                   #dsm30301#nCampo22# = nIVA;
                   #dsm30301#nCampo33# = #dsmociva#nCampo3#;
                   nSwAcum = 1;

                   |SI nIVA ! #dsmociva#nCampo2#;
                       |SI nCampo22 = 17;  nIVA1  = 1;  |FINSI;
                       |SI nCampo22 = 20;  nIVA2  = 1;  |FINSI;
                       |SI nCampo22 = 23;  nIVA3  = 1;  |FINSI;
                       |SI nCampo22 = 32;  nIVA4  = 1;  |FINSI;
                       |SI nCampo22 = 35;  nIVA5  = 1;  |FINSI;
                       |SI nCampo22 = 38;  nIVA6  = 1;  |FINSI;
                   |FINSI;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         nCampo11     = nHasta - 2;
         nCampo22     = nHasta - 1;
         nCampo33     = nHasta;

         #dsm30301#nCampo11# = #dsm30301#nCampo11# + #dsmociva#nCampo1#;
         #dsm30301#nCampo22# = -1;
         #dsm30301#nCampo33# = #dsm30301#nCampo33# + #dsmociva#nCampo3#;
     |FINSI;
|FPRC;

|PROCESO GrabaDevengado;
     |SI #dsmociva#nCampo3# = 0;  |ACABA;  |FINSI;
     nSwAcum       = 0;

     nIVA     = #dsmociva#nCampo2#;

     |SI nIVA = 18; |O nIVA = 16; nIVA = 21;  |FINSI;
     |SI nIVA = 8;  |O nIVA = 7;  nIVA = 10;  |FINSI;

     |SI nDesde = 33;
         |SI nIVA = 4; nIVA = 5.20;  |FINSI;
         |SI nIVA = 1; nIVA = 1.40;  |FINSI;
     |FINSI;

     |SI nDesde ! nHasta;
         |HAZ AcumPorIVA;
     |SINO;
         nCampo11 = nHasta - 1;
         nCampo33 = nHasta;

         #dsm30301#nCampo11# = #dsm30301#nCampo11# + #dsmociva#nCampo1#;
         #dsm30301#nCampo33# = #dsm30301#nCampo33# + #dsmociva#nCampo3#;
     |FINSI;
|FPRC;

|PROCESO GrabaDeducible;
     |SI enSwProrr ! 2;
         |ABRE #dsmom087;
         #dsmom087#0 = #dsmociva#0;
         #dsmom087#1 = #dsmociva#1;
         #dsmom087#2 = #dsmociva#2;
         #dsmom087#3 = #dsmociva#3;
         #dsmom087#4 = #dsmociva#4;
         #dsmom087#5 = #dsmociva#5;
         #dsmom087#6 = #dsmociva#6;
         #dsmom087#7 = #dsmociva#7;
         |LEE 001#dsmom087.=;
         |SI FSalida = 0;
             #dsmociva#16 = #dsmom087#17 + #dsmom087#41;
             #dsmociva#19 = #dsmom087#20 + #dsmom087#43;
             #dsmociva#22 = #dsmom087#23 + #dsmom087#45;
             #dsmociva#25 = #dsmom087#26 + #dsmom087#47;
             #dsmociva#28 = #dsmom087#29 + #dsmom087#49;
             #dsmociva#31 = #dsmom087#32 + #dsmom087#51;
             #dsmociva#34 = #dsmom087#35 + #dsmom087#53;
        |FINSI;
        |LIBERA #dsmom087;
        |CIERRA #dsmom087;
     |FINSI;

     |SI nHasta ! -1;
         nHasta = nDesde + 1;
         #dsm30301#nDesde# = #dsm30301#nDesde# + (#dsmociva#14 + #dsmociva#17 + #dsmociva#20 + #dsmociva#23 + #dsmociva#26 + #dsmociva#29 + #dsmociva#32);
         #dsm30301#nHasta# = #dsm30301#nHasta# + (#dsmociva#16 + #dsmociva#19 + #dsmociva#22 + #dsmociva#25 + #dsmociva#28 + #dsmociva#31 + #dsmociva#34);
     |SINO;
         #dsm30301#nDesde# = #dsm30301#nDesde# + ((#dsmociva#16 + #dsmociva#19 + #dsmociva#22 + #dsmociva#25 + #dsmociva#28 + #dsmociva#31 + #dsmociva#34) % nProrrata) + nCuotaMas;
     |FINSI;
|FPRC;

|PROCESO GrabaParte1;
     |SI #dsmociva#5 ! 99;
         nLRGral  = nLRGral + 1;
     |SINO;
         nLRGral99 = 1;
     |FINSI;

     enExistencia = 1;
     nDesde       = 0;
     nHasta       = 0;

     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 [ 4;   nDesde = 18;  nHasta = 24;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 14;  nDesde = 18;  nHasta = 24;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 16;  nDesde = 18;  nHasta = 24;  |FINSI;

     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 5;   nDesde = 26;  nHasta = 26;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 15;  nDesde = 26;  nHasta = 26;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 6;   nDesde = 28;  nHasta = 28;  |FINSI;

     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 7;   nDesde = 30;  nHasta = 30;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 8;   nDesde = 30;  nHasta = 30;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 17;  nDesde = 30;  nHasta = 30;  |FINSI;

     |SI enEjer ] 2015;
         |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 18;  nDesde = 30;  nHasta = 30;  |FINSI;
         |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 19;  nDesde = 30;  nHasta = 30;  |FINSI;
     |FINSI;

     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 10;  nDesde = 33;  nHasta = 39;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 11;  nDesde = 41;  nHasta = 41;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 12;  nDesde = 41;  nHasta = 41;  |FINSI;

     |SI enEjer ] 2015;
         |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 20;  nDesde = 41;  nHasta = 41;  |FINSI;
     |FINSI;

     |SI nDesde ! 0;
         |PARA nCampo1 = 14;  |SI nCampo1 [ 32;  |HACIENDO nCampo1 = nCampo1 + 3;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                   |HAZ GrabaDevengado;
               |FINSI;
         |SIGUE;

         |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 15;
             |PARA nCampo1 = 35;  |SI nCampo1 [ 53;  |HACIENDO nCampo1 = nCampo1 + 3;
                   nCampo2 = nCampo1 + 1;
                   nCampo3 = nCampo1 + 2;
                   |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                       |HAZ GrabaDevengado;
                   |FINSI;
             |SIGUE;
         |FINSI;

         |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 6;
             |PARA nCampo1 = 35;  |SI nCampo1 [ 53;  |HACIENDO nCampo1 = nCampo1 + 3;
                   nCampo2 = nCampo1 + 1;
                   nCampo3 = nCampo1 + 2;
                   |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                       |HAZ GrabaDevengado;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;

     |PARA nCampo1 = 17;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #dsm30301#nCampo1# = -1;  #dsm30301#nCampo1# = 0;  |FINSI;
     |SIGUE;

     |PARA nCampo1 = 32;  |SI nCampo1 [ 38;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #dsm30301#nCampo1# = -1;  #dsm30301#nCampo1# = 0;  |FINSI;
     |SIGUE;

     nDesde = 0;
     nHasta = 0;

     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 1;   nDesde = 43;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 2;   nDesde = 45;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 14;  nDesde = 43;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 15;  nDesde = 45;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 3;   nDesde = 47;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 4;   nDesde = 49;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 5;   nDesde = 51;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 6;   nDesde = 53;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 13;  nDesde = 51;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 7;   nDesde = 57;  nHasta = -1;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 8;   nDesde = 55;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 16;  nDesde = 55;  |FINSI;
     |SI enEjer ] 2015;
        |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 17;  nDesde = 55;  |FINSI;
     |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 9;   nDesde = 58;  nHasta = -1;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 10;  nDesde = 59;  nHasta = -1;  |FINSI;

     |SI nDesde ! 0;
         |HAZ GrabaDeducible;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 9;
         #dsm30301#74 = #dsm30301#74 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 16;
         #dsm30301#74 = #dsm30301#74 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 10;
         #dsm30301#75 = #dsm30301#75 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 4;
         #dsm30301#76 = #dsm30301#76 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 5;  |Y #dsmociva#7 = 1;
         #dsm30301#82 = #dsm30301#82 + #dsmociva#12;
         nContador = nContador + 1;
     |FINSI;

     |SI #dsmociva#6 = 5;  |Y #dsmociva#7 = 2;
         #dsm30301#85 = #dsm30301#85 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 4;  |Y #dsmociva#7 = 17;
         #dsm30301#77 = #dsm30301#77 + #dsmociva#12;
         #dsm30301#78 = #dsm30301#78 + #dsmociva#13;
     |FINSI;

     |SI #dsmociva#6 = 4;  |Y #dsmociva#7 = 18;
         #dsm30301#79 = #dsm30301#79 + #dsmociva#12;
         #dsm30301#80 = #dsm30301#80 + #dsmociva#13;
     |FINSI;
|FPRC;

|PROCESO dsmociva;
     enImpIvaSop = 0;
     enImpIvaSub = 0;
     enIvaSopDed = 0;
     nBaseMas    = 0;
     nCuotaMas   = 0;

     |SI #dsmociva#6 = 2;
         |SI #dsmociva#7 ! 5; |Y #dsmociva#7 ! 6;
             |SI #dsmociva#7 ! 10; |Y #dsmociva#7 ! 11; |Y #dsmociva#7 ! 12;
                 enIvaSopDed = (#dsmociva#16 + #dsmociva#19 + #dsmociva#22 + #dsmociva#25 + #dsmociva#28 + #dsmociva#31 + #dsmociva#34) % nProrrata + nCuotaMas;
             |FINSI;
         |FINSI;

         |SI #dsmociva#7 = 10;
             enImpIvaSop = #dsmociva#13 + nCuotaMas;
         |FINSI;

         |SI #dsmociva#7 = 11;
             enImpIvaSub = #dsmociva#13;
             enIvaSopDed = - (#dsmociva#16 + #dsmociva#19 + #dsmociva#22 + #dsmociva#25 + #dsmociva#28 + #dsmociva#31 + #dsmociva#34);
         |FINSI;

         |SI #dsmociva#7 = 12; |ACABA; |FINSI;
     |FINSI;

     |SI #dsmociva#12 = 0;  |Y #dsmociva#13 = 0;  |ACABA;  |FINSI;

     |SI #dsmociva#6 = 5;  |Y #dsmociva#7 = 6;
         nEjerAnt = #dsmociva#12;
     |FINSI;

     |HAZ GrabaParte1;

     |LIBERA #dsmociva;
|FPRC;

|DEFBUCLE dsmociva;
     #dsmociva#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 01, 0,  0;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 99, 9, 99;
     be;
     NULL, dsmociva;
|FIN;

|PROCESO dsmocivaOper;

     #espejo@#0 = #dsmociva#0;
     #espejo@#1 = #dsmociva#1;
     #espejo@#2 = #dsmociva#2;
     #espejo@#3 = #dsmociva#3;
     #espejo@#4 = #dsmociva#4 + 1;
     #espejo@#5 = #dsmociva#5;
     #espejo@#6 = #dsmociva#6;
     #espejo@#7 = #dsmociva#7;
     |LEE 041#espejo@.=;
     |SI FSalida = 0; |ACABA; |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 1;
         #dsm30301#121 = #dsm30301#121 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 17;
         #dsm30301#122 = #dsm30301#122 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 9;
         #dsm30301#123 = #dsm30301#123 + #dsmociva#12;  || antes 2017
         #dsm30301#137 = #dsm30301#137 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 16;
         #dsm30301#123 = #dsm30301#123 + #dsmociva#12;  || antes
         #dsm30301#137 = #dsm30301#137 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 10;
         #dsm30301#123 = #dsm30301#123 + #dsmociva#12; ||antes 2017
         #dsm30301#138 = #dsm30301#138 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 11;
         #dsm30301#123 = #dsm30301#123 + #dsmociva#12; ||antes 2017
         #dsm30301#138 = #dsm30301#138 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 12;
         #dsm30301#124 = #dsm30301#124 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 4;
         #dsm30301#125 = #dsm30301#125 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 7;
         #dsm30301#126 = #dsm30301#126 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 2;
         #dsm30301#127 = #dsm30301#127 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 3;
         #dsm30301#139 = #dsm30301#139 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 8;
         #dsm30301#140 = #dsm30301#140 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 5;
         #dsm30301#141 = #dsm30301#141 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 6;
         #dsm30301#142 = #dsm30301#142 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 13;
         #dsm30301#128 = #dsm30301#128 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 14;
         |SI #dsm30301#1 ] 2017;
             #dsm30301#143 = #dsm30301#143 + #dsmociva#12;
         |SINO;
             #dsm30301#128 = #dsm30301#128 + #dsmociva#12;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmocivaOper;
     #dsmociva#1;
     ;
     enEmpresa, enEjer, 01, enModelo, 00, 01, 3,  0;
     enEmpresa, enEjer, 12, enModelo, 99, 99, 4, 99;
     ;
     NULL, dsmocivaOper;
|FIN;

|PROCESO UltEpi;
     nUltEpi = 1;
     |SI #dsmoc310#6 = "6441"; |O #dsmoc310#6 = "6442";
      |O #dsmoc310#6 = "6443"; |O #dsmoc310#6 = "6446";

         |SI #dsmom019#15 ! 0; |O #dsmom019#16 ! 0; |O #dsmom019#17 ! 0;
             nUltEpi = nUltEpi + 1;
         |FINSI;

         |SI #dsmom019#18 ! 0; |O #dsmom019#19 ! 0; |O #dsmom019#20 ! 0;
             nUltEpi = nUltEpi + 1;
         |FINSI;

     |SINO;
         |SI #dsmom019#15 ! 0; |O #dsmom019#16 ! 0;
             nUltEpi = nUltEpi + 1;
         |FINSI;
         |SI #dsmom019#17 ! 0; nUltEpi = nUltEpi + 1; |FINSI;
         |SI #dsmom019#18 ! 0; nUltEpi = nUltEpi + 1; |FINSI;
         |SI #dsmom019#19 ! 0; nUltEpi = nUltEpi + 1; |FINSI;
         |SI #dsmom019#20 ! 0; nUltEpi = nUltEpi + 1; |FINSI;
     |FINSI;
     |SI #dsmom019#21 ! 0;  nUltEpi = nUltEpi + 1;  |FINSI;
     |SI #dsmom019#22 ! 0;  nUltEpi = nUltEpi + 1;  |FINSI;
     |SI #dsmom019#23 ! 0;  nUltEpi = nUltEpi + 1;  |FINSI;
|FPRC;

|PROCESO CargaProvisional;
     nUni1   = #dsmom019#26;
     nTotal  = #dsmom019#15 * #dsmom019#26;
     |SI nTotal ! #dsmom019#37;  nUni1 = #dsmom019#37 / #dsmom019#15;  |FINSI;

     nUni2   = #dsmom019#27;
     nTotal  = #dsmom019#16 * #dsmom019#27;
     |SI nTotal ! #dsmom019#38;  nUni2 = #dsmom019#38 / #dsmom019#16;  |FINSI;

     nUni3   = #dsmom019#28;
     nTotal  = #dsmom019#17 * #dsmom019#28;
     |SI nTotal ! #dsmom019#39;  nUni3 = #dsmom019#39 / #dsmom019#17;  |FINSI;

     nUni4   = #dsmom019#29;
     nTotal  = #dsmom019#18 * #dsmom019#29;
     |SI nTotal ! #dsmom019#40;  nUni4 = #dsmom019#40 / #dsmom019#18;  |FINSI;

     nUni5   = #dsmom019#30;
     nTotal  = #dsmom019#19 * #dsmom019#30;
     |SI nTotal ! #dsmom019#41;  nUni5 = #dsmom019#41 / #dsmom019#19;  |FINSI;

     nUni6   = #dsmom019#31;
     nTotal  = #dsmom019#20 * #dsmom019#31;
     |SI nTotal ! #dsmom019#42;  nUni6 = #dsmom019#42 / #dsmom019#20;  |FINSI;

     nUni7   = #dsmom019#32;
     nTotal  = #dsmom019#21 * #dsmom019#32;
     |SI nTotal ! #dsmom019#43;  nUni7 = #dsmom019#43 / #dsmom019#21;  |FINSI;

     nUni8   = #dsmom019#33;
     nTotal  = #dsmom019#22 * #dsmom019#33;
     |SI nTotal ! #dsmom019#44;  nUni8 = #dsmom019#44 / #dsmom019#22;  |FINSI;

     nUni9   = #dsmom019#34;
     nTotal  = #dsmom019#23 * #dsmom019#34;
     |SI nTotal ! #dsmom019#45;  nUni9 = #dsmom019#45 / #dsmom019#23;  |FINSI;

     |PARA nCampo = 4;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 4;
           nNume = #dsmom016#nCampo#;
           |SI nNume = 3;  |O nNume = 28;  |O nNume = 10;
               nFactor = 100;
               |SI nNume = 10;  nFactor = 1000;  |FINSI;

               |SI nCampo = 4;   nUni1 = nUni1 / nFactor;  |FINSI;
               |SI nCampo = 8;   nUni2 = nUni2 / nFactor;  |FINSI;
               |SI nCampo = 12;  nUni3 = nUni3 / nFactor;  |FINSI;
               |SI nCampo = 16;  nUni4 = nUni4 / nFactor;  |FINSI;
               |SI nCampo = 20;  nUni5 = nUni5 / nFactor;  |FINSI;
               |SI nCampo = 24;  nUni6 = nUni6 / nFactor;  |FINSI;
               |SI nCampo = 28;  nUni7 = nUni7 / nFactor;  |FINSI;
               |SI nCampo = 32;  nUni8 = nUni8 / nFactor;  |FINSI;
               |SI nCampo = 36;  nUni9 = nUni9 / nFactor;  |FINSI;
           |FINSI;
     |SIGUE;

     |SI #dsmoc310#6 = "6441"; |O #dsmoc310#6 = "6442";
      |O #dsmoc310#6 = "6443"; |O #dsmoc310#6 = "6446";
         #dsm30303#8  = nUni1 + nUni2 + nUni3;
         #dsm30303#15 = #dsmom019#37 + #dsmom019#38 + #dsmom019#39;

         #dsm30303#9  = nUni4 + nUni5 + nUni6;
         #dsm30303#16 = #dsmom019#40 + #dsmom019#41 + #dsmom019#42;

         #dsm30303#10 = nUni7;
         #dsm30303#17 = #dsmom019#43;

         #dsm30303#11 = nUni8;
         #dsm30303#18 = #dsmom019#44;

         #dsm30303#12 = nUni9;
         #dsm30303#19 = #dsmom019#45;
     |SINO;
         #dsm30303#8  = nUni1 + nUni2;
         #dsm30303#15 = #dsmom019#37 + #dsmom019#38

         #dsm30303#9  = nUni3;
         #dsm30303#16 = #dsmom019#39;

         #dsm30303#10 = nUni4;
         #dsm30303#17 = #dsmom019#40;

         #dsm30303#11 = nUni5;
         #dsm30303#18 = #dsmom019#41;

         #dsm30303#12 = nUni6;
         #dsm30303#19 = #dsmom019#42;

         #dsm30303#13 = nUni7;
         #dsm30303#20 = #dsmom019#43;

         #dsm30303#14 = nUni8;
         #dsm30303#21 = #dsmom019#44;
     |FINSI;

|| tique 4445 _ 60  comision de Loterias 16.04.2014
     nCampo1 = 124; |SI #dsm30301#2 > 3; nCampo1 = 126; |FINSI;
                    |SI #dsm30301#2 > 6; nCampo1 = 128; |FINSI;
     nCampo2 = nCampo1 + 1;

     |SI #dsmom019#nCampo1# ! 0; |O #dsmom019#nCampo2# ! 0;
         |HAZ UltEpi;
         nCampo11 = nUltEpi + 7; nCampo22 = nCampo11 + 7;
         |SI nCampo11 > 14; nCampo11 = 14; |FINSI;
         #dsm30303#nCampo11# = #dsmom019#nCampo1#;
         #dsm30303#nCampo22# = #dsmom019#nCampo2#;
     |FINSI;

     #dsm30303#22 = #dsm30303#15 + #dsm30303#16 + #dsm30303#17 + #dsm30303#18;
     #dsm30303#22 = #dsm30303#22 + #dsm30303#19 + #dsm30303#20 + #dsm30303#21;
     #dsm30303#23 = #dsmom019#161;
     #dsm30303#24 = #dsmom019#120;
     #dsm30303#25 = #dsmom019#121;
     |SI #dsm30303#25 = 0; #dsm30303#25 = 100; |FINSI;

     |SI #dsmoc310#2 = 3;
         #dsm30303#26 = #dsmom019#139;

         |SI #dsmom019#148 ! 0;
             #dsm30303#26 = #dsmom019#148;
         |FINSI;
     |FINSI;

     |SI #dsmoc310#2 = 6;
         #dsm30303#26 = #dsmom019#140;

         |SI #dsmom019#149 ! 0;
             #dsm30303#26 = #dsmom019#149;
         |FINSI;
     |FINSI;

     |SI #dsmoc310#2 = 9;
         #dsm30303#26 = #dsmom019#141;

         |SI #dsmom019#150 ! 0;
             #dsm30303#26 = #dsmom019#150;
         |FINSI;
     |FINSI;

     #dsm30301#62 = #dsm30301#62 + #dsm30303#26;
|FPRC;

|PROCESO CargaDefinitivo;
     nUni1   = #dsmom019#48;
     nTotal  = #dsmom019#15 * #dsmom019#48;
     |SI nTotal ! #dsmom019#59;  nUni1 = #dsmom019#59 / #dsmom019#15;  |FINSI;

     nUni2   = #dsmom019#49;
     nTotal  = #dsmom019#16 * #dsmom019#49;
     |SI nTotal ! #dsmom019#60;  nUni2 = #dsmom019#60 / #dsmom019#16;  |FINSI;

     nUni3   = #dsmom019#50;
     nTotal  = #dsmom019#17 * #dsmom019#50;
     |SI nTotal ! #dsmom019#61;  nUni3 = #dsmom019#61 / #dsmom019#17;  |FINSI;

     nUni4   = #dsmom019#51;
     nTotal  = #dsmom019#18 * #dsmom019#51;
     |SI nTotal ! #dsmom019#62;  nUni4 = #dsmom019#62 / #dsmom019#18;  |FINSI;

     nUni5   = #dsmom019#52;
     nTotal  = #dsmom019#19 * #dsmom019#52;
     |SI nTotal ! #dsmom019#63;  nUni5 = #dsmom019#63 / #dsmom019#19;  |FINSI;

     nUni6   = #dsmom019#53;
     nTotal  = #dsmom019#20 * #dsmom019#53;
     |SI nTotal ! #dsmom019#64;  nUni6 = #dsmom019#64 / #dsmom019#20;  |FINSI;

     nUni7   = #dsmom019#54;
     nTotal  = #dsmom019#21 * #dsmom019#54;
     |SI nTotal ! #dsmom019#65;  nUni7 = #dsmom019#65 / #dsmom019#21;  |FINSI;

     nUni8   = #dsmom019#55;
     nTotal  = #dsmom019#22 * #dsmom019#55;
     |SI nTotal ! #dsmom019#66;  nUni8 = #dsmom019#66 / #dsmom019#22;  |FINSI;

     nUni9   = #dsmom019#56;
     nTotal  = #dsmom019#23 * #dsmom019#56;
     |SI nTotal ! #dsmom019#67;  nUni9 = #dsmom019#67 / #dsmom019#23;  |FINSI;

     |SI #dsmom019#132 ! 0;
         |PARA nCampo = 15;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
               |SI #dsmom019#nCampo# = 0;
                   |SI nCampo = 15;
                       nUni1  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#59 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 16;
                       nUni2  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#60 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 17;
                       nUni3  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#61 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 18;
                       nUni4  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#62 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 19;
                       nUni5  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#63 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 20;
                       nUni6  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#64 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 21;
                       nUni7  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#65 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 22;
                       nUni8  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#66 = #dsmom019#132;
                   |FINSI;

                   |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;

     |PARA nCampo = 4;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 4;
           nNume = #dsmom016#nCampo#;
           |SI nNume = 3;  |O nNume = 28;  |O nNume = 10;
               nFactor = 100;
               |SI nNume = 10;  nFactor = 1000;  |FINSI;

               |SI nCampo = 4;   nUni1 = nUni1 / nFactor;  |FINSI;
               |SI nCampo = 8;   nUni2 = nUni2 / nFactor;  |FINSI;
               |SI nCampo = 12;  nUni3 = nUni3 / nFactor;  |FINSI;
               |SI nCampo = 16;  nUni4 = nUni4 / nFactor;  |FINSI;
               |SI nCampo = 20;  nUni5 = nUni5 / nFactor;  |FINSI;
               |SI nCampo = 24;  nUni6 = nUni6 / nFactor;  |FINSI;
               |SI nCampo = 28;  nUni7 = nUni7 / nFactor;  |FINSI;
               |SI nCampo = 32;  nUni8 = nUni8 / nFactor;  |FINSI;
               |SI nCampo = 36;  nUni9 = nUni9 / nFactor;  |FINSI;
           |FINSI;
     |SIGUE;

     |SI #dsmoc310#6 = "6441"; |O #dsmoc310#6 = "6442";
      |O #dsmoc310#6 = "6443"; |O #dsmoc310#6 = "6446";
         #dsm30303#8  = nUni1 + nUni2 + nUni3;
         #dsm30303#15 = #dsmom019#59 + #dsmom019#60 + #dsmom019#61;

         #dsm30303#9  = nUni4 + nUni5 + nUni6;
         #dsm30303#16 = #dsmom019#62 + #dsmom019#63 + #dsmom019#64;

         #dsm30303#10 = nUni7;
         #dsm30303#17 = #dsmom019#65;

         #dsm30303#11 = nUni8;
         #dsm30303#18 = #dsmom019#66;

         #dsm30303#12 = nUni9;
         #dsm30303#19 = #dsmom019#67;
     |SINO;
         #dsm30303#8  = nUni1 + nUni2;
         #dsm30303#15 = #dsmom019#59 + #dsmom019#60

         #dsm30303#9  = nUni3;
         #dsm30303#16 = #dsmom019#61;

         #dsm30303#10 = nUni4;
         #dsm30303#17 = #dsmom019#62;

         #dsm30303#11 = nUni5;
         #dsm30303#18 = #dsmom019#63;

         #dsm30303#12 = nUni6;
         #dsm30303#19 = #dsmom019#64;

         #dsm30303#13 = nUni7;
         #dsm30303#20 = #dsmom019#65;

         #dsm30303#14 = nUni8;
         #dsm30303#21 = #dsmom019#66;
     |FINSI;

     #dsm30303#22 = #dsm30303#15 + #dsm30303#16 + #dsm30303#17 + #dsm30303#18;
     #dsm30303#22 = #dsm30303#22 + #dsm30303#19 + #dsm30303#20 + #dsm30303#21;
     #dsm30303#23 = #dsmom019#163;
     #dsm30303#27 = #dsmom019#135;
     #dsm30303#28 = #dsmom019#120;
     #dsm30303#29 = #dsmom019#136;

     #dsm30303#30 = 0;
     |SI #dsm30303#8  ! 0;  |O #dsm30303#9  ! 0;  |O #dsm30303#10 ! 0;
     |O  #dsm30303#11 ! 0;  |O #dsm30303#12 ! 0;  |O #dsm30303#13 ! 0;
     |O  #dsm30303#14 ! 0;
         #dsm30303#30 = #dsmom019#122;
     |FINSI;

     #dsm30303#31 = #dsmom019#147;
     #dsm30303#32 = #dsmom019#137;
     #dsm30303#33 = #dsmom019#138;

     #dsm30301#63 = #dsm30301#63 + #dsm30303#33;
|FPRC;

|PROCESO GrabaModulo;
     #dsm30303#0 = #dsm30301#0;
     #dsm30303#1 = #dsm30301#1;
     #dsm30303#2 = #dsm30301#2;
     #dsm30303#3 = #dsm30301#3;
     #dsm30303#4 = #dsm30301#4;
     #dsm30303#5 = #dsmoc310#5;
     |LEE 001#dsm30303.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm30303;
         #dsm30303#0 = #dsm30301#0;
         #dsm30303#1 = #dsm30301#1;
         #dsm30303#2 = #dsm30301#2;
         #dsm30303#3 = #dsm30301#3;
         #dsm30303#4 = #dsm30301#4;
         #dsm30303#5 = #dsmoc310#5;
         #dsm30303#6 = #dsmoc310#6;
         #dsm30303#7 = #dsmoc310#7;
         |GRABA 020#dsm30303.b;
     |FINSI;

     |ABRE #dsmom019;
     #dsmom019#0  = #dsmoc310#0;
     #dsmom019#1  = #dsmoc310#1;
     #dsmom019#2  = 00;  || no hay Modulo Complementario #dsmoc310#4;
     #dsmom019#3  = #dsmoc310#5;
     |LEE 000#dsmom019.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom019;  |FINSI;
     |CIERRA #dsmom019;

     |ABRE #dsmom017;
     #dsmom017#0 = #dsmom019#0;
     #dsmom017#1 = #dsmom019#1;
     #dsmom017#2 = #dsmom019#2;
     #dsmom017#3 = #dsmom019#3;
     |LEE 000#dsmom017.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #dsmom017;

     |ABRE #dsmom016;
     #dsmom016#0  = #dsmom017#4;
     #dsmom016#1  = #dsmom017#5;
     #dsmom016#41 = #dsmom017#6;
     #dsmom016#2  = #dsmom017#1;
     |LEE 040#dsmom016.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom016;  |FINSI;
     |CIERRA #dsmom016;

     |SI #dsmoc310#2 ! 12;  |HAZ CargaProvisional;  |FINSI;
     |SI #dsmoc310#2 = 12;  |HAZ CargaDefinitivo;   |FINSI;

     nSwAcum = 0;
     |PARA nDCampo = 8; |SI nDCampo [ 33; |HACIENDO nDCampo = nDCampo + 1;
           |SI #dsm30303#nDCampo# ! 0;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;
     |SI nSwAcum = 0;
        |BORRA 020#dsm30303.a;
     |SINO;
        |GRABA 020#dsm30303.a;
     |FINSI;
     |LIBERA #dsm30303;
|FPRC;

|PROCESO dsmoc311;
     #dsmom133#0 = #dsmoc311#6;
     #dsmom133#1 = #dsmoc311#1;
     |LEE 000#dsmom133.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsmom033#0 = #dsmoc311#6;
     |LEE 000#dsmom033.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsm30302#0 = #dsm30301#0;
     #dsm30302#1 = #dsm30301#1;
     #dsm30302#2 = #dsm30301#2;
     #dsm30302#3 = #dsm30301#3;
     #dsm30302#4 = #dsm30301#4;
     #dsm30302#5 = #dsm30301#5;
     #dsm30302#6 = #dsmom133#2;
     |LEE 001#dsm30302.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm30302;
         #dsm30302#0 = #dsm30301#0;
         #dsm30302#1 = #dsm30301#1;
         #dsm30302#2 = #dsm30301#2;
         #dsm30302#3 = #dsm30301#3;
         #dsm30302#4 = #dsm30301#4;
         #dsm30302#5 = #dsm30301#5;
         #dsm30302#6 = #dsmom133#2;
         #dsm30302#7 = #dsmom033#2;
         |GRABA 020#dsm30302.b;
     |FINSI;

     #dsm30302#8  = #dsm30302#8 + #dsmoc311#8;
     #dsm30302#9  = #dsmoc311#9;
     #dsm30302#10 = #dsm30302#8 * #dsm30302#9;

     |SI #dsmoc311#2 ! 12;
         #dsm30302#11 = #dsmoc311#10;
         #dsm30302#12 = #dsm30302#12 + #dsmoc311#12;

         #dsm30301#62 = #dsm30301#62 + #dsmoc311#12;
     |FINSI;

     |SI #dsmoc311#2 = 12;
         #dsm30302#13 = #dsm30302#13 + (#dsmoc311#11 + ((#dsmoc311#8 * #dsmoc311#9) % 1));
         #dsm30302#14 = #dsm30302#14 + #dsmoc311#12;

         #dsm30301#63 = #dsm30301#63 + #dsmoc311#12;
     |FINSI;

     |GRABA 020#dsm30302.a;
     |LIBERA #dsm30302;
|FPRC;

|DEFBUCLE dsmoc311;
     #dsmoc311#1;
     ;
     #dsmoc310#0, #dsmoc310#1, #dsmoc310#2, #dsmoc310#3, #dsmoc310#4, #dsmoc310#5, 001;
     #dsmoc310#0, #dsmoc310#1, #dsmoc310#2, #dsmoc310#3, #dsmoc310#4, #dsmoc310#5, 999;
     ;
     NULL, dsmoc311;
|FIN;

|PROCESO GrabaAgricola;
     |ABRE #dsmom033;
     |ABRE #dsmom133;
     |BUCLE dsmoc311;
     |CIERRA #dsmom033;
     |CIERRA #dsmom133;
|FPRC;

|PROCESO dsmoc310;
     #dsmom008#0 = #dsmoc310#0;
     #dsmom008#1 = #dsmoc310#1;
     #dsmom008#2 = #dsmoc310#2;
     #dsmom008#3 = #dsmoc310#3;
     #dsmom008#4 = #dsmoc310#4;
     #dsmom008#5 = #dsmoc310#5;
     |LEE 041#dsmom008.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     enExistencia = 1;
     nLSimpl      = nLSimpl + 1;

     |SI #dsmoc310#8 = "N";
         |HAZ GrabaModulo;
     |FINSI;

     |SI #dsmoc310#8 = "S";
         |HAZ GrabaAgricola;
     |FINSI;

     #dsm30301#66 = #dsm30301#66 + #dsmoc310#10;
     #dsm30301#67 = #dsm30301#67 + #dsmoc310#11;
     #dsm30301#68 = #dsm30301#68 + #dsmoc310#12 + #dsmoc310#17;

     #dsm30301#70 = #dsm30301#70 + #dsmoc310#13;
     #dsm30301#71 = #dsm30301#71 + #dsmoc310#14;

     #dsm30301#74 = #dsm30301#74 + #dsmoc310#15 + #dsmoc310#18;

     |SI #dsmoc310#16 ! 0;
         nEjerAnt = #dsmoc310#16;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc310;
     #dsmoc310#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 01;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 99;
     be;
     NULL, dsmoc310;
|FIN;

|PROCESO dsmoc310Oper;
     #espejo@#0 = #dsmoc310#0;
     #espejo@#1 = #dsmoc310#1;
     #espejo@#2 = #dsmoc310#2;
     #espejo@#3 = #dsmoc310#3;
     #espejo@#4 = #dsmoc310#4 + 1;
     #espejo@#5 = #dsmoc310#5;
     |LEE 041#espejo@.=;
     |SI FSalida = 0; |ACABA; |FINSI;

     #dsm30301#127 = #dsm30301#127 + #dsmoc310#19;
|FPRC;

|DEFBUCLE dsmoc310Oper;
     #dsmoc310#1;
     ;
     enEmpresa, enEjer, 01, enModelo, 00, 01;
     enEmpresa, enEjer, 12, enModelo, 99, 99;
     be;
     NULL, dsmoc310Oper;
|FIN;

|PROCESO IngreRealizados;
     |SALVA_FICHA #dsmoc310;
     #dsmoc310#4 = #dsmoc310#4 + 1;
     |LEE 040#dsmoc310.=;
     |SI FSalida = 0;
         |REPON_FICHA #dsmoc310;
         |ACABA;
     |FINSI;
     |REPON_FICHA #dsmoc310;

     #dsmom004#0 = #dsmoc310#0;
     #dsmom004#1 = #dsmoc310#1;
     #dsmom004#2 = #dsmoc310#2;
     #dsmom004#3 = #dsmoc310#3;
     #dsmom004#4 = #dsmoc310#4;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsm30301#64 = #dsm30301#64 + #dsmoc310#9;

     |SI enNoMod390 = 1;
||          #dsm30301#127 = #dsm30301#127 + #dsmoc310#19;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc310R;
     #dsmoc310#1;
     ;
     enEmpresa, enEjer, 3, 000, 00, 01;
     enEmpresa, enEjer, 9, 999, 99, 99;
     ;
     NULL, IngreRealizados;
|FIN;

|PROCESO dsm30301Otros;
     nNegativo = nNegativoC + nNegativoD;
     |SI #dsm30301@#4 ] 1; |Y  nNegativo ! 0; |Y #dsm30301@#87 < 0; |Y #dsm30301@#91 > 0;
         |SI nNegativoC ! 0;
             nNegativoC =  - #dsm30301@#86;
         |SINO;
              nNegativoD = - #dsm30301@#86;
         |FINSI;
         nNegativoI    = #dsm30301@#91;
         #dsm30301@#91 = 0;
     |SINO;
         nNegativoC    = #dsm30301@#89;
         nNegativoD    = #dsm30301@#90;
         nNegativoI    = #dsm30301@#91;
     |FINSI;

     #dsm30301#87  = #dsm30301#87 + #dsm30301@#91;
     nTotal303     = #dsm30301@#86;
|FPRC;

|DEFBUCLE dsm30301Otros;
     #dsm30301@#1006;
     ;
     #dsm30301#0, #dsm30301#1, #dsm30301#2, #dsm30301#3,        0, #dsm30301#5;
     #dsm30301#0, #dsm30301#1, #dsm30301#2, #dsm30301#3, nHComple, #dsm30301#5;
     ;
     NULL, dsm30301Otros;
|FIN;

|PROCESO CapturaOtros303;
     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsm30301.mas";
     |CARGA_DEF aMas, dsm30301@;

     nHComple     = #dsm30301#4 - 1;
     #dsm30301#87 = 0;
     #dsm30301#88 = 0;
     nTotal303    = 0;
     nNegativoD   = 0;
     nNegativoC   = 0;
     nNegativoI   = 0;

     |BUCLE dsm30301Otros;

     |SI nNegativoC ! 0;  |O nNegativoD ! 0;
         nNegativo  = (nNegativoC + nNegativoD) * -1;

         |SI nNegativoI ! 0;
             FSalida = 0;
         |SINO;
             |SI nNegativoC ! 0;
                 |SI eMensa = 0;
                     |MENAV "0000Declaraciones anteriores a compensar. ";
                     |CONFI "0000NHa compensado el importe en una declaracion posterior";
                 |SINO;
                     FSalida = -1;
                 |FINSI;
             |SINO;
                 |SI eMensa = 0;
                     |MENAV "0000Declaraciones anteriores a devolver.";
                     |CONFI "0000NHa recibido la devolucion";
                 |SINO;
                      FSalida = -1;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI FSalida = 0;
            #dsm30301#87 = #dsm30301#87 + nNegativo;
         |FINSI;
     |FINSI;

     |DESCARGA_DEF #dsm30301@;
|FPRC;

|PROCESO Totales;
     |SI #dsm30301#95 < 0; #dsm30301#95 = 0; |FINSI; || Tique 700000 _ 9582

     |SI nIVA1 = 1;  #dsm30301#17 = (#dsm30301#18 / #dsm30301#16) * 100;   |FINSI;
     |SI nIVA2 = 1;  #dsm30301#20 = (#dsm30301#21 / #dsm30301#19) * 100;   |FINSI;
     |SI nIVA3 = 1;  #dsm30301#23 = (#dsm30301#24 / #dsm30301#22) * 100;   |FINSI;
     |SI nIVA4 = 1;  #dsm30301#32 = (#dsm30301#33 / #dsm30301#31) * 100;   |FINSI;
     |SI nIVA5 = 1;  #dsm30301#35 = (#dsm30301#36 / #dsm30301#34) * 100;   |FINSI;
     |SI nIVA6 = 1;  #dsm30301#38 = (#dsm30301#39 / #dsm30301#37) * 100;   |FINSI;

     #dsm30301#92 = nPro;
     #dsm30301#93 = eaProrrat;

     #dsm30301#42 = #dsm30301#18 + #dsm30301#21 + #dsm30301#24 + #dsm30301#26;
     #dsm30301#42 = #dsm30301#42 + #dsm30301#28 + #dsm30301#30 + #dsm30301#33;
     #dsm30301#42 = #dsm30301#42 + #dsm30301#36 + #dsm30301#39 + #dsm30301#41;

     |SI enPeriodo = 12;
         #dsm30301#59 = #dsm30301#59 + enImpProrrat36;
     |FINSI;

     #dsm30301#44 = #dsm30301#44 - #dsmom047#6;
     #dsm30301#46 = #dsm30301#46 - #dsmom047#7;
     #dsm30301#48 = #dsm30301#48 - #dsmom047#8;
     #dsm30301#50 = #dsm30301#50 - #dsmom047#9;
     #dsm30301#52 = #dsm30301#52 - #dsmom047#10;
     #dsm30301#54 = #dsm30301#54 - #dsmom047#11;
     #dsm30301#57 = #dsm30301#57 - #dsmom047#12;

     #dsm30301#60 = #dsm30301#44 + #dsm30301#46 + #dsm30301#48 + #dsm30301#50;
     #dsm30301#60 = #dsm30301#60 + #dsm30301#52 + #dsm30301#54 + #dsm30301#56;
     #dsm30301#60 = #dsm30301#60 + #dsm30301#57 + #dsm30301#58 + #dsm30301#59;
     #dsm30301#61 = #dsm30301#42 - #dsm30301#60;

     |SI #dsm30301#2 = 12;
         #dsm30301#64 = 0;

         |ABRE #dsmom004;
         |BUCLE dsmoc310R;
         |CIERRA #dsmom004;

         #dsm30301#65 = #dsm30301#63 - #dsm30301#64;
     |FINSI;

     |SI enPeriodo ! 12;
         #dsm30301#69 = #dsm30301#62 + #dsm30301#66 + #dsm30301#67 + #dsm30301#68;
         #dsm30301#12 = "N";
     |FINSI;

     |SI enPeriodo = 12;
         #dsm30301#69 = #dsm30301#65 + #dsm30301#66 + #dsm30301#67 + #dsm30301#68;
     |FINSI;

     #dsm30301#72 = #dsm30301#70 + #dsm30301#71;
     #dsm30301#73 = #dsm30301#69 - #dsm30301#72;

     #dsm30301#81 = #dsm30301#61 + #dsm30301#73 + #dsm30301#94;
     #dsm30301#82 = #dsm30301#82 / nContador;

     |SI nContador = 0;
         #dsm30301#82 = 100;
     |FINSI;

     #dsm30301#83 = #dsm30301#81 % #dsm30301#82;

     |HAZ GrabaPrescripcion;
     #dsm30301#84 = nEjerAnt;
     #dsm30301#86 = #dsm30301#83 + #dsm30301#95 - #dsm30301#84 + #dsm30301#85;

     |SI #dsm30301#4 > 0;
         |HAZ CapturaOtros303;
         nRes = #dsm30301#86 - #dsm30301#87;

         || |SI nRes < 0; |Y eMensa = 0;  || |SI nRes < nTotal303;
         |SI #dsm30301#86 < nTotal303; |Y eMensa = 0;
             |MENAV "0000RECUERDE. Si el resultado es inferior a la declaracion anterior, NO procede complementaria";
         |FINSI;
     |FINSI;

     #dsm30301#88 = #dsm30301#86 - #dsm30301#87;

     |SI #dsm30301#88 > 0;
         #dsm30301#91 = #dsm30301#88;
         #dsm30301#89 = 0;
         #dsm30301#90 = 0;
     |SINO;
         |ABRE #dsmom004;
         #dsmom004#0 = enEmpresa;
         #dsmom004#1 = enEjer;
         #dsmom004#2 = enPeriodo;
         #dsmom004#3 = enModelo;
         #dsmom004#4 = enComplem;
         |LEE 040#dsmom004.=;
         |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;
         |CIERRA #dsmom004;

         |SI #dsmom004#23 = "S";
              |HAZ UltimoPeriodo;
              |SI eaUltimoPer = "COMPENSAR";
                  #dsm30301#89 = -#dsm30301#88;
                  #dsm30301#90 = 0;
                  #dsm30301#91 = 0;
              |SINO;
                  #dsm30301#90 = -#dsm30301#88;
                  #dsm30301#89 = 0;
                  #dsm30301#91 = 0;
              |FINSI;
         |FINSI;

         |SI #dsmom004#23 = "N";
             |SI #dsm30301#2 = 12;
                 |HAZ UltimoPeriodo;
                 |SI eaUltimoPer = "COMPENSAR";
                     #dsm30301#89 = -#dsm30301#88;
                     #dsm30301#90 = 0;
                     #dsm30301#91 = 0;
                 |SINO;
                     #dsm30301#90 = -#dsm30301#88;
                     #dsm30301#89 = 0;
                     #dsm30301#91 = 0;
                 |FINSI;
             |SINO;
                 #dsm30301#89 = -#dsm30301#88;
                 #dsm30301#90 = 0;
                 #dsm30301#91 = 0;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nLRGral = 0; |Y nLSimpl ! 0;
         #dsm30301#7 = "S";
     |FINSI;

     |SI #dsm30301#1 ] 2015;
         |SI nLRGral ! 0; |Y nLSimpl = 0;   || tique 70000_9314
             #dsm30301#7 = "G";
         |FINSI;
         |SI nLRGral = 0; |Y nLSimpl = 0; |Y nLRGral99 = 1; ||tique 3044-437
             #dsm30301#7 = "G";
         |FINSI;
     |FINSI;

     |SI #dsm30301#79 ! 0;  |O #dsm30301#80 ! 0;
         #dsm30301#11 = "S";
     |FINSI;
|FPRC;

|PROCESO PonActividades;
     aAlfa = #agicen14#5 % -104;
     |SI aAlfa ! "0000";
         aAlfa = "31.12." + #dsm30301#1;
         |SI #agicen14#5 > aAlfa;
             |ACABA;
         |FINSI;
     |FINSI;

     aAlfa = #agicen14#6 % -104;
     |SI aAlfa ! "0000";
         aAlfa = "01.01." + #dsm30301#1;
         |SI #agicen14#6 < aAlfa;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #agicen14#7 = 1;   |ACABA;  |FINSI;
     |SI #agicen14#7 = 3;   |ACABA;  |FINSI;
     |SI #agicen14#7 = 9;   |ACABA;  |FINSI;

     |PARA nCampo = 96;  |SI nCampo [ 116;  |HACIENDO nCampo = nCampo + 4;
           nCampo1 = nCampo + 1;
           nCampo2 = nCampo + 2;
           nCampo3 = nCampo + 3;
           |SI #dsm30301#nCampo#  = 0;
               #dsm30301#nCampo#  = #agicen14#1;
               #dsm30301#nCampo1# = #agicen14#3;
               #dsm30301#nCampo2# = #agicen14#4;


               |SI #agicen14#16 = 1;  |O #agicen14#16 = 2;
                   #dsm30301#nCampo3# = 1;
               |FINSI;

               |SI #agicen14#16 = 4;  |O #agicen14#16 = 5;
                   #dsm30301#nCampo3# = 2;
               |FINSI;

               |SI #agicen14#3 = "8612"; |O #agicen14#3 = "8611";
                   #dsm30301#nCampo3# = 3;
               |FINSI;

               |SI #agicen14#16 = 3;
                   #dsm30301#nCampo3# = 1;
               |FINSI;

               |SI #agicen14#16 = 6;
                   #dsm30301#nCampo3# = 6;
               |FINSI;

               |SI #agicen14#3 = "9999";  |Y #agicen14#16 = 3;
                   #dsm30301#nCampo3# = 4;
               |FINSI;

               |SI #agicen14#3 = "9999";  |Y #agicen14#16 = 6;
                   #dsm30301#nCampo3# = 6;
               |FINSI;

               |SI #dsm30301#nCampo3# = 0;  |O #dsm30301#nCampo3# = 4;
                |O #dsm30301#nCampo3# = 5;  |O #dsm30301#nCampo3# = 6;
                   #dsm30301#nCampo1# = "";
               |FINSI;

               |SI #dsm30301#nCampo1# = "9999";
                   #dsm30301#nCampo1# = "";
               |FINSI;

               |SAL;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO dsmom008;
     #agicen14#0 = #dsmom008#0;
     #agicen14#1 = #dsmom008#5;
     |LEE 000#agicen14.=;
     |SI FSalida ! 0;
         |DDEFECTO #agicen14;
          #agicen14#0 = #dsmom008#0;
          #agicen14#1 = #dsmom008#5;
     |FINSI;

     |HAZ PorHistorico;

     |SI #agicen14#7 = 11;  |O #agicen14#7 = 13;
         #dsm30301#6 = "S";
     |FINSI;

     |SI #agicen14#7 = 14;  |O #agicen14#7 = 15;
         #dsm30301#10 = "S";
     |FINSI;

     |SI #agicen14#7 = 17; |Y #dsm30301#1 ] 2018;
         #dsm30301#132 = "S";
     |FINSI;

     |SI enNoMod390 = 1;
         |HAZ PonActividades;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom008;
     #dsmom008#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 01;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 95;
     ;
     NULL, dsmom008;
|FIN;

|PROCESO GrabaModelo;
     |HAZ eLeeLaProrrata;
     nPro = nProrrata;
     nProrrata = 100;

     #dsm30301#0 = enEmpresa;
     #dsm30301#1 = enEjer;
     #dsm30301#2 = enPeriodo;
     #dsm30301#3 = enModelo;
     #dsm30301#4 = enComplem;
     #dsm30301#5 = 0;
     |LEE 101#dsm30301.=;
     |SI FSalida ! 0;
         |HAZ RecogeAnter;

         |DDEFECTO #dsm30301;
         #dsm30301#0   = enEmpresa;
         #dsm30301#1   = enEjer;
         #dsm30301#2   = enPeriodo;
         #dsm30301#3   = enModelo;
         #dsm30301#4   = enComplem;
         #dsm30301#5   = 0;
         #dsm30301#8   = aGuardo8;
         #dsm30301#9   = aGuardo9;
         #dsm30301#12  = aGuardo12;
         #dsm30301#13  = aGuardo13;
         #dsm30301#14  = aGuardo14;
         #dsm30301#15  = aGuardo15;
         #dsm30301#84  = nEjerAnt;
         #dsm30301#94  = nGuardo76;
         #dsm30301#95  = nGuardo77;
         #dsm30301#130 = aGuardo130;
         #dsm30301#131 = aGuardo131;
         #dsm30301#132 = aGuardo132;
         #dsm30301#144 = aGuardo144;
         |GRABA 020#dsm30301.b;
     |FINSI;

     nEjerAnt  = #dsm30301#84;
     nContador = 0;
     nIVA1     = 0;
     nIVA2     = 0;
     nIVA3     = 0;
     nIVA4     = 0;
     nIVA5     = 0;
     nIVA6     = 0;

     nLSimpl   = 0;
     nLRGral   = 0;
     nLRGral99 = 0;
     enExistencia = 0;
     nContador    = 0;
     |BUCLE dsmociva;
     |ABRE #dsmom008;
     |BUCLE dsmoc310;
     |CIERRA #dsmom008;

     |SI enNoMod390 = 1;
         |DBASE aBase;  |QBF aBase;
         aMas = aBase + "def/dsmociva.mas";
         |CARGA_DEF aMas, espejo@;
         |ABRE #espejo@;
         |BUCLE dsmocivaOper;
         |CIERRA #espejo@;
         |DESCARGA_DEF #espejo@;

         |DBASE aBase;  |QBF aBase;
         aMas = aBase + "def/dsmoc310.mas";
         |CARGA_DEF aMas, espejo@;
         |ABRE #espejo@;
         |BUCLE dsmoc310Oper;
         |CIERRA #espejo@;
         |DESCARGA_DEF #espejo@;
     |FINSI;

     |SI enExistencia = 0;
         |BORRA 020#dsm30301.a;
         |LIBERA #dsm30301;
         |ACABA;
     |FINSI;

     |HAZ Totales;

     |ABRE #agicen14;
     |ABRE #agicen30;
     |BUCLE dsmom008;
     |CIERRA #agicen30;
     |CIERRA #agicen14;

     |SI #dsm30301#1 ] 2017;
         #dsm30301#123 = 0;
     |FINSI;

     |SI enNoMod390 = 1;
         #dsm30301#129 = #dsm30301#121 + #dsm30301#122 + #dsm30301#123;
         #dsm30301#129 = #dsm30301#129 + #dsm30301#124 + #dsm30301#125;
         #dsm30301#129 = #dsm30301#129 + #dsm30301#126 + #dsm30301#127;
         #dsm30301#129 = #dsm30301#129 - #dsm30301#128;

         #dsm30301#129 = #dsm30301#129 + #dsm30301#137 + #dsm30301#138;
         #dsm30301#129 = #dsm30301#129 + #dsm30301#139 + #dsm30301#140;
         #dsm30301#129 = #dsm30301#129 + #dsm30301#141 + #dsm30301#142;
         #dsm30301#129 = #dsm30301#129 - #dsm30301#143;

         #dsm30301#120 = "N";

         |ABRE #dsmom004;
         #dsmom004#0 = enEmpresa;
         #dsmom004#1 = enEjer;
         #dsmom004#2 = 99;
         #dsmom004#3 = 347;
         #dsmom004#4 = 0;
         |LEE 040#dsmom004.=;
         |SI FSalida = 0;
             #dsm30301#120 = "S";
         |FINSI;
         |CIERRA #dsmom004;

         |SI enEjer ] 2017; |Y enSwProrr ! 2;
             |HAZ CreaLinProrrata;
         |FINSI;
     |FINSI;

     #dsm30301#130 = "N";
     #dsm30301#144 = "N";

     |SI #dsm30301#2 = 12;
         |SI enNoMod390 = 0;
             #dsm30301#130 = "N";
         |SINO;
             #dsm30301#130 = "S";

             |SI #dsm30301#129 = 0; |Y #dsm30301#1 < 2018;
                 #dsm30301#130 = "X";
             |FINSI;
         |FINSI;
     |FINSI;
     |SI #dsm30301#129 ! 0; |Y  #dsm30301#1 ] 2018;
         #dsm30301#144 = "S";
     |FINSI;

     |GRABA 020#dsm30301.a;
     |LIBERA #dsm30301;

     enExistencia = 1;
|FPRC;

|PROCESO CreaVentana;
     |VENTANA 1401, 3799, nPanta303, -1, "";
     nVentTrab = FSalida;
|FPRC;

|PROCESO Btn8;
     |SI #dsm30301#8 = "S";
         #dsm30301#8 = "N";
         #dsmow205#2 = "N";
         #dsmow224#2 = "N";
         #dsmow227#2 = "N";
     |SINO;
         #dsm30301#8 = "S";
         #dsmow205#2 = "S";
         #dsmow224#2 = "S";
         #dsmow227#2 = "S";
         |SI nSw = 1; |O nSw = 3;
             |SI #dsm30301#131 = "S";
                 #dsm30301#131 = "N";
                 #dsmow224#11  = "N";
                 #dsmow227#11  = "N";
                 |SI nSw = 1; |PINTA #dsmow224#11; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#11; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSw = 0;             |PINTA #dsmow205#2;  |FINSI;
     |SI nSw = 1; |O nSw = 2; |PINTA #dsmow224#2;  |FINSI;
     |SI nSw = 3;             |PINTA #dsmow227#2;  |FINSI;
|FPRC;

|PROCESO Btn9;
     |SI #dsm30301#9 = "S";
         #dsm30301#9 = "N";
         #dsmow205#3 = "N";
         #dsmow224#3 = "N";
         #dsmow227#3 = "N";

         |ESTADO_CONTROL nBtn14,  "DISABLE";
         |ESTADO_CONTROL nBtn15,  "DISABLE";
         |ESTADO_CONTROL nBtn151, "DISABLE";
         |ESTADO_CONTROL nBtn152, "DISABLE";

         #dsmow205#8  = "01.01.0000";
         #dsmow205#9  = "";

         #dsmow224#8  = "01.01.0000";
         #dsmow224#9  = "";

         #dsmow227#8  = "01.01.0000";
         #dsmow227#9  = "";

         #dsm30301#14 = "01.01.0000";
         #dsm30301#15 = "";
     |SINO;
         #dsm30301#9 = "S";
         #dsmow205#3 = "S";
         #dsmow224#3 = "S";
         #dsmow227#3 = "S";

         |ESTADO_CONTROL nBtn14,  "ENABLE";
         |ESTADO_CONTROL nBtn15,  "ENABLE";
         |ESTADO_CONTROL nBtn151, "ENABLE";
         |ESTADO_CONTROL nBtn152, "ENABLE";
         |SI nSw = 1; |O nSw = 3;
             |SI #dsm30301#131 = "S";
                 #dsm30301#131 = "N";
                 #dsmow224#11  = "N";
                 #dsmow227#11  = "N";
                 |SI nSw = 1; |PINTA #dsmow224#11; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#11; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSw = 0;  |PINTA #dsmow205#3;  |FINSI;
     |SI nSw = 0;  |PINTA #dsmow205#8;  |FINSI;
     |SI nSw = 0;  |PINTA #dsmow205#9;  |FINSI;

     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#3;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#8;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#9;  |FINSI;

     |SI nSw = 3;  |PINTA #dsmow227#3;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#8;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#9;  |FINSI;
|FPRC;

|PROCESO Btn131;
     |SI #dsm30301#131 = "S";
         #dsm30301#131 = "N";
         #dsmow205#11  = "N";
         #dsmow224#11  = "N";
         #dsmow227#11  = "N";
     |SINO;
         #dsm30301#131 = "S";
         #dsmow205#11  = "S";
         #dsmow224#11  = "S";
         #dsmow227#11  = "S";
         |SI nSw = 1; |O nSw = 3;
             |SI #dsm30301#8 = "S";
                 #dsm30301#8 = "N";
                 #dsmow224#2 = "N";
                 #dsmow227#2 = "N";
                 |SI nSw = 1; |PINTA #dsmow224#2; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#2; |FINSI;
             |FINSI;
             |SI #dsm30301#9 = "S";
                 #dsm30301#9 = "N";
                 #dsm30301#14 = "01.01.0000";
                 #dsm30301#15 = "";
                 #dsmow224#3  = "N";
                 #dsmow224#8  = "01.01.0000";
                 #dsmow224#9  = "";
                 #dsmow227#3  = "N";
                 #dsmow227#8  = "01.01.0000";
                 #dsmow227#9  = "";
                 |SI nSw = 1; |PINTA #dsmow224#3; |FINSI;
                 |SI nSw = 1; |PINTA #dsmow224#8; |FINSI;
                 |SI nSw = 1; |PINTA #dsmow224#9; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#3; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#8; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#9; |FINSI;
             |FINSI;
             |SI #dsm30301#132 = "S";
                 #dsm30301#132 = "N";
                 #dsmow224#12  = "N";
                 #dsmow227#12  = "N";
                 |SI nSw = 1;  |PINTA #dsmow224#12; |FINSI;
                 |SI nSw = 3;  |PINTA #dsmow227#12; |FINSI;
             |FINSI;
             |SI #dsm30301#12  = "S";
                 #dsm30301#12  = "N";
                 #dsmow224#6   = "N";
                 #dsmow227#6   = "N";
                 |SI nSw = 1;  |PINTA #dsmow224#6; |FINSI;
                 |SI nSw = 3;  |PINTA #dsmow227#6; |FINSI;
             |FINSI;
             |SI #dsm30301#13  = "S";
                 #dsm30301#13  = "N";
                 #dsmow224#7   = "N";
                 #dsmow227#7   = "N";
                 |SI nSw = 1; |PINTA #dsmow224#7; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#7; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSw = 0;  |PINTA #dsmow205#11;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#11;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#11;  |FINSI;
|FPRC;

|PROCESO Btn132;
     |SI #dsm30301#132 = "S";
         #dsm30301#132 = "N";
         #dsmow205#12  = "N";
         #dsmow224#12  = "N";
         #dsmow227#12  = "N";
     |SINO;
         #dsm30301#132 = "S";
         #dsmow205#12  = "S";
         #dsmow224#12  = "S";
         #dsmow227#12  = "S";
         |SI nSw = 1; |O nSw = 3;
             |SI #dsm30301#131 = "S";
                 #dsm30301#131 = "N";
                 #dsmow224#11  = "N";
                 #dsmow227#11  = "N";
                 |SI nSw = 1; |PINTA #dsmow224#11; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#11; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSw = 0;  |PINTA #dsmow205#12;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#12;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#12;  |FINSI;
|FPRC;

|PROCESO Btn12;
     |SI #dsm30301#12 = "S";
         #dsm30301#12 = "N";
         #dsmow205#6  = "N";
         #dsmow224#6  = "N";
         #dsmow227#6  = "N";
     |SINO;
         #dsm30301#12 = "S";
         #dsmow205#6  = "S";
         #dsmow224#6  = "S";
         #dsmow227#6  = "S";
         |SI nSw = 1; |O nSw = 3;
             |SI #dsm30301#131 = "S";
                 #dsm30301#131 = "N";
                 #dsmow224#11  = "N";
                 #dsmow227#11  = "N";
                 |SI nSw = 1; |PINTA #dsmow224#11; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#11; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSw = 0;  |PINTA #dsmow205#6;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#6;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#6;  |FINSI;
|FPRC;

|PROCESO Btn13;
     |SI #dsm30301#13 = "S";
         #dsm30301#13 = "N";
         #dsmow205#7  = "N";
         #dsmow224#7  = "N";
         #dsmow227#7  = "N";
     |SINO;
         #dsm30301#13 = "S";
         #dsmow205#7  = "S";
         #dsmow224#7  = "S";
         #dsmow227#7  = "S";
         |SI nSw = 1; |O nSw = 3;
             |SI #dsm30301#131 = "S";
                 #dsm30301#131 = "N";
                 #dsmow224#11  = "N";
                 #dsmow227#11  = "N";
                 |SI nSw = 1; |PINTA #dsmow224#11; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#11; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSw = 0;  |PINTA #dsmow205#7;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#7;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#7;  |FINSI;
|FPRC;

|PROCESO Btn14;
     |SI nSw = 0;
         |ENCAMPO #8#dsmow205;
         #dsm30301#14 = #dsmow205#8;
     |FINSI;

     |SI nSw = 1; |O nSw = 2;
         |ENCAMPO #8#dsmow224;
         #dsm30301#14 = #dsmow224#8;
     |FINSI;

     |SI nSw = 3;
         |ENCAMPO #8#dsmow227;
         #dsm30301#14 = #dsmow227#8;
     |FINSI;
|FPRC;

|PROCESO Btn15;
     #dsm30301#15 = "";
     #dsmow205#9  = "";
     #dsmow224#9  = "";
     #dsmow227#9  = "";

     |SI nSw = 0;  |PINTA #dsmow205#9;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#9;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#9;  |FINSI;
|FPRC;

|PROCESO Btn151;
     #dsm30301#15 = "1";
     #dsmow205#9  = "1";
     #dsmow224#9  = "1";
     #dsmow227#9  = "1";

     |SI nSw = 0;  |PINTA #dsmow205#9;  |FINSI;
     |SI nSw = 1; |O nSw = 2; |PINTA #dsmow224#9;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#9;  |FINSI;
|FPRC;

|PROCESO Btn152;
     #dsm30301#15 = "2";
     #dsmow205#9  = "2";
     #dsmow224#9  = "2";
     #dsmow227#9  = "2";

     |SI nSw = 0;  |PINTA #dsmow205#9;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#9;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#9;  |FINSI;
|FPRC;

|PROCESO Btn212_11;
     |C_M #dsmow212#11, 1, "S";

     |ENCAMPO #11#dsmow212;

     #dsm30301#94 = #dsmow212#11;

     nEjerAnt  = #dsm30301#84;
     |HAZ Totales;

     |PARA nDCampo = 0;  |SI nDCampo [ 10;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 81;
           #dsmow212#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     #dsmow212#11 = #dsm30301#94;
     #dsmow212#12 = #dsm30301#95;

     |C_M #dsmow212#11, 1, "N";

     |PINDA #0#dsmow212;
|FPRC;

|PROCESO Btn212_12;
     |C_M #dsmow212#12, 1, "S";

     |ENCAMPO #12#dsmow212;

     #dsm30301#95 = #dsmow212#12;

     nEjerAnt  = #dsm30301#84;
     |HAZ Totales;

     |PARA nDCampo = 0;  |SI nDCampo [ 10;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 81;
           #dsmow212#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     #dsmow212#11 = #dsm30301#94;
     #dsmow212#12 = #dsm30301#95;

     |C_M #dsmow212#12, 1, "N";

     |PINDA #0#dsmow212;
|FPRC;

|PROCESO Punto01_w205;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 9;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 6;
           #dsmow205#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     #dsmow205#10 = #dsm30301#130;

     |SI #dsmow205#1 = "G";
         #dsmow205#1 = "N";
     |FINSI;

     |PINPA #0#dsmow205;   nPanta205 = FSalida;
     |PINDA #0#dsmow205;

     |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 0904, 0905, Btn8;   nBtn8   = FSalida;
     |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 2004, 2005, Btn9;   nBtn9   = FSalida;
     |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 2163, 2164, Btn14;  nBtn14  = FSalida;
     |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 2408, 2409, Btn15;  nBtn15  = FSalida;
     |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 2508, 2509, Btn151; nBtn151 = FSalida;
     |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 2608, 2609, Btn152; nBtn152 = FSalida;

     |SI #dsm30301#2 = 12;
         |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 1204, 1205, Btn12; nBtn12  = FSalida;
         |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 1304, 1305, Btn13; nBtn13  = FSalida;
     |FINSI;

     |SI #dsm30301#9 = "N";
         |ESTADO_CONTROL nBtn14,  "DISABLE";
         |ESTADO_CONTROL nBtn15,  "DISABLE";
         |ESTADO_CONTROL nBtn151, "DISABLE";
         |ESTADO_CONTROL nBtn152, "DISABLE";
     |FINSI;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Punto01_w224;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 9;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 6;
           #dsmow224#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     #dsmow224#10 = #dsm30301#130;
     #dsmow224#11 = #dsm30301#131;
     #dsmow224#12 = #dsm30301#132;
     |SI #dsmow224#11 = " "; #dsmow224#11 = "N"; |FINSI;
     |SI #dsmow224#12 = " "; #dsmow224#12 = "N"; |FINSI;
     |SI nSw = 2;  #dsmow224#11 = " ";  #dsmow224#12 = " "; |FINSI;

     |SI #dsmow224#1 = "G";  #dsmow224#1 = "N"; |FINSI;

     nOk = 0;
     |SI #dsm30301#6 = "S"; |O #dsm30301#7 ! "G"; |O #dsm30301#10 = "S";
        |O #dsm30301#11 = "S"; |O #dsm30301#12 = "S";
          |O #dsm30301#13 = "S"; |O #dsm30301#130 = "S";
        nOk = 1;
     |FINSI;

     |PINPA #0#dsmow224;   nPanta224 = FSalida;
     |PINDA #0#dsmow224;

     |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 0904, 0905, Btn8;   nBtn8   = FSalida;
     |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 2204, 2205, Btn9;   nBtn9   = FSalida;
     |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 2363, 2364, Btn14;  nBtn14  = FSalida;
     |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 2608, 2609, Btn15;  nBtn15  = FSalida;
     |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 2708, 2709, Btn151; nBtn151 = FSalida;
     |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 2808, 2809, Btn152; nBtn152 = FSalida;

     |SI #dsm30301#2 = 12;
         |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 1204, 1205, Btn12; nBtn12  = FSalida;
         |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 1304, 1305, Btn13; nBtn13  = FSalida;
     |FINSI;

     |SI nSw = 1;
         |SI nOk = 0;
             |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 0604, 0605, Btn131; nBtn131 = FSalida;
         |FINSI;
         |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 2004, 2005, Btn132; nBtn132 = FSalida;
     |FINSI;

     |SI #dsm30301#9 = "N";
         |ESTADO_CONTROL nBtn14,  "DISABLE";
         |ESTADO_CONTROL nBtn15,  "DISABLE";
         |ESTADO_CONTROL nBtn151, "DISABLE";
         |ESTADO_CONTROL nBtn152, "DISABLE";
     |FINSI;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Punto01_w227;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 9;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 6;
           #dsmow227#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     |SI #dsm30301#130 = "S"; |Y #dsm30301#144 = " ";
         #dsm30301#144 = "S";
     |FINSI;
     |SI #dsm30301#130 = "X";
         #dsm30301#144 = "N";
         #dsm30301#130 = "S";
     |FINSI;

     #dsmow227#10 = #dsm30301#130;
     #dsmow227#11 = #dsm30301#131;
     #dsmow227#12 = #dsm30301#132;
     #dsmow227#13 = #dsm30301#144;
     |SI #dsmow227#10 = " "; #dsmow227#10 = "N"; |FINSI;
     |SI #dsmow227#11 = " "; #dsmow227#11 = "N"; |FINSI;
     |SI #dsmow227#12 = " "; #dsmow227#12 = "N"; |FINSI;
     |SI #dsmow227#13 = " "; #dsmow227#13 = "N"; |FINSI;

     |SI #dsmow227#1 = "G";  #dsmow227#1 = "N"; |FINSI;

     nOk = 0;
     |SI #dsm30301#6 = "S"; |O #dsm30301#7 ! "G"; |O #dsm30301#10 = "S";
        |O #dsm30301#11 = "S"; |O #dsm30301#12 = "S";
          |O #dsm30301#13 = "S"; |O #dsm30301#130 = "S";
        nOk = 1;
     |FINSI;

     |PINPA #0#dsmow227;   nPanta227 = FSalida;
     |PINDA #0#dsmow227;

     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 0904, 0905, Btn8;   nBtn8   = FSalida;
     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 1904, 1905, Btn9;   nBtn9   = FSalida;
     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 2063, 2064, Btn14;  nBtn14  = FSalida;
     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 2308, 2309, Btn15;  nBtn15  = FSalida;
     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 2408, 2409, Btn151; nBtn151 = FSalida;
     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 2508, 2509, Btn152; nBtn152 = FSalida;

     |SI #dsm30301#2 = 12;
         |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 1204, 1205, Btn12; nBtn12  = FSalida;
         |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 1304, 1305, Btn13; nBtn13  = FSalida;
     |FINSI;

     |SI nOk = 0;
         |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 0604, 0605, Btn131; nBtn131 = FSalida;
     |FINSI;
||     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 1504, 1505, Btn132; nBtn132 = FSalida;

     |SI #dsm30301#9 = "N";
         |ESTADO_CONTROL nBtn14,  "DISABLE";
         |ESTADO_CONTROL nBtn15,  "DISABLE";
         |ESTADO_CONTROL nBtn151, "DISABLE";
         |ESTADO_CONTROL nBtn152, "DISABLE";
     |FINSI;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Punto01;
     nSw = 0;
     |SI #dsm30301#1 ] 2018;                      nSw = 3; |FINSI;
     |SI #dsm30301#1 = 2018; |Y #dsm30301#2 < 12; nSw = 1; |FINSI;
     |SI #dsm30301#1 = 2018; |Y #dsm30301#2 = 1;  nSw = 2; |FINSI;

     |SI nSw = 0;              |HAZ Punto01_w205;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |HAZ Punto01_w224;  |FINSI;
     |SI nSw = 3;              |HAZ Punto01_w227;  |FINSI;
|FPRC;

|PROCESO Punto02;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 45;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 16;
           #dsmow206#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     |PINPA #0#dsmow206;
     |PINDA #0#dsmow206;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Evt02;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsm30302.=;

         |PARA nDCampo = 0;  |SI nDCampo [ 8;  |HACIENDO nDCampo = nDCampo + 1;
                nHCampo = nDCampo + 6;
                #dsmow209#nDCampo# = #dsm30302#nHCampo#;

                |C_V #dsmow209#nDCampo#, 0, aAlfa;
                |SI aAlfa = "S";
                    |PINTA #dsmow209#nDCampo#;
                |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Baja02;
     #dsm30302#0 = enEmpresa;
     #dsm30302#1 = enEjer;
     #dsm30302#2 = enPeriodo;
     #dsm30302#3 = enModelo;
     #dsm30302#4 = enComplem;
     #dsm30302#5 = enActividad;
     #dsm30302#6 = 001;
|FPRC;

|PROCESO Alta02;
     #dsm30302#0 = enEmpresa;
     #dsm30302#1 = enEjer;
     #dsm30302#2 = enPeriodo;
     #dsm30302#3 = enModelo;
     #dsm30302#4 = enComplem;
     #dsm30302#5 = enActividad;
     #dsm30302#6 = 999;
|FPRC;

|PROCESO Punto03;
     |HAZ CreaVentana;

     |PINPA #0#dsmow209;

     |PTEC 802;  |PAUSA;

     |DDEFECTO #dsmow209;
     |PINDA #0#dsmow209;

     nRango = 2 + 4 + 8 + 32 + 128;

     |LINEAL_SIMPLE #1#dsm30302, nRango, 0502, 1198, Baja02, Alta02, Evt02;
     nGrid02 = FSalida;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Evt03;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsm30303.=;

         |PARA nDCampo = 0;  |SI nDCampo [ 27; |HACIENDO nDCampo = nDCampo + 1;
                nHCampo = nDCampo + 6;
                #dsmow210#nDCampo# = #dsm30303#nHCampo#;

                |C_V #dsmow210#nDCampo#, 0, aAlfa;
                |SI aAlfa = "S";
                    |PINTA #dsmow210#nDCampo#;
                |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Baja03;
     #dsm30303#0 = enEmpresa;
     #dsm30303#1 = enEjer;
     #dsm30303#2 = enPeriodo;
     #dsm30303#3 = enModelo;
     #dsm30303#4 = enComplem;
     #dsm30303#5 = 00;
|FPRC;

|PROCESO Alta03
     #dsm30303#0 = enEmpresa;
     #dsm30303#1 = enEjer;
     #dsm30303#2 = enPeriodo;
     #dsm30303#3 = enModelo;
     #dsm30303#4 = enComplem;
     #dsm30303#5 = 99;
|FPRC;

|PROCESO Punto04;
     |HAZ CreaVentana;

     |PINPA #0#dsmow210;

     |PTEC 802;  |PAUSA;

     |DDEFECTO #dsmow210;
     |PINDA #0#dsmow210;

     nRango = 2 + 4 + 8 + 32 + 128;

     |LINEAL_SIMPLE #1#dsm30303, nRango, 0502, 1198, Baja03, Alta03, Evt03;
     nGrid03 = FSalida;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Punto05;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 11;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 62;
           #dsmow207#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     |PINPA #0#dsmow207;
     |PINDA #0#dsmow207;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Punto06;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 6;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 74;
           #dsmow208#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     |PINPA #0#dsmow208;
     |PINDA #0#dsmow208;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Cancelar;
     |PTEC 807;
|FPRC;

|PROCESO Validar;
     |PTEC 806;
|FPRC;

|PROCESO Modw213;
     nIdSalir  = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir, "HIDE";

     |ESTADO_CONTROL nTree,      "DISABLE";
     |ESTADO_CONTROL nBtnMod213, "DISABLE";

     |CONTROL_SIMPLE nPanta213, "BOTON,{{206}}Validar", 3072, 3084,  Validar;
     nBtnVal = FSalida;

     |CONTROL_SIMPLE nPanta213, "BOTON,{{207}}Cancelar", 3086, 3098, Cancelar;
     nBtnCan = FSalida;

     |ENDATOS #1#dsmow213;
     |SI FSalida = 0;
         |PARA nDCampo = 0;  |SI nDCampo [ 34;  |HACIENDO nDCampo = nDCampo + 1;
               nHCampo = nDCampo + 96;
               #dsm30301#nHCampo# = #dsmow213#nDCampo#;
         |SIGUE;
     |FINSI;

     |ESTADO_CONTROL nTree,      "ENABLE";
     |ESTADO_CONTROL nIdSalir,   "SHOW";
     |ESTADO_CONTROL nBtnMod213, "ENABLE";

     |FIN_CONTROL_WINDOWS nBtnVal;
     |FIN_CONTROL_WINDOWS nBtnCan;
|FPRC;

|PROCESO Punto07;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 34;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 96;
           #dsmow213#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     |PINPA #0#dsmow213; nPanta213 = FSalida;
     |PINDA #0#dsmow213;

     |CONTROL_SIMPLE nPanta213, "BOTON,{{197}}Modificar", 3002, 3013, Modw213;
     nBtnMod213 = FSalida;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Punto08;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 10;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 81;
           #dsmow212#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     #dsmow212#11 = #dsm30301#94;
     #dsmow212#12 = #dsm30301#95;

     |PINPA #0#dsmow212;  nPanta212 = FSalida;
     |PINDA #0#dsmow212;

     |CONTROL_SIMPLE nPanta212, "BOTON,{{197}}", 0680, 0682, Btn212_11;
     |CONTROL_SIMPLE nPanta212, "BOTON,{{197}}", 0980, 0982, Btn212_12;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Modw220;
     nIdSalir = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir, "HIDE";

     |ESTADO_CONTROL nTree,      "DISABLE";
     |ESTADO_CONTROL nBtnMod220, "DISABLE";

     |CONTROL_SIMPLE nPanta220, "BOTON,{{206}}Validar", 3072, 3084,  Validar;
     nBtnVal = FSalida;

     |CONTROL_SIMPLE nPanta220, "BOTON,{{207}}Cancelar", 3086, 3098, Cancelar;
     nBtnCan = FSalida;

     |ENDATOS #1#dsmow220;
     |SI FSalida = 0;
         |PARA nDCampo = 0;  |SI nDCampo [ 24;  |HACIENDO nDCampo = nDCampo + 1;
               nHCampo = nDCampo + 96;
               #dsm30301#nHCampo# = #dsmow220#nDCampo#;
         |SIGUE;
     |FINSI;
     #dsm30301#133 = #dsmow220#25;
     #dsm30301#134 = #dsmow220#26;
     #dsm30301#135 = #dsmow220#27;
     #dsm30301#136 = #dsmow220#28;
     #dsm30301#145 = #dsmow220#29;

     |ESTADO_CONTROL nTree,      "ENABLE";
     |ESTADO_CONTROL nIdSalir,   "SHOW";
     |ESTADO_CONTROL nBtnMod220, "ENABLE";

     |FIN_CONTROL_WINDOWS nBtnVal;
     |FIN_CONTROL_WINDOWS nBtnCan;
|FPRC;

|PROCESO Punto09;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 24;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 96;
           #dsmow220#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     #dsmow220#25 = #dsm30301#133;
     #dsmow220#26 = #dsm30301#134;
     #dsmow220#27 = #dsm30301#135;
     #dsmow220#28 = #dsm30301#136;
     #dsmow220#29 = #dsm30301#145;

     |PINPA #0#dsmow220; nPanta220 = FSalida;
     |PINDA #0#dsmow220;

     |CONTROL_SIMPLE nPanta220, "BOTON,{{197}}Modificar", 3002, 3013, Modw220;
     nBtnMod220 = FSalida;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Modw221;
     nIdSalir = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir, "HIDE";

     |ESTADO_CONTROL nTree,      "DISABLE";
     |ESTADO_CONTROL nBtnMod221, "DISABLE";

     |CONTROL_SIMPLE nPanta221, "BOTON,{{206}}Validar", 3072, 3084,  Validar;
     nBtnVal = FSalida;

     |CONTROL_SIMPLE nPanta221, "BOTON,{{207}}Cancelar", 3086, 3098, Cancelar;
     nBtnCan = FSalida;

     |ENDATOS #1#dsmow221;
     |SI FSalida = 0;
         |PARA nDCampo = 0;  |SI nDCampo [ 15;  |HACIENDO nDCampo = nDCampo + 1;
               |SI nDCampo [ 8; nHCampo = nDCampo + 121; |FINSI;
               |SI nDCampo > 8; nHCampo = nDCampo + 128; |FINSI;
               #dsm30301#nHCampo# = #dsmow221#nDCampo#;
         |SIGUE;
         |SI #dsm30301#1 ] 2018;
             #dsm30301#144 = "N";
             |SI #dsm30301#129 ! 0;
                 #dsm30301#144 = "S";
             |FINSI;
         |FINSI;
     |FINSI;

     |ESTADO_CONTROL nTree,      "ENABLE";
     |ESTADO_CONTROL nIdSalir,   "SHOW";
     |ESTADO_CONTROL nBtnMod221, "ENABLE";

     |FIN_CONTROL_WINDOWS nBtnVal;
     |FIN_CONTROL_WINDOWS nBtnCan;
|FPRC;

|PROCESO Punto10;
     |HAZ CreaVentana;

     #dsmow221#0  = #dsm30301#121;
     #dsmow221#1  = #dsm30301#122;
     #dsmow221#2  = #dsm30301#123;
     #dsmow221#3  = #dsm30301#124;
     #dsmow221#4  = #dsm30301#125;
     #dsmow221#5  = #dsm30301#126;
     #dsmow221#6  = #dsm30301#127;
     #dsmow221#7  = #dsm30301#128;
     #dsmow221#8  = #dsm30301#129;
     #dsmow221#9  = #dsm30301#137;
     #dsmow221#10 = #dsm30301#138;
     #dsmow221#11 = #dsm30301#139;
     #dsmow221#12 = #dsm30301#140;
     #dsmow221#13 = #dsm30301#141;
     #dsmow221#14 = #dsm30301#142;
     #dsmow221#15 = #dsm30301#143;

     |PINPA #0#dsmow221; nPanta221 = FSalida;
     |PINDA #0#dsmow221;

     |CONTROL_SIMPLE nPanta221, "BOTON,{{197}}Modificar", 3002, 3013, Modw221;
     nBtnMod221 = FSalida;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;

|FPRC;

|PROCESO Modw222;
     |LEE 101#dsm30304.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nIdSalir  = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir,   "HIDE";
     |ESTADO_CONTROL nTree,      "DISABLE";
     |ESTADO_CONTROL nBtnMod222, "DISABLE";

     |CONTROL_SIMPLE nPanta222, "BOTON,{{206}}Validar", 3072, 3084,  Validar;
     nBtnVal = FSalida;

     |CONTROL_SIMPLE nPanta222, "BOTON,{{207}}Cancelar", 3086, 3098, Cancelar;
     nBtnCan = FSalida;

     |ENDATOS #1#dsmow222;
     |SI FSalida = 0;
         #dsm30304#4  = #dsmow222#0;
         #dsm30304#5  = #dsmow222#1;
         #dsm30304#6  = #dsmow222#2;
         #dsm30304#7  = #dsmow222#3;
         #dsm30304#8  = #dsmow222#4;
         #dsm30304#9  = #dsmow222#5;
         #dsm30304#10 = #dsmow222#6;

         |GRABA 020#dsm30304.a;
     |FINSI;
     |LIBERA #dsm30304;

     |FIN_CONTROL_WINDOWS nBtnVal;
     |FIN_CONTROL_WINDOWS nBtnCan;

     |ESTADO_CONTROL nIdSalir,   "SHOW";
     |ESTADO_CONTROL nTree,      "ENABLE";
     |ESTADO_CONTROL nBtnMod222, "ENABLE";

     |REFRESCACONTROL nGrid04;
     |FOCOTECLADO nGrid04;
|FPRC;

|PROCESO Evt04;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsm30304.=;

         #dsmow222#0  = #dsm30304#4;   |PINTA #dsmow222#0;
         #dsmow222#1  = #dsm30304#5;   |PINTA #dsmow222#1;
         #dsmow222#2  = #dsm30304#6;   |PINTA #dsmow222#2;
         #dsmow222#3  = #dsm30304#7;   |PINTA #dsmow222#3;
         #dsmow222#4  = #dsm30304#8;   |PINTA #dsmow222#4;
         #dsmow222#5  = #dsm30304#9;   |PINTA #dsmow222#5;
         #dsmow222#6  = #dsm30304#10;  |PINTA #dsmow222#6;

         |ESTADO_CONTROL nBtnMod222, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO Baja04;
     #dsm30304#0 = enEmpresa;
     #dsm30304#1 = enEjer;
     #dsm30304#2 = enModelo;
     #dsm30304#3 = enComplem;
     #dsm30304#4 = 01;
|FPRC;

|PROCESO Alta04;
     #dsm30304#0 = enEmpresa;
     #dsm30304#1 = enEjer;
     #dsm30304#2 = enModelo;
     #dsm30304#3 = enComplem;
     #dsm30304#4 = 99;
|FPRC;

|PROCESO Punto11;
     |HAZ CreaVentana;

     |PINPA #0#dsmow222; nPanta222 = FSalida;

     |PTEC 802;  |PAUSA;

     |DDEFECTO #dsmow222;
     |PINDA #0#dsmow222;

     |CONTROL_SIMPLE nPanta222, "BOTON,{{197}}Modificar", 1786, 1798, Modw222;
     nBtnMod222 = FSalida;

     |ESTADO_CONTROL nBtnMod222, "DISABLE";

     nRango = 2 + 4 + 8 + 32 + 128;

     |LINEAL_SIMPLE #1#dsm30304, nRango, 0502, 1698, Baja04, Alta04, Evt04;
     nGrid04 = FSalida;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Iguala223;
    |DDEFECTO #dsm30305;
    #dsm30305#0 = #dsm30301#0;
    #dsm30305#1 = #dsm30301#1;
    #dsm30305#2 = #dsm30301#3;
    #dsm30305#3 = #dsm30301#4;
    #dsm30305#4 = nLinea;
    |LEE 141#dsm30305.=;
    nEstado = FSalida;

    nNume1 = 1; |SI #dsm30305#4 = 2; nNume1 = 20; |FINSI;
    nNume2 = nNume1 + 17;
    nNume3 = 5;
    |PARA nDCampo = nNume1;  |SI nDCampo [ nNume2;  |HACIENDO nDCampo = nDCampo + 1;
          |SI nOpera = 1; #dsm30305#nNume3# = #dsmow223#nDCampo#; |FINSI;
          |SI nOpera = 4; #dsmow223#nDCampo# = #dsm30305#nNume3#; |FINSI;
          nNume3 = nNume3 + 1;
    |SIGUE;
    |SI nOpera = 1;
        |SI nEstado = 0; |GRABA 020#dsm30305.a; |FINSI;
        |SI nEstado ! 0; |GRABA 020#dsm30305.n; |FINSI;
    |FINSI;

    |LIBERA #dsm30305;
|FPRC;

|PROCESO Modw223;
     nIdSalir = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir, "HIDE";

     |ESTADO_CONTROL nTree,      "DISABLE";
     |ESTADO_CONTROL nBtnMod223, "DISABLE";

     |CONTROL_SIMPLE nPanta223, "BOTON,{{206}}Validar", 3072, 3084,  Validar;
     nBtnVal = FSalida;

     |CONTROL_SIMPLE nPanta223, "BOTON,{{207}}Cancelar", 3086, 3098, Cancelar;
     nBtnCan = FSalida;

     |ENDATOS #1#dsmow223;
     |SI FSalida = 0;
         |ABRE #dsm30305;
         nOpera = 1;
         nLinea = 1; |HAZ Iguala223;
         nLinea = 2; |HAZ Iguala223;
         |CIERRA #dsm30305;
     |FINSI;

     |ESTADO_CONTROL nTree,      "ENABLE";
     |ESTADO_CONTROL nIdSalir,   "SHOW";
     |ESTADO_CONTROL nBtnMod223, "ENABLE";

     |FIN_CONTROL_WINDOWS nBtnVal;
     |FIN_CONTROL_WINDOWS nBtnCan;
|FPRC;

|PROCESO Punto12;
     |HAZ CreaVentana;

     |DDEFECTO #dsmow223;
     |ABRE #dsm30305;
     nOpera = 4;
     nLinea = 1; |HAZ Iguala223;
     nLinea = 2; |HAZ Iguala223;
     |CIERRA #dsm30305;

     |PINPA #0#dsmow223; nPanta223 = FSalida;
     |PINDA #0#dsmow223;

     |CONTROL_SIMPLE nPanta223, "BOTON,{{197}}Modificar", 3002, 3013, Modw223;
     nBtnMod223 = FSalida;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO EventoTree;
     |SI nPintaSalir = 0;  |ACABA;  |FINSI;
     |SI FEntrada ! 0;     |ACABA;  |FINSI;

     aAlfa = Contenido % -102;  |QBT aAlfa;

     |SI nGrid02 ! -1;
         |DESTRUYECONTROL nGrid02;
         nGrid02 = -1;
     |FINSI;

     |SI nGrid03 ! -1;
         |DESTRUYECONTROL nGrid03;
         nGrid03 = -1;
     |FINSI;

     |SI nGrid04 ! -1;
         |DESTRUYECONTROL nGrid04;
         nGrid04 = -1;
     |FINSI;

     |SI nVentTrab ! -1;
         |FINVENTANA nVentTrab;
         nVentTrab = -1;
     |FINSI;

     |SI aAlfa = "01";  |HAZ Punto01; |FINSI;
     |SI aAlfa = "02";  |HAZ Punto02; |FINSI;
     |SI aAlfa = "03";  |HAZ Punto03; |FINSI;
     |SI aAlfa = "04";  |HAZ Punto04; |FINSI;
     |SI aAlfa = "05";  |HAZ Punto05; |FINSI;
     |SI aAlfa = "06";  |HAZ Punto06; |FINSI;
     |SI aAlfa = "07";  |HAZ Punto07; |FINSI;
     |SI aAlfa = "08";  |HAZ Punto08; |FINSI;
     |SI aAlfa = "09";  |HAZ Punto09; |FINSI;
     |SI aAlfa = "10";  |HAZ Punto10; |FINSI;
     |SI aAlfa = "11";  |HAZ Punto11; |FINSI;
     |SI aAlfa = "12";  |HAZ Punto12; |FINSI;
|FPRC;

|PROCESO TraeTxtComprimido;
     aAlfa = aRutaOrigen + aFicheroTar + " " + aFicheroTxt;
     |ATAR aAlfa, aRutaOrigen;

     |PARA;  |SI;  |HACIENDO;
          aAbre = aRutaOrigen + aFicheroTar;
          |XABRE "E", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     aAlfa = aRutaOrigen + aFicheroTar;
     |COMPRIME aAlfa;

     |PARA;  |SI;  |HACIENDO;
          aAbre = aRutaOrigen + aFicheroTgz;
          |XABRE "E", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     aAlfa = aRutaOrigen + aFicheroTxt;  |FBORRA aAlfa;
     aAlfa = aRutaOrigen + aFicheroTar;  |FBORRA aAlfa;

     aOrigen  = aRutaOrigen  + aFicheroTgz;
     aDestino = aRutaDestino + aFicheroTgz;

     |RFBORRA aDestino;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |PARA;  |SI;  |HACIENDO;
          aAbre = aRutaDestino + aFicheroTgz;
          |XABRE "EC", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     Pos   = -1;
     aAlfa = aRutaDestino + aFicheroTgz;
     |RDESCOMPRIME aAlfa;

     |PARA;  |SI;  |HACIENDO;
          aAbre = aRutaDestino + aFicheroTar;
          |XABRE "EC", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     |RDETAR aAlfa, aRutaDestino;

     |PARA;  |SI;  |HACIENDO;
          aAbre = aRutaDestino + aFicheroTxt;
          |XABRE "EC", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     aAlfa = aRutaOrigen  + aFicheroTgz;  |FBORRA aAlfa;
     aAlfa = aRutaDestino + aFicheroTgz;  |RFBORRA aAlfa;
     aAlfa = aRutaDestino + aFicheroTar;  |RFBORRA aAlfa;
|FPRC;

|PROCESO CargaArbol;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO MontaArbol;
     |PTEC 802;  |PAUSA;

     |HAZ LeeUnidadBasico;

     |DBASE aBase;  |QBF aBase;
     aRutaOrigen  = aBase + "tmp";   |MKDIR aRutaOrigen;
     aRutaOrigen  = aRutaOrigen + "/";
     aRutaDestino = eaUnidadBasico + "\modelos";    |RMKDIR aRutaDestino;
     aRutaDestino = aRutaDestino + "\tmp";  |RMKDIR aRutaDestino;
     aRutaDestino = aRutaDestino + "\";

     aFicheroTxt  = "dsm3030101" + Usuario + ".txt";
     aFicheroTgz  = "dsm3030101" + Usuario + ".tgz";
     aFicheroTar  = "dsm3030101" + Usuario + ".tar";

     aAbre = aRutaOrigen + aFicheroTxt;

     sT_nID   = nTree;
     sT_nOper = 0;

     |XABRE "WB", aAbre, nHandle;

     nLinea  = 0;

     nLinea  = nLinea + 1;
     aAlfa   = nLinea + ":Identificacin {{01}}";
     |HAZ CargaArbol;

     nLinea  = nLinea + 1;
     aAlfa   = nLinea + ":Rgimen general {{02}}";
     |HAZ CargaArbol;

     |SI enEjer ] 2017;
         nLinea  = nLinea + 1;
         aAlfa   = nLinea + ":Rgimen simplificado ";
         |HAZ CargaArbol;

         aAlfa   = nLinea + ",1:Actividades agrcolas, ganaderas y forestales {{03}}";
         |HAZ CargaArbol;

         aAlfa   = nLinea + ",2:Actividades en rgimen simplificado {{04}}";
         |HAZ CargaArbol;

         aAlfa   = nLinea + ",3:Totales {{05}}";
         |HAZ CargaArbol;
     |SINO;
         nLinea  = nLinea + 1;
         aAlfa   = nLinea + ":Rgimen simplificado - Actividades agrcolas, ganaderas y forestales {{03}}";
         |HAZ CargaArbol;

         nLinea  = nLinea + 1;
         aAlfa   = nLinea + ":Rgimen simplificado - Actividades en rgimen simplificado {{04}}";
         |HAZ CargaArbol;

         nLinea  = nLinea + 1;
         aAlfa   = nLinea + ":Rgimen simplificado - Totales {{05}}";
         |HAZ CargaArbol;
     |FINSI;

     nLinea  = nLinea + 1;
     aAlfa   = nLinea + ":Informacin adicional {{06}}";
     |HAZ CargaArbol;

     |SI enNoMod390 = 1;
         |SI enEjer ] 2017;
             nLinea  = nLinea + 1;
             aAlfa   = nLinea + ":Sujetos pasivos que queden exonerados de la Declaracin anual";
             |HAZ CargaArbol;

             aAlfa   = nLinea + ",1:Actividades a las que se refiere la declaracin {{09}}";
             |HAZ CargaArbol;

             aAlfa   = nLinea + ",2:Operaciones realizadas en el ejercicio {{10}}";
             |HAZ CargaArbol;

             aAlfa   = nLinea + ",3:Prorrata {{11}}";
             |HAZ CargaArbol;

             aAlfa   = nLinea + ",4:Actividades con regmenes de deduccin diferenciados {{12}}";
             |HAZ CargaArbol;
         |SINO;
             nLinea  = nLinea + 1;
             aAlfa   = nLinea + ":Sujetos pasivos que queden exonerados de la Declaracin anual {{07}}";
             |HAZ CargaArbol;

         |FINSI;
     |FINSI;

     nLinea  = nLinea + 1;
     aAlfa   = nLinea + ":Resultados {{08}}";
     |HAZ CargaArbol;

     |XCIERRA nHandle;

     |HAZ TraeTxtComprimido;
     aAlfa = aRutaDestino + aFicheroTxt;

     aAlfa = "TREECTRL,Apartados {{" + aAlfa + "}}";
     |CONTROL_SIMPLE nPanta303, aAlfa, 0602, 1398, EventoTree;
     nTree = FSalida;

     aFicheroTxt   = "dsm3030101" + Usuario + ".txt";
     aAlfa         = aRutaDestino + aFicheroTxt;
     |RFBORRA aAlfa;

     sT_nID   = nTree;
     sT_nOper = 2;
     sT_aData = "1:";
     |ESPECIFICA "COMMANDCONTROL", sTree;

     sT_nID   = nTree;
     sT_nOper = 2;
     sT_aData = "0:";
     |ESPECIFICA "COMMANDCONTROL", sTree;
|FPRC;

|PROCESO MontaApartados;
     #dsm30301#0 = enEmpresa;
     #dsm30301#1 = enEjer;
     #dsm30301#2 = enPeriodo;
     #dsm30301#3 = enModelo;
     #dsm30301#4 = enComplem;
     #dsm30301#5 = enActividad;
     |LEE 101#dsm30301.=;
     |SI FSalida ! 0;
         |MENAV "0000No existe registro.";
         |ACABA;
     |FINSI;

     #dsm30301#130 = "N";
     |SI #dsm30301#2 = 12;
         |SI enNoMod390 = 0;
             #dsm30301#130 = "N";
         |SINO;
             #dsm30301#130 = "S";

             |SI #dsm30301#129 = 0; |Y #dsm30301#1 < 2018;
                 #dsm30301#130 = "X";
             |FINSI;
         |FINSI;
     |FINSI;
     |SI #dsm30301#129 ! 0; |Y  #dsm30301#1 ] 2018;
         #dsm30301#144 = "S";
     |FINSI;

     |VENTANA 0501, 3899, -1, 0,  "";
     nVentana = FSalida;

     |PINPA #0#dsm30301;  nPanta303 = FSalida;

     enCodCli = enEmpresa;
     |HAZ LeePersona;

     aAlfa = "LABEL,{{15}}Modelo 303 (" + (("00000" + enEmpresa) % -105) + " " + #clientes@#2;  |QBF aAlfa;
     aAlfa = aAlfa + ")";
     |CONTROL_SIMPLE nPanta303, aAlfa, 0502, 0598, NULL;

     nPintaSalir = 0;
     |HAZ MontaArbol;

     aEsc1      = &255 + "806";
     aEsc2      = &255 + "807";
     aRetu      = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         nPintaSalir = 1;
         FSalida = "::{{001}}Salir," + nTree;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |GRABA 020#dsm30301.a;
     |LIBERA #dsm30301;

     |ABRE #dsmom004;
     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = enEjer;
     #dsmom004#2 = enPeriodo;
     #dsmom004#3 = enModelo;
     #dsmom004#4 = enComplem;
     |LEE 1010#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#15 = #dsm30301#88;
         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;

     |PULSATECLA;

     |FINVENTANA nVentana;
|FPRC;

|PROCESO dsm30302B;
     |BORRA 020#dsm30302.a;
     |LIBERA #dsm30302;
|FPRC;

|DEFBUCLE dsm30302B;
     #dsm30302#1;
     ;
     #dsm30301#0,#dsm30301#1,#dsm30301#2,#dsm30301#3,#dsm30301#4,00,000;
     #dsm30301#0,#dsm30301#1,#dsm30301#2,#dsm30301#3,#dsm30301#4,99,999;
     be;
     NULL, dsm30302B;
|FIN;

|PROCESO dsm30303B;
     |BORRA 020#dsm30303.a;
     |LIBERA #dsm30303;
|FPRC;

|DEFBUCLE dsm30303B;
     #dsm30303#1;
     ;
     #dsm30301#0,#dsm30301#1,#dsm30301#2,#dsm30301#3,#dsm30301#4,00;
     #dsm30301#0,#dsm30301#1,#dsm30301#2,#dsm30301#3,#dsm30301#4,99;
     be;
     NULL, dsm30303B;
|FIN;

|PROCESO dsm30304B;
     |BORRA 020#dsm30304.a;
     |LIBERA #dsm30304;
|FPRC;

|DEFBUCLE dsm30304B;
     #dsm30304#1;
     ;
     #dsm30301#0,#dsm30301#1,#dsm30301#3,#dsm30301#4,01;
     #dsm30301#0,#dsm30301#1,#dsm30301#3,#dsm30301#4,99;
     be;
     NULL, dsm30304B;
|FIN;

|PROCESO dsm30305B;
     |BORRA 020#dsm30305.a;
     |LIBERA #dsm30305;
|FPRC;

|DEFBUCLE dsm30305B;
     #dsm30305#1;
     ;
     #dsm30301#0,#dsm30301#1,#dsm30301#3,#dsm30301#4,1;
     #dsm30301#0,#dsm30301#1,#dsm30301#3,#dsm30301#4,9;
     be;
     NULL, dsm30305B;
|FIN;

|PROGRAMA;
     eaNomDef  = "dsm30301";

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
         |HAZ MontaApartados;
     |FINSI;

|| \\\\\\ Grabacion del modelo

     |SI enTipoEntrada = 98;
         aGuardo8   = "N";
         aGuardo9   = "N";
         aGuardo12  = "N";
         aGuardo13  = "N";
         aGuardo14  = "01.01.0000";
         aGuardo15  = "";
         nGuardo76  = 0;
         nGuardo77  = 0;
         aGuardo130 = " ";
         aGuardo131 = " ";
         aGuardo132 = " ";

         #dsm30301#0 = enEmpresa;
         #dsm30301#1 = enEjer;
         #dsm30301#2 = enPeriodo;
         #dsm30301#3 = enModelo;
         #dsm30301#4 = enComplem;
         #dsm30301#5 = 0;
         |LEE 101#dsm30301.=;
         |SI FSalida = 0;
             aGuardo8   = #dsm30301#8;
             aGuardo9   = #dsm30301#9;
             aGuardo12  = #dsm30301#12;
             aGuardo13  = #dsm30301#13;
             aGuardo14  = #dsm30301#14;
             aGuardo15  = #dsm30301#15;
             nGuardo76  = #dsm30301#94;
             nGuardo77  = #dsm30301#95;
             |SI nGuardo77 < 0; nGuardo77 = 0; |FINSI;
             aGuardo130 = #dsm30301#130;
             aGuardo131 = #dsm30301#131;
             aGuardo132 = #dsm30301#132;
             aGuardo144 = #dsm30301#144;

             |BORRA 020#dsm30301.a;
             |LIBERA #dsm30301;

             |BUCLE dsm30302B;
             |BUCLE dsm30303B;
             |SI #dsm30301#2 = 12;
                 |BUCLE dsm30304B;
                 |BUCLE dsm30305B;
             |FINSI;
         |FINSI;

         |HAZ GrabaModelo;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         #dsm30301#0 = enEmpresa;
         #dsm30301#1 = enEjer;
         #dsm30301#2 = enPeriodo;
         #dsm30301#3 = enModelo;
         #dsm30301#4 = enComplem;
         #dsm30301#5 = enActividad;
         |LEE 040#dsm30301.=;
         |SI FSalida ! 0;  enExistencia = 1;  |DDEFECTO #dsm30301; |FINSI;

         |SI enActividad = 0;  enResultado = #dsm30301#88;  |FINSI;
     |FINSI;
|FPRO;

|PROCESO PorHistorico;
     fFecha = ~; aAlfa = fFecha;
     aAlfa  = aAlfa % 104;
     |SI aAlfa ! enEjer;
         #agicen30#0 = #agicen14#0;
         #agicen30#1 = #agicen14#1;
         #agicen30#2 = enEjer;
         |LEE 000#agicen30.=;
         |SI FSalida = 0;
             #agicen14#2 = #agicen30#3;
             #agicen14#3 = #agicen30#4;
             #agicen14#4 = #agicen30#5;
             #agicen14#7 = #agicen30#6;
             #agicen14#8 = #agicen30#7;
             #agicen14#9 = #agicen30#8;
             #agicen14#10 = #agicen30#9;
             #agicen14#11 = #agicen30#10;
             #agicen14#16 = #agicen30#12;
             #agicen14#17 = #agicen30#13;
             #agicen14#18 = #agicen30#14;
             #agicen14#19 = #agicen30#15;
             #agicen14#15 = #agicen30#16;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsmom008Cheq;
     #agicen14#0 = #dsmom008#0;
     #agicen14#1 = #dsmom008#5;
     |LEE 000#agicen14.=;
     |SI FSalida ! 0;
         |DDEFECTO #agicen14;
         #agicen14#0 = #dsmom008#0;
         #agicen14#1 = #dsmom008#5;
     |FINSI;

     |HAZ PorHistorico;

     |SI enEjer ] 2017;
         |SI #agicen14#7 = 11; |O #agicen14#7 = 12; |O #agicen14#7 = 13;
              |O #agicen14#7 = 15; |O #agicen14#7 = 16; |O #agicen14#7 = 17;
            enNoMod390 = 1;
            |ERROR10;
            |ACABA;
         |FINSI;
     |FINSI;

     |SI #agicen14#7 = 10;
         enNoMod390 = 1;
         |ACABA;
     |FINSI;

     |SI #agicen14#3 = "8612"; |O #agicen14#3 = "8611"; || ...  |O #agicen14#3 = "862 "; 700000_10027
         enNoMod390 = 1;
         |ACABA;
     |FINSI;

     enNoMod390 = 0;
     |ERROR10;
|FPRC;

|DEFBUCLE dsmom008Cheq;
     #dsmom008#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 01;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 95;
     ;
     NULL, dsmom008Cheq;
|FIN;

|PROCESO Tipo80Fm30301;  |TIPO 80;
     aAlfa = PARAMETRO % 105;  enEmpresa     = aAlfa;
     aAlfa = PARAMETRO % 604;  enEjer        = aAlfa;
     aAlfa = PARAMETRO % 1002; enPeriodo     = aAlfa;
     aAlfa = PARAMETRO % 1203; enModelo      = aAlfa;
     aAlfa = PARAMETRO % 1502; enComplem     = aAlfa;
     aAlfa = PARAMETRO % 1702; enActividad   = aAlfa;
     aAlfa = PARAMETRO % 1902; enTipoEntrada = aAlfa;
     aAlfa = PARAMETRO % 2101; enExistencia  = aAlfa;

     enNoMod390 = 0;
     |SI enEjer ] 2014;  |Y enPeriodo = 12;
         |ABRE #agicen14;
         |ABRE #agicen30;
         |BUCLE dsmom008Cheq;
         |CIERRA #agicen30;
         |CIERRA #agicen14;
     |FINSI;

     |ABRET #dsm30301;
     |ABRET #dsm30302;
     |ABRET #dsm30303;
     |ABRET #dsm30304;
|FPRC;

|PROCESO Tipo90Fm30301;  |TIPO 90;
     |SI nGrid02 ! -1;
         |DESTRUYECONTROL nGrid02;
         nGrid02 = -1;
     |FINSI;

     |SI nGrid03 ! -1;
         |DESTRUYECONTROL nGrid03;
         nGrid03 = -1;
     |FINSI;

     |SI nGrid04 ! -1;
         |DESTRUYECONTROL nGrid04;
         nGrid04 = -1;
     |FINSI;

     |SI nVentTrab ! -1;
         |FINVENTANA nVentTrab;
         nVentTrab = -1;
     |FINSI;

     |CIERRAT #dsm30301;
     |CIERRAT #dsm30302;
     |CIERRAT #dsm30303;
     |CIERRAT #dsm30304;

     |HAZ FinalizaEnX;
|FPRC;
