|FICHEROS;
     dsm296ca #1;
     dsm296li #2,MANTE;

     dsmow133 #933,MANTE;

     &regisnif@ #709;

     :basica/agidanif;

     linea296@ #902;
|FIN;

|VARIABLES;
     nCampo      = 0;
     nPtec       = 0;
     nCampoD     = 0;
     nCampoO     = 0;
     nForma      = 0;
     nLCod       = 0;
     nCalc       = 0;
     nNume       = 0;
     nModo       = 0;

     aMenav        = "";
     aPathModelo   = "";
     aDef          = "";
     aAlfa         = "";
     aAlfa1        = "";
     aAlfa2        = "";
     aTecla        = "";
     aMas          = "";

     &eaAlfa       = "";
     &enError      = 0;
     &eaTabla      = "";
     &enPosicion   = 0;
     &eaDestino    = "";
     &enComp       = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Tipo88;  |TIPO 88;
     |HAZ Relaciones;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
|FPRC;

|PROCESO Tipo0C7;  |TIPO 0;
     aAlfa = #2#7 % -104;
     nNume = aAlfa;

     |SI nNume ! #2#1;
||         |MENAV "0000Fecha erronea. El año debe ser igual al del modelo.";
||         |ERROR;
     |FINSI;
|FPRC;

|PROCESO SacaClave; |TIPO 7;
     eaTabla = "ztabla09.txt";  nLCod = 1; |HAZ CargaTabla;
|FPRC;

|PROCESO CompClaveF11; |TIPO 11;
     |SI FSalida = 10;
         enPosicion = 10;
         |HAZ SacaTabla;
         nCalc = 100 + nLCod;
         aAlfa1   = eaDestino % nCalc;
         #2Campo  = aAlfa1;  |PINTA #2Campo;
     |FINSI;
|FPRC;

|PROCESO CompClave;  |TIPO 0;
     enComp = nLCod;
     aAlfa = "|C" + (("000" + Campo) % -103) + "TIPO"; aAlfa1 = #2aAlfa;
     aAlfa = #2Campo; |QBF aAlfa;
     |SI aAlfa1 = "N"; nCalc = - (100 + nLCod); aAlfa = (("0" * enComp) + aAlfa) % nCalc; |FINSI;
     |SI aAlfa1 ! "N"; nCalc = 100 + nLCod;     aAlfa = (aAlfa + (" " * enComp)) % nCalc; |FINSI;
     eaAlfa = aAlfa;
     |HAZ CompruebaTabla;

     |SI enError = 1;
         |MENAV "0000 Contenido Incorrecto. Consulta la Tabla con F2";
         |ERROR;
         |PULSATECLA;
         |ACABA;
     |FINSI;

     nCalc = 100 + nLCod;                 aAlfa1   = eaDestino % nCalc;
     #2Campo  = aAlfa1;
     |C_P #2Campo,0,nCalc; nCalc = nCalc + nLCod + 1;
     |PINTA #2Campo;

     |HAZ FinTabla;
|FPRC;

|PROCESO SacaSubClave; |TIPO 7;
     |SI #1#1 < 2014;
         eaTabla = "ztabla10.txt";  nLCod = 2; |HAZ CargaTabla;
     |FINSI;
     |SI #1#1 ] 2014; |Y #1#1 < 2017;
         eaTabla = "ztabla15.txt";  nLCod = 2; |HAZ CargaTabla;
     |FINSI;
     |SI #1#1 ] 2017;
         eaTabla = "ztabla16.txt";  nLCod = 2; |HAZ CargaTabla;
     |FINSI;
|FPRC;

|PROCESO CompSubClaveF11; |TIPO 11;
     |SI FSalida = 10;
         enPosicion = 10;
         |HAZ SacaTabla;
         nCalc = 100 + nLCod;
         aAlfa1   = eaDestino % nCalc;
         #2Campo  = aAlfa1;  |PINTA #2Campo;
     |FINSI;
|FPRC;

|PROCESO CompSubClave;  |TIPO 0;
     enComp = nLCod;
     aAlfa = "|C" + (("000" + Campo) % -103) + "TIPO"; aAlfa1 = #2aAlfa;
     aAlfa = #2Campo; |QBF aAlfa;
     |SI aAlfa1 = "N"; nCalc = - (100 + nLCod); aAlfa = (("0" * enComp) + aAlfa) % nCalc; |FINSI;
     |SI aAlfa1 ! "N"; nCalc = 100 + nLCod;     aAlfa = (aAlfa + (" " * enComp)) % nCalc; |FINSI;
     eaAlfa = aAlfa;
     |HAZ CompruebaTabla;

     |SI enError = 1;
         |MENAV "0000 Contenido Incorrecto. Consulta la Tabla con F2";
         |ERROR;
         |PULSATECLA;
         |ACABA;
     |FINSI;

     nCalc = 100 + nLCod;                 aAlfa1   = eaDestino % nCalc;
     #2Campo  = aAlfa1;
     |C_P #2Campo,0,nCalc; nCalc = nCalc + nLCod + 1;
     |PINTA #2Campo;

     |HAZ FinTabla;
|FPRC;

|PROCESO linea296;
     aAlfa1 = #902#32;  |QBF aAlfa1;
     aAlfa2 = #902#34;  |QBF aAlfa2;
     |SI aAlfa1 = "";   |Y aAlfa2 = "";
         |ACABA;
     |FINSI;

     #2#15 = #902#15;
     #2#16 = #902#16;
     #2#17 = #902#17;
     #2#32 = #902#32;
     #2#33 = #902#33;
     #2#34 = #902#34;
     #2#35 = #902#35;
     #2#36 = #902#36;
     #2#37 = #902#37;
     #2#38 = #902#38;
     #2#39 = #902#39;
     #2#18 = #902#18;
     #2#40 = #902#40;
     #2#19 = #902#19;
     #2#41 = #902#41;
|FPRC;

|DEFBUCLE linea296;
     #902#2001;
     ;
     #2#6;
     #2#6;
     ;
     NULL, linea296;
|FIN;

|PROCESO DatosComplementarios;
     |SI nModo = 1;
         aAlfa1 = #2#32;  |QBF aAlfa1;
         aAlfa2 = #2#34;  |QBF aAlfa2;
         |SI aAlfa1 = "";   |Y aAlfa2 = "";
             |DBASE aMas;  |QBF aMas;
             aMas = aMas + "def/dsm296li.mas";
             |CARGA_DEF aMas, linea296@;

             |BUCLE linea296;

             |DESCARGA_DEF #linea296@;
         |FINSI;

         aAlfa1 = #2#32;  |QBF aAlfa1;
         aAlfa2 = #2#34;  |QBF aAlfa2;

         |SI aAlfa1 = "";   |Y aAlfa2 = "";
             #2#18 = #709#12;
             #2#32 = #709#2;
             #2#34 = #709#6;
             #2#35 = #709#7;
         |FINSI;

         |ABRE #agidanif;
         #agidanif#0 = #dsm296li#6;
         #agidanif#1 = 1;
         |LEE 101#agidanif.=;
         |SI FSalida = 0;
             #dsm296li#32 = #agidanif#45;
             #dsm296li#33 = #agidanif#46;
             #dsm296li#34 = #agidanif#47;
             #dsm296li#35 = #agidanif#48;
             #dsm296li#36 = #agidanif#49;
             #dsm296li#37 = #agidanif#50;
             #dsm296li#38 = #agidanif#51;
             #dsm296li#39 = #agidanif#52;
             #dsm296li#18 = #agidanif#53;
             #dsm296li#40 = #agidanif#54;
             #dsm296li#19 = #agidanif#55;
             #dsm296li#41 = #agidanif#56;
         |FINSI;
         |CIERRA #agidanif;
     |FINSI;

     |PUSHV 0501 2480;
     |PINPA #0#933;

     #933#0  = #2#15;
     #933#1  = #2#16;
     #933#2  = #2#17;
     #933#3  = #2#32;
     #933#4  = #2#33;
     #933#5  = #2#34;
     #933#6  = #2#35;
     #933#7  = #2#36;
     #933#8  = #2#37;
     #933#9  = #2#38;
     #933#10 = #2#39;
     #933#11 = #2#18;
     #933#12 = #2#40;
     #933#13 = #2#19;
     #933#14 = #2#41;

     |PINDA #0#933;

     |SI nModo = 1;
         |ENDATOS #1#933;
         |SI FSalida = 0;
             #2#15 = #933#0;
             #2#16 = #933#1;
             #2#17 = #933#2;
             #2#32 = #933#3;
             #2#33 = #933#4;
             #2#34 = #933#5;
             #2#35 = #933#6;
             #2#36 = #933#7;
             #2#37 = #933#8;
             #2#38 = #933#9;
             #2#39 = #933#10;
             #2#18 = #933#11;
             #2#40 = #933#12;
             #2#19 = #933#13;
             #2#41 = #933#14;

             |ABRE #agidanif;
             #agidanif#0 = #dsm296li#6;
             #agidanif#1 = 1;
             |LEE 101#agidanif.=;
             |SI FSalida ! 0;
                 |DDEFECTO #agidanif;
                 #agidanif#0 = #dsm296li#6;
                 #agidanif#1 = 1;
                 |GRABA 020#agidanif.b;
             |FINSI;

             #agidanif#45 = #dsm296li#32;
             #agidanif#46 = #dsm296li#33;
             #agidanif#47 = #dsm296li#34;
             #agidanif#48 = #dsm296li#35;
             #agidanif#49 = #dsm296li#36;
             #agidanif#50 = #dsm296li#37;
             #agidanif#51 = #dsm296li#38;
             #agidanif#52 = #dsm296li#39;
             #agidanif#53 = #dsm296li#18;
             #agidanif#54 = #dsm296li#40;
             #agidanif#55 = #dsm296li#19;
             #agidanif#56 = #dsm296li#41;

             |GRABA 020#agidanif.a;
             |LIBERA #agidanif;

             |CIERRA #agidanif;
         |FINSI;
     |SINO;
         |PAUSA;
     |FINSI;

     |POPV;

     |PINTA #2#15;
     |PINTA #2#16;
     |PINTA #2#17;
     |PINTA #2#18;
|FPRC;

|PROCESO PonDatosNif;  |TIPO 7;
     |SI #2#6 ! "999999999999";
         eaCodNif  = #2#6;
         |HAZ LeeNifs;

         |C_M #2#20, 1, "S";

         #2#15 = #709#1;   |PINTA #2#12;


         nModo = 1;
         |HAZ DatosComplementarios;
     |SINO;
         |C_M #2#20, 1, "N";

         #2#12 = "VALORES PENDIENTES DE ABONO";   |PINTA #2#12;
         #2#17 = "";                              |PINTA #2#17;
         #2#20 = "";                              |PINTA #2#20;
     |FINSI;

     |PARA nCampo = 20;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
           |C_M #2nCampo, 1, "S";
     |SIGUE;

     |SI #2#9 ! "A";  |Y #2#9 ! "B";
         |PDEFECTO #2, 20, 32;
         |PARA nCampo = 20;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
               |C_M #2nCampo, 1, "N";
         |SIGUE;
     |FINSI;

     |PARA nCampo = 20;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
           |PINTA #2nCampo;
     |SIGUE;
|FPRC;

|PROCESO Tipo0C21;  |TIPO 0;
     |C_M #2#22, 1, "S";
     |SI #2#21 = "0";
          |C_M #2#22, 1, "N";  #2#22 = "";
     |FINSI;

     |PINTA #2#22;
|FPRC;

|PROCESO Tipo0C24;  |TIPO 0;
     |C_M #2#24, 0, aAlfa;
     |SI aAlfa ! "S";  |ACABA;  |FINSI;

     |SI #2#9 ! "B";
         |SI #2#24 = "P";
             |MENAV "0000 Tipo incorrecto, solo con clave B";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |PARA nCampo = 26;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
           |C_M #2nCampo, 1, "S";
     |SIGUE;

     |SI #2#24 ! "P";
         |PDEFECTO #2, 26, 32;
         |PARA nCampo = 26;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
               |C_M #2nCampo, 1, "N";
         |SIGUE;
     |FINSI;

     |PARA nCampo = 26;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
           |PINTA #2nCampo;
     |SIGUE;
|FPRC;

|PROCESO Tipo2m296li;  |TIPO 2;
     #1#6  = #1#6  +. 1;
     #1#7  = #1#7  +. #2#11;
     #1#8  = #1#8  +. #2#13;

     |SI #2#9 ! "A";  |Y #2#9 ! "B";
         #1#9  = #1#9  +. #2#13;
     |SINO;
         |SI #2#23 = "1";
             #1#9  = #1#9  +. #2#13;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo11m296li;  |TIPO 11;
     |SI FSalida = 10;
         |SI #2Campo = "999999999999";  |ACABA;  |FINSI;
         eaVarDni  = #2Campo;
         enCalcCif = 1;
         |HAZ CalculameDNI;
         #2Campo = eaVarDni;
         |PINTA #2Campo;
         |ERROR;
     |FINSI;

     |SI FSalida = 11;
         |SI #2Campo = "999999999999";  |ACABA;  |FINSI;

         nModo = 4;
         |HAZ DatosComplementarios;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO MiraDni296li;  |TIPO 6;
     |SI #2#6 = "999999999999";
         |ABRE #709;
         #709#0 = "999999999999";
         |LEE 101#709=;
         |SI FSalida ! 0;
             |DDEFECTO #709;
              #709#0 = "999999999999";
              |GRABA 020#709n;
         |FINSI;
         |LIBERA #709;
         |CIERRA #709;
         |ACABA;
     |FINSI;

     eaVarDni  = #2Campo;
     enCalcCif = 0;
     |HAZ CalculameDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #2Campo ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #2Campo = eaVarDni;  |PINTA #2Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Totales;
     #2#13 =  #2#11 % #2#12;

     |SI #2#14 = 0;
         #2#14 = #2#13;
     |FINSI;

     |PINTA #2#14;
     |PINTA #2#13;
|FPRC;
