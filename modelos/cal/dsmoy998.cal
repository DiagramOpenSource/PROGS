|FICHEROS;
     dsmoy998;
|FIN;

|VARIABLES;
     nHandle             = 0;

     aLon                = "";
     aDIR                = "";
     aPath               = "";
     aPathLanza          = "";
     aPathExe            = "";
     aEjec               = "";

     &enEmp              = 0;
     &enCom              = 0;
     &eaPathPdf          = "";
|FIN;

|INCLUYE i_varemi;

|PROCESO GrabaSin;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO GuardaPDF;
     aPathExe = eaUnidadBasico + "\MODELOS";
     aPathExe = aPathExe + "\DSMAC";
     aPathExe = aPathExe + "\";

     aAbre = aPathLanza + "pres.bat";
     |XABRE "WBC", aAbre, nHandle;

     aAlfa = aPathExe + "ds_eje_php " + &34;
     |HAZ GrabaSin;

     aAlfa = "https://www2.agenciatributaria.gob.es/";
     |SI aDIR = "PRODUCCION";
         aAlfa = "https://www6.aeat.es/";
     |FINSI;

     aFic = (("00000" + enEmp) % -105) + (("00" + enCom) % -102) + ".pdf";

     aAlfa = aAlfa + "wlpl/inwinvoc/";
     aAlfa = aAlfa + "es.aeat.dit.adu.eeca.catalogo.vis.VisualizaSc";
     aAlfa = aAlfa + "?COMPLETA=SI&ORIGEN=E&NIF=";
     aAlfa = aAlfa + "&CSV=" + #dsmoy998#0;  |QBF aAlfa;
     aAlfa = aAlfa + &34 + " > " + eaPathPdf + aFic;
     |HAZ GrabaSin;

     |XCIERRA nHandle;

     aEjec   = aPathExe + "dsmini ";
     aEjec   = aEjec + aPathLanza + "pres.bat";
     |RSYSTEM aEjec;
|FPRC;

|PROCESO T12;  |TIPO 12;
     |SI FSalida = 7;
         |ACABA;
     |FINSI;

     |HAZ LeeUnidadBasico;

     aPathLanza = eaUnidadBasico + "\AEAT";        |RMKDIR aPathLanza;
     aPathLanza = aPathLanza + "\Pres";            |RMKDIR aPathLanza;
     aPathLanza = aPathLanza + "\";

     |SI PARAMETRO = "SALVA";
         |HAZ GuardaPDF;
         |ACABA;
     |FINSI;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aAbre = aPathLanza + "pres.bat";
     |XABRE "WBC", aAbre, nHandle;

     aAlfa = eaPathExplorador + " " + &34;
     |HAZ GrabaSin;

     aAlfa = "https://www2.agenciatributaria.gob.es/";
     |SI aDIR = "PRODUCCION";
         aAlfa = "https://www6.aeat.es/";
     |FINSI;

     aAlfa = aAlfa + "wlpl/inwinvoc/";
     aAlfa = aAlfa + "es.aeat.dit.adu.eeca.catalogo.vis.VisualizaSc";
     aAlfa = aAlfa + "?COMPLETA=SI&ORIGEN=E&NIF=";
     aAlfa = aAlfa + "&CSV=" + #dsmoy998#0;  |QBF aAlfa;
     aAlfa = aAlfa + &34;
     |HAZ GrabaSin;

     |XCIERRA nHandle;

     |RSYSTEM aAbre;
|FPRC;

|PROCESO T0;  |TIPO 0;
     aLon = #dsmoy998#0;  |QBF aLon;
     aLon = aLon % 0;
     |SI aLon ! "16";
         |MENAV "0000El CSV debe tener 16 caracteres";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROGRAMA;
     |DBASE aPath;  |QBT aPath;
     aAbre = aPath + "webdirecta.txt";
     |XABRE "E", aAbre, 0;
     |SI FSalida ] 0;
         |XABRE "", aAbre, nHandle;
         |XLEE nHandle, 250, aDIR;
         |XCIERRA nHandle;
         |QBF aDIR;
         |SI aDIR = "";
             |MENAV "0000Configuraci¢n incorrecta de la WEB directa.";
             |ACABA;
         |FINSI;
     |FINSI;

     |SI PARAMETRO = "PRES";
         #dsmoy998#0 = eaCSV;
         |HAZ T12;

         |ACABA;
     |FINSI;

     |SI PARAMETRO = "SALVA";
         #dsmoy998#0 = eaCSV;
         |HAZ T12;

         |ACABA;
     |FINSI;

     |HAZ PermisoPortal;

     |SI enPortal = 0;
         |ACABA;
     |FINSI;

     |MANTE #dsmoy998;
|FPRO;
