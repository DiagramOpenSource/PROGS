|FICHEROS;
   dsmoy012 #0;

   dsmom001 #1;
   :/integral/def/dsam0000 #2;
   dsmom004 #4;
   dsmom022 #22;
   dsmom060 #60;
   dsmom061 #61;
   dsmom160;
   dsmom161;
   dsmom162;

   :/integral/def/dsam0003 #103;
   :/basica/def/agicen14 #114;
   :/basica/def/agicen30;
   :/basica/def/agifigen #118;
   :/basica/def/agim0019 #119;

   :/contagen/def/canempre #300;
   :/contagen/def/camaasil #301;
   :/contagen/def/caexistl #303;
   :/contagen/def/cacuenta #304;
   :/contagen/def/cacuedep #305;
   :/contagen/def/caconimp #306;  || configuracion impresiones

   dsmom009 #09;
   dsmom010 #10;
   dsmom011 #11;
   dsmom012 #12;
   dsmom013 #13;

   dsmopl10;
   dsmopl12;
   dsmopl13;

   dsmoc130 #130;
   dsmoc131 #231;
   dsmod130 #430;
   dsmod131 #431;

   dsmow032 #900;          ||Def de impresion
   dsmow033 #901;
   dsmow017 #917;
   dsmow043 #999,MANTE;

   dsmow037 #911;  || el 91 en dsmoy014      ||Comuneros auxiliar
   dsmow108 #912;  || el 902 en dsmoy014     ||Retenciones contables

   dsmoc13@ #998;
|FIN;

|VARIABLES;
   &entrada = 1;
   &eSwSelec  = 0;
   &eaDDepar  = "";
   &eaHDepar  = "";
   &efDFecha  = @;
   &efHFecha  = @;
   &eaNomFDep = "";  ||Nombre del Fichero Creado
   &dirfich0  = "";
   &enSwNo    = 0;
   aMonMod    = "";
   informe    = "";
   informR    = "";
   nInkey     = 0;
   aFichero   = "";
   nCampo     = 0;
   nDEmpresa  = 0;
   nHEmpresa  = 0;
   nDActividad = 0;
   nHActividad = 0;
   nGTempo     = 0;
   nEstado     = 0;

   aClau0 = "";
   aClau1 = "";
   nClau2 = "";

   nSPin1      = 0;
   aPath       = "";
   nEjercicio  = 0;
   nQueBusco   = 0;
   aQueBusco   = "";

   aAlfa1 = "";
   aAlfa2 = "";
   aAlfa3 = "";
   nPara1 = 0;
   nPara2 = 0;
   nPara3 = 0;
   nPara4 = 0;
   nNume1 = 0;
   nNume2 = 0;
   nNume3 = 0;
   nNume4 = 0;
   nNume5 = 0;
   SwHayDatos = 0;

   fFecha    = @;
   fDFecha   = @;
   fHFecha   = @;
   fecha1    = @;
   fecha2    = @;
   nDPeriodo = 0;
   nHPeriodo = 0;

   nComplem  = 0;
   nTanto10  = 0;
   nTanto11  = 0;
   nTanto12  = 0;
   nTanto13  = 0;
   nTotal_I  = 0;
   nTotal_C  = 0;
   nTotal_V  = 0;
   nTotal_G  = 0;

   nTanto10_3  = 0;
   nTanto11_3  = 0;
   nTanto12_3  = 0;
   nTanto13_3  = 0;

   nTanto10_6  = 0;
   nTanto11_6  = 0;
   nTanto12_6  = 0;
   nTanto13_6  = 0;

   nTanto10_9  = 0;
   nTanto11_9  = 0;
   nTanto12_9  = 0;
   nTanto13_9  = 0;

   nTanto10_12 = 0;
   nTanto11_12 = 0;
   nTanto12_12 = 0;
   nTanto13_12 = 0;

   nTotal_I_3  = 0;
   nTotal_C_3  = 0;
   nTotal_V_3  = 0;
   nTotal_G_3  = 0;

   nTotal_I_6  = 0;
   nTotal_C_6  = 0;
   nTotal_V_6  = 0;
   nTotal_G_6  = 0;

   nTotal_I_9  = 0;
   nTotal_C_9  = 0;
   nTotal_V_9  = 0;
   nTotal_G_9  = 0;

   nTotal_I_12 = 0;
   nTotal_C_12 = 0;
   nTotal_V_12 = 0;
   nTotal_G_12 = 0;

   aElDepar  = "";
   aDCuenta = "";
   aHCuenta = "";
   nSaldo = 0;
   nSald1 = 0;
   nSald2 = 0;
   nSald3 = 0;
   nSald4 = 0;
   nSald5 = 0;
   sw = 0;
   nEnExi = 0;
   fLaFecha = @;

   nSalPar1 = 0;
   nSalPar2 = 0;
   nSalPar3 = 0;
   nSalPar4 = 0;
   nSalPar5 = 0;
   nImpVar1 = 0;
   nImpVar2 = 0;
   nImpVar3 = 0;
   nImpVar4 = 0;
   nImpVar5 = 0;
   nSwPlan  = 0;

   nMixto   = 0;
   nDConta  = 0;
   nDPlani  = 0;
  nTTribut  = 0;

   &eaCodRenta = "";
   &eaCodR2    = "";
   &eaRenta    = "";
   &enEjerR    = 0;
   &enCodRen   = 0;
   &eaCodRen   = "";

   aElDni      = "";
   nOpTitular  = 0;
   aBase       = "";
   aAlfa       = "";
   nCanal      = 0;
   &eaPathIntegral  = "";

   &enI1     = 0;
   &enI2     = 0;
   &enI3     = 0;
   &enI4     = 0;
   &enI5     = 0;
   &nPagina  = 0;
   &SwPrim   = 0;
   &SwLinea  = 0;
   &eaTituloL = "";
   &eaTitul2  = "";
   &aTipIG    = "";

   nPin1    = 0;
   aPin1    = "";
   efPn10   = @;
   efPn11   = @;
   swExiste = 0;
   swNoExis = 0;
   nExiFin  = 0;
   aParam   = "";
   nActividad  = 0;
     &nParcial = 0;
     &nActi    = 0;
     &nTotal   = 0;

     SwHayComun = 0;
     &aTp0     = "%";
     &aTp1     = "Pagos a Cta.";
     &aTp2     = "Retenciones ";
     &nTp3     = 0;
     &enFrase  = 0;
     &eaActi   = "";

     nImport1  = 0;
     nImport2  = 0;
     nImport3  = 0;
     nImp1    = 0;
     nImp2    = 0;
     nImp3    = 0;

     nSwCom   = 0;

     nNumEmp  = 0;
     nDActEmp  = 0;
     nHActEmp  = 0;

     nCtRetencion = 0;
     nDepar       = 0;
     nSumaCtas    = 0;
     fFechaIni    = @;
     fFechaFin    = @;
     aUno         = "";
     aDos         = "";
     nTrim        = 0;
     fecha3       = @;
     fecha4       = @;
     &nSwPago     = 0;
     nPer         = 0;
     aDef         = "";
     aMas         = "";
     nError       = 0;

     nTotal25 = 0;
     nTotal26 = 0;
     nTotal27 = 0;
     nTotal28 = 0;
     nTotal29 = 0;
     nTotal30 = 0;
     nTotal31 = 0;
     nTotal32 = 0;
     nTotal33 = 0;
     nTotal34 = 0;
     nTp      = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;
|INCLUYE i_masivo;

|| //////////////////// Calculos de Pantalla \\\\\\\\\\\\\\\\\\\\\\\\\\
|CALCULO CodigoRenta; |TIPO 7;
     |DBASS aBase;  |QBF aBase;
     aAlfa = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathIntegral  = aBase + "integral/";
     |FINSI;

     |C_M #0#55, 1, "S";
     |SI eaPathIntegral = "";
         |C_M #0#55, 1, "N";  #0#55 = "N";  |PINTA #0#55;
     |FINSI;
|FCAL;

|CALCULO Eano; |TIPO 7;
 |C_M #0#1, 1, "S";
 |SI enEjer = 0;
     fLaFecha = ~;
     aAlfa1 = fLaFecha; aAlfa1 = aAlfa1 % -104;
     #0#1 = aAlfa1;
 |SINO;
     aParam = PARAMETRO; |QBF aParam;
     #0#1 = enEjer;
     |SI aParam = "";  |C_M #0#1, 1, "N";  |FINSI;
 |FINSI;
 |PINTA #0#1;
 aAlfa2 = "01.01." + aAlfa1; #0#47 = aAlfa2; |PINTA #0#47;
 aAlfa3 = "31.12." + aAlfa1; #0#48 = aAlfa3; |PINTA #0#48;

 |C_M #0#38, 1, "S";
 |C_M #0#39, 1, "S";
 |SI enActividad ! 0;
     #0#38 = enActividad;  |PINTA #0#38;
     #0#39 = enActividad;  |PINTA #0#39;

     |C_M #0#38, 1, "N";
     |C_M #0#39, 1, "N";
 |FINSI;
|FCAL;

|CALCULO losDefectos; |TIPO 0;
 aAlfa1 = #0#1;
 aAlfa2 = "01.01." + aAlfa1;
 aAlfa3 = "31.12." + aAlfa1;
 #0#47 = aAlfa2; |PINTA #0#47; fecha1 = #0#47;
 #0#48 = aAlfa3; |PINTA #0#48; fecha2 = #0#48;
|FCAL;

|CALCULO Tipo7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#2  = enEmpresa;  |PINTA #0#2;
         #0#3  = enEmpresa;  |PINTA #0#3;

         |C_M #0#2, 1, "N";
         |C_M #0#3, 1, "N";
     |FINSI;
|FCAL;

|CALCULO Parrilla; |TIPO 0;
     |SI #0#2 = 0;
         #0#2 = 0;  |PINTA #0#2;
         #0#3 = 0;  |PINTA #0#3;  |C_M #0#3, 1, "N";
         |PARA nCampo = 4;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#2, 1, "S";
             |C_M #0#3, 1, "S";
         |FINSI;

         |PARA nCampo = 4;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO NoMasEmpresas; |TIPO 0;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO YaSeCual; |TIPO 7;
 |SI enEmpresa ! 0;
     #0#46 = "S"; |PINTA #0#46;
     #0#24 = "S"; |PINTA #0#24;
     #0#25 = 00;  |PINTA #0#25;
     #0#26 = 99;  |PINTA #0#26;
     |C_M #0#24, 1, "N";
     |C_M #0#25, 1, "N";
     |C_M #0#26, 1, "N";
     |C_M #0#46, 1, "N";
 |FINSI;
|FCAL;

|CALCULO SelTipo0; |TIPO 0;
 |SI #0#46 = "N";
     #0#25 = 0;   |PINTA #0#25;  |C_M #0#25, 1, "N";
     #0#26 = 99;  |PINTA #0#26;  |C_M #0#26, 1, "N";
     |PARA nCampo = 27;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "S";
     |SIGUE;
 |SINO;
     |SI enEmpresa = 0;
         |C_M #0#25, 1, "S";
         |C_M #0#26, 1, "S";
     |FINSI;
     |PARA nCampo = 27;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "N";
           #0nCampo = 0;  |PINTA #0nCampo;
     |SIGUE;
 |FINSI;
|FCAL;

|CALCULO SelTipo1;
 |SI #0Campo = 0;
     |PARA nCampo = Campo + 1;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
           #0nCampo = 0;  |C_M #0nCampo, 1, "N";
     |SIGUE;
 |SINO;
     |PARA nCampo = Campo + 1;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "S";
     |SIGUE;
 |FINSI;
|FCAL;


|CALCULO QueInfor; |TIPO 0;
 aAlfa1 = #0#51;
 |C_M #0#47,1,aAlfa1;
 |C_M #0#48,1,aAlfa1;
 |C_M #0#49,1,aAlfa1;
 |C_M #0#50,1,aAlfa1;
 |SI aAlfa1 = "N";
     #0#47 = fecha1; |PINTA #0#47;
     #0#48 = fecha2; |PINTA #0#48;
     #0#49 = 01;     |PINTA #0#49;
     #0#50 = 12;     |PINTA #0#50;
 |FINSI;
|FCAL;

|CALCULO LasExi; TIPO 0;
 aAlfa1 = #0#54;
 |C_M #0#52,1,aAlfa1;
 |C_M #0#53,1,aAlfa1;
 |SI aAlfa1 = "N";
     #0#52 = 00;     |PINTA #0#52;
     #0#53 = 12;     |PINTA #0#53;
 |FINSI;
|FCAL;

|CALCULO laFecha; |TIPO 0;
 |SI #0Campo < fecha1; |O #0Campo> fecha2;
     |ERROR;
     |ACABA;
 |FINSI;
 |SI Campo = 48; |Y #0#47 > #0#48;
     |ERROR;
     |ACABA;
 |FINSI;
 aAlfa1 = #0Campo; aAlfa1 = aAlfa1 % 402;
 nNume1 = aAlfa1;
 nNume2 = 3;
 |SI nNume1 > 3; nNume2 = 6;  |FINSI;
 |SI nNume1 > 6; nNume2 = 9;  |FINSI;
 |SI nNume1 > 9; nNume2 = 12; |FINSI;
 nNume1 = Campo + 2;
 #0nNume1 = nNume2; |PINTA #0nNume1;
 |SI #0#51 = "S"; |Y Campo = 48;
     nNume1 = Campo + 5;
     #0nNume1 = nNume2; |PINTA #0nNume1;
 |FINSI;
|FCAL;

|CALCULO AntesExis; |TIPO 7;
   |C_M #0Campo, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI #0#51 = "S";
       nNume1 = Campo - 3;
       #0Campo = #0nNume1; |PINTA #0Campo;
   |FINSI;
|FCAL;

|CALCULO Pagos; |TIPO 0;
   aAlfa1 = #0Campo;
   |C_M #0#65,1, aAlfa1;
|FCAL;

|| **********************************************************************************
|| **********************************************************************************
|| ....................... Situa la Empresa Contable o de Planillas

|PROCESO LEmpresaPlan;
   nGTempo = nGTempo + 1;
   #999#0 = nGTempo;       || Guia
   #999#1 = enEmpresa;     || Empresa
   #999#2 = 0;             || Periodo Contable
   #999#3 = enEjer;        || A¤o
   #999#4 = 01;            || Desde Mes
   #999#5 = 1;             || N§ Digitos
   #999#6 = 4;             || Digitos Nivel 1
   #999#7 = 0;             || Digitos Nivel 2
   #999#8 = 0;             || Digitos Nivel 3
   #999#9 = 0;             || Digitos Nivel 4
   #999#10 = 0;            || Digitos Nivel 5
   #999#11 = 0;            || Digitos Nivel 6
   #999#12 = eaEstadoEmp;  || Estado
   #999#13 = aMonMod;     || Moneda
   #999#14 = #agifigen#1;  || Nombre Empresa
   #999#15 = "PLANILLAS";  || Path
   #999#16 = #0#43;        || Emitir
   |GRABA 020#999n;
|FPRC;

|PROCESO LeoDsmom009;
 nDPlani = 1;
 |ERROR10;
|FPRC;

|DEFBUCLE LeoDsmom009;
 #9#1;
 ;
 #agicen14#0, #0#1, 01, 00, #agicen14#1;
 #agicen14#0, #0#1, 99, 99, #agicen14#1;
 e;
 NULL, LeoDsmom009;
|FIN;

|PROCESO LeoAgicen30;
 |ABRE #agicen30;
 #agicen30#0 = #agicen14#0;
 #agicen30#1 = #agicen14#1;
 #agicen30#2 = enEjer;
 |LEE 041#agicen30.=;
 |SI FSalida = 0;
     #agicen14#2 = #agicen30#3;
     #agicen14#3 = #agicen30#4;
     #agicen14#4 = #agicen30#5;
     #agicen14#7 = #agicen30#6;
     #agicen14#8 = #agicen30#7;
     #agicen14#9 = #agicen30#8;
     #agicen14#10 = #agicen30#9;
     #agicen14#11 = #agicen30#10;
     #agicen14#12 = #agicen30#11;
     #agicen14#15 = #agicen30#16;
     #agicen14#16 = #agicen30#12;
     #agicen14#17 = #agicen30#13;
     #agicen14#18 = #agicen30#14;
     #agicen14#19 = #agicen30#15;
 |FINSI;
 |CIERRA #agicen30;
|FPRC;

|PROCESO LaActividad;
 |HAZ LeoAgicen30;

 |SI #agicen14#6 > "01.01.0000";
     |SI #0#24 = "N"; |ACABA; |FINSI;
 |FINSI;

 |SI #0#66 = "N"; ||las actividades exentas no
     |SI #agicen14#9 = 1; |O #agicen14#9 = 18; |O #agicen14#9 = 19;
         |ACABA;
     |FINSI;
 |FINSI;

 aAlfa1 = #agicen14#15; |QBF aAlfa1;
 |SI aAlfa1 = "REGISTROS";  nDConta = 1; |FINSI;
 |SI aAlfa1 = "PLANILLAS";  nDPlani = 1; |FINSI;
 |SI aAlfa1 = "MANUAL"; |BUCLE LeoDsmom009; nDConta = 1; |FINSI;

 |SI nDConta = 0; |Y nDPlani = 1;
     enSwSelEmp = 0;
 |FINSI;
 |SI nDConta = 1; |Y nDPlani = 1;
     nMixto = 1;
     enSwSelEmp = 1;
 |FINSI;
|FPRC;

|DEFBUCLE LaActividad;
  #agicen14#1,
  ;
  enEmpresa, 01;
  enEmpresa, 99;
  e;
  NULL, LaActividad;
|FIN;

|| .................... graba Contabilidad
|PROCESO LEmpresaConta;

   enEmpresa  = #canempre#2;
   enPerConta = #canempre#3;   || Periodo Contable

   |SI #0#24 = "N"; |Y #canempre#21 = "I"; |ACABA; |FINSI;

|| ------------------------------------------------------------------------
   aAlfa1 = enEmpresa;  aAlfa1 = ("00000" + aAlfa1) % -105;
   aAlfa2 = enPerConta; aAlfa2 = ("0" + aAlfa2) % -101;
   aPathConta  = aPath + "contagen/fich/" + aAlfa1 + aAlfa2 + "/";
   |SI nMixto = 1;
       aPathConta = aPathConta + ".Mixto";
   |FINSI;

   nGTempo = nGTempo + 1;
   #999#0 = nGTempo;       || Guia
   #999#1 = enEmpresa;     || Empresa
   #999#2 = enPerConta;    || Periodo Contable
   #999#3 = enEjer;        || A¤o
   #999#4 = #canempre#11;  || Desde Mes
   #999#5 = #canempre#13;  || N§ Digitos
   #999#6 = #canempre#14;  || Digitos Nivel 1
   #999#7 = #canempre#15;  || Digitos Nivel 2
   #999#8 = #canempre#16;  || Digitos Nivel 3
   #999#9 = #canempre#17;  || Digitos Nivel 4
   #999#10 = #canempre#18; || Digitos Nivel 5
   #999#11 = #canempre#19; || Digitos Nivel 6
   eaEstadoEmp = "S"; |SI #canempre#21 = "I"; eaEstadoEmp = "N"; |FINSI;
   #999#12 = eaEstadoEmp;  || Estado
   #999#13 = #canempre#28; || Moneda
   #999#14 = #canempre#1;  || Nombre Empresa
   #999#15 = aPathConta;   || Path
   #999#16 = #0#43;        || Emitir
   |GRABA 020#999n;
|FPRC;

|PROCESO LEmpresaEOS;
 enEmpresa  = #agifigen#0;
 enPerConta = 0;

 eaEstadoEmp = "S";
 |SI #agifigen#94 > "01.01.0000";
     eaEstadoEmp = "N";
     |SI #0#24 = "N"; |ACABA; |FINSI;
 |FINSI;

|| ... Seleccion de Tipo de Empresa
  nSPin1 = #agifigen#87;
  enSwSelEmp = 1;
  |SI #0#46 = "S";
      |SI nSPin1 ] #0#25; |Y nSPin1 [ #0#26;
          enSwSelEmp = 0;
      |FINSI;
  |SINO;
      |SI nSPin1 = #0#27;
          enSwSelEmp = 0;
      |SINO;
          |PARA nCampo = 28;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
                |SI nSPin1 = #0nCampo; |Y nSPin1 ! 0;
                    enSwSelEmp = 0;
                    |SAL;
                |FINSI;
          |SIGUE;
      |FINSI;
  |FINSI;
  |SI enSwSelEmp = 1; |ACABA; |FINSI;
|| ------------------------------------------------------------------------
   nMixto     = 0;
   nDConta    = 0;
   nDPlani    = 0;
   enSwSelEmp = 1;
   |BUCLE LaActividad;
   |SI enSwSelEmp = 0;
       |HAZ LEmpresaPlan;
   |SINO;
       |SELECT #4#canempre;
       #canempre#2  = enEmpresa;
       #canempre#26 = nEjercicio;
       |LEE 001#canempre.=;
       |SI FSalida = 0;
           |HAZ LEmpresaConta;
       |SINO;
           |SI nMixto = 1;
               nMixto = 0;
               |HAZ LEmpresaPlan;
           |FINSI;
       |FINSI;
       |SELECT #1#canempre;
   |FINSI;
|FPRC;

|DEFBUCLE agifigen;
   #agifigen#1;
   ;
   nDEmpresa;
   nHEmpresa;
   e;
   NULL, LEmpresaEOS;
|FIN;

||///////////////////////////////////////////////////////////////////
|CALCULO Datos7; |TIPO 7;
 |MENSA "    <F3> Cambiar Emitir Balance S/N";
 |ATRI R; |PINTA 1169, "Imp"; |ATRI 0;
|FCAL;

|CALCULO DatosManip; |TIPO 11;
   nInkey = FSalida;
   |BLIN 04;

   |SI nInkey = 11;
       |SI #999#16 = "S";
           #999#16 = "N";
       |SINO;
           #999#16 = "S";
       |FINSI;
       |GRABA 020#999a;
   |FINSI;
|FCAL;

|RUTINA inferior;
   #999#0 = 00001;
|FRUT;

|RUTINA superior;
   #999#0 = 99999;
|FRUT;

||///////////////////////////////////////////////////////////////////
|CALCULO Tipo3;  |TIPO 3;

    #0#0  = "N"; ||  No es Inmovilizado

    aMonMod = "P";
    |HAZ LeeEURODBMOD;
    |SI EURODBMOD = 2; aMonMod = "E"; |FINSI;

    eaRenta = ""; enEjerR = 0;
    |SI #0#55 = "S";  eaRenta = "Cod.Renta"; enEjerR = #0#1; |FINSI;

    enEjer = #0#1;
    |HAZ Verm060Plan;
    |SI enPlan60 = 0; |ACABA; |FINSI;

    |ABRE #dsmom162;
    |DDEFECTO #dsmom162;
    #dsmom162#0 = enPlan60;
    |LEE 041#dsmom162.=;
    |CIERRA #dsmom162;

    aAlfa1 = enEjer; |QBF aAlfa1;
    aAlfa1 = aAlfa1 % -102;
    nEjercicio = aAlfa1;
    |DBASS aPath; |QBT aPath;

    aFichero = ("32w" + Usuario) % 108;
    |NOME_DAT #901 aFichero;
    aFichero = ("17w" + Usuario) % 108;
    |NOME_DAT #917 aFichero;

    aFichero = ("43w" + Usuario) % 108;
    |NOME_DAT #999 aFichero;
    |DELINDEX #999;
    eaFEmpresa = aFichero;

    aFichero = ("1w" + Usuario) % 108;
    |NOME_DAT #911 aFichero; |DELINDEX #911;
    aFichero = ("2w" + Usuario) % 108;
    |NOME_DAT #912 aFichero; |DELINDEX #912;

    enSwNo     = 0;

    |ABRE #999;
    nGTempo = 0;   ||Busco Empresas Contables
    |ABRE #canempre;
    |SI #0#2 ! 0;
        nDEmpresa = #0#2;
        nHEmpresa = #0#3;
        |BUCLE agifigen;
    |SINO;
        |PARA nPara1 = 4;  |SI nPara1 [ 23;  |HACIENDO nPara1 = nPara1 + 1;
              |SI #0nPara1 ! 0;
                  nDEmpresa = #0nPara1;
                  nHEmpresa = #0nPara1;
                  |BUCLE agifigen;
              |FINSI;
        |SIGUE;
    |FINSI;
    |CIERRA #canempre;
    |CIERRA #999;

    |SI nGTempo = 0;    || No existe ninguna empresa
        |SI enSwMvo = 0; |MENAV "    Error. No existe ninguna Empresa dentro de la Seleccion "; |FINSI;
        |DELINDEX #999;
        |ACABA;
    |FINSI;

    |SI enSwMvo = 0; |Y PARAMETRO ! "Planillas";
        |C_V #999#12,1,"N"; |C_P #999#16,1,1270;

        |PUSHV 0509 2375;
        |ENTLINEAL #1#999, -1, 2, 22, 1, inferior, superior;
        |POPV;
    |FINSI;
    |HAZ Imprimir;

    |DELINDEX #901;
    |DELINDEX #911;
    |DELINDEX #912;
    |DELINDEX #917;
    |DELINDEX #999;
|FCAL;

|| *************************************************************************
|| *************************************************************************
|| *************************************************************************
|| ....................... Para las Complementarias
|PROCESO PonACero;
      nTotal_I = 0;
      nTotal_C = 0;
      nTotal_V = 0;
      nTotal_G = 0;

      nTanto10 = 100;
      nTanto11 = 100;
      nTanto12 = 100;
      nTanto13 = 100;

      nTotal_I_3  = 0;  nTotal_I_6  = 0;  nTotal_I_9  = 0;  nTotal_I_12 = 0;
      nTotal_C_3  = 0;  nTotal_C_6  = 0;  nTotal_C_9  = 0;  nTotal_C_12 = 0;
      nTotal_V_3  = 0;  nTotal_V_6  = 0;  nTotal_V_9  = 0;  nTotal_V_12 = 0;
      nTotal_G_3  = 0;  nTotal_G_6  = 0;  nTotal_G_9  = 0;  nTotal_G_12 = 0;

      nTanto10_3 = 100; nTanto10_6 = 100; nTanto10_9 = 100; nTanto10_12 = 100;
      nTanto11_3 = 100; nTanto11_6 = 100; nTanto11_9 = 100; nTanto11_12 = 100;
      nTanto12_3 = 100; nTanto12_6 = 100; nTanto12_9 = 100; nTanto12_12 = 100;
      nTanto13_3 = 100; nTanto13_6 = 100; nTanto13_9 = 100; nTanto13_12 = 100;

|FPRC;

|PROCESO PonValor;
 |SI nPara3 [ 3;
     nTotal_I = nTotal_I_3;
     nTotal_C = nTotal_C_3;
     nTotal_V = nTotal_V_3;
     nTotal_G = nTotal_G_3;

     nTanto10 = nTanto10_3; nTanto11 = nTanto11_3;
     nTanto12 = nTanto12_3; nTanto13 = nTanto13_3;
 |FINSI;
 |SI nPara3 > 3; |Y nPara3 [ 6;
     nTotal_I = nTotal_I_6;
     nTotal_C = nTotal_C_6;
     nTotal_V = nTotal_V_6;
     nTotal_G = nTotal_G_6;

     nTanto10 = nTanto10_6; nTanto11 = nTanto11_6;
     nTanto12 = nTanto12_6; nTanto13 = nTanto13_6;
 |FINSI;
 |SI nPara3 > 6; |Y nPara3 [ 9;
     nTotal_I = nTotal_I_9;
     nTotal_C = nTotal_C_9;
     nTotal_V = nTotal_V_9;
     nTotal_G = nTotal_G_9;

     nTanto10 = nTanto10_9; nTanto11 = nTanto11_9;
     nTanto12 = nTanto12_9; nTanto13 = nTanto13_9;
 |FINSI;
 |SI nPara3 > 9;
     nTotal_I = nTotal_I_12;
     nTotal_C = nTotal_C_12;
     nTotal_V = nTotal_V_12;
     nTotal_G = nTotal_G_12;

     nTanto10 = nTanto10_12; nTanto11 = nTanto11_12;
     nTanto12 = nTanto12_12; nTanto13 = nTanto13_12;
 |FINSI;
|FPRC;

|PROCESO CalculaTanto;
 |SI nTotal_I ! #9#17;
     |SI nTotal_I = 0; nTanto10 =  0; |FINSI;
     |SI #9#17    = 0; nTanto10 = -1; |FINSI;
     |SI #9#17 ! 0; |Y nTotal_I ! 0;
         nTanto10 =  ((nTotal_I * 100) / #9#17);
     |FINSI;
 |FINSI;

 |SI nTotal_C ! #9#20;
     |SI nTotal_C = 0; nTanto12 =  0; |FINSI;
     |SI #9#20    = 0; nTanto12 = -1; |FINSI;
     |SI #9#20 ! 0; |Y nTotal_C ! 0;
         nTanto12 =  ((nTotal_C * 100) / #9#20);
     |FINSI;
 |FINSI;

 |SI nTotal_V ! #9#58;
     |SI nTotal_V = 0; nTanto11 =  0; |FINSI;
     |SI #9#58    = 0; nTanto11 = -1; |FINSI;
     |SI #9#58 ! 0; |Y nTotal_V ! 0;
         nTanto11 =  ((nTotal_V * 100) / #9#58);
     |FINSI;
 |FINSI;

 |SI nTotal_G ! #9#23;
     |SI nTotal_G = 0; nTanto13 =  0; |FINSI;
     |SI #9#23    = 0; nTanto13 = -1; |FINSI;
     |SI #9#23 ! 0; |Y nTotal_G ! 0;
         nTanto13 =  ((nTotal_G * 100) / #9#23);
     |FINSI;
 |FINSI;

 |SI nPara3 [ 3;
     nTotal_I_3 = nTotal_I;
     nTotal_C_3 = nTotal_C;
     nTotal_V_3 = nTotal_V;
     nTotal_G_3 = nTotal_G;

     nTanto10_3 = nTanto10; nTanto11_3 = nTanto11;
     nTanto12_3 = nTanto12; nTanto13_3 = nTanto13;
 |FINSI;
 |SI nPara3 > 3; |Y nPara3 [ 6;
     nTotal_I_6 = nTotal_I;
     nTotal_C_6 = nTotal_C;
     nTotal_V_6 = nTotal_V;
     nTotal_G_6 = nTotal_G;

     nTanto10_6 = nTanto10; nTanto11_6 = nTanto11;
     nTanto12_6 = nTanto12; nTanto13_6 = nTanto13;
 |FINSI;
 |SI nPara3 > 6; |Y nPara3 [ 9;
     nTotal_I_9 = nTotal_I;
     nTotal_C_9 = nTotal_C;
     nTotal_V_9 = nTotal_V;
     nTotal_G_9 = nTotal_G;

     nTanto10_9 = nTanto10; nTanto11_9 = nTanto11;
     nTanto12_9 = nTanto12; nTanto13_9 = nTanto13;
 |FINSI;
 |SI nPara3 > 9;
     nTotal_I_12 = nTotal_I;
     nTotal_C_12 = nTotal_C;
     nTotal_V_12 = nTotal_V;
     nTotal_G_12 = nTotal_G;

     nTanto10_12 = nTanto10; nTanto11_12 = nTanto11;
     nTanto12_12 = nTanto12; nTanto13_12 = nTanto13;
 |FINSI;
|FPRC;

|PROCESO Comprobar130;
 nTotal_I = #130#6;   ||Ingresos
 nTotal_C = #130#9;   ||Consumo
 nTotal_V = #130#46;  ||Variacion
 nTotal_G = #130#12;  ||Gastos
 nComplem = #130#4;
|FPRC;

|DEFBUCLE Comprobar130;
 #130#1;
 ;
 #9#0, #9#1, #9#2, 130, 00, #9#4;
 #9#0, #9#1, #9#2, 130, 99, #9#4;
 ;
 NULL, Comprobar130;
|FIN;

|PROCESO EspecialPlanillas;

     |ABRE #9;
     |PARA nPara3 = #0#49; |SI nPara3 [ #0#50; |HACIENDO nPara3 = nPara3 + 1;
           nComplem = -1;
           nTanto10 = 100; nTotal_I = 0;
           nTanto11 = 100; nTotal_C = 0;
           nTanto12 = 100; nTotal_V = 0;
           nTanto13 = 100; nTotal_G = 0;
           #9#0 = enEmpresa;
           #9#1 = #0#1;
           #9#2 = nPara3;
           #9#3 = 0;
           #9#4 = enActividad;
           |LEE 040#9=;
           |SI FSalida = 0;
               nComplem = #9#3;
               |SI #9#14 = "X";  |BUCLE Comprobar130;  |FINSI;
               |SI nComplem ! #9#3;
                   |HAZ CalculaTanto;
               |FINSI;
           |FINSI;
     |SIGUE;
     |CIERRA #9;
|FPRC;

|| -----------------------------------------------------------------------
|| **********************************************************************************
|PROCESO ImpCuentas;
   |SI nActi    = -1;
       nActi    = #912#1;
       nParcial = 0;
       eaActi   = nActi;
       eaActi   = ("00" + eaActi) % -102;
   |FINSI;
   |SI nActi ! #912#1;
       nNume4   = SwLinea;
       SwLinea  = 6; |PRINT;
       nParcial = 0;
       SwLinea  = nNume4;
       nActi    = #912#1;
       eaActi   = nActi;
       eaActi   = ("00" + eaActi) % -102;
   |FINSI;

   |PRINT;
   SwLinea = 400;
   nParcial = nParcial + #912#9;
   nTotal   = nTotal   + #912#9;
|FPRC;

|DEFBUCLE ImpCuentas;
   #912#1;
   ;
   enEmpresa, 00, enEjer, "            ";
   enEmpresa, 99, enEjer, "zzzzzzzzzzzz";
   ;
   NULL, ImpCuentas;
|FIN;

|PROCESO ImpCtasRet;
   SwLinea  = 3;
   nActi    = -1;
   nParcial = 0;
   nTotal   = 0;
   |BUCLE ImpCuentas;
   |SI nActi ! -1;
       SwLinea = 6; |PRINT;
       SwLinea = 5; |PRINT;
   |FINSI;
|FPRC;

|| **********************************************************************************
|PROCESO ImpComuneros_Pago;
   |PRINT;
   SwLinea = 2;
|FPRC;

|DEFBUCLE ImpComuneros_Pago;
   #911#1;
   ;
   00001;
   99999;
   ;
   NULL, ImpComuneros_Pago;
|FIN;
|| **********************************************************************************

|PROCESO LaSuma2;
  #900#29 = 0;
  |SI #900#25 > 0; #900#29 = #900#29 + #900#25; |FINSI;
  |SI #900#26 > 0; #900#29 = #900#29 + #900#26; |FINSI;
  |SI #900#27 > 0; #900#29 = #900#29 + #900#27; |FINSI;
  |SI #900#28 > 0; #900#29 = #900#29 + #900#28; |FINSI;
|FPRC;

|PROCESO LaSuma;
 |SI enPeriodo = 3;   aAlfa1 = "01.01." + enEjer;  |FINSI;
 |SI enPeriodo = 6;   aAlfa1 = "01.04." + enEjer;  |FINSI;
 |SI enPeriodo = 9;   aAlfa1 = "01.07." + enEjer;  |FINSI;
 |SI enPeriodo = 12;  aAlfa1 = "01.10." + enEjer;  |FINSI;
 fFecha = aAlfa1;

 |SI enPeriodo [ 3;                   nNume1 = 25; nNume2 = 30; |FINSI;
 |SI enPeriodo > 3; |Y enPeriodo [ 6; nNume1 = 26; nNume2 = 31; |FINSI;
 |SI enPeriodo > 6; |Y enPeriodo [ 9; nNume1 = 27; nNume2 = 32; |FINSI;
 |SI enPeriodo > 9;                   nNume1 = 28; nNume2 = 33; |FINSI;

 #900nNume1 = #900nNume1 + nImp1;
 #900nNume2 = #900nNume2 + nImp2;
 #900#34    = #900nNume2;

 SwHayDatos = 1;
|FPRC;

|PROCESO LSComunero;
     |SI #0#1 = 2008;
         enFrase = 1;
     |FINSI;

     nEstado = 0;
     #911#0 = #1#3;
     |LEE 001#911=;
     |SI FSalida ! 0;
         nEstado = 1;
         |DDEFECTO #911;
         #911#0 = #1#3;

         |ABRE #2;
         #2#0 = #1#3;
         |LEE 040#2=;
         |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
         |CIERRA #2;

         #911#1 = #1#5;   || Nombre
         #911#2 = #2#3;   || NIF

         |ABRE #114;
         #114#0 = #2#0; || Empresa
         #114#1 = #1#4;
         |LEE 041#114=;
         |SI FSalida = 0;
             enCodRen = #114#18;  ||Codigo en Renta
             |SI enEjerR ! 0; |HAZ CodigoRen; |FINSI;
             #911#14 = enCodRen;  ||Codigo en Renta
         |FINSI;
         |CIERRA #114;
     |FINSI;

     #911#3 = #1#7;   || % Participacion

     nImport1 = nImp1;
     nImport2 = nImp2;
     nImport3 = nImp1;

     |SI enPeriodo [ 3;                   nNume1 = 4; nNume2 = 9;  nNume3 = 15; |FINSI;
     |SI enPeriodo > 3; |Y enPeriodo [ 6; nNume1 = 5; nNume2 = 10; nNume3 = 16; |FINSI;
     |SI enPeriodo > 6; |Y enPeriodo [ 9; nNume1 = 6; nNume2 = 11; nNume3 = 17; |FINSI;
     |SI enPeriodo > 9;                   nNume1 = 7; nNume2 = 12; nNume3 = 18; |FINSI;

     #911nNume1 = #911nNume1 + nImport1;
     #911nNume2 = #911nNume2 + nImport2;
     #911#8     = #911#8  + nImport1;
     #911#13    = nImport2;

     #911nNume3 = #911nNume3 + nImport3;
     #911#19    = #911#19  + nImport3;

     |SI #0#55 = "N"; #911#14 = 0; |FINSI;

     |SI nEstado = 0; |GRABA 020#911a; |FINSI;
     |SI nEstado ! 0; |GRABA 020#911n; |FINSI;
     SwHayComun = 1;
|FPRC;

|| ****************************************************
|| ... los def de impresion  d130 y d131

|PROCESO modelo431_0;
     enPeriodo = #431#2;
     nImp1     = #431#33 + #431#41;
     nImp2     = #431#27 + #431#31;

     |SI nSwCom = 0;
        |HAZ LaSuma;
     |SINO;
        |HAZ LSComunero;
     |FINSI;
|FPRC;

|DEFBUCLE modelo431;
     #431#1;
     ;
     nNumEmp, #999#3, nPer, 000, nComplem, 00;
     nNumEmp, #999#3, nPer, 999, nComplem, 99;
     ;
     NULL, modelo431_0;
|FIN;

|PROCESO modelo430_0;
     enPeriodo = #430#2;

     |SI #430#1 [ 2007;
         nImp1     = #430#17;
     |SINO;
         |SI #430#1 = 2008;  |Y #430#2 = 3;
             nImp1 = #430#17;
         |SINO;
             nImp1 = #430#23 + #430#18;
         |FINSI;
     |FINSI;

     nImp2     = #430#11 + #430#15;

     |SI nSwCom = 0;
         |HAZ LaSuma;
     |SINO;
         |HAZ LSComunero;
     |FINSI;
|FPRC;

|DEFBUCLE modelo430;
     #430#1;
     ;
     nNumEmp, #999#3, nPer, 000, nComplem, 00;
     nNumEmp, #999#3, nPer, 999, nComplem, 99;
     ;
     NULL, modelo430_0;
|FIN;

|PROCESO ModeloImp;

     |ABRE #4;
     |PARA nPer = 3; |SI nPer [ 12;|HACIENDO nPer = nPer + 3;
           nComplem = -1;
           #4#0 = nNumEmp;
           #4#1 = enEjer;
           #4#2 = nPer;
           #4#3 = enModelo;
           #4#4 = 99;
           |LEE 040#4];
           |SI FSalida = 0;
               |LEE 040#4a;
           |SINO;
               |LEE 040#4u;
           |FINSI;
           |SI FSalida = 0; |Y #4#0 = nNumEmp;
               |Y #4#1 = enEjer; |Y #4#2 = nPer; |Y #4#3 = enModelo;
                  nComplem = #4#4;
           |FINSI;
           |SI nComplem ! -1;
               |SI enModelo = 130;  |BUCLE modelo430;  |FINSI;
               |SI enModelo = 131;  |BUCLE modelo431;  |FINSI;
           |FINSI;
     |SIGUE;
     |CIERRA #4;
|FPRC;

|| -----------------------

|PROCESO modelo131_0;
     #998#0 = #231#0;
     #998#1 = #231#1;
     #998#2 = #231#2;
     #998#3 = #231#3;
     #998#4 = #231#4 + 1;
     #998#5 = #231#5;
     |LEE 041#998=;
     |SI FSalida = 0;
         |ACABA;
     |FINSI;

     enPeriodo = #231#2;
     nImp1     = #231#11 + #231#14;    ||  #231#33;
     nImp2     = #231#12 + #231#15;    ||  #231#27 + #231#31;

     |HAZ LaSuma;
|FPRC;

|DEFBUCLE modelo131;
     #231#1;
     ;
     nNumEmp, #999#3, 00, 000, 00, nDActEmp;
     nNumEmp, #999#3, 99, 999, 99, nHActEmp;
     ;
     NULL, modelo131_0;
|FIN;

|PROCESO modelo130_0;
     #998#0 = #130#0;
     #998#1 = #130#1;
     #998#2 = #130#2;
     #998#3 = #130#3;
     #998#4 = #130#4 + 1;
     #998#5 = #130#5;
     |LEE 041#998=;
     |SI FSalida = 0;
         |ACABA;
     |FINSI;

     enPeriodo = #130#2;
     nImp1     = #130#33;   || #130#17; del d130
     nImp2     = #130#31;   || #130#11 + #130#15;

     |HAZ LaSuma;
|FPRC;

|DEFBUCLE modelo130;
     #130#1;
     ;
     nNumEmp, #999#3, 00, 000, 00, 00;
     nNumEmp, #999#3, 99, 999, 99, 99;
     ;
     NULL, modelo130_0;
|FIN;

|| **********************************************

|PROCESO RelComuneros0_Pago;
     |SI #1#8 > "01.01.0000";
         |SI #1#8 > efHFecha; |ACABA;  |FINSI;
     |FINSI;
     |SI #1#9 > "01.01.0000";
         |SI #1#9 < efDFecha;  |ACABA;  |FINSI;
     |FINSI;

     nSwCom   = 1;
     nNumEmp  = #1#3;
     nDActEmp = 00;
     nHActEmp = 99;

     |HAZ ModeloImp;
|FPRC;

|DEFBUCLE RelComuneros_Pago;
     #1#1;
     ;
     #999#1, enActividad, 0001;
     #999#1, enActividad, 9999;
      e;
     NULL, RelComuneros0_Pago;
|FIN;

|PROCESO LosComuneros;
        |SI enModelo = 130; aDef = "dsmoc130.mas"; |FINSI;
        |SI enModelo = 131; aDef = "dsmoc131.mas"; |FINSI;

        |DBASE aBase;  |QBF aBase;
        aMas = aBase + "def/" + aDef;
        |CARGA_DEF aMas, dsmoc13@;
        |SI FSalida ! 0;
            |MENAV "    Error al Cargar el Def " + aDef;
            |ACABA;
         |FINSI;

         nSwCom   = 0;
         nNumEmp  = #999#1;
         nDActEmp = 00;
         nHActEmp = 99;

         |ABRE #998;             || sumo el de trabajo para la Comunidad
         |SI enModelo = 130;
            |BUCLE modelo130;
         |SINO;
            |BUCLE modelo131;
         |FINSI;
         |CIERRA #998;

         |ABRE #911;
         nSwCom  = 1;
         |BUCLE RelComuneros_Pago;
         |CIERRA #911;

         |DESCARGA_DEF #dsmoc13@;
|FPRC;

|| -------------------------------------------------------------------------
|| ***********************************************
|PROCESO Busco131;
     enModelo = 131;
     |DELINDEX #901;
     SwHayDatos = 0;
     SwHayComun = 0;
     |PDEFECTO #900, 25, 50;

     |SI aCoBien = "N";
         nNumEmp = #999#1;
         nSwCom  = 0;
         nDActEmp = 1;
         nHActEmp = 99;
         |HAZ ModeloImp;
     |SINO;
         |HAZ LosComuneros;
     |FINSI;

     |SI SwHayDatos = 1;
         |HAZ LaSuma2;
         |SI #900#25 ! 0; |O #900#26 ! 0; |O #900#27 ! 0; |O #900#28 ! 0;
             |O #900#30 ! 0; |O #900#31 ! 0; |O #900#32 ! 0; |O #900#33 ! 0;
||                nSwPago = 1;
                SwLinea = 0;  || SwLinea = 100;
                nTp3    = 131;
                aAlfa1  = #900#50; |QBF aAlfa1;
                aAlfa1 = aAlfa1 + " " + nTp3 + " -";
                #900#50 = aAlfa1;
                |PRINT;
                |SI nQueBusco ! 1;
                    |HAZ ImpCtasRet;
                |FINSI;
                SwLinea = 1;  ||  SwLinea = 101;
                |SI SwHayComun ! 0;  |BUCLE ImpComuneros_Pago;  |FINSI;
                |PIEINF;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Busco130;
     enModelo = 130;
     |DELINDEX #911;
     SwHayDatos = 0;
     SwHayComun = 0;
     enFrase    = 0;
     |PDEFECTO #900, 25, 50;

     |SI aCoBien = "N";
         nNumEmp = #999#1;
         nSwCom  = 0;
         nDActEmp = 0;
         nHActEmp = 99;

         |HAZ ModeloImp;
     |SINO;
         |HAZ LosComuneros;
     |FINSI;

     |SI SwHayDatos = 1;
         |HAZ LaSuma2;
         |SI #900#25 ! 0; |O #900#26 ! 0; |O #900#27 ! 0; |O #900#28 ! 0;
             |O #900#30 ! 0; |O #900#31 ! 0; |O #900#32 ! 0; |O #900#33 ! 0;
||                nSwPago = 1;
                SwLinea = 0;   ||SwLinea = 100
                nTp3    = 130;
                aAlfa1  = #900#50; |QBF aAlfa1;
                aAlfa1 = aAlfa1 + " " + nTp3 + " -";
                #900#50 = aAlfa1;
                |PRINT;
                |SI nQueBusco ! 1;
                    |HAZ ImpCtasRet;
                |FINSI;
                SwLinea = 1;  ||SwLinea = 101;
                |SI SwHayComun ! 0;  |BUCLE ImpComuneros_Pago;  |FINSI;
                |PIEINF;
         |FINSI;
     |FINSI;

|FPRC;

|PROCESO LosPagos;
    nError = 0;
    |SI #0#64 = "S";
       |FININF;
       |INFOR informR;
       |SI FSalida ! 0;
           |MENAV "    Error en el Informe de Pagos y Retenciones";
           nError = 1;
           |ACABA;
       |FINSI;

       nNume1 = #900#52;
       enActividad = nActividad;
       |HAZ LeeDatosEmpresa;
       |SI #900#52 = 0; #900#52 = nNume1; |FINSI;

       |SI aCoBien = "S"; |Y #0#65 = "N";
           |ACABA;
       |FINSI;

       |SI swNoExis = 0;
           |HAZ Busco130;
           |HAZ Busco131;
       |FINSI;
    |FINSI;
|FPRC;

|| ************************************************************************
|| ------------------------------------------------------------------------
|PROCESO LosTextos;
     |SI #dsmoy012#67 = "N";
         #60#6 = enPlan60;
         #60#0 = #901#0;
         #60#1 = #901#1;
         #60#2 = #901#2;
         |LEE 001#60=;
         |SI FSalida ! 0;
             |DDEFECTO #60;
         |FINSI;
     |SINO;
         #dsmom160#0 = enPlan60;
         #dsmom160#1 = #901#0;
         #dsmom160#2 = #901#1;
         #dsmom160#3 = #901#2;
         |LEE 041#dsmom160.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsmom160;
         |FINSI;
         #60#6 = enPlan60;
         #60#0 = #901#0;
         #60#1 = #901#1;
         #60#2 = #901#2;
         #60#3 = #dsmom160#5;
         #60#4 = #dsmom160#6;
         #60#5 = #dsmom160#7;
         #60#7 = #dsmom160#4;
     |FINSI;
|FPRC;

|PROCESO LeeAux0;

 |SI #901#3 ! 0; |O #901#4 ! 0; |O #901#5 ! 0; |O #901#6 ! 0;

     |HAZ LosTextos;

     |SI #0#40 = "E";
         |PRINT;
     |SINO;
         |SI #901#2 = 01; |Y #901#1 = "G";
             |PRINT;
             enI1 = #901#3;
             enI2 = #901#4;
             enI3 = #901#5;
             enI4 = #901#6;
             enI5 = #901#7;
         |FINSI;
     |FINSI;
     SwLinea = 1;
     SwPrim  = 1;
     sw      = 1;

 |SI #901#8 ! 1;
     |SI #901#1 = "I";
         #900#25 = #900#25 + #901#3;
         #900#26 = #900#26 + #901#4;
         #900#27 = #900#27 + #901#5;
         #900#28 = #900#28 + #901#6;
         #900#29 = #900#29 + #901#7;
     |SINO;
         #900#30 = #900#30 + #901#3;
         #900#31 = #900#31 + #901#4;
         #900#32 = #900#32 + #901#5;
         #900#33 = #900#33 + #901#6;
         #900#34 = #900#34 + #901#7;
     |FINSI;
  |FINSI;
 |FINSI;
|FPRC;

|DEFBUCLE LeeAux;
  #901#1;
  ;
  #0#0, aTipIG, 01;
  #0#0, aTipIG, 99;
  ;
  NULL, LeeAux0;
|FIN;

|PROCESO ImpAuxiliarE;    || ... Imprimir el balance en detalle

 |ABRE #60;
 |ABRE #dsmom160;
 SwLinea = 0;
 SwPrim  = 0;
 nPagina = 1;
 |PDEFECTO #900,25,50;
 |SI aCoBien = "S"; |HAZ ImpComuneros; |FINSI;

 eaTitul2 = "INGRESOS INTEGROS";
 sw      = 0;
 SwLinea = 0;
 aTipIG = "I";
 |BUCLE LeeAux;
 |SI sw = 1;
     eaTitul2 = "Total Ingresos computables";
     SwLinea = 2;
     |PRINT;
 |FINSI;

 eaTitul2 = "GASTOS FISCALMENTE DEDUCIBLES";
 sw      = 0;
 SwLinea = 0;
 aTipIG  = "G";
 |BUCLE LeeAux;

|| ... Gastos de Dificil Justificacion
 |SI nTTribut = 4; |O nTTribut = 9; |O nTTribut = 14;
     |HAZ CalDificilJusti;
 |FINSI;

|| ... Gastos Totales
 #900#40 = #900#30 + #900#35;
 #900#41 = #900#31 + #900#36;
 #900#42 = #900#32 + #900#37;
 #900#43 = #900#33 + #900#38;
 #900#44 = #900#34 + #900#39;

|| ... Rendimiento Neto
 #900#45 = #900#25 - #900#40;
 #900#46 = #900#26 - #900#41;
 #900#47 = #900#27 - #900#42;
 #900#48 = #900#28 - #900#43;
 #900#49 = #900#29 - #900#44;

 eaTitul2 = "          Suma parcial de gastos fiscalmente deducibles";
 SwLinea = 2;
 |SI #900#35 ! 0; |O #900#36 ! 0; |O #900#37 ! 0; |O #900#38 ! 0;
     |SI sw = 1;
         |PRINT;
     |FINSI;
     SwLinea = 3;
     eaTitul2 = "Gastos de dificil justificacion (5% de la diferencia positiva)";
     |PRINT;
 |FINSI;
 |SI #900#40 ! 0; |O #900#41 ! 0; |O #900#42 ! 0; |O #900#43 ! 0;
     SwLinea = 4;
     eaTitul2 = "Total Gastos fiscalmente deducibles ";
     |PRINT;
 |FINSI;

|| |SI #0#64 = "S";
||     SwLinea = 20; |PRINT;
||     |HAZ LosPagos;
|| |FINSI;
 |PIEINF;
 |CIERRA #dsmom160;
 |CIERRA #60;

|FPRC;

|| //////////////////////////////////////////////////////////////////
|PROCESO CalDificilJusti;

|| ... ... ... ... ... ... Primer Trimestre
    nTp    = 20;
    |SI #0#1 ] 2016; |Y aCoBien ! "S";
        nNume1 = nTotal25 - nTotal30;
        nNume2 = (nNume1 % 5) ! EURODBMOD;
        |SI nNume2 > 2000;
            nTp = (nNume1 / 2000) ! 2;
        |FINSI;
    |FINSI;

    #900#35 = #900#25 - #900#30;
    |SI #900#35 > 0;
        #900#35 = (#900#35 / nTp) ! EURODBMOD;
    |SINO;
        #900#35 = 0;
    |FINSI;

    |SI #900#35 > 2000; |Y #0#1 = 2015;
        #900#35 = 2000;
    |FINSI;

|| ... ... ... ... ... ... Segundo Trimestre
    nTp    = 20;
    |SI #0#1 ] 2016; |Y aCoBien ! "S";
        nNume1 = nTotal26 - nTotal31;
        nNume2 = (nNume1 % 5) ! EURODBMOD;
        |SI nNume2 > 2000;
            nTp = (nNume1 / 2000) ! 2;
        |FINSI;
    |FINSI;

    #900#36 = (#900#26 + #900#25)  - (#900#31 + #900#30);
    |SI #900#36 > 0;
        #900#36 = (#900#36 / nTp) ! EURODBMOD;
        |SI #900#36 > 2000; |Y #0#1 = 2015;
            #900#36 = 2000;
        |FINSI;
    |SINO;
        #900#36 = 0;
    |FINSI;
    #900#36 = #900#36 - #900#35;

|| ... ... ... ... ... ... Tercer Trimestre
    nTp    = 20;
    |SI #0#1 ] 2016; |Y aCoBien ! "S";
        nNume1 = nTotal27 - nTotal32;
        nNume2 = (nNume1 % 5) ! EURODBMOD;
        |SI nNume2 > 2000;
            nTp = (nNume1 / 2000) ! 2;
        |FINSI;
    |FINSI;

    #900#37 = (#900#27 + #900#26 + #900#25)  - (#900#32 + #900#31 + #900#30);
    |SI #900#37 > 0;
        #900#37 = (#900#37 / nTp) ! EURODBMOD;
        |SI #900#37 > 2000; |Y #0#1 = 2015;
            #900#37 = 2000;
        |FINSI;
    |SINO;
        #900#37 = 0;
    |FINSI;
    #900#37 = #900#37 - (#900#36 + #900#35);

|| ... ... ... ... ... ... Cuarto Trimestre
    nTp    = 20;
    |SI #0#1 ] 2016; |Y aCoBien ! "S";
        nNume1 = nTotal28 - nTotal33;
        nNume2 = (nNume1 % 5) ! EURODBMOD;
        |SI nNume2 > 2000;
            nTp = (nNume1 / 2000) ! 2;
        |FINSI;
    |FINSI;

    #900#38 = (#900#28 + #900#27 + #900#26 + #900#25) - (#900#33 + #900#32 + #900#31 + #900#30);
    |SI #900#38 > 0;
        #900#38 = (#900#38 / nTp) ! EURODBMOD;
        |SI #900#38 > 2000; |Y #0#1 = 2015;
            #900#38 = 2000;
        |FINSI;
    |SINO;
        #900#38 = 0;
    |FINSI;
    #900#38 = #900#38 - (#900#37 + #900#36 + #900#35);

|| ... ... ... ... ... ... Total
    nTp    = 20;
    |SI #0#1 ] 2016; |Y aCoBien ! "S";
        nNume1 = nTotal29 - nTotal34;
        nNume2 = (nNume1 % 5) ! EURODBMOD;
        |SI nNume2 > 2000;
            nTp = (nNume1 / 2000) ! 2;
        |FINSI;
    |FINSI;

    #900#39 = #900#29 - #900#34;
    |SI #900#39 > 0;
        #900#39 = (#900#39 / nTp) ! EURODBMOD;
        |SI #900#39 > 2000; |Y #0#1 = 2015;
            #900#39 = 2000;
        |FINSI;
    |SINO;
        #900#39 = 0;
    |FINSI;
|FPRC;

|| //////////////////////////////////////////////////////////////////
|PROCESO ImpAuxiliarR;    || ... Imprimir el balance resumido (130)

 |ABRE #60;
 |ABRE #dsmom160;
 SwLinea = 0;
 SwPrim  = 0;
 nPagina = 1;
 |PDEFECTO #900,25,50;
 |SI aCoBien = "S";|HAZ ImpComuneros; |FINSI;

 enI1 = 0; enI2 = 0; enI3 = 0; enI4 = 0; enI5 = 0;
 sw      = 0;
 aTipIG = "I";
 SwLinea = 0;
 |BUCLE LeeAux;
 |SI sw = 1;

     eaTitul2 = "Ventas e Ingresos Imputables";

     enI1 = #900#25;
     enI2 = #900#26;
     enI3 = #900#27;
     enI4 = #900#28;
     enI5 = #900#29;

     SwLinea = 2;
     |PRINT;
 |FINSI;

 enI1 = 0; enI2 = 0; enI3 = 0; enI4 = 0; enI5 = 0;
 sw      = 0;
 SwLinea = 0;
 aTipIG  = "G";
 |BUCLE LeeAux;

|| ... Gastos de Dificil Justificacion
 |SI nTTribut = 4; |O nTTribut = 9; |O nTTribut = 14;
     |HAZ CalDificilJusti;
 |FINSI;

|| ... Gastos Totales
 #900#40 = #900#30 + #900#35;
 #900#41 = #900#31 + #900#36;
 #900#42 = #900#32 + #900#37;
 #900#43 = #900#33 + #900#38;
 #900#44 = #900#34 + #900#39;

|| ... Rendimiento Neto
 #900#45 = #900#25 - #900#40;
 #900#46 = #900#26 - #900#41;
 #900#47 = #900#27 - #900#42;
 #900#48 = #900#28 - #900#43;
 #900#49 = #900#29 - #900#44;

 eaTitul2 = "Gastos deducibles ";
 SwLinea = 2;
 enI1 = #900#40 - enI1;
 enI2 = #900#41 - enI2;
 enI3 = #900#42 - enI3;
 enI4 = #900#43 - enI4;
 enI5 = #900#44 - enI5;
 |SI enI1 ! 0; |O enI2 ! 0; |O enI3 ! 0; |O enI4 ! 0;
     |PRINT;
 |FINSI;

|| |SI #0#64 = "S";
||     SwLinea = 20; |PRINT;
||     |HAZ LosPagos;
||  |FINSI;

 |PIEINF;
 |CIERRA #dsmom160;
 |CIERRA #60;
|FPRC;

|| /////////////////////////////////////////////////////////////////
|| /////////////////////////////////////////////////////////////////
|| ... ... ... ... ... ... ... ... ... Planillas
|PROCESO PonExistencias;
     |SI nTanto11 ! 100; |Y nTanto11 ! -1;
         #11#8 = (#11#8 % nTanto11) ! EURODBMOD;
         #11#9 = (#11#9 % nTanto11) ! EURODBMOD;
     |SINO;
         |SI nTanto11 = -1;
             #11#8 = nTotal_V;
             #11#9 = 0;
             nTotal_V = 0;
             |SI #11#2 [ 3;               nTotal_V_3  = 0; |FINSI;
             |SI #11#2 > 3; |Y #11#2 [ 6; nTotal_V_6  = 0; |FINSI;
             |SI #11#2 > 6; |Y #11#2 [ 9; nTotal_V_9  = 0; |FINSI;
             |SI #11#2 > 9;               nTotal_V_12 = 0; |FINSI;
         |FINSI;
     |FINSI;
     nSaldo = nSaldo + (#11#8 - #11#9);
     nEnExi = 1;
|FPRC;

|DEFBUCLE dsmom011;
     #11#2;
     ;
     #12#0, #12#1, #12#2, #12#3, #12#4, #12#5, "    ";
     #12#0, #12#1, #12#2, #12#3, #12#4, #12#5, "zzzz";
     ;
     NULL, PonExistencias;
|FIN;

|PROCESO SumaSP13;
 |SI enEjer ] 2019;
     aAlfa  = (#13#5 % 101);
     aAlfa2 = (#13#5 % 102);
     |SI aAlfa = "6"; |O aAlfa2 = "71";
         |SI #dsmom061#5 = "-"; #13#7 = "-"; |FINSI;
     |FINSI;
     |SI aAlfa = "7"; |Y aAlfa2 ! "71";
         |SI #dsmom061#5 = "+"; #13#7 = "-"; |FINSI;
     |FINSI;
 |FINSI;

 |SI #0#51 = "S"
     |SI #13#2 < #0#49; |O #13#2 > #0#50;
         |ACABA;
     |FINSI;
 |FINSI;

 SwHayDatos = 1;
 |SI nPara3 ! #13#2;
     nPara3 = #13#2;
     |HAZ PonValor;
 |FINSI;

 nNume1 = 1;
 |SI #13#7 = "-"; nNume1 = -1; |FINSI;
 #13#8 = #13#8 * nNume1;

 |SI nTanto13 ! 100; |Y nTanto13 ! -1;
      #13#8 = (#13#8 % nTanto13) ! EURODBMOD;
 |SINO;
      |SI nTanto13 = -1;
          #13#8 = nTotal_G;
          nTotal_G = 0;
          |SI #13#2 [ 3;               nTotal_G_3  = 0; |FINSI;
          |SI #13#2 > 3; |Y #13#2 [ 6; nTotal_G_6  = 0; |FINSI;
          |SI #13#2 > 6; |Y #13#2 [ 9; nTotal_G_9  = 0; |FINSI;
          |SI #13#2 > 9;               nTotal_G_12 = 0; |FINSI;
      |FINSI;
 |FINSI;

 |SI #13#2 [ 3;                nSald1 = nSald1 + #13#8; |FINSI;
 |SI #13#2 ] 4; |Y #13#2 [ 6;  nSald2 = nSald2 + #13#8; |FINSI;
 |SI #13#2 ] 7; |Y #13#2 [ 9;  nSald3 = nSald3 + #13#8; |FINSI;
 |SI #13#2 ] 10;               nSald4 = nSald4 + #13#8; |FINSI;
 nSald5 = nSald5 + #13#8;
|FPRC;

|DEFBUCLE dsmom013;
 #13#1;
 ;
 enEmpresa, #0#1, nDPeriodo, nComplem, enActividad, aDCuenta;
 enEmpresa, #0#1, nHPeriodo, nComplem, enActividad, aHCuenta;
 e;
 NULL, SumaSP13;
|FIN;

|PROCESO SumaSP13desg;
  |PARA nPara4 = 0; |SI nPara4 [ 8; |HACIENDO nPara4 = nPara4 + 1;
        #dsmom013#nPara4# = #dsmopl13#nPara4#;
  |SIGUE;

  |HAZ SumaSP13;
|FPRC;

|DEFBUCLE dsmopl13;
 #dsmopl13#1;
 ;
 enEmpresa, #0#1, nDPeriodo, nComplem, enActividad, aDCuenta;
 enEmpresa, #0#1, nHPeriodo, nComplem, enActividad, aHCuenta;
 e;
 NULL, SumaSP13desg;
|FIN;

|PROCESO SumaSP12;
 |SI enEjer ] 2019;
     aAlfa  = (#12#5 % 101);
     aAlfa2 = (#12#5 % 102);
     |SI aAlfa = "6"; |O aAlfa2 = "71";
         |SI #dsmom061#5 = "-"; #12#7 = "-"; |FINSI;
     |FINSI;
     |SI aAlfa = "7"; |Y aAlfa2 ! "71";
         |SI #dsmom061#5 = "+"; #12#7 = "-"; |FINSI;
     |FINSI;
 |FINSI;

 |SI #0#51 = "S"
     |SI #12#2 < #0#49; |O #12#2 > #0#50;
         |ACABA;
     |FINSI;
 |FINSI;

 SwHayDatos = 1;
 |SI nPara3 ! #12#2;
     nPara3 = #12#2;
     |HAZ PonValor;
 |FINSI;

 nEnExi = 0;
 nSaldo = 0;
 |BUCLE dsmom011;
 |SI nEnExi = 0;
     |SI nTanto12 ! 100; |Y nTanto12 ! -1;
         #12#8 = (#12#8 % nTanto12) ! EURODBMOD;
     |SINO;
         |SI nTanto12 = -1;
             #12#8 = nTotal_C;
             nTotal_C = 0;
             |SI #12#2 [ 3;               nTotal_C_3  = 0; |FINSI;
             |SI #12#2 > 3; |Y #12#2 [ 6; nTotal_C_6  = 0; |FINSI;
             |SI #12#2 > 6; |Y #12#2 [ 9; nTotal_C_9  = 0; |FINSI;
             |SI #12#2 > 9;               nTotal_C_12 = 0; |FINSI;
         |FINSI;
     |FINSI;
     nSaldo = #12#8;
 |SINO;
      |SI #0#54 = "N"; nSaldo = 0; |FINSI;  ||no tiene en cuenta existencias
 |FINSI;

 nNume1 = 1; |SI #12#7 = "-"; nNume1 = -1; |FINSI;
 nSaldo = nSaldo * nNume1;

 |SI #12#2 [ 3;                nSald1 = nSald1 + nSaldo; |FINSI;
 |SI #12#2 ] 4; |Y #12#2 [ 6;  nSald2 = nSald2 + nSaldo; |FINSI;
 |SI #12#2 ] 7; |Y #12#2 [ 9;  nSald3 = nSald3 + nSaldo; |FINSI;
 |SI #12#2 ] 10;               nSald4 = nSald4 + nSaldo; |FINSI;

 |SI nEnExi = 0;
     nSald5 = nSald5 + nSaldo;
 |FINSI;
|FPRC;

|DEFBUCLE dsmom012;
 #12#1;
 ;
 enEmpresa, #0#1, nDPeriodo, nComplem, enActividad, aDCuenta;
 enEmpresa, #0#1, nHPeriodo, nComplem, enActividad, aHCuenta;
 e;
 NULL, SumaSP12;
|FIN;

|PROCESO SumaSP12desg;
  |PARA nPara4 = 0; |SI nPara4 [ 8; |HACIENDO nPara4 = nPara4 + 1;
        #dsmom012#nPara4# = #dsmopl12#nPara4#;
  |SIGUE;

  |HAZ SumaSP12;
|FPRC;

|DEFBUCLE dsmopl12;
 #dsmopl12#1;
 ;
 enEmpresa, #0#1, nDPeriodo, nComplem, enActividad, aDCuenta;
 enEmpresa, #0#1, nHPeriodo, nComplem, enActividad, aHCuenta;
 e;
 NULL, SumaSP12desg;
|FIN;

|PROCESO SumaSP10;
 |SI enEjer ] 2019;
     aAlfa  = (#10#5 % 101);
     aAlfa2 = (#10#5 % 102);
     |SI aAlfa = "6"; |O aAlfa2 = "71";
         |SI #dsmom061#5 = "-"; #10#7 = "-"; |FINSI;
     |FINSI;
     |SI aAlfa = "7"; |Y aAlfa2 ! "71";
         |SI #dsmom061#5 = "+"; #10#7 = "-"; |FINSI;
     |FINSI;
 |FINSI;

 |SI #0#51 = "S"
     |SI #10#2 < #0#49; |O #10#2 > #0#50;
         |ACABA;
     |FINSI;
 |FINSI;
 SwHayDatos = 1;

 |SI nPara3 ! #10#2;
     nPara3 = #10#2;
     |HAZ PonValor;
 |FINSI;

 nNume1 = 1;
 |SI #10#7 = "-"; nNume1 = -1; |FINSI;
 #10#8 = #10#8 * nNume1;

 |SI nTanto10 ! 100; |Y nTanto10 ! -1;
     #10#8 = (#10#8 % nTanto10) ! EURODBMOD;
 |SINO;
     |SI nTanto10 = -1;
         #10#8 = nTotal_I;
         nTotal_I = 0;
         |SI #10#2 [ 3;               nTotal_I_3  = 0; |FINSI;
         |SI #10#2 > 3; |Y #10#2 [ 6; nTotal_I_6  = 0; |FINSI;
         |SI #10#2 > 6; |Y #10#2 [ 9; nTotal_I_9  = 0; |FINSI;
         |SI #10#2 > 9;               nTotal_I_12 = 0; |FINSI;
     |FINSI;
 |FINSI;

 |SI #10#2 [ 3;                nSald1 = nSald1 + #10#8; |FINSI;
 |SI #10#2 ] 4; |Y #10#2 [ 6;  nSald2 = nSald2 + #10#8; |FINSI;
 |SI #10#2 ] 7; |Y #10#2 [ 9;  nSald3 = nSald3 + #10#8; |FINSI;
 |SI #10#2 ] 10;               nSald4 = nSald4 + #10#8; |FINSI;
 nSald5 = nSald5 + #10#8;
|FPRC;

|DEFBUCLE dsmom010;
 #10#1;
 ;
 enEmpresa, #0#1, nDPeriodo, nComplem, enActividad, aDCuenta;
 enEmpresa, #0#1, nHPeriodo, nComplem, enActividad, aHCuenta;
 e;
 NULL, SumaSP10;
|FIN;

|PROCESO SumaSP10desg;
  |PARA nPara4 = 0; |SI nPara4 [ 8; |HACIENDO nPara4 = nPara4 + 1;
        #dsmom010#nPara4# = #dsmopl10#nPara4#;
  |SIGUE;

  |HAZ SumaSP10;
|FPRC;

|DEFBUCLE dsmopl10;
 #dsmopl10#1;
 ;
 enEmpresa, #0#1, nDPeriodo, nComplem, enActividad, aDCuenta;
 enEmpresa, #0#1, nHPeriodo, nComplem, enActividad, aHCuenta;
 e;
 NULL, SumaSP10desg;
|FIN;
|| /////////////////////////////////////////////////////////////////

|| ... ... ... ... ... ... Cuentas Contables
|PROCESO LasExistencias;
  SwHayDatos = 1;
  nEnExi = 1;
  |SI nSwPlan = 0;
      nSald1 = nSald1 + #917#4;
      nSald2 = nSald2 + #917#5;
      nSald3 = nSald3 + #917#6;
      nSald4 = nSald4 + #917#7;
  |FINSI;
  nSald5 = nSald5 + #917#16;

  |SI #dsmom061#5 = "-"; |Y nSwPlan = 1; nSald5 = - nSald5; |FINSI;
|FPRC;

|DEFBUCLE ElAuxW17;
 #917#1;
 ;
 enEmpresa, enEjer, enActividad, aDCuenta;
 enEmpresa, enEjer, enActividad, aHCuenta;
 e;
 NULL, LasExistencias;
|FIN;

|| .......................
|PROCESO MiraSiSuma;
  enClAgrupa  = 0;
  eaClave60   = "   ";
  eaTip60     = #dsmom061#1;
  #dsmom060#6 = #dsmom061#6;
  #dsmom060#0 = #dsmom061#0;
  #dsmom060#1 = #dsmom061#1;
  #dsmom060#2 = #dsmom061#2;
  |LEE 041#dsmom060.=;
  |SI FSalida = 0;
      eaClave60 = #dsmom060#7;
      |HAZ eClaveAgrupa;
   |FINSI;
|FPRC;

|PROCESO SumaSaldos;

 SwHayDatos = 1;

 #917#0 = enEmpresa;
 #917#1 = enEjer;
 #917#2 = enActividad;
 #917#3 = #305#0;
 |LEE 000#917=;
 |SI FSalida ! 0;        || No existe en Existencias

     nSalPar5 = #305#14 + #305#17 + #305#20;
     nSalPar5 = nSalPar5 + #305#23 + #305#26 + #305#29;
     nSalPar5 = nSalPar5 + #305#32 + #305#35 + #305#38;
     nSalPar5 = nSalPar5 + #305#41 + #305#44 + #305#47;

     nSald1 = nSald1 + (#305#14 + #305#17 + #305#20);
     nSald2 = nSald2 + (#305#23 + #305#26 + #305#29);
     nSald3 = nSald3 + (#305#32 + #305#35 + #305#38);
     nSald4 = nSald4 + (#305#41 + #305#44 + #305#47);
     nSald5 = nSald5 + nSalPar5;

 |FINSI;
|FPRC;

|DEFBUCLE LeeCuentas;
 #305#2;
 3;
 aElDepar, aDCuenta, "S";
 aElDepar, aHCuenta, "S";
 e;
 NULL, SumaSaldos;
|FIN;

|PROCESO LeoLaAgrupacion;
  nClau2 = #dsmom161#3;
  enClAgrupa = 0;
|FPRC;

|DEFBUCLE LeoLaAgrupacion;
  #dsmom161#2;
  ;
  enPlan60, aClau0, aClau1, eaClave60, 01;
  enPlan60, aClau0, aClau1, eaClave60, 99;
  e;
  NULL, LeoLaAgrupacion;
|FIN

|PROCESO CambioClave;
 |SELECT #2#dsmom160;
 #dsmom160#0 = enPlan60;
 #dsmom160#1 = aClau0;
 #dsmom160#2 = aClau1;
 #dsmom160#4 = eaClave60;
 |LEE 041#dsmom160.=;
 |SI FSalida = 0;
     nClau2 = #dsmom160#3;
     enClAgrupa = 0;
 |SINO;
     nClau2 = -1;
     |BUCLE LeoLaAgrupacion;
 |FINSI;
 |SELECT #1#dsmom160;
|FPRC;

|PROCESO dsmom061_0;

 enClAgrupa = 0;
 |HAZ MiraSiSuma;
 aClau0 = #dsmom061#0;
 aClau1 = #dsmom061#1;
 nClau2 = #dsmom061#2;

 |SI #dsmoy012#67 = "S"; |HAZ CambioClave; |FINSI;
 |SI nClau2 = -1; |ACABA; |FINSI;

 nEnExi = 0;
 #901#0 = aClau0;
 #901#1 = aClau1;
 #901#2 = nClau2;
 |LEE 001#901=;
 |SI FSalida ! 0;
     |DDEFECTO #901;
     #901#0 = aClau0;
     #901#1 = aClau1;
     #901#2 = nClau2;
     #901#8 = enClAgrupa;
     |GRABA 020#901b;
 |FINSI;
 aAlfa1 = #dsmom061#4; |QBF aAlfa1;              aDCuenta = aAlfa1;
 aAlfa1 = (aAlfa1 + "zzzzzzzzzzzz") % 112; aHCuenta = aAlfa1;

 nSald1 = 0;  nSald2 = 0;
 nSald3 = 0;  nSald4 = 0;
 nSald5 = 0;

 |SI nQueBusco = 0;

     |ABRE #917;
     |BUCLE LeeCuentas;
     |CIERRA #917;
     nSwPlan = 0; |BUCLE ElAuxW17;

 |SINO;

     aAlfa = aDCuenta % 0; nNume1 = aAlfa;
     |SI nNume1 [ 4; |O enEjer < 2019;
         aDCuenta = aDCuenta % 104;
         aHCuenta = aHCuenta % 104;
         nComplem = 0;
         nPara3  = -1; |BUCLE dsmom010;
         nPara3  = -1; |BUCLE dsmom012;
         nPara3  = -1; |BUCLE dsmom013;
     |SINO;
         nPara3  = -1; |BUCLE dsmopl10;
         nPara3  = -1; |BUCLE dsmopl12;
         nPara3  = -1; |BUCLE dsmopl13;
     |FINSI;
     nSwPlan = 1;  |BUCLE ElAuxW17;
 |FINSI;

 |SI #dsmom061#5 = "-"; |Y nQueBusco = 0;
     nSald1 = - nSald1; nSald2 = - nSald2;
     nSald3 = - nSald3; nSald4 = - nSald4;
     nSald5 = - nSald5;
 |FINSI;

 |SI #dsmom061#7 = "P";
     |SI nSald1 < 0; nSald1 = 0; |FINSI;
     |SI nSald2 < 0; nSald2 = 0; |FINSI;
     |SI nSald3 < 0; nSald3 = 0; |FINSI;
     |SI nSald4 < 0; nSald4 = 0; |FINSI;
     |SI nSald5 < 0; nSald5 = 0; |FINSI;
 |FINSI;
 |SI #dsmom061#7 = "N";
     |SI nSald1 > 0; nSald1 = 0; |FINSI;
     |SI nSald2 > 0; nSald2 = 0; |FINSI;
     |SI nSald3 > 0; nSald3 = 0; |FINSI;
     |SI nSald4 > 0; nSald4 = 0; |FINSI;
     |SI nSald5 > 0; nSald5 = 0; |FINSI;
 |FINSI;

 #901#3 = #901#3 + nSald1;
 #901#4 = #901#4 + nSald2;
 #901#5 = #901#5 + nSald3;
 #901#6 = #901#6 + nSald4;
 #901#7 = #901#7 + nSald5;

 |GRABA 020#901a;
 |LIBERA #901;
|FPRC;

|DEFBUCLE dsmom061;
 #dsmom061#1;
 ;
 enPlan60, #0#0, " ", 00, 001;
 enPlan60, #0#0, "z", 99, 999;
 ;
 NULL, dsmom061_0;
|FIN;

|PROCESO CalCtas;

 |SI #301#0 = 0; |ACABA; |FINSI;

 nDepar = #301#21;
 |SI nDepar = 0;  nDepar = 1;   |FINSI;

 nTrim = 1;
 |SI #301#1 > fecha1; nTrim = 2; |FINSI;
 |SI #301#1 > fecha2; nTrim = 3; |FINSI;
 |SI #301#1 > fecha3; nTrim = 4; |FINSI;

 |SI #301#8 = "H"; #301#9 = 0; |FINSI;
 nSumaCtas = (#301#9 / enConversor) ! EURODBMOD;

 #912#0 = enEmpresa;
 #912#1 = nDepar;
 #912#2 = enEjer;
 #912#3 = #22#0;
 |LEE 101#912=;
 |SI FSalida ! 0;
     |DDEFECTO #912;
     #912#0 = enEmpresa;
     #912#1 = nDepar;
     #912#2 = enEjer;
     #912#3 = #22#0;
     #912#4 = #22#1;
     |GRABA 020#912b;
 |FINSI;

 |SI #22#3 = "-"; nSumaCtas = - nSumaCtas;  |FINSI;
 |SI nTrim = 1; #912#5 = #912#5 + nSumaCtas; |FINSI;
 |SI nTrim = 2; #912#6 = #912#6 + nSumaCtas; |FINSI;
 |SI nTrim = 3; #912#7 = #912#7 + nSumaCtas; |FINSI;
 |SI nTrim = 4; #912#8 = #912#8 + nNume2; |FINSI;
 #912#9 = #912#9 + nSumaCtas;
 |GRABA 020#912a;
 |LIBERA #912;
|FPRC;

|DEFBUCLE LeeApuntes;
  #301#3;
  0;
  aUno, fFechaIni, 000001, 0001, 01;
  aDos, fFechaFin, 999999, 9999, 98;
  e;
  NULL, CalCtas;
|FIN;

|PROCESO DatosContables;
   nSumaCtas = 0;
   aUno = #22#0;
   aDos = #22#0;
   |SI nQueBusco = 0;
       |BUCLE LeeApuntes;
   |FINSI;
|FPRC;

|DEFBUCLE dsmom022;
     #22#1;
     ;
     "            ";
     "zzzzzzzzzzzz";
     ;
     NULL, DatosContables;
|FIN;

||////////////////////////////////////////////////////////////////////////
|| ... Existencias Contables
|PROCESO GrabaVariacion;

 aAlfa = eaCuenta; |QBF aAlfa;
 |SI aAlfa = ""; |ACABA; |FINSI;

 #917#0 = enEmpresa;
 #917#1 = enEjer;
 #917#2 = #303#0;
 #917#3 = eaCuenta;
 |LEE 000#917=;
 |SI FSalida ! 0;
     |DDEFECTO #917;
     #917#0 = enEmpresa;
     #917#1 = enEjer;
     #917#2 = #303#0;
     #917#3 = eaCuenta;
     |GRABA 020#917c;
 |FINSI;
 #917#4 = #917#4 + nImpVar1;
 #917#5 = #917#5 + nImpVar2;
 #917#6 = #917#6 + nImpVar3;
 #917#7 = #917#7 + nImpVar4;
 #917#16 = #917#16 + nImpVar5;
 |GRABA 020#917a;
|FPRC;

|PROCESO LasExisConta;

 |SI #303#2 = doce; |ACABA; |FINSI;

 |PARA nPara2 = 11; |SI nPara2 [ 24; |HACIENDO nPara2 = nPara2 + 1;
       #303nPara2  = (#303nPara2  / enConversor) ! EURODBMOD;
       nNume3 = nPara2 - 11;
       |SI nNume3 < #0#52; |O nNume3 > #0#53;
           #303nPara2 = 0;
       |FINSI;
 |SIGUE;

 nImpVar1 = #303#11 - #303#14;
 nImpVar2 = 0;
 nImpVar3 = 0;
 nImpVar4 = 0;
 nImpVar5 = 0;
 |SI nImpVar1 ! 0;
     |SI nImpVar1 > 0;
         eaCuenta = #303#5;
     |SINO;
         eaCuenta = #303#8;
     |FINSI;
     |HAZ GrabaVariacion;
 |FINSI;

 nImpVar1 = 0;
 nImpVar2 = #303#14 - #303#17;
 nImpVar3 = 0;
 nImpVar4 = 0;
 nImpVar5 = 0;
 |SI nImpVar2 ! 0;
     |SI nImpVar2 > 0;
         eaCuenta = #303#5;
     |SINO;
         eaCuenta = #303#8;
     |FINSI;
     |HAZ GrabaVariacion;
 |FINSI;

 nImpVar1 = 0;
 nImpVar2 = 0;
 nImpVar3 = #303#17 - #303#20;
 nImpVar4 = 0;
 nImpVar5 = 0;
 |SI nImpVar3 ! 0;
     |SI nImpVar3 > 0;
         eaCuenta = #303#5;
     |SINO;
         eaCuenta = #303#8;
     |FINSI;
     |HAZ GrabaVariacion;
 |FINSI;

 nImpVar1 = 0;
 nImpVar2 = 0;
 nImpVar3 = 0;
 nImpVar4 = #303#20 - #303#23;
 nImpVar5 = 0;
 |SI nImpVar4 ! 0;
     |SI nImpVar4 > 0;
         eaCuenta = #303#5;
     |SINO;
         eaCuenta = #303#8;
     |FINSI;
     |HAZ GrabaVariacion;
 |FINSI;

 nImpVar1 = 0;
 nImpVar2 = 0;
 nImpVar3 = 0;
 nImpVar4 = 0;
 nNume1 = #0#52 + 11;  || mes iniciales
 nNume2 = #0#53 + 11;  || mes finales
 nImpVar5 = #303nNume1 - #303nNume2;
 |SI nImpVar5 ! 0;
     |SI nImpVar5 > 0;
         eaCuenta = #303#5;
     |SINO;
         eaCuenta = #303#8;
     |FINSI;
     |HAZ GrabaVariacion;
 |FINSI;

|FPRC;

|DEFBUCLE CaExistL;
 #303#1;
 ;
 #0#38, 01;
 #0#39, 99;
 e;
 NULL, LasExisConta;
|FIN;

|PROCESO LasExisPlanilla;
 |SI #0#52 [ 3;               nNume1 = 3;  |FINSI;
 |SI #0#52 > 3; |Y #0#52 [ 6; nNume1 = 6;  |FINSI;
 |SI #0#52 > 6; |Y #0#52 [ 9; nNume1 = 9;  |FINSI;
 |SI #0#52 > 9;               nNume1 = 12; |FINSI;

 |SI #0#53 [ 3;               nNume2 = 3;  |FINSI;
 |SI #0#53 > 3; |Y #0#53 [ 6; nNume2 = 6;  |FINSI;
 |SI #0#53 > 6; |Y #0#53 [ 9; nNume2 = 9;  |FINSI;
 |SI #0#53 > 9;               nNume2 = 12; |FINSI;

/*
 |SI #11#2 = nNume1; |O #11#2 = nNume2;
     eaCuenta = #11#10;
     nSaldo   = 0;
     |SI #11#2 = nNume1; nSaldo = nSaldo + #11#8; |FINSI;
     |SI #11#2 = nNume2; nSaldo = nSaldo - #11#9; |FINSI;

     nImpVar1 = 0;
     nImpVar2 = 0;
     nImpVar3 = 0;
     nImpVar4 = 0;
     nImpVar5 = nSaldo;
     |SI nImpVar5 ! 0;
         #303#0 = #11#4;
         |HAZ GrabaVariacion;
     |FINSI;
 |FINSI;
*/

     nImpVar1 = 0;
     nImpVar2 = 0;
     nImpVar3 = 0;
     nImpVar4 = 0;
     nImpVar5 = 0;

     eaCuenta = #11#10;
     nSaldo   = #11#8 - #11#9;

     |SI #11#2 ] 0; |Y #11#2 [ 3;  nImpVar1 = nSaldo; |FINSI;
     |SI #11#2 > 3; |Y #11#2 [ 6;  nImpVar2 = nSaldo; |FINSI;
     |SI #11#2 > 6; |Y #11#2 [ 9;  nImpVar3 = nSaldo; |FINSI;
     |SI #11#2 > 9;                nImpVar4 = nSaldo; |FINSI;

     |SI #11#2 = nNume2; nImpVar5 = nSaldo; |FINSI;
     |SI nSaldo ! 0;
         #303#0 = #11#4;
         |HAZ GrabaVariacion;
     |FINSI;
|FPRC;

|DEFBUCLE PlExistL;
     #11#1;
     ;
     enEmpresa, #0#1, 00, 00, 00, "    ";
     enEmpresa, #0#1, 99, 00, 99, "zzzz";
     ;
     NULL, LasExisPlanilla;
|FIN;

|| ----------------- Datos de la Comunidad
|PROCESO RelComuneros0;

     |PDEFECTO #0, 56,64;
     |SI #1#8 > "01.01.0000";
         |SI #1#8 > efHFecha; |ACABA;  |FINSI;
     |FINSI;
     |SI #1#9 > "01.01.0000";
         |SI #1#9 < efDFecha;  |ACABA;  |FINSI;
     |FINSI;

     |ABRE #2;
     #2#0 = #1#3;
     |LEE 040#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     #0#56  = ("00000" + #1#3) % -105;   || Codigo
     #0#59  = #1#5;   || Nombre
     #0#60  = #2#3;   || NIF

     |ABRE #114;
     #114#0 = #2#0; || Empresa
     #114#1 = #1#4;
     |LEE 041#114=;
     |SI FSalida = 0;
          enCodRen = #114#18;                   ||Codigo en Renta
          |SI enEjerR ! 0; |HAZ CodigoRen; |FINSI;
          #0#57 = ("00000" + enCodRen) % -105;  ||Codigo en Renta
          #0#58 = #114#19;  ||Perceptor
     |SINO;
          aAlfa1 = eaCodRenta;
          nOpTitular = 1;
          |SI #0#55 = "S"; aElDni = #2#3; |HAZ LaRentaSI;  |FINSI;
          #0#57 = eaCodR2;
          eaCodRenta = aAlfa1;
     |FINSI;
     |CIERRA #114;
     #0#61 = #1#7;
     #0#62 = #1#8;
     #0#63 = #1#9;
     |SI #0#55 = "N";
         #0#57 = "";
         #0#58 = "";
     |FINSI;

     |PRINT;
     SwLinea = 11;
|FPRC;

|DEFBUCLE RelComuneros;
     #1#1;
     ;
     enEmpresa, enActividad, 0001;
     enEmpresa, enActividad, 9999;
      e;
     NULL, RelComuneros0;
|FIN;

|PROCESO ImpComuneros;
 nNume5 = SwLinea;
 SwLinea = 10;
 |BUCLE RelComuneros;
 |SI SwLinea = 11;
     SwLinea = 12; |PRINT;
 |FINSI;
 SwLinea = nNume5;
|FPRC;

|| //////////////////////////////////////
|PROCESO Sumo2000;
     nNume1 = #900#25 - #900#30;
     |SI nNume1 > 0;
         nTotal25 = nTotal25 + #900#25;
         nTotal30 = nTotal30 + #900#30;
     |FINSI;

     nNume1 = (#900#25 + #900#26) - (#900#30 + #900#31);
     |SI nNume1 > 0;
         nTotal26 = nTotal26 + (#900#25 + #900#26);
         nTotal31 = nTotal31 + (#900#30 + #900#31);
     |FINSI;

     nNume1 = (#900#25 + #900#26 + #900#27) - (#900#30 + #900#31 + #900#32);
     |SI nNume1 > 0;
         nTotal27 = nTotal27 + (#900#25 + #900#26 + #900#27);
         nTotal32 = nTotal32 + (#900#30 + #900#31 + #900#32);
     |FINSI;

     nNume1 = (#900#25 + #900#26 + #900#27 + #900#28) - (#900#30 + #900#31 + #900#32 + #900#33);
     |SI nNume1 > 0;
         nTotal28 = nTotal28 + (#900#25 + #900#26 + #900#27 + #900#28);
         nTotal33 = nTotal33 + (#900#30 + #900#31 + #900#32 + #900#33);
     |FINSI;

     nNume1 = #900#29 - #900#34;
     |SI nNume1 > 0;
         nTotal29 = nTotal29 + #900#29;
         nTotal34 = nTotal34 + #900#34;
     |FINSI;
|FPRC;

|PROCESO SumoTotal2000;
  |SI #901#8 ! 1;
     |SI #901#1 = "I";
         #900#25 = #900#25 + #901#3;
         #900#26 = #900#26 + #901#4;
         #900#27 = #900#27 + #901#5;
         #900#28 = #900#28 + #901#6;
         #900#29 = #900#29 + #901#7;
     |SINO;
         #900#30 = #900#30 + #901#3;
         #900#31 = #900#31 + #901#4;
         #900#32 = #900#32 + #901#5;
         #900#33 = #900#33 + #901#6;
         #900#34 = #900#34 + #901#7;
     |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE SumoTotal2000;
  #901#1;
  ;
  #0#0, " ", 01;
  #0#0, "z", 99;
  ;
  NULL, SumoTotal2000;
|FIN;

|| ....................................
|PROCESO Emision;
   aAlfa1 = #999#15; |QBF aAlfa1;
   nQueBusco = 0;
   |SI aAlfa1 = "PLANILLAS";
       nQueBusco = 1;
   |SINO;
       aAlfa2 = aAlfa1 - ".Mixto"
       |SI aAlfa2 ! aAlfa1;
           nQueBusco = 2;
           #999#15 = aAlfa2;
       |FINSI;
   |FINSI;

   enSwPartido = 0;
   enEmpresa  = #999#1;
   enPerConta = #999#2;
   eaLaMonEmp = #999#13;

   |SI nQueBusco = 1;   ||Por planillas
       enConversor = 1; ||la misma moneda
   |SINO;
       |HAZ EnConversor;
   |FINSI;
   enEjer     = #999#3;   || A¤o
   dig1       = #999#4;   || Desde Mes
   dig3       = #999#5;   || N§ Digitos
   dig4       = #999#6;   || Digitos Nivel 1
   dig5       = #999#7;   || Digitos Nivel 2
   dig6       = #999#8;   || Digitos Nivel 3
   dig7       = #999#9;   || Digitos Nivel 4
   dig8       = #999#10;  || Digitos Nivel 5
   dig9       = #999#11;  || Digitos Nivel 6
   eaEstadoEmp = #999#12; || Estado
   eaNombreEmp = #999#14; || Nombre Empresa

   |SI #999#4 ! 1;
        enSwOpPar   = 0;
        |HAZ SituaEmpresa;
        enPerConta = enPeriodoPar;
        eaLaMonEmp = "E";
        #999#15 = aPathConta;
   |FINSI;

   aPathConta  = #999#15; |QBF aPathConta; || Path
   nCtRetencion = 0;

   || Recoger informacion sobre los niveles ...
   |SI dig3 = 1; MaximoDigitos = dig4; |FINSI;
   |SI dig3 = 2; MaximoDigitos = dig5; |FINSI;
   |SI dig3 = 3; MaximoDigitos = dig6; |FINSI;
   |SI dig3 = 4; MaximoDigitos = dig7; |FINSI;
   |SI dig3 = 5; MaximoDigitos = dig8; |FINSI;
   |SI dig3 = 6; MaximoDigitos = dig9; |FINSI;

   eaTituloL = #0#45; ||Titulo del Libro

   dirfich0 = "";
   |SI nQueBusco ! 1;
       |PATH_DAT #304 aPathConta;
       dirfich0 = aPathConta;
       eSwSelec  = 2;
       |ATRI I;
       |PINTA 2302, "Procesando Cuentas por Departamentos ... Espere ";
       eaDepar = "S";
       |ATRI 0;
       |SUB_EJECUTA_NP ":contagen/cacuedep";
       |PINTA 2302, "                                                ";
       |NOME_DAT #305 eaNomFDep;

       |PATH_DAT #301 aPathConta;
       |PATH_DAT #303 aPathConta;
       |PATH_DAT #305 aPathConta;
       |PATH_DAT #306 aPathConta;
       |DDEFECTO #306;  ||Configuracion de Informes
       |ABRE #306;
       #306#0 = 1;
       |LEE 000#306=;
       |CIERRA #306;

       |SI #0#54 = "S";
           |ABRE #917;
           |BUCLE CaExistL;
           |CIERRA #917;
       |FINSI;
       |SI #0#64 = "S";
           |ABRE #912;
           |BUCLE dsmom022;
           |CIERRA #912;
       |FINSI;
    |FINSI;
    |SI nQueBusco ! 0;
        #306#4 = "N";
        |SI #0#54 = "S";
           |ABRE #917;
           |BUCLE PlExistL;
           |CIERRA #917;
        |FINSI;
    |FINSI;

    |SI #0#51 = "N";
        |SI #0#40 = "E";
               informe = "dsmoy012";
               |SI #306#4 = "N"; informe = "drmoy012"; |FINSI;
        |SINO;
               informe = "dsmoyr12";
               |SI #306#4 = "N"; informe = "drmoyr12"; |FINSI;
        |FINSI;
        |SI #0#64 = "S";
            || informR = (informe % 104) + "2" + (informe % -103);
            informR = "dsmoy014";
        |FINSI;
    |SINO;
        |SI #0#40 = "E";
            informe = "dsmo1012";
            |SI #306#4 = "N"; informe = "drmo1012"; |FINSI;
        |SINO;
            informe = "dsmo1r12";
            |SI #306#4 = "N"; informe = "drmo1r12"; |FINSI;
        |FINSI;
        |SI #0#64 = "S";
            || informe = (informe % 104) + "3" + (informe % -103);
            informR = "dsmoyr14";
        |FINSI;
    |FINSI;

    nActividad = 0;
    |INFOR informe;
    |SI FSalida ! 0;  |ACABA;  |FINSI;

|| ////////////////////////////////////////////////
    nDActividad = #0#38; nHActividad = #0#39;
    |SI #0#1 ] 2015;
        nTotal25 = 0; nTotal26 = 0;
        nTotal27 = 0; nTotal28 = 0;
        nTotal29 = 0; nTotal30 = 0;
        nTotal31 = 0; nTotal32 = 0;
        nTotal33 = 0; nTotal34 = 0;

        nHActividad = #0#38;
        |PARA nPara1 = #0#38; |SI nPara1 [ #0#39; |HACIENDO nPara1 = nPara1 + 1;
              enActividad = nPara1;
              |HAZ LeeDatosEmpresa;
              |SI  swNoExis = 0;       ||SI existe esta Actividad.
                   |SI nActividad = 0; nActividad = enActividad; |FINSI;
                    nQueBusco = 0;
                    |SI aQueBusco = "PLANILLAS";  nQueBusco = 1; |FINSI;
                    aElDepar = enActividad; |QBF aElDepar;
                    aElDepar = ("00" + aElDepar) % -102;

                    |HAZ PonACero;
                    SwHayDatos = 0;
                    |SI nQueBusco = 0; |Y dirfich0 = "";
                        || ... no existe contabilidad
                    |SINO;
                        |SI nQueBusco = 1;
                            |HAZ EspecialPlanillas;
                        |FINSI;
                        nExiFin = 0;
                        |ABRE #dsmom060;
                        |ABRE #dsmom160;
                        |ABRE #901;
                        |BUCLE dsmom061;
                        |CIERRA #901;
                        |CIERRA #dsmom160;
                        |CIERRA #dsmom060;
                    |FINSI;

                    |SI SwHayDatos = 1;
                         nHActividad = nPara1;
                         |BUCLE SumoTotal2000;
                         |HAZ Sumo2000;
                    |FINSI;
              |FINSI;
        |SIGUE;
    |FINSI;

||///////////////////

    |PARA nPara1 = nDActividad; |SI nPara1 [ nHActividad; |HACIENDO nPara1 = nPara1 + 1;
          enActividad = nPara1;
          |HAZ LeeDatosEmpresa;
          |SI  swNoExis = 0;       ||SI existe esta Actividad.
              |SI nActividad = 0; nActividad = enActividad; |FINSI;
              nQueBusco = 0;
              |SI aQueBusco = "PLANILLAS";  nQueBusco = 1; |FINSI;
              aElDepar = enActividad; |QBF aElDepar;
              aElDepar = ("00" + aElDepar) % -102;

              eaCodRenta = "";
              nOpTitular = 0;
              |SI #0#55 = "S"; aElDni = #900#1; |HAZ LaRentaSI;  |FINSI;
              nOpTitular = 1;
              eaCodR2 = "";

              |HAZ PonACero;
              SwHayDatos = 0;
              |SI nQueBusco = 0; |Y dirfich0 = "";
                  || ... no existe contabilidad
              |SINO;
                  |SI nQueBusco = 1;
                      |HAZ EspecialPlanillas;
                  |FINSI;
                  nExiFin = 0;

                  |ABRE #dsmom060;
                  |ABRE #dsmom160;
                  |ABRE #901;
                  |BUCLE dsmom061;
                  |CIERRA #901;
                  |CIERRA #dsmom160;
                  |CIERRA #dsmom060;

              |FINSI;

              |SI SwHayDatos = 1;
                  nSwPago = 0;
                  |SI #0#40 = "E"; |HAZ ImpAuxiliarE; |FINSI;
                  |SI #0#40 = "R"; |HAZ ImpAuxiliarR; |FINSI;
                  nSwPago = 0;
              |FINSI;
         |FINSI;
   |SIGUE;

   |HAZ LosPagos;
   |SI nError = 0;
      |FININF;
   |SINO;
     |ERROR10;
   |FINSI;

   |SI enSwPartido = 1;
       enSwOpPar   = 1;
       |HAZ FinalPartido;
   |FINSI;
|FPRC;

|DEFBUCLE dsmow043;
  #dsmow043#1;
  16;
  000001, "S";
  999999, "S";
  ;
  NULL, Emision;
|FIN;

|PROCESO Imprimir;

    eaDDepar  = #0#38; |QBF eaDDepar;
    eaDDepar  = ("00" + eaDDepar) % -102;
    eaHDepar  = #0#39; |QBF eaHDepar;
    eaHDepar  = ("00" + eaHDepar) % -102;

    efDFecha  = #0#47;
    efHFecha  = #0#48;
    nDPeriodo = 01;
    nHPeriodo = 99;
    |SI #0#51 = "S";
        nDPeriodo = #0#49;
        nHPeriodo = #0#50;
    |FINSI;

    aAlfa1 = enEjer;
    aAlfa2 = "01.01." + aAlfa1; fFechaIni = aAlfa2;
    aAlfa3 = "31.12." + aAlfa1; fFechaFin = aAlfa3;
    aAlfa2 = "31.03." + aAlfa1; fecha1    = aAlfa2;
    aAlfa2 = "30.06." + aAlfa1; fecha2    = aAlfa2;
    aAlfa2 = "30.09." + aAlfa1; fecha3    = aAlfa2;

    |SI enSwMvo = 0;
        |IMPRE 0;
        |SI FSalida ! 0;  |ACABA;  |FINSI;
    |FINSI;

    |BUCLE dsmow043;

    |SI enSwMvo = 0;
        |FINIMP;
    |FINSI;
|FPRC;

|PROCESO LeeDatosEmpresa;
  |DELINDEX #901;

  |DDEFECTO #900;

  #900#0 = enEmpresa;
  nPin1 = 0;
  aPin1 = "";
  efPn10 = "01.01.0000";
  efPn11 = "01.01.0000";

  || Lee Primera Actividad
    |ABRE #agicen14;
    #agicen14#0 = #900#0; || Empresa
    #agicen14#1 = 00;
    |LEE 041#agicen14.];
    |SI FSalida = 0; |Y #agicen14#0 = #900#0;
        |HAZ LeoAgicen30;
        #900#5 = #agicen14#9;
        #900#6 = #agicen14#10;
        #900#7 = #agicen14#7;
        #900#8 = #agicen14#8;
        efPn10 = #agicen14#5;
        efPn11 = #agicen14#6;
        aCoBien = #agicen14#13;  ||Comunidad de Bienes
    |FINSI;

  || Lee Actividad en concreto.
    swNoExis = 0;
    #agicen14#0 = #900#0; || Empresa
    #agicen14#1 = enActividad;
    |LEE 041#agicen14.=;
    |SI FSalida = 0;
        |HAZ LeoAgicen30;
        #900#5 = #agicen14#9;
        #900#6 = #agicen14#10;
        #900#7 = #agicen14#7;
        #900#8 = #agicen14#8;
        #900#15 = #agicen14#1;   ||Act.
        #900#16 = #agicen14#2;   ||Tipo Epig.
        #900#17 = #agicen14#3;   ||Epigrafe
        #900#18 = #agicen14#4;   ||Descripcion Actividad
        #900#19 = #agicen14#5;   ||Fecha Inicio
        #900#20 = #agicen14#6;   ||Fecha Fin
        #900#21 = #agicen14#11;  ||Sector actividad
        #900#22 = #agicen14#12;  ||Sector actividad
        #900#23 = #agicen14#16;  ||Tipo Actividad
        #900#24 = #agicen14#17;  ||Descripcion Tipo Actividad
        #900#51 = #agicen14#20;  ||CNAE
        aCoBien = #agicen14#13;  ||Comunidad de Bienes
        enCodRen = #agicen14#18;
        |SI enEjerR ! 0; |HAZ CodigoRen; |FINSI;
        #900#52 = enCodRen;      ||Codigo de Renta
        |SI #agicen14#6 > "01.01.0000"; |Y #agicen14#6 < efDFecha;
            |SI #0#24 = "N";
                |CIERRA #agicen14;
                swNoExis = 1;
                |ACABA;
            |FINSI;
        |FINSI;
        nTTribut  = #agicen14#9;
        |SI #0#66 = "N";
            |SI nTTribut = 1; |O nTTribut = 18; |O nTTribut = 19;
                |CIERRA #agicen14;
                swNoExis = 1;
                |ACABA;
            |FINSI;
        |FINSI;
        aQueBusco = #agicen14#15; |QBF aQueBusco;
        |SI aQueBusco = "MANUAL";
            aQueBusco = "REGISTROS";
            nDPlani = 0;
            |BUCLE LeoDsmom009;
            |SI nDPlani = 1; aQueBusco = "PLANILLAS"; |FINSI;
        |FINSI;
    |SINO;
        |CIERRA #agicen14;
        swNoExis = 1;
        |ACABA;
    |FINSI;
    |CIERRA #agicen14;

 || Lee Ficha Sociedades
    swExiste = 0;
    |ABRE #agim0019;
    #agim0019#0 = #900#0; || Empresa
    #agim0019#1 = 99;
    |LEE 041#agim0019.];
    |SI FSalida = 0;
        |LEE 041#agim0019.a;
    |SINO;
        |LEE 041#agim0019.u;
    |FINSI;
    |SI FSalida = 0; |Y #agim0019#0 = #900#0;
        swExiste = 1;
    |FINSI;
    |SI swExiste = 1;
        efPn10 = #agim0019#7;      || Fecha Activa
        efPn11 = #agim0019#55;     || Fecha Inactiva
        nPin1 = #agim0019#4;
        aPin1 = #agim0019#5;
    |FINSI;
    |CIERRA #agim0019;

    |ABRE #agifigen;
    #agifigen#0 = #900#0; || Empresa
    |LEE 041#agifigen.=;
    |SI FSalida = 0;
        efPn10  = #agifigen#93;
        efPn11  = #agifigen#94;
        nPin1   = #agifigen#87;
        aPin1   = #agifigen#88;
        #900#1 = #agifigen#13;  || Nif
        #900#2 = #agifigen#1;   || Nombre
    |FINSI;
    |CIERRA #agifigen;
    |SI efPn10 [ "01.01.1900"; efPn10 = "01.01.0000"; |FINSI;
    |SI efPn11 [ "01.01.1900"; efPn11 = "01.01.0000"; |FINSI;
    #900#3 = nPin1;
    #900#4 = aPin1;
    #900#9 = efPn10;
    #900#10 = efPn11;

    #900#11 = "ACTIVA";
    |SI #999#12 = "N"; #900#11 = "INACTIVA"; |FINSI;
    #900#12 = #0#1;                                   || Ejercicio
    #900#13 = efDFecha;
    #900#14 = efHFecha;

    #900#50 = #0#45; ||Titulo del Libro
|FPRC;

|PROCESO LaRentaSI;
     eaCodR2    = "";
     eaCodRenta = "";
     |SI nOpTitular = 0;
         |SI #900#52 ! 0;
             eaCodRenta = "Codigo de Renta : " + (("00000" + #900#52) % -105);
             |ACABA;
         |FINSI;
     |FINSI;

     |ABRE #103;
     |SELECT #2#103;
     #103#1 = aElDni;
     |LEE 040#103=;
     |SI FSalida = 0;
         eaCodRenta = "Codigo de Renta : " + (("00000" + #103#0) % -105);
         eaCodR2    = (("00000" + #103#0) % -105);
     |SINO;
         |SELECT #3#103;
         #103#35 = aElDni;
         |LEE 040#103=;
         |SI FSalida = 0;
             eaCodRenta = "Codigo de Renta : " + (("00000" + #103#0) % -105);
             eaCodR2    = (("00000" + #103#0) % -105);
         |FINSI;
     |FINSI;
     |CIERRA #103;
|FPRC;

|PROGRAMA;
 eaPlanilla = "dsmom060";  |HAZ PlanDePlanillas;

 |SI enSwMvo = 1;
     enEmpresa = enEmprM;
     enEjer    = enEjerM;
 |FINSI;

 |SI enEmpresa ! 0; |Y PARAMETRO ! "conta";
     |DDEFECTO #0;
     #0#1 = enEjer;
     #0#2 = enEmpresa;
     #0#3 = enEmpresa;

     #0#38 = enDActM;
     #0#39 = enHActM;
     #0#43 = "S";
     #0#47 = efDFecM;
     #0#48 = efHFecM;
     |SI PARAMETRO = "Planillas";
         aAlfa1 = "01.01." + enEjer; #0#47 = aAlfa1;
         aAlfa1 = "31.12." + enEjer; #0#48 = aAlfa1;
         #0#49 = enPeriodo;
         #0#50 = enPeriodo;
         #0#38 = enActividad;
         #0#39 = enActividad;
         #0#64 = "S";
         #0#65 = "S";
     |FINSI;
     |SI enNuMvo = 2; #0#51 = "S"; |FINSI;
     |HAZ Tipo3;
 |SINO;
     |CLS;
     |MANTE #0;
 |FINSI;
|FPRO;
