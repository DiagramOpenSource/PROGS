|FICHEROS;
   dsmoy076 #0;

   dsmom002 #2;
   dsmom004 #4;
   dsmom008 #8;

   dsmo3401 #341;
   dsmo3402 #342;
   dsmo3403 #343;
   dsmo3404 #344;
   dsmo3405 #345;

   dsmow584 #584;

   &clientes@ #715;

   :/basica/def/agicen14 #114;
   :/basica/def/agifigen #118;

   dsmow030 #900;
   dsmoy000 #100;
   dsmow014 #999;
|FIN;

|VARIABLES;
   aParam      = "";
   informe     = "";
   nCampo      = 0;
   nDEmpresa   = 0;
   nHEmpresa   = 0;
   fFecha      = @;
   nAnyo       = 0;
   nMes        = 0;

   aAlfa  = "";
   aAlfa1 = "";
   aAlfa2 = "";
   aAlfa3 = "";
   nPara1 = 0;
   nPara2 = 0;
   nNume1 = 0;
   nNume2 = 0;
   nNume3 = 0;
   nNume4 = 0;
   &eaAlfa = "";
   &enLinea = 0;

   nSPin1      = 0;
   nSwHay      = 0;
   nPrint      = 0;
   nSwPrint    = 0;
   nSw         = 0;
   nModelo       = 0;
   nEmpresa      = 0;
   nEjer         = 0;
   nActividad    = 0;
   aActividad    = "";
   nPeriodo      = 0;
   nComplem      = 0;
   &enDActividad = 0;
   &enHActividad = 0;
   nDPeriodo     = 0;
   nHPeriodo     = 0;

   &nSwLinea     = 0;
   &nSwLinD      = 0;
   &eaDesTipo    = "";
   &eaTitulo     = "";
   &eaTitCab     = "";
   aFichero      = "";
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varlib;

|| //////////////////// Calculos de Pantalla \\\\\\\\\\\\\\\\\\\\\\\\\\
|CALCULO Eano; |TIPO 7;
     fFecha = ~;
     aAlfa  = fFecha % 402;   nMes  = aAlfa;
     aAlfa  = fFecha % -104;  nAnyo = aAlfa;

     |SI nMes [ 3;
         #0#47 = 12;
         #0#1 = nAnyo - 1;
         |HAZ Periodo;
         |PINTA #0#1;
         |PINTA #0#47;
         |ACABA;
     |FINSI;

     |SI nMes [ 6;
         #0#47 = 3;
         #0#1 = nAnyo;
         |HAZ Periodo;
         |PINTA #0#1;
         |PINTA #0#47;
         |ACABA;
     |FINSI;

     |SI nMes [ 9;
         #0#47 = 6;
         #0#1 = nAnyo;
         |HAZ Periodo;
         |PINTA #0#1;
         |PINTA #0#47;
         |ACABA;
     |FINSI;

     |SI nMes [ 12;
         #0#47 = 9;
         #0#1 = nAnyo;
         |HAZ Periodo;
         |PINTA #0#1;
         |PINTA #0#47;
         |ACABA;
    |FINSI;
|FCAL;

|PROCESO Periodo;
     #0#48 = "          ";
     |SI #0#47 = 1;   #0#48 = "ENERO     ";  |FINSI;
     |SI #0#47 = 2;   #0#48 = "FEBRERO   ";  |FINSI;
     |SI #0#47 = 3;   #0#48 = "MARZO     ";  |FINSI;
     |SI #0#47 = 4;   #0#48 = "ABRIL     ";  |FINSI;
     |SI #0#47 = 5;   #0#48 = "MAYO      ";  |FINSI;
     |SI #0#47 = 6;   #0#48 = "JUNIO     ";  |FINSI;
     |SI #0#47 = 7;   #0#48 = "JULIO     ";  |FINSI;
     |SI #0#47 = 8;   #0#48 = "AGOSTO    ";  |FINSI;
     |SI #0#47 = 9;   #0#48 = "SEPTIEMBRE";  |FINSI;
     |SI #0#47 = 10;  #0#48 = "OCTUBRE   ";  |FINSI;
     |SI #0#47 = 11;  #0#48 = "NOVIEMBRE ";  |FINSI;
     |SI #0#47 = 12;  #0#48 = "DICIEMBRE ";  |FINSI;
     |SI #0#47 = 99;  #0#48 = "ANUAL     ";  |FINSI;

     |SI #0#48 = "          "; |Y aParam = "";
         |MENAV "     Periodo Incorrecto.";
         |ERROR;
     |FINSI;

     |PINTA #0#48;
|FPRC;

|CALCULO Tipo7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#2  = enEmpresa;  |PINTA #0#2;
         #0#3  = enEmpresa;  |PINTA #0#3;

         |C_M #0#2, 1, "N";
         |C_M #0#3, 1, "N";
     |FINSI;
|FCAL;

|CALCULO Parrilla; |TIPO 0;
     |SI #0#2 = 0;
         #0#2 = 0;  |PINTA #0#2;
         #0#3 = 0;  |PINTA #0#3;  |C_M #0#3, 1, "N";
         |PARA nCampo = 4;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#2, 1, "S";
             |C_M #0#3, 1, "S";
         |FINSI;

         |PARA nCampo = 4;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO NoMasEmpresas; |TIPO 0;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO YaSeCual; |TIPO 7;
     |SI enEmpresa ! 0;
         #0#41 = "S"; |PINTA #0#41;
         #0#24 = "S"; |PINTA #0#24;
         #0#25 = 00;  |PINTA #0#25;
         #0#26 = 99;  |PINTA #0#26;
         |C_M #0#24, 1, "N";
         |C_M #0#25, 1, "N";
         |C_M #0#26, 1, "N";
         |C_M #0#41, 1, "N";
     |FINSI;
|FCAL;

|CALCULO SelTipo0; |TIPO 0;
     |SI #0#41 = "N";
         #0#25 = 0;  |PINTA #0#25;  |C_M #0#25, 1, "N";
         #0#26 = 99; |PINTA #0#26;  |C_M #0#26, 1, "N";
         |PARA nCampo = 27;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#25, 1, "S";
             |C_M #0#26, 1, "S";
         |FINSI;
         |PARA nCampo = 27;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO SelTipo1;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|| *************************************************************************
|| /////////////////
|PROCESO ElPeriodo;
     #4#0  = nEmpresa;
     #4#1  = nEjer;
     #4#2  = nPeriodo;
     #4#3  = nModelo;
     #4#4  = 99;
     |SI aParam ! "";
         #4#4 = enComplem;
         |LEE 040#4=;
     |SINO;
         |LEE 040#4];
         |SI FSalida = 0;
             |LEE 040#4a;
         |SINO;
             |LEE 040#4u;
         |FINSI;
     |FINSI;
     |SI FSalida = 0; |Y #4#0 = nEmpresa; |Y #4#1 = nEjer;
          |Y #4#2 = nPeriodo; |Y #4#3 = nModelo;
             nComplem = #4#4;
     |FINSI;

     |SI nComplem ! -1;
         nDPeriodo = nPeriodo;
         nHPeriodo = nPeriodo;

         |SI #4#22 = "M";
             nDPeriodo = nPeriodo;
             nHPeriodo = nPeriodo;
         |FINSI;
         |SI #4#22 = "T";
             |SI nPeriodo = 1;   nDPeriodo = 1;  nHPeriodo = 3;  |FINSI;
             |SI nPeriodo = 2;   nDPeriodo = 1;  nHPeriodo = 3;  |FINSI;
             |SI nPeriodo = 3;   nDPeriodo = 1;  nHPeriodo = 3;  |FINSI;
             |SI nPeriodo = 4;   nDPeriodo = 4;  nHPeriodo = 6;  |FINSI;
             |SI nPeriodo = 5;   nDPeriodo = 4;  nHPeriodo = 6;  |FINSI;
             |SI nPeriodo = 6;   nDPeriodo = 4;  nHPeriodo = 6;  |FINSI;
             |SI nPeriodo = 7;   nDPeriodo = 7;  nHPeriodo = 9;  |FINSI;
             |SI nPeriodo = 8;   nDPeriodo = 7;  nHPeriodo = 9;  |FINSI;
             |SI nPeriodo = 9;   nDPeriodo = 7;  nHPeriodo = 9;  |FINSI;
             |SI nPeriodo = 10;  nDPeriodo = 10; nHPeriodo = 12; |FINSI;
             |SI nPeriodo = 11;  nDPeriodo = 10; nHPeriodo = 12; |FINSI;
             |SI nPeriodo = 12;  nDPeriodo = 10; nHPeriodo = 12; |FINSI;
         |FINSI;

         aAlfa1 = nEjer;
         aAlfa2 = nDPeriodo; aAlfa2 = ("00" + aAlfa2) % -102;
         aAlfa3 = "01." + aAlfa2 + "." + aAlfa1; efDFecha = aAlfa3;

         aAlfa2 = nHPeriodo; aAlfa2 = ("00" + aAlfa2) % -102;
         aAlfa3 = "31.";
         |SI nHPeriodo = 4; |O nHPeriodo = 6; |O nHPeriodo = 9; |O nHPeriodo = 11;
             aAlfa3 = "30.";
         |FINSI;
         |SI nHPeriodo = 2;
             aAlfa3 = "28.";
             nNume1 = nEjer / 4; nNume2 = (nEjer / 4) ! 0;
             |SI nNume1 = nNume2; aAlfa3 = "29."; |FINSI;
         |FINSI;
         aAlfa3 = aAlfa3 + aAlfa2 + "." + aAlfa1; efHFecha = aAlfa3;

     |FINSI;
|FPRC;

|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
|PROCESO Registro341;
     enCodCli = #341#0;
     |HAZ LeePersona;

     |DDEFECTO #584;

     #584#1  = "1";
     #584#2  = "340";
     #584#3  = #341#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #584#4   = eaVarDni;

         eaAlfa   = #715#1;  |HAZ QuitaRaros;
         #584#5   = eaAlfa;

         eaAlfa   = #715#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #715#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #584#7   = eaAlfa;

         eaAlfa   = #715#53;  |HAZ QuitaRaros;
         #584#8   = eaAlfa;
     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #584#4   = eaVarDni;

         eaAlfa   = #715#1;   |HAZ QuitaRaros;
         #584#5   = eaAlfa;

         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;
         #584#7   = eaAlfa;

         eaAlfa   = #715#96;  |HAZ QuitaRaros;
         #584#8   = eaAlfa;
     |FINSI;

     #584#6  = "T";
     #584#12 = "0000000000000";

     |SI #4#24 = "C";
         #584#10 = "C";
         #584#12 = #4#21;
     |FINSI;

     |SI #4#24 = "S";
         #584#11 = "S";
         #584#12 = #4#21;
     |FINSI;

     |SI #4#22 = "T";
         |SI #341#2 = 3;   #584#13 = "1T";  |FINSI;
         |SI #341#2 = 6;   #584#13 = "2T";  |FINSI;
         |SI #341#2 = 9;   #584#13 = "3T";  |FINSI;
         |SI #341#2 = 12;  #584#13 = "4T";  |FINSI;
     |SINO;
         #584#13 = ("00" + #341#2) % -102;
     |FINSI;

     #584#9  = "340" + #584#3 + (("00" + #341#2) % -102) + (("0000" + #341#4) % -104);

     #341#6 = 0;
     #341#7 = 0;
     #341#8 = 0;
     #341#9 = 0;
|FPRC;

|PROCESO Registro340;
     |PRINT;
     nSwLinea = 1;
     nSwPrint = 1;
     nPrint   = 1;
     nSw      = 1;

     #341#6 = #341#6 + 1;
     |SI eaDesTipo = "2";
         #341#7 = #341#7 + #342#17;
         #341#8 = #341#8 + #342#18;
         #341#9 = #341#9 + #342#19;
         #900#34 = #900#34 + 1;
     |FINSI;
     |SI eaDesTipo = "3";
         #341#7 = #341#7 + #343#17;
         #341#8 = #341#8 + #343#18;
         #341#9 = #341#9 + #343#19;
         #900#35 = #900#35 + 1;
     |FINSI;
     |SI eaDesTipo = "4";
         #341#7 = #341#7 + #344#17;
         #341#8 = #341#8 + #344#18;
         #341#9 = #341#9 + #344#19;
         #900#36 = #900#36 + 1;
     |FINSI;
     |SI eaDesTipo = "5";
         #341#7 = #341#7 + #345#17;
         #341#8 = #341#8 + #345#18;
         #341#9 = #341#9 + #345#19;
         #900#37 = #900#37 + 1;
     |FINSI;
|FPRC;


|DEFBUCLE dsmo3402_C1;
     #342#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#37, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#38, 999999;
     ;
     NULL, Registro340;
|FIN;

|DEFBUCLE dsmo3402_C2;
     #342#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#37, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#38, 999999;
     ;
     NULL,NULL,NULL,NULL,NULL, Registro340;
     #342#0, #342#1, #342#2, #342#3, #342#4, #342#7, #342#5, #342#6;
|FIN;

|DEFBUCLE dsmo3402_C3;
     #342#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#37, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#38, 999999;
     ;
     NULL,NULL,NULL,NULL,NULL, Registro340;
     #342#0, #342#1, #342#2, #342#3, #342#4, #342#9, #342#5, #342#6;
|FIN;


|DEFBUCLE dsmo3403_C1;
     #343#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#37, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#38, 999999;
     ;
     NULL, Registro340;
|FIN;

|DEFBUCLE dsmo3403_C2;
     #343#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#37, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#38, 999999;
     ;
     NULL,NULL,NULL,NULL,NULL,Registro340;
     #343#0, #343#1, #343#2, #343#3, #343#4, #343#7, #343#5, #343#6;
|FIN;

|DEFBUCLE dsmo3403_C3;
     #343#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#37, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#38, 999999;
     ;
     NULL,NULL,NULL,NULL,NULL,Registro340;
     #343#0, #343#1, #343#2, #343#3, #343#4, #343#9, #343#5, #343#6;
|FIN;

|DEFBUCLE dsmo3404_C1;
     #344#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#37, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#38, 999999;
     ;
     NULL, Registro340;
|FIN;

|DEFBUCLE dsmo3404_C2;
     #344#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#37, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#38, 999999;
     ;
     NULL,NULL,NULL,NULL,NULL,Registro340;
     #344#0, #344#1, #344#2, #344#3, #344#4, #344#7, #344#5, #344#6;
|FIN;

|DEFBUCLE dsmo3404_C3;
     #344#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#37, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#38, 999999;
     ;
     NULL,NULL,NULL,NULL,NULL,Registro340;
     #344#0, #344#1, #344#2, #344#3, #344#4, #344#9, #344#5, #344#6;
|FIN;

|DEFBUCLE dsmo3405_C1;
     #345#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#37, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#38, 999999;
     ;
     NULL, Registro340;
|FIN;

|DEFBUCLE dsmo3405_C2;
     #345#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#37, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#38, 999999;
     ;
     NULL,NULL,NULL,NULL,NULL,Registro340;
     #345#0, #345#1, #345#2, #345#3, #345#4, #345#7, #345#5, #345#6;
|FIN;

|DEFBUCLE dsmo3405_C3;
     #345#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#37, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, #0#38, 999999;
     ;
     NULL,NULL,NULL,NULL,NULL,Registro340;
     #345#0, #345#1, #345#2, #345#3, #345#4, #345#9, #345#5, #345#6;
|FIN;

|PROCESO LEmpresa;
  nEmpresa = #agifigen#0;
  nComplem = -1;

  |DDEFECTO #900;
  #900#0  = nEmpresa;
  #900#2  = #agifigen#1;
  #900#11 = "ACTIVA";
  |SI #agifigen#94 > "01.01.0000";
      #900#11 = "INACTIVA";
      |SI #0#24 = "N"; |ACABA; |FINSI;
  |FINSI;

|| ... Seleccion de Tipo de Empresa
  nSPin1 = #agifigen#87;
  enSwSelEmp = 1;
  |SI #0#41 = "S";
      |SI nSPin1 ] #0#25; |Y nSPin1 [ #0#26;
          enSwSelEmp = 0;
      |FINSI;
  |SINO;
      |SI nSPin1 = #0#27;
          enSwSelEmp = 0;
      |SINO;
          |PARA nCampo = 28;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
                |SI nSPin1 = #0nCampo; |Y nSPin1 ! 0;
                    enSwSelEmp = 0;
                    |SAL;
                |FINSI;
          |SIGUE;
      |FINSI;
  |FINSI;
  |SI enSwSelEmp = 1; |ACABA; |FINSI;

|| ------------------------------------------------------------------------
  || Lee Periodicidad Modelo 340
   |HAZ ElPeriodo;
   |SI nComplem = -1; |ACABA; |FINSI;
|| ------------------------------------------------------------------------

     #341#0  = #4#0;
     #341#1  = #4#1;
     #341#2  = #4#2;
     #341#3  = #4#3;
     #341#4  = #4#4;
     #341#5  = 0;
     |LEE 041#341=;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     enEmpresa   = #agifigen#0;
     enActividad = 0;
     |SI #0#37 = #0#38; enActividad = #0#37; |FINSI;
     enEjer      = #0#1;
     |HAZ DatosEmpr_w30;
     |HAZ Registro341;

     nSwPrint = 0;
     |SI #0#43 = "S";
         eaDesTipo = "2";
         eaTitulo  = "FACTURAS EXPEDIDAS";
         eaTitCab  = "Cuota Recargo";
         nSwLinea = 0; nSw = 0;
         |SI #0#39 = 1; |BUCLE dsmo3402_C1; |FINSI;
         |SI #0#39 = 2; |BUCLE dsmo3402_C2; |FINSI;
         |SI #0#39 = 3; |BUCLE dsmo3402_C3; |FINSI;
         |SI nSw = 1;
             |SI #0#50 = "S";
                 |PIEINF;
             |SINO;
                 nSwLinea = 9; |PRINT;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #0#44 = "S";
         eaDesTipo = "3";
         eaTitulo  = "FACTURAS RECIBIDAS";
         eaTitCab  = "IVA Deducible";
         nSwLinea = 0; nSw = 0;
         |SI #0#39 = 1; |BUCLE dsmo3403_C1; |FINSI;
         |SI #0#39 = 2; |BUCLE dsmo3403_C2; |FINSI;
         |SI #0#39 = 3; |BUCLE dsmo3403_C3; |FINSI;
         |SI nSw = 1;
             |SI #0#50 = "S";
                 |PIEINF;
             |SINO;
                 nSwLinea = 9; |PRINT;
             |FINSI;
         |FINSI;
     |FINSI;
     |SI #0#45 = "S";
         eaDesTipo = "4";
         eaTitulo  = "BIENES DE INVERSION";
         eaTitCab  = "";
         nSwLinea = 0; nSw = 0;
         |SI #0#39 = 1; |BUCLE dsmo3404_C1; |FINSI;
         |SI #0#39 = 2; |BUCLE dsmo3404_C2; |FINSI;
         |SI #0#39 = 3; |BUCLE dsmo3404_C3; |FINSI;
         |SI nSw = 1;
             |SI #0#50 = "S";
                 |PIEINF;
             |SINO;
                 nSwLinea = 9; |PRINT;
             |FINSI;
         |FINSI;
     |FINSI;
     |SI #0#46 = "S";
         eaDesTipo = "5";
         eaTitulo  = "DETERMINADAS OPERACIONES INTRACOMUNITARIAS";
         eaTitCab  = "";
         nSwLinea = 0; nSw = 0;
         |SI #0#39 = 1; |BUCLE dsmo3405_C1; |FINSI;
         |SI #0#39 = 2; |BUCLE dsmo3405_C2; |FINSI;
         |SI #0#39 = 3; |BUCLE dsmo3405_C3; |FINSI;
         |SI nSw = 1;
             |SI #0#50 = "S";
                 |PIEINF;
             |SINO;
                 nSwLinea = 9; |PRINT;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSwPrint = 1;
         |SI #0#50 = "N";
             |PIEINF;
         |SINO;
             |FININF;

             |INFOR "dsmoyc76";
             |PRINT;
             |PIEINF;
             |FININF;

             |INFOR informe;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agifigen;
     #agifigen#1;
     ;
     nDEmpresa;
     nHEmpresa;
     e;
     NULL, LEmpresa;
|FIN;

|PROCESO QueHacemos340;
    |DDEFECTO #118;
    #118#0 = #999#0;
    |LEE 041#118=;
    |SI FSalida = 0;
        |HAZ LEmpresa;
    |FINSI;
|FPRC;

|DEFBUCLE dsmow014C;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos340;
|FIN;

|DEFBUCLE dsmow014N;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos340;
|FIN;
|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
|CALCULO Tipo3;  |TIPO 3;

    eaInac = #0#24;

    nEjer     = #0#1;
    nPeriodo  = #0#47;
    nModelo   = #0#49;
    eaTituloL = #0#40; ||Titulo del Libro

    |MENAV "0000 Recuerde seleccionar el papel de la impresora en Horizontal";

    nPrint = 0;
    |IMPRE 0;
    |SI FSalida ! 0;
        |MENAV "    Proceso interrumpido";
        |ACABA;
    |FINSI;

    informe = "dsmoy076";
    |SI #0#50 = "N"; informe = "dsmoyn76"; |FINSI;
    |INFOR informe;
    |SI FSalida ! 0;
        |MENAV "    Error en el Informe ";
        |ACABA;
    |FINSI;

    |ABRE #4;
    |ABRE #341;
    |SI aParam ! "Todos";
        |SI #0#2 ! 0;
            nDEmpresa = #0#2;
            nHEmpresa = #0#3;
            |BUCLE agifigen;
        |SINO;
            |PARA nPara1 = 4;  |SI nPara1 [ 23;  |HACIENDO nPara1 = nPara1 + 1;
                  |SI #0nPara1 ! 0;
                      nDEmpresa = #0nPara1;
                      nHEmpresa = #0nPara1;
                      |BUCLE agifigen;
                  |FINSI;
            |SIGUE;
        |FINSI;
    |SINO;
        |ABRE #118;
        |SI #100#8 = "C";
            |BUCLE dsmow014C;
        |SINO;
            |BUCLE dsmow014N;
        |FINSI;
        |CIERRA #118;
    |FINSI;

    |CIERRA #341;
    |CIERRA #4;

    |SI nPrint = 0; |Y aParam = "";
        |MENAV "     Seleccion Vacia.";
    |FINSI;
    |FININF;
    |FINIMP;
|FCAL;

|PROGRAMA;

     aParam = PARAMETRO; |QBF aParam;

     |ABRE #0;
     |LEE 001#0p;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         fFecha = ~;
         aAlfa1 = fFecha; aAlfa1 = aAlfa1 % -104;
         #0#1 = aAlfa1;

         |GRABA 020#0c;
     |FINSI;

     |SI aParam = "";
         |CLS;
         |CABEZA "Inf.Chequeo Modelo 340";
         |PINPA #0#0;
         |PINDA #0#0;

         |ENDATOS #1#0;

         |GRABA 020#0a;
         |CIERRA #0;
    |SINO;
         |CIERRA #0;
         |DDEFECTO #0;

         |SI aParam ! "Todos";
             #0#1  = enEjer;
             #0#2  = enEmpresa;
             #0#3  = enEmpresa;
             #0#37 = enDActividad;
             #0#38 = enHActividad;
             #0#47 = enPeriodo; |HAZ Periodo;
             |SI aParam ! "0";
                 |SI aParam ! "1"; #0#43 = "N"; |FINSI;
                 |SI aParam ! "2"; #0#44 = "N"; |FINSI;
                 |SI aParam ! "3"; #0#45 = "N"; |FINSI;
                 |SI aParam ! "4"; #0#46 = "N"; |FINSI;
             |FINSI;
         |SINO;
             aFichero = ("000" + Usuario) % 108;
             |NOME_DAT #100 aFichero;

             aFichero = ("imp" + Usuario) % 108;
             |NOME_DAT #999 aFichero;

             |ABRE #100;
             |LEE 000#100p;
             |CIERRA #100;
             #0#01 = #100#6;
             #0#47 = #100#4;
             #0#48 = #100#5;
         |FINSI;

         |HAZ Tipo3;
    |FINSI;
|FPRO;
