|FICHEROS;
     dsm190ca #190;

     dsmoy024;
     dsmom004;
     dsmom026;
     dsm190li;
     dsm19001;

     :/basica/def/agifigen;
     :/basica/def/agidanif;

     :/laboral/def/labtraba;
     :/laboral/def/nomhicca;
     :/laboral/def/nomhiatr;

     dsmow072,MANTE;
     dsmow073;

     espejo1@;
|FIN;

|VARIABLES;
     nCampo            = 0;
     nHandle           = 0;
     nEjer             = 0;
     nEmpresa          = 0;
     nDPeriodo         = 0;
     nHPeriodo         = 0;
     nEjerAt           = 0;
     nDComple          = 0;
     nHComple          = 0;
     nComprueba        = 0;
     nSwHay            = 0;
     nTrabajador       = 0;
     nAutonomo         = 0;
     nLinea            = 0;
     nGrupos           = 0;

     aPathLaboral      = "";
     aBase             = "";
     aAlfa             = "";
     aDni              = "";
     aNIF              = "";
     aFichero          = "";

     &EURODB           = 0;

     &eaNif            = "";
     &eaNomNif         = "";
     &enEmpresa        = 0;
     &eaNomEmpresa     = "";
     &enImporte1       = 0;
     &enImporte2       = 0;

     {-1}aMenu         = "";
         aMenu1        = "2400";
         aMenu2        = "2";
         aMenu3        = "Elija opcion : ";
         aMenu4        = "RCA";
         aMenu5        = " Revisar ";
         aMenu6        = " Corregir ";
         aMenu7        = " cAncelar ";

   aPathModelo = "";
   fFecha      = @;
   aDef        = "";
|FIN;

|| /////////////////////// PROCESOS DEL LINEAL  \\\\\\\\\\\\\\\\\\\\

|PROCESO AntesEjer; |TIPO 7;
    fFecha = ~;
    aAlfa = fFecha;
    aAlfa = aAlfa % -104;
    #dsmoy024#0 = aAlfa;
    #dsmoy024#0 = #dsmoy024#0 - 1;
    |PINTA #dsmoy024#0;
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
     |SI FSalida ! 10;  |ACABA;  |FINSI;

     |LEE 101#dsmow072.=;
     |SI #dsmow072#6 = "S";
         #dsmow072#6 = "N";
     |SINO;
         #dsmow072#6 = "S";
     |FINSI;
     |GRABA 020#dsmow072.a;
     |LIBERA #dsmow072;

     |PINTA #dsmow072#6;
|FPRC;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO Corregir;
     |C_M #dsmoy024#17, 1, "S";
     |SI #dsmoy024#16 = "N";
         |C_M #dsmoy024#17, 1, "N";
         #dsmoy024#17 = " ";  |PINTA #dsmoy024#17;
     |SINO;
         #dsmoy024#17 = "S";  |PINTA #dsmoy024#17;
     |FINSI;
|FPRC;

|PROCESO Parrilla;
     |SI #dsmoy024#1 = 0;
         #dsmoy024#1 = 0;  |PINTA #dsmoy024#1;
         #dsmoy024#2 = 0;  |PINTA #dsmoy024#2;  |C_M #dsmoy024#4, 1, "N";
         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy024#nCampo#, 1, "S";
         |SIGUE;
     |SINO;
         |C_M #dsmoy024#1, 1, "S";
         |C_M #dsmoy024#2, 1, "S";

         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy024#nCampo#, 1, "N";
               #dsmoy024#nCampo# = 0;  |PINTA #dsmoy024#nCampo#;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #dsmoy024#Campo# = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               #dsmoy024#nCampo# = 0;  |C_M #dsmoy024#nCampo#, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy024#nCampo#, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\

|PROCESO nomhicca;
     enImporte2 = enImporte2 + (#nomhicca#48 + #nomhicca#49 + #nomhicca#50 + #nomhicca#51);
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     ;
     nEmpresa, nTrabajador, nEjer, 01, 0;
     nEmpresa, nTrabajador, nEjer, 12, 99;
     ;
     NULL, nomhicca;
|FIN;

|DEFBUCLE nomhiccaA;
     #nomhicca#1;
     ;
     #nomhiatr#0, nTrabajador, nEjerAt, 01, #nomhiatr#2;
     #nomhiatr#0, nTrabajador, nEjerAt, 12, #nomhiatr#2;
     ;
     NULL, nomhicca;
|FIN;

|PROCESO nomhiatr;
     |SI #nomhiatr#4 = 0;  |ACABA;  |FINSI;

     aAlfa   = #nomhiatr#3;
     aAlfa   = aAlfa % -102;
     nEjerAt = aAlfa;
     |BUCLE nomhiccaA;
|FPRC;

|DEFBUCLE nomhiatr;
     #nomhiatr#1;
     ;
     nEmpresa, #dsmoy024#0,  5, 0000;
     nEmpresa, #dsmoy024#0, 20, 9999;
     ;
     NULL, nomhiatr;
|FIN;

|PROCESO labtraba;
     nTrabajador = #labtraba#1;
     nAutonomo   = 0;
     |SI #labtraba#42 = "H";  |Y #dsmoy024#15 = "N";
         nAutonomo = 1;
         |ACABA;
     |FINSI;

     |SI #dsm190ca#4 = nDComple;
         |BUCLE nomhicca;

               || se lee todo el historico, incluyendo atrasos sin tener
               || en cuenta los de ejercicios anteriores, en el momento
               || de hacer este programa el 'nomhiatr' era nuevo y estaba
               || vacio (15.04.2003-RPC)
         ||nAtrasos = 1;  |BUCLE nomhiatr;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#5;
     ;
     nEmpresa, aNIF;
     nEmpresa, aNIF;
     ;
     NULL, labtraba;
|FIN;

|PROCESO dsmom026;
     nEmpresa   = #dsmom026#1;
     nGrupos    = 1;

     |BUCLE labtraba;
|FPRC;

|DEFBUCLE dsmom026;
     #dsmom026#1;
     ;
     #dsm190ca#0, 00001;
     #dsm190ca#0, 99999;
     ;
     NULL, dsmom026;
|FIN;

|PROCESO GastosEsp;
     |SI #dsm190li#9 = "02";
         |ABRE #espejo1@;
         |DDEFECTO #espejo1@;
         #espejo1@#0 = #dsm190li#0;
         #espejo1@#1 = #dsm190li#1;
         #espejo1@#2 = #dsm190li#2;
         #espejo1@#3 = #dsm190li#3;
         #espejo1@#4 = #dsm190li#4;
         #espejo1@#5 = #dsm190li#5;
         #espejo1@#6 = #dsm190li#6;
         #espejo1@#8 = #dsm190li#8;
         #espejo1@#9 = "01";
         #espejo1@#10 = #dsm190li#10;
         |LEE 041#espejo1@.=;
         |SI FSalida = 0;
             #dsm190li#22  = 0;
         |FINSI;
         |CIERRA #espejo1@;
     |FINSI;
|FPRC;

|PROCESO dsm190li;
     |SI eaNif ! #dsm190li#6;  |Y eaNif ! "";
         nGrupos    = 0;
         enImporte1 = enImporte1 ! EURODB;
         enImporte2 = enImporte2 ! EURODB;
         |SI enImporte1 ! enImporte2;
             |SI #dsmoy024#16 = "N";
                 |PRINT;
             |SINO;
                 #dsmow072#0 = enEmpresa;
                 #dsmow072#1 = eaNif;
                 #dsmow072#2 = eaNomEmpresa;
                 #dsmow072#3 = eaNomNif;
                 #dsmow072#4 = enImporte1;
                 #dsmow072#5 = enImporte2;
                 #dsmow072#6 = "S";
                 |GRABA 020#dsmow072.n;
             |FINSI;
             nSwHay = 1;
         |FINSI;

         enImporte1 = 0;
         enImporte2 = 0;
     |FINSI;

     nGrupos = 0;

     |ABRE #dsmom026;
     |SELECT #1#dsmom026;
     #dsmom026#0 = #dsm190li#0;
     #dsmom026#1 = 0;
     |LEE 040#dsmom026.];
     |SI FSalida = 0;  |Y  #dsmom026#0 = #dsm190li#0;
         |CIERRA #dsmom026;
         enImporte2 = 0;
         aNIF = #dsm190li#6;
         |BUCLE dsmom026;
     |FINSI;
     |CIERRA #dsmom026;

     |SI nGrupos = 0;
         nAutonomo = 0;
         |BUCLE labtraba;
     |FINSI;

     |SI #dsm190li#8 = "A"; |Y #dsm190li#1 ] 2015;
         |HAZ GastosEsp;
     |FINSI;

     |SI nAutonomo = 0;
         eaNif    = #dsm190li#6;
         eaNomNif = #dsm190li#12;

         enImporte1 = enImporte1 + #dsm190li#22;
     |FINSI;
|FPRC;

|DEFBUCLE dsm190li;
     #dsm190li#3;
     ;
     #dsm190ca#0, #dsm190ca#1, "A", "  ", "            ", #dsm190ca#4;
     #dsm190ca#0, #dsm190ca#1, "A", "02", "zzzzzzzzzzzz", #dsm190ca#4;
     ;
     NULL, dsm190li;
|FIN;

|PROCESO dsm19001;
     |SI eaNif ! #dsm19001#6;  |Y eaNif ! "";
         nGrupos    = 0;
         enImporte1 = enImporte1 ! EURODB;
         enImporte2 = enImporte2 ! EURODB;
         |SI enImporte1 ! enImporte2;
             |SI #dsmoy024#16 = "N";
                 |PRINT;
             |SINO;
                 #dsmow072#0 = enEmpresa;
                 #dsmow072#1 = eaNif;
                 #dsmow072#2 = eaNomEmpresa;
                 #dsmow072#3 = eaNomNif;
                 #dsmow072#4 = enImporte1;
                 #dsmow072#5 = enImporte2;
                 #dsmow072#6 = "S";
                 |GRABA 020#dsmow072.n;
             |FINSI;
             nSwHay = 1;
         |FINSI;

         enImporte1 = 0;
         enImporte2 = 0;
     |FINSI;

     nGrupos = 0;

     |ABRE #dsmom026;
     |SELECT #1#dsmom026;
     #dsmom026#0 = #dsm19001#0;
     #dsmom026#1 = 0;
     |LEE 040#dsmom026.];
     |SI FSalida = 0;  |Y  #dsmom026#0 = #dsm19001#0;
         |CIERRA #dsmom026;
         enImporte2 = 0;
         aNIF = #dsm19001#6;
         |BUCLE dsmom026;
     |FINSI;
     |CIERRA #dsmom026;

     |SI nGrupos = 0;
         nAutonomo = 0;
         |BUCLE labtraba;
     |FINSI;

     |SI nAutonomo = 0;
         eaNif    = #dsm19001#6;
         eaNomNif = #dsm19001#12;

         enImporte1 = enImporte1 + #dsm19001#22;
     |FINSI;
|FPRC;

|DEFBUCLE dsm19001;
     #dsm19001#3;
     ;
     #dsm190ca#0, #dsm190ca#1, "A", "  ", "            ", #dsm190ca#4;
     #dsm190ca#0, #dsm190ca#1, "A", "02", "zzzzzzzzzzzz", #dsm190ca#4;
     ;
     NULL, dsm19001;
|FIN;

|PROCESO dsm190ca;
     |SI nComprueba = 0;
         |SI #dsm190ca#4 ! 0;
             |SI #dsm190ca#10 = "S";
                 nDComple = #dsm190ca#4;
                 nHComple = #dsm190ca#4;
             |SINO;
                 nHComple = #dsm190ca#4;
             |FINSI;
         |SINO;
             nDComple = #dsm190ca#4;
             nHComple = #dsm190ca#4;
         |FINSI;
         |ACABA;
     |FINSI;

     eaNif        = "";
     enImporte1   = 0;
     enImporte2   = 0;
     enEmpresa    = #dsm190ca#0;
     eaNomEmpresa = #agifigen#1;

     |SI #dsmoy024#0 [ 2015;
         |BUCLE dsm190li;
     |FINSI;

     |SI #dsmoy024#0 ] 2016;
         |BUCLE dsm19001;
     |FINSI;

     enImporte1 = enImporte1 ! EURODB;
     enImporte2 = enImporte2 ! EURODB;
     |SI enImporte1 ! enImporte2;
         |SI #dsmoy024#16 = "N";
             |PRINT;
         |SINO;
             #dsmow072#0 = enEmpresa;
             #dsmow072#1 = eaNif;
             #dsmow072#2 = eaNomEmpresa;
             #dsmow072#3 = eaNomNif;
             #dsmow072#4 = enImporte1;
             #dsmow072#5 = enImporte2;
             #dsmow072#6 = "S";
            |GRABA 020#dsmow072.n;
         |FINSI;
         nSwHay = 1;
     |FINSI;

     enImporte1 = 0;
     enImporte2 = 0;
|FPRC;

|DEFBUCLE dsm190ca;
     #dsm190ca#1;
     ;
     #agifigen#0, #dsmoy024#0, 99, 190, nDComple, 00;
     #agifigen#0, #dsmoy024#0, 99, 190, nHComple, 99;
     ;
     NULL, dsm190ca;
|FIN;

|PROCESO agifigen;
     nDComple   = 0;
     nHComple   = 99;
     nEmpresa   = #agifigen#0;
     nComprueba = 0;  |BUCLE dsm190ca;
     nComprueba = 1;  |BUCLE dsm190ca;
|FPRC;

|DEFBUCLE agifigen;
     #agifigen#1;
     ;
     #dsmoy024#1;
     #dsmoy024#2;
     ;
     NULL, agifigen;
|FIN;

|PROCESO dsm190liC;
     #dsm190li#4 = nLinea;
     |GRABA 020#dsm190li.n;
     |LIBERA #dsm190li;
|FPRC;

|DEFBUCLE dsm190liC;
     #dsm190li#1;
     ;
     #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,"            ",0000," ","  ",0;
     #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,"zzzzzzzzzzzz",9999,"z","zz",4;
     be;
     NULL, dsm190liC;
|FIN;

|PROCESO dsm19001C;
     #dsm19001#4 = nLinea;
     |GRABA 020#dsm19001.n;
     |LIBERA #dsm19001;
|FPRC;

|DEFBUCLE dsm19001C;
     #dsm19001#1;
     ;
     #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,"            ",0000," ","  ",0;
     #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,"zzzzzzzzzzzz",9999,"z","zz",4;
     be;
     NULL, dsm19001C;
|FIN;

|PROCESO CreaComplementaria;
     |DDEFECTO #dsmom004;
     #dsmom004#0  = #dsmow072#0;
     #dsmom004#1  = #dsmoy024#0;
     #dsmom004#2  = 99;
     #dsmom004#3  = 190;
     #dsmom004#4  = nLinea;
     #dsmom004#5  = "EMPRESA";
     #dsmom004#7  = "X";
     #dsmom004#8  = ~;
     #dsmom004#9  = " ";
     #dsmom004#10 = "01.01.0000";
     #dsmom004#11 = " ";
     #dsmom004#12 = "01.01.0000";
     #dsmom004#13 = " ";
     #dsmom004#15 = 0;
     #dsmom004#14 = "01.01.0000";
     #dsmom004#17 = "COMPLETADO";
     #dsmom004#18 = 0;

     |GRABA 020#dsmom004.n;
     |LIBERA #dsmom004;

     |SI #dsmoy024#17 = "S";
         #dsm190ca#0 = #dsmom004#0;
         #dsm190ca#1 = #dsmom004#1;
         #dsm190ca#2 = #dsmom004#2;
         #dsm190ca#3 = 190;
         #dsm190ca#4 = nLinea - 1;
         #dsm190ca#5 = 0;
         |LEE 040#dsm190ca.=;

         |SI #dsmoy024#0 [ 2015;
             |BUCLE dsm190liC;
         |FINSI;

         |SI #dsmoy024#0 ] 2016;
             |BUCLE dsm19001C;
         |FINSI;

         #dsm190ca#4  = nLinea;
         #dsm190ca#10 = "S";
         |GRABA 020#dsm190ca.n;
         |LIBERA #dsm190ca;
     |SINO;
         |DDEFECTO #dsm190ca;
         #dsm190ca#0  = #dsmom004#0;
         #dsm190ca#1  = #dsmom004#1;
         #dsm190ca#2  = #dsmom004#2;
         #dsm190ca#3  = 190;
         #dsm190ca#4  = nLinea;
         #dsm190ca#5  = 0;
         #dsm190ca#10 = "C";
         |GRABA 020#dsm190ca.n;
         |LIBERA #dsm190ca;
     |FINSI;

     #dsmow073#0 = #dsmom004#0;
     |LEE 101#dsmow073.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow073;
         #dsmow073#0 = #dsmom004#0;
         #dsmow073#1 = #dsmow072#2;
         #dsmow073#3 = #dsmom004#4;
         |GRABA 020#dsmow073.n;
     |FINSI;
     |LIBERA #dsmow073;
|FPRC;

|PROCESO dsm190liG;
     |SI #dsm190li#22 = #dsmow072#4;
         #dsm190li#22 = #dsmow072#5;
         |GRABA 020#dsm190li.a;
     |FINSI;
     |LIBERA #dsm190li;
|FPRC;

|DEFBUCLE dsm190liG;
     #dsm190li#1;
     ;
     #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,#dsmow072#1,0000,"A","  ",0;
     #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,#dsmow072#1,9999,"A","zz",4;
     be;
     NULL, dsm190liG;
|FIN;

|PROCESO dsm19001G;
     |SI #dsm19001#22 = #dsmow072#4;
         #dsm19001#22 = #dsmow072#5;
         |GRABA 020#dsm19001.a;
     |FINSI;
     |LIBERA #dsm19001;
|FPRC;

|DEFBUCLE dsm19001G;
     #dsm19001#1;
     ;
     #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,#dsmow072#1,0000,"A","  ",0;
     #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,#dsmow072#1,9999,"A","zz",4;
     be;
     NULL, dsm19001G;
|FIN;

|PROCESO MiraTemporal;
     |SI enEmpresa = 0;  |O enEmpresa ! #dsmow072#0;
         #dsmom004#0 = #dsmow072#0;
         #dsmom004#1 = #dsmoy024#0;
         #dsmom004#2 = 99;
         #dsmom004#3 = 190;
         #dsmom004#4 = 0;
         |PARA;  |SI;  |HACIENDO;
              |LEE 040#dsmom004.=;
              |SI FSalida = 0;
                  #dsmom004#4 = #dsmom004#4 + 1;
              |SINO;
                  nLinea = #dsmom004#4;
                  |SAL;
              |FINSI;
         |SIGUE;

         |SI #dsmoy024#17 = "C";  |O #dsmoy024#17 = "S";
             |HAZ CreaComplementaria;
         |SINO;
             nLinea = nLinea - 1;
         |FINSI;
     |FINSI;

     |ABRE #agidanif;
     #agidanif#0  = #dsmow072#1;
     #agidanif#1  = 1;
     |LEE 040#agidanif.=;
     |SI FSalida ! 0;  |DDEFECTO #agidanif; |FINSI;
     |CIERRA #agidanif;

     enEmpresa = #dsmow072#0;

     #dsm190ca#0 = #dsmom004#0;
     #dsm190ca#1 = #dsmom004#1;
     #dsm190ca#2 = #dsmom004#2;
     #dsm190ca#3 = 190;
     #dsm190ca#4 = nLinea;
     #dsm190ca#5 = 0;
     |LEE 101#dsm190ca.=;

     |SI #dsmoy024#17 = "S";  |O #dsmoy024#17 = "M";
         |SI #dsmoy024#0 [ 2015;
             |BUCLE dsm190liG;
         |FINSI;

         |SI #dsmoy024#0 ] 2016;
             |BUCLE dsm19001C;
         |FINSI;
     |SINO;
         |SI #dsmoy024#0 [ 2015;
             |ABRE #dsm190li;
             |DDEFECTO #dsm190li;
             #dsm190li#0  = #dsmom004#0;
             #dsm190li#1  = #dsmom004#1;
             #dsm190li#2  = #dsmom004#2;
             #dsm190li#3  = 190;
             #dsm190li#4  = nLinea;
             #dsm190li#5  = 0;
             #dsm190li#6  = #dsmow072#1;
             #dsm190li#7  = 0;
             #dsm190li#8  = "A";
             #dsm190li#9  = "";
             #dsm190li#10 = #agidanif#36;
             #dsm190li#22 = #dsmow072#5;
             |GRABA 020#dsm190li.n;
             |LIBERA #dsm190li;
             |CIERRA #dsm190li;
         |FINSI;

         |SI #dsmoy024#0 ] 2016;
             |ABRE #dsm19001;
             |DDEFECTO #dsm19001;
             #dsm19001#0  = #dsmom004#0;
             #dsm19001#1  = #dsmom004#1;
             #dsm19001#2  = #dsmom004#2;
             #dsm19001#3  = 190;
             #dsm19001#4  = nLinea;
             #dsm19001#5  = 0;
             #dsm19001#6  = #dsmow072#1;
             #dsm19001#7  = 0;
             #dsm19001#8  = "A";
             #dsm19001#9  = "";
             #dsm19001#10 = #agidanif#36;
             #dsm19001#22 = #dsmow072#5;
             |GRABA 020#dsm19001.n;
             |LIBERA #dsm19001;
             |CIERRA #dsm19001;
         |FINSI;

         #dsm190ca#6 = #dsm190ca#6 + 1;
         |GRABA 020#dsm190ca.a;
     |FINSI;
     |LIBERA #dsm190ca;

     |PRINT;
     nSwHay = 1;
|FPRC;

|DEFBUCLE dsmow072;
     #dsmow072#2;
     ;
     "S", 00001, "            ";
     "S", 99999, "zzzzzzzzzzzz";
     ;
     NULL, MiraTemporal;
|FIN;

|PROCESO GrabaJusti;
     #dsm190ca#0  = #dsmow073#0;
     #dsm190ca#1  = #dsmoy024#0;
     #dsm190ca#2  = 99;
     #dsm190ca#3  = 190;
     #dsm190ca#4  = #dsmow073#3;
     #dsm190ca#5  = 0;
     |LEE 101#dsm190ca.=;
     |SI FSalida = 0;
         #dsm190ca#9 = #dsmow073#2;
         |GRABA 020#dsm190ca.a;
     |FINSI;
     |LIBERA #dsm190ca;
|FPRC;

|DEFBUCLE dsmow073;
     #dsmow073#1;
     ;
     00001;
     99999;
     ;
     NULL, GrabaJusti;
|FIN;

|RUTINA ClaveBaja998;
     #dsmow073#0 = 1;
|FRUT;

|RUTINA ClaveAlta998;
     #dsmow073#0 = 99999;
|FRUT;

|PROCESO GrabaModelo;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "dsmoyb24";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     enEmpresa = 0;
     nSwHay    = 0;

     |ABRE #dsmom004;
     |ABRE #dsm190ca;
     |BUCLE dsmow072;
     |CIERRA #dsmom004;

     |SI #dsmoy024#17 ! "M";
         |ET Arriba998;
             |ENTLINEAL #1#dsmow073, -1, 2, 22, 1, ClaveBaja998, ClaveAlta998;

             aMenu4 = "RGA";
             aMenu6 = " Grabar Justificante ";
             |MENU aMenu;
             aMenu2 = FSalida;

             |SI FSalida < 0; aMenu2 = "1";        |FINSI;
             |SI aMenu2 = "1";  |VETE Arriba998;   |FINSI;
             |SI aMenu2 = "2";  |BUCLE dsmow073;   |FINSI;
     |FINSI;

     |CIERRA #dsm190ca;

     |SI nSwHay = 1;  |PIEINF;  |FINSI;
     |FININF;
     |FINIMP;
|FPRC;

|RUTINA ClaveBaja999;
     #dsmow072#0 = 1;
     #dsmow072#1 = "            ";
|FRUT;

|RUTINA ClaveAlta999;
     #dsmow072#0 = 99999;
     #dsmow072#1 = "zzzzzzzzzzzz";
|FRUT;

|PROCESO Tipo3;  |TIPO 3;
     |DBASE aPathModelo;  |QBT aPathModelo;

     |SI #dsmoy024#0 [ 2015;
         aDef = aPathModelo + "def/dsm190li.mas";
     |FINSI;

     |SI #dsmoy024#0 ] 2016;
         aDef = aPathModelo + "def/dsm19001.mas";
     |FINSI;

     |CARGA_DEF aDef, espejo1@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #dsmoy024#16 = "N";
         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |INFOR "dsmoy024";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |SINO;
         aFichero = ("72" + Usuario + "zzzzzzzz") % 108;
         |NOME_DAT #dsmow072#aFichero#;

         aFichero = ("73" + Usuario + "zzzzzzzz") % 108;

         |ABRE #dsmow072;  |CIERRA #dsmow072;  |DELINDEX #dsmow072;
         |ABRE #dsmow073;  |CIERRA #dsmow073;  |DELINDEX #dsmow073;
         |ABRE #dsmow072;
         |ABRE #dsmow073;
     |FINSI;

     aAlfa   = #dsmoy024#0;
     aAlfa   = aAlfa % -102;
     nEjer   = aAlfa;

     |ABRET #labtraba;
     |SI #dsmoy024#1 ! 0;
         |BUCLE agifigen;
     |SINO;
         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |SI #dsmoy024#nCampo# ! 0;
                   #dsmoy024#1 = #dsmoy024#nCampo#;
                   #dsmoy024#2 = #dsmoy024#nCampo#;
                   |BUCLE agifigen;
               |FINSI;
         |SIGUE;
     |FINSI;
     |CIERRAT #labtraba;

     |SI #dsmoy024#16 = "N";
         |SI nSwHay = 1;  |PIEINF;  |FINSI;
         |FININF;
         |FINIMP;
     |SINO;
         |CIERRA #dsmow072;
         |SI nSwHay = 1;
             |ET Arriba;
                 |ENTLINEAL #1#dsmow072, -2, 4, 22, 1, ClaveBaja999, ClaveAlta999;
                 |MENU aMenu;
                 aMenu2 = FSalida;

                 |SI FSalida < 0; aMenu2 = "1";        |FINSI;
                 |SI aMenu2 = "1";  |VETE Arriba;      |FINSI;
                 |SI aMenu2 = "2";  |HAZ GrabaModelo;  |FINSI;
         |SINO;
             |MENAV "     Seleccion Vacia.";
         |FINSI;
         |DELINDEX #dsmow072;
         |DELINDEX #dsmow073;
     |FINSI;

     |DESCARGA_DEF #espejo1@;
|FPRC;

|PROGRAMA;
     |DBASS aBase;  |QBF aBase;
     aPathLaboral = aBase + "laboral/def/nomhicca.mas";
     |XABRE "E", aPathLaboral, nHandle;
     |SI FSalida < 0;
         |MENAV "    No existe la Gestion Laboral. ....";
         |ACABA;
     |FINSI;

     aPathLaboral = aBase + "laboral/fich/";
     |PATH_DAT #labtraba#aPathLaboral#;
     |PATH_DAT #nomhicca#aPathLaboral#;

     |MANTE #dsmoy024;
|FPRO;
