|FICHEROS;
     dsmom004 #4;
     dsmom008 #8;
     dsmom010 #10;
     dsmom011 #11;
     dsmom012 #12;
     dsmom013 #13;
     dsmom014 #14;
     espejos@  #111;
     dsmom09@ #909;
     dsmow006 #998;
     dsmow091 #991;

     dsmociva #400;
     dsmod300 #300;
     dsmod303 #303;
     dsmod320 #320;
     dsmod330 #330;
     dsmod332 #332;
     dsmod370 #370;
     dsm30301;
|FIN;

|VARIABLES;
     aDef        = "";
     aPathModelo = "";
     aAlfa       = "";
     nNume1      = 0;
     nNume2      = 0;
     nNume3      = 0;
     nNume4      = 0;
     nNume5      = 0;
     nPara1      = 0;
     nSwTope     = 0;
     nTopeTr     = 0;
     nNume       = 0;
     nTecla      = 0;
     nPeriodoMin = 0;
     nPeriodo    = 0;
     nCampo      = 0;
     nSwPush     = 0;
     nDevolver   = 0;
     nContador   = 0;
     nSinDatos   = 0;
     nGrupo      = 0;
     nSubGrupo   = 0;
     nPer        = 0;
     aAlfa1      = "";
     &enFichero  = 0;
     &enCalculado = 0;
     &enImpo65    = 0;
     &enModo65    = 0;
     &eaHay130    = "";
     &eaHay303    = "";
     &eaTipo65    = "";
     &enRec65     = 0;

     nTotalG17    = 0;
     nTotalG21    = 0;
     nTp          = 0;
     nOpe         = 0;

     nClave0   = 0;
     nClave1   = 0;
     nClave2   = 0;
     nClave3   = 0;
     nClave4   = 0;
     nClave5   = 0;
     nSwFa     = 0;
     nContenido = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO PasaIngresos;
     |DDEFECTO #10;
     #10#0  = #998#0;
     #10#1  = #998#1;
     #10#2  = #998#2;
     #10#3  = #998#3;
     #10#4  = #998#4;
     #10#5  = #14#0;
     #10#6  = #14#1;
     #10#7  = #14#3;
     |GRABA 020#10n;
     |LIBERA #10;
|FPRC;

|DEFBUCLE dsmom014Iw6;
     #14#1;
     2;
     enPlan14, "    ", "I";
     enPlan14, "zzzz", "I";
     ;
     NULL, PasaIngresos;
|FIN;

|PROCESO PasaConsumo;
     |DDEFECTO #12;
     #12#0  = #998#0;
     #12#1  = #998#1;
     #12#2  = #998#2;
     #12#3  = #998#3;
     #12#4  = #998#4;
     #12#5  = #14#0;
     #12#6  = #14#1;
     #12#7  = #14#3;
     |GRABA 020#12n;
     |LIBERA #12;
|FPRC;

|DEFBUCLE dsmom014Cw6;
     #14#1;
     2;
     enPlan14, "    ", "C";
     enPlan14, "zzzz", "C";
     ;
     NULL, PasaConsumo;
|FIN;

|PROCESO PasaExistencias;
     |DDEFECTO #11;
     #11#0  = #998#0;
     #11#1  = #998#1;
     #11#2  = #998#2;
     #11#3  = #998#3;
     #11#4  = #998#4;
     #11#5  = #14#0;
     #11#6  = #14#1;
     #11#7  = #14#3;
     #11#10 = #14#5;
     |GRABA 020#11n;
     |LIBERA #11;
|FPRC;

|DEFBUCLE dsmom014Ew6;
     #14#1;
     2;
     enPlan14, "    ", "E";
     enPlan14, "zzzz", "E";
     ;
     NULL, PasaExistencias;
|FIN;

|PROCESO PasaGastos;
     |DDEFECTO #13;
     #13#0  = #998#0;
     #13#1  = #998#1;
     #13#2  = #998#2;
     #13#3  = #998#3;
     #13#4  = #998#4;
     #13#5  = #14#0;
     #13#6  = #14#1;
     #13#7  = #14#3;
     |GRABA 020#13n;
     |LIBERA #13;
|FPRC;

|DEFBUCLE dsmom014Gw6;
     #14#1;
     2;
     enPlan14, "    ", "G";
     enPlan14, "zzzz", "G";
     ;
     NULL, PasaGastos;
|FIN;

|PROCESO CreaPlanillas;
     |ABRE #10;
     #10#0  = #998#0;
     #10#1  = #998#1;
     #10#2  = #998#2;
     #10#3  = #998#3;
     #10#4  = #998#4;
     #10#5  = "    ";
     |LEE 101#10];
     |SI FSalida ! 0; |O #10#0 ! #998#0;  |O #10#1 ! #998#1; |O #10#2 ! #998#2;
       |O #10#3 ! #998#3; |O #10#4 ! #998#4;
          |BUCLE dsmom014Iw6;
     |FINSI;
     |CIERRA #10;

     |ABRE #12;
     #12#0  = #998#0;
     #12#1  = #998#1;
     #12#2  = #998#2;
     #12#3  = #998#3;
     #12#4  = #998#4;
     #12#5  = "    ";
     |LEE 101#12];
     |SI FSalida ! 0; |O #12#0 ! #998#0;  |O #12#1 ! #998#1; |O #12#2 ! #998#2;
       |O #12#3 ! #998#3; |O #12#4 ! #998#4;
          |BUCLE dsmom014Cw6;
     |FINSI;
     |CIERRA #12;

     |ABRE #11;
     #11#0  = #998#0;
     #11#1  = #998#1;
     #11#2  = #998#2;
     #11#3  = #998#3;
     #11#4  = #998#4;
     #11#5  = "    ";
     |LEE 101#11];
     |SI FSalida ! 0; |O #11#0 ! #998#0;  |O #11#1 ! #998#1; |O #11#2 ! #998#2;
        |O #11#3 ! #998#3; |O #11#4 ! #998#4;
           |BUCLE dsmom014Ew6;
     |FINSI;

     |ABRE #13;
     #13#0  = #998#0;
     #13#1  = #998#1;
     #13#2  = #998#2;
     #13#3  = #998#3;
     #13#4  = #998#4;
     #13#5  = "    ";
     |LEE 101#13];
     |SI FSalida ! 0; |O #13#0 ! #998#0;  |O #13#1 ! #998#1; |O #13#2 ! #998#2;
       |O #13#3 ! #998#3; |O #13#4 ! #998#4;
          |BUCLE dsmom014Gw6;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO CogeIniciales;
     |DDEFECTO #11;
     #11#0 = #111#0;
     #11#1 = #111#1;
     #11#2 = #998#2;
     #11#3 = #111#3;
     #11#4 = #111#4;
     #11#5 = #111#5;
     |LEE 101#11=;
     |SI FSalida = 0;
         #11#8 = #111#8;
         |GRABA 020#11a;
     |FINSI;
     |LIBERA #11;
|FPRC;

|DEFBUCLE espejosw6;
     #111#1006;
     ;
     #998#0, #998#1, nPeriodo, #998#3, #998#4, "    ";
     #998#0, #998#1, nPeriodo, #998#3, #998#4, "zzzz";
     ;
     NULL, CogeIniciales;
|FIN;

|PROCESO PonExistenciasw6;
     #12#8 = #12#8 + (#11#8 - #11#9);
|FPRC;

|DEFBUCLE dsmom011w6;
     #11#2;
     ;
     #12#0, #12#1, #12#2, #12#3, #12#4, #12#5, "    ";
     #12#0, #12#1, #12#2, #12#3, #12#4, #12#5, "zzzz";
     ;
     NULL, PonExistenciasw6;
|FIN;

|PROCESO ConsumoExistencia;
     |ABRE #14;
     |SELECT #2#14;
     #14#5 = #12#5;
     |LEE 040#14=;
     |SI FSalida = 0;
         #12#8 = 0;
         |BUCLE dsmom011w6;
         |GRABA 020#12a;
     |FINSI;
     |CIERRA #14;
     |LIBERA #12;
|FPRC;

|DEFBUCLE dsmom012Cw6;
     #12#1;
     ;
     #998#0, #998#1, #998#2, #998#3, #998#4, "    ";
     #998#0, #998#1, #998#2, #998#3, #998#4, "zzzz";
     be;
     NULL, ConsumoExistencia;
|FIN;

|PROCESO CreaLineales;  |TIPO 7;
     nSwFa = 1;
     |HAZ Totalesw006;
     nSwFa = 0;

     |HAZ CreaPlanillas;

     nPeriodoMin = 1;
     |SI #998#7  = "X";  nPeriodoMin = 3;  |FINSI;
     |SI #998#8  = "X";  nPeriodoMin = 3;  |FINSI;

     |SI #11#2 ! nPeriodoMin;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmom011.mas";
         |CARGA_DEF aDef, espejos@;
         |SI FSalida ! 0;
             aAlfa = "     Error en cargar el Def " + eaNomDef;
             |MENAV aAlfa;
             |ERROR;
         |FINSI;

         nPeriodo = #998#2 - nPeriodoMin;
         |BUCLE espejosw6;

         |DESCARGA_DEF #espejos@;
     |FINSI;
     |CIERRA #11;

     |BUCLE dsmom012Cw6;
|FPRC;

|PROCESO AyudaCampo;  |TIPO 7;
 aAlfa1 = "";
 |SI Campo = 17;
     aAlfa1 = "    <F2> Ingresos por Periodo. <F5> Ingresos por Ejercicio";
     |SI #998#60 = "X";
         aAlfa1 = "    Ingresos: F2- Periodo. F5- Ejercicio; F7- Datos Agrupados, F8- Consulta Datos A.";
     |FINSI;
 |FINSI;
 |SI Campo = 20;
     aAlfa1 = "    <F2>Consumo por Periodo <F5> Consumo por Ejercicio <F3> Consulta Existencias";
     |SI #998#60 = "X";
         aAlfa1 = "    Consumo: F2- Periodo F5- Ejercicio; F3-Cons.Exis; F7- Datos Ag. F8- Cons.Datos A";
     |FINSI;
 |FINSI;
 |SI Campo = 23;
     aAlfa1 = "    <F2> Gastos por Periodo  <F5> Gastos por Ejercicio";
     |SI #998#60 = "X";
         aAlfa1 = "    Gastos: F2- Periodo. F5- Ejercicio; F7- Datos Agrupados, F8- Consulta Datos A.";
         aAlfa1 = "    F2- Intr. Consumo F3- Consulta Existencias. F7- Datos Ag. F8- Consulta Datos A";
     |FINSI;
 |FINSI;
 |SI Campo = 58;
     aAlfa1 = "    Pulse <F2> Introduccion del Consumo  <F3> Consulta de Existencias.";
     |SI #998#60 = "X";
         aAlfa1 = "    F2- Intr. Consumo F3- Consulta Existencias. F7- Datos Ag. F8- Consulta Datos A";
     |FINSI;
 |FINSI;
 |SI Campo = 45;
     aAlfa1 = "    Pulse <F2> para el Desglose de I.V.A.";
     |SI #998#60 = "X";
         aAlfa1 = "    <F2> para el Desglose de I.V.A. <F7> Datos Agrupados, <F8> Consulta Datos Agrup.";
     |FINSI;
 |FINSI;
 |MENSA aAlfa1;
|FPRC;

|RUTINA Baja991;
     #991#0 = "    ";
|FRUT;

|RUTINA Alta991;
     #991#0 = "zzzz";
|FRUT;

|RUTINA ClaveBaja10;
     #10#0 = #998#0;
     #10#1 = #998#1;
     #10#2 = #998#2;
     #10#3 = #998#3;
     #10#4 = #998#4;
     #10#5 = "    ";
|FRUT;

|RUTINA ClaveAlta10;
     #10#0 = #998#0;
     #10#1 = #998#1;
     #10#2 = #998#2;
     #10#3 = #998#3;
     #10#4 = #998#4;
     #10#5 = "zzzz";
|FRUT;

|PROCESO CalculaIngresos;
     |SI #10#7 = "+";
         #998#17 = #998#17 + #10#8;
     |SINO;
         #998#17 = #998#17 - #10#8;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom010w6;
     #10#1;
     ;
     #998#0, #998#1, #998#2, #998#3, #998#4, "    ";
     #998#0, #998#1, #998#2, #998#3, #998#4, "zzzz";
     ;
     NULL, CalculaIngresos;
|FIN;

|PROCESO dsmom010w991;
     #991#0 = #10#5;
     |LEE 101#991=;
     |SI FSalida ! 0;
         |DDEFECTO #991;
         #991#0 = #10#5;
         |GRABA 020#991b;
     |FINSI;

     #991#1 = #10#6;
     #991#2 = #10#7;

                         nCampo = 4;
     |SI nPer = #998#2;  nCampo = 5;  |FINSI;

     #991nCampo = #991nCampo + #10#8;
     #991#3     = #991#4 + #991#5;

     |GRABA 020#991a;
     |LIBERA #991;
|FPRC;

|DEFBUCLE dsmom010w991;
     #10#1;
     ;
     #998#0, #998#1, nPer, #998#3, #998#4, "    ";
     #998#0, #998#1, nPer, #998#3, #998#4, "zzzz";
     ;
     NULL, dsmom010w991;
|FIN;

|PROCESO dsmom012w991;
     #14#5 = #12#5;
     |LEE 040#14=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #991#0 = #12#5;
     |LEE 101#991=;
     |SI FSalida ! 0;
         |DDEFECTO #991;
         #991#0 = #12#5;
         |GRABA 020#991b;
     |FINSI;

     #991#1 = #12#6;
     #991#2 = #12#7;

                         nCampo = 4;
     |SI nPer = #998#2;  nCampo = 5;  |FINSI;

     #991nCampo = #991nCampo + #12#8;
     #991#3     = #991#4 + #991#5;

     |GRABA 020#991a;
     |LIBERA #991;
|FPRC;

|DEFBUCLE dsmom012w991;
     #12#1;
     ;
     #998#0, #998#1, nPer, #998#3, #998#4, "    ";
     #998#0, #998#1, nPer, #998#3, #998#4, "zzzz";
     ;
     NULL, dsmom012w991;
|FIN;

|PROCESO dsmom013w991;
     #991#0 = #13#5;
     |LEE 101#991=;
     |SI FSalida ! 0;
         |DDEFECTO #991;
         #991#0 = #13#5;
         |GRABA 020#991b;
     |FINSI;

     #991#1 = #13#6;
     #991#2 = #13#7;

                         nCampo = 4;
     |SI nPer = #998#2;  nCampo = 5;  |FINSI;

     #991nCampo = #991nCampo + #13#8;
     #991#3     = #991#4 + #991#5;

     |GRABA 020#991a;
     |LIBERA #991;
|FPRC;

|DEFBUCLE dsmom013w991;
     #13#1;
     ;
     #998#0, #998#1, nPer, #998#3, #998#4, "    ";
     #998#0, #998#1, nPer, #998#3, #998#4, "zzzz";
     ;
     NULL, dsmom013w991;
|FIN;

|PROCESO dsmow091;
     |SI enFichero = 10;
         #10#0  = #998#0;
         #10#1  = #998#1;
         #10#2  = #998#2;
         #10#3  = #998#3;
         #10#4  = #998#4;
         #10#5  = #991#0;
         |LEE 101#10=;
         |SI FSalida = 0;
             #10#8 = #991#5;
             |GRABA 020#10a;
             |LIBERA #10;
         |FINSI;
     |FINSI;

     |SI enFichero = 12;
         #12#0  = #998#0;
         #12#1  = #998#1;
         #12#2  = #998#2;
         #12#3  = #998#3;
         #12#4  = #998#4;
         #12#5  = #991#0;
         |LEE 101#12=;
         |SI FSalida = 0;
             #12#8 = #991#5;
             |GRABA 020#12a;
             |LIBERA #12;
         |FINSI;
     |FINSI;

     |SI enFichero = 13;
         #13#0  = #998#0;
         #13#1  = #998#1;
         #13#2  = #998#2;
         #13#3  = #998#3;
         #13#4  = #998#4;
         #13#5  = #991#0;
         |LEE 101#13=;
         |SI FSalida = 0;
             #13#8 = #991#5;
             |GRABA 020#13a;
             |LIBERA #12;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmow091;
     #991#1;
     ;
     "    ";
     "zzzz";
     ;
     NULL, dsmow091;
|FIN;

|PROCESO Ingresos;
     |SI nTecla = 10;
         |PUSHV 0501 2380;
         |PINPA #0#10;

         |ATRI S;  |PINTA 2269, #998#17;  |ATRI s;

         |HAZ Descarga10;
         |ENTLINEAL #1#10, -6, 2, 20, 0, ClaveBaja10, ClaveAlta10;

         |POPV;
         |ERROR;
     |FINSI;

     |SI nTecla = 13;
         enFichero = 10;

         |PUSHV 0501 2380;
         |PINPA #0#991;

         |ATRI S;
         |PINTA 2245, #998#19;
         |PINTA 2257, #998#18;
         |PINTA 2269, #998#17;
         |ATRI s;

         aAlfa = ("91" + Usuario + "zzzzzzzz") % 108;
         |NOME_DAT #991 aAlfa;
         |ABRE #991;  |CIERRA #991;  |DELINDEX #991;

         |ABRE #991;
         |PARA nPer = 1;  |SI nPer [ #998#2;  |HACIENDO nPer = nPer + 1;
               |BUCLE dsmom010w991;
         |SIGUE;
         |CIERRA #991;

         |HAZ Descarga91;
         |ENTLINEAL #1#991, -1, 2, 20, 0, Baja991, Alta991;

         |ABRE #10;
         |BUCLE dsmow091;
         |CIERRA #10;

         |DELINDEX #991;

         |POPV;
         |ERROR;
     |FINSI;

     |SI nTecla = 15; |O nTecla = 16;
         |SI #998#60 = "X";
             |HAZ Pregunta65;
             |ACABA;
         |FINSI;
     |FINSI;

     #998#17 = 0;
     |BUCLE dsmom010w6;
     |PINTA #998#17;
     |PINTA #998#18;
     |PINTA #998#19;
|FPRC;

|RUTINA ClaveBaja11;
     #11#0 = #998#0;
     #11#1 = #998#1;
     #11#2 = #998#2;
     #11#3 = #998#3;
     #11#4 = #998#4;
     #11#5 = "    ";
|FRUT;

|RUTINA ClaveAlta11;
     #11#0 = #998#0;
     #11#1 = #998#1;
     #11#2 = #998#2;
     #11#3 = #998#3;
     #11#4 = #998#4;
     #11#5 = "zzzz";
|FRUT;

|RUTINA ClaveBaja12;
     #12#0 = #998#0;
     #12#1 = #998#1;
     #12#2 = #998#2;
     #12#3 = #998#3;
     #12#4 = #998#4;
     #12#5 = "    ";
|FRUT;

|RUTINA ClaveAlta12;
     #12#0 = #998#0;
     #12#1 = #998#1;
     #12#2 = #998#2;
     #12#3 = #998#3;
     #12#4 = #998#4;
     #12#5 = "zzzz";
|FRUT;

|PROCESO CalculaConsumo;
     |ABRE #14;
     |SELECT #2#14;
     #14#5 = #12#5;
     |LEE 040#14=;
     |SI FSalida = 0;
          |SI #12#7 = "+";
              #998#58 = #998#58 + #12#8;
          |SINO;
              #998#58 = #998#58 - #12#8;
          |FINSI;
     |SINO;
          |SI #12#7 = "+";
              #998#20 = #998#20 + #12#8;
          |SINO;
              #998#20 = #998#20 - #12#8;
          |FINSI;
     |FINSI;
     |CIERRA #14;
|FPRC;

|DEFBUCLE dsmom012w6;
     #12#1;
     ;
     #998#0, #998#1, #998#2, #998#3, #998#4, "    ";
     #998#0, #998#1, #998#2, #998#3, #998#4, "zzzz";
     ;
     NULL, CalculaConsumo;
|FIN;

|PROCESO Consumos;
     |SI nTecla = 10;
         |PUSHV 0501 2380;
         |PINPA #0#12;

         nNume   = #998#45;
         #998#45 = #998#20 + #998#58;
         |ATRI S;  |PINTA 2269, #998#45;  |ATRI s;
         #998#45 = nNume;

         |HAZ Descarga12;
         |ENTLINEAL #1#12, -6, 2, 20, 0, ClaveBaja12, ClaveAlta12;

         |POPV;
         |ERROR;
     |FINSI;

     |SI nTecla = 11;
         |PUSHV 0501 2380;
         |PINPA #0#11;
         |HAZ Descarga11;
         |ENTLINEAL #1#11, -6, 4, 22, 0, ClaveBaja11, ClaveAlta11;
         |POPV;
         |ERROR;
     |FINSI;

     |SI nTecla = 13;  |Y Campo = 20;
         enFichero = 12;

         |PUSHV 0501 2380;
         |PINPA #0#991;

         |ATRI S;
         |PINTA 2245, #998#20;
         |PINTA 2257, #998#21;
         |PINTA 2269, #998#22;
         |ATRI s;

         aAlfa = ("91" + Usuario + "zzzzzzzz") % 108;
         |NOME_DAT #991 aAlfa;
         |ABRE #991;  |CIERRA #991;  |DELINDEX #991;

         |ABRE #991;
         |ABRE #14;
         |SELECT #2#14;
         |PARA nPer = 1;  |SI nPer [ #998#2;  |HACIENDO nPer = nPer + 1;
               |BUCLE dsmom012w991;
         |SIGUE;
         |CIERRA #14;
         |CIERRA #991;

         |HAZ Descarga91;
         |ENTLINEAL #1#991, -1, 2, 20, 0, Baja991, Alta991;

         |ABRE #12;
         |BUCLE dsmow091;
         |CIERRA #12;

         |DELINDEX #991;

         |POPV;
         |ERROR;
     |FINSI;

     |SI nTecla = 15; |O nTecla = 16;
         |SI #998#60 = "X";
             |HAZ Pregunta65;
             |ACABA;
         |FINSI;
     |FINSI;

     #998#20 = 0;
     #998#58 = 0;
     |BUCLE dsmom012w6;
     |PINTA #998#20;
     |PINTA #998#21;
     |PINTA #998#22;
     |PINTA #998#58;
|FPRC;

|RUTINA ClaveBaja13;
     #13#0 = #998#0;
     #13#1 = #998#1;
     #13#2 = #998#2;
     #13#3 = #998#3;
     #13#4 = #998#4;
     #13#5 = "    ";
|FRUT;

|RUTINA ClaveAlta13;
     #13#0 = #998#0;
     #13#1 = #998#1;
     #13#2 = #998#2;
     #13#3 = #998#3;
     #13#4 = #998#4;
     #13#5 = "zzzz";
|FRUT;

|PROCESO CalculaGastos;
     |SI #13#7 = "+";
         #998#23 = #998#23 + #13#8;
     |SINO;
         #998#23 = #998#23 - #13#8;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom013w6;
     #13#1;
     ;
     #998#0, #998#1, #998#2, #998#3, #998#4, "    ";
     #998#0, #998#1, #998#2, #998#3, #998#4, "zzzz";
     ;
     NULL, CalculaGastos;
|FIN;

|PROCESO CalculaTrabajo;
   |SI #13#7 = "+";
       nTopeTr = nTopeTr + #13#8;
   |SINO;
       nTopeTr = nTopeTr - #13#8;
   |FINSI;
   nSwTope = 1;
|FPRC;

|DEFBUCLE dsmom013w6Tr;
     #13#1;
     ;
     #998#0, #998#1, nPara1, #4#4, #998#4, "6400";
     #998#0, #998#1, nPara1, #4#4, #998#4, "6410";
     ;
     NULL, CalculaTrabajo;
|FIN;

|PROCESO TopeSueldos;

     nSwTope = 0;
     nTopeTr = 0;
     |ABRE #4;
     |PARA nPara1 = enPeriodo; |SI nPara1 ] 3; |HACIENDO nPara1 = nPara1 - 3;
           |SI nPara1 = enPeriodo;
               #4#0 = #998#0;
               #4#1 = #998#1;
               #4#2 = enPeriodo;
               #4#3 = 130;
               #4#4 = #998#3;
               |LEE 040#4=;
           |SINO;
               #4#0 = #998#0;
               #4#1 = #998#1;
               #4#2 = nPara1;
               #4#3 = 130;
               #4#4 = 99;
               |LEE 040#4];
               |SI FSalida = 0;
                   |LEE 040#4a;
               |SINO;
                   |LEE 040#4u;
               |FINSI;
           |FINSI;
           |SI FSalida = 0; |Y #4#0 = #998#0; |Y #4#1 = #998#1;
               |Y #4#2 = nPara1; |Y #4#3 = 130;
               |BUCLE dsmom013w6Tr;
           |FINSI;
     |SIGUE;
     |CIERRA #4;
|FPRC;

|PROCESO Gastos;
     |SI nTecla = 10;
         |PUSHV 0501 2380;
         |PINPA #0#13;

         |ATRI S;  |PINTA 2269, #998#23;  |ATRI s;

         |HAZ Descarga13;
         |ENTLINEAL #1#13, -6, 2, 20, 0, ClaveBaja13, ClaveAlta13;

         |POPV;
         |ERROR;
     |FINSI;

     |SI nTecla = 13;
         enFichero = 13;

         |PUSHV 0501 2380;
         |PINPA #0#991;

         |ATRI S;
         |PINTA 2245, #998#23;
         |PINTA 2257, #998#24;
         |PINTA 2269, #998#25;
         |ATRI s;

         aAlfa = ("91" + Usuario + "zzzzzzzz") % 108;
         |NOME_DAT #991 aAlfa;
         |ABRE #991;  |CIERRA #991;  |DELINDEX #991;

         |ABRE #991;
         |PARA nPer = 1;  |SI nPer [ #998#2;  |HACIENDO nPer = nPer + 1;
               |BUCLE dsmom013w991;
         |SIGUE;
         |CIERRA #991;

         |HAZ Descarga91;
         |ENTLINEAL #1#991, -1, 2, 20, 0, Baja991, Alta991;

         |ABRE #13;
         |BUCLE dsmow091;
         |CIERRA #13;

         |DELINDEX #991;

         |POPV;
         |ERROR;
     |FINSI;

     |SI nTecla = 15; |O nTecla = 16;
         |SI #998#60 = "X";
             |HAZ Pregunta65;
             |ACABA;
         |FINSI;
     |FINSI;

     nTopeTr = 0;
     #998#23 = 0;
     |BUCLE dsmom013w6;
     |PINTA #998#23;
     |PINTA #998#24;
     |PINTA #998#25;
|FPRC;

|| //////////// Procesos Grabacion del IVA \\\\\\\\\\\\\\\\§

|PROCESO EntraIva;
     |SI nTecla ! 10;  |Y nTecla ! 15; |Y nTecla ! 16;  |ACABA;  |FINSI;

     |SI nTecla = 15; |O nTecla = 16;
         |SI #998#60 = "X";
             |HAZ Pregunta65;
         |FINSI;
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #998#7  = " ";  |Y #998#8 = " ";  |Y  #998#9  = " ";  |Y  #998#10 = " ";  |Y  #998#11 = " ";
         |MENAV "    No hay Modelo de IVA a Confeccionar.";
         |ACABA;
     |FINSI;

     enEmpresa     = #998#0;
     enEjer        = #998#1;
     enPeriodo     = #998#2;

     |SI enEjer [ 2008;
         |SI #998#7    = "X";  enModelo = 300;  |FINSI;
         |SI #998#8    = "X";  enModelo = 370;  |FINSI;
         |SI #998#9    = "X";  enModelo = 320;  |FINSI;
         |SI #998#10   = "X";  enModelo = 330;  |FINSI;
         |SI #998#11   = "X";  enModelo = 332;  |FINSI;
     |SINO;
         |SI #998#7    = "X";  enModelo = 303;  |FINSI;
         |SI #998#8    = "X";  enModelo = 370;  |FINSI;
     |FINSI;

     enComplem     = #998#3;
     enActividad   = #998#4;
     enPlanillas   = 1;
     enTipoEntrada = 0;
     |SI #998#60 = "X";
         enTipoEntrada = 4;
     |FINSI;
     |SUB_EJECUTA_NP "dsmociva;PARAQUITAR";

     |ABRE #4;
     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = enPeriodo;
     #4#3 = enModelo;
     #4#4 = enComplem;
     |LEE 101#4=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;
     nSwFa = 1;
     |HAZ Totalesw006;
     nSwFa = 0;

     |ERROR;
|FPRC;

|PROCESO LeeCasilla;
     #400#0  = enEmpresa;
     #400#1  = enEjer;
     #400#2  = enPeriodo;
     #400#3  = enModelo;
     #400#4  = enComplem;
     #400#5  = enActividad;
     #400#6  = nGrupo;
     #400#7  = nSubGrupo;
     |LEE 040#400=;
     |SI FSalida ! 0;  |DDEFECTO #400;  |FINSI;
|FPRC;

|PROCESO AntesReduc; |TIPO 7;

  |SI #998#1 ] 2010;
      |C_M #998#61, 1, "S";
      |SI #998#56 = 7;  |O #998#56 = 12;  |O #998#56 = 17;
          |C_M #998#61, 1, "N";
          #998#61 = "N"; |PINTA #998#61;
      |FINSI;
      |SI eaComunidad = "S";
          |C_M #998#61, 1, "N";
           #998#61 = "N"; |PINTA #998#61;
      |FINSI;
  |FINSI;
  |SI #998#1 ] 2016;
      |C_M #998#61, 1, "N";
      #998#61 = "N"; |PINTA #998#61;
  |FINSI;
|FPRC;

|PROCESO LaReducw61;
 aAlfa1 = #998#61;  |C_M #998#62,1,aAlfa1;
 |SI #998#61 = "N";
     #998#62 = 0;
     |PINTA #998#62;
 |FINSI;
|FPRC;

|PROCESO Crea2015w6;
   |C_M #998#62, 0, aAlfa;
   |SI aAlfa = "N"; |ACABA; |FINSI;

   |SI FSalida = 2; |ACABA; |FINSI;

   |SI enEjer = 2015;
       |SI #998#62 ! 0;
           aAlfa = "0000SImporte en Reduc.creacion empleo y ejercicio 2015 incompatibles. Modifiquela. ";
           |CONFI aAlfa;
           |SI FSalida = 0;
               |ERROR;
           |FINSI;
       |SINO;
            #998#61 = "N"; |PINTA #998#61;
       |FINSI;
   |FINSI;
|FPRC;

|| //////////////////////////////////////////////////////////////////
|PROCESO ElRestodelCalculo;

         #909#30 = #909#32 - #909#31;

         #909#33 = #909#26 - #909#30;
         #909#33 = #909#33 - #909#62;

         #909#37 = #909#33 % #909#36;
         |SI #909#37 < 0;  #909#37 = 0;  |FINSI;

         #909#28 = #909#19 - (#909#22 + #909#59) - #909#25;

         #909#35 = #909#28 - #909#32;
         #909#35 = #909#35 - #909#64;

         #909#39 = #909#35 % #909#36;
         |SI #909#39 < 0;  #909#39 = 0;  |FINSI;

         #909#42 = #909#40 + #909#41;
         #909#44 = #909#39 - #909#42 - #909#43;
         |SI #909#44 < 0;  #909#44 = 0;  |FINSI;

         |SI #909#14 = "X";
             |ABRE #8;
             #8#0 = #909#0;
             #8#1 = #909#1;
             #8#2 = #909#2;
             #8#3 = 130;
             #8#4 = 0;
             #8#5 = #909#4;
             |LEE 040#8=;
             |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
             |CIERRA #8;

             enEmpresa     = #8#0;
             enEjer        = #8#1;
             enPeriodo     = #8#2;
             enModelo      = #8#3;
             enComplem     = #8#4;
             enActividad   = #8#5;
             eaComunidad   = #8#9;
             eaComunero    = #8#10;
             enTipoEntrada = 98;
             |SUB_EJECUTA_NP "dsmoc130";

             |ABRE #4;
             #4#0 = #909#0;
             #4#1 = #909#1;
             #4#2 = #909#2;
             #4#3 = 130;
             #4#4 = 0;
             |LEE 101#4=;
             |SI FSalida = 0;
                 |HAZ ChequeaSituacion;  || Esta en el PLB

                 |GRABA 020#4a;
                 |LIBERA #4;
             |FINSI;
             |CIERRA #4;
         |FINSI;
|FPRC;

|PROCESO TotalGastos;
    |SI #909#4 ! #998#4;
        |SI nOpe = 0;
            |SI #909#28 > 0;
                nTotalG17 = nTotalG17 + #909#28;
                #909#32   = #909#28 % #909#29;
                nTotalG21 = nTotalG21 + #909#32;
            |FINSI;
        |SINO;
            |SI #909#28 > 0;
                #909#32 = (#909#28 / nTp) ! 2;
            |SINO;
                #909#32 = 0;
            |FINSI;
            nTotalG21 = nTotalG21 + #909#32;
            |HAZ ElRestodelCalculo;
            |GRABA 040#909a;
        |FINSI;
    |FINSI;
    |LIBERA #909;
|FPRC;

|DEFBUCLE TotalGastos;
     #909#1005;
     ;
     #998#0, #998#1, #998#2, #998#3, 01;
     #998#0, #998#1, #998#2, #998#3, 98;
     e;
     NULL, TotalGastos;
|FIN;

|PROCESO RecogeTotalGastos;

     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/dsmom009.mas";
     |CARGA_DEF aDef, dsmom09@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def dsmom009";
         |MENAV aAlfa;
         |ERROR;
     |FINSI;

     nTotalG17 = 0;
     nTotalG21 = 0;
     |SI #998#28 > 0;
         nTotalG17 = #998#28;
         nTotalG21 = #998#28 % #998#29;
         |SI nTotalG21 < 0;  nTotalG21 = 0; |FINSI;
     |FINSI;

     nOpe = 0; |BUCLE TotalGastos;
     nOpe = 2;
     nTp  = (100 / #998#29) ! 2;
     |SI nTotalG21 > 2000;
         nTp  = (nTotalG17 / 2000) ! 2;
         nOpe = 1;
     |FINSI;
     nTotalG21 = 0;
     |BUCLE TotalGastos;
     |SI nOpe = 1;
         #998#32  = 2000 - nTotalG21;
     |SINO;
         #998#32 = (#998#28 % #998#29) ! 2;
     |FINSI;
     |SI #998#32 < 0; #998#32 = 0; |FINSI;
     #998#30 = #998#32 - #998#31;

     |DESCARGA_DEF #dsmom09@;
|FPRC;

|| //////////////////////////////////////////////////////////////////
|PROCESO LaTecla; |TIPO 0;
     nTecla = FSalida;
     |BLIN 4;
|FPRC;

|PROCESO Totalesw006;
     |SI nTecla = 13; |Y Campo = 40;
         enCalculado = #998#40;
         |HAZ Calculadora;
         #998#40 = enCalculado;
         |PINTA #998#40;
     |FINSI;

     |SI nSwFa = 0;
         nContenido = Contenido;
         |SI nContenido = #998Campo; |ACABA; |FINSI;
     |FINSI;

     #998#19 = #998#17 + #998#18;
     #998#22 = #998#20 + #998#21;
     #998#59 = #998#58;
     #998#25 = #998#23 + #998#24;
     #998#28 = #998#19 - (#998#22 + #998#59) - #998#25;

     |PINTA #998#19;
     |PINTA #998#22;
     |PINTA #998#59;
     |PINTA #998#25;
     |PINTA #998#28;

     |SI #998#56 ! 7;  |Y #998#56 ! 12;  |Y #998#56 ! 17;
         #998#26 = #998#17 - (#998#20 + #998#58) - #998#23;
         #998#30 = #998#26 % #998#29;
         |SI #998#30 < 0;  #998#30 = 0;  |FINSI;

         #998#32 = #998#28 % #998#29;
         |SI #998#32 < 0;  #998#32 = 0;  |FINSI;
         #998#30 = #998#32 - #998#31;

         |SI #998#1 ] 2016; |Y eaComunidad ! "S";
             |HAZ RecogeTotalGastos;
         |FINSI;

         |SI #998#1 = 2015;
             nNume1 = #998#30 + #998#31;
             |SI nNume1 > 2000; |Y #998#1 ] 2015;
                 nNume1 = 2000 - #998#31;
                 #998#30  = nNume1;
             |FINSI;
         |FINSI;

         #998#33 = #998#26 - #998#30;

         |SI #998#61 = "S";     || Calculo con el total ejercicio
             nNume2 = ((#998#17 + #998#18) - ( #998#20 + #998#21) - #998#58 - (#998#23 + #998#24)) ! EURODBMOD;    || el total
             nNume3 = (nNume2 % #998#29) ! EURODBMOD;
             |SI #998#3 ! 99;
                 |SI nNume3 < 0;  nNume3 = 0;  |FINSI;
             |SINO;
                 |SI #998#17 = 0; |Y #998#18 = 0; |Y #998#20 = 0; |Y #998#21 = 0; |Y #998#58 = 0;
                     nNume3 = ((#998#23 + #998#24) % #998#29) ! EURODBMOD;
                 |FINSI;
             |FINSI;
             nNume4 = (nNume2 - nNume3) ! EURODBMOD;
             nNume5 = 0;
             |SI nNume4 > 0;
                 |HAZ TopeSueldos;
                 nTopeTr = (nTopeTr / 2) ! 2;
                 |SI Campo < 33; |O Campo = 61; |O Campo = 58;
                     nNume5 = (nNume4 % 20) ! EURODBMOD;
                     |SI nNume5 > nTopeTr; |Y nSwTope ! 0;
                         nNume5 = nTopeTr;
                     |FINSI;
                     #998#64 = nNume5;
                     #998#62 = #998#64 - #998#63;
                 |FINSI;
             |SINO;
                 |SI Campo < 33; |O Campo = 61; |O Campo = 58;
                     #998#64 = 0;
                     #998#62 = #998#64 - #998#63;
                 |FINSI;
             |FINSI;
         |SINO;
             #998#62 = 0;
         |FINSI;

         #998#64 = #998#63 + #998#62;
         #998#33 = #998#33 - #998#62;

         #998#37 = #998#33 % #998#36;
         |SI #998#37 < 0;  #998#37 = 0;  |FINSI;

         #998#28 = #998#19 - (#998#22 + #998#59) - #998#25;

         #998#32 = #998#28 % #998#29;
         |SI #998#32 < 0;  #998#32 = 0;  |FINSI;

         #998#32 = #998#30 + #998#31;
         |SI #998#32 > 2000; |Y #998#1 ] 2015;
             #998#32 = 2000;
         |FINSI;

         #998#35 = #998#28 - #998#32;
         #998#35 = #998#35 - #998#64;

         #998#39 = #998#35 % #998#36;
         |SI #998#39 < 0;  #998#39 = 0;  |FINSI;

         #998#42 = #998#40 + #998#41;
         #998#44 = #998#39 - #998#42 - #998#43;
         |SI #998#44 < 0;  #998#44 = 0;  |FINSI;

         |PINTA #998#26;
         |PINTA #998#28;
         |PINTA #998#30;
         |PINTA #998#32;
         |PINTA #998#62;
         |PINTA #998#64;
         |PINTA #998#33;
         |PINTA #998#35;
         |PINTA #998#37;
         |PINTA #998#39;
         |PINTA #998#42;
         |PINTA #998#43;
         |PINTA #998#44;
    |SINO;
         |PARA nCampo = 26;  |SI nCampo [ 39;  |HACIENDO nCampo = nCampo + 1;
               #998nCampo = 0;   |PINTA #998nCampo;
         |SIGUE;

         #998#41 = 0;
         #998#42 = 0;
         #998#26 = #998#17 % 2;

         #998#44 = 0;
         |SI #998#26 > 0;
             #998#44 = #998#26 - #998#40;
         |FINSI;
         |SI #998#44 < 0;  #998#44 = 0;  |FINSI;

         |PINTA #998#26;
         |PINTA #998#41;
         |PINTA #998#42;
         |PINTA #998#44;
    |FINSI;

     enEmpresa     = #998#0;
     enEjer        = #998#1;
     enPeriodo     = #998#2;

     |SI enEjer [ 2008;
         |SI #998#7    = "X";  enModelo = 300;  |FINSI;
         |SI #998#8    = "X";  enModelo = 370;  |FINSI;
         |SI #998#9    = "X";  enModelo = 320;  |FINSI;
         |SI #998#10   = "X";  enModelo = 330;  |FINSI;
         |SI #998#11   = "X";  enModelo = 332;  |FINSI;
     |SINO;
         |SI #998#7    = "X";  enModelo = 303;  |FINSI;
         |SI #998#8    = "X";  enModelo = 370;  |FINSI;
     |FINSI;

     enComplem     = #998#3;
     enActividad   = #998#4;

    |ABRE #400;
    nGrupo    = 1;
    nSubGrupo = 13;
    |HAZ LeeCasilla;
    #998#45 = #400#13;

    nGrupo    = 2;
    nSubGrupo = 12;
    |HAZ LeeCasilla;
    #998#46 = #400#13;
    |CIERRA #400;

    #998#47 = #998#45 - #998#46;

    |SI #998#7 = "X";
        |SI enEjer [ 2008;
            |ABRE #300;
            #300#0  = enEmpresa;
            #300#1  = enEjer;
            #300#2  = enPeriodo;
            #300#3  = enModelo;
            #300#4  = enComplem;
            #300#5  = 0;
            |LEE 040#300=;
            |SI FSalida ! 0;  |DDEFECTO #300;  |FINSI;
            |CIERRA #300;

            |ATRI I;
            |PINTA 1869, #300#33;
            |PINTA 1969, #300#55;
            |PINTA 2069, #300#56;
            |PINTA 2169, #300#59;
            |PINTA 2269, #300#62;
            |ATRI i;
        |FINSI;

        |SI enEjer ] 2009;  |Y enEjer [ 2013;
            |ABRE #303;
            #303#0  = enEmpresa;
            #303#1  = enEjer;
            #303#2  = enPeriodo;
            #303#3  = enModelo;
            #303#4  = enComplem;
            #303#5  = 0;
            |LEE 040#303=;
            |SI FSalida ! 0;  |DDEFECTO #303;  |FINSI;
            |CIERRA #303;

            |ATRI I;
            |PINTA 1869, #303#33;
            |PINTA 1969, #303#49;
            |PINTA 2069, #303#50;
            |PINTA 2169, #303#53;
            |PINTA 2269, #303#60;
            |ATRI i;
        |FINSI;

        |SI enEjer ] 2014;
            |ABRE #dsm30301;
            #dsm30301#0  = enEmpresa;
            #dsm30301#1  = enEjer;
            #dsm30301#2  = enPeriodo;
            #dsm30301#3  = enModelo;
            #dsm30301#4  = enComplem;
            #dsm30301#5  = 0;
            |LEE 040#dsm30301.=;
            |SI FSalida ! 0;  |DDEFECTO #dsm30301;  |FINSI;
            |CIERRA #dsm30301;

            |ATRI I;
            |PINTA 1869, #dsm30301#42;
            |PINTA 1969, #dsm30301#60;
            |PINTA 2069, #dsm30301#81;
            |PINTA 2169, #dsm30301#84;
            |PINTA 2269, #dsm30301#88;
            |ATRI i;
        |FINSI;
    |FINSI;

    |SI #998#8 = "X";
        |ABRE #370;
        #370#0  = enEmpresa;
        #370#1  = enEjer;
        #370#2  = enPeriodo;
        #370#3  = enModelo;
        #370#4  = enComplem;
        #370#5  = 0;
        |LEE 040#370=;
        |SI FSalida ! 0;  |DDEFECTO #370;  |FINSI;
        |CIERRA #370;

        #370#33 = #370#33 + #370#75;
        #370#55 = #370#55 + #370#78;

        |ATRI I;
        |PINTA 1869, #370#33;
        |PINTA 1969, #370#55;
        |PINTA 2069, #370#80;
        |PINTA 2169, #370#81;
        |PINTA 2269, #370#82;
        |ATRI i;
    |FINSI;

    |SI #998#9 = "X";
        |ABRE #320;
        #320#0  = enEmpresa;
        #320#1  = enEjer;
        #320#2  = enPeriodo;
        #320#3  = enModelo;
        #320#4  = enComplem;
        #320#5  = 0;
        |LEE 040#320=;
        |SI FSalida ! 0;  |DDEFECTO #320;  |FINSI;
        |CIERRA #320;

        |ATRI I;
        |PINTA 1869, #320#33;
        |PINTA 1969, #320#55;
        |PINTA 2069, #320#56;
        |PINTA 2169, #320#59;
        |PINTA 2269, #320#64;
        |ATRI i;
    |FINSI;

    |SI #998#10 = "X";
        |ABRE #330;
        #330#0  = enEmpresa;
        #330#1  = enEjer;
        #330#2  = enPeriodo;
        #330#3  = enModelo;
        #330#4  = enComplem;
        #330#5  = 0;
        |LEE 040#330=;
        |SI FSalida ! 0;  |DDEFECTO #330;  |FINSI;
        |CIERRA #330;

        |ATRI I;
        |PINTA 1869, #330#33;
        |PINTA 1969, #330#55;
        |PINTA 2069, #330#56;
        |PINTA 2169, #330#59;
        |PINTA 2269, #330#66;
        |ATRI i;
    |FINSI;

    |SI #998#11 = "X";
        |ABRE #332;
        #332#0  = enEmpresa;
        #332#1  = enEjer;
        #332#2  = enPeriodo;
        #332#3  = enModelo;
        #332#4  = enComplem;
        #332#5  = 0;
        |LEE 040#332=;
        |SI FSalida ! 0;  |DDEFECTO #332;  |FINSI;
        |CIERRA #332;

        |ATRI I;
        |PINTA 1869, #332#33;
        |PINTA 1969, #332#55;
        |PINTA 2069, #332#56;
        |PINTA 2169, #332#59;
        |PINTA 2269, #332#66;
        |ATRI i;
    |FINSI;

    |PINTA #998#45;
    |PINTA #998#46;
    |PINTA #998#47;
    nTecla = 0;
|FPRC;

|PROCESO Pregunta65;
  enModo65 = 2;
  |SI nTecla = 16;
      enModo65 = 4;
      enImpo65 = #998Campo;
      |SI Campo = 17; eaTipo65 = "I"; |FINSI;
      |SI Campo = 20; eaTipo65 = "C"; |FINSI;
      |SI Campo = 58; eaTipo65 = "C"; |FINSI;
      |SI Campo = 23; eaTipo65 = "G"; |FINSI;
      |SI Campo = 45; eaTipo65 = "V"; |FINSI;
  |FINSI;
  enRec65  = 0; |SI #998#66 = "S"; enRec65 = 1; |FINSI;
  eaHay130 = #998#14;
  eaHay303 = #998#7;
  |BLIN 4;
  |SUB_EJECUTA "dsmom065";
  |SI nTecla = 15;
      |SI eaHay303 = "X";
          enModelo    = 303;
          enModelo1   = 303;
          enPlanillas = 2;
          |SUB_EJECUTA_NP "dsmozpas";
          enPlanillas   = 0;
      |FINSI;

      |SI eaHay130 = "X";
          nTopeTr = 0;
          #998#17 = 0;
          #998#20 = 0;
          #998#58 = 0;
          #998#23 = 0;
          |BUCLE dsmom010w6;
          |BUCLE dsmom012w6;
          |BUCLE dsmom013w6;
          |PINTA #998#17; |PINTA #998#18;
          |PINTA #998#19; |PINTA #998#20;
          |PINTA #998#21; |PINTA #998#22;
          |PINTA #998#58; |PINTA #998#23;
          |PINTA #998#24; |PINTA #998#25;
      |FINSI;

      nSwFa = 1;
      |HAZ Totalesw006;
      nSwFa = 0;

  |FINSI;
  #998#66 = "N"; |SI enRec65 = 1; #998#66 = "S"; |FINSI;
|FPRC;

|PROCESO Tipo12w006;  |TIPO 12;
      |SI #998#1 = 2015;
          |SI #998#62 ! 0;
              |MENAV "0000Hay Importe en la Reduccion por creacion de empleo, no es correcto para Ejer. 2015.";
          |SINO;
              #998#61 = "N";
          |FINSI;
      |FINSI;
|FPRC;
