|FICHEROS;
     dsm190li;
     dsm19001;
     dsmom006;
     dsmom026;
     dsmom030;

     :/basica/def/agidanif;
     :/laboral/def/labtraba;
     :/laboral/def/nomir003;
     :/laboral/def/nomir012;
     :/laboral/def/nomhicca;
     :/laboral/def/nomauto2;
     :/laboral/def/nomnotay;

     :/contagen/def/canempre;
     :/contagen/def/camaniva;
     :/contagen/def/caivalin;
     :/contagen/def/caivaasi;

     :/basica/def/agitab99;

     &linea190@;
     &regisnif@;
|FIN;

|VARIABLES;
      aAlfa         = "";
      nActual       = 0;
      aCadena       = "";
      aCadena1      = "";
      aCadena2      = "";
      aCadena3      = "";
      aCaracter     = "";
      aLongAlfa     = "";
      aParaQuitar   = "";
      aPathLaboral  = "";
      &eaPathLaboral  = "";
      aFichLaboral  = "";
      aBase         = "";
      aNif          = "";
      aNIF          = "";

      nBlanco1      = 0;
      nBlanco2      = 0;
      nComa         = 0;
      nPara         = 0;
      nPosi         = 0;
      nLongNume     = 0;
      nCanal        = 0;
      nEjer         = 0;
      nLinea        = 0;
      nCampo        = 0;
      nCampo1       = 0;
      nCampo2       = 0;
      nAnyo         = 0;
      nEdad         = 0;
      nEdadAdop     = 0;
      nEmpresa      = 0;
      nEmpresaTrab  = 0;
      nEmpMadre     = 0;
      nDTipo        = 0;
      nHTipo        = 0;
      nError        = 0;
      nGrupos       = 0;
      ded_not       = 0;
      notaria       = 0;
      nVivienda     = 0;
      nConta        = 0;
      nEstado       = 0;

      &enError      = 0;
      nSw           = 0;
      aElDef        = "";
      &enTRela      = 0;
      &enBRela      = 0;
      &enSwPartir   = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO QuitaBlanco;
     |ET aCadena;
         |QBF aParaQuitar;
         |SI aParaQuitar ! "";
             aCaracter = aParaQuitar % 101;
             |SI aCaracter = " ";
                 aParaQuitar = aParaQuitar % 240;
                 |VETE aCadena;
             |FINSI;
         |FINSI;
|FPRC;

|PROCESO SeparaNombre;
     || Busca una coma en la aCadena

     aCadena1 = "";
     aCadena2 = "";
     aCadena3 = "";

     nBlanco1 = 0;
     nBlanco2 = 0;
     nComa    = 0;

     |PARA nPara = 1; |SI nPara [ 40; |HACIENDO nPara = nPara + 1;
           nPosi = nPara * 100 + 1;
           aCaracter = aCadena % nPosi;

           |SI aCaracter = ","; nComa = nPara; |SAL; |FINSI;
     |SIGUE;

     |SI nComa = 0;
         || Si no hay coma busca el primer blanco empezando por detras

         aLongAlfa = aCadena % 0;
         nLongNume = aLongAlfa;

         |PARA nPara = nLongNume; |SI nPara ] 1; |HACIENDO nPara = nPara - 1;
               nPosi = nPara * 100 + 1;
               aCaracter = aCadena % nPosi;
               |SI aCaracter = " "; nComa = nPara; |SAL; |FINSI;
         |SIGUE;
     |FINSI;

     || Coge los dos primeros aCaracteres del segundo apellido

     nBlanco1  = nComa - 1;
     nPosi     = nBlanco1 + 100;
     aCadena2  = aCadena % nPosi;
     aLongAlfa = aCadena2 % 0;
     nLongNume = aLongAlfa;

     |PARA nPara = nLongNume; |SI nPara ] 1; |HACIENDO nPara = nPara - 1;
           nPosi = nPara * 100 + 1;
           aCaracter = aCadena2 % nPosi;
           |SI aCaracter = " "; nBlanco1 = nPara; |SAL; |FINSI;
     |SIGUE;

     nBlanco1 = nBlanco1 + 1;
     nPosi    = nBlanco1 * 100 + nLongNume;
     aCadena2 = aCadena2 % nPosi;

     || Coge las dos primeros caracteres del primer apellido

     nBlanco1 = nBlanco1 - 1;
     nPosi    = 100 + nBlanco1;
     aCadena1 = aCadena % nPosi;

     || Recoge los dos primero aCaracteres de Nombre

     nPosi    = ((nComa + 1) * 100) + 40;
     aCadena3 = aCadena % nPosi;

     aParaQuitar = aCadena1; |HAZ QuitaBlanco; aCadena1 = aParaQuitar;
     aParaQuitar = aCadena2; |HAZ QuitaBlanco; aCadena2 = aParaQuitar;
     aParaQuitar = aCadena3; |HAZ QuitaBlanco; aCadena3 = aParaQuitar;

     |QBF aCadena1;
     |QBF aCadena2;
     |QBF aCadena3;
|FPRC;

|PROCESO DatosConyuge;
     #agidanif#0 = #linea190@#6;
     #agidanif#1 = 99;
     |LEE 010#agidanif.];
     |SI FSalida = 0;
         |LEE 040#agidanif.a;
     |SINO;
         |LEE 040#agidanif.u;
     |FINSI;

     nLinea = 1;
     |SI FSalida = 0;  |Y #agidanif#0 = #linea190@#6;
         nLinea = #agidanif#1 + 1;
     |FINSI;

     eaCodNif  = aNif;
     |HAZ LeeNifs;

     |DDEFECTO #agidanif;
     #agidanif#0  = #linea190@#6;
     #agidanif#1  = nLinea;
     #agidanif#2  = "CONYUGE";
     #agidanif#8  = aNif;
     #agidanif#12 = #regisnif@#1;
     #agidanif#19 = #regisnif@#14;
     #agidanif#24 = #regisnif@#9;
     #agidanif#25 = #regisnif@#2;
     #agidanif#26 = #regisnif@#3;
     #agidanif#27 = #regisnif@#16;
     #agidanif#28 = #regisnif@#10;
     #agidanif#29 = #regisnif@#11;
     #agidanif#30 = #regisnif@#4;
     #agidanif#31 = #regisnif@#5;
     #agidanif#32 = #regisnif@#6;
     #agidanif#33 = #regisnif@#7;
     #agidanif#34 = #regisnif@#8;

     aCadena = #agidanif#12;
     |HAZ SeparaNombre;
     #agidanif#9    = aCadena1;
     #agidanif#10   = aCadena2;
     #agidanif#11   = aCadena3;
     #agidanif#14   = "C";
     #agidanif#37   = "S";

     |GRABA 020#agidanif.n;
|FPRC;

|PROCESO DatosDescendiente;
     #agidanif#0 = #linea190@#6;
     #agidanif#1 = 99;
     |LEE 010#agidanif.];
     |SI FSalida = 0;
         |LEE 040#agidanif.a;
     |SINO;
         |LEE 040#agidanif.u;
     |FINSI;

     nLinea = 0;
     |SI FSalida = 0;  |Y #agidanif#0 = #linea190@#6;
         nLinea = #agidanif#1;
     |FINSI;

     |PARA nCampo = 20;  |SI nCampo [ 29;  |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo + 10;
           nCampo2 = nCampo + 22;

           |SI #nomir003#nCampo# ! 0;
               nLinea  = nLinea + 1;

               |DDEFECTO #agidanif;
               #agidanif#0  = #linea190@#6;
               #agidanif#1  = nLinea;
               #agidanif#2  = "DESCENDIENTE";

               |SI #nomir003#nCampo2# = "S";  #agidanif#3 = "1";  |FINSI;

               #agidanif#12 = "POR ACTUALIZAR";
               aAlfa = "01.01." + #nomir003#nCampo#;
               #agidanif#13 = aAlfa;
               |SI #nomir003#nCampo1# = "1";
                   #agidanif#17 = 33;
               |FINSI;
               |SI #nomir003#nCampo1# = "2";
                   #agidanif#17 = 65;
               |FINSI;
               |GRABA 020#agidanif.n;
               |LIBERA #agidanif;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO DatosAscendiente;
     #agidanif#0 = #linea190@#6;
     #agidanif#1 = 99;
     |LEE 010#agidanif.];
     |SI FSalida = 0;
         |LEE 040#agidanif.a;
     |SINO;
         |LEE 040#agidanif.u;
     |FINSI;

     nLinea = 0;
     |SI FSalida = 0;  |Y #agidanif#0 = #linea190@#6;
         nLinea = #agidanif#1;
     |FINSI;

     |PARA nCampo = 52;  |SI nCampo [ 61;  |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo + 10;
           nCampo2 = nCampo + 43;

           |SI #nomir003#nCampo2# ! 0;
               nLinea  = nLinea + 1;

               |DDEFECTO #agidanif;
               #agidanif#0  = #linea190@#6;
               #agidanif#1  = nLinea;
               #agidanif#2  = "ASCENDIENTE";
               #agidanif#3  = "1";
               #agidanif#5  = #nomir003#nCampo#;

               #agidanif#12 = "POR ACTUALIZAR";

               |SI #nomir003#nCampo1# = "1";
                   #agidanif#17 = 33;
               |FINSI;

               |SI #nomir003#nCampo1# = "2";
                   #agidanif#17 = 65;
               |FINSI;
               |GRABA 020#agidanif.n;
               |LIBERA #agidanif;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO nomauto2;
     |ABRE #nomauto2;
     #nomauto2#0 = #labtraba#0;
     #nomauto2#1 = #labtraba#1;
     #nomauto2#2 = nEjer + 2000;
     |LEE 000#nomauto2.=;
     |SI FSalida = 0;
          |PARA nCampo = 4; |SI nCampo [ 26; |HACIENDO nCampo = nCampo + 2;
               enImporte2 = enImporte2 + #nomauto2#nCampo#;
          |SIGUE;
     |FINSI;
     |CIERRA #nomauto2;
|FPRC;

|PROCESO nomhiccaP;
     |ABRE #nomnotay;
     #nomnotay#0 = nEmpresa;
     #nomnotay#1 = #labtraba#77;
     |LEE 000#nomnotay.=;
     |SI FSalida ! 0;
         #nomnotay#2 = 0;       || (%) a cero
     |FINSI;
     notaria = #nomnotay#2;
     |CIERRA #nomnotay;

     ded_not      = (#nomhicca#48 < notaria) ! 2;
     enImporte2   = enImporte2 + (ded_not + #nomhicca#49 + #nomhicca#50 + #nomhicca#51);

     nEmpresaTrab = #labtraba#0;
|FPRC;

|DEFBUCLE nomhiccaP;
     #nomhicca#1;
     ;
     #labtraba#0, #labtraba#1, nEjer, 01, nDTipo;
     #labtraba#0, #labtraba#1, nEjer, 12, nHTipo;
     ;
     NULL, nomhiccaP;
|FIN;

|PROCESO labtraba;
     |SI #linea190@#1 ] 2011; |Y enBRela = 0;
         |SI #linea190@#8 = "A"; |O #linea190@#8 = "L";
             |SI #labtraba#111 ! enTRela;  |ACABA;  |FINSI;
         |FINSI;
     |FINSI;

     aAlfa   = #linea190@#1;
     aAlfa   = aAlfa % -102;
     nEjer   = aAlfa;
     nDTipo  = 0;
     nHTipo  = 20;

     |SI #linea190@#7 ! 0;
         nDTipo = 5;
         nHTipo = 20;
         aAlfa  = #linea190@#7;
         aAlfa  = aAlfa % -102;
         nEjer  = aAlfa;
     |FINSI;

     nEmpresaTrab = #labtraba#0;
     |BUCLE nomhiccaP;
     |SI #labtraba#42 = "H";
          |HAZ nomauto2;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#5;
     ;
     nEmpresa, aNIF;
     nEmpresa, aNIF;
     ;
     NULL, labtraba;
|FIN;

|PROCESO ProNomir003;
     nEmpresa = #dsmom026#1;
     nError = 0;
     |DDEFECTO #nomir003;
     |PARA nEjer = #linea190@#1;  |SI nEjer ] 2005;  |HACIENDO nEjer = nEjer - 1;
           #nomir003#0  = #linea190@#6;
           #nomir003#40 = nEjer;
           #nomir003#41 = nEmpresa;
           |LEE 040#nomir003.=;
           |SI FSalida = 0;
               |SI #nomir003#40 = #linea190@#1;
                    enImporte1 = #nomir003#10;
                    enImporte3 = #nomir003#13;
                    enImporte4 = #nomir003#12;
                    |SI enTRela = #nomir003#5; |O enBRela ! 0;
                       |SI enImporte2 = 0; |Y #linea190@#7 = 0;
                           enImporte2 = #nomir003#11;
                       |FINSI;
                   |FINSI;
               |FINSI;
               |SI nActual = 0; |O nActual < nEjer;
                   |SI #nomir003#3 ! 0;
                       #agidanif#15 = #nomir003#3;
                       #agidanif#16 = #nomir003#2;
                       |SI #nomir003#6 = "N";
                           #agidanif#17 = 0;
                           #agidanif#18 = "N";
                       |SINO;
                           |SI #nomir003#7 = "1";
                               #agidanif#17 = 33;
                           |SINO;
                               #agidanif#17 = 65;
                           |FINSI;

                           #agidanif#18 = #nomir003#8;
                       |FINSI;
                       |SI #nomir003#14 = "N";  |O #nomir003#14 = " ";  |O #nomir003#14 = "1";
                           #agidanif#23 = "";
                       |SINO;
                            #agidanif#23 = "1";
                       |FINSI;
                       nActual = nEjer;
                   |FINSI;
               |FINSI;
               nError = 0;
               |SAL;
           |SINO;
               nError = 1;
           |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmom026_3;
     #dsmom026#1;
     ;
     nEmpMadre, 00001;
     nEmpMadre, 99999;
     ;
     NULL, ProNomir003;
|FIN;

|PROCESO MiraGrupos;
     |ABRE #labtraba;
     |SELECT #5#labtraba;
     #labtraba#0 = #dsmom026#1;
     #labtraba#7 = #linea190@#6;
     |LEE 040#labtraba.=;
     |SI FSalida = 0;
        |CIERRA #labtraba;
        nGrupos      = 1;
        nEmpresa     = #labtraba#0;
        nEmpresaTrab = 0;
        aNIF         = #linea190@#6;
        |BUCLE labtraba;
     |SINO;
        |CIERRA #labtraba;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom026;
     #dsmom026#1;
     ;
     nEmpMadre, 00001;
     nEmpMadre, 99999;
     ;
     NULL, MiraGrupos;
|FIN;

|PROCESO nomir012;
     nVivienda = #nomir012#100;
|FPRC;

|DEFBUCLE nomir012;
     #nomir012#3;
     ;
     aNIF, nEmpresaTrab, enEjer, 01;
     aNIF, nEmpresaTrab, enEjer, 12;
     ;
     NULL, nomir012;
|FIN;

|PROCESO DesdeLaboral;
     nGrupos   = 0;
     aFichLaboral = aPathLaboral + "fich/";
     |PATH_DAT #nomir003#aFichLaboral#;
     |PATH_DAT #nomir012#aFichLaboral#;
     |PATH_DAT #nomhicca#aFichLaboral#;
     |PATH_DAT #nomauto2#aFichLaboral#;
     |PATH_DAT #nomnotay#aFichLaboral#;

     |ABRE #dsmom026;
     #dsmom026#0 = #linea190@#0;
     #dsmom026#1 = 0;
     |LEE 040#dsmom026.];
     |SI FSalida = 0;  |Y #dsmom026#0 = #linea190@#0;
         |CIERRA #dsmom026;
         enImporte2 = 0;
         nEmpMadre  = #linea190@#0;
         |BUCLE dsmom026;

         |SI nGrupos = 0;
             nEmpresa     = #linea190@#0;
             nEmpresaTrab = #linea190@#0;
             |ABRE #labtraba;
             |SELECT #5#labtraba;
             #labtraba#0    = #linea190@#0;
             #labtraba#7    = #linea190@#6;
             |LEE 040#labtraba.=;
             |SI FSalida ! 0;  |DDEFECTO #labtraba; |FINSI;
             |CIERRA #labtraba;
         |FINSI;
     |SINO;
         |CIERRA #dsmom026;

         nEmpresa     = #linea190@#0;
         nEmpresaTrab = #linea190@#0;

         |ABRE #labtraba;
         |SELECT #5#labtraba;
         #labtraba#0       = #linea190@#0;
         #labtraba#7       = #linea190@#6;
         |LEE 040#labtraba.=;
         |SI FSalida ! 0;  |DDEFECTO #labtraba; |FINSI;
         |CIERRA #labtraba;
     |FINSI;

     eaCodNif  = #linea190@#6;
     |HAZ LeeNifs;

     |ABRE #regisnif@;
     #regisnif@#0 = #linea190@#6;
     |LEE 101#regisnif@.=;
     |SI FSalida ! 0;
         |DDEFECTO #regisnif@;
         #regisnif@#0 = #linea190@#6;
         #regisnif@#1 = #labtraba#2;
         #regisnif@#4 = #labtraba#8;
         |GRABA 020#regisnif@.n;
         |LIBERA #regisnif@;
     |FINSI;
     |CIERRA #regisnif@;

     nEstado = 0;
     #agidanif#0 = #linea190@#6;
     #agidanif#1 = 1;
     |LEE 010#agidanif.=;
     |SI FSalida ! 0;
         eaCodNif  = #linea190@#6;
         |HAZ LeeNifs;

         |DDEFECTO #agidanif;
         #agidanif#0  = #linea190@#6;
         #agidanif#1  = 1;
         #agidanif#2  = "TITULAR";
         #agidanif#8  = #linea190@#6;
         #agidanif#12 = #regisnif@#1;
         #agidanif#19 = #regisnif@#14;
         #agidanif#24 = #regisnif@#9;
         #agidanif#25 = #regisnif@#2;
         #agidanif#26 = #regisnif@#3;
         #agidanif#27 = #regisnif@#16;
         #agidanif#28 = #regisnif@#10;
         #agidanif#29 = #regisnif@#11;
         #agidanif#30 = #regisnif@#4;
         #agidanif#31 = #regisnif@#5;
         #agidanif#32 = #regisnif@#6;
         #agidanif#33 = #regisnif@#7;
         #agidanif#34 = #regisnif@#8;

         aCadena = #agidanif#12;
         |HAZ SeparaNombre;
         #agidanif#9    = aCadena1;
         #agidanif#10   = aCadena2;
         #agidanif#11   = aCadena3;
         #agidanif#37   = "S";

         |GRABA 020#agidanif.b;
         nEstado = 1;
     |FINSI;

     |ABRE #labtraba;
     |SELECT #5#labtraba;
     #labtraba#0 = nEmpresaTrab;
     #labtraba#7 = #linea190@#6;
     |LEE 040#labtraba.=;
     |SI FSalida ! 0;
         |DDEFECTO #labtraba;
         |GRABA 020#agidanif.a;
         |LIBERA #agidanif;
         |ACABA;
     |FINSI;
     |CIERRA #labtraba;

     eaNifRepresentante = #labtraba#22;
     eaCodNif  = #linea190@#6;
     |HAZ LeeNifs;
     aAlfa = #regisnif@#1;  |QBT aAlfa;
     |SI aAlfa = "";
         #agidanif#12 = #labtraba#2;

         |ABRE #regisnif@;
         #regisnif@#0 = #linea190@#6;
         |LEE 101#regisnif@.=;
         |SI FSalida = 0;
             #regisnif@#1 = #labtraba#2;
             #regisnif@#4 = #labtraba#8;
             |GRABA 020#regisnif@.a;
             |LIBERA #regisnif@;
         |FINSI;
         |CIERRA #regisnif@;
     |FINSI;

     enError = 0;
     |SI #agidanif#13 [ "01.01.0000";
         #agidanif#13 = #labtraba#11;
     |FINSI;

     enImporte1 = 0;
     enImporte3 = 0;
     enImporte4 = 0;

     |SI nGrupos = 0;
         enImporte2 = 0;
         aAlfa   = #linea190@#1;
         aAlfa   = aAlfa % -102;
         nEjer   = aAlfa;
         aNIF    = #linea190@#6;
         |BUCLE labtraba;
     |FINSI;
     nActual = 0;
     |ABRE #nomir003;
     |ABRE #dsmom026;
     #dsmom026#0 = #linea190@#0;
     #dsmom026#1 = 0;
     |LEE 040#dsmom026.];
     |SI FSalida = 0;  |Y #dsmom026#0 = #linea190@#0;
         |CIERRA #dsmom026;
         nEmpMadre  = #linea190@#0;
         |BUCLE dsmom026_3;
     |SINO;
         |CIERRA #dsmom026;

         #dsmom026#1  = #linea190@#0;
         |HAZ ProNomir003;
     |FINSI;
     |CIERRA #nomir003;

     |SI #agidanif#15 = 1;
         #agidanif#14 = "S";
     |FINSI;

     |SI #agidanif#15 = 2;
         #agidanif#14 = "C";
     |FINSI;

     |SI #linea190@#1 ] 2009; |Y nEstado = 1;
         nVivienda = 0;
         aNIF      = #linea190@#6;
         |BUCLE nomir012;
         #agidanif#43 = "N";
         |SI nVivienda ! 0;
             #agidanif#43 = "S";
         |FINSI;
     |FINSI;

     |GRABA 020#agidanif.a;
     |LIBERA #agidanif;

     |SI nError = 1;  |ACABA;  |FINSI;

     |SI #agidanif#15 = 2;
         |SELECT #2#agidanif;
         #agidanif#0 = #linea190@#6;
         #agidanif#2 = "CONYUGE";
         |LEE 040#agidanif.=;
         |SI FSalida ! 0;
             nLinea = 0;
         |SINO;
             nLinea = #agidanif#1;
         |FINSI;
     |FINSI;

     |SELECT #1#agidanif;
     |SI nLinea = 0;  |Y #agidanif#14 = "C";
         aNif = #nomir003#4;  |QBF aNif;
         |SI aNif ! "";
             |HAZ DatosConyuge;
         |FINSI;
     |FINSI;

     |SELECT #2#agidanif;
     #agidanif#0 = #linea190@#6;
     #agidanif#2 = "DESCENDIENTE";
     |LEE 040#agidanif.=;
     |SI FSalida ! 0;
         nLinea = 0;
     |SINO;
         nLinea = #agidanif#1;
     |FINSI;

     |SELECT #1#agidanif;
     |SI nLinea = 0;
         aNif = #nomir003#4;
         |HAZ DatosDescendiente;
     |FINSI;

     |SELECT #2#agidanif;
     #agidanif#0 = #linea190@#6;
     #agidanif#2 = "ASCENDIENTE";
     |LEE 040#agidanif.=;
     |SI FSalida ! 0;
         nLinea = 0;
     |SINO;
         nLinea = #agidanif#1;
     |FINSI;

     |SELECT #1#agidanif;
     |SI nLinea = 0;
         aNif = #nomir003#4;
         |HAZ DatosAscendiente;
     |FINSI;
|FPRC;

||///////////////////////////////////
|PROCESO LeeLinea190;
     #dsmom030#0 = #caivalin#18;
     |LEE 000#dsmom030.=;
     |SI FSalida!0;
         #dsmom030#0 = #caivalin#3;
         |LEE 000#dsmom030.=;
         |SI FSalida!0;
             |ACABA;
         |FINSI;
     |FINSI;
     |SI #dsmom030#5  = "G";
         enImporte2 = enImporte2 + #caivalin#11;  || sumo los descuentos S.Social
     |FINSI;
|FPRC;

|DEFBUCLE caivalin190;
     #caivalin#1;
     ;
     #camaniva#0, #camaniva#1, 01;
     #camaniva#0, #camaniva#1, 99;
     e;
     NULL, LeeLinea190;
|FIN;

|PROCESO LeeCabecera190;
     |BUCLE caivalin190;
|FPRC;

|DEFBUCLE camaniva190;
     #camaniva#1;
     14,36;
     00, 0000000000, aAlfa, "N";
     99, 9999999999, aAlfa, "N";
     e;
     NULL, LeeCabecera190;
|FIN;

|PROCESO PorContagen;
     aAlfa = #linea190@#6 + "   "; || el nif en camaniva esta a longitud 15
     |SI enSwPartido = 0;
         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";

         enEmpresa  = nEmpresa;
         enPerConta = #canempre#3;
         eaLaMonEmp = #canempre#28;
      |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
      |FINSI;
      |HAZ EnConversor;

     |PATH_DAT #camaniva#aPathConta#;
     |PATH_DAT #caivalin#aPathConta#;
     |PATH_DAT #caivaasi#aPathConta#;

     |ABRE #caivaasi;
     |DDEFECTO #caivaasi;
     |LEE 000#caivaasi.p;
     |CIERRA #caivaasi;

     |ABRE #dsmom030;
     |BUCLE camaniva190;
     |CIERRA #dsmom030;

||     |SI enSwPartido = 1;
||         enSwOpPar   = 2;
||         |HAZ FinalPartido;
||     |FINSI;
|FPRC;

|PROCESO DesdeConta_c;
       enPartido = enSwPartir;
       aAlfa     = #linea190@#1;
       aAlfa     = aAlfa % -102;
       nEjer     = aAlfa;
       enEmpresa = nEmpresa;
       enSwOpPar = 0;
       nSw       = 0;
       |HAZ SituaEmpresa;
       |SI enSwPartido = 0;
           |ABRE #canempre;
           |SELECT #4#canempre;
           #canempre#2  = nEmpresa;
           #canempre#26 = nEjer;
           |LEE 040#canempre.=;
           |SI FSalida = 0; nSw = 1; |FINSI;
           |CIERRA #canempre;
       |SINO;
            nSw = 1;
       |FINSI;
       |SI nSw = 1;
           |HAZ PorContagen;
       |FINSI;
       enEmpresa = #linea190@#0;
|FPRC;

|PROCESO dsmom026_c;
     nEmpresa = #dsmom026#1;
     |HAZ DesdeConta_c;
|FPRC;

|DEFBUCLE dsmom026_c;
     #dsmom026#1;
     ;
     nEmpMadre, 00001;
     nEmpMadre, 99999;
     ;
     NULL, dsmom026_c;
|FIN;

|PROCESO DesdeContaEsp;
     aPathConta  = "";
     |DBASS aBase; |QBT aBase;
     aElDef = aBase + "contagen/def/";
     aElDef = aElDef + "canempre.mas";
     |XABRE "E", aElDef, nCanal;
     |SI FSalida ] 0;
         aPathConta = aBase + "contagen/fich/";
     |FINSI;
     |XCIERRA nCanal;
     |SI aPathConta = ""; |ACABA; |FINSI; ||tampoco hay contabilidad

     |ABRE #dsmom026;
     #dsmom026#0 = #linea190@#0;
     #dsmom026#1 = 0;
     |LEE 040#dsmom026.];
     |SI FSalida = 0;  |Y #dsmom026#0 = #linea190@#0;
         |CIERRA #dsmom026;
         enImporte2 = 0;
         nEmpMadre  = #linea190@#0;
         |BUCLE dsmom026_c;
     |SINO;
         |CIERRA #dsmom026;
         nEmpresa     = #linea190@#0;
         nEmpresaTrab = #linea190@#0;
         |HAZ DesdeConta_c;
     |FINSI;
     enError    = 0;
     enSwPartir = 1;
|FPRC;

|PROCESO RecogeDatosNif;
    eaNifRepresentante = "";
    |SI aPathLaboral ! "";
         |HAZ DesdeLaboral;
    |SINO;
         |ABRE #agitab99;
         #agitab99#0 = 110;
         |LEE 040#agitab99.=;
         |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;
         |CIERRA #agitab99;

         |ABRE #dsmom006;
         #dsmom006#0 = #linea190@#0;
         #dsmom006#1 = 110;
         |LEE 041#dsmom006.=;
         |SI FSalida = 0;
             |SI #dsmom006#13 ! " "; |Y #dsmom006#13 ! "X";
                 #agitab99#8 = #dsmom006#13;  ||Pase Modelo 110 particular de esta Empresa
             |FINSI;
         |FINSI;
         |CIERRA #dsmom006;

         |SI #agitab99#8 = "S"; |HAZ DesdeContaEsp; |FINSI;
    |FINSI;
|FPRC;

|PROCESO GrabaDatosNif;
     |SI enEjer [ 2015;
         |REFERENCIA_DEF linea190@, #dsm190li;
     |FINSI;

     |SI enEjer ] 2016;
         |REFERENCIA_DEF linea190@, #dsm19001;
     |FINSI;

     |DBASS aBase;   |QBF aBase;

     aPathLaboral = "";
     aAlfa        = aBase + "laboral/def/labempre.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         aPathLaboral = aBase + "laboral/";
     |FINSI;
     eaPathLaboral = aPathLaboral;

     |ABRET #agidanif;
     #agidanif#0 = #linea190@#6;
     #agidanif#1 = 1;
     |LEE 040#agidanif.=;

     |HAZ RecogeDatosNif;

     |CIERRAT #agidanif;
|FPRC;

|PROCESO CargaDatos2002;
     |SI #agidanif#2 = "TITULAR     ";
         aAlfa = #agidanif#13 % -104;
         #linea190@#14 = aAlfa;
         #linea190@#15 = #agidanif#23;
         #linea190@#25 = 0;
         |SI #agidanif#17 ] 33;
             #linea190@#25 = 1;
             |SI #agidanif#18 = "S";
                 #linea190@#25 = 2;
             |FINSI;
         |FINSI;

         |SI #agidanif#17 ] 65;
             #linea190@#25 = 3;
         |FINSI;

         #linea190@#26 = #agidanif#15;
     |FINSI;

     |SI #agidanif#2 = "CONYUGE     ";
         |SI #linea190@#26 = 2;
             #linea190@#27 = #agidanif#8;
         |FINSI;
     |FINSI;

     |SI #agidanif#2 = "DESCENDIENTE";
         |SI #agidanif#3 = "1";
             #linea190@#28 = #linea190@#28 + 1;
         |FINSI;

         aAlfa = #agidanif#13 % -104;
         nAnyo = aAlfa;
         nEdad = #linea190@#1 - nAnyo;
         |SI #agidanif#17 ] 65;
             #linea190@#33 = #linea190@#33 + 1;
         |SINO;
             |SI #agidanif#17 ] 33;
                 #linea190@#32 = #linea190@#32 + 1;
             |SINO;
                 |SI nEdad ] 0;
                     |SI nEdad < 3;                 #linea190@#29 = #linea190@#29 + 1;  |FINSI;
                     |SI nEdad ] 3;  |Y nEdad < 16; #linea190@#30 = #linea190@#30 + 1;  |FINSI;
                     |SI nEdad ] 16; |Y nEdad < 25; #linea190@#31 = #linea190@#31 + 1;  |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #agidanif#2 = "ASCENDIENTE ";
         |SI #agidanif#3 = "1";
             #linea190@#35 = #linea190@#35 + 1;
         |FINSI;

         |SI #agidanif#3 = "1";  |O #agidanif#3 = " ";
             #linea190@#38 = #linea190@#38 + 1;
         |FINSI;

         |SI #agidanif#17 ] 65;
             #linea190@#37 = #linea190@#37 + 1;
         |SINO;
             |SI #agidanif#17 ] 33;
                 #linea190@#36 = #linea190@#36 + 1;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CargaDatos2003;
     |SI #agidanif#2 = "TITULAR     ";
         aAlfa = #agidanif#13 % -104;
         #linea190@#14 = aAlfa;
         |SI #agidanif#23 = " ";  #linea190@#15 = 0;  |FINSI;
         |SI #agidanif#23 = "1";  #linea190@#15 = 1;  |FINSI;
         |SI #agidanif#23 = "2";  #linea190@#15 = 1;  |FINSI;
         #linea190@#25 = 0;

         |SI #agidanif#17 ] 33;
             #linea190@#25 = 1;
             |SI #agidanif#18 = "S";
                 #linea190@#25 = 2;
             |FINSI;
         |FINSI;

         |SI #agidanif#17 ] 65;
             #linea190@#25 = 3;
         |FINSI;

         #linea190@#26 = #agidanif#15;
         #linea190@#39 = #agidanif#38;
         #linea190@#40 = #agidanif#39;
         #linea190@#64 = "0";

         |SI enEjer [ 2015;
             #linea190@#65 = #agidanif#57;
         |FINSI;

         |SI #agidanif#43 = "S";  #linea190@#64 = "1";  |FINSI;
     |FINSI;

     |SI #agidanif#2 = "CONYUGE     ";
         |SI #linea190@#26 = 2;
             #linea190@#27 = #agidanif#8;
         |FINSI;
     |FINSI;

     |SI #agidanif#2 = "DESCENDIENTE";
         aAlfa = #agidanif#13 % -104;
         nAnyo = aAlfa;
         nEdad = #linea190@#1 - nAnyo;

         |SI #agidanif#41 ! 0;
             nEdadAdop = #linea190@#1 - #agidanif#41;
             |SI nEdadAdop < 3;  nEdad = nEdadAdop;  |FINSI;
         |FINSI;

         |SI nEdad ] 0;
             |SI #agidanif#17 ] 65;
                                  #linea190@#49 = #linea190@#49 + 1;
                 |SI #agidanif#3 = "1";  #linea190@#50 = #linea190@#50 + 1;  |FINSI;

                 |SI nEdad < 3;
                                      #linea190@#41 = #linea190@#41 + 1;
                     |SI #agidanif#3 = "1";  #linea190@#42 = #linea190@#42 + 1;  |FINSI;
                 |SINO;
                                      #linea190@#43 = #linea190@#43 + 1;
                     |SI #agidanif#3 = "1";  #linea190@#44 = #linea190@#44 + 1;  |FINSI;
                 |FINSI;
             |SINO;
                 |SI #agidanif#17 ] 33;
                                      #linea190@#45 = #linea190@#45 + 1;
                     |SI #agidanif#3 = "1";  #linea190@#46 = #linea190@#46 + 1;      |FINSI;

                     |SI #agidanif#18 = "S";
                                          #linea190@#47 = #linea190@#47 + 1;
                         |SI #agidanif#3 = "1";  #linea190@#48 = #linea190@#48 + 1;  |FINSI;
                     |FINSI;

                     |SI nEdad < 3;
                                          #linea190@#41 = #linea190@#41 + 1;
                         |SI #agidanif#3 = "1";  #linea190@#42 = #linea190@#42 + 1;  |FINSI;
                     |SINO;
                                          #linea190@#43 = #linea190@#43 + 1;
                         |SI #agidanif#3 = "1";  #linea190@#44 = #linea190@#44 + 1;  |FINSI;
                     |FINSI;
                 |SINO;
                     |SI nEdad < 3;
                                          #linea190@#41 = #linea190@#41 + 1;
                         |SI #agidanif#3 = "1";  #linea190@#42 = #linea190@#42 + 1;  |FINSI;
                     |SINO;
                         |SI nEdad < 25;
                                              #linea190@#43 = #linea190@#43 + 1;
                             |SI #agidanif#3 = "1";  #linea190@#44 = #linea190@#44 + 1;  |FINSI;
                         |FINSI;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #agidanif#2 = "ASCENDIENTE ";
         aAlfa = #agidanif#13 % -104;
         nAnyo = aAlfa;
         nEdad = #linea190@#1 - nAnyo;
         |SI nEdad ] 0;
             |SI #agidanif#17 ] 65;
                                  #linea190@#59 = #linea190@#59 + 1;
                 |SI #agidanif#3 = "1";  #linea190@#60 = #linea190@#60 + 1;  |FINSI;

                 |SI nEdad < 75;
                                      #linea190@#51 = #linea190@#51 + 1;
                     |SI #agidanif#3 = "1";  #linea190@#52 = #linea190@#52 + 1;  |FINSI;
                 |SINO;
                                      #linea190@#53 = #linea190@#53 + 1;
                     |SI #agidanif#3 = "1";  #linea190@#54 = #linea190@#54 + 1;  |FINSI;
                 |FINSI;
             |SINO;
                 |SI #agidanif#17 ] 33;
                                      #linea190@#55 = #linea190@#55 + 1;
                     |SI #agidanif#3 = "1";  #linea190@#56 = #linea190@#56 + 1;      |FINSI;

                     |SI #agidanif#18 = "S";
                                          #linea190@#57 = #linea190@#57 + 1;
                         |SI #agidanif#3 = "1";  #linea190@#58 = #linea190@#58 + 1;  |FINSI;
                     |FINSI;

                     |SI nEdad < 75;
                                          #linea190@#51 = #linea190@#51 + 1;
                         |SI #agidanif#3 = "1";  #linea190@#52 = #linea190@#52 + 1;  |FINSI;
                     |SINO;
                                          #linea190@#53 = #linea190@#53 + 1;
                         |SI #agidanif#3 = "1";  #linea190@#54 = #linea190@#54 + 1;  |FINSI;
                     |FINSI;
                 |SINO;
                     |SI nEdad < 75;
                                          #linea190@#51 = #linea190@#51 + 1;
                         |SI #agidanif#3 = "1";  #linea190@#52 = #linea190@#52 + 1;  |FINSI;
                     |SINO;
                                          #linea190@#53 = #linea190@#53 + 1;
                         |SI #agidanif#3 = "1";  #linea190@#54 = #linea190@#54 + 1;  |FINSI;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CargaDatos;
     |SI #linea190@#1 [ 2002;  |HAZ CargaDatos2002;  |FINSI;
     |SI #linea190@#1 ] 2003;  |HAZ CargaDatos2003;  |FINSI;
|FPRC;

|DEFBUCLE agidanif;
     #agidanif#1;
     ;
     aNIF, 01;
     aNIF, 99;
     ;
     NULL, CargaDatos;
|FIN;

|PROCESO agidanif_2;
     aAlfa = #agidanif#13 % -104;
     nAnyo = aAlfa;
     nEdad = #linea190@#1 - nAnyo;

     |SI #agidanif#41 ! 0;
         nEdadAdop = #linea190@#1 - #agidanif#41;
         |SI nEdadAdop < 3;  nEdad = nEdadAdop;  |FINSI;
     |FINSI;

     |SI nEdad < 0;  |ACABA;  |FINSI;

     |SI nEdad ] 25;  |Y #agidanif#17 < 33;
         |ACABA;
     |FINSI;

     nConta = nConta + 1;

     |SI nConta = 1;
                          #linea190@#61 = "2";
         |SI #agidanif#3 = "1";  #linea190@#61 = "1";  |FINSI;
     |FINSI;

     |SI nConta = 2;
                          #linea190@#62 = "2";
         |SI #agidanif#3 = "1";  #linea190@#62 = "1";  |FINSI;
     |FINSI;

     |SI nConta = 3;
                          #linea190@#63 = "2";
         |SI #agidanif#3 = "1";  #linea190@#63 = "1";  |FINSI;
     |FINSI;

     |SI nConta ] 3;  |ERROR10;  |FINSI;
|FPRC;

|DEFBUCLE agidanif_2;
     #agidanif#1;
     2;
     aNIF, 01, "DESCENDIENTE";
     aNIF, 99, "DESCENDIENTE";
     ;
     NULL, NULL, NULL, NULL, NULL, agidanif_2;
     #agidanif#13;
|FIN;

|PROCESO CalculaDatosNif;
     |SI enEjer [ 2015;
         |REFERENCIA_DEF linea190@, #dsm190li;
     |FINSI;

     |SI enEjer ] 2016;
         |REFERENCIA_DEF linea190@, #dsm19001;
     |FINSI;

     |PARA nCampo = 28;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 1;
           #linea190@#nCampo# = 0;
     |SIGUE;

     |PARA nCampo = 41;  |SI nCampo [ 60;  |HACIENDO nCampo = nCampo + 1;
           #linea190@#nCampo# = 0;
     |SIGUE;

     aNIF = #linea190@#6;
     |BUCLE agidanif;

     #linea190@#61 = "0";
     #linea190@#62 = "0";
     #linea190@#63 = "0";
     nConta  = 0;
     |BUCLE agidanif_2;

     #linea190@#34 = #linea190@#29 + #linea190@#30 + #linea190@#31 + #linea190@#32 + #linea190@#33;
|FPRC;
