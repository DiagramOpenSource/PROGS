|FICHEROS;
     dsmoc111;
     dsm11101;

     dsm190li;
     dsm19001;

     :/laboral/def/labtraba;
     :/basica/def/agifigen;
|FIN;

|VARIABLES;
     nEmpresa = 0;
     nCampo   = 0;
     nCamb    = 0;

     a1Clave      = "";
     a2Clave      = "";
     aPathLaboral = "";
     aAlfa        = "";
     aAlfa1       = "";
     aBase        = "";
     nHandle      = 0;
|FIN;

|PROCESO Acum111Normal;
     #dsm11101#12 = #dsm11101#12 + #dsmoc111#12;
     #dsm11101#13 = #dsm11101#13 + #dsmoc111#13;
     #dsm11101#14 = #dsm11101#14 + #dsmoc111#14;
     #dsm11101#15 = #dsm11101#15 + #dsmoc111#15;
     #dsm11101#16 = #dsm11101#16 + #dsmoc111#16;
|FPRC;

|PROCESO Acum111IT;
     #dsm11101#25 = #dsm11101#25 + #dsmoc111#12;
     #dsm11101#26 = #dsm11101#26 + #dsmoc111#13;
     #dsm11101#27 = #dsm11101#27 + #dsmoc111#14;
     #dsm11101#28 = #dsm11101#28 + #dsmoc111#15;
     #dsm11101#29 = #dsm11101#29 + #dsmoc111#16;
|FPRC;

|PROCESO dsmoc111;
     |SI nEmpresa ! #dsmoc111#0;
         #agifigen#0 = #dsmoc111#0;
         |LEE 000#agifigen.=;
         |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;

         |SI nEmpresa = 0;
             aAlfa = "Empresa Nombre";
             |IMPRIME aAlfa;

             aAlfa = "-----------------------------------------------";
             |IMPRIME aAlfa;
         |FINSI;

         aAlfa = ("00000" + #dsmoc111#0) % -105 + "   " + #agifigen#1;  |QBF aAlfa;
         |IMPRIME aAlfa;
     |FINSI;

     a1Clave = #dsmoc111#9;
     a2Clave = #dsmoc111#10;

     |SI #dsmoc111#9 = "A";
         a2Clave = "";
     |FINSI;

     |SI #dsmoc111#9 = "B";
         |SI #dsmoc111#10 = "02";  a2Clave = "01";  |FINSI;
         |SI #dsmoc111#10 = "03";  a2Clave = "02";  |FINSI;
         |SI #dsmoc111#10 = "04";  a2Clave = "03";  |FINSI;
     |FINSI;

     #dsm11101#0  = #dsmoc111#0;
     #dsm11101#1  = #dsmoc111#1;
     #dsm11101#2  = #dsmoc111#2;
     #dsm11101#3  = #dsmoc111#3;
     #dsm11101#4  = #dsmoc111#4;
     #dsm11101#5  = #dsmoc111#5;
     #dsm11101#6  = #dsmoc111#6;
     #dsm11101#7  = #dsmoc111#7;
     #dsm11101#8  = #dsmoc111#8;
     #dsm11101#9  = a1Clave;
     #dsm11101#10 = a2Clave;
     #dsm11101#11 = #dsmoc111#11;
     |LEE 101#dsm11101.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm11101;

         #dsm11101#0  = #dsmoc111#0;
         #dsm11101#1  = #dsmoc111#1;
         #dsm11101#2  = #dsmoc111#2;
         #dsm11101#3  = #dsmoc111#3;
         #dsm11101#4  = #dsmoc111#4;
         #dsm11101#5  = #dsmoc111#5;
         #dsm11101#6  = #dsmoc111#6;
         #dsm11101#7  = #dsmoc111#7;
         #dsm11101#8  = #dsmoc111#8;
         #dsm11101#9  = a1Clave;
         #dsm11101#10 = a2Clave;
         #dsm11101#11 = #dsmoc111#11;
         #dsm11101#21 = #dsmoc111#21;
         #dsm11101#24 = #dsmoc111#24;

         |GRABA 020#dsm11101.b;
     |FINSI;

     |SI #dsmoc111#9 = "A";
         |SI #dsmoc111#10 = "01";  |HAZ Acum111Normal;  |FINSI;
         |SI #dsmoc111#10 = "02";  |HAZ Acum111IT;      |FINSI;
     |SINO;
         |HAZ Acum111Normal;
     |FINSI;

     #dsm11101#17 = #dsm11101#17 + #dsmoc111#17;
     #dsm11101#18 = #dsm11101#18 + #dsmoc111#18;
     #dsm11101#19 = #dsm11101#19 + #dsmoc111#19;
     #dsm11101#20 = #dsm11101#20 + #dsmoc111#20;
     #dsm11101#22 = #dsm11101#22 + #dsmoc111#22;
     #dsm11101#23 = #dsm11101#23 + #dsmoc111#23;

     |GRABA 020#dsm11101.a;
     |LIBERA #dsm11101;

     |BORRA 020#dsmoc111.a;
     |LIBERA #dsmoc111;

     nEmpresa = #dsmoc111#0;
|FPRC;

|DEFBUCLE dsmoc111;
     #dsmoc111#4;
     ;
     2016, 00000;
     2016, 99999;
     be;
     NULL, dsmoc111;
|FIN;

|PROCESO Pasa111;
     |PUSHV 0501 2380;
     |BLANCO 1320 1666;
     |CUADRO 1320 1666;
     |PINTA 1421, "GENERANDO DATOS MODELO 111 EJERCICIO 2016";

     |BUCLE dsmoc111;

     |POPV;
|FPRC;

|PROCESO Acum190Normal;
     #dsm19001#16 = #dsm19001#16 + #dsm190li#16;
     #dsm19001#17 = #dsm19001#17 + #dsm190li#17;
     #dsm19001#18 = #dsm19001#18 + #dsm190li#18;
     #dsm19001#19 = #dsm19001#19 + #dsm190li#19;
     #dsm19001#20 = #dsm19001#20 + #dsm190li#20;
|FPRC;

|PROCESO Acum190IT;
     #dsm19001#65 = #dsm19001#65 + #dsm190li#16;
     #dsm19001#66 = #dsm19001#66 + #dsm190li#17;
     #dsm19001#67 = #dsm19001#67 + #dsm190li#18;
     #dsm19001#68 = #dsm19001#68 + #dsm190li#19;
     #dsm19001#69 = #dsm19001#69 + #dsm190li#20;
|FPRC;

|PROCESO dsm190li;
     a1Clave = #dsm190li#8;
     a2Clave = #dsm190li#9;

     |SI #dsm190li#8 = "A";
         a2Clave = "";
     |FINSI;

     |SI #dsm190li#8 = "B";
         |SI #dsm190li#9 = "02";  a2Clave = "01";  |FINSI;
         |SI #dsm190li#9 = "03";  a2Clave = "02";  |FINSI;
         |SI #dsm190li#9 = "04";  a2Clave = "03";  |FINSI;
     |FINSI;

     #dsm19001#0  = #dsm190li#0;
     #dsm19001#1  = #dsm190li#1;
     #dsm19001#2  = #dsm190li#2;
     #dsm19001#3  = #dsm190li#3;
     #dsm19001#4  = #dsm190li#4;
     #dsm19001#5  = #dsm190li#5;
     #dsm19001#6  = #dsm190li#6;
     #dsm19001#7  = #dsm190li#7;
     #dsm19001#8  = a1Clave;
     #dsm19001#9  = a2Clave;
     #dsm19001#10 = #dsm190li#10;
     |LEE 101#dsm19001.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm19001;

         #dsm19001#0  = #dsm190li#0;
         #dsm19001#1  = #dsm190li#1;
         #dsm19001#2  = #dsm190li#2;
         #dsm19001#3  = #dsm190li#3;
         #dsm19001#4  = #dsm190li#4;
         #dsm19001#5  = #dsm190li#5;
         #dsm19001#6  = #dsm190li#6;
         #dsm19001#7  = #dsm190li#7;
         #dsm19001#8  = a1Clave;
         #dsm19001#9  = a2Clave;
         #dsm19001#10 = #dsm190li#10;

         |PARA nCampo = 11;  |SI nCampo [ 15;  |HACIENDO nCampo = nCampo + 1;
               #dsm19001#nCampo# = #dsm190li#nCampo#;
         |SIGUE;

         |PARA nCampo = 25;  |SI nCampo [ 64;  |HACIENDO nCampo = nCampo + 1;
               #dsm19001#nCampo# = #dsm190li#nCampo#;
         |SIGUE;

         |GRABA 020#dsm19001.b;
     |FINSI;

     |SI #dsm190li#8 = "A";
         |SI #dsm190li#9 = "01";  |HAZ Acum190Normal;  |FINSI;
         |SI #dsm190li#9 = "02";  |HAZ Acum190IT;      |FINSI;
     |SINO;
         |HAZ Acum190Normal;
     |FINSI;

     #dsm19001#21 = #dsm19001#21 + #dsm190li#21;
     #dsm19001#22 = #dsm19001#22 + #dsm190li#22;
     #dsm19001#23 = #dsm19001#23 + #dsm190li#23;
     #dsm19001#24 = #dsm19001#24 + #dsm190li#24;

     |GRABA 020#dsm19001.a;
     |LIBERA #dsm19001;

     |BORRA 020#dsm190li.a;
     |LIBERA #dsm190li;
|FPRC;

|DEFBUCLE dsm190li;
     #dsm190li#1;
     ;
     00000, 2016, 00, 000, 00, 00, "            ", 0000, " ", "  ", 0;
     99999, 2016, 99, 999, 99, 99, "zzzzzzzzzzzz", 9999, "z", "zz", 9;
     be;
     NULL, dsm190li;
|FIN;

|PROCESO Pasa190;
     |PUSHV 0501 2380;
     |BLANCO 1320 1666;
     |CUADRO 1320 1666;
     |PINTA 1421, "GENERANDO DATOS MODELO 190 EJERCICIO 2016";

     |BUCLE dsm190li;

     |POPV;
|FPRC;

|PROCESO labtraba;
     nCamb = 0;

     |SI #labtraba#99 = "A";
         |SI #labtraba#102 ! "  ";  #labtraba#102 = "";  nCamb = 1;  |FINSI;
     |FINSI;

     |SI #labtraba#100 = "A";
         |SI #labtraba#103 ! "  ";  #labtraba#103 = "";  nCamb = 1;  |FINSI;
     |FINSI;

     |SI #labtraba#101 = "A";
         |SI #labtraba#104 ! "  ";  #labtraba#104 = "";  nCamb = 1;  |FINSI;
     |FINSI;

     |SI nCamb = 1;
         |GRABA 020#labtraba.a;
         |LIBERA #labtraba;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, labtraba;
|FIN;

|PROCESO PasaTrab;
     aPathLaboral = "";
     |DBASS aBase;   |QBF aBase;
     aAlfa1 = aBase + "laboral/def/labempre.mas";
     |XABRE "E", aAlfa1, nHandle;
     |SI FSalida ] 0;
          aPathLaboral = aBase + "laboral/fich/";
     |FINSI;

     |SI aPathLaboral ! "";

        |PUSHV 0501 2380;
        |BLANCO 1320 1666;
        |CUADRO 1320 1666;
        |PINTA 1421, "CAMBIANDO CLAVES PERCEPTORAS EN TRABAJADORES";

        |BUCLE labtraba;

        |POPV;
     |FINSI;
|FPRC;

|PROGRAMA;
     |MENAV "0000Seleccionamos una impresora para emitir las empresas afectadas";
     |IMPRE 0;
     nEmpresa = 0;

     |ABRE #agifigen;
     |ABRE #dsm11101;
     |ABRE #dsmoc111;
     |SELECT #4#dsmoc111;
     #dsmoc111#1 = 2016;
     #dsmoc111#0 = 1;
     |LEE 000#dsmoc111.];
     |SI FSalida = 0;  |Y #dsmoc111#1 = 2016;
         |HAZ Pasa111;
         |HAZ PasaTrab;
     |FINSI;
     |CIERRA #dsmoc111;
     |CIERRA #dsm11101;

     |ABRE #dsm19001;
     |ABRE #dsm190li;
     |SELECT #5#dsm190li;
     #dsm190li#1 = 2016;
     #dsm190li#6 = "";
     #dsm190li#0 = 1;
     |LEE 000#dsm190li.];
     |SI FSalida = 0;  |Y #dsm190li#1 = 2016;
         |HAZ Pasa190;
     |FINSI;
     |CIERRA #dsm190li;
     |CIERRA #dsm19001;
     |CIERRA #agifigen;

     |FINIMP;
|FPRO;
