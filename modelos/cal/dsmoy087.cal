|FICHEROS;
     dsmoy087;

     dsmod110;
     dsmoc111;
     dsm11101;

     dsmom002;
     dsmom073;

     :/basica/def/agifigen;

     dsmow158;
|FIN;

|VARIABLES;
     nCampo            = 0;
     nDEmpresa         = 0;
     nHEmpresa         = 0;
     nEjer             = 0;
     nEmpresa          = 0;
     nDPerio           = 0;
     nDPeriodo         = 0;
     nHPeriodo         = 0;
     nMesLugar         = 0;
     nPeriodo          = 0;
     nHay              = 0;

     aFichero          = "";
     aEjer             = "";
     aPeriodicidad     = "";

     fFecha            = @;
     nNume1            = 0;
     nNume2            = 0;
     nNume3            = 0;
     nNume4            = 0;
     nAlgo             = 0;
     nBase             = 0;
     nIrpf             = 0;
     nTp100            = 0;

     &aNumEmp          = "";
     &aNomEmp          = "";
     &nSwLinea         = 0;

     nExism002         = 0;
     fFecIni           = @;
     fFecFin           = @;

     aAlfa             = "";
     aAlfa1            = "";
     aAlfa2            = "";
     aAlfa3            = "";

     informe  = "";
     nSw      = 0;
     nCampo1  = 0;
     nCampo2  = 0;
     nCampo3  = 0;
     nCampo4  = 0;
     nCampo5  = 0;
     nCampo8  = 0;
     nCampo11 = 0;
     aNif     = "";
     aNom     = "";

     &enEjerIRPF = 0;
|FIN;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\
|PROCESO Periodo;
     nCampo = Campo + 1;
     #dsmoy087#nCampo# = "          ";
     |SI #dsmoy087#Campo# = 1;   #dsmoy087#nCampo# = "ENERO     ";  |FINSI;
     |SI #dsmoy087#Campo# = 2;   #dsmoy087#nCampo# = "FEBRERO   ";  |FINSI;
     |SI #dsmoy087#Campo# = 3;   #dsmoy087#nCampo# = "MARZO     ";  |FINSI;
     |SI #dsmoy087#Campo# = 4;   #dsmoy087#nCampo# = "ABRIL     ";  |FINSI;
     |SI #dsmoy087#Campo# = 5;   #dsmoy087#nCampo# = "MAYO      ";  |FINSI;
     |SI #dsmoy087#Campo# = 6;   #dsmoy087#nCampo# = "JUNIO     ";  |FINSI;
     |SI #dsmoy087#Campo# = 7;   #dsmoy087#nCampo# = "JULIO     ";  |FINSI;
     |SI #dsmoy087#Campo# = 8;   #dsmoy087#nCampo# = "AGOSTO    ";  |FINSI;
     |SI #dsmoy087#Campo# = 9;   #dsmoy087#nCampo# = "SEPTIEMBRE";  |FINSI;
     |SI #dsmoy087#Campo# = 10;  #dsmoy087#nCampo# = "OCTUBRE   ";  |FINSI;
     |SI #dsmoy087#Campo# = 11;  #dsmoy087#nCampo# = "NOVIEMBRE ";  |FINSI;
     |SI #dsmoy087#Campo# = 12;  #dsmoy087#nCampo# = "DICIEMBRE ";  |FINSI;

     |SI #dsmoy087#nCampo# = "          ";
         |MENAV "     Periodo Incorrecto.";
         |ERROR;
     |FINSI;

     |PINTA #dsmoy087#nCampo#;

     |SI Campo = 0;
         fFecha = ~;
         aAlfa  = fFecha % -104;
         #dsmoy087#2   = aAlfa;
         #dsmoy087#2   = #dsmoy087#2 - 1;
         |PINTA #dsmoy087#2;
     |FINSI;
|FPRC;

|PROCESO Parrilla;
     |SI #dsmoy087#3 = 0;
         #dsmoy087#3 = 0;  |PINTA #dsmoy087#3;
         #dsmoy087#4 = 0;  |PINTA #dsmoy087#4;  |C_M #dsmoy087#4, 1, "N";
         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy087#nCampo#, 1, "S";
         |SIGUE;
     |SINO;
         |C_M #dsmoy087#3, 1, "S";
         |C_M #dsmoy087#4, 1, "S";

         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy087#nCampo#, 1, "N";
               #dsmoy087#nCampo# = 0;  |PINTA #dsmoy087#nCampo#;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #dsmoy087#Campo# = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               #dsmoy087#nCampo# = 0;  |C_M #dsmoy087#nCampo#, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy087#nCampo#, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO LasClaves; |TIPO 0;
     aAlfa1 = "S";
     |SI #dsmoy087#29 = "S"; aAlfa1 = "N"; |FINSI;
     |PARA nCampo = 30;  |SI nCampo [ 37;  |HACIENDO nCampo = nCampo + 1;
           |C_M #dsmoy087#nCampo#, 1, aAlfa1;

           |SI aAlfa1 = "N";
               #dsmoy087#nCampo# = ""; |PINTA #dsmoy087#nCampo#;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO LosTp;
     |C_M #dsmoy087#39, 1, "S";
     |SI #dsmoy087#38 = "S";
         |C_M #dsmoy087#39, 1, "N";
         #dsmoy087#39  = 0; |PINTA #dsmoy087#39;
     |FINSI;
|FPRC;

|PROCESO Orden; |TIPO 7;
     |C_M #dsmoy087#22, 1, "S";
     |SI #dsmoy087#21 = "N";
         #dsmoy087#22 = 1; |PINTA #dsmoy087#22;
         |C_M #dsmoy087#22, 1, "N";
     |FINSI;
|FPRC;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\

|PROCESO VerM002;
     |SI #dsmom002#8 > "01.01.1900";
         |SI #dsmom002#8 > fFecFin;  |ACABA;  |FINSI;
     |FINSI;
     |SI #dsmom002#9 > "01.01.1900";
         |SI #dsmom002#9 < fFecIni;  |ACABA;  |FINSI;
     |FINSI;

     nExism002 = 0;
     aPeriodicidad = "T";
     |SI #dsmom002#7 = "MENSUAL   ";  aPeriodicidad = "M";  |FINSI;
|FPRC;

|DEFBUCLE VerM002;
     #dsmom002#1;
     ;
     #dsmow158#0, 01, 110;
     #dsmow158#0, 99, 110;
     ;
     NULL, VerM002;
|FIN;

|PROCESO MiraEmp;
     |ABRE #agifigen;
     |DDEFECTO #agifigen;
     #agifigen#0 = #dsmow158#0;
     |LEE 040#agifigen.=;
     |CIERRA #agifigen;
     #dsmow158#16 = #agifigen#1;
|FPRC;

|PROCESO dsmoc111;
     #dsmow158#0 = #dsmoc111#0;

     |SI #dsmoy087#29 ! "S";
         nSw = 0;
         |SI #dsmoy087#30 = #dsmoc111#9; |Y #dsmoy087#31 = #dsmoc111#10; nSw = 1; |FINSI;
         |SI #dsmoy087#32 = #dsmoc111#9; |Y #dsmoy087#33 = #dsmoc111#10; nSw = 1; |FINSI;
         |SI #dsmoy087#34 = #dsmoc111#9; |Y #dsmoy087#35 = #dsmoc111#10; nSw = 1; |FINSI;
         |SI #dsmoy087#36 = #dsmoc111#9; |Y #dsmoy087#37 = #dsmoc111#10; nSw = 1; |FINSI;
         |SI nSw = 0; |ACABA; |FINSI;
     |FINSI;

     nExism002 = 0;
     |HAZ VerM002;

     #dsmod110#0 = #dsmoc111#0;
     #dsmod110#1 = #dsmoc111#1;
     #dsmod110#2 = #dsmoc111#2;
     #dsmod110#3 = #dsmoc111#3;
     #dsmod110#4 = #dsmoc111#4 + 1;
     #dsmod110#5 = 1;
     |LEE 041#dsmod110.=;
     |SI FSalida = 0; |ACABA; |FINSI;

     |SI #dsmoy087#21 = "S";
         nCampo2  = 99;
         nCampo4  = 0;
         nCampo5  = 0;
         nCampo8  = 0;
         nCampo11 = 0;
     |SINO;
         nCampo2  = #dsmoc111#2;
         nCampo4  = #dsmoc111#4;
         nCampo5  = #dsmoc111#5;
         nCampo8  = #dsmoc111#8;
         nCampo11 = #dsmoc111#11;
     |FINSI;

     #dsmow158#0  = #dsmoc111#0;
     #dsmow158#1  = #dsmoc111#1;
     #dsmow158#2  = nCampo2;
     #dsmow158#3  = 110;
     #dsmow158#4  = nCampo4;
     #dsmow158#5  = nCampo5;
     #dsmow158#6  = #dsmoc111#6;
     #dsmow158#7  = #dsmoc111#7;
     #dsmow158#8  = nCampo8;
     #dsmow158#9  = #dsmoc111#9;
     #dsmow158#10 = #dsmoc111#10;
     #dsmow158#11 = nCampo11;
     |LEE 001#dsmow158.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow158;
         #dsmow158#0  = #dsmoc111#0;
         #dsmow158#1  = #dsmoc111#1;
         #dsmow158#2  = nCampo2;
         #dsmow158#3  = 110;
         #dsmow158#4  = nCampo4;
         #dsmow158#5  = nCampo5;
         #dsmow158#6  = #dsmoc111#6;
         #dsmow158#7  = #dsmoc111#7;
         #dsmow158#8  = nCampo8;
         #dsmow158#9  = #dsmoc111#9;
         #dsmow158#10 = #dsmoc111#10;
         #dsmow158#11 = nCampo11;
         #dsmow158#15 = #dsmoc111#21;
         #dsmow158#17 = aPeriodicidad;
         |HAZ MiraEmp;
         |GRABA 020#dsmow158.b;
     |FINSI;

     |SI aPeriodicidad = "T";
         |SI #dsmoy087#0 = 1;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy087#0 = 2;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy087#0 = 3;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy087#0 = 4;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy087#0 = 5;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy087#0 = 6;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy087#0 = 7;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy087#0 = 8;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy087#0 = 9;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy087#0 = 10;  nPeriodo = 12;  |FINSI;
         |SI #dsmoy087#0 = 11;  nPeriodo = 12;  |FINSI;
         |SI #dsmoy087#0 = 12;  nPeriodo = 12;  |FINSI;
     |SINO;
         nPeriodo = #dsmoy087#0;
     |FINSI;

     |SI #dsmoc111#2 < #dsmoy087#26;     |ACABA;  |FINSI;
     |SI #dsmoc111#2 > nPeriodo;  |ACABA;  |FINSI;

     #dsmow158#12 = #dsmow158#12 + #dsmoc111#12;
     #dsmow158#13 = #dsmow158#13 + #dsmoc111#13;
     #dsmow158#14 = ( (#dsmow158#13 * 100) / #dsmow158#12) ! 2;

     |GRABA 020#dsmow158.a;
     |LIBERA #dsmow158;
     nAlgo = 1;
|FPRC;

|DEFBUCLE dsmoc111;
     #dsmoc111#1;
     ;
     #dsmoy087#3, #dsmoy087#2, 01, 110, 00, 01, #dsmoy087#17, 0000, 00, " ", "  ", 0;
     #dsmoy087#4, #dsmoy087#2, 12, 110, 99, 99, #dsmoy087#18, 9999, 99, "z", "zz", 9;
     ;
     NULL, dsmoc111;
|FIN;

|PROCESO dsm11101;
     #dsmow158#0 = #dsm11101#0;

     |SI #dsmoy087#29 ! "S";
         nSw = 0;
         |SI #dsmoy087#30 = #dsm11101#9; |Y #dsmoy087#31 = #dsm11101#10; nSw = 1; |FINSI;
         |SI #dsmoy087#32 = #dsm11101#9; |Y #dsmoy087#33 = #dsm11101#10; nSw = 1; |FINSI;
         |SI #dsmoy087#34 = #dsm11101#9; |Y #dsmoy087#35 = #dsm11101#10; nSw = 1; |FINSI;
         |SI #dsmoy087#36 = #dsm11101#9; |Y #dsmoy087#37 = #dsm11101#10; nSw = 1; |FINSI;
         |SI nSw = 0; |ACABA; |FINSI;
     |FINSI;

     nExism002 = 0;
     |HAZ VerM002;

     #dsmod110#0 = #dsm11101#0;
     #dsmod110#1 = #dsm11101#1;
     #dsmod110#2 = #dsm11101#2;
     #dsmod110#3 = #dsm11101#3;
     #dsmod110#4 = #dsm11101#4 + 1;
     #dsmod110#5 = 1;
     |LEE 041#dsmod110.=;
     |SI FSalida = 0; |ACABA; |FINSI;

     |SI #dsmoy087#21 = "S";
         nCampo2  = 99;
         nCampo4  = 0;
         nCampo5  = 0;
         nCampo8  = 0;
         nCampo11 = 0;
     |SINO;
         nCampo2  = #dsm11101#2;
         nCampo4  = #dsm11101#4;
         nCampo5  = #dsm11101#5;
         nCampo8  = #dsm11101#8;
         nCampo11 = #dsm11101#11;
     |FINSI;

     #dsmow158#0  = #dsm11101#0;
     #dsmow158#1  = #dsm11101#1;
     #dsmow158#2  = nCampo2;
     #dsmow158#3  = 110;
     #dsmow158#4  = nCampo4;
     #dsmow158#5  = nCampo5;
     #dsmow158#6  = #dsm11101#6;
     #dsmow158#7  = #dsm11101#7;
     #dsmow158#8  = nCampo8;
     #dsmow158#9  = #dsm11101#9;
     #dsmow158#10 = #dsm11101#10;
     #dsmow158#11 = nCampo11;
     |LEE 001#dsmow158.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow158;
         #dsmow158#0  = #dsm11101#0;
         #dsmow158#1  = #dsm11101#1;
         #dsmow158#2  = nCampo2;
         #dsmow158#3  = 110;
         #dsmow158#4  = nCampo4;
         #dsmow158#5  = nCampo5;
         #dsmow158#6  = #dsm11101#6;
         #dsmow158#7  = #dsm11101#7;
         #dsmow158#8  = nCampo8;
         #dsmow158#9  = #dsm11101#9;
         #dsmow158#10 = #dsm11101#10;
         #dsmow158#11 = nCampo11;
         #dsmow158#15 = #dsm11101#21;
         #dsmow158#17 = aPeriodicidad;
         |HAZ MiraEmp;
         |GRABA 020#dsmow158.b;
     |FINSI;

     |SI aPeriodicidad = "T";
         |SI #dsmoy087#0 = 1;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy087#0 = 2;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy087#0 = 3;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy087#0 = 4;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy087#0 = 5;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy087#0 = 6;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy087#0 = 7;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy087#0 = 8;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy087#0 = 9;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy087#0 = 10;  nPeriodo = 12;  |FINSI;
         |SI #dsmoy087#0 = 11;  nPeriodo = 12;  |FINSI;
         |SI #dsmoy087#0 = 12;  nPeriodo = 12;  |FINSI;
     |SINO;
         nPeriodo = #dsmoy087#0;
     |FINSI;

     |SI #dsm11101#2 < #dsmoy087#26;     |ACABA;  |FINSI;
     |SI #dsm11101#2 > nPeriodo;  |ACABA;  |FINSI;

     #dsmow158#12 = #dsmow158#12 + #dsm11101#12 + #dsm11101#25;
     #dsmow158#13 = #dsmow158#13 + #dsm11101#13 + #dsm11101#26;
     #dsmow158#14 = ( (#dsmow158#13 * 100) / #dsmow158#12) ! 2;

     |GRABA 020#dsmow158.a;
     |LIBERA #dsmow158;
     nAlgo = 1;
|FPRC;

|DEFBUCLE dsm11101;
     #dsm11101#1;
     ;
     #dsmoy087#3, #dsmoy087#2, 01, 110, 00, 01, #dsmoy087#17, 0000, 00, " ", "  ", 0;
     #dsmoy087#4, #dsmoy087#2, 12, 110, 99, 99, #dsmoy087#18, 9999, 99, "z", "zz", 9;
     ;
     NULL, dsm11101;
|FIN;

|| ... ... ... ... ... ... ... ... Proceso para Imprimir Auxiliar
|PROCESO Imprime;

     |SI #dsmoy087#38 = "N";
         nNume1 = #dsmoy087#39 - 1;
         nNume2 = #dsmoy087#39 + 1;
         |SI #dsmow158#14 < nNume1; |O #dsmow158#14 > nNume2; |ACABA; |FINSI;
     |FINSI;

     |SI nEmpresa ! #dsmow158#0;  |Y nEmpresa ! 0;
         |SI nHay ! 0; |PIEINF; |FINSI;
         nHay     = 0;
         aNif     = #dsmow158#6;
         nPeriodo = #dsmow158#2;
         nSwLinea = 3;
         aNom     = #dsmow158#15;
     |FINSI;

     nEmpresa = #dsmow158#0;
     aNumEmp  = nEmpresa; |QBF aNumEmp;
     aNumEmp  = ("00000" + aNumEmp) % -105;
     aNomEmp  = #dsmow158#16;

     |SI #dsmow158#2 ! nPeriodo;
         |SI #dsmoy087#21 = "N";
             |SI nSwLinea = 1;
                 nSwLinea = 2; |PRINT;
             |FINSI;
             aNif     = #dsmow158#6;
             aNom     = #dsmow158#15;
             nSwLinea = 3;
         |FINSI;
         nPeriodo = #dsmow158#2;
    |FINSI;

     nNume1 = #dsmow158#2; |HAZ Literal;
     #dsmoy087#31  = aAlfa1;

     |SI aNif ! #dsmow158#6; |Y #dsmoy087#22 = 1;
         aNif = #dsmow158#6;
         nSwLinea = 0;
     |FINSI;

     |SI aNom ! #dsmow158#15; |Y #dsmoy087#22 = 2;
         aNom = #dsmow158#15;
         nSwLinea = 0;
     |FINSI;

     |SI #dsmow158#12 ! 0; |O #dsmow158#13 ! 0;
         |PRINT;
         nHay     = 1;
         nSwLinea = 1;
         nAlgo    = 1;
     |FINSI;

     aNif     = #dsmow158#6;
     aNom     = #dsmow158#15;
     nPeriodo = #dsmow158#2;
|FPRC;

|DEFBUCLE dsmow158_pornom;
     #dsmow158#2;
     ;
     00000, #dsmoy087#2, "                                        ", 0000, " ", "  ";
     99999, #dsmoy087#2, "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, Imprime;
|FIN;

|DEFBUCLE dsmow158_pornif;
     #dsmow158#1;
     ;
     00000, #dsmoy087#2, 01, 110, 00, 00, "            ", 0000, 00, " ", "  ", 0;
     99999, #dsmoy087#2, 99, 110, 99, 99, "zzzzzzzzzzzz", 9999, 99, "z", "zz", 9;
     ;
     NULL, Imprime;
|FIN;

|PROCESO Literal;
     aAlfa1 = "";
     |SI nNume1 = 1;   aAlfa1 = "ENERO     ";  |FINSI;
     |SI nNume1 = 2;   aAlfa1 = "FEBRERO   ";  |FINSI;
     |SI nNume1 = 3;   aAlfa1 = "MARZO     ";  |FINSI;
     |SI nNume1 = 4;   aAlfa1 = "ABRIL     ";  |FINSI;
     |SI nNume1 = 5;   aAlfa1 = "MAYO      ";  |FINSI;
     |SI nNume1 = 6;   aAlfa1 = "JUNIO     ";  |FINSI;
     |SI nNume1 = 7;   aAlfa1 = "JULIO     ";  |FINSI;
     |SI nNume1 = 8;   aAlfa1 = "AGOSTO    ";  |FINSI;
     |SI nNume1 = 9;   aAlfa1 = "SEPTIEMBRE";  |FINSI;
     |SI nNume1 = 10;  aAlfa1 = "OCTUBRE   ";  |FINSI;
     |SI nNume1 = 11;  aAlfa1 = "NOVIEMBRE ";  |FINSI;
     |SI nNume1 = 12;  aAlfa1 = "DICIEMBRE ";  |FINSI;
     |SI nNume1 = 99;  aAlfa1 = "ANUAL     ";  |FINSI;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     || |MENAV "0000 Recuerde seleccionar el papel de la impresora en Horizontal";

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     informe = "dsmoy087";
     |SI #dsmoy087#21 = "S";
         informe = "dsmoya87";
     |FINSI;
     |INFOR informe;
     |SI FSalida ! 0;
         |MENAV "    No existe Informe";
         |FINIMP;
         |ACABA;
     |FINSI;

     aFichero = ("87" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dsmow158#aFichero#;
     |DELINDEX #dsmow158;

     nDPeriodo = #dsmoy087#26;
     nHPeriodo = #dsmoy087#0;
     aEjer     = #dsmoy087#2;
     aEjer     = aEjer % -102;
     nEjer     = aEjer;

     aAlfa1 = #dsmoy087#2;
     |SI #dsmoy087#26 ! 99;
         aAlfa2 = #dsmoy087#26; |QBF aAlfa2; aAlfa2 = ("00" + aAlfa2) % -102;
         aAlfa1 = "01."+ aAlfa2 + "." + aAlfa1; fFecIni = aAlfa1;
     |SINO;
         aAlfa1 = "01.01." + aAlfa1; fFecIni = aAlfa1;
     |FINSI;

     aAlfa1 = #dsmoy087#2;
     |SI #dsmoy087#0 ! 99;
         aAlfa2 = #dsmoy087#0; |QBF aAlfa2; aAlfa2 = ("00" + aAlfa2) % -102;
         aAlfa3 = "31.";

         |SI #dsmoy087#0 = 4; |O #dsmoy087#0 = 6; |O #dsmoy087#0 = 9;
             #dsmoy087#0 = 11;  aAlfa3 = "30.";
         |FINSI;

         |SI #dsmoy087#0 = 2;
             aAlfa3 = "28."; nNume1 = #dsmoy087#2 / 4; nNume2 = (#dsmoy087#2/4) ! 0;
             |SI nNume1 = nNume2; aAlfa3 = "29."; |FINSI;
         |FINSI;

         aAlfa1 = aAlfa3 + aAlfa2 + "." + aAlfa1; fFecFin = aAlfa1;
     |SINO;
         aAlfa1 = "31.12." + aAlfa1; fFecFin = aAlfa1;
     |FINSI;

     nAlgo = 0;
     |ABRE #dsmow158;
     |ABRE #dsmod110;
     |SI #dsmoy087#3 ! 0;
         |SI #dsmoy087#2 [ 2015;  |BUCLE dsmoc111;  |FINSI;
         |SI #dsmoy087#2 ] 2016;  |BUCLE dsm11101;  |FINSI;
     |SINO;
         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |SI #dsmoy087#nCampo# ! 0;
                   #dsmoy087#3 = #dsmoy087#nCampo#;
                   #dsmoy087#4 = #dsmoy087#nCampo#;

                   |SI #dsmoy087#2 [ 2015;  |BUCLE dsmoc111;  |FINSI;
                   |SI #dsmoy087#2 ] 2016;  |BUCLE dsm11101;  |FINSI;
               |FINSI;
         |SIGUE;
     |FINSI;
     |CIERRA #dsmow158;
     |CIERRA #dsmod110;

     |SI nAlgo = 1;
         aNif     = "";
         nEmpresa = 0;
         nAlgo    = 0;
         nPeriodo = 0;
         |SI #dsmoy087#22 = 1; |BUCLE dsmow158_pornif; |FINSI;
         |SI #dsmoy087#22 = 2; |BUCLE dsmow158_pornom; |FINSI;

         |SI nEmpresa ! 0; |Y nHay ! 0;  |PIEINF;  |FINSI;
     |FINSI;

     |SI nAlgo = 0;
         |MENAV "    Seleccion vacia";
     |FINSI;

     |FININF;
     |FINIMP;
     |DELINDEX #dsmow158;
|FPRC;

|PROCESO Baja73;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = "";
     #dsmom073#2 = "";
|FPRC;

|PROCESO Alta73;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = "z";
     #dsmom073#2 = "zz";
|FPRC;

|PROCESO T66; |TIPO 66;
     |SI Campo = 30;  |O Campo = 31;
         nCampo1 = 30;
         nCampo2 = 31;
     |FINSI;

     |SI Campo = 32;  |O Campo = 33;
         nCampo1 = 32;
         nCampo2 = 33;
     |FINSI;

     |SI Campo = 34;  |O Campo = 35;
         nCampo1 = 34;
         nCampo2 = 35;
     |FINSI;

     |SI Campo = 36;  |O Campo = 37;
         nCampo1 = 36;
         nCampo2 = 37;
     |FINSI;

     enEjerIRPF = #dsmoy087#2;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #dsmoy087#nCampo1#;
     #dsmom073#2 = #dsmoy087#nCampo2#;
     |LEE 000#dsmom073.];

     |CONSULTA_F_CLAVE #1#dsmom073, Baja73, Alta73;
     |SI FSalida = 0;
          #dsmoy087#nCampo1# = #dsmom073#1;    |PINTA #dsmoy087#nCampo1#;
          #dsmoy087#nCampo2# = #dsmom073#2;    |PINTA #dsmoy087#nCampo2#;
     |FINSI;
     |CIERRA #dsmom073;

     |ERROR;
|FPRC;

|PROCESO T0; |TIPO 0;
     nCampo1 = Campo - 1;
     nCampo2 = Campo;

     |SI #dsmoy087#nCampo1# = " ";  |Y #dsmoy087#nCampo2# = "  ";
         |ACABA;
     |FINSI;

     enEjerIRPF = #dsmoy087#2;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #dsmoy087#nCampo1#;
     #dsmom073#2 = #dsmoy087#nCampo2#;
     |LEE 000#dsmom073.=;
     |SI FSalida ! 0;
         aAlfa = "0000Clave no correcta en el ejercicio " + enEjerIRPF;
         |MENAV aAlfa;
         |ERROR;
     |FINSI;
     |CIERRA #dsmom073;
|FPRC;
