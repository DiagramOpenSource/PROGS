|FICHEROS;
     dsmoz067;
     dsmom004;
     dsmom073;

     dsmoc110;
     dsmoc111;
     dsm11101;
     dsm190li;
     dsm19001;

     :/basica/def/agifigen;

     dsmodel@;

     &regisnif@;
|FIN;

|VARIABLES;
     nCampo            = 0;
     fFecha            = @;
     aAlfa             = "";
     aAlfa1            = "";
     nPara1            = 0;
     nDEmpresa         = 0;
     nHEmpresa         = 0;
     nEmpresa          = 0;
     nEjer             = 0;
     nPer              = 0;
     nMod              = 0;
     nCpl              = 0;
     nActividad        = 0;
     nDPeriodo         = 0;
     nHPeriodo         = 0;
     nDComplem         = 0;
     nHComplem         = 0;
     aClave            = "";
     aSubClave         = "";
     aNomDef           = "";
     aBase             = "";
     aMas              = "";
     nCambio           = 0;
     nBorrar           = 0;

     aNif              = "";
     nDevengo          = 0;
     nRelacion         = 0;
     aParam            = "";

     &SwEsp2015        = 0;
     &enEmp15          = 0;
     &eaClave15        = "";
     &eaSubCl15        = "";
     &eaNClave15       = "";
     &eaNSubCl15       = "";

     nCamp0            = 0;
     nCamp1            = 0;
     nCamp2            = 0;
     nCamp3            = 0;
     nCamp4            = 0;
     nCamp5            = 0;
|FIN;

|INCLUYE i_variar;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\
|PROCESO Modelo; |TIPO 0;
  |SI #dsmoz067#54 ! 110; |Y #dsmoz067#54 ! 190;
      |C_M #dsmoz067#54,1,"S";
      |ERROR;
      |ACABA;
  |FINSI;

  |SI #dsmoz067#54 = 110;
      |SI #dsmoz067#0 = 99;
          #dsmoz067#0 = 3;       |PINTA #dsmoz067#0;
          #dsmoz067#1 = "MARZO"; |PINTA #dsmoz067#1;
      |FINSI;
      |C_M #dsmoz067#0,1,"S";
      |C_M #dsmoz067#52, 1, "S";
      |C_M #dsmoz067#53, 1, "S";
  |FINSI;

  |SI #dsmoz067#54 = 190;
      #dsmoz067#0 = 99;      |PINTA #dsmoz067#0;
      #dsmoz067#1 = "ANUAL"; |PINTA #dsmoz067#1;
      |C_M #dsmoz067#0,  1, "N";
      |C_M #dsmoz067#52, 1, "N";
      |C_M #dsmoz067#53, 1, "N";
  |FINSI;
|FPRC;

|PROCESO Periodo;
     nCampo   = Campo + 1;
     #dsmoz067#nCampo# = "          ";
     |SI #dsmoz067#Campo# = 1;   #dsmoz067#nCampo# = "ENERO     ";  |FINSI;
     |SI #dsmoz067#Campo# = 2;   #dsmoz067#nCampo# = "FEBRERO   ";  |FINSI;
     |SI #dsmoz067#Campo# = 3;   #dsmoz067#nCampo# = "MARZO     ";  |FINSI;
     |SI #dsmoz067#Campo# = 4;   #dsmoz067#nCampo# = "ABRIL     ";  |FINSI;
     |SI #dsmoz067#Campo# = 5;   #dsmoz067#nCampo# = "MAYO      ";  |FINSI;
     |SI #dsmoz067#Campo# = 6;   #dsmoz067#nCampo# = "JUNIO     ";  |FINSI;
     |SI #dsmoz067#Campo# = 7;   #dsmoz067#nCampo# = "JULIO     ";  |FINSI;
     |SI #dsmoz067#Campo# = 8;   #dsmoz067#nCampo# = "AGOSTO    ";  |FINSI;
     |SI #dsmoz067#Campo# = 9;   #dsmoz067#nCampo# = "SEPTIEMBRE";  |FINSI;
     |SI #dsmoz067#Campo# = 10;  #dsmoz067#nCampo# = "OCTUBRE   ";  |FINSI;
     |SI #dsmoz067#Campo# = 11;  #dsmoz067#nCampo# = "NOVIEMBRE ";  |FINSI;
     |SI #dsmoz067#Campo# = 12;  #dsmoz067#nCampo# = "DICIEMBRE ";  |FINSI;
     |SI #dsmoz067#Campo# = 99;  #dsmoz067#nCampo# = "ANUAL     ";  |FINSI;

     |SI #dsmoz067#nCampo# = "          ";
         |MENAV "     Periodo Incorrecto.";
         |ERROR;
     |FINSI;

     |PINTA #dsmoz067#nCampo#;
|FPRC;

|PROCESO defecto; |TIPO 7;
|FPRC;

|PROCESO Parrilla;
     |SI #dsmoz067#3 = 0;
         #dsmoz067#3 = 0;  |PINTA #dsmoz067#3;
         #dsmoz067#4 = 0;  |PINTA #dsmoz067#4;  |C_M #dsmoz067#4, 1, "N";
         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoz067#nCampo#, 1, "S";
         |SIGUE;
     |SINO;
         |C_M #dsmoz067#3, 1, "S";
         |C_M #dsmoz067#4, 1, "S";

         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoz067#nCampo#, 1, "N";
               #dsmoz067#nCampo# = 0;  |PINTA #dsmoz067#nCampo#;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #dsmoz067#Campo# = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               #dsmoz067#nCampo# = 0;  |C_M #dsmoz067#nCampo#, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoz067#nCampo#, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO LasClaves; |TIPO 0;
     aAlfa1 = "S";
     |SI #dsmoz067#22 = "S"; aAlfa1 = "N"; |FINSI;
     |PARA nCampo = 23;  |SI nCampo [ 34;  |HACIENDO nCampo = nCampo + 1;
           |C_M #dsmoz067#nCampo#, 1, aAlfa1;

           |SI aAlfa1 = "N";
               #dsmoz067#nCampo# = ""; |PINTA #dsmoz067#nCampo#;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO repetir;
     aAlfa = #dsmoz067#17; |QBF aAlfa;
     |SI aAlfa ! "";
         |SI #dsmoz067#18 = "zzzzzzzzzzzz";
             #dsmoz067#18 = #dsmoz067#17; |PINTA #dsmoz067#18;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CambioSN;

     aAlfa1 = #dsmoz067#Campo#;
     nCampo = Campo + 1; |C_M #dsmoz067#nCampo#, 1, aAlfa1;

     |SI aAlfa1 = "N";
         #dsmoz067#nCampo# = ""; |PINTA #dsmoz067#nCampo#;
         |SI Campo = 41; #dsmoz067#50 = ""; #dsmoz067#51 = 00; |FINSI;
     |FINSI;

     |SI Campo = 47;
         |C_M #dsmoz067#49, 1, aAlfa1;
         |SI aAlfa1 = "N"; #dsmoz067#49 = ""; |PINTA #dsmoz067#49; |FINSI;
     |FINSI;
|FPRC;

|PROCESO PonDatosNif; |TIPO 6;
     |C_M #dsmoz067#42, 0, aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     eaCodNif  = #dsmoz067#42;
     |HAZ LeeNifs;

     #dsmoz067#50 = #regisnif@#1; |PINTA #dsmoz067#50;
     #dsmoz067#51 = #regisnif@#4;
|FPRC;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\

|PROCESO SelClave;
   nBorrar = 1;
   |SI #dsmoz067#22 = "N";
       nBorrar = 0;
       |SI #dsmoz067#23 = aClave; |Y #dsmoz067#24 = aSubClave; nBorrar = 1; |FINSI;
       |SI #dsmoz067#25 = aClave; |Y #dsmoz067#26 = aSubClave; nBorrar = 1; |FINSI;
       |SI #dsmoz067#27 = aClave; |Y #dsmoz067#28 = aSubClave; nBorrar = 1; |FINSI;
       |SI #dsmoz067#29 = aClave; |Y #dsmoz067#30 = aSubClave; nBorrar = 1; |FINSI;
       |SI #dsmoz067#31 = aClave; |Y #dsmoz067#32 = aSubClave; nBorrar = 1; |FINSI;
       |SI #dsmoz067#33 = aClave; |Y #dsmoz067#34 = aSubClave; nBorrar = 1; |FINSI;
   |FINSI;
|FPRC;

|| ///////////////////////////
|PROCESO dsmoc110;

    aClave    = #dsmoc110#8;
    aSubClave = #dsmoc110#9;
    |HAZ SelClave;
    |SI nBorrar = 0; |ACABA; |FINSI;

    aNif      = #dsmoc110#6;  |SI #dsmoz067#41 = "S"; aNif      = #dsmoz067#42; |FINSI;
    nDevengo  = #dsmoc110#7;  |SI #dsmoz067#43 = "S"; nDevengo  = #dsmoz067#44; |FINSI;
    aClave    = #dsmoc110#8;
    aSubClave = #dsmoc110#9;  |SI #dsmoz067#47 = "S"; aClave    = #dsmoz067#48;
                                          aSubClave = #dsmoz067#49; |FINSI;

    |SI aNif ! #dsmoc110#6; |O nDevengo ! #dsmoc110#7;
        |O aClave ! #dsmoc110#8; |O aSubClave ! #dsmoc110#9;

        |DDEFECTO #dsmodel@;
        #dsmodel@#0  = #dsmoc110#0;
        #dsmodel@#01 = #dsmoc110#01;
        #dsmodel@#02 = #dsmoc110#02;
        #dsmodel@#03 = #dsmoc110#03;
        #dsmodel@#04 = #dsmoc110#04;
        #dsmodel@#05 = #dsmoc110#05;
        #dsmodel@#06 = aNif;
        #dsmodel@#07 = nDevengo;
        #dsmodel@#08 = aClave;
        #dsmodel@#09 = aSubClave;
        |LEE 141#dsmodel@.=;
        |SI FSalida ! 0;
            |DDEFECTO #dsmodel@;
            |PARA nPara1 = 0; |SI nPara1 [ 31; |HACIENDO nPara1 = nPara1 + 1;
                  #dsmodel@#nPara1# = #dsmoc110#nPara1#;
            |SIGUE;
            #dsmodel@#06 = aNif;
            #dsmodel@#07 = nDevengo;
            #dsmodel@#08 = aClave;
            #dsmodel@#09 = aSubClave;
            |SI aNif ! #dsmoc110#6;
                #dsmodel@#29 = #dsmoz067#50;
            |FINSI;
            |GRABA 020#dsmodel@.n;
        |SINO;
            |SI #dsmoz067#38 = "S";
                |PARA nPara1 = 10; |SI nPara1 [ 28; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsmoc110#nPara1#;
                |SIGUE;
                #dsmodel@#30 = #dsmoc110#30;
                #dsmodel@#31 = #dsmoc110#31;
                |SI aNif ! #dsmoc110#6;
                    #dsmodel@#29 = #dsmoz067#50;
                |FINSI;
            |SINO;
                |PARA nPara1 = 10; |SI nPara1 [ 28; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsmodel@#nPara1# + #dsmoc110#nPara1#;
                |SIGUE;
                #dsmodel@#30 = #dsmodel@#30 + #dsmoc110#30;
                #dsmodel@#31 = #dsmodel@#31 + #dsmoc110#31;
            |FINSI;
            |GRABA 020#dsmodel@.a;
        |FINSI;
        |LIBERA #dsmodel@;

        |BORRA 020#dsmoc110.a;
        nCambio = 1;
    |FINSI;

    |LIBERA #dsmoc110;
|FPRC;

|DEFBUCLE dsmoc110;
 #dsmoc110#1;
 ;
 nEmpresa,nEjer,nPer,nMod,nCpl,#dsmoz067#52,#dsmoz067#17,#dsmoz067#19," ","  ";
 nEmpresa,nEjer,nPer,nMod,nCpl,#dsmoz067#53,#dsmoz067#18,#dsmoz067#20,"z","zz";
 be;
 NULL, dsmoc110;
|FIN;

|PROCESO dsmoc111;
    aClave    = #dsmoc111#9;
    aSubClave = #dsmoc111#10;
    |HAZ SelClave;
    |SI nBorrar = 0; |ACABA; |FINSI;

    aNif      = #dsmoc111#6;  |SI #dsmoz067#41 = "S"; aNif      = #dsmoz067#42; |FINSI;
    nDevengo  = #dsmoc111#7;  |SI #dsmoz067#43 = "S"; nDevengo  = #dsmoz067#44; |FINSI;
    nRelacion = #dsmoc111#11; |SI #dsmoz067#45 = "S"; nRelacion = #dsmoz067#46; |FINSI;
    aClave    = #dsmoc111#9;
    aSubClave = #dsmoc111#10; |SI #dsmoz067#47 = "S"; aClave    = #dsmoz067#48;
                                          aSubClave = #dsmoz067#49; |FINSI;

    |SI aNif ! #dsmoc111#6; |O nDevengo ! #dsmoc111#7; |O nRelacion ! #dsmoc111#11;
        |O aClave ! #dsmoc111#9; |O aSubClave ! #dsmoc111#10;

        |DDEFECTO #dsmodel@;
        #dsmodel@#0  = #dsmoc111#0;
        #dsmodel@#01 = #dsmoc111#01;
        #dsmodel@#02 = #dsmoc111#02;
        #dsmodel@#03 = #dsmoc111#03;
        #dsmodel@#04 = #dsmoc111#04;
        #dsmodel@#05 = #dsmoc111#05;
        #dsmodel@#06 = aNif;
        #dsmodel@#07 = nDevengo;
        #dsmodel@#08 = #dsmoc111#08;
        #dsmodel@#09 = aClave;
        #dsmodel@#10 = aSubClave;
        #dsmodel@#11 = nRelacion;
        |LEE 141#dsmodel@.=;
        |SI FSalida ! 0;
            |DDEFECTO #dsmodel@;
            |PARA nPara1 = 0; |SI nPara1 [ 24; |HACIENDO nPara1 = nPara1 + 1;
                  #dsmodel@#nPara1# = #dsmoc111#nPara1#;
            |SIGUE;
            #dsmodel@#06 = aNif;
            #dsmodel@#07 = nDevengo;
            #dsmodel@#09 = aClave;
            #dsmodel@#10 = aSubClave;
            #dsmodel@#11 = nRelacion;
            |SI aNif ! #dsmoc111#6;
                #dsmodel@#21 = #dsmoz067#50;
            |FINSI;
            |GRABA 020#dsmodel@.n;
        |SINO;
            |SI #dsmoz067#38 = "S";
                |PARA nPara1 = 12; |SI nPara1 [ 20; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsmoc111#nPara1#;
                |SIGUE;
                #dsmodel@#22 = #dsmoc111#22;
                #dsmodel@#23 = #dsmoc111#23;
                |SI aNif ! #dsmoc111#6;
                    #dsmodel@#21 = #dsmoz067#50;
                |FINSI;
            |SINO;
                |PARA nPara1 = 12; |SI nPara1 [ 20; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsmodel@#nPara1# + #dsmoc111#nPara1#;
                |SIGUE;
                #dsmodel@#22 = #dsmodel@#22 + #dsmoc111#22;
                #dsmodel@#23 = #dsmodel@#23 + #dsmoc111#23;
            |FINSI;
            |GRABA 020#dsmodel@.a;
        |FINSI;
        |LIBERA #dsmodel@;

        |BORRA 020#dsmoc111.a;
        nCambio = 1;
    |FINSI;

    |LIBERA #dsmoc111;
|FPRC;

|DEFBUCLE dsmoc111;
  #dsmoc111#1;
  ;
  nEmpresa,nEjer,nPer,nMod,nCpl,#dsmoz067#52,#dsmoz067#17,#dsmoz067#19,00," ","  ",#dsmoz067#39;
  nEmpresa,nEjer,nPer,nMod,nCpl,#dsmoz067#53,#dsmoz067#18,#dsmoz067#20,99,"z","zz",#dsmoz067#40;
  be;
  NULL, dsmoc111;
|FIN;

|PROCESO dsm11101;
    aClave    = #dsm11101#9;
    aSubClave = #dsm11101#10;
    |HAZ SelClave;
    |SI nBorrar = 0; |ACABA; |FINSI;

    aNif      = #dsm11101#6;  |SI #dsmoz067#41 = "S"; aNif      = #dsmoz067#42; |FINSI;
    nDevengo  = #dsm11101#7;  |SI #dsmoz067#43 = "S"; nDevengo  = #dsmoz067#44; |FINSI;
    nRelacion = #dsm11101#11; |SI #dsmoz067#45 = "S"; nRelacion = #dsmoz067#46; |FINSI;
    aClave    = #dsm11101#9;
    aSubClave = #dsm11101#10; |SI #dsmoz067#47 = "S"; aClave    = #dsmoz067#48;
                                          aSubClave = #dsmoz067#49; |FINSI;

    |SI aNif ! #dsm11101#6; |O nDevengo ! #dsm11101#7; |O nRelacion ! #dsm11101#11;
        |O aClave ! #dsm11101#9; |O aSubClave ! #dsm11101#10;

        |DDEFECTO #dsmodel@;
        #dsmodel@#0  = #dsm11101#0;
        #dsmodel@#01 = #dsm11101#01;
        #dsmodel@#02 = #dsm11101#02;
        #dsmodel@#03 = #dsm11101#03;
        #dsmodel@#04 = #dsm11101#04;
        #dsmodel@#05 = #dsm11101#05;
        #dsmodel@#06 = aNif;
        #dsmodel@#07 = nDevengo;
        #dsmodel@#08 = #dsm11101#08;
        #dsmodel@#09 = aClave;
        #dsmodel@#10 = aSubClave;
        #dsmodel@#11 = nRelacion;
        |LEE 141#dsmodel@.=;
        |SI FSalida ! 0;
            |DDEFECTO #dsmodel@;
            |PARA nPara1 = 0; |SI nPara1 [ 29; |HACIENDO nPara1 = nPara1 + 1;
                  #dsmodel@#nPara1# = #dsm11101#nPara1#;
            |SIGUE;
            #dsmodel@#06 = aNif;
            #dsmodel@#07 = nDevengo;
            #dsmodel@#09 = aClave;
            #dsmodel@#10 = aSubClave;
            #dsmodel@#11 = nRelacion;
            |SI aNif ! #dsm11101#6;
                #dsmodel@#21 = #dsmoz067#50;
            |FINSI;
            |GRABA 020#dsmodel@.n;
        |SINO;
            |SI #dsmoz067#38 = "S";
                |PARA nPara1 = 12; |SI nPara1 [ 20; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsm11101#nPara1#;
                |SIGUE;

                |PARA nPara1 = 25; |SI nPara1 [ 29; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsm11101#nPara1#;
                |SIGUE;

                #dsmodel@#22 = #dsm11101#22;
                #dsmodel@#23 = #dsm11101#23;
                |SI aNif ! #dsm11101#6;
                    #dsmodel@#21 = #dsmoz067#50;
                |FINSI;
            |SINO;
                |PARA nPara1 = 12; |SI nPara1 [ 20; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsmodel@#nPara1# + #dsm11101#nPara1#;
                |SIGUE;

                |PARA nPara1 = 25; |SI nPara1 [ 29; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsmodel@#nPara1# + #dsm11101#nPara1#;
                |SIGUE;

                #dsmodel@#22 = #dsmodel@#22 + #dsm11101#22;
                #dsmodel@#23 = #dsmodel@#23 + #dsm11101#23;
            |FINSI;
            |GRABA 020#dsmodel@.a;
        |FINSI;
        |LIBERA #dsmodel@;

        |BORRA 020#dsm11101.a;
        nCambio = 1;
    |FINSI;

    |LIBERA #dsm11101;
|FPRC;

|DEFBUCLE dsm11101;
  #dsm11101#1;
  ;
  nEmpresa,nEjer,nPer,nMod,nCpl,#dsmoz067#52,#dsmoz067#17,#dsmoz067#19,00," ","  ",#dsmoz067#39;
  nEmpresa,nEjer,nPer,nMod,nCpl,#dsmoz067#53,#dsmoz067#18,#dsmoz067#20,99,"z","zz",#dsmoz067#40;
  be;
  NULL, dsm11101;
|FIN;

|| ///////////////////////////
|PROCESO dsm190li;
    aClave    = #dsm190li#8;
    aSubClave = #dsm190li#9;
    |HAZ SelClave;
    |SI nBorrar = 0; |ACABA; |FINSI;

    aNif      = #dsm190li#6;  |SI #dsmoz067#41 = "S"; aNif      = #dsmoz067#42; |FINSI;
    nDevengo  = #dsm190li#7;  |SI #dsmoz067#43 = "S"; nDevengo  = #dsmoz067#44; |FINSI;
    nRelacion = #dsm190li#10; |SI #dsmoz067#45 = "S"; nRelacion = #dsmoz067#46; |FINSI;
    aClave    = #dsm190li#8;
    aSubClave = #dsm190li#9;  |SI #dsmoz067#47 = "S"; aClave    = #dsmoz067#48;
                                          aSubClave = #dsmoz067#49; |FINSI;

    |SI aNif ! #dsm190li#6; |O nDevengo ! #dsm190li#7; |O nRelacion ! #dsm190li#10;
        |O aClave ! #dsm190li#8; |O aSubClave ! #dsm190li#9;

        |DDEFECTO #dsmodel@;
        #dsmodel@#0  = #dsm190li#0;
        #dsmodel@#01 = #dsm190li#01;
        #dsmodel@#02 = #dsm190li#02;
        #dsmodel@#03 = #dsm190li#03;
        #dsmodel@#04 = #dsm190li#04;
        #dsmodel@#05 = #dsm190li#05;
        #dsmodel@#06 = aNif;
        #dsmodel@#07 = nDevengo;
        #dsmodel@#08 = aClave;
        #dsmodel@#09 = aSubClave;
        #dsmodel@#10 = nRelacion;
        |LEE 141#dsmodel@.=;
        |SI FSalida ! 0;
            |DDEFECTO #dsmodel@;
            |PARA nPara1 = 0; |SI nPara1 [ 64; |HACIENDO nPara1 = nPara1 + 1;
                  #dsmodel@#nPara1# = #dsm190li#nPara1#;
            |SIGUE;
            #dsmodel@#06 = aNif;
            #dsmodel@#07 = nDevengo;
            #dsmodel@#08 = aClave;
            #dsmodel@#09 = aSubClave;
            #dsmodel@#10 = nRelacion;
            |SI aNif ! #dsm190li#6;
                #dsmodel@#12 = #dsmoz067#50;
                #dsmodel@#13 = #dsmoz067#51;
            |FINSI;
            |GRABA 020#dsmodel@.n;
        |SINO;
            |SI #dsmoz067#38 = "S";
                |PARA nPara1 = 16; |SI nPara1 [ 24; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsm190li#nPara1#;
                |SIGUE;
                |SI aNif ! #dsm190li#6;
                    #dsmodel@#12 = #dsmoz067#50;
                    #dsmodel@#13 = #dsmoz067#51;
                |FINSI;
            |SINO;
                |PARA nPara1 = 16; |SI nPara1 [ 24; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsmodel@#nPara1# + #dsm190li#nPara1#;
                |SIGUE;
            |FINSI;
            |GRABA 020#dsmodel@.a;
        |FINSI;
        |LIBERA #dsmodel@;

        |BORRA 020#dsm190li.a;
        nCambio = 1;
    |FINSI;

    |LIBERA #dsm190li;
|FPRC;

|DEFBUCLE dsm190li;
     #dsm190li#1;
     ;
     nEmpresa, nEjer, nPer, nMod, nCpl, 00, #dsmoz067#17, #dsmoz067#19, " ", "  ", #dsmoz067#39;
     nEmpresa, nEjer, nPer, nMod, nCpl, 99, #dsmoz067#18, #dsmoz067#20, "z", "zz", #dsmoz067#40;
     be;
     NULL, dsm190li;
|FIN;

|PROCESO dsm19001;
    aClave    = #dsm19001#8;
    aSubClave = #dsm19001#9;
    |HAZ SelClave;
    |SI nBorrar = 0; |ACABA; |FINSI;

    aNif      = #dsm19001#6;  |SI #dsmoz067#41 = "S"; aNif      = #dsmoz067#42; |FINSI;
    nDevengo  = #dsm19001#7;  |SI #dsmoz067#43 = "S"; nDevengo  = #dsmoz067#44; |FINSI;
    nRelacion = #dsm19001#10; |SI #dsmoz067#45 = "S"; nRelacion = #dsmoz067#46; |FINSI;
    aClave    = #dsm19001#8;
    aSubClave = #dsm19001#9;  |SI #dsmoz067#47 = "S"; aClave    = #dsmoz067#48;
                                          aSubClave = #dsmoz067#49; |FINSI;

    |SI aNif ! #dsm19001#6; |O nDevengo ! #dsm19001#7; |O nRelacion ! #dsm19001#10;
        |O aClave ! #dsm19001#8; |O aSubClave ! #dsm19001#9;

        |DDEFECTO #dsmodel@;
        #dsmodel@#0  = #dsm19001#0;
        #dsmodel@#01 = #dsm19001#01;
        #dsmodel@#02 = #dsm19001#02;
        #dsmodel@#03 = #dsm19001#03;
        #dsmodel@#04 = #dsm19001#04;
        #dsmodel@#05 = #dsm19001#05;
        #dsmodel@#06 = aNif;
        #dsmodel@#07 = nDevengo;
        #dsmodel@#08 = aClave;
        #dsmodel@#09 = aSubClave;
        #dsmodel@#10 = nRelacion;
        |LEE 141#dsmodel@.=;
        |SI FSalida ! 0;
            |DDEFECTO #dsmodel@;
            |PARA nPara1 = 0; |SI nPara1 [ 69; |HACIENDO nPara1 = nPara1 + 1;
                  #dsmodel@#nPara1# = #dsm19001#nPara1#;
            |SIGUE;
            #dsmodel@#06 = aNif;
            #dsmodel@#07 = nDevengo;
            #dsmodel@#08 = aClave;
            #dsmodel@#09 = aSubClave;
            #dsmodel@#10 = nRelacion;
            |SI aNif ! #dsm19001#6;
                #dsmodel@#12 = #dsmoz067#50;
                #dsmodel@#13 = #dsmoz067#51;
            |FINSI;
            |GRABA 020#dsmodel@.n;
        |SINO;
            |SI #dsmoz067#38 = "S";
                |PARA nPara1 = 16; |SI nPara1 [ 24; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsm19001#nPara1#;
                |SIGUE;

                |PARA nPara1 = 65; |SI nPara1 [ 69; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsm19001#nPara1#;
                |SIGUE;

                |SI aNif ! #dsm19001#6;
                    #dsmodel@#12 = #dsmoz067#50;
                    #dsmodel@#13 = #dsmoz067#51;
                |FINSI;
            |SINO;
                |PARA nPara1 = 16; |SI nPara1 [ 24; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsmodel@#nPara1# + #dsm19001#nPara1#;
                |SIGUE;

                |PARA nPara1 = 65; |SI nPara1 [ 69; |HACIENDO nPara1 = nPara1 + 1;
                      #dsmodel@#nPara1# = #dsmodel@#nPara1# + #dsm19001#nPara1#;
                |SIGUE;
            |FINSI;
            |GRABA 020#dsmodel@.a;
        |FINSI;
        |LIBERA #dsmodel@;

        |BORRA 020#dsm19001.a;
        nCambio = 1;
    |FINSI;

    |LIBERA #dsm19001;
|FPRC;

|DEFBUCLE dsm19001;
     #dsm19001#1;
     ;
     nEmpresa, nEjer, nPer, nMod, nCpl, 00, #dsmoz067#17, #dsmoz067#19, " ", "  ", #dsmoz067#39;
     nEmpresa, nEjer, nPer, nMod, nCpl, 99, #dsmoz067#18, #dsmoz067#20, "z", "zz", #dsmoz067#40;
     be;
     NULL, dsm19001;
|FIN;

|PROCESO dsmom004;

    nPer = #dsmom004#2;
    nCpl = #dsmom004#4;

    |SI #dsmom004#13 = "X"; |Y #dsmoz067#57 = "N"; |ACABA; |FINSI;  ||no los archivados
    |SI #dsmom004#9  = "X"; |Y #dsmoz067#56 = "N"; |ACABA; |FINSI;  ||no los impresos

    |SI nMod = 110;
        nCambio = 0;

        |ABRE #dsmodel@;
        |SI #dsmoz067#2 [ 2010;  |BUCLE dsmoc110;  |FINSI;
        |SI #dsmoz067#2 = 2011;  |BUCLE dsmoc111;  |FINSI;
        |SI #dsmoz067#2 = 2012;  |BUCLE dsmoc111;  |FINSI;
        |SI #dsmoz067#2 = 2013;  |BUCLE dsmoc111;  |FINSI;
        |SI #dsmoz067#2 = 2014;  |BUCLE dsmoc111;  |FINSI;
        |SI #dsmoz067#2 = 2015;  |BUCLE dsmoc111;  |FINSI;
        |SI #dsmoz067#2 ] 2016;  |BUCLE dsm11101;  |FINSI;
        |CIERRA #dsmodel@;

        |SI nCambio = 1; |Y aParam ! "ES2018";
            enDesdePase = 1;
            enEmpresa   = nEmpresa;
            enEjer      = nEjer;
            enPeriodo   = nPer;
            enModelo    = 110;
            enComplem   = nCpl;
            enTipoEntrada = 98;
            |SI #dsmoz067#2 [ 2010;
                |SUB_EJECUTA_NP "dsmoc110";
            |SINO;
                |SI #dsmoz067#2 [ 2015;
                    |SUB_EJECUTA_NP "dsmoc111";
                |SINO;
                    |SUB_EJECUTA_NP "dsm11101";
                |FINSI;
            |FINSI;

            |HAZ ChequeaSituacion;  || Esta en el PLB

            |SI SwEsp2015 = 0;
                #dsmom004#9  = " ";
                #dsmom004#10 = "01.0.0000";
                #dsmom004#13 = " ";
                #dsmom004#14 = "01.0.0000";
            |FINSI;
            |GRABA 020#dsmom004.a;
            enDesdePase = 0;
        |FINSI;
    |FINSI;

    |SI nMod = 190;
        nCambio = 0;
        |ABRE #dsmodel@;

        |SI #dsmoz067#2 [ 2015;
            |BUCLE dsm190li;
        |FINSI;

        |SI #dsmoz067#2 ] 2016;
            |BUCLE dsm19001;
        |FINSI;

        |CIERRA #dsmodel@;

        |SI nCambio = 1; |Y aParam ! "ES2018";
            enEmpresa   = nEmpresa;
            enEjer      = nEjer;
            enPeriodo   = nPer;
            enModelo    = nMod;
            enComplem   = nCpl;
            enActividad = 0;
            enMensa       = 1;
            enTipoEntrada = 98;
            |SUB_EJECUTA_NP "dsm190ca";

            |SI SwEsp2015 = 0;
                #dsmom004#7  = "X";
                #dsmom004#8  = ~;
                #dsmom004#9  = " ";
                #dsmom004#10 = "01.0.0000";
                #dsmom004#13 = " ";
                #dsmom004#14 = "01.0.0000";
            |FINSI;
            #dsmom004#15 = 0;
            #dsmom004#17 = "COMPLETADO";

            |GRABA 020#dsmom004.a;
       |FINSI;
    |FINSI;


    |LIBERA #dsmom004;
|FPRC;

|DEFBUCLE dsmom004;
   #dsmom004#1;
   ;
   nEmpresa, nEjer, nDPeriodo, nMod, nDComplem;
   nEmpresa, nEjer, nHPeriodo, nMod, nHComplem;
   be;
   NULL, dsmom004;
|FIN;

|PROCESO agifigen;

   nEmpresa = #agifigen#0;

   |BUCLE dsmom004;
|FPRC;

|DEFBUCLE agifigen;
     #agifigen#1;
     ;
     nDEmpresa;
     nHEmpresa;
     ;
     NULL, agifigen;
|FIN;

|PROCESO Tipo3;  |TIPO 3;

     nMod      = #dsmoz067#54;
     nEjer     = #dsmoz067#2;
     nDPeriodo = #dsmoz067#0;
     |SI SwEsp2015 = 1; |O aParam = "ES2018";
         |SI nMod = 110; nDPeriodo = 1; |FINSI;
     |FINSI;
     nHPeriodo = #dsmoz067#0;
     nDComplem = #dsmoz067#35;
     nHComplem = #dsmoz067#36;

     |SI nMod = 110;
         aNomDef = "dsmoc111.mas";
         |SI #dsmoz067#2 [ 2010; aNomDef = "dsmoc110.mas"; |FINSI;
         |SI #dsmoz067#2 ] 2016; aNomDef = "dsm11101.mas"; |FINSI;
     |SINO;
         |SI #dsmoz067#2 [ 2015; aNomDef = "dsm190li.mas"; |FINSI;
         |SI #dsmoz067#2 ] 2016; aNomDef = "dsm19001.mas"; |FINSI;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/"+ aNomDef;
     |CARGA_DEF aMas, dsmodel@;
     |SI FSalida ! 0;
         aAlfa = "    Error al carga el def " + aNomDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI #dsmoz067#3 ! 0;
         nDEmpresa = #dsmoz067#3;
         nHEmpresa = #dsmoz067#4;
         |BUCLE agifigen;
     |SINO;
         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |SI #dsmoz067#nCampo# ! 0;
                   nDEmpresa = #dsmoz067#nCampo#;
                   nHEmpresa = #dsmoz067#nCampo#;
                   |BUCLE agifigen;
               |FINSI;
         |SIGUE;
     |FINSI;

     |DESCARGA_DEF #dsmodel@;
|FPRC;

|PROCESO Baja73;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = "";
     #dsmom073#2 = "";
|FPRC;

|PROCESO Alta73;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = "z";
     #dsmom073#2 = "zz";
|FPRC;

|PROCESO T66; |TIPO 66;
     nCamp1 = 48;
     nCamp2 = 49;

     enEjerIRPF = #dsmoz067#2;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #dsmoz067#nCamp1#;
     #dsmom073#2 = #dsmoz067#nCamp2#;
     |LEE 000#dsmom073.];

     |CONSULTA_F_CLAVE #1#dsmom073, Baja73, Alta73;
     |SI FSalida = 0;
          #dsmoz067#nCamp1# = #dsmom073#1;    |PINTA #dsmoz067#nCamp1#;
          #dsmoz067#nCamp2# = #dsmom073#2;    |PINTA #dsmoz067#nCamp2#;
     |FINSI;
     |CIERRA #dsmom073;

     |ERROR;
|FPRC;

|PROCESO T0; |TIPO 0;
     nCamp1 = Campo - 1;
     nCamp2 = Campo;

     |SI #dsmoz067#nCamp1# = " ";  |Y #dsmoz067#nCamp2# = "  ";
         |ACABA;
     |FINSI;

     enEjerIRPF = #dsmoz067#2;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #dsmoz067#nCamp1#;
     #dsmom073#2 = #dsmoz067#nCamp2#;
     |LEE 000#dsmom073.=;
     |SI FSalida ! 0;
         aAlfa = "0000Clave no correcta en el ejercicio " + enEjerIRPF;
         |MENAV aAlfa;
         |ERROR;
     |FINSI;
     |CIERRA #dsmom073;
|FPRC;

|PROGRAMA;
 aParam = PARAMETRO; |QBF aParam;

 |SI aParam = "ES2018";

     nCamp0 = enEmpresa;
     nCamp1 = enEjer;
     nCamp2 = enPeriodo;
     nCamp3 = enModelo;
     nCamp4 = enComplem;
     nCamp5 = enActividad;

  || ... Cambiar modelo 110;
     |DDEFECTO #dsmoz067;
     #dsmoz067#54 = 110;
     #dsmoz067#0  = 12;
     #dsmoz067#2  = 2018;
     #dsmoz067#3  = 00001;
     #dsmoz067#4  = 99999;
     #dsmoz067#22 = "N";
     #dsmoz067#23 = "L";
     #dsmoz067#24 = "25";
     #dsmoz067#38 = "S";
     #dsmoz067#47 = "S";
     #dsmoz067#48 = "L";
     #dsmoz067#49 = "28";
     #dsmoz067#56 = "S";
     #dsmoz067#57 = "S";
     |HAZ Tipo3;

  || ... Cambiar modelo 190;
     |DDEFECTO #dsmoz067;
     #dsmoz067#54 = 190;
     #dsmoz067#0  = 99;
     #dsmoz067#2  = 2018;
     #dsmoz067#3  = 00001;
     #dsmoz067#4  = 99999;
     #dsmoz067#22 = "N";
     #dsmoz067#23 = "L";
     #dsmoz067#24 = "25";
     #dsmoz067#38 = "S";
     #dsmoz067#47 = "S";
     #dsmoz067#48 = "L";
     #dsmoz067#49 = "28";
     #dsmoz067#56 = "S";
     #dsmoz067#57 = "S";
     |HAZ Tipo3;

     enEmpresa   = nCamp0;
     enEjer      = nCamp1;
     enPeriodo   = nCamp2;
     enModelo    = nCamp3;
     enComplem   = nCamp4;
     enActividad = nCamp5;

     |ACABA;
 |FINSI;

 |SI SwEsp2015 = 1;
     nCamp0 = enEmpresa;
     nCamp1 = enEjer;
     nCamp2 = enPeriodo;
     nCamp3 = enModelo;
     nCamp4 = enComplem;
     nCamp5 = enActividad;

     |DDEFECTO #dsmoz067;
     #dsmoz067#54 = aParam;
     #dsmoz067#0  = 10;
     |SI #dsmoz067#54 = 190;                     #dsmoz067#0 = 99; |FINSI;
     |SI #dsmoz067#54 = 110; |Y eaClave15 = "A"; #dsmoz067#0 = 12; |FINSI;
     #dsmoz067#2  = 2015;
     #dsmoz067#3  = enEmp15;
     #dsmoz067#4  = enEmp15;
     #dsmoz067#22 = "N";
     #dsmoz067#23 = eaClave15;
     #dsmoz067#24 = eaSubCl15;
     #dsmoz067#38 = "S";
     #dsmoz067#47 = "S";
     #dsmoz067#48 = eaNClave15;
     #dsmoz067#49 = eaNSubCl15;
     #dsmoz067#56 = "S";
     #dsmoz067#57 = "S";
     |HAZ Tipo3;

     enEmpresa   = nCamp0;
     enEjer      = nCamp1;
     enPeriodo   = nCamp2;
     enModelo    = nCamp3;
     enComplem   = nCamp4;
     enActividad = nCamp5;
 |SINO;
     |DDEFECTO #dsmoz067;
     |ABRE #dsmoz067;
     |LEE 101#dsmoz067.p;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoz067;
         fFecha = ~;
         aAlfa  = fFecha % -104;
         #dsmoz067#2   = aAlfa;
         #dsmoz067#2   = #dsmoz067#2 - 1;
         |GRABA 020#dsmoz067.b;
     |FINSI;

     |CLS;
     |PINPA #0#dsmoz067;

     |C_M #dsmoz067#54,1, "S";
     |SI aParam ! "";
         #dsmoz067#54 = aParam; |C_M #dsmoz067#54,1, "N";

         |ATRI R; |PINTA 0566, aParam;
         |ATRI 0; |PINTA 0569, "          ";
         |SI aParam = "110";
             |ATRI R;
             |PINTA 0566, "110/111";
             |ATRI 0;
         |FINSI;
     |FINSI;

     |PINDA #0#dsmoz067;

     |ENDATOS #1#dsmoz067;
     |SI FSalida = 0;
         |GRABA 020#dsmoz067.a;
     |FINSI;
     |LIBERA #dsmoz067;
     |CIERRA #dsmoz067;
 |FINSI;
|FPRO;
