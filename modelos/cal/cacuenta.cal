|| Atencion, Calculo de MODELOS, no es el mismo que el de CONTAGEN

|FICHEROS;
   :/contagen/def/cacuenta #0,MANTE;    || cuentas

   :/contagen/def/cacuebal #5;    || cuentas de balance
   :/contagen/def/caparbal #6;    || partidas balances
   :/contagen/def/caparexp #7;    || partidas explotacion
   :/contagen/def/caagrupa #8;    || agrupaciones
   :/contagen/def/caepigra #9;    || epigrafes

   :/contagen/def/cactrlal #11;   || control altas en otras empresas.
   :/contagen/def/caclipro #21;   || Clientes y Proveedores
   :/contagen/def/canempre #30;

   :/contagen/def/ca8cumay #410;
   :/contagen/def/ca8m0002 #422;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|VARIABLES;
   men1     = "     NO EXISTE EMPRESA !";
   men2     = "     LONGITUD DE CUENTA FUERA DE NIVEL !";
   men3     = "     CUENTA ERRONEA !!";
   error    = "     CLAVE EXISTENTE !";
   valida   = "     Conforme S/N.:";
   mascara  = "";
   digito2  = "  ";
   num      = 0;
   sw       = 0;
   mes      = "                ";
   me       = 0;
   cta      = "            ";
   ctanum   = 0;
   ctaalf   = " ";
   longalf  = " ";
   longnum  = " ";
   codcli   = 0;
   codpr    = 0;
   nompro   = "";
   mensa1   = "     No esta definida esta cuenta en Cuentas de Balance";
   uno = "";
   dos = "";
   tres = "";
   nuno = 0;
   ndos = 0;
   unoU = "";
   unoI = "";
   unoF = "";
   nUno2 = 0;
   aUno3 = "";
   nUno5 = 0;
   nVale = 0;
   nunohay = 0;
   nada = "";
   &entrada = 0;
   &relacionCta = 0;
   cuen1 = "";
   cuen2 = "";
   cuen3 = "";
   desdec = "";
   hastac = "";
   &raf_cue = "";
   &raf_dig = 0;
   &raf_des = "";
   &raf_sw = 0;
   &tipoalta = "";

   &raf_pase = "";
   &raf_blo = 0;
   &raf_tipo = "";
   &raf_agru = 0;
   &raf_epi = 0;
   &raf_par = 0;
   &raf_periodo = 0;
   &raf_empresa = 0;
   &raf_ejercic = 0;
   mesdes = "";
   meshas = "";
   xx = 0;
   yy = 0;
   operac = 0;
   alfa1  = "";
   alfa2  = "";
   swaltas = 0;
   swraf = 0;
   &deCuenta = 0;
   existe = 0;
   Comodin = "";
   Tecla = 0;
   FEstado = 0;

   aCamp23 = "";
   aCamp10 = "";
   nCamp11 = 0;
   &enEjercicio = 0;

   nNoBal = 0;
   nNoBal8 = 0;
   nNoBalX = 0;
   &nMensa = 0;
   nMensa9 = 0;
   &nerror = 0;
|FIN;

||  ***************************************
|PROCESO Tipo88C;
|FPRC;

|PROCESO bajano; |TIPO 1;
|FPRC;

|PROCESO bclipro;
|FPRC;

|PROCESO filtro_cta; |TIPO 0;
   |SI FSalida = 2; |ACABA; |FINSI;
   |SI enEjercicio < 2008;
       |SI #cacuenta#5 = "I"; |O #cacuenta#5 = "G";
           |ERROR;
           |ACABA;
       |FINSI;
   |FINSI;

   |SI #cacuenta#4 = 0;
      |SI #cacuenta#5 = "D"; |O #cacuenta#5 = "H";
          |O #cacuenta#5 = "G"; |O #cacuenta#5 = "I";
         |ERROR;
      |FINSI;
   |SINO;
      |SI #cacuenta#4 = 6;
          |SI #cacuenta#5 = "D"; |O #cacuenta#5 = "H";
              |O #cacuenta#5 = "A"; |O #cacuenta#5 = "P";
             |ERROR;
          |FINSI;
      |SINO;
          |SI #cacuenta#5 = "A"; |O #cacuenta#5 = "P";
              |ERROR;
          |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO alentrar;  |TIPO 88;
   |HAZ inicio;

   |PARA num = 1;|SI num [ 12;|HACIENDO num = num + 1;
      |SI #canempre#11 = num;
          |HAZ pinta;
          mesdes = mes;
          |SAL;
      |FINSI;
   |SIGUE;
   |PARA num = 12;|SI num [ 1;|HACIENDO num = num - 1;
      |SI #canempre#12 = num;
         |HAZ pinta;
         meshas = mes;
         |SAL;
      |FINSI;
   |SIGUE;
   raf_periodo = #canempre#3;
   |ABRE #11;
   |DDEFECTO #11;
   |LEE 101#11p;
   |SI FSalida ! 0; swaltas = 1; |FINSI;
   |LIBERA #11;
   |CIERRA #11;
|FPRC;

|PROCESO pintas2;
   |ABRE #8;
   #caagrupa#0 = #cacuenta#5;    || tipo
   #caagrupa#1 = #cacuenta#6;    || agrupacion
   |LEE 001#8=;
   |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
   |ATRI I;
   |PINTA 1321, #caagrupa#2;
   |ATRI 0;
   |CIERRA #8;

   |ABRE #9;
   #caepigra#0 = #cacuenta#5;    || tipo
   #caepigra#1 = #cacuenta#6;    || agrupacion
   #caepigra#3 = #cacuenta#7;    || epigrafe
   |LEE 001#9=;
   |SI FSalida ! 0;  |DDEFECTO #9;  |FINSI;
   |ATRI I;
   |SI enEjercicio < 2999; |PINTA 1421, #caepigra#4; |FINSI;
   |ATRI 0;
   |CIERRA #9;
|FPRC;

|PROCESO pintas; |TIPO 14;
  |SI enEjercicio ] 2999;
      |C_M #cacuenta#7,1,"N"; |C_V #cacuenta#7,1,"N";
      |C_M #cacuenta#8,1,"N"; |C_V #cacuenta#8,1,"N";
      alfa1 = "읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸";
      |PINTA 1401, alfa1;
      |BLIN 15;
      |BLIN 16;
  |FINSI;
  |SI #cacuenta#4 = 0;
      |ABRE #6;
      #caparbal#0 = #cacuenta#5;     || tipo
      #caparbal#1 = #cacuenta#6;     || agrupacion
      #caparbal#3 = #cacuenta#7;     || epigrafe
      #caparbal#5 = #cacuenta#8;     || partida
      |LEE 001#6=;
      |SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;
      |ATRI I;
      |SI enEjercicio < 2999; |PINTA 1521, #caparbal#6; |FINSI;
      |ATRI 0;
      |CIERRA #6;
   |SINO;
      |ABRE #7;
      #caparexp#0 = #cacuenta#4;     || bloque
      #caparexp#1 = #cacuenta#5;     || tipo
      #caparexp#2 = #cacuenta#6;     || agrupacion
      #caparexp#4 = #cacuenta#7;     || epigrafe
      #caparexp#6 = #cacuenta#8;     || partida
      |LEE 001#7=;
      |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;
      |ATRI I;
      |SI enEjercicio < 2999; |PINTA 1521, #caparexp#7; |FINSI;
      |ATRI 0;
      |CIERRA #7;
   |FINSI;
   |HAZ pintas2;
|FPRC;

|PROCESO altas;|TIPO 0;
|FPRC;

|PROCESO nivel; |TIPO 0;

   |SI #cacuenta#0 = doce;
       operac = (FEntrada / 100) ! 0;
       |SI operac = 4; |ACABA; |FINSI;
   |FINSI;
   nerror = 0;
   eaCuenta = #cacuenta#Campo#;
   salidas  = FSalida;
   |HAZ FiltraPuntos;
   #cacuenta#Campo# = eaCuenta;
   |PINTA #cacuenta#Campo#;

   |SI entrada = 1;  |Y #cacuenta#0 = doce;  |ACABA;  |FINSI;

   nMensa9 = nMensa;
   |SI eaPaCTA2 = "N"; nMensa9 = 1; |FINSI;
   |HAZ defect;
   |SI nNoBal8 = 1; |Y eaPaCTA1 = "N";
       |MENAV "    ERROR. Cuenta No definida en Balance 2008";
       nerror = 1;
       |ERROR;
       |ACABA;
   |FINSI;

   cta = #0#0;
   |QBF cta;
   nada = cta % A101;
   |SI nada ! "0";
       ctanum = cta;
       ctaalf = ctanum;
       longnum = ctaalf % A0;
   |SINO;
       ctanum = 1;
       ctaalf = cta;
       longnum = ctaalf % A0;
   |FINSI;
   longalf = cta    % A0;
   |SI longnum ! longalf;|O ctanum = 0;
       |MENAV men3;
       |PINTA #0#0;
       |ERROR;
       |ACABA;
   |FINSI;

   emCta = 1;
   eaCuenta = #cacuenta#0;
   |HAZ SacaNivel;
   |SI eswCta = 1;
      |ACABA;
   |FINSI;

   ||***** 1a Clave;
   ||***** nivel = nivel de la cta;
   #cacuenta#1 = enNivel;
   || la 3a clave esta formada por la cta + zzzz y el campo fantasma del nivel;
   mascara = #cacuenta#0;
   |QBF mascara;
   mascara = mascara +"zzzzzzzzzzzz";
   mascara = mascara % 112;
   #cacuenta#54    = mascara;
   #cacuenta#55    = enNivel;
   #cacuenta#56 = mesdes;
   #cacuenta#57 = meshas;
   |SI #cacuenta#1 = #canempre#13; |O #cacuenta#0 = doce;
       #cacuenta#3 = "S";
   |SINO;
       #cacuenta#3 = "N";
   |FINSI;
   |PINTA #cacuenta#3;
|FPRC;

|PROCESO eElAnterior; |TIPO 7;
 operac = (FEntrada / 100) ! 0;
 |SI operac !  1; |ACABA; |FINSI;

 |HAZ LeeCtaSup;
 #cacuenta#Campo# = eaNomCtaSup;
 |PINTA #cacuenta#Campo#;
 |PTEC 816;
|FPRC;

|PROCESO pinta;
   |SI num =  1; mes = "Enero";     |ACABA;  |FINSI;
   |SI num = 12; mes = "Diciembre"; |ACABA;  |FINSI;
   |SI num =  2; mes = "Febrero";   |ACABA;  |FINSI;
   |SI num =  3; mes = "Marzo";     |ACABA;  |FINSI;
   |SI num =  4; mes = "Abril";     |ACABA;  |FINSI;
   |SI num =  5; mes = "Mayo";      |ACABA;  |FINSI;
   |SI num =  6; mes = "Junio";     |ACABA;  |FINSI;
   |SI num =  7; mes = "Julio";     |ACABA;  |FINSI;
   |SI num =  8; mes = "Agosto";    |ACABA;  |FINSI;
   |SI num =  9; mes = "Septiembre";|ACABA;  |FINSI;
   |SI num = 10; mes = "Octubre";   |ACABA;  |FINSI;
   |SI num = 11; mes = "Noviembre"; |ACABA;  |FINSI;
|FPRC;

|PROCESO defect;
 |PDEFECTO #cacuenta,4,9;
 nNoBal  = 0;
 nNoBal8 = 0;
 nNoBalX = 0;
 nUno2   = 0;
 aUno3   = "";
 nUno5   = 0;

 uno     = #cacuenta#0; |QBF uno;
 |SI uno = ""; |ACABA; |FINSI;

 nNoBal = 1;
 |ABRE #cacuebal;
 |SI enEjercicio ] 2008;
     uno     = uno % 101;
     |SI uno = "8"; |O uno = "9";
         nNoBal = 0;
         |CIERRA #cacuebal;
     |FINSI;
 |FINSI;

 uno  = #cacuenta#0; |QBF uno;
 uno  = uno % 0;
 nuno = uno;
 nNoBal8 = 0;
 |SI enEjercicio ] 2008;
     nNoBal8 = 1; nNoBalX = 1;
     |SI nuno [ 2; nNoBal8 = 0; |FINSI;
 |FINSI;

 uno  = #cacuenta#0; |QBF uno;
 tres = uno;
 dos  = uno + "000000000000";

 |SI nuno ] 5;
     ndos = 5;
     uno = dos % A105;
     |HAZ leodefect;
     |SI nNoBal = 0; |Y nNoBal8 = 0; |Y nNoBalX = 0;  |ACABA;  |FINSI;
 |FINSI;

 |SI nuno ] 4;
     ndos = 4;
     uno = dos % A104;
     |HAZ leodefect;
     |SI nNoBal = 0; |Y nNoBal8 = 0; |Y nNoBalX = 0;  |ACABA;  |FINSI;
 |FINSI;

 |SI nuno ] 3;
     ndos = 3;
     uno = dos % A103;
     |HAZ leodefect;
     |SI nNoBal = 0; |Y nNoBal8 = 0; |Y nNoBalX = 0; |ACABA;  |FINSI;
 |FINSI;

 |SI nuno ] 2;
     ndos = 2;
     uno = dos % A102;
     |HAZ leodefect;
     |SI nNoBal = 0; |Y nNoBal8 = 0; |Y nNoBalX = 0; |ACABA;  |FINSI;
 |FINSI;

 ndos = 1;
 uno = dos % A101;
 |HAZ leodefect;
 |SI nNoBal = 0; |Y nNoBal8 = 0; |Y nNoBalX = 0;
     |ACABA;
 |SINO;
     |SI nNoBal = 1;
         mensa1 = "     No esta definida esta cuenta: " + tres + " en Cuentas de Balance 1990";
         |SI nMensa9 = 0; |MENAV mensa1; |FINSI;
         |CIERRA #cacuebal;
         |HAZ sacaX;
     |FINSI;
     |SI nNoBalX = 1;
         mensa1 = "    La Cuenta: " + tres + " no es correcta en el Plan Contable " + eNum2008;
         |SI nMensa = 0; |MENAV mensa1; |FINSI;
     |SINO;
         |SI nNoBal8 = 1;
             mensa1 = "     No esta definida esta cuenta: " + tres + " en Cuentas de Balance 2008";
             |SI nMensa = 0; |MENAV mensa1; |FINSI;
         |FINSI;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO saca_2008;
   nNoBal8 = 0;
|FPRC;

|DEFBUCLE saca_2008;
   #ca8m0002#2;
   ;
   enEjerBal, eNum2008, 0, uno;
   enEjerBal, eNum2008, 9, unoU;
   ;
   NULL, saca_2008;
|FIN;

|PROCESO leodefectos;
     nVale = 0;
     |ABRE #ca8cumay;
     #ca8cumay#12 = enEjerBal;
     #ca8cumay#0  = uno;
     #ca8cumay#10 = eNum2008;
     |LEE 001#ca8cumay.=;
     |SI FSalida = 0;
         nUno2 = #ca8cumay#2;
         aUno3 = #ca8cumay#3;
         nUno5 = #ca8cumay#5;
         nVale = 1;
     |FINSI;
     |CIERRA #ca8cumay;
|FPRC;

|PROCESO LeoPorNivel;
     nunohay = 1;
|FPRC;

|DEFBUCLE LeoPorNivel;
     #ca8cumay#1;
     ;
     enEjerBal, eNum2008, unoI;
     enEjerBal, eNum2008, unoF;
     ;
     NULL, LeoPorNivel;
|FIN;

|PROCESO leodefect;
     |SI nNoBal = 1;
         #cacuebal#0 = uno;
         |LEE 040#cacuebal.=;
         |SI FSalida = 0;
             |HAZ saca;
         |FINSI;
     |FINSI;

     |SI nNoBalX = 1;
         |SI ndos = 5;
             |HAZ leodefectos;
             |SI nVale = 1; nNoBalX = 0; |FINSI;
         |FINSI;
         |SI ndos = 4; |O ndos = 3;
             nunohay = 0;
             unoI = uno + "0";
             unoF = uno + "9";
             |BUCLE LeoPorNivel;
             |SI nunohay = 0;
                |HAZ leodefectos;
                |SI nVale = 1; nNoBalX = 0; |FINSI;
             |FINSI;
         |FINSI;
         |SI ndos = 2;
             |HAZ leodefectos;
             |SI nuno [ 2; |Y nVale = 1; nNoBalX = 0; |FINSI;
         |FINSI;
         |SI ndos = 1; |Y nuno = 1;
             |HAZ leodefectos;
             |SI nVale = 1; nNoBalX = 0; |FINSI;
         |FINSI;
     |FINSI;

     |SI nNoBal8 = 1;
         |SI nuno > 3;
             uno   = (uno + "     " ) % 105;
             unoU  = uno;
         |SINO;
             unoU  = (uno + "99999" ) % 105;
             uno   = (uno + "     " ) % 105;
         |FINSI;
         |BUCLE saca_2008;
     |FINSI;
|FPRC;

|PROCESO saca;
   nNoBal = 0;
   #cacuenta#4 = #cacuebal#1;
   #cacuenta#5 = #cacuebal#2;
   #cacuenta#6 = #cacuebal#3;
   #cacuenta#7 = #cacuebal#4;
   #cacuenta#8 = #cacuebal#5;
   |PINTA #cacuenta#4;
   |PINTA #cacuenta#5;
   |PINTA #cacuenta#6;
   |PINTA #cacuenta#7;
   |PINTA #cacuenta#8;
   |SI entrada = 0;
      |HAZ pintas;
      |HAZ pintas2;
   |FINSI;
   |CIERRA #5;            ||CIERRO AQUI el FICHERO PARA SALIRME
|FPRC;

|PROCESO sacaX;
   #cacuenta#4 = #ca8cumay#2; |PINTA #cacuenta#4;
   #cacuenta#5 = #ca8cumay#3; |PINTA #cacuenta#5;
   #cacuenta#6 = #ca8cumay#5; |PINTA #cacuenta#6;
|FPRC;

|PROCESO al_emp; |TIPO 30;

   operac = (FEntrada / 100) ! 0;
   |SI operac ! 1; |ACABA; |FINSI;

   raf_empresa = #canempre#2;
   raf_periodo = #canempre#3;
   raf_ejercic = #canempre#26;
   |ABRE #11;
   |DDEFECTO #11;
   |LEE 101#11p;
   |SI FSalida ! 0; swaltas = 1; |FINSI;
   |LIBERA #11;
   |CIERRA #11;

   |SI swaltas = 1; |ACABA; |FINSI;

   swraf = 1;
   alfa1 = #cactrlal#1; |QBF alfa1;
   alfa2 = #cactrlal#2; |QBF alfa2;
   |SI alfa1 ! ""; |O alfa2 ! ""; swraf = 0; |FINSI;
   alfa1 = #cactrlal#3; |QBF alfa1;
   alfa2 = #cactrlal#4; |QBF alfa2;
   |SI alfa1 ! ""; |O alfa2 ! ""; swraf = 0; |FINSI;
   alfa1 = #cactrlal#5; |QBF alfa1;
   alfa2 = #cactrlal#6; |QBF alfa2;
   |SI alfa1 ! ""; |O alfa2 ! ""; swraf = 0; |FINSI;

   |SI swraf = 1; |ACABA; |FINSI;

   swraf = 1;
   |SI #cacuenta#0 ] #cactrlal#1; |Y #cacuenta#0 [ #cactrlal#2; swraf = 0; |FINSI;
   |SI #cacuenta#0 ] #cactrlal#3; |Y #cacuenta#0 [ #cactrlal#4; swraf = 0; |FINSI;
   |SI #cacuenta#0 ] #cactrlal#5; |Y #cacuenta#0 [ #cactrlal#6; swraf = 0; |FINSI;

   |SI swraf = 1; |ACABA; |FINSI;

      raf_cue  = #cacuenta#0;
      raf_dig  = #cacuenta#1;
      raf_des  = #cacuenta#2;
      raf_pase = #cacuenta#3;
      raf_blo  = #cacuenta#4;
      raf_tipo = #cacuenta#5;
      raf_agru = #cacuenta#6;
      raf_epi  = #cacuenta#7;
      raf_par  = #cacuenta#8;

      |CIERRAT #0;
      |SUB_EJECUTA_NP ":contagen/caltacta";
      |ABRET #0;
|FPRC;


|PROCESO cuenta_tipo4; |TIPO 4;
|FPRC;

|| ********************** BuscoNIFS
|PROCESO AltaNif;
|FPRC;
|PROCESO ControlGrid;
|FPRC;
