|FICHEROS;
     dsmozp02 #0;

     dsmom004 #4;

     dsmom085 #85;
     dsmom086 #86;
     dsmom087 #87;
     dsmociva #300;
     dsmoc322;

     dsmow082 #982,MANTE;
     dsmow083 #983,MANTE;
     dsmow127 #927,MANTE;
     dsmow128 #928,MANTE;

     :/basica/def/agifigen #1000;
     :/basica/def/agicen14 #1014;

     reflejo@ #182;
|FIN;

|VARIABLES;
     nNume1      = 0;
     nNume2      = 0;
     &nAny       = 0;
     &aTipoPr    = "";
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aAlfa3      = "";

     fFecIni   = @;
     fFecFin   = @;
     nInkey    = 0;
     esalta    = 0;
     esaltaL   = 0;
     nSwSal    = 0;

     aBlanc      = "";

     &aFichw82   = "";
     &aFichw28   = "";
     &nSwLinea   = 0;
     &eaCam1     = "";
     &eaCam2     = "";
     &eaCam3     = "";
     &enCam4     = "";
     &eaCa4      = "";
     &eaCam8     = "";
     &enCam10    = 0;
     &enCam11    = 0;
     &enCam12    = 0;
     &enCam22    = 0;
     &enCam13    = 0;
     &eaCam15    = "";
     &eaTex      = "";
     &eaTit      = "";
     &enEj82     = "";
     &enSwEjPos  = 0;

     aBase = "";
     aDef  = "";
     nDEmp = 0;
     nHEmp = 0;
     nDAct = 0;
     nHAct = 0;
     informe = "";
     inform1 = "dsmowp03";
     inform2 = "dsmowp83";

     nBoton2    = 0;
     nBoton3    = 0;
     nBoton4    = 0;
     nBoton5    = 0;
     nBoton6    = 0;

     &aParam    = "";
     &nRepaso   = 0;
     &nSwOp87   = 0;
     &nDDepar   = 0;
     &nHDepar   = 0;
     nModelo    = 0;
     nCambio    = 0;
     nSwCambio  = 0;
     nSwCamEste = 0;
     &eMensa    = 0;
     nCampo     = 0;

     &enSector  = 0;
     &nSwVarios = 0;
     &aCNAE     = "";
     &nRegIVA   = 0;
     &nRegIVAp  = 0;
     &nConSec   = 0;
     &nSwOpe83  = 0;
     &nSwCalculo = 0;
     nDepar     = 0;
     &nTpComun  = 0;
     nDPeriodo  = 0;
     nHPeriodo  = 0;

     aTipoCalculo = "";
     aMensa       = "";

      nSwRegEsp   = 0;  || Algun regimen especial
      nSwSubv     = 0;  || tiene subvenciones a bien concreto anterior
      nSwExentas  = 0;  || tiene operaciones exentas
      nSw         = 0;
      nNumAct     = 0;  || Numero de Actividades
      nImporteMas = 0;
      nActivMas   = 0;  || actividad principal
      nHay        = 0;
      aTipo       = "";
      aLit        = "";
      nTpPri      = 0;
      nSwCom      = 0;
    &enEmpAmor  = 0;
    &enEjeAmor  = 0;
    &enDActAmor = 0;
    &enHActAmor = 0;
    &enImpRegul = 0;
    &enModoAmor = 0;

     nComplem   = 0;
     nDComplem  = 0;
     nHComplem  = 0;
|FIN;

|INCLUYE i_variar;

**************************************************************************
|PROCESO Actualiza85;

        #85#0 = enEmpresa;
        #85#1 = #0#0;
        |LEE 141#85=;
        |SI FSalida = 0;
            #85#4  = #982#3;
            #85#5  = #982#4;
            #85#6  = #982#5;
            #85#7  = #982#6;
            #85#8  = #982#7;
            #85#14 = #982#32;
            #85#15 = #982#17;
            #85#17 = #982#18;
            |GRABA 020#85a;
            |LIBERA #85;

            #85#0 = enEmpresa;
            #85#1 = #0#0 + 1;
            |LEE 141#85=;
            |SI FSalida = 0;
                #85#2  = #982#3;
                #85#3  = #982#4;
                #85#16 = #982#18;
                |GRABA 020#85a;
                enSwEjPos = 1;
            |FINSI;
            |LIBERA #85;

            #85#0 = enEmpresa;
            #85#1 = #0#0;
            |LEE 141#85=;

        |FINSI;
        |LIBERA #85;
|FPRC;

|PROCESO Actualiza86;

        #86#0 = enEmpresa;
        #86#1 = #0#0;
        #86#2 = enActividad;
        |LEE 141#86=;
        |SI FSalida = 0;
            #86#6  = #983#5;
            #86#7  = #983#6;
            #86#8  = #983#7;
            #86#9  = #983#8;
            #86#15 = #983#34;
            #86#16 = #983#10;
            #86#17 = #983#11;
            #86#18 = #983#15;
            |GRABA 020#86a;

            #86#0 = enEmpresa;
            #86#1 = #0#0 + 1;
            #86#2 = enActividad;
            |LEE 141#86=;
            |SI FSalida = 0;
                #86#5  = #983#5;
                #86#15 = #983#34;
                #86#16 = #983#10;
                #86#17 = #983#11;
                |GRABA 020#86a;
                enSwEjPos = 1;
            |FINSI;
        |FINSI;
        |LIBERA #86;
|FPRC;

|PROCESO LaRegularizacion;
    enEmpAmor  = #300#0;
    enEjeAmor  = #300#1;
    enDActAmor = #300#5;
    enHActAmor = #300#5;
    enModoAmor = 0;
    |SUB_EJECUTA "dsmozp41;Calculo";
    #300#16 = enImpRegul;
    #300#12 = #300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32;
    #300#13 = #300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34;
    |GRABA 020#300a;
    |LIBERA #300;
|FPRC;

|DEFBUCLE LaRegularizacion;
    #300#1;
    ;
    #4#0, #4#1, 12, nModelo, #4#4, 01, 2, 09;
    #4#0, #4#1, 12, nModelo, #4#4, 98, 2, 09;
    e;
    NULL, LaRegularizacion;
|FIN;

|PROCESO LaRegulariza322;
    enEmpAmor  = #dsmoc322#0;
    enEjeAmor  = #dsmoc322#1;
    enDActAmor = #dsmoc322#5;
    enHActAmor = #dsmoc322#5;
    enModoAmor = 0;
    |SUB_EJECUTA "dsmozp41;Calculo";
    #dsmoc322#16 = enImpRegul;
    #dsmoc322#12 = #dsmoc322#14 + #dsmoc322#17 + #dsmoc322#20 + #dsmoc322#23 + #dsmoc322#26 + #dsmoc322#29 + #dsmoc322#32;
    #dsmoc322#13 = #dsmoc322#16 + #dsmoc322#19 + #dsmoc322#22 + #dsmoc322#25 + #dsmoc322#28 + #dsmoc322#31 + #dsmoc322#34;
    |GRABA 020#dsmoc322.a;
    |LIBERA #dsmoc322;
|FPRC;

|DEFBUCLE LaRegulariza322;
    #dsmoc322#1;
    ;
    #4#0, #4#1, 12, nModelo, #4#4, 01, 2, 09;
    #4#0, #4#1, 12, nModelo, #4#4, 98, 2, 09;
    e;
    NULL, LaRegulariza322;
|FIN;

|PROCESO dsmom004_Act;
  |SI #4#7 = "X"; |Y #4#9 ! "X";
         |SI #4#2 = 12;
             |BUCLE LaRegularizacion;
             |BUCLE LaRegulariza322;
         |FINSI;

         enEmpresa     = #4#0;
         enEjer        = #4#1;
         enPeriodo     = #4#2;
         enModelo      = #4#3;
         enComplem     = #4#4;
         enTipoEntrada = 91;
         eMensa        = 1;
         |SI enModelo = 322;
             |SUB_EJECUTA_NP "dsmoc322";
         |SINO;
             |SUB_EJECUTA_NP "dsmociva";
         |FINSI;
         eMensa        = 0;

         |HAZ ChequeaSituacion;

         |GRABA 020#4a;
 |FINSI;
 |LIBERA #4;
|FPRC;

|DEFBUCLE dsmom004_Act;
 #4#1;
 ;
 enEmpresa, enEjer, nDPeriodo, nModelo, nDComplem;
 enEmpresa, enEjer, nHPeriodo, nModelo, nHComplem;
 be;
 NULL, dsmom004_Act;
|FIN;

|PROCESO CambiarDatos;
  nModelo = 303; |BUCLE dsmom004_Act;
  nModelo = 322; |BUCLE dsmom004_Act;
  nModelo = 370; |BUCLE dsmom004_Act;
|FPRC;

|PROCESO Modifica87;
      #87#11 = #86#5;
      |SI #87#2 = 12; #87#11 = #86#6; |FINSI;

      |SI #87#40 ! 0; |O #87#42 ! 0; |O #87#44 ! 0;
         |O #87#46 ! 0; |O #87#48 ! 0; |O #87#50 ! 0; |O #87#52 ! 0;

            #87#36 = #85#16; |SI #87#2 = 12; #87#36 = #85#17; |FINSI;

            #87#41 = (#87#40 % #87#36) ! 2;
            #87#43 = (#87#42 % #87#36) ! 2;
            #87#45 = (#87#44 % #87#36) ! 2;
            #87#47 = (#87#46 % #87#36) ! 2;
            #87#49 = (#87#48 % #87#36) ! 2;
            #87#51 = (#87#50 % #87#36) ! 2;
            #87#53 = (#87#52 % #87#36) ! 2;

            #87#37 = #87#40 + #87#42 + #87#44 + #87#46 + #87#48 + #87#50 + #87#52;
            #87#38 = #87#41 + #87#43 + #87#45 + #87#47 + #87#49 + #87#51 + #87#53;
            #87#39 = #87#37 - #87#38;
      |SINO;
            |PDEFECTO #87, 36,54;
      |FINSI;

      #87#17 = (#87#16 % #87#11) ! 2;
      #87#20 = (#87#19 % #87#11) ! 2;
      #87#23 = (#87#22 % #87#11) ! 2;
      #87#26 = (#87#25 % #87#11) ! 2;
      #87#29 = (#87#28 % #87#11) ! 2;
      #87#32 = (#87#31 % #87#11) ! 2;
      #87#35 = (#87#34 % #87#11) ! 2;

      #87#12 = #87#16 + #87#19 + #87#22 + #87#25 + #87#28 + #87#31 + #87#34;
      #87#13 = #87#17 + #87#20 + #87#23 + #87#26 + #87#29 + #87#32 + #87#35;
      #87#14 = #87#12 - #87#13;

      #87#8  = #87#12 + #87#37;
      #87#9  = #87#13 + #87#38;
      #87#10 = #87#8  - #87#9;
      |GRABA 020#87a;
      |LIBERA #87;
|FPRC;

|DEFBUCLE Modifica87;
   #87#1;
   ;
   #86#0, #86#1, nDPeriodo, 000, nDComplem, #86#2, 0, 00;
   #86#0, #86#1, nHPeriodo, 999, nHComplem, #86#2, 9, 99;
   be;
   NULL, Modifica87;
|FIN;

|PROCESO Leew82_Aux83_Act;
    nDPeriodo = 12;
    nHPeriodo = 12;
    #86#0 = #983#1;
    #86#1 = #983#0;
    #86#2 = #983#2;
    |LEE 101#86=;
    |SI FSalida = 0;
        #86#6  = #983#9;
        #86#15 = #983#34;
        #86#16 = #983#10;
        #86#17 = #983#11;
        #86#18 = #983#15;
        |GRABA 020#86a;
    |FINSI;
    |LIBERA #86;

    |BUCLE Modifica87;

    #983#35 = #983#34;
    #983#36 = #983#10;
    #983#37 = #983#11;
    #983#38 = #983#5;
    |GRABA 020#983a;

    |SI enSwEjPos = 1;
        #86#0 = #983#1;
        #86#1 = #983#0 + 1;
        #86#2 = #983#2;
        |LEE 101#86=;
        |SI FSalida = 0;
            #86#5  = #983#9;
            #86#15 = #983#34;
            #86#16 = #983#10;
            #86#17 = #983#11;
            |GRABA 020#86a;
        |FINSI;
        |LIBERA #86;
    |FINSI;
|FPRC;

|DEFBUCLE Leew82_Aux83_Act;
    #983#1;
    ;
    #982#0,#982#1, 00;
    #982#0,#982#1, 99;
    ;
    NULL, Leew82_Aux83_Act;
|FIN;

|PROCESO ActPosterior;
    nDPeriodo = 01;
    nHPeriodo = 11;
    |BUCLE Modifica87;
|FPRC;

|DEFBUCLE ActPosterior;
    #86#1;
    ;
    #982#1, enEjer, 00;
    #982#1, enEjer, 99;
    e;
    NULL, ActPosterior;
|FIN;

|PROCESO ModificoNueProrr;

    enSwEjPos = 0;
    nDPeriodo = 12;
    nHPeriodo = 12;
    |ABRE #85;
    #85#0 = #982#1;
    #85#1 = #982#0 + 1;
    |LEE 001#85=;
    |SI FSalida = 0;
        #85#2  = #982#3;
        #85#3  = #982#4;
        #85#16 = #982#18;
        |GRABA 020#85a;
        enSwEjPos = 1;
    |FINSI;

    #85#0 = #982#1;
    #85#1 = #982#0;
    |LEE 001#85=;
    |SI FSalida = 0;
        #85#4  = #982#3;
        #85#5  = #982#4;
        #85#14 = #982#32;
        #85#15 = #982#17;
        #85#17 = #982#18;
        |GRABA 020#85a;
    |FINSI;
    |LIBERA #85;
    |CIERRA #85;

    nComplem = -1;
    |ABRE #4;
    #4#0 = #982#1;
    #4#1 = #982#0;
    #4#2 = 12;
    #4#3 = enModelo;
    #4#4 = 99;
    |LEE 040#4];
    |SI FSalida = 0;
        |LEE 040#4a;
    |SINO;
        |LEE 040#4u;
    |FINSI;
    |SI FSalida = 0; |Y #4#0 = #982#1; |Y #4#1 = #982#0;
         |Y #4#2 = 12; |Y #4#3 = enModelo;
             nComplem = #4#4;
    |FINSI;
    |SI nComplem ! -1;
        nDComplem = nComplem;
        nHComplem = nComplem;
        |ABRE #86;
        |BUCLE Leew82_Aux83_Act;
        |CIERRA #86;
        |HAZ CambiarDatos;
    |FINSI;

    |SI enSwEjPos = 1;
        enEjer = #0#0 + 1;
        nDComplem = 00;
        nDComplem = 99;
        |BUCLE ActPosterior;
        |HAZ CambiarDatos;
        enEjer = #0#0;
    |FINSI;

    |PULSATECLA;
|FPRC;

**************************************************************************
|| ********* Procesos sectores;
|PROCESO BorrandoS;
  |BORRA 020#928a;
|FPRC;

|DEFBUCLE BorrandoS;
  #928#1;
  ;
  enEmpresa, enEjer, 00;
  enEmpresa, enEjer, 99;
  ;
  NULL, BorrandoS;
|FIN;

|PROCESO AltaSector;
  |ABRE #928;
  #928#0 = enEmpresa;
  #928#1 = enEjer;
  #928#2 = enSector;
  |LEE 041#928=;
  |SI FSalida ! 0;
      |DDEFECTO #928;
      #928#0 = enEmpresa;
      #928#1 = enEjer;
      #928#2 = enSector;
      #928#16 = aCNAE;
      #928#17 = nRegIVA;
      |GRABA 020#928c;
  |FINSI;
  |CIERRA #928;
|FPRC;

|PROCESO BuscandoS;
  || |SI #928#17 = nRegIVA; enSector = #928#2; |FINSI;
  enSector = #928#2;
|FPRC;

|DEFBUCLE BuscandoS;
  #928#1;
  16;
  enEmpresa, enEjer, 02, aCNAE;
  enEmpresa, enEjer, 98, aCNAE;
  ;
  NULL, BuscandoS;
|FIN;

|PROCESO BuscaSector;
  enSector = -1;
  |BUCLE BuscandoS;
  |SI enSector = -1;
      nConSec = nConSec + 1;
      enSector = nConSec;
      |HAZ AltaSector;
      nSwVarios = 1;
  |FINSI;
|FPRC;

**************************************************************************
|PROCESO ClaveBajaL83;
  #983#0  = #0#0;
  #983#1  = enEmpresa;
  #983#2  = 00;
  #983#34 = 00;
|FPRC;

|PROCESO ClaveAltaL83;
  #983#0  = #0#0;
  #983#1  = enEmpresa;
  #983#2  = 99;
  #983#34 = 99;
|FPRC;

|PROCESO MTipo5;  |TIPO 5;
       |LEE 040#983p;
       #983#2 = 00; |LINEAS_BI_ATRI #983#2, P, D, -1;
|FPRC;

|CALCULO Siesgeneral; |TIPO 0;
 |SI #982#3 = "G";
     |C_M #982#4,1,"S";
 |SINO;
     |C_M #982#4,1,"N";
 |FINSI;
|FCAL;

|PROCESO PintaCab;
        aBlanc = " " * 79;
        |PINTA 0601, aBlanc;
        |PINTA 0701, aBlanc;
        |PINTA 0801, aBlanc;
        |PINTA 0702, "Empresa: "; |PINTA 0711, #982#1;
        |PINTA 0717, #982#2;
        |PINTA 0759, "NIF: "; |PINTA 0764, #982#15;
|FPRC;

|PROCESO FinBotonw082;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |PULSATECLA;
|FPRC;

|PROCESO Tipo0w082;  |TIPO 0;
     |HAZ FinBotonw082;
|FPRC;

|CALCULO Tipo7w082;  |TIPO 7;

     |CONTROL_SIMPLE 0, "LBOTON,F2  Consulta Actividades ", 0732, 0755, Boton2w082;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3  Vol.Operaciones de Actividades", 0832, 0855, Boton3w082;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F4  Consulta Prorrata Aplicada ", 0657, 0680, Boton4w082;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F5  Modificar Prorrata            ", 0757, 0780, Boton5w082;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F6  Imprimir Relacion Empresas  ", 0857, 0880, Boton6w082;
     nBoton6 = FSalida;
|FCAL;

|CALCULO Tipo11w082; |TIPO 11;
    nInkey    = FSalida;
    |HAZ FinBotonw082;

    enEmpresa = #982#1;
    nAny      = #0#0;
    |SI nInkey <10; |O nInkey > 14;
        |ACABA;
    |FINSI;

    |PUSHV 0501 2380;
    |LEE 001#982=;

    |SI nInkey = 10; || (F2)
        |HAZ PintaCab;
        enModo    = 4;
        |SUB_EJECUTA_NP ":basica/agicen14";
    |FINSI;

    |SI nInkey = 11; || (F3)
        nSwSal = 0;
        |PINPA #0#983;
        |PINTA 0718, #982#2;  |PINTA 0767, #982#15;
        |PINTA 2217, #982#5;  |PINTA 2229, #982#6;
        |PINTA 2241, #982#7;
        |PINTA 2273, #982#3;  |PINTA 2275, #982#19;
            |C_V #983#31, 1, "N";
            |C_V #983#32, 1, "N";
            |C_V #983#8,  1, "S";
            |C_V #983#34, 1, "S";
            |ATRI R; |PINTA 1507, "Sec.";
                     |PINTA 1441, "  Total   ";
            |ATRI 0; |PINTA 1451, "³";
            |ATRI R; |PINTA 1452, "% Sobre el";
                     |PINTA 1552, "Vol. total";
                     |PINTA 1541," Ingresos ";  |ATRI 0;
        |ATRI P; |PINTA 1061, "Importes  Ingresos";
        |PINTA 1161, "Ejercicio Actual"; |ATRI 0;

        |ENTLINEAL #2#983, -4, 4, 20, 0, ClaveBajaL83, ClaveAltaL83;
    |FINSI;

    |SI nInkey = 12; || (F4)
        |HAZ PintaCab;
        enEmpresa = #982#1;
        enEjer    = #982#0;
        |SUB_EJECUTA_NP "dsmom085";
    |FINSI;

    |POPV;

    |SI nInkey = 13;

        |SI #982#31 = "X";
            |MENAV "    Empresa que regulariza a final del Ejercicio por no Aplicar Prorrata";
            |ACABA;
        |FINSI;

        |SI #982#30 = "X";
            |MENAV "    No puede Modificar Prorrata, ya esta el Modelo Impreso";
            |ACABA;
        |FINSI;

        |SI #982#29 = "X";
            |CONFI "    NEl Modelo esta Confeccionado. Continuar con la Modificacion";
            |SI FSalida ! 0;
                |ACABA;
            |FINSI;
        |FINSI;

        |HAZ PideProrrata;

    |FINSI;

    |SI nInkey = 14; || (F5)
        |HAZ Imprimir;
    |FINSI;

|FCAL;

|CALCULO SalgoYa;  |TIPO 7;
     |SI nSwSal = 1;  |PTEC 807;  |FINSI;
|FCAL;

|| ***********************************************************************
|| ***********************************************************************
|| ***********************************************************************
|PROCESO  LeeElAux83_Es;

 nDepar = #983#2;

  |SI nSwOpe83 = 1;   || = determina actividad Principal y otros detalles

      |SI nDepar = 00; |O nDepar = 99; |ACABA; |FINSI;

      |SI nSw = 0;
          nImporteMas = #983#8;
          nActivMas   = #983#2;
          nRegIVAp    = #983#14;
          nRegIVA     = #983#14;
          nSw = 1;
          enSector    = #983#34;
      |FINSI;
      |SI nImporteMas < #983#8;  || la actividad principal
          nImporteMas = #983#8;
          nActivMas   = #983#2;
          nRegIVAp    = #983#14;
      |FINSI;

      #983#15 = ((#983#8 * 100) / #982#7 ) ! 2;
      |GRABA 020#983a;
      nNumAct = nNumAct + 1;        || todas las actividades

      |SI #983#14 = 3; |O #983#14 = 9; nSwRegEsp = 1;  |FINSI;
      |SI #983#7  ! 0;                 nSwExentas = 1; |FINSI;
      |SI #983#28 ! 0;                 nSwSubv = 1;    |FINSI;
      |SI #983#33 = 1;                 nHay = 1;       |FINSI;

      |SI #982#32 = "S"; |O #982#32 = "M";
          |SI enSector ! #983#34; nSwVarios = 1; |FINSI;
      |FINSI;
 |FINSI;

 |SI nSwOpe83 = 2;   || Busca todas las complementarias de la Principal

     |SI nDepar = 99; |O nDepar = 0; |ACABA; |FINSI;
     |SI #983#2 = nActivMas; |ACABA; |FINSI;  || si es la principal

     nSwCom = 0;
     nNume1 = (nImporteMas % 15) ! 2;
     |SI nNume1 ] #983#8;
         nSwCom = 1;
     |SINO;
         |SI #983#7 = 0;
              nNume2 = 100;
         |SINO;
             nNume1 = (( #983#6 / #983#8 ) * 100) ! 2;
             nNume2 = nNume1 ! 0;
             |SI nNume2 < nNume1;
                 nNume2 = nNume1 ! 0 + 1;
             |FINSI;
         |FINSI;
         |SI nNume2 > 100; nNume2 = 100; |FINSI;
         |SI nNume2 < 0;   nNume2 = 0;   |FINSI;
         nNume1 = nTpPri - nNume2;
         |SI nNume1 < 0; nNume1 = -nNume1; |FINSI;
         |SI nNume1 < 50; nSwCom = 1; |FINSI;
     |FINSI;

     |SI nRegIVAp ! 10; |Y nRegIVAp ! 9; |Y nRegIVAp ! 3;
         |SI #983#14 = 10; |O #983#14 = 9; |O #983#14 = 3;
             nSwCom = 0;     ||estos tipo de tributacion son un sector
         |FINSI;
     |SINO;
         |SI nRegIVAp ! #983#14;
             nSwCom = 0;     ||estos tipo de tributacion son un sector
         |FINSI;
     |FINSI;

     |SI nSwCom = 1;
         #983#10 = "C";
         #983#11 = "COMPLEMENTARIA";
         #983#12 = nDepar;
         #983#34 = 1;        || Sector de la Principal
     |SINO;
         aCNAE   = #983#13;
         nRegIVA = #983#14;
         |HAZ BuscaSector;
         #983#10 = "O";
         #983#11 = "OTRA";
         #983#34 = enSector;
     |FINSI;

     #983#35 = #983#34;
     #983#36 = #983#10;
     #983#37 = #983#11;
     #983#38 = #983#5;
     |GRABA 020#983a;

 |FINSI;

 |SI nSwOpe83 = 3;   || Suma sectores

     enSector = #983#34;
     #928#0 = enEmpresa;
     #928#1 = enEjer;
     #928#2 = enSector;
     |LEE 041#928=;
     |SI FSalida ! 0;
         |DDEFECTO #928;
         #928#0 = enEmpresa;
         #928#1 = enEjer;
         #928#2 = enSector;
         #928#16 = #983#13;
         #928#17 = #983#14;
         |GRABA 020#928c;
     |FINSI;
     #928#3 = "SECTOR : " + enSector;
     #928#7 = #928#7 + #983#6;
     #928#8 = #928#8 + #983#7;
     #928#9 = #928#7 + #928#8;

     |SI #982#32 ! "M"; |Y aParam ! "F10";
         |SI aTipoPr = "E";
              |SI #928#8 = 0;
                  nNume2 = 100;
              |SINO;
                  nNume1 = (( #928#7 / #928#9 ) * 100) ! 2;
                  nNume2 = nNume1 ! 0;
                  |SI nNume2 < nNume1;
                      nNume2 = nNume1 ! 0 + 1;
                  |FINSI;
              |FINSI;
              |SI nNume2 > 100; nNume2 = 100; |FINSI;
              |SI nNume2 < 0;   nNume2 = 0;   |FINSI;
              #928#6 = nNume2;
         |SINO;
              #928#6 = nTpComun;
         |FINSI;
         |SI nDepar = 0;
              #928#6 = nTpComun;
         |FINSI;
    |SINO;
          #928#6 = #983#5;
    |FINSI;
    |SI #982#31 = "X";
         #928#6 = 100;   ||para regularizar
    |FINSI;
    |SI enSector = 99;
         #928#6 = 100;   || siempre 100%
    |FINSI;

     #928#15 = ((#928#9 * 100) / #982#7 ) ! 2;

     |SI enSector = 0; |O enSector = 99;
         #928#16 = "";
         #928#17 = 0;
     |SINO;
         |SI enSector = 1; |Y #983#10 = "P";
             #928#16 = #983#13;
             #928#17 = #983#14;
         |FINSI;
     |FINSI;
     |GRABA 020#928a;
     |SI enSector > 1; |Y enSector < 99;
         nSwVarios = 1;
     |FINSI;
 |FINSI;

 |SI nSwOpe83 = 4;   || Cada actividad
     |DDEFECTO #928;
     enSector = #983#34;
     #928#0 = enEmpresa;
     #928#1 = enEjer;
     #928#2 = enSector;
     |LEE 041#928=;

     |SI #982#32 ! "M";
         #983#5 = #928#6;
         #983#9 = #928#6;
         |SI nDepar = 0;
             #983#5 = nTpComun;
             #983#9 = nTpComun;
         |FINSI;

         |SI nSwCalculo = 1;
             #983#35 = #983#34;
             #983#36 = #983#10;
             #983#37 = #983#11;
             #983#38 = #983#5;
         |FINSI;

         |GRABA 020#983a;

         enActividad = nDepar;
         |SI nSwCalculo = 1; |HAZ Actualiza86; |FINSI;
     |FINSI;
 |FINSI;

 |SI nSwOpe83 = 5;   || Ver cuantos sectores hay.
     enSector = #983#34;
     |SI enSector > 1; |Y enSector < 99;
         nSwVarios = 1;
     |FINSI;
 |FINSI;
|FPRC;

|DEFBUCLE LeeElAux83_Es;
  #983#1;
  ;
  enEjer, enEmpresa, 00;
  enEjer, enEmpresa, 99;
  ;
  NULL, LeeElAux83_Es;
|FIN;

|PROCESO ActividadPrincipal;

 |ABRE #983;
 #983#0 = #0#0;
 #983#1 = enEmpresa;
 #983#2 = nDepar;
 |LEE 001#983=;
 |SI FSalida = 0;
     nImporteMas = #983#8;
     |SI #983#7 = 0;
          nNume2 = 100;
     |SINO;
          nNume1 = (( #983#6 / #983#8 ) * 100) ! 2;
          nNume2 = nNume1 ! 0;
          |SI nNume2 < nNume1;
               nNume2 = nNume1 ! 0 + 1;
          |FINSI;
     |FINSI;
     |SI nNume2 > 100; nNume2 = 100; |FINSI;
     |SI nNume2 < 0;   nNume2 = 0;   |FINSI;
     nTpPri = nNume2;

     #983#10 = aTipo;
     #983#11 = aLit;
     #983#12 = nDepar;
     #983#34 = enSector;

     #983#35 = #983#34;
     #983#36 = #983#10;
     #983#37 = #983#11;
     #983#38 = #983#5;

     |GRABA 020#983a;
 |FINSI;
 |CIERRA #983;

 aCNAE    = #983#13;
 nRegIVA  = #983#14;
 nRegIVAp = #983#14;
 enSector = #983#34;
 |HAZ AltaSector;

 nConSec  = 1;
 nSwOpe83 = 2;  ||Principal complementaria
 aCNAE   = #983#13;
 aLit    = "COMPLEMENTARIA";
 aTipo   = "C";
 |BUCLE LeeElAux83_Es;
|FPRC;

|PROCESO CalculoTodo;
         aTipoPr = #982#3;
         |SI #982#6 = 0;
             nNume2 = 100;
         |SINO;
             nNume1 = (( #982#5 / #982#7 ) * 100) ! 2;
             nNume2 = nNume1 ! 0;
             |SI nNume2 < nNume1;
                 nNume2 = nNume1 ! 0 + 1;
             |FINSI;
         |FINSI;
         |SI nNume2 > 100; nNume2 = 100; |FINSI;
         |SI nNume2 < 0;   nNume2 = 0;   |FINSI;

         #982#27 = nNume2;  ||% Segun calculo

         |SI #982#32 ! "M";
             #982#4  = nNume2;
             #982#18 = nNume2;
             |SI #982#31 = "X";
                 #982#4  = 100;
                 #982#18 = 100;
             |FINSI;
         |FINSI;
         nTpComun = #982#18;

         |ABRE #928;
         nSwOpe83    = 3;
         |BUCLE LeeElAux83_Es;   ||Calculo los totales por sectores

         nSwOpe83    = 4;
         |BUCLE LeeElAux83_Es;   ||Calculo para cada actividad

         |CIERRA #928;

         aTipoPr = #982#3;
         #982#19 = "";
         #982#23 = " ESPECIAL";
         |SI #982#3 = "G";
             aAlfa1  = #982#4; |QBF aAlfa1;
             #982#23 = " GENERAL ";
         |SINO;
             aAlfa1  = #982#18; |QBF aAlfa1;
             #982#23 = " ESPECIAL";
         |FINSI;
         aAlfa1  = ("   " + aAlfa1) % -103;
         #982#19 = aAlfa1;

         aAlfa = #982#32;
         |SI #982#31 = "X"; #982#32 = "M"; |FINSI;

         |GRABA 020#982a;
         |SI nSwCalculo = 1; |HAZ Actualiza85; |FINSI;

         |SI aAlfa ! "M"; |Y nSwCalculo = 1;
             |CIERRA #86;
             |CIERRA #85;
             |HAZ ModificoNueProrr;
             |ABRE #85;
             |ABRE #86;
         |FINSI;
|FPRC;

|PROCESO CalculoTodoF10;
         aTipoPr = #982#3;
         nTpComun = #982#18;

         |ABRE #928;
         nSwOpe83    = 3;
         |BUCLE LeeElAux83_Es;   ||Calculo los totales por sectores
         |CIERRA #928;

         aTipoPr = #982#3;
         #982#19 = "";
         #982#23 = " ESPECIAL";
         aAlfa1  = #982#18; |QBF aAlfa1;
         |SI #982#3 = "G";
             aAlfa1  = #982#4; |QBF aAlfa1;
             #982#23 = " GENERAL ";
         |FINSI;
         aAlfa1  = ("   " + aAlfa1) % -103;
         #982#19 = aAlfa1;
         aAlfa = #982#32;
         |SI #982#31 = "X"; #982#32 = "M"; |FINSI;
         |GRABA 020#982a;
|FPRC;

|PROCESO CalculoPrin;
         nSwRegEsp   = 0;  || Algun regimen especial
         nSwSubv     = 0;  || tiene subvenciones a bien concreto anterior
         nSwExentas  = 0;  || tiene operaciones exentas
         nSw         = 0;
         nSwVarios   = 0;  || varios Regimenes de IVA
         nNumAct     = 0;  || Numero de Actividades
         nSwOpe83    = 1;
         nImporteMas = 0;
         nActivMas   = 0;  || actividad principal
         nHay        = 0;
         |BUCLE LeeElAux83_Es;

         |SI #982#32 = "A"; |O #982#32 = "G";   ||... Determinacion de los sectores y clases de actividad
                                                ||... Determinar la Actividad Principal, Si existe activ.
              enSector   = 1;
              nDepar     = nActivMas;
              aTipo      = "P";
              aLit       = "PRINCIPAL";
              |HAZ ActividadPrincipal;

         |FINSI;
         |SI #982#32 ! "M";
              |SI nNumAct = 1;   || Solo existe una actividad
                  aTipoPr = "G";
              |SINO;
                  |SI nSwVarios = 0;
                      aTipoPr = "G";
                  |SINO;
                      aTipoPr = "E";
                 |FINSI;
              |FINSI;
              |SI nHay = 0;   ||no existe datos
                  aTipoPr = "G";
              |FINSI;
              |SI #982#32 = "G";   aTipoPr = "G";  |FINSI;
              #982#3 = aTipoPr;
         |FINSI;

         nSwCalculo = 1;
         |HAZ CalculoTodo;
         nSwCalculo = 0;
|FPRC;

|| ************************************************************************
|PROCESO Leew82_Aux83;
  nCambio = #928#6;
  |SI #928#2 = 99; |O #928#2 = 00;
      #928#6 = #927#17;
      |SI #928#2 = 99;
          #928#6 = 100;
      |FINSI;
  |SINO;
     |SI aTipoPr = "G";
         #928#6 = #927#17;
     |FINSI;
  |FINSI;
  |SI nCambio ! #928#6; nSwCambio = 1; |FINSI;

  |GRABA 020#928a;
|FPRC;

|DEFBUCLE Leew82_Aux83;
  #928#1;
  ;
  #982#0,#982#1, 00;
  #982#0,#982#1, 99;
  ;
  NULL, Leew82_Aux83;
|FIN;

|PROCESO CalNueProrr;
   nTpComun = #927#17;
   |BUCLE Leew82_Aux83;
|FPRC;

|PROCESO  CambioSectores;
         nSwCalculo = 0;
         |BUCLE BorrandoS;

         |SI #927#14 ! "M";
             nSwVarios = 0;
             nSwOpe83   = 5;
             nNumAct    = #927#15;
             |BUCLE LeeElAux83_Es;   ||ver cuantos sectores hay
             |SI nNumAct = 1;   || Solo existe una actividad
                 aTipoPr = "G";
             |SINO;
                 |SI nSwVarios = 0;
                     aTipoPr = "G";
                 |SINO;
                     aTipoPr = "E";
                 |FINSI;
                 |SI #927#14 = "G";   aTipoPr = "G";  |FINSI;
                 #927#4 = aTipoPr; |PINTA #927#4;
             |FINSI;
         |FINSI;

         nTpComun = #927#17;
         |ABRE #928;
         nSwOpe83    = 3;
         |BUCLE LeeElAux83_Es;   ||Calculo los totales por sectores

         nSwOpe83    = 4;
         |BUCLE LeeElAux83_Es;   ||Calculo para cada actividad

         |CIERRA #928;
|FPRC;

|PROCESO  CambioPorcentajes;
         nTpComun   = #927#17;
         |ABRE #928;
         nSwOpe83    = 4;
         |BUCLE LeeElAux83_Es;   ||Calculo para cada actividad
         |CIERRA #928;
|FPRC;

|| ***********************************************************************

|PROCESO Canvi; |TIPO 0;
|FPRC;

|PROCESO sector83;
  |SI #983#2 = 0;  #983#34 = 0;  |PINTA #983#34; |FINSI;
  |SI #983#2 = 99; #983#34 = 99; |PINTA #983#34; |FINSI;
  nSwCambio = 1;
|FPRC;

|PROCESO tipo83; |TIPO 0;

  |SI #983#2 = 0; |O #983#2 = 99; #983#10 = "X"; |FINSI;
  |SI #983#10 = "A"; #983#11 = "ACCESORIA"; |FINSI;
  |SI #983#10 = "C"; #983#11 = "COMPLEMENTARIA"; |FINSI;
  |SI #983#10 = "P"; #983#11 = "PRINCIPAL"; |FINSI;
  |SI #983#10 = "O"; #983#11 = "OTRA"; |FINSI;
  |SI #983#10 = "X";
      |SI #983#2 = 0;  #983#11 = "COMUN"; |FINSI;
      |SI #983#2 = 99; #983#11 = "REGULARIZACION"; |FINSI;
  |FINSI;
  |PINTA #983#11;
|FPRC;

|PROCESO Comoestaba;
  #983#34 = #983#35;
  #983#10 = #983#36;
  #983#11 = #983#37;
  #983#5  = #983#38;
  #983#9  = #983#38;
  |GRABA 020#983a;
  |LIBERA #983;
|FPRC;

|DEFBUCLE Comoestaba;
  #983#1;
  ;
  enEjer, enEmpresa, 00;
  enEjer, enEmpresa, 99;
  ;
  NULL, Comoestaba;
|FINSI;

|PROCESO paraCambiar;
  |SI #927#14 = "M"; |O #927#14 = "S";
      |C_M #983#34,1,"S";
      |C_M #983#10,1,"S";
      |C_M #983#9, 1,"N";
      |ENTLINEAL #1#983, -3, 2, 20, 0, ClaveBajaL83, ClaveAltaL83;
      |C_M #983#34,1,"N";
      |C_M #983#10,1,"N";
      |C_M #983#9, 1,"S";
      |SI nSwCambio = 1;
          aAlfa = #982#32;
          #982#32 = "S";
          |HAZ CambioSectores;
          #982#32 = aAlfa;
          |ENTLINEAL #1#983, -3, 7, 20, 0, ClaveBajaL83, ClaveAltaL83;
      |FINSI;
  |FINSI;

  |C_M #927#4,  1, "N";
  |C_M #927#17, 1, "N";
  |SI #927#14 = "M";
      |SI #982#17 ! 1; |C_M #927#4, 1,"S"; |FINSI;
      |C_M #927#17, 1, "S";
  |FINSI;

  |SI #927#14 = "G";
      |SI #927#4 ! "G"; nSwCambio = 1;  |FINSI;
      |SI #982#6 = 0;
          nNume2 = 100;
      |SINO;
          nNume1 = (( #982#5 / #982#7 ) * 100) ! 2;
          nNume2 = nNume1 ! 0;
          |SI nNume2 < nNume1;
              nNume2 = nNume1 ! 0 + 1;
          |FINSI;
      |FINSI;
      |SI nNume2 > 100; nNume2 = 100; |FINSI;
      |SI nNume2 < 0;   nNume2 = 0;   |FINSI;
      #927#17  = nNume2;
      |PINTA #927#17;
      #927#4 = "G"; |PINTA #927#4;
  |FINSI;
|FPRC;

|PROCESO ClaveBajaL28;
  #928#0 = enEmpresa;
  #928#1 = enEjer;
  #928#2 = 00;
|FPRC;

|PROCESO ClaveAltaL28;
  #928#0 = enEmpresa;
  #928#1 = enEjer;
  #928#2 = 99;
|FPRC;

|PROCESO definitivo128;
  nNume1 = Contenido;

  |SI #928#2 = 99; #928Campo = 100;     |PINTA #928Campo; |FINSI;
  |SI #928#2 = 00; #928Campo = #927#17; |PINTA #928Campo; |FINSI;

  |SI nNume1 ! #928Campo;
      nSwCambio = 1;
  |FINSI;
|FPRC;

|PROCESO Consultaw28;
  |PUSHV 0501 2380;
  |PINPA #0#928;
  |ENTLINEAL #1#928, -3, 4, 20, 0, ClaveBajaL28, ClaveAltaL28;
  |POPV;
|FPRC;

|PROCESO modiTp;

      |SI #927#14 ! "M"; |Y #927#14 ! "G";
          |SI #927#4 = "E";  |HAZ Consultaw28; |FINSI;
          |ACABA;
      |FINSI;

      aTipoPr = #927#4;
      |HAZ CalNueProrr;
      |SI aTipoPr = "E";
          |PUSHV 0501 2380;
          |PINPA #0#928;
          |ENTLINEAL #1#928, -3, 2, 20, 0, ClaveBajaL28, ClaveAltaL28;
          |POPV;
      |FINSI;
      |SI nSwCambio = 1;
          aAlfa = #982#32;
          #982#32 = "S";
          |HAZ CambioPorcentajes;
          #982#32 = aAlfa;
          |ENTLINEAL #1#983, -3, 7, 20, 0, ClaveBajaL83, ClaveAltaL83;
      |FINSI;
|FPRC;

|PROCESO Tipo7w83; |TIPO 7;
   |MENSA "    Pulse <F2> para consultar Sectores";
|FPRC;

|PROCESO Tipo0w83; |TIPO 0;
   |BLIN 4;
|FPRC;

|PROCESO Tipo11w83; |TIPO 11;
  |SI FSalida = 10;
      |HAZ Consultaw28;
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO Tipo12_w127; |TIPO 12;
|FPRC;

|PROCESO PideProrrata;
       nSwCambio = 0;
       |C_V #982#21,1,"S";
       |C_V #982#18,1,"S";
       #982#21 = #982#3;

       aTipoCalculo = #982#32;

       |PUSHV 0501 2380;
       nSwSal = 0;
       |PINPA #0#927;

       |ABRE #85;
       |DDEFECTO #85;
       #85#0 = #982#1;
       #85#1 = #982#0;
       |LEE 041#85=;
       |CIERRA #85;

       |DDEFECTO #927;
       |PARA nCampo = 0; |SI nCampo [ 17; |HACIENDO nCampo = nCampo + 1;
             #927nCampo = #85nCampo;
       |SIGUE;
       |PINDA #0#927;

       |PINTA 0718, #982#2;  |PINTA 0767, #982#15;
       |PINTA 2217, #982#5;  |PINTA 2229, #982#6;
       |PINTA 2241, #982#7;
       |PINTA 2273, #982#3;  |PINTA 2275, #982#4;

       |C_P #983#3, 1, 1303;
       |C_V #983#14, 1, "N";
       |PARA nCampo = 19; |SI nCampo [ 27; |HACIENDO nCampo = nCampo + 1;
             |C_V #983nCampo, 1, "N";
       |SIGUE;

       |C_V #983#31, 1, "N";
       |C_V #983#32, 1, "N";
       |C_V #983#34, 1, "S";
       |C_V #983#8, 1, "S";
       |ENTLINEAL #1#983, -3, 7, 20, 0, ClaveBajaL83, ClaveAltaL83;

       |ENDATOS #1#927;

       |C_P #983#3, 1, 1016;
       |C_V #983#14, 1, "S";
       |PARA nCampo = 19; |SI nCampo [ 27; |HACIENDO nCampo = nCampo + 1;
             |C_V #983nCampo,1,"S";
       |SIGUE;

       |C_V #982#18,1,"N"; |C_M #982#18,1,"N";
       |C_V #982#21,1,"N"; |C_M #982#21,1,"N";

       |CONFI "    SSon Correctos los Datos Introducidos";
       |SI FSalida = 0;
           #982#21 = #927#4;
           #982#4  = #927#17;
           #982#18 = #927#17;
           #982#14 = #927#14;

           #982#3 = #982#21;
           |SI #982#3 = "G"; #982#23 = " GENERAL"; |FINSI;
           |SI #982#3 = "E"; #982#23 = " ESPECIAL"; |FINSI;

           |SI #982#32 ! #927#14;
               #982#32 = #927#14;
               |SI nSwCambio = 0;
                   |ABRE #85;
                   #85#0 = enEmpresa;
                   #85#1 = enEjer;
                   |LEE 141#85=;
                   |SI FSalida = 0;
                       #85#14  = #982#32;
                       |GRABA 020#85a;
                   |FINSI;
                   |LIBERA #85;
                   |CIERRA #85;
               |FINSI;
           |FINSI;
           |SI aTipoCalculo ! #927#14;
               aMensa = "1234Calculo automatico. "; || "Vuelva a calcular el Modelo para hacer efectivos los cambios.";
               |SI #927#14 = "S"; aMensa = "1234Sectores de las Actividades Fijados"; |FINSI;
               |SI #927#14 = "G"; aMensa = "1234Tipo de Prorrata General Fijada.";    |FINSI;
               |SI #927#14 = "M"; aMensa = "1234Calculo de Prorrata Definitiva segun lo informado Manualmente.";    |FINSI;
               |MENAV aMensa;
               nSwCambio = 1;
           |FINSI;

       |SINO;

           |SI nSwCambio = 1;
               |BUCLE Comoestaba;
               aAlfa = #982#32;
               #982#32 = "S";
               |HAZ CambioSectores;
               #982#32 = aAlfa;
           |FINSI;
           nSwCambio = 0;
       |FINSI;

       |POPV;
       |PINTA #982#3;
       aTipoPr = #982#3;
       #982#19 = "";
       |SI #982#3 = "G";
           aAlfa1  = #982#4; |QBF aAlfa1;
           #982#23 = " GENERAL";
       |SINO;
           aAlfa1  = #982#18; |QBF aAlfa1;
           #982#23 = " ESPECIAL";
       |FINSI;
       aAlfa1  = ("   " + aAlfa1) % -103;
       #982#19 = aAlfa1;
       |PINTA #982#19;

       |GRABA 020#982a;

       |SI nSwCambio ! 0;
           |SI aTipoCalculo ! #982#32; |Y #982#32 = "A";
               nSwCalculo = 0;
               |BUCLE BorrandoS;
               nSwCalculo = 1;
               |HAZ CalculoPrin;
           |SINO;
               |HAZ ModificoNueProrr;
           |FINSI;
       |FINSI;
|FPRC;
|| ///////////////////////////////////////////////////////////////////

|PROCESO Boton2w082;
     |PTEC 824;
|FPRC;

|PROCESO Boton3w082;
     |PTEC 825;
|FPRC;

|PROCESO Boton4w082;
     |PTEC 826;
|FPRC;

|PROCESO Boton5w082;
     |PTEC 827;
|FPRC;

|PROCESO Boton6w082;
     |PTEC 828;
|FPRC;


|| ********************** Imprimo Datos
|PROCESO LeoInfw83;
 |SI eaCa4 = ""; eaCa4 = #983#13; |FINSI;
 |PRINT;
|FPRC;

|DEFBUCLE LeoInfw83;
 #983#1;
 ;
 #0#0, enEmpresa, 00;
 #0#0, enEmpresa, 99;
 ;
 NULL, LeoInfw83;
|FIN;

|PROCESO LeoReflejo;

 enEmpresa = #182#1;
 nSwLinea  = 0;
 eaCam1    = #182#1; |QBF eaCam1;
 eaCam1    = ("00000" + eaCam1) % -105;
 eaCam2    = #182#2;
 eaCam3    = "ESPECIAL";
 enCam4    = "";
 |SI #182#3 = "G";
     eaCam3 = "GENERAL ";
     enCam4 = #182#19;
     enCam4 = enCam4 + "%";
     enCam4 = ("     " + enCam4) % -104;
 |FINSI;
 eaCam8    = "NO";
 |SI #182#8 = "S";
     eaCam8 = "SI";
 |FINSI;
 enCam10   = #182#5;
 enCam13   = #182#6;
 enCam11   = #182#7;
 eaCam15   = #182#15;

 |SI nInkey = 15;
     |BUCLE LeoInfw83;
 |SINO;
     |PRINT;
 |FINSI;
|FPRC;

|DEFBUCLE LeoReflejo;
 #182#1002;
 ;
 #0#0, nDEmp;
 #0#0, nHEmp;
 ;
 NULL, LeoReflejo;
|FIN;

|PROCESO Imprimir;
   eaTex = "";  ||| Datos Economicos del Ejercicio Actual";
   eaTit = "DEFINITIVA";
   enEj82 = #0#0;

   |DBASE aBase;  |QBT aBase;
   aDef = aBase + "def/dsmow082.mas";
   |CARGA_DEF aDef, reflejo@;
   |SI FSalida ! 0;
       aAlfa = "     Error en cargar el Def dsmow082";
       |MENAV aAlfa;
       |ACABA;
   |FINSI;
   |NOME_DAT #182 aFichw82;

   |IMPRE 0;
   |SI FSalida ! 0;
       |DESCARGA_DEF #reflejo@;
       |ACABA;
   |FINSI;

   informe = inform1;
   nDEmp   = 1;
   nHEmp   = 99999;
   |SI nInkey = 15;
       informe = inform2;
       nDEmp   = enEmpresa;
       nHEmp   = enEmpresa;
   |FINSI;

   |INFOR informe;
   |SI FSalida ! 0;
       |FINIMP;
       |DESCARGA_DEF #reflejo@;
       |ACABA;
   |FINSI;

   |BUCLE LeoReflejo;

   |PIEINF;
   |FININF;
   |FINIMP;
   |DESCARGA_DEF #reflejo@;
|FPRC;
