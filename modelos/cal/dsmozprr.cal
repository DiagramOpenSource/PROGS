|FICHEROS;
     dsmozprr #0;

     dsmom027 #27;
     dsmom029 #29;

     dsmom080 #80;
     dsmom081 #81;
     dsmom082 #82;
     dsmom083 #83;

     dsmod300 #300;
     dsmod303 #303;
     dsmod320 #320;
     dsmod330 #330;
     dsmod332 #332;
     dsmod370 #370;
     dsm30301;

     dsmom007 #7;
|FIN;

|VARIABLES;
     aParametro = "";
     aAlfa      = "";

     nCampo        = 0;
     nDEmpresa     = 0;
     nHEmpresa     = 0;
     nDEjer        = 0;
     nHEjer        = 0;

     fFecha    = @;

     nEmpresa  = 0;
     nEjer     = 0;
     nPerio    = 0;

     nEstado   = "";
|FIN;

|INCLUYE i_variar;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO Ejercicio;  |TIPO 7;
     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#0   = aAlfa;
     |SI aParametro ! "prov";
         #0#0   = #0#0 - 1;
     |FINSI;
     |PINTA #0#0;
|FPRC;

|PROCESO Parrilla;
     |SI #0#1 = 0;
         #0#1 = 0;  |PINTA #0#1;
         #0#2 = 0;  |PINTA #0#2;  |C_M #0#2, 1, "N";
         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI nEmpresa = 0;
             |C_M #0#1, 1, "S";
             |C_M #0#2, 1, "S";
         |FINSI;

         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\

|PROCESO Graba29;
 |SI aParametro ! "prov";
     #82#0 = nEmpresa;
     #82#1 = nEjer;
     #82#2 = nPerio;
     |LEE 101#82=;
     |SI FSalida = 0;
         #82#4  = enProrr29;
         |SI nEjer < enEjerPro; #82#61 = "N"; |FINSI;
         |GRABA 020#82a;
         |SI nPerio = 12; #80#5 = enProrr29; |FINSI;
     |FINSI;
     |LIBERA #82;
 |SINO;
     |SI nPerio = 12; #80#5 = enProrr29; |FINSI;
 |FINSI;
|FPRC;

|PROCESO LeeElm029;

 #82#0 = #29#0;
 #82#1 = nEjer;
 #82#2 = #29#2;
 |LEE 101#82=;
 |SI FSalida ! 0;
     |DDEFECTO #82;
     #82#0 = #29#0;
     #82#1 = nEjer;
     #82#2 = #29#2;
     #82#7 = #29#7;
     |GRABA 020#82b;
 |FINSI;
 #82#3 = #82#3 + #29#3;  #82#9  = #82#3;
 #82#5 = #82#5 + #29#5;  #82#16 = #82#5;
 #82#6 = #82#3 - #82#5;  #82#23 = #82#6;

 #82#31 = #80#12;  #82#32 = #82#31;
 #82#39 = #82#5;   #82#40 = #82#39;
 |SI enPeriodo = 12;
     #82#47 = #80#12; #82#48 = #82#47;
     #82#3 = #80#10 + #29#3;
     #82#5 = #80#12 + #29#5;
 |FINSI;
 #82#8  = #82#8 + #29#8;
 |SI nEjer < enEjerPro; #82#61 = "N"; |FINSI;

 |GRABA 020#82a;
 |LIBERA #82;

 #80#10 = #80#10 + #29#3;
 #80#11 = #80#11 + #29#8;
 #80#12 = #80#12 + #29#5;
 #80#13 = #80#10 - #80#11;
|FPRC;

|DEFBUCLE LeeElm029;
 #29#1;
 ;
 nEmpresa, #27#1, 01, 00;
 nEmpresa, #27#1, 99, 00;
 e;
 NULL, LeeElm029;
|FIN;

|PROCESO dsm30301;
     nPerio    = #dsm30301#2;
     enProrr29 = #dsm30301#92;
     |HAZ Graba29;
|FPRC;

|DEFBUCLE dsm30301;
     #dsm30301#1;
     ;
     nEmpresa, #27#1,  1, 303, 00, 00;
     nEmpresa, #27#1, 12, 303, 99, 99;
     ;
     NULL, dsm30301;
|FIN;

|PROCESO DP300;
     nPerio    = #300#2;
     enProrr29 = #300#66;
     |HAZ Graba29;
|FPRC;

|DEFBUCLE dsmod300;
     #300#1;
     ;
     nEmpresa, #27#1,  1, 300, 00, 00;
     nEmpresa, #27#1, 12, 300, 99, 99;
     ;
     NULL, DP300;
|FIN;

|PROCESO DP303;
     nPerio    = #303#2;
     enProrr29 = #303#64;
     |HAZ Graba29;
|FPRC;

|DEFBUCLE dsmod303;
     #303#1;
     ;
     nEmpresa, #27#1,  1, 303, 00, 00;
     nEmpresa, #27#1, 12, 303, 99, 99;
     ;
     NULL, DP303;
|FIN;

|PROCESO DP370;
     nPerio    = #370#2;
     enProrr29 = #370#87;
     |HAZ Graba29;
|FPRC;

|DEFBUCLE dsmod370;
     #370#1;
     ;
     nEmpresa, #27#1,  1, 370, 00, 00;
     nEmpresa, #27#1, 12, 370, 99, 99;
     ;
     NULL, DP370;
|FIN;

|PROCESO DP320;
     nPerio    = #320#2;
     enProrr29 = #320#68;
     |HAZ Graba29;
|FPRC;

|DEFBUCLE dsmod320;
     #320#1;
     ;
     nEmpresa, #27#1,  1, 320, 00, 00;
     nEmpresa, #27#1, 12, 320, 99, 99;
     ;
     NULL, DP370;
|FIN;

|PROCESO DP330;
     nPerio    = #330#2;
     enProrr29 = #330#70;
     |HAZ Graba29;
|FPRC;

|DEFBUCLE dsmod330;
     #330#1;
     ;
     nEmpresa, #27#1,  1, 330, 00, 00;
     nEmpresa, #27#1, 12, 330, 99, 99;
     ;
     NULL, DP330;
|FIN;

|PROCESO DP332;
     nPerio    = #332#2;
     enProrr29 = #332#70;
     |HAZ Graba29;
|FPRC;

|DEFBUCLE dsmod332;
     #332#1;
     ;
     nEmpresa, #27#1,  1, 330, 00, 00;
     nEmpresa, #27#1, 12, 330, 99, 99;
     ;
     NULL, DP332;
|FIN;

|| -------------------------------------------------------------
|PROCESO LasProrratas;

   |SI #27#2 [ 0;      #27#2 = 100;  |FINSI;
   |SI enSwProrr = 2;  #27#2 = 100;  |FINSI;
   |SI #27#2 > 100;    #27#2 = 100;  |FINSI;
   #27#42 = #27#2;

   nEmpresa = #27#0;
   nEjer    = #0#0;

   |DDEFECTO #80;
   #80#0 = nEmpresa;  || cliente
   #80#1 = nEjer;     || a¤o
   |LEE 101#80=;
   nEstado = FSalida;
   #80#0 = nEmpresa;  || cliente
   #80#1 = nEjer;     || a¤o

   #80#2 = "G";
   #80#3 = #27#2;  || provisional
   #80#4 = "G";
   #80#5 = 100;
   |PDEFECTO #80, 6,40;

   |SI aParametro ! "prov";
       |ABRE #82;
       |BUCLE LeeElm029;

       |SI #0#0 [ 2008;
           |BUCLE dsmod300;
           |BUCLE dsmod370;
           |BUCLE dsmod320;
           |BUCLE dsmod330;
           |BUCLE dsmod332;
       |FINSI;

       |SI #0#0 ] 2009;  |Y #0#0 [ 2013;
           |BUCLE dsmod303;
           |BUCLE dsmod370;
       |FINSI;

       |SI #0#0 ] 2014;
           |BUCLE dsm30301;
       |FINSI;

       |CIERRA #82;

       #80#6 = #27#4;
       #80#7 = #27#5;
       #80#8 = #27#6;
       #80#9 = #27#44;

   |SINO;
       #80#2 = "G";
       #80#3 = #27#3;  || provisional

       |SI #0#0 [ 2008;
           |BUCLE dsmod300;
           |BUCLE dsmod370;
           |BUCLE dsmod320;
           |BUCLE dsmod330;
           |BUCLE dsmod332;
       |SINO;
           |BUCLE dsmod303;
           |BUCLE dsmod370;
       |FINSI;
   |FINSI;

   |SI nEstado = 0; |GRABA 020#80a; |FINSI;
   |SI nEstado ! 0; |GRABA 020#80b; |FINSI;
   |LIBERA #80;
|FPRC;

|DEFBUCLE LasProrratas;
 #27#1;
 ;
 nDEmpresa, nDEjer;
 nHEmpresa, nHEjer;
 be;
 NULL, LasProrratas;
|FIN;

|PROCESO Tipo3;  |TIPO 3;

     nDEjer = #0#0; nHEjer = #0#0;
     |SI aParametro = "prov";
         nDEjer = #0#0 - 1; nHEjer = #0#0 -1;
     |FINSI;

     |ABRE #80;
     |SI #0#1 ! 0;
         nDEmpresa = #0#1;
         nHEmpresa = #0#2;
         |BUCLE LasProrratas;
     |SINO;
         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               nDEmpresa = #0nCampo;
               nHEmpresa = #0nCampo;
               |BUCLE LasProrratas;
         |SIGUE;
     |FINSI;
     |CIERRA #80;
|FPRC;


|PROGRAMA;
  |ABRE #7;
  #7#0 = 2;
  #7#1 = 11;
  |LEE 040#7=;
  |SI FSalida ! 0;
      |CIERRA #7;
      eaExtension = "mod";
      eaPrograma  = "dsmom007";
      |SUB_EJECUTA_NP ":basica/dspatron";
  |SINO;
      |CIERRA #7;
  |FINSI;

 aParametro = PARAMETRO;
 |QBF aParametro;

 |SI aParametro = "";
     |HAZ LeeCtrlProrr;
     |MANTE #0;
 |SINO;
     #0#0 = enEjer;
     #0#1 = 00001;
     #0#2 = 99999;
     |HAZ Tipo3;
 |FINSI;
|FPRO;
