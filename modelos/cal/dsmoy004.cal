|FICHEROS;
     dsmoy004 #0;
     dsmom002 #2;
     dsmom017 #17;
     dsmom019 #19;
     dsmow027 #99,MANTE;
     dsmom030 #30;
     dsmoc310 #310;

     :/integral/def/dsam0121 #121;
     :/integral/def/dsam0122 #122;
     :/integral/def/dsam0054 #54;

     :/contagen/def/canempre #101;
     :/contagen/def/camaniva #102;
     :/contagen/def/caivalin #103;
     :/contagen/def/caivaasi #104;

     :/basica/def/agicen14 #214;

     &clientes@ #715;
|FIN;

|VARIABLES;
     aBase        = "";
     aOrigen      = "";
     aDestino     = "";
     aAlfa        = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAlfa3       = "";
     fFecha       = @;
     aLen         = "";
     aImpor1      = "";
     aImpor2      = "";
     aImpor3      = "";
     aImpor4      = "";
     aCaracter    = "";
     aIPRemoto    = "";
     aDecima      = "";
     aEntero      = "";
     aLong        = "";
     aMenav       = "";
     aAsigna      = "";
     aIdenti      = "";
     aFichero     = "";
     aAbre        = "";
     aPathConta   = "";

     nSwBueno      = 0;
     nContaPuntero = 0;
     nConta        = 0;
     nEmpresas     = 0;
     nLen          = 0;
     nCampo        = 0;
     nPos          = 0;
     nLong         = 0;
     nDecimal      = 0;
     nCaracter     = 0;
     nCanal        = 0;
     nNume         = 0;
     nWord         = 0;
     nConver       = 0;
     nLinea        = 0;
     nCuota        = 0;
     nCuotaSopor   = 0;
     nCuotaInver   = 0;
     nCuotaMin     = 0;
     nIvaAPagar    = 0;
     nPagos        = 0;
     nDepar        = 0;
     nEjer         = 0;
     nTD           = 0;
     nTT           = 0;
     nTF           = 0;

     &eaContador      = "";
     &eaImporte       = "";
     &eaAlfa          = "";
     &eaOrigen        = "";
     &eaDestino       = "";
     &eaNomUbicacion  = "";
     &eaRutaDocumento = "";
     &eaPathIntegral  = "";
     &eaAplica        = "";
     &eaPrograma      = "";
     &eaDocumento     = "";
     &eaNomDocumento  = "";

     &enFSalida       = 0;
     &enCodUbica      = 0;
     &enConversor     = 0;
     &enEmpresa       = 0;
     &enPerConta      = 0;
     &EURODBMOD       = 0;
     &enCodCli        = 0;
     &enSwDeDonde     = 0;
     &eaUnidadBasico  = "";
     &eaDSMAC         = "";

   {1000}aCamWord      = "";
         nCamWord      = 0;

    aParam = "";
    aTitul = "";
    nSw131 = 0;
    fFecIni     = @;
    fFecFin     = @;
    aMulDep     = "";
    &enSwOpPar  = 0;
    &enSwPartido = 0;
|FIN;

|PROCESO Ejercicio;  |TIPO 7;
     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#6   = aAlfa;
     |PINTA #0#6;
|FPRC;


|PROCESO LeeUbicaciones;
     |ABRE #121;
     #121#0 = enCodUbica;
     |LEE 040#121=;
     enFSalida = FSalida;
     |SI FSalida ! 0;
         |MENAV "      No existe Ubicacion ";
         |CIERRA #121;
         |ACABA;
     |FINSI;
     |CIERRA #121;

     |HAZ CargaMac;

     |ABRE #122;
     #122#0 = enCodUbica;
     #122#1 = eaDSMAC;
     |LEE 040#122=;
     enFSalida = FSalida;
     |SI FSalida ! 0;
         aMenav =  "      No existe Ubicacion en la Maquina : " + eaDSMAC;
         |MENAV aMenav;
         |CIERRA #122;
         |ACABA;
     |FINSI;
     |CIERRA #122;

     eaRutaDocumento = #122#3;  |QBF eaRutaDocumento;
     |SI eaRutaDocumento = "";
         aMenav = "      No esta configurada la Ruta en la Maquina " + eaDSMAC;
         |MENAV aMenav;
         enFSalida = 1;
         |ACABA;
     |FINSI;
     eaNomUbicacion = #121#1;
|FPRC;

|PROCESO Ubicacion;  |TIPO 0;
     |DBASS aBase;  |QBF aBase;

     aAlfa = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathIntegral  = aBase + "integral/";
     |FINSI;

     |SI eaPathIntegral = "";
         |C_M #0#3, 1, "N";  #0#3 = "N";  |PINTA #0#3;
         |C_M #0#4, 1, "N";  #0#4 = 0;    |PINTA #0#4;
         |ACABA;
     |FINSI;

     |C_M #0#4, 1, "S";
     |SI #0#3 = "N";
         |C_M #0#4, 1, "N";  #0#4 = 0;  |PINTA #0#4;
     |FINSI;
|FPRC;

|PROCESO BuscaUbicacion;
     |SI #0#3 = "N";  |ACABA;  |FINSI;

     enCodUbica = #0#4;
     |HAZ LeeUbicaciones;
     |SI enFSalida ! 0;  |ERROR;  |ACABA;  |FINSI;

     #0#5 = eaNomUbicacion;  |PINTA #0#5;
|FPRC;

|PROCESO Asigna;
     IaCamWord = aCamWord1<-;
     IaCamWord = IaCamWord + (nCamWord);
     aCamWord  = aIdenti;
     IaCamWord = IaCamWord + 1;
     aCamWord  = aAsigna;
     nCamWord  = nCamWord + 2;
|FPRC;

|PROCESO NumeroDecimal;
     aAsigna   = nNume;
     aDecima   = "";
     aEntero   = "";
     aLong     = aAsigna % 0;
     nLong     = aLong;
     nDecimal = 0;
     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (100 * nCaracter) + 1;
           aCaracter = aAsigna % nPos;
           |SI aCaracter = ".";
               nDecimal = 1;
           |SINO;
               |SI nDecimal = 0;
                   aEntero = aEntero + aCaracter;
               |SINO;
                   aDecima = aDecima + aCaracter;
               |FINSI;
           |FINSI;
     |SIGUE;
     aDecima   = (aDecima + "00") % 102;
     aAsigna   = aEntero;

     aLong     = aAsigna % 0;
     nLong     = aLong;
     aAsigna   = "             " + aAsigna;
     aAsigna   = aAsigna % -113;
     aImpor1   = aAsigna % -103;
     aImpor2   = aAsigna % -403;
     aImpor3   = aAsigna % -703;
     aImpor4   = aAsigna % -1004;
     |SI nLong ] 10;
         |SI aImpor4 ! "  -";
             aAsigna = aImpor4 + "." + aImpor3  + "." + aImpor2 + "." + aImpor1;
         |SINO;
             aAsigna = aImpor4 + aImpor3  + "." + aImpor2 + "." + aImpor1;
      |FINSI;
    |SINO;
        |SI nLong ] 7;
            |SI aImpor3 ! "  -";
                aAsigna = aImpor3  + "." + aImpor2 + "." + aImpor1;
            |SINO;
                aAsigna = aImpor3 + aImpor2 + "." + aImpor1;
            |FINSI;
        |SINO;
            |SI nLong ] 4;
                |SI aImpor2 ! "  -";
                    aAsigna = aImpor2 + "." + aImpor1;
                |SINO;
                    aAsigna = aImpor2 + aImpor1;
                |FINSI;
            |SINO;
                aAsigna = aImpor1;
            |FINSI;
        |FINSI;
     |FINSI;

     |QBT aAsigna;

     |SI aDecima ! "00";
         aAsigna = ("                " + aAsigna + "," + aDecima) % -116;
     |SINO;
         aAsigna = (("             " + aAsigna) % -113) + ",00";
     |FINSI;

     |SI aAsigna = "            0";     aAsigna = "";  |FINSI;
     |SI aAsigna = "            0,00";  aAsigna = "";  |FINSI;

     |HAZ Asigna;
|FPRC;

|PROCESO AbreWord;
     aAlfa = eaUnidadBasico + "/MODELOS";                |RMKDIR aAlfa;
     aAlfa = eaUnidadBasico + "/MODELOS/DOCUMENTOS";     |RMKDIR aAlfa;

     |DBASS aBase;
     aOrigen   = aBase + "basica/word/" + eaDocumento;
     aDestino  = eaUnidadBasico + "/MODELOS/DOCUMENTOS/" + eaDocumento;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     nWord  = 1;
     aAbre  = aDestino;

     |WORD_ABRE nWord, aAbre;
     |WORD_PROPIEDADES nWord, "Visible", "NO";
|FPRC;

|PROCESO Grupo4_310;
     nCuota      = (#103#8 / enConversor) ! EURODBMOD;

     |SI #30#32 = 3;   nCuotaInver = nCuotaInver + nCuota;   |FINSI;
     |SI #30#32 ! 3;   nCuotaSopor = nCuotaSopor + nCuota;   |FINSI;
|FPRC;

|PROCESO LeeLinea;
     |SI #103#5 = "N"; |ACABA;  |FINSI;

     |SI aMulDep = "S";
        aAlfa1 = #103#30; |QBF aAlfa1; |SI aAlfa1 = ""; #103#30 = #102#10; |FINSI;

        nDepar = #103#30;
        |SI nDepar = 0;  nDepar = 1;   |FINSI;

        |ABRE #214;
        #214#0 = #19#0;
        #214#1 = nDepar;
        |LEE 040#214=;
        |SI FSalida ! 0;  nDepar = 1;  |FINSI;
        |CIERRA #214;

        |SI #19#3 ! nDepar;  |ACABA;  |FINSI;
     |FINSI;

     #30#0 = #103#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #30#4  = "N";     |ACABA;  |FINSI;
     |SI #30#14 ! #103#0;  |ACABA;  |FINSI;

     |HAZ Grupo4_310;
|FPRC;

|DEFBUCLE caivalin;
     #103#1;
     ;
     #102#0, #102#1, 01;
     #102#0, #102#1, 99;
     ;
     NULL, LeeLinea;
|FIN;

|PROCESO LeeCabecera;
  |SI aMulDep ! "S";
     nDepar = #102#10;
     |SI nDepar = 0;  nDepar = 1;   |FINSI;

     |ABRE #214;
     #214#0 = #19#0;
     #214#1 = nDepar;
     |LEE 040#214=;
     |SI FSalida ! 0;  nDepar = 1;  |FINSI;
     |CIERRA #214;

     |SI #19#3 ! nDepar;  |ACABA;  |FINSI;
  |FINSI;
  |BUCLE caivalin;
|FPRC;

|DEFBUCLE camaniva;
     #102#1;
     5;
     00, 0000000000, 01;
     99, 9999999999, 12;
     be;
     NULL, LeeCabecera;
|FIN;

|PROCESO RecogeConta;
     enSwPartido = 0;
     aAlfa = #19#1;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     |ABRE #101;
     |SELECT #4#101;
     #101#2  = #19#0;
     #101#26 = nEjer;
     |LEE 040#101=;
     |SI FSalida ! 0;  |CIERRA #101;  |ACABA;   |FINSI;
     |CIERRA #101;

     |SI #101#11 = 1;
         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";
          enEmpresa  = #101#2;
          enPerConta = #101#3;
          |HAZ EnConversor;
     |SINO;
          enSwOpPar   = 0;
          |HAZ SituaEmpresa;
     |FINSI;

     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;
     |ABRE #caivaasi;
     |DDEFECTO #caivaasi;
     |LEE 000#caivaasi.p;
     |CIERRA #caivaasi;
     aMulDep = #caivaasi#132;

     |ABRE #30;
     |BUCLE camaniva;
     |CIERRA #30;

     |SI enSwPartido = 1;
         enSwOpPar   = 1;
         |HAZ FinalPartido;
      |FINSI;
|FPRC;

|PROCESO CogePagos;
     nPagos = nPagos + #310#9;
|FPRC;

|DEFBUCLE dsmoc310;
     #310#1;
     ;
     #99#0, #0#6, 3, 310, #99#1, #99#2;
     #99#0, #0#6, 9, 310, #99#1, #99#2;
     ;
     NULL, CogePagos;
|FIN;

|PROCESO Asignacion;
     |ABRE #17;
     #17#0 = #99#0;
     #17#1 = #0#6;
     #17#2 = #99#1;
     #17#3 = #99#2;
     |LEE 040#17=;
     |SI FSalida ! 0;  |DDEFECTO #17;  |FINSI;
     |CIERRA #17;

     |ABRE #19;
     #19#0 = #99#0;
     #19#1 = #0#6;
     #19#2 = #99#1;
     #19#3 = #99#2;
     |LEE 040#19=;
     |SI FSalida ! 0;  |DDEFECTO #19;  |FINSI;
     |CIERRA #19;

     enCodCli = #99#0;
     |HAZ LeePersona;

     |SI enSwDeDonde = 1;
         aAsigna = "";
         |SI #715#39 ! "  ";  aAsigna = #715#39;  |FINSI;

         aAsigna = aAsigna + " " + #715#40;  |QBF aAsigna;

         |SI #715#41 ! "     ";  aAsigna = aAsigna + ", " + #715#41;  |QBF aAsigna;  |FINSI;
         |SI #715#42 ! "   ";    aAsigna = aAsigna + " "  + #715#42;  |QBF aAsigna;  |FINSI;
         |SI #715#43 ! "  ";     aAsigna = aAsigna + " "  + #715#43;  |QBF aAsigna;  |FINSI;
         |SI #715#44 ! "  ";     aAsigna = aAsigna + " "  + #715#44;  |QBF aAsigna;  |FINSI;

         aIdenti = "#DIREC1#";
         |HAZ Asigna;

         aAsigna = "";
         aAsigna = (("00" + #715#45) % -102) + (("000" + #715#46) % -103);
         aAsigna = aAsigna + " " + #715#47;  |QBF aAsigna;

         aIdenti = "#DIREC2#";
         |HAZ Asigna;

         aAsigna = #715#48;                  |QBF aAsigna;
         aIdenti = "#DIREC3#";
         |HAZ Asigna;
     |SINO;
         aAsigna = "";
         |SI #715#51 ! "  ";  aAsigna = #715#51;  |FINSI;

         aAsigna = aAsigna + " " + #715#52;  |QBF aAsigna;

         |SI #715#53 ! "     ";  aAsigna = aAsigna + ", " + #715#53;  |QBF aAsigna;  |FINSI;
         |SI #715#54 ! "   ";    aAsigna = aAsigna + " "  + #715#54;  |QBF aAsigna;  |FINSI;
         |SI #715#55 ! "  ";     aAsigna = aAsigna + " "  + #715#55;  |QBF aAsigna;  |FINSI;
         |SI #715#56 ! "  ";     aAsigna = aAsigna + " "  + #715#56;  |QBF aAsigna;  |FINSI;

         aIdenti = "#DIREC1#";
         |HAZ Asigna;

         aAsigna = "";
         aAsigna = (("00" + #715#57) % -102) + (("000" + #715#58) % -103);
         aAsigna = aAsigna + " " + #715#59;  |QBF aAsigna;

         aIdenti = "#DIREC2#";
         |HAZ Asigna;

         aAsigna = #715#60;   |QBF aAsigna;
         aIdenti = "#DIREC3#";
         |HAZ Asigna;
     |FINSI;

     aAsigna = #0#0;  |QBF aAsigna;
     |SI aAsigna ! "";  aAsigna = aAsigna + ", ";  |FINSI;
     aAsigna = aAsigna + #0#1;
     aIdenti = "#FECHA#";
     |HAZ Asigna;

     aAsigna = #0#6;
     aIdenti = "#ANO#";
     |HAZ Asigna;

     aAsigna = ("00000" + #99#0) % -105;
     aIdenti = "#COD#";
     |HAZ Asigna;

     aAsigna = #99#4;
     aIdenti = "#NOM#";
     |HAZ Asigna;

     aAsigna = #99#3;
     aIdenti = "#EPI#";
     |HAZ Asigna;

|| .. campos nuevos  para la carta
     aAsigna = #99#5;
     aIdenti = "#ACT#";
     |HAZ Asigna;

     aAsigna = #99#6;
     aIdenti = "#FEA#";
     |HAZ Asigna;

     aAsigna = #99#7;
     aIdenti = "#FEB#";
     |HAZ Asigna;
|| ...................................................

     aAsigna = #19#4;   aIdenti = "#A1#";  |HAZ Asigna;
     aAsigna = #19#5;   aIdenti = "#A2#";  |HAZ Asigna;
     aAsigna = #19#6;   aIdenti = "#A3#";  |HAZ Asigna;
     aAsigna = #19#7;   aIdenti = "#A4#";  |HAZ Asigna;
     aAsigna = #19#8;   aIdenti = "#A5#";  |HAZ Asigna;
     aAsigna = #19#9;   aIdenti = "#A6#";  |HAZ Asigna;
     aAsigna = #19#10;  aIdenti = "#A7#";  |HAZ Asigna;
     aAsigna = #19#11;  aIdenti = "#A8#";  |HAZ Asigna;
     aAsigna = #19#12;  aIdenti = "#A9#";  |HAZ Asigna;

     nCuotaSopor = 0;
     nCuotaInver = 0;
     |HAZ RecogeConta;

     |SI #0#2 = "P";
         nConver = 0;
         nNume = #19#26;   aIdenti = "#B1#";  |HAZ NumeroDecimal;
         nNume = #19#27;   aIdenti = "#B2#";  |HAZ NumeroDecimal;
         nNume = #19#28;   aIdenti = "#B3#";  |HAZ NumeroDecimal;
         nNume = #19#29;   aIdenti = "#B4#";  |HAZ NumeroDecimal;
         nNume = #19#30;   aIdenti = "#B5#";  |HAZ NumeroDecimal;
         nNume = #19#31;   aIdenti = "#B6#";  |HAZ NumeroDecimal;
         nNume = #19#32;   aIdenti = "#B7#";  |HAZ NumeroDecimal;
         nNume = #19#33;   aIdenti = "#B8#";  |HAZ NumeroDecimal;
         nNume = #19#34;   aIdenti = "#B9#";  |HAZ NumeroDecimal;

         nConver = 1;
         nNume = #19#15;   aIdenti = "#C1#";  |HAZ NumeroDecimal;
         nNume = #19#16;   aIdenti = "#C2#";  |HAZ NumeroDecimal;
         nNume = #19#17;   aIdenti = "#C3#";  |HAZ NumeroDecimal;
         nNume = #19#18;   aIdenti = "#C4#";  |HAZ NumeroDecimal;
         nNume = #19#19;   aIdenti = "#C5#";  |HAZ NumeroDecimal;
         nNume = #19#20;   aIdenti = "#C6#";  |HAZ NumeroDecimal;
         nNume = #19#21;   aIdenti = "#C7#";  |HAZ NumeroDecimal;
         nNume = #19#22;   aIdenti = "#C8#";  |HAZ NumeroDecimal;
         nNume = #19#23;   aIdenti = "#C9#";  |HAZ NumeroDecimal;

         nNume = #19#37;   aIdenti = "#D1#";  |HAZ NumeroDecimal;
         nNume = #19#38;   aIdenti = "#D2#";  |HAZ NumeroDecimal;
         nNume = #19#39;   aIdenti = "#D3#";  |HAZ NumeroDecimal;
         nNume = #19#40;   aIdenti = "#D4#";  |HAZ NumeroDecimal;
         nNume = #19#41;   aIdenti = "#D5#";  |HAZ NumeroDecimal;
         nNume = #19#42;   aIdenti = "#D6#";  |HAZ NumeroDecimal;
         nNume = #19#43;   aIdenti = "#D7#";  |HAZ NumeroDecimal;
         nNume = #19#44;   aIdenti = "#D8#";  |HAZ NumeroDecimal;
         nNume = #19#45;   aIdenti = "#D9#";  |HAZ NumeroDecimal;

         nNume = #19#117;                     aIdenti = "#TD#";   |HAZ NumeroDecimal;
         nNume = (#19#117 % 1) ! EURODBMOD;   aIdenti = "#T1#";   |HAZ NumeroDecimal;

         nTD   = #19#117;
         nTT   = #19#117 - ((#19#117 % 1) ! EURODBMOD);
         nNume = nTT;                         aIdenti = "#TT#";  |HAZ NumeroDecimal;
     |SINO;
         nConver = 0;
         nNume = #19#48;   aIdenti = "#B1#";  |HAZ NumeroDecimal;
         nNume = #19#49;   aIdenti = "#B2#";  |HAZ NumeroDecimal;
         nNume = #19#50;   aIdenti = "#B3#";  |HAZ NumeroDecimal;
         nNume = #19#51;   aIdenti = "#B4#";  |HAZ NumeroDecimal;
         nNume = #19#52;   aIdenti = "#B5#";  |HAZ NumeroDecimal;
         nNume = #19#53;   aIdenti = "#B6#";  |HAZ NumeroDecimal;
         nNume = #19#54;   aIdenti = "#B7#";  |HAZ NumeroDecimal;
         nNume = #19#55;   aIdenti = "#B8#";  |HAZ NumeroDecimal;
         nNume = #19#56;   aIdenti = "#B9#";  |HAZ NumeroDecimal;

         nConver = 1;
         nNume = #19#15;   aIdenti = "#C1#";  |HAZ NumeroDecimal;
         nNume = #19#16;   aIdenti = "#C2#";  |HAZ NumeroDecimal;
         nNume = #19#17;   aIdenti = "#C3#";  |HAZ NumeroDecimal;
         nNume = #19#18;   aIdenti = "#C4#";  |HAZ NumeroDecimal;
         nNume = #19#19;   aIdenti = "#C5#";  |HAZ NumeroDecimal;
         nNume = #19#20;   aIdenti = "#C6#";  |HAZ NumeroDecimal;
         nNume = #19#21;   aIdenti = "#C7#";  |HAZ NumeroDecimal;
         nNume = #19#22;   aIdenti = "#C8#";  |HAZ NumeroDecimal;
         nNume = #19#23;   aIdenti = "#C9#";  |HAZ NumeroDecimal;

         nNume = #19#59;   aIdenti = "#D1#";  |HAZ NumeroDecimal;
         nNume = #19#60;   aIdenti = "#D2#";  |HAZ NumeroDecimal;
         nNume = #19#61;   aIdenti = "#D3#";  |HAZ NumeroDecimal;
         nNume = #19#62;   aIdenti = "#D4#";  |HAZ NumeroDecimal;
         nNume = #19#63;   aIdenti = "#D5#";  |HAZ NumeroDecimal;
         nNume = #19#64;   aIdenti = "#D6#";  |HAZ NumeroDecimal;
         nNume = #19#65;   aIdenti = "#D7#";  |HAZ NumeroDecimal;
         nNume = #19#66;   aIdenti = "#D8#";  |HAZ NumeroDecimal;
         nNume = #19#67;   aIdenti = "#D9#";  |HAZ NumeroDecimal;

         nNume = #19#118;                     aIdenti  = "#TD#";   |HAZ NumeroDecimal;
         nNume = (#19#118 % 1) ! EURODBMOD;   aIdenti  = "#T1#";   |HAZ NumeroDecimal;

         nTD   = #19#118;
         nTT   = #19#118 - ((#19#118 % 1) ! EURODBMOD);
         nNume = nTT;                         aIdenti = "#TT#";  |HAZ NumeroDecimal;
     |FINSI;

     nTF   = nTT - nCuotaSopor;

     nCuotaMin = nTD % #19#122;                      || Total Cuota Minima
     |SI #19#120 ! 0;
         nCuotaMin = nCuotaMin * #19#120;            || Total Cuota Minima
     |FINSI;
     nCuotaMin = nCuotaMin ! EURODBMOD;

     nIvaAPagar = nTF;                               || Cuota derivada regiman general
     |SI nIvaAPagar < nCuotaMin;  nIvaAPagar = nCuotaMin;  |FINSI;

     nPagos = 0;
     |BUCLE dsmoc310;

     nNume = nCuotaSopor;         aIdenti = "#TS#";   |HAZ NumeroDecimal;
     nNume = nTF;                 aIdenti = "#TF#";   |HAZ NumeroDecimal;
     nNume = nCuotaMin;           aIdenti = "#TM#";   |HAZ NumeroDecimal;
     nNume = nIvaAPagar;          aIdenti = "#TI#";   |HAZ NumeroDecimal;
     nNume = nPagos;              aIdenti = "#TP#";   |HAZ NumeroDecimal;
     nNume = nCuotaInver;         aIdenti = "#TV#";   |HAZ NumeroDecimal;
     nNume = nIvaAPagar - nPagos - nCuotaInver;
                                  aIdenti = "#TR#";   |HAZ NumeroDecimal;


     IaCamWord = aCamWord1<-;
     nCamWord  = nCamWord / 2;
     aAsigna   = nCamWord;   ||  |QBT aAsigna;
     |WORD_ASIGNA_TEXTO nWord, aAsigna, aCamWord;
|FPRC;

|PROCESO GuardaDocumento;
     |ABRE #54;
     #54#0  = #99#0;
     #54#1  = 9999;
     |LEE 040#54];
     |SI FSalida = 0;
         |LEE 040#54a;
     |SINO;
         |LEE 040#54u;
     |FINSI;
     |SI FSalida = 0;  |Y #54#0 = #99#0;
         nLinea = #54#1 + 1;
     |SINO;
         nLinea = 1;
     |FINSI;

     |DDEFECTO #54;
     |HORA aAlfa;
     aAlfa1 = aAlfa % 102;
     aAlfa2 = aAlfa % 402;

     #54#0  = #99#0;
     #54#1  = nLinea;
     #54#2  = eaNomDocumento;
     #54#3  = "DOC" + (("00000" + #54#0) % -105) + (("0000" + #54#1) % -104) + ".DOC";
     #54#4  = ~;
     #54#5  = aAlfa1;
     #54#6  = aAlfa2;
     #54#7  = ~;
     #54#8  = aAlfa1;
     #54#9  = aAlfa2;
     #54#10 = #0#4;
     #54#11 = "";
     #54#12 = "";
     |GRABA 020#54n;
     |LIBERA #54;
     |CIERRA #54;

     aOrigen  = eaUnidadBasico + "/MODELOS/DOCUMENTOS/" + eaDocumento;
     aDestino = eaRutaDocumento + "/" + "DOC" + (("00000" + #99#0) % -105) + (("0000" + nLinea) % -104) + ".DOC";
     |QBT aOrigen;
     |QBT aDestino;

     |RCOPIA_FICHERO aOrigen, aDestino;
     |SI FSalida ! 0;
         |MENAV "     No se ha podido copia el Documento al Cliente.";
     |FINSI;
|FPRC;

|PROCESO Cierre;
     |PTEC 808;
     |WORD_PROPIEDADES nWord, "Visible", "SI";
     FSalida = "NO";
     |PARA;  |SI FSalida = "NO";  |HACIENDO;
             |PULSATECLA;
             |WORD_PROPIEDADES nWord, "Quit", "";
     |SIGUE;

     |SI #0#3 = "S";  |HAZ GuardaDocumento;  |FINSI;

     |RFBORRA aAbre;

     IaCamWord = aCamWord1<-;
     |PARA nCampo = 1;  |SI nCampo [ nCamWord;  |HACIENDO nCampo = nCampo + 1;
           aCamWord  = "";
           IaCamWord = IaCamWord + 1;
           aCamWord  = "";
           IaCamWord = IaCamWord + 1;
     |SIGUE;
     nCamWord  = 0;
|FPRC;

|PROCESO Tipo11w27;  |TIPO 11;
     |SI FSalida ! 10;  |ACABA;  |FINSI;

     |MENSA "      Abriendo el Documento, espere un Momento.";
     |HAZ AbreWord;

     |MENSA "      Cargando Campos, espere un Momento.";
     |HAZ Asignacion;

     |MENSA "      Imprimiendo, espere un Momento.";
     |HAZ Cierre;
|FPRC;

|PROCESO  MiroMod131;
  nSw131 = 1;
  |ABRE #2;
  #2#0 = #17#0;
  #2#1 = #17#3;
  #2#2 = 131;
  |LEE 001#2=;
  |SI FSalida ! 0;
      nSw131 = 0;
  |SINO;
      |SI #2#8 > "01.01.0000";
          |SI #2#8 > fFecFin;  nSw131 = 0;  |FINSI;
      |FINSI;
      |SI #2#9 > "01.01.0000";
          |SI #2#9 < fFecIni;  nSw131 = 0;  |FINSI;
     |FINSI;
   |FINSI;
   |CIERRA #2;
|FPRC;

|PROCESO CargaTempo;
     #214#0 = #17#0;  ||Empresa
     #214#1 = #17#3;  ||Actividad
     |LEE 001#214=;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;
     |SI aParam = "";
         |SI #214#7 ! 10; |ACABA; |FINSI;   ||Solo actividades sujetas a IVA
     |SINO;
         |HAZ MiroMod131;
         |SI nSw131 = 0; |ACABA; |FINSI; || no hay 131
     |FINSI;

     aAlfa1 = #17#8; |QBF aAlfa1;
     |SI aAlfa1 = "";
         #17#8 = #214#4;
         |GRABA 020#17a;
     |FINSI;

     |DDEFECTO #99;
     #99#0 = #17#0;
     #99#1 = #17#2;
     #99#2 = #17#3;
     #99#3 = #17#5;
     #99#4 = #17#7;
     #99#5 = #17#8;
     |SI #214#5 > "01.01.1900"; #99#6 = #214#5; |FINSI;
     |SI #214#6 > "01.01.1900"; #99#7 = #214#6; |FINSI;
     |GRABA 020#99n;
     |LIBERA #17;
|FPRC;

|DEFBUCLE dsmom017;
     #17#1;
     ;
     00000, #0#6, 00, 00;
     99999, #0#6, 99, 99;
     be;
     NULL, CargaTempo;
|FIN;

|RUTINA ClaveBaja99;
     #99#0 = 00001;
     #99#1 = 00;
     #99#2 = 01;
|FRUT;

|RUTINA ClaveAlta99;
     #99#0 = 99999;
     #99#1 = 99;
     #99#2 = 99;
|FRUT;

|PROCESO Tipo3;  |TIPO 3;
     eaAplica    = "modelos";
     eaPrograma  = "dsmoy004";
     eaDocumento = "";
     |SUB_EJECUTA_NP ":basica/wordm000;SACA";
     |QBF eaDocumento;
     |SI eaDocumento = "";
         |MENAV "     No ha seleccionado un Documento.";
         |ACABA;
     |FINSI;

     aFichero = ("w2" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #99 aFichero;

     |ABRE #99;  |CIERRA #99;  |DELINDEX #99;
     aAlfa1 = #0#6;
     aAlfa1 = "01.01." + aAlfa1; fFecIni = aAlfa1;
     aAlfa1 = #0#6;
     aAlfa1 = "31.12." + aAlfa1; fFecFin = aAlfa1;


     |ABRE #99;
     |ABRE #214;
     |BUCLE dsmom017;
     |CIERRA #214;
     |CIERRA #99;

     |ENTLINEAL #1#99, -1, 4, 22, 1, ClaveBaja99, ClaveAlta99;

     |DELINDEX #99;
|FPRC;

|PROGRAMA;
     |HAZ LeeUnidadBasico;

     aParam = PARAMETRO; |QBF aParam;
     aTitul = "Carta Regularizacion Final IVA Modulos";
     |SI aParam = "IRPF";
         aTitul = "Carta Regularizacion Final IRPF Modulos";
     |FINSI;

     |CLS;
     |CABEZA "Carta Regul. Final Modulos";
     |PINPA #0#0;
     |ATRI R; |PINTA 0713, aTitul; |ATRI 0;
     |PINDA #0#0;
     |ENDATOS #1#0;
|FPRO;
