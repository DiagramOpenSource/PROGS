|FICHEROS;
     dsmoz001 #0;
     dsmom001 #1;
     dsmom002 #2;
     dsmom003 #3;
     dsmom004 #4;
     dsmom005 #5;
     dsmom006 #6;
     dsmom008 #8;

     dsmom009 #9;        || Planillas
     dsmom010 #10;       ||
     dsmom011 #11;       ||
     dsmom012 #12;       ||
     dsmom013 #13;       ||
     dsmopl10;           ||
     dsmopl12;           ||
     dsmopl13;           ||

     dsmom016 #16;       || Modulos
     dsmom017 #17;       ||
     dsmom018 #18;       ||
     dsmom019 #19;       ||
     dsmom068 #68;       ||

     dsmom085 #85;       || Calculos Prorrata
     dsmom086 #86;
     dsmom087 #87;

     dsmom026 #26;       || Empresas Asociadas
     dsmom095 #95;       || Configuracion 349

     dsmow003 #99;
     :/basica/def/agifigen #100;
     :/basica/def/agicen14 #114;
     :/basica/def/agitab11 #111;
|FIN;

|VARIABLES;
     nCampo      = 0;
     nDEmpresa   = 0;
     nHEmpresa   = 0;
     nPeriodo    = 0;
     nNume       = 0;
     nSwEsta1    = 0;
     nSwEsta2    = 0;
     nNoLoToques = 0;
     nActivi     = 0;
     nPasada     = 0;
     nForzar     = 0;
     nEmpresa    = 0;
     nModeloTra  = 0;
     nModeloPla  = 0;

     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aFichero    = "";
     aMenav      = "";
     aDescri     = "";
     aEl300_9    = "";
     aEl310_7    = "";
     aEl310_9    = "";

     fHFecha     = @;
     fDFecha     = @;
     fFecha      = @;
     nSw         = 0;
     &enEmpresaA = 0;
     &enAnyo     = 0;
     &enSwEstar  = 0;
     nSwModulo   = 0;
     nPrint      = 0;
     &eaCamp1    = "";
     &eaCamp2    = "";
     &eaCamp3    = "";
     &eaCamp4    = "";
     &eaCamp5    = "";
     &eaCamp6    = "";
     &eaError    = "";
     nPanta      = 0;
     aT322       = "";
      &eaCifDom    = "";
      &eaNumero    = "";
      &eaDominante = "";
|FIN;

|INCLUYE i_variar;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO Tipo7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#0 = enEmpresa;  |PINTA #0#0;
         #0#1 = enEmpresa;  |PINTA #0#1;

         |C_M #0#0, 1, "N";
         |C_M #0#1, 1, "N";
     |FINSI;

     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#14  = aAlfa;

     |PINTA #0#14;
|FPRC;

|PROCESO Parrilla;
     |SI #0#0 = 0;
         #0#0 = 0;  |PINTA #0#0;
         #0#1 = 0;  |PINTA #0#1;  |C_M #0#1, 1, "N";
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#0, 1, "S";
             |C_M #0#1, 1, "S";
         |FINSI;

         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|| /////////////////////// PROCESOS CALCULO DEL PLANING \\\\\\\\\\\\\\\\\\\\\

|PROCESO GrabaPlanilla;
     |ABRE #9;
     #9#0 =  #8#0;
     #9#1 =  #8#1;
     #9#2 =  #8#2;
     #9#3 =  #8#4;
     #9#4 =  #8#5;
     |LEE 101#9=;
     |SI FSalida ! 0;
         |DDEFECTO #9;
         #9#0 =  #8#0;
         #9#1 =  #8#1;
         #9#2 =  #8#2;
         #9#3 =  #8#4;
         #9#4 =  #8#5;
         |GRABA 020#9b;
     |FINSI;

     |SI #8#3 = 300;  #9#7  = "X";  #9#8 = " ";  #9#9  = " ";  #9#10 = " ";  #9#11 = " ";  |FINSI;
     |SI #8#3 = 303;  #9#7  = "X";  #9#8 = " ";  #9#9  = " ";  #9#10 = " ";  #9#11 = " ";  |FINSI;
     |SI #8#3 = 370;  #9#7  = " ";  #9#8 = "X";  #9#9  = " ";  #9#10 = " ";  #9#11 = " ";  |FINSI;
     |SI #8#3 = 320;  #9#9  = "X";  #9#7 = " ";  #9#8  = " ";  #9#10 = " ";  #9#11 = " ";  |FINSI;
     |SI #8#3 = 330;  #9#10 = "X";  #9#7 = " ";  #9#8  = " ";  #9#9  = " ";  #9#11 = " ";  |FINSI;
     |SI #8#3 = 332;  #9#11 = "X";  #9#7 = " ";  #9#8  = " ";  #9#9  = " ";  #9#10 = " ";  |FINSI;
     |SI #8#3 = 349;  #9#12 = "X";  |FINSI;
     |SI #8#3 = 130;  #9#14 = "X";  |FINSI;
     |SI #8#3 = 131;  #9#15 = "X";  |FINSI;

     |ABRE #100;
     #100#0 = #9#0;
     |LEE 040#100=;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;
     |CIERRA #100;

     #114#0 = #8#0;
     #114#1 = #8#5;
     |LEE 040#114=;
     |SI FSalida ! 0;  |DDEFECTO #114;  |FINSI;
     |SI #100#94 > "01.01.0000";
         |SI #114#6 < "01.01.1900";
             #114#6 = #100#94;
         |FINSI;
     |FINSI;

     #9#5   = #100#1;
     #9#6   = #8#6;
     #9#48  = #114#3;
     #9#49  = #114#8;
     #9#50  = #114#10;
     #9#51  = #114#17;
     #9#52  = #114#12;
     #9#53  = #114#5;
     #9#54  = #114#6;
     #9#55  = #114#11;
     #9#56  = #114#9;
     #9#65  = #114#16;

     |GRABA 020#9a;
     |LIBERA #9;
     |CIERRA #9;
|FPRC;

|PROCESO GrabaModulos;
     |ABRE #17;
     #17#0 =  #8#0;
     #17#1 =  #8#1;
     #17#2 =  #8#4;
     #17#3 =  #8#5;
     |LEE 101#17=;
     |SI FSalida ! 0;
         |DDEFECTO #17;
         #17#0 =  #8#0;
         #17#1 =  #8#1;
         #17#2 =  #8#4;
         #17#3 =  #8#5;
         |GRABA 020#17b;
     |FINSI;

     |ABRE #100;
     #100#0 = #17#0;
     |LEE 040#100=;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;
     |CIERRA #100;
     |SI #100#94 > "01.01.0000";
         |SI #114#6 < "01.01.1900";
             #114#6 = #100#94;
         |FINSI;
     |FINSI;

     #17#4  = #114#2;
     #17#5  = #114#3;
     #17#7  = #100#1;

     |ABRE #16;
     |SELECT #1#16;
     #16#0  = "E";
     #16#1  = #17#5;
     #16#41 = #17#6;
     #16#2  = #17#1;
     |LEE 040#16=;
     |SI FSalida ! 0;  |DDEFECTO #16;  |FINSI;
     |CIERRA #16;

     #17#8  = #16#3;

     |SI #114#11 = 100;  |O #114#11 = 200;
         #17#12 = "S";
     |FINSI;

     |SI #114#9 = 6;  |O #114#9 = 7;  |O #114#9 = 11;  |O #114#9 = 12;
         #17#12 = "S";
     |FINSI;

     |GRABA 020#17a;
     |LIBERA #17;
     |CIERRA #17;
|FPRC;

|PROCESO Borra10;
     |BORRA 020#10a;
     |LIBERA #10;
|FPRC;

|DEFBUCLE dsmom010;
     #10#1;
     ;
     #9#0, #9#1, #9#2, #9#3, #9#4, "    ";
     #9#0, #9#1, #9#2, #9#3, #9#4, "zzzz";
     be;
     NULL, Borra10;
|FIN;

|PROCESO Borra11;
     |BORRA 020#11a;
     |LIBERA #11;
|FPRC;

|DEFBUCLE dsmom011;
     #11#1;
     ;
     #9#0, #9#1, #9#2, #9#3, #9#4, "    ";
     #9#0, #9#1, #9#2, #9#3, #9#4, "zzzz";
     be;
     NULL, Borra11;
|FIN;

|PROCESO Borra12;
     |BORRA 020#12a;
     |LIBERA #12;
|FPRC;

|DEFBUCLE dsmom012;
     #12#1;
     ;
     #9#0, #9#1, #9#2, #9#3, #9#4, "    ";
     #9#0, #9#1, #9#2, #9#3, #9#4, "zzzz";
     be;
     NULL, Borra12;
|FIN;

|PROCESO Borra13;
     |BORRA 020#13a;
     |LIBERA #13;
|FPRC;

|DEFBUCLE dsmom013;
     #13#1;
     ;
     #9#0, #9#1, #9#2, #9#3, #9#4, "    ";
     #9#0, #9#1, #9#2, #9#3, #9#4, "zzzz";
     be;
     NULL, Borra13;
|FIN;

|PROCESO Borra10pl;
     |BORRA 020#dsmopl10.a;
     |LIBERA #dsmopl10;
|FPRC;

|DEFBUCLE dsmopl10;
     #dsmopl10#1;
     ;
     #9#0, #9#1, #9#2, #9#3, #9#4, "            ";
     #9#0, #9#1, #9#2, #9#3, #9#4, "zzzzzzzzzzzz";
     be;
     NULL, Borra10pl;
|FIN;

|PROCESO Borra12pl;
     |BORRA 020#dsmopl12.a;
     |LIBERA #dsmopl12;
|FPRC;

|DEFBUCLE dsmopl12;
     #dsmopl12#1;
     ;
     #9#0, #9#1, #9#2, #9#3, #9#4, "            ";
     #9#0, #9#1, #9#2, #9#3, #9#4, "zzzzzzzzzzzz";
     be;
     NULL, Borra12pl;
|FIN;

|PROCESO Borra13pl;
     |BORRA 020#dsmopl13.a;
     |LIBERA #dsmopl13;
|FPRC;

|DEFBUCLE dsmopl13;
     #dsmopl13#1;
     ;
     #9#0, #9#1, #9#2, #9#3, #9#4, "            ";
     #9#0, #9#1, #9#2, #9#3, #9#4, "zzzzzzzzzzzz";
     be;
     NULL, Borra13pl;
|FIN;

|PROCESO BorraModulos;
     |ABRE #18;
     #18#0 = #17#0;
     #18#1 = #17#1;
     #18#2 = #17#2;
     #18#3 = #17#3;
     |LEE 101#18=;
     |SI FSalida = 0;
         |BORRA 020#18a;
     |FINSI;
     |LIBERA #18;
     |CIERRA #18;

     |ABRE #68;
     #68#0 = #17#0;
     #68#1 = #17#1;
     #68#2 = #17#2;
     #68#3 = #17#3;
     |LEE 101#68=;
     |SI FSalida = 0;
         |BORRA 020#68a;
     |FINSI;
     |LIBERA #68;
     |CIERRA #68;

     |ABRE #19;
     #19#0 = #17#0;
     #19#1 = #17#1;
     #19#2 = #17#2;
     #19#3 = #17#3;
     |LEE 101#19=;
     |SI FSalida = 0;
         |BORRA 020#19a;
     |FINSI;
     |LIBERA #19;
     |CIERRA #19;
|FPRC;

|PROCESO Borra08;
     |SI #8#7 = "PLANILLAS ";
         |SI nNoLoToques = 0;
             |ABRE #9;
             #9#0 =  #8#0;
             #9#1 =  #8#1;
             #9#2 =  #8#2;
             #9#3 =  #8#4;
             #9#4 =  #8#5;
             |LEE 101#9=;
             |SI FSalida = 0;
                 |SI #8#3 = 300;  #9#7  = " ";  |FINSI;
                 |SI #8#3 = 303;  #9#7  = " ";  |FINSI;
                 |SI #8#3 = 370;  #9#8  = " ";  |FINSI;
                 |SI #8#3 = 320;  #9#9  = " ";  |FINSI;
                 |SI #8#3 = 320;  #9#9  = " ";  |FINSI;
                 |SI #8#3 = 330;  #9#10 = " ";  |FINSI;
                 |SI #8#3 = 332;  #9#11 = " ";  |FINSI;
                 |SI #8#3 = 349;  #9#12 = " ";  |FINSI;
                 |SI #8#3 = 130;  #9#14 = " ";  |FINSI;
                 |SI #8#3 = 131;  #9#15 = " ";  |FINSI;

                 |SI #9#7  = " "; |Y #9#8  = " "; |Y #9#9  = " "; |Y #9#10 = " ";
                  |Y #9#11 = " "; |Y #9#12 = " "; |Y #9#13 = " "; |Y #9#14 = " ";
                  |Y #9#15 = " ";
                     |BORRA 020#9a;

                     |BUCLE dsmom010;
                     |BUCLE dsmom011;
                     |BUCLE dsmom012;
                     |BUCLE dsmom013;
                     |SI #8#1 ] 2019;
                         |BUCLE dsmopl10;
                         |BUCLE dsmopl12;
                         |BUCLE dsmopl13;
                     |FINSI;
                 |SINO;
                     |GRABA 020#9a;
                 |FINSI;
             |FINSI;
             |LIBERA #9;
             |CIERRA #9;
         |FINSI;
     |FINSI;

     |SI #8#7 = "MODULOS   ";
         |SI nNoLoToques = 0;
             |ABRE #17;
             #17#0 =  #8#0;
             #17#1 =  #8#1;
             #17#2 =  #8#4;
             #17#3 =  #8#5;
             |LEE 101#17=;
             |SI FSalida = 0;
                 |SI #17#19 = 0;  |Y #17#24 = 0;
                     |HAZ BorraModulos;
                     |BORRA 020#17a;
                 |FINSI;
             |FINSI;
             |LIBERA #17;
             |CIERRA #17;
         |FINSI;
     |FINSI;

     |BORRA 020#8a;
     |LIBERA #8;
|FPRC;

|DEFBUCLE dsmom008;
     #8#1;
     ;
     #4#0, #4#1, #4#2, #4#3, #4#4, 00;
     #4#0, #4#1, #4#2, #4#3, #4#4, 99;
     be;
     NULL, Borra08;
|FIN;

|PROCESO Borra04;
     enEmpresaPINET = #4#0;
     |HAZ RestriccionPINET;
     |SI enErrorPINET = 1;  |ACABA;  |FINSI;

     nPasada = 0;

     |SI #4#3  = 310;
         |SI #4#7 = "X";  |Y nForzar = 0;  |ACABA;  |FINSI;
     |SINO;
         |SI #4#7  = "X";   |ACABA;   |FINSI;
     |FINSI;

     |SI #4#9  = "X";   |ACABA;   |FINSI;
     |SI #4#11 = "X";   |ACABA;   |FINSI;
     |SI #4#13 = "X";   |ACABA;   |FINSI;

     |BORRA 020#4a;
     |LIBERA #4;

     |BUCLE dsmom008;
|FPRC;

|DEFBUCLE dsmom004;
     #4#1;
     ;
     nDEmpresa, #0#14, 00, 000, 00;
     nHEmpresa, #0#14, 99, 999, 99;
     be;
     NULL, Borra04;
|FIN;

|PROCESO PasaAl370;
     |SALVA_DATOS #8;

     #8#3 = 370;
     |LEE 101#8=;
     |SI FSalida ! 0;
         #8#3  = 370;
                           #8#12 = 303;
         |SI #3#1 [ 2008;  #8#12 = 300;  |FINSI;
         |GRABA 020#8n;
         |LIBERA #8;
     |FINSI;

     |SI #8#7 = "PLANILLAS ";
         |HAZ GrabaPlanilla;
     |FINSI;

     |REPON_DATOS #8;
     |LEE 101#8=;
|FPRC;

|DEFBUCLE dsmom008P;
     #8#1;
     ;
     #4#0, #4#1, #4#2, #4#3, #4#4, 01;
     #4#0, #4#1, #4#2, #4#3, #4#4, 99;
     be;
     NULL, PasaAl370;
|FIN;

|PROCESO Filtros2013;
     |ABRE #4;
     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = #3#2;
     #4#3 = 370;
     #4#4 = 0;
     |LEE 040#4=;
     |SI FSalida = 0;
                           #4#3 = 303;
         |SI #4#1 [ 2008;  #4#3 = 300;  |FINSI;

         #4#0 = #3#0;
         #4#1 = #3#1;
         #4#2 = #3#2;
         #4#4 = 0;
         |LEE 040#4=;
         |SI FSalida ! 0;   |DDEFECTO #4;  |FINSI;
         aEl300_9 = #4#7;

         #4#0 = #3#0;
         #4#1 = #3#1;
         #4#2 = #3#2;
         #4#3 = 310;
         #4#4 = 0;
         |LEE 040#4=;
         |SI FSalida ! 0;   |DDEFECTO #4;  |FINSI;
         aEl310_7 = #4#7;
         aEl310_9 = #4#9;

         |SI aEl300_9 = " ";  nSwEsta1 = 1;  |FINSI;
         |SI aEl310_9 = " ";  nSwEsta2 = 1;  |FINSI;

         |SI enSwEstar = 1;
             nSwEsta1 = 1;
             nSwEsta2 = 1;
         |FINSI;

         nNoLoToques = nSwEsta2;
     |FINSI;

     |SI nSwEsta1 = 1;  |Y nSwEsta2 = 1;
         |SI aEl310_7 = "X";  nForzar = 1;  |FINSI;

                           #4#3 = 303;
         |SI #3#1 [ 2008;  #4#3 = 300;  |FINSI;

         #4#0 = #3#0;
         #4#1 = #3#1;
         #4#2 = #3#2;
         #4#4 = 0;
         |LEE 101#4=;
         |SI FSalida = 0;
             |BUCLE dsmom008P;
             |HAZ Borra04;
         |FINSI;
         |LIBERA #4;

         #4#0 = #3#0;
         #4#1 = #3#1;
         #4#2 = #3#2;
         #4#3 = 310;
         #4#4 = 0;
         |LEE 101#4=;
         |SI FSalida = 0;
             |HAZ Borra04;
         |FINSI;
         |LIBERA #4;

         |SI nForzar = 1;
             aAlfa = "0000 Empresa " + #3#0 + " Ejercicio " + #3#1 + " Periodo " + #3#2;
             aAlfa = aAlfa + " Modelo 370 activado en este periodo. Vuelva a Revisar datos.";
             |MENAV aAlfa;

             nForzar = 0;
         |FINSI;
     |SINO;
         #4#0 = #3#0;
         #4#1 = #3#1;
         #4#2 = #3#2;
         #4#3 = 370;
         #4#4 = 0;
         |LEE 101#4=;
         |SI FSalida = 0;
             |HAZ Borra04;
         |FINSI;
         |LIBERA #4;
     |FINSI;

     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = #3#2;
     #4#3 = 200;
     #4#4 = 0;
     |LEE 040#4=;
     |SI FSalida = 0;
         #4#0 = #3#0;
         #4#1 = #3#1;
         #4#2 = #3#2;
         #4#3 = 201;
         #4#4 = 0;
         |LEE 101#4=;
         |SI FSalida = 0;  |HAZ Borra04;  |FINSI;
         |LIBERA #4;
     |FINSI;

     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = #3#2;
     #4#3 = 0;
     #4#4 = 0;
     |LEE 040#4];
     |SI FSalida ! 0; |O #4#0 ! #3#0; |O #4#1 ! #3#1; |O #4#2 ! #3#2;
         |BORRA 020#3a;
         |LIBERA #3;
     |FINSI;

     |CIERRA #4;
|FPRC;

|PROCESO Filtros2014;
     |ABRE #4;
     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = #3#2;
     #4#3 = 370;
     #4#4 = 0;
     |LEE 101#4=;
     |SI FSalida = 0;
        nNoLoToques = 1;
        nForzar     = 1;
        |HAZ Borra04;
     |FINSI;

     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = #3#2;
     #4#3 = 310;
     #4#4 = 0;
     |LEE 101#4=;
     |SI FSalida = 0;
        nNoLoToques = 1;
        nForzar     = 1;
        |HAZ Borra04;
     |FINSI;

     nNoLoToques = 0;
     nForzar     = 0;

     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = #3#2;
     #4#3 = 200;
     #4#4 = 0;
     |LEE 040#4=;
     |SI FSalida = 0;
         #4#0 = #3#0;
         #4#1 = #3#1;
         #4#2 = #3#2;
         #4#3 = 201;
         #4#4 = 0;
         |LEE 101#4=;
         |SI FSalida = 0;  |HAZ Borra04;  |FINSI;
         |LIBERA #4;
     |FINSI;

     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = #3#2;
     #4#3 = 0;
     #4#4 = 0;
     |LEE 040#4];
     |SI FSalida ! 0; |O #4#0 ! #3#0; |O #4#1 ! #3#1; |O #4#2 ! #3#2;
         |BORRA 020#3a;
         |LIBERA #3;
     |FINSI;

     |CIERRA #4;
|FPRC;

|PROCESO Filtros;
     enEmpresaPINET = #3#0;
     |HAZ RestriccionPINET;
     |SI enErrorPINET = 1;  |ACABA;  |FINSI;

     nSwEsta1    = 0;
     nSwEsta2    = 0;
     nForzar     = 0;
     nNoLoToques = 0;

     |SI #3#1 [ 2013;
         |HAZ Filtros2013;
     |FINSI;

     |SI #3#1 ] 2014;
         |HAZ Filtros2014;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom003;
     #3#2;
     ;
     nDEmpresa, #0#14, 00;
     nHEmpresa, #0#14, 99;
     be;
     NULL, Filtros;
|FIN;

|PROCESO GrabaTrabNormal;
     #8#0 = #4#0;
     #8#1 = #4#1;
     #8#2 = #4#2;
     #8#3 = #4#3;
     #8#4 = #4#4;
     #8#5 = 0;
     |LEE 101#8=;
     |SI FSalida ! 0;
         |DDEFECTO #8;
         #8#0  = #4#0;
         #8#1  = #4#1;
         #8#2  = #4#2;
         #8#3  = #4#3;
         #8#4  = #4#4;
         #8#5  = 0;
         #8#6  = "REGISTRO DE IMPRESION";
         #8#7  = "";
         #8#8  = "REGISTROS DEL MODELO " + #8#3 + " EJERCICIO " + #3#1 + " PERIODO " + #3#3;
         #8#9  = "N";
         #8#10 = "N";
         #8#11 = "";
         #8#12 = nModeloPla;

         |GRABA 020#8n;
     |FINSI;
     |LIBERA #8;

     nActivi = #114#1;
     aDescri = #114#4;
     |SI #4#3 = 110;  |O #4#3 = 115;  |O #4#3 = 123;  |O #4#3 = 216;
         nActivi = 1;
         aDescri = "REGISTRO DE TRABAJO";
     |FINSI;

     #8#0 = #4#0;
     #8#1 = #4#1;
     #8#2 = #4#2;
     #8#3 = #4#3;
     #8#4 = #4#4;
     #8#5 = nActivi;
     |LEE 101#8=;
     |SI FSalida ! 0;
         |DDEFECTO #8;

         #8#12 = nModeloTra;
         #8#0  = #4#0;
         #8#1  = #4#1;
         #8#2  = #4#2;
         #8#3  = #4#3;
         #8#4  = #4#4;
         #8#5  = nActivi;
         #8#6  = aDescri;
         #8#7  = #114#15;
         #8#8  = "REGISTROS DEL MODELO " + #8#12 + " EJERCICIO " + #3#1 + " PERIODO " + #3#3;
         #8#9  = "N";
         #8#10 = "N";
         #8#11 = "SIN DATOS";

         |SI #8#3 = 347;  |O #8#3 = 110;  |O #8#3 = 115;
          |O #8#3 = 349;  |O #8#3 = 123;  |O #8#3 = 216;  |O #8#3 = 340;
             |SI #8#7 = "PLANILLAS ";  #8#7 = "MANUAL";  |FINSI;
             |SI #8#7 = "MODULOS   ";  #8#7 = "MANUAL";  |FINSI;
         |FINSI;

         |SI #8#3 = 216;  #8#7 = "MANUAL";  |FINSI;

         |GRABA 020#8n;

         |SI #8#7 = "PLANILLAS ";
             |HAZ GrabaPlanilla;
         |FINSI;

         |SI #8#7 = "MODULOS   ";
             |HAZ GrabaModulos;
         |FINSI;
     |FINSI;
     |LIBERA #8;

     |SI #4#5 = "ACT.+ REG.";
         #8#0 = #4#0;
         #8#1 = #4#1;
         #8#2 = #4#2;
         #8#3 = #4#3;
         #8#4 = #4#4;
         #8#5 = 99;
         |LEE 101#8=;
         |SI FSalida ! 0;
             |DDEFECTO #8;
             #8#0  = #4#0;
             #8#1  = #4#1;
             #8#2  = #4#2;
             #8#3  = #4#3;
             #8#4  = #4#4;
             #8#5  = 99;
             #8#6  = "REGISTRO DE REGULARIZACION";
             #8#7  = "MANUAL";
             #8#8  = "REGISTROS DEL MODELO " + #8#3 + " EJERCICIO " + #3#1 + " PERIODO " + #3#3;
             #8#9  = "N";
             #8#10 = "N";
             #8#11 = "SIN DATOS";
             #8#12 = nModeloPla;
             |GRABA 020#8n;
         |FINSI;
         |LIBERA #8;
     |FINSI;
|FPRC;

|PROCESO TipoNormal;
     |SI nModeloPla = 110;  |O nModeloPla = 190;    || Mira si es una empresa asociada.
         |ABRE #26;
         |SELECT #3#26;
         #26#1 = #3#0;
         |LEE 040#26=;
         |SI FSalida = 0;  |Y #26#0 ! #26#1;
             |CIERRA #26;
             |ACABA;
         |FINSI;
         |CIERRA #26;
     |FINSI;


     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = #3#2;
     #4#3 = nModeloPla;
     #4#4 = 0;
     |LEE 040#4=;
     |SI FSalida ! 0;
         |DDEFECTO #4;
         #4#0 = #3#0;
         #4#1 = #3#1;
         #4#2 = #3#2;
         #4#3 = nModeloPla;
         #4#4 = 0;

         #6#0 = #4#0;
         #6#1 = #4#3;
         |LEE 040#6=;
         |SI FSalida = 0;
             #4#5  = #6#9;
             #4#16 = #6#12;
         |SINO;
             #5#0 = #4#3;
             |LEE 040#5=;
             |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;

             #4#5  = #5#8;
             #4#16 = #5#11;
         |FINSI;

         |SI #4#3 = 180;  |O #4#3 = 190;  |O #4#3 = 390;  |O #4#3 = 392;
          |O #4#3 = 193;  |O #4#3 = 184;  |O #4#3 = 296;  |O #4#3 = 187;
             #4#5  = "EMPRESA";
         |FINSI;

         |SI #2#7 = "TRIMESTRAL";  #4#22 = "T";  |FINSI;
         |SI #2#7 = "MENSUAL   ";  #4#22 = "M";  |FINSI;
         |SI #2#7 = "ANUAL     ";  #4#22 = "A";  |FINSI;

         |SI #114#7 = 11;  #4#23 = "S";  |FINSI;
         |SI #114#7 = 13;  #4#23 = "S";  |FINSI;

         |GRABA 020#4n;
         |LIBERA #4;
     |FINSI;

     |SI #4#5 ! "EMPRESA   ";
         |HAZ GrabaTrabNormal;
     |FINSI;
|FPRC;

|PROCESO MiraEmpresas;
     #99#0 = #1#3;
     |LEE 101#99=;
     |SI FSalida ! 0;
         |DDEFECTO #99;
         #99#0 = #1#3;
         #99#1 = "N";
         |GRABA 020#99n;
     |FINSI;
     |LIBERA #99;
|FPRC;

|DEFBUCLE dsmom001;
    #1#1;
    ;
    #2#0, #2#1, 0000;
    #2#0, #2#1, 9999;
    ;
    NULL, MiraEmpresas;
|FIN;

|PROCESO GrabaTrabCom;
     |SI #114#13 = "N";
         #8#0 = #4#0;
         #8#1 = #4#1;
         #8#2 = #4#2;
         #8#3 = #4#3;
         #8#4 = #4#4;
         #8#5 = 0;
         |LEE 101#8=;
         |SI FSalida ! 0;
             |DDEFECTO #8;
             #8#0  = #4#0;
             #8#1  = #4#1;
             #8#2  = #4#2;
             #8#3  = #4#3;
             #8#4  = #4#4;
             #8#5  = 0;
             #8#6  = "REGISTRO DE IMPRESION";
             #8#7  = "";
             #8#8  = "REGISTROS DEL MODELO " + #8#3 + " EJERCICIO " + #3#1 + " PERIODO " + #3#3;
             #8#9  = "N";
             #8#10 = "N";
             #8#11 = "";
             #8#12 = nModeloPla;
             |GRABA 020#8n;
         |FINSI;
         |LIBERA #8;

         |SI #4#5 = "ACT.+ REG.";
             #8#0 = #4#0;
             #8#1 = #4#1;
             #8#2 = #4#2;
             #8#3 = #4#3;
             #8#4 = #4#4;
             #8#5 = 99;
             |LEE 101#8=;
             |SI FSalida ! 0;
                 |DDEFECTO #8;
                 #8#0  = #4#0;
                 #8#1  = #4#1;
                 #8#2  = #4#2;
                 #8#3  = #4#3;
                 #8#4  = #4#4;
                 #8#5  = 99;
                 #8#6  = "REGISTRO DE REGULARIZACION";
                 #8#7  = "MANUAL";
                 #8#8  = "REGISTROS DEL MODELO " + #8#3 + " EJERCICIO " + #3#1 + " PERIODO " + #3#3;
                 #8#9  = "N";
                 #8#10 = "N";
                 #8#11 = "SIN DATOS";
                 #8#12 = nModeloPla;
                 |GRABA 020#8n;
             |FINSI;
             |LIBERA #8;
         |FINSI;
     |FINSI;

     #8#0 = #4#0;
     #8#1 = #4#1;
     #8#2 = #4#2;
     #8#3 = #4#3;
     #8#4 = #4#4;
     #8#5 = #114#1;
     |LEE 101#8=;
     |SI FSalida ! 0;
         |DDEFECTO #8;
         #8#0  = #4#0;
         #8#1  = #4#1;
         #8#2  = #4#2;
         #8#3  = #4#3;
         #8#4  = #4#4;
         #8#5  = #114#1;
         #8#6  = #114#4;
         |SI #114#14 = "N";
             #8#7  = #114#15;
         |SINO;
             #8#7  = "COMUNIDAD";
         |FINSI;
         #8#8  = "REGISTROS DEL MODELO " + #8#3 + " EJERCICIO " + #3#1 + " PERIODO " + #3#3;
         #8#9  = #114#13;
         #8#10 = #114#14;
         #8#11 = "SIN DATOS";
         #8#12 = nModeloTra;
         |GRABA 020#8n;

         |SI #8#7 = "PLANILLAS ";
             |HAZ GrabaPlanilla;
         |FINSI;

         |SI #8#7 = "MODULOS   ";
             |HAZ GrabaModulos;
         |FINSI;
     |FINSI;
     |LIBERA #8;
|FPRC;

|PROCESO TipoComunidad;
     |SI #114#13 = "S";
         |BUCLE dsmom001;
     |FINSI;

     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = #3#2;
     #4#3 = nModeloPla;
     #4#4 = 0;
     |LEE 040#4=;
     |SI FSalida ! 0;
         |DDEFECTO #4;
         #4#0 = #3#0;
         #4#1 = #3#1;
         #4#2 = #3#2;
         #4#3 = nModeloPla;
         #4#4 = 0;

         #6#0 = #4#0;
         #6#1 = #4#3;
         |LEE 040#6=;
         |SI FSalida = 0;
             #4#5  = #6#9;
             #4#16 = #6#12;
         |SINO;
             #5#0 = #4#3;
             |LEE 040#5=;
             |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;

             #4#5  = #5#8;
             #4#16 = #5#11;
         |FINSI;

         |SI #4#3 = 180;  |O #4#3 = 190;  |O #4#3 = 390;  |O #4#3 = 392;
          |O #4#3 = 193;  |O #4#3 = 184;  |O #4#3 = 296;  |O #4#3 = 187;
             #4#5  = "EMPRESA";
         |FINSI;

         |SI #2#7 = "TRIMESTRAL";  #4#22 = "T";  |FINSI;
         |SI #2#7 = "MENSUAL   ";  #4#22 = "M";  |FINSI;
         |SI #2#7 = "ANUAL     ";  #4#22 = "A";  |FINSI;

         |SI #114#7 = 11;  #4#23 = "S";  |FINSI;
         |SI #114#7 = 13;  #4#23 = "S";  |FINSI;

         |GRABA 020#4n;
         |LIBERA #4;
     |FINSI;

     |SI #4#5 ! "EMPRESA   ";
         |HAZ GrabaTrabCom;
     |FINSI;
|FPRC;

|PROCESO CreaPlaning;
     nModeloPla = #2#2;
     nModeloTra = #2#2;

     |SI #0#14 ] 2014;
         |SI #2#2 = 310;  |O #2#2 = 370;
             nModeloPla = 303;
             nModeloTra = 310;
         |FINSI;
     |FINSI;

     |SI nModeloPla = 309;  |ACABA;  |FINSI;

     |SI nPeriodo = 12;
         |SI nModeloTra = 370;  |O nModeloTra = 310;
             || Crea el 370 para el Ultimo Trimestre
         |SINO;
             fFecha = aAlfa1;
             |SI fHFecha < fFecha;  |ACABA;  |FINSI;

             fFecha = aAlfa2;
             |SI fDFecha > fFecha;  |ACABA;  |FINSI;
         |FINSI;
     |SINO;
         fFecha = aAlfa1;
         |SI fHFecha < fFecha;  |ACABA;  |FINSI;

         fFecha = aAlfa2;
         |SI fDFecha > fFecha;  |ACABA;  |FINSI;
     |FINSI;

     |SI #2#2 = 353;
         nEmpresa  = enEmpresa;
         enEmpresa = #2#0;
         enEjer    = #0#14;
         enPeriodo = nPeriodo;
         eaNumero  = aT322;
         |HAZ eVerREGE;
         enEmpresa = nEmpresa;
         |SI eaDominante ! "D"; |ACABA; |FINSI;
     |FINSI;
     |ABRE #3;
     |ABRE #4;
     |ABRE #8;

     #3#0 = #2#0;
     #3#1 = #0#14;
     #3#2 = nPeriodo;
     |LEE 101#3=;
     |SI FSalida ! 0;
         #3#0 = #2#0;
         #3#1 = #0#14;
         #3#2 = nPeriodo;
         |GRABA 020#3b;
     |FINSI;

     |SI nPeriodo = 1;   #3#3 = "ENERO     ";  |FINSI;
     |SI nPeriodo = 2;   #3#3 = "FEBRERO   ";  |FINSI;
     |SI nPeriodo = 3;   #3#3 = "MARZO     ";  |FINSI;
     |SI nPeriodo = 4;   #3#3 = "ABRIL     ";  |FINSI;
     |SI nPeriodo = 5;   #3#3 = "MAYO      ";  |FINSI;
     |SI nPeriodo = 6;   #3#3 = "JUNIO     ";  |FINSI;
     |SI nPeriodo = 7;   #3#3 = "JULIO     ";  |FINSI;
     |SI nPeriodo = 8;   #3#3 = "AGOSTO    ";  |FINSI;
     |SI nPeriodo = 9;   #3#3 = "SEPTIEMBRE";  |FINSI;
     |SI nPeriodo = 10;  #3#3 = "OCTUBRE   ";  |FINSI;
     |SI nPeriodo = 11;  #3#3 = "NOVIEMBRE ";  |FINSI;
     |SI nPeriodo = 12;  #3#3 = "DICIEMBRE ";  |FINSI;
     |SI nPeriodo = 99;  #3#3 = "ANUAL     ";  |FINSI;
     |GRABA 020#3a;
     |LIBERA #3;

     |SI nModeloPla ! 130;  |Y nModeloPla ! 131;
         |HAZ TipoNormal;
     |SINO;
         |HAZ TipoComunidad;
     |FINSI;

     |CIERRA #3;
     |CIERRA #4;
     |CIERRA #8;
|FPRC;

|PROCESO Planing349;
     |ABRE #95;
     #95#0 = #2#0;
     #95#1 = #0#14;
     |LEE 000#95=;
     |SI FSalida ! 0;
        |CIERRA #95;

        nEmpresa  = enEmpresa;
        enEmpresa = #2#0;
        enEjer    = #0#14;
        |SUB_EJECUTA "dsmom095;AUTOMATICO";
        enEmpresa = nEmpresa;
     |FINSI;
     |CIERRA #95;

     |ABRE #95;
     #95#0 = #2#0;
     #95#1 = #0#14;
     |LEE 000#95=;
     |SI FSalida ! 0;  |DDEFECTO #95;  |FINSI;
     |CIERRA #95;

     |SI #95#2 = "M";
         #2#7 = "MENSUAL";

         |SI #95#3 = "S";  |Y #95#4 = "M";  |Y #95#27 = "N";
             nPeriodo = 1;
             aAlfa1 = "01.01." + #0#14;
             aAlfa2 = "31.01." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#5 = "S";  |Y #95#6 = "M";
             nPeriodo = 2;
             aAlfa1 = "01.02." + #0#14;
             aAlfa2 = "29.02." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#7 = "S";  |Y #95#8 = "M";
             nPeriodo = 3;
             aAlfa1 = "01.03." + #0#14;
             aAlfa2 = "31.03." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#9 = "S";  |Y #95#10 = "M";  |Y #95#28 = "N";
             nPeriodo = 4;
             aAlfa1 = "01.04." + #0#14;
             aAlfa2 = "30.04." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#11 = "S";  |Y #95#12 = "M";
             nPeriodo = 5;
             aAlfa1 = "01.05." + #0#14;
             aAlfa2 = "31.05." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#13 = "S";  |Y #95#14 = "M";
             nPeriodo = 6;
             aAlfa1 = "01.06." + #0#14;
             aAlfa2 = "30.06." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#15 = "S";  |Y #95#16 = "M";    |Y #95#29 = "N";
             nPeriodo = 7;
             aAlfa1 = "01.07." + #0#14;
             aAlfa2 = "31.07." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#17 = "S";  |Y #95#18 = "M";
             nPeriodo = 8;
             aAlfa1 = "01.08." + #0#14;
             aAlfa2 = "31.08." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#19 = "S";  |Y #95#20 = "M";
             nPeriodo = 9;
             aAlfa1 = "01.09." + #0#14;
             aAlfa2 = "30.09." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#21 = "S";  |Y #95#22 = "M";   |Y #95#30 = "N";
             nPeriodo = 10;
             aAlfa1 = "01.10." + #0#14;
             aAlfa2 = "31.10." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#23 = "S";  |Y #95#24 = "M";
             nPeriodo = 11;
             aAlfa1 = "01.11." + #0#14;
             aAlfa2 = "30.11." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#25 = "S";  |Y #95#26 = "M";
             nPeriodo = 12;
             aAlfa1 = "01.12." + #0#14;
             aAlfa2 = "31.12." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;
     |FINSI;

     |SI #95#2 = "T";
         #2#7 = "TRIMESTRAL";

         |SI #95#7 = "S";  |Y #95#8 = "T";
             nPeriodo = 3;
             aAlfa1 = "01.01." + #0#14;
             aAlfa2 = "31.03." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#13 = "S";  |Y #95#14 = "T";
             nPeriodo = 6;
             aAlfa1 = "01.04." + #0#14;
             aAlfa2 = "30.06." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#19 = "S";  |Y #95#20 = "T";
             nPeriodo = 9;
             aAlfa1 = "01.07." + #0#14;
             aAlfa2 = "30.09." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;

         |SI #95#25 = "S";  |Y #95#26 = "T";
             nPeriodo = 12;
             aAlfa1 = "01.10." + #0#14;
             aAlfa2 = "31.12." + #0#14;
             |HAZ CreaPlaning;
         |FINSI;
     |FINSI;

     |SI #95#2 = "A";
         #2#7 = "ANUAL     ";

         nPeriodo = 99;
         aAlfa1 = "01.01." + #0#14;
         aAlfa2 = "31.12." + #0#14;
         |HAZ CreaPlaning;
     |FINSI;

     |CIERRA #5;
     |CIERRA #6;

     nEmpresa  = enEmpresa;
     enEmpresa = #2#0;
     enEjer    = #0#14;
     |SUB_EJECUTA "dsmom095;AUTOMATICO";
     enEmpresa = nEmpresa;
|FPRC;

|PROCESO Calculo_M349;

     nSw = 0;
     #2#0 = #95#0;
     #2#2 = 349;
     #2#1 = 1;
     |LEE 041#2];
     |SI FSalida = 0; |Y #2#0 = #95#0; |Y #2#2 = 349;
         nSw = 1;
     |FINSI;
     |SI nSw = 0;
         |BORRA 020#95a;
     |FINSI;
     |LIBERA #95;
|FPRC;

|DEFBUCLE dsmom095;
     #95#1;
     ;
     nDEmpresa, #0#14;
     nHEmpresa, #0#14;
     ;
     NULL, Calculo_M349;
|FIN;

|PROCESO MiroAntesModulos;
     nSwModulo = 0;
     |SI #114#2 ! "E"; |ACABA; |FINSI;

     |ABRE #16;
     |SELECT #1#16;
     #16#0  = "E";
     #16#1  = #114#3;
     #16#41 = 1;
     #16#2  = #0#14;
     |LEE 040#16=;
     |SI FSalida ! 0;
         |SI enEmpresaA ! 0; |O #0#0 = #0#1;
             |SI nModeloPla = 303;
                 aAlfa1 = "IVA";
             |SINO;
                 aAlfa1 = "IRPF";
             |FINSI;
             |SI nPanta = 0;
                 aAlfa ="0000Empresa: " + (("00000" + #2#0) % -105) + " Actividad: " + (("00" + #2#1) % -102) + " no incluida en Modulos del " + #0#14 + ".";
                 |MENAV aAlfa;
                 nPanta = 1;
             |FINSI;
             aAlfa = "0000Modifique los Regimenes de "+ aAlfa1 + " y tipo Captura";
              || |MENAV aAlfa;
             aAlfa = aAlfa + ". Modelo " + #2#2 + " no calculado en el Planing"
             |MENAV aAlfa;
         |SINO;
             |SI nPrint = 0;
                 |IMPRE 0;
                 |SI FSalida = 0;
                     nPrint = 1;
                     |INFOR "dsmoz001";
                     |SI FSalida ! 0; nPrint = 0; |FINIMP; |FINSI;
                 |FINSI;
             |FINSI;
             |SI nPrint = 1;
                 |SI nModeloPla = 303;
                     aAlfa1 = "IVA";
                 |SINO;
                     aAlfa1 = "IRPF";
                 |FINSI;
                 eaCamp1 = ("00000" + #100#0) % -105;
                 eaCamp2 = #100#1;
                 eaCamp4 = #114#2;
                 eaCamp5 = #114#3;
                 eaCamp6 = #114#4;
                 eaError = "Modifique Reg. de "+ aAlfa1 + " y tipo Captura";
                 |PRINT;
             |FINSI;
         |FINSI;
         nSwModulo = 1;
     |FINSI;
     |CIERRA #16;
|FPRC;

|PROCESO Calculo;
     nModeloPla = #2#2;
     nModeloTra = #2#2;

     |SI #0#14 ] 2014;
         |SI #2#2 = 310;  |O #2#2 = 370;
             nModeloPla = 303;
             nModeloTra = 310;
         |FINSI;
     |FINSI;

     enEmpresaPINET = #2#0;
     |HAZ RestriccionPINET;
     |SI enErrorPINET = 1;  |ACABA;  |FINSI;

     |SI #0#14 [ 2008;
         |SI nModeloPla = 303;  |ACABA;  |FINSI;
     |SINO;
         |SI nModeloPla = 300;  |ACABA;  |FINSI;
         |SI nModeloPla = 320;  |ACABA;  |FINSI;
         |SI nModeloPla = 330;  |ACABA;  |FINSI;
         |SI nModeloPla = 332;  |ACABA;  |FINSI;
     |FINSI;

     #99#0 = #2#0;
     |LEE 101#99=;
     |SI FSalida ! 0;
         |DDEFECTO #99;
         #99#0 = #2#0;
         |GRABA 020#99b;
     |FINSI;
     #99#1 = "S";
     |GRABA 020#99a;
     |LIBERA #99;

     |ABRE #100;
     #100#0 = #2#0;
     |LEE 040#100=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #100;

     #114#0 = #2#0;
     #114#1 = #2#1;
     |LEE 040#114=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #100#94 > "01.01.0000";
         |SI #114#6 < "01.01.1900";
             #114#6 = #100#94;
         |FINSI;
     |FINSI;

     aAlfa   = "31.12." + #0#14;
     fHFecha = aAlfa;

     aAlfa   = "01.01." + #0#14;
     fDFecha = aAlfa;

     |SI #114#6 > "01.01.1900";
         |SI #114#6 < fDFecha;  |ACABA; |FINSI;
     |FINSI;

     aAlfa   = #2#8 % -104;
     |SI aAlfa ! "0000";
         nNume   = aAlfa;
         |SI nNume > #0#14;  |ACABA;  |FINSI;

         |SI #2#8 > fDFecha;  fDFecha = #2#8;  |FINSI;
     |FINSI;

     aAlfa   = #2#9 % -104;
     |SI aAlfa ! "0000";
         nNume   = aAlfa;
         |SI nNume < #0#14;  |ACABA;  |FINSI;

         |SI #2#9 < fHFecha;  fHFecha = #2#9;  |FINSI;
     |FINSI;

     |SI nModeloPla = 130; |O nModeloPla = 131; |O nModeloPla = 303;
         |SI #114#15 = "MODULOS   ";
             |HAZ MiroAntesModulos;
             |SI nSwModulo = 1;
                 |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     |ABRE #5;
     |ABRE #6;

     |SI nModeloPla = 349;
         |SI #0#14 ] 2010;
             |HAZ Planing349;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #2#7 = "TRIMESTRAL";
         nPeriodo = 3;
         aAlfa1 = "01.01." + #0#14;
         aAlfa2 = "31.03." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 6;
         aAlfa1 = "01.04." + #0#14;
         aAlfa2 = "30.06." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 9;
         aAlfa1 = "01.07." + #0#14;
         aAlfa2 = "30.09." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 12;
         aAlfa1 = "01.10." + #0#14;
         aAlfa2 = "31.12." + #0#14;
         |HAZ CreaPlaning;
     |FINSI;

     |SI #2#7 = "MENSUAL   ";
         nPeriodo = 1;
         aAlfa1 = "01.01." + #0#14;
         aAlfa2 = "31.01." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 2;
         aAlfa1 = "01.02." + #0#14;
         aAlfa2 = "29.02." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 3;
         aAlfa1 = "01.03." + #0#14;
         aAlfa2 = "31.03." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 4;
         aAlfa1 = "01.04." + #0#14;
         aAlfa2 = "30.04." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 5;
         aAlfa1 = "01.05." + #0#14;
         aAlfa2 = "31.05." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 6;
         aAlfa1 = "01.06." + #0#14;
         aAlfa2 = "30.06." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 7;
         aAlfa1 = "01.07." + #0#14;
         aAlfa2 = "31.07." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 8;
         aAlfa1 = "01.08." + #0#14;
         aAlfa2 = "31.08." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 9;
         aAlfa1 = "01.09." + #0#14;
         aAlfa2 = "30.09." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 10;
         aAlfa1 = "01.10." + #0#14;
         aAlfa2 = "31.10." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 11;
         aAlfa1 = "01.11." + #0#14;
         aAlfa2 = "30.11." + #0#14;
         |HAZ CreaPlaning;

         nPeriodo = 12;
         aAlfa1 = "01.12." + #0#14;
         aAlfa2 = "31.12." + #0#14;
         |HAZ CreaPlaning;
     |FINSI;

     |SI #2#7 = "ANUAL     ";
         nPeriodo = 99;
         aAlfa1 = "01.01." + #0#14;
         aAlfa2 = "31.12." + #0#14;
         |HAZ CreaPlaning;
     |FINSI;

     |CIERRA #5;
     |CIERRA #6;
|FPRC;

|PROCESO Calculo_Prev;
    |SI #2#2 = 353; |ACABA; |FINSI;

    |SI #2#2 = 322;
        |ABRE #6;
        #6#0 = #2#0;
        #6#1 = #2#2;
        |LEE 041#6=;
        |SI FSalida ! 0;
            |CIERRA #6;
            |ACABA; || si no esta definido en el m006 no lo crea en el Planing
        |FINSI;
        |CIERRA #6;
        aT322 = #6#15;
    |FINSI;
    |HAZ Calculo;
    |SI #2#2 = 322; |Y aT322 ! "          ";
        |SALVA_DATOS #2;
        #2#2 = 353;
        |HAZ Calculo;
        |REPON_DATOS #2;
    |FINSI;
|FPRC;

|DEFBUCLE dsmom002;
     #2#1;
     ;
     nDEmpresa, 00, 000;
     nHEmpresa, 99, 999;
     ;
     NULL, Calculo_Prev;
|FIN;

|PROCESO Comuneros;
     nDEmpresa = #99#0;
     nHEmpresa = #99#0;
     |BUCLE dsmom004;    || Borrado del Planing
     |BUCLE dsmom002;    || Calculo del Planing
     |BUCLE dsmom003;    || Filtros del Planing
|FPRC;

|DEFBUCLE dsmow003;
     #99#1;
     1;
     00000, "N";
     99999, "N";
     ;
     NULL, Comuneros;
|FINSI;

|PROCESO RecalculaFechas;
     |ABRE #114;
     #114#0 = #2#0;
     #114#1 = #2#1;
     |LEE 040#114=;
     |SI FSalida ! 0;
         |BORRA 020#2a;
         |LIBERA #2;

         |CIERRA #114;
         |ACABA;
     |FINSI;
     |CIERRA #114;

     #2#8  = #114#5;
     #2#9  = #114#6;
     #2#10 = 1;
     |GRABA 020#2a;
     |LIBERA #2;
|FPRC;

|DEFBUCLE dsmom002R;
     #2#1;
     10;
     00000, 00, 000, 0;
     99999, 99, 999, 0;
     be;
     NULL, RecalculaFechas;
|FIN;

|PROCESO PonFechas;
     |ABRE #2;
     |LEE 040#2p;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #2;

     |SI #2#10 = 0;
         |BUCLE dsmom002R;   || Recalculo de Fechas;
     |FINSI;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     |HAZ PonFechas;

     aFichero = ("w3" + Usuario) % 108;
     |NOME_DAT #99 aFichero;
     |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

     |ABRE #114;
     |ABRE #99;
     |SI #0#0 ! 0;
         nDEmpresa = #0#0;
         nHEmpresa = #0#1;
         |BUCLE dsmom004;    || Borrado del Planing
         |BUCLE dsmom002;    || Calculo del Planing
         |BUCLE dsmom003;    || Filtros del Planing
         |SI #0#14 ] 2010;
             |ABRE #2;
             |SELECT #2#2;
             |BUCLE dsmom095;    || Configuracion Modelo 349
             |SELECT #1#2;
             |CIERRA #2;
         |FINSI;
     |SINO;
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo ! 0;
                   nDEmpresa = #0nCampo;
                   nHEmpresa = #0nCampo;
                   |BUCLE dsmom004;    || Borrado del Planing
                   |BUCLE dsmom002;    || Calculo del Planing
                   |BUCLE dsmom003;    || Filtros del Planing
                   |SI #0#14 ] 2010;
                       |ABRE #2;
                       |SELECT #2#2;
                       |BUCLE dsmom095;    || Configuracion Modelo 349
                       |SELECT #1#2;
                       |CIERRA #2;
                   |FINSI;
               |FINSI;
         |SIGUE;
     |FINSI;
     |CIERRA #99;

     |BUCLE dsmow003;

     |CIERRA #114;
     |DELINDEX #99;

     |SI nPrint = 1;
         |PIEINF;
         |FININF;
         |FINIMP;
     |FINSI;
|FPRC;

|PROGRAMA;

     |SI enEmpresaA ! 0;
         #0#0  = enEmpresaA;
         #0#1  = enEmpresaA;
         #0#14 = enAnyo;
         |HAZ Tipo3;
     |SINO;
          |MANTE #0;
     |FINSI;
|FPRO;
