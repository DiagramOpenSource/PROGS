|FICHEROS;
     dsmozp03 #0;

     dsmom004 #4;

     dsmom085 #85;
     dsmom086 #86;
     dsmom087 #87;

     dsmow082 #982,MANTE;
     dsmow083 #983,MANTE;

     :/basica/def/agifigen #1000;
     :/basica/def/agicen14 #1014;

     reflejo@ #182;
|FIN;

|VARIABLES;
     nNume1      = 0;
     nNume2      = 0;
     &nAny       = 0;
     &aTipoPr    = "";
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aAlfa3      = "";

     fFecIni   = @;
     fFecFin   = @;
     nInkey    = 0;
     esalta    = 0;
     esaltaL   = 0;
     nSwSal    = 0;

     aBlanc      = "";
     &eaTex      = "";
     &aFichw82   = "";
     &nSwLinea   = 0;
     &eaCam1     = "";
     &eaCam2     = "";
     &eaCam3     = "";
     &enCam4     = "";
     &eaCa4      = "";
     &eaCam8     = "";
     &enCam10    = 0;
     &enCam11    = 0;
     &enCam12    = 0;
     &enCam22    = 0;
     &enCam13    = 0;
     &eaCam15    = "";
     &eaTit      = "";
     &enEj82     = "";

     aBase = "";
     aDef  = "";
     nDEmp = 0;
     nHEmp = 0;
     nDAct = 0;
     nHAct = 0;
     informe = "";
     inform1 = "dsmowp03";
     inform2 = "dsmowp83";

     nBoton2    = 0;
     nBoton3    = 0;
     nBoton4    = 0;
     nBoton5    = 0;
     nBoton6    = 0;

     &aParam    = "";
     &nRepaso   = 0;
     &nSwOp87   = 0;
     &nDDepar   = 0;
     &nHDepar   = 0;
     nModelo    = 0;
     nCambio    = 0;
     nSwCambio  = 0;
     &eMensa    = 0;
|FIN;

|INCLUYE i_variar;

**************************************************************************
|PROCESO dsmom004_Act;
 |SI #4#7 = "X";
         enEmpresa     = #4#0;
         enEjer        = #4#1;
         enPeriodo     = #4#2;
         enModelo      = #4#3;
         enComplem     = #4#4;
         enTipoEntrada = 91;
         eMensa      = 1;
         |SI enModelo = 322;
             |SUB_EJECUTA_NP "dsmoc322";
         |SINO;
             |SUB_EJECUTA_NP "dsmociva";
         |FINSI;
         eMensa      = 0;

         |HAZ ChequeaSituacion;

         |GRABA 020#4a;
 |FINSI;
 |LIBERA #4;
|FPRC;

|DEFBUCLE dsmom004_Act;
 #4#1;
 ;
 enEmpresa, enEjer, 01, nModelo, 00;
 enEmpresa, enEjer, 99, nModelo, 99;
 be;
 NULL, dsmom004_Act;
|FIN;

|PROCESO CambiarDatos;
  nModelo = 303; |BUCLE dsmom004_Act;
  nModelo = 322; |BUCLE dsmom004_Act;
  nModelo = 370; |BUCLE dsmom004_Act;
|FPRC;

|PROCESO Modifica87;
      #87#11 = #86#5; |SI #87#2 = 12; #87#11 = #86#6; |FINSI;

      |SI #87#40 ! 0; |O #87#42 ! 0; |O #87#44 ! 0;
         |O #87#46 ! 0; |O #87#48 ! 0; |O #87#50 ! 0; |O #87#52 ! 0;

            #87#36 = #85#16; |SI #87#2 = 12; #87#36 = #85#17; |FINSI;

            #87#41 = (#87#40 % #87#36) ! 2;
            #87#43 = (#87#42 % #87#36) ! 2;
            #87#45 = (#87#44 % #87#36) ! 2;
            #87#47 = (#87#46 % #87#36) ! 2;
            #87#49 = (#87#48 % #87#36) ! 2;
            #87#51 = (#87#50 % #87#36) ! 2;
            #87#53 = (#87#52 % #87#36) ! 2;

            #87#37 = #87#40 + #87#42 + #87#44 + #87#46 + #87#48 + #87#50 + #87#52;
            #87#38 = #87#41 + #87#43 + #87#45 + #87#47 + #87#49 + #87#51 + #87#53;
            #87#39 = #87#37 - #87#38;
      |SINO;
            |PDEFECTO #87, 36,54;
      |FINSI;

      #87#17 = (#87#16 % #87#11) ! 2;
      #87#20 = (#87#19 % #87#11) ! 2;
      #87#23 = (#87#22 % #87#11) ! 2;
      #87#26 = (#87#25 % #87#11) ! 2;
      #87#29 = (#87#28 % #87#11) ! 2;
      #87#32 = (#87#31 % #87#11) ! 2;
      #87#35 = (#87#34 % #87#11) ! 2;

      #87#12 = #87#16 + #87#19 + #87#22 + #87#25 + #87#28 + #87#31 + #87#34;
      #87#13 = #87#17 + #87#20 + #87#23 + #87#26 + #87#29 + #87#32 + #87#35;
      #87#14 = #87#12 - #87#13;

      #87#8  = #87#12 + #87#37;
      #87#9  = #87#13 + #87#38;
      #87#10 = #87#8  - #87#9;
      |GRABA 020#87a;
      |LIBERA #87;
|FPRC;

|DEFBUCLE Modifica87;
   #87#1;
   ;
   #86#0, #86#1, 00, 000, 00, #86#2, 0, 00;
   #86#0, #86#1, 12, 999, 99, #86#2, 9, 99;
   be;
   NULL, Modifica87;
|FIN;

|PROCESO Leew82_Aux83_Act;
    #86#0 = #983#1;
    #86#1 = #983#0;
    #86#2 = #983#2;
    |LEE 001#86=;
    |SI FSalida = 0;
        #86#5  = #983#9;
        #86#15 = #983#34;
        #86#16 = #983#10;
        #86#17 = #983#11;
        |GRABA 020#86a;
    |FINSI;
    |LIBERA #86;
    |BUCLE Modifica87;
|FPRC;

|DEFBUCLE Leew82_Aux83_Act;
 #983#1;
 ;
 #982#0,#982#1, 00;
 #982#0,#982#1, 99;
 ;
 NULL, Leew82_Aux83_Act;
|FIN;

|PROCESO ModificoNueProrr;
    |ABRE #85;
    #85#0 = #982#1;
    #85#1 = #982#0;
    |LEE 001#85=;
    |SI FSalida = 0;
        #85#2  = #982#3;
        #85#3  = #982#4;
        #85#16 = #982#18;
        |GRABA 020#85a;
    |FINSI;
    |LIBERA #85;
    |CIERRA #85;
    |ABRE #86;
    |BUCLE Leew82_Aux83_Act;
    |CIERRA #86;

    |HAZ CambiarDatos;

    |PULSATECLA;
|FPRC;

**************************************************************************
|PROCESO ClaveBajaL83;
  #983#0  = #0#0;
  #983#1  = enEmpresa;
  #983#2  = 00;
  #983#34 = 00;
|FPRC;

|PROCESO ClaveAltaL83;
  #983#0  = #0#0;
  #983#1  = enEmpresa;
  #983#2  = 99;
  #983#34 = 99;
|FPRC;

|PROCESO MTipo5;  |TIPO 5;
       |LEE 040#983p;
       #983#2 = 00; |LINEAS_BI_ATRI #983#2, P, D, -1;
|FPRC;

|CALCULO Siesgeneral; |TIPO 0;
 |SI #982#3 = "G";
     |C_M #982#4,1,"S";
 |SINO;
     |C_M #982#4,1,"N";
 |FINSI;
|FCAL;

|PROCESO PintaCab;
        aBlanc = " " * 79;
        |PINTA 0601, aBlanc;
        |PINTA 0701, aBlanc;
        |PINTA 0801, aBlanc;
        |PINTA 0702, "Empresa: "; |PINTA 0711, #982#1;
        |PINTA 0717, #982#2;
        |PINTA 0759, "NIF: "; |PINTA 0764, #982#15;
|FPRC;

|PROCESO FinBotonw082;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |PULSATECLA;
|FPRC;

|PROCESO Tipo0w082;  |TIPO 0;
     |HAZ FinBotonw082;
|FPRC;

|CALCULO Tipo7w082;  |TIPO 7;

     |CONTROL_SIMPLE 0, "LBOTON,F2  Consulta Actividades ", 0732, 0755, Boton2w082;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3  Vol.Operaciones de Actividades", 0832, 0855, Boton3w082;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F4  Consulta Prorrata Aplicada ", 0657, 0680, Boton4w082;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F5  Modificar Prorrata            ", 0757, 0780, Boton5w082;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F6  Imprimir Relacion Empresas  ", 0857, 0880, Boton6w082;
     nBoton6 = FSalida;
|FCAL;

|CALCULO Tipo11w082; |TIPO 11;
    nInkey    = FSalida;
    |HAZ FinBotonw082;

    enEmpresa = #982#1;
    nAny      = #0#0;
    |SI nInkey <10; |O nInkey > 14;
        |ACABA;
    |FINSI;

    |PUSHV 0501 2380;
    |LEE 001#982=;

    |SI nInkey = 10; || (F2)
        |HAZ PintaCab;
        enModo    = 4;
        |SUB_EJECUTA_NP ":basica/agicen14";
    |FINSI;

    |SI nInkey = 11; || (F3)
        nSwSal = 0;
        |PINPA #0#983;
        |PINTA 0718, #982#2;  |PINTA 0767, #982#15;
        |PINTA 2217, #982#5;  |PINTA 2229, #982#6;
        |PINTA 2241, #982#22;
        |PINTA 2273, #982#3;  |PINTA 2275, #982#19;
        |SI enEjer > 2010;
            |C_V #983#31, 1, "N";
            |C_V #983#32, 1, "N";
            |C_V #983#8,  1, "S";
            |C_V #983#34, 1, "S";
            |ATRI R; |PINTA 1507, "Sec.";
                     |PINTA 1441, "  Total   ";
            |ATRI 0; |PINTA 1451, "³";
            |ATRI R; |PINTA 1452, "% Sobre el";
                     |PINTA 1552, "Vol. total";
                     |PINTA 1541," Ingresos ";  |ATRI 0;
        |FINSI;
        |ATRI P; |PINTA 1061, "Importes  Ingresos";
        |PINTA 1161, "Ejercicio Anterior"; |ATRI 0;

        |ENTLINEAL #2#983, -4, 4, 20, 0, ClaveBajaL83, ClaveAltaL83;
    |FINSI;

    |SI nInkey = 12; || (F4)
        |HAZ PintaCab;
        enEmpresa = #982#1;
        enEjer    = #982#0;
        |SUB_EJECUTA_NP "dsmom085";
    |FINSI;

    |POPV;

    |SI nInkey = 13;
        |SI #982#30 = "X";
            |MENAV "    No puede Modificar Prorrata, ya existen Modelos Impresos";
            |ACABA;
        |FINSI;
        |SI #982#29 = "X";
            |CONFI "    NExisten Modelo Confeccionados. Continuar con la Modificacion";
            |SI FSalida ! 0;
                |ACABA;
            |FINSI;
        |FINSI;

        |HAZ PideProrrata;

        |PINTA #982#3;
        aTipoPr = #982#3;
        nSwCambio = 0;
        |HAZ CalNueProrr;
        #982#19 = "";
        |SI #982#3 = "G";
            aAlfa1  = #982#4; |QBF aAlfa1;
            #982#23 = " GENERAL";
        |SINO;
            aAlfa1  = #982#18; |QBF aAlfa1;
            #982#23 = " ESPECIAL";
        |FINSI;
        aAlfa1  = ("   " + aAlfa1) % -103;
        #982#19 = aAlfa1;
        |PINTA #982#19;

        |GRABA 020#982a;
    |FINSI;


    |SI nInkey = 14; || (F6)
        |HAZ Imprimir;
    |FINSI;

|FCAL;


|CALCULO SalgoYa;  |TIPO 7;
     |SI nSwSal = 1;  |PTEC 807;  |FINSI;
|FCAL;

|| ************************************************************************

|PROCESO Leew82_Aux83;
  nCambio = #983#5;
  |SI #983#2 = 99; |O #983#2 = 00;
      #983#5 = #982#18;
      #983#9 = #982#18;
      |SI #983#2 = 99;
          #983#5 = 100;
          #983#9 = 100;
      |FINSI;
  |SINO;
     |SI aTipoPr = "G";
         #983#5 = #982#4;
         #983#9 = #982#4;
     |SINO;
         #983#5 = #983#9;
     |FINSI;
  |FINSI;
  |SI nCambio ! #983#5; nSwCambio = 1; |FINSI;
  |GRABA 020#983a;
|FPRC;

|DEFBUCLE Leew82_Aux83;
 #983#1;
 ;
 #982#0,#982#1, 00;
 #982#0,#982#1, 99;
 ;
 NULL, Leew82_Aux83;
|FIN;

|PROCESO CalNueProrr;
    |SI aTipoPr = "G";
        #982#4 = #982#18;
    |SINO;
        #982#4 = #982#18;
    |FINSI;
    |SI #982#4 > 100; #982#4 = 100; |FINSI;

    |BUCLE Leew82_Aux83;
|FPRC;

|| ********************** Imprimo Datos
|PROCESO LeoInfw83;
 |SI eaCa4 = ""; eaCa4 = #983#13; |FINSI;
 |PRINT;
|FPRC;

|DEFBUCLE LeoInfw83;
 #983#1;
 ;
 #0#0, enEmpresa, 00;
 #0#0, enEmpresa, 99;
 ;
 NULL, LeoInfw83;
|FIN;

|PROCESO LeoReflejo;

 enEmpresa = #182#1;
 nSwLinea  = 0;
 eaCam1    = #182#1; |QBF eaCam1;
 eaCam1    = ("00000" + eaCam1) % -105;
 eaCam2    = #182#2;
 eaCam3    = "ESPECIAL";
 enCam4    = "";
 |SI #182#3 = "G";
     eaCam3 = "GENERAL ";
     enCam4 = #182#19;
     enCam4 = enCam4 + "%";
     enCam4 = ("     " + enCam4) % -104;
 |FINSI;
 eaCam8    = "NO";
 |SI #182#8 = "S";
     eaCam8 = "SI";
 |FINSI;
 enCam10   = #182#5;
 enCam13   = #182#6;
 enCam11   = #182#7;
 eaCam15   = #182#15;

 |SI nInkey = 15;
     |BUCLE LeoInfw83;
 |SINO;
     |PRINT;
 |FINSI;
|FPRC;

|DEFBUCLE LeoReflejo;
 #182#1002;
 ;
 #0#0, nDEmp;
 #0#0, nHEmp;
 ;
 NULL, LeoReflejo;
|FIN;

|PROCESO Imprimir;
   eaTex = "Datos Economicos del Ejercicio Anterior";
   eaTit = "PROVISIONAL";
   enEj82 = #0#0;

   |DBASE aBase;  |QBT aBase;
   aDef = aBase + "def/dsmow082.mas";
   |CARGA_DEF aDef, reflejo@;
   |SI FSalida ! 0;
       aAlfa = "     Error en cargar el Def dsmow082";
       |MENAV aAlfa;
       |ACABA;
   |FINSI;
   |NOME_DAT #182 aFichw82;

   |IMPRE 0;
   |SI FSalida ! 0;
       |DESCARGA_DEF #reflejo@;
       |ACABA;
   |FINSI;

   informe = inform1;
   nDEmp   = 1;
   nHEmp   = 99999;
   |SI nInkey = 15;
       informe = inform2;
       nDEmp   = enEmpresa;
       nHEmp   = enEmpresa;
   |FINSI;

   |INFOR informe;
   |SI FSalida ! 0;
       |FINIMP;
       |DESCARGA_DEF #reflejo@;
       |ACABA;
   |FINSI;

   |BUCLE LeoReflejo;

   |PIEINF;
   |FININF;
   |FINIMP;
   |DESCARGA_DEF #reflejo@;
|FPRC;

|| ***********************************************************************
|PROCESO Baja86;
 #86#0 = enEmpresa;
 #86#1 = nAny;
 #86#2 = 00;
|FPRC;

|PROCESO Alta86;
 #86#0 = enEmpresa;
 #86#1 = nAny;
 #86#2 = 99;
|FPRC;

|PROCESO Canvi; |TIPO 0;
  nNume1 = Contenido;

  |SI #983#2 = 99; #983Campo = 100; |PINTA #983Campo; |FINSI;

  |SI nNume1 ! #983Campo;
      nSwCambio = 1;
  |FINSI;

  #983#5 = #983#9;
|FPRC;

|PROCESO tipo83;
|FPRC;
|PROCESO sector83;
|FPRC;
|PROCESO Tipo11w83;
|FPRC;
|PROCESO Tipo7w83;
|FPRC;
|PROCESO Tipo0w83;
|FPRC;

|PROCESO PideProrrata;
        nSwCambio = 0;
        |C_V #982#21,1,"S"; |C_M #982#21,1,"S";
        |C_V #982#18,1,"S"; |C_M #982#18,1,"S";

        #982#21 = #982#3;
        |PUSHV  1137 1549;
        |PINTA 1138, "           ";
        |PINTA 1438, "           ";
        |ATRI P; |PINTA 1238, " Tipo      "; |ATRI 0; |PINTA #982#21;
        |ATRI P; |PINTA 1338, "    %      "; |ATRI 0; |PINTA #982#18;
        |CUADRO 1137 1549;
        |SI #982#17 = 1;
            #982#21 = "G";
        |SINO;
            |ENCAMPO #21#982;
        |FINSI;
        |ENCAMPO #18#982;
        aTipoPr = #982#21;
        |SI #982#3 ! #982#21; nSwCambio = 2; |FINSI;
        #982#3  = #982#21;
        |HAZ CalNueProrr;
        |SI #982#21 = "E";
            |POPV;
            |PUSHV 0501 2380;
            nSwSal = 0;
            |C_M #983#9,1,"S";
            |PINPA #0#983;
            |PINTA 0718, #982#2;  |PINTA 0767, #982#15;
            |PINTA 2217, #982#5;  |PINTA 2229, #982#6;
            |PINTA 2241, #982#22;
            |PINTA 2273, #982#3;  |PINTA 2275, #982#19;
            |SI enEjer > 2010;
                |C_V #983#31, 1, "N";
                |C_V #983#32, 1, "N";
                |C_V #983#8,  1, "S";
                |C_V #983#34, 1, "S";
                |ATRI R; |PINTA 1507, "Sec.";
                         |PINTA 1441, "  Total   ";
                |ATRI 0; |PINTA 1451, "³";
                |ATRI R; |PINTA 1452, "% Sobre el";
                         |PINTA 1552, "Vol. total";
                         |PINTA 1541," Ingresos ";  |ATRI 0;
            |FINSI;
            |ATRI P; |PINTA 1061, "Importes  Ingresos";
            |PINTA 1161, "Ejercicio Anterior"; |ATRI 0;
            |ENTLINEAL #1#983, -3, 2, 20, 0, ClaveBajaL83, ClaveAltaL83;
            |C_M #983#9,1,"N";
        |FINSI;
        #982#3 = #982#21;
        |SI #982#3 = "G"; #982#23 = " GENERAL"; |FINSI;
        |SI #982#3 = "E"; #982#23 = " ESPECIAL"; |FINSI;
        |POPV;

        |C_V #982#21,1,"N"; |C_M #982#21,1,"N";
        |C_V #982#18,1,"N"; |C_M #982#18,1,"N";

        |SI nSwCambio ! 0;
            |HAZ ModificoNueProrr;
        |FINSI;
|FPRC;

|PROCESO Boton2w082;
     |PTEC 824;
|FPRC;

|PROCESO Boton3w082;
     |PTEC 825;
|FPRC;

|PROCESO Boton4w082;
     |PTEC 826;
|FPRC;

|PROCESO Boton5w082;
     |PTEC 827;
|FPRC;

|PROCESO Boton6w082;
     |PTEC 828;
|FPRC;
