|FICHEROS;
   dsmow315;

   dsm210dp;
   dsm210db;
|FIN;

|VARIABLES;
   &enSwTit = 0;

   nCont = 0;
   nCalc = 0;
   nModo = 0;

   aAlfa  = "";
   aAlfa1 = "";
   aAntIng = "";
   aAntDev = "";
   aAntTEnt = "";

   nSwGraba = 0;
|FIN;

|PROCESO CMCtaEsp;
   |PARA nCont = 7; |SI nCont [ 12; |HACIENDO nCont = nCont + 1;
      |C_M #dsmow315#nCont#, 1, aAlfa;
      |SI aAlfa = "N";
         #dsmow315#nCont# = "";
      |SINO;
         |SI enSwTit = 1; nCalc = nCont - 6; |SINO; nCalc = nCont + 19; |FINSI;
         #dsmow315#nCont# = #dsm210db#nCalc#; |PINTA #dsmow315#nCont#;
      |FINSI;
      |PINTA #dsmow315#nCont#;
   |SIGUE;
|FPRC;

|PROCESO CMCtaExt;
||   |PARA nCont = 13; |SI nCont [ 30; |HACIENDO nCont = nCont + 1;

      |C_M #dsmow315#13, 1, aAlfa;
      |SI aAlfa = "N";
         #dsmow315#13 = "";
      |SINO;
         |SI enSwTit = 1;
             #dsmow315#13 = #dsm210dp#2;
         |SINO;
             #dsmow315#13 = #dsm210dp#65;
         |FINSI;
      |FINSI;
      |PINTA #dsmow315#13;
      |C_M #dsmow315#14, 1, aAlfa;
      |SI aAlfa = "N";
         #dsmow315#14 = "";
      |SINO;
         |SI enSwTit = 1;
             #dsmow315#14 = #dsm210dp#1;
         |SINO;
             #dsmow315#14 = #dsm210dp#64;
         |FINSI;
      |FINSI;
      |PINTA #dsmow315#14;

   |PARA nCont = 15; |SI nCont [ 30; |HACIENDO nCont = nCont + 1;
      |C_M #dsmow315#nCont#, 1, aAlfa;
      |SI aAlfa = "N";
         #dsmow315#nCont# = "";
      |SINO;
         |SI enSwTit = 1; nCalc = nCont - 6; |SINO; nCalc = nCont + 19; |FINSI;
         #dsmow315#nCont# = #dsm210db#nCalc#; |PINTA #dsmow315#nCont#;
      |FINSI;
      |PINTA #dsmow315#nCont#;
   |SIGUE;
|FPRC;

|PROCESO CMDevol;
   |PARA nCont = 4; |SI nCont [ 6; |HACIENDO nCont = nCont + 1;
      |SI nCont = 4;
         |C_M #dsmow315#nCont#, 1, aAlfa;
      |SINO;
         |C_M #dsmow315#nCont#, 1, "N";
      |FINSI;
      |SI aAlfa = "N";
         |SI nCont = 4; #dsmow315#nCont# = "N"; |FINSI;
         |SI nCont = 5; #dsmow315#nCont# = ""; |FINSI;
         |SI nCont = 6; #dsmow315#nCont# = ""; |FINSI;
      |SINO;
         |SI nCont = 4; #dsmow315#nCont# = "N"; |FINSI;
         |SI enSwTit = 1;
            |SI nCont = 5; #dsmow315#nCont# = #dsm210dp#2; |FINSI;
            |SI nCont = 6; #dsmow315#nCont# = #dsm210dp#1; |FINSI;
         |SINO;
            |SI nCont = 5; #dsmow315#nCont# = #dsm210dp#65; |FINSI;
            |SI nCont = 6; #dsmow315#nCont# = #dsm210dp#64; |FINSI;
         |FINSI;
      |FINSI;
      |PINTA #dsmow315#4; |PINTA #dsmow315#5; |PINTA #dsmow315#6;
   |SIGUE;
|FPRC;

|PROCESO CMIngre;
   |C_M #dsmow315#2, 1, aAlfa;
   |SI aAlfa = "N"; #dsmow315#2 = "E"; |FINSI;
   |PINTA #dsmow315#4;
|FPRC;

|PROCESO CMTipoCta;
   |C_M #dsmow315#1, 1, aAlfa;
   #dsmow315#1  = aAlfa; |PINTA #dsmow315#1;
   |C_M #dsmow315#33, 1, aAlfa;
   #dsmow315#33 = aAlfa; |PINTA #dsmow315#33;
|FPRC;

|PROCESO AntesDeNada;
   |ABRE #dsm210db;
   #dsm210db#0 = #dsm210dp#0;
   |LEE 000#dsm210db.=;
   |SI FSalida ! 0; |DDEFECTO #dsm210db; |FINSI;
   |CIERRA #dsm210db;

   |SI #dsmow315#0 < 0;
      || Activo parte devolucion
      aAlfa = "S"; |HAZ CMDevol;
      || Desactivo parte ingreso
      aAlfa = "N"; |HAZ CMIngre;
      aAntDev = ""; |HAZ MiraDevIng;
   |SINO;
      || Desactivo parte devolucion
      aAlfa = "N"; |HAZ CMDevol;
      || Activo parte ingreso
      aAlfa = "S"; |HAZ CMIngre;
      aAntIng = ""; |HAZ MiraDevIng;
   |FINSI;
|FPRC;

|PROCESO AntesIngreso; |TIPO 7;
   aAntIng = #dsmow315#2;
|FPRC;

|PROCESO AntesDevol; |TIPO 7;
   aAntDev = #dsmow315#4;
|FPRC;

|PROCESO MiraDevIng;
   |SI #dsmow315#0 ] 0;
      |SI #dsmow315#2 = aAntIng; |ACABA; |FINSI;

      |SI #dsmow315#2 = "E";
         ||Desactivo la cuenta espa¤ola
         aAlfa = "N"; |HAZ CMCtaEsp;
         ||Desactivo la cuenta extranjera
         aAlfa = "N"; |HAZ CMCtaExt;
         ||Desactivo el tipo de cuenta
         aAlfa = "N"; |HAZ CMTipoCta;
      |SINO;
         ||Activo el tipo de cuenta
         |C_M #dsmow315#1, 1, "S"; |C_M #dsmow315#33, 1, "S";
         #dsmow315#1  = "S"; |PINTA #dsmow315#1;
         #dsmow315#33 = "N"; |PINTA #dsmow315#33;
         aAntTEnt = ""; |HAZ MiraTipoCta;
      |FINSI;
   |SINO;
      |SI #dsmow315#4 = aAntDev; |ACABA; |FINSI;

      |SI #dsmow315#4 = "S";
         ||Desactivo la cuenta espa¤ola
         aAlfa = "N"; |HAZ CMCtaEsp;
         ||Desactivo la cuenta extranjera
         aAlfa = "N"; |HAZ CMCtaExt;
         ||Desactivo el tipo de cuenta
         aAlfa = "N"; |HAZ CMTipoCta;
         ||Desactivo los datos de la cuenta (Nif y titular)
         |C_M #dsmow315#5, 1, "N"; #dsmow315#5 = ""; |PINTA #dsmow315#5;
         |C_M #dsmow315#6, 1, "N"; #dsmow315#6 = ""; |PINTA #dsmow315#6;
      |SINO;
         ||Activo el tipo de cuenta
         |C_M #dsmow315#1, 1, "S"; |C_M #dsmow315#33, 1, "S";
         #dsmow315#1  = "S"; |PINTA #dsmow315#1;
         #dsmow315#33 = "N"; |PINTA #dsmow315#33;
         aAntTEnt = ""; |HAZ MiraTipoCta;
         ||Activo los datos de la cuenta (Nif y titular)
         |C_M #dsmow315#5, 1, "S"; |PINTA #dsmow315#5;
         |C_M #dsmow315#6, 1, "S"; |PINTA #dsmow315#6;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO AntesTipoEnt; |TIPO 7;
   |SI #dsmow315#1 = "S";
      aAntTEnt = "E";
   |SINO;
      aAntTEnt = "X";
   |FINSI;
|FPRC;

|PROCESO MiraTipoCta;
   |C_M #dsmow315#1, 0, aAlfa; |C_M #dsmow315#33, 0, aAlfa1;
   |SI aAlfa = "N"; |Y aAlfa1 = "N"; |ACABA; |FINSI;

   |SI aAntTEnt = "E"; |Y #dsmow315#1  = "S"; |Y #dsmow315#33 = "N"; |ACABA; |FINSI;
   |SI aAntTEnt = "X"; |Y #dsmow315#33 = "S"; |Y #dsmow315#1  = "N"; |ACABA; |FINSI;

   |SI Campo = 1;
      |SI #dsmow315#1 = "S";
         || Desactivo cuenta extranjera
         aAlfa = "N"; |HAZ CMCtaExt;
         || Activo cuenta espa¤ola
         aAlfa = "S"; |HAZ CMCtaEsp;
         #dsmow315#33 = "N"; |PINTA #dsmow315#33;
      |SINO;
         || Activo cuenta extranjera
         aAlfa = "S"; |HAZ CMCtaExt;
         || Desactivo cuenta espa¤ola
         aAlfa = "N"; |HAZ CMCtaEsp;
         #dsmow315#33 = "S"; |PINTA #dsmow315#33;
      |FINSI;
   |SINO;
      |SI #dsmow315#33 = "S";
         || Activo cuenta extranjera
         aAlfa = "S"; |HAZ CMCtaExt;
         || Desactivo cuenta espa¤ola
         aAlfa = "N"; |HAZ CMCtaEsp;
         #dsmow315#1 = "N"; |PINTA #dsmow315#1;
      |SINO;
         || Desactivo cuenta extranjera
         aAlfa = "N"; |HAZ CMCtaExt;
         || Activo cuenta espa¤ola
         aAlfa = "S"; |HAZ CMCtaEsp;
         #dsmow315#1 = "S"; |PINTA #dsmow315#1;
      |FINSI;
   |FINSI;
|FPRC;
