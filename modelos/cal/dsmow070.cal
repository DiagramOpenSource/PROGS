|FICHEROS;
     dsmoc349 #349;
     dsmod349 #350;

     dsmow070 #970,MANTE;
     dsmow170 #170,MANTE;
|FIN;

|VARIABLES;
     nContenido     = 0;
     nCampo1        = 0;
     nCampo2        = 0;
     nCampo3        = 0;
     nCampo11       = 0;
     nCampo22       = 0;
     nCampo33       = 0;
     nSwAcum        = 0;
     nAntIVA        = 0;
     nPon           = 0;
     &EURODB        = 2;
     aD             = "";
     aH             = "";
     nDPeriodo      = 0;
     nHPeriodo      = 0;
     nIVA           = 0;
     nCalIVA        = 0;
     nCuotasAnterior = 0;
     nNume1         = 0;

     aTipo          = "";
     aDTipo         = "";
     aHTipo         = "";

    &nDPer349       = 0;
    &nHPer349       = 0;
     nPara1         = 0;
     nPara2         = 0;
     nSwEsta        = 0;
     nBaseImpo      = 0;
     nPorce         = 0;
     nCuota         = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Totales;
     |SI nCalIVA = 1;
         |PARA nCampo3 = 2;  |SI nCampo3 [ 8;  |HACIENDO nCampo3 = nCampo3 + 3;
               nCampo1     = nCampo3 - 2;
               nCampo2     = nCampo3 - 1;
               #970nCampo2 = (#970nCampo3 / #970nCampo1) * 100;
         |SIGUE;
     |FINSI;

     #970#21 = #970#2  + #970#5 + #970#8 + #970#11 + #970#14 + #970#17 + #970#20;
     #970#23 = #970#21 - #970#22;

     |PINTA #970#21;
     |PINTA #970#23;
|FPRC;

|PROCESO PonRecargo_Total970;
     nSwEsta = 0;
     |PARA nCampo2 = 10;  |SI nCampo2 [ 19;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #970nCampo2 = nPorce;
               #970nCampo1 = #970nCampo1 + nBaseImpo;
               #970nCampo2 = nPorce;
               #970nCampo3 = #970nCampo3 + nCuota;
               nSwEsta = 1;
                |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwEsta = 0;
         |PARA nCampo2 = 10;  |SI nCampo2 [ 19;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #970nCampo2 = 0; |Y #970nCampo1 = 0;  |Y #970nCampo3 = 0;
                   #970nCampo1 = #970nCampo1 + nBaseImpo;
                   #970nCampo2 = nPorce;
                   #970nCampo3 = #970nCampo3 + nCuota;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;
         #970#18 = #970#18 + nBaseImpo;
         #970#19 = 0;
         #970#20 = #970#20 + nCuota;
     |FINSI;
|FPRC;

|PROCESO PonIVA_Total970;
     nSwEsta = 0;
     |PARA nCampo2 = 1;  |SI nCampo2 [ 7;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #970nCampo2 = nPorce;
               #970nCampo1 = #970nCampo1 + nBaseImpo;
               #970nCampo2 = nPorce;
               #970nCampo3 = #970nCampo3 + nCuota;
               nSwEsta = 1;
                |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwEsta = 0;
         |PARA nCampo2 = 1;  |SI nCampo2 [ 7;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #970nCampo2 = 0; |Y #970nCampo1 = 0;  |Y #970nCampo3 = 0;
                   #970nCampo1 = #970nCampo1 + nBaseImpo;
                   #970nCampo2 = nPorce;
                   #970nCampo3 = #970nCampo3 + nCuota;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;
         #970#6 = #970#0 + nBaseImpo;
         #970#7 = 0;
         #970#8 = #970#8 + nCuota;
     |FINSI;
|FPRC;

|PROCESO PantaTotal;

     |PARA nCampo1 = 25; |SI nCampo1 [ 45; |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 - 25;
           #970nCampo2 = #970nCampo1;
     |SIGUE;

     |PARA nCampo22 = 47; |SI nCampo22 [ 53; |HACIENDO nCampo22 = nCampo22 + 3;
           nCampo11 = nCampo22 - 1;
           nCampo33 = nCampo22 + 1;
           nBaseImpo = #970nCampo11;
           nPorce    = #970nCampo22;
           nCuota    = #970nCampo33;
           |SI nBaseImpo ! 0; |O nCuota ! 0;
               |HAZ PonIVA_Total970;
           |FINSI;
     |SIGUE;

     |PARA nCampo22 = 68; |SI nCampo22 [ 74; |HACIENDO nCampo22 = nCampo22 + 3;
           nCampo11 = nCampo22 - 1;
           nCampo33 = nCampo22 + 1;
           nBaseImpo = #970nCampo11;
           nPorce    = #970nCampo22;
           nCuota    = #970nCampo33;
           |SI nBaseImpo ! 0; |O nCuota ! 0;
               |HAZ PonIVA_Total970;
           |FINSI;
     |SIGUE;

     |PARA nCampo22 = 56; |SI nCampo22 [ 65; |HACIENDO nCampo22 = nCampo22 + 3;
           nCampo11 = nCampo22 - 1;
           nCampo33 = nCampo22 + 1;
           nBaseImpo = #970nCampo11;
           nPorce    = #970nCampo22;
           nCuota    = #970nCampo33;
           |SI nBaseImpo ! 0; |O nCuota ! 0;
               |HAZ PonRecargo_Total970;
           |FINSI;
     |SIGUE;

     |PARA nCampo22 = 77; |SI nCampo22 [ 86; |HACIENDO nCampo22 = nCampo22 + 3;
           nCampo11 = nCampo22 - 1;
           nCampo33 = nCampo22 + 1;
           nBaseImpo = #970nCampo11;
           nPorce    = #970nCampo22;
           nCuota    = #970nCampo33;
           |SI nBaseImpo ! 0; |O nCuota ! 0;
               |HAZ PonRecargo_Total970;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Que349;
     |SI FSalida = 0;

         |PARA nPara1 = 0; |SI nPara1 [ 20; |HACIENDO nPara1 = nPara1 + 1;
               nPara2 = nPara1 + 25;
               #170nPara1 = #970nPara2;
         |SIGUE;
         |PARA nPara1 = 22; |SI nPara1 [ 63; |HACIENDO nPara1 = nPara1 + 1;
               nPara2 = nPara1 + 24;
               #170nPara1 = #970nPara2;
         |SIGUE;
         #170#21 = #970#21;

         |PUSHV 0501 2380;
         |PINPA #0#170;
         |PINDA #0#170;

         |ENDATOS #1#170;

         |PARA nPara1 = 0; |SI nPara1 [ 20; |HACIENDO nPara1 = nPara1 + 1;
               nPara2 = nPara1 + 25;
               #970nPara2 = #170nPara1;
         |SIGUE;
         |PARA nPara1 = 22; |SI nPara1 [ 63; |HACIENDO nPara1 = nPara1 + 1;
               nPara2 = nPara1 + 24;
               #970nPara2 = #170nPara1;
         |SIGUE;
         #970#21 = #170#21;

         |POPV;

         |HAZ PantaTotal;
         |HAZ Totales;

         |PINDA #0#970;

         |PAUSA;
     |FINSI;
|FPRC;

|| //////////////////////////////////////////////////////////////////
|PROCESO Totalesw170;

     #170#21 = #170#2  + #170#5  + #170#8  + #170#11 + #170#14 + #170#17 + #170#20;
     #170#21 = #170#21 + #170#24 + #170#27 + #170#30 + #170#33 + #170#36 + #170#39 + #170#42;
     #170#21 = #170#21 + #170#45 + #170#48 + #170#51 + #170#54 + #170#57 + #170#60 + #170#63;

     |PINTA #170#21;
|FPRC;

|PROCESO TotalIva;
     nContenido = Contenido;
     |SI nContenido = #170Campo;  |ACABA;  |FINSI;

     nNume1 = (Campo / 3) ! 0; nNume1 = Campo - (nNume1 * 3);
     |SI Campo < 20;
         |SI nNume1 = 0;
             nCampo1 = Campo; nCampo2 = Campo + 1; nCampo3 = Campo + 2;
         |SINO;
             nCampo1 = Campo - 1; nCampo2 = Campo; nCampo3 = Campo + 1;
         |FINSI;
     |SINO;
         |SI nNume1 = 1;
             nCampo1 = Campo; nCampo2 = Campo + 1; nCampo3 = Campo + 2;
         |SINO;
             nCampo1 = Campo - 1; nCampo2 = Campo; nCampo3 = Campo + 1;
         |FINSI;
      |FINSI;

      #170nCampo3 = #170nCampo1 % #170nCampo2;
      |PINTA #170nCampo3;
|FPRC;

|| //////////////////////////////////////////////////////////////////

|PROCESO PonIvas;
     nIVA     = #349nCampo22;

|| ...   |SI nIVA = 16; |O nIVA = 18;  nIVA = 21;  nCalIVA = 1; |FINSI;
|| ...   |SI nIVA = 7;  |O nIVA = 8;   nIVA = 10;  nCalIVA = 1; |FINSI;

     |SI aTipo = "A";
         nSwAcum = 0;
         |PARA nCampo2 = 1;   |SI nCampo2 [ 7;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #170nCampo2 = nIVA;
                   |SI nCuotasAnterior = 0;
                       #170nCampo1 = #170nCampo1 + #349nCampo11;
                       #170nCampo3 = #170nCampo3 + #349nCampo33;
                   |SINO;
                       |SI #349#24 = "-";
                           #170nCampo1 = #170nCampo1 - #349nCampo11;
                           #170nCampo3 = #170nCampo3 - #349nCampo33;
                       |SINO;
                           #170nCampo1 = #170nCampo1 + #349nCampo11;
                           #170nCampo3 = #170nCampo3 + #349nCampo33;
                       |FINSI;
                   |FINSI;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;

         |SI nSwAcum = 1;  |ACABA;  |FINSI;

         |PARA nCampo2 = 1;  |SI nCampo2 [ 7;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #170nCampo2 = 0;
                   |SI nCuotasAnterior = 0;
                       #170nCampo1 = #170nCampo1 + #349nCampo11;
                       #170nCampo2 = nIVA;
                       #170nCampo3 = #170nCampo3 + #349nCampo33;
                   |SINO;
                       |SI #349#24 = "-";
                           #170nCampo1 = #170nCampo1 - #349nCampo11;
                           #170nCampo3 = #170nCampo3 - #349nCampo33;
                       |SINO;
                           #170nCampo1 = #170nCampo1 + #349nCampo11;
                           #170nCampo3 = #170nCampo3 + #349nCampo33;
                       |FINSI;
                   |FINSI;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;

         |SI nSwAcum = 1;  |ACABA;  |FINSI;
     |FINSI;

     |SI aTipo = "I";
         nSwAcum = 0;
         |PARA nCampo2 = 23;   |SI nCampo2 [ 29;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #170nCampo2 = nIVA;
                   |SI nCuotasAnterior = 0;
                       #170nCampo1 = #170nCampo1 + #349nCampo11;
                       #170nCampo3 = #170nCampo3 + #349nCampo33;
                   |SINO;
                       |SI #349#24 = "-";
                           #170nCampo1 = #170nCampo1 - #349nCampo11;
                           #170nCampo3 = #170nCampo3 - #349nCampo33;
                       |SINO;
                           #170nCampo1 = #170nCampo1 + #349nCampo11;
                           #170nCampo3 = #170nCampo3 + #349nCampo33;
                       |FINSI;
                   |FINSI;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;

         |SI nSwAcum = 1;  |ACABA;  |FINSI;

         |PARA nCampo2 = 23;  |SI nCampo2 [ 29;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #170nCampo2 = 0;
                   |SI nCuotasAnterior = 0;
                       #170nCampo1 = #170nCampo1 + #349nCampo11;
                       #170nCampo2 = nIVA;
                       #170nCampo3 = #170nCampo3 + #349nCampo33;
                   |SINO;
                       |SI #349#24 = "-";
                           #170nCampo1 = #170nCampo1 - #349nCampo11;
                           #170nCampo3 = #170nCampo3 - #349nCampo33;
                       |SINO;
                           #170nCampo1 = #170nCampo1 + #349nCampo11;
                           #170nCampo3 = #170nCampo3 + #349nCampo33;
                       |FINSI;
                   |FINSI;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;

         |SI nSwAcum = 1;  |ACABA;  |FINSI;
   |FINSI;
|FPRC;

|PROCESO Calcu349;
     |SI #349#6 = "A ";  |O #349#6 = "AR"; |O #349#6 = "I "; |O #349#6 = "IR";
         nCuotasAnterior = 0;

         |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo11 ! 0;  |O #349nCampo33 ! 0; |O #349nCampo22 ! 0;
                   |HAZ PonIvas;
               |FINSI;
         |SIGUE;

         |PARA nCampo22 = 29;  |SI nCampo22 [ 35;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo11 ! 0;  |O #349nCampo33 ! 0; |O #349nCampo22 ! 0;
                   |HAZ PonIvas;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI #349#6 = "AR"; |O #349#6 = "IR";
         nCuotasAnterior = 1;
         nPon            = 0;
         |PARA nCampo22 = 38;  |SI nCampo22 [ 56;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo11 ! 0;  |O #349nCampo33 ! 0; |O #349nCampo22 ! 0;
                   |HAZ PonIvas;
                   nPon = 1;
               |FINSI;
         |SIGUE;

         |SI nPon = 0;  |Y #349#27 ! 0;
             nCampo22 = 11;
             nCampo11 = nCampo22 - 1;
             nCampo33 = nCampo22 + 1;
             |HAZ PonIvas;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc349A;
     #349#1;
     ;
     enEmpresa, enEjer, nDPer349, 349, enDComple, enActividad, aDTipo, 0000, 00, aD;
     enEmpresa, enEjer, nHPer349, 349, enHComple, enActividad, aHTipo, 9999, 99, aH;
     ;
     NULL, Calcu349;
|FIN;

|PROCESO dsmod349;
     |SI #350#4 ! 0;
         |SI #350#12 = "C";
             enHComple = #350#4;
         |SINO;
             enDComple = #350#4;
             enHComple = #350#4;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmod349;
    #350#1;
    ;
    enEmpresa, enEjer, nDPer349, 349, 00, 00;
    enEmpresa, enEjer, nHPer349, 349, 99, 99;
    ;
    NULL, dsmod349;
|FIN;

|PROCESO Que349w170;

     |SI FSalida = 2; |ACABA; |FINSI;

     enDComple = 0;
     enHComple = 0;
     |BUCLE dsmod349;

     |SI Campo = 0;
         aTipo = "A";
         #170#0 = 0; #170#1 = 0; #170#2 = 0;
         #170#3 = 0; #170#4 = 0; #170#5 = 0;
         #170#6 = 0; #170#7 = 0; #170#8 = 0;
     |SINO;
         #170#22 = 0; #170#23 = 0; #170#24 = 0;
         #170#25 = 0; #170#26 = 0; #170#27 = 0;
         #170#28 = 0; #170#29 = 0; #170#30 = 0;
         aTipo = "I";
     |FINSI;

     eaTipo349     = aTipo;
     eaComunidad   = "N";
     eaComunero    = "N";
     enTipoEntrada = 1;
     enModelo349   = 309;
     |SUB_EJECUTA_NP "dsmoc349";
     eaTipo349     = "";

     aD = "            ";
     aH = "zzzzzzzzzzzz";
     |SI enPeriodo = 99;
         nDPeriodo = 01;
         nHPeriodo = 12;
     |SINO;
         |SI enPeriodo = 3;    nDPeriodo = 1;   nHPeriodo = 3;   |FINSI;
         |SI enPeriodo = 6;    nDPeriodo = 4;   nHPeriodo = 6;   |FINSI;
         |SI enPeriodo = 9;    nDPeriodo = 7;   nHPeriodo = 9;   |FINSI;
         |SI enPeriodo = 12;   nDPeriodo = 10;  nHPeriodo = 12;  |FINSI;
     |FINSI;

     aDTipo = aTipo + " ";
     aHTipo = aTipo + "z";

     nCalIVA = 0;
     |BUCLE dsmoc349A;

     |HAZ Totalesw170;
     |PINDA #0#170;
|FPRC;

|PROCESO Tipo12w70;  |TIPO 12;
|FPRC;
