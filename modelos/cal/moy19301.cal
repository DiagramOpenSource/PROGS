|FICHEROS;
     dsmoy000;
     dsmom004;

     dsm193ca #193;
     dsm193li;
     dsm193ga;

     dsmow014;

     dsmow603;
     dsmow604;
     dsmow605;

     :/basica/def/agim0024;
     :/basica/def/agim0026;

     &clientes@;
|FIN;

|VARIABLES;
     aNombre     = "";
     aPathAfegir = "";
     aIPRemoto   = "";
     aBue        = "";

     nSuma       = 0;
|FIN;

|INCLUYE i_varemi;

|PROCESO Registro193_1_2016;
     enCodCli = #dsm193ca#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow603;

     #dsmow603#0  = "1";

     #dsmow603#1  = "193";

     #dsmow603#2  = #dsm193ca#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #dsmow603#3   = eaVarDni;

         eaAlfa   = #clientes@#1;  |HAZ QuitaRaros;
         #dsmow603#4   = eaAlfa;

         eaAlfa   = #clientes@#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #clientes@#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #dsmow603#6   = eaAlfa;

         eaAlfa   = #clientes@#53;  |HAZ QuitaRaros;
         #dsmow603#7   = eaAlfa;

         eaDeleg     = #clientes@#17;
         eaAdmin     = #clientes@#18;
         eaProvincia = #clientes@#38;
     |SINO;
         aAlfa = #clientes@#96; |QBF aAlfa; |SI aAlfa = ""; #clientes@#96 = #clientes@#2; |FINSI;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #dsmow603#3   = eaVarDni;

         eaAlfa   = #clientes@#1;   |HAZ QuitaRaros;
         #dsmow603#4   = eaAlfa;

         eaAlfa   = #clientes@#14;  |HAZ QuitaRarosTfno;
         #dsmow603#6   = eaAlfa;

         eaAlfa   = #clientes@#96;  |HAZ QuitaRaros;
         #dsmow603#7   = eaAlfa;

         eaDeleg     = #clientes@#91;
         eaAdmin     = #clientes@#92;
         eaProvincia = #clientes@#12;
     |FINSI;

     #dsmow603#5  = "T";

     #dsmow603#8 = "1930000000000";

     |SI enDirecta = 1;
         |HAZ CalcJustificante;
         #dsmow603#8 = eaJusti;
     |FINSI;

     nNume   = #dsm193ca#6;
     #dsmow603#12 = ("000000000" + nNume) % -109;

     enNume  = #dsm193ca#7;  |HAZ Conver15Signo;
     #dsmow603#13 = eaAlfa;

     enNume  = #dsm193ca#8;  |HAZ Conver15Signo;
     #dsmow603#14 = eaAlfa;

     enNume  = #dsm193ca#9;  |HAZ Conver15Signo;
     #dsmow603#15 = eaAlfa;

     enNume  = #dsm193ca#12; |HAZ Conver15Signo;
     #dsmow603#18 = eaAlfa;

     |SI #dsm193ca#15 = "S";  #dsmow603#19 = "S";  |FINSI;

     |SI #dsm193ca#14 = "C";  #dsmow603#9  = "C";  |FINSI;

     |SI #dsm193ca#14 = "S";
         #dsmow603#10 = "S";
         #dsmow603#11 = #dsm193ca#13;
     |FINSI;

     |SI #dsm193ca#14 = "C";
         #dsmow603#11 = #dsm193ca#13;
     |FINSI;

     #dsmow603#22 = &13 + &10;

     nHCampo = 22;
     |SI eaOpcion ! "3";
         nHCampo = 21;
     |FINSI;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #dsmow603#nCampo#;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO dsm193ca_2016;
     |HAZ Registro193_1_2016;
|FPRC;

|PROCESO Registro193_2_2016;
     enCodCli = #dsm193ca#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow604;

     #dsmow604#0  = "2";

     #dsmow604#1  = "193";

     #dsmow604#2  = #dsm193ca#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #dsmow604#3   = eaVarDni;
     |SINO;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #dsmow604#3   = eaVarDni;
     |FINSI;

     eaVarDni = #dsm193li#6;  |HAZ CalculameDNI;
     |SI #dsm193li#11 = "N";
         #dsmow604#4 = eaVarDni;
     |SINO;
         #dsmow604#5 = eaVarDni;
     |FINSI;

     |SI #dsm193li#6  = "999999999999";
         #dsmow604#4  = "999999999";
         #dsmow604#5  = "999999999";
         #dsmow604#16 = "X";
     |FINSI;

     eaAlfa = #dsm193li#12;  |HAZ QuitaRaros;
     #dsmow604#6 = eaAlfa;

     |SI #dsm193li#13 = "S";  #dsmow604#7 = "X";  |FINSI;

     #dsmow604#8  = ("00" + #dsm193li#14) % -102;
     #dsmow604#9  = #dsm193li#15;
     #dsmow604#10 = #dsm193li#16;
     #dsmow604#11 = #dsm193li#8;
     #dsmow604#12 = #dsm193li#9;
     #dsmow604#13 = #dsm193li#17;
     #dsmow604#14 = #dsm193li#18;
     #dsmow604#15 = #dsm193li#19;
     #dsmow604#17 = ("0000" + #dsm193li#7) % -104;
     #dsmow604#18 = #dsm193li#10;

     enNume  = #dsm193li#20;  |HAZ Conver13Signo;
     #dsmow604#19 = eaAlfa;

     enNume  = #dsm193li#22;  |HAZ Conver13Signo;
     #dsmow604#21 = eaAlfa;

     enNume  = #dsm193li#23;  |HAZ Conver13Signo;
     #dsmow604#22 = eaAlfa;

     nNume   = #dsm193li#24 * 100;
     #dsmow604#23 = ("0000" + nNume) % -104;

     enNume  = #dsm193li#25;  |HAZ Conver13Signo;
     #dsmow604#24 = eaAlfa;

     enNume  = #dsm193li#33;  |HAZ Conver11;
     #dsmow604#25 = eaAlfa;

     |SI #dsm193ca#15 = "S";  #dsmow604#27 = "S";  |FINSI;

     |SI #dsm193li#18 ! "P";
         #dsmow604#28 = "00000000";
         #dsmow604#29 = "00000000";
         #dsmow604#30 = "000000000000";
         #dsmow604#31 = "000000000000";
     |SINO;
         #dsmow604#28 = (#dsm193li#29 % -104) + (#dsm193li#29 % 0402) + (#dsm193li#29 % 102);
         #dsmow604#29 = (#dsm193li#30 % -104) + (#dsm193li#30 % 0402) + (#dsm193li#30 % 102);

         enNume  = #dsm193li#31;  |HAZ Conver12Signo;  #dsmow604#30 = eaAlfa;
         enNume  = #dsm193li#32;  |HAZ Conver12Signo;  #dsmow604#31 = eaAlfa;
     |FINSI;

     #dsmow604#34 = &13 + &10;

     nHCampo = 34;
     |SI eaOpcion ! "3";
         nHCampo = 33;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #dsmow604#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|PROCESO dsm193li_2016;
     |HAZ Registro193_2_2016;
|FPRC;

|DEFBUCLE dsm193li_2016;
     #dsm193li#1;
     ;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,"            ",0000," ","  ",1;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,"zzzzzzzzzzzz",9999,"z","zz",2;
     ;
     NULL, dsm193li_2016;
|FIN;

|PROCESO Registro193_3_2016;
     enCodCli = #dsm193ca#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow605;

     #dsmow605#0  = "2";

     #dsmow605#1  = "193";

     #dsmow605#2  = #dsm193ca#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #dsmow605#3   = eaVarDni;
     |SINO;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #dsmow605#3   = eaVarDni;
     |FINSI;

     eaVarDni = #dsm193ga#6;  |HAZ CalculameDNI;
     |SI #dsm193ga#7 = "N";
         #dsmow605#4 = eaVarDni;
     |SINO;
         #dsmow605#5 = eaVarDni;
     |FINSI;

     eaAlfa = #dsm193ga#8;   |HAZ QuitaRaros;
     #dsmow605#6 = eaAlfa;

     enNume  = #dsm193ga#9;  |HAZ Conver13Signo;
     #dsmow605#8  = eaAlfa;

     #dsmow605#11 = &13 + &10;

     nHCampo = 11;
     |SI eaOpcion ! "3";
         nHCampo = 10;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #dsmow605#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|PROCESO dsm193ga_2016;
     |HAZ Registro193_3_2016;
|FPRC;

|DEFBUCLE dsm193ga_2016;
     #dsm193ga#1;
     ;
     #dsm193ca#0,#dsm193ca#1,#dsm193ca#2,#dsm193ca#3,#dsm193ca#4,#dsm193ca#5,"            ";
     #dsm193ca#0,#dsm193ca#1,#dsm193ca#2,#dsm193ca#3,#dsm193ca#4,#dsm193ca#5,"zzzzzzzzzzzz";
     ;
     NULL, dsm193ga_2016;
|FIN;

|PROCESO Portal193_2016;
     #dsm193ca#0  = #dsmow014#0;
     #dsm193ca#1  = #dsmow014#1;
     #dsm193ca#2  = #dsmow014#2;
     #dsm193ca#3  = #dsmow014#5;
     #dsm193ca#4  = #dsmow014#7;
     #dsm193ca#5  = 0;
     |LEE 040#dsm193ca.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = #dsmow014#5;
     #dsmom004#4  = #dsmow014#7;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     eaFicheroPlano = "193" + (("00000" + #dsmow014#0) % -105) + ".txt";
     eaFicheroImpre = "193" + (("00000" + #dsmow014#0) % -105) + ".imp";
     eaFicheroSalid = "193" + (("00000" + #dsmow014#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #dsmow014#0) % -105) + ".txt";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ dsm193ca_2016;
     |BUCLE dsm193li_2016;
     |BUCLE dsm193ga_2016;

     |XCIERRA nHandle2;

     enEmpresa    = #dsmow014#0;
     enComple     = #dsmow014#7;
     eaNomEmpresa = #dsmow014#3;

     eaX002_10    = #dsmow603#3;
     eaX002_11    = #dsmow603#4;
     eaX002_12    = #dsmoy000#0;
     eaX002_13    = #dsmoy000#6;
     eaX002_14    = 99;

     |SI #dsmow603#9 ! " ";
         eaX002_15 = #dsmow603#9;
     |FINSI;

     |SI #dsmow603#10 ! " ";
         eaX002_15 = #dsmow603#10;
         eaX002_16 = #dsmow603#11;
     |FINSI;

     eaX002_20 = #dsmow603#12;

     nSuma = #dsm193ca#7 + #dsm193ca#10;
     eaX002_21 = nSuma;

     nSuma = #dsm193ca#8 + #dsm193ca#11;
     eaX002_22 = nSuma;

     |HAZ PresentaPortal;
|FPRC;

|DEFBUCLE dsmow014C193_2016;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, Portal193_2016;
|FIN;

|DEFBUCLE dsmow014N193_2016;
     #dsmow014#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, Portal193_2016;
|FIN;

|PROCESO Bloque2016;
     |HAZ BtnAnuales2015;

     |SI eaOpcion = "0";  enInfComp = 1;  |ACABA;  |FINSI;

     |ABRE #dsm193ca;
     |ABRE #dsmom004;
     |SI #dsmoy000#8 = "C";
         |BUCLE dsmow014C193_2016;
     |SINO;
         |BUCLE dsmow014N193_2016;
     |FINSI;
     |CIERRA #dsm193ca;
     |CIERRA #dsmom004;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;

     |SI enDirecta = 1;  |Y enMsv = 1;  |Y enParar = 0;
         |SUB_EJECUTA "|dsmox007";
     |FINSI;
|FPRC;
