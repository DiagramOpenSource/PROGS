|FICHEROS;
     dsmoy019;
     dsmom002;
     dsmom006;
     dsmom026;
     dsmom030;
     dsmom073;
     dsmom107;
     dsmoc110;
     dsmoc111;
     dsm11101;

     :/basica/def/agitab99;
     :/basica/def/agifigen;

     :/contagen/def/canempre;
     :/contagen/def/camaniva;
     :/contagen/def/caivalin;
     :/contagen/def/caivaasi;
     :/contagen/def/cadeflab;

     :/laboral/def/labtraba;
     :/laboral/def/nomhicca;
     :/laboral/def/nomhicli;
     :/laboral/def/labempre;
     :/laboral/def/nomconli;
     :/laboral/def/nomhiatr;
     :/laboral/def/nomconca;
     :/laboral/def/labcentr;
     :/laboral/def/nomcenes;
     :/laboral/def/nomcorli;
     :/laboral/def/nomnotay;
     :/laboral/def/nomauto2;

     dsmow019;
     dsmow154;
|FIN;

|VARIABLES;
     nCampo            = 0;
     nDEmpresa         = 0;
     nHEmpresa         = 0;
     nHandle           = 0;
     nEjer             = 0;
     nCentro           = 0;
     nEmpresa          = 0;
     nDPeriodo         = 0;
     nHPeriodo         = 0;
     nImport1          = 0;
     nImport2          = 0;
     nImport3          = 0;
     nImport4          = 0;
     nTp100            = 0;
     nImporteBaseI     = 0;
     nImporteRetencion = 0;
     nImporteSSocial   = 0;
     nImporteSS        = 0;
     nImporteSSA       = 0;
     ded_not           = 0;
     nImporteSSTrabaja = 0;
     nMesLugar         = 0;
     nMesLuga1         = 0;
     nPeriodo          = 0;
     nDevengo          = 0;
     nAtrasos          = 0;
     nEjerAt           = 0;
     nPerLugar         = 0;
     nHay              = 0;

     aPathLaboral      = "";
     aBase             = "";
     aAlfa             = "";
     aFichero          = "";
     aEjer             = "";
     aEspecie          = "";
     aRepercute        = "";
     aClave            = "";
     aSubClave         = "";
     aDni              = "";
     aNombreTrabajador = "";
     aPeriodicidad     = "";
     nNumTrabajador    = 0;
     nMesNomina        = 0;
     fFecha            = @;
     notaria           = 0;

     nNume1            = 0;
     nNume2            = 0;
     nNume3            = 0;
     nNume4            = 0;
     nPara1            = 0;

     nSwl0  = 0;
     &nSwl1 = 0;
     &nSwl2 = 0;
     &nSwl3 = 0;
     &nSwl4 = 0;
     &nSwl5 = 0;
     &nSwl6 = 0;
     &nSwl7 = 0;
     &nSwl8 = 0;
     &nSwl9 = 0;
     &nSwl10 = 0;
     &nSwl12 = 0;
     &nSwl13 = 0;
     &nSwl14 = 0;
     &nSwl15 = 0;
     &nSwl16 = 0;
     &nMod111 = 0;
     &aNumEmp = "";
     &aNomEmp = "";
     aNroAfiliacion = "";
     cta_co = "";

     nExism002 = 0;
     fFecIni   = @;
     fFecFin   = @;

     aAlfa1    = "";
     aAlfa2    = "";
     aAlfa3    = "";

     nDComplem = 0;
     nHComplem = 0;
     Periodo   = 0;
     nImporteLiquido = 0;
     fFechaCamaniva = @;
     aCadena        = "";
     nLineaIrpf     = 0;
     nSw            = 0;
     aParam         = "";

     aTrab42           = "";
     nSwUno            = 0;
     nSwUnoS           = 0;
     nImporte2         = 0;
     nNumTraba         = 0;
     nNumTrabaH        = 0;
     nMesAuto          = 0;
     nRel              = 0;
     aTra              = "";
     aCampo8F99        = "";

     nSwInf   = 0;
     nSwPie   = 0;
     nError   = 0;
     &eaPeu1  = "";
     &eaPeu2  = "";
     &eaPeu3  = "";
     &enPeu   = 0;
     &eaTexto = "";
     nCampo0  = 0;
     aCampo1  = "";
     nCampo2  = 0;
     nQuantA  = 0;
     nQuantSuma = 0;
     informe    = "";
     nILT = 0;
     nSiM026 = 0;
|FIN;

|INCLUYE i_variar;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\
|PROCESO LaPantalla; |TIPO 7;
     |SI aParam = "conta";
         |ATRI R;
         |PINTA 0504, " Informe de IRPF desde Mantenimiento Registros de Contabilidad ";
         |ATRI 0;
         |C_M #dsmoy019#17, 1, "N"; |C_V #dsmoy019#17, 1, "N";
         |C_M #dsmoy019#18, 1, "N"; |C_V #dsmoy019#18, 1, "N";
         |PINTA 1604, "À"; |PINTA 1636, "Ù";
         |PINTA 1704, "                                 ";
         |PINTA 1804, "                                 ";

         #dsmoy019#24 = "INFORME DE IRPF DESDE EL MAN.REGISTRO DE CONTABILIDAD Y MODELO 110 DECLARADO";
         |PINTA #dsmoy019#24;
     |FINSI;
     fFecha = ~;
     aAlfa  = fFecha % -104;
     #dsmoy019#2   = aAlfa;
     |PINTA #dsmoy019#2;
|FPRC;


|PROCESO Trabajador;
     || Trabajador <00000> Todos los datos de las empresas seleccionadas.

     |C_M #dsmoy019#17, 0, aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

||     |C_M #dsmoy019#18, 1, "S";
||     |SI #dsmoy019#17 = 0;
||         |C_M #dsmoy019#18, 1, "N";  #dsmoy019#18 = 99999;  |PINTA #dsmoy019#18;
||     |FINSI;
|FPRC;

|PROCESO Tipo7C22; |TIPO 7;
     aAlfa1 = "    Ordenacion: (1) por codigo; (2) por nombre; (3) por TC2; (4) por DNI";
     |SI aParam = "conta";
         aAlfa1 = "    Ordenacion: (1) por codigo; (2) por nombre; (3) por DNI";
     |FINSI;
     |MENSA aAlfa1;
|FPRC;

|PROCESO Tipo0C22; |TIPO 0;
     |BLIN 4;
     |SI aParam = "conta";
         |SI #dsmoy019#22 = 4; |ERROR; |FINSI;
     |FINSI;
|FPRC;

|PROCESO Periodo;
     nCampo = Campo + 1;
     #dsmoy019#nCampo# = "          ";
     |SI #dsmoy019#Campo# = 1;   #dsmoy019#nCampo# = "ENERO     ";  |FINSI;
     |SI #dsmoy019#Campo# = 2;   #dsmoy019#nCampo# = "FEBRERO   ";  |FINSI;
     |SI #dsmoy019#Campo# = 3;   #dsmoy019#nCampo# = "MARZO     ";  |FINSI;
     |SI #dsmoy019#Campo# = 4;   #dsmoy019#nCampo# = "ABRIL     ";  |FINSI;
     |SI #dsmoy019#Campo# = 5;   #dsmoy019#nCampo# = "MAYO      ";  |FINSI;
     |SI #dsmoy019#Campo# = 6;   #dsmoy019#nCampo# = "JUNIO     ";  |FINSI;
     |SI #dsmoy019#Campo# = 7;   #dsmoy019#nCampo# = "JULIO     ";  |FINSI;
     |SI #dsmoy019#Campo# = 8;   #dsmoy019#nCampo# = "AGOSTO    ";  |FINSI;
     |SI #dsmoy019#Campo# = 9;   #dsmoy019#nCampo# = "SEPTIEMBRE";  |FINSI;
     |SI #dsmoy019#Campo# = 10;  #dsmoy019#nCampo# = "OCTUBRE   ";  |FINSI;
     |SI #dsmoy019#Campo# = 11;  #dsmoy019#nCampo# = "NOVIEMBRE ";  |FINSI;
     |SI #dsmoy019#Campo# = 12;  #dsmoy019#nCampo# = "DICIEMBRE ";  |FINSI;

     |SI #dsmoy019#nCampo# = "          ";
         |MENAV "     Periodo Incorrecto.";
         |ERROR;
     |FINSI;

     |PINTA #dsmoy019#nCampo#;
|FPRC;


|PROCESO elejer; |TIPO 0;
     #dsmoy019#24 = "INFORME DE IRPF DESDE EL HISTORICO DE CALCULO NOMINAS Y MODELO 110 DECLARADO";
     |SI aParam = "conta";  #dsmoy019#24 = "INFORME DE IRPF DESDE EL MAN.REGISTRO DE CONTABILIDAD Y MODELO 110 DECLARADO"; |FINSI;

     |SI #dsmoy019#2 ] 2011;
         #dsmoy019#24 = "INFORME DE IRPF DESDE EL HISTORICO DE CALCULO NOMINAS Y MODELO 111 DECLARADO";
         |SI aParam = "conta";  #dsmoy019#24 = "INFORME DE IRPF DESDE EL MAN.REGISTRO DE CONTABILIDAD Y MODELO 111 DECLARADO"; |FINSI;
     |FINSI;
     |PINTA #dsmoy019#24;
|FPRC;

|PROCESO Parrilla;
     |SI #dsmoy019#3 = 0;
         #dsmoy019#3 = 0;  |PINTA #dsmoy019#3;
         #dsmoy019#4 = 0;  |PINTA #dsmoy019#4;  |C_M #dsmoy019#4, 1, "N";
         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy019#nCampo#, 1, "S";
         |SIGUE;
     |SINO;
         |C_M #dsmoy019#3, 1, "S";
         |C_M #dsmoy019#4, 1, "S";

         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy019#nCampo#, 1, "N";
               #dsmoy019#nCampo# = 0;  |PINTA #dsmoy019#nCampo#;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #dsmoy019#Campo# = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               #dsmoy019#nCampo# = 0;  |C_M #dsmoy019#nCampo#, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy019#nCampo#, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Elresumen;
   |C_M #dsmoy019#22,1,"S";
   |SI #dsmoy019#147 = "R";
       |C_M #dsmoy019#22,1,"N";
       #dsmoy019#22 = 1; |PINTA #dsmoy019#22;
   |FINSI;
|FPRC;
|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|PROCESO nomauto2_111;
     || nNume1 = 2 + (nDPeriodo * 2)
     || nNume2 = 2 + (nHPeriodo * 2)
     nNume1 = 2 + (nMesLugar * 2)
     nNume2 = 2 + (nMesLugar * 2)
     |ABRE #nomauto2;
     #nomauto2#0 = #labtraba#0;
     #nomauto2#1 = #labtraba#1;
     #nomauto2#2 = enEjer;
     |LEE 000#nomauto2.=;
     |SI FSalida = 0;
          |PARA nCampo = nNume1; |SI nCampo [ nNume2; |HACIENDO nCampo = nCampo + 2;
               nImporte2 = nImporte2 + #nomauto2#nCampo#;
          |SIGUE;
     |FINSI;
     |CIERRA #nomauto2;
|FPRC;

|PROCESO BuscoTrab;
   aAlfa1 = #labtraba#36; |QBF aAlfa1;
   |SI aAlfa1 ! "";
       fFecha = aAlfa1;
       |SI fFecha > #camaniva#4; |ACABA |FINSI;
   |FINSI;
   aAlfa1 = #labtraba#37; |QBF aAlfa1;
   |SI aAlfa1 ! "";
       fFecha = aAlfa1;
       |SI fFecha < #camaniva#4;
           aAlfa1 = aAlfa1 % 402;
           aAlfa2 = #camaniva#4;
           aAlfa2 = aAlfa2 % 402;
           |SI aAlfa1 ! aAlfa2;
               |ACABA;
           |FINSI;
       |FINSI;
   |FINSI;
   nNumTraba = #labtraba#1;
   |SI #labtraba#42 = "H"; nSwUno = 1; nNumTrabaH = #labtraba#1; |FINSI;
|FPRC;

|DEFBUCLE BuscoTrab;
  #labtraba#5;
  ;
  nEmpresa, aDni;
  nEmpresa, aDni;
  ;
  NULL, BuscoTrab;
|FIN;

|PROCESO BuscoTrabajador;
         nSwUno    = 0;
         aDni      = #camaniva#14 % 112;
         nNumTraba = -1;
         |BUCLE BuscoTrab;
         |SI nNumTraba ! -1;
             |ABRE #labtraba;
             |SELECT #1#labtraba;
             #labtraba#0 = nEmpresa;
             #labtraba#1 = nNumTraba;
             |LEE 040#labtraba.=;
             |SI FSalida ! 0;  |DDEFECTO #labtraba;  |FINSI;
             |CIERRA #labtraba;
         |SINO;
            |DDEFECTO #labtraba;
         |FINSI;
         aTrab42 = #labtraba#42;
|FPRC;
|| ///////////////
|PROCESO LeeClave;
     |DDEFECTO #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #dsmow154#3;
     #dsmom073#2 = #dsmow154#4;
     |LEE 000#dsmom073.=;
|FPRC;

|PROCESO VerM002;
 |SI #dsmom002#8 > "01.01.1900";
     |SI #dsmom002#8 > fFecFin;  |ACABA;  |FINSI;
 |FINSI;
 |SI #dsmom002#9 > "01.01.1900";
     |SI #dsmom002#9 < fFecIni;  |ACABA;  |FINSI;
 |FINSI;

 nExism002 = 0;
 aPeriodicidad = "T";
 |SI #dsmom002#7 = "MENSUAL   ";  aPeriodicidad = "M";  |FINSI;
|FPRC;

|DEFBUCLE VerM002;
 #dsmom002#1;
 ;
 nEmpresa, 01, 110;
 nEmpresa, 99, 110;
 e;
 NULL, VerM002;
|FIN;


|PROCESO GraboABlanco;

     #dsmow019#0     = #agifigen#0;
     #dsmow019#1     = aDni;
     #dsmow019#2     = nDevengo;
     #dsmow019#3     = "A";
     #dsmow019#4     = "99";
     |LEE 001#dsmow019.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow019;
         #dsmow019#0     = #agifigen#0;
         #dsmow019#1     = aDni;
         #dsmow019#2     = nDevengo;
         #dsmow019#3     = "A";
         #dsmow019#4     = "99";
         |GRABA 020#dsmow019.c;
     |FINSI;

     #dsmow019#5        = aNombreTrabajador;
     #dsmow019#99       = aNroAfiliacion;

                        nPerLugar = nMesNomina;
     |SI nAtrasos = 1;  nPerLugar = #nomhiatr#4;  |FINSI;

     |SI nAtrasos = 1;
         nMesLugar     = nPerLugar + 125;
         #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + nImporteSSTrabaja;
         #dsmow019#138        = #dsmow019#138        + nImporteSSTrabaja;
     |SINO;
          nMesLugar     = nPerLugar + 85;
          #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + nImporteSSTrabaja;
          #dsmow019#98         = #dsmow019#98         + nImporteSSTrabaja;
     |FINSI;

     #dsmow019#71 = #agifigen#1;
     #dsmow019#72 = nNumTrabajador;

     |GRABA 020#dsmow019.a;
     |LIBERA #dsmow019;
|FPRC;

|PROCESO GrabaTemporal1;
     |SI aClave = " ";  |Y aSubClave = "  ";  |ACABA;  |FINSI;

     |SI aClave = "A"; |Y #dsmoy019#2 = 2015;
         |SI aSubClave = "  ";
             aSubClave = "01";
         |FINSI;

         |HAZ GraboABlanco;
     |FINSI;

     |SI aClave = "A"; |Y #dsmoy019#2 ] 2016;
         |SI aSubClave = "02";
             nILT = 1;
         |FINSI;
         aSubClave = "";
     |FINSI;


     #dsmow019#0     = #agifigen#0;
     #dsmow019#1     = aDni;
     #dsmow019#2     = nDevengo;
     #dsmow019#3     = aClave;
     #dsmow019#4     = aSubClave;
     |LEE 001#dsmow019.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow019;
         #dsmow019#0     = #agifigen#0;
         #dsmow019#1     = aDni;
         #dsmow019#2     = nDevengo;
         #dsmow019#3     = aClave;
         #dsmow019#4     = aSubClave;
         |GRABA 020#dsmow019.c;
     |FINSI;

     |DDEFECTO #dsmow154;
     |SI #dsmoy019#147 ! "N";
         #dsmow154#0     = #agifigen#0;
         #dsmow154#2     = nDevengo;
         #dsmow154#3     = aClave;
         #dsmow154#4     = aSubClave;
         |LEE 001#dsmow154.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsmow154;
             #dsmow154#0     = #agifigen#0;
             #dsmow154#2     = nDevengo;
             #dsmow154#3     = aClave;
             #dsmow154#4     = aSubClave;
             |HAZ LeeClave;
             #dsmow154#5     =  #dsmom073#3;
             |GRABA 020#dsmow154.c;
         |FINSI;
     |FINSI;

     #dsmow019#5        = aNombreTrabajador;
     #dsmow019#99       = aNroAfiliacion;

                        nPerLugar = nMesNomina;
     |SI nAtrasos = 1;  nPerLugar = #nomhiatr#4;  |FINSI;

     |SI nAtrasos = 1;
         nMesLugar            = nPerLugar + 99;
         #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + nImporteBaseI;
         #dsmow019#112        = #dsmow019#112        + nImporteBaseI;
         #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + nImporteBaseI;
         #dsmow154#112        = #dsmow154#112        + nImporteBaseI;

         nMesLugar            = nPerLugar + 112;
         #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + nImporteRetencion;
         #dsmow019#125        = #dsmow019#125        + nImporteRetencion;
         #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + nImporteRetencion;
         #dsmow154#125        = #dsmow154#125        + nImporteRetencion;

         nMesLugar            = nPerLugar + 125;
         #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + nImporteSSTrabaja;
         #dsmow019#138        = #dsmow019#138        + nImporteSSTrabaja;
         #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + nImporteSSTrabaja;
         #dsmow154#138        = #dsmow154#138        + nImporteSSTrabaja;
     |SINO;

          |SI aClave = "L";
              nMesLugar            = nPerLugar + 31;
              #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + nImporteBaseI;
              #dsmow019#44         = #dsmow019#44         + nImporteBaseI;
              #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + nImporteBaseI;
              #dsmow154#44         = #dsmow154#44         + nImporteBaseI;
          |SINO;
              |SI nILT = 0;
                  nMesLugar            = nPerLugar + 5;
                  #dsmow019#18         = #dsmow019#18         + nImporteBaseI;
                  #dsmow154#18         = #dsmow154#18         + nImporteBaseI;
              |SINO;
                  nMesLugar            = nPerLugar + 164;
                  #dsmow019#177         = #dsmow019#177       + nImporteBaseI;
                  #dsmow154#177         = #dsmow154#177       + nImporteBaseI;
              |FINSI;
              #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + nImporteBaseI;
              #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + nImporteBaseI;

              |SI nILT = 0;
                  nMesLugar            = nPerLugar + 18;
                  #dsmow019#31         = #dsmow019#31         + nImporteRetencion;
                  #dsmow154#31         = #dsmow154#31         + nImporteRetencion;
              |SINO;
                  nMesLugar            = nPerLugar + 177;
                  #dsmow019#190        = #dsmow019#190        + nImporteRetencion;
                  #dsmow154#190        = #dsmow154#190        + nImporteRetencion;
              |FINSI;
              #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + nImporteRetencion;
              #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + nImporteRetencion;
          |FINSI;

          nMesLugar            = nPerLugar + 85;
          #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + nImporteSSTrabaja;
          #dsmow019#98         = #dsmow019#98         + nImporteSSTrabaja;
          #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + nImporteSSTrabaja;
          #dsmow154#98         = #dsmow154#98         + nImporteSSTrabaja;
    |FINSI;

     nMesLugar            = nPerLugar + 138;
     #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + nImporteLiquido;
     #dsmow019#151        = #dsmow019#151        + nImporteLiquido;
     #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + nImporteLiquido;
     #dsmow154#151        = #dsmow154#151        + nImporteLiquido;

     #dsmow019#71  = #agifigen#1;
     #dsmow154#71  = #agifigen#1;
     #dsmow019#72  = nNumTrabajador;
     |SI nSiM026 = 1;
         #dsmow019#217 = nEmpresa;
         #dsmow154#217 = nEmpresa;
     |FINSI;

     |GRABA 020#dsmow019.a;
     |LIBERA #dsmow019;

     |SI #dsmoy019#147 ! "N";
         |GRABA 020#dsmow154.a;
         |LIBERA #dsmow154;
     |FINSI;

     nImporteBaseI     = 0;
     nImporteRetencion = 0;
     nImporteSSocial   = 0;
     nImporteSSTrabaja = 0;
     nImporteLiquido   = 0;
     ded_not           = 0;
     nILT              = 0;
|FPRC;

|PROCESO nomhicli;
     #nomconli#0 = #labtraba#87;
     #nomconli#2 = #nomhicli#4;
     |LEE 101#nomconli.=;
     |SI FSalida = 0;
         |SI #nomconli#8 = 0;  |ACABA;  |FINSI;

         |SI #nomconli#13 = "  ";
             #nomconli#13 = "01";
             |GRABA 020#nomconli.a;
         |FINSI;

         aClave            = "L";
         aSubClave         = #nomconli#13;
         aEspecie          = "N";
         aRepercute        = "N";
         nImporteBaseI     = #nomhicli#11 * #nomhicli#10;
         nImporteRetencion = 0;
         |HAZ GrabaTemporal1;
     |FINSI;

     |LIBERA #nomconli;
|FPRC;

|DEFBUCLE nomhicli;
     #nomhicli#1;
     ;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 411;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 499;
     ;
     NULL, nomhicli;
|FIN;

|PROCESO SSTrabaja;
     |SI #dsmoy019#2 > 2011;
         |ABRE #nomnotay;
         #nomnotay#0 = nEmpresa;
         #nomnotay#1 = #labtraba#77;
         |LEE 000#nomnotay.=;
         |SI FSalida ! 0;
             #nomnotay#2 = 0;       || (%) a cero
         |FINSI;
         notaria = #nomnotay#2;
         |CIERRA #nomnotay;
         ded_not   = (#nomhicca#48 < notaria) ! 2;

         |SI aTrab42 ! "H";
             nImporte2 = (ded_not + #nomhicca#49 + #nomhicca#50 + #nomhicca#51);
         |SINO;
             |SI #nomhicca#3 = 0; |O #nomhicca#3 = 1;
                 nMesAuto = #nomhicca#2;
                 |HAZ nomauto2_111;
             |FINSI;
             |SI nImporte2 = 0;
                 nImporte2 = (ded_not + #nomhicca#49 + #nomhicca#50 + #nomhicca#51);
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO ImporteIT;
     #nomcorli#0 = #labtraba#87;
     #nomcorli#2 = #nomhicli#4;
     |LEE 041#nomcorli.=;
     |SI FSalida = 0;
         |SI #nomcorli#5 = 55; |O #nomcorli#5 = 56;
              nImport1 = nImport1 + (#nomhicli#11 * #nomhicli#10) ! 2;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE ImporteIT;
     #nomhicli#1;
     ;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 401;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 410;
     ;
     NULL, ImporteIT;
|FIN;

|PROCESO nomhicca;
     nImporte2  = 0;
     nImporteSS = 0;
     nDevengo   = 0;
     nMesLugar  = #nomhicca#2;

     |SI nAtrasos = 1;
         |SI #nomhiatr#1 ! #nomhiatr#3;
              nDevengo = #nomhiatr#3;
         |FINSI;
         |SI #nomhiatr#4 ! 0; nMesLugar = #nomhiatr#4; |FINSI;
     |FINSI;

     #labempre#0 = #nomhicca#0;
     |LEE 000#labempre.=;
     |SI FSalida ! 0;  |DDEFECTO #labempre; |FINSI;

     #labtraba#0 = #nomhicca#0;
     #labtraba#1 = #nomhicca#1;
     |LEE 000#labtraba.=;
     |SI FSalida ! 0;  |DDEFECTO #labtraba; |FINSI;
     nCentro = #labtraba#77;
     aTrab42 = #labtraba#42;

     |HAZ SSTrabaja;

     nNumTrabajador    = #nomhicca#1;
     aNombreTrabajador = #labtraba#2;
     aDni              = #labtraba#7;
     aNroAfiliacion    = #labtraba#75;
     |QBF aNroAfiliacion;

     nMesNomina        = #nomhicca#2;
     aClave            = #labtraba#99;

     aSubClave         = #labtraba#102;
     |SI aClave = "A"; |Y aSubClave ! "  "; aSubClave = "  "; |FINSI;

     aEspecie          = #labtraba#105;
     aRepercute        = #labtraba#108;
     nImporteBaseI     = #nomhicca#14 + #nomhicca#16;
     nImporteRetencion = #nomhicca#15 + #nomhicca#17;
     nImporteSSocial   = #nomhicca#45;
     nImporteLiquido   = #nomhicca#155;
     nImporteSSTrabaja = 0;
     |SI aClave  = "A"; |O aClave = "E"; |O aClave = "F";
         nImporteSSTrabaja = nImporte2; nImporte2 = 0;
     |FINSI;

     |SI aClave = "A"; |Y #dsmoy019#2 ] 2015;
         nImport3 = nImporteSSTrabaja;
         nImport1 = 0;
         |ABRE #nomcorli;
         |BUCLE ImporteIT;
         |CIERRA #nomcorli;

         |SI #nomhicca#57 ! 0; |O #nomhicca#58 ! 0;
           |O #nomhicca#59 ! 0; |O #nomhicca#60 ! 0;
            |O #nomhicca#112 ! 0; |O nImport1 ! 0;

             nImport1 = nImport1 + #nomhicca#57 + #nomhicca#58 + #nomhicca#59 + #nomhicca#60 + #nomhicca#112;
             nImport2 = (nImport1 % #nomhicca#13) ! 2;

             |SI #dsmoy019#2 = 2015;
                 nImport4 = nImport3;
                 nTp100   = 100;
                 |SI nImporteBaseI ! nImport1;
                     nTp100   = ((nImport1 * 100) / nImporteBaseI) ! 3;
                     nImport4 = ((nImport3 * nTp100) / 100) ! 2;
                 |FINSI;

                 nImporteBaseI     = nImporteBaseI - nImport1;
                 nImporteRetencion = nImporteRetencion - nImport2;
                 nImporteSSTrabaja = nImporteSSTrabaja - nImport4;

                 aSubClave = "01";
                 |SI nImporteBaseI ! 0; |O nImporteRetencion ! 0;
                     enPeu  = 1;
                     eaPeu1 = "Nota: Hay trabajadores que tiene percepciones de las claves A01 y A02, por ";
                     eaPeu2 = "tanto el importe que figura en el total gastos S.Social aparece duplicado, ";
                     eaPeu3 = "ya que en el modelo 111 se debe declarar en ambas claves";
                     |SI #dsmoy019#2 ] 2016; enPeu = 0; |FINSI;
                     |HAZ GrabaTemporal1;
                 |FINSI;

                 nImporteSSTrabaja = nImport4;
                 nImporteBaseI     = nImport1;
                 nImporteRetencion = nImport2;
                 aSubClave         = "02";
             |FINSI;

             |SI #dsmoy019#2 ] 2016;
                 nImporteBaseI     = nImporteBaseI - nImport1;
                 nImporteRetencion = nImporteRetencion - nImport2;

                 aSubClave = "";
                 |SI nImporteBaseI ! 0; |O nImporteRetencion ! 0;
                     nILT  = 0;
                     enPeu = 0;
                     |HAZ GrabaTemporal1;
                     nImporteSSTrabaja = 0;
                 |FINSI;

                 nILT  = 1;
                 nImporteBaseI     = nImport1;
                 nImporteRetencion = nImport2;
                 aSubClave         = "";
             |FINSI;
         |SINO;
             nILT  = 0;
             aSubClave = "";
             |SI #dsmoy019#2 = 2015;
                 aSubClave = "01";
             |FINSI;
         |FINSI;
     |FINSI;

     |HAZ GrabaTemporal1;
     nILT  = 0;

     aClave            = #labtraba#102;
     aSubClave         = #labtraba#103; |SI aClave = "A"; |Y aSubClave ! "  "; aSubClave = "  "; |FINSI;
     aEspecie          = #labtraba#106;
     aRepercute        = #labtraba#109;
     nImporteBaseI     = #nomhicca#108;
     nImporteRetencion = #nomhicca#110;
     nImporteSSTrabaja = 0;
     |SI aClave  = "A"; |O aClave = "E"; |O aClave = "F";
         nImporteSSTrabaja = nImporte2; nImporte2 = 0;
     |FINSI;
     |HAZ GrabaTemporal1;

     aClave            = #labtraba#101;
     aSubClave         = #labtraba#104; |SI aClave = "A"; |Y aSubClave ! "  "; aSubClave = "  "; |FINSI;
     aEspecie          = #labtraba#107;
     aRepercute        = #labtraba#110;
     nImporteBaseI     = #nomhicca#109;
     nImporteRetencion = #nomhicca#111;
     nImporteSSTrabaja = 0;
     |SI aClave  = "A"; |O aClave = "E"; |O aClave = "F";
         nImporteSSTrabaja = nImporte2; nImporte2 = 0;
     |FINSI;
     |HAZ GrabaTemporal1;

     |SI #nomhicca#18 ! 0;
         |SI #labtraba#99 ! " "; |O #labtraba#100 ! " "; |O #labtraba#101 ! " ";
             |BUCLE nomhicli;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     ;
     nEmpresa, #dsmoy019#17, nEjer, nDPeriodo, 0;
     nEmpresa, #dsmoy019#18, nEjer, nHPeriodo, 4;
     ;
     NULL, nomhicca;
|FIN;

|DEFBUCLE nomhiccaA;
     #nomhicca#1;
     ;
     #nomhiatr#0, #dsmoy019#17, nEjerAt, 01, #nomhiatr#2;
     #nomhiatr#0, #dsmoy019#18, nEjerAt, 12, #nomhiatr#2;
     ;
     NULL, nomhicca;
|FIN;

|PROCESO nomhiatr;
     ||| |SI #nomhiatr#4 = 0;  |ACABA;  |FINSI; David 12.12.2019
                                            || no incluia estos atrasos en el calculo

     |SI #nomhiatr#4 ! 0;
         |SI #nomhiatr#4 < nDPeriodo;  |ACABA;  |FINSI;
         |SI #nomhiatr#4 > nHPeriodo;  |ACABA;  |FINSI;
     |FINSI;

     aAlfa   = #nomhiatr#3;
     aAlfa   = aAlfa % -102;
     nEjerAt = aAlfa;
     |BUCLE nomhiccaA;
|FPRC;

|DEFBUCLE nomhiatr;
     #nomhiatr#1;
     ;
     nEmpresa, #dsmoy019#2,  5, 0000;
     nEmpresa, #dsmoy019#2, 20, 9999;
     ;
     NULL, nomhiatr;
|FIN;

|PROCESO DesdeNominas;
     nAtrasos = 0;  |BUCLE nomhicca;
     nAtrasos = 1;  |BUCLE nomhiatr;
|FPRC;
|| ///////////////////////////////////////////////////////////////////////////

|PROCESO LeeLinea;
     #dsmom030#0 = #caivalin#18;
     |LEE 000#dsmom030.=;
     |SI FSalida ! 0;
         #dsmom030#0 = #caivalin#3;
         |LEE 000#dsmom030.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;
     |FINSI;

     nImporteBaseI     = 0;
     nImporteRetencion = 0;

     |SI #dsmom030#0 = #cadeflab#5; |Y #dsmom107#22 = "S"; |Y #camaniva#36 = "N";
         |SI #dsmom030#5 = "G";
             nImporteSS = nImporteSS + #caivalin#11;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #dsmom030#5  ! "S"; |ACABA; |FINSI;
     |SI #dsmom030#38 ! 190; |ACABA; |FINSI;

     aClave            = #dsmom030#42;
     aSubClave         = #dsmom030#43;
     nDevengo          = 0;

     |SI aClave = "A"; |Y aSubClave = "02"; |Y nImporteSS = 0;
         nImporteSS = nImport3;
         enPeu  = 1;
         eaPeu1 = "Nota: Hay trabajadores que tiene percepciones de las claves A01 y A02, por ";
         eaPeu2 = "tanto el importe que figura en el total gastos S.Social aparece duplicado, ";
         eaPeu3 = "ya que en el modelo 111 se debe declarar en ambas claves";
         |SI #dsmoy019#2 ] 2016; enPeu = 0; |FINSI;
     |FINSI;

     |SI aParam ! "conta";
         |SI aClave = "A"; |O aClave = "L"; |O aClave = "E";
             |ACABA;
         |FINSI;
         |SI aClave = "F"; |Y aSubClave ! "02";
             |ACABA;
         |FINSI;
     |FINSI;

     aDni              = #camaniva#14;
     nImporteBaseI     = #caivalin#20;
     nImporteRetencion = #caivalin#22;
     fFechaCamaniva    = #camaniva#8;
     aCadena           = fFechaCamaniva % 402;
     nMesLugar         = aCadena;
     aNombreTrabajador = #camaniva#13;
     nRel              = 0;
     aTra              = "N";
     nNumTraba         = 0;

     aNroAfiliacion    = "";
     nMesNomina        = nMesLugar;
     nNumTrabajador    = 0;

     |SI aClave = "A"; |Y aPathLaboral ! "";
         |HAZ BuscoTrabajador;

         nRel = #labtraba#111;
         aTra = #labtraba#131;

         nNumTrabajador = #labtraba#1;
         aNroAfiliacion = #labtraba#75;
     |FINSI;

     |SI #dsmoy019#17 > nNumTrabajador; |O #dsmoy019#18 < nNumTrabajador;
         |ACABA;
     |FINSI;

     |SI #camaniva#36 = "N"; |Y enEjer > 2010; |Y #camaniva#46 ! 0;
         nRel = #camaniva#46;
         aTra = #camaniva#47;
     |FINSI;

     aEspecie   = #caivalin#26;
     aRepercute = #caivalin#27;

     nImporteSSA= nImporteSS;
     |SI aClave ! "A"; |Y aClave ! "E"; |Y aClave ! "F";
         nImporteSS = 0;
     |FINSI;

     |SI aClave = "A"; |Y enEjer > 2011; |Y aPathLaboral ! "";
         |SI nImporteSS = 0;
             |SI aTrab42 = "H"; |O nSwUno = 1;
                 #labtraba#0 = nEmpresa;
                 #labtraba#1 = nNumTrabaH;
                 nMesAuto = nMesLugar;
                 nImporte2 = 0; |HAZ nomauto2_111; nImporteSS = nImporte2;
                 |SI nSwUnoS = 1; nImporteSS = 0; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nImporteBaseI ! 0; |O nImporteRetencion ! 0; |O nImporteSS ! 0;
          nImporteSSTrabaja = nImporteSS;
          |HAZ GrabaTemporal1;
     |FINSI;

     nImporteSS= nImporteSSA;

     |SI aClave = "A"; |O aClave = "E"; |O aClave = "F";
         || para que vuelva a acumular
         nSwUnoS    = 1;
         |SI aClave = "A"; |Y aSubClave = "01"; nImport3 = nImporteSS; |FINSI;
         nImporteSS = 0;
     |FINSI;
|FPRC;

|DEFBUCLE caivalin;
     #caivalin#1;
     ;
     #camaniva#0, #camaniva#1, 01;
     #camaniva#0, #camaniva#1, 99;
     e;
     NULL, LeeLinea;
|FIN;

|PROCESO LeeCabecera;
     |SI #camaniva#5 < nDPeriodo; |O #camaniva#5 > nHPeriodo;
          |ACABA;
     |FINSI;

     nImport4   = 0;
     nImport3   = 0;
     nSwUnoS    = 0;
     nImporteSS = 0;
     nLineaIrpf = 0;
     |BUCLE caivalin;
|FPRC;

|DEFBUCLE camaniva;
     #camaniva#1;
     ;
     00, 0000000000;  ||  nDPeriodo;
     99, 9999999999;  ||  nHPeriodo;
     e;
     NULL, LeeCabecera;
|FIN;

|PROCESO DesdeContabilidad;

     |SI enSwPartido = 0;
         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";

         enEmpresa  = nEmpresa;
         enPerConta = #canempre#3;
         eaLaMonEmp = #canempre#28;
      |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
      |FINSI;
      |HAZ EnConversor;

     |PATH_DAT #camaniva#aPathConta#;
     |PATH_DAT #caivalin#aPathConta#;
     |PATH_DAT #caivaasi#aPathConta#;
     |PATH_DAT #cadeflab#aPathConta#;

     |ABRE #caivaasi;
     |DDEFECTO #caivaasi;
     |LEE 000#caivaasi.p;
     |CIERRA #caivaasi;
     aMulDep = #caivaasi#132;

     |ABRE #cadeflab;
     |DDEFECTO #cadeflab;
     |LEE 000#cadeflab.p;
     |CIERRA #cadeflab;

     nAtrasos = 0;
     |ABRE #dsmom030;
     |BUCLE camaniva;
     |CIERRA #dsmom030;

     |SI enSwPartido = 1;
         enSwOpPar   = 2;
         |HAZ FinalPartido;
     |FINSI;
|FPRC;

|PROCESO NuevoContable;
     || Si es Laboral, y tiene contabilidad, podremos
     || pasar los profesionales

     enEmpresa = nEmpresa;
     enSwOpPar = 0;
     nSw       = 1;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         nSw = 0;
         |ABRE #canempre;
         |SELECT #4#canempre;
         #canempre#2  = nEmpresa;
         #canempre#26 = nEjer;
         |LEE 040#canempre.=;
         |SI FSalida = 0; nSw = 1; |FINSI;
         |CIERRA #canempre;
     |FINSI;

     |SI nSw = 0;  |ACABA;  |FINSI;

     |HAZ DesdeContabilidad;
|FPRC;

|PROCESO OrganizaPase;
     |SI aParam ! "conta";

         |HAZ DesdeNominas;
         |SI #agitab99#8 = "L"; |Y aPathConta ! "";
             |HAZ NuevoContable;
         |FINSI;

     |SINO;

         enEmpresa = nEmpresa;
         enSwOpPar = 0;
         nSw       = 0;
         |HAZ SituaEmpresa;
         |SI enSwPartido = 0;
             |ABRE #canempre;
             |SELECT #4#canempre;
             #canempre#2  = nEmpresa;
             #canempre#26 = nEjer;
             |LEE 040#canempre.=;
             |SI FSalida = 0; nSw = 1; |FINSI;
             |CIERRA #canempre;
         |SINO;
              nSw = 1;
         |FINSI;

         |SI nSw = 1;
             |HAZ DesdeContabilidad;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsmom026;
     nEmpresa = #dsmom026#1;
     |HAZ OrganizaPase;
|FPRC;

|DEFBUCLE dsmom026;
     #dsmom026#1;
     ;
     #agifigen#0, 00001;
     #agifigen#0, 99999;
     ;
     NULL, dsmom026;
|FIN;

|PROCESO agifigen;

     #agitab99#8 = aCampo8F99;

     #dsmom006#0 = #agifigen#0;
     #dsmom006#1 = 110;
     |LEE 041#dsmom006.=;
     |SI FSalida = 0;
         |SI #dsmom006#13 ! " "; |Y #dsmom006#13 ! "X";
             #agitab99#8 = #dsmom006#13;  ||Pase Modelo 110 particular de esta Empresa
         |FINSI;
     |FINSI;

     nSiM026 = 0;
     |SELECT #1#dsmom026;
     #dsmom026#0 = #agifigen#0;
     #dsmom026#1 = 0;
     |LEE 040#dsmom026.];
     |SI FSalida = 0;  |Y  #dsmom026#0 = #agifigen#0;
         nEmpresa = #agifigen#0;
         aPeriodicidad = "M";
         |SI #dsmoy019#120 = "S";
             aPeriodicidad = "M";
             nExism002 = 1;
             |BUCLE VerM002;
             |SI nExism002 = 1; |ACABA; |FINSI; ||miro si existe modelo
         |FINSI;
         nSiM026 = 1;
         |BUCLE dsmom026;
         |ACABA;
     |FINSI;

     nSiM026 = 0;
     |SELECT #3#dsmom026;
     #dsmom026#1 = #agifigen#0;
     |LEE 040#dsmom026.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     aPeriodicidad = "M";
     nEmpresa      = #agifigen#0;
     |SI #dsmoy019#120 = "S";
         nExism002 = 1;
         |BUCLE VerM002;
         |SI nExism002 = 1; |ACABA; |FINSI; ||miro si existe modelo
     |FINSI;

     |HAZ OrganizaPase;
|FPRC;

|DEFBUCLE agifigen;
     #agifigen#1;
     ;
     #dsmoy019#3;
     #dsmoy019#4;
     ;
     NULL, agifigen;
|FIN;

|| /////////////////////////////////////////////////////////

|PROCESO SumaBaseN;
     |SI aPeriodicidad = "T";
         |SI #dsmoc110#2 = 3;
             #dsmow019#45 = #dsmow019#45 + #dsmoc110#10 + #dsmoc110#12;  || Base
             #dsmow019#46 = #dsmow019#46 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow019#47 = #dsmow019#47 + #dsmoc110#20 + #dsmoc110#22;
             #dsmow154#45 = #dsmow154#45 + #dsmoc110#10 + #dsmoc110#12;  || Base
             #dsmow154#46 = #dsmow154#46 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow154#47 = #dsmow154#47 + #dsmoc110#20 + #dsmoc110#22;

             #dsmow019#58 = #dsmow019#58 + #dsmoc110#11 + (#dsmoc110#13 + #dsmoc110#14);
             #dsmow019#59 = #dsmow019#59 + #dsmoc110#16 + (#dsmoc110#18 + #dsmoc110#19);
             #dsmow019#60 = #dsmow019#60 + #dsmoc110#21 + (#dsmoc110#23 + #dsmoc110#24);
             #dsmow154#58 = #dsmow154#58 + #dsmoc110#11 + (#dsmoc110#13 + #dsmoc110#14);
             #dsmow154#59 = #dsmow154#59 + #dsmoc110#16 + (#dsmoc110#18 + #dsmoc110#19);
             #dsmow154#60 = #dsmow154#60 + #dsmoc110#21 + (#dsmoc110#23 + #dsmoc110#24);
         |FINSI;

         |SI #dsmoc110#2 = 6;
             #dsmow019#48 = #dsmow019#48 + #dsmoc110#10 + #dsmoc110#12;
             #dsmow019#49 = #dsmow019#49 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow019#50 = #dsmow019#50 + #dsmoc110#20 + #dsmoc110#22;
             #dsmow154#48 = #dsmow154#48 + #dsmoc110#10 + #dsmoc110#12;
             #dsmow154#49 = #dsmow154#49 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow154#50 = #dsmow154#50 + #dsmoc110#20 + #dsmoc110#22;

             #dsmow019#61 = #dsmow019#61 + #dsmoc110#11 + (#dsmoc110#13 + #dsmoc110#14);
             #dsmow019#62 = #dsmow019#62 + #dsmoc110#16 + (#dsmoc110#18 + #dsmoc110#19);
             #dsmow019#63 = #dsmow019#63 + #dsmoc110#21 + (#dsmoc110#23 + #dsmoc110#24);
             #dsmow154#61 = #dsmow154#61 + #dsmoc110#11 + (#dsmoc110#13 + #dsmoc110#14);
             #dsmow154#62 = #dsmow154#62 + #dsmoc110#16 + (#dsmoc110#18 + #dsmoc110#19);
             #dsmow154#63 = #dsmow154#63 + #dsmoc110#21 + (#dsmoc110#23 + #dsmoc110#24);
         |FINSI;

         |SI #dsmoc110#2 = 9;
             #dsmow019#51 = #dsmow019#51 + #dsmoc110#10 + #dsmoc110#12;
             #dsmow019#52 = #dsmow019#52 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow019#53 = #dsmow019#53 + #dsmoc110#20 + #dsmoc110#22;
             #dsmow154#51 = #dsmow154#51 + #dsmoc110#10 + #dsmoc110#12;
             #dsmow154#52 = #dsmow154#52 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow154#53 = #dsmow154#53 + #dsmoc110#20 + #dsmoc110#22;

             #dsmow019#64 = #dsmow019#64 + #dsmoc110#11 + (#dsmoc110#13 + #dsmoc110#14);
             #dsmow019#65 = #dsmow019#65 + #dsmoc110#16 + (#dsmoc110#18 + #dsmoc110#19);
             #dsmow019#66 = #dsmow019#66 + #dsmoc110#21 + (#dsmoc110#23 + #dsmoc110#24);
             #dsmow154#64 = #dsmow154#64 + #dsmoc110#11 + (#dsmoc110#13 + #dsmoc110#14);
             #dsmow154#65 = #dsmow154#65 + #dsmoc110#16 + (#dsmoc110#18 + #dsmoc110#19);
             #dsmow154#66 = #dsmow154#66 + #dsmoc110#21 + (#dsmoc110#23 + #dsmoc110#24);
         |FINSI;

         |SI #dsmoc110#2 = 12;
             #dsmow019#54 = #dsmow019#54 + #dsmoc110#10 + #dsmoc110#12;
             #dsmow019#55 = #dsmow019#55 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow019#56 = #dsmow019#56 + #dsmoc110#20 + #dsmoc110#22;
             #dsmow154#54 = #dsmow154#54 + #dsmoc110#10 + #dsmoc110#12;
             #dsmow154#55 = #dsmow154#55 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow154#56 = #dsmow154#56 + #dsmoc110#20 + #dsmoc110#22;

             #dsmow019#67 = #dsmow019#67 + #dsmoc110#11 + (#dsmoc110#13 + #dsmoc110#14);
             #dsmow019#68 = #dsmow019#68 + #dsmoc110#16 + (#dsmoc110#18 + #dsmoc110#19);
             #dsmow019#69 = #dsmow019#69 + #dsmoc110#21 + (#dsmoc110#23 + #dsmoc110#24);
             #dsmow154#67 = #dsmow154#67 + #dsmoc110#11 + (#dsmoc110#13 + #dsmoc110#14);
             #dsmow154#68 = #dsmow154#68 + #dsmoc110#16 + (#dsmoc110#18 + #dsmoc110#19);
             #dsmow154#69 = #dsmow154#69 + #dsmoc110#21 + (#dsmoc110#23 + #dsmoc110#24);
         |FINSI;

         #dsmow019#57 = 0;
         #dsmow154#57 = 0;
         |PARA nCampo = 45;  |SI nCampo [ 56;  |HACIENDO nCampo = nCampo + 1;
               #dsmow019#57 = #dsmow019#57 + #dsmow019#nCampo#;
               #dsmow154#57 = #dsmow154#57 + #dsmow154#nCampo#;
         |SIGUE;

         #dsmow019#70 = 0;
         #dsmow154#70 = 0;
         |PARA nCampo = 58;  |SI nCampo [ 69;  |HACIENDO nCampo = nCampo + 1;
               #dsmow019#70 = #dsmow019#70 + #dsmow019#nCampo#;
               #dsmow154#70 = #dsmow154#70 + #dsmow154#nCampo#;
         |SIGUE;
     |SINO;
         nMesLugar            = 44 + #dsmoc110#2;
         #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsmoc110#10 + #dsmoc110#12 + #dsmoc110#15 + #dsmoc110#17 + #dsmoc110#20 + #dsmoc110#22;
         #dsmow019#57         = #dsmow019#57         + #dsmoc110#10 + #dsmoc110#12 + #dsmoc110#15 + #dsmoc110#17 + #dsmoc110#20 + #dsmoc110#22;
         #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsmoc110#10 + #dsmoc110#12 + #dsmoc110#15 + #dsmoc110#17 + #dsmoc110#20 + #dsmoc110#22;
         #dsmow154#57         = #dsmow154#57         + #dsmoc110#10 + #dsmoc110#12 + #dsmoc110#15 + #dsmoc110#17 + #dsmoc110#20 + #dsmoc110#22;

         nMesLugar            = 57 + #dsmoc110#2;
         #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsmoc110#11 + (#dsmoc110#13 + #dsmoc110#14);
         #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsmoc110#16 + (#dsmoc110#18 + #dsmoc110#19);
         #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsmoc110#21 + (#dsmoc110#22 + #dsmoc110#24);
         #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsmoc110#11 + (#dsmoc110#13 + #dsmoc110#14);
         #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsmoc110#16 + (#dsmoc110#18 + #dsmoc110#19);
         #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsmoc110#21 + (#dsmoc110#22 + #dsmoc110#24);

         #dsmow019#70         = #dsmow019#70         + #dsmoc110#11 + (#dsmoc110#13 + #dsmoc110#14);
         #dsmow019#70         = #dsmow019#70         + #dsmoc110#16 + (#dsmoc110#18 + #dsmoc110#19);
         #dsmow019#70         = #dsmow019#70         + #dsmoc110#21 + (#dsmoc110#22 + #dsmoc110#24);
         #dsmow154#70         = #dsmow154#70         + #dsmoc110#11 + (#dsmoc110#13 + #dsmoc110#14);
         #dsmow154#70         = #dsmow154#70         + #dsmoc110#16 + (#dsmoc110#18 + #dsmoc110#19);
         #dsmow154#70         = #dsmow154#70         + #dsmoc110#21 + (#dsmoc110#22 + #dsmoc110#24);
     |FINSI;
|FPRC;

|PROCESO SumaBaseX;
     |SI aPeriodicidad = "T";
         |SI #dsmoc110#2 = 3;
             #dsmow019#73 = #dsmow019#73 + #dsmoc110#10 + #dsmoc110#12;  || Base
             #dsmow019#74 = #dsmow019#74 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow019#75 = #dsmow019#75 + #dsmoc110#20 + #dsmoc110#22;
             #dsmow154#73 = #dsmow154#73 + #dsmoc110#10 + #dsmoc110#12;  || Base
             #dsmow154#74 = #dsmow154#74 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow154#75 = #dsmow154#75 + #dsmoc110#20 + #dsmoc110#22;
         |FINSI;

         |SI #dsmoc110#2 = 6;
             #dsmow019#76 = #dsmow019#76 + #dsmoc110#10 + #dsmoc110#12;
             #dsmow019#77 = #dsmow019#77 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow019#78 = #dsmow019#78 + #dsmoc110#20 + #dsmoc110#22;
             #dsmow154#76 = #dsmow154#76 + #dsmoc110#10 + #dsmoc110#12;
             #dsmow154#77 = #dsmow154#77 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow154#78 = #dsmow154#78 + #dsmoc110#20 + #dsmoc110#22;
         |FINSI;

         |SI #dsmoc110#2 = 9;
             #dsmow019#79 = #dsmow019#79 + #dsmoc110#10 + #dsmoc110#12;
             #dsmow019#80 = #dsmow019#80 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow019#81 = #dsmow019#81 + #dsmoc110#20 + #dsmoc110#22;
             #dsmow154#79 = #dsmow154#79 + #dsmoc110#10 + #dsmoc110#12;
             #dsmow154#80 = #dsmow154#80 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow154#81 = #dsmow154#81 + #dsmoc110#20 + #dsmoc110#22;
         |FINSI;

         |SI #dsmoc110#2 = 12;
             #dsmow019#82 = #dsmow019#82 + #dsmoc110#10 + #dsmoc110#12;
             #dsmow019#83 = #dsmow019#83 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow019#84 = #dsmow019#84 + #dsmoc110#20 + #dsmoc110#22;
             #dsmow154#82 = #dsmow154#82 + #dsmoc110#10 + #dsmoc110#12;
             #dsmow154#83 = #dsmow154#83 + #dsmoc110#15 + #dsmoc110#17;
             #dsmow154#84 = #dsmow154#84 + #dsmoc110#20 + #dsmoc110#22;
         |FINSI;

         #dsmow019#85 = 0;
         #dsmow154#85 = 0;
         |PARA nMesLugar = 73;  |SI nMesLugar [ 84;  |HACIENDO nMesLugar = nMesLugar + 1;
               #dsmow019#85 = #dsmow019#85 + #dsmow019#nMesLugar#;
               #dsmow154#85 = #dsmow154#85 + #dsmow154#nMesLugar#;
         |SIGUE;
     |SINO;
         nMesLugar = 72 + #dsmoc110#2;
         #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsmoc110#10 + #dsmoc110#12 + #dsmoc110#15 + #dsmoc110#17 + #dsmoc110#20 + #dsmoc110#22;
         #dsmow019#85         = #dsmow019#85         + #dsmoc110#10 + #dsmoc110#12 + #dsmoc110#15 + #dsmoc110#17 + #dsmoc110#20 + #dsmoc110#22;
         #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsmoc110#10 + #dsmoc110#12 + #dsmoc110#15 + #dsmoc110#17 + #dsmoc110#20 + #dsmoc110#22;
         #dsmow154#85         = #dsmow154#85         + #dsmoc110#10 + #dsmoc110#12 + #dsmoc110#15 + #dsmoc110#17 + #dsmoc110#20 + #dsmoc110#22;
     |FINSI;
|FPRC;

|PROCESO MiraEmp;
     |ABRE #agifigen;
     |DDEFECTO #agifigen;
     #agifigen#0 = #dsmow019#0;
     |LEE 040#agifigen.=;
     |CIERRA #agifigen;
     #dsmow019#71 = #agifigen#1;
|FPRC;

|PROCESO labtraba;
         nNumTrabajador = #labtraba#1;
         nHay = 1;
         |ERROR10;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#5;
     ;
     #agifigen#0, aDni;
     #agifigen#0, aDni;
     ;
     NULL, labtraba;
|FIN;

|PROCESO Graba110;

     nNumTrabajador = 0;
     |SI aPathLaboral ! "";
         nHay = 0;
         aDni = #dsmoc110#6;
         |BUCLE labtraba;
     |FINSI;
     |SI nNumTrabajador < #dsmoy019#17; |O nNumTrabajador > #dsmoy019#18;
         |ACABA;
     |FINSI;

     aPeriodicidad = "M";
     nExism002 = 1;
     |BUCLE VerM002;
     |SI #dsmoy019#120 = "S";
         |SI nExism002 = 1; |ACABA; |FINSI; ||miro si existe modelo
     |FINSI;
     #dsmow019#0     = #dsmoc110#0;
     #dsmow019#1     = #dsmoc110#6;
     #dsmow019#2     = #dsmoc110#7;
     #dsmow019#3     = #dsmoc110#8;
     #dsmow019#4     = #dsmoc110#9;
     |LEE 001#dsmow019.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow019;
         #dsmow019#0     = #dsmoc110#0;
         #dsmow019#1     = #dsmoc110#6;
         #dsmow019#2     = #dsmoc110#7;
         #dsmow019#3     = #dsmoc110#8;
         #dsmow019#4     = #dsmoc110#9;
         #dsmow019#5     = #dsmoc110#29;
         |HAZ MiraEmp;
         #dsmow019#72    = nNumTrabajador;
         |GRABA 020#dsmow019.c;
     |FINSI;

     |DDEFECTO #dsmow154;
     |SI #dsmoy019#147 ! "N";
         #dsmow154#0     = #dsmoc110#0;
         #dsmow154#2     = #dsmoc110#7;
         #dsmow154#3     = #dsmoc110#8;
         #dsmow154#4     = #dsmoc110#9;
         |LEE 001#dsmow154.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsmow154;
             #dsmow154#0     = #dsmoc110#0;
             #dsmow154#2     = #dsmoc110#7;
             #dsmow154#3     = #dsmoc110#8;
             #dsmow154#4     = #dsmoc110#9;
             |HAZ LeeClave;
             #dsmow154#5     = #dsmom073#3;
             #dsmow154#71    = #dsmow019#71;
             |GRABA 020#dsmow154.c;
         |FINSI;
     |FINSI;

     |SI aPeriodicidad = "T";
         |SI #dsmoy019#0 = 1;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy019#0 = 2;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy019#0 = 3;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy019#0 = 4;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy019#0 = 5;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy019#0 = 6;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy019#0 = 7;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy019#0 = 8;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy019#0 = 9;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy019#0 = 10;  nPeriodo = 12;  |FINSI;
         |SI #dsmoy019#0 = 11;  nPeriodo = 12;  |FINSI;
         |SI #dsmoy019#0 = 12;  nPeriodo = 12;  |FINSI;
     |SINO;
         nPeriodo = #dsmoy019#0;
     |FINSI;

     |SI #dsmoc110#2 < #dsmoy019#118;    |ACABA;  |FINSI;
     |SI #dsmoc110#2 > nPeriodo;  |ACABA;  |FINSI;

     |SI #dsmoc110#8 ! "L";
         |HAZ SumaBaseN;
     |SINO;
         |HAZ SumaBaseX;
     |FINSI;

     |GRABA 020#dsmow019.a;
     |LIBERA #dsmow019;

     |SI #dsmoy019#147 ! "N";
         |GRABA 020#dsmow154.a;
         |LIBERA #dsmow154;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc110;
     #dsmoc110#1;
     ;
     #agifigen#0, #dsmoy019#2, Periodo, 110, nDComplem, 01, "            ", 0000, " ", "  ";
     #agifigen#0, #dsmoy019#2, Periodo, 110, nHComplem, 99, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, Graba110;
|FIN;

|PROCESO SumaBaseN_moc111;
     nMesLugar = #dsmoc111#8 + 44;  #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsmoc111#12 + #dsmoc111#14;
                                    #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsmoc111#12 + #dsmoc111#14;
     nMesLugar = #dsmoc111#8 + 57;  #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsmoc111#13 + #dsmoc111#15 + #dsmoc111#16;
                                    #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsmoc111#13 + #dsmoc111#15 + #dsmoc111#16;
     nMesLugar = #dsmoc111#8 + 151; #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsmoc111#18;
                                    #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsmoc111#18;

     #dsmow019#57 = 0;
     #dsmow154#57 = 0;
     |PARA nMesLugar = 45;  |SI nMesLugar [ 56;  |HACIENDO nMesLugar = nMesLugar + 1;
           #dsmow019#57 = #dsmow019#57 + #dsmow019#nMesLugar#;
           #dsmow154#57 = #dsmow154#57 + #dsmow154#nMesLugar#;
     |SIGUE;

     #dsmow019#70 = 0;
     #dsmow154#70 = 0;
     |PARA nMesLugar = 58;  |SI nMesLugar [ 69;  |HACIENDO nMesLugar = nMesLugar + 1;
           #dsmow019#70 = #dsmow019#70 + #dsmow019#nMesLugar#;
           #dsmow154#70 = #dsmow154#70 + #dsmow154#nMesLugar#;
     |SIGUE;

     #dsmow019#164 = 0;
     #dsmow154#164 = 0;
     |PARA nMesLugar = 152;  |SI nMesLugar [ 163;  |HACIENDO nMesLugar = nMesLugar + 1;
           #dsmow019#164 = #dsmow019#164 + #dsmow019#nMesLugar#;
           #dsmow154#164 = #dsmow154#164 + #dsmow154#nMesLugar#;
     |SIGUE;
|FPRC;

|PROCESO SumaBaseX_moc111;
     nMesLugar            = 72 + #dsmoc111#8;
     #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsmoc111#12 + #dsmoc111#14;
     #dsmow019#85         = #dsmow019#85         + #dsmoc111#12 + #dsmoc111#14;
     #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsmoc111#12 + #dsmoc111#14;
     #dsmow154#85         = #dsmow154#85         + #dsmoc111#12 + #dsmoc111#14;
|FPRC;

|PROCESO dsmoc111;
     nNumTrabajador = 0;
     |SI aPathLaboral ! "";
         nHay = 0;
         aDni = #dsmoc111#6;
         |BUCLE labtraba;
     |FINSI;
     |SI nNumTrabajador < #dsmoy019#17; |O nNumTrabajador > #dsmoy019#18;
         |ACABA;
     |FINSI;

     aPeriodicidad = "M";
     nExism002     = 1;

     |BUCLE VerM002;
     |SI #dsmoy019#120 = "S";
         |SI nExism002 = 1; |ACABA; |FINSI; ||miro si existe modelo
     |FINSI;
     #dsmow019#0     = #dsmoc111#0;
     #dsmow019#1     = #dsmoc111#6;
     #dsmow019#2     = #dsmoc111#7;
     #dsmow019#3     = #dsmoc111#9;
     #dsmow019#4     = #dsmoc111#10;
     |LEE 001#dsmow019.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow019;
         #dsmow019#0     = #dsmoc111#0;
         #dsmow019#1     = #dsmoc111#6;
         #dsmow019#2     = #dsmoc111#7;
         #dsmow019#3     = #dsmoc111#9;
         #dsmow019#4     = #dsmoc111#10;
         #dsmow019#5     = #dsmoc111#21;
         |HAZ MiraEmp;
         #dsmow019#72    = nNumTrabajador;
         |GRABA 020#dsmow019.b;
     |FINSI;

     |DDEFECTO #dsmow154;
     |SI #dsmoy019#147 ! "N";
         #dsmow154#0     = #dsmoc111#0;
         #dsmow154#2     = #dsmoc111#7;
         #dsmow154#3     = #dsmoc111#9;
         #dsmow154#4     = #dsmoc111#10;
         |LEE 001#dsmow154.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsmow154;
             #dsmow154#0     = #dsmoc111#0;
             #dsmow154#2     = #dsmoc111#7;
             #dsmow154#3     = #dsmoc111#9;
             #dsmow154#4     = #dsmoc111#10;
             |HAZ LeeClave;
             #dsmow154#5     = #dsmom073#3;
             #dsmow154#71    = #dsmow019#71;
             |GRABA 020#dsmow154.c;
         |FINSI;
     |FINSI;

     |SI aPeriodicidad = "T";
         |SI #dsmoy019#0 = 1;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy019#0 = 2;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy019#0 = 3;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy019#0 = 4;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy019#0 = 5;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy019#0 = 6;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy019#0 = 7;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy019#0 = 8;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy019#0 = 9;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy019#0 = 10;  nPeriodo = 12;  |FINSI;
         |SI #dsmoy019#0 = 11;  nPeriodo = 12;  |FINSI;
         |SI #dsmoy019#0 = 12;  nPeriodo = 12;  |FINSI;
     |SINO;
         nPeriodo = #dsmoy019#0;
     |FINSI;

     |SI #dsmoc111#2 < #dsmoy019#118;    |ACABA;  |FINSI;
     |SI #dsmoc111#2 > nPeriodo;  |ACABA;  |FINSI;

     |SI #dsmoc111#9 ! "L";
         |HAZ SumaBaseN_moc111;
     |SINO;
         |HAZ SumaBaseX_moc111;
     |FINSI;

     |GRABA 020#dsmow019.a;
     |LIBERA #dsmow019;

     |SI #dsmoy019#147 ! "N";
         |GRABA 020#dsmow154.a;
         |LIBERA #dsmow154;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc111;
     #dsmoc111#1;
     ;
     #agifigen#0, #dsmoy019#2, Periodo, 110, nDComplem, 01, "            ", 0000, 00, " ", "  ", 0;
     #agifigen#0, #dsmoy019#2, Periodo, 110, nHComplem, 99, "zzzzzzzzzzzz", 9999, 99, "z", "zz", 9;
     ;
     NULL, dsmoc111;
|FIN;

|PROCESO SumaBaseN_11101;
     nMesLugar = #dsm11101#8 + 44;
     nMesLuga1 = nMesLugar;
     |SI #dsm11101#9 = "A";
         nMesLuga1 = #dsm11101#8 + 190;
     |FINSI;
     #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsm11101#12 + #dsm11101#14;
     #dsmow019#nMesLuga1# = #dsmow019#nMesLuga1# + #dsm11101#25 + #dsm11101#27;
     #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsm11101#12 + #dsm11101#14;
     #dsmow154#nMesLuga1# = #dsmow154#nMesLuga1# + #dsm11101#25 + #dsm11101#27;

     nMesLugar = #dsm11101#8 + 57;
     nMesLuga1 = nMesLugar;
     |SI #dsm11101#9 = "A";
         nMesLuga1 = #dsm11101#8 + 203;
     |FINSI;
     #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsm11101#13 + #dsm11101#15 + #dsm11101#16;
     #dsmow019#nMesLuga1# = #dsmow019#nMesLuga1# + #dsm11101#26 + #dsm11101#28 + #dsm11101#29;
     #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsm11101#13 + #dsm11101#15 + #dsm11101#16;
     #dsmow154#nMesLuga1# = #dsmow154#nMesLuga1# + #dsm11101#26 + #dsm11101#28 + #dsm11101#29;

     nMesLugar = #dsm11101#8 + 151;
     #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsm11101#18;
     #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsm11101#18;

     #dsmow019#57 = 0;
     #dsmow154#57 = 0;
     |PARA nMesLugar = 45;  |SI nMesLugar [ 56;  |HACIENDO nMesLugar = nMesLugar + 1;
           #dsmow019#57 = #dsmow019#57 + #dsmow019#nMesLugar#;
           #dsmow154#57 = #dsmow154#57 + #dsmow154#nMesLugar#;
     |SIGUE;

     #dsmow019#70 = 0;
     #dsmow154#70 = 0;
     |PARA nMesLugar = 58;  |SI nMesLugar [ 69;  |HACIENDO nMesLugar = nMesLugar + 1;
           #dsmow019#70 = #dsmow019#70 + #dsmow019#nMesLugar#;
           #dsmow154#70 = #dsmow154#70 + #dsmow154#nMesLugar#;
     |SIGUE;

     #dsmow019#203 = 0;
     #dsmow154#203 = 0;
     |PARA nMesLugar = 191;  |SI nMesLugar [ 202;  |HACIENDO nMesLugar = nMesLugar + 1;
           #dsmow019#203 = #dsmow019#203 + #dsmow019#nMesLugar#;
           #dsmow154#203 = #dsmow154#203 + #dsmow154#nMesLugar#;
     |SIGUE;

     #dsmow019#216 = 0;
     #dsmow154#216 = 0;
     |PARA nMesLugar = 204;  |SI nMesLugar [ 215;  |HACIENDO nMesLugar = nMesLugar + 1;
           #dsmow019#216 = #dsmow019#216 + #dsmow019#nMesLugar#;
           #dsmow154#216 = #dsmow154#216 + #dsmow154#nMesLugar#;
     |SIGUE;

     #dsmow019#164 = 0;
     #dsmow154#164 = 0;
     |PARA nMesLugar = 152;  |SI nMesLugar [ 163;  |HACIENDO nMesLugar = nMesLugar + 1;
           #dsmow019#164 = #dsmow019#164 + #dsmow019#nMesLugar#;
           #dsmow154#164 = #dsmow154#164 + #dsmow154#nMesLugar#;
     |SIGUE;
|FPRC;

|PROCESO SumaBaseX_11101;
     nMesLugar            = 72 + #dsm11101#8;
     #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsm11101#12 + #dsm11101#14;
     #dsmow019#nMesLugar# = #dsmow019#nMesLugar# + #dsm11101#25 + #dsm11101#27;
     #dsmow019#85         = #dsmow019#85         + #dsm11101#12 + #dsm11101#14;
     #dsmow019#85         = #dsmow019#85         + #dsm11101#25 + #dsm11101#27;

     #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsm11101#12 + #dsm11101#14;
     #dsmow154#nMesLugar# = #dsmow154#nMesLugar# + #dsm11101#25 + #dsm11101#27;
     #dsmow154#85         = #dsmow154#85         + #dsm11101#12 + #dsm11101#14;
     #dsmow154#85         = #dsmow154#85         + #dsm11101#25 + #dsm11101#27;
|FPRC;

|PROCESO dsm11101;
     nNumTrabajador = 0;
     |SI aPathLaboral ! "";
         nHay = 0;
         aDni = #dsm11101#6;
         |BUCLE labtraba;
     |FINSI;
     |SI nNumTrabajador < #dsmoy019#17; |O nNumTrabajador > #dsmoy019#18;
         |ACABA;
     |FINSI;

     aPeriodicidad = "M";
     nExism002     = 1;

     |BUCLE VerM002;
     |SI #dsmoy019#120 = "S";
         |SI nExism002 = 1; |ACABA; |FINSI; ||miro si existe modelo
     |FINSI;

     #dsmow019#0     = #dsm11101#0;
     #dsmow019#1     = #dsm11101#6;
     #dsmow019#2     = #dsm11101#7;
     #dsmow019#3     = #dsm11101#9;
     #dsmow019#4     = #dsm11101#10;
     |LEE 001#dsmow019.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow019;
         #dsmow019#0     = #dsm11101#0;
         #dsmow019#1     = #dsm11101#6;
         #dsmow019#2     = #dsm11101#7;
         #dsmow019#3     = #dsm11101#9;
         #dsmow019#4     = #dsm11101#10;
         #dsmow019#5     = #dsm11101#21;
         |HAZ MiraEmp;
         #dsmow019#72    = nNumTrabajador;
         |GRABA 020#dsmow019.c;
     |FINSI;

     |DDEFECTO #dsmow154;
     |SI #dsmoy019#147 ! "N";
         #dsmow154#0     = #dsm11101#0;
         #dsmow154#2     = #dsm11101#7;
         #dsmow154#3     = #dsm11101#9;
         #dsmow154#4     = #dsm11101#10;
         |LEE 001#dsmow154.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsmow154;
             #dsmow154#0     = #dsm11101#0;
             #dsmow154#2     = #dsm11101#7;
             #dsmow154#3     = #dsm11101#9;
             #dsmow154#4     = #dsm11101#10;
             |HAZ LeeClave;
             #dsmow154#5     = #dsmom073#3;
             #dsmow154#71    = #dsmow019#71;
             |GRABA 020#dsmow154.c;
         |FINSI;
     |FINSI;

     |SI aPeriodicidad = "T";
         |SI #dsmoy019#0 = 1;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy019#0 = 2;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy019#0 = 3;   nPeriodo = 3;   |FINSI;
         |SI #dsmoy019#0 = 4;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy019#0 = 5;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy019#0 = 6;   nPeriodo = 6;   |FINSI;
         |SI #dsmoy019#0 = 7;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy019#0 = 8;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy019#0 = 9;   nPeriodo = 9;   |FINSI;
         |SI #dsmoy019#0 = 10;  nPeriodo = 12;  |FINSI;
         |SI #dsmoy019#0 = 11;  nPeriodo = 12;  |FINSI;
         |SI #dsmoy019#0 = 12;  nPeriodo = 12;  |FINSI;
     |SINO;
         nPeriodo = #dsmoy019#0;
     |FINSI;

     |SI #dsm11101#2 < #dsmoy019#118;    |ACABA;  |FINSI;
     |SI #dsm11101#2 > nPeriodo;  |ACABA;  |FINSI;

     |SI #dsm11101#9 ! "L";
         |HAZ SumaBaseN_11101;
     |SINO;
         |HAZ SumaBaseX_11101;
     |FINSI;

     |GRABA 020#dsmow019.a;
     |LIBERA #dsmow019;

     |SI #dsmoy019#147 ! "N";
         |GRABA 020#dsmow154.a;
         |LIBERA #dsmow154;
     |FINSI;
|FPRC;

|DEFBUCLE dsm11101;
     #dsm11101#1;
     ;
     #agifigen#0, #dsmoy019#2, Periodo, 110, nDComplem, 01, "            ", 0000, 00, " ", "  ", 0;
     #agifigen#0, #dsmoy019#2, Periodo, 110, nHComplem, 99, "zzzzzzzzzzzz", 9999, 99, "z", "zz", 9;
     ;
     NULL, dsm11101;
|FIN;

|PROCESO agifigen_110;
    || miro el ultimo complementario
    || de los periodos anteriores 14_1285

    nEmpresa = #agifigen#0;

    |SI aParam = "conta";   || miro solo los que tiene contabilidad
        |ABRE #canempre;
        |SELECT #4#canempre;
        #canempre#2  = nEmpresa;
        #canempre#26 = nEjer;
        |LEE 040#canempre.=;
        |SI FSalida ! 0;
            |CIERRA #canempre;
            |ACABA;
        |FINSI;
        |CIERRA #canempre;
    |FINSI;

    |PARA Periodo = 1;  |SI Periodo [ 12;  |HACIENDO Periodo = Periodo + 1;
          nDComplem = -1;

          |SI #dsmoy019#2 [ 2010;
              |ABRE #dsmoc110;
              |DDEFECTO #dsmoc110;
              #dsmoc110#0 = #agifigen#0;
              #dsmoc110#1 = #dsmoy019#2;
              #dsmoc110#2 = Periodo
              #dsmoc110#3 = 110;
              #dsmoc110#4 = 99;
              |LEE 040#dsmoc110.];
              |SI FSalida = 0;
                  |LEE 040#dsmoc110.a;
              |SINO;
                  |LEE 040#dsmoc110.u;
              |FINSI;
              |SI FSalida = 0; |Y #dsmoc110#0 = #agifigen#0; |Y #dsmoc110#1 = #dsmoy019#2;
                               |Y #dsmoc110#2 = Periodo; |Y #dsmoc110#3 = 110;
                  nDComplem = #dsmoc110#4;
                  nHComplem = #dsmoc110#4;
              |FINSI;
              |CIERRA #dsmoc110;
          |FINSI;

          |SI #dsmoy019#2 ] 2011;  |Y #dsmoy019#2 [ 2015;
              |ABRE #dsmoc111;
              |DDEFECTO #dsmoc111;
              #dsmoc111#0 = #agifigen#0;
              #dsmoc111#1 = #dsmoy019#2;
              #dsmoc111#2 = Periodo
              #dsmoc111#3 = 110;
              #dsmoc111#4 = 99;
              |LEE 040#dsmoc111.];
              |SI FSalida = 0;
                  |LEE 040#dsmoc111.a;
              |SINO;
                  |LEE 040#dsmoc111.u;
              |FINSI;
              |SI FSalida = 0; |Y #dsmoc111#0 = #agifigen#0; |Y #dsmoc111#1 = #dsmoy019#2;
                               |Y #dsmoc111#2 = Periodo; |Y #dsmoc111#3 = 110;
                  nDComplem = #dsmoc111#4;
                  nHComplem = #dsmoc111#4;
              |FINSI;
              |CIERRA #dsmoc111;
          |FINSI;

          |SI #dsmoy019#2 ] 2016;
              |ABRE #dsm11101;
              |DDEFECTO #dsm11101;
              #dsm11101#0 = #agifigen#0;
              #dsm11101#1 = #dsmoy019#2;
              #dsm11101#2 = Periodo
              #dsm11101#3 = 110;
              #dsm11101#4 = 99;
              |LEE 040#dsm11101.];
              |SI FSalida = 0;
                  |LEE 040#dsm11101.a;
              |SINO;
                  |LEE 040#dsm11101.u;
              |FINSI;
              |SI FSalida = 0; |Y #dsm11101#0 = #agifigen#0; |Y #dsm11101#1 = #dsmoy019#2;
                               |Y #dsm11101#2 = Periodo; |Y #dsm11101#3 = 110;
                  nDComplem = #dsm11101#4;
                  nHComplem = #dsm11101#4;
              |FINSI;
              |CIERRA #dsm11101;
          |FINSI;

          |SI nDComplem ] 0;
              |SI #dsmoy019#2 [ 2010;  |BUCLE dsmoc110;  |FINSI;
              |SI #dsmoy019#2 = 2011;  |BUCLE dsmoc111;  |FINSI;
              |SI #dsmoy019#2 = 2012;  |BUCLE dsmoc111;  |FINSI;
              |SI #dsmoy019#2 = 2013;  |BUCLE dsmoc111;  |FINSI;
              |SI #dsmoy019#2 = 2014;  |BUCLE dsmoc111;  |FINSI;
              |SI #dsmoy019#2 = 2015;  |BUCLE dsmoc111;  |FINSI;
              |SI #dsmoy019#2 ] 2016;  |BUCLE dsm11101;  |FINSI;
          |FINSI;
  |SIGUE;
|FPRC;

|DEFBUCLE agifigen_110;
     #agifigen#1;
     ;
     #dsmoy019#3;
     #dsmoy019#4;
     ;
     NULL, agifigen_110;
|FIN;

|| ... ... ... ... ... ... ... ... Proceso para Imprimir Auxiliar
|PROCESO LeeLasClaves;
     nSwl0 = 1;
     nSwl1 = 1;  nSwl2 = 1; nSwl3 = 1;
     nSwl4 = 1;  nSwl5 = 1; nSwl6 = 1;
     nSwl7 = 1;  nSwl8 = 1; nSwl9 = 1;
     nSwl10 = 1; nSwl12 = 1;

|| ... SW para imprimir
     |PARA nNume1 = 1; |SI nNume1 [ 13; |HACIENDO nNume1 = nNume1 + 1;

           nNume3 = 5  + nNume1;                  || Base
           |SI #dsmow154#nNume3# ! 0; nSwl1 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 18 + nNume1;                  || Retencion
           |SI #dsmow154#nNume3# ! 0; nSwl2 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 85 + nNume1;                  || S.Social
           |SI #dsmow154#nNume3# ! 0; nSwl3 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 31 + nNume1;                  || Base Exenta
           |SI #dsmow154#nNume3# ! 0; nSwl4 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 44 + nNume1;                  || Base 110
           |SI #dsmow154#nNume3# ! 0; nSwl5 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 72 + nNume1;                  || Base Exenta 110
           |SI #dsmow154#nNume3# ! 0; nSwl6 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 57 + nNume1;
           |SI #dsmow154#nNume3# ! 0; nSwl7 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 99 + nNume1;
           |SI #dsmow154#nNume3# ! 0; nSwl8 = 0; nSwl0 = 0; |FINSI;  || Base atrasos

           nNume3 = 112 + nNume1;
           |SI #dsmow154#nNume3# ! 0; nSwl9 = 0; nSwl0 = 0; |FINSI;  || Retencion atrasos

           nNume3 = 125 + nNume1;
           |SI #dsmow154#nNume3# ! 0; nSwl10 = 0; nSwl0 = 0; |FINSI;  || S.Social atrasos

           nNume3 = 151 + nNume1;
           |SI #dsmow154#nNume3# ! 0; nSwl12 = 0; nSwl0 = 0; |FINSI;  || S.Social Mod. 111
  |SIGUE;

  |SI nSwl0 = 0;
      |PRINT;
      nSwPie = 1;
  |FINSI;
|FPRC;

|DEFBUCLE LeeLasClaves;
     #dsmow154#1;
     ;
     nEmpresa, " ", "  ", 0000;
     nEmpresa, "z", "zz", 9999;
     ;
     NULL, LeeLasClaves;
|FIN;

|PROCESO ElSegundoInf;
     nError = 0;
     |SI nSwInf = 1;
         |FININF;
         nSwInf = 0;
     |FINSI;

     informe = "dsmoyr19";
     |SI #dsmoy019#2 ] 2016; informe = "ds16yr19"; |FINSI;
     |INFOR informe;
     |SI FSalida ! 0;
         |MENAV "    No existe informe dsmoyr19";
         |ERROR10;
         nError = 1;
         |ACABA;
     |FINSI;

     nSwInf = 1;
     nSwPie = 0;

     |BUCLE LeeLasClaves;
     |SI nSwPie = 1;
         |PIEINF;
         nSwPie = 0;
     |FINSI;

     |FININF;
     nSwInf = 0;
|FPRC;

|| ... ... ... ... ... ... ... ... Proceso para Imprimir Auxiliar
|PROCESO Imprime;

     |SI nEmpresa ! #dsmow019#0;  |Y nEmpresa ! 0;
         |SI nSwPie = 1;
             |PIEINF;
             nSwPie = 0;
         |FINSI;
         |SI #dsmoy019#147 ! "N";
             |HAZ ElSegundoInf;
             |SI nError = 1; |ACABA; |FINSI;
         |FINSI;
         |PDEFECTO #dsmoy019,  26,117;
         |PDEFECTO #dsmoy019, 121,133;
         |PDEFECTO #dsmoy019, 134,147;
         |PDEFECTO #dsmoy019, 148,200;
         nQuantA = -1;
         nCampo0 = 0;
         aCampo1 = "";
         nCampo2 = 0;
     |FINSI;

     nEmpresa = #dsmow019#0;
     aNumEmp  = nEmpresa; |QBF aNumEmp;
     aNumEmp  = ("00000" + aNumEmp) % -105;
     aNomEmp  = #dsmow019#71;

     nSwl0 = 1;
     nSwl1 = 1;  nSwl2 = 1; nSwl3 = 1;
     nSwl4 = 1;  nSwl5 = 1; nSwl6 = 1;
     nSwl7 = 1;  nSwl8 = 1; nSwl9 = 1;
     nSwl10 = 1; nSwl12 = 1;
     nSwl13 = 1; nSwl14 = 1;
     nSwl15 = 1; nSwl16 = 1;

     nQuantSuma = 0;
     eaTexto = "Gtos. Seg. Social Historico ...";
     |SI #dsmow019#3 = "A"; |Y #dsmow019#4 = "99";
         eaTexto = "Gtos. SS. Historico A01 y A02 .";
         #dsmow019#4 = "  ";

         nQuantSuma = 1;
         |SI nQuantA < 2;
             nQuantA = 0;
             |ACABA;
         |FINSI;
     |FINSI;

|| ... SW para imprimir
      |PARA nNume1 = 1; |SI nNume1 [ 13; |HACIENDO nNume1 = nNume1 + 1;

           nNume3 = 5  + nNume1;                  || Base
           |SI #dsmow019#nNume3# ! 0; nSwl1 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 18 + nNume1;                  || Retencion
           |SI #dsmow019#nNume3# ! 0; nSwl2 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 85 + nNume1;                  || S.Social
           |SI #dsmow019#nNume3# ! 0; nSwl3 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 31 + nNume1;                  || Base Exenta
           |SI #dsmow019#nNume3# ! 0; nSwl4 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 44 + nNume1;                  || Base 110
           |SI #dsmow019#nNume3# ! 0; nSwl5 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 72 + nNume1;                  || Base Exenta 110
           |SI #dsmow019#nNume3# ! 0; nSwl6 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 57 + nNume1;
           |SI #dsmow019#nNume3# ! 0; nSwl7 = 0; nSwl0 = 0; |FINSI;

           nNume3 = 99 + nNume1;
           |SI #dsmow019#nNume3# ! 0; nSwl8 = 0; nSwl0 = 0; |FINSI;  || Base atrasos

           nNume3 = 112 + nNume1;
           |SI #dsmow019#nNume3# ! 0; nSwl9 = 0; nSwl0 = 0; |FINSI;  || Retencion atrasos

           nNume3 = 125 + nNume1;
           |SI #dsmow019#nNume3# ! 0; nSwl10 = 0; nSwl0 = 0; |FINSI;  || S.Social atrasos

           nNume3 = 151 + nNume1;
           |SI #dsmow019#nNume3# ! 0; nSwl12 = 0; nSwl0 = 0; |FINSI;  || S.Social Mod. 111

           nNume3 = 164 + nNume1;
           |SI #dsmow019#nNume3# ! 0; nSwl13 = 0; nSwl0 = 0; |FINSI;  || Base ILT

           nNume3 = 177 + nNume1;
           |SI #dsmow019#nNume3# ! 0; nSwl14 = 0; nSwl0 = 0; |FINSI;  || Retencion ILT

           nNume3 = 190 + nNume1;
           |SI #dsmow019#nNume3# ! 0; nSwl15 = 0; nSwl0 = 0; |FINSI;  || Base ILT Modelo

           nNume3 = 203 + nNume1;
           |SI #dsmow019#nNume3# ! 0; nSwl16 = 0; nSwl0 = 0; |FINSI;  || Retencion ILT Modelo
     |SIGUE;

    |SI #dsmoy019#147 ! "R";
      |SI nSwInf = 0; |Y nSwl0 = 0;
          informe = "dsmoy019";
          |SI #dsmoy019#2 ] 2016; informe = "ds16y019"; |FINSI;

          |INFOR informe;
          |SI FSalida ! 0;
              |MENAV "    No existe informe dsmoy019";
              |ERROR10;
              |ACABA;
          |FINSI;
          nSwInf = 1;
          nSwPie = 0;
     |FINSI;

     |SI nSwl0 = 0;
         |PRINT;
         nSwPie = 1;
     |FINSI;

  |FINSI;

  |SI #dsmow019#0 ! nCampo0; |O #dsmow019#1 ! aCampo1; |O #dsmow019#2 ! nCampo2; |O nQuantA = -1;
      nCampo0 = #dsmow019#0;
      aCampo1 = #dsmow019#1;
      nCampo2 = #dsmow019#2;
      nQuantA = 0;
  |FINSI;

  |SI #dsmow019#3 = "A";
      nQuantA = nQuantA + 1;
  |FINSI;

|| ... Sumas
  |SI nQuantSuma = 0;
     |PARA nNume1 = 1; |SI nNume1 [ 13; |HACIENDO nNume1 = nNume1 + 1;

           nNume2 = 25 + nNume1;   || base
           nNume3 = 5  + nNume1;
           nNume4 = 99 + nNume1;   || base Atrasos
           #dsmoy019#nNume2# = #dsmoy019#nNume2# + #dsmow019#nNume3# + #dsmow019#nNume4#;

           nNume2 = 38  + nNume1;   || retenciones
           nNume3 = 18  + nNume1;
           nNume4 = 112 + nNume1;   || retenciones Atrasos
           #dsmoy019#nNume2# = #dsmoy019#nNume2# + #dsmow019#nNume3# + #dsmow019#nNume4#;

           nNume2 = 51  + nNume1;   || S.Social
           nNume3 = 85  + nNume1;
           nNume4 = 125 + nNume1;   || S.Social Atrasos
           #dsmoy019#nNume2# = #dsmoy019#nNume2# + #dsmow019#nNume3# + #dsmow019#nNume4#;

           nNume2 = 64 + nNume1;   || Exenta
           nNume3 = 31 + nNume1;
           #dsmoy019#nNume2# = #dsmoy019#nNume2# + #dsmow019#nNume3#;

           nNume2 = 77 + nNume1;   || Tc1
           nNume3 = 44 + nNume1;
           #dsmoy019#nNume2# = #dsmoy019#nNume2# + #dsmow019#nNume3#;

           nNume2 = 103 + nNume1;   || Tc1  Exenta
           nNume3 = 72  + nNume1;
           #dsmoy019#nNume2# = #dsmoy019#nNume2# + #dsmow019#nNume3#;

           nNume2 = 90 + nNume1;   || Tc1
           nNume3 = 57 + nNume1;
           #dsmoy019#nNume2# = #dsmoy019#nNume2# + #dsmow019#nNume3#;

           nNume2 = 120 + nNume1;   || Liquido
           nNume3 = 138 + nNume1;
           #dsmoy019#nNume2# = #dsmoy019#nNume2# + #dsmow019#nNume3#;

           nNume2 = 133 + nNume1;   || Liquido
           nNume3 = 151 + nNume1;
           #dsmoy019#nNume2# = #dsmoy019#nNume2# + #dsmow019#nNume3#;

           nNume2 = 147 + nNume1;
           nNume3 = 164 + nNume1;
           #dsmoy019#nNume2# = #dsmoy019#nNume2# + #dsmow019#nNume3#;

           nNume2 = 160 + nNume1;
           nNume3 = 177 + nNume1;
           #dsmoy019#nNume2# = #dsmoy019#nNume2# + #dsmow019#nNume3#;

           nNume2 = 173 + nNume1;
           nNume3 = 190 + nNume1;
           #dsmoy019#nNume2# = #dsmoy019#nNume2# + #dsmow019#nNume3#;

           nNume2 = 186 + nNume1;
           nNume3 = 203 + nNume1;
           #dsmoy019#nNume2# = #dsmoy019#nNume2# + #dsmow019#nNume3#;
     |SIGUE;
  |FINSI;

  |SI #dsmow019#3 = "A"; |Y #dsmow019#4 = "  ";
      #dsmow019#4 = "99";
      nQuantA = 0;
      nCampo0 = 0;
      aCampo1 = "";
      nCampo2 = 0;
  |FINSI;
|FPRC;

|PROCESO cta_cotizacion;
|SI #labtraba#45 = "087";|O #labtraba#45 = "097";|O #labtraba#45 = "085";
                    |O #labtraba#45 = "064";|O #labtraba#45 = "065";
     |DDEFECTO #nomcenes;
     #nomcenes#0 = #labtraba#0;
     #nomcenes#13= #labtraba#77;
     |SI #labtraba#45 = "097";|O #labtraba#45 = "085";
          #nomcenes#1 = "87";
     |SINO;
          |SI #labtraba#45 = "065";
               #nomcenes#1 = "64";
          |SINO;
               #nomcenes#1 = #labtraba#45 % 2;
          |FINSI;
     |FINSI;
     |LEE 000#nomcenes.=;
     cta_co = #nomcenes#10;   || cta.cto. del centro de trabajo especial
|SINO;
     cta_co = #labempre#13;   || cta.cot. de la empresa
     |DDEFECTO #labcentr;
     #labcentr#0 = #labtraba#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;
     |SI #labempre#45 = "S";
          cta_co = #labcentr#10;   || cta.cot. centro de trabajo
     |FINSI;
|FINSI;
|FPRC;

|PROCESO ordena;
     |DDEFECTO #labempre;
     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;

     |DDEFECTO #nomconca;
     #nomconca#0 = #labtraba#87;
     |LEE 000#nomconca.=;

     |HAZ cta_cotizacion;
     #dsmoy019#117 = cta_co;
|FPRC;

|DEFBUCLE dsmow019_portc2;
     #dsmow019#1;
     ;
     00000, "            ", 0000, " ", "  ";
     99999, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, ordena, NULL, NULL, NULL, Imprime;
     #dsmow019#0, #dsmow019#99, #dsmow019#72;
|FIN;

|DEFBUCLE dsmow019_pornom;
     #dsmow019#1;
     ;
     00000, "            ", 0000, " ", "  ";
     99999, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, NULL, NULL, NULL, NULL, Imprime;
     #dsmow019#0, #dsmow019#5, #dsmow019#99, #dsmow019#72;
|FIN;

|DEFBUCLE dsmow019_porcod;
     #dsmow019#1;
     ;
     00000, "            ", 0000, " ", "  ";
     99999, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, NULL, NULL, NULL, NULL, Imprime;
     #dsmow019#0, #dsmow019#72;
|FIN;

|DEFBUCLE dsmow019_pornif;
     #dsmow019#1;
     ;
     00000, "            ", 0000, " ", "  ";
     99999, "zzzzzzzzzzzz", 9999, "z", "zz";
     ;
     NULL, Imprime;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |MENAV "0000 Recuerde seleccionar el papel de la impresora en Horizontal";

     enEjerIRPF = #dsmoy019#2;
     |HAZ BuscaEjerIRPF;

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aFichero = ("19" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dsmow019#aFichero#; |DELINDEX #dsmow019;

     aFichero = ("9x" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dsmow154#aFichero#; |DELINDEX #dsmow154;

     |SI aParam = "conta"; |Y #dsmoy019#22 = 3;
         #dsmoy019#22 = 4;
     |FINSI;

     |ABRE #dsmom107;
     |DDEFECTO #dsmom107;
     |LEE 001#dsmom107.p;
     |CIERRA #dsmom107;
     |SI #dsmoy019#2 > 2011; #dsmom107#22 = "S"; |FINSI;

     enEjer    = #dsmoy019#2;
     nDPeriodo = #dsmoy019#118;
     nHPeriodo = #dsmoy019#0;
     aEjer     = #dsmoy019#2;
     aEjer     = aEjer % -102;
     nEjer     = aEjer;
     nMod111   = 110;
     |SI #dsmoy019#2 > 2010; nMod111 = 111; |FINSI;

     aAlfa1 = #dsmoy019#2;
     aAlfa2 = #dsmoy019#118; |QBF aAlfa2; aAlfa2 = ("00" + aAlfa2) % -102;
     aAlfa1 = "01."+ aAlfa2 + "." + aAlfa1; fFecIni = aAlfa1;

     aAlfa1 = #dsmoy019#2;
     aAlfa2 = #dsmoy019#0; |QBF aAlfa2; aAlfa2 = ("00" + aAlfa2) % -102;
     aAlfa3 = "31.";
     |SI #dsmoy019#0 = 4; |O #dsmoy019#0 = 6; |O #dsmoy019#0 = 9; |O #dsmoy019#0 = 11;  aAlfa3 = "30.";  |FINSI;
     |SI #dsmoy019#0 = 2;
         aAlfa3 = "28."; nNume1 = #dsmoy019#2 / 4; nNume2 = (#dsmoy019#2/4) ! 0;
         |SI nNume1 = nNume2; aAlfa3 = "29."; |FINSI;
     |FINSI;
     aAlfa1 = aAlfa3 + aAlfa2 + "." + aAlfa1; fFecFin = aAlfa1;

     |ABRE #dsmow154;
     |ABRE #dsmow019;
     |SI aPathLaboral ! "";
         |ABRE #labtraba;
         |ABRE #labempre;
         |ABRE #nomconli;
         |ABRE #nomconca;
     |FINSI;

     |ABRET #dsmom026;
     |ABRE  #dsmom073;
     |ABRE  #dsmom006;
     |SI #dsmoy019#3 ! 0;
         |BUCLE agifigen;
         |BUCLE agifigen_110;
     |SINO;
         |PARA nPara1 = 5;  |SI nPara1 [ 16;  |HACIENDO nPara1 = nPara1 + 1;
               |SI #dsmoy019#nPara1# ! 0;
                   #dsmoy019#3 = #dsmoy019#nPara1#;
                   #dsmoy019#4 = #dsmoy019#nPara1#;
                   |BUCLE agifigen;
                   |BUCLE agifigen_110;
               |FINSI;
         |SIGUE;
     |FINSI;
     |CIERRA  #dsmom073;
     |CIERRA  #dsmom006;
     |CIERRAT #dsmom026;
     |CIERRA #dsmow019;
     |CIERRA #dsmow154;
     |SI aPathLaboral ! "";
         |CIERRA #labtraba;
         |CIERRA #labempre;
         |CIERRA #nomconli;
         |CIERRA #nomconca;
     |FINSI;

     nEmpresa = 0;
     nSwPie   = 0;
     nSwInf   = 0;
     |PDEFECTO #dsmoy019,  26,117;
     |PDEFECTO #dsmoy019, 121,133;
     |PDEFECTO #dsmoy019, 134,147;
     |PDEFECTO #dsmoy019, 148,200;

      nQuantA = -1;
      nCampo0 = 0;
      aCampo1 = "";
      nCampo2 = 0;

     |SI #dsmoy019#22 = 1; |BUCLE dsmow019_porcod; |FINSI;
     |SI #dsmoy019#22 = 2; |BUCLE dsmow019_pornom; |FINSI;
     |SI #dsmoy019#22 = 3; |BUCLE dsmow019_portc2; |FINSI;
     |SI #dsmoy019#22 = 4; |BUCLE dsmow019_pornif; |FINSI;

     |SI nEmpresa ! 0;
         |SI nSwPie = 1;
             |PIEINF;
             nSwPie = 0;
         |FINSI;
         |SI #dsmoy019#147 ! "N";
             |HAZ ElSegundoInf;
         |FINSI;
     |FINSI;

     |SI nSwInf = 1;
         |FININF;
     |FINSI;

     |FINIMP;
     |DELINDEX #dsmow019;
     |DELINDEX #dsmow154;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO; |QBF aParam;

     |ABRE #agitab99;
     #agitab99#0 = 110;
     |LEE 040#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;
     aCampo8F99 = #agitab99#8;
     |CIERRA #agitab99;

     aPathLaboral = "";
     |DBASS aBase;  |QBF aBase;
     aPathLaboral = aBase + "laboral/def/nomhicca.mas";
     |XABRE "E", aPathLaboral, nHandle;
     |SI FSalida < 0;
         aPathLaboral = "";
         |SI aParam ! "conta";
             |MENAV "    No existe la Gestion Laboral. ....";
             |ACABA;
         |FINSI;
     |FINSI;

     aPathConta = "";
     |DBASS aBase;  |QBF aBase;
     aPathConta = aBase + "contagen/def/canempre.mas";
     |XABRE "E", aPathConta, nHandle;
     |SI FSalida < 0;
         aPathConta = "";
         |SI aParam = "conta";
             |MENAV "    No existe la Gestion Contable ....";
             |ACABA;
         |FINSI;
     |FINSI;

     |SI aPathLaboral ! "";
         aPathLaboral = aBase + "laboral/fich/";
         |PATH_DAT #nomhicca#aPathLaboral#;
         |PATH_DAT #nomhicli#aPathLaboral#;
         |PATH_DAT #nomconli#aPathLaboral#;
         |PATH_DAT #nomconca#aPathLaboral#;
         |PATH_DAT #nomcorli#aPathLaboral#;
         |PATH_DAT #nomnotay#aPathLaboral#;
         |PATH_DAT #nomauto2#aPathLaboral#;
     |FINSI;
     |SI aPathConta  ! "";
         aPathConta = aBase + "contagen/fich/";
     |FINSI;

     |MANTE #dsmoy019;
|FPRO;
