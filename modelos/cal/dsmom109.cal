|FICHEROS;
   dsmom109 #109;
   dsmom107 #107;

   dsmom007 #7;
   dsmom117 #117;

   dsmow160 #160,MANTE;
|FIN;

|VARIABLES;
  nInkey  = 0;
  fFecha  = @;
  aAlfa1  = "";
  nEjer   = 0;
  nCampo  = 0;
  nCampo1 = 0;
  nCampo2 = 0;
  nCampo3 = 0;
  nCampo4 = 0;
  nCampo5 = 0;

  nNume1  = 0;
  nPara1  = 0;
  nPara2  = 0;
  nPara4  = 0;
  aAlfaCom = "";
  nEjerCarga = 0;
  nAnterior1 = 0;
  nAnterior2 = 0;

  aQueQuiero  = "";
  aNumCampos  = "";
  nNumCampos  = 0;
  nModo       = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO ClBaja7;
 #7#0 = 1;
 #7#1 = 1;
|FPRC;

|PROCESO ClAlta7;
 #7#0 = 3;
 #7#1 = 99;
|FPRC;

|PROCESO ClBaja117;
 #117#0 = 1;
 #117#1 = 1;
 #117#8 = nEjerCarga;
|FPRC;

|PROCESO ClAlta117;
 #117#0 = 3;
 #117#1 = 99;
 #117#8 = nEjerCarga;
|FPRC;

|PROCESO Consulto;
     |SI #160#0 [ 2010;
         |ABRE #7;
         |CONSULTA_F_CLAVE #1#7,ClBaja7,ClAlta7;
         |CIERRA #7;
         #160nCampo  = #7#0; |PINTA #160nCampo;
         #160nCampo1 = #7#1; |PINTA #160nCampo1;
     |SINO;
         |ABRE #117;
         |CONSULTA_F_CLAVE #1#117,ClBaja117,ClAlta117;
         |CIERRA #117;
         #160nCampo  = #117#0; |PINTA #160nCampo;
         #160nCampo1 = #117#1; |PINTA #160nCampo1;
     |FINSI;
|FPRC;

|PROCESO LeeLaCarga; |TIPO 0;
     nInkey = FSalida;
     |C_M #160Campo,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;
     |SI nInkey = 2; |ACABA; |FINSI;

     nAnterior1 = Contenido;

     nCampo  = Campo;
     nCampo1 = Campo + 1;
     |SI nCampo < 39;
         nCampo2 = nCampo + ( 20 - (nCampo - 6) / 2);
         nCampo4 = nCampo + ( 51 - (nCampo - 6) / 2);
     |SINO;
         |SI nCampo < 73;
             nCampo2 = nCampo + ( 12 - (nCampo - 39) / 2);
             nCampo4 = nCampo + ( 28 - (nCampo - 39) / 2);
         |SINO;
             nCampo2 = nCampo + ( 24 - (nCampo - 73) / 2);
             nCampo4 = nCampo + ( 36 - (nCampo - 73) / 2);
         |FINSI;
     |FINSI;

     |SI nInkey = 10;
         |HAZ Consulto;
     |FINSI;

     nNume1 = 24; |SI Campo [ 14; nNume1 = 14; |FINSI;
     |SI #160Campo = 0;
         |PARA nPara1 = Campo; |SI nPara1 [ nNume1; |HACIENDO nPara1 = nPara1 + 2;
               nPara2  = nPara1 + 1;
               nCampo2 = nPara1 + ( 20 - (nPara1 - 6) / 2);
               nPara4  = nPara1 + ( 51 - (nPara1 - 6) / 2);

               |SI nPara1 ! Campo;
                   |C_M #160nPara1,1,"N"; #160nPara1 = 0; |PINTA #160nPara1;
               |FINSI;
               |C_M #160nPara2, 1,"N"; #160nPara2  = 0;  |PINTA #160nPara2;
                                       #160nCampo2 = ""; |PINTA #160nCampo2;
               |C_M #160nPara4, 1,"N"; #160nPara4  = ""; |PINTA #160nPara4;
         |SIGUE;
     |SINO;
         |PARA nPara1 = Campo; |SI nPara1 [ nNume1; |HACIENDO nPara1 = nPara1 + 2;
               nPara2 = nPara1 + 1;
               nPara4 = nPara1 + ( 51 - (nPara1 - 6) / 2);
               |C_M #160nPara1,1,"S";
               |C_M #160nPara2,1,"S";
               |C_M #160nPara4,1,"S";
         |SIGUE;
     |FINSI;

|| ...Segunda Linea de Conceptos
     nCampo3 = Campo;
     |SI Campo [ 14;
         nCampo3 = 39;
     |SINO;
         |SI Campo [ 24;
             nCampo3 = 45;
         |FINSI;
     |FINSI;

     nNume1  = 49; |SI nCampo3 [ 43; nNume1 = 43; |FINSI;
     |SI #160Campo = 0;
         |PARA nPara1 = nCampo3; |SI nPara1 [ nNume1; |HACIENDO nPara1 = nPara1 + 2;
               nPara2  = nPara1 + 1;
               nCampo2 = nPara1 + ( 12 - (nPara1 - 39) / 2);
               nPara4  = nPara1 + ( 28 - (nPara1 - 39) / 2);

               |SI nPara1 ! Campo;
                   |C_M #160nPara1,1,"N"; #160nPara1 = 0; |PINTA #160nPara1;
               |FINSI;
               |C_M #160nPara2, 1,"N"; #160nPara2  = 0;  |PINTA #160nPara2;
                                       #160nCampo2 = ""; |PINTA #160nCampo2;
               |C_M #160nPara4, 1,"N"; #160nPara4  = ""; |PINTA #160nPara4;
         |SIGUE;
     |SINO;
         |PARA nPara1 = nCampo3; |SI nPara1 [ nNume1; |HACIENDO nPara1 = nPara1 + 2;
               nPara2  = nPara1 + 1;
               nPara4  = nPara1 + ( 28 - (nPara1 - 39) / 2);
               |C_M #160nPara1,1,"S";
               |C_M #160nPara2,1,"S";
               |C_M #160nPara4,1,"S";
         |SIGUE;
     |FINSI;

|| ...Tercera  Linea de Conceptos
     nCampo5 = Campo;
     |SI nCampo3 [ 39;
         nCampo5 = 73;
     |SINO;
         |SI nCampo3 [ 45;
             nCampo5 = 85;
         |FINSI;
     |FINSI;

     nNume1  = 96; |SI nCampo5 [ 83; nNume1 = 83; |FINSI;
     |SI #160Campo = 0;
         |PARA nPara1 = nCampo5; |SI nPara1 [ nNume1; |HACIENDO nPara1 = nPara1 + 2;
               nPara2  = nPara1 + 1;
               nCampo2 = nPara1 + ( 24 - (nPara1 - 73) / 2);
               nPara4  = nPara1 + ( 36 - (nPara1 - 73) / 2);

               |SI nPara1 ! Campo;
                   |C_M #160nPara1,1,"N"; #160nPara1 = 0; |PINTA #160nPara1;
               |FINSI;
               |C_M #160nPara2, 1,"N"; #160nPara2  = 0;  |PINTA #160nPara2;
                                       #160nCampo2 = ""; |PINTA #160nCampo2;
               |C_M #160nPara4, 1,"N"; #160nPara4  = ""; |PINTA #160nPara4;
         |SIGUE;
         |ACABA;
     |SINO;
         |PARA nPara1 = nCampo5; |SI nPara1 [ nNume1; |HACIENDO nPara1 = nPara1 + 2;
               nPara2  = nPara1 + 1;
               nPara4  = nPara1 + ( 36 - (nPara1 - 73) / 2);
               |C_M #160nPara1,1,"S";
               |C_M #160nPara2,1,"S";
               |C_M #160nPara4,1,"S";
         |SIGUE;
     |FINSI;

     |SI #160Campo ! 1; |Y #160Campo ! 3;
         |MENAV "    Introduzca una Agrupacion de Ventas (1 o 3) ";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO LeeLaCarga2;
    nInkey = FSalida;

    |C_M #160Campo,0,aAlfa1;
    |SI aAlfa1 = "N"; |ACABA; |FINSI;
    |SI nInkey = 2;   |ACABA; |FINSI;

    nAnterior2 = Contenido;
    nCampo  = Campo - 1;
    nCampo1 = Campo;
    |SI nCampo < 39;
        nCampo2 = nCampo + ( 20 - (nCampo - 6) / 2);
        nCampo4 = nCampo + ( 51 - (nCampo - 6) / 2);
    |SINO;
        |SI nCampo < 73;
            nCampo2 = nCampo + ( 12 - (nCampo - 39) / 2);
            nCampo4 = nCampo + ( 28 - (nCampo - 39) / 2);
        |SINO;
            nCampo2 = nCampo + ( 24 - (nCampo - 73) / 2);
            nCampo4 = nCampo + ( 36 - (nCampo - 73) / 2);
        |FINSI;
    |FINSI;

    |SI nInkey = 10;
       |HAZ Consulto;
    |FINSI;

    |SI #160nCampo = 1; aAlfa1 = "BI. y C."; |FINSI;
    |SI #160nCampo = 3; aAlfa1 = "V.OP. ";   |FINSI;

    |SI #160#0 [ 2010;
        |ABRE #7;
        #7#0 = #160nCampo;
        #7#1 = #160nCampo1;
        |LEE 001#7=;
        |SI FSalida ! 0;
            |CIERRA #7;
            |MENAV "    Error no Existe Agrupacion de IVA ";
            |ERROR;
            |ACABA;
        |FINSI;
        |CIERRA #7;
        #160nCampo2 = aAlfa1 + #7#2; |PINTA #160nCampo2;
    |SINO;
        |ABRE #117;
        #117#8 = nEjerCarga;
        #117#0 = #160nCampo;
        #117#1 = #160nCampo1;
        |LEE 001#117=;
        |SI FSalida ! 0;
            |CIERRA #117;
            |MENAV "    Error no Existe Agrupacion de IVA ";
            |ERROR;
            |ACABA;
        |FINSI;
        |CIERRA #117;
        #160nCampo2 = aAlfa1 + #117#2; |PINTA #160nCampo2;
     |FINSI;

     |SI #160nCampo ! nAnterior1; |O #160nCampo1 ! nAnterior2;

         #160nCampo4 = "+";
         |SI #160nCampo = 3; |Y #160nCampo1 = 14; #160nCampo4 = "-"; |FINSI;

         |PINTA #160nCampo4;
     |FINSI;
|FPRC;

|PROCESO LosSignos;
    |C_M #160Campo,0,aAlfa1;
    |SI aAlfa1 = "N";
        #160Campo = ""; |PINTA #160Campo;
        |ACABA;
    |FINSI;
    |SI nInkey = 2;   |ACABA; |FINSI;

    |SI #160Campo ! "+"; |Y  #160Campo ! "-";
        #160Campo = "+";
        |SI #160nCampo = 3; |Y #160nCampo1 = 14; #160Campo = "-"; |FINSI;
        |PINTA #160Campo;
    |FINSI;
|FPRC;

|PROCESO EjerCarga;
    nEjerCarga = #117#8;
|FPRC;

|DEFBUCLE EjerCarga;
  #117#1;
  ;
  2011,   1, 00;
  #109#0, 1, 99;
  ;
  NULL, EjerCarga;
|FIN;

|PROCESO Tipo12F160; |TIPO 12;
|FPRC;

|PROCESO Tipo0C0; |TIPO 0;
  nEjerCarga = 2010;
  |SI #109#0 ] 2011;
      |BUCLE EjerCarga;
  |FINSI;

  nModo = (FEntrada / 100) ! 0;
  |SI nModo = 1; |Y #109#0 ] 2014;
      #109#43 = 3; #109#44 = 4;  #109#69  = "+";
      #109#73 = 3; #109#74 = 16; #109#109 = "+";
      #109#75 = 3; #109#76 = 17; #109#110 = "+";
  |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
  |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
        #160nPara1 = #109nPara1;
  |SIGUE;

  |PINPA #0#160;
  |PINDA #0#160;

  |ENDATOS #2#160;

  |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
        #109nPara1 = #160nPara1;
  |SIGUE;
|FPRC;

|PROCESO Baja109;
 |SI FSalida = "POSICION";
     #109#0 = nEjer;
 |SINO;
     #109#0 = 2000;
 |FINSI;
|FPRC;

|PROCESO Alta109;
     #109#0 = 2999;
|FPRC;

|PROGRAMA;
     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     aAlfaCom = #107#12;

     |SI #107#9 = "N";
         |MENAV "    EN CONTROL ESTA INFORMADO NO CALCULAR PRORRATA.";
         |ACABA;
     |FINSI;

     fFecha = ~;
     aAlfa1 = fFecha;
     aAlfa1 = aAlfa1 % -104;
     nEjer  = aAlfa1;

     |ABRE #109
     |LEE 101#109p;
     |SI FSalida ! 0;
         |DDEFECTO #109;
         #109#0 = nEjer;
         #109#1 = aAlfaCom;
         #109#26 = "BI.y C. Regimen Ordinario.";
         #109#31 = "V.OP. Otras Operaciones exentas con derecho a deduccion";
         #109#32 = "V.OP. Operaciones exentas sin derecho a deduccion";
         |GRABA 020#109b;
     |FINSI;
     |LIBERA #109;
     |CIERRA #109;

      aQueQuiero = "|NC";
      aNumCampos = #dsmom109#aQueQuiero#;
      nNumCampos = aNumCampos;
      nNumCampos = nNumCampos - 1;

     |CLS;
     |CABEZA "Control de Prorratas";

     |PINPA #0#109;
     |ENTLINEAL #1#109, -1, 2, 22, 0, Baja109, Alta109;
|FPRO;
