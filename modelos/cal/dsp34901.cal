|FICHEROS;
     dsmozpas #0;
     dsmom004 #4;
     dsmom008 #8;
     dsmom030 #30;
     dsmom032 #32;
     dsmom095 #95;
     dsmoc349 #349;
     dsmom069;

     :/contagen/def/canempre #101;
     :/contagen/def/camaniva #102;
     :/contagen/def/caivalin #103;
     :/contagen/def/caivaasi #104;
     :/contagen/def/caivam03 #105;
     :/contagen/def/caclipro #106;
     :/contagen/def/calibros #107;

     :/basica/def/agicen14 #214;

     &regisnif@ #709;
     dsmow013 #999;

     espejo1@ #1300;
|FIN;

|VARIABLES;
     aAlfa1         = "";
     aAlfa2         = "";
     aAlfa          = "";
     aPathModelo    = "";
     aDef           = "";
     aTipo          = "";
     aTriangul      = "";
     aEspecial      = "";
     aFichero       = "";
     aClaveOp       = "";
     aNombre        = "";
     aPais          = "";

     nEjer          = 0;
     nDPeriodo      = 0;
     nHPeriodo      = 0;
     nCampo         = 0;
     nCampo1        = 0;
     nCampo11       = 0;
     nCampo2        = 0;
     nCampo22       = 0;
     nCampo3        = 0;
     nCampo33       = 0;
     nSwEsta        = 0;
     nGrupo         = 0;
     nSubGrupo      = 0;
     nDepar         = 0;
     nBaseImpo      = 0;
     nPorce         = 0;
     nCuota         = 0;
     nPeriodo       = 0;
     nModelo        = 0;
     nSwPasa        = 0;
     nCompensado    = 0;
     nModBucle      = 0;
     nAnyo          = 0;
     nEl340         = 0;
     nReg           = 0;
     nChequeaNif    = 0;

     nVarios1       = 0;
     nVarios2       = 0;
     nImprime       = 0;
     nEsRecti       = 0;

     nSwSi  = 0;
     nNume  = 0;
     nNume1 = 0;
     nNume2 = 0;
     nCanti = 0;
     nDepartamento = 0;

     nError     = 0;
     nBaffer    = 0;
     nTotalLinea= 0;
     nConta     = 0;
     nOpcion    = 0;
     nMesCont   = 0;

     aTabla     = "";
     aDestino   = "";
     nTp100     = 0;

     &eaAlfa       = "";
     &eaLibro      = "";
     &eaReg        = "";
     &eaLib340     = "";
     &eaReg340     = "";
     &eaError      = "";
     nSwCuotaNeg   = 0;

     &enEmpAmor    = 0;
     &enEjeAmor    = 0;
     &enDActAmor   = 0;
     &enHActAmor   = 0;
     &enImpRegul   = 0;
     &enP2013      = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO GrabaIVASAnt;
     nSwEsta = 0;
     |PARA nCampo22 = 38;  |SI nCampo22 [ 56;  |HACIENDO nCampo22 = nCampo22 + 3;
           nCampo11 = nCampo22 - 1;
           nCampo33 = nCampo22 + 1;
           |SI #349nCampo22 = #105nCampo2;
               #349nCampo11 = #349nCampo11 + #105nCampo1;
               #349nCampo22 = #105nCampo2;
               #349nCampo33 = #349nCampo33 + #105nCampo3;
               nSwEsta = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwEsta = 0;
         |PARA nCampo22 = 38;  |SI nCampo22 [ 56;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo22 = 0; |Y #349nCampo11 = 0;  |Y #349nCampo33 = 0;
                   #349nCampo11 = #349nCampo11 + #105nCampo1;
                   #349nCampo22 = #105nCampo2;
                   #349nCampo33 = #349nCampo33 + #105nCampo3;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;
         #349#55 = #349#55 + #105nCampo1;
         #349#56 = 0;
         #349#57 = #349#57 + #105nCampo3;
     |FINSI;

     #349#27 = #349#37 + #349#40 + #349#43 + #349#46 + #349#49 + #349#52 + #349#55;

     nSwEsta = 0;
     |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
           nCampo11 = nCampo22 - 1;
           nCampo33 = nCampo22 + 1;
           |SI #349nCampo22 = #105nCampo2;
               #349nCampo11 = #349nCampo11 + #105nCampo1;
               #349nCampo22 = #105nCampo2;
               #349nCampo33 = #349nCampo33 + #105nCampo3;
               nSwEsta = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwEsta = 0;
         |PARA nCampo22 = 29;  |SI nCampo22 [ 35;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo22 = #105nCampo2;
                   #349nCampo11 = #349nCampo11 + #105nCampo1;
                   #349nCampo22 = #105nCampo2;
                   #349nCampo33 = #349nCampo33 + #105nCampo3;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;
         |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo22 = 0; |Y #349nCampo11 = 0;  |Y #349nCampo33 = 0;
                   #349nCampo11 = #349nCampo11 + #105nCampo1;
                   #349nCampo22 = #105nCampo2;
                   #349nCampo33 = #349nCampo33 + #105nCampo3;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;
         |PARA nCampo22 = 29;  |SI nCampo22 [ 35;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo22 = 0; |Y #349nCampo11 = 0;  |Y #349nCampo33 = 0;
                   #349nCampo11 = #349nCampo11 + #105nCampo1;
                   #349nCampo22 = #105nCampo2;
                   #349nCampo33 = #349nCampo33 + #105nCampo3;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;
         #349#34 = #349#34 + #105nCampo1;
         #349#35 = 0;
         #349#36 = #349#35 + #105nCampo3;
     |FINSI;

     #349#22 = #349#10 + #349#13 + #349#16 + #349#19 + #349#28 + #349#31 + #349#34;
|FPRC;

|PROCESO Completo105;
     nTp100 = 0;
     |ABRE #103;
     #103#0 = #102#0;
     #103#1 = #102#1;
     #103#2 = 1;
     |LEE 041#103];
     |SI FSalida = 0; |Y #103#0 = #102#0; |Y #103#1 = #102#1;
         nTp100 = #103#7;
     |FINSI;
     |CIERRA #103;
     |SI #105#10 = 0; |Y #105#13 = 0; |Y #105#16 = 0; |Y #105#19 = 0;
        |Y #105#22 = 0; |Y #105#25 = 0; |Y #105#28 = 0;
          |SI #105#9 ! 0;
              #105#10 = nTp100;
              #105#11 = (#105#9 % #105#10) ! 2;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Graba349Rec;
     nModelo       = enModelo;
     enTipoEntrada = 95;
     enModelo      = 349;
     eaNombreAct   = #999#6;
     enModelo349   = #999#7;
     |SUB_EJECUTA "dsmoc349";

     eaCodNif = #102#14;
     |HAZ LeeNifs;

     |ABRE #349;
     #349#0  = enEmpresa;
     #349#1  = enEjer;
     #349#2  = nMesCont;
     #349#3  = enModelo;
     #349#4  = enComplem;
     #349#5  = enActividad;
     #349#6  = aTipo;
     #349#7  = #102#14;
     #349#25 = #105#5; || Ejercicio Declarado;
     #349#26 = #105#4;
     |LEE 101#349=;
     |SI FSalida ! 0;
         |DDEFECTO #349;
         #349#0  = enEmpresa;
         #349#1  = enEjer;
         #349#2  = nMesCont;
         #349#3  = enModelo;
         #349#4  = enComplem;
         #349#5  = enActividad;
         #349#6  = aTipo;
         #349#7  = #102#14;
         #349#25 = #105#5; || Ejercicio Declarado;
         #349#26 = #105#4;

         |SI #709#12 !  "   ";  #349#8  = #709#12;  |FINSI;
         #349#9  = #709#1;
         |GRABA 020#349b;
     |FINSI;

     |SI #349#6 = "AR"; |O #349#6 = "IR";
         nSwEsta = 0;
         |PARA nCampo2 = 10;  |SI nCampo2 [ 28;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #105nCampo1 ! 0;  |O #105nCampo3 ! 0;
                   |HAZ GrabaIVASAnt;
               |FINSI;
         |SIGUE;
     |SINO;
         #349#22 = #349#22 + #105#6;
         #349#27 = #349#27 + #105#6;
     |FINSI;

     #349#24 = "-";

     |GRABA 020#349a;
     |LIBERA #349;
     |CIERRA #349;

     enModelo = nModelo;
|FPRC;

|PROCESO Graba349;
     nModelo       = enModelo;
     enTipoEntrada = 95;
     enModelo      = 349;
     eaNombreAct   = #999#6;
     enModelo349   = #999#7;
     |SUB_EJECUTA "dsmoc349";

     eaCodNif = #102#14;
     |HAZ LeeNifs;

     |ABRE #349;
     #349#0  = enEmpresa;
     #349#1  = enEjer;
     #349#2  = nMesCont;
     #349#3  = enModelo;
     #349#4  = enComplem;
     #349#5  = enActividad;
     #349#6  = aTipo;
     #349#7  = #102#14;
     #349#25 = 0;
     #349#26 = 0;
     |SI aTipo = "ER"; |O aTipo = "AR";  |O aTipo = "SR";  |O aTipo = "IR";
        |O aTipo = "MR"; |O aTipo = "HR";
         |SI #105#5 ! 0;
             #349#25 = #105#5; || Ejercicio Declarado;
             #349#26 = #105#4;
         |FINSI;
     |FINSI;
     |LEE 101#349=;
     |SI FSalida ! 0;
         |DDEFECTO #349;
         #349#0  = enEmpresa;
         #349#1  = enEjer;
         #349#2  = nMesCont;
         #349#3  = enModelo;
         #349#4  = enComplem;
         #349#5  = enActividad;
         #349#6  = aTipo;
         #349#7  = #102#14;
         #349#25 = 0;
         #349#26 = 0;
         |SI aTipo = "ER"; |O aTipo = "AR";  |O aTipo = "SR";  |O aTipo = "IR";
             |O aTipo = "MR"; |O aTipo = "HR";
                |SI #105#5 ! 0;
                    #349#25 = #105#5; || Ejercicio Declarado;
                    #349#26 = #105#4;
                |FINSI;
         |FINSI;
         |SI #709#12 !  "   ";  #349#8  = #709#12;  |FINSI;
         #349#9  = #709#1;
         |GRABA 020#349b;
     |FINSI;

     |SI #349#6 = "A ";  |O #349#6 = "I ";
      |O #349#6 = "AR";  |O #349#6 = "IR";
         nSwEsta = 0;
         |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #349nCampo2 = nPorce;
                   #349nCampo1 = #349nCampo1 + nBaseImpo;
                   #349nCampo2 = nPorce;
                   #349nCampo3 = #349nCampo3 + nCuota;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;

         |SI nSwEsta = 0;
             |PARA nCampo2 = 29;  |SI nCampo2 [ 35;  |HACIENDO nCampo2 = nCampo2 + 3;
                   nCampo1 = nCampo2 - 1;
                   nCampo3 = nCampo2 + 1;
                   |SI #349nCampo2 = nPorce;
                       #349nCampo1 = #349nCampo1 + nBaseImpo;
                       #349nCampo2 = nPorce;
                       #349nCampo3 = #349nCampo3 + nCuota;
                       nSwEsta = 1;
                       |SAL;
                   |FINSI;
             |SIGUE;
         |FINSI;

         |SI nSwEsta = 0;
             |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
                   nCampo1 = nCampo2 - 1;
                   nCampo3 = nCampo2 + 1;
                   |SI #349nCampo2 = 0; |Y #349nCampo1 = 0;  |Y #349nCampo3 = 0;
                       #349nCampo1 = #349nCampo1 + nBaseImpo;
                       #349nCampo2 = nPorce;
                       #349nCampo3 = #349nCampo3 + nCuota;
                       nSwEsta = 1;
                       |SAL;
                   |FINSI;
              |SIGUE;
         |FINSI;

         |SI nSwEsta = 0;
             |PARA nCampo2 = 29;  |SI nCampo2 [ 35;  |HACIENDO nCampo2 = nCampo2 + 3;
                   nCampo1 = nCampo2 - 1;
                   nCampo3 = nCampo2 + 1;
                   |SI #349nCampo2 = 0; |Y #349nCampo1 = 0;  |Y #349nCampo3 = 0;
                       #349nCampo1 = #349nCampo1 + nBaseImpo;
                       #349nCampo2 = nPorce;
                       #349nCampo3 = #349nCampo3 + nCuota;
                       nSwEsta = 1;
                       |SAL;
                   |FINSI;
              |SIGUE;
         |FINSI;

         |SI nSwEsta = 0;
             #349#34 = #349#34 + nBaseImpo;
             #349#35 = 0;
             #349#36 = #349#36 + nCuota;
         |FINSI;

         #349#22 = #349#10 + #349#13 + #349#16 + #349#19 + #349#28 + #349#31 + #349#34;
     |SINO;
         #349#22 = #349#22 + nBaseImpo;
     |FINSI;

     #349#23 = aTriangul;

     |GRABA 020#349a;
     |LIBERA #349;
     |CIERRA #349;

     enModelo = nModelo;
|FPRC;

|PROCESO PonCasilla349;
     nDepartamento = nDepar;
     |SI #999#1 ! nDepar;
         |SI #103#29 = "N";  || no es iva comun
             |ACABA;
         |FINSI;
         |SI enActividad ! enActPrinci;  || si no es la principal, nada
             |ACABA;
         |FINSI;
         nNume = enActividad;
         enActividad = nDepar;
         |HAZ eTipoEmpModelo;
         enActividad = nNume;
         |SI enSwTipoAct = 1;
             |ACABA;            || se pasa en la actividad correspondiente
         |FINSI;
         nDepartamento = enActividad;
     |FINSI;

     |SI #103#5 = "N";  |ACABA;  |FINSI;

     || Clave A

     |SI nEsRecti = 0;
         aTipo = "";
     |FINSI;

     |SI nGrupo = 1;  |Y nSubGrupo = 5;
         |SI nPorce = 0;  |Y nCuota = 0;  |ACABA;  |FINSI;

         |SI nEsRecti = 0;  aTipo = "A";  |FINSI;
         |HAZ Graba349;
     |FINSI;

     |SI nGrupo = 8;  |Y nSubGrupo = 2;
         |SI nPorce = 0;  |Y nCuota = 0;  |ACABA;  |FINSI;

         |SI nEsRecti = 0;  aTipo = "A";  |FINSI;
         |HAZ Graba349;
     |FINSI;

     || Clave I

     |SI nGrupo = 1;  |Y nSubGrupo = 6;
         |SI nPorce = 0;  |Y nCuota = 0;  |ACABA;  |FINSI;

         |SI #30#72 = "N";  |ACABA;  |FINSI;

         |SI nEsRecti = 0;  aTipo = "I";  |FINSI;
         |HAZ Graba349;
     |FINSI;

     |SI nGrupo = 1;  |Y nSubGrupo = 15; |Y enEjer ] 2014;
         |SI nPorce = 0;  |Y nCuota = 0;  |ACABA;  |FINSI;

         |SI #30#72 = "N";  |ACABA;  |FINSI;

         |SI nEsRecti = 0;  aTipo = "I";  |FINSI;
         |HAZ Graba349;
     |FINSI;

     |SI nGrupo = 8;  |Y nSubGrupo = 3;
         |SI nPorce = 0;  |Y nCuota = 0;  |ACABA;  |FINSI;

         |SI #30#72 = "N";  |ACABA;  |FINSI;

         |SI nEsRecti = 0;  aTipo = "I";  |FINSI;
         |HAZ Graba349;
     |FINSI;

     || Clave E

     |SI nGrupo = 3;  |Y nSubGrupo = 9;

         |SI nEsRecti = 0;
             aTipo = "E";
             |SI aEspecial ! ""; aTipo = aEspecial; |FINSI;
         |FINSI;

         |HAZ Graba349;
     |FINSI;

     || Clave S

     |SI nGrupo = 3;  |Y nSubGrupo = 4; |Y enEjer < 2014;
         |SI enEjer < 2012; |O #30#72 = "S";
             |SI nEsRecti = 0;  aTipo = "S";  |FINSI;
             |HAZ Graba349;
         |FINSI;
     |FINSI;

     |SI nGrupo = 3;  |Y nSubGrupo = 16;

         |SI nEsRecti = 0;  aTipo = "S";  |FINSI;
         |HAZ Graba349;
     |FINSI;
|FPRC;

|PROCESO Grupo1_349;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 1;
     nSubGrupo = #30#26;
     |SI enEjer ] 2014; |Y nSubGrupo = 6;
         |SI #30#72 = "S"; nSubGrupo = 15; |FINSI;
     |FINSI;

     |HAZ PonCasilla349;
|FPRC;

|PROCESO Grupo2_349;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 2;
     nSubGrupo = #30#28;
     |HAZ PonCasilla349;
|FPRC;

|PROCESO Grupo3_349;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 8;
     nSubGrupo = #30#30;
     |HAZ PonCasilla349;
|FPRC;

|PROCESO Grupo4_349;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 9;
     nSubGrupo = #30#32;
     |HAZ PonCasilla349;
|FPRC;

|PROCESO Grupo5_349;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 3;
     nSubGrupo = #30#34;
     |HAZ PonCasilla349;
|FPRC;

|PROCESO Grupo6_349;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 4;
     nSubGrupo = #30#36;
     |HAZ PonCasilla349;
|FPRC;

|PROCESO LeoAuxMod309;
 |SI enP2013 = 0;
     |SI #30#26 = 0; |Y #30#28 = 0; |Y #30#30 = 0;
        |Y #30#32 = 0; |Y #30#34 = 0;  |Y #30#36 = 0;
           |DDEFECTO #32;
           #32#0 = #30#0;
           |LEE 041#32=;
           |SI FSalida = 0;
               |SI #32#2 = "A"; #30#26 =  5; |FINSI;
               |SI #32#2 = "I"; #30#26 =  6; |FINSI;
               |SI #32#2 = "E"; #30#34 =  9; |FINSI;
               |SI #32#2 = "S"; #30#34 = 16; |FINSI;
           |FINSI;
     |FINSI;
 |FINSI;

 aEspecial = "";
 aTriangul = "";
 #dsmom069#0 = #dsmom030#0;
 |LEE 041#dsmom069.=;
 |SI FSalida = 0;
     |SI #dsmom069#2 = "A"; #dsmom030#26 =  5; |FINSI;
     |SI #dsmom069#2 = "I"; #dsmom030#26 =  6; |FINSI;
     |SI #dsmom069#2 = "E"; #dsmom030#34 =  9; |FINSI;
     |SI #dsmom069#2 = "S"; #dsmom030#34 = 16; |FINSI;
     |SI #dsmom069#2 = "M"; #dsmom030#34 =  9; aEspecial = "M"; |FINSI;
     |SI #dsmom069#2 = "H"; #dsmom030#34 =  9; aEspecial = "H"; |FINSI;
     |SI #dsmom069#2 = "T"; #dsmom030#34 =  9; aEspecial = "T"; aTriangul = "X"; |FINSI;
     || aTriangul    = #dsmom069#3;
     #dsmom030#72 = #dsmom069#4;

     |SI enEjer < 2018;
         |SI aEspecial = "T"; aEspecial = "E"; aTriangul = "X"; |FINSI;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO LeeLinea349;
     aAlfa1 = #103#30; |QBF aAlfa1; |SI aAlfa1 = ""; #103#30 = #102#10; |FINSI;
     |SI aMulDep = "S";
         nDepar = #103#30;
         |SI nDepar = 0;  nDepar = 1;   |FINSI;

         |ABRE #214;
         #214#0 = #999#0;
         #214#1 = nDepar;
         |LEE 040#214=;
         |SI FSalida ! 0;  nDepar = 1;  |FINSI;
         |CIERRA #214;
         nDepartamento = nDepar;
     |FINSI;

     nSwPasa = 0;
     #30#0 = #103#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #999#10 = 309;  ||aqui
         #30#4 = "S";
         #30#28 = 8;
     |FINSI;

     |HAZ LeoAuxMod309;

     |SI #30#4 = "N";  |ACABA;  |FINSI;

     |SI #30#26 ! 0; nSwPasa = 1;  |HAZ Grupo1_349;  |FINSI;
     |SI #30#28 ! 0; nSwPasa = 1;  |HAZ Grupo2_349;  |FINSI;
     |SI #30#30 ! 0; nSwPasa = 1;  |HAZ Grupo3_349;  |FINSI;
     |SI #30#32 ! 0; nSwPasa = 1;  |HAZ Grupo4_349;  |FINSI;
     |SI #30#34 ! 0; nSwPasa = 1;  |HAZ Grupo5_349;  |FINSI;
     |SI #30#36 ! 0; nSwPasa = 1;  |HAZ Grupo6_349;  |FINSI;
|FPRC;

|DEFBUCLE caivalin;
     #103#1;
     ;
     #102#0, #102#1, 01;
     #102#0, #102#1, 99;
     ;
     NULL, LeeLinea349;
|FIN;

|PROCESO LeeCabecera349;
     #107#0 = #102#0;
     |LEE 000#107=;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;

     nDepar = #102#10;
     |SI aMulDep ! "S";
         |SI nDepar = 0;  nDepar = 1;   |FINSI;
     |FINSI;

     |ABRE #214;
     #214#0 = #999#0;
     #214#1 = nDepar;
     |LEE 040#214=;
     |SI FSalida ! 0;  nDepar = 1;  |FINSI;
     |CIERRA #214;

     |ABRE #105;
     |DDEFECTO #105;
     #105#0 = #102#0;
     #105#1 = #102#1;
     |LEE 040#105=;
     |SI FSalida ! 0;  |DDEFECTO #105;  |FINSI;
     |CIERRA #105;

     nEsRecti = 0;
     nMesCont = #102#5;
     aTipo    = "";

     |SI #105#6 ! 0;   |Y #105#8 = 0;  |Y nDepar = #999#1;
         #30#0 = #102#29;
         |LEE 040#30=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |HAZ LeoAuxMod309;

         |SI #30#26 =  5;                  aTipo = "AR";  |FINSI;
         |SI #30#26 =  6; |Y #30#72 = "S"; aTipo = "IR";  |FINSI;

         |SI #30#30 = 2;  aTipo = "AR";  |FINSI;
         |SI #30#30 = 3;  aTipo = "IR";  |FINSI;

         |SI #30#34 = 9;                    aTipo = "ER";  |FINSI;
         |SI #30#34 = 9; |Y aEspecial ! ""; aTipo = aEspecial + "R";  |FINSI;
         |SI #30#34 = 16;                   aTipo = "SR";  |FINSI;
         |SI #30#34 = 4;  |Y enEjer < 2014;
             aTipo = "SR";
             |SI enEjer ] 2012; |Y #30#72 ! "S"; aTipo = "";  |FINSI;
         |FINSI;

         |SI aTipo ! "";
             nEsRecti = 1;
             |HAZ Completo105;
             |HAZ Graba349Rec;
         |FINSI;
     |FINSI;

     nDepartamento = nDepar;

     nVarios1 = 0;
     nVarios2 = 0;
     |BUCLE caivalin;

     |SI #999#1 ! nDepartamento;
         |ACABA;
     |FINSI;
|FPRC;

|DEFBUCLE camaniva;
     #102#1;
     5;
     00, 0000000000, nDPeriodo;
     99, 9999999999, nHPeriodo;
     ;
     NULL, LeeCabecera349;
|FIN;

|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

|PROCESO Compensa349;
     #349#0  = #1300#0;
     #349#1  = #1300#1;
     #349#2  = #999#3;
     #349#3  = #1300#3;
     #349#4  = #1300#4;
     #349#5  = #1300#5;
     #349#6  = #1300#6;
     #349#7  = #1300#7;
     #349#25 = #1300#25;
     #349#26 = #1300#26;
     |LEE 101#349=;
     |SI FSalida = 0;
         #349#22 = #349#22 - #1300#22;
         #349#27 = #349#27 - #1300#27;

         |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
                      nCampo11 = nCampo22 - 1;
                      nCampo33 = nCampo22 + 1;
                      |SI #349nCampo22 = #1300nCampo2;
                          #349nCampo11 = #349nCampo11 - #1300nCampo1;
                          #349nCampo33 = #349nCampo33 - #1300nCampo3;
                          |SAL;
                      |FINSI;
                |SIGUE;
         |SIGUE;

         |PARA nCampo2 = 29;  |SI nCampo2 [ 35;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |PARA nCampo22 = 29;  |SI nCampo22 [ 35;  |HACIENDO nCampo22 = nCampo22 + 3;
                      nCampo11 = nCampo22 - 1;
                      nCampo33 = nCampo22 + 1;
                      |SI #349nCampo22 = #1300nCampo2;
                          #349nCampo11 = #349nCampo11 - #1300nCampo1;
                          #349nCampo33 = #349nCampo33 - #1300nCampo3;
                          |SAL;
                      |FINSI;
                |SIGUE;
         |SIGUE;

         |GRABA 020#349a;
         |LIBERA #349;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc349;
     #1300#1010;
     ;
     #999#0, #999#2, nPeriodo, 349, 0, #999#1, "A ", 0000, 00, "            ";
     #999#0, #999#2, nPeriodo, 349, 0, #999#1, "ZZ", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Compensa349;
|FIN;

|PROCESO BorraCero349;
     |SI #349#22 < 0;  nSwCuotaNeg = 1; |FINSI;
     |SI #349#22 ! 0;  |ACABA;          |FINSI;
     |SI #349#27 ! 0;  |ACABA;          |FINSI;

     |BORRA 020#349a;
     |LIBERA #349;
|FPRC;

|DEFBUCLE dsmoc349Cero;
     #349#1;
     ;
     #999#0, #999#2, #999#3, 349, 0, #999#1, "A ", 0000, 00, "            ";
     #999#0, #999#2, #999#3, 349, 0, #999#1, "ZZ", 9999, 99, "zzzzzzzzzzzz";
     be;
     NULL, BorraCero349;
|FIN;

|PROCESO Contab349;
     enEmpresa   = #999#0;
     enEjer      = #999#2;
     enSwOpPar   = 0;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         aAlfa = #999#2;
         aAlfa = aAlfa % -102;
         nEjer = aAlfa;

         |ABRE #101;
         |SELECT #4#101;
         #101#2  = #999#0;
         #101#26 = nEjer;
         |LEE 040#101=;
         |SI FSalida ! 0;  |CIERRA #101;  |ACABA;   |FINSI;
         |CIERRA #101;

         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";

         enEmpresa  = #101#2;
         enPerConta = #101#3;
         eaLaMonEmp = #101#28;
     |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
     |FINSI;
     |HAZ EnConversor;

     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;
     |PATH_DAT #105 aPathConta;
     |PATH_DAT #106 aPathConta;
     |PATH_DAT #107 aPathConta;

     |ABRE #104;
     |LEE 040#104p;
     |SI FSalida ! 0;  |DDEFECTO #104;  |FINSI;
     |CIERRA #104;
     aMulDep = #104#132;

     |SI enEjer [ 2009;
         |SI #104#46 = "T";
             |SI enPeriodo = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI enPeriodo = 2;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI enPeriodo = 3;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI enPeriodo = 4;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI enPeriodo = 5;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI enPeriodo = 6;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI enPeriodo = 7;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 8;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 9;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 10;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI enPeriodo = 11;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI enPeriodo = 12;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SINO;
             |SI enPeriodo = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI enPeriodo = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI enPeriodo = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI enPeriodo = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
             |SI enPeriodo = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI enPeriodo = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
             |SI enPeriodo = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
             |SI enPeriodo = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI enPeriodo = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
             |SI enPeriodo = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
             |SI enPeriodo = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
         |FINSI;
     |SINO;
         nDPeriodo = 1;
         nHPeriodo = 12;

         |SI #4#22 = "T";
             |SI enPeriodo = 1;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 2;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 4;   nDPeriodo = 4;  nHPeriodo = 6;   |FINSI;
             |SI enPeriodo = 5;   nDPeriodo = 4;  nHPeriodo = 6;   |FINSI;
             |SI enPeriodo = 6;   nDPeriodo = 4;  nHPeriodo = 6;   |FINSI;
             |SI enPeriodo = 7;   nDPeriodo = 7;  nHPeriodo = 9;   |FINSI;
             |SI enPeriodo = 8;   nDPeriodo = 7;  nHPeriodo = 9;   |FINSI;
             |SI enPeriodo = 9;   nDPeriodo = 7;  nHPeriodo = 9;   |FINSI;
             |SI enPeriodo = 10;  nDPeriodo = 10;  nHPeriodo = 12;  |FINSI;
             |SI enPeriodo = 11;  nDPeriodo = 10;  nHPeriodo = 12;  |FINSI;
             |SI enPeriodo = 12;  nDPeriodo = 10;  nHPeriodo = 12;  |FINSI;
         |SINO;
             |ABRE #95;
             #95#0 = enEmpresa;
             #95#1 = enEjer;
             |LEE 000#95=;
             |SI FSalida ! 0;  |DDEFECTO #95;  |FINSI;
             |CIERRA #95;

             |SI enPeriodo = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;

             |SI enPeriodo = 2;
                 nDPeriodo = 2;  nHPeriodo = 2;
                 |SI #95#27 = "S";  nDPeriodo = 1;  |FINSI;
             |FINSI;

             |SI enPeriodo = 3;   nDPeriodo = 3;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 4;   nDPeriodo = 4;  nHPeriodo = 4;   |FINSI;

             |SI enPeriodo = 5;
                 nDPeriodo = 5;  nHPeriodo = 5;
                 |SI #95#28 = "S";  nDPeriodo = 4;  |FINSI;
             |FINSI;

             |SI enPeriodo = 6;   nDPeriodo = 6;  nHPeriodo = 6;   |FINSI;
             |SI enPeriodo = 7;   nDPeriodo = 7;  nHPeriodo = 7;   |FINSI;

             |SI enPeriodo = 8;
                 nDPeriodo = 8;  nHPeriodo = 8;
                 |SI #95#29 = "S";  nDPeriodo = 7;  |FINSI;
             |FINSI;

             |SI enPeriodo = 9;   nDPeriodo = 9;  nHPeriodo = 9;   |FINSI;
             |SI enPeriodo = 10;  nDPeriodo = 10;  nHPeriodo = 10;  |FINSI;

             |SI enPeriodo = 11;
                 nDPeriodo = 11;  nHPeriodo = 11;
                 |SI #95#30 = "S";  nDPeriodo = 10;  |FINSI;
             |FINSI;

             |SI enPeriodo = 12;  nDPeriodo = 12;  nHPeriodo = 12;  |FINSI;
         |FINSI;
     |FINSI;

     |ABRE #30;
     |ABRE #32;
     |ABRE #dsmom069;
     |ABRE #107;
     |BUCLE camaniva;
     |CIERRA #107;
     |CIERRA #dsmom069;
     |CIERRA #32;
     |CIERRA #30;

     |SI enSwPartido = 1;
         enSwOpPar   = 2;
         |HAZ FinalPartido;
     |FINSI;
|FPRC;

|PROCESO PaseConta349;
     |SI enActividad ! 99;
         |HAZ Contab349;
     |FINSI;

     |SI enEjer [ 2009;
        |SI #999#3 ! 1;
            |DBASE aPathModelo;  |QBT aPathModelo;
            aDef = aPathModelo + "def/dsmoc349.mas";
            |CARGA_DEF aDef, espejo1@;
            |SI FSalida = 0;
                |ABRE #349;
                |PARA nPeriodo = 1;  |SI nPeriodo < #999#3;  |HACIENDO nPeriodo = nPeriodo + 1;
                      |BUCLE dsmoc349;
                |SIGUE;
                |CIERRA #349;
            |FINSI;

            |DESCARGA_DEF #espejo1@;
        |FINSI;
     |FINSI;

     nSwCuotaNeg = 0;
     |BUCLE dsmoc349Cero;
     |SI nSwCuotaNeg = 1;
         |MENAV "    Aviso.! Existen registros del Modelo 349 con Cuota Negativa";
     |FINSI;
|FPRC;

|PROCESO dsmom004_349;
     nError = 0;
     |ERROR10;
|FPRC;

|DEFBUCLE dsmom004_349;
     #4#1;
     ;
     #999#0, #999#2, nDPeriodo, 349, #999#9;
     #999#0, #999#2, nHPeriodo, 349, #999#9;
     ;
     NULL, dsmom004_349;
|FIN;

|PROCESO Pase349;

     enP2013 = 0;
     |ABRE #32;
     |LEE 041#32p;
     |SI FSalida ! 0;
         |CIERRA #32;
         eaExtension = "mod";
         eaPrograma  = "dsmom032";
         |SUB_EJECUTA_NP ":basica/dspatron";
         |ABRE #32;
     |FINSI;
     |LEE 041#32p;
     |SI FSalida ! 0; enP2013 = 1;  |FINSI;
     |CIERRA #32;

     |SI #999#10 ! 349;
         nDPeriodo = #999#3;
         nHPeriodo = 12;
         nError = 1;
         |BUCLE dsmom004_349;
         |SI nError = 1;  |ACABA;  |FINSI;
     |SINO;
         |ABRE #4;
         #4#0 = #999#0;
         #4#1 = #999#2;
         #4#2 = #999#3;
         #4#3 = 349;
         #4#4 = #999#9;
         |LEE 000#4=;
         |SI FSalida  ! 0;
              |CIERRA #4;
              |ACABA;
         |FINSI;
         |CIERRA #4;
     |FINSI;

     |SI #999#10 ! 349;
         |SI #4#9 = "X";  |ACABA;  |FINSI;
     |FINSI;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enModelo      = 349;
     enPeriodo     = #4#2;
     enTipoEntrada = 3;
     enActividad   = #999#1;
     enTipoEnt349  = 1;
     |SUB_EJECUTA "dsmoc349";
     enTipoEnt349  = 0;

     |HAZ PaseConta349;

     enTipoEntrada = 96;
     |SUB_EJECUTA "dsmoc349";
|FPRC;
