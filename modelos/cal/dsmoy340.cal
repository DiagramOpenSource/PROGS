|FICHEROS;
     dsmoy000 #0;
     dsmom004 #4;
     dsmom107 #207;

     dsmo3401 #341;
     dsmo3402 #342;
     dsmo3403 #343;
     dsmo3404 #344;
     dsmo3405 #345;

     dsmow014 #999;

     dsmow584 #584;
     dsmow585 #585;
     dsmow586 #586;
     dsmow587 #587;
     dsmow588 #588;

     dsmow602 #602,MANTE;

     &regisnif@ #709;
     &clientes@ #715;
|FIN;

|VARIABLES;
     aNombre     = "";
     aPathAfegir = "";
     aIPRemoto   = "";
     aBue        = "";
     aCinta      = "";
     aImpre      = "";
     aSalida     = "";
     aBasica     = "";
     aCodElec    = "";
     aEjecutable = "";

     nReg        = 0;
     nHandle     = 0;
     nHandleEjec = 0;
     nError      = 0;
     nHay        = 0;
     nHandleError = 0;
|FIN;

|INCLUYE i_varemi;

|PROCESO TraeTgz340;
     nError = 0;

     |SI #0#6 [ 2009;
         aAlfa       = eaPathEjecu + "p3400918.exe";
         aEjecutable = "p3400918";
     |FINSI;

     |SI #0#6 = 2010;
         aAlfa       = eaPathEjecu + "p3401020.txt";
         aEjecutable = "p3401020";
     |FINSI;

     |SI #0#6 = 2011;
         aAlfa       = eaPathEjecu + "p3401110.txt";
         aEjecutable = "p3401110";
     |FINSI;

     |SI #0#6 = 2012;
         aAlfa       = eaPathEjecu + "p3401240.txt";
         aEjecutable = "p3401240";
     |FINSI;

     |XABRE "EC", aAlfa, nHandle;
     |SI FSalida ] 0;  |ACABA;  |FINSI;

     aAlfa    = #0#6;
     aAlfa    = aAlfa % -102;
     enError  = 0;
     aVersion = "01";

     |DBASS aBasica;  |QBT aBasica;
     aBasica = aBasica + "basica/";

     eaFOrigen  = aBasica + "patrones/z" + aAlfa + aVersion + "340.tgz";
     |XABRE "E", eaFOrigen, nHandleEjec;
     |SI FSalida < 0;
         aAlfa1 =  "      No existe el ejecutable z" + aAlfa + aVersion + "340.tgz pongase en contacto con su distribuidor";
         |MENAV aAlfa1;
         nError = 1;
         |ACABA;
     |FINSI;

     eaFDestino = eaPathEjecu + "z" + aAlfa + aVersion + "340.tgz";

     |HAZ CopiaFichero;

     |RDESCOMPRIME eaFDestino;

     eaFDestino = (eaFDestino - ".tgz") + ".tar";
     |RDETAR eaFDestino, eaPathEjecu;

     |RFBORRA eaFDestino;
|FPRC;

|PROCESO LanzaPrograma;
     |HAZ TraeTgz340;
     |SI nError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     aAbre = eaPathEjecu + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "CD " + eaPathEjecu + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "echo off" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "SET CINTA=" + eaPathLanza + aCinta + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "SET IMPRE=" + eaPathLanza + aImpre + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "SET SALIDA=" + eaPathLanza + aSalida + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "wait " + aEjecutable +  &13 + &10;
     |XGRABA nHandle1, aAlfa;

     |XCIERRA nHandle1;

     |RSYSTEM aAbre;
|FPRC;

|PROCESO Registro341;
     enCodCli = #341#0;
     |HAZ LeePersona;

     |DDEFECTO #584;

     #584#1  = "1";
     #584#2  = "340";
     #584#3  = #341#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #584#4   = eaVarDni;

         eaAlfa   = #715#1;  |HAZ QuitaRaros;
         #584#5   = eaAlfa;

         eaAlfa   = #715#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #715#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #584#7   = eaAlfa;

         eaAlfa   = #715#53;  |HAZ QuitaRaros;
         #584#8   = eaAlfa;
     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #584#4   = eaVarDni;

         eaAlfa   = #715#1;   |HAZ QuitaRaros;
         #584#5   = eaAlfa;

         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;
         #584#7   = eaAlfa;

         eaAlfa   = #715#96;  |HAZ QuitaRaros;
         #584#8   = eaAlfa;
     |FINSI;

     #584#6  = "T";

     #584#12 = "0000000000000";

     |SI #4#24 = "C";
         #584#10 = "C";
         #584#12 = #4#21;
     |FINSI;

     |SI #4#24 = "S";
         #584#11 = "S";
         #584#12 = #4#21;
     |FINSI;

     |SI #4#22 = "T";
         |SI #341#2 = 3;   #584#13 = "1T";  |FINSI;
         |SI #341#2 = 6;   #584#13 = "2T";  |FINSI;
         |SI #341#2 = 9;   #584#13 = "3T";  |FINSI;
         |SI #341#2 = 12;  #584#13 = "4T";  |FINSI;
     |SINO;
         #584#13 = ("00" + #341#2) % -102;
     |FINSI;

     #584#9  = "340" + #584#3 + (("00" + #341#2) % -102) + (("0000" + #341#4) % -104);

     nNume   = #341#6;
     #584#14 = ("000000000" + nNume) % -109;

     enNume  = #341#7;  |HAZ Conver17Signo;
     #584#15 = eaSigno + eaAlfa;

     enNume  = #341#8;  |HAZ Conver17Signo;
     #584#16 = eaSigno + eaAlfa;

     enNume  = #341#9;  |HAZ Conver17Signo;
     #584#17 = eaSigno + eaAlfa;

     #584#20 = aCodElec;

     #584#22 = &13 + &10;

     aAlfa = "";

     |PARA nCampo = 1;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #584nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|PROCESO Registro342;
     nReg = nReg + 1;

     enCodCli = #341#0;
     |HAZ LeePersona;

     |DDEFECTO #585;

     #585#1  = "2";
     #585#2  = "340";
     #585#3  = #341#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #585#4   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #585#4   = eaVarDni;
     |FINSI;

     eaVarDni = #342#7;  |HAZ CalculameDNI;
     |SI #342#8 = "N";
         #585#5 = eaVarDni;
     |SINO;
         #585#6 = eaVarDni;
     |FINSI;

     eaAlfa  = #342#9;  |HAZ QuitaRaros;  #585#7  = eaAlfa;

     #585#8  = #342#10;
     #585#9  = #342#11;
     eaAlfa  = #342#12;  |HAZ QuitaRaros;  #585#10  = eaAlfa;

                         #585#11 = "E";
     |SI #342#29 = "S";  #585#11 = "F";  |FINSI;

     #585#12 = #342#13;

     |SI #342#14 ! "01.01.0000";
         #585#13 = (#342#14 % 704) + (#342#14 % 402) + (#342#14 % 102);
     |FINSI;

     |SI #342#15 ! "01.01.0000";
         #585#14 = (#342#15 % 704) + (#342#15 % 402) + (#342#15 % 102);
     |FINSI;

     nNume   = #342#16 * 100;
     #585#15 = ("00000" + nNume) % -105;

     enNume  = #342#17;  |HAZ Conver13Signo;
     #585#16 = eaSigno + eaAlfa;

     enNume  = #342#18;  |HAZ Conver13Signo;
     #585#17 = eaSigno + eaAlfa;

     enNume  = #342#19;  |HAZ Conver13Signo;
     #585#18 = eaSigno + eaAlfa;

     enNume  = #342#20;  |HAZ Conver13Signo;
     #585#19 = eaSigno + eaAlfa;

     eaAlfa  = #342#21;  |HAZ QuitaRaros;  #585#20 = eaAlfa;

     #585#21 = nReg;

     eaAlfa  = ("00000000" + #342#22) % -108;   #585#22 = eaAlfa;
     eaAlfa  = ("00" + #342#23) % -102;         #585#23 = eaAlfa;

     #585#24 = #342#24;
     #585#25 = #342#25;
     #585#26 = #342#26;

     nNume   = #342#27 * 100;
     #585#27 = ("00000" + nNume) % -105;

     enNume  = #342#28;  |HAZ Conver13Signo;
     #585#28 = eaSigno + eaAlfa;

     |SI #342#1 ] 2012;
         aAlfa = #585#20;  |QBF aAlfa;
         |SI aAlfa = "";
             |SI #342#32 ! 0;
                 #585#20 = "IMPORTE PERCIBIDO METALICO";
             |FINSI;

             |SI #342#34 ! 0;
                 #585#20 = "IMPORTE PERCIBIDO TRANSMISION INMUEBLE";
             |FINSI;
         |FINSI;

         #585#29 = #342#30;
         |SI #585#29 = " ";  #585#29 = "0";  |FINSI;

         #585#30 = #342#31;

         enNume  = #342#32;  |HAZ Conver15;  #585#31 = eaAlfa;

         #585#32 = ("0000" + #342#33) % -104;

         enNume  = #342#34;  |HAZ Conver15;  #585#33 = eaAlfa;
     |FINSI;

     |SI #342#1 ] 2014;
         #585#34 = "0" * 8;
         #585#35 = "0" * 13;

         |SI #342#36 ! 0;
             |SI #342#35 ! "01.01.0000";
                 #585#34 = (#342#35 % 704) + (#342#35 % 402) + (#342#35 % 102);
             |FINSI;

             enNume  = #342#36;  |HAZ Conver13;
             #585#35 = eaAlfa;
             #585#36 = #342#37;
             #585#37 = #342#38;
         |FINSI;
     |FINSI;

     #585#38 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #585nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmo3402;
     #342#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, 01, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, 99, 999999;
     ;
     NULL, Registro342;
|FIN;

|PROCESO Registro343;
     nReg = nReg + 1;

     enCodCli = #341#0;
     |HAZ LeePersona;

     |DDEFECTO #586;

     #586#1  = "2";
     #586#2  = "340";
     #586#3  = #341#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #586#4   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #586#4   = eaVarDni;
     |FINSI;

     eaVarDni = #343#7;  |HAZ CalculameDNI;
     |SI #343#8 = "N";
         #586#5 = eaVarDni;
     |SINO;
         #586#6 = eaVarDni;
     |FINSI;

     eaAlfa  = #343#9;  |HAZ QuitaRaros;  #586#7  = eaAlfa;

     #586#8  = #343#10;
     #586#9  = #343#11;
     eaAlfa  = #343#12;  |HAZ QuitaRaros;  #586#10  = eaAlfa;

                         #586#11 = "R";
     |SI #343#27 = "S";  #586#11 = "S";  |FINSI;

     #586#12 = #343#13;

     |SI #343#14 ! "01.01.0000";
         #586#13 = (#343#14 % 704) + (#343#14 % 402) + (#343#14 % 102);
     |FINSI;

     |SI #343#15 ! "01.01.0000";
         #586#14 = (#343#15 % 704) + (#343#15 % 402) + (#343#15 % 102);
     |FINSI;

     nNume   = #343#16 * 100;
     #586#15 = ("00000" + nNume) % -105;

     enNume  = #343#17;  |HAZ Conver13Signo;
     #586#16 = eaSigno + eaAlfa;

     enNume  = #343#18;  |HAZ Conver13Signo;
     #586#17 = eaSigno + eaAlfa;

     enNume  = #343#19;  |HAZ Conver13Signo;
     #586#18 = eaSigno + eaAlfa;

     enNume  = #343#20;  |HAZ Conver13Signo;
     #586#19 = eaSigno + eaAlfa;

     eaAlfa  = #343#21;  |HAZ QuitaRaros;  #586#20 = eaAlfa;

     #586#21 = nReg;

     eaAlfa  = ("000000000000000000" + #343#22) % -118;   #586#22 = eaAlfa;
     eaAlfa  = ("00" + #343#23) % -102;                   #586#23 = eaAlfa;

     #586#24 = #343#24;
     #586#25 = #343#25;

     enNume  = #343#26;  |HAZ Conver13Signo;
     #586#26 = eaSigno + eaAlfa;

     |SI #343#1 ] 2014;
         #586#27 = "0" * 8;
         #586#28 = "0" * 13;

         |SI #343#29 ! 0;
             |SI #343#28 ! "01.01.0000";
                 #586#27 = (#343#28 % 704) + (#343#28 % 402) + (#343#28 % 102);
             |FINSI;

             enNume  = #343#29;  |HAZ Conver13;
             #586#28 = eaAlfa;
             #586#29 = #343#30;
             #586#30 = #343#31;
         |FINSI;
     |FINSI;

     #586#32 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #586nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmo3403;
     #343#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, 01, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, 99, 999999;
     ;
     NULL, Registro343;
|FIN;

|PROCESO Registro344;
     nReg = nReg + 1;

     enCodCli = #341#0;
     |HAZ LeePersona;

     |DDEFECTO #587;

     #587#1  = "2";
     #587#2  = "340";
     #587#3  = #341#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #587#4   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #587#4   = eaVarDni;
     |FINSI;

     eaVarDni = #344#7;  |HAZ CalculameDNI;
     |SI #344#8 = "N";
         #587#5 = eaVarDni;
     |SINO;
         #587#6 = eaVarDni;
     |FINSI;

     eaAlfa  = #344#9;  |HAZ QuitaRaros;  #587#7  = eaAlfa;

     #587#8  = #344#10;
     #587#9  = #344#11;
     eaAlfa  = #344#12;  |HAZ QuitaRaros;  #587#10  = eaAlfa;

                         #587#11 = "I";
     |SI #344#28 = "S";  #587#11 = "J";  |FINSI;

     #587#12 = #344#13;

     |SI #344#14 ! "01.01.0000";
         #587#13 = (#344#14 % 704) + (#344#14 % 402) + (#344#14 % 102);
     |FINSI;

     |SI #344#15 ! "01.01.0000";
         #587#14 = (#344#15 % 704) + (#344#15 % 402) + (#344#15 % 102);
     |FINSI;

     nNume   = #344#16 * 100;
     #587#15 = ("00000" + nNume) % -105;

     enNume  = #344#17;  |HAZ Conver13Signo;
     #587#16 = eaSigno + eaAlfa;

     enNume  = #344#18;  |HAZ Conver13Signo;
     #587#17 = eaSigno + eaAlfa;

     enNume  = #344#19;  |HAZ Conver13Signo;
     #587#18 = eaSigno + eaAlfa;

     enNume  = #344#20;  |HAZ Conver13Signo;
     #587#19 = eaSigno + eaAlfa;

     eaAlfa  = #344#21;  |HAZ QuitaRaros;  #587#20 = eaAlfa;

     #587#21 = nReg;

     nNume   = #344#22 ! 0;
     eaAlfa  = ("000" + nNume) % -103;     #587#22 = eaAlfa;

     enNume  = #344#23;  |HAZ Conver13Signo;
     #587#23 = eaSigno + eaAlfa;

     eaAlfa  = #344#24;  |HAZ QuitaRaros;  #587#24 = eaAlfa;

     enNume  = #344#25;  |HAZ Conver13Signo;
     #587#25 = eaSigno + eaAlfa;

     |SI #344#26 ! "01.01.0000";
         #587#26 = (#344#26 % 704) + (#344#26 % 402) + (#344#26 % 102);
     |FINSI;

     eaAlfa  = #344#27;  |HAZ QuitaRaros;  #587#27 = eaAlfa;

     #587#29 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 29;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #587nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmo3404;
     #344#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, 01, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, 99, 999999;
     ;
     NULL, Registro344;
|FIN;

|PROCESO Registro345;
     nReg = nReg + 1;

     enCodCli = #341#0;
     |HAZ LeePersona;

     |DDEFECTO #588;

     #588#1  = "2";
     #588#2  = "340";
     #588#3  = #341#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #588#4   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #588#4   = eaVarDni;
     |FINSI;

     eaVarDni = #345#7;  |HAZ CalculameDNI;
     |SI #345#8 = "N";
         #588#5 = eaVarDni;
     |SINO;
         #588#6 = eaVarDni;
     |FINSI;

     eaAlfa  = #345#9;  |HAZ QuitaRaros;  #588#7  = eaAlfa;

     #588#8  = #345#10;
     #588#9  = #345#11;
     eaAlfa  = #345#12;  |HAZ QuitaRaros;  #588#10  = eaAlfa;

     #588#11 = "U";

     #588#12 = " ";

     |SI #345#14 ! "01.01.0000";
         #588#13 = (#345#14 % 704) + (#345#14 % 402) + (#345#14 % 102);
     |FINSI;

     |SI #345#15 ! "01.01.0000";
         #588#14 = (#345#15 % 704) + (#345#15 % 402) + (#345#15 % 102);
     |FINSI;

     nNume   = #345#16 * 100;
     #588#15 = ("00000" + nNume) % -105;

     enNume  = #345#17;  |HAZ Conver13Signo;
     #588#16 = eaSigno + eaAlfa;

     enNume  = #345#18;  |HAZ Conver13Signo;
     #588#17 = eaSigno + eaAlfa;

     enNume  = #345#19;  |HAZ Conver13Signo;
     #588#18 = eaSigno + eaAlfa;

     enNume  = 0;        |HAZ Conver13Signo;
     #588#19 = eaSigno + eaAlfa;

     eaAlfa  = #345#20;  |HAZ QuitaRaros;  #588#20 = eaAlfa;

     #588#21 = nReg;
     #588#22 = #345#21;
     #588#23 = #345#22;
     #588#24 = #345#23;

     eaAlfa  = ("000" + #345#24) % -103;     #588#25 = eaAlfa;

     eaAlfa  = #345#25;  |HAZ QuitaRaros;  #588#26 = eaAlfa;
     eaAlfa  = #345#26;  |HAZ QuitaRaros;  #588#27 = eaAlfa;
     eaAlfa  = #345#27;  |HAZ QuitaRaros;  #588#28 = eaAlfa;
     eaAlfa  = #345#28;  |HAZ QuitaRaros;  #588#29 = eaAlfa;
     eaAlfa  = #345#29;  |HAZ QuitaRaros;  #588#30 = eaAlfa;

     #588#32 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #588nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmo3405;
     #345#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, 01, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, 99, 999999;
     ;
     NULL, Registro345
|FIN;

|PROCESO Lanza2012;
     aAbre = eaPathEmision + "fic340" + (("00000" + #999#0) % -105) + ".txt";
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Registro341;

     nReg = 0;  |BUCLE dsmo3402;
     nReg = 0;  |BUCLE dsmo3403;
     nReg = 0;  |BUCLE dsmo3404;
     nReg = 0;  |BUCLE dsmo3405;

     |XCIERRA nHandle2;

     eaFOrigen  = eaPathEmision  + "fic340" + (("00000" + #999#0) % -105) + ".txt";
     eaFDestino = eaPathLanza    + "fic340" + (("00000" + #999#0) % -105) + ".txt";

     |HAZ CopiaFichero;
     |FBORRA eaFOrigen;

     aCinta  =  "fic340" + (("00000" + #999#0) % -105) + ".txt";
     aImpre  =  "res340" + (("00000" + #999#0) % -105) + ".txt";
     aSalida =  "err340" + (("00000" + #999#0) % -105) + ".txt";

     |HAZ LanzaPrograma;

     |CIERRA #341;
|FPRC;

|PROCESO Lanza2013;
     eaFicheroPlano = "340" + (("00000" + #999#0) % -105) + ".txt";
     eaFicheroImpre = "340" + (("00000" + #999#0) % -105) + ".imp";
     eaFicheroSalid = "340" + (("00000" + #999#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #999#0) % -105) + ".txt";
     eaOpcion       = "3";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Registro341;

     nReg = 0;  |BUCLE dsmo3402;
     nReg = 0;  |BUCLE dsmo3403;
     nReg = 0;  |BUCLE dsmo3404;
     nReg = 0;  |BUCLE dsmo3405;

     |XCIERRA nHandle2;

     |CIERRA #341;

     enEmpresa    = #dsmow014#0;
     enComple     = #dsmow014#7;
     eaNomEmpresa = #dsmow014#3;

     |HAZ PresentaPortal;

     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 101#4=;
     |SI FSalida = 0;
         |SI enErrorPortal = 0;
             #4#9  = "X";
             #4#10 = #0#7;
             #4#19 = "";
             #4#25 = "";
             |SI #207#15 = "S";
                 #4#13 = "X";
                 #4#14 = #0#7;
             |FINSI;
         |SINO;
             #4#9  = " ";
             #4#10 = "01.01.0000";
             #4#19 = "";
             #4#25 = "";
             |SI #207#15 = "S";
                 #4#13 = "";
                 #4#14 = "01.01.0000";
             |FINSI;
         |FINSI;

         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO Lee3401;        || Creacion de Ficheros
     |ABRE #341;
     #341#0  = #999#0;
     #341#1  = #999#1;
     #341#2  = #999#2;
     #341#3  = #999#5;
     #341#4  = #999#7;
     #341#5  = 0;
     |LEE 101#341=;
     |SI FSalida ! 0;
         |CIERRA #341;
         |ACABA;
     |FINSI;

     aCodElec = #341#10;

     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = 303;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida = 0;
         aCodElec = #4#19;
     |FINSI;
     |CIERRA #4;

     |QBF aCodElec;
     |SI aCodElec = "";
         aAlfa = "0000Empresa: " + #999#0 + " " + #999#3;  |QBF aAlfa;
         aAlfa = aAlfa + " le falta el codigo electronico del modelo 303.";
         |MENAV aAlfa;

         |ACABA;
     |FINSI;

     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     #341#10 = aCodElec;
     |GRABA 020#341a;
     |LIBERA #341;

     |SI #dsmoy000#6 [ 2012;  |HAZ Lanza2012;  |FINSI;
     |SI #dsmoy000#6 ] 2013;  |HAZ Lanza2013;  |FINSI;

     nHay = 1;
|FPRC;

|PROCESO QueHacemos340;
     |HAZ Lee3401;          || Creacion de los Ficheros Planos.
|FPRC;

|DEFBUCLE dsmow014C340;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos340;
|FIN;

|DEFBUCLE dsmow014N340;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos340;
|FIN;

|PROCESO Baja602;
     #602#0 = 1;
     #602#1 = 0000;
     #602#2 = 00;
     #602#3 = 000;
|FPRC;

|PROCESO Alta602;
     #602#0 = 99999;
     #602#1 = 9999;
     #602#2 = 99;
     #602#3 = 9999;
|FPRC;

|PROCESO SacaResumen;
     |ABRE #207;
     |DDEFECTO #207;
     |LEE 000#207p;
     |CIERRA #207;

     aFichero = ("62" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #602 aFichero;
     |ABRE #602;  |CIERRA #602;  |DELINDEX #602;

     |ABRE #602;
     |ABRE #999;

     aFichero    = eaPathLanza + "res*.txt";  |QBT aFichero;

     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            aAlfa = aFichero % -115;

            aAlfa1 = aAlfa % 705;
            #602#0 = aAlfa1;
            #602#1 = #0#6;
            #602#2 = #0#4;
            #602#3 = 340;

            enCodCli = #602#0;
            |HAZ LeePersona;

            #602#4 = #715#1;

            #602#5 = "CORRECTA";
            aError = eaPathLanza + ("err" + aAlfa % -112);
            |XABRE "C", aError, nHandleError;
            |SI FSalida ] 0;
            |PARA;  |SI FSalida ] 0;  |HACIENDO;
                 |XLEE nHandleError, 250, aAlfa;

                 |QBF aAlfa;
                 |SI aAlfa ! "";
                     #602#5 = "ERRONEA";
                     |SAL;
                 |FINSI;
            |SIGUE;
         |FINSI;
         |XCIERRA nHandleError;

         |GRABA 020#602n;
         |LIBERA #602;

         #999#0 = #602#0;
         #999#1 = #602#1;
         #999#2 = #602#2;
         |LEE 000#999=;
         |SI FSalida = 0;
             |SI #602#5 = "CORRECTA  ";
                 aOrigen  = eaPathLanza + "fic" + #602#3 + (("00000" + #602#0) % -105) + ".txt";
                 aDestino = eaPathInternet + "fic" + #602#3 + (("00000" + #602#0) % -105) + ".txt";
                 |RCOPIA_FICHERO aOrigen, aDestino;

                 |ABRE #4;
                 #4#0  = #999#0;
                 #4#1  = #999#1;
                 #4#2  = #999#2;
                 #4#3  = #999#5;
                 #4#4  = #999#7;
                 |LEE 101#4=;
                 |SI FSalida = 0;
                     #4#9  = "X";
                     #4#10 = #0#7;
                     #4#19 = "";
                     #4#25 = "";
                     |SI #207#15 = "S";
                         #4#13 = "X";
                         #4#14 = #0#7;
                     |FINSI;
                     |GRABA 020#4a;
                     |LIBERA #4;
                 |FINSI;
                 |CIERRA #4;
             |SINO;
                 |ABRE #4;
                 #4#0  = #999#0;
                 #4#1  = #999#1;
                 #4#2  = #999#2;
                 #4#3  = #999#5;
                 #4#4  = #999#7;
                 |LEE 101#4=;
                 |SI FSalida = 0;
                     #4#9  = " ";
                     #4#10 = "01.01.0000";
                     #4#19 = "";
                     #4#25 = "";
                     |SI #207#15 = "S";
                         #4#13 = "";
                         #4#14 = "01.01.0000";
                     |FINSI;
                     |GRABA 020#4a;
                     |LIBERA #4;
                 |FINSI;
                 |CIERRA #4;
             |FINSI;
         |FINSI;

         |R_SDIR aFichero;
     |SIGUE;
     |CIERRA #999;

     |PUSHV 0501 2380;
     |ENTLINEAL #1#602, -1, 4, 22, 1, Baja602, Alta602;
     |POPV;

     |CIERRA #602;
     |DELINDEX #602;
|FPRC;

|PROCESO Proceso340;
     |SI #dsmoy000#6 ] 2013;
          |HAZ PreguntaPresentacion;
          |HAZ TraeTgzCobol;
     |FINSI;

     nHay = 0;

     |SI #0#8 = "C";
         |BUCLE dsmow014C340;
     |SINO;
         |BUCLE dsmow014N340;
     |FINSI;

     |SI nHay = 0;
         |MENAV "0000Seleccion vac¡a";
         |ACABA;
     |FINSI;

     |SI nHay = 0;  |ACABA;  |FINSI;

     |SI #dsmoy000#6 [ 2012;  |HAZ SacaResumen;  |FINSI;
     |SI #dsmoy000#6 ] 2013;  |HAZ SacaErrorPtl; |FINSI;

     |SI enPresentar = 0;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Boton3401;
     |PTEC 824;
|FPRC;

|PROCESO Boton3402;
     |PTEC 825;
|FPRC;

|PROCESO Boton3403;
     |PTEC 827;
|FPRC;

|PROCESO Botones340;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision Modelo 340       ", 0513, 0754, Boton3401;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Informe de Comprobacion  ", 0913, 1154, Boton3402;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton3403;
     nBoton3 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF6 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTecla = 1;   |SAL;  |FINSI;
         |SI aTecla = aF3;  nTecla = 4;   |SAL;  |FINSI;
         |SI aTecla = aF6;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |PULSATECLA;
|FPRC;

|PROGRAMA;
     aFichero = ("000" + Usuario) % 108;
     |NOME_DAT #0 aFichero;

     aFichero = ("imp" + Usuario) % 108;
     |NOME_DAT #999 aFichero;

     |ABRE #0;
     |LEE 000#0p;
     |CIERRA #0;

     |ABRE #207;
     |LEE 040#207p;
     |SI FSalida ! 0;
         |CIERRA #207;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #207;
     |FINSI;

     |LEE 040#207p;
     |SI FSalida ! 0;  |DDEFECTO #207;  |FINSI;
     |CIERRA #207;

     |HAZ Botones340;
     |SI nTecla = 0; enInfComp = 1; |ACABA; |FINSI;
     |SI nTecla = 4;
         enInfComp = 1;
         |SUB_EJECUTA_NP "dsmoy076;Todos";
         |ACABA;
     |FINSI;

     eaPathLanza = "\MODELOS";                                 |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + #0#0;                   |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + #0#6;                   |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + (("00" + #0#4) % -102); |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     eaPathEjecu = "\MODELOS";                                 |RMKDIR eaPathEjecu;
     eaPathEjecu = eaPathEjecu + "\" + #0#0;                   |RMKDIR eaPathEjecu;
     eaPathEjecu = eaPathEjecu + "\" + #0#6;                   |RMKDIR eaPathEjecu;
     eaPathEjecu = eaPathEjecu + "\";

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |HAZ Proceso340;
|FPRO;
