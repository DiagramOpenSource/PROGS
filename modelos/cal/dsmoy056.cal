|FICHEROS;
     dsmoy056;

     dsmom004;

     dsm18401;
     dsm18403;
     dsm18405;
     dsm18406;
     dsm18407;
     dsm18408;
     dsm18409;
     dsm18414;
     dsm18415;
     dsm18430;
     dsm18431;

     dsmow114;
     dsmow014;

     &clientes@;

    :/basica/def/wordm000;
|FIN;

|VARIABLES;
     nCampo              = 0;
     nSwGraba            = 0;
     nDEmpresa           = 0;
     nHEmpresa           = 0;
     nDComple            = 0;
     nHComple            = 0;
     nLectura            = 0;
     nWord1              = -1;
     nHandle             = 0;
     nLen                = 0;
     nPos                = 0;
     nPrimero            = 0;
     nCampos             = 0;
     nRdtos1             = 0;
     nRdtos2             = 0;
     nRdtos3             = 0;
     nRdtos4             = 0;
     nRdtos5             = 0;
     nRdtos6             = 0;
     nRdtos7             = 0;
     nRdtos8             = 0;
     nRdtos2A            = 0;
     nRdtos2B            = 0;
     nRdtos2C            = 0;
     nRdtos2D            = 0;
     nRdtos6A            = 0;
     nRdtos6B            = 0;
     nRdtos6C            = 0;
     nRdtos6D            = 0;
     nBytes              = 0;
     nConta              = 0;
     nEmpresa            = 0;
     nEjercicio          = 0;
     nOk                 = 0;
     nOpcion             = 0;
     nArchivo            = 0;
     nContaDoc           = 0;
     nError              = 0;
     nPausa              = 0;
     nNume               = 0;

     aFichero            = "";
     aAlfa               = "";
     aAlfa1              = "";
     aAlfa2              = "";
     aAlfa3              = "";
     aPoblacion          = "";
     aBase               = "";
     aBaseApli           = "";
     aOrigen             = "";
     aDestino            = "";
     aIPRemoto           = "";
     aAbre1              = "";
     aAbre2              = "";
     aPath               = "";
     aPathDoc            = "";
     aCadena             = "";
     aLen                = "";
     aAsigna             = "";
     aCaracter           = "";
     aIdenti             = "";
     aDocumento1         = "";
     aDocumento2         = "";
     aQueQuiero          = "";
     aWord               = "";
     aAbreTxt            = "";
     aNomFic             = "";
     aFicBat             = "";
     aLista              = "";
     aFlag               = "";
     aEjec               = "";

     fFecha              = @;

     nSwImprime          = 0;
     nSwBorra            = 0;

     aDocWord            = "";
     nNumCampos          = 0;

     {-1}aMenu           = "";
         aMenu1          = "2400";
         aMenu2          = "1";
         aMenu3          = "Archivo documental activado. Elija opci¢n: ";
         aMenu4          = "IAB";
         aMenu5          = "Imprimir";
         aMenu6          = "Archivar";
         aMenu7          = "Ambos";

     &enEmpresa          = 0;
     &enCodCli           = 0;
     &eaImporte          = "";
     &enNume             = 0;
     &eaUnidadBasico     = "";
     &enErrorPINET       = 0;
     &enEmpresaPINET     = 0;

     &enErrorDSArchi     = 0;
     &eaVengoDe          = "";
     &enArchi            = 0;
     &eaInforme          = "";
     &enEjercicio        = 0;
     &eaNifEmp           = "";
     &eaNombreEmp        = "";
     &enCodTrab          = 0;
     &eaNombreTra        = "";
     &eaNifTra           = "";
     &eaObservacion1     = "";
     &eaObservacion2     = "";
     &eaObservacion3     = "";
     &enM2               = 0;
     &eaAlfa             = "";
     &eaAsigna           = "";
     &eaDirTrabajo       = "";
     &eaDirTrabServi     = "";
     &eaDirPlantilla     = "";
     &eaDirSerPlan       = "";
     &eaFicheroPdf       = "";
     &eaFicheroTra       = "";
     &eaFicheroTxt       = "";
     &enHandleTxt        = 0;
     &eaOrigen           = "";
     &eaDestino          = "";
     &eaOrig             = "";
|FIN;

|| _________________________________________________________________________

|PROCESO BorraDocus;
     aLista = eaDirTrabajo + "*.*";
     |R_PDIR aLista;
     |PARA; |SI FSalida = 0; |HACIENDO;
         aAlfa = aLista < "";

         aAlfa = aAlfa - ".pdf";
         |SI FSalida ! 0;  |RFBORRA aLista;  |FINSI;

         aAlfa = aAlfa - ".bat";
         |SI FSalida ! 0;  |RFBORRA aLista;  |FINSI;

         aAlfa = aAlfa - ".txt";
         |SI FSalida ! 0;  |RFBORRA aLista;  |FINSI;

         |R_SDIR aLista;
     |SIGUE;
|FPRC;

|PROCESO Asigna;
     aCadena = "";
     aLen    = aAsigna % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aAsigna % nPos;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &241; |FINSI;
           |SI aCaracter = " ";  aCaracter = &225; |FINSI;
           |SI aCaracter = "‚";  aCaracter = &233; |FINSI;
           |SI aCaracter = "¡";  aCaracter = &237; |FINSI;
           |SI aCaracter = "¢";  aCaracter = &243; |FINSI;
           |SI aCaracter = "£";  aCaracter = &250; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;

     eaAlfa   = aCadena;
     eaAsigna = "V" + aIdenti;
     |HAZ AsignaWord;
|FPRC;

|PROCESO dsm18407;
     |SI nConta > 2;
         eaAsigna  = "T}5}3}1}+F";
         eaAlfa    = "1";
         |HAZ AsignaWord;
     |FINSI;

     nConta = nConta + 1;

     eaAsigna = "T}5}" + nConta + "}1}";
     eaAlfa   = #dsm18407#4;
     |HAZ AsignaWord;

     eaAsigna = "T}5}" + nConta + "}2}";
     eaAlfa   = #dsm18407#5;
     |HAZ AsignaWord;

     eaAsigna = "T}5}" + nConta + "}3}";
     eaAlfa   = #dsm18407#6;
     |HAZ AsignaWord;

     enNume   = #dsm18407#8;   |HAZ SeparaImporte;
     eaAsigna = "T}5}" + nConta + "}4}";
     eaAlfa   = eaImporte;
     |HAZ AsignaWord;

     enNume   = #dsm18407#7;   |HAZ SeparaImporte;
     eaAsigna = "T}5}" + nConta + "}5}";
     eaAlfa   = eaImporte;
     |HAZ AsignaWord;

     enNume   = #dsm18407#9;   |HAZ SeparaImporte;
     eaAsigna = "T}5}" + nConta + "}6}";
     eaAlfa   = eaImporte;
     |HAZ AsignaWord;
|FPRC;

|DEFBUCLE dsm18407;
     #dsm18407#1;
     ;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 001;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 999;
     ;
     NULL, dsm18407;
|FIN;

|PROCESO CargaVar;
     eaObservacion1 = "Certificado imputaciones C.B.";
     ||eaObservacion2 = "Ejercicio " + #dsmoy056#14;

     enEjercicio = #dsmoy056#14;
     enEmpresa   = #dsm18401#0;
     eaNombreEmp = #dsmoy056#18;
     eaNifEmp    = #dsmoy056#22;
     eaNombreTra = #dsmoy056#102;
     eaNifTra    = #dsmoy056#103;
     enM2        = 99;
     enCodTrab   = 0;
|FPRC;

|PROCESO PonVariables;
     aAbreTxt = eaDirTrabServi + eaFicheroTxt;
     |XABRE "WB", aAbreTxt, enHandleTxt;

     aAlfa = "[FICHERO]#" + eaDirTrabajo + aDocWord + "#" + eaDirTrabajo + aNomFic + ".doc" + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;

     aAlfa = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;

     eaAlfa = "[IMPRESORA]#I#2#DsPdf#2" + &13 + &10;
     |XGRABA enHandleTxt, eaAlfa;

     |PARA nCampos = 16;  |SI nCampos [ nNumCampos;  |HACIENDO nCampos = nCampos + 1;
           aQueQuiero = "|C" + (("000" + nCampos) % -103) + "NOMBRE";
           aIdenti    = #dsmoy056#aQueQuiero#;
           aAsigna    = #dsmoy056#nCampos#;  |QBF aAsigna;

           aQueQuiero = "|C" + (("000" + nCampos) % -103) + "TIPO";
           aAlfa      =  #dsmoy056#aQueQuiero#;
           |SI aAlfa  = "N";
               enNume    = #dsmoy056#nCampos#;
               |HAZ SeparaImporte;
               aAsigna   = eaImporte;
           |FINSI;

           |HAZ Asigna;
     |SIGUE;

     nConta = 2;
     |BUCLE dsm18407;

     |XCIERRA enHandleTxt;

     eaOrigen  = eaDirTrabServi + eaFicheroTxt;
     eaDestino = eaDirTrabajo   + eaFicheroTxt;
     |HAZ EnviaFichero;

     |FBORRA eaOrigen;

     |HAZ AbreWordExterno;

     aAlfa = eaDirTrabajo + aNomFic + ".doc";
     |RFBORRA aAlfa;

     aAlfa = eaDirTrabajo + eaFicheroPdf;
     |XABRE "EC", aAlfa, 0;
     |SI FSalida < 0;
         nError = 1;
         |ACABA;
     |FINSI;

     |SI nOpcion ] 2;
         eaOrig = eaDirTrabajo + eaFicheroPdf;

         |HAZ CargaVar;
         |HAZ Archivando;
     |FINSI;
|FPRC;

|PROCESO AbreWord;
     nContaDoc = nContaDoc + 1;
     aNomFic   = (("00000000" + nContaDoc) % -108);

     eaOrigen   = aBase + "basica/word/" + aDocWord;
     eaDestino  = eaUnidadBasico + "/MODELOS/DOCUMENTOS/DSXML/" + aDocWord;
     |HAZ EnviaFichero;

     |MENSA "      Abriendo Documento";

     eaFicheroTxt   = aNomFic + ".txt";
     eaFicheroTra   = aNomFic + ".doc";
     eaFicheroPdf   = aNomFic + ".pdf";

     aAlfa          = eaDirTrabajo + aDocWord;
     |XABRE "EC", aAlfa, nHandle;
     |SI FSalida < 0;
         |ACABA;
     |FINSI;

     aAbreTxt = eaDirTrabajo + eaFicheroTxt;
     |XABRE "EC", aAbreTxt, nHandle;
     |SI FSalida ] 0;
         |RFBORRA aAbreTxt;
     |FINSI;

     |HAZ PonVariables;

     |MENSA "      Cargando Variables al Documento";
|FPRC;

|PROCESO dsm18403;
     |SI #dsm18403#4 = "N";
         |SI #dsm18403#5 = "ES";
             #dsmoy056#23 = #dsmoy056#23 + #dsm18403#6;
             #dsmoy056#24 = #dsmoy056#24 + #dsm18403#7;
             #dsmoy056#25 = #dsmoy056#25 + #dsm18403#8;
         |SINO;
             #dsmoy056#26 = #dsmoy056#26 + #dsm18403#6;
             #dsmoy056#27 = #dsmoy056#27 + #dsm18403#7;
             #dsmoy056#28 = #dsmoy056#28 + #dsm18403#8;
         |FINSI;
     |SINO;
         |SI #dsmoy056#29 = 0;  |O #dsmoy056#29 = #dsm18403#9;
             #dsmoy056#29 = #dsm18403#9;
             #dsmoy056#30 = #dsmoy056#30 + #dsm18403#10;
             |ACABA;
         |FINSI;

         #dsmoy056#31 = #dsm18403#9;
         #dsmoy056#32 = #dsmoy056#32 + #dsm18403#10;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18403;
     #dsm18403#1;
     ;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 001;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 999;
     ;
     NULL, dsm18403;
|FIN;

|PROCESO dsm18405;
     |SI #dsm18405#4 = "N";
         |SI #dsm18405#5 = "ES";
             #dsmoy056#33 = #dsmoy056#33 + #dsm18405#6;
             #dsmoy056#34 = #dsmoy056#34 + #dsm18405#7;
             #dsmoy056#35 = #dsmoy056#35 + #dsm18405#8;
         |SINO;
             #dsmoy056#36 = #dsmoy056#36 + #dsm18405#6;
             #dsmoy056#37 = #dsmoy056#37 + #dsm18405#7;
             #dsmoy056#38 = #dsmoy056#38 + #dsm18405#8;
         |FINSI;
     |SINO;
         |SI #dsmoy056#39 = 0;  |O #dsmoy056#39 = #dsm18405#9;
             #dsmoy056#39 = #dsm18405#9;
             #dsmoy056#40 = #dsmoy056#40 + #dsm18405#10;
             |ACABA;
         |FINSI;

         #dsmoy056#41 = #dsm18405#9;
         #dsmoy056#42 = #dsmoy056#42 + #dsm18405#10;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18405;
     #dsm18405#1;
     ;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 001;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 999;
     ;
     NULL, dsm18405;
|FIN;

|PROCESO dsm18431;
     |SI #dsm18431#4 = "ES";
         |SI #dsm18431#9 = "N";
             nRdtos1 = nRdtos1 + #dsm18431#6;
             nRdtos2 = nRdtos2 + #dsm18431#7;
             nRdtos3 = nRdtos3 + #dsm18431#8;
             nRdtos2A = nRdtos2A + #dsm18431#11;
             nRdtos2B = nRdtos2B + #dsm18431#12;
             nRdtos2C = nRdtos2C + #dsm18431#13;
             nRdtos2D = nRdtos2D + #dsm18431#14;
         |SINO;
             nRdtos4 = nRdtos4 + #dsm18431#8;
         |FINSI;
     |SINO;
         |SI #dsm18431#9 = "N";
             nRdtos5 = nRdtos5 + #dsm18431#6;
             nRdtos6 = nRdtos6 + #dsm18431#7;
             nRdtos7 = nRdtos7 + #dsm18431#8;
             nRdtos6A = nRdtos6A + #dsm18431#11;
             nRdtos6B = nRdtos6B + #dsm18431#12;
             nRdtos6C = nRdtos6C + #dsm18431#13;
             nRdtos6D = nRdtos6D + #dsm18431#14;
         |SINO;
             nRdtos8 = nRdtos8 + #dsm18431#8;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18431;
     #dsm18431#1;
     ;
     #dsm18406#0, #dsm18406#1, #dsm18406#2, #dsm18406#3, "  ", " ";
     #dsm18406#0, #dsm18406#1, #dsm18406#2, #dsm18406#3, "zz", "z";
     ;
     NULL, dsm18431;
|FIN;

|PROCESO dsm18406;
     nRdtos1  = 0;
     nRdtos2  = 0;
     nRdtos3  = 0;
     nRdtos4  = 0;
     nRdtos5  = 0;
     nRdtos6  = 0;
     nRdtos7  = 0;
     nRdtos8  = 0;
     nRdtos2A = 0;
     nRdtos2B = 0;
     nRdtos2C = 0;
     nRdtos2D = 0;
     nRdtos6A = 0;
     nRdtos6B = 0;
     nRdtos6C = 0;
     nRdtos6D = 0;
     |BUCLE dsm18431;

     |SI #dsm18406#7 ! 0;  |O #dsm18406#8 ! 0;  |O #dsm18406#9 ! 0;
         |SI #dsmoy056#45 = "    ";
             #dsmoy056#43 = #dsm18406#4;
             #dsmoy056#44 = #dsm18406#5;
             #dsmoy056#45 = #dsm18406#6;
             #dsmoy056#46 = nRdtos1;
             #dsmoy056#47 = nRdtos2;
             #dsmoy056#48 = nRdtos3;
             #dsmoy056#49 = nRdtos4;
             #dsmoy056#156 = nRdtos2A;
             #dsmoy056#157 = nRdtos2B;
             #dsmoy056#158 = nRdtos2C;
             #dsmoy056#159 = nRdtos2D;
         |SINO;
             #dsmoy056#50 = #dsm18406#4;
             #dsmoy056#51 = #dsm18406#5;
             #dsmoy056#52 = #dsm18406#6;
             #dsmoy056#53 = #dsmoy056#53 + nRdtos1;
             #dsmoy056#54 = #dsmoy056#54 + nRdtos2;
             #dsmoy056#55 = #dsmoy056#55 + nRdtos3;
             #dsmoy056#56 = #dsmoy056#56 + nRdtos4;
             #dsmoy056#160 = #dsmoy056#160 + nRdtos2A;
             #dsmoy056#161 = #dsmoy056#161 + nRdtos2B;
             #dsmoy056#162 = #dsmoy056#162 + nRdtos2C;
             #dsmoy056#163 = #dsmoy056#163 + nRdtos2D;
         |FINSI;
     |FINSI;

     |SI #dsm18406#10 ! 0;  |O #dsm18406#11 ! 0;  |O #dsm18406#12 ! 0;
         #dsmoy056#57 = #dsm18406#4;
         #dsmoy056#58 = #dsm18406#5;
         #dsmoy056#59 = #dsm18406#6;
         #dsmoy056#60 = #dsmoy056#60 + nRdtos5;
         #dsmoy056#61 = #dsmoy056#61 + nRdtos6;
         #dsmoy056#62 = #dsmoy056#62 + nRdtos7;
         #dsmoy056#63 = #dsmoy056#63 + nRdtos8;
         #dsmoy056#164 = #dsmoy056#164 + nRdtos6A;
         #dsmoy056#165 = #dsmoy056#165 + nRdtos6B;
         #dsmoy056#166 = #dsmoy056#166 + nRdtos6C;
         #dsmoy056#167 = #dsmoy056#167 + nRdtos6D;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18406;
     #dsm18406#1;
     ;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 001;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 999;
     ;
     NULL, dsm18406;
|FIN;

|PROCESO dsm18408;
     |SI #dsm18408#4 = "ES";
         #dsmoy056#64 = "ES";
         |SI #dsm18408#5 = "G";
             #dsmoy056#65 = #dsmoy056#65 + #dsm18408#6;
         |SINO;
             #dsmoy056#66 = #dsmoy056#66 + #dsm18408#6;
         |FINSI;
     |SINO;
         |SI #dsmoy056#67 = "  ";
             #dsmoy056#67 = #dsm18408#4;
         |FINSI;
         |SI #dsm18408#5 = "G";
             #dsmoy056#68 = #dsmoy056#68 + #dsm18408#6;
         |SINO;
             #dsmoy056#69 = #dsmoy056#69 + #dsm18408#6;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18408;
     #dsm18408#1;
     ;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 001;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 999;
     ;
     NULL, dsm18408;
|FIN;

|PROCESO dsm18409;
     |SI #dsm18409#5 = "ES";
         |SI #dsm18409#9 = "N";
             |SI #dsm18409#6 = "G";
                 #dsmoy056#70 = #dsmoy056#70 + #dsm18409#7;
             |SINO;
                 #dsmoy056#71 = #dsmoy056#71 + #dsm18409#7;
             |FINSI;
         |SINO;
             |SI #dsm18409#4 = "N";
                 |SI #dsm18409#6 = "G";
                     #dsmoy056#75 = #dsmoy056#75 + #dsm18409#7;
                 |SINO;
                     #dsmoy056#76 = #dsmoy056#76 + #dsm18409#7;
                 |FINSI;
             |SINO;
                 |SI #dsm18409#6 = "G";
                     #dsmoy056#80 = #dsmoy056#80 + #dsm18409#7;
                 |SINO;
                     #dsmoy056#81 = #dsmoy056#81 + #dsm18409#7;
                 |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         |SI #dsm18409#9 = "N";
             |SI #dsmoy056#72 = "  ";  #dsmoy056#72 = #dsm18409#5;  |FINSI;
             |SI #dsm18409#6 = "G";
                 #dsmoy056#73 = #dsmoy056#73 + #dsm18409#7;
             |SINO;
                 #dsmoy056#74 = #dsmoy056#74 + #dsm18409#7;
             |FINSI;
         |SINO;
             |SI #dsm18409#4 = "N";
                 |SI #dsmoy056#77 = "  ";  #dsmoy056#77 = #dsm18409#5;  |FINSI;

                 |SI #dsm18409#6 = "G";
                     #dsmoy056#78 = #dsmoy056#78 + #dsm18409#7;
                 |SINO;
                     #dsmoy056#79 = #dsmoy056#79 + #dsm18409#7;
                 |FINSI;
             |SINO;
                 |SI #dsmoy056#82 = "  ";  #dsmoy056#82 = #dsm18409#5;  |FINSI;

                 |SI #dsm18409#6 = "G";
                     #dsmoy056#83 = #dsmoy056#83 + #dsm18409#7;
                 |SINO;
                     #dsmoy056#84 = #dsmoy056#84 + #dsm18409#7;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18409;
     #dsm18409#1;
     ;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 001;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 999;
     ;
     NULL, dsm18409;
|FIN;

|PROCESO dsm18415;
     |SI #dsm18415#4 = "ES";
         #dsmoy056#142 = "ES";
         |SI #dsm18415#5 = "G";
             #dsmoy056#143 = #dsmoy056#143 + #dsm18415#6;
         |SINO;
             #dsmoy056#144 = #dsmoy056#144 + #dsm18415#6;
         |FINSI;
     |SINO;
         |SI #dsmoy056#145 = "  ";
             #dsmoy056#145 = #dsm18415#4;
         |FINSI;

         |SI #dsm18415#5 = "G";
             #dsmoy056#146 = #dsmoy056#146 + #dsm18415#6;
         |SINO;
             #dsmoy056#147 = #dsmoy056#147 + #dsm18415#6;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18415;
     #dsm18415#1;
     ;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 001;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 999;
     ;
     NULL, dsm18415;
|FIN;


|PROCESO Acumula;
     #dsmow114#0 = #dsm18430#0;
     #dsmow114#1 = #dsm18430#1;
     #dsmow114#2 = #dsm18430#2;
     |LEE 101#dsmow114.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow114;
         #dsmow114#0 = #dsm18430#0;
         #dsmow114#1 = #dsm18430#1;
         #dsmow114#2 = #dsm18430#2;
         |GRABA 020#dsmow114.b;
     |FINSI;

     #dsmow114#3  = #dsmow114#3  + #dsm18430#12;
     #dsmow114#4  = #dsmow114#4  + #dsm18430#13;
     #dsmow114#5  = #dsmow114#5  + #dsm18430#43;
     #dsmow114#6  = #dsmow114#6  + #dsm18430#44;
     #dsmow114#7  = #dsmow114#7  + #dsm18430#14;
     #dsmow114#8  = #dsmow114#8  + #dsm18430#15;
     #dsmow114#9  = #dsmow114#9  + #dsm18430#16;
     #dsmow114#10 = #dsmow114#10 + #dsm18430#17;
     #dsmow114#11 = #dsmow114#11 + #dsm18430#18;
     #dsmow114#12 = #dsmow114#12 + #dsm18430#19;
     #dsmow114#13 = #dsmow114#13 + #dsm18430#20;
     #dsmow114#14 = #dsmow114#14 + #dsm18430#21;
     #dsmow114#15 = #dsmow114#15 + #dsm18430#22;
     #dsmow114#33 = #dsmow114#33 + #dsm18430#49;
     #dsmow114#34 = #dsmow114#34 + #dsm18430#50;

     |SI #dsm18430#23 = "X";
         #dsmow114#16 = #dsmow114#16 + #dsm18430#25;
         #dsmow114#17 = #dsmow114#17 + #dsm18430#26;
         #dsmow114#18 = #dsmow114#18 + #dsm18430#27;
         #dsmow114#19 = #dsmow114#19 + #dsm18430#28;
         #dsmow114#20 = #dsmow114#20 + #dsm18430#29;
         #dsmow114#21 = #dsmow114#21 + #dsm18430#30;
     |FINSI;

     |SI #dsm18430#24 = "X";
         #dsmow114#22 = #dsmow114#22 + #dsm18430#25;
         #dsmow114#23 = #dsmow114#23 + #dsm18430#26;
         #dsmow114#24 = #dsmow114#24 + #dsm18430#27;
         #dsmow114#25 = #dsmow114#25 + #dsm18430#28;
         #dsmow114#26 = #dsmow114#26 + #dsm18430#29;
         #dsmow114#27 = #dsmow114#27 + #dsm18430#30;
     |FINSI;

     #dsmow114#28 = #dsmow114#28 + #dsm18430#31;
     #dsmow114#29 = #dsmow114#29 + #dsm18430#45;
     #dsmow114#30 = #dsmow114#30 + #dsm18430#46;
     #dsmow114#31 = #dsmow114#31 + #dsm18430#47;
     #dsmow114#32 = #dsmow114#32 + #dsm18430#48;
     #dsmow114#33 = #dsmow114#33 + #dsm18430#49;
     #dsmow114#34 = #dsmow114#34 + #dsm18430#50;

     |GRABA 020#dsmow114.a;
     |LIBERA #dsmow114;
|FPRC;

|PROCESO dsm18430;
     |SI nSwImprime = 0;
         |HAZ Acumula;
         |ACABA;
     |FINSI;

     nSwBorra = 1;

     #dsmow114#0 = #dsm18430#0;
     #dsmow114#1 = #dsm18430#1;
     #dsmow114#2 = #dsm18430#2;
     |LEE 101#dsmow114.=;
     |SI FSalida ! 0;
        nSwBorra = 0;
        |DDEFECTO #dsmow114;
     |FINSI;

     |PDEFECTO #dsmoy056, 102, 129;
     |PDEFECTO #dsmoy056, 134, 139;
     |PDEFECTO #dsmoy056, 154, 155;

     #dsmoy056#175 = 0;
     #dsmoy056#102 = #dsm18430#4;
     #dsmoy056#103 = #dsm18430#2;
     #dsmoy056#104 = #dsm18430#5;
     #dsmoy056#107 = #dsm18430#11;

     #dsmoy056#108 = #dsmow114#3  + #dsm18430#12;
     #dsmoy056#109 = #dsmow114#4  + #dsm18430#13;
     #dsmoy056#152 = #dsmow114#5  + #dsm18430#43;
     #dsmoy056#153 = #dsmow114#6  + #dsm18430#44;
     #dsmoy056#110 = #dsmow114#7  + #dsm18430#14;
     #dsmoy056#111 = #dsmow114#8  + #dsm18430#15;
     #dsmoy056#112 = #dsmow114#9  + #dsm18430#16;
     #dsmoy056#113 = #dsmow114#10 + #dsm18430#17;
     #dsmoy056#139 = #dsmow114#11 + #dsm18430#18;
     #dsmoy056#114 = #dsmow114#12 + #dsm18430#19;
     #dsmoy056#115 = #dsmow114#13 + #dsm18430#20;
     #dsmoy056#116 = #dsmow114#14 + #dsm18430#21;
     #dsmoy056#117 = #dsmow114#15 + #dsm18430#22;
     #dsmoy056#154 = #dsmow114#33 + #dsm18430#49;
     #dsmoy056#155 = #dsmow114#34 + #dsm18430#50;

     |SI #dsm18430#23 = "X";
         #dsmow114#16 = #dsmow114#16 + #dsm18430#25;
         #dsmow114#17 = #dsmow114#17 + #dsm18430#26;
         #dsmow114#18 = #dsmow114#18 + #dsm18430#27;
         #dsmow114#19 = #dsmow114#19 + #dsm18430#28;
         #dsmow114#20 = #dsmow114#20 + #dsm18430#29;
         #dsmow114#21 = #dsmow114#21 + #dsm18430#30;
     |FINSI;

     |SI #dsm18430#24 = "X";
         #dsmow114#22 = #dsmow114#22 + #dsm18430#25;
         #dsmow114#23 = #dsmow114#23 + #dsm18430#26;
         #dsmow114#24 = #dsmow114#24 + #dsm18430#27;
         #dsmow114#25 = #dsmow114#25 + #dsm18430#28;
         #dsmow114#26 = #dsmow114#26 + #dsm18430#29;
         #dsmow114#27 = #dsmow114#27 + #dsm18430#30;
     |FINSI;

     #dsmoy056#118 = #dsmow114#16;
     #dsmoy056#119 = #dsmow114#17;
     #dsmoy056#120 = #dsmow114#18;
     #dsmoy056#121 = #dsmow114#19;
     #dsmoy056#122 = #dsmow114#20;
     #dsmoy056#123 = #dsmow114#21;
     #dsmoy056#175 = #dsmoy056#123;

     |SI #dsmoy056#14 < 2015;
         #dsmoy056#124 = #dsmow114#22;
         #dsmoy056#125 = #dsmow114#23;
         #dsmoy056#126 = #dsmow114#24;
         #dsmoy056#127 = #dsmow114#25;
         #dsmoy056#128 = #dsmow114#26;
         #dsmoy056#129 = #dsmow114#27;
     |SINO;
         #dsmoy056#125 = #dsmow114#22;
         #dsmoy056#126 = #dsmow114#23;
         #dsmoy056#128 = #dsmow114#24;
         #dsmoy056#129 = #dsmow114#25;
     |FINSI;

     #dsmow114#28 = #dsmow114#28 + #dsm18430#31;
     #dsmow114#29 = #dsmow114#29 + #dsm18430#45;
     #dsmow114#30 = #dsmow114#30 + #dsm18430#46;
     #dsmow114#31 = #dsmow114#31 + #dsm18430#47;
     #dsmow114#32 = #dsmow114#32 + #dsm18430#48;
     #dsmow114#33 = #dsmow114#33 + #dsm18430#49;
     #dsmow114#34 = #dsmow114#34 + #dsm18430#50;

     #dsmoy056#138 = #dsmow114#28;
     #dsmoy056#134 = #dsmow114#29;
     #dsmoy056#135 = #dsmow114#30;
     #dsmoy056#136 = #dsmow114#31;
     #dsmoy056#137 = #dsmow114#32;

     #dsmoy056#130 = #dsmow114#28 + #dsmow114#29 + #dsmow114#30 + #dsmow114#31 + #dsmow114#32;
     #dsmoy056#130 = #dsmoy056#130 + #dsmow114#33 + #dsmow114#34;
     #dsmoy056#130 = #dsmoy056#130 + #dsm18430#31 + #dsm18430#45 + #dsm18430#46 + #dsm18430#47 + #dsm18430#48;
     #dsmoy056#130 = #dsmoy056#130 + #dsm18430#49 + #dsm18430#50;

     nError = 0;
     |HAZ AbreWord;

     |SI nSwBorra = 1;
         |BORRA 020#dsmow114.a;
         |LIBERA #dsmow114;
     |FINSI;

     |SI nError = 1;  |ERROR10;  |FINSI;
|FPRC;

|DEFBUCLE dsm18430;
     #dsm18430#1;
     ;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 001;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 999;
     ;
     NULL, dsm18430;
|FIN;

|PROCESO dsm18401;
     |SI nLectura = 0;
         |SI #dsm18401#3 ! 0;
             |SI #dsm18401#5 = "S";
                 nDComple = #dsm18401#3;
                 nHComple = #dsm18401#3;
             |SINO;
                 nHComple = #dsm18401#3;
             |FINSI;
         |SINO;
             nDComple = #dsm18401#3;
             nHComple = #dsm18401#3;
         |FINSI;
         |ACABA;
     |FINSI;

     #dsmoy056#16  = #dsm18401#26;
     #dsmoy056#17  = #dsm18401#25;
     #dsmoy056#18  = #dsm18401#9;
     #dsmoy056#19  = #dsm18401#14;
     #dsmoy056#20  = #dsm18401#10;
     #dsmoy056#21  = #dsm18401#11;
     #dsmoy056#22  = #dsm18401#8;
     #dsmoy056#85  = #dsm18401#38;
     #dsmoy056#86  = #dsm18401#39;
     #dsmoy056#87  = #dsm18401#40;
     #dsmoy056#88  = #dsm18401#41;
     #dsmoy056#89  = #dsm18401#42;
     #dsmoy056#90  = #dsm18401#43;
     #dsmoy056#174 = #dsmoy056#89;
     #dsmoy056#91  = #dsm18401#44;
     #dsmoy056#92  = #dsm18401#45;
     #dsmoy056#93  = #dsm18401#46;
     #dsmoy056#94  = #dsm18401#47;
     #dsmoy056#95  = #dsm18401#48;
     #dsmoy056#96  = #dsm18401#49;
     #dsmoy056#97  = #dsm18401#50;
     #dsmoy056#98  = #dsm18401#51;
     #dsmoy056#99  = #dsm18401#52;
     #dsmoy056#100 = #dsm18401#53;
     #dsmoy056#101 = #dsm18401#54;
     #dsmoy056#148 = #dsm18401#34;
     #dsmoy056#149 = #dsm18401#35;
     #dsmoy056#150 = #dsm18401#36;
     #dsmoy056#151 = #dsm18401#37;

     aAlfa1 = #dsmoy056#15 % 102;
     aAlfa2 = #dsmoy056#15 % 402;
     aAlfa3 = #dsmoy056#15 % -104;

     |SI aAlfa2 = "01";  aAlfa2 = "Enero";      |FINSI;
     |SI aAlfa2 = "02";  aAlfa2 = "Febrero";    |FINSI;
     |SI aAlfa2 = "03";  aAlfa2 = "Marzo";      |FINSI;
     |SI aAlfa2 = "04";  aAlfa2 = "Abril";      |FINSI;
     |SI aAlfa2 = "05";  aAlfa2 = "Mayo";       |FINSI;
     |SI aAlfa2 = "06";  aAlfa2 = "Junio";      |FINSI;
     |SI aAlfa2 = "07";  aAlfa2 = "Julio";      |FINSI;
     |SI aAlfa2 = "08";  aAlfa2 = "Agosto";     |FINSI;
     |SI aAlfa2 = "09";  aAlfa2 = "Septiembre"; |FINSI;
     |SI aAlfa2 = "10";  aAlfa2 = "Octubre";    |FINSI;
     |SI aAlfa2 = "11";  aAlfa2 = "Noviembre";  |FINSI;
     |SI aAlfa2 = "12";  aAlfa2 = "Diciembre";  |FINSI;

     #dsmoy056#132 = aAlfa1 + " de " + aAlfa2 + " de " + aAlfa3;
     #dsmoy056#133 = #dsmoy056#14;
     #dsmoy056#131 = aPoblacion;

     |BUCLE dsm18403;
     |BUCLE dsm18405;
     |BUCLE dsm18406;
     |BUCLE dsm18408;
     |BUCLE dsm18409;
     |BUCLE dsm18415;

     |SALVA_FICHA #dsm18401;
     nEmpresa   = #dsm18401#0;
     nEjercicio = #dsm18401#1;
     |LEE 000#dsm18401.s;
     |SI FSalida = 0; |Y #dsm18401#5 = "C"; |Y #dsm18401#0 = nEmpresa; |Y #dsm18401#1 = nEjercicio;
         nSwImprime = 0;
     |SINO;
         nSwImprime = 1;
     |FINSI;
     |REPON_FICHA #dsm18401;

     |BUCLE dsm18430;

     |SI nError = 1;
         |MENAV "0000No se puede crear documentos en PDF, revise la impresora DSPDF.";
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE dsm18401;
     #dsm18401#1;
     ;
     #dsmow014#0, #dsmow014#1, 184, nDComple;
     #dsmow014#0, #dsmow014#1, 184, nHComple;
     ;
     NULL, dsm18401;
|FIN;

|PROCESO dsmow014;
    aAlfa = "tm" + Usuario; |NOME_DAT #dsmow114#aAlfa#;
    |DELINDEX #dsmow114; |ABRE #dsmow114;

    |PDEFECTO #dsmoy056, 16, 176;

    nDComple  = 0;
    nHComple  = 99;

    nLectura  = 0;  |BUCLE dsm18401;
    nLectura  = 1;  |BUCLE dsm18401;

    |CIERRA #dsmow114; |DELINDEX #dsmow114;
|FPRC;

|DEFBUCLE dsmow014;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, dsmow014;
|FIN;

|PROCESO dsmom004;
     enEmpresaPINET = #dsmom004#0;
     |HAZ RestriccionPINET;
     |SI enErrorPINET = 1;  |ACABA;  |FINSI;

     enCodCli = #dsmom004#0;
     |HAZ LeePersona;

     #dsmow014#0  = #dsmom004#0;
     #dsmow014#1  = #dsmom004#1;
     #dsmow014#2  = #dsmom004#2;
     |LEE 101#dsmow014.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow014;
         #dsmow014#0  = #dsmom004#0;
         #dsmow014#1  = #dsmom004#1;
         #dsmow014#2  = #dsmom004#2;
         |GRABA 020#dsmow014.b;
     |FINSI;

     #dsmow014#3  = #clientes@#1;
     #dsmow014#4  = "ANUAL";
     #dsmow014#5  = #dsmoy056#30;
     #dsmow014#6  = "S";
     #dsmow014#7  = #dsmom004#4;
     |GRABA 020#dsmow014.a;
     |LIBERA #dsmow014;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE dsmom004;
     #dsmom004#1;
     ;
     nDEmpresa, #dsmoy056#14, 99, 184, 00;
     nHEmpresa, #dsmoy056#14, 99, 184, 99;
     ;
     NULL, dsmom004;
|FIN;

|PROCESO BorraPlant;
     |ABRE #wordm000;
     #wordm000#0 = "modelos";
     #wordm000#1 = "dsmoy056";
     #wordm000#2 = aWord;
     |LEE 101#wordm000.=;
     |SI FSalida = 0;
         |BORRA 020#wordm000.a;
         |LIBERA #wordm000;

         aAbre1 = aPathDoc + aWord;
         |FBORRA aAbre1;
     |FINSI;
     |CIERRA #wordm000;
|FPRC;

|PROCESO InstalaDocs;
     nOk = 1;

     |SUB_EJECUTA_NP ":basica/wordm000;CREALOS";

     |DBASS aPath; |QBF aPath;
     aPathDoc = aPath + "basica/word/";

     nBytes = 0;
     aAbre1 = aPathDoc + "word1646.doc";
     |XABRE "B", aAbre1, nHandle;
     |SI FSalida < 0;
         nBytes = 1;
     |SINO;
         nBytes = 0;
         |XPOSICION nHandle, nBytes, 2;
     |FINSI;
     |XCIERRA nHandle;

     |SI nBytes = 117248;
         aWord = "word0046.doc";  |HAZ BorraPlant;
         aWord = "word1046.doc";  |HAZ BorraPlant;
         aWord = "word2046.doc";  |HAZ BorraPlant;
         aWord = "word1546.doc";  |HAZ BorraPlant;
         aWord = "word1646.doc";  |HAZ BorraPlant;

         |SUB_EJECUTA_NP ":basica/wordm000;CREALOS";
     |FINSI;

     |DBASS aPath; |QBF aPath;
     aPathDoc = aPath + "basica/word/";

     aAbre1 = aPathDoc + "word0046.doc";
     |XABRE "E", aAbre1, nHandle;
     |SI FSalida < 0;
         |MENAV "     Instale Ficheros patrones (Documentos en Word)";

         nOk = 0;  |ACABA;
     |FINSI;
     |XCIERRA nHandle;

     aAbre1 = aPathDoc + "word1046.doc";
     |XABRE "E", aAbre1, nHandle;
     |SI FSalida < 0;
         |MENAV "     Instale Ficheros patrones (Documentos en Word)";

         nOk = 0;  |ACABA;
     |FINSI;
     |XCIERRA nHandle;

     aAbre1 = aPathDoc + "word2046.doc";
     |XABRE "E", aAbre1, nHandle;
     |SI FSalida < 0;
         |MENAV "     Instale Ficheros patrones (Documentos en Word)";

         nOk = 0;  |ACABA;
     |FINSI;
     |XCIERRA nHandle;

     aAbre1 = aPathDoc + "word1546.doc";
     |XABRE "E", aAbre1, nHandle;
     |SI FSalida < 0;
         |MENAV "     Instale Ficheros patrones (Documentos en Word)";

         nOk = 0;  |ACABA;
     |FINSI;
     |XCIERRA nHandle;

     aAbre1 = aPathDoc + "word1646.doc";
     |XABRE "E", aAbre1, nHandle;
     |SI FSalida < 0;
         |MENAV "     Instale Ficheros patrones (Documentos en Word)";

         nOk = 0;  |ACABA;
     |FINSI;
     |XCIERRA nHandle;
|FPRC;

|PROCESO CreaDocus;
     nPrimero  = 0;
     nContaDoc = 0;

     |BUCLE dsmow014;
|FPRC;

|PROCESO GrabaBat;
     aAlfa = aAlfa +  &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO UnePdf;
     aFicBat = eaDirTrabajo + "junta.bat";
     |XABRE "CBW", aFicBat, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aAlfa = "@echo off";                               |HAZ GrabaBat;
     aAlfa = "cd " + eaDirTrabajo;                      |HAZ GrabaBat;
     aAlfa = "pdfjunta *.pdf cat output pdfcerti.pdf";  |HAZ GrabaBat;
     aAlfa = "";                                        |HAZ GrabaBat;
     aAlfa = "exit";                                    |HAZ GrabaBat;

     |XCIERRA nHandle;

     eaOrigen  = eaDirSerPlan + "dsmini.exe";
     eaDestino = eaDirTrabajo + "dsmini.exe";
     |HAZ EnviaFichero;

     eaOrigen  = eaDirSerPlan + "pdfjunta.exe";
     eaDestino = eaDirTrabajo + "pdfjunta.exe";
     |HAZ EnviaFichero;

     eaOrigen  = eaDirSerPlan + "libiconv2.dll";
     eaDestino = eaDirTrabajo + "libiconv2.dll";
     |HAZ EnviaFichero;

     aEjec = "cmd " + &34 + "/c START /WAIT ";
     aEjec = aEjec + eaDirTrabajo + "dsmini.exe" + " ";
     aEjec = aEjec + aFicBat + " ";
     aEjec = aEjec + eaDirTrabajo + "fin.txt" + &34;

     aFlag = eaDirTrabajo + "fin.txt";
     |RSYSTEM aEjec;

     nPausa = -1;
     |PARA nNume = 0; |SI nPausa < 0; |Y nNume < 100000; |HACIENDO nNume = nNume + 1;
          |XABRE "CE", aFlag, nPausa;
          nPausa = FSalida;
          |PULSATECLA;
     |SIGUE;
     |XCIERRA nPausa;

     |SI nNume ] 100000;
          aAlfa = "    ATENCION. Se ha producido un error en la creaci¢n del PDF";
          |MENAV aAlfa;
     |FINSI;

     aFichero = eaDirTrabajo + "fin.txt";
     |RFBORRA aFichero;
|FPRC;

|PROCESO Papel;
     nArchivo  = 0;
     |SI nContaDoc > 1;
         |HAZ UnePdf;
     |SINO;
         aNomFic   = (("00000000" + nContaDoc) % -108);
         eaOrigen  = eaDirTrabajo  + aNomFic;
         eaDestino = eaDirTrabajo  + "pdfcerti.pdf";
         |RCOPIA_FICHERO eaOrigen, eaDestino;
     |FINSI;

     aAlfa = eaDirTrabajo  + "pdfcerti.pdf";
     |XABRE "EC", aAlfa, 0;
     |SI FSalida < 0;
         |MENAV "0000Ha habido un error inesperado. Consulte con su administrador";
         |ACABA;
     |FINSI;

     eaOrigen  = eaDirSerPlan + "dsabreextension.exe";
     eaDestino = eaDirTrabajo + "dsabreextension.exe";
     |HAZ EnviaFichero;

     |XABRE "EC", eaDestino, 0;
     |SI FSalida < 0;
         |MENAV "0000No encuento el dsabreextension. Actualice ipbasica";
         |ACABA;
     |FINSI;

     aEjec = "START " + eaDirTrabajo + "dsabreextension ";
     aEjec = aEjec + eaDirTrabajo + "pdfcerti.pdf";
     aEjec = aEjec + " " + eaDirTrabajo + "fin" + Usuario + ".txt";

     aAlfa = eaDirTrabajo + "fin" + Usuario + ".txt";
     |RFBORRA aAlfa;

     |RSYSTEM aEjec;
     aAlfa    = eaDirTrabajo + "fin" + Usuario + ".txt";
     |PARA;  |SI;  |HACIENDO;
             |XABRE "EC", aAlfa, nHandle;
             |SI FSalida ] 0;
                 |SAL;
             |FINSI;

             |PARA nPausa = 1; |SI nPausa < 10000; |HACIENDO nPausa = nPausa + 1;
             |SIGUE;
             |PULSATECLA;
     |SIGUE;
     |PULSATECLA;
|FPRC;

|PROCESO Archivado;
     nArchivo  = 1;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;

     |HAZ InstalaDocs;
     |SI nOk = 0;  |ACABA;  |FINSI;

     aDocWord   = "word0046.doc";
     nNumCampos = 133;

     |SI #dsmoy056#14 ] 2010;  |Y #dsmoy056#14 [ 2012;
         aDocWord   = "word1046.doc";
         nNumCampos = 139;
     |FINSI;

     |SI #dsmoy056#14 ] 2013;
         aDocWord   = "word2046.doc";
         nNumCampos = 155;
     |FINSI;

     |SI #dsmoy056#14 = 2015;
         aDocWord   = "word1546.doc";
         nNumCampos = 175;
     |FINSI;

     |SI #dsmoy056#14 ] 2016;
         aDocWord   = "word1646.doc";
         nNumCampos = 175;
     |FINSI;

     aPoblacion = #dsmoy056#131;
     aFichero   = ("cer" + Usuario) % 108;
     |NOME_DAT #dsmow014#aFichero#;
     |ABRE #dsmow014;  |CIERRA #dsmow014;  |DELINDEX #dsmow014;

     nSwGraba = 0;
     |ABRE #dsmow014;
     |SI #dsmoy056#0 ! 0;
         nDEmpresa = #dsmoy056#0;
         nHEmpresa = #dsmoy056#1;
         |BUCLE dsmom004;
     |SINO;
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               nDEmpresa = #dsmoy056#nCampo#;
               nHEmpresa = #dsmoy056#nCampo#;
               |BUCLE dsmom004;
         |SIGUE;
     |FINSI;
     |CIERRA #dsmow014;

     |SI nSwGraba = 0;
          |MENAV "     Seleccion Vacia.";
          |DELINDEX #dsmow014;
          |ACABA;
     |FINSI;

     eaVengoDe = "dsmoy056";
     |HAZ MiraSiArchiva;
     |SI enArchi = 0;
         nOpcion = 1;
     |SINO;
         |MENU aMenu;
         nOpcion = FSalida;
     |FINSI;

     |SI nOpcion ] 1;  |Y nOpcion [ 3;
          |HAZ CreaDocus;
     |FINSI;

     |SI nOpcion = 1;  |HAZ Papel;      |FINSI;
     |SI nOpcion = 3;  |HAZ Papel;      |FINSI;

     |DELINDEX #dsmow014;
|FPRC;

|| Procesos de la Pantalla __________________________________________________

|PROCESO ElAny; |TIPO 7;
     fFecha = ~;
     aAlfa1 = fFecha;
     aAlfa1 = aAlfa1 % -104;
     #dsmoy056#14 = aAlfa1;
     #dsmoy056#14 = #dsmoy056#14 - 1;
     |PINTA #dsmoy056#14;
|FPRC;

|PROCESO Tipo7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #dsmoy056#0 = enEmpresa;  |PINTA #dsmoy056#0;
         #dsmoy056#1 = enEmpresa;  |PINTA #dsmoy056#1;

         |C_M #dsmoy056#0, 1, "N";
         |C_M #dsmoy056#1, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Parrilla;
     |SI #dsmoy056#0 = 0;
         #dsmoy056#0 = 0;  |PINTA #dsmoy056#0;
         #dsmoy056#1 = 0;  |PINTA #dsmoy056#1;  |C_M #dsmoy056#1, 1, "N";
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy056#nCampo#, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #dsmoy056#0, 1, "S";
             |C_M #dsmoy056#1, 1, "S";
         |FINSI;

         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy056#nCampo#, 1, "N";
               #dsmoy056#nCampo# = 0;  |PINTA #dsmoy056#nCampo#;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #dsmoy056#Campo# = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               #dsmoy056#nCampo# = 0;  |C_M #dsmoy056#nCampo#, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy056#nCampo#, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoVale;
     |HAZ MensaCliente;
|FPRC;

|PROCESO T80;  |TIPO 80;
     |HAZ LeeUnidadBasico;

     aAlfa = eaUnidadBasico + "/MODELOS";                   |RMKDIR aAlfa;
     aAlfa = eaUnidadBasico + "/MODELOS/DOCUMENTOS";        |RMKDIR aAlfa;
     aAlfa = eaUnidadBasico + "/MODELOS/DOCUMENTOS/DSXML";  |RMKDIR aAlfa;

     |DBASS aBase;
     |DBASE aBaseApli;

     eaDirPlantilla = eaUnidadBasico + "\MODELOS\DOCUMENTOS\DSXML\";
     eaDirTrabajo   = eaDirPlantilla;
     eaDirTrabServi = aBaseApli + "tmp";                   |MKDIR eaDirTrabServi;
     eaDirTrabServi = aBaseApli + "tmp/" + Usuario;        |MKDIR eaDirTrabServi;
     eaDirTrabServi = aBaseApli + "tmp/" + Usuario + "/";
     eaDirSerPlan   = aBase + "basica/plantillas/";

     |HAZ BorraDocus;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |HAZ BorraDocus;
|FPRC;
