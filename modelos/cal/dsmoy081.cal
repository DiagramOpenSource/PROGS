|FICHEROS;
     dsmoy081;

     dsm190ca;
     dsm190li;
     dsm19001;

     :/basica/def/agifigen;

     :/laboral/def/nomir003;

     dsmow107;
|FIN;

|VARIABLES;
     aPathLaboral      = "";
     nHandle           = 0;
     aBase             = "";
     aFichero          = "";

     aAlfa             = "";
     aAlfa1            = "";
     nNume1            = 0;
     fFecha            = @;

     nHay              = 0;
     nDEmpresa         = 0;
     nHEmpresa         = 0;
     nComplem          = 0;
     nEjer             = 0;
     nEmpresa          = 0;

     nError            = 0;
     &enErrores        = 0;
     nTRela            = 0;
|FIN;

|INCLUYE i_variar;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\
|PROCESO eldefecto; |TIPO 7;
     fFecha = ~;
     aAlfa  = fFecha;
     aAlfa  = aAlfa % -104;
     nNume1 = aAlfa;
     nNume1 = nNume1 - 1;
     #dsmoy081#0 = nNume1; |PINTA #dsmoy081#0;
|FPRC;

|| /////////////////////// PROCESOS DE IMPRESION \\\\\\\\\\\\\\\\\\\\
|PROCESO dsmow1017;
   enErrores = enErrores + 1;
   |PRINT;
|FPRC;

|DEFBUCLE dsmow1017;
     #dsmow107#1;
     17;
     nDEmpresa, enEjer, enPeriodo, enModelo, 00, 00, "            ", 0000, " ", "  ", 0, "X";
     nHEmpresa, enEjer, enPeriodo, enModelo, 99, 99, "zzzzzzzzzzzz", 9999, "z", "zz", 9, "X";
     ;
     NULL, dsmow1017;
|FIN;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\

|PROCESO dsm190li;
     |SI #dsm190li#8 ! "A"; |Y #dsm190li#8 ! "B";  |Y #dsm190li#8 ! "C";  |Y #dsm190li#8 ! "D"; |Y #dsm190li#8 ! "E";
         |ACABA;
     |FINSI;

     nTRela     = 0;
     enImporte3 = 0;
     enImporte4 = 0;

     nError = 0;
     |DDEFECTO #nomir003;
     |PARA nEjer = #dsm190li#1;  |SI nEjer ] 2000;  |HACIENDO nEjer = nEjer - 1;
           #nomir003#0  = #dsm190li#6;
           #nomir003#40 = nEjer;
           #nomir003#41 = #dsm190li#0;
           |LEE 040#nomir003.=;
           |SI FSalida = 0;
               |SI #nomir003#40 = #dsm190li#1; ||  |SI enTRela = #nomir003#5; |O enBRela ! 0;
                   enImporte3 = #nomir003#13;
                   enImporte4 = #nomir003#12;
                   nTRela     = #nomir003#5;
               |FINSI;
               nError = 0;
               |SAL;
           |SINO;
               nError = 1;
           |FINSI;
     |SIGUE;

     |SI nError ! 0;  |ACABA;  |FINSI;

     |DDEFECTO #dsmow107;
     #dsmow107#0  = #dsm190li#0;
     #dsmow107#1  = #dsm190li#1;
     #dsmow107#2  = #dsm190li#2;
     #dsmow107#3  = #dsm190li#3;
     #dsmow107#4  = #dsm190li#4;
     #dsmow107#5  = #dsm190li#5;
     #dsmow107#6  = #dsm190li#6;
     #dsmow107#7  = #dsm190li#7;
     #dsmow107#8  = #dsm190li#8;
     #dsmow107#9  = #dsm190li#9;
     #dsmow107#10 = #dsm190li#10;
     |LEE 101#dsmow107.=;
     |SI FSalida ! 0;
        |DDEFECTO #dsmow107;
        #dsmow107#0  = #dsm190li#0;
        #dsmow107#1  = #dsm190li#1;
        #dsmow107#2  = #dsm190li#2;
        #dsmow107#3  = #dsm190li#3;
        #dsmow107#4  = #dsm190li#4;
        #dsmow107#5  = #dsm190li#5;
        #dsmow107#6  = #dsm190li#6;
        #dsmow107#7  = #dsm190li#7;
        #dsmow107#8  = #dsm190li#8;
        #dsmow107#9  = #dsm190li#9;
        #dsmow107#10 = #dsm190li#10;
        |GRABA 020#dsmow107.b;
     |FINSI;

     #dsmow107#13 = enImporte3;
     #dsmow107#14 = enImporte4;

     #dsmow107#11 = #dsm190li#23;
     #dsmow107#12 = #dsm190li#24;

     #dsmow107#15 = #dsmow107#11 - #dsmow107#13;
     #dsmow107#16 = #dsmow107#12 - #dsmow107#14;

     |SI #dsmow107#11 ! 0; |O #dsmow107#12 ! 0; |O #dsmow107#13 ! 0; |O #dsmow107#14 ! 0;
         |SI #dsmow107#11 ! #dsmow107#13; |O #dsmow107#12 ! #dsmow107#14;
             #dsmow107#17 = "X";
             nHay = 1;
         |FINSI;
     |FINSI;
     #dsmow107#18 = #dsm190li#12;
     #dsmow107#19 = #agifigen#1;
     #dsmow107#20 = nTRela;

     |GRABA 020#dsmow107.a;
     |LIBERA #dsmow107;
|FPRC;

|DEFBUCLE dsm190li;
     #dsm190li#1;
     ;
     #agifigen#0, enEjer, enPeriodo, enModelo, nComplem, 00, "            ", 0000, " ", "  ", 0;
     #agifigen#0, enEjer, enPeriodo, enModelo, nComplem, 99, "zzzzzzzzzzzz", 9999, "z", "zz", 9;
     ;
     NULL, dsm190li;
|FIN;

|PROCESO dsm19001;
     |SI #dsm19001#8 ! "A"; |Y #dsm19001#8 ! "B";  |Y #dsm19001#8 ! "C";  |Y #dsm19001#8 ! "D"; |Y #dsm19001#8 ! "E";
         |ACABA;
     |FINSI;

     nTRela     = 0;
     enImporte3 = 0;
     enImporte4 = 0;

     nError = 0;
     |DDEFECTO #nomir003;
     |PARA nEjer = #dsm19001#1;  |SI nEjer ] 2000;  |HACIENDO nEjer = nEjer - 1;
           #nomir003#0  = #dsm19001#6;
           #nomir003#40 = nEjer;
           #nomir003#41 = #dsm19001#0;
           |LEE 040#nomir003.=;
           |SI FSalida = 0;
               |SI #nomir003#40 = #dsm19001#1; ||  |SI enTRela = #nomir003#5; |O enBRela ! 0;
                   enImporte3 = #nomir003#13;
                   enImporte4 = #nomir003#12;
                   nTRela     = #nomir003#5;
               |FINSI;
               nError = 0;
               |SAL;
           |SINO;
               nError = 1;
           |FINSI;
     |SIGUE;

     |SI nError ! 0;  |ACABA;  |FINSI;

     |DDEFECTO #dsmow107;
     #dsmow107#0  = #dsm19001#0;
     #dsmow107#1  = #dsm19001#1;
     #dsmow107#2  = #dsm19001#2;
     #dsmow107#3  = #dsm19001#3;
     #dsmow107#4  = #dsm19001#4;
     #dsmow107#5  = #dsm19001#5;
     #dsmow107#6  = #dsm19001#6;
     #dsmow107#7  = #dsm19001#7;
     #dsmow107#8  = #dsm19001#8;
     #dsmow107#9  = #dsm19001#9;
     #dsmow107#10 = #dsm19001#10;
     |LEE 101#dsmow107.=;
     |SI FSalida ! 0;
        |DDEFECTO #dsmow107;
        #dsmow107#0  = #dsm19001#0;
        #dsmow107#1  = #dsm19001#1;
        #dsmow107#2  = #dsm19001#2;
        #dsmow107#3  = #dsm19001#3;
        #dsmow107#4  = #dsm19001#4;
        #dsmow107#5  = #dsm19001#5;
        #dsmow107#6  = #dsm19001#6;
        #dsmow107#7  = #dsm19001#7;
        #dsmow107#8  = #dsm19001#8;
        #dsmow107#9  = #dsm19001#9;
        #dsmow107#10 = #dsm19001#10;
        |GRABA 020#dsmow107.b;
     |FINSI;

     #dsmow107#13 = enImporte3;
     #dsmow107#14 = enImporte4;

     #dsmow107#11 = #dsm19001#23;
     #dsmow107#12 = #dsm19001#24;

     #dsmow107#15 = #dsmow107#11 - #dsmow107#13;
     #dsmow107#16 = #dsmow107#12 - #dsmow107#14;

     |SI #dsmow107#11 ! 0; |O #dsmow107#12 ! 0; |O #dsmow107#13 ! 0; |O #dsmow107#14 ! 0;
         |SI #dsmow107#11 ! #dsmow107#13; |O #dsmow107#12 ! #dsmow107#14;
             #dsmow107#17 = "X";
             nHay = 1;
         |FINSI;
     |FINSI;
     #dsmow107#18 = #dsm19001#12;
     #dsmow107#19 = #agifigen#1;
     #dsmow107#20 = nTRela;

     |GRABA 020#dsmow107.a;
     |LIBERA #dsmow107;
|FPRC;

|DEFBUCLE dsm19001;
     #dsm19001#1;
     ;
     #agifigen#0, enEjer, enPeriodo, enModelo, nComplem, 00, "            ", 0000, " ", "  ", 0;
     #agifigen#0, enEjer, enPeriodo, enModelo, nComplem, 99, "zzzzzzzzzzzz", 9999, "z", "zz", 9;
     ;
     NULL, dsm19001;
|FIN;

|PROCESO agifigen;
    nEmpresa = #agifigen#0;
    nComplem = -1;

    |DDEFECTO #dsm190ca;
    #dsm190ca#0 = #agifigen#0;
    #dsm190ca#1 = enEjer;
    #dsm190ca#2 = enPeriodo;
    #dsm190ca#3 = enModelo;
    #dsm190ca#4 = 99;
    |LEE 040#dsm190ca.];
    |SI FSalida = 0;
        |LEE 040#dsm190ca.a;
    |SINO;
        |LEE 040#dsm190ca.u;
    |FINSI;

    |SI FSalida = 0; |Y #dsm190ca#0 = #agifigen#0; |Y #dsm190ca#1 = enEjer;
      |Y #dsm190ca#2 = enPeriodo; |Y #dsm190ca#3 = enModelo;
         nComplem = #dsm190ca#4;
    |FINSI;

    |SI nComplem ] 0;
        |SI #dsmoy081#0 [ 2015;
            |BUCLE dsm190li;
        |FINSI;

        |SI #dsmoy081#0 ] 2016;
            |BUCLE dsm19001;
        |FINSI;
    |FINSI;
|FPRC;

|DEFBUCLE agifigen;
     #agifigen#1;
     ;
     nDEmpresa;
     nHEmpresa;
     ;
     NULL, agifigen;
|FIN;

|PROCESO Chequeo; |TIPO 3;
     |SI #dsmoy081#1 = "N"; |ACABA; |FINSI;

     aFichero = ("x" + Usuario) % 108;
     |NOME_DAT #dsmow107#aFichero#;
     |DELINDEX #dsmow107;

     enEjer    = #dsmoy081#0;
     enModelo  = 190;
     enPeriodo = 99;
     nDEmpresa = 00001;
     nHEmpresa = 99999;

     |ABRE #dsmow107;
     |ABRE #dsm190ca;
     |ABRE #nomir003;

     nHay = 0;
     |BUCLE agifigen;

     |CIERRA #nomir003;
     |CIERRA #dsm190ca;
     |CIERRA #dsmow107;

     |SI nHay ! 0;
         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |INFOR "dsmoy081";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

         enErrores = 0;
         |BUCLE dsmow1017;
         |SI enErrores ! 0;  |PIEINF;  |FINSI;
         |FININF;
         |FINIMP;
     |SINO;
         |MENAV "    Sin Incidencias";
     |FINSI;
     |DELINDEX #dsmow107;
|FPRC;

|PROGRAMA;

     aPathLaboral = "";
     |DBASS aBase;  |QBF aBase;
     aPathLaboral = aBase + "laboral/def/nomhicca.mas";
     |XABRE "E", aPathLaboral, nHandle;
     |SI FSalida < 0;
         aPathLaboral = "";
         |MENAV "    No existe la Gestion Laboral. ....";
         |ACABA;
     |FINSI;

     aPathLaboral = aBase + "laboral/fich/";
     |PATH_DAT #nomir003#aPathLaboral#;

     |MANTE #dsmoy081;
|FPRO;
