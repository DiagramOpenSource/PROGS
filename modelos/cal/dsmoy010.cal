|FICHEROS;
     dsmoy010 #0;
     dsmom004 #4;
     dsmom008 #8;
     dsmom030 #30;
     dsmociva #300;

     dsmod300 #301;
     dsmod303 #303;
     dsm30301 #304;

     dsmom117 #117;

     dsmom085 #85;
     dsmom086 #86;
     dsmom087 #87;

     dsmow049 #998;
     dsmow013 #999;

     :/basica/def/agitab99 #99;
     :/basica/def/agifigen #1000;

     :/contagen/def/canempre #101;
     :/contagen/def/camaniva #102;
     :/contagen/def/caivalin #103;
     :/contagen/def/caivaasi #104;
     :/contagen/def/caivam03 #105;
     :/contagen/def/calibros #107;
     :/contagen/def/camacc01 #501;
     :/contagen/def/camacc02 #502;
     :/contagen/def/camacc03 #503;

     dsmow142 #110;

     :/basica/def/agicen14 #214;

     dsmow505 #505;
     dsmow583 #583;

     &regisnif@ #709;
     &clientes@ #715;
     &datosper@ #718;

     espejo1@ #1300;
     espejo2@ #1387;

     t1430301;
|FIN;

|VARIABLES;
     &aFitxer300 = "";
     &aFitxer301 = "";
     &aFitxer87  = "";

     &enResult = 0;
     aParametro = "";

     nDEmpresa = 0;
     nHEmpresa = 0;
     enGraba   = 0;

     aTipo          = "";

     nEjer          = 0;
     nDPeriodo      = 0;
     nHPeriodo      = 0;
     nCampo1        = 0;
     nCampo11       = 0;
     nCampo2        = 0;
     nCampo22       = 0;
     nCampo3        = 0;
     nCampo33       = 0;
     &nGrupo        = 0;
     &nSubGrupo     = 0;
     nCasilla      = 0;
     nDepar         = 0;
     nBaseImpo      = 0;
     nPorce         = 0;
     nCuota         = 0;
     nPeriodo       = 0;
     nModelo        = 0;
     nSwPasa        = 0;
     swAlgun        = 0;
     nLaEmpresa     = 0;
     nBaseRet       = 0;
     nCuotaRet      = 0;
     nCalc          = 0;

     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aAlfa3      = "";
     aAlfa4      = "";
     aAlfa5      = "";
     aFichero    = "";
     aPathModelo = "";
     aDef        = "";
     aPeriodo    = "";
     aArchivo    = "";
     nCampo      = 0;

     nSw105      = 0;
     nSwEsta     = 0;
     nNume       = 0;
     nConver     = 0;

     &enLinea     = 0:
     &enSwHay     = 0;
     &enError     = 0;
     &enNume      = 0;

     &eaAlfa      = "";
     &eaFDestino  = "";
     &eaFOrigen   = "";
     &eaFichError = "";
     &eaFichDatos = "";
     &eaFichAuxil = "";
     &eaRet       = "";

     &eaFechaB    = "";
     &eaDiaB      = "";
     &eaMesB      = "";
     &eaAnyoB     = "";
     &eaDeleg     = "";
     &eaAdmin     = "";
     &enTHojas    = 0;
     &enNHojas    = 0;
    || &eaProvincia = "";
     &enSwImpre   = 0;
     &eaParametro = "";
     &enConverMoneda = 0;
     &eaCuenta       = "";
     &nCuotaRR     = 0;
     &nCuotaRS     = 0;


     atemporal1 = "";
     atemporal2 = "";

     nEspa = 0;
     aCadena = "";
     aCaracter = "";
     aLong = "";
     nLong = 0;
     nPos  = 0;
     fLaFecha = @;
     &eaAlfa1 = "";
     &eaAlfa2 = "";

     &enProAct = 0;
     &enProCom = 0;

     nNume1      = 0;
     nNume2      = 0;
     nCompensar  = 0;
     nCompensado = 0;
     nSwOp       = 0;

     &nEjerCarga = 0;

     &enSwLinea = 0;
     &enBase    = 0;
     &enCuota   = 0;
     &enPorce   = 0;
     &aText     = "";
     &aTexr     = "";
     &aDescr    = "";
     nMas       = 0;
     nPara1     = 0;
     nPara2     = 0;
     nPara3     = 0;
     &enBaseI   = 0;
     &enCuotaI  = 0;
     &enPorceI  = 0;
     &eaCiudad  = "";
    nIVA1     = 0;
    nIVA2     = 0;
    nIVA3     = 0;
    nIVA4     = 0;
    nIVA5     = 0;
    nIVA6     = 0;
    nIVA7     = 0;
    nIVA10    = 0;
    nIVA13    = 0;
    nIVA16    = 0;
    nIVA19    = 0;
    nIVA22    = 0;
    nIVA25    = 0;
    nIVA28    = 0;
    nIVA31    = 0;
    nSubeIVA  = 0;
    nPrimero  = 0;
    nVale     = 0;
    informe   = "";

     nHayCaja   = 0
     enSwCaja   = 0
     nBaseCaja  = 0;
     nCuotaCaja = 0;
     nBaseCajD  = 0;
     nCuotaCajD = 0;

    nEjerCobro = 0;
    &ePathCaja = "";
    &eDevenCaja = 0;
    &ePerioCaja = 0;
|FIN;

|INCLUYE i_variar;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\
|CALCULO Eano; |TIPO 7;
 |HAZ LeeCtrlProrr;

 fLaFecha = ~;
 aAlfa1 = fLaFecha; aAlfa1 = aAlfa1 % -104;
 #0#3 = aAlfa1;
 |PINTA #0#3;
|FCAL;

|PROCESO Periodo;
     #0#2 = "          ";
     |SI #0#1 = 1;   #0#2 = "ENERO     ";  |FINSI;
     |SI #0#1 = 2;   #0#2 = "FEBRERO   ";  |FINSI;
     |SI #0#1 = 3;   #0#2 = "MARZO     ";  |FINSI;
     |SI #0#1 = 4;   #0#2 = "ABRIL     ";  |FINSI;
     |SI #0#1 = 5;   #0#2 = "MAYO      ";  |FINSI;
     |SI #0#1 = 6;   #0#2 = "JUNIO     ";  |FINSI;
     |SI #0#1 = 7;   #0#2 = "JULIO     ";  |FINSI;
     |SI #0#1 = 8;   #0#2 = "AGOSTO    ";  |FINSI;
     |SI #0#1 = 9;   #0#2 = "SEPTIEMBRE";  |FINSI;
     |SI #0#1 = 10;  #0#2 = "OCTUBRE   ";  |FINSI;
     |SI #0#1 = 11;  #0#2 = "NOVIEMBRE ";  |FINSI;
     |SI #0#1 = 12;  #0#2 = "DICIEMBRE ";  |FINSI;
     |SI #0#1 = 99;  #0#2 = "ANUAL     ";  |FINSI;

     |SI #0#2 = "          ";
         |MENAV "     Periodo Incorrecto.";
         |ERROR;
     |FINSI;
     |PINTA #0#2;
|FPRC;

|PROCESO Parrilla;
     |SI #0#4 = 0;
         #0#4 = 0;  |PINTA #0#4;
         #0#5 = 0;  |PINTA #0#5;  |C_M #0#5, 1, "N";
         |PARA nCampo = 6;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#4, 1, "S";
             |C_M #0#5, 1, "S";
         |FINSI;

         |PARA nCampo = 6;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO AntesPr;
 |SI enSwProrr ! 2;
     |C_M #0Campo,1,"S";
 |SINO;
     |C_M #0Campo,1,"N";
     #0Campo = "N"; |PINTA #0Campo;
 |FINSI;
|FPRC;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|PROCESO dsmom008;
     #999#0 = #8#0;
     #999#1 = #8#5;
     |LEE 101#999=;
     |SI FSalida ! 0;
         #1000#0 = #8#0;
         |LEE 040#1000=;
         |SI FSalida ! 0;  |DDEFECTO #1000;  |FINSI;

         #999#0  = #8#0;
         #999#1  = #8#5;
         #999#2  = #8#1;
         #999#3  = #8#2;
         #999#4  = #1000#1;
         #999#5  = #0#2;
         #999#6  = #8#6;
         #999#7  = #8#3;
         #999#8  = "S";
         #999#10 = #8#12;
         |GRABA 020#999n;

         enGraba = 1;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE dsmom008;
     #8#1;
     7;
     #4#0, #4#1, #4#2, #4#3, 00, 01, "REGISTROS ";
     #4#0, #4#1, #4#2, #4#3, 00, 98, "REGISTROS ";
     ;
     NULL, dsmom008;
|FIN;

|PROCESO GrabaTempo;
||     |SI #4#9  = "X";  |ACABA;  |FINSI;
||     |SI #4#11 = "X";  |ACABA;  |FINSI;
||     |SI #4#13 = "X";  |ACABA;  |FINSI;

     |SI #4#5 = "ACTIVIDAD ";  |O #4#5 = "ACT.+ REG.";
         |BUCLE dsmom008;
     |SINO;
         #999#0 = #4#0;
         #999#1 = 0;
         |LEE 101#999=;
         |SI FSalida ! 0;
             #1000#0 = #4#0;
             |LEE 040#1000=;
             |SI FSalida ! 0;  |DDEFECTO #1000;  |FINSI;

             #999#0  = #4#0;
             #999#1  = 0;
             #999#2  = #4#1;
             #999#3  = #4#2;
             #999#4  = #1000#1;
             #999#5  = #0#2;
             #999#6  = #1000#1;
             #999#7  = #4#3;
             #999#8  = "S";
             #999#9  = #4#4;
             #999#10 = #4#3;
             |GRABA 020#999n;

             enGraba = 1;
         |FINSI;
         |LIBERA #999;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom004;
     #4#1;
     ;
     nDEmpresa, #0#3, #0#1, #0#0, 00;
     nHEmpresa, #0#3, #0#1, #0#0, 99;
     ;
     NULL, GrabaTempo;
|FIN;


|PROCESO EjerCarga;
    nEjerCarga = #117#8;
|FPRC;

|DEFBUCLE EjerCarga;
  #117#1;
  ;
  2011, 1, 00;
  #0#3, 1, 99;
  ;
  NULL, EjerCarga;
|FIN;

|PROCESO Tipo3;
     enSwProrr = 0;
     |SI #0#21 = "N"; enSwProrr = 3; |FINSI;

     aFichero = ("pas" + Usuario) % 108;
     |NOME_DAT #999 aFichero;
     |ABRE #999;  |CIERRA #999;  |DELINDEX #999;

     |SI #0#3 < 2009;
         #0#0 = 300;
     |SINO;
         #0#0 = 303;
     |FINSI;

      nEjerCarga = 2010;
      |SI #0#3 ] 2011;
          |BUCLE EjerCarga;
      |FINSI;

     aAlfa = #0#3;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     |ABRE #999;
     |SI #0#4 ! 0;
         nDEmpresa = #0#4;
         nHEmpresa = #0#5;
         |BUCLE dsmom004;
     |SINO;
         |PARA nCampo = 6;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               nDEmpresa = #0nCampo;
               nHEmpresa = #0nCampo;
               |BUCLE dsmom004;
         |SIGUE;
     |FINSI;
     |CIERRA #999;

     |SI enGraba = 1;
         |HAZ HazTodo;
     |SINO;
         |MENAV "     Seleccion Vacia.";
     |FINSI;

     |DELINDEX #999;
|FPRC;

||************************************************************************
||************************************************************************
|PROCESO LosCobros;
     |SI nEjerCobro ! 0;
         |SI #502#9 ! 0; |Y #502#9 ! enEjer;
             |ACABA;
         |FINSI;
     |FINSI;

     |DDEFECTO #503;
     |LIBERA #503;
     #503#7 = #502#17;
     #503#0 = #502#0;
     #503#1 = #502#1;
     #503#2 = #502#2;
     #503#3 = #103#2;
     |LEE 041#503=;
     |SI FSalida = 0;
         nBaseCaja  = (nBaseCaja  + #503#5) ! EURODBMOD;
         nCuotaCaja = (nCuotaCaja + #503#6) ! EURODBMOD;

         |SI #502#8 = #102#40; |Y nEjerCobro = 0;
             nBaseCajD  = (nBaseCajD  + #503#5) ! EURODBMOD;
             nCuotaCajD = (nCuotaCajD + #503#6) ! EURODBMOD;
         |FINSI;
    |FINSI;
|FPRC;

|DEFBUCLE LosCobros;
     #502#1;
     7;
     nEjerCobro, #102#0, #102#1, 01, nDPeriodo;
     nEjerCobro, #102#0, #102#1, 99, nHPeriodo;
     e;
     NULL, LosCobros;
|FIN;

|PROCESO LeeRetencion;
     |ABRE #998;
     |DDEFECTO #998;
     #998#0  = #999#0;
     #998#11 = 999;
     #998#41 = #999#1;
     |LEE 041#998=;
     |SI FSalida = 0;
         nCuotaRR = #998#6;
         nCuotaRS = #998#40;
     |FINSI;
     |CIERRA #998;
|FPRC;

|PROCESO GrabaRetencion;
     |ABRE #998;
     |DDEFECTO #998;
     #998#0  = #999#0;
     #998#11 = 999;
     #998#41 = #999#1;
     |LEE 041#998=;
     |SI FSalida ! 0;
         |DDEFECTO #998;
         #998#0  = #999#0;
         #998#11 = 999;
         #998#41 = #999#1;
         |GRABA 020#998c;
     |FINSI;
     |SI #102#36 = "R";
         #998#5 = #998#5 + nBaseRet;
         #998#6 = #998#6 + nCuotaRet;
     |SINO;
         #998#39 = #998#39 + nBaseRet;
         #998#40 = #998#40 + nCuotaRet;
     |FINSI;
     |GRABA 020#998a;
     |CIERRA #998;
|FPRC;

|PROCESO Tratadsmom087_pase;
  |SI nCompensar = 0;
     |DDEFECTO #300;
     #300#0 = #87#0;
     #300#1 = #87#1;
     #300#2 = #87#2;
     #300#3 = #87#3;
     #300#4 = #87#4;
     #300#5 = #87#5;
     #300#6 = #87#6;
     #300#7 = #87#7;
     |LEE 041#300=;

     |PDEFECTO #87, 8, 54;
      #87#16 = #300#16;  #87#19 = #300#19;
      #87#22 = #300#22;  #87#25 = #300#25;
      #87#28 = #300#28;  #87#31 = #300#31;
      #87#34 = #300#34;
  |FINSI;

  #87#11 = enProAct;
  #87#15 = #300#15; #87#17 = (#87#16 % #87#11) ! 2;
  #87#18 = #300#18; #87#20 = (#87#19 % #87#11) ! 2;
  #87#21 = #300#21; #87#23 = (#87#22 % #87#11) ! 2;
  #87#24 = #300#24; #87#26 = (#87#25 % #87#11) ! 2;
  #87#27 = #300#27; #87#29 = (#87#28 % #87#11) ! 2;
  #87#30 = #300#30; #87#32 = (#87#31 % #87#11) ! 2;
  #87#33 = #300#33; #87#35 = (#87#34 % #87#11) ! 2;
  #87#12 = #87#16 + #87#19 + #87#22 + #87#25 + #87#28 + #87#31 + #87#34;
  #87#13 = #87#17 + #87#20 + #87#23 + #87#26 + #87#29 + #87#32 + #87#35;
  #87#14 = #87#12 - #87#13;

  #87#36 = enProCom;
  #87#41 = (#87#40 % #87#36) ! 2;
  #87#43 = (#87#42 % #87#36) ! 2;
  #87#45 = (#87#44 % #87#36) ! 2;
  #87#47 = (#87#46 % #87#36) ! 2;
  #87#49 = (#87#48 % #87#36) ! 2;
  #87#51 = (#87#50 % #87#36) ! 2;
  #87#53 = (#87#52 % #87#36) ! 2;
  #87#37 = #87#40 + #87#42 + #87#44 + #87#46 + #87#48 + #87#50 + #87#52;
  #87#38 = #87#41 + #87#43 + #87#45 + #87#47 + #87#49 + #87#51 + #87#53;
  #87#39 = #87#37 - #87#38;

  #87#8  = #87#12 + #87#37;
  #87#9  = #87#13 + #87#38;
  #87#10 = #87#8  - #87#9;
  |GRABA 020#87a;
  |LIBERA #87;
|FPRC;

|DEFBUCLE TrataTotal87;
 #87#1;
 ;
 #999#0, #999#2, #999#3, enModelo, enComplem, #999#1, 1, 00;
 #999#0, #999#2, #999#3, enModelo, enComplem, #999#1, 9, 99;
 be;
 NULL,Tratadsmom087_pase;
|FIN;

|PROCESO Trata87_pase;
  |SI #300#1 [ 2010; |ACABA; |FINSI;
  |SI #300#7 = 0;    |ACABA; |FINSI;
  |SI #300#7 > 7; |Y #300#7 < 13; |ACABA; |FINSI;

  |DDEFECTO #87;
  #87#0 = #300#0;
  #87#1 = #300#1;
  #87#2 = #300#2;
  #87#3 = #300#3;
  #87#4 = #300#4;
  #87#5 = #300#5;
  #87#6 = #300#6;
  #87#7 = #300#7;
  |LEE 141#87=;
  |SI FSalida ! 0;
      |DDEFECTO #87;
      #87#0 = #300#0;
      #87#1 = #300#1;
      #87#2 = #300#2;
      #87#3 = #300#3;
      #87#4 = #300#4;
      #87#5 = #300#5;
      #87#6 = #300#6;
      #87#7 = #300#7;
      |GRABA 020#87b;
  |FINSI;

  #87nCampo2 = #300nCampo2;
  |SI #103#29 = "N";
      #87nCampo3 = #87nCampo3 + nCuota;
  |SINO;
      nCompensar = 1;
      nNume1 = ((nCampo3 - 16) / 3) * 2 + 40;
      #87nNume1 = #87nNume1 + nCuota;
  |FINSI;
  |GRABA 020#87a;
  |LIBERA #87;
|FPRC;

|PROCESO PonCasilla;
     |SI #107#7 = "S"; nGrupo = 0; |FINSI;
     |SI #103#5 = "N"; |ACABA; |FINSI;
     |SI nGrupo = 0;   |ACABA; |FINSI;
     |SI nBaseImpo = 0; |Y nCuota = 0; |ACABA; |FINSI;

     |SI enSwCaja = 1;
         |SI nGrupo = 1;  nSubGrupo = 16; |FINSI;
         |SI nGrupo = 3;  nSubGrupo = 17; |FINSI;
     |FINSI;

     |SI enEjer ] 2015;
         |SI nGrupo = 1;  |Y nSubGrupo = 5; |Y nSw105 = 1;
             nSubGrupo = 19;
         |FINSI;
         |SI nGrupo = 1;  |Y nSubGrupo = 15; |Y nSw105 = 1;
             nSubGrupo = 19;
         |FINSI;
         |SI nGrupo = 2;  |Y nSubGrupo = 5; |Y nSw105 = 1;
             nSubGrupo = 17;
         |FINSI;
         |SI nGrupo = 2;  |Y nSubGrupo = 6; |Y nSw105 = 1;
             nSubGrupo = 17;
         |FINSI;
         |SI nGrupo = 2;  |Y nSubGrupo = 13; |Y nSw105 = 1;
             nSubGrupo = 17;
         |FINSI;
     |FINSI;

     #300#0  = enEmpresa;
     #300#1  = enEjer;
     #300#2  = enPeriodo;
     #300#3  = enModelo;
     #300#4  = enComplem;
     #300#5  = enActividad;
     #300#6  = nGrupo;
     #300#7  = nSubGrupo;
     |LEE 101#300=;
     |SI FSalida = 0;
         |SI nGrupo = 3; |Y nSubGrupo = 4; |Y enEjer ] 2012;
             |SI #30#72 = "S";
                 #300#35 = #300#35 + nBaseImpo;
             |SINO;
                 #300#14 = #300#14 + nBaseImpo;
             |FINSI;
             #300#12 = #300#14 + #300#35;
         |SINO;
             |SI #300#11 = 0;
                 nVale = 0;
                 |SI nGrupo = 1;
                     |SI nSubGrupo = 2; |O nSubGrupo = 3; nVale = 1; |FINSI;
                 |FINSI;
                 |SI nVale = 0;
                     |SI nPorce = 0;  |Y nCuota = 0;  |ACABA;  |FINSI;
                 |FINSI;

                 nSwEsta = 0;
                 |PARA nCampo2 = 15;  |SI nCampo2 [ 33;  |HACIENDO nCampo2 = nCampo2 + 3;
                      nCampo1 = nCampo2 - 1;
                      nCampo3 = nCampo2 + 1;
                      |SI #300nCampo2 = nPorce;
                          #300nCampo1 = #300nCampo1 + nBaseImpo;
                          #300nCampo2 = nPorce;
                          #300nCampo3 = #300nCampo3 + nCuota;
                          nSwEsta = 1;
                         |SAL;
                      |FINSI;
                 |SIGUE;

                 |SI nSwEsta = 0;
                     |PARA nCampo2 = 15;  |SI nCampo2 [ 33;  |HACIENDO nCampo2 = nCampo2 + 3;
                           nCampo1 = nCampo2 - 1;
                           nCampo3 = nCampo2 + 1;
                           |SI #300nCampo2 = 0; |Y #300nCampo1 = 0;  |Y #300nCampo3 = 0;
                               #300nCampo1 = #300nCampo1 + nBaseImpo;
                               #300nCampo2 = nPorce;
                               #300nCampo3 = #300nCampo3 + nCuota;
                               nSwEsta = 1;
                               |SAL;
                           |FINSI;
                     |SIGUE;
                 |FINSI;

                 |SI nSwEsta = 0;
                     #300#32 = #300#23 + nBaseImpo; nCampo1 = 32;
                     #300#33 = 0;                   nCampo2 = 33;
                     #300#34 = #300#25 + nCuota;    nCampo3 = 34;
                 |FINSI;

                 |SI nGrupo = 2;
                     |SI #0#3 > 2010; |Y enSwProrr < 2;
                         |HAZ Trata87_pase;
                    |FINSI;
                |FINSI;

                #300#12 = #300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32;
                #300#13 = #300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34;
             |SINO;
                #300#12 = #300#12 + nBaseImpo;
             |FINSI;
         |FINSI;
         |GRABA 020#300a;
         |LIBERA #300;
     |FINSI;
|FPRC;

|PROCESO Grupo1;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 1;
     nSubGrupo = #30#26;
     |SI enEjer ] 2014; |Y nSubGrupo = 6;
         |SI #30#72 = "S"; nSubGrupo = 15; |FINSI;
     |FINSI;

     |SI enSwCaja = 1;
         nBaseImpo = nBaseCaja;
         nCuota    = nCuotaCaja;
     |FINSI;
     |HAZ PonCasilla;

     |SI #103#10 ! 0;
         nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
         nPorce    = #103#9;
         nCuota    = (#103#10 / enConversor) ! EURODBMOD;
         nGrupo    = 1;
         nSubGrupo = 10;
         |SI #30#26 = 7;  nSubGrupo = 11; |FINSI;
         |SI #30#26 = 8;  nSubGrupo = 12; |FINSI;
         |SI #30#26 = 17; nSubGrupo = 11; |FINSI;
         |SI #30#26 = 19; nSubGrupo = 11; |FINSI;
         |SI #30#26 = 18; nSubGrupo = 20; |FINSI;
         |HAZ PonCasilla;
     |FINSI;
/*
     |SI #30#74 = "S"; |Y #30#0 > 800;
         nCuota  = (nBaseImpo % #30#75) ! EURODBMOD;
         nPorce  = #30#75;
         nGrupo    = 2;
         nSubGrupo = 11;
         |HAZ PonCasilla;
     |FINSI;
*/
|FPRC;

|PROCESO Grupo2;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 2;
     nSubGrupo = #30#28;

     |SI enSwCaja = 1;
         nBaseImpo = nBaseCaja;
         nCuota    = nCuotaCaja;
     |FINSI;

     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo3;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 8;
     nSubGrupo = #30#30;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo4;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 9;
     nSubGrupo = #30#32;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo5;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 3;
     nSubGrupo = #30#34;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo6;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 4;
     nSubGrupo = #30#36;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo9_R;
         nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
         nPorce    = #103#7;
         nCuota    = (#103#8 / enConversor) ! EURODBMOD;
         nGrupo    = 4;
         nSubGrupo = 17;
         |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo9_S;
         nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
         nPorce    = #103#7;
         nCuota    = (#103#8 / enConversor) ! EURODBMOD;
         nGrupo    = 4;
         nSubGrupo = 18;
         |HAZ PonCasilla;
|FPRC;

|PROCESO LeeLinea;
     aAlfa1 = #103#30; |QBF aAlfa1; |SI aAlfa1 = ""; #103#30 = #102#10; |FINSI;
     |SI aMulDep = "S";
         nDepar = #103#30;
         |SI nDepar = 0;  nDepar = 1;   |FINSI;

         |ABRE #214;
         #214#0 = #999#0;
         #214#1 = nDepar;
         |LEE 040#214=;
         |SI FSalida ! 0;  nDepar = 1;  |FINSI;
         |CIERRA #214;

         |SI #999#1 ! nDepar;  |ACABA;  |FINSI;
     |FINSI;

     nSwPasa = 0;
     #30#0 = #103#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nBaseRet  = nBaseRet  + (#103#20 / enConversor) ! EURODBMOD;
     nCuotaRet = nCuotaRet + (#103#22 / enConversor) ! EURODBMOD;

     |SI #30#4 = "N";  |ACABA;  |FINSI;

     nBaseCaja  = 0; nBaseCajD  = 0;
     nCuotaCaja = 0; nCuotaCajD = 0;
     |SI enSwCaja = 1;    || suma el importe de lo cobrado
         |ABRE #503;
         |BUCLE LosCobros;
         |CIERRA #503;
     |FINSI;

     |SI #30#26 ! 0; nSwPasa = 1;  |HAZ Grupo1;  |FINSI;
     |SI #30#28 ! 0; nSwPasa = 1;  |HAZ Grupo2;  |FINSI;
     |SI #30#30 ! 0; nSwPasa = 1;  |HAZ Grupo3;  |FINSI;
     |SI #30#32 ! 0; nSwPasa = 1;  |HAZ Grupo4;  |FINSI;
     |SI #30#34 ! 0; nSwPasa = 1;  |HAZ Grupo5;  |FINSI;
     |SI #30#36 ! 0; nSwPasa = 1;  |HAZ Grupo6;  |FINSI;
     |SI enSwCaja = 1;
         |SI #102#36 = "R"; nSwPasa = 1; |HAZ Grupo9_R; |FINSI;
         |SI #102#36 = "S"; nSwPasa = 1; |HAZ Grupo9_S; |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE caivalin;
     #103#1;
     ;
     #102#0, #102#1, 01;
     #102#0, #102#1, 99;
     ;
     NULL, LeeLinea;
|FIN;

|PROCESO LeeCabecera;
     #107#0 = #102#0;
     |LEE 000#107=;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;

     |SI aMulDep ! "S";
         nDepar = #102#10;
         |SI nDepar = 0;  nDepar = 1;   |FINSI;

         |ABRE #214;
         #214#0 = #999#0;
         #214#1 = nDepar;
         |LEE 040#214=;
         |SI FSalida ! 0;  nDepar = 1;  |FINSI;
         |CIERRA #214;

         |SI #999#1 ! nDepar;  |ACABA;  |FINSI;
     |FINSI;

     nSw105 = 0;
     |ABRE #105;
     |DDEFECTO #105;
     #105#0 = #102#0;
     #105#1 = #102#1;
     |LEE 040#105=;
     |SI FSalida = 0;
         nSw105 = 1;
         |SI #105#8 = 1; nSw105 = 0; |FINSI;
     |FINSI;
     |CIERRA #105;

|SI nEjerCobro = 0;
     enSwCaja = 0
     nHayCaja = 0
     |SI enEjer ] 2014; |Y #102#36 ! "N";

         |SI #102#42 = "Z"; |O #102#42 = "1"; |O #102#42 = "2";
             |O #102#42 = "3"; |O #102#42 = "4"; |O #102#42 = "5";
             |O #102#42 = "6"; |O #102#42 = "7"; |O #102#42 = "8";
                enSwCaja = 1;
         |FINSI;

         |SI enSwCaja = 1;
             |ABRE #501;
             |DDEFECTO #501;
             #501#17 = nEjerCobro;
             #501#0 = #102#0;
             #501#1 = #102#1;
             |LEE 040#501=;
             |SI FSalida ! 0;  enSwCaja = 0;  |FINSI;
             |CIERRA #501;
         |FINSI;
    |FINSI;
|FINSI;

     nBaseRet  = 0;
     nCuotaRet = 0;
     |BUCLE caivalin;
     |LIBERA #102;

     |SI #0#20 = "S";
         |SI nCuotaRet ! 0; |Y #102#5 = nHPeriodo;
             |HAZ GrabaRetencion;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE camaniva;
     #102#1;
     5;
     00, 0000000000, nDPeriodo;
     99, 9999999999, nHPeriodo;
     e;
     NULL, LeeCabecera;
|FIN;

|PROCESO Lee501_2014;
   ePerioCaja = #501#18;
   |HAZ ePathCaja;
   |PATH_DAT #102 ePathCaja;
   |PATH_DAT #103 ePathCaja;
   |PATH_DAT #104 ePathCaja;
   |PATH_DAT #105 ePathCaja;
   |PATH_DAT #107 ePathCaja;

   nHayCaja   = 1;
   enSwCaja   = 1;
   eDevenCaja = #501#17;

   |ABRE #102;
   #102#0 = #501#0;
   #102#1 = #501#1;
   |LEE 041#102=;
   |SI FSalida = 0;
       |HAZ LeeCabecera;
   |FINSI;

   |CIERRA #102;
|FPRC;

|DEFBUCLE Lee501_2014;
   #501#1;
   ;
   nEjerCobro, 01, 0000000001;
   nEjerCobro, 99, 9999999999;
   e;
   NULL, Lee501_2014;
|FIN;

|PROCESO Compensa87;
  |SI #1300#1 [ 2010; |ACABA; |FINSI;
  |SI #1300#7 = 0; |ACABA; |FINSI;
  |SI #1300#7 > 7; |Y #1300#7 < 13; |ACABA; |FINSI;

  |SI nSwOp = 1;
      #1387#0 = #1300#0;
      #1387#1 = #1300#1;
      #1387#2 = #1300#2;
      #1387#3 = #1300#3;
      #1387#4 = #1300#4;
      #1387#5 = #1300#5;
      #1387#6 = #1300#6;
      #1387#7 = #1300#7;
      |LEE 000#1387=;
      |SI FSalida ! 0;
          |DDEFECTO #1387;
      |FINSI;

      #87#0 = #300#0;
      #87#1 = #300#1;
      #87#2 = #300#2;
      #87#3 = #300#3;
      #87#4 = #300#4;
      #87#5 = #300#5;
      #87#6 = #300#6;
      #87#7 = #300#7;
      |LEE 141#87=;
      |SI FSalida ! 0;
          |DDEFECTO #87;
          #87#0 = #300#0;
          #87#1 = #300#1;
          #87#2 = #300#2;
          #87#3 = #300#3;
          #87#4 = #300#4;
          #87#5 = #300#5;
          #87#6 = #300#6;
          #87#7 = #300#7;
          |GRABA 020#87b;
      |FINSI;
  |FINSI;

  |SI nSwOp = 2;
      nNume1 = ((nCampo33 - 16) / 3) * 2 + 40;
      nNume2 = ((nCampo3 - 16) / 3) * 2 + 40;
      #87nCampo33 = #87nCampo33 - #1387nCampo3;  ||de la actividad
      #87nNume1   = #87nNume1   - #1387nNume2;   ||comun
  |FINSI;
  |SI nSwOp = 3;
      |GRABA 020#87a;
      |LIBERA #87;
  |FINSI;
|FPRC;

|PROCESO Compensa300;
     |SI #1300#6 = 5;  |ACABA;  |FINSI;

     #300#0 = #1300#0;
     #300#1 = #1300#1;
     #300#2 = #1300#2;
     #300#3 = #1300#3;
     #300#4 = #1300#4 + 1;
     #300#5 = #1300#5;
     #300#6 = #1300#6;
     #300#7 = #1300#7;
     |LEE 000#300=;
     |SI FSalida = 0; |ACABA;  |FINSI;

     |DDEFECTO #300;

     #300#0 = #1300#0;
     #300#1 = #1300#1;
     #300#2 = #999#3;
     #300#3 = #1300#3;
     #300#4 = enComplem; ||#1300#4;
     #300#5 = #1300#5;
     #300#6 = #1300#6;
     #300#7 = #1300#7;
     |LEE 101#300=;
     |SI FSalida = 0;
         |SI nCompensar = 1; |Y #1300#6 = 2;
             nSwOp = 1; |HAZ Compensa87;
         |FINSI;

         |SI #300#15 = 0;  |Y #300#18 = 0;  |Y #300#21 = 0;  |Y #300#24 = 0;
          |Y #300#27 = 0;  |Y #300#30 = 0;  |Y #300#33 = 0;
             #300#15 = #1300#15;
             #300#18 = #1300#18;
             #300#21 = #1300#21;
             #300#24 = #1300#24;
             #300#27 = #1300#27;
             #300#30 = #1300#30;
             #300#33 = #1300#33;
         |FINSI;

         |SI #300#36 = 0;  |Y #300#39 = 0;  |Y #300#42 = 0;  |Y #300#45 = 0;
          |Y #300#48 = 0;  |Y #300#51 = 0;  |Y #300#54 = 0;
             #300#36 = #1300#36;
             #300#39 = #1300#39;
             #300#42 = #1300#42;
             #300#45 = #1300#45;
             #300#48 = #1300#48;
             #300#51 = #1300#51;
             #300#54 = #1300#54;
         |FINSI;

         |SI #300#12 ! 0;  |Y #300#14 = 0;  |Y #300#17 = 0;  |Y #300#20 = 0;  |Y #300#23 = 0;
          |Y #300#26 = 0;  |Y #300#29 = 0;  |Y #300#32 = 0;
          |Y #300#35 = 0;  |Y #300#38 = 0;  |Y #300#41 = 0;  |Y #300#44 = 0;
          |Y #300#47 = 0;  |Y #300#50 = 0;  |Y #300#53 = 0;
             #300#12 = #300#12 - #1300#12;
         |SINO;
             |PARA nCampo2 = 15;  |SI nCampo2 [ 33;  |HACIENDO nCampo2 = nCampo2 + 3;
                   nCampo1     = nCampo2 - 1;
                   nCampo3     = nCampo2 + 1;
                   nCompensado = 0;
                   |PARA nCampo22 = 15;  |SI nCampo22 [ 33;  |HACIENDO nCampo22 = nCampo22 + 3;
                         nCampo11 = nCampo22 - 1;
                         nCampo33 = nCampo22 + 1;
                         |SI #300nCampo22 = #1300nCampo2;
                             #300nCampo11 = #300nCampo11 - #1300nCampo1;
                             #300nCampo33 = #300nCampo33 - #1300nCampo3;
                             nCompensado = 1;
                             |SAL;
                         |FINSI;
                    |SIGUE;

                    |SI nCompensado = 0;
                        |SI #300#14 = 0;  |Y #300#15 = 0;  |Y #300#16 = 0;
                            #300#14     = #300#14 - #1300nCampo1;
                            #300#15     = #1300nCampo2;
                            #300#16     = #300#16 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 16;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#17 = 0;  |Y #300#18 = 0;  |Y #300#19 = 0;
                            #300#17     = #300#17 - #1300nCampo1;
                            #300#18     = #1300nCampo2;
                            #300#19     = #300#19 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 19;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#20 = 0;  |Y #300#21 = 0;  |Y #300#22 = 0;
                            #300#20     = #300#20 - #1300nCampo1;
                            #300#21     = #1300nCampo2;
                            #300#22     = #300#22 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 22;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#23 = 0;  |Y #300#24 = 0;  |Y #300#25 = 0;
                            #300#23     = #300#23 - #1300nCampo1;
                            #300#24     = #1300nCampo2;
                            #300#25     = #300#25 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 25;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#26 = 0;  |Y #300#27 = 0;  |Y #300#28 = 0;
                            #300#26     = #300#26 - #1300nCampo1;
                            #300#27     = #1300nCampo2;
                            #300#28     = #300#28 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 28;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#29 = 0;  |Y #300#30 = 0;  |Y #300#31 = 0;
                            #300#29     = #300#29 - #1300nCampo1;
                            #300#30     = #1300nCampo2;
                            #300#31     = #300#31 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 31;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#32 = 0;  |Y #300#33 = 0;  |Y #300#34 = 0;
                            #300#32     = #300#32 - #1300nCampo1;
                            #300#33     = #1300nCampo2;
                            #300#34     = #300#34 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 34;
                        |FINSI;
                    |FINSI;
                    |SI nCompensar = 1; |Y #1300#6 = 2;
                        nSwOp = 2; |HAZ Compensa87;
                    |FINSI;
             |SIGUE;
             |SI nCompensar = 1; |Y #1300#6 = 2;
                  nSwOp = 3; |HAZ Compensa87;
             |FINSI;

             |PARA nCampo2 = 36;  |SI nCampo2 [ 54;  |HACIENDO nCampo2 = nCampo2 + 3;
                   nCampo1     = nCampo2 - 1;
                   nCampo3     = nCampo2 + 1;
                   nCompensado = 0;
                   |PARA nCampo22 = 36;  |SI nCampo22 [ 54;  |HACIENDO nCampo22 = nCampo22 + 3;
                         nCampo11 = nCampo22 - 1;
                         nCampo33 = nCampo22 + 1;
                         |SI #300nCampo22 = #1300nCampo2;
                             #300nCampo11 = #300nCampo11 - #1300nCampo1;
                             #300nCampo33 = #300nCampo33 - #1300nCampo3;
                             nCompensado = 1;
                             |SAL;
                         |FINSI;
                    |SIGUE;

                    |SI nCompensado = 0;
                        |SI #300#35 = 0;  |Y #300#36 = 0;  |Y #300#37 = 0;
                            #300#35     = #300#35 - #1300nCampo1;
                            #300#36     = #1300nCampo2;
                            #300#37     = #300#37 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#38 = 0;  |Y #300#39 = 0;  |Y #300#40 = 0;
                            #300#38     = #300#38 - #1300nCampo1;
                            #300#39     = #1300nCampo2;
                            #300#40     = #300#40 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#41 = 0;  |Y #300#42 = 0;  |Y #300#43 = 0;
                            #300#41     = #300#41 - #1300nCampo1;
                            #300#42     = #1300nCampo2;
                            #300#43     = #300#43 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#44 = 0;  |Y #300#45 = 0;  |Y #300#46 = 0;
                            #300#44     = #300#44 - #1300nCampo1;
                            #300#45     = #1300nCampo2;
                            #300#46     = #300#46 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#47 = 0;  |Y #300#48 = 0;  |Y #300#49 = 0;
                            #300#47     = #300#47 - #1300nCampo1;
                            #300#48     = #1300nCampo2;
                            #300#49     = #300#49 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#50 = 0;  |Y #300#51 = 0;  |Y #300#52 = 0;
                            #300#50     = #300#50 - #1300nCampo1;
                            #300#51     = #1300nCampo2;
                            #300#52     = #300#52 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#53 = 0;  |Y #300#54 = 0;  |Y #300#55 = 0;
                            #300#53     = #300#53 - #1300nCampo1;
                            #300#54     = #1300nCampo2;
                            #300#55     = #300#55 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;
             |SIGUE;

             #300#12 = #300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32;
             #300#12 = #300#12 + #300#35 + #300#38 + #300#41 + #300#44 + #300#47 + #300#50 + #300#53;
             #300#13 = #300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34;
             #300#13 = #300#13 + #300#37 + #300#40 + #300#43 + #300#46 + #300#49 + #300#52 + #300#55;
         |FINSI;

         |GRABA 020#300a;
         |LIBERA #300;
     |FINSI;
|FPRC;

|DEFBUCLE dsmociva;
     #1300#1008;
     ;
     #999#0, #999#2, nPeriodo, #999#7, 00, #999#1, 1, 00;
     #999#0, #999#2, nPeriodo, #999#7, 99, #999#1, 9, 99;
     ;
     NULL, Compensa300;
|FIN;

|PROCESO Pase300;
     |DDEFECTO #8;
     |ABRE #8;
     #8#0 = #999#0;
     #8#1 = #999#2;
     #8#2 = #999#3;
     #8#3 = #999#7;
     #8#4 = 0;
     #8#5 = #999#1;
     |LEE 101#8=;
     |SI FSalida = 0;
         enEmpresa     = #8#0;
         enEjer        = #8#1;
         enPeriodo     = #8#2;
         enModelo      = #8#3;
         enComplem     = #8#4;
         enActividad   = #8#5;
         enTipoEntrada = 97;
         |HAZ dsmociva;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = 0;
     enActividad   = #999#1;
     enTipoEntrada = 90;             || Creacion Modelo
     |HAZ dsmociva;

     aAlfa = #999#2;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     enSwOpPar   = 0;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         aAlfa = #999#2;
         aAlfa = aAlfa % -102;
         nEjer = aAlfa;

         |ABRE #101;
         |SELECT #4#101;
         #101#2  = enEmpresa;
         #101#26 = nEjer;
         |LEE 040#101=;
         |SI FSalida ! 0;  |CIERRA #101;  |ACABA;   |FINSI;
         |CIERRA #101;

         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";

         enEmpresa  = #101#2;
         enPerConta = #101#3;
         eaLaMonEmp = #101#28;
     |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
     |FINSI;
     |HAZ EnConversor;

     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;
     |PATH_DAT #105 aPathConta;
     |PATH_DAT #107 aPathConta;
     |PATH_DAT #501 aPathConta;
     |PATH_DAT #502 aPathConta;
     |PATH_DAT #503 aPathConta;

     |ABRE #104;
     |LEE 040#104p;
     |SI FSalida ! 0;  |DDEFECTO #104;  |FINSI;
     aMulDep = #104#132;
     |CIERRA #104;

     |SI #104#46 = "T";
         |SI #0#3 [ 2009;
             |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI #0#1 = 99;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SINO;
             |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
             |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
             |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
             |SI #0#1 = 99;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
         |FINSI;
     |SINO;
         |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
         |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
         |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
         |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
         |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
         |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
         |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
         |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
         |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
         |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
         |SI #0#1 = 99;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
     |FINSI;

     nEjerCobro = 0;
     nCompensar = 0;
     |ABRE #87;
     |ABRE #30;
     |ABRE #300;
     |ABRE #107;
     |BUCLE camaniva;
     |CIERRA #107;

     |SI enEjer ] 2015;
         nEjerCobro = enEjer - 1;
         |BUCLE Lee501_2014;
     |FINSI;

     |CIERRA #30;
     |CIERRA #87;

     |SI enSwPartido = 1;
         enSwOpPar   = 1;
         |HAZ FinalPartido;
     |FINSI;

     |SI #999#3 ! 1;

         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmociva.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida = 0;
             |SI nCompensar = 1;
                 aDef = aPathModelo + "def/dsmom087.mas";
                 |CARGA_DEF aDef, espejo2@;
                 |SI FSalida ! 0; nCompensar = 0; |FINSI;
             |FINSI;
             |SI nCompensar = 1; |ABRE #espejo2@; |ABRE #87; |FINSI;

             |PARA nPeriodo = 1;  |SI nPeriodo < #999#3;  |HACIENDO nPeriodo = nPeriodo + 1;
                   |BUCLE dsmociva;
             |SIGUE;
             |SI nCompensar = 1; |CIERRA #87; |CIERRA #espejo2@; |DESCARGA_DEF #espejo2@; |FINSI;
         |FINSI;
         |DESCARGA_DEF #espejo1@;

     |FINSI;

     |SI #0#3 > 2010; |Y enSwProrr < 2;
         |BUCLE TrataTotal87;
     |FINSI;
     |CIERRA #300;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = 0;
     enActividad   = #999#1;
     enTipoEntrada = 95;             ||Modelo de Trabajo
     |HAZ dsmociva;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = 0;
     enActividad   = #999#1;
     enTipoEntrada = 91;            ||Creacion Modelo Impresion
     |HAZ dsmociva;
     swAlgun = 1;
|FPRC;

|DEFBUCLE dsmow013;
     #999#1;
     8;
     00001, 00, "S";
     99999, 98, "S";
     ;
     NULL, Pase300;
|FIN;

||************************************************************************

|PROCESO Impre300;
     |ABRE #301;
     #301#0 = #999#0;  || Empresa
     #301#1 = #0#3;    || Ejercicio
     #301#2 = #0#1;    || Periodo
     #301#3 = #0#0;    || Modelo
     #301#4 = 00;      || Complemento
     #301#5 = 00;      || Ejercicio
     |LEE 001#301=;
     |SI FSalida ! 0;
         |CIERRA #301;
         |ACABA;
     |FINSI;

     |SI nLaEmpresa ! 0;
         |SI nLaEmpresa = #999#0; |CIERRA #301; |ACABA; |FINSI;
     |FINSI;

     nLaEmpresa = #999#0;

     enCodCli = #301#0;
     |HAZ LeePersona;

     |DDEFECTO #505;
     |SI EURODBMOD = 0;
         #505#1    = "300";
         nConver   = 1;
     |SINO;
         #505#1    = "303";
         nConver   = 100;
     |FINSI;

     #505#2  = "01";
     #505#3  = "";

     |SI enSwDeDonde = 1;
         #505#4    = (("00" + #715#15) % -102) + (("000" + #715#16) % -103);
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #505#5   = eaVarDni;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = #718#2;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #505#6 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #505#7 = eaAlfa;
         |SINO;
             eaAlfa = #715#1;  |HAZ QuitaRaros;  #505#6  = eaAlfa;
             #505#7  = ".";
         |FINSI;
         #505#8  = #715#29;
         eaAlfa  = #715#30;  |HAZ QuitaRaros;  #505#9 = eaAlfa;
         #505#10 = #715#31 % 104;
         #505#11 = #715#32;
         #505#12 = #715#33;
         #505#13 = #715#34;
         #505#14 = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
         eaAlfa  = #715#37;  |HAZ QuitaRaros;      #505#15 = eaAlfa;
         eaAlfa  = #715#38;  |HAZ QuitaRaros;      #505#16 = eaAlfa;
         eaAlfa  = #715#54;  |HAZ QuitaRarosTfno;  #505#17 = eaAlfa;

         eaDeleg     = #715#17;
         eaAdmin     = #715#18;

         |SI #301#64 ! 0;
             enModelo = 300;  enForzar = 1;  |HAZ CogeDatosBancos;

             #505#57 = eaEntidad;
             #505#58 = eaOficina;
             #505#59 = eaDC;
             #505#60 = eaCuenta;
         |FINSI;

         |SI #301#65 ! 0;
             enModelo = 300;  enForzar = 0;  |HAZ CogeDatosBancos;

             |SI eaFormaPago = "1";  #505#61 = "X";  |FINSI;
             |SI eaFormaPago ! "1";  #505#62 = "X";  |FINSI;

             #505#64 = eaEntidad;
             #505#65 = eaOficina;
             #505#66 = eaDC;
             #505#67 = eaCuenta;
         |FINSI;
     |SINO;
         #505#4   = (("00" + #715#63) % -102) + (("000" + #715#64) % -103);
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #505#5   = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;      #505#6  = eaAlfa;
         #505#7   = ".";
         #505#8   = #715#3;
         eaAlfa   = #715#4;  |HAZ QuitaRaros;      #505#9 = eaAlfa;
         #505#10 = #715#5 % 104;
         #505#11 = #715#6;
         #505#12 = #715#7;
         #505#13 = #715#8;
         #505#14 = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
         eaAlfa  = #715#11;  |HAZ QuitaRaros;     #505#15 = eaAlfa;
         eaAlfa  = #715#12;  |HAZ QuitaRaros;     #505#16 = eaAlfa;
         eaAlfa  = #715#14;  |HAZ QuitaRarosTfno; #505#17 = eaAlfa;

         eaDeleg     = #715#91;
         eaAdmin     = #715#92;

         |SI #301#64 ! 0;
             |SI #715#84 ! "                    ";
                 #505#57 = #715#81;
                 #505#58 = #715#82;
                 #505#59 = #715#83;
                 #505#60 = #715#84 % 110;
             |FINSI;
         |FINSI;

         |SI #301#65 ! 0;
             |SI #715#84 = "                    ";
                 #505#61  = "X";
             |SINO;
                 #505#62  = "X";
                 #505#64 = #715#81;
                 #505#65 = #715#82;
                 #505#66 = #715#83;
                 #505#67 = #715#84 % 110;
             |FINSI;
         |FINSI;
     |FINSI;

     #505#18  = #301#1;

     |SI #301#2 = 3;   #505#19 = 1;  |FINSI;
     |SI #301#2 = 6;   #505#19 = 2;  |FINSI;
     |SI #301#2 = 9;   #505#19 = 3;  |FINSI;
     |SI #301#2 = 12;  #505#19 = 4;  |FINSI;

     enNume = #301#6  * nConver;  |HAZ Conver12;  #505#20 = eaAlfa;
     nNume  = #301#7  * 100;      #505#21 = ("0000" + nNume) % -104;
     enNume = #301#8  * nConver;  |HAZ Conver12;  #505#22 = eaAlfa;

     enNume = #301#9  * nConver;  |HAZ Conver12;  #505#23 = eaAlfa;
     nNume  = #301#10 * 100;      #505#24 = ("0000" + nNume) % -104;
     enNume = #301#11 * nConver;  |HAZ Conver12;  #505#25 = eaAlfa;

     enNume = #301#12 * nConver;  |HAZ Conver12;  #505#26 = eaAlfa;
     nNume  = #301#13 * 100;      #505#27 = ("0000" + nNume) % -104;
     enNume = #301#14 * nConver;  |HAZ Conver12;  #505#28 = eaAlfa;

     enNume = #301#15 * nConver;  |HAZ Conver12;  #505#29 = eaAlfa;
     nNume  = #301#16 * 100;      #505#30 = ("0000" + nNume) % -103;
     enNume = #301#17 * nConver;  |HAZ Conver12;  #505#31 = eaAlfa;

     enNume = #301#18 * nConver;  |HAZ Conver12;  #505#32 = eaAlfa;
     nNume  = #301#19 * 100;      #505#33 = ("0000" + nNume) % -103;
     enNume = #301#20 * nConver;  |HAZ Conver12;  #505#34 = eaAlfa;

     enNume = #301#21 * nConver;  |HAZ Conver12;  #505#35 = eaAlfa;
     nNume  = #301#22 * 100;      #505#36 = ("0000" + nNume) % -103;
     enNume = #301#23 * nConver;  |HAZ Conver12;  #505#37 = eaAlfa;

     enNume = (#301#24 + #301#27 + #301#30) * nConver;  |HAZ Conver12;
                                  #505#38 = eaAlfa;
     enNume = (#301#26 + #301#29 + #301#32) * nConver;  |HAZ Conver12;
                                  #505#39 = eaAlfa;

     enNume = #301#33 * nConver;  |HAZ Conver12;  #505#40 = eaAlfa;
     enNume = #301#39 * nConver;  |HAZ Conver12;  #505#41 = eaAlfa;
     enNume = #301#45 * nConver;  |HAZ Conver12;  #505#42 = eaAlfa;
     enNume = #301#51 * nConver;  |HAZ Conver12;  #505#43 = eaAlfa;
     enNume = #301#53 * nConver;  |HAZ Conver12;  #505#44 = eaAlfa;
     enNume = #301#54 * nConver;  |HAZ Conver12;  #505#45 = eaAlfa;
     enNume = #301#55 * nConver;  |HAZ Conver12;  #505#46 = eaAlfa;
     enNume = #301#56 * nConver;  |HAZ Conver12;  #505#47 = eaAlfa;
     nNume = #301#57 * 100;      #505#48 = ("0000" + nNume) % -105;
     enNume = #301#58 * nConver;  |HAZ Conver12;  #505#49 = eaAlfa;
     enNume = #301#59 * nConver;  |HAZ Conver12;  #505#50 = eaAlfa;
     enNume = #301#60 * nConver;  |HAZ Conver12;  #505#51 = eaAlfa;
     enNume = #301#61 * nConver;  |HAZ Conver12;  #505#52 = eaAlfa;
     enNume = #301#62 * nConver;  |HAZ Conver12;  #505#53 = eaAlfa;
     enNume = #301#63 * nConver;  |HAZ Conver12;  #505#54 = eaAlfa;
     |SI #301#33 = 0;  |Y #301#55 = 0;
         #505#55 = "X";
     |FINSI;
     enNume = #301#64 * nConver;  |HAZ Conver12;  #505#56 = eaAlfa;
     enNume = #301#65 * nConver;  |HAZ Conver12;  #505#63 = eaAlfa;

     eaAlfa = #0#18;  |HAZ FechaBonito;
     #505#68 = eaDiaB;
     #505#69 = eaMesB;
     #505#70 = eaAnyoB;
     #505#71 = &13 + &10;

     nCuotaRR = 0;
     nCuotaRS = 0;
     |SI #0#20 = "S";
         |HAZ LeeRetencion;
     |FINSI;

     |PRINT;
     |PIEINF;
     |CIERRA #301;
|FPRC;

|PROCESO TDeclaracion303;
     |SI #303#62 ! 0;
         enModelo = 303;  enForzar = 1;  |HAZ CogeDatosBancos;

         #583#64 = eaEntidad;
         #583#65 = eaOficina;
         #583#66 = eaDC;
         #583#67 = eaCuenta;
     |FINSI;

     |SI #303#63 ! 0;
         enModelo = 303;  enForzar = 0;  |HAZ CogeDatosBancos;

                                 aAlfa  = "0";
         |SI eaFormaPago = "1";  aAlfa  = "1";  |FINSI;
         |SI eaFormaPago = "2";  aAlfa  = "2";  |FINSI;
         |SI eaFormaPago = "3";  aAlfa  = "3";  |FINSI;

         #583#68 = aAlfa;
         #583#70 = eaEntidad;
         #583#71 = eaOficina;
         #583#72 = eaDC;
         #583#73 = eaCuenta;
     |FINSI;

     #583#6  = "";

     |SI #303#61 ! 0;  #583#6 = "C";  |FINSI;
     |SI #303#62 ! 0;
                                 #583#6 = "D";
         |SI eaFormaPago = "6";  #583#6 = "V";  |FINSI;
     |FINSI;
     |SI #303#63 ! 0;
                                                  #583#6 = "I";
         |SI eaFormaPago = "3";                   #583#6 = "U";  |FINSI;
         |SI eaFormaPago = "4";  |Y #0#6 < 2013;  #583#6 = "A";  |FINSI;
         |SI eaFormaPago = "5";  |Y #0#6 < 2013;  #583#6 = "E";  |FINSI;
         |SI eaFormaPago = "6";                   #583#6 = "G";  |FINSI;
     |FINSI;

     |SI #303#61 = 0; |Y #303#62 = 0;  |Y #303#63 = 0;
         #583#6 = "N";
     |FINSI;
|FPRC;

|PROCESO PersonaFisica;
     aAlfa = eaVarDni % 101;
     |SI aAlfa = "0"; |O aAlfa = "1"; |O aAlfa = "2"; |O aAlfa = "3";
      |O aAlfa = "4"; |O aAlfa = "5"; |O aAlfa = "6"; |O aAlfa = "7";
      |O aAlfa = "8"; |O aAlfa = "9"; |O aAlfa = "X"; |O aAlfa = "Y";
      |O aAlfa = "Z";
         eaAlfa = #715#1;     |HAZ BuscaNombre;
         eaAlfa = eaAlfa1;    |HAZ QuitaRaros;     #583#8   = eaAlfa;
         eaAlfa = eaAlfa2;    |HAZ QuitaRaros;     #583#9   = eaAlfa;
      |SINO;
         eaAlfa   = #715#1;    |HAZ QuitaRaros;    #583#8   = eaAlfa;
                                                   #583#9   = " ";
      |FINSI;
|FPRC;
|| .....................................................
|PROCESO Suma0;
   |SI nPrimero = 0;
       |PARA nCampo1 = 14; |SI nCampo1 [ 55; |HACIENDO nCampo1 = nCampo1 + 1;
             nCampo2   = nCampo1 + 2;
             #110nCampo2 = #300nCampo1 + #110nCampo2;
       |SIGUE;
       nPrimero = 1;
   |SINO;
      |PARA nPara1 = 14; |SI nPara1 [ 53; |HACIENDO nPara1 = nPara1 + 3;
            nPara2 = nPara1 + 1;
            nPara3 = nPara1 + 2;
            nBaseImpo = #300nPara1;
            nPorce    = #300nPara2;
            nCuota    = #300nPara3;

         |SI nBaseImpo ! 0; |O nCuota ! 0;
            nSwEsta = 0;
            |PARA nCampo2 = 17;  |SI nCampo2 [ 56;  |HACIENDO nCampo2 = nCampo2 + 3;
                  nCampo1 = nCampo2 - 1;
                  nCampo3 = nCampo2 + 1;
                  |SI #110nCampo2 = nPorce;
                      #110nCampo1 = #110nCampo1 + nBaseImpo;
                      #110nCampo2 = nPorce;
                      #110nCampo3 = #110nCampo3 + nCuota;
                      nSwEsta = 1;
                      |SAL;
                  |FINSI;
            |SIGUE;

            |SI nSwEsta = 0;
               |PARA nCampo2 = 17;  |SI nCampo2 [ 56;  |HACIENDO nCampo2 = nCampo2 + 3;
                    nCampo1 = nCampo2 - 1;
                    nCampo3 = nCampo2 + 1;
                    |SI #110nCampo2 = 0; |Y #110nCampo1 = 0;  |Y #110nCampo3 = 0;
                        #110nCampo1 = #110nCampo1 + nBaseImpo;
                        #110nCampo2 = nPorce;
                        #110nCampo3 = #110nCampo3 + nCuota;
                        nSwEsta = 1;
                        |SAL;
                    |FINSI;
               |SIGUE;
            |FINSI;

            |SI nSwEsta = 0;
                #110#55 = #110#55 + nBaseImpo;
                #110#56 = 0;
                #110#57 = #110#57 + nCuota;
            |FINSI;

        |FINSI;
     |SIGUE;
  |FINSI;
|FPRC;

|DEFBUCLE LeeCasilla_S;
 #300#1;
 ;
 #303#0, #303#1, #303#2, #303#3, #303#4, 00, nGrupo, nSubGrupo;
 #303#0, #303#1, #303#2, #303#3, #303#4, 99, nGrupo, nSubGrupo;
 e;
 NULL, Suma0;
|FIN;

|PROCESO HazCasilla;

    |PDEFECTO #110, 16, 37;
    nCasilla = nSubGrupo;

    nPrimero = 0;
    |BUCLE LeeCasilla_S;

    |SI nMas = 1;
        |SI nCasilla = 1;
            nSubGrupo = 13; |BUCLE LeeCasilla_S;
            nSubGrupo = 14; |BUCLE LeeCasilla_S;
        |FINSI;

        |SI nCasilla = 2;
            nSubGrupo = 15; |BUCLE LeeCasilla_S;
        |FINSI;
    |FINSI;
    |SI nMas = 2;
        nSubGrupo = 2; |BUCLE LeeCasilla_S;
        nSubGrupo = 3; |BUCLE LeeCasilla_S;
        nSubGrupo = 6; |BUCLE LeeCasilla_S;
        nSubGrupo = 7; |BUCLE LeeCasilla_S;
        nSubGrupo = 8; |BUCLE LeeCasilla_S;
        nSubGrupo = 14; |BUCLE LeeCasilla_S;
    |FINSI;

    |SI nMas = 3;
        nSubGrupo = 11; |BUCLE LeeCasilla_S;
        nSubGrupo = 12; |BUCLE LeeCasilla_S;
    |FINSI;

    |PARA nCampo1 = 14; |SI nCampo1 [ 34; |HACIENDO nCampo1 = nCampo1 + 1;
          nCampo2   = nCampo1 + 2;
          #300nCampo1 = #110nCampo2;
    |SIGUE;
|FPRC;

|PROCESO MiroCiva;
     nMas = 0;
     |SI nGrupo = 2;
        |SI nSubGrupo = 1; |O nSubGrupo = 2;  nMas = 1; |FINSI;
     |FINSI;
     |SI nGrupo = 1; |Y nSubGrupo = 1;
         nMas = 2;
     |FINSI;
     |SI nGrupo = 1; |Y nSubGrupo = 10;
         nMas = 3;
     |FINSI;

     |HAZ HazCasilla;

     |PARA nCampo1 = 14; |SI nCampo1 [ 53; |HACIENDO nCampo1 = nCampo1 + 3;

           nCampo2 = nCampo1 + 1;
           nCampo3 = nCampo1 + 2;
           |SI #300nCampo1 ! 0; |O #300nCampo3 ! 0;
               enBaseI  = #300nCampo1;
               enPorceI = #300nCampo2;
               enCuotaI = #300nCampo3;

               |SI nGrupo = 1;
                   |SI enPorceI = enPorce; |O enPorce = 0;
                       enSwLinea = 6; |PRINT;
                       aTexr = "";
                   |SINO;
                       |SI enPorceI = 16; |O enPorceI = 18; |O enPorceI = 21;
                           |SI enPorce ] 15; |Y enPorce < 22;
                               enSwLinea = 6; |PRINT;
                               aTexr = "";
                           |FINSI;
                       |SINO;
                           |SI enPorceI = 7; |O enPorceI = 8; |O enPorceI = 10;
                               |SI enPorce ] 6; |Y enPorce < 11;
                                   enSwLinea = 6; |PRINT;
                                   aTexr = "";
                                |FINSI;
                           |SINO;
                                |SI enPorceI = 4; |O enPorceI = 5.20;
                                    |SI enPorce ] 3; |Y enPorce < 5.50;
                                        enSwLinea = 6; |PRINT;
                                        aTexr = "";
                                    |FINSI;
                                |SINO;
                                    |SI enPorceI = 1; |O enPorceI = 1.40;
                                        |SI enPorce ] 0.80; |Y enPorce < 1.60;
                                            enSwLinea = 6; |PRINT;
                                            aTexr = "";
                                        |FINSI;
                                    |FINSI;
                                |FINSI;
                           |FINSI;
                       |FINSI;
                   |FINSI;
               |SINO;
                   enSwLinea = 6; |PRINT;
                   aTexr = "";
               |FINSI;
          |FINSI;

     |SIGUE;
|FPRC;

|PROCESO Impre303;
     |ABRE #303;
     #303#0 = #999#0;  || Empresa
     #303#1 = #0#3;    || Ejercicio
     #303#2 = #0#1;    || Periodo
     #303#3 = #0#0;    || Modelo
     #303#4 = 00;      || Complemento
     #303#5 = 00;      || Actividad
     |LEE 001#303=;
     |SI FSalida ! 0;
         |CIERRA #303;
         |ACABA;
     |FINSI;

     enEmpresa = #303#0;
     enEjer    = #303#1;
     enPeriodo = #303#2;
     enModelo  = #303#3;
     enComplem = #303#4;

     nIVA7     = 0;
     nIVA10    = 0;
     nIVA13    = 0;
     nIVA16    = 0;
     nIVA19    = 0;
     nIVA22    = 0;
     nIVA25    = 0;
     nIVA28    = 0;
     nIVA31    = 0;
     nSubeIVA  = 0;

     |SI #303#1 = 2010; |Y #303#2 ] 7; nSubeIVA = 1; |FINSI;
     |SI #303#1 ] 2011;                nSubeIVA = 1; |FINSI;
     |SI #303#1 = 2012; |Y #303#2 ] 9; nSubeIVA = 2; |FINSI;
     |SI #303#1 ] 2013;                nSubeIVA = 2; |FINSI;

     |SI #0#22 = "S";
         |SI nSubeIVA = 1;
             |SI #303#7  ! 18; |Y #303#7  ! 8; |Y #303#7  ! 4; |Y #303#7  ! 0; nIVA7  = 1; |FINSI;
             |SI #303#10 ! 18; |Y #303#10 ! 8; |Y #303#10 ! 4; |Y #303#10 ! 0; nIVA10 = 1; |FINSI;
             |SI #303#13 ! 18; |Y #303#13 ! 8; |Y #303#13 ! 4; |Y #303#13 ! 0; nIVA13 = 1; |FINSI;
             |SI #303#25 ! 18; |Y #303#25 ! 8; |Y #303#25 ! 4; |Y #303#25 ! 0; nIVA25 = 1; |FINSI;
             |SI #303#28 ! 18; |Y #303#28 ! 8; |Y #303#28 ! 4; |Y #303#28 ! 0; nIVA28 = 1; |FINSI;
             |SI #303#31 ! 18; |Y #303#31 ! 8; |Y #303#31 ! 4; |Y #303#31 ! 0; nIVA31 = 1; |FINSI;
         |FINSI;
         |SI nSubeIVA = 2;
             |SI #303#7  ! 21; |Y #303#7  ! 10; |Y #303#7  ! 4; |Y #303#7  ! 0; nIVA7  = 1; |FINSI;
             |SI #303#10 ! 21; |Y #303#10 ! 10; |Y #303#10 ! 4; |Y #303#10 ! 0; nIVA10 = 1; |FINSI;
             |SI #303#13 ! 21; |Y #303#13 ! 10; |Y #303#13 ! 4; |Y #303#13 ! 0; nIVA13 = 1; |FINSI;
             |SI #303#25 ! 21; |Y #303#25 ! 10; |Y #303#25 ! 4; |Y #303#25 ! 0; nIVA25 = 1; |FINSI;
             |SI #303#28 ! 21; |Y #303#28 ! 10; |Y #303#28 ! 4; |Y #303#28 ! 0; nIVA28 = 1; |FINSI;
             |SI #303#31 ! 21; |Y #303#31 ! 10; |Y #303#31 ! 4; |Y #303#31 ! 0; nIVA31 = 1; |FINSI;

             |SI #303#16 ! 5.20; |Y #303#16 ! 1.40; |Y #303#16 ! 0.50; |Y #303#16 ! 0; nIVA16  = 1; |FINSI;
             |SI #303#19 ! 5.20; |Y #303#19 ! 1.40; |Y #303#19 ! 0.50; |Y #303#19 ! 0; nIVA19  = 1; |FINSI;
             |SI #303#22 ! 5.20; |Y #303#22 ! 1.40; |Y #303#22 ! 0.50; |Y #303#22 ! 0; nIVA22  = 1; |FINSI;
         |FINSI;
     |FINSI;

     |SI nLaEmpresa ! 0;
         |SI nLaEmpresa = #999#0; |CIERRA #303; |ACABA; |FINSI;
     |FINSI;

     nLaEmpresa = #999#0;

     enCodCli = #303#0;
     |HAZ LeePersona;

     |DDEFECTO #583;

     #583#0 = #303#0;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #583#7  = eaVarDni;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = #718#2;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #583#8 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #583#9 = eaAlfa;
         |SINO;
             |HAZ PersonaFisica;
         |FINSI;

         eaAlfa  = #715#37;  |HAZ QuitaRaros;      #583#78 = eaAlfa;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #583#7   = eaVarDni;
         |HAZ PersonaFisica;

         eaAlfa   = #715#11;  |HAZ QuitaRaros;     #583#78 = eaAlfa;
     |FINSI;

     #583#11  = #303#1;

     |SI #4#22 = "T";
         |SI #303#2 = 3;   #583#12 = "1T";  |FINSI;
         |SI #303#2 = 6;   #583#12 = "2T";  |FINSI;
         |SI #303#2 = 9;   #583#12 = "3T";  |FINSI;
         |SI #303#2 = 12;  #583#12 = "4T";  |FINSI;
     |SINO;
         #583#12 = ("00" + #303#2) % -102;
     |FINSI;

     enNume = #303#6;   |HAZ Conver17;   #583#13 = eaAlfa;
     enNume = #303#7 * 100;              #583#14 = ("00000" + enNume) % -105;
     enNume = #303#8;   |HAZ Conver17;   #583#15 = eaAlfa;

     enNume = #303#9;   |HAZ Conver17;   #583#16 = eaAlfa;
     enNume = #303#10 * 100;             #583#17 = ("00000" + enNume) % -105;
     enNume = #303#11;  |HAZ Conver17;   #583#18 = eaAlfa;

     enNume = #303#12;  |HAZ Conver17;   #583#19 = eaAlfa;
     enNume = #303#13 * 100;             #583#20 = ("00000" + enNume) % -105;
     enNume = #303#14;  |HAZ Conver17;   #583#21 = eaAlfa;

     enNume = #303#15;  |HAZ Conver17;   #583#22 = eaAlfa;
     enNume = #303#16 * 100;             #583#23 = ("00000" + enNume) % -105;
     enNume = #303#17;  |HAZ Conver17;   #583#24 = eaAlfa;

     enNume = #303#18;  |HAZ Conver17;   #583#25 = eaAlfa;
     enNume = #303#19 * 100;             #583#26 = ("00000" + enNume) % -105;
     enNume = #303#20;  |HAZ Conver17;   #583#27 = eaAlfa;

     enNume = #303#21;  |HAZ Conver17;   #583#28 = eaAlfa;
     enNume = #303#22 * 100;             #583#29 = ("00000" + enNume) % -105;
     enNume = #303#23;  |HAZ Conver17;   #583#30 = eaAlfa;

     enNume = #303#24 + #303#27 + #303#30;  |HAZ Conver17;  #583#31 = eaAlfa;
     enNume = #303#26 + #303#29 + #303#32;  |HAZ Conver17;  #583#32 = eaAlfa;

     enNume = #303#33;  |HAZ Conver17;  #583#33 = eaAlfa;

     enNume = #303#34;  |HAZ Conver17;  #583#34 = eaAlfa;
     enNume = #303#35;  |HAZ Conver17;  #583#35 = eaAlfa;
     enNume = #303#36;  |HAZ Conver17;  #583#36 = eaAlfa;
     enNume = #303#37;  |HAZ Conver17;  #583#37 = eaAlfa;
     enNume = #303#38;  |HAZ Conver17;  #583#38 = eaAlfa;
     enNume = #303#39;  |HAZ Conver17;  #583#39 = eaAlfa;
     enNume = #303#40;  |HAZ Conver17;  #583#40 = eaAlfa;
     enNume = #303#41;  |HAZ Conver17;  #583#41 = eaAlfa;
     enNume = #303#42;  |HAZ Conver17;  #583#42 = eaAlfa;
     enNume = #303#43;  |HAZ Conver17;  #583#43 = eaAlfa;
     enNume = #303#44;  |HAZ Conver17;  #583#44 = eaAlfa;
     enNume = #303#45;  |HAZ Conver17;  #583#45 = eaAlfa;
     enNume = #303#46;  |HAZ Conver17;  #583#46 = eaAlfa;
     enNume = #303#47;  |HAZ Conver17;  #583#47 = eaAlfa;
     enNume = #303#48;  |HAZ Conver17;  #583#48 = eaAlfa;
     enNume = #303#49;  |HAZ Conver17;  #583#49 = eaAlfa;
     enNume = #303#50;  |HAZ Conver17;  #583#50 = eaAlfa;

     nNume  = #303#51 * 100;            #583#51 = ("00000" + nNume) % -105;
     enNume = #303#52;  |HAZ Conver17;  #583#52 = eaAlfa;
     enNume = #303#53;  |HAZ Conver17;  #583#53 = eaAlfa;
     enNume = #303#54;  |HAZ Conver17;  #583#54 = eaAlfa;
     enNume = #303#55;  |HAZ Conver17;  #583#55 = eaAlfa;
     enNume = #303#56;  |HAZ Conver17;  #583#56 = eaAlfa;
     enNume = #303#57;  |HAZ Conver17;  #583#57 = eaAlfa;
     enNume = #303#58;  |HAZ Conver17;  #583#58 = eaAlfa;
     enNume = #303#59;  |HAZ Conver17;  #583#59 = eaAlfa;
     enNume = #303#60;  |HAZ Conver17;  #583#60 = eaAlfa;

     enNume = #303#61;  |HAZ Conver17;  #583#61 = eaAlfa;

     #583#62 = "0";

     |SI #303#61 = 0; |Y #303#62 = 0;  |Y #303#63 = 0;
         #583#62 = "1";
     |FINSI;

     enNume = #303#62;  |HAZ Conver17;  #583#63 = eaAlfa;
     enNume = #303#63;  |HAZ Conver17;  #583#69 = eaAlfa;

     |HAZ TDeclaracion303;

     #583#74 = "0";

     |SI #303#4 > 0;
         #583#74 = "1";
         #583#75 = #4#21;
     |FINSI;

     eaAlfa  = #0#18;  |HAZ FechaBonito;

     #583#79 = eaDiaB;
     #583#80 = eaMesB;
     #583#81 = eaAnyoB;
     #583#83 = &13 + &10;

     nCuotaRR = 0;
     nCuotaRS = 0;
     |SI #0#20 = "S";
         |HAZ LeeRetencion;
     |FINSI;

     enResult = #303#52;
     |SI PARAMETRO = "";

         |SI #0#22 = "S";

             nGrupo = 1;
             aText = "I.V.A. DEVENGADO";
             aTexr = "----------------";
             enSwLinea = 0; |PRINT;
             enSwLinea = 1; |PRINT;

             aDescr = "Regimen General 1 ..........";
             enBase = #303#6; enPorce = #303#7; enCuota = #303#8;
             enSwLinea = 2; |PRINT;
             |SI nIVA7  = 1;
                 aTexr = "Desglose Tipos IVA";
                 nSubGrupo = 1; |HAZ MiroCiva;
             |FINSI;

             aDescr = "Regimen General 2 ........";
             enBase = #303#9; enPorce = #303#10; enCuota = #303#11;
             enSwLinea = 2; |PRINT;
             |SI nIVA10  = 1;
                 aTexr = "Desglose Tipos IVA";
                 nSubGrupo = 1; |HAZ MiroCiva;
             |FINSI;

             aDescr = "Regimen General 3 ........";
             enBase = #303#12; enPorce = #303#13; enCuota = #303#14;
             enSwLinea = 2; |PRINT;
             |SI nIVA13  = 1;
                 aTexr = "Desglose Tipos IVA";
                 nSubGrupo = 1; |HAZ MiroCiva;
             |FINSI;

             enSwLinea = 9; |PRINT;

             aTexr = "Desglose Tipos IVA";
             aDescr = "Recargo Equivalencia 1 ...";
             enBase = #303#15; enPorce = #303#16; enCuota = #303#17;
             enSwLinea = 2; |PRINT;
             |SI nIVA16  = 1;
                 aTexr = "Desglose Tipos Recargo";
                 nSubGrupo = 10; |HAZ MiroCiva;
             |FINSI;

             aDescr = "Recargo Equivalencia 2 ...";
             enBase = #303#18; enPorce = #303#19; enCuota = #303#20;
             enSwLinea = 2; |PRINT;
             |SI nIVA19  = 1;
                 aTexr = "Desglose Tipos Recargo";
                 nSubGrupo = 10; |HAZ MiroCiva;
             |FINSI;

             aDescr = "Recargo Equivalencia 3 ...";
             enBase = #303#21; enPorce = #303#22; enCuota = #303#23;
             enSwLinea = 2; |PRINT;
             |SI nIVA22  = 1;
                 aTexr = "Desglose Tipos Recargo";
                 nSubGrupo = 10; |HAZ MiroCiva;
             |FINSI;

             enSwLinea = 9; |PRINT;

             aDescr  = "Adq.Intracomunitarias ....";
             enBase  = #303#24 + #303#27 + #303#30;
             enPorce = 0
             enCuota = #303#26 + #303#29 + #303#32;
             enSwLinea = 2; |PRINT;
             |SI #303#25 ! 0;
                 |SI nIVA25 = 1;
                     enPorce = #303#25;
                     aTexr = "Desglose Tipos IVA";
                     nSubGrupo = 5; |HAZ MiroCiva;
                 |SINO;
                     enBaseI = #303#24; enPorceI = #303#25; enCuotaI = #303#26;
                     enSwLinea = 6; |PRINT;
                 |FINSI;
             |FINSI;
             |SI #303#28 ! 0;
                 |SI nIVA28 = 1;
                     enPorce = #303#28;
                     aTexr = "Desglose Tipos IVA";
                     nSubGrupo = 5; |HAZ MiroCiva;
                 |SINO;
                     enBaseI = #303#27; enPorceI = #303#28; enCuotaI = #303#29;
                     enSwLinea = 6; |PRINT;
                 |FINSI;
             |FINSI;
             |SI #303#31 ! 0;
                 |SI nIVA31 = 1;
                     enPorce = #303#31;
                     aTexr = "Desglose Tipos IVA";
                     nSubGrupo = 5; |HAZ MiroCiva;
                 |SINO;
                     enBaseI = #303#27; enPorceI = #303#28; enCuotaI = #303#29;
                     enSwLinea = 6; |PRINT;
                 |FINSI;
             |FINSI;

             enSwLinea = 3; |PRINT;
             enSwLinea = 9; |PRINT;

            || IVA SOPORTADO
             nGrupo = 2;
             aText = "I.V.A. DEDUCIBLE";
             aTexr = "----------------";
             enSwLinea = 0; |PRINT;

             aTexr = "Desglose Tipos IVA";
             aDescr = "Op.interiores corrientes ................";
             enBase = #303#34; enCuota = #303#35; enSwLinea = 4; |PRINT;
             |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 1; |HAZ MiroCiva;  |FINSI;

             aTexr = "Desglose Tipos IVA";
             aDescr = "Op.interiores bienes inversion ..........";
             enBase = #303#36; enCuota = #303#37; enSwLinea = 4; |PRINT;
             |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 2; |HAZ MiroCiva;  |FINSI;

             aTexr = "Desglose Tipos IVA";
             aDescr = "Importaciones bienes corrientes .........";
             enBase = #303#38; enCuota = #303#39; enSwLinea = 4; |PRINT;
             |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 3; |HAZ MiroCiva;  |FINSI;

             aTexr = "Desglose Tipos IVA";
             aDescr = "Importaciones bienes inversion ..........";
             enBase = #303#40; enCuota = #303#41; enSwLinea = 4; |PRINT;
             |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 4; |HAZ MiroCiva;  |FINSI;

             aTexr = "Desglose Tipos IVA";
             aDescr = "Adq.intracomunitarias bienes corrientes..";
             enBase = #303#42; enCuota = #303#43; enSwLinea = 4; |PRINT;
             |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 5; |HAZ MiroCiva;  |FINSI;

             aTexr = "Desglose Tipos IVA";
             aDescr = "Adq.intracomunitarias bienes inversion ..";
             enBase = #303#44; enCuota = #303#45; enSwLinea = 4; |PRINT;
             |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 6; |HAZ MiroCiva;  |FINSI;

             aTexr = "Desglose Tipos IVA";
             aDescr = "Compensaciones Regimen Especial A.G.P. ...................";
             enCuota = #303#46; enSwLinea = 5; |PRINT;
             |SI enCuota ! 0;  nSubGrupo = 7; |HAZ MiroCiva;  |FINSI;

             aTexr = "Desglose Tipos IVA";
             aDescr = "Regularizacion inversiones ..............................";
             enCuota = #303#47; enSwLinea = 5; |PRINT;
             |SI enCuota ! 0;  nSubGrupo = 8; |HAZ MiroCiva;  |FINSI;

             aTexr = "Desglose Tipos IVA";
             aDescr = "Regularizacion aplicacion porcentaje def. prorrata ......";
             enCuota = #303#48; enSwLinea = 5; |PRINT;
             |SI enCuota ! 0;  nSubGrupo = 10; |HAZ MiroCiva;  |FINSI;

         |SINO;

             |PRINT;

         |FINSI;

         |PIEINF;
     |FINSI;
     |CIERRA #303;
|FPRC;


|| //// Nuevo
||Proceso especial de Impresion con detalle de tipos de iva
|PROCESO Suma0_14;
   |SI nPrimero = 0;
       |PARA nCampo1 = 14; |SI nCampo1 [ 55; |HACIENDO nCampo1 = nCampo1 + 1;
             nCampo2   = nCampo1 + 2;
             #110nCampo2 = #300nCampo1 + #110nCampo2;
       |SIGUE;
       nPrimero = 1;
   |SINO;
      |PARA nPara1 = 14; |SI nPara1 [ 53; |HACIENDO nPara1 = nPara1 + 3;
            nPara2 = nPara1 + 1;
            nPara3 = nPara1 + 2;
            nBaseImpo = #300nPara1;
            nPorce    = #300nPara2;
            nCuota    = #300nPara3;

         |SI nBaseImpo ! 0; |O nCuota ! 0;
            nSwEsta = 0;
            |PARA nCampo2 = 17;  |SI nCampo2 [ 56;  |HACIENDO nCampo2 = nCampo2 + 3;
                  nCampo1 = nCampo2 - 1;
                  nCampo3 = nCampo2 + 1;
                  |SI #110nCampo2 = nPorce;
                      #110nCampo1 = #110nCampo1 + nBaseImpo;
                      #110nCampo2 = nPorce;
                      #110nCampo3 = #110nCampo3 + nCuota;
                      nSwEsta = 1;
                      |SAL;
                  |FINSI;
            |SIGUE;

            |SI nSwEsta = 0;
               |PARA nCampo2 = 17;  |SI nCampo2 [ 56;  |HACIENDO nCampo2 = nCampo2 + 3;
                    nCampo1 = nCampo2 - 1;
                    nCampo3 = nCampo2 + 1;
                    |SI #110nCampo2 = 0; |Y #110nCampo1 = 0;  |Y #110nCampo3 = 0;
                        #110nCampo1 = #110nCampo1 + nBaseImpo;
                        #110nCampo2 = nPorce;
                        #110nCampo3 = #110nCampo3 + nCuota;
                        nSwEsta = 1;
                        |SAL;
                    |FINSI;
               |SIGUE;
            |FINSI;

            |SI nSwEsta = 0;
                #110#55 = #110#55 + nBaseImpo;
                #110#56 = 0;
                #110#57 = #110#57 + nCuota;
            |FINSI;

        |FINSI;
     |SIGUE;
  |FINSI;
|FPRC;

|DEFBUCLE LeeCasilla_14;
 #300#1;
 ;
 #304#0, #304#1, #304#2, #304#3, #304#4, 00, nGrupo, nSubGrupo;
 #304#0, #304#1, #304#2, #304#3, #304#4, 99, nGrupo, nSubGrupo;
 e;
 NULL, Suma0_14;
|FIN;

|PROCESO HazCasilla_14;

    |PDEFECTO #110, 16, 58;
    nCasilla = nSubGrupo;

    nPrimero = 0;
    |BUCLE LeeCasilla_14;

    |SI nMas = 1;
        |SI nSubGrupo = 1; nSubGrupo = 14; |BUCLE LeeCasilla_14; |FINSI;
        |SI nSubGrupo = 2; nSubGrupo = 15; |BUCLE LeeCasilla_14; |FINSI;
    |FINSI;

    |SI nMas = 2;
        nSubGrupo = 2; |BUCLE LeeCasilla_14;
        nSubGrupo = 3; |BUCLE LeeCasilla_14;
        nSubGrupo = 14; |BUCLE LeeCasilla_14;
    |FINSI;

    |SI nMas = 3;
        nSubGrupo = 12; |BUCLE LeeCasilla_14;
        |SI #0#3 ] 2015;
            nSubGrupo = 20; |BUCLE LeeCasilla_14;
        |FINSI;
    |FINSI;

    |SI nMas = 4;
        nSubGrupo = 15; |BUCLE LeeCasilla_14;
    |FINSI;

    |SI nMas = 5;
        nSubGrupo = 8;  |BUCLE LeeCasilla_14;
        nSubGrupo = 17; |BUCLE LeeCasilla_14;
        |SI #0#3 ] 2015;
            nSubGrupo = 18; |BUCLE LeeCasilla_14;
            nSubGrupo = 19; |BUCLE LeeCasilla_14;
        |FINSI;
    |FINSI;

    |SI nMas = 6;
        nSubGrupo = 13; |BUCLE LeeCasilla_14;
    |FINSI;

    |SI nMas = 7;
         nSubGrupo = 16; |BUCLE LeeCasilla_14;
        |SI  #0#3 ] 2015;
             nSubGrupo = 17; |BUCLE LeeCasilla_14;
        |FINSI;
    |FINSI;

    |PARA nCampo1 = 14; |SI nCampo1 [ 55; |HACIENDO nCampo1 = nCampo1 + 1;
          nCampo2   = nCampo1 + 2;
          #300nCampo1 = #110nCampo2;
    |SIGUE;
|FPRC;

|PROCESO MiroCiva_14;
     nMas = 0;
     |SI nGrupo = 1; |Y nSubGrupo = 1;
         nMas = 2;
     |FINSI;
     |SI nGrupo = 1; |Y nSubGrupo = 5;
         nMas = 4;
     |FINSI;
     |SI nGrupo = 1; |Y nSubGrupo = 7;
         nMas = 5;
     |FINSI;
     |SI nGrupo = 1; |Y nSubGrupo = 11;
         nMas = 3;
     |FINSI;

     |SI nGrupo = 2;
        |SI nSubGrupo = 1; |O nSubGrupo = 2;  nMas = 1; |FINSI;
        |SI nSubGrupo = 5;                    nMas = 6; |FINSI;
        |SI nSubGrupo = 8;                    nMas = 7; |FINSI;
     |FINSI;

     |HAZ HazCasilla_14;

     |PARA nCampo1 = 14; |SI nCampo1 [ 53; |HACIENDO nCampo1 = nCampo1 + 3;

           nCampo2 = nCampo1 + 1;
           nCampo3 = nCampo1 + 2;
           |SI #300nCampo1 ! 0; |O #300nCampo3 ! 0;
               enBaseI  = #300nCampo1;
               enPorceI = #300nCampo2;
               enCuotaI = #300nCampo3;

               |SI nGrupo = 1;
                   |SI enPorceI = enPorce; |O enPorce = 0;
                       enSwLinea = 6; |PRINT;
                       aTexr = "";
                   |SINO;
                       |SI enPorceI = 16; |O enPorceI = 18; |O enPorceI = 21;
                           |SI enPorce ] 15; |Y enPorce < 22;
                               enSwLinea = 6; |PRINT;
                               aTexr = "";
                          |FINSI;
                       |SINO;
                          |SI enPorceI = 7; |O enPorceI = 8; |O enPorceI = 10;
                              |SI enPorce ] 6; |Y enPorce < 11;
                                  enSwLinea = 6; |PRINT;
                                  aTexr = "";
                               |FINSI;
                          |SINO;
                                |SI enPorceI = 4; |O enPorceI = 5.20;
                                    |SI enPorce ] 3; |Y enPorce < 5.50;
                                        enSwLinea = 6; |PRINT;
                                        aTexr = "";
                                    |FINSI;
                                |SINO;
                                    |SI enPorceI = 1; |O enPorceI = 1.40;
                                        |SI enPorce ] 0.80; |Y enPorce < 1.60;
                                            enSwLinea = 6; |PRINT;
                                            aTexr = "";
                                        |FINSI;
                                    |FINSI;
                                |FINSI;
                          |FINSI;
                      |FINSI;
                   |FINSI;
               |SINO;
                   enSwLinea = 6; |PRINT;
                   aTexr = "";
               |FINSI;
          |FINSI;

     |SIGUE;
|FPRC;

|PROCESO ImprDetalle_14;
    nIVA1    = 0;
    nIVA2    = 0;
    nIVA3    = 0;

    nIVA4    = 0;
    nIVA5    = 0;
    nIVA6    = 0;
    nSubeIVA  = 2;

    |SI #304#17 ! 21; |Y #304#17 ! 10; |Y #304#17 ! 4; |Y #304#17 ! 0; nIVA1 = 1; |FINSI;
    |SI #304#20 ! 21; |Y #304#20 ! 10; |Y #304#20 ! 4; |Y #304#20 ! 0; nIVA2 = 1; |FINSI;
    |SI #304#23 ! 21; |Y #304#23 ! 10; |Y #304#23 ! 4; |Y #304#23 ! 0; nIVA3 = 1; |FINSI;

    |SI #304#32 ! 5.20; |Y #304#32 ! 1.40; |Y #304#32 ! 0.50; |Y #304#32 ! 0; nIVA4  = 1; |FINSI;
    |SI #304#35 ! 5.20; |Y #304#35 ! 1.40; |Y #304#35 ! 0.50; |Y #304#35 ! 0; nIVA5  = 1; |FINSI;
    |SI #304#38 ! 5.20; |Y #304#38 ! 1.40; |Y #304#38 ! 0.50; |Y #304#38 ! 0; nIVA6  = 1; |FINSI;

|| imprimir detalle
    nGrupo = 1;
    aText = "I.V.A. DEVENGADO";
    aTexr = "----------------";
    enSwLinea = 0; |PRINT;
    enSwLinea = 1; |PRINT;

    aDescr = "Regimen General 1 ..........";
    enBase = #304#16; enPorce = #304#17; enCuota = #304#18;
    enSwLinea = 2; |PRINT;
    |SI nIVA1  = 1;
        aTexr = "Desglose Tipos IVA";
        nSubGrupo = 1; |HAZ MiroCiva_14;
    |FINSI;

    aDescr = "Regimen General 2 ..........";
    enBase = #304#19; enPorce = #304#20; enCuota = #304#21;
    enSwLinea = 2; |PRINT;
    |SI nIVA2  = 1;
        aTexr = "Desglose Tipos IVA";
        nSubGrupo = 1; |HAZ MiroCiva_14;
    |FINSI;

    aDescr = "Regimen General 3 ..........";
    enBase = #304#22; enPorce = #304#23; enCuota = #304#24;
    enSwLinea = 2; |PRINT;
    |SI nIVA3  = 1;
        aTexr = "Desglose Tipos IVA";
        nSubGrupo = 1; |HAZ MiroCiva_14;
    |FINSI;

    enSwLinea = 9; |PRINT;

    aDescr  = "Adq.Intracomunitarias .....";
    enBase  = #304#25;
    enPorce = 0
    enCuota = #304#26;
    enSwLinea = 2; |PRINT;
    aTexr = "Desglose Tipos IVA";
    nSubGrupo = 5; |HAZ MiroCiva_14;

    aDescr  = "Otras operaciones ISP .....";
    enBase  = #304#27;
    enPorce = 0
    enCuota = #304#28;
    enSwLinea = 2; |PRINT;
    aTexr = "Desglose Tipos IVA";
    nSubGrupo = 6; |HAZ MiroCiva_14;

    aDescr  = "Modificacion Bases y Cuotas";
    enBase  = #304#29;
    enPorce = 0
    enCuota = #304#30;
    enSwLinea = 2; |PRINT;
    aTexr = "Desglose Tipos IVA";
    nSubGrupo = 7; |HAZ MiroCiva_14;

    enSwLinea = 9; |PRINT;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Recargo Equivalencia 1 .....";
    enBase = #304#31; enPorce = #304#32; enCuota = #304#33;
    enSwLinea = 2; |PRINT;
    |SI nIVA4  = 1;
        aTexr = "Desglose Tipos Recargo";
        nSubGrupo = 10; |HAZ MiroCiva_14;
    |FINSI;

    aDescr = "Recargo Equivalencia 2 .....";
    enBase = #304#34; enPorce = #304#35; enCuota = #304#36;
    enSwLinea = 2; |PRINT;
    |SI nIVA5  = 1;
        aTexr = "Desglose Tipos Recargo";
        nSubGrupo = 10; |HAZ MiroCiva_14;
    |FINSI;

    aDescr = "Recargo Equivalencia 3 .....";
    enBase = #304#37; enPorce = #304#38; enCuota = #304#39;
    enSwLinea = 2; |PRINT;
    |SI nIVA6  = 1;
        aTexr = "Desglose Tipos Recargo";
        nSubGrupo = 10; |HAZ MiroCiva_14;
    |FINSI;
    enSwLinea = 9; |PRINT;

    aDescr  = "Modificacion Base y Cuota";
    enBase  = #304#40;
    enPorce = 0
    enCuota = #304#41;
    enSwLinea = 2; |PRINT;
    aTexr = "Desglose Tipos IVA";
    nSubGrupo = 11; |HAZ MiroCiva_14;

    enSwLinea = 3; |PRINT;

    enSwLinea = 9; |PRINT;

    || IVA SOPORTADO
      nGrupo = 2;
      aText = "I.V.A. DEDUCIBLE";
      aTexr = "----------------";
      enSwLinea = 0; |PRINT;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Op.interiores corrientes ................";
      enBase = #304#43; enCuota = #304#44; enSwLinea = 4; |PRINT;
      |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 1; |HAZ MiroCiva_14;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Op.interiores bienes inversion ..........";
      enBase = #304#45; enCuota = #304#46; enSwLinea = 4; |PRINT;
      |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 2; |HAZ MiroCiva_14;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Importaciones bienes corrientes .........";
      enBase = #304#47; enCuota = #304#48; enSwLinea = 4; |PRINT;
      |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 3; |HAZ MiroCiva_14;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Importaciones bienes inversion ..........";
      enBase = #304#49; enCuota = #304#50; enSwLinea = 4; |PRINT;
      |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 4; |HAZ MiroCiva_14;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Adq.intracomunitarias bienes y servicios.";
      enBase = #304#51; enCuota = #304#52; enSwLinea = 4; |PRINT;
      |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 5; |HAZ MiroCiva_14;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Adq.intracomunitarias bienes inversion ..";
      enBase = #304#53; enCuota = #304#54; enSwLinea = 4; |PRINT;
      |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 6; |HAZ MiroCiva_14;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Rectificacion de deducciones ............";
      enBase = #304#55; enCuota = #304#56; enSwLinea = 4; |PRINT;
      |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 8; |HAZ MiroCiva_14;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Compensaciones Regimen Especial A.G.P. ...................";
      enCuota = #304#57; enSwLinea = 5; |PRINT;
      |SI enCuota ! 0;  nSubGrupo = 7; |HAZ MiroCiva_14;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Regularizacion inversiones ..............................";
      enCuota = #304#58; enSwLinea = 5; |PRINT;
      |SI enCuota ! 0;  nSubGrupo = 9; |HAZ MiroCiva_14;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Regularizacion aplicacion porcentaje def. prorrata ......";
      enCuota = #304#59; enSwLinea = 5; |PRINT;
      |SI enCuota ! 0;  nSubGrupo = 10; |HAZ MiroCiva_14;  |FINSI;

|FPRC;

|PROCESO PersonaFis2014;
     aAlfa = eaVarDni % 101;
     |SI aAlfa = "0"; |O aAlfa = "1"; |O aAlfa = "2"; |O aAlfa = "3";
      |O aAlfa = "4"; |O aAlfa = "5"; |O aAlfa = "6"; |O aAlfa = "7";
      |O aAlfa = "8"; |O aAlfa = "9"; |O aAlfa = "X"; |O aAlfa = "Y";
      |O aAlfa = "Z";
         eaAlfa = #clientes@#1;     |HAZ BuscaNombre;
         eaAlfa = eaAlfa1;    |HAZ QuitaRaros;     #t1430301#7   = eaAlfa;
         eaAlfa = eaAlfa2;    |HAZ QuitaRaros;     #t1430301#8   = eaAlfa;
      |SINO;
         eaAlfa   = #clientes@#1;    |HAZ QuitaRaros;    #t1430301#7   = eaAlfa;
                                                         #t1430301#8   = " ";
      |FINSI;
|FPRC;

|PROCESO TDeclaracion2014;
     enModelo = 303;  enForzar = 1;  |HAZ CogeDatosBancos;

     |SI #304#89 ! 0;
         #t1430301#5 = "C";
     |FINSI;

     |SI #304#90 ! 0;
                                 #t1430301#5 = "D";
         |SI eaFormaPago = "6";  #t1430301#5 = "V";  |FINSI;
     |FINSI;

     |SI #304#91 ! 0;
                                 #t1430301#5 = "I";
         |SI eaFormaPago = "3";  #t1430301#5 = "U";  |FINSI;
         |SI eaFormaPago = "6";  #t1430301#5 = "G";  |FINSI;
     |FINSI;

     |SI #304#42 = 0; |Y #304#60 = 0; |Y #304#61 = 0;
      |Y #304#69 = 0; |Y #304#72 = 0; |Y #304#73 = 0;
      |Y #304#81 = 0;
         #t1430301#5 = "N";
     |FINSI;
|FPRC;

|PROCESO Impre30314;
     |ABRE #304;
     #304#0 = #999#0;  || Empresa
     #304#1 = #0#3;    || Ejercicio
     #304#2 = #0#1;    || Periodo
     #304#3 = #0#0;    || Modelo
     #304#4 = 00;      || Complemento
     #304#5 = 00;      || Actividad
     |LEE 001#304=;
     |SI FSalida ! 0;
         |CIERRA #304;
         |ACABA;
     |FINSI;

     enEmpresa = #304#0;
     enEjer    = #304#1;
     enPeriodo = #304#2;
     enModelo  = #304#3;
     enComplem = #304#4;

     enCodCli = #304#0;
     |HAZ LeePersona;

     |DDEFECTO #t1430301;
     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;   #t1430301#6  = eaVarDni;

         aAlfa1   = #datosper@#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = #datosper@#2;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #datosper@#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #t1430301#7 = aAlfa1 + " " + aAlfa2;

             eaAlfa = #datosper@#4;  |HAZ QuitaRaros;
             #t1430301#8 = eaAlfa;
         |SINO;
             |HAZ PersonaFis2014;
         |FINSI;
         eaAlfa  = #clientes@#37;  |HAZ QuitaRaros;    eaCiudad = eaAlfa;
     |SINO;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;   #t1430301#6   = eaVarDni;
         |HAZ PersonaFis2014;
         eaAlfa   = #clientes@#11;  |HAZ QuitaRaros;   eaCiudad = eaAlfa;
     |FINSI;

     |HAZ TDeclaracion2014;

     |SI #304#6  = "S";  #t1430301#9  = "1";  |FINSI;
     |SI #304#6  = "N";  #t1430301#9  = "2";  |FINSI;
     |SI #304#7  = "S";  #t1430301#10 = "1";  |FINSI;
     |SI #304#7  = "N";  #t1430301#10 = "2";  |FINSI;
     |SI #304#7  = "G";  #t1430301#10 = "3";  |FINSI;
     |SI #304#8  = "S";  #t1430301#11 = "1";  |FINSI;
     |SI #304#8  = "N";  #t1430301#11 = "2";  |FINSI;
     |SI #304#9  = "S";  #t1430301#12 = "1";  |FINSI;
     |SI #304#9  = "N";  #t1430301#12 = "2";  |FINSI;

     aAlfa = "";
     |SI #304#14 > "01.01.0000";
         aAlfa = (#304#14 % 102) + (#304#14 % 402) + (#304#14 % -104);
     |FINSI;
     #t1430301#13 = aAlfa;
     #t1430301#14 = #304#15;

     |SI #304#10 = "S";  #t1430301#15 = "1";  |FINSI;
     |SI #304#10 = "N";  #t1430301#15 = "2";  |FINSI;
     |SI #304#11 = "S";  #t1430301#16 = "1";  |FINSI;
     |SI #304#11 = "N";  #t1430301#16 = "2";  |FINSI;
     |SI #304#12 = "S";  #t1430301#17 = "1";  |FINSI;
     |SI #304#12 = "N";  #t1430301#17 = "2";  |FINSI;
     |SI #304#13 = "S";  #t1430301#18 = "1";  |FINSI;
     |SI #304#13 = "N";  #t1430301#18 = "2";  |FINSI;

     #t1430301#19  = #304#1;

     |SI #dsmom004#22 = "T";
         |SI #304#2 = 3;   #t1430301#20 = "1T";  |FINSI;
         |SI #304#2 = 6;   #t1430301#20 = "2T";  |FINSI;
         |SI #304#2 = 9;   #t1430301#20 = "3T";  |FINSI;
         |SI #304#2 = 12;  #t1430301#20 = "4T";  |FINSI;
     |SINO;
         #t1430301#20 = ("00" + #304#2) % -102;
     |FINSI;

     eaAlfa = #dsmoy010#18;  |HAZ FechaBonito;

     |SI #0#22 = "N";
         |PRINT;
     |SINO;
         |HAZ ImprDetalle_14;
     |FINSI;
     |PIEINF;
|FPRC;

|PROCESO dsmow013i;
     |SI #0#3 [ 2008;  |HAZ Impre300;   |FINSI;
     |SI #0#3 ] 2009;  |Y #0#3 [ 2013; |HAZ Impre303;  |FINSI;
     |SI #0#3 ] 2014;  |HAZ Impre30314; |FINSI;
|FPRC;

|DEFBUCLE dsmow013i;
     #999#1;
     8;
     00001, 00, "S";
     99999, 99, "S";
     ;
     NULL, dsmow013i;
|FIN;

||************************************************************************
|| ..... Procesos Todos: Pase e Impresion
||************************************************************************

|PROCESO HazTodo;
     aFitxer300 = ("pre" + Usuario) % 108;
     |NOME_DAT #300 aFitxer300;
     |HAZ copiando;

     aFitxer301 = ("pri" + Usuario) % 108;
     |SI #0#3 [ 2008;
         |NOME_DAT #301 aFitxer301;
     |SINO;
         |SI #0#3 [ 2013;
             |NOME_DAT #303 aFitxer301;
         |SINO;
             |NOME_DAT #304 aFitxer301;
         |FINSI;
     |FINSI;
     |HAZ copiando1;

     |SI #0#3 > 2010; |Y #0#21 = "S";
         aFitxer87 = ("7x" + Usuario) % 108;
         |NOME_DAT #87 aFitxer87;
         |HAZ copiando2;
     |FINSI;

     aFichero = ("49w" + Usuario) % 108;
     |NOME_DAT #998 aFichero;
     |DELINDEX #998;

     swAlgun = 0;
     |BUCLE dsmow013;
     |SI swAlgun = 1;
        |SI PARAMETRO = "";
           |IMPRE 0;
           |SI FSalida ! 0;  |ACABA;  |FINSI;

           eaRet = #0#20;

           |SI #0#3 [ 2008;
               |SI #0#20 = "N";
                   informe = "m300co01";
               |SINO;
                   informe = "m300co03";
               |FINSI;
           |SINO;
               |SI #0#3 [ 2013;
                   |SI #0#22 = "N";
                       informe = "m303co01";
                   |SINO;
                       informe = "m303co02";
                   |FINSI;
               |SINO;
                   |SI #0#22 = "N";
                       informe = "m303co14";
                   |SINO;
                       informe = "m303co15";
                   |FINSI;
               |FINSI;
           |FINSI;
           |INFOR informe;
           |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

           nLaEmpresa = 0;
           |BUCLE dsmow013i;
           |FININF;
           |FINIMP;
        |SINO;
           eaRet = #0#20;
           nLaEmpresa = 0;
           |BUCLE dsmow013i;
        |FINSI;
     |FINSI;

     |DELINDEX #300;
     |SI #0#3 [ 2008;
          |DELINDEX #301;
     |SINO;
          |SI #0#3 [ 2013;
              |DELINDEX #303;
          |SINO;
              |DELINDEX #304;
          |FINSI;
     |FINSI;
     |DELINDEX #998;
|FPRC;

|| Subrutina Varios

|PROCESO copiando;
   aAlfa = aFitxer300;
   |DFICE aAlfa1; |QBF aAlfa1;

   aAlfa2 = aAlfa + ".ixx";
   aAlfa3 = aAlfa + ".dat";
   aAlfa4 = aAlfa + ".ddx";

   atemporal1 = aAlfa1 + "dsmociva.ixx";
   atemporal2 = aAlfa1 + aAlfa2;
   |COPIA_FICHERO atemporal1,atemporal2;
   |SI FSalida ! 0;  |ACABA;  |FINSI;

   atemporal1 = aAlfa1 + "dsmociva.dat";
   atemporal2 = aAlfa1 + aAlfa3;
   |COPIA_FICHERO atemporal1,atemporal2;
   |SI FSalida ! 0;
       atemporal2 = aAlfa1 + aAlfa2;
       |FBORRA atemporal2;
       |ACABA;
   |FINSI;

   atemporal1 = aAlfa1 + "dsmociva.ddx";
   atemporal2 = aAlfa1 + aAlfa4;
   |COPIA_FICHERO atemporal1,atemporal2;
|FPRC;

|PROCESO copiando1;
   aAlfa = aFitxer301;
   |DFICE aAlfa1; |QBF aAlfa1;

   aAlfa2 = aAlfa + ".ixx";
   aAlfa3 = aAlfa + ".dat";
   aAlfa4 = aAlfa + ".ddx";

   |SI #0#3 [ 2008;
       aAlfa5 = "dsmod300";
   |SINO;
       |SI #0#3 [ 2013;
           aAlfa5 = "dsmod303";
       |SINO;
           aAlfa5 = "dsm30301";
       |FINSI;
   |FINSI;

   atemporal1 = aAlfa1 + aAlfa5 + ".ixx";
   atemporal2 = aAlfa1 + aAlfa2;
   |COPIA_FICHERO atemporal1,atemporal2;
   |SI FSalida ! 0;  |ACABA;  |FINSI;

   atemporal1 = aAlfa1 + aAlfa5 + ".dat";
   atemporal2 = aAlfa1 + aAlfa3;
   |COPIA_FICHERO atemporal1,atemporal2;
   |SI FSalida ! 0;
       atemporal2 = aAlfa1 + aAlfa2;
       |FBORRA atemporal2;
       |ACABA;
   |FINSI;

   atemporal1 = aAlfa1 + aAlfa5 + ".ddx";
   atemporal2 = aAlfa1 + aAlfa4;
   |COPIA_FICHERO atemporal1,atemporal2;
|FPRC;

|PROCESO copiando2;
   aAlfa = aFitxer87;
   |DFICE aAlfa1; |QBF aAlfa1;

   aAlfa2 = aAlfa + ".ixx";
   aAlfa3 = aAlfa + ".dat";
   aAlfa4 = aAlfa + ".ddx";

   atemporal1 = aAlfa1 + "dsmom087.ixx";
   atemporal2 = aAlfa1 + aAlfa2;
   |COPIA_FICHERO atemporal1,atemporal2;
   |SI FSalida ! 0;  |ACABA;  |FINSI;

   atemporal1 = aAlfa1 + "dsmom087.dat";
   atemporal2 = aAlfa1 + aAlfa3;
   |COPIA_FICHERO atemporal1,atemporal2;
   |SI FSalida ! 0;
       atemporal2 = aAlfa1 + aAlfa2;
       |FBORRA atemporal2;
       |ACABA;
   |FINSI;

   atemporal1 = aAlfa1 + "dsmom087.ddx";
   atemporal2 = aAlfa1 + aAlfa4;
   |COPIA_FICHERO atemporal1,atemporal2;
|FPRC;

|PROGRAMA;

   |SI PARAMETRO = "";

      |CLS;
      |CABEZA "Prevision Liq. IVA Modelo 303";
      |PINPA #0#0; |PINDA #0#0;
      |ENDATOS #1#0;
      |SI FSalida = 0;
          |HAZ Tipo3;
      |FINSI;

   |SINO;

      aAlfa = PARAMETRO; |QBF aAlfa;
      aAlfa = aAlfa - "-";
      |SI FSalida ! 0;
         nCalc = FSalida + 98; aAlfa1 = aAlfa % nCalc;
         aAlfa = aAlfa - aAlfa1;
         #dsmoy010#4 = aAlfa; #dsmoy010#5 = aAlfa;
         aAlfa = aAlfa1;
      |FINSI;
      aAlfa = aAlfa - "/";
      |SI FSalida ! 0;
         nCalc = FSalida + 98; aAlfa1 = aAlfa % nCalc;
         aAlfa = aAlfa - aAlfa1;
         #dsmoy010#3 = aAlfa1;
      |FINSI;
      #dsmoy010#1 = aAlfa;

      enResult = 0; |HAZ Tipo3;

   |FINSI;
|FPRO;
