|FICHEROS;
     dsmoz019;
     dsmom004;
     dsmom006;
     dsmom008;

     dsmom026;
     dsmoc110;
     dsmoc111;
     dsm11101;

     :/basica/def/agitab99;
     :/basica/def/agifigen;

     dsmow013;

     :/contagen/def/canempre;

     espejo1@;
|FIN;

|VARIABLES;
     sw = 0;
     aFichero   = "";
     aAlfa      = "";
     aAlfa1     = "";
     aAlfa2     = "";
     nCampo    = 0;
     nDEmpresa = 0;
     nHEmpresa = 0;
     nMes      = 0;
     nAnyo     = 0;

     fFecha    = @;
     enGraba   = 0;

     nSw               = 0;
     aTodoCero         = "";
     aClave            = "";
     aDni              = "";
     aDn               = "            ";
     aHn               = "zzzzzzzzzzzz";
     aPeriodicidad     = "";

     aPathModelo       = "";
     aPathLaboral      = "";
     aDef              = "";
     aTipo             = "";
     aBase             = "";

     nEjer             = 0;
     nEjerAt           = 0;
     nDPeriodo         = 0;
     nHPeriodo         = 0;
     nCampo1           = 0;
     nCampo11          = 0;
     nCampo2           = 0;
     nCampo22          = 0;
     nCampo3           = 0;
     nCampo33          = 0;
     nSwEsta           = 0;
     nGrupo            = 0;
     nSubGrupo         = 0;
     nDepar            = 0;
     nBaseImpo         = 0;
     nPorce            = 0;
     nCuota            = 0;
     nPeriodo          = 0;
     nModelo           = 0;
     nSwPasa           = 0;
     nLineaIrpf        = 0;
     nDComplem         = 0;
     nHComplem         = 0;
     nHandle           = 0;
     nHay              = 0;
     nPorGrupos        = 0;
     nEmpresa          = 0;
     aCampo8F99        = "";
|FIN;

|INCLUYE i_variar;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO Modelo;
     |ABRE #agitab99;
     #agitab99#0 = #dsmoz019#0;
     |LEE 040#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;
     |CIERRA #agitab99;

     |SI #agitab99#4 = "N";
         |MENAV "     Modelo sin Activar.";
         |PTEC 807;
     |FINSI;

     |SI #agitab99#8 ! "L";
         |MENAV "    Modelo sin Pase desde Registros Laboral, puede no necesitar este Proceso";
         |CONFI "    N¨ Existe alguna Empresa definida con este Pase ?. Continuar";
         |SI FSalida ! 0;
             |PTEC 807;
         |FINSI;
     |FINSI;

     #dsmoz019#1 = 0;
     fFecha = ~;
     aAlfa  = fFecha % 402;   nMes  = aAlfa;
     aAlfa  = fFecha % -104;  nAnyo = aAlfa;

     |SI #agitab99#5 = "T";  |O #agitab99#5 = "C";
         |SI nMes [ 3;
             #dsmoz019#1 = 12;
             #dsmoz019#3 = nAnyo - 1;
             |HAZ Periodo;
             |PINTA #dsmoz019#1;
             |PINTA #dsmoz019#3;
             |ACABA;
         |FINSI;

         |SI nMes [ 6;
             #dsmoz019#1 = 3;
             #dsmoz019#3 = nAnyo;
             |HAZ Periodo;
             |PINTA #dsmoz019#3;
             |PINTA #dsmoz019#1;
             |ACABA;
         |FINSI;

         |SI nMes [ 9;
             #dsmoz019#1 = 6;
             #dsmoz019#3 = nAnyo;
             |HAZ Periodo;
             |PINTA #dsmoz019#3;
             |PINTA #dsmoz019#1;
             |ACABA;
         |FINSI;

         |SI nMes [ 12;
             #dsmoz019#1 = 9;
             #dsmoz019#3 = nAnyo;
             |HAZ Periodo;
             |PINTA #dsmoz019#3;
             |PINTA #dsmoz019#1;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #agitab99#5 = "A";
          #dsmoz019#1 = 99;
          #dsmoz019#3 = nAnyo - 1;
          |HAZ Periodo;
          |PINTA #dsmoz019#3;
          |PINTA #dsmoz019#1;
     |FINSI;

     |SI #agitab99#5 = "M";
         |SI nMes = 1;
              #dsmoz019#1 = 12;
              #dsmoz019#3 = nAnyo - 1;
          |SINO;
              #dsmoz019#1 = nMes - 1;
              #dsmoz019#3 = nAnyo;
          |FINSI;
          |HAZ Periodo;
          |PINTA #dsmoz019#1;
          |PINTA #dsmoz019#3;
     |FINSI;

     aCampo8F99 = #agitab99#8;
|FPRC;

|PROCESO Periodo;
     #dsmoz019#2 = "          ";
     |SI #dsmoz019#1 = 1;   #dsmoz019#2 = "ENERO     ";  |FINSI;
     |SI #dsmoz019#1 = 2;   #dsmoz019#2 = "FEBRERO   ";  |FINSI;
     |SI #dsmoz019#1 = 3;   #dsmoz019#2 = "MARZO     ";  |FINSI;
     |SI #dsmoz019#1 = 4;   #dsmoz019#2 = "ABRIL     ";  |FINSI;
     |SI #dsmoz019#1 = 5;   #dsmoz019#2 = "MAYO      ";  |FINSI;
     |SI #dsmoz019#1 = 6;   #dsmoz019#2 = "JUNIO     ";  |FINSI;
     |SI #dsmoz019#1 = 7;   #dsmoz019#2 = "JULIO     ";  |FINSI;
     |SI #dsmoz019#1 = 8;   #dsmoz019#2 = "AGOSTO    ";  |FINSI;
     |SI #dsmoz019#1 = 9;   #dsmoz019#2 = "SEPTIEMBRE";  |FINSI;
     |SI #dsmoz019#1 = 10;  #dsmoz019#2 = "OCTUBRE   ";  |FINSI;
     |SI #dsmoz019#1 = 11;  #dsmoz019#2 = "NOVIEMBRE ";  |FINSI;
     |SI #dsmoz019#1 = 12;  #dsmoz019#2 = "DICIEMBRE ";  |FINSI;
     |SI #dsmoz019#1 = 99;  #dsmoz019#2 = "ANUAL     ";  |FINSI;

     |SI #dsmoz019#2 = "          ";
         |MENAV "     Periodo Incorrecto.";
         |ERROR;
     |FINSI;
     |PINTA #dsmoz019#2;
|FPRC;

|PROCESO Parrilla;
     |SI #dsmoz019#4 = 0;
         #dsmoz019#4 = 0;  |PINTA #dsmoz019#4;
         #dsmoz019#5 = 0;  |PINTA #dsmoz019#5;  |C_M #dsmoz019#5, 1, "N";
         |PARA nCampo = 6;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoz019#nCampo#, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #dsmoz019#4, 1, "S";
             |C_M #dsmoz019#5, 1, "S";
         |FINSI;

         |PARA nCampo = 6;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoz019#nCampo#, 1, "N";
               #dsmoz019#nCampo# = 0;  |PINTA #dsmoz019#nCampo#;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #dsmoz019#Campo# = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               #dsmoz019#nCampo# = 0;  |C_M #dsmoz019#nCampo#, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoz019#nCampo#, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\

|| .... Compruebo que existe en contabilidad alguna de las Empresas.
|PROCESO PorDonde;
     enPartido = 1;
     enEmpresa = nEmpresa;
     enSwOpPar = 0;
     nSw       = 0;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         |ABRE #canempre;
         |SELECT #4#canempre;
         #canempre#2  = nEmpresa;
         #canempre#26 = nEjer;
         |LEE 040#canempre.=;
         |SI FSalida = 0; nSw = 1; |FINSI;
         |CIERRA #canempre;
      |SINO;
          nSw = 1;
      |FINSI;
      |SI nSw = 1; sw = 1; |FINSI;
      enEmpresa = #dsmow013#0;
      enPartido = 0;
|FPRC;

|PROCESO dsmom026;
     nEmpresa = #dsmom026#1;
     |HAZ PorDonde;
|FPRC;

|DEFBUCLE dsmom026;
     #dsmom026#1;
     ;
     #dsmow013#0, 00001;
     #dsmow013#0, 99999;
     ;
     NULL, dsmom026;
|FIN;

|PROCESO MiroSiConta;
     sw = 0;
     nPorGrupos = 0;
     |ABRE #dsmom026;
     #dsmom026#0 = #dsmow013#0;
     #dsmom026#1 = 0;
     |LEE 040#dsmom026.];
     |SI FSalida = 0;  |Y #dsmom026#0 = #dsmow013#0;
         nPorGrupos = 1;
     |FINSI;
     |CIERRA #dsmom026;

     |SI nPorGrupos = 0;
         nEmpresa = #dsmow013#0;
         |HAZ PorDonde;
     |SINO;
         |BUCLE dsmom026;
     |FINSI;
|FPRC;

||/////////////////////////////////////////////////////////////////

|PROCESO MiraCampos_moc110;
     aTodoCero = "S";
     |PARA nCampo1 = 10;  |SI nCampo1 [ 24;  |HACIENDO nCampo1 = nCampo1 + 1;
          |SI #dsmoc110#nCampo1# ! 0;
               aTodoCero = "N";
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO dsmoc110C;
     nHay   = 0;
     aClave = #espejo1@#8;
     |SI aClave = "A"; |O aClave = "L";  |ACABA; |FINSI;

     #dsmoc110#0  = #espejo1@#0;
     #dsmoc110#1  = #espejo1@#1;
     #dsmoc110#2  = #dsmow013#3;
     #dsmoc110#3  = #espejo1@#3;
     #dsmoc110#4  = #dsmow013#9;
     #dsmoc110#5  = #espejo1@#5;
     #dsmoc110#6  = #espejo1@#6;
     #dsmoc110#7  = #espejo1@#7;
     #dsmoc110#8  = #espejo1@#8;
     #dsmoc110#9  = #espejo1@#9;
     |LEE 101#dsmoc110.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc110;
         #dsmoc110#0  = #espejo1@#0;
         #dsmoc110#1  = #espejo1@#1;
         #dsmoc110#2  = #dsmow013#3;
         #dsmoc110#3  = #espejo1@#3;
         #dsmoc110#4  = #dsmow013#9;
         #dsmoc110#5  = #espejo1@#5;
         #dsmoc110#6  = #espejo1@#6;
         #dsmoc110#7  = #espejo1@#7;
         #dsmoc110#8  = #espejo1@#8;
         #dsmoc110#9  = #espejo1@#9;
         #dsmoc110#29 = #espejo1@#29;
         |GRABA 020#dsmoc110.b;

         nHay = 1;
     |SINO;
         |HAZ MiraCampos_moc110;
         |SI aTodoCero = "S";
             nHay = 1;
         |FINSI;
     |FINSI;

     |PARA nCampo1 = 10;  |SI nCampo1 [ 24;  |HACIENDO nCampo1 = nCampo1 + 1;
           #dsmoc110#nCampo1# = #dsmoc110#nCampo1# - #espejo1@#nCampo1#;
     |SIGUE;

     |GRABA 020#dsmoc110.a;
     |LIBERA #dsmoc110;

     |HAZ MiraCampos_moc110;  || mira si son todos = 0 o no

     |SI aTodoCero = "S";
         |SI nHay = 0;
             |BORRA 020#dsmoc110.a;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc110C;
     #espejo1@#1010;
     ;
     #dsmow013#0, #dsmow013#2, nPeriodo, 110, nDComplem, #dsmow013#1, aDn, 0,    " ", "  ";
     #dsmow013#0, #dsmow013#2, nPeriodo, 110, nHComplem, #dsmow013#1, aHn, 9999, "z", "zz";
     ;
     NULL, dsmoc110C;
|FIN;

|PROCESO PasaDSMOC110;
     || Miro si tiene contabilidad.
     |HAZ MiroSiConta;
     |SI sw = 0; |ACABA; |FINSI; ||no lo paso.

     |DDEFECTO #dsmom008;
     |ABRE #dsmom008;
     #dsmom008#0 = #dsmow013#0;
     #dsmom008#1 = #dsmow013#2;
     #dsmom008#2 = #dsmow013#3;
     #dsmom008#3 = #dsmow013#7;
     #dsmom008#4 = #dsmow013#9;
     #dsmom008#5 = #dsmow013#1;
     |LEE 101#dsmom008.=;
     |SI FSalida = 0;
         #dsmom008#11 = "SIN DATOS";
         |GRABA 020#dsmom008.a;

         enEmpresa     = #dsmom008#0;
         enEjer        = #dsmom008#1;
         enPeriodo     = #dsmom008#2;
         enModelo      = #dsmom008#3;
         enComplem     = #dsmom008#4;
         enActividad   = #dsmom008#5;
         enTipoEntrada = 97;
         |SUB_EJECUTA_NP "dsmoc110";
     |FINSI;
     |LIBERA #dsmom008;
     |CIERRA #dsmom008;

     |ABRET #dsmoc110;

     aAlfa = #dsmow013#2;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enPeriodo     = #dsmow013#3;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmow013#9;
     enActividad   = #dsmow013#1;

     |SI #dsmow013#3 ! 1;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc110.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida = 0;
             nDComplem = 0;
             nHComplem = enComplem;

             |PARA nPeriodo = 1;  |SI nPeriodo < #dsmow013#3;  |HACIENDO nPeriodo = nPeriodo + 1;
                   |BUCLE dsmoc110C;
             |SIGUE;

             |SI #dsmow013#9 ! 0;
                 nDComplem = 0;
                 nHComplem = enComplem - 1;
                 nPeriodo  = #dsmow013#3;
                 |BUCLE dsmoc110C;
             |FINSI;
         |FINSI;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     |CIERRAT #dsmoc110;

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enPeriodo     = #dsmow013#3;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmow013#9;
     enActividad   = #dsmow013#1;
     enTipoEntrada = 98;
     eaNombreAct   = #dsmow013#6;
     |SUB_EJECUTA_NP "dsmoc110";

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         #dsmom004#9 = " ";
         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

||/////////////////////////////////////////////////////////////////

|PROCESO MiraCampos_moc111;
     aTodoCero = "S";
     |PARA nCampo1 = 12;  |SI nCampo1 [ 20;  |HACIENDO nCampo1 = nCampo1 + 1;
          |SI #dsmoc111#nCampo1# ! 0;
               aTodoCero = "N";
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO dsmoc111C;
     nHay   = 0;
     aClave = #espejo1@#9;
     |SI aClave = "A"; |O aClave = "L";  |ACABA; |FINSI;

     #dsmoc111#0  = #espejo1@#0;
     #dsmoc111#1  = #espejo1@#1;
     #dsmoc111#2  = #dsmow013#3;
     #dsmoc111#3  = #espejo1@#3;
     #dsmoc111#4  = #dsmow013#9;
     #dsmoc111#5  = #espejo1@#5;
     #dsmoc111#6  = #espejo1@#6;
     #dsmoc111#7  = #espejo1@#7;
     #dsmoc111#8  = #espejo1@#8;
     #dsmoc111#9  = #espejo1@#9;
     #dsmoc111#10 = #espejo1@#10;
     #dsmoc111#11 = #espejo1@#11;
     |LEE 101#dsmoc111.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc111;
         #dsmoc111#0  = #espejo1@#0;
         #dsmoc111#1  = #espejo1@#1;
         #dsmoc111#2  = #dsmow013#3;
         #dsmoc111#3  = #espejo1@#3;
         #dsmoc111#4  = #dsmow013#9;
         #dsmoc111#5  = #espejo1@#5;
         #dsmoc111#6  = #espejo1@#6;
         #dsmoc111#7  = #espejo1@#7;
         #dsmoc111#8  = #espejo1@#8;
         #dsmoc111#9  = #espejo1@#9;
         #dsmoc111#10 = #espejo1@#10;
         #dsmoc111#11 = #espejo1@#11;
         #dsmoc111#21 = #espejo1@#21;
         |GRABA 020#dsmoc111.b;

         nHay = 1;
     |SINO;
         |HAZ MiraCampos_moc111;
         |SI aTodoCero = "S";
             nHay = 1;
         |FINSI;
     |FINSI;

     |PARA nCampo1 = 12;  |SI nCampo1 [ 16;  |HACIENDO nCampo1 = nCampo1 + 1;
           #dsmoc111#nCampo1# = #dsmoc111#nCampo1# - #espejo1@#nCampo1#;
     |SIGUE;

     |GRABA 020#dsmoc111.a;
     |LIBERA #dsmoc111;

     |HAZ MiraCampos_moc111;  || mira si son todos = 0 o no

     |SI aTodoCero = "S";
         |SI nHay = 0;
             |BORRA 020#dsmoc111.a;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc111C;
     #espejo1@#1012;
     ;
     #dsmow013#0, #dsmow013#2, nPeriodo, 110, nDComplem, #dsmow013#1, aDn, 0,    00, " ", "  ", 0;
     #dsmow013#0, #dsmow013#2, nPeriodo, 110, nHComplem, #dsmow013#1, aHn, 9999, 99, "z", "zz", 9;
     ;
     NULL, dsmoc111C;
|FIN;

|PROCESO PasaDSMOC111;
     |HAZ MiroSiConta;
     |SI sw = 0; |ACABA; |FINSI;

     |DDEFECTO #dsmom008;
     |ABRE #dsmom008;
     #dsmom008#0 = #dsmow013#0;
     #dsmom008#1 = #dsmow013#2;
     #dsmom008#2 = #dsmow013#3;
     #dsmom008#3 = #dsmow013#7;
     #dsmom008#4 = #dsmow013#9;
     #dsmom008#5 = #dsmow013#1;
     |LEE 101#dsmom008.=;
     |SI FSalida = 0;
         #dsmom008#11 = "SIN DATOS";
         |GRABA 020#dsmom008.a;

         enEmpresa     = #dsmom008#0;
         enEjer        = #dsmom008#1;
         enPeriodo     = #dsmom008#2;
         enModelo      = #dsmom008#3;
         enComplem     = #dsmom008#4;
         enActividad   = #dsmom008#5;
         enTipoEntrada = 97;
         |SUB_EJECUTA_NP "dsmoc111";
     |FINSI;
     |LIBERA #dsmom008;
     |CIERRA #dsmom008;

     |ABRET #dsmoc111;

     aAlfa = #dsmow013#2;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enPeriodo     = #dsmow013#3;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmow013#9;
     enActividad   = #dsmow013#1;

     |SI #dsmow013#3 ! 1;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc111.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida = 0;
             nDComplem = 0;
             nHComplem = enComplem;

             |PARA nPeriodo = 1;  |SI nPeriodo < #dsmow013#3;  |HACIENDO nPeriodo = nPeriodo + 1;
                   |BUCLE dsmoc111C;
             |SIGUE;

             |SI #dsmow013#9 ! 0;
                 nDComplem = 0;
                 nHComplem = enComplem - 1;
                 nPeriodo  = #dsmow013#3;
                 |BUCLE dsmoc111C;
             |FINSI;
         |FINSI;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     |CIERRAT #dsmoc111;

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enPeriodo     = #dsmow013#3;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmow013#9;
     enActividad   = #dsmow013#1;
     enTipoEntrada = 98;
     eaNombreAct   = #dsmow013#6;
     |SUB_EJECUTA_NP "dsmoc111";

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         #dsmom004#9 = " ";
         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

||/////////////////////////////////////////////////////////////////

|PROCESO MiraCampos_11101;
     aTodoCero = "S";
     |PARA nCampo1 = 12;  |SI nCampo1 [ 20;  |HACIENDO nCampo1 = nCampo1 + 1;
          |SI #dsm11101#nCampo1# ! 0;
               aTodoCero = "N";
               |SAL;
          |FINSI;
     |SIGUE;

     |PARA nCampo1 = 25;  |SI nCampo1 [ 29;  |HACIENDO nCampo1 = nCampo1 + 1;
          |SI #dsm11101#nCampo1# ! 0;
               aTodoCero = "N";
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO dsm11101C;
     nHay   = 0;
     aClave = #espejo1@#9;
     |SI aClave = "A"; |O aClave = "L";  |ACABA; |FINSI;

     #dsm11101#0  = #espejo1@#0;
     #dsm11101#1  = #espejo1@#1;
     #dsm11101#2  = #dsmow013#3;
     #dsm11101#3  = #espejo1@#3;
     #dsm11101#4  = #dsmow013#9;
     #dsm11101#5  = #espejo1@#5;
     #dsm11101#6  = #espejo1@#6;
     #dsm11101#7  = #espejo1@#7;
     #dsm11101#8  = #espejo1@#8;
     #dsm11101#9  = #espejo1@#9;
     #dsm11101#10 = #espejo1@#10;
     #dsm11101#11 = #espejo1@#11;
     |LEE 101#dsm11101.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm11101;
         #dsm11101#0  = #espejo1@#0;
         #dsm11101#1  = #espejo1@#1;
         #dsm11101#2  = #dsmow013#3;
         #dsm11101#3  = #espejo1@#3;
         #dsm11101#4  = #dsmow013#9;
         #dsm11101#5  = #espejo1@#5;
         #dsm11101#6  = #espejo1@#6;
         #dsm11101#7  = #espejo1@#7;
         #dsm11101#8  = #espejo1@#8;
         #dsm11101#9  = #espejo1@#9;
         #dsm11101#10 = #espejo1@#10;
         #dsm11101#11 = #espejo1@#11;
         #dsm11101#21 = #espejo1@#21;
         |GRABA 020#dsm11101.b;

         nHay = 1;
     |SINO;
         |HAZ MiraCampos_11101;
         |SI aTodoCero = "S";
             nHay = 1;
         |FINSI;
     |FINSI;

     |PARA nCampo1 = 12;  |SI nCampo1 [ 16;  |HACIENDO nCampo1 = nCampo1 + 1;
           #dsm11101#nCampo1# = #dsm11101#nCampo1# - #espejo1@#nCampo1#;
     |SIGUE;

     |PARA nCampo1 = 25;  |SI nCampo1 [ 29;  |HACIENDO nCampo1 = nCampo1 + 1;
           #dsm11101#nCampo1# = #dsm11101#nCampo1# - #espejo1@#nCampo1#;
     |SIGUE;

     |GRABA 020#dsm11101.a;
     |LIBERA #dsm11101;

     |HAZ MiraCampos_11101;  || mira si son todos = 0 o no

     |SI aTodoCero = "S";
         |SI nHay = 0;
             |BORRA 020#dsm11101.a;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsm11101C;
     #espejo1@#1012;
     ;
     #dsmow013#0, #dsmow013#2, nPeriodo, 110, nDComplem, #dsmow013#1, aDn, 0,    00, " ", "  ", 0;
     #dsmow013#0, #dsmow013#2, nPeriodo, 110, nHComplem, #dsmow013#1, aHn, 9999, 99, "z", "zz", 9;
     ;
     NULL, dsm11101C;
|FIN;

|PROCESO PasaDSM11101;
     |HAZ MiroSiConta;
     |SI sw = 0; |ACABA; |FINSI;

     |DDEFECTO #dsmom008;
     |ABRE #dsmom008;
     #dsmom008#0 = #dsmow013#0;
     #dsmom008#1 = #dsmow013#2;
     #dsmom008#2 = #dsmow013#3;
     #dsmom008#3 = #dsmow013#7;
     #dsmom008#4 = #dsmow013#9;
     #dsmom008#5 = #dsmow013#1;
     |LEE 101#dsmom008.=;
     |SI FSalida = 0;
         #dsmom008#11 = "SIN DATOS";
         |GRABA 020#dsmom008.a;

         enEmpresa     = #dsmom008#0;
         enEjer        = #dsmom008#1;
         enPeriodo     = #dsmom008#2;
         enModelo      = #dsmom008#3;
         enComplem     = #dsmom008#4;
         enActividad   = #dsmom008#5;
         enTipoEntrada = 97;
         |SUB_EJECUTA_NP "dsm11101";
     |FINSI;
     |LIBERA #dsmom008;
     |CIERRA #dsmom008;

     |ABRET #dsm11101;

     aAlfa = #dsmow013#2;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enPeriodo     = #dsmow013#3;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmow013#9;
     enActividad   = #dsmow013#1;

     |SI #dsmow013#3 ! 1;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsm11101.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida = 0;
             nDComplem = 0;
             nHComplem = enComplem;

             |PARA nPeriodo = 1;  |SI nPeriodo < #dsmow013#3;  |HACIENDO nPeriodo = nPeriodo + 1;
                   |BUCLE dsm11101C;
             |SIGUE;

             |SI #dsmow013#9 ! 0;
                 nDComplem = 0;
                 nHComplem = enComplem - 1;
                 nPeriodo  = #dsmow013#3;
                 |BUCLE dsm11101C;
             |FINSI;
         |FINSI;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     |CIERRAT #dsm11101;

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enPeriodo     = #dsmow013#3;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmow013#9;
     enActividad   = #dsmow013#1;
     enTipoEntrada = 98;
     eaNombreAct   = #dsmow013#6;
     |SUB_EJECUTA_NP "dsm11101";

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         #dsmom004#9 = " ";
         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROCESO RealizaPase;
      aAlfa1 = #dsmoz019#3;
      aAlfa1 = "01.01." + aAlfa1; efFecIni = aAlfa1;
      aAlfa1 = #dsmoz019#3;
      aAlfa1 = "31.12." + aAlfa1; efFecFin = aAlfa1;
      eaNombreEmp = #dsmow013#4;
      eaNomPer    = #dsmoz019#2;
      eaNombreAct = #dsmow013#6;

      |SI #dsmoz019#3 [ 2010;   |HAZ PasaDSMOC110;  |FINSI;
      |SI #dsmoz019#3 = 2011;   |HAZ PasaDSMOC111;  |FINSI;
      |SI #dsmoz019#3 = 2012;   |HAZ PasaDSMOC111;  |FINSI;
      |SI #dsmoz019#3 = 2013;   |HAZ PasaDSMOC111;  |FINSI;
      |SI #dsmoz019#3 = 2014;   |HAZ PasaDSMOC111;  |FINSI;
      |SI #dsmoz019#3 = 2015;   |HAZ PasaDSMOC111;  |FINSI;
      |SI #dsmoz019#3 ] 2016;   |HAZ PasaDSM11101;  |FINSI;
|FPRC;

|DEFBUCLE dsmow013;
     #dsmow013#1;
     8;
     00001, 00, "S";
     99999, 99, "S";
     ;
     NULL, RealizaPase;
|FIN;

|PROCESO dsmom008;
     #dsmow013#0 = #dsmom008#0;
     #dsmow013#1 = #dsmom008#5;
     |LEE 101#dsmow013.=;
     |SI FSalida ! 0;
         #agifigen#0 = #dsmom008#0;
         |LEE 040#agifigen.=;
         |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;

         #dsmow013#0  = #dsmom008#0;
         #dsmow013#1  = #dsmom008#5;
         #dsmow013#2  = #dsmom008#1;
         #dsmow013#3  = #dsmom008#2;
         #dsmow013#4  = #agifigen#1;
         #dsmow013#5  = #dsmoz019#2;
         #dsmow013#6  = #dsmom008#6;
         #dsmow013#7  = #dsmom008#3;
         #dsmow013#8  = "S";
         #dsmow013#10 = #dsmom008#12;
         |GRABA 020#dsmow013.n;

         enGraba = 1;
     |FINSI;
     |LIBERA #dsmow013;
|FPRC;

|DEFBUCLE dsmom008;
     #dsmom008#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, 00, 99;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, 00, 99;
     ;
     NULL, dsmom008;
|FIN;

|PROCESO GrabaTempo;
     |SI #dsmom004#9  = "X";  |ACABA;  |FINSI;
     |SI #dsmom004#11 = "X";  |ACABA;  |FINSI;
     |SI #dsmom004#13 = "X";  |ACABA;  |FINSI;

     |SI #dsmom004#5 = "ACTIVIDAD ";  |O #dsmom004#5 = "ACT.+ REG.";

          #agitab99#8 = aCampo8F99;

          #dsmom006#0 = #dsmom004#0;
          #dsmom006#1 = 110;
          |LEE 041#dsmom006.=;
          |SI FSalida = 0;
              |SI #dsmom006#13 ! " "; |Y #dsmom006#13 ! "X";
                  #agitab99#8 = #dsmom006#13;  ||Pase Modelo 110 particular de esta Empresa
              |FINSI;
          |FINSI;

          |SI #agitab99#8 = "L";
              |BUCLE dsmom008;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom004;
     #dsmom004#1;
     ;
     nDEmpresa, #dsmoz019#3, #dsmoz019#1, #dsmoz019#0, 00;
     nHEmpresa, #dsmoz019#3, #dsmoz019#1, #dsmoz019#0, 99;
     ;
     NULL, GrabaTempo;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     aFichero = ("9z" + Usuario) % 108;
     |NOME_DAT #dsmow013#aFichero#;
     |ABRE #dsmow013;  |CIERRA #dsmow013;  |DELINDEX #dsmow013;

     aAlfa1 = #dsmoz019#3; aAlfa1 = aAlfa1 % -102;
     nEjer  = aAlfa1;
     |ABRE #dsmom006;
     |ABRE #dsmow013;
     |ABRE #agifigen;
     |SI #dsmoz019#4 ! 0;
         nDEmpresa = #dsmoz019#4;
         nHEmpresa = #dsmoz019#5;
         |BUCLE dsmom004;
     |SINO;
         |PARA nCampo = 6;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               nDEmpresa = #dsmoz019#nCampo#;
               nHEmpresa = #dsmoz019#nCampo#;
               |BUCLE dsmom004;
         |SIGUE;
     |FINSI;
     |CIERRA #agifigen;
     |CIERRA #dsmow013;
     |CIERRA #dsmom006;

     |SI enGraba = 1;
         |BUCLE dsmow013;
     |SINO;
         |MENAV "     Seleccion Vacia.";
     |FINSI;

     |DELINDEX #dsmow013;
|FPRC;

|PROGRAMA;
     enDesdePase = 1;
     |SI enEmpresa ! 0;

         aFichero = ("pas" + Usuario) % 108;
         |NOME_DAT #dsmow013#aFichero#;
         |ABRE #dsmow013;  |CIERRA #dsmow013;  |DELINDEX #dsmow013;

         #dsmoz019#0 = enModelo;
         #dsmoz019#1 = enPeriodo;
         #dsmoz019#3 = enEjer;
         #dsmoz019#4 = enEmpresa;
         #dsmoz019#5 = enEmpresa;

         |ABRE #dsmow013;
         #dsmow013#0  = enEmpresa;
         #dsmow013#1  = enActividad;
         #dsmow013#2  = enEjer;
         #dsmow013#3  = enPeriodo;
         #dsmow013#6  = eaNombreAct;
         #dsmow013#7  = enModelo;
         #dsmow013#8  = "S";
         #dsmow013#9  = enComplem;
         #dsmow013#10 = enModelo1;
         |GRABA 020#dsmow013.n;
         |CIERRA #dsmow013;

         enMasivo = 0;
         |BUCLE dsmow013;

         |DELINDEX #dsmow013;
         |ACABA;
     |FINSI;
     |CLS;
     |DDEFECTO #dsmoz019;

     #dsmoz019#0 = 110;
     enMasivo = 1;
     |C_M #dsmoz019#0, 1, "N";
     |PINPA #0#dsmoz019;
     |PINDA #0#dsmoz019;
     |ENDATOS #1#dsmoz019;
|FPRO;
