|FICHEROS;
     dsmo1347 #1;
     dsmo2347 #2;
     dsmo3347 #3;
     dsmo4347 #44;
     dsmom004 #4;

     dsmow113 #913;   || Auxiliar para contar total arrendamientos
     dsmow159 #959;   || Auxiliar para contar total operaciones A y B

     dsm1347@;
     dsm2347@;
     dsm3347@;
|FIN;

|VARIABLES;
     aFichero   = "";
     nSwChequea = 0;
     nSwComplem = 0;
     nSuma      = 0;
     nBorra     = 0;
     nTopeA     = 0;
     nTopeB     = 0;
     nTopeC     = 0;
     nTopeD     = 0;
     nTopeE     = 0;
     nTopeCobro = 0;
     nCampo     = 0;
     nComp      = 0;
     nImporte   = 0;
     nImpCobro  = 0;
     nHay       = 0;
     nEjerCobro = 0;
     nNegativo  = 0;
     aCampo7    = "";
     nSw        = 0;
     nDesdeMenu = 0;
     nOpera     = 0;
     aClave     = "";
     aAlfa      = "";
     nPara1     = 0;
     nPara2     = 0;
     nPara3     = 0;
     aBase      = "";
     aMas       = "";

     &eSwDniH   = 0;

{-1} aMenu   = "";
     aMenu1  = "1057";
     aMenu2  = "1";
     aMenu3  = "9";
     aMenu4  = "A (Compras)         ";
     aMenu5  = "B (Ventas)          ";
     aMenu6  = "C (Cobros Ctas.Ter.)";
     aMenu7  = "D (Adq.Bienes y Ser)";
     aMenu8  = "E (Subvenciones)    ";
     aMenu9  = "F (Ventas Agencias) ";
     aMenu10 = "G (Compras Agencias)";
     aMenu11 = "Arrendamientos      ";
     aMenu12 = "Cabecera Manual     ";

|FIN;

|INCLUYE i_variar;

|RUTINA ClaveBaja2;
     #2#0  = #1#0;
     #2#1  = #1#1;
     #2#2  = #1#2;
     #2#3  = #1#3;
     #2#4  = #1#4;
     #2#5  = #1#5;
     #2#6   = eaClave347;
     #2#7   = "            ";
     #2#25 = "N";
     #2#26 = "N";
     #2#8  = "N";
     #2#9  = "N";
     #2#27 = "N";
|FRUT;

|RUTINA ClaveAlta2;
     #2#0  = #1#0;
     #2#1  = #1#1;
     #2#2  = #1#2;
     #2#3  = #1#3;
     #2#4  = #1#4;
     #2#5  = #1#5;
     #2#6  = eaClave347;
     #2#7  = "zzzzzzzzzzzz";
     #2#25 = "S";
     #2#26 = "S";
     #2#8  = "S";
     #2#9  = "S";
     #2#27 = "S";
|FRUT;

|PROCESO Lineal1;
     |PINPA #0#2;
     |HAZ PintaClave;

     |C_M #2#12,1,"S";
     |C_M #2#25,1,"S";
     |C_M #2#26,1,"S";
     |C_M #2#27,1,"S";
     |SI eaClave347 ! "A";
         |C_M #2#25,1,"N"; #2#25 = "N"; |PINTA #2#25;
     |FINSI;
     |SI eaClave347 ! "A"; |Y eaClave347 ! "B";
         |C_M #2#8, 1,"N"; #2#8  = "N"; |PINTA #2#8;
         |C_M #2#9, 1,"N"; #2#9  = "N"; |PINTA #2#9;
         |C_M #2#25,1,"N"; #2#25 = "N"; |PINTA #2#25;
         |C_M #2#26,1,"N"; #2#26 = "N"; |PINTA #2#26;
         |C_M #2#27,1,"N"; #2#27 = "N"; |PINTA #2#27;
     |FINSI;
     |SI #1#1 < 2014;
         |C_M #2#25,1,"N"; #2#25 = "N"; |PINTA #2#25;
         |C_M #2#26,1,"N"; #2#26 = "N"; |PINTA #2#26;
         |C_M #2#27,1,"N"; #2#27 = "N"; |PINTA #2#27;
     |FINSI;
     |SI #1#1 ] 2011; |C_M #2#12,1,"N"; |FINSI;

     |SI enTipoEntrada = 4;
         |ENTLINEAL #1#2, -8, 4, 22, 0, ClaveBaja2, ClaveAlta2;
     |SINO;
         |ENTLINEAL #1#2, -8, 2, 22, 0, ClaveBaja2, ClaveAlta2;
     |FINSI;
|FPRC;

|RUTINA ClaveBaja3;
     #3#0 = #1#0;
     #3#1 = #1#1;
     #3#2 = #1#2;
     #3#3 = #1#3;
     #3#4 = #1#4;
     #3#5 = 01;
     #3#6 = 01;
     #3#7 = "            ";
|FRUT;

|RUTINA ClaveAlta3;
     #3#0 = #1#0;
     #3#1 = #1#1;
     #3#2 = #1#2;
     #3#3 = #1#3;
     #3#4 = #1#4;
     #3#5 = 99;
     #3#6 = 99;
     #3#7 = "zzzzzzzzzzzz";
|FRUT;

|PROCESO Lineal2;
     |PINPA #0#3;
     |HAZ PintaClave2;

     |C_M #3#10,1,"S";
     |SI #1#1 ] 2011; |C_M #3#10,1,"N"; |FINSI;

     |SI enTipoEntrada = 4;
         |ENTLINEAL #1#3, -6, 4, 22, 0, ClaveBaja3, ClaveAlta3;
     |SINO;
         |ENTLINEAL #1#3, -6, 2, 22, 0, ClaveBaja3, ClaveAlta3;
     |FINSI;
|FPRC;

|PROCESO Recalcula4Arren;

     #2#0  = #44#0;
     #2#1  = #44#1;
     #2#2  = #44#2;
     #2#3  = #44#3;
     #2#4  = #44#4;
     #2#5  = #44#5;
     #2#6  = #44#6;
     #2#7  = #44#7;
     #2#25 = #44#12;
     #2#26 = #44#13;
     #2#8  = #44#8;
     #2#9  = #44#9;
     #2#27 = #44#14;
     |LEE 101#2=;
     |SI FSalida ! 0;
         |BORRA 020#44a;
         |LIBERA #44;
     |SINO;

         #1#8 = #1#8 + 1;
         #2#15 = #2#15 + #44#11;
         |GRABA 020#2a;
     |FINSI;
     |LIBERA #2;
     |LIBERA #44;
|FPRC;

|DEFBUCLE dsmoc4347Arren;
     #44#1;
     ;
     #1#0, #1#1, #1#2, #1#3, #1#4, #1#5, "B", "            ", "N", "N", "N", "S", "N", 2999;
     #1#0, #1#1, #1#2, #1#3, #1#4, #1#5, "B", "zzzzzzzzzzzz", "N", "N", "N", "S", "S", 1990;
     be;
     NULL, Recalcula4Arren;
|FIN;

|PROCESO Recalcula4;
     |SI nBorra = 1;
         |SI #2#6 = "A"; #1#6 = #1#6 - 1; |FINSI;
         |SI #2#6 = "B"; #1#8 = #1#8 - 1; |FINSI;
         |BORRA 020#44a;
         |LIBERA #44;
         |ACABA;
     |FINSI;

     |SI #44#11 < nTopeCobro;
         |BORRA 020#44a;
         |LIBERA #44;
         |ACABA;
     |FINSI;

     |SI #2#6 = "A"; #1#6 = #1#6 + 1; |FINSI;
     |SI #2#6 = "B"; |Y #2#9 = "N"; #1#8 = #1#8 + 1; |FINSI;

     #2#15 = #2#15 + #44#11;
     nHay  = 1;
     |LIBERA #44;
|FPRC;

|DEFBUCLE dsmoc4347;
     #44#1;
     ;
     #2#0, #2#1, #2#2, #2#3, #2#4, #2#5, #2#6, #2#7, #2#25, #2#26, #2#8, #2#9, #2#27, nEjerCobro;
     #2#0, #2#1, #2#2, #2#3, #2#4, #2#5, #2#6, #2#7, #2#25, #2#26, #2#8, #2#9, #2#27, 2008;
     be;
     NULL, Recalcula4;
|FIN;

|PROCESO EnOtraAnterior;
     nSw = 1;
|FPRC;

|DEFBUCLE EnOtraDs3347;
     #dsm3347@#1007;
     ;
     #3#0, #3#1, #3#2, #3#3, nPara2, #3#5, #3#6;
     #3#0, #3#1, #3#2, #3#3, nPara3, #3#5, #3#6;
     e;
     NULL, EnOtraAnterior;
|FIN;

|DEFBUCLE EnOtraDs2347;
     #dsm2347@#1013;
     ;
     #2#0, #2#1, #2#2, #2#3, nPara2, #2#5, #2#6, #2#7, #2#25, #2#26, #2#8, #2#9, #2#27;
     #2#0, #2#1, #2#2, #2#3, nPara3, #2#5, #2#6, #2#7, #2#25, #2#26, #2#8, #2#9, #2#27;
     e;
     NULL, EnOtraAnterior;
|FIN;

|PROCESO Recalcula2;

     |SI nSwComplem = 1;
         nSw = 0;
         |BUCLE EnOtraDs2347;
         |SI nSw = 1;
             |BORRA 020#2a;
             |SI #2#6 = "A"; |O #2#6 = "B";
                 nBorra = 1; |BUCLE dsmoc4347; nBorra = 0;
             |FINSI;
         |FINSI;
         |LIBERA #2;
         |ACABA;
     |FINSI;

     nEjerCobro = #2#1 - 1;
     |SI nBorra = 1;
         |BORRA 020#2a;
         |LIBERA #2;
         |SI #2#6 = "A"; |O #2#6 = "B";
             |BUCLE dsmoc4347;
         |FINSI;
         |ACABA;
     |FINSI;

     |SI nSwChequea = 0;
         nSwChequea = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI enEjer ] 2012;
         nHay  = 0;
         #2#15 = 0;
         |SI #2#6 = "B";   || solo cobros
             |BUCLE dsmoc4347;
         |FINSI;
     |SINO;
         nHay  = 0;
         #2#15 = 0;
         |SI #2#6 = "A"; |O #2#6 = "B";
             |BUCLE dsmoc4347;
         |FINSI;
     |FINSI;

     nNegativo = #2#12;
     |SI #2#6 = "A"; |O #2#6 = "B";
         #959#0 = #2#7;
         #959#1 = #2#6;
         |LEE 041#959=;
         |SI FSalida = 0;
             nNegativo = #959#2;  ||todas las lineas
         |FINSI;
     |FINSI;

     |SI nNegativo < 0; |Y #2#1 > 2010;  nNegativo = - #2#12; |FINSI;

     |SI #2#6 = "A";  |Y nNegativo < nTopeA;
         |SI #2#30 ! 0; |Y #2#1 ] 2018;
             nHay = 1;
         |FINSI;

         |SI nHay = 0;
             |BORRA 020#2a;
             |LIBERA #2;
             |ACABA;
         |SINO;
             #2#12 = 0;
             #2#13 = 0;
             |PDEFECTO #2, 16,25;
             #2#28 = 0;
             |GRABA 020#2a;
         |FINSI;
     |FINSI;

     #2#24 = 0;
     |SI enEjer ] 2012; |Y #2#6 = "B"; |Y #2#9 = "N";
         |DDEFECTO #913;
         #913#0 = #2#7;
         #913#1 = "B";
         #913#6 = "N";
         #913#7 = "S";
         #913#22 = "N";
         #913#23 = "N";
         #913#24 = #2#27;
         |LEE 101#913=;
         |SI FSalida = 0;
             #2#24  = 1;
             #913#8 = #2#12;
             #913#9 = #2#28;
             |GRABA 020#913a;
             nNegativo = #913#2 + #2#12;
             |SI nNegativo < 0; |Y #2#1 > 2010; nNegativo = - nNegativo; |FINSI;
         |FINSI;
         |LIBERA #913;
     |FINSI;

     |SI #2#6 = "B";  |Y nNegativo < nTopeB;
         |SI nDesdeMenu = 1; |Y #2#9 = "N"; |Y nNegativo ! 0;  || tique 1624_1849
             |MENAV "    Hay informadas Ventas inferiores al Tope. Al salir del Modelo se Recalcular";
         |SINO;
             |SI #2#30 ! 0; |Y #2#1 ] 2018;
                 nHay = 1;
             |FINSI;
             |SI nHay = 0;
                 |BORRA 020#2a;
                 |LIBERA #2;
                 |ACABA;
             |SINO;
                 #2#12 = 0;
                 #2#13 = 0;
                 |PDEFECTO #2, 16,24;
                 #2#28 = 0;
                 |GRABA 020#2a;
             |FINSI;
         |FINSI;
     |SINO;
         |SI #2#6 = "B"; |Y nNegativo ] nTopeB; |Y #2#9 = "N";
             |GRABA 020#2a;
         |FINSI;
     |FINSI;

     |SI #2#6 = "C";  |Y nNegativo < nTopeC;
         |BORRA 020#2a;
         |LIBERA #2;
         |ACABA;
     |FINSI;

     |SI #2#6 = "D";  |Y nNegativo < nTopeD;
         |BORRA 020#2a;
         |LIBERA #2;
         |ACABA;
     |FINSI;

     |SI #2#6 = "E";  |Y nNegativo < nTopeE;
         |BORRA 020#2a;
         |LIBERA #2;
         |ACABA;
     |FINSI;

     |SI #2#6 = "B";  |Y #2#9 = "S";
         |SI #2#15 = 0; |Y #2#30 = 0;
             |BORRA 020#2a;
             |LIBERA #2;
             |ACABA;
         |SINO;
             #2#12 = 0;
             #2#13 = 0;
             #2#15 = 0;
             |PDEFECTO #2,16,24;
             #2#28 = 0;
             |GRABA 020#2a;
             |LIBERA #2;
         |FINSI;
     |FINSI;

     |HAZ Tipo2mo2347;
     |LIBERA #44;
|FPRC;

|DEFBUCLE dsmoc2347;
     #2#1;
     ;
     #1#0, #1#1, #1#2, #1#3, #1#4, #1#5, " ", "            ", "N", "N", "N", "N", "N";
     #1#0, #1#1, #1#2, #1#3, #1#4, #1#5, "z", "zzzzzzzzzzzz", "S", "S", "S", "S", "S";
     be;
     NULL, Recalcula2;
|FIN;
aqui
|PROCESO Recalcula3;
     |SI nSwComplem = 1;
         nSw = 0;
         |BUCLE EnOtraDs3347;
         |SI nSw = 1;
             |BORRA 020#3a;
         |FINSI;
         |LIBERA #3;
         |ACABA;
     |FINSI;

     |SI nBorra = 1;
         |BORRA 020#3a;
         |LIBERA #3;
         |ACABA;
     |FINSI;

     |SI nSwChequea = 0;
         nSwChequea = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     #913#0 = #3#7;
     #913#1 = "B";
     #913#6 = "N";
     #913#7 = "S";
     #913#22 = "N";
     #913#23 = "N";
     #913#24 = #3#17;
     |LEE 001#913=;
     |SI FSalida = 0;
         nImporte  = #913#2 + #913#8;  ||tique 1624_1849
         nImpCobro = #913#4;
     |SINO;
         nImporte  = #3#10;
         nImpCobro = #3#12;
     |FINSI;

     nNegativo = nImporte;
     |SI nImporte < 0; |Y #3#1 > 2010; nNegativo = - nImporte; |FINSI;

     |SI nNegativo < nTopeB;
         |SI nDesdeMenu = 0;
            |BORRA 020#3a;
            |LIBERA #3;
            |ACABA;
         |FINSI;
     |FINSI;

     |SI nImpCobro < nTopeCobro;
         #3#12 = 0;
     |FINSI;

     #1#16 = #1#16 + 1;
     #1#17 = #1#17 + #3#10;

     |ABRE #2;
     #2#0 = #3#0;
     #2#1 = #3#1;
     #2#2 = #3#2;
     #2#3 = #3#3;
     #2#4 = #3#4;
     #2#5 = 0;
     #2#6 = "B";
     #2#7 = #3#7;
     #2#8 = "N";
     #2#9 = "S";
     #2#25 = "N";
     #2#26 = "N";
     #2#27 = #3#17;
     |LEE 101#2=;
     |SI FSalida ! 0;
         |DDEFECTO #2;
         #2#0  = #3#0;
         #2#1  = #3#1;
         #2#2  = #3#2;
         #2#3  = #3#3;
         #2#4  = #3#4;
         #2#5  = 0;
         #2#6  = "B";
         #2#7  = #3#7;
         #2#8  = "N";
         #2#9  = "S";
         #2#25 = "N";
         #2#26 = "N";
         #2#27 = #3#17;
         #2#10 = #3#11;
         #2#11 = #3#8;
         #2#12 = #3#10;
         #2#13 = #3#12;
         #2#15 = 0;
         #2#16 = #3#13;
         #2#17 = #3#14;
         #2#18 = #3#15;
         #2#19 = #3#16;
         #2#28 = #3#18;
         |SI #913#8 ! 0; #2#24 = 1; |FINSI;
         |SI #2#27 = "S";
             #2#16 = 0;
             #2#17 = 0;
             #2#18 = 0;
             #2#19 = 0;
         |FINSI;
         |GRABA 020#2n;

         #1#8  = #1#8  + 1;
         #1#9  = #1#9  + #3#10;
     |SINO;
         #2#12 = #2#12 + #3#10;
         #2#13 = #2#13 + #3#12;
         #2#15 = 0;
         #2#16 = #2#16 + #3#13;
         #2#17 = #2#17 + #3#14;
         #2#18 = #2#18 + #3#15;
         #2#19 = #2#19 + #3#16;
         |SI #2#27 = "S";
             #2#16 = 0;
             #2#17 = 0;
             #2#18 = 0;
             #2#19 = 0;
         |FINSI;
         #2#28 = #2#28 + #3#18;
         |GRABA 020#2a;

         |SI aCampo7 ! #3#7; |O nSw = 0;
             #1#8    = #1#8 + 1;
         |FINSI;
         #1#9  = #1#9  + #3#10;
     |FINSI;
     |LIBERA #2;
     |CIERRA #2;

     aCampo7 = #3#7;
     nSw     = 1;
|FPRC;

|DEFBUCLE dsmoc3347;
     #3#1;
     ;
     #1#0, #1#1, #1#2, #1#3, #1#4, 01, 00;
     #1#0, #1#1, #1#2, #1#3, #1#4, 99, 99;
     be;
     NULL, Recalcula3;
|FIN;

|DEFBUCLE dsmoc3347_C2;
     #3#2;
     ;
     #1#0, #1#1, #1#2, #1#3, #1#4, "            ";
     #1#0, #1#1, #1#2, #1#3, #1#4, "zzzzzzzzzzzz";
     be;
     NULL, Recalcula3;
|FIN;

|PROCESO LeeArrendamiento;
  |DDEFECTO #913;
  #913#0 = #3#7;
  #913#1 = "B";
  #913#6 = "N";
  #913#7 = "S";
  #913#22 = "N";
  #913#23 = "N";
  #913#24 = #3#17;
  |LEE 141#913=;
  |SI FSalida ! 0;
      |DDEFECTO #913;
      #913#0 = #3#7;
      #913#1 = "B";
      #913#6 = "N";
      #913#7 = "S";
      #913#22 = "N";
      #913#23 = "N";
      #913#24 = #3#17;
      |GRABA 020#913b;
  |FINSI;
  #913#2  = #913#2 + #3#10;
  #913#4  = #913#4 + #3#12;
  |GRABA 020#913a;
  |LIBERA #913;
|FPRC;

|DEFBUCLE LeeArrendamiento;
     #3#1;
     ;
     #1#0, #1#1, #1#2, #1#3, #1#4, 01, 00;
     #1#0, #1#1, #1#2, #1#3, #1#4, 99, 99;
     ;
     NULL, LeeArrendamiento;
|FIN;

|PROCESO Auxiliar959;
    aClave = #2#6;
    |SI #2#6 = "F"; aClave = "B"; |FINSI;
    |SI #2#6 = "B"; |Y #2#9 = "S"; |ACABA; |FINSI;

    |SI aClave = "A"; |O aClave = "B";
        |DDEFECTO #959;
        #959#0 = #2#7;
        #959#1 = aClave;
        |LEE 041#959=;
        |SI FSalida ! 0;
            |DDEFECTO #959;
            #959#0 = #2#7;
            #959#1 = aClave;
            |GRABA 020#959b;
        |FINSI;
        #959#2  = #959#2 + #2#12;
        |GRABA 020#959a;
    |FINSI;
    |LIBERA #959
|FPRC;

|DEFBUCLE Auxiliar959;
     #2#1;
     ;
     #1#0, #1#1, #1#2, #1#3, #1#4, #1#5, "A", "            ", "N", "N", "N", "N", "N"; || sin arren
     #1#0, #1#1, #1#2, #1#3, #1#4, #1#5, "F", "zzzzzzzzzzzz", "S", "S", "S", "S", "S"; || arrenda
     e;
     NULL, Auxiliar959;
|FIN;


|PROCESO Recalculo;
         nSwChequea = 0;  |BUCLE dsmoc2347;
     |SI nSwChequea = 0;  |BUCLE dsmoc3347;  |FINSI;

     |SI nSwChequea = 0;  |ACABA;  |FINSI;

     aFichero = "xx" + Usuario;
     |NOME_DAT #913 aFichero; |DELINDEX #913;
     aFichero = "yy" + Usuario;
     |NOME_DAT #959 aFichero; |DELINDEX #959;

     |ABRE #959;
     |BUCLE Auxiliar959;
     |CIERRA #959;

     |ABRE #913;
     |BUCLE LeeArrendamiento;
     |CIERRA #913;

     |PDEFECTO #1, 6,  18;
     |PDEFECTO #1, 20, 24;

     |ABRE #913;
     |ABRE #959;
     |BUCLE dsmoc2347;
     |CIERRA #959;
     |CIERRA #913;

     nSw     = 0;
     |ABRE #913; |BUCLE dsmoc3347_C2; |CIERRA #913;
     |DELINDEX #913;
     |DELINDEX #959;

     |ABRE #2;
     |BUCLE dsmoc4347Arren;
     |CIERRA  #2;
|FPRC;

|PROCESO Manual;
         nSwChequea = 0;  |BUCLE dsmoc2347;
     |SI nSwChequea = 0;  |BUCLE dsmoc3347;  |FINSI;

     |SI nSwChequea ! 0;
         |MENAV "     No puedo dejar entrada manual, ya que hay lineas introducidas.";
         |ACABA;
     |FINSI;

     |C_M #1#6,  1, "S";  |C_M #1#7,  1, "S";
     |C_M #1#8,  1, "S";  |C_M #1#9,  1, "S";
     |C_M #1#10, 1, "S";  |C_M #1#11, 1, "S";
     |C_M #1#12, 1, "S";  |C_M #1#13, 1, "S";
     |C_M #1#14, 1, "S";  |C_M #1#15, 1, "S";
     |C_M #1#16, 1, "S";  |C_M #1#17, 1, "S";
     |C_M #1#20, 1, "S";  |C_M #1#21, 1, "S";
     |C_M #1#22, 1, "S";  |C_M #1#23, 1, "S";

     |ENDATOS #1#1;

     |C_M #1#6,  1, "N";  |C_M #1#7,  1, "N";
     |C_M #1#8,  1, "N";  |C_M #1#9,  1, "N";
     |C_M #1#10, 1, "N";  |C_M #1#11, 1, "N";
     |C_M #1#12, 1, "N";  |C_M #1#13, 1, "N";
     |C_M #1#14, 1, "N";  |C_M #1#15, 1, "N";
     |C_M #1#16, 1, "N";  |C_M #1#17, 1, "N";
     |C_M #1#20, 1, "N";  |C_M #1#21, 1, "N";
     |C_M #1#22, 1, "N";  |C_M #1#23, 1, "N";
|FPRC;

|PROCESO Menug;
     |PARA; |SI; |HACIENDO;
            |PUSHV 0501 2380;
            |MENUG aMenu;
            aMenu2 = FSalida;
            |SI aMenu2 ] "1"; |Y aMenu2 [ "9";
                |SI aMenu2 = 1; eaClave347 = "A";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 2; eaClave347 = "B";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 3; eaClave347 = "C";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 4; eaClave347 = "D";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 5; eaClave347 = "E";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 6; eaClave347 = "F";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 7; eaClave347 = "G";     |HAZ Lineal1;    |FINSI;
                |SI aMenu2 = 8;                       |HAZ Lineal2;    |FINSI;
                |SI aMenu2 = 9; |Y enTipoEntrada ! 4; |HAZ Manual;     |FINSI;
                |SI enEjer ] 2012; nDesdeMenu = 1; |FINSI;
                |HAZ Recalculo;
                nDesdeMenu = 0;
            |SINO;
                |POPV;
                |SAL;
            |FINSI;
            |POPV;
            |PINDA #0#1;
     |SIGUE;
     |HAZ Recalculo;
     |PINDA #0#1;
|FPRC;

|PROCESO BRepComplem;

      |DBASE aBase;  |QBF aBase;
      aMas = aBase + "def/dsmo3347.mas";
      |CARGA_DEF aMas, dsm3347@;
      |SI FSalida ! 0;
          |ACABA;
      |FINSI;

      |DBASE aBase;  |QBF aBase;
      aMas = aBase + "def/dsmo2347.mas";
      |CARGA_DEF aMas, dsm2347@;
      |SI FSalida ! 0;
          |DESCARGA_DEF #dsm3347@;
          |ACABA;
      |FINSI;

      |DBASE aBase;  |QBF aBase;
      aMas = aBase + "def/dsmo1347.mas";
      |CARGA_DEF aMas, dsm1347@;
      |SI FSalida ! 0;
          |DESCARGA_DEF #dsm2347@;
          |DESCARGA_DEF #dsm3347@;
          |ACABA;
      |FINSI;

      |ABRE #dsm1347@;
      nPara2 = 0;
      nPara3 = 0;
      nPara1 = #1#4 - 1;
      |PARA nComp = 0; |SI nComp [ nPara1; |HACIENDO nComp = nComp + 1;
            #dsm1347@#0 = #dsmo1347#0;
            #dsm1347@#1 = #dsmo1347#1;
            #dsm1347@#2 = #dsmo1347#2;
            #dsm1347@#3 = #dsmo1347#3;
            #dsm1347@#4 = nComp;
            |LEE 041#dsm1347@.=;
            |SI FSalida = 0;
                |SI #dsm1347@#4 = 0; |O #dsm1347@#19 = "S";
                    nPara2 = nComp;
                |FINSI;
                nPara3 = nComp;
            |FINSI;
       |SIGUE;
       |CIERRA #dsm1347@;
       |DESCARGA_DEF #dsm1347@;

       nSwComplem = 1;  |BUCLE dsmoc2347;
                        |BUCLE dsmoc3347;
       nSwComplem = 0;

       |DESCARGA_DEF #dsm2347@;
       |DESCARGA_DEF #dsm3347@;
|FPRC;

|PROCESO Traedsmoc4347;
     #44#4 = #1#4;
     |GRABA 020#44n;
     |LIBERA #44;
|FPRC;

|DEFBUCLE dsmoc4347T;
     #44#1;
     ;
     #2#0, #2#1, #2#2, #2#3, #2#4, #2#5, #2#6, #2#7, #2#25, #2#26, #2#8, #2#9, #2#27, 2999;
     #2#0, #2#1, #2#2, #2#3, #2#4, #2#5, #2#6, #2#7, #2#25, #2#26, #2#8, #2#9, #2#27, 2008;
     be;
     NULL, Traedsmoc4347;
|FIN;

|PROCESO Traedsmoc2347;
     |SI enEjer ] 2012;
         |SI #2#6 = "B";
             |BUCLE dsmoc4347T;
         |FINSI;
     |SINO;
         |SI #2#6 = "A"; |O #2#6 = "B";
             |BUCLE dsmoc4347T;
         |FINSI;
     |FINSI;
     #2#4 = #1#4;
     |GRABA 020#2n;
     |LIBERA #2;
|FPRC;

|DEFBUCLE dsmoc2347T;
     #2#1;
     ;
     #1#0, #1#1, #1#2, #1#3, nComp, #1#5, " ", "            ", "N", "N", "N", "N", "N";
     #1#0, #1#1, #1#2, #1#3, nComp, #1#5, "z", "zzzzzzzzzzzz", "S", "S", "S", "S", "S";
     be;
     NULL, Traedsmoc2347;
|FIN;

|PROCESO Traedsmoc3347;
     #3#4 = #1#4;
     |GRABA 020#3n;
     |LIBERA #3;
|FPRC;

|DEFBUCLE dsmoc3347T;
     #3#1;
     ;
     #1#0, #1#1, #1#2, #1#3, nComp, 01, 01;
     #1#0, #1#1, #1#2, #1#3, nComp, 99, 99;
     be;
     NULL, Traedsmoc3347;
|FIN;

|PROCESO Justificante;
     |SI #1#4 = 0;  |ACABA;  |FINSI;

     |SI #1#19 ! "C";  |Y #1#19 ! "S";
         |MENAV "      Introduzca Complementaria o Sustitutoria";
         |ERROR;
     |FINSI;

     |C_M #1#18, 1, "N";
     |SI #1#19 = "S";  |O #1#19 = "C";
         |C_M #1#18, 1, "S";

         |SI #1#18 = "             ";
             |ABRE #4;
             #4#0 = #1#0;
             #4#1 = #1#1;
             #4#2 = #1#2;
             #4#3 = #1#3;
             #4#4 = #1#4 - 1;
             |LEE 000#4=;
             |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
             |CIERRA #4;

             #1#18 = #4#25;  |PINTA #1#18;
         |FINSI;
     |SINO;
         #1#18 = "";  |PINTA #1#18;
     |FINSI;

     |SI #1#19 = "S";
         nSuma = 0;
         |PARA nCampo = 6;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               nSuma = nSuma + #1nCampo;
         |SIGUE;

         |SI nSuma = 0;

             |DBASE aBase;  |QBF aBase;
             aMas = aBase + "def/dsmo1347.mas";
             |CARGA_DEF aMas, dsm1347@;
             |SI FSalida ! 0;  |ACABA;  |FINSI;

             |ABRE #dsm1347@;

             nPara1 = #1#4 - 1;
             |PARA nComp = 0; |SI nComp [ nPara1; |HACIENDO nComp = nComp + 1;

                   #dsm1347@#0 = #dsmo1347#0;
                   #dsm1347@#1 = #dsmo1347#1;
                   #dsm1347@#2 = #dsmo1347#2;
                   #dsm1347@#3 = #dsmo1347#3;
                   #dsm1347@#4 = nComp;
                   |LEE 041#dsm1347@.=;
                   |SI FSalida = 0;
                       |SI #dsm1347@#4 = 0; |O #dsm1347@#19 = "S";
                           nBorra = 1;  |BUCLE dsmoc2347;
                                        |BUCLE dsmoc3347;
                           nBorra = 0;
                       |FINSI;
                       |BUCLE dsmoc2347T;
                       |BUCLE dsmoc3347T;
                   |FINSI;
             |SIGUE;
             |CIERRA #dsm1347@;

             |DESCARGA_DEF #dsm1347@;

             |HAZ Recalculo;

             |HAZ LaPantalla;
             |PINDA #0#1;
             |HAZ PintaDatos;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo12moc1347;  |TIPO 12;
|FPRC;

|PROCESO VerComplem;
  |SI #1#4 > 0;
      |ABRE #4;
      #4#0 = #1#0;
      #4#1 = #1#1;
      #4#2 = #1#2;
      #4#3 = #1#3;
      #4#4 = #1#4;
      |LEE 141#4=;
      |SI FSalida = 0;
          |SI nOpera = 0;
              #1#19 = #4#24;
              #1#18 = #4#21;
          |SINO;
              #4#24 = #1#19;
              #4#21 = #1#18;
              |GRABA 020#4a;
          |FINSI;
      |FINSI;
      |LIBERA #4;
      |CIERRA #4;
   |FINSI;
|FPRC;

|PROCESO LaPantalla;
     |PINPA #0#1;
     |SI enEjer ] 2018; |Y enComplem > 0;
         |ATRI P;
         aAlfa = "Las complementarias registros no declarados previamente. ";
         |PINTA 2303, aAlfa;
         |ATRI 0;
     |FINSI;
|FPRC;

|PROGRAMA;
     |HAZ LeeEURODBMOD;

     eaNomDef    = "dsmo1347";
     enResultado = 0;

     |SI EURODBMOD ! 0;
         nTopeA  = 3005.06;
         nTopeB  = 3005.06;
         nTopeC  = 300.51;
         nTopeD  = 3005.06;
         nTopeE  = 3005.06;
         nTopeCobro = 6000.01;
     |SINO;
         nTopeA  = 500000;
         nTopeB  = 500000;
         nTopeC  = 50000;
         nTopeD  = 50000;
         nTopeE  = 50000;
         nTopeCobro = 1000000;
     |FINSI;

     eSwDniH = 0; aAlfa = eaCliNif % 101;
     |SI aAlfa = "H"; eSwDniH = 1; |FINSI;
|| \\\\\\ Alta del Modelo ////////

     |SI enTipoEntrada = 1;              || Consulta del Modelo
         |CABEZA "Modelo 347";
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enPeriodo;
         #1#3 = enModelo;
         #1#4 = enComplem;
         #1#5 = enActividad;
         |LEE 040#1=;
         |SI FSalida ! 0;
             |DDEFECTO #1;
             #1#0 = enEmpresa;
             #1#1 = enEjer;
             #1#2 = enPeriodo;
             #1#3 = enModelo;
             #1#4 = enComplem;
             #1#5 = enActividad;
             nOpera = 0; |HAZ VerComplem;
             |GRABA 020#1b;
         |FINSI;

         |HAZ LaPantalla;
         |PINDA #0#1;
         |HAZ PintaDatos;

         |SI #1#4 ! 0;
             |SI enEjer < 2018;
                 |C_M #1#19, 1, "S";
             |FINSI;
             |ENDATOS #1#1;
         |FINSI;

         |HAZ Menug;

         nSuma = #1#6  + #1#7  + #1#8  + #1#9  + #1#10 + #1#11 + #1#12 + #1#13;
         nSuma = nSuma + #1#14 + #1#15 + #1#16 + #1#17 + #1#20 + #1#21 + #1#22 + #1#23;

         |SI nSuma = 0;
             |BORRA 020#1a;
             enEntrada = 0;
         |SINO;
             |GRABA 020#1a;
             enEntrada = 1;
             nOpera = 1; |HAZ VerComplem;
         |FINSI;
         |LIBERA #1;
         |CIERRA #1;

         |ACABA;
     |FINSI;

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
         |CABEZA "Modelo 347";
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enPeriodo;
         #1#3 = enModelo;
         #1#4 = enComplem;
         #1#5 = enActividad;
         |LEE 040#1=;
         |SI FSalida ! 0;
             |MENAV "      No existe Registro.";
             |CIERRA #1;
             |ACABA;
         |FINSI;

         |HAZ LaPantalla;
         |PINDA #0#1;
         |HAZ PintaDatos;

         |HAZ Menug;

         |CIERRA #1;

         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              || Baja del Modelo
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enPeriodo;
         #1#3 = enModelo;
         #1#4 = enComplem;
         #1#5 = enActividad;
         |LEE 040#1=;
         |SI FSalida ! 0;
             |SI enMensa = 0;
                 |MENAV "      No existe Registro.";
             |FINSI;
             |CIERRA #1;
             |ACABA;
         |FINSI;

         nBorra = 1;  |BUCLE dsmoc2347;
                      |BUCLE dsmoc3347;
         nBorra = 0;

         |BORRA 020#1a;
         |LIBERA #1;

         |CIERRA #1;

         |ACABA;
     |FINSI;

|| \\\\\\ Recalculo totales registro 1

     |SI enTipoEntrada = 92;
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enPeriodo;
         #1#3 = enModelo;
         #1#4 = enComplem;
         #1#5 = 0;
         |LEE 040#1=;
         |SI FSalida = 0;

             |HAZ Recalculo;
             |GRABA 020#1a;
         |FINSI;
         |LIBERA #1;
         |CIERRA #1;

         |ACABA;
     |FINSI;

|| \\\\\\ Alta desde el Pase del Modelo

     |SI enTipoEntrada = 98;
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enPeriodo;
         #1#3 = enModelo;
         #1#4 = enComplem;
         #1#5 = enActividad;
         |LEE 040#1=;
         |SI FSalida ! 0;
             #1#0 = enEmpresa;
             #1#1 = enEjer;
             #1#2 = enPeriodo;
             #1#3 = enModelo;
             #1#4 = enComplem;
             #1#5 = enActividad;
             nOpera = 0; |HAZ VerComplem;
             |GRABA 020#1b;
         |FINSI;

         |SI #1#4 > 0; |Y #1#19 = "C"; |Y enEjer ] 2018;
             |HAZ BRepComplem;
         |FINSI;

         |HAZ Recalculo;
         |GRABA 020#1a;

         |LIBERA #1;
         |CIERRA #1;

         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #1;
         #1#0 = enEmpresa;
         #1#1 = enEjer;
         #1#2 = enPeriodo;
         #1#3 = enModelo;
         #1#4 = enComplem;
         #1#5 = enActividad;
         |LEE 040#1=;
         |SI FSalida ! 0;  enExistencia = 1;  |FINSI;
         |CIERRA #1;

         |SI enActividad = 0;  enResultado = 0;  |FINSI;
     |FINSI;
|FPRO;

|PROCESO Tipo88;  |TIPO 88;
     |HAZ Relaciones;
|FPRC;
