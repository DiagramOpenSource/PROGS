|FICHEROS;
     dsmoz022;

     dsmow149;
     dsmo7202;
     dsmow145,MANTE;

    :/basica/def/agifigen;
|FIN;

|VARIABLES;
     &enBoton1 = 0;
     &enBoton2 = 0;
     &enBoton3 = 0;

     aAlfa1      = "";
     nBoton1     = 0;
     nBoton2     = 0;
     nBoton3     = 0;
     nTecla      = 0;

     nEmpresa    = 0;
     nEstado     = 0;
     nSwError    = 0;
     nEmpAnt     = 0;
     nEjerAnt    = 0;
     nEjer       = 0;
     &enDesdeAlta = 0;
     &eaNomOrigen = "";
     &enSw999     = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROCESO Boton2;
     |PTEC 825;
|FPRC;

|PROCESO Boton3;
     |PTEC 826;
|FPRC;

|PROCESO Tipo0;  |TIPO 0;
     |C_M #dsmow145#Campo#,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |PULSATECLA;
|FPRC;

|CALCULO LeelaEmpresa;
  || Lee Empresa
    nSwError = 0;
    |ABRE #agifigen;
    #agifigen#0 = enEmpresa;
    |LEE 041#agifigen.=;
    |SI FSalida ! 0;
        |MENAV "     Empresa Inexistente";
        |CIERRA #agifigen;
        nSwError = 1;
    |SINO;
        #dsmow145#2 = #agifigen#1;
    |FINSI;
    |CIERRA #agifigen;
|FCAL;

|| ////////////////////////////////////
|PROCESO Borrolin721;
   |BORRA 020#dsmo7202.a;
   |LIBERA #dsmo7202;
|FPRC;

|DEFBUCLE borrarLineas721;
    #dsmo7202#1;
    ;
    #dsmow149#0, #dsmow149#1, #dsmow149#2, #dsmow149#3, #dsmow149#4, #dsmow149#5, 000;
    #dsmow149#0, #dsmow149#1, #dsmow149#2, #dsmow149#3, #dsmow149#4, #dsmow149#5, 999;
    be;
    NULL, Borrolin721;
|FIN;

|PROCESO BorraElemento;
   |BUCLE borrarLineas721;
   |BORRA 020#dsmow149.a;
   |LIBERA #dsmow149;
|FPRC;

|DEFBUCLE borrarElementos;
    #dsmow149#1;
    ;
    #dsmow145#0, #dsmow145#1, enPeriodo, enModelo, 00, 00;
    #dsmow145#0, #dsmow145#1, enPeriodo, enModelo, 99, 99;
    be;
    NULL, BorraElemento;
|FIN;
|| ////////////////////////////////////

|| **********************************************************************
|RUTINA ClaveBaja720;
     #dsmow149#0 = #dsmow145#0;
     #dsmow149#1 = #dsmow145#1;
     #dsmow149#2 = enPeriodo;
     #dsmow149#3 = enModelo;
     #dsmow149#4 = 00;
     #dsmow149#5 = 00;
|FRUT;

|RUTINA ClaveAlta720;
     #dsmow149#0 = #dsmow145#0;
     #dsmow149#1 = #dsmow145#1;
     #dsmow149#2 = enPeriodo;
     #dsmow149#3 = enModelo;
     #dsmow149#4 = 99;
     #dsmow149#5 = 99;
|FRUT;

|PROCESO Tipo7;  |TIPO 7;
     |C_M #dsmow145#Campo#,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |PINTA 0714, #dsmow145#0;
     |PINTA 0814, #dsmow145#1; |PINTA #dsmow145#2;
     eaNomOrigen = #dsmow145#2;

     |ENTLINEAL #1#dsmow149, -5, 7, 22, 0, ClaveBaja720, ClaveAlta720;

     |BLIN 04;

     |SI #dsmoz022#19 = 1;
         aAlfa1= "LBOTON,F2 Seleccionar Empresa ";
     |SINO;
         aAlfa1= "LBOTON,F2 Seleccionar Ejercicio ";
     |FINSI;
     |CONTROL_SIMPLE 0, aAlfa1, 1045, 1070, Boton1;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3 Entrada al Lineal", 1145, 1170, Boton2;
     nBoton2 = FSalida;

     |SI #dsmoz022#19 = 1;
         aAlfa1 = "LBOTON,F4 Baja Empresa-Modelo";
     |SINO;
         aAlfa1 = "LBOTON,F4 Baja Ejercicio-Modelo";
     |FINSI;
     |CONTROL_SIMPLE 0, aAlfa1, 1245, 1270, Boton3;
     nBoton3 = FSalida;
|FPRC;

|PROCESO VerPrimero;
    enDesdeAlta = 0;
    |ABRE #dsmow149;
    #dsmow149#0 = #dsmow145#0;
    #dsmow149#1 = #dsmow145#1;
    #dsmow149#2 = enPeriodo;
    #dsmow149#3 = enModelo;
    #dsmow149#4 = 00;
    #dsmow149#5 = 00;
    |LEE 041#dsmow149.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsmow149;
        #dsmow149#0 = #dsmow145#0;
        #dsmow149#1 = #dsmow145#1;
        #dsmow149#2 = enPeriodo;
        #dsmow149#3 = enModelo;
        #dsmow149#4 = 00;
        #dsmow149#5 = 00;
        |GRABA 020#dsmow149.n;
        enDesdeAlta = 1;
    |FINSI;
    |LIBERA #dsmow149;
    |CIERRA #dsmow149;
    |SI enDesdeAlta = 1;
        |PTEC 829;
    |FINSI;
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
     nTecla = FSalida;
     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |PULSATECLA;

     |SI nTecla =  11;
         enEmpresa = #dsmow145#0;
         |HAZ MiraBloqueo;
         |SI eaBloqueo = "3";
             |ACABA;
         |FINSI;

         enEjer      = #dsmow145#1;
         eaNomOrigen = #dsmow145#2;
         |HAZ VerPrimero;
         |ENTLINEAL #1#dsmow149, -5, 4, 22, 0, ClaveBaja720, ClaveAlta720;
     |FINSI;

     |SI nTecla = 12;
         |CONFI "    NEsta Seguro de Borrar todos los Modelos 720 de esta Empresa y Ejercicio ";
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         enEmpresa = #dsmow145#0;
         enEjer    = #dsmow145#1;
         |BUCLE borrarElementos;
         |BORRA 020#dsmow145.a;

         |PTEC 809;
         |PTEC 808;
         |PONCONTROL  23, "SI";
     |FINSI;

     |SI nTecla = 10; |Y Campo = 0;

         nEmpAnt = #dsmow145#0;

         FSalida = 10;
         eaElProm = "dsmow145";
         |HAZ ConsuCliente9;
         nEmpresa = #dsmow145#0;
         eaElProm = "";

         #dsmow145#0    = nEmpresa;
         #dsmow145#1    = #dsmoz022#0;
         enEmpresa = #dsmow145#0;
         |LEE 040#dsmow145.=;
         nEstado = FSalida;

         |HAZ LeelaEmpresa;
         |SI nSwError = 0;
             |SI nEstado ! 0;
                |PINTA 0714, #dsmow145#0;
                |PINTA 0814, #dsmow145#1; |PINTA #dsmow145#2;
                |CONFI "    SDesea dar de Alta el Modelo 720";
                |SI FSalida = 0;
                    |GRABA 020#dsmow145.n;
                |SINO;
                    #dsmow145#0 = nEmpAnt;
                    #dsmow145#1 = #dsmoz022#0;
                    |LEE 040#dsmow145.=;
                    nSwError = 1;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nSwError = 0;
             |PTEC 825;
         |FINSI;

         |PONCONTROL  23, "SI";
     |FINSI;

     |SI nTecla = 10; |Y Campo = 1;

        nEjerAnt = #dsmow145#1;
        |PUSHV 1013 1231;
        |CUADRO 1013 1231;
        |ATRI I;
        |PINTA 1114, " Ejercicio:      ";
        E_inf  = 2000;
        E_sup  = 2099;
        nEjer = enEjer;
        nEjer = 1126 ? 1;
        |POPV;

         #dsmow145#0 = #dsmoz022#1;
         #dsmow145#1 = nEjer;
         |LEE 040#dsmow145.=;
         nEstado = FSalida;

         |SI nEstado ! 0;
            |PINTA 0714, #dsmow145#0;
            |PINTA 0814, #dsmow145#1; |PINTA #dsmow145#2;
            |CONFI "    SDesea dar de Alta el Modelo 720";
            |SI FSalida = 0;
                |GRABA 020#dsmow145.n;
            |SINO;
                #dsmow145#0 = #dsmoz022#1;
                #dsmow145#1 = nEjerAnt;
                |LEE 040#dsmow145.=;
                nSwError = 1;
            |FINSI;
         |FINSI;

         |SI nSwError = 0;
             |PTEC 825;
         |FINSI;

         |PONCONTROL  23, "SI";
     |FINSI;
|FPRC;
