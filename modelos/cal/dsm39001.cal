|FICHEROS;
     dsm39001;
     dsm39002;
     dsm39003;
     dsm39004,MANTE;
     dsm39005;
     dsm39006;

     dsmom004;
     dsmom007;
     dsmom028;
     dsmom103;
     dsmom117;

     dsmod300;
     dsmod303;
     dsmod330;
     dsmod310;
     dsmod370;
     dsm30301;

     :/basica/def/agicen14;

     dsmow064;
     dsmow065;
     dsmow066;
     dsmow067;
     dsmow138;
     dsmow169;
|FIN;

|VARIABLES;
     nCampo     = 0;
     nCampo1    = 0;
     nCampo2    = 0;
     nCampo3    = 0;
     nSwChequea = 0;
     nBorra     = 0;
     nComp      = 0;
     nBoton1    = -1;
     nBoton2    = -1;
     nBoton3    = -1;
     nBoton4    = -1;
     nBoton5    = -1;
     nBoton6    = -1;
     nBoton7    = -1;
     nBoton8    = -1;
     nBoton9    = -1;
     nValor     = -1;
     nValor2    = -1;
     nTecla     = -1;
     nModo      = -1;
     nNume1     = 0;
     nCompensar = 0;
     nDesdeMes  = 0;
     nPresMod   = 0;
     nResta     = 0;
     nAnyo      = 0;
     nSwHay     = 0;
     nQuito     = 0;
     nGrupo     = 0;
     nSubGrupo  = 0;
     nOtro      = 0;
     nElUltim   = 0;
     nEjerCarga = 0;
     nRECC      = 0;
     nREDEME    = 0;
     nDesde     = 0;
     nHasta     = 0;
     nError     = 0;

     aTecla     = "";
     aAlfa      = "";
     aAlfa1     = "";
     aEsc1      = "";
     aEsc2      = "";
     aRetu      = "";
     aF2        = "";
     aF3        = "";
     aF4        = "";
     aF5        = "";
     aF6        = "";
     aF7        = "";
     aF8        = "";
     aF9        = "";
     aF10       = "";
     nMes       = 0;
  {10}aPopup    = "";

|FIN;

|INCLUYE i_variar;

|PROCESO PulsaF2;
     |PTEC 824;
|FPRC;

|PROCESO PulsaF3;
     |PTEC 825;
|FPRC;

|PROCESO PulsaF4;
     |PTEC 826;
|FPRC;

|PROCESO PulsaF5;
     |PTEC 827;
|FPRC;

|PROCESO PulsaF6;
     |PTEC 828;
|FPRC;

|PROCESO PulsaF7;
     |PTEC 829;
|FPRC;

|PROCESO PulsaF8;
     |PTEC 830;
|FPRC;

|PROCESO PulsaF9;
     |PTEC 831;
|FPRC;

|PROCESO PulsaF10;
     |PTEC 832;
|FPRC;

|PROCESO DesapareceBotones;
     |SI nBoton1 ! -1;  |ESTADO_CONTROL nBoton1, "HIDE";  |FINSI;
     |SI nBoton2 ! -1;  |ESTADO_CONTROL nBoton2, "HIDE";  |FINSI;
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "HIDE";  |FINSI;
     |SI nBoton4 ! -1;  |ESTADO_CONTROL nBoton4, "HIDE";  |FINSI;
     |SI nBoton5 ! -1;  |ESTADO_CONTROL nBoton5, "HIDE";  |FINSI;
     |SI nBoton6 ! -1;  |ESTADO_CONTROL nBoton6, "HIDE";  |FINSI;
     |SI nBoton7 ! -1;  |ESTADO_CONTROL nBoton7, "HIDE";  |FINSI;
     |SI nBoton8 ! -1;  |ESTADO_CONTROL nBoton8, "HIDE";  |FINSI;
     |SI nBoton9 ! -1;  |ESTADO_CONTROL nBoton9, "HIDE";  |FINSI;
|FPRC;

|PROCESO ApareceBotones;
     |SI nBoton1 ! -1;  |ESTADO_CONTROL nBoton1, "SHOW";  |FINSI;
     |SI nBoton2 ! -1;  |ESTADO_CONTROL nBoton2, "SHOW";  |FINSI;
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "SHOW";  |FINSI;
     |SI nBoton4 ! -1;  |ESTADO_CONTROL nBoton4, "SHOW";  |FINSI;
     |SI nBoton5 ! -1;  |ESTADO_CONTROL nBoton5, "SHOW";  |FINSI;
     |SI nBoton6 ! -1;  |ESTADO_CONTROL nBoton6, "SHOW";  |FINSI;
     |SI nBoton7 ! -1;  |ESTADO_CONTROL nBoton7, "SHOW";  |FINSI;
     |SI nBoton8 ! -1;  |ESTADO_CONTROL nBoton8, "SHOW";  |FINSI;
     |SI nBoton9 ! -1;  |ESTADO_CONTROL nBoton9, "SHOW";  |FINSI;
|FPRC;

|PROCESO QuitaBotones;
     |SI nBoton1 ! -1;  |FIN_CONTROL_WINDOWS nBoton1;  nBoton1 = -1;  |FINSI;
     |SI nBoton2 ! -1;  |FIN_CONTROL_WINDOWS nBoton2;  nBoton2 = -1;  |FINSI;
     |SI nBoton3 ! -1;  |FIN_CONTROL_WINDOWS nBoton3;  nBoton3 = -1;  |FINSI;
     |SI nBoton4 ! -1;  |FIN_CONTROL_WINDOWS nBoton4;  nBoton4 = -1;  |FINSI;
     |SI nBoton5 ! -1;  |FIN_CONTROL_WINDOWS nBoton5;  nBoton5 = -1;  |FINSI;
     |SI nBoton6 ! -1;  |FIN_CONTROL_WINDOWS nBoton6;  nBoton6 = -1;  |FINSI;
     |SI nBoton7 ! -1;  |FIN_CONTROL_WINDOWS nBoton7;  nBoton7 = -1;  |FINSI;
     |SI nBoton8 ! -1;  |FIN_CONTROL_WINDOWS nBoton8;  nBoton8 = -1;  |FINSI;
     |SI nBoton9 ! -1;  |FIN_CONTROL_WINDOWS nBoton9;  nBoton9 = -1;  |FINSI;

     |PULSATECLA;
|FPRC;

|RUTINA ClaveBaja2Gnral;
     #dsm39002#0  = #dsm39001#0;
     #dsm39002#1  = #dsm39001#1;
     #dsm39002#2  = #dsm39001#2;
     #dsm39002#3  = #dsm39001#3;
     #dsm39002#24 = 0;
     #dsm39002#25 = 0;
|FRUT;

|RUTINA ClaveAlta2Gnral;
     #dsm39002#0  = #dsm39001#0;
     #dsm39002#1  = #dsm39001#1;
     #dsm39002#2  = #dsm39001#2;
     #dsm39002#3  = #dsm39001#3;
     #dsm39002#24 = 2;
     #dsm39002#25 = 99;
|FRUT;

|PROCESO FuncionF2;
     |HAZ DesapareceBotones;

     |PUSHV 0401 2380;
     |ENTLINEAL #2#dsm39002, -6, 4, 22, 1, ClaveBaja2Gnral, ClaveAlta2Gnral;
     |SI #dsm39001#1 ] 2010;
         |HAZ Chequeo_AIS;
     |FINSI;
     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|RUTINA ClaveBaja3;
     #dsm39003#0 = #dsm39001#0;
     #dsm39003#1 = #dsm39001#1;
     #dsm39003#2 = #dsm39001#2;
     #dsm39003#3 = #dsm39001#3;
     #dsm39003#4 = 1;
|FRUT;

|RUTINA ClaveAlta3;
     #dsm39003#0 = #dsm39001#0;
     #dsm39003#1 = #dsm39001#1;
     #dsm39003#2 = #dsm39001#2;
     #dsm39003#3 = #dsm39001#3;
     #dsm39003#4 = 99;
|FRUT;

|PROCESO FuncionF3;
     |HAZ DesapareceBotones;

     |PUSHV 0401 2380;
     |PINPA #0#dsm39003;

     |C_V #dsm39003#29, 1, "S";  |C_M #dsm39003#29, 1, "S";
     |C_V #dsm39003#30, 1, "S";  |C_M #dsm39003#30, 1, "S";
     |C_V #dsm39003#31, 1, "S";  |C_M #dsm39003#31, 1, "S";
     |C_V #dsm39003#33, 1, "S";  |C_M #dsm39003#33, 1, "S";
     |C_V #dsm39003#32, 1, "S";  |C_M #dsm39003#32, 1, "S";
     |C_V #dsm39003#34, 1, "S";  |C_M #dsm39003#34, 1, "S";

     |SI #dsm39001#1 ! 2010;  |Y #dsm39001#1 ! 2012;
         |PINTA 2019, "                            ";
         |C_V #dsm39003#29, 1, "N";  |C_M #dsm39003#29, 1, "N";
     |FINSI;

     |SI #dsm39001#1 ! 2012;
         |PINTA 1919, "                            ";
         |C_V #dsm39003#30, 1, "N";  |C_M #dsm39003#30, 1, "N";

         |PINTA 2219, "                            ";
         |C_V #dsm39003#32, 1, "N";  |C_M #dsm39003#32, 1, "N";
         |C_V #dsm39003#34, 1, "N";  |C_M #dsm39003#34, 1, "N";
     |FINSI;

     aAlfa1 = #dsm39001#1;
     |ATRI I;
     |PINTA 2122, aAlfa1;
     |ATRI 0;

     |SI #dsm39001#1 < 2012;
         |PINTA 2119, "                            ";

         |C_V #dsm39003#31, 1, "N";  |C_M #dsm39003#31, 1, "N";
         |C_V #dsm39003#33, 1, "N";  |C_M #dsm39003#33, 1, "N";
     |FINSI;

     |ENTLINEAL #1#dsm39003, -5, nModo, 22, 0, ClaveBaja3, ClaveAlta3;
     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF4;
     |HAZ DesapareceBotones;

     |SI #dsm39001#1 = 2010; |O #dsm39001#1 = 2012;
         |ABRE #dsm39006;
         #dsm39006#0 = #dsm39001#0;
         #dsm39006#1 = #dsm39001#1;
         #dsm39006#2 = #dsm39001#2;
         #dsm39006#3 = #dsm39001#3;
         |LEE 101#dsm39006.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsm39006;
             #dsm39006#0 = #dsm39001#0;
             #dsm39006#1 = #dsm39001#1;
             #dsm39006#2 = #dsm39001#2;
             #dsm39006#3 = #dsm39001#3;
             nCampo1 = 15;
             |PARA nCampo = 29; |SI nCampo [ 53; |HACIENDO nCampo = nCampo + 1;
                   #dsm39006#nCampo# = #dsm39001#nCampo1#;
                   nCampo1 = nCampo1 + 1;
                   |SI nCampo1 = 20; nCampo1 = 21; |FINSI;
                   |SI nCampo1 = 26; nCampo1 = 27; |FINSI;
                   |SI nCampo1 = 32; nCampo1 = 33; |FINSI;
                   |SI nCampo1 = 38; nCampo1 = 39; |FINSI;
             |SIGUE;
             |GRABA 020#dsm39006.b;
         |FINSI;

     |FINSI;

     |PUSHV 0501 2380;

     |PARA nCampo1 = 14;  |SI nCampo1 [ 43;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2     = nCampo1 - 14;
           #dsmow064#nCampo2# = #dsm39001#nCampo1#;
     |SIGUE;

     |SI #dsm39001#1 = 2010; |O #dsm39001#1 = 2012;
         |PARA nCampo1 = 4;  |SI nCampo1 [ 53;  |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2     = nCampo1 + 26;
               #dsmow064#nCampo2# = #dsm39006#nCampo1#;
         |SIGUE;
     |FINSI;

     |PINPA #0#dsmow064;
     |PINDA #0#dsmow064;
     |SI nModo ! 4;
         |ENDATOS #1#dsmow064;
         |SI FSalida = 0;
             |PARA nCampo1 = 14;  |SI nCampo1 [ 43;  |HACIENDO nCampo1 = nCampo1 + 1;
                   nCampo2   = nCampo1 - 14;
                   #dsm39001#nCampo1# = #dsmow064#nCampo2#;
             |SIGUE;

             |SI #dsm39001#1 = 2010; |O #dsm39001#1 = 2012;
                 |PARA nCampo1 = 4;  |SI nCampo1 [ 53;  |HACIENDO nCampo1 = nCampo1 + 1;
                       nCampo2   = nCampo1 + 26;
                       #dsm39006#nCampo1# = #dsmow064#nCampo2#;
                 |SIGUE;
                 |GRABA 020#dsm39006.a;
             |FINSI;

         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;

     |SI #dsm39001#1 = 2010;  |O #dsm39001#1 = 2012;
         |LIBERA #dsm39006;
         |CIERRA #dsm39006;
     |FINSI;
     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF5;
     |HAZ DesapareceBotones;

     |PUSHV 0501 2380;

     |PARA nCampo1 = 44;  |SI nCampo1 [ 52;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2     = nCampo1 - 44;
           #dsmow065#nCampo2# = #dsm39001#nCampo1#;
     |SIGUE;

     #dsmow065#9 = #dsm39001#5;

     |PINPA #0#dsmow065;
     |PINDA #0#dsmow065;
     |SI nModo ! 4;
         |ENDATOS #1#dsmow065;
         |SI FSalida = 0;
             |PARA nCampo1 = 44;  |SI nCampo1 [ 52;  |HACIENDO nCampo1 = nCampo1 + 1;
                   nCampo2   = nCampo1 - 44;
                   #dsm39001#nCampo1# = #dsmow065#nCampo2#;
             |SIGUE;

             #dsm39001#5 = #dsmow065#9;
         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;

     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF6;
     |HAZ DesapareceBotones;

     |PUSHV 0501 2380;

     #dsm39001#53  = #dsm39001#4 + #dsm39001#5 + #dsm39001#109;
     #dsm39001#60  = #dsm39001#4 + #dsm39001#5 + #dsm39001#111;

     |SI #dsm39001#1 [ 2008;
         #dsmow066#0  = #dsm39001#53;
         #dsmow066#1  = #dsm39001#54;
         #dsmow066#2  = #dsm39001#6;
         #dsmow066#3  = #dsm39001#55;
         #dsmow066#4  = #dsm39001#56;
         #dsmow066#5  = #dsm39001#57;
         #dsmow066#6  = #dsm39001#58;
         #dsmow066#7  = #dsm39001#59;
         #dsmow066#8  = #dsm39001#60;
         #dsmow066#9  = #dsm39001#61;
         #dsmow066#10 = #dsm39001#62;
         #dsmow066#11 = #dsm39001#7;
         #dsmow066#12 = #dsm39001#8;
         #dsmow066#13 = #dsm39001#9;
         #dsmow066#14 = #dsm39001#10;
         #dsmow066#15 = #dsm39001#11;

         |PINPA #0#dsmow066;
         |PINDA #0#dsmow066;
         |SI nModo ! 4;
             |ENDATOS #1#dsmow066;
             |SI FSalida = 0;
                 #dsm39001#53 = #dsmow066#0;
                 #dsm39001#54 = #dsmow066#1;
                 #dsm39001#55 = #dsmow066#3;
                 #dsm39001#56 = #dsmow066#4;
                 #dsm39001#57 = #dsmow066#5;
                 #dsm39001#58 = #dsmow066#6;
                 #dsm39001#59 = #dsmow066#7;
                 #dsm39001#60 = #dsmow066#8;
                 #dsm39001#61 = #dsmow066#9;
                 #dsm39001#62 = #dsmow066#10;
                 #dsm39001#8  = #dsmow066#12;
                 #dsm39001#9  = #dsmow066#13;
                 #dsm39001#10 = #dsmow066#14;
                 #dsm39001#11 = #dsmow066#15;
             |FINSI;
         |SINO;
             |LEETECLA aAlfa;
         |FINSI;
     |FINSI;

     |SI #dsm39001#1 ] 2009;

         |C_V #dsmow138#23,1,"S";
         |SI #dsm39001#1 < 2018; |C_V #dsmow138#23,1,"N"; |FINSI;

         #dsmow138#19 = #dsm39001#109;
         #dsmow138#0  = #dsm39001#53;
         #dsmow138#20 = #dsm39001#110;
         #dsmow138#1  = #dsm39001#54;
         #dsmow138#2  = #dsm39001#6;
         #dsmow138#3  = #dsm39001#55;
         #dsmow138#4  = #dsm39001#56;
         #dsmow138#5  = #dsm39001#57;
         #dsmow138#6  = #dsm39001#58;
         #dsmow138#7  = #dsm39001#59;

         #dsmow138#21 = #dsm39001#111;
         #dsmow138#8  = #dsm39001#60;
         #dsmow138#9  = #dsm39001#61;
         #dsmow138#22 = #dsm39001#112;
         #dsmow138#10 = #dsm39001#62;
         #dsmow138#11 = #dsm39001#7;
         #dsmow138#12 = #dsm39001#8;
         #dsmow138#13 = #dsm39001#9;
         #dsmow138#14 = #dsm39001#10;
         #dsmow138#15 = #dsm39001#11;
         #dsmow138#16 = #dsm39001#100;
         #dsmow138#17 = #dsm39001#101;
         #dsmow138#18 = #dsm39001#102;
         #dsmow138#23 = #dsm39001#114;
         |HAZ Total138;

         |PINPA #0#dsmow138;

         |SI #dsm39001#1 < 2018;
             |PINTA 2202, "                           ";
         |FINSI;

         |PINDA #0#dsmow138;
         |SI nModo ! 4;
             |ENDATOS #1#dsmow138;
             |SI FSalida = 0;
                 #dsm39001#109 = #dsmow138#19;
                 #dsm39001#53  = #dsmow138#0;
                 #dsm39001#110 = #dsmow138#20;
                 #dsm39001#54  = #dsmow138#1;
                 #dsm39001#55  = #dsmow138#3;
                 #dsm39001#56  = #dsmow138#4;
                 #dsm39001#57  = #dsmow138#5;
                 #dsm39001#58  = #dsmow138#6;
                 #dsm39001#59  = #dsmow138#7;
                 #dsm39001#111 = #dsmow138#21;
                 #dsm39001#60  = #dsmow138#8;
                 #dsm39001#61  = #dsmow138#9;
                 #dsm39001#112 = #dsmow138#22;
                 #dsm39001#62  = #dsmow138#10;
                 #dsm39001#8   = #dsmow138#12;
                 #dsm39001#9   = #dsmow138#13;
                 #dsm39001#10  = #dsmow138#14;
                 #dsm39001#11  = #dsmow138#15;
                 #dsm39001#100 = #dsmow138#16;
                 #dsm39001#101 = #dsmow138#17;
                 #dsm39001#102 = #dsmow138#18;
                 #dsm39001#114 = #dsmow138#23;
             |FINSI;
         |SINO;
             |LEETECLA aAlfa;
         |FINSI;
     |FINSI;

     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF3aF5;
     |HAZ DesapareceBotones;

     |PUSHV 0501 2380;

     |ABRE #dsm39005;
     #dsm39005#0 = #dsm39001#0;
     #dsm39005#1 = #dsm39001#1;
     #dsm39005#2 = #dsm39001#2;
     #dsm39005#3 = #dsm39001#3;
     #dsm39005#4 = nGrupo;
     |LEE 101#dsm39005.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm39005;
         #dsm39005#0 = #dsm39001#0;
         #dsm39005#1 = #dsm39001#1;
         #dsm39005#2 = #dsm39001#2;
         #dsm39005#3 = #dsm39001#3;
         #dsm39005#4 = nGrupo;
         |GRABA 020#dsm39005.b;
     |FINSI;

     |PINPA #0#dsm39005;
     |PINDA #0#dsm39005;
     |SI nModo ! 4;
         |ENDATOS #1#dsm39005;
         |SI FSalida = 0;
             |GRABA 020#dsm39005.a;
         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;
     |LIBERA #dsm39005;
     |CIERRA #dsm39005;

     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|RUTINA ClaveBaja2Oper;
     #dsm39002#0  = #dsm39001#0;
     #dsm39002#1  = #dsm39001#1;
     #dsm39002#2  = #dsm39001#2;
     #dsm39002#3  = #dsm39001#3;
     #dsm39002#24 = 3;
     #dsm39002#25 = 0;
|FRUT;

|RUTINA ClaveAlta2Oper;
     #dsm39002#0  = #dsm39001#0;
     #dsm39002#1  = #dsm39001#1;
     #dsm39002#2  = #dsm39001#2;
     #dsm39002#3  = #dsm39001#3;
     #dsm39002#24 = 4;
     #dsm39002#25 = 99;
|FRUT;

|PROCESO FuncionF7;
     |HAZ DesapareceBotones;

     |PUSHV 0401 2380;
     |ENTLINEAL #2#dsm39002, -6, 4, 22, 1, ClaveBaja2Oper, ClaveAlta2Oper;
     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF8_2018;
     |PARA nCampo1 = 63;  |SI nCampo1 [ 90;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 - 63;

           #dsmow169#nCampo2# = #dsm39001#nCampo1#;
     |SIGUE;

     #dsmow169#28  = #dsm39001#92;
     #dsmow169#29  = #dsm39001#93;
     #dsmow169#30  = #dsm39001#94;
     #dsmow169#31  = #dsm39001#95;
     #dsmow169#32  = #dsm39001#96;
     #dsmow169#33  = #dsm39001#97;
     #dsmow169#34  = #dsm39001#98;
     #dsmow169#35  = #dsm39001#99;
     #dsmow169#36  = #dsm39001#103;
     #dsmow169#37  = #dsm39001#104;
     #dsmow169#38  = #dsm39001#105;
     #dsmow169#39  = #dsm39001#106;
     #dsmow169#40  = #dsm39001#107;
     #dsmow169#41  = #dsm39001#108;
     #dsmow169#42  = #dsm39001#113;

     |C_M #dsmow169#41, 1, "N";
     |SI #dsm39001#3 ! 0;
         |C_M #dsmow169#41, 1, "S";
     |FINSI;

     |PINPA #0#dsmow169;
     |PINDA #0#dsmow169;
     |SI nModo ! 4;
         |ENDATOS #1#dsmow169;
         |SI FSalida = 0;
             |PARA nCampo1 = 63;  |SI nCampo1 [ 90;  |HACIENDO nCampo1 = nCampo1 + 1;
                   nCampo2 = nCampo1 - 63;

                   #dsm39001#nCampo1# = #dsmow169#nCampo2#;
             |SIGUE;

             #dsm39001#92  = #dsmow169#28;
             #dsm39001#93  = #dsmow169#29;
             #dsm39001#94  = #dsmow169#30;
             #dsm39001#95  = #dsmow169#31;
             #dsm39001#96  = #dsmow169#32;
             #dsm39001#97  = #dsmow169#33;
             #dsm39001#98  = #dsmow169#34;
             #dsm39001#99  = #dsmow169#35;
             #dsm39001#103 = #dsmow169#36;
             #dsm39001#104 = #dsmow169#37;
             #dsm39001#105 = #dsmow169#38;
             #dsm39001#106 = #dsmow169#39;
             #dsm39001#107 = #dsmow169#40;
             #dsm39001#108 = #dsmow169#41;
             #dsm39001#113 = #dsmow169#42;
         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;
|FPRC;

|PROCESO FuncionF8_2017;

     |PARA nCampo1 = 63;  |SI nCampo1 [ 90;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 - 63;

           #dsmow067#nCampo2# = #dsm39001#nCampo1#;
     |SIGUE;

     #dsmow067#28  = #dsm39001#92;
     #dsmow067#29  = #dsm39001#93;
     #dsmow067#30  = #dsm39001#94;
     #dsmow067#31  = #dsm39001#95;
     #dsmow067#32  = #dsm39001#96;
     #dsmow067#33  = #dsm39001#97;
     #dsmow067#34  = #dsm39001#98;
     #dsmow067#35  = #dsm39001#99;
     #dsmow067#36  = #dsm39001#103;
     #dsmow067#37  = #dsm39001#104;
     #dsmow067#38  = #dsm39001#105;
     #dsmow067#39  = #dsm39001#106;
     #dsmow067#40  = #dsm39001#107;
     #dsmow067#41  = #dsm39001#108;
     #dsmow067#42  = #dsm39001#113;

     |C_M #dsmow067#41, 1, "N";
     |SI #dsm39001#3 ! 0;
         |C_M #dsmow067#41, 1, "S";
     |FINSI;

     |C_V #dsmow067#29, 1, "S";
     |C_M #dsmow067#29, 1, "S";
     |C_V #dsmow067#42, 1, "S";
     |C_M #dsmow067#42, 1, "S";

     |SI #dsm39001#1 [ 2015;
         |C_V #dsmow067#42, 1, "N";
         |C_M #dsmow067#42, 1, "N";
     |FINSI;

     |SI #dsm39001#1 ] 2016;
         |C_V #dsmow067#29, 1, "N";
         |C_M #dsmow067#29, 1, "N";
     |FINSI;

     |PINPA #0#dsmow067;
     |PINDA #0#dsmow067;
     |SI nModo ! 4;
         |ENDATOS #1#dsmow067;
         |SI FSalida = 0;
             |PARA nCampo1 = 63;  |SI nCampo1 [ 90;  |HACIENDO nCampo1 = nCampo1 + 1;
                   nCampo2 = nCampo1 - 63;

                   #dsm39001#nCampo1# = #dsmow067#nCampo2#;
             |SIGUE;

             #dsm39001#92  = #dsmow067#28;
             #dsm39001#93  = #dsmow067#29;
             #dsm39001#94  = #dsmow067#30;
             #dsm39001#95  = #dsmow067#31;
             #dsm39001#96  = #dsmow067#32;
             #dsm39001#97  = #dsmow067#33;
             #dsm39001#98  = #dsmow067#34;
             #dsm39001#99  = #dsmow067#35;
             #dsm39001#103 = #dsmow067#36;
             #dsm39001#104 = #dsmow067#37;
             #dsm39001#105 = #dsmow067#38;
             #dsm39001#106 = #dsmow067#39;
             #dsm39001#107 = #dsmow067#40;
             #dsm39001#108 = #dsmow067#41;
             #dsm39001#113 = #dsmow067#42;
         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;
|FPRC;

|PROCESO FuncionF8;
     |HAZ DesapareceBotones;

     |PUSHV 0501 2380;

     |SI #dsm39001#1 < 2018;
         |HAZ FuncionF8_2017;
     |FINSI;

     |SI #dsm39001#1 ] 2018;
         |HAZ FuncionF8_2018;
     |FINSI;

     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|RUTINA ClaveBaja4;
     #dsm39004#0 = #dsm39001#0;
     #dsm39004#1 = #dsm39001#1;
     #dsm39004#2 = #dsm39001#2;
     #dsm39004#3 = #dsm39001#3;
     #dsm39004#4 = 1;
|FRUT;

|RUTINA ClaveAlta4;
     #dsm39004#0 = #dsm39001#0;
     #dsm39004#1 = #dsm39001#1;
     #dsm39004#2 = #dsm39001#2;
     #dsm39004#3 = #dsm39001#3;
     #dsm39004#4 = 99;
|FRUT;

|PROCESO NoB_Cnae;
      |SI FSalida = 2; |ACABA; |FINSI;
      |SI  #dsm39004#6 = "    "; |Y #dsm39004#10 ! 100; |Y #dsm39004#10 ! 0;
           |MENAV "    Error. Informe CNAE de la Actividad";
           |PTEC 808; |PTEC 808;
           |PTEC 808; |PTEC 808;
           |ERROR;
      |FINSI;
|FPRC;

|PROCESO FuncionF9;
     |HAZ DesapareceBotones;

     |PUSHV 0401 2380;
     |ENTLINEAL #1#dsm39004, -5, nModo, 22, 1, ClaveBaja4, ClaveAlta4;
     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF10;
     aPopup1  = -1;
     aPopup2  = 3;
     aPopup3  = "Grupo 1";
     aPopup4  = "Grupo 2";
     aPopup5  = "Grupo 3";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % -101;
         |SI aAlfa = "1";  nGrupo = 1;  |HAZ FuncionF3aF5;  |FINSI;
         |SI aAlfa = "2";  nGrupo = 2;  |HAZ FuncionF3aF5;  |FINSI;
         |SI aAlfa = "3";  nGrupo = 3;  |HAZ FuncionF3aF5;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonGeneral;  |TIPO 7;
     |CONTROL_SIMPLE 0, "BOTON,F2 Reg.General", 0826, 0840, PulsaF2;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F3 Grupo 1", 0842, 0852, PulsaF3;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F4 Grupo 2", 0854, 0864, PulsaF4;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F5 Grupo 3", 0866, 0876, PulsaF5;
     nBoton5 = FSalida;
|FPRC;

|PROCESO SacaGeneral;
     nTecla = FSalida;

     |SI nTecla = 10;
         |HAZ FuncionF2;
         |ERROR;
     |FINSI;

     |SI nTecla = 11;
         nGrupo = 1;
         |HAZ FuncionF3aF5;
         |ERROR;
     |FINSI;

     |SI nTecla = 12;
         nGrupo = 2;
         |HAZ FuncionF3aF5;
         |ERROR;
     |FINSI;

     |SI nTecla = 13;
         nGrupo = 3;
         |HAZ FuncionF3aF5;
         |ERROR;
     |FINSI;

     |SI nTecla = 16;
         |HAZ FuncionF8;
         |ERROR;
     |FINSI;

     |SI nTecla = 17;
         |HAZ FuncionF9;
         |ERROR;
     |FINSI;

     |SI nTecla ! 10;  |Y  nTecla ! 11;  |Y  nTecla ! 12;  |Y  nTecla ! 13;
      |Y nTecla ! 16;  |Y  nTecla ! 17;
         |SI nBoton2 ! -1;  |FIN_CONTROL_WINDOWS nBoton2;  nBoton2 = -1;  |FINSI;
         |SI nBoton3 ! -1;  |FIN_CONTROL_WINDOWS nBoton3;  nBoton3 = -1;  |FINSI;
         |SI nBoton4 ! -1;  |FIN_CONTROL_WINDOWS nBoton4;  nBoton4 = -1;  |FINSI;
         |SI nBoton5 ! -1;  |FIN_CONTROL_WINDOWS nBoton5;  nBoton5 = -1;  |FINSI;
         |PULSATECLA;

         FSalida = 0;
     |FINSI;

     nValor2 = 0;

     |ABRE #dsm39002;
     |SELECT #1#dsm39002;
     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 1;
     #dsm39002#5 = 13;
     |LEE 040#dsm39002.=;
     |SI FSalida ! 0;  |DDEFECTO #dsm39002;  |FINSI;
     nValor = #dsm39002#11;

     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 2;
     |SI #dsm39001#1 [ 2007;  #dsm39002#5 = 12;  |FINSI;
     |SI #dsm39001#1 ] 2008;  #dsm39002#5 = 13;  |FINSI;
     |SI #dsm39001#1 ] 2010;  #dsm39002#5 = 14;  |FINSI;
     |SI #dsm39001#1 ] 2014;  #dsm39002#5 = 12;  |FINSI;
     |LEE 040#dsm39002.=;
     |SI FSalida = 0;
         nValor2 = #dsm39002#11;
     |FINSI;

     nValor = nValor - nValor2;
     |CIERRA #dsm39002;

     #dsm39001#4 = nValor;

     |SI enTipoEntrada ! 95;  |PINTA #dsm39001#4;  |FINSI;
|FPRC;

|PROCESO BotonSimplificado;  |TIPO 7;
     |CONTROL_SIMPLE 0, "BOTON,F3 Modulos", 0826, 0836, PulsaF3;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F4 Ganaderia", 0838, 0851, PulsaF4;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F5 IVA Devengado y Deducible", 0853, 0877, PulsaF5;
     nBoton5 = FSalida;
|FPRC;

|PROCESO Calcula03;
     #dsm39001#44 = #dsm39001#44 + #dsm39003#27;
|FPRC;

|DEFBUCLE dsm39003;
     #dsm39003#1;
     ;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 00;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 99;
     ;
     NULL, Calcula03;
|FIN;

|PROCESO SacaSimplificado;
     nTecla = FSalida;

     |SI nTecla = 11;
         |HAZ FuncionF3;
     |FINSI;

     |SI nTecla = 12;
         |HAZ FuncionF4;
     |FINSI;

     |SI nTecla = 13;
         |HAZ FuncionF5;
     |FINSI;

     |SI nTecla = 16;
         |HAZ FuncionF8;
     |FINSI;

     |SI nTecla = 17;
         |HAZ FuncionF9;
     |FINSI;

     #dsm39001#44 = 0;
     |BUCLE dsm39003;

     #dsm39001#45 = #dsm39001#19 + #dsm39001#25 + #dsm39001#31 + #dsm39001#37 + #dsm39001#43;
     #dsm39001#49 = #dsm39001#44 + #dsm39001#45 + #dsm39001#46 + #dsm39001#47 + #dsm39001#48;
     #dsm39001#52 = #dsm39001#50 + #dsm39001#51;
     #dsm39001#5  = #dsm39001#49 - #dsm39001#52;

     |SI enTipoEntrada ! 95;
         |PINTA #dsm39001#5;

         nQuito = 1;
         |SI nTecla = 11;  |O nTecla = 12;  |O nTecla = 13;
          |O nTecla = 16;  |O nTecla = 17;
             nQuito = 0;
         |FINSI;

         |SI nQuito = 1;
             |FIN_CONTROL_WINDOWS nBoton3;  nBoton3 = -1;
             |FIN_CONTROL_WINDOWS nBoton4;  nBoton4 = -1;
             |FIN_CONTROL_WINDOWS nBoton5;  nBoton5 = -1;
             |PULSATECLA;
         |SINO;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonResultados;  |TIPO 7;
     |CONTROL_SIMPLE 0, "BOTON,F6 Resultados", 0826, 0840, PulsaF6;
     nBoton6 = FSalida;
|FPRC;

|PROCESO RecogeAnterior;
     nCompensar = nCompensar + #dsmom103#5;
     nSwHay     = 1;
|FPRC;

|DEFBUCLE dsmom103;
     #dsmom103#1;
     ;
     000, #dsm39001#0, 00, nAnyo, 12;
     999, #dsm39001#0, 99, nAnyo, 12;
     ;
     NULL, RecogeAnterior;
|FIN;

|PROCESO RecogePrescrito;
     |SI #dsmom028#7 = "S";
         nResta = nResta + #dsmom028#6;
     |FINSI;
|FPRC;

|DEFBUCLE LeePrescritoB;
     #dsmom028#1;
     ;
     #dsm39001#0, #dsm39001#1, nDesdeMes, nPresMod, 00, 00;
     #dsm39001#0, #dsm39001#1, 12,        nPresMod, 00, 00;
     ;
     NULL, RecogePrescrito;
|FIN;

|PROCESO LeePrescrito;
     nResta = 0;

     nPresMod = 303;
     |BUCLE LeePrescritoB;

     nPresMod = 300;
     |BUCLE LeePrescritoB;

     nPresMod = 330;
     |BUCLE LeePrescritoB;

     nPresMod = 370;
     |BUCLE LeePrescritoB;

     nPresMod = 310;
     |BUCLE LeePrescritoB;

     |SI nResta ! 0;
         nCompensar = nCompensar - nResta;
         |SI nCompensar < 0; nCompensar = 0; |FINSI;
    |FINSI;
|FPRC;

|PROCESO LeeComp310;
    nElUltim = #dsmod310#38;
    nSwHay   = 1;
|FPRC;

|DEFBUCLE LeeComp310;
 #dsmod310#1;
 ;
 #dsm39001#0, nOtro, 12, 310, 00, 0;
 #dsm39001#0, nOtro, 12, 310, 99, 0;
 e;
 NULL, LeeComp310;
|FIN;

|PROCESO LeeComp370;
    nElUltim = #dsmod370#84;
    nSwHay   = 1;
|FPRC;

|DEFBUCLE LeeComp370;
 #dsmod370#1;
 ;
 #dsm39001#0, nOtro, 12, 370, 00, 0;
 #dsm39001#0, nOtro, 12, 370, 99, 0;
 e;
 NULL, LeeComp370;
|FIN;

|PROCESO LeeComp330;
    nElUltim = #dsmod330#67;
    nSwHay   = 1;
|FPRC;

|DEFBUCLE LeeComp330;
 #dsmod330#1;
 ;
 #dsm39001#0, nOtro, 12, 330, 00, 0;
 #dsm39001#0, nOtro, 12, 330, 99, 0;
 e;
 NULL, LeeComp330;
|FIN;

|PROCESO LeeComp300;
    nElUltim = #dsmod300#63;
    nSwHay   = 1;
|FPRC;

|DEFBUCLE LeeComp300;
 #dsmod300#1;
 ;
 #dsm39001#0, nOtro, 12, 300, 00, 0;
 #dsm39001#0, nOtro, 12, 300, 99, 0;
 e;
 NULL, LeeComp300;
|FIN;

|PROCESO LeeComp303;
    nElUltim = #dsmod303#61;
    nSwHay   = 1;
|FPRC;

|DEFBUCLE LeeComp303;
 #dsmod303#1;
 ;
 #dsm39001#0, nOtro, 12, 303, 00, 0;
 #dsm39001#0, nOtro, 12, 303, 99, 0;
 e;
 NULL, LeeComp303;
|FIN;

|PROCESO LeeCompDSM30301;
    nElUltim = #dsm30301#89;
    nSwHay   = 1;
|FPRC;

|DEFBUCLE LeeCompDSM30301;
 #dsm30301#1;
 ;
 #dsm39001#0, nOtro, 12, 303, 00, 0;
 #dsm39001#0, nOtro, 12, 303, 99, 0;
 e;
 NULL, LeeCompDSM30301;
|FIN;

|PROCESO Compensacion;
     nCompensar = 0;
     nSwHay     = 0;

     nOtro    = #dsm39001#1 - 1;

     |SI nOtro < 2009;
         nElUltim = 0;
         |BUCLE LeeComp300;
         nCompensar = nCompensar + nElUltim;

         nElUltim = 0;
         |BUCLE LeeComp330;
         nCompensar = nCompensar + nElUltim;
     |SINO;
         nElUltim = 0;
         |BUCLE LeeComp303;
         nCompensar = nCompensar + nElUltim;
     |FINSI;

     nElUltim = 0;
     |BUCLE LeeComp370;
     nCompensar = nCompensar + nElUltim;

     nElUltim = 0;
     |BUCLE LeeComp310;
     nCompensar = nCompensar + nElUltim;

     nElUltim = 0;
     |BUCLE LeeCompDSM30301;
     nCompensar = nCompensar + nElUltim;

     |SI nCompensar = 0;
         nAnyo = #dsm39001#1 - 1;
         |BUCLE dsmom103;
     |FINSI;

     |SI nSwHay = 1;
         nDesdeMes = 1;
         |HAZ LeePrescrito;
     |FINSI;

     |SI nCompensar ! 0;  |ACABA;  |FINSI;
     |SI nSwHay     = 1;  |ACABA;  |FINSI;

     |ABRE #dsmod300;
     #dsmod300#0 = #dsm39001#0;
     #dsmod300#1 = #dsm39001#1;
     #dsmod300#2 = 3;
     #dsmod300#3 = 300;
     #dsmod300#4 = 0;
     #dsmod300#5 = 0;
     |LEE 040#dsmod300.=;
     |SI FSalida = 0;
         nCompensar = nCompensar + #dsmod300#59;
     |FINSI;
     |CIERRA #dsmod300;

     |ABRE #dsmod330;
     #dsmod330#0 = #dsm39001#0;
     #dsmod330#1 = #dsm39001#1;
     #dsmod330#2 = 1;
     #dsmod330#3 = 330;
     #dsmod330#4 = 0;
     #dsmod330#5 = 0;
     |LEE 040#dsmod330.=;
     |SI FSalida = 0;
         nCompensar = nCompensar + #dsmod330#59;
     |FINSI;
     |CIERRA #dsmod330;

     |ABRE #dsmod370;
     #dsmod370#0 = #dsm39001#0;
     #dsmod370#1 = #dsm39001#1;
     #dsmod370#2 = 3;
     #dsmod370#3 = 370;
     #dsmod370#4 = 0;
     #dsmod370#5 = 0;
     |LEE 040#dsmod370.=;
     |SI FSalida = 0;
         nCompensar = nCompensar + #dsmod370#81;
     |FINSI;
     |CIERRA #dsmod370;

     |ABRE #dsmod310;
     #dsmod310#0 = #dsm39001#0;
     #dsmod310#1 = #dsm39001#1;
     #dsmod310#2 = 3;
     #dsmod310#3 = 310;
     #dsmod310#4 = 0;
     #dsmod310#5 = 0;
     |LEE 040#dsmod310.=;
     |SI FSalida = 0;
         nCompensar = nCompensar + #dsmod310#35;
     |FINSI;
     |CIERRA #dsmod310;

     |ABRE #dsmod303;
     |PARA nMes = 1; |SI nMes [ 3; |HACIENDO nMes = nMes + 1;
           #dsmod303#0 = #dsm39001#0;
           #dsmod303#1 = #dsm39001#1;
           #dsmod303#2 = nMes;
           #dsmod303#3 = 303;
           #dsmod303#4 = 0;
           #dsmod303#5 = 0;
           |LEE 040#dsmod303.=;
           |SI FSalida = 0;
               nCompensar = nCompensar + #dsmod303#53;
               |SAL;
          |FINSI;
     |SIGUE;
     |CIERRA #dsmod303;

     |ABRE #dsm30301;
     |PARA nMes = 1; |SI nMes [ 3; |HACIENDO nMes = nMes + 1;
           #dsm30301#0 = #dsm39001#0;
           #dsm30301#1 = #dsm39001#1;
           #dsm30301#2 = nMes;
           #dsm30301#3 = 303;
           #dsm30301#4 = 0;
           #dsm30301#5 = 0;
           |LEE 040#dsm30301.=;
           |SI FSalida = 0;
               nCompensar = nCompensar + #dsm30301#84;
               |SAL;
          |FINSI;
     |SIGUE;
     |CIERRA #dsm30301;

     nDesdeMes = 4;
     |HAZ LeePrescrito;
|FPRC;

|PROCESO SacaResultados;
     nTecla = FSalida;

     |SI #dsm39001#54 = 0;  |Y #dsm39001#62 = 0;
         |HAZ Compensacion;
         #dsm39001#54 = nCompensar;
         #dsm39001#62 = nCompensar;
     |FINSI;

     |SI nTecla = 14;
         |HAZ FuncionF6;
         |ERROR;
     |FINSI;

     |SI nTecla = 16;
         |HAZ FuncionF8;
         |ERROR;
     |FINSI;

     |SI nTecla = 17;
         |HAZ FuncionF9;
         |ERROR;
     |FINSI;

     |SI nTecla ! 14;   |Y nTecla ! 16;  |Y nTecla ! 17;
         |FIN_CONTROL_WINDOWS nBoton6;  nBoton6 = -1;
     |FINSI;

     |PULSATECLA;

     |SI enTipoEntrada = 95;
         #dsm39001#53  = #dsm39001#4 + #dsm39001#5 + #dsm39001#109;
         #dsm39001#60  = #dsm39001#4 + #dsm39001#5 + #dsm39001#111;

         |SI #dsm39001#1 [ 2008;
             #dsmow066#0  = #dsm39001#53;
             #dsmow066#1  = #dsm39001#54;
             #dsmow066#2  = #dsm39001#6;
             #dsmow066#3  = #dsm39001#55;
             #dsmow066#4  = #dsm39001#56;
             #dsmow066#5  = #dsm39001#57;
             #dsmow066#6  = #dsm39001#58;
             #dsmow066#7  = #dsm39001#59;
             #dsmow066#8  = #dsm39001#60;
             #dsmow066#9  = #dsm39001#61;
             #dsmow066#10 = #dsm39001#62;
             #dsmow066#11 = #dsm39001#7;
             #dsmow066#12 = #dsm39001#8;
             #dsmow066#13 = #dsm39001#9;
             #dsmow066#14 = #dsm39001#10;
             #dsmow066#15 = #dsm39001#11;

             |HAZ Total66;

             #dsm39001#53 = #dsmow066#0;
             #dsm39001#54 = #dsmow066#1;
             #dsm39001#55 = #dsmow066#3;
             #dsm39001#56 = #dsmow066#4;
             #dsm39001#57 = #dsmow066#5;
             #dsm39001#58 = #dsmow066#6;
             #dsm39001#59 = #dsmow066#7;
             #dsm39001#60 = #dsmow066#8;
             #dsm39001#61 = #dsmow066#9;
             #dsm39001#62 = #dsmow066#10;
             #dsm39001#8  = #dsmow066#12;
             #dsm39001#9  = #dsmow066#13;
             #dsm39001#10 = #dsmow066#14;
             #dsm39001#11 = #dsmow066#15;
         |FINSI;

         |SI #dsm39001#1 ] 2009;
             #dsmow138#0  = #dsm39001#53;
             #dsmow138#1  = #dsm39001#54;
             #dsmow138#2  = #dsm39001#6;
             #dsmow138#3  = #dsm39001#55;
             #dsmow138#4  = #dsm39001#56;
             #dsmow138#5  = #dsm39001#57;
             #dsmow138#6  = #dsm39001#58;
             #dsmow138#7  = #dsm39001#59;
             #dsmow138#8  = #dsm39001#60;
             #dsmow138#9  = #dsm39001#61;
             #dsmow138#10 = #dsm39001#62;
             #dsmow138#11 = #dsm39001#7;
             #dsmow138#12 = #dsm39001#8;
             #dsmow138#13 = #dsm39001#9;
             #dsmow138#14 = #dsm39001#10;
             #dsmow138#15 = #dsm39001#11;
             #dsmow138#16 = #dsm39001#100;
             #dsmow138#17 = #dsm39001#101;
             #dsmow138#18 = #dsm39001#102;
             #dsmow138#19 = #dsm39001#109;
             #dsmow138#20 = #dsm39001#110;
             #dsmow138#21 = #dsm39001#111;
             #dsmow138#22 = #dsm39001#112;
             #dsmow138#23 = #dsm39001#114;

             |HAZ Total138;

             #dsm39001#53  = #dsmow138#0;
             #dsm39001#54  = #dsmow138#1;
             #dsm39001#55  = #dsmow138#3;
             #dsm39001#56  = #dsmow138#4;
             #dsm39001#57  = #dsmow138#5;
             #dsm39001#58  = #dsmow138#6;
             #dsm39001#59  = #dsmow138#7;
             #dsm39001#60  = #dsmow138#8;
             #dsm39001#61  = #dsmow138#9;
             #dsm39001#62  = #dsmow138#10;
             #dsm39001#8   = #dsmow138#12;
             #dsm39001#9   = #dsmow138#13;
             #dsm39001#10  = #dsmow138#14;
             #dsm39001#11  = #dsmow138#15;
             #dsm39001#100 = #dsmow138#16;
             #dsm39001#101 = #dsmow138#17;
             #dsm39001#102 = #dsmow138#18;
             #dsm39001#109 = #dsmow138#19;
             #dsm39001#110 = #dsmow138#20;
             #dsm39001#111 = #dsmow138#21;
             #dsm39001#112 = #dsmow138#22;
             #dsm39001#114 = #dsmow138#23;
         |FINSI;
     |FINSI;

     |SI #dsm39001#55 ! 0;
         #dsm39001#60  = #dsm39001#4 + #dsm39001#5 + #dsm39001#111;
         |SI #dsm39001#1 [ 2002;
             |SI #dsm39001#62 ! 0.01;
                 #dsm39001#7   = #dsm39001#61 + #dsm39001#112 - #dsm39001#62;
             |SINO;
                 #dsm39001#7   = #dsm39001#61 + #dsm39001#112;
             |FINSI;
         |SINO;
             #dsm39001#7   = #dsm39001#61 + #dsm39001#112 - #dsm39001#62;
         |FINSI;

         #dsm39001#53  = 0;
         #dsm39001#54  = 0;
         #dsm39001#6   = 0;
     |SINO;
         #dsm39001#53  = #dsm39001#4 + #dsm39001#5 + #dsm39001#109;
         |SI #dsm39001#1 [ 2002;
             |SI #dsm39001#54 ! 0.01;
                 #dsm39001#6   = #dsm39001#53 + #dsm39001#110 - #dsm39001#54;
             |SINO;
                 #dsm39001#6   = #dsm39001#53 + #dsm39001#110;
             |FINSI;
         |SINO;
             #dsm39001#6   = #dsm39001#53 + #dsm39001#110 - #dsm39001#54;
         |FINSI;

         #dsm39001#60  = 0;
         #dsm39001#61  = 0;
         #dsm39001#62  = 0;
         #dsm39001#7   = 0;
     |FINSI;

     |SI enTipoEntrada ! 95;
         |PINTA #dsm39001#6;
         |PINTA #dsm39001#7;
         |PINTA #dsm39001#8;
         |PINTA #dsm39001#9;
         |PINTA #dsm39001#10;
         |PINTA #dsm39001#11;
     |FINSI;
|FPRC;

|PROCESO BotonOperaciones;  |TIPO 7;
     |CONTROL_SIMPLE 0, "BOTON,F7 Operaciones", 0826, 0840, PulsaF7;
     nBoton7 = FSalida;
|FPRC;

|PROCESO SacaOperaciones;
     nTecla = FSalida;

     |SI nTecla = 15;
         |HAZ FuncionF7;
         |ERROR;
     |FINSI;

     |SI nTecla = 16;
         |HAZ FuncionF8;
         |ERROR;
     |FINSI;

     |SI nTecla = 17;
         |HAZ FuncionF9;
         |ERROR;
     |FINSI;

     |SI nTecla ! 15;   |Y nTecla ! 16;  |Y nTecla ! 17;
         |FIN_CONTROL_WINDOWS nBoton7;  nBoton7 = -1;
     |FINSI;

     |PULSATECLA;

     |ABRE #dsm39002;
     |SELECT #1#dsm39002;
     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 3;
     #dsm39002#5 = 15;
     |LEE 040#dsm39002.=;
     |SI FSalida ! 0;  |DDEFECTO #dsm39002;  |FINSI;
     nValor = #dsm39002#10;
     |CIERRA #dsm39002;

     #dsm39001#12 = nValor;
     |SI enTipoEntrada ! 95;
         |PINTA #dsm39001#12;
     |FINSI;
|FPRC;

|PROCESO Justificante;  |TIPO 7;
     |SI #dsm39001#3 = 0;
         #dsm39001#13 = "";  |PINTA #dsm39001#13;
         |C_M #dsm39001#13, 1, "N";
         |ACABA;
     |FINSI;
     |C_M #dsm39001#13, 1, "S";
|FPRC;

|PROCESO Tipo12m39001;  |TIPO 12;
|FPRC;

|PROCESO GrabaRegistro;
     |DDEFECTO #dsm39002;
     #dsm39002#0  = #dsm39001#0;
     #dsm39002#1  = #dsm39001#1;
     #dsm39002#2  = #dsm39001#2;
     #dsm39002#3  = #dsm39001#3;
     #dsm39002#4  = #dsmom007#0;
     #dsm39002#5  = #dsmom007#1;
     |LEE 101#dsm39002.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm39002;
         #dsm39002#0  = #dsm39001#0;
         #dsm39002#1  = #dsm39001#1;
         #dsm39002#2  = #dsm39001#2;
         #dsm39002#3  = #dsm39001#3;
         #dsm39002#4  = #dsmom007#0;
         #dsm39002#5  = #dsmom007#1;

         |SI #dsmom007#0 = 5;  |Y #dsmom007#1 = 1;
             #dsm39002#10 = 100;
         |FINSI;

         |GRABA 020#dsm39002.b;
     |FINSI;

     #dsm39002#6  = #dsmom007#2;
     #dsm39002#7  = #dsmom007#3;
     #dsm39002#9  = #dsmom007#5;

     |SI #dsm39002#4 = 1;  |Y #dsm39002#5 = 8;  |Y #dsm39001#1 ] 2007;
         #dsm39002#6 = "Mod.bases y cuotas concurso de acreedores ........";
     |FINSI;

     |SI #dsm39002#4 = 1;  |Y #dsm39002#5 = 12;  |Y #dsm39001#1 ] 2007;
         #dsm39002#6 = "Modificacion rec.equiv.concurso de acreedores ....";
     |FINSI;

     |SI #dsm39002#4 = 1;  |Y #dsm39002#5 = 4;  |Y #dsm39001#1 ] 2008;
         #dsm39002#6 = "Operaciones intragrupo ...........................";
     |FINSI;

     |SI #dsm39002#4 = 1;  |Y #dsm39002#5 = 6;  |Y #dsm39001#1 ] 2010;
         #dsm39002#6 = "IVA devengado ISP / Adquis.Intracom.Servicios ....";
     |FINSI;

     #dsm39002#24 = #dsmom007#0;
     #dsm39002#25 = #dsmom007#1;

     |SI #dsm39001#1 ] 2006;  |Y #dsm39001#1 [ 2008;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 1;   #dsm39002#24 = 3;  #dsm39002#25 = 1;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 9;   #dsm39002#24 = 3;  #dsm39002#25 = 2;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 10;  #dsm39002#24 = 3;  #dsm39002#25 = 3;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 11;  #dsm39002#24 = 3;  #dsm39002#25 = 4;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 12;  #dsm39002#24 = 3;  #dsm39002#25 = 5;  |FINSI;
         |SI #dsmom007#0 = 4;  |Y  #dsmom007#1 = 5;   #dsm39002#24 = 3;  #dsm39002#25 = 6;  |FINSI;
         |SI #dsmom007#0 = 4;  |Y  #dsmom007#1 = 7;   #dsm39002#24 = 3;  #dsm39002#25 = 7;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 2;   #dsm39002#24 = 3;  #dsm39002#25 = 8;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 3;   #dsm39002#24 = 3;  #dsm39002#25 = 9;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 8;   #dsm39002#24 = 3;  #dsm39002#25 = 10; |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 5;   #dsm39002#24 = 3;  #dsm39002#25 = 11; |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 6;   #dsm39002#24 = 3;  #dsm39002#25 = 12; |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 13;  #dsm39002#24 = 3;  #dsm39002#25 = 13; |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 14;  #dsm39002#24 = 3;  #dsm39002#25 = 14; |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 15;  #dsm39002#24 = 3;  #dsm39002#25 = 15; |FINSI;
     |FINSI;

     |SI #dsm39001#1 ] 2009;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 1;   #dsm39002#24 = 3;  #dsm39002#25 = 1;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 2;   #dsm39002#24 = 3;  #dsm39002#25 = 8;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 3;   #dsm39002#24 = 3;  #dsm39002#25 = 9;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 4;   #dsm39002#24 = 0;  #dsm39002#25 = 0;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 5;   #dsm39002#24 = 3;  #dsm39002#25 = 11; |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 6;   #dsm39002#24 = 3;  #dsm39002#25 = 12; |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 7;   #dsm39002#24 = 0;  #dsm39002#25 = 0;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 8;   #dsm39002#24 = 3;  #dsm39002#25 = 10; |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 9;   #dsm39002#24 = 3;  #dsm39002#25 = 2;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 10;  #dsm39002#24 = 3;  #dsm39002#25 = 3;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 11;  #dsm39002#24 = 3;  #dsm39002#25 = 4;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 12;  #dsm39002#24 = 3;  #dsm39002#25 = 5;  |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 13;  #dsm39002#24 = 3;  #dsm39002#25 = 13; |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 14;  #dsm39002#24 = 3;  #dsm39002#25 = 14; |FINSI;
         |SI #dsmom007#0 = 3;  |Y  #dsmom007#1 = 15;  #dsm39002#24 = 3;  #dsm39002#25 = 15; |FINSI;
         |SI #dsmom007#0 = 4;  |Y  #dsmom007#1 = 7;   #dsm39002#24 = 3;  #dsm39002#25 = 7;  |FINSI;
         |SI #dsmom007#0 = 4;  |Y  #dsmom007#1 = 9;   #dsm39002#24 = 3;  #dsm39002#25 = 6;  |FINSI;
     |FINSI;

     |GRABA 020#dsm39002.a;
     |LIBERA #dsm39002;
|FPRC;

|PROCESO dsmom007;
     |SI #dsmom007#0 = 4;  |Y #dsmom007#1 = 1;  |Y #dsm39001#1 ] 2008;
         #dsmom007#4 = 0;
         #dsmom007#6 = 4;
     |FINSI;

     |SI #dsmom007#0 = 4;  |Y #dsmom007#1 = 3;  |Y #dsm39001#1 ] 2008;
         #dsmom007#4 = 0;
         #dsmom007#6 = 4;
     |FINSI;

     |SI #dsm39001#1 ] 2009; |Y #dsmom007#4 = 2;
         |SI #dsmom007#0 ! 3; |Y #dsmom007#1 ! 7;
             #dsmom007#4 = 0;
         |FINSI;
     |FINSI;

     |SI #dsmom007#4 = 2;  |ACABA;  |FINSI;

     |SI #dsmom007#0 = 2;  |Y #dsmom007#1 = 10;
         |SI #dsm39001#1 [ 2007;
             #dsmom007#2 = "      Suma de deducciones ........................";
             #dsmom007#3 = "T";
             #dsmom007#4 = 0;
             #dsmom007#5 = 2;
             #dsmom007#6 = 0;
             #dsmom007#7 = 0;
             |HAZ GrabaRegistro;
         |SINO;
             #dsmom007#2 = "Regularizacion aplicacion porcentaje def.prorrata";
             #dsmom007#3 = "D";
             #dsmom007#4 = 0;
             #dsmom007#5 = 0;
             #dsmom007#6 = 0;
             #dsmom007#7 = 0;
             |HAZ GrabaRegistro;
         |FINSI;

         |ACABA;
     |FINSI;

     |SI #dsmom007#0 = 2;  |Y #dsmom007#1 = 11;  |Y #dsm39001#1 ] 2008;
         #dsmom007#2 = "Ops.interiores intragrupo bienes y serv.ctes. ...";
         #dsmom007#3 = "D";
         #dsmom007#4 = 0;
         #dsmom007#5 = 0;
         #dsmom007#6 = 0;
         #dsmom007#7 = 0;
         |HAZ GrabaRegistro;
     |FINSI;

     |SI #dsmom007#0 = 2;  |Y #dsmom007#1 = 12;  |Y #dsm39001#1 ] 2008;
         #dsmom007#0 = 2;
         #dsmom007#1 = 12;
         #dsmom007#2 = "Ops.interiores intragrupo con bienes inversion ..";
         #dsmom007#3 = "D";
         #dsmom007#4 = 0;
         #dsmom007#5 = 0;
         #dsmom007#6 = 0;
         #dsmom007#7 = 0;
         |HAZ GrabaRegistro;

         nNume1 = 13;    || Nuevo
         |SI #dsm39001#1 ] 2010;
             #dsmom007#0 = 2;
             #dsmom007#1 = 13;
             #dsmom007#2 = "Adquisiciones intracomunitarias de servicios .....";
             #dsmom007#3 = "D";
             #dsmom007#4 = 0;
             #dsmom007#5 = 0;
             #dsmom007#6 = 0;
             #dsmom007#7 = 0;
             |HAZ GrabaRegistro;
             nNume1 = 14;
         |FINSI;

         #dsmom007#0 = 2;
         #dsmom007#1 = nNume1;
         #dsmom007#2 = "      Total de deducciones .......................";
         #dsmom007#3 = "T";
         #dsmom007#4 = 0;
         #dsmom007#5 = 2;
         #dsmom007#6 = 0;
         #dsmom007#7 = 0;
         |HAZ GrabaRegistro;

         #dsmom007#0 = 2;
         #dsmom007#1 = 11;
         |ACABA;
     |FINSI;

     |SI #dsmom007#0 = 4;  |Y #dsmom007#1 = 8;  |Y #dsm39001#1 ] 2008;
         |HAZ GrabaRegistro;

         #dsmom007#0 = 4;
         #dsmom007#1 = 16;
         #dsmom007#2 = "Serv.localizados en el territorio inv.suj.pasivo ";
         #dsmom007#3 = "D";
         #dsmom007#4 = 0;
         #dsmom007#5 = 1;
         #dsmom007#6 = 4;
         #dsmom007#7 = 4;
         |HAZ GrabaRegistro;

         |SI #dsm39001#1 ] 2009;
             #dsmom007#0 = 4;
             #dsmom007#1 = 9;
             #dsmom007#2 = "Op.no sujeta por regla localiz. o con inv.suj.pas.";
             #dsmom007#3 = "D";
             #dsmom007#4 = 0;
             #dsmom007#5 = 1;
             #dsmom007#6 = 3;
             |HAZ GrabaRegistro;
         |FINSI;

         #dsmom007#0 = 4;
         #dsmom007#1 = 8;
         |ACABA;
     |FINSI;


     |HAZ GrabaRegistro;
|FPRC;

|DEFBUCLE dsmom007;
     #dsmom007#1;
     ;
     0, 00;
     5, 99;
     ;
     NULL, dsmom007;
|FIN;

|PROCESO dsmom117;
     #dsm39002#0  = #dsm39001#0;
     #dsm39002#1  = #dsm39001#1;
     #dsm39002#2  = #dsm39001#2;
     #dsm39002#3  = #dsm39001#3;
     #dsm39002#4  = #dsmom117#0;
     #dsm39002#5  = #dsmom117#1;
     |LEE 101#dsm39002.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm39002;
         #dsm39002#0  = #dsm39001#0;
         #dsm39002#1  = #dsm39001#1;
         #dsm39002#2  = #dsm39001#2;
         #dsm39002#3  = #dsm39001#3;
         #dsm39002#4  = #dsmom117#0;
         #dsm39002#5  = #dsmom117#1;

         |SI #dsmom117#0 = 5;  |Y #dsmom117#1 = 1;
             #dsm39002#10 = 100;
         |FINSI;

         |GRABA 020#dsm39002.b;
     |FINSI;

     #dsm39002#6  = #dsmom117#2;
     #dsm39002#7  = #dsmom117#3;
     #dsm39002#9  = #dsmom117#5;

     |SI nGrupo ! #dsmom117#0;
         nSubGrupo = 0;
     |FINSI;

     nGrupo    = #dsmom117#0;
     nSubGrupo = nSubGrupo + 1;

     #dsm39002#24 = nGrupo;
     #dsm39002#25 = nSubGrupo;

     |GRABA 020#dsm39002.a;
     |LIBERA #dsm39002;
|FPRC;

|DEFBUCLE dsmom117;
     #dsmom117#3;
     ;
     nEjerCarga, 0001, 0, 00;
     nEjerCarga, 9999, 6, 99;
     ;
     NULL, dsmom117;
|FIN;

|PROCESO dsmom117Ejer;
     nEjerCarga = #dsmom117#8;
|FPRC;

|DEFBUCLE dsmom117Ejer;
     #dsmom117#1;
     ;
     2011,   1, 00;
     enEjer, 1, 01;
     ;
     NULL, dsmom117Ejer;
|FIN;

|PROCESO PonActividad;
     aAlfa = #agicen14#5 % -104;   ||Fecha de Alta
     |SI aAlfa ! "0000";
         aAlfa = "31.12." + #dsm39001#1;
         |SI #agicen14#5 > aAlfa;
             |ACABA;
         |FINSI;
     |FINSI;

     aAlfa = #agicen14#6 % -104;    || Fecha de Baja
     |SI aAlfa ! "0000";
         aAlfa = "01.01." + #dsm39001#1;
         |SI #agicen14#6 < aAlfa;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #agicen14#7 = 1;   |ACABA;  |FINSI;
     |SI #agicen14#7 = 3;   |ACABA;  |FINSI;
     |SI #agicen14#7 = 9;   |ACABA;  |FINSI;

     |SI #agicen14#7 = 14;  nRECC = 1;  |FINSI;
     |SI #agicen14#7 = 15;  nRECC = 1;  |FINSI;

     |SI #agicen14#7 = 11;  nREDEME = 1;  |FINSI;
     |SI #agicen14#7 = 13;  nREDEME = 1;  |FINSI;
     |SI #agicen14#7 = 15;  nREDEME = 1;  |FINSI;

     |SI enActPrinci = 0; enActPrinci = #agicen14#1; |FINSI;
     |SI enActPrinci = #agicen14#1;
         nDesde = 63; nHasta = 66;
     |SINO;
         nDesde = 67; nHasta = 83;
     |FINSI;


     |PARA nCampo = nDesde;  |SI nCampo [ nHasta;  |HACIENDO nCampo = nCampo + 4;
           nCampo1 = nCampo + 1;
           nCampo2 = nCampo + 2;
           nCampo3 = nCampo + 3;
           |SI #dsm39001#nCampo#  = 0;
               #dsm39001#nCampo#  = #agicen14#1;
               #dsm39001#nCampo1# = #agicen14#3;
               #dsm39001#nCampo2# = #agicen14#4;

               |SI #agicen14#7  = 11;  |O #agicen14#7 = 13;
                   #dsm39001#88 = "X";
               |FINSI;

               |SI #agicen14#16 = 1;      |O #agicen14#16 = 2;      #dsm39001#nCampo3# = 1;  |FINSI;
               |SI #agicen14#16 = 4;      |O #agicen14#16 = 5;      #dsm39001#nCampo3# = 2;  |FINSI;
               |SI #agicen14#3  = "8612"; |O #agicen14#3  = "8611"; #dsm39001#nCampo3# = 3;  |FINSI;
               |SI #agicen14#16 = 3;                                #dsm39001#nCampo3# = 1;  |FINSI;
               |SI #agicen14#16 = 6;                                #dsm39001#nCampo3# = 6;  |FINSI;

               |SI #agicen14#3 = "9999";  |Y #agicen14#16 = 3;
                   #dsm39001#nCampo3# = 4;
               |FINSI;

               |SI #agicen14#3 = "9999";  |Y #agicen14#16 = 6;
                   #dsm39001#nCampo3# = 6;
               |FINSI;

               |SI #dsm39001#nCampo3# = 0;  |O #dsm39001#nCampo3# = 4;  |O #dsm39001#nCampo3# = 5;
                |O #dsm39001#nCampo3# = 6;
                   #dsm39001#nCampo1# = "";
               |FINSI;

               |SI #dsm39001#nCampo1# = "9999";
                   #dsm39001#nCampo1# = "";
               |FINSI;
               |SAL;
           |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE agicen14;
     #agicen14#1;
     ;
     #dsm39001#0, 01;
     #dsm39001#0, 99;
     ;
     NULL, PonActividad;
|FIN;

|PROCESO DatosEstadisticos;
     |HAZ eLaActivPrin;

     nRECC   = 0;
     nREDEME = 0;
     |BUCLE agicen14;

     #dsm39001#98 = "N";
     |SI nREDEME = 1;
         #dsm39001#98 = "S";
     |FINSI;

     #dsm39001#106 = "N";
     |SI nRECC = 1;
         #dsm39001#106 = "S";
     |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0 = #dsm39001#0;
     #dsmom004#1 = #dsm39001#1;
     #dsmom004#2 = 99;
     #dsmom004#3 = 347;
     #dsmom004#4 = 0;
     |LEE 000#dsmom004.=;
     |SI FSalida = 0;
         #dsm39001#87 = "X";
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROCESO OperRECC;
     |ABRE #dsm39002;
     |SELECT #1#dsm39002;

     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 4;
     #dsm39002#5 = 17;
     |LEE 040#dsm39002.=;
     |SI FSalida ! 0;  |DDEFECTO #dsm39002;  |FINSI;

     nValor = #dsm39002#10;

     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 4;
     #dsm39002#5 = 18;
     |LEE 040#dsm39002.=;
     |SI FSalida ! 0;  |DDEFECTO #dsm39002;  |FINSI;
     |CIERRA #dsm39002;

     nValor = nValor + #dsm39002#10;

     #dsm39001#107 = "N";
     |SI nValor ! 0;
         #dsm39001#107 = "S";
     |FINSI;
|FPRC;

|PROCESO Borra02;
     |BORRA 020#dsm39002.a;
     |LIBERA #dsm39002;
|FPRC;

|DEFBUCLE dsm39002B;
     #dsm39002#1;
     ;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 0, 00;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 9, 99;
     ;
     NULL, Borra02;
|FIN;

|PROCESO Borra03;
     |BORRA 020#dsm39003.a;
     |LIBERA #dsm39003;
|FPRC;

|DEFBUCLE dsm39003B;
     #dsm39003#1;
     ;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 00;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 99;
     ;
     NULL, Borra03;
|FIN;

|PROCESO Borra04;
     |BORRA 020#dsm39004.a;
     |LIBERA #dsm39004;
|FPRC;

|DEFBUCLE dsm39004B;
     #dsm39004#1;
     ;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 00;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 99;
     ;
     NULL, Borra04;
|FIN;

|PROCESO Borra05;
     |BORRA 020#dsm39005.a;
     |LIBERA #dsm39005;
|FPRC;

|DEFBUCLE dsm39005B;
     #dsm39005#1;
     ;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 0;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 9;
     ;
     NULL, Borra05;
|FIN;

|PROCESO dsm39006B;
     |ABRE #dsm39006;
     #dsm39006#0 = #dsm39001#0;
     #dsm39006#1 = #dsm39001#1;
     #dsm39006#2 = #dsm39001#2;
     #dsm39006#3 = #dsm39001#3;
     |LEE 141#dsm39006.=;
     |SI FSalida = 0;
         |BORRA 020#dsm39006.a;
     |FINSI;
     |LIBERA #dsm39006;
     |CIERRA #dsm39006;
|FPRC;

|PROCESO Recalculo;
     |ABRE #dsm39002;
     |SELECT #2#dsm39002;
     |HAZ Totales;
     |CIERRA #dsm39002;

     |HAZ SacaGeneral;
     |HAZ SacaSimplificado;
     |HAZ SacaResultados;
     |HAZ SacaOperaciones;
     |HAZ OperRECC;
|FPRC;

|PROCESO CompruebaVersion;
     nError = 0;
     |ABRE #dsmom117;
     #dsmom117#8 = 2018;
     #dsmom117#0 = 1;
     #dsmom117#1 = 0;
     |LEE 040#dsmom117.=;
     |SI FSalida ! 0;
         |CIERRA #dsmom117;

         eaExtension = "mod";
         eaPrograma  = "dsmom117";
         |SUB_EJECUTA_NP ":basica/dspatron";

         |ABRE #dsmom117;
         #dsmom117#8 = 2018;
         #dsmom117#0 = 1;
         #dsmom117#1 = 0;
         |LEE 040#dsmom117.=;
         |SI FSalida ! 0;
             |MENAV "0000Ficheros patrones del IVA incorrectos. Consulte con su administrador";
             nError = 1;
         |FINSI;
     |FINSI;
     |CIERRA #dsmom117;
|FPRC;

|PROCESO dsm39001_2;
     nValor  = 0;
     nValor2 = 0;

     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 2;
     #dsm39002#5 = 11;
     |LEE 101#dsm39002.=;
     |SI FSalida = 0;
         #dsm39002#10   = 0;  #dsm39002#11   = 0;
         #dsm39002#12   = 0;  #dsm39002#13   = 0;
         #dsm39002#14   = 0;  #dsm39002#15   = 0;
         #dsm39002#16   = 0;  #dsm39002#17   = 0;
         #dsm39002#18   = 0;  #dsm39002#19   = 0;
         #dsm39002#20   = 0;  #dsm39002#21   = 0;
         #dsm39002#22   = 0;  #dsm39002#23   = 0;
         #dsm39002#26   = 0;  #dsm39002#27   = 0;
         #dsm39002#28   = 0;  #dsm39002#29   = 0;
         #dsm39002#30   = 0;  #dsm39002#31   = 0;
         #dsm39002#32   = 0;  #dsm39002#33   = 0;
         #dsm39002#34   = 0;  #dsm39002#35   = 0;
         #dsm39002#36   = 0;  #dsm39002#37   = 0;
         #dsm39002#38   = 0;  #dsm39002#39   = 0;
         #dsm39002#40   = 0;  #dsm39002#41   = 0;
         #dsm39002#42   = 0;  #dsm39002#43   = 0;
         #dsm39002#44   = 0;  #dsm39002#45   = 0;
         #dsm39002#46   = 0;  #dsm39002#47   = 0;
         #dsm39002#48   = 0;  #dsm39002#49   = 0;
         #dsm39002#50   = 0;  #dsm39002#51   = 0;
         #dsm39002#52   = 0;  #dsm39002#53   = 0;
         #dsm39002#54   = 0;  #dsm39002#55   = 0;
         |GRABA 020#dsm39002.a;
         |LIBERA #dsm39002;
     |FINSI;

     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 2;
     #dsm39002#5 = 12;
     |LEE 101#dsm39002.=;
     |SI FSalida = 0;
         nValor  = #dsm39002#10;
         nValor2 = #dsm39002#11;
         #dsm39002#10   = 0;
         #dsm39002#11   = 0;
         |GRABA 020#dsm39002.a;
         |LIBERA #dsm39002;
     |FINSI;

     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 2;
     #dsm39002#5 = 13;
     |LEE 101#dsm39002.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm39002;
         #dsm39002#0  = #dsm39001#0;
         #dsm39002#1  = #dsm39001#1;
         #dsm39002#2  = #dsm39001#2;
         #dsm39002#3  = #dsm39001#3;
         #dsm39002#4  = 2;
         #dsm39002#5  = 13;
         #dsm39002#6  = "      Total de deducciones .......................";
         #dsm39002#7  = "T";
         #dsm39002#9  = 2;
         |GRABA 020#dsm39002.b;
     |FINSI;

     #dsm39002#10 = nValor;
     #dsm39002#11 = nValor2;
     |GRABA 020#dsm39002.a;
     |LIBERA #dsm39002;

     nSwHay = 1;
|FPRC;

|DEFBUCLE dsm39001_2;
     #dsm39001#2;
     ;
     0, 2008;
     0, 2008;
     ;
     NULL, dsm39001_2;
|FIN;

|PROCESO dsm39001_1;
     #dsm39001#91 = 1;
     |GRABA 020#dsm39001.a;
     |LIBERA #dsm39001;
|FPRC;

|DEFBUCLE dsm39001_1;
     #dsm39001#1;
     91;
     00000, 2008, 390, 00, 0;
     99999, 2008, 390, 99, 0;
     be;
     NULL, dsm39001_1;
|FIN;


|PROCESO Ctrl_2_14_Cabecera;
     nValor  = 0;
     nValor2 = 0;

     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 2;
     #dsm39002#5 = 13;
     |LEE 101#dsm39002.=;
     |SI FSalida = 0;
         nValor  = #dsm39002#10;
         nValor2 = #dsm39002#11;
         #dsm39002#6 = "Adquisiciones intracomunitarias de servicios .....";
         #dsm39002#7 = "D";
         #dsm39002#9 = 0;
         |PDEFECTO #dsm39002, 10, 24;
         |PDEFECTO #dsm39002, 26, 56;
         |GRABA 020#dsm39002.a;
         |LIBERA #dsm39002;
     |FINSI;

     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 2;
     #dsm39002#5 = 14;
     |LEE 101#dsm39002.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm39002;
         #dsm39002#0  = #dsm39001#0;
         #dsm39002#1  = #dsm39001#1;
         #dsm39002#2  = #dsm39001#2;
         #dsm39002#3  = #dsm39001#3;
         #dsm39002#4  = 2;
         #dsm39002#5  = 14;
         #dsm39002#6  = "      Total de deducciones .......................";
         #dsm39002#7  = "T";
         #dsm39002#9  = 2;
         #dsm39002#24 = #dsm39002#4;
         #dsm39002#25 = #dsm39002#5;
         |GRABA 020#dsm39002.b;
     |FINSI;

     #dsm39002#10 = nValor;
     #dsm39002#11 = nValor2;
     |GRABA 020#dsm39002.a;
     |LIBERA #dsm39002;
     |LIBERA #dsm39001;
|FPRC;

|DEFBUCLE Ctrl_2_14_Cabecera;
     #dsm39001#1;
     ;
     00000, 2010, 390, 00;
     99999, 2010, 390, 99;
     be;
     NULL, Ctrl_2_14_Cabecera;
|FIN;

|PROCESO Ctrl_2_14_Lineas;
     nSwHay = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE Ctrl_2_14_Lineas;
     #dsm39002#1;
     ;
     00000, 2010, 390, 00, 02, 14;
     99999, 2010, 390, 99, 02, 14;
     e;
     NULL, Ctrl_2_14_Lineas;
|FIN;

|PROCESO ControlaVersion;
     nSwHay = 0;
     |ABRE #dsm39002;
     |BUCLE dsm39001_2;
     |CIERRA #dsm39002;

     |SI nSwHay = 1;
         |LIBERA #dsm39001;
         |BUCLE dsm39001_1;
     |FINSI;

     |SI enEjer = 2010;
         nSwHay = 0;
         |BUCLE Ctrl_2_14_Lineas;
         |SI nSwHay = 0;
             |ABRE #dsm39002;
             |BUCLE Ctrl_2_14_Cabecera;
             |CIERRA #dsm39002;
         |FINSI;
     |FINSI;
|FPRC;

|PROGRAMA;

     |HAZ CompruebaVersion;
     |SI nError = 1;   |ACABA;  |FINSI;

     |SI enEjer ] 2008;
         |HAZ ControlaVersion;
     |FINSI;

     |HAZ LeeEURODBMOD;

     |HAZ LeeCtrlProrr;
     enResultado = 0;
     eaNomDef    = "dsm39001";
     nModo       = 2;

|| \\\\\\ Alta del Modelo ////////
     |SI enTipoEntrada = 1;              || Consulta del Modelo
         |CABEZA "Modelo 390";
         |ABRE #dsm39001;
         #dsm39001#0 = enEmpresa;
         #dsm39001#1 = enEjer;
         #dsm39001#2 = enModelo;
         #dsm39001#3 = enComplem;
         |LEE 101#dsm39001.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsm39001;
             #dsm39001#0 = enEmpresa;
             #dsm39001#1 = enEjer;
             #dsm39001#2 = enModelo;
             #dsm39001#3 = enComplem;
             #dsm39001#91 = 1;
             |GRABA 020#dsm39001.b;

             |HAZ DatosEstadisticos;
         |FINSI;

         |ABRE #dsm39002;
         |SELECT #1#dsm39002;

         |SI enEjer [ 2013;  |BUCLE dsmom007;  |FINSI;

         |SI enEjer ] 2014;
             |BUCLE dsmom117Ejer;
             |BUCLE dsmom117;
         |FINSI;

         |CIERRA #dsm39002;

         |SI #dsm39001#13 = "             ";  |Y #dsm39001#3 ! 0;
             |ABRE #dsmom004;
             #dsmom004#0 = #dsm39001#0;
             #dsmom004#1 = #dsm39001#1;
             #dsmom004#2 = 99;
             #dsmom004#3 = #dsm39001#2;
             #dsmom004#4 = #dsm39001#3 - 1;
             |LEE 000#dsmom004.=;
             |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;
             |CIERRA #dsmom004;

             #dsm39001#13 = #dsmom004#25;
         |FINSI;

         |PINPA #0#dsm39001;
         |PINDA #0#dsm39001;
         |HAZ PintaDatos;

         |CONTROL_SIMPLE 0, "BOTON,F8 Datos Estadisticos  ", 0803, 0824, PulsaF8;
         nBoton8 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F9 Prorratas ", 2268, 2278, PulsaF9;
         nBoton9 = FSalida;

         |ENDATOS #1#dsm39001;

         |HAZ QuitaBotones;

         |SI #dsm39001#4 = 0;  |Y #dsm39001#5  = 0;  |Y #dsm39001#6  = 0;  |Y #dsm39001#7  = 0;  |Y #dsm39001#8 = 0;
          |Y #dsm39001#9  = 0; |Y #dsm39001#10 = 0;  |Y #dsm39001#11 = 0;  |Y #dsm39001#12 = 0;
             |CONFI "0000 Modelo sin Actividad. Desea emitir el Modelo";
             |SI FSalida ! 0;
                 |BUCLE dsm39002B;
                 |BUCLE dsm39003B;
                 |BUCLE dsm39004B;
                 |BUCLE dsm39005B;
                 |HAZ dsm39006B;

                 |BORRA 020#dsm39001.a;
                 enEntrada = 0;
             |SINO;
                 #dsm39001#91 = 1;
                 |HAZ OperRECC;

                 |GRABA 020#dsm39001.a;
                 enEntrada = 1;
             |FINSI;
         |SINO;
             #dsm39001#91 = 1;
             |HAZ OperRECC;

             |GRABA 020#dsm39001.a;
             enEntrada = 1;
         |FINSI;
         |LIBERA #dsm39001;
         |CIERRA #dsm39001;

         |PULSATECLA;
         |ACABA;
     |FINSI;

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
         nModo = 4;
         |CABEZA "Modelo 390";

         |ABRE #dsm39001;
         #dsm39001#0 = enEmpresa;
         #dsm39001#1 = enEjer;
         #dsm39001#2 = enModelo;
         #dsm39001#3 = enComplem;
         |LEE 000#dsm39001.=;
         |SI FSalida ! 0;
             |MENAV "      No existe Registro.";
             |CIERRA #dsm39001;
             |ACABA;
         |FINSI;

         |PINPA #0#dsm39001;
         |PINDA #0#dsm39001;
         |HAZ PintaDatos;

         |CONTROL_SIMPLE 0, "BOTON,F2 R.Gnl", 0803, 0809, PulsaF2;
         nBoton1 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F3 Mod.", 0811, 0817, PulsaF3;
         nBoton2 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F4 Gan.", 0819, 0825, PulsaF4;
         nBoton3 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F5 I.Dev", 0827, 0833, PulsaF5;
         nBoton4 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F6 Res.", 0835, 0841, PulsaF6;
         nBoton5 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F7 Ope.", 0843, 0849, PulsaF7;
         nBoton6 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F8 D.Est.", 0851, 0858, PulsaF8;
         nBoton7 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F9 Pror.", 0860, 0866, PulsaF9;
         nBoton8 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F10 Grupos", 0868, 0878, PulsaF10;
         nBoton9 = FSalida;

         aEsc1  = &255 + "806";
         aEsc2  = &255 + "807";
         aRetu  = &255 + "802";
         aF2    = &255 + "824";
         aF3    = &255 + "825";
         aF4    = &255 + "826";
         aF5    = &255 + "827";
         aF6    = &255 + "828";
         aF7    = &255 + "829";
         aF8    = &255 + "830";
         aF9    = &255 + "831";
         aF10   = &255 + "832";

         |PARA; |SI;  |HACIENDO;
             |LEETECLA aTecla;
             |SI aTecla = aEsc1; |SAL;  |FINSI;
             |SI aTecla = aEsc2; |SAL;  |FINSI;
             |SI aTecla = aRetu; |SAL;  |FINSI;

             |SI aTecla = aF2;  |HAZ FuncionF2;   aTecla = "";  |FINSI;
             |SI aTecla = aF3;  |HAZ FuncionF3;   aTecla = "";  |FINSI;
             |SI aTecla = aF4;  |HAZ FuncionF4;   aTecla = "";  |FINSI;
             |SI aTecla = aF5;  |HAZ FuncionF5;   aTecla = "";  |FINSI;
             |SI aTecla = aF6;  |HAZ FuncionF6;   aTecla = "";  |FINSI;
             |SI aTecla = aF7;  |HAZ FuncionF7;   aTecla = "";  |FINSI;
             |SI aTecla = aF8;  |HAZ FuncionF8;   aTecla = "";  |FINSI;
             |SI aTecla = aF9;  |HAZ FuncionF9;   aTecla = "";  |FINSI;
             |SI aTecla = aF10; |HAZ FuncionF10;  aTecla = "";  |FINSI;
         |SIGUE;

         |HAZ QuitaBotones;

         |CIERRA #dsm39001;

         |PULSATECLA;
         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              || Baja del Modelo
         |ABRE #dsm39001;
         #dsm39001#0 = enEmpresa;
         #dsm39001#1 = enEjer;
         #dsm39001#2 = enModelo;
         #dsm39001#3 = enComplem;
         |LEE 101#dsm39001.=;
         |SI FSalida ! 0;
             |SI enMensa = 0;
                 |MENAV "      No existe Registro.";
             |FINSI;
             |CIERRA #dsm39001;
             |ACABA;
         |FINSI;

         |BUCLE dsm39002B;
         |BUCLE dsm39003B;
         |BUCLE dsm39004B;
         |BUCLE dsm39005B;
         |HAZ dsm39006B;

         |BORRA 020#dsm39001.a;
         |LIBERA #dsm39001;

         |CIERRA #dsm39001;

         |PULSATECLA;
         |ACABA;
     |FINSI;

|| \\\\\\ Alta desde el Pase del Modelo

     |SI enTipoEntrada = 95;
         |ABRE #dsm39001;
         #dsm39001#0 = enEmpresa;
         #dsm39001#1 = enEjer;
         #dsm39001#2 = enModelo;
         #dsm39001#3 = enComplem;
         |LEE 101#dsm39001.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsm39001;
             #dsm39001#0 = enEmpresa;
             #dsm39001#1 = enEjer;
             #dsm39001#2 = enModelo;
             #dsm39001#3 = enComplem;
             #dsm39001#91 = 1;
             |GRABA 020#dsm39001.b;

             |HAZ DatosEstadisticos;
         |FINSI;

         |ABRE #dsm39002;
         |SELECT #1#dsm39002;

         |SI enEjer [ 2013;  |BUCLE dsmom007;  |FINSI;

         |SI enEjer ] 2014;
             |BUCLE dsmom117Ejer;
             |BUCLE dsmom117;
         |FINSI;

         |CIERRA #dsm39002;

         |HAZ Recalculo;

         |GRABA 020#dsm39001.a;

         |LIBERA #dsm39001;
         |CIERRA #dsm39001;

         |PULSATECLA;
         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #dsm39001;
         #dsm39001#0 = enEmpresa;
         #dsm39001#1 = enEjer;
         #dsm39001#2 = enModelo;
         #dsm39001#3 = enComplem;
         |LEE 040#dsm39001.=;
         |SI FSalida ! 0;  enExistencia = 1;  |FINSI;
         |CIERRA #dsm39001;

         |SI enActividad = 0;  enResultado = 0;  |FINSI;
     |FINSI;

     |PULSATECLA;
|FPRO;

|PROCESO Tipo88;  |TIPO 88;
     |HAZ Relaciones;
|FPRC;
