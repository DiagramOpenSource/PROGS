|FICHEROS;
     dsmozpas #0;
     dsmom004 #4;
     dsmom008 #8;
     dsmom019 #19;
     dsmom030 #30;
     dsmom033 #33;
     dsmom133;
     dsmom069;
     dsmom041 #41;
     dsmom046 #46;
     dsmom087 #87;

     dsmoc310 #310;
     dsmoc311 #311;
     dsmoc349 #349;
     dsmom095 #95;

     :/contagen/def/canempre #101;
     :/contagen/def/camaniva #102;
     :/contagen/def/caivalin #103;
     :/contagen/def/caivaasi #104;
     :/contagen/def/caivam03 #105;
     :/basica/def/agicen14 #214;

     &regisnif@ #709;

     dsmow013 #999;

     espejo1@ #1300;
     espejo2@;
|FIN;

|VARIABLES;
     aAlfa1         = "";
     aAlfa          = "";
     aPathModelo    = "";
     aDef           = "";
     aTipo          = "";

     nCampo         = 0;
     nEjer          = 0;
     nDPeriodo      = 0;
     nHPeriodo      = 0;
     nCampo1        = 0;
     nCampo11       = 0;
     nCampo2        = 0;
     nCampo22       = 0;
     nCampo3        = 0;
     nCampo33       = 0;
     nSwEsta        = 0;
     nGrupo         = 0;
     nSubGrupo      = 0;
     nDepar         = 0;
     aSubde         = "";
     nBaseImpo      = 0;
     nPorce         = 0;
     nCuota         = 0;
     nTotal         = 0;
     nPeriodo       = 0;
     nModelo        = 0;
     nSwPasa        = 0;
     nSwPasa1       = 0;
     nCuotaSopor    = 0;
     nIngresos      = 0;
     nAnyoEjer      = 0;
     nAnyoCompra    = 0;
     nAnyoHasta     = 0;
     nMes           = 0;
     nIntra         = 0;
     nBClaveA       = 0;
     nBClaveI       = 0;
     nBClaveE       = 0;
     nBClaveS       = 0;
     nBClaveA349    = 0;
     nBClaveI349    = 0;
     nBClaveE349    = 0;
     nBClaveS349    = 0;
     nPerIntra1     = 0;
     nPerIntra2     = 0;
     nPerIntra3     = 0;
     nPerIntra4     = 0;
     nPerIntra5     = 0;
     nPerIntra6     = 0;
     nPerIntra7     = 0;
     nPerIntra8     = 0;
     nPerIntra9     = 0;
     nPerIntra10    = 0;
     nPerIntra11    = 0;
     nPerIntra12    = 0;
     aDesConexion349 = "";
     nTPRepar       = 0;
     nExRepar       = 0;
     nIgual         = 0;
     nSwCuotaNeg    = 0;
     nSw            = 0;
     aEspecial      = "";
     aTriangul      = "";
     nSwOp          = 0;
     nTanto         = 0;

     &enEmpresaA    = 0;
     &enAnyo        = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Como2013;
     |ABRE #311;
     #dsmoc311#0 = #310#0;
     #dsmoc311#1 = #310#1;
     #dsmoc311#2 = #310#2;
     #dsmoc311#3 = #310#3;
     #dsmoc311#4 = #310#4;
     #dsmoc311#5 = #310#5;
     #dsmoc311#6 = #33#0;
     |LEE 101#311=;
     |SI FSalida ! 0;
         |DDEFECTO #311;
         #dsmoc311#0  = #310#0;
         #dsmoc311#1  = #310#1;
         #dsmoc311#2  = #310#2;
         #dsmoc311#3  = #310#3;
         #dsmoc311#4  = #310#4;
         #dsmoc311#5  = #310#5;
         #dsmoc311#6  = #33#0;
         #dsmoc311#7  = #33#1;
         #dsmoc311#9  = #33#6;
         #dsmoc311#10 = #33#7;
         |GRABA 020#311b;
     |FINSI;

     |SI enEjer < 2012;
         |SI #102#4 [ "30.06.2010";
             #dsmoc311#13 = #dsmoc311#13 + ((#103#6 / enConversor) ! EURODBMOD);
             #dsmoc311#14 = #33#6;
             #dsmoc311#15 = #33#7;
             |SI #30#32 = 2; #dsmoc311#16 = #dsmoc311#16 + nCuota; |FINSI;
         |SINO;
             #dsmoc311#18 = #dsmoc311#18 + ((#103#6 / enConversor) ! EURODBMOD);
             #dsmoc311#19 = #33#6;
             #dsmoc311#20 = #33#7;
             |SI #30#32 = 2; #dsmoc311#21 = #dsmoc311#21 + nCuota; |FINSI;
         |FINSI;
     |SINO;
         |SI #102#4 [ "31.08.2012";
             #dsmoc311#13 = #dsmoc311#13 + ((#103#6 / enConversor) ! EURODBMOD);
             #dsmoc311#14 = #33#6;
             #dsmoc311#15 = #33#7;
             |SI #30#32 = 2; #dsmoc311#16 = #dsmoc311#16 + nCuota; |FINSI;
         |SINO;
             #dsmoc311#18 = #dsmoc311#18 + ((#103#6 / enConversor) ! EURODBMOD);
             #dsmoc311#19 = #33#6;
             #dsmoc311#20 = #33#7;
             |SI #30#32 = 2; #dsmoc311#21 = #dsmoc311#21 + nCuota; |FINSI;
         |FINSI;
     |FINSI;

     #dsmoc311#17 = #dsmoc311#13 * #dsmoc311#14;
     #dsmoc311#17 = #dsmoc311#17  - ((#dsmoc311#13 * #dsmoc311#14) % 1 + #dsmoc311#16)
     #dsmoc311#22 = #dsmoc311#18 * #dsmoc311#19;
     #dsmoc311#22 = #dsmoc311#22 -  ((#dsmoc311#18 * #dsmoc311#19) % 1 + #dsmoc311#21);
     #dsmoc311#23 = 1;

     #dsmoc311#8 = #dsmoc311#13 + #dsmoc311#18;
     nTotal = (#dsmoc311#13 * #dsmoc311#14) + (#dsmoc311#18 * #dsmoc311#19);
     |SI #dsmoc311#1 [ 2010; |O #dsmoc311#1 = 2012;
         nTanto  = (nTotal / #dsmoc311#8) ! 5;
         #dsmoc311#9  = nTanto;
         #dsmoc311#10 = ((#dsmoc311#15 + #dsmoc311#20) / 2) ! 2;
     |SINO;
         #dsmoc311#9  = #33#6;
         #dsmoc311#10 = #33#7;
     |FINSI;
     #dsmoc311#11 = #dsmoc311#16 + #dsmoc311#21;
     #dsmoc311#12 = #dsmoc311#17 + #dsmoc311#22;

     |GRABA 020#311a;
     |LIBERA #311;
     |CIERRA #311;
|FPRC;

|PROCESO Como2014;
     #dsmom133#0 = #dsmom033#0;
     #dsmom133#1 = enEjer;
     |LEE 000#dsmom133.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom133;  |FINSI;

     |ABRE #311;
     #dsmoc311#0 = #310#0;
     #dsmoc311#1 = #310#1;
     #dsmoc311#2 = #310#2;
     #dsmoc311#3 = #310#3;
     #dsmoc311#4 = #310#4;
     #dsmoc311#5 = #310#5;
     #dsmoc311#6 = #dsmom033#0;
     |LEE 101#311=;
     |SI FSalida ! 0;
         |DDEFECTO #311;
         #dsmoc311#0  = #310#0;
         #dsmoc311#1  = #310#1;
         #dsmoc311#2  = #310#2;
         #dsmoc311#3  = #310#3;
         #dsmoc311#4  = #310#4;
         #dsmoc311#5  = #310#5;
         #dsmoc311#6  = #dsmom033#0;
         #dsmoc311#7  = #dsmom033#1;
         #dsmoc311#9  = #dsmom133#3;
         #dsmoc311#10 = #dsmom133#4;
         |GRABA 020#311b;
     |FINSI;

     #dsmoc311#8  = #dsmoc311#8 + ((#103#6 / enConversor) ! EURODBMOD);
     |SI enPeriodo < 12;
         #dsmoc311#12 = (((#dsmoc311#8 * #dsmoc311#9) * #dsmoc311#10) / 100) ! EURODBMOD;
     |SINO;
         |SI #30#32 = 2; #dsmoc311#11 = #dsmoc311#11 + nCuota; |FINSI;

         #dsmoc311#12 = #dsmoc311#8 * #dsmoc311#9;
         #dsmoc311#12 = #dsmoc311#12  - (((#dsmoc311#8 * #dsmoc311#9) % 1) + #dsmoc311#11);
     |FINSI;

     #dsmoc311#13 = #dsmoc311#8;
     #dsmoc311#14 = #dsmoc311#9;
     #dsmoc311#15 = #dsmoc311#10;
     #dsmoc311#16 = #dsmoc311#11;
     #dsmoc311#17 = #dsmoc311#12;
     #dsmoc311#18 = 0;
     #dsmoc311#19 = 0;
     #dsmoc311#20 = 0;
     #dsmoc311#21 = 0;
     #dsmoc311#22 = 0;
     #dsmoc311#23 = 1;

     |GRABA 020#311a;
     |LIBERA #311;
     |CIERRA #311;
|FPRC;

|PROCESO dsmoc311;
     |SI enEjer [ 2013;
         |HAZ Como2013;
     |FINSI;

     |SI enEjer ] 2014;
         |HAZ Como2014;
     |FINSI;
|FPRC;

|PROCESO ComoUlt2013;
     |ABRE #311;
     #dsmoc311#0 = #310#0;
     #dsmoc311#1 = #310#1;
     #dsmoc311#2 = #310#2;
     #dsmoc311#3 = #310#3;
     #dsmoc311#4 = #310#4;
     #dsmoc311#5 = #310#5;
     #dsmoc311#6 = #33#0;
     |LEE 101#311=;
     |SI FSalida ! 0;
         |DDEFECTO #311;
         #dsmoc311#0  = #310#0;
         #dsmoc311#1  = #310#1;
         #dsmoc311#2  = #310#2;
         #dsmoc311#3  = #310#3;
         #dsmoc311#4  = #310#4;
         #dsmoc311#5  = #310#5;
         #dsmoc311#6  = #33#0;
         #dsmoc311#7  = #33#1;
         #dsmoc311#9  = #33#6;
         #dsmoc311#10 = #33#7;
         |GRABA 020#311b;
     |FINSI;

     |SI enEjer < 2012;
         |SI #102#4 [ "30.06.2010";
             #dsmoc311#16 = #dsmoc311#16 + nCuota;
         |SINO;
             #dsmoc311#21 = #dsmoc311#21 + nCuota;
         |FINSI;
     |SINO;
         |SI #102#4 [ "31.08.2012";
             #dsmoc311#16 = #dsmoc311#16 + nCuota;
         |SINO;
             #dsmoc311#21 = #dsmoc311#21 + nCuota;
         |FINSI;
     |FINSI;

     #dsmoc311#17 = #dsmoc311#13 * #dsmoc311#14;
     #dsmoc311#17 = #dsmoc311#17  - ((#dsmoc311#13 * #dsmoc311#14) % 1 + #dsmoc311#16)
     #dsmoc311#22 = #dsmoc311#18 * #dsmoc311#19;
     #dsmoc311#22 = #dsmoc311#22 -  ((#dsmoc311#18 * #dsmoc311#19) % 1 + #dsmoc311#21);
     #dsmoc311#23 = 1;

     #dsmoc311#8 = #dsmoc311#13 + #dsmoc311#18;
     nTotal = (#dsmoc311#13 * #dsmoc311#14) + (#dsmoc311#18 * #dsmoc311#19);
     |SI #dsmoc311#1 [ 2010; |O #dsmoc311#1 = 2012;
         nTanto = (nTotal / #dsmoc311#8) ! 5;
         #dsmoc311#9 = nTanto;
         #dsmoc311#10 = ((#dsmoc311#15 + #dsmoc311#20) / 2) ! 2;
     |SINO;
         #dsmoc311#9  = #33#6;
         #dsmoc311#10 = #33#7;
     |FINSI;
     #dsmoc311#11 = #dsmoc311#16 + #dsmoc311#21;
     #dsmoc311#12 = #dsmoc311#17 + #dsmoc311#22;
     |GRABA 020#311a;
     |LIBERA #311;
     |CIERRA #311;
|FPRC;

|PROCESO ComoUlt2014;
     #dsmom133#0 = #dsmom033#0;
     #dsmom133#1 = enEjer;
     |LEE 000#dsmom133.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom133;  |FINSI;

     |ABRE #311;
     #dsmoc311#0 = #310#0;
     #dsmoc311#1 = #310#1;
     #dsmoc311#2 = #310#2;
     #dsmoc311#3 = #310#3;
     #dsmoc311#4 = #310#4;
     #dsmoc311#5 = #310#5;
     #dsmoc311#6 = #33#0;
     |LEE 101#311=;
     |SI FSalida ! 0;
         |DDEFECTO #311;
         #dsmoc311#0  = #310#0;
         #dsmoc311#1  = #310#1;
         #dsmoc311#2  = #310#2;
         #dsmoc311#3  = #310#3;
         #dsmoc311#4  = #310#4;
         #dsmoc311#5  = #310#5;
         #dsmoc311#6  = #33#0;
         #dsmoc311#7  = #33#1;
         #dsmoc311#9  = #dsmom133#3;
         #dsmoc311#10 = #dsmom133#4;
         |GRABA 020#311b;
     |FINSI;

     #dsmoc311#16 = #dsmoc311#16 + nCuota;
     #dsmoc311#17 = #dsmoc311#13 * #dsmoc311#14;
     #dsmoc311#17 = #dsmoc311#17  - ((#dsmoc311#13 * #dsmoc311#14) % 1 + #dsmoc311#16)
     #dsmoc311#22 = 0;

     #dsmoc311#8  = #dsmoc311#13 + #dsmoc311#18;
     #dsmoc311#9  = #dsmom133#3;
     #dsmoc311#10 = #dsmom133#4;
     #dsmoc311#11 = #dsmoc311#16 + #dsmoc311#21;
     #dsmoc311#12 = #dsmoc311#17 + #dsmoc311#22;

     |GRABA 020#311a;
     |LIBERA #311;
     |CIERRA #311;
|FPRC;

|PROCESO Ult_dsmoc311;
     |SI enEjer [ 2013;
         |HAZ ComoUlt2013;
     |FINSI;

     |SI enEjer ] 2014;
         |HAZ ComoUlt2014;
     |FINSI;
|FPRC;

|PROCESO Grupo3_310;
  nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
  nPorce    = #103#7;
  nCuota    = (#103#8 / enConversor) ! EURODBMOD;
  nTotal    = ((#103#6 + #103#8 + #103#10) / enConversor) ! EURODBMOD;

  |SI #30#30 = 1; |Y #8#7 = "REGISTROS "; |Y #310#8 = "S";
      #33#0 = aSubde;  || #102#11;
      |LEE 001#33=;
      |SI FSalida = 0;
          |SI #33#6 ! 0;
              |SI enPeriodo ! 12;
                  nTotal = nBaseImpo * #33#6;
                  nTotal = ((nTotal * #33#7) / 100) ! EURODBMOD;
                  #310#9 = #310#9 + nTotal;

                  |SI enEjer ] 2014;
                      |HAZ dsmoc311;
                  |FINSI;
              |SINO;
                  |SI enEjer ] 2010;
                      |HAZ dsmoc311;
                  |SINO;
                      nIngresos = nIngresos + nBaseImpo;
                      #310#9    = nIngresos * #33#6;
                  |FINSI;
              |FINSI;
          |FINSI;
      |FINSI;
   |FINSI;

   |SI #30#30 = 2;
       #310#10  = #310#10  + nCuota;
       nIntra   = 1;
   |FINSI;

   |SI #30#30 = 4;
       #310#11 = #310#11 + nCuota;
   |FINSI;

   |SI #30#30 = 3;
       |SI #30#72 ! "S";
           #310#12 = #310#12 + nCuota;
       |SINO;
           #310#17 = #310#17 + nCuota;
           nIntra   = 1;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO Grupo4_310;
  nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
  nPorce    = #103#7;
  nCuota    = (#103#8 / enConversor) ! EURODBMOD;

  |SI #30#32 = 3;   #310#13     = #310#13     + nCuota;   |FINSI;

  |SI #30#32 = 2;
      nCuotaSopor = nCuotaSopor + nCuota;
      |SI enEjer ] 2010; |Y enPeriodo = 12;
          #33#0 = aSubde;
          |LEE 001#33=;
          |SI FSalida = 0;
              |SI #33#6 ! 0;
                  |HAZ Ult_dsmoc311;
              |FINSI;
          |FINSI;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO Grupo5_310;
  nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
  nPorce    = #103#7;
  nCuota    = (#103#8 / enConversor) ! EURODBMOD;
  nGrupo    = 3;

   |SI #30#34 = 9;                       || Entregas Intracomunitarias
       #310#15 = #310#15 + nBaseImpo;
       nIntra = 1;
   |FINSI;

   |SI #30#34 = 4; |Y #30#72 = "S";
       #310#18 = #310#18 + nBaseImpo;
       nIntra   = 1;
   |FINSI;

   |SI #30#34 = 16;
       #310#18 = #310#18 + nBaseImpo;
       nIntra   = 1;
   |FINSI;

   |SI #30#34 = 02; |Y #310#8 ! "S";
       |SI #30#24 = 10; |O #30#78 = 10; |O #30#79 = 10; |O #30#80 = 10; |O #30#81 = 10;
          |O #30#82 = 10; |O #30#83 = 10; |O #30#84 = 10; |O #30#85 = 10;
            |O #30#86 = 10; |O #30#87 = 10; |O #30#88 = 10; |O #30#89 = 10;
               |O #30#94 = 10; |O #30#95 = 10;
                 |O #30#100 = 10; |O #30#101 = 10;
               #310#19 = #310#19 + nBaseImpo;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO LeeConcepto349;
 aEspecial = "";
 aTriangul = "";
 #dsmom069#0 = #dsmom030#0;
 |LEE 041#dsmom069.=;
 |SI FSalida = 0;
     |SI #dsmom069#2 = "A"; #dsmom030#26 =  5; |FINSI;
     |SI #dsmom069#2 = "I"; #dsmom030#26 =  6; |FINSI;
     |SI #dsmom069#2 = "E"; #dsmom030#34 =  9; |FINSI;
     |SI #dsmom069#2 = "S"; #dsmom030#34 = 16; |FINSI;
     |SI #dsmom069#2 = "M"; #dsmom030#34 =  9; aEspecial = "M"; |FINSI;
     |SI #dsmom069#2 = "H"; #dsmom030#34 =  9; aEspecial = "H"; |FINSI;
     |SI #dsmom069#2 = "T"; #dsmom030#34 =  9; aEspecial = "T"; aTriangul = "X"; |FINSI;
     || aTriangul = #dsmom069#3;
     #dsmom030#72 = #dsmom069#4;
     |SI enEjer < 2018;
         |SI aEspecial = "T"; aEspecial = "E"; aTriangul = "X"; |FINSI;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO LeeLinea310;
     |SI #103#5 = "N"; |ACABA;  |FINSI;
     aAlfa1 = #103#30; |QBF aAlfa1;
     |SI aAlfa1 = "";
         #103#30 = #102#10;
         aAlfa1 = #103#31; |QBF aAlfa1; |SI aAlfa1 = ""; #103#31 = #102#11; |FINSI;
     |FINSI;
     |SI aMulDep = "S";
         nDepar = #103#30;
         aSubde = #103#31;
         |SI nDepar = 0;  nDepar = 1;   |FINSI;

         |ABRE #214;
         #214#0 = #999#0;
         #214#1 = nDepar;
         |LEE 040#214=;
         |SI FSalida ! 0;  nDepar = 1;  |FINSI;
         |CIERRA #214;
         |SI #999#1 ! nDepar;  |ACABA;  |FINSI;
     |FINSI;

     nSwPasa = 0;
     #30#0 = #103#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #30#4 = "N";  |ACABA;  |FINSI;

     |HAZ LeeConcepto349;

     nIntra = 0;
     |SI #30#30 ! 0; nSwPasa = 1;  |HAZ Grupo3_310;  |FINSI;
     |SI #30#32 ! 0; nSwPasa = 1;  |HAZ Grupo4_310;  |FINSI;
     |SI #30#34 ! 0; nSwPasa = 1;  |HAZ Grupo5_310;  |FINSI;

     |SI nIntra   = 1;
         |SI #102#5 = 1;  nPerIntra1  = 1;  |FINSI;
         |SI #102#5 = 2;  nPerIntra2  = 1;  |FINSI;
         |SI #102#5 = 3;  nPerIntra3  = 1;  |FINSI;
         |SI #102#5 = 4;  nPerIntra4  = 1;  |FINSI;
         |SI #102#5 = 5;  nPerIntra5  = 1;  |FINSI;
         |SI #102#5 = 6;  nPerIntra6  = 1;  |FINSI;
         |SI #102#5 = 7;  nPerIntra7  = 1;  |FINSI;
         |SI #102#5 = 8;  nPerIntra8  = 1;  |FINSI;
         |SI #102#5 = 9;  nPerIntra9  = 1;  |FINSI;
         |SI #102#5 = 10; nPerIntra10 = 1;  |FINSI;
         |SI #102#5 = 11; nPerIntra11 = 1;  |FINSI;
         |SI #102#5 = 12; nPerIntra12 = 1;  |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE caivalin310;
     #103#1;
     ;
     #102#0, #102#1, 01;
     #102#0, #102#1, 99;
     ;
     NULL, LeeLinea310;
|FIN;

|PROCESO LeeCabecera310;
     nDepar = #102#10;
     aSubde = #102#11;
     |SI aMulDep ! "S";
         nDepar = #102#10;
         |SI nDepar = 0;  nDepar = 1;   |FINSI;

         |ABRE #214;
         #214#0 = #999#0;
         #214#1 = nDepar;
         |LEE 040#214=;
         |SI FSalida ! 0;  nDepar = 1;  |FINSI;
         |CIERRA #214;
         |SI #999#1 ! nDepar;  |ACABA;  |FINSI;
     |FINSI;

     |ABRE #105;
     |DDEFECTO #105;
     #105#0 = #102#0;
     #105#1 = #102#1;
     |LEE 040#105=;
     |CIERRA #105;

     |BUCLE caivalin310;

     |SI nSwPasa = 0;  |ACABA;  |FINSI;

     |SI #102#40 = 0;  #102#40 = nHPeriodo;  |FINSI;

     |GRABA 020#102a;
     |LIBERA #102;

     nSwPasa1 = 1;
|FPRC;

|DEFBUCLE camaniva310;
     #102#1;
     5;
     00, 0000000000, nDPeriodo;
     99, 9999999999, nHPeriodo;
     be;
     NULL, LeeCabecera310;
|FIN;

|PROCESO Compensa310;
     #310#0 = #1300#0;
     #310#1 = #1300#1;
     #310#2 = #1300#2;
     #310#3 = #1300#3;
     #310#4 = #1300#4 + 1;
     #310#5 = #1300#5;
     |LEE 000#310=;
     |SI FSalida = 0; |ACABA;  |FINSI;

     |DDEFECTO #310;
     #310#0 = #1300#0;
     #310#1 = #999#2;
     #310#2 = #999#3;
     #310#3 = #1300#3;
     #310#4 = #999#9;
     #310#5 = #1300#5;
     |LEE 101#310=;
     |SI FSalida = 0;
         |SI enPeriodo ! 12; |Y #8#7 = "REGISTROS ";
             #310#9  = #310#9 - #1300#9;
         |FINSI;

         #310#10 = #310#10 - #1300#10;
         #310#11 = #310#11 - #1300#11;
         #310#12 = #310#12 - #1300#12;
         #310#17 = #310#17 - #1300#17;
         #310#13 = #310#13 - #1300#13;
         #310#14 = #310#14 - #1300#14;
         #310#15 = #310#15 - #1300#15;
         #310#18 = #310#18 - #1300#18;
         #310#19 = #310#19 - #1300#19;
         |GRABA 020#310a;
         |LIBERA #310;
    |FINSI;
|FPRC;

|DEFBUCLE dsmoc310;
     #1300#1006;
     ;
     #999#0, #999#2, nPeriodo, #999#7, 00, #999#1;
     #999#0, #999#2, nPeriodo, #999#7, 99, #999#1;
     ;
     NULL, Compensa310;
|FIN;

|PROCESO Compensa311;
     #dsmoc311#0 = #espejo2@#0;
     #dsmoc311#1 = #espejo2@#1;
     #dsmoc311#2 = #espejo2@#2;
     #dsmoc311#3 = #espejo2@#3;
     #dsmoc311#4 = #espejo2@#4 + 1;
     #dsmoc311#5 = #espejo2@#5;
     #dsmoc311#6 = #espejo2@#6;
     |LEE 000#dsmoc311.=;
     |SI FSalida = 0; |ACABA;  |FINSI;

     |DDEFECTO #dsmoc311;
     #dsmoc311#0 = #espejo2@#0;
     #dsmoc311#1 = #dsmow013#2;
     #dsmoc311#2 = #dsmow013#3;
     #dsmoc311#3 = #espejo2@#3;
     #dsmoc311#4 = #dsmow013#9;
     #dsmoc311#5 = #espejo2@#5;
     #dsmoc311#6 = #espejo2@#6;
     |LEE 101#dsmoc311.=;
     |SI FSalida = 0;
         #dsmoc311#8  = #dsmoc311#8  - #espejo2@#8;
         #dsmoc311#11 = #dsmoc311#11 - #espejo2@#11;

         |SI #dsmoc311#2 < 12;
             #dsmoc311#12 = (((#dsmoc311#8 * #dsmoc311#9) * #dsmoc311#10) / 100) ! EURODBMOD;
         |SINO;
             |SI #30#32 = 2; #dsmoc311#11 = #dsmoc311#11 + nCuota; |FINSI;

             #dsmoc311#12 = #dsmoc311#8 * #dsmoc311#9;
             #dsmoc311#12 = #dsmoc311#12  - (((#dsmoc311#8 * #dsmoc311#9) % 1) + #dsmoc311#11);
         |FINSI;

         #dsmoc311#13 = #dsmoc311#8;
         #dsmoc311#14 = #dsmoc311#9;
         #dsmoc311#15 = #dsmoc311#10;
         #dsmoc311#16 = #dsmoc311#11;
         #dsmoc311#17 = #dsmoc311#12;
         #dsmoc311#18 = 0;
         #dsmoc311#19 = 0;
         #dsmoc311#20 = 0;
         #dsmoc311#21 = 0;
         #dsmoc311#22 = 0;
         #dsmoc311#23 = 1;

         |GRABA 020#dsmoc311.a;
         |LIBERA #dsmoc311;
    |FINSI;
|FPRC;

|DEFBUCLE dsmoc311C;
     #espejo2@#1007;
     ;
     #999#0, #999#2, nPeriodo, #999#7, 00, #999#1, 001;
     #999#0, #999#2, nPeriodo, #999#7, 99, #999#1, 999;
     ;
     NULL, Compensa311;
|FIN;

|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
|PROCESO LeoDsmom046;
 nExRepar = 1;
 |SI #46#1 = #310#5;
     nIgual   = 1;
     nTPRepar = nTPRepar + #46#5;
 |FINSI;
|FPRC;

|DEFBUCLE LeoDsmom046;
 #46#1;
 ;
 #41#0, #41#2, #41#3, 01, "   ";
 #41#0, #41#2, #41#3, 99, "zzz";
 e;
 NULL, LeoDsmom046;
|FIN;

|PROCESO Regulariza;
 nTPRepar = 0;
 nExRepar = 0;
 nIgual   = 0;

 |BUCLE LeoDsmom046;
 |SI nExRepar = 0;
     |SI #41#1 = #310#5; nIgual = 1; nTPRepar = 100; |FINSI;
 |FINSI;
 |SI nIgual = 0; |ACABA; |FINSI;  ||No pertenece a la actividad

 || .....      |SI #41#1 ! #310#5;  |ACABA;  |FINSI;
 |SI nTPRepar ! 100;
     #41#10   = (#41#10   % nTPRepar) ! EURODBMOD;
 |FINSI;

     nAnyoEjer = #310#1;

     aAlfa       = #41#27 % -104;
     nAnyoCompra = aAlfa;

     |SI nAnyoEjer   = nAnyoCompra;   |ACABA;  |FINSI;
     |SI #41#27      ] "01.01.1998";  |ACABA;  |FINSI;
     |SI nAnyoCompra < 1994;          |ACABA;  |FINSI;

     nAnyoHasta = nAnyoCompra + 5;

     |SI nAnyoEjer ] nAnyoHasta;  |ACABA;  |FINSI;

     #310#14 = #310#14 + ((#41#10 % 16) / 5);
|FPRC;

|DEFBUCLE dsmom041;
     #41#1;
     ;
     #310#0, "        ", 00;
     #310#0, "zzzzzzzz", 99;
     ;
     NULL, Regulariza;
|FIN;

|PROCESO Amortizacion;
     |BUCLE dsmom041;
|FPRC;

|PROCESO leeActividad;
     |ABRE #214;
     #214#0 = enEmpresa;
     #214#1 = enActividad;
     |LEE 040#214=;
     |SI FSalida ! 0;
         #214#4 = "SIN ACTIVIDAD";
     |FINSI;
     |CIERRA #214;

     #310#6 = #214#3;   ||epigrafe
     #310#7 = #214#4;   ||nombre actividad
     #310#8 = "N";
     |SI #214#9 = 6;  |O #214#9 = 7; |O #214#9 = 11; |O #214#9 = 12;
         #310#8 = "S";
     |FINSI;
|FPRC;

|PROCESO Calcu349_310;
     |SI #349#6 = "A ";
         nBClaveA349 = nBClaveA349 + (#349#12 + #349#15 + #349#18 + #349#21 + #349#30 + #349#33 + #349#36);
     |FINSI;

     |SI #349#6 = "AR";
         nBClaveA349 = nBClaveA349 + (#349#12 + #349#15 + #349#18 + #349#21 + #349#30 + #349#33 + #349#36);

         |SI #349#24 = "-";
             nBClaveA349 = nBClaveA349 - (#349#39 + #349#42 + #349#45 + #349#48 + #349#51 + #349#54 + #349#57);
         |SINO;
             nBClaveA349 = nBClaveA349 + (#349#39 + #349#42 + #349#45 + #349#48 + #349#51 + #349#54 + #349#57);
         |FINSI;
     |FINSI;

     |SI #349#6 = "I ";
         nBClaveI349 = nBClaveI349 + (#349#12 + #349#15 + #349#18 + #349#21 + #349#30 + #349#33 + #349#36);
     |FINSI;

     |SI #349#6 = "IR";
         nBClaveI349 = nBClaveI349 + (#349#12 + #349#15 + #349#18 + #349#21 + #349#30 + #349#33 + #349#36);

         |SI #349#24 = "-";
             nBClaveI349 = nBClaveI349 - (#349#39 + #349#42 + #349#45 + #349#48 + #349#51 + #349#54 + #349#57);
         |SINO;
             nBClaveI349 = nBClaveI349 + (#349#39 + #349#42 + #349#45 + #349#48 + #349#51 + #349#54 + #349#57);
         |FINSI;
     |FINSI;

     |SI #349#6 = "E ";
        |O #349#6 = "H ";
        |O #349#6 = "M ";
        |O #349#6 = "T ";
         nBClaveE349 = nBClaveE349 + #349#22;
     |FINSI;

     |SI #349#6 = "ER";
        |O #349#6 = "MR";
        |O #349#6 = "HR";
        |O #349#6 = "TR";
         nBClaveE349 = nBClaveE349 + #349#22;

         |SI #349#24 = "-";
             nBClaveE349 = nBClaveE349 - #349#27;
         |SINO;
             nBClaveE349 = nBClaveE349 + #349#27;
         |FINSI;
     |FINSI;

     |SI #349#6 = "S ";
         nBClaveS349 = nBClaveS349 + #349#22;
     |FINSI;

     |SI #349#6 = "SR";
         nBClaveS349 = nBClaveS349 + #349#22;

         |SI #349#24 = "-";
             nBClaveS349 = nBClaveS349 - #349#27;
         |SINO;
             nBClaveS349 = nBClaveS349 + #349#27;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc349_310;
     #349#1;
     ;
     #4#0, #4#1, nDPeriodo, 349, #4#4, enActividad, "A ", 0000, 00, "            ";
     #4#0, #4#1, nHPeriodo, 349, #4#4, enActividad, "zz", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Calcu349_310;
|FIN;

|PROCESO Mira349_310;
     |SI #95#2 ! "A";
         |SI nMes = 1;  |Y nPerIntra1  = 0;  |ACABA;  |FINSI;
         |SI nMes = 2;  |Y nPerIntra2  = 0;  |ACABA;  |FINSI;
         |SI nMes = 3;  |Y nPerIntra3  = 0;  |ACABA;  |FINSI;
         |SI nMes = 4;  |Y nPerIntra4  = 0;  |ACABA;  |FINSI;
         |SI nMes = 5;  |Y nPerIntra5  = 0;  |ACABA;  |FINSI;
         |SI nMes = 6;  |Y nPerIntra6  = 0;  |ACABA;  |FINSI;
         |SI nMes = 7;  |Y nPerIntra7  = 0;  |ACABA;  |FINSI;
         |SI nMes = 8;  |Y nPerIntra8  = 0;  |ACABA;  |FINSI;
         |SI nMes = 9;  |Y nPerIntra9  = 0;  |ACABA;  |FINSI;
         |SI nMes = 10; |Y nPerIntra10 = 0;  |ACABA;  |FINSI;
         |SI nMes = 11; |Y nPerIntra11 = 0;  |ACABA;  |FINSI;
         |SI nMes = 12; |Y nPerIntra12 = 0;  |ACABA;  |FINSI;

         nPeriodo = nMes + (nMes + 1);

         |SI #95nPeriodo = "X";  |ACABA;  |FINSI;

         |SI #95nPeriodo = "N";
             #95#0 = enEmpresa;
             #95#1 = enEjer;
             |LEE 101#95=;
             |SI FSalida = 0;
                 #95nPeriodo = "S";
                 nPeriodo    = nPeriodo + 1;
                 #95nPeriodo = #95#2;
                 |GRABA 020#95a;
                 |LIBERA #95;
             |FINSI;

             enEmpresaA = #95#0;
             enAnyo     = #95#1;
             |SUB_EJECUTA "dsmoz001";
         |FINSI;
     |FINSI;

     nModelo  = enModelo;
     nPeriodo = enPeriodo;

     |SALVA_DATOS #4;
     |SALVA_DATOS #999;

     #999#0  = enEmpresa;
     #999#1  = enActividad;
     #999#2  = enEjer;
     #999#3  = nMes;
     #999#6  = eaNombreAct;
     #999#7  = 349;
     #999#8  = "S";
     #999#9  = enComplem;
     #999#10 = 310;
     |HAZ Pase349;

     enModelo  = nModelo;
     enPeriodo = nPeriodo;

     |REPON_DATOS #999;
     |REPON_DATOS #4;
|FPRC;

|PROCESO Chequea349_310;
     |SI enEjer [ 2009;  |ACABA;  |FINSI;

     |SI #310#10 = 0;  |Y #310#17 = 0;  |Y #310#15 = 0;  |Y #310#18 = 0;
         |ACABA;
     |FINSI;

     |ABRE #95;
     #95#0 = enEmpresa;
     #95#1 = enEjer;
     |LEE 000#95=;
     |SI FSalida ! 0;
         |CIERRA #95;

         eaTipo349     = "A";
         enTipoEntrada = 96;
         enModelo349   = 310;
         |SUB_EJECUTA_NP "dsmoc349";
     |FINSI;
     |CIERRA #95;

     |ABRE #95;
     #95#0 = enEmpresa;
     #95#1 = enEjer;
     |LEE 000#95=;
     |SI FSalida ! 0;  |CIERRA #95;  |ACABA;  |FINSI;

     |SI #4#22 = "T";
            |SI enPeriodo = 3;
                 nMes = 1;  |HAZ Mira349_310;
                 nMes = 2;  |HAZ Mira349_310;
                 nMes = 3;  |HAZ Mira349_310;

                 nDPeriodo = 1;
                 nHPeriodo = 3;
             |FINSI;

             |SI enPeriodo = 6;
                 nMes = 4;  |HAZ Mira349_310;
                 nMes = 5;  |HAZ Mira349_310;
                 nMes = 6;  |HAZ Mira349_310;

                 nDPeriodo = 4;
                 nHPeriodo = 6;
             |FINSI;

             |SI enPeriodo = 9;
                 nMes = 7;  |HAZ Mira349_310;
                 nMes = 8;  |HAZ Mira349_310;
                 nMes = 9;  |HAZ Mira349_310;

                 nDPeriodo = 7;
                 nHPeriodo = 9;
             |FINSI;

             |SI enPeriodo = 12;
                 nMes = 10;  |HAZ Mira349_310;
                 nMes = 11;  |HAZ Mira349_310;
                 nMes = 12;  |HAZ Mira349_310;

                 nDPeriodo = 10;
                 nHPeriodo = 12;
             |FINSI;
     |FINSI;

     |SI #4#22 = "M";
         nMes = enPeriodo;  |HAZ Mira349_310;

         nDPeriodo = nMes;
         nHPeriodo = nMes;
     |FINSI;

     |CIERRA #95;

     nBClaveA349 = 0;
     nBClaveI349 = 0;
     nBClaveE349 = 0;
     nBClaveS349 = 0;

     |BUCLE dsmoc349_310;

     nBClaveA = #310#10 ! 2;
     nBClaveI = #310#17 ! 2;
     nBClaveE = #310#15 ! 2;
     nBClaveS = #310#18 ! 2;

     nBClaveA349 = nBClaveA349 ! 2;
     nBClaveI349 = nBClaveI349 ! 2;
     nBClaveE349 = nBClaveE349 ! 2;
     nBClaveS349 = nBClaveS349 ! 2;

     |SI nBClaveA ! nBClaveA349;   |O  nBClaveI ! nBClaveI349;
      |O  nBClaveE ! nBClaveE349;  |O  nBClaveS ! nBClaveS349;
          aAlfa = "0000Empresa " + #4#0 + " Periodo " + #4#2 + " Ejercicio "+ #4#1;
          |MENAV aAlfa;

          |MENAV "0000No coinciden los datos del modelo 310 con el modelo 349. Revise los datos.";
     |FINSI;
|FPRC;

|PROCESO Trata87_pase310;
  |ABRE #87;
  |DDEFECTO #87;
  #87#0 = #310#0;
  #87#1 = #310#1;
  #87#2 = #310#2;
  #87#3 = enModelo;
  #87#4 = #310#4;
  #87#5 = #310#5;
  #87#6 = 2;
  #87#7 = 1;
  |LEE 141#87=;
  |SI FSalida ! 0;
      |DDEFECTO #87;
      #87#0 = #310#0;
      #87#1 = #310#1;
      #87#2 = #310#2;
      #87#3 = enModelo;
      #87#4 = #310#4;
      #87#5 = #310#5;
      #87#6 = 2;
      #87#7 = 1;
      |GRABA 020#87b;
  |FINSI;

  #87#16 = #310#13;  #87#17 = (#87#16 % #87#11) ! 2;
  #87#12 = #87#16;
  #87#13 = #87#17;
  #87#14 = #87#12  - #87#13;
  #87#8  = #87#12;
  #87#9  = #87#13;
  #87#10 = #87#8  - #87#9;
  |GRABA 020#87a;
  |LIBERA #87;
  |CIERRA #87;
|FPRC;

|PROCESO dsmoc311_pase;
     |SI nSwOp = 0;
         |PDEFECTO #311, 8, 23;
         |GRABA 020#311a;
     |SINO;
         #310#9  = #310#9  + #dsmoc311#12;

         |SI enPeriodo = 12;
             #310#19 = #310#19 + #dsmoc311#8;
         |FINSI;
     |FINSI;
     |LIBERA #311;
|FPRC;

|DEFBUCLE dsmoc311_pase;
     #dsmoc311#1;
     ;
     #310#0, #310#1, #310#2, #310#3, #310#4, #310#5, 001;
     #310#0, #310#1, #310#2, #310#3, #310#4, #310#5, 999;
     ;
     NULL, dsmoc311_pase;
|FIN;

|PROCESO dsmoc311B;
     |BORRA 020#dsmoc311.a;
     |LIBERA #dsmoc311;
|FPRC;

|DEFBUCLE dsmoc311B;
     #dsmoc311#1;
     ;
     #8#0, #8#1, #8#2, #8#3, #8#4, #8#5, 001;
     #8#0, #8#1, #8#2, #8#3, #8#4, #8#5, 999;
     be;
     NULL, dsmoc311B;
|FIN;

|PROCESO dsmoc311Ceros;
     |SI #dsmoc311#8 = 0;  |Y #dsmoc311#11 = 0;
         |BORRA 020#dsmoc311.a;
         |LIBERA #dsmoc311;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc311Ceros;
     #dsmoc311#1;
     ;
     #8#0, #8#1, #8#2, #8#3, #8#4, #8#5, 001;
     #8#0, #8#1, #8#2, #8#3, #8#4, #8#5, 999;
     be;
     NULL, dsmoc311Ceros;
|FIN;

|PROCESO Pase310;
     |DDEFECTO #8;
     |ABRE #8;
     #8#0 = #999#0;
     #8#1 = #999#2;
     #8#2 = #999#3;
     #8#3 = #999#7;
     #8#4 = #999#9;
     #8#5 = #999#1;
     |LEE 101#8=;
     |SI FSalida = 0;  |Y #8#7 = "REGISTROS ";
         #8#11 = "SIN DATOS";
         |GRABA 020#8a;

         enEmpresa     = #8#0;
         enEjer        = #8#1;
         enPeriodo     = #8#2;
         enModelo      = #8#3;
         enComplem     = #8#4;
         enActividad   = #8#5;
         enTipoEntrada = 97;
         |SUB_EJECUTA_NP "dsmoc310";
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #999#9;
     enActividad   = #999#1;
     enSwOpPar     = 0;

     |ABRE #95;
     #95#0 = enEmpresa;
     #95#1 = enEjer;
     |LEE 000#95=;
     |SI FSalida ! 0;  |DDEFECTO #95;  |FINSI;
     |CIERRA #95;

     nCampo          = 30 + enPeriodo;
     aDesConexion349 = #95nCampo;

     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         aAlfa = #999#2;
         aAlfa = aAlfa % -102;
         nEjer = aAlfa;

         |ABRE #101;
         |SELECT #4#101;
         #101#2  = #999#0;
         #101#26 = nEjer;
         |LEE 040#101=;
         |SI FSalida ! 0;  |CIERRA #101;  |ACABA;   |FINSI;
         |CIERRA #101;

         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";

         enEmpresa  = #101#2;
         enPerConta = #101#3;
         eaLaMonEmp = #101#28;
     |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
     |FINSI;
     |HAZ EnConversor;

     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;
     |PATH_DAT #105 aPathConta;

     |ABRE #104;
     |LEE 040#104p;
     |SI FSalida ! 0;  |DDEFECTO #104;  |FINSI;
     |CIERRA #104;
     aMulDep = #104#132;

     |SI #104#46 = "T";
         |SI enEjer [ 2009;
             |SI enPeriodo = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI enPeriodo = 2;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI enPeriodo = 3;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI enPeriodo = 4;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI enPeriodo = 5;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI enPeriodo = 6;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI enPeriodo = 7;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 8;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 9;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 10;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI enPeriodo = 11;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI enPeriodo = 12;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SINO;
             |SI enPeriodo = 1;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 2;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 4;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI enPeriodo = 5;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI enPeriodo = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI enPeriodo = 7;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI enPeriodo = 8;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI enPeriodo = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI enPeriodo = 10;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
             |SI enPeriodo = 11;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
             |SI enPeriodo = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
         |FINSI;
     |SINO;
         |SI enPeriodo = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
         |SI enPeriodo = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
         |SI enPeriodo = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI enPeriodo = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SI enPeriodo = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
         |SI enPeriodo = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
         |SI enPeriodo = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
         |SI enPeriodo = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
         |SI enPeriodo = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
         |SI enPeriodo = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
         |SI enPeriodo = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
         |SI enPeriodo = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
     |FINSI;

     nPerIntra1  = 0;
     nPerIntra2  = 0;
     nPerIntra3  = 0;
     nPerIntra4  = 0;
     nPerIntra5  = 0;
     nPerIntra6  = 0;
     nPerIntra7  = 0;
     nPerIntra8  = 0;
     nPerIntra9  = 0;
     nPerIntra10 = 0;
     nPerIntra11 = 0;
     nPerIntra12 = 0;

     |ABRE #30;
     |ABRE #dsmom069;

     |ABRE #dsmom133;
     |LEE 000#dsmom133.p;
     |SI FSalida ! 0;
         |CIERRA #dsmom133;

         eaExtension = "mod";
         eaPrograma  = "dsmom033";
         |SUB_EJECUTA_NP ":basica/dspatron";

         eaExtension = "mod";
         eaPrograma  = "dsmom133";
         |SUB_EJECUTA_NP ":basica/dspatron";
     |FINSI;
     |CIERRA #dsmom133;

     |ABRE #33;
     |ABRE #dsmom133;
     |ABRE #310;
     #310#0 = enEmpresa;
     #310#1 = enEjer;
     #310#2 = enPeriodo;
     #310#3 = enModelo;
     #310#4 = enComplem;
     #310#5 = enActividad;
     |LEE 101#310=;
     |SI FSalida ! 0;
         |DDEFECTO #310;
         #310#0 = enEmpresa;
         #310#1 = enEjer;
         #310#2 = enPeriodo;
         #310#3 = enModelo;
         #310#4 = enComplem;
         #310#5 = enActividad;
         |HAZ leeActividad;
         |GRABA 020#310b;

         |BUCLE dsmoc311B;
     |SINO;
         #310#10 = 0;
         #310#11 = 0;
         #310#12 = 0;
         #310#13 = 0;
         #310#14 = 0;
         #310#15 = 0;
         #310#17 = 0;
         #310#18 = 0;
         #310#19 = 0;

         |BUCLE dsmoc311B;
     |FINSI;

     |SI enEjer ] 2010;  |Y enEjer [ 2013;
         |SI enPeriodo = 12; |Y #8#7 = "REGISTROS ";
             nSwOp = 0;
             |BUCLE dsmoc311_pase;
         |FINSI;
     |FINSI;

     |SI enEjer ] 2014;
         nSwOp = 0;
         |BUCLE dsmoc311_pase;
     |FINSI;

     nCuotaSopor = 0;
     nIngresos   = 0;
     |BUCLE camaniva310;
     |SI nSwPasa1 = 1;
         |SI enEjer [ 2013;
             |SI enPeriodo = 12;
                  |SI #8#7 = "REGISTROS ";
                     nCuotaSopor = nCuotaSopor + (#310#9 % 1);
                     #310#9      = #310#9 - nCuotaSopor;
                     #310#19     = nIngresos;
                     |SI enEjer ] 2010;
                         #310#9  = 0;
                         #310#19 = 0;
                         nSwOp   = 1;
                         |BUCLE dsmoc311_pase;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI enEjer ] 2014; |Y #310#8 = "S";
             #310#9  = 0;
             #310#19 = 0;
             nSwOp   = 1;
             |BUCLE dsmoc311_pase;
         |FINSI;

         #310#14     = 0;
         |HAZ Amortizacion;

         |GRABA 020#310a;
     |FINSI;
     |LIBERA #310;
     |CIERRA #30;
     |CIERRA #33;
     |CIERRA #dsmom069;
     |CIERRA #dsmom133;

     |SI enSwPartido = 1;
         enSwOpPar   = 1;
         |HAZ FinalPartido;
     |FINSI;

     |SI #999#3 ! 1;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc310.mas";  |CARGA_DEF aDef, espejo1@;
         aDef = aPathModelo + "def/dsmoc311.mas";  |CARGA_DEF aDef, espejo2@;

         |ABRE #dsmoc311;
         |SI FSalida = 0;
             |PARA nPeriodo = 1;  |SI nPeriodo < #999#3;  |HACIENDO nPeriodo = nPeriodo + 1;
                   |BUCLE dsmoc310;

                   |SI enEjer ] 2014;
                       |SI enPeriodo ! 12;
                           |BUCLE dsmoc311C;
                       |FINSI;
                   |FINSI;
             |SIGUE;
         |FINSI;
         |CIERRA #dsmoc311;

         |DESCARGA_DEF #espejo2@;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     |CIERRA #310;

     |SI enEjer ] 2014;
         |BUCLE dsmoc311Ceros;
     |FINSI;

     |SI enEjer > 2010; |Y #999#7 = 370; |Y enSwProrr ! 2;
         |HAZ Trata87_pase310;
     |FINSI;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #999#9;
     enActividad   = #999#1;
     enTipoEntrada = 98
     |SUB_EJECUTA_NP "dsmoc310";

     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = 0;
     |LEE 101#4=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;

     |SI aDesConexion349 = "N";
        |HAZ Chequea349_310;
     |FINSI;

     |SI #4#7 = "X"; |Y enSwCheqPase = 1;
         enSaldo1Ch = #310#13;
         enSaldo2Ch = 0;
         |ABRE #19;
         #19#0 = enEmpresa;
         #19#1 = enEjer;
         #19#2 = enComplem;
         #19#3 = enActividad;
         |LEE 101#19=;
         |SI FSalida = 0;
             enSaldo1Ch = enSaldo1Ch + #19#134;
         |FINSI;
         |CIERRA #19;
         enOperaCh  = 1;
         |HAZ GrabaAux151;
     |FINSI;
|FPRC;
