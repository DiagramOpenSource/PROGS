|FICHEROS;
     dsmom060;
     dsmom061;
     dsmom100;
     :/contagen/def/cacuenta;

     dsmom160;
     dsmom161;
     dsmom162;
     dsmoz052;
     dsmow178;
|FIN;

|VARIABLES;
    aParam = "";
    inkey  = 0;
    nInkey = 0;
    aAlfa1 = "";
    nOpe   = 0;
    nSw    = 0;
    nPlan  = 0;
    &enModificar = 0;
    &SwLinea = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|| ******************************************** Calculos Pantalla
|PROCESO ImpDsmom061;
   |SI SwLinea = 0;
       SwLinea = 1;
   |FINSI;

   |PRINT;
   SwLinea = 2;
|FPRC;

|DEFBUCLE ImpDsmom061;
   #dsmom061#1;
   ;
   #dsmom060#6, #dsmom060#0, #dsmom060#1, #dsmom060#2, 001;
   #dsmom060#6, #dsmom060#0, #dsmom060#1, #dsmom060#2, 999;
   e;
   NULL, ImpDsmom061;
|FIN;

|PROCESO ImpDsmom060;
   SwLinea = 0;
   |BUCLE ImpDsmom061;
   |SI SwLinea = 0;
       |PRINT;
   |FINSI;
   SwLinea = 3; |PRINT;
   nSw = 1;
|FPRC;

|DEFBUCLE ImpDsmom060;
   #dsmom060#1;
   ;
   #dsmoz052#4, #dsmoz052#0, #dsmoz052#1,  01;
   #dsmoz052#4, #dsmoz052#0, #dsmoz052#1,  99;
   e;
   NULL, ImpDsmom060;
|FIN;

|PROCESO ElInforme;
   |IMPRE 0;
   |SI FSalida ! 0;
       |MENAV "0000Proceso interrumpido";
       |ACABA;
   |FINSI;

   |INFOR "dsmom060";
   |SI FSalida ! 0;
       |MENAV "0000No existe informe. Proceso interrumpido";
       |FINIMP;
       |ACABA;
   |FINSI;

   nSw     = 0;
   SwLinea = 0;
   #dsmoz052#1 = "I";
   #dsmoz052#3 = "INGRESOS"; |BUCLE ImpDsmom060;
   |SI nSw = 1; |PIEINF; |FINSI;

   nSw   = 0;
   SwLinea = 0;
   #dsmoz052#1 = "G";
   #dsmoz052#3 = "GASTOS "; |BUCLE ImpDsmom060;
   |SI nSw = 1; |PIEINF; |FINSI;

   |FININF;
   |FINIMP;
|FPRC;

|PROCESO LeoDsmom160;
   |SI nOpe = 1;
       |BORRA 020#dsmom160.a;
   |FINSI;
   |SI nOpe = 0;
       #dsmom160#0 = #dsmoz052#4;
       |GRABA 040#dsmom160.n;
   |FINSI;
   |LIBERA #dsmom160;
|FPRC;

|DEFBUCLE LeoDsmom160;
   #dsmom160#1;
   ;
   nPlan, " ", " ", 01;
   nPlan, "z", "z", 99;
   be;
   NULL, LeoDsmom160;
|FIN;

|PROCESO LeoDsmom161;
   |SI nOpe = 1;
       |BORRA 020#dsmom161.a;
   |FINSI;
   |SI nOpe = 0;
       #dsmom161#0 = #dsmoz052#4;
       |GRABA 040#dsmom161.n;
   |FINSI;
   |LIBERA #dsmom161;
|FPRC;

|DEFBUCLE LeoDsmom161;
   #dsmom161#1;
   ;
   nPlan, " ", " ", 01, 001;
   nPlan, "z", "z", 99, 999;
   be;
   NULL, LeoDsmom161;
|FIN;

|PROCESO LeoDsmom060;
   |SI nOpe = 1;
       |BORRA 020#dsmom060.a;
   |FINSI;
   |SI nOpe = 0;
       #dsmom060#6 = #dsmoz052#4;
       |GRABA 040#dsmom060.n;
   |FINSI;
   |LIBERA #dsmom060;
|FPRC;

|DEFBUCLE LeoDsmom060;
   #dsmom060#1;
   ;
   nPlan, " ", " ", 01;
   nPlan, "z", "z", 99;
   be;
   NULL, LeoDsmom060;
|FIN;

|PROCESO LeoDsmom061;
   |SI nOpe = 1;
       |BORRA 020#dsmom061.a;
   |FINSI;
   |SI nOpe = 0;
       #dsmom061#6 = #dsmoz052#4;
       |GRABA 040#dsmom061.n;
   |FINSI;
   |LIBERA #dsmom061;
|FPRC;

|DEFBUCLE LeoDsmom061;
   #dsmom061#1;
   ;
   nPlan, " ", " ", 01, 001;
   nPlan, "z", "z", 99, 999;
   be;
   NULL, LeoDsmom061;
|FIN;

|PROCESO CopiarEAnt;

   nOpe = 1; nPlan = #dsmoz052#4; |BUCLE LeoDsmom060;
   nOpe = 0; nPlan = enPlan60;    |BUCLE LeoDsmom060;

   nOpe = 1; nPlan = #dsmoz052#4; |BUCLE LeoDsmom061;
   nOpe = 0; nPlan = enPlan60;    |BUCLE LeoDsmom061;

   nSw = 0;
   |ABRE #dsmom160;
   #dsmom160#0  = #dsmoz052#4;
   #dsmom160#1  = #dsmoz052#0;
   #dsmom160#2  = " ";
   #dsmom160#3 =  00;
   |LEE 040#dsmom160.];
   |SI FSalida ! 0; |O #dsmom160#0 ! #dsmoz052#4;
       nSw = 2;
   |FINSI;
   |CIERRA #dsmom160;
   |SI nSw = 2;
       nOpe = 1; nPlan = #dsmoz052#4; |BUCLE LeoDsmom160;
       nOpe = 0; nPlan = enPlan60;    |BUCLE LeoDsmom160;

       nOpe = 1; nPlan = #dsmoz052#4; |BUCLE LeoDsmom161;
       nOpe = 0; nPlan = enPlan60;    |BUCLE LeoDsmom161;
   |FINSI;

   |ABRE #dsmom162;
   |DDEFECTO #dsmom162;
   #dsmom162#0 = #dsmoz052#4;
   |LEE 041#dsmom162.=;
   |SI FSalida ! 0;
       |DDEFECTO #dsmom162;
       #dsmom162#0 = enPlan60;
       |LEE 041#dsmom162.=;
       |SI FSalida = 0;
           #dsmom162#0 = #dsmoz052#4;
           |GRABA 041#dsmom162.n;
       |FINSI;
   |FINSI;
   |CIERRA #dsmom162;
|FPRC;

|PROCESO LaBaja;
    nOpe = 1; nPlan = #dsmoz052#4; |BUCLE LeoDsmom060;
    nOpe = 1; nPlan = #dsmoz052#4; |BUCLE LeoDsmom061;
|FPRC;

|CALCULO wTipo7C4; |TIPO 7;
   aAlfa1 = "0000Pulse F2 para consultar ejercicios creados, F3 Informe";
   |SI enModificar = 1;
       aAlfa1 = aAlfa1 + ", F8 baja ejercicio";
   |FINSI;
   |MENSA aAlfa1;
|FCAL;

|CALCULO wTipo0C4; |TIPO 0;
   |BLIN 4;
   |C_M #dsmoz052#4,0,aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   nInkey = FSalida;
   |SI nInkey = 10;
       |ABRE #dsmow178;
       #dsmow178#0 = #dsmoz052#4;
       |CONSULTA_CLAVE #1#dsmow178;
       #dsmoz052#4 = #dsmow178#0;
       |PINTA #dsmoz052#4;
       |CIERRA #dsmow178;
   |FINSI;

   |SI nInkey = 16; |Y enModificar = 1;
       |CONFI "0000NEsta seguro de borrar todo el Ejercicio";
       |SI FSalida = 0;
           |HAZ LaBaja;
           |ERROR;
           |ACABA;
       |FINSI;
   |FINSI;

   |C_M #dsmom060#4, 1, "N"; |C_V #dsmom060#4, 1, "N";
   |C_M #dsmom060#5, 1, "N"; |C_V #dsmom060#5, 1, "N";

   |SI #dsmoz052#4 < 2019; |Y #dsmoz052#0 = "N";
       |PINTA 0732, "ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿";
       |PINTA 0832, "ÙDesc.columnas en libro                         ³";
       |C_M #dsmom060#4, 1, "S"; |C_V #dsmom060#4, 1, "S";
       |C_M #dsmom060#5, 1, "S"; |C_V #dsmom060#5, 1, "S";
   |FINSI;

   nSw = 0;
   |ABRE #dsmom060;
   #dsmom060#6 = #dsmoz052#4;
   #dsmom060#0 = #dsmoz052#0;
   #dsmom060#1 = " ";
   #dsmom060#2 = 01;
   |LEE 040#dsmom060.];
   |SI FSalida ! 0; |O #dsmom060#6 ! #dsmoz052#4;
       nSw = 1;
       |SI enModificar = 1;
           |CONFI "0000SNo existe Ejercicio. Recoger Anterior";
           |SI FSalida = 0;
               nSw = 2;
           |FINSI;
       |SINO;
           |MENAV "0000No existe Ejercicio. ";
           |ERROR;
           |CIERRA #dsmom060;
           |ACABA;
       |FINSI;
   |FINSI;
   |CIERRA #dsmom060;

   |SI nSw = 2;
       |HAZ CopiarEAnt;
   |FINSI;

   |ABRE #dsmom162;
   |DDEFECTO #dsmom162;
   #dsmom162#0 = #dsmoz052#4;
   |LEE 041#dsmom162.=;
   |CIERRA #dsmom162;

   |SI nInkey = 11;
       |CONFI "0000SImprimir estructura";
       |SI FSalida = 0;
           |HAZ ElInforme;
           |ERROR;
       |FINSI;
   |FINSI;
|FCAL;

|CALCULO wTipo12; |TIPO 12;
|FCAL;

|CALCULO descri;  |TIPO 0;
  inkey = FSalida;
  |SI inkey = 1;
      inkey =  -1;
  |FINSI;
  |SI #dsmoz052#1 = "I"; #dsmoz052#3 = "INGRESOS";  |FINSI;
  |SI #dsmoz052#1 = "G"; #dsmoz052#3 = "GASTOS "; |FINSI;
  |PINTA #dsmoz052#3;
|FCAL;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|RUTINA min;
  #dsmom060#6 = enPlan;
  #dsmom060#0 = #dsmoz052#0;
  #dsmom060#1 = #dsmoz052#1;
  #dsmom060#2 = 01;
|FRUT;

|RUTINA max;
  #dsmom060#6 = enPlan;
  #dsmom060#0 = #dsmoz052#0;
  #dsmom060#1 = #dsmoz052#1;
  #dsmom060#2 = 99;
|FRUT;

|PROCESO Tipo3;  |TIPO 3;
  enPlan = #dsmoz052#4;
  |ENTLINEAL #1#dsmom060, -4, 2, 22, 0, min, max;
|FPRC;

|PROCESO LaContab;
   |ABRE #dsmom100;
   |LEE 040#dsmom100.p;
   |SI FSalida ! 0;
       |CIERRA #dsmom100;
       |MENAV "    No esta configurada las Empresas Maestras de Contabilidad";
       swerror = 1;
       |ACABA;
   |FINSI;
   |CIERRA #dsmom100;

   enEmpresa  = #dsmom100#1;
   enPerConta = #dsmom100#2;
   |HAZ LeeEmpConta;
   |PATH_DAT #cacuenta#aPathConta#;
|FPRC;

|PROGRAMA;
   eaPlanilla = "dsmom060";  |HAZ PlanDePlanillas;

   aParam = PARAMETRO; |QBF aParam;
   |SI aParam = "";  aParam = "N";  |FINSI;

   enModificar = 0;
   |SI aParam = "s"; |O aParam = "n"; enModificar = 1; |FINSI;
   aParam = aParam > " ";

   |DDEFECTO #dsmoz052;
   #dsmoz052#0 = aParam;
   |SI #dsmoz052#0 = "N"; #dsmoz052#2 = "Rendimientos de Actividades Economicas en Regimen de E.D.Normal y Sim."; |FINSI;
   |SI #dsmoz052#0 = "S"; #dsmoz052#2 = "Rendimientos procedentes de las Ventas del Inmovilizado Empresarial";  |FINSI;

   enEjer = 2999;
   |HAZ Verm060Plan;
   |SI enPlan60 = 0; |ACABA; |FINSI;
   |HAZ LaContab;

   enCreaFAnyo = 1;
   |HAZ eCreaFAnyo;
   |NOME_DAT #dsmow178#eaNFw178#;

   |CLS;
   |CABEZA "Imputacion Cuentas";
   |PINPA #0#dsmoz052;

   #dsmoz052#4 = enPlan60;
   |PINDA #0#dsmoz052;

|ET PideAnyo;
  |C_M #dsmoz052#4, 1, "S";
  |ENCAMPO #4#dsmoz052;
  |SI FSalida = 1; |O FSalida = 7; |ACABA; |FINSI;
  |C_M #dsmoz052#4, 1, "N";

  |SI enModificar = 1;
      |C_M #dsmom060#3,1, "S";
      |C_M #dsmom060#4,1, "S";
      |C_M #dsmom060#5,1, "S";
      |C_M #dsmom060#7,1, "S";
  |FINSI;

  FSalida = 1;
  |PARA; |SI 0 < FSalida; |HACIENDO;

         |ENDATOS #1#dsmoz052;
         |SI 0 [ FSalida;
               |SI inkey = -1; |SAL; |FINSI;
               |HAZ Tipo3;
               FSalida = 1;
         |FINSI;
         |SI enPlan60 < #dsmoz052#4; enPlan60 = #dsmoz052#4; |FINSI;
  |SIGUE;
  |VETE PideAnyo;
|FPRO;
