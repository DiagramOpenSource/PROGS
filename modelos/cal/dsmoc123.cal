|FICHEROS;
     dsmoc123;
     dsmom002 #2;
     dsmod123;
     dsmom004;
     dsmom008;

     dsmom038;

     dsmod123@;

     &regisnif@;
|FIN;

|VARIABLES;
     nGrupo        = 0;
     i             = 0;
     nMod          = 123;
     aDn           = "            ";
     aHn           = "zzzzzzzzzzzz";
     nDd           = 0;
     nHd           = 9999;
     aTipoCaptura  ="";
     nSwEsta       = 0;
     nEjerAnt      = 0;
     nPer          = 0;
     nSwGraba      = 0;
     nTipo         = 0;
     nIngre        = 0;
     nPeriodo      = 0;
     nEl8          = 0;
     nHComple      = 0;

     aPeriodo      = "";
     aPathModelo   = "";
     aDef          = "";
     aAlfa         = "";
     aAlfa1        = "";
     aAlfa2        = "";
     aPeriodicidad = "";
     aDNIAnt       = "";
     aBase         = "";
     aMas          = "";
     nNume         = 0;
     fFecha        = @;
     fDFecha       = @;
     fHFecha       = @;
|FIN;

|INCLUYE i_variar;

|PROCESO PonNombre;  |TIPO 7;
     aAlfa = #dsmoc123#21;  |QBF aAlfa;
     |SI aAlfa = "";
         eaCodNif = #dsmoc123#6;
         |HAZ LeeNifs;
         #dsmoc123#21 = #regisnif@#1;
         |PINTA #dsmoc123#21;
     |FINSI;
|FPRC;

|PROCESO Tipo66_C8; |TIPO 66;
      |ABRE #dsmom038;
      |CONSULTA_CLAVE #1#dsmom038;
      #dsmoc123#8 = #dsmom038#0; |PINTA #dsmoc123#8;
      #dsmoc123#9 = #dsmom038#1; |PINTA #dsmoc123#9;
      |CIERRA #dsmom038;
      |ERROR;
|FPRC;


|PROCESO Naturaleza;
     |ABRE #dsmom038;
     #dsmom038#0 = #dsmoc123#8;
     aAlfa = #dsmoc123#9; aAlfa = ("00" + aAlfa) % -102;
     #dsmom038#1 = aAlfa;
     |LEE 041#dsmom038.=;
     |SI FSalida ! 0;
         |CIERRA #dsmom038;
         |MENAV "    No existe Clave IRPF";
         |ERROR;
         |ACABA;
     |FINSI;
     |CIERRA #dsmom038;

     |SI #dsmoc123#8 = "A";
         |SI #dsmoc123#9 > 8;
             |MENAV "     Codigo de Naturaleza erroneo. Parametro del 1 al 8";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI #dsmoc123#8 = "B";
         |SI #dsmoc123#9 > 7;
             |MENAV "     Codigo de Naturaleza erroneo. Parametro del 1 al 7";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI #dsmoc123#8 = "C";
         |SI #dsmoc123#1 [ 2016;  |Y #dsmoc123#9 ] 12;
             |MENAV "0000Naturaleza a partir del 2017";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI #dsmoc123#8 = "D";
         |SI #dsmoc123#9 > 7;
             |MENAV "     Codigo de Naturaleza erroneo. Parametro del 1 al 7";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO TotRetencion;
     |SI #dsmoc123#Campo# = Contenido;  |ACABA;  |FINSI;

     |SI Campo = 11;  |O Campo = 12;
         #dsmoc123#13 = #dsmoc123#11 % #dsmoc123#12;  |PINTA #dsmoc123#13;
     |FINSI;

     |SI Campo = 14;  |O Campo = 15;
         #dsmoc123#16 = #dsmoc123#14 % #dsmoc123#15;  |PINTA #dsmoc123#16;
     |FINSI;

     |SI Campo = 17;  |O Campo = 18;
         #dsmoc123#19 = #dsmoc123#17 % #dsmoc123#18;  |PINTA #dsmoc123#19;
     |FINSI;
|FPRC;

|PROCESO dsmom002;              || Comprobamos todas las fechas

     aAlfa   = "31.12." + enEjer;  fHFecha = aAlfa;
     aAlfa   = "01.01." + enEjer;  fDFecha = aAlfa;

     aAlfa   = #2#8 % -104;
     |SI aAlfa ! "0000";
         nNume = aAlfa;
         |SI nNume > enEjer; |ACABA; |FINSI;

         |SI #2#8 > fDFecha; fDFecha = #2#8; |FINSI;
     |FINSI;

     aAlfa   = #2#9 % -104;
     |SI aAlfa ! "0000";
         nNume   = aAlfa;
         |SI nNume < enEjer;  |ACABA;  |FINSI;

         |SI #2#9 < fHFecha;  fHFecha = #2#9;  |FINSI;
     |FINSI;

     aAlfa2 = enPeriodo;
     aAlfa2 = ("00" + aAlfa2) % -102;
     aAlfa  = "31.";
     |SI enPeriodo = 4; |O enPeriodo = 6; |O enPeriodo = 9; |O enPeriodo = 11;
         aAlfa = "30.";
     |FINSI;
     |SI enPeriodo = 2;
         aAlfa = "28."; |SI enEjer = 2000; |O enEjer = 2004; |O enEjer = 2008;
                            |O enEjer = 2012; |O enEjer = 2016; |O enEjer = 2020;
                               aAlfa = "29.";
                        |FINSI;
     |FINSI;
     aAlfa2 = aAlfa + aAlfa2 + "." + enEjer;

     |SI #2#7 = "TRIMESTRAL";
         |SI enPeriodo = 3;  aAlfa1 = "01.01." + enEjer;  |FINSI;
         |SI enPeriodo = 6;  aAlfa1 = "01.04." + enEjer;  |FINSI;
         |SI enPeriodo = 9;  aAlfa1 = "01.07." + enEjer;  |FINSI;
         |SI enPeriodo = 12; aAlfa1 = "01.10." + enEjer;  |FINSI;
     |FINSI;

     |SI #2#7 = "MENSUAL   ";
         aAlfa1 = enPeriodo;  aAlfa1 = ("00" + aAlfa1) % -102;
         aAlfa1 = "01." + aAlfa1 + "." + enEjer;
     |FINSI;

     |SI #2#7 = "ANUAL     ";
         aAlfa1 = "01.01." + enEjer;
         aAlfa2 = "31.12." + enEjer;
     |FINSI;

     fFecha = aAlfa1;
     |SI fHFecha < fFecha;  |ACABA;  |FINSI;

     fFecha = aAlfa2;
     |SI fDFecha > fFecha;  |ACABA;  |FINSI;

     aPeriodicidad=#2#7; |QBF aPeriodicidad;
|FPRC;

|DEFBUCLE dsmom002;
     #2#1;
     ;
     enEmpresa, 01, enModelo;
     enEmpresa, 98, enModelo;
     ;
     NULL, dsmom002;
|FIN;

|PROCESO Modificables; |TIPO 7;
     aPeriodicidad = "TRIMESTRAL";
     |BUCLE dsmom002;

     |SI aPeriodicidad ! "TRIMESTRAL";
          |PARA i = 14;|SI i [ 19; |HACIENDO i = i + 1;
               |CAMPO_MODIFICA #dsmoc123#i#,1,"N";
               #dsmoc123#i# = 0;  |PINTA #dsmoc123#i#;
          |SIGUE;
     |FINSI;

     |SI enEjer [ 2015;
         |C_M #dsmoc123#20, 1, "S";
         |SI #dsmoc123#7 = 0;  |Y #dsmoc123#6 ! "PASEANTERIOR";  |Y #dsmoc123#6 ! "MANUAL      ";
             |C_M #dsmoc123#20, 1, "N";
             #dsmoc123#20 = 0;  |PINTA #dsmoc123#20;
         |FINSI;
     |FINSI;

     |SI #dsmoc123#6 ! "PASEANTERIOR";  |Y #dsmoc123#6 ! "MANUAL      ";
         |C_M #dsmoc123#22, 1, "N";  |C_V #dsmoc123#22, 1, "N";
     |SINO;
         |C_M #dsmoc123#22, 1, "S";  |C_V #dsmoc123#22, 1, "S";

         |PARA i = 14;|SI i [ 19; |HACIENDO i = i + 1;
               |CAMPO_MODIFICA #dsmoc123#i#,1,"N";
               #dsmoc123#i# = 0;  |PINTA #dsmoc123#i#;
         |SIGUE;
     |FINSI;

     |PINTA #dsmoc123#22;
|FPRC;

|PROCESO Version2016;
     |C_V #dsmoc123#20, 1, "N";
     |C_M #dsmoc123#20, 1, "N";

     |SI enEjer [ 2015;
         |C_V #dsmoc123#20, 1, "S";
         |C_M #dsmoc123#20, 1, "S";
         |PINTA #dsmoc123#20;
         |ACABA;
     |FINSI;

     |PINTA 1631, "                                ";
|FPRC;

|PROCESO Tipo7;  |TIPO 7;
     |HAZ Version2016;

     |SI #dsmoc123#6 ! "PASEANTERIOR";  |Y #dsmoc123#6 ! "MANUAL      ";
         |C_M #dsmoc123#22, 1, "N";  |C_V #dsmoc123#22, 1, "N";
     |SINO;
         |C_M #dsmoc123#22, 1, "S";  |C_V #dsmoc123#22, 1, "S";
     |FINSI;

     |PINTA #dsmoc123#22;
|FPRC;

|PROCESO Dnimoc123;  |TIPO 11;
     |SI FSalida = 10;
         eaVarDni  = #dsmoc123#Campo#;
         enCalcCif = 1;
         |HAZ CalculameDNI;
         #dsmoc123#Campo# = eaVarDni;
         |PINTA #dsmoc123#Campo#;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO MiraDnimoc123;  |TIPO 6;
     eaVarDni  = #dsmoc123#Campo#;
     enCalcCif = 0;
     |HAZ CalculameDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #dsmoc123#Campo# ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #dsmoc123#Campo# = eaVarDni;  |PINTA #dsmoc123#Campo#;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsmod123Otros;
     #dsmod123#14 = #dsmod123#14 + #dsmod123@#11;
|FPRC;

|DEFBUCLE dsmod123Otros;
     #dsmod123@#1006;
     ;
     #dsmod123#0, #dsmod123#1, #dsmod123#2, #dsmod123#3,        0, #dsmod123#5;
     #dsmod123#0, #dsmod123#1, #dsmod123#2, #dsmod123#3, nHComple, #dsmod123#5;
     ;
     NULL, dsmod123Otros;
|FIN;

|PROCESO CapturaOtros123;
     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsmod123.mas";
     |CARGA_DEF aMas, dsmod123@;

     nHComple = #dsmod123#4 - 1;
     #dsmod123#14    = 0;

     |BUCLE dsmod123Otros;

     |DESCARGA_DEF #dsmod123@;
|FPRC;

|PROCESO GrabaModelo;
     nSwGraba = 1;

     |SI #dsmoc123#6 ! "            ";
         |SI #dsmoc123#6 ! "PASEANTERIOR";  |Y #dsmoc123#6 ! "MANUAL      ";
             #dsmod123#6 = #dsmod123#6 + 1;
         |FINSI;

         |SI #dsmoc123#6 = "PASEANTERIOR";  |O #dsmoc123#6 = "MANUAL      ";
             #dsmod123#6 = #dsmoc123#22;
         |FINSI;
     |FINSI;

     #dsmod123#7  = #dsmod123#7 + #dsmoc123#11 + #dsmoc123#14 + #dsmoc123#17;
     #dsmod123#8  = #dsmod123#8 + #dsmoc123#13 + #dsmoc123#16 + #dsmoc123#19;
     #dsmod123#9  = #dsmod123#9 + #dsmoc123#20;
     #dsmod123#12 = nIngre + #dsmod123#8;
     #dsmod123#10 = #dsmod123#9 - #dsmod123#12;
     |SI #dsmod123#10 < 0;  #dsmod123#10 = 0;  |FINSI;

     |SI #dsmod123#1 [ 2007;
         #dsmod123#11 = #dsmod123#8 + #dsmod123#10;
         #dsmod123#13 = 0;
         #dsmod123#14 = 0;
     |SINO;
         #dsmod123#13 = #dsmod123#8 + #dsmod123#10;
         #dsmod123#14 = 0;

         |SI #dsmod123#4 > 0;
             |HAZ CapturaOtros123;
         |FINSI;

         #dsmod123#11 = #dsmod123#13 - #dsmod123#14;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc123;
     #dsmoc123#1;
     ;
     enEmpresa, enEjer, enPeriodo, nMod, enComplem, 01, aDn, nDd, " ", 00, 1;
     enEmpresa, enEjer, enPeriodo, nMod, enComplem, 99, aHn, nHd, "z", 99, 2;
     be;
     NULL, GrabaModelo;
|FIN;

|PROCESO GrabaRegistro0;
     |SI enModelo = 123;
         |ABRE #dsmod123;
         #dsmod123#0 = enEmpresa;
         #dsmod123#1 = enEjer;
         #dsmod123#2 = enPeriodo;
         #dsmod123#3 = enModelo;
         #dsmod123#4 = enComplem;
         #dsmod123#5 = 0;
         |LEE 101#dsmod123.=;
         |SI FSalida = 0;
             |BORRA 020#dsmod123.a;
         |FINSI;
         |LIBERA #dsmod123;
     |FINSI;

     |ABRE #dsmom008;
     #dsmom008#0 = enEmpresa;
     #dsmom008#1 = enEjer;
     #dsmom008#2 = enPeriodo;
     #dsmom008#3 = enModelo;
     #dsmom008#4 = enComplem;
     #dsmom008#5 = 0;
     |LEE 101#dsmom008.=;
     |SI FSalida = 0;
         #dsmom008#11 = "SIN DATOS ";
         |GRABA 020#dsmom008.a;
     |FINSI;
     |LIBERA #dsmom008;
     |CIERRA #dsmom008;
|FPRC;

|PROCESO BajaModelo;
     |BORRA 020#dsmoc123.a;
     |LIBERA #dsmoc123;
|FPRC;

|DEFBUCLE dsmoc123B;
     #dsmoc123#1;
     ;
     enEmpresa, enEjer, enPeriodo, nMod, enComplem, 01, aDn, nDd, " ", 00, 1;
     enEmpresa, enEjer, enPeriodo, nMod, enComplem, 99, aHn, nHd, "z", 99, 2;
     be;
     NULL, BajaModelo;
|FIN;

|PROCESO BorraRegistros;
     |BUCLE dsmoc123B;
     |HAZ GrabaRegistro0;

     |ABRE #dsmom008;
     #dsmom008#0 = enEmpresa;
     #dsmom008#1 = enEjer;
     #dsmom008#2 = nPer;
     #dsmom008#3 = 123;
     #dsmom008#4 = enComplem;
     #dsmom008#5 = enActividad;
     |LEE 101#dsmom008.=;
     |SI FSalida = 0;
         #dsmom008#11 = "SIN DATOS";
         |GRABA 020#dsmom008.a;
     |FINSI;
     |LIBERA #dsmom008;
     |CIERRA #dsmom008;
|FPRC;

|PROCESO BuscaIngresos;
     nIngre    = 0;

     |ABRE #2;
     #2#0 = enEmpresa;
     #2#1 = enActividad;
     #2#2 = enModelo;
     |LEE 000#2.=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     aPeriodo  = "T";
     |SI #2#7 = "MENSUAL   ";  aPeriodo = "M";  |FINSI;

     |SI aPeriodo = "T";
         |SI enPeriodo ! 3;
             |PARA nPeriodo = 3;  |SI nPeriodo < enPeriodo;  |HACIENDO nPeriodo = nPeriodo + 3;
                   #dsmod123#0 = enEmpresa;
                   #dsmod123#1 = enEjer;
                   #dsmod123#2 = nPeriodo
                   #dsmod123#3 = enModelo;
                   #dsmod123#4 = enComplem;
                   #dsmod123#5 = enActividad;
                   |LEE 040#dsmod123.=;
                   |SI FSalida = 0;
                       |SI #dsmod123#11 > 0;
                           nIngre = nIngre + #dsmod123#8;
                       |FINSI;
                   |FINSI;
              |SIGUE;
         |FINSI;
     |SINO;
         |SI enPeriodo ! 1;
             |PARA nPeriodo = 1;  |SI nPeriodo < enPeriodo;  |HACIENDO nPeriodo = nPeriodo + 1;
                   #dsmod123#0 = enEmpresa;
                   #dsmod123#1 = enEjer;
                   #dsmod123#2 = nPeriodo
                   #dsmod123#3 = enModelo;
                   #dsmod123#4 = enComplem;
                   #dsmod123#5 = enActividad;
                   |LEE 040#dsmod123.=;
                   |SI FSalida = 0;
                       |SI #dsmod123#11 > 0;
                           nIngre = nIngre + #dsmod123#8;
                       |FINSI;
                   |FINSI;
              |SIGUE;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaTodo;
     |ABRE #dsmod123;
     #dsmod123#0 = enEmpresa;
     #dsmod123#1 = enEjer;
     #dsmod123#2 = enPeriodo;
     #dsmod123#3 = enModelo;
     #dsmod123#4 = enComplem;
     #dsmod123#5 = 0;
     |LEE 101#dsmod123.=;
     |SI FSalida = 0;
          |BORRA 020#dsmod123.a;
     |FINSI;

     |HAZ BuscaIngresos;

     |DDEFECTO #dsmod123;
     #dsmod123#0 = enEmpresa;
     #dsmod123#1 = enEjer;
     #dsmod123#2 = enPeriodo;
     #dsmod123#3 = enModelo;
     #dsmod123#4 = enComplem;
     #dsmod123#5 = 0;

     nSwGraba = 0;
     |BUCLE dsmoc123;
     |SI nSwGraba = 0;
         |SI enNoPregunta = 0; |MENAV "0000 No hay Registros "; |FINSI;
     |SINO;
         |GRABA 020#dsmod123.n;
         |LIBERA #dsmod123;

         |SI #dsmod123#4 > 0;
             nEl8 = #dsmod123#13 - #dsmod123#14;
             |SI nEl8 < 0;
                  |MENAV "    RECUERDE. Si el resultado NO es a INGRESAR, NO procede declaracion complementaria";
              |FINSI;
         |FINSI;
         |ABRE #dsmom008;
         #dsmom008#0 = enEmpresa;
         #dsmom008#1 = enEjer;
         #dsmom008#2 = enPeriodo;
         #dsmom008#3 = enModelo;
         #dsmom008#4 = enComplem;
         #dsmom008#5 = enActividad;
         |LEE 101#dsmom008.=;
         |SI FSalida = 0;
             #dsmom008#11 = "COMPLETADO";
             |GRABA 020#dsmom008.a;
         |FINSI;
         |LIBERA #dsmom008;

         #dsmom008#0 = enEmpresa;
         #dsmom008#1 = enEjer;
         #dsmom008#2 = enPeriodo;
         #dsmom008#3 = enModelo;
         #dsmom008#4 = enComplem;
         #dsmom008#5 = 0;
         |LEE 101#dsmom008.=;
         |SI FSalida = 0;
             #dsmom008#11 = "EXISTENTE";
             |GRABA 020#dsmom008.a;
         |FINSI;
         |LIBERA #dsmom008;
         |CIERRA #dsmom008;
     |FINSI;
     |CIERRA #dsmod123;

     enSaldo1Ch = #dsmod123#13;
|FPRC;


|PROCESO AltaModelo;
     |HAZ PintaDatos;
     |SI enEjer ] 2016;
         |PINTA 1631, "                                ";
     |FINSI;

     |ENTLINEAL #1#dsmoc123, -7, 2, 22, 1, ClaveBaja0, ClaveAlta0;

     |HAZ GrabaTodo;
|FPRC;

|RUTINA ClaveBaja0;
     #dsmoc123#0  = enEmpresa;
     #dsmoc123#1  = enEjer;
     #dsmoc123#2  = enPeriodo;
     #dsmoc123#3  = enModelo;
     #dsmoc123#4  = enComplem;
     #dsmoc123#5  = enActividad;
     #dsmoc123#6  = "            ";
     #dsmoc123#7  = 0000;
     #dsmoc123#8  = "A";
     #dsmoc123#9  = 01;
     #dsmoc123#10 = 1;
|FRUT;

|RUTINA ClaveAlta0;
     #dsmoc123#0  = enEmpresa;
     #dsmoc123#1  = enEjer;
     #dsmoc123#2  = enPeriodo;
     #dsmoc123#3  = enModelo;
     #dsmoc123#4  = enComplem;
     #dsmoc123#5  = enActividad;
     #dsmoc123#6  = "zzzzzzzzzzzz";
     #dsmoc123#7  = 9999;
     #dsmoc123#8  = "D";
     #dsmoc123#9  = 12;
     #dsmoc123#10 = 2;
|FRUT;

|PROCESO TipoCaptura;
     |ABRE #dsmom008;
     #dsmom008#0 = enEmpresa;
     #dsmom008#1 = enEjer;
     #dsmom008#2 = enPeriodo;
     #dsmom008#3 = enModelo;
     #dsmom008#4 = enComplem;
     #dsmom008#5 = enActividad;
     |LEE 101#dsmom008.=;
     |SI FSalida = 0;
          aTipoCaptura = #dsmom008#7;
          |QBF aTipoCaptura;
     |FINSI;
     |CIERRA #dsmom008;
|FPRC;

|PROGRAMA;
     eaNoVisu = "";
     eaNomDef = "dsmoc123";

    |ABRE #dsmom038;
    #dsmom038#0 = "C";
    #dsmom038#1 = "14";
    |LEE 101#dsmom038.=;
    |SI FSalida ! 0;
        |CIERRA #dsmom038;
        eaExtension = "mod";
        eaPrograma  = "dsmom038";
        |SUB_EJECUTA_NP ":basica/dspatron";
    |SINO;
        |CIERRA #dsmom038;
    |FINSI;

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
          |HAZ PintaDatos;
          |HAZ Version2016;

          |ENTLINEAL #1#dsmoc123, -11, 4, 22, 1, ClaveBaja0, ClaveAlta0;
          |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              ||Baja del Modelo
         |HAZ BorraRegistros;
         |ABRE #dsmoc123;
         |HAZ GrabaTodo;
         |CIERRA #dsmoc123;
         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo desde Modulo////////

     |SI enTipoEntrada = 97;              ||Baja del Modelo
         |HAZ BorraRegistros;
         |ACABA;
     |FINSI;

|| \\\\\\ Alta o Modificacion del Modelo ////////

     |SI enTipoEntrada = 1;              || Alta del Modelo
         |ABRE #dsmom004;
         #dsmom004#0 = enEmpresa;
         #dsmom004#1 = enEjer;
         #dsmom004#2 = 99;
         #dsmom004#3 = 193;
         #dsmom004#4 = 99;
         |LEE 000#dsmom004.];
         |SI FSalida = 0;
             |LEE 000#dsmom004.a;
         |SINO;
             |LEE 000#dsmom004.u;
         |FINSI;

         |SI FSalida = 0;  |Y #dsmom004#0 = enEmpresa;  |Y #dsmom004#1 = enEjer;
          |Y #dsmom004#3 = 193;  |Y #dsmom004#7 = "X";
             |MENAV "0000El modelo anual 193 ya esta confeccionado, debera de recoger datos de nuevo.";
         |FINSI;
         |CIERRA #dsmom004;

         |CABEZA "Modelo Trabajo 123";
         |HAZ AltaModelo;
         |ACABA;
     |FINSI;

|| \\\\\\ Grabacion del Modelo desde el Exterior

     |SI enTipoEntrada = 98;
         |ABRE #dsmoc123;
         |HAZ GrabaTodo;
         |CIERRA #dsmoc123;
         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #dsmoc123;
         #dsmoc123#0  = enEmpresa;
         #dsmoc123#1  = enEjer;
         #dsmoc123#2  = enPeriodo;
         #dsmoc123#3  = enModelo;
         #dsmoc123#4  = enComplem;
         #dsmoc123#5  = enActividad;
         #dsmoc123#6  = "            ";
         #dsmoc123#7  = 0;
         #dsmoc123#8  = " ";
         #dsmoc123#9  = 0;
         #dsmoc123#10 = 0;
         |LEE 040#dsmoc123.];
         |SI FSalida ! 0;  |O #dsmoc123#0 ! enEmpresa;  |O #dsmoc123#1 ! enEjer; |O #dsmoc123#2 ! enPeriodo;
          |O #dsmoc123#3 ! enModelo;  |O #dsmoc123#4 ! enComplem; |O #dsmoc123#5 ! enActividad;
             enExistencia = 1;
         |FINSI;
         |CIERRA #dsmoc123;
     |FINSI;
|FPRO;

|PROCESO Tipo88;  |TIPO 88;
     |HAZ Relaciones;
|FPRC;
