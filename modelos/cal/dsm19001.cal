|FICHEROS;
     dsm190ca;
     dsm19001;
     dsmom073;

     dsmow079,MANTE;

     :/basica/def/agidanif;

     &regisnif@;
|FIN;

|VARIABLES;
     nModo       = 0;
     nCampo      = 0;
     nPtec       = 0;
     nCampoD     = 0;
     nCampoO     = 0;
     nForma      = 0;

     nSw         = 0;
     aMenav      = "";
     aPathModelo = "";
     aDef        = "";
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aTecla      = "";
     nError      = 0;

     &enError    = 0;
     &enBoton3   = 0;
     &eaPathLaboral = "";
|FIN;

|INCLUYE i_variar;

|PROCESO CalnSw;
    nSw = 0;
    |SI #dsm19001#8 ! "A";  |Y #dsm19001#8 ! "B";
        |Y #dsm19001#8 ! "C"; |Y #dsm19001#8 ! "E";
           |Y #dsm19001#8 ! "M";
            nSw = 1;
    |FINSI;

    |SI #dsm19001#8 = "L";
        |SI #dsm19001#9 = "05"; |O #dsm19001#9 = "10"; |O #dsm19001#9 = "27";
            nSw = 2;
        |FINSI;
    |FINSI;

    |SI #dsm19001#8 = "E";
        nSw = 2;
        |SI #dsm19001#9 ! "01"; |Y #dsm19001#9 ! "02";
             nSw = 1;
        |FINSI;
    |FINSI;
    |SI #dsm19001#8 = "B"; |Y #dsm19001#9 = "02";
        nSw = 1;
    |FINSI;
|FPRC;

|PROCESO PonDatosNif01;  |TIPO 7;
     eaCodNif  = #dsm19001#6;
     |HAZ LeeNifs;

     |HAZ CalculaDatosNif;

     #dsm19001#12 = #regisnif@#1;   |PINTA #dsm19001#12;
     #dsm19001#13 = #regisnif@#4;   |PINTA #dsm19001#13;
                                    |PINTA #dsm19001#14;
                                    |PINTA #dsm19001#15;
                                    |PINTA #dsm19001#25;
                                    |PINTA #dsm19001#26;
                                    |PINTA #dsm19001#27;

     |C_M #dsm19001#10, 1, "S";
     |C_M #dsm19001#14, 1, "S";
     |C_M #dsm19001#21, 1, "S";
     |C_M #dsm19001#22, 1, "S";
     |C_M #dsm19001#23, 1, "S";
     |C_M #dsm19001#24, 1, "S";
     |C_M #dsm19001#25, 1, "S";
     |C_M #dsm19001#26, 1, "S";

     |HAZ CalnSw;
     |SI nSw ! 0;
         |C_M #dsm19001#14, 1, "N";   #dsm19001#14 = 0;   |PINTA #dsm19001#14;
         |C_M #dsm19001#21, 1, "N";   #dsm19001#21 = 0;   |PINTA #dsm19001#21;
       |SI nSw = 1;
         |C_M #dsm19001#22, 1, "N";   #dsm19001#22 = 0;   |PINTA #dsm19001#22;
       |FINSI;
         |C_M #dsm19001#23, 1, "N";   #dsm19001#23 = 0;   |PINTA #dsm19001#23;
         |C_M #dsm19001#24, 1, "N";   #dsm19001#24 = 0;   |PINTA #dsm19001#24;
         |C_M #dsm19001#25, 1, "N";   #dsm19001#25 = 0;   |PINTA #dsm19001#25;
         |C_M #dsm19001#26, 1, "N";   #dsm19001#26 = 0;   |PINTA #dsm19001#26;

         |PARA nCampoD = 28;  |SI nCampoD [ 38;  |HACIENDO nCampoD = nCampoD + 1;
               #dsm19001#nCampoD# = 0;
         |SIGUE;

         |PARA nCampoD = 41;  |SI nCampoD [ 60;  |HACIENDO nCampoD = nCampoD + 1;
               #dsm19001#nCampoD# = 0;
         |SIGUE;

         |PDEFECTO #dsm19001,61,65;
     |FINSI;

     |SI #dsm19001#26 ! 2;
         |C_M #dsm19001#27, 1, "N";  #dsm19001#27 = "";  |PINTA #dsm19001#27;
     |FINSI;

      aAlfa1 = "N"; aAlfa2 = "N";
      |SI #dsm19001#8 = "A";
          aAlfa1 = "S"; aAlfa2 = "S";
      |FINSI;
      |SI #dsm19001#8 = "B"; |Y #dsm19001#9 = "01";
          aAlfa1 = "S";
      |FINSI;
      |SI #dsm19001#1 < 2019; aAlfa1 = "S"; aAlfa2 = "S"; |FINSI;

      |C_M #dsm19001#65, 1, aAlfa1;
      |C_M #dsm19001#66, 1, aAlfa1;
      |C_M #dsm19001#67, 1, aAlfa2;
      |C_M #dsm19001#68, 1, aAlfa2;
      |C_M #dsm19001#69, 1, aAlfa2;
|FPRC;

|PROCESO Tipo2m19001;  |TIPO 2;
     #dsm190ca#6 = #dsm190ca#6 +. 1;
     #dsm190ca#7 = #dsm190ca#7 +. (#dsm19001#16 + #dsm19001#18);
     #dsm190ca#7 = #dsm190ca#7 +. (#dsm19001#65 + #dsm19001#67);
     #dsm190ca#8 = #dsm190ca#8 +. (#dsm19001#17 + #dsm19001#19);
     #dsm190ca#8 = #dsm190ca#8 +. (#dsm19001#66 + #dsm19001#68);

     |SI enBoton3 = -1;  |ACABA;  |FINSI;
     |HAZ CalnSw;

     nForma = 0 +. 1;
     |SI nForma = 1;
         |SI nSw ! 0;
             |ACABA;
         |FINSI;

         |ESTADO_CONTROL enBoton3, "HIDE";

         |PUSHV 0501 2380;

         |PARA nCampoD = 41;  |SI nCampoD [ 63;  |HACIENDO nCampoD = nCampoD + 1;
               nCampoO = nCampoD - 41;
               #dsmow079#nCampoO# = #dsm19001#nCampoD#;
         |SIGUE;

         |PINPA #0#dsmow079;
         |C_V #dsmow079#20, 1, "S";  |C_M #dsmow079#20, 1, "S";
         |C_V #dsmow079#21, 1, "S";  |C_M #dsmow079#21, 1, "S";
         |C_V #dsmow079#22, 1, "S";  |C_M #dsmow079#22, 1, "S";

         |PINDA #0#dsmow079;
         |ENDATOS #1#dsmow079;
         |SI FSalida = 0;
             |PARA nCampoD = 41;  |SI nCampoD [ 63;  |HACIENDO nCampoD = nCampoD + 1;
                   nCampoO = nCampoD - 41;
                   #dsm19001#nCampoD# = #dsmow079#nCampoO#;
             |SIGUE;
         |FINSI;
         |POPV;

         |ESTADO_CONTROL enBoton3, "SHOW";
     |FINSI;
|FPRC;

|PROCESO Tipo11m19001;  |TIPO 11;
     |HAZ CalnSw;

     |SI FSalida = 10;
         eaVarDni  = #dsm19001#Campo#;
         enCalcCif = 1;
         |HAZ CalculameDNI;
         #dsm19001#Campo# = eaVarDni;
         |PINTA #dsm19001#Campo#;
         |ERROR;
     |FINSI;

     |SI FSalida = 11;
         |SI nSw ! 0;
             |ERROR;
             |ACABA;
         |FINSI;

         |ESTADO_CONTROL enBoton3, "HIDE";

         |PUSHV 0501 2380;

         |PARA nCampoD = 41;  |SI nCampoD [ 63;  |HACIENDO nCampoD = nCampoD + 1;
               nCampoO = nCampoD - 41;
               #dsmow079#nCampoO# = #dsm19001#nCampoD#;
         |SIGUE;

         |PINPA #0#dsmow079;

         |C_V #dsmow079#20, 1, "S";
         |C_V #dsmow079#21, 1, "S";
         |C_V #dsmow079#22, 1, "S";

         |PINDA #0#dsmow079;
         |LEETECLA aTecla;
         |POPV;

         |ESTADO_CONTROL enBoton3, "SHOW";

         |ERROR;
     |FINSI;
|FPRC;

|PROCESO LetraNifConyuge01;
     |SI FSalida = 10;
         eaVarDni  = #dsm19001#Campo#;
         enCalcCif = 1;
         |HAZ CalculameDNI;
         #dsm19001#Campo# = eaVarDni;
         |PINTA #dsm19001#Campo#;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO MiraDni19001;  |TIPO 6;
     |C_M #dsm19001#Campo#, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     eaVarDni  = #dsm19001#Campo#;
     enCalcCif = 0;
     |HAZ CalculameDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #dsm19001#Campo# ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #dsm19001#Campo# = eaVarDni;  |PINTA #dsm19001#Campo#;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #dsm19001#Campo# = "            "; |ACABA; |FINSI;
     |SI Campo ! 6; |ACABA; |FINSI;

     nError = 1;
     aAlfa = #dsm19001#Campo# % 101;
     |SI aAlfa = "0";  nError = 0; |FINSI;
     |SI aAlfa = "1";  nError = 0; |FINSI;
     |SI aAlfa = "2";  nError = 0; |FINSI;
     |SI aAlfa = "3";  nError = 0; |FINSI;
     |SI aAlfa = "4";  nError = 0; |FINSI;
     |SI aAlfa = "5";  nError = 0; |FINSI;
     |SI aAlfa = "6";  nError = 0; |FINSI;
     |SI aAlfa = "7";  nError = 0; |FINSI;
     |SI aAlfa = "8";  nError = 0; |FINSI;
     |SI aAlfa = "9";  nError = 0; |FINSI;
     |SI aAlfa = "E";  |O aAlfa = "e"; nError = 0; |FINSI;
     |SI aAlfa = "J";  |O aAlfa = "j"; nError = 0; |FINSI;
     |SI aAlfa = "X";  |O aAlfa = "x"; nError = 0; |FINSI;
     |SI aAlfa = "Y";  |O aAlfa = "y"; nError = 0; |FINSI;
     |SI aAlfa = "Z";  |O aAlfa = "z"; nError = 0; |FINSI;

     |SI nError = 1;
         |CONFI "0000NEste CIF es de una sociedad y no debe declarase en el Modelo. Continuar S/N";
         |SI FSalida ! 0;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO RecogeDatos01;
     enError = 1;
     |HAZ GrabaDatosNif;

     |SI enError = 1;
         |MENAV "     Datos del NIF sin Actualizar o no hay Trabajador, PUEDE que los datos esten incompletos.";
         |ACABA;
     |FINSI;

     |ABRE #agidanif;
     #agidanif#0  = #dsm19001#6;
     #agidanif#1  = 1;
     |LEE 040#agidanif.=;
     |SI FSalida ! 0;
         |SI eaPathLaboral ! "";
             |MENAV "      NIF sin Datos Personales, Actualicelo.";
             |ERROR;
         |FINSI;
     |FINSI;
     |CIERRA #agidanif;
|FPRC;

|PROCESO Tipo701;  |TIPO 7;
     |HAZ CalnSw;
     |SI nSw ! 0;
         |ESTADO_CONTROL enBoton3, "DISABLE";
     |SINO;
         |ESTADO_CONTROL enBoton3, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO TipoRelacion01;  |TIPO 7;
     nModo = (FEntrada / 100) ! 0;

     |SI #dsm19001#8 ! "A";  |Y #dsm19001#8 ! "M";
         |C_M #dsm19001#10, 1, "N";
         #dsm19001#10 = 0;  |PINTA #dsm19001#10;
         |ACABA;
     |FINSI;

     |SI nModo ! 1; |ACABA; |FINSI;

     |ABRE #agidanif;
     #agidanif#0  = #dsm19001#6;
     #agidanif#1  = 1;
     |LEE 040#agidanif.=;
     |SI FSalida ! 0;  |DDEFECTO #agidanif; |FINSI;
     |CIERRA #agidanif;

     #dsm19001#10 = #agidanif#36;
     |PINTA #dsm19001#10;
|FPRC;

|PROCESO SituacionFamiliar01;
     |C_M #dsm19001#27, 1, "S";
     |SI #dsm19001#26 ! 2;
         |C_M #dsm19001#27, 1, "N";  #dsm19001#27 = "";  |PINTA #dsm19001#27;
     |FINSI;
|FPRC;

|PROCESO Baja7301;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = "";
     #dsmom073#2 = "";
|FPRC;

|PROCESO Alta7301;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = "z";
     #dsmom073#2 = "zz";
|FPRC;

|PROCESO Tipo66C8F19001; |TIPO 66;
     enEjerIRPF = #dsm19001#1;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #dsm19001#8;
     #dsmom073#2 = #dsm19001#9;
     |LEE 000#dsmom073.];

     |CONSULTA_F_CLAVE #1#dsmom073, Baja7301, Alta7301;
     |SI FSalida = 0;
          #dsm19001#8 = #dsmom073#1;    |PINTA #dsm19001#8;
          #dsm19001#9 = #dsmom073#2;    |PINTA #dsm19001#9;
     |FINSI;
     |CIERRA #dsmom073;

     |ERROR;
|FPRC;

|PROCESO SubCl19001; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     enEjerIRPF = #dsm19001#1;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #dsm19001#8;
     #dsmom073#2 = #dsm19001#9;
     |LEE 000#dsmom073.=;
     |SI FSalida ! 0;
         aAlfa = "0000Clave no correcta en el ejercicio " + enEjerIRPF;
         |MENAV aAlfa;
         |SI nModo = 1;  |ERROR;  |FINSI;
     |FINSI;
     |CIERRA #dsmom073;
|FPRC;
