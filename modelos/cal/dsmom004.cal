|FICHEROS;
     dsmom004;
     dsmom005;
     dsmom006;
     dsmom008 #8;
     dsmom010;
     dsmom011;
     dsmom012;
     dsmom013;
     dsmopl10;
     dsmopl12;
     dsmopl13;
     dsmom024;
     dsmom082;
     dsmom095;
     dsmom107;
     dsmom900;

     dsmoc310;
     dsmoc131;
     dsmoc130;
     dsmoc349;

     dsmow084,MANTE;
     dsmow136,MANTE;

     :basica/agitab99;
     :basica/agicen14;
     :basica/agibanco;

     :integral/dsam0108;            || Usuarios
     :integral/dsam0116;            || Bancos Clientes
     :integral/dsam0009,MANTE;      || Bancos Clientes  por modelos
     :integral/dsaw0003;

     espejo1@;
     &clientes@;
|FIN;

|VARIABLES;
     aAlfa      = "";
     aAlfa1     = "";
     aAlfa2     = "";
     aAlfa3     = "";
     aPathPdf   = "";
     aAbre      = "";
     aOrigen    = "";
     aDestino   = "";
     aIPRemoto  = "";
     aDirRemoto = "";
     aBase      = "";
     nAnual     = 0;

     nCambio     = 0;
     nContador  = 0;
     nSinDatos  = 0;
     nLinea     = 0;
     nOk        = 0;

     nBoton2    = -1;
     nBoton3    = -1;
     nBoton4    = -1;
     nBoton5    = -1;
     nBoton6    = -1;
     nBoton7    = -1;
     nBoton8    = -1;
     nBoton9    = -1;
     nBoton10   = -1;
     nBoton12   = -1;
     nBoton13   = -1;
     nBoton15   = -1;
     nBoton16   = -1;
     nBoton17   = -1;
     nBoton18   = -1;
     nBoton19   = -1;
     nBoton20   = -1;
     nBoton21   = -1;
     nBoton22   = -1;
     nBoton23   = -1;

     nSw15      = 0;
     nSwBoton2  = 0;
     nSwBoton3  = 0;
     nSwBoton4  = 0;
     nSwBoton5  = 0;
     nSwBoton6  = 0;
     nSwBoton7  = 0;
     nSwBoton8  = 0;
     nSwBoton9  = 0;
     nSwBoton10 = 0;
     nSwBoton12 = 0;
     nSwBoton13 = 0;
     nSwBoton15 = 0;
     nSwBoton16 = 0;
     nSwBoton17 = 0;
     nSwBoton18 = 0;
     nSwBoton19 = 0;
     nSwBoton20 = 0;
     nSwBoton21 = 0;
     nSwBoton22 = 0;
     nSwBoton23 = 0;

     nTecla     = 0;
     nModelo    = 0;
     nHandle    = 0;
     nUltimo    = 0;
     nCanal     = 0;
     nNume      = 0;
     nDPeriodo  = 0;
     nHPeriodo  = 0;
     nCampo1    = 0;
     nCampo2    = 0;
     nBaja      = 0;

     aPathBasica   = "";
     aPathIntegral = "";
     aJustiModelo  = "";
     aElectModelo  = "";
     aMas          = "";
     aPres         = "";

  {10}aPopup       = "";

     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDEjer    = 0;
     &enHEjer    = 0;
     &enDModelo  = 0;
     &enHModelo  = 0;
     &eaPathAcrobat = "";

     &enArchi = 0;
     &aCm7  = "";
     &aCm9  = "";
     &aCm11 = "";
     &aCm13 = "";
     &eaCamp4_9  = "";
     &efCamp4_10 = @;
     &eaCamp4_19 = "";
     &eaCamp4_25 = "";
     &enInfComp  = 0;
     &eaPass     = "";
     &enNoMod390 = 0;
     &enError15  = 0;

     &eaM22Prog  = "";
     &enM22Clie  = 0;
     &enM22MoFa  = 0;
     &eaM22MoFa  = "";
     &enM22Modo  = 0;
     &enM22Inkey = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Tipo12;  |TIPO 12;
     |SI #dsmow084#2 = "S";
         |MENAV "0000Recuerde dar de baja en la AEAT la declaracion anterior";
     |FINSI;
|FPRC;

|RUTINA ClaveBaja8;
     #dsmom008#0 = #dsmom004#0;
     #dsmom008#1 = #dsmom004#1;
     #dsmom008#2 = #dsmom004#2;
     #dsmom008#3 = #dsmom004#3;
     #dsmom008#4 = #dsmom004#4;
     #dsmom008#5 = 00;
|FRUT;

|RUTINA ClaveAlta8;
     #dsmom008#0 = #dsmom004#0;
     #dsmom008#1 = #dsmom004#1;
     #dsmom008#2 = #dsmom004#2;
     #dsmom008#3 = #dsmom004#3;
     #dsmom008#4 = #dsmom004#4;
     #dsmom008#5 = 99;
|FRUT;

|| \\\\\ Alta o Modificacion Modelos ////////

|PROCESO dsmom008Cheq;
     #agicen14#0 = #dsmom008#0;
     #agicen14#1 = #dsmom008#5;
     |LEE 000#agicen14.=;
     |SI FSalida ! 0;  |DDEFECTO #agicen14;  |FINSI;

     |SI #dsmom004#1 ] 2017;
         |SI #agicen14#7 = 11; |O #agicen14#7 = 12; |O #agicen14#7 = 13;
              |O #agicen14#7 = 15; |O #agicen14#7 = 16; |O #agicen14#7 = 17;
             enNoMod390 = 1;
             |ERROR10;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #agicen14#7 = 10;
         enNoMod390 = 1;
         |ACABA;
     |FINSI;

     |SI #agicen14#3 = "8612"; |O #agicen14#3 = "8611"; || ...  |O #agicen14#3 = "862 ";
         enNoMod390 = 1;
         |ACABA;
     |FINSI;

     enNoMod390 = 0;
     |ERROR10;
|FPRC;

|DEFBUCLE dsmom008Cheq;
     #dsmom008#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 01;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 95;
     ;
     NULL, dsmom008Cheq;
|FIN;

|PROCESO QuieresPasar390
     enModAux  = 0;
     |SI #dsmom004#4 > 0;
         |SI #dsmom004#3 = 320;  |O #dsmom004#3 = 332;
             |MENAV "    Declaracion Complementaria. Para el Resumen Anual, recoja datos desde el Modelo 392";
         |SINO;
             |MENAV "    Declaracion Complementaria. Para el Resumen Anual, recoja datos desde el Modelo 390";
         |FINSI;
         |ACABA;
     |FINSI;

     |SI #dsmom004#3 = 320;  |O #dsmom004#3 = 332;
         |CONFI "0000NDesea realizar el pase al modelo 392";
     |SINO;
         enNoMod390 = 0;

         |SI #dsmom004#1 ] 2014;
             |ABRE #agicen14;
             |BUCLE dsmom008Cheq;
             |CIERRA #agicen14;
         |FINSI;

         FSalida = 1;
         |SI enNoMod390 = 0;
             nModelo = 390;
             |HAZ MiraAnuales;
             |SI nAnual = 0;
                 |CONFI "0000NDesea realizar el pase al modelo 390";
             |FINSI;
         |FINSI;
     |FINSI;

     |SI FSalida ! 0;  |ACABA;  |FINSI;

     enModAux  = #dsmom004#3;
     |SI #dsmom004#3 = 320;  |O #dsmom004#3 = 332;
         enModelo  = 392;
         enModelo1 = 392;
     |SINO;
         enModelo  = 390;
         enModelo1 = 390;
     |FINSI;

     enComplem = 00;
     enPeriodo = 99;

     |SUB_EJECUTA_NP "dsmozpas";

     enModelo  = #dsmom004#3;
     enPeriodo = #dsmom004#2;
     enComplem = #dsmom004#4;
     enModAux  = 0;
|FPRC;

|PROCESO QuieresPasar180;
     enModAux  = 0;
     |SI #dsmom004#4 > 0;
         |MENAV "    Declaracion Complementaria. Para el Resumen Anual, recoja datos desde el Modelo 180";
         |ACABA;
     |FINSI;

     nModelo = 180;
     |HAZ MiraAnuales;
     |SI nAnual = 0;
         |CONFI "0000NDesea Realizar el Pase al Modelo 180";
     |FINSI;

     |SI FSalida ! 0;  |ACABA;  |FINSI;

     enComplem = 00;
     enModAux  = #dsmom004#3;
     enModelo  = 180;
     enModelo1 = 180;
     enPeriodo = 99;

     |SUB_EJECUTA_NP "dsmozpas";

     enModelo  = #dsmom004#3;
     enPeriodo = #dsmom004#2;
     enComplem = #dsmom004#4;
     enModAux  = 0;
|FPRC;

|PROCESO QuieresPasar190;
     enModAux  = 0;
     |SI #dsmom004#4 > 0;
         |MENAV "    Declaracion Complementaria. Para el Resumen Anual, recoja datos desde el Modelo 190";
         |ACABA;
     |FINSI;

     nModelo = 190;
     |HAZ MiraAnuales;
     |SI nAnual = 0;
         |CONFI "0000NDesea Realizar el Pase al Modelo 190";
     |FINSI;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     enComplem = 00;
     enModAux  = #dsmom004#3;
     enModelo  = 190;
     enModelo1 = 190;
     enPeriodo = 99;

     |SUB_EJECUTA_NP "dsmozpas";

     enComplem = #dsmom004#4;
     enModelo  = #dsmom004#3;
     enPeriodo = #dsmom004#2;
     enModAux  = 0;
|FPRC;

|PROCESO MiraAnuales;
    nAnual = 0;
    |SALVA_DATOS #dsmom004;
    #dsmom004#2 = 99;
    #dsmom004#3 = nModelo;
    #dsmom004#4 = 1;
    |LEE 041#dsmom004.];
    |SI FSalida = 0; |Y #dsmom004#2 = 99; |Y #dsmom004#3 = nModelo; |Y #dsmom004#4 ] 1;
        nAnual = 1;
    |FINSI;
    |REPON_DATOS #dsmom004;
    |SI nAnual = 1;
        aAlfa = "    Hay Declaracion Complementaria del Modelo " + nModelo + ". Para resumen anual, recoja datos desde su Registro";
        |MENAV aAlfa;
        FSalida = 1;
    |FINSI;
|FPRC;

|PROCESO Tipo0C2Fw84; |TIPO 0;
     |C_M #dsmow084#2, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     aAlfa = Contenido;

     |SI #dsmow084#2 = "C"; |Y nAnual = 1; |Y aAlfa ! "C";
         |SI #dsmom004#3 = 184;
             |MENAV "0000Solo se contemplan sustitutivas. Para Complementarias usar formulario web de AEAT";
             #dsmow084#2 = "S"; |PINTA #dsmow084#2;
         |SINO;
             |CONFI "0000NEsta seguro de hacer una complementaria";
              |SI FSalida ! 0;
                  #dsmow084#2 = "S"; |PINTA #dsmow084#2;
                  |ERROR;
              |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PideJustiCoSAnual;
     nAnual = 1;
     |PUSHV 0501 2380;

     aAlfa = #dsmom004#20 + #dsmom004#21;  |QBT aAlfa;
     |SI aAlfa = "";
         #dsmom004#21 = aJustiModelo;
         #dsmom004#20 = aElectModelo;
     |FINSI;

     |SI #dsmom004#24 = " "; #dsmom004#24 = "S"; |FINSI;

     #dsmow084#0 = #dsmom004#20;
     #dsmow084#1 = #dsmom004#21;
     #dsmow084#2 = #dsmom004#24;
     |C_V #dsmow084#0, 1, "N";
     |C_V #dsmow084#2, 1, "S";

     aAlfa = "S";
     |SI nTecla = 11;  aAlfa = "N";  |FINSI;
     |C_M #dsmow084#2, 1, aAlfa;

     |PINPA #0#dsmow084;

     |SI #dsmom004#1 ] 2018;
         |PINTA 1317, "                                                              ";
         |CUADRO 1016 1778;
         |ATRI S;
         |PINTA 1117, " Las complementarias  solo recogeran registros no declarados ";
         |PINTA 1217, " previamente. Si  ha modificado  importes  de algun registro ";
         |PINTA 1317, " anterior, es aconsejable presentar una sustitutiva.         ";
         |ATRI 0;
     |FINSI;

     |PINTA 1417, "                                           ";
     |PINTA 1517, "Complementaria o Sustitutiva ........... : ";

     |C_P #dsmow084#2, 1, 1560;
     |PINDA #0#dsmow084;
     |ENDATOS #1#dsmow084;
     |SI FSalida = 0;
         #dsmom004#21 = #dsmow084#1;
         #dsmom004#24 = #dsmow084#2;
     |FINSI;
     |POPV;
     |C_P #dsmow084#2, 1, 1460;
     nAnual = 0;
|FPRC;

|PROCESO PideJustiCoS;
     |PUSHV 0501 2380;

     aAlfa = #dsmom004#20 + #dsmom004#21;  |QBT aAlfa;
     |SI aAlfa = "";
         #dsmom004#21 = aJustiModelo;
         #dsmom004#20 = aElectModelo;
     |FINSI;

     #dsmow084#0 = #dsmom004#20;
     #dsmow084#1 = #dsmom004#21;
     #dsmow084#2 = #dsmom004#24;
     |C_V #dsmow084#0, 1, "S";
     |C_V #dsmow084#2, 1, "S";

     aAlfa = "S";
     |SI nTecla = 11; aAlfa = "N"; |FINSI;
     |C_M #dsmow084#2, 1, aAlfa;

     |PINPA #0#dsmow084;
     |PINDA #0#dsmow084;
     |ENDATOS #1#dsmow084;
     |SI FSalida = 0;
         #dsmom004#20 = #dsmow084#0;
         #dsmom004#21 = #dsmow084#1;
         #dsmom004#24 = #dsmow084#2;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO PideJusti;
     |PUSHV 0501 2380;

     aAlfa = #dsmom004#20 + #dsmom004#21;  |QBT aAlfa;
     |SI aAlfa = "";
         #dsmom004#21 = aJustiModelo;
         #dsmom004#20 = aElectModelo;
     |FINSI;

     #dsmow084#0 = #dsmom004#20;
     #dsmow084#1 = #dsmom004#21;
     #dsmow084#2 = "";
     |C_V #dsmow084#0, 1, "S";
     |C_V #dsmow084#2, 1, "N";

     |PINPA #0#dsmow084;

     |PINTA 1417, "                                           ";

     |PINDA #0#dsmow084;
     |ENDATOS #1#dsmow084;
     |SI FSalida = 0;
         #dsmom004#20 = #dsmow084#0;
         #dsmom004#21 = #dsmow084#1;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO AltaModelo;
     aPres = #dsmom004#26;  |QBF aPres;

     |SI #dsmom004#4 > 0;  |Y aPres = "";
         |SI #dsmom004#3 = 130;  |O #dsmom004#3 = 131;  |O #dsmom004#3 = 310;  |O #dsmom004#3 = 300;
                          |O #dsmom004#3 = 123;  |O #dsmom004#3 = 216;  |O #dsmom004#3 = 303;
                          |O #dsmom004#3 = 340;  |O #dsmom004#3 = 110;  |O #dsmom004#3 = 115;
                          |O #dsmom004#3 = 370;  |O #dsmom004#3 = 349;
             |LEE 101#dsmom004.=;

             |SI #dsmom004#3 = 340;  |O #dsmom004#3 = 349;
                 |HAZ PideJustiCoS;
             |SINO;
                 |HAZ PideJusti;
             |FINSI;

             |GRABA 020#dsmom004.a;
             |LIBERA #dsmom004;
         |FINSI;
     |FINSI;

     |SI #dsmom004#11 ! "X"; |Y #dsmom004#13 ! "X"; |Y aPres = "";
         |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 320;  |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;
          |O #dsmom004#3 = 310;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 303;
             |SI #dsmom004#17 = "COMPLETADO  ";
                 |HAZ ChequeaProrrata;
                 |SI enSwSeguir = 1;
                     |ACABA;
                 |FINSI;
             |FINSI;

             |HAZ eLaPrescripcion;
             |SI enSwSeguir = 1;  |ACABA; |FINSI;

             |HAZ eLaProrrata;
             |SI enSwSeguir ! 0;
                || |SI enSwSeguir = 2;  anterior al 2005
                ||     enEmpresa = #dsmom004#0;
                ||     enEjer    = #dsmom004#1;
                ||     enPeriodo = #dsmom004#2;
                ||     enModelo  = #dsmom004#3;
                ||     enComplem = #dsmom004#4;
                ||     |SUB_EJECUTA "dsmoz016";
                || |FINSI;
                 |ACABA;
             |FINSI;

          |FINSI;
     |FINSI;

     |SI #dsmom004#5 = "ACTIVIDAD ";  |O #dsmom004#5 = "ACT.+ REG.";

         |PUSHV 0501 2380;
         |ENTLINEAL #1#dsmom008, -6, 4, 21, 1, ClaveBaja8, ClaveAlta8;
         |POPV;

         |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 320;  |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;
          |O #dsmom004#3 = 310;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 303;
                                                      || O #dsmom004#3 = 322; No 70000_10160
             |SI #dsmom004#2 = 12;
                 |HAZ QuieresPasar390;
             |FINSI;
         |FINSI;

         |SI #dsmom004#3 = 115;
             |SI #dsmom004#2 = 12;
                 |HAZ QuieresPasar180;
             |FINSI;
         |FINSI;

         |SI #dsmom004#3 = 110;
             |SI #dsmom004#2 = 12;
                 |HAZ QuieresPasar190;
             |FINSI;
         |FINSI;

         |LEE 101#dsmom004.=;

         |HAZ ChequeaSituacion;  || Esta en el PLB

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
         |VETE GrabaPror;
     |FINSI;

     aPres = #dsmom004#26;  |QBF aPres;
     |SI aPres ! "";
         |MENAV "0000Modelo presentado en AEAT. No se puede modificar";
         |ACABA;
     |FINSI;

     |SI #dsmom004#11 = "X";
         |MENAV "     Modelo ya Remesado. No se puede Modificar";
         |ACABA;
     |FINSI;

     |SI #dsmom004#13 = "X";
         |MENAV "     Modelo ya Archivado. No se puede Modificar";
         |ACABA;
     |FINSI;

     |ABRE #dsmom008;
     #dsmom008#0 = #dsmom004#0;
     #dsmom008#1 = #dsmom004#1;
     #dsmom008#2 = #dsmom004#2;
     #dsmom008#3 = #dsmom004#3;
     #dsmom008#4 = #dsmom004#4;
     #dsmom008#5 = 0;
     |LEE 040#dsmom008.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom008;
         #dsmom008#0 = #dsmom004#0;
         #dsmom008#1 = #dsmom004#1;
         #dsmom008#2 = #dsmom004#2;
         #dsmom008#3 = #dsmom004#3;
         #dsmom008#4 = #dsmom004#4;
         #dsmom008#5 = 0;
         #dsmom008#12 = #dsmom004#3;
     |FINSI;
     |CIERRA #dsmom008;

     enTipoEntrada = 1;
     |HAZ EntraModelo;

     |LEE 101#dsmom004.=;

     |SI #dsmom004#3 ! 353;
         |SI enEntrada = 1;
             #dsmom004#7  = "X";
             #dsmom004#8  = ~;
             #dsmom004#15 = enResultado;
             #dsmom004#17 = "COMPLETADO";
             aAlfa = #dsmom004#16;  |QBT aAlfa;
             |SI aAlfa ! "";
                 |HAZ UltimoPeriodo;
                 #dsmom004#16 = eaUltimoPer;
             |FINSI;
          |SINO;
             |SI #dsmom004#9 = " ";
                 #dsmom004#7  = " ";
                 #dsmom004#8  = "01.01.0000";
                 #dsmom004#9  = " ";
                 #dsmom004#10 = "01.01.0000";
                 #dsmom004#15 = 0;
                 #dsmom004#17 = "SIN DATOS";
             |FINSI;
          |FINSI;

          |SI #dsmom004#9 = " ";
||              |HAZ BloqueoEmision;
||              #dsmom004#9  = eaBloq;
          |FINSI;

          |GRABA 020#dsmom004.a;
      |FINSI;
      |LIBERA #dsmom004;

      |ET GrabaPror;
      |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 320;  |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;
       |O #dsmom004#3 = 310;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 303;
             |HAZ eLaProrrFin;
      |FINSI;
|FPRC;

|| \\\\\ Recoge Modelo ////////

|PROCESO TraeModelo;
     |ABRE #agitab99;
     #agitab99#0 = enModelo;
     |LEE 040#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;
     |CIERRA #agitab99;

     |SI #dsmom004#3 ! 180;  |Y #dsmom004#3 ! 190; |Y #dsmom004#3 ! 390;  |Y #dsmom004#3 ! 392;
      |Y #dsmom004#3 ! 193;  |Y #dsmom004#3 ! 184; |Y #dsmom004#3 ! 296;
         |SI #agitab99#4 = "N";
             |MENAV "     Modelo sin Activar el Pase de Registro.";
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #dsmom004#11 = "X";
         |MENAV "     Modelo ya Remesado. No se puede Recoger Datos";
         |ACABA;
     |FINSI;

     |SI aPres ! "";
         |MENAV "     Modelo ya presentado en AEAT. No se puede Recoger Datos";
     |FINSI;

     |SI #dsmom004#13 = "X";
         |MENAV "     Modelo ya Archivado. No se puede Recoger Datos";
         |ACABA;
     |FINSI;

     |SI #dsmom004#9 = "X";
         |MENAV "     Modelo ya impreso. Para recoger datos hay que darlo de Baja primero.";
         |ACABA;
     |FINSI;

     |SI #dsmom004#5 = "EMPRESA   ";
         |CONFI "0000SDesea Realizar el Pase en estos momentos ";
         |SI FSalida = 0;
             enModelo1 = #dsmom004#3;
             |SUB_EJECUTA_NP "dsmozpas";
         |FINSI;
     |FINSI;
|FPRC;

|| \\\\\ Baja del Modelo ////////

|PROCESO BorraAct;
     |BORRA 020#dsmom008.a;
     |LIBERA #dsmom008;

     enEmpresa     = #dsmom008#0;
     enEjer        = #dsmom008#1;
     enPeriodo     = #dsmom008#2;
     enModelo      = #dsmom008#3;
     enComplem     = #dsmom008#4;
     enActividad   = #dsmom008#5;
     enTipoEntrada = 3;
     |HAZ EntraModelo;
|FPRC;

|DEFBUCLE dsmom008B;
     #dsmom008#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 00;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 99;
     be;
     NULL, BorraAct;
|FIN;

|PROCESO BajaModelo;
     aAlfa = #dsmom004#26;  |QBF aAlfa;
     |SI aAlfa ! "";
         |MENAV "0000Modelo presentado en AEAT. No se puede dar de baja";
         |ACABA;
     |FINSI;

     nBaja = 0;
     |DBASE aBase; |QBF aBase;
     aMas  = aBase + "def/dsmom004.mas";
     |CARGA_DEF aMas, espejo1@;
     |SI FSalida = 0;
         |ABRE #espejo1@;
         #espejo1@#0 = #dsmom004#0;
         #espejo1@#1 = #dsmom004#1;
         #espejo1@#2 = #dsmom004#2;
         #espejo1@#3 = #dsmom004#3;
         #espejo1@#4 = #dsmom004#4 + 1;
         |LEE 000#espejo1@.=;
         |SI FSalida = 0;
             nBaja = 1;
         |FINSI;
         |CIERRA #espejo1@;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     |SI nBaja = 1;
         aAlfa = "    Existe Complementaria del Modelo";
         |SI #dsmom004#4 > 0;
             aAlfa = "    Existe una Complementaria posterior";
         |FINSI;
         aAlfa = aAlfa + ", no puedo dar de Baja";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI #dsmom004#4 > 0;  |Y #dsmom004#5  ! "EMPRESA   ";
         |SI #dsmom004#9 = "X";
             |CONFI "0000NModelo ya impreso, Esta Seguro de la Baja : ";
             |SI FSalida ! 0;  |ACABA;  |FINSI;

             |HAZ BorraFicPlanoInternet;
             |HAZ BorraElHis;
         |SINO;
             |CONFI "0000NEsta seguro de dar de Baja el Modelo ";
             |SI FSalida ! 0;  |ACABA;  |FINSI;
         |FINSI;

         enNoPregunta = 1;
         |BUCLE dsmom008B;
         enNoPregunta = 0;

         |LEE 101#dsmom004.=;
         |SI FSalida = 0;
             |BORRA 020#dsmom004.a;
             |LIBERA #dsmom004;
         |FINSI;

         |SI nSwBoton13 = 1;
             aOrigen =  aPathPdf;
             |FBORRA aOrigen;
         |FINSI;

         enEmpresa     = #dsmom004#0;
         enEjer        = #dsmom004#1;
         enPeriodo     = #dsmom004#2;
         enModelo      = #dsmom004#3;
         enComplem     = #dsmom004#4;
         enActividad   = 0;

         |ACABA;
     |FINSI;

     |SI #dsmom004#7 = " ";  |ACABA;  |FINSI;

     |SI #dsmom004#5  ! "EMPRESA   ";
         |MENAV "     Modelo por Actividad, no puedo dar de Baja";
         |ACABA;
     |FINSI;

     |SI #dsmom004#11 = "X";
         |MENAV "     Modelo ya Remesado. No se puede dar de Baja";
         |ACABA;
     |FINSI;

     |SI #dsmom004#13 = "X";
         |MENAV "     Modelo ya Archivado. No se puede dar de Baja";
         |ACABA;
     |FINSI;

     |SI #dsmom004#9 = "X";
         |CONFI "0000NModelo ya impreso, Esta Seguro de la Baja : ";
         |SI FSalida ! 0;
             |ACABA;
         |FINSI;

         |HAZ BorraFicPlanoInternet;
         |HAZ BorraElHis;
     |SINO;
         |CONFI "0000NEsta seguro de dar de Baja el Modelo ";
         |SI FSalida ! 0;
             |ACABA;
         |FINSI;
     |FINSI;

     |ABRE #dsmom008;
     #dsmom008#0 = #dsmom004#0;
     #dsmom008#1 = #dsmom004#1;
     #dsmom008#2 = #dsmom004#2;
     #dsmom008#3 = #dsmom004#3;
     #dsmom008#4 = #dsmom004#4;
     #dsmom008#5 = 0;
     |LEE 040#dsmom008.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom008;
         #dsmom008#0 = #dsmom004#0;
         #dsmom008#1 = #dsmom004#1;
         #dsmom008#2 = #dsmom004#2;
         #dsmom008#3 = #dsmom004#3;
         #dsmom008#4 = #dsmom004#4;
         #dsmom008#5 = 0;
         #dsmom008#12 = #dsmom004#3;
     |FINSI;
     |CIERRA #dsmom008;

     enTipoEntrada = 3;
     |HAZ EntraModelo;

     |LEE 101#dsmom004.=;
     |SI #dsmom004#4 > 0;  |Y #dsmom004#5 = "EMPRESA   ";
         |BORRA 020#dsmom004.a;
     |SINO;
         #dsmom004#7  = " ";
         #dsmom004#8  = "01.01.0000";
         #dsmom004#9  = " ";
         #dsmom004#10 = "01.01.0000";
         #dsmom004#15 = 0;
         #dsmom004#17 = "SIN DATOS";

||         |HAZ BloqueoEmision;
||         #dsmom004#9  = eaBloq;

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |LIBERA #dsmom004;

     |SI nSwBoton13 = 1;
         aOrigen =  aPathPdf;
         |FBORRA aOrigen;
     |FINSI;
|FPRC;

|PROCESO Boton2m004;
     |PTEC 824;
|FPRC;

|PROCESO Boton3m004;
     |PTEC 825;
|FPRC;

|PROCESO Boton4m004;
     |PTEC 826;
|FPRC;

|PROCESO Boton5m004;
     |PTEC 827;
|FPRC;

|PROCESO Boton6m004;
     |PTEC 828;
|FPRC;

|PROCESO Boton7m004;
     |PTEC 829;
|FPRC;

|PROCESO Boton8m004;
     |PTEC 830;
|FPRC;

|PROCESO Boton9m004;
     |PTEC 831;
|FPRC;

|PROCESO Boton10m004;
     |PTEC 832;
|FPRC;

|PROCESO Boton12m004;
     |PTEC 834;
|FPRC;

|PROCESO Boton13m004;
     |PTEC 835;
|FPRC;

|PROCESO Boton17m004;
     |PTEC 839;
|FPRC;

|PROCESO Boton15m004;
     |PTEC 837;
|FPRC;

|PROCESO Boton16m004;
     |PTEC 838
|FPRC;

|PROCESO Boton18m004;
     |PTEC 841;
|FPRC;

|PROCESO Boton19m004;
     |PTEC 836;
|FPRC;

|PROCESO Boton20m004;
     |PTEC 967;   || Ctrl-F
|FPRC;

|PROCESO Boton21m004;
     |PTEC 965;   || Ctrl-E
|FPRC;

|PROCESO Boton22m004;
     |PTEC 963;  || Ctrl-B
|FPRC;

|PROCESO Boton23m004;
     |PTEC 962;  || Ctrl-A
|FPRC;

|PROCESO FinBotonm004;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |FIN_CONTROL_WINDOWS nBoton7;
     |FIN_CONTROL_WINDOWS nBoton8;
     |FIN_CONTROL_WINDOWS nBoton9;
     |FIN_CONTROL_WINDOWS nBoton10;
     |FIN_CONTROL_WINDOWS nBoton12;
     |FIN_CONTROL_WINDOWS nBoton13;
     |FIN_CONTROL_WINDOWS nBoton15;
     |FIN_CONTROL_WINDOWS nBoton16;
     |FIN_CONTROL_WINDOWS nBoton17;
     |FIN_CONTROL_WINDOWS nBoton18;
     |FIN_CONTROL_WINDOWS nBoton19;
     |FIN_CONTROL_WINDOWS nBoton20;
     |FIN_CONTROL_WINDOWS nBoton22;
     |FIN_CONTROL_WINDOWS nBoton23;

     |SI nBoton21 ! -1;
         |FIN_CONTROL_WINDOWS nBoton21;
     |FINSI;

     |BLIN 24;

     |PULSATECLA;
|FPRC;

|PROCESO Tipo0m004;  |TIPO 0;
     |HAZ FinBotonm004;
|FPRC;

|PROCESO Tipo7m004;  |TIPO 7;
     |BLIN 04;

     |CONTROL_SIMPLE 0, "LBOTON,F2  Consulta Modelo     ", 0832, 0855, Boton2m004;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3  Entrada de Datos    ", 0932, 0955, Boton3m004;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F4  Consulta Prorrata   ", 1032, 1055, Boton4m004;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F5  Consulta Prescripcion ", 1132, 1155, Boton5m004;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,Ctrl-F4 Formas de pago ", 1232, 1255, Boton19m004;
     nBoton19 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F6  Emitir Modelo       ", 1332, 1355, Boton6m004;
     nBoton6 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,Ctrl-B Informe Comprobacion ", 1432, 1455, Boton22m004;
     nBoton22 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F7  Recoger Datos       ", 1532, 1555, Boton7m004;
     nBoton7 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F8  Baja Modelo         ", 1632, 1655, Boton8m004;
     nBoton8 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F9  Crear Complementaria", 1057, 1080, Boton9m004;
     nBoton9 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F10 Dejar No Impreso    ", 1157, 1180, Boton10m004;
     nBoton10 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F12 N§.Justificante / CSV", 1257, 1280, Boton12m004;
     nBoton12 = FSalida;

     aAlfa = "Carta solicitud NRC al banco";
     |SI #dsmom004#1 [ 2014;  aAlfa = "Ver Documento PDF";  |FINSI;
     aAlfa = "LBOTON,Ctrl-F3 " + aAlfa;
     |CONTROL_SIMPLE 0, aAlfa, 1357, 1380, Boton13m004;
     nBoton13 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,Ctrl-F5  Regularizacion Manual ", 1457, 1480, Boton15m004;
     nBoton15 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,Ctrl-F6 Compensar/Devolver ", 1557, 1580, Boton16m004;
     nBoton16 = FSalida;

     aAlfa = "Archivar           "; |SI #dsmom004#13 = "X"; aAlfa = "Dejar No Archivado "; |FINSI;
     aAlfa = "LBOTON,Ctrl-F7 " + aAlfa;
     |CONTROL_SIMPLE 0, aAlfa, 1657, 1680, Boton17m004;
     nBoton17 = FSalida;

     |ABRE #dsmom107;
     |DDEFECTO #dsmom107;
     |LEE 000#dsmom107.p;
     |CIERRA #dsmom107;

     |ABRE #dsmom900;
     #dsmom900#0 = #dsmom004#0;
     #dsmom900#1 = #dsmom004#1;
     #dsmom900#2 = #dsmom004#2;
     #dsmom900#3 = #dsmom004#3;
     #dsmom900#4 = #dsmom004#4;
     #dsmom900#5 = 1;
     |LEE 000#dsmom900.];
     |SI FSalida = 0;  |Y  #dsmom900#0 = #dsmom004#0;  |Y  #dsmom900#1 = #dsmom004#1;
                       |Y  #dsmom900#2 = #dsmom004#2;  |Y  #dsmom900#3 = #dsmom004#3;
                       |Y #dsmom900#4 = #dsmom004#4;
         |CONTROL_SIMPLE 0, "LBOTON,Ctrl-F9 Comentarios (Con datos)", 0957, 0980, Boton18m004;
     |SINO;
         |CONTROL_SIMPLE 0, "LBOTON,Ctrl-F9 Comentarios (Sin datos)", 0957, 0980, Boton18m004;
     |FINSI;
     nBoton18 = FSalida;
     |CIERRA #dsmom900;

     |CONTROL_SIMPLE 0, "LBOTON,Ctrl-F Consultar en GAD", 0857, 0880, Boton20m004;
     nBoton20 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,Ctrl-A Importacion desde hoja EXCEL", 0757, 0780, Boton23m004;
     nBoton23 = FSalida;

     |SI enFormulario = 1;
         |CONTROL_SIMPLE 0, "LBOTON,Ctrl-E Formulario", 0657, 0680, Boton21m004;
         nBoton21 = FSalida;
     |FINSI;

     |ESTADO_CONTROL nBoton2,  "DISABLE";  nSwBoton2  = 0;
     |ESTADO_CONTROL nBoton3,  "DISABLE";  nSwBoton3  = 0;
     |ESTADO_CONTROL nBoton4,  "DISABLE";  nSwBoton4  = 0;
     |ESTADO_CONTROL nBoton5,  "DISABLE";  nSwBoton5  = 0;
     |ESTADO_CONTROL nBoton15, "DISABLE";  nSwBoton15 = 0;
     |ESTADO_CONTROL nBoton16, "DISABLE";  nSwBoton16 = 0;
     |ESTADO_CONTROL nBoton6,  "DISABLE";  nSwBoton6  = 0;
     |ESTADO_CONTROL nBoton22, "DISABLE";  nSwBoton22 = 0;
     |ESTADO_CONTROL nBoton7,  "DISABLE";  nSwBoton7  = 0;
     |ESTADO_CONTROL nBoton8,  "DISABLE";  nSwBoton8  = 0;
     |ESTADO_CONTROL nBoton9,  "DISABLE";  nSwBoton9  = 0;
     |ESTADO_CONTROL nBoton10, "DISABLE";  nSwBoton10 = 0;
     |ESTADO_CONTROL nBoton12, "DISABLE";  nSwBoton12 = 0;
     |ESTADO_CONTROL nBoton13, "DISABLE";  nSwBoton13 = 0;
     |ESTADO_CONTROL nBoton17, "DISABLE";  nSwBoton17 = 0;
     |ESTADO_CONTROL nBoton18, "DISABLE";  nSwBoton18 = 0;
     |ESTADO_CONTROL nBoton19, "DISABLE";  nSwBoton19 = 0;
     |ESTADO_CONTROL nBoton20, "DISABLE";  nSwBoton20 = 0;
     |ESTADO_CONTROL nBoton23, "DISABLE";  nSwBoton23 = 0;

     |SI nBoton21 ! -1;
         |ESTADO_CONTROL nBoton21, "DISABLE";  nSwBoton21 = 0;
     |FINSI;

     |SI #dsmom004#3 ] 900;  |ACABA;  |FINSI;

     |SI #dsmom004#1 [ 2014;
         |DBASE aPathPdf;  |QBF aPathPdf;
         aPathPdf = aPathPdf + "modelospdf";
         aPathPdf = aPathPdf + "/" + #dsmom004#3;
         aPathPdf = aPathPdf + "/" + #dsmom004#1;
         aPathPdf = aPathPdf + "/" + (("00" + #dsmom004#2) % -102);
         aPathPdf = aPathPdf + "/" + (("00" + #dsmom004#4) % -102);
         aPathPdf = aPathPdf + "/" + #dsmom004#3 + (("00000" + #dsmom004#0) % -105) + ".pdf";

         |XABRE "E", aPathPdf, nHandle;
         |SI FSalida ] 0;
             |ESTADO_CONTROL nBoton13, "ENABLE";  nSwBoton13 = 1;
         |FINSI;
     |FINSI;

     |SI #dsmom004#9 = "X";
         |ESTADO_CONTROL nBoton12, "ENABLE";  nSwBoton12 = 1;
     |FINSI;

     |SI #dsmom004#7 = "X";
         |ESTADO_CONTROL nBoton6,   "ENABLE";  nSwBoton6  = 1;
         |ESTADO_CONTROL nBoton22,  "ENABLE";  nSwBoton22 = 1;

         |DBASS aBase;  |QBF aBase;

         aPathIntegral = "";
         aAlfa = aBase + "integral/def/dsam0000.mas";
         |XABRE "E", aAlfa, nCanal;
         |SI FSalida ] 0;
             |ESTADO_CONTROL nBoton19,  "ENABLE";  nSwBoton19 = 1;
             aPathIntegral = aBase + "integral/";
         |SINO;
             aPathBasica = "";
             aAlfa = aBase + "basica/def/agifigen.mas";
             |XABRE "E", aAlfa, nCanal;
             |SI FSalida ] 0;
                 |ESTADO_CONTROL nBoton19,  "ENABLE";  nSwBoton19 = 2;
                 aPathBasica = aBase + "basica/";
             |FINSI;
         |FINSI;

         |SI #dsmom004#3 = "322";
             |ESTADO_CONTROL nBoton19,  "DISABLE";  nSwBoton19 = 0;
             |ESTADO_CONTROL nBoton22,  "DISABLE";  nSwBoton22 = 0;
         |SINO;
             |HAZ ForPagoPantalla;
         |FINSI;

         |SI #dsmom004#3 = "353";
             |ESTADO_CONTROL nBoton22,  "DISABLE";  nSwBoton22 = 0;

             |SI #dsmom004#2 = 12;  |Y #dsmom004#15 < 0;  |Y #dsmom004#13 = " ";
                 |ESTADO_CONTROL nBoton16,  "ENABLE";  nSwBoton16 =  1;
             |SINO;
                 |SI #dsmom004#23 = "S";  |Y #dsmom004#15 < 0;  |Y #dsmom004#13 = " ";
                     |ESTADO_CONTROL nBoton16,  "ENABLE";  nSwBoton16 =  1;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #dsmom004#1 ] 2015;
         |SI #dsmom004#7 = "X"; |Y #dsmom004#9 = "X";
             |SI eaFormaPago = "2"; |O eaFormaPago = "5";
                 |SI #dsmom004#3 ! 180; |Y #dsmom004#3 ! 190; |Y #dsmom004#3 ! 390; |Y #dsmom004#3 ! 392;
                   |Y #dsmom004#3 ! 184; |Y #dsmom004#3 ! 193; |Y #dsmom004#3 ! 296; |Y #dsmom004#3 ! 187;

                   |ESTADO_CONTROL nBoton13, "ENABLE";  nSwBoton13 = 2;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |DBASS aBase;  |QBF aBase;
     aAlfa = aBase + "dsarchi/def/dsarz017.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         |ESTADO_CONTROL nBoton20,  "ENABLE";  nSwBoton20 =  1;
     |FINSI;

     |SI enFormulario = 1;
         |SI #dsmom004#3 = 130;  |O #dsmom004#3 = 303;
             |ESTADO_CONTROL nBoton21,  "ENABLE";  nSwBoton21 =  1;
         |FINSI;
     |FINSI;

     |SI #dsmom004#9 = "X";  |Y #dsmom004#13 = " ";
         |ESTADO_CONTROL nBoton10,  "ENABLE";  nSwBoton10 = 1;
     |FINSI;

     |SI #dsmom004#9 = "X";
         |ESTADO_CONTROL nBoton17,  "ENABLE";  nSwBoton17 = 1;
     |FINSI;

     |SI #dsmom004#7 = " "; |Y #dsmom004#9 ! "X"; |Y #dsmom107#30 = "S";
         |ESTADO_CONTROL nBoton17,  "ENABLE";  nSwBoton17 = 1;
     |FINSI;

     |SI #dsmom004#3 = 347;  |O #dsmom004#3 = 193;
      |O #dsmom004#3 = 180;  |O #dsmom004#3 = 190;
         |SI #dsmom004#7 = " ";
             |ESTADO_CONTROL nBoton23,  "ENABLE";  nSwBoton23 = 1;
         |FINSI;
     |FINSI;

     |SI #dsmom004#5 = "MANUAL    ";
         |ESTADO_CONTROL nBoton2,  "ENABLE";  nSwBoton2  = 1;
         |ESTADO_CONTROL nBoton18, "ENABLE";  nSwBoton18 = 1;
         |ACABA;
     |FINSI;

     |SI #dsmom004#5 = "EMPRESA   ";
         |ESTADO_CONTROL nBoton2,  "ENABLE";  nSwBoton2  = 1;
         |ESTADO_CONTROL nBoton3,  "ENABLE";  nSwBoton3  = 1;
         |ESTADO_CONTROL nBoton8,  "ENABLE";  nSwBoton8  = 1;
         |ESTADO_CONTROL nBoton18, "ENABLE";  nSwBoton18 = 1;

         |SI #dsmom004#3 = 347;  |O #dsmom004#3 = 190;  |O #dsmom004#3 = 180;
          |O #dsmom004#3 = 390;  |O #dsmom004#3 = 392;  |O #dsmom004#3 = 193;
          |O #dsmom004#3 = 296;
             |ESTADO_CONTROL nBoton7,  "ENABLE";  nSwBoton7 = 1;
             |ESTADO_CONTROL nBoton9,  "ENABLE";  nSwBoton9 = 1;
         |FINSI;

         |SI #dsmom004#3 = 110;  |O #dsmom004#3 = 115;  |O #dsmom004#3 = 184;
          |O #dsmom004#3 = 130;  |O #dsmom004#3 = 131;  |O #dsmom004#3 = 310;
          |O #dsmom004#3 = 123;  |O #dsmom004#3 = 216;  |O #dsmom004#3 = 187;
             |ESTADO_CONTROL nBoton9,  "ENABLE";  nSwBoton9 = 1;
         |FINSI;


         |ACABA;
     |FINSI;

     |SI #dsmom004#3 = 110;  |O #dsmom004#3 = 115;  |O #dsmom004#3 = 349;  |O #dsmom004#3 = 370;
      |O #dsmom004#3 = 300;  |O #dsmom004#3 = 330;  |O #dsmom004#3 = 320;  |O #dsmom004#3 = 332;
      |O #dsmom004#3 = 130;  |O #dsmom004#3 = 131;  |O #dsmom004#3 = 310;  |O #dsmom004#3 = 123;
      |O #dsmom004#3 = 216;  |O #dsmom004#3 = 303;  |O #dsmom004#3 = 340;  |O #dsmom004#3 = 322;
         |ESTADO_CONTROL nBoton9,  "ENABLE";  nSwBoton9 = 1;
     |FINSI;

     |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 320;  |O #dsmom004#3 = 330;
      |O #dsmom004#3 = 332;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 303;
      |O #dsmom004#3 = 110;  |O #dsmom004#3 = 115;  |O #dsmom004#3 = 123;
      |O #dsmom004#3 = 130;  |O #dsmom004#3 = 131;  |O #dsmom004#3 = 310;
      |O #dsmom004#3 = 340;  |O #dsmom004#3 = 322;
         |SI #dsmom004#4 > 0;
             |ESTADO_CONTROL nBoton8,  "ENABLE";  nSwBoton8 = 1;
         |FINSI;
     |FINSI;

     |SI #dsmom004#3 = 349;
         |ESTADO_CONTROL nBoton8,  "ENABLE";  nSwBoton8 = 1;
     |FINSI;

     |ESTADO_CONTROL nBoton2,  "ENABLE";  nSwBoton2  = 1;
     |ESTADO_CONTROL nBoton3,  "ENABLE";  nSwBoton3  = 1;
     |ESTADO_CONTROL nBoton18, "ENABLE";  nSwBoton18 = 1;

     |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 320;
      |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;  |O #dsmom004#3 = 303;
        |O #dsmom004#3 = 322;
         enEmpresa = #dsmom004#0;
         enEjer    = #dsmom004#1;
         |HAZ LeeCtrlProrr;
         |SI enSwProrr ! 2;
             |ESTADO_CONTROL nBoton4,  "ENABLE";  nSwBoton4  = 1;
         |FINSI;
         |ESTADO_CONTROL nBoton15, "ENABLE";  nSwBoton15 = 1;
     |FINSI;

     |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 320;
      |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;  |O #dsmom004#3 = 310;  |O #dsmom004#3 = 303;
         |ESTADO_CONTROL nBoton5,  "ENABLE";  nSwBoton5 =  1;
     |FINSI;

     |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 310;
         |SI #dsmom004#2 = 12;  |Y #dsmom004#15 < 0;  |Y #dsmom004#13 = " ";
             |ESTADO_CONTROL nBoton16,  "ENABLE";  nSwBoton16 =  1;
         |FINSI;
     |FINSI;

     |SI #dsmom004#3 = 303;
         |SI #dsmom004#2 = 12;  |Y #dsmom004#15 < 0;  |Y #dsmom004#13 = " ";
             |ESTADO_CONTROL nBoton16,  "ENABLE";  nSwBoton16 =  1;
         |SINO;
             |SI #dsmom004#23 = "S";  |Y #dsmom004#15 < 0;  |Y #dsmom004#13 = " ";
                 |ESTADO_CONTROL nBoton16,  "ENABLE";  nSwBoton16 =  1;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #dsmom004#3 = 320;  |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;
         |SI #dsmom004#2 = 12; |Y #dsmom004#15 < 0;  |Y #dsmom004#13 = " ";
             |ESTADO_CONTROL nBoton16,  "ENABLE";  nSwBoton16 =  1;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsmopl10;
     #dsmopl10#3  = nLinea;

     |GRABA 020#dsmopl10.n;
     |LIBERA #dsmopl10;
|FPRC;

|DEFBUCLE dsmopl10;
     #dsmopl10#1;
     ;
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "            ";
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "zzzzzzzzzzzz";
     ;
     NULL, dsmopl10;
|FIN;

|PROCESO dsmopl12;
     #dsmopl12#3  = nLinea;

     |GRABA 020#dsmopl12.n;
     |LIBERA #dsmopl12;
|FPRC;

|DEFBUCLE dsmopl12;
     #dsmopl12#1;
     ;
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "            ";
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "zzzzzzzzzzzz";
     ;
     NULL, dsmopl12;
|FIN;

|PROCESO dsmopl13;
     #dsmopl13#3  = nLinea;

     |GRABA 020#dsmopl13.n;
     |LIBERA #dsmopl13;
|FPRC;

|DEFBUCLE dsmopl13;
     #dsmopl13#1;
     ;
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "            ";
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "zzzzzzzzzzzz";
     ;
     NULL, dsmopl13;
|FIN;

|PROCESO dsmom010;
     #dsmom010#3  = nLinea;

     |GRABA 020#dsmom010.n;
     |LIBERA #dsmom010;
|FPRC;

|DEFBUCLE dsmom010;
     #dsmom010#1;
     ;
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "    ";
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "zzzz";
     ;
     NULL, dsmom010;
|FIN;

|PROCESO dsmom011;
     #dsmom011#3  = nLinea;

     |GRABA 020#dsmom011.n;
     |LIBERA #dsmom011;
|FPRC;

|DEFBUCLE dsmom011;
     #dsmom011#1;
     ;
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "    ";
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "zzzz";
     ;
     NULL, dsmom011;
|FIN;

|PROCESO dsmom012;
     #dsmom012#3  = nLinea;

     |GRABA 020#dsmom012.n;
     |LIBERA #dsmom012;
|FPRC;

|DEFBUCLE dsmom012;
     #dsmom012#1;
     ;
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "    ";
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "zzzz";
     ;
     NULL, dsmom012;
|FIN;

|PROCESO dsmom013;
     #dsmom013#3  = nLinea;

     |GRABA 020#dsmom013.n;
     |LIBERA #dsmom013;
|FPRC;

|DEFBUCLE dsmom013;
     #dsmom013#1;
     ;
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "    ";
     #dsmoc130#0, #dsmoc130#1, #dsmoc130#2, #dsmoc130#4, #dsmoc130#5, "zzzz";
     ;
     NULL, dsmom013;
|FIN;

|PROCESO dsmoc130;
     |BUCLE dsmom010;
     |BUCLE dsmom011;
     |BUCLE dsmom012;
     |BUCLE dsmom013;
     |SI #dsmom008#1 ] 2019;
         |BUCLE dsmopl10;
         |BUCLE dsmopl12;
         |BUCLE dsmopl13;
     |FINSI;

     #dsmoc130#4  = nLinea;
     |GRABA 020#dsmoc130.n;
     |LIBERA #dsmoc130;
|FPRC;

|DEFBUCLE dsmoc130;
     #dsmoc130#1;
     ;
     #dsmom008#0, #dsmom008#1, #dsmom008#2, #dsmom008#3, #dsmom008#4, #dsmom008#5;
     #dsmom008#0, #dsmom008#1, #dsmom008#2, #dsmom008#3, #dsmom008#4, #dsmom008#5;
     ;
     NULL, dsmoc130;
|FIN;

|PROCESO dsmoc131;
     #dsmoc131#4  = nLinea;
     |GRABA 020#dsmoc131.n;
     |LIBERA #dsmoc131;
|FPRC;

|DEFBUCLE dsmoc131;
     #dsmoc131#1;
     ;
     #dsmom008#0, #dsmom008#1, #dsmom008#2, #dsmom008#3, #dsmom008#4, #dsmom008#5;
     #dsmom008#0, #dsmom008#1, #dsmom008#2, #dsmom008#3, #dsmom008#4, #dsmom008#5;
     ;
     NULL, dsmoc131;
|FIN;

|PROCESO dsmoc310;
     |SALVA_DATOS #dsmoc310;

     #dsmoc310#4  = nLinea;
     |LEE 000#dsmoc310.=;
     |SI FSalida = 0;
         |REPON_DATOS #dsmoc310;
         |LEE 000#dsmoc310.=;
         |ACABA;
     |FINSI;
     |REPON_DATOS #dsmoc310;

     #dsmoc310#4  = nLinea;
     |GRABA 020#dsmoc310.n;
     |LIBERA #dsmoc310;
|FPRC;

|DEFBUCLE dsmoc310;
     #dsmoc310#1;
     ;
     #dsmom008#0, #dsmom008#1, #dsmom008#2, #dsmom008#3, #dsmom008#4, #dsmom008#5;
     #dsmom008#0, #dsmom008#1, #dsmom008#2, #dsmom008#3, #dsmom008#4, #dsmom008#5;
     ;
     NULL, dsmoc310;
|FIN;

|PROCESO dsmoc349;
     #dsmoc349#4  = nLinea;
     |GRABA 020#dsmoc349.n;
     |LIBERA #dsmoc349;
|FPRC;

|DEFBUCLE dsmoc349;
     #dsmoc349#1;
     ;
     #8#0, #8#1, nDPeriodo, #8#3, #8#4, #8#5, "  ", 0000, 00, "            ";
     #8#0, #8#1, nHPeriodo, #8#3, #8#4, #8#5, "zz", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, dsmoc349;
|FIN;

|PROCESO BuscaPeriodo349;
     |ABRE #dsmom095;
     #dsmom095#0 = #dsmom008#0;
     #dsmom095#1 = #dsmom008#1;
     |LEE 000#dsmom095.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom095;  |FINSI;
     |CIERRA #dsmom095;

     nDPeriodo = #dsmom008#2;
     nHPeriodo = #dsmom008#2;

     |SI #dsmom095#2 = "A";
         nDPeriodo = 01;
         nHPeriodo = 12;
     |FINSI;

     nCampo1 = #dsmom008#2 + (#dsmom008#2 + 1);
     nCampo2 = nCampo1 + 1;

     |SI #dsmom095#nCampo2# = "T";
         |SI #dsmom008#2 = 3;    nDPeriodo = 1;   nHPeriodo = 3;   |FINSI;
         |SI #dsmom008#2 = 6;    nDPeriodo = 4;   nHPeriodo = 6;   |FINSI;
         |SI #dsmom008#2 = 9;    nDPeriodo = 7;   nHPeriodo = 9;   |FINSI;
         |SI #dsmom008#2 = 12;   nDPeriodo = 10;  nHPeriodo = 12;  |FINSI;
     |FINSI;

     |SI #dsmom095#nCampo2# = "M";
         nDPeriodo = #dsmom008#2;
         nHPeriodo = #dsmom008#2;
     |FINSI;
|FPRC;

|PROCESO CompleAct;
     |SI #dsmom004#3 = 130;  |BUCLE dsmoc130;  |FINSI;
     |SI #dsmom004#3 = 131;  |BUCLE dsmoc131;  |FINSI;
     |SI #dsmom004#1 [ 2013;
        |SI #dsmom004#3 = 310;  |BUCLE dsmoc310;  |FINSI;
     |SINO;
        |SI #dsmom008#12 = 310;  |BUCLE dsmoc310;  |FINSI;
     |FINSI;

     |SI #dsmom004#3 = 349;  |Y  #dsmom004#24 = "S";
         |SI #dsmom008#7  = "MANUAL    ";
             |HAZ BuscaPeriodo349;
             |BUCLE dsmoc349;
         |FINSI;
     |FINSI;

     #dsmom008#4  = nLinea;
     |SI #dsmom004#3 ! 130;  |Y #dsmom004#3 ! 303; |Y #dsmom004#3 ! 349;
         #dsmom008#7  = "MANUAL";
     |FINSI;

     |SI #dsmom004#1 ] 2014; |Y #dsmom004#3 = 303; |Y #dsmom008#12 = 310;
         #dsmom008#7  = "MANUAL";
     |FINSI;

     |SI #dsmom004#3 = 130;           || Lo pasamos a Manual
         |SI #dsmom008#7 = "PLANILLAS "; |O  #dsmom008#7 = "MODULOS   ";
             #dsmom008#7  = "MANUAL";
         |FINSI;
     |FINSI;

     #dsmom008#11 = "SIN DATOS";
     |GRABA 020#dsmom008.n;
     |LIBERA #dsmom008;
|FPRC;

|DEFBUCLE dsmom008;
     #dsmom008#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, nUltimo, 00;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, nUltimo, 99;
     be;
     NULL, CompleAct;
|FIN;

|PROCESO Complementaria;
     |SALVA_DATOS #dsmom004;
     #dsmom004#4 = 0;
     |PARA;  |SI;  |HACIENDO;
          |LEE 040#dsmom004.=;
          |SI FSalida = 0;
              #dsmom004#4 = #dsmom004#4 + 1;
          |SINO;
              nLinea = #dsmom004#4;
              |SAL;
          |FINSI;
     |SIGUE;

     aJustiModelo = #dsmom004#25;   |QBF aJustiModelo;
     aElectModelo = #dsmom004#19;   |QBF aElectModelo;
     nUltimo      = nLinea - 1;

     |REPON_DATOS #dsmom004;

     #dsmom004#20        = "";
     #dsmom004#21        = "";
     #dsmom004#19        = "";
     #dsmom004#24        = "";
     #dsmom004#25        = "";
     #dsmom004#26        = "";

     |SI #dsmom004#3 = 130;  |O #dsmom004#3 = 131;  |O #dsmom004#3 = 310;  |O #dsmom004#3 = 300;
                      |O #dsmom004#3 = 303;  |O #dsmom004#3 = 123;  |O #dsmom004#3 = 216;
                      |O #dsmom004#3 = 340;  |O #dsmom004#3 = 110;  |O #dsmom004#3 = 115;
                      |O #dsmom004#3 = 370;  |O #dsmom004#3 = 349;
                      |O #dsmom004#3 = 322;

         |SI #dsmom004#3 = 340;  |O #dsmom004#3 = 187; |O #dsmom004#3 = 349;
             |HAZ PideJustiCoS;
         |SINO;
             |HAZ PideJusti;
         |FINSI;
     |SINO;
         |SI #dsmom004#2 = 99; |Y #dsmom004#3 ! 390;
             |HAZ PideJustiCoSAnual;
         |FINSI;
     |FINSI;

     |SI #dsmom004#3 = 110;  |O #dsmom004#3 = 115;
      |O #dsmom004#3 = 300;  |O #dsmom004#3 = 320;  |O #dsmom004#3 = 303;
      |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;  |O #dsmom004#3 = 322;
      |O #dsmom004#3 = 370;  |O #dsmom004#3 = 349;  |O #dsmom004#3 = 340;
      |O #dsmom004#3 = 130;  |O #dsmom004#3 = 131;  |O #dsmom004#3 = 310;
      |O #dsmom004#3 = 123;  |O #dsmom004#3 = 216;
         |BUCLE dsmom008;
     |FINSI;

     #dsmom004#4 = nLinea;
     #dsmom004#7  = " ";
     #dsmom004#8  = "01.01.0000";
     #dsmom004#9  = " ";
     #dsmom004#10 = "01.01.0000";
     #dsmom004#11 = " ";
     #dsmom004#12 = "01.01.0000";
     #dsmom004#13 = " ";
     #dsmom004#14 = "01.01.0000";
     #dsmom004#18 = 0;

     #dsmom004#15 = 0;
     #dsmom004#17 = "SIN DATOS";

     aJustiModelo = "";
     aElectModelo = "";

||     |HAZ BloqueoEmision;
||     #dsmom004#9  = eaBloq;

     |GRABA 020#dsmom004.n;
     |LIBERA #dsmom004;

     |SI #dsmom004#3 = 390;  |O #dsmom004#3 = 392;
         enEmpresa     = #dsmom004#0;
         enEjer        = #dsmom004#1;
         enPeriodo     = #dsmom004#2;
         enModelo      = #dsmom004#3;
         enComplem     = #dsmom004#4;
         enActividad   = 0;
         enDComple     = 0;
         enHComple     = 0;
         |HAZ TraeModelo;
     |FINSI;
|FPRC;

|PROCESO CambiaPago;
     nCambio = 0;
     |HAZ UltimoPeriodo;
     #dsmom004#16 = eaUltimoPer;

     aAlfa = "0000NEl Importe es a " + #dsmom004#16;  |QBF aAlfa;
     aAlfa = aAlfa + ", desea cambiarlo ";

     |CONFI aAlfa;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #dsmom004#9 = "X";
         |CONFI "0000NModelo ya impreso, ¨desea continuar?. El modelo se quedara no impreso";
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |HAZ BorraFicPlanoInternet;
         |HAZ BorraElHis;
     |FINSI;

     |ABRE #dsmom005;
     #dsmom005#0 = #dsmom004#3;
     |LEE 000#dsmom005.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom005;  |FINSI;
     |CIERRA #dsmom005;

     |ABRE #dsmom006;
     #dsmom006#0 = #dsmom004#0;
     #dsmom006#1 = #dsmom004#3;
     |LEE 101#dsmom006.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom006;
         #dsmom006#0 = #dsmom004#0;
         #dsmom006#1 = #dsmom004#3;
         #dsmom006#2 = #dsmom005#1;
         #dsmom006#3 = #dsmom005#2;
         #dsmom006#4 = #dsmom005#3;
         #dsmom006#5 = #dsmom005#4;
         #dsmom006#6 = #dsmom005#5;
         #dsmom006#7 = #dsmom005#6;
         #dsmom006#8 = #dsmom005#7;
         #dsmom006#9 = #dsmom005#8;
         |GRABA 020#dsmom006.b;
     |FINSI;

     |SI #dsmom004#16 = "COMPENSAR";
         #dsmom006#12 = "DEVOLVER";
     |SINO;
         #dsmom006#12 = "COMPENSAR";
     |FINSI;

     |GRABA 020#dsmom006.a;
     |LIBERA #dsmom006;

     |ABRE #dsmom008;
     #dsmom008#0 = #dsmom004#0;
     #dsmom008#1 = #dsmom004#1;
     #dsmom008#2 = #dsmom004#2;
     #dsmom008#3 = #dsmom004#3;
     #dsmom008#4 = #dsmom004#4;
     #dsmom008#5 = 0;
     |LEE 040#dsmom008.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom008;
         #dsmom008#0 = #dsmom004#0;
         #dsmom008#1 = #dsmom004#1;
         #dsmom008#2 = #dsmom004#2;
         #dsmom008#3 = #dsmom004#3;
         #dsmom008#4 = #dsmom004#4;
         #dsmom008#5 = 0;
         #dsmom008#12 = #dsmom004#3;
     |FINSI;
     |CIERRA #dsmom008;

     enEmpresa     = #dsmom004#0;
     enEjer        = #dsmom004#1;
     enPeriodo     = #dsmom004#2;
     enModelo      = #dsmom004#3;
     enComplem     = #dsmom004#4;
     enActividad   = 99;
     enDComple     = 0;
     enHComple     = 0;
     enTipoEntrada = 91;
     enResultado   = #dsmom004#15;

     |SI #dsmom004#3 = 370;  enActividad = 0;  |FINSI;

     |HAZ EntraModelo;

     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         |SI #dsmom004#9 = "X";
             |HAZ BorraElHis;
             |SI nSwBoton13 = 1;
                 aOrigen =  aPathPdf;
                 |FBORRA aOrigen;
             |FINSI;
         |FINSI;

         #dsmom004#7  = "X";
         #dsmom004#8  = ~;
         #dsmom004#9  = "";
         #dsmom004#10 = "01.01.0000";
         #dsmom004#15 = enResultado;
         #dsmom004#17 = "COMPLETADO";

         |HAZ UltimoPeriodo;
         #dsmom004#16 = eaUltimoPer;

||         |HAZ BloqueoEmision;
||         #dsmom004#9  = eaBloq;

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;

     |SI #dsmom004#2 = 12;
         nCambio = 1;
     |FINSI;
|FPRC;

|PROCESO IgualoW136aW3;
     eaM22Prog  = "dsam0000";
     enM22Clie  = #dsmom004#0;
     enM22MoFa  = 0;
     eaM22MoFa  = "";
     |DDEFECTO #dsaw0003;
     #dsaw0003#0 = #dsmow136#0;
     #dsaw0003#1 = #dsmow136#1;
     #dsaw0003#2 = #dsmow136#2;
     #dsaw0003#3 = #dsmow136#3;
     #dsaw0003#4 = #dsmow136#4;
     #dsaw0003#5 = #dsmow136#5;
     #dsaw0003#6 = #dsmow136#6;

     #dsaw0003#20 = #dsmow136#8;
     #dsaw0003#22 = #dsmow136#9;
     #dsaw0003#21 = #dsmow136#10;
|FPRC;

|PROCESO BancoGeneral;
     |PUSHV 0501 2380;

     enCodCli = #dsmom004#0;
     |HAZ LeePersona;

     |SI enSwDeDonde = 1;
         #dsmow136#0  = #clientes@#88;
         #dsmow136#1  = #clientes@#89;
         #dsmow136#2  = #clientes@#90;
         #dsmow136#3  = #clientes@#91;
         #dsmow136#4  = #clientes@#92;
         #dsmow136#5  = #clientes@#93;
         #dsmow136#6  = #clientes@#104;
         #dsmow136#8  = #clientes@#114;
         #dsmow136#9  = #clientes@#116;
         #dsmow136#10 = #clientes@#115;

         |ABRE #dsam0116;
         #dsam0116#0 = #dsmow136#0;
         |LEE 000#dsam0116.=;
         |SI FSalida ! 0;  |DDEFECTO #dsam0116;  |FINSI;
         |CIERRA #dsam0116;

         #dsmow136#7  = #dsam0116#5;

         |HAZ IgualoW136aW3;
         |HAZ GrabaAntesM22;
     |FINSI;

     |SI enSwDeDonde = 0;
         #dsmow136#0  = #clientes@#79;
         #dsmow136#1  = #clientes@#80;
         #dsmow136#2  = #clientes@#81;
         #dsmow136#3  = #clientes@#82;
         #dsmow136#4  = #clientes@#83;
         #dsmow136#5  = #clientes@#84;
         #dsmow136#6  = #clientes@#95;
         #dsmow136#8  = #clientes@#98;
         #dsmow136#9  = #clientes@#99;
         #dsmow136#10 = #clientes@#105;

         |ABRE #agibanco;
         #agibanco#0 = #dsmow136#0;
         |LEE 000#agibanco.=;
         |SI FSalida ! 0;  |DDEFECTO #agibanco;  |FINSI;
         |CIERRA #agibanco;

         #dsmow136#7  = #agibanco#5;
     |FINSI;

     |PINPA #0#dsmow136;
     |PINDA #0#dsmow136;
     |ENDATOS #1#dsmow136;
     |SI FSalida = 0;
         |ABRE #clientes@;
         #clientes@#0 =  #dsmom004#0;
         |LEE 101#clientes@.=;
         |SI FSalida = 0;
             |SI enSwDeDonde = 1;
                 #clientes@#88  = #dsmow136#0;
                 #clientes@#89  = #dsmow136#1;
                 #clientes@#90  = #dsmow136#2;
                 #clientes@#91  = #dsmow136#3;
                 #clientes@#92  = #dsmow136#4;
                 #clientes@#93  = #dsmow136#5;
                 #clientes@#104 = #dsmow136#6;
                 #clientes@#114 = #dsmow136#8;
                 #clientes@#115 = #dsmow136#10;
                 #clientes@#116 = #dsmow136#9;

                 |HAZ IgualoW136aW3;
                 |HAZ GrabaDespuesM22;
             |FINSI;

             |SI enSwDeDonde = 0;
                 #clientes@#79  = #dsmow136#0;
                 #clientes@#80  = #dsmow136#1;
                 #clientes@#81  = #dsmow136#2;
                 #clientes@#82  = #dsmow136#3;
                 #clientes@#83  = #dsmow136#4;
                 #clientes@#84  = #dsmow136#5;
                 #clientes@#95  = #dsmow136#6;
                 #clientes@#98  = #dsmow136#8;
                 #clientes@#99  = #dsmow136#9;
                 #clientes@#105 = #dsmow136#10;
             |FINSI;

             |GRABA 020#clientes@.a;
             |LIBERA #clientes@;
         |FINSI;
         |CIERRA #clientes@;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO Baja109;
     #dsam0009#0 = #dsmom004#0;
     #dsam0009#1 = 001;
|FPRC;

|PROCESO Alta109;
     #dsam0009#0 = #dsmom004#0;
     #dsam0009#1 = 999;
|FPRC;

|PROCESO BancoModelos;
     |PUSHV 0501 2380;

     |ENTLINEAL #1#dsam0009, -2, 2, 22, 1, Baja109, Alta109;

     |POPV;
|FPRC;

|PROCESO ForPagoPantalla;
  enCodCli = #dsmom004#0;
  |HAZ LeePersona;

  enModelo = #dsmom004#3;
  enForzar = 1;
  |HAZ VerDatosBancos;
|FPRC;

|PROCESO FormasDePago;
 |SI nSwBoton19 = 1;
     aPopup1  = -1;  || Si fuera -1 en la posicion
     aPopup2  = 2;
     aPopup3  = "1 Datos banco general";
     aPopup4  = "2 Datos bancos por modelos";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 101;
         |SI aAlfa = "1";  |HAZ BancoGeneral;  |FINSI;
         |SI aAlfa = "2";  |HAZ BancoModelos;  |FINSI;
     |FINSI;
 |SINO;
     |HAZ BancoGeneral;
 |FINSI;
|FPRC;

|PROCESO Tipo11m004;  |TIPO 11;
     nTecla = FSalida;

     |HAZ FinBotonm004;

     |SI #dsmom004#3 ] 900;  |ACABA;  |FINSI;

     enEmpresa     = #dsmom004#0;
     enEjer        = #dsmom004#1;
     enPeriodo     = #dsmom004#2;
     enModelo      = #dsmom004#3;
     enComplem     = #dsmom004#4;
     enActividad   = 0;
     enDComple     = 0;
     enHComple     = 0;

     |SI #dsmom004#1 ] 2014;
          |SI #dsmom004#3 = 370;  |O #dsmom004#3 = 310;
              |MENAV "0000Modelo incorrecto. Calcule el planing del 2014.";
              |ACABA;
          |FINSI;
     |FINSI;

|| \\\\\ Especial Modelo 131 . Reduc. creacion empleo 2015 ////////

     nSw15 = 0;
     |SI #dsmom004#1 = 2015;
         |SI #dsmom004#3 = 131; |O #dsmom004#3 = 130;
             |SI nTecla = 10; |Y nSwBoton2 = 1; nSw15 = 1; |FINSI;
             |SI nTecla = 11; |Y nSwBoton3 = 1; nSw15 = 1; |FINSI;
             |SI nTecla = 14; |Y nSwBoton6 = 1; nSw15 = 1; |FINSI;
         |FINSI;
     |FINSI;

     |SI nSw15 = 1;
         enModelo = #dsmom004#3;
         aAlfa = "dsmoy092;EMPRESA";
         |SUB_EJECUTA aAlfa;
         |SI enError15 = 1; |Y nTecla = 14;
             |CONFI "0000NDesea Continuar";
             |SI FSalida ! 0;
                 |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

|| \\\\\ Consulta Modelos ////////

     |SI nTecla = 10;  |Y nSwBoton2 = 1;
         |ABRE #dsmom008;
         #dsmom008#0 = #dsmom004#0;
         #dsmom008#1 = #dsmom004#1;
         #dsmom008#2 = #dsmom004#2;
         #dsmom008#3 = #dsmom004#3;
         #dsmom008#4 = #dsmom004#4;
         #dsmom008#5 = 0;
         |LEE 040#dsmom008.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsmom008;
             #dsmom008#0 = #dsmom004#0;
             #dsmom008#1 = #dsmom004#1;
             #dsmom008#2 = #dsmom004#2;
             #dsmom008#3 = #dsmom004#3;
             #dsmom008#4 = #dsmom004#4;
             #dsmom008#5 = 0;
             #dsmom008#12 = #dsmom004#3;
         |FINSI;
         |CIERRA #dsmom008;

         enTipoEntrada = 4;

         |HAZ EntraModelo;
         |HAZ Refresco;
     |FINSI;

|| \\\\\ Alta o Modificacion Modelos ////////

     |SI nTecla = 11;  |Y nSwBoton3 = 1;
         |HAZ AltaModelo;
         |HAZ Refresco;
         |ACABA;
     |FINSI;

|| \\\\\ Visualizacion Prorrata

     |SI nTecla = 12;  |Y nSwBoton4 = 1;
         |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 320;
          |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;  |O #dsmom004#3 = 303;
            |O #dsmom004#3 = 322;
             enTipoEntrada = 4;
             aCm9  = #dsmom004#9;
             aCm11 = #dsmom004#11;
             aCm13 = #dsmom004#13;
             |SUB_EJECUTA_NP "dsmom027";
             |HAZ Refresco;
         |FINSI;
     |FINSI;

|| \\\\\ Visualizacion Prescripciones

     |SI nTecla = 13;  |Y nSwBoton5 = 1;
         |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 320;
          |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;  |O #dsmom004#3 = 310;
          |O #dsmom004#3 = 303;  |O #dsmom004#3 = 322;
             aCm7 = #dsmom004#7;
             aCm9 = #dsmom004#9;
             aCm11 = #dsmom004#11;
             aCm13 = #dsmom004#13;
             enTipoEntrada = 4;
             |SUB_EJECUTA_NP "dsmom028";
             |HAZ Refresco;
         |FINSI;
     |FINSI;

|| \\\\\ Emision del Modelo

     |SI nTecla = 14;  |Y nSwBoton6 = 1;
         aAlfa = #dsmom004#26;  |QBF aAlfa;
         |SI aAlfa ! "";
             |MENAV "0000Modelo presentado en AEAT. No se puede emitir";
             |ACABA;
         |FINSI;

         |SI #dsmom004#7 = "X";
             |SI #dsmom004#9 = "P";
                 nOk = 1;
                 |SI enSwDeDonde = 1;
                     |ABRE #dsam0108;
                     #dsam0108#0 = Usuario % 810;
                     |LEE 000#dsam0108.=;
                     |SI FSalida ! 0;  |DDEFECTO #dsam0108;  |FINSI;
                     |CIERRA #dsam0108;

                     |SI #dsam0108#4 = "S";
                         |CONFI "0000NModelo pendiente de confirmacion. Quiere emitirlo de todas formas";
                         |SI FSalida = 0;
                             nOk = 0;
                         |FINSI;
                     |FINSI;
                 |FINSI;

                 |SI nOk = 1;
                     |MENAV "0000Modelo pendiente de confirmacion. No se puede emitir.";
                     |ACABA;
                 |FINSI;
             |FINSI;

             |SI #dsmom004#13 = "X";
                 |CONFI "0000NModelo Archivado. Desea continuar";
                 |SI FSalida ! 0;  |ACABA;  |FINSI;
             |SINO;
                 aAlfa = #dsmom004#19 + #dsmom004#25;  |QBF aAlfa;
                 |SI aAlfa ! "";
                     |CONFI "0000NEl modelo tiene codigo de justificante o cod.seg.verificacion. Continuamos";
                     |SI FSalida ! 0;  |ACABA;  |FINSI;
                 |FINSI;
             |FINSI;

             |LEE 101#dsmom004.=;
             eaCamp4_9  = #dsmom004#9;
             efCamp4_10 = #dsmom004#10;
             eaCamp4_19 = #dsmom004#19;
             eaCamp4_25 = #dsmom004#25;

             #dsmom004#9 = "";
             #dsmom004#10 = "01.01.0000";
             #dsmom004#19 = "";
             #dsmom004#25 = "";
             #dsmom004#26 = "";

||             |HAZ BloqueoEmision;
||             #dsmom004#9  = eaBloq;

             |GRABA 020#dsmom004.a;
             |LIBERA #dsmom004;

             enInfComp = 0;
             |SUB_EJECUTA_NP "dsmoy000;PLANING";
             |SI enInfComp = 1;
                 |LEE 101#dsmom004.=;
                 #dsmom004#9  = eaCamp4_9;
                 #dsmom004#10 = efCamp4_10;
                 #dsmom004#19 = eaCamp4_19;
                 #dsmom004#25 = eaCamp4_25;

                 |SI #dsmom004#9 = " ";
||                     |HAZ BloqueoEmision;
||                     #dsmom004#9  = eaBloq;
                 |FINSI;

                 |GRABA 020#dsmom004.a;
                 |LIBERA #dsmom004;
             |FINSI;
             |HAZ Refresco;
         |FINSI;
     |FINSI;

     |SI nTecla = 149;  |Y nSwBoton22 = 1;
         |SI #dsmom004#7 = "X";
             |SUB_EJECUTA_NP "dsmoy000;INFC";
             |HAZ Refresco;
         |FINSI;
     |FINSI;

|| \\\\\ Recoge Modelo desde Registro

     |SI nTecla = 15;  |Y nSwBoton7 = 1;
         |HAZ TraeModelo;
         |HAZ Refresco;
     |FINSI;

|| \\\\\ Baja del Modelo ////////

     |SI nTecla = 16;  |Y nSwBoton8 = 1;
         |HAZ BajaModelo;
         |HAZ Refresco;
     |FINSI;

|| \\\\\ Creacion de Complementaria del Modelo ////////

     |SI nTecla = 17;  |Y nSwBoton9 = 1;
         |SI #dsmom004#3 = 347;  |O #dsmom004#3 = 190;  |O #dsmom004#3 = 180; |O #dsmom004#3 = 184;
          |O #dsmom004#3 = 110;  |O #dsmom004#3 = 115;  |O #dsmom004#3 = 390; |O #dsmom004#3 = 392;
          |O #dsmom004#3 = 193;  |O #dsmom004#3 = 349;  |O #dsmom004#3 = 370; |O #dsmom004#3 = 300;
          |O #dsmom004#3 = 320;  |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332; |O #dsmom004#3 = 130;
          |O #dsmom004#3 = 131;  |O #dsmom004#3 = 310;  |O #dsmom004#3 = 123; |O #dsmom004#3 = 216;
          |O #dsmom004#3 = 296;  |O #dsmom004#3 = 303;  |O #dsmom004#3 = 340; |O #dsmom004#3 = 187;
          |O #dsmom004#3 = 322;
             aCoBien = "N";
             |SI #dsmom004#3 = 130; |O #dsmom004#3 = 131;  |HAZ eComprobarCom; |FINSI;
             |SI aCoBien = "S";
                 aAlfa = #dsmom004#3;
                 aAlfa = "    No disponible Complementaria del Modelo " + aAlfa + " para Comunidad";
                 |MENAV aAlfa;
                 |MENAV "    Regularice en el proximo trimestre";
             |SINO;
                 |CONFI "     Estas seguro de crear una Complementaria : ";
                 |SI FSalida = 0;
                     |HAZ Complementaria;
                     |HAZ Refresco;
                  |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

|| \\\\\ Dejar no Impreso ////////

     |SI nTecla = 18;  |Y nSwBoton10 = 1;
         |SI #dsmom004#9 = "X";  |Y #dsmom004#13 = " ";
          |Y #dsmom004#26 = "                      ";
             aAlfa =  "0000NEsta seguro de dejar el Modelo como no Impreso";
             |SI #dsmom004#3 = 130; |O #dsmom004#3 = 131;
                 aCoBien = "";
                 |HAZ eComprobarCom;
                 |SI aCoBien = "S";
                     aAlfa = "    NEsta seguro de dejar el Modelo de la COMUNIDAD como no Impreso";
                 |FINSI;
             |FINSI;
             |CONFI aAlfa;
             |SI FSalida ! 0;  |ACABA;  |FINSI;

             aAlfa = #dsmom004#19 + #dsmom004#25;  |QBF aAlfa;
             |SI aAlfa ! "";
                 |CONFI "0000NEl modelo tiene codigo de justificante o cod.seg.verificacion. Continuamos";
                 |SI FSalida ! 0;  |ACABA;  |FINSI;
             |FINSI;

             |HAZ BorraFicPlanoInternet;

             |LEE 101#dsmom004.=;
             #dsmom004#9 = "";
             #dsmom004#10 = "01.01.0000";
             #dsmom004#19 = "";
             #dsmom004#25 = "";
             #dsmom004#26 = "";

||             |HAZ BloqueoEmision;
||             #dsmom004#9  = eaBloq;

             |GRABA 020#dsmom004.a;
             |LIBERA #dsmom004;
             |PINTA #dsmom004#9;

             |HAZ BorraElHis;

             |SI nSwBoton13 = 1;
                 aOrigen =  aPathPdf;
                 |FBORRA aOrigen;
             |FINSI;
         |FINSI;
     |FINSI;

|| \\\\\ Numero de Justificante ////////

     |SI nSwBoton12 = 1;
         |SI nTecla = 9;  |O nTecla = 20;
             |SI #dsmom004#9 = "X";
                 |PUSHV 0501 2380;

                 enEmpresa = #dsmom004#0;
                 enEjer    = #dsmom004#1;
                 enPeriodo = #dsmom004#2;
                 enModelo  = #dsmom004#3;
                 enComplem = #dsmom004#4;
                 eaTPer  = #dsmom004#22;

                 eaIdJus = #dsmom004#25;
                 eaIdEle = #dsmom004#19;
                 eaIdExp = #dsmom004#26;
                 |LIBERA #dsmom004;

                 |SUB_EJECUTA "dsmow115";
                 |POPV;

                 |LEE 101#dsmom004.=;
                 |SI FSalida = 0;
                     #dsmom004#25 = eaIdJus;
                     #dsmom004#19 = eaIdEle;
                     #dsmom004#26 = eaIdExp;
                     |GRABA 020#dsmom004.a;
                 |FINSI;
                 |LIBERA #dsmom004;
             |FINSI;
         |FINSI;
     |FINSI;

|| \\\\\ Editar Documento PDF ////////

     |SI nTecla = 21;
         |SI nSwBoton13 = 1;
             aIPRemoto = "";
             |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

             aDirRemoto = "\MODELOS";                       |RMKDIR aDirRemoto;
             aDirRemoto = "\MODELOS\" + #dsmom004#3;               |RMKDIR aDirRemoto;
             aDirRemoto = "\MODELOS\" + #dsmom004#3 + "\" + #dsmom004#1;  |RMKDIR aDirRemoto;
             aDirRemoto = "\MODELOS\" + #dsmom004#3 + "\" + #dsmom004#1 + "\";

             |DBASE aBase;  |QBF aBase;

             aOrigen    = aBase + "plugins/wait.exe";
             aDestino   = aDirRemoto + "wait.exe";
             |SI aIPRemoto ! "";
                 |ENVIA_FICHERO aOrigen, aDestino;
             |SINO;
                 |COPIA_FICHERO aOrigen, aDestino;
             |FINSI;

             aOrigen    =  aPathPdf;
             aDestino   =  aDirRemoto + #dsmom004#3 + (("00000" + #dsmom004#0) % -105) + ".pdf";
             |SI aIPRemoto ! "";
                 |ENVIA_FICHERO aOrigen, aDestino;
             |SINO;
                 |COPIA_FICHERO aOrigen, aDestino;
             |FINSI;

             |HAZ LocalizaAcrobat;

             aAbre = aDirRemoto + "imprime.bat";
             |XABRE "CBW", aAbre, nHandle;

             aAlfa = "CD " + aDirRemoto + &13 + &10;
             |XGRABA nHandle, aAlfa;

             aAlfa = "wait " + eaPathAcrobat + " " + #dsmom004#3 + (("00000" + #dsmom004#0) % -105) + ".pdf";

             |XGRABA nHandle, aAlfa;

             |XCIERRA nHandle;

             |RSYSTEM aAbre;

             |RFBORRA aAbre;
             |RFBORRA aDestino;

             aDestino   = aDirRemoto + "wait.exe";
             |RFBORRA aDestino;
         |FINSI;
         |SI nSwBoton13 = 2;
             |SUB_EJECUTA_NP "dsmoy073;3";
             |HAZ Refresco;
         |FINSI;

     |FINSI;

     |SI nTecla = 23;  |Y nSwBoton15 = 1;
         |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 320;
          |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;  |O #dsmom004#3 = 303;
            |O #dsmom004#3 = 322;
             enTipoEntrada = 4;
             |SUB_EJECUTA_NP "dsmom047";
             |HAZ Refresco;
         |FINSI;
     |FINSI;

     |SI nTecla = 24;  |Y nSwBoton16 = 1;
         |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 310;
          |O #dsmom004#3 = 320;  |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;
          |O #dsmom004#3 = 303;  |O #dsmom004#3 = 353;
             |HAZ CambiaPago;
             |HAZ Refresco;
             |SI nCambio = 1;  |HAZ QuieresPasar390;  |FINSI;
         |FINSI;
     |FINSI;

|| \\\\\ Archivar o Desarchivar  ////////

     |SI nTecla = 25;  |Y nSwBoton17 = 1;
         |SI #dsmom004#13 = "X";
             |CONFI "0000NEsta seguro de dejar el Modelo como no Archivado";
             |SI FSalida ! 0;  |ACABA;  |FINSI;

             |SI #dsmom107#35 = "S";
                 |PUSHV 1424 1742;
                 |BLANCO 1424 1742;
                 |CUADRO 1424 1742;

                 |ATRI R;
                 |PINTA 1525, "    Password     ";
                 |ATRI 0;

                 E_inf = "";
                 E_sup = 10;

                 eaPass  = "";
                 eaPass  = 1628 ? -1;
                 |HAZ PonPassword;
                 |SI eaPass ! #dsmom107#34;
                     |MENAV "0000Password incorrecto.";
                     |POPV;
                     |ACABA;
                 |FINSI;

                 |POPV;
             |FINSI;

             |LEE 101#dsmom004.=;
             #dsmom004#13 = "";
             #dsmom004#14 = "01.01.0000";
             |GRABA 020#dsmom004.a;
             |LIBERA #dsmom004;
             |PINTA #dsmom004#13;
         |SINO;
             enArchi = 0;
             aAlfa = "0000NDesea Archivar el Modelo ";
             |SI #dsmom004#7 = " "; |Y #dsmom004#9 ! "X";
                 enArchi = 1;
                 aAlfa   = "0000NDesea Archivar el Modelo NO ELABORADO ";
             |FINSI;
             |CONFI aAlfa;
             |SI FSalida = 0;
                 aAlfa   = #dsmom004#3;
                 aAlfa   = "dsmoz007;" + aAlfa + "PLANING";
                 |SUB_EJECUTA_NP aAlfa;
                 |HAZ Refresco;
             |FINSI;
         |FINSI;
     |FINSI;

|| \\\\\ Archivar o Desarchivar  ////////
     |SI nTecla = 27;  |Y nSwBoton18 = 1;
        |SUB_EJECUTA_NP "dsmom900";
        |HAZ Refresco;
     |FINSI;

|| \\\\\ Formas de Pago

     |SI nTecla = 22;  |Y nSwBoton19 ! 0;
         |SI #dsmom004#7 = "X";
             |HAZ FormasDePago;
         |FINSI;
     |FINSI;

     |SI nTecla = 153;  |Y nSwBoton20 = 1;
         enCodCli = #dsmom004#0;
         |HAZ LeePersona;

         aAlfa = (("00000" + #dsmom004#0) % -105) + #dsmom004#1 + (("00" + #dsmom004#2) % -102);
         aAlfa = aAlfa + (("000" + #dsmom004#3) % -103) + (("00" + #dsmom004#4) % -102);
         aAlfa = aAlfa + #clientes@#1;

         aAlfa = "|:dsarchi/dsarz017;" + aAlfa;
         |SUB_EJECUTA aAlfa;
     |FINSI;

     |SI nTecla = 152;  |Y nSwBoton21 = 1;
         enCodCli = #dsmom004#0;
         |HAZ LeePersona;

         aAlfa = (("00000" + #dsmom004#0) % -105) + #dsmom004#1 + (("00" + #dsmom004#2) % -102);
         aAlfa = aAlfa + (("000" + #dsmom004#3) % -103) + (("00" + #dsmom004#4) % -102);
         aAlfa = aAlfa + #clientes@#1;

         |SI #dsmom004#3 = 130;  aAlfa = "|:modelos/dsmof130;" + aAlfa;  |FINSI;
         |SI #dsmom004#3 = 303;  aAlfa = "|:modelos/dsmof303;" + aAlfa;  |FINSI;

         |SUB_EJECUTA aAlfa;
     |FINSI;

|| \\\\\ Importaciones

     |SI nTecla = 148;  |Y nSwBoton23 = 1;
         enCodCli = #dsmom004#0;
         |HAZ LeePersona;

         aAlfa = (("00000" + #dsmom004#0) % -105) + #dsmom004#1 + (("00" + #dsmom004#2) % -102);
         aAlfa = aAlfa + (("000" + #dsmom004#3) % -103) + (("00" + #dsmom004#4) % -102);
         aAlfa = aAlfa + "00" + #clientes@#1;

         aAlfa = "|:modelos/dsmox001;" + aAlfa;
         |SUB_EJECUTA aAlfa;

         |HAZ Refresco;
     |FINSI;
|FPRC;

|PROCESO BorraElHis;
    |ABRE #dsmom024;
    #dsmom024#0 = #dsmom004#0;
    #dsmom024#1 = #dsmom004#1;
    #dsmom024#2 = #dsmom004#2;
    #dsmom024#3 = #dsmom004#3;
    #dsmom024#4 = #dsmom004#4;
    |LEE 040#dsmom024.=;
    |SI FSalida = 0;
        |BORRA 020#dsmom024.a;
        |CIERRA #dsmom024;
        enDEmpresa = #dsmom024#0; enHEmpresa = #dsmom024#0;
        enDEjer    = #dsmom024#1; enHEjer    = #dsmom024#1;
        enDModelo  = #dsmom024#3; enHModelo  = #dsmom024#3;
        |HAZ ReCalculaHis;
    |SINO;
        |CIERRA #dsmom024;
    |FINSI;

    |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 320;
     |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;  |O #dsmom004#3 = 303;
            |ABRE #dsmom082;
            #dsmom082#0 = #dsmom004#0;
            #dsmom082#1 = #dsmom004#1;
            #dsmom082#2 = #dsmom004#2;
            |LEE 141#dsmom082.=;
            |SI FSalida = 0;
                #dsmom082#61 = "S";
                |GRABA 020#dsmom082.a;
            |FINSI;
            |LIBERA #dsmom082;
            |CIERRA #dsmom082;
    |FINSI;
|FPRC;
