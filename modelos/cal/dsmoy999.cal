|FICHEROS;
     dsmoy000;
     dsmom003;
     dsmom004;
     dsmom023;
     dsmom024;
     dsmom082;
     dsmom108;
     dsmo7201;
     dsm182ca;

     dsmow014;
     dsmow052,MANTE;

     :/integral/def/dsam0124;
     :/integral/def/dsam0107;
     :/integral/def/dsam0009;

     dsmom107;
     &clientes@;
|FIN;

|VARIABLES;
     aDocRemoto    = "";
     aDocServidor  = "";
     aIPRemoto     = "";
     aPathMod      = "";
     aBarra        = "";
     aLongitud     = "";
     aJusti        = "";
     aExt          = "";
     aFich         = "";
     aFich1        = "";
     aFich2        = "";
     aPathLocal    = "";
     aPathServidor = "";
     aVersionBasico= "";
     aVersionJava  = "";
     aEjecutaJava  = "";
     aUnidadSistema = "";
     aProgFiles     = "";
     aPunto         = "";
     aLen           = "";
     aHora          = "";
     aSeg           = "";
     aDia           = "";
     aBase          = "";

     nCaracter     = 0;
     nLongitud     = 0;
     nCanal        = 0;
     nHandleEjec   = 0;
     nHandError    = 0;
     nDelBucle     = 0;
     nEstadoM23    = 0;
     nCopia        = 0;
     nHandle       = 0;
     nHay          = 0;
     nLen          = 0;
     nLenMax       = 0;
     nPaso         = 0;
     nAscci        = 0;
     nHora         = 0;
     nMinu         = 0;
     nSegu         = 0;
     nSeg          = 0;
     nDias         = 0;

     fFecha1       = @;
     fFecha2       = @;

     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDEjer    = 0;
     &enHEjer    = 0;
     &enDModelo  = 0;
     &enHModelo  = 0;
     &enHandle   = 0;
     &eaNomOfi   = "";
     &eaDSMAC    = "";
     &enEmp              = 0;
     &enEje              = 0;
     &enPer              = 0;
     &enMod              = 0;
     &enCom              = 0;
     &eaCamp9_11         = "";
     &efCamp9_12         = @;
     &eaCamp9_73         = "";

     {1}aContiene    = "";
     {1}version      = "";
     {51}aCarac      = "";
|FIN;

|INCLUYE i_varemi;
|INCLUYE i_modhis;

|PROCESO NoMeQuites;
||     |HAZ ModoRelacion;
|FPRC;

|PROCESO eVersionMod;
     eaNIFDs = "B53179768";

     |DBASE aBase;  |QBF aBase;
     aArchivo = aBase + "modelos.men";
     |XABRE "U", aArchivo, nCanal;
     |SI FSalida ] 0;
          |XLEE nCanal, 100, eaVersMod;
     |FINSI;
     |XCIERRA nCanal;
     |QBF eaVersMod;
     eaVersMod = eaVersMod % -105;
     eaVersMod = eaVersMod - ".";
     eaVersMod = (eaVersMod + "    ") % 104;
|FPRC;

|PROCESO PaisCCE;
     eSwPaisCCE = 0;
     eaPaisCCE  = eaPaisCCE > " ";
     eaPaisCCE  = (eaPaisCCE + "   ") % 103;

     |SI eaPaisCCE = "DE ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "AT ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "BE ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "BG ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "CY ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "DK ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "SI ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "EE ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "FI ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "FR ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "EL ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "GB ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "NL ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "HU ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "IT ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "IE ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "LV ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "LT ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "LU ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "MT ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "PL ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "PT ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "CZ ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "SK ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "RO ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "SE ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "GR ";  eSwPaisCCE = 1;  |FINSI;
     |SI eaPaisCCE = "HR ";  eSwPaisCCE = 1;  |FINSI;
|FPRC;

|PROCESO Conver10;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = ("0000000000" + enNume) % -110;
     |SINO;
         enNume  = -enNume;
         eaAlfa = ("0000000000" + enNume) % -109;
         eaAlfa = "N" + eaAlfa;
     |FINSI;
|FPRC;

|PROCESO Conver11;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = ("000000000000" + enNume) % -111;
     |SINO;
         enNume  = -enNume;
         eaAlfa = ("000000000000" + enNume) % -110;
         eaAlfa = "N" + eaAlfa;
     |FINSI;
|FPRC;

|PROCESO Conver12;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = ("000000000000" + enNume) % -112;
     |SINO;
         enNume  = -enNume;
         eaAlfa = ("000000000000" + enNume) % -111;
         eaAlfa = "N" + eaAlfa;
     |FINSI;
|FPRC;

|PROCESO Conver13;
     |SI #dsmoy000#0 = 390;  |O #dsmoy000#0 = 392;
         |SI #dsmoy000#6 ] 2004;
             |SI enNume = 0;
                 eaAlfa = ("0000000000000" + enNume) % -113;
             |SINO;
                 eaAlfa = enNume;
             |FINSI;

             |ACABA;
         |FINSI;
     |FINSI;

     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = ("0000000000000" + enNume) % -113;
     |SINO;
         enNume  = -enNume;
         eaAlfa = ("000000000000" + enNume) % -112;
         eaAlfa = "N" + eaAlfa;
     |FINSI;
|FPRC;

|PROCESO Conver12Signo;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaSigno = " ";
         eaAlfa  = ("0000000000000" + enNume) % -112;
     |SINO;
         eaSigno = "N";
         enNume  = -enNume;
         eaAlfa  = ("0000000000000" + enNume) % -112;
     |FINSI;
|FPRC;

|PROCESO Conver13Signo;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaSigno = " ";
         eaAlfa  = ("0000000000000" + enNume) % -113;
     |SINO;
         eaSigno = "N";
         enNume  = -enNume;
         eaAlfa  = ("0000000000000" + enNume) % -113;
     |FINSI;
|FPRC;

|PROCESO Conver14;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = ("000000000000000" + enNume) % -114;
     |SINO;
         enNume  = -enNume;
         eaAlfa = ("00000000000000" + enNume) % -113;
         eaAlfa = "N" + eaAlfa;
     |FINSI;
|FPRC;

|PROCESO Conver14Signo;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaSigno = " ";
         eaAlfa  = ("000000000000000" + enNume) % -114;
     |SINO;
         eaSigno = "N";
         enNume  = -enNume;
         eaAlfa = ("000000000000000" + enNume) % -114;
     |FINSI;
|FPRC;

|PROCESO Conver15;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = ("000000000000000" + enNume) % -115;
     |SINO;
         enNume  = -enNume;
         eaAlfa = ("00000000000000" + enNume) % -114;
         eaAlfa = "N" + eaAlfa;
     |FINSI;
|FPRC;

|PROCESO Conver15Signo;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaSigno = " ";
         eaAlfa  = ("000000000000000" + enNume) % -115;
     |SINO;
         eaSigno = "N";
         enNume  = -enNume;
         eaAlfa = ("000000000000000" + enNume) % -115;
     |FINSI;
|FPRC;

|PROCESO Conver16;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = ("00000000000000000" + enNume) % -116;
     |SINO;
         enNume  = -enNume;
         eaAlfa = ("000000000000000" + enNume) % -115;
         eaAlfa = "N" + eaAlfa;
     |FINSI;
|FPRC;

|PROCESO Conver16Signo;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = " " + (("0000000000000000" + enNume) % -115);
     |SINO;
         enNume  = -enNume;
         eaAlfa = "N" + (("000000000000000" + enNume) % -115);
     |FINSI;
|FPRC;

|PROCESO Conver17;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaAlfa = ("00000000000000000" + enNume) % -117;
     |SINO;
         enNume  = -enNume;
         eaAlfa = ("0000000000000000" + enNume) % -116;
         eaAlfa = "N" + eaAlfa;
     |FINSI;
|FPRC;

|PROCESO Conver17Signo;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;

     |SI enNume ] 0;
         eaSigno = " ";
         eaAlfa  = ("00000000000000000" + enNume) % -117;
     |SINO;
         eaSigno = "N";
         enNume  = -enNume;
         eaAlfa = ("00000000000000000" + enNume) % -117;
     |FINSI;
|FPRC;

|PROCESO MiraAscii;
     nHay = 0;

     |SI nAscci < 32;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 33;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 34;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 35;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 36;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 37;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 42;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 43;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 60;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 61;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 62;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 63;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 64;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 91;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 92;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 93;  nHay = 1;  |ACABA;  |FINSI;
     |SI nAscci = 94;  nHay = 1;  |ACABA;  |FINSI;

     |SI nAscci ] 96;  |Y nAscci [ 198;
         nHay = 1;  |ACABA;
     |FINSI;

     |SI nAscci ] 200;  |Y nAscci [ 208;
         nHay = 1;  |ACABA;
     |FINSI;

     |SI nAscci ] 210;
         nHay = 1;  |ACABA;
     |FINSI;
|FPRC;

|PROCESO RarosModelos;
     nEspa   = 0;
     aCadena = "";
     aLong   = eaAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;

           nAscci    = &aCaracter;
           |HAZ MiraAscii;
           |SI nHay = 1;
               aCaracter = " ";
           |FINSI;

           |SI aCaracter = ",";
               aCaracter = "";  nEspa = nEspa + 1;
           |FINSI;

           |SI #dsmoy000#0 ! 347;  |Y #dsmoy000#0 ! 390;  |Y #dsmoy000#0 ! 392;
               |SI aCaracter = ".";  aCaracter = " ";  |FINSI;
           |FINSI;

           |SI #dsmoy000#0 = 390;  |O #dsmoy000#0 = 392;
               |SI #dsmoy000#6 [ 2003;
                   |SI aCaracter = ".";  aCaracter = " ";  |FINSI;
               |FINSI;
           |FINSI;

           |SI aCaracter = "/";  aCaracter = " ";  |FINSI;
           |SI aCaracter = "•";  aCaracter = &209; |FINSI;
           |SI aCaracter = "§";  aCaracter = &209; |FINSI;
           |SI aCaracter = "ß";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¶";  aCaracter = &170; |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;

     eaAlfa = aCadena + (" " * nEspa);
     eaAlfa = eaAlfa > "";
|FPRC;

|PROCESO QuitaRaros;
     aAlfa = eaAlfa;  |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     |SI #dsmoy000#0 ! 0; |O enModelo = 210; |O enModelo = 211; |O enModelo = 213;
         eaAlfa = eaAlfa > "";
     |FINSI;

     aCarac1   = "•";
     aCarac2   = "§";
     aCarac3   = "·";
     aCarac4   = "†";
     aCarac5   = "Ç";
     aCarac6   = "°";
     aCarac7   = "¢";
     aCarac8   = "£";
     aCarac9   = "ß";
     aCarac10  = "¶";
     aCarac11  = "®";
     aCarac12  = "Ä";
     aCarac13  = "á";
     aCarac14  = "Ö";
     aCarac15  = "ä";
     aCarac16  = "ç";
     aCarac17  = "ï";
     aCarac18  = "ó";
     aCarac19  = &001;
     aCarac20  = &002;
     aCarac21  = &003;
     aCarac22  = &004;
     aCarac23  = &005;
     aCarac24  = &006;
     aCarac25  = &007;
     aCarac26  = &015;
     aCarac27  = &016;
     aCarac28  = &017;
     aCarac29  = &018;
     aCarac30  = &019;
     aCarac31  = &020;
     aCarac32  = &021;
     aCarac33  = &022;
     aCarac34  = &023;
     aCarac35  = &024;
     aCarac36  = &025;
     aCarac37  = &026;
     aCarac38  = &028;
     aCarac39  = &029;
     aCarac40  = "Å";
     aCarac41  = &008;
     aCarac42  = "Ô";
     aCarac43  = "µ";
     aCarac44  = "ê";
     aCarac45  = "÷";
     aCarac46  = "‡";
     aCarac47  = "È";
     aCarac48  = &009;
     aCarac49  = &010;
     aCarac50  = &013;
     aCarac51  = "∫";

     IaCarac = aCarac1 <-;
     nHay    = 0;
     |PARA nCampo = 1;  |SI nCampo [ 51;  |HACIENDO nCampo = nCampo + 1;
           aCaracter = eaAlfa - aCarac;
           |SI FSalida ! 0;
               nHay = 1;
               |SAL;
           |FINSI;

           IaCarac = IaCarac + 1;
     |SIGUE;

     |SI nHay = 0;
         |HAZ RarosModelos;
         |ACABA;
     |FINSI;

     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;
     nLenMax = nLen - 1;

     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           nPaso     = 0;
           nAscci    = &aCaracter;

           |SI aCaracter = aCarac1;  |Y nPaso = 0;  aCaracter = &0209;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac2;  |Y nPaso = 0;  aCaracter = &0241;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac3;  |Y nPaso = 0;  aCaracter = &0225;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac4;  |Y nPaso = 0;  aCaracter = &0225;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac5;  |Y nPaso = 0;  aCaracter = &0233;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac6;  |Y nPaso = 0;  aCaracter = &0237;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac7;  |Y nPaso = 0;  aCaracter = &0243;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac8;  |Y nPaso = 0;  aCaracter = &0250;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac9;  |Y nPaso = 0;  aCaracter = &0176;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac10; |Y nPaso = 0;  aCaracter = &0170;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac11; |Y nPaso = 0;  aCaracter = &0191;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac12; |Y nPaso = 0;  aCaracter = "«";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac13; |Y nPaso = 0;  aCaracter = &0231;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac14; |Y nPaso = 0;  aCaracter = &0224;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac15; |Y nPaso = 0;  aCaracter = &0232;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac16; |Y nPaso = 0;  aCaracter = &0236;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac17; |Y nPaso = 0;  aCaracter = &0242;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac18; |Y nPaso = 0;  aCaracter = &0249;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac19; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac20; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac21; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac22; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac23; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac24; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac25; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac26; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac27; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac28; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac29; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac30; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac31; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac32; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac33; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac34; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac35; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac36; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac37; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac38; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac39; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac40; |Y nPaso = 0;  aCaracter = &252;    nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac41; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac42; |Y nPaso = 0;  aCaracter = "¥";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac43; |Y nPaso = 0;  aCaracter = "A";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac44; |Y nPaso = 0;  aCaracter = "E";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac45; |Y nPaso = 0;  aCaracter = "I";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac46; |Y nPaso = 0;  aCaracter = "O";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac47; |Y nPaso = 0;  aCaracter = "U";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac48; |Y nPaso = 0;  aCaracter = " ";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac51; |Y nPaso = 0;  aCaracter = &0176;   nPaso = 1;  |FINSI;

           |SI aCaracter = aCarac49;   || Un retorno de carro
               |SI nCampo < nLenMax;
                   aCaracter = "";
               |SINO;
                   nLenMax = nLen;
               |FINSI;
           |FINSI;

           |SI aCaracter = aCarac50;
               |SI nCampo < nLenMax;
                   aCaracter = "";
               |SINO;
                   nLenMax = nLen;
               |FINSI;
           |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;

     eaAlfa = aCadena;

     |HAZ RarosModelos;
|FPRC;

|PROCESO PonRarosUTF8;
     aAlfa = eaAlfa;  |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     aCarac1   = &209;

     IaCarac = aCarac1 <-;
     nHay    = 0;
     |PARA nCampo = 1;  |SI nCampo [ 1;  |HACIENDO nCampo = nCampo + 1;
           aCaracter = eaAlfa - aCarac;
           |SI FSalida ! 0;
               nHay = 1;
               |SAL;
           |FINSI;

           IaCarac = IaCarac + 1;
     |SIGUE;

     |SI nHay = 0;
         |ACABA;
     |FINSI;

     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;
     nLenMax = nLen - 1;

     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           nPaso     = 0;
           nAscci    = &aCaracter;

           |SI aCaracter = aCarac1;  aCaracter = "√ë";  |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;

     eaAlfa = aCadena;
|FPRC;

|PROCESO QuitaRarosTfno;
     aCadena = eaAlfa % 101;
     |SI aCadena = "0";
         eaAlfa = eaAlfa % 215;
     |FINSI;

     aCadena = "";
     aLong   = eaAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           |SI aCaracter = "0";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "1";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "2";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "3";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "4";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "5";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "6";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "7";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "8";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "9";  aCadena = aCadena + aCaracter;  |FINSI;
     |SIGUE;
     eaAlfa = aCadena;  |QBT eaAlfa;
     eaAlfa = eaAlfa > eaAlfa;
|FPRC;

|PROCESO LeeTelefono;
     |ABRE #dsam0107;
     #dsam0107#0 = eaAlfa;
     #dsam0107#1 = enLinea;
     |LEE 040#dsam0107.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0107;  |FINSI;
     |CIERRA #dsam0107;

     eaAlfa = #dsam0107#4;  |HAZ QuitaRarosTfno;
|FPRC;

|PROCESO LeeMail;
     |ABRE #dsam0124;
     #dsam0124#0 = eaAlfa;
     #dsam0124#1 = enLinea;
     |LEE 040#dsam0124.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0124;  |FINSI;
     |CIERRA #dsam0124;

     eaAlfa = #dsam0124#3;
|FPRC;

|PROCESO FechaBonito;
     aAlfa1 = eaAlfa % 102;
     aAlfa2 = eaAlfa % 402;
     aAlfa3 = eaAlfa % 704;

     |SI aAlfa2 = "01";  aAlfa2 = "ENERO     ";  |FINSI;
     |SI aAlfa2 = "02";  aAlfa2 = "FEBRERO   ";  |FINSI;
     |SI aAlfa2 = "03";  aAlfa2 = "MARZO     ";  |FINSI;
     |SI aAlfa2 = "04";  aAlfa2 = "ABRIL     ";  |FINSI;
     |SI aAlfa2 = "05";  aAlfa2 = "MAYO      ";  |FINSI;
     |SI aAlfa2 = "06";  aAlfa2 = "JUNIO     ";  |FINSI;
     |SI aAlfa2 = "07";  aAlfa2 = "JULIO     ";  |FINSI;
     |SI aAlfa2 = "08";  aAlfa2 = "AGOSTO    ";  |FINSI;
     |SI aAlfa2 = "09";  aAlfa2 = "SEPTIEMBRE";  |FINSI;
     |SI aAlfa2 = "10";  aAlfa2 = "OCTUBRE   ";  |FINSI;
     |SI aAlfa2 = "11";  aAlfa2 = "NOVIEMBRE ";  |FINSI;
     |SI aAlfa2 = "12";  aAlfa2 = "DICIEMBRE ";  |FINSI;

     |QBF aAlfa2;
     eaFechaB = aAlfa1 + " de " + aAlfa2 + " de " + aAlfa3;
     eaDiaB   = aAlfa1;
     eaMesB   = aAlfa2;
     eaAnyoB  = aAlfa3;
|FPRC;

|PROCESO TraeWait;
     aPathLocal  = eaPathLanza;

     |DBASE aPathPdf;  |QBT aPathPdf;
     aPathPdf = aPathPdf + "plugins";                    |MKDIR aPathPdf;
     aOrigen  = aPathPdf   + "/wait.exe";
     aDestino = aPathLocal + "wait.exe";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;

     aOrigen  = aPathPdf   + "/dsprint.exe";
     aDestino = aPathLocal + "dsprint.exe";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO TraeSoloWait;
     aPathLocal  = eaPathLanza;

     |DBASE aPathPdf;  |QBT aPathPdf;
     aPathPdf = aPathPdf + "plugins";                    |MKDIR aPathPdf;
     aOrigen  = aPathPdf   + "/wait.exe";
     aDestino = aPathLocal + "wait.exe";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO RecibeFichero999;
     enCopiado = 0;

     aContiene1 = eaFDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaFOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |RECIBE_FICHERO eaFOrigen, eaFDestino;
         |SINO;
             |COPIA_FICHERO eaFOrigen, eaFDestino;
         |FINSI;

         enCopiado = 1;
     |FINSI;
|FPRC;

|PROCESO CopiaFichero;
     enCopiado = 0;

     aContiene1 = eaFDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaFOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaFOrigen, eaFDestino;
         |SINO;
             |COPIA_FICHERO eaFOrigen, eaFDestino;
         |FINSI;

         enCopiado = 1;
     |FINSI;
|FPRC;

|PROCESO CopiaFicheroXml;
     aContiene1 = eaFDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaFOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     nCopia    = 0;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaFOrigen, eaFDestino;
         |SINO;
             |COPIA_FICHERO eaFOrigen, eaFDestino;
         |FINSI;
         nCopia = 1;
     |FINSI;

     |XABRE "EC", eaFDestino, nHandleEjec;
     |SI FSalida < 0;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaFOrigen, eaFDestino;
         |SINO;
             |COPIA_FICHERO eaFOrigen, eaFDestino;
         |FINSI;
     |FINSI;

     |XABRE "EC", eaFDestino, nHandleEjec;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |SI nCopia = 1;
         |RDESCOMPRIME eaFDestino;

         eaFDestino = (eaFDestino - ".tgz") + ".tar";
         aPathMod   = eaPathLanza;
         |RDETAR eaFDestino, aPathMod;

         |RFBORRA eaFDestino;
     |FINSI;
|FPRC;

|RUTINA ClaveBaja952;
     #dsmow052#0 = "            ";
|FRUT;

|RUTINA ClaveAlta952;
     #dsmow052#0 = "zzzzzzzzzzzz";
|FRUT;

|PROCESO Tipo11w052;  |TIPO 11;
     |SI FSalida = 10;
         aPunto = #dsmow052#0;  |QBF aPunto;
         aPunto = aPunto % -401;

         |SI aPunto ! ".";
             aAlfa = "EDIT " + eaPathSesion + #dsmow052#0;
         |SINO;
             aAlfa = "START " + eaPathSesion + #dsmow052#0;
         |FINSI;

         |RSYSTEM aAlfa;
     |FINSI;

     |SI FSalida = 11;
         |SI #dsmow052#1 ! 0;
             aFichero = eaFichDatos + (#dsmow052#0 % 0412);
         |SINO;
             aFichero = eaFichDatos;
         |FINSI;

         aPunto = #dsmow052#0;  |QBF aPunto;
         aPunto = aPunto % -401;

         |SI aPunto ! ".";
             aAlfa = "EDIT " + eaPathSesion + aFichero;
         |SINO;
             aAlfa = "START " + eaPathSesion + aFichero;
         |FINSI;

         |RSYSTEM aAlfa;
     |FINSI;

     |SI FSalida = 12;
         |SI eaFichAuxil = "";  |ACABA;  |FINSI;

         |SI #dsmow052#1 ! 0;
             aFichero = eaFichAuxil + (#dsmow052#0 % 0412);
         |SINO;
             aFichero = eaFichAuxil;
         |FINSI;

         aPunto = #dsmow052#0;  |QBF aPunto;
         aPunto = aPunto % -401;

         |SI aPunto ! ".";
             aAlfa = "EDIT " + eaPathSesion + aFichero;
         |SINO;
             aAlfa = "START " + eaPathSesion + aFichero;
         |FINSI;

         |RSYSTEM aAlfa;
     |FINSI;
|FPRC;

|PROCESO BorraDirectorio;
     aDirSesion  = eaPathLanza;
     aFichero    = aDirSesion + "*";  |QBT aFichero;
     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;
            aAlfa = (aFichero % -104) < "";
            |SI aAlfa ! ".exe";   |Y aAlfa ! ".tgz";
             |Y aAlfa ! ".jar";   |Y aAlfa ! ".bat";
                |RFBORRA aFichero;
            |FINSI;
            |R_SDIR aFichero;
     |SIGUE;
|FPRC;

|PROCESO QuitaPath;
     aLong  = aFichero % 0;
     nLong  = aLong;
     aError = "";
     |PARA nCaracter = 1; |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (nCaracter * 100) + 1;
           aCaracter = aFichero % nPos;
           |SI aCaracter = "/";  |O aCaracter = "\";
               aError = "";
           |SINO;
               aError = aError + aCaracter;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO DesGrabaResumen;
  enModelo = #dsmom004#3;
  |HAZ SelModelo;
  |SI nSwModHis = 0; |ACABA; |FINSI;

  |ABRE #dsmom024;
  #dsmom024#0 = #dsmom004#0;
  #dsmom024#1 = #dsmom004#1;
  #dsmom024#2 = #dsmom004#2;
  #dsmom024#3 = #dsmom004#3;
  #dsmom024#4 = #dsmom004#4;
  |LEE 141#dsmom024.=;
  |SI FSalida = 0;
      |BORRA 020#dsmom024.a;
      |LIBERA #dsmom024;
      enDEmpresa = #dsmom024#0; enHEmpresa = #dsmom024#0;
      enDEjer    = #dsmom024#1; enHEjer    = #dsmom024#1;
      enDModelo  = #dsmom024#3; enHModelo  = #dsmom024#3;
      |HAZ ReCalculaHis;
  |FINSI;
  |LIBERA #dsmom024;
  |CIERRA #dsmom024;
|FPRC;

|PROCESO GrabaResumen;
  enModelo = #dsmom004#3;
  |HAZ SelModelo;
  |SI nSwModHis = 0; |ACABA; |FINSI;

  |ABRE #dsmom024;
  |ABRE #dsmom023;

  |ABRE #dsmom003;
  #dsmom003#0 = #dsmom004#0;
  #dsmom003#1 = #dsmom004#1;
  #dsmom003#2 = #dsmom004#2;
  |LEE 001#dsmom003.=;
  |SI FSalida ! 0;    |DDEFECTO #dsmom003;  |FINSI;
  |CIERRA #dsmom003;

  #dsmom023#0 = #dsmom004#0;
  #dsmom023#1 = #dsmom004#1;
  #dsmom023#2 = #dsmom004#3;
  |LEE 101#dsmom023.=;
  nEstadoM23 = FSalida;
  |SI nEstadoM23 ! 0;
      |DDEFECTO #dsmom023;
      #dsmom023#0 = #dsmom004#0;
      #dsmom023#1 = #dsmom004#1;
      #dsmom023#2 = #dsmom004#3;
      #dsmom023#3 = #dsmoy000#1;
      |GRABA 020#dsmom023.b;
  |FINSI;

  #dsmom024#0 = #dsmom004#0;
  #dsmom024#1 = #dsmom004#1;
  #dsmom024#2 = #dsmom004#2;
  #dsmom024#3 = #dsmom004#3;
  #dsmom024#4 = #dsmom004#4;
  |LEE 141#dsmom024.=;
  |SI FSalida ! 0;
      |DDEFECTO #dsmom024;
      #dsmom024#0  = #dsmom004#0;
      #dsmom024#1  = #dsmom004#1;
      #dsmom024#2  = #dsmom004#2;
      #dsmom024#3  = #dsmom004#3;
      #dsmom024#4  = #dsmom004#4;
      #dsmom024#12 = #dsmom003#3;
      |GRABA 020#dsmom024.b;
  |FINSI;

  #dsmom024#6 = #dsmom004#7;   ||Entrada
  #dsmom024#7 = #dsmom004#8;   ||Fecha Entrada
  #dsmom024#8 = #dsmom004#15;  ||Resultado
  |SI #dsmom024#8 ] 0;
      #dsmom024#9 = #dsmom024#8;
      #dsmom024#10 = 0;
      #dsmom024#11 = 0;
  |SINO;
       #dsmom024#9  = 0;
       aAlfa = #dsmom004#16; |QBF aAlfa;
       |SI aAlfa ! "";
           #dsmom024#11 = - #dsmom024#8;
           #dsmom024#10 = 0;
       |SINO;
           #dsmom024#10 = - #dsmom024#8;
           #dsmom024#11 = 0;
       |FINSI;
   |FINSI;

   aAlfa = #dsmom024#3; aAlfa = aAlfa % 101;
   |SI aAlfa ! "3";
       enImpReal = #dsmom024#8;
   |SINO;
       #dsmom024#9  = enIngresar;
       #dsmom024#10 = enDevolver;
       #dsmom024#11 = enCompensar;
       #dsmom024#13 = enImpReal;
       #dsmom024#14 = enCas21;
       #dsmom024#15 = enCas27;
       #dsmom024#16 = enCas31;
       #dsmom024#17 = enCas34;
   |FINSI;
   #dsmom024#13 = enImpReal;
   |GRABA 020#dsmom024.a;
   |LIBERA #dsmom024;
   |CIERRA #dsmom024;

   |SI nEstadoM23 ! 0;
       #dsmom023#4 = #dsmom023#4 + #dsmom024#9;
       #dsmom023#5 = #dsmom023#5 + #dsmom024#10;
       #dsmom023#6 = #dsmom023#4 - #dsmom023#5;
       |GRABA 020#dsmom023.a;
   |FINSI;
   |LIBERA #dsmom023;
   |CIERRA #dsmom023;

   |SI nEstadoM23 = 0;
       enDEmpresa = #dsmom023#0; enHEmpresa = #dsmom023#0;
       enDEjer    = #dsmom023#1; enHEjer    = #dsmom023#1;
       enDModelo  = #dsmom023#2; enHModelo  = #dsmom023#2;
       |HAZ ReCalculaHis;
   |FINSI;

   enImpReal = 0;
   enCas21 = 0;
   enCas27 = 0;
   enCas31 = 0;
   enCas34 = 0;
   enIngresar = 0;
   enDevolver = 0;
   enCompensar= 0;
|FPRC;

|PROCESO DesGrabaImpreso;
     |ABRE #dsmom107;
     |DDEFECTO #dsmom107;
     |LEE 000#dsmom107.p;
     |CIERRA #dsmom107;

     |ABRE #dsmom004;
     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = #dsmow014#5;
     #dsmom004#4  = #dsmow014#7;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#9  = " ";
         #dsmom004#10 = "01.01.0000";
         #dsmom004#19 = "";
         #dsmom004#25 = "";
         |SI #dsmom107#15 = "S";
             #dsmom004#13 = "";
             #dsmom004#14 = "01.01.0000";
         |FINSI;
         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
         |HAZ DesGrabaResumen;
     |FINSI;
     |CIERRA #dsmom004;

     |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 320;
      |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;  |O #dsmom004#3 = 303;
            |ABRE #dsmom082;
            #dsmom082#0 = #dsmom004#0;
            #dsmom082#1 = #dsmom004#1;
            #dsmom082#2 = #dsmom004#2;
            |LEE 141#dsmom082.=;
            |SI FSalida = 0;
                #dsmom082#61 = "S";
                |GRABA 020#dsmom082.a;
            |FINSI;
            |LIBERA #dsmom082;
            |CIERRA #dsmom082;
     |FINSI;
|FPRC;

|PROCESO GrabaImpreso;
     |ABRE #dsmom107;
     |DDEFECTO #dsmom107;
     |LEE 000#dsmom107.p;
     |CIERRA #dsmom107;

     |SI #dsmow014#5 = 182; |ACABA; |FINSI;
     |SI #dsmow014#5 = 720; |ACABA; |FINSI;
     |SI #dsmow014#5 = 583; |ACABA; |FINSI;

     |SI enInternet ! 0;
         |SI enModelo = 347;
             aOrigen    = aDirSesion + eaFichDatos + (("00000" + #dsmow014#0) % -105) + ".txt";
             aDestino   = eaPathInternet + eaFichDatos + (("00000" + #dsmow014#0) % -105) + ".txt";
             |RCOPIA_FICHERO aOrigen, aDestino;

             |RFBORRA aOrigen;
         |FINSI;

         aAlfa = aDirSesion + "AUXILIAR.TXT";
         |RFBORRA aAlfa;

         aAlfa = aDirSesion + "jus" + (("00000" + #dsmow014#0) % -105) + ".xml";
         |RFBORRA aAlfa;

         aAlfa = aDirSesion + eaFichError + #dsmoy000#6 + ".RST";
         |RFBORRA aAlfa;

         aAlfa = aDirSesion + eaFichError + (("00000" + #dsmow014#0) % -105) + ".RST";
         |RFBORRA aAlfa;
     |FINSI;

     aJusti  = "";

     |SI enInternet = 0;
         aAbre   = aDirSesion + "jus" + (("00000" + #dsmow014#0) % -105) + ".xml";
         |XABRE "C", aAbre, nHandleEjec;
         |SI FSalida ] 0;
             |PARA;  |SI FSalida ] 0;  |HACIENDO;
                  |XLEE nHandleEjec, 250, aAlfa;

                  aAlfa = aAlfa - "<Justif>";
                  |SI FSalida ! 0;
                      aAlfa  = aAlfa - "</Justif>";  |QBT aAlfa;
                      aAlfa  = aAlfa - "<RST>";      |QBT aAlfa;
                      aAlfa  = aAlfa - "</RST>";     |QBT aAlfa;
                      aJusti = aAlfa % -113;
                      |SAL;
                  |FINSI;
              |SIGUE;
         |FINSI;
         |XCIERRA nHandleEjec;

         |RFBORRA aAbre;

         |SI aJusti = "";
             aAbre   = aDirSesion + eaFichError + (("00000" + #dsmow014#0) % -105) + ".RST";
             |XABRE "C", aAbre, nHandleEjec;
             |SI FSalida ] 0;
                 |XLEE nHandleEjec, 250, aJusti;
             |FINSI;
             |XCIERRA nHandleEjec;

             |RFBORRA aAbre;
         |FINSI;
     |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = #dsmow014#5;
     #dsmom004#4  = #dsmow014#7;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#9  = "X";
         #dsmom004#10 = #dsmoy000#7;

         |QBF aJusti;
         aAlfa = aJusti % 0;
         nNume = aAlfa;

         |SI nNume [ 13;
             #dsmom004#25 = aJusti;
         |SINO;
             #dsmom004#19 = aJusti;
         |FINSI;

         |SI #dsmom107#15 = "S";
             #dsmom004#13 = "X";
             #dsmom004#14 = #dsmoy000#7;
         |FINSI;
         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
         |HAZ GrabaResumen;
     |FINSI;
     |CIERRA #dsmom004;

     |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 320;
      |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;  |O #dsmom004#3 = 303;
            |ABRE #dsmom082;
            #dsmom082#0 = #dsmom004#0;
            #dsmom082#1 = #dsmom004#1;
            #dsmom082#2 = #dsmom004#2;
            |LEE 141#dsmom082.=;
            |SI FSalida = 0;
                #dsmom082#61 = "N";
                |GRABA 020#dsmom082.a;
            |FINSI;
            |LIBERA #dsmom082;
            |CIERRA #dsmom082;
     |FINSI;
|FPRC;

|DEFBUCLE dsmow014G;
     #dsmow014#1;
     6;
     00001, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, GrabaImpreso;
|FIN;

|PROCESO ErroresValidacion;
     |ABRE #dsmow014;

     enError     = 0;
     aDirSesion  = eaPathLanza;
     eaPathSesion = eaPathLanza;
     aPathInter  = eaPathLanza + "AInternet"; |RMKDIR aPathInter;
     aPathInter  = aPathInter + "\";

     aAlfa = aDirSesion + "imprime.bat";
     |RFBORRA aAlfa;

     aFichero    = aPathInter + eaFichDatos + "*.bue";  |QBT aFichero;
     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |RFBORRA aFichero;

            |R_SDIR aFichero;
     |SIGUE;

     aFichero    = aDirSesion + eaFichDatos + "*.txt";  |QBT aFichero;
     enBuenos    = 0;
     enMalos     = 0;

     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |HAZ QuitaPath;

            aAlfa  = aError % 405;
            #dsmow014#0 = aAlfa;
            |LEE 040#dsmow014.=;
            |SI FSalida = 0;
                aAlfa = aDirSesion + eaFichError + (aError % 405) + ".txt";
                |XABRE "EC", aAlfa, nHandError;
                |SI FSalida < 0;
                    enBuenos = enBuenos + 1;
                    aOrigen  = aFichero;
                    aDestino = aPathInter + eaFichDatos + (aError % 405) + ".bue";
                    |RCOPIA_FICHERO aOrigen, aDestino;

                    |RFBORRA aOrigen;

                    aAlfa = aDirSesion + eaFichError + (aError % 405) + ".RST";
                    |RFBORRA aAlfa;

                    |SI eaFichAuxil ! "";
                        aAlfa = aDirSesion + eaFichAuxil + (aError % 405) + ".txt";
                        |RFBORRA aAlfa;
                    |FINSI;
                |SINO;
                    enMalos = enMalos + 1;
                |FINSI;
            |FINSI;
            |R_SDIR aFichero;
     |SIGUE;
     |CIERRA #dsmow014;

     |SI enBuenos ! 0;
         nDelBucle = 1; |BUCLE dsmow014G; nDelBucle = 0;
     |FINSI;
     |SI enMalos = 0;
         |ACABA;
     |FINSI;

     aFichero = ("52" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dsmow052#aFichero#;
     |ABRE #dsmow052;  |CIERRA #dsmow052;  |DELINDEX #dsmow052;

     |ABRE #dsmow052;
     |ABRE #dsmow014;

     aFichero    = aDirSesion + eaFichError + "*.txt";  |QBT aFichero;
     nHePasado   = 0;

     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |HAZ QuitaPath;
            aAlfa  = aError % 405;
            #dsmow014#0 = aAlfa;
            |LEE 040#dsmow014.=;
            |SI FSalida = 0;
                nHePasado  = 1;
                #dsmow052#0     = aError;
                #dsmow052#1     = #dsmow014#0;
                #dsmow052#2     = #dsmow014#3;
                |GRABA 040#dsmow052.n;
                |LIBERA #dsmow052;
            |FINSI;
            |R_SDIR aFichero;
     |SIGUE;
     |CIERRA #dsmow052;
     |CIERRA #dsmow014;

     |SI nHePasado = 0;
         |DELINDEX #dsmow052;

         nDelBucle = 1; |BUCLE dsmow014G; nDelBucle = 0;

         |ACABA;
     |FINSI;

     |PUSHV 0501 2380;
     enError = 1;
     |ENTLINEAL #1#dsmow052, -1, 4, 22, 1, ClaveBaja952, ClaveAlta952;
     |POPV;

     |ABRE #dsmow052;
     |ABRE #dsmow014;

     aFichero    = aDirSesion + eaFichDatos + "*.txt";  |QBT aFichero;
     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |HAZ QuitaPath;
            aError = eaFichError + (aError % 0412);
            aAlfa  = aError;
            #dsmow052#0 = aAlfa;
            |LEE 040#dsmow052.=;
            |SI FSalida ! 0;
                aAlfa = aDirSesion + eaFichDatos + (aError % 0412);
                |RFBORRA aAlfa;

                aAlfa = aDirSesion + eaFichError + (aError % 0405) + ".RST";
                |RFBORRA aAlfa;

                |SI eaFichAuxil ! "";
                    aAlfa = aDirSesion + eaFichAuxil + (aError % 0412);
                    |RFBORRA aAlfa;
                |FINSI;

                aAlfa = aError % 0405;
                #dsmow014#0 = aAlfa;
                |LEE 040#dsmow014.=;
                |SI FSalida = 0;
                    |HAZ GrabaImpreso;
                |FINSI;
            |SINO;
                aAlfa = aError % 0405;
                #dsmow014#0 = aAlfa;
                |LEE 040#dsmow014.=;
                |SI FSalida = 0;
                    |HAZ DesGrabaImpreso;

                    aAlfa = aDirSesion + eaFichDatos + (aError % 0412);
                    |RFBORRA aAlfa;

                    aAlfa = aDirSesion + eaFichError + (aError % 0405) + ".TXT";
                    |RFBORRA aAlfa;

                    |SI eaFichAuxil ! "";
                        aAlfa = aDirSesion + eaFichAuxil + (aError % 0412);
                        |RFBORRA aAlfa;
                    |FINSI;
                |FINSI;
            |FINSI;
            |R_SDIR aFichero;
     |SIGUE;
     |CIERRA #dsmow052;
     |CIERRA #dsmow014;

     |DELINDEX #dsmow052;

     aAlfa = aDirSesion + "imprime.bat";
     |RFBORRA aAlfa;
|FPRC;

|PROCESO BuscaErroresL;
     |SI enValidacion = 1;
         |HAZ ErroresValidacion;
         |ACABA;
     |FINSI;

     aFichero = ("52" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dsmow052#aFichero#;
     |ABRE #dsmow052;  |CIERRA #dsmow052;  |DELINDEX #dsmow052;

     |ABRE #dsmow052;
     |ABRE #dsmow014;

     enError       = 0;
     nHePasado     = 0;
     aDirSesion    = eaPathLanza;
     eaPathSesion  = eaPathLanza;
     |SI eaExtension = "";
         aFichero    = aDirSesion + eaFichError + "*.txt";  |QBT aFichero;
     |SINO;
         aFichero    = aDirSesion + eaFichError + "*.xml";  |QBT aFichero;
     |FINSI;

     aAlfa = aDirSesion + "imprime.bat";
     |RFBORRA aAlfa;

     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |HAZ QuitaPath;

            aAlfa  = aError % 405;
            #dsmow014#0 = aAlfa;
            |LEE 040#dsmow014.=;
            |SI FSalida = 0;
                nHePasado  = 1;
                #dsmow052#0     = aError;
                #dsmow052#1     = #dsmow014#0;
                #dsmow052#2     = #dsmow014#3;
                |GRABA 040#dsmow052.n;
                |LIBERA #dsmow052;
            |SINO;
                aAlfa  = aError % 404;
                nNume  = aAlfa;
                |SI #dsmow014#1 = nNume;
                    nHePasado  = 1;
                    #dsmow052#0     = aError;
                    #dsmow052#1     = 0;
                    #dsmow052#2     = "SOPORTE MAGNETICO";
                    |GRABA 040#dsmow052.n;
                    |LIBERA #dsmow052;
                |FINSI;
            |FINSI;
            |R_SDIR aFichero;
     |SIGUE;
     |CIERRA #dsmow052;
     |CIERRA #dsmow014;

     |SI nHePasado = 0;
         |SI eaExtension ! "";
             nDelBucle = 1; |BUCLE dsmow014G; nDelBucle = 0;
             |HAZ BorraDirectorio;
             |ACABA;
         |FINSI;

         aFichero    = aDirSesion + "*.*";  |QBT aFichero;
         |R_PDIR aFichero;
         |PARA; |SI; |HACIENDO;
                |SI FSalida ! 0; |SAL; |FINSI;

                aAlfa  = aFichero < "";
                aAlfa1 = aAlfa - "auxiliar.txt";
                |SI aAlfa = aAlfa1;
                    |SI enInternet ! 0;
                        aInter = aAlfa % -112;
                        aAlfa = (aInter % 103) < "";
                        |SI aAlfa = "int";
                            eaFOrigen  = aFichero;
                            eaFDestino = eaPathInternet + aInter;
                            |RCOPIA_FICHERO eaFOrigen, eaFDestino;
                        |FINSI;
                    |FINSI;

                    aExt = (aFichero % -103) < "";
                    aFich = aFichero % -1003;
                    aFich1 = aFichero % -904;
                    aFich2 = aFichero % -704;
                    |SI aExt ! "rst";  |Y aExt ! "exe";
                        |SI enInternet = 0;
                            |RFBORRA aFichero;
                        |SINO;
                            |SI aFich ! "opa"; |Y aFich1 ! "rtpa";
                            |Y aFich2 ! "ce20";
                                |RFBORRA aFichero;
                            |FINSI;
                        |FINSI;
                    |FINSI;
                |FINSI;
               |R_SDIR aFichero;
         |SIGUE;

         |DELINDEX #dsmow052;

         nDelBucle = 1; |BUCLE dsmow014G; nDelBucle = 0;

         |ACABA;
     |FINSI;

     |PUSHV 0501 2380;
     enError = 1;
     |ENTLINEAL #1#dsmow052, -1, 4, 22, 1, ClaveBaja952, ClaveAlta952;
     |POPV;

     |ABRE #dsmow052;
     |ABRE #dsmow014;
     aFichero    = aDirSesion + "*.*";  |QBT aFichero;

     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |HAZ QuitaPath;
            aAlfa  = (aError % 103) < "";
            |SI aAlfa = eaFichError;
                aAlfa  = (aError % -103) < "";
                |SI aAlfa = "rst";
                    aAlfa = aError % 0405;
                    #dsmow014#0 = aAlfa;
                    |LEE 040#dsmow014.=;
                    |SI FSalida = 0;
                        |HAZ GrabaImpreso;
                    |FINSI;
                |SINO;
                    #dsmow052#0 = aError;
                    |LEE 040#dsmow052.=;
                    |SI FSalida = 0;
                        aAlfa = aError % 0405;
                        #dsmow014#0 = aAlfa;
                        |LEE 040#dsmow014.=;
                        |SI FSalida = 0;
                            |HAZ DesGrabaImpreso;
                        |FINSI;
                    |FINSI;
                |FINSI;
            |FINSI;

            |R_SDIR aFichero;
     |SIGUE;
     |CIERRA #dsmow052;
     |CIERRA #dsmow014;

     |HAZ BorraDirectorio;
|FPRC;

|PROCESO BuscaErroresS;
     enError = 1;
     aAlfa = eaPathLanza + "ERRORES.TXT";
     |XABRE "C", aAlfa, nHandle1;
     |SI FSalida < 0;
         enError = 0;
         nDelBucle = 1; |BUCLE dsmow014G; nDelBucle = 0;
     |FINSI;
     |XCIERRA  nHandle1;
|FPRC;

|PROCESO QuitaBlanco;
     |ET aCadena;
         |QBF aParaQuitar;
         |SI aParaQuitar ! "";
             aCaracter = aParaQuitar % 101;
             |SI aCaracter = " ";
                 aParaQuitar = aParaQuitar % 240;
                 |VETE aCadena;
             |FINSI;
         |FINSI;
|FPRC;

|PROCESO SeparaNombre;
     || Busca una coma en la aCadena

     eaCadena1 = "";
     eaCadena2 = "";
     eaCadena3 = "";

     nBlanco1 = 0;
     nBlanco2 = 0;
     nComa    = 0;

     |PARA nPara = 1; |SI nPara [ 40; |HACIENDO nPara = nPara + 1;
           nPosi = nPara * 100 + 1;
           aCaracter = eaCadena % nPosi;

           |SI aCaracter = ","; nComa = nPara; |SAL; |FINSI;
     |SIGUE;

     |SI nComa = 0;
         || Si no hay coma busca el primer blanco empezando por detras

         aLongAlfa = eaCadena % 0;
         nLongNume = aLongAlfa;

         |PARA nPara = nLongNume; |SI nPara ] 1; |HACIENDO nPara = nPara - 1;
               nPosi = nPara * 100 + 1;
               aCaracter = eaCadena % nPosi;
               |SI aCaracter = " "; nComa = nPara; |SAL; |FINSI;
         |SIGUE;
     |FINSI;

     || Coge los dos primeros aCaracteres del segundo apellido

     nBlanco1  = nComa - 1;
     nPosi     = nBlanco1 + 100;
     eaCadena2  = eaCadena % nPosi;
     aLongAlfa = eaCadena2 % 0;
     nLongNume = aLongAlfa;

     |PARA nPara = nLongNume; |SI nPara ] 1; |HACIENDO nPara = nPara - 1;
           nPosi = nPara * 100 + 1;
           aCaracter = eaCadena2 % nPosi;
           |SI aCaracter = " "; nBlanco1 = nPara; |SAL; |FINSI;
     |SIGUE;

     nBlanco1 = nBlanco1 + 1;
     nPosi    = nBlanco1 * 100 + nLongNume;
     eaCadena2 = eaCadena2 % nPosi;

     || Coge las dos primeros caracteres del primer apellido

     nBlanco1 = nBlanco1 - 1;
     nPosi    = 100 + nBlanco1;
     eaCadena1 = eaCadena % nPosi;

     || Recoge los dos primero aCaracteres de Nombre

     nPosi    = ((nComa + 1) * 100) + 40;
     eaCadena3 = eaCadena % nPosi;

     aParaQuitar = eaCadena1; |HAZ QuitaBlanco; eaCadena1 = aParaQuitar;
     aParaQuitar = eaCadena2; |HAZ QuitaBlanco; eaCadena2 = aParaQuitar;
     aParaQuitar = eaCadena3; |HAZ QuitaBlanco; eaCadena3 = aParaQuitar;

     |QBF eaCadena1;
     |QBF eaCadena2;
     |QBF eaCadena3;
|FPRC;

|PROCESO Copiampf2007;
     aAlfa   = #dsmoy000#6;
     aAlfa   = aAlfa % -102;
     enError = 0;

     eaFOrigen  = aModelos + "patrones/zls" + aAlfa + "mpf.exe";
     |XABRE "E", eaFOrigen, nHandleEjec;
     |SI FSalida < 0;
         aAlfa1 =  "      No existe el ejecutable zls" + aAlfa + "mpf.exe pongase en contacto con su distribuidor";
         |MENAV aAlfa1;
         enError = 1;
         |ACABA;
     |FINSI;

     eaFDestino = eaPathLanza + "zls" + aAlfa + "mpf.exe";

     |HAZ CopiaFichero;
|FPRC;

|PROCESO Copiampf2008;
     aAlfa    = #dsmoy000#6;
     aAlfa    = aAlfa % -102;
     enError  = 0;
     aVersion = "01";

     |SI #dsmoy000#6 = 2008;  |Y #dsmoy000#4 ] 4;
         aVersion = "02";
     |FINSI;

     eaFOrigen  = aModelos + "patrones/z" + aAlfa + aVersion + "mpf.exe";
     |XABRE "E", eaFOrigen, nHandleEjec;
     |SI FSalida < 0;
         aAlfa1 =  "      No existe el ejecutable zls" + aAlfa + "mpf.exe pongase en contacto con su distribuidor";
         |MENAV aAlfa1;
         enError = 1;
         |ACABA;
     |FINSI;

     eaFDestino = eaPathLanza + "z" + aAlfa + aVersion + "mpf.exe";

     |HAZ CopiaFichero;
|FPRC;

|PROCESO Copiampf;
     |DBASS aModelos;  |QBT aModelos;
     aModelos = aModelos + "basica/";

     |SI #dsmoy000#6 [ 2007;
         |HAZ Copiampf2007;
         |ACABA;
     |FINSI;

     |SI #dsmoy000#6 [ 2012;
         |HAZ Copiampf2008;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO CompruebaEjecutable2007;
     |DBASS aModelos;  |QBT aModelos;
     aModelos = aModelos + "basica/";

     aAlfa   = #dsmoy000#6;
     aAlfa   = aAlfa % -102;
     enError = 0;

     eaFOrigen  = aModelos + "patrones/zls" + aAlfa + "mpf.exe";
     |XABRE "E", eaFOrigen, nHandleEjec;
     |SI FSalida < 0;
         aAlfa1 =  "      No existe el ejecutable zls" + aAlfa + "mpf.exe pongase en contacto con su distribuidor";
         |MENAV aAlfa1;
         enError = 1;
     |FINSI;
|FPRC;

|PROCESO CompruebaEjecutable2008;
     |DBASS aModelos;  |QBT aModelos;
     aModelos = aModelos + "basica/";

     aAlfa    = #dsmoy000#6;
     aAlfa    = aAlfa % -102;
     enError  = 0;
     aVersion = "01";

     |SI #dsmoy000#6 = 2008;  |Y #dsmoy000#4 ] 4;
         aVersion = "02";
     |FINSI;

     eaFOrigen  = aModelos + "patrones/z" + aAlfa + aVersion + "mpf.exe";
     |XABRE "E", eaFOrigen, nHandleEjec;
     |SI FSalida < 0;
         aAlfa1 =  "      No existe el ejecutable z" + aAlfa + aVersion + "mpf.exe pongase en contacto con su distribuidor";
         |MENAV aAlfa1;
         enError = 1;
     |FINSI;
|FPRC;

|PROCESO CompruebaEjecutable;
     |SI #dsmoy000#6 [ 2007;
         |HAZ CompruebaEjecutable2007;
         |ACABA;
     |FINSI;

     |SI #dsmoy000#6 [ 2012;
         |HAZ CompruebaEjecutable2008;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO CogeBancoIntegral;
     enBanco     = 0;
     eaEntidad   = "";
     eaOficina   = "";
     eaDC        = "";
     eaCuenta    = "";
     eaNomEnt    = "";
     eaNomOfi    = "";
     eaFormaPago = "";
     eaIBAN      = "";
     eaBIC       = "";

     |ABRE #dsam0009;

     #dsam0009#0 = #clientes@#0;
     #dsam0009#1 = enModelo;
     |LEE 040#dsam0009.=;
     |SI FSalida = 0;
         |CIERRA #dsam0009;

         |SI #dsam0009#9 = 1;  |O #dsam0009#8 = "          ";
             eaFormaPago = "1";
         |SINO;
             eaFormaPago = #dsam0009#9;
             eaEntidad   = #dsam0009#5;
             eaOficina   = #dsam0009#6;
             eaDC        = #dsam0009#7;
             eaCuenta    = #dsam0009#8;
             eaNomEnt    = #dsam0009#4;
             eaNomOfi    = #dsam0009#10;
             eaBIC       = #dsam0009#11;
             eaIBAN      = #dsam0009#12;
         |FINSI;

         |SI enForzar = 1;
             enBanco     = #dsam0009#3;
             eaEntidad   = #dsam0009#5;
             eaOficina   = #dsam0009#6;
             eaDC        = #dsam0009#7;
             eaCuenta    = #dsam0009#8;
             eaNomEnt    = #dsam0009#4;
             eaNomOfi    = #dsam0009#10;
             eaFormaPago = #dsam0009#9;
             eaBIC       = #dsam0009#11;
             eaIBAN      = #dsam0009#12;
         |FINSI;

         |ACABA;
     |FINSI;

     #dsam0009#0 = #clientes@#0;
     #dsam0009#1 = 999;
     |LEE 040#dsam0009.=;
     |SI FSalida = 0;
         |CIERRA #dsam0009;

         |SI #dsam0009#9 = 1;  |O #dsam0009#8 = "          ";
             eaFormaPago = "1";
         |SINO;
             eaFormaPago = #dsam0009#9;
             eaEntidad   = #dsam0009#5;
             eaOficina   = #dsam0009#6;
             eaDC        = #dsam0009#7;
             eaCuenta    = #dsam0009#8;
             eaNomEnt    = #dsam0009#4;
             eaNomOfi    = #dsam0009#10;
             eaBIC       = #dsam0009#11;
             eaIBAN      = #dsam0009#12;
         |FINSI;

         |SI enForzar = 1;
             enBanco     = #dsam0009#3;
             eaFormaPago = #dsam0009#9;
             eaEntidad   = #dsam0009#5;
             eaOficina   = #dsam0009#6;
             eaDC        = #dsam0009#7;
             eaCuenta    = #dsam0009#8;
             eaNomEnt    = #dsam0009#4;
             eaNomOfi    = #dsam0009#10;
             eaBIC       = #dsam0009#11;
             eaIBAN      = #dsam0009#12;
         |FINSI;

         |ACABA;
     |FINSI;
     |CIERRA #dsam0009;

     |SI #clientes@#104 = 1;  |O #clientes@#93 = "          ";
         eaFormaPago = "1";
     |SINO;
         eaFormaPago = #clientes@#104;
         eaEntidad   = #clientes@#90;
         eaOficina   = #clientes@#91;
         eaDC        = #clientes@#92;
         eaCuenta    = #clientes@#93;
         eaNomEnt    = #clientes@#89;
         eaNomOfi    = "";
         eaBIC       = #clientes@#114;
         eaIBAN      = #clientes@#116;
     |FINSI;

     |SI enForzar = 1;
         eaFormaPago = #clientes@#104;
         eaEntidad   = #clientes@#90;
         eaOficina   = #clientes@#91;
         eaDC        = #clientes@#92;
         eaCuenta    = #clientes@#93;
         enBanco     = #clientes@#88;
         eaNomEnt    = #clientes@#89;
         eaNomOfi    = "";
         eaBIC       = #clientes@#114;
         eaIBAN      = #clientes@#116;
     |FINSI;
|FPRC;

|PROCESO CogeBancoBasica;
     |SI #clientes@#95 = 1;  |O #clientes@#84 = "                    ";
         eaFormaPago = "1";
     |SINO;
         eaFormaPago = #clientes@#95;
         eaEntidad   = #clientes@#81;
         eaOficina   = #clientes@#82;
         eaDC        = #clientes@#83;
         eaCuenta    = #clientes@#84 % 110;
         enBanco     = #clientes@#79;
         eaNomEnt    = #clientes@#80;
         eaNomOfi    = "";
         eaBIC       = #clientes@#98;
         eaIBAN      = #clientes@#99;
    |FINSI;
|FPRC;

|PROCESO CogeDatosBancos;
     eaDesFPago   = "";
     |SI enSwDeDonde = 1;
         |HAZ CogeBancoIntegral;
     |SINO;
         |HAZ CogeBancoBasica;
     |FINSI;

     |SI eaFormaPago = "1";
         eaIBAN   = "";
         eaBIC    = "";
         eaNomEnt = "";
     |FINSI;

     |SI eaFormaPago = "1"; eaDesFPago = "Efectivo";               |FINSI;
     |SI eaFormaPago = "2"; eaDesFPago = "Adeudo en cuenta";       |FINSI;
     |SI eaFormaPago = "3"; eaDesFPago = "Domiciliacion";          |FINSI;
     |SI eaFormaPago = "4"; eaDesFPago = "Aplazamiento";           |FINSI;
     |SI eaFormaPago = "5"; eaDesFPago = "Aplazamiento + Ingreso"; |FINSI;
     |SI eaFormaPago = "6"; eaDesFPago = "Cta cte tributaria";     |FINSI;

     |QBF eaIBAN; |QBF eaNomEnt;
     |SI eaIBAN ! "";
         eaDesFPago = eaDesFPago + " " + eaIBAN;
     |FINSI;
     |SI eaNomEnt ! "";
         eaDesFPago = eaDesFPago + " " + eaNomEnt;
     |FINSI;
     eaDesFPago = eaDesFPago % 0171;
|FPRC;

|PROCESO LeeJava;
     enError = 1;
     |PARA nCaracter = 67;  |SI nCaracter [ 90;  |HACIENDO nCaracter = nCaracter + 1;
           aUnidadSistema = &nCaracter + ":";
           aAbre   = aUnidadSistema + "\Archivos de programa\Java\" + aVersionJava + "\bin\java.exe";
           |XABRE "EC", aAbre, nHandleEjec;
           |SI FSalida ] 0;
               aProgFiles = "Archivos de programa";
               enError = 0;
               |SAL;
           |FINSI;

           aAbre   = aUnidadSistema + "\Program Files\Java\" + aVersionJava + "\bin\java.exe";
           |XABRE "EC", aAbre, nHandleEjec;
           |SI FSalida ] 0;
               aProgFiles = "Program Files";
               enError    = 0;
               |SAL;
           |FINSI;

           aAbre   = aUnidadSistema + "\Program Files (x86)\Java\" + aVersionJava + "\bin\java.exe";
           |XABRE "EC", aAbre, nHandleEjec;
           |SI FSalida ] 0;
               aProgFiles = "Program Files (x86)";
               enError    = 0;
               |SAL;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO BuscaJava;
     |SI #dsmoy000#6 [ 2006;
         aVersionBasico = "111";
         aVersionJava   = "j2re1.4.2_04";
         aEjecutaJava   = "zjava_1_4_2_04.exe";
     |FINSI;

     |SI #dsmoy000#6 = 2007;
         aVersionBasico = "221";
         aVersionJava   = "jre1.6.0_03";
         aEjecutaJava   = "zjava_1_6_0_03.exe";
     |FINSI;

     |SI #dsmoy000#6 = 2008;
         aVersionBasico = "230";
         aVersionJava   = "jre1.6.0_03";
         aEjecutaJava   = "zjava_1_6_0_03.exe";
     |FINSI;

     |SI #dsmoy000#6 = 2009;
         aVersionBasico = "300";
         aVersionJava   = "jre1.6.0_03";
         aEjecutaJava   = "zjava_1_6_0_03.exe";
     |FINSI;

     |SI #dsmoy000#6 = 2010;
         aVersionBasico = "310";
         aVersionJava   = "jre1.6.0_03";
         aEjecutaJava   = "zjava_1_6_0_03.exe";
     |FINSI;

     |SI #dsmoy000#6 ] 2011;
         aVersionBasico = "320";
         aVersionJava   = "jre1.6.0_03";
         aEjecutaJava   = "zjava_1_6_0_03.exe";
     |FINSI;

     |HAZ LeeJava;
     |SI enError = 1;
         aAlfa = "0000 No tiene instalada la Maquina Virtual para Java Version " + aVersionJava + ". Se va a proceder a instalar";
         |MENAV aAlfa;

         aPathModelo = eaPathLanza;
         aPathLocal  = eaPathLanza;
         |HAZ TraeWait;

         |DBASS aModelos;  |QBT aModelos;
         aModelos = aModelos + "basica/";
         eaFOrigen  = aModelos + "patrones/" + aEjecutaJava;
         eaFDestino = aPathModelo +  aEjecutaJava;
         |HAZ CopiaFichero;

         aAbre = aPathModelo + "Ejecuta.bat";
         |XABRE "CBW", aAbre, nHandle1;

         aAlfa = "CD " + aPathModelo + &13 + &10;
         |XGRABA nHandle1, aAlfa;

         aAlfa = "wait " + aEjecutaJava + &13 + &10;
         |XGRABA nHandle1, aAlfa;

         |XCIERRA nHandle1;

         |RSYSTEM aAbre;

         |RFBORRA aAbre;
         |RFBORRA eaFDestino;

         |HAZ LeeJava;
         |SI enError = 1;
              aAlfa = "0000 No tiene instalada la Maquina Virtual para Java Version " + aVersionJava + ". Proceso Interrumpido";
              |MENAV aAlfa;
              |ACABA;
         |FINSI;
     |FINSI;

     aAlfa  = aUnidadSistema + "\" + aProgFiles + "\Java\" + aVersionJava;
     eaDirJava = "SET JAVA_HOME=" + aAlfa;  |QBF eaDirJava;
|FPRC;

|PROCESO TraeBasico;
     |HAZ LeeUnidadBasico;

     aPathLocal = eaUnidadBasico + "\MODELOS";                                |RMKDIR aPathLocal;
     aPathLocal = eaUnidadBasico + "\MODELOS\JAVA";                           |RMKDIR aPathLocal;
     aPathLocal = eaUnidadBasico + "\MODELOS\JAVA\VERSION" + aVersionBasico;  |RMKDIR aPathLocal;
     aPathLocal = eaUnidadBasico + "\MODELOS\JAVA\VERSION" + aVersionBasico + "\";

     |DBASS aPathServidor;   |QBF aPathServidor;
     aPathServidor = aPathServidor + "basica/patrones/";

     aOrigen    = aPathServidor + "mivinf" + aVersionBasico + ".tgz";
     aDestino   = aPathLocal + "mivinf" + aVersionBasico + ".tgz";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     nCopia    = 0;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
         nCopia = 1;
     |FINSI;

     enBasico = 0;
     |XABRE "EC", aDestino, nHandleEjec;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |SI nCopia = 1;
         |RDESCOMPRIME aDestino;

         aDestino = (aDestino - ".tgz") + ".tar";
         |RDETAR aDestino, aPathLocal;

         |RFBORRA aDestino;
     |FINSI;

     enBasico = 1;
|FPRC;

|PROCESO TraeModelo;
     |SI enBasico = 0;  |ACABA;  |FINSI;

     aAlfa   = #dsmoy000#6;
     aAlfa   = aAlfa % -102;

     aOrigen    = aPathServidor + "zls" + aAlfa + #dsmoy000#0 + ".tgz";
     aDestino   = aPathLocal    + "zls" + aAlfa + #dsmoy000#0 + ".tgz";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     nCopia    = 0;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
         nCopia = 1;
     |FINSI;

     |XABRE "EC", aDestino, nHandleEjec;
     |SI FSalida < 0;  enBasico = 0;  |ACABA;  |FINSI;

     |SI nCopia = 1;
         |RDESCOMPRIME aDestino;

         aDestino = (aDestino - ".tgz") + ".tar";
         |RDETAR aDestino, aPathLocal;

         |RFBORRA aDestino;
     |FINSI;
|FPRC;

|PROCESO PresentaJava;
     aPathLocal = eaPathLanza;

     aAbre = aPathLocal + eaTipoP;
     |XABRE "EC", aAbre, nHandle1;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |HAZ LocalizaAcrobat;
     |SI enError ! 0;  |ACABA;  |FINSI;

     |HAZ TraeWait;

     aAbre = aPathLocal + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = eaUnidadBasico + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "CD " + aPathLocal + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     |SI eaModoImpre = "I";
         aAlfa = "wait dsprint " + eaTipoP + &13 + &10;
         |XGRABA nHandle1, aAlfa;
     |FINSI;

     |SI eaModoImpre = "P";
         aAlfa = "wait " + eaPathAcrobat + " " + eaTipoP + &13 + &10;
         |XGRABA nHandle1, aAlfa;
     |FINSI;

     |XCIERRA nHandle1;

     |RSYSTEM aAbre;
     |RFBORRA aAbre;

     |DBASE aPathPdf;  |QBT aPathPdf;
     aPathPdf = aPathPdf + "modelospdf";
     aPathPdf = aPathPdf + "/" + #dsmoy000#0;                      |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/" + #dsmoy000#6;                      |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/99";                           |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/" + (("00" + #dsmow014#7) % -102);  |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/";

     aOrigen  = aPathLocal + eaTipoP;
     aDestino = aPathPdf   + #dsmoy000#0 + (("00000" + #dsmow014#0) % -105) + ".pdf";

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aIPRemoto ! "";
         |RECIBE_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |RFBORRA aOrigen;
|FPRC;

|PROCESO BorraPdf;
     |DBASE aPathPdf;  |QBT aPathPdf;
     aPathPdf = aPathPdf + "modelospdf";
     aPathPdf = aPathPdf + "/" + #dsmoy000#0;                      |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/" + #dsmoy000#6;                      |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/99";                           |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/" + (("00" + #dsmow014#7) % -102);  |MKDIR aPathPdf;
     aPathPdf = aPathPdf + "/";

     aAlfa    = aPathPdf   + #dsmoy000#0 + (("00000" + #dsmow014#0) % -105) + ".pdf";
     |FBORRA aAlfa;
|FPRC;

|PROCESO LineaShellJava;
     |HAZ BorraPdf;

     enBasico = 0;
     |HAZ BuscaJava;
     |SI enError = 1;  |ACABA;  |FINSI;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "CBW", aAbre, enHandle;

     aAlfa = "CD \" + &13 + &10;                 |XGRABA enHandle, aAlfa;
     aAlfa = "CD MODELOS" + &13 + &10;           |XGRABA enHandle, aAlfa;
     aAlfa = "CD JAVA" + &13 + &10;              |XGRABA enHandle, aAlfa;
     aAlfa = "CD VERSION" + aVersionBasico + &13 + &10;        |XGRABA enHandle, aAlfa;

     |SI eaTipoR ! "";
         aAlfa = "DEL " + eaPathLanza + eaTipoR + &13 + &10;
         |XGRABA enHandle, aAlfa;
     |FINSI;

     |SI eaTipoP ! "";
         aAlfa = "DEL " + eaPathLanza + eaTipoP + &13 + &10;
         |XGRABA enHandle, aAlfa;
     |FINSI;

     aAlfa = eaDirJava + &13 + &10;
     |XGRABA enHandle, aAlfa;

     aAlfa = &34 + "%JAVA_HOME%\bin\java" + &34 + " -jar " + eaUnidadBasico + "\MODELOS\JAVA\VERSION" + aVersionBasico + "\plataformamodulosinformativas.jar ";

     |SI eaTipoV ! "S";
         aAlfa = aAlfa + "/E:" + eaPathLanza + eaTipoE + " ";
         aAlfa = aAlfa + "/R:" + eaPathLanza + eaTipoR + " ";
         aAlfa = aAlfa + "/P:" + eaPathLanza + eaTipoP + " ";
         aAlfa = aAlfa + "/C:" + eaTipoC + " ";
         aAlfa = aAlfa + "/A:" + eaPathLanza + eaTipoA + " ";
     |SINO;
         aAlfa = aAlfa + "/E:" + eaPathLanza + eaTipoE + " ";
         aAlfa = aAlfa + "/V:S ";
         aAlfa = aAlfa + "/R:" + eaPathLanza + eaTipoR + " ";
     |FINSI;

     |SI #dsmoy000#6 ] 2008;
         aAlfa = aAlfa + "/M:S ";
     |FINSI;

     aAlfa = aAlfa + &13 + &10;
     |XGRABA enHandle, aAlfa;

     |XCIERRA enHandle;

     |HAZ TraeBasico;
     |HAZ TraeModelo;

     |SI enBasico = 0;  |ACABA;  |FINSI;

     aAlfa = eaPathLanza + "imprime.bat";
     |RSYSTEM aAlfa;

     |SI eaTipoV ! "S";
         |HAZ PresentaJava;
     |FINSI;
|FPRC;

|PROCESO Acrobat;
     |HAZ CogeMac;

     |ABRE #dsmom108;
     #dsmom108#0 = eaDSMAC;
     |LEE 101#dsmom108.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom108;
         #dsmom108#0 = eaDSMAC;
         |GRABA 020#dsmom108.b;
     |FINSI;

     eaPathAcrobat = #dsmom108#1;  |QBF eaPathAcrobat;
     |SI eaPathAcrobat = "";
         eaPathAcrobat = "AcroRd32.exe";
     |FINSI;

     eaPathAcrobat = "F" + eaPathAcrobat;
     |BROWSE eaPathAcrobat;
     eaPathAcrobat = eaPathAcrobat % 290;  |QBF eaPathAcrobat;

     |SI eaPathAcrobat ! "";
         #dsmom108#1 = eaPathAcrobat;
     |FINSI;

     |GRABA 020#dsmom108.a;
     |LIBERA #dsmom108;
     |CIERRA #dsmom108;
|FPRC;

|PROCESO Explorador;
     |HAZ CogeMac;

     |ABRE #dsmom108;
     #dsmom108#0 = eaDSMAC;
     |LEE 101#dsmom108.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom108;
         #dsmom108#0 = eaDSMAC;
         |GRABA 020#dsmom108.b;
     |FINSI;

     eaPathExplorador = #dsmom108#3;  |QBF eaPathExplorador;

     |SI eaPathExplorador = "";  |O eaForzExplorador = "S";
         |MENAV "0000Busque y pinche en el explorador con el que quiera trabajar";

         eaPathExplorador = "F" + eaPathExplorador;
         |BROWSE eaPathExplorador;
         eaPathExplorador = eaPathExplorador % 290;  |QBF eaPathExplorador;
     |FINSI;

     |SI eaPathExplorador ! "";
         #dsmom108#3 = eaPathExplorador;
     |FINSI;

     |GRABA 020#dsmom108.a;
     |LIBERA #dsmom108;
     |CIERRA #dsmom108;
|FPRC;

|PROCESO LeeUnidad;
     |HAZ CogeMac;

     |ABRE #dsmom108;
     #dsmom108#0 = eaDSMAC;
     |LEE 000#dsmom108.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom108;  |FINSI;
     |CIERRA #dsmom108;

     |SI #dsmom108#2 = " "; #dsmom108#2 = eaUnidadBasico % 101;  |FINSI;

     aAlfa   = #dsmom108#2 + ":\AEAT";
     |RMKDIR aAlfa;

     aAlfa   = aAlfa + "\comprueba.txt";
     |XABRE "AC", aAlfa, nHandle;
     |SI FSalida < 0;
         eaUnidad = "";
     |SINO;
        |XCIERRA nHandle;
        |RFBORRA aAlfa;

        eaUnidad = #dsmom108#2 + ":";
    |FINSI;
|FPRC;

|PROCESO BuscaNombre;
     |QBF eaAlfa;
     eaAlfa1 = "";
     eaAlfa2 = "";
     aLong  = eaAlfa % 0;
     nLong  = aLong;
     nComa  = 0;

     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (nCaracter * 100) + 1;
           aCaracter = eaAlfa % nPos;

           |SI aCaracter = ",";
               nComa = 1;
           |SINO;
               |SI nComa = 0;
                   eaAlfa1 = eaAlfa1 + aCaracter;
               |SINO;
                   |SI aCaracter = " ";  |Y eaAlfa2 = "";
                   |SINO;
                       eaAlfa2 = eaAlfa2 + aCaracter;
                   |FINSI;
               |FINSI;
           |FINSI;
      |SIGUE;
|FPRC;

|PROCESO GrabaImpresoPortal;
     |ABRE #dsmom107;
     |DDEFECTO #dsmom107;
     |LEE 000#dsmom107.p;
     |CIERRA #dsmom107;

     |SI #dsmow014#5 = 182; |ACABA; |FINSI;
     |SI #dsmow014#5 = 720; |ACABA; |FINSI;
     |SI #dsmow014#5 = 583; |ACABA; |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = #dsmow014#5;
     #dsmom004#4  = #dsmow014#7;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#9  = "X";
         #dsmom004#10 = #dsmoy000#7;

         |QBF eaJusti;
         aAlfa = eaJusti % 0;
         nNume = aAlfa;

         |SI nNume [ 13;
             #dsmom004#25 = eaJusti;
         |SINO;
             #dsmom004#19 = eaJusti;
         |FINSI;

         |SI #dsmom107#15 = "S";
             #dsmom004#13 = "X";
             #dsmom004#14 = #dsmoy000#7;
         |FINSI;
         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;

         |HAZ GrabaResumen;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROCESO GrabaDir720;
     |ABRE #dsmo7201;
     #dsmo7201#0  = enEmp;
     #dsmo7201#1  = enEje;
     #dsmo7201#2  = enPer;
     #dsmo7201#3  = enMod;
     #dsmo7201#4  = enCom;
     #dsmo7201#5  = 0;
     |LEE 101#dsmo7201.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsmo7201#11 = "X";
     #dsmo7201#12 = ~;

     #dsmo7201#18 = eaJUS;
     #dsmo7201#20 = eaCSV;
     #dsmo7201#23 = eaEXP;

     |SI #dsmom107#15 = "S";
         #dsmo7201#16 = "X";
         #dsmo7201#17 = ~;
     |FINSI;

     |GRABA 020#dsmo7201.a;
     |LIBERA #dsmo7201;
     |CIERRA #dsmo7201;
|FPRC;

|PROCESO GrabaDir182;
     |ABRE #dsm182ca;
     #dsm182ca#0  = enEmp;
     #dsm182ca#1  = enEje;
     #dsm182ca#2  = enPer;
     #dsm182ca#3  = enMod;
     #dsm182ca#4  = enCom;
     |LEE 101#dsm182ca.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsm182ca#11 = "X";
     #dsm182ca#12 = ~;

     #dsm182ca#18 = eaJUS;
     #dsm182ca#20 = eaCSV;
     #dsm182ca#27 = eaEXP;

     |SI #dsmom107#15 = "S";
         #dsm182ca#16 = "X";
         #dsm182ca#17 = ~;
     |FINSI;

     |GRABA 020#dsm182ca.a;
     |LIBERA #dsm182ca;
     |CIERRA #dsm182ca;
|FPRC;

|PROCESO GrabaImpresoDirecto;
     |ABRE #dsmom107;
     |DDEFECTO #dsmom107;
     |LEE 000#dsmom107.p;
     |CIERRA #dsmom107;

     |SI enMod = 720;
         |HAZ GrabaDir720;
         |ACABA;
     |FINSI;

     |SI enMod = 182;
         |HAZ GrabaDir182;
         |ACABA;
     |FINSI;

     |SI enMod = 309;
         eaCamp9_11 = "X";
         efCamp9_12 = #dsmoy000#7;
         eaCamp9_73 = eaJUS;

         |ACABA;
     |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0  = enEmp;
     #dsmom004#1  = enEje;
     #dsmom004#2  = enPer;
     #dsmom004#3  = enMod;
     #dsmom004#4  = enCom;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#9  = "X";
         #dsmom004#10 = #dsmoy000#7;
         #dsmom004#25 = eaJUS;
         #dsmom004#19 = eaCSV;
         #dsmom004#26 = eaEXP;

         |SI #dsmom107#15 = "S";
             #dsmom004#13 = "X";
             #dsmom004#14 = #dsmoy000#7;
         |FINSI;
         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;

         |HAZ GrabaResumen;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROCESO DesGrabaImpresoDirecto;
     |ABRE #dsmom107;
     |DDEFECTO #dsmom107;
     |LEE 000#dsmom107.p;
     |CIERRA #dsmom107;

     |ABRE #dsmom004;
     #dsmom004#0  = enEmp;
     #dsmom004#1  = enEje;
     #dsmom004#2  = enPer;
     #dsmom004#3  = enMod;
     #dsmom004#4  = enCom;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#9  = " ";
         #dsmom004#10 = "01.01.0000";
         #dsmom004#19 = "";
         #dsmom004#25 = "";
         #dsmom004#26 = "";
         |SI #dsmom107#15 = "S";
             #dsmom004#13 = "";
             #dsmom004#14 = "01.01.0000";
         |FINSI;
         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
         |HAZ DesGrabaResumen;
     |FINSI;
     |CIERRA #dsmom004;

     |SI #dsmom004#3 = 300;  |O #dsmom004#3 = 370;  |O #dsmom004#3 = 320;
      |O #dsmom004#3 = 330;  |O #dsmom004#3 = 332;  |O #dsmom004#3 = 303;
            |ABRE #dsmom082;
            #dsmom082#0 = #dsmom004#0;
            #dsmom082#1 = #dsmom004#1;
            #dsmom082#2 = #dsmom004#2;
            |LEE 141#dsmom082.=;
            |SI FSalida = 0;
                #dsmom082#61 = "S";
                |GRABA 020#dsmom082.a;
            |FINSI;
            |LIBERA #dsmom082;
            |CIERRA #dsmom082;
     |FINSI;
|FPRC;

|PROCESO PintaUbicacion;
     |PUSHV 0501 2380;
     |BLANCO 0501 2380;
     |PINTA 1002, eaAlfa1;
     |ATRI P;
     |PINTA 1102, eaAlfa2;
     |ATRI p;
     |PAUSA;
     |POPV;
|FPRC;

|PROCESO CalcJustificante;
     fFecha1 = ~;
     fFecha2 = "01.01.2000";

     |HORA aHora;

     aAlfa = aHora % 102;  nHora = aAlfa;
     aAlfa = aHora % 402;  nMinu = aAlfa;
     aAlfa = aHora % 702;  nSegu = aAlfa;

     nSeg  = (nHora * 3600) + (nMinu * 60) + nSegu;
     nDias = fFecha1 - fFecha2;

     aSeg  = ("00000" + nSeg) % -105;
     aDia  = ("00000" + nDias) % -105;

     eaJusti = #dsmoy000#0;
     eaJusti = eaJusti + (aSeg % 101);
     eaJusti = eaJusti + (aDia % 101);
     eaJusti = eaJusti + (aSeg % 201);
     eaJusti = eaJusti + (aDia % 201);
     eaJusti = eaJusti + (aSeg % 301);
     eaJusti = eaJusti + (aDia % 301);
     eaJusti = eaJusti + (aSeg % 401);
     eaJusti = eaJusti + (aDia % 401);
     eaJusti = eaJusti + (aSeg % 501);
     eaJusti = eaJusti + (aDia % 501);
|FPRC;
