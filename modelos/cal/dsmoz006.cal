|FICHEROS;
     dsmoz006 #0;
     dsmom016 #16;
     dsmom017 #17;
     dsmom018 #18;
     dsmom019 #19;
     dsmom020 #20;
     dsmom021 #21;
     dsmom039 #39;
     dsmom068 #68;
     dsmom901 #901;
     dsmow012 #912,MANTE;

     dsmom018@ #918;
     dsmom019@ #919;
     dsmom068@ #968;
|FIN;

|VARIABLES;
     aTecla     = "";
     aFichero   = "";
     aBase      = "";
     aMas       = "";

     nBoton1    = 0;
     nBoton2    = 0;
     nBoton3    = 0;
     nBoton4    = 0;
     nBoton5    = 0;
     nBoton6    = 0;
     nBoton7    = 0;
     nBoton8    = 0;
     nBoton18   = 0;
     nDias1     = 0;
     nDias2     = 0;
     nDias3     = 0;
     nDias4     = 0;
     nMensa     = 0;

     aEsc         = "";
     aF2          = "";
     aF3          = "";
     aF4          = "";
     aF5          = "";
     aF6          = "";
     aF7          = "";
     aF8          = "";
     aF18         = "";
     aAlfa        = "";
     aAlfa1       = "";
     aAlfa2       = "";
     ef2          = @;
     enEst39      = 0;

     fFecha       = @;
     fFecha1      = @;
     fFecha2      = @;

     nNume        = 0;
     nNume1       = 0;
     &efDFecA     = @;
     &efHFecA     = @;
     &eaCodRenta  = "";
     &eaTituloL   = "";
     &enSw        = 0;
     &enMasTrIRPF = 0;
     &enMasTrIVA  = 0;
     nError       = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO PonIngresos;
     |SI enEmpresa = 0;
         aFichero = ("18" + Usuario + "zzzzzzzz") % 108;
         |NOME_DAT #18 aFichero;

         aFichero = ("19" + Usuario + "zzzzzzzz") % 108;
         |NOME_DAT #19 aFichero;

         aFichero = ("68" + Usuario + "zzzzzzzz") % 108;
         |NOME_DAT #68 aFichero;
     |FINSI;

     |ABRE #18;
     #18#0 = enEmpresa;
     #18#1 = enEjer;
     #18#2 = enComplem;
     #18#3 = enActividad;
     |LEE 040#18=;
     |SI FSalida ! 0;  |DDEFECTO #18;  |FINSI;
     |CIERRA #18;

     |DDEFECTO #68;
     |SI enEjer ] 2011;
         |ABRE #68;
         #68#0 = enEmpresa;
         #68#1 = enEjer;
         #68#2 = enComplem;
         #68#3 = enActividad;
         |LEE 040#68=;
         |SI FSalida ! 0;  |DDEFECTO #68;  |FINSI;
         |CIERRA #68;
     |FINSI;

     |ABRE #19;
     #19#0 = enEmpresa;
     #19#1 = enEjer;
     #19#2 = enComplem;
     #19#3 = enActividad;
     |LEE 040#19=;
     |SI FSalida ! 0;  |DDEFECTO #19;  |FINSI;
     |CIERRA #19;

     |ABRE #17;
     #17#0 = enEmpresa;
     #17#1 = enEjer;
     #17#2 = enComplem;
     #17#3 = enActividad;
     |LEE 040#17=;
     |SI FSalida ! 0;  |DDEFECTO #17;  |FINSI;
     |CIERRA #17;

     #0#18 = #18#125;
     #0#19 = #18#126;
     #0#20 = #18#127;
     #0#21 = #18#128;
     #0#22 = #18#129;
     #0#23 = #18#130;
     #0#24 = #18#131;
     #0#25 = #18#132;

     #0#26 = #19#139;
     #0#27 = #19#140;
     #0#28 = #19#141;
     #0#29 = #19#142;
     #0#34 = #19#139;
     #0#35 = #19#140;
     #0#36 = #19#141;

     |SI #19#148 ! 0;  #0#34 = #19#148;  |FINSI;
     |SI #19#149 ! 0;  #0#35 = #19#149;  |FINSI;
     |SI #19#150 ! 0;  #0#36 = #19#150;  |FINSI;

     #0#30 = #19#143;
     #0#31 = #19#144;
     #0#32 = #19#145;
     #0#33 = #19#146;

     |PINTA #0#18;
     |PINTA #0#19;
     |PINTA #0#20;
     |PINTA #0#21;
     |PINTA #0#22;
     |PINTA #0#23;
     |PINTA #0#24;
     |PINTA #0#25;
     |PINTA #0#26;
     |PINTA #0#27;
     |PINTA #0#28;
     |PINTA #0#29;
     |PINTA #0#30;
     |PINTA #0#31;
     |PINTA #0#32;
     |PINTA #0#33;
     |PINTA #0#34;
     |PINTA #0#35;
     |PINTA #0#36;
|FPRC;

|PROCESO Dias;  |TIPO 0;
     |SI #0#8 = 0;
         |SI #0#5 = 0;  #0#5 = 91;  |FINSI;
         |SI #0#6 = 0;  #0#6 = 92;  |FINSI;
         |SI #0#7 = 0;  #0#7 = 92;  |FINSI;
         |SI #0#4 = 0;
             |SI #0#2 = 2000;  |O #0#2 = 2004;  |O #0#2 = 2008;
              |O #0#2 = 2012;  |O #0#2 = 2016;  |O #0#2 = 2020;
                 #0#4 = 91;
             |SINO;
                 #0#4 = 90;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #0#13 = 0;
         |SI #0#10 = 0;  #0#10 = 91;  |FINSI;
         |SI #0#11 = 0;  #0#11 = 92;  |FINSI;
         |SI #0#12 = 0;  #0#12 = 92;  |FINSI;
         |SI #0#9  = 0;
             |SI #0#2 = 2000;  |O #0#2 = 2004;  |O #0#2 = 2008;
              |O #0#2 = 2012;  |O #0#2 = 2016;  |O #0#2 = 2020;
                 #0#9 = 91;
             |SINO;
                 #0#9 = 90;
             |FINSI;
         |FINSI;
     |FINSI;

     #0#8  = #0#4 + #0#5  + #0#6  + #0#7;    |PINTA #0#8;
     #0#13 = #0#9 + #0#10 + #0#11 + #0#12;   |PINTA #0#13;

     enDiaTrimP1 = #0#4;
     enDiaTrimP2 = #0#5;
     enDiaTrimP3 = #0#6;
     enDiaTrimP4 = #0#7;
     enDiaTrimD1 = #0#9;
     enDiaTrimD2 = #0#10;
     enDiaTrimD3 = #0#11;
     enDiaTrimD4 = #0#12;
     eaDesTrab   = #0#14;
     eaDesElem   = #0#15;
     eaDesInve   = #0#16;
|FPRC;

|PROCESO Aparece;
     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton4, "SHOW";
     |ESTADO_CONTROL nBoton5, "SHOW";
     |ESTADO_CONTROL nBoton6, "SHOW";
     |ESTADO_CONTROL nBoton7, "SHOW";
     |ESTADO_CONTROL nBoton8, "SHOW";
     |ESTADO_CONTROL nBoton18, "SHOW";
|FPRC;

|PROCESO Desaparece;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton4, "HIDE";
     |ESTADO_CONTROL nBoton5, "HIDE";
     |ESTADO_CONTROL nBoton6, "HIDE";
     |ESTADO_CONTROL nBoton7, "HIDE";
     |ESTADO_CONTROL nBoton8, "HIDE";
     |ESTADO_CONTROL nBoton18, "HIDE";
|FPRC;

|PROCESO Trabajadores;
     |ATRI 0;
     eaCodEpi1 = "E";
     eaCodEpi2 = #0#0;
     enCodEpi3 = #0#1;
     enEjer    = #0#2;

     |HAZ Desaparece;
     |SUB_EJECUTA_NP "dsmom020";
     |HAZ Aparece;

     |HAZ PonIngresos;
|FPRC;

|PROCESO CompruebaDias;
     nDias1 = 90;
     nDias2 = 91;
     nDias3 = 92;
     nDias4 = 92;
     |SI #0#2 = 2000;  |O #0#2 = 2004;  |O #0#2 = 2008;
      |O #0#2 = 2012;  |O #0#2 = 2016;  |O #0#2 = 2020;
         nDias1 = 91;
     |FINSI;

     aAlfa1 = "01.01." + #0#2;
     aAlfa2 = "31.12." + #0#2;
     |SI efFechaI = aAlfa1;  |Y efFechaF = aAlfa2;
         |SI nMensa ! 1;
             |ACABA;
         |FINSI;
     |FINSI;

     aAlfa1 = "01.01." + #0#2;
     aAlfa2 = "31.03." + #0#2;
     |SI efFechaI > aAlfa2;
         nDias1 = 0;
     |SINO;
         fFecha1 = aAlfa1;
         fFecha2 = aAlfa2;
         |SI fFecha1 < efFechaI;  fFecha1 = efFechaI;  |FINSI;
         |SI fFecha2 > efFechaF;  fFecha2 = efFechaF;  |FINSI;
         nDias1 = (fFecha2 - fFecha1) + 1;
     |FINSI;

     aAlfa1 = "01.04." + #0#2;
     aAlfa2 = "30.06." + #0#2;
     |SI efFechaI > aAlfa2;
         nDias1 = 0;
         nDias2 = 0;
     |SINO;
         fFecha2 = aAlfa2;
         fFecha1 = aAlfa1;
         |SI fFecha1 < efFechaI;  fFecha1 = efFechaI;  |FINSI;
         |SI fFecha2 > efFechaF;  fFecha2 = efFechaF;  |FINSI;
         nDias2 = (fFecha2 - fFecha1) + 1;
     |FINSI;

     aAlfa1 = "01.07." + #0#2;
     aAlfa2 = "30.09." + #0#2;
     |SI efFechaI > aAlfa2;
         nDias1 = 0;
         nDias2 = 0;
         nDias3 = 0;
     |SINO;
         fFecha1 = aAlfa1;
         fFecha2 = aAlfa2;
         |SI fFecha1 < efFechaI;  fFecha1 = efFechaI;  |FINSI;
         |SI fFecha2 > efFechaF;  fFecha2 = efFechaF;  |FINSI;
         nDias3 = (fFecha2 - fFecha1) + 1;
     |FINSI;

     aAlfa1 = "01.10." + #0#2;
     aAlfa2 = "31.12." + #0#2;
     |SI efFechaI > aAlfa2;
         nDias1 = 0;
         nDias2 = 0;
         nDias3 = 0;
         nDias4 = 0;
     |SINO;
         fFecha1 = aAlfa1;
         fFecha2 = aAlfa2;
         |SI fFecha1 < efFechaI;  fFecha1 = efFechaI;  |FINSI;
         |SI fFecha2 > efFechaF;  fFecha2 = efFechaF;  |FINSI;
         nDias4 = (fFecha2 - fFecha1) + 1;
     |FINSI;

     |SI nDias1 < 0;  nDias1 = 0;  |FINSI;
     |SI nDias2 < 0;  nDias2 = 0;  |FINSI;
     |SI nDias3 < 0;  nDias3 = 0;  |FINSI;
     |SI nDias4 < 0;  nDias4 = 0;  |FINSI;

     |SI nMensa = 1;
         #912#0 = nDias1;   |PINTA #912#0;
         #912#1 = nDias2;   |PINTA #912#1;
         #912#2 = nDias3;   |PINTA #912#2;
         #912#3 = nDias4;   |PINTA #912#3;

         #912#5 = nDias1;   |PINTA #912#5;
         #912#6 = nDias2;   |PINTA #912#6;
         #912#7 = nDias3;   |PINTA #912#7;
         #912#8 = nDias4;   |PINTA #912#8;

         |ACABA;
     |FINSI;

     |SI #0#4 ! 0;  |O #0#5 ! 0;  |O #0#6 ! 0;  |O #0#7 ! 0;
         |SI #0#4 ! nDias1;  |O #0#5 ! nDias2;
          |O #0#6 ! nDias3;  |O #0#7 ! nDias4;
             |MENAV "0000Dias periodo informado no corresponde con la fecha de alta/baja de la actividad.";
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #0#9 ! 0;  |O #0#10 ! 0;  |O #0#11 ! 0;  |O #0#12 ! 0;
         |SI #0#9  ! nDias1;  |O #0#10 ! nDias2;
          |O #0#11 ! nDias3;  |O #0#12 ! nDias4;
             |MENAV "0000Dias periodo informado no corresponde con la fecha de alta/baja de la actividad.";
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #0#4 = 0;  |Y #0#5 = 0;  |Y #0#6 = 0;  |Y #0#7 = 0;
         #0#4 = nDias1;
         #0#5 = nDias2;
         #0#6 = nDias3;
         #0#7 = nDias4;
     |FINSI;

     |SI #0#9 = 0;  |Y #0#10 = 0;  |Y #0#11 = 0;  |Y #0#12 = 0;
         #0#9  = nDias1;
         #0#10 = nDias2;
         #0#11 = nDias3;
         #0#12 = nDias4;
     |FINSI;

     #0#8  = #0#4 + #0#5  + #0#6  + #0#7;
     #0#13 = #0#9 + #0#10 + #0#11 + #0#12;
|FPRC;

|PROCESO TotalDia;
     |SI FSalida = 10;
         nMensa = 1;  |HAZ CompruebaDias;

         |ERROR;
     |FINSI;

     #912#4 = #912#0 + #912#1 + #912#2 + #912#3;   |PINTA #912#4;
     #912#9 = #912#5 + #912#6 + #912#7 + #912#8;   |PINTA #912#9;
|FPRC;

|PROCESO DiasPeriodo;
     |HAZ Desaparece;

     |PUSHV 0501 2380;

     |PINPA #0#912;

     #912#0 = #0#4;
     #912#1 = #0#5;
     #912#2 = #0#6;
     #912#3 = #0#7;
     #912#4 = #0#8;
     #912#5 = #0#9;
     #912#6 = #0#10;
     #912#7 = #0#11;
     #912#8 = #0#12;
     #912#9 = #0#13;

     |PINDA #0#912;
     |ENDATOS #1#912;
     |SI FSalida = 0;
         #0#4  = #912#0;
         #0#5  = #912#1;
         #0#6  = #912#2;
         #0#7  = #912#3;
         #0#8  = #912#4;
         #0#9  = #912#5;
         #0#10 = #912#6;
         #0#11 = #912#7;
         #0#12 = #912#8;
         #0#13 = #912#9;

         enDiaTrimP1 = #0#4;
         enDiaTrimP2 = #0#5;
         enDiaTrimP3 = #0#6;
         enDiaTrimP4 = #0#7;
         enDiaTrimD1 = #0#9;
         enDiaTrimD2 = #0#10;
         enDiaTrimD3 = #0#11;
         enDiaTrimD4 = #0#12;

         nMensa = 0;  |HAZ CompruebaDias;
     |FINSI;

     |POPV;

     |PINTA #0#8;
     |PINTA #0#13;

     |HAZ Aparece;
|FPRC;

|PROCESO Elementos;
     |ATRI 0;
     eaCodEpi1 = "E";
     eaCodEpi2 = #0#0;
     enCodEpi3 = #0#1;
     enEjer    = #0#2;

     |HAZ Desaparece;
     |SUB_EJECUTA_NP "dsmom021";
     |HAZ Aparece;

     |HAZ PonIngresos;
|FPRC;

|PROCESO CalculoIRPF;
     |ATRI 0;
     eaCodEpi1 = "E";
     eaCodEpi2 = #0#0;
     enCodEpi3 = #0#1;
     enEjer    = #0#2;

     |HAZ Desaparece;

     enMasTrIRPF = 0;
     |SI eaDesTrab = "S";
         enNoLineal = 2;
         |SUB_EJECUTA_NP "dsmom020";
         enNoLineal = 0;
     |FINSI;
     |SUB_EJECUTA_NP "dsmom018";

     |HAZ Aparece;

     |HAZ PonIngresos;
|FPRC;

|PROCESO CalculoIVA;
     |ATRI 0;
     eaCodEpi1 = "E";
     eaCodEpi2 = #0#0;
     enCodEpi3 = #0#1;
     enEjer    = #0#2;

     |HAZ Desaparece;
     enMasTrIVA = 0;
     |SI eaDesTrab = "S";
         enNoLineal = 2;
         |SUB_EJECUTA_NP "dsmom020";
         enNoLineal = 0;
     |FINSI;
     |SUB_EJECUTA_NP "dsmom019";
     |HAZ Aparece;

     |HAZ PonIngresos;
|FPRC;

|PROCESO dsmom901I;
  |PRINT;
  enSw = 1;
|FPRC;

|DEFBUCLE dsmom901I;
  #901#1;
  ;
  #17#0, #17#1, #17#2, #17#3, 1;
  #17#0, #17#1, #17#2, #17#3, 99;
  ;
  NULL, dsmom901I;
|FIN;

|PROCESO Impresion;
     eaTituloL = "* INFORME MODULO * ";

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #0#2 [ 2009;
         |INFOR "dsmoz006";
     |SINO;
         |INFOR "dsmoz106";
     |FINSI;

     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     eaCodRenta = "";

     #17#15 = #0#4;
     #17#16 = #0#5;
     #17#17 = #0#6;
     #17#18 = #0#7;
     #17#19 = #0#8;

     #17#20 = #0#9;
     #17#21 = #0#10;
     #17#22 = #0#11;
     #17#23 = #0#12;
     #17#24 = #0#13;

     |SI enEmpresa = 0;
         #17#4 = "E";
         #17#5 = #0#0;
         #17#6 = #0#1;
         #17#1 = #0#2;
         #17#7 = #0#3;

         |ABRE #16;
         #16#0  = #17#4;
         #16#1  = #17#5;
         #16#41 = #17#6;
         #16#2  = enEjer;
         |LEE 040#16=;
         |SI FSalida ! 0;  |DDEFECTO #16;  |FINSI;
         |CIERRA #16;
     |FINSI;

     enSw = 0;
     |SI #17#1 > 2009;
         |BUCLE dsmom901I;
     |FINSI;
     |SI enSw = 0;
         |DDEFECTO #901;
         |PRINT;
     |FINSI;
     |PIEINF;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO Borra20;
     |BORRA 020#20a;
     |LIBERA #20;
|FPRC;

|DEFBUCLE dsmom020B;
     #20#1;
     ;
     enEmpresa, enEjer, enComplem, enActividad, 001;
     enEmpresa, enEjer, enComplem, enActividad, 999;
     be;
     NULL, Borra20;
|FIN;

|PROCESO Borra21;
     |BORRA 020#21a;
     |LIBERA #21;
|FPRC;

|DEFBUCLE dsmom021B;
     #21#1;
     ;
     enEmpresa, enEjer, enComplem, enActividad, 001;
     enEmpresa, enEjer, enComplem, enActividad, 999;
     be;
     NULL, Borra21;
|FIN;

|PROCESO Borra39;
     |BORRA 020#39a;
     |LIBERA #39;
|FPRC;

|DEFBUCLE dsmom039B;
     #39#1;
     ;
     enEmpresa, enEjer, enComplem, enActividad, 001;
     enEmpresa, enEjer, enComplem, enActividad, 999;
     be;
     NULL, Borra39;
|FIN;

|PROCESO Graba20;
     |LIBERA #20;

     |SI #20#19 > "01.01.0000";  |ACABA;  |FINSI;


     #20#1  = #20#1 + 1;
     #20#8  = #20#13;
     #20#9  = 225;
     #20#10 = #20#8 * #20#9;
     #20#11 = #20#16;
     #20#12 = #20#10 / #20#11;
     |SI #20#12 > 1;  #20#12 = 1;  |FINSI;

     #20#13 = 0;
     #20#14 = 0;
     #20#15 = 0;
     #20#16 = 0;
     #20#17 = 0;

     |GRABA 020#20n;
     |LIBERA #20;

     #20#1 = #20#1 - 1;
     |LEE 101#20=;

     eaDesTrab = "S";
|FPRC;

|DEFBUCLE dsmom020;
     #20#1;
     ;
     #17#0, #17#1, #17#2, #17#3, 001;
     #17#0, #17#1, #17#2, #17#3, 999;
     be;
     NULL, Graba20;
|FIN;

|PROCESO leem039;
    |ABRE #39;
    |DDEFECTO #39;
    #39#0 = #21#0;
    #39#1 = #21#1;
    #39#2 = #21#2;
    #39#3 = #21#3;
    #39#4 = #21#4;
    |LEE 001#39=;
    enEst39 = FSalida;
    |CIERRA #39;
|FPRC;

|PROCESO Graba21;

     |LIBERA #21;

     |HAZ leem039;
     |SI enEst39 = 0; |Y #39#6 [ ef2;
         |ACABA;
     |FINSI;

     #21#1  = #21#1 + 1;
     #21#8  = #21#11;
     #21#9  = 365; || #21#12;
     #21#10 = #21#13;

     #21#11 = 0;
     #21#12 = 0;
     #21#13 = 0;

     |SI #21#1 = 2000;  |O #21#1 = 2004;  |O #21#1 = 2008;
      |O #21#1 = 2012;  |O #21#1 = 2016;  |O #21#1 = 2020;
      |O #21#1 = 2024;  |O #21#1 = 2028;  |O #21#1 = 2032;
      |O #21#1 = 2036;  |O #21#1 = 2040;  |O #21#1 = 2044;
         |SI #21#9  = 365;  #21#9  = 366;  |FINSI;
         |SI #21#12 = 365;  #21#12 = 366;  |FINSI;

         #21#10 = (#21#08 * #21#09) / 366;
     |FINSI;

     |GRABA 020#21n;
     |LIBERA #21;

     #21#1 = #21#1 - 1;
     |LEE 101#21=;

     eaDesElem = "S";
|FPRC;

|DEFBUCLE dsmom021;
     #21#1;
     ;
     #17#0, #17#1, #17#2, #17#3, 001;
     #17#0, #17#1, #17#2, #17#3, 999;
     be;
     NULL, Graba21;
|FIN;

|PROCESO Traer;
     |SI enEmpresa = 0;  |ACABA;  |FINSI;

     |CONFI "0000NEsta seguro de traerse los datos del Ejercicio Anterior";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa = enEjer; aAlfa = "31.12." + aAlfa; ef2 = aAlfa;

     |ABRE #17;
     #17#0 = enEmpresa;
     #17#1 = enEjer - 1;
     #17#2 = enComplem;
     #17#3 = enActividad;
     |LEE 040#17=;
     |SI FSalida ! 0;
         |CIERRA #17;
         |MENAV "     No existe Ejercicio Anterior";
         |ACABA;
     |FINSI;
     |CIERRA #17;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsmom018.mas";
     |CARGA_DEF aMas, dsmom018@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsmom019.mas";
     |CARGA_DEF aMas, dsmom019@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #dsmom018@;
         |ACABA;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsmom068.mas";
     |CARGA_DEF aMas, dsmom068@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #dsmom019@;
         |DESCARGA_DEF #dsmom018@;
         |ACABA;
     |FINSI;

     |ABRE #918;
     #918#0 = enEmpresa;
     #918#1 = enEjer - 1;
     #918#2 = enComplem;
     #918#3 = enActividad;
     |LEE 040#918=;
     |SI FSalida ! 0;  |DDEFECTO #918;  |FINSI;
     |CIERRA #918;

     |ABRE #919;
     #919#0 = enEmpresa;
     #919#1 = enEjer - 1;
     #919#2 = enComplem;
     #919#3 = enActividad;
     |LEE 040#919=;
     |SI FSalida ! 0;  |DDEFECTO #919;  |FINSI;
     |CIERRA #919;

     |SI enEjer ] 2011;
        |ABRE #968;
        #968#0 = enEmpresa;
        #968#1 = enEjer - 1;
        #968#2 = enComplem;
        #968#3 = enActividad;
        |LEE 040#968=;
        |SI FSalida ! 0;  |DDEFECTO #968;  |FINSI;
        |CIERRA #968;

        |ABRE #68;
        #68#0 = enEmpresa;
        #68#1 = enEjer;
        #68#2 = enComplem;
        #68#3 = enActividad;
        |LEE 101#68=;
        |SI FSalida ! 0;
            |DDEFECTO #68;
            #68#0  = enEmpresa;
            #68#1  = enEjer;
            #68#2  = enComplem;
            #68#3  = enActividad;
            |GRABA 020#68b;
        |FINSI;
        |PDEFECTO #68, 4, 10;
        #68#4  = #968#5;
        #68#6  = #968#7;
        #68#8  = #968#9;
        |GRABA 020#68a;
        |LIBERA #68;
        |CIERRA #68;
     |FINSI;

     |ABRE #18;
     #18#0 = enEmpresa;
     #18#1 = enEjer;
     #18#2 = enComplem;
     #18#3 = enActividad;
     |LEE 101#18=;
     |SI FSalida ! 0;
         |DDEFECTO #18;
         #18#0  = enEmpresa;
         #18#1  = enEjer;
         #18#2  = enComplem;
         #18#3  = enActividad;
         |GRABA 020#18b;
     |FINSI;

     |PDEFECTO #18, 15, 255;
     #18#26 = #918#48;
     #18#27 = #918#49;
     #18#28 = #918#50;
     #18#29 = #918#51;
     #18#30 = #918#52;
     #18#31 = #918#53;
     #18#32 = #918#54;
     #18#33 = #918#55;
     #18#34 = #918#56;
     #18#35 = #918#57;
     #18#36 = #918#58;

     #18#81  = #918#82;
     #18#83  = #918#84;
     #18#85  = #918#86;
     #18#87  = #918#88;
     #18#89  = #918#90;
     #18#91  = #918#92;
     #18#93  = #918#94;
     #18#95  = #918#96;
     #18#97  = #918#98;
     #18#99  = #918#100;
     #18#101 = #918#102;
     #18#103 = #918#104;
     #18#105 = #918#106;

     #18#134 = #918#98;
     #18#137 = #918#100;
    || #18#194 = #918#98;
    || #18#197 = #918#100;

     |GRABA 020#18a;
     |LIBERA #18;
     |CIERRA #18;


     |ABRE #19;
     #19#0 = enEmpresa;
     #19#1 = enEjer;
     #19#2 = enComplem;
     #19#3 = enActividad;
     |LEE 101#19=;
     |SI FSalida ! 0;
         |DDEFECTO #19;
         #19#0  = enEmpresa;
         #19#1  = enEjer;
         #19#2  = enComplem;
         #19#3  = enActividad;
         |GRABA 020#19b;
     |FINSI;

     |PDEFECTO #19, 15, 148;
     #19#26 = #919#48;
     #19#27 = #919#49;
     #19#28 = #919#50;
     #19#29 = #919#51;
     #19#30 = #919#52;
     #19#31 = #919#53;
     #19#32 = #919#54;
     #19#33 = #919#55;
     #19#34 = #919#56;
     #19#35 = #919#57;
     #19#36 = #919#58;

     #19#81  = #919#82;
     #19#83  = #919#84;
     #19#85  = #919#86;
     #19#87  = #919#88;
     #19#89  = #919#90;
     #19#91  = #919#92;
     #19#93  = #919#94;
     #19#95  = #919#96;
     #19#97  = #919#98;
     #19#99  = #919#100;
     #19#101 = #919#102;
     #19#103 = #919#104;
     #19#105 = #919#106;

     |PDEFECTO #19, 154, 160;
     #19#154 = #919#155;
     #19#156 = #919#157;
     #19#158 = #919#159;

     |GRABA 020#19a;
     |LIBERA #19;
     |CIERRA #19;

     |DESCARGA_DEF #dsmom068@;
     |DESCARGA_DEF #dsmom019@;
     |DESCARGA_DEF #dsmom018@;

     eaDesTrab = "N";
     eaDesElem = "N";
     eaDesInve = #17#11;

     #0#4  = #17#20;
     #0#5  = #17#21;
     #0#6  = #17#22;
     #0#7  = #17#23;
     #0#8  = #17#24;

     #0#9  = #17#20;
     #0#10 = #17#21;
     #0#11 = #17#22;
     #0#12 = #17#23;
     #0#13 = #17#24;
     #0#16 = #17#11;

     |SI #17#24 = 366;
         #0#4  = 90;
         #0#9  = 90;
         #0#8  = 365;
         #0#13 = 365;
     |FINSI;
     |SI #0#2 = 2000; |O #0#2 = 2004; |O #0#2 = 2008;
         |O #0#2 = 2012; |O #0#2 = 2016; |O #0#2 = 2020;
            |SI #17#24 = 365;
                 #0#4  = 91;
                 #0#9  = 91;
                 #0#8  = 366;
                 #0#13 = 366;
            |FINSI;
     |FINSI;

     nMensa = 0;
     nNume1 = enEjer - 1;
     |SI efDFecA > "01.01.1900";
         aAlfa = efDFecA; aAlfa = aAlfa % -104;
         nNume = aAlfa;
         |SI nNume = nNume1;  nMensa = 1;  |FINSI;
     |FINSI;
     |SI efHFecA > "01.01.1900";
         aAlfa = efHFecA; aAlfa = aAlfa % -104;
         nNume = aAlfa;
         |SI nNume [ enEjer;  nMensa = 1;  |FINSI;
     |FINSI;
     |SI nMensa = 1;
         |HAZ CompruebaDias;
         #0#4 = nDias1;  #0#09 = nDias1;
         #0#5 = nDias2;  #0#10 = nDias2;
         #0#6 = nDias3;  #0#11 = nDias3;
         #0#7 = nDias4;  #0#12 = nDias4;
         #0#8  = #0#4 + #0#5  + #0#6  + #0#7;
         #0#13 = #0#9 + #0#10 + #0#11 + #0#12;
     |FINSI;

     enDiaTrimP1 = #0#4;
     enDiaTrimP2 = #0#5;
     enDiaTrimP3 = #0#6;
     enDiaTrimP4 = #0#7;
     enDiaTrimD1 = #0#9;
     enDiaTrimD2 = #0#10;
     enDiaTrimD3 = #0#11;
     enDiaTrimD4 = #0#12;

     |PINTA #0#8;
     |PINTA #0#13;

     |BUCLE dsmom020B;
     |BUCLE dsmom021B;
     |BUCLE dsmom039B;

     |BUCLE dsmom020;
     |BUCLE dsmom021;

     |HAZ Desaparece;

     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton3, "DISABLE";

     |SI eaDesTrab = "S";
         |ESTADO_CONTROL nBoton2, "ENABLE";
         enNoLineal = 1;
         |SUB_EJECUTA_NP "dsmom020";
         enNoLineal = 0;
         #0#14      = "S";
     |FINSI;

     |SI eaDesElem = "S";
         |ESTADO_CONTROL nBoton3, "ENABLE";
         enNoLineal = 1;
         |SUB_EJECUTA_NP "dsmom021";
         enNoLineal = 0;
         #0#15     = "S";
     |FINSI;

     |HAZ Aparece;

     |HAZ PonIngresos;
|FPRC;

|PROCESO Comentarios;

    |SI enEmpresa = 0;  |ACABA;  |FINSI;

    |HAZ Desaparece;
    |SUB_EJECUTA_NP "dsmom901";
    |HAZ Aparece;

    |FIN_CONTROL_WINDOWS nBoton18;

    |HAZ AbreBoton18;
    |SI enEmpresa ! 0;
         |ESTADO_CONTROL nBoton18, "ENABLE";
    |SINO;
         |ESTADO_CONTROL nBoton18, "DISABLE";
    |FINSI;
|FPRC;

|PROCESO Salir;
     |PTEC 806;
|FPRC;

|PROCESO Ejercicio;
     |SI #0#2 = 0;  |ERROR;  |FINSI;

     |SI enEmpresa = 0; |Y #0#2 ! 0;
         aAlfa    = #0#2;  aAlfa    = "01.01." + aAlfa; efFechaI = aAlfa;
         aAlfa    = #0#2;  aAlfa    = "31.12." + aAlfa; efFechaF = aAlfa;
     |FINSI;
|FPRC;

|PROCESO Epigrafe;
     |SI #0#0 = "    ";  |ERROR;  |FINSI;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
     |SI enEmpresa = 0;
         aFichero = ("18" + Usuario + "zzzzzzzz") % 108;
         |NOME_DAT #18 aFichero;

         |ABRE #18;  |CIERRA #18;  |DELINDEX #18;

         aFichero = ("19" + Usuario + "zzzzzzzz") % 108;
         |NOME_DAT #19 aFichero;
         |ABRE #19;  |CIERRA #19;  |DELINDEX #19;

         aFichero = ("68" + Usuario + "zzzzzzzz") % 108;
         |NOME_DAT #68 aFichero;
         |ABRE #68;  |CIERRA #68;  |DELINDEX #68;
     |FINSI;

     |ESTADO_CONTROL nBoton1, "ENABLE";

     |SI eaDesTrab = "S";  |ESTADO_CONTROL nBoton2, "ENABLE";  |FINSI;
     |SI eaDesElem = "S";  |ESTADO_CONTROL nBoton3, "ENABLE";  |FINSI;

     |ESTADO_CONTROL nBoton4, "ENABLE";
     |ESTADO_CONTROL nBoton5, "ENABLE";
     |ESTADO_CONTROL nBoton6, "ENABLE";
     |ESTADO_CONTROL nBoton7, "ENABLE";
     |SI enEmpresa ! 0;
         |ESTADO_CONTROL nBoton8, "ENABLE";
         |ESTADO_CONTROL nBoton18, "ENABLE";
     |SINO;
         |ESTADO_CONTROL nBoton8, "DISABLE";
         |ESTADO_CONTROL nBoton18, "DISABLE";
     |FINSI;

     aF2    = &255 + "824";
     aF3    = &255 + "825";
     aF4    = &255 + "826";
     aF5    = &255 + "827";
     aF6    = &255 + "828";
     aF7    = &255 + "829";
     aF8    = &255 + "830";
     aF18   = &255 + "841";
     aEsc   = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  |HAZ DiasPeriodo;  |FINSI;
         |SI aTecla = aF3;  |Y eaDesTrab = "S"; |HAZ Trabajadores; |FINSI;
         |SI aTecla = aF4;  |Y eaDesElem = "S"; |HAZ Elementos;    |FINSI;
         |SI aTecla = aF5;  |HAZ CalculoIRPF;  |FINSI;
         |SI aTecla = aF6;  |HAZ CalculoIVA;;  |FINSI;
         |SI aTecla = aF7;  |HAZ Impresion;    |FINSI;
         |SI aTecla = aF8;  |HAZ Traer;        |FINSI;
         |SI aTecla = aF18; |HAZ Comentarios;  |FINSI;
         |SI aTecla = aEsc; |SAL;              |FINSI;
     |SIGUE;

     eaDesTrab   = #0#14;
     eaDesElem   = #0#15;
     eaDesInve   = #0#16;
|FPRC;

|PROCESO AbreBoton18;
     |ABRE #901;
     #901#0 = enEmpresa;
     #901#1 = enEjer;
     #901#2 = enComplem;
     #901#3 = enActividad;
     #901#4 = 1;
     |LEE 000#901];
     |SI FSalida = 0;  |Y  #901#0 = enEmpresa;  |Y  #901#1 = enEjer;
                       |Y  #901#2 = enComplem;  |Y  #901#3 = enActividad;
         |CONTROL_SIMPLE 0, "LBOTON,Ctrl-F9 Comentarios (Con datos)", 0945, 0964, Comentarios;
     |SINO;
         |CONTROL_SIMPLE 0, "LBOTON,Ctrl-F9 Comentarios (Sin datos)", 0945, 0964, Comentarios;
     |FINSI;
     nBoton18 = FSalida;
     |CIERRA #901;
|FPRC;

|PROCESO AbreBotones;
     |CONTROL_SIMPLE 0, "BOTON,F2 Dias Periodo", 0966, 0980, DiasPeriodo;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F3 Trabajadores", 1166, 1180, Trabajadores;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F4 Elementos   ", 1366, 1380, Elementos;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F5 I.R.P.F.", 1566, 1580, CalculoIRPF;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F6 I.V.A.", 1766, 1780, CalculoIVA;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F7 Impresion", 1966, 1980, Impresion;
     nBoton6 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F8 Traer Ej.Anterior", 2166, 2180, Traer;
     nBoton8 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,<Esc> Salir", 2366, 2380, Salir;
     nBoton7 = FSalida;

     |HAZ AbreBoton18;

     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton3, "DISABLE";
     |ESTADO_CONTROL nBoton4, "DISABLE";
     |ESTADO_CONTROL nBoton5, "DISABLE";
     |ESTADO_CONTROL nBoton6, "DISABLE";
     |ESTADO_CONTROL nBoton7, "DISABLE";
     |ESTADO_CONTROL nBoton8, "DISABLE";
     |ESTADO_CONTROL nBoton18, "DISABLE";
|FPRC;

|PROCESO CierraBotones;
     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |FIN_CONTROL_WINDOWS nBoton7;
     |FIN_CONTROL_WINDOWS nBoton8;
     |FIN_CONTROL_WINDOWS nBoton18;

     |PULSATECLA;
|FPRC;

|PROCESO Instala;
     eaExtension = "mod";
     eaPrograma  = "dsmom015";
     |SUB_EJECUTA_NP ":basica/dspatron";

     eaExtension = "mod";
     eaPrograma  = "dsmom016";
     |SUB_EJECUTA_NP ":basica/dspatron";

     eaExtension = "mod";
     eaPrograma  = "dsmom033";
     |SUB_EJECUTA_NP ":basica/dspatron";

     eaExtension = "mod";
     eaPrograma  = "dsmom133";
     |SUB_EJECUTA_NP ":basica/dspatron";
|FPRC;

|PROCESO VerPatModulos;
     nError = 0;

     |ABRE #16;
     #16#0  = "E";
     #16#1  = "4191"
     #16#41 = 1;
     #16#2  = 2020;
     |LEE 040#16=;
     |SI FSalida ! 0;
         nError = 1;
     |FINSI;
     |CIERRA #16;

     |SI nError ! 0;
         |HAZ Instala;

         |ABRE #16;
         #16#0  = "E";
         #16#1  = "4191"
         #16#41 = 1;
         #16#2  = 2020;
         |LEE 040#16=;
         |SI FSalida ! 0;
             |MENAV "0000Fichero patron incorrecto, no estan los Modulos 2020. Pongase en contacto con su admistrador";
             nError = 1;
         |SINO;
             |SI nError = 1;
                 |MENAV "0000Se ha instalado el fichero patron de epigrafes con los modulos del 2020";
             |FINSI;
             nError = 0;
         |FINSI;
         |CIERRA #16;
     |FINSI;
|FPRC;

|PROGRAMA;
     |HAZ VerPatModulos;
     |SI nError = 1; |ACABA; |FINSI;

     |HAZ LeeEURODBMOD;

     |CLS;
     |DDEFECTO #0;
     |PINPA #0#0;

     |HAZ AbreBotones;

     |SI enEmpresa ! 0;
         #0#0 = eaCodEpi2;
         #0#1 = enCodEpi3;
         #0#2 = enEjer;
         #0#3 = eaNombreEmp;

         #0#4 = enDiaTrimP1;
         #0#5 = enDiaTrimP2;
         #0#6 = enDiaTrimP3;
         #0#7 = enDiaTrimP4;
         #0#8 = #0#4 + #0#5 + #0#6 + #0#7;

         #0#9  = enDiaTrimD1;
         #0#10 = enDiaTrimD2;
         #0#11 = enDiaTrimD3;
         #0#12 = enDiaTrimD4;
         #0#13 = #0#9 + #0#10 + #0#11 + #0#12;

         #0#14 = eaDesTrab;
         #0#15 = eaDesElem;
         #0#16 = eaDesInve;

         |C_M #0#0, 1, "N";
         |C_M #0#1, 1, "N";
         |C_M #0#2, 1, "N";
         |C_M #0#3, 1, "N";

          nMensa = 0;  |HAZ CompruebaDias;
     |SINO;
         enEmpresa   = 0;
         enActividad = 0;
         enComplem   = 0;
         |C_M #0#3, 1, "S";
     |FINSI;

     |HAZ PonIngresos;
     |PINDA #0#0;
     |ENDATOS #1#0;

     |HAZ CierraBotones;
|FPRO;
