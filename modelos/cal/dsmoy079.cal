|FICHEROS;
   dsmoy079 #0;

   dsmom016 #16;
   dsmom017 #17;
   dsmom018 #18;
   dsmom068 #68;

   :/basica/def/agifigen #118;
|FIN;

|VARIABLES;
   &entrada = 1;
   &efDFecha  = @;
   &efHFecha  = @;

   informe    = "dsmoy079";
   aFichero   = "";
   nCampo     = 0;
   nDEmpresa  = 0;
   nHEmpresa  = 0;
   nDActividad = 0;
   nHActividad = 0;

   nError      = 0;
   nSPin1      = 0;

   aAlfa  = "";
   aAlfa1 = "";
   aAlfa2 = "";
   aAlfa3 = "";
   nPara1 = 0;
   nPara2 = 0;
   nNume1 = 0;
   nNume2 = 0;
   nNume3 = 0;
   nNume4 = 0;

   &SwLinea   = 0;
   sw         = 0;

   fLaFecha = @;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;


|| //////////////////// Calculos de Pantalla \\\\\\\\\\\\\\\\\\\\\\\\\\
|CALCULO Eano; |TIPO 7;
  |SI #0#1 = 1900;
      fLaFecha = ~;
      aAlfa1 = fLaFecha; aAlfa1 = aAlfa1 % -104;
      #0#1 = aAlfa1;
      |PINTA #0#1;
  |FINSI;
|FCAL;

|CALCULO ElEjer; |TIPO 0;
   aAlfa1 = #0#1;
   aAlfa2 = "01.01." + aAlfa1; #0#42 = aAlfa2;
   aAlfa3 = "31.12." + aAlfa1; #0#43 = aAlfa3;
|FCAL;

|CALCULO Tipo7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#2  = enEmpresa;  |PINTA #0#2;
         #0#3  = enEmpresa;  |PINTA #0#3;

         |C_M #0#2, 1, "N";
         |C_M #0#3, 1, "N";
     |FINSI;
|FCAL;

|CALCULO Parrilla; |TIPO 0;
     |SI #0#2 = 0;
         #0#2 = 0;  |PINTA #0#2;
         #0#3 = 0;  |PINTA #0#3;  |C_M #0#3, 1, "N";
         |PARA nCampo = 4;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#2, 1, "S";
             |C_M #0#3, 1, "S";
         |FINSI;

         |PARA nCampo = 4;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO NoMasEmpresas; |TIPO 0;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO YaSeCual; |TIPO 7;
 |SI enEmpresa ! 0;
     #0#41 = "S"; |PINTA #0#41;
     #0#24 = "S"; |PINTA #0#24;
     #0#25 = 00;  |PINTA #0#25;
     #0#26 = 99;  |PINTA #0#26;
     |C_M #0#24, 1, "N";
     |C_M #0#25, 1, "N";
     |C_M #0#26, 1, "N";
     |C_M #0#41, 1, "N";
 |FINSI;
|FCAL;

|CALCULO SelTipo0; |TIPO 0;
 |SI #0#41 = "N";
     #0#25 = 0;   |PINTA #0#25;  |C_M #0#25, 1, "N";
     #0#26 = 99;  |PINTA #0#26;  |C_M #0#26, 1, "N";
     |PARA nCampo = 27;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "S";
     |SIGUE;
 |SINO;
     |SI enEmpresa = 0;
         |C_M #0#25, 1, "S";
         |C_M #0#26, 1, "S";
     |FINSI;
     |PARA nCampo = 27;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "N";
           #0nCampo = 0;  |PINTA #0nCampo;
     |SIGUE;
 |FINSI;
|FCAL;

|CALCULO SelTipo1;
 |SI #0Campo = 0;
     |PARA nCampo = Campo + 1;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
           #0nCampo = 0;  |C_M #0nCampo, 1, "N";
     |SIGUE;
 |SINO;
     |PARA nCampo = Campo + 1;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "S";
     |SIGUE;
 |FINSI;
|FCAL;

|| **************************************************************************
|PROCESO CargaEpigrafe;
     nError = 0;
     |SELECT #1#16;
     #16#0  = "E";
     #16#1  = eaCodEpi2;
     #16#41 = enCodEpi3;
     #16#2  = enEjer;
     |LEE 040#16=;
     |SI FSalida ! 0; nError = 1; |FINSI;
|FPRC;

|PROCESO Imprime;

 |SALVA_FICHA #17;
 #17#2 = #17#2 + 1;
 |LEE 000#17=;
 |SI FSalida = 0;
     |REPON_DATOS #17;
     |ACABA;
 |FINSI;
 |REPON_FICHA #17;

 #118#0 = #17#0;
 |LEE 041#118=;
 |SI FSalida ! 0; |ACABA; |FINSI;

 eaEstadoEmp = "S";
 |SI #118#94 > "01.01.0000";
      eaEstadoEmp = "N";
      |SI #0#24 = "N"; |ACABA; |FINSI;
 |FINSI;

|| ... Seleccion de Tipo de Empresa
   nSPin1 = #118#87;
   enSwSelEmp = 1;
   |SI #0#41 = "S";
       |SI nSPin1 ] #0#25; |Y nSPin1 [ #0#26;
           enSwSelEmp = 0;
       |FINSI;
   |SINO;
       |SI nSPin1 = #0#27;
           enSwSelEmp = 0;
       |SINO;
           |PARA nCampo = 28;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
                 |SI nSPin1 = #0nCampo; |Y nSPin1 ! 0;
                    enSwSelEmp = 0;
                    |SAL;
                |FINSI;
          |SIGUE;
      |FINSI;
  |FINSI;
  |SI enSwSelEmp = 1; |ACABA; |FINSI;
|| ------------------------------------------------------------------------

    |PDEFECTO #0, 44, 49;
    eaCodEpi2   = #17#5;
    enCodEpi3   = #17#6;
    |HAZ CargaEpigrafe;
    |SI nError = 1; |ACABA; |FINSI; ||no existe Epigrafe.

    #18#0 = #17#0;
    #18#1 = #17#1;
    #18#2 = #17#2;
    #18#3 = #17#3;
    |LEE 101#18=;
    |SI FSalida ! 0;
        |ACABA;
    |FINSI;

    |DDEFECTO #68;
    |SI enEjer ] 2011;
        #68#0 = #17#0;
        #68#1 = #17#1;
        #68#2 = #17#2;
        #68#3 = #17#3;
        |LEE 101#68=;
    |FINSI;

    #0#44 = #18#82 + #18#86 + #18#90 + #18#94 + #68#5;
    #0#44 = #0#44 + #18#84 + #18#88 + #18#92 + #18#96 + #68#7;
    #0#45 = #18#102 + #18#104 + #18#106;

    #0#46 = #0#44 + #0#45;
    #0#47 = #16#43;

    #0#48 = #0#46 - #0#47;
    |SI #0#48 > 0; |O #0#0 = "S";
        |PRINT;
        sw = 1;
    |FINSI;
|FPRC;

|DEFBUCLE Leem017;
  #17#1;
  ;
  nDEmpresa, #0#1, 00, #0#37;
  nHEmpresa, #0#1, 99, #0#38;
  ;
  NULL, Imprime;
|FIN;

||///////////////////////////////////////////////////////////////////
|CALCULO Tipo3;  |TIPO 3;
    |HAZ LeeEURODBMOD;

    enEjer    = #0#1;
    efDFecha  = #0#47;
    efHFecha  = #0#48;

    |IMPRE 0;
    |SI FSalida ! 0; |MENAV "    Error en Impresora"; |ACABA; |FINSI;

    |INFOR informe;
    |SI FSalida ! 0;
        |MENAV "    Error en Informe. ";
        |FINIMP;
        |ACABA;
    |FINSI;

    sw = 0;
    |ABRE #118;
    |ABRE #16;
    |ABRE #18;
    |ABRE #68;
    |SI #0#2 ! 0;
        nDEmpresa = #0#2;
        nHEmpresa = #0#3;
        |BUCLE Leem017;
    |SINO;
        |PARA nCampo = 4;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
              |SI #0nCampo ! 0;
                  nDEmpresa = #0nCampo;
                  nHEmpresa = #0nCampo;
                  |BUCLE Leem017;
              |FINSI;
        |SIGUE;
    |FINSI;
    |CIERRA #68;
    |CIERRA #18;
    |CIERRA #118;

    |SI sw = 1;
        |PIEINF;
    |FINSI;

    |FININF;
    |FINIMP;
|FCAL;
|| *************************************************************************
