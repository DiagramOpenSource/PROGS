|| .......................... Actualizacion de Numero Documento y Registro
|FICHEROS;
   :/contagen/def/caconasi #20;
   :/contagen/def/co2asie #2;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|RUTINA ajustaregistro;

   || No se bloquea la cabecera de asientos, sin embargo como para cualquier incremento
   || del contador de registros (cualquier nuevo asiento) ha de pasar por aqui y el contador
   || esta bloqueado, ya impide coincidencias.

   |PATH_DAT #2 aPathConta;
   |ABRE #co2asie;

   |SELECT #4#co2asie;          ||N§ de registro es la clave 4.
   #co2asie#12 = #caconasi#2;
   |LEE 010#co2asie.=;
   |SI FSalida = 0;
      |LEE 010#co2asie.u;
      |SI FSalida ! 0;
          #caconasi#2 = 1;
          #caconasi#1 = 1;
      |SINO;
          #caconasi#2 = #co2asie#12 + 1;
          #caconasi#1 = #co2asie#2  + 1;
      |FINSI;
   |SINO;
      |SI #caconasi#2 = 0;
         #caconasi#2 = 1;
         #caconasi#1 = 1;
      |FINSI;
   |FINSI;

   |SELECT #1#co2asie;
   |CIERRA #co2asie;
|FRUT;

|RUTINA ajustadocumento;
   |PATH_DAT #2 aPathConta;
   |ABRE #co2asie;
   |SELECT #3#co2asie;
   |PARA;|SI;|HACIENDO;
         #co2asie#2 = #caconasi#1;
         |LEE 010#co2asie.=;
         |SI FSalida ! 0;
              |SI #caconasi#1 ! 0; |SAL; |FINSI;
         |FINSI;
         #caconasi#1 = #caconasi#1 + 1;
   |SIGUE;
   |SELECT #1#co2asie;
   |CIERRA #co2asie;
|FRUT;

|PROCESO contador;
   |PATH_DAT #20 aPathConta;
   |ABRE #20;
   |LEE 101#20p;
   |SI FSalida ! 0;
      |DDEFECTO #20;
      |GRABA 020#20n;
      |LEE 101#20p;
   |FINSI;
   |HAZ ajustadocumento;
   |HAZ ajustaregistro;
   nREGISTRO   = #caconasi#2;
   nDOCUMENTO  = #caconasi#1;

   |GRABA 020#20a;
   |LIBERA #20;
   |CIERRA #20;
|FPRC;

|PROCESO NuevoRegistro; || igual que contador pero no toca el numero de documento
   |PATH_DAT #2 aPathConta;
   |PATH_DAT #20 aPathConta;
   |ABRE #20;
   |LEE 101#20p;
   |SI FSalida ! 0;
      |DDEFECTO #20;
      |GRABA 020#20n;
      |LEE 101#20p;
   |FINSI;
   |HAZ ajustaregistro;
   nREGISTRO   = #caconasi#2;
   nDOCUMENTO  = #caconasi#1;
   |GRABA 020#20a;
   |LIBERA #20;
   |CIERRA #20;
|FPRC;


|PROCESO NuevoDoc;
   |PATH_DAT #2 aPathConta;
   |PATH_DAT #20 aPathConta;
   |ABRE #20;
   |LEE 101#20p;
   |SI FSalida ! 0;
      |DDEFECTO #20;
      |GRABA 020#20n;
      |LEE 101#20p;
   |FINSI;
   |HAZ ajustadocumento;
   nREGISTRO   = #caconasi#2;
   nDOCUMENTO  = #caconasi#1;
   |GRABA 020#20a;
   |LIBERA #20;
   |CIERRA #20;
|FPRC;

|PROCESO ActContador;  ||actualizacion exterior
   |PATH_DAT #2 aPathConta;
   |PATH_DAT #20 aPathConta;
   |ABRE #20;
   |LEE 101#20p;
   |SI FSalida ! 0;
      |DDEFECTO #20;
      |GRABA 020#20n;
      |LEE 101#20p;
   |FINSI;
   #caconasi#2 = nREGISTRO;
   #caconasi#1 = nDOCUMENTO;
   |GRABA 020#20a;
   |LIBERA #20;
   |CIERRA #20;
|FPRC;
