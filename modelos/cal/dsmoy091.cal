|FICHEROS;
     dsmoy091 #0;

     dsmod005 #5;

     :/basica/def/agicen14 #114;
     :/basica/def/agicen15 #115;

     dsmow030 #900;
     dsmoy000 #990;
     dsmow529 #529;

     dsmow014 #999;
     &clientes@ #715;

     pdfimtmp #100;
     pdfdocca #110;
     pdfdocli #120;
|FIN;

|VARIABLES;
      aParam      = "";
      nAnyo       = 0;
      informe     = "dsmoy091";
      inform1     = "m005co01";

      &enDMedio   = 0;
      &enHMedio   = 0;

      &enActividad = 0;
      &enPeriodo   = 0;
      &enEjer      = 0;
      nDEmpresa    = 0;
      nHEmpresa    = 0;
      nDActividad  = 0;
      nHActividad  = 0;
      nLaEmpresa   = 0;
      &nCamSel     = 21;
      &nCamTip     = 34;
      nSw          = 0;

      nPara1      = 0;
      swBueno     = 0;
      &swerror    = 0;

      &eaNombreEmp = "";
      &eaEstadoEmp = "";
      &enSwSelEmp  = 0;
      &efFecTope   = @;
      &enTpEm      = 0;
      nLineal      = 0;
      &eaCodAd     = "";
      &eaSoli      = "";
      rNif         = "";
      rNombre      = "";
      rSg          = "";
      rDireccion   = "";
      rNumero      = "";
      rEscalera    = "";
      rPiso        = "";
      rPuerta      = "";
      rCodPostal   = "";
      rPoblacion   = "";
      rProvincia   = "";
      rTelefono    = "";

      &eaPrograma  = "";
      aValor       = "";
      aCampo       = "";
      swCarga      = 0;
      &aID         = "";
      aLongitud = "";
      nLongitud = "";
      aCaracterSal = "";
      aCadenaSal = "";
      nBusca = 0;
      nAscii = 0;
      &enQuePare = 0;
|FIN;

|INCLUYE i_varemi;
|INCLUYE i_selcon;
|INCLUYE i_varlib;
|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|| //////////////////// Calculos de Pantalla \\\\\\\\\\\\\\\\\\\\\\\\\\
|CALCULO Tipo7C21; |TIPO 7;
  #0#4 = aParam;
  |SI #0#4 = "I";
      |ATRI R; |PINTA 0602,"Informe de Comprobacion de Medios de Transporte "; |ATRI 0;
  |SINO;
      |C_M #0#3,  1, "N"; |C_V #0#3,  1, "N";
      |C_M #0#35, 1, "N"; |C_V #0#35, 1, "N";
      |PINTA 1150, "         ";
      |PINTA 1832, "³                                         ³";
      |PINTA 1932, "ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";
      |PINTA 2032, "                                           ";
      |SI aParam = "MC";
          |ATRI R; |PINTA 0602,"Informe de Comprobacion del Modelo 05";
      |FINSI;
  |FINSI;
|FCAL;

|CALCULO Tipo7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#5  = enEmpresa;  |PINTA #0#5;
         #0#6  = enEmpresa;  |PINTA #0#6;

         |C_M #0#5, 1, "N";
         |C_M #0#6, 1, "N";
     |FINSI;
|FCAL;

|CALCULO Parrilla;
     |SI #0#5 = 0;
         #0#5 = 0;  |PINTA #0#5;
         #0#6 = 0;  |PINTA #0#6;  |C_M #0#6, 1, "N";
         |PARA nCampo = 7;  |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#5, 1, "S";
             |C_M #0#6, 1, "S";
         |FINSI;

         |PARA nCampo = 7;  |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|PROCESO Defecto; |TIPO 7;
     |SI aParam = ""; |O enEjer = 0;
         fFecha = ~;
         aAlfa  = fFecha % -104;
         #0#2   = aAlfa; |PINTA #0#2;
         #0#3   = aAlfa; |PINTA #0#3;

         |C_M #0#3, 1, "S";
         |SI #0#4 = "M"; |C_M #0#3, 1, "N"; |FINSI;
     |FINSI;
|FPRC;

|| **************************************************************
|| ///////////// Procesos del Informe  \\\\\\\\\\\\\\\\\\\\\\\\\\
|PROCESO LeeDatosEmpresa;
  |DDEFECTO #900;
  #900#0 = enEmpresa;
  eaInac = #0#21;
  eaTituloL = "";
  enActividad = 0;
  |HAZ DatosEmpr_w30;
|FPRC;

|PROCESO LaImpresion;
   |SI nLaEmpresa ! #5#0;
       |SI nLaEmpresa ! -1;
           |SI nSw = 1; |PIEINF; |FINSI;
       |FINSI;
       nLaEmpresa = #5#0;
       enEmpresa  = #5#0;
       swBueno = 0;
       |HAZ LaSelEmpresa;
       |SI enSwSelEmp = 1;
           swBueno = 1;
       |SINO;
           |HAZ LeeDatosEmpresa;
       |FINSI;

   |FINSI;
   |SI swBueno = 1; |ACABA; |FINSI;

   |PRINT; nSw = 1;
|FPRC;

|DEFBUCLE dsmoy091;
   #5#1;
   2;
   nDEmpresa,#0#0,#0#2;
   nHEmpresa,#0#1,#0#3;
   e;
   NULL, LaImpresion;
|FIN;

|PROCESO imprimir;
      nLaEmpresa = -1;
      swBueno    = 0;
      |BUCLE dsmoy091;
|FPRC;

|| ------------------------------------------------------------------
|| ---------- Procesos de Emision
|PROCESO GrabaImpres05;
     #5#4 = "X";
     #5#5 = #0#36;
     |GRABA 020#5a;
|FPRC;

|PROCESO Registro05_2010;
     || ... por si encontramos el modulo de impresion del modelo
|FPRC;

|PROCESO sustituye2;
     nAscii = & aCaracter;
     aCaracterSal = aCaracter;
     ||SI nAscii = 160;
     |SI nAscii = 225;
          aCaracterSal = "\341";        || la a con tilde
     |FINSI;
     ||SI nAscii = 160;
     |SI nAscii = 233;
          aCaracterSal = "\351";        || la e con tilde
     |FINSI;
     ||SI nAscii = 160;
     |SI nAscii = 237;
          aCaracterSal = "\355";        || la i con tilde
     |FINSI;
     ||SI nAscii = 160;
     |SI nAscii = 243;
          aCaracterSal = "\363";        || la o con tilde
     |FINSI;
     ||SI nAscii = 160;
     |SI nAscii = 250;
          aCaracterSal = "\372";        || la u con tilde
     |FINSI;
     ||SI nAscii = 160;
     |SI nAscii = 241;
          aCaracterSal = "\361";        || la ¤ con tilde
     |FINSI;
|FPRC;

|PROCESO sustituye;
     aCadenaSal = "";
     aLongitud = aCadena % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
          nBusca = (nPos * 100) + 1;
          aCaracter = aCadena % nBusca;
          |HAZ sustituye2;
          aCadenaSal = aCadenaSal + aCaracterSal;
     |SIGUE;
|FPRC;

|PROCESO CargaCampos;

     aValor = "";
     aCampo = #pdfdocli#2;
     aCadena = aCampo;
     |QBF aCadena;
     |HAZ sustituye;
     aCampo = aCadenaSal;
     |QBF aCampo;

     |SI aCampo = "cabecera.1";
          aValor = eaDeleg;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "cabecera.2";
         aValor = eaAdmin;
         |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "cabecera.3";
         aValor = eaCodAd;
         |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "dato.a.nif.1";  ||  dni
          aValor = #529#8;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "dato.a.nif.2";  ||  dni
          aValor = #5#23;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "dato.a.nif.3";  ||  dni
          aValor = #529#20;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI aCampo = "dato.1";
          aValor = #5#2;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI aCampo = "dato.2";
          aValor = #529#9;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI aCampo = "dato.3";
          aValor = #529#10;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI aCampo = "dato.4";
          aValor = #529#11;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI aCampo = "dato.5";
          aValor = #529#12;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI aCampo = "dato.6";
          aValor = #529#13;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI aCampo = "dato.7";
          aValor = #529#14;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI aCampo = "dato.8";
          aValor = #529#15;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI aCampo = "dato.9";
          aValor = #529#16;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI aCampo = "dato.10";
          aValor = #529#17;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI aCampo = "dato.11";
          aValor = #529#18;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI aCampo = "dato.12";
          aValor = #529#19;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI aCampo = "dato.13";
          eaAlfa = #5#24; |HAZ QuitaRaros;
          aValor = eaAlfa;
          |HAZ GrabaTemporal;
     |FINSI;

|| dato.14 al 24 datos representante
     |SI aCampo = "dato.14";  || representante
          aValor = #529#21;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "dato.15";
          aValor = #529#22;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "dato.16";
          aValor = #529#23;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "dato.17";
          aValor = #529#24;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "dato.18";
          aValor = #529#25;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "dato.19";
          aValor = #529#26;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "dato.20";
          aValor = #529#27;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "dato.21";
          aValor = #529#28;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "dato.22";
          aValor = #529#29;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "dato.23";
          aValor = #529#30;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI aCampo = "dato.24";
          aValor = #529#31;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI #5#6 = 1;
         |SI aCampo = "dato.26";
             aValor = #529#36;
            |HAZ GrabaTemporal;
         |FINSI;
         |SI aCampo = "dato.27";
             aValor = #529#37;
             |HAZ GrabaTemporal;
         |FINSI;
         |SI aCampo = "dato.28";
             aValor = #529#38;
             |HAZ GrabaTemporal;
         |FINSI;
         |SI aCampo = "dato.29";
             aValor = #529#39;
             |HAZ GrabaTemporal;
         |FINSI;
         |SI aCampo = "dato.30";
             aValor = #529#40;
             |HAZ GrabaTemporal;
         |FINSI;
    |FINSI;

    |SI #5#6 = 2;
        |SI aCampo = "dato.31";
            aValor = #5#13;
            |HAZ GrabaTemporal;
        |FINSI;
        |SI aCampo = "dato.32";
            aValor = #5#14;
            |HAZ GrabaTemporal;
        |FINSI;
        |SI aCampo = "dato.33";
            aValor = #5#15;
            |HAZ GrabaTemporal;
        |FINSI;
        |SI aCampo = "dato.34";
            aValor = #5#16;
            |HAZ GrabaTemporal;
        |FINSI;
    |FINSI;

    |SI #5#6 = 3;
        |SI aCampo = "dato.35";
            aValor = #5#17;
            |HAZ GrabaTemporal;
        |FINSI;
        |SI aCampo = "dato.36";
            aValor = #5#18;
            |HAZ GrabaTemporal;
        |FINSI;
        |SI aCampo = "dato.37";
            aValor = #5#19;
            |HAZ GrabaTemporal;
        |FINSI;
        |SI aCampo = "dato.38";
            aValor = #5#20;
            |HAZ GrabaTemporal;
        |FINSI;
        |SI aCampo = "dato.39";
            aValor = #5#21;
            |HAZ GrabaTemporal;
        |FINSI;
    |FINSI;

    |SI aCampo = "dato.a.25";
        |SI #5#7 = "X"; aValor = "Sí"; |FINSI;
        |SI #5#7 ! "X"; aValor = ""; |FINSI;
        |HAZ GrabaTemporal;
    |FINSI;

    |SI aCampo = "dato.40";
        aValor = #5#22;
        |HAZ GrabaTemporal;
    |FINSI;

    |SI aCampo = "dato.41";
        aValor = eaFechaB;
        |HAZ GrabaTemporal;
    |FINSI;

|FPRC;

|PROCESO GrabaTemporal;
     #pdfimtmp#0 = aCampo;
     #pdfimtmp#1 = aValor;
     |GRABA 020#pdfimtmp.n;
|FPRC;

|DEFBUCLE GrabaTemporal;
     #pdfdocli#1;
     ;
     aArchivo,   1;
     aArchivo, 999;
     ;
     NULL, CargaCampos;
|FIN;

|PROCESO CargaTemporal;
     aArchivo = "mod_05_multidioma.pdf";
     #pdfdocca#0 = aArchivo;
     |LEE 000#pdfdocca.=;
     |SI FSalida ! 0;
          |CIERRA #pdfdocca;
          eaPrograma  = "pdfdocca";
          eaExtension = "mod";
          |SUB_EJECUTA_NP ":basica/dspatron";
          eaPrograma  = "pdfdocli";
          eaExtension = "mod";
          |SUB_EJECUTA_NP ":basica/dspatron";
          |ABRE #pdfdocca;
     |FINSI;

     #pdfdocca#0 = aArchivo;
     |LEE 000#pdfdocca.=;
     |SI FSalida ! 0;
          aAlfa1 = "    Archivo " + aArchivo + " no encontrado en el Mantenimiento ";
          aAlfa1 = aAlfa1 + "de ficheros PDF.";
          |MENAV aAlfa1;
          |ACABA;
          swCarga = 0;
     |SINO;
          aID = #pdfdocca#2;
     |FINSI;
     |BUCLE GrabaTemporal;
|FPRC;

|PROCESO ImpresionPDF;
     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("c" + aAlfa1) % 108;
     |NOME_DAT #100 aAlfa1;
     |DELINDEX #pdfimtmp;
     |ABRE #pdfimtmp;
     |ABRE #pdfdocca;
     |ABRE #pdfdocli;

     |HAZ CargaTemporal;

     |CIERRA #pdfimtmp;
     |CIERRA #pdfdocca;
     |CIERRA #pdfdocli;

     enQuePare = 1;
     |SUB_EJECUTA "pdfimpre";
     enQuePare = 0;
|FPRC;

|PROCESO Carga05_2010;

     |DDEFECTO #529;
     #529#1  = "005";
     #529#7  = "V";

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #529#8   = eaVarDni;

         eaAlfa = #715#1;  |HAZ QuitaRaros;  #529#9  = eaAlfa;
         eaAlfa = #715#29;  |HAZ QuitaRaros;  #529#10  = eaAlfa;
         eaAlfa = #715#30;  |HAZ QuitaRaros;  #529#11  = eaAlfa;
         eaAlfa = #715#31;  |HAZ QuitaRaros;  #529#12  = eaAlfa;
         eaAlfa = #715#32;  |HAZ QuitaRaros;  #529#13  = eaAlfa;
         eaAlfa = #715#33;  |HAZ QuitaRaros;  #529#14  = eaAlfa;
         eaAlfa = #715#34;  |HAZ QuitaRaros;  #529#15  = eaAlfa;
         eaAlfa = #715#54;  |HAZ QuitaRarosTfno;  #529#16 = eaAlfa;
         #529#17   = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
         eaAlfa  = #715#37;  |HAZ QuitaRaros;       #529#18 = eaAlfa;
         eaAlfa  = #715#38;  |HAZ QuitaRaros;       #529#19 = eaAlfa;

         eaDeleg = #715#17;
         eaAdmin = #715#18;
         eaCodAd = (("00" + #715#15) % -102) + (("000" + #715#16) % -103);
     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#1; |FINSI;

         eaVarDni = #715#13;  |HAZ CalculameDNI;   #529#8  = eaVarDni;
         eaAlfa   = #715#1;   |HAZ QuitaRaros;     #529#9  = eaAlfa;
         eaAlfa   = #715#3;   |HAZ QuitaRaros;     #529#10 = eaAlfa;
         eaAlfa   = #715#4;   |HAZ QuitaRaros;     #529#11 = eaAlfa;
         eaAlfa   = #715#5;   |HAZ QuitaRaros;     #529#12 = eaAlfa;
         eaAlfa   = #715#6;   |HAZ QuitaRaros;     #529#13 = eaAlfa;
         eaAlfa   = #715#7;   |HAZ QuitaRaros;     #529#14 = eaAlfa;
         eaAlfa   = #715#8;   |HAZ QuitaRaros;     #529#15 = eaAlfa;
         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno; #529#16 = eaAlfa;
         #529#17   = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
         eaAlfa    = #715#11;  |HAZ QuitaRaros;       #529#18 = eaAlfa;
         eaAlfa    = #715#12;  |HAZ QuitaRaros;       #529#19 = eaAlfa;

         eaDeleg = #715#91;
         eaAdmin = #715#92;
         eaCodAd = (("00" + #715#63) % -102) + (("000" + #715#64) % -103);
     |FINSI;

     eaVarDni = rNif;       |HAZ CalculameDNI;   #529#20 = eaVarDni;
     eaAlfa   = rNombre;    |HAZ QuitaRaros;     #529#21 = eaAlfa;
     eaAlfa   = rSg;        |HAZ QuitaRaros;     #529#22 = eaAlfa;
     eaAlfa   = rDireccion; |HAZ QuitaRaros;     #529#23 = eaAlfa;
     eaAlfa   = rNumero;    |HAZ QuitaRaros;     #529#24 = eaAlfa;
     eaAlfa   = rEscalera;  |HAZ QuitaRaros;     #529#25 = eaAlfa;
     eaAlfa   = rPiso;      |HAZ QuitaRaros;     #529#26 = eaAlfa;
     eaAlfa   = rPuerta;    |HAZ QuitaRaros;     #529#27 = eaAlfa;
     eaAlfa   = rTelefono;  |HAZ QuitaRarosTfno; #529#28 = eaAlfa;
     #529#29  = rCodPostal;
     eaAlfa   = rPoblacion; |HAZ QuitaRaros;     #529#30 = eaAlfa;
     eaAlfa   = rProvincia; |HAZ QuitaRaros;     #529#31 = eaAlfa;

     #529#33  = " "; |SI #5#7 = "X"; #529#33 = "2"; |FINSI;

     eaAlfa = #5#8;  |HAZ QuitaRaros; #529#36 = eaAlfa;
     eaAlfa = #5#9;  |HAZ QuitaRaros; #529#37 = eaAlfa;
     eaAlfa = #5#10; |HAZ QuitaRaros; #529#38 = eaAlfa;
     eaAlfa = #5#11; |HAZ QuitaRaros; #529#39 = eaAlfa;
     eaAlfa = #5#12; |HAZ QuitaRaros; #529#40 = eaAlfa;

     #529#70 = #5#22;

     eaAlfa  = #0#36;     |HAZ FechaBonito;

     #529#76 = &13 + &10;

     nTCampo = 76;
     |SI nTecla = 3;
         #529#20 = "";
         #529#21 = "";
         #529#22 = "";
         #529#23 = "";
         #529#24 = "";
         #529#25 = "";
         #529#26 = "";
         #529#27 = "";
         #529#28 = "";
         #529#29 = "";
         #529#30 = "";
         #529#31 = "";
         #529#76 = "";
         nTCampo = 75;
     |FINSI;

     |SI nTecla = 3;
         aAlfa = "";
         |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #529nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         |XCIERRA nHandle2;

||         |SI nTecla = 1;
||             eaFOrigen  = eaPathEmision + "123" + (("00000" + #999#0) % -105) + ".TXT";
||             eaFDestino = eaPathLanza + "123" + (("00000" + #999#0) % -105) + ".TXT";
||             |HAZ CopiaFichero;
||             |FBORRA eaFOrigen;
||             |HAZ CargaImprime05;
||         |FINSI;

           eaFOrigen  = eaPathEmision + "05" + (("00000" + #999#0) % -105) + (("00000" + #5#1) % -105) + ".TXT";
           eaFDestino = eaPathInternet + "05" + (("00000" + #999#0) % -105) + (("00000" + #5#1) % -105) + ".TXT";
           |HAZ CopiaFichero;

           |FBORRA eaFOrigen;

     |FINSI;

     eaSoli = #5#22; |QBF eaSoli;

     |SI nTecla = 4;
         |PRINT;
         |PIEINF;
     |FINSI;

     |SI nTecla = 2;
         |HAZ ImpresionPDF;
     |FINSI;

     |SI nTecla ! 4;
         |HAZ GrabaImpres05;
     |FINSI;
|FPRC;

|PROCESO dsmod005_Emitir;

     |SI #0#37 = "N"; |Y #5#4 = "X";  |LIBERA #5; |ACABA;  |FINSI;

     |SI nTecla = 3; |Y #5#22 ! "ER3 ";
         |ACABA;
     |FINSI;

||     |SI nTecla = 1;
||         aAbre = eaPathEmision + "123" + (("00000" + #999#0) % -105) + ".TXT";
||         |XABRE "BW", aAbre, nHandle2;
||     |FINSI;

     |SI nTecla = 3;
         aAbre = eaPathEmision + "05" + (("00000" + #999#0) % -105) + (("00000" + #5#1) % -105) + ".TXT";
         |XABRE "BW", aAbre, nHandle2;
     |FINSI;

     |SI nTecla = 1;
         |HAZ Registro05_2010;
     |SINO;
         |HAZ Carga05_2010;
     |FINSI;

     |LIBERA #5;
|FPRC;

|DEFBUCLE dsmod005_Emitir;
     #5#1;
     2;
     #999#0, #0#0, #0#2;
     #999#0, #0#1, #0#2;
     be;
     NULL, dsmod005_Emitir;
|FIN;

|PROCESO Datos_Rep;
     |ABRE #115;
     |DDEFECTO #115;
     #115#0 = #999#0;
     |LEE 041#115=;
     |SI FSalida = 0;
          rNif       = #115#4;          || NIF
          rNombre    = #115#5;          || Nombre
          rSg        = #115#8;          || Sg
          rDireccion = #115#9;          || Direccion
          rNumero    = #115#10;         || Numero
          rEscalera  = #115#11;         || Escalera
          rPiso      = #115#12;         || Piso
          rPuerta    = #115#13;         || Puerta
          aAlfa1     = #115#15;          || Provincia
          aAlfa1     = "00" + aAlfa1;
          aAlfa1     = aAlfa1 % -102;
          aAlfa2     = #115#16;         || Localidad
          aAlfa2     = "000" + aAlfa2;
          aAlfa2     = aAlfa2 % -103;
          rCodPostal = aAlfa1 + aAlfa2;
          rPoblacion = #115#17;
          rProvincia = #115#18;
          rTelefono  = #115#14;         || Telefono
     |FINSI;
     |CIERRA #115;
|FPRC;

|PROCESO EnBlancoVar;
          rNif       = "";
          rNombre    = "";
          rSg        = "";
          rDireccion = "";
          rNumero    = "";
          rEscalera  = "";
          rPiso      = "";
          rPuerta    = "";
          rCodPostal = "";
          rPoblacion = "";
          rProvincia = "";
          rTelefono  = "";
          eaDeleg    = "";
          eaAdmin    = "";
          eaCodAd    = "";
          eaSoli     = "";
|FPRC;

|PROCESO QueHacemos05;
     |HAZ EnBlancoVar;

 || ... Datos de la Empresa
     enCodCli = #999#0;
     |HAZ LeePersona;
     |HAZ Datos_Rep;

 || ... Datos de cada uno de los transportes
     |BUCLE dsmod005_Emitir;
|FPRC;

|DEFBUCLE dsmow014C05;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos05;
|FIN;

|PROCESO Boton051;
     |PTEC 824;
|FPRC;

|PROCESO Boton052;
     |PTEC 825;
|FPRC;

|PROCESO Boton053;
     |PTEC 826;
|FPRC;

|PROCESO Boton05Esc;
     |PTEC 806;
|FPRC;

|PROCESO Botones05;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision en PDF                       ", 0513, 0754, Boton051;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Presentacion Telematica  (Solicitud ER3) ", 0913, 1154, Boton052;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Informe de Comprobacion              ", 1313, 1554, Boton053;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton05Esc;
     nBoton5 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF6 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTecla = 2;   |SAL;  |FINSI;
         |SI aTecla = aF3;  nTecla = 3;   |SAL;  |FINSI;
         |SI aTecla = aF4;  nTecla = 4;   |SAL;  |FINSI;
         |SI aTecla = aF6;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton5;

     |PULSATECLA;
|FPRC;

|PROCESO Emision;
     enSwTrata      = 0;
     enCambiaMoneda = 1;

     |SI aParam ! "MC";
         |HAZ Botones05;
     |SINO;
         nTecla = 4;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1;  |ACABA;  |FINSI;
     |SI nTecla = 4;  enInfComp = 1;  |FINSI;

||     |SI nTecla = 1;                     ||si encntramos el modulo de impresion
||         |HAZ CompruebaEjecutable;
||         |SI enError = 1;  |ACABA;  |FINSI;
||         |PARA;  |SI;  |HACIENDO;
||              #601#0 = #107#5;
||              #601#1 = #107#7;
||              |C_M #601#0, 1, "S";
||              |C_M #601#1, 1, "S";
||              |SI #107#6 = "N";  |C_M #601#0, 1, "N";  |FINSI;
||              |SI #107#8 = "N";  |C_M #601#1, 1, "N";  |FINSI;
||              nPedirPanta = 0;
||              |SI #107#6 = "N";  |Y #107#8 = "N";  |Y #107#7 = "N";
||                   nPedirPanta = 1;
||              |FINSI;
||              FSalida = 0;
||              |SI nPedirPanta = 0;
||                  |PINPA #0#601;
||                  |PINDA #0#601;
||                  |ENDATOS #1#601;
||              |FINSI;
||              |SI FSalida = 0;
||                  |HAZ AbreImprime123;
||                  |SAL;
||              |FINSI;
||          |SIGUE;
||      |FINSI;

     |SI nTecla =  4;
         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |INFOR inform1;
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     nSwLee = 0;
     |BUCLE dsmow014C05;

||     |SI nTecla = 1; |HAZ EmiteEsto123; |FINSI;

     |SI nTecla = 4;
         |FININF;
         |FINIMP;
     |FINSI;

     |SI nTecla = 3;
         aAlfa =  "      Los ficheros generados estan en: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|| ------------------------------------------------------------------
|PROCESO GrabaTempo;
     |SI #0#37 = "N";
         |SI #5#4 = "S";  |ACABA;  |FINSI;
     |FINSI;

     enCodCli = #5#0;
     |HAZ LeePersona;

     #999#0  = #5#0;
     #999#1  = #5#2;
     #999#2  = 99;
     |LEE 101#999=;
     |SI FSalida ! 0;
         |DDEFECTO #999;
         #999#0  = #5#0;
         #999#1  = #5#2;
         #999#2  = 99;
         |GRABA 020#999b;
     |FINSI;

     #999#3  = #715#1;
     #999#4  = 01;
     #999#5  = "05";
     #999#6  = "S";
     #999#7  = 00;
     |GRABA 020#999a;
     |LIBERA #999;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE dsmod005;
     #5#1;
     2;
     nDEmpresa, #0#0, #0#2;
     nHEmpresa, #0#1, #0#2;
     ;
     NULL, GrabaTempo;
|FIN;

|RUTINA ClaveBaja999;
     #999#0 = 1;
     #999#1 = 0000;
     #999#2 = 00;
|FRUT;

|RUTINA ClaveAlta999;
     #999#0 = 99999;
     #999#1 = 9999;
     #999#2 = 99;
|FRUT;

|PROCESO MiraCuantos;
     enSwHay = enSwHay + 1;
|FPRC;

|DEFBUCLE dsmow014M;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, MiraCuantos;
|FIN;

|CALCULO Tipo3;  |TIPO 3;

    |SI #0#4 = "I";

        |IMPRE 0;
        |SI FSalida ! 0;  |ACABA;  |FINSI;

        |INFOR informe;
        |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

        nDActividad = #0#19;
        nHActividad = #0#20;
        nSw = 0;
        |SI #0#5 ! 0;
            nDEmpresa = #0#5;
            nHEmpresa = #0#6;
            |HAZ imprimir;
        |SINO;
            |PARA nCampo = 7; |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
                  |SI #0nCampo ! 0;
                      nDEmpresa = #0nCampo;
                      nHEmpresa = #0nCampo;
                      |HAZ imprimir;
                  |FINSI;
            |SIGUE;
       |FINSI;
       |SI nSw = 1;  |PIEINF;  |FINSI;
       |FININF;
       |FINIMP;

   |SINO;

        aFichero = ("imp" + Usuario) % 108;
        |NOME_DAT #999 aFichero;
        |DELINDEX #999;

        |ABRE #999;
        |SI #0#5 ! 0;
            nDEmpresa = #0#5;
            nHEmpresa = #0#6;
            |BUCLE dsmod005;
        |SINO;
            |PARA nCampo = 7; |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
                  |SI #0nCampo ! 0;
                      nDEmpresa = #0nCampo;
                      nHEmpresa = #0nCampo;
                      |BUCLE dsmod005;
                  |FINSI;
            |SIGUE;
       |FINSI;
       |CIERRA #999;

       eaParametro = "05";
       |SI nSwGraba = 1;
           #990#0 = eaParametro;
           #990#4 = #0#38;
           #990#6 = #0#2;
           |SI nLineal = 0;
               |PINPA #0#999;
               |HAZ PonBoton;
               |ENTLINEAL #1#999, -1, 4, 21, 0, ClaveBaja999, ClaveAlta999;
               |HAZ QuitaBoton;
           |FINSI;
           enSwHay = 0;
           |BUCLE dsmow014M;
       |SINO;
           |MENAV "     Seleccion Vacia.";
           |DELINDEX #999;
           |ACABA;
       |FINSI;

       aAlfa  = "05";
       eaPathLanza = eaUnidadBasico + "\MODELOS";        |RMKDIR eaPathLanza;
       eaPathLanza = eaPathLanza + "\" + aAlfa;          |RMKDIR eaPathLanza;
       eaPathLanza = eaPathLanza + "\" + #0#2;           |RMKDIR eaPathLanza;
       eaPathLanza = eaPathLanza + "\";

       |DBASE eaPathEmision;
       eaPathEmision = eaPathEmision + "emisiones";                      |MKDIR eaPathEmision;
       eaPathEmision = eaPathEmision + "/" + aAlfa;                      |MKDIR eaPathEmision;
       eaPathEmision = eaPathEmision + "/" + #0#2;                       |MKDIR eaPathEmision;
       || eaPathInternet = eaPathInternet + "/" + (("00" + #0#38) % -102);  |RMKDIR eaPathInternet;
       eaPathEmision = eaPathEmision + "/";

       |HAZ LeeUnidad;
       eaPathInternet = eaUnidad + "/AEAT";                              |RMKDIR eaPathInternet;
       eaPathInternet = eaPathInternet + "/INTERNET";                    |RMKDIR eaPathInternet;
       eaPathInternet = eaPathInternet + "/" + aAlfa;                    |RMKDIR eaPathInternet;
       eaPathInternet = eaPathInternet + "/" + #0#2;                     |RMKDIR eaPathInternet;
       || eaPathInternet = eaPathInternet + "/" + (("00" + #0#38) % -102);  |RMKDIR eaPathInternet;
       eaPathInternet = eaPathInternet + "/";

       |SI enSwHay = 0;
           |MENAV "      Seleccion Vacia";
       |SINO;
           |HAZ Emision;
       |FINSI;

       |DELINDEX #999;

  |FINSI;
|FCAL;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROCESO Boton2;
     |PTEC 825;
|FPRC;

|PROCESO Boton3;
     |PTEC 826;
|FPRC;

|PROGRAMA;
     |HAZ LeeEURODBMOD;
     |HAZ LeeUnidad;

     aParam = PARAMETRO;  |QBF aParam;
     |SI aParam = "";  aParam = "M"; |FINSI;

     |SI enEmpresa ! 0;
         nLineal = 1;
         |DDEFECTO #0;
         #0#4 = "M"; |SI aParam = "I";  #0#4 = "I";  |FINSI;
         |SI enHMedio = 0;
             enHMedio = enDMedio;
         |FINSI;
         #0#0 = enDMedio;
         #0#1 = enHMedio;
         #0#2  = enEjer;
         #0#3  = enEjer;
         #0#5 = enEmpresa;
         #0#6 = enEmpresa;
         #0#21 = "S";
         |C_M #0#4, 1, "N"; |C_V #0#4, 1, "N";
         |SI aParam = "I";
             |PARA nPara1 = 5; |SI nPara1 [ 34; |HACIENDO nPara1 = nPara1 + 1;
                   |C_M #0nPara1, 1, "N";
             |SIGUE;
             |PINPA #0#0;
             |PINDA #0#0;
             |ENDATOS #1#0;
         |SINO;
             |PUSHV 1225 1575;
             |BLANCO 1025 1244;
             |CUADRO 0925 1244;
             |ATRI R;
             |PINTA 1026, "FECHA PRESENTACION";
             |ATRI r;

             fFecha = ~;
             fFecha = 1130 ? 1;

             #0#36 = fFecha;

             |POPV;

             |HAZ Tipo3;
         |FINSI;
     |SINO;
         |CLS;
         |MANTE #0;
     |FINSI;

     |PULSATECLA;
|FPRO;
