|FICHEROS;
     dsmom107 #107;
     dsmom030 #30;
     dsmom031 #31;

     :/basica/def/agicen14 #114;
     :/basica/def/agifigen #118;
     :/basica/def/agim0019 #119;
     :/basica/def/agicen30 #730;

     dsmow030;
     dsmow032;
|FIN;

|VARIABLES;
     aAlfa1      = "";
     aDef        = "";
     aPathModelo = "";
     aAlfa       = "";
     aPin1       = "";
     aCampo16    = "";
     aCampo17    = "";

     nDep        = 0;
     nCalcul     = 0;
     nCanti10    = 0;
     nCanti12    = 0;
     nCanti13    = 0;
     nCanti15    = 0;
     nCanti16    = 0;
     nCanti18    = 0;
     nCanti19    = 0;
     nCanti21    = 0;
     nDigo       = 0;
     nNume1      = 0;
     nSwEx82     = 0;
     nUltimo     = 0;
     nSw         = 0;
     nActividad  = 0;
     nPeriodo    = 0;
     nModelo     = 0;
     nComplem    = 0;
     nSwOp       = 0;
     nHay12      = 0;
     nAny        = 0;
     nCampo15    = 0;
     nEstado     = 0;
     nEjer       = 0;
     nSPin1      = 0;
     nPin1       = 0;

     efPn10      = @;
     efPn11      = @;
     fFecha      = @;
     fUltFecha   = @;

     &enError        = 0;
     &fFechaDisol    = @;
     &fFechaChequeo  = @;
     &fFechaChequeoF = @;
     &enRegistro     = 0;
     &enTipo202      = 0;
     &enEjerR        = 0;
     &enCodRen       = 0;
     &eaCodRen       = "";
     &enActPro       = 0;
     &enProAct       = 0;
     &enProCom       = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;
|INCLUYE i_varlib;

|| ... ... ... ... ... ... ... Control de Conceptos y Libros
|PROCESO LeeCtrlLibro;
     |ABRE #107;
     |DDEFECTO #107;
     |LEE 040#107p;
     |CIERRA #107;

     enSwSelCp   = 0;
     enSwAviso   = 0;
     enSwAuAnual = 0;
     enSwSelFc   = 0;
     |SI #107#4  = "S"; enSwSelCp   = 1; |FINSI;
     |SI #107#17 = "S"; enSwAviso   = 1; |FINSI;
     |SI #107#19 = "S"; enSwAuAnual = 1; |FINSI;
     |SI #107#32 = "S"; enSwSelFc   = 1; |FINSI;
|FPRC;

|PROCESO CtrlConcepto;
     enSwConcep = 0;
     |SI enSwSelCp = 0; |ACABA; |FINSI;

     |ABRE #31;
     #31#0 = enConcepto;
     #31#1 = enModelo;
     |LEE 041#31.=;
     |SI FSalida ! 0;
         enSwConcep = 1;
     |FINSI;
     |CIERRA #31;
|FPRC;

|PROCESO CtrlConcepReg;
     enSwConcep = 0;

     |ABRE #30;
     |DDEFECTO #30;
     #30#0 = enConcepto;
     |LEE 041#30.=;
     |SI FSalida ! 0;
         enSwConcep = 1;
     |FINSI;
     |CIERRA #30;

     |SI enSwReg = 1;  || Compensacion de Agricultura
         |SI #30#28 ! 7; enSwConcep = 1; |FINSI;
         |ACABA;
     |FINSI;
     |SI enSwReg = 2;  || Bienes Usados
         |SI #30#26 ! 2; enSwConcep = 1; |FINSI;
         |ACABA;
     |FINSI;
     |SI enSwReg = 3;  || Viajes
         |SI #30#26 ! 3; enSwConcep = 1; |FINSI;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO LeoFicSocie;
   |SI efHFecha ] #agim0019#3; |Y fUltFecha [ #agim0019#3;
       nRegis   = #agim0019#1;
       swExiste = 1;
       fUltFecha = #agim0019#3;
   |FINSI;
|FPRC;

|DEFBUCLE LeoFicSocie;
   #agim0019#1;
   ;
   #dsmow030#0, 01;
   #dsmow030#0, 99;
   e;
   NULL, LeoFicSocie;
|FIN;

|PROCESO LeoFicSociedad;

 || Lee Ficha Sociedades

    swExiste = 0; nPvp     = 0;
    nRegis   = 0; nTAccion = 0;
    |SI aRegis = "S";
        |BUCLE LeoFicSocie;
        |SI nRegis ! 0;
            |ABRE #agim0019;
            |DDEFECTO #agim0019;
            #agim0019#0 = #dsmow030#0; || Empresa
            #agim0019#1 = nRegis;
            |LEE 041#agim0019.=;
            |CIERRA #agim0019;
        |FINSI;
    |SINO;
        |ABRE #agim0019;
        #agim0019#0 = #dsmow030#0; || Empresa
        #agim0019#1 = 99;
        |LEE 041#agim0019.];
        |SI FSalida = 0;
            |LEE 041#agim0019.a;
        |SINO;
            |LEE 041#agim0019.u;
        |FINSI;
        |SI FSalida = 0; |Y #agim0019#0 = #dsmow030#0;
            swExiste = 1;
        |FINSI;
        |CIERRA #agim0019;
    |FINSI;
|FPRC;

|PROCESO ChequeaSociedad;
     enError   = 0;
     |ABRE #119;
     #119#0 = enEmpresa;
     #119#1 = 99;
     |LEE 041#119];
     |SI FSalida = 0;
         |LEE 041#119a;
     |SINO;
         |LEE 041#119u;
     |FINSI;
     |SI FSalida = 0; |Y #119#0 = enEmpresa;
         enTipo202 = #119#90;
         enError   = 0;
         |SI #119#11 > "01.01.0000";  |Y #119#11 > fFechaChequeoF;
             enError = 2;
         |FINSI;
         |SI #119#12 > "01.01.0000";  |Y #119#12 < fFechaChequeo;
             enError = 2;
         |FINSI;
         |SI #119#54 = "I"; |Y enError = 0;
             |SI #119#55 > "01.01.0000";  |Y #119#55 < fFechaChequeo;
                 enError = 3;
             |FINSI;
         |FINSI;
     |SINO;
         enError = 1;
     |FINSI;
     |CIERRA #agim0019;
|FPRC;

|PROCESO CodigoRen;
   |ABRE #agicen30;
   #agicen30#0 = #agicen14#0;
   #agicen30#1 = #agicen14#1;
   #agicen30#2 = enEjerR;
   |LEE 041#agicen30.=;
   |SI FSalida = 0;
       enCodRen = #agicen30#14;
       eaCodRen = #agicen30#15;
   |FINSI;
   |CIERRA #agicen30;
|FPRC;

|PROCESO PrimActividad;
    #dsmow030#5 = #agicen14#9;
    #dsmow030#6 = #agicen14#10;
    #dsmow030#7 = #agicen14#7;
    #dsmow030#8 = #agicen14#8;
    efPn10 = #agicen14#5;
    efPn11 = #agicen14#6;

    |SI #agicen14#6 [ "01.01.0000"; |O #agicen14#6 ] fFecha;
        |ERROR10;
    |FINSI;
|FPRC;

|DEFBUCLE PrimActividad;
    #agicen14#1;
    ;
    #dsmow030#0, 01;
    #dsmow030#0, 99;
    ;
    NULL, PrimActividad;
|FIN;

|PROCESO DatosEmpr_w30;
  |DDEFECTO #dsmow030;

  #dsmow030#0  = enEmpresa;
  #dsmow030#12 = enEjer;                                   || Ejercicio
  nPin1   = 0;
  aPin1   = "";
  efPn10  = "01.01.0000";
  efPn11  = "01.01.0000";
  enEjerBajaM = 0;
  aAlfa1 = enEjer;
  aAlfa1 = "01.01."+ aAlfa1;
  fFecha = aAlfa1;

  || Lee Primera Actividad
    |BUCLE PrimActividad;

  || Lee Actividad en concreto.
    |ABRE #agicen14;
    swNoExis = 0;
    |SI enActividad ! 0;
        #agicen14#0 = #dsmow030#0; || Empresa
        #agicen14#1 = enActividad;
        |LEE 041#agicen14.=;
        |SI FSalida = 0;
            #dsmow030#69 = #agicen14#1;   ||Act.
            #dsmow030#70 = #agicen14#2;   ||Tipo Epig.
            #dsmow030#71 = #agicen14#3;   ||Epigrafe
            #dsmow030#72 = #agicen14#4;   ||Descripcion Actividad
            #dsmow030#73 = #agicen14#5;   ||Fecha Inicio
            #dsmow030#74 = #agicen14#6;   ||Fecha Fin
            #dsmow030#75 = #agicen14#11;  ||Sector actividad
            #dsmow030#76 = #agicen14#12;  ||Sector actividad
            #dsmow030#77 = #agicen14#16;  ||Tipo Actividad
            #dsmow030#78 = #agicen14#17;  ||Descripcion Tipo Actividad
            |SI #dsmow030#12 ] 2008;
                #dsmow030#80 = #agicen14#20;  ||CNAE
            |SINO;
                #dsmow030#80 = #agicen14#21;  ||CNAE
            |FINSI;

            enCodRen = #agicen14#18;
            |SI enEjerR ! 0; |HAZ CodigoRen;  |FINSI;
            #dsmow030#83 = enCodRen;          ||Codigo de Renta

            |SI #agicen14#6 > "01.01.0000";
                |SI eaInac = "N";
                    |CIERRA #agicen14;
                    swNoExis = 1;
                    |ACABA;
                |FINSI;
            |FINSI;
       |SINO;
            |CIERRA #agicen14;
            swNoExis = 1;
            |ACABA;
       |FINSI;
    |FINSI;

    |CIERRA #agicen14;

    |SI eaCodSubdep ! "   "; |Y enActividad ! 0;
        #dsmow030#85 = eaCodSubdep;
        #dsmow030#86 = eaNomSubdep;
    |FINSI;

 || Lee Ficha Sociedades

    fUltFecha = "01.01.0000";
    swExiste  = 0; nPvp     = 0;
    nRegis    = 0; nTAccion = 0;
    |SI aRegis = "S";
        |BUCLE LeoFicSocie;
        |SI nRegis ! 0;
            |ABRE #agim0019;
            |DDEFECTO #agim0019;
            #agim0019#0 = #dsmow030#0; || Empresa
            #agim0019#1 = nRegis;
            |LEE 041#agim0019.=;
            |CIERRA #agim0019;
        |FINSI;
    |SINO;
        |ABRE #agim0019;
        #agim0019#0 = #dsmow030#0; || Empresa
        #agim0019#1 = 99;
        |LEE 041#agim0019.];
        |SI FSalida = 0;
            |LEE 041#agim0019.a;
        |SINO;
            |LEE 041#agim0019.u;
        |FINSI;
        |SI FSalida = 0; |Y #agim0019#0 = #dsmow030#0;
            swExiste = 1;
        |FINSI;
        |CIERRA #agim0019;
    |FINSI;

    |SI swExiste = 1;
        nRegis = #agim0019#1;      || Registre
        efPn10 = #agim0019#7;      || Fecha Activa
        efPn11 = #agim0019#55;     || Fecha Inactiva
        nPin1  = #agim0019#4;
        aPin1  = #agim0019#5;
        nSuma  = 0;
        |SI #agim0019#15 ! 0; nTAccion = #agim0019#15; nPvp = #agim0019#16; nSuma = 1; |FINSI;
        |SI #agim0019#19 ! 0; nTAccion = #agim0019#19; nPvp = #agim0019#20; nSuma = 2; |FINSI;
        |SI #agim0019#23 ! 0; nTAccion = #agim0019#23; nPvp = #agim0019#24; nSuma = 3; |FINSI;
        |SI #agim0019#12 > "01.01.1000";
            aAlfa1 = #agim0019#12; aAlfa1 = aAlfa1 % -104; enEjerBajaM = aAlfa1;
        |FINSI;
    |FINSI;

|| ... Ficha Cliente agifigen

    |SI eDatosW30 = 0;
        |ABRE #agifigen;
        #agifigen#0 = #dsmow030#0; || Empresa
        |LEE 041#agifigen.=;
    |SINO;
        FSalida = 0;
    |FINSI;
    |SI FSalida = 0;
        efPn10  = #agifigen#93;
        efPn11  = #agifigen#94;
        nPin1   = #agifigen#87;
        aPin1   = #agifigen#88;
        enTpEm  = #agifigen#87;
        #dsmow030#1 = #agifigen#13;  || Nif
        #dsmow030#2 = #agifigen#1;   || Nombre
    |FINSI;
    |SI eDatosW30 = 0;
        |CIERRA #agifigen;
    |FINSI;

    |SI efPn10 [ "01.01.1000"; efPn10 = ""; |FINSI;
    |SI efPn11 [ "01.01.1000"; efPn11 = ""; |FINSI;
    #dsmow030#3  = nPin1;
    #dsmow030#4  = aPin1;
    #dsmow030#9  = efPn10;
    #dsmow030#10 = efPn11;

    #dsmow030#11 = "ACTIVA";
    |SI efPn11 > "01.01.1900";
        #dsmow030#11 = "INACTIVA";
    |FINSI;
    #dsmow030#12 = enEjer;                                   || Ejercicio
    #dsmow030#13 = efDFecha;
    #dsmow030#14 = efHFecha;

    #dsmow030#64 = eaTituloL; ||Titulo del Libro
|FPRC;

|PROCESO PrimActiv_32;
        #dsmow032#5 = #agicen14#9;
        #dsmow032#6 = #agicen14#10;
        #dsmow032#7 = #agicen14#7;
        #dsmow032#8 = #agicen14#8;
        efPn10 = #agicen14#5;
        efPn11 = #agicen14#6;

        aCoBien = #agicen14#13;  ||Comunidad de Bienes
        enCodRen = #agicen14#18;
        |SI enEjerR ! 0; |HAZ CodigoRen; |FINSI;

        #dsmow032#52 = enCodRen;
        |SI nActividad = 0;
            nActividad = #agicen14#1;
        |FINSI;
        #dsmow032#15 = #agicen14#1;   ||Act.
        #dsmow032#16 = #agicen14#2;   ||Tipo Epig.
        #dsmow032#17 = #agicen14#3;   ||Epigrafe
        #dsmow032#18 = #agicen14#4;   ||Descripcion Actividad
        #dsmow032#19 = #agicen14#5;   ||Fecha Inicio
        #dsmow032#20 = #agicen14#6;   ||Fecha Fin
        #dsmow032#21 = #agicen14#11;  ||Sector actividad
        #dsmow032#22 = #agicen14#12;  ||Sector actividad
        #dsmow032#23 = #agicen14#16;  ||Tipo Actividad
        #dsmow032#24 = #agicen14#17;  ||Descripcion Tipo Actividad
        #dsmow032#51 = #agicen14#20;  ||CNAE
        #dsmow032#52 = #agicen14#18;  ||Codigo Renta

    swNoExis = 0;
    |SI #agicen14#6 [ "01.01.0000"; |O #agicen14#6 ] fFecha;
        nActividad = #agicen14#1;
        |ERROR10;
    |FINSI;
|FPRC;

|DEFBUCLE PrimActiv_32;
    #agicen14#1;
    ;
    #dsmow032#0, 01;
    #dsmow032#0, 99;
    ;
    NULL, PrimActiv_32;
|FIN;

|PROCESO DatosEmpr_w32;

  |DDEFECTO #dsmow032;

  #dsmow032#0 = enEmpresa;
  nPin1 = 0;
  aPin1 = "";
  efPn10 = "01.01.0000";
  efPn11 = "01.01.0000";
  fFecha = "31.12.2999";
  |SI enEjer ! 0;
      aAlfa1 = enEjer;
      aAlfa1 = "01.01."+ aAlfa1;
      fFecha = aAlfa1;
  |FINSI;
  || Lee Primera Actividad
    swNoExis   = 1;
    nActividad = 0;
    |BUCLE PrimActiv_32;
    |SI swNoExis = 1;
        |ACABA;
    |FINSI;

    enActividad = nActividad;

 || Lee Ficha Sociedades
    swExiste = 0;
    |ABRE #agim0019;
    #agim0019#0 = #dsmow032#0; || Empresa
    #agim0019#1 = 99;
    |LEE 041#agim0019.];
    |SI FSalida = 0;
        |LEE 041#agim0019.a;
    |SINO;
        |LEE 041#agim0019.u;
    |FINSI;
    |SI FSalida = 0; |Y #agim0019#0 = #dsmow032#0;
        swExiste = 1;
    |FINSI;
    |SI swExiste = 1;
        efPn10 = #agim0019#7;      || Fecha Activa
        efPn11 = #agim0019#55;     || Fecha Inactiva
        nPin1 = #agim0019#4;
        aPin1 = #agim0019#5;
    |FINSI;
    |CIERRA #agim0019;

    efPn10  = #agifigen#93;
    efPn11  = #agifigen#94;
    nPin1   = #agifigen#87;
    aPin1   = #agifigen#88;
    #dsmow032#1 = #agifigen#13;  || Nif
    #dsmow032#2 = #agifigen#1;   || Nombre

    |SI efPn10 [ "01.01.1900"; efPn10 = "01.01.0000"; |FINSI;
    |SI efPn11 [ "01.01.1900"; efPn11 = "01.01.0000"; |FINSI;

    #dsmow032#3 = nPin1;
    #dsmow032#4 = aPin1;
    #dsmow032#9 = efPn10;
    #dsmow032#10 = efPn11;

    #dsmow032#11 = "ACTIVA";
    |SI #agifigen#94 > "01.01.1000";
        #dsmow032#11 = "INACTIVA";
    |FINSI;
    #dsmow032#12 = enEjer;                                   || Ejercicio
    #dsmow032#13 = efDFecha;
    #dsmow032#14 = efHFecha;

    #dsmow032#50 = eaTituloL; ||Titulo del Libro
|FPRC;

|PROCESO DatosEmpr_w32Con;

  |DDEFECTO #dsmow032;

  #dsmow032#0 = enEmpresa;
  nPin1 = 0;
  aPin1 = "";
  efPn10 = "01.01.0000";
  efPn11 = "01.01.0000";
  fFecha = "31.12.2999";
  |SI enEjer ! 0;
      aAlfa1 = enEjer;
      aAlfa1 = "01.01."+ aAlfa1;
      fFecha = aAlfa1;
  |FINSI;

  nActividad = 0;
  || Lee Primera Actividad
    swNoExis = 1;
    |BUCLE PrimActiv_32;

    |ABRE #agicen14;
|SI enActividad ! 0;
  || Lee Actividad en concreto.
    swNoExis = 0;
    #agicen14#0 = #dsmow032#0; || Empresa
    #agicen14#1 = enActividad;
    |LEE 041#agicen14.=;
    |SI FSalida = 0;
        enEjerR = enEjer;
        #dsmow032#5 = #agicen14#9;
        #dsmow032#6 = #agicen14#10;
        #dsmow032#7 = #agicen14#7;
        #dsmow032#8 = #agicen14#8;
        #dsmow032#15 = #agicen14#1;   ||Act.
        #dsmow032#16 = #agicen14#2;   ||Tipo Epig.
        #dsmow032#17 = #agicen14#3;   ||Epigrafe
        #dsmow032#18 = #agicen14#4;   ||Descripcion Actividad
        #dsmow032#19 = #agicen14#5;   ||Fecha Inicio
        #dsmow032#20 = #agicen14#6;   ||Fecha Fin
        #dsmow032#21 = #agicen14#11;  ||Sector actividad
        #dsmow032#22 = #agicen14#12;  ||Sector actividad
        #dsmow032#23 = #agicen14#16;  ||Tipo Actividad
        #dsmow032#24 = #agicen14#17;  ||Descripcion Tipo Actividad
        #dsmow032#51 = #agicen14#20;  ||CNAE
        aCoBien = #agicen14#13;  ||Comunidad de Bienes
        enCodRen = #agicen14#18;
        |SI enEjerR ! 0; |HAZ CodigoRen; |FINSI;
        #dsmow032#52 = enCodRen;
        |SI #agicen14#6 > "01.01.0000"; |Y #agicen14#6 < efDFecha;
            |SI eaInac = "N";
                |CIERRA #agicen14;
                swNoExis = 1;
                |ACABA;
            |FINSI;
        |FINSI;
    |SINO;
        |CIERRA #agicen14;
        swNoExis = 1;
        |ACABA;
    |FINSI;
|FINSI;

   |CIERRA #agicen14;

 || Lee Ficha Sociedades
    swExiste = 0;
    |ABRE #agim0019;
    #agim0019#0 = #dsmow032#0; || Empresa
    #agim0019#1 = 99;
    |LEE 041#agim0019.];
    |SI FSalida = 0;
       |LEE 041#agim0019.a;
    |SINO;
       |LEE 041#agim0019.u;
    |FINSI;
    |SI FSalida = 0; |Y #agim0019#0 = #dsmow032#0;
        swExiste = 1;
    |FINSI;
    |SI swExiste = 1;
        efPn10 = #agim0019#7;      || Fecha Activa
        efPn11 = #agim0019#55;     || Fecha Inactiva
        nPin1 = #agim0019#4;
        aPin1 = #agim0019#5;
    |FINSI;
    |CIERRA #agim0019;

    |ABRE #agifigen;
    #agifigen#0 = #dsmow032#0; || Empresa
    |LEE 041#agifigen.=;
    |SI FSalida = 0;
        efPn10  = #agifigen#93;
        efPn11  = #agifigen#94;
        nPin1   = #agifigen#87;
        aPin1   = #agifigen#88;
        #dsmow032#1  = #agifigen#13;  || Nif
        #dsmow032#2  = #agifigen#1;   || Nombre
    |FINSI;
    |CIERRA #agifigen;
    |SI efPn10 [ "01.01.1900"; efPn10 = "01.01.0000"; |FINSI;
    |SI efPn11 [ "01.01.1900"; efPn11 = "01.01.0000"; |FINSI;
    #dsmow032#3 = nPin1;
    #dsmow032#4 = aPin1;
    #dsmow032#9 = efPn10;
    #dsmow032#10 = efPn11;

     #dsmow032#11 = "ACTIVA";
     |SI efPn11 > "01.01.1900";
         #dsmow032#11 = "INACTIVA";
     |FINSI;
    #dsmow032#12 = enEjer;                                   || Ejercicio
    #dsmow032#13 = efDFecha;
    #dsmow032#14 = efHFecha;

    #dsmow032#50 = eaTituloL; ||Titulo del Libro
|FPRC;
