|FICHEROS;
     dsmoy000 #0;
     dsmom001 #1;
     dsmom004 #4;
     dsmom107 #107;
     dsmom999 #199;

     dsm39001 #390;
     dsm39002 #490;
     dsm39003 #590;
     dsm39004 #690;
     dsm39005 #790;

     dsmow014 #999;

     dsmow547 #547;
     dsmow549 #549;
     dsmow556 #556;

     :/basica/def/agim0004 #24;
     :/basica/def/agicen15 #1015;
     :/basica/def/agicen14 #1014;

     &regisnif@ #709;
     &clientes@ #715;
     &datosper@ #718;
|FIN;

|VARIABLES;
     aLetrasCif      = "ABCDEFGHNPQSKLMJUVWR";
     aImpre          = "";
     aIPRemoto       = "";
     nNueEjer        = 0;

     nGrupo          = 0;
     nSubGrupo       = 0;
     nCampo1         = 0;
     nCampo2         = 0;
     nCampo3         = 0;
     nCampo4         = 0;
     nCampo5         = 0;
     nCampo6         = 0;
     nSwHay          = 0;
     nModulos        = 0;
     nLineaC         = 0;
     nTopeD          = 0;
     nTopeH          = 0;
     nComple         = 0;
     nComplementaria = 0;
     nImpreLaser     = 0;

     &enEjer         = 0;
     &enComplem      = 0;
     &enTipoEntrada  = 0;
     &nSwMod         = 0;
|FIN;

|INCLUYE i_varemi;

|PROCESO LeeCasilla;
     #490#0  = #390#0;
     #490#1  = #390#1;
     #490#2  = #390#2;
     #490#3  = #390#3;
     #490#4  = nGrupo;
     #490#5  = nSubGrupo;
     |SELECT #1#490;
     |LEE 040#490=;
     |SI FSalida ! 0;  |DDEFECTO #490;  |FINSI;
|FPRC;

|PROCESO BuscaComuneros;
     aAlfa = "31.12." + #390#1;
     |SI #1#8 > aAlfa;  |ACABA;  |FINSI;

     aAlfa = "01.01." + #390#1;
     |SI #1#9 > "01.01.0000";
         |SI #1#9 < aAlfa;  |ACABA;  |FINSI;
     |FINSI;

     aAlfa = "31.12." + #390#1; fFecha = aAlfa;
     #1014#0  = #1#0;  ||Compruebo si esta la actividad de alta
     #1014#1  = #1#1;  ||Tique 700000_7747
     |LEE 000#1014=;
     |SI FSalida ! 0;  |DDEFECTO #1014;  |FINSI;
     |SI #1014#5 > "01.01.0000";
         |SI #1014#5 > fFecha;  |ACABA;  |FINSI;
     |FINSI;
     aAlfa = "01.01." + #390#1; fFecha = aAlfa;
     |SI #1014#6 > "01.01.0000";
         |SI #1014#6 < fFecha;  |ACABA;  |FINSI;
     |FINSI;

     enComuneros = 1;

     enCodCli = #1#3;
     |HAZ LeePersona;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #547#41 = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;     #547#42 = eaAlfa;
         #547#43  = #715#29;
         eaAlfa   = #715#30;  |HAZ QuitaRaros;    #547#44 = eaAlfa;
         #547#45  = #715#31 % 104;
         #547#46  = #715#32;
         #547#47  = #715#33;
         #547#48  = #715#34;
         eaAlfa   = #715#54;  |HAZ QuitaRarosTfno;  #547#49  = eaAlfa;
         eaAlfa   = #715#37;  |HAZ QuitaRaros;      #547#50  = eaAlfa;
         eaAlfa   = #715#38;  |HAZ QuitaRaros;      #547#51  = eaAlfa;
         #547#52 = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
     |SINO;
         eaVarDni = #715#13; |HAZ CalculameDNI;     #547#41  = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;       #547#42  = eaAlfa;
         #547#43  = #715#3;
         eaAlfa   = #715#4;  |HAZ QuitaRaros;       #547#44  = eaAlfa;
         #547#45  = #715#5 % 104;
         #547#46  = #715#6;
         #547#47  = #715#7;
         #547#48  = #715#8;
         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;  #547#49  = eaAlfa;
         eaAlfa   = #715#11;  |HAZ QuitaRaros;      #547#50  = eaAlfa;
         eaAlfa   = #715#12;  |HAZ QuitaRaros;      #547#51  = eaAlfa;
         #547#52  = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
     |FINSI;

     |ERROR10;
|FPRC;

|DEFBUCLE dsmom001;
     #1#1;
     ;
     #390#0, 01, 0001;
     #390#0, 99, 9999;
     ;
     NULL, BuscaComuneros;
|FIN;

|PROCESO ElRepresentante;
         |ABRE #1015;
         #1015#0 = #390#0;
         |LEE 000#1015=;
         |SI FSalida ! 0;  |DDEFECTO #1015;  |FINSI;
         |CIERRA #1015;

         |SI #1015#4 =  "            ";  |ACABA;  |FINSI;

         enCodCli = #390#0;
         |HAZ LeePersona;
         |SI enSwDeDonde = 1;
             |SI #715#3  = #1015#4;  |ACABA;  |FINSI;
         |SINO;
             |SI #715#13 = #1015#4;  |ACABA;  |FINSI;
         |FINSI;

         eaVarDni = #1015#4;  |HAZ CalculameDNI;   #547#41 = eaVarDni;
         eaAlfa   = #1015#5;  |HAZ QuitaRaros;     #547#42 = eaAlfa;
         #547#43  = #1015#8;
         eaAlfa   = #1015#9;  |HAZ QuitaRaros;     #547#44 = eaAlfa;
         #547#45  = #1015#10 % 104;
         #547#46  = #1015#11;
         #547#47  = #1015#12;
         #547#48  = #1015#13;
         eaAlfa   = #1015#14;  |HAZ QuitaRarosTfno;  #547#49  = eaAlfa;
         eaAlfa   = #1015#17;  |HAZ QuitaRaros;      #547#50  = eaAlfa;
         eaAlfa   = #1015#18;  |HAZ QuitaRaros;      #547#51  = eaAlfa;
         #547#52 = (("00" + #1015#15) % -102) + (("000" + #1015#16) % -103);
|FPRC;

|PROCESO PonRepresentantes;
     nLinea = nLinea + 1;
     |SI nLinea = 1;
         eaAlfa   = #24#3;   |HAZ QuitaRaros;     #547#58  = eaAlfa;
         eaVarDni = #24#2;   |HAZ CalculameDNI;   #547#59  = eaVarDni;
         #547#60  = (#24#4 % 102) + (#24#4 % 402) + (#24#4 % -104);
         eaAlfa   = #24#5;   |HAZ QuitaRaros;     #547#61  = eaAlfa;
     |FINSI;

     |SI nLinea = 2;
         eaAlfa   = #24#3;   |HAZ QuitaRaros;     #547#62  = eaAlfa;
         eaVarDni = #24#2;   |HAZ CalculameDNI;   #547#63  = eaVarDni;
         #547#64  = (#24#4 % 102) + (#24#4 % 402) + (#24#4 % -104);
         eaAlfa   = #24#5;   |HAZ QuitaRaros;     #547#65  = eaAlfa;
     |FINSI;

     |SI nLinea = 3;
         eaAlfa   = #24#3;   |HAZ QuitaRaros;     #547#66  = eaAlfa;
         eaVarDni = #24#2;   |HAZ CalculameDNI;   #547#67  = eaVarDni;
         #547#68  = (#24#4 % 102) + (#24#4 % 402) + (#24#4 % -104);
         eaAlfa   = #24#5;   |HAZ QuitaRaros;     #547#69  = eaAlfa;
     |FINSI;

     |SI nLinea = 3;  |ERROR10;  |FINSI;
|FPRC;

|DEFBUCLE agim0004;
     #24#1;
     ;
     #390#0, 01;
     #390#0, 99;
     ;
     NULL, PonRepresentantes;
|FIN;

|PROCESO BuscaFirmantes;
     enComuneros = 0;
     |ABRE #1014;
     |BUCLE dsmom001;
     |CIERRA #1014;

     |SI enComuneros = 1;  |O eaComBienes = "S";
         #547#53 = (#0#7 % 102) + (#0#7 % 402) + (#0#7 % -104);

         |HAZ ElRepresentante;
         |SI enComuneros = 1;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #547#53 = "        ";
         nLinea = 0;
         |BUCLE agim0004;
         eaAlfa  = #0#7;  |HAZ FechaBonito;
         |SI nLinea = 0;
             #547#53 = (#0#7 % 102) + (#0#7 % 402) + (#0#7 % -104);
         |SINO;
             #547#54 = #547#14;
             #547#55 = eaDiaB;
             #547#56 = eaMesB;
             #547#57 = eaAnyoB;
         |FINSI;
     |FINSI;

     |SI #547#53 ! "        ";
         aAlfa = #547#58;  |QBF aAlfa;
         |SI #547#41 = "         ";   |Y aAlfa = "";
             |HAZ ElRepresentante;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Regis547;
     |ABRE #390;
     #390#0 = #4#0;
     #390#1 = #4#1;
     #390#2 = #4#3;
     #390#3 = #4#4;
     |LEE 040#390=;
     |SI FSalida ! 0;  |CIERRA #390;  |ACABA;  |FINSI;
     |CIERRA #390;

     enCodCli = #390#0;
     |HAZ LeePersona;

     |DDEFECTO #547;

     |SI enSwDeDonde = 1;
         #547#6   = (("00" + #715#15) % -102) + (("000" + #715#16) % -103);
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #547#7   = eaVarDni;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = #718#2;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #547#8 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #547#9 = eaAlfa;
         |SINO;
             eaAlfa = #715#1;  |HAZ QuitaRaros;  #547#8  = eaAlfa;
             aCaracter  = eaVarDni % 101;
             aAlfa      = aLetrasCif - aCaracter;
             |SI aAlfa  = aLetrasCif;  #547#9 = ".";  |FINSI;
         |FINSI;

         eaAlfa = #715#55;  |QBF eaAlfa;
         |SI eaAlfa = "";  eaAlfa  = #715#54;  |FINSI;

         |HAZ QuitaRarosTfno;  #547#10 = eaAlfa;

         #547#11  = #715#29;
         eaAlfa   = #715#30;  |HAZ QuitaRaros;  #547#12 = eaAlfa;
         #547#13  = #715#31 % 104;
         eaEscal  = #715#32 % 102;  |QBF eaEscal;
         eaPiso   = #715#33;        |QBF eaPiso;
         eaPuerta = #715#34;        |QBF eaPuerta;
         eaAlfa   = #715#37;  |HAZ QuitaRaros;  #547#14 = eaAlfa;
         eaAlfa   = #715#38;  |HAZ QuitaRaros;  #547#15 = eaAlfa;
         #547#16  = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);

         eaComBienes = #715#12;
         eaDeleg     = #715#17;
         eaAdmin     = #715#18;
     |SINO;
         #547#6   = (("00" + #715#63) % -102) + (("000" + #715#64) % -103);
         eaVarDni = #715#13; |HAZ CalculameDNI;    #547#7  = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;      #547#8  = eaAlfa;

         aCaracter  = eaVarDni % 101;
         aAlfa      = aLetrasCif - aCaracter;
         |SI aAlfa  = aLetrasCif;  #547#9 = ".";  |FINSI;

         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno; #547#10 = eaAlfa;
         #547#11  = #715#3;
         eaAlfa   = #715#4;  |HAZ QuitaRaros;      #547#12 = eaAlfa;
         #547#13  = #715#5 % 104;
         eaEscal  = #715#6 % 102;  |QBF eaEscal;
         eaPiso   = #715#7;        |QBF eaPiso;
         eaPuerta = #715#8;        |QBF eaPuerta;
         eaAlfa   = #715#11;  |HAZ QuitaRaros;     #547#14 = eaAlfa;
         eaAlfa   = #715#12;  |HAZ QuitaRaros;     #547#15 = eaAlfa;
         #547#16 = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);

         eaDeleg     = #715#91;
         eaAdmin     = #715#92;
     |FINSI;

     #547#17 = "0";
     |SI #390#88 = "X";  #547#17  = "1";  |FINSI;

     #547#74 = "0";
     |SI #390#98 = "S";  #547#74  = "1";  |FINSI;

     #547#18  = #390#1;
     #547#19  = #390#13;

     |SI #390#64 = "9999";  #390#64 = "";  |FINSI;
     |SI #390#68 = "9999";  #390#68 = "";  |FINSI;
     |SI #390#72 = "9999";  #390#72 = "";  |FINSI;
     |SI #390#76 = "9999";  #390#76 = "";  |FINSI;
     |SI #390#80 = "9999";  #390#80 = "";  |FINSI;
     |SI #390#84 = "9999";  #390#84 = "";  |FINSI;

     eaAlfa   = #390#65;  |HAZ QuitaRaros;      #547#20 = eaAlfa;
     #547#21  = #390#66;
     #547#22  = #390#64;
     eaAlfa   = #390#69;  |HAZ QuitaRaros;      #547#23 = eaAlfa;
     #547#24  = #390#70;
     #547#25  = #390#68;
     eaAlfa   = #390#73;  |HAZ QuitaRaros;      #547#26 = eaAlfa;
     #547#27  = #390#74;
     #547#28  = #390#72;
     eaAlfa   = #390#77;  |HAZ QuitaRaros;      #547#29 = eaAlfa;
     #547#30  = #390#78;
     #547#31  = #390#76;
     eaAlfa   = #390#81;  |HAZ QuitaRaros;      #547#32 = eaAlfa;
     #547#33  = #390#82;
     #547#34  = #390#80;
     eaAlfa   = #390#85;  |HAZ QuitaRaros;      #547#35 = eaAlfa;
     #547#36  = #390#86;
     #547#37  = #390#84;

     #547#38  = "0";
     |SI #390#87 = "X";  #547#38  = "1";  |FINSI;

     eaVarDni = #390#89;  |HAZ CalculameDNI;    #547#39 = eaVarDni;
     eaAlfa   = #390#90;  |HAZ QuitaRaros;      #547#40 = eaAlfa;

     |HAZ BuscaFirmantes;
|FPRC;

|PROCESO Regis549;
     |DDEFECTO #549;

     |ABRE #490;

     |PARA nCampo1 = 14;  |SI nCampo1 [ 38;  |HACIENDO nCampo1 = nCampo1 + 6;
           nCampo2 = nCampo1 + 1;
           nCampo3 = nCampo1 + 2;
           nCampo4 = nCampo1 + 3;
           nCampo5 = nCampo1 + 4;
           nCampo6 = nCampo1 + 5;

           |SI #390nCampo1 ! 0;
               nCampo = nCampo1 - 8;  aAlfa   = ("00" + #390nCampo1) % -102; #549nCampo = aAlfa;
               nCampo = nCampo + 1;   enNume  = #390nCampo2;  |HAZ Conver13; #549nCampo = eaAlfa;
               nCampo = nCampo + 1;   enNume  = #390nCampo3 * 100000;        aAlfa  = ("000000" + enNume) % -106;
               #549nCampo = aAlfa;
               nCampo = nCampo + 1;   enNume  = #390nCampo4;  |HAZ Conver13; #549nCampo = eaAlfa;
               nCampo = nCampo + 1;   enNume  = #390nCampo4 - #390nCampo6;   |HAZ Conver13; #549nCampo = eaAlfa;
               nCampo = nCampo + 1;   enNume  = #390nCampo6;  |HAZ Conver13; #549nCampo = eaAlfa;
           |FINSI;
     |SIGUE;

     enNume  = #390#44;  |HAZ Conver13;  #549#36 = eaAlfa;
     enNume  = #390#45;  |HAZ Conver13;  #549#37 = eaAlfa;
     enNume  = #390#46;  |HAZ Conver13;  #549#38 = eaAlfa;
     enNume  = #390#47;  |HAZ Conver13;  #549#39 = eaAlfa;
     enNume  = #390#48;  |HAZ Conver13;  #549#40 = eaAlfa;
     enNume  = #390#49;  |HAZ Conver13;  #549#41 = eaAlfa;
     enNume  = #390#50;  |HAZ Conver13;  #549#42 = eaAlfa;
     enNume  = #390#51;  |HAZ Conver13;  #549#43 = eaAlfa;
     enNume  = #390#52;  |HAZ Conver13;  #549#44 = eaAlfa;
     enNume  = #390#5;   |HAZ Conver13;  #549#45 = eaAlfa;
     enNume  = #390#53;  |HAZ Conver13;  #549#46 = eaAlfa;
     enNume  = #390#54;  |HAZ Conver13;  #549#47 = eaAlfa;

     enNume  = #390#6;   |HAZ Conver13;  #549#48 = eaAlfa;
     enNume  = #390#55 * 100;            #549#49 = ("0000" + enNume) % -104;
     enNume  = #390#56 * 100;            #549#50 = ("0000" + enNume) % -104;
     enNume  = #390#57 * 100;            #549#51 = ("0000" + enNume) % -104;
     enNume  = #390#58 * 100;            #549#52 = ("0000" + enNume) % -104;
     enNume  = #390#59 * 100;            #549#53 = ("0000" + enNume) % -104;
     enNume  = #390#60;  |HAZ Conver13;  #549#54 = eaAlfa;
     enNume  = #390#61;  |HAZ Conver13;  #549#55 = eaAlfa;
     enNume  = #390#62;  |HAZ Conver13;  #549#56 = eaAlfa;

     enNume  = #390#7;   |HAZ Conver13;  #549#57 = eaAlfa;
     enNume  = #390#8;   |HAZ Conver13;  #549#58 = eaAlfa;
     enNume  = #390#9;   |HAZ Conver13;  #549#59 = eaAlfa;
     enNume  = #390#10;  |HAZ Conver13;  #549#60 = eaAlfa;
     enNume  = #390#11;  |HAZ Conver13;  #549#61 = eaAlfa;
     enNume  = #390#100; |HAZ Conver13;  #549#90 = eaAlfa;
     enNume  = #390#101; |HAZ Conver13;  #549#91 = eaAlfa;
     enNume  = #390#102; |HAZ Conver13;  #549#92 = eaAlfa;

     |ABRE #490;
     nGrupo  = 3;  nSubGrupo = 1;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#62 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 17;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#63 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 9;  |HAZ LeeCasilla;
     enNume  = #490#10;
     nGrupo  = 3;  nSubGrupo = 16;  |HAZ LeeCasilla;
     enNume  = enNume + #490#10;  |HAZ Conver13;  #549#64 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 10;  |HAZ LeeCasilla;
     enNume  = #490#10;
     nGrupo  = 3;  nSubGrupo = 11;  |HAZ LeeCasilla;
     enNume  = enNume + #490#10;  |HAZ Conver13;  #549#65 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 12;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#66 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 4;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#67 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 7;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#68 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 2;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#69 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 3;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#70 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 8;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#71 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 5;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#72 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 6;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#73 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 13;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#74 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 14;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#75 = eaAlfa;

     enNume  = #390#12;  |HAZ Conver13;  #549#76 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 1;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#79 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 2;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#80 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 3;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#81 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 4;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#82 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 6;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#83 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 8;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#84 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 16;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#85 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 17;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#86 = eaAlfa;
     enNume  = #490#11;  |HAZ Conver13;  #549#87 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 18;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#88 = eaAlfa;
     enNume  = #490#11;  |HAZ Conver13;  #549#89 = eaAlfa;

     |CIERRA #490;
|FPRC;

|PROCESO CargaGrupo;
     #790#0 = #4#0;
     #790#1 = #4#1;
     #790#2 = #4#3;
     #790#3 = #4#4;
     #790#4 = nGrupo;
     |LEE 040#790=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI nGrupo = 1;  nCampo = 6;  |FINSI;
     |SI nGrupo = 2;  nCampo = 23; |FINSI;
     |SI nGrupo = 3;  nCampo = 40; |FINSI;

                           enNume  = #790#5;   |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#6;   |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#7;   |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#8;   |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#9;   |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#10;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#11;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#12;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#13;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#14;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#15;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#16;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#17;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#18;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#19;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#20;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#21;  |HAZ Conver13;  #556nCampo = eaAlfa;
     |SI nGrupo = 1; nCampo = 59; |FINSI;
     |SI nGrupo = 2; nCampo = 60; |FINSI;
     |SI nGrupo = 3; nCampo = 61; |FINSI;
     enNume  = #790#22;  |HAZ Conver13;  #556nCampo = eaAlfa;

     |PARA nCampo = 5;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
           |SI #790nCampo ! 0;  nSwHay = 1;  |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Regis556;
     |DDEFECTO #556;

     |ABRE #790;

     nSwHay = 0;
     nGrupo = 1;  |HAZ CargaGrupo;
     nGrupo = 2;  |HAZ CargaGrupo;
     nGrupo = 3;  |HAZ CargaGrupo;

     |CIERRA #790;
|FPRC;

|PROCESO MiroModulo;
      nSwMod = 1;
|FPRC;

|DEFBUCLE MiroModulo;
     #590#1;
     ;
     #390#0, #390#1, #390#2, #390#3, 01;
     #390#0, #390#1, #390#2, #390#3, 99;
     ;
     NULL, MiroModulo;
|FIN;

|PROCESO  Portal390;
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     eaFicheroPlano = "390" + (("00000" + #999#0) % -105) + ".xml";
     eaFicheroImpre = "390" + (("00000" + #999#0) % -105) + ".imp";
     eaFicheroSalid = "390" + (("00000" + #999#0) % -105) + ".390";
     eaFicheroError = "err" + (("00000" + #999#0) % -105) + ".txt";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Regis547;
     |HAZ Regis651;
     |HAZ Regis549;
     |HAZ Regis556;

     nSwMod = 0;
     |BUCLE MiroModulo;

     nNueEjer = #0#6;
     |ABRE #199;
     |DDEFECTO #199;
     #199#0 = #0#0;
     #199#1 = #0#6;
     #199#2 = 00;
     |LEE 001#199];
     |SI FSalida ! 0; |O #199#1 ! #0#6;
         aAlfa1 = "    SNo tenemos informacion del Modelo en el Ejercicio Actual. Lanzar segun dise¤o Anterior?";
         |CONFI aAlfa1;
         |SI FSalida ! 0;
             |CIERRA #199;
             |ACABA;
         |FINSI;
         #0#6 = #0#6 - 1;
     |FINSI;
     |CIERRA #199;

     |ABRE #199;
     |HAZ CargaXml;
     |CIERRA #199;
     #0#6 = nNueEjer;

     |XCIERRA enHandle2;

     enEmpresa    = #999#0;
     eaNomEmpresa = #999#3;

     |HAZ PresentaPortal;
|FPRC;

|DEFBUCLE dsmow014C390;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, Portal390;
|FIN;

|DEFBUCLE dsmow014N390;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, Portal390;
|FIN;

|PROCESO Bloque2014;
     |HAZ BtnAnuales2012;

     |SI eaOpcion = "0";  enInfComp = 1;  |ACABA;  |FINSI;

     nTecla = 1;

     nSwLee  = 0;
     enTecla = nTecla;

     |SI #0#8 = "C";
         |BUCLE dsmow014C390;
     |SINO;
         |BUCLE dsmow014N390;
     |FINSI;

     |HAZ SacaErrorPtl;

     |SI eaOpcion = "3";  |Y enPresentar = 0;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROGRAMA;
     aFichero = ("000" + Usuario) % 108;
     |NOME_DAT #dsmoy000#aFichero#;

     |ABRE #dsmoy000;
     |LEE 000#dsmoy000.p;
     |CIERRA #dsmoy000;

     aFichero = ("imp" + Usuario) % 108;
     |NOME_DAT #999#aFichero#;

     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     |ABRE #0;
     |LEE 000#0p;
     |CIERRA #0;

     enSwTrata      = 0;
     enCambiaMoneda = 1;

     |HAZ Bloque2014;
|FPRO;
