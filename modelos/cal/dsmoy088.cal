|FICHEROS;
     dsm190ca #190;
     dsm190li;
     dsm19001;
     dsmom073;

     :/basica/def/agifigen;

     dsmoy088;
     dsmow161;
     dsmow032;
|FIN;

|VARIABLES;
     nCampo            = 0;

     nDEmpresa         = 0;
     nHEmpresa         = 0;
     nEmpresa          = 0;
     nPeriodo          = 0;
     nComplem          = 0;

     aFichero          = "";

     fFecha            = @;
     nNume1            = 0;
     nNume2            = 0;
     nNume3            = 0;
     nNume4            = 0;
     nAlgo             = 0;

     &aNumEmp          = "";
     &aNomEmp          = "";
     &nSwLinea         = 0;

     nHay     = 0;
     aAlfa    = "";
     aAlfa1   = "";
     aAlfa2   = "";

     informe  = "";
     nSw      = 0;
     aNomE    = "";
     aNomP    = "";
     aNif     = "";
     aNifE    = "";
     aClave   = "";
     aSubCl   = "";

     aDBlanc  = "";
     aHBlanc  = "";
     aDClave  = "";
     aHClave  = "";
     aDSubCl  = "";
     aHSubCl  = "";
     aDNif    = "";
     aHNif    = "";
     nModelo  = 0;
     doce     = "            ";

     nCampo1  = 0;
     nCampo2  = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varlib;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\
|PROCESO Periodo;
      fFecha = ~;
      aAlfa  = fFecha % -104;
      #dsmoy088#2   = aAlfa;
      #dsmoy088#2   = #dsmoy088#2 - 1;
      |PINTA #dsmoy088#2;
|FPRC;

|PROCESO Parrilla;
     |SI #dsmoy088#3 = 0;
         #dsmoy088#3 = 0;  |PINTA #dsmoy088#3;
         #dsmoy088#4 = 0;  |PINTA #dsmoy088#4;  |C_M #dsmoy088#4, 1, "N";
         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy088#nCampo#, 1, "S";
         |SIGUE;
     |SINO;
         |C_M #dsmoy088#3, 1, "S";
         |C_M #dsmoy088#4, 1, "S";

         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy088#nCampo#, 1, "N";
               #dsmoy088#nCampo# = 0;  |PINTA #dsmoy088#nCampo#;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #dsmoy088#Campo# = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               #dsmoy088#nCampo# = 0;  |C_M #dsmoy088#nCampo#, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy088#nCampo#, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO LasClaves; |TIPO 0;
     aAlfa1 = "N";
     aAlfa2 = "S";
     |SI #dsmoy088#19 = "S";
         aAlfa1 = "S";
         aAlfa2 = "N";
     |FINSI;
     |C_M #dsmoy088#20,1, aAlfa1;  |C_M #dsmoy088#21,1, aAlfa1;
     |C_M #dsmoy088#22,1, aAlfa1;  |C_M #dsmoy088#23,1, aAlfa1;
     |SI aAlfa1 = "N";
         #dsmoy088#20 = "";   |PINTA #dsmoy088#20;
         #dsmoy088#21 = "";   |PINTA #dsmoy088#21;
         #dsmoy088#22 = "z";  |PINTA #dsmoy088#22;
         #dsmoy088#23 = "zz"; |PINTA #dsmoy088#23;
     |FINSI;
     |PARA nCampo = 30;  |SI nCampo [ 37;  |HACIENDO nCampo = nCampo + 1;
           |C_M #dsmoy088#nCampo#, 1, aAlfa2;

           |SI aAlfa2 = "N";
               #dsmoy088#nCampo# = ""; |PINTA #dsmoy088#nCampo#;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Desglosar;
     aAlfa1 = #dsmoy088#24;
     |C_M #dsmoy088#17, 1, aAlfa1;
     |C_M #dsmoy088#18, 1, aAlfa1;
     |C_M #dsmoy088#25, 1, aAlfa1;
     |SI aAlfa1 = "N";
         #dsmoy088#17 = "            "; |PINTA #dsmoy088#17;
         #dsmoy088#18 = "zzzzzzzzzzzz"; |PINTA #dsmoy088#18;
     |FINSI;
|FPRC;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\

|PROCESO ACero;
   |BORRA 020#dsmow161.a;
   |LIBERA #dsmow161;
|FPRC;

|DEFBUCLE ACero;
   #dsmow161#1;
   ;
   nEmpresa, aDClave, aDSubCl, aDNif;
   nEmpresa, aHClave, aHSubCl, aHNif;
   ;
   NULL, ACero;
|FIN;

|PROCESO Tmp190li;
     #dsmow161#0 = nEmpresa;
     #dsmow161#1 = aClave;
     #dsmow161#2 = aSubCl;
     #dsmow161#3 = aNif;
     |LEE 141#dsmow161.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow161;
         #dsmow161#0  = nEmpresa;
         #dsmow161#1  = aClave;
         #dsmow161#2  = aSubCl;
         #dsmow161#3  = aNif;
         #dsmow161#4  = aNomE;
         #dsmow161#5  = aNomP;
         #dsmow161#12 = aNifE;
         |GRABA 020#dsmow161.b;
     |FINSI;

     #dsmow161#6  = #dsmow161#6  + #dsm190li#16;
     #dsmow161#7  = #dsmow161#7  + #dsm190li#17;
     #dsmow161#8  = #dsmow161#8  + #dsm190li#18;
     #dsmow161#9  = #dsmow161#9  + #dsm190li#19;
     #dsmow161#10 = #dsmow161#10 + #dsm190li#20;
     #dsmow161#11 = #dsmow161#11 + (#dsm190li#21 + #dsm190li#22 + #dsm190li#23 + #dsm190li#24);

     |GRABA 020#dsmow161.a;
     |LIBERA #dsmow161;
     nAlgo = 1;
|FPRC;

|PROCESO dsm190li;
     |SI #dsmoy088#19 = "N";
         nSw = 0;
         |SI #dsmoy088#30 = #dsm190li#8; |Y #dsmoy088#31 = #dsm190li#9; nSw = 1; |FINSI;
         |SI #dsmoy088#32 = #dsm190li#8; |Y #dsmoy088#33 = #dsm190li#9; nSw = 1; |FINSI;
         |SI #dsmoy088#34 = #dsm190li#8; |Y #dsmoy088#35 = #dsm190li#9; nSw = 1; |FINSI;
         |SI #dsmoy088#36 = #dsm190li#8; |Y #dsmoy088#37 = #dsm190li#9; nSw = 1; |FINSI;
         |SI nSw = 0; |ACABA; |FINSI;
     |FINSI;

     aClave = " ";
     aSubCl = "  ";
     aNif   = "";
     aNomP  = "";
     |HAZ Tmp190li;

     aClave = #dsm190li#8;
     aSubCl = #dsm190li#9;
     |HAZ Tmp190li;

     |SI #dsmoy088#24 = "S";
         aNif   = #dsm190li#6;
         aNomP  = #dsm190li#12;
         |HAZ Tmp190li;
     |FINSI;
|FPRC;

|DEFBUCLE dsm190li;
 #dsm190li#1;
 ;
 #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,#dsmoy088#17,0000,#dsmoy088#20,#dsmoy088#21,0;
 #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,#dsmoy088#18,9999,#dsmoy088#22,#dsmoy088#23,9;
 ;
 NULL, dsm190li;
|FIN;

|PROCESO Tmp19001;
     #dsmow161#0 = nEmpresa;
     #dsmow161#1 = aClave;
     #dsmow161#2 = aSubCl;
     #dsmow161#3 = aNif;
     |LEE 141#dsmow161.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow161;
         #dsmow161#0  = nEmpresa;
         #dsmow161#1  = aClave;
         #dsmow161#2  = aSubCl;
         #dsmow161#3  = aNif;
         #dsmow161#4  = aNomE;
         #dsmow161#5  = aNomP;
         #dsmow161#12 = aNifE;
         |GRABA 020#dsmow161.b;
     |FINSI;

     #dsmow161#6  = #dsmow161#6  + #dsm19001#16;
     #dsmow161#6  = #dsmow161#6  + #dsm19001#65;
     #dsmow161#7  = #dsmow161#7  + #dsm19001#17;
     #dsmow161#7  = #dsmow161#7  + #dsm19001#66;
     #dsmow161#8  = #dsmow161#8  + #dsm19001#18;
     #dsmow161#8  = #dsmow161#8  + #dsm19001#67;
     #dsmow161#9  = #dsmow161#9  + #dsm19001#19;
     #dsmow161#9  = #dsmow161#9  + #dsm19001#68;
     #dsmow161#10 = #dsmow161#10 + #dsm19001#20;
     #dsmow161#10 = #dsmow161#10 + #dsm19001#69;
     #dsmow161#11 = #dsmow161#11 + (#dsm19001#21 + #dsm19001#22 + #dsm19001#23 + #dsm19001#24);

     |GRABA 020#dsmow161.a;
     |LIBERA #dsmow161;
     nAlgo = 1;
|FPRC;

|PROCESO dsm19001;
     |SI #dsmoy088#19 = "N";
         nSw = 0;
         |SI #dsmoy088#30 = #dsm19001#8; |Y #dsmoy088#31 = #dsm19001#9; nSw = 1; |FINSI;
         |SI #dsmoy088#32 = #dsm19001#8; |Y #dsmoy088#33 = #dsm19001#9; nSw = 1; |FINSI;
         |SI #dsmoy088#34 = #dsm19001#8; |Y #dsmoy088#35 = #dsm19001#9; nSw = 1; |FINSI;
         |SI #dsmoy088#36 = #dsm19001#8; |Y #dsmoy088#37 = #dsm19001#9; nSw = 1; |FINSI;
         |SI nSw = 0; |ACABA; |FINSI;
     |FINSI;

     aClave = " ";
     aSubCl = "  ";
     aNif   = "";
     aNomP  = "";
     |HAZ Tmp19001;

     aClave = #dsm19001#8;
     aSubCl = #dsm19001#9;
     |HAZ Tmp19001;

     |SI #dsmoy088#24 = "S";
         aNif   = #dsm19001#6;
         aNomP  = #dsm19001#12;
         |HAZ Tmp19001;
     |FINSI;
|FPRC;

|DEFBUCLE dsm19001;
 #dsm19001#1;
 ;
 #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,#dsmoy088#17,0000,#dsmoy088#20,#dsmoy088#21,0;
 #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,#dsmoy088#18,9999,#dsmoy088#22,#dsmoy088#23,9;
 ;
 NULL, dsm19001;
|FIN;

|PROCESO Leedsm190ca;
  |SI #dsm190ca#10 = "S"; |Y #dsm190ca#4 ! 0;
      |SI nComplem ! #dsm190ca#4;
          |BUCLE ACero;
      |FINSI;
  |FINSI;
  nComplem = #dsm190ca#4;

  |ABRE #dsmow161;

  |SI #dsmoy088#2 [ 2015;
      |BUCLE dsm190li;
  |FINSI;

  |SI #dsmoy088#2 ] 2016;
      |BUCLE dsm19001;
  |FINSI;

  |CIERRA #dsmow161;
|FPRC;

|DEFBUCLE Leedsm190ca;
  #dsm190ca#1;
  ;
  nEmpresa, #dsmoy088#2, nPeriodo, nModelo, 00, 00;
  nEmpresa, #dsmoy088#2, nPeriodo, nModelo, 99, 99;
  e;
  NULL,Leedsm190ca;
|FIN;

|PROCESO LaEmpresa;

  nComplem = -1;
  nEmpresa = #agifigen#0;
  aNomE    = #agifigen#1;
  aNifE    = #agifigen#13;
  |BUCLE Leedsm190ca;
|FPRC;

|DEFBUCLE agifigen;
  #agifigen#1;
  ;
  nDEmpresa;
  nHEmpresa;
  ;
  NULL, LaEmpresa;
|FIN;

|| ... ... ... ... ... ... ... ... Proceso para Imprimir Auxiliar
|PROCESO Imprime;

     |SI nEmpresa ! #dsmow161#0;
         |SI nHay ! 0;
             |SI #dsmoy088#1 = "S";
                 |PIEINF;
             |SINO;
                 nSwLinea = 3; |PRINT;
             |FINSI;
         |FINSI;
         enEmpresa = #dsmow161#0;
         |HAZ DatosEmpr_w32;

         #dsmow032#25 = #dsmow161#6;
         #dsmow032#26 = #dsmow161#7;
         #dsmow032#27 = #dsmow161#8;
         #dsmow032#28 = #dsmow161#9;
         #dsmow032#29 = #dsmow161#10;
         #dsmow032#30 = #dsmow161#11;

         nEmpresa = #dsmow161#0;
         aClave   = " ";
         aSubCl   = "  ";
         nHay     = 0;
         nSwLinea = 0;
         |SI #dsmoy088#1 ! "S";
             |PRINT;
         |FINSI;
         nAlgo    = 1;
     |FINSI;

     |SI #dsmow161#1 ! aClave; |O #dsmow161#2 ! aSubCl;
         |SI nHay ! 0;
             |SI #dsmoy088#24 = "S"; nSwLinea = 3; |PRINT; |FINSI;
         |FINSI;
         aClave = #dsmow161#1;
         aSubCl = #dsmow161#2;
         nSwLinea = 1; |PRINT;
         nHay     = 1;
         nAlgo    = 1;
    |FINSI;

    |SI #dsmoy088#24 = "S";
        |SI #dsmow161#3 ! doce;
            nSwLinea = 2; |PRINT;
            nHay     = 1;
            nAlgo    = 1;
        |FINSI;
    |FINSI;
|FPRC;

|DEFBUCLE dsmow161_4;
     #dsmow161#4;
     ;
     aDBlanc, aDClave, aDSubCl, aDBlanc, aDNif;
     aHBlanc, aHClave, aHSubCl, aHBlanc, aHNif;
     ;
     NULL, Imprime;
|FIN;

|DEFBUCLE dsmow161_3;
     #dsmow161#3;
     ;
     00000, aDClave, aDSubCl, aDBlanc, aDNif;
     99999, aHClave, aHSubCl, aHBlanc, aHNif;
     ;
     NULL, Imprime;
|FIN;

|DEFBUCLE dsmow161_2;
     #dsmow161#2;
     ;
     aDBlanc, aDClave, aDSubCl, aDNif;
     aHBlanc, aHClave, aHSubCl, aHNif;
     ;
     NULL, Imprime;
|FIN;

|DEFBUCLE dsmow161_1;
     #dsmow161#1;
     ;
     00000, aDClave, aDSubCl, aDNif;
     99999, aHClave, aHSubCl, aHNif;
     ;
     NULL, Imprime;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     || |MENAV "0000 Recuerde seleccionar el papel de la impresora en Horizontal";

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     informe = "dsmoy088";
     |SI #dsmoy088#1 = "S";
         informe = "dsmoya88";
     |FINSI;
     |INFOR informe;
     |SI FSalida ! 0;
         |MENAV "    No existe Informe";
         |FINIMP;
         |ACABA;
     |FINSI;

     aFichero = ("88" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dsmow161#aFichero#;
     |DELINDEX #dsmow161;

     aDBlanc   = " " * 40;
     aHBlanc   = "z" * 40;
     aDClave   = " ";
     aHClave   = "z";
     aDSubCl   = "  ";
     aHSubCl   = "zz";
     aDNif     = #dsmoy088#17;
     aHNif     = #dsmoy088#18;

     nPeriodo  = 99;
     nModelo   = 190;
     enEjer    = #dsmoy088#2;
     aAlfa2    = #dsmoy088#2;
     aAlfa1    = "01.01." + aAlfa2;
     aAlfa2    = "31.12." + aAlfa2;
     efDFecha  = aAlfa1;     efHFecha  = aAlfa2;
     eaTituloL = #dsmoy088#34;

     nAlgo = 0;
     |SI #dsmoy088#3 ! 0;
         nDEmpresa = #dsmoy088#3;
         nHEmpresa = #dsmoy088#4;
         |BUCLE agifigen;
     |SINO;
         |PARA nCampo = 5;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |SI #dsmoy088#nCampo# ! 0;
                   nDEmpresa = #dsmoy088#nCampo#;
                   nHEmpresa = #dsmoy088#nCampo#;
                   |BUCLE agifigen;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nAlgo = 1;
         aNif     = "";
         nEmpresa = 0;
         nAlgo    = 0;
         nHay     = 0;
         |SI #dsmoy088#29 = 1;
             |SI #dsmoy088#24 = "N";
                 |BUCLE dsmow161_1;
             |SINO;
                  |SI #dsmoy088#25 = 1; |BUCLE dsmow161_1; |FINSI;
                  |SI #dsmoy088#25 = 2; |BUCLE dsmow161_3; |FINSI;
             |FINSI;
         |FINSI;

         |SI #dsmoy088#29 = 2;
             |SI #dsmoy088#24 = "N";
                 |BUCLE dsmow161_2;
             |SINO;
                 |SI #dsmoy088#25 = 1; |BUCLE dsmow161_2; |FINSI;
                 |SI #dsmoy088#25 = 2; |BUCLE dsmow161_4; |FINSI;
             |FINSI;
         |FINSI;

         |SI nEmpresa ! 0; |Y nHay ! 0;  |PIEINF;  |FINSI;
     |FINSI;

     |SI nAlgo = 0;
         |MENAV "    Seleccion vacia";
     |FINSI;

     |FININF;
     |FINIMP;
|FPRC;

|PROCESO Baja73;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = "";
     #dsmom073#2 = "";
|FPRC;

|PROCESO Alta73;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = "z";
     #dsmom073#2 = "zz";
|FPRC;

|PROCESO T66; |TIPO 66;
     |SI Campo = 30;  |O Campo = 31;
         nCampo1 = 30;
         nCampo2 = 31;
     |FINSI;

     |SI Campo = 32;  |O Campo = 33;
         nCampo1 = 32;
         nCampo2 = 33;
     |FINSI;

     |SI Campo = 34;  |O Campo = 35;
         nCampo1 = 34;
         nCampo2 = 35;
     |FINSI;

     |SI Campo = 36;  |O Campo = 37;
         nCampo1 = 36;
         nCampo2 = 37;
     |FINSI;

     enEjerIRPF = #dsmoy088#2;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #dsmoy088#nCampo1#;
     #dsmom073#2 = #dsmoy088#nCampo2#;
     |LEE 000#dsmom073.];

     |CONSULTA_F_CLAVE #1#dsmom073, Baja73, Alta73;
     |SI FSalida = 0;
          #dsmoy088#nCampo1# = #dsmom073#1;    |PINTA #dsmoy088#nCampo1#;
          #dsmoy088#nCampo2# = #dsmom073#2;    |PINTA #dsmoy088#nCampo2#;
     |FINSI;
     |CIERRA #dsmom073;

     |ERROR;
|FPRC;

|PROCESO T0; |TIPO 0;
     nCampo1 = Campo - 1;
     nCampo2 = Campo;

     |SI #dsmoy088#nCampo1# = " ";  |Y #dsmoy088#nCampo2# = "  ";
         |ACABA;
     |FINSI;

     enEjerIRPF = #dsmoy088#2;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #dsmoy088#nCampo1#;
     #dsmom073#2 = #dsmoy088#nCampo2#;
     |LEE 000#dsmom073.=;
     |SI FSalida ! 0;
         aAlfa = "0000Clave no correcta en el ejercicio " + enEjerIRPF;
         |MENAV aAlfa;
         |ERROR;
     |FINSI;
     |CIERRA #dsmom073;
|FPRC;
