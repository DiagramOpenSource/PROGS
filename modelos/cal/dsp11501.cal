|FICHEROS;
     dsmozpas #0;
     dsmom002 #2;
     dsmom004 #4;
     dsmom008 #8;
     dsmom030 #30;
     dsmoc115 #100;

     :/contagen/def/canempre #101;
     :/contagen/def/camaniva #102;
     :/contagen/def/caivalin #103;
     :/contagen/def/caivaasi #104;
     :/basica/def/agicen17   #117;

     dsmc115@ #900;
     dsmow013 #999;
     espejo1@ #1300;
|FIN;

|VARIABLES;
     aTodoCero="";
     aNombreTrabajador="";
     aCadena="";
     nMesLugar=0;
     nSalida=0;
     fFechaCamaniva=@;
     nImporteBaseI=0;
     nPorcentaje=0;
     nImporteRetencion=0;
     aEspecie="";
     aDni="";
     aDn="            ";
     aHn="zzzzzzzzzzzz";

     aAlfa          = "";
     aPathModelo    = "";
     aDef           = "";
     aTipo          = "";

     nEjer          = 0;
     nDPeriodo      = 0;
     nHPeriodo      = 0;
     nCampo1        = 0;
     nCampo11       = 0;
     nCampo2        = 0;
     nCampo22       = 0;
     nCampo3        = 0;
     nCampo33       = 0;
     nSwEsta        = 0;
     nGrupo         = 0;
     nSubGrupo      = 0;
     nDepar         = 0;
     nBaseImpo      = 0;
     nPorce         = 0;
     nCuota         = 0;
     nPeriodo       = 0;
     nModelo        = 0;
     nSwPasa        = 0;
     nDComplem      = 0;
     nHComplem      = 0;
     nAnyo          = 0;
     nCampo         = 0;

     nPara1    = 0;
     nRegistro = 0;
     nNumero   = 0;
     aAlfa1    = "";
     aAlfa2    = "";
     nCodSubdep = 0;
     nActividad = 0;
     &eaCodSubdep = "";
     aDRef        = "";
     aHRef        = "";
|FIN;

|INCLUYE i_variar;

|| ////////////////////////////////////////////////
|PROCESO Regis2015;
     nNumero = 0;
     #100#0 = #1300#0;
     #100#1 = #1300#1;
     #100#2 = #999#3;
     #100#3 = #1300#3;
     #100#4 = #999#9;
     #100#5 = #1300#5;
     #100#6 = #1300#6;
     #100#7 = #1300#7;
     #100#28 = 99;
     |LEE 041#100];
     |SI FSalida = 0;
         |LEE 041#100a;
     |SINO;
         |LEE 041#100u;
     |FINSI;
     |SI #100#0 = #1300#0; |Y #100#1 = #1300#1; |Y #100#2 = #999#3;
         |Y #100#3 = #1300#3; |Y #100#4 = #999#9; |Y  #100#5 = #1300#5;
            |Y #100#6 = #1300#6; |Y #100#7 = #1300#7;
                nNumero = #100#28;
     |FINSI;
     nRegistro = nNumero + 1;
|FPRC;

|PROCESO IgualaCampos115;
       #100#43 = #117#1;
       #100#42 = #117#2;
       #100#29 = #117#3;
       #100#30 = #117#6;
       #100#31 = #117#7;
       #100#32 = #117#8;
       #100#33 = #117#9;
       #100#34 = #117#10;
       #100#35 = #117#11;
       #100#36 = #117#12;
       #100#37 = #117#13;
       #100#38 = #117#14;
       #100#39 = #117#15;
       #100#40 = #117#17;
       #100#41 = #117#18;
|FPRC;

|PROCESO PonDatos115;
     |SI enEjer ] 2015;
         |ABRE #117;
         |DDEFECTO #117;
         #117#0 = #100#0;
         #117#1 = #100#43;
         #117#2 = #100#42;
         |LEE 040#117=;
         |SI FSalida = 0;
             |HAZ IgualaCampos115;
         |FINSI;
         |CIERRA #117;
     |FINSI;
|FPRC;

|PROCESO Encuentra115;
   |SI #900#42 = nCodSubdep; |Y #900#43 = nActividad;
       nRegistro = #900#28;
       nNumero   = 1;
   |FINSI;
|FPRC;

|DEFBUCLE PorDepSub115;
   #dsmc115@#1009;
   ;
   enEmpresa, enEjer, enPeriodo, enModelo, enComplem, enActividad, aDni, 0, 01;
   enEmpresa, enEjer, enPeriodo, enModelo, enComplem, enActividad, aDni, 0, 99;
   e;
   NULL, Encuentra115;
|FIN;

|PROCESO BuscaRegistro115;

     nNumero   = 0;
     nRegistro = 1;

     |SI enEjer ] 2015;
         |BUCLE PorDepSub115;

         |SI nNumero = 0;
             |ABRE #900;
             #900#0 = enEmpresa;
             #900#1 = enEjer;
             #900#2 = enPeriodo;
             #900#3 = enModelo;
             #900#4 = enComplem;
             #900#5 = enActividad;
             #900#6 = aDni;
             #900#7 = 0;
             #900#28 = 99;
             |LEE 041#900];
             |SI FSalida = 0;
                 |LEE 041#900a;
             |SINO;
                 |LEE 041#900u;
             |FINSI;
             |SI FSalida = 0; |Y #900#0 = enEmpresa; |Y #900#1 = enEjer; |Y #900#2 = enPeriodo;
                |Y #900#3 = enModelo; |Y #900#4 = enComplem; |Y  #900#5 = enActividad;
                   aAlfa1 = #900#6;   |QBF aAlfa1;
                   aAlfa2 = aDni;     |QBF aAlfa2;
                   |SI aAlfa1 = aAlfa2; |Y #900#7 = 0;
                       nNumero = #900#28;
                   |FINSI;
             |FINSI;
             nRegistro = nNumero + 1;
             |CIERRA #900;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO MiraCampos115;
     aTodoCero="S";
     |PARA nCampo1 = 8;  |SI nCampo1 [ 25;  |HACIENDO nCampo1 = nCampo1 + 1;
          |SI #100nCampo1!0;
               aTodoCero="N";
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Grabadsmoc115;
     |HAZ BuscaRegistro115;

     |DDEFECTO #100;
     #100#0 = enEmpresa;
     #100#1 = enEjer;
     #100#2 = enPeriodo;
     #100#3 = enModelo;
     #100#4 = enComplem;
     #100#5 = enActividad;
     #100#6 = aDni;
     #100#7 = 0;
     #100#28 = nRegistro;
     |LEE 000#100=;
     nSalida=FSalida;

     |SI #104#46 ! "T";
          |SI aEspecie="N";
               #100#8=#100#8+nImporteBaseI;
               #100#10=#100#10+nImporteRetencion;
               nPorcentaje=(#100#10/#100#8)*100;
               #100#9=nPorcentaje;
          |SINO;
               #100#11=#100#11+nImporteBaseI;
               #100#13=#100#13+nImporteRetencion;
               nPorcentaje=(#100#13/#100#11)*100;
               #100#12=nPorcentaje;
          |FINSI;
     |SINO;
          |SI aEspecie="N";
               |SI nMesLugar=1;|O nMesLugar=4; |O nMesLugar=7; |O nMesLugar=10;
                    #100#8=#100#8+nImporteBaseI;
                    #100#10=#100#10+nImporteRetencion;
                    nPorcentaje=(#100#10/#100#8)*100;
                    #100#9=nPorcentaje;
               |FINSI;
               |SI nMesLugar=2;|O nMesLugar=5; |O nMesLugar=8; |O nMesLugar=11;
                    #100#14=#100#14+nImporteBaseI;
                    #100#16=#100#16+nImporteRetencion;
                    nPorcentaje=(#100#16/#100#14)*100;
                    #100#15=nPorcentaje;
               |FINSI;
               |SI nMesLugar=3;|O nMesLugar=6; |O nMesLugar=9; |O nMesLugar=12;
                    #100#20=#100#20+nImporteBaseI;
                    #100#22=#100#22+nImporteRetencion;
                    nPorcentaje=(#100#22/#100#20)*100;
                    #100#21=nPorcentaje;
               |FINSI;
          |SINO;
               |SI nMesLugar=1;|O nMesLugar=4; |O nMesLugar=7; |O nMesLugar=10;
                    #100#11=#100#11+nImporteBaseI;
                    #100#13=#100#13+nImporteRetencion;
                    nPorcentaje=(#100#13/#100#11)*100;
                    #100#12=nPorcentaje;
               |FINSI;
               |SI nMesLugar=2;|O nMesLugar=5; |O nMesLugar=8; |O nMesLugar=11;
                    #100#17=#100#17+nImporteBaseI;
                    #100#19=#100#19+nImporteRetencion;
                    nPorcentaje=(#100#19/#100#17)*100;
                    #100#18=nPorcentaje;
               |FINSI;
               |SI nMesLugar=3;|O nMesLugar=6; |O nMesLugar=9; |O nMesLugar=12;
                    #100#23=#100#23+nImporteBaseI;
                    #100#25=#100#25+nImporteRetencion;
                    nPorcentaje=(#100#25/#100#23)*100;
                    #100#24=nPorcentaje;
               |FINSI;
          |FINSI;
     |FINSI;

     #100#26 = aNombreTrabajador;
     |SI enEjer ] 2015;
         #100#42 = nCodSubdep;
         #100#43 = nActividad;
     |FINSI;

     |SI nSalida=0;
          |GRABA 020#100a;
     |SINO;
          |HAZ PonDatos115;
          |GRABA 020#100n;
     |FINSI;
|FPRC;

|PROCESO LeeLinea115;
     #30#0=#103#18;
     |LEE 000#30=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI #30#5  ! "S";  |ACABA;  |FINSI;
     |SI #30#38 ! 180;  |ACABA;  |FINSI;

     aDni              = #102#14;
     aNombreTrabajador = #102#13;

     nRegistro = 1;
     |SI aMulDep = "S";
         nActividad  = #103#30;
         eaCodSubdep = #103#31;
     |SINO;
         nActividad  = #102#10;
         eaCodSubdep = #102#11;
     |FINSI;
     nCodSubdep = eaCodSubdep;

     nImporteBaseI     = (#103#20 / enConversor) ! EURODBMOD;
     nPorcentaje       = #103#21;
     nImporteRetencion = (#103#22 / enConversor) ! EURODBMOD;

     fFechaCamaniva    = #102#8;
     aCadena           = fFechaCamaniva % 402;
     nMesLugar         = aCadena;

     aEspecie          = #103#26;

     |SI nImporteBaseI ! 0; |O nImporteRetencion ! 0;
          |HAZ Grabadsmoc115;
     |FINSI;
|FPRC;

|DEFBUCLE caivalin115;
     #103#1;
     ;
     #102#0, #102#1, 01;
     #102#0, #102#1, 99;
     ;
     NULL, LeeLinea115;
|FIN;

|PROCESO LeeCabecera115;
     |BUCLE caivalin115;
     |LIBERA #102;
|FPRC;

|DEFBUCLE camaniva115;
     #102#1;
     5;
     00, 0000000000, nDPeriodo;
     99, 9999999999, nHPeriodo;
     be;
     NULL, LeeCabecera115;
|FIN;

|PROCESO Compensa115_2015;
     |SELECT #3#100;
     #100#0 = #1300#0;
     #100#1 = #1300#1;
     #100#2 = #999#3;
     #100#3 = #1300#3;
     #100#4 = #999#9;
     #100#5 = #1300#5;
     #100#6 = #1300#6;
     #100#7 = #1300#7;
     #100#43 = #1300#43;
     #100#42 = #1300#42;
     #100#29 = #1300#29;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |SELECT #1#100;
         |HAZ Regis2015;
         |DDEFECTO #100;
         #100#0 = #1300#0;
         #100#1 = #1300#1;
         #100#2 = #999#3;
         #100#3 = #1300#3;
         #100#4 = #999#9;
         #100#5 = #1300#5;
         #100#6 = #1300#6;
         #100#7 = #1300#7;
         #100#26 = #1300#26;
         #100#28 = nRegistro;
         |PARA nPara1 = 29; |SI nPara1 [ 43; |HACIENDO nPara1 = nPara1 + 1;
               #100nPara1 = #1300nPara1;
         |SIGUE;
         |GRABA 020#100b;
     |SINO;
         nRegistro = #100#28;
     |FINSI;

     #100#8      = #100#8  - #1300#8;
     #100#10     = #100#10 - #1300#10;
     nPorcentaje = (#100#10 / #100#8) * 100;
     #100#9      = nPorcentaje;

     #100#11     = #100#11 - #1300#11;
     #100#13     = #100#13 - #1300#13;
     nPorcentaje = (#100#13 / #100#11) * 100;
     #100#12     = nPorcentaje;

     #100#14     = #100#14 - #1300#14;
     #100#16     = #100#16 - #1300#16;
     nPorcentaje = (#100#16 / #100#14) * 100;
     #100#15     = nPorcentaje;

     #100#17     = #100#17 - #1300#17;
     #100#19     = #100#19 - #1300#19;
     nPorcentaje = (#100#19 / #100#17) * 100;
     #100#18     = nPorcentaje;

     #100#20     = #100#20 - #1300#20;
     #100#22     = #100#22 - #1300#22;
     nPorcentaje = (#100#22 / #100#20) * 100;
     #100#21     = nPorcentaje;

     #100#23     = #100#23-#1300#23;
     #100#25     = #100#25-#1300#25;
     nPorcentaje = (#100#25 / #100#23) * 100;
     #100#24     = nPorcentaje;

     |GRABA 020#100a;
     |LIBERA #100;

     |HAZ MiraCampos115;  || mira si son todos = 0 o no
     |SI aTodoCero="S";
         |BORRA 020#100a;
     |FINSI;
|FPRC;

|PROCESO Compensa115;
     #100#0 = #1300#0;
     #100#1 = #1300#1;
     #100#2 = #999#3;
     #100#3 = #1300#3;
     #100#4 = #999#9;
     #100#5 = #1300#5;
     #100#6 = #1300#6;
     #100#7 = #1300#7;
     #100#28 = #1300#28;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0 = #1300#0;
         #100#1 = #1300#1;
         #100#2 = #999#3;
         #100#3 = #1300#3;
         #100#4 = #999#9;
         #100#5 = #1300#5;
         #100#6 = #1300#6;
         #100#7 = #1300#7;
         #100#28 = #1300#28;
         #100#26 = #1300#26;
         |GRABA 020#100b;
     |FINSI;

     #100#8      = #100#8  - #1300#8;
     #100#10     = #100#10 - #1300#10;
     nPorcentaje = (#100#10 / #100#8) * 100;
     #100#9      = nPorcentaje;

     #100#11     = #100#11 - #1300#11;
     #100#13     = #100#13 - #1300#13;
     nPorcentaje = (#100#13 / #100#11) * 100;
     #100#12     = nPorcentaje;

     #100#14     = #100#14 - #1300#14;
     #100#16     = #100#16 - #1300#16;
     nPorcentaje = (#100#16 / #100#14) * 100;
     #100#15     = nPorcentaje;

     #100#17     = #100#17 - #1300#17;
     #100#19     = #100#19 - #1300#19;
     nPorcentaje = (#100#19 / #100#17) * 100;
     #100#18     = nPorcentaje;

     #100#20     = #100#20 - #1300#20;
     #100#22     = #100#22 - #1300#22;
     nPorcentaje = (#100#22 / #100#20) * 100;
     #100#21     = nPorcentaje;

     #100#23     = #100#23-#1300#23;
     #100#25     = #100#25-#1300#25;
     nPorcentaje = (#100#25 / #100#23) * 100;
     #100#24     = nPorcentaje;

     |GRABA 020#100a;
     |LIBERA #100;

     |HAZ MiraCampos115;  || mira si son todos = 0 o no
     |SI aTodoCero="S";
         |BORRA 020#100a;
     |FINSI;
|FPRC;

|DEFBUCLE Bdsmoc115;
     #1300#1009;
     ;
     #999#0, #999#2, nPeriodo, 115, nDComplem, #999#1, aDn, 0,    01;
     #999#0, #999#2, nPeriodo, 115, nHComplem, #999#1, aHn, 9999, 99;
     ;
     NULL, Compensa115;
|FIN;

|DEFBUCLE Bdsmoc115_2015;
     #1300#3011;
     ;
     #999#0, #999#2, nPeriodo, 115, nDComplem, #999#1, aDn, 0,    00, 000, aDRef;
     #999#0, #999#2, nPeriodo, 115, nHComplem, #999#1, aHn, 9999, 99, 999, aHRef;
     ;
     NULL, Compensa115_2015;
|FIN;

|PROCESO Anterior115;
     |PARA nCampo = 0;  |SI nCampo [ 43;  |HACIENDO nCampo = nCampo + 1;
           #100nCampo = #1300nCampo;
     |SIGUE;
     #100#1 = #999#2;
     #100#2 = #999#3;
     #100#4 = #999#9;

     |SI #999#1 = 99;
         |PARA nCampo = 8;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
               #100nCampo = 0;
         |SIGUE;
         #100#27 = 0;
     |FINSI;

     |GRABA 020#100n;
     |LIBERA #100;
|FPRC;

|DEFBUCLE dsmoc115A;
     #1300#1009;
     ;
     #999#0, nAnyo, nPeriodo, 115, nDComplem, #999#1, aDn, 0,    01;
     #999#0, nAnyo, nPeriodo, 115, nHComplem, #999#1, aHn, 9999, 99;
     ;
     NULL, Anterior115;
|FIN;

|PROCESO dsmom002_115;
     |ERROR10;
|FPRC;

|DEFBUCLE dsmom002_115;
     #2#1;
     ;
     #999#0,  1, 115;
     #999#0, 98, 115;
     ;
     NULL, dsmom002_115;
|FIN;

|PROCESO PaseAnterior115;
     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/dsmoc115.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BUCLE dsmom002_115;

     |SI FSalida ! 0;  |O #2#0 ! #999#0;  |O #2#2 ! 115;
         |DDEFECTO #2;
     |FINSI;

     nAnyo = #999#2;
     |SI #2#7 = "TRIMESTRAL";
         |SI #999#3 = 3;
             nAnyo = #999#2 - 1;
             nPeriodo = 12;
         |SINO;
             nPeriodo = #999#3 - 3;
         |FINSI;
     |SINO;
         |SI #999#3 = 1;
             nAnyo = #999#2 - 1;
             nPeriodo = 12;
         |SINO;
             nPeriodo = #999#3 - 1;
         |FINSI;
     |FINSI;

     nHComplem = enComplem;
     nDComplem = -1;
     |ABRE #1300;
     |DDEFECTO #1300;
     #1300#0 = #999#0;
     #1300#1 = nAnyo;
     #1300#2 = nPeriodo
     #1300#3 = 115;
     #1300#4 = 99;
     |LEE 040#1300];
     |SI FSalida = 0;
         |LEE 040#1300a;
     |SINO;
         |LEE 040#1300u;
     |FINSI;
     |SI FSalida = 0; |Y #1300#0 = #999#0; |Y #1300#1 = nAnyo;
         |Y #1300#2 = nPeriodo; |Y #1300#3 = 115;
             nDComplem = #1300#4;
             nHComplem = #1300#4;
     |FINSI;
     |CIERRA #1300;

     |SI nDComplem ] 0;
         |ABRE #100;
         |BUCLE dsmoc115A;
         |CIERRA #100;
     |FINSI;

     |DESCARGA_DEF #espejo1@;

     enSaldo1Ch    = 0;
     enSaldo2Ch    = 0;
     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #999#9;
     enActividad   = #999#1;
     enTipoEntrada = 98;
     eaNombreAct   = #999#6;
     |SUB_EJECUTA_NP "dsmoc115";

     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = #999#9;
     |LEE 101#4=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         #4#9 = " ";
         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO Pase115;
     || borrar dsmoc115 y dsmod115
     aDRef = " " * 25;
     aHRef = "z" * 25;

     |DDEFECTO #8;
     |ABRE #8;
     #8#0 = #999#0;
     #8#1 = #999#2;
     #8#2 = #999#3;
     #8#3 = #999#7;
     #8#4 = #999#9;
     #8#5 = #999#1;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS";
         |GRABA 020#8a;

         enEmpresa     = #8#0;
         enEjer        = #8#1;
         enPeriodo     = #8#2;
         enModelo      = #8#3;
         enComplem     = #8#4;
         enActividad   = #8#5;
         enTipoEntrada = 97;
         |SUB_EJECUTA_NP "dsmoc115";
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;

     |SI enAnterior = 1;         || Recogida de un Periodo Anterior
         |HAZ PaseAnterior115;

         |ACABA;
     |FINSI;

     enEmpresa = #999#0;
     enEjer    = #999#2;
     enSwOpPar = 0;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         aAlfa = #999#2;
         aAlfa = aAlfa % -102;
         nEjer = aAlfa;

         |ABRE #101;
         |SELECT #4#101;
         #101#2  = #999#0;
         #101#26 = nEjer;
         |LEE 040#101=;
         |SI FSalida ! 0;  |CIERRA #101;  |ACABA;   |FINSI;
         |CIERRA #101;

          |DBASS aPathConta;   |QBT aPathConta;
          aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";

          enEmpresa  = #101#2;
          enPerConta = #101#3;
          eaLaMonEmp = #101#28;
      |SINO;
          enPerConta = enPeriodoPar;
          eaLaMonEmp = "E";
      |FINSI;
      |HAZ EnConversor;


     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;

     |ABRE #104;
     |LEE 040#104p;
     |SI FSalida ! 0;  |DDEFECTO #104;  |FINSI;
     aMulDep = #104#132;
     |CIERRA #104;

     |SI #104#46 = "T";
         |SI enEjer [ 2009;
             |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SINO;
             |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
             |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
             |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
         |FINSI;
     |SINO;
         |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
         |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
         |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
         |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
         |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
         |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
         |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
         |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
         |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
         |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
     |FINSI;

     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/dsmoc115.mas";
     |CARGA_DEF aDef, dsmc115@;

     |ABRE #30;
     |ABRE #100;
     |BUCLE camaniva115;
     |CIERRA #30;

     |SI enSwPartido = 1;
         enSwOpPar   = 2;
         |HAZ FinalPartido;
     |FINSI;

     |DESCARGA_DEF #dsmc115@;

     |SI #999#3 ! 1;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc115.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida = 0;
             nHComplem = enComplem;

             |PARA nPeriodo = 1;  |SI nPeriodo < #999#3;  |HACIENDO nPeriodo = nPeriodo + 1;
                   nDComplem = -1;
                   |ABRE #1300;
                   |DDEFECTO #1300;
                   #1300#0 = #999#0;
                   #1300#1 = #999#2;
                   #1300#2 = nPeriodo
                   #1300#3 = 115;
                   #1300#4 = 99;
                   |LEE 040#1300];
                   |SI FSalida = 0;
                       |LEE 040#1300a;
                   |SINO;
                       |LEE 040#1300u;
                   |FINSI;
                   |SI FSalida = 0; |Y #1300#0 = #999#0; |Y #1300#1 = #999#2;
                    |Y #1300#2 = nPeriodo; |Y #1300#3 = 115;
                       nDComplem = #1300#4;
                       nHComplem = #1300#4;
                   |FINSI;
                   |CIERRA #1300;

                   |SI nDComplem ] 0;
                       |SI enEjer ] 2015;
                           |BUCLE Bdsmoc115_2015;
                       |SINO;
                           |BUCLE Bdsmoc115;
                       |FINSI;
                   |FINSI;
             |SIGUE;

             /*                         || Quitado tiquet 3237 / 892
             |SI #999#9 ! 0;
                 nDComplem = 0;
                 nHComplem = enComplem - 1;
                 nPeriodo  = #999#3;
                 |BUCLE Bdsmoc115;
             |FINSI;
             */
         |FINSI;
         |DESCARGA_DEF #espejo1@;
     |FINSI;
     |CIERRA #100;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #999#9;
     enActividad   = #999#1;
     enTipoEntrada = 98;
     eaNombreAct   = #999#6;
     |SUB_EJECUTA_NP "dsmoc115";

     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = #999#9;
     |LEE 101#4=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         #4#9 = " ";
         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;

     |SI #4#7 = "X"; |Y enSwCheqPase = 1;
         enOperaCh  = 1;
         |HAZ GrabaAux151;
     |FINSI;
|FPRC;
