|FICHEROS;
     dsmoy000;

     dsmom001;
     dsmom004;
     dsmom008;
     dsmom023;
     dsmom024;
     dsmom101;
     dsmom102;

     dsmox005;
     dsmox006;
     dsmox007;

     :integral/dsam0108;

     :/basica/def/agicen14;
     :/basica/def/agitab99;

     dsmow014;
     dsmom107;            || control Modelos

     &clientes@;
|FIN;

|VARIABLES;
      nMes      = 0;
      nAnyo     = 0;
      nSwIm     = 0;
      nDComple  = 0;
      nHComple  = 0;
      nSwUno    = 0;
      nModelo   = 0;
      aComproba = "";
      aContinua = "";
      nEmpresa  = 0;

      aBase     = "";

     &enPeriodo = 0;
     &enEjer    = 0;
     &eaElProm  = "dsmoy000";
     &enComplem = 0;
     &aCoBien   = "";

     &eaMensaCad       = "";
     &enErrorCad       = 0;
     &enError15        = 0;
|FIN;

|INCLUYE i_varemi;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO MiraVarMoneda;
     nTecla = FSalida;
     |HAZ PintaMoneda;

     #dsmoy000#37 = eaMoneda;
     |SI #dsmoy000#37 = "PESETAS";
         |SI #dsmoy000#0 = 180;  |O #dsmoy000#0 = 190;  |O #dsmoy000#0 = 390;  |O #dsmoy000#0 = 392;
          |O #dsmoy000#0 = 184;  |O #dsmoy000#0 = 193;  |O #dsmoy000#0 = 296;
             |MENAV "     Moneda incorrecta. Debe ser EUROS.";
             |ERROR;
         |FINSI;
         |SI #dsmoy000#6 ] 2002;
             |SI #dsmoy000#0 = 110;  |O #dsmoy000#0 = 115;  |O #dsmoy000#0 = 130;  |O #dsmoy000#0 = 131;
              |O #dsmoy000#0 = 300;  |O #dsmoy000#0 = 310;  |O #dsmoy000#0 = 311;
                 |MENAV "     Moneda incorrecta. Debe ser EUROS.";
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;
     |PINTA #dsmoy000#37;
     FSalida =  nTecla;
|FPRC;

|PROCESO Periodo;
     |SI #dsmoy000#4 = 1;   #dsmoy000#5 = "ENERO     ";  |FINSI;
     |SI #dsmoy000#4 = 2;   #dsmoy000#5 = "FEBRERO   ";  |FINSI;
     |SI #dsmoy000#4 = 3;   #dsmoy000#5 = "MARZO     ";  |FINSI;
     |SI #dsmoy000#4 = 4;   #dsmoy000#5 = "ABRIL     ";  |FINSI;
     |SI #dsmoy000#4 = 5;   #dsmoy000#5 = "MAYO      ";  |FINSI;
     |SI #dsmoy000#4 = 6;   #dsmoy000#5 = "JUNIO     ";  |FINSI;
     |SI #dsmoy000#4 = 7;   #dsmoy000#5 = "JULIO     ";  |FINSI;
     |SI #dsmoy000#4 = 8;   #dsmoy000#5 = "AGOSTO    ";  |FINSI;
     |SI #dsmoy000#4 = 9;   #dsmoy000#5 = "SEPTIEMBRE";  |FINSI;
     |SI #dsmoy000#4 = 10;  #dsmoy000#5 = "OCTUBRE   ";  |FINSI;
     |SI #dsmoy000#4 = 11;  #dsmoy000#5 = "NOVIEMBRE ";  |FINSI;
     |SI #dsmoy000#4 = 12;  #dsmoy000#5 = "DICIEMBRE ";  |FINSI;
     |SI #dsmoy000#4 = 99;  #dsmoy000#5 = "ANUAL     ";  |FINSI;

     |SI aComproba ! "C";  |PINTA #dsmoy000#5;  |FINSI;
     |SI aComproba = "C";  |PINTA #dsmoy000#39;  |FINSI;
     |PINTA #dsmoy000#6;
|FPRC;

|PROCESO LeeModelo;
     |SI eaParametro = "311";  |O eaParametro = "311C";
      |O eaParametro = "371";  |O eaParametro = "371C";
         |ACABA;
     |FINSI;

     |ABRE #agitab99;
     #agitab99#0 = #dsmoy000#0;
     |LEE 040#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;
     |CIERRA #agitab99;

     |SI #dsmoy000#0 = 180;  |O #dsmoy000#0 = 190;  |O #dsmoy000#0 = 390;  |O #dsmoy000#0 = 392;
      |O #dsmoy000#0 = 184;  |O #dsmoy000#0 = 193;  |O #dsmoy000#0 = 296;  |O #dsmoy000#0 = 187;
         #agitab99#4 = "S";
     |FINSI;

     |SI #agitab99#4 = "N";
         |MENAV "     Modelo sin Activar.";
         |ERROR;
     |FINSI;

     |SI aComproba ! "C";
         |C_M #dsmoy000#40, 1, "S";
     |FINSI;

     #dsmoy000#4 = 0;
     |SI #dsmoy000#0 = 180;  #dsmoy000#4 = 99;  |C_M #dsmoy000#40, 1, "N";  #dsmoy000#40 = "T";  |FINSI;
     |SI #dsmoy000#0 = 184;  #dsmoy000#4 = 99;  |C_M #dsmoy000#40, 1, "N";  #dsmoy000#40 = "T";  |FINSI;
     |SI #dsmoy000#0 = 187;  #dsmoy000#4 = 99;  |C_M #dsmoy000#40, 1, "N";  #dsmoy000#40 = "T";  |FINSI;
     |SI #dsmoy000#0 = 190;  #dsmoy000#4 = 99;  |C_M #dsmoy000#40, 1, "N";  #dsmoy000#40 = "T";  |FINSI;
     |SI #dsmoy000#0 = 193;  #dsmoy000#4 = 99;  |C_M #dsmoy000#40, 1, "N";  #dsmoy000#40 = "T";  |FINSI;
     |SI #dsmoy000#0 = 296;  #dsmoy000#4 = 99;  |C_M #dsmoy000#40, 1, "N";  #dsmoy000#40 = "T";  |FINSI;
     |SI #dsmoy000#0 = 390;  #dsmoy000#4 = 99;  |C_M #dsmoy000#40, 1, "N";  #dsmoy000#40 = "T";  |FINSI;
     |SI #dsmoy000#0 = 392;  #dsmoy000#4 = 99;  |C_M #dsmoy000#40, 1, "N";  #dsmoy000#40 = "T";  |FINSI;
     |SI #dsmoy000#0 = 347;  #dsmoy000#4 = 99;  |C_M #dsmoy000#40, 1, "N";  #dsmoy000#40 = "T";  |FINSI;
     |SI #dsmoy000#0 = 349;              |C_M #dsmoy000#40, 1, "N";  #dsmoy000#40 = "T";  |FINSI;

     |PINTA #dsmoy000#40;

     #dsmoy000#39 = #dsmoy000#4;

     |SI #dsmoy000#0 = 309; |O #dsmoy000#0 = 45; |O #dsmoy000#0 = 720; |O #dsmoy000#0 = 583; |O #dsmoy000#0 = 182;
         |MENAV "    Modelo no Periodico, entre por su emision";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Modelo;
     |HAZ LeeModelo;

     fFecha = ~;
     aAlfa  = fFecha % -104;
     #dsmoy000#6   = aAlfa;
     |SI #dsmoy000#4 = 99;
          #dsmoy000#6   = #dsmoy000#6  - 1;
     |FINSI;

     |SI #dsmoy000#4 = 99;
         |C_M #dsmoy000#4, 1, "N";
         |PINTA #dsmoy000#4;
         |HAZ Periodo;
     |SINO;
         fFecha = ~;
         aAlfa  = fFecha % 402;   nMes  = aAlfa;
         aAlfa  = fFecha % -104;  nAnyo = aAlfa;
         |SI #agitab99#5 = "T";  |O #agitab99#5 = "C";
             |SI nMes [ 3;
                 #dsmoy000#4  = 12;
                 #dsmoy000#39 = 12;
                 #dsmoy000#6 = nAnyo - 1;
                 |HAZ Periodo;
                 |PINTA #dsmoy000#4;
                 |PINTA #dsmoy000#6;
                 |ACABA;
             |FINSI;

             |SI nMes [ 6;
                 #dsmoy000#4  = 3;
                 #dsmoy000#39 = 3;
                 #dsmoy000#6  = nAnyo;
                 |HAZ Periodo;
                 |PINTA #dsmoy000#4;
                 |PINTA #dsmoy000#6;
                 |ACABA;
             |FINSI;

             |SI nMes [ 9;
                 #dsmoy000#4  = 6;
                 #dsmoy000#39 = 6;
                 #dsmoy000#6  = nAnyo;
                 |HAZ Periodo;
                 |PINTA #dsmoy000#4;
                 |PINTA #dsmoy000#6;
                 |ACABA;
             |FINSI;

             |SI nMes [ 12;
                 #dsmoy000#4  = 9;
                 #dsmoy000#39 = 9;
                 #dsmoy000#6  = nAnyo;
                 |HAZ Periodo;
                 |PINTA #dsmoy000#4;
                 |PINTA #dsmoy000#6;
                 |ACABA;
             |FINSI;
         |FINSI;

         |SI #agitab99#5 = "A";
             #dsmoy000#4  = 99;
             #dsmoy000#39 = 99;
             #dsmoy000#6  = nAnyo - 1;
             |HAZ Periodo;
             |PINTA #dsmoy000#4;
             |PINTA #dsmoy000#6;
         |FINSI;

         |SI #agitab99#5 = "M";
             |SI nMes = 1;
                 #dsmoy000#4  = 12;
                 #dsmoy000#39 = 12;
                 #dsmoy000#6  = nAnyo - 1;
                 |HAZ Periodo;
             |SINO;
                 #dsmoy000#4  = nMes - 1;
                 #dsmoy000#39 = nMes - 1;
                 #dsmoy000#6  = nAnyo;
                 |HAZ Periodo;
             |FINSI;
             |PINTA #dsmoy000#4;
             |PINTA #dsmoy000#6;
         |FINSI;
     |FINSI;

|FPRC;

|PROCESO Planillas;
     |C_M #dsmoy000#36, 1, "S";

     #dsmoy000#10 = 1;      |PINTA #dsmoy000#10;  |C_M #dsmoy000#10, 1, "N";
     #dsmoy000#11 = 99999;  |PINTA #dsmoy000#11;  |C_M #dsmoy000#11, 1, "N";
     |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
          |C_M #dsmoy000#nCampo#, 1, "N";
     |SIGUE;
|FPRC;

|PROCESO Parrilla;
     #dsmoy000#10 = 1;      |PINTA #dsmoy000#10;  |C_M #dsmoy000#10, 1, "N";
     #dsmoy000#11 = 99999;  |PINTA #dsmoy000#11;  |C_M #dsmoy000#11, 1, "N";
     #dsmoy000#36 = 0;  |PINTA #dsmoy000#36;  |C_M #dsmoy000#36, 1, "N";
     |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
          |C_M #dsmoy000#nCampo#, 1, "S";
     |SIGUE;
|FPRC;

|PROCESO DesdeHasta;
     |C_M #dsmoy000#10, 1, "S";
     |C_M #dsmoy000#11, 1, "S";
     #dsmoy000#36 = 0;  |PINTA #dsmoy000#36;  |C_M #dsmoy000#36, 1, "N";

     |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
           |C_M #dsmoy000#nCampo#, 1, "N";
           #dsmoy000#nCampo# = 0;  |PINTA #dsmoy000#nCampo#;
     |SIGUE;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #dsmoy000#Campo# = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               #dsmoy000#nCampo# = 0;  |C_M #dsmoy000#nCampo#, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               |C_M #dsmoy000#nCampo#, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO BotonParrilla;
     |CONTROL_SIMPLE 0, "LBOTON,F2 Seleccion Empresas Desde-Hasta", 2007, 2039, Boton1;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3 Seleccion Empresas Parrilla   ", 2107, 2139, Boton2;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F4 Seleccion por Planillas       ", 2207, 2239, Boton3;
     nBoton3 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  |HAZ DesdeHasta;  |SAL;  |FINSI;
         |SI aTecla = aF3;  |HAZ Parrilla;    |SAL;  |FINSI;
         |SI aTecla = aF4;  |HAZ Planillas;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;

     |PULSATECLA;
|FPRC;

|PROCESO MiraPlanilla;  |TIPO 0;
     |SI #dsmoy000#36 = 0;  |ACABA;  |FINSI;

     |ABRE #dsmom101;
     #dsmom101#0 = #dsmoy000#36;
     |LEE 040#dsmom101.=;
     |SI FSalida ! 0;
         |MENAV "     Registro de Planilla Inexistente.";
         |ERROR;
     |FINSI;
     |CIERRA #dsmom101;
|FPRC;

|PROCESO GrabaTempo;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, 0;
     |SI FSalida ] 0;
         |ABRE #dsam0108;
         #dsam0108#0 = Usuario % 810;
         |LEE 000#dsam0108.=;
         |SI FSalida ! 0;  |DDEFECTO #dsam0108;  |FINSI;
         |CIERRA #dsam0108;

         |SI #dsam0108#4 = "S";
             |SI #dsmom004#26 = "                      ";
                 #dsmom004#9 = " ";
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #dsmom004#9 = "P"; |Y aComproba ! "C"; |Y PARAMETRO ! "INFC";
         |ACABA;
     |FINSI;

     enEmpresaPINET = #dsmom004#0;
     |HAZ RestriccionPINET;
     |SI enErrorPINET = 1;  |ACABA;  |FINSI;

     |SI #dsmoy000#40 = "N";
         |SI #dsmom004#15 > 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dsmoy000#40 = "P";
         |SI #dsmom004#15 [ 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dsmoy000#9 = "N";
         |SI #dsmom004#9 = "X";   |ACABA;  |FINSI;
     |SINO;
         |SI #dsmoy000#9 = "S";  |Y aComproba ! "C";
             |SI #dsmom004#13 = "X";                       |ACABA;  |FINSI;
             |SI #dsmom004#26 ! "                      ";  |ACABA;  |FINSI;
         |FINSI;
     |FINSI;

     nSwEsta = 1;

     |SI #dsmoy000#36 ! 0;
         nSwEsta = 0;
         |ABRE #dsmom102;
         #dsmom102#0 = #dsmoy000#36;
         #dsmom102#1 = #dsmom004#0;
         |LEE 040#dsmom102.=;
         |SI FSalida = 0;
             nSwEsta = 1;
         |FINSI;
         |CIERRA #dsmom102;
     |FINSI;

     |SI #dsmoy000#12 ! 0;
         nSwEsta = 0;
         |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               |SI #dsmoy000#nCampo# = #dsmom004#0;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;  |ACABA;  |FINSI;

     enCodCli = #dsmom004#0;
     |HAZ LeePersona;

     #dsmow014#0  = #dsmom004#0;
     #dsmow014#1  = #dsmom004#1;
     #dsmow014#2  = #dsmom004#2;
     |LEE 101#dsmow014.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow014;
         #dsmow014#0  = #dsmom004#0;
         #dsmow014#1  = #dsmom004#1;
         #dsmow014#2  = #dsmom004#2;
         |GRABA 020#dsmow014.b;
     |FINSI;

     #dsmow014#3  = #clientes@#1;
     #dsmow014#4  = #dsmoy000#5;
     #dsmow014#5  = #dsmoy000#0;
     #dsmow014#6  = "S";
     #dsmow014#7  = #dsmom004#4;
     |GRABA 020#dsmow014.a;
     |LIBERA #dsmow014;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE dsmom004;
     #dsmom004#1;
     7;
     #dsmoy000#10, #dsmoy000#6, #dsmoy000#4,  #dsmoy000#0, nDComple, "X";
     #dsmoy000#11, #dsmoy000#6, #dsmoy000#39, #dsmoy000#0, nHComple, "X";
     ;
     NULL, GrabaTempo;
|FIN;

|PROCESO RelComuneros0;
     #dsmoy000#10 = #dsmom001#3;
     #dsmoy000#11 = #dsmom001#3;
     |ABRE #dsmow014;
     |BUCLE dsmom004;
     |CIERRA #dsmow014;
|FPRC;

|DEFBUCLE RelComuneros;
  #dsmom001#1;
  ;
  enEmpresa, 01, 0001;
  enEmpresa, 99, 9999;
  e;
  NULL, RelComuneros0;
|FIN;


|RUTINA ClaveBaja999;
     #dsmow014#0 = 1;
     #dsmow014#1 = 0000;
     #dsmow014#2 = 00;
|FRUT;

|RUTINA ClaveAlta999;
     #dsmow014#0 = 99999;
     #dsmow014#1 = 9999;
     #dsmow014#2 = 99;
|FRUT;

|PROCESO MiraCuantos;
     enSwHay = enSwHay + 1;
|FPRC;

|DEFBUCLE dsmow014M;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, MiraCuantos;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |SI aComproba ! "C";
         #dsmoy000#39 = #dsmoy000#4;
     |FINSI;

     |GRABA 020#dsmoy000.n;
     |LIBERA #dsmoy000;

     eaMoneda = #dsmoy000#37;

     nDComple = 0; nHComple = 99;
     |SI eaParametro = "PLANING"; |O nSwUno = 1;
         nDComple = enComplem;
         nHComple = enComplem;
     |FINSI;

     |SI eaParametro = ""; |Y aComproba = "C";
         eaParametro = #dsmoy000#0 + "C";
     |FINSI;

     aFichero = ("imp" + Usuario) % 108;
     |NOME_DAT #dsmow014#aFichero#;
     |ABRE #dsmow014;  |CIERRA #dsmow014;  |DELINDEX #dsmow014;

     aFic = "dsmox005" + Usuario;  |NOME_DAT #dsmox005#aFic#;
     aFic = "dsmox006" + Usuario;  |NOME_DAT #dsmox006#aFic#;
     aFic = "dsmox007" + Usuario;  |NOME_DAT #dsmox007#aFic#;

     |ABRE #dsmox005;  |CIERRA #dsmox005;  |DELINDEX #dsmox005;
     |ABRE #dsmox006;  |CIERRA #dsmox006;  |DELINDEX #dsmox006;
     |ABRE #dsmox007;  |CIERRA #dsmox007;  |DELINDEX #dsmox007;

     nSwGraba = 0;

     |SI aCoBien = "S";
         |BUCLE RelComuneros;
     |SINO;
         |ABRE #dsmow014;
         |BUCLE dsmom004;
         |CIERRA #dsmow014;
     |FINSI;

     |SI aComproba = ""; |Y eaParametro ! "PLANING"; |Y nSwGraba = 1; |Y #dsmoy000#6 = 2015;
         |SI #dsmoy000#0 = 130; |O #dsmoy000#0 = 131;
             enModelo = #dsmoy000#0;
             aAlfa    = "dsmoy092;MASIVO";
             |SUB_EJECUTA aAlfa;
             |SI enError15 = 1;
                 |CONFI "0000NDesea Continuar";
                 |SI FSalida ! 0;
                     |DELINDEX #dsmow014;
                     |ACABA;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSwGraba = 1;
         |PINPA #0#dsmow014;
         |HAZ PonBoton;
         |ENTLINEAL #1#dsmow014, -1, 4, 21, 0, ClaveBaja999, ClaveAlta999;
         |HAZ QuitaBoton;

         enSwHay = 0;
         |BUCLE dsmow014M;
     |SINO;
         |MENAV "     Seleccion Vacia.";
         |DELINDEX #dsmow014;
         |ACABA;
     |FINSI;

     eaPathLanza = eaUnidad + "\AEAT";                    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + #dsmoy000#0;                    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + #dsmoy000#6;                    |RMKDIR eaPathLanza;
     |SI #dsmoy000#4 ! 99;
         eaPathLanza = eaPathLanza + "\" + (("00" + #dsmoy000#4) % -102);  |RMKDIR eaPathLanza;
     |FINSI;
     eaPathLanza = eaPathLanza + "\";

     aAlfa = eaPathLanza + "*.bat";
     |R_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |RFBORRA aAlfa;

          |R_SDIR aAlfa;
     |SIGUE;

     aAlfa = eaPathLanza + "*.txt";
     |R_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |RFBORRA aAlfa;

          |R_SDIR aAlfa;
     |SIGUE;

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";                     |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + #dsmoy000#0;                      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + #dsmoy000#6;                      |MKDIR eaPathEmision;
     |SI #dsmoy000#4 ! 99;
         eaPathEmision = eaPathEmision + "/" + (("00" + #dsmoy000#4) % -102);    |MKDIR eaPathEmision;
     |FINSI;
     eaPathEmision = eaPathEmision + "/";

     |HAZ LeeUnidad;

     eaPathInternet = eaUnidad + "/AEAT";                             |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";                   |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + #dsmoy000#0;                    |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + #dsmoy000#6;                    |RMKDIR eaPathInternet;
     |SI #dsmoy000#4 ! 99;
         eaPathInternet = eaPathInternet + "/" + (("00" + #dsmoy000#4) % -102);  |RMKDIR eaPathInternet;
     |FINSI;
     eaPathInternet = eaPathInternet + "/";

     eaPathPreDecla = eaUnidad + "/AEAT";                             |RMKDIR eaPathPreDecla;
     eaPathPreDecla = eaPathPreDecla + "/PREDECLARACION";             |RMKDIR eaPathPreDecla;
     eaPathPreDecla = eaPathPreDecla + "/" + #dsmoy000#0;                    |RMKDIR eaPathPreDecla;
     eaPathPreDecla = eaPathPreDecla + "/" + #dsmoy000#6;                    |RMKDIR eaPathPreDecla;
     |SI #dsmoy000#4 ! 99;
         eaPathPreDecla = eaPathPreDecla + "/" + (("00" + #dsmoy000#4) % -102);  |RMKDIR eaPathPreDecla;
     |FINSI;
     eaPathPreDecla = eaPathPreDecla + "/";

     |BLIN 23;
     |SI enSwHay = 0;
         |MENAV "      Seleccion Vacia";
     |SINO;
         |SI aCoBien = "S"; nEmpresa = enEmpresa; |FINSI;
         aAlfa = "dsmoy" + #dsmoy000#0;
         |SUB_EJECUTA_NP aAlfa;
         |SI aCoBien = "S";
             enEmpresa = nEmpresa;
             |HAZ ImpComunidad;
         |FINSI;
     |FINSI;

     |DELINDEX #dsmow014;

     |CIERRA #dsmoy000;
     |DELINDEX #dsmoy000;
|FPRC;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROCESO Boton2;
     |PTEC 825;
|FPRC;

|PROCESO Boton3;
     |PTEC 826;
|FPRC;

|PROCESO VerComunidad;
  || Lee Primera Actividad
    aCoBien    = "N";
    aContinua  = "S";
    |ABRE #agicen14;
    #agicen14#0 = enEmpresa;
    #agicen14#1 = 00;
    |LEE 041#agicen14.];
    |SI FSalida = 0; |Y #agicen14#0 = enEmpresa;
        aCoBien = #agicen14#13;  ||Comunidad de Bienes
    |FINSI;
    |CIERRA #agicen14;

    |SI aCoBien = "S";
        |PUSHV 1225 1575;
        |CUADRO 1225 1575;
        |ATRI I;
        |PINTA 1327, "Esta Empresa es Una COMUNIDAD DE BIENES       ";
        |PINTA 1427, "Desea Imprimir los Pagos de sus Comuneros S/N ";
        E_sup  = 1;
        E_inf  = "SNsn";
        aContinua = "S";
        aContinua = 1473 ? 0;
        aContinua = aContinua > " ";
        |ATRI R; |PINTA 1473, aContinua; |ATRI 0;
        |POPV;
    |FINSI;
|FPRC;

|PROCESO dsmom004I0;
     |SI #dsmom004#9 ! "X";  nSwIm = 1;  |FINSI;
|FPRC;

|DEFBUCLE dsmom004I;
     #dsmom004#1;
     ;
     #dsmoy000#10, #dsmoy000#6, #dsmoy000#4,  #dsmoy000#0, 00;
     #dsmoy000#11, #dsmoy000#6, #dsmoy000#39, #dsmoy000#0, 99;
     ;
     NULL, dsmom004I0;
|FIN;

|PROCESO RelComun_I0;
 #dsmoy000#10 = #dsmom001#3;
 #dsmoy000#11 = #dsmom001#3;
 |BUCLE dsmom004I;
|FPRC;

|DEFBUCLE RelComun_I;
  #dsmom001#1;
  ;
  enEmpresa, 01, 0001;
  enEmpresa, 99, 9999;
  e;
  NULL, RelComun_I0;
|FIN;

|PROCESO ImpComunidad;
   nSwIm = 0;
   |BUCLE RelComun_I;
   |ABRE #dsmom004;
   #dsmom004#0  = enEmpresa;
   #dsmom004#1  = #dsmoy000#6;
   #dsmom004#2  = #dsmoy000#4;
   #dsmom004#3  = #dsmoy000#0;
   #dsmom004#4  = enComplem;
   |LEE 101#dsmom004.=;
   |SI FSalida = 0;
       |SI nSwIm = 0;
           #dsmom004#9  = "X";
           #dsmom004#10 = #dsmoy000#7;
           |SI #dsmom107#15 = "S"; #dsmom004#13 = "X"; #dsmom004#14 = #dsmoy000#7; |FINSI;
       |SINO;
           #dsmom004#9  = " ";
           #dsmom004#10 = "01.01.0000";
       |FINSI;
       |GRABA 020#dsmom004.a;
       |LIBERA #dsmom004;
   |FINSI;
   |CIERRA #dsmom004;
|FPRC;

|PROGRAMA;
     enMsv      = 0;
     enDirecta  = 0;
     eaMensaCad = "9";
     |HAZ ControlCaducidad;
     |SI enErrorCad = 1;
         |ACABA;
     |FINSI;

     |HAZ LeeUnidad;

     |ABRE #dsmom107;
     |DDEFECTO #dsmom107;
     |LEE 000#dsmom107.p;
     |CIERRA #dsmom107;

     aCoBien  = "";
     aFichero = ("000" + Usuario) % 108;
     |NOME_DAT #dsmoy000#aFichero#;
     |ABRE #dsmoy000;  |CIERRA #dsmoy000;  |DELINDEX #dsmoy000;

     |ABRE #dsmoy000;

     nSwUno      = 0;
     enCalcCif   = 0;
     eaParametro = PARAMETRO;  |QBF eaParametro;
     |SI eaParametro = "PLANING"; |O eaParametro = "INFC";
         |DDEFECTO #dsmoy000;
         #dsmoy000#36 = 00;
         #dsmoy000#0  = enModelo;
         #dsmoy000#4  = enPeriodo;  |HAZ Periodo;
         #dsmoy000#39 = enPeriodo;
         #dsmoy000#6  = enEjer;
         #dsmoy000#9  = "X";
         #dsmoy000#10 = enEmpresa;
         #dsmoy000#11 = enEmpresa;
         #dsmoy000#40 = "T";
         |SI enModelo = 130; |O enModelo = 131;
             |HAZ VerComunidad;
             |SI aContinua = "N"; |ACABA; |FINSI;
         |FINSI;

         |HAZ PintaMoneda;
         #dsmoy000#37 = eaMoneda;

         |PUSHV 0501 2380;
         |BLANCO 1025 1244;
         |CUADRO 0925 1244;
         |ATRI R;
         |SI eaParametro = "INFC";
             |PINTA 1026, "  FECHA INFORME   ";
             aAlfa       = enModelo;
             eaParametro = aAlfa + "C";
             nSwUno      = 1;
         |SINO;
             |PINTA 1026, "FECHA PRESENTACION";
         |FINSI;
         |ATRI r;

         fFecha = ~;
         fFecha = 1130 ? 1;

         #dsmoy000#7 = fFecha;

         |POPV;

         |HAZ Tipo3;

         |ACABA;
     |FINSI;

     aComproba   = eaParametro % -101;

     |SI aComproba = "C";
         |C_V #dsmoy000#39, 1, "S";  |C_M #dsmoy000#39, 1, "S";
         |C_V #dsmoy000#5,  1, "N";  |C_M #dsmoy000#5,  1, "N";
                              |C_M #dsmoy000#40, 1, "N";  #dsmoy000#40 = "T";
     |SINO;
         |C_V #dsmoy000#39, 1, "N";  |C_M #dsmoy000#39, 1, "N";
         |C_V #dsmoy000#5,  1, "S";  |C_M #dsmoy000#5,  1, "N";
     |FINSI;

     aModelo = eaParametro % 103; nModelo = aModelo;
     enMsv   = 1;
     |SI eaParametro ! ""; |Y nModelo ! 0;
         |ABRE #agitab99;
         #agitab99#0 = aModelo;
         |LEE 040#agitab99.=;
         |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;
         |CIERRA #agitab99;

         |SI aModelo ! "180";  |Y aModelo ! "190";  |Y aModelo ! "390";  |Y aModelo ! "193";
          |Y aModelo ! "311";  |Y aModelo ! "371";  |Y aModelo ! "392";  |Y aModelo ! "184";
          |Y aModelo ! "296";  |Y aModelo ! "187";
             |SI #agitab99#4 = "N";
                 |CIERRA #dsmoy000;  |DELINDEX #dsmoy000;
                 |MENAV "     Modelo sin Activar.";
                 |ACABA;
             |FINSI;
         |FINSI;
         |CIERRA #agitab99;

         |DDEFECTO #dsmoy000;

         aAlfa = eaParametro % 103;
         #dsmoy000#0  = aAlfa;
         |SI eaParametro = "311";  |O eaParametro = "311C";
             #dsmoy000#0  = "310";
             #dsmoy000#4  = "12";
             #dsmoy000#39 = "12";
             |C_M #dsmoy000#4, 1, "N";
             |C_M #dsmoy000#39, 1, "N";
         |FINSI;

         |SI eaParametro = "371";  |O eaParametro = "371C";
             #dsmoy000#0  = "370";
             #dsmoy000#4  = "12";
             #dsmoy000#39 = "12";
             |C_M #dsmoy000#4, 1, "N";
             |C_M #dsmoy000#39, 1, "N";
         |FINSI;

         |C_M #dsmoy000#0, 1, "N";
         |PINPA #0#dsmoy000;
         |SI aComproba ! "";
             |SI aComproba = "C"; aAlfa = " Informe de Comprobacion Modelos Oficiales "; |FINSI;
             |SI aComproba = "P"; aAlfa = " Inf.Comprobacion Datos Portada Modelo 190 "; |FINSI;
             |SI aComproba = "D"; aAlfa = " Inf.Verificacion Calculo Clave A Modelo 190"; |FINSI;
             |ATRI R; |PINTA 0602, aAlfa; |ATRI 0;
         |FINSI;
         |PINDA #0#dsmoy000;
         |ENDATOS #1#dsmoy000;
     |SINO;
         eaParametro = "";
         aModelo     = "";
         |PINPA #0#dsmoy000;
         |SI aComproba = "C";
             |ATRI R; |PINTA 0602, " Informe de Comprobacion Modelos Oficiales "; |ATRI 0;
         |FINSI;
         |PINDA #0#dsmoy000;
         |ENDATOS #1#dsmoy000;
     |FINSI;

     |HAZ FinalizaEnX;

     |PULSATECLA;
|FPRO;
