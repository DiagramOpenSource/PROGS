|FICHEROS;
     dsmoy182 #0;
     dsmoy000 #1;

     :/basica/def/agicen14 #114;
     :/basica/def/agitab99 #99;

     dsm182ca #182;
     dsm182li #183;

     dsmow614 #614;
     dsmow615 #615;

     dsmow014 #999;
     dsmom107 #107; || control Modelos

     &regisnif@ #709;
     &clientes@ #715;
     &datosper@ #718;
|FIN;

|VARIABLES;
     aIPRemoto     = "";
     aBue          = "";

      nAnyo     = 0;
      nSwIm     = 0;
      nDComple  = 0;
      nHComple  = 0;
      nSwUno    = 0;
      nModelo   = 0;
      aComproba = "";
      aContinua = "";
      nDEmpresa = 0;
      nHEmpresa = 0;
      aJusti    = "";
      nHandleEjec = 0;
      nPara1    = 0;
      nHandle   = 0;
     &enPeriodo = 0;
     &enEjer    = 0;
     &eaElProm  = "dsmoy182";
     &enComplem = 0;
     &enSwLinea = 0;
     nPresentar = 0;
|FIN;

|INCLUYE i_varemi;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO MiraVarMoneda;
     nTecla = FSalida;
     |HAZ PintaMoneda;

     #0#37 = eaMoneda;
     |PINTA #0#37;
     FSalida =  nTecla;
|FPRC;

|PROCESO Modelo;
     |ABRE #99;
     #99#0 = #0#0;
     |LEE 040#99=;
     |SI FSalida ! 0;  |DDEFECTO #99;  |FINSI;
     |CIERRA #99;

     |SI #99#4 = "N";
         |MENAV "     Modelo sin Activar.";
         |ERROR;
     |FINSI;

|ET ElDefecto;
     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#6   = aAlfa;
     |PINTA #0#6;
|FPRC;

|PROCESO Parrilla;
     |SI #0#10 = 0;
         |C_M #0#11, 1, "N"; #0#11 = 0; |PINTA #0#11;
         |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
              |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
          |C_M #0#10, 1, "S";
          |C_M #0#11, 1, "S";

          |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0; |PINTA #0nCampo;
               |C_M #0nCampo, 1, "N";
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO DesdeHasta;
     |C_M #0#10, 1, "S";
     |C_M #0#11, 1, "S";
     #0#36 = 0;  |PINTA #0#36;  |C_M #0#36, 1, "N";

     |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "N";
           #0nCampo = 0;  |PINTA #0nCampo;
     |SIGUE;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|| -----------------------------------------------------------------
|| -----------------------------------------------------------------
|PROCESO GrabaImpreso182;
     |SI enInternet ! 0;
         aAlfa = aDirSesion + "AUXILIAR.TXT";
         |RFBORRA aAlfa;

         aAlfa = aDirSesion + "jus" + (("00000" + #999#0) % -105) + ".xml";
         |RFBORRA aAlfa;

         aAlfa = aDirSesion + eaFichError + #0#6 + ".RST";
         |RFBORRA aAlfa;

         aAlfa = aDirSesion + eaFichError + (("00000" + #999#0) % -105) + ".RST";
         |RFBORRA aAlfa;
     |FINSI;

     aJusti  = "";

     |SI enInternet = 0;
         aAbre   = aDirSesion + "jus" + (("00000" + #999#0) % -105) + ".xml";
         |XABRE "C", aAbre, nHandleEjec;
         |SI FSalida ] 0;
             |PARA;  |SI FSalida ] 0;  |HACIENDO;
                  |XLEE nHandleEjec, 250, aAlfa;

                  aAlfa = aAlfa - "<Justif>";
                  |SI FSalida ! 0;
                      aAlfa  = aAlfa - "</Justif>";  |QBT aAlfa;
                      aAlfa  = aAlfa - "<RST>";      |QBT aAlfa;
                      aAlfa  = aAlfa - "</RST>";     |QBT aAlfa;
                      aJusti = aAlfa % -113;
                      |SAL;
                  |FINSI;
              |SIGUE;
         |FINSI;
         |XCIERRA nHandleEjec;

         |RFBORRA aAbre;

         |SI aJusti = "";
             aAbre   = aDirSesion + eaFichError + (("00000" + #999#0) % -105) + ".RST";
             |XABRE "C", aAbre, nHandleEjec;
             |SI FSalida ] 0;
                 |XLEE nHandleEjec, 250, aJusti;
             |FINSI;
             |XCIERRA nHandleEjec;

             |RFBORRA aAbre;
         |FINSI;
     |FINSI;

     #182#11  = "X";
     #182#12 = #0#7;

     |QBF aJusti;
     aAlfa = aJusti % 0;
     enNume = aAlfa;

     |SI enNume [ 13;
         #182#18 = aJusti;
     |SINO;
         #182#20 = aJusti;
     |FINSI;

     |SI #107#15 = "S";
         #182#16 = "X";
         #182#17 = #0#7;
     |FINSI;

     |SI eaJusti ! "";
         #182#18 = eaJusti;
     |FINSI;

     |GRABA 020#182a;
     |LIBERA #182;
|FPRC;

|| -----------------------------------------------------------------

|PROCESO Boton1821;
     |PTEC 824;
|FPRC;

|PROCESO Boton1822;
     |PTEC 825;
|FPRC;

|PROCESO Boton1823;
     |PTEC 826;
|FPRC;

|PROCESO BotonEsc182;
     |PTEC 806;
|FPRC;

|PROCESO Botones182;

     |BLANCO 0501 2380;

||     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision PDF pagina hacienda ", 0513, 0654, Boton1821;
||     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Presentacion Telematica      ", 0513, 0754, Boton1822;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, BotonEsc182;
     nBoton5 = FSalida;

     aF2  = &255 + "824";
     aF3  = &255 + "825";
     aF4  = &255 + "826";
     aF5  = &255 + "827";
     aF6  = &255 + "828";
     aEsc = &255 + "806";

     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;

||         |SI aTecla = aF2; nTecla = 1; |SAL;  |FINSI;
         |SI aTecla = aF3; nTecla = 3; |SAL;  |FINSI;
         |SI aTecla = aEsc; nTecla = 0; |SAL; |FINSI;
     |SIGUE;

||     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton5;

     |PULSATECLA;

|FPRC;

|| //////////////////////////////////
|PROCESO IrPagina;
     |HAZ TraeSoloWait;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "WBC", aAbre, nHandle;

     aAlfa = eaPathLanza + "wait ";

||     |SI enEjer < 2014;
||         aAlfa = aAlfa + eaPathExplorador + " " + &34 + "https://www1.agenciatributaria.gob.es/wlpl/PAMW-M182/index.zul";
||         ||tique 700000 _ 9190
||     |SINO;
         aAlfa1 = enEjer; aAlfa1 = aAlfa1 % -102;
         aAlfa = aAlfa + eaPathExplorador + " " + &34 + "https://www1.agenciatributaria.gob.es/wlpl/PA"+ aAlfa1+ "-M182/index.zul?EDFI.";
||     |FINSI;

     eaAlfa  = aAlfa;
     eaAlfa = eaAlfa + &13 + &10;
     |XGRABA nHandle, eaAlfa;

     |XCIERRA nHandle;

     |RSYSTEM aAbre;

     aAlfa = eaPathLanza + "imprime.bat";  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + "wait.exe";     |RFBORRA aAlfa;
|FPRC;

|PROCESO Registro1;
     enCodCli = #182#0;
     |HAZ LeePersona;

     |DDEFECTO #614;

     #614#0  = "1";

     #614#1  = "182";

     #614#2  = #182#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #614#3   = eaVarDni;

         eaAlfa   = #715#1;  |HAZ QuitaRaros;
         #614#4   = eaAlfa;

         eaAlfa   = #715#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #715#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #614#6   = eaAlfa;

         eaAlfa   = #715#53;  |HAZ QuitaRaros;
         #614#7   = eaAlfa;

     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #614#3   = eaVarDni;

         eaAlfa   = #715#1;   |HAZ QuitaRaros;
         #614#4   = eaAlfa;

         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;
         |QBF eaAlfa;
         |SI eaAlfa = "";  eaAlfa = "000000000";  |FINSI;
         #614#6   = eaAlfa;

         eaAlfa   = #715#96;  |HAZ QuitaRaros;
         #614#7   = eaAlfa;

     |FINSI;

     #614#5  = "T";
     #614#8 = "1820000000000";

     |SI enDirecta = 1;
         |HAZ CalcJustificante;
         #dsmow614#8 = eaJusti;
     |FINSI;

     |SI #182#19 = "C";
         #614#9  = "C";
         #614#11 = #182#22;
     |FINSI;

     |SI #182#19 = "S";
         #614#10 = "S";
         #614#11 = #182#22;
     |FINSI;

     enNume   = #182#8;
     #614#12 = ("000000000" + enNume) % -109;

     enNume  = #182#6;
     |HAZ Conver15;
     #614#13 = eaAlfa;

     #614#14 = #182#23;

     |SI #182#23 = 3;
         eaVarDni = #182#25;  |HAZ CalculameDNI;
         #614#15  = eaVarDni;

         eaAlfa   = #182#26;   |HAZ QuitaRaros;
         #614#16   = eaAlfa;
     |FINSI;

     #614#19 = &13 + &10;

     nHCampo = 19;
     |SI nTecla ! "3";
         nHCampo = 18;
     |FINSI;

     |SI nTecla ! 4;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #614nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |FINSI;
     nTRegistro = nTRegistro + 1;
|FPRC;

|PROCESO Registro2;

     enCodCli = #182#0;
     |HAZ LeePersona;

     |DDEFECTO #615;

     #615#0  = "2";

     #615#1  = "182";

     #615#2  = #182#1;
     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #615#3   = eaVarDni;
     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #615#3   = eaVarDni;
     |FINSI;

     eaVarDni = #183#6;  |HAZ CalculameDNI;
     |SI #183#9 = "S";
         #615#5 = eaVarDni;
     |SINO;
         #615#4 = eaVarDni;
     |FINSI;

     eaAlfa  = #183#10; |HAZ QuitaRaros;
     #615#6  = eaAlfa;

     aAlfa   = #183#11; |QBF aAlfa;
     aAlfa   = ("00" + aAlfa) % -102;
     #615#7  = aAlfa;

     #615#8  = #183#12;

     nNume  = #183#13;
     |SI nNume ! 0;
         nNume = (nNume * 100) ! 0;
         aAlfa  = nNume; |QBF aAlfa;
         aAlfa  = ("00000" + aAlfa ) % -105;
         #615#9 = aAlfa;
     |FINSI;

     enNume  = #183#14
     |HAZ Conver13;
     #615#10 = eaAlfa;

     |SI #183#16 = "S";
         #615#11 = "X";
     |FINSI;

     |SI #183#17 ! 0;
         aAlfa   = #183#17; |QBF aAlfa;
         aAlfa   = ("00" + aAlfa) % -102;
         #615#12 = aAlfa;
     |FINSI;

     nNume  = #183#18;
     |SI nNume ! 0;
         nNume   = (nNume * 100) ! 0;
         aAlfa   = nNume; |QBF aAlfa;
         aAlfa   = ("00000" + aAlfa ) % -105;
         #615#13 = aAlfa;
     |FINSI;

     #615#14 = #183#19;

     |SI #183#20 = "S";
         #615#15 = "X";
         aAlfa   = #183#21; |QBF aAlfa;
         aAlfa   = ("0000" + aAlfa ) % -104;
         #615#16 = aAlfa;
     |FINSI;

     |SI #183#22 ! " ";
         #615#17 = #183#22;
         eaAlfa  = #183#23; |HAZ QuitaRaros;
         #615#18 = eaAlfa;
     |FINSI;

     |SI #dsmoy182#6 ] 2016;
         |SI #183#15 = "S"; #615#19 = "1"; |FINSI;
         |SI #183#15 = "N"; #615#19 = "2"; |FINSI;
     |FINSI;

     #615#21 = &13 + &10;

     nHCampo = 21;
     |SI nTecla ! "3";
         nHCampo = 20;
     |FINSI;

     |SI nTecla ! 4;
       |SI #183#14 ! 0;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #615nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
       |FINSI;
     |SINO;
         |PRINT;
     |FINSI;
     nTRegistro = nTRegistro + 1;
|FPRC;

|DEFBUCLE Carga182li;
     #183#1;
     ;
     #182#0, #182#1, #182#2, #182#3, #182#4, "            ", 01;
     #182#0, #182#1, #182#2, #182#3, #182#4, "zzzzzzzzzzzz", 99;
     e;
     NULL, Registro2;
|FIN;

|PROCESO dsmow014M182;
     #182#0  = #999#0;
     #182#1  = #999#1;
     #182#2  = #999#2;
     #182#3  = #999#5;
     #182#4  = #999#7;
     #182#5  = 0;
     |LEE 040#182=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     eaFicheroPlano = "182" + (("00000" + #999#0) % -105) + ".txt";
     eaFicheroImpre = "182" + (("00000" + #999#0) % -105) + ".pdf";
     eaFicheroSalid = "182" + (("00000" + #999#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #999#0) % -105) + ".txt";

     aAlfa = eaPathLanza + eaFicheroPlano;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroImpre;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroError;  |RFBORRA aAlfa;

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     nTRegistro = 0;
     |HAZ Registro1;
     |BUCLE Carga182li;

     |XCIERRA nHandle2;

     enEmpresa    = #999#0;
     eaNomEmpresa = #999#3;

     |SI #dsmoy182#6 [ 2016;  |O aComproba = "C";
         |SI nTecla = 3;
             eaFOrigen  = eaPathEmision  + eaFicheroPlano;
             eaFDestino = eaPathInternet + eaFicheroPlano;
             |HAZ CopiaFichero;

             |HAZ GrabaImpreso182;

             enSwHay = enSwHay + 1;
             |ACABA;
         |FINSI;

         |SI nTecla = 4;
             |SI nTRegistro ! 0;
                 |PIEINF;
             |FINSI;
         |FINSI;

         |ACABA;
     |FINSI;

     |SI enDirecta = 0;
         |SI #dsmoy182#6 ] 2018;
             |HAZ GrabaImpreso182;
             |HAZ PresentaPortal;
         |FINSI;
     |FINSI;

     |SI enDirecta = 1;
         enEmpresa    = #dsmow014#0;
         enComple     = #dsmow014#7;
         eaNomEmpresa = #dsmow014#3;

         eaX002_10    = #dsmow614#3;
         eaX002_11    = #dsmow614#4;
         eaX002_12    = #dsmoy000#0;
         eaX002_13    = #dsmoy000#6;
         eaX002_14    = 99;

         |SI #dsmow614#9 ! " ";
             eaX002_15 = #dsmow614#9;
         |FINSI;

         |SI #dsmow614#10 ! " ";
             eaX002_15 = #dsmow614#10;
             eaX002_16 = #dsmow614#11;
         |FINSI;

         eaX002_20 = #dsm182ca#8;
         eaX002_21 = #dsm182ca#6;
         eaX002_23 = #dsm182ca#8;
         eaX002_24 = #dsm182ca#6;
         |HAZ PresentaPortal;
         |SI enOK = 1;
             eaJusti = "";
             |HAZ GrabaImpreso182;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmow014C182;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, dsmow014M182;
|FIN;

|DEFBUCLE dsmow014N182;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, dsmow014M182;
|FIN;

|PROCESO Bloque2016;
     |SI aComproba ! "C";
         |HAZ Botones182;
     |SINO;
          nTecla = 4;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1;  |ACABA;  |FINSI;
     |SI nTecla = 4;  enInfComp = 1;  |FINSI;

     |SI nTecla = 4;
         Impresora = "CrystalReports";
         |IMPRE -1;
         |SI FSalida ! 0;
             |MENAV "0000 No tiene instalada Impresora CrystalReport, pongase en contacto con su Administrador";
             |ACABA;
         |FINSI;

         |SI #0#39 = "D";
             |INFOR "m182co01";
         |SINO;
             |INFOR "m182co02";
         |FINSI;
         |SI FSalida ! 0;
             |MENAV "    Error en el Informe";
             |FINIMP;
             |ACABA;
         |FINSI;
     |FINSI;

     enSwHay = 0;
     |ABRE #182;
     |SI #0#8 = "C";
         |BUCLE dsmow014C182;
     |SINO;
         |BUCLE dsmow014N182;
     |FINSI;
     |CIERRA #182;

     |SI nTecla = 3; |Y enSwHay ! 0;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;

         nPresentar = 0;
         |CONFI "0000NDesea presentar en estos momentos la declaracion";
         |SI FSalida = 0;
             nPresentar = 1;
         |FINSI;
         |SI nPresentar = 1; |HAZ IrPagina; |FINSI;
     |FINSI;

     |SI nTecla = 4;
         |FININF;
         |FINIMP;
     |FINSI;

     |SI enDirecta = 1;  |Y enMsv = 1;  |Y enParar = 0;
         |SUB_EJECUTA "|dsmox007";
     |FINSI;
|FPRC;

|PROCESO Bloque2017;
     |HAZ BtnAnuales2015;
     nTecla = eaOpcion;

     |SI eaOpcion = "0";  enInfComp = 1;  |ACABA;  |FINSI;

     enSwHay = 0;
     |ABRE #182;
     |SI #0#8 = "C";
         |BUCLE dsmow014C182;
     |SINO;
         |BUCLE dsmow014N182;
     |FINSI;
     |CIERRA #182;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Prdsmoy182;
     enSwTrata      = 0;
     enCambiaMoneda = 1;

     |SI aComproba = "C";
         |HAZ Bloque2016;
         |ACABA;
     |FINSI;

     |SI #dsmoy182#6 [ 2016;
         |HAZ Bloque2016;
     |FINSI;

     |SI #dsmoy182#6 ] 2017;
         |HAZ Bloque2017;
     |FINSI;
|FPRC;

|| -----------------------------------------------------------------
|PROCESO GrabaTempo;
     enEmpresaPINET = #182#0;
     |HAZ RestriccionPINET;
     |SI enErrorPINET = 1;  |ACABA;  |FINSI;

     |SI #0#9 = "N";
         |SI #182#11 = "X";   |ACABA;  |FINSI;
     |SINO;
         |SI #0#9 = "S";  |Y aComproba ! "C";
             |SI #182#16 = "X";  |ACABA;  |FINSI;
         |FINSI;
     |FINSI;

     enCodCli = #182#0;
     |HAZ LeePersona;

     #999#0  = #182#0;
     #999#1  = #182#1;
     #999#2  = #182#2;
     |LEE 101#999=;
     |SI FSalida ! 0;
         |DDEFECTO #999;
         #999#0  = #182#0;
         #999#1  = #182#1;
         #999#2  = #182#2;
         |GRABA 020#999b;
     |FINSI;

     #999#3  = #715#1;
     #999#4  = #0#5;
     #999#5  = #0#0;
     #999#6  = "S";
     #999#7  = #182#4;
     |GRABA 020#999a;
     |LIBERA #999;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE dsm182ca;
     #182#1;
     9;
     nDEmpresa, #0#6, 99, #0#0, nDComple, "X";
     nHEmpresa, #0#6, 99, #0#0, nHComple, "X";
     ;
     NULL, GrabaTempo;
|FIN;

|RUTINA ClaveBaja999;
     #999#0 = 1;
     #999#1 = 0000;
     #999#2 = 00;
|FRUT;

|RUTINA ClaveAlta999;
     #999#0 = 99999;
     #999#1 = 9999;
     #999#2 = 99;
|FRUT;

|PROCESO MiraCuantos;
     enSwHay = enSwHay + 1;
|FPRC;

|DEFBUCLE dsmow014M;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, MiraCuantos;
|FIN;

|PROCESO Tipo3;  |TIPO 3;

     |DDEFECTO #1;   || para las subrutinas de impresion necesita el dsmoy000
     |PARA nPara1 = 0; |SI nPara1 [ 38; |HACIENDO nPara1 = nPara1 + 1;
           #1nPara1 = #0nPara1;
     |SIGUE;
     eaMoneda = #0#37;

     nDComple = 0; nHComple = 99;
     |SI eaParametro = "PLANING"; |O nSwUno = 1;
         nDComple = enComplem;
         nHComple = enComplem;
     |FINSI;

     aFichero = ("imp" + Usuario) % 108;
     |NOME_DAT #999 aFichero;
     |DELINDEX #999;

     nSwGraba = 0;

    |ABRE #999;
    |SI #0#10 ! 0;
        nDEmpresa = #0#10;
        nHEmpresa = #0#11;
        |BUCLE dsm182ca;
    |SINO;
        |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
              |SI #0nCampo ! 0;
                  nDEmpresa = #0nCampo;
                  nHEmpresa = #0nCampo;
                  |BUCLE dsm182ca;
              |FINSI;
        |SIGUE;
    |FINSI;
    |CIERRA #999;

    |SI nSwGraba = 1;
        |SI #0#39 ! "R";
            |PINPA #0#999;
            |HAZ PonBoton;
            |ENTLINEAL #1#999, -1, 4, 21, 0, ClaveBaja999, ClaveAlta999;
            |HAZ QuitaBoton;
        |FINSI;
        enSwHay = 0;
        |BUCLE dsmow014M;
    |SINO;
        |MENAV "     Seleccion Vacia.";
        |DELINDEX #999;
        |ACABA;
    |FINSI;

     eaPathLanza = eaUnidadBasico + "\AEAT";                    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + #0#0;                    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + #0#6;                    |RMKDIR eaPathLanza;
     |SI #0#4 ! 99;
         eaPathLanza = eaPathLanza + "\" + (("00" + #0#4) % -102);  |RMKDIR eaPathLanza;
     |FINSI;
     eaPathLanza = eaPathLanza + "\";

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";                     |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + #0#0;                      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + #0#6;                      |MKDIR eaPathEmision;
     |SI #0#4 ! 99;
         eaPathEmision = eaPathEmision + "/" + (("00" + #0#4) % -102);    |MKDIR eaPathEmision;
     |FINSI;
     eaPathEmision = eaPathEmision + "/";

     |HAZ LeeUnidad;
     eaPathInternet = eaUnidad + "/AEAT";                             |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";                   |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + #0#0;                    |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + #0#6;                    |RMKDIR eaPathInternet;
     |SI #0#4 ! 99;
         eaPathInternet = eaPathInternet + "/" + (("00" + #0#4) % -102);  |RMKDIR eaPathInternet;
     |FINSI;
     eaPathInternet = eaPathInternet + "/";

     |SI enSwHay = 0;
         |MENAV "      Seleccion Vacia";
     |SINO;
         |HAZ Prdsmoy182;
     |FINSI;

     |DELINDEX #999;
|FPRC;

|PROGRAMA;
     |HAZ LeeUnidad;

     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     nSwUno      = 0;
     enCalcCif   = 0;
     eaParametro = PARAMETRO;  |QBF eaParametro;
     aComproba   = eaParametro % -101;
     |SI eaParametro = "PLANING"; |O eaParametro = "INFC";
         |DDEFECTO #0;
         #0#0  = enModelo;
         #0#4  = 99;
         #0#6  = enEjer;
         #0#9  = "X";
         #0#10 = enEmpresa;
         #0#11 = enEmpresa;

         |HAZ PintaMoneda;
         #0#37 = eaMoneda;

         |PUSHV 0501 2380;
         |BLANCO 1025 1244;
         |CUADRO 0925 1244;
         |ATRI R;
         |SI eaParametro = "INFC";
             |PINTA 1026, "  FECHA INFORME   ";
             aAlfa       = enModelo;
             eaParametro = aAlfa + "C";
             nSwUno      = 1;
         |SINO;
             |PINTA 1026, "FECHA PRESENTACION";
         |FINSI;
         |ATRI r;

         fFecha = ~;
         fFecha = 1130 ? 1;

         #0#7 = fFecha;

         |POPV;

         |HAZ Tipo3;

         |ACABA;
     |FINSI;

     |ABRE #99;
     #99#0 = 182;
     |LEE 040#99=;
     |SI FSalida ! 0;  |DDEFECTO #99;  |FINSI;
     |CIERRA #99;

     |DDEFECTO #0;

     #0#0  = 182;
     |PINPA #0#0;
     |SI aComproba = "C";
         aAlfa = " Informe de Comprobacion Modelo Oficial 182 ";
         |ATRI R; |PINTA 0602, aAlfa; |ATRI 0;
         |C_V #0#39, 1, "S"; |C_M #0#39, 1, "S";
         |PINTA 1805,"쿔nf. Detallado/Resumido. :            ";
         |PINTA 1905,"읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸";
     |FINSI;
     |PINDA #0#0;
     |ENDATOS #1#0;

     |HAZ FinalizaEnX;

     |PULSATECLA;
|FPRO;

/*
https://www1.agenciatributaria.gob.es/wlpl/PA15-M182/index.zul?EDFI.
*/
