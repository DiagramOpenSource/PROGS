|FICHEROS;
   dsm210dp #0;
   dsm213ca #10;
   dsm213in #11;
   dsm213so #12;
   dsm213hi #13;
   dsm213h1 #14;
   dsm213h2 #15;
   dsminmex #16;
   dsmivcex #18;
   dsm210db #17;

   dsmow324 #50;
   dsmow325 #51;
   dsmow327 #52;
   dsmow328 #53;
   dsmow329 #54;
   dsmow330 #55;
   dsmow331 #56;
   dsmow332 #57;
   dsmow317 #58;
   dsmow333 #59;
   dsmow310 #60;
   dsmow343 #61,MANTE;
   dsmow339 #62;

   pdfimtmp #500;

   Referen@ #1000;
   Refere1@ #1001;
   Refere2@ #1002;
   Refere3@ #1003;
   Refere4@ #1004;
   Refere5@ #1005;

   &reprovi@ #5000;
   &rpaises@ #5001;
   &haciend@ #5002;
|FIN;

|VARIABLES;
   &enSwCod = 0;
   &Cmp     = 0;
   &enModo  = 0;
   &aArchivo = "";
   &enEjercicio = 0;

   aAlfa  = "";
   aAlfa1 = "";
   aAlfa2 = "";
   aAlfa3 = "";
   aAlfa4 = "";
   aAlfaF4 = "";

   fFecha = @;

   aDato  = "";
   aValor = "";
   aCompl = "";
   nValor = 0;
   nDato  = 0;
   nCont  = 0;
   nContInm = 0;
   nContSoc = 0;

   nBotonCtaBanco = 0;

   nVent0 = 0;
   nVent1 = 0;
   nVent2 = 0;
   nVentEsp = 0;
   nPant1 = 0;
   nPant2 = 0;
   nGrid1 = 0;
   nGrid2 = 0;
   nGridEmi = 0;
   nCompl   = 0;

   nPos1  = 0;
   nPos2  = 0;
   nRango = 0;

   nContCmp = 0;
   nSwError = 0;

   aIBAN       = "";
   &eaCta      = "";
   &eaPais     = "";
   &eaIBAN     = "";
   aEsc1   = "";
   aEsc2   = "";
   aRetu   = "";
   aTecla  = "";

   nNueDel213 = 0;
   nModDel213 = 0;
   nBorDel213 = 0;

   nNueInm213 = 0;
   nModInm213 = 0;
   nBorInm213 = 0;

   nNueSoc213 = 0;
   nModSoc213 = 0;
   nBorSoc213 = 0;

   nDatRepre  = 0;
   nRelInmueb = 0;
   nRelSocios = 0;

   nSwHacienda = 0;

   nNumSPant  = 0;
   nCalc      = 0;
   nModo      = 0;
   nIdSalir   = 0;
   nIdSalir1  = 0;
   nSwModo    = 0;
   nSwModo1   = 0;

   nBotonEmi  = 0;
   nBotonSalir = 0;

   nSwModelo  = 0;
   aSwPresent = "";

   aTitulo    = "";
   aDirBase   = "";
   aFichero   = "";
   nHandle    = 0;

   TipoDato  = 0;
   Long      = 0;
   LongDec   = 0;
   nNegativo = 0;
   Vacio1    = "";
   Vacio2    = "";
   Calc1     = 0;
   Calc2     = 0;
   aLong     = "";
   nLong     = 0;
   nCont1    = 0;
   nSwDatos1 = 0;
   nSwFiltraBarra = 0;

{2}nNivel     = 0;
   || NO METER VARIABLES ENTRE ESTE BLOQUE
{-1}aVent      = "";
    aVent1     = 0;
    aVent2     = 0;
    aVent3     = 0;
    aVent4     = 0;
    aVent5     = "";
   || NO METER VARIABLES ENTRE ESTE BLOQUE
|FIN;

/***************************************************************************
*********                         MODELO 213                       *********
****************************************************************************/

|PROCESO CuentaRegs213a;
   #dsm213ca#20 = #dsm213ca#20 + 1;
|FPRC;

|DEFBUCLE CuentaRegs213a;
#dsm213in#1;
;
#dsm213ca#0, #dsm213ca#1, 000;
#dsm213ca#0, #dsm213ca#1, 999;
;
NULL, CuentaRegs213a;
|FIN;

|PROCESO CuentaRegs213b;
   #dsm213ca#21 = #dsm213ca#21 + 1;
|FPRC;

|DEFBUCLE CuentaRegs213b;
#dsm213so#1;
;
#dsm213ca#0, #dsm213ca#1, "               ";
#dsm213ca#0, #dsm213ca#1, "zzzzzzzzzzzzzzz";
;
NULL, CuentaRegs213b;
|FIN;

|PROCESO CuentaRegs213;
   #dsm213ca#20 = 0;
   #dsm213ca#21 = 0;
   |BUCLE CuentaRegs213a;
   |BUCLE CuentaRegs213b;
|FPRC;

|PROCESO EvtoGrid213a;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsm213ca.c;

      |SI #dsm213ca#20 = 0; |Y #dsm213ca#20 = 0;
         |HAZ CuentaRegs213;
         |GRABA 020#dsm213ca.a;
      |FINSI;

      |DDEFECTO #dsmow324;
      |SI #dsm213ca#4 = 1; #dsmow324#0 = "S"; #dsmow324#4 = ""; |FINSI;
      |SI #dsm213ca#4 = 2; #dsmow324#1 = "S"; #dsmow324#4 = #dsm213ca#5; |FINSI;
      |SI #dsm213ca#4 = 3; #dsmow324#2 = "S"; #dsmow324#4 = ""; |FINSI;
      |SI #dsm213ca#4 = 4; #dsmow324#3 = "S"; #dsmow324#4 = ""; |FINSI;
      |PINTA #dsmow324#0; |C_M #dsmow324#0, 1, "N";
      |PINTA #dsmow324#1; |C_M #dsmow324#1, 1, "N";
      |PINTA #dsmow324#2; |C_M #dsmow324#2, 1, "N";
      |PINTA #dsmow324#3; |C_M #dsmow324#3, 1, "N";
      |PINTA #dsmow324#4; |C_M #dsmow324#4, 1, "N";
      #dsmow324#5  = #dsm213ca#6;  |PINTA #dsmow324#5;
      #dsmow324#6  = #dsm213ca#7;  |PINTA #dsmow324#6;
      #dsmow324#7  = #dsm213ca#8;  |PINTA #dsmow324#7;
      #dsmow324#8  = #dsm213ca#9;  |PINTA #dsmow324#8;
      #dsmow324#9  = #dsm213ca#10; |PINTA #dsmow324#9;
      #dsmow324#10 = #dsm213ca#11; |PINTA #dsmow324#10;
      #dsmow324#11 = #dsm213ca#12; |PINTA #dsmow324#11;
      #dsmow324#12 = #dsm213ca#13; |PINTA #dsmow324#12;
      |SI #dsm213ca#14 = "E";
         #dsmow324#13 = "S"; #dsmow324#14 = "N";
         #dsmow324#15 = "";  #dsmow324#16 = "";
         #dsmow324#17 = "";  #dsmow324#18 = "";
         #dsmow324#19 = "";
      |FINSI;
      |SI #dsm213ca#14 = "A";
         #dsmow324#13 = "N"; #dsmow324#14 = "S";
         #dsmow324#15 = #dsm213ca#15;
         #dsmow324#16 = #dsm213ca#16;
         #dsmow324#17 = #dsm213ca#17;
         #dsmow324#18 = #dsm213ca#18;
         #dsmow324#19 = #dsm213ca#19;
      |FINSI;
      |PINTA #dsmow324#13; |PINTA #dsmow324#14;
      |PINTA #dsmow324#15; |PINTA #dsmow324#16;
      |PINTA #dsmow324#17; |PINTA #dsmow324#18;
      |PINTA #dsmow324#19;

      |ESTADO_CONTROL nModDel213, "ENABLE";
      |ESTADO_CONTROL nBorDel213, "ENABLE";
   |FINSI;
|FPRC;

|PROCESO DatosRep213;
/*
   InNivel = nNivel1<-;
   nNivel1 = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;
   Cmp = 1;

   |ESTADO_CONTROL nRelSocios, "DISABLE";
   |ESTADO_CONTROL nRelInmueb, "DISABLE";
   |ESTADO_CONTROL nDatRepre, "DISABLE";

   |VENTANA 1108, 1992, 1, 17, "Datos del representante del adquirente"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |DDEFECTO #dsmow326;
   #dsmow326#0  = #dsmow324#0;
   #dsmow326#1  = #dsmow324#1;
   #dsmow326#2  = #dsmow324#2;
   #dsmow326#3  = #dsmow324#3;
   #dsmow326#4  = #dsmow324#4;
   #dsmow326#5  = #dsmow324#5;
   #dsmow326#6  = #dsmow324#6;
   #dsmow326#7  = #dsmow324#7;
   #dsmow326#8  = #dsmow324#8;
   #dsmow326#9  = #dsmow324#14;
   aAlfa = ("00000" + #dsmow324#10) % -105; |QBF aAlfa;
   #dsmow326#10 = aAlfa % 0102;
   #dsmow326#11 = aAlfa % 0303;
   #dsmow326#12 = #dsmow324#11;
   #dsmow326#13 = #dsmow324#13;
   #dsmow326#14 = #dsmow324#9;
   #dsmow326#15 = #dsmow324#14;

   |PINPA #0#dsmow326; nPant1 = FSalida;
   |PINDA #0#dsmow326;

   |ENDATOS #1#dsmow326;
   |SI FSalida = 0;
      #dsmow324#0  = #dsmow326#0;  |PINTA #dsmow324#0;
      #dsmow324#1  = #dsmow326#1;  |PINTA #dsmow324#1;
      #dsmow324#2  = #dsmow326#2;  |PINTA #dsmow324#2;
      #dsmow324#3  = #dsmow326#3;  |PINTA #dsmow324#3;
      #dsmow324#4  = #dsmow326#4;  |PINTA #dsmow324#4;
      #dsmow324#5  = #dsmow326#5;  |PINTA #dsmow324#5;
      #dsmow324#6  = #dsmow326#6;  |PINTA #dsmow324#6;
      #dsmow324#7  = #dsmow326#7;  |PINTA #dsmow324#7;
      #dsmow324#8  = #dsmow326#8;  |PINTA #dsmow324#8;
      #dsmow324#9  = #dsmow326#14; |PINTA #dsmow324#9;
      #dsmow324#10 = (#dsmow326#10 * 1000) + #dsmow326#11; |PINTA #dsmow324#10;
      #dsmow324#11 = #dsmow326#12; |PINTA #dsmow324#11;
      #dsmow324#12 = #dsmow326#10; |PINTA #dsmow324#10;
      #dsmow324#13 = #dsmow326#13; |PINTA #dsmow324#13;
      #dsmow324#14 = #dsmow326#15; |PINTA #dsmow324#14;

      #dsm213ca#4 = #dsmow324#0;
      #dsm213ca#5 = #dsmow324#1;
      #dsm213ca#6 = #dsmow324#2;
      #dsm213ca#7 = #dsmow324#3;
      #dsm213ca#8 = #dsmow324#4;
      #dsm213ca#9 = #dsmow324#5;
      #dsm213ca#10 = #dsmow324#6;
      #dsm213ca#11 = #dsmow324#7;
      #dsm213ca#12 = #dsmow324#8;
      #dsm213ca#13 = #dsmow324#9;
      #dsm213ca#14 = #dsmow324#10;
      #dsm213ca#15 = #dsmow324#11;
      #dsm213ca#16 = #dsmow324#12;
      #dsm213ca#17 = #dsmow324#14;
      |GRABA 020#dsm213ca.a;
   |FINSI;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent1;

   |ESTADO_CONTROL nRelSocios, "ENABLE";
   |ESTADO_CONTROL nRelInmueb, "ENABLE";
   |ESTADO_CONTROL nDatRepre, "ENABLE";
   Cmp = -1;
*/
|FPRC;

|PROCESO EvtoGrid213In;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsm213in.c;

      |ESTADO_CONTROL nModInm213, "ENABLE";
      |ESTADO_CONTROL nBorInm213, "ENABLE";

      #dsmow327#0  = #dsm213in#2;
      #dsmow327#1  = #dsm213in#3; |PINTA #dsmow327#1;
      #dsmow327#2  = #dsm213in#4; |PINTA #dsmow327#2;
      #dsmow327#3  = #dsm213in#5; |PINTA #dsmow327#3;
      #dsmow327#4  = #dsm213in#6; |PINTA #dsmow327#4;
      #dsmow327#5  = #dsm213in#7; |PINTA #dsmow327#5;
      #dsmow327#6  = #dsm213in#8; |PINTA #dsmow327#6;
      #dsmow327#7  = #dsm213in#9; |PINTA #dsmow327#7;
      #dsmow327#8  = #dsm213in#10; |PINTA #dsmow327#8;
      #dsmow327#9  = #dsm213in#11; |PINTA #dsmow327#9;
      #dsmow327#10 = #dsm213in#12; |PINTA #dsmow327#10;
      #dsmow327#11 = #dsm213in#13; |PINTA #dsmow327#11;
      #dsmow327#12 = #dsm213in#14; |PINTA #dsmow327#12;
      #dsmow327#13 = #dsm213in#15; |PINTA #dsmow327#13;

      aAlfa = #dsm213in#16; |QBF aAlfa; aAlfa = ("00000" + aAlfa) % -105;
      aAlfa1 = aAlfa % 0102; #dsmow327#14 = aAlfa1; |PINTA #dsmow327#14;
      aAlfa1 = aAlfa % 0303; #dsmow327#15 = aAlfa1; |PINTA #dsmow327#15;
      #dsmow327#16 = #dsm213in#21; |PINTA #dsmow327#16;
      #dsmow327#17 = #dsm213in#19; |PINTA #dsmow327#17;
      #dsmow327#18 = #dsm213in#20; |PINTA #dsmow327#18;
      #dsmow327#19 = #dsm213in#17; |PINTA #dsmow327#19;
      #dsmow327#20 = #dsm213in#18; |PINTA #dsmow327#20;
   |FINSI;
|FPRC;

|PROCESO EditaInm213;
   enModo = nSwModo1;
   Cmp    = -1;
   nModo  = 1;
   |VENTANA 1204, 2095, 1, 17, aTitulo; nVent2 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent2;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   InNivel = nNivel1<-;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir1 = nNivel2;
   |ESTADO_CONTROL nIdSalir1, "HIDE";

   |DDEFECTO #dsmow329;
   |SI nSwModo1 = 2;
      |C_M #dsmow329#0, 1, "N";
      #dsmow329#0 = #dsm213in#2;
      #dsmow329#1 = #dsm213in#3;
      #dsmow329#2 = #dsm213in#4;
      #dsmow329#3 = #dsm213in#5;
      #dsmow329#4 = #dsm213in#6;
      #dsmow329#5 = #dsm213in#7;
      #dsmow329#6 = #dsm213in#8;
      #dsmow329#7 = #dsm213in#9;
      #dsmow329#8 = #dsm213in#10;
      #dsmow329#9 = #dsm213in#11;
      #dsmow329#10 = #dsm213in#12;
      #dsmow329#11 = #dsm213in#13;
      #dsmow329#12 = #dsm213in#14;
      #dsmow329#13 = #dsm213in#15;
      aAlfa = #dsm213in#16; |QBF aAlfa; aAlfa = ("00000" + aAlfa) % -105;
      aAlfa1 = aAlfa % 0102; #dsmow329#14 = aAlfa1;
      aAlfa1 = aAlfa % 0303; #dsmow329#15 = aAlfa1;
      #dsmow329#16 = #dsm213in#21;
      #dsmow329#17 = #dsm213in#19;
      #dsmow329#18 = #dsm213in#20;
      #dsmow329#19 = #dsm213in#17;
      #dsmow329#20 = #dsm213in#18;
   |SINO;
      |C_M #dsmow329#0, 1, "S";
   |FINSI;

   |PINPA #0#dsmow329; nPant2 = FSalida;
   |PINDA #0#dsmow329;

   |ENDATOS #1#dsmow329;
   |SI FSalida = 0;
      |SI nSwModo1 = 1;
         |DDEFECTO #dsm213in;
         #dsm213in#0 = #dsm213ca#0;
         #dsm213in#1 = #dsm213ca#1;
         #dsm213in#2 = #dsmow329#0;
         |GRABA 020#dsm213in.c;
      |FINSI;
      #dsm213in#3 = #dsmow329#1;
      #dsm213in#4 = #dsmow329#2;
      #dsm213in#5 = #dsmow329#3;
      #dsm213in#6 = #dsmow329#4;
      #dsm213in#7 = #dsmow329#5;
      #dsm213in#8 = #dsmow329#6;
      #dsm213in#9 = #dsmow329#7;
      #dsm213in#10 = #dsmow329#8;
      #dsm213in#11 = #dsmow329#9;
      #dsm213in#12 = #dsmow329#10;
      #dsm213in#13 = #dsmow329#11;
      #dsm213in#14 = #dsmow329#12;
      #dsm213in#15 = #dsmow329#13;
      #dsm213in#16 = (#dsmow329#14 * 1000) + #dsmow329#15;
      #dsm213in#17 = #dsmow329#19;
      #dsm213in#18 = #dsmow329#20;
      #dsm213in#19 = #dsmow329#17;
      #dsm213in#20 = #dsmow329#18;
      #dsm213in#21 = #dsmow329#16;
      |GRABA 020#dsm213in.a;
   |FINSI;

   |ESTADO_CONTROL nIdSalir1, "SHOW";

   aVent4 = nVent2;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent2;

   |REFRESCACONTROL nGrid2;
|FPRC;

|PROCESO NuevoInm213;
   aTitulo = "Nuevo inmueble";
   nSwModo1 = 1; |HAZ EditaInm213;
|FPRC;

|PROCESO ModifInm213;
   aTitulo = "Modificar inmueble";
   nSwModo1 = 2; |HAZ EditaInm213;
|FPRC;

|PROCESO BorraInm213;
   aAlfa = "    N" + &191 + " Est" + &168 + " seguro de eliminar el inmueble seleccionado ? ";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |BORRA 020#dsm213in.a;

      |ESTADO_CONTROL nModInm213, "DISABLE";
      |ESTADO_CONTROL nBorInm213, "DISABLE";

      |DDEFECTO #dsmow327;
      |PINTA #dsmow327#1;  |PINTA #dsmow327#2;  |PINTA #dsmow327#3;
      |PINTA #dsmow327#4;  |PINTA #dsmow327#5;  |PINTA #dsmow327#6;
      |PINTA #dsmow327#7;  |PINTA #dsmow327#8;  |PINTA #dsmow327#9;
      |PINTA #dsmow327#10; |PINTA #dsmow327#11; |PINTA #dsmow327#12;
      |PINTA #dsmow327#13; |PINTA #dsmow327#14;

      |REFRESCACONTROL nGrid2;
   |FINSI;
|FPRC;

|PROCESO Inf213In;
   #dsm213in#0 = #dsm213ca#0;
   #dsm213in#1 = #dsm213ca#1;
   #dsm213in#2 = 1;
|FPRC;

|PROCESO Sup213In;
   #dsm213in#0 = #dsm213ca#0;
   #dsm213in#1 = #dsm213ca#1;
   #dsm213in#2 = 999;
|FPRC;

|PROCESO RelInmueb;
   InNivel = nNivel1<-;
   nNivel1 = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;

   aAlfa = "|X000WID"; nCalc = #dsmow324#aAlfa#; |ESTADO_CONTROL nCalc, "DISABLE";
   aAlfa = "|X001WID"; nCalc = #dsmow324#aAlfa#; |ESTADO_CONTROL nCalc, "DISABLE";

   |ESTADO_CONTROL nRelInmueb, "DISABLE";
   |ESTADO_CONTROL nRelSocios, "DISABLE";
   |ESTADO_CONTROL nDatRepre,  "DISABLE";

   |VENTANA 1004, 2596, 1, 17, "Relacion Inmuebles modelo 213"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |DDEFECTO #dsmow327;
   |PINPA #0#dsmow327; nPant1 = FSalida;
   |PINDA #0#dsmow327;

   nPos1 = 1456; nPos2 = 1466;
   |CONTROL_SIMPLE nPant1, "BOTON,{{137}}&Nuevo", nPos1, nPos2, NuevoInm213;
   nNueInm213 = FSalida;

   nPos1 = 1468; nPos2 = 1478;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}&Modificar", nPos1, nPos2, ModifInm213;
   nModInm213 = FSalida; |ESTADO_CONTROL nModInm213, "DISABLE";

   nPos1 = 1480; nPos2 = 1490;
   |CONTROL_SIMPLE nPant1, "BOTON,{{199}}&Borra", nPos1, nPos2, BorraInm213;
   nBorInm213 = FSalida; |ESTADO_CONTROL nBorInm213, "DISABLE";

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 0602; nPos2 = 1390;
   |LINEAL_SIMPLE #1#dsm213in, nRango, nPos1, nPos2, Inf213In, Sup213In, EvtoGrid213In;
   nGrid2 = FSalida;
   |PULSATECLA;

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Sa&Lir," + nGrid2;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
   |SIGUE;

   |FIN_CONTROL_WINDOWS nBorInm213;
   |FIN_CONTROL_WINDOWS nModInm213;
   |FIN_CONTROL_WINDOWS nNueInm213;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent1;

   |ESTADO_CONTROL nRelInmueb, "ENABLE";
   |ESTADO_CONTROL nRelSocios, "ENABLE";
   |ESTADO_CONTROL nDatRepre, "ENABLE";

   aAlfa = "|X000WID"; nCalc = #dsmow324#aAlfa#; |ESTADO_CONTROL nCalc, "ENABLE";
   aAlfa = "|X001WID"; nCalc = #dsmow324#aAlfa#; |ESTADO_CONTROL nCalc, "ENABLE";

   |HAZ ValorInmuebles;
|FPRC;

|PROCESO EvtoGrid213So;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsm213so.c;

      |ESTADO_CONTROL nModSoc213, "ENABLE";
      |ESTADO_CONTROL nBorSoc213, "ENABLE";

      #dsmow328#0  = #dsm213so#2; |PINTA #dsmow328#0;
      #dsmow328#1  = #dsm213so#3; |PINTA #dsmow328#1;
      #dsmow328#2  = #dsm213so#4; |PINTA #dsmow328#2;
      #dsmow328#3  = #dsm213so#5; |PINTA #dsmow328#3;
      #dsmow328#4  = #dsm213so#6; |PINTA #dsmow328#4;
      #dsmow328#5  = #dsm213so#7; |PINTA #dsmow328#5;

      #dsmow328#6  = #dsm213so#8; |PINTA #dsmow328#6;
      #dsmow328#7  = #dsm213so#9; |PINTA #dsmow328#7;
      #dsmow328#8  = #dsm213so#10; |PINTA #dsmow328#8;
      #dsmow328#9  = #dsm213so#11; |PINTA #dsmow328#9;
      #dsmow328#10 = #dsm213so#12; |PINTA #dsmow328#10;
      #dsmow328#11 = #dsm213so#13; |PINTA #dsmow328#11;
      #dsmow328#12 = #dsm213so#14; |PINTA #dsmow328#12;
      #dsmow328#13 = #dsm213so#15; |PINTA #dsmow328#13;
      #dsmow328#14 = #dsm213so#16; |PINTA #dsmow328#14;
      #dsmow328#15 = #dsm213so#17; |PINTA #dsmow328#15;
      #dsmow328#16 = #dsm213so#18; |PINTA #dsmow328#16;
      #dsmow328#17 = #dsm213so#19; |PINTA #dsmow328#17;
      #dsmow328#18 = #dsm213so#20; |PINTA #dsmow328#18;
      #dsmow328#19 = #dsm213so#21; |PINTA #dsmow328#19;
      #dsmow328#20 = #dsm213so#22; |PINTA #dsmow328#20;
      #dsmow328#21 = #dsm213so#23; |PINTA #dsmow328#21;
      #dsmow328#22 = #dsm213so#24; |PINTA #dsmow328#22;
      #dsmow328#23 = #dsm213so#25; |PINTA #dsmow328#23;
      #dsmow328#24 = #dsm213so#26; |PINTA #dsmow328#24;
      #dsmow328#25 = #dsm213so#27; |PINTA #dsmow328#25;
      #dsmow328#26 = #dsm213so#28; |PINTA #dsmow328#26;
      #dsmow328#27 = #dsm213so#29; |PINTA #dsmow328#27;
      #dsmow328#28 = #dsm213so#30; |PINTA #dsmow328#28;
      #dsmow328#29 = #dsm213so#31; |PINTA #dsmow328#29;
      #dsmow328#30 = #dsm213so#32; |PINTA #dsmow328#30;
      #dsmow328#31 = #dsm213so#33; |PINTA #dsmow328#31;
      #dsmow328#32 = #dsm213so#34; |PINTA #dsmow328#32;
      #dsmow328#33 = #dsm213so#35; |PINTA #dsmow328#33;
      #rpaises@#0 = #dsm213so#35;
      |LEE 000#rpaises@.=;
      |SI FSalida ! 0; |DDEFECTO #rpaises@; |FINSI;
      #dsmow328#34 = #rpaises@#1;   |PINTA #dsmow328#34;
      #dsmow328#35 = #dsm213so#36; |PINTA #dsmow328#35;
      #rpaises@#0 = #dsm213so#36;
      |LEE 000#rpaises@.=;
      |SI FSalida ! 0; |DDEFECTO #rpaises@; |FINSI;
      #dsmow328#36 = #rpaises@#1;   |PINTA #dsmow328#36;
   |FINSI;
|FPRC;

|PROCESO EditaSoc213;
   enModo = nSwModo1;
   Cmp = 1;
   nModo = 1;
   |VENTANA 0709, 2691, 1, 17, aTitulo; nVent2 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent2;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   InNivel = nNivel1<-;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir1 = nNivel2;
   |ESTADO_CONTROL nIdSalir1, "HIDE";

   |DDEFECTO #dsmow330;
   |SI nSwModo1 = 2;
      |C_M #dsmow330#0, 1, "N";
      #dsmow330#0 = #dsm213so#2;
      #dsmow330#1 = #dsm213so#3;
      #dsmow330#2 = #dsm213so#4;
      #dsmow330#3 = #dsm213so#5;
      #dsmow330#4 = #dsm213so#6;
      #dsmow330#5 = #dsm213so#7;
      #dsmow330#6 = #dsm213so#8;
      #dsmow330#7 = #dsm213so#9;
      #dsmow330#8 = #dsm213so#10;
      #dsmow330#9 = #dsm213so#11;
      #dsmow330#10 = #dsm213so#12;
      #dsmow330#11 = #dsm213so#13;
      #dsmow330#12 = #dsm213so#14;
      #dsmow330#13 = #dsm213so#15;
      #dsmow330#14 = #dsm213so#16;
      #dsmow330#15 = #dsm213so#17;
      #dsmow330#16 = #dsm213so#18;
      #dsmow330#17 = #dsm213so#19;
      #dsmow330#18 = #dsm213so#20;
      #dsmow330#19 = #dsm213so#21;
      #dsmow330#20 = #dsm213so#22;
      #dsmow330#21 = #dsm213so#23;
      #dsmow330#22 = #dsm213so#24;
      #dsmow330#23 = #dsm213so#25;
      #dsmow330#24 = #dsm213so#26;
      #dsmow330#25 = #dsm213so#27;
      #dsmow330#26 = #dsm213so#28;
      #dsmow330#27 = #dsm213so#29;
      #dsmow330#28 = #dsm213so#30;
      #dsmow330#29 = #dsm213so#31;
      #dsmow330#30 = #dsm213so#32;
      #dsmow330#31 = #dsm213so#33;
      #dsmow330#32 = #dsm213so#34;
      #dsmow330#33 = #dsm213so#35;
      #rpaises@#0 = #dsm213so#35;
      |LEE 000#rpaises@.=;
      |SI FSalida ! 0; |DDEFECTO #rpaises@; |FINSI;
      #dsmow330#34 = #rpaises@#1;
      #dsmow330#35 = #dsm213so#36;
      #rpaises@#0 = #dsm213so#36;
      |LEE 000#rpaises@.=;
      |SI FSalida ! 0; |DDEFECTO #rpaises@; |FINSI;
      #dsmow330#36 = #rpaises@#1;
   |SINO;
      |C_M #dsmow330#0, 1, "S";
   |FINSI;

   |PINPA #0#dsmow330; nPant2 = FSalida;
   |PINDA #0#dsmow330;

   |ENDATOS #1#dsmow330;
   |SI FSalida = 0;
      |SI nSwModo1 = 1;
         |DDEFECTO #dsm213so;
         #dsm213so#0 = #dsm213ca#0;
         #dsm213so#1 = #dsm213ca#1;
         #dsm213so#2 = #dsmow330#0;
         |GRABA 020#dsm213so.c;
      |FINSI;
      #dsm213so#3 = #dsmow330#1;
      #dsm213so#4 = #dsmow330#2;
      #dsm213so#5 = #dsmow330#3;
      #dsm213so#6 = #dsmow330#4;
      #dsm213so#7 = #dsmow330#5;
      #dsm213so#8 = #dsmow330#6;
      #dsm213so#9 = #dsmow330#7;
      #dsm213so#10 = #dsmow330#8;
      #dsm213so#11 = #dsmow330#9;
      #dsm213so#12 = #dsmow330#10;
      #dsm213so#13 = #dsmow330#11;
      #dsm213so#14 = #dsmow330#12;
      #dsm213so#15 = #dsmow330#13;
      #dsm213so#16 = #dsmow330#14;
      #dsm213so#17 = #dsmow330#15;
      #dsm213so#18 = #dsmow330#16;
      #dsm213so#19 = #dsmow330#17;
      #dsm213so#20 = #dsmow330#18;
      #dsm213so#21 = #dsmow330#19;
      #dsm213so#22 = #dsmow330#20;
      #dsm213so#23 = #dsmow330#21;
      #dsm213so#24 = #dsmow330#22;
      #dsm213so#25 = #dsmow330#23;
      #dsm213so#26 = #dsmow330#24;
      #dsm213so#27 = #dsmow330#25;
      #dsm213so#28 = #dsmow330#26;
      #dsm213so#29 = #dsmow330#27;
      #dsm213so#30 = #dsmow330#28;
      #dsm213so#31 = #dsmow330#29;
      #dsm213so#32 = #dsmow330#30;
      #dsm213so#33 = #dsmow330#31;
      #dsm213so#34 = #dsmow330#32;
      #dsm213so#35 = #dsmow330#33;
      #dsm213so#36 = #dsmow330#35;
      |GRABA 020#dsm213so.a;
   |FINSI;

   |ESTADO_CONTROL nIdSalir1, "SHOW";

   aVent4 = nVent2;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent2;

   Cmp = -1;
   |REFRESCACONTROL nGrid2;
|FPRC;

|PROCESO NuevoSoc213;
   aTitulo = "Nuevo socio";
   nSwModo1 = 1; |HAZ EditaSoc213;
|FPRC;

|PROCESO ModifSoc213;
   aTitulo = "Modificar socio";
   nSwModo1 = 2; |HAZ EditaSoc213;
|FPRC;

|PROCESO BorraSoc213;
   aAlfa = "    N" + &191 + " Est" + &168 + " seguro de eliminar el socio seleccionado ? ";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |BORRA 020#dsm213so.a;

      |ESTADO_CONTROL nModSoc213, "DISABLE";
      |ESTADO_CONTROL nBorSoc213, "DISABLE";

      |DDEFECTO #dsmow328;
      |PINTA #dsmow328#1;  |PINTA #dsmow328#2;  |PINTA #dsmow328#3;
      |PINTA #dsmow328#4;  |PINTA #dsmow328#5;  |PINTA #dsmow328#6;
      |PINTA #dsmow328#7;  |PINTA #dsmow328#8;  |PINTA #dsmow328#9;
      |PINTA #dsmow328#10; |PINTA #dsmow328#11; |PINTA #dsmow328#12;
      |PINTA #dsmow328#13; |PINTA #dsmow328#14; |PINTA #dsmow328#15;

      |REFRESCACONTROL nGrid2;
   |FINSI;
|FPRC;

|PROCESO Inf213So;
   #dsm213so#0 = #dsm213ca#0;
   #dsm213so#1 = #dsm213ca#1;
   #dsm213so#2 = "               ";
|FPRC;

|PROCESO Sup213So;
   #dsm213so#0 = #dsm213ca#0;
   #dsm213so#1 = #dsm213ca#1;
   #dsm213so#2 = "zzzzzzzzzzzzzzz";
|FPRC;

|PROCESO RelSocios;
   InNivel = nNivel1<-;
   nNivel1 = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;

   aAlfa = "|X000WID"; nCalc = #dsmow324#aAlfa#; |ESTADO_CONTROL nCalc, "DISABLE";
   aAlfa = "|X001WID"; nCalc = #dsmow324#aAlfa#; |ESTADO_CONTROL nCalc, "DISABLE";

   |ESTADO_CONTROL nRelInmueb, "DISABLE";
   |ESTADO_CONTROL nRelSocios, "DISABLE";
   |ESTADO_CONTROL nDatRepre,  "DISABLE";

   |VENTANA 0510, 3089, 1, 17, "Relacion socios modelo 213"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |DDEFECTO #dsmow328;
   |PINPA #0#dsmow328; nPant1 = FSalida;
   |PINDA #0#dsmow328;

   nPos1 = 1245; nPos2 = 1255;
   |CONTROL_SIMPLE nPant1, "BOTON,{{137}}&Nuevo", nPos1, nPos2, NuevoSoc213;
   nNueSoc213 = FSalida;

   nPos1 = 1257; nPos2 = 1267;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}&Modificar", nPos1, nPos2, ModifSoc213;
   nModSoc213 = FSalida; |ESTADO_CONTROL nModSoc213, "DISABLE";

   nPos1 = 1269; nPos2 = 1279;
   |CONTROL_SIMPLE nPant1, "BOTON,{{199}}&Borra", nPos1, nPos2, BorraSoc213;
   nBorSoc213 = FSalida; |ESTADO_CONTROL nBorSoc213, "DISABLE";

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 0602; nPos2 = 1179;
   |LINEAL_SIMPLE #1#dsm213so, nRango, nPos1, nPos2, Inf213So, Sup213So, EvtoGrid213So;
   nGrid2 = FSalida;
   |PULSATECLA;

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Sa&Lir," + nGrid2;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
   |SIGUE;

   |FIN_CONTROL_WINDOWS nBorSoc213;
   |FIN_CONTROL_WINDOWS nModSoc213;
   |FIN_CONTROL_WINDOWS nNueSoc213;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent1;

   |ESTADO_CONTROL nRelInmueb, "ENABLE";
   |ESTADO_CONTROL nRelSocios, "ENABLE";
   |ESTADO_CONTROL nDatRepre, "ENABLE";

   aAlfa = "|X000WID"; nCalc = #dsmow324#aAlfa#; |ESTADO_CONTROL nCalc, "ENABLE";
   aAlfa = "|X001WID"; nCalc = #dsmow324#aAlfa#; |ESTADO_CONTROL nCalc, "ENABLE";
|FPRC;

|PROCESO EditaDeleg;
   |SI nSwModo = 1;
      Cmp = -1;
      nModo = 1;
      |VENTANA 1222, 1678, 1, 17, aTitulo; nVent1 = FSalida;
      aVent1 = -1;
      aVent2 = -1;
      aVent3 = 0;
      aVent4 = nVent1;
      aVent5 = "MODAL";
      |ESPECIFICA "ESTADO_VENTANA", aVent;

      InNivel = nNivel1<-;
      |ESPECIFICA "IDBOTONTECLA", nNivel;
      nIdSalir = nNivel2;

      |DDEFECTO #dsmow325; |DDEFECTO #dsmow325;
      |PINPA #0#dsmow325; nPant1 = FSalida;
      |PINDA #0#dsmow325;

      |ENDATOS #1#dsmow325;
      |SI FSalida = 0;
         |DDEFECTO #dsm213ca;
         #dsm213ca#0 = #dsm210dp#0;
         nCalc = (#dsmow325#0 * 1000) + #dsmow325#1;
         #dsm213ca#1 = nCalc;
         #dsm213ca#2 = #dsmow325#2;
         #dsm213ca#3 = #dsmow325#3;
         |GRABA 020#dsm213ca.c;

         aVent4 = nVent1;
         aVent5 = "MODELESS";
         |ESPECIFICA "ESTADO_VENTANA", aVent;
         |FINVENTANA nVent1;

         |DDEFECTO #dsmow324;
      |SINO;
         aVent4 = nVent1;
         aVent5 = "MODELESS";
         |ESPECIFICA "ESTADO_VENTANA", aVent;
         |FINVENTANA nVent1;

         |FOCOTECLADO nGrid1;
         |ACABA;
      |FINSI;

      |REFRESCACONTROL nGrid1;
   |FINSI;

   InNivel = nNivel1<-;
   nNivel1 = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;

   |C_M #dsmow324#0, 1, "S"; |C_M #dsmow324#1, 1, "S";
   |C_M #dsmow324#2, 1, "S"; |C_M #dsmow324#3, 1, "S";

   |PINDA #0#dsmow324;
   |PINTA #dsmow324#15; |PINTA #dsmow324#16;
   |PINTA #dsmow324#17; |PINTA #dsmow324#18;
   |PINTA #dsmow324#19;

   |ESTADO_CONTROL nNueDel213, "DISABLE";
   |ESTADO_CONTROL nModDel213, "DISABLE";
   |ESTADO_CONTROL nBorDel213, "DISABLE";
   |ESTADO_CONTROL nGrid1, "DISABLE";
   |ESTADO_CONTROL nRelSocios, "ENABLE";
   |ESTADO_CONTROL nRelInmueb, "ENABLE";
   |ESTADO_CONTROL nDatRepre, "ENABLE";
   |ESTADO_CONTROL nIdSalir, "HIDE";

   |ENDATOS #1#dsmow324;
   |SI FSalida = 0;
      |SI #dsmow324#0 = "S"; #dsm213ca#4 = "1"; |FINSI;
      |SI #dsmow324#1 = "S"; #dsm213ca#4 = "2"; |FINSI;
      |SI #dsmow324#2 = "S"; #dsm213ca#4 = "3"; |FINSI;
      |SI #dsmow324#3 = "S"; #dsm213ca#4 = "4"; |FINSI;
      #dsm213ca#5  = #dsmow324#4;
      #dsm213ca#6  = #dsmow324#5;
      #dsm213ca#7  = #dsmow324#6;
      #dsm213ca#8  = #dsmow324#7;
      #dsm213ca#9  = #dsmow324#8;
      #dsm213ca#10 = #dsmow324#9;
      #dsm213ca#11 = #dsmow324#10;
      #dsm213ca#12 = #dsmow324#11;
      #dsm213ca#13 = #dsmow324#12;
      |SI #dsmow324#13 = "S";
         #dsm213ca#14 = "E";
         #dsm213ca#15 = ""; #dsm213ca#16 = "";
         #dsm213ca#17 = ""; #dsm213ca#18 = "";
         #dsm213ca#19 = "";
      |FINSI;
      |SI #dsmow324#14 = "S";
         #dsm213ca#14 = "A";
         #dsm213ca#15 = #dsmow324#15;
         #dsm213ca#16 = #dsmow324#16;
         #dsm213ca#17 = #dsmow324#17;
         #dsm213ca#18 = #dsmow324#18;
         #dsm213ca#19 = #dsmow324#19;
      |FINSI;

      |HAZ CuentaRegs213;
      |GRABA 020#dsm213ca.a;
   |SINO;
      |SI nSwModo = 1;
         |MENAV "    Proceso cancelado";
         |BORRA 020#dsm213ca.a;
      |FINSI;
   |FINSI;

   |ESTADO_CONTROL nNueDel213, "ENABLE";
   |ESTADO_CONTROL nGrid1, "ENABLE";
   |ESTADO_CONTROL nRelSocios, "DISABLE";
   |ESTADO_CONTROL nRelInmueb, "DISABLE";
   |ESTADO_CONTROL nDatRepre, "DISABLE";
   |ESTADO_CONTROL nIdSalir, "SHOW";

   |C_M #dsmow324#0, 1, "N"; |C_M #dsmow324#1, 1, "N";
   |C_M #dsmow324#2, 1, "N"; |C_M #dsmow324#3, 1, "N";

   |REFRESCACONTROL nGrid1;
|FPRC;

|PROCESO NueDel213;
   nSwModo = 1; aTitulo = "Nueva delegación"; |HAZ EditaDeleg;
   |REFRESCACONTROL nGrid1;
|FPRC;

|PROCESO ModDel213;
   nSwModo = 2; aTitulo = "Modificar delegación"; |HAZ EditaDeleg;
   |REFRESCACONTROL nGrid1;
|FPRC;

|PROCESO BorraInms;
   |BORRA 020#dsm213in.a;
|FPRC;

|DEFBUCLE BorraInms;
#dsm213in#1;
;
#dsm213ca#0, #dsm213ca#1, 001;
#dsm213ca#0, #dsm213ca#1, 999;
be;
NULL, BorraInms;
|FIN;

|PROCESO BorraSocs;
   |BORRA 020#dsm213so.a;
|FPRC;

|DEFBUCLE BorraSocs;
#dsm213so#1;
;
#dsm213ca#0, #dsm213ca#1, "               ";
#dsm213ca#0, #dsm213ca#1, "zzzzzzzzzzzzzzz";
be;
NULL, BorraSocs;
|FIN;

|PROCESO BorDel213;
   aAlfa = "    N" + &191 + " Est" + &168 + " seguro de eliminar el modelo seleccionado ? ";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |BUCLE BorraInms; |BUCLE BorraSocs;
      |BORRA 020#dsm213ca.a;

      |ESTADO_CONTROL nModDel213, "DISABLE";
      |ESTADO_CONTROL nBorDel213, "DISABLE";

      |REFRESCACONTROL nGrid1;
   |FINSI;
|FPRC;

|PROCESO Inf213ca;
   #dsm213ca#0 = #dsm210dp#0;
   #dsm213ca#1 = 00001;
|FPRC;

|PROCESO Sup213ca;
   #dsm213ca#0 = #dsm210dp#0;
   #dsm213ca#1 = 99999;
|FPRC;

|PROCESO PideEjercicio;
   |VENTANA 1434, 1665, -1, 17, "Indique el ejercicio del modelo"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |CONTROL_SIMPLE 0, "LABEL,{{7}}Ejercicio : ", 1543, 1551, NULL;

   |ABRE #dsmow310;
   #dsmow310#13 = "";
   |LEE 000#dsmow310.=;
   |SI FSalida ! 0;
      |DDEFECTO #dsmow310;
      |GRABA 020#dsmow310.c;
   |FINSI;

   enEjercicio = #dsmow310#12;
   E_sup = 9999; E_inf = 0;
   enEjercicio = 1552 ? 1;
   |SI FSalida = 0;
      #dsmow310#12 = enEjercicio;
      |GRABA 020#dsmow310.a;
   |FINSI;
   |CIERRA #dsmow310;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent1;
|FPRC;

|PROCESO CompruebaDatosAdi;
   aAlfa = #dsm210dp#62; |QBF aAlfa;
   |SI aAlfa = "";
      aAlfa = "Los siguientes campos son necesarios en el modelo. Rellenelos por favor";
      |VENTANA 1414, 1786, -1, 17, aAlfa; nVent1 = FSalida;
      aVent1 = -1;
      aVent2 = -1;
      aVent3 = 0;
      aVent4 = nVent1;
      aVent5 = "MODAL";
      |ESPECIFICA "ESTADO_VENTANA", aVent;

      |PINPA #0#dsmow333; nPant2 = FSalida;
      |PINDA #0#dsmow333;

      |ENDATOS #1#dsmow333;
      |SI FSalida = 0;
         #dsm210dp#62 = #dsmow333#0;
         #dsm210dp#63 = #dsmow333#1;
         |GRABA 020#dsm210dp.a;
      |FINSI;

      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1;
   |FINSI;
|FPRC;

|PROCESO EntraDatos213;
   aAlfa = "Modelo 213 : Contribuyente [" + (("00000" + #dsm213ca#0) % -105) + "] ";
   aAlfa = aAlfa + #dsm210dp#1; |QBF aAlfa;
   aAlfa = aAlfa + "    CIF " + #dsm210dp#2;
   |VENTANA 0501, 3199, 1, 17, aAlfa; nVent0 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent0;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |ABRE #dsm213ca;
   |ABRE #dsm213in; |ABRE #dsm213so;
   |ABRE #dsminmex;
   |ABRE #dsmivcex;

   |DDEFECTO #dsmow324;
   |PINPA #0#dsmow324; nPant1 = FSalida;
   |PINDA #0#dsmow324;

   nNumSPant = 0;

   nPos1 = 1164; nPos2 = 1174;
   |CONTROL_SIMPLE nPant1, "BOTON,{{137}}&Nuevo", nPos1, nPos2, NueDel213;
   nNueDel213 = FSalida;

   nPos1 = 1176; nPos2 = 1186;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}&Modificar", nPos1, nPos2, ModDel213;
   nModDel213 = FSalida; |ESTADO_CONTROL nModDel213, "DISABLE";

   nPos1 = 1188; nPos2 = 1198;
   |CONTROL_SIMPLE nPant1, "BOTON,{{199}}&Borrar", nPos1, nPos2, BorDel213;
   nBorDel213 = FSalida; |ESTADO_CONTROL nBorDel213, "DISABLE";

   nPos1 = 2284; nPos2 = 2298;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}&Inmuebles", nPos1, nPos2, RelInmueb;
   nRelInmueb = FSalida; |ESTADO_CONTROL nRelInmueb, "DISABLE";

   nPos1 = 2484; nPos2 = 2498;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}So&Cios", nPos1, nPos2, RelSocios;
   nRelSocios = FSalida; |ESTADO_CONTROL nRelSocios, "DISABLE";

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 0602; nPos2 = 1098;
   |LINEAL_SIMPLE #1#dsm213ca, nRango, nPos1, nPos2, Inf213ca, Sup213ca, EvtoGrid213a;
   nGrid1 = FSalida;
   |PULSATECLA;

   |HAZ CompruebaDatosAdi;
   |HAZ PideEjercicio;

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Sa&Lir," + nGrid1;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
   |SIGUE;

   |FIN_CONTROL_WINDOWS nNueDel213;
   |FIN_CONTROL_WINDOWS nModDel213;
   |FIN_CONTROL_WINDOWS nBorDel213;

   |DESTRUYECONTROL nGrid1;

   aVent4 = nVent0;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |CIERRA #dsm213so; |CIERRA #dsm213in;
   |CIERRA #dsminmex;
   |CIERRA #dsmivcex; |CIERRA #dsm213ca;

   |FINVENTANA nVent0;
|FPRC;

/***************************************************************************
*********                       FIN MODELO 213                     *********
****************************************************************************/

/***************************************************************************
*********                     EMISION MODELO 213                   *********
****************************************************************************/

|PROCESO Emite213Papel;
/*
   aAlfa = Usuario; |QBT aAlfa;    aAlfa = ("c" + aAlfa) % 108;
   |NOME_DAT #pdfimtmp#aAlfa#; |DELINDEX #pdfimtmp; |ABRE #pdfimtmp;

   #dsm213ca#0 = #dsm210dp#0;
   #dsm213ca#1 = #dsmow332#0;
   |LEE 000#dsm213ca.=;
   |SI FSalida ! 0; |DDEFECTO #dsm213ca; |FINSI;

   #rpaises@#0 = #dsm210dp#33;
   |LEE 000#rpaises@.=;
   |SI FSalida ! 0; |DDEFECTO #rpaises@; |FINSI;

   aDato = "cabecera.1"; aValor = #dsmow332#1; |HAZ GrabaTmpPdf;
   aDato = "cabecera.2"; aValor = #dsmow332#2; |HAZ GrabaTmpPdf;
   aDato = "cabecera.3"; aValor = #dsmow332#0; |HAZ GrabaTmpPdf;
   aDato = "dato.a.nif.1";  aValor = #dsm210dp#2; |HAZ GrabaTmpPdf;
   aDato = "dato.2";  aValor = #dsm210dp#1; |HAZ GrabaTmpPdf;
   aValor = #dsm210dp#8; |QBF aValor;
   |SI aValor ! ""; aValor = aValor + " "; |FINSI;
   aValor = aValor + #dsm210dp#9; |QBF aValor;
   aDato = "dato.3"; |HAZ GrabaTmpPdf;
   aDato = "dato.4"; aValor = #dsm210dp#11; |HAZ GrabaTmpPdf;
   aDato = "dato.5"; aValor = #dsm210dp#15; |HAZ GrabaTmpPdf;
   aDato = "dato.6"; aValor = #dsm210dp#16; |HAZ GrabaTmpPdf;
   aDato = "dato.7"; aValor = #dsm210dp#17; |HAZ GrabaTmpPdf;
   aValor = #dsm210dp#24; |QBF aValor;
   |SI aValor = "";
      aValor = #dsm210dp#25; |QBF aValor;
      |SI aValor = "";
         aValor = #dsm210dp#26; |QBF aValor;
      |FINSI;
   |FINSI;
   aDato = "dato.8"; |HAZ GrabaTmpPdf;
   aValor = (("00" + #dsm210dp#20) % -102) + (("000" + #dsm210dp#20) % -103);
   aDato = "dato.9"; |HAZ GrabaTmpPdf;
   aDato = "dato.10"; aValor = #dsm210dp#22; |HAZ GrabaTmpPdf;
   aDato = "dato.11"; aValor = #dsm210dp#23; |HAZ GrabaTmpPdf;
   aValor = #dsm210dp#27; |QBF aValor; aValor = aValor + #dsm210dp#28; |QBF aValor;
   aDato = "dato.12"; |HAZ GrabaTmpPdf;
   aDato = "dato.14"; aValor = #rpaises@#1;   |HAZ GrabaTmpPdf;
   aDato = "dato.15"; aValor = #dsm210dp#33;  |HAZ GrabaTmpPdf;
   aDato = "dato.16"; aValor = #dsm210dp#62;  |HAZ GrabaTmpPdf;

   aDato = "dato.a.nif.2";  aValor = #dsm213ca#4; |HAZ GrabaTmpPdf;
   aDato = "dato.17"; aValor = #dsm213ca#5;  |HAZ GrabaTmpPdf;
   aValor = #dsm213ca#6; |QBF aValor;
   |SI aValor ! ""; aValor = aValor + " "; |FINSI;
   aValor = aValor + #dsm213ca#7; |QBF aValor;
   aDato = "dato.18";                         |HAZ GrabaTmpPdf;
   aDato = "dato.19"; aValor = #dsm213ca#8;  |HAZ GrabaTmpPdf;
   aDato = "dato.20"; aValor = #dsm213ca#10;  |HAZ GrabaTmpPdf;
   aDato = "dato.21"; aValor = #dsm213ca#11;  |HAZ GrabaTmpPdf;
   aDato = "dato.22"; aValor = #dsm213ca#12;  |HAZ GrabaTmpPdf;
   aDato = "dato.23"; aValor = #dsm213ca#13;  |HAZ GrabaTmpPdf;
   aDato = "dato.24"; aValor = #dsm213ca#14;  |HAZ GrabaTmpPdf;
   aDato = "dato.25"; aValor = #dsm213ca#15;  |HAZ GrabaTmpPdf;

   #reprovi@#0 = #dsm213ca#16;
   |LEE 000#reprovi@.=;
   |SI FSalida ! 0; |DDEFECTO #reprovi@; |FINSI;
   aDato = "dato.26"; aValor = #reprovi@#1;  |HAZ GrabaTmpPdf;
   aAlfa = #dsm213ca#17; |QBF aAlfa;
   aAlfa1 = aAlfa % 0102; aDato = "dato.27"; aValor = aAlfa1;  |HAZ GrabaTmpPdf;
   aAlfa1 = aAlfa % 0402; aDato = "dato.28"; aValor = aAlfa1;  |HAZ GrabaTmpPdf;
   aAlfa1 = aAlfa % 0704; aDato = "dato.29"; aValor = aAlfa1;  |HAZ GrabaTmpPdf;
   |SI #dsm213ca#18 = 1;
      aDato = "dato.a.30"; aValor = "Sí";  |HAZ GrabaTmpPdf;
      aDato = "dato.a.31"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.a.32"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.a.33"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.30.2"; aValor = "Sí";  |HAZ GrabaTmpPdf;
      aDato = "dato.31.2"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.32.2"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.33.2"; aValor = "Off";   |HAZ GrabaTmpPdf;
   |FINSI;
   |SI #dsm213ca#18 = 2;
      aDato = "dato.a.30"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.a.31"; aValor = "Sí";  |HAZ GrabaTmpPdf;
      aDato = "dato.a.32"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.a.33"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.30.2"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.31.2"; aValor = "Sí";  |HAZ GrabaTmpPdf;
      aDato = "dato.32.2"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.33.2"; aValor = "Off";   |HAZ GrabaTmpPdf;
   |FINSI;
   |SI #dsm213ca#18 = 3;
      aDato = "dato.a.30"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.a.31"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.a.32"; aValor = "Sí";  |HAZ GrabaTmpPdf;
      aDato = "dato.a.33"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.30.2"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.31.2"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.32.2"; aValor = "Sí";  |HAZ GrabaTmpPdf;
      aDato = "dato.33.2"; aValor = "Off";   |HAZ GrabaTmpPdf;
   |FINSI;
   |SI #dsm213ca#18 = 4;
      aDato = "dato.a.30"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.a.31"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.a.32"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.a.33"; aValor = "Sí";  |HAZ GrabaTmpPdf;
      aDato = "dato.30.2"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.31.2"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.32.2"; aValor = "Off";   |HAZ GrabaTmpPdf;
      aDato = "dato.33.2"; aValor = "Sí";  |HAZ GrabaTmpPdf;
   |FINSI;
   aDato = "dato.34"; aValor = #dsm213ca#19;  |HAZ GrabaTmpPdf;
   aDato = "dato.35"; aValor = #dsm213ca#20;  |HAZ GrabaTmpPdf;
   aDato = "dato.36"; aValor = #dsm213ca#21;  |HAZ GrabaTmpPdf;
   aDato = "dato.37"; aValor = #dsm213ca#22;  |HAZ GrabaTmpPdf;
   aDato = "dato.38"; aValor = #dsm213ca#23;  |HAZ GrabaTmpPdf;
   aDato = "dato.39"; aValor = #dsm213ca#24;  |HAZ GrabaTmpPdf;
   |SI #dsm213ca#25 [ 0;
      aDato = "dato.a.40"; aValor = "Sí";  |HAZ GrabaTmpPdf;
      aDato = "dato.40.2"; aValor = "Sí";  |HAZ GrabaTmpPdf;
   |SINO;
      aDato = "dato.a.40"; aValor = "Off";  |HAZ GrabaTmpPdf;
      aDato = "dato.40.2"; aValor = "Off";  |HAZ GrabaTmpPdf;
   |FINSI;

   fFecha = ~; fFecha = fFecha % 2; aAlfa = fFecha;
   aAlfa = aAlfa % 1199; |QBF aAlfa;
   aDato = "dato.41"; aValor = aAlfa;         |HAZ GrabaTmpPdf;
   aDato = "dato.42"; aValor = #dsm213ca#24;  |HAZ GrabaTmpPdf;

   nDato = 48; nContInm = 0;
   #dsm213in#0 = #dsm213ca#0;
   #dsm213in#1 = #dsm213ca#1;
   #dsm213in#2 = 1;
   |LEE 000#dsm213in.];
   |PARA; |SI FSalida = 0; |Y #dsm213in#0 = #dsm213ca#0; |Y #dsm213in#1 = #dsm213ca#1; |HACIENDO;
      nContInm = nContInm + 1; |SI nContInm > 7; |SAL; |FINSI;
      aDato = "dato." + nDato; aValor = nContInm; |HAZ GrabaTmpPdf;
      nDato = nDato + 1; aValor = #dsm213in#4; |QBF aValor; |SI aValor ! ""; aValor = aValor + " "; |FINSI;
      aValor = aValor + #dsm213in#5; |QBF aValor;
      aDato = "dato." + nDato;                    |HAZ GrabaTmpPdf;
      nDato = nDato + 1;
      aDato = "dato." + nDato; aValor = #dsm213in#6;  |HAZ GrabaTmpPdf;
      nDato = nDato + 1;
      aDato = "dato." + nDato; aValor = #dsm213in#8;  |HAZ GrabaTmpPdf;
      nDato = nDato + 1;
      aDato = "dato." + nDato; aValor = #dsm213in#9;  |HAZ GrabaTmpPdf;
      nDato = nDato + 1;
      aDato = "dato." + nDato; aValor = #dsm213in#10; |HAZ GrabaTmpPdf;
      nDato = nDato + 1;
      aDato = "dato." + nDato; aValor = #dsm213in#16; |HAZ GrabaTmpPdf;
      nDato = nDato + 1;
      aDato = "dato." + nDato; aValor = #dsm213in#14; |HAZ GrabaTmpPdf;
      nDato = nDato + 1;
      aDato = "dato." + nDato; aValor = #dsm213in#15; |HAZ GrabaTmpPdf;
      nDato = nDato + 1;
      aDato = "dato." + nDato; aValor = #dsm213in#11; |HAZ GrabaTmpPdf;
      nDato = nDato + 1;
      aDato = "dato." + nDato; aValor = #dsm213in#12; |HAZ GrabaTmpPdf;
      nDato = nDato + 1;
      aDato = "dato." + nDato; aValor = #dsm213in#13; |HAZ GrabaTmpPdf;
      nDato = nDato + 1;
      |LEE 000#dsm213in.s;
   |SIGUE;

   aDato = "dato.140"; aValor = #dsm210dp#1;   |HAZ GrabaTmpPdf;
   aDato = "dato.141";|HAZ GrabaTmpPdf;
   aDato = "dato.142"; aValor = #rpaises@#1;   |HAZ GrabaTmpPdf;
   aDato = "dato.143"; aValor = #dsm210dp#33; |HAZ GrabaTmpPdf;
   aDato = "dato.144"; aValor = #dsm210dp#62; |HAZ GrabaTmpPdf;
   aDato = "dato.145"; aValor = #dsm213ca#22; |HAZ GrabaTmpPdf;

   nDato = 146; nContSoc = 0;
   #dsm213so#0 = #dsm213ca#0;
   #dsm213so#1 = #dsm213ca#1;
   #dsm213so#2 = "";
   |LEE 000#dsm213so.];
   |PARA; |SI FSalida = 0; |Y #dsm213so#0 = #dsm213ca#0; |Y #dsm213so#1 = #dsm213ca#1; |HACIENDO;
      nContSoc = nContSoc + 1; |SI nContSoc > 7; |SAL; |FINSI;

      aValor = #dsm213so#2; |QBF aValor;
      FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aValor = aValor - "-"; |SIGUE;
      FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aValor = aValor - "."; |SIGUE;
      aDato = "dato." + nDato;                      |HAZ GrabaTmpPdf;
      nDato = nDato + 1; aValor = #dsm213so#3; |QBF aValor; aValor = aValor + #dsm213in#5; |QBF aValor;
      aValor =          #dsm213so#4; |QBF aValor; |SI aValor ! ""; aValor = aValor + " "; |FINSI;
      aValor = aValor + #dsm213so#5; |QBF aValor; |SI aValor ! ""; aValor = aValor + ", "; |FINSI;
      aValor = aValor + #dsm213so#6; |QBF aValor; |SI aValor ! ""; aValor = aValor + ", "; |FINSI;
      aValor = aValor + #dsm213so#7; |QBF aValor; |SI aValor ! ""; aValor = aValor + ", "; |FINSI;
      aValor = aValor + #dsm213so#8; |QBF aValor; |SI aValor ! ""; aValor = aValor + ", "; |FINSI;
      aValor = aValor + #dsm213so#9; |QBF aValor; |SI aValor ! ""; aValor = aValor + ", "; |FINSI;
      aValor = aValor + #dsm213so#10; |QBF aValor;
      nDato = nDato + 1;                            |HAZ GrabaTmpPdf;
      nDato = nDato + 1; aValor = #dsm213so#14; |HAZ GrabaTmpPdf;
      nDato = nDato + 1; aValor = #dsm213so#16; |HAZ GrabaTmpPdf;
      nDato = nDato + 1; aValor = #dsm213so#15; |HAZ GrabaTmpPdf;
      nDato = nDato + 1;
      |LEE 000#dsm213so.s;
   |SIGUE;

   |CIERRA #pdfimtmp;

   aArchivo = "mod213_2010.pdf"; |SUB_EJECUTA "pdfimpre";
*/
|FPRC;
/*
|PROCESO Pagina1;
   aAlfa = "<T21301> "; |XGRABA nHandle, aAlfa;
   aAlfa = #dsmow332#3; |XGRABA nHandle, aAlfa;
   TipoDato = "A"; LongDec = 0;
   aAlfa = #dsm210dp#2; |QBF aAlfa;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aAlfa = aAlfa - "."; |SIGUE;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aAlfa = aAlfa - "-"; |SIGUE;
   TipoDato = "A";
   Long = 9;                        |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 90; aAlfa = #dsm210dp#1;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 35; aAlfa = "";           |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   aAlfa = "20100A"; |XGRABA nHandle, aAlfa;
   Long = 15; aAlfa = #dsm210dp#61; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 2;  aAlfa = #dsm210dp#33; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 20; aAlfa = #dsm210dp#62; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   aAlfa = #dsm210dp#8; |QBF aAlfa; |SI aAlfa ! ""; aAlfa = aAlfa + " "; |FINSI;
   aAlfa = #dsm210dp#9; |QBF aAlfa; |SI aAlfa ! ""; aAlfa = aAlfa + ", "; |FINSI;
   aAlfa = #dsm210dp#11; |QBF aAlfa; |SI aAlfa ! ""; aAlfa = aAlfa + ", "; |FINSI;
   aAlfa = #dsm210dp#15; |QBF aAlfa; |SI aAlfa ! ""; aAlfa = aAlfa + ", "; |FINSI;
   aAlfa = #dsm210dp#16; |QBF aAlfa; |SI aAlfa ! ""; aAlfa = aAlfa + ", "; |FINSI;
   aAlfa = #dsm210dp#17; |QBF aAlfa;
   aLong = aAlfa % 0; nLong = aLong;
   |SI nLong > 50;
      aAlfa1 = aAlfa % 0150;
      aAlfa2 = aAlfa1 % -101;
      |PARA; |SI aAlfa2 ! " "; |Y aAlfa2 ! ","; |Y aAlfa2 ! ";"; |HACIENDO;
         aAlfa1 = aAlfa1 % -299;
         aAlfa2 = aAlfa1 % -101;
      |SIGUE;
      aAlfa2 = aAlfa - aAlfa1;
      Long = 50; aAlfa = Alfa1;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 40; aAlfa = Alfa2;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   |SINO;
      Long = 50;                 |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 40; aAlfa = "";     |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   |FINSI;
   Long = 30;  aAlfa = #dsm210dp#19; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 30;  aAlfa = #dsm210dp#19; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 90;  aAlfa = #dsm210dp#30; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 10;  aAlfa = "";           |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 10;  aAlfa = #dsm210dp#31; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 30;  aAlfa = #dsm210dp#32; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 2;   aAlfa = #dsm210dp#33; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 15;  aAlfa = #dsm210dp#34; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 15;  aAlfa = #dsm210dp#35; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 15;  aAlfa = #dsm210dp#36; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   aAlfa = #dsm210dp#37; |QBF aAlfa;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aAlfa = aAlfa - "."; |SIGUE;
   FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aAlfa = aAlfa - "-"; |SIGUE;
   Long = 9;                         |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 1;  aAlfa = #dsm210dp#38;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 90; aAlfa = #dsm210dp#39;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 35; aAlfa = "";            |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 1;  aAlfa = "X";           |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 5;  aAlfa = #dsm210dp#41;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 50; aAlfa = #dsm210dp#42;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 3;  aAlfa = #dsm210dp#43;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   TipoDato = "N";
   Long = 5;  aAlfa = #dsm210dp#44;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   TipoDato = "A";
   Long = 3;  aAlfa = #dsm210dp#45; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 3;  aAlfa = #dsm210dp#46; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 3;  aAlfa = #dsm210dp#47; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 3;  aAlfa = #dsm210dp#48; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 3;  aAlfa = #dsm210dp#49; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 3;  aAlfa = #dsm210dp#50; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 40; aAlfa = #dsm210dp#51; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 30; aAlfa = #dsm210dp#52; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   TipoDato = "N";
   nCalc = (#dsm210dp#53 * 1000) + #dsm210dp#54; aAlfa = nCalc;
   Long = 5;                        |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 5;  aAlfa = #dsm210dp#56; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 2;  aAlfa = #dsm210dp#53; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   TipoDato = "A";
   Long = 15;  aAlfa = #dsm210dp#58; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 15;  aAlfa = #dsm210dp#59; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 15;  aAlfa = #dsm210dp#60; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   |SI #dsm213ca#18 = 1; aAlfa = "X       "; |XGRABA nHandle, aAlfa; |FINSI;
   |SI #dsm213ca#18 = 2; aAlfa = " X" + #dsm213ca#5 + "  "; |XGRABA nHandle, aAlfa; |FINSI;
   |SI #dsm213ca#18 = 3; aAlfa = "      X "; |XGRABA nHandle, aAlfa; |FINSI;
   |SI #dsm213ca#18 = 4; aAlfa = "       X"; |XGRABA nHandle, aAlfa; |FINSI;
   TipoDato = "N"; LongDec = 2;
   Long = 15;  aAlfa = #dsm213ca#6;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 3;   aAlfa = #dsm213ca#7;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 15;  aAlfa = #dsm213ca#8;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 3;   aAlfa = #dsm213ca#9;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 15;  aAlfa = #dsm213ca#10; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 15;  aAlfa = #dsm213ca#11; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 15;  aAlfa = #dsm213ca#12; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 15;  aAlfa = #dsm213ca#13; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   |SI #dsm213ca#14 = "E"; aAlfa = "1"; |FINSI;
   |SI #dsm213ca#14 = "A"; aAlfa = "2"; |FINSI;
   |XGRABA nHandle, aAlfa;
   TipoDato = "A";
   Long = 4;   aAlfa = #dsm213ca#15; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 4;   aAlfa = #dsm213ca#16; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 4;   aAlfa = #dsm213ca#17; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 2;   aAlfa = #dsm213ca#17; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 10;  aAlfa = #dsm213ca#17; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   |SI #dsm213ca#13 [ 0; aAlfa = "X"; |SINO; aAlfa = " "; |FINSI;
   |XGRABA nHandle, aAlfa;
   |SI #dsmow331#6 = "S";
      aAlfa = "X" + #dsmow331#7;
   |SINO;
      aAlfa = " " * 14;
   |FINSI;
   |XGRABA nHandle, aAlfa; || Declaracion complementaria
   aAlfa = " " * 16; |XGRABA nHandle, aAlfa;
   Long = 70;   aAlfa = #dsmow331#1; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   aAlfa = " " * 30; |XGRABA nHandle, aAlfa;
   Long = 15;   aAlfa = #dsmow331#2; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 15;   aAlfa = #dsmow331#3; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   Long = 70;   aAlfa = #dsmow331#4; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
   aAlfa = " " * 30;  |XGRABA nHandle, aAlfa;
   aAlfa = " " * 13;  |XGRABA nHandle, aAlfa;
   aAlfa = " " * 152; |XGRABA nHandle, aAlfa;
   aAlfa = "</T21301>" + &13 + &10; |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO Pagina3;
   nContSoc = 0; aCompl = " ";

   #dsm213so#0 = #dsm213ca#0;
   #dsm213so#1 = #dsm213ca#1;
   #dsm213so#2 = "";
   |LEE 000#dsm213so.];
   |PARA; |SI FSalida = 0; |Y #dsm213so#0 = #dsm213ca#0; |Y #dsm213so#1 = #dsm213ca#1; |HACIENDO;
      nContSoc = nContSoc + 1;

      |SI nContSoc = 1;
         aAlfa = "<T21303>"; |XGRABA nHandle, aAlfa;
         aAlfa = aCompl;     |XGRABA nHandle, aAlfa;
      |FINSI;

      TipoDato = "A"; LongDec = 0;
      aAlfa = #dsm213so#4; |QBF aAlfa;
      FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aAlfa = aAlfa - "."; |SIGUE;
      FSalida = 1; |PARA; |SI FSalida ! 0; |HACIENDO; aAlfa = aAlfa - "-"; |SIGUE;
      Long = 9;                         |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 50; aAlfa = #dsm213so#3;   |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      aAlfa = " " * 75;                                 |XGRABA nHandle, aAlfa;
      Long = 20; aAlfa = #dsm213so#32;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      TipoDato = "N"; LongDec = 2;
      Long = 3;  aAlfa = #dsm213so#5;   |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      TipoDato = "A"; LongDec = 0;
      Long = 15; aAlfa = #dsm213so#4;   |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      TipoDato = "N";
      aAlfa = #dsm213so#33; |QBF aAlfa;
      aAlfa = (aAlfa % 0102) + (aAlfa % 0402) + (aAlfa % 0704);
      Long = 8;                         |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 30; aAlfa = #dsm213so#34;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 2;  aAlfa = #dsm213so#35;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 2;  aAlfa = #dsm213so#36;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 5;  aAlfa = #dsm213so#6;   |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 50; aAlfa = #dsm213so#7;   |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 3;  aAlfa = #dsm213so#8;   |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      TipoDato = "N";
      Long = 5;  aAlfa = #dsm213so#9;   |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      TipoDato = "A";
      Long = 3;  aAlfa = #dsm213so#10;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 3;  aAlfa = #dsm213so#11;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 3;  aAlfa = #dsm213so#12;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 3;  aAlfa = #dsm213so#13;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 3;  aAlfa = #dsm213so#14;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 3;  aAlfa = #dsm213so#15;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 40; aAlfa = #dsm213so#16;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 30; aAlfa = #dsm213so#17;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      TipoDato = "N";
      nCalc = (#dsm213so#18 * 1000) + #dsm213so#19;
      Long = 5;  aAlfa = nCalc;         |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 5;  aAlfa = #dsm213so#30;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 2;  aAlfa = #dsm213so#18;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      TipoDato = "A";
      Long = 50; aAlfa = #dsm213so#22;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 40; aAlfa = #dsm213so#23;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 30; aAlfa = #dsm213so#24;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 10; aAlfa = #dsm213so#26;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 30; aAlfa = #dsm213so#27;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 2;  aAlfa = #dsm213so#28;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;

      |SI nContSoc = 3;
         aAlfa = " " * 59; |XGRABA nHandle, aAlfa;
         aAlfa = "</T21303>"; |XGRABA nHandle, aAlfa;
         nContSoc = 0; aCompl = "C";
      |FINSI;
      |LEE 000#dsm213so.s;
   |SIGUE;

   |SI nContInm < 3; |Y nContInm ! 0;
      |PARA; |SI nContInm [ 7; |HACIENDO nContInm = nContInm + 1;
         TipoDato = "A"; LongDec = 0;
         Long = 90; aAlfa = ""; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         Long = 64; aAlfa = ""; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         TipoDato = "N";
         Long = 5;              |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         TipoDato = "A";
         Long = 15;             |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         TipoDato = "N";
         Long = 8;              |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         TipoDato = "A";
         Long = 92;             |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         TipoDato = "N";
         Long = 5;              |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         TipoDato = "A";
         Long = 88;             |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         TipoDato = "N";
         Long = 12;              |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         TipoDato = "A";
         Long = 90;             |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         Long = 72;             |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      |SIGUE;
      aAlfa = " " * 59; |XGRABA nHandle, aAlfa;
      aAlfa = "</T21303>"; |XGRABA nHandle, aAlfa;
   |FINSI;
|FPRC;

|PROCESO Pagina2;
   nContInm = 0; aCompl = " ";

   #dsm213in#0 = #dsm213ca#0;
   #dsm213in#1 = #dsm213ca#1;
   #dsm213in#2 = 1;
   |LEE 000#dsm213in.];
   |PARA; |SI FSalida = 0; |Y #dsm213in#0 = #dsm213ca#0; |Y #dsm213in#1 = #dsm213ca#1; |HACIENDO;
      nContInm = nContInm + 1;

      |SI nContInm = 1;
         aAlfa = "<T21302>"; |XGRABA nHandle, aAlfa;
         aAlfa = aCompl;     |XGRABA nHandle, aAlfa;
      |FINSI;

      TipoDato = "A"; LongDec = 0;
      Long = 5;  aAlfa = #dsm213in#4;   |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 50; aAlfa = #dsm213in#5;   |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 3;  aAlfa = #dsm213in#6;   |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      TipoDato = "N";
      Long = 5;  aAlfa = #dsm213in#7;   |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      TipoDato = "A";
      Long = 3;  aAlfa = #dsm213in#8;   |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 3;  aAlfa = #dsm213in#9;   |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 3;  aAlfa = #dsm213in#10;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 3;  aAlfa = #dsm213in#11;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 3;  aAlfa = #dsm213in#12;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 3;  aAlfa = #dsm213in#13;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 40; aAlfa = #dsm213in#14;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 30; aAlfa = #dsm213in#15;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      TipoDato = "N";
      Long = 5;  aAlfa = #dsm213in#16;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      Long = 5;  aAlfa = #dsm213in#21;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      aAlfa = #dsm213in#16; |QBF aAlfa; aAlfa = aAlfa % 0102;
      Long = 2;                         |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      TipoDato = "A";
      Long = 20; aAlfa = #dsm213in#17;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      TipoDato = "N"; LongDec = 2;
      Long = 15; aAlfa = #dsm213in#18;  |HAZ Formateo1; |XGRABA nHandle, aAlfa;

      |SI nContInm = 7;
         aAlfa = " " * 82; |XGRABA nHandle, aAlfa;
         aAlfa = "</T21302>"; |XGRABA nHandle, aAlfa;
         nContInm = 0; aCompl = "C";
      |FINSI;
      |LEE 000#dsm213in.s;
   |SIGUE;

   |SI nContInm < 7; |Y nContInm ! 0;
      |PARA; |SI nContInm [ 7; |HACIENDO nContInm = nContInm + 1;
         TipoDato = "A"; LongDec = 0;
         Long = 58; aAlfa = ""; |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         TipoDato = "N";
         Long = 5;              |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         TipoDato = "A";
         Long = 88;             |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         TipoDato = "N";
         Long = 12;             |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         TipoDato = "A";
         Long = 20;             |HAZ Formateo1; |XGRABA nHandle, aAlfa;
         TipoDato = "N";
         Long = 17;             |HAZ Formateo1; |XGRABA nHandle, aAlfa;
      |SIGUE;
      aAlfa = " " * 82; |XGRABA nHandle, aAlfa;
      aAlfa = "</T21302>"; |XGRABA nHandle, aAlfa;
   |FINSI;
|FPRC;

|PROCESO Emite213Telem;
   #dsm213ca#0 = #dsm210dp#0;
   #dsm213ca#1 = #dsmow332#0;
   |LEE 000#dsm213ca.=;
   |SI FSalida ! 0; |DDEFECTO #dsm213ca; |FINSI;

   |DBASE aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "tmp/"; |MKDIR aAlfa;
   aDirBase = aAlfa + Usuario + "/"; |MKDIR aDirBase;
   aAlfa = aDirBase + "*";
   |_PDIR aAlfa;
   |PARA; |SI FSalida = 0; |HACIENDO;
      |FBORRA aAlfa; |_SDIR aAlfa;
   |SIGUE;

   aAlfa = aDirBase + "213_" + (("00000" + #dsm210dp#0) % -105) + "_" + (("00000" + #dsmow332#0) % -102) + ".txt";
   |XABRE "WB", aAlfa, nHandle; aFichero = aAlfa;
   |SI FSalida = 0;

      |HAZ Pagina1;
      |HAZ Pagina2;

      |XCIERRA nHandle;
   |FINSI;
|FPRC;

|PROCESO PasaInmHist213;
   |DDEFECTO #dsm213h2;
   #dsm213h2#0 = #dsm213hi#0;
   #dsm213h2#1 = #dsm213hi#1;
   #dsm213h2#2 = #dsm213hi#2;
   #dsm213h2#3 = #dsm213hi#3;
   #dsm213h2#4 = #dsm213hi#4;
   |PARA nCont = 5; |SI nCont [ 24; |HACIENDO nCont = nCont + 1;
      nCalc = nCont - 3;
      #dsm213h2#nCont# = #dsm213in#nCalc#;
   |SIGUE;
   |GRABA 020#dsm213h2.n;

   |BORRA 020#dsm213in.a;
|FPRC;

|DEFBUCLE PasaInmHist213;
#dsm213in#1;
;
#dsm213ca#0, #dsm213ca#1, 001;
#dsm213ca#0, #dsm213ca#1, 999;
;
NULL, PasaInmHist213;
|FIN;

|PROCESO PasaSocHist213;
   |DDEFECTO #dsm213h1;
   #dsm213h1#0 = #dsm213hi#0;
   #dsm213h1#1 = #dsm213hi#1;
   #dsm213h1#2 = #dsm213hi#2;
   #dsm213h1#3 = #dsm213hi#3;
   #dsm213h1#4 = #dsm213hi#4;
   |PARA nCont = 5; |SI nCont [ 39; |HACIENDO nCont = nCont + 1;
      nCalc = nCont - 3;
      #dsm213h1#nCont# = #dsm213so#nCalc#;
   |SIGUE;
   |GRABA 020#dsm213h1.n;

   |BORRA 020#dsm213so.a;
|FPRC;

|DEFBUCLE PasaSocHist213;
#dsm213so#1;
;
#dsm213ca#0, #dsm213ca#1, "               ";
#dsm213ca#0, #dsm213ca#1, "zzzzzzzzzzzzzzz";
;
NULL, PasaSocHist213;
|FIN;

|PROCESO GrabaHistorico213;
   nCompl = 0;
   #dsm213hi#0 = #dsm213ca#0;
   #dsm213hi#1 = #dsmow331#9;
   #dsm213hi#2 = 0;
   #dsm213hi#3 = #dsm213ca#1;
   #dsm213hi#4 = 0;
   |LEE 000#dsm213hi.];
   |PARA; |SI FSalida = 0; |HACIENDO;
      nCompl = #dsm213hi#4 + 1;
      |LEE 000#dsm213hi.s;
   |SIGUE;

   |DDEFECTO #dsm213hi;
   #dsm213hi#0 = #dsm213ca#0;
   #dsm213hi#1 = #dsmow331#9;
   #dsm213hi#2 = 0;
   #dsm213hi#3 = #dsm213ca#1;
   #dsm213hi#4 = nCompl;
   |PARA nCont = 5; |SI nCont [ 22; |HACIENDO nCont = nCont + 1;
      nCalc = nCont - 3;
      #dsm213hi#nCont# = #dsm213ca#nCalc#;
   |SIGUE;
   #dsm213hi#23 = #dsmow331#8;
   #dsm213hi#24 = #dsmow331#7;
   |GRABA 020#dsm213hi.c;

   |BUCLE PasaSocHist213;
   |BUCLE PasaInmHist213;

   |BORRA 020#dsm213ca.a;
|FPRC;

|PROCESO Emitir213;
   |HAZ PonVentEspera1;

   #dsm213ca#0 = #dsm210dp#0;
   #dsm213ca#1 = #dsmow332#0;
   |LEE 000#dsm213ca.=;
   |SI FSalida ! 0; |HAZ QuitaVentEspera1; |ACABA; |FINSI;

   |SI #dsmow331#5 = "P";
      |HAZ Emite213Papel;
   |SINO;
      |HAZ Emite213Telem;
   |FINSI;

   |ABRE #dsm213hi; |ABRE #dsm213h1; |ABRE #dsm213h2;
   |HAZ GrabaHistorico213;
   |CIERRA #dsm213hi; |CIERRA #dsm213h1; |CIERRA #dsm213h2;

   |HAZ QuitaVentEspera1;
|FPRC;

|PROCESO RellenaTempo;
   |DDEF aAlfa; |QBF aAlfa;
   aAlfa1 = aAlfa + "dsm210ca.mas";
   |CARGA_DEF aAlfa1, Referen@;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "dsm210in.mas";
      |CARGA_DEF aAlfa1, Refere1@;
      |SI FSalida = 0;
      |SINO;
         |DESCARGA_DEF #Referen@;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Reemitir213;
   |ABRE #dsmow331;
   aAlfa = ""; |IP_REMOTO aAlfa;
   #dsmow331#0 = aAlfa;
   |LEE 000#dsmow331.=;
   |SI FSalida ! 0;
      |DDEFECTO #dsmow331;
      #dsmow331#0 = aAlfa;
      |GRABA 020#dsmow331.c;
   |FINSI;

   nSwModelo = 213;

   |VENTANA 1011, 1889, -1, 17, "Emision modelo 213"; nVent0 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent0;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |SI #dsm213hi#4 ! 0;
      #dsmow331#6 = "S"; #dsmow331#7 = #dsm213hi#24;
   |SINO;
      #dsmow331#6 = "N"; #dsmow331#7 = "";
   |FINSI;
   |C_M #dsmow331#6, 1, "N";   |C_M #dsmow331#7, 1, "N";
   #dsmow331#8 = #dsm213hi#23; |C_M #dsmow331#8, 1, "N";
   #dsmow331#9 = #dsm213hi#1;  |C_M #dsmow331#9, 1, "N";

   |PINPA #0#dsmow331; nPant1 = FSalida;
   |PINDA #0#dsmow331;

   |ENDATOS #1#dsmow331;
   |SI FSalida ! 0;
      aVent4 = nVent0;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent0;

      |ACABA;
   |SINO;
      |GRABA 020#dsmow331.a;

      aVent4 = nVent0;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent0;
   |FINSI;

   |CIERRA #dsm213ca; |CIERRA #dsm213in; |CIERRA #dsm213so;
   aAlfa = "dsm213th"; |NOME_DAT #dsm213ca#aAlfa#;
   aAlfa = "dsm213t1"; |NOME_DAT #dsm213in#aAlfa#;
   aAlfa = "dsm213t2"; |NOME_DAT #dsm213so#aAlfa#;
   |ABRE #dsm213ca; |ABRE #dsm213in; |ABRE #dsm213so;
   |HAZ RellenaTempo;

   aSwPresent  = #dsmow331#5;
   |DDEFECTO #dsmow332;
   #dsmow332#0 = #dsm213hi#3;
   #dsmow332#1 = #dsm213hi#5;
   #dsmow332#2 = #dsm213hi#6;
   |SI #dsm213hi#4 ! 0;
      #dsmow332#3 = "C";
   |SINO;
      #dsmow332#3 = " ";
   |FINSI;
   |HAZ Emitir213;

   |CIERRA #dsm213ca; |CIERRA #dsm213in; |CIERRA #dsm213so;
   aAlfa = "dsm213ca"; |NOME_DAT #dsm213ca#aAlfa#;
   aAlfa = "dsm213in"; |NOME_DAT #dsm213in#aAlfa#;
   aAlfa = "dsm213so"; |NOME_DAT #dsm213so#aAlfa#;
   |ABRE #dsm213ca; |ABRE #dsm213in; |ABRE #dsm213so;
|FPRC;

|PROCESO BotonValida;
   |PTEC 801;
|FPRC;

|PROCESO RecogeAdms;
   |DDEFECTO #dsmow332;

   #dsmow332#0 = #dsm213ca#1;
   #dsmow332#1 = #dsm213ca#2;
   #dsmow332#2 = #dsm213ca#3;
   |GRABA 020#dsmow332.n;
|FPRC;

|DEFBUCLE RecogeAdms;
#dsm213ca#1;
;
#dsm210dp#0, 00000;
#dsm210dp#0, 99999;
;
NULL, RecogeAdms;
|FIN;

|PROCESO EvtoGridSel213;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsmow332.=;
   |FINSI;
|FPRC;

|PROCESO Emision213;
   |ESTADO_CONTROL nIdSalir, "DISABLE";

   |ABRE #dsm213ca; |ABRE #dsm213in; |ABRE #dsm213so;
   |ABRE #dsmow331;
   aAlfa = ""; |IP_REMOTO aAlfa;
   #dsmow331#0 = aAlfa;
   |LEE 000#dsmow331.=;
   |SI FSalida ! 0;
      |DDEFECTO #dsmow331;
      #dsmow331#0 = aAlfa;
      |GRABA 020#dsmow331.c;
   |FINSI;

   nSwModelo = 213;

   aAlfa = "13" + Usuario; |NOME_DAT #dsmow332#aAlfa#;
   |DELINDEX #dsmow332; |ABRE #dsmow332;
   |BUCLE RecogeAdms;

   |VENTANA 1011, 1889, -1, 17, "Emision modelo 213"; nVent0 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent0;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PINPA #0#dsmow331; nPant1 = FSalida;
   |PINDA #0#dsmow331;

   |ENDATOS #1#dsmow331;
   |SI FSalida ! 0;
      aVent4 = nVent0;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent0;

      |ACABA;
   |SINO;
      |GRABA 020#dsmow331.a;

      aVent4 = nVent0;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent0;
   |FINSI;

   aSwPresent  = #dsmow331#5;

   |VENTANA 1011, 2089, -1, 17, "Emision modelo 213"; nVent0 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent0;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PINPA #0#dsmow317; nPant1 = FSalida;
   |PINDA #0#dsmow317;

   nPos1 = 1648; nPos2 = 1661;
   |CONTROL_SIMPLE nPant1, "BOTON,{{205}}&Emitir modelo", nPos1, nPos2, Emitir213;
   nBotonEmi = FSalida;

   nPos1 = 1663; nPos2 = 1678;
   |CONTROL_SIMPLE nPant1, "BOTON,{{001}}Sa&Lir", nPos1, nPos2, BotonValida;
   nBotonSalir = FSalida;

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 0602; nPos2 = 1578;
   |LINEAL_SIMPLE #1#dsmow332, nRango, nPos1, nPos2, NULL, NULL, EvtoGridSel213;
   nGridEmi = FSalida;
   |PULSATECLA;

   |PAUSA;

   |DESTRUYECONTROL nGridEmi;
   |FIN_CONTROL_WINDOWS nBotonEmi;

   aVent4 = nVent0;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent0;

   |CIERRA #dsmow332; |DELINDEX #dsmow332;
   |CIERRA #dsmow331;
   |CIERRA #dsm213ca; |CIERRA #dsm213in; |CIERRA #dsm213so;

   |ESTADO_CONTROL nIdSalir, "ENABLE";
|FPRC;
*/

/***************************************************************************
*********                   FIN EMISION MODELO 213                 *********
****************************************************************************/

|PROCESO Tipo00RelDelegs;
   |SI Campo = 0;
      #haciend@#0 = #Fichero@#Campo#;
      #haciend@#1 = 0;
      |LEE 000#haciend@.];
      |SI FSalida = 0; |Y #haciend@#0 = #Fichero@#Campo#;
         nCalc = Campo + 2; #Fichero@#nCalc# = #haciend@#2; |PINTA #Fichero@#nCalc#;
      |SINO;
         |MENAV "    Delegación inexistente"; |ERROR;
      |FINSI;
   |SINO;
      |SI FSalida = 2; |ACABA; |FINSI;
      #haciend@#1 = #Fichero@#Campo#; nCalc = Campo - 1;
      #haciend@#0 = #Fichero@#nCalc#;
      |LEE 000#haciend@.=;
      |SI FSalida = 0;
         nCalc = Campo + 1;
         #Fichero@#nCalc# = #haciend@#2; |PINTA #Fichero@#nCalc#; nCalc = nCalc + 1;
         #Fichero@#nCalc# = #haciend@#3; |PINTA #Fichero@#nCalc#;
      |SINO;
         |MENAV "    Administración inexistente"; |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Tipo66RelDelegs; |TIPO 66;
   |SI Campo = 0;
      #haciend@#0 = #Fichero@#Campo#; nCalc = Campo + 1;
      #haciend@#1 = #Fichero@#nCalc#;
   |SINO;
      #haciend@#1 = #Fichero@#Campo#; nCalc = Campo - 1;
      #haciend@#0 = #Fichero@#nCalc#;
   |FINSI;
   |LEE 000#haciend@.];
   |CONSULTA_CLAVE #1#haciend@;
   |SI FSalida = 0;
      |SI Campo = 0;
         #Fichero@#Campo# = #haciend@#0; |PINTA #Fichero@#Campo#; nCalc = Campo + 1;
         #Fichero@#nCalc# = #haciend@#1; |PINTA #Fichero@#nCalc#; nCalc = nCalc + 1;
      |SINO;
         #Fichero@#Campo# = #haciend@#1; |PINTA #Fichero@#Campo#; nCalc = Campo - 1;
         #Fichero@#nCalc# = #haciend@#0; |PINTA #Fichero@#nCalc#; nCalc = Campo + 1;
      |FINSI;
      #Fichero@#nCalc# = #haciend@#2; |PINTA #Fichero@#nCalc#; nCalc = nCalc + 1;
      #Fichero@#nCalc# = #haciend@#3; |PINTA #Fichero@#nCalc#; nCalc = nCalc + 1;
   |FINSI;
|FPRC;

|PROCESO MiraSi213;
   #dsm213ca#0 = #dsm210dp#0;
   nCalc = (#dsmow325#0 * 1000) + #dsmow325#1;
   #dsm213ca#1 = nCalc;
   |LEE 000#dsm213ca.=;
   |SI FSalida = 0;
      |MENAV "    El modelo de la administración indicada ya existe";
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO InfMinMex;
   #dsminmex#20 = "A";
   #dsminmex#0 = #dsm210dp#0;
   #dsminmex#1 = 1;
|FPRC;

|PROCESO SupMinMex;
   #dsminmex#20 = "A";
   #dsminmex#0 = #dsm210dp#0;
   #dsminmex#1 = 999;
|FPRC;

|PROCESO Tipo00Inmueble;
   #dsminmex#0 = #dsm210dp#0;
   #dsminmex#1 = #Fichero@#Campo#;
   |LEE 000#dsminmex.=;
   |SI FSalida = 0;
      |SI #dsminmex#20 = "A";
         nCalc = Campo + 1; #Fichero@#nCalc# = #dsminmex#22; |PINTA #Fichero@#nCalc#;
         nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#3;  |PINTA #Fichero@#nCalc#;
         nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#4;  |PINTA #Fichero@#nCalc#;
         nCalc = nCalc + 2; #Fichero@#nCalc# = #dsminmex#6;  |PINTA #Fichero@#nCalc#;
         nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#10; |PINTA #Fichero@#nCalc#;
         nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#11; |PINTA #Fichero@#nCalc#;
         nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#12; |PINTA #Fichero@#nCalc#;
         nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#15; |PINTA #Fichero@#nCalc#;
         nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#16; |PINTA #Fichero@#nCalc#;
         nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#17; |PINTA #Fichero@#nCalc#;
         nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#19; |PINTA #Fichero@#nCalc#;
         nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#2;  |PINTA #Fichero@#nCalc#;
      |SINO;
         |MENAV "    Inmueble inactivo"; |ERROR;
      |FINSI;
   |SINO;
      |MENAV "    Inmueble inexistente"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO Tipo66Inmueble; |TIPO 66;
   #dsminmex#0 = #dsm210dp#0;
   #dsminmex#1 = #Fichero@#Campo#;
   |LEE 000#dsminmex.];
   |CONSULTA_F_CLAVE #2#dsminmex, InfMinMex, SupMinMex;
   |SI FSalida = 0;
                         #Fichero@#Campo# = #dsminmex#1;
      nCalc = Campo + 1; #Fichero@#nCalc# = #dsminmex#22; |PINTA #Fichero@#nCalc#;
      nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#3;  |PINTA #Fichero@#nCalc#;
      nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#4;  |PINTA #Fichero@#nCalc#;
      nCalc = nCalc + 2; #Fichero@#nCalc# = #dsminmex#6;  |PINTA #Fichero@#nCalc#;
      nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#10; |PINTA #Fichero@#nCalc#;
      nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#11; |PINTA #Fichero@#nCalc#;
      nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#12; |PINTA #Fichero@#nCalc#;
      nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#15; |PINTA #Fichero@#nCalc#;
      nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#16; |PINTA #Fichero@#nCalc#;
      nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#17; |PINTA #Fichero@#nCalc#;
      nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#19; |PINTA #Fichero@#nCalc#;
      nCalc = nCalc + 1; #Fichero@#nCalc# = #dsminmex#2;  |PINTA #Fichero@#nCalc#;
   |FINSI;
   |ERROR;
|FPRC;

|PROCESO T66RelPaises; |TIPO 66;
   #rpaises@#0 = #Fichero@#Campo#;
   |LEE 000#rpaises@.];
   |CONSULTA_CLAVE #1#rpaises@;
   |SI FSalida = 0;
      #Fichero@#Campo# = #rpaises@#0; |PINTA #Fichero@#Campo#;
      nCalc = Campo + 1;
      #Fichero@#nCalc# = #rpaises@#1; |PINTA #Fichero@#nCalc#;
   |FINSI;
|FPRC;

|PROCESO T00RelPaises;
   #rpaises@#0 = #Fichero@#Campo#;
   |LEE 000#rpaises@.=;
   |SI FSalida = 0;
      nCalc = Campo + 1;
      #Fichero@#nCalc# = #rpaises@#1; |PINTA #Fichero@#nCalc#;
   |SINO;
      |MENAV "    Pais inexistente"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO GrabaTmpPdf;
   |DDEFECTO #pdfimtmp;

   #pdfimtmp#0 = aDato;
   #pdfimtmp#1 = aValor;
   |GRABA 020#pdfimtmp.n;
|FPRC;

|PROCESO PonVentEspera1;
   |VENTANA 1410, 1690, -1, 17, ""; nVentEsp = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVentEsp;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |CONTROL_SIMPLE 0, "LABEL,{{5}}Emitiendo, espere por favor", 1412, 1688, NULL;
   |PTEC 802; |PAUSA;
|FPRC;

|PROCESO QuitaVentEspera1;
   aVent4 = nVentEsp;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVentEsp;
|FPRC;

|PROCESO ValInmuebles;
   #dsminmex#0 = #dsm213in#0;
   #dsminmex#1 = #dsm213in#2;
   |LEE 000#dsminmex.=;
   |SI FSalida ! 0; |DDEFECTO #dsminmex; |FINSI;

   #dsmivcex#0 = #dsm213in#0;
   #dsmivcex#1 = #dsm213in#2;
   #dsmivcex#2 = enEjercicio;
   |LEE 000#dsmivcex.=;
   |SI FSalida ! 0; |DDEFECTO #dsmivcex; |FINSI;
   |SI #dsmivcex#4 = " ";  #dsmivcex#4 = #dsminmex#28;  |FINSI;

   |SI #dsmivcex#4 = "S";
      nCalc = 0.011;
   |SINO;
      nCalc = 0.02;
   |FINSI;
   ||nValor = nValor + ((#dsm213in#18 * nCalc) ! 2);
   nValor = (nValor + #dsm213in#18) ! 2;
|FPRC;

|DEFBUCLE ValInmuebles;
#dsm213in#1;
;
#dsm213ca#0,#dsm213ca#1,001;
#dsm213ca#0,#dsm213ca#1,999;
;
NULL, ValInmuebles;
|FIN;

|PROCESO ValorInmuebles;
   nValor = 0; |BUCLE ValInmuebles;
   #dsmow324#5 = nValor; |PINTA #dsmow324#5;
   #dsmow324#7 = (#dsmow324#5 % #dsmow324#6) ! 2; |PINTA #dsmow324#7;
   #dsmow324#9 = (#dsmow324#7 % #dsmow324#8) ! 2; |PINTA #dsmow324#9;
   #dsmow324#10 = #dsmow324#7 - #dsmow324#9; |PINTA #dsmow324#10;
   #dsmow324#12 = #dsmow324#10 - #dsmow324#11; |PINTA #dsmow324#12;
|FPRC;

|PROCESO Formateo1;
   |QBF aAlfa;
   |SI TipoDato = "F";
      aAlfa = aAlfa - "."; aAlfa = aAlfa - ".";
      |QBF aAlfa;
      |SI aAlfa = "";         aAlfa = "0" * 8; |FINSI;
      |SI aAlfa = "01010000"; aAlfa = "0" * 8; |FINSI;
      |ACABA;
   |FINSI;
   |SI TipoDato = "N";
      Vacio1 = "0" * Long;
      Vacio2 = "0" * LongDec;
      aAlfa = aAlfa - "-";
      |SI FSalida ! 0;
         nNegativo = 1;
      |SINO;
         nNegativo = 0;
      |FINSI;
   |SINO;
      Vacio1 = " " * Long;
   |FINSI;

   |SI TipoDato ! "N";
      Calc1 = 100 + Long; aAlfa = (aAlfa + Vacio1) % Calc1;
   |SINO;
      |SI LongDec = 0;
         Calc1 = 0 - (100 + Long);
         aAlfa = (Vacio1 + aAlfa) % Calc1;
      |SINO;
         aAlfa = aAlfa - ".";
         |SI FSalida = 0;
            Calc1 = 0 - (100 + Long);
            aAlfa = (Vacio1 + aAlfa) % Calc1;
            aAlfa1 = "0" * LongDec;
         |SINO;
            Calc1 = (((FSalida / 100) ! 0) - 1) + 100;
            Calc2 = (((FSalida / 100) ! 0) * 100) + 99;
            aAlfa1 = aAlfa % Calc2;
            aAlfa = aAlfa % Calc1;
            Calc1 = 0 - (100 + Long);
            aAlfa = (Vacio1 + aAlfa)  % Calc1;
            Calc1 = 100 + LongDec;
            aAlfa1 = (aAlfa1 + Vacio2) % Calc1;
         |FINSI;
         aAlfa = aAlfa + aAlfa1;
      |FINSI;
      |SI nNegativo = 1;
         Calc1 = 0 - (100 + (Long + LongDec)); Calc1 = Calc1 + 1;
         aAlfa = aAlfa % Calc1;
         aAlfa = "N" + aAlfa;
      |FINSI;
   |FINSI;

   aAlfa2 = "";

   |SI TipoDato = "A"; |O TipoDato = "An";
      aLong = aAlfa % 0; nLong = aLong;
      |PARA nCont1 = 1; |SI nCont1 [ nLong; |HACIENDO nCont1 = nCont1 + 1;
         Calc1 = (nCont1 * 100) + 1; aAlfa1  = aAlfa % Calc1;
         aAlfa1 = aAlfa1 > aAlfa1;
         |SI aAlfa1 = " ";                  |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "@"; |O aAlfa1 = "."; |VETE Sigue1; |FINSI;
         |SI aAlfa1 ] "A"; |Y aAlfa1 [ "Z"; |VETE Sigue1; |FINSI;
         |SI aAlfa1 ] "0"; |Y aAlfa1 [ "9"; |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "¥"; aAlfa1 = &209;   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "¤"; aAlfa1 = &209;   |VETE Sigue1; |FINSI;
         |SI nSwFiltraBarra = 1;
            |SI aAlfa1 = "/"; aAlfa1 = ".";    |VETE Sigue1; |FINSI;
         |FINSI;
         aAlfa4 = &128;
         |SI aAlfa1 = aAlfa4; aAlfa1 = "Ç";   |VETE Sigue1; |FINSI;
         aAlfa4 = &135;
         |SI aAlfa1 = aAlfa4; aAlfa1 = "ç";   |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "-"; aAlfa1 = &45;    |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "'"; aAlfa1 = &49;    |VETE Sigue1; |FINSI;
         |SI aAlfa1 = "/";                  |VETE Sigue1; |FINSI;
         |SI TipoDato = "An";
            |SI aAlfa1 = "&"; aAlfa1 = &38;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = ","; aAlfa1 = &44;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = "."; aAlfa1 = &46;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = ":"; aAlfa1 = &58;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = ";"; aAlfa1 = &59;    |VETE Sigue1; |FINSI;
            |SI aAlfa1 = "_"; aAlfa1 = &95;    |VETE Sigue1; |FINSI;
         |FINSI;
         aAlfa1 = " ";
|ET Sigue1;
         aAlfa2 = aAlfa2 + aAlfa1;
      |SIGUE;
      aAlfa = aAlfa2;
   |FINSI;
   Calc1 = aAlfa;
   |SI nSwDatos1 = 0; |Y Calc1 ! 0; nSwDatos1 = 1; |FINSI;
|FPRC;

|PROCESO MiraSiExisteSo;
   |SI enModo = 2; |ACABA; |FINSI;

   #dsm213so#0 = #dsm213ca#0;
   #dsm213so#1 = #dsm213ca#1;
   #dsm213so#2 = #dsmow330#0;
   |LEE 000#dsm213so.=;
   |SI FSalida = 0;
      |MENAV "    El nif del socio ya esta incluido en la relacion"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO DatosEco;
|FPRC;

|PROCESO CtaBancoC;
   |VENTANA 1111, 2789, -1, 17, "Cuenta bancaria por defecto (Conyuge)"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |ABRE #dsm210db;
   #dsm210db#0 = #dsm210dp#0;
   |LEE 101#dsm210db.=;
   |SI FSalida ! 0;
      |DDEFECTO #dsm210db;
      #dsm210db#0 = #dsm210dp#0;
      |GRABA 020#dsm210db.b;
   |FINSI;
   aAlfa = "";
   |PARA nContCmp = 0; |SI nContCmp [ 24; |HACIENDO nContCmp = nContCmp + 1;
      nCalc = nContCmp + 26;
      #dsmow339#nContCmp# = #dsm210db#nCalc#;
      aAlfa = aAlfa + #dsm210db#nCalc#; |QBF aAlfa;
   |SIGUE;
   |SI aAlfa = ""; |O aAlfa = "ESES";
      aAlfa = "    NLos datos de la cuenta bancaria del conyuge están vacios. " + &191 + " Copiarlos del titular ?";
      |CONFI aAlfa;
      |SI FSalida = 0;
         |PARA nContCmp = 0; |SI nContCmp [ 24; |HACIENDO nContCmp = nContCmp + 1;
            nCalc = nContCmp + 1;
            #dsmow339#nContCmp# = #dsm210db#nCalc#;
            aAlfa = aAlfa + #dsm210db#nCalc#; |QBF aAlfa;
         |SIGUE;
      |FINSI;
   |FINSI;

   |PINPA #0#dsmow339; nPant2 = FSalida;
   |PINDA #0#dsmow339;

   |ENDATOS #1#dsmow339;
   |SI FSalida = 0;
      |PARA nContCmp = 0; |SI nContCmp [ 24; |HACIENDO nContCmp = nContCmp + 1;
         nCalc = nContCmp + 26;
         #dsm210db#nCalc# = #dsmow339#nContCmp#;
      |SIGUE;
      |GRABA 020#dsm210db.a;
   |FINSI;
   |LIBERA #dsm210db; |CIERRA #dsm210db;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent1;
|FPRC;

|PROCESO ObtenIdSalir;
   InNivel = nNivel1<-;
   nNivel1 = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;
|FPRC;

|PROCESO DatosConyuge;
   |HAZ ObtenIdSalir;
   |ESTADO_CONTROL nIdSalir, "DISABLE";

   Cmp = -1;
   |VENTANA 0906, 2894, -1, 17, "Datos personales del conyuge"; nVent0 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent0;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   aAlfa = "    N" + &191 + " Actualizar datos personales del conyuge ? ";
   |CONFI aAlfa;
   |SI FSalida = 0; |HAZ ActualizaC; |FINSI;

   |LEE 101#dsm210dp.=;
   |SI FSalida = 0;
      |DDEFECTO #dsmow343;
      #dsmow343#0  = #dsm210dp#0;
      #dsmow343#1  = #dsm210dp#64;
      #dsmow343#2  = #dsm210dp#65;
      #dsmow343#3  = #dsm210dp#66;
      #dsmow343#4  = #dsm210dp#67;
      #dsmow343#5  = #dsm210dp#68;
      #dsmow343#6  = #dsm210dp#69;

      #rpaises@#0 = #dsmow343#6;
      |LEE 000#rpaises@.=;
      |SI FSalida ! 0; |DDEFECTO #rpaises@; |FINSI;
      #dsmow343#7  = #rpaises@#1;

      #dsmow343#8  = #dsm210dp#70;

      #rpaises@#0 = #dsmow343#8;
      |LEE 000#rpaises@.=;
      |SI FSalida ! 0; |DDEFECTO #rpaises@; |FINSI;
      #dsmow343#9  = #rpaises@#1;

      #dsmow343#10 = #dsm210dp#71;
      #dsmow343#11 = #dsm210dp#72;
      #dsmow343#12 = #dsm210dp#73;
      #dsmow343#13 = #dsm210dp#74;
      #dsmow343#14 = #dsm210dp#75;
      #dsmow343#15 = #dsm210dp#76;
      #dsmow343#16 = #dsm210dp#77;
      #dsmow343#17 = #dsm210dp#78;
      #dsmow343#18 = #dsm210dp#79;
      #dsmow343#19 = #dsm210dp#80;
      #dsmow343#20 = #dsm210dp#81;
      #dsmow343#21 = #dsm210dp#82;
      #dsmow343#22 = #dsm210dp#83;
      #dsmow343#23 = #dsm210dp#84;
      #dsmow343#24 = #dsm210dp#85;
      #dsmow343#25 = #dsm210dp#86;
      #dsmow343#26 = #dsm210dp#87;
      #dsmow343#27 = #dsm210dp#88;
      #dsmow343#28 = #dsm210dp#89;
      #dsmow343#29 = #dsm210dp#90;
      #dsmow343#30 = #dsm210dp#91;
      #dsmow343#31 = #dsm210dp#92;
      #dsmow343#32 = #dsm210dp#93;
      #dsmow343#33 = #dsm210dp#94;
      #dsmow343#34 = #dsm210dp#95;
      #dsmow343#35 = #dsm210dp#96;

      #rpaises@#0 = #dsmow343#35;
      |LEE 000#rpaises@.=;
      |SI FSalida ! 0; |DDEFECTO #rpaises@; |FINSI;
      #dsmow343#36 = #rpaises@#1;

      #dsmow343#37 = #dsm210dp#97;
      #dsmow343#38 = #dsm210dp#98;
      #dsmow343#39 = #dsm210dp#99;
      #dsmow343#40 = #dsm210dp#100;
      #dsmow343#41 = #dsm210dp#101;
      #dsmow343#42 = #dsm210dp#102;

      |PINPA #0#dsmow343; nPant1 = FSalida;
      |PINDA #0#dsmow343;

      || nPos1 = 1073; nPos2 = 1088;
      nPos1 = 0965; nPos2 = 0988;
      |CONTROL_SIMPLE nPant1, "BOTON,{{197}}&Cuenta banco", nPos1, nPos2, CtaBancoC;
      nBotonCtaBanco = FSalida;
/*
      ||nPos1 = 1273; nPos2 = 1288;
      nPos1 = 1065; nPos2 = 1088;
      |CONTROL_SIMPLE nPant1, "BOTON,{{197}}Pase datos a renta/patrimonio", nPos1, nPos2, PaseRenta;
      nBotonPaseRenta = FSalida;
*/
      |PTEC 802; |PAUSA;

      |ENDATOS #1#dsmow343;
      |SI FSalida = 0;
         #dsm210dp#64 = #dsmow343#1;
         #dsm210dp#65 = #dsmow343#2;
         #dsm210dp#66 = #dsmow343#3;
         #dsm210dp#67 = #dsmow343#4;
         #dsm210dp#68 = #dsmow343#5;
         #dsm210dp#69 = #dsmow343#6;
         #dsm210dp#70 = #dsmow343#8;
         #dsm210dp#71 = #dsmow343#10;
         #dsm210dp#72 = #dsmow343#11;
         #dsm210dp#73 = #dsmow343#12;
         #dsm210dp#74 = #dsmow343#13;
         #dsm210dp#75 = #dsmow343#14;
         #dsm210dp#76 = #dsmow343#15;
         #dsm210dp#77 = #dsmow343#16;
         #dsm210dp#78 = #dsmow343#17;
         #dsm210dp#79 = #dsmow343#18;
         #dsm210dp#80 = #dsmow343#19;
         #dsm210dp#81 = #dsmow343#20;
         #dsm210dp#82 = #dsmow343#21;
         #dsm210dp#83 = #dsmow343#22;
         #dsm210dp#84 = #dsmow343#23;
         #dsm210dp#85 = #dsmow343#24;
         #dsm210dp#86 = #dsmow343#25;
         #dsm210dp#87 = #dsmow343#26;
         #dsm210dp#88 = #dsmow343#27;
         #dsm210dp#89 = #dsmow343#28;
         #dsm210dp#90 = #dsmow343#29;
         #dsm210dp#91 = #dsmow343#30;
         #dsm210dp#92 = #dsmow343#31;
         #dsm210dp#93 = #dsmow343#32;
         #dsm210dp#94 = #dsmow343#33;
         #dsm210dp#95 = #dsmow343#34;
         #dsm210dp#96 = #dsmow343#35;
         #dsm210dp#97  = #dsmow343#37;
         #dsm210dp#98  = #dsmow343#38;
         #dsm210dp#99  = #dsmow343#39;
         #dsm210dp#100 = #dsmow343#40;
         #dsm210dp#101 = #dsmow343#41;
         #dsm210dp#102 = #dsmow343#42;
         |GRABA 020#dsm210dp.a;
      |FINSI;

      ||FIN_CONTROL_WINDOWS nBotonPaseRenta;
      |FIN_CONTROL_WINDOWS nBotonCtaBanco;
   |FINSI;

   aVent4 = nVent0;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent0;

   |ESTADO_CONTROL nIdSalir, "ENABLE";
|FPRC;

|PROCESO VerPaisC;
   |SELECT #3#rpaises@;
   #rpaises@#4 = aAlfa4;
   |LEE 000#rpaises@.=;
   |SI FSalida = 0;
       aAlfa4 = #rpaises@#0;
   |FINSI;
   |SELECT #1#rpaises@;
|FPRC;

|PROCESO ActDatosBancoC;
       eaIBAN = "";
       eaCta  = aIBAN;
       eaPais = "ES";
       |HAZ CalcuIBAN;

       |SI eaIBAN ! "";
           |ABRE #dsm210db;
           #dsm210db#0  = #Referen@#0;
           |LEE 101#dsm210db.=;
           |SI FSalida ! 0;
               |DDEFECTO #dsm210db;
               #dsm210db#0  = #Referen@#0;
               |GRABA 020#dsm210db.b;
           |FINSI;
           #dsm210db#26 = eaIBAN %  104;
           #dsm210db#27 = eaIBAN %  504;
           #dsm210db#28 = eaIBAN %  904;
           #dsm210db#29 = eaIBAN % 1304;
           #dsm210db#30 = eaIBAN % 1704;
           #dsm210db#31 = eaIBAN % 2104;
           |GRABA 020#dsm210db.a;
           |LIBERA #dsm210db;
           |CIERRA #dsm210db;
       |FINSI;
|FPRC;

|PROCESO ActualizaC;
   aIBAN = "";
   |DBASS aAlfa; |QBF aAlfa;
   |SI enSwCod = 1;
      aAlfa1 = aAlfa + "integral/def/dsam0000.mas";
      aAlfa3 = aAlfa + "integral/def/dsam0103.mas";
      aAlfaF4 = aAlfa + "integral/def/dsam0003.mas";
   |SINO;
      aAlfa1 = aAlfa + "basica/def/agifigen.mas";
      aAlfa3 = aAlfa + "basica/def/agim0003.mas";
      aAlfaF4 = "";
   |FINSI;
   |CARGA_DEF aAlfa1, Referen@;
   |SI FSalida = 0;
      aAlfa2 = aAlfa + "basica/def/agidanif.mas";
      |CARGA_DEF aAlfa2, Refere1@;
      |SI FSalida = 0;
         aAlfa2 = aAlfa + "basica/def/agim0004.mas";
         |CARGA_DEF aAlfa2, Refere2@;
         |SI FSalida = 0;
            |CARGA_DEF aAlfa3, Refere3@;
            |SI FSalida = 0;
               |SI enSwCod = 1;
                  |CARGA_DEF aAlfaF4, Refere4@;
                  nSwError = FSalida;
               |SINO;
                  nSwError = 0;
               |FINSI;
               |SI nSwError = 0;
                  |SI enSwCod = 1;
                     aAlfa1 = aAlfa + "integral/fich/";
                     |PATH_DAT #Referen@#aAlfa1#; |PATH_DAT #Refere3@#aAlfa1#;
                     |PATH_DAT #Refere4@#aAlfa1#; |ABRE #Refere4@;
                  |SINO;
                     aAlfa1 = aAlfa + "basica/fich/";
                     |PATH_DAT #Referen@#aAlfa1#; |PATH_DAT #Refere3@#aAlfa1#;
                  |FINSI;
                  aAlfa1 = aAlfa + "basica/fich/";
                  |PATH_DAT #Refere1@#aAlfa1#; |PATH_DAT #Refere2@#aAlfa1#;
                  |ABRE #Referen@; |ABRE #Refere1@; |ABRE #Refere2@; |ABRE #Refere3@;

                  #Referen@#0 = #dsm210dp#0;
                  |LEE 000#Referen@.=;
                  |SI FSalida = 0;
                     |SI enSwCod = 1;
                        #Refere1@#0 = #Referen@#3;
                     |SINO;
                        #Refere1@#0 = #Referen@#13;
                     |FINSI;
                     #Refere1@#1 = 1;
                     |LEE 000#Refere1@.=;
                     |SI FSalida ! 0; |DDEFECTO #Refere1@; |FINSI;

                     |SI enSwCod = 1;
                        #Refere3@#0 = #Referen@#3;
                     |SINO;
                        #Refere3@#0 = #Referen@#13;
                     |FINSI;
                     |LEE 000#Refere3@.=;
                     |SI FSalida ! 0; |DDEFECTO #Refere3@; |FINSI;

                     |SI enSwCod = 1;
                        #Refere4@#0 = #Referen@#0;
                        |LEE 000#Refere4@.=;
                        |SI FSalida ! 0; |DDEFECTO #Refere4@; |FINSI;
                     |FINSI;

                     #Refere2@#0 = #Referen@#0;
                     #Refere2@#1 = 1;
                     |LEE 000#Refere2@.];
                     |SI FSalida ! 0; |O #Refere2@#0 ! #Referen@#0; |DDEFECTO #Refere2@; |FINSI;

                     #dsm210dp#0  = #Referen@#0;
                     |LEE 101#dsm210dp.=;
                     |SI FSalida = 0;
                        |SI enSwCod = 1;
                           #dsm210dp#64 = #Refere4@#39;
                           #dsm210dp#65 = #Refere4@#35;
                           #dsm210dp#67 = #Refere4@#68;
                           #dsm210dp#68 = #Refere4@#52;
                           |SI #Refere4@#92 = "N";
                               #dsm210dp#71 = #Refere4@#44;
                               #dsm210dp#72 = #Refere4@#45;
                               #dsm210dp#73 = "NUM";
                               #dsm210dp#74 = #Refere4@#46;
                               #dsm210dp#78 = #Refere4@#47;
                               #dsm210dp#79 = #Refere4@#48;
                               #dsm210dp#80 = #Refere4@#49;
                               #dsm210dp#81 = #Refere4@#97;
                               #dsm210dp#82 = #Refere4@#98;
                               #dsm210dp#83 = #Refere4@#50;
                               #dsm210dp#84 = #Refere4@#51;
                               #dsm210dp#85 = #Refere4@#52;

                               #reprovi@#0 = #Refere4@#50;
                               |LEE 000#reprovi@.=;
                               |SI FSalida ! 0; |DDEFECTO #reprovi@; |FINSI;
                               #dsm210dp#86 = #reprovi@#1;

                               aAlfa = #dsm210dp#9; |QBF aAlfa;
                               |SI aAlfa ! "";
                                   #dsm210dp#87 = #Refere4@#13;
                                   #dsm210dp#88 = #Refere4@#72;
                                   #dsm210dp#89 = #Refere4@#91;
                               |FINSI;
                           |SINO;
                               aAlfa = #Refere4@#99; |QBF aAlfa;
                               aAlfa1 = aAlfa % 0150;
                               |SI aAlfa1 ! aAlfa;
                                   aAlfa2 = aAlfa1 % -101; aAlfa1 = aAlfa1 % -299;
                                   |PARA; |SI aAlfa2 ! " "; |Y aAlfa2 ! "."; |Y aAlfa2 ! ";";
                                      |Y aAlfa2 ! ","; |Y aAlfa2 ! ":"; |Y aAlfa2 ! "_"; |HACIENDO;
                                      aAlfa2 = aAlfa1 % -101; aAlfa1 = aAlfa1 % -299;
                                   |SIGUE;
                                   aAlfa = aAlfa1 - aAlfa;
                                  |SI aAlfa1 = ""; aAlfa1 = aAlfa; |FINSI;
                               |FINSI;
                               #dsm210dp#90 = #Refere4@#99;  || aAlfa1;
                               #dsm210dp#91 = #Refere4@#100; || aAlfa;
                               #dsm210dp#92 = #Refere4@#101;
                               #dsm210dp#93 = #Refere4@#102;
                               #dsm210dp#94 = #Refere4@#103;
                               #dsm210dp#95 = #Refere4@#104;
                               aAlfa4 = #Refere4@#105; |HAZ VerPaisC;
                               #dsm210dp#96 = aAlfa4;
                                                 || #dsm210dp#96 = #Refere4@#105;
                               aAlfa = #dsm210dp#90; |QBF aAlfa;
                               |SI aAlfa ! "";
                                   #dsm210dp#97 = #Refere4@#13;
                                   #dsm210dp#98 = #Refere4@#72;
                                   #dsm210dp#99 = #Refere4@#91;
                               |FINSI;
                           |FINSI;
                           aIBAN = #Refere4@#54;
                        |FINSI;

                        |SI enSwCod = 2;
                           aIBAN = #Referen@#81 + #Referen@#82 + #Referen@#83 + #Referen@#84;

                           |SI enSwCod = 1;
                              #dsm210dp#3 = #Referen@#79;
                           |SINO;
                              #dsm210dp#11 = #Refere1@#32;
                           |FINSI;
                        |FINSI;
                        |GRABA 020#dsm210dp.a; |LIBERA #dsm210dp;
                        |HAZ ActDatosBancoC;
                     |FINSI;
                     |SI enSwCod = 1; |CIERRA #Refere4@; |DESCARGA_DEF #Refere4@; |FINSI;
                  |FINSI;
                  |CIERRA #Referen@; |CIERRA #Refere1@; |CIERRA #Refere2@; |CIERRA #Refere3@;
                  |DESCARGA_DEF #Refere3@;
               |FINSI;
            |FINSI;
            |DESCARGA_DEF #Refere2@;
         |FINSI;
         |DESCARGA_DEF #Refere1@;
      |FINSI;
      |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;
