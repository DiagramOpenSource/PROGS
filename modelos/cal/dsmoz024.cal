|FICHEROS;
     dsmoz024 #0;

     dsmo5830 #1;
     dsmo5831 #583;
     dsmo5832 #584;
     dsmow152 #999;

     :/basica/def/agifigen #1000;
     :/basica/def/agitab99 #99;
|FIN;

|VARIABLES;
     aFichero  = "";
     aAlfa     = "";
     aAlfa1    = "";
     aAlfa2    = "";
     nPara1    = 0;
     nDEmpresa = 0;
     nHEmpresa = 0;
     nDEjer    = 0;
     nHEjer    = 0;
     nSalir    = 0;
     nCampo    = 0;
     nGraba    = 0;

     fFecha    = @;
     fDFecha   = @;
     fHFecha   = @;
     &eaNomOrigen = "";

     nEmpresa  = 0;
     nEjer     = 0;
     aDelg     = "";
     &enDesde  = 0;
     &enHasta  = 0;
|FIN;

|INCLUYE i_variar;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

/*
|PROCESO Parrilla;
     |SI #0#1 = 0;
         #0#1 = 0;  |PINTA #0#1;
         #0#2 = 0;  |PINTA #0#2;  |C_M #0#2, 1, "N";
         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#1, 1, "S";
             |C_M #0#2, 1, "S";
         |FINSI;

         |PARA nCampo = 3;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;
*/

|PROCESO SelLineal;
     |SI #0#19 = 1;
         |C_M #0#0, 1, "S";
         |C_M #0#1, 1, "N"; #0#1 = 1; |PINTA #0#1;
     |SINO;
         |C_M #0#1, 1, "S";
         |C_M #0#0, 1, "N";
     |FINSI;
|FPRC;

|PROCESO SacaAnyo;  |TIPO 7;
     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#0   = aAlfa;
     |PINTA #0#0;
|FPRC;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|PROCESO GrabaTempo;
    enEmpresaPINET = nEmpresa;
    |HAZ RestriccionPINET;
    |SI enErrorPINET = 1;  |ACABA;  |FINSI;

    #1000#0 = nEmpresa;
    |LEE 040#1000=;
    |SI FSalida ! 0;  |DDEFECTO #1000;  |FINSI;

    |QBF aDelg;
    #999#0 = nEmpresa;
    #999#1 = nEjer;
    |LEE 101#999=;
    |SI FSalida ! 0;
        |DDEFECTO #999;
        #999#0 = nEmpresa;
        #999#1 = nEjer;
        #999#2 = #1000#1;
        #999#3 = #1000#13;
        #999#4 = #1000#9;
        #999#5 = #1000#12;
        |SI aDelg = "";
            aDelg = (("00" + #999#4) % -102) + "600";
        |FINSI;
        #999#6 = aDelg;
        |GRABA 020#999n;

        |SI #0#19 = 1; |Y #999#1 = #0#0;
            nGraba = 1;
        |FINSI;
        |SI #0#19 = 2; |Y #999#0 = #0#1;
            nGraba = 1;
        |FINSI;
    |FINSI;
    |LIBERA #999;
|FPRC;

|PROCESO GrabaTempo_1;
    nEmpresa = #583#0;
    nEjer    = #583#1;
    aDelg    = #583#5;
    |HAZ GrabaTempo;
|FPRC;

|DEFBUCLE dsmo5831;
     #583#1;
     ;
     00001, 2000, 00;
     99999, 2099, 99;
     e;
     NULL, GrabaTempo_1;
|FIN;

|PROCESO GrabaTempo_2;
    |SI nEmpresa ! #1#0;
        nEmpresa = #1#0;
        nEjer    = #0#0;
        aDelg    = "";
        |HAZ GrabaTempo;
    |FINSI;
|FPRC;

|DEFBUCLE dsmo5830;
     #1#1;
     ;
     00001, 00;
     99999, 99;
     e;
     NULL, GrabaTempo_2;
|FIN;
|| *************************************************************
|PROCESO PedirOtraVez;

    nSalir = 1;
    |C_P #0#1, 1, 0714;
    |C_P #0#0, 1, 0814;

    |SI #0#19 = 1;
        |ENCAMPO #0#0;
        |SI FSalida = 7; |O FSalida = 1; nSalir = 0; |ACABA; |FINSI;
    |SINO;
        eaElProm = "dsmoz024";
        |ENCAMPO #1#0;
        |SI FSalida = 7; |O FSalida = 1;
            eaElProm = "";
            nSalir   = 0;
            |ACABA;
        |FINSI;
        eaElProm = "";
    |FINSI;

    enEmpresa = #0#1;
    enEjer    = #0#0;

    |ABRE #999;
    #999#0 = #0#1;
    #999#1 = #0#0;
    |LEE 040#999=;
    |SI FSalida ! 0;
        nEmpresa = #999#0;
        nEjer    = #999#1;
        aDelg    = "";

        |ABRE #583;
        #583#0 = nEmpresa;
        #583#1 = nEjer;
        #583#2 = 03;
        |LEE 041#583];
        |SI FSalida = 0; |Y #583#0 = nEmpresa; |Y #583#1 = nEjer;
            aDelg = #583#5;
        |FINSI;
        |CIERRA #583;

        |ABRE #1000;
        |HAZ GrabaTempo;
        |CIERRA #1000;
     |FINSI;
     |CIERRA #999;
|FPRC;

|| *************************************************************
|RUTINA ClaveBaja999;
     #999#0 = nDEmpresa;
     #999#1 = nDEjer;
     |SI FSalida = "POSICION";
         |SI enEmpresa ! 0; |Y enEjer ! 0;
             #999#0 = enEmpresa;
             #999#1 = enEjer;
         |FINSI;
     |FINSI;
|FRUT;

|RUTINA ClaveAlta999;
     #999#0 = nHEmpresa;
     #999#1 = nHEjer;
|FRUT;

|PROCESO Tipo3;  |TIPO 3;

     aFichero = ("3z" + Usuario) % 108;
     |NOME_DAT #999 aFichero;
     |DELINDEX #999;

     aAlfa1 = #0#0;
     aAlfa2 = "01.01." + aAlfa1; fDFecha = aAlfa2;
     aAlfa2 = "31.12." + aAlfa1; fHFecha = aAlfa2;

     enModelo  = #0#15;
     enEjer    = #0#0;
     enEmpresa = #0#1;

     |ABRE #999;
     |ABRE #1000;
     |BUCLE dsmo5831;   || Primero el modelo
     nEmpresa = 0;
     |BUCLE dsmo5830;   || por si hay alguno sin modelo
     |SI nGraba = 0;
         #583#0 = enEmpresa;
         #583#1 = enEjer;
         |HAZ GrabaTempo;
     |FINSI;
     |CIERRA #1000;
     |CIERRA #999;

     nDEjer    = 2000; nHEjer    = 2099;
     nDEmpresa = 1;    nHEmpresa = 99999;

     |SI #0#19 = 1;

  |ET PorEjercicio;
         nDEjer = #0#0;       || A¤o + Empresas
         nHEjer = #0#0;
         |PINPA #0#999;
         |ENTLINEAL #2#999, -2, 4, 22, 0, ClaveBaja999, ClaveAlta999;
         |HAZ PedirOtraVez;
         |SI nSalir = 1;  |VETE PorEjercicio; |FINSI;

     |SINO;
         |C_M #999#0,1,"N"; |C_V #999#0,1,"N";
         |C_M #999#1,1,"S";
         |C_P #999#1,1,1204; |C_L #999#1,1,"S";

  |ET PorEmpresa;
         nDEmpresa = #0#1;    || Empresa + A¤os
         nHEmpresa = #0#1;
         |PINPA #0#999;
         |BLANCO 1001 2311;
         |CUADRO 1002 2309;
         |ATRI R; |PINTA 1103, "Ejerc.";|ATRI 0;

         |ENTLINEAL #1#999, -2, 4, 22, 0, ClaveBaja999, ClaveAlta999;
         |HAZ PedirOtraVez;
         |SI nSalir = 1; |VETE PorEmpresa; |FINSI;
     |FINSI;

     |DELINDEX #999;
|FPRC;

|PROGRAMA;
     |ABRE #99;
     #99#0 = 583;
     |LEE 040#99=;
     |SI FSalida ! 0;  |DDEFECTO #99;  |FINSI;
     |CIERRA #99;
     |SI #99#4 ! "S";
         enDesde = 583;
         enHasta = 583;
         eaExtension = "bas";
         eaPrograma  = "agitab99";
         |SUB_EJECUTA_NP ":basica/dspatron";
         |SUB_EJECUTA_NP "dsmom005";
         |ABRE #99;
         #99#0 = 583;
         |LEE 040#99=;
         |SI FSalida ! 0;  |DDEFECTO #99;  |FINSI;
         |CIERRA #99;
     |FINSI;

     |DDEFECTO #0;
     #0#15 = 583;
     #0#16 = #99#1;
     #0#17 = #99#2;
     #0#18 = #99#3;

     |CLS;
     |CABEZA "Entrada Modelo 583";
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;

     |HAZ FinalizaEnX;
|FPRO;
