|FICHEROS;
     dsmoy000;
     dsmom002;
     dsmom004;
     dsmom025;

     dsm190ca #190;
     dsm19001;

     dsmow014;
     dsmow596;
     dsmow613;

     &clientes@;
|FIN;

|VARIABLES;
     nSwCara        = 0;
     aImprime       = "";
     aNombre        = "";
     aPathAfegir    = "";
     aIPRemoto      = "";
     aBue           = "";
     aExtra         = "";
     aJusti         = "";

     &enTipoEntrada = 0;
|FIN;

|INCLUYE i_varemi;

|PROCESO CogeNumJusti2016;
     |SI #dsm190ca#11 = "N";
         aJusti = "1900000000000";
         |ACABA;
     |FINSI;

     aCadena = "";
     aLong   = eaVarDni % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos      = (100 * nCampo) + 1;
           aCaracter = eaVarDni % nPos;

           |SI aCaracter = "0";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "1";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "2";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "3";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "4";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "5";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "6";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "7";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "8";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "9";  aCadena = aCadena + aCaracter;  |FINSI;
     |SIGUE;

     aAlfa1  = #dsm190ca#1;
     aAlfa2  = #dsm190ca#4;
     aCadena = ((aCadena + "0000000") % 107) + (aAlfa1 % -102) + (("00" + aAlfa2) % -101);

     aJusti  = "190" + aCadena;
|FPRC;

|PROCESO Regis1_2016;
     enCodCli = #dsm190ca#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow596;

     #dsmow596#0  = "1";

     #dsmow596#1  = "190";

     #dsmow596#2  = #dsm190ca#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #dsmow596#3   = eaVarDni;

         eaAlfa   = #clientes@#1;  |HAZ QuitaRaros;
         #dsmow596#4   = eaAlfa;

         eaAlfa   = #clientes@#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #clientes@#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #dsmow596#6   = eaAlfa;

         eaAlfa   = #clientes@#53;  |HAZ QuitaRaros;
         #dsmow596#7   = eaAlfa;

         eaDeleg     = #clientes@#17;
         eaAdmin     = #clientes@#18;
         eaProvincia = #clientes@#38;
     |SINO;
         aAlfa = #clientes@#96; |QBF aAlfa; |SI aAlfa = ""; #clientes@#96 = #clientes@#2; |FINSI;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #dsmow596#3   = eaVarDni;

         eaAlfa   = #clientes@#1;   |HAZ QuitaRaros;
         #dsmow596#4   = eaAlfa;

         eaAlfa   = #clientes@#14;  |HAZ QuitaRarosTfno;
         #dsmow596#6   = eaAlfa;

         eaAlfa   = #clientes@#96;   |HAZ QuitaRaros;   || Persona de Contacto
         #dsmow596#7   = eaAlfa;

         eaDeleg     = #clientes@#91;
         eaAdmin     = #clientes@#92;
         eaProvincia = #clientes@#12;
     |FINSI;

     #dsmow596#5  = "T";

     |HAZ CogeNumJusti2016;
     #dsmow596#8  = aJusti;

     nNume   = #dsm190ca#6;
     #dsmow596#12 = ("000000000" + nNume) % -109;

     enNume  = #dsm190ca#7;  |HAZ Conver15Signo;
     #dsmow596#13 = eaSigno;
     #dsmow596#14 = eaAlfa;

     enNume  = #dsm190ca#8;  |HAZ Conver15Signo;
     #dsmow596#15 = eaAlfa;

     |SI #dsm190ca#10 = "C";
         #dsmow596#9  = "C";
         #dsmow596#11 = #dsm190ca#9;
     |FINSI;

     |SI #dsm190ca#10 = "S";
         #dsmow596#10 = "S";
         #dsmow596#11 = #dsm190ca#9;
     |FINSI;

     #dsmow596#18 = &13 + &10;

     nHCampo = 18;
     |SI eaOpcion ! "3";
         nHCampo = 17;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #dsmow596#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     nTRegistro = nTRegistro + 1;
|FPRC;

|PROCESO Regis2_2016;
     enCodCli = #dsm190ca#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow613;

     #dsmow613#0  = "2";

     #dsmow613#1  = "190";

     #dsmow613#2  = #dsm190ca#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #dsmow613#3   = eaVarDni;
     |SINO;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #dsmow613#3   = eaVarDni;
     |FINSI;

     |ABRE #dsmom025;
     #dsmom025#0 = #dsm19001#6;
     |LEE 040#dsmom025.=;
     |SI FSalida = 0;
         #dsmow613#4 = #dsmom025#2;
     |SINO;
         aAlfa    = #dsm19001#6;  |QBF aAlfa;
         aLong    = aAlfa % 0;
         nLong    = aLong;
         aExtra   = aAlfa % 101;

         |SI nLong > 9;  |Y aExtra = "X";
             aAlfa = (aAlfa % 101) + (aAlfa % 308);
             |SI #dsm19001#11 = "N";
                 #dsmow613#4 = aAlfa;
             |SINO;
                 #dsmow613#5 = aAlfa;
             |FINSI;
         |SINO;
             eaVarDni = #dsm19001#6;  |HAZ CalculameDNI;
             |SI #dsm19001#11 = "N";
                 #dsmow613#4 = eaVarDni;
             |SINO;
                 #dsmow613#5 = eaVarDni;
             |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #dsmom025;

     eaAlfa = #dsm19001#12;  |HAZ QuitaRaros;
     #dsmow613#6 = eaAlfa;

     #dsmow613#7 = ("00" + #dsm19001#13) % -102;
     #dsmow613#8 = #dsm19001#8;

     |SI #dsm19001#8 = "K";
         |SI #dsm19001#9 = "  ";
             #dsm19001#9 = "01";
         |FINSI;
     |FINSI;

     |SI #dsm19001#8 = "N";
         #dsm19001#8 = "K";
         #dsm19001#9 = "02";
     |FINSI;

     |SI #dsm19001#8 = "I";
         |SI #dsm19001#9 = "  ";
             #dsm19001#9 = "02";
         |FINSI;
     |FINSI;

     aAlfa  = #dsm19001#9;  |QBF aAlfa;
     #dsmow613#9 = ("00" + aAlfa) % -102;

     enNume  = #dsm19001#16;  |HAZ Conver13Signo;
     #dsmow613#10 = eaSigno;
     #dsmow613#11 = eaAlfa;

     enNume  = #dsm19001#17;  |HAZ Conver13Signo;
     #dsmow613#12 = eaAlfa;

     enNume  = #dsm19001#18;  |HAZ Conver13Signo;
     #dsmow613#13 = eaSigno;
     #dsmow613#14 = eaAlfa;

     enNume  = #dsm19001#19;  |HAZ Conver13Signo;
     #dsmow613#15 = eaAlfa;

     enNume  = #dsm19001#20;  |HAZ Conver13Signo;
     #dsmow613#16 = eaAlfa;

     #dsmow613#17 = ("0000" + #dsm19001#7) % -104;

     #dsmow613#18 = #dsm19001#15;

     #dsmow613#19 = ("0000" + #dsm19001#14) % -104;

     #dsmow613#20 = #dsm19001#26;

     eaVarDni = #dsm19001#27;  |HAZ CalculameDNI;
     #dsmow613#21  = eaVarDni;

     #dsmow613#22 = #dsm19001#25;

     #dsmow613#23 = #dsm19001#10;

     #dsmow613#24 = " ";
     #dsmow613#25 = "0";

     |SI #dsm19001#40 = "S";  #dsmow613#25 = "1";  |FINSI;

     enNume  = #dsm19001#21;  |HAZ Conver13;
     #dsmow613#26 = eaAlfa;

     enNume  = #dsm19001#22;  |HAZ Conver13;
     #dsmow613#27 = eaAlfa;

     enNume  = #dsm19001#23;  |HAZ Conver13;
     #dsmow613#28 = eaAlfa;

     enNume  = #dsm19001#24;  |HAZ Conver13;
     #dsmow613#29 = eaAlfa;

     #dsmow613#30 = ("0"  + #dsm19001#41) % -101;
     #dsmow613#31 = ("0"  + #dsm19001#42) % -101;
     #dsmow613#32 = ("00" + #dsm19001#43) % -102;
     #dsmow613#33 = ("00" + #dsm19001#44) % -102;
     #dsmow613#34 = ("00" + #dsm19001#45) % -102;
     #dsmow613#35 = ("00" + #dsm19001#46) % -102;
     #dsmow613#36 = ("00" + #dsm19001#47) % -102;
     #dsmow613#37 = ("00" + #dsm19001#48) % -102;
     #dsmow613#38 = ("00" + #dsm19001#49) % -102;
     #dsmow613#39 = ("00" + #dsm19001#50) % -102;

     #dsmow613#40 = ("0"  + #dsm19001#51) % -101;
     #dsmow613#41 = ("0"  + #dsm19001#52) % -101;
     #dsmow613#42 = ("0"  + #dsm19001#53) % -101;
     #dsmow613#43 = ("0"  + #dsm19001#54) % -101;
     #dsmow613#44 = ("0"  + #dsm19001#55) % -101;
     #dsmow613#45 = ("0"  + #dsm19001#56) % -101;
     #dsmow613#46 = ("0"  + #dsm19001#57) % -101;
     #dsmow613#47 = ("0"  + #dsm19001#58) % -101;
     #dsmow613#48 = ("0"  + #dsm19001#59) % -101;
     #dsmow613#49 = ("0"  + #dsm19001#60) % -101;
     #dsmow613#50 = #dsm19001#61;
     #dsmow613#51 = #dsm19001#62;
     #dsmow613#52 = #dsm19001#63;
     #dsmow613#53 = #dsm19001#64;

     enNume  = #dsm19001#65 + #dsm19001#67;  |HAZ Conver13Signo;
     #dsmow613#54 = eaSigno;
     #dsmow613#55 = eaAlfa;

     enNume  = #dsm19001#66 + #dsm19001#68;  |HAZ Conver13Signo;
     #dsmow613#56 = eaAlfa;

     enNume  = #dsm19001#69;                  |HAZ Conver13Signo;
     #dsmow613#57 = eaAlfa;

     #dsmow613#59 = &13 + &10;

     |SI #dsmow613#8 ! "A";  |Y #dsmow613#8 ! "B";  |Y #dsmow613#8 ! "C"; |Y #dsmow613#8 ! "E";
         #dsmow613#19 = "0000";
         #dsmow613#20 = "0";
         #dsmow613#21 = "         ";
         #dsmow613#22 = "0";
         #dsmow613#23 = "0";
         #dsmow613#24 = " ";
         #dsmow613#25 = "0";
         #dsmow613#26 = "0000000000000";
         #dsmow613#27 = "0000000000000";
         #dsmow613#28 = "0000000000000";
         #dsmow613#29 = "0000000000000";
         #dsmow613#30 = "0";
         #dsmow613#31 = "0";
         #dsmow613#32 = "00";
         #dsmow613#33 = "00";
         #dsmow613#34 = "00";
         #dsmow613#35 = "00";
         #dsmow613#36 = "00";
         #dsmow613#37 = "00";
         #dsmow613#38 = "00";
         #dsmow613#39 = "00";
         #dsmow613#40 = "0";
         #dsmow613#41 = "0";
         #dsmow613#42 = "0";
         #dsmow613#43 = "0";
         #dsmow613#44 = "0";
         #dsmow613#45 = "0";
         #dsmow613#46 = "0";
         #dsmow613#47 = "0";
         #dsmow613#48 = "0";
         #dsmow613#49 = "0";
         #dsmow613#50 = "0";
         #dsmow613#51 = "0";
         #dsmow613#52 = "0";
         #dsmow613#53 = "0";
     |FINSI;

     nHCampo = 59;
     |SI eaOpcion ! "3";
         nHCampo = 58;
     |FINSI;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #dsmow613#nCampo#;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |SINO;
         |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE dsm19001;
     #dsm19001#1;
     ;
     #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,"            ",0000," ","  ",0;
     #190#0,#190#1,#190#2,#190#3,#190#4,#190#5,"zzzzzzzzzzzz",9999,"z","zz",4;
     ;
     NULL, Regis2_2016;
|FIN;

|PROCESO dsm19001c;
     nTecla = 5;
     |BUCLE dsm19001;
|FPRC;

|PROCESO dsmow014_2016;
     #dsm190ca#0  = #dsmow014#0;
     #dsm190ca#1  = #dsmow014#1;
     #dsm190ca#2  = #dsmow014#2;
     #dsm190ca#3  = #dsmow014#5;
     #dsm190ca#4  = #dsmow014#7;
     #dsm190ca#5  = 0;
     |LEE 040#dsm190ca.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsmom002#0 = #dsm190ca#0;
     #dsmom002#1 = 1;
     #dsmom002#2 = 110;
     |LEE 040#dsmom002.];
     |SI FSalida ! 0;  |O  #dsmom002#0 ! #dsm190ca#0;  |O  #dsmom002#2 ! 110;
         |DDEFECTO #dsmom002;
     |FINSI;

     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = #dsmow014#5;
     #dsmom004#4  = #dsmow014#7;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     eaFicheroPlano = "190" + (("00000" + #dsmow014#0) % -105) + ".txt";
     eaFicheroImpre = "190" + (("00000" + #dsmow014#0) % -105) + ".imp";
     eaFicheroSalid = "190" + (("00000" + #dsmow014#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #dsmow014#0) % -105) + ".txt";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Regis1_2016;

     enSinActividad = 1;
     |BUCLE dsm19001;

     |XCIERRA nHandle2;

     enEmpresa      = #dsmow014#0;
     eaNomEmpresa   = #dsmow014#3;

     |HAZ PresentaPortal;
|FPRC;

|DEFBUCLE dsmow014C1_2016;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, dsmow014_2016;
|FIN;

|DEFBUCLE dsmow014C2_2016;
     #dsmow014#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, dsmow014_2016;
|FIN;

|PROCESO Bloque2016;
     |HAZ BtnAnuales2015;

     |SI eaOpcion = "0";
         enInfComp = 1;
         |ACABA;
     |FINSI;

     |ABRE #dsm190ca;
     |ABRE #dsmom002;
     |ABRE #dsmom004;
     |SI #dsmoy000#8 = "C";
         |BUCLE dsmow014C1_2016;
     |SINO;
         |BUCLE dsmow014C2_2016;
     |FINSI;
     |CIERRA #dsm190ca;
     |CIERRA #dsmom002;
     |CIERRA #dsmom004;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;
