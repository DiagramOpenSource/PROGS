|FICHEROS;
     dsmozpas;
     dsmom002;
     dsmom004;
     dsmom008;
     dsmom026;
     dsmom030;
     dsmom107;

     dsmoc111;

     :/contagen/def/canempre;
     :/contagen/def/camaniva;
     :/contagen/def/caivalin;
     :/contagen/def/caivaasi;
     :/contagen/def/cadeflab;

     :/laboral/def/labtraba;
     :/laboral/def/nomhicca;
     :/laboral/def/nomhicli;
     :/laboral/def/labempre;
     :/laboral/def/nomconli;
     :/laboral/def/nomhiatr;
     :/laboral/def/nomauto2;
     :/laboral/def/nomnotay;
     :/laboral/def/nomcorli;

     :/basica/def/agitab99;

     dsmow013;
     espejo1@;
|FIN;

|VARIABLES;
     nSw               = 0;
     aTodoCero         = "";
     aNombreTrabajador = "";
     aExtranjero       = "";
     aExtranjero2      = "";
     aCadena           = "";
     nMesLugar         = 0;
     fFechaCamaniva    = @;
     fFecha            = @;
     fDFecha           = @;
     fHFecha           = @;
     nImporteBaseI     = 0;
     nImporteRetencion = 0;
     aEspecie          = "";
     aRepercute        = "";
     aClave            = "";
     aSubClave         = "";
     aDni              = "";
     aDn               = "            ";
     aHn               = "zzzzzzzzzzzz";
     aPeriodicidad     = "";
     nNume             = 0;
     aAlfa             = "";
     aAlfa1            = "";
     aAlfa2            = "";
     aPathModelo       = "";
     aPathLaboral      = "";
     aDef              = "";
     aTipo             = "";
     aBase             = "";
     aFechaAlta        = "";
     aTra              = "";
     aTrab42           = "";
     nSwUno            = 0;
     nSwUnoS           = 0;
     nImport1          = 0;
     nImport2          = 0;
     nImport3          = 0;
     nImport4          = 0;
     nImport5          = 0;
     nImporte2         = 0;
     nNume1            = 0;
     nNume2            = 0;
     nEjer             = 0;
     nEjerAt           = 0;
     nDPeriodo         = 0;
     nHPeriodo         = 0;
     nCampo            = 0;
     nCampo1           = 0;
     nCampo11          = 0;
     nCampo2           = 0;
     nCampo22          = 0;
     nCampo3           = 0;
     nCampo33          = 0;
     nSwEsta           = 0;
     nGrupo            = 0;
     nSubGrupo         = 0;
     nDepar            = 0;
     nBaseImpo         = 0;
     nPorce            = 0;
     nCuota            = 0;
     nPeriodo          = 0;
     nModelo           = 0;
     nSwPasa           = 0;
     nLineaIrpf        = 0;
     nDComplem         = 0;
     nHComplem         = 0;
     nHayPase          = 0;
     nHandle           = 0;
     nHay              = 0;
     nPorGrupos        = 0;
     nEmpresa          = 0;
     nDevengo          = 0;
     nAtrasos          = 0;
     nAnyo             = 0;
     nImporteSS        = 0;
     nImporteSSA       = 0;
     nRel              = 0;
     &enSwNuevo110     = 0;
     nNumTraba         = 0;
     nNumTrabaH        = 0;
     ded_not           = 0;
     notaria           = 0;
     nMesAuto          = 0;
     nTp100            = 0;
     nDcom             = 0;
     nHcom             = 0;
     nTrabaja          = 0;

     &enDEmpresa       = 0;
     &enHEmpresa       = 0;
     nRelA      = 0;
     nTotalA    = 0;
     nTotalA01  = 0;
     nTotalA02  = 0;
     nTotalSSA1 = 0;
     nTotalSSA2 = 0;
     nCadaUno   = 0;
     nDosA      = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO MiraCampos111;
     aTodoCero = "S";
     |PARA nCampo1 = 12;  |SI nCampo1 [ 20;  |HACIENDO nCampo1 = nCampo1 + 1;
          |SI #dsmoc111#nCampo1# ! 0;
               aTodoCero = "N";
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO dsmom002C_111;              || Comprobamos todas las fechas

     aAlfa   = "31.12." + enEjer;  fHFecha = aAlfa;
     aAlfa   = "01.01." + enEjer;  fDFecha = aAlfa;

     aAlfa   = #dsmom002#8 % -104;
     |SI aAlfa ! "0000";
         nNume = aAlfa;
         |SI nNume > enEjer; |ACABA; |FINSI;

         |SI #dsmom002#8 > fDFecha; fDFecha = #dsmom002#8; |FINSI;
     |FINSI;

     aAlfa   = #dsmom002#9 % -104;
     |SI aAlfa ! "0000";
         nNume   = aAlfa;
         |SI nNume < enEjer;  |ACABA;  |FINSI;

         |SI #dsmom002#9 < fHFecha;  fHFecha = #dsmom002#9;  |FINSI;
     |FINSI;

     aAlfa2 = enPeriodo;
     aAlfa2 = ("00" + aAlfa2) % -102;
     aAlfa  = "31.";
     |SI enPeriodo = 4; |O enPeriodo = 6; |O enPeriodo = 9; |O enPeriodo = 11;
         aAlfa = "30.";
     |FINSI;
     |SI enPeriodo = 2;
         aAlfa = "28."; |SI enEjer = 2000; |O enEjer = 2004; |O enEjer = 2008;
                            |O enEjer = 2012; |O enEjer = 2016; |O enEjer = 2020;
                               aAlfa = "29.";
                        |FINSI;
     |FINSI;
     aAlfa2 = aAlfa + aAlfa2 + "." + enEjer;

     |SI #dsmom002#7 = "TRIMESTRAL";
         |SI enPeriodo = 3;  aAlfa1 = "01.01." + enEjer;  |FINSI;
         |SI enPeriodo = 6;  aAlfa1 = "01.04." + enEjer;  |FINSI;
         |SI enPeriodo = 9;  aAlfa1 = "01.07." + enEjer;  |FINSI;
         |SI enPeriodo = 12; aAlfa1 = "01.10." + enEjer;  |FINSI;
     |FINSI;

     |SI #dsmom002#7 = "MENSUAL   ";
         aAlfa1 = enPeriodo;  aAlfa1 = ("00" + aAlfa1) % -102;
         aAlfa1 = "01." + aAlfa1 + "." + enEjer;
     |FINSI;

     |SI #dsmom002#7 = "ANUAL     ";
         aAlfa1 = "01.01." + enEjer;
         aAlfa2 = "31.12." + enEjer;
     |FINSI;

     fFecha = aAlfa1;
     |SI fHFecha < fFecha;  |ACABA;  |FINSI;

     fFecha = aAlfa2;
     |SI fDFecha > fFecha;  |ACABA;  |FINSI;

     aPeriodicidad = #dsmom002#7 % 101; |QBF aPeriodicidad;
     |ERROR10;
|FPRC;

|DEFBUCLE dsmom002C_111;
     #dsmom002#1;
     ;
     enEmpresa, 01, 110;
     enEmpresa, 98, 110;
     ;
     NULL, dsmom002C_111;
|FIN;

|PROCESO Grabadsmoc111;
     |SI aClave  = " ";  |Y aSubClave = "  ";  |ACABA;  |FINSI;

     |SI aExtranjero = "e"; |O aExtranjero2 = "e";
          |ACABA;
     |FINSI;

     |SI aClave = "A";           || Tique 700000_9602
         |SI enEjer < 2015;
             aSubClave = "  ";
         |SINO;
             |SI aSubClave = "  ";
                 aSubClave = "01";
             |FINSI;
         |FINSI;
     |FINSI;

     |SI aClave ! "A";
         nRel = 0;
         aTra = "N";
     |SINO;
         |SI aTra = "S";     || Tique 766_1382
             aAlfa1 = aFechaAlta % -104; nNume1 = aAlfa1;
             |SI nNume1 ! enEjer;
                 aTra = "N";
             |FINSI;
         |FINSI;
     |FINSI;

     aPeriodicidad = "T";
     |BUCLE dsmom002C_111;

     #dsmoc111#0  = enEmpresa;
     #dsmoc111#1  = enEjer;
     #dsmoc111#2  = enPeriodo;
     #dsmoc111#3  = enModelo;
     #dsmoc111#4  = enComplem;
     #dsmoc111#5  = enActividad;
     #dsmoc111#6  = aDni;
     #dsmoc111#7  = nDevengo;
     #dsmoc111#8  = nMesLugar;
     #dsmoc111#9  = aClave;
     #dsmoc111#10 = aSubClave;
     #dsmoc111#11 = nRel;
     |LEE 101#dsmoc111.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc111;
         #dsmoc111#0  = enEmpresa;
         #dsmoc111#1  = enEjer;
         #dsmoc111#2  = enPeriodo;
         #dsmoc111#3  = enModelo;
         #dsmoc111#4  = enComplem;
         #dsmoc111#5  = enActividad;
         #dsmoc111#6  = aDni;
         #dsmoc111#7  = nDevengo;
         #dsmoc111#8  = nMesLugar;
         #dsmoc111#9  = aClave;
         #dsmoc111#10 = aSubClave;
         #dsmoc111#11 = nRel;
         |GRABA 020#dsmoc111.b;
     |FINSI;

     |SI #agitab99#8 = "L"; |Y aClave = "E"; || ... tique 5127_126
         |SI aEspecie = "N";
              #dsmoc111#12 = nImporteBaseI;
              #dsmoc111#13 = nImporteRetencion;
         |SINO;
              #dsmoc111#14 = nImporteBaseI;
              |SI aRepercute = "N";
                  #dsmoc111#15 = nImporteRetencion;
              |SINO;
                  #dsmoc111#16 = nImporteRetencion;
              |FINSI;
         |FINSI;
     |SINO;
         |SI aEspecie = "N";
              #dsmoc111#12 = #dsmoc111#12 + nImporteBaseI;
              #dsmoc111#13 = #dsmoc111#13 + nImporteRetencion;
         |SINO;
              #dsmoc111#14 = #dsmoc111#14 + nImporteBaseI;
              |SI aRepercute = "N";
                  #dsmoc111#15 = #dsmoc111#15 + nImporteRetencion;
              |SINO;
                  #dsmoc111#16 = #dsmoc111#16 + nImporteRetencion;
              |FINSI;
         |FINSI;
     |FINSI;

     #dsmoc111#21 = aNombreTrabajador;
     #dsmoc111#24 = aTra;

     |SI #agitab99#8 = "S"; |Y #dsmom107#22 = "S";
         #dsmoc111#18 = #dsmoc111#18 + nImporteSS;  ||Gastos de Seguridad Social
     |FINSI;

     |SI #agitab99#8 ! "S"; |Y enEjer > 2011;
         |SI #agitab99#8 = "L"; |Y aClave = "E"; || ... tique 5127_126
             #dsmoc111#18 = nImporteSS;  ||Gastos de Seguridad Social
         |SINO;
             #dsmoc111#18 = #dsmoc111#18 + nImporteSS;  ||Gastos de Seguridad Social
         |FINSI;
     |FINSI;

     |GRABA 020#dsmoc111.a;
     |LIBERA #dsmoc111;
|FPRC;

|PROCESO nomauto2_111;
     nNume1 = 2 + (nMesLugar * 2)
     nNume2 = 2 + (nMesLugar * 2)

     |ABRE #nomauto2;
     #nomauto2#0 = #labtraba#0;
     #nomauto2#1 = #labtraba#1;
     #nomauto2#2 = enEjer;
     |LEE 000#nomauto2.=;
     |SI FSalida = 0;
          |PARA nCampo = nNume1; |SI nCampo [ nNume2; |HACIENDO nCampo = nCampo + 2;
               nImporte2 = nImporte2 + #nomauto2#nCampo#;
          |SIGUE;
     |FINSI;
     |CIERRA #nomauto2;
|FPRC;

|PROCESO labtraba02
   aAlfa1 = #labtraba#36; |QBF aAlfa1;
   |SI aAlfa1 ! "";
       fFecha = aAlfa1;
       |SI fFecha > #camaniva#4; |ACABA |FINSI;
   |FINSI;
   aAlfa1 = #labtraba#37; |QBF aAlfa1;
   |SI aAlfa1 ! "";
       fFecha = aAlfa1;
       |SI fFecha < #camaniva#4;
           aAlfa1 = aAlfa1 % 402;
           aAlfa2 = #camaniva#4;
           aAlfa2 = aAlfa2 % 402;
           |SI aAlfa1 ! aAlfa2;
               |ACABA;
           |FINSI;
       |FINSI;
   |FINSI;
   nNumTraba = #labtraba#1;
   |SI #labtraba#42 = "H"; nSwUno = 1; nNumTrabaH = #labtraba#1; |FINSI;
|FPRC;

|DEFBUCLE labtraba02
  #labtraba#5;
  ;
  nEmpresa, aDni;
  nEmpresa, aDni;
  ;
  NULL, labtraba02
|FIN;

|PROCESO BuscoTrab02;
         nSwUno    = 0;
         aDni      = #camaniva#14 % 112;
         nNumTraba = -1;
         |BUCLE labtraba02
         |SI nNumTraba ! -1;
             |ABRE #labtraba;
             |SELECT #1#labtraba;
             #labtraba#0 = nEmpresa;
             #labtraba#1 = nNumTraba;
             |LEE 040#labtraba.=;
             |SI FSalida ! 0;  |DDEFECTO #labtraba;  |FINSI;
             |CIERRA #labtraba;
         |SINO;
            |DDEFECTO #labtraba;
         |FINSI;
         aTrab42 = #labtraba#42;
|FPRC;

|PROCESO LeeLinea111;
     #dsmom030#0 = #caivalin#18;
     |LEE 000#dsmom030.=;
     |SI FSalida!0;
         #dsmom030#0 = #caivalin#3;
         |LEE 000#dsmom030.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;
     |FINSI;

     nImporteBaseI     = 0;
     nImporteRetencion = 0;

     |SI #dsmom030#0 = #cadeflab#5; |Y #dsmom107#22 = "S"; |Y #camaniva#36 = "N";
         |SI #dsmom030#5 = "G";
             nImporteSS = nImporteSS + #caivalin#11;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #dsmom030#5  ! "S"; |ACABA; |FINSI;
     |SI #dsmom030#38 ! 190; |ACABA; |FINSI;

     aClave            = #dsmom030#42;
     aSubClave         = #dsmom030#43;
     nDevengo          = 0;


     |SI aClave = "A"; |Y aSubClave = "02";
         |SI nImporteSS = 0;
             nImporteSS = nImport3;
         |SINO;
             nCadaUno = 1;
         |FINSI;
     |FINSI;

     |SI #agitab99#8 = "L";     ||Ya hemos pasado las nominas desde Laboral
         |SI aClave = "A"; |O aClave = "L"; || ... |O aClave = "E";
                                            || ... tique 3237_1890
             |ACABA;
         |FINSI;
         |SI aClave = "F"; |Y aSubClave ! "02";
             |ACABA;
         |FINSI;
     |FINSI;

     aDni              = #camaniva#14;
     nImporteBaseI     = (#caivalin#20 / enConversor) ! EURODBMOD;
     nImporteRetencion = (#caivalin#22 / enConversor) ! EURODBMOD;
     fFechaCamaniva    = #camaniva#8;
     aCadena           = fFechaCamaniva % 402;
     nMesLugar         = aCadena;
     aNombreTrabajador = #camaniva#13;
     aExtranjero       = "";
     aExtranjero2      = "";
     aFechaAlta        = "          ";
     nRel              = 0;
     aTra              = "N";
     nNumTraba         = 0;

     |SI aClave = "A"; |Y aPathLaboral ! "";
         |HAZ BuscoTrab02;

         aFechaAlta = #labtraba#36;
         nRel       = #labtraba#111;
         aTra       = #labtraba#131;
    |FINSI;

     |SI #camaniva#36 = "N"; |Y enEjer > 2010; |Y #camaniva#46 ! 0;
         aFechaAlta = #camaniva#4;   || respeta lo informado y para que no
         nRel = #camaniva#46;        || borre aTra, pongo ejercicio actual
         aTra = #camaniva#47;
     |FINSI;

     |DDEFECTO #labtraba;
     |SI #caivalin#26 = "0";  |O #caivalin#27 = "0";
         |SI aPathLaboral ! "";
             nLineaIrpf = nLineaIrpf + 1;
             |HAZ BuscoTrab02;

             |SI nLineaIrpf = 1;
                 #caivalin#26 = #labtraba#105;
                 #caivalin#27 = #labtraba#108;
             |FINSI;

             |SI nLineaIrpf = 2;
                 #caivalin#26 = #labtraba#106;
                 #caivalin#27 = #labtraba#109;
             |FINSI;

             |SI nLineaIrpf = 3;
                 #caivalin#26 = #labtraba#107;
                 #caivalin#27 = #labtraba#110;
             |FINSI;

             |GRABA 020#caivalin.a;
         |FINSI;
     |FINSI;
     |LIBERA #caivalin;

     aEspecie   = #caivalin#26;
     aRepercute = #caivalin#27;

     nImporteSSA = nImporteSS;
     |SI aClave ! "A"; |Y aClave ! "E"; |Y aClave ! "F";
         nImporteSS = 0;
     |FINSI;

     |SI aClave = "A"; |Y enEjer > 2011; |Y aPathLaboral ! "";
         |SI nImporteSS = 0;
             |SI aTrab42 = "H"; |O nSwUno = 1;
                 #labtraba#0 = nEmpresa;
                 #labtraba#1 = nNumTrabaH;
                 nMesAuto = nMesLugar;
                 nImporte2 = 0; |HAZ nomauto2_111; nImporteSS = nImporte2;
                 |SI nSwUnoS = 1; nImporteSS = 0; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nImporteBaseI ! 0; |O nImporteRetencion ! 0; |O nImporteSS ! 0;
          |HAZ Grabadsmoc111;
     |FINSI;

     nImporteSS = nImporteSSA;

     |SI aClave = "A"; |O aClave = "E"; |O aClave = "F";
         || para que vuelva a acumular
         nSwUnoS    = 1;
         |SI aClave = "A"; |Y aSubClave = "01"; nImport3 = nImporteSS; |FINSI;
         nImporteSS = 0;
     |FINSI;
|FPRC;

|DEFBUCLE caivalin110;
     #caivalin#1;
     ;
     #camaniva#0, #camaniva#1, 01;
     #camaniva#0, #camaniva#1, 99;
     e;
     NULL, LeeLinea111;
|FIN;

|PROCESO LeeCabecera111;
     |SI #camaniva#5 < nDPeriodo; |O #camaniva#5 > nHPeriodo;
          |ACABA;
     |FINSI;

     nRelA      = 0;
     nTotalA    = 0;
     nTotalA01  = 0;
     nTotalA02  = 0;
     nTotalSSA1 = 0;
     nTotalSSA2 = 0;
     nCadaUno   = 0;
     nDosA      = 0;
     nSwUnoS    = 0;
     nImporteSS = 0;
     nLineaIrpf = 0;
     nImport3   = 0;
     |BUCLE caivalin110;
     |LIBERA #camaniva;
|FPRC;

|DEFBUCLE camaniva110;
     #camaniva#1;
     ;
     00, 0000000000;  ||  nDPeriodo; Calculo en la Linea
     99, 9999999999;  ||  nHPeriodo;
     be;
     NULL, LeeCabecera111;
|FIN;

|PROCESO DesdeContabilidad_111;

     |SI enSwPartido = 0;
         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";

         enEmpresa  = nEmpresa;
         enPerConta = #canempre#3;
         eaLaMonEmp = #canempre#28;
      |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
      |FINSI;
      |HAZ EnConversor;

     |SI aPathLaboral ! "";
         |PATH_DAT #nomauto2#aPathLaboral#;
     |FINSI;

     |PATH_DAT #camaniva#aPathConta#;
     |PATH_DAT #caivalin#aPathConta#;
     |PATH_DAT #caivaasi#aPathConta#;
     |PATH_DAT #cadeflab#aPathConta#;

     |ABRE #caivaasi;
     |DDEFECTO #caivaasi;
     |LEE 000#caivaasi.p;
     |CIERRA #caivaasi;
     aMulDep = #caivaasi#132;

     |ABRE #cadeflab;
     |DDEFECTO #cadeflab;
     |LEE 000#cadeflab.p;
     |CIERRA #cadeflab;

     |ABRE #dsmom030;
     |BUCLE camaniva110;
     |CIERRA #dsmom030;

     |SI enSwPartido = 1;
         enSwOpPar   = 2;
         |HAZ FinalPartido;
     |FINSI;
|FPRC;

|PROCESO nomhicli_111;
     #nomconli#0 = #labtraba#87;
     #nomconli#2 = #nomhicli#4;
     |LEE 101#nomconli.=;
     |SI FSalida = 0;
         |SI #nomconli#8 = 0;  |ACABA;  |FINSI;

         |SI #nomconli#13 = "  ";
             #nomconli#13 = "01";
             |GRABA 020#nomconli.a;
         |FINSI;

         aClave            = "L";
         aSubClave         = #nomconli#13;
         aEspecie          = "N";
         aRepercute        = "N";
         |SI aSubClave = "24"; aEspecie = "S"; |FINSI;
         nImporteBaseI     = #nomhicli#11 * #nomhicli#10;
         nImporteRetencion = 0;
         nImporteSS        = 0;
         |HAZ Grabadsmoc111;
     |SINO;
         aAlfa1 = "0000Concepto [" + #nomconli#0 + "." + #nomconli#2 + "] inaccesible .bb..";
         |SI #nomconli#2 ! 431;
             |MENAV aAlfa1;
         |SINO;
              aClave            = "L";
              aSubClave         = #nomconli#13;
              aEspecie          = "N";
              aRepercute        = "N";
              |SI aSubClave = "24"; aEspecie = "S"; |FINSI;
              nImporteBaseI     = #nomhicli#11 * #nomhicli#10;
              nImporteRetencion = 0;
              nImporteSS        = 0;
              |HAZ Grabadsmoc111;
         |FINSI;
     |FINSI;

     |LIBERA #nomconli;
|FPRC;

|DEFBUCLE nomhicli_111;
     #nomhicli#1;
     ;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 411;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 499;
     ;
     NULL, nomhicli_111;
|FIN;

|PROCESO nomhicli_02;
     #nomcorli#0 = #labtraba#87;
     #nomcorli#2 = #nomhicli#4;
     |LEE 041#nomcorli.=;
     |SI FSalida = 0;
         |SI #nomcorli#5 = 55; |O #nomcorli#5 = 56;
              nImport1 = nImport1 + (#nomhicli#11 * #nomhicli#10) ! 2;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicli_02;
     #nomhicli#1;
     ;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 401;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 410;
     ;
     NULL, nomhicli_02;
|FIN;

|PROCESO nomhicca_111;
     nImporte2  = 0;
     nDevengo   = 0;
     nImporteSS = 0;
     nMesLugar  = #nomhicca#2;

     |SI nAtrasos = 1;
         |SI #nomhiatr#1 ! #nomhiatr#3;
             nDevengo = #nomhiatr#3;
         |FINSI;
         |SI #nomhiatr#4 ! 0; nMesLugar = #nomhiatr#4; |FINSI;
     |FINSI;

     #labempre#0 = #nomhicca#0;
     |LEE 000#labempre.=;
     |SI FSalida ! 0;  |DDEFECTO #labempre; |FINSI;

     #labtraba#0 = #nomhicca#0;
     #labtraba#1 = #nomhicca#1;
     |LEE 000#labtraba.=;
     |SI FSalida ! 0;  |DDEFECTO #labtraba; |FINSI;
     aTrab42 = #labtraba#42;

     |SI enEjer > 2011;
         |ABRE #nomnotay;
         #nomnotay#0 = nEmpresa;
         #nomnotay#1 = #labtraba#77;
         |LEE 000#nomnotay.=;
         |SI FSalida ! 0;
             #nomnotay#2 = 0;       || (%) a cero
         |FINSI;
         notaria = #nomnotay#2;
         |CIERRA #nomnotay;
         ded_not   = (#nomhicca#48 < notaria) ! 2;
         |SI aTrab42 ! "H";
             nImporte2 = (ded_not + #nomhicca#49 + #nomhicca#50 + #nomhicca#51);
         |SINO;
             |SI #nomhicca#3 = 0; |O #nomhicca#3 = 1;
                 nMesAuto = #nomhicca#2;
                 |HAZ nomauto2_111;
             |FINSI;
             |SI nImporte2 = 0;
                 nImporte2 = (ded_not + #nomhicca#49 + #nomhicca#50 + #nomhicca#51);
             |FINSI;
             |SI #nomhicca#3 = 1; |Y #nomhicca#1 = nTrabaja;
                 nImporte2 = 0;
             |FINSI;
         |FINSI;

     |FINSI;

     nTrabaja          = #nomhicca#1;
     aNombreTrabajador = #labtraba#2;
     aDni              = #labtraba#7;
     aExtranjero       = #labtraba#42;
     aExtranjero2      = #labtraba#122;

     aClave            = #labtraba#99;
     aSubClave         = #labtraba#102;
     aEspecie          = #labtraba#105;
     aRepercute        = #labtraba#108;
     aFechaAlta        = #labtraba#36;
     nRel              = #labtraba#111;
     aTra              = #labtraba#131;
     nImporteBaseI     = #nomhicca#14 + #nomhicca#16;
     nImporteRetencion = #nomhicca#15 + #nomhicca#17;
     nImporteSS        = 0;

     |SI aClave = "A"; |Y aSubClave ! "  "; aSubClave = "  "; |FINSI;

     |SI aClave  = "A"; |O aClave = "E"; |O aClave = "F";
         nImporteSS = nImporte2; nImporte2 = 0;
     |FINSI;

     |SI aClave = "A"; |Y enEjer ] 2015;  || Cambio Clave A01 y A02

         nImport3 = nImporteSS;
         nImport1 = 0;
         |ABRE #nomcorli;
         |BUCLE nomhicli_02;
         |CIERRA #nomcorli;

         |SI #nomhicca#57 ! 0; |O #nomhicca#58 ! 0;
           |O #nomhicca#59 ! 0; |O #nomhicca#60 ! 0;
            |O #nomhicca#112 ! 0; |O nImport1 ! 0;

             nImport1 = nImport1 + #nomhicca#57 + #nomhicca#58 + #nomhicca#59 + #nomhicca#60 + #nomhicca#112;
             nImport2 = (nImport1 % #nomhicca#13) ! 2;

             nImport4 = nImport3;
             |SI nImporteBaseI ! nImport1;
                 nTp100   = ((nImport1 * 100) / nImporteBaseI) ! 3;
                 nImport4 = ((nImport3 * nTp100) / 100) ! 2;
             |FINSI;

             nImporteBaseI     = nImporteBaseI - nImport1;
             nImporteRetencion = nImporteRetencion - nImport2;
             |SI enEjer ] 2016;
                 nImporteSS = nImporteSS - nImport4;
             |FINSI;

             aSubClave = "01";
             |SI nImporteBaseI ! 0; |O nImporteRetencion ! 0;
                 |HAZ Grabadsmoc111;
             |FINSI;

             nImporteBaseI     = nImport1;
             nImporteRetencion = nImport2;
             |SI enEjer ] 2016;
                 nImporteSS = nImport4; || parte proporcional
             |FINSI;
             aSubClave = "02";
         |SINO;
             aSubClave = "01";
         |FINSI;
     |FINSI;
     |HAZ Grabadsmoc111;

     aClave            = #labtraba#100;
     aSubClave         = #labtraba#103;
     aEspecie          = #labtraba#106;
     aRepercute        = #labtraba#109;
     aFechaAlta        = #labtraba#36;
     nRel              = #labtraba#111;
     aTra              = #labtraba#131;
     nImporteBaseI     = #nomhicca#108;
     nImporteRetencion = #nomhicca#110;
     nImporteSS        = 0;

     |SI aClave = "A"; |Y aSubClave ! "  ";
         aSubClave = "  ";
     |FINSI;

     |SI aClave  = "A"; |O aClave = "E"; |O aClave = "F";
         nImporteSS = nImporte2; nImporte2 = 0;
     |FINSI;

     |HAZ Grabadsmoc111;

     aClave            = #labtraba#101;
     aSubClave         = #labtraba#104;
     aEspecie          = #labtraba#107;
     aFechaAlta        = #labtraba#36;
     aRepercute        = #labtraba#110;
     nRel              = #labtraba#111;
     aTra              = #labtraba#131;
     nImporteBaseI     = #nomhicca#109;
     nImporteRetencion = #nomhicca#111;
     nImporteSS        = 0;

     |SI aClave = "A"; |Y aSubClave ! "  ";
         aSubClave = "  ";
     |FINSI;

     |SI aClave  = "A"; |O aClave = "E"; |O aClave = "F";
         nImporteSS = nImporte2; nImporte2 = 0;
     |FINSI;

     |HAZ Grabadsmoc111;

     |SI #nomhicca#18 ! 0;
         |SI #labtraba#99 ! " "; |O #labtraba#100 ! " "; |O #labtraba#101 ! " ";
             |BUCLE nomhicli_111;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca_111;
     #nomhicca#1;
     ;
     nEmpresa, 00001, nEjer, nDPeriodo, 0;
     nEmpresa, 99999, nEjer, nHPeriodo, 4;
     ;
     NULL, nomhicca_111;
|FIN;

|DEFBUCLE nomhiccaA_111;
     #nomhicca#1;
     ;
     #nomhiatr#0, 00001, nEjerAt, 01, #nomhiatr#2;
     #nomhiatr#0, 99999, nEjerAt, 12, #nomhiatr#2;
     ;
     NULL, nomhicca_111;
|FIN;

|PROCESO nomhiatr_111;

     |SI #nomhiatr#4 > nHPeriodo;  |ACABA;  |FINSI;

     |SI #nomhiatr#4 = 0;
         #nomhiatr#4 = enPeriodo;
         |GRABA 020#nomhiatr.a;
         |LIBERA #nomhiatr;
     |FINSI;

     aAlfa   = #nomhiatr#3;
     aAlfa   = aAlfa % -102;
     nEjerAt = aAlfa;
     |BUCLE nomhiccaA_111;
|FPRC;

|DEFBUCLE nomhiatr_111;
     #nomhiatr#1;
     ;
     nEmpresa, #dsmozpas#3,  5, 0000;
     nEmpresa, #dsmozpas#3, 20, 9999;
     be;
     NULL, nomhiatr_111;
|FIN;

|PROCESO DesdeNominas_111;
     |PATH_DAT #nomhicca#aPathLaboral#;
     |PATH_DAT #nomhicli#aPathLaboral#;
     |PATH_DAT #nomconli#aPathLaboral#;
     |PATH_DAT #nomauto2#aPathLaboral#;
     |PATH_DAT #nomcorli#aPathLaboral#;
     |PATH_DAT #nomnotay#aPathLaboral#;

     |ABRE #labtraba;
     |ABRE #labempre;
     |ABRE #nomconli;
     |ABRE #nomnotay;

     nTrabaja = -1;
     nAtrasos = 0;  |BUCLE nomhicca_111;
     nAtrasos = 1;  |BUCLE nomhiatr_111;

     |CIERRA #labtraba;
     |CIERRA #labempre;
     |CIERRA #nomconli;
     |CIERRA #nomnotay;
|FPRC;

|PROCESO NuevoContable_111;
     || Si es Laboral, y tiene contabilidad, podremos
     || pasar los profesionales

     enEmpresa = nEmpresa;
     enSwOpPar = 0;
     nSw       = 1;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         nSw = 0;
         |ABRE #canempre;
         |SELECT #4#canempre;
         #canempre#2  = nEmpresa;
         #canempre#26 = nEjer;
         |LEE 040#canempre.=;
         |SI FSalida = 0; nSw = 1; |FINSI;
         |CIERRA #canempre;
     |FINSI;

     |SI nSw = 0;
         enEmpresa = #dsmow013#0;
         |ACABA;
     |FINSI;

     |SI aPeriodicidad = "T";
         |SI #dsmozpas#1 = 1;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #dsmozpas#1 = 2;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #dsmozpas#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #dsmozpas#1 = 4;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
         |SI #dsmozpas#1 = 5;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
         |SI #dsmozpas#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
         |SI #dsmozpas#1 = 7;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
         |SI #dsmozpas#1 = 8;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
         |SI #dsmozpas#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
         |SI #dsmozpas#1 = 10;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
         |SI #dsmozpas#1 = 11;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
         |SI #dsmozpas#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
     |SINO;
         |SI #dsmozpas#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
         |SI #dsmozpas#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
         |SI #dsmozpas#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #dsmozpas#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SI #dsmozpas#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
         |SI #dsmozpas#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
         |SI #dsmozpas#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
         |SI #dsmozpas#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
         |SI #dsmozpas#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
         |SI #dsmozpas#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
         |SI #dsmozpas#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
         |SI #dsmozpas#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
     |FINSI;

     |HAZ DesdeContabilidad_111;

     enEmpresa = #dsmow013#0;
|FPRC;

|PROCESO PorDonde_111;
     aPathLaboral = "";
     |DBASS aBase;   |QBF aBase;
     aAlfa = aBase + "laboral/def/labempre.mas";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida ] 0;
         aPathLaboral = aBase + "laboral/fich/";
     |FINSI;

     |ABRE #dsmom002;
     #dsmom002#0 = enEmpresa;
     #dsmom002#1 = enActividad;
     #dsmom002#2 = 110;
     |LEE 040#dsmom002.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom002;  |FINSI;
     |CIERRA #dsmom002;

     aPeriodicidad = "T";
     |SI #dsmom002#7 = "MENSUAL   ";  aPeriodicidad = "M";  |FINSI;

     |ABRE #dsmoc111;

     |SI #agitab99#8 = "L"; |O #agitab99#8 = "G";
         |SI #dsmozpas#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
         |SI #dsmozpas#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
         |SI #dsmozpas#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #dsmozpas#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SI #dsmozpas#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
         |SI #dsmozpas#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
         |SI #dsmozpas#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
         |SI #dsmozpas#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
         |SI #dsmozpas#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
         |SI #dsmozpas#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
         |SI #dsmozpas#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
         |SI #dsmozpas#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;

         |DBASS aBase;   |QBF aBase;
         aAlfa = aBase + "laboral/def/labempre.mas";
         |XABRE "E", aAlfa, nHandle;
         |SI FSalida ] 0;
             aPathLaboral = aBase + "laboral/fich/";
             |HAZ DesdeNominas_111;
             nHayPase = 2;
             |SI #agitab99#8 = "L";
                 |HAZ NuevoContable_111;
             |FINSI;
         |FINSI;
     |SINO;
         enEmpresa = nEmpresa;
         enSwOpPar = 0;
         nSw       = 0;
         |HAZ SituaEmpresa;
         |SI enSwPartido = 0;
             |ABRE #canempre;
             |SELECT #4#canempre;
             #canempre#2  = nEmpresa;
             #canempre#26 = nEjer;
             |LEE 040#canempre.=;
             |SI FSalida = 0; nSw = 1; |FINSI;
             |CIERRA #canempre;
         |SINO;
              nSw = 1;
         |FINSI;

         |SI nSw = 1;
             |SI aPeriodicidad = "T";
                 |SI #dsmozpas#1 = 1;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
                 |SI #dsmozpas#1 = 2;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
                 |SI #dsmozpas#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
                 |SI #dsmozpas#1 = 4;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
                 |SI #dsmozpas#1 = 5;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
                 |SI #dsmozpas#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
                 |SI #dsmozpas#1 = 7;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
                 |SI #dsmozpas#1 = 8;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
                 |SI #dsmozpas#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
                 |SI #dsmozpas#1 = 10;  nDPeriodo = 1;  nHPeriodo = 12;   |FINSI;
                 |SI #dsmozpas#1 = 11;  nDPeriodo = 1;  nHPeriodo = 12;   |FINSI;
                 |SI #dsmozpas#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;   |FINSI;
             |SINO;
                 |SI #dsmozpas#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
                 |SI #dsmozpas#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
                 |SI #dsmozpas#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
                 |SI #dsmozpas#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
                 |SI #dsmozpas#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
                 |SI #dsmozpas#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
                 |SI #dsmozpas#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
                 |SI #dsmozpas#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
                 |SI #dsmozpas#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
                 |SI #dsmozpas#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
                 |SI #dsmozpas#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
                 |SI #dsmozpas#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
             |FINSI;

             |HAZ DesdeContabilidad_111;
             nHayPase = 1;
         |SINO;
             enEmpresa = #dsmow013#0;
             |SI #dsmozpas#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI #dsmozpas#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI #dsmozpas#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #dsmozpas#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI #dsmozpas#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
             |SI #dsmozpas#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI #dsmozpas#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
             |SI #dsmozpas#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
             |SI #dsmozpas#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI #dsmozpas#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
             |SI #dsmozpas#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
             |SI #dsmozpas#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;

             |DBASS aBase;   |QBF aBase;
             aAlfa = aBase + "laboral/def/labempre.mas";
             |XABRE "E", aAlfa, nHandle;
             |SI FSalida ] 0;
                 aPathLaboral = aBase + "laboral/fich/";
                 |HAZ DesdeNominas_111;
                 nHayPase = 2;
             |FINSI;
         |FINSI;
         enEmpresa = #dsmow013#0;
     |FINSI;

     |CIERRA #dsmoc111;
|FPRC;

|PROCESO dsmom026_111;
     nEmpresa = #dsmom026#1;
     |HAZ PorDonde_111;
|FPRC;

|DEFBUCLE dsmom026_111;
     #dsmom026#1;
     ;
     #dsmow013#0, 00001;
     #dsmow013#0, 99999;
     ;
     NULL, dsmom026_111;
|FIN;

|PROCESO OrganizaPase111;

     nPorGrupos = 0;
     |ABRE #dsmom026;
     #dsmom026#0 = #dsmow013#0;
     #dsmom026#1 = 0;
     |LEE 040#dsmom026.];
     |SI FSalida = 0;  |Y #dsmom026#0 = #dsmow013#0;
         nPorGrupos = 1;
     |FINSI;
     |CIERRA #dsmom026;

     |SI nPorGrupos = 0;
         nEmpresa = #dsmow013#0;
         |HAZ PorDonde_111;
     |SINO;
         |BUCLE dsmom026_111;
     |FINSI;
|FPRC;

|PROCESO BorrarCeros_111;
     |HAZ MiraCampos111;  || mira si son todos = 0 o no
     |SI aTodoCero = "S";
         |BORRA 020#dsmoc111.a;
         |LIBERA #dsmoc111;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc111B;
 #dsmoc111#1;
 ;
 #dsmow013#0,#dsmow013#2,#dsmow013#3,#dsmow013#7,#dsmow013#9,#dsmow013#1,aDn,0000,00," ","  ",0;
 #dsmow013#0,#dsmow013#2,#dsmow013#3,#dsmow013#7,#dsmow013#9,#dsmow013#1,aHn,9999,99,"z","zz",9;
 be;
 NULL, BorrarCeros_111;
|FIN;

|PROCESO Compensa111;
     nHay  = 0;

     #dsmoc111#0  = #espejo1@#0;
     #dsmoc111#1  = #espejo1@#1;
     #dsmoc111#2  = #dsmow013#3;
     #dsmoc111#3  = #espejo1@#3;
     #dsmoc111#4  = #dsmow013#9;
     #dsmoc111#5  = #espejo1@#5;
     #dsmoc111#6  = #espejo1@#6;
     #dsmoc111#7  = #espejo1@#7;
     #dsmoc111#8  = #espejo1@#8;
     #dsmoc111#9  = #espejo1@#9;
     #dsmoc111#10 = #espejo1@#10;
     #dsmoc111#11 = #espejo1@#11;
     |LEE 101#dsmoc111.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc111;
         #dsmoc111#0  = #espejo1@#0;
         #dsmoc111#1  = #espejo1@#1;
         #dsmoc111#2  = #dsmow013#3;
         #dsmoc111#3  = #espejo1@#3;
         #dsmoc111#4  = #dsmow013#9;
         #dsmoc111#5  = #espejo1@#5;
         #dsmoc111#6  = #espejo1@#6;
         #dsmoc111#7  = #espejo1@#7;
         #dsmoc111#8  = #espejo1@#8;
         #dsmoc111#9  = #espejo1@#9;
         #dsmoc111#10 = #espejo1@#10;
         #dsmoc111#11 = #espejo1@#11;
         #dsmoc111#21 = #espejo1@#21;
         |GRABA 020#dsmoc111.b;

         nHay = 1;
     |SINO;
         |HAZ MiraCampos111;
         |SI aTodoCero = "S";
             nHay = 1;
         |FINSI;
     |FINSI;

     |SI nHayPase = 1;

         nHay = 0;

     |SINO;
         |SI nHayPase = 2; |Y #agitab99#8 = "L"; || Tique 2046 _ 1418
                                           || para que compense profesionales
                                           || desde contablidad Pase L
             |SI #dsmoc111#9 ! "A"; |Y #dsmoc111#9 ! "L";
                 nHay = 0;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nHay = 1; |Y #dsmoc111#5 ! 99;
         nHay = 0;                 || Tique 2046_ 1418 ? tener cuidado
     |FINSI;

     |SI nHay = 1; |Y #dsmoc111#7 ! 0;
         nHay = 0;  || Tique de Serna: 98/1518 (09.01.2007)
     |FINSI;

     |SI nHay = 1;
         |PARA nCampo1 = 12;  |SI nCampo1 [ 16;  |HACIENDO nCampo1 = nCampo1 + 1;
               #dsmoc111#nCampo1# = #dsmoc111#nCampo1# + #espejo1@#nCampo1#;
         |SIGUE;
     |FINSI;

     |PARA nCampo1 = 12;  |SI nCampo1 [ 16;  |HACIENDO nCampo1 = nCampo1 + 1;
           #dsmoc111#nCampo1# = #dsmoc111#nCampo1# - #espejo1@#nCampo1#;
     |SIGUE;

     |SI #agitab99#8 = "S"; |Y #dsmom107#22 = "S";
         #dsmoc111#18 = #dsmoc111#18 - #espejo1@#18;
     |FINSI;

     |SI #agitab99#8 ! "S"; |Y enEjer > 2011;
         #dsmoc111#18 = #dsmoc111#18 - #espejo1@#18;
     |FINSI;

     |GRABA 020#dsmoc111.a;
     |LIBERA #dsmoc111;

     |HAZ MiraCampos111;  || mira si son todos = 0 o no

     |SI aTodoCero = "S";
         |SI nHay = 0;
             |BORRA 020#dsmoc111.a;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Bdsmoc111;
     #espejo1@#1012;
     ;
     #dsmow013#0, #dsmow013#2, nPeriodo, 110, nDComplem, #dsmow013#1, aDn,    0, 00, " ", "  ", 0;
     #dsmow013#0, #dsmow013#2, nPeriodo, 110, nHComplem, #dsmow013#1, aHn, 9999, 99, "z", "zz", 9;
     ;
     NULL, Compensa111;
|FIN;

|PROCESO dsmoc111A;
     |SI #dsmom002#7 = "TRIMESTRAL";
         nMesLugar = #espejo1@#8 + 3;
     |SINO;
         nMesLugar = #espejo1@#8 + 1;
     |FINSI;

     |SI nMesLugar > 12;
         nMesLugar = nMesLugar - 12;
     |FINSI;

     |SI enAnterior = 2;  nMesLugar = #espejo1@#8; |FINSI;

     #dsmoc111#0  = #espejo1@#0;
     #dsmoc111#1  = #dsmow013#2;
     #dsmoc111#2  = #dsmow013#3;
     #dsmoc111#3  = #espejo1@#3;
     #dsmoc111#4  = #dsmow013#9;
     #dsmoc111#5  = #espejo1@#5;
     #dsmoc111#6  = #espejo1@#6;
     #dsmoc111#7  = #espejo1@#7;
     #dsmoc111#8  = nMesLugar;
     #dsmoc111#9  = #espejo1@#9;
     #dsmoc111#10 = #espejo1@#10;
     #dsmoc111#11 = #espejo1@#11;
     |LEE 101#dsmoc111.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc111;
         #dsmoc111#0  = #espejo1@#0;
         #dsmoc111#1  = #dsmow013#2;
         #dsmoc111#2  = #dsmow013#3;
         #dsmoc111#3  = #espejo1@#3;
         #dsmoc111#4  = #dsmow013#9;
         #dsmoc111#5  = #espejo1@#5;
         #dsmoc111#6  = #espejo1@#6;
         #dsmoc111#7  = #espejo1@#7;
         #dsmoc111#8  = nMesLugar;
         #dsmoc111#9  = #espejo1@#9;
         #dsmoc111#10 = #espejo1@#10;
         #dsmoc111#11 = #espejo1@#11;
         #dsmoc111#21 = #espejo1@#21;

         |SI enAnterior = 2;
             #dsmoc111#12 = #espejo1@#12;
             #dsmoc111#13 = #espejo1@#13;
             #dsmoc111#14 = #espejo1@#14;
             #dsmoc111#15 = #espejo1@#15;
             #dsmoc111#16 = #espejo1@#16;
             #dsmoc111#17 = #espejo1@#17;
             #dsmoc111#18 = #espejo1@#18;
             #dsmoc111#19 = #espejo1@#19;
             #dsmoc111#20 = #espejo1@#20;
             #dsmoc111#22 = #espejo1@#22;
             #dsmoc111#23 = #espejo1@#23;
             #dsmoc111#24 = #espejo1@#24;
         |FINSI;

         |GRABA 020#dsmoc111.n;
    |FINSI;
    |LIBERA #dsmoc111;
|FPRC;

|DEFBUCLE dsmoc111A;
     #espejo1@#1012;
     ;
     #dsmow013#0, nAnyo, nPeriodo, 110, nDComplem, #dsmow013#1, aDn,    0, 00, " ", "  ", 0;
     #dsmow013#0, nAnyo, nPeriodo, 110, nHComplem, #dsmow013#1, aHn, 9999, 99, "z", "zz", 9;
     ;
     NULL, dsmoc111A;
|FIN;

|PROCESO dsmoc110A_111;
     nRel       = 0;
     |SI #espejo1@#8 = "A";  nRel = 1;  |FINSI;

     #dsmoc111#0  = #espejo1@#0;
     #dsmoc111#1  = #dsmow013#2;
     #dsmoc111#2  = #dsmow013#3;
     #dsmoc111#3  = #espejo1@#3;
     #dsmoc111#4  = #dsmow013#9;
     #dsmoc111#5  = #espejo1@#5;
     #dsmoc111#6  = #espejo1@#6;
     #dsmoc111#7  = #espejo1@#7;
     #dsmoc111#8  = 1;
     #dsmoc111#9  = #espejo1@#8;
     #dsmoc111#10 = #espejo1@#9;
     #dsmoc111#11 = nRel;
     |LEE 101#dsmoc111.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc111;
         #dsmoc111#0  = #espejo1@#0;
         #dsmoc111#1  = #dsmow013#2;
         #dsmoc111#2  = #dsmow013#3;
         #dsmoc111#3  = #espejo1@#3;
         #dsmoc111#4  = #dsmow013#9;
         #dsmoc111#5  = #espejo1@#5;
         #dsmoc111#6  = #espejo1@#6;
         #dsmoc111#7  = #espejo1@#7;
         #dsmoc111#8  = 1;
         #dsmoc111#9  = #espejo1@#8;
         #dsmoc111#10 = #espejo1@#9;
         #dsmoc111#11 = nRel;
         #dsmoc111#21 = #espejo1@#29;
         |GRABA 020#dsmoc111.n;
    |FINSI;
    |LIBERA #dsmoc111;
|FPRC;

|DEFBUCLE dsmoc110A_111;
     #espejo1@#1010;
     ;
     #dsmow013#0, nAnyo, nPeriodo, 110, nDComplem, #dsmow013#1, aDn,    0, " ", "  ";
     #dsmow013#0, nAnyo, nPeriodo, 110, nHComplem, #dsmow013#1, aHn, 9999, "z", "zz";
     ;
     NULL, dsmoc110A_111;
|FIN;

|PROCESO dsmom002_111;
     |ERROR10;
|FPRC;

|DEFBUCLE dsmom002_111;
     #dsmom002#1;
     ;
     #dsmow013#0,  1, 110;
     #dsmow013#0, 98, 110;
     ;
     NULL, dsmom002_111;
|FIN;

|PROCESO PaseAnterior111;
     |BUCLE dsmom002_111;

     |SI FSalida ! 0;  |O #dsmom002#0 ! #dsmow013#0;  |O #dsmom002#2 ! 110;
         |DDEFECTO #dsmom002;
     |FINSI;

     |SI enAnterior = 2;
         nAnyo    = #dsmow013#2;
         nPeriodo = #dsmow013#3;
         nDcom    = nDComplem; nDComplem = #dsmow013#9 - 1;
         nHcom    = nHComplem; nHComplem = #dsmow013#9 - 1;
     |SINO;
         nAnyo = #dsmow013#2;
         |SI #dsmom002#7 = "TRIMESTRAL";
             |SI #dsmow013#3 = 3;
                 nAnyo = #dsmow013#2 - 1;
                 nPeriodo = 12;
             |SINO;
                 nPeriodo = #dsmow013#3 - 3;
             |FINSI;
         |SINO;
             |SI #dsmow013#3 = 1;
                 nAnyo = #dsmow013#2 - 1;
                 nPeriodo = 12;
             |SINO;
                 nPeriodo = #dsmow013#3 - 1;
             |FINSI;
         |FINSI;
     |FINSI;

     |ABRE #dsmoc111;
     |SI nAnyo = 2010;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc110.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |BUCLE dsmoc110A_111;
     |FINSI;

     |SI nAnyo ] 2011;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc111.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |BUCLE dsmoc111A;
     |FINSI;
     |CIERRA #dsmoc111;

     |DESCARGA_DEF #espejo1@;


     |SI enAnterior = 2;
         nDComplem = nDcom;
         nHComplem = nHcom;
     |FINSI;

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enPeriodo     = #dsmow013#3;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmow013#9;
     enActividad   = #dsmow013#1;
     enTipoEntrada = 98;
     eaNombreAct   = #dsmow013#6;
     |SUB_EJECUTA_NP "dsmoc111";

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB
         #dsmom004#9 = " ";
         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROCESO Pase111_02;
     |ABRE #dsmom107;
     |DDEFECTO #dsmom107;
     |LEE 001#dsmom107.p;
     |CIERRA #dsmom107;
     |SI #dsmow013#2 > 2011; #dsmom107#22 = "S"; |FINSI;

     |DDEFECTO #dsmom008;
     |ABRE #dsmom008;
     #dsmom008#0 = #dsmow013#0;
     #dsmom008#1 = #dsmow013#2;
     #dsmom008#2 = #dsmow013#3;
     #dsmom008#3 = #dsmow013#7;
     #dsmom008#4 = #dsmow013#9;
     #dsmom008#5 = #dsmow013#1;
     |LEE 101#dsmom008.=;
     |SI FSalida = 0;  |Y enAnterior = 0;
         #dsmom008#11 = "SIN DATOS";
         |GRABA 020#dsmom008.a;

         enEmpresa     = #dsmom008#0;
         enEjer        = #dsmom008#1;
         enPeriodo     = #dsmom008#2;
         enModelo      = #dsmom008#3;
         enComplem     = #dsmom008#4;
         enActividad   = #dsmom008#5;
         enTipoEntrada = 97;
         |SUB_EJECUTA_NP "dsmoc111";
     |FINSI;
     |LIBERA #dsmom008;
     |CIERRA #dsmom008;

     |SI enAnterior ! 0;         || Recogida de un Periodo Anterior
         |HAZ PaseAnterior111;

         |ACABA;
     |FINSI;

     |ABRET #dsmoc111;

     aAlfa = #dsmow013#2;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enPeriodo     = #dsmow013#3;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmow013#9;
     enActividad   = #dsmow013#1;
     nHayPase      = 0;

     |HAZ OrganizaPase111;

     |SI nHayPase = 0;
         enEmpresa     = #dsmow013#0;
         enEjer        = #dsmow013#2;
         enPeriodo     = #dsmow013#3;
         enModelo      = #dsmow013#7;
         enComplem     = #dsmow013#9;
         enActividad   = #dsmow013#1;
         enTipoEntrada = 98;
         eaNombreAct   = #dsmow013#6;
         |SUB_EJECUTA_NP "dsmoc111";
         |CIERRAT #dsmoc111;
         |CIERRA #canempre;
         |ACABA;
     |FINSI;

     |SI #dsmow013#3 ! 1;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc111.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida = 0;
             nHComplem = enComplem;  || miro el ultimo complementario
                                     || de los periodos anteriores 14_1285
             |PARA nPeriodo = 1;  |SI nPeriodo < #dsmow013#3;  |HACIENDO nPeriodo = nPeriodo + 1;
                   nDComplem = -1;
                   |ABRE #espejo1@;
                   |DDEFECTO #espejo1@;
                   #espejo1@#0 = #dsmow013#0;
                   #espejo1@#1 = #dsmow013#2;
                   #espejo1@#2 = nPeriodo
                   #espejo1@#3 = 110;
                   #espejo1@#4 = 99;
                   |LEE 040#espejo1@.];
                   |SI FSalida = 0;
                       |LEE 040#espejo1@.a;
                    |SINO;
                       |LEE 040#espejo1@.u;
                   |FINSI;
                   |SI FSalida = 0; |Y #espejo1@#0 = #dsmow013#0; |Y #espejo1@#1 = #dsmow013#2;
                             |Y #espejo1@#2 = nPeriodo; |Y #espejo1@#3 = 110;
                                nDComplem = #espejo1@#4;
                                nHComplem = #espejo1@#4;
                   |FINSI;
                   |CIERRA #espejo1@;

                   |SI nDComplem ] 0; |BUCLE Bdsmoc111; |FINSI;
             |SIGUE;
         |FINSI;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     |CIERRAT #dsmoc111;

     enSaldo1Ch = 0;
     enSaldo2Ch = 0;

     |SI nHayPase = 2; |Y #dsmow013#1 ! 99;
         |BUCLE dsmoc111B;
     |FINSI;                ||si viene de nominas
                            ||Socer y Serna 18.10.2007

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enPeriodo     = #dsmow013#3;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmow013#9;
     enActividad   = #dsmow013#1;
     enTipoEntrada = 98;
     eaNombreAct   = #dsmow013#6;
     |SUB_EJECUTA_NP "dsmoc111";

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         #dsmom004#9 = " ";
         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;

     |SI #dsmom004#7 = "X"; |Y enSwCheqPase = 1;
         enOperaCh  = 1;
         |HAZ GrabaAux151;
     |FINSI;
|FPRC;

|| ------------------------------------------------------------------

|PROCESO nomhicca_1_111;
     nImporteBaseI     = #nomhicca#14 + #nomhicca#16;
     nImporteRetencion = #nomhicca#15 + #nomhicca#17;
     |SI nImporteBaseI ! 0; |O nImporteRetencion ! 0; enSwNuevo110 = 1; |FINSI;

     nImporteBaseI     = #nomhicca#108;
     nImporteRetencion = #nomhicca#110;
     |SI nImporteBaseI ! 0; |O nImporteRetencion ! 0; enSwNuevo110 = 1; |FINSI;

     nImporteBaseI     = #nomhicca#109;
     nImporteRetencion = #nomhicca#111;
     |SI nImporteBaseI ! 0; |O nImporteRetencion ! 0; enSwNuevo110 = 1; |FINSI;

     |SI #nomhicca#18 ! 0; enSwNuevo110 = 1; |FINSI;

     |SI enSwNuevo110 = 1;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca_1_111;
     #nomhicca#1;
     ;
     nEmpresa, 00001, nEjer, nDPeriodo, 0;
     nEmpresa, 99999, nEjer, nHPeriodo, 4;
     ;
     NULL, nomhicca_1_111;
|FIN;

|DEFBUCLE nomhiccaA_1_111;
     #nomhicca#1;
     ;
     #nomhiatr#0, 00001, nEjerAt, 01, #nomhiatr#2;
     #nomhiatr#0, 99999, nEjerAt, 12, #nomhiatr#2;
     ;
     NULL, nomhicca_1_111;
|FIN;

|PROCESO nomhiatr_1_111;
     |SI #nomhiatr#4 [ nHPeriodo;
         aAlfa   = #nomhiatr#3;
         aAlfa   = aAlfa % -102;
         nEjerAt = aAlfa;
         |BUCLE nomhiccaA_1_111;
     |FINSI;
|FPRC;

|DEFBUCLE nomhiatr_1_111;
     #nomhiatr#1;
     ;
     nEmpresa, #dsmozpas#3,  5, 0000;
     nEmpresa, #dsmozpas#3, 20, 9999;
     e;
     NULL, nomhiatr_1_111;
|FIN;

|PROCESO PorDonde_1_111;
     |SI #dsmozpas#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
     |SI #dsmozpas#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
     |SI #dsmozpas#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
     |SI #dsmozpas#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
     |SI #dsmozpas#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
     |SI #dsmozpas#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
     |SI #dsmozpas#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
     |SI #dsmozpas#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
     |SI #dsmozpas#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
     |SI #dsmozpas#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
     |SI #dsmozpas#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
     |SI #dsmozpas#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;

     |DBASS aBase;   |QBF aBase;
     aAlfa = aBase + "laboral/def/labempre.mas";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida ] 0;
         aPathLaboral = aBase + "laboral/fich/";

         |PATH_DAT #nomhicca#aPathLaboral#;
         |PATH_DAT #nomhicli#aPathLaboral#;
         |PATH_DAT #nomauto2#aPathLaboral#;
         |PATH_DAT #nomcorli#aPathLaboral#;
         |PATH_DAT #nomnotay#aPathLaboral#;

         nAtrasos = 0;  |BUCLE nomhicca_1_111;
         |SI enSwNuevo110 = 0;
             nAtrasos = 1;  |BUCLE nomhiatr_1_111;
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO dsmom026_1_111;
     nEmpresa = #dsmom026#1;
     |HAZ PorDonde_1_111;
     |SI enSwNuevo110 = 1; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE dsmom026_1_111;
     #dsmom026#1;
     ;
     #dsmow013#0, 00001;
     #dsmow013#0, 99999;
     ;
     NULL, dsmom026_1_111;
|FIN;

|PROCESO MiroChequeoNuevo_111;
     aAlfa = #dsmow013#2;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enPeriodo     = #dsmow013#3;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmow013#9;
     enActividad   = #dsmow013#1;

     nPorGrupos = 0;
     |ABRE #dsmom026;
     #dsmom026#0 = #dsmow013#0;
     #dsmom026#1 = 0;
     |LEE 040#dsmom026.];
     |SI FSalida = 0;  |Y #dsmom026#0 = #dsmow013#0;
         nPorGrupos = 1;
     |FINSI;
     |CIERRA #dsmom026;

     |SI nPorGrupos = 0;
         nEmpresa = #dsmow013#0;
         |HAZ PorDonde_1_111;
     |SINO;
         |BUCLE dsmom026_1_111;
     |FINSI;
|FPRC;
