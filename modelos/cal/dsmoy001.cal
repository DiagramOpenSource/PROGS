|FICHEROS;
     dsmoy001 #0;

     dsmom030 #30;
     dsmo1347 #347;
     dsmo2347 #348;
     dsmo3347 #349;
     dsmo4347 #350;
     dsmom072 #72;
     dsmom107 #7;

     dsmom100 #100;

     :/contagen/def/canempre #101;
     :/contagen/def/camaniva #102;
     :/contagen/def/caivalin #103;
     :/contagen/def/caclipro #104;
     :/contagen/def/camaasil #105;
     :/contagen/def/caivaasi #106;
     :/contagen/def/camanefe #110;
     :/contagen/def/caconimp #306;

     :/basica/def/agifigen   #115;
     :/basica/def/agicen17   #117;
     :/basica/def/agicen14   #214;

     :/integral/def/dsam0001;
     :/integral/def/dsam0000;

     &regisnif@ #709;

     dsmow024 #999;
     dsmow102 #998;
     espejo@  #900;
|FIN;

|VARIABLES;
     nSwSel = 0;
     &eaTit2    = "";
     &enDatos   = 0;
     aPath      = "";
     nPara1     = 0;
     nCampo     = 0;
     nDEmpresa  = 0;
     nHEmpresa  = 0;
     nNegativo  = 0;
     nTopeA     = 0;
     nTopeB     = 0;
     nTopeC     = 0;
     nTopeD     = 0;
     nTopeE     = 0;
     nTopeAI    = 0;
     nTopeBI    = 0;
     nTopeCI    = 0;
     nTopeDI    = 0;
     nTopeEI    = 0;
     nSwPrint   = 0;
     nEjer      = 0;
     nHay       = 0;
     nDComple   = 0;
     nHComple   = 0;
     nSw        = 0;
     aNif       = "";

     aOp1       = "";
     aDClave    = "";
     aHClave    = "";
     aClau      = "";
     aClave     = "";
     aFichero   = "";
     aAlfa      = "";
     aAlfa1     = "";
     aAlfa2     = "";
     aAlfa3     = "";
     &eaAlfa    = "";
     &enTope    = 0;
     &eaDescri  = "";
     &eaDescri1 = "";
     &eaDescri2 = "";
     &eaMoneda  = "";
     &eaMail    = "";
     fLaFecha   = @;
     aBase      = "";
     nCanal     = 0;
     informe    = "";
     inform1    = "";
     inform2    = "";
     inform3    = "";
     nImporte   = 0;
     nUltim     = 0;

     nTopPan    = 0;
     nTopPa1    = 0;

    aCliPro = "";
    aDClPr  = "";
    aHClPr  = "";
    nLaEmpresa = 0;
    nElPeriodo = 0;

    aDCta  = "";
    aHCta  = "";
    aDNif  = "";
    aHNif  = "";
    nSwInf = 0;
    &enSwLinea = 0;
    nAny   = 0;

    nCampo4 = 0;
    nPeriodo = 0;
    nNume1   = 0;
    nNume2   = 0;
    &enPerFra = 0;
    nDepar   = 0;
    aFormato = "";
    aPathModelo = "";
    aDef        = "";

    fFecIni = @;
    fFecFin = @;
    fFecha1 = @;
    fFecha2 = @;
    fFec1   = @;
    fFec2   = @;
    nSwFecha = 0;

    aCadena   = "";
    aLong     = "";
    nLong     = 0;
    nPos      = 0;
    aCaracter = "";
    nCam      = 0;
    aDNom     = "";
    aHNom     = "";
    &XVAR_DC_IMPRIME = 0;
    &eDatosW30 = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|PROCESO elany; |TIPO 7;
     |HAZ MiraVarMoneda;
     |SI enEjer = 0;
         fLaFecha = ~;
         aAlfa1 = fLaFecha; aAlfa1 = aAlfa1 % -104;
         #0Campo = aAlfa1;
         #0Campo = #0Campo - 1;
     |SINO;
         #0Campo = enEjer;
     |FINSI;
     |PINTA #0Campo;

     |SI eaMoneda ! "EUROS  ";
         #0#82 = 500000;
     |SINO;
         #0#82 = 3005.06;
    |FINSI;
    |PINTA #0#82;

    |SI PARAMETRO = "MODELOS";
         |ATRI R;
         |PINTA 0502, "Carta de Aviso de Compras y Ventas Superiores desde el Propio Modelo 347";
         |ATRI r;

         #0#63 = "C";  |C_M #0#63, 1, "N";  |C_V #0#63,1,"N";
         #0#67 = "N";  |C_M #0#67, 1, "N";  |C_V #0#67,1,"N";
                       |C_M #0#82, 1, "N";
         #0#83 = 1;    |C_M #0#83, 1, "N";  |C_V #0#83,1,"N";
         #0#92 = "N";  |C_M #0#92, 1, "N";  |C_V #0#92,1,"N";
         #0#84 = "N";  |C_M #0#84, 1, "N";  |C_V #0#84,1,"N";
                       |C_M #0#95, 1, "S";  |C_V #0#95,1,"S";
                       |C_M #0#96, 1, "S";  |C_V #0#96,1,"S";
         |PINTA 0727, "                    ";
         || |ATRI I; |PINTA 0804, "(Emision por NIF y claves de agrupacion del Modelo 347)                  "; |ATRI 0;
            |ATRI I; |PINTA 0804, "(Emision por NIF y claves agr. Modelo 347)                               "; |ATRI 0;
                     |PINTA 0848, "Seleccion Clave:   Clave:  ";
                     |PINTA #0#95; |PINTA #0#96;
         |PINTA 1104, "                 ";
         |PINTA #0#82;
    |SINO;
         #0#95 = "N";  |C_M #0#95, 1, "N";  |C_V #0#95,1,"N";
         #0#96 = " ";  |C_M #0#96, 1, "N";  |C_V #0#96,1,"N";
    |FINSI;

    |SI PARAMETRO = "C";
         #0#63 = "C";  |C_M #0#63, 1, "N";  |PINTA #0#63;
    |FINSI;

    |HAZ DatosEmp;
    |SI PARAMETRO ! "MODELOS";
        |MENSA "    Pulse <F2> para seleccionar Desde/Hasta Fecha";
    |FINSI;
|FPRC;

|PROCESO elany0; |TIPO 0;
    |BLIN 4;

    |SI FSalida = 10; |Y PARAMETRO ! "MODELOS";

        aAlfa1 = #0#0; aAlfa1 = "01.01." + aAlfa1; fFec1 = aAlfa1;
        aAlfa2 = #0#0; aAlfa2 = "31.12." + aAlfa2; fFec2 = aAlfa2;
        |SI nSwFecha = 0;
            fFecha1 = fFec1;
            fFecha2 = fFec2;
        |FINSI;

        |PUSHV 0501 2380;
        |BLANCO 0622 0948;
        |CUADRO 0622 0948;
        |ATRI R; |PINTA 0723, " Desde Fecha: ";
                 |PINTA 0823, " Hasta Fecha: "; |ATRI r;
        |PINTA 0737, fFecha1;
        |PINTA 0837, fFecha2;

 |ET PrimFecha;
        fFecha1 = 0737 ? 1;
        |SI FSalida = 1; |O FSalida = 7;
           |POPV;
           |ACABA;
        |FINSI;

        |SI fFecha1 < fFec1; |O fFecha1 > fFec2;
            |MENAV "    Fecha Incorrecta";
            |VETE PrimFecha;
        |FINSI;

 |ET SegunFecha;
        fFecha2 = 0837 ? 1;
        |SI FSalida = 7;  |POPV;  |ACABA;   |FINSI;
        |SI FSalida = 2;  |VETE PrimFecha;  |FINSI;

        |SI fFecha2 < fFec1; |O fFecha2 > fFec2; |O fFecha2 < fFecha1;
            |MENAV "    Fecha Incorrecta";
            |VETE SegunFecha;
        |FINSI;

        |CONFI "    SSeleccion de Fechas Correcta";
        |SI FSalida = 0;
            nSwFecha = 1;
            fFecIni = fFecha1;
            fFecFin = fFecha2;
        |SINO;
            |VETE PrimFecha;
        |FINSI;
        |POPV;
    |FINSI;
|FPRC;

|PROCESO DatosEmp;
   |DDEFECTO #306;
   |ABRE #100;
   |LEE 040#100p;
   |SI FSalida = 0;
       aAlfa1 = #100#1; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
       aAlfa2 = #100#2; |QBF aAlfa2; aAlfa2 = ("0"     + aAlfa2) % -101;
       |DBASS aPath; |QBT aPath;
       aPathConta = aPath + "contagen/fich/" + aAlfa1 + aAlfa2 + "/";
       |PATH_DAT #306 aPathConta;
       |ABRE #306;
       |DDEFECTO #306;
       #306#0 = 1;
       |LEE 000#306=;
       |CIERRA #306;

   |FINSI;
   |CIERRA #100;
   #0#84  = #306#7; |PINTA #0#84;
   aAlfa1 = #306#8; |C_M #0#84,1,aAlfa1;
|FPRC;

|PROCESO AntesD; |TIPO 7;
 |SI #0#63 = "C";
     aAlfa1 = "N";
 |SINO;
     aAlfa1 = #306#8;
 |FINSI;
 |C_M #0#84,1,aAlfa1;
|FPRC;

|PROCESO hagocarta; |TIPO 7;
 |C_M #0Campo, 1,"N";
 |SI #0#63 = "C";
     |C_M #0Campo, 1,"S";
 |FINSI;
|FPRC;

|PROCESO hagocarta0; |TIPO 0;
  |C_M #0#93,1,"S";
  |SI #0#63 ! "C"; |O #0#68 ! 3;
      |C_M #0#93,1,"N";
      |C_M #0#97,1,"N";
      |C_V #0#97,1,"N";
      |PINTA 0776, "  ";
  |FINSI;
|FPRC;

|PROCESO EnCrystal; |TIPO 0;
  |C_M #0#93,0,aAlfa1;
  |SI aAlfa1 = "N"; |ACABA; |FINSI;

  |SI FSalida = 10;
      #0#93 = "347cryst"; |PINTA #0#93;
  |FINSI;
  |SI #0#93 = "347cryst";
      |C_V #0#97, 1, "S";
      |C_M #0#97, 1, "S";
  |SINO;
      |C_V #0#97, 1, "N";
      |C_M #0#97, 1, "N";
  |FINSI;
|FPRC;

|PROCESO MiraVarMoneda;
     |HAZ PintaMoneda;

     #0#66 = eaMoneda;
     |PINTA #0#66;
|FPRC;

|PROCESO Parrilla;
     |SI #0#1 = 0;
         #0#1 = 0;  |PINTA #0#1;
         #0#2 = 0;  |PINTA #0#2;  |C_M #0#2, 1, "N";
         |PARA nCampo = 3;  |SI nCampo [ 27;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#2, 1, "S";
         |FINSI;
         |PARA nCampo = 3;  |SI nCampo [ 27;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 27;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 27;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO QueSelec;
 aAlfa1 = #0#85;
 aAlfa2 = #0#85; |SI PARAMETRO = "MODELOS"; aAlfa2 = "N"; |FINSI;

 |C_M #0#86,1,aAlfa2; |C_M #0#87,1,aAlfa2;
 |C_M #0#88,1,aAlfa2; |C_M #0#89,1,aAlfa2;
 |C_M #0#90,1,aAlfa1; |C_M #0#91,1,aAlfa1;

 |SI aAlfa1 = "N";
     |PDEFECTO #0, 86, 92;
     |PINTA #0#86; |PINTA #0#87;
     |PINTA #0#88; |PINTA #0#89;
     |PINTA #0#90; |PINTA #0#91;
 |FINSI;
|FPRC;

|CALCULO AntesCta; |TIPO 7;
    |SI enEmpresa ! 0; |Y PARAMETRO = "";
        |MENSA "0000Ctrl-F2 Utilidades Cuentas";
    |FINSI;
|FCAL;

|CALCULO cuenta; |TIPO 0;
     salidas  = FSalida;
     |C_M #0Campo,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |BLIN 4;
     |ABRE #100;
     |LEE 040#100p;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;
     |CIERRA #100;

     nLaEmpresa = enEmpresa;
     nElPeriodo = enPerConta;
     |SI enEmpresa = 0; |O PARAMETRO ! "";
         enEmpresa  = #100#1;
         enPerConta = #100#2;
     |FINSI;
     eaCuenta = #0Campo;
     |HAZ FiltraPuntos;
     #0Campo = eaCuenta;
     |PINTA #0Campo;
     enEmpresa  = nLaEmpresa;
     enPerConta = nElPeriodo;
|FCAL;

|CALCULO SelClave;
  |C_M #0#95, 0, aAlfa1;
  |SI aAlfa1 = "N"; |ACABA; |FINSI;

  aAlfa1 = #0#95;
  |C_M #0#96, 1, aAlfa1;
  |SI aAlfa1 = "N";
      #0#96 = ""; |PINTA #0#96;
  |FINSI;
|FCAL;

|| =================================================================
|PROCESO QuitaRaros_B;

     aCadena = "";
     aLong   = eaAlfa % 0;
     nLong   = aLong;
     |PARA nPara1 = 1;  |SI nPara1 [ aLong;  |HACIENDO nPara1 = nPara1 + 1;
           nPos = (100 * nPara1) + 1;
           aCaracter = eaAlfa % nPos;
           nCam = 0;

||           |SI aCaracter = "Ñ"; |Y nCam = 0; aCaracter = "¥";  nCam = 1; |FINSI; || Tique 3325_466
           |SI aCaracter = "ñ"; |Y nCam = 0; aCaracter = "¤";  nCam = 1; |FINSI;
           |SI aCaracter = "º"; |Y nCam = 0; aCaracter = "§";  nCam = 1; |FINSI;
           |SI aCaracter = "ª"; |Y nCam = 0; aCaracter = "¦";  nCam = 1; |FINSI;
           |SI aCaracter = "á"; |Y nCam = 0; aCaracter = " ";  nCam = 1; |FINSI;
           |SI aCaracter = "é"; |Y nCam = 0; aCaracter = "‚";  nCam = 1; |FINSI;
           |SI aCaracter = "í"; |Y nCam = 0; aCaracter = "¡";  nCam = 1; |FINSI;
           |SI aCaracter = "ó"; |Y nCam = 0; aCaracter = "¢";  nCam = 1; |FINSI;
           |SI aCaracter = "ú"; |Y nCam = 0; aCaracter = "£";  nCam = 1; |FINSI;

||           |SI aCaracter = "¥"; |Y nCam = 0; aCaracter = &209; nCam = 1; |FINSI;
           |SI aCaracter = "¤"; |Y nCam = 0; aCaracter = &209; nCam = 1; |FINSI;
           |SI aCaracter = "§"; |Y nCam = 0; aCaracter = &176; nCam = 1; |FINSI;
           |SI aCaracter = "¦"; |Y nCam = 0; aCaracter = &170; nCam = 1; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena;
|FPRC;

|| =================================================================
|PROCESO PerCaptura;
    nPeriodo = 0;
    |SI #214#15 = "MODULOS   ";
        nPeriodo = #102#5;      || en de la Factura
    |SINO;
        |SI #7#27 = "F"
            nPeriodo = #102#5;
        |SINO;
            |SI #102#40 ! 0;
                nPeriodo = #102#40;
            |SINO;
                nPeriodo = #102#5;
            |FINSI;
        |FINSI;
     |FINSI;
     |SI nPeriodo = 0;
         aAlfa1 = #102#4;
         aAlfa1 = aAlfa1 % 0402;
         nPeriodo = aAlfa1;
     |FINSI;
|FPRC;

|PROCESO LeoActi;
     |DDEFECTO #214;
     #214#0 = enEmpresa;
     #214#1 = nDepar;
     |SI #214#1 = 0;  #214#1 = 1;   |FINSI;
     |LEE 041#214=;
|FPRC;

|PROCESO ElDetalle_N;
 |PRINT;
 enSwLinea = 5;
|FPRC;

|DEFBUCLE ElDetalle_N;
 #998#2;
 ;
 #999#0, aAlfa1, 01, "01.01.0000", 000001, 0001;
 #999#0, aAlfa1, 98, "31.12.2999", 999999, 9999;
 ;
 NULL, ElDetalle_N;
|FIN;

|PROCESO ElDetalle;
 |PRINT;
 enSwLinea = 2;
|FPRC;

|DEFBUCLE ElDetalle;
 #998#1;
 ;
 #999#0, #999#1, 00, 0000000001;
 #999#0, #999#1, 99, 9999999999;
 ;
 NULL, ElDetalle;
|FIN;

|PROCESO ElDetalle_per;
  nPeriodo = 1;
  |SI #998#22 > 3; nPeriodo = 2; |FINSI;
  |SI #998#22 > 6; nPeriodo = 3; |FINSI;
  |SI #998#22 > 9; nPeriodo = 4; |FINSI;

 |SI enPerFra = -1;
     enPerFra = nPeriodo;
 |FINSI;
 |SI nPeriodo ! enPerFra;
     enSwLinea = 7; |PRINT;
     enPerFra  = nPeriodo;
     enSwLinea = 2;
 |FINSI;

 |PRINT;
 enSwLinea = 2;
|FPRC;

|DEFBUCLE ElDetalle_per;
 #998#3;
 ;
 #999#0, #999#1, 00, 00, 0000000001;
 #999#0, #999#1, 99, 99, 9999999999;
 ;
 NULL, ElDetalle_per;
|FIN;

|PROCESO LeeLinea;

     #30#0 = #103#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |SI #30#51 = "X"; |ACABA;  |FINSI;

     aClave = "";
     |SI #30#44 = "X";  aClave = "A";  |FINSI;
     |SI #30#45 = "X";  aClave = "B";  |FINSI;
     |SI #30#46 = "X";  aClave = "C";  |FINSI;
     |SI #30#47 = "X";  aClave = "D";  |FINSI;
     |SI #30#48 = "X";  aClave = "E";  |FINSI;
     |SI #30#76 = "X";  aClave = "F";  |FINSI;
     |SI #30#77 = "X";  aClave = "G";  |FINSI;
     |SI #30#49 = "X";  aClave = "X";  |FINSI;
     |SI aClave = "";  |ACABA;  |FINSI;

     |SI #0#95 = "S";
         |SI #0#96 ! aClave; |ACABA; |FINSI;
     |FINSI;

     nDepar = #102#10;
     |SI aMulDep = "S";
         aAlfa1 = #103#30; |QBF aAlfa1;
         |SI aAlfa1 = ""; #103#30 = #102#10; aAlfa1 = #103#31; |QBF aAlfa1; |FINSI;
         nDepar = #103#30;
     |FINSI;
     |HAZ LeoActi;

     |SI #0#67 = "N";
         aClau = #102#14;  || Nif
     |SINO;
         aClau = #102#12;  || Cuenta Contable
     |FINSI;

     #999#0 = aClau;
     #999#1 = aClave;
     |LEE 101#999=;
     |SI FSalida ! 0;
         |DDEFECTO #999;
         #999#0 = aClau;
         #999#1 = aClave;
         |GRABA 020#999b;
     |FINSI;

     #999#2   = #102#13;
     eaAlfa  = #999#2; |HAZ QuitaRaros_B; #999#2 = eaAlfa;

     eaCodNif = #102#14;
     |HAZ LeeNifs;
     #999#4   = #709#9;
     aAlfa    = #709#2;  |QBF aAlfa;
     aAlfa    = aAlfa + ", " + #709#3;
     #999#5   = aAlfa;
     #999#6   = (("00" + #709#4) % -102) + (("000" + #709#5) % -103);
     #999#7   = #709#6;
     nPeriodo = 1;
     nCampo4  = 8;
     |SI enEjer > 2010;
         |HAZ PerCaptura;
         |SI nPeriodo [ 3;                  nCampo4 = 16; |FINSI;
         |SI nPeriodo > 3; |Y nPeriodo [ 6; nCampo4 = 17; |FINSI;
         |SI nPeriodo > 6; |Y nPeriodo [ 9; nCampo4 = 18; |FINSI;
         |SI nPeriodo > 9;                  nCampo4 = 19; |FINSI;
     |FINSI;

     aOp1 = "N";
     |SI aClave = "A"; |Y #30#26 = 6; |Y #30#28 [ 2; |Y #30#28 ! 0;
         aOp1 = "S";
     |FINSI;
     |SI aClave = "A"; |Y #30#26 = 0; |Y #30#30 = 3;
         aOp1 = "S";
     |FINSI;

     |SI aOp1 = "S";
         #999nCampo4  = #999nCampo4 + (#103#6 / enConversor) ! EURODBMOD;
     |SINO;
         #999nCampo4  = #999nCampo4 + (((#103#6 + #103#8 + #103#10) / enConversor) ! EURODBMOD);
     |FINSI;

     |SI enEjer > 2010;
         #999#8 = #999#16 + #999#17 + #999#18 + #999#19;
     |FINSI;

     #999#9   = #709#7;
     #999#10  = #102#14;
     #999#11  = #102#12;
     #999#12  = aCliPro;
     #999#13  = #709#8;

     |GRABA 020#999a;
     |LIBERA #999;

     |SI #0#92 = "S";
         #998#0 = #999#0;
         #998#1 = #999#1;
         #998#2 = #102#0;
         #998#3 = #102#1;
         |LEE 101#998=;
         |SI FSalida ! 0;
             |DDEFECTO #998;
             #998#0  = #999#0;
             #998#1  = #999#1;
             #998#2  = #102#0;
             #998#3  = #102#1;
             #998#4  = #102#2;
             #998#5  = #102#3;
             #998#6  = #102#4;
             #998#7  = #102#10;
             #998#8  = #102#11;
             #998#9  = #103#3;
             #998#10 = #103#4;
             #998#11 = #102#22;
             |GRABA 020#998b;
         |FINSI;

         aOp1 = "N";
         |SI aClave = "A"; |Y #30#26 = 6; |Y #30#28 [ 2; |Y #30#28 ! 0;
             aOp1 = "S";
         |FINSI;
         |SI aClave = "A"; |Y #30#26 = 0; |Y #30#30 = 3;
             aOp1 = "S";
         |FINSI;
         |SI aOp1 = "S";
             #998#12  = #998#12 + (#103#6  / enConversor) ! EURODBMOD;
         |SINO;
             #998#12  = #998#12 + (#103#6  / enConversor) ! EURODBMOD;
             #998#13  = #998#13 + (#103#8  / enConversor) ! EURODBMOD;
             #998#14  = #998#14 + (#103#10 / enConversor) ! EURODBMOD;
         |FINSI;
         #998#15  = #998#13 + #998#14;
         #998#16  = #998#12 + #998#13 + #998#14;
         #998#22  = nPeriodo;
         |GRABA 020#998a;
         |LIBERA #998;
     |FINSI;
|FPRC;

|DEFBUCLE caivalin;
     #103#1;
     ;
     #102#0, #102#1, 01;
     #102#0, #102#1, 99;
     ;
     NULL, LeeLinea;
|FIN;

|PROCESO LeeCabecera;

     aCliPro = "";
     |SI #102#36 = "S"; aCliPro = "P"; |FINSI;
     |SI #102#36 = "R"; aCliPro = "C"; |FINSI;

     nSwSel = 0;
     |SI #0#85 = "S";
         |SI aCliPro = "C";
             |SI #102#12 < #0#86; |O #102#12 > #0#87; nSwSel = 1; |FINSI;
         |SINO;
             |SI #102#12 < #0#88; |O #102#12 > #0#89; nSwSel = 1; |FINSI;
         |FINSI;
         |SI #102#14 < aDNif; |O #102#14 > aHNif; nSwSel = 1; |FINSI;
     |FINSI;
     |SI nSwSel = 1; |ACABA; |FINSI;

     |SI #0#67 = "N";
         aClau = #102#14;  || Nif
     |SINO;
         aClau = #102#12;  || Cuenta Contable
     |FINSI;

     |SI nSwFecha = 1; |Y PARAMETRO ! "MODELOS";
         |SI #102#4 < fFecIni; |O #102#4 > fFecFin;
             |ACABA;
         |FINSI;
     |FINSI;

     |BUCLE caivalin;
|FPRC;

|DEFBUCLE camaniva;
     #102#1;
     12,14;
     00, 0000000000, aDCta, aDNif;
     99, 9999999999, aHCta, aHNif;
     ;
     NULL, LeeCabecera;
|FIN;

|PROCESO camaasil;
     #30#0 = #105#6;
     |LEE 000#30=;
     |SI FSalida ! 0;   |ACABA;  |FINSI;
     |SI #30#7  ! "S";  |ACABA;  |FINSI;
     |SI #30#51 = "X";  |ACABA;  |FINSI;

     aClave = "";
     #104#23 = "C";
     #104#10 = #105#4;
     |LEE 000#104=;
     |SI FSalida = 0;
         aCliPro = #104#23;
         aClave = "B";
     |SINO;
         #104#23 = "P";
         #104#10 = #105#4;
         |LEE 000#104=;
         |SI FSalida = 0;
             aCliPro = #104#23;
             aClave = "A";
         |FINSI;
     |FINSI;
     |SI aClave = "";  |ACABA;  |FINSI;

     |SI #0#95 = "S";
         |SI #0#96 ! aClave; |ACABA; |FINSI;
     |FINSI;

     nSwSel = 0;
     |SI #0#85 = "S";
         |SI aCliPro = "C";
             |SI #105#4 < #0#86; |O #105#4 > #0#87; nSwSel = 1; |FINSI;
         |SINO;
             |SI #105#4 < #0#88; |O #105#4 > #0#89; nSwSel = 1; |FINSI;
         |FINSI;
         |SI #104#9 < aDNif; |O #104#9 > aHNif; nSwSel = 1; |FINSI;
     |FINSI;
     |SI nSwSel = 1; |ACABA; |FINSI;

     |SI #0#67 = "N";
         aClau = #104#9;  || Nif
     |SINO;
         aClau = #105#4;  || Cuenta Contable
     |FINSI;

     nAny = 0;
     #110#0 = #105#0;
     #110#1 = #105#1;
     #110#2 = #105#2;
     #110#3 = #105#3;
     |LEE 001#110=;
     |SI FSalida = 0;
         nAny = #110#4;
     |FINSI;
     |SI nAny = 0;
         aAlfa1 = #105#1;
         aAlfa1 = aAlfa1 % -104;
         nAny = aAlfa1;
     |FINSI;

     #999#0 = aClau;
     #999#1 = aClave;
     |LEE 101#999=;
     |SI FSalida ! 0;
         |DDEFECTO #999;
         #999#0 = aClau;
         #999#1 = aClave;

         #999#2   = #104#1;
         eaAlfa  = #999#2; |HAZ QuitaRaros_B; #999#2 = eaAlfa;
         eaCodNif = #104#9;
         |HAZ LeeNifs;
         #999#4   = #709#9;
         aAlfa    = #709#2;  |QBF aAlfa;
         aAlfa    = aAlfa + ", " + #709#3;
         #999#5   = aAlfa;
         #999#6   = (("00" + #709#4) % -102) + (("000" + #709#5) % -103);
         #999#7   = #709#6;
         #999#9   = #709#7;
         #999#10  = #104#9;
         #999#11  = #105#4;
         #999#12  = #104#23;
         #999#13  = #709#8;
         |GRABA 020#999b;
     |FINSI;

     nCampo4 = 14;
     |SI nAny ! enEjer;
         nCampo4 = 15;
     |FINSI;
     nImporte = 0;
     |SI aClave = "B";
         |SI #105#8 = "D";
             #999nCampo4 = #999nCampo4 - #105#9;
             nImporte = - #105#9;
         |SINO;
             #999nCampo4 = #999nCampo4 + #105#9;
             nImporte = #105#9;
         |FINSI;
     |FINSI;
     |SI aClave = "A";
         |SI #105#8 = "D";
             #999nCampo4 = #999nCampo4 + #105#9;
             nImporte = #105#9;
         |SINO;
             #999nCampo4 = #999nCampo4 - #105#9;
             nImporte = - #105#9;
         |FINSI;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;

     |SI #0#92 = "S";
         nUltim = 1;
         aAlfa1 = aClave < "";
         #998#0 = #999#0;
         #998#1 = aAlfa1;
         #998#2 = #105#0;
         #998#3 = 9999999999;
         |LEE 010#998];
         |SI FSalida = 0;
             |LEE 040#998a;
         |SINO;
             |LEE 040#998u;
         |FINSI;
         |SI FSalida = 0; |Y #998#0 = #999#0; |Y #998#1 = aAlfa1; |Y #998#2 = #105#0;
             nUltim = #998#3 + 1;
         |FINSI;
         |DDEFECTO #998;
         #998#0  = #999#0;
         #998#1  = aAlfa1;
         #998#2  = #105#0;
         #998#3  = nUltim;
         #998#6  = #105#1;   ||fecha
         #998#7  = #105#21;  ||departamento
         #998#8  = #105#28;  ||subdepartamento
         #998#9  = #105#6;   ||Concepto
         #998#10 = #105#7;   ||Descripcion
         #998#11 = #105#26;  ||Referencia
         #998#12 = (nImporte  / enConversor) ! EURODBMOD;
         #998#17 = #105#0;
         #998#18 = #105#1;
         #998#19 = #105#2;
         #998#20 = #105#3;
         #998#21 = nAny;
         |GRABA 020#998n;
         |LIBERA #998;
     |FINSI;
|FPRC;

|DEFBUCLE camaasil;
     #105#1;
     4;
     01, "01.01.1900", 000001, 0001, aDCta;
     98, "31.12.2999", 999999, 9999, aHCta;
     ;
     NULL, camaasil;
|FIN;

|PROCESO FechaBonita;
     aAlfa1 = #0#64 % 102;
     aAlfa2 = #0#64 % 402;
     aAlfa3 = #0#64 % 704;

     |SI aAlfa2 = "01";  aAlfa2 = "ENERO     ";  |FINSI;
     |SI aAlfa2 = "02";  aAlfa2 = "FEBRERO   ";  |FINSI;
     |SI aAlfa2 = "03";  aAlfa2 = "MARZO     ";  |FINSI;
     |SI aAlfa2 = "04";  aAlfa2 = "ABRIL     ";  |FINSI;
     |SI aAlfa2 = "05";  aAlfa2 = "MAYO      ";  |FINSI;
     |SI aAlfa2 = "06";  aAlfa2 = "JUNIO     ";  |FINSI;
     |SI aAlfa2 = "07";  aAlfa2 = "JULIO     ";  |FINSI;
     |SI aAlfa2 = "08";  aAlfa2 = "AGOSTO    ";  |FINSI;
     |SI aAlfa2 = "09";  aAlfa2 = "SEPTIEMBRE";  |FINSI;
     |SI aAlfa2 = "10";  aAlfa2 = "OCTUBRE   ";  |FINSI;
     |SI aAlfa2 = "11";  aAlfa2 = "NOVIEMBRE ";  |FINSI;
     |SI aAlfa2 = "12";  aAlfa2 = "DICIEMBRE ";  |FINSI;

     |SI #0#68 = 2;
         aAlfa = #0#72;
     |SINO;
         aAlfa = #115#59;
     |FINSI;
     |QBF aAlfa;
     |QBF aAlfa2;
     #0#65 = aAlfa + ", a " + aAlfa1 + " de " + aAlfa2 + " de " + aAlfa3;
|FPRC;

|PROCESO Imprime;
     enSwLinea = 0;
                        enTope = 0;
     |SI #999#1 = "A";  enTope = nTopeAI;  |FINSI;
     |SI #999#1 = "B";  enTope = nTopeBI;  |FINSI;
     |SI #999#1 = "C";  enTope = nTopeCI;  |FINSI;
     |SI #999#1 = "D";  enTope = nTopeDI;  |FINSI;
     |SI #999#1 = "E";  enTope = nTopeEI;  |FINSI;

     nNegativo = #999#8;
     |SI nNegativo < 0; |Y #0#0 > 2010; nNegativo = - #999#8; |FINSI;

     |SI #999#1 = "A";  |Y nNegativo < nTopeA;
         enTope = nTopeAI;
         |ACABA;
     |FINSI;

     |SI #999#1 = "B"; |Y #0#0 ] 2012;
         #900#0 = #999#0;
         #900#1 = "X";
         |LEE 041#900=;
         |SI FSalida = 0;
             nNegativo = #999#8 + #900#8;
             |SI nNegativo < 0; |Y #0#0 > 2010; nNegativo = - nNegativo; |FINSI;
             #999#8 = #999#8 + #900#8;
         |FINSI;
     |FINSI;

     |SI #999#1 = "B";  |Y nNegativo < nTopeB;
         enTope = nTopeBI;
         |ACABA;
     |FINSI;

     |SI #999#1 = "C";  |Y nNegativo < nTopeC;
         enTope = nTopeCI;
         |ACABA;
     |FINSI;

     |SI #999#1 = "D";  |Y nNegativo < nTopeD;
         enTope = nTopeDI;
         |ACABA;
     |FINSI;

     |SI #999#1 = "E";  |Y nNegativo < nTopeE;
         enTope = nTopeEI;
         |ACABA;
     |FINSI;

     |SI #999#1 = "X"; |Y #0#0 ] 2012;
         #900#0 = #999#0;
         #900#1 = "B";
         |LEE 041#900=;
         |SI FSalida = 0;
             nNegativo = #999#8 + #900#8;
             |SI nNegativo < 0; |Y #0#0 > 2010; nNegativo = - nNegativo; |FINSI;
         |FINSI;
     |FINSI;

     |SI #999#1 = "X";  |Y nNegativo < nTopeB;
         enTope = nTopeBI;
         |ACABA;
     |FINSI;

     |HAZ FechaBonita;
     eaDescri2  = ""; |SI #999#1 = "A"; eaDescri2 = "pagos "; |FINSI;
                      |SI #999#1 = "B"; eaDescri2 = "cobros"; |FINSI;

     |SI #0#63 = "C";
         nNume1 = #999#14;
         nNume2 = #999#15;
         |SI #0#68 ! 3;
             #999#14 = #999#14 + #999#15;
             |SI #999#14 < 6000;  #999#14 = 0; |FINSI;
             #999#15 = 0;
         |FINSI;
     |FINSI;
     |SI #0#0 ] 2012; |Y #999#1 = "A"; #999#14 = 0; #999#15 = 0; |FINSI;

     |SI #0#0 < 2009;
         |SI nSwInf = 0;
             |INFOR informe;
             |SI FSalida ! 0; |ACABA; |FINSI;
             nSwInf = 1;
         |FINSI;
     |SINO;
         |SI nSwInf = 0;
             inform3 = informe;
             |SI #999#14 ! 0; |O #999#15 ! 0;
                 |SI #999#1 = "A"; |O #999#1 = "B"; inform3 = inform2; |FINSI;
             |FINSI;
             |INFOR inform3;
             |SI FSalida ! 0; |ACABA; |FINSI;
             nSwInf = 1;
        |FINSI;
     |FINSI;

     |PRINT;

     |SI #0#63 = "C";
         |PIEINF;
         |SI #0#0 ] 2009;
             |FININF;
             nSwInf = 0;
         |FINSI;
         |SI #0#92 = "S";
             |SI #0#0 < 2009; |FININF; |FINSI;
             nSwInf = 0;
             |INFOR inform1;
             |SI FSalida ! 0; |ACABA; |FINSI;
             nSwInf = 1;
         |FINSI;
         #999#14 = nNume1;
         #999#15 = nNume2;
     |FINSI;

     nSwPrint = 1;
     |SI #0#92 = "S";
         enSwLinea = 1;
         |SI enEjer [ 2010;
             |BUCLE ElDetalle;
         |SINO;
             enPerFra = -1;
             |BUCLE ElDetalle_per;
             |SI enPerFra ! -1;
                 enSwLinea = 7; |PRINT;
             |FINSI;
         |FINSI;
         |SI #999#1 = "A"; |O #999#1 = "B";
             |SI #999#14 ! 0; |O #999#15 ! 0;
                 aAlfa1 = #999#1;
                 aAlfa1 = aAlfa1 < "";
                 enSwLinea = 4; |BUCLE ElDetalle_N;
             |FINSI;
         |FINSI;
         |SI #0#63 = "C";
             |PIEINF;
             |FININF;
             nSwInf = 0;
         |SINO;
             |SI enSwLinea = 2; |O enSwLinea = 5; |O enSwLinea = 7; enSwLinea = 3; |PRINT; |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmow024;
     #999#1;
     ;
     "            ", " ";
     "zzzzzzzzzzzz", "z";
     ;
     NULL, Imprime;
|FIN;

|DEFBUCLE dsmow024_2;
     #999#2;
     ;
     aDClPr, "            ", " ";
     aHClPr, "zzzzzzzzzzzz", "z";
     ;
     NULL, Imprime;
|FIN;

|DEFBUCLE dsmow024_3;
     #999#3;
     ;
     aDClPr, aDNom, " ";
     aHClPr, aHNom, "z";
     ;
     NULL, Imprime;
|FIN;


|PROCESO Selecciona;

     enEmpresa = #115#0;
     enSwOpPar = 0;
     nSw       = 1;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         nSw = 0;
         |ABRE #101;
         |SELECT #4#101;
         #101#2  = enEmpresa;
         #101#26 = nEjer;
         |LEE 040#101=;
         |SI FSalida = 0; nSw = 1; |FINSI;
         |CIERRA #101;
     |FINSI;
     |SI nSw = 0;  |ACABA;  |FINSI;

     |ATRI S;
     |PINTA 2103, "Empresa : ";
     |PINTA 2113, #101#2;
     |PINTA 2119, #101#1;
     |ATRI s;

     |SI enSwPartido = 0;
         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";

         enPerConta = #101#3;
         eaLaMonEmp = #101#28;
     |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
     |FINSI;
     |HAZ EnConversor;

     |SI EURODBMOD ! 0;
         nTopeA     = nTopPan;  ||  3005.06;
         nTopeB     = nTopPan;  ||  3005.06;
         nTopeC     = nTopPa1;  ||  300.51;
         nTopeD     = nTopPan;  ||  3005.06;
         nTopeE     = nTopPan;  || 3005.06;
     |SINO;
         nTopeA    = nTopPan;   || 500000;
         nTopeB    = nTopPan;   || 500000;
         nTopeC    = nTopPa1;   || 50000;
         nTopeD    = nTopPa1;   || 50000;
         nTopeE    = nTopPa1;   || 50000;
     |FINSI;

     |SI #0#66 = "EUROS  ";
         eaDescri   = nTopPan; eaDescri = eaDescri + "  EUROS";
         eaDescri1  = "euros.";
         nTopeAI    = nTopPan; || 3005.06;
         nTopeBI    = nTopPan; || 3005.06;
         nTopeCI    = nTopPa1; || 300.51;
         nTopeDI    = nTopPan; || 3005.06;
         nTopeEI    = nTopPan; || 3005.06;
     |SINO;
         eaDescri  = nTopPan; eaDescri = eaDescri + "  PTAS";
         eaDescri1 = "pesetas.";
         nTopeAI   = nTopPan; || 500000;
         nTopeBI   = nTopPan; || 500000;
         nTopeCI   = nTopPa1; || 50000;
         nTopeDI   = nTopPa1; || 50000;
         nTopeEI   = nTopPa1; || 50000;
     |FINSI;

     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/dsmow024.mas";
     |CARGA_DEF aDef, espejo@;
     |SI FSalida ! 0;
         |MENAV "    Error al Carga fichero " + aDef;
         |ERROR10;
         |ACABA;
     |FINSI;

     aFichero = ("24" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #999 aFichero;
     |DELINDEX #999;
     |NOME_DAT #900 aFichero;

     aFichero = ("23" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #998 aFichero;
     |DELINDEX #998;

     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;
     |PATH_DAT #105 aPathConta;
     |PATH_DAT #106 aPathConta;
     |PATH_DAT #110 aPathConta;

     |ABRE #106;
     |DDEFECTO #106;
     |LEE 000#106p;
     |CIERRA #106;
     aMulDep = #106#132;

     |ABRE #214;
     |ABRE #999;
     |ABRE #998;
     |ABRE #30;
     |BUCLE camaniva;
     |CIERRA #214;

     |SI #0#0 ] 2009;
         |ABRE #110;
         |ABRE #104;
         |BUCLE camaasil;
         |CIERRA #104;
         |CIERRA #110;
     |FINSI;
     |CIERRA #30;
     |CIERRA #998;
     |CIERRA #999;

     |SI enSwPartido = 1;
         enSwOpPar   = 1;
         |HAZ FinalPartido;
     |FINSI;

/*
     |ABRE #115;
     #115#0 = #101#2;
     |LEE 000#115=;
     |SI FSalida ! 0;  |DDEFECTO #115;  |FINSI;
     |CIERRA #115;
*/

     #0#76 = #115#1;
     #0#77 = #115#13;
     aAlfa = #115#51;  |QBF aAlfa;
     |SI aAlfa ! "";  aAlfa = aAlfa + " ";  |FINSI;
     aAlfa = aAlfa + #115#52;  |QBF aAlfa;
     |SI #115#53 ! "    ";  aAlfa = aAlfa + ", " + #115#53;  |FINSI;
     |SI #115#55 ! "  ";    aAlfa = aAlfa + " "  + #115#55;  |FINSI;
     |SI #115#56 ! "  ";    aAlfa = aAlfa + " "  + #115#56;  |FINSI;
     #0#78 = aAlfa;
     #0#79 = (("00" + #115#57) % -102) + (("000" + #115#58) % -103);
     #0#80 = #115#59;
     #0#81 = #115#14;
     |HAZ LeeElMail;

     |SI enDatos = 1; |Y #0#63 = "I";
          eDatosW30 = 1;
          enActividad = 0;  |HAZ DatosEmpr_w30;
          eDatosW30 = 0;
     |FINSI;

     aDNom = " " * 40;
     aHNom = (&209) * 40;
     nSwPrint = 0;
     |ABRE #900;
     |SI #0#83 = 1;
         eaTit2 = "";
         |BUCLE dsmow024;
         |SI nSwPrint = 1;  |Y #0#63 = "I";  |PIEINF;  |FINSI;
     |SINO;
         nSwPrint = 0;
         aDClPr = "P"; aHClPr = "P"; eaTit2 = "PROVEEDORES Y ACREEDORES";
         |SI #0#83 = 2; |BUCLE dsmow024_2; |FINSI;
         |SI #0#83 = 3; |BUCLE dsmow024_3; |FINSI;
         |SI nSwPrint = 1;  |Y #0#63 = "I";  |PIEINF;  |FINSI;
         nSwPrint = 0;
         aDClPr = "C"; aHClPr = "C"; eaTit2 = "CLIENTES Y DEUDORES";
         |SI #0#83 = 2; |BUCLE dsmow024_2; |FINSI;
         |SI #0#83 = 3; |BUCLE dsmow024_3; |FINSI;
         |SI nSwPrint = 1;  |Y #0#63 = "I";  |PIEINF;  |FINSI;
     |FINSI;
     |CIERRA #900;

     |DELINDEX #998;
     |DELINDEX #999;

     |DESCARGA_DEF #espejo@;
|FPRC;

|DEFBUCLE canempre;  ||lee agifigen
     #115#1;
     ;
     nDEmpresa;
     nHEmpresa;
     ;
     NULL, Selecciona;
|FIN;

|| ------------------- Procesos por Modelos

|PROCESO dsmo1347;
     nHay = 1;

     |SI #347#4 = 0;
         nDComple = 0;
         nHComple = 0;
     |SINO;
         |SI #347#19 = "C";
             nHComple = #347#4;
         |SINO;
             nDComple = #347#4;
             nHComple = #347#4;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmo1347;
     #347#1;
     ;
     #115#0, #0#0, 99, 347, 00, 00;
     #115#0, #0#0, 99, 347, 99, 00;
     ;
     NULL, dsmo1347;
|FIN;

|PROCESO dsmo2347;

     |SI nSw = 0;
         nSw    = 1;
         |DDEFECTO #999;
         aClave = #348#6;
         aNif   = #348#7;
     |FINSI;

     |SI aClave ! #348#6; |O aNif ! #348#7;
         |SI nSwPrint = 1;
             |HAZ ImpCarta;
         |FINSI;
         |DDEFECTO #999;
         aClave = #348#6;
         aNif   = #348#7;
     |FINSI;

     |SI aClave ! "B";
         |DDEFECTO #999;
     |FINSI;

     #999#0  = #348#7;
     #999#1  = #348#6;
     #999#2  = #348#11;
     eaAlfa  = #999#2; |HAZ QuitaRaros_B; #999#2 = eaAlfa;

     eaCodNif = #348#7;
     |HAZ LeeNifs;

     #999#4   = #709#9;
     aAlfa    = #709#2;  |QBF aAlfa;
     aAlfa    = aAlfa + ", " + #709#3;
     #999#5   = aAlfa;
     #999#6   = (("00" + #709#4) % -102) + (("000" + #709#5) % -103);
     #999#7   = #709#6;
     #999#8   = #999#8 + #348#12;
     #999#9   = #709#7;
     #999#10  = #348#7;
     #999#11  = "";
     #999#14  = #999#14 + #348#13;
     #999#15  = #999#15 + #348#15;

     |SI #0#0 ] 2012;
         |SI #999#1 = "A"; #999#14 = 0; #999#15 = 0; |FINSI; || no a los pagos
     |FINSI;

     #999#16  = #348#16;
     #999#17  = #348#17;
     #999#18  = #348#18;
     #999#19  = #348#19;

     eaDescri1  = "euros.";
     eaDescri2  = ""; |SI #999#1 = "A"; eaDescri2 = "pagos "; |FINSI;
                      |SI #999#1 = "B"; eaDescri2 = "cobros"; |FINSI;

                        enTope = 0;
     |SI #999#1 = "A";  enTope = nTopPan; |FINSI; || 3005.06;
     |SI #999#1 = "B";  enTope = nTopPan; |FINSI; || 3005.06;
     |SI #999#1 = "C";  enTope = nTopPa1; |FINSI; ||  300.51;
     |SI #999#1 = "D";  enTope = nTopPan; |FINSI; || 3005.06;
     |SI #999#1 = "E";  enTope = nTopPan; |FINSI; || 3005.06;


     |HAZ FechaBonita;

     |SI #0#0 ] 2009;
         |SI nSwInf = 0;
             inform3 = informe;
             |SI #999#14 ! 0; |O #999#15 ! 0;
                 |SI #999#1 = "A"; |O #999#1 = "B"; inform3 = inform2; |FINSI;
             |FINSI;
             |INFOR inform3;
             |SI FSalida ! 0; |ACABA; |FINSI;
             nSwInf = 1;
         |FINSI;
     |FINSI;

     aClave = #348#6;
     aNif   = #348#7;
     nSwPrint = 1;
     |SI aClave ! "B";
         |HAZ ImpCarta;
     |FINSI;
|FPRC;

|PROCESO ImpCarta;
     nNume1 = #999#14;
     nNume2 = #999#15;
     |SI #0#68 ! 3;
         #999#14 = #999#14 + #999#15;
         #999#15 = 0;
         |SI #999#14 < 6000;  #999#14 = 0; |FINSI;
     |FINSI;

     |PRINT;
     |PIEINF;
     #999#14 = nNume1;
     #999#15 = nNume2;

     |SI #0#0 ] 2009;
         |SI nSwInf = 1;
             |FININF;
             nSwInf = 0;
         |FINSI;
     |FINSI;
     nSwPrint = 0;
|FPRC;

|DEFBUCLE dsmo2347;
     #348#1;
     ;
     #115#0, #0#0, 99, 347, nDComple, 00, aDClave, aDNif, " ", " ", " ", " ", " ";
     #115#0, #0#0, 99, 347, nHComple, 00, aHClave, aHNif, "z", "z", "z", "z", "z";
     ;
     NULL, dsmo2347;
|FIN;

|PROCESO dsmo3347;

     |SI #349#7 < aDNif; |O #349#7 > aHNif; |ACABA; |FINSI;
     |DDEFECTO #999;

     #999#0  = #349#7;
     #999#1  = "X";
     #999#2  = #349#8;
     eaAlfa  = #999#2; |HAZ QuitaRaros_B; #999#2 = eaAlfa;

     eaCodNif = #349#7;
     |HAZ LeeNifs;

     #999#4   = #709#9;
     aAlfa    = #709#2;  |QBF aAlfa;
     aAlfa    = aAlfa + ", " + #709#3;
     #999#5   = aAlfa;
     #999#6   = (("00" + #709#4) % -102) + (("000" + #709#5) % -103);
     #999#7   = #709#6;
     #999#8   = #349#10;
     #999#9   = #709#7;
     #999#10  = #349#7;
     #999#11  = "";

     eaDescri1  = "euros.";
     enTope     = 0;

     |HAZ FechaBonita;

     |PRINT;
     |PIEINF;
|FPRC;

|DEFBUCLE dsmo3347;
     #349#1;
     ;
     #115#0, #0#0, 99, 347, nDComple, 00, 01;
     #115#0, #0#0, 99, 347, nHComple, 99, 99;
     ;
     NULL, dsmo3347;
|FIN;

|PROCESO agifigen;
     nHay = 0;
     |BUCLE dsmo1347;

     |SI nHay = 0;  |ACABA;  |FINSI;

     #0#76 = #115#1;
     #0#77 = #115#13;
     aAlfa = #115#51;  |QBF aAlfa;
     |SI aAlfa ! "";  aAlfa = aAlfa + " ";  |FINSI;
     aAlfa = aAlfa + #115#52;  |QBF aAlfa;
     |SI #115#53 ! "    ";  aAlfa = aAlfa + ", " + #115#53;  |FINSI;
     |SI #115#55 ! "  ";    aAlfa = aAlfa + " "  + #115#55;  |FINSI;
     |SI #115#56 ! "  ";    aAlfa = aAlfa + " "  + #115#56;  |FINSI;
     #0#78 = aAlfa;
     #0#79 = (("00" + #115#57) % -102) + (("000" + #115#58) % -103);
     #0#80 = #115#59;
     #0#81 = #115#14;

     |HAZ LeeElMail;
     nSwPrint = 0;
     nSw      = 0;
     aClave   = "";
     aNif     = "";
     |BUCLE dsmo2347;
     |SI nSwPrint = 1;
         |HAZ ImpCarta;
     |FINSI;

     |SI #0#0 ] 2009;
         |SI nSwInf = 0;
             |INFOR informe;
             |SI FSalida ! 0; |ACABA; |FINSI;
             nSwInf = 1;
         |FINSI;
     |FINSI;

     |SI #0#95 = "N"; |O #0#96 = "B";
         |BUCLE dsmo3347;
     |FINSI;

     |SI #0#0 ] 2009;
         |SI nSwInf = 1;
             |FININF;
             nSwInf = 0;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agifigen;
     #115#1;
     ;
     nDEmpresa;
     nHEmpresa;
     ;
     NULL, agifigen;
|FIN;

|PROCESO VerIntegral;
     enSwDeDonde = 0;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         enSwDeDonde = 1;
     |FINSI;
|FPRC;

|PROCESO LeeDespacho;

     |SI enSwDeDonde = 0; |ACABA; |FINSI;

     |ABRE #dsam0001;
     |LEE 041#dsam0001.p;
     |SI FSalida = 0;
         #0#69 = #dsam0001#1;
         #0#70 = #dsam0001#2; #0#70 = "DEPARTAMENTO FISCAL";
         #0#71 = #dsam0001#3;
         #0#72 = #dsam0001#4;
         #0#73 = #dsam0001#5;
         #0#74 = #dsam0001#6;
         #0#75 = #dsam0001#7;
     |FINSI;
     |CIERRA #dsam0001;
|FPRC;

|PROCESO LeeElMail;
     eaMail = "";
     #dsmoy001#98 = "";
     |SI enSwDeDonde = 0; |ACABA; |FINSI;

     #dsam0000#0 = #agifigen#0;
     |LEE 041#dsam0000.=;
     |SI FSalida = 0;
         eaMail = #dsam0000#71;
     |FINSI;
     |QBF eaMail;
     #dsmoy001#98 = eaMail;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;

     |ABRE #7;
     |DDEFECTO #7;
     |LEE 001#7p;
     |CIERRA #7;


     aDClave = " ";          aHClave = "z";
     aDCta = "            "; aHCta = "zzzzzzzzzzzz";
     aDNif = "            "; aHNif = "zzzzzzzzzzzz";
     |SI #0#85 = "S";
         aDNif = #0#90; aHNif = #0#91;
         |SI PARAMETRO ! "MODELOS";
             aDCta = #0#86; |SI #0#88 < aDCta; aDCta = #0#88; |FINSI;
             aHCta = #0#87; |SI #0#89 > aHCta; aHCta = #0#89; |FINSI;
             aDNif = aDNif + "   ";
             |QBF aHNif; aHNif = (aHNif + "zzzzzzzzzzzzzzz") % 115;
         |FINSI;
     |FINSI;
     |SI #0#95 = "S";
         aDClave = #0#96;
         aHClave = #0#96;
     |FINSI;

     enEjer = #0#0;
     aAlfa = #0#0;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     nTopPan = #0#82;
     nTopPa1 = (#0#82 / 10 ) ! EURODBMOD;

     enDatos = 0; |SI #0#84 = "S"; enDatos = 1; |FINSI;

     |SI #0#63 = "C"; |Y #0#68 = 3;  |Y #0#93 = "347cryst";
         Impresora = "CrystalReport";
         |IMPRE -1;
         |SI #0#97 = "N";
             XVAR_DC_IMPRIME = 0;
         |SINO;
             XVAR_DC_IMPRIME = 1;
         |FINSI;
     |SINO;
         |IMPRE 0;
         XVAR_DC_IMPRIME = 0;
     |FINSI;
     |SI FSalida ! 0;
         XVAR_DC_IMPRIME = 0;
         |ACABA;
     |FINSI;

     inform1 = "dsmoy501";
     |SI #0#0 ] 2009; inform1 = "dsmoy5a1"; |FINSI;
     |SI #0#0 ] 2011; inform1 = "dsmoy5c1"; |FINSI;
     |SI #0#0 ] 2013; inform1 = "dsmoy5b1"; |FINSI;

     |SI #0#63 = "I";

         informe = "dsmoy101"; inform2 = "dsmoy1a1";
         |SI #0#0 > 2010; inform2 = "dsmoy1b1"; |FINSI;

         |SI #0#92 = "S";
             informe = "dsmoy401"; inform2 = "dsmoy4a1";
             |SI #0#0 > 2010; inform2 = "dsmoy4b1"; |FINSI;
         |FINSI;

     |SINO;

         |HAZ VerIntegral;
         |SI #0#68 = 2;
             informe = "dsmoy301"; inform2 = "dsmoy3a1";
             |HAZ LeeDespacho;
         |SINO;
             |SI #0#68 = 1;
                 informe = "dsmoy201"; inform2 = "dsmoy2a1";
             |SINO;
                 informe = #0#93; |QBF informe;
                 inform2 = #0#93;
                 |SI informe = "";
                     |MENAV "    Formato Carta mal informado";
                     |ACABA;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #0#0 < 2009;
          |SI PARAMETRO ! "MODELOS"; |Y #0#63 = "C"; |Y #0#92 = "S";
              nSwInf = 0;
          |SINO;
              nSwInf = 1;
              |INFOR informe;
              |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
          |FINSI;
     |SINO;
          |SI #0#63 = "I";
              |SI inform2 = "dsmoy1b1";
                   |MENAV "0000 Recuerde seleccionar el papel de la impresora en Horizontal";
              |FINSI;
              nSwInf = 1;
              |INFOR inform2;
              |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
          |SINO;
              nSwInf = 0;
          |FINSI;
     |FINSI;

     |SI #0#1 ! 0;
         nDEmpresa = #0#1;
         nHEmpresa = #0#2;

         |SI enSwDeDonde = 1; |ABRE #dsam0000; |FINSI;
         |SI PARAMETRO = "MODELOS";
             |BUCLE agifigen;
         |SINO;
             |BUCLE canempre;
         |FINSI;
         |SI enSwDeDonde = 1; |CIERRA #dsam0000; |FINSI;
     |SINO;
         |SI enSwDeDonde = 1; |ABRE #dsam0000; |FINSI;
         |PARA nCampo = 3;  |SI nCampo [ 27;  |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo ! 0;
                   nDEmpresa = #0nCampo;
                   nHEmpresa = #0nCampo;
                   |SI PARAMETRO = "MODELOS";
                       |BUCLE agifigen;
                   |SINO;
                       |BUCLE canempre;
                   |FINSI;
               |FINSI;
         |SIGUE;
         |SI enSwDeDonde = 1; |CIERRA #dsam0000; |FINSI;
     |FINSI;

     |SI nSwInf = 1;
         |FININF;
         nSwInf = 0;
     |FINSI;
     |FINIMP;
     XVAR_DC_IMPRIME = 0;
|FPRC;

|PROGRAMA;

    |ABRE #0;
    |LEE 041#0p;
    |SI FSalida ! 0;
        |DDEFECTO #0;
        |GRABA 020#0c;
    |FINSI;
    aFormato = #0#93;

    |CLS;
    |DDEFECTO #0;
    #0#93 = aFormato;
    |PINPA #0#0;
    |SI enEmpresa ! 0;
        #0#1 = enEmpresa; |C_M #0#1, 1, "N";
        #0#2 = enEmpresa; |C_M #0#2, 1, "N";
    |FINSI;

    |PINDA #0#0;
    |ENDATOS #1#0;
    |SI FSalida = 0;
        |GRABA 020#0a;
    |FINSI;
    |LIBERA #0;
    |CIERRA #0;
|FPRO;
