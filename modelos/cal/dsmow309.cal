|FICHEROS;
   dsmow309;
|FIN;

|VARIABLES;
   &efFechaDev = @;
   &nTr210tr   = 0;

   nCalc = 0;
   nCalc1 = 0;
   nCalc2 = 0;
   nCalc3 = 0;
   nCalc4 = 0;
   nCalc5 = 0;
   nDias  = 0;

   fFecha = @;
|FIN;

|PROCESO MiraTipo;
|FPRC;

|PROCESO Calculo309Adquis;

   #dsmow309#9  = #dsmow309#5 - #dsmow309#7; |PINTA #dsmow309#9;

   || Calculamos la reduccion de la diferencia en la adquisicion y lo ponemos en ganancia
   nCalc = 0;
   |SI #dsmow309#14 ] "31.12.1993"; |Y #dsmow309#14 [ "30.12.1994"; nCalc = 11.11; |FINSI;
   |SI #dsmow309#14 ] "31.12.1992"; |Y #dsmow309#14 [ "30.12.1993"; nCalc = 22.22; |FINSI;
   |SI #dsmow309#14 ] "31.12.1991"; |Y #dsmow309#14 [ "30.12.1992"; nCalc = 33.33; |FINSI;
   |SI #dsmow309#14 ] "31.12.1990"; |Y #dsmow309#14 [ "30.12.1991"; nCalc = 44.44; |FINSI;
   |SI #dsmow309#14 ] "31.12.1989"; |Y #dsmow309#14 [ "30.12.1990"; nCalc = 55.55; |FINSI;
   |SI #dsmow309#14 ] "31.12.1988"; |Y #dsmow309#14 [ "30.12.1989"; nCalc = 66.66; |FINSI;
   |SI #dsmow309#14 ] "31.12.1987"; |Y #dsmow309#14 [ "30.12.1988"; nCalc = 77.77; |FINSI;
   |SI #dsmow309#14 ] "31.12.1986"; |Y #dsmow309#14 [ "30.12.1987"; nCalc = 88.88; |FINSI;
   |SI #dsmow309#14 [ "30.12.1986"; nCalc = 100; |FINSI;

   fFecha = #dsmow309#14; nCalc1 = fFecha;
   fFecha = efFechaDev;   nCalc2 = fFecha;
   nDias  = nCalc2 - nCalc1;
   fFecha = "19.01.2006"; nCalc3 = fFecha;
   nCalc3 = nCalc3 - nCalc1;
   nDias  = nCalc3 / nDias;

/*
   nCalc2 = ((#dsmow309#9 * nDias) * (nCalc/100)) ! 2;
*/

   nCalc2 = (#dsmow309#9 * nDias) ! 3;

   nCalc4 = ((400000- #dsmow309#17) / #dsmow309#5) ! 5;
   |SI nCalc4 > 1; nCalc4 = 1; |FINSI;

   nCalc2 = nCalc2 * nCalc4;

   nCalc2 = (nCalc2 * (nCalc/100)) ! 2;

   #dsmow309#11 = #dsmow309#9 - nCalc2;
   |SI #dsmow309#9 < 0; #dsmow309#11 = 0; |FINSI;
   |PINTA #dsmow309#11;

   #dsmow309#13 = #dsmow309#11 + #dsmow309#12; |PINTA #dsmow309#13;
   |SI #dsmow309#13 < 0; #dsmow309#13 = 0; |PINTA #dsmow309#13; |FINSI;
|FPRC;

|PROCESO Calculo309Mejora;

   #dsmow309#10 = #dsmow309#6 - #dsmow309#8; |PINTA #dsmow309#10;

   || Calculamos la reduccion de la diferencia en la mejora y lo ponemos en ganancia
   nCalc = 0;
   |SI #dsmow309#15 ] "31.12.1993"; |Y #dsmow309#15 [ "30.12.1994"; nCalc = 11.11; |FINSI;
   |SI #dsmow309#15 ] "31.12.1992"; |Y #dsmow309#15 [ "30.12.1993"; nCalc = 22.22; |FINSI;
   |SI #dsmow309#15 ] "31.12.1991"; |Y #dsmow309#15 [ "30.12.1992"; nCalc = 33.33; |FINSI;
   |SI #dsmow309#15 ] "31.12.1990"; |Y #dsmow309#15 [ "30.12.1991"; nCalc = 44.44; |FINSI;
   |SI #dsmow309#15 ] "31.12.1989"; |Y #dsmow309#15 [ "30.12.1990"; nCalc = 55.55; |FINSI;
   |SI #dsmow309#15 ] "31.12.1988"; |Y #dsmow309#15 [ "30.12.1989"; nCalc = 66.66; |FINSI;
   |SI #dsmow309#15 ] "31.12.1987"; |Y #dsmow309#15 [ "30.12.1988"; nCalc = 77.77; |FINSI;
   |SI #dsmow309#15 ] "31.12.1986"; |Y #dsmow309#15 [ "30.12.1987"; nCalc = 88.88; |FINSI;
   |SI #dsmow309#15 [ "30.12.1986"; nCalc = 100; |FINSI;

   || Calculo el n§ de dias al que aplicar la reduccion, ya que se aplica solo
   ||    hasta el 20 de Enero de 2006

   fFecha = #dsmow309#15; nCalc1 = fFecha;
   fFecha = efFechaDev;   nCalc2 = fFecha;
   nDias  = nCalc2 - nCalc1;
   fFecha = "19.01.2006"; nCalc3 = fFecha;
   nCalc3 = nCalc3 - nCalc1;
   nDias  = nCalc3 / nDias;

/*
   nCalc2 = ((#dsmow309#10 * nDias) * (nCalc/100)) ! 2;
*/

   nCalc2 = (#dsmow309#10 * nDias) ! 3;

   nCalc5 = #dsmow309#17 + #dsmow309#5;
   |SI nCalc5 > 400000; nCalc5 = 400000; |FINSI;
   nCalc4 = ( (400000 - nCalc5 ) / #dsmow309#6) ! 5;
   |SI nCalc4 > 1; nCalc4 = 1; |FINSI;

   nCalc2 = nCalc2 * nCalc4;

   nCalc2 = (nCalc2 * (nCalc/100)) ! 2;

   #dsmow309#12 = #dsmow309#10 - nCalc2;
   |SI #dsmow309#10 < 0; #dsmow309#12 = 0; |FINSI;
   |PINTA #dsmow309#12;

   #dsmow309#13 = #dsmow309#11 + #dsmow309#12; |PINTA #dsmow309#13;
   |SI #dsmow309#13 < 0; #dsmow309#13 = 0; |PINTA #dsmow309#13; |FINSI;
|FPRC;

|PROCESO AntAdq; |TIPO 7;
   |SI nTr210tr = 33; |O nTr210tr = 34;
       |MENSA "0000Ganancia calculada sin exencion por reinversion. Introduzca la ganancia redicida";
   |FINSI;
|FPRC;

|PROCESO DesAdq; |TIPO 0;
   |BLIN 4;
|FPRC;
