|FICHEROS;
     dsmoc349 #0;
     dsmom002 #2;
     dsmom003 #3;
     dsmom004 #4;
     dsmom005 #5;
     dsmom006 #6;
     dsmom008 #8;
     dsmom095 #95;
     dsmod349 #349;

     :/basica/def/agitab99;

     dsmow002 #99;

     &regisnif@ #709;
     reflejo@   #20;
|FIN;

|VARIABLES;
     aAlfa1      = "";
     aDTipo      = "";
     aHTipo      = "";
     aConfi      = "";
     aPathModelo = "";
     aDef        = "";
     aAlfa       = "";
     aDT         = "";
     aHT         = "zz";
     aDN         = "";
     aHN         = "zzzzzzzzzzzz";

     nOk         = 0;
     nOpera      = 0;
     nError      = 0;
     nPer        = 0;
     nPer349     = 0;
     nPerTrab    = 0;
     nCampo1     = 0;
     nCampo11    = 0;
     nCampo2     = 0;
     nCampo22    = 0;
     nCampo3     = 0;
     nCampo33    = 0;
     nDPeriodo   = 0;
     nHPeriodo   = 0;
     nDPeriodoV  = 0;
     nHPeriodoV  = 0;
     nSwGraba    = 0;
     nMod        = 0;
     nDComple    = 0;
     nHComple    = 0;
     nGraboEl2   = 0;
     nPeriodo    = 0;
     nActiv      = 0;
     nPasada     = 0;
     nSuma       = 0;
     nActi       = 0;
     nGuardaPer  = 0;
     nCampo      = 0;
 {-1} aMenu       = "";
      aMenu1      = "1260";
      aMenu2      = "1";
      aMenu3      = "3";
      aMenu4      = "TRIMESTRAL";
      aMenu5      = "ANUAL     ";
      aMenu6      = "MENSUAL";
      &enEmpresaA = 0;
      &enAnyo     = 0;
      nSim006     = 0;

      fFecha1     = @;
      fFecha2     = @;
      nNoExiste   = 0;
      nNume1      = 0;
      aFichero    = "";
|FIN;

|INCLUYE i_variar;

|| /////////////////// Procesos del Programa por Pantalla \\\\\\\\\\\\\\\\\\

|PROCESO Periodo;
     |SI enEjer [ 2009;
         |SI enModelo349 = 300;  |O enModelo349 = 310; |O enModelo349 = 309;
             |SI #0#2 ! enPeriodo;
                 |MENAV "     Periodo Incorrecto.";
                 |ERROR;
             |FINSI;
         |SINO;
             |SI #0#2 < nDPeriodoV;  |O #0#2 > nHPeriodoV;
                 |MENAV "     Periodo Incorrecto.";
                 |ERROR;
             |FINSI;
         |FINSI;
     |SINO;
         |SI #0#2 < nDPeriodoV;  |O #0#2 > nHPeriodoV;
             |MENAV "     Periodo incorrecto.";
             |ERROR;
             |ACABA;
         |FINSI;

         |SI #95#2 ! "A";
             |SI #95#2 = "M";
                 nPer349 = nHPeriodoV;
             |FINSI;

             |SI #95#2 = "T";
                 |SI #0#2 = 1;   nPer349 = 3;  |FINSI;
                 |SI #0#2 = 2;   nPer349 = 3;  |FINSI;
                 |SI #0#2 = 3;   nPer349 = 3;  |FINSI;
                 |SI #0#2 = 4;   nPer349 = 6;  |FINSI;
                 |SI #0#2 = 5;   nPer349 = 6;  |FINSI;
                 |SI #0#2 = 6;   nPer349 = 6;  |FINSI;
                 |SI #0#2 = 7;   nPer349 = 9;  |FINSI;
                 |SI #0#2 = 8;   nPer349 = 9;  |FINSI;
                 |SI #0#2 = 9;   nPer349 = 9;  |FINSI;
                 |SI #0#2 = 10;  nPer349 = 12; |FINSI;
                 |SI #0#2 = 11;  nPer349 = 12; |FINSI;
                 |SI #0#2 = 12;  nPer349 = 12; |FINSI;
             |FINSI;

             |ABRE #4;
             #4#0 = #0#0;
             #4#1 = #0#1;
             #4#2 = nPer349;
             #4#3 = 349;
             #4#4 = enComplem;
             |LEE 040#4=;
             |SI FSalida ! 0;
                 |MENAV "0000Periodo incorrecto.";
                 |ERROR;
             |FINSI;
             |CIERRA #4;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo11C26;  |TIPO 11;
     |SI FSalida = 10;
         |PUSHV 0501 2380;
         |BLANCO 0715 2147;
         |CUADRO 0715 2147;

         |PINTA 0816, "00.- Anual";
         |PINTA 0916, "                               ";
         |PINTA 1016, "01.- Primer  Trimestre         ";
         |PINTA 1116, "02.- Segundo Trimestre         ";
         |PINTA 1216, "03.- Tercero Trimestre         ";
         |PINTA 1316, "04.- Cuarto  Trimestre         ";
         |PINTA 1416, "                               ";
         |PINTA 1516, "11.- Enero      17.- Julio     ";
         |PINTA 1616, "12.- Febrero    18.- Agosto    ";
         |PINTA 1716, "13.- Marzo      19.- Septiembre";
         |PINTA 1816, "14.- Abril      20.- Octubre   ";
         |PINTA 1916, "15.- Mayo       21.- Noviembre ";
         |PINTA 2016, "16.- Junio      22.- Diciembre ";

         |PAUSA;
         |POPV;

         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Tipo0C26;  |TIPO 0;
     |SI #0#26 = 0;  |Y #0#25 [ 2019; |ACABA;  |FINSI;
     |SI #0#26 = 1;   |ACABA;  |FINSI;
     |SI #0#26 = 2;   |ACABA;  |FINSI;
     |SI #0#26 = 3;   |ACABA;  |FINSI;
     |SI #0#26 = 4;   |ACABA;  |FINSI;
     |SI #0#26 = 11;  |ACABA;  |FINSI;
     |SI #0#26 = 12;  |ACABA;  |FINSI;
     |SI #0#26 = 13;  |ACABA;  |FINSI;
     |SI #0#26 = 14;  |ACABA;  |FINSI;
     |SI #0#26 = 15;  |ACABA;  |FINSI;
     |SI #0#26 = 16;  |ACABA;  |FINSI;
     |SI #0#26 = 17;  |ACABA;  |FINSI;
     |SI #0#26 = 18;  |ACABA;  |FINSI;
     |SI #0#26 = 19;  |ACABA;  |FINSI;
     |SI #0#26 = 20;  |ACABA;  |FINSI;
     |SI #0#26 = 21;  |ACABA;  |FINSI;
     |SI #0#26 = 22;  |ACABA;  |FINSI;

     |MENAV "0000Periodo incorrecto.";
     |ERROR;
|FPRC;

|PROCESO Tipo11C6;  |TIPO 11;
     |SI FSalida = 10;
         |PUSHV 0501 2380;
         |SI #0#1 < 2018;
             |BLANCO 0710 2075;
             |CUADRO 0710 2075;

             |PINTA 0811, "A .- Adquisiciones";
             |PINTA 0911, "AR.- Rectificaciones adquisiciones";
             |PINTA 1011, "E .- Entregas";
             |PINTA 1111, "ER.- Rectificaciones entregas";
             |PINTA 1211, "S .- Prestaciones";
             |PINTA 1311, "SR.- Rectificaciones Prestaciones";
             |PINTA 1411, "I .- Adquisiciones en el territorio del impuesto";
             |PINTA 1511, "IR.- Rectificaciones adquisiciones en el territorio del impuesto";
             |PINTA 1611, "M .- Entregas posteriores a importacion exenta";
             |PINTA 1711, "MR.- Rectificaciones entregas posteriores a importacion exenta  ";
             |PINTA 1811, "H .- Entregas posteriores importacion exenta con representante  ";
             |PINTA 1911, "HR.- Rectificaciones ent.posteriores importacion exenta con rep.";
         |FINSI;

         |SI #0#1 ] 2018; |Y #0#1 [ 2019;
             |BLANCO 0610 2175;
             |CUADRO 0610 2175;

             |PINTA 0711, "A .- Adquisiciones";
             |PINTA 0811, "AR.- Rectificaciones adquisiciones";
             |PINTA 0911, "E .- Entregas";
             |PINTA 1011, "ER.- Rectificaciones entregas";
             |PINTA 1111, "S .- Prestaciones";
             |PINTA 1211, "SR.- Rectificaciones Prestaciones";
             |PINTA 1311, "I .- Adquisiciones en el territorio del impuesto";
             |PINTA 1411, "IR.- Rectificaciones adquisiciones en el territorio del impuesto";
             |PINTA 1511, "M .- Entregas posteriores a importacion exenta";
             |PINTA 1611, "MR.- Rectificaciones entregas posteriores a importacion exenta  ";
             |PINTA 1711, "H .- Entregas posteriores importacion exenta con representante  ";
             |PINTA 1811, "HR.- Rectificaciones ent.posteriores importacion exenta con rep.";
             |PINTA 1911, "T .- Entregas en el marco de operaciones triangulares  ";
             |PINTA 2011, "TR.- Rectificaciones Entregas en el marco de oper.triangulares  ";
         |FINSI;

         |SI #0#1 ] 2020;
             |BLANCO 0808 1979;
             |CUADRO 0808 1979;

             |PINTA 0909, " A- Adquisiciones                             AR- Rectificaciones (A) ";
             |PINTA 1009, " E- Entregas                                  ER- Rectificaciones (E) ";
             |PINTA 1109, " S- Prestaciones                              SR- Rectificaciones (S) ";
             |PINTA 1209, " I- Adquisiciones en territorio impuesto      IR- Rectificaciones (I) ";
             |PINTA 1309, " M- Entregas post. importacion exenta         MR- Rectificaciones (M) ";
             |PINTA 1409, " H- Entregas post.im.exenta con representante HR- Rectificaciones (H) ";
             |PINTA 1509, " T- Entregas en operaciones triangulares      TR- Rectificaciones (T) ";
             |PINTA 1609, " R- Transferencias de bienes de consigna      RR- Rectificaciones (R) ";
             |PINTA 1709, " D- Devoluciones de bienes de consigna        DR- Rectificaciones (D) ";
             |PINTA 1809, " C- Sustitucion destinatario bienes consigna  CR- Rectificaciones (C) ";
             |ATRI I;
             |PINTA 0910, "A"; |PINTA 0955, "AR";
             |PINTA 1010, "E"; |PINTA 1055, "ER";
             |PINTA 1110, "S"; |PINTA 1155, "SR";
             |PINTA 1210, "I"; |PINTA 1255, "IR";
             |PINTA 1310, "M"; |PINTA 1355, "MR";
             |PINTA 1410, "H"; |PINTA 1455, "HR";
             |PINTA 1510, "T"; |PINTA 1555, "TR";
             |PINTA 1610, "R"; |PINTA 1655, "RR";
             |PINTA 1710, "D"; |PINTA 1755, "DR";
             |PINTA 1810, "C"; |PINTA 1855, "CR";
             |ATRI 0;
        |FINSI;

         |PAUSA;
         |POPV;

         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Tipo0C6;  |TIPO 0;
     nOk = 0;
     |SI #0#6 ! "A ";  |Y #0#6 ! "AR";
      |Y #0#6 ! "E ";  |Y #0#6 ! "ER";
      |Y #0#6 ! "S ";  |Y #0#6 ! "SR";
      |Y #0#6 ! "I ";  |Y #0#6 ! "IR";
      |Y #0#6 ! "M ";  |Y #0#6 ! "MR";
      |Y #0#6 ! "H ";  |Y #0#6 ! "HR";
      |Y #0#6 ! "T ";  |Y #0#6 ! "TR";
      |Y #0#6 ! "R ";  |Y #0#6 ! "RR";
      |Y #0#6 ! "D ";  |Y #0#6 ! "DR";
      |Y #0#6 ! "C ";  |Y #0#6 ! "CR";
         nOk = 1;
     |FINSI;
     |SI #0#6 = "T "; |O #0#6 = "TR";
         |SI #0#1 < 2018; nOk = 1; |FINSI;
     |FINSI;
     |SI #0#6 = "R "; |O #0#6 = "RR";
      |O #0#6 = "D "; |O #0#6 = "DR";
      |O #0#6 = "C "; |O #0#6 = "CR";
         |SI #0#1 < 2020; nOk = 1; |FINSI;
     |FINSI;

     |SI nOk = 1;
         |MENAV "0000Tipo erroneo. Pulse F2 para ver la ayuda.";
         |ERROR;
         |ACABA;
     |FINSI;

     |HAZ Modificas;

     |SI eaTipo349 = "";  |ACABA;  |FINSI;

     |SI eaTipo349 = "A";
         |SI enEjer ] 2015;
             |SI #0#6 ! "A ";
                 |MENAV "      Introduzca solo claves A";
                 |ERROR;
             |FINSI;
         |SINO;
             |SI #0#6 ! "A ";  |Y #0#6 ! "AR";
                 |MENAV "      Introduzca solo claves A o AR";
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI eaTipo349 = "AR"; |Y enEjer ] 2015;
         |SI #0#6 ! "AR";
             |MENAV "      Introduzca solo claves AR";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI eaTipo349 = "IR"; |Y enEjer ] 2015;
         |SI #0#6 ! "IR";
             |MENAV "      Introduzca solo claves IR";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI eaTipo349 = "I";
         |SI enEjer ] 2015;
             |SI #0#6 ! "I ";
                 |MENAV "      Introduzca solo claves I";
                 |ERROR;
             |FINSI;
         |SINO;
             |SI #0#6 ! "I ";  |Y #0#6 ! "IR";
                 |MENAV "      Introduzca solo claves I o IR";
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI eaTipo349 = "E";
         |SI enTipoEntrada = 14;
             |SI #0#6 ! "E ";  |Y #0#6 ! "ER";
               |Y #0#6 ! "H ";  |Y #0#6 ! "HR";
               |Y #0#6 ! "M ";  |Y #0#6 ! "MR";
               |Y #0#6 ! "T ";  |Y #0#6 ! "TR";
                 |MENAV "      Introduzca solo claves E, H, M, T o ER, HR, MR, TR";
                 |ERROR;
             |FINSI;
         |SINO;
             |SI #0#6 ! "E ";  |Y #0#6 ! "ER";
                 |MENAV "      Introduzca solo claves E o ER";
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI eaTipo349 = "S";
         |SI #0#6 ! "S ";  |Y #0#6 ! "SR";
             |MENAV "      Introduzca solo claves S o SR";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI eaTipo349 = "M";
         |SI #0#6 ! "M ";  |Y #0#6 ! "MR";
             |MENAV "      Introduzca solo claves M o MR";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI enEjer ] 2018; |Y eaTipo349 = "T";
         |SI #0#6 ! "T ";  |Y #0#6 ! "TR";
             |MENAV "      Introduzca solo claves M o MR";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI enEjer ] 2020; |Y eaTipo349 = "R";
         |SI #0#6 ! "R ";  |Y #0#6 ! "RR";
             |MENAV "      Introduzca solo claves R o RR";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI enEjer ] 2020; |Y eaTipo349 = "D";
         |SI #0#6 ! "D ";  |Y #0#6 ! "DR";
             |MENAV "      Introduzca solo claves D o DR";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI enEjer ] 2020; |Y eaTipo349 = "C";
         |SI #0#6 ! "C ";  |Y #0#6 ! "CR";
             |MENAV "      Introduzca solo claves C o CR";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI eaTipo349 = "H";
         |SI #0#6 ! "H ";  |Y #0#6 ! "HR";
             |MENAV "      Introduzca solo claves H o HR";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|RUTINA ClaveBaja20;
     #20#0 = enEmpresa;
     #20#1 = enEjer;
     #20#2 = nDPeriodoV;
     #20#3 = 349;
     #20#4 = enComplem;
     #20#5 = enActividad;
     #20#6 = aDTipo;
     #20#9 = "";
|FRUT;

|RUTINA ClaveAlta20;
     #20#0 = enEmpresa;
     #20#1 = enEjer;
     #20#2 = nHPeriodoV;
     #20#3 = 349;
     #20#4 = enComplem;
     #20#5 = enActividad;
     #20#6 = aHTipo;
     #20#9 = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
|FRUT;

|PROCESO Dnimoc349;  |TIPO 11;
     |SI FSalida = 10;
         eaVarDni  = #0Campo;
         enCalcCif = 1;
         |HAZ CalculameDNI;
         #0Campo = eaVarDni;
         |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO MiraDnimoc349;  |TIPO 6;
     |C_M #0Campo, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculameDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #0Campo ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO AntesPer; |TIPO 7;
  aAlfa1 = "    Pulse <F2> Consulta Ordenado por Nombre";
  |SI enTipoEntrada = 4;
      |SI #0#6 = "AR"; |O #0#6 = "ER";
       |O #0#6 = "SR"; |O #0#6 = "IR";
       |O #0#6 = "MR"; |O #0#6 = "HR";
       |O #0#6 = "TR"; |O #0#6 = "RR";
       |O #0#6 = "DR"; |O #0#6 = "CR";
          aAlfa1 = "    <F2> Consulta Ord. Nombre. <F3> Introducir Ejer./Per. Rectificacion";
       |FINSI;
  |FINSI;
  |MENSA aAlfa1;

  |SI #0#4 ! 0;
      aAlfa = ((" " * 80) + ("COMPLEMENTARIA: "  + #0#4) + "   ") % -180;
  |SINO;
      aAlfa = (" " * 80) % -180;
  |FINSI;

  |ATRI S;
  |PINTA 0601, aAlfa;
  |ATRI s;
|FPRC;

|PROCESO AntesBlanco; |TIPO 7;
  |BLIN 4;
|FPRC;

|PROCESO OrdenaNombre;  |TIPO 11;
     |SI FSalida = 10;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc349.mas";
         |CARGA_DEF aDef, reflejo@;
         |SI FSalida ! 0;
             aAlfa = "     Error en cargar el Def dsmoc349.mas";
             |MENAV aAlfa;
             |ERROR;
         |FINSI;

         |PUSHV 0501 2380;
         |ATRI P;
         |PINTA 0703, "MODO CONSULTA  <ORDENADO POR NOMBRE>";
         |ATRI p;

         |ENTLINEAL #2#20, -8, 4, 22, 0, ClaveBaja20, ClaveAlta20;
         |POPV;

         |DESCARGA_DEF #reflejo@;

         |ERROR;
     |SINO;
         |SI FSalida = 11;
             |SI enTipoEntrada = 4;
                 |SI #0#6 = "AR"; |O #0#6 = "ER";
                  |O #0#6 = "SR"; |O #0#6 = "IR";
                  |O #0#6 = "MR"; |O #0#6 = "HR";
                  |O #0#6 = "TR"; |O #0#6 = "RR";
                  |O #0#6 = "DR"; |O #0#6 = "CR";
                     |LEE 101#0=;
                     |SI FSalida = 0;
                         |BORRA 020#0a;
                         |ENCAMPO #24#0;
                         |ENCAMPO #25#0;
                         |ENCAMPO #26#0;
                         |GRABA 020#0n;
                         |LIBERA #0;
                     |FINSI;
                     |ERROR;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Modificas;
     |C_M #0#22, 1, "S";
     |C_M #0#23, 1, "S";
     |C_M #0#24, 1, "S";
     |C_M #0#25, 1, "S";
     |C_M #0#26, 1, "S";

     |SI #0#6 = "A ";
         |C_M #0#22, 1, "N";
         |C_M #0#23, 1, "N";  #0#23 = "";  |PINTA #0#23;
         |C_M #0#24, 1, "N";  #0#24 = "";  |PINTA #0#24;
         |C_M #0#25, 1, "N";  #0#25 = 0;   |PINTA #0#25;
         |C_M #0#26, 1, "N";  #0#26 = 0;   |PINTA #0#26;
     |FINSI;

     |SI #0#6 = "AR";
         |C_M #0#22, 1, "N";
         |C_M #0#23, 1, "N";  #0#23 = "";  |PINTA #0#23;
     |FINSI;

     |SI #0#6 = "I ";
         |C_M #0#22, 1, "N";
         |C_M #0#23, 1, "N";  #0#23 = "";  |PINTA #0#23;
         |C_M #0#24, 1, "N";  #0#24 = "";  |PINTA #0#24;
         |C_M #0#25, 1, "N";  #0#25 = 0;   |PINTA #0#25;
         |C_M #0#26, 1, "N";  #0#26 = 0;   |PINTA #0#26;
     |FINSI;

     |SI #0#6 = "IR";
         |C_M #0#22, 1, "N";
         |C_M #0#23, 1, "N";  #0#23 = "";  |PINTA #0#23;
     |FINSI;

     |SI #0#6 = "E "; |O #0#6 = "M "; |O #0#6 = "H "; |O #0#6 = "T ";
                      |O #0#6 = "R "; |O #0#6 = "C "; |O #0#6 = "D ";
         |C_M #0#24, 1, "N";  #0#24 = "";  |PINTA #0#24;
         |C_M #0#25, 1, "N";  #0#25 = 0;   |PINTA #0#25;
         |C_M #0#26, 1, "N";  #0#26 = 0;   |PINTA #0#26;
     |FINSI;

     |SI #0#6 = "S ";
         |C_M #0#23, 1, "N";  #0#23 = "";  |PINTA #0#23;
         |C_M #0#24, 1, "N";  #0#24 = "";  |PINTA #0#24;
         |C_M #0#25, 1, "N";  #0#25 = 0;   |PINTA #0#25;
         |C_M #0#26, 1, "N";  #0#26 = 0;   |PINTA #0#26;
     |FINSI;

     |SI #0#6 = "SR";
         |C_M #0#23, 1, "N";  #0#23 = "";  |PINTA #0#23;
     |FINSI;

     |SI enEjer ] 2018;
         |C_M #0#23, 1, "N";
         #0#23 = "";
         |SI #0#6 = "T "; |O #0#6 = "TR"; #0#23 = "X"; |FINSI;
         |PINTA #0#23;
     |FINSI;
|FPRC;

|PROCESO PonDatosNif;  |TIPO 7;
     |C_M #0Campo, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     nCampo = 7; |SI Campo = 59; nCampo = 58; |FINSI;
     eaCodNif  = #0nCampo;
     |HAZ LeeNifs;

     |SI #709#12 !  "   ";
         #0Campo  = #709#12;  |PINTA #0Campo;
     |FINSI;
     nCampo   = nCampo + 2;
     #0nCampo = #709#1;       |PINTA #0nCampo;
|FPRC;

|PROCESO FiltroPais;
     |C_M #0Campo, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     |SI #0Campo = "DE ";  |ACABA;  |FINSI;
     |SI #0Campo = "AT ";  |ACABA;  |FINSI;
     |SI #0Campo = "BE ";  |ACABA;  |FINSI;
     |SI #0Campo = "BG ";  |ACABA;  |FINSI;
     |SI #0Campo = "CY ";  |ACABA;  |FINSI;
     |SI #0Campo = "DK ";  |ACABA;  |FINSI;
     |SI #0Campo = "SI ";  |ACABA;  |FINSI;
     |SI #0Campo = "EE ";  |ACABA;  |FINSI;
     |SI #0Campo = "FI ";  |ACABA;  |FINSI;
     |SI #0Campo = "FR ";  |ACABA;  |FINSI;
     |SI #0Campo = "EL ";  |ACABA;  |FINSI;
     |SI #0Campo = "GB ";  |ACABA;  |FINSI;
     |SI #0Campo = "NL ";  |ACABA;  |FINSI;
     |SI #0Campo = "HU ";  |ACABA;  |FINSI;
     |SI #0Campo = "IT ";  |ACABA;  |FINSI;
     |SI #0Campo = "IE ";  |ACABA;  |FINSI;
     |SI #0Campo = "LV ";  |ACABA;  |FINSI;
     |SI #0Campo = "LT ";  |ACABA;  |FINSI;
     |SI #0Campo = "LU ";  |ACABA;  |FINSI;
     |SI #0Campo = "MT ";  |ACABA;  |FINSI;
     |SI #0Campo = "PL ";  |ACABA;  |FINSI;
     |SI #0Campo = "PT ";  |ACABA;  |FINSI;
     |SI #0Campo = "CZ ";  |ACABA;  |FINSI;
     |SI #0Campo = "SK ";  |ACABA;  |FINSI;
     |SI #0Campo = "RO ";  |ACABA;  |FINSI;
     |SI #0Campo = "SE ";  |ACABA;  |FINSI;
     |SI #0Campo = "GR ";  |ACABA;  |FINSI;
     |SI #0Campo = "HR ";  |ACABA;  |FINSI;

     |MENAV "     Codigo de Pais incorrecto. ";
     |ERROR;
|FPRC;

|PROCESO Importe;
     |SI #0#6 ! "A ";  |Y #0#6 ! "AR";
     |Y  #0#6 ! "I ";  |Y #0#6 ! "IR";
         |ACABA;
     |FINSI;

     #99#0 = "Introducir BASES E IVAS";
     |PARA nCampo1 = 10;  |SI nCampo1 [ 21;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 - 6;
           #99nCampo2 = #0nCampo1;
     |SIGUE;

     |PARA nCampo1 = 28;  |SI nCampo1 [ 36;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 - 12;
           #99nCampo2 = #0nCampo1;
     |SIGUE;

     |PUSHV 0501 2380;
     |PINPA #0#99;
     |PINDA #0#99;
     |ENDATOS #1#99;
     |SI FSalida = 0;
         |PARA nCampo1 = 10;  |SI nCampo1 [ 21;  |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2 = nCampo1 - 6;
               #0nCampo1 = #99nCampo2;
         |SIGUE;
         |PARA nCampo1 = 28;  |SI nCampo1 [ 36;  |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2 = nCampo1 - 12;
               #0nCampo1 = #99nCampo2;
         |SIGUE;
     |FINSI;

     |POPV;

     #0#22 = #0#10 + #0#13 + #0#16 + #0#19 + #0#28 + #0#31 + #0#34;
     |PINTA #0#22;
|FPRC;

|PROCESO ImporteAnterior;
     |SI #0#6 ! "AR";  |Y #0#6 ! "ER";
      |Y #0#6 ! "IR";  |Y #0#6 ! "SR";
      |Y #0#6 ! "MR";  |Y #0#6 ! "HR";
      |Y #0#6 ! "TR";  |Y #0#6 ! "RR";
      |Y #0#6 ! "CR";  |Y #0#6 ! "DR";
         |ACABA;
     |FINSI;

     |SI #0#6 = "AR";  |O  #0#6 = "IR";
         nSuma = #0#37 + #0#40 + #0#43 + #0#46 + #0#49 + #0#52 + #0#55;
         |SI #0#27 ! 0;   |Y nSuma = 0;
             #0#27 = nSuma;
         |FINSI;

         #99#0 = "Introducir BASES E IVAS DECL.ANTERIOR";

         |PARA nCampo1 = 37;  |SI nCampo1 [ 57;  |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2 = nCampo1 - 33;
               #99nCampo2 = #0nCampo1;
         |SIGUE;

         |PUSHV 0501 2380;
         |PINPA #0#99;
         |PINDA #0#99;
         |ENDATOS #1#99;
         |SI FSalida = 0;
             |PARA nCampo1 = 37;  |SI nCampo1 [ 57;  |HACIENDO nCampo1 = nCampo1 + 1;
                   nCampo2 = nCampo1 - 33;
                   #0nCampo1 = #99nCampo2;
             |SIGUE;
         |FINSI;

         |POPV;

         #0#27 =  #0#37 + #0#40 + #0#43 + #0#46 + #0#49 + #0#52 + #0#55;
     |FINSI;

     |SI #0#6 = "ER"; |O #0#6 = "SR"; |O #0#6 = "MR"; |O #0#6 = "HR"; |O #0#6 = "TR";
                      |O #0#6 = "RR"; |O #0#6 = "CR"; |O #0#6 = "DR";
         |PUSHV 0501 2380;
         |CUADRO 0756 1080;
         |BLANCO 0857 0979;

         |ATRI R;
         |PINTA 0857, "Base Imponible Anterior";
         |ATRI r;

         |C_V #0#27, 1, "S";
         |C_M #0#27, 1, "S";
         |C_P #0#27, 1, 0965;
         |ENCAMPO #27#0;
         |C_V #0#27, 1, "N";
         |C_M #0#27, 1, "N";
         |POPV;
     |FINSI;
|FPRC;

|PROCESO ImporteOtrosDatos;
     |SI #0#6 ! "C ";  |Y #0#6 ! "CR";
         |ACABA;
     |FINSI;

     |PUSHV 0919 1279;
     |BLANCO 0919 1279;
     |CUADRO 0919 1279;

     |ATRI R;
     |PINTA 1020, "NIF         Pais Nombre Destinatario sustituto ";
     |ATRI 0;

     |C_V #0#58, 1, "S"; |C_M #0#58, 1, "S";
     |C_V #0#59, 1, "S"; |C_M #0#59, 1, "S";
     |C_V #0#60, 1, "S"; |C_M #0#60, 1, "S";
     |PINTA #0#58;
     |PINTA #0#59;
     |PINTA #0#60;

|ET Campo58;
     |ENCAMPO #58#0;
     |SI FSalida = 7; |VETE FinTC; |FINSI;

|ET Campo59;
     |ENCAMPO #59#0;
     |SI FSalida = 2; |VETE Campo58; |FINSI;
     |SI FSalida = 7; |VETE FinTC; |FINSI;

     |ENCAMPO #60#0;
     |SI FSalida = 2; |VETE Campo59; |FINSI;

|ET FinTC;
     |C_V #0#58, 1, "N"; |C_M #0#58, 1, "N";
     |C_V #0#59, 1, "N"; |C_M #0#59, 1, "N";
     |C_V #0#60, 1, "N"; |C_M #0#60, 1, "N";
     |POPV;
|FPRC;
|| ///////////////////// Procesos de Alta y Presentacion \\\\\\\\\\\\\\\\\\\

|PROCESO LoPongoPlaning;
    |SI enTipoEntrada = 96;
         nError = 0;
         |CONFI "       No configurado Planing del Modelo 349, Desea Configurarlo : ";
         |SI FSalida ! 0;
             nError = 1;
             |ACABA;
         |FINSI;
         |ABRE #4;
         |DDEFECTO #4;
         #4#0 = enEmpresa;
         #4#1 = enEjer;
         #4#2 = nPer;
         #4#3 = 349;
         #4#4 = enComplem;
         |SI nSim006 = 1;
             #4#5  = #6#9;
             #4#16 = #6#12;
         |SINO;
             #4#5  = #5#8;
             #4#16 = #5#11;
         |FINSI;
         |GRABA 020#4n;
         |CIERRA #4;
     |FINSI;

     |ABRE #2;
     |DDEFECTO #2;
     #2#0 = #4#0;
     #2#1 = enActividad;
     #2#2 = enModelo349;
     |LEE 000#2=;
     fFecha1 = #2#8;
     fFecha2 = #2#9;

     #2#0 = #4#0;
     #2#1 = enActividad;
     #2#2 = 349;
     |LEE 001#2=;
     |SI FSalida ! 0;
         #2#0  = #4#0;
         #2#1  = enActividad;
         #2#2  = 349;
         #2#10 = 1;
         |GRABA 020#2b;
     |FINSI;

     |SI nSim006 = 1;
         #2#3 = #6#2;
         #2#4 = #6#3;
         #2#5 = #6#4;

         |SI #6#6 = "T";  #2#7 = "TRIMESTRAL";  |FINSI;
         |SI #6#6 = "A";  #2#7 = "ANUAL     ";  |FINSI;
         |SI #6#6 = "M";  #2#7 = "MENSUAL   ";  |FINSI;
         |SI #6#6 = "C";  #2#7 = "SELECCIONA";  |FINSI;
     |SINO;
         #2#3 = #5#1;
         #2#4 = #5#2;
         #2#5 = #5#3;

         |SI #5#5 = "T";  #2#7 = "TRIMESTRAL";  |FINSI;
         |SI #5#5 = "A";  #2#7 = "ANUAL     ";  |FINSI;
         |SI #5#5 = "M";  #2#7 = "MENSUAL   ";  |FINSI;
         |SI #5#5 = "C";  #2#7 = "SELECCIONA";  |FINSI;
     |FINSI;

     |SI #2#7 = "SELECCIONA";
         |SI aMenu2 = "1";   #2#7 = "TRIMESTRAL";  |FINSI;
         |SI aMenu2 = "2";   #2#7 = "ANUAL";       |FINSI;
         |SI aMenu2 = "3";   #2#7 = "MENSUAL";    |FINSI;
     |FINSI;

     #2#6 = eaNombreAct;
     #2#8 = fFecha1;
     #2#9 = fFecha2;
     |GRABA 020#2a;
     |LIBERA #2;
     |CIERRA #2;

     enEmpresaA = enEmpresa;
     enAnyo     = enEjer;
     |SUB_EJECUTA "dsmoz001";
|FPRC;

|PROCESO Alta4y8;
     |SI enEjer ] 2010;   |ACABA;  |FINSI;

     aConfi = "";
     #4#0   = enEmpresa;
     #4#1   = enEjer;
     #4#2   = 3;
     #4#3   = 349;
     #4#4   = enComplem;
     |LEE 040#4];
     |SI FSalida = 0;  |Y #4#0 = enEmpresa;
        |Y #4#1 = enEjer; |Y #4#3 = 349; |Y #4#4 = enComplem;
         aConfi = "T";
     |FINSI;

     |SI enTipoEntrada ! 96;
         |CONFI "       No configurado Planing del Modelo 349, Desea Configurarlo : ";
         |SI FSalida ! 0;
             nError = 1;
             |ACABA;
         |FINSI;
     |FINSI;

     nNoExiste = 1;
     |DDEFECTO #4;
     nSim006 = 0;
     |ABRE #6;
     |ABRE #5;

     #6#0 = enEmpresa;
     #6#1 = 349;
     |LEE 040#6=;
     |SI FSalida = 0;
         nSim006 = 1;

         |SI #6#6 = "M";
             nPer = enPeriodo;
         |FINSI;

         |SI #6#6 = "T";
             |SI enPeriodo ] 1;  |Y enPeriodo [ 3;  nPer = 3;  |FINSI;
             |SI enPeriodo ] 4;  |Y enPeriodo [ 6;  nPer = 6;  |FINSI;
             |SI enPeriodo ] 7;  |Y enPeriodo [ 9;  nPer = 9;  |FINSI;
             |SI enPeriodo ] 10; |Y enPeriodo [ 12; nPer = 12; |FINSI;
         |FINSI;

         |SI #6#6 = "A";  nPer = 99;         |FINSI;

         #4#5  = #6#9;
         #4#16 = #6#12;
     |SINO;
         #5#0 = 349;
         |LEE 040#5=;
         |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;

         |SI #5#5 = "M";
             nPer = enPeriodo;
         |FINSI;

         |SI #5#5 = "T";
             |SI enPeriodo ] 1;  |Y enPeriodo [ 3;  nPer = 3;  |FINSI;
             |SI enPeriodo ] 4;  |Y enPeriodo [ 6;  nPer = 6;  |FINSI;
             |SI enPeriodo ] 7;  |Y enPeriodo [ 9;  nPer = 9;  |FINSI;
             |SI enPeriodo ] 10; |Y enPeriodo [ 12; nPer = 12; |FINSI;
         |FINSI;

         |SI #5#5 = "A";  nPer = 99;         |FINSI;

         #4#5  = #5#8;
         #4#16 = #5#11;
     |FINSI;
     |CIERRA #6;
     |CIERRA #5;

     |SI nPer = -1;  |Y aConfi = "";  |Y enTipoEntrada = 95;
         |SI enPeriodo ] 1;  |Y enPeriodo [ 3;  nPer = 3;  |FINSI;
         |SI enPeriodo ] 4;  |Y enPeriodo [ 6;  nPer = 6;  |FINSI;
         |SI enPeriodo ] 7;  |Y enPeriodo [ 9;  nPer = 9;  |FINSI;
         |SI enPeriodo ] 10; |Y enPeriodo [ 12; nPer = 12; |FINSI;
     |FINSI;

     |SI nPer = -1;  |Y aConfi = ""; |Y enTipoEntrada ! 96;
         |PUSHV 0501 2380;
         |PARA; |SI; |HACIENDO;
                |CUADRO 0745 1780;
                |BLANCO 0846 1679;
                |ATRI S;
                |PINTA 0846, "Introduzca la Periodicidad del 349";
                |MENUG aMenu;
                aMenu2 = FSalida;

                |SI aMenu2 = "1";
                    |SI enPeriodo ] 1;  |Y enPeriodo [ 3;  nPer = 3;  |FINSI;
                    |SI enPeriodo ] 4;  |Y enPeriodo [ 6;  nPer = 6;  |FINSI;
                    |SI enPeriodo ] 7;  |Y enPeriodo [ 9;  nPer = 9;  |FINSI;
                    |SI enPeriodo ] 10; |Y enPeriodo [ 12; nPer = 12; |FINSI;

                    |SAL;
                |FINSI;

                |SI aMenu2 = "2";   nPer = 99;         |SAL;  |FINSI;

                |SI aMenu2 = "3";   nPer = enPeriodo;  |SAL;  |FINSI;
         |SIGUE;
         |POPV;
     |SINO;
         |SI nPer = -1;
             |SI enPeriodo ] 1;  |Y enPeriodo [ 3;  nPer = 3;  |FINSI;
             |SI enPeriodo ] 4;  |Y enPeriodo [ 6;  nPer = 6;  |FINSI;
             |SI enPeriodo ] 7;  |Y enPeriodo [ 9;  nPer = 9;  |FINSI;
             |SI enPeriodo ] 10; |Y enPeriodo [ 12; nPer = 12; |FINSI;
         |FINSI;
     |FINSI;

     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = nPer;
     #4#3 = 349;
     #4#4 = enComplem;
     |SI enTipoEntrada ! 96;
         |GRABA 020#4n;
     |FINSI;
     |LIBERA #4;

     |ABRE #3;
     #3#0 = #4#0;
     #3#1 = #4#1;
     #3#2 = #4#2;
     |LEE 101#3=;
     |SI FSalida ! 0;
         |DDEFECTO #3;
         #3#0 = #4#0;
         #3#1 = #4#1;
         #3#2 = #4#2;

         |SI #3#2 = 1;   #3#3 = "ENERO     ";  |FINSI;
         |SI #3#2 = 2;   #3#3 = "FEBRERO   ";  |FINSI;
         |SI #3#2 = 3;   #3#3 = "MARZO     ";  |FINSI;
         |SI #3#2 = 4;   #3#3 = "ABRIL     ";  |FINSI;
         |SI #3#2 = 5;   #3#3 = "MAYO      ";  |FINSI;
         |SI #3#2 = 6;   #3#3 = "JUNIO     ";  |FINSI;
         |SI #3#2 = 7;   #3#3 = "JULIO     ";  |FINSI;
         |SI #3#2 = 8;   #3#3 = "AGOSTO    ";  |FINSI;
         |SI #3#2 = 9;   #3#3 = "SEPTIEMBRE";  |FINSI;
         |SI #3#2 = 10;  #3#3 = "OCTUBRE   ";  |FINSI;
         |SI #3#2 = 11;  #3#3 = "NOVIEMBRE ";  |FINSI;
         |SI #3#2 = 12;  #3#3 = "DICIEMBRE ";  |FINSI;
         |SI #3#2 = 99;  #3#3 = "ANUAL     ";  |FINSI;

         |GRABA 020#3n;
     |FINSI;
     |LIBERA #3;
     |CIERRA #3;

     |SI enTipoEntrada ! 96; |HAZ LoPongoPlaning; |FINSI;
|FPRC;

|PROCESO Alta4y8Activ;
     |SI enEjer ] 2010;   |ACABA;  |FINSI;

     |ABRE #4;
     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = nPer;
     #4#3 = 349;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;

     |ABRE #8;
     #8#0 = #4#0;
     #8#1 = #4#1;
     #8#2 = #4#2;
     #8#3 = #4#3;
     #8#4 = #4#4;
     #8#5 = enActividad;
     |LEE 101#8=;
     |SI FSalida ! 0;
         |DDEFECTO #8;
         #8#0  = #4#0;
         #8#1  = #4#1;
         #8#2  = #4#2;
         #8#3  = #4#3;
         #8#4  = #4#4;
         #8#5  = enActividad;
         #8#6  = eaNombreAct;
         #8#7  = eaCaptura;
         #8#8  = "REGISTROS DEL MODELO " + #8#3 + " EJERCICIO " + #8#1 + " PERIODO " + #8#2;
         #8#9  = eaComunidad;
         #8#10 = eaComunero;
         #8#12 = #8#3;
         |GRABA 020#8b;
     |FINSI;
     #8#11 = "SIN DATOS";
     |GRABA 020#8a;
     |LIBERA #8;
     |CIERRA #8;
|FPRC;

|RUTINA ClaveBaja0;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = nDPeriodoV;
     #0#3  = 349;
     #0#4  = nDComple;
     #0#5  = enActividad;
     #0#6  = aDTipo;
     #0#7  = "            ";
     #0#25 = 0000;
     #0#26 = 0;
|FRUT;

|RUTINA ClaveAlta0;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = nHPeriodoV;
     #0#3  = 349;
     #0#4  = nHComple;
     #0#5  = enActividad;
     #0#6  = aHTipo;
     #0#7  = "zzzzzzzzzzzz";
     #0#25 = 9999;
     #0#26 = 99;
|FRUT;

|PROCESO Graba349;
     |SI nPeriodo ! #0#2;  |O nActiv ! #0#5;
         #8#0 = #0#0;
         #8#1 = #0#1;
         #8#2 = #0#2;
         #8#3 = #0#3;
         #8#4 = #0#4;
         #8#5 = #0#5;
         |LEE 101#8=;
         |SI FSalida = 0;
             #8#11 = "COMPLETADO";
             |GRABA 020#8a;
         |FINSI;
         |LIBERA #8;
     |FINSI;

     nPeriodo = #0#2;
     nActiv   = #0#5;

     |SI #0#6 = "E ";  |O  #0#6 = "S "; |O #0#6 = "M ";
        |O #0#6 = "H "; |O  #0#6 = "T "; |O #0#6 = "R ";
           |O  #0#6 = "D "; |O #0#6 = "C ";
         #349#6 = #349#6 + 1;
         #349#7 = #349#7 + #0#22;
     |FINSI;

     |SI #0#6 = "A ";   |O #0#6 = "I ";
         #349#8 = #349#8 + 1;
         #349#9 = #349#9 + #0#22;
     |FINSI;

     |SI #0#6 = "AR";  |O #0#6 = "ER";
      |O #0#6 = "IR";  |O #0#6 = "SR";
      |O #0#6 = "MR";  |O #0#6 = "HR";
      |O #0#6 = "TR";  |O #0#6 = "RR";
      |O #0#6 = "DR";  |O #0#6 = "CR";
         #349#10 = #349#10 + 1;
         #349#11 = #349#11 + #0#22;
     |FINSI;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE dsmoc349;
     #0#1;
     ;
     enEmpresa, enEjer, nDPeriodo, 349, enComplem, 01, "  ", 0000, 00, "            ";
     enEmpresa, enEjer, nHPeriodo, 349, enComplem, 99, "zz", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Graba349;
|FIN;

|PROCESO Graba349_99;
     #0#0 = #20#0;
     #0#1 = #20#1;
     #0#2 = 99;
     #0#3 = #20#3;
     #0#4 = #20#4;
     #0#5 = #20#5;
     #0#6 = #20#6;
     #0#7 = #20#7;
     |LEE 101#0=;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         #0#0 = #20#0;
         #0#1 = #20#1;
         #0#2 = 99;
         #0#3 = #20#3;
         #0#4 = #20#4;
         #0#5 = #20#5;
         #0#6 = #20#6;
         #0#7 = #20#7;
         #0#8 = #20#8;
         #0#9 = #20#9;
         |GRABA 020#0b;
     |FINSI;

     #0#22 = #0#22 + #20#22;

     |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
            |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
                  nCampo11 = nCampo22 - 1;
                  nCampo33 = nCampo22 + 1;
                  |SI #0nCampo22 = #20nCampo2;
                      #0nCampo11 = #0nCampo11 + #20nCampo1;
                      #0nCampo33 = #0nCampo33 + #20nCampo3;
                      |SAL;
                  |FINSI;
            |SIGUE;
     |SIGUE;

     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE reflejo;
     #20#1010;
     ;
     enEmpresa, enEjer,  1, 349, enComplem, 01, "  ", 0000, 00, "            ";
     enEmpresa, enEjer, 12, 349, enComplem, 99, "zz", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Graba349_99;
|FIN;

|PROCESO Borra349_99;
     |BORRA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE dsmoc349_99;
     #0#1;
     ;
     #349#0, #349#1, #349#2, #349#3, #349#4, 01, "  ", 0000, 00, "            ";
     #349#0, #349#1, #349#2, #349#3, #349#4, 99, "zz", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Borra349_99;
|FIN;

|PROCESO GrabaRegistro0;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = nPer;
     #8#3 = 349;
     #8#4 = enComplem;
     #8#5 = 0;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;

     nSwGraba = 0;

     |ABRE #349;

     #349#0 = enEmpresa;
     #349#1 = enEjer;
     #349#2 = nPer;
     #349#3 = 349;
     #349#4 = enComplem;
     #349#5 = 0;
     |LEE 101#349=;
     |SI FSalida ! 0;
         |DDEFECTO #349;
         #349#0  = enEmpresa;
         #349#1  = enEjer;
         #349#2  = nPer;
         #349#3  = 349;
         #349#4  = enComplem;
         #349#5  = 0;
         |GRABA 020#349b;
     |FINSI;

     #349#12  = #4#24;
     #349#13  = #4#21;
     #349#6   = 0;
     #349#7   = 0;
     #349#8   = 0;
     #349#9   = 0;
     #349#10  = 0;
     #349#11  = 0;
     nPeriodo = 0;
     nActiv   = 0;

     |SI #349#2 = 99;
         |BUCLE dsmoc349_99;

         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc349.mas";
         |CARGA_DEF aDef, reflejo@;
         |SI FSalida ! 0;
             aAlfa = "     Error en cargar el Def dsmoc349.mas";
             |MENAV aAlfa;
             |ERROR;
         |FINSI;

         |ABRE #0;
         |BUCLE reflejo;
         |CIERRA #0;

         |DESCARGA_DEF #reflejo@;

         nDPeriodo = 99;
         nHPeriodo = 99;
         |BUCLE dsmoc349;
     |SINO;
         |BUCLE dsmoc349;
     |FINSI;

     |SI nSwGraba = 0;
         |BORRA 020#349a;
         |LIBERA #349;
     |SINO;
         |GRABA 020#349a;
         |LIBERA #349;
         |CIERRA #349;

         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = nPer;
         #8#3 = 349;
         #8#4 = enComplem;
         #8#5 = 0;
         |LEE 101#8=;
         |SI FSalida = 0;
             #8#11 = "EXISTENTE";
             |GRABA 020#8a;
         |FINSI;
         |LIBERA #8;
     |FINSI;

     |ABRE #4;
     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = nPer;
     #4#3 = 349;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida = 0;
         nMod     = enModelo;
         enModelo = 349;
         |HAZ ChequeaSituacion;
         enModelo = nMod;

         |GRABA 020#4a;
     |FINSI;
     |LIBERA #4;
     |CIERRA #4;
|FPRC;

|PROCESO AltaModelos2009;
     |HAZ Alta4y8Activ;

     |SI enTipoEntrada ! 96;
         |HAZ PintaDatos;
         |ENTLINEAL #1#0, -3, 2, 22, 1, ClaveBaja0, ClaveAlta0;
     |FINSI;

     |ABRE #0;
     |DDEFECTO #0;
     #0#0 = enEmpresa;
     #0#1 = enEjer;
     #0#2 = nDPeriodo;
     #0#3 = 349;
     #0#4 = enComplem;
     #0#5 = enActividad;
     #0#6 = aDTipo;
     #0#7 = "            ";
     |LEE 040#0];
     |SI FSalida = 0;    |Y #0#0 = enEmpresa; |Y #0#1 = enEjer;
        |Y  #0#3 = 349;  |Y #0#4 = enComplem; |Y #0#5 = enActividad;

            |SI #0#2 ] nDPeriodo;  |Y #0#2 [ nHPeriodo;
                |SI enTipoEntrada = 96; |Y nNoExiste = 1;
                    |HAZ LoPongoPlaning;
                |FINSI;

                |ABRE #8;
                #8#0 = #4#0;
                #8#1 = #4#1;
                #8#2 = #4#2;
                #8#3 = #4#3;
                #8#4 = #4#4;
                #8#5 = enActividad;
                |LEE 101#8=;
                |SI FSalida = 0;
                    #8#11 = "COMPLETADO";
                    |GRABA 020#8a;
                |FINSI;
                |LIBERA #8;
                |CIERRA #8;
            |FINSI;
     |FINSI;

     |ABRE #8;
     |HAZ GrabaRegistro0;
     |CIERRA #8;
|FPRC;

|PROCESO dsmom004_2010;
     |SI nPasada = 0;
         #349#0 = #4#0;
         #349#1 = #4#1;
         #349#2 = #4#2;
         #349#3 = #4#3;
         #349#4 = #4#4;
         #349#5 = 0;
         |LEE 101#349=;
         |SI FSalida ! 0;
             |DDEFECTO #349;
             #349#0  = #4#0;
             #349#1  = #4#1;
             #349#2  = #4#2;
             #349#3  = #4#3;
             #349#4  = #4#4;
             #349#5  = 0;
             |GRABA 020#349b;
         |FINSI;

         #349#12  = #4#24;
         #349#13  = #4#21;
         #349#6   = 0;
         #349#7   = 0;
         #349#8   = 0;
         #349#9   = 0;
         #349#10  = 0;
         #349#11  = 0;

         |SI #349#2 = 99;
             |BUCLE dsmoc349_99;

             |DBASE aPathModelo;  |QBT aPathModelo;
             aDef = aPathModelo + "def/dsmoc349.mas";
             |CARGA_DEF aDef, reflejo@;
             |SI FSalida ! 0;
                 aAlfa = "     Error en cargar el Def dsmoc349.mas";
                 |MENAV aAlfa;
                 |ERROR;
             |FINSI;

             |ABRE #0;
             |BUCLE reflejo;
             |CIERRA #0;

             |DESCARGA_DEF #reflejo@;
         |FINSI;

         |GRABA 020#349a;
         |LIBERA #349;
     |FINSI;

     |SI nPasada = 1;
         #349#0 = #4#0;
         #349#1 = #4#1;
         #349#2 = #4#2;
         #349#3 = #4#3;
         #349#4 = #4#4;
         #349#5 = 0;
         |LEE 101#349=;
         |SI FSalida = 0;
             nSuma = #349#6 + #349#7 + #349#8 + #349#9 + #349#10 + #349#11;
             |SI nSuma = 0;
                 |BORRA 020#349a;
                 |LIBERA #349;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom004_2010;
     #4#1;
     ;
     enEmpresa, enEjer, nDPeriodo, 349, enComplem;
     enEmpresa, enEjer, nHPeriodo, 349, enComplem;
     ;
     NULL, dsmom004_2010;
|FIN;

|PROCESO Graba349_2010;

     nNume1 = (#0#2 + 1) * 2;
     |SI #0#2 = 99; nNume1 = 2; |FINSI;

     #349#0 = #0#0;
     #349#1 = #0#1;
     #349#2 = nPer349;
     |SI #95nNume1 = "M";  #349#2 = #0#2;  |FINSI;
     #349#3 = #0#3;
     #349#4 = #0#4;
     #349#5 = 0;
     |LEE 101#349=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #0#6 = "E "; |O #0#6 = "S "; |O #0#6 = "M "; |O #0#6 = "H ";
        |O #0#6 = "T "; |O #0#6 = "R "; |O #0#6 = "D "; |O #0#6 = "C ";
         #349#6 = #349#6 + 1;
         #349#7 = #349#7 + #0#22;
     |FINSI;

     |SI #0#6 = "A ";  |O #0#6 = "I ";
         #349#8 = #349#8 + 1;
         #349#9 = #349#9 + #0#22;
     |FINSI;

     |SI #0#6 = "AR";  |O #0#6 = "ER";
      |O #0#6 = "IR";  |O #0#6 = "SR";
      |O #0#6 = "MR";  |O #0#6 = "HR";
      |O #0#6 = "TR";  |O #0#6 = "RR";
      |O #0#6 = "DR";  |O #0#6 = "CR";
         #349#10 = #349#10 + 1;
         #349#11 = #349#11 + #0#22;
     |FINSI;

     |GRABA 020#349a;
     |LIBERA #349;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE dsmoc349_2010;
     #0#1;
     ;
     enEmpresa, enEjer, nDPeriodo, 349, enComplem, 01, "  ", 0000, 00, "            ";
     enEmpresa, enEjer, nHPeriodo, 349, enComplem, 99, "zz", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Graba349_2010;
|FIN;

|PROCESO BuscoLineas;
   nOk = 1;
   |ERROR10;
|FPRC;

|DEFBUCLE BuscoLineas;
  #0#1;
  ;
  #8#0, #8#1, nDPeriodo, #8#3, #8#4, #8#5, "  ", 0000,00, "            ";
  #8#0, #8#1, nHPeriodo, #8#3, #8#4, #8#5, "zz", 9999,99, "zzzzzzzzzzzz";
  ;
  NULL, BuscoLineas;
|FIN;

|PROCESO dsmom008B_2010;
     |SI #8#5 = 0;
         #349#0  = #8#0;
         #349#1  = #8#1;
         #349#2  = #8#2;
         #349#3  = #8#3;
         #349#4  = #8#4;
         #349#5  = 0;
         |LEE 040#349=;
         |SI FSalida = 0;
             #8#11 = "EXISTENTE";
         |SINO;
             #8#11 = "SIN DATOS";
         |FINSI;
     |SINO;
         nOk = 0;
         |BUCLE BuscoLineas;
         |SI nOk = 1;
             #8#11 = "COMPLETADO";
         |SINO;
             #8#11 = "SIN DATOS";
         |FINSI;
     |FINSI;

     |GRABA 020#8a;
     |LIBERA #8;   |SALVA_DATOS #8;

     #4#0 = #8#0;
     #4#1 = #8#1;
     #4#2 = #8#2;
     #4#3 = #8#3;
     #4#4 = #8#4;
     |LEE 101#4=;
     |SI FSalida = 0;
         nMod      = enModelo;
         enModelo  = 349;
         nPeriodo  = enPeriodo;
         enPeriodo = #4#2;
         |HAZ ChequeaSituacion;
         enModelo  = nMod;
         enPeriodo = nPeriodo;

         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;

     |REPON_DATOS #8;
     |LEE 000#8=;
|FPRC;

|DEFBUCLE dsmom008B_2010;
     #8#1;
     ;
     enEmpresa, enEjer, nDPeriodo, 349, enComplem, 00;
     enEmpresa, enEjer, nHPeriodo, 349, enComplem, 99;
     be;
     NULL, dsmom008B_2010;
|FIN;

|PROCESO GrabaRegistro0_2010;
     nSwGraba = 0;

     nDPeriodo = nDPeriodoV;
     nHPeriodo = nHPeriodoV;

     |SI #95#2 = "A";
         nDPeriodo = 99;
         nHPeriodo = 99;
     |FINSI;

     |SI #95#2 = "T";
         |SI enPeriodo = 1;   nDPeriodo = 1;  nHPeriodo = 3;  |FINSI;
         |SI enPeriodo = 2;   nDPeriodo = 1;  nHPeriodo = 3;  |FINSI;
         |SI enPeriodo = 3;   nDPeriodo = 1;  nHPeriodo = 3;  |FINSI;
         |SI enPeriodo = 4;   nDPeriodo = 4;  nHPeriodo = 6;  |FINSI;
         |SI enPeriodo = 5;   nDPeriodo = 4;  nHPeriodo = 6;  |FINSI;
         |SI enPeriodo = 6;   nDPeriodo = 4;  nHPeriodo = 6;  |FINSI;
         |SI enPeriodo = 7;   nDPeriodo = 7;  nHPeriodo = 9;  |FINSI;
         |SI enPeriodo = 8;   nDPeriodo = 7;  nHPeriodo = 9;  |FINSI;
         |SI enPeriodo = 9;   nDPeriodo = 7;  nHPeriodo = 9;  |FINSI;
         |SI enPeriodo = 10;  nDPeriodo = 10; nHPeriodo = 12; |FINSI;
         |SI enPeriodo = 11;  nDPeriodo = 10; nHPeriodo = 12; |FINSI;
         |SI enPeriodo = 12;  nDPeriodo = 10; nHPeriodo = 12; |FINSI;
     |FINSI;

     nPer349 = nHPeriodo;

     |ABRE #349;
     nPasada = 0;  |BUCLE dsmom004_2010;
                   |BUCLE dsmoc349_2010;
     nPasada = 1;  |BUCLE dsmom004_2010;
     |ABRE #4;
                   |BUCLE dsmom008B_2010;
     |CIERRA #4;

     |CIERRA #349;

     enEntrada = 1;
|FPRC;

|PROCESO AltaModelos2010;
     |SI enTipoEntrada ! 96;
         |HAZ PintaDatos;
         |ENTLINEAL #1#0, -3, 2, 22, 1, ClaveBaja0, ClaveAlta0;
     |FINSI;

     |HAZ GrabaRegistro0_2010;
|FPRC;

|PROCESO AltaModelo;
     |SI enEjer [ 2009;
         |HAZ AltaModelos2009;
     |FINSI;

     |SI enEjer ] 2010;
         |HAZ AltaModelos2010;
     |FINSI;
|FPRC;

|PROCESO Borra0;
     nOk = 0;
     |SI enTipoEnt349 = 1; |Y enEjer ] 2020;
         |SI #dsmoc349#6 = "R "; |O #dsmoc349#6 = "RR"; nOk = 1; |FINSI;
         |SI #dsmoc349#6 = "D "; |O #dsmoc349#6 = "DR"; nOk = 1; |FINSI;
         |SI #dsmoc349#6 = "C "; |O #dsmoc349#6 = "CR"; nOk = 1; |FINSI;
     |FINSI;
     |SI nOk = 0;
         |BORRA 020#0a;
     |FINSI;
     |LIBERA #0;
|FPRC;

|DEFBUCLE dsmoc349B;
     #0#1;
     ;
     enEmpresa,enEjer,nDPeriodoV,349,enComplem,enActividad,aDT,0000,00,aDN;
     enEmpresa,enEjer,nHPeriodoV,349,enComplem,enActividad,aHT,9999,99,aHN;
     be;
     NULL, Borra0;
|FIN;

|PROCESO BorraRegistros;
     aDT       = "";
     aHT       = "zz";
     aDN       = "";
     aHN       = "zzzzzzzzzzzz";
     |BUCLE dsmoc349B;

     |SI enEjer [ 2009;
         |ABRE #8;
         |HAZ GrabaRegistro0;
         |CIERRA #8;
     |FINSI;

     |SI enEjer ] 2010;
         |HAZ GrabaRegistro0_2010;
     |FINSI;

     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = nPer;
     #8#3 = 349;
     #8#4 = enComplem;
     #8#5 = enActividad;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;
|FPRC;

|PROCESO MiraElPlaning;
     nPer = -1;

     |ABRE #4;
     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = enPeriodo;
     #4#3 = 349;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida = 0;
         nPer = #4#2;
         |CIERRA #4;
         |ACABA;
     |FINSI;

     |SI enPeriodo ] 1;  |Y enPeriodo [ 3;  nPerTrab = 3;  |FINSI;
     |SI enPeriodo ] 4;  |Y enPeriodo [ 6;  nPerTrab = 6;  |FINSI;
     |SI enPeriodo ] 7;  |Y enPeriodo [ 9;  nPerTrab = 9;  |FINSI;
     |SI enPeriodo ] 10; |Y enPeriodo [ 12; nPerTrab = 12; |FINSI;

     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = nPerTrab;
     #4#3 = 349;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida = 0;
         nPer = #4#2;
         |CIERRA #4;
         |ACABA;
     |FINSI;

     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = 99;
     #4#3 = 349;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida = 0;  nPer = #4#2;  |FINSI;

     |CIERRA #4;
|FPRC;

|PROCESO FiltrosAntes2010;
     |HAZ MiraElPlaning;

     |SI nPer = -1;
         |SI enTipoEntrada = 99;
             enExistencia = 1;
             |ACABA;
         |FINSI;

         |SI enTipoEntrada = 4;
             |MENAV "     No existe Modelo.";
             enExistencia = 1;
             |ACABA;
         |FINSI;

         |SI enTipoEntrada = 1; |Y enComplem = 0;
             nError = 0;
             |HAZ Alta4y8;
             |SI nError = 1;
                 |ACABA;
             |FINSI;
         |FINSI;

         |SI enTipoEntrada = 96; |Y enComplem = 0;
             nError = 0;
             |HAZ Alta4y8;
             |SI nError = 1;
                  |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     |ABRE #2;
     #2#0 = enEmpresa;
     #2#1 = enActividad;
     #2#2 = enModelo349;
     |LEE 000#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     |SI #2#7 = "TRIMESTRAL";
         |SI enPeriodo = 3;    nDPeriodo = 1;   nHPeriodo = 3;   |FINSI;
         |SI enPeriodo = 6;    nDPeriodo = 4;   nHPeriodo = 6;   |FINSI;
         |SI enPeriodo = 9;    nDPeriodo = 7;   nHPeriodo = 9;   |FINSI;
         |SI enPeriodo = 12;   nDPeriodo = 10;  nHPeriodo = 12;  |FINSI;
     |FINSI;

     |SI #2#7 = "ANUAL     "; |O #2#7 = "ANUAL     ";
         nDPeriodo = 01;
         nHPeriodo = 12;
     |FINSI;

     |SI #2#7 = "MENSUAL   ";
         nDPeriodo = enPeriodo;
         nHPeriodo = enPeriodo;
     |FINSI;

     nDPeriodoV = nDPeriodo;
     nHPeriodoV = nHPeriodo;

|FPRC;

|PROCESO FiltrosDesde2010;

     |SI enActividad ! 99;
         nError    = 0;
         nGraboEl2 = 0;

         |ABRE #2;
         |DDEFECTO #2;
         #2#0 = enEmpresa;
         #2#1 = enActividad;
         #2#2 = enModelo349;
         |LEE 000#2=;
         fFecha1 = #2#8;
         fFecha2 = #2#9;

         #2#0 = enEmpresa;
         #2#1 = enActividad;
         #2#2 = 349;
         |LEE 101#2=;
         |SI FSalida ! 0;
             |SI enTipoEntrada ! 96;
                 |CONFI "       No configurado Planing del Modelo 349, Desea Configurarlo : ";
                 |SI FSalida ! 0;
                     |LIBERA #2;
                     |CIERRA #2;
                     nError = 1;
                     |ACABA;
                 |FINSI;
             |FINSI;

             |ABRE #5;
             #5#0 = 349;
             |LEE 040#5=;
             |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;
             |CIERRA #5;

             #2#0  = enEmpresa;
             #2#1  = enActividad;
             #2#2  = 349;
             #2#3  = #5#1;
             #2#4  = #5#2;
             #2#5  = #5#3;
             #2#6  = eaNombreAct;
             #2#7  = "TRIMESTRAL";
             |SI #5#5 = "M"; #2#7  = "MENSUAL   "; |FINSI;
             #2#8  = fFecha1;
             #2#9  = fFecha2;
             #2#10 = 1;
             |GRABA 020#2n;
             nGraboEl2 = 1;
         |FINSI;
         |LIBERA #2;
     |FINSI;

     |ABRE #95;
     #95#0 = enEmpresa;
     #95#1 = enEjer;
     |LEE 000#95=;
     |SI FSalida ! 0;
         |CIERRA #95;

         nGuardaPer = enPeriodo;
         |SI enTipoEntrada ! 96;
             |SUB_EJECUTA "dsmom095";
         |SINO;
             |SUB_EJECUTA "dsmom095;AUTOMATICO";
         |FINSI;

         enEmpresaA = enEmpresa;
         enAnyo     = enEjer;
         |SUB_EJECUTA "dsmoz001";
         enPeriodo = nGuardaPer;
     |SINO;
         |CIERRA #95;
         |SI nGraboEl2 = 1;
             nGuardaPer = enPeriodo;
             enEmpresaA = enEmpresa;
             enAnyo     = enEjer;
             |SUB_EJECUTA "dsmoz001";
             enPeriodo = nGuardaPer;
         |FINSI;
     |FINSI;

     |ABRE #95;
     #95#0 = enEmpresa;
     #95#1 = enEjer;
     |LEE 000#95=;
     |SI FSalida ! 0;  |DDEFECTO #95;  |FINSI;
     |CIERRA #95;

     nPer = -1;

     |SI enModelo349 ! 349;
         nActi = enActividad;
         |SI nActi = 99;  nActi = 1;  |FINSI;

         |ABRE #2;
         #2#0 = enEmpresa;
         #2#1 = nActi;
         #2#2 = enModelo349;
         |LEE 000#2=;
         |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
         |CIERRA #2;

         aAlfa = #2#7;  |QBF aAlfa;
         |SI aAlfa = "";
             #2#7 = "TRIMESTRAL";
         |FINSI;

         |SI #2#7 = "TRIMESTRAL";
             |SI enPeriodo = 3;    nDPeriodo = 1;   nHPeriodo = 3;   |FINSI;
             |SI enPeriodo = 6;    nDPeriodo = 4;   nHPeriodo = 6;   |FINSI;
             |SI enPeriodo = 9;    nDPeriodo = 7;   nHPeriodo = 9;   |FINSI;
             |SI enPeriodo = 12;   nDPeriodo = 10;  nHPeriodo = 12;  |FINSI;
         |FINSI;

         |SI #2#7 = "ANUAL     ";
             nDPeriodo = 01;
             nHPeriodo = 12;
         |FINSI;

         |SI #2#7 = "MENSUAL   ";
             nDPeriodo = enPeriodo;
             nHPeriodo = enPeriodo;
         |FINSI;
     |SINO;
         nCampo1 = enPeriodo + (enPeriodo + 1);
         nCampo2 = nCampo1 + 1;

         |SI #95#2 = "A";
             nDPeriodo   = 1;
             nHPeriodo   = 12;
             nDPeriodoV  = 1;
             nHPeriodoV  = 12;
             nPer        = 99;
             |ACABA;
         |FINSI;

         |SI #95nCampo2 = "T";
             |SI enPeriodo = 3;    nDPeriodo = 1;   nHPeriodo = 3;   nPer = 3;  |FINSI;
             |SI enPeriodo = 6;    nDPeriodo = 4;   nHPeriodo = 6;   nPer = 6;  |FINSI;
             |SI enPeriodo = 9;    nDPeriodo = 7;   nHPeriodo = 9;   nPer = 9;  |FINSI;
             |SI enPeriodo = 12;   nDPeriodo = 10;  nHPeriodo = 12;  nPer = 12; |FINSI;
         |FINSI;

         |SI #95nCampo2 = "M";
             nDPeriodo = enPeriodo;
             nHPeriodo = enPeriodo;
             nPer      = enPeriodo;

             |SI enPeriodo = 2;   |Y #95#27 = "S";  nDPeriodo = 1;   |FINSI;
             |SI enPeriodo = 5;   |Y #95#28 = "S";  nDPeriodo = 4;   |FINSI;
             |SI enPeriodo = 8;   |Y #95#29 = "S";  nDPeriodo = 7;   |FINSI;
             |SI enPeriodo = 11;  |Y #95#30 = "S";  nDPeriodo = 10;  |FINSI;
         |FINSI;
     |FINSI;

     nDPeriodoV = nDPeriodo;
     nHPeriodoV = nHPeriodo;
|FPRC;

|PROCESO LeoEntregas;
  aAlfa = #reflejo@#6 % 101;
  |SI aAlfa = "E"; |O aAlfa = "M"; |O aAlfa = "H"; |O aAlfa = "T";
      |PARA nCampo1 = 0; |SI nCampo1 [ 57; |HACIENDO nCampo1 = nCampo1 + 1;
            #0nCampo1 = #reflejo@#nCampo1#;
      |SIGUE;
      |GRABA 040#0n;
  |FINSI;
|FPRC;

|DEFBUCLE LeoEntregas;
    #reflejo@#1010;
    ;
    enEmpresa, enEjer,  1, 349, enComplem, 01, "E ", 0000, 00, "            ";
    enEmpresa, enEjer, 12, 349, enComplem, 99, "Tz", 9999, 99, "zzzzzzzzzzzz";
    ;
    NULL, LeoEntregas;
|FIN;

|PROCESO DatosEntregas;
     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/dsmoc349.mas";
     |CARGA_DEF aDef, reflejo@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def dsmoc349.mas";
         |MENAV aAlfa;
         |ERROR;
     |FINSI;

     aFichero = "E" + Usuario;
     |NOME_DAT #0 aFichero;
     |DELINDEX #0;

     |ABRE #0;
     |BUCLE LeoEntregas;
     |CIERRA #0;

      aDTipo = "  ";
      aHTipo = "zz";
|FPRC;

|PROCESO FinDatosEntregas;
     |DESCARGA_DEF #reflejo@;
|FPRC;

|PROCESO Filtro2018;
    |SI nOpera = 0;
        nOk = 1;
        |ERROR10;
    |FINSI;
    |SI nOpera = 1;
        |PARA nCampo1 = 0; |SI nCampo1 [ 57; |HACIENDO nCampo1 = nCampo1 + 1;
              #reflejo@#nCampo1# = #dsmoc349#nCampo1#;
        |SIGUE;
        |SI #dsmoc349#6 = "E "; #reflejo@#6 = "T "; |FINSI;
        |SI #dsmoc349#6 = "ER"; #reflejo@#6 = "TR"; |FINSI;
        |GRABA 040#reflejo@.n;

        |BORRA 040#dsmoc349.a;
    |FINSI;
    |LIBERA #dsmoc349;
|FPRC;

|DEFBUCLE Filtro2018;
    #dsmoc349#1;
    23;
    00001, 2018, 00, 000, 00, 00, "E ", 0000, 00, "            ", "X";
    99999, 2018, 99, 999, 99, 99, "ER", 9999, 99, "zzzzzzzzzzzz", "X";
    be;
    NULL, Filtro2018;
|FIN;

|PROCESO FiltroDel2018;
     |SALVA_DATOS #0;
     nOk    = 0;
     nOpera = 0; |BUCLE Filtro2018;
     |SI nOk ! 0;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc349.mas";
         |CARGA_DEF aDef, reflejo@;
         |SI FSalida ! 0;
             aAlfa = "     Error en cargar el Def dsmoc349.mas";
             |MENAV aAlfa;
             |ERROR;
         |FINSI;
         |ABRE #reflejo@;
         nOpera = 1; |BUCLE Filtro2018;
         |CIERRA #reflejo@;
         |DESCARGA_DEF #reflejo@;
     |FINSI;
     |REPON_DATOS #0;
|FPRC;


|PROCESO FiltrosProgram;

     |SI enEjer [ 2009;
         |HAZ FiltrosAntes2010;
     |FINSI;

     |SI enEjer ] 2010;
         |HAZ FiltrosDesde2010;
     |FINSI;

     |SI enEjer = 2018;
         |HAZ FiltroDel2018;
     |FINSI;

     aDTipo = "  ";
     aHTipo = "zz";

     |SI eaTipo349 = "A";
         aDTipo = "A ";
         aHTipo = "Az";
         |SI enTipoEntrada = 1; |Y enEjer ] 2015;
             aHTipo = "A ";
         |FINSI;
     |FINSI;

      |SI eaTipo349 = "I";
         aDTipo = "I ";
         aHTipo = "Iz";
         |SI enTipoEntrada = 1; |Y enEjer ] 2015;
             aHTipo = "I ";
         |FINSI;
     |FINSI;

     |SI eaTipo349 = "AR";  |Y enEjer ] 2015;
         aDTipo = "AR";
         aHTipo = "AR";
     |FINSI;

     |SI eaTipo349 = "IR";  |Y enEjer ] 2015;
         aDTipo = "IR";
         aHTipo = "IR";
     |FINSI;


     |SI eaTipo349 = "E";
         aDTipo = "E ";
         aHTipo = "Ez";
     |FINSI;

     |SI eaTipo349 = "S";
         aDTipo = "S ";
         aHTipo = "Sz";
     |FINSI;

     |SI eaTipo349 = "M";
         aDTipo = "M ";
         aHTipo = "Mz";
     |FINSI;

     |SI eaTipo349 = "H";
         aDTipo = "H ";
         aHTipo = "Hz";
     |FINSI;

     |SI eaTipo349 = "T";
         aDTipo = "T ";
         aHTipo = "Tz";
     |FINSI;
|FPRC;

|PROCESO Existencia;
     enExistencia = 0;
|FPRC;

|DEFBUCLE Existencia;
     #0#1;
     ;
     enEmpresa,enEjer,nDPeriodo,349,enComplem,enActividad,aDT,0000,00,aDN;
     enEmpresa,enEjer,nHPeriodo,349,enComplem,enActividad,aHT,9999,99,aHN;
     ;
     NULL, Existencia;
|FIN;

|PROGRAMA;
     |SI enModelo349 = 0;  enModelo349 = 349;  |FINSI;

     |ABRE #4;
     |ABRE #8;

     nNoExiste    = 0;
     enExistencia = 0;
     |HAZ FiltrosProgram;

     |CIERRA #4;
     |CIERRA #8;

     |SI enExistencia = 1;  |O nError = 1; |O enTipoEntrada = 95;
         |ACABA;
     |FINSI;

     |SI enEjer [ 2009;
         |SI nPer = -1; |Y enComplem ! 0;
             |SI enTipoEntrada = 96; |O enTipoEntrada = 1; |O enTipoEntrada = 95;
                 |MENAV "    Antes de Introducir Datos del Modelo 349, cree la Complementaria ";
                 |ACABA;
             |FINSI;
         |FINSI;
     |SINO;
         |SI enComplem ! 0;
             |SI enModelo349 ! 349;
                 |MENAV "    Debera estar creada el mismo codigo de complementaria para el modelo 349.";
                 |MENAV "    Si no es asi no podra introducir datos.";
             |FINSI;
         |FINSI;
     |FINSI;

     eaNoVisu     = "";
     eaNomDef     = "dsmoc349";
     nDComple     = enComplem;
     nHComple     = enComplem;

|| \\\\\\ Consulta del Modelo ////////
     |C_V #dsmoc349#58, 1, "N";

     |SI enTipoEntrada = 4;              || Consulta del Modelo
         |HAZ PintaDatos;
         |ENTLINEAL #1#0, -3, 4, 22, 1, ClaveBaja0, ClaveAlta0;
     |FINSI;

     |SI enTipoEntrada = 14;              || Consulta del Modelo Entregas
         |HAZ PintaDatos;
         |HAZ DatosEntregas;
         |ENTLINEAL #1#0, -3, 4, 22, 1, ClaveBaja0, ClaveAlta0;
         |HAZ FinDatosEntregas;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              ||Baja del Modelo
         |HAZ BorraRegistros;
     |FINSI;

|| \\\\\\ Baja del Modelo desde Modulo////////

     |SI enTipoEntrada = 97;              ||Baja del Modelo
         |HAZ BorraRegistros;
     |FINSI;

|| \\\\\\ Alta del Modelo desde Registros ////////

     |SI enTipoEntrada = 96;              || Alta del Modelo
         |HAZ AltaModelo;
     |FINSI;

|| \\\\\\ Alta o Modificacion del Modelo ////////

     |SI enTipoEntrada = 1;              || Alta del Modelo
         |CABEZA "Modelo Trabajo 349 ";

         |SI enHComple ! 0;
             nDComple = enDComple;
             nHComple = enHComple;
         |FINSI;

         |HAZ AltaModelo;
         enTipoEntrada = 0;

         |SI enComplem ! 0;
             |MENAV "0000 Revise lo declarado en el IVA con el Modelo 349.";
         |FINSI;
     |FINSI;

     |SI enTipoEntrada = 98;              || Recalculo actividad
         |ABRE #8;
         |HAZ GrabaRegistro0;
         |CIERRA #8;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         enExistencia = 1;
         aDT          = "";
         aHT          = "zz";
         aDN          = "";
         aHN          = "zzzzzzzzzzzz";
         |BUCLE Existencia;
    |FINSI;
|FPRO;

|PROCESO Tipo88;  |TIPO 88;
     |HAZ Relaciones;
|FPRC;
