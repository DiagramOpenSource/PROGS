|FICHEROS;
     dsmom160;
     dsmom161;
     dsmoz152;

     dsmow178;

     dsmom060;
     dsmom061;
     dsmom162;
|FIN;

|VARIABLES;
  aParam = "";
  inkey  = 0;
  nInkey = 0;
  aAlfa1 = "";
  nOpe   = 0;
  nSw    = 0;
  nPlan  = 0;
  &enModificar = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|| ******************************************** Calculos Pantalla
|PROCESO LeoDsmom060;
   |SI nOpe = 1;
       |BORRA 020#dsmom060.a;
   |FINSI;
   |SI nOpe = 0;
       #dsmom060#6 = #dsmoz152#4;
       |GRABA 040#dsmom060.n;
   |FINSI;
   |LIBERA #dsmom060;
|FPRC;

|DEFBUCLE LeoDsmom060;
   #dsmom060#1;
   ;
   nPlan, " ", " ", 01;
   nPlan, "z", "z", 99;
   be;
   NULL, LeoDsmom060;
|FIN;

|PROCESO LeoDsmom061;
   |SI nOpe = 1;
       |BORRA 020#dsmom061.a;
   |FINSI;
   |SI nOpe = 0;
       #dsmom061#6 = #dsmoz152#4;
       |GRABA 040#dsmom061.n;
   |FINSI;
   |LIBERA #dsmom061;
|FPRC;

|DEFBUCLE LeoDsmom061;
   #dsmom061#1;
   ;
   nPlan, " ", " ", 01, 001;
   nPlan, "z", "z", 99, 999;
   be;
   NULL, LeoDsmom061;
|FIN;


|PROCESO LeoDsmom160;
   |SI nOpe = 1;
       |BORRA 020#dsmom160.a;
   |FINSI;
   |SI nOpe = 0;
       #dsmom160#0 = #dsmoz152#4;
       |GRABA 040#dsmom160.n;
   |FINSI;
   |LIBERA #dsmom160;
|FPRC;

|DEFBUCLE LeoDsmom160;
   #dsmom160#1;
   ;
   nPlan, " ", " ", 01;
   nPlan, "z", "z", 99;
   be;
   NULL, LeoDsmom160;
|FIN;

|PROCESO LeoDsmom161;
   |SI nOpe = 1;
       |BORRA 020#dsmom161.a;
   |FINSI;
   |SI nOpe = 0;
       #dsmom161#0 = #dsmoz152#4;
       |GRABA 040#dsmom161.n;
   |FINSI;
   |LIBERA #dsmom161;
|FPRC;

|DEFBUCLE LeoDsmom161;
   #dsmom161#1;
   ;
   nPlan, " ", " ", 01, 001;
   nPlan, "z", "z", 99, 999;
   be;
   NULL, LeoDsmom161;
|FIN;

|PROCESO CopiarEAnt;

   nOpe = 1; nPlan = #dsmoz152#4; |BUCLE LeoDsmom160;
   nOpe = 0; nPlan = enPlan60;    |BUCLE LeoDsmom160;

   nOpe = 1; nPlan = #dsmoz152#4; |BUCLE LeoDsmom161;
   nOpe = 0; nPlan = enPlan60;    |BUCLE LeoDsmom161;

   nSw = 0;
   |ABRE #dsmom060;
   #dsmom060#6 = #dsmoz152#4;
   #dsmom060#0 = #dsmoz152#0;
   #dsmom060#1 = " ";
   #dsmom060#2 = 01;
   |LEE 040#dsmom060.];
   |SI FSalida ! 0; |O #dsmom060#6 ! #dsmoz152#4;
       nSw = 2;
   |FINSI;
   |CIERRA #dsmom060;
   |SI nSw = 2;
       nOpe = 1; nPlan = #dsmoz152#4; |BUCLE LeoDsmom060;
       nOpe = 0; nPlan = enPlan60;    |BUCLE LeoDsmom060;

       nOpe = 1; nPlan = #dsmoz152#4; |BUCLE LeoDsmom061;
       nOpe = 0; nPlan = enPlan60;    |BUCLE LeoDsmom061;
   |FINSI;

   |ABRE #dsmom162;
   |DDEFECTO #dsmom162;
   #dsmom162#0 = #dsmoz152#4;
   |LEE 041#dsmom162.=;
   |SI FSalida ! 0;
       |DDEFECTO #dsmom162;
       #dsmom162#0 = enPlan60;
       |LEE 041#dsmom162.=;
       |SI FSalida = 0;
           #dsmom162#0 = #dsmoz152#4;
           |GRABA 041#dsmom162.n;
       |FINSI;
   |FINSI;
   |CIERRA #dsmom162;
|FPRC;

|PROCESO LaBaja;
    nOpe = 1; nPlan = #dsmoz152#4; |BUCLE LeoDsmom160;
    nOpe = 1; nPlan = #dsmoz152#4; |BUCLE LeoDsmom161;
|FPRC;

|CALCULO wTipo0C4; |TIPO 0;
   |C_M #dsmoz152#4,0,aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   nInkey = FSalida;
   |SI nInkey = 10;
       |ABRE #dsmow178;
       #dsmow178#0 = #dsmoz152#4;
       |CONSULTA_CLAVE #1#dsmow178;
       #dsmoz152#4 = #dsmow178#0;
       |PINTA #dsmoz152#4;
       |CIERRA #dsmow178;
   |FINSI;

   |SI nInkey = 16;
       |CONFI "0000NEsta seguro de borrar todo el Ejercicio";
       |SI FSalida = 0;
           |HAZ LaBaja;
           |ERROR;
           |ACABA;
       |FINSI;
   |FINSI;

   nSw = 0;
   |ABRE #dsmom160;
   #dsmom160#0  = #dsmoz152#4;
   #dsmom160#1  = #dsmoz152#0;
   #dsmom160#2  = " ";
   #dsmom160#3 =  00;
   |LEE 040#dsmom160.];
   |SI FSalida ! 0; |O #dsmom160#0 ! #dsmoz152#4;
       nSw = 1;
       |CONFI "0000SNo existe Ejercicio. Recoger Anterior";
       |SI FSalida = 0;
           nSw = 2;
       |FINSI;
   |FINSI;
   |CIERRA #dsmom160;
   |SI nSw = 2;
       |HAZ CopiarEAnt;
   |FINSI;
|FCAL;

|CALCULO wTipo12; |TIPO 12;
|FCAL;

|CALCULO descri;  |TIPO 0;
  inkey = FSalida;
  |SI inkey = 1;
      inkey =  -1;
  |FINSI;
  |SI #dsmoz152#1 = "I"; #dsmoz152#3 = "INGRESOS"; |FINSI;
  |SI #dsmoz152#1 = "G"; #dsmoz152#3 = "GASTOS ";  |FINSI;
  |PINTA #dsmoz152#3;
|FCAL;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|RUTINA min;
  #dsmom160#0 = enPlan;
  #dsmom160#1 = #dsmoz152#0;
  #dsmom160#2 = #dsmoz152#1;
  #dsmom160#3 = 01;
|FRUT;

|RUTINA max;
  #dsmom160#0 = enPlan;
  #dsmom160#1 = #dsmoz152#0;
  #dsmom160#2 = #dsmoz152#1;
  #dsmom160#3 = 99;
|FRUT;

|PROCESO Tipo3;  |TIPO 3;
  enPlan = #dsmoz152#4;
  |SI enModificar = 0;
      |ENTLINEAL #1#dsmom160, -4, 4, 22, 0, min, max;
  |SINO;
      |ENTLINEAL #1#dsmom160, -4, 2, 22, 0, min, max;
  |FINSI;
|FPRC;

|PROGRAMA;
   eaPlanilla = "dsmom060";  |HAZ PlanDePlanillas;

   aParam = PARAMETRO; |QBF aParam;
   |SI aParam = "";  aParam = "N";  |FINSI;
   enModificar = 0;
   |SI aParam = "s"; |O aParam = "n"; enModificar = 1; |FINSI;
   aParam = aParam > " ";

   |DDEFECTO #dsmoz152;
   #dsmoz152#0 = aParam;
   |SI #dsmoz152#0 = "N"; #dsmoz152#2 = "Rendimientos de Actividades Economicas en Regimen de E.D.Normal y Sim."; |FINSI;
   |SI #dsmoz152#0 = "S"; #dsmoz152#2 = "Rendimientos procedentes de las Ventas del Inmovilizado Empresarial";  |FINSI;

   enEjer = 2999;
   |HAZ Verm060Plan;
   |SI enPlan60 = 0; |ACABA; |FINSI;

   enCreaFAnyo = 2;
   |HAZ eCreaFAnyo;
   |NOME_DAT #dsmow178#eaNFw178#;

   |CLS;
   |CABEZA "Agrupar Claves de Libros";
   |PINPA #0#dsmoz152;
   |SI #dsmoz152#0 = "S";
       |PINTA 0732, "                                                 ";
       |PINTA 0832, "컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴";
       |C_M #dsmom160#6, 1, "N"; |C_V #dsmom160#6, 1, "N";
       |C_M #dsmom160#7, 1, "N"; |C_V #dsmom160#7, 1, "N";
   |FINSI;

   #dsmoz152#4 = enPlan60;
   |PINDA #0#dsmoz152;

|ET PideAnyo;
  |C_M #dsmoz152#4, 1, "S";
  |ENCAMPO #4#dsmoz152;
  |SI FSalida ! 0; |ACABA; |FINSI;
  |C_M #dsmoz152#4, 1, "N";

  FSalida = 1;
  |PARA; |SI 0 < FSalida; |HACIENDO;

         |ENDATOS #1#dsmoz152;
         |SI 0 [ FSalida;
               |SI inkey = -1; |SAL; |FINSI;
               |HAZ Tipo3;
               FSalida = 1;
         |FINSI;
         |SI enPlan60 < #dsmoz152#4; enPlan60 = #dsmoz152#4; |FINSI;
  |SIGUE;
  |VETE PideAnyo;
|FPRO;
