|FICHEROS;
  dsmom060 #0,MANTE;
  dsmom061 #1,MANTE;

  :/contagen/def/cacuenta;

  dsmom162;
  dsmom61@;
  dsmom60@;
|FIN;

|VARIABLES;
  inkey     = 0;
  esalta    = 0;
  esaltaL   = 0;
  nSwSal    = 0;
  nInkey    = 0;
  aAlfa1    = "";
  aAlfa2    = "";
  aAlfa3    = "";
  nNume1    = 0;
  nNume2    = 0;
  nNume3    = 0;
  swError   = 0;
  nNumero   = 0;
  nLinea    = 0;
  nCampo0   = 0;
  nCampo1   = 0;
  nCampo2   = 0;
  nOp       = 0;
  nPara1    = 0;
  &enModificar = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

**************************************************************************
|CALCULO Tipo0C2; |TIPO 0;
    esalta  = (FEntrada / 100) ! 0;
    |SI enModificar = 0;
        |SI esalta = 1;
            |ERROR;
        |SINO;
             |PTEC 802;
        |FINSI;
    |FINSI;
|FCAL;

|CALCULO Lacolumna; |TIPO 7;
   |C_M #0#4,0,aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   aAlfa1 = #0#4; |QBF aAlfa1;
   |SI aAlfa1 = "";
       #0#4 = #0#3; |PINTA #0#4;
   |FINSI;
|FCAL;

|CALCULO FiltraClave;
   enClAgrupa = 0;
   eaClave60 = #dsmom060#Campo#;
   eaTip60   = #dsmom060#1;
   |SI #dsmom060#0 ! "S";
       |HAZ VerClave;
       |SI swError = 1;
           |ERROR;
           |ACABA;
       |FINSI;
       |HAZ eClaveAgrupa;
   |FINSI;
|FCAL;

|PROCESO VerClave;
     swError   = 0;
     eaClave60 = #dsmom060#Campo#;

     aAlfa1 = eaClave60; |QBF aAlfa1;
     |SI aAlfa1 = "";
         |CONFI "    NError. Clave en Blanco. Continuar";
         |SI FSalida ! 0;
             swError = 1;
         |FINSI;
         |ACABA;
     |FINSI;

     aAlfa2 = aAlfa1 % 0;
     nNume1 = aAlfa2;
     |SI nNume1 ! 3;
         |MENAV "0000Error. Longitud de la Clave erronea";
         swError = 1;
         |ACABA;
     |FINSI;

    aAlfa1 = eaClave60 % 101;
    aAlfa2 = eaClave60 % 201;
    aAlfa3 = eaClave60 % 301;

    |SI aAlfa1 ! #dsmom060#1; swError = 1; |FINSI;

    |SI aAlfa2 ! "Y"; |Y aAlfa2 ! "X";
        |SI aAlfa2 < "0"; |O aAlfa2 > "9";
            swError = 1;
        |FINSI;
    |FINSI;

    |SI aAlfa3 < "0"; |O aAlfa3 > "9";
        swError = 1;
    |FINSI;

    |SI swError = 1;
        |MENAV "    Clave Erronea ... ";
    |FINSI;
|FPRC;

|RUTINA ClaveBajaL;
     #1#6  = #0#6;
     #1#0  = #0#0;
     #1#1  = #0#1;
     #1#2  = #0#2;
     #1#3  = 001;
|FRUT;

|RUTINA ClaveAltaL;
     #1#6  = #0#6;
     #1#0  = #0#0;
     #1#1  = #0#1;
     #1#2  = #0#2;
     #1#3  = 999;
|FRUT;

|PROCESO BorraLineas;
     |BORRA 140#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE dsmom061;
     #1#1;
     ;
     #0#6, #0#0, #0#1, #0#2, 001;
     #0#6, #0#0, #0#1, #0#2, 999;
     be;
     NULL, BorraLineas;
|FIN;

|CALCULO Tipo2_1;  |TIPO 2;
     esalta  = (FEntrada / 100) ! 0;
     |SI esalta ! 3;  |ACABA;  |FINSI;
     |BUCLE dsmom061;
|FCAL;

||************************************************************************
|PROCESO PrimeroLineas;
  |SI nOp = 0;
      |BORRA 041#dsmom061.a;
  |SINO;
      nLinea = nLinea + 1;
      #dsmom061#2 = nNumero;
      #dsmom061#3 = nLinea;
      |GRABA 041#dsmom061.n;
  |FINSI;
  |LIBERA #dsmom061;
|FPRC;

|DEFBUCLE PrimeroLineas;
  #dsmom061#1;
  ;
  #dsmom060#6, #dsmom060#0, #dsmom060#1, nNume1, 001;
  #dsmom060#6, #dsmom060#0, #dsmom060#1, nNume1, 999;
  be;
  NULL, PrimeroLineas;
|FIN;

|PROCESO Primero;
  #dsmom60@#6 = #dsmom060#6;
  #dsmom60@#0 = #dsmom060#0;
  #dsmom60@#1 = #dsmom060#1;
  #dsmom60@#7 = eaClave60;
  |LEE 041#dsmom60@.=;
  |SI FSalida = 0;
      nNume1  = #dsmom60@#2;
      |SI nOp = 0;
          nNumero = #dsmom60@#2;
      |FINSI;
      |BUCLE PrimeroLineas;
  |FINSI;
|FPRC;

|PROCESO Actualizacion;
 |DBASE aAlfa1; |QBF aAlfa1;
 aAlfa2 = aAlfa1 + "def/dsmom060.mas";
 |CARGA_DEF aAlfa2, dsmom60@;

 |SI enClAgrup0 ] 1;   |Y enClAgrup0 [ 11;  nCampo0 = 1;   |FINSI;
 |SI enClAgrup0 ] 12;  |Y enClAgrup0 [ 22;  nCampo0 = 12;  |FINSI;
 |SI enClAgrup0 ] 23;  |Y enClAgrup0 [ 33;  nCampo0 = 23;  |FINSI;
 |SI enClAgrup0 ] 34;  |Y enClAgrup0 [ 44;  nCampo0 = 34;  |FINSI;
 |SI enClAgrup0 ] 45;  |Y enClAgrup0 [ 55;  nCampo0 = 45;  |FINSI;

 |SI enClAgrup0 ] 56;  |Y enClAgrup0 [ 66;  nCampo0 = 56;  |FINSI;
 |SI enClAgrup0 ] 67;  |Y enClAgrup0 [ 77;  nCampo0 = 67;  |FINSI;
 |SI enClAgrup0 ] 78;  |Y enClAgrup0 [ 88;  nCampo0 = 78;  |FINSI;
 |SI enClAgrup0 ] 89;  |Y enClAgrup0 [ 99;  nCampo0 = 89;  |FINSI;
 |SI enClAgrup0 ] 100; |Y enClAgrup0 [ 110; nCampo0 = 100; |FINSI;

 |ABRE #dsmom60@;
 |SELECT #2#dsmom60@;
 nLinea  = 0;
 nNumero = 0;
 nCampo1 = nCampo0 + 1;
 nCampo2 = nCampo0 + 10;
 eaClave60 = #dsmom162#nCampo0#; nOp = 0; |HAZ Primero;
 |SI nNumero ! 0;
     |PARA nPara1 = nCampo1; |SI nPara1 [ nCampo2; |HACIENDO nPara1 = nPara1 + 1;
           eaClave60 = #dsmom162#nPara1#; nOp = 1; |HAZ Primero;
     |SIGUE;
 |FINSI;

 |SELECT #1#dsmom60@;
 |CIERRA #dsmom60@;
 |DESCARGA_DEF #dsmom60@;
|FPRC;
||************************************************************************

|CALCULO elTipo3; |TIPO 3;
    esalta  = (FEntrada / 100) ! 0;
    nSwSal = 0;
    |SI enClAgrupa = 1;
        |ENTLINEAL #1#1, -5, 4, 21, 0, ClaveBajaL, ClaveAltaL;
    |SINO;
        |ENTLINEAL #1#1, -5, 2, 21, 0, ClaveBajaL, ClaveAltaL;
    |FINSI;
    |SI enClAgrupa ! 0;
        |HAZ Actualizacion;
    |FINSI;
|FCAL;

|CALCULO PresentaLinea;  |TIPO 7;
    nSwSal = 1;
    |ENTLINEAL #1#1, -5, 7, 21, 0, ClaveBajaL, ClaveAltaL;
|FCAL;

|| ************************************************************************
|CALCULO SalgoYa;  |TIPO 7;
     |SI nSwSal = 1;  |PTEC 807;  |FINSI;
|FCAL;

|PROCESO VerEspejo0;
  |SI #1#4 = #dsmom061#4;
      |SI #1#0 = #dsmom061#0; |Y #1#1 = #dsmom061#1; |Y #1#2 = #dsmom061#2; |Y #1#3 = #dsmom061#3;  |Y #1#6 = #dsmom061#6;
          || ... Es la misma linea
      |SINO;
          swError = 1;
          |ERROR10;
      |FINSI;
  |FINSI;
  |LIBERA #dsmom61@;
|FPRC;

|DEFBUCLE VerEspejo;
  #dsmom61@#1005;
  ;
  #0#6, #0#0, #0#1, #0#2, 001;
  #0#6, #0#0, #0#1, #0#2, 999;
  e;
  NULL, VerEspejo0;
|FIN;

|RUTINA inf2;
   #cacuenta#0 = "6           ";
   #cacuenta#3 = "S";
|FRUT;

|RUTINA sup2;
   #cacuenta#0 = "7zzzzzzzzzzz";
   #cacuenta#3 = "S";
|FRUT;

|CALCULO FiltraCta; |TIPO 6;

     nInkey = FSalida;
     |SI nInkey = 10;
        |ABRE #cacuenta;
        #cacuenta#0 = #1#4;
        |CONSULTA_F_CLAVE #6#cacuenta,inf2,sup2;
        #1#4 = #cacuenta#0; |PINTA #1#4;
        |CIERRA #cacuenta;
        |ERROR;
        |ACABA;
     |FINSI;

     eaCuenta = #1#4;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #1#4 = eaCuenta;
     |PINTA #1#4;
|FCAL;

|CALCULO cuenta_L; |TIPO 0;

   aAlfa1  = #1#4; |QBF aAlfa1;
   |SI aAlfa1 = "";
       |MENAV "    Error. Introcuzca Cuenta";
       |ERROR;
       |ACABA;
   |FINSI;

   swError = 0;
   aAlfa2 = aAlfa1 % 0;
   nNume1 = aAlfa2;
   |PARA nNume2 = 1; |SI nNume2 [ nNume1; |HACIENDO nNume2 = nNume2 + 1;
         aAlfa2 = nNume2; |QBF aAlfa2;
         aAlfa2 = aAlfa2 + "01";
         aAlfa3 = aAlfa1 % aAlfa2;
         |SI aAlfa3 < "0"; |O aAlfa3 > "9";
             swError = 1;
             |SAL;
         |FINSI;
   |SIGUE;
   |SI swError = 1;
       |MENAV "    Cuenta Erronea ... ";
       |ERROR;
   |FINSI;
/*
   |DBASE aAlfa1; |QBF aAlfa1;
   aAlfa2 = aAlfa1 + "def/dsmom061.mas";
   |CARGA_DEF aAlfa2, dsmom61@;
   |SI FSalida = 0;
       swError = 0;
       |BUCLE VerEspejo;
       |DESCARGA_DEF #dsmom61@;
       |SI swError = 1;
           |MENAV "    Error Cuenta Ya Introducida en la Planilla";
           |ERROR;
           |ACABA;
       |FINSI;
   |FINSI;
*/
|FCAL;

|CALCULO ElDefecto; |TIPO 0;
   esaltaL = (FEntrada / 100) ! 0;
   |SI esaltaL = 1;
       |SI #0#1 = "G"; #1#5 = "+"; |FINSI;
       |SI #0#1 = "I"; #1#5 = "-"; |FINSI;
       |PINTA #1#5;
   |FINSI;
|FCAL;
