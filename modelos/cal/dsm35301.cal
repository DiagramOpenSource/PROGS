|FICHEROS;
     dsm32201;
     dsm35301;
     dsm35302;
     dsmom004;

     dsmow219,MANTE;

     dsm35301@;
     dsm35302@;
     &clientes@;
|FIN;

|VARIABLES;
     aEsc                = "";
     aRetu               = "";
     aTecla              = "";
     aEsc1               = "";
     aEsc2               = "";
     aAlfa               = "";
     aAlfa1              = "";
     aMas                = "";
     aZ12                = "";
     aTipo               = "";
     aDni                = "";
     aImpreso            = "";

     n0Vent              = -1;
     n1Vent              = -1;
     nPnt353             = 0;
     nGrid               = -1;
     nBtn1               = 0;
     nBtn2               = 0;
     nBtnAlt             = 0;
     nBtnMod             = 0;
     nBtnBor             = 0;
     nRango              = 0;
     nModo               = 0;
     nHandle             = 0;
     nLinea              = 0;
     nAnyo               = 0;
     nPer                = 0;
     nPro                = 0;
     nDCampo             = 0;
     nHCampo             = 0;
     nModAnter           = 0;
     nPeriodoMin         = 0;
     nTotal353           = 0;
     nNegativo           = 0;
     nNegativoC          = 0;
     nNegativoD          = 0;
     nHComple            = 0;
     nRes                = 0;

     {2}nNivel           = 0;

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     {-1}sTree           = 0;
         sT_nID          = 0;
         sT_nOper        = 0;
         sT_aData        = "";

     &eaUnidadBasico     = "";
     &eMensa             = "";
|FIN;

|INCLUYE i_variar;

|PROCESO dsm35302C;
     #dsm32201#0  = #dsm35302#11;
     #dsm32201#1  = #dsm35302#1;
     #dsm32201#2  = #dsm35302#2;
     #dsm32201#3  = 322;
     #dsm32201#4  = 0;
     #dsm32201#5  = 0;
     |LEE 000#dsm32201.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |BORRA 020#dsm35302.a;
     |LIBERA #dsm35302;
|FPRC;

|DEFBUCLE dsm35302C;
     #dsm35302#1008;
     11;
#dsm35301#0,#dsm35301#1,#dsm35301#2,#dsm35301#3,#dsm35301#4,#dsm35301#5,"",    "",1;
#dsm35301#0,#dsm35301#1,#dsm35301#2,#dsm35301#3,#dsm35301#4,#dsm35301#5,aZ12,aZ12,99999;
     ;
     NULL, dsm35302C;
|FIN;

|PROCESO dsm32201;
     aTipo = "DEPENDIENTE";
     |SI #dsm32201#0 = #dsm35301#0;
         aTipo = " DOMINANTE";
     |FINSI;

     enCodCli = #dsm32201#0;
     |HAZ LeePersona;

     |SI enSwDeDonde = 1;
         aDni = #clientes@#3;
     |SINO;
         aDni = #clientes@#13;
     |FINSI;

     #dsmom004#0 = #dsm32201#0;
     #dsmom004#1 = #dsm32201#1;
     #dsmom004#2 = #dsm32201#2;
     #dsmom004#3 = #dsm32201#3;
     #dsmom004#4 = #dsm32201#4;
     |LEE 000#dsmom004.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;

     #dsm35302@#0  = enEmpresa;
     #dsm35302@#1  = nAnyo;
     #dsm35302@#2  = nPer;
     #dsm35302@#3  = 353;
     #dsm35302@#4  = 0;
     #dsm35302@#5  = 0;
     #dsm35302@#6  = aTipo;
     #dsm35302@#7  = aDni;
     |LEE 000#dsm35302@.=;
     |SI FSalida ! 0;  |DDEFECTO #dsm35302@;  |FINSI;

     #dsm35302#0  = enEmpresa;
     #dsm35302#1  = enEjer;
     #dsm35302#2  = enPeriodo;
     #dsm35302#3  = enModelo;
     #dsm35302#4  = enComplem;
     #dsm35302#5  = enActividad;
     #dsm35302#6  = aTipo;
     #dsm35302#7  = aDni;
     |LEE 101#dsm35302.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm35302;
         #dsm35302#0  = enEmpresa;
         #dsm35302#1  = enEjer;
         #dsm35302#2  = enPeriodo;
         #dsm35302#3  = enModelo;
         #dsm35302#4  = enComplem;
         #dsm35302#5  = enActividad;
         #dsm35302#6  = aTipo;
         #dsm35302#7  = aDni;
         #dsm35302#9  = #dsm35302@#9;

         |GRABA 020#dsm35302.b;
     |FINSI;

     #dsm35302#8  = #dsm32201#83;
     #dsm35302#10 = #dsmom004#25;
     #dsm35302#11 = #dsm32201#0;
     |GRABA 020#dsm35302.a;
     |LIBERA #dsm35302;
|FPRC;

|DEFBUCLE dsm32201;
     #dsm32201#2;
     ;
     #dsm35301#6, #dsm35301#1, #dsm35301#2, 322, 00, #dsm35301#5;
     #dsm35301#6, #dsm35301#1, #dsm35301#2, 322, 99, #dsm35301#5;
     ;
     NULL, dsm32201;
|FIN;

|PROCESO TraeteDatos;
     |ABRE #dsm32201;
     |BUCLE dsm35302C;    || Chequea la grid que los datos esten correctos
     |CIERRA #dsm32201;

     nAnyo = #dsm35301#1;
     nPer  = #dsm35301#2 - 1;
     |SI nPer = 0;
         nAnyo = #dsm35301#1 - 1;
         nPer  = 12;
     |FINSI;

     |DDEF aMas;
     aMas = aMas + "dsm35302.mas";
     |CARGA_DEF aMas, dsm35302@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #dsmom004;
     |ABRE #dsm35302@;
     |BUCLE dsm32201;                || Graba los 322 del periodo y pone los
     |CIERRA #dsm35302@;             || porcentajes del periodo anterior.
     |CIERRA #dsmom004;

     |DESCARGA_DEF #dsm35302@;
|FPRC;

|PROCESO dsm35302B;
     |BORRA 020#dsm35302.a;
     |LIBERA #dsm35302;
|FPRC;

|DEFBUCLE dsm35302B;
     #dsm35302#1;
     ;
#dsm35301#0,#dsm35301#1,#dsm35301#2,#dsm35301#3,#dsm35301#4,#dsm35301#5,"",  "";
#dsm35301#0,#dsm35301#1,#dsm35301#2,#dsm35301#3,#dsm35301#4,#dsm35301#5,aZ12,aZ12;
     be;
     NULL, dsm35302B;
|FIN;

|PROCESO dsm35302P;
     |DDEFECTO #dsm35302;
     #dsm35302#0  = enEmpresa;
     #dsm35302#1  = enEjer;
     #dsm35302#2  = enPeriodo;
     #dsm35302#3  = enModelo;
     #dsm35302#4  = enComplem;
     #dsm35302#5  = enActividad;
     #dsm35302#6  = #dsm35302@#6;
     #dsm35302#7  = #dsm35302@#7;
     #dsm35302#8  = 0;
     #dsm35302#9  = #dsm35302@#9;
     #dsm35302#10 = "";
     #dsm35302#11 = 0;

     |GRABA 020#dsm35302.n;
     |LIBERA #dsm35302;
|FPRC;

|DEFBUCLE dsm35302P;
     #dsm35302@#1008;
     11;
#dsm35301#0,nAnyo,nPer,#dsm35301#3,#dsm35301#4,#dsm35301#5,"",    "",0;
#dsm35301#0,nAnyo,nPer,#dsm35301#3,#dsm35301#4,#dsm35301#5,aZ12,aZ12,0;
     ;
     NULL, dsm35302P;
|FIN;

|PROCESO DatosPeriodoAnt;
     |BUCLE dsm35302B;

     nAnyo = #dsm35301#1;
     nPer  = #dsm35301#2 - 1;
     |SI nPer = 0;
         nAnyo = #dsm35301#1 - 1;
         nPer  = 12;
     |FINSI;

     aImpreso = "X";

     |ABRE #dsmom004;
     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = nAnyo;
     #dsmom004#2 = nPer;
     #dsmom004#3 = enModelo;
     #dsmom004#4 = enComplem;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         aImpreso = #dsmom004#9;
     |FINSI;
     |CIERRA #dsmom004;

     |SI aImpreso ! "X";
         |ACABA;
     |FINSI;

     |DDEF aMas;
     aMas = aMas + "dsm35302.mas";
     |CARGA_DEF aMas, dsm35302@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BUCLE dsm35302P;      || Graba los NIF del periodo anterior introducidos
                            || manualmente

     |DESCARGA_DEF #dsm35302@;

     |DDEF aMas;
     aMas = aMas + "dsm35301.mas";
     |CARGA_DEF aMas, dsm35301@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #dsm35301@;
     #dsm35301@#0 = #dsm35301#0;
     #dsm35301@#1 = nAnyo;
     #dsm35301@#2 = nPer;
     #dsm35301@#3 = #dsm35301#3;
     #dsm35301@#4 = #dsm35301#4;
     #dsm35301@#5 = #dsm35301#5;
     |LEE 000#dsm35301@.=;
     |SI FSalida = 0;
         #dsm35301#7  = #dsm35301@#7;
         #dsm35301#8  = #dsm35301@#8;
         #dsm35301#10 = #dsm35301@#14;
     |FINSI;
     |CIERRA #dsm35301@;
     |DESCARGA_DEF #dsm35301@;
|FPRC;

|PROCESO Evt02;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsm35302.=;

         |ESTADO_CONTROL nBtnMod, "ENABLE";
         |ESTADO_CONTROL nBtnBor, "ENABLE";

         |SI #dsm35302#6 = " DOMINANTE  ";
             |ESTADO_CONTROL nBtnMod, "DISABLE";
             |ESTADO_CONTROL nBtnBor, "DISABLE";
         |FINSI;

         |SI #dsm35302#11 ! 0;
             |ESTADO_CONTROL nBtnBor, "DISABLE";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Baja02;
     #dsm35302#0 = enEmpresa;
     #dsm35302#1 = enEjer;
     #dsm35302#2 = enPeriodo;
     #dsm35302#3 = enModelo;
     #dsm35302#4 = enComplem;
     #dsm35302#5 = enActividad;
     #dsm35302#6 = "";
     #dsm35302#7 = "";
|FPRC;

|PROCESO Alta02;
     #dsm35302#0 = enEmpresa;
     #dsm35302#1 = enEjer;
     #dsm35302#2 = enPeriodo;
     #dsm35302#3 = enModelo;
     #dsm35302#4 = enComplem;
     #dsm35302#5 = enActividad;
     #dsm35302#6 = aZ12;
     #dsm35302#7 = aZ12;
|FPRC;

|PROCESO BtnAlt;
     |VENTANA 0501, 1190, -1, 16, "Alta dependiente";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #dsmow219;

     |C_M #dsmow219#0, 1, "S";
     |C_M #dsmow219#1, 1, "S";
     |C_M #dsmow219#2, 1, "S";
     |C_M #dsmow219#3, 1, "S";

     |PINPA #0#dsmow219;
     |PINDA #0#dsmow219;
     |ENDATOS #1#dsmow219;
     |SI FSalida = 0;
         #dsm35302#0  = #dsm35301#0;
         #dsm35302#1  = #dsm35301#1;
         #dsm35302#2  = #dsm35301#2;
         #dsm35302#3  = #dsm35301#3;
         #dsm35302#4  = #dsm35301#4;
         #dsm35302#5  = #dsm35301#5;
         #dsm35302#6  = "DEPENDIENTE";
         #dsm35302#7  = #dsmow219#0;
         #dsm35302#8  = #dsmow219#1;
         #dsm35302#9  = #dsmow219#2;
         #dsm35302#10 = #dsmow219#3;
         #dsm35302#11 = 0;

         |GRABA 020#dsm35302.n;
         |LIBERA #dsm35302;

         |HAZ ActualizaMod;

         #dsm35302#0  = #dsm35301#0;
         #dsm35302#1  = #dsm35301#1;
         #dsm35302#2  = #dsm35301#2;
         #dsm35302#3  = #dsm35301#3;
         #dsm35302#4  = #dsm35301#4;
         #dsm35302#5  = #dsm35301#5;
         #dsm35302#6  = "DEPENDIENTE";
         #dsm35302#7  = #dsmow219#0;
         |LEE 000#dsm35302.=;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |PINDA #0#dsm35301;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnMod;
     |VENTANA 0501, 1190, -1, 16, "Modificaci¢n";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #dsmow219;
     #dsmow219#0 = #dsm35302#7;
     #dsmow219#1 = #dsm35302#8;
     #dsmow219#2 = #dsm35302#9;
     #dsmow219#3 = #dsm35302#10;

     |C_M #dsmow219#0, 1, "N";
     |C_M #dsmow219#1, 1, "S";
     |C_M #dsmow219#3, 1, "S";

     |SI #dsm35302#11 ! 0;
         |C_M #dsmow219#1, 1, "N";
         |C_M #dsmow219#3, 1, "N";
     |FINSI;

     |PINPA #0#dsmow219;
     |PINDA #0#dsmow219;
     |ENDATOS #1#dsmow219;
     |SI FSalida = 0;
         |LEE 101#dsm35302.=;
         |SI FSalida = 0;
             #dsm35302#7  = #dsmow219#0;
             #dsm35302#8  = #dsmow219#1;
             #dsm35302#9  = #dsmow219#2;
             #dsm35302#10 = #dsmow219#3;

             |GRABA 020#dsm35302.a;
             |LIBERA #dsm35302;

             |HAZ ActualizaMod;

             #dsm35302#0  = #dsm35301#0;
             #dsm35302#1  = #dsm35301#1;
             #dsm35302#2  = #dsm35301#2;
             #dsm35302#3  = #dsm35301#3;
             #dsm35302#4  = #dsm35301#4;
             #dsm35302#5  = #dsm35301#5;
             #dsm35302#6  = "DEPENDIENTE";
             #dsm35302#7  = #dsmow219#0;
             |LEE 000#dsm35302.=;
         |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |PINDA #0#dsm35301;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO BtnBor;
     |CONFI "0000NSeguro que quiere borrar el registro";
     |SI FSalida ! 0;
         |FOCOTECLADO nGrid;
         |ACABA;
     |FINSI;

     |LEE 101#dsm35302.=;
     |SI FSalida = 0;
         |BORRA 020#dsm35302.a;
         |LIBERA #dsm35302;

         |REFRESCACONTROL nGrid;
     |FINSI;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Btn1;
     |SI #dsm35301#7 = "S";
         #dsm35301#7 = "N";
     |SINO;
         #dsm35301#7 = "S";
     |FINSI;

     |PINTA #dsm35301#7;
|FPRC;

|PROCESO Btn2;
     |SI #dsm35301#8 = "S";
         #dsm35301#8 = "N";
     |SINO;
         #dsm35301#8 = "S";
     |FINSI;

     |PINTA #dsm35301#8;
|FPRC;

|PROCESO PintaBtns;
     |CONTROL_SIMPLE nPnt353, "BOTON,{{197}}", 0722, 0723, Btn1;
     nBtn1 = FSalida;

     |CONTROL_SIMPLE nPnt353, "BOTON,{{197}}", 0822, 0823, Btn2;
     nBtn2 = FSalida;

     |CONTROL_SIMPLE nPnt353, "BOTON,{{193}}Alta ", 2364, 2374, BtnAlt;
     nBtnAlt = FSalida;

     |CONTROL_SIMPLE nPnt353, "BOTON,{{197}}Modificar ", 2376, 2386, BtnMod;
     nBtnMod = FSalida;

     |CONTROL_SIMPLE nPnt353, "BOTON,{{199}}Borrar", 2388, 2398, BtnBor;
     nBtnBor = FSalida;

     |ESTADO_CONTROL nBtnMod, "DISABLE";
     |ESTADO_CONTROL nBtnBor, "DISABLE";
|FPRC;

|PROCESO dsm35301Otros;
     #dsm35301#12  = #dsm35301#12 + #dsm35301@#16;
     nTotal353     = #dsm35301@#11;

     nNegativoC    = #dsm35301@#14;
     nNegativoD    = #dsm35301@#15;
|FPRC;

|DEFBUCLE dsm35301Otros;
     #dsm35301@#1006;
     ;
     #dsm35301#0, #dsm35301#1, #dsm35301#2, #dsm35301#3,        0, #dsm35301#5;
     #dsm35301#0, #dsm35301#1, #dsm35301#2, #dsm35301#3, nHComple, #dsm35301#5;
     ;
     NULL, dsm35301Otros;
|FIN;

|PROCESO CapturaOtros353;
     |DDEF aMas;
     aMas = aMas + "dsm35301.mas";
     |CARGA_DEF aMas, dsm35301@;

     nHComple     = #dsm35301#4 - 1;
     #dsm35301#12 = 0;
     #dsm35301#13 = 0;
     nTotal353    = 0;
     nNegativoD   = 0;
     nNegativoC   = 0;

     |BUCLE dsm35301Otros;

     |SI nNegativoC ! 0;  |O nNegativoD ! 0;
         nNegativo  = (nNegativoC + nNegativoD) * -1;

         |SI nNegativoC ! 0;
             |SI eMensa = 0;
                 |MENAV "0000Declaraciones anteriores a compensar. ";
                 |CONFI "0000NHa compensado el importe en una declaracion posterior";
             |SINO;
                 FSalida = -1;
             |FINSI;
         |SINO;
             |SI eMensa = 0;
                 |MENAV "0000Declaraciones anteriores a devolver.";
                 |CONFI "0000NHa recibido la devolucion";
             |SINO;
                  FSalida = -1;
             |FINSI;
         |FINSI;

         |SI FSalida = 0;
            #dsm35301#12 = #dsm35301#12 + nNegativo;
         |FINSI;
     |FINSI;

     |DESCARGA_DEF #dsm35301@;
|FPRC;

|PROCESO dsm35302Calc;
     #dsm35301#9 = #dsm35301#9 + #dsm35302#8;
|FPRC;

|DEFBUCLE dsm35302Calc;
     #dsm35302#1;
     ;
#dsm35301#0,#dsm35301#1,#dsm35301#2,#dsm35301#3,#dsm35301#4,#dsm35301#5,"",    "";
#dsm35301#0,#dsm35301#1,#dsm35301#2,#dsm35301#3,#dsm35301#4,#dsm35301#5,aZ12,aZ12;
     ;
     NULL, dsm35302Calc;
|FIN;

|PROCESO ActualizaMod;
     #dsm35301#9  = 0;

     |BUCLE dsm35302Calc;

     |SI #dsm35301#4 > 0;
         |HAZ CapturaOtros353;
         nRes = #dsm35301#11 - #dsm35301#12;

         |SI nRes < nTotal353; |Y eMensa = 0;
             |MENAV "0000RECUERDE. Si el resultado es inferior a la declaracion anterior, NO procede complementaria";
         |FINSI;
     |FINSI;

     #dsm35301#11 = #dsm35301#9  - #dsm35301#10;
     #dsm35301#13 = #dsm35301#11 - #dsm35301#12;

     |SI #dsm35301#13 > 0;
         #dsm35301#16 = #dsm35301#13;
         #dsm35301#14 = 0;
         #dsm35301#15 = 0;
         |ACABA;
     |FINSI;

     || Compensar o Devolver

     |ABRE #dsmom004;
     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = enEjer;
     #dsmom004#2 = enPeriodo;
     #dsmom004#3 = enModelo;
     #dsmom004#4 = enComplem;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;
     |CIERRA #dsmom004;

     |HAZ UltimoPeriodo;

     |SI #dsmom004#23 = "S";
         |SI eaUltimoPer = "COMPENSAR";
             #dsm35301#14 = -#dsm35301#13;
             #dsm35301#15 = 0;
             #dsm35301#16 = 0;
         |SINO;
             #dsm35301#15 = -#dsm35301#13;
             #dsm35301#14 = 0;
             #dsm35301#16 = 0;
         |FINSI;
     |FINSI;

     |SI #dsmom004#23 = "N";
         |SI #dsm35301#2 = 12;
             |HAZ UltimoPeriodo;
             |SI eaUltimoPer = "COMPENSAR";
                 #dsm35301#14 = -#dsm35301#13;
                 #dsm35301#15 = 0;
                 #dsm35301#16 = 0;
             |SINO;
                 #dsm35301#15 = -#dsm35301#13;
                 #dsm35301#14 = 0;
                 #dsm35301#16 = 0;
             |FINSI;
        |SINO;
             #dsm35301#14 = -#dsm35301#13;
             #dsm35301#15 = 0;
             #dsm35301#16 = 0;
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO MontaPantalla;
     |VENTANA 0501, 3899, -1, 0,  "";
     n0Vent = FSalida;

     |PINPA #0#dsm35301; nPnt353 = FSalida;

     enCodCli = enEmpresa;
     |HAZ LeePersona;

     aAlfa = "LABEL,{{15}}Modelo 353 (" + (("00000" + enEmpresa) % -105) + " " + #clientes@#2;  |QBF aAlfa;
     aAlfa = aAlfa + ")";
     |CONTROL_SIMPLE nPnt353, aAlfa, 0502, 0598, NULL;

     |HAZ ActualizaMod;

     |PINDA #0#dsm35301;

     nRango = 2 + 4 + 8 + 32 + 128;
     |LINEAL_SIMPLE #1#dsm35302, nRango, 1002, 2297, Baja02, Alta02, Evt02;
     nGrid = FSalida;

     |SI enTipoEntrada = 1;
         |HAZ PintaBtns;
     |FINSI;

     aEsc1      = &255 + "806";
     aEsc2      = &255 + "807";
     aRetu      = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |SI enTipoEntrada = 4;
         |ACABA;
     |FINSI;

     |HAZ ActualizaMod;

     |GRABA 020#dsm35301.a;
     |LIBERA #dsm35301;

     |ABRE #dsmom004;
     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = enEjer;
     #dsmom004#2 = enPeriodo;
     #dsmom004#3 = enModelo;
     #dsmom004#4 = enComplem;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#7  = "X";
         #dsmom004#8  = ~;
         #dsmom004#15 = #dsm35301#13;
         #dsmom004#17 = "COMPLETADO";
         #dsmom004#23 = #dsm35301#8;
         aAlfa = #dsmom004#16;  |QBT aAlfa;
         |SI aAlfa ! "";
             |HAZ UltimoPeriodo;
             #dsmom004#16 = eaUltimoPer;
         |FINSI;

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;

     |PULSATECLA;

     |FINVENTANA n0Vent;
|FPRC;

|PROGRAMA;
     eaNomDef  = "dsm35301";

|| \\\\\\ Entrada del modelo

     |SI enTipoEntrada = 1;
         |ABRE #dsm32201;
         #dsm32201#0 = enEmpresa;
         #dsm32201#1 = enEjer;
         #dsm32201#2 = enPeriodo;
         #dsm32201#3 = 322;
         #dsm32201#4 = enComplem;
         #dsm32201#5 = 0;
         |LEE 000#dsm32201.=;
         |SI FSalida ! 0;
             |MENAV "0000Modelo 322 de la entidad dominante sin realizar.";
             |CIERRA #dsm32201;
             |ACABA;
         |FINSI;
         |CIERRA #dsm32201;

         #dsm35301#0 = enEmpresa;
         #dsm35301#1 = enEjer;
         #dsm35301#2 = enPeriodo;
         #dsm35301#3 = enModelo;
         #dsm35301#4 = enComplem;
         #dsm35301#5 = 0;
         |LEE 101#dsm35301.=;
         |SI FSalida ! 0;
             #dsm35301#0 = enEmpresa;
             #dsm35301#1 = enEjer;
             #dsm35301#2 = enPeriodo;
             #dsm35301#3 = enModelo;
             #dsm35301#4 = enComplem;
             #dsm35301#5 = 0;
             #dsm35301#6 = #dsm32201#6;
             #dsm35301#7 = #dsm32201#9;
             #dsm35301#8 = #dsm32201#10;

             |HAZ DatosPeriodoAnt;

             |SI aImpreso ! "X";
                 |MENAV "0000El periodo anterior no est  impreso.";
                 |ACABA;
             |FINSI;

             |GRABA 020#dsm35301.b;
         |FINSI;

         |HAZ TraeteDatos;
         |HAZ MontaPantalla;
     |FINSI;

|| \\\\\\ Consulta del modelo

     |SI enTipoEntrada = 4;
         #dsm35301#0 = enEmpresa;
         #dsm35301#1 = enEjer;
         #dsm35301#2 = enPeriodo;
         #dsm35301#3 = enModelo;
         #dsm35301#4 = enComplem;
         #dsm35301#5 = 0;
         |LEE 000#dsm35301.=;
         |SI FSalida ! 0;
             |MENAV "0000No existe modelo";
             |ACABA;
         |FINSI;

         |HAZ MontaPantalla;
     |FINSI;

|| \\\\\\ Baja del modelo

     |SI enTipoEntrada = 3;
         #dsm35301#0 = enEmpresa;
         #dsm35301#1 = enEjer;
         #dsm35301#2 = enPeriodo;
         #dsm35301#3 = enModelo;
         #dsm35301#4 = enComplem;
         #dsm35301#5 = 0;
         |LEE 101#dsm35301.=;
         |SI FSalida = 0;
             |BORRA 020#dsm35301.a;
             |LIBERA #dsm35301;
         |FINSI;

         |BUCLE dsm35302B;

         |ABRE #dsmom004;
         #dsmom004#0 = enEmpresa;
         #dsmom004#1 = enEjer;
         #dsmom004#2 = enPeriodo;
         #dsmom004#3 = enModelo;
         #dsmom004#4 = enComplem;
         |LEE 101#dsmom004.=;
         |SI FSalida = 0;
             #dsmom004#7  = "";
             #dsmom004#8  = "01.01.0000";
             #dsmom004#15 = 0;
             #dsmom004#17 = "SIN DATOS";

             |GRABA 020#dsmom004.a;
             |LIBERA #dsmom004;
         |FINSI;
         |CIERRA #dsmom004;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         #dsm35301#0 = enEmpresa;
         #dsm35301#1 = enEjer;
         #dsm35301#2 = enPeriodo;
         #dsm35301#3 = enModelo;
         #dsm35301#4 = enComplem;
         #dsm35301#5 = enActividad;
         |LEE 040#dsm35301.=;
         |SI FSalida ! 0;  enExistencia = 1;  |DDEFECTO #dsm35301; |FINSI;

         |SI enActividad = 0;  enResultado = #dsm35301#13;  |FINSI;
     |FINSI;
|FPRO;

|PROCESO T80Fm35301;  |TIPO 80;
     aAlfa = PARAMETRO % 105;  enEmpresa     = aAlfa;
     aAlfa = PARAMETRO % 604;  enEjer        = aAlfa;
     aAlfa = PARAMETRO % 1002; enPeriodo     = aAlfa;
     aAlfa = PARAMETRO % 1203; enModelo      = aAlfa;
     aAlfa = PARAMETRO % 1502; enComplem     = aAlfa;
     aAlfa = PARAMETRO % 1702; enActividad   = aAlfa;
     aAlfa = PARAMETRO % 1902; enTipoEntrada = aAlfa;
     aAlfa = PARAMETRO % 2101; enExistencia  = aAlfa;
     aZ12  = "z" * 12;

     |ABRET #dsm35301;
     |ABRET #dsm35302;
|FPRC;

|PROCESO T90Fm35301;  |TIPO 90;
     |SI nGrid ! -1;
         |DESTRUYECONTROL nGrid;
     |FINSI;

     |CIERRAT #dsm35301;
     |CIERRAT #dsm35302;

     |HAZ FinalizaEnX;
|FPRC;
