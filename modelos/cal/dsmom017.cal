|FICHEROS;
     dsmom017 #17,MANTE;
     dsmom004 #4;
     dsmom008 #8;
     dsmom018 #18;
     dsmom068 #68;
     dsmom019 #19;
     dsmom020 #20;
     dsmom021 #21;
     dsmom039 #39;
     dsmoc131 #131;
     dsmoc310 #310;
     dsmom030 #30;
     dsmom041 #41;
     dsmom046 #46;

     dsmom901 #901;
     dsmow013 #999;

     :/basica/def/agicen14 #214;

     &regisnif@ #709;

     espejo1@ #1300;
|FIN;

|VARIABLES;
     aAlfa      = "";

     nTecla      = 0;
     nSw310      = 0;
     nSw131      = 0;
     nPer        = 0;
     nImporte    = 0;
     nImporte1   = 0;
     nImporte2   = 0;
     nImporte3   = 0;
     nPeriodo    = 0;
     nMod        = 0;
     nModelo     = 0;
     nSwEsta     = 0;
     nCampo1     = 0;
     nCampo2     = 0;
     nCampo3     = 0;
     nPorce      = 0;
     nBaseImpo   = 0;
     nCuota      = 0;
     nTotal      = 0;
     nGrupo      = 0;
     nDepar      = 0;
     nEjer       = 0;
     nAnyoEjer   = 0;
     nAnyoCompra = 0;
     nAnyoHasta  = 0;
     nCampo22    = 0;
     nCampo11    = 0;
     nCampo33    = 0;

     aTipo       = "";
     aPathModelo = "";
     aDef        = "";
     nTPRepar    = 0;
     nExRepar    = 0;
     nIgual      = 0;
     nSwCuotaNeg = 0;
     &swerror    = 0;
     &efDFecA    = @;
     &efHFecA    = @;
     nComplem    = 0;
     nDComplem   = 0;
     nHComplem   = 0;
     nTipoBaja   = 0;
     nSwCorrecto = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO VerComplementaria;
     nDComplem = 0;
     nHComplem = -1;

     #4#0 = #17#0;
     #4#1 = #17#1;
     #4#2 = nPer;
     #4#3 = nMod;
     #4#4 = 99;
     |LEE 040#4];
     |SI FSalida = 0;
         |LEE 041#4a;
     |SINO;
         |LEE 041#4u;
     |FINSI;
     |SI FSalida = 0; |Y #4#0 = #17#0; |Y #4#1 = #17#1;
          |Y #4#2 = nPer; |Y #4#3 = nMod;
         nHComplem = #4#4;
     |FINSI;
|FPRC;

|PROCESO BajaComentario;
     |BORRA 020#901a;
     |LIBERA #901;
|FPRC;

|DEFBUCLE dsmom901B;
     #901#1;
     ;
     #17#0, #17#1, #17#2, #17#3, 1;
     #17#0, #17#1, #17#2, #17#3, 99;
     be;
     NULL, BajaComentario;
|FIN;

|PROCESO BajaTrabajador;
     |BORRA 020#20a;
     |LIBERA #20;
|FPRC;

|DEFBUCLE dsmom020;
     #20#1;
     ;
     #17#0, #17#1, #17#2, #17#3, 000;
     #17#0, #17#1, #17#2, #17#3, 999;
     be;
     NULL, BajaTrabajador;
|FIN;

|PROCESO BajaElemFecha;
     |BORRA 020#39a;
     |LIBERA #39;
|FPRC;

|DEFBUCLE dsmom039;
     #39#1;
     ;
     #17#0, #17#1, #17#2, #17#3, 000;
     #17#0, #17#1, #17#2, #17#3, 999;
     be;
     NULL, BajaElemFecha;
|FIN;

|PROCESO BajaElemento;
     |BORRA 020#21a;
     |LIBERA #21;
|FPRC;

|DEFBUCLE dsmom021;
     #21#1;
     ;
     #17#0, #17#1, #17#2, #17#3, 000;
     #17#0, #17#1, #17#2, #17#3, 999;
     be;
     NULL, BajaElemento;
|FIN;

|PROCESO Baja131;
     nMod = 131;
     |ABRE #4;
     |HAZ VerComplementaria;
     |CIERRA #4;

     |SI nHComplem ! -1;
         |SI nTipoBaja = 0; nDComplem = nHComplem; |FINSI;

         |ABRE #8;
         |PARA nComplem = nDComplem; |SI nComplem [ nHComplem; |HACIENDO nComplem = nComplem + 1;
               |DDEFECTO #8;
               #8#0 = #17#0;
               #8#1 = #17#1;
               #8#2 = nPer;
               #8#3 = 131;
               #8#4 = nComplem;
               #8#5 = #17#3;
               |LEE 040#8=;
               |SI FSalida = 0;

                   enEmpresa     = #8#0;
                   enEjer        = #8#1;
                   enPeriodo     = #8#2;
                   enModelo      = #8#3;
                   enComplem     = #8#4;
                   enActividad   = #8#5;
                   eaComunidad   = #8#9;
                   eaComunero    = #8#10;
                   enTipoEntrada = 97;
                   |SUB_EJECUTA_NP "dsmoc131";

                   #8#0 = #17#0;
                   #8#1 = #17#1;
                   #8#2 = nPer;
                   #8#3 = 131;
                   #8#4 = nComplem;
                   #8#5 = #17#3;
                   |LEE 101#8=;

                   #8#11 = "SIN DATOS";
                   |GRABA 020#8a;
                   |LIBERA #8;

                   |ABRE #4;
                   #4#0 = #17#0;
                   #4#1 = #17#1;
                   #4#2 = nPer;
                   #4#3 = enModelo;
                   #4#4 = nComplem;
                   |LEE 101#4=;
                   |SI FSalida = 0;
                       |HAZ ChequeaSituacion;  || Esta en el PLB

                       |GRABA 020#4a;
                       |LIBERA #4;
                   |FINSI;
                   |CIERRA #4;
               |FINSI;
           |SIGUE;
           |CIERRA #8;
     |FINSI;
     enEmpresa   = #17#0;
     enEjer      = #17#1;
     enActividad = #17#3;
|FPRC;

|PROCESO Baja310_8;

     enEmpresa     = #4#0;
     enEjer        = #4#1;
     enPeriodo     = #4#2;
     enModelo      = nMod;
     enComplem     = #4#4;
     enActividad   = #17#3;
     enTipoEntrada = 97;
     |SUB_EJECUTA_NP "dsmoc310";

     |ABRE #8;
     #8#0 = #17#0;
     #8#1 = #17#1;
     #8#2 = nPer;
     #8#3 = nMod;
     #8#4 = #4#4;
     #8#5 = #17#3;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS";
         |GRABA 020#8a;
         |LIBERA #8;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO Baja310;
     nMod = 310;
     |SI enEjer < 2014;
         |ABRE #8;
         |DDEFECTO #8;
         #8#0 = #17#0;
         #8#1 = #17#1;
         #8#2 = nPer;
         #8#3 = 370;
         #8#4 = 0;
         #8#5 = #17#3;
         |LEE 040#8=;
         |SI FSalida = 0;  nMod = 370;  |FINSI;
         |CIERRA #8;
     |SINO;
          nMod = 303;
     |FINSI;

     |ABRE #4;
     |HAZ VerComplementaria;
     |SI nHComplem ! -1;  || ... Existe modelo

         |SI nTipoBaja = 0; nDComplem = nHComplem; |FINSI;

         |PARA nComplem = nDComplem; |SI nComplem [ nHComplem; |HACIENDO nComplem = nComplem + 1;
               #4#0 = #17#0;
               #4#1 = #17#1;
               #4#2 = nPer;
               #4#3 = nMod;
               #4#4 = nComplem;
               |LEE 141#4=;
               |SI FSalida = 0;
                   |HAZ Baja310_8;

                   |HAZ ChequeaSituacion;  || Esta en el PLB

                   |GRABA 020#4a;
                   |LIBERA #4;
               |FINSI;
         |SIGUE;
     |FINSI;
     |CIERRA #4;

     enEmpresa   = #17#0;
     enEjer      = #17#1;
     enActividad = #17#3;
|FPRC;

|PROCESO BajaModulo;
     nSw310 = 0;
     nSw131 = 0;
                         nMod = 310;
     |SI enEjer ] 2014;  nMod = 303;  |FINSI;

     |ABRE #4;

     |PARA nPer = 3;  |SI nPer [ 12;  |HACIENDO nPer = nPer + 3;

           |DDEFECTO #4;
           #4#0 = #17#0;
           #4#1 = #17#1;
           #4#2 = nPer;
           #4#3 = nMod;
           #4#4 = 99;
           |LEE 040#4];
           |SI FSalida = 0;
               |LEE 041#4a;
           |SINO;
               |LEE 041#4u;
           |FINSI;
           |SI FSalida ! 0; |O #4#0 ! #17#0; |O #4#1 ! #17#1;
                 |O #4#2 ! nPer; |O #4#3 ! nMod;

               #4#0 = #17#0;
               #4#1 = #17#1;
               #4#2 = nPer;
               #4#3 = 370;
               #4#4 = 99;
               |LEE 040#4];
               |SI FSalida = 0;
                   |LEE 041#4a;
               |SINO;
                   |LEE 041#4u;
               |FINSI;
               |SI FSalida ! 0; |O #4#0 ! #17#0; |O #4#1 ! #17#1;
                    |O #4#2 ! nPer; |O #4#3 ! 370;
                   |DDEFECTO #4;
               |FINSI;
           |FINSI;

           |SI #4#9  = "X";  nSw310 = 2;  |FINSI;
           |SI #4#11 = "X";  nSw310 = 1;  |FINSI;
           |SI #4#13 = "X";  nSw310 = 1;  |FINSI;
     |SIGUE;

     |PARA nPer = 3;  |SI nPer [ 12;  |HACIENDO nPer = nPer + 3;
           #4#0 = #17#0;
           #4#1 = #17#1;
           #4#2 = nPer;
           #4#3 = 131;
           #4#4 = #17#2;
           |LEE 040#4];
           |SI FSalida = 0;
               |LEE 041#4a;
           |SINO;
               |LEE 041#4u;
           |FINSI;
           |SI FSalida ! 0; |O #4#0 ! #17#0; |O #4#1 ! #17#1;
                 |O #4#2 ! nPer; |O #4#3 ! 131;
               |DDEFECTO #4;
           |FINSI;

           |SI #4#9  = "X";  nSw131 = 2;  |FINSI;
           |SI #4#11 = "X";  nSw131 = 1;  |FINSI;
           |SI #4#13 = "X";  nSw131 = 1;  |FINSI;
     |SIGUE;

     |CIERRA #4;

     |SI nSw310 = 1;  |O nSw131 = 1;
         |MENAV "     Modelo ya Remesado o Archivado. No se puede Modificar";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI nSw310 = 2;  |O nSw131 = 2;
         |CONFI "0000NModelo ya Impreso, Esta Seguro de la Baja : ";
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;
     |SINO;
         |CONFI "0000N Esta Seguro de la Baja : ";
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |LEE 101#17=;
     |SI FSalida = 0;
         #17#9  = "N";
         #17#10 = "N";
         #17#11 = "N";
         #17#13 = "SIN DATOS";
         #17#15 = 0;
         #17#16 = 0;
         #17#17 = 0;
         #17#18 = 0;
         #17#19 = 0;
         #17#20 = 0;
         #17#21 = 0;
         #17#22 = 0;
         #17#23 = 0;
         #17#24 = 0;
         |GRABA 020#17a;
     |FINSI;
     |LIBERA #17;

     |BUCLE dsmom020;
     |BUCLE dsmom021;
     |BUCLE dsmom039;

     |ABRE #18;
     #18#0 = #17#0;
     #18#1 = #17#1;
     #18#2 = #17#2;
     #18#3 = #17#3;
     |LEE 101#18=;
     |SI FSalida = 0;
         |BORRA 020#18a;
         |LIBERA #18;
     |FINSI;
     |CIERRA #18;
     |SI #17#1 ] 2011;
         |ABRE #68;
         #68#0 = #17#0;
         #68#1 = #17#1;
         #68#2 = #17#2;
         #68#3 = #17#3;
         |LEE 101#68=;
         |SI FSalida = 0;
             |BORRA 020#68a;
             |LIBERA #68;
         |FINSI;
         |CIERRA #68;
     |FINSI;

     |ABRE #19;
     #19#0 = #17#0;
     #19#1 = #17#1;
     #19#2 = #17#2;
     #19#3 = #17#3;
     |LEE 101#19=;
     |SI FSalida = 0;
         |BORRA 020#19a;
         |LIBERA #19;
     |FINSI;
     |CIERRA #19;

     nTipoBaja = 1;
     |PARA nPer = 3;  |SI nPer [ 12;  |HACIENDO nPer = nPer + 3;
           |HAZ Baja310;
     |SIGUE;

     |PARA nPer = 3;  |SI nPer [ 12;  |HACIENDO nPer = nPer + 3;
           |HAZ Baja131;
     |SIGUE;

     |BUCLE dsmom901B;
     nTipoBaja = 0;
|FPRC;

|PROCESO GrabaTrabajo131;
     enEmpresa   = #17#0;
     enEjer      = #17#1;
     enActividad = #17#3;
     nPeriodo    = enPeriodo;
     nPer        = nPeriodo;

     nMod = 131;
     |ABRE #4;
     |HAZ VerComplementaria;
     |CIERRA #4;
     |SI nHComplem = -1;  |ACABA;  |FINSI;  || ... No existe modelo

     nComplem = nHComplem;
     |SI enEjer < 2014; nComplem = 0; |FINSI;  || Actualizaba siempre el 0

     |ABRE #131;
     #131#0 = enEmpresa;
     #131#1 = enEjer;
     #131#2 = enPeriodo;
     #131#3 = 131;
     #131#4 = nComplem;
     #131#5 = enActividad;
     |LEE 101#131=;
     |SI FSalida ! 0;
         |DDEFECTO #131;
         #131#0 = enEmpresa;
         #131#1 = enEjer;
         #131#2 = enPeriodo;
         #131#3 = 131;
         #131#4 = nComplem;
         #131#5 = enActividad;
         |GRABA 020#131b;
     |FINSI;

     #131#6  = #17#5;
     #131#7  = #17#8;
     #131#8  = #17#12;
     |SI #17#12 = "N";
         #131#9  = nImporte1;
         #131#10 = nImporte2;
         #131#11 = nImporte3;
     |FINSI;
     |GRABA 020#131a;
     |LIBERA #131;
     |CIERRA #131;

     enEmpresa     = #17#0;
     enEjer        = #17#1;
     enActividad   = #17#3;
     enTipoEntrada = 98;
     enModelo      = 131;
     enComplem     = nComplem;
     |SUB_EJECUTA_NP "dsmoc131";

     enEmpresa     = #17#0;
     enEjer        = #17#1;
     enActividad   = #17#3;
     enModelo      = 131;
     enComplem     = nComplem;
     enPeriodo     = nPeriodo;

     |ABRE #8;
     #8#0 = #17#0;
     #8#1 = #17#1;
     #8#2 = enPeriodo;
     #8#3 = 131;
     #8#4 = nComplem;
     #8#5 = #17#3;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "COMPLETADO";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;

     |ABRE #4;
     #4#0 = #17#0;
     #4#1 = #17#1;
     #4#2 = enPeriodo;
     #4#3 = 131;
     #4#4 = nComplem;
     |LEE 101#4=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO Grabamoc131;
     |ABRE #18;
     #18#0 = #17#0;
     #18#1 = #17#1;
     #18#2 = #17#2;
     #18#3 = #17#3;
     |LEE 040#18=;
     |SI FSalida ! 0;  |CIERRA #18;  |ACABA;  |FINSI;
     |CIERRA #18;

     |SI #18#120 = 0;  |Y #18#121 = 0;
         #18#107 = 0;
         #18#108 = 0;
         #18#109 = 0;
         #18#110 = 0;
     |FINSI;

     |ABRE #131;
     |SI #18#107 ! 0;
         |SI #18#129 = "N";
             enPeriodo = 3;
             nImporte1 = #18#122;
             nImporte2 = #18#119;
             nImporte3 = #18#125;
             |HAZ GrabaTrabajo131;
         |FINSI;
     |SINO;
         nPer = 3;
         |HAZ Baja131;
     |FINSI;

     |SI #18#108 ! 0;
         |SI #18#130 = "N";
             enPeriodo = 6;
             nImporte1 = #18#122;
             nImporte2 = #18#119;
             nImporte3 = #18#126;
             |HAZ GrabaTrabajo131;
         |FINSI;
     |SINO;
         nPer = 6;
         |HAZ Baja131;
     |FINSI;

     |SI #18#109 ! 0;
         |SI #18#131 = "N";
             enPeriodo = 9;
             nImporte1 = #18#122;
             nImporte2 = #18#119;
             nImporte3 = #18#127;
             |HAZ GrabaTrabajo131;
         |FINSI;
     |SINO;
         nPer = 9;
         |HAZ Baja131;
     |FINSI;

     |SI #18#110 ! 0;
         |SI #18#132 = "N";
             enPeriodo = 12;
             nImporte1 = #18#122;
             nImporte2 = #18#119;
             nImporte3 = #18#128;
             |HAZ GrabaTrabajo131;
         |FINSI;
     |SINO;
         nPer = 12;
         |HAZ Baja131;
     |FINSI;
     |CIERRA #131;
|FPRC;

|PROCESO GrabaTrabajo310;
     nMod = 310;
     |SI enEjer < 2014;
         |ABRE #8;
         #8#0 = #17#0;
         #8#1 = #17#1;
         #8#2 = enPeriodo;
         #8#3 = 370;
         #8#4 = 0;
         #8#5 = #17#3;
         |LEE 040#8=;
         |SI FSalida = 0;  nMod = 370;  |FINSI;
         |CIERRA #8;
     |SINO;
          nMod = 303;
     |FINSI;

     nPer = enPeriodo;
     swerror = 0;
     |ABRE #4;
     |HAZ VerComplementaria;
     |CIERRA #4;
     |SI nHComplem = -1;  |ACABA;  |FINSI;  || ... No existe modelo

     nComplem = nHComplem;
     |SI enEjer < 2014; nComplem = 0; |FINSI;  || Actualizaba siempre el 0

     |SI enPeriodo = 12;
         #999#0  = enEmpresa;
         #999#1  = enActividad;
         #999#2  = enEjer;
         #999#3  = enPeriodo;
         #999#6  = "";
         #999#7  = nMod;
         #999#8  = "S";
         #999#9  = nComplem;
         #999#10 = 310;
         |SI nSwCorrecto = 0;
             |HAZ Pase310;
         |FINSI;

         |SI swerror = 0;
             |ABRE #8;
             #8#0 = #17#0;
             #8#1 = #17#1;
             #8#2 = enPeriodo;
             #8#3 = nMod;
             #8#4 = nComplem;
             #8#5 = #17#3;
             |LEE 040#8=;
             |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
             |CIERRA #8;

             |SI #8#7 ! "REGISTROS ";
                 |ABRE #310;
                 #310#0 = enEmpresa;
                 #310#1 = enEjer;
                 #310#2 = enPeriodo;
                 #310#3 = nMod;
                 #310#4 = nComplem;
                 #310#5 = enActividad;
                 |LEE 101#310=;
                 |SI FSalida ! 0;
                     |DDEFECTO #310;
                     #310#0 = enEmpresa;
                     #310#1 = enEjer;
                     #310#2 = enPeriodo;
                     #310#3 = nMod;
                     #310#4 = nComplem;
                     #310#5 = enActividad;
                     |GRABA 020#310b;
                 |FINSI;

                 #310#6 = #17#5;
                 #310#7 = #17#8;
                 #310#8 = #17#12;
                 #310#9 = nImporte;
                 |GRABA 020#310a;
                 |LIBERA #310;
                 |CIERRA #310;

                 enTipoEntrada = 98;
                 enModelo      = nMod;
                 enComplem     = nComplem;
                 |SUB_EJECUTA_NP "dsmoc310";

                 |ABRE #4;
                 #4#0 = #17#0;
                 #4#1 = #17#1;
                 #4#2 = enPeriodo;
                 #4#3 = nMod;
                 #4#4 = nComplem;
                 |LEE 101#4=;
                 |SI FSalida = 0;
                     |HAZ ChequeaSituacion;  || Esta en el PLB

                     |GRABA 020#4a;
                     |LIBERA #4;
                 |FINSI;
                 |CIERRA #4;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI enPeriodo ! 12; |O swerror = 1;
         |ABRE #310;

         #310#0 = enEmpresa;
         #310#1 = enEjer;
         #310#2 = enPeriodo;
         #310#3 = nMod;
         #310#4 = nComplem;
         #310#5 = enActividad;
         |LEE 101#310=;
         |SI FSalida ! 0;
             |DDEFECTO #310;
             #310#0 = enEmpresa;
             #310#1 = enEjer;
             #310#2 = enPeriodo;
             #310#3 = nMod;
             #310#4 = nComplem;
             #310#5 = enActividad;
             |GRABA 020#310b;
         |FINSI;

         #310#6 = #17#5;
         #310#7 = #17#8;
         #310#8 = #17#12;
         #310#9 = nImporte;
         |GRABA 020#310a;
         |LIBERA #310;
         |CIERRA #310;

         enTipoEntrada = 98;
         enModelo      = nMod;
         enComplem     = nComplem;
         |SUB_EJECUTA_NP "dsmoc310";

         |ABRE #4;
         #4#0 = #17#0;
         #4#1 = #17#1;
         #4#2 = enPeriodo;
         #4#3 = nMod;
         #4#4 = nComplem;
         |LEE 101#4=;
         |SI FSalida = 0;
             |HAZ ChequeaSituacion;  || Esta en el PLB

             |GRABA 020#4a;
             |LIBERA #4;
         |FINSI;
         |CIERRA #4;

     |FINSI;
|FPRC;

|PROCESO MiroCorrecto;
     nSwCorrecto = 0;

     nMod = 303; |SI enEjer < 2014; |ACABA; |FINSI;
     nPer    = enPeriodo;

     |ABRE #4;
     |HAZ VerComplementaria;
     |CIERRA #4;
     |SI nHComplem = -1;  |ACABA;  |FINSI;  || ... No existe modelo
     nComplem = nHComplem;

     |ABRE #8;
     #8#0 = #17#0;
     #8#1 = #17#1;
     #8#2 = enPeriodo;
     #8#3 = nMod;
     #8#4 = nComplem;
     #8#5 = #17#3;
     |LEE 040#8=;
     |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
     |CIERRA #8;

     |SI #8#7 ! "REGISTROS ";
         |ABRE #310;
         #310#0 = enEmpresa;
         #310#1 = enEjer;
         #310#2 = enPeriodo;
         #310#3 = nMod;
         #310#4 = nComplem;
         #310#5 = enActividad;
         |LEE 101#310=;
         |SI FSalida ! 0; |O #310#9 = 0;
             nSwCorrecto = 1;
         |FINSI;
         |CIERRA #310;
     |FINSI;
|FPRC;

|PROCESO Grabamoc310;
     |ABRE #19;
     #19#0 = #17#0;
     #19#1 = #17#1;
     #19#2 = #17#2;
     #19#3 = #17#3;
     |LEE 040#19=;
     |SI FSalida ! 0;  |CIERRA #19;  |ACABA;  |FINSI;
     |CIERRA #19;

     |SI #19#117 = 0;  |Y #19#118 = 0;
        |Y #19#161 = 0;  |Y #19#163 = 0;   ||Importes de la Reduccion de Lorca
         #19#107 = 0;
         #19#108 = 0;
         #19#109 = 0;
         #19#110 = 0;
     |FINSI;

     |ABRE #310;
     |SI #19#107 ! 0;
         nSwCorrecto = 0;
         enPeriodo   = 3;
         |SI #19#143 = "S"; |Y #17#12 = "N";  |HAZ MiroCorrecto;  |FINSI;
         |SI #19#143 = "N"; |O nSwCorrecto = 1;
                               nImporte  = #19#139;
             |SI #19#148 ! 0;  nImporte  = #19#148;  |FINSI;
             |HAZ GrabaTrabajo310;
         |FINSI;
     |SINO;
         nPer = 3;
         |HAZ Baja310;
     |FINSI;

     |SI #19#108 ! 0;
         nSwCorrecto = 0;
         enPeriodo   = 6;
         |SI #19#144 = "S"; |Y #17#12 = "N";  |HAZ MiroCorrecto;  |FINSI;
         |SI #19#144 = "N"; |O nSwCorrecto = 1;
                               nImporte  = #19#140;
             |SI #19#149 ! 0;  nImporte  = #19#149;  |FINSI;
             |HAZ GrabaTrabajo310;
         |FINSI;
     |SINO;
         nPer = 6;
         |HAZ Baja310;
     |FINSI;

     |SI #19#109 ! 0;
         nSwCorrecto = 0;
         enPeriodo   = 9;
         |SI #19#145 = "S"; |Y #17#12 = "N";  |HAZ MiroCorrecto;  |FINSI;
         |SI #19#145 = "N"; |O nSwCorrecto = 1;
                               nImporte  = #19#141;
             |SI #19#150 ! 0;  nImporte  = #19#150;  |FINSI;
             |HAZ GrabaTrabajo310;
         |FINSI;
     |SINO;
         nPer = 9;
         |HAZ Baja310;
     |FINSI;

     |SI #19#116 ! 0;
         nSwCorrecto = 0;
         enPeriodo = 12;
         |SI #19#146 = "S"; |Y #17#12 = "N";  |HAZ MiroCorrecto;  |FINSI;
         |SI #19#146 = "N"; |O nSwCorrecto = 1;
             nImporte  = #19#142;
             |HAZ GrabaTrabajo310;
         |FINSI;
     |SINO;
         nPer = 12;
         |HAZ Baja310;
     |FINSI;
     |CIERRA #310;
|FPRC;

|PROCESO Tipo12m017;  |TIPO 12;
|FPRC;

|PROCESO GrabaEstado19;
     #19#0 = #17#0;
     #19#1 = #17#1;
     #19#2 = #17#2;
     #19#3 = #17#3;
     |LEE 101#19=;
     |SI FSalida ! 0;
         |DDEFECTO #19;
         #19#0 = #17#0;
         #19#1 = #17#1;
         #19#2 = #17#2;
         #19#3 = #17#3;
         |GRABA 020#19b;
     |FINSI;

     |SI nPer = 3;   #19#143 = aAlfa;  |FINSI;
     |SI nPer = 6;   #19#144 = aAlfa;  |FINSI;
     |SI nPer = 9;   #19#145 = aAlfa;  |FINSI;
     |SI nPer = 12;  #19#146 = aAlfa;  |FINSI;

     |GRABA 020#19a;
     |LIBERA #19;
|FPRC;

|PROCESO GrabaEstado18;
     #18#0 = #17#0;
     #18#1 = #17#1;
     #18#2 = #17#2;
     #18#3 = #17#3;
     |LEE 101#18=;
     |SI FSalida ! 0;
         |DDEFECTO #18;
         #18#0 = #17#0;
         #18#1 = #17#1;
         #18#2 = #17#2;
         #18#3 = #17#3;
         |GRABA 020#18b;
     |FINSI;

     |SI nPer = 3;   #18#129 = aAlfa;  |FINSI;
     |SI nPer = 6;   #18#130 = aAlfa;  |FINSI;
     |SI nPer = 9;   #18#131 = aAlfa;  |FINSI;
     |SI nPer = 12;  #18#132 = aAlfa;  |FINSI;

     |GRABA 020#18a;
     |LIBERA #18;
|FPRC;

|PROCESO Tipo11m017;  |TIPO 11;
     nTecla = FSalida;
     |SI nTecla ! 10;  |Y nTecla ! 16;  |Y nTecla ! 11;  |ACABA;  |FINSI;

     |SI nTecla = 11;
         |SI #17#12 = "S";
             |MENAV "     No hay desgloses en Agricolas";
             |HAZ Refresco;
             |ACABA;
         |FINSI;

         |C_M #17#9,  1, "S";
         |C_M #17#10, 1, "S";
         |C_M #17#11, 1, "S";

         |LEE 101#17=;
         ||  |ENDATOS #1#17;

     |ET Campo06;  |ENCAMPO #6#17;
                   |SI FSalida = 1;  FSalida = 0; |VETE Abajo;   |FINSI;
                   |SI FSalida = 7;  |VETE Abajo;   |FINSI;
                   |SI FSalida = 2;  |VETE Campo06; |FINSI;

     |ET Campo09;  |ENCAMPO #9#17;
                   |SI FSalida = 1;  FSalida = 0; |VETE Abajo;   |FINSI;
                   |SI FSalida = 7;  |VETE Abajo;   |FINSI;
                   |SI FSalida = 2;  |VETE Campo06; |FINSI;

     |ET Campo10;  |ENCAMPO #10#17;
                   |SI FSalida = 1;  FSalida = 0; |VETE Abajo;   |FINSI;
                   |SI FSalida = 7;  |VETE Abajo;   |FINSI;
                   |SI FSalida = 2;  |VETE Campo09; |FINSI;

                   |ENCAMPO #11#17;
                   |SI FSalida = 1;  FSalida = 0; |VETE Abajo;   |FINSI;
                   |SI FSalida = 2;  |VETE Campo10; |FINSI;

     |ET Abajo;

         |SI FSalida = 0;
             |GRABA 020#17a;
         |FINSI;
         |LIBERA #17;

         |HAZ Refresco;

         |C_M #17#9,  1, "N";
         |C_M #17#10, 1, "N";
         |C_M #17#11, 1, "N";
         |ACABA;
     |FINSI;

     |SI nTecla = 16;
         |HAZ BajaModulo;
         |HAZ Refresco;
         |ACABA;
     |FINSI;

                         nMod = 310;
     |SI enEjer ] 2014;  nMod = 303;  |FINSI;

     |ABRE #4;
     |ABRE #19;
     |PARA nPer = 3;  |SI nPer [ 12;  |HACIENDO nPer = nPer + 3;
           #4#0 = #17#0;
           #4#1 = #17#1;
           #4#2 = nPer;
           #4#3 = nMod;
           #4#4 = 99;
           |LEE 040#4];
           |SI FSalida = 0;
               |LEE 041#4a;
           |SINO;
               |LEE 041#4u;
           |FINSI;
           |SI FSalida = 0; |Y #4#0 = #17#0; |Y #4#1 = #17#1;
                |Y #4#2 = nPer; |Y #4#3 = nMod;
               aAlfa = "N";
               |SI #4#9  = "X";  aAlfa = "S";  |FINSI;

               |HAZ GrabaEstado19;
           |SINO;
               #4#0 = #17#0;
               #4#1 = #17#1;
               #4#2 = nPer;
               #4#3 = 370;
               #4#4 = 99;
               |LEE 040#4];
               |SI FSalida = 0;
                   |LEE 041#4a;
               |SINO;
                   |LEE 041#4u;
               |FINSI;
               |SI FSalida = 0; |Y #4#0 = #17#0; |Y #4#1 = #17#1;
                    |Y #4#2 = nPer; |Y #4#3 = 370;
                   aAlfa = "N";
                   |SI #4#9  = "X";  aAlfa = "S";  |FINSI;

                   |HAZ GrabaEstado19;
               |FINSI;
           |FINSI;
     |SIGUE;
     |CIERRA #19;

     |ABRE #18;
     |PARA nPer = 3;  |SI nPer [ 12;  |HACIENDO nPer = nPer + 3;
           #4#0 = #17#0;
           #4#1 = #17#1;
           #4#2 = nPer;
           #4#3 = 131;
           #4#4 = 99;
           |LEE 040#4];
           |SI FSalida = 0;
               |LEE 041#4a;
           |SINO;
               |LEE 041#4u;
           |FINSI;
           |SI FSalida = 0; |Y #4#0 = #17#0; |Y #4#1 = #17#1;
                 |Y #4#2 = nPer; |Y #4#3 = 131;

               aAlfa = "N";
               |SI #4#9  = "X";  aAlfa = "S";  |FINSI;

               |HAZ GrabaEstado18;
           |FINSI;
     |SIGUE;
     |CIERRA #18;
     |CIERRA #4;

     enEmpresa   = #17#0;
     enActividad = #17#3;
     eaCodEpi2   = #17#5;
     enCodEpi3   = #17#6;
     enEjer      = #17#1;
     eaNombreEmp = #17#7;
     eaNombreAct = #17#8;
     eaDesTrab   = #17#9;
     eaDesElem   = #17#10;
     eaDesInve   = #17#11;
     eaAgricola  = #17#12;
     enDiaTrimP1 = #17#15;
     enDiaTrimP2 = #17#16;
     enDiaTrimP3 = #17#17;
     enDiaTrimP4 = #17#18;
     enDiaTrimD1 = #17#20;
     enDiaTrimD2 = #17#21;
     enDiaTrimD3 = #17#22;
     enDiaTrimD4 = #17#23;

     aAlfa    = "01.01." + enEjer;  efFechaI = aAlfa;
     aAlfa    = "31.12." + enEjer;  efFechaF = aAlfa;

     |ABRE #214;
     |DDEFECTO #214;
     #214#0 = enEmpresa;
     #214#1 = enActividad;
     |LEE 001#214=;
     |CIERRA #214;
     |SI #214#5 > efFechaI; efFechaI = #214#5; |FINSI;
     |SI #214#6 < efFechaF;  |Y #214#6 > "01.01.0000";
         efFechaF = #214#6;
     |FINSI;
     efDFecA = #214#5;
     efHFecA = #214#6;

     |SUB_EJECUTA_NP "dsmoz006";

     |LEE 101#17=;
     |SI FSalida = 0;
         #17#15 = enDiaTrimP1;
         #17#16 = enDiaTrimP2;
         #17#17 = enDiaTrimP3;
         #17#18 = enDiaTrimP4;
         #17#19 = #17#15 + #17#16 + #17#17 + #17#18;

         #17#20 = enDiaTrimD1;
         #17#21 = enDiaTrimD2;
         #17#22 = enDiaTrimD3;
         #17#23 = enDiaTrimD4;
         #17#24 = #17#20 + #17#21 + #17#22 + #17#23;
         #17#9  = eaDesTrab;
         #17#10 = eaDesElem;
         #17#11 = eaDesInve;

         #17#13 = "EXISTENTE";  |PINTA #17#13;

         |GRABA 020#17a;

         |HAZ Grabamoc310;
         |HAZ Grabamoc131;
    |FINSI;
    |LIBERA #17;

    |HAZ Refresco;
|FPRC;
