|FICHEROS;
     dsmoy000;
     dsmom107;

     dsmom004;
     dsm32201;
     dsm32204;
     dsm32205;

     dsmow014;

     t1832201;
     t1832202;
     t1832203;

     dsmow142;

     &regisnif@;
     &clientes@;
     &datosper@;

|FIN;

|VARIABLES;
     nConta      = 0;
     nReg        = 0;
     nColumna    = 0;
     nPagHoja2   = 0;

     nSwHoja3   = 0;
     nSw        = 0;
     nSwCara    = 0;
     &enSwLinea = 0;
     &enBase    = 0;
     &enCuota   = 0;
     &enPorce   = 0;
     &aText     = "";
     &aTexr     = "";
     &aDescr    = "";
     &enBaseI   = 0;
     &enCuotaI  = 0;
     &enPorceI  = 0;
     &eaCiudad  = "";
     nIVA17     = 0;
     nIVA20     = 0;
     nIVA23     = 0;
     nIVA32     = 0;
     nIVA35     = 0;
     nIVA38     = 0;
     nIVA25     = 0;
     nIVA28     = 0;
     nIVA31     = 0;
     nSubeIVA   = 0;
     nGrupo     = 0;
     nSubGrupo  = 0;
     nMas       = 0;
     nPara1     = 0;
     nPara2     = 0;
     nPara3     = 0;
     nCampo1    = 0;
     nCampo2    = 0;
     nCampo3    = 0;
     nPrimero   = 0;
     nBaseImpo  = 0;
     nPorce     = 0;
     nCuota     = 0;
     nCasilla    = 0;
     nContaTotal = 0;
     nError      = 0;

     fFechaHoy  = @;
|FIN;

|INCLUYE i_varemi;

|PROCESO t1832201ptrl;
     |PARA nCampo = 1;  |SI nCampo [ 86;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #t1832201#nCampo#;
           |XGRABA enHandlePortal, eaAlfa;
     |SIGUE;
|FPRC;

|PROCESO t1832202ptrl;
     |PARA nCampo = 1;  |SI nCampo [ 61;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #t1832202#nCampo#;
           |XGRABA enHandlePortal, eaAlfa;
     |SIGUE;
|FPRC;

|PROCESO t1832203;
     |PARA nCampo = 1;  |SI nCampo [ 69;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #t1832203#nCampo#;
           |XGRABA enHandlePortal, eaAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE t1832203;
     #t1832203#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, t1832203;
|FIN;

|PROCESO t1832203ptrl;
     |SI nSwHoja3 = 1;
        |BUCLE t1832203;
     |SINO;
         |DDEFECTO #t1832203;
         |HAZ t1832203;
     |FINSI;
|FPRC;

|PROCESO AbrePag_8312_2018;
     eaPathAEAT = eaUnidadBasico + "\AEAT";        |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\" + #dsmoy000#0;  |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\" + #dsmoy000#6;  |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\" + (("00" + #dsmoy000#4) % -102);  |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\";

     aAlfa = eaPathAEAT + "*.*";  |QBT aAlfa;
     |R_PDIR aAlfa;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            aAlfa1 = (aAlfa % -103) < "";
            |SI aAlfa1 ! "txt";
                |RFBORRA aAlfa;
            |FINSI;

            |R_SDIR aAlfa;
     |SIGUE;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathAEAT + eaFicheroPlano;
     |HAZ CopiaFichero;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aAbre = eaPathAEAT + "imp" + Usuario + ".bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     eaAlfa = eaPathExplorador + " ";
     |HAZ GrabaPortalSin;

     eaAlfa = &34 + "https://www1.agenciatributaria.gob.es/static_files/common/internet/dep/aplicaciones/ov/servurlp.html";
     |HAZ GrabaPortalSin;

     eaAlfa = "?WEB=INTERNET&PRG=" + #dsmoy000#0;
     |HAZ GrabaPortalSin;

     eaAlfa = "&EJE=0003";
     |HAZ GrabaPortalSin;

     eaAlfa = "&URL=PIR" + &34 +  &13 + &10;
     |HAZ GrabaPortalSin;

     eaAlfa = "";
     |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     aAlfa = "0000Ubicacion: " + eaPathAEAT + &13 + &10;
     aAlfa = aAlfa  + " Fichero: " + eaFicheroPlano;
     |MENAV aAlfa;

     |RSYSTEM aAbre;
|FPRC;

|PROCESO PresentaModelo_03;
     |SI eaOpcion = "1";
         |HAZ GrabaImpreso;
     |FINSI;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             eaFOrigen  = eaPathEmision  + eaFicheroPlano;
             eaFDestino = eaPathInternet + eaFicheroPlano;
             |HAZ CopiaFichero;
         |FINSI;

         |SI enPresentar = 1;
             |HAZ AbrePag_8312_2018;
         |FINSI;

         |HAZ GrabaImpreso;
     |FINSI;

     |SI eaOpcion = "6";
         eaX002_10    = #t1832201#4;
         eaX002_11    = #t1832201#5;
         eaX002_12    = 322;
         eaX002_13    = #t1832201#7;
         eaX002_14    = #t1832201#8;

         |SI #dsm32201#4 > 0;
             eaX002_15 = "C";
             eaX002_16 = #t1832202#19;
         |FINSI;

         eaX002_38 = #dsm32201#6;
         eaX002_39 = #t1832201#10;
         eaX002_40 = #t1832201#11;
         eaX002_41 = #t1832201#12;
         eaX002_42 = #t1832201#13;
         eaX002_43 = #dsm32201#51;
         eaX002_44 = #dsm32201#75;
         eaX002_45 = #dsm32201#77;
         eaX002_46 = #dsm32201#83;
         eaX002_17 = #dsm32201#85;

         |HAZ PresentaPortal;
     |FINSI;
|FPRC;

|PROCESO PersonaFis2018;
     aAlfa = eaVarDni % 101;
     |SI aAlfa = "0"; |O aAlfa = "1"; |O aAlfa = "2"; |O aAlfa = "3";
      |O aAlfa = "4"; |O aAlfa = "5"; |O aAlfa = "6"; |O aAlfa = "7";
      |O aAlfa = "8"; |O aAlfa = "9"; |O aAlfa = "X"; |O aAlfa = "Y";
      |O aAlfa = "Z";
         eaAlfa = #clientes@#1;     |HAZ BuscaNombre;
         eaAlfa = eaAlfa1;    |HAZ QuitaRaros;     #t1832201#8   = eaAlfa;
         eaAlfa = eaAlfa2;    |HAZ QuitaRaros;     #t1832201#9   = eaAlfa;
      |SINO;
         eaAlfa   = #clientes@#1;    |HAZ QuitaRaros;    #t1832201#8   = eaAlfa;
                                                         #t1832201#9   = " ";
      |FINSI;
|FPRC;

|PROCESO Hoja1_2018;
     |DDEFECTO #t1832201;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;    #t1832201#4 = eaVarDni;
         eaAlfa   = #clientes@#1;  |HAZ QuitaRaros;      #t1832201#5 = eaAlfa;
     |SINO;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;   #t1832201#4 = eaVarDni;
         eaAlfa   = #clientes@#1;   |HAZ QuitaRaros;     #t1832201#5 = eaAlfa;
     |FINSI;

     #t1832201#7  = #dsm32201#1;

     |SI #dsmom004#22 = "T";
         |SI #dsm32201#2 = 3;   #t1832201#8 = "1T";  |FINSI;
         |SI #dsm32201#2 = 6;   #t1832201#8 = "2T";  |FINSI;
         |SI #dsm32201#2 = 9;   #t1832201#8 = "3T";  |FINSI;
         |SI #dsm32201#2 = 12;  #t1832201#8 = "4T";  |FINSI;
     |SINO;
         #t1832201#8 = ("00" + #dsm32201#2) % -102;
     |FINSI;

     #t1832201#9 = #dsm32201#6;

     |SI #dsm32201#7 = "1";   #t1832201#10 = "D";  |FINSI;
     |SI #dsm32201#7 = "2";   #t1832201#10 = "P";  |FINSI;

     #t1832201#11 = #dsm32201#8;

     |SI #dsm32201#9  = "S";   #t1832201#12 = "1";  |FINSI;
     |SI #dsm32201#9  = "N";   #t1832201#12 = "2";  |FINSI;

     |SI #dsm32201#10 = "S";   #t1832201#13 = "1";  |FINSI;
     |SI #dsm32201#10 = "N";   #t1832201#13 = "2";  |FINSI;

     |SI #dsm32201#11 = "S";   #t1832201#14 = "1";  |FINSI;
     |SI #dsm32201#11 = "N";   #t1832201#14 = "2";  |FINSI;

                               #t1832201#15 = "0";
     |SI #dsm32201#12 = "S";   #t1832201#15 = "1";  |FINSI;
     |SI #dsm32201#13 = "S";   #t1832201#15 = "2";  |FINSI;

     enNume = #dsm32201#14;   |HAZ Conver17;   #t1832201#16 = eaAlfa;
     enNume = #dsm32201#15 * 100;              #t1832201#17 = ("00000" + enNume) % -105;
     enNume = #dsm32201#16;   |HAZ Conver17;   #t1832201#18 = eaAlfa;
     enNume = #dsm32201#17;   |HAZ Conver17;   #t1832201#19 = eaAlfa;
     enNume = #dsm32201#18 * 100;              #t1832201#20 = ("00000" + enNume) % -105;
     enNume = #dsm32201#19;   |HAZ Conver17;   #t1832201#21 = eaAlfa;
     enNume = #dsm32201#20;   |HAZ Conver17;   #t1832201#22 = eaAlfa;
     enNume = #dsm32201#21 * 100;              #t1832201#23 = ("00000" + enNume) % -105;
     enNume = #dsm32201#22;   |HAZ Conver17;   #t1832201#24 = eaAlfa;

     enNume = #dsm32201#23;   |HAZ Conver17;   #t1832201#25 = eaAlfa;
     enNume = #dsm32201#24;   |HAZ Conver17;   #t1832201#26 = eaAlfa;

     enNume = #dsm32201#25;   |HAZ Conver17;   #t1832201#27 = eaAlfa;
     enNume = #dsm32201#26 * 100;              #t1832201#28 = ("00000" + enNume) % -105;
     enNume = #dsm32201#27;   |HAZ Conver17;   #t1832201#29 = eaAlfa;
     enNume = #dsm32201#28;   |HAZ Conver17;   #t1832201#30 = eaAlfa;
     enNume = #dsm32201#29 * 100;              #t1832201#31 = ("00000" + enNume) % -105;
     enNume = #dsm32201#30;   |HAZ Conver17;   #t1832201#32 = eaAlfa;
     enNume = #dsm32201#31;   |HAZ Conver17;   #t1832201#33 = eaAlfa;
     enNume = #dsm32201#32 * 100;              #t1832201#34 = ("00000" + enNume) % -105;
     enNume = #dsm32201#33;   |HAZ Conver17;   #t1832201#35 = eaAlfa;

     enNume = #dsm32201#34;   |HAZ Conver17;   #t1832201#36 = eaAlfa;
     enNume = #dsm32201#35;   |HAZ Conver17;   #t1832201#37 = eaAlfa;

     enNume = #dsm32201#36;   |HAZ Conver17;   #t1832201#38 = eaAlfa;
     enNume = #dsm32201#37;   |HAZ Conver17;   #t1832201#39 = eaAlfa;

     enNume = #dsm32201#38;   |HAZ Conver17;   #t1832201#40 = eaAlfa;
     enNume = #dsm32201#39;   |HAZ Conver17;   #t1832201#41 = eaAlfa;

     enNume = #dsm32201#40;   |HAZ Conver17;   #t1832201#42 = eaAlfa;
     enNume = #dsm32201#41 * 100;              #t1832201#43 = ("00000" + enNume) % -105;
     enNume = #dsm32201#42;   |HAZ Conver17;   #t1832201#44 = eaAlfa;
     enNume = #dsm32201#43;   |HAZ Conver17;   #t1832201#45 = eaAlfa;
     enNume = #dsm32201#44 * 100;              #t1832201#46 = ("00000" + enNume) % -105;
     enNume = #dsm32201#45;   |HAZ Conver17;   #t1832201#47 = eaAlfa;
     enNume = #dsm32201#46;   |HAZ Conver17;   #t1832201#48 = eaAlfa;
     enNume = #dsm32201#47 * 100;              #t1832201#49 = ("00000" + enNume) % -105;
     enNume = #dsm32201#48;   |HAZ Conver17;   #t1832201#50 = eaAlfa;

     enNume = #dsm32201#49;   |HAZ Conver17;   #t1832201#51 = eaAlfa;
     enNume = #dsm32201#50;   |HAZ Conver17;   #t1832201#52 = eaAlfa;

     enNume = #dsm32201#51;   |HAZ Conver17;   #t1832201#54 = eaAlfa;

     enNume = #dsm32201#52;   |HAZ Conver17;   #t1832201#55 = eaAlfa;
     enNume = #dsm32201#53;   |HAZ Conver17;   #t1832201#56 = eaAlfa;
     enNume = #dsm32201#54;   |HAZ Conver17;   #t1832201#57 = eaAlfa;
     enNume = #dsm32201#55;   |HAZ Conver17;   #t1832201#58 = eaAlfa;
     enNume = #dsm32201#56;   |HAZ Conver17;   #t1832201#59 = eaAlfa;
     enNume = #dsm32201#57;   |HAZ Conver17;   #t1832201#60 = eaAlfa;
     enNume = #dsm32201#58;   |HAZ Conver17;   #t1832201#61 = eaAlfa;
     enNume = #dsm32201#59;   |HAZ Conver17;   #t1832201#62 = eaAlfa;
     enNume = #dsm32201#60;   |HAZ Conver17;   #t1832201#63 = eaAlfa;
     enNume = #dsm32201#61;   |HAZ Conver17;   #t1832201#64 = eaAlfa;
     enNume = #dsm32201#62;   |HAZ Conver17;   #t1832201#65 = eaAlfa;
     enNume = #dsm32201#63;   |HAZ Conver17;   #t1832201#66 = eaAlfa;
     enNume = #dsm32201#64;   |HAZ Conver17;   #t1832201#67 = eaAlfa;
     enNume = #dsm32201#65;   |HAZ Conver17;   #t1832201#68 = eaAlfa;
     enNume = #dsm32201#66;   |HAZ Conver17;   #t1832201#69 = eaAlfa;
     enNume = #dsm32201#67;   |HAZ Conver17;   #t1832201#70 = eaAlfa;
     enNume = #dsm32201#68;   |HAZ Conver17;   #t1832201#71 = eaAlfa;
     enNume = #dsm32201#69;   |HAZ Conver17;   #t1832201#72 = eaAlfa;
     enNume = #dsm32201#70;   |HAZ Conver17;   #t1832201#73 = eaAlfa;
     enNume = #dsm32201#71;   |HAZ Conver17;   #t1832201#74 = eaAlfa;
     enNume = #dsm32201#72;   |HAZ Conver17;   #t1832201#75 = eaAlfa;
     enNume = #dsm32201#73;   |HAZ Conver17;   #t1832201#76 = eaAlfa;
     enNume = #dsm32201#74;   |HAZ Conver17;   #t1832201#77 = eaAlfa;
     enNume = #dsm32201#75;   |HAZ Conver17;   #t1832201#78 = eaAlfa;

     #t1832201#79 = "2";
     |SI #dsm32201#130 = "S"; #t1832201#79 = "1";  |FINSI;

     |SI #dsm32201#131 = "S"; #t1832201#80 = "X";  |FINSI;

     #t1832201#81 = "2";
     |SI #dsm32201#144 ! "N"; #t1832201#81 = "1";  |FINSI;
|FPRC;

|PROCESO Hoja2_2018;
     |DDEFECTO #t1832202;

     enNume = #dsm32201#76;   |HAZ Conver17;   #t1832202#3  = eaAlfa;
     enNume = #dsm32201#77;   |HAZ Conver17;   #t1832202#4  = eaAlfa;
     enNume = #dsm32201#79;   |HAZ Conver17;   #t1832202#6  = eaAlfa;
     enNume = #dsm32201#80;   |HAZ Conver17;   #t1832202#7  = eaAlfa;
     enNume = #dsm32201#81;   |HAZ Conver17;   #t1832202#8  = eaAlfa;
     enNume = #dsm32201#82;   |HAZ Conver17;   #t1832202#9  = eaAlfa;
     enNume = #dsm32201#83;   |HAZ Conver17;   #t1832202#10 = eaAlfa;
     enNume = #dsm32201#84;   |HAZ Conver17;   #t1832202#11 = eaAlfa;
     enNume = #dsm32201#85;   |HAZ Conver17;   #t1832202#12 = eaAlfa;

     enNume = #dsm32201#86;   |HAZ Conver17;   #t1832202#13 = eaAlfa;
     enNume = #dsm32201#87;   |HAZ Conver17;   #t1832202#14 = eaAlfa;
     enNume = #dsm32201#88;   |HAZ Conver17;   #t1832202#15 = eaAlfa;

     enNume = #dsm32201#89;   |HAZ Conver17;   #t1832202#16 = eaAlfa;
     enNume = #dsm32201#90;   |HAZ Conver17;   #t1832202#17 = eaAlfa;

     |SI #dsm32201#4 > 0;
         #t1832202#18 = "X";
         #t1832202#19 = #dsmom004#21;
     |FINSI;

     |SI #dsm32201#38 = 0; |Y #dsm32201#62 = 0; |Y #dsm32201#76 = 0;
      |Y #dsm32201#86 = 0; |Y #dsm32201#87 = 0; |Y #dsm32201#88 = 0;
      |Y #dsm32201#89 = 0; |Y #dsm32201#90 = 0; |Y #dsm32201#85 = 0;
         #t1832202#20 = "X";
     |FINSI;

     |SI #dsm32201#85 = 0;
         #t1832202#20 = "X";
     |FINSI;

     enNume = #dsm32201#78 * 100;              #t1832202#21 = ("00000" + enNume) % -105;

     #t1832202#23 = #dsm32201#99;
     #t1832202#24 = #dsm32201#97;
     #t1832202#25 = #dsm32201#103;
     #t1832202#26 = #dsm32201#101;
     #t1832202#27 = #dsm32201#107;
     #t1832202#28 = #dsm32201#105;
     #t1832202#29 = #dsm32201#111;
     #t1832202#30 = #dsm32201#109;
     #t1832202#31 = #dsm32201#115;
     #t1832202#32 = #dsm32201#113;
     #t1832202#33 = #dsm32201#119;
     #t1832202#34 = #dsm32201#117;

     enNume = #dsm32201#133 * 100;              #t1832202#35 = ("00000" + enNume) % -105;
     enNume = #dsm32201#134 * 100;              #t1832202#36 = ("00000" + enNume) % -105;
     enNume = #dsm32201#135 * 100;              #t1832202#37 = ("00000" + enNume) % -105;
     enNume = #dsm32201#136 * 100;              #t1832202#38 = ("00000" + enNume) % -105;

     enNume = #dsm32201#121;   |HAZ Conver17;   #t1832202#39 = eaAlfa;
     enNume = #dsm32201#122;   |HAZ Conver17;   #t1832202#40 = eaAlfa;
     enNume = #dsm32201#137;   |HAZ Conver17;   #t1832202#41 = eaAlfa;
     enNume = #dsm32201#138;   |HAZ Conver17;   #t1832202#42 = eaAlfa;
     enNume = #dsm32201#124;   |HAZ Conver17;   #t1832202#43 = eaAlfa;
     enNume = #dsm32201#125;   |HAZ Conver17;   #t1832202#44 = eaAlfa;
     enNume = #dsm32201#126;   |HAZ Conver17;   #t1832202#45 = eaAlfa;
     enNume = #dsm32201#127;   |HAZ Conver17;   #t1832202#46 = eaAlfa;
     enNume = #dsm32201#139;   |HAZ Conver17;   #t1832202#47 = eaAlfa;
     enNume = #dsm32201#140;   |HAZ Conver17;   #t1832202#48 = eaAlfa;
     enNume = #dsm32201#141;   |HAZ Conver17;   #t1832202#49 = eaAlfa;
     enNume = #dsm32201#142;   |HAZ Conver17;   #t1832202#50 = eaAlfa;
     enNume = #dsm32201#128;   |HAZ Conver17;   #t1832202#51 = eaAlfa;
     enNume = #dsm32201#143;   |HAZ Conver17;   #t1832202#52 = eaAlfa;
     enNume = #dsm32201#129;   |HAZ Conver17;   #t1832202#53 = eaAlfa;

     enNume = #dsm32201#145 * 100; #t1832202#54 = ("00000" + enNume) % -105;
|FPRC;

|PROCESO dsm32204_03;

     |SI #dsm32204#7 = 0; |Y #dsm32204#8 = 0;
         |ACABA;
     |FINSI;

     nConta = nConta + 1;
     |SI nConta = 6;
         nConta = 1;
         nReg   = nReg + 1;
     |FINSI;

     #t1832203#0 = nReg;
     |LEE 101#t1832203.=;
     |SI FSalida ! 0;
         |DDEFECTO #t1832203;
         #t1832203#0  = nReg;

         |SI nReg ! 0;
             #t1832203#2  = "C";
         |FINSI;

         |GRABA 020#t1832203.b;
     |FINSI;

     nColumna = nConta;
     nCampo   = 3 + (nColumna - 1) * 5;

     #t1832203#nCampo# = #dsm32204#6;

     nCampo = nCampo + 1;
     enNume = #dsm32204#7;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32204#8;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     #t1832203#nCampo# = #dsm32204#9;

     nCampo = nCampo + 1;
     |SI #dsm32204#10 ! 0;
         enNume = #dsm32204#10 * 100;
         aAlfa  = enNume;
         aAlfa  = ("00000" + aAlfa) % -105;
         #t1832203#nCampo# = aAlfa;
     |FINSI;

     |GRABA 020#t1832203.a;
     |LIBERA #t1832203;
     nSwHoja3 = 1;
|FPRC;

|DEFBUCLE dsm32204_03;
     #dsm32204#1;
     ;
     #dsm32201#0, #dsm32201#1, #dsm32201#3, #dsm32201#4, 01;
     #dsm32201#0, #dsm32201#1, #dsm32201#3, #dsm32201#4, 99;
     ;
     NULL, dsm32204_03;
|FIN;

|PROCESO dsm32205_03;
     nConta = nConta + 1;
     |SI nConta = 3;
         nConta = 1;
         nReg   = nReg + 1;
     |FINSI;

     #t1832203#0 = nReg;
     |LEE 101#t1832203.=;
     |SI FSalida ! 0;
         |DDEFECTO #t1832203;
         #t1832203#0  = nReg;

         |SI nReg ! 0;
             #t1832203#2  = "C";
         |FINSI;

         |GRABA 020#t1832203.b;
     |FINSI;

     nColumna = nConta; nCampo = 28;
     |SI nColumna = 2;  nCampo = 46; |FINSI;

     enNume = #dsm32205#5;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#6;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#7;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#8;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#9;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#10;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#11;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#12;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#13;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#14;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#15;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#16;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#17;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#18;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#19;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#20;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#21;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm32205#22;   |HAZ Conver17; #t1832203#nCampo# = eaAlfa;

     |GRABA 020#t1832203.a;
     |LIBERA #t1832203;
     nSwHoja3 = 1;
|FPRC;

|DEFBUCLE dsm32205_03;
     #dsm32205#1;
     ;
     #dsm32201#0, #dsm32201#1, #dsm32201#3, #dsm32201#4, 1;
     #dsm32201#0, #dsm32201#1, #dsm32201#3, #dsm32201#4, 9;
     ;
     NULL, dsm32205_03;
|FIN;

|PROCESO Hoja3_2018;

     nSwHoja3 = 2;
     aFichero = "t1832203" + Usuario;
     |NOME_DAT #t1832203#aFichero#;
     |ABRE #t1832203;  |CIERRA #t1832203;  |DELINDEX #t1832203;

     |ABRE #t1832203;
     nConta = 0; nReg = 0; |BUCLE dsm32204_03;
     nConta = 0; nReg = 0; |BUCLE dsm32205_03;
     |CIERRA #t1832203;
|FPRC;

|PROCESO Carga322_2018;
     enCodCli = #dsm32201#0;
     |HAZ LeePersona;

     nSwHoja3 = 0;
     |HAZ Hoja1_2018;
     |HAZ Hoja2_2018;
     |SI #dsm32201#2 = 12;
         |HAZ Hoja3_2018;
     |FINSI;

     aINI = "<T3220" + #t1832201#7 + #t1832201#8 + "0000>";
     aFIN = "</T3220" + #t1832201#7 + #t1832201#8 + "0000>";

     eaAlfa = aINI;        |HAZ GrabaPortalSin;
     eaAlfa = "<AUX>";     |HAZ GrabaPortalSin;
     eaAlfa = " " * 70;    |HAZ GrabaPortalSin;
     eaAlfa = eaVersMod;   |HAZ GrabaPortalSin;
     eaAlfa = " " * 4;     |HAZ GrabaPortalSin;
     eaAlfa = eaNIFDs;     |HAZ GrabaPortalSin;
     eaAlfa = " " * 213;   |HAZ GrabaPortalSin;
     eaAlfa = "</AUX>";    |HAZ GrabaPortalSin;

     |HAZ t1832201ptrl;
     |HAZ t1832202ptrl;
     |SI nSwHoja3 ! 0;
         |HAZ t1832203ptrl;
     |FINSI;

     eaAlfa = aFIN;
     |HAZ GrabaPortalSin;
|FPRC;

|PROCESO dsmow014_2018;
     |ABRE #dsmom004;
     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = #dsmow014#5;
     #dsmom004#4  = #dsmow014#7;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #dsmom004;

     |ABRE #dsm32201;
     #dsm32201#0 = #dsmom004#0;
     #dsm32201#1 = #dsmom004#1;
     #dsm32201#2 = #dsmom004#2;
     #dsm32201#3 = #dsmom004#3;
     #dsm32201#4 = #dsmom004#4;
     #dsm32201#5 = 0;
     |LEE 040#dsm32201.=;
     |SI FSalida ! 0;  |CIERRA #dsm32201;  |ACABA;  |FINSI;
     |CIERRA #dsm32201;

     eaFicheroPlano = "322" + (("00000" + #dsmow014#0) % -105) + ".txt";
     eaFicheroImpre = "322" + (("00000" + #dsmow014#0) % -105) + ".pdf";
     eaFicheroError = "err" + (("00000" + #dsmow014#0) % -105) + ".txt";

     aAlfa = eaPathLanza + eaFicheroPlano;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroImpre;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroError;  |RFBORRA aAlfa;

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     nError = 0;
     |HAZ Carga322_2018;

     |XCIERRA nHandle2;

     enEmpresa    = #dsmow014#0;
     enComple     = #dsmow014#7;
     eaNomEmpresa = #dsmow014#3;

     |HAZ PresentaModelo_03;
|FPRC;

|DEFBUCLE dsmow014C_2018;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, dsmow014_2018;
|FIN;

|DEFBUCLE dsmow014N_2018;
     #dsmow014#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, dsmow014_2018;
|FIN;

|PROCESO Bloque2018;
     enPresentar = 0;

     |SI #dsmoy000#6 [ 2018;
         eaOpcion = "3";
     |FINSI;

     |SI #dsmoy000#6 ] 2019;
         |HAZ BtnPeriodicas2019;
     |FINSI;

     enPresentar = 0;
     |SI eaOpcion = "3";
         |SI #dsmoy000#6 < 2019;
             |CONFI "0000SPresentamos la declaracion en el momento de crearlas";
             |SI FSalida = 0;
                 enPresentar = 1;
             |FINSI;
         |FINSI;
     |FINSI;

     nSwLee = 0;
     |SI #dsmoy000#8 = "C";
         |BUCLE dsmow014C_2018;
     |SINO;
         |BUCLE dsmow014N_2018;
     |FINSI;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;

     |SI enDirecta = 1;  |Y enMsv = 1;  |Y enParar = 0;
         |SUB_EJECUTA "|dsmox007";
     |FINSI;
|FPRC;

|PROCESO moy32203;
     |ABRE #dsmom107;
     |LEE 040#dsmom107.p;
     |SI FSalida ! 0;
         |CIERRA #dsmom107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #dsmom107;
     |FINSI;

     |LEE 000#dsmom107.p;
     |SI FSalida ! 0;  |DDEFECTO #dsmom107;  |FINSI;
     |CIERRA #dsmom107;

     enSwTrata      = 0;
     enCambiaMoneda = 1;

     |HAZ Bloque2018;
|FPRC;
