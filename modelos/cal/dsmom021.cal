|FICHEROS;
     dsmom015 #15;
     dsmom016 #16;
     dsmom018 #18;
     dsmom019 #19;
     dsmom021 #21;

     dsmom21@ #921;

     dsmom039 #39,MANTE;
|FIN;

|VARIABLES;
     nTecla    = 0;
     nSwEstar  = 0;
     nLinea    = 0;
     nCampo    = 0;
     nCampo1   = 0;
     nCampo2   = 0;
     nDias     = 0;

     nSalida18 = 0;
     nSalida19 = 0;

     aAlfa1    = "";
     &ef1      = @;
     &ef2      = @;
     &enEst39  = 0;
     nModoEntrada = 0;

     aBase     = "";
     aMas      = "";
     nDRef     = 0;
     nHRef     = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO VerFecha; |TIPO 7;

 |ABRE #39;
 |HAZ Leem039;
 |SI enEst39 = 0;
     |PINPA #0#39;
     |PINDA #0#39;
 |SINO;
     |PINTA 1957, "                       ";
     |PINTA 2157, "                       ";
 |FINSI;
 |LIBERA #39;
 |CIERRA #39;
|FPRC;

|PROCESO DarBaja; |TIPO 1;
  nModoEntrada = (FEntrada / 100) ! 0;
  |SI nModoEntrada = 3;
      |ABRE #39;
      |HAZ Leem039;
      |SI enEst39 = 0;
          |BORRA 020#39a;
          |PINTA 1957, "                       ";
          |PINTA 2157, "                       ";
      |FINSI;
      |LIBERA #39;
      |CIERRA #39;
  |FINSI;
|FPRC;

|PROCESO Tipo0C11; |TIPO 0;
    nTecla  = FSalida;
    |SI nTecla = 13;
        #21#11 = #21#8;  |PINTA #21#11;
        #21#12 = #21#9;  |PINTA #21#12;
        #21#13 = #21#10; |PINTA #21#13;
    |FINSI;
|FPRC;

|PROCESO ParaCopiar;
    #921#11 = #921#8;
    #921#12 = #921#9;
    #921#13 = #921#10;

    |GRABA 020#921a;
    |LIBERA #921;
|FPRC;

|DEFBUCLE ParaCopiar;
     #921#1005;
     ;
     #21#0, #21#1, #21#2, #21#3, nDRef;
     #21#0, #21#1, #21#2, #21#3, nHRef;
     be;
     NULL, ParaCopiar;
|FIN;

|PROCESO Tipo11C4; |TIPO 11;
     nTecla = FSalida;

     |SI nTecla ! 13; |Y nTecla ! 14; |ACABA; |FINSI;

     |SI nTecla = 14;
         |CONFI "0000SCopiar Todos los datos Provisionales a datos Definitivos";
     |SINO;
         FSalida = 0;
     |FINSI;
     |SI FSalida = 0;
         nDRef = 001;
         nHRef = 999;
         |SI nTecla = 13;
             nDRef = #21#4;
             nDRef = #21#4;
         |FINSI;

         |BUCLE ParaCopiar;

         |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;

|PROCESO LeeElepi;  |TIPO 0;
     nTecla = FSalida;
     |SI nTecla = 11;
         |HAZ FunFecha;
         |ERROR;
         |ACABA;
     |FINSI;

     |ABRE #16;
     #16#0  = eaCodEpi1;
     #16#1  = eaCodEpi2;
     #16#41 = enCodEpi3;
     #16#2  = enEjer;
     |LEE 040#16=;
     |SI FSalida ! 0;  |DDEFECTO #16;  |FINSI;
     |CIERRA #16;

     |SI nTecla = 10;
         |PUSHV 0501 2380;
         |PINPA #0#16;
         |PINDA #0#16;
         |PAUSA;
         |POPV;
         |ERROR;
         |ACABA;
     |FINSI;

     nSwEstar = 0;
     nLinea   = 0;

     |ABRE #15;
     |PARA nCampo = 4;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 4;
        nLinea = nLinea + 1;
        |SI #21#5 = #16nCampo;
            #15#0 = #16nCampo;
            |LEE 040#15=;
            |SI FSalida = 0; |Y #15#3 = "N";
                nSwEstar = 1;
                |SAL;
            |FINSI;
        |FINSI;
     |SIGUE;
     |CIERRA #15;

     |SI nSwEstar = 0;
         |MENAV "      No existe el concepto en el elemento epigrafe o es de Empleo o Loterias";
         |ERROR;
         |ACABA;
     |FINSI;

     #21#14 = nLinea;
|FPRC;

|PROCESO Leem039;
  |DDEFECTO #39;
  #39#0 = #21#0;
  #39#1 = #21#1;
  #39#2 = #21#2;
  #39#3 = #21#3;
  #39#4 = #21#4;
  |LEE 101#39=;
  enEst39 = FSalida;
|FPRC;

|PROCESO FunFecha; |TIPO 0;
  nTecla = FSalida;
  |SI nTecla ! 11; |ACABA;  |FINSI;

  |ABRE #39;
  |HAZ Leem039;

  |PINPA #0#39;
  |PINDA #0#39;
  |ENDATOS #1#39;
  |SI FSalida = 0;
      |SI enEst39 = 0; |GRABA 020#39a; |FINSI;
      |SI enEst39 ! 0; |GRABA 020#39n; |FINSI;
      |HAZ CalDias;
  |FINSI;
  |LIBERA #39;
  |CIERRA #39;

  |HAZ VerFecha;
|FPRC;

|PROCESO CalDias;
 |SI #39#5 > "01.01.0000";

     |SI #39#5 > ef1;
         #21#9 = 0;
     |SINO;
         #21#9 = ef2 - ef1 + 1;
     |FINSI;

     |SI #39#6 [ ef2;
         #21#12 = #39#6 - #39#5 + 1;
     |SINO;
         #21#12 = ef2   - #39#5 + 1;
     |FINSI;

 |SINO;

     |SI #39#6 [ ef2;
         #21#12 = #39#6 - ef1 + 1;
     |FINSI;

 |FINSI;
 |PINTA #21#9;
 |PINTA #21#12;
|FPRC;

|PROCESO TUnidad;
     nDias = 365;
     |SI #21#1 = 2000;  nDias = 366;  |FINSI;
     |SI #21#1 = 2004;  nDias = 366;  |FINSI;
     |SI #21#1 = 2008;  nDias = 366;  |FINSI;
     |SI #21#1 = 2012;  nDias = 366;  |FINSI;
     |SI #21#1 = 2016;  nDias = 366;  |FINSI;
     |SI #21#1 = 2020;  nDias = 366;  |FINSI;
     |SI #21#1 = 2024;  nDias = 366;  |FINSI;
     |SI #21#1 = 2028;  nDias = 366;  |FINSI;
     |SI #21#1 = 2032;  nDias = 366;  |FINSI;
     |SI #21#1 = 2036;  nDias = 366;  |FINSI;
     |SI #21#1 = 2040;  nDias = 366;  |FINSI;

     #21#10 = (#21#08 * #21#09) / nDias;   |PINTA #21#10;
     #21#13 = (#21#11 * #21#12) / nDias;   |PINTA #21#13;
|FPRC;

|RUTINA ClaveBaja21;
     #21#0 = enEmpresa;
     #21#1 = enEjer;
     #21#2 = enComplem;
     #21#3 = enActividad;
     #21#4 = 1;
|FRUT;

|RUTINA ClaveAlta21;
     #21#0 = enEmpresa;
     #21#1 = enEjer;
     #21#2 = enComplem;
     #21#3 = enActividad;
     #21#4 = 999;
|FRUT;

|PROCESO CalculaElem;
     nCampo1 = 0;
     |SI #21#14 = 1;  |Y #18#70 ! "L";  nCampo1 = 26;  nCampo2 = 48; |FINSI;
     |SI #21#14 = 2;  |Y #18#71 ! "L";  nCampo1 = 27;  nCampo2 = 49; |FINSI;
     |SI #21#14 = 3;  |Y #18#72 ! "L";  nCampo1 = 28;  nCampo2 = 50; |FINSI;
     |SI #21#14 = 4;  |Y #18#73 ! "L";  nCampo1 = 29;  nCampo2 = 51; |FINSI;
     |SI #21#14 = 5;  |Y #18#74 ! "L";  nCampo1 = 30;  nCampo2 = 52; |FINSI;
     |SI #21#14 = 6;  |Y #18#75 ! "L";  nCampo1 = 31;  nCampo2 = 53; |FINSI;
     |SI #21#14 = 7;  |Y #18#76 ! "L";  nCampo1 = 32;  nCampo2 = 54; |FINSI;
     |SI #21#14 = 8;  |Y #18#77 ! "L";  nCampo1 = 33;  nCampo2 = 55; |FINSI;
     |SI #21#14 = 9;  |Y #18#78 ! "L";  nCampo1 = 34;  nCampo2 = 56; |FINSI;

     |SI nCampo1 ! 0;
         |SI #21#7 = "R";  |O #21#7 = "A";
             #18nCampo1 = #18nCampo1 + #21#10;
             #18nCampo2 = #18nCampo2 + #21#13;
         |FINSI;

         |SI #21#7 = "I";  |O #21#7 = "A";
             #19nCampo1 = #19nCampo1 + #21#10;
             #19nCampo2 = #19nCampo2 + #21#13;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom021;
  #21#1;
  ;
  enEmpresa, enEjer, enComplem, enActividad, 000;
  enEmpresa, enEjer, enComplem, enActividad, 999;
  ;
  NULL, CalculaElem;
|FIN;

|PROGRAMA;
      |SI eaDesElem = "N";  |ACABA;  |FINSI;

      aAlfa1 = enEjer; aAlfa1 = "01.01." + aAlfa1; ef1 = aAlfa1;
      aAlfa1 = enEjer; aAlfa1 = "31.12." + aAlfa1; ef2 = aAlfa1;

      |SI enNoLineal = 0;

          |DBASE aBase;  |QBF aBase;
          aMas = aBase + "def/dsmom021.mas";
          |CARGA_DEF aMas, dsmom21@;
          |SI FSalida ! 0;
              |MENAV "0000Error Cargando Def dsmom021";
              |ACABA;
          |FINSI;

          |ENTLINEAL #1#21, -5, 2, 22, 1, ClaveBaja21, ClaveAlta21;

          |DESCARGA_DEF #dsmom21@;
      |FINSI;

      enEntradaMod = 2;
      |SUB_EJECUTA "dsmom018";
      |SUB_EJECUTA "dsmom019";

      |ABRE #18;
      #18#0 = enEmpresa;
      #18#1 = enEjer;
      #18#2 = enComplem;
      #18#3 = enActividad;
      |LEE 101#18=;
      nSalida18 = FSalida;
      |SI nSalida18 ! 0;  |DDEFECTO #18;  |FINSI;

      |SI #18#70 = "P";  #18#26 = 0;  #18#48 = 0;  |FINSI;
      |SI #18#71 = "P";  #18#27 = 0;  #18#49 = 0;  |FINSI;
      |SI #18#72 = "P";  #18#28 = 0;  #18#50 = 0;  |FINSI;
      |SI #18#73 = "P";  #18#29 = 0;  #18#51 = 0;  |FINSI;
      |SI #18#74 = "P";  #18#30 = 0;  #18#52 = 0;  |FINSI;
      |SI #18#75 = "P";  #18#31 = 0;  #18#53 = 0;  |FINSI;
      |SI #18#76 = "P";  #18#32 = 0;  #18#54 = 0;  |FINSI;
      |SI #18#77 = "P";  #18#33 = 0;  #18#55 = 0;  |FINSI;
      |SI #18#78 = "P";  #18#34 = 0;  #18#56 = 0;  |FINSI;

      |SI #18#70 = " ";  #18#26 = 0;  #18#48 = 0;  |FINSI;
      |SI #18#71 = " ";  #18#27 = 0;  #18#49 = 0;  |FINSI;
      |SI #18#72 = " ";  #18#28 = 0;  #18#50 = 0;  |FINSI;
      |SI #18#73 = " ";  #18#29 = 0;  #18#51 = 0;  |FINSI;
      |SI #18#74 = " ";  #18#30 = 0;  #18#52 = 0;  |FINSI;
      |SI #18#75 = " ";  #18#31 = 0;  #18#53 = 0;  |FINSI;
      |SI #18#76 = " ";  #18#32 = 0;  #18#54 = 0;  |FINSI;
      |SI #18#77 = " ";  #18#33 = 0;  #18#55 = 0;  |FINSI;
      |SI #18#78 = " ";  #18#34 = 0;  #18#56 = 0;  |FINSI;

      |ABRE #19;
      #19#0 = enEmpresa;
      #19#1 = enEjer;
      #19#2 = enComplem;
      #19#3 = enActividad;
      |LEE 101#19=;
      nSalida19 = FSalida;
      |SI nSalida19 ! 0;  |DDEFECTO #19;  |FINSI;

      |SI #19#70 = "P";  #19#26 = 0;  #19#48 = 0;  |FINSI;
      |SI #19#71 = "P";  #19#27 = 0;  #19#49 = 0;  |FINSI;
      |SI #19#72 = "P";  #19#28 = 0;  #19#50 = 0;  |FINSI;
      |SI #19#73 = "P";  #19#29 = 0;  #19#51 = 0;  |FINSI;
      |SI #19#74 = "P";  #19#30 = 0;  #19#52 = 0;  |FINSI;
      |SI #19#75 = "P";  #19#31 = 0;  #19#53 = 0;  |FINSI;
      |SI #19#76 = "P";  #19#32 = 0;  #19#54 = 0;  |FINSI;
      |SI #19#77 = "P";  #19#33 = 0;  #19#55 = 0;  |FINSI;
      |SI #19#78 = "P";  #19#34 = 0;  #19#56 = 0;  |FINSI;

      |SI #19#70 = " ";  #19#26 = 0;  #19#48 = 0;  |FINSI;
      |SI #19#71 = " ";  #19#27 = 0;  #19#49 = 0;  |FINSI;
      |SI #19#72 = " ";  #19#28 = 0;  #19#50 = 0;  |FINSI;
      |SI #19#73 = " ";  #19#29 = 0;  #19#51 = 0;  |FINSI;
      |SI #19#74 = " ";  #19#30 = 0;  #19#52 = 0;  |FINSI;
      |SI #19#75 = " ";  #19#31 = 0;  #19#53 = 0;  |FINSI;
      |SI #19#76 = " ";  #19#32 = 0;  #19#54 = 0;  |FINSI;
      |SI #19#77 = " ";  #19#33 = 0;  #19#55 = 0;  |FINSI;
      |SI #19#78 = " ";  #19#34 = 0;  #19#56 = 0;  |FINSI;

      |BUCLE dsmom021;

      |SI nSalida18 = 0;  |GRABA 020#18a;  |FINSI;
      |SI nSalida19 = 0;  |GRABA 020#19a;  |FINSI;

      |LIBERA #18;
      |CIERRA #18;

      |LIBERA #19;
      |CIERRA #19;

      enEntradaMod = 1;
      |SUB_EJECUTA "dsmom018";
      |SUB_EJECUTA "dsmom019";

      enEntradaMod = 0;
|FPRO;
