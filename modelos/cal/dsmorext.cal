|FICHEROS;
   dsmorext #0;   || Entrada IRPF no residentes

   dsm210ca #10;  || Tipos de renta modelo 210
   dsm210ni #11;  || Nifs modelo 210
   dsm210ln #12,MANTE;  || Lineas de importes de nifs modelo 210
   dsm210tr #13;  || Maestro de tipos de renta modelo 210
   dsminmex #14;  || Inmuebles de extranjeros
   dsm210in #15;  || Inmuebles modelo 210
   dsm211ca #16;  || Inmuebles modelo 211
   dsm210dp #17;  || Datos personales extranjeros
   dsm211la #18;  || Lineas adquirientes modelo 211
   dsm211tr #19;  || Lineas transmitentes modelo 211
   dsm210fp #20;  || Formas de pago modelo 210
   dsmivcex #21;  || Valor catastral por ejercicio de inmuebles de extranjeros
   dsm210t1 #22;  || Tabla coeficientes adquisicion
   dsm210db #23;  || Datos banco por defecto

   dsmow300 #100,MANTE; || Fantasma modelo 210
   dsmow301 #101;       || Fantasma modelo 210
   dsmow302 #102,MANTE; || Fantasma Tipos de renta
   dsmow303 #103,MANTE; || Fantasma Nifs de pag/ret/emi
   dsmow304 #104,MANTE; || Fantasma Inmuebles de los extranjeros
   dsmow306 #106,MANTE; || Fantasma Inmuebles del modelo
   dsmow307 #107,MANTE; || Fantasma Datos 210 I/G
   dsmow308 #108,MANTE; || Fantasma Datos 210 R
   dsmow309 #109,MANTE; || Fantasma Datos 210 H
   dsmow338 #110;       || Fant.Datos economicos
   dsmow335 #111,MANTE; || Fant.Valor catastral
   dsmow312 #112,MANTE; || Fantasma datos 211
   dsmow313 #113,MANTE; || Fantasma relacion adquirientes modelo 211
   dsmow314 #114,MANTE; || Fantasma relacion transmitentes modelo 211
   dsmow315 #115,MANTE; || Fantasma datos pago modelo 210
   dsmow317 #117;       || Pantalla vacia
   dsmow318 #118,MANTE; || Fantasma datos representante modelo 211
   dsmow320 #120,MANTE; || Fantasma datos adquirente tipo renta 28 modelo 210
   dsmow321 #121;       || Temporal emision modelo 210
   dsmow322 #122,MANTE; || Temporal datos liquidacion modelo 210
   dsmow323 #123;       || Temporal alta contribuyentes
   dsmow339 #124,MANTE;

   repobla@ #500;
   &reprovi@ #501;
   &rpaises@ #502;
   rmunici@ #503;
   &haciend@ #504;

   Referen@ #1000;
   Refere1@ #1001;
   Refere2@ #1002;
   Refere3@ #1003;
   Refere4@ #1004;
|FIN;

|VARIABLES;
   &eaOrigen  = "";
   &eaDestino = "";
   &eaAlfa    = "";
   &Cmp       = 0;
   &eaPathExplorador = "";
   &eaForzExplorador = "";
   &enSwCod = 0;
   &enSwModo = 0;
   &eaUnidadBase = "";
   &eaIP         = "";
   &efFechaDev   = @;
   &enPorc1      = 0;
   &enPorc2      = 0;
   &enSwTit      = 0;

   aWebTIA = "";
   aWebEJF = "";
   aWebING = "";
   aWebNDC = "";

   nCmpA   = 0;
   nCmpB   = 0;
   nSwActualiza = 0;

   fFechaIni = @;
   fFechaFin = @;
   nDias     = 0;
   nFactor   = 0;

   aComp    = " ";
   nSwBorFP = 0;
   nDivisa  = 0;
   nComent  = 0;

   aAntNif = "";

   aDirBase = "";
   aDirDest = "";
   nCampo   = 0;
   aAlfa  = "";
   aAlfa1 = "";
   aAlfa2 = "";
   aAlfa3 = "";
   aAlfa4 = "";
   aAlfa5 = "";
   aAlfaX = "";
   aAlfaF4 = "";
   aNomDef = "";
   aBase  = "";
   aDNif  = "";
   aHNif  = "";
   aRuta  = "";
   fDFecha = @;
   fHFecha = @;

   aSwPresent  = "";
   nSwCliente  = "";
   aSwPeriodo  = "";
   aSwError    = "";
   nSwError    = 0;
   nSinEvto    = 0;

   nModelo     = 0;
   nSalFuera   = 0;

   nLabelTipo  = 0;

   aTitulo = "";

   aEsc1   = "";
   aEsc2   = "";
   aRetu   = "";
   aTecla  = "";
   aCadena = "";
   aSwAplic = "";

   aNif    = "";
   aFichero  = "";
   aPath   = "";

   fFecha    = @;
   nDivis    = 0;
   aDivis    = "";

   nSwHay    = 0;

   nAntInmueble   = 0;
   nSwPasa        = 0;
   nSwSig         = 0;

   FEstado = 0;

   nContador = 0;
   nModo    = 0;
   nModoL1  = 0;
   nModoL2  = 0;
   nModoIn  = 0;
   nModoAnt = 0;
   nModoFP  = 0;
   nCont  = 0;
   nContCmp = 0;
   nCalc  = 0;
   nCalc1 = 0;
   nCalc2 = 0;
   nCalc3 = 0;
   nCalcLiq = 0;
   nCanal = 0;
   nSw    = 0;
   nDInm  = 0;
   nHInm  = 0;
   nSwPasaCero = 0;

   aNifAnt = "";

   nContr  = 0;
   nTipoR  = 0;
   aNifLn  = "";
   nInmLn  = 0;
   nDivLn  = 0;
   nResul  = 0;

   nEstadoG1a = 0;
   nEstadoG1b = 0;

   nBotonTit  = 0;
   nBotonCon  = 0;

   nBotonNueEj  = 0;
   nBotonModEj  = 0;
   nBotonBorEj  = 0;
   nBotonOkSig  = 0;

   nBotonCtaBanco  = 0;
   nBotonPaseRenta = 0;
   nBotonGestInm   = 0;

   nSubPant   = 0;
   nNumSPant  = 0;

   nRango = 0;
   nPos1  = 0;
   nPos2  = 0;

   nHandle  = 0;
   nHandlePortal = 0;

   nGridSel = 0;
   nGrid0   = 0;
   nGrid1   = 0;
   nGrid1a  = 0;
   nGrid1aa = 0;
   nGrid1b  = 0;
   nGrid2   = 0;
   nGrid3   = 0;
   nGrid4   = 0;
   nVentEsp = 0;
   nVentFlt = 0;
   nVent0   = 0;
   nVent1   = 0;
   nVent2   = 0;
   nVent3   = 0;
   nVent4   = 0;
   nSubVent = 0;
   nPant0   = 0;
   nPant1   = 0;
   nPant2   = 0;
   nPant3   = 0;
   nPant4   = 0;
   nPant5   = 0;
   nPantFlt = 0;
   nTree0   = 0;

   nBotonExpl   = 0;
   nBotonPago   = 0;
   nBotonCancel = 0;
   nBotonOk     = 0;
   nBotonEmi    = 0;
   nBotonSalir  = 0;
   nBotonSalirTodo = 0;

   nBotonNueTR = 0;
   nBotonModTR = 0;
   nBotonBorTR = 0;
   nBotonSalTR = 0;

   nBotonNueNi = 0;
   nBotonModNi = 0;
   nBotonBorNi = 0;
   nBotonSalNi = 0;

   nBotonNueLN = 0;
   nBotonModLN = 0;
   nBotonBorLN = 0;
   nBotonSalLN = 0;
   nBotonCambFc = 0;

   nBotonDatEco = 0;
   nBotonNueInm = 0;
   nBotonModInm = 0;
   nBotonBorInm = 0;
   nBotonImpInm = 0;
   nIdSalir     = 0;
   nIdSalirA    = 0;
   nIdSalirB    = 0;

   nNuevoAdq    = 0;
   nModifAdq    = 0;
   nBorraAdq    = 0;

   nNuevoTrn    = 0;
   nModifTrn    = 0;
   nBorraTrn    = 0;

   nRelAdqui    = 0;
   nRelTrans    = 0;
   nDatRepre    = 0;

   nNueInm211 = 0;
   nModInm211 = 0;
   nBorInm211 = 0;

   nBotonNueCt = 0;
   nBotonBorCt = 0;

   nBotonValCatMas = 0;

   nNivelLins = 0;

   || NO METER VARIABLES ENTRE ESTE BLOQUE
{-1}sTree      = 0;
   sT_nID      = 0;
   sT_nOper    = 0;
   sT_aData    = "";
{2}nNivel      = 0;
{1}aContiene   = "";
{-1}aVent      = "";
    aVent1     = 0;
    aVent2     = 0;
    aVent3     = 0;
    aVent4     = 0;
    aVent5     = "";
   || NO METER VARIABLES ENTRE ESTE BLOQUE
{100}aDatosTit = "";
{100}aDatosCon = "";

     aIBAN       = "";
     &eaCta      = "";
     &eaPais     = "";
     &eaIBAN     = "";

     &nTr210tr   = 0;
     &nEj210tr   = 0;
     &nTg210tr   = 0;
     &fFecha1    = @;
     &eaVarDni   = "";
     &enCalcCif  = 0;
     &enEmpresa  = 0;
     &eaBloqueo  = "";
     nSalida = 0;
|FIN;

|PROCESO GrabaCP2;
   #dsmow304#21 = (("00" + #dsmow304#13) % -102) + (("000" + #dsmow304#14) % -103);
|FPRC;

|PROCESO GrabaCP3;
   #dsmow318#23 = (("00" + #dsmow318#15) % -102) + (("000" + #dsmow318#16) % -103);
|FPRC;

|PROCESO Final;
   |SI FSalida = 0; |PTEC 801; |FINSI;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
|FPRC;

|PROCESO Tipo80; |TIPO 80;
   FSalida = 3399;
|FPRC;

|PROCESO BotonOk;
   |PTEC 801;
|FPRC;

|PROCESO BotonCancel;
   |PTEC 807;
|FPRC;

/***************************************************************************
*********                       DATOS PERSONALES                   *********
****************************************************************************/

|PROCESO T66CP1; |TIPO 66;
   |DDEF aAlfa1; |QBF aAlfa1;
   aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#;
   aNomDef = aAlfa - aAlfa1;

   #reprovi@#0 = #Fichero@#Campo#;
   |LEE 000#reprovi@.];
   |CONSULTA_CLAVE #1#reprovi@;
   |SI FSalida = 0;
      #Fichero@#Campo# = #reprovi@#0; |PINTA #Fichero@#Campo#;
      |SI aNomDef ! "dsmow352";
          nCalc = Campo + 3;
          #Fichero@#nCalc# = #reprovi@#1; |PINTA #Fichero@#nCalc#;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO T00CP1;
   nSalida = FSalida;

   |DDEF aAlfa1; |QBF aAlfa1;
   aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#;
   aNomDef = aAlfa - aAlfa1;

   |SI aNomDef = "dsmow352"; |Y #Fichero@#Campo# = 00;
       |ACABA;
   |FINSI;

   #reprovi@#0 = #Fichero@#Campo#;
   |LEE 000#reprovi@.=;
   |SI FSalida = 0;
      |SI aNomDef ! "dsmow352";
          nCalc = Campo + 3;
          #Fichero@#nCalc# = #reprovi@#1; |PINTA #Fichero@#nCalc#;
      |FINSI;
   |SINO;
      |SI aNomDef = "dsmow300"; |Y Campo = 57;  |ACABA; |FINSI;
      |MENAV "    Provincia inexistente"; |ERROR;
   |FINSI;
    FSalida = nSalida;
|FPRC;

|PROCESO InfPob211;
   #repobla@#0 = #Fichero@#nCalc#;
   #repobla@#1 = 1;
|FPRC;

|PROCESO SupPob211;
   #repobla@#0 = #Fichero@#nCalc#;
   #repobla@#1 = 999;
|FPRC;

|PROCESO T66CP2; |TIPO 66;
   |DDEF aAlfa1; |QBF aAlfa1;
   aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#;
   aNomDef = aAlfa - aAlfa1;

   nCalc = Campo - 1;
   #repobla@#0 = #Fichero@#nCalc#;
   #repobla@#1 = #Fichero@#Campo#;
   |LEE 000#repobla@.];
   |CONSULTA_F_CLAVE #1#repobla@, InfPob211, SupPob211;
   |SI FSalida = 0;
      #Fichero@#Campo# = #repobla@#0; |PINTA #Fichero@#Campo#;
      |SI aNomDef ! "dsmow352";
          nCalc = Campo + 1;
          |SI enSwCod = 1;
             #Fichero@#nCalc# = #repobla@#3; |PINTA #Fichero@#nCalc#;
          |FINSI;
          |SI enSwCod = 2;
             #Fichero@#nCalc# = #repobla@#2; |PINTA #Fichero@#nCalc#;
          |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO T00CP2;
   |DDEF aAlfa1; |QBF aAlfa1;
   aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#;
   aNomDef = aAlfa - aAlfa1;

   |SI aNomDef = "dsmow352"; |Y #Fichero@#Campo# = 000;
       |ACABA;
   |FINSI;

   nCalc = Campo - 1;
   #repobla@#0 = #Fichero@#nCalc#;
   #repobla@#1 = #Fichero@#Campo#;
   |LEE 000#repobla@.=;
   |SI FSalida = 0;
       |SI aNomDef ! "dsmow352";
           nCalc = Campo + 1;
           |SI enSwCod = 1;
               #Fichero@#nCalc# = #repobla@#3; |PINTA #Fichero@#nCalc#;
           |FINSI;
           |SI enSwCod = 2;
               #Fichero@#nCalc# = #repobla@#2; |PINTA #Fichero@#nCalc#;
           |FINSI;
       |FINSI;
   |SINO;
       |SI aNomDef = "dsmow300"; |Y Campo = 58;
           aAlfa = (("00" + #dsmow300#57) % -102) + (("000" + #dsmow300#58) % -103);
           #dsmow300#66 = aAlfa;
           |ACABA;
       |FINSI;
       |MENAV "    Poblacion inexistente"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO T66RelPais; |TIPO 66;
   #rpaises@#0 = #Fichero@#Campo#;
   |LEE 000#rpaises@.];
   |CONSULTA_CLAVE #1#rpaises@;
   |SI FSalida = 0;
      #Fichero@#Campo# = #rpaises@#0; |PINTA #Fichero@#Campo#;
      nCalc = Campo + 1;
      #Fichero@#nCalc# = #rpaises@#1; |PINTA #Fichero@#nCalc#;
   |FINSI;
|FPRC;

|PROCESO T00RelPais;
   nSalida = FSalida;
   #rpaises@#0 = #Fichero@#Campo#;
   |LEE 000#rpaises@.=;
   |SI FSalida = 0;
      nCalc = Campo + 1;
      #Fichero@#nCalc# = #rpaises@#1; |PINTA #Fichero@#nCalc#;
   |SINO;
      |MENAV "    Pais inexistente"; |ERROR;
   |FINSI;
   FSalida = nSalida;
|FPRC;

|PROCESO T66RelNifs; |TIPO 66;
   |SI Cmp = -1;
      |DDEF aAlfa1; |QBF aAlfa1;
      aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#; aNomDef = aAlfa - aAlfa1;
      |SI aNomDef = "dsmow312"; |Y Campo = 0;  Cmp = 2;   |FINSI;
      |SI aNomDef = "dsmow312"; |Y Campo = 5;  Cmp = 6;   |FINSI;
      |SI aNomDef = "dsmow312"; |Y Campo = 13; Cmp = 14;  |FINSI;
      |SI aNomDef = "dsmow300"; |Y Campo = 40; Cmp = 999; |FINSI;
      |SI aNomDef = "dsmow313"; |Y Campo = 0;  Cmp = 999; |FINSI;
      |SI aNomDef = "dsmow314"; |Y Campo = 0;  Cmp = 999; |FINSI;
      |SI aNomDef = "dsmow318"; |Y Campo = 0;  Cmp = 999; |FINSI;
   |FINSI;

   |DBASS aAlfa; |QBF aAlfa;
   |SI enSwCod = 1;
      aAlfa1 = aAlfa + "integral/def/dsam0103.mas";
   |SINO;
      aAlfa1 = aAlfa + "basica/def/agim0003.mas";
   |FINSI;
   |CARGA_DEF aAlfa1, Referen@;
   |SI FSalida = 0;
      |SI enSwCod = 1;
         aAlfa1 = aAlfa + "integral/fich/";
      |SINO;
         aAlfa1 = aAlfa + "basica/fich/";
      |FINSI;
      |PATH_DAT #Referen@#aAlfa1#;
      |ABRE #Referen@;
      #Referen@#0 = #Fichero@#Campo#;
      |LEE 000#Referen@.];
      |CONSULTA_CLAVE #1#Referen@;
      |SI FSalida = 0;
         #Fichero@#Campo# = #Referen@#0; |PINTA #Fichero@#Campo#;
         |SI Cmp ! 999;
            #Fichero@#Cmp# = #Referen@#1; |PINTA #Fichero@#Cmp#;
         |SINO;
            |SI aNomDef = "dsmow300";
               #Fichero@#43 = #Referen@#1;  |PINTA #Fichero@#43;
               #Fichero@#44 = #Referen@#9;  |PINTA #Fichero@#44;
               #Fichero@#45 = #Referen@#2;  |PINTA #Fichero@#45;
               #Fichero@#51 = #Referen@#16; |PINTA #Fichero@#51;
               #Fichero@#52 = #Referen@#10; |PINTA #Fichero@#52;
               #Fichero@#53 = #Referen@#11; |PINTA #Fichero@#53;
               #Fichero@#57 = #Referen@#4;  |PINTA #Fichero@#57;
               #Fichero@#58 = #Referen@#5;  |PINTA #Fichero@#58;
               #Fichero@#59 = #Referen@#6;  |PINTA #Fichero@#59;
               #Fichero@#60 = #Referen@#7;  |PINTA #Fichero@#60;
               #Fichero@#61 = #Referen@#8;  |PINTA #Fichero@#61;
               #Fichero@#63 = #Referen@#17; |PINTA #Fichero@#63;
            |FINSI;
            |SI aNomDef = "dsmow313";
               #Fichero@#1 = #Referen@#1;  |PINTA #Fichero@#1;
               #Fichero@#6 = #Referen@#9;  |PINTA #Fichero@#6;
               #Fichero@#7 = #Referen@#2;  |PINTA #Fichero@#7;
               #Fichero@#9 = #Referen@#3;  |PINTA #Fichero@#9;
               #Fichero@#13 = #Referen@#16; |PINTA #Fichero@#13;
               #Fichero@#14 = #Referen@#10; |PINTA #Fichero@#14;
               #Fichero@#15 = #Referen@#11; |PINTA #Fichero@#15;
               #Fichero@#18 = #Referen@#4;  |PINTA #Fichero@#18;
               #Fichero@#19 = #Referen@#5;  |PINTA #Fichero@#19;
               #Fichero@#20 = #Referen@#6;  |PINTA #Fichero@#20;
               #Fichero@#21 = #Referen@#7;  |PINTA #Fichero@#21;
               #Fichero@#22 = #Referen@#8;  |PINTA #Fichero@#22;
               #Fichero@#24 = #Referen@#17; |PINTA #Fichero@#24;
            |FINSI;
            |SI aNomDef = "dsmow314";
               #Fichero@#1 = #Referen@#1;  |PINTA #Fichero@#1;
               aAlfa = #Referen@#9; |QBF aAlfa;
               aAlfa = aAlfa + " " + #Referen@#2; |QBF aAlfa;
               aAlfa1 = #Referen@#16; |QBF aAlfa1;
               |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
               aAlfa1 = #Referen@#10; |QBF aAlfa1;
               |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
               aAlfa1 = #Referen@#11; |QBF aAlfa1;
               |SI aAlfa1 ! ""; aAlfa = aAlfa + "-" + aAlfa1; |FINSI;
               #Fichero@#10 = aAlfa;        |PINTA #Fichero@#10;

               aAlfa = (("00" + #Referen@#4) % -102) + (("000" + #Referen@#5) % -103)
               #Fichero@#13 = aAlfa;  |PINTA #Fichero@#13;
               #Fichero@#12 = #Referen@#6;  |PINTA #Fichero@#12;
               #Fichero@#14 = #Referen@#7;  |PINTA #Fichero@#14;
            |FINSI;
            |SI aNomDef = "dsmow318";
               #Fichero@#2 = #Referen@#1;  |PINTA #Fichero@#2;
               #Fichero@#3 = #Referen@#9;  |PINTA #Fichero@#3;
               #Fichero@#4 = #Referen@#2;  |PINTA #Fichero@#4;
               #Fichero@#6 = #Referen@#3;  |PINTA #Fichero@#6;
               #Fichero@#10 = #Referen@#16; |PINTA #Fichero@#10;
               #Fichero@#11 = #Referen@#10; |PINTA #Fichero@#11;
               #Fichero@#12 = #Referen@#11; |PINTA #Fichero@#12;
               #Fichero@#15 = #Referen@#4;  |PINTA #Fichero@#15;
               #Fichero@#16 = #Referen@#5;  |PINTA #Fichero@#16;
               #Fichero@#17 = #Referen@#6;  |PINTA #Fichero@#17;
               #Fichero@#18 = #Referen@#7;  |PINTA #Fichero@#18;
               #Fichero@#19 = #Referen@#8;  |PINTA #Fichero@#19;
               #Fichero@#21 = #Referen@#17; |PINTA #Fichero@#21;
            |FINSI;
            Cmp = -1;
         |FINSI;
      |FINSI;
      |ERROR;

      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|PROCESO T07RelNifs; |TIPO 7;
   aAntNif = #Fichero@#Campo#;
|FPRC;

|PROCESO T00RelNifs;
   |SI #Fichero@#Campo# = aAntNif; |ACABA; |FINSI;

   |SI Cmp = -1;
      |DDEF aAlfa1; |QBF aAlfa1;
      aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#; aNomDef = aAlfa - aAlfa1;
      |SI aNomDef = "dsmow312"; |Y Campo = 0;  Cmp = 2;  |FINSI;
      |SI aNomDef = "dsmow312"; |Y Campo = 5;  Cmp = 6;  |FINSI;
      |SI aNomDef = "dsmow312"; |Y Campo = 13; Cmp = 14; |FINSI;
      |SI aNomDef = "dsmow300"; |Y Campo = 40; Cmp = 999; |FINSI;
      |SI aNomDef = "dsmow313"; |Y Campo = 0;  Cmp = 999; |FINSI;
      |SI aNomDef = "dsmow314"; |Y Campo = 0;  Cmp = 999; |FINSI;
      |SI aNomDef = "dsmow318"; |Y Campo = 0;  Cmp = 999; |FINSI;
   |FINSI;

   |DBASS aAlfa; |QBF aAlfa;
   |SI enSwCod = 1;
      aAlfa1 = aAlfa + "integral/def/dsam0103.mas";
   |SINO;
      aAlfa1 = aAlfa + "basica/def/agim0003.mas";
   |FINSI;
   |CARGA_DEF aAlfa1, Referen@;
   |SI FSalida = 0;
      |SI enSwCod = 1;
         aAlfa1 = aAlfa + "integral/fich/";
      |SINO;
         aAlfa1 = aAlfa + "basica/fich/";
      |FINSI;
      |PATH_DAT #Referen@#aAlfa1#;
      |ABRE #Referen@;
      #Referen@#0 = #Fichero@#Campo#;
      |LEE 000#Referen@.=;
      |SI FSalida = 0;
         |SI Cmp ! 999;
            #Fichero@#Cmp# = #Referen@#1; |PINTA #Fichero@#Cmp#;
         |SINO;
            |SI aNomDef = "dsmow300";
               #Fichero@#43 = #Referen@#1;  |PINTA #Fichero@#43;
               #Fichero@#44 = #Referen@#9;  |PINTA #Fichero@#44;
               #Fichero@#45 = #Referen@#2;  |PINTA #Fichero@#45;
               #Fichero@#51 = #Referen@#16; |PINTA #Fichero@#51;
               #Fichero@#52 = #Referen@#10; |PINTA #Fichero@#52;
               #Fichero@#53 = #Referen@#11; |PINTA #Fichero@#53;
               #Fichero@#57 = #Referen@#4;  |PINTA #Fichero@#57;
               #Fichero@#58 = #Referen@#5;  |PINTA #Fichero@#58;
               #Fichero@#59 = #Referen@#6;  |PINTA #Fichero@#59;
               #Fichero@#60 = #Referen@#7;  |PINTA #Fichero@#60;
               #Fichero@#61 = #Referen@#8;  |PINTA #Fichero@#61;
               #Fichero@#63 = #Referen@#17; |PINTA #Fichero@#63;
            |FINSI;
            |SI aNomDef = "dsmow313";
               #Fichero@#1 = #Referen@#1;  |PINTA #Fichero@#1;
               #Fichero@#6 = #Referen@#9;  |PINTA #Fichero@#6;
               #Fichero@#7 = #Referen@#2;  |PINTA #Fichero@#7;
               #Fichero@#9 = #Referen@#3;  |PINTA #Fichero@#9;
               #Fichero@#13 = #Referen@#16; |PINTA #Fichero@#13;
               #Fichero@#14 = #Referen@#10; |PINTA #Fichero@#14;
               #Fichero@#15 = #Referen@#11; |PINTA #Fichero@#15;
               #Fichero@#18 = #Referen@#4;  |PINTA #Fichero@#18;
               #Fichero@#19 = #Referen@#5;  |PINTA #Fichero@#19;
               #Fichero@#20 = #Referen@#6;  |PINTA #Fichero@#20;
               #Fichero@#21 = #Referen@#7;  |PINTA #Fichero@#21;
               #Fichero@#22 = #Referen@#8;  |PINTA #Fichero@#22;
               #Fichero@#24 = #Referen@#17; |PINTA #Fichero@#24;
            |FINSI;
            |SI aNomDef = "dsmow314";
               #Fichero@#1 = #Referen@#1;  |PINTA #Fichero@#1;
               aAlfa = #Referen@#9; |QBF aAlfa;
               aAlfa = aAlfa + " " + #Referen@#2; |QBF aAlfa;
               aAlfa1 = #Referen@#16; |QBF aAlfa1;
               |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
               aAlfa1 = #Referen@#10; |QBF aAlfa1;
               |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
               aAlfa1 = #Referen@#11; |QBF aAlfa1;
               |SI aAlfa1 ! ""; aAlfa = aAlfa + "-" + aAlfa1; |FINSI;
               #Fichero@#10 = aAlfa;        |PINTA #Fichero@#10;

               aAlfa = (("00" + #Referen@#4) % -102) + (("000" + #Referen@#5) % -103)
               #Fichero@#13 = aAlfa;  |PINTA #Fichero@#13;
               #Fichero@#12 = #Referen@#6;  |PINTA #Fichero@#12;
               #Fichero@#14 = #Referen@#7;  |PINTA #Fichero@#14;
            |FINSI;
            |SI aNomDef = "dsmow318";
               #Fichero@#2 = #Referen@#1;  |PINTA #Fichero@#2;
               #Fichero@#3 = #Referen@#9;  |PINTA #Fichero@#3;
               #Fichero@#4 = #Referen@#2;  |PINTA #Fichero@#4;
               #Fichero@#6 = #Referen@#3;  |PINTA #Fichero@#6;
               #Fichero@#10 = #Referen@#16; |PINTA #Fichero@#10;
               #Fichero@#11 = #Referen@#10; |PINTA #Fichero@#11;
               #Fichero@#12 = #Referen@#11; |PINTA #Fichero@#12;
               #Fichero@#15 = #Referen@#4;  |PINTA #Fichero@#15;
               #Fichero@#16 = #Referen@#5;  |PINTA #Fichero@#16;
               #Fichero@#17 = #Referen@#6;  |PINTA #Fichero@#17;
               #Fichero@#18 = #Referen@#7;  |PINTA #Fichero@#18;
               #Fichero@#19 = #Referen@#8;  |PINTA #Fichero@#19;
               #Fichero@#21 = #Referen@#17; |PINTA #Fichero@#21;
            |FINSI;
            Cmp = -1;
         |FINSI;

      |SINO;
           eaVarDni  =  #Fichero@#Campo#;
           enCalcCif = 0;
           |HAZ CalculameDNI;
           eaVarDni = (eaVarDni + "                ") % 115;
           |SI #Fichero@#Campo# ! eaVarDni;
               |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
               |SI FSalida = 0;
                   #Fichero@#Campo# = eaVarDni;  |PINTA #Fichero@#Campo#;
                   |ERROR;
                   |ACABA;
               |FINSI;
            |FINSI;

            |MENAV "    Nif inexistente";
            |CONFI "0000SContinuar";
            |SI FSalida ! 0;
                |ERROR;
            |FINSI;
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|PROCESO T66RelCp1; |TIPO 66;
   aAlfa = #Fichero@#Campo#; |QBF aAlfa;
   aAlfa = (("00" + aAlfa) % -102); #Fichero@#Campo# = aAlfa; |PINTA #Fichero@#Campo#;

   |DDEF aAlfa1; |QBF aAlfa1;
   aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#; aAlfa = aAlfa - aAlfa1;
   |SI aAlfa = "dsmow318"; |Y Campo = 15; nCalc = 18; |FINSI;
   |SI aAlfa = "dsmow326"; |Y Campo = 10; nCalc = 13; |FINSI;
   |SI aAlfa = "dsmow330"; |Y Campo = 16; nCalc = 19; |FINSI;
   |SI aAlfa = "dsmow329"; |Y Campo = 14; nCalc = 18; |FINSI;

   #reprovi@#0 = #Fichero@#Campo#;
   |LEE 000#reprovi@.];
   |CONSULTA_CLAVE #1#reprovi@;
   |SI FSalida = 0;
      #Fichero@#Campo# = #reprovi@#0; |PINTA #Fichero@#Campo#;
      #Fichero@#nCalc# = #reprovi@#1; |PINTA #Fichero@#nCalc#;
   |FINSI;
|FPRC;

|PROCESO T00RelCp1;
   aAlfa = #Fichero@#Campo#; |QBF aAlfa;
   aAlfa = (("00" + aAlfa) % -102); #Fichero@#Campo# = aAlfa; |PINTA #Fichero@#Campo#;

   |DDEF aAlfa1; |QBF aAlfa1;
   aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#; aAlfa = aAlfa - aAlfa1;
   |SI aAlfa = "dsmow318"; |Y Campo = 15; nCalc = 18; nSwPasaCero = 0; |FINSI;
   |SI aAlfa = "dsmow326"; |Y Campo = 10; nCalc = 13; nSwPasaCero = 0; |FINSI;
   |SI aAlfa = "dsmow330"; |Y Campo = 16; nCalc = 19; nSwPasaCero = 1; |FINSI;
   |SI aAlfa = "dsmow329"; |Y Campo = 14; nCalc = 18; nSwPasaCero = 0; |FINSI;

   #reprovi@#0 = #Fichero@#Campo#;
   |LEE 000#reprovi@.=;
   |SI FSalida = 0;
      #Fichero@#nCalc# = #reprovi@#1; |PINTA #Fichero@#nCalc#;
   |SINO;
      |SI nSwPasaCero = 0; |O #Fichero@#Campo# ! 0;
         |MENAV "    Provincia inexistente"; |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO InfPob;
   #repobla@#0 = #Fichero@#nCalc#;
   #repobla@#1 = 000;
|FPRC;

|PROCESO SupPob;
   #repobla@#0 = #Fichero@#nCalc#;
   #repobla@#1 = 999;
|FPRC;

|PROCESO T66RelCp2; |TIPO 66;
   aAlfa = #Fichero@#Campo#; |QBF aAlfa;
   aAlfa = (("000" + aAlfa) % -103); #Fichero@#Campo# = aAlfa; |PINTA #Fichero@#Campo#;

   nCalc = Campo - 1;
   #repobla@#0 = #Fichero@#nCalc#;
   #repobla@#1 = #Fichero@#Campo#;
   |LEE 000#repobla@.];
   |CONSULTA_F_CLAVE #1#repobla@, InfPob, SupPob;
   |SI FSalida = 0;
      #Fichero@#nCalc# = #repobla@#0; |PINTA #Fichero@#nCalc#;
      #Fichero@#Campo# = #repobla@#1; |PINTA #Fichero@#Campo#;

      |DDEF aAlfa1; |QBF aAlfa1;
      aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#; aAlfa = aAlfa - aAlfa1;
      |SI aAlfa = "dsmow318"; |Y Campo = 16; nCalc = 17; |FINSI;
      |SI aAlfa = "dsmow326"; |Y Campo = 11; nCalc = 12; |FINSI;
      |SI aAlfa = "dsmow330"; |Y Campo = 17; nCalc = 18; |FINSI;
      |SI aAlfa = "dsmow329"; |Y Campo = 15; nCalc = 17; |FINSI;
      |SI enSwCod = 1;
         #Fichero@#nCalc# = #repobla@#3;
      |SINO;
         #Fichero@#nCalc# = #repobla@#2;
      |FINSI;
      |PINTA #Fichero@#nCalc#;
   |FINSI;
|FPRC;

|PROCESO T00RelCp2;
   aAlfa = #Fichero@#Campo#; |QBF aAlfa;
   aAlfa = (("000" + aAlfa) % -103); #Fichero@#Campo# = aAlfa; |PINTA #Fichero@#Campo#;

   nCalc = Campo - 1;
   #repobla@#0 = #Fichero@#nCalc#;
   #repobla@#1 = #Fichero@#Campo#;
   |LEE 000#repobla@.=;
   |SI FSalida = 0;
      |DDEF aAlfa1; |QBF aAlfa1;
      aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#; aAlfa = aAlfa - aAlfa1;
      |SI aAlfa = "dsmow318"; |Y Campo = 16; nCalc = 17; nSwPasaCero = 0; |FINSI;
      |SI aAlfa = "dsmow326"; |Y Campo = 11; nCalc = 12; nSwPasaCero = 0; |FINSI;
      |SI aAlfa = "dsmow330"; |Y Campo = 17; nCalc = 18; nSwPasaCero = 1; |FINSI;
      |SI aAlfa = "dsmow329"; |Y Campo = 15; nCalc = 17; nSwPasaCero = 0; |FINSI;
      |SI enSwCod = 1;
         #Fichero@#nCalc# = #repobla@#3;
      |SINO;
         #Fichero@#nCalc# = #repobla@#2;
      |FINSI;
      |PINTA #Fichero@#nCalc#;
   |SINO;
      |SI nSwPasaCero = 0; |O #Fichero@#Campo# ! 0;
         |MENAV "    Poblacion inexistente"; |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO VerPais;
   |SELECT #3#rpaises@;
   #rpaises@#4 = aAlfa4;
   |LEE 000#rpaises@.=;
   |SI FSalida = 0;
       aAlfa4 = #rpaises@#0;
   |FINSI;
   |SELECT #1#rpaises@;

|FPRC;

|PROCESO ActDatosBanco;
       eaIBAN = "";
       eaCta  = aIBAN;
       eaPais = "ES";
       |HAZ CalcuIBAN;

       |SI eaIBAN ! "";
           |ABRE #dsm210db;
           #dsm210db#0  = #Referen@#0;
           |LEE 101#dsm210db.=;
           |SI FSalida ! 0;
               |DDEFECTO #dsm210db;
               #dsm210db#0  = #Referen@#0;
               |GRABA 020#dsm210db.b;
           |FINSI;
           #dsm210db#1 = eaIBAN %  104;
           #dsm210db#2 = eaIBAN %  504;
           #dsm210db#3 = eaIBAN %  904;
           #dsm210db#4 = eaIBAN % 1304;
           #dsm210db#5 = eaIBAN % 1704;
           #dsm210db#6 = eaIBAN % 2104;
           |GRABA 020#dsm210db.a;
           |LIBERA #dsm210db;
           |CIERRA #dsm210db;
       |FINSI;
|FPRC;

|PROCESO Actualiza;
   aIBAN = "";
   |DBASS aAlfa; |QBF aAlfa;
   |SI enSwCod = 1;
      aAlfa1 = aAlfa + "integral/def/dsam0000.mas";
      aAlfa3 = aAlfa + "integral/def/dsam0103.mas";
      aAlfaF4 = aAlfa + "integral/def/dsam0003.mas";
   |SINO;
      aAlfa1 = aAlfa + "basica/def/agifigen.mas";
      aAlfa3 = aAlfa + "basica/def/agim0003.mas";
      aAlfaF4 = "";
   |FINSI;
   |CARGA_DEF aAlfa1, Referen@;
   |SI FSalida = 0;
      aAlfa2 = aAlfa + "basica/def/agidanif.mas";
      |CARGA_DEF aAlfa2, Refere1@;
      |SI FSalida = 0;
         aAlfa2 = aAlfa + "basica/def/agim0004.mas";
         |CARGA_DEF aAlfa2, Refere2@;
         |SI FSalida = 0;
            |CARGA_DEF aAlfa3, Refere3@;
            |SI FSalida = 0;
               |SI enSwCod = 1;
                  |CARGA_DEF aAlfaF4, Refere4@;
                  nSwError = FSalida;
               |SINO;
                  nSwError = 0;
               |FINSI;
               |SI nSwError = 0;
                  |SI enSwCod = 1;
                     aAlfa1 = aAlfa + "integral/fich/";
                     |PATH_DAT #Referen@#aAlfa1#; |PATH_DAT #Refere3@#aAlfa1#;
                     |PATH_DAT #Refere4@#aAlfa1#; |ABRE #Refere4@;
                  |SINO;
                     aAlfa1 = aAlfa + "basica/fich/";
                     |PATH_DAT #Referen@#aAlfa1#; |PATH_DAT #Refere3@#aAlfa1#;
                  |FINSI;
                  aAlfa1 = aAlfa + "basica/fich/";
                  |PATH_DAT #Refere1@#aAlfa1#; |PATH_DAT #Refere2@#aAlfa1#;
                  |ABRE #Referen@; |ABRE #Refere1@; |ABRE #Refere2@; |ABRE #Refere3@;

                  #Referen@#0 = #dsm210dp#0;
                  |LEE 000#Referen@.=;
                  |SI FSalida = 0;
                     |SI enSwCod = 1;
                        #Refere1@#0 = #Referen@#3;
                     |SINO;
                        #Refere1@#0 = #Referen@#13;
                     |FINSI;
                     #Refere1@#1 = 1;
                     |LEE 000#Refere1@.=;
                     |SI FSalida ! 0; |DDEFECTO #Refere1@; |FINSI;

                     |SI enSwCod = 1;
                        #Refere3@#0 = #Referen@#3;
                     |SINO;
                        #Refere3@#0 = #Referen@#13;
                     |FINSI;
                     |LEE 000#Refere3@.=;
                     |SI FSalida ! 0; |DDEFECTO #Refere3@; |FINSI;

                     |SI enSwCod = 1;
                        #Refere4@#0 = #Referen@#0;
                        |LEE 000#Refere4@.=;
                        |SI FSalida ! 0; |DDEFECTO #Refere4@; |FINSI;
                     |FINSI;

                     #Refere2@#0 = #Referen@#0;
                     #Refere2@#1 = 1;
                     |LEE 000#Refere2@.];
                     |SI FSalida ! 0; |O #Refere2@#0 ! #Referen@#0; |DDEFECTO #Refere2@; |FINSI;

                     #dsm210dp#0  = #Referen@#0;
                     |LEE 101#dsm210dp.=;
                     |SI FSalida = 0;
                        |SI enSwCod = 1;
                           #dsm210dp#1  = #Referen@#1;
                           #dsm210dp#2  = #Referen@#3;
                           #dsm210dp#4  = #Refere4@#67;
                           aAlfa1 = #dsm210dp#5; |QBF aAlfa1;
                           |SI  aAlfa1 = "";
                                #dsm210dp#5  = #Refere4@#22;
                           |FINSI;
                           |SI #Refere4@#75 = "N";
                               #dsm210dp#8  = #Refere4@#14;
                               #dsm210dp#9  = #Refere4@#15;
                               #dsm210dp#10 = "NUM";
                               #dsm210dp#11 = #Refere4@#16;
                               #dsm210dp#15 = #Refere4@#17;
                               #dsm210dp#16 = #Refere4@#18;
                               #dsm210dp#17 = #Refere4@#19;
                               #dsm210dp#18 = #Refere4@#80;
                               #dsm210dp#19 = #Refere4@#81;
                               #dsm210dp#20 = #Refere4@#20;
                               #dsm210dp#21 = #Refere4@#21;
                               #dsm210dp#22 = #Refere4@#22;

                               #reprovi@#0 = #Refere4@#20;
                               |LEE 000#reprovi@.=;
                               |SI FSalida ! 0; |DDEFECTO #reprovi@; |FINSI;
                               #dsm210dp#23 = #reprovi@#1;
                           |FINSI;
                           aAlfa = #dsm210dp#9; |QBF aAlfa;
                           |SI aAlfa ! "";
                              #dsm210dp#24 = #Refere4@#12;
                              #dsm210dp#25 = #Refere4@#71;
                              #dsm210dp#26 = #Refere4@#74;
                           |FINSI;

                           aIBAN = #Refere4@#53;

                           |SI #Refere4@#75 = "S";
                               aAlfa = #Refere4@#82; |QBF aAlfa;
                               aAlfa1 = aAlfa % 0150;
                               |SI aAlfa1 ! aAlfa;
                                   aAlfa2 = aAlfa1 % -101; aAlfa1 = aAlfa1 % -299;
                                   |PARA; |SI aAlfa2 ! " "; |Y aAlfa2 ! "."; |Y aAlfa2 ! ";";
                                          |Y aAlfa2 ! ","; |Y aAlfa2 ! ":"; |Y aAlfa2 ! "_"; |HACIENDO;
                                     aAlfa2 = aAlfa1 % -101; aAlfa1 = aAlfa1 % -299;
                                   |SIGUE;
                                   aAlfa = aAlfa1 - aAlfa;
                                   |SI aAlfa1 = ""; aAlfa1 = aAlfa; |FINSI;
                               |FINSI;
                               #dsm210dp#27 = #Refere4@#82;  || aAlfa1;
                               #dsm210dp#28 = #Refere4@#83;  || aAlfa;
                               #dsm210dp#29 = #Refere4@#84;
                               #dsm210dp#30 = #Refere4@#85;
                               #dsm210dp#31 = #Refere4@#86;
                               #dsm210dp#32 = #Refere4@#87;
                               aAlfa4 = #Refere4@#88; |HAZ VerPais;
                               #dsm210dp#33 = aAlfa4;  ||  #Refere4@#88
                               aAlfa = #dsm210dp#27; |QBF aAlfa;
                               |SI aAlfa ! "";
                                   #dsm210dp#34 = #Refere4@#12;
                                   #dsm210dp#35 = #Refere4@#71;
                                   #dsm210dp#36 = #Refere4@#74;
                               |FINSI;
                           |FINSI;
                           #dsm210dp#103 = #Referen@#85;
                        |FINSI;
                        |SI enSwCod = 2;
                           aIBAN = #Referen@#81 + #Referen@#82 + #Referen@#83 + #Referen@#84;

                           #dsm210dp#1  = #Refere1@#12;
                           #dsm210dp#2  = #Refere1@#0;
                           #dsm210dp#4  = #Refere1@#13;
                           #dsm210dp#5  = #Refere1@#32;
                           #dsm210dp#8  = #Refere1@#24;
                           #dsm210dp#9  = #Refere1@#25;
                           #dsm210dp#10 = "NUM";
                           #dsm210dp#11 = #Refere1@#26;
                           #dsm210dp#15 = #Refere1@#27;
                           #dsm210dp#16 = #Refere1@#28;
                           #dsm210dp#17 = #Refere1@#29;
                           #dsm210dp#20 = #Refere1@#30;
                           #dsm210dp#21 = #Refere1@#31;
                           #dsm210dp#22 = #Refere1@#32;
                           #dsm210dp#23 = #Refere1@#33;
                           #dsm210dp#24 = #Refere1@#34;
                           #dsm210dp#25 = #Refere1@#35;
                           #dsm210dp#26 = #Refere3@#17;
                           aAlfa = #dsm210dp#27; |QBF aAlfa;
                           |SI aAlfa = "";
                              aAlfa = #Refere1@#24;
                              aAlfa1 = #Refere1@#25; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + " " + aAlfa1; |FINSI;
                              aAlfa1 = #Refere1@#26; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
                              aAlfa1 = #Refere1@#27; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + ", Esc." + aAlfa1; |FINSI;
                              aAlfa1 = #Refere1@#28; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1 + "§"; |FINSI;
                              aAlfa1 = #Refere1@#29; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + "-" + aAlfa1 + "§"; |FINSI;
                              #dsm210dp#27 = aAlfa;
                              #dsm210dp#29 = #Refere1@#32;
                              #dsm210dp#31 = (("00" + #Refere1@#30) % -102) + (("000" + #Refere1@#31) % -103);
                              #dsm210dp#32 = #Refere1@#33;
                              #dsm210dp#34 = #Refere1@#34;
                              #dsm210dp#35 = #Refere1@#35;
                              #dsm210dp#36 = #Refere3@#17;
                           |FINSI;
                           #dsm210dp#103 = "A";
                           |SI #Referen@#94 ] "01.01.1900";
                               #dsm210dp#103 = "I";
                           |FINSI;
                        |FINSI;

                        |SI enSwCod = 1;
                           ||  ...#dsm210dp#3 = #Referen@#79;
                        |SINO;
                           #dsm210dp#11 = #Refere1@#32;
                        |FINSI;
                        |HAZ ElColorLinea;
                        |GRABA 020#dsm210dp.a; |LIBERA #dsm210dp;

                        |HAZ ActDatosBanco;
                     |FINSI;
                     |SI enSwCod = 1; |CIERRA #Refere4@; |DESCARGA_DEF #Refere4@; |FINSI;
                  |FINSI;
                  |CIERRA #Referen@; |CIERRA #Refere1@; |CIERRA #Refere2@; |CIERRA #Refere3@;
                  |DESCARGA_DEF #Refere3@;
               |FINSI;
            |FINSI;
            |DESCARGA_DEF #Refere2@;
         |FINSI;
         |DESCARGA_DEF #Refere1@;
      |FINSI;
      |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|PROCESO DesgDir;
   |VENTANA 0506, 3394, -1, 17, "Desglose direccion pais de residencia"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PAUSA;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
|FPRC;

|PROCESO CtaBanco;
   |VENTANA 1111, 2789, -1, 17, "Cuenta bancaria por defecto"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |ABRE #dsm210db;
   #dsm210db#0 = #dsm210dp#0;
   |LEE 101#dsm210db.=;
   |SI FSalida ! 0;
      |DDEFECTO #dsm210db;
      #dsm210db#0 = #dsm210dp#0;
      |GRABA 020#dsm210db.b;
   |FINSI;
   |PARA nContCmp = 0; |SI nContCmp [ 24; |HACIENDO nContCmp = nContCmp + 1;
      nCalc = nContCmp + 1;
      #dsmow339#nContCmp# = #dsm210db#nCalc#;
   |SIGUE;

   |PINPA #0#dsmow339; nPant2 = FSalida;
   |PINDA #0#dsmow339;

   |ENDATOS #1#dsmow339;
   |SI FSalida = 0;
      |PARA nContCmp = 0; |SI nContCmp [ 24; |HACIENDO nContCmp = nContCmp + 1;
         nCalc = nContCmp + 1;
         #dsm210db#nCalc# = #dsmow339#nContCmp#;
      |SIGUE;
      |GRABA 020#dsm210db.a;
   |FINSI;
   |LIBERA #dsm210db; |CIERRA #dsm210db;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent1;
|FPRC;

|PROCESO DatosPersonalesT;
   Cmp = -1;
   |VENTANA 0506, 3394, -1, 17, "Datos personales del contribuyente"; nVent0 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent0;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   aAlfa = "    N" + &191 + " Actualizar datos personales del contribuyente ? ";
   |CONFI aAlfa;
   |SI FSalida = 0; |HAZ Actualiza; |FINSI;

   |LEE 101#dsm210dp.=;
   |SI FSalida = 0;
      |DDEFECTO #dsmow300;
      #dsmow300#0  = #dsm210dp#0;
      #dsmow300#1  = #dsm210dp#1;
      #dsmow300#2  = #dsm210dp#2;
      #dsmow300#3  = #dsm210dp#3;
      #dsmow300#4  = #dsm210dp#4;
      #dsmow300#5  = #dsm210dp#5;
      #dsmow300#6  = #dsm210dp#6;

      #rpaises@#0 = #dsmow300#6;
      |LEE 000#rpaises@.=;
      |SI FSalida ! 0; |DDEFECTO #rpaises@; |FINSI;
      #dsmow300#7  = #rpaises@#1;

      #dsmow300#8  = #dsm210dp#7;

      #rpaises@#0 = #dsmow300#8;
      |LEE 000#rpaises@.=;
      |SI FSalida ! 0; |DDEFECTO #rpaises@; |FINSI;
      #dsmow300#9  = #rpaises@#1;

      #dsmow300#10 = #dsm210dp#8;
      #dsmow300#11 = #dsm210dp#9;
      #dsmow300#12 = #dsm210dp#10;
      #dsmow300#13 = #dsm210dp#11;
      #dsmow300#14 = #dsm210dp#12;
      #dsmow300#15 = #dsm210dp#13;
      #dsmow300#16 = #dsm210dp#14;
      #dsmow300#17 = #dsm210dp#15;
      #dsmow300#18 = #dsm210dp#16;
      #dsmow300#19 = #dsm210dp#17;
      #dsmow300#20 = #dsm210dp#18;
      #dsmow300#21 = #dsm210dp#19;
      #dsmow300#22 = #dsm210dp#20;
      #dsmow300#23 = #dsm210dp#21;
      #dsmow300#24 = #dsm210dp#22;
      #dsmow300#25 = #dsm210dp#23;
      #dsmow300#26 = #dsm210dp#24;
      #dsmow300#27 = #dsm210dp#25;
      #dsmow300#28 = #dsm210dp#26;
      #dsmow300#29 = #dsm210dp#27;
      #dsmow300#30 = #dsm210dp#28;
      #dsmow300#31 = #dsm210dp#29;
      #dsmow300#32 = #dsm210dp#30;
      #dsmow300#33 = #dsm210dp#31;
      #dsmow300#34 = #dsm210dp#32;
      #dsmow300#35 = #dsm210dp#33;

      #rpaises@#0 = #dsmow300#35;
      |LEE 000#rpaises@.=;
      |SI FSalida ! 0; |DDEFECTO #rpaises@; |FINSI;
      #dsmow300#36 = #rpaises@#1;

      #dsmow300#37 = #dsm210dp#34;
      #dsmow300#38 = #dsm210dp#35;
      #dsmow300#39 = #dsm210dp#36;
      #dsmow300#40 = #dsm210dp#37;
      #dsmow300#41 = #dsm210dp#38;
      #dsmow300#42 = #dsm210dp#40;
      #dsmow300#43 = #dsm210dp#39;
      #dsmow300#44 = #dsm210dp#41;
      #dsmow300#45 = #dsm210dp#42;
      #dsmow300#46 = #dsm210dp#43;
      #dsmow300#47 = #dsm210dp#44;
      #dsmow300#48 = #dsm210dp#45;
      #dsmow300#49 = #dsm210dp#46;
      #dsmow300#50 = #dsm210dp#47;
      #dsmow300#51 = #dsm210dp#48;
      #dsmow300#52 = #dsm210dp#49;
      #dsmow300#53 = #dsm210dp#50;
      #dsmow300#54 = #dsm210dp#51;
      #dsmow300#55 = #dsm210dp#52;
      #dsmow300#56 = #dsm210dp#56;
      #dsmow300#65 = ("00000" + #dsm210dp#56) % -105;
      #dsmow300#66 = (("00" + #dsmow300#57) % -102) + (("000" + #dsmow300#58) % -103);
      #dsmow300#57 = #dsm210dp#53;
      #dsmow300#58 = #dsm210dp#54;
      #dsmow300#59 = #dsm210dp#55;
      #dsmow300#60 = #dsm210dp#57;
      #dsmow300#61 = #dsm210dp#58;
      #dsmow300#62 = #dsm210dp#59;
      #dsmow300#63 = #dsm210dp#60;
      #dsmow300#64 = #dsm210dp#61;
      #dsmow300#67 = #dsm210dp#62;
      #dsmow300#68 = #dsm210dp#63;
      #dsmow300#69 = #dsm210dp#103;

      |PINPA #0#dsmow300; nPant1 = FSalida;
      |PINDA #0#dsmow300;

      || nPos1 = 1073; nPos2 = 1088;
      nPos1 = 0965; nPos2 = 0988;
      |CONTROL_SIMPLE nPant1, "BOTON,{{197}}&Cuenta banco", nPos1, nPos2, CtaBanco;
      nBotonCtaBanco = FSalida;

      ||nPos1 = 1273; nPos2 = 1288;
      nPos1 = 1065; nPos2 = 1088;
      |CONTROL_SIMPLE nPant1, "BOTON,{{197}}&Pase datos a renta/patrimonio", nPos1, nPos2, PaseRenta;
      nBotonPaseRenta = FSalida;
      |PTEC 802; |PAUSA;

      |ENDATOS #1#dsmow300;
      |SI FSalida = 0;
         #dsm210dp#3  = #dsmow300#3;
         #dsm210dp#4  = #dsmow300#4;
         #dsm210dp#5  = #dsmow300#5;
         #dsm210dp#6  = #dsmow300#6;
         #dsm210dp#7  = #dsmow300#8;
         #dsm210dp#8  = #dsmow300#10;
         #dsm210dp#9  = #dsmow300#11;
         #dsm210dp#10 = #dsmow300#12;
         #dsm210dp#11 = #dsmow300#13;
         #dsm210dp#12 = #dsmow300#14;
         #dsm210dp#13 = #dsmow300#15;
         #dsm210dp#14 = #dsmow300#16;
         #dsm210dp#15 = #dsmow300#17;
         #dsm210dp#16 = #dsmow300#18;
         #dsm210dp#17 = #dsmow300#19;
         #dsm210dp#18 = #dsmow300#20;
         #dsm210dp#19 = #dsmow300#21;
         #dsm210dp#20 = #dsmow300#22;
         #dsm210dp#21 = #dsmow300#23;
         #dsm210dp#22 = #dsmow300#24;
         #dsm210dp#23 = #dsmow300#25;
         #dsm210dp#24 = #dsmow300#26;
         #dsm210dp#25 = #dsmow300#27;
         #dsm210dp#26 = #dsmow300#28;
         #dsm210dp#27 = #dsmow300#29;
         #dsm210dp#28 = #dsmow300#30;
         #dsm210dp#29 = #dsmow300#31;
         #dsm210dp#30 = #dsmow300#32;
         #dsm210dp#31 = #dsmow300#33;
         #dsm210dp#32 = #dsmow300#34;
         #dsm210dp#33 = #dsmow300#35;
         #dsm210dp#34 = #dsmow300#37;
         #dsm210dp#35 = #dsmow300#38;
         #dsm210dp#36 = #dsmow300#39;
         #dsm210dp#37 = #dsmow300#40;
         #dsm210dp#38 = #dsmow300#41;
         #dsm210dp#40 = #dsmow300#42;
         #dsm210dp#39 = #dsmow300#43;
         #dsm210dp#41 = #dsmow300#44;
         #dsm210dp#42 = #dsmow300#45;
         #dsm210dp#43 = #dsmow300#46;
         #dsm210dp#44 = #dsmow300#47;
         #dsm210dp#45 = #dsmow300#48;
         #dsm210dp#46 = #dsmow300#49;
         #dsm210dp#47 = #dsmow300#50;
         #dsm210dp#48 = #dsmow300#51;
         #dsm210dp#49 = #dsmow300#52;
         #dsm210dp#50 = #dsmow300#53;
         #dsm210dp#51 = #dsmow300#54;
         #dsm210dp#52 = #dsmow300#55;
         #dsm210dp#56 = #dsmow300#65;
         #dsm210dp#53 = #dsmow300#57;
         #dsm210dp#54 = #dsmow300#58;
         #dsm210dp#55 = #dsmow300#59;
         #dsm210dp#57 = #dsmow300#60;
         #dsm210dp#58 = #dsmow300#61;
         #dsm210dp#59 = #dsmow300#62;
         #dsm210dp#60 = #dsmow300#63;
         #dsm210dp#61 = #dsmow300#64;
         #dsm210dp#62 = #dsmow300#67;
         #dsm210dp#63 = #dsmow300#68;
         #dsm210dp#103 = #dsmow300#69;
         |HAZ ElColorLinea;
         |GRABA 020#dsm210dp.a;
      |FINSI;

      |FIN_CONTROL_WINDOWS nBotonPaseRenta;
      |FIN_CONTROL_WINDOWS nBotonCtaBanco;
   |FINSI;

   aVent4 = nVent0;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent0;

   |REFRESCACONTROL nGrid0;
|FPRC;

|PROCESO DatosPersonalesC;
   |ESTADO_CONTROL nBotonNueCt, "DISABLE";
   |ESTADO_CONTROL nBotonBorCt, "DISABLE";
   |ESTADO_CONTROL nBotonValCatMas, "DISABLE";
   |ESTADO_CONTROL nTree0, "DISABLE";
   |ESTADO_CONTROL nGrid0, "DISABLE";

   |HAZ DatosConyuge;

   |ESTADO_CONTROL nBotonValCatMas, "ENABLE";
   |ESTADO_CONTROL nBotonNueCt, "ENABLE";
   |ESTADO_CONTROL nBotonBorCt, "ENABLE";
   |ESTADO_CONTROL nTree0, "ENABLE";
   |ESTADO_CONTROL nGrid0, "ENABLE";

   |REFRESCACONTROL nGrid0;
|FPRC;

/***************************************************************************
*********                     FIN DATOS PERSONALES                 *********
****************************************************************************/

/***************************************************************************
*********                       GESTION INMUEBLES                  *********
****************************************************************************/

|PROCESO Tipo00CodPrv;
   |SI FSalida = 2; |ACABA; |FINSI;
   aAlfa = #dsmow304#13; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
   #dsmow304#13 = aAlfa; |PINTA #dsmow304#13;
   #reprovi@#0 = #dsmow304#13;
   |LEE 000#reprovi@.=;
   |SI FSalida = 0;
      #dsmow304#17 = #reprovi@#1;
   |SINO;
      |MENAV "    Provincia inexistente"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO Tipo66CodPrv; |TIPO 66;
   aAlfa = #dsmow304#13; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102; #dsmow304#13 = aAlfa;
   #reprovi@#0 = #dsmow304#13;
   |LEE 000#reprovi@.];
   |CONSULTA_CLAVE #1#reprovi@;
   |SI FSalida = 0;
      aAlfa = #reprovi@#0; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
      #dsmow304#13 = aAlfa; |PINTA #dsmow304#13;
      #dsmow304#17 = #reprovi@#1; |PINTA #dsmow304#17;
   |FINSI;
|FPRC;

|PROCESO Tipo00CodPob;
   |SI FSalida = 2; |ACABA; |FINSI;

   nSalida = FSalida;
   aAlfa = #dsmow304#13; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
   #dsmow304#13 = aAlfa; |PINTA #dsmow304#13;
   aAlfa = #dsmow304#14; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   #dsmow304#14 = aAlfa; |PINTA #dsmow304#14;

   #repobla@#0 = #dsmow304#13;
   #repobla@#1 = #dsmow304#14;
   |LEE 000#repobla@.=;
   |SI FSalida = 0;
      |SI enSwCod = 1;
         #dsmow304#15 = #repobla@#3;
      |SINO;
         #dsmow304#15 = #repobla@#2;
      |FINSI;
   |SINO;
      |MENAV "    Poblacion inexistente"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO InfPob210;
   #repobla@#0 = #dsmow304#13;
   #repobla@#1 = 000;
|FPRC;

|PROCESO SupPob210;
   #repobla@#0 = #dsmow304#13;
   #repobla@#1 = 999;
|FPRC;

|PROCESO Tipo66CodPob; |TIPO 66;
   aAlfa = #dsmow304#13; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102; #dsmow304#13 = aAlfa;
   aAlfa = #dsmow304#14; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103; #dsmow304#14 = aAlfa;
   #repobla@#0 = #dsmow304#13;
   #repobla@#1 = #dsmow304#14;
   |LEE 000#repobla@.];
   |CONSULTA_F_CLAVE #1#repobla@, InfPob210, SupPob210;
   |SI FSalida = 0;
      |SI enSwCod = 1;
         aAlfa = #repobla@#1; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
         #dsmow304#14 = aAlfa; |PINTA #dsmow304#14;
         #dsmow304#15 = #repobla@#3;
      |SINO;
         aAlfa = #repobla@#1; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
         #dsmow304#14 = aAlfa; |PINTA #dsmow304#14;
         #dsmow304#15 = #repobla@#2;
      |FINSI;
   |FINSI;
   |PINTA #dsmow304#14; |PINTA #dsmow304#15;
|FPRC;

|PROCESO EvtoGrid2;
   |SI nSinEvto = 1; |ACABA; |FINSI;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsminmex.=;
      |SI FSalida ! 0; |O #dsminmex#0 ! #dsm210dp#0; |DDEFECTO #dsminmex; |FINSI;

      |SI nModoIn = 0;
         |ESTADO_CONTROL nBotonModInm, "ENABLE";
         |ESTADO_CONTROL nBotonBorInm, "ENABLE";
      |FINSI;

      #dsmow304#0  = #dsminmex#2; |PINTA #dsmow304#0;
      #dsmow304#1  = #dsminmex#3; |PINTA #dsmow304#1;
      #dsmow304#2  = #dsminmex#4; |PINTA #dsmow304#2;
      #dsmow304#3  = #dsminmex#5; |PINTA #dsmow304#3;
      #dsmow304#4  = #dsminmex#6; |PINTA #dsmow304#4;
      #dsmow304#5  = #dsminmex#7; |PINTA #dsmow304#5;
      #dsmow304#6  = #dsminmex#8; |PINTA #dsmow304#6;
      #dsmow304#7  = #dsminmex#9; |PINTA #dsmow304#7;
      #dsmow304#8  = #dsminmex#10; |PINTA #dsmow304#8;
      #dsmow304#9  = #dsminmex#11; |PINTA #dsmow304#9;
      #dsmow304#10 = #dsminmex#12; |PINTA #dsmow304#10;
      #dsmow304#11 = #dsminmex#13; |PINTA #dsmow304#11;
      #dsmow304#12 = #dsminmex#14; |PINTA #dsmow304#12;
      #dsmow304#13 = #dsminmex#15; |PINTA #dsmow304#13;
      #dsmow304#14 = #dsminmex#16; |PINTA #dsmow304#14;
      #dsmow304#15 = #dsminmex#17; |PINTA #dsmow304#15;
      #dsmow304#16 = #dsminmex#18;
      #dsmow304#17 = #dsminmex#19; |PINTA #dsmow304#17;
      #dsmow304#19 = #dsminmex#22; |PINTA #dsmow304#19;
      #dsmow304#20 = #dsminmex#23; |PINTA #dsmow304#20;
      #dsmow304#22 = #dsminmex#31; |PINTA #dsmow304#22;
      #dsmow304#23 = #dsminmex#32; |PINTA #dsmow304#23;
   |FINSI;

   |SI FSalida = 4;
      |SI #dsminmex#20 = "A";
         #dsminmex#20 = "D";
         #dsminmex#21 = "190,190,190;255,255,255";
      |SINO;
         #dsminmex#20 = "A";
         #dsminmex#21 = "49,106,197;255,255,255";
      |FINSI;
      |GRABA 020#dsminmex.a;
      |REFRESCACONTROL nGrid2;
   |FINSI;
|FPRC;

|PROCESO InfInmEx;
   #dsminmex#0 = #dsm210dp#0;
   #dsminmex#1 = 001;
|FPRC;

|PROCESO SupInmEx;
   #dsminmex#0 = #dsm210dp#0;
   #dsminmex#1 = 999;
|FPRC;

|PROCESO VentanaInmuebles;
   nNivelLins = 1;

   InNivel = nNivel1<-;
   nNivel1 = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;

   |ESTADO_CONTROL nBotonNueInm, "DISABLE";
   |ESTADO_CONTROL nGrid2, "DISABLE";
   |ESTADO_CONTROL nIdSalir, "HIDE";

   nSinEvto = 1;
   |ENDATOS #1#dsmow304;
   |SI FSalida = 0;
      #dsminmex#2  = #dsmow304#0;
      #dsminmex#3  = #dsmow304#1;
      #dsminmex#4  = #dsmow304#2;
      #dsminmex#5  = #dsmow304#3;
      #dsminmex#6  = #dsmow304#4;
      #dsminmex#7  = #dsmow304#5;
      #dsminmex#8  = #dsmow304#6;
      #dsminmex#9  = #dsmow304#7;
      #dsminmex#10 = #dsmow304#8;
      #dsminmex#11 = #dsmow304#9;
      #dsminmex#12 = #dsmow304#10;
      #dsminmex#13 = #dsmow304#11;
      #dsminmex#14 = #dsmow304#12;
      #dsminmex#15 = #dsmow304#13;
      #dsminmex#16 = #dsmow304#14;
      #dsminmex#17 = #dsmow304#15;
      #dsminmex#18 = #dsmow304#16;
      #dsminmex#19 = #dsmow304#17;
      #dsminmex#22 = #dsmow304#19;
      #dsminmex#23 = #dsmow304#20;
      #dsminmex#31 = #dsmow304#22;
      #dsminmex#32 = #dsmow304#23;
      |HAZ BuscoRevisado;
      |GRABA 020#dsminmex.a;
      |LIBERA #dsminmex;
   |SINO;
      |SI nModoIn = 1; |BORRA 020#dsminmex.a; |FINSI;
   |FINSI;
   nSinEvto = 0;
   |REFRESCACONTROL nGrid2;

   |ESTADO_CONTROL nIdSalir, "SHOW";
   |ESTADO_CONTROL nGrid2, "ENABLE";
   |ESTADO_CONTROL nBotonNueInm, "ENABLE";

   |FOCOTECLADO nGrid2;
   nNivelLins = 0;
|FPRC;

|PROCESO BotonNueInm;
   nModoIn = 1;

   nCalc = 1;
   #dsminmex#0 = #dsm210dp#0;
   #dsminmex#1 = 999;
   |LEE 000#dsminmex.];
   |SI FSalida = 0;
      |LEE 000#dsminmex.a;
   |SINO;
      |LEE 000#dsminmex.u;
   |FINSI;
   |SI FSalida = 0; |Y #dsminmex#0 = #dsm210dp#0;
      nCalc = #dsminmex#1 + 1;
   |FINSI;

   |DDEFECTO #dsminmex;
   #dsminmex#0 = #dsm210dp#0;
   #dsminmex#1 = nCalc;
   |GRABA 020#dsminmex.b;

   |REFRESCACONTROL nGrid2;

   |DDEFECTO #dsmow304;
   |PARA nCont = 0; |SI nCont [ 20; |HACIENDO nCont = nCont + 1;
      |SI nCont ! 16; |Y nCont ! 18; |PINTA #dsmow304#nCont#; |FINSI;
   |SIGUE;

   |HAZ VentanaInmuebles;
   nModoIn = 0;
|FPRC;

|PROCESO BotonModInm;
   nModoIn = 2;

   |LEE 101#dsminmex.=;
   |SI FSalida = 0;
      #dsmow304#0  = #dsminmex#2;
      #dsmow304#1  = #dsminmex#3;
      #dsmow304#2  = #dsminmex#4;
      #dsmow304#3  = #dsminmex#5;
      #dsmow304#4  = #dsminmex#6;
      #dsmow304#5  = #dsminmex#7;
      #dsmow304#6  = #dsminmex#8;
      #dsmow304#7  = #dsminmex#9;
      #dsmow304#8  = #dsminmex#10;
      #dsmow304#9  = #dsminmex#11;
      #dsmow304#10 = #dsminmex#12;
      #dsmow304#11 = #dsminmex#13;
      #dsmow304#12 = #dsminmex#14;
      #dsmow304#13 = #dsminmex#15;
      #dsmow304#14 = #dsminmex#16;
      #dsmow304#15 = #dsminmex#17;
      #dsmow304#16 = #dsminmex#18;
      #dsmow304#17 = #dsminmex#19;
      #dsmow304#19 = #dsminmex#22;
      #dsmow304#20 = #dsminmex#23;
      #dsmow304#21 = (("00" + #dsminmex#15) % -102) + (("000" + #dsminmex#16) % -103);

      |HAZ VentanaInmuebles;
   |FINSI;
   nModoIn = 0;
|FPRC;

|PROCESO BuscoRevisado;
   |DBASE aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "/def/dsmivcex";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida ! 0; |ACABA; |FINSI;
   |ABRE #Referen@;
   #Referen@#0 = #dsminmex#0;
   #Referen@#1 = #dsminmex#1;
   #Referen@#2 = 9999;
   |LEE 041#Referen@.];
   |SI FSalida = 0;
       |LEE 041#Referen@.a;
   |SINO;
       |LEE 041#Referen@.u;
   |FINSI;
   |SI FSalida = 0; |Y #Referen@#0 = #dsminmex#0; |Y #Referen@#1 = #dsminmex#1;
       #dsminmex#28 = #Referen@#4;
   |FINSI;
   |CIERRA #Referen@;
   |DESCARGA_DEF #Referen@;
|FPRC;

|PROCESO BuscoRevImprime;
   |HAZ BuscoRevisado;
   #dsmow338#4 = #dsminmex#28;
   |PINTA #dsmow338#4;
|FPRC;

|PROCESO BorraValCat;
   |BORRA 020#dsmivcex.a;
   |LIBERA #dsmivcex;
|FPRC;

|DEFBUCLE BorraValCat;
   #dsmivcex#1;
   ;
   #dsminmex#0, #dsminmex#1, 0000;
   #dsminmex#0, #dsminmex#1, 9999;
   be;
   NULL, BorraValCat;
|FIN;

|PROCESO BotonBorInm;
   |LEE 101#dsminmex.=;
   |SI FSalida = 0;
      aAlfa = "    N" + &191 + " Esta seguro de eliminar el inmueble seleccionado ?";
      |CONFI aAlfa;
      |SI FSalida = 0;
         |BUCLE BorraValCat;

         |BORRA 020#dsminmex.a;

         #dsminmex#0 = #dsm210dp#0;
         #dsminmex#1 = 1;
         |LEE 000#dsminmex.];
         |SI FSalida ! 0; |O #dsminmex#0 ! #dsm210dp#0;
            |ESTADO_CONTROL nBotonModInm, "DISABLE";
            |ESTADO_CONTROL nBotonBorInm, "DISABLE";
            |DDEFECTO #dsminmex;
         |FINSI;

         |REFRESCACONTROL nGrid2;
      |FINSI;
      |LIBERA #dsminmex;
   |FINSI;
|FPRC;

|PROCESO PaseAnterior;
   |DBASS aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + aSwAplic + "/def/rem00021.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      |DBASS aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + aSwAplic + "/fich/";
      |PATH_DAT #Referen@#aAlfa#;
      |ABRE #Referen@;
      nCalc = 1;
      |ABRE #dsminmex; |ABRE #dsmivcex;
      #dsminmex#0 = #dsm210dp#0;
      #dsminmex#1 = 1;
      |LEE 000#dsminmex.];
      |PARA; |SI FSalida = 0; |Y #dsminmex#0 = #dsm210dp#0; |HACIENDO;
         nCalc = #dsminmex#1 + 1;
         |LEE 000#dsminmex.s;
      |SIGUE;
      |SELECT #3#dsminmex;
      #Referen@#0 = #dsm210dp#0;
      #Referen@#1 = 1;
      |LEE 000#Referen@.];
      |PARA; |SI FSalida = 0; |Y #Referen@#0 = #dsm210dp#0; |HACIENDO;
         aAlfa = #Referen@#14; |QBF aAlfa;
         |SI aAlfa ! "";
            |DDEFECTO #dsminmex;
            #dsminmex#0 = #dsm210dp#0;
            #dsminmex#2 = #Referen@#14;
            |LEE 000#dsminmex.];
            |SI FSalida = 0; |Y #dsminmex#0 = #dsm210dp#0; |Y #dsminmex#2 = #Referen@#14;
               #dsminmex#2 = #Referen@#14;
               #dsminmex#15 = (("00" + #Referen@#105) % -102);
               #dsminmex#16 = (("000" + #Referen@#106) % -103);

               #repobla@#0 = #Referen@#105;
               #repobla@#1 = #Referen@#106;
               |LEE 000#repobla@.=;
               |SI FSalida ! 0; |DDEFECTO #repobla@; |FINSI;
               |SI enSwCod = 1; #dsminmex#17 = #repobla@#3; |FINSI;
               |SI enSwCod = 2; #dsminmex#17 = #repobla@#2; |FINSI;

               #reprovi@#0 = #Referen@#105;
               |LEE 000#reprovi@.=;
               |SI FSalida ! 0; |DDEFECTO #reprovi@; |FINSI;
               #dsminmex#19 = #reprovi@#1;

               #dsminmex#22 = #Referen@#13;
               #dsminmex#24 = #Referen@#25;
               #dsminmex#25 = #Referen@#26;
               |GRABA 020#dsminmex.a;

               #dsmivcex#0 = #dsminmex#0;
               #dsmivcex#1 = #dsminmex#1;
               aAlfa = aSwAplic - "ren";
               #dsmivcex#2 = aAlfa;
               |LEE 101#dsmivcex.=;
               |SI FSalida ! 0;
                  |DDEFECTO #dsmivcex;
                  #dsmivcex#0 = #dsminmex#0;
                  #dsmivcex#1 = #dsminmex#1;
                  #dsmivcex#2 = aAlfa;
                  |GRABA 020#dsmivcex.b;
               |FINSI;
               #dsmivcex#3 = #Referen@#15;
               |GRABA 020#dsmivcex.a; |LIBERA #dsmivcex;
            |SINO;
               |DDEFECTO #dsminmex;
               #dsminmex#0 = #dsm210dp#0;
               #dsminmex#1 = nCalc; nCalc = nCalc + 1;
               #dsminmex#2 = #Referen@#14;
               #dsminmex#15 = (("00" + #Referen@#105) % -102);
               #dsminmex#16 = (("000" + #Referen@#106) % -103);

               #repobla@#0 = #Referen@#105;
               #repobla@#1 = #Referen@#106;
               |LEE 000#repobla@.=;
               |SI FSalida ! 0; |DDEFECTO #repobla@; |FINSI;
               |SI enSwCod = 1; #dsminmex#17 = #repobla@#3; |FINSI;
               |SI enSwCod = 2; #dsminmex#17 = #repobla@#2; |FINSI;

               #reprovi@#0 = #Referen@#105;
               |LEE 000#reprovi@.=;
               |SI FSalida ! 0; |DDEFECTO #reprovi@; |FINSI;
               #dsminmex#19 = #reprovi@#1;

               #dsminmex#22 = #Referen@#13;
               #dsminmex#24 = #Referen@#25;
               #dsminmex#25 = #Referen@#26;
               |GRABA 020#dsminmex.c;
               nCont = nCont + 1;

               #dsmivcex#0 = #dsminmex#0;
               #dsmivcex#1 = #dsminmex#1;
               aAlfa = aSwAplic - "ren";
               #dsmivcex#2 = aAlfa;
               |LEE 101#dsmivcex.=;
               |SI FSalida ! 0;
                  |DDEFECTO #dsmivcex;
                  #dsmivcex#0 = #dsminmex#0;
                  #dsmivcex#1 = #dsminmex#1;
                  #dsmivcex#2 = aAlfa;
                  |GRABA 020#dsmivcex.b;
               |FINSI;
               #dsmivcex#3 = #Referen@#15;
               |GRABA 020#dsmivcex.a; |LIBERA #dsmivcex;
            |FINSI;
         |SINO;
            |DDEFECTO #dsminmex;
            #dsminmex#0 = #dsm210dp#0;
            #dsminmex#1 = nCalc; nCalc = nCalc + 1;
            #dsminmex#2 = #Referen@#14;
            #dsminmex#15 = (("00" + #Referen@#105) % -102);
            #dsminmex#16 = (("000" + #Referen@#106) % -103);

            #repobla@#0 = #Referen@#105;
            #repobla@#1 = #Referen@#106;
            |LEE 000#repobla@.=;
            |SI FSalida ! 0; |DDEFECTO #repobla@; |FINSI;
            |SI enSwCod = 1; #dsminmex#17 = #repobla@#3; |FINSI;
            |SI enSwCod = 2; #dsminmex#17 = #repobla@#2; |FINSI;

            #reprovi@#0 = #Referen@#105;
            |LEE 000#reprovi@.=;
            |SI FSalida ! 0; |DDEFECTO #reprovi@; |FINSI;
            #dsminmex#19 = #reprovi@#1;

            #dsminmex#22 = #Referen@#13;
            #dsminmex#24 = #Referen@#25;
            #dsminmex#25 = #Referen@#26;
            |GRABA 020#dsminmex.c;

            #dsmivcex#0 = #dsminmex#0;
            #dsmivcex#1 = #dsminmex#1;
            aAlfa = aSwAplic - "ren";
            #dsmivcex#2 = aAlfa;
            |LEE 101#dsmivcex.=;
            |SI FSalida ! 0;
               |DDEFECTO #dsmivcex;
               #dsmivcex#0 = #dsminmex#0;
               #dsmivcex#1 = #dsminmex#1;
               #dsmivcex#2 = aAlfa;
               |GRABA 020#dsmivcex.b;
            |FINSI;
            #dsmivcex#3 = #Referen@#15;
            |GRABA 020#dsmivcex.a; |LIBERA #dsmivcex;

            nCont = nCont + 1;
         |FINSI;
         |LEE 000#Referen@.s;
      |SIGUE;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;

      |SELECT #1#dsminmex; |CIERRA #dsminmex;
      |CIERRA #dsmivcex;
   |FINSI;
|FPRC;

|PROCESO PaseInmAplicAnt;
   aAlfa = "    NSe va a proceder a recoger los datos de inmuebles de aplicaciones anteriores. " + &191 + " Es correcto ? ";
   |CONFI aAlfa;
   |SI FSalida = 0;
      nCont = 0;
      aSwAplic = "ren2009"; |HAZ PaseAnterior;
      aSwAplic = "ren2010"; |HAZ PaseAnterior;
      aAlfa = "    Pasados " + nCont + " registros";
      |MENAV aAlfa;
   |FINSI;
|FPRC;

|PROCESO Infvcex;
   #dsmivcex#0 = #dsminmex#0;
   #dsmivcex#1 = #dsminmex#1;
   #dsmivcex#2 = 0000;
|FPRC;

|PROCESO Supvcex;
   #dsmivcex#0 = #dsminmex#0;
   #dsmivcex#1 = #dsminmex#1;
   #dsmivcex#2 = 9999;
|FPRC;

|PROCESO BotonOkSig;
   nSwSig = 1; |PTEC 801;
|FPRC;

|PROCESO EvtoGridVC;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsmivcex.c;

      |SI #dsmivcex#0 = #dsminmex#0; |Y #dsmivcex#1 = #dsminmex#1;
         |ESTADO_CONTROL nBotonModEj, "ENABLE";
         |ESTADO_CONTROL nBotonBorEj, "ENABLE";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO EditaEjerc;
   |VENTANA 1229, 1690, -1, 17, aTitulo; nVentFlt = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVentFlt;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |SI enSwModo = 1;
      |C_M #dsmow335#0, 1, "S";
   |SINO;
      |C_M #dsmow335#0, 1, "N";
      |LEE 101#dsmivcex.=;
   |FINSI;

   |PINPA #0#dsmow335; nPantFlt = FSalida;
   |PINDA #0#dsmow335;

   |SI enSwModo = 1;
      nPos1 = 807; nPos2 = 819;
      |CONTROL_SIMPLE nPantFlt, "BOTON,{{230}}Validar y &Sig.", nPos1, nPos2, BotonOkSig;
      nBotonOkSig = FSalida;
   |FINSI;

   nPos1 = 821; nPos2 = 833;
   |CONTROL_SIMPLE nPantFlt, "BOTON,{{206}}Vali&Dar", nPos1, nPos2, BotonOk;
   nBotonOk = FSalida;

   nPos1 = 835; nPos2 = 843;
   |CONTROL_SIMPLE nPantFlt, "BOTON,{{207}}Ca&Ncelar", nPos1, nPos2, BotonCancel;
   nBotonCancel = FSalida;

|ET Siguiente;
   nSwSig = 0;
   |ENDATOS #1#dsmow335;
   |SI FSalida = 0;
      |SI enSwModo = 1;
         |DDEFECTO #dsmivcex;
         #dsmivcex#0 = #dsminmex#0;
         #dsmivcex#1 = #dsminmex#1;
         #dsmivcex#2 = #dsmow335#0;
         |GRABA 020#dsmivcex.b;
      |FINSI;
      #dsmivcex#3 = #dsmow335#1;
      #dsmivcex#4 = #dsmow335#2;
      |GRABA 020#dsmivcex.a;
      |LIBERA #dsmivcex;
   |FINSI;

   |SI nSwSig = 1;
      #dsmow335#0 = #dsmow335#0 + 1;
      #dsmow335#1 = 0; |PINTA #dsmow335#1;
      #dsmow335#2 = #dsminmex#28; |PINTA #dsmow335#2;

      |VETE Siguiente;
   |FINSI;

   |FIN_CONTROL_WINDOWS nBotonOk;
   |FIN_CONTROL_WINDOWS nBotonOkSig;
   |FIN_CONTROL_WINDOWS nBotonCancel;

   aVent4 = nVentFlt;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |FINVENTANA nVentFlt;
|FPRC;

|PROCESO NuevoEjerc;
   enSwModo = 1; aTitulo = "Nuevo ejercicio";

   |DDEFECTO #dsmow335;
   fFecha = ~; aAlfa = fFecha; |QBF aAlfa;
   aAlfa = aAlfa % -104; nCalc = aAlfa;

   |SALVA_FICHA #dsmivcex;
   #dsmivcex#0 = #dsminmex#0;
   #dsmivcex#1 = #dsminmex#1;
   #dsmivcex#2 = nCalc;
   |LEE 000#dsmivcex.=;
   |SI FSalida = 0;
      |PARA; |SI FSalida = 0; |Y #dsmivcex#0 = #dsminmex#0; |Y #dsmivcex#1 = #dsminmex#1; |HACIENDO;
         nCalc = #dsmivcex#2 + 1;
         |LEE 000#dsmivcex.s;
      |SIGUE;
   |FINSI;
   |REPON_FICHA #dsmivcex;

   #dsmow335#0 = nCalc;
   |HAZ EditaEjerc;

   |REFRESCACONTROL nGrid4;

   |HAZ BuscoRevImprime;
|FPRC;

|PROCESO ModifEjerc;
   enSwModo = 2; aTitulo = "Modificar ejercicio";

   #dsmow335#0 = #dsmivcex#2;
   #dsmow335#1 = #dsmivcex#3;
   #dsmow335#2 = #dsminmex#28;
   |SI #dsmivcex#4 ! " ";
       #dsmow335#2 = #dsmivcex#4;
   |FINSI;
   |HAZ EditaEjerc;

   |REFRESCACONTROL nGrid4;

   |HAZ BuscoRevImprime;
|FPRC;

|PROCESO BorraEjerc;
   aAlfa = "    N" + &191 + " Esta seguro de querer eliminar este ejercicio ?";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |BORRA 020#dsmivcex.a;
   |FINSI;

   |REFRESCACONTROL nGrid4;
   |HAZ BuscoRevImprime;
|FPRC;

|PROCESO BotonDatosEco;
   aAlfa = "Datos economicos inmueble [" + (("000" + #dsminmex#1) % -103) + "] " + #dsminmex#22; |QBF aAlfa;
   |VENTANA 0916, 1884, -1, 17, aAlfa; nVent4 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent4;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |ABRE #dsmivcex;
   |LEE 101#dsminmex.c;

   #dsmow338#0 = #dsminmex#24;
   #dsmow338#1 = #dsminmex#25;
   #dsmow338#2 = #dsminmex#26;
   #dsmow338#3 = #dsminmex#27;
   #dsmow338#4 = #dsminmex#28;
   #dsmow338#5 = #dsminmex#29;
   #dsmow338#6 = #dsminmex#30;

   |PINPA #0#dsmow338; nPant5 = FSalida;
   |PINDA #0#dsmow338;

   nPos1 = 0657; nPos2 = 0667;
   |CONTROL_SIMPLE nPant5, "BOTON,{{137}}Nue&Vo", nPos1, nPos2, NuevoEjerc;
   nBotonNueEj = FSalida;

   nPos1 = 0857; nPos2 = 0867;
   |CONTROL_SIMPLE nPant5, "BOTON,{{135}}Modi&Ficar", nPos1, nPos2, ModifEjerc;
   nBotonModEj = FSalida; |ESTADO_CONTROL nBotonModEj, "DISABLE";

   nPos1 = 1057; nPos2 = 1067;
   |CONTROL_SIMPLE nPant5, "BOTON,{{199}}Borr&Ar", nPos1, nPos2, BorraEjerc;
   nBotonBorEj = FSalida; |ESTADO_CONTROL nBotonBorEj, "DISABLE";

   nPos1 = 0631; nPos2 = 1255;
   nRango =4 + 8 + 16 + 32;
   |LINEAL_SIMPLE #1#dsmivcex, nRango, nPos1, nPos2, Infvcex, Supvcex, EvtoGridVC;
   nGrid4 = FSalida;
   |PULSATECLA;

   |ENDATOS #1#dsmow338;
   |SI FSalida = 0;
      #dsminmex#24 = #dsmow338#0;
      #dsminmex#25 = #dsmow338#1;
      #dsminmex#26 = #dsmow338#2;
      #dsminmex#27 = #dsmow338#3;
      #dsminmex#28 = #dsmow338#4;
      #dsminmex#29 = #dsmow338#5;
      #dsminmex#30 = #dsmow338#6;
      |HAZ BuscoRevisado;
      |GRABA 020#dsminmex.a;

      || Miro si hay rentas de este inmueble para preguntar si he de borrarlas
      ||     o no
      nSwHay = 0;
      |ABRE #dsm210ln; |ABRE #dsm210fp;
      |DDEFECTO #dsm210ln;
      #dsm210ln#0 = #dsminmex#0;
      |LEE 000#dsm210ln.];
      |PARA; |SI FSalida = 0; |Y #dsm210ln#0 = #dsminmex#0; |HACIENDO;
         |SI #dsm210ln#3 = #dsminmex#1; nSwHay = 1; |SAL; |FINSI;
         |LEE 000#dsm210ln.s;
      |SIGUE;
      |SI nSwHay = 1;
         aAlfa = "    NHay rentas imputadas a este inmueble. " + &191 + " Desea eliminarlas ?";
         |CONFI aAlfa;
         |SI FSalida = 0;
            |DDEFECTO #dsm210ln;
            #dsm210ln#0 = #dsminmex#0;
            |LEE 000#dsm210ln.];
            |PARA; |SI FSalida = 0; |Y #dsm210ln#0 = #dsminmex#0; |HACIENDO;
               |SI #dsm210ln#3 = #dsminmex#1;
                  #dsm210fp#0 = #dsm210ln#0;
                  #dsm210fp#1 = #dsm210ln#1;
                  #dsm210fp#2 = #dsm210ln#2;
                  #dsm210fp#3 = #dsm210ln#3;
                  #dsm210fp#4 = #dsm210ln#5;
                  #dsm210fp#37 = "";
                  |LEE 000#dsm210fp.];
                  |PARA; |SI FSalida = 0; |Y #dsm210fp#0 = #dsm210ln#0; |Y #dsm210fp#1 = #dsm210ln#1;
                   |Y #dsm210fp#2 = #dsm210ln#2; |Y #dsm210fp#3 = #dsm210ln#3;
                   |Y #dsm210fp#4 = #dsm210ln#5; |HACIENDO;
                     |BORRA 020#dsm210fp.a;
                     |LEE 000#dsm210fp.s;
                  |SIGUE;

                  |BORRA 020#dsm210ln.a;
               |FINSI;
               |LEE 000#dsm210ln.s;
            |SIGUE;
         |FINSI;
      |FINSI;
      |CIERRA #dsm210ln; |CIERRA #dsm210fp;
   |FINSI;
   |LIBERA #dsminmex;

   |DESTRUYECONTROL nGrid4;
   |FIN_CONTROL_WINDOWS nBotonNueEj;
   |FIN_CONTROL_WINDOWS nBotonModEj;
   |FIN_CONTROL_WINDOWS nBotonBorEj;
   |CIERRA #dsmivcex;

   aVent4 = nVent4;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent4;
|FPRC;

|PROCESO GestionaInmue;

   |VENTANA 0602, 2697, -1, 17, "Gestion de inmuebles del contribuyente"; nVent0 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent0;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |DDEFECTO #dsmow304;
   |PINPA #0#dsmow304; nPant1 = FSalida;
   |PINDA #0#dsmow304;

   |ABRE #dsminmex;
   |SI nComent = 0;
      nPos1 = 1641; nPos2 = 1659;
      |CONTROL_SIMPLE nPant1, "BOTON,{{197}}&Datos economicos", nPos1, nPos2, BotonDatosEco;
      nBotonDatEco = FSalida;
   |FINSI;

   nPos1 = 1661; nPos2 = 1671;
   |CONTROL_SIMPLE nPant1, "BOTON,{{137}}&Nuevo", nPos1, nPos2, BotonNueInm;
   nBotonNueInm = FSalida;

   nPos1 = 1673; nPos2 = 1683;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}&Modificar", nPos1, nPos2, BotonModInm;
   nBotonModInm = FSalida; |ESTADO_CONTROL nBotonModInm, "DISABLE";

   nPos1 = 1685; nPos2 = 1695;
   |CONTROL_SIMPLE nPant1, "BOTON,{{199}}&Borrar", nPos1, nPos2, BotonBorInm;
   nBotonBorInm = FSalida; |ESTADO_CONTROL nBotonBorInm, "DISABLE";

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 602; nPos2 = 1595;
   |LINEAL_SIMPLE #1#dsminmex, nRango, nPos1, nPos2, InfInmEx, SupInmEx, EvtoGrid2;
   nGrid2 = FSalida;
   |PULSATECLA;

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Sa&Lir," + nGrid2;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
   |SIGUE;

   |DESTRUYECONTROL nGrid2;
   |FIN_CONTROL_WINDOWS nBotonBorInm;
   |FIN_CONTROL_WINDOWS nBotonModInm;
   |FIN_CONTROL_WINDOWS nBotonNueInm;
   |SI nComent = 0;
      |FIN_CONTROL_WINDOWS nBotonDatEco; || Comentado
   |FINSI;

   aVent4 = nVent0;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |CIERRA #dsminmex;

   |FINVENTANA nVent0;
|FPRC;

|PROCESO EvtoGrid2bis;
   |SI nSinEvto = 1; |ACABA; |FINSI;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsminmex.=;
      |SI FSalida ! 0; |O #dsminmex#0 ! #dsm210dp#0;
         |DDEFECTO #dsminmex;
      |SINO;
         |ESTADO_CONTROL nBotonModInm, "ENABLE";
         |ESTADO_CONTROL nBotonBorInm, "ENABLE";
      |FINSI;

      #dsmow304#0  = #dsminmex#2; |PINTA #dsmow304#0;
      #dsmow304#1  = #dsminmex#3; |PINTA #dsmow304#1;
      #dsmow304#2  = #dsminmex#4; |PINTA #dsmow304#2;
      #dsmow304#3  = #dsminmex#5; |PINTA #dsmow304#3;
      #dsmow304#4  = #dsminmex#6; |PINTA #dsmow304#4;
      #dsmow304#5  = #dsminmex#7; |PINTA #dsmow304#5;
      #dsmow304#6  = #dsminmex#8; |PINTA #dsmow304#6;
      #dsmow304#7  = #dsminmex#9; |PINTA #dsmow304#7;
      #dsmow304#8  = #dsminmex#10; |PINTA #dsmow304#8;
      #dsmow304#9  = #dsminmex#11; |PINTA #dsmow304#9;
      #dsmow304#10 = #dsminmex#12; |PINTA #dsmow304#10;
      #dsmow304#11 = #dsminmex#13; |PINTA #dsmow304#11;
      #dsmow304#12 = #dsminmex#14; |PINTA #dsmow304#12;
      #dsmow304#13 = #dsminmex#15; |PINTA #dsmow304#13;
      #dsmow304#14 = #dsminmex#16; |PINTA #dsmow304#14;
      #dsmow304#15 = #dsminmex#17; |PINTA #dsmow304#15;
      #dsmow304#16 = #dsminmex#18;
      #dsmow304#17 = #dsminmex#19; |PINTA #dsmow304#17;
      #dsmow304#19 = #dsminmex#22; |PINTA #dsmow304#19;
      #dsmow304#20 = #dsminmex#23; |PINTA #dsmow304#20;
      #dsmow304#22 = #dsminmex#31; |PINTA #dsmow304#22;
      #dsmow304#23 = #dsminmex#32; |PINTA #dsmow304#23;
   |FINSI;

   |SI FSalida = 4;
      |SI #dsminmex#20 = "A";
         #dsminmex#20 = "D";
         #dsminmex#21 = "190,190,190;255,255,255";
      |SINO;
         #dsminmex#20 = "A";
         #dsminmex#21 = "49,106,197;255,255,255";
      |FINSI;
      |GRABA 020#dsminmex.a;
      |REFRESCACONTROL nGrid2;
   |FINSI;
|FPRC;

|PROCESO ManteInmue;

   |VENTANA 0602, 2697, -1, 17, "Gestion de inmuebles del contribuyente"; nVent0 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent0;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |DDEFECTO #dsmow304;
   |PINPA #0#dsmow304; nPant1 = FSalida;
   |PINDA #0#dsmow304;

   |ABRE #dsminmex;
   |SI nComent = 0;
      nPos1 = 1641; nPos2 = 1659;
      |CONTROL_SIMPLE nPant1, "BOTON,{{197}}&Datos economicos", nPos1, nPos2, BotonDatosEco;
      nBotonDatEco = FSalida;
   |FINSI;

   nPos1 = 1661; nPos2 = 1671;
   |CONTROL_SIMPLE nPant1, "BOTON,{{137}}&Nuevo", nPos1, nPos2, BotonNueInm;
   nBotonNueInm = FSalida;

   nPos1 = 1673; nPos2 = 1683;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}&Modificar", nPos1, nPos2, BotonModInm;
   nBotonModInm = FSalida; |ESTADO_CONTROL nBotonModInm, "DISABLE";

   nPos1 = 1685; nPos2 = 1695;
   |CONTROL_SIMPLE nPant1, "BOTON,{{199}}&Borrar", nPos1, nPos2, BotonBorInm;
   nBotonBorInm = FSalida; |ESTADO_CONTROL nBotonBorInm, "DISABLE";

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 602; nPos2 = 1595;
   |LINEAL_SIMPLE #1#dsminmex, nRango, nPos1, nPos2, InfInmEx, SupInmEx, EvtoGrid2bis;
   nGrid2 = FSalida;
   |PULSATECLA;

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Sa&Lir," + nGrid2;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
   |SIGUE;

   |DESTRUYECONTROL nGrid2;
   |FIN_CONTROL_WINDOWS nBotonBorInm;
   |FIN_CONTROL_WINDOWS nBotonModInm;
   |FIN_CONTROL_WINDOWS nBotonNueInm;
   |SI nComent = 0;
      |FIN_CONTROL_WINDOWS nBotonDatEco; || Comentado
   |FINSI;

   aVent4 = nVent0;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |CIERRA #dsminmex;

   |FINVENTANA nVent0;
|FPRC;

/***************************************************************************
*********                     FIN GESTION INMUEBLES                *********
****************************************************************************/

/***************************************************************************
*********                         MODELO 210                       *********
****************************************************************************/

|PROCESO MiraSi210Cmp;
   |SI #dsmow322#2 = "N";
       #dsmow322#3 = ""; |PINTA #dsmow322#3;
       #dsmow322#4 = 0;  |PINTA #dsmow322#4;
       |C_M #dsmow322#3, 1, "N"; |C_M #dsmow322#4, 1, "N";
   |SINO;
       |C_M #dsmow322#3, 1, "S"; |C_M #dsmow322#4, 1, "S";
   |FINSI;
|FPRC;

|PROCESO MiraIRNR;
   |SI #dsmow322#6 = "S";
       #dsmow322#7 = "N"; |PINTA #dsmow322#7;
       #dsmow322#8 = 0; |PINTA #dsmow322#8; |C_M #dsmow322#8, 1, "N";
   |FINSI;
|FPRC;

|PROCESO MiraConvenio;
   |SI FSalida = 2; |ACABA; |FINSI;
   |SI #dsmow322#7 = "S";
      |SI #dsm210ca#1 = 1; |O #dsm210ca#1 = 2; |O #dsm210ca#1 = 28;
          #dsmow322#8 = 0; |PINTA #dsmow322#8;
      |SINO;
         |C_M #dsmow322#8, 1, "S";
      |FINSI;
      #dsmow322#6 = "N"; |PINTA #dsmow322#6;
   |SINO;
      #dsmow322#8 = 0; |PINTA #dsmow322#8;
      |C_M #dsmow322#8, 1, "N";
   |FINSI;
|FPRC;

|PROCESO CalculoLiq211;
   #dsmow312#19 = #dsmow312#17 % #dsmow312#18; |PINTA #dsmow312#19;
   #dsmow312#21 = #dsmow312#19 - #dsmow312#20; |PINTA #dsmow312#21;
   |SI #dsmow312#21 ] 0;
      #dsmow312#24 = #dsmow312#21;
   |SINO;
      #dsmow312#24 = 0;
   |FINSI;
   |PINTA #dsmow312#24;
|FPRC;

|PROCESO CalculoLiq210;

   |SI #dsmow301#6 < 0; #dsmow301#6 = 0; |FINSI;
   |PINTA #dsmow301#6;

   #dsmow301#8 = #dsmow301#6 - #dsmow301#7;
   |PINTA #dsmow301#8;

   |SI #dsmow301#10 < #dsmow301#8; |Y #dsmow301#10 > 0;
       #dsmow301#11 = #dsmow301#8 - #dsmow301#10;
   |SINO;
       #dsmow301#11 = 0;
   |FINSI;
   |PINTA #dsmow301#11;

   #dsmow301#12 = #dsmow301#8 - #dsmow301#11;
   |PINTA #dsmow301#12;

   #dsmow301#15 = #dsmow301#12 - #dsmow301#13 + #dsmow301#14;
   |PINTA #dsmow301#15;
|FPRC;

|PROCESO ContenidoLin;
   nNivelLins = 2;

   |ESTADO_CONTROL nBotonGestInm, "DISABLE";
   |ESTADO_CONTROL nBotonNueNi, "DISABLE";
   |ESTADO_CONTROL nBotonModNi, "DISABLE";
   |ESTADO_CONTROL nBotonBorNi, "DISABLE";
   |ESTADO_CONTROL nBotonSalNi, "DISABLE";
   |ESTADO_CONTROL nGrid1a, "DISABLE";
   |ESTADO_CONTROL nGrid1b, "DISABLE";
   |ESTADO_CONTROL nBotonPago, "ENABLE";
   |ESTADO_CONTROL nBotonSalLN, "ENABLE";
   |ESTADO_CONTROL nBotonNueLN, "ENABLE";
   |ESTADO_CONTROL nBotonCambFc, "ENABLE";

   #dsm210ln#0 = #dsm210ca#0;
   #dsm210ln#1 = #dsm210ca#1;
   |SI #dsm210tr#2 = "S";
       #dsm210ln#3 = #dsm210in#2;
   |SINO;
       |SI #dsm210tr#2 = "S";
           #dsm210ln#2 = #dsm210ni#2;
       |FINSI;
   |FINSI;
   #dsm210ln#4 = "01.01.0000";
   #dsm210ln#5 = 0;
   |LEE 000#dsm210ln.];
   |SI #dsm210tr#2 = "S";
      |SI FSalida = 0; |Y #dsm210ln#0 = #dsm210ca#0; |Y #dsm210ln#1 = #dsm210ca#1;
      |Y #dsm210ln#3 = #dsm210in#2;
         |ESTADO_CONTROL nBotonBorLN, "ENABLE";
         |ESTADO_CONTROL nBotonModLN, "ENABLE";
      |FINSI;
   |SINO;
      |SI #dsm210tr#3 = "S";
         |SI FSalida = 0; |Y #dsm210ln#0 = #dsm210ca#0; |Y #dsm210ln#1 = #dsm210ca#1;
         |Y #dsm210ln#2 = #dsm210ni#2;
            |ESTADO_CONTROL nBotonBorLN, "ENABLE";
            |ESTADO_CONTROL nBotonModLN, "ENABLE";
         |FINSI;
      |FINSI;
   |FINSI;

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Salir," + nGrid1aa;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
      |SI nSalFuera = 1;  |SAL; |FINSI;
   |SIGUE;

   |ESTADO_CONTROL nBotonCambFc, "DISABLE";
   |ESTADO_CONTROL nBotonNueLN, "DISABLE";
   |ESTADO_CONTROL nBotonModLN, "DISABLE";
   |ESTADO_CONTROL nBotonBorLN, "DISABLE";
   |ESTADO_CONTROL nBotonSalLN, "DISABLE";
   |ESTADO_CONTROL nBotonPago, "DISABLE";
   |ESTADO_CONTROL nGrid1a, "ENABLE";
   |ESTADO_CONTROL nGrid1b, "ENABLE";
   |ESTADO_CONTROL nBotonSalNi, "ENABLE";
   |ESTADO_CONTROL nBotonBorNi, "ENABLE";
   |ESTADO_CONTROL nBotonModNi, "ENABLE";
   |ESTADO_CONTROL nBotonNueNi, "ENABLE";
   |ESTADO_CONTROL nBotonGestInm, "ENABLE";

   |SI nSalFuera = 1; |PTEC 802; |PAUSA; |PTEC 807; |FINSI;
   nNivelLins = 1;
|FPRC;

|PROCESO Tipo00w306;
   #dsminmex#0 = #dsm210dp#0;
   #dsminmex#1 = #dsmow306#0;
   |LEE 000#dsminmex.=;
   |SI FSalida = 0;
      |SI #dsminmex#20 = "A";
         #dsmow306#1 = #dsminmex#22;
         #dsmow306#2 = #dsminmex#2;
         aAlfa  = #dsminmex#3;  |QBF aAlfa;
         aAlfa1 = #dsminmex#4;  |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + " " + aAlfa1; |FINSI;
         aAlfa1 = #dsminmex#5;  |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + " " + aAlfa1; |FINSI;
         aAlfa1 = #dsminmex#6;  |QBF aAlfa1; |SI aAlfa1 ! "0"; |Y aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
         aAlfa1 = #dsminmex#7;  |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + " " + aAlfa1; |FINSI;
         aAlfa1 = #dsminmex#8;  |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
         aAlfa1 = #dsminmex#9;  |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
         aAlfa1 = #dsminmex#10; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
         aAlfa1 = #dsminmex#11; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + " " + aAlfa1; |FINSI;
         aAlfa1 = #dsminmex#12; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + "-" + aAlfa1; |FINSI;
         #dsmow306#3 = aAlfa;
         aAlfa = (("00" + #dsminmex#15) % -102) + (("000" + #dsminmex#16) % -103);
         #dsmow306#4 = aAlfa;
         #dsmow306#5 = #dsminmex#17;
         #dsmow306#6 = #dsminmex#19;
         |PINDA #0#dsmow306;
      |SINO;
         |MENAV "    Inmueble inactivo"; |ERROR;
      |FINSI;
   |SINO;
      |MENAV "    Inmueble inexistente"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO Infw306;
   #dsminmex#20 = "A";
   #dsminmex#0 = #dsm210dp#0;
   #dsminmex#1 = 1;
|FPRC;

|PROCESO Supw306;
   #dsminmex#20 = "A";
   #dsminmex#0 = #dsm210dp#0;
   #dsminmex#1 = 999;
|FPRC;

|PROCESO Tipo66w306; |TIPO 66;
   #dsminmex#0 = #dsm210dp#0;
   #dsminmex#1 = #dsmow306#0;
   |LEE 000#dsminmex.];
   |CONSULTA_F_CLAVE #2#dsminmex, Infw306, Supw306;
   |SI FSalida = 0;
      #dsmow306#0 = #dsminmex#1;
      #dsmow306#1 = #dsminmex#22;
      #dsmow306#2 = #dsminmex#2;
      aAlfa  = #dsminmex#3;  |QBF aAlfa;
      aAlfa1 = #dsminmex#4;  |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + " " + aAlfa1; |FINSI;
      aAlfa1 = #dsminmex#5;  |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + " " + aAlfa1; |FINSI;
      aAlfa1 = #dsminmex#6;  |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
      aAlfa1 = #dsminmex#7;  |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + " " + aAlfa1; |FINSI;
      aAlfa1 = #dsminmex#8;  |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
      aAlfa1 = #dsminmex#9;  |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
      aAlfa1 = #dsminmex#10; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
      aAlfa1 = #dsminmex#11; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + " " + aAlfa1; |FINSI;
      aAlfa1 = #dsminmex#12; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + "-" + aAlfa1; |FINSI;
      #dsmow306#3 = aAlfa;
      aAlfa = (("00" + #dsminmex#15) % -102) + (("000" + #dsminmex#15) % -103);
      #dsmow306#4 = aAlfa;
      #dsmow306#5 = #dsminmex#17;
      #dsmow306#6 = #dsminmex#19;
      |PINDA #0#dsmow306;
   |FINSI;
   |ERROR;
|FPRC;

|PROCESO BorraLin210;
   |ABRE #dsm210fp;
   nContr = #dsm210ln#0; nTipoR = #dsm210ln#1;
   aNifLn = #dsm210ln#2; nInmLn = #dsm210ln#3;
   nDivLn = #dsm210ln#5; nResul = #dsm210ln#34;
   |HAZ BorraFP;
   |CIERRA #dsm210fp;

   |BORRA 020#dsm210ln.a;
|FPRC;

|DEFBUCLE BorraLin210;
#dsm210ln#1;
;
#dsm210ca#0, #dsm210ca#1, aDNif, nDInm, "01.01.0000", 000;
#dsm210ca#0, #dsm210ca#1, aHNif, nHInm, "31.12.9999", 999;
be;
NULL, BorraLin210;
|FIN;

|PROCESO BorraNIF;
   aDNif = #dsm210ni#2; aHNif = #dsm210ni#2;
   nDInm = 0;           nHInm = 0;
   |BUCLE BorraLin210;

   |BORRA 020#dsm210ni.a;
|FPRC;

|DEFBUCLE BorraNIF;
#dsm210ni#1;
;
#dsm210ca#0, #dsm210ca#1, "               ";
#dsm210ca#0, #dsm210ca#1, "zzzzzzzzzzzzzzz";
be;
NULL, BorraNIF;
|FIN;

|PROCESO BorraInm;
   aDNif = " " * 15;    aHNif = " " * 15;
   nDInm = #dsm210in#2; nHInm = #dsm210in#2;
   |BUCLE BorraLin210;

   |BORRA 020#dsm210in.a;
|FPRC;

|DEFBUCLE BorraInm;
   #dsm210in#1;
   ;
   #dsm210ca#0, #dsm210ca#1, 000;
   #dsm210ca#0, #dsm210ca#1, 999;
   be;
   NULL, BorraInm;
|FIN;

|PROCESO EvtoGrid1aa;

   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsm210ln.=;
      FEstado = FSalida;

      nTr210tr = #dsm210ln#1;
      fFecha1  = #dsm210ln#4; |HAZ CalAnyTr;
      |SI FEstado = 0;
          #dsmow301#5 = #dsm210ln#35; |PINTA #dsmow301#5;
          #dsmow301#3 = #dsm210ln#36; |PINTA #dsmow301#3;
          #dsmow301#4 = #dsm210ln#37; |PINTA #dsmow301#4;
          #dsmow301#9 = #dsm210ln#38; |PINTA #dsmow301#9;
      |SINO;
          #dsmow301#5 = nTg210tr;    |PINTA #dsmow301#5;
          #dsmow301#3 = #dsm210ca#3; |PINTA #dsmow301#3;
          #dsmow301#4 = #dsm210ca#4; |PINTA #dsmow301#4;
          #dsmow301#9 = #dsm210ca#7; |PINTA #dsmow301#9;
      |FINSI;

      |SI #dsm210tr#2 = "S";
         |SI FEstado ! 0; |O #dsm210ln#0 ! #dsm210ca#0; |O #dsm210ln#1 ! #dsm210ca#1; |O #dsm210ln#3 ! #dsm210in#2;
            |DDEFECTO #dsm210ln;
         |FINSI;
      |SINO;
         |SI #dsm210tr#3 = "S";
            |SI FEstado ! 0; |O #dsm210ln#0 ! #dsm210ca#0; |O #dsm210ln#1 ! #dsm210ca#1; |O #dsm210ln#2 ! #dsm210ni#2;
               |DDEFECTO #dsm210ln;
            |FINSI;
         |FINSI;
      |FINSI;

      |SI #dsm210tr#4 = "I"; |O #dsm210tr#4 = "G";
          #dsmow307#0  = #dsm210ln#7; |PINTA #dsmow307#0;

          #dsmow301#6  = #dsmow307#0 % #dsmow301#5; |PINTA #dsmow301#6;
          #dsmow301#10 = 0; |PINTA #dsmow301#10;
      |FINSI;
      |SI #dsm210tr#4 = "R";
         #dsmow308#3 = #dsm210ln#7;  |PINTA #dsmow308#3;
         #dsmow308#0 = #dsm210ln#8;  |PINTA #dsmow308#0;
         #dsmow308#1 = #dsm210ln#9;  |PINTA #dsmow308#1;
         #dsmow308#2 = #dsm210ln#10; |PINTA #dsmow308#2;

         #dsmow301#6  = #dsmow308#3 % #dsmow301#5; |PINTA #dsmow301#6;
         #dsmow301#10 = #dsmow308#0 % #dsmow301#9; |PINTA #dsmow301#10;
      |FINSI;
      |SI #dsm210tr#4 = "H";
         #dsmow309#13 = #dsm210ln#7;  |PINTA #dsmow309#13;
         #dsmow309#0  = #dsm210ln#11; |PINTA #dsmow309#0;
         #dsmow309#1  = #dsm210ln#12; |PINTA #dsmow309#1;
         #dsmow309#2  = #dsm210ln#13; |PINTA #dsmow309#2;
         #dsmow309#3  = #dsm210ln#14; |PINTA #dsmow309#3;
         #dsmow309#4  = #dsm210ln#15; |PINTA #dsmow309#4;
         #dsmow309#5  = #dsm210ln#16; |PINTA #dsmow309#5;
         #dsmow309#6  = #dsm210ln#17; |PINTA #dsmow309#6;
         #dsmow309#7  = #dsm210ln#18; |PINTA #dsmow309#7;
         #dsmow309#8  = #dsm210ln#19; |PINTA #dsmow309#8;
         #dsmow309#9  = #dsm210ln#20; |PINTA #dsmow309#9;
         #dsmow309#10 = #dsm210ln#21; |PINTA #dsmow309#10;
         #dsmow309#11 = #dsm210ln#22; |PINTA #dsmow309#11;
         #dsmow309#12 = #dsm210ln#23; |PINTA #dsmow309#12;
         #dsmow309#13 = #dsmow309#11 + #dsmow309#12;
         |SI #dsmow309#13 < 0; #dsmow309#13 = 0; |FINSI;
         |PINTA #dsmow309#13;
         #dsmow309#14 = #dsm210ln#24; |PINTA #dsmow309#14;
         #dsmow309#15 = #dsm210ln#25; |PINTA #dsmow309#15;
         #dsmow309#16 = #dsm210ln#26; |PINTA #dsmow309#16;
         #dsmow309#17 = #dsm210ln#39; |PINTA #dsmow309#17;

         #dsmow301#6  = #dsmow309#13 % #dsmow301#5; |PINTA #dsmow301#6;
         #dsmow301#10 = 0; |PINTA #dsmow301#10;
      |FINSI;
      #dsmow301#7  = #dsm210ln#27; |PINTA #dsmow301#7;
      #dsmow301#13 = #dsm210ln#28; |PINTA #dsmow301#13;
      #dsmow301#14 = #dsm210ln#31; |PINTA #dsmow301#14;

      |HAZ CalculoLiq210;
      |SI #dsm210ln#34 = 0;
          |LEE 101#dsm210ln.=;
          |SI FSalida = 0;
              #dsm210ln#34 = #dsmow301#15;
              |GRABA 020#dsm210ln.a; |LIBERA #dsm210ln;
          |FINSI;
      |FINSI;

      enPorc1 = #dsm210ln#32; enPorc2 = #dsm210ln#33; |HAZ PintaTipo;
   |FINSI;
|FPRC;

|PROCESO EvtoGrid1b;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsm210in.=;

      |REFRESCACONTROL nGrid1aa;
   |FINSI;
|FPRC;

|PROCESO EvtoGrid1a;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsm210ni.=;

      |REFRESCACONTROL nGrid1aa;
   |FINSI;
|FPRC;

|PROCESO EvtoGrid1;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsm210ca.=;
      |SI FSalida ! 0; |O #dsm210ca#0 ! #dsm210dp#0;
         |DDEFECTO #dsm210ca;
         #dsm210ca#0 = #dsm210dp#0;
      |SINO;
         |SI nModoL1 = 0;
            |ESTADO_CONTROL nBotonModTR, "ENABLE";
            |ESTADO_CONTROL nBotonBorTR, "ENABLE";
         |FINSI;
      |FINSI;

      #dsmow301#3 = #dsm210ca#3; |PINTA #dsmow301#3;
      #dsmow301#4 = #dsm210ca#4; |PINTA #dsmow301#4;
      #dsmow301#5 = #dsm210ca#5; |PINTA #dsmow301#5;
      #dsmow301#6 = 0;           |PINTA #dsmow301#6;
      #dsmow301#7 = #dsm210ca#6; |PINTA #dsmow301#7;
      #dsmow301#8 = 0;           |PINTA #dsmow301#8;
      #dsmow301#9 = #dsm210ca#7; |PINTA #dsmow301#9;
      #dsmow301#10 = 0;          |PINTA #dsmow301#10;
      #dsmow301#11 = 0;          |PINTA #dsmow301#11;
      #dsmow301#12 = 0;          |PINTA #dsmow301#12;
      #dsmow301#13 = #dsm210ca#8; |PINTA #dsmow301#13;
      #dsmow301#14 = #dsm210ca#11; |PINTA #dsmow301#14;
      #dsmow301#15 = 0;          |PINTA #dsmow301#15;

      #dsm210tr#0 = #dsm210ca#1;
      #dsm210tr#6 = nEj210tr;
      |LEE 000#dsm210tr.=;
      |SI FSalida = 0;
         |SI #dsm210tr#4 = "I";
            |SI nNumSPant ! 1;
               |BORRA_HIJOS_PAN #0#dsmow301;
               |SUB_PINPA #0#dsmow307, nPant1; nSubPant = FSalida;
               nNumSPant = 1;
            |FINSI;
            |PINDA #0#dsmow307;
         |FINSI;
         |SI #dsm210tr#4 = "R";
            |SI nNumSPant ! 2;
               |BORRA_HIJOS_PAN #0#dsmow301;
               |SUB_PINPA #0#dsmow308, nPant1; nSubPant = FSalida;
               nNumSPant = 2;
            |FINSI;
            |PINDA #0#dsmow308;
         |FINSI;
         |SI #dsm210tr#4 = "G";
            |SI nNumSPant ! 3;
               |BORRA_HIJOS_PAN #0#dsmow301;
               |SUB_PINPA #0#dsmow307, nPant1; nSubPant = FSalida;
               nNumSPant = 3;
               aAlfa = "LABEL,{{13}}210  G Ganancias patrimoniales (excepto bienes inmuebles)";
               |CONTROL_SIMPLE nSubPant, aAlfa, 1842, 1898, NULL;
            |FINSI;
            |PINDA #0#dsmow307;
         |FINSI;
         |SI #dsm210tr#4 = "H";
            |SI nNumSPant ! 4;
               |BORRA_HIJOS_PAN #0#dsmow301;
               |SUB_PINPA #0#dsmow309, nPant1; nSubPant = FSalida;
               nNumSPant = 4;
            |FINSI;
            |PINDA #0#dsmow309;
         |FINSI;

         |SI #dsm210tr#2 = "S";
            |SI nEstadoG1a = 1;
               nEstadoG1a = 0; |ESTADO_CONTROL nGrid1a, "HIDE";
            |FINSI;
            |SI nEstadoG1b = 0;
               nEstadoG1b = 1; |ESTADO_CONTROL nGrid1b, "SHOW";
               |ESTADO_CONTROL nBotonGestInm, "SHOW";
            |FINSI;
            |DDEFECTO #dsmow307; |DDEFECTO #dsmow308; |DDEFECTO #dsmow309;

            |REFRESCACONTROL nGrid1b;
            |REFRESCACONTROL nGrid1aa;
            |PULSATECLA;
         |SINO;
            |SI #dsm210tr#3 = "S";
               |SI nEstadoG1a = 0;
                  nEstadoG1a = 1; |ESTADO_CONTROL nGrid1a, "SHOW";
               |FINSI;
               |SI nEstadoG1b = 1;
                  nEstadoG1b = 0; |ESTADO_CONTROL nGrid1b, "HIDE";
                  |ESTADO_CONTROL nBotonGestInm, "HIDE";
               |FINSI;
               |DDEFECTO #dsmow307; |DDEFECTO #dsmow308; |DDEFECTO #dsmow309;

               |REFRESCACONTROL nGrid1a;
               |REFRESCACONTROL nGrid1aa;
               |PULSATECLA;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Inf210ca;
   #dsm210ca#0 = #dsm210dp#0;
   #dsm210ca#1 = 1;
|FPRC;

|PROCESO Sup210ca;
   #dsm210ca#0 = #dsm210dp#0;
   #dsm210ca#1 = 99;
|FPRC;

|PROCESO Inf210ni;
   #dsm210ni#0 = #dsm210dp#0;
   #dsm210ni#1 = #dsm210ca#1;
   #dsm210ni#2 = "               ";
|FPRC;

|PROCESO Sup210ni;
   #dsm210ni#0 = #dsm210dp#0;
   #dsm210ni#1 = #dsm210ca#1;
   #dsm210ni#2 = "zzzzzzzzzzzzzzz";
|FPRC;

|PROCESO Inf210in;
   #dsm210in#0 = #dsm210dp#0;
   #dsm210in#1 = #dsm210ca#1;
   #dsm210in#2 = 001;
|FPRC;

|PROCESO Sup210in;
   #dsm210in#0 = #dsm210dp#0;
   #dsm210in#1 = #dsm210ca#1;
   #dsm210in#2 = 999;
|FPRC;

|PROCESO Inf210ln;
   |SI #dsm210tr#2 = "S";
      #dsm210ln#0 = #dsm210dp#0;
      #dsm210ln#1 = #dsm210ca#1;
      #dsm210ln#2 = "";
      #dsm210ln#3 = #dsm210in#2;
      #dsm210ln#4 = "01.01.0000";
      #dsm210ln#5 = 000;
   |SINO;
      |SI #dsm210tr#3 = "S";
         #dsm210ln#0 = #dsm210dp#0;
         #dsm210ln#1 = #dsm210ca#1;
         #dsm210ln#2 = #dsm210ni#2;
         #dsm210ln#3 = 000;
         #dsm210ln#4 = "01.01.0000";
         #dsm210ln#5 = 000;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Sup210ln;
   |SI #dsm210tr#2 = "S";
      #dsm210ln#0 = #dsm210dp#0;
      #dsm210ln#1 = #dsm210ca#1;
      #dsm210ln#2 = "";
      #dsm210ln#3 = #dsm210in#2;
      #dsm210ln#4 = "31.12.9999";
      #dsm210ln#5 = 999;
   |SINO;
      |SI #dsm210tr#3 = "S";
         #dsm210ln#0 = #dsm210dp#0;
         #dsm210ln#1 = #dsm210ca#1;
         #dsm210ln#2 = #dsm210ni#2;
         #dsm210ln#3 = 000;
         #dsm210ln#4 = "31.12.9999";
         #dsm210ln#5 = 999;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO ContenidoTR;
   |LEE 101#dsm210ca.=;

   nNivelLins = 1;
   |ESTADO_CONTROL nBotonNueTR, "DISABLE";
   |ESTADO_CONTROL nBotonModTR, "DISABLE";
   |ESTADO_CONTROL nBotonBorTR, "DISABLE";
   |ESTADO_CONTROL nBotonSalTR, "DISABLE";
   |ESTADO_CONTROL nGrid1, "DISABLE";

   |ESTADO_CONTROL nBotonGestInm, "ENABLE";
   |ESTADO_CONTROL nBotonNueNi, "ENABLE";
   |SI #dsm210tr#2 = "S";
      |DDEFECTO #dsm210in;
      #dsm210in#0 = #dsm210ca#0;
      #dsm210in#1 = #dsm210ca#1;
      |LEE 000#dsm210in.];
      |SI FSalida = 0; |Y #dsm210in#0 = #dsm210ca#0; |Y #dsm210in#1 = #dsm210ca#1;
         |ESTADO_CONTROL nBotonModNi, "ENABLE";
         |ESTADO_CONTROL nBotonBorNi, "ENABLE";
      |FINSI;
   |SINO;
      |DDEFECTO #dsm210ni;
      #dsm210ni#0 = #dsm210ca#0;
      #dsm210ni#1 = #dsm210ca#1;
      |LEE 000#dsm210ni.];
      |SI FSalida = 0;
         |ESTADO_CONTROL nBotonModNi, "ENABLE";
         |ESTADO_CONTROL nBotonBorNi, "ENABLE";
      |FINSI;
   |FINSI;
   |ESTADO_CONTROL nBotonSalNi, "ENABLE";

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      |SI #dsm210tr#2 = "S";
         FSalida = "::{{001}}Salir," + nGrid1a;
      |SINO;
         FSalida = "::{{001}}Salir," + nGrid1b;
      |FINSI;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
      |SI nSalFuera = 1;  |SAL; |FINSI;
   |SIGUE;

   |ESTADO_CONTROL nGrid1, "ENABLE";
   |ESTADO_CONTROL nBotonSalTR, "ENABLE";
   |ESTADO_CONTROL nBotonBorTR, "ENABLE";
   |ESTADO_CONTROL nBotonModTR, "ENABLE";
   |ESTADO_CONTROL nBotonNueTR, "ENABLE";

   |ESTADO_CONTROL nBotonSalNi, "DISABLE";
   |ESTADO_CONTROL nBotonBorNi, "DISABLE";
   |ESTADO_CONTROL nBotonModNi, "DISABLE";
   |ESTADO_CONTROL nBotonNueNi, "DISABLE";
   |ESTADO_CONTROL nBotonGestInm, "DISABLE";

   nNivelLins = 0;
   |SI nSalFuera = 1; |PTEC 802; |PAUSA; |PTEC 807; |FINSI;
   |LIBERA #dsm210ca;
|FPRC;

|PROCESO BotonNueTR;
   nModoL1 = 1;
   |VENTANA 0904, 1395, -1, 17, "Nuevo tipo de renta"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |C_M #dsmow302#0, 1, "S";

   nTr210tr = #dsm210ca#1;
   fFecha1  = ~; |HAZ CalAnyTr;

   |DDEFECTO #dsmow302;
   |PINPA #0#dsmow302; nPant2 = FSalida;

   #dsmow302#4  = nTg210tr;
   #dsmow302#11 = nEj210tr;

   |PINDA #0#dsmow302;

   |ENDATOS #1#dsmow302;
   |SI FSalida = 0;
      |DDEFECTO #dsm210ca;
      #dsm210ca#0 = #dsm210dp#0;
      #dsm210ca#1 = #dsmow302#0;
      #dsm210ca#2 = #dsmow302#1;
      #dsm210ca#3 = #dsmow302#2;
      #dsm210ca#4 = #dsmow302#3;
      #dsm210ca#5 = #dsmow302#4;
      #dsm210ca#6 = #dsmow302#5;
      #dsm210ca#7 = #dsmow302#6;
      #dsm210ca#8 = #dsmow302#7;
      #dsm210ca#9 = #dsmow302#8;
      #dsm210ca#10 = #dsmow302#9;
      #dsm210ca#11 = -#dsmow302#10;
      |GRABA 020#dsm210ca.c;

      |REFRESCACONTROL nGrid1;

      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1;

      |HAZ ContenidoTR;
   |SINO;
      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1;
   |FINSI;

   |FOCOTECLADO nGrid1;
   nModoL1 = 0;
|FPRC;

|PROCESO DatosLineas;
  fFecha1 = #dsm210ln#4;

  #dsmow302#4 = #dsm210ln#35;
  #dsmow302#2 = #dsm210ln#36;
  #dsmow302#3 = #dsm210ln#37;
  #dsmow302#6 = #dsm210ln#38;
|FPRC;

|DEFBUCLE DatosLineas;
   #dsm210ln#1;
   ;
   #dsm210ca#0, #dsm210ca#1, "               ", 000, "01.01.0000", 000;
   #dsm210ca#0, #dsm210ca#1, "zzzzzzzzzzzzzzz", 999, "31.12.2999", 999;
   e;
   NULL, DatosLineas;
|FIN;

|PROCESO BotonModTR;

   nModoL1 = 2;
   |VENTANA 0904, 1395, -1, 17, "Modificar tipo de renta"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   #dsmow302#0 = #dsm210ca#1;
   #dsmow302#1 = #dsm210ca#2;
   #dsmow302#2 = #dsm210ca#3;
   #dsmow302#3 = #dsm210ca#4;
   #dsmow302#4 = #dsm210ca#5;
   #dsmow302#5 = #dsm210ca#6;
   #dsmow302#6 = #dsm210ca#7;
   #dsmow302#7 = #dsm210ca#8;
   #dsmow302#8 = #dsm210ca#9;
   #dsmow302#9 = #dsm210ca#10;
   #dsmow302#10 = -#dsm210ca#11;

   |C_M #dsmow302#0, 1, "N";

   fFecha1 = ~;
   |BUCLE DatosLineas;
   nTr210tr = #dsm210ca#1; |HAZ CalAnyTr;
   #dsmow302#11 = nEj210tr;

   |PINPA #0#dsmow302; nPant2 = FSalida;
   #dsmow302#4 = nTg210tr;

   |PINDA #0#dsmow302;
   |PULSATECLA;

   |ENDATOS #1#dsmow302;
   |SI FSalida = 0;
      #dsm210ca#3 = #dsmow302#2;
      #dsm210ca#4 = #dsmow302#3;
      #dsm210ca#5 = #dsmow302#4;
      #dsm210ca#6 = #dsmow302#5;
      #dsm210ca#7 = #dsmow302#6;
      #dsm210ca#8 = #dsmow302#7;
      #dsm210ca#9 = #dsmow302#8;
      #dsm210ca#10 = #dsmow302#9;
      #dsm210ca#11 = -#dsmow302#10;
      |GRABA 020#dsm210ca.a;

      |REFRESCACONTROL nGrid1;

      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1;

      |HAZ ContenidoTR;
   |SINO;
      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1;
   |FINSI;

   |FOCOTECLADO nGrid1;
   nModoL1 = 0;
|FPRC;

|PROCESO BotonBorTR;
   |LEE 101#dsm210ca.=;
   |SI FSalida = 0;
      aAlfa = "    N" + &191 + " Está seguro de eliminar el tipo de renta con todos sus datos ?";
      |CONFI aAlfa;
      |SI FSalida = 0;
         #dsm210tr#0 = #dsm210ca#1;
         #dsm210tr#6 = nEj210tr;
         |LEE 000#dsm210tr.=;
         |SI FSalida ! 0; |DDEFECTO #dsm210tr; |FINSI;

         |SI #dsm210tr#2 = "S";
            |BUCLE BorraInm; |REFRESCACONTROL nGrid1b;
         |SINO;
            |SI #dsm210tr#3 = "S"; |BUCLE BorraNIF; |REFRESCACONTROL nGrid1a; |FINSI;
         |FINSI;
         |REFRESCACONTROL nGrid1aa;

         |BORRA 020#dsm210ca.a;
         |PULSATECLA;
         |REFRESCACONTROL nGrid1;
      |FINSI;
      |LIBERA #dsm210ca;
   |FINSI;
|FPRC;

|PROCESO BotonSalir;
   |PTEC 807;
|FPRC;

|PROCESO VentanaNif;
   |SI #dsm210ca#1 = 2; |O #dsm210ca#1 = 27;
      |SI nSw = 1;
         |DDEFECTO #dsm210ni;
         #dsm210ni#0 = #dsm210ca#0;
         #dsm210ni#1 = #dsm210ca#1;
         #dsm210ni#4 = "<Sin nif>";
         |GRABA 020#dsm210ni.c;
         |REFRESCACONTROL nGrid1a;

         |HAZ ContenidoLin;
         |FOCOTECLADO nGrid1a;
         |ACABA;
      |FINSI;
      |SI nSw = 2;
         |DDEFECTO #dsm210ni;
         #dsm210ni#0 = #dsm210ca#0;
         #dsm210ni#1 = #dsm210ca#1;
         |LEE 000#dsm210ni.=;
         |SI FSalida = 0;
            |HAZ ContenidoLin;
            |FOCOTECLADO nGrid1a;
            |ACABA;
         |FINSI;
      |FINSI;
   |FINSI;

   Cmp = 1;
   |VENTANA 0815, 1384, -1, 17, "Nuevo nif de Pagador/Retenedor/Emisor"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PINPA #0#dsmow303; nPant2 = FSalida;
   |PINDA #0#dsmow303;

|ET OtraVez;
   |ENDATOS #1#dsmow303;
   |SI FSalida = 0;
      |SI #dsm210ca#1 ! 2; |Y #dsm210ca#1 ! 27; |Y #dsmow303#0 = "               ";
         |MENAV " El nif del pagador/retenedor/emisor no puede estar en blanco";
         |VETE OtraVez;
      |FINSI;
      #dsm210ni#0 = #dsm210ca#0;
      #dsm210ni#1 = #dsm210ca#1;
      #dsm210ni#2 = #dsmow303#0;
      #dsm210ni#3 = #dsmow303#2;
      #dsm210ni#4 = #dsmow303#1;
      |SI nSw = 1; |GRABA 020#dsm210ni.c; |FINSI;
      |SI nSw = 2; |GRABA 020#dsm210ni.a; |FINSI;
      |PULSATECLA;

      |REFRESCACONTROL nGrid1a;
      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1;

      |HAZ ContenidoLin;
   |SINO;
      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1;
   |FINSI;

   |FOCOTECLADO nGrid1a;
   Cmp = -1;
|FPRC;

|PROCESO MiraSiExisTR;
   |SI nModoL1 = 2; |ACABA; |FINSI;

   nCalc = #dsm210ca#1;
   #dsm210ca#0 = #dsm210dp#0;
   #dsm210ca#1 = #dsmow302#0;
   |LEE 000#dsm210ca.=;
   |SI FSalida = 0;
      |MENAV "    El tipo de renta ya existe"; |ERROR;
   |FINSI;

   #dsm210ca#0 = #dsm210dp#0;
   #dsm210ca#1 = nCalc;
   |LEE 000#dsm210ca.=;

   nTr210tr = #dsmow302#0;
   nEj210tr = #dsmow302#11; |HAZ CalAnyTr;
|FPRC;

|PROCESO MiraSiExisteInm;
   |SI nSw = 2; |Y #dsmow306#0 = nAntInmueble; |ACABA; |FINSI;

   #dsm210in#0 = #dsm210ca#0;
   #dsm210in#1 = #dsm210ca#1;
   #dsm210in#2 = #dsmow306#0;
   |LEE 000#dsm210in.=;
   |SI FSalida = 0;
      |MENAV "    El inmueble ya esta incluido en la relacion"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO RenumeraLins;
   |BORRA 020#dsm210ln.a;

   #dsm210ln#3 = #dsmow306#0;
   #dsm210ln#32 = #dsminmex#31;
   #dsm210ln#33 = #dsminmex#32;
   |GRABA 020#dsm210ln.n;
|FPRC;

|DEFBUCLE RenumeraLins;
   #dsm210ln#1;
   ;
   #dsm210in#0, #dsm210in#1, "               ", nAntInmueble, "01.01.0000", 000;
   #dsm210in#0, #dsm210in#1, "               ", nAntInmueble, "31.12.9999", 999;
   ;
   NULL, RenumeraLins;
|FIN;

|PROCESO VentanaInm;
    Cmp = 1;
   |ABRE #dsminmex;
   |SI nSw = 1;
      |VENTANA 0810, 1588, -1, 17, "Nuevo inmueble"; nVent1 = FSalida;
      aVent1 = -1;
      aVent2 = -1;
      aVent3 = 0;
      aVent4 = nVent1;
      aVent5 = "MODAL";
      |ESPECIFICA "ESTADO_VENTANA", aVent;

      |PINPA #0#dsmow306; nPant2 = FSalida;
      |PINDA #0#dsmow306;

      |ENDATOS #1#dsmow306;
      |SI FSalida = 0;
         nSwPasa = 0;
         |SI #dsm210tr#2 = "S"; |Y #dsm210tr#3 = "S"; nSwPasa = 1; |FINSI;
         |SI #dsm210tr#0 = 1;                         nSwPasa = 1; |FINSI;
         |SI nSwPasa = 1;
            nSwPasa = 0;
            |VENTANA 1010, 1488, -1, 17, "Pagador/Adquirente del inmueble"; nVent2 = FSalida;
            aVent1 = -1;
            aVent2 = -1;
            aVent3 = 0;
            aVent4 = nVent2;
            aVent5 = "MODAL";
            |ESPECIFICA "ESTADO_VENTANA", aVent;

            |DDEFECTO #dsmow320;
            |PINPA #0#dsmow320; nPant3 = FSalida;
            |PINDA #0#dsmow320;

            |ENDATOS #1#dsmow320;
            |SI FSalida = 0; nSwPasa = 1; |FINSI;

            aVent4 = nVent2;
            aVent5 = "MODELESS";
            |ESPECIFICA "ESTADO_VENTANA", aVent;

            |FINVENTANA nVent2;
         |SINO;
            |DDEFECTO #dsmow320;
            nSwPasa = 1;
         |FINSI;

         |SI nSwPasa = 1;
            #dsm210in#0 = #dsm210ca#0;
            #dsm210in#1 = #dsm210ca#1;
            #dsm210in#2 = #dsmow306#0;
            #dsm210in#3 = #dsmow306#1;
            #dsm210in#4 = #dsmow306#2;
            #dsm210in#5 = #dsmow306#3;
            #dsm210in#6 = #dsmow306#4;
            #dsm210in#7 = #dsmow306#5;
            #dsm210in#8 = #dsmow306#6;
            #dsm210in#9 = #dsmow320#0;
            #dsm210in#10 = #dsmow320#1;
            #dsm210in#11 = #dsmow320#2;
            |GRABA 020#dsm210in.c;

            |REFRESCACONTROL nGrid1b;

            aVent4 = nVent1;
            aVent5 = "MODELESS";
            |ESPECIFICA "ESTADO_VENTANA", aVent;

            |FINVENTANA nVent1;
            |HAZ ContenidoLin;
         |SINO;
            |MENAV "    Proceso cancelado";

            aVent4 = nVent1;
            aVent5 = "MODELESS";
            |ESPECIFICA "ESTADO_VENTANA", aVent;

            |FINVENTANA nVent1;
         |FINSI;
      |SINO;
         aVent4 = nVent1;
         aVent5 = "MODELESS";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         |FINVENTANA nVent1;
      |FINSI;
   |SINO;
      |VENTANA 0810, 1588, -1, 17, "Modificar inmueble"; nVent1 = FSalida;
      aVent1 = -1;
      aVent2 = -1;
      aVent3 = 0;
      aVent4 = nVent1;
      aVent5 = "MODAL";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |SALVA_FICHA #dsm210in;

      nAntInmueble = #dsmow306#0;
      |PINPA #0#dsmow306; nPant2 = FSalida;
      |PINDA #0#dsmow306;

      |ENDATOS #1#dsmow306;
      |SI FSalida = 0;
         |REPON_FICHA #dsm210in;
         |SI nAntInmueble ! #dsmow306#0;
            |BUCLE RenumeraLins;
            |BORRA 020#dsm210in.a;

            #dsm210in#2 = #dsmow306#0;
            |GRABA 020#dsm210in.b;
         |FINSI;

         nSwPasa = 0;
         |SI #dsm210tr#2 = "S"; |Y #dsm210tr#3 = "S"; nSwPasa = 1; |FINSI;
         |SI #dsm210tr#0 = 1;                         nSwPasa = 1; |FINSI;
         |SI nSwPasa = 1;
            nSwPasa = 0;
            |VENTANA 1010, 1488, -1, 17, "Adquirente del inmueble"; nVent2 = FSalida;
            aVent1 = -1;
            aVent2 = -1;
            aVent3 = 0;
            aVent4 = nVent2;
            aVent5 = "MODAL";
            |ESPECIFICA "ESTADO_VENTANA", aVent;

            |DDEFECTO #dsmow320;
            #dsmow320#0 = #dsm210in#9;
            #dsmow320#1 = #dsm210in#10;
            #dsmow320#2 = #dsm210in#11;
            |PINPA #0#dsmow320; nPant3 = FSalida;
            |PINDA #0#dsmow320;

            |ENDATOS #1#dsmow320;
            |SI FSalida = 0; nSwPasa = 1; |FINSI;

            aVent4 = nVent2;
            aVent5 = "MODELESS";
            |ESPECIFICA "ESTADO_VENTANA", aVent;

            |FINVENTANA nVent2;
         |SINO;
            |DDEFECTO #dsmow320;
            nSwPasa = 1;
         |FINSI;

         |SI nSwPasa = 1;
            #dsm210in#3  = #dsmow306#1;
            #dsm210in#4  = #dsmow306#2;
            #dsm210in#5  = #dsmow306#3;
            #dsm210in#6  = #dsmow306#4;
            #dsm210in#7  = #dsmow306#5;
            #dsm210in#8  = #dsmow306#6;
            #dsm210in#9  = #dsmow320#0;
            #dsm210in#10 = #dsmow320#1;
            #dsm210in#11 = #dsmow320#2;
            |GRABA 020#dsm210in.a; |LIBERA #dsm210in;

            |REFRESCACONTROL nGrid1b;

            aVent4 = nVent1;
            aVent5 = "MODELESS";
            |ESPECIFICA "ESTADO_VENTANA", aVent;

            |FINVENTANA nVent1;
            |HAZ ContenidoLin;
         |SINO;
            |MENAV "    Proceso cancelado";

            aVent4 = nVent1;
            aVent5 = "MODELESS";
            |ESPECIFICA "ESTADO_VENTANA", aVent;

            |FINVENTANA nVent1;
         |FINSI;
      |SINO;
         |REPON_FICHA #dsm210in;
         aVent4 = nVent1;
         aVent5 = "MODELESS";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         |FINVENTANA nVent1;
      |FINSI;
   |FINSI;

   |CIERRA #dsminmex;

   |FOCOTECLADO nGrid1b;
   Cmp = -1;
|FPRC;

|PROCESO BotonNueNi;
   |SI nEstadoG1a = 1;
      |C_M #dsmow303#0, 1, "S";
      |DDEFECTO #dsmow303;
      nSw = 1; |HAZ VentanaNif;
   |FINSI;
   |SI nEstadoG1b = 1;
      |DDEFECTO #dsmow306;
      nSw = 1; |HAZ VentanaInm;
   |FINSI;
|FPRC;

|PROCESO ComprDatInm210;
   nModelo = 210;
   |ABRE #dsminmex;
   #dsminmex#0 = #dsm210in#0;
   #dsminmex#1 = #dsm210in#2;
   |LEE 000#dsminmex.=;
   |SI FSalida = 0;
      nSwActualiza = 0;

      || Referencia catastral
      nCmpA = 2;  nCmpB = 4;  |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza210; |FINSI;
      || Direccion
      nCmpA = 3;  nCmpB = 5;  |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza210; |FINSI;
      || Codigo Postal
      nCmpA = 15;  nCmpB = 6;  |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza210; |FINSI;
      || Localidad
      nCmpA = 17; nCmpB = 7;  |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza210; |FINSI;
      || Provincia
      nCmpA = 19; nCmpB = 8;  |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza210; |FINSI;
      || Descripcion del inmueble
      nCmpA = 22; nCmpB = 3;  |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza210; |FINSI;

|ET Actualiza210;
      |SI nSwActualiza = 1;
         aAlfa = "    NSe han encontrado datos distintos a la ficha de inmuebles. " + &191 + " Actualizar ?";
         |CONFI aAlfa;
         |SI FSalida = 0;
            #dsm211ca#3  = #dsminmex#22;
            #dsm211ca#4  = #dsminmex#2;
            aAlfa  = #dsminmex#3;  |QBF aAlfa;
            aAlfa2 = #dsminmex#4;  |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + " " + aAlfa2; |FINSI;
            aAlfa2 = #dsminmex#5;  |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + " " + aAlfa2; |FINSI;
            aAlfa2 = #dsminmex#6;  |QBF aAlfa2; |SI aAlfa2 ! "0"; |Y aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa2; |FINSI;
            aAlfa2 = #dsminmex#7;  |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + " " + aAlfa2; |FINSI;
            aAlfa2 = #dsminmex#8;  |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + ", " + aAlfa2; |FINSI;
            aAlfa2 = #dsminmex#9;  |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + ", " + aAlfa2; |FINSI;
            aAlfa2 = #dsminmex#10; |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + ", " + aAlfa2; |FINSI;
            aAlfa2 = #dsminmex#11; |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + " " + aAlfa2; |FINSI;
            aAlfa2 = #dsminmex#12; |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + "-" + aAlfa2; |FINSI;
            #dsm210in#5 = aAlfa;
            aAlfa = (("00" + #dsminmex#15) % -102) + (("000" + #dsminmex#16) % -103);
            #dsm210in#6  = aAlfa;
            #dsm210in#7  = #dsminmex#17;
            #dsm210in#8  = #dsminmex#19;
            |GRABA 020#dsm210in.a;

            |REFRESCACONTROL nGrid1b;
         |FINSI;
      |FINSI;
   |FINSI;
   |CIERRA #dsminmex;
|FPRC;

|PROCESO BotonModNi;
   |SI nEstadoG1a = 1;
      #dsmow303#0 = #dsm210ni#2;
      #dsmow303#1 = #dsm210ni#4;
      #dsmow303#2 = #dsm210ni#3;

      |C_M #dsmow303#0, 1, "N";
      nSw = 2; |HAZ VentanaNif;
   |FINSI;
   |SI nEstadoG1b = 1;
      |HAZ ComprDatInm210;

      #dsmow306#0 = #dsm210in#2;
      #dsmow306#1 = #dsm210in#3;
      #dsmow306#2 = #dsm210in#4;
      #dsmow306#3 = #dsm210in#5;
      #dsmow306#4 = #dsm210in#6;
      #dsmow306#5 = #dsm210in#7;
      #dsmow306#6 = #dsm210in#8;

      nSw = 2; |HAZ VentanaInm;
   |FINSI;
|FPRC;

|PROCESO BotonBorNi;
   |SI nEstadoG1a = 1;
      |LEE 101#dsm210ni.=;
      |SI FSalida = 0;
         aAlfa = "    N" + &191 + " Esta seguro de eliminar el Nif con todos sus datos ?";
         |CONFI aAlfa;
         |SI FSalida = 0;
            aDNif = #dsm210ni#2; aHNif = #dsm210ni#2;
            nDInm = 0;           nHInm = 0;
            |BUCLE BorraLin210;
            |BORRA 020#dsm210ni.a;

            |ESTADO_CONTROL nBotonModNi, "DISABLE";
            |ESTADO_CONTROL nBotonBorNi, "DISABLE";

            |REFRESCACONTROL nGrid1a;
         |FINSI;
         |LIBERA #dsm210ni;
      |FINSI;
   |FINSI;
   |SI nEstadoG1b = 1;
      |LEE 101#dsm210in.=;
      |SI FSalida = 0;
         aAlfa = "    N" + &191 + " Está seguro de eliminar el inmueble con todos sus datos ?";
         |CONFI aAlfa;
         |SI FSalida = 0;
            aDNif = " " * 15;    aHNif = " " * 15;
            nDInm = #dsm210in#2; nHInm = #dsm210in#2;
            |BUCLE BorraLin210;
            |BORRA 020#dsm210in.a;

            #dsm210in#0 = #dsm210ca#0;
            #dsm210in#1 = #dsm210ca#1;
            #dsm210in#2 = 1;
            |LEE 000#dsm210in.];
            |SI FSalida ! 0; |O #dsm210in#0 ! #dsm210ca#0; |O #dsm210in#1 ! #dsm210ca#1;
               |ESTADO_CONTROL nBotonModNi, "DISABLE";
               |ESTADO_CONTROL nBotonBorNi, "DISABLE";
               |DDEFECTO #dsm210in;
               |REFRESCACONTROL nGrid1aa;
            |FINSI;

            |REFRESCACONTROL nGrid1b;
         |FINSI;
         |LIBERA #dsm210in;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO AnulaBotonesVentLin;
   |ESTADO_CONTROL nBotonCambFc,"DISABLE";
   |ESTADO_CONTROL nBotonNueLN, "DISABLE";
   |ESTADO_CONTROL nBotonModLN, "DISABLE";
   |ESTADO_CONTROL nBotonBorLN, "DISABLE";
   |ESTADO_CONTROL nBotonSalLN, "DISABLE";
   |ESTADO_CONTROL nBotonPago, "DISABLE";
   |ESTADO_CONTROL nBotonSalirTodo, "DISABLE";

   nPos1 = 3076; nPos2 = 3086;
   |CONTROL_SIMPLE nSubPant, "BOTON,{{206}}Vali&Dar", nPos1, nPos2, BotonOk;
   nBotonOk = FSalida;

   nPos1 = 3088; nPos2 = 3098;
   |CONTROL_SIMPLE nSubPant, "BOTON,{{207}}Ca&Ncelar", nPos1, nPos2, BotonCancel;
   nBotonCancel = FSalida;
|FPRC;

|PROCESO ActivaBotonesVentLin;
   |FIN_CONTROL_WINDOWS nBotonCancel;
   |FIN_CONTROL_WINDOWS nBotonOk;

   |ESTADO_CONTROL nBotonSalirTodo, "ENABLE";
   |ESTADO_CONTROL nBotonCambFc,"ENABLE";
   |ESTADO_CONTROL nBotonNueLN, "ENABLE";
   |ESTADO_CONTROL nBotonSalLN, "ENABLE";
   |ESTADO_CONTROL nBotonPago, "ENABLE";

   #dsm210ln#0 = #dsm210ca#0;
   #dsm210ln#1 = #dsm210ca#1;
   |SI #dsm210tr#2 = "S";
      #dsm210ln#3 = #dsm210in#2;
   |SINO;
      |SI #dsm210tr#2 = "S";
         #dsm210ln#2 = #dsm210ni#2;
      |FINSI;
   |FINSI;
   #dsm210ln#4 = "01.01.0000";
   #dsm210ln#5 = 0;
   |LEE 000#dsm210ln.];
   |SI #dsm210tr#2 = "S";
      |SI FSalida = 0; |Y #dsm210ln#0 = #dsm210ca#0; |Y #dsm210ln#1 = #dsm210ca#1;
      |Y #dsm210ln#3 = #dsm210in#2;
         |ESTADO_CONTROL nBotonBorLN, "ENABLE";
         |ESTADO_CONTROL nBotonModLN, "ENABLE";
      |FINSI;
   |SINO;
      |SI #dsm210tr#3 = "S";
         |SI FSalida = 0; |Y #dsm210ln#0 = #dsm210ca#0; |Y #dsm210ln#1 = #dsm210ca#1;
         |Y #dsm210ln#2 = #dsm210ni#2;
            |ESTADO_CONTROL nBotonBorLN, "ENABLE";
            |ESTADO_CONTROL nBotonModLN, "ENABLE";
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO VentanaLin;
   |SI #dsm210tr#4 = "I"; |O #dsm210tr#4 = "G";
      |ENDATOS #1#dsmow307;
      FEstado = FSalida;
      |SI FSalida = 0;
         #dsm210ln#7 = #dsmow307#0;

         #dsmow301#6 = #dsmow307#0 % #dsmow301#5; |PINTA #dsmow301#6;
         #dsmow301#10 = 0; |PINTA #dsmow301#10;
      |FINSI;
   |FINSI;
   |SI #dsm210tr#4 = "R";
      |ENDATOS #1#dsmow308;
      FEstado = FSalida;
      |SI FSalida = 0;
         #dsm210ln#7  = #dsmow308#3;
         #dsm210ln#8  = #dsmow308#0;
         #dsm210ln#9  = #dsmow308#1;
         #dsm210ln#10 = #dsmow308#2;
         #dsmow301#6  = #dsmow308#3 % #dsmow301#5; |PINTA #dsmow301#6;
         #dsmow301#10 = #dsmow308#0 % #dsmow301#9; |PINTA #dsmow301#10;
      |FINSI;
   |FINSI;
   |SI #dsm210tr#4 = "H";
      Cmp = 4;
      efFechaDev = #dsm210ln#4;
      |ENDATOS #1#dsmow309;
      FEstado = FSalida;
      |SI FSalida = 0;
         #dsm210ln#7  = #dsmow309#13;
         #dsm210ln#11 = #dsmow309#0;
         #dsm210ln#12 = #dsmow309#1;
         #dsm210ln#13 = #dsmow309#2;
         #dsm210ln#14 = #dsmow309#3;
         #dsm210ln#15 = #dsmow309#4;
         #dsm210ln#16 = #dsmow309#5;
         #dsm210ln#17 = #dsmow309#6;
         #dsm210ln#18 = #dsmow309#7;
         #dsm210ln#19 = #dsmow309#8;
         #dsm210ln#20 = #dsmow309#9;
         #dsm210ln#21 = #dsmow309#10;
         #dsm210ln#22 = #dsmow309#11;
         #dsm210ln#23 = #dsmow309#12;
         #dsm210ln#24 = #dsmow309#14;
         #dsm210ln#25 = #dsmow309#15;
         #dsm210ln#26 = #dsmow309#16;
         #dsm210ln#32 = #dsmow309#1;
         #dsm210ln#33 = #dsmow309#2;
         #dsm210ln#39 = #dsmow309#17;

         #dsmow301#6 = #dsmow309#13 % #dsmow301#5; |PINTA #dsmow301#6;
         #dsmow301#10 = 0; |PINTA #dsmow301#10;
      |FINSI;
      Cmp = -1;
   |FINSI;
   |PULSATECLA;
   #dsm210ln#35 = #dsmow301#5;
   #dsm210ln#36 = #dsmow301#3;
   #dsm210ln#37 = #dsmow301#4;
   #dsm210ln#38 = #dsmow301#9;

   |SI FEstado = 0;
      |VENTANA 1109, 1891, -1, 17, "Datos liquidacion"; nVent1 = FSalida;
      aVent1 = -1;
      aVent2 = -1;
      aVent3 = 0;
      aVent4 = nVent1;
      aVent5 = "MODAL";
      |ESPECIFICA "ESTADO_VENTANA", aVent;

      |DDEFECTO #dsmow322;
      |SI nModoL2 = 2;
         #dsmow322#0 = #dsm210ln#27;
         #dsmow322#1 = #dsm210ln#28;
         #dsmow322#2 = #dsm210ln#29;
         #dsmow322#3 = #dsm210ln#30;
         #dsmow322#4 = -#dsm210ln#31;
      |FINSI;

      #dsmow322#5 = #dsm210ln#35;
      #dsmow322#6 = #dsm210ln#36;
      #dsmow322#7 = #dsm210ln#37;
      #dsmow322#8 = #dsm210ln#38;

      |PINPA #0#dsmow322; nPant3 = FSalida;
      |PINDA #0#dsmow322;

      |ENDATOS #1#dsmow322;
      |SI FSalida = 0;
         #dsm210ln#27 = #dsmow322#0;
         #dsm210ln#28 = #dsmow322#1;
         #dsm210ln#29 = #dsmow322#2;
         #dsm210ln#30 = #dsmow322#3;
         #dsm210ln#31 = -#dsmow322#4;

         #dsm210ln#35 = #dsmow322#5;
         #dsm210ln#36 = #dsmow322#6;
         #dsm210ln#37 = #dsmow322#7;
         #dsm210ln#38 = #dsmow322#8;

         |GRABA 020#dsm210ln.a;
      |FINSI;

      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1;
   |FINSI;
   |PULSATECLA;

   #dsmow301#5  = #dsm210ln#35; |PINTA #dsmow301#5;
   #dsmow301#3  = #dsm210ln#36; |PINTA #dsmow301#3;
   #dsmow301#4  = #dsm210ln#37; |PINTA #dsmow301#4;
   #dsmow301#9  = #dsm210ln#38; |PINTA #dsmow301#9;
   #dsmow301#7  = #dsm210ln#27; |PINTA #dsmow301#7;
   #dsmow301#13 = #dsm210ln#28; |PINTA #dsmow301#13;
   #dsmow301#14 = #dsm210ln#31; |PINTA #dsmow301#14;

   |HAZ CalculoLiq210;
   #dsm210ln#34 = #dsmow301#15;

   |FOCOTECLADO nGrid1aa;
|FPRC;

|PROCESO ActValorAd;
   aAlfa = #dsm210ln#4; |QBF aAlfa;
   aAlfa = aAlfa % -104;
   |ABRE #dsmivcex;
   #dsmivcex#0 = #dsm210ln#0;
   #dsmivcex#1 = #dsm210ln#3;
   #dsmivcex#2 = aAlfa;
   |LEE 000#dsmivcex.=;
   |SI FSalida ! 0; |DDEFECTO #dsmivcex; |FINSI;
   |CIERRA #dsmivcex;
   |SI #dsmivcex#4 = " ";
       #dsmivcex#4 = #dsminmex#28;
   |FINSI;

   |SI #dsm210tr#4 = "G";
      |SI #dsmivcex#4 = "S";
         #dsmow307#0 = (#dsminmex#25 % 1.1) ! 2;
      |SINO;
         #dsmow307#0 = (#dsminmex#25 % 2) ! 2;
      |FINSI;
      |PINTA #dsmow307#0;
   |FINSI;
   |SI #dsm210tr#4 = "I";

      aAlfa = #dsm210ln#4;  aAlfa = aAlfa % -104; nCalc1 = aAlfa;
      aAlfa = "01.01." + nCalc1; fFechaIni = aAlfa;
      aAlfa = "31.12." + nCalc1; fFechaFin = aAlfa;
      nCalc1 = fFechaIni; nCalc2 = fFechaFin; nDias = (nCalc2 - nCalc1) + 1;

      fFechaIni = #dsminmex#24;
      aAlfa = #dsminmex#24; aAlfa = aAlfa % -104; nCalc = aAlfa;
      aAlfa = #dsm210ln#4;  aAlfa = aAlfa % -104; nCalc1 = aAlfa;
      |SI nCalc ! nCalc1; aAlfa = "01.01." + nCalc1; fFechaIni = aAlfa; |FINSI;

      aAlfa = #dsminmex#29; aAlfa = aAlfa % -104; nCalc2 = aAlfa;
      |SI nCalc1 = nCalc2;
         fFechaFin = #dsminmex#29;
      |SINO;
         |SI nCalc1 > nCalc2;
            fFechaFin = #dsm210ln#4;
         |SINO;
            aAlfa = "31.12." + nCalc1;
            fFechaFin = aAlfa;
         |FINSI;
      |FINSI;

      nCalc = fFechaFin - fFechaIni; nCalc = nCalc + 1;
      nFactor = nCalc / nDias;

      |SI #dsmivcex#4 = "S";
         nCalc = (#dsmivcex#3 % 1.1) ! 2;
      |SINO;
         nCalc = (#dsmivcex#3 % 2) ! 2;
      |FINSI;
      nCalc = (nCalc * nFactor) ! 2; #dsmow307#0 = nCalc;
      |PINTA #dsmow307#0;
   |FINSI;
   |SI #dsm210tr#4 = "H";
      |ABRE #dsm210t1;
      #dsmow309#14 = #dsminmex#24; |PINTA #dsmow309#14;
      #dsmow309#15 = #dsminmex#26; |PINTA #dsmow309#15;
      aAlfa = fFecha; |QBF aAlfa; aAlfa = aAlfa % -104;
      #dsm210t1#0 = aAlfa;
      aAlfa = #dsmow309#14; |QBF aAlfa; aAlfa = aAlfa % -104;
      #dsm210t1#1 = aAlfa;
      |LEE 000#dsm210t1.=;
      |SI FSalida = 0;
         nCalc = #dsm210t1#2;
      |SINO;
         nCalc = 1;

         aAlfa = #dsmow309#14; |QBF aAlfa; aAlfa = aAlfa % -104; nCalc3 = aAlfa;
         aAlfa = fFecha; |QBF aAlfa; aAlfa = aAlfa % -104;
         #dsm210t1#0 = aAlfa; aAlfa = #dsm210t1#0;
         #dsm210t1#1 = 1;
         |LEE 000#dsm210t1.];
         |PARA; |SI FSalida = 0; |Y #dsm210t1#0 = aAlfa; |HACIENDO;
            |SI #dsm210t1#1 ] nCalc3; nCalc = #dsm210t1#2; |SAL; |FINSI;
            |LEE 000#dsm210t1.s;
         |SIGUE;
      |FINSI;


      nCalc = (#dsminmex#25 * nCalc) ! 2;
      #dsmow309#7 = nCalc; |PINTA #dsmow309#7;
      aAlfa = fFecha; |QBF aAlfa; aAlfa = aAlfa % -104;
      #dsm210t1#0 = aAlfa;
      aAlfa = #dsmow309#15; |QBF aAlfa; aAlfa = aAlfa % -104;
      #dsm210t1#1 = aAlfa;
      |LEE 000#dsm210t1.=;
      |SI FSalida = 0;
         nCalc = #dsm210t1#2;
      |SINO;
         nCalc = 1;
      |FINSI;
      nCalc = (#dsminmex#27 * nCalc) ! 2;
      #dsmow309#8 = nCalc; |PINTA #dsmow309#8;
      |CIERRA #dsm210t1;

      aAlfa = #dsminmex#29; |QBF aAlfa;
      |SI aAlfa > "01.01.0000";
          |SI #dsmow309#8 = 0;
              #dsmow309#5 = #dsminmex#30;
          |SINO;
              #dsmow309#5 = (#dsminmex#30 * #dsmow309#7) / (#dsmow309#7 + #dsmow309#8);
              #dsmow309#6 = #dsminmex#30 - #dsmow309#5;
          |FINSI;

          |PINTA #dsmow309#5;
          |PINTA #dsmow309#6;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO PintaTipo;
   |SI nLabelTipo > 0; |FIN_CONTROL_WINDOWS nLabelTipo; nLabelTipo = -1; |FINSI;

   aAlfa = "";
   |SI enPorc1 ! 0;   |Y enPorc2 ! 0;   aAlfa = "Tipo contribuyente : VARIOS";    |FINSI;
   |SI enPorc1 = 100; |Y enPorc2 = 0;   aAlfa = "Tipo contribuyente : TITULAR";   |FINSI;
   |SI enPorc1 = 0;   |Y enPorc2 = 100; aAlfa = "Tipo contribuyente : CONYUGE";   |FINSI;
   |SI enPorc1 = 50;  |Y enPorc2 = 50;  aAlfa = "Tipo contribuyente : GANANCIAL"; |FINSI;
   aAlfa = "LABEL,{{6}}" + aAlfa;

   |SI #dsm210tr#4 ! "H";
      nPos1 = 1702; nPos2 = 1750;
      |CONTROL_SIMPLE nPant1, aAlfa, nPos1, nPos2, NULL; nLabelTipo = FSalida;
   |FINSI;
   |PULSATECLA;
|FPRC;

|PROCESO PantaMensa;
   |VENTANA 1110, 1590, -1, 17, ""; nVentEsp = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVentEsp;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |CONTROL_SIMPLE 0, "LABEL,{{17}}En el caso de titularidad del inmueble distinta del 100%, los importes de la pantalla siguente se deben introducir", 1112, 1188, NULL;
   |CONTROL_SIMPLE 0, "LABEL,{{17}}prorrateados  segun  dicho  porcentaje. ", 1212, 1288, NULL;
   |CONTROL_SIMPLE 0, "LABEL,{{17}}En el caso de matrimonios en gananciales, debe ser la suma de los porcentajes de ambos conyuges", 1412, 1488, NULL;

   |PTEC 802; |PAUSA;
|FPRC;

|PROCESO QuitaPantaMensa;
   aVent4 = nVentEsp;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVentEsp;
|FPRC;

|PROCESO BotonNueLN;
   nModoL2 = 1;
   |DDEFECTO #dsm210ln;
   #dsm210ln#0 = #dsm210ca#0;
   #dsm210ln#1 = #dsm210ca#1;
   |SI #dsm210tr#2 = "S";
       #dsm210ln#3 = #dsm210in#2;
   |SINO;
       |SI #dsm210tr#3 = "S"; #dsm210ln#2 = #dsm210ni#2; |FINSI;
   |FINSI;
   #dsm210ln#4 = "01.01.0000";
   |GRABA 020#dsm210ln.c;

   |SALVA_FICHA #dsm210ln;
   |REFRESCACONTROL nGrid1aa;
   |PULSATECLA;
   |REPON_FICHA #dsm210ln;

   |HAZ AnulaBotonesVentLin;

   aAlfa = #dsminmex#29; |QBF aAlfa;
   |SI aAlfa = "01.01.0000";
      #dsm210ln#4 = ~;
   |SINO;
      #dsm210ln#4 = #dsminmex#29;
   |FINSI;

   |SI #dsm210tr#4 = "H";
      #dsmow309#1 = #dsminmex#31; |PINTA #dsmow309#1;
      #dsmow309#2 = #dsminmex#32; |PINTA #dsmow309#2;
      #dsmow309#3 = #dsm210dp#65; |PINTA #dsmow309#3;
      #dsmow309#4 = #dsm210dp#64; |PINTA #dsmow309#4;

      |SI #dsmow309#1 ! 100; |Y #dsm210dp#65 ! "               ";
          #dsmow309#0 = "C";
      |SINO;
          #dsmow309#0 = "O";
      |FINSI;
      |PINTA #dsmow309#0;

   |FINSI;

|ET PideCampo1;
   |SI #dsm210tr#4 = "H"; |O #dsm210tr#4 = "I";
      |SI #dsm210tr#4 = "H";
         |SI nLabelTipo > 0; |FIN_CONTROL_WINDOWS nLabelTipo; nLabelTipo = -1; |FINSI;
         enPorc1 = 100; enPorc2 = 0;
      |FINSI;
      |SI #dsm210tr#4 = "I";
         enPorc1 = #dsminmex#31; enPorc2 = #dsminmex#32;
         |HAZ PintaTipo;
      |FINSI;
   |SINO;
      enPorc1 = 0; enPorc2 = 0; |HAZ SelecTipo;
      |HAZ PintaTipo;
   |FINSI;

   |SI #dsm210ln#1 = 2;
      aAlfa = #dsm210ln#4; |QBF aAlfa; aAlfa = aAlfa % -104;
      aAlfa = "31.12." + aAlfa; #dsm210ln#4 = aAlfa;
   |FINSI;
   |ENCAMPO #4#dsm210ln;
   |SI FSalida = 0;
      |SI #dsm210ln#1 = 2;
         aAlfa = #dsm210ln#4; |QBF aAlfa;
         aAlfa = aAlfa % 0106;
         |SI aAlfa ! "31.12."; |VETE PideCampo1; |FINSI;
      |FINSI;

      efFechaDev = #dsm210ln#4;
      |ENCAMPO #5#dsm210ln;
      |SI FSalida = 0;
         efFechaDev = #dsm210ln#4;

         fFecha = #dsm210ln#4;
         nDivis = #dsm210ln#5;
         aDivis = #dsm210ln#6;
         |BORRA 020#dsm210ln.a; |LIBERA #dsm210ln;

         fFecha1  = fFecha;
         nTr210tr = #dsm210ca#1; |HAZ CalAnyTr;

         |DDEFECTO #dsm210ln;
         #dsm210ln#0 = #dsm210ca#0;
         #dsm210ln#1 = #dsm210ca#1;
         |SI #dsm210tr#2 = "S";
             #dsm210ln#3 = #dsm210in#2;
         |SINO;
             |SI #dsm210tr#3 = "S"; #dsm210ln#2 = #dsm210ni#2; |FINSI;
         |FINSI;
         #dsm210ln#4 = fFecha;
         #dsm210ln#5 = nDivis;
         |LEE 000#dsm210ln.=;
         |SI FSalida ! 0;
            |DDEFECTO #dsm210ln;
            #dsm210ln#0 = #dsm210ca#0;
            #dsm210ln#1 = #dsm210ca#1;
            |SI #dsm210tr#2 = "S";
               #dsm210ln#3 = #dsm210in#2;
            |SINO;
               |SI #dsm210tr#3 = "S"; #dsm210ln#2 = #dsm210ni#2; |FINSI;
            |FINSI;
            #dsm210ln#4 = fFecha;
            #dsm210ln#5 = nDivis;
            #dsm210ln#6 = aDivis;
            #dsm210ln#32 = enPorc1;
            #dsm210ln#33 = enPorc2;
            #dsm210ln#35 = nTg210tr;
            #dsm210ln#36 = #dsm210ca#3;
            #dsm210ln#37 = #dsm210ca#4;
            #dsm210ln#38 = #dsm210ca#7;
            |GRABA 020#dsm210ln.c;

            #dsmow301#5 = #dsm210ln#35; |PINTA #dsmow301#5;
            #dsmow301#3 = #dsm210ln#36; |PINTA #dsmow301#3;
            #dsmow301#4 = #dsm210ln#37; |PINTA #dsmow301#4;
            #dsmow301#9 = #dsm210ln#38; |PINTA #dsmow301#9;


  |SI  #dsm210tr#4 = "H";
      |HAZ PantaMensa;
      |PAUSA;
      |HAZ QuitaPantaMensa;
  |FINSI;
            |HAZ ActValorAd;

            |HAZ VentanaLin;
            |SI FEstado = 0;
               |GRABA 020#dsm210ln.a; |LIBERA #dsm210ln;
            |SINO;
               |BORRA 020#dsm210ln.a; |LIBERA #dsm210ln;
            |FINSI;
         |SINO;
            |MENAV "    La fecha con esa divisa ya existe";
         |FINSI;
      |SINO;
         |BORRA 020#dsm210ln.a; |LIBERA #dsm210ln;
      |FINSI;
   |SINO;
      |BORRA 020#dsm210ln.a; |LIBERA #dsm210ln;
   |FINSI;
   |HAZ ActivaBotonesVentLin;

   |REFRESCACONTROL nGrid1aa;
   nModoL2 = 0;
|FPRC;

|PROCESO BotonModLN;
   nModoL2 = 2;

   |LEE 101#dsm210ln.=;
   |SI FSalida = 0;
      |SI #dsm210tr#4 = "I"; |O #dsm210tr#4 = "G";
         #dsmow307#0 = #dsm210ln#7;
      |FINSI;
      |SI #dsm210tr#4 = "R";
         #dsmow308#3 = #dsm210ln#7;
         #dsmow308#0 = #dsm210ln#8;
         #dsmow308#1 = #dsm210ln#9;
         #dsmow308#2 = #dsm210ln#10;
      |FINSI;
      |SI #dsm210tr#4 = "H";
         efFechaDev   = #dsm210ln#4;
         #dsmow309#13 = #dsm210ln#7;
         #dsmow309#0  = #dsm210ln#11;
         #dsmow309#1  = #dsm210ln#12;
         #dsmow309#2  = #dsm210ln#13;
         #dsmow309#3  = #dsm210ln#14;
         #dsmow309#4  = #dsm210ln#15;
         #dsmow309#5  = #dsm210ln#16;
         #dsmow309#6  = #dsm210ln#17;
         #dsmow309#7  = #dsm210ln#18;
         #dsmow309#8  = #dsm210ln#19;
         #dsmow309#9  = #dsm210ln#20;
         #dsmow309#10 = #dsm210ln#21;
         #dsmow309#11 = #dsm210ln#22;
         #dsmow309#12 = #dsm210ln#23;
         #dsmow309#13 = #dsmow309#11 + #dsmow309#12;
         |SI #dsmow309#13 < 0; #dsmow309#13 = 0; |FINSI;
         #dsmow309#14 = #dsm210ln#24;
         #dsmow309#15 = #dsm210ln#25;
         #dsmow309#16 = #dsm210ln#26;
         #dsmow309#17 = #dsm210ln#39;
      |FINSI;

      #dsmow322#0 =  #dsm210ln#27;
      #dsmow322#1 =  #dsm210ln#28;
      #dsmow322#2 =  #dsm210ln#29;
      #dsmow322#3 =  #dsm210ln#30;
      #dsmow322#4 = -#dsm210ln#31;
      #dsmow322#5 =  #dsm210ln#35;
      #dsmow322#6 =  #dsm210ln#36;
      #dsmow322#7 =  #dsm210ln#37;
      #dsmow322#8 =  #dsm210ln#38;

      enPorc1 = #dsm210ln#32; enPorc2 = #dsm210ln#33;
      |SI #dsm210tr#4 ! "H"; |Y #dsm210tr#4 ! "I";
          |HAZ SelecTipo;
      |FINSI;
      |HAZ PintaTipo;

      |HAZ AnulaBotonesVentLin;

  |SI  #dsm210tr#4 = "H";
      |HAZ PantaMensa;
      |PAUSA;
      |HAZ QuitaPantaMensa;
  |FINSI;

      |HAZ VentanaLin;
      |SI FEstado = 0;
         #dsm210ln#32 = enPorc1; #dsm210ln#33 = enPorc2;
         |GRABA 020#dsm210ln.a;
      |FINSI;
      |LIBERA #dsm210ln;
      |REFRESCACONTROL nGrid1aa;
      |HAZ ActivaBotonesVentLin;
   |FINSI;

   nModoL2 = 0;
|FPRC;

|PROCESO BorraFP;
   #dsm210fp#0 = nContr;
   #dsm210fp#1 = nTipoR;
   #dsm210fp#2 = aNifLn;
   #dsm210fp#3 = nInmLn;
   #dsm210fp#4 = nDivLn;
   |SI nResul ] 0; #dsm210fp#37 = "P"; |SINO; #dsm210fp#37 = "N"; |FINSI;
   |LEE 101#dsm210fp.=;
   |SI FSalida = 0;
      |BORRA 020#dsm210fp.a; |LIBERA #dsm210fp;
   |FINSI;
|FPRC;

|PROCESO MiraSiBorFP;
   |SALVA_FICHA #dsm210ln;

   nSwBorFP = 1;
   |SI #dsm210tr#2 = "S";
      #dsm210ln#0 = #dsm210dp#0;
      #dsm210ln#1 = #dsm210ca#1;
      #dsm210ln#2 = ""; aAlfa = #dsm210ln#2;
      #dsm210ln#3 = #dsm210in#2;
      #dsm210ln#4 = "01.01.0000";
      #dsm210ln#5 = nDivisa;
   |SINO;
      |SI #dsm210tr#3 = "S";
         #dsm210ln#0 = #dsm210dp#0;
         #dsm210ln#1 = #dsm210ca#1;
         #dsm210ln#2 = #dsm210ni#2; aAlfa = #dsm210ln#2;
         #dsm210ln#3 = 000;
         #dsm210ln#4 = "01.01.0000";
         #dsm210ln#5 = nDivisa;
      |FINSI;
   |FINSI;
   |LEE 000#dsm210ln.];
   |SI FSalida = 0; |Y #dsm210ln#0 = #dsm210dp#0; |Y #dsm210ln#1 = #dsm210ca#1; |Y #dsm210ln#5 = nDivisa;
      |SI #dsm210tr#2 = "S";
         |SI #dsm210ln#2 = aAlfa; |Y #dsm210ln#3 = #dsm210in#2;
            nSwBorFP = 0;
         |FINSI;
      |SINO;
         |SI #dsm210tr#3 = "S";
            |SI #dsm210ln#2 = #dsm210ni#2; |Y #dsm210ln#3 = 000;
               nSwBorFP = 0;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
   |REPON_FICHA #dsm210ln;

   |SI nSwBorFP = 1;
      |ABRE #dsm210fp;
      nContr = #dsm210ln#0; nTipoR = #dsm210ln#1;
      aNifLn = #dsm210ln#2; nInmLn = #dsm210ln#3;
      nDivLn = #dsm210ln#5; nResul = #dsm210ln#34;
      |HAZ BorraFP;
      |CIERRA #dsm210fp;
   |FINSI;
|FPRC;

|PROCESO BotonBorLN;
   |LEE 101#dsm210ln.=;
   |SI FSalida = 0;
      aAlfa = "    N" + &191 + " Está seguro de eliminar la linea de importes seleccionada ?";
      |CONFI aAlfa;
      |SI FSalida = 0;
         |BORRA 020#dsm210ln.a;

         || Compruebo si tengo que borrar la forma de pago
         nDivisa = #dsm210ln#5; |HAZ MiraSiBorFP;

         |REFRESCACONTROL nGrid1aa;
      |FINSI;
      |LIBERA #dsm210ln;
   |FINSI;
|FPRC;

|PROCESO MiraSiTrans;
|ACABA;
   |PARA nCont = 13; |SI nCont [ 30; |HACIENDO nCont = nCont + 1;
      |SI #dsmow315#32 = "T";
         #dsmow315#nCont# = ""; |PINTA #dsmow315#nCont#;
         |C_M #dsmow315#nCont#, 1, "N";
      |SINO;
         |C_M #dsmow315#nCont#, 1, "S";
      |FINSI;
   |SIGUE;
|FPRC;

|PROCESO BotonTit;
   enSwTit = 1;
   |ESTADO_CONTROL nBotonTit, "DISABLE";
   |ESTADO_CONTROL nBotonCon, "ENABLE";

   aDatosCon1 = " ";
   |SI #dsmow315#1 = "S"; aDatosCon1 = "E"; |FINSI;
   |SI #dsmow315#2 = "S"; aDatosCon1 = "X"; |FINSI;
   |PARA nCont = 2; |SI nCont [ 31; |HACIENDO nCont = nCont + 1;
      nCalc = nCont - 1;
      IaDatosCon = aDatosCon1<-; IaDatosCon = IaDatosCon + nCalc;
      aDatosCon = #dsmow315#nCont#;
   |SIGUE;

   |DDEFECTO #dsmow315;
   #dsmow315#0 = #dsmow301#15;

   |SI aDatosTit1 = "E";
      #dsmow315#1 = "S"; #dsmow315#33 = "N";
   |SINO;
      #dsmow315#1 = "N"; #dsmow315#33 = "S";
   |FINSI;
   |PINTA #dsmow315#1; |PINTA #dsmow315#33;
   |PARA nCont = 2; |SI nCont [ 31; |HACIENDO nCont = nCont + 1;
      nCalc = nCont - 1;
      IaDatosTit = aDatosTit1<-; IaDatosTit = IaDatosTit + nCalc;
      #dsmow315#nCont# = aDatosTit;
      |C_V #dsmow315#nCont#, 0, aAlfa;
      |SI aAlfa = "S"; |PINTA #dsmow315#nCont#; |FINSI;
   |SIGUE;
   |HAZ AntesDeNada;

   #rpaises@#0 = #dsmow315#30;
   |LEE 000#rpaises@.=;
   |SI FSalida = 0; #dsmow315#31 = #rpaises@#1; |PINTA #dsmow315#31; |FINSI;

   |SI #dsmow315#0 ] 0; aAlfa = "|C001WID"; |SINO; aAlfa = "|C004WID"; |FINSI;
   aAlfa = #dsmow315#aAlfa#; nCalc = aAlfa; |FOCOTECLADO nCalc;;
|FPRC;

|PROCESO BotonCon;
   enSwTit = 2;
   |ESTADO_CONTROL nBotonTit, "ENABLE";
   |ESTADO_CONTROL nBotonCon, "DISABLE";

   aDatosTit1 = " ";
   |SI #dsmow315#1 = "S"; aDatosTit1 = "E"; |FINSI;
   |SI #dsmow315#2 = "S"; aDatosTit1 = "X"; |FINSI;
   |PARA nCont = 2; |SI nCont [ 31; |HACIENDO nCont = nCont + 1;
      nCalc = nCont - 1;
      IaDatosTit = aDatosTit1<-; IaDatosTit = IaDatosTit + nCalc;
      aDatosTit = #dsmow315#nCont#;
   |SIGUE;

   |DDEFECTO #dsmow315;
   #dsmow315#0 = #dsmow301#15;

   |SI aDatosCon1 = "E";
      #dsmow315#1 = "S"; #dsmow315#33 = "N";
   |SINO;
      #dsmow315#1 = "N"; #dsmow315#33 = "S";
   |FINSI;
   |PINTA #dsmow315#1; |PINTA #dsmow315#33;
   |PARA nCont = 2; |SI nCont [ 31; |HACIENDO nCont = nCont + 1;
      nCalc = nCont - 1;
      IaDatosCon = aDatosCon1<-; IaDatosCon = IaDatosCon + nCalc;
      #dsmow315#nCont# = aDatosCon;
      |C_V #dsmow315#nCont#, 0, aAlfa;
      |SI aAlfa = "S"; |PINTA #dsmow315#nCont#; |FINSI;
   |SIGUE;
   |HAZ AntesDeNada;

   #rpaises@#0 = #dsmow315#30;
   |LEE 000#rpaises@.=;
   |SI FSalida = 0; #dsmow315#31 = #rpaises@#1; |PINTA #dsmow315#31; |FINSI;

   |SI #dsmow315#0 ] 0; aAlfa = "|C001WID"; |SINO; aAlfa = "|C004WID"; |FINSI;
   aAlfa = #dsmow315#aAlfa#; nCalc = aAlfa; |FOCOTECLADO nCalc;;
|FPRC;

|PROCESO BotonPago;
   #dsmow315#0 = #dsmow301#15;

   |PARA nCont = 0; |SI nCont < 100; |HACIENDO nCont = nCont + 1;
      IaDatosTit = aDatosTit1<-; IaDatosTit = IaDatosTit + nCont;
      aDatosTit = "";
      IaDatosCon = aDatosCon1<-; IaDatosCon = IaDatosCon + nCont;
      aDatosCon = "";
   |SIGUE;

   enSwTit = 1;

   |ABRE #dsm210fp;
   #dsm210fp#0 = #dsm210ln#0;
   #dsm210fp#1 = #dsm210ln#1;
   #dsm210fp#2 = #dsm210ln#2;
   #dsm210fp#3 = #dsm210ln#3;
   #dsm210fp#4 = #dsm210ln#5;
   |SI #dsmow301#15 ] 0; #dsm210fp#37 = "P"; |SINO; #dsm210fp#37 = "N"; |FINSI;
   |LEE 101#dsm210fp.=;
   |SI FSalida = 0;
      |PARA nCont = 5; |SI nCont [ 36; |HACIENDO nCont = nCont + 1;
         nCalc = nCont - 5;
         IaDatosTit = aDatosTit1<-; IaDatosTit = IaDatosTit + nCalc;
         aDatosTit = #dsm210fp#nCont#;
         IaDatosCon = aDatosCon1<-; IaDatosCon = IaDatosCon + nCalc;
         nCalc1 = nCont + 33;
         aDatosCon = #dsm210fp#nCalc1#;
      |SIGUE;

      |SI aDatosTit1 = "E";
         #dsmow315#1 = "S"; #dsmow315#33 = "N";
      |SINO;
         #dsmow315#1 = "N"; #dsmow315#33 = "S";
      |FINSI;
      |PINTA #dsmow315#1; |PINTA #dsmow315#33;
      |PARA nCont = 2; |SI nCont [ 31; |HACIENDO nCont = nCont + 1;
         nCalc = nCont - 1;
         IaDatosTit = aDatosTit1<-; IaDatosTit = IaDatosTit + nCalc;
         #dsmow315#nCont# = aDatosTit;
         |C_V #dsmow315#nCont#, 0, aAlfa;
         |SI aAlfa = "S"; |PINTA #dsmow315#nCont#; |FINSI;
      |SIGUE;
      |HAZ AntesDeNada;

      #dsmow315#32 = #dsm210fp#36;
      nModoFP = 2;
   |SINO;
      nModoFP = 1;
      |DDEFECTO #dsm210fp;
      #dsm210fp#0 = #dsm210ln#0;
      #dsm210fp#1 = #dsm210ln#1;
      #dsm210fp#2 = #dsm210ln#2;
      #dsm210fp#3 = #dsm210ln#3;
      #dsm210fp#4 = #dsm210ln#5;
      |SI #dsmow301#15 ] 0; #dsm210fp#37 = "P"; |SINO; #dsm210fp#37 = "N"; |FINSI;
      |GRABA 020#dsm210fp.b;

      |DDEFECTO #dsmow315;
      #dsmow315#0 = #dsmow301#15; |PINTA #dsmow315#0;
      |ABRE #dsm210db;
      #dsm210db#0 = #dsm210dp#0;
      |LEE 000#dsm210db.=;
      |SI FSalida ! 0; |DDEFECTO #dsm210db; |FINSI;
      |CIERRA #dsm210db;

      |SI #dsm210db#0 = #dsm210dp#0;
         #dsmow315#2 = "A"; |PINTA #dsmow315#2;
      |SINO;
         #dsmow315#2 = "E"; |PINTA #dsmow315#2;
      |FINSI;

      |HAZ AntesDeNada;
   |FINSI;

   #rpaises@#0 = #dsmow315#30;
   |LEE 000#rpaises@.=;
   |SI FSalida = 0; #dsmow315#31 = #rpaises@#1; |FINSI;

   |VENTANA 0510, 2890, -1, 17, "Forma de pago"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PINPA #0#dsmow315; nPant2 = FSalida;
   |PINDA #0#dsmow315;

   nPos1 = 0703; nPos2 = 0713;
   |CONTROL_SIMPLE nPant2, "BOTON,Titular", nPos1, nPos2, BotonTit;
   nBotonTit = FSalida; |ESTADO_CONTROL nBotonTit, "DISABLE";

   nPos1 = 0714; nPos2 = 0724;
   |CONTROL_SIMPLE nPant2, "BOTON,Conyuge", nPos1, nPos2, BotonCon;
   nBotonCon = FSalida;

   |SI nModoFP = 1;
      |ENDATOS #1#dsmow315;
   |SINO;
      |ENDATOS #2#dsmow315;
   |FINSI;
   |SI FSalida = 0;
      |SI enSwTit = 1;
         aDatosTit1 = " ";
         |SI #dsmow315#1 = "S"; aDatosTit1 = "E"; |FINSI;
         |SI #dsmow315#2 = "S"; aDatosTit1 = "X"; |FINSI;
         |PARA nCont = 2; |SI nCont [ 32; |HACIENDO nCont = nCont + 1;
            nCalc = nCont - 1;
            IaDatosTit = aDatosTit1<-; IaDatosTit = IaDatosTit + nCalc;
            aDatosTit = #dsmow315#nCont#;
         |SIGUE;
      |FINSI;
      |SI enSwTit = 2;
         aDatosCon1 = " ";
         |SI #dsmow315#1 = "S"; aDatosCon1 = "E"; |FINSI;
         |SI #dsmow315#2 = "S"; aDatosCon1 = "X"; |FINSI;
         |PARA nCont = 2; |SI nCont [ 32; |HACIENDO nCont = nCont + 1;
            nCalc = nCont - 1;
            IaDatosCon = aDatosCon1<-; IaDatosCon = IaDatosCon + nCalc;
            aDatosCon = #dsmow315#nCont#;
         |SIGUE;
      |FINSI;

      |PARA nCont = 5; |SI nCont [ 36; |HACIENDO nCont = nCont + 1;
         nCalc = nCont - 5;
         IaDatosTit = aDatosTit1<-; IaDatosTit = IaDatosTit + nCalc;
         #dsm210fp#nCont# = aDatosTit;

         nCalc1 = nCont + 33;
         IaDatosCon = aDatosCon1<-; IaDatosCon = IaDatosCon + nCalc;
         #dsm210fp#nCalc1# = aDatosCon;
      |SIGUE;

      || #dsm210fp#36 = #dsmow315#32;
      |GRABA 020#dsm210fp.a;
   |FINSI;
   |LIBERA #dsm210fp;

   |CIERRA #dsm210fp;

   |FIN_CONTROL_WINDOWS nBotonTit;
   |FIN_CONTROL_WINDOWS nBotonCon;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent1;
|FPRC;

|PROCESO BotonSalirTodo;
   |PTEC 802; |PAUSA;
   nSalFuera = 1;  |PTEC 807;
|FPRC;

|PROCESO BotonCambiaFecha;
   |LEE 101#dsm210ln.c;
   |SI FSalida = 0;
      |SALVA_FICHA #dsm210ln;

      |ENCAMPO #4#dsm210ln;
      |SI FSalida = 0;
         fFecha = #dsm210ln#4;
      |SINO;
         fFecha = "01.01.0000";
      |FINSI;

      |REPON_FICHA #dsm210ln;

      |SI fFecha > "01.01.0000";
         |BORRA 020#dsm210ln.a; |LIBERA #dsm210ln;
         #dsm210ln#4 = fFecha;
         |GRABA 020#dsm210ln.n;

         |REFRESCACONTROL nGrid1aa;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO EntraDatos210;
   aAlfa = "Modelo 210 : Contribuyente [" + (("00000" + #dsm210dp#0) % -105) + "] ";
   aAlfa = aAlfa + #dsm210dp#1; |QBF aAlfa;
   aAlfa = aAlfa + "    CIF " + #dsm210dp#2;
   |VENTANA 0501, 3399, 1, 17, aAlfa; nVent0 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent0;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |ABRE #dsm210ca;
   |ABRE #dsm210ni; |ABRE #dsm210ln;
   |ABRE #dsm210in;

   |DDEFECTO #dsmow301;
   #dsmow301#0 = #dsm210dp#0;
   #dsmow301#1 = #dsm210dp#1;
   #dsmow301#2 = #dsm210dp#2;

   |PINPA #0#dsmow301; nPant1 = FSalida;
   |PINDA #0#dsmow301;

   nNumSPant = 0; nSalFuera = 0;

   nPos1 = 1049; nPos2 = 1059;
   |CONTROL_SIMPLE nPant1, "BOTON,{{137}}&Nuevo", nPos1, nPos2, BotonNueTR;
   nBotonNueTR = FSalida;

   nPos1 = 1061; nPos2 = 1071;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}&Modificar", nPos1, nPos2, BotonModTR;
   nBotonModTR = FSalida; |ESTADO_CONTROL nBotonModTR, "DISABLE";

   nPos1 = 1073; nPos2 = 1083;
   |CONTROL_SIMPLE nPant1, "BOTON,{{199}}&Borrar", nPos1, nPos2, BotonBorTR;
   nBotonBorTR = FSalida; |ESTADO_CONTROL nBotonBorTR, "DISABLE";

   nPos1 = 1085; nPos2 = 1095;
   |CONTROL_SIMPLE nPant1, "BOTON,{{1}}Sa&Lir", nPos1, nPos2, BotonSalir;
   nBotonSalTR = FSalida;

   nPos1 = 1602; nPos2 = 1622;
   |CONTROL_SIMPLE nPant1, "BOTON,{{197}}&Gestion inmuebles", nPos1, nPos2, ManteInmue;
   nBotonGestInm = FSalida; |ESTADO_CONTROL nBotonGestInm, "DISABLE";
   |ESTADO_CONTROL nBotonGestInm, "HIDE";

   nPos1 = 1649; nPos2 = 1659;
   |CONTROL_SIMPLE nPant1, "BOTON,{{137}}N&Uevo", nPos1, nPos2, BotonNueNi;
   nBotonNueNi = FSalida; |ESTADO_CONTROL nBotonNueNi, "DISABLE";

   nPos1 = 1661; nPos2 = 1671;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}Mo&Dificar", nPos1, nPos2, BotonModNi;
   nBotonModNi = FSalida; |ESTADO_CONTROL nBotonModNi, "DISABLE";

   nPos1 = 1673; nPos2 = 1683;
   |CONTROL_SIMPLE nPant1, "BOTON,{{199}}B&Orrar", nPos1, nPos2, BotonBorNi;
   nBotonBorNi = FSalida; |ESTADO_CONTROL nBotonBorNi, "DISABLE";

   nPos1 = 1685; nPos2 = 1695;
   |CONTROL_SIMPLE nPant1, "BOTON,{{1}}Sal&Ir", nPos1, nPos2, BotonSalir;
   nBotonSalNi = FSalida; |ESTADO_CONTROL nBotonSalNi, "DISABLE";

   nPos1 = 2902; nPos2 = 2910;
   |CONTROL_SIMPLE nPant1, "BOTON,{{137}}Nu&Evo", nPos1, nPos2, BotonNueLN;
   nBotonNueLN = FSalida; |ESTADO_CONTROL nBotonNueLN, "DISABLE";

   nPos1 = 2912; nPos2 = 2921;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}Modi&Ficar", nPos1, nPos2, BotonModLN;
   nBotonModLN = FSalida; |ESTADO_CONTROL nBotonModLN, "DISABLE";

   nPos1 = 2923; nPos2 = 2930;
   |CONTROL_SIMPLE nPant1, "BOTON,{{199}}Borr&Ar", nPos1, nPos2, BotonBorLN;
   nBotonBorLN = FSalida; |ESTADO_CONTROL nBotonBorLN, "DISABLE";

   nPos1 = 2932; nPos2 = 2939;
   |CONTROL_SIMPLE nPant1, "BOTON,{{1}}Sali&R", nPos1, nPos2, BotonSalir;
   nBotonSalLN = FSalida; |ESTADO_CONTROL nBotonSalLN, "DISABLE";

   nPos1 = 3002; nPos2 = 3039;
   |CONTROL_SIMPLE nPant1, "BOTON,{{197}}Cambiar &Fecha de devengo", nPos1, nPos2, BotonCambiaFecha;
   nBotonCambFc = FSalida; |ESTADO_CONTROL nBotonCambFc, "DISABLE";

   nPos1 = 3683; nPos2 = 3698;
   |CONTROL_SIMPLE nPant1, "BOTON,{{197}}Menu &Principal", nPos1, nPos2, BotonSalirTodo;
   nBotonSalirTodo = FSalida;

   nPos1 = 3183; nPos2 = 3198;
   |CONTROL_SIMPLE nPant1, "BOTON,{{197}}For&Ma pago", nPos1, nPos2, BotonPago;
   nBotonPago = FSalida; |ESTADO_CONTROL nBotonPago, "DISABLE";

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 0502; nPos2 = 998;
   |LINEAL_SIMPLE #1#dsm210ca, nRango, nPos1, nPos2, Inf210ca, Sup210ca, EvtoGrid1;
   nGrid1 = FSalida;

   nPos1 = 1102; nPos2 = 1598;
   |LINEAL_SIMPLE #1#dsm210in, nRango, nPos1, nPos2, Inf210in, Sup210in, EvtoGrid1b;
   nGrid1b = FSalida; |ESTADO_CONTROL nGrid1b, "HIDE"; nEstadoG1b = 0;

   nPos1 = 1102; nPos2 = 1598;
   |LINEAL_SIMPLE #1#dsm210ni, nRango, nPos1, nPos2, Inf210ni, Sup210ni, EvtoGrid1a;
   nGrid1a = FSalida; nEstadoG1a = 1;

   nPos1 = 1802; nPos2 = 2839;
   |LINEAL_SIMPLE #1#dsm210ln, nRango, nPos1, nPos2, Inf210ln, Sup210ln, EvtoGrid1aa;
   nGrid1aa = FSalida;

   |PTEC 802; |PAUSA;
   |REFRESCACONTROL nGrid1;

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Sa&Lir," + nGrid1;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
      |SI nSalFuera = 1;  |SAL; |FINSI;
   |SIGUE;

   |FIN_CONTROL_WINDOWS nBotonSalirTodo;
   |FIN_CONTROL_WINDOWS nBotonPago;
   |FIN_CONTROL_WINDOWS nBotonCambFc;
   |FIN_CONTROL_WINDOWS nBotonSalLN;
   |FIN_CONTROL_WINDOWS nBotonNueLN;
   |FIN_CONTROL_WINDOWS nBotonModLN;
   |FIN_CONTROL_WINDOWS nBotonBorLN;
   |FIN_CONTROL_WINDOWS nBotonSalNi;
   |FIN_CONTROL_WINDOWS nBotonNueNi;
   |FIN_CONTROL_WINDOWS nBotonModNi;
   |FIN_CONTROL_WINDOWS nBotonBorNi;
   |FIN_CONTROL_WINDOWS nBotonSalTR;
   |FIN_CONTROL_WINDOWS nBotonNueTR;
   |FIN_CONTROL_WINDOWS nBotonModTR;
   |FIN_CONTROL_WINDOWS nBotonBorTR;

   |DESTRUYECONTROL nGrid1aa;
   |DESTRUYECONTROL nGrid1a;
   |DESTRUYECONTROL nGrid1;

   aVent4 = nVent0;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |CIERRA #dsm210ca;
   |CIERRA #dsm210ni; |CIERRA #dsm210ln;
   |CIERRA #dsm210in;

   |FINVENTANA nVent0;
|FPRC;

/***************************************************************************
*********                       FIN MODELO 210                     *********
****************************************************************************/

/***************************************************************************
*********                         MODELO 211                       *********
****************************************************************************/

|PROCESO MiraPart;
/*   Tarea 13659
   |SI #Fichero@#4 = "C";
      |C_M #Fichero@#5, 1, "S";
   |SINO;
      #Fichero@#5 = 0; |PINTA #Fichero@#5;
      |C_M #Fichero@#5, 1, "N";
   |FINSI;
*/
|FPRC;

|PROCESO MiraTipoDoc;
   |SI Campo = 10;
      |SI #dsmow312#10 = "S"; #dsmow312#32 = "N"; |PINTA #dsmow312#32; |FINSI;
   |FINSI;
   |SI Campo = 32;
      |SI #dsmow312#32 = "S"; #dsmow312#10 = "N"; |PINTA #dsmow312#10; |FINSI;
   |FINSI;
|FPRC;

|PROCESO MiraSiExisteAd;
   |SI nModo = 2; |ACABA; |FINSI;

   #dsm211la#0 = #dsm211ca#0;
   #dsm211la#1 = #dsm211ca#1;
   #dsm211la#2 = #dsmow313#0;
   |LEE 000#dsm211la.=;
   |SI FSalida = 0;
      |MENAV "    El nif del adquirente ya esta incluido en la relacion"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO MiraSiExisteTr;
   |SI nModo = 2; |ACABA; |FINSI;

   #dsm211tr#0 = #dsm211ca#0;
   #dsm211tr#1 = #dsm211ca#1;
   #dsm211tr#2 = #dsmow314#0;
   |LEE 000#dsm211tr.=;
   |SI FSalida = 0;
       |MENAV "    El nif del transmitente ya esta incluido en la relacion";
       |ERROR;
   |FINSI;
|FPRC;

|PROCESO CuentaUno;
   nCont = nCont + 1;
|FPRC;

|DEFBUCLE CuentaTr;
#dsm211tr#1;
;
#dsm211ca#0, #dsm211ca#1, "               ";
#dsm211ca#0, #dsm211ca#1, "zzzzzzzzzzzzzzz";
;
NULL, CuentaUno;
|FIN;

|DEFBUCLE CuentaAd;
#dsm211la#1;
;
#dsm211ca#0, #dsm211ca#1, "               ";
#dsm211ca#0, #dsm211ca#1, "zzzzzzzzzzzzzzz";
;
NULL, CuentaUno;
|FIN;

|PROCESO Rel66Pais211; |TIPO 66;
   #rpaises@#0 = #Fichero@#Campo#;
   |LEE 000#rpaises@.];
   |CONSULTA_CLAVE #1#rpaises@;
   |SI FSalida = 0;
      #Fichero@#Campo# = #rpaises@#0; |PINTA #Fichero@#Campo#;
      |DDEF aAlfa1; |QBF aAlfa1;
      aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#; aAlfa = aAlfa - aAlfa1;
      nCalc = Campo + 1;
      |SI aAlfa = "dsmow313"; |Y Campo = 31; nCalc = 32; |FINSI;
      |SI aAlfa = "dsmow314"; |Y Campo = 8;  nCalc = 16; |FINSI;
      |SI aAlfa = "dsmow314"; |Y Campo = 9;  nCalc = 17; |FINSI;
      |SI aAlfa = "dsmow314"; |Y Campo = 15; nCalc = 18; |FINSI;
      |SI aAlfa = "dsmow315"; |Y Campo = 31; nCalc = 32; |FINSI;
      |SI aAlfa = "dsmow339"; |Y Campo = 23; nCalc = 24; |FINSI;
      #Fichero@#nCalc# = #rpaises@#1; |PINTA #Fichero@#nCalc#;
   |FINSI;
|FPRC;

|PROCESO Tipo0wFp; |TIPO 0;
  |C_M #Fichero@#Campo#, 0, aAlfa;
  |SI aAlfa = "N"; |ACABA; |FINSI;

  aAlfa = #Fichero@#Campo#; |QBF aAlfa;
  |SI aAlfa = "";
      nCampo = Campo + 1;  |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 2;  |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 3;  |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 4;  |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 5;  |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 6;  |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 7;  |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 8;  |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 9;  |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 10; |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 11; |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 12; |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 13; |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 14; |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 15; |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 16; |C_M #Fichero@#nCampo#, 1, "S";
  |SINO;
      nCampo = Campo + 1;  |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 2;  |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 3;  |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 4;  |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 5;  |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 6;  |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 7;  |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 8;  |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 9;  |C_M #Fichero@#nCampo#, 1, "S";
      nCampo = Campo + 10; |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 11; |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 12; |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 13; |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 14; |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 15; |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
      nCampo = Campo + 16; |C_M #Fichero@#nCampo#, 1, "N"; #Fichero@#nCampo# = ""; |PINTA #Fichero@#nCampo#;
  |FINSI;
|FPRC;

|PROCESO Rel00Pais211;
   nSalida = FSalida;
   aAlfa = ""; |C_M #Fichero@#Campo#, 0, aAlfa;
   |SI aAlfa = "N"; |ACABA; |FINSI;

   #rpaises@#0 = #Fichero@#Campo#;
   |LEE 000#rpaises@.=;
   |SI FSalida = 0;
      |DDEF aAlfa1; |QBF aAlfa1;
      aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#; aAlfa = aAlfa - aAlfa1;
      nCalc = Campo + 1;
      |SI aAlfa = "dsmow314"; |Y Campo = 8;  nCalc = 16; |FINSI;
      |SI aAlfa = "dsmow314"; |Y Campo = 9;  nCalc = 17; |FINSI;
      |SI aAlfa = "dsmow314"; |Y Campo = 15; nCalc = 18; |FINSI;
      |SI aAlfa = "dsmow315"; |Y Campo = 31; nCalc = 32; |FINSI;
      |SI aAlfa = "dsmow339"; |Y Campo = 23; nCalc = 24; |FINSI;
      #Fichero@#nCalc# = #rpaises@#1; |PINTA #Fichero@#nCalc#;
   |SINO;
      |MENAV "    Pais inexistente"; |ERROR;
   |FINSI;
   FSalida = nSalida;
|FPRC;

|PROCESO EvtoGrid211tr;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsm211tr.=;

      |ESTADO_CONTROL nModifTrn, "ENABLE";
      |ESTADO_CONTROL nBorraTrn, "ENABLE";

      |DDEFECTO #dsmow314;
      |PARA nCont = 2; |SI nCont [ 17; |HACIENDO nCont = nCont + 1;
         nCalc = nCont - 2;
         #dsmow314#nCalc# = #dsm211tr#nCont#; |PINTA #dsmow314#nCalc#;
      |SIGUE;

      #rpaises@#0 = #dsmow314#8;
      |LEE 000#rpaises@.=;
      |SI FSalida = 0; #dsmow314#16 = #rpaises@#1; |PINTA #dsmow314#16; |FINSI;

      #rpaises@#0 = #dsmow314#9;
      |LEE 000#rpaises@.=;
      |SI FSalida = 0; #dsmow314#17 = #rpaises@#1; |PINTA #dsmow314#17; |FINSI;

      #rpaises@#0 = #dsmow314#15;
      |LEE 000#rpaises@.=;
      |SI FSalida = 0; #dsmow314#18 = #rpaises@#1; |PINTA #dsmow314#18; |FINSI;

   |FINSI;
|FPRC;

|PROCESO Sup211tr;
   #dsm211tr#0 = #dsm211ca#0;
   #dsm211tr#1 = #dsm211ca#1;
   #dsm211tr#2 = "zzzzzzzzzzzzzzz";
|FPRC;

|PROCESO Inf211tr;
   #dsm211tr#0 = #dsm211ca#0;
   #dsm211tr#1 = #dsm211ca#1;
   #dsm211tr#2 = "               ";
|FPRC;

|PROCESO ActivaBotonesTrn;
   InNivel = nNivel1<-;
   nNivel1 = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalirA = nNivel2;

   #dsm211la#0 = #dsm211ca#0;
   #dsm211la#1 = #dsm211ca#1;
   #dsm211la#2 = "";
   |LEE 000#dsm211la.];
   |SI FSalida = 0; |Y #dsm211la#0 = #dsm211ca#0; |Y #dsm211la#1 = #dsm211ca#1;
      |ESTADO_CONTROL nBorraTrn, "ENABLE";
      |ESTADO_CONTROL nModifTrn, "ENABLE";
   |FINSI;
   |ESTADO_CONTROL nGrid2, "ENABLE";
   |ESTADO_CONTROL nNuevoTrn, "ENABLE";
   |ESTADO_CONTROL nIdSalirA, "SHOW";
|FPRC;

|PROCESO DesactivaBotonesTrn;
   InNivel = nNivel1<-;
   nNivel1 = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalirA = nNivel2;

   |ESTADO_CONTROL nNuevoTrn, "DISABLE";
   |ESTADO_CONTROL nModifTrn, "DISABLE";
   |ESTADO_CONTROL nBorraTrn, "DISABLE";
   |ESTADO_CONTROL nGrid2, "DISABLE";
   |ESTADO_CONTROL nIdSalirA, "HIDE";
|FPRC;

|PROCESO NuevoTrn;
   Cmp = -1;
   nModo = 1;
   |HAZ DesactivaBotonesTrn;

   |DDEFECTO #dsmow314;
   |PARA nCont = 0; |SI nCont [ 18; |HACIENDO nCont = nCont + 1;
      |PINTA #dsmow314#nCont#;
   |SIGUE;

   |C_M #dsmow314#0, 1, "S";
   |ENDATOS #1#dsmow314;
   |SI FSalida = 0;

      |DDEFECTO #dsm211tr;
      #dsm211tr#0 = #dsm211ca#0;
      #dsm211tr#1 = #dsm211ca#1;
      |PARA nCont = 2; |SI nCont [ 17; |HACIENDO nCont = nCont + 1;
         nCalc = nCont - 2;
         #dsm211tr#nCont# = #dsmow314#nCalc#;
      |SIGUE;
      |GRABA 020#dsm211tr.c;

      #dsm211tr#0 = #dsm211ca#0;
      #dsm211tr#1 = #dsm211ca#1;
      aAlfa = #dsm211ca#57; |QBF aAlfa;
      |SI aAlfa = "";
         #dsm211ca#57 = #dsm211tr#2;
         #dsm211ca#58 = #dsm211tr#3;
         #dsm211ca#59 = #dsm211tr#4;
         |GRABA 020#dsm211ca.a;
      |FINSI;

      |REFRESCACONTROL nGrid2;

      #dsm211tr#0 = #dsm211ca#0;
      #dsm211tr#1 = #dsm211ca#1;
      #dsm211tr#2 = "";
      |LEE 000#dsm211tr.];
      |SI FSalida = 0; |Y #dsm211tr#0 = #dsm211ca#0; |Y #dsm211tr#1 = #dsm211ca#1;
         #dsmow312#13 = #dsm211tr#2; |PINTA #dsmow312#13;
         #dsmow312#14 = #dsm211tr#3; |PINTA #dsmow312#14;
         #dsmow312#15 = #dsm211tr#4; |PINTA #dsmow312#15;

         #dsm211ca#57 = #dsm211tr#2;
         #dsm211ca#58 = #dsm211tr#3;
         #dsm211ca#59 = #dsm211tr#4;
         |GRABA 020#dsm211ca.a;
      |FINSI;
   |FINSI;

   |HAZ ActivaBotonesTrn;
|FPRC;

|PROCESO ModifTrn;

   nModo = 2;
   |LEE 101#dsm211tr.=;

   |HAZ DesactivaBotonesTrn;

   |PARA nCont = 2; |SI nCont [ 17; |HACIENDO nCont = nCont + 1;
      nCalc = nCont - 2;
      #dsmow314#nCalc# = #dsm211tr#nCont#; |PINTA #dsmow314#nCalc#;
   |SIGUE;

   #rpaises@#0 = #dsmow314#8;
   |LEE 000#rpaises@.=;
   |SI FSalida = 0; #dsmow314#16 = #rpaises@#1; |PINTA #dsmow314#16; |FINSI;

   #rpaises@#0 = #dsmow314#9;
   |LEE 000#rpaises@.=;
   |SI FSalida = 0; #dsmow314#17 = #rpaises@#1; |PINTA #dsmow314#17; |FINSI;

   #rpaises@#0 = #dsmow314#15;
   |LEE 000#rpaises@.=;
   |SI FSalida = 0; #dsmow314#18 = #rpaises@#1; |PINTA #dsmow314#18; |FINSI;

   |C_M #dsmow314#0, 1, "N";

   |ENDATOS #1#dsmow314;
   |SI FSalida = 0;
      |DDEFECTO #dsm211tr;
      #dsm211tr#0 = #dsm211ca#0;
      #dsm211tr#1 = #dsm211ca#1;
      |PARA nCont = 2; |SI nCont [ 17; |HACIENDO nCont = nCont + 1;
         nCalc = nCont - 2;
         #dsm211tr#nCont# = #dsmow314#nCalc#;
      |SIGUE;
      |GRABA 020#dsm211tr.a; |LIBERA #dsm211tr;

      |REFRESCACONTROL nGrid2;

      #dsm211tr#0 = #dsm211ca#0;
      #dsm211tr#1 = #dsm211ca#1;
      #dsm211tr#2 = "";
      |LEE 000#dsm211tr.];
      |SI FSalida = 0; |Y #dsm211tr#0 = #dsm211ca#0; |Y #dsm211tr#1 = #dsm211ca#1;
         #dsmow312#13 = #dsm211tr#2; |PINTA #dsmow312#13;
         #dsmow312#14 = #dsm211tr#3; |PINTA #dsmow312#14;
         #dsmow312#15 = #dsm211tr#4; |PINTA #dsmow312#15;

         #dsm211ca#57 = #dsm211tr#2;
         #dsm211ca#58 = #dsm211tr#3;
         #dsm211ca#59 = #dsm211tr#4;
         |GRABA 020#dsm211ca.a;
      |FINSI;
   |SINO;
      |LIBERA #dsm211tr;
   |FINSI;

   |HAZ ActivaBotonesTrn;
|FPRC;

|PROCESO BorraTrn;
   |HAZ DesactivaBotonesTrn;
   aAlfa = "    N " + &191 + " Esta seguro de eliminar el registro del transmitente seleccionado ?";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |BORRA 020#dsm211tr.a; aNifAnt = #dsm211tr#2;

      |DDEFECTO #dsm211tr;
      #dsm211tr#0 = #dsm211ca#0;
      #dsm211tr#1 = #dsm211ca#1;
      #dsm211tr#2 = "";
      |LEE 000#dsm211tr.];
      |SI FSalida ! 0; |O #dsm211tr#0 ! #dsm211ca#0; |O #dsm211tr#1 ! #dsm211ca#1;
          |DDEFECTO #dsm211tr;
      |FINSI;

      || Compruebo si el registro que acabo de borrar es el que hay apuntado
      ||    en la cabecera del modelo. Si es asi, actualizo la cabecera
      |SI aNifAnt = #dsm211ca#57;
         #dsm211ca#57 = #dsm211tr#2;
         #dsm211ca#58 = #dsm211tr#3;
         #dsm211ca#59 = #dsm211tr#4;
         |GRABA 020#dsm211ca.a;
      |FINSI;

      |REFRESCACONTROL nGrid2;
   |FINSI;
   |HAZ ActivaBotonesTrn;
|FPRC;

|PROCESO RelTrans;
   InNivel = nNivel1<-;
   nNivel1 = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;

   |ESTADO_CONTROL nRelAdqui, "DISABLE";
   |ESTADO_CONTROL nRelTrans, "DISABLE";
   |ESTADO_CONTROL nDatRepre, "DISABLE";

   |VENTANA 0810, 2889, 1, 17, "Relacion Transmitentes modelo 211"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   InNivel = nNivel1<-;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;

   |DDEFECTO #dsmow314;
   |PINPA #0#dsmow314; nPant1 = FSalida;
   |PINDA #0#dsmow314;

   nPos1 = 1245; nPos2 = 1255;
   |CONTROL_SIMPLE nPant1, "BOTON,{{137}}&Nuevo", nPos1, nPos2, NuevoTrn;
   nNuevoTrn = FSalida;

   nPos1 = 1257; nPos2 = 1267;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}&Modificar", nPos1, nPos2, ModifTrn;
   nModifTrn = FSalida; |ESTADO_CONTROL nModifTrn, "DISABLE";

   nPos1 = 1269; nPos2 = 1279;
   |CONTROL_SIMPLE nPant1, "BOTON,{{199}}&Borra", nPos1, nPos2, BorraTrn;
   nBorraTrn = FSalida; |ESTADO_CONTROL nBorraTrn, "DISABLE";

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 0602; nPos2 = 1179;
   |LINEAL_SIMPLE #1#dsm211tr, nRango, nPos1, nPos2, Inf211tr, Sup211tr, EvtoGrid211tr;
   nGrid2 = FSalida;
   |PULSATECLA;

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Sa&Lir," + nGrid2;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
   |SIGUE;

   |FIN_CONTROL_WINDOWS nBorraAdq;
   |FIN_CONTROL_WINDOWS nModifAdq;
   |FIN_CONTROL_WINDOWS nNuevoAdq;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent1;

   |ESTADO_CONTROL nRelTrans, "ENABLE";
   |ESTADO_CONTROL nRelAdqui, "ENABLE";
   |ESTADO_CONTROL nDatRepre, "ENABLE";

   nCont = 0; |BUCLE CuentaTr; #dsmow312#16 = nCont;
   |PINTA #dsmow312#16;

   |REFRESCACONTROL nGrid1;
|FPRC;

|PROCESO InfPobAdq211;
   #repobla@#0 = #dsmow313#nCalc#;
   #repobla@#1 = 1;
|FPRC;

|PROCESO SupPobAdq211;
   #repobla@#0 = #dsmow313#nCalc#;
   #repobla@#1 = 999;
|FPRC;

|PROCESO Adq66CP1; |TIPO 66;
   #reprovi@#0 = #dsmow313#Campo#;
   |LEE 000#rpaises@.];
   |CONSULTA_CLAVE #1#reprovi@;
   |SI FSalida = 0;
      #dsmow313#Campo# = #reprovi@#0; |PINTA #dsmow313#Campo#;
      nCalc = Campo + 3;
      #dsmow313#nCalc# = #reprovi@#1; |PINTA #dsmow313#nCalc#;
   |FINSI;
|FPRC;

|PROCESO Adq00CP1;
   #reprovi@#0 = #dsmow313#Campo#;
   |LEE 000#reprovi@.=;
   |SI FSalida = 0;
      nCalc = Campo + 3;
      #dsmow313#nCalc# = #reprovi@#1; |PINTA #dsmow313#nCalc#;
   |SINO;
      |SI #dsmow313#nCalc# ! 0;
         |MENAV "    Provincia inexistente"; |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Adq66CP2; |TIPO 66;
   nCalc = Campo - 1;
   #repobla@#0 = #dsmow313#nCalc#;
   #repobla@#1 = #dsmow313#Campo#;
   |LEE 000#repobla@.];
   |CONSULTA_F_CLAVE #1#repobla@, InfPobAdq211, SupPobAdq211;
   |SI FSalida = 0;
      #dsmow313#Campo# = #repobla@#1; |PINTA #dsmow313#Campo#;
      nCalc = Campo + 1;
      |SI enSwCod = 1;
         #dsmow313#nCalc# = #repobla@#3; |PINTA #dsmow313#nCalc#;
      |FINSI;
      |SI enSwCod = 2;
         #dsmow313#nCalc# = #repobla@#2; |PINTA #dsmow313#nCalc#;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Adq00CP2;
   nCalc = Campo - 1;
   #repobla@#0 = #dsmow313#nCalc#;
   #repobla@#1 = #dsmow313#Campo#;
   |LEE 000#repobla@.=;
   |SI FSalida = 0;
      nCalc = Campo + 1;
      |SI enSwCod = 1;
         #dsmow313#nCalc# = #repobla@#3; |PINTA #dsmow313#nCalc#;
      |FINSI;
      |SI enSwCod = 2;
         #dsmow313#nCalc# = #repobla@#2; |PINTA #dsmow313#nCalc#;
      |FINSI;
   |SINO;
      nCalc = Campo + 1;
      |SI #dsmow313#nCalc# ! 0;
         |MENAV "    Poblacion inexistente"; |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Rel66INE; |TIPO 66;
   nCalc = Campo + 1;
   #rmunici@#0 = #Fichero@#nCalc#;

   |DDEF aAlfa1; |QBF aAlfa1;
   aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#; aNomDef = aAlfa - aAlfa1;
   |SI aNomDef = "dsmow329"; |Y Campo = 16;
      aAlfa = (("00" + #Fichero@#14) % -102) + (("000" + #Fichero@#15) % -103);
      #rmunici@#0 = aAlfa;
   |FINSI;
   |SI aNomDef = "dsmow300";
      |SI Campo = 65;
         aAlfa = (("00" + #Fichero@#57) % -102) + (("000" + #Fichero@#58) % -103);
         #rmunici@#0 = aAlfa;
      |FINSI;
   |FINSI;

   #rmunici@#1 = #Fichero@#Campo#;
   |LEE 000#rmunici@.];
   |CONSULTA_CLAVE #1#rmunici@;
   |SI FSalida = 0;
      #Fichero@#Campo# = #rmunici@#1; |PINTA #Fichero@#Campo#;
      nCalc = Campo + 1;
      #Fichero@#nCalc# = #rmunici@#0;
   |FINSI;
|FPRC;

|PROCESO Rel00INE;
   |SI FSalida = 2; |ACABA; |FINSI;
   |DDEF aAlfa1; |QBF aAlfa1;
   aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#; aNomDef = aAlfa - aAlfa1;
   aAlfa = #Fichero@#Campo#; |QBF aAlfa;
   |SI aNomDef = "dsmow330"; |O aNomDef = "dsmow313"; |O aNomDef = "dsmow300";
      |SI aAlfa = ""; |O aAlfa = "00000"; |ACABA; |FINSI;
   |FINSI;

   nCalc = Campo + 1;
   #rmunici@#0 = #Fichero@#nCalc#;
   |SI aNomDef = "dsmow329";
      aAlfa = (("00" + #Fichero@#14) % -102) + (("000" + #Fichero@#15) % -103);
      #rmunici@#0 = aAlfa;
   |FINSI;
   aAlfa1 = (("00000" + #Fichero@#Campo#) % -105);
   #rmunici@#1 = aAlfa1;
   |LEE 000#rmunici@.=;
   |SI FSalida ! 0;
      |MENAV "    Codigo INE inexistente"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO EvtoGrid211la;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsm211la.=;

      |ESTADO_CONTROL nModifAdq, "ENABLE";
      |ESTADO_CONTROL nBorraAdq, "ENABLE";

      |DDEFECTO #dsmow313;
      |PARA nCont = 2; |SI nCont [ 33; |HACIENDO nCont = nCont + 1;
         nCalc = nCont - 2;
         #dsmow313#nCalc# = #dsm211la#nCont#; |PINTA #dsmow313#nCalc#;
      |SIGUE;
      #dsmow313#33 = #dsm211la#34; |PINTA #dsmow313#33;
      #dsmow313#34 = #dsm211la#35; |PINTA #dsmow313#34;
      #dsmow313#35 = #dsm211la#36; |PINTA #dsmow313#35;
      #dsmow313#36 = #dsm211la#37; |PINTA #dsmow313#36;
   |FINSI;
|FPRC;

|PROCESO Sup211la;
   #dsm211la#0 = #dsm211ca#0;
   #dsm211la#1 = #dsm211ca#1;
   #dsm211la#2 = "zzzzzzzzzzzzzzz";
|FPRC;

|PROCESO Inf211la;
   #dsm211la#0 = #dsm211ca#0;
   #dsm211la#1 = #dsm211ca#1;
   #dsm211la#2 = "               ";
|FPRC;

|PROCESO ActivaBotonesAdq;
   InNivel = nNivel1<-;
   nNivel1 = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalirA = nNivel2;

   #dsm211la#0 = #dsm211ca#0;
   #dsm211la#1 = #dsm211ca#1;
   #dsm211la#2 = "";
   |LEE 000#dsm211la.];
   |SI FSalida = 0; |Y #dsm211la#0 = #dsm211ca#0; |Y #dsm211la#1 = #dsm211ca#1;
      |ESTADO_CONTROL nBorraAdq, "ENABLE";
      |ESTADO_CONTROL nModifAdq, "ENABLE";
   |FINSI;
   |ESTADO_CONTROL nGrid2, "ENABLE";
   |ESTADO_CONTROL nNuevoAdq, "ENABLE";
   |ESTADO_CONTROL nIdSalirA, "SHOW";
|FPRC;

|PROCESO DesactivaBotonesAdq;
   InNivel = nNivel1<-;
   nNivel1 = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalirA = nNivel2;

   |ESTADO_CONTROL nNuevoAdq, "DISABLE";
   |ESTADO_CONTROL nModifAdq, "DISABLE";
   |ESTADO_CONTROL nBorraAdq, "DISABLE";
   |ESTADO_CONTROL nGrid2, "DISABLE";
   |ESTADO_CONTROL nIdSalirA, "HIDE";
|FPRC;

|PROCESO NuevoAdq;
   Cmp = -1;
   nModo = 1;
   |HAZ DesactivaBotonesAdq;

   |DDEFECTO #dsmow313;
   |PARA nCont = 0; |SI nCont [ 35; |HACIENDO nCont = nCont + 1;
      |PINTA #dsmow313#nCont#;
   |SIGUE;
   |C_M #dsmow313#0, 1, "S";

   |ENDATOS #1#dsmow313;
   |SI FSalida = 0;
      |DDEFECTO #dsm211la;
      #dsm211la#0 = #dsm211ca#0;
      #dsm211la#1 = #dsm211ca#1;
      |PARA nCont = 2; |SI nCont [ 33; |HACIENDO nCont = nCont + 1;
         nCalc = nCont - 2;
         #dsm211la#nCont# = #dsmow313#nCalc#;
      |SIGUE;
      #dsm211la#34 = #dsmow313#33;
      #dsm211la#35 = #dsmow313#34;
      #dsm211la#36 = #dsmow313#35;
      |GRABA 020#dsm211la.c;

      |SALVA_FICHA #dsm211la;
      #dsm211la#0 = #dsm211ca#0;
      #dsm211la#1 = #dsm211ca#1;
      #dsm211la#2 = "";
      |LEE 000#dsm211la.];
      |SI FSalida = 0; |Y #dsm211la#0 = #dsm211ca#0; |Y #dsm211la#1 = #dsm211ca#1;
         #dsmow312#0 = #dsm211la#2; |PINTA #dsmow312#0;
         #dsmow312#1 = #dsm211la#5; |PINTA #dsmow312#1;
         #dsmow312#2 = #dsm211la#3; |PINTA #dsmow312#2;
         #dsmow312#3 = #dsm211la#4; |PINTA #dsmow312#3;

         #dsm211ca#4 = #dsm211la#2;
         #dsm211ca#5 = #dsm211la#3;
         #dsm211ca#6 = #dsm211la#4;
         #dsm211ca#7 = #dsm211la#5;
         |GRABA 020#dsm211ca.a;
      |FINSI;
      |REPON_FICHA #dsm211la;

      |PULSATECLA;
      |REFRESCACONTROL nGrid2;

   |FINSI;

   |HAZ ActivaBotonesAdq;
|FPRC;

|PROCESO ModifAdq;
   nModo = 2;
   |LEE 101#dsm211la.=;

   |HAZ DesactivaBotonesAdq;

   |PARA nCont = 2; |SI nCont [ 33; |HACIENDO nCont = nCont + 1;
      nCalc = nCont - 2;
      #dsmow313#nCalc# = #dsm211la#nCont#; |PINTA #dsmow313#nCalc#;
   |SIGUE;
   |C_M #dsmow313#0, 1, "N";

   #dsmow313#33 = #dsm211la#34; |PINTA #dsmow313#33;
   #dsmow313#34 = #dsm211la#35; |PINTA #dsmow313#34;
   #dsmow313#35 = #dsm211la#36; |PINTA #dsmow313#35;
   #dsmow313#36 = #dsm211la#37; |PINTA #dsmow313#36;
   #dsmow313#37 = (("00" + #dsmow313#18) % -102) + (("000" + #dsmow313#19) % -103);

   |ENDATOS #1#dsmow313;
   |SI FSalida = 0;
      |PARA nCont = 2; |SI nCont [ 33; |HACIENDO nCont = nCont + 1;
         nCalc = nCont - 2;
         #dsm211la#nCont# = #dsmow313#nCalc#;
      |SIGUE;
      #dsm211la#34 = #dsmow313#33;
      #dsm211la#35 = #dsmow313#34;
      #dsm211la#36 = #dsmow313#35;
      #dsm211la#37 = #dsmow313#36;
      |GRABA 020#dsm211la.a;

      |REFRESCACONTROL nGrid2;

      #dsm211la#0 = #dsm211ca#0;
      #dsm211la#1 = #dsm211ca#1;
      #dsm211la#2 = "";
      |LEE 000#dsm211la.];
      |SI FSalida = 0; |Y #dsm211la#0 = #dsm211ca#0; |Y #dsm211la#1 = #dsm211ca#1;
         #dsmow312#0 = #dsm211la#2; |PINTA #dsmow312#0;
         #dsmow312#1 = #dsm211la#5; |PINTA #dsmow312#1;
         #dsmow312#2 = #dsm211la#3; |PINTA #dsmow312#2;
         #dsmow312#3 = #dsm211la#4; |PINTA #dsmow312#3;

         #dsm211ca#4 = #dsm211la#2;
         #dsm211ca#5 = #dsm211la#3;
         #dsm211ca#6 = #dsm211la#4;
         #dsm211ca#7 = #dsm211la#5;
         |GRABA 020#dsm211ca.a;
      |FINSI;
   |FINSI;
   |LIBERA #dsm211la;

   |HAZ ActivaBotonesAdq;
|FPRC;

|PROCESO BorraAdq;
   |HAZ DesactivaBotonesAdq;
   aAlfa = "    N " + &191 + " Esta seguro de eliminar el registro del adquirente seleccionado ?";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |BORRA 020#dsm211la.a; aNifAnt = #dsm211la#2;

      #dsm211la#0 = #dsm211ca#0;
      #dsm211la#1 = #dsm211ca#1;
      #dsm211la#2 = "";
      |LEE 000#dsm211la.];
      |SI FSalida ! 0; |DDEFECTO #dsm211la; |FINSI;

      || Compruebo si el registro que acabo de borrar es el que hay apuntado
      ||    en la cabecera del modelo. Si es asi, actualizo la cabecera
      |SI aNifAnt = #dsm211ca#4;
         #dsm211ca#4 = #dsm211la#2;
         #dsm211ca#5 = #dsm211la#3;
         #dsm211ca#6 = #dsm211la#4;
         #dsm211ca#7 = #dsm211la#5;
         |GRABA 020#dsm211ca.a;
      |FINSI;

      |REFRESCACONTROL nGrid2;
   |FINSI;
   |HAZ ActivaBotonesAdq;
|FPRC;

|PROCESO RelAdqui;
   InNivel = nNivel1<-;
   nNivel1 = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;

   |ESTADO_CONTROL nDatRepre, "DISABLE";
   |ESTADO_CONTROL nRelAdqui, "DISABLE";
   |ESTADO_CONTROL nRelTrans, "DISABLE";

   |VENTANA 0510, 3189, 1, 17, "Relacion adquirientes modelo 211"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   InNivel = nNivel1<-;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;

   |DDEFECTO #dsmow313;
   |PINPA #0#dsmow313; nPant1 = FSalida;
   |PINDA #0#dsmow313;

   nPos1 = 1245; nPos2 = 1255;
   |CONTROL_SIMPLE nPant1, "BOTON,{{137}}&Nuevo", nPos1, nPos2, NuevoAdq;
   nNuevoAdq = FSalida;

   nPos1 = 1257; nPos2 = 1267;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}&Modificar", nPos1, nPos2, ModifAdq;
   nModifAdq = FSalida; |ESTADO_CONTROL nModifAdq, "DISABLE";

   nPos1 = 1269; nPos2 = 1279;
   |CONTROL_SIMPLE nPant1, "BOTON,{{199}}&Borra", nPos1, nPos2, BorraAdq;
   nBorraAdq = FSalida; |ESTADO_CONTROL nBorraAdq, "DISABLE";

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 0602; nPos2 = 1179;
   |LINEAL_SIMPLE #1#dsm211la, nRango, nPos1, nPos2, Inf211la, Sup211la, EvtoGrid211la;
   nGrid2 = FSalida;
   |PULSATECLA;

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Sa&Lir," + nGrid2;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
   |SIGUE;

   |FIN_CONTROL_WINDOWS nBorraAdq;
   |FIN_CONTROL_WINDOWS nModifAdq;
   |FIN_CONTROL_WINDOWS nNuevoAdq;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent1;

   |ESTADO_CONTROL nRelTrans, "ENABLE";
   |ESTADO_CONTROL nRelAdqui, "ENABLE";
   |ESTADO_CONTROL nDatRepre, "ENABLE";

   nCont = 0; |BUCLE CuentaAd; #dsmow312#4 = nCont;
   |PINTA #dsmow312#4;

   |REFRESCACONTROL nGrid1;
|FPRC;

|PROCESO EvtoGrid211a;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 101#dsm211ca.=;
      |SI FSalida = 0;
         nCont = 0; |BUCLE CuentaAd; #dsm211ca#54 = nCont;
         nCont = 0; |BUCLE CuentaTr; #dsm211ca#55 = nCont;
         |GRABA 020#dsm211ca.a;
         |LIBERA #dsm211ca;
      |FINSI;

      |SI nModo = 0;
         |ESTADO_CONTROL nModInm211, "ENABLE";
         |ESTADO_CONTROL nBorInm211, "ENABLE";
      |FINSI;

      #dsmow312#0  = #dsm211ca#4;  |PINTA #dsmow312#0;
      #dsmow312#1  = #dsm211ca#7;  |PINTA #dsmow312#1;
      #dsmow312#2  = #dsm211ca#5;  |PINTA #dsmow312#2;
      #dsmow312#3  = #dsm211ca#6;  |PINTA #dsmow312#3;
      #dsmow312#4  = #dsm211ca#54; |PINTA #dsmow312#4;
      #dsmow312#5  = #dsm211ca#23; |PINTA #dsmow312#5;
      #dsmow312#6  = #dsm211ca#25; |PINTA #dsmow312#6;
      #dsmow312#7  = #dsm211ca#24; |PINTA #dsmow312#7;
      #dsmow312#8  = #dsm211ca#2;  |PINTA #dsmow312#8;
      #dsmow312#9  = #dsm211ca#56; |PINTA #dsmow312#9;
      |SI #dsm211ca#44 = "P"; #dsmow312#10 = "S"; |SINO; #dsmow312#10 = "N"; |FINSI;
      |PINTA #dsmow312#10;
      #dsmow312#11 = #dsm211ca#45; |PINTA #dsmow312#11;
      #dsmow312#12 = #dsm211ca#46; |PINTA #dsmow312#12;
      #dsmow312#13 = #dsm211ca#57; |PINTA #dsmow312#13;
      #dsmow312#14 = #dsm211ca#58; |PINTA #dsmow312#14;
      #dsmow312#15 = #dsm211ca#59; |PINTA #dsmow312#15;
      #dsmow312#16 = #dsm211ca#55; |PINTA #dsmow312#16;
      #dsmow312#17 = #dsm211ca#47; |PINTA #dsmow312#17;
      #dsmow312#18 = #dsm211ca#48; |PINTA #dsmow312#18;
      #dsmow312#19 = #dsm211ca#49; |PINTA #dsmow312#19;
      #dsmow312#20 = #dsm211ca#50; |PINTA #dsmow312#20;
      #dsmow312#21 = #dsm211ca#51; |PINTA #dsmow312#21;
      #dsmow312#22 = #dsm211ca#52; |PINTA #dsmow312#22;
      #dsmow312#23 = #dsm211ca#53; |PINTA #dsmow312#23;
      #dsmow312#24 = #dsm211ca#60; |PINTA #dsmow312#24;
      #dsmow312#25 = #dsm211ca#61; |PINTA #dsmow312#25;
      #dsmow312#26 = #dsm211ca#62; |PINTA #dsmow312#26;
      #dsmow312#27 = #dsm211ca#63; |PINTA #dsmow312#27;
      #dsmow312#28 = #dsm211ca#64; |PINTA #dsmow312#28;
      #dsmow312#29 = #dsm211ca#65; |PINTA #dsmow312#29;
      #dsmow312#30 = #dsm211ca#66; |PINTA #dsmow312#30;
      #dsmow312#31 = #dsm211ca#67; |PINTA #dsmow312#31;
      |SI #dsm211ca#44 = "R"; #dsmow312#32 = "S"; |SINO; #dsmow312#32 = "N"; |FINSI;
      |PINTA #dsmow312#32;
      #dsmow312#33 = #dsm211ca#3;  |PINTA #dsmow312#33;
   |FINSI;
|FPRC;

|PROCESO BorraAdqui;
   |BORRA 020#dsm211la.a;
|FPRC;

|DEFBUCLE BorraAdqui;
#dsm211la#1;
;
#dsm211ca#0, #dsm211ca#1, "               ";
#dsm211ca#0, #dsm211ca#1, "zzzzzzzzzzzzzzz";
be;
NULL, BorraAdqui;
|FIN;

|PROCESO BorraTrans;
   |BORRA 020#dsm211tr.a;
|FPRC;

|DEFBUCLE BorraTrans;
#dsm211tr#1;
;
#dsm211ca#0, #dsm211ca#1, "               ";
#dsm211ca#0, #dsm211ca#1, "zzzzzzzzzzzzzzz";
be;
NULL, BorraTrans;
|FIN;

|PROCESO NueInm211;
   Cmp = -1;
   nModo = 1;
   |VENTANA 1210, 1990, 1, 17, "Nuevo inmueble"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   InNivel = nNivel1<-;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;

   |DDEFECTO #dsmow306; |DDEFECTO #dsmow312;
   |PINPA #0#dsmow306; nPant1 = FSalida;
   |PINDA #0#dsmow306;

   |ESTADO_CONTROL nNueInm211, "DISABLE";
   |ESTADO_CONTROL nModInm211, "DISABLE";
   |ESTADO_CONTROL nBorInm211, "DISABLE";
   |ESTADO_CONTROL nGrid1, "DISABLE";
   |ESTADO_CONTROL nRelAdqui, "ENABLE";
   |ESTADO_CONTROL nRelTrans, "ENABLE";
   |ESTADO_CONTROL nDatRepre, "ENABLE";
   |ESTADO_CONTROL nIdSalir, "HIDE";

   |ABRE #dsminmex;

|ET OtroInm;
   |ENDATOS #1#dsmow306;
   |SI FSalida = 0;
      #dsm211ca#0  = #dsm210dp#0;
      #dsm211ca#1  = #dsmow306#0;
      |LEE 000#dsm211ca.=;
      |SI FSalida = 0;
         |MENAV "    El modelo 211 de ese inmueble ya existe";
         |VETE OtroInm;
      |FINSI;

      |DDEFECTO #dsm211ca;
      ||ABRE #dsminmex;
      #dsminmex#0 = #dsm210dp#0;
      #dsminmex#1 = #dsmow306#0;
      |LEE 000#dsminmex.=;
      |SI FSalida = 0;
         #dsm211ca#8  = #dsminmex#3;
         #dsm211ca#9  = #dsminmex#4;
         #dsm211ca#10 = #dsminmex#5;
         #dsm211ca#11 = #dsminmex#6;
         #dsm211ca#12 = #dsminmex#7;
         #dsm211ca#13 = #dsminmex#8;
         #dsm211ca#14 = #dsminmex#9;
         #dsm211ca#15 = #dsminmex#10;
         #dsm211ca#16 = #dsminmex#11;
         #dsm211ca#17 = #dsminmex#12;
         #dsm211ca#18 = #dsminmex#13;
         #dsm211ca#19 = #dsminmex#14;
         #dsm211ca#20 = #dsminmex#15;
         #dsm211ca#21 = #dsminmex#16;
         #dsm211ca#22 = #dsminmex#17;
         #dsm211ca#47 = #dsminmex#30;
      |FINSI;
      ||CIERRA #dsminmex;

      #dsm211ca#0  = #dsm210dp#0;
      #dsm211ca#1  = #dsmow306#0;
      #dsm211ca#2  = #dsmow306#1;
      #dsm211ca#56 = #dsmow306#2;
      |GRABA 020#dsm211ca.b;

      |REFRESCACONTROL nGrid1;
      |PULSATECLA;

      #dsmow312#8  = #dsm211ca#2;  |PINTA #dsmow312#8;
      #dsmow312#9  = #dsm211ca#56; |PINTA #dsmow312#9;
      #dsmow312#17 = #dsm211ca#47; |PINTA #dsmow312#17;

      |CIERRA #dsminmex;

      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1;

      |ENDATOS #1#dsmow312;
      |SI FSalida = 0;
         #dsm211ca#3  = #dsmow312#33;
         #dsm211ca#4  = #dsmow312#0;
         #dsm211ca#7  = #dsmow312#1;
         #dsm211ca#5  = #dsmow312#2;
         #dsm211ca#6  = #dsmow312#3;
         #dsm211ca#54 = #dsmow312#4;
         #dsm211ca#23 = #dsmow312#5;
         #dsm211ca#25 = #dsmow312#6;
         #dsm211ca#24 = #dsmow312#7;
         #dsm211ca#2  = #dsmow312#8;
         #dsm211ca#56 = #dsmow312#9;
         |SI #dsmow312#10 = "S"; #dsm211ca#44 = "P"; |FINSI;
         #dsm211ca#45 = #dsmow312#11;
         #dsm211ca#46 = #dsmow312#12;
         #dsm211ca#57 = #dsmow312#13;
         #dsm211ca#58 = #dsmow312#14;
         #dsm211ca#59 = #dsmow312#15;
         #dsm211ca#55 = #dsmow312#16;
         #dsm211ca#47 = #dsmow312#17;
         #dsm211ca#48 = #dsmow312#18;
         #dsm211ca#49 = #dsmow312#19;
         #dsm211ca#50 = #dsmow312#20;
         #dsm211ca#51 = #dsmow312#21;
         #dsm211ca#52 = #dsmow312#22;
         #dsm211ca#53 = #dsmow312#23;
         #dsm211ca#60 = #dsmow312#24;
         #dsm211ca#61 = #dsmow312#25;
         #dsm211ca#62 = #dsmow312#26;
         #dsm211ca#63 = #dsmow312#27;
         #dsm211ca#64 = #dsmow312#28;
         #dsm211ca#65 = #dsmow312#29;
         #dsm211ca#66 = #dsmow312#30;
         #dsm211ca#67 = #dsmow312#31;
         |SI #dsmow312#32 = "S"; #dsm211ca#44 = "R"; |FINSI;
         |GRABA 020#dsm211ca.a;
      |SINO;
         || Eliminar los posibles datos de adquirientes / Transmitentes
         |BUCLE BorraAdqui;
         |BUCLE BorraTrans;

         |BORRA 020#dsm211ca.a;
      |FINSI;
      |LIBERA #dsm211ca;

      |REFRESCACONTROL nGrid1;
   |SINO;
      |CIERRA #dsminmex;

      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1;
   |FINSI;

   #dsm211ca#0  = #dsm210dp#0;
   #dsm211ca#1  = 1;
   |LEE 000#dsm211ca.];
   |SI FSalida = 0; |Y #dsm211ca#0  = #dsm210dp#0;
      |ESTADO_CONTROL nBorInm211, "ENABLE";
      |ESTADO_CONTROL nModInm211, "ENABLE";
   |FINSI;
   |ESTADO_CONTROL nRelTrans, "DISABLE";
   |ESTADO_CONTROL nRelAdqui, "DISABLE";
   |ESTADO_CONTROL nDatRepre, "DISABLE";
   |ESTADO_CONTROL nNueInm211, "ENABLE";
   |ESTADO_CONTROL nGrid1, "ENABLE";
   |ESTADO_CONTROL nIdSalir, "SHOW";

   |FOCOTECLADO nGrid1;
   nModo = 0;
|FPRC;

|PROCESO CompruebaCampos;
   aAlfa  = #dsminmex#nCmpA#;  |QBF aAlfa;
   |SI nModelo = 210;
      |SI nCmpB = 5;
         aAlfa  = #dsminmex#3;  |QBF aAlfa;
         aAlfa2 = #dsminmex#4;  |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + " " + aAlfa2; |FINSI;
         aAlfa2 = #dsminmex#5;  |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + " " + aAlfa2; |FINSI;
         aAlfa2 = #dsminmex#6;  |QBF aAlfa2; |SI aAlfa2 ! "0"; |Y aAlfa2 ! ""; aAlfa = aAlfa + ", " + aAlfa2; |FINSI;
         aAlfa2 = #dsminmex#7;  |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + " " + aAlfa2; |FINSI;
         aAlfa2 = #dsminmex#8;  |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + ", " + aAlfa2; |FINSI;
         aAlfa2 = #dsminmex#9;  |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + ", " + aAlfa2; |FINSI;
         aAlfa2 = #dsminmex#10; |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + ", " + aAlfa2; |FINSI;
         aAlfa2 = #dsminmex#11; |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + " " + aAlfa2; |FINSI;
         aAlfa2 = #dsminmex#12; |QBF aAlfa2; |SI aAlfa2 ! ""; aAlfa = aAlfa + "-" + aAlfa2; |FINSI;
      |FINSI;
      |SI nCmpB = 6;
         aAlfa = (("00" + #dsminmex#15) % -102) + (("000" + #dsminmex#16) % -103);
      |FINSI;
      aAlfa1 = #dsm210in#nCmpB#; |QBF aAlfa1;
      aAlfa2 = aAlfa  % 0; nCalc1 = aAlfa2; nCalc1 = nCalc1 + 100;
      aAlfa2 = aAlfa1 % 0; nCalc2 = aAlfa2; nCalc2 = nCalc2 + 100;
      |SI nCalc1 > nCalc2; aAlfa  = aAlfa  % nCalc2; |FINSI;
      |SI nCalc1 < nCalc2; aAlfa1 = aAlfa1 % nCalc2; |FINSI;
   |FINSI;
   |SI nModelo = 211;
      aAlfa1 = #dsm211ca#nCmpB#; |QBF aAlfa1;
      |SI nCmpB = 20; aAlfa1 = (("00"  + #dsm211ca#nCmpB#) % -102); |QBF aAlfa1; |FINSI;
      |SI nCmpB = 21; aAlfa1 = (("000" + #dsm211ca#nCmpB#) % -103); |QBF aAlfa1; |FINSI;
   |FINSI;
   |SI aAlfa ! aAlfa1; nSwActualiza = 1; |FINSI;
|FPRC;

|PROCESO ComprDatInm211;
   nModelo = 211;

   |ABRE #dsminmex;
   #dsminmex#0 = #dsm211ca#0;
   #dsminmex#1 = #dsm211ca#1;
   |LEE 000#dsminmex.=;
   |SI FSalida = 0;
      nSwActualiza = 0;

      || Referencia catastral
      nCmpA = 2;  nCmpB = 56; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Tipo de via
      nCmpA = 3;  nCmpB = 8;  |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Nombre de la via
      nCmpA = 4;  nCmpB = 9;  |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Tipo de numero
      nCmpA = 5;  nCmpB = 10; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Numero de casa
      nCmpA = 6;  nCmpB = 11; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Calificador del numero
      nCmpA = 7;  nCmpB = 12; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Bloque
      nCmpA = 8;  nCmpB = 13; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Portal
      nCmpA = 9;  nCmpB = 14; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Escalera
      nCmpA = 10; nCmpB = 15; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Piso
      nCmpA = 11; nCmpB = 16; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Puerta
      nCmpA = 12; nCmpB = 17; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Datos complementarios
      nCmpA = 13; nCmpB = 18; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Localidad / Poblacion
      nCmpA = 14; nCmpB = 19; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Codigo Postal 1
      nCmpA = 15; nCmpB = 20; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Codigo Postal 2
      nCmpA = 16; nCmpB = 21; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Municipio
      nCmpA = 17; nCmpB = 22; |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;
      || Descripcion del inmueble
      nCmpA = 22; nCmpB = 2;  |HAZ CompruebaCampos; |SI nSwActualiza = 1; |VETE Actualiza; |FINSI;

|ET Actualiza;
      |SI nSwActualiza = 1;
         aAlfa = "    NSe han encontrado datos distintos a la ficha de inmuebles. " + &191 + " Actualizar ?";
         |CONFI aAlfa;
         |SI FSalida = 0;
            #dsm211ca#2  = #dsminmex#22;
            #dsm211ca#56 = #dsminmex#2;
            #dsm211ca#8  = #dsminmex#3;
            #dsm211ca#9  = #dsminmex#4;
            #dsm211ca#10 = #dsminmex#5;
            #dsm211ca#11 = #dsminmex#6;
            #dsm211ca#12 = #dsminmex#7;
            #dsm211ca#13 = #dsminmex#8;
            #dsm211ca#14 = #dsminmex#9;
            #dsm211ca#15 = #dsminmex#10;
            #dsm211ca#16 = #dsminmex#11;
            #dsm211ca#17 = #dsminmex#12;
            #dsm211ca#18 = #dsminmex#13;
            #dsm211ca#19 = #dsminmex#14;
            #dsm211ca#20 = #dsminmex#15;
            #dsm211ca#21 = #dsminmex#16;
            #dsm211ca#22 = #dsminmex#17;
            |GRABA 020#dsm211ca.a;

            |REFRESCACONTROL nGrid1;
         |FINSI;
      |FINSI;
   |FINSI;
   |CIERRA #dsminmex;
|FPRC;

|PROCESO ModInm211;

   |HAZ ComprDatInm211;

   Cmp = -1;
   nModo = 2;
   InNivel = nNivel1<-;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;

   |ESTADO_CONTROL nNueInm211, "DISABLE";
   |ESTADO_CONTROL nModInm211, "DISABLE";
   |ESTADO_CONTROL nBorInm211, "DISABLE";
   |ESTADO_CONTROL nGrid1, "DISABLE";
   |ESTADO_CONTROL nRelAdqui, "ENABLE";
   |ESTADO_CONTROL nRelTrans, "ENABLE";
   |ESTADO_CONTROL nDatRepre, "ENABLE";
   |ESTADO_CONTROL nIdSalir, "HIDE";

   |LEE 101#dsm211ca.=;
   |SI FSalida = 0;
      #dsmow306#0 = #dsm211ca#1;
      #dsmow306#1 = #dsm211ca#2;
      #dsmow306#2 = #dsm211ca#56;

      #dsmow312#0  = #dsm211ca#4;  |PINTA #dsmow312#0;
      #dsmow312#1  = #dsm211ca#7;  |PINTA #dsmow312#1;
      #dsmow312#2  = #dsm211ca#5;  |PINTA #dsmow312#2;
      #dsmow312#3  = #dsm211ca#6;  |PINTA #dsmow312#3;
      #dsmow312#4  = #dsm211ca#54; |PINTA #dsmow312#4;
      #dsmow312#5  = #dsm211ca#23; |PINTA #dsmow312#5;
      #dsmow312#6  = #dsm211ca#25; |PINTA #dsmow312#6;
      #dsmow312#7  = #dsm211ca#24; |PINTA #dsmow312#7;
      #dsmow312#8  = #dsm211ca#2;  |PINTA #dsmow312#8;
      #dsmow312#9  = #dsm211ca#56; |PINTA #dsmow312#9;
      |SI #dsm211ca#44 = "P"; #dsmow312#10 = "S"; |SINO; #dsmow312#10 = "N"; |FINSI;
      |PINTA #dsmow312#10;
      #dsmow312#11 = #dsm211ca#45; |PINTA #dsmow312#11;
      #dsmow312#12 = #dsm211ca#46; |PINTA #dsmow312#12;
      #dsmow312#13 = #dsm211ca#57; |PINTA #dsmow312#13;
      #dsmow312#14 = #dsm211ca#58; |PINTA #dsmow312#14;
      #dsmow312#15 = #dsm211ca#59; |PINTA #dsmow312#15;
      #dsmow312#16 = #dsm211ca#55; |PINTA #dsmow312#16;
      #dsmow312#17 = #dsm211ca#47; |PINTA #dsmow312#17;
      #dsmow312#18 = #dsm211ca#48; |PINTA #dsmow312#18;
      #dsmow312#19 = #dsm211ca#49; |PINTA #dsmow312#19;
      #dsmow312#20 = #dsm211ca#50; |PINTA #dsmow312#20;
      #dsmow312#21 = #dsm211ca#51; |PINTA #dsmow312#21;
      #dsmow312#22 = #dsm211ca#52; |PINTA #dsmow312#22;
      #dsmow312#23 = #dsm211ca#53; |PINTA #dsmow312#23;
      #dsmow312#24 = #dsm211ca#60; |PINTA #dsmow312#24;
      #dsmow312#25 = #dsm211ca#61; |PINTA #dsmow312#25;
      #dsmow312#26 = #dsm211ca#62; |PINTA #dsmow312#26;
      #dsmow312#27 = #dsm211ca#63; |PINTA #dsmow312#27;
      #dsmow312#28 = #dsm211ca#64; |PINTA #dsmow312#28;
      #dsmow312#29 = #dsm211ca#65; |PINTA #dsmow312#29;
      #dsmow312#30 = #dsm211ca#66; |PINTA #dsmow312#30;
      #dsmow312#31 = #dsm211ca#67; |PINTA #dsmow312#31;
      |SI #dsm211ca#44 = "R"; #dsmow312#32 = "S"; |SINO; #dsmow312#32 = "N"; |FINSI;
      |PINTA #dsmow312#32;
      #dsmow312#33 = #dsm211ca#3; |PINTA #dsmow312#33;

      |ENDATOS #1#dsmow312;
      |SI FSalida = 0;
         #dsm211ca#3  = #dsmow312#33;
         #dsm211ca#4  = #dsmow312#0;
         #dsm211ca#7  = #dsmow312#1;
         #dsm211ca#5  = #dsmow312#2;
         #dsm211ca#6  = #dsmow312#3;
         #dsm211ca#54 = #dsmow312#4;
         #dsm211ca#23 = #dsmow312#5;
         #dsm211ca#25 = #dsmow312#6;
         #dsm211ca#24 = #dsmow312#7;
         #dsm211ca#2  = #dsmow312#8;
         #dsm211ca#56 = #dsmow312#9;
         |SI #dsmow312#10 = "S"; #dsm211ca#44 = "P"; |FINSI;
         #dsm211ca#45 = #dsmow312#11;
         #dsm211ca#46 = #dsmow312#12;
         #dsm211ca#57 = #dsmow312#13;
         #dsm211ca#58 = #dsmow312#14;
         #dsm211ca#59 = #dsmow312#15;
         #dsm211ca#55 = #dsmow312#16;
         #dsm211ca#47 = #dsmow312#17;
         #dsm211ca#48 = #dsmow312#18;
         #dsm211ca#49 = #dsmow312#19;
         #dsm211ca#50 = #dsmow312#20;
         #dsm211ca#51 = #dsmow312#21;
         #dsm211ca#52 = #dsmow312#22;
         #dsm211ca#53 = #dsmow312#23;
         #dsm211ca#60 = #dsmow312#24;
         #dsm211ca#61 = #dsmow312#25;
         #dsm211ca#62 = #dsmow312#26;
         #dsm211ca#63 = #dsmow312#27;
         #dsm211ca#64 = #dsmow312#28;
         #dsm211ca#65 = #dsmow312#29;
         #dsm211ca#66 = #dsmow312#30;
         #dsm211ca#67 = #dsmow312#31;
         |SI #dsmow312#32 = "S"; #dsm211ca#44 = "R"; |FINSI;
         |GRABA 020#dsm211ca.a;
      |FINSI;
      |LIBERA #dsm211ca;

      |REFRESCACONTROL nGrid1;
   |FINSI;

   |ESTADO_CONTROL nIdSalir, "SHOW";
   |ESTADO_CONTROL nGrid1, "ENABLE";
   |ESTADO_CONTROL nRelTrans, "DISABLE";
   |ESTADO_CONTROL nRelAdqui, "DISABLE";
   |ESTADO_CONTROL nDatRepre, "DISABLE";
   |ESTADO_CONTROL nBorInm211, "ENABLE";
   |ESTADO_CONTROL nModInm211, "ENABLE";
   |ESTADO_CONTROL nNueInm211, "ENABLE";

   |FOCOTECLADO nGrid1;
   nModo = 0;
|FPRC;

|PROCESO BorInm211;
   |LEE 101#dsm211ca.=;
   |SI FSalida = 0;
      aAlfa = "    N" + &191 + " Está seguro de eliminar el inmueble seleccionado ?";
      |CONFI aAlfa;
      |SI FSalida = 0;
         |BUCLE BorraAdqui;
         |BUCLE BorraTrans;
         |BORRA 020#dsm211ca.a;

         #dsm211ca#0 = #dsm210dp#0;
         #dsm211ca#1 = 1;
         |LEE 000#dsm211ca.];
         |SI FSalida ! 0; |O #dsm211ca#0 ! #dsm210dp#0;
            |ESTADO_CONTROL nModInm211, "DISABLE";
            |ESTADO_CONTROL nBorInm211, "DISABLE";
         |FINSI;

         |DDEFECTO #dsmow312; |PINDA #0#dsmow312;

         |REFRESCACONTROL nGrid1;
      |FINSI;
      |LIBERA #dsm211ca;
   |FINSI;
|FPRC;

|PROCESO DatosRep;
   InNivel = nNivel1<-;
   nNivel1 = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;

   |ESTADO_CONTROL nRelAdqui, "DISABLE";
   |ESTADO_CONTROL nDatRepre, "DISABLE";
   |ESTADO_CONTROL nRelTrans, "DISABLE";

   |VENTANA 1108, 2292, 1, 17, "Datos del representante del adquirente"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   InNivel = nNivel1<-;
   |ESPECIFICA "IDBOTONTECLA", nNivel;
   nIdSalir = nNivel2;

   |DDEFECTO #dsmow318;
   |PARA nCont = 23; |SI nCont [ 43; |HACIENDO nCont = nCont + 1;
      |SI nCont < 38;
         nCalc = nCont - 23;
      |SINO;
         nCalc = nCont - 22;
      |FINSI;
      |SI nCont = 38;
         aAlfa = #dsm211ca#38; |QBF aAlfa;
         aAlfa1 = aAlfa % 0102; #dsmow318#15 = aAlfa1; |PINTA #dsmow318#15;
         aAlfa1 = aAlfa % 0303; #dsmow318#16 = aAlfa1; |PINTA #dsmow318#16;
      |SINO;
         #dsmow318#nCalc# = #dsm211ca#nCont#; |PINTA #dsmow318#nCalc#;
      |FINSI;
   |SIGUE;
   #dsmow318#22 = #dsm211ca#68; |PINTA #dsmow318#22;
   #dsmow318#23 = #dsm211ca#38;

   #reprovi@#0 = #dsmow318#15;
   |LEE 000#reprovi@.=;
   |SI FSalida ! 0; |DDEFECTO #reprovi@; |FINSI;
   #dsmow318#18 = #reprovi@#1;

   #dsmow318#23 = (("00" + #dsmow318#15) % -102) + (("000" + #dsmow318#16) % -103);

   |PINPA #0#dsmow318; nPant1 = FSalida;
   |PINDA #0#dsmow318;

   |ENDATOS #1#dsmow318;
   |SI FSalida = 0;
      |PARA nCont = 23; |SI nCont [ 43; |HACIENDO nCont = nCont + 1;
         |SI nCont < 38;
            nCalc = nCont - 23;
         |SINO;
            nCalc = nCont - 22;
         |FINSI;
         |SI nCont = 38;
            aAlfa = (("00" + #dsmow318#15) % -102) + (("000" + #dsmow318#16) % -103);
            #dsm211ca#38 = aAlfa;
         |SINO;
            #dsm211ca#nCont# = #dsmow318#nCalc#;
         |FINSI;
      |SIGUE;
      #dsm211ca#40 = #dsmow318#15;
      #dsm211ca#68 = #dsmow318#22;
      |GRABA 020#dsm211ca.a;

      #dsmow312#5 = #dsm211ca#23; |PINTA #dsmow312#5;
      #dsmow312#6 = #dsm211ca#25; |PINTA #dsmow312#6;
      #dsmow312#7 = #dsm211ca#24; |PINTA #dsmow312#7;
   |FINSI;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent1;

   |ESTADO_CONTROL nRelTrans, "ENABLE";
   |ESTADO_CONTROL nRelAdqui, "ENABLE";
   |ESTADO_CONTROL nDatRepre, "ENABLE";
|FPRC;

|PROCESO Inf211ca;
   #dsm211ca#0 = #dsm210dp#0;
   #dsm211ca#1 = 001;
|FPRC;

|PROCESO Sup211ca;
   #dsm211ca#0 = #dsm210dp#0;
   #dsm211ca#1 = 999;
|FPRC;

|PROCESO EntraDatos211;
   aAlfa = "Modelo 211 : Contribuyente [" + (("00000" + #dsm210dp#0) % -105) + "] ";
   aAlfa = aAlfa + #dsm210dp#1; |QBF aAlfa;
   aAlfa = aAlfa + "    CIF " + #dsm210dp#2;
   |VENTANA 0501, 3199, 1, 17, aAlfa; nVent0 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent0;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |ABRE #dsm211ca;
   |ABRE #dsm211la; |ABRE #dsm211tr;

   |DDEFECTO #dsmow312;
   |PINPA #0#dsmow312; nPant1 = FSalida;
   |PINDA #0#dsmow312;

   nNumSPant = 0;

   nPos1 = 1102; nPos2 = 1122;
   |CONTROL_SIMPLE nPant1, "BOTON,{{197}}Gestion inmuebles", nPos1, nPos2, ManteInmue;
   nBotonGestInm = FSalida;

   nPos1 = 1164; nPos2 = 1174;
   |CONTROL_SIMPLE nPant1, "BOTON,{{137}}&Nuevo", nPos1, nPos2, NueInm211;
   nNueInm211 = FSalida;

   nPos1 = 1176; nPos2 = 1186;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}&Modificar", nPos1, nPos2, ModInm211;
   nModInm211 = FSalida; |ESTADO_CONTROL nModInm211, "DISABLE";

   nPos1 = 1188; nPos2 = 1198;
   |CONTROL_SIMPLE nPant1, "BOTON,{{199}}&Borrar", nPos1, nPos2, BorInm211;
   nBorInm211 = FSalida; |ESTADO_CONTROL nBorInm211, "DISABLE";

   nPos1 = 1484; nPos2 = 1498;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}&Adquirientes", nPos1, nPos2, RelAdqui;
   nRelAdqui = FSalida; |ESTADO_CONTROL nRelAdqui, "DISABLE";

   nPos1 = 1684; nPos2 = 1798;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}&Datos Representante", nPos1, nPos2, DatosRep;
   nDatRepre = FSalida; |ESTADO_CONTROL nDatRepre, "DISABLE";

   nPos1 = 2084; nPos2 = 2098;
   |CONTROL_SIMPLE nPant1, "BOTON,{{135}}&Transmitentes", nPos1, nPos2, RelTrans;
   nRelTrans = FSalida; |ESTADO_CONTROL nRelTrans, "DISABLE";

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 0602; nPos2 = 1097;
   |LINEAL_SIMPLE #1#dsm211ca, nRango, nPos1, nPos2, Inf211ca, Sup211ca, EvtoGrid211a;
   nGrid1 = FSalida;
   |PULSATECLA;

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Sa&Lir," + nGrid1;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
   |SIGUE;

   |FIN_CONTROL_WINDOWS nNueInm211;
   |FIN_CONTROL_WINDOWS nModInm211;
   |FIN_CONTROL_WINDOWS nBorInm211;

   |FIN_CONTROL_WINDOWS nBotonGestInm;

   |DESTRUYECONTROL nGrid1;

   aVent4 = nVent0;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |CIERRA #dsm211la; |CIERRA #dsm211tr;
   |CIERRA #dsm211ca;

   |FINVENTANA nVent0;
|FPRC;

/***************************************************************************
*********                       FIN MODELO 211                     *********
****************************************************************************/
|PROCESO ElColorLinea;
  |SI #dsm210dp#103 = "I";
      #dsm210dp#104 = "255,80,80;255,255,255";
      || #dsm210dp#104 = "190,190,190;255,255,255"; gris
  |SINO;
      #dsm210dp#104 = "0,0,0;255,255,255";
  |FINSI;
|FPRC;

|PROCESO EvtoGrid0;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsm210dp.=;
   |FINSI;
|FPRC;

|PROCESO EvtoTree0;
   |SI FEntrada = 0; |ACABA; |FINSI;

   aAlfa = Contenido;
   |PULSATECLA;

   enEmpresa = #dsm210dp#0;
   |HAZ MiraBloqueo;
   |SI eaBloqueo = "3";
       |ACABA;
   |FINSI;

   |SI aAlfa ! "";
       |SI #dsm210dp#103 = "I";
           |CONFI "0000NContribuyente Inactivo. Continuar";
           |SI FSalida ! 0;
               |ACABA;
           |FINSI;
       |FINSI;
   |FINSI;
   |SI aAlfa = "DATPET";  |HAZ DatosPersonalesT; |FINSI;
   |SI aAlfa = "DATPEC";  |HAZ DatosPersonalesC; |FINSI;
   |SI aAlfa = "INMUEB";  |HAZ GestionaInmue;    |FINSI;
   |SI aAlfa = "PASEINM"; |HAZ PaseInmAplicAnt;  |FINSI;
   |SI aAlfa = "MOD210";  |HAZ EntraDatos210;    |FINSI;
   |SI aAlfa = "EMI210";  |HAZ Emision210;       |FINSI;
   |SI aAlfa = "HIS210";  |HAZ Historico210;     |FINSI;
   |SI aAlfa = "MOD211";  |HAZ EntraDatos211;    |FINSI;
   |SI aAlfa = "EMI211";  |HAZ Emision211;       |FINSI;
   |SI aAlfa = "HIS211";  |HAZ Historico211;     |FINSI;
   |SI aAlfa = "MOD213";
      |SI #dsm210dp#3 = "J";
         |HAZ EntraDatos213;
      |SINO;
         aAlfa = "    Este modelo esta unicamente disponible para entidades juridicas";
         |MENAV aAlfa; |ERROR;
      |FINSI;
   |FINSI;
   |SI aAlfa = "EMI213";  |HAZ Emision213;       |FINSI;
   |SI aAlfa = "HIS213";  |HAZ Historico213;     |FINSI;
|FPRC;

|PROCESO MiraPorcTit;
   aAlfa = #dsm210dp#65; |QBF aAlfa;
   |SI aAlfa = "";
      |C_M #dsmow304#23, 1, "N";
   |SINO;
      |C_M #dsmow304#23, 1, "S";
   |FINSI;
|FPRC;

|PROCESO RecogeExtranjeros;
   |SI enSwCod = 1;
      aNif = #Referen@#3;
   |SINO;
      aNif = #Referen@#13;
   |FINSI;

   |SI aAlfaF4 ! "";
      #Refere4@#0  = #Referen@#0;
      |LEE 000#Refere4@.=;
      |SI FSalida = 0;
         |SI #Refere4@#64 = "N"; |ACABA; |FINSI;
      |SINO;
         |ACABA;
      |FINSI;
   |SINO;
      #Refere1@#0 = aNif;
      #Refere1@#1 = 1;
      |LEE 000#Refere1@.];
      |PARA; |SI FSalida = 0; |HACIENDO;
         |SI #Refere1@#2 = "TITULAR     "; |SAL; |FINSI;
         |LEE 000#Refere1@.s;
      |SIGUE;

      |SI #Refere1@#2 ! "TITULAR     "; |O #Refere1@#0 ! aNif; |ACABA; |FINSI;
      |SI #Refere1@#20 = "S"; |ACABA; |FINSI;
   |FINSI;

   #dsm210dp#0  = #Referen@#0;
   |LEE 000#dsm210dp.=;
   |SI FSalida = 0; |ACABA; |FINSI;

   #Refere3@#0 = aNif;
   |LEE 000#Refere3@.=;
   |SI FSalida ! 0; |DDEFECTO #Refere3@; |FINSI;

   #Refere2@#0 = #Referen@#0;
   #Refere2@#1 = 1;
   |LEE 000#Refere2@.];
   |SI FSalida ! 0; |O #Refere2@#0 ! #Referen@#0; |DDEFECTO #Refere2@; |FINSI;

   #dsm210dp#0  = #Referen@#0;
   |LEE 101#dsm210dp.=;
   |SI FSalida ! 0;
      |DDEFECTO #dsm210dp;
      #dsm210dp#0  = #Referen@#0;
      |GRABA 020#dsm210dp.b;
   |FINSI;

   #dsm210dp#10 = "NUM";
   #dsm210dp#26 = #Refere3@#17;
   #dsm210dp#36 = #Refere3@#17;
   |SI aAlfaF4 = "";
      #dsm210dp#1  = #Refere1@#12;
      #dsm210dp#2  = #Refere1@#0;
      #dsm210dp#4  = #Refere1@#13;
      #dsm210dp#5  = #Refere1@#32;
      #dsm210dp#8  = #Refere1@#24;
      #dsm210dp#9  = #Refere1@#25;
      #dsm210dp#11 = #Refere1@#26;
      #dsm210dp#15 = #Refere1@#27;
      #dsm210dp#16 = #Refere1@#28;
      #dsm210dp#17 = #Refere1@#29;
      #dsm210dp#20 = #Refere1@#30;
      #dsm210dp#21 = #Refere1@#31;
      #dsm210dp#22 = #Refere1@#32;
      #dsm210dp#23 = #Refere1@#33;
      #dsm210dp#24 = #Refere1@#34;
      #dsm210dp#25 = #Refere1@#35;
      aAlfa = #Refere1@#24;
      aAlfa1 = #Refere1@#25; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + " " + aAlfa1; |FINSI;
      aAlfa1 = #Refere1@#26; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1; |FINSI;
      aAlfa1 = #Refere1@#27; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + ", Esc." + aAlfa1; |FINSI;
      aAlfa1 = #Refere1@#28; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + ", " + aAlfa1 + "§"; |FINSI;
      aAlfa1 = #Refere1@#29; |QBF aAlfa1; |SI aAlfa1 ! ""; aAlfa = aAlfa + "-" + aAlfa1 + "§"; |FINSI;
      #dsm210dp#27 = aAlfa;
      #dsm210dp#29 = #Refere1@#32;
      #dsm210dp#31 = (("00" + #Refere1@#30) % -102) + (("000" + #Refere1@#31) % -103);
      #dsm210dp#32 = #Refere1@#33;
      #dsm210dp#34 = #Refere1@#34;
      #dsm210dp#35 = #Refere1@#35;
   |SINO;
      #dsm210dp#1  = #Referen@#1;
      || #dsm210dp#1  = #Refere4@#5;
      #dsm210dp#2  = #Refere4@#1;
      #dsm210dp#4  = #Refere4@#67;
      aAlfa1 =  #dsm210dp#5; |QBF aAlfa1;
      |SI aAlfa1 = "";
          #dsm210dp#5  = #Refere4@#22;
      |FINSI;
      |SI #Refere4@#75 = "N";
          #dsm210dp#8  = #Refere4@#14;
          #dsm210dp#9  = #Refere4@#15;
          #dsm210dp#11 = #Refere4@#16;
          #dsm210dp#15 = #Refere4@#17;
          #dsm210dp#16 = #Refere4@#18;
          #dsm210dp#17 = #Refere4@#29;
          #dsm210dp#18 = #Refere4@#80;
          #dsm210dp#19 = #Refere4@#81;
          #dsm210dp#20 = #Refere4@#20;
          #dsm210dp#21 = #Refere4@#21;
          #dsm210dp#22 = #Refere4@#22;

         #reprovi@#0 = #Refere4@#20;
         |LEE 000#reprovi@.=;
         |SI FSalida ! 0; |DDEFECTO #reprovi@; |FINSI;

         #dsm210dp#23 = #reprovi@#1;
         #dsm210dp#24 = #Refere4@#12;
         #dsm210dp#25 = #Refere4@#71;
         #dsm210dp#26 = #Refere4@#74;
      |SINO;

         #dsm210dp#27 = #Refere4@#82;
         #dsm210dp#28 = #Refere4@#83;
         #dsm210dp#29 = #Refere4@#84;
         #dsm210dp#30 = #Refere4@#85;
         #dsm210dp#31 = #Refere4@#86;
         #dsm210dp#32 = #Refere4@#87;
         aAlfa4 = #Refere4@#88; |HAZ VerPais;
         #dsm210dp#33 = aAlfa4;  ||  #Refere4@#88
         #dsm210dp#34 = #Refere4@#12;
         #dsm210dp#35 = #Refere4@#71;
         #dsm210dp#36 = #Refere4@#74;
      |FINSI;

   |FINSI;

   |SI enSwCod = 1;
      || ... #dsm210dp#3 = #Referen@#79;
   |SINO;
      |SI aAlfaF4 = "";
         #dsm210dp#11 = #Refere1@#32;
      |FINSI;
   |FINSI;

   |GRABA 020#dsm210dp.a; |LIBERA #dsm210dp;
|FPRC;


|PROCESO TmpExtranjeros;
   aAlfa = "A";
   |SI enSwCod = 1;
      aNif  = #Referen@#3;
      aAlfa = #Referen@#85;
   |SINO;
      aNif = #Referen@#13;
      |SI #Referen@#94 ] "01.01.1900";
          aAlfa = "I";
      |FINSI;
   |FINSI;

   |SI aAlfaF4 ! "";
      #Refere4@#0  = #Referen@#0;
      |LEE 000#Refere4@.=;
      |SI FSalida = 0;
         |SI #Refere4@#64 = "N"; |ACABA; |FINSI;
      |SINO;
         |ACABA;
      |FINSI;
   |SINO;
      #Refere1@#0 = aNif;
      #Refere1@#1 = 1;
      |LEE 000#Refere1@.];
      |PARA; |SI FSalida = 0; |HACIENDO;
         |SI #Refere1@#2 = "TITULAR     "; |SAL; |FINSI;
         |LEE 000#Refere1@.s;
      |SIGUE;

      |SI #Refere1@#2 ! "TITULAR     "; |O #Refere1@#0 ! aNif; |ACABA; |FINSI;
      |SI #Refere1@#20 = "S"; |ACABA; |FINSI;
   |FINSI;

   |DDEFECTO #dsmow323;
   #dsmow323#0 = #Referen@#0;
   #dsmow323#1 = #Referen@#1;
   #dsmow323#2 = #Referen@#2;
   #dsmow323#3 = "Activo";
   |SI aAlfa = "I";
       #dsmow323#3 = "Inactivo";
   |FINSI;
   |GRABA 020#dsmow323.n;
|FPRC;

|DEFBUCLE TmpExtranjeros;
  #Referen@#1001;
  ;
  00001;
  99999;
  ;
  NULL, TmpExtranjeros;
|FIN;

|PROCESO NuevoContr;

   |DBASS aAlfa; |QBF aAlfa;
   |SI enSwCod = 1;
      aAlfa1 = aAlfa + "integral/def/dsam0000.mas";
      aAlfa3 = aAlfa + "integral/def/dsam0103.mas";
      aAlfaF4 = aAlfa + "integral/def/dsam0003.mas";
   |SINO;
      aAlfa1 = aAlfa + "basica/def/agifigen.mas";
      aAlfa3 = aAlfa + "basica/def/agim0003.mas";
      aAlfaF4 = "";
   |FINSI;
   |CARGA_DEF aAlfa1, Referen@;
   |SI FSalida = 0;
      aAlfa2 = aAlfa + "basica/def/agidanif.mas";
      |CARGA_DEF aAlfa2, Refere1@;

      aAlfa2 = aAlfa + "basica/def/agim0004.mas";
      |CARGA_DEF aAlfa2, Refere2@;

      |CARGA_DEF aAlfa3, Refere3@;
      |SI FSalida = 0;
         |SI enSwCod = 1;
            aAlfa1 = aAlfa + "integral/fich/";
            |PATH_DAT #Referen@#aAlfa1#; |PATH_DAT #Refere3@#aAlfa1#;

            |CARGA_DEF aAlfaF4, Refere4@;
            |SI FSalida ! 0; aAlfaF4 = ""; |SINO; |PATH_DAT #Refere4@#aAlfa1#; |FINSI;
         |SINO;
            aAlfa1 = aAlfa + "basica/fich/";
            |PATH_DAT #Referen@#aAlfa1#; |PATH_DAT #Refere3@#aAlfa1#;
         |FINSI;
         aAlfa1 = aAlfa + "basica/fich/";
         |PATH_DAT #Refere1@#aAlfa1#; |PATH_DAT #Refere2@#aAlfa1#;
         |ABRE #Refere1@; |ABRE #Refere2@; |ABRE #Refere3@;
         |SI aAlfaF4 ! ""; |ABRE #Refere4@; |FINSI;

         aAlfa = "tmp" + Usuario; |NOME_DAT #dsmow323#aAlfa#;
         |DELINDEX #dsmow323; |ABRE #dsmow323;
         |BUCLE TmpExtranjeros;

         |ABRE #Referen@;

|ET Consulta;  ||aqui
         |CONSULTA_CLAVE #1#dsmow323;

         |SI FSalida = 0;
            |SI #dsmow323#3 = "Inactivo";
                |CONFI "0000NContribuyente Inactivo. Continuar";
                |SI FSalida ! 0;
                    |VETE Consulta;
                |FINSI;
            |FINSI;

            #Referen@#0 = #dsmow323#0;
            |LEE 000#Referen@.=;
            |SI FSalida = 0;
                |HAZ RecogeExtranjeros;
            |FINSI;
         |FINSI;

         |CIERRA #dsmow323; |DELINDEX #dsmow323;
         |SI aAlfaF4 ! "";
             |CIERRA #Refere4@;
             |DESCARGA_DEF #Refere4@;
         |FINSI;
         |CIERRA #Referen@;
         |CIERRA #Refere1@;
         |CIERRA #Refere2@;
         |CIERRA #Refere3@;
         |DESCARGA_DEF #Refere3@;
         |DESCARGA_DEF #Refere2@;
         |DESCARGA_DEF #Refere1@;
      |FINSI;
      |DESCARGA_DEF #Referen@;
   |FINSI;

   |REFRESCACONTROL nGrid0;
|FPRC;

|PROCESO BorraInmuebles;
   |BUCLE BorraValCat;

   |BORRA 020#dsminmex.a;
|FPRC;

|DEFBUCLE BorraInmuebles;
#dsminmex#1;
;
#dsm210dp#0, 000;
#dsm210dp#0, 999;
be;
NULL, BorraInmuebles;
|FIN;

|PROCESO BorraInm211;
   |BUCLE BorraAdqui;
   |BUCLE BorraTrans;
   |BORRA 020#dsm211ca.a;
|FPRC;

|DEFBUCLE BorraInm211;
#dsm211ca#1;
;
#dsm210dp#0, 000;
#dsm210dp#0, 999;
be;
NULL, BorraInm211;
|FIN;

|PROCESO Borra210;
   |BUCLE BorraInm;
   |BUCLE BorraNIF;

   |BORRA 020#dsm210ca.a;
|FPRC;

|DEFBUCLE Borra210;
#dsm210ca#1;
;
#dsm210dp#0, 00;
#dsm210dp#0, 99;
be;
NULL, Borra210;
|FIN;

|PROCESO BorraContr;
   aAlfa = "    N" + &191 + " Esta seguro de eliminar el contribuyente y toda la informacion referente a el ? ";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |HAZ EliminaContr;

      |BORRA 020#dsm210dp.a;

      |REFRESCACONTROL nGrid0;
   |FINSI;
|FPRC;

|PROCESO ValorCatastralMasivo;
   |SALVA_FICHA #dsm210dp;
   |ESTADO_CONTROL nBotonValCatMas, "DISABLE";
   |ESTADO_CONTROL nBotonNueCt, "DISABLE";
   |ESTADO_CONTROL nBotonBorCt, "DISABLE";
   |ESTADO_CONTROL nGrid0, "DISABLE";
   |ESTADO_CONTROL nTree0, "DISABLE";

   |HAZ CargaValoresCatastrales;

   |ESTADO_CONTROL nBotonValCatMas, "ENABLE";
   |ESTADO_CONTROL nBotonNueCt, "ENABLE";
   |ESTADO_CONTROL nBotonBorCt, "ENABLE";
   |ESTADO_CONTROL nGrid0, "ENABLE";
   |ESTADO_CONTROL nTree0, "ENABLE";
   |REPON_FICHA #dsm210dp;
|FPRC;

|PROCESO PasaMenuArbol;
   |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "tmp/";
   aAlfa1 = aAlfa + "tree" + Usuario + ".tar tree" + Usuario + ".txt";
   |ATAR aAlfa1, aAlfa;

   aAlfa1 = aAlfa + "tree" + Usuario + ".tar";
   |COMPRIME aAlfa1;
   eaOrigen = aAlfa + "tree" + Usuario + ".tgz";

   aAlfa1 = aAlfa + "tree" + Usuario + ".tar"; |FBORRA aAlfa1;
   aAlfa1 = aAlfa + "tree" + Usuario + ".txt"; |FBORRA aAlfa1;

   |PULSATECLA;

   eaDestino = eaUnidadBase + "/documentos/modelos/tmp/tree" + Usuario + ".tgz";
   |HAZ EnviaFicheroMD5;

   |FBORRA eaOrigen;

   aAlfa  = eaDestino;
   aAlfa1 = "tree" + Usuario + ".tgz"; aAlfa1 = aAlfa - aAlfa1;
   |RDESCOMPRIME aAlfa;
   |RDETAR aAlfa, aAlfa1;

   aAlfa  = aAlfa1 + "tree" + Usuario + ".tgz"; |RFBORRA aAlfa;
   aAlfa  = aAlfa1 + "tree" + Usuario + ".tar"; |RFBORRA aAlfa;
|FPRC;

|PROGRAMA;
   |HAZ Transforma;

   |HAZ Patron210;
   fFecha1 = ~; |HAZ CalAnyTr;

   nComent = 0;
   |ABRE #dsm210dp; |ABRET #dsm210tr;

   |DBASS aBase;   |QBT aBase;
   aAlfa = aBase + "basica/def/agimunic.mas"; |CARGA_DEF aAlfa, rmunici@;
   aAlfa = aBase + "basica/fich/"; |PATH_DAT #rmunici@#aAlfa#;
   |ABRE #rmunici@;

   aAlfa = aBase + "integral/def/dsam0000.mas";
   |XABRE "E", aAlfa, nCanal;
   |SI FSalida ] 0;
      aAlfa  = aBase + "integral/def/dsam0101.mas";
      aAlfa1 = aBase + "integral/def/dsam0100.mas";
      aAlfa2 = aBase + "integral/def/dsam0104.mas";
      aAlfa3 = aBase + "integral/def/dsam0102.mas";
      aAlfaX = aBase + "integral/def/dsam0115.mas";
      |CARGA_DEF aAlfa, repobla@; |CARGA_DEF aAlfa1, reprovi@;
      |CARGA_DEF aAlfa2, rpaises@; |CARGA_DEF aAlfa3, haciend@;
      aAlfa = aBase + "integral/fich/";
      enSwCod = 1;
   |SINO;
      aAlfa  = aBase + "basica/def/agipobla.mas";
      aAlfa1 = aBase + "basica/def/agiprovi.mas";
      aAlfa2 = aBase + "basica/def/agim0016.mas";
      aAlfa3 = aBase + "basica/def/agihacie.mas";
      |CARGA_DEF aAlfa, repobla@; |CARGA_DEF aAlfa1, reprovi@;
      |CARGA_DEF aAlfa2, rpaises@; |CARGA_DEF aAlfa3, haciend@;
      aAlfa = aBase + "basica/fich/";
      enSwCod = 2;
   |FINSI;
   |PATH_DAT #repobla@#aAlfa#; |PATH_DAT #reprovi@#aAlfa#;
   |PATH_DAT #rpaises@#aAlfa#; |PATH_DAT #haciend@#aAlfa#;

   |ABRE #repobla@;
   |ABRE #reprovi@;
   |ABRE #rpaises@;
   |ABRE #haciend@;

   |CLS;
   |CABEZA "Impuesto sobre la renta de no residentes";

   |PINPA #0#0; nPant0 = FSalida;

   aContiene = "";
   |ESPECIFICA "RBASS", aContiene;
   eaUnidadBase = aContiene1;
   aAlfa = eaUnidadBase - "/";
   |SI FSalida ! 0;
      nCalc = ((FSalida / 100) ! 0) + 99;
      eaUnidadBase = eaUnidadBase % nCalc;
   |SINO;
      aAlfa = eaUnidadBase - "\";
      |SI FSalida ! 0;
         nCalc = ((FSalida / 100) ! 0) + 99;
         eaUnidadBase = eaUnidadBase % nCalc;
      |SINO;
         eaUnidadBase = "c:";
      |FINSI;
   |FINSI;
   eaIP = ""; |IP_REMOTO eaIP;

   |SI eaIP ! "";
      aAlfa = eaUnidadBase + "/documentos/"; |RMKDIR aAlfa;
      aAlfa = aAlfa + "/modelos";           |RMKDIR aAlfa;
      aAlfa = aAlfa + "/tmp";               |RMKDIR aAlfa;
   |SINO;
      aAlfa = eaUnidadBase + "/documentos/"; |MKDIR aAlfa;
      aAlfa = aAlfa + "/modelos";           |MKDIR aAlfa;
      aAlfa = aAlfa + "/tmp";               |MKDIR aAlfa;
   |FINSI;

   eaDestino = eaUnidadBase + "/documentos/modelos/tmp/tree" + Usuario + ".txt";
   |DBASE aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "tmp/"; |MKDIR aAlfa;
   aAlfa = aAlfa + "tree" + Usuario + ".txt"; eaOrigen = aAlfa;
   |XABRE "W", aAlfa, nHandle;
   |SI FSalida ] 0;
      aAlfa = "1:Datos personales                  "; |XGRABA nHandle, aAlfa;
      aAlfa = "1,1:Titular               {{DATPET}}"; |XGRABA nHandle, aAlfa;
      aAlfa = "1,2:Conyuge               {{DATPEC}}"; |XGRABA nHandle, aAlfa;
      aAlfa = "2:Inmuebles "; |XGRABA nHandle, aAlfa;
      aAlfa = "2,1:Mantenimiento {{INMUEB}}"; |XGRABA nHandle, aAlfa;
      aAlfa = "2,3:Pase a¤os 2009 y 2010 {{PASEINM}}"; |XGRABA nHandle, aAlfa;
      aAlfa = "3:Modelo 210";                         |XGRABA nHandle, aAlfa;
      aAlfa = "3,1:Entrada de datos {{MOD210}}";      |XGRABA nHandle, aAlfa;
      aAlfa = "3,2:Emision modelo {{EMI210}}";        |XGRABA nHandle, aAlfa;
      aAlfa = "3,3:Historico emisiones {{HIS210}}";   |XGRABA nHandle, aAlfa; ||Comentado
      aAlfa = "4:Modelo 211";                         |XGRABA nHandle, aAlfa;
      aAlfa = "4,1:Entrada de datos {{MOD211}}";      |XGRABA nHandle, aAlfa;
      aAlfa = "4,2:Emision modelo {{EMI211}}";        |XGRABA nHandle, aAlfa;
      aAlfa = "4,3:Historico emisiones {{HIS211}}"; |XGRABA nHandle, aAlfa;   ||Comentado
      aAlfa = "5:Modelo 213";                         |XGRABA nHandle, aAlfa;
      aAlfa = "5,1:Entrada de datos {{MOD213}}";      |XGRABA nHandle, aAlfa;
      aAlfa = "5,2:Emision modelo {{EMI213}}";        |XGRABA nHandle, aAlfa;
      aAlfa = "5,3:Historico emisiones {{HIS213}}";   |XGRABA nHandle, aAlfa; || Comentado
      |XCIERRA nHandle;
   |FINSI;
   |HAZ PasaMenuArbol;

   nPos1 = 2430; nPos2 = 2453;
   |CONTROL_SIMPLE nPant0, "BOTON,{{193}}Valores catastrales por a¤o", nPos1, nPos2, ValorCatastralMasivo;
   nBotonValCatMas = FSalida;

   nPos1 = 2461; nPos2 = 2478;
   |CONTROL_SIMPLE nPant0, "BOTON,{{193}}Nuev&O contribuyente", nPos1, nPos2, NuevoContr;
   nBotonNueCt = FSalida;

   nPos1 = 2480; nPos2 = 2498;
   |CONTROL_SIMPLE nPant0, "BOTON,{{199}}Bo&Rrar contribuyente", nPos1, nPos2, BorraContr;
   nBotonBorCt = FSalida;

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 0702; nPos2 = 2398;
   |LINEAL_SIMPLE #1#dsm210dp, nRango, nPos1, nPos2, NULL, NULL, EvtoGrid0;
   nGrid0 = FSalida;

   nPos1 = 2602; nPos2 = 3398;
   aAlfa = "TREECTRL, Impuesto de la renta no residentes : Modelos oficiales{{" + eaUnidadBase + "/documentos/modelos/tmp/tree" + Usuario + ".txt}}";
   |CONTROL_SIMPLE nPant0, aAlfa, nPos1, nPos2, EvtoTree0;
   nTree0 = FSalida;

   sT_nID   = nTree0;
   sT_nOper = 2;
   sT_aData = "1:";
   |ESPECIFICA "COMMANDCONTROL", sTree;

   |LEE 000#dsm210dp.p;
   |SI FSalida ! 0; |ESTADO_CONTROL nTree0, "DISABLE"; |FINSI;
   |PULSATECLA;

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Salir," + nGrid0;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
   |SIGUE;

   |FIN_CONTROL_WINDOWS nBotonValCatMas;
   |FIN_CONTROL_WINDOWS nBotonNueCt;
   |FIN_CONTROL_WINDOWS nBotonBorCt;

   |FIN_CONTROL_WINDOWS nTree0;
   |DESTRUYECONTROL nGrid0;

   |CIERRA #haciend@; |DESCARGA_DEF #haciend@;
   |CIERRA #rpaises@; |DESCARGA_DEF #rpaises@;
   |CIERRA #reprovi@; |DESCARGA_DEF #reprovi@;
   |CIERRA #repobla@; |DESCARGA_DEF #repobla@;
   |CIERRA #rmunici@; |DESCARGA_DEF #rmunici@;

   |CIERRA #dsm210dp; |CIERRAT #dsm210tr;
|FPRO;
