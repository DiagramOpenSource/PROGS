|FICHEROS;
     dsmom023 #23;
     dsmom024 #24;

     :/basica/def/agitab99 #99;

     program@ #777;
|FIN;

|VARIABLES;
 aAlfa = "";
 aPathModelo  = "";
 aDef         = "";

 nAlguno     = 0;
 &enDEmpresa = 0;
 &enHEmpresa = 0;
 &enDEjer    = 0;
 &enHEjer    = 0;
 &enDModelo  = 0;
 &enHModelo  = 0;

|FIN;

|INCLUYE i_variar;

|| =========================================================================
|PROCESO eLeoImpReal;
     enIngresar  = 0;
     enDevolver  = 0;
     enCompensar = 0;
     enCas21     = 0;
     enCas27     = 0;
     enCas31     = 0;
     enCas34     = 0;
     enImpReal   = 0;

     eaNomDef  = "";
     |SI enModelo = 300; eaNomDef = "dsmod300"; |FINSI;
     |SI enModelo = 303;
         |SI enEjer [ 2013;
             eaNomDef = "dsmod303";
         |FINSI;

         |SI enEjer ] 2014;
             eaNomDef = "dsm30301";
         |FINSI;
     |FINSI;

     |SI enModelo ] 310; |Y enModelo [ 319; enModelo = 310; eaNomDef = "dsmod310"; |FINSI;
     |SI enModelo = 320; eaNomDef = "dsmod320"; |FINSI;
     |SI enModelo = 330; eaNomDef = "dsmod330"; |FINSI;
     |SI enModelo = 332; eaNomDef = "dsmod332"; |FINSI;
     |SI enModelo = 370; eaNomDef = "dsmod370"; |FINSI;
     |SI eaNomDef = ""; |ACABA; |FINSI;

     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/" + eaNomDef + ".mas";
     |CARGA_DEF aDef, program@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + eaNomDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |ABRE #777;
     #777#0 = enEmpresa;
     #777#1 = enEjer;
     #777#2 = enPeriodo;
     #777#3 = enModelo;
     #777#4 = enComplem;
     #777#5 = 00;
     |LEE 000#777=;
     |SI FSalida ! 0;
         |CIERRA #777;
         |DESCARGA_DEF #program@;
         |ACABA;
     |FINSI;

     |SI enModelo = 300; |O enModelo = 320;
      |O enModelo = 330; |O enModelo = 332;

         enImpReal  = #777#56;  ||Casilla 28
         enCas21    = #777#33;
         enCas27    = #777#55;
         enCas31    = #777#59;
         |SI enModelo = 300;
             enCas34    = #777#62;
             enIngresar = #777#65;
             enDevolver = #777#64;
             enCompensar= #777#63;
         |SINO;
             |SI enModelo = 320;
                 enCas34    = #777#64;
                 enIngresar = #777#67;
                 enDevolver = #777#66;
                 enCompensar= #777#65;
             |SINO;
                 enCas34    = #777#66;
                 enIngresar = #777#69;
                 enDevolver = #777#68;
                 enCompensar= #777#67;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI enModelo = 303;
         |SI eaNomDef = "dsmod303";
             enImpReal  = #777#50;
             enCas21    = #777#33;
             enCas27    = #777#49;
             enCas31    = #777#53;
             enCas34    = #777#60;
             enIngresar = #777#63;
             enDevolver = #777#62;
             enCompensar= #777#61;
         |FINSI;

         |SI eaNomDef = "dsm30301";
             enCas21    = #777#42 + #777#54;
             enCas27    = #777#60 + #777#72;
             enCas31    = #777#84;
             enCas34    = #777#86;
             enImpReal  = #777#81;
             enIngresar = #777#91;
             enDevolver = #777#90;
             enCompensar= #777#89;
         |FINSI;
     |FINSI;

     |SI enModelo = 310;
         enIngresar = #777#40;
         enDevolver = #777#39;
         enCompensar= #777#38;
         enImpReal  = #777#34;
         enCas21    = #777#30;
         enCas27    = #777#33;
         enCas31    = #777#35;
         enCas34    = #777#36;
     |FINSI;

     |SI enModelo =  370;
         enCas21    = #777#75;
         enCas27    = #777#78;
         enCas31    = #777#81;
         enCas34    = #777#82;
         enImpReal  = #777#80;
         enIngresar = #777#86;
         enDevolver = #777#85;
         enCompensar= #777#84;
     |FINSI;

     |CIERRA #777;
     |DESCARGA_DEF #program@;
|FPRC;

|PROCESO total;
 nAlguno = 1;
 #23#4 = #23#4 + #24#9;
 #23#5 = #23#5 + #24#10;
 #23#6 = #23#4 - #23#5;
|FPRC;

|DEFBUCLE total;
 #24#1;
 ;
 #23#0, #23#1, 00, #23#2, 00;
 #23#0, #23#1, 99, #23#2, 99;
 ;
 NULL, total;
|FIN;

|PROCESO ReCalcula;

   enModelo = #23#2;
   aAlfa    = #23#3; |QBF aAlfa;
   |SI aAlfa = "";
       |HAZ LeoModelo;
       #23#3 = #99#1;
   |FINSI;

   nAlguno = 0;
   #23#4 = 0;
   #23#5 = 0;
   #23#6 = 0;
   |BUCLE total;
   |SI nAlguno = 1;
       |GRABA 020#23a;
   |SINO;
       |BORRA 020#23a;
   |FINSI;
   |LIBERA #23;
|FPRC;

|DEFBUCLE ReCalcula;
     #23#1;
     ;
     enDEmpresa, enDEjer, enDModelo;
     enHEmpresa, enHEjer, enHModelo;
     be;
     NULL, ReCalcula;
|FIN;

|PROCESO ReCalculaHis;
  |BUCLE ReCalcula;
|FPRC;

|PROCESO LeoModelo;
     |ABRE #99;
     #99#0 = enModelo;
     |LEE 040#99=;
     |SI FSalida ! 0;  |DDEFECTO #99;  |FINSI;
     |CIERRA #99;
|FPRC;
