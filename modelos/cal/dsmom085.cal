|FICHEROS;
     dsmom085 #85;
     dsmom086 #86,MANTE;
     dsmom087 #87;

     dsmow117 #117,MANTE;
     dsmow118 #118,MANTE;
     dsmow125 #125,MANTE;
     dsmow126 #126,MANTE;

     :/basica/def/agicen14 #114;
|FIN;

|VARIABLES;
   aParam     = "";
   &enSwHay   = 0;
   &eaFitx117 = "";
   &eaFitx118 = "";
   &eaFitx125 = "";
   &eaFitx126 = "";
   aPeriodo   = "";
   nPeriodo   = 0;
   nComplem   = 0;
   nModelo    = 0;
   nAcumulado = 0;
   nAcumulad1 = 0;
   nPer       = 0;
   nSwComplem = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO ClaveBaja125;
 #125#0 = #126#0;
 #125#1 = #126#1;
 #125#2 = #126#2;
 #125#3 = 00;
|FPRC;

|PROCESO ClaveAlta125;
 #125#0 = #126#0;
 #125#1 = #126#1;
 #125#2 = #126#2;
 #125#3 = 99;
|FPRC;

|PROCESO Verel125; |TIPO 7;
    |MENSA "    <F2> Ver Periodos";

    |ENTLINEAL #1#125, -4, 7, 20, 0, ClaveBaja125, ClaveAlta125;
|FPRC;

|PROCESO Entrarel125; |TIPO 11;
  |SI FSalida = 10;
      |ENTLINEAL #1#125, -4, 4, 20, 0, ClaveBaja125, ClaveAlta125;
  |FINSI;
|FPRC;


|PROCESO ClaveBaja118;
 #118#0 = #86#0;
 #118#1 = #86#1;
 #118#2 = #86#2;
 #118#3 = 00;
|FPRC;

|PROCESO ClaveAlta118;
 #118#0 = #86#0;
 #118#1 = #86#1;
 #118#2 = #86#2;
 #118#3 = 99;
|FPRC;

|PROCESO Verel118; |TIPO 7;
    |ENTLINEAL #1#118, -4, 7, 20, 0, ClaveBaja118, ClaveAlta118;
|FPRC;

|PROCESO Entrarel118; |TIPO 11;
  |SI FSalida = 10;
      |ENTLINEAL #1#118, -4, 4, 20, 0, ClaveBaja118, ClaveAlta118;
  |FINSI;
|FPRC;


|PROCESO Baja126;
 #126#0 = enEmpresa;
 #126#1 = enEjer;
 #126#2 = 00;
|FPRC;

|PROCESO Alta126;
 #126#0 = enEmpresa;
 #126#1 = enEjer;
 #126#2 = 99;
|FPRC;


|PROCESO Baja86;
 #86#0 = enEmpresa;
 #86#1 = enEjer;
 #86#2 = 00;
|FPRC;

|PROCESO Alta86;
 #86#0 = enEmpresa;
 #86#1 = enEjer;
 #86#2 = 99;
|FPRC;

|PROCESO Entrarel86; |TIPO 11;
  |SI FSalida = 10;
      |PUSHV 0801 2380;
      |PINPA #0#86;
      |ENTLINEAL #1#86, -3, 4, 22, 0, Baja86, Alta86;
      |POPV;
  |FINSI;
  |SI FSalida = 11;
      |PUSHV 0801 2380;
      |PINPA #0#125;
      |ENTLINEAL #1#126, -3, 4, 22, 0, Baja126, Alta126;
      |POPV;
  |FINSI;
|FPRC;

|PROCESO ClaveBaja117;
   #117#0 = #85#0;
   #117#1 = #85#1;
   #117#2 = 01;
|FPRC;

|PROCESO ClaveAlta117;
   #117#0 = #85#0;
   #117#1 = #85#1;
   #117#2 = 99;
|FPRC;

|PROCESO DesPeriodo;
  aPeriodo = "";
  |SI nPeriodo =  1;  aPeriodo = "ENERO     "; |FINSI;
  |SI nPeriodo =  2;  aPeriodo = "FEBRERO   "; |FINSI;
  |SI nPeriodo =  3;  aPeriodo = "MARZO     "; |FINSI;
  |SI nPeriodo =  4;  aPeriodo = "ABRIL     "; |FINSI;
  |SI nPeriodo =  5;  aPeriodo = "MAYO      "; |FINSI;
  |SI nPeriodo =  6;  aPeriodo = "JUNIO     "; |FINSI;
  |SI nPeriodo =  7;  aPeriodo = "JULIO     "; |FINSI;
  |SI nPeriodo =  8;  aPeriodo = "AGOSTO    "; |FINSI;
  |SI nPeriodo =  9;  aPeriodo = "SEPTIEMBRE"; |FINSI;
  |SI nPeriodo = 10;  aPeriodo = "OCTUBRE   "; |FINSI;
  |SI nPeriodo = 11;  aPeriodo = "NOVIMBRE  "; |FINSI;
  |SI nPeriodo = 12;  aPeriodo = "DICIEMBRE "; |FINSI;
  |SI nPeriodo = 99;  aPeriodo = "ANUAL     "; |FINSI;
|FPRC;

|PROCESO PorPeriodos;
  #125#0 = #126#0;
  #125#1 = #126#1;
  #125#2 = #126#2;
  #125#3 = #118#3;
  |LEE 141#125=;
  |SI FSalida ! 0;
      |DDEFECTO #125;
      #125#0 = #126#0;
      #125#1 = #126#1;
      #125#2 = #126#2;
      #125#3 = #118#3;
      #125#4 = #118#4;
      #125#6 = #126#5;
      |SI #125#3 = 12; #125#6 = #126#6; |FINSI;
      |GRABA 020#125b;
  |FINSI;
  #125#5  = #125#5  + #118#5;
  #125#7  = #125#7  + #118#7;
  #125#8  = #125#8  + #118#8;
  #125#9  = #125#5  - #125#7;
  #125#10 = #125#10 + #118#10;
  |GRABA 020#125a;
  |LIBERA #125;
|FPRC;

|DEFBUCLE PorPeriodos;
  #118#1;
  ;
  #86#0, #86#1, #86#2, 00;
  #86#0, #86#1, #86#2, 99;
  ;
  NULL, PorPeriodos;
|FIN;

|PROCESO LeeLosSectores;
   #126#0 = #86#0;
   #126#1 = #86#1;
   #126#2 = #86#15;
   |LEE 001#126=;
   |SI FSalida ! 0;
       |DDEFECTO #126;
       #126#0 = #86#0;
       #126#1 = #86#1;
       #126#2 = #86#15;
       #126#3 = "SECTOR: " + #126#2;
       #126#5 = #86#5;
       #126#6 = #86#6;
       |GRABA 020#126c;
   |FINSI;
   #126#7  = #126#7  + #86#7;
   #126#8  = #126#8  + #86#8;
   #126#9  = #126#9  + #86#9;
   #126#10 = #126#10 + #86#10;
   #126#11 = #126#11 + #86#11;
   #126#12 = #126#12 + #86#12;
   #126#13 = #126#13 + #86#13;
   #126#14 = #126#14 + #86#14;
   #126#15 = #126#15 + #86#18;
   |GRABA 020#126a;
   |LIBERA #126;

   |BUCLE PorPeriodos;
|FPRC;

|DEFBUCLE LeeLosSectores;
  #86#1;
  ;
  #85#0, #85#1, 00;
  #85#0, #85#1, 99;
  ;
  NULL, LeeLosSectores;
|FIN;

|PROCESO  Acumular;
  nAcumulad1 = nAcumulad1 + #118#7;
|FPRC;

|DEFBUCLE Acumular;
  #118#1;
  ;
  #86#0, #86#1, #86#2, 1;
  #86#0, #86#1, #86#2, nPer;
  ;
  NULL, Acumular;
|FIN;

|PROCESO LeeLosPeriodos;
   nPer       = nPeriodo - 1;
   nAcumulad1 = 0;
   |CIERRA #118;
   |BUCLE Acumular;

   |ABRE #118;
   #118#0 = #86#0;
   #118#1 = #86#1;
   #118#2 = #86#2;
   #118#3 = nPeriodo;
   |LEE 001#118=;
   |SI FSalida ! 0;
       |DDEFECTO #118;
       #118#0 = #86#0;
       #118#1 = #86#1;
       #118#2 = #86#2;
       #118#3 = nPeriodo;
       nPeriodo = #118#3;
       |HAZ DesPeriodo;
       #118#4 = aPeriodo;
       #118#6 = #86#5;
       |SI nPeriodo = 12; #118#6 = #86#6; |FINSI;
       |GRABA 020#118c;
   |FINSI;
   #118#8 = nAcumulad1;
   |GRABA 020#118a;
   |LIBERA #118;
|FPRC;

|DEFBUCLE LeeLosPeriodos;
  #86#1;
  ;
  #85#0, #85#1, 00;
  #85#0, #85#1, 99;
  ;
  NULL, LeeLosPeriodos;
|FIN;

|PROCESO LeeDsmom087;

  #117#0 = #87#0;
  #117#1 = #87#1;
  #117#2 = #87#2;
  |LEE 141#117=;
  |SI FSalida ! 0;
      |DDEFECTO #117;
      #117#0 = #87#0;
      #117#1 = #87#1;
      #117#2 = #87#2;
      nPeriodo = #117#2;
      |HAZ DesPeriodo;
      #117#3 = aPeriodo;
      #117#5 = #85#16;
      |SI #87#2 = 12; #117#5 = #85#17; |FINSI;
      #117#7 = nAcumulado;
      |GRABA 020#117b;
  |FINSI;
  #117#4 = #117#4 + #87#8;
  #117#6 = #117#6 + #87#9;
  #117#8 = #117#4 - #117#6;
  |GRABA 020#117a;
  |LIBERA #117;
  nAcumulado = nAcumulado + #87#9;
  enSwHay = 1;
  #118#0 = #87#0;
  #118#1 = #87#1;
  #118#2 = #87#5;
  #118#3 = #87#2;
  |LEE 141#118=;
  |SI FSalida ! 0;
      |DDEFECTO #118;
      #118#0 = #87#0;
      #118#1 = #87#1;
      #118#2 = #87#5;
      #118#3 = #87#2;
      nPeriodo = #118#3;
      |HAZ DesPeriodo;
      #118#4 = aPeriodo;
      #118#6 = #87#11;
      |GRABA 020#118b;
  |FINSI;
  #118#5 = #118#5 + #87#12;
  #118#7 = #118#7 + #87#13;
  #118#9 = #118#5 - #118#7;
  |GRABA 020#118a;
  |LIBERA #118;

  |SI #87#40 ! 0; |O #87#42 ! 0; |O #87#44 ! 0; |O #87#46 ! 0;
    |O  #87#48 ! 0; |O #87#50 ! 0; |O #87#52 ! 0;
       #118#0 = #87#0;
       #118#1 = #87#1;
       #118#2 = 00;
       #118#3 = #87#2;
       |LEE 141#118=;
       |SI FSalida ! 0;
           |DDEFECTO #118;
           #118#0 = #87#0;
           #118#1 = #87#1;
           #118#2 = 00;
           #118#3 = #87#2;
           nPeriodo = #118#3;
           |HAZ DesPeriodo;
           #118#4 = aPeriodo;
           #118#6 = #87#36;
          |GRABA 020#118b;
      |FINSI;
      #118#5 = #118#5 + #87#37;
      #118#7 = #118#7 + #87#38;
      #118#9 = #118#5 - #118#7;
      |GRABA 020#118a;
      |LIBERA #118;

  |FINSI;
|FPRC;

|DEFBUCLE LeeDsmom087;
  #87#1;
  ;
  #85#0, #85#1, nPeriodo, nModelo, nComplem, 00, 0, 00;
  #85#0, #85#1, nPeriodo, nModelo, nComplem, 99, 9, 99;
  e;
  NULL, LeeDsmom087;
|FIN;

|PROCESO MiroModelo;
        nComplem = -1;
        #87#0 = #85#0;
        #87#1 = #85#1;
        #87#2 = nPeriodo;
        #87#3 = nModelo;
        #87#4 = 99;
        #87#5 = 0;
        #87#6 = 0;
        #87#7 = 0;
        |LEE 040#87];
        |SI FSalida = 0;
            |LEE 040#87a;
        |SINO;
            |LEE 040#87u;
        |FINSI;
        |SI FSalida = 0; |Y #87#0 = #85#0; |Y #87#1 = #85#1;
            |Y #87#2 = nPeriodo; |Y #87#3 = nModelo;
               nComplem = #87#4;
        |FINSI;

        |SI nComplem ! -1;
            |SI nComplem ! 0; nSwComplem = 1; |FINSI;
            |CIERRA #87;
            |BUCLE LeeDsmom087;
            |ABRE #87;

            |BUCLE LeeLosPeriodos;
        |FINSI;
|FPRC;

|PROCESO eMontarw117;
  |NOME_DAT #117 eaFitx117;  |DELINDEX #117;
  |NOME_DAT #118 eaFitx118;  |DELINDEX #118;
  |NOME_DAT #125 eaFitx125;  |DELINDEX #125;
  |NOME_DAT #126 eaFitx126;  |DELINDEX #126;

  nAcumulado = 0;
  |ABRE #117;
  |ABRE #118;
  |ABRE #87;
  |PARA nPeriodo = 1; |SI nPeriodo [ 12; |HACIENDO nPeriodo = nPeriodo + 1;
        nModelo = 303; |HAZ MiroModelo;
        nModelo = 322; |HAZ MiroModelo;
        nModelo = 370; |HAZ MiroModelo;
  |SIGUE;
  |CIERRA #87;
  |CIERRA #118;
  |CIERRA #117;

  |ABRE #126;
  |ABRE #125;
  |BUCLE LeeLosSectores;
  |CIERRA #125;
  |CIERRA #126;
|FPRC;

|PROGRAMA;

     aParam = PARAMETRO; |QBF aParam;
     |SI aParam = "";
          |HAZ LeeCtrlProrr;
          |SI enSwProrr = 2;
              |MENAV "    SIN PRORRATA";
              |ACABA;
          |FINSI;

          eaNomDef = "dsmom085";

          |CABEZA "Prorratas";

          |ABRE #85;
          #85#0 = enEmpresa;
          #85#1 = enEjer;
          |LEE 101#85=;
          |SI FSalida ! 0;
              |MENAV "    EMPRESA SIN CALCULO DE PRORRATA";
              |LIBERA #85;
              |CIERRA #85;
              |ACABA;
          |FINSI;

          |PINPA #0#85;
          |PINDA #0#85;

          eaFitx117 = "7x" + Usuario;
          eaFitx118 = "8x" + Usuario;
          eaFitx125 = "2x" + Usuario;
          eaFitx126 = "6x" + Usuario;
          |HAZ eMontarw117;

          |SI nSwComplem = 1;
              |PINTA 0801, "Calculos Incluidos Complementarias";
          |FINSI;
          |ENTLINEAL #1#117, -3, 4, 20,0, ClaveBaja117, ClaveAlta117;
          |LIBERA #85;
          |CIERRA #85;
          |DELINDEX #117;
          |DELINDEX #118;
          |DELINDEX #125;
          |DELINDEX #126;
     |SINO;
          enSwHay = 0;
          |HAZ LeeCtrlProrr;
          |SI enSwProrr = 2;  |ACABA;  |FINSI;

          |ABRE #85;
          #85#0 = enEmpresa;
          #85#1 = enEjer;
          |LEE 101#85=;
          |SI FSalida ! 0;
              |LIBERA #85;
              |CIERRA #85;
              |ACABA;
          |FINSI;

          eaFitx117 = "7x" + Usuario;
          eaFitx118 = "8x" + Usuario;
          eaFitx125 = "2x" + Usuario;
          eaFitx126 = "6x" + Usuario;
          |HAZ eMontarw117;
          |LIBERA #85;
          |CIERRA #85;
     |FINSI;
|FPRO;
