|FICHEROS;
     dsmoy062 #0;

     dsmom004 #4;
     dsmod309 #309;

     dsmow137 #1099;

     :/integral/def/dsam0009 #109;
     :/basica/def/agitab99 #199;
     :/contasoc/def/isacceso #200;
     :/contasoc/def/isom9000 #202;

     &clientes@ #715;
|FIN;

|VARIABLES;
     nCampo       = 0;
     nCampo1      = 0;
     nMod         = 0;
     nCodModelo   = 0;
     nModelo      = 0;
     nModelo1     = 0;
     nWord        = 0;
     nEmpresas    = 0;
     nAscci       = 0;
     nSw          = 0;
     nEstado      = 0;
     nIngreso     = 0;

     fFecha       = @;

     aBlancs      = "";
     aZetas       = "";

     aAlfa        = "";
     aAlfa1       = "";
     aFichero     = "";
     aBase        = "";
     aOrigen      = "";
     aDestino     = "";
     aIPRemoto    = "";
     aPlaning     = "";
     aLetra       = "";
     aDocumento   = "";
     aDef         = "";
     aTitulo      = "";
     aPeriodo     = "";

     nHay         = 0;
     nAntAgen     = 0;
     nPrimero     = 0;

     &eaNomEnt    = "";
     &eaNomOfi    = "";
     &eaCuenta    = "";
|FIN;

|INCLUYE i_variar;

|PROCESO Parrilla;
     |SI #0#0 = 0;
         #0#0 = 0;  |PINTA #0#0;
         #0#1 = 0;  |PINTA #0#1;  |C_M #0#1, 1, "N";
         |PARA nCampo = 2;  |SI nCampo [ 37;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |C_M #0#1, 1, "S";
         |PARA nCampo = 2;  |SI nCampo [ 37;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 37;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 37;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Periodo;
     |SI #0#38 = 1;   #0#39 = "ENERO     ";  |FINSI;
     |SI #0#38 = 2;   #0#39 = "FEBRERO   ";  |FINSI;
     |SI #0#38 = 3;   #0#39 = "MARZO     ";  |FINSI;
     |SI #0#38 = 4;   #0#39 = "ABRIL     ";  |FINSI;
     |SI #0#38 = 5;   #0#39 = "MAYO      ";  |FINSI;
     |SI #0#38 = 6;   #0#39 = "JUNIO     ";  |FINSI;
     |SI #0#38 = 7;   #0#39 = "JULIO     ";  |FINSI;
     |SI #0#38 = 8;   #0#39 = "AGOSTO    ";  |FINSI;
     |SI #0#38 = 9;   #0#39 = "SEPTIEMBRE";  |FINSI;
     |SI #0#38 = 10;  #0#39 = "OCTUBRE   ";  |FINSI;
     |SI #0#38 = 11;  #0#39 = "NOVIEMBRE ";  |FINSI;
     |SI #0#38 = 12;  #0#39 = "DICIEMBRE ";  |FINSI;
     |SI #0#38 = 99;  #0#39 = "ANUAL     ";  |FINSI;

     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#40  = aAlfa;

     |PINTA #0#39;
     |PINTA #0#40;
|FPRC;

|PROCESO Modelo66;  |TIPO 66;
     |ABRE #199;
     #199#0 = #0Campo;
     |LEE 040#199=;
     |SI FSalida ! 0;  |DDEFECTO #199;  |FINSI;

     |CONSULTA_CLAVE #1#199;
     |SI FSalida = 0;
         #0Campo = #199#0;   |PINTA #0Campo;
     |FINSI;
     |CIERRA #199;
|FPRC;

|PROCESO Modelo;
     nCampo1 = Campo + 1;
     |SI #0Campo = 0;
         #0nCampo1 = "";
         |PINTA #0nCampo1;
         |ACABA;
     |FINSI;

     |ABRE #199;
     #199#0 = #0Campo;
     |LEE 040#199=;
     |SI FSalida ! 0;  |DDEFECTO #199;  |FINSI;
     |CIERRA #199;

     |SI #0Campo = 180;  |O #0Campo = 190;  |O #0Campo = 390;  |O #0Campo = 392;
      |O #0Campo = 193;  |O #0Campo = 184;  |O #0Campo = 296;  |O #0Campo = 187;
      |O #0Campo = 187;
         #199#4 = "S";
     |FINSI;

     |SI #0Campo = 100;  |O #0Campo = 101;  |O #0Campo = 714;  |O #0Campo = 201;
         |MENAV "0000 Modelo no incluido.";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #0Campo = 200;  |O #0Campo = 202;
         #199#4 = "S";
     |FINSI;

     |SI #199#4 ! "S";
         |MENAV "     Modelo sin Activar.";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #0Campo = 347;  |O #0Campo = 180;  |O #0Campo = 190; |O #0Campo = 390;
      |O #0Campo = 392;  |O #0Campo = 193;  |O #0Campo = 184; |O #0Campo = 296;
      |O #0Campo = 187;
         |SI #0#38 ! 99;
             |MENAV "0000 El Periodo del Modelo no corresponde con el Periodo Seleccionado.";
             |ERROR;
         |FINSI;
     |FINSI;

     #0nCampo1 = #199#1;  |PINTA #0nCampo1;
|FPRC;

|PROCESO dsmom004;
     |SI #0#75 = "N";
         |SI #4#15 > 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#75 = "P";
         |SI #4#15 [ 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#77 = "P";
         |SI #4#19 ! "                ";  |ACABA;  |FINSI;
         |SI #4#25 ! "             ";     |ACABA;  |FINSI;
     |FINSI;

     |SI #0#77 = "I";
         |SI #4#19 = "                ";   |Y #4#25 = "             ";
             |ACABA;
         |FINSI;
     |FINSI;

     enCodCli = #4#0;
     |HAZ LeePersona;

     |SI enSwDeDonde = 1;
         |SI #715#72 < #0#78;  |O #715#72 > #0#79;
             |ACABA;
         |FINSI;
     |FINSI;

     enModelo = #4#3;  enForzar = 1;  |HAZ CogeDatosBancos;

     |SI #0#76 ! "T";
         |SI eaFormaPago ! #0#76;  |ACABA;  |FINSI;
     |FINSI;

     |DDEFECTO #1099;

     #1099#0  = #4#0;
     #1099#1  = #4#1;
     #1099#2  = #4#2;
     #1099#3  = #4#3;
     #1099#4  = #4#4;
     #1099#5  = 0;
     #1099#6  = 0;
     #1099#7  = #715#1;

     aAlfa    = #4#25;  |QBF aAlfa;
     |SI aAlfa ! "";  #1099#8  = #4#25;  |FINSI;

     aAlfa    = #4#19;  |QBF aAlfa;
     |SI aAlfa ! "";  #1099#8  = #4#19;  |FINSI;

     #1099#9  = #715#3;
     #1099#10 = "PENDIENTE";

     |SI #4#7  = "X";  #1099#10 = "ELABORADO";  |FINSI;
     |SI #4#9  = "X";  #1099#10 = "IMPRESO";    |FINSI;
     |SI #4#11 = "X";  #1099#10 = "REMESADO";   |FINSI;
     |SI #4#13 = "X";  #1099#10 = "ARCHIVADO";  |FINSI;

     |SI #0#43 = "P";
         |SI #1099#10 ! "PENDIENTE ";  |ACABA;  |FINSI;
     |FINSI;

     #1099#11 = #4#15;

     |SI eaFormaPago = "1";  #1099#12 = "EFECTIVO";              |FINSI;
     |SI eaFormaPago = "2";  #1099#12 = "ADEUDO EN CUENTA";      |FINSI;
     |SI eaFormaPago = "3";  #1099#12 = "DOMICILIACION";         |FINSI;
     |SI eaFormaPago = "4";  #1099#12 = "APLAZAMIENTO";          |FINSI;
     |SI eaFormaPago = "5";  #1099#12 = "APLAZAMIENTO+INGRESO";  |FINSI;

     |SI eaFormaPago ! "1";
         #1099#13 = eaNomEnt;
         #1099#14 = eaEntidad;
         #1099#15 = eaOficina;
         #1099#16 = eaDC;
         #1099#17 = eaCuenta;
     |FINSI;

     #1099#18 = aTitulo;

     |GRABA 020#1099.n;
     nHay = 1;
|FPRC;

|DEFBUCLE dsmom004;
     #4#1;
     ;
     #0#0, #0#40, #0#38, nCodModelo, 00;
     #0#1, #0#40, #0#38, nCodModelo, 99;
     ;
     NULL, dsmom004;
|FIN;

|PROCESO dsmod309;
     |SI #0#75 = "N";
         |SI #309#18 > 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#75 = "P";
         |SI #309#18 < 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#77 = "P";
         |SI #309#73 ! "                ";  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#77 = "I";
         |SI #309#73 = "                ";  |ACABA;  |FINSI;
     |FINSI;

     enCodCli = #309#0;
     |HAZ LeePersona;

     enModelo = #4#3;  enForzar = 1;  |HAZ CogeDatosBancos;

     |SI #0#76 ! "T";
         |SI eaFormaPago ! #0#76;  |ACABA;  |FINSI;
     |FINSI;

     |DDEFECTO #1099;

     #1099#0  = #309#0;
     #1099#1  = #309#2;
     #1099#2  = #309#3;
     #1099#3  = 309;
     #1099#4  = #309#4;
     #1099#5  = #309#1;
     #1099#6  = #309#5;
     #1099#7  = #715#1;
     #1099#8  = #309#73;
     #1099#9  = #715#3;
     #1099#10 = "PENDIENTE";

     |SI #309#9  = "X";  #1099#10 = "ELABORADO";  |FINSI;
     |SI #309#11 = "X";  #1099#10 = "IMPRESO";    |FINSI;
     |SI #309#13 = "X";  #1099#10 = "REMESADO";   |FINSI;
     |SI #309#16 = "X";  #1099#10 = "ARCHIVADO";  |FINSI;

     #1099#11 = #309#18;

     |SI eaFormaPago = "1";  #1099#12 = "EFECTIVO";              |FINSI;
     |SI eaFormaPago = "2";  #1099#12 = "ADEUDO EN CUENTA";      |FINSI;
     |SI eaFormaPago = "3";  #1099#12 = "DOMICILIACION";         |FINSI;
     |SI eaFormaPago = "4";  #1099#12 = "APLAZAMIENTO";          |FINSI;
     |SI eaFormaPago = "5";  #1099#12 = "APLAZAMIENTO+INGRESO";  |FINSI;

     |SI eaFormaPago ! "1";
         #1099#13 = eaNomEnt;
         #1099#14 = eaEntidad;
         #1099#15 = eaOficina;
         #1099#16 = eaDC;
         #1099#17 = eaCuenta;
     |FINSI;

     #1099#18 = aTitulo;

     |GRABA 020#1099.n;
     nHay = 1;
|FPRC;

|DEFBUCLE dsmod309;
     #309#1;
     ;
     #0#0, 01, #0#40, #0#38, 00, 01;
     #0#1, 98, #0#40, #0#38, 99, 99;
     ;
     NULL, dsmod309;
|FIN;

|PROCESO isacceso;
     |SI #0#75 = "N";
         |SI #200#8 > 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#75 = "P";
         |SI #200#8 [ 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#77 = "P";
         |SI #200#7 ! "                ";  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#77 = "I";
         |SI #200#7 = "                ";
             |ACABA;
         |FINSI;
     |FINSI;

     enCodCli = #200#0;
     |HAZ LeePersona;

     enModelo = 200;  enForzar = 1;  |HAZ CogeDatosBancos;

     |SI #0#76 ! "T";
         |SI eaFormaPago ! #0#76;  |ACABA;  |FINSI;
     |FINSI;

     |DDEFECTO #1099;

     #1099#0  = #200#0;
     #1099#1  = #200#1;
     #1099#2  = 99;
     #1099#3  = 200;
     #1099#4  = 0;
     #1099#5  = 0;
     #1099#6  = 0;
     #1099#7  = #715#1;
     #1099#8  = #200#7;
     #1099#9  = #715#3;
     #1099#10 = "PENDIENTE";

     |SI #200#6 = "S";  #1099#10 = "IMPRESO";    |FINSI;

     |SI #0#43 = "P";
         |SI #1099#10 ! "PENDIENTE ";  |ACABA;  |FINSI;
     |FINSI;

     #1099#11 = #200#8;

     |SI eaFormaPago = "1";  #1099#12 = "EFECTIVO";              |FINSI;
     |SI eaFormaPago = "2";  #1099#12 = "ADEUDO EN CUENTA";      |FINSI;
     |SI eaFormaPago = "3";  #1099#12 = "DOMICILIACION";         |FINSI;
     |SI eaFormaPago = "4";  #1099#12 = "APLAZAMIENTO";          |FINSI;
     |SI eaFormaPago = "5";  #1099#12 = "APLAZAMIENTO+INGRESO";  |FINSI;

     |SI eaFormaPago ! "1";
         #1099#13 = eaNomEnt;
         #1099#14 = eaEntidad;
         #1099#15 = eaOficina;
         #1099#16 = eaDC;
         #1099#17 = eaCuenta;
     |FINSI;

     #1099#18 = aTitulo;

     |GRABA 020#1099.n;
     nHay = 1;
|FPRC;

|DEFBUCLE isacceso;
     #200#1;
     ;
     #0#40, #0#0;
     #0#40, #0#1;
     ;
     NULL, isacceso;
|FIN;

|PROCESO isom9000;
     nIngreso = #202#14 + #202#34;

     |SI #0#75 = "N";
         |SI nIngreso > 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#75 = "P";
         |SI nIngreso [ 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#77 = "P";
         |SI #202#9 ! "                ";  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#77 = "I";
         |SI #202#9 = "                ";
             |ACABA;
         |FINSI;
     |FINSI;

     enCodCli = #202#0;
     |HAZ LeePersona;

     enModelo = 202;  enForzar = 1;  |HAZ CogeDatosBancos;

     |SI #0#76 ! "T";
         |SI eaFormaPago ! #0#76;  |ACABA;  |FINSI;
     |FINSI;

     |DDEFECTO #1099;

     #1099#0  = #202#0;
     #1099#1  = #202#1;
     #1099#2  = aPeriodo;
     #1099#3  = 202;
     #1099#4  = #202#3;
     #1099#5  = 0;
     #1099#6  = 0;
     #1099#7  = #715#1;
     #1099#8  = #202#9;
     #1099#9  = #715#3;
     #1099#10 = "PENDIENTE";

     |SI #202#8 = "S";  #1099#10 = "IMPRESO";    |FINSI;

     |SI #0#43 = "P";
         |SI #1099#10 ! "PENDIENTE ";  |ACABA;  |FINSI;
     |FINSI;

     #1099#11 = nIngreso;

     |SI eaFormaPago = "1";  #1099#12 = "EFECTIVO";              |FINSI;
     |SI eaFormaPago = "2";  #1099#12 = "ADEUDO EN CUENTA";      |FINSI;
     |SI eaFormaPago = "3";  #1099#12 = "DOMICILIACION";         |FINSI;
     |SI eaFormaPago = "4";  #1099#12 = "APLAZAMIENTO";          |FINSI;
     |SI eaFormaPago = "5";  #1099#12 = "APLAZAMIENTO+INGRESO";  |FINSI;

     |SI eaFormaPago ! "1";
         #1099#13 = eaNomEnt;
         #1099#14 = eaEntidad;
         #1099#15 = eaOficina;
         #1099#16 = eaDC;
         #1099#17 = eaCuenta;
     |FINSI;

     #1099#18 = aTitulo;

     |GRABA 020#1099.n;
     nHay = 1;
|FPRC;

|DEFBUCLE isom9000;
     #202#1;
     ;
     #0#0, #0#40, aPeriodo, 00;
     #0#1, #0#40, aPeriodo, 99;
     ;
     NULL, isom9000;
|FIN;

|PROCESO Imprimirlo;
   |PRINT;
|FPRC;

|DEFBUCLE Imprimir1;
   #1099#1;
   ;
   00001, #0#40, 00, nCodModelo, 00, 00, 00;
   99999, #0#40, 99, nCodModelo, 99, 99, 99;
   ;
   NULL, Imprimirlo;
|FIN;

|DEFBUCLE Imprimir2;
    #1099#2;
     ;
     "            ", #0#40, 00, nCodModelo, 00, 00, 00;
     "zzzzzzzzzzzz", #0#40, 99, nCodModelo, 99, 99, 99;
     ;
     NULL, Imprimirlo;
|FIN;

|DEFBUCLE Imprimir3;
    #1099#3;
     ;
     aBlancs, 00001, #0#40, 00, nCodModelo, 00, 00, 00;
     aZetas,  99999, #0#40, 99, nCodModelo, 99, 99, 99;
     ;
     NULL, Imprimirlo;
|FIN;

|PROCESO ElProceso;

     nHay = 0;

     |ABRE #1099;
     |SI nCodModelo = 309;
         |BUCLE dsmod309;
     |FINSI;

     |SI nCodModelo = 200;
         |BUCLE isacceso;
     |FINSI;

     |SI nCodModelo = 202;
         |SI #0#38 = 1;  aPeriodo = "1P";  |FINSI;
         |SI #0#38 = 2;  aPeriodo = "2P";  |FINSI;
         |SI #0#38 = 3;  aPeriodo = "3P";  |FINSI;

         |BUCLE isom9000;
     |FINSI;

     |SI nCodModelo ! 309; |Y nCodModelo ! 200; |Y nCodModelo ! 202;
         |BUCLE dsmom004;
     |FINSI;
     |CIERRA #1099;

     |SI nHay ! 0;
         |SI #0#42 = 1; |BUCLE Imprimir1; |FINSI;
         |SI #0#42 = 2; |BUCLE Imprimir3; |FINSI;
         |PIEINF;
     |FINSI;
     |DELINDEX #1099;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     aBlancs = " " * 40;
     aZetas  = "z" * 40;

     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida ! 0;
         |MENAV "0000 No tiene instalada Impresora CrystalReport, pongase en contacto con su Administrador";
         |ACABA;
     |FINSI;

     |INFOR "dsmoy062";
     |SI FSalida ! 0;
         |FINIMP;
         |ACABA;
     |FINSI;

     aFichero = ("0t" + Usuario) % 108;
     |NOME_DAT #dsmow137#aFichero#;
     |DELINDEX #dsmow137;

     |PARA nModelo = 45;  |SI nModelo [ 73;  |HACIENDO nModelo = nModelo + 2;
           |SI #0nModelo ! 0;
               nModelo1   = nModelo + 1;
               nCodModelo = #0nModelo;
               aTitulo    = #0nModelo1;

               |SI #0#0 ! 0;
                   |HAZ ElProceso;
               |SINO;
                   |PARA nCampo = 2;  |SI nCampo [ 37;  |HACIENDO nCampo = nCampo + 1;
                         |SI #0nCampo ! 0;
                             #0#0 = #0nCampo;
                             #0#1 = #0nCampo;
                             |HAZ ElProceso;
                         |FINSI;
                    |SIGUE;
               |FINSI;
           |FINSI;
     |SIGUE;

     |FININF;
     |FINIMP;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     enCodCli = 1;
     |HAZ LeePersona;

     |SI enSwDeDonde = 0;
         |C_M #dsmoy062#78, 1, "N";
         |C_M #dsmoy062#79, 1, "N";
     |FINSI;
|FPRC;
