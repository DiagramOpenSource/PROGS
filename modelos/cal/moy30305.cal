|FICHEROS;
     dsmoy000;
     dsmom107;

     dsmom004;
     dsm30301;
     dsm30302;
     dsm30303;
     dsm30304;
     dsm30305;

     dsmow014;

     t1830301;
     t1830302;
     t1830303;
     t1830304;

     dsmociva;
     dsmow142;

     &regisnif@;
     &clientes@;
     &datosper@;

     dsmom017;
|FIN;

|VARIABLES;
     nConta      = 0;
     nReg        = 0;
     nColumna    = 0;
     nPagHoja2   = 0;

     nSw        = 0;
     nSwCara    = 0;
     nIVA17     = 0;
     nIVA20     = 0;
     nIVA23     = 0;
     nIVA32     = 0;
     nIVA35     = 0;
     nIVA38     = 0;
     nIVA25     = 0;
     nIVA28     = 0;
     nIVA31     = 0;
     nSubeIVA   = 0;
     nGrupo     = 0;
     nSubGrupo  = 0;
     nMas       = 0;
     nPara1     = 0;
     nPara2     = 0;
     nPara3     = 0;
     nCampo1    = 0;
     nCampo2    = 0;
     nCampo3    = 0;
     nPrimero   = 0;
     nBaseImpo  = 0;
     nPorce     = 0;
     nCuota     = 0;
     nCasilla    = 0;
     nContaTotal = 0;
     nError      = 0;

     fFechaHoy  = @;
     nSwHoja4   = 0;
     aEje       = "";

     &enSwLinea = 0;
     &enBase    = 0;
     &enCuota   = 0;
     &enPorce   = 0;
     &aText     = "";
     &aTexr     = "";
     &aDescr    = "";
     &enBaseI   = 0;
     &enCuotaI  = 0;
     &enPorceI  = 0;
     &eaCiudad  = "";
|FIN;

|INCLUYE i_varemi;

|PROCESO t1830301ptrl;
     |PARA nCampo = 1;  |SI nCampo [ 76;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #t1830301#nCampo#;
           |XGRABA enHandlePortal, eaAlfa;
     |SIGUE;
|FPRC;

|PROCESO t1830302;
     |PARA nCampo = 1;  |SI nCampo [ 93;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #t1830302#nCampo#;
           |XGRABA enHandlePortal, eaAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE t1830302;
     #t1830302#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, t1830302;
|FIN;

|PROCESO t1830302ptrl;
     |BUCLE t1830302;
|FPRC;

|PROCESO t1830303ptrl;
     eaAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 64;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #t1830303#nCampo#;
           |XGRABA enHandlePortal, eaAlfa;
     |SIGUE;
|FPRC;

|PROCESO t1830304;
     |PARA nCampo = 1;  |SI nCampo [ 70;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #t1830304#nCampo#;
           |XGRABA enHandlePortal, eaAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE t1830304;
     #t1830304#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, t1830304;
|FIN;

|PROCESO t1830304ptrl;
     |BUCLE t1830304;
|FPRC;

|PROCESO AbrePag_8111_2018;
     aEnlace = "https://www6.aeat.es/wlpl/PFTW-PICW/ServVali";
     aHID    = "IE83030A";
     aIDI    = "ES";
     aPRG    = "";
     aEJF    = #dsmoy000#6;
     aMOD    = #dsmoy000#0;

     aINI = "<T3030" + #t1830301#10 + #t1830301#11 + "0000>";
     aFIN = "</T3030" + #t1830301#10 + #t1830301#11 + "0000>";

     |PUSHV 0501 2380;
     |BLANCO 0501 2380;
     |CUADRO 0501 2380;

     eaAlfa = "Conectandose a la pagina de la aeat";
     |PINTA 1210, eaAlfa;

     aAbrePortal = eaPathEmision + "portal303.html";
     |XABRE "WB", aAbrePortal, enHandlePortal;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + aEnlace + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + aHID + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + aIDI + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "LEV" + &34 + " value=" + &34 + "000000000000" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIC" + &34 + " value=" + &34 + aINI;
     |HAZ GrabaPortalSin;

     eaAlfa = "<AUX>";     |HAZ GrabaPortalSin;
     eaAlfa = " " * 70;    |HAZ GrabaPortalSin;
     eaAlfa = eaVersMod;   |HAZ GrabaPortalSin;
     eaAlfa = " " * 4;     |HAZ GrabaPortalSin;
     eaAlfa = eaNIFDs;     |HAZ GrabaPortalSin;
     eaAlfa = " " * 213;   |HAZ GrabaPortalSin;
     eaAlfa = "</AUX>";    |HAZ GrabaPortalSin;

     |HAZ t1830301ptrl;
     |HAZ t1830302ptrl;
     |HAZ t1830303ptrl;

     eaAlfa = aFIN + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "RUT" + &34 + " value=" + &34 + aTipo + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + aPRG + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + aTipo + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + aEJF + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + aMOD + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     eaFOrigen  = aAbrePortal;
     eaFDestino = eaPathLanza + "portal303.html";
     |HAZ CopiaFichero;

     eaForzExplorador = "N";
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         eaAlfa = eaPathExplorador + " " + eaFDestino;
         eaAlfa  = "cmd " + &34 + "/c START /WAIT " + eaAlfa + &34;
     |SINO;
         eaAlfa  = "cmd " + &34 + "/c START /WAIT " + eaFDestino + &34;
     |FINSI;

     |RSYSTEM eaAlfa;

     |FBORRA eaFOrigen;

     |POPV;
|FPRC;

|PROCESO AbrePag_8212_2018;
     aAlfa = eaPathLanza + "*.*";  |QBT aAlfa;
     |R_PDIR aAlfa;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |RFBORRA aAlfa;

            |R_SDIR aAlfa;
     |SIGUE;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathLanza + eaFicheroPlano;
     |HAZ CopiaFichero;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aEJF = #dsmoy000#6;

     aAbre = eaPathLanza + "imp" + Usuario + ".bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     eaAlfa = eaPathExplorador + " ";
     |HAZ GrabaPortalSin;

     eaAlfa = &34 + "https://www2.agenciatributaria.gob.es/static_files/common/internet/dep/aplicaciones/ov/servurlp.html";
     |HAZ GrabaPortalSin;

     eaAlfa = "?WEB=INTERNET&PRG=" + #dsmoy000#0;
     |HAZ GrabaPortalSin;

     eaAlfa = "&EJE=" + aEJF;
     |HAZ GrabaPortalSin;

     eaAlfa = "&URL=IMP" + &34 +  &13 + &10;
     |HAZ GrabaPortalSin;

     eaAlfa = "";
     |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     aAlfa = "0000Ubicacion: " + eaPathLanza + &13 + &10;
     aAlfa = aAlfa  + " Fichero: " + eaFicheroPlano;
     |MENAV aAlfa;

     |RSYSTEM aAbre;
|FPRC;

|PROCESO AbrePag_8212_2019;
     aAlfa = eaPathLanza + "*.*";  |QBT aAlfa;
     |R_PDIR aAlfa;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |RFBORRA aAlfa;

            |R_SDIR aAlfa;
     |SIGUE;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathLanza + eaFicheroPlano;
     |HAZ CopiaFichero;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aAbre = eaPathLanza + "imp" + Usuario + ".bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     eaAlfa = eaPathExplorador + " ";
     |HAZ GrabaPortalSin;

     aAlfa = #dsmoy000#6; aAlfa = aAlfa % -102;
     eaAlfa = "https://www2.agenciatributaria.gob.es/wlpl/A303-PW" + aAlfa + "/CONT/index.zul?EDFI";
     |HAZ GrabaPortalSin;

     eaAlfa = "";
     |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     aAlfa = "0000Ubicacion: " + eaPathLanza + &13 + &10;
     aAlfa = aAlfa  + " Fichero: " + eaFicheroPlano;
     |MENAV aAlfa;

     |RSYSTEM aAbre;
|FPRC;

|PROCESO AbrePag_8312_2018;
     eaPathAEAT = eaUnidadBasico + "\AEAT";        |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\" + #dsmoy000#0;  |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\" + #dsmoy000#6;  |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\" + (("00" + #dsmoy000#4) % -102);  |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\";

     aAlfa = eaPathAEAT + "*.bat";  |QBT aAlfa;
     |R_PDIR aAlfa;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            aAlfa1 = (aAlfa % -103) < "";
            |SI aAlfa1 ! "txt";
                |RFBORRA aAlfa;
            |FINSI;

            |R_SDIR aAlfa;
     |SIGUE;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathAEAT + eaFicheroPlano;
     |HAZ CopiaFichero;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aEJF = #dsmoy000#6;

     aAbre = eaPathAEAT + "imp" + Usuario + ".bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     eaAlfa = eaPathExplorador + " ";
     |HAZ GrabaPortalSin;

     eaAlfa = &34 + "https://www1.agenciatributaria.gob.es/static_files/common/internet/dep/aplicaciones/ov/servurlp.html";
     |HAZ GrabaPortalSin;

     eaAlfa = "?WEB=INTERNET&PRG=" + #dsmoy000#0;
     |HAZ GrabaPortalSin;

     eaAlfa = "&EJE=" + aEJF;
     |HAZ GrabaPortalSin;

     eaAlfa = "&URL=PIR" + &34 +  &13 + &10;
     |HAZ GrabaPortalSin;

     eaAlfa = "";
     |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     aAlfa = "0000Ubicacion: " + eaPathAEAT + &13 + &10;
     aAlfa = aAlfa  + " Fichero: " + eaFicheroPlano;
     |MENAV aAlfa;

     |RSYSTEM aAbre;
|FPRC;

|PROCESO AbrePag_8312_2019;
     eaPathAEAT = eaUnidadBasico + "\AEAT";        |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\" + #dsmoy000#0;  |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\" + #dsmoy000#6;  |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\" + (("00" + #dsmoy000#4) % -102);  |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\";

     aAlfa = eaPathAEAT + "*.bat";  |QBT aAlfa;
     |R_PDIR aAlfa;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            aAlfa1 = (aAlfa % -103) < "";
            |SI aAlfa1 ! "txt";
                |RFBORRA aAlfa;
            |FINSI;

            |R_SDIR aAlfa;
     |SIGUE;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathAEAT + eaFicheroPlano;
     |HAZ CopiaFichero;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aAbre = eaPathAEAT + "imp" + Usuario + ".bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     eaAlfa = eaPathExplorador + " ";
     |HAZ GrabaPortalSin;

     aAlfa = #dsmoy000#6; aAlfa = aAlfa % -102;
     eaAlfa = "https://www1.agenciatributaria.gob.es/wlpl/A303-PW" + aAlfa + "/index.zul?EDFI";
     |HAZ GrabaPortalSin;

     eaAlfa = "";
     |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     aAlfa = "0000Ubicacion: " + eaPathAEAT + &13 + &10;
     aAlfa = aAlfa  + " Fichero: " + eaFicheroPlano;
     |MENAV aAlfa;

     |RSYSTEM aAbre;
|FPRC;

|PROCESO PresentaModelo_05;
     |SI eaOpcion = "1";
         |SI #dsmoy000#6 [ 2018;
             |HAZ AbrePag_8212_2018;
         |FINSI;

         |SI #dsmoy000#6 ] 2019;
             |HAZ AbrePag_8212_2019;
         |FINSI;

         |HAZ GrabaImpreso;
     |FINSI;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             eaFOrigen  = eaPathEmision  + eaFicheroPlano;
             eaFDestino = eaPathInternet + eaFicheroPlano;
             |HAZ CopiaFichero;
         |FINSI;

         |SI enPresentar = 1;
             |SI #dsmoy000#6 [ 2018;
                 |HAZ AbrePag_8312_2018;
             |FINSI;

             |SI #dsmoy000#6 ] 2019;
                 |HAZ AbrePag_8312_2019;
             |FINSI;
         |FINSI;

         |HAZ GrabaImpreso;
     |FINSI;

     |SI eaOpcion = "4";
         |HAZ AbrePag_8111_2018;
     |FINSI;

     |SI eaOpcion = "6";
         eaX002_10    = #t1830301#7;
         eaX002_11    = #t1830301#8;
         eaX002_12    = #t1830301#2;
         eaX002_13    = #t1830301#10;
         eaX002_14    = #t1830301#11;

         |SI #dsm30301#4 > 0;
             eaX002_15 = "C";
             eaX002_16 = #t1830303#23;
         |FINSI;

         eaX002_17 = #dsm30301#88;
         eaX002_18 = #t1830301#6;
         eaX002_19 = #t1830303#26;
         eaX002_48 = eaNomEnt;

         |HAZ PresentaPortal;
     |FINSI;
|FPRC;

|PROCESO PersonaFis2018;
     aAlfa = eaVarDni % 101;
     |SI aAlfa = "0"; |O aAlfa = "1"; |O aAlfa = "2"; |O aAlfa = "3";
      |O aAlfa = "4"; |O aAlfa = "5"; |O aAlfa = "6"; |O aAlfa = "7";
      |O aAlfa = "8"; |O aAlfa = "9"; |O aAlfa = "X"; |O aAlfa = "Y";
      |O aAlfa = "Z";
         eaAlfa = #clientes@#1;     |HAZ BuscaNombre;
         eaAlfa = eaAlfa1;    |HAZ QuitaRaros;     #t1830301#8   = eaAlfa;
         eaAlfa = eaAlfa2;    |HAZ QuitaRaros;     #t1830301#9   = eaAlfa;
      |SINO;
         eaAlfa   = #clientes@#1;    |HAZ QuitaRaros;    #t1830301#8   = eaAlfa;
                                                         #t1830301#9   = " ";
      |FINSI;
|FPRC;

|PROCESO TDeclaracion2018;
     enModelo = 303;  enForzar = 1;  |HAZ CogeDatosBancos;

     |SI #dsm30301#89 ! 0;
         #t1830301#6 = "C";
     |FINSI;

     |SI #dsm30301#90 ! 0;
                                 #t1830301#6 = "D";
         |SI eaFormaPago = "6";  #t1830301#6 = "V";  |FINSI;
     |FINSI;

     |SI #dsm30301#91 ! 0;
                                 #t1830301#6 = "I";
         |SI eaFormaPago = "3";  #t1830301#6 = "U";  |FINSI;
         |SI eaFormaPago = "6";  #t1830301#6 = "G";  |FINSI;
     |FINSI;

     |SI #dsm30301#42 = 0; |Y #dsm30301#60 = 0; |Y #dsm30301#61 = 0;
      |Y #dsm30301#69 = 0; |Y #dsm30301#72 = 0; |Y #dsm30301#73 = 0;
      |Y #dsm30301#81 = 0; |Y #dsm30301#84 = 0;
         #t1830301#6 = "N";
     |FINSI;

     |SI #dsm30301#88 = 0;
         #t1830301#6 = "N";
     |FINSI;
|FPRC;

|PROCESO Hoja1_2018;
     |DDEFECTO #t1830301;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;   #t1830301#7  = eaVarDni;

         aAlfa1   = #datosper@#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = #datosper@#2;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;  |QBF aAlfa1;
             eaAlfa = #datosper@#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;  |QBF aAlfa2;
             #t1830301#8 = aAlfa1 + " " + aAlfa2;

             eaAlfa = #datosper@#4;  |HAZ QuitaRaros;
             #t1830301#9 = eaAlfa;
         |SINO;
             |HAZ PersonaFis2018;
         |FINSI;
         eaAlfa  = #clientes@#37;  |HAZ QuitaRaros;    eaCiudad = eaAlfa;
     |SINO;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;   #t1830301#7   = eaVarDni;
         |HAZ PersonaFis2018;
         eaAlfa   = #clientes@#11;  |HAZ QuitaRaros;   eaCiudad = eaAlfa;
     |FINSI;

     fFechaHoy = ~;
     |HAZ TDeclaracion2018;

     #t1830301#10  = #dsm30301#1;

     |SI #dsmom004#22 = "T";
         |SI #dsm30301#2 = 3;   #t1830301#11 = "1T";  |FINSI;
         |SI #dsm30301#2 = 6;   #t1830301#11 = "2T";  |FINSI;
         |SI #dsm30301#2 = 9;   #t1830301#11 = "3T";  |FINSI;
         |SI #dsm30301#2 = 12;  #t1830301#11 = "4T";  |FINSI;
     |SINO;
         #t1830301#11 = ("00" + #dsm30301#2) % -102;
     |FINSI;

     |SI #dsm30301#6  = "S";  #t1830301#12 = "1";  |FINSI;
     |SI #dsm30301#6  = "N";  #t1830301#12 = "2";  |FINSI;
     |SI #dsm30301#7  = "S";  #t1830301#13 = "1";  |FINSI;
     |SI #dsm30301#7  = "N";  #t1830301#13 = "2";  |FINSI;
     |SI #dsm30301#7  = "G";  #t1830301#13 = "3";  |FINSI;

     |SI #dsm30301#8  = "S";  #t1830301#14 = "1";  |FINSI;
     |SI #dsm30301#8  = "N";  #t1830301#14 = "2";  |FINSI;
     |SI #dsm30301#9  = "S";  #t1830301#15 = "1";  |FINSI;
     |SI #dsm30301#9  = "N";  #t1830301#15 = "2";  |FINSI;

     aAlfa = "";
     |SI #dsm30301#14 > "01.01.0000";
         aAlfa = (#dsm30301#14 % 102) + (#dsm30301#14 % 402) + (#dsm30301#14 % -104);
     |FINSI;
     #t1830301#16 = aAlfa;
     #t1830301#17 = #dsm30301#15;

     |SI #dsm30301#10 = "S";  #t1830301#18 = "1";  |FINSI;
     |SI #dsm30301#10 = "N";  #t1830301#18 = "2";  |FINSI;
     |SI #dsm30301#11 = "S";  #t1830301#19 = "1";  |FINSI;
     |SI #dsm30301#11 = "N";  #t1830301#19 = "2";  |FINSI;
     |SI #dsm30301#12 = "S";  #t1830301#20 = "1";  |FINSI;
     |SI #dsm30301#12 = "N";  #t1830301#20 = "2";  |FINSI;
     |SI #dsm30301#13 = "S";  #t1830301#21 = "1";  |FINSI;
     |SI #dsm30301#13 = "N";  #t1830301#21 = "2";  |FINSI;

     enNume = #dsm30301#16;   |HAZ Conver17;   #t1830301#22 = eaAlfa;
     enNume = #dsm30301#17 * 100;              #t1830301#23 = ("00000" + enNume) % -105;
     enNume = #dsm30301#18;   |HAZ Conver17;   #t1830301#24 = eaAlfa;
     enNume = #dsm30301#19;   |HAZ Conver17;   #t1830301#25 = eaAlfa;
     enNume = #dsm30301#20 * 100;              #t1830301#26 = ("00000" + enNume) % -105;
     enNume = #dsm30301#21;   |HAZ Conver17;   #t1830301#27 = eaAlfa;
     enNume = #dsm30301#22;   |HAZ Conver17;   #t1830301#28 = eaAlfa;
     enNume = #dsm30301#23 * 100;              #t1830301#29 = ("00000" + enNume) % -105;
     enNume = #dsm30301#24;   |HAZ Conver17;   #t1830301#30 = eaAlfa;
     enNume = #dsm30301#25;   |HAZ Conver17;   #t1830301#31 = eaAlfa;
     enNume = #dsm30301#26;   |HAZ Conver17;   #t1830301#32 = eaAlfa;
     enNume = #dsm30301#27;   |HAZ Conver17;   #t1830301#33 = eaAlfa;
     enNume = #dsm30301#28;   |HAZ Conver17;   #t1830301#34 = eaAlfa;
     enNume = #dsm30301#29;   |HAZ Conver17;   #t1830301#35 = eaAlfa;
     enNume = #dsm30301#30;   |HAZ Conver17;   #t1830301#36 = eaAlfa;
     enNume = #dsm30301#31;   |HAZ Conver17;   #t1830301#37 = eaAlfa;
     enNume = #dsm30301#32 * 100;              #t1830301#38 = ("00000" + enNume) % -105;
     enNume = #dsm30301#33;   |HAZ Conver17;   #t1830301#39 = eaAlfa;
     enNume = #dsm30301#34;   |HAZ Conver17;   #t1830301#40 = eaAlfa;
     enNume = #dsm30301#35 * 100;              #t1830301#41 = ("00000" + enNume) % -105;
     enNume = #dsm30301#36;   |HAZ Conver17;   #t1830301#42 = eaAlfa;
     enNume = #dsm30301#37;   |HAZ Conver17;   #t1830301#43 = eaAlfa;
     enNume = #dsm30301#38 * 100;              #t1830301#44 = ("00000" + enNume) % -105;
     enNume = #dsm30301#39;   |HAZ Conver17;   #t1830301#45 = eaAlfa;
     enNume = #dsm30301#40;   |HAZ Conver17;   #t1830301#46 = eaAlfa;
     enNume = #dsm30301#41;   |HAZ Conver17;   #t1830301#47 = eaAlfa;
     enNume = #dsm30301#42;   |HAZ Conver17;   #t1830301#48 = eaAlfa;
     enNume = #dsm30301#43;   |HAZ Conver17;   #t1830301#49 = eaAlfa;
     enNume = #dsm30301#44;   |HAZ Conver17;   #t1830301#50 = eaAlfa;
     enNume = #dsm30301#45;   |HAZ Conver17;   #t1830301#51 = eaAlfa;
     enNume = #dsm30301#46;   |HAZ Conver17;   #t1830301#52 = eaAlfa;
     enNume = #dsm30301#47;   |HAZ Conver17;   #t1830301#53 = eaAlfa;
     enNume = #dsm30301#48;   |HAZ Conver17;   #t1830301#54 = eaAlfa;
     enNume = #dsm30301#49;   |HAZ Conver17;   #t1830301#55 = eaAlfa;
     enNume = #dsm30301#50;   |HAZ Conver17;   #t1830301#56 = eaAlfa;
     enNume = #dsm30301#51;   |HAZ Conver17;   #t1830301#57 = eaAlfa;
     enNume = #dsm30301#52;   |HAZ Conver17;   #t1830301#58 = eaAlfa;
     enNume = #dsm30301#53;   |HAZ Conver17;   #t1830301#59 = eaAlfa;
     enNume = #dsm30301#54;   |HAZ Conver17;   #t1830301#60 = eaAlfa;
     enNume = #dsm30301#55;   |HAZ Conver17;   #t1830301#61 = eaAlfa;
     enNume = #dsm30301#56;   |HAZ Conver17;   #t1830301#62 = eaAlfa;
     enNume = #dsm30301#57;   |HAZ Conver17;   #t1830301#63 = eaAlfa;
     enNume = #dsm30301#58;   |HAZ Conver17;   #t1830301#64 = eaAlfa;
     enNume = #dsm30301#59;   |HAZ Conver17;   #t1830301#65 = eaAlfa;
     enNume = #dsm30301#60;   |HAZ Conver17;   #t1830301#66 = eaAlfa;
     enNume = #dsm30301#61;   |HAZ Conver17;   #t1830301#67 = eaAlfa;

     |SI #dsm30301#2 [ 11;
         #t1830301#68 = "0";
         #t1830301#71 = "0";
     |SINO;
         |SI #dsm30301#130 = "S"; #t1830301#71 = "1";  |FINSI;
         |SI #dsm30301#130 ! "S"; #t1830301#71 = "2";  |FINSI;
         |SI #dsm30301#144 = "S"; #t1830301#68 = "1";  |FINSI;
         |SI #dsm30301#144 ! "S"; #t1830301#68 = "2";  |FINSI;
         |SI #dsm30301#130 ! "S"; #t1830301#68 = "0";  |FINSI;
     |FINSI;

     |SI #dsm30301#1 = 2018; |Y #dsm30301#2 = 1;
         #t1830301#69 = "0";
         #t1830301#70 = "0";
     |SINO;
         |SI #dsm30301#131 = "S"; #t1830301#69 = "1";  |FINSI;
         |SI #dsm30301#131 ! "S"; #t1830301#69 = "2";  |FINSI;
         |SI #dsm30301#132 = "S"; #t1830301#70 = "1";  |FINSI;
         |SI #dsm30301#132 ! "S"; #t1830301#70 = "2";  |FINSI;
     |FINSI;

     #t1830301#77 = &13 + &10;
|FPRC;

|PROCESO ImpTotalSimpli2018;
     nSw = 0;
     |PARA nPara1 = 62; |SI nPara1 [ 73; |HACIENDO nPara1 = nPara1 + 1;
           |SI #dsm30301#nPara1# ! 0;
               nSw = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSw = 0; |ACABA; |FINSI;

     nConta = nConta + 1;
     nReg   = ((nConta / 2) - .51) ! 0;
     |SI nReg < 0;  nReg = 0;   |FINSI;

     #t1830302#0 = nReg;
     |LEE 101#t1830302.=;
     |SI FSalida ! 0;
         |DDEFECTO #t1830302;
         #t1830302#0  = nReg;

         |SI #t1830302#0 = 0;
             |HAZ TotalesHoja2_05;
         |FINSI;

         #t1830302#94 = &13 + &10;

         |GRABA 020#t1830302.b;
     |FINSI;
     |LIBERA #t1830302;
|FPRC;

|PROCESO TotalesHoja2_05;
     enNume = #dsm30301#62;   |HAZ Conver17;   #t1830302#78 = eaAlfa;
     enNume = #dsm30301#63;   |HAZ Conver17;   #t1830302#79 = eaAlfa;
     enNume = #dsm30301#64;   |HAZ Conver17;   #t1830302#80 = eaAlfa;
     enNume = #dsm30301#65;   |HAZ Conver17;   #t1830302#81 = eaAlfa;
     enNume = #dsm30301#66;   |HAZ Conver17;   #t1830302#82 = eaAlfa;
     enNume = #dsm30301#67;   |HAZ Conver17;   #t1830302#83 = eaAlfa;
     enNume = #dsm30301#68;   |HAZ Conver17;   #t1830302#84 = eaAlfa;
     enNume = #dsm30301#69;   |HAZ Conver17;   #t1830302#85 = eaAlfa;
     enNume = #dsm30301#70;   |HAZ Conver17;   #t1830302#86 = eaAlfa;
     enNume = #dsm30301#71;   |HAZ Conver17;   #t1830302#87 = eaAlfa;
     enNume = #dsm30301#72;   |HAZ Conver17;   #t1830302#88 = eaAlfa;
     enNume = #dsm30301#73;   |HAZ Conver17;   #t1830302#89 = eaAlfa;
     nContaTotal = 1;
|FPRC;

|PROCESO dsm30302_05
     nConta = nConta + 1;
     nReg   = ((nConta / 2) - .51) ! 0;
     |SI nReg < 0;  nReg = 0;   |FINSI;

     #t1830302#0 = nReg;
     |LEE 101#t1830302.=;
     |SI FSalida ! 0;
         |DDEFECTO #t1830302;
         #t1830302#0  = nReg;

         |SI nReg ! 0;
             #t1830302#5  = "C";
         |FINSI;

         |SI #t1830302#0 = 0;
             |HAZ TotalesHoja2_05;
         |FINSI;

         #t1830302#94 = &13 + &10;

         |GRABA 020#t1830302.b;
     |FINSI;

     nColumna = nConta $ 2;
                        nCampo = 6;
     |SI nColumna = 0;  nCampo = 14;  |FINSI;

     eaAlfa = ("00" + #dsm30302#6) % -102;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30302#8;   |HAZ Conver17Signo;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = (#dsm30302#9 * 100000) ! 0;
     eaAlfa = ("000000" + enNume) % -106;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30302#10;   |HAZ Conver17Signo;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = (#dsm30302#11 * 100) ! 0;
     eaAlfa = ("00000" + enNume) % -105;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30302#12;   |HAZ Conver17Signo;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30302#13;   |HAZ Conver17Signo;
     #t1830302#nCampo# = eaAlfa;

     |SI #dsm30302#2 = 12;
         nCampo = nCampo + 1;
         enNume = #dsm30302#14;   |HAZ Conver17;
         #t1830302#nCampo# = eaAlfa;
     |FINSI;

     |GRABA 020#t1830302.a;
     |LIBERA #t1830302;
|FPRC;

|DEFBUCLE dsm30302_05;
     #dsm30302#1;
     ;
     #dsm30301#0, #dsm30301#1, #dsm30301#2, #dsm30301#3, #dsm30301#4, #dsm30301#5, 001;
     #dsm30301#0, #dsm30301#1, #dsm30301#2, #dsm30301#3, #dsm30301#4, #dsm30301#5, 999;
     ;
     NULL, dsm30302_05;
|FIN;

|PROCESO dsm30303_05;
     nConta = nConta + 1;
     nReg   = ((nConta / 2) - .51) ! 0;
     |SI nReg < 0;  nReg = 0;   |FINSI;

     #t1830302#0 = nReg;
     |LEE 101#t1830302.=;
     |SI FSalida ! 0;
         |DDEFECTO #t1830302;
         #t1830302#0  = nReg;

         |SI nReg ! 0;
             #t1830302#5  = "C";
         |FINSI;

         #t1830302#94 = &13 + &10;

         |SI #t1830302#0 = 0;
             |HAZ TotalesHoja2_05;
         |FINSI;

         |GRABA 020#t1830302.b;
     |FINSI;

     nColumna = nConta $ 2;

                        nCampo = 22;
     |SI nColumna = 0;  nCampo = 50;  |FINSI;

     #t1830302#nCampo# = #dsm30303#6;

     nCampo = nCampo + 1;
     eaAlfa = " ";
     |SI #dsm30303#6 = "453 "; |O #dsm30303#6 = "6919"; |O #dsm30303#6 = "722 ";
         |ABRE #dsmom017;
         |DDEFECTO #dsmom017;
         #dsmom017#0 = #dsm30303#0;
         #dsmom017#1 = #dsm30303#1;
         #dsmom017#2 = 00;         || no hay complementaria en modulos
         #dsmom017#3 = #dsm30303#5;
         |LEE 000#dsmom017.=;
         |CIERRA #dsmom017;

         eaAlfa = #dsmom017#6;
     |FINSI;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#8;   |HAZ Conver10;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#15;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#9;   |HAZ Conver10;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#16;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#10;   |HAZ Conver10;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#17;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#11;   |HAZ Conver10;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#18;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#12;   |HAZ Conver10;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#19;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#13;   |HAZ Conver10;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#20;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#14;   |HAZ Conver10;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#21;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#22;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#23;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = (#dsm30303#24 * 100) ! 0;
     eaAlfa = ("000" + enNume) % -103;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = (#dsm30303#25 * 100) ! 0;
     eaAlfa = ("00000" + enNume) % -105;
     #t1830302#nCampo# = eaAlfa;                  ||41

     nCampo = nCampo + 1;
     enNume = #dsm30303#26;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;                  ||42

     nCampo = nCampo + 1;
     enNume = #dsm30303#27;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = (#dsm30303#28 * 100) ! 0;
     eaAlfa = ("000" + enNume) % -103;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#29;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = (#dsm30303#30 * 100) ! 0;
     eaAlfa = ("00000" + enNume) % -105;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#31;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#32;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30303#33;   |HAZ Conver17;
     #t1830302#nCampo# = eaAlfa;

     |GRABA 020#t1830302.a;
     |LIBERA #t1830302;
|FPRC;

|DEFBUCLE dsm30303_05;
     #dsm30303#1;
     ;
     #dsm30301#0, #dsm30301#1, #dsm30301#2, #dsm30301#3, #dsm30301#4, 01;
     #dsm30301#0, #dsm30301#1, #dsm30301#2, #dsm30301#3, #dsm30301#4, 99;
     ;
     NULL, dsm30303_05;
|FIN;

|PROCESO Hoja2_2018;   || aqui no esta claro lo del Num y N ver con Carlos

     aFichero = "t1830302" + Usuario;
     |NOME_DAT #t1830302#aFichero#;
     |ABRE #t1830302;  |CIERRA #t1830302;  |DELINDEX #t1830302;

     nContaTotal = 0;
     |ABRE #t1830302;
     enSwLinea = 0; nConta = 0; |BUCLE dsm30302_05;
     enSwLinea = 2; nConta = 0; |BUCLE dsm30303_05;
     |SI nContaTotal = 0;
         |HAZ ImpTotalSimpli2018;
     |FINSI;
     |CIERRA #t1830302;
|FPRC;

|PROCESO Hoja3_2018;
     |DDEFECTO #t1830303;

     enNume = #dsm30301#74;   |HAZ Conver17;   #t1830303#5  = eaAlfa;
     enNume = #dsm30301#75;   |HAZ Conver17;   #t1830303#6  = eaAlfa;
     enNume = #dsm30301#76;   |HAZ Conver17;   #t1830303#7  = eaAlfa;
     enNume = #dsm30301#77;   |HAZ Conver17;   #t1830303#8  = eaAlfa;
     enNume = #dsm30301#78;   |HAZ Conver17;   #t1830303#9  = eaAlfa;
     enNume = #dsm30301#79;   |HAZ Conver17;   #t1830303#10 = eaAlfa;
     enNume = #dsm30301#80;   |HAZ Conver17;   #t1830303#11 = eaAlfa;
     enNume = #dsm30301#94;   |HAZ Conver17;   #t1830303#12 = eaAlfa;
     enNume = #dsm30301#81;   |HAZ Conver17;   #t1830303#13 = eaAlfa;
     enNume = #dsm30301#82 * 1000000;          #t1830303#14 = ("000000000" + enNume) % -109;
     enNume = #dsm30301#83;   |HAZ Conver17;   #t1830303#15 = eaAlfa;
     enNume = #dsm30301#95;   |HAZ Conver17;   #t1830303#16 = eaAlfa;
     enNume = #dsm30301#84;   |HAZ Conver17;   #t1830303#17 = eaAlfa;
     enNume = #dsm30301#85;   |HAZ Conver17;   #t1830303#18 = eaAlfa;
     enNume = #dsm30301#86;   |HAZ Conver17;   #t1830303#19 = eaAlfa;
     enNume = #dsm30301#87;   |HAZ Conver17;   #t1830303#20 = eaAlfa;
     enNume = #dsm30301#88;   |HAZ Conver17;   #t1830303#21 = eaAlfa;

     |SI #dsm30301#4 > 0;
         #t1830303#22 = "X";
         #t1830303#23 = #dsmom004#21;
     |FINSI;

     |SI #dsm30301#42 = 0; |Y #dsm30301#60 = 0; |Y #dsm30301#61 = 0;
      |Y #dsm30301#69 = 0; |Y #dsm30301#72 = 0; |Y #dsm30301#73 = 0;
      |Y #dsm30301#81 = 0;
         #t1830303#24 = "X";
     |FINSI;

     |SI #dsm30301#90 ! 0;
         #t1830303#25 = eaBIC;
         #t1830303#26 = eaIBAN;

         |QBF eaIBAN;
         |SI eaIBAN = "";  nError = 1;  |FINSI;
     |FINSI;

     |SI #dsm30301#91 ! 0;
         #t1830303#26 = eaIBAN;
     |FINSI;

     #t1830303#27 = #dsm30301#99;
     #t1830303#28 = #dsm30301#97;
     #t1830303#29 = #dsm30301#103;
     #t1830303#30 = #dsm30301#101;
     #t1830303#31 = #dsm30301#107;
     #t1830303#32 = #dsm30301#105;
     #t1830303#33 = #dsm30301#111;
     #t1830303#34 = #dsm30301#109;
     #t1830303#35 = #dsm30301#115;
     #t1830303#36 = #dsm30301#113;
     #t1830303#37 = #dsm30301#119;
     #t1830303#38 = #dsm30301#117;

     |SI #dsm30301#120 = "S";
         #t1830303#39 = "X";
     |FINSI;

     enNume = #dsm30301#121;   |HAZ Conver17;   #t1830303#40 = eaAlfa;
     enNume = #dsm30301#122;   |HAZ Conver17;   #t1830303#41 = eaAlfa;
     enNume = #dsm30301#137;   |HAZ Conver17;   #t1830303#42 = eaAlfa;
     enNume = #dsm30301#124;   |HAZ Conver17;   #t1830303#43 = eaAlfa;
     enNume = #dsm30301#125;   |HAZ Conver17;   #t1830303#44 = eaAlfa;
     enNume = #dsm30301#126;   |HAZ Conver17;   #t1830303#45 = eaAlfa;
     enNume = #dsm30301#127;   |HAZ Conver17;   #t1830303#46 = eaAlfa;
     enNume = #dsm30301#128;   |HAZ Conver17;   #t1830303#47 = eaAlfa;
     enNume = #dsm30301#129;   |HAZ Conver17;   #t1830303#48 = eaAlfa;

     enNume = #dsm30301#133 * 100;              #t1830303#50 = ("00000" + enNume) % -105;
     enNume = #dsm30301#134 * 100;              #t1830303#51 = ("00000" + enNume) % -105;
     enNume = #dsm30301#135 * 100;              #t1830303#52 = ("00000" + enNume) % -105;
     enNume = #dsm30301#136 * 100;              #t1830303#53 = ("00000" + enNume) % -105;

     enNume = #dsm30301#138;   |HAZ Conver17;   #t1830303#54 = eaAlfa;
     enNume = #dsm30301#139;   |HAZ Conver17;   #t1830303#55 = eaAlfa;
     enNume = #dsm30301#140;   |HAZ Conver17;   #t1830303#56 = eaAlfa;
     enNume = #dsm30301#141;   |HAZ Conver17;   #t1830303#57 = eaAlfa;
     enNume = #dsm30301#142;   |HAZ Conver17;   #t1830303#58 = eaAlfa;
     enNume = #dsm30301#143;   |HAZ Conver17;   #t1830303#59 = eaAlfa;

     enNume = #dsm30301#145 * 100; #t1830303#60 = ("00000" + enNume) % -105;

     #t1830303#65 = &13 + &10;
|FPRC;

|PROCESO dsm30304_05;

     |SI #dsm30304#7 = 0; |Y #dsm30304#8 = 0;
         |ACABA;
     |FINSI;

     nConta = nConta + 1;
     |SI nConta = 6;
         nConta = 1;
         nReg   = nReg + 1;
     |FINSI;

     #t1830304#0 = nReg;
     |LEE 101#t1830304.=;
     |SI FSalida ! 0;
         |DDEFECTO #t1830304;
         #t1830304#0  = nReg;

         |SI nReg ! 0;
             #t1830304#5  = "C";
         |FINSI;

         #t1830304#71 = &13 + &10;

         |GRABA 020#t1830304.b;
     |FINSI;

     nColumna = nConta;
     nCampo   = 6 + (nColumna - 1) * 5;

     #t1830304#nCampo# = #dsm30304#6;

     nCampo = nCampo + 1;
     enNume = #dsm30304#7;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30304#8;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     #t1830304#nCampo# = #dsm30304#9;

     nCampo = nCampo + 1;
     |SI #dsm30304#10 ! 0;
         enNume = #dsm30304#10 * 100;
         aAlfa  = enNume;
         aAlfa  = ("00000" + aAlfa) % -105;
         #t1830304#nCampo# = aAlfa;
     |FINSI;

     |GRABA 020#t1830304.a;
     |LIBERA #t1830304;
     nSwHoja4 = 1;
|FPRC;

|DEFBUCLE dsm30304_05;
     #dsm30304#1;
     ;
     #dsm30301#0, #dsm30301#1, #dsm30301#3, #dsm30301#4, 01;
     #dsm30301#0, #dsm30301#1, #dsm30301#3, #dsm30301#4, 99;
     ;
     NULL, dsm30304_05;
|FIN;

|PROCESO dsm30305_05;
     nConta = nConta + 1;
     |SI nConta = 3;
         nConta = 1;
         nReg   = nReg + 1;
     |FINSI;

     #t1830304#0 = nReg;
     |LEE 101#t1830304.=;
     |SI FSalida ! 0;
         |DDEFECTO #t1830304;
         #t1830304#0  = nReg;

         |SI nReg ! 0;
             #t1830304#5  = "C";
         |FINSI;

         #t1830304#71 = &13 + &10;

         |GRABA 020#t1830304.b;
     |FINSI;

     nColumna = nConta; nCampo = 31;
     |SI nColumna = 2;  nCampo = 49; |FINSI;

     enNume = #dsm30305#5;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#6;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#7;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#8;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#9;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#10;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#11;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#12;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#13;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#14;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#15;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#16;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#17;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#18;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#19;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#20;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#21;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#22;   |HAZ Conver17; #t1830304#nCampo# = eaAlfa;

     |GRABA 020#t1830304.a;
     |LIBERA #t1830304;
     nSwHoja4 = 1;
|FPRC;

|DEFBUCLE dsm30305_05;
     #dsm30305#1;
     ;
     #dsm30301#0, #dsm30301#1, #dsm30301#3, #dsm30301#4, 1;
     #dsm30301#0, #dsm30301#1, #dsm30301#3, #dsm30301#4, 9;
     ;
     NULL, dsm30305_05;
|FIN;

|PROCESO Hoja4_2018;

     aFichero = "t1830304" + Usuario;
     |NOME_DAT #t1830304#aFichero#;
     |ABRE #t1830304;  |CIERRA #t1830304;  |DELINDEX #t1830304;

     |ABRE #t1830304;
     enSwLinea = 0; nConta = 0; nReg = 0; |BUCLE dsm30304_05;
     enSwLinea = 2; nConta = 0; nReg = 0; |BUCLE dsm30305_05;
     |CIERRA #t1830304;
|FPRC;

|PROCESO Carga303_2018;
     enCodCli = #dsm30301#0;
     |HAZ LeePersona;

     nSwHoja4 = 0;
     |HAZ Hoja1_2018;
     |HAZ Hoja2_2018;
     |HAZ Hoja3_2018;
     |SI #dsm30301#2 = 12;
         |HAZ Hoja4_2018;
     |FINSI;

     aINI = "<T3030" + #t1830301#10 + #t1830301#11 + "0000>";
     aFIN = "</T3030" + #t1830301#10 + #t1830301#11 + "0000>";

     eaAlfa = aINI;        |HAZ GrabaPortalSin;
     eaAlfa = "<AUX>";     |HAZ GrabaPortalSin;
     eaAlfa = " " * 70;    |HAZ GrabaPortalSin;
     eaAlfa = eaVersMod;   |HAZ GrabaPortalSin;
     eaAlfa = " " * 4;     |HAZ GrabaPortalSin;
     eaAlfa = eaNIFDs;     |HAZ GrabaPortalSin;
     eaAlfa = " " * 213;   |HAZ GrabaPortalSin;
     eaAlfa = "</AUX>";    |HAZ GrabaPortalSin;

     |HAZ t1830301ptrl;
     |HAZ t1830302ptrl;
     |HAZ t1830303ptrl;
     |SI nSwHoja4 = 1; |HAZ t1830304ptrl; |FINSI;

     eaAlfa = aFIN;
     |HAZ GrabaPortalSin;

     enImpReal  = #dsm30301#81;
     enCas21    = #dsm30301#42 + #dsm30301#54;
     enCas27    = #dsm30301#60 + #dsm30301#72;
     enCas31    = #dsm30301#84;
     enCas34    = #dsm30301#88;
     enIngresar = #dsm30301#91;
     enDevolver = #dsm30301#90;
     enCompensar= #dsm30301#89;
|FPRC;

|PROCESO dsmow014_2018;
     |ABRE #dsmom004;
     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = #dsmow014#5;
     #dsmom004#4  = #dsmow014#7;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #dsmom004;

     |ABRE #dsm30301;
     #dsm30301#0 = #dsmom004#0;
     #dsm30301#1 = #dsmom004#1;
     #dsm30301#2 = #dsmom004#2;
     #dsm30301#3 = #dsmom004#3;
     #dsm30301#4 = #dsmom004#4;
     #dsm30301#5 = 0;
     |LEE 040#dsm30301.=;
     |SI FSalida ! 0;  |CIERRA #dsm30301;  |ACABA;  |FINSI;
     |CIERRA #dsm30301;

     eaFicheroPlano = "303" + (("00000" + #dsmow014#0) % -105) + ".txt";
     eaFicheroImpre = "303" + (("00000" + #dsmow014#0) % -105) + ".pdf";
     eaFicheroError = "err" + (("00000" + #dsmow014#0) % -105) + ".txt";

     aAlfa = eaPathLanza + eaFicheroPlano;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroImpre;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroError;  |RFBORRA aAlfa;

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     nError = 0;
     |HAZ Carga303_2018;

     |XCIERRA nHandle2;

     enEmpresa    = #dsmow014#0;
     enComple     = #dsmow014#7;
     eaNomEmpresa = #dsmow014#3;

     |SI nError = 0;
         |HAZ PresentaModelo_05;
     |SINO;
         aAlfa = "0000No se presenta el modelo de la empresa " + enEmpresa;
         aAlfa = aAlfa + " porque es una devolucion y no tiene IBAN informado.";
         |MENAV aAlfa;
     |FINSI;

     |ABRE #t1830302;  |CIERRA #t1830302;  |DELINDEX #t1830302;
     |ABRE #t1830304;  |CIERRA #t1830304;  |DELINDEX #t1830304;
|FPRC;

|DEFBUCLE dsmow014C_2018;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, dsmow014_2018;
|FIN;

|DEFBUCLE dsmow014N_2018;
     #dsmow014#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, dsmow014_2018;
|FIN;

|PROCESO Botones303_2018;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision PDF pagina hacienda ", 0513, 0654, BotonF2;
     nBtnF2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Presentacion Telematica MANUAL", 0813, 0954, BotonF3;
     nBtnF3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Borrador ", 1113, 1254, BotonF4;
     nBtnF4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, BotonEsc;
     nBtnEs = FSalida;

     eaForzExplorador = "S";

     aF2  = &255 + "824";
     aF3  = &255 + "825";
     aF4  = &255 + "826";
     aEsc = &255 + "806";

     eaOpcion  = "0";
     enTecla   = 0;
     enDirecta = 0;
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;

         |SI aTecla = aF2;  eaOpcion = "1"; |SAL;  |FINSI;
         |SI aTecla = aF3;  eaOpcion = "3"; |SAL;  |FINSI;
         |SI aTecla = aF4;  eaOpcion = "4"; |SAL;  |FINSI;
         |SI aTecla = aEsc;                 |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBtnF2;
     |FIN_CONTROL_WINDOWS nBtnF3;
     |FIN_CONTROL_WINDOWS nBtnF4;
     |FIN_CONTROL_WINDOWS nBtnEs;

     |SI eaOpcion = "1";  enTecla = 1;  |FINSI;
     |SI eaOpcion = "3";  enTecla = 3;  |FINSI;
     |SI eaOpcion = "4";  enTecla = 1;  |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO Botones303_2019;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision PDF pagina hacienda ", 0831, 0949, BotonF2;
     nBtnF2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Presentacion Telematica MANUAL", 1131, 1249, BotonF3;
     nBtnF3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F6> Presentacion Telematica DIRECTA", 1431, 1549, BotonF6;
     nBtnF6 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Borrador ", 1731, 1849, BotonF4;
     nBtnF4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2031, 2149, BotonEsc;
     nBtnEs = FSalida;

     eaForzExplorador = "S";

     aF2  = &255 + "824";
     aF3  = &255 + "825";
     aF4  = &255 + "826";
     aF6  = &255 + "828";
     aEsc = &255 + "806";

     eaOpcion  = "0";
     enDirecta = 0;
     enTecla   = 0;
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;

         |SI aTecla = aF2;  eaOpcion = "1"; |SAL;  |FINSI;
         |SI aTecla = aF3;  eaOpcion = "3"; |SAL;  |FINSI;
         |SI aTecla = aF4;  eaOpcion = "4"; |SAL;  |FINSI;

         |SI aTecla = aF6;
             |HAZ PermisoPortal;
             |SI enPortal = 1;
                 enDirecta = 1;
                 eaOpcion = "6";
                 |SAL;
             |FINSI;
         |FINSI;

         |SI aTecla = aEsc;                 |SAL;  |FINSI;
     |SIGUE;

     enParar = 1;
     |SI enDirecta = 1;  |Y enMsv = 1;
         |CONFI "0000SSolicitar confirmacion de cada empresa";
         |SI FSalida ! 0;
             enParar = 0;
         |FINSI;
     |FINSI;

     |FIN_CONTROL_WINDOWS nBtnF2;
     |FIN_CONTROL_WINDOWS nBtnF3;
     |FIN_CONTROL_WINDOWS nBtnF4;
     |FIN_CONTROL_WINDOWS nBtnF6;
     |FIN_CONTROL_WINDOWS nBtnEs;

     |SI eaOpcion = "1";  enTecla = 1;  |FINSI;
     |SI eaOpcion = "3";  enTecla = 3;  |FINSI;
     |SI eaOpcion = "4";  enTecla = 1;  |FINSI;
     |SI eaOpcion = "6";  enTecla = 1;  |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO Bloque2018;
     |SI #dsmoy000#6 [ 2018;
         |HAZ Botones303_2018;
     |FINSI;

     |SI #dsmoy000#6 ] 2019;
         |HAZ Botones303_2019;   ||Desactivar
     |FINSI;

     |SI enTecla = 0;  |ACABA;  |FINSI;

     enPresentar = 0;
     |SI eaOpcion = "3"; |Y #dsmoy000#6 < 2019;

         |CONFI "0000SPresentamos la declaracion en el momento de crearlas";
         |SI FSalida = 0;
             enPresentar = 1;
         |FINSI;
     |FINSI;

     nSwLee = 0;
     |SI #dsmoy000#8 = "C";
         |BUCLE dsmow014C_2018;
     |SINO;
         |BUCLE dsmow014N_2018;
     |FINSI;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;

     |SI enDirecta = 1;  |Y enMsv = 1;  |Y enParar = 0;
         |SUB_EJECUTA "|dsmox007";
     |FINSI;
|FPRC;

|PROCESO moy30305;
     |ABRE #dsmom107;
     |LEE 040#dsmom107.p;
     |SI FSalida ! 0;
         |CIERRA #dsmom107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #dsmom107;
     |FINSI;

     |LEE 000#dsmom107.p;
     |SI FSalida ! 0;  |DDEFECTO #dsmom107;  |FINSI;
     |CIERRA #dsmom107;

     enSwTrata      = 0;
     enCambiaMoneda = 1;

     |HAZ Bloque2018;
|FPRC;
