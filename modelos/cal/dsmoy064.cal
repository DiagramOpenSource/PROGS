|FICHEROS;
   dsmoy064 #0;

   dsmom004 #4;
   dsmod115 #15;
   dsmoc115 #115;

  :/basica/def/agifigen #118;

   dsmow032 #900;          ||Def de impresion
   dsmow116 #999;
|FIN;

|VARIABLES;

   informe    = "";
   inform1    = "dsmoy064";
   inform2    = "dsmoyt64";
   inform3    = "dsmoym64";

   aFichero   = "";
   nCampo     = 0;
   nDEmpresa  = 0;
   nHEmpresa  = 0;

   aAlfa1 = "";
   aAlfa2 = "";
   aAlfa3 = "";
   nPara1 = 0;
   nPara2 = 0;
   nPara3 = 0;
   nNume1 = 0;
   nNume2 = 0;
   nNume3 = 0;
   nNume4 = 0;
   fFecha  = @;

   &nSwLinea = 0;
   &nSwPrim  = 0;
   nSwPrint  = 0;
   nSw       = 0;
   &eaMes0   = "";
   &eaMes1   = "";
   &eaMes2   = "";
   &eaMes3   = "";
   nModelo   =  0;
   nDMes     = 0;
   nHMes     = 0;
   aDNif     = "";
   aHNif     = "";
   aNif      = "";
   nSwSi     = 0;
   aPer      = "";
   nDPeriodo = 0;
   nHPeriodo = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varlib;

|| //////////////////// Calculos de Pantalla \\\\\\\\\\\\\\\\\\\\\\\\\\

|CALCULO Tipo7;  |TIPO 7;
     fFecha = ~; aAlfa1 = fFecha;
     aAlfa1 = aAlfa1 % -104;
     #0#0 = aAlfa1;
     |PINTA #0#0;
     |SI enEmpresa ! 0;
         #0#1  = enEmpresa;  |PINTA #0#1;
         #0#2  = enEmpresa;  |PINTA #0#2;

         |C_M #0#1, 1, "N";
         |C_M #0#2, 1, "N";
     |FINSI;
|FCAL;

|CALCULO Parrilla; |TIPO 0;
     |SI #0#1 = 0;
         #0#1 = 0;  |PINTA #0#1;
         #0#2 = 0;  |PINTA #0#2;  |C_M #0#2, 1, "N";
         |PARA nCampo = 3;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#1, 1, "S";
             |C_M #0#2, 1, "S";
         |FINSI;

         |PARA nCampo = 3;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO NoMasEmpresas; |TIPO 0;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|PROCESO DesdeDni;
     |SI #0#23 = "            ";
         #0#24 = "zzzzzzzzzzzz";  |C_M #0#24,1,"N"; |PINTA #0#24;
         |PARA nCampo = 25;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |C_M #0#24,1,"S";
         |PARA nCampo = 25;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = ""; |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasDni;
     |SI #0Campo = "            ";
         |PARA nCampo = Campo + 1;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = "";  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|CALCULO Periodo_T
 |C_M #0#36, 1, "S";
 |SI #0#35 = "E"; |C_M #0#36, 1, "N";  |FINSI;
|FCAL;

|CALCULO Periodo_N;
 aAlfa1 = "";
 |SI #0#35 = "E";
     aAlfa1 = "Total Ejercicio";
 |SINO;
     |SI #0#35 = "T";
         |SI #0#36 = 1; aAlfa1 = "1§Trimestre "; |FINSI;
         |SI #0#36 = 2; aAlfa1 = "2§Trimestre "; |FINSI;
         |SI #0#36 = 3; aAlfa1 = "3§Trimestre "; |FINSI;
         |SI #0#36 = 4; aAlfa1 = "4§Trimestre "; |FINSI;
     |SINO;
         |SI #0#36 = 1;  aAlfa1 = "Enero       "; |FINSI;
         |SI #0#36 = 2;  aAlfa1 = "Febrero     "; |FINSI;
         |SI #0#36 = 3;  aAlfa1 = "Marzo       "; |FINSI;
         |SI #0#36 = 4;  aAlfa1 = "Abril       "; |FINSI;
         |SI #0#36 = 5;  aAlfa1 = "Mayo        "; |FINSI;
         |SI #0#36 = 6;  aAlfa1 = "Junio       "; |FINSI;
         |SI #0#36 = 7;  aAlfa1 = "Julio       "; |FINSI;
         |SI #0#36 = 8;  aAlfa1 = "Agosto      "; |FINSI;
         |SI #0#36 = 9;  aAlfa1 = "Septiembre  "; |FINSI;
         |SI #0#36 = 10; aAlfa1 = "Octubre     "; |FINSI;
         |SI #0#36 = 11; aAlfa1 = "Noviembre   "; |FINSI;
         |SI #0#36 = 12; aAlfa1 = "Diciembre   "; |FINSI;
     |FINSI;
 |FINSI;
 |SI aAlfa1 = "";
     |ERROR;
 |SINO;
     #0#37 = aAlfa1; |PINTA #0#37;
 |FINSI;
|FCAL;


|| **********************************************************************************
|PROCESO LeoAuxiliar;
      |PRINT;
      nSwPrint = 1;
|FPRC;

|DEFBUCLE LeoAuxiliar;
 #999#1;
 ;
 enEmpresa, enEjer, "            ";
 enEmpresa, enEjer, "zzzzzzzzzzzz";
 e;
 NULL, LeoAuxiliar;
|FIN;

|| **********************************************************************************
|PROCESO SelecNif;
 nSwSi = 0;
 |SI #0#23 ] "            ";
     |SI aNif ] #0#23; |Y aNif [ #0#24;
         nSwSi = 1;
     |FINSI;
 |SINO;
     |SI #0#25 ! "            "; |Y #0#25 = aNif; nSwSi = 1; |FINSI;
     |SI #0#26 ! "            "; |Y #0#26 = aNif; nSwSi = 1; |FINSI;
     |SI #0#27 ! "            "; |Y #0#27 = aNif; nSwSi = 1; |FINSI;
     |SI #0#28 ! "            "; |Y #0#28 = aNif; nSwSi = 1; |FINSI;
     |SI #0#29 ! "            "; |Y #0#29 = aNif; nSwSi = 1; |FINSI;
     |SI #0#30 ! "            "; |Y #0#30 = aNif; nSwSi = 1; |FINSI;
     |SI #0#31 ! "            "; |Y #0#31 = aNif; nSwSi = 1; |FINSI;
     |SI #0#32 ! "            "; |Y #0#32 = aNif; nSwSi = 1; |FINSI;
 |FINSI;
|FPRC;

|PROCESO dsmoc115;
  nSwSi = 0;
  aNif  = #115#6;
  |HAZ SelecNif;
  |SI nSwSi = 0; |ACABA; |FINSI;

  #999#0 = #115#0;
  #999#1 = #115#1;
  #999#2 = #115#6;
  |LEE 001#999=;
  |SI FSalida ! 0;
      |DDEFECTO #999;
      #999#0  = #115#0;
      #999#1  = #115#1;
      #999#2  = #115#6;
      #999#3  = #115#26;
      |GRABA 020#999c;
  |FINSI;

  |SI aPer = "T";
      |SI #0#35 = "E";
          nDMes = 1; nHMes = 3;
          |SI #115#2 =  3; nNume1 = 4;  |FINSI;
          |SI #115#2 =  6; nNume1 = 16; |FINSI;
          |SI #115#2 =  9; nNume1 = 28; |FINSI;
          |SI #115#2 = 12; nNume1 = 40; |FINSI;
      |FINSI;
      |SI #0#35 = "M";
          nNume1 = 4;
          |SI #0#36 = 1; |O #0#36 = 4; |O #0#36 = 7; |O #0#6 = 10; nDMes = 1; nHMes = 1; |FINSI;
          |SI #0#36 = 2; |O #0#36 = 5; |O #0#36 = 8; |O #0#6 = 11; nDMes = 2; nHMes = 2; |FINSI;
          |SI #0#36 = 3; |O #0#36 = 6; |O #0#36 = 9; |O #0#6 = 12; nDMes = 3; nHMes = 3; |FINSI;
      |FINSI;
      |SI #0#35 = "T";
          nNume1 = 4;
          nDMes  = 1; nHMes = 3;
      |FINSI;
   |FINSI;

   |SI aPer = "M";
       nDMes = 1; nHMes = 1;
       |SI #0#35 = "E";
           nNume1 = #115#2 * 4;
       |FINSI;
       |SI #0#35 = "T";
           |SI #115#2 = 1; |O #115#2 = 4; |O #115#2 = 7; |O #115#2 = 10; nNume1 = 4;  |FINSI;
           |SI #115#2 = 2; |O #115#2 = 5; |O #115#2 = 8; |O #115#2 = 11; nNume1 = 8;  |FINSI;
           |SI #115#2 = 3; |O #115#2 = 6; |O #115#2 = 9; |O #115#2 = 12; nNume1 = 12; |FINSI;
      |FINSI;
      |SI #0#35 = "M";
          |SI #0#36 ! #115#2; |ACABA; |FINSI;
          nNume1 = 4;
      |FINSI;
   |FINSI;

   |PARA nPara3 = nDMes; |SI nPara3 [ nHMes; |HACIENDO nPara3 = nPara3 + 1;
         |SI nPara3 = 1;
             #999nNume1 = #999nNume1 + #115#8;  nNume1 = nNume1 + 1;
             #999nNume1 = #999nNume1 + #115#10; nNume1 = nNume1 + 1;
             #999nNume1 = #999nNume1 + #115#11; nNume1 = nNume1 + 1;
             #999nNume1 = #999nNume1 + #115#13; nNume1 = nNume1 + 1;
         |FINSI;
         |SI nPara3 = 2;
             #999nNume1 = #999nNume1 + #115#14; nNume1 = nNume1 + 1;
             #999nNume1 = #999nNume1 + #115#16; nNume1 = nNume1 + 1;
             #999nNume1 = #999nNume1 + #115#17; nNume1 = nNume1 + 1;
             #999nNume1 = #999nNume1 + #115#19; nNume1 = nNume1 + 1;
         |FINSI;
         |SI nPara3 = 3;
             #999nNume1 = #999nNume1 + #115#20; nNume1 = nNume1 + 1;
             #999nNume1 = #999nNume1 + #115#22; nNume1 = nNume1 + 1;
             #999nNume1 = #999nNume1 + #115#23; nNume1 = nNume1 + 1;
             #999nNume1 = #999nNume1 + #115#25; nNume1 = nNume1 + 1;
         |FINSI;
   |SIGUE;

   #999#52 = 0;  #999#53 = 0;  #999#54 = 0;  #999#55 = 0;
   |PARA nPara3 = 4; |SI nPara3 [ 51; |HACIENDO nPara3 = nPara3 + 4;
         nNume1 = nPara3;
         #999#52 = #999#52 + #999nNume1;  nNume1 = nNume1 + 1;
         #999#53 = #999#53 + #999nNume1;  nNume1 = nNume1 + 1;
         #999#54 = #999#54 + #999nNume1;  nNume1 = nNume1 + 1;
         #999#55 = #999#55 + #999nNume1;
   |SIGUE;

   |GRABA 020#999a;
   nSw = 1;
|FPRC;

|DEFBUCLE dsmoc115;
  #115#1;
  ;
  #15#0, #15#1,#15#2, #15#3, #15#4, 00, aDNif, 0000, 01;
  #15#0, #15#1,#15#2, #15#3, #15#4, 99, aHNif, 9999, 99;
  e;
  NULL, dsmoc115;
|FIN;

|PROCESO agifigen;
  enEmpresa = #118#0;
  |HAZ DatosEmpr_w32;

  |DELINDEX #999;
  nSw    = 0;
  |ABRE #999;
  |PARA nPara2 = nDPeriodo; |SI nPara2 [ nHPeriodo; |HACIENDO nPara2 = nPara2 + 1;
        #15#0 = enEmpresa;
        #15#1 = enEjer;
        #15#2 = nPara2;
        #15#3 = nModelo;
        #15#4 = 99;
        #15#5 = 0;
        |LEE 040#15];
        |SI FSalida = 0;
            |LEE 040#15a;
        |SINO;
            |LEE 040#15u;
        |FINSI;
        |SI FSalida = 0; |Y #15#0 = enEmpresa; |Y #15#1 = enEjer;
             |Y #15#2 = nPara2; |Y #15#3 = nModelo;
               aPer = "T";
               |DDEFECTO #4;
               #4#0 = #15#0;
               #4#1 = #15#1;
               #4#2 = #15#2;
               #4#3 = #15#3;
               #4#4 = #15#4;
               |LEE 041#4=;
               |SI #4#22 ! " "; aPer = #4#22; |FINSI;

               |BUCLE dsmoc115;
        |FINSI;
  |SIGUE;
  |CIERRA #999;

  |SI nSw = 1;
      nSwPrim  = 0;
      nSwPrint = 0;
      |BUCLE LeoAuxiliar;
      |SI nSwPrint = 1;
          |PIEINF;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE agifigen;
  #118#1;
  ;
  nDEmpresa;
  nHEmpresa;
  ;
  NULL, agifigen;
|FIN;


|CALCULO Tipo3;  |TIPO 3;

    nModelo = 115;
    enEjer = #0#0;
    aAlfa2 = #0#0;
    aAlfa1 = "01.01." + aAlfa2;
    aAlfa2 = "31.12." + aAlfa2;
    efDFecha  = aAlfa1;     efHFecha  = aAlfa2;
    eaTituloL = #0#34;

    |SI #0#35 = "E";
        informe   = inform1;
        nDPeriodo = 01;
        nHPeriodo = 12;
        |MENAV "0000 Recuerde seleccionar el papel de la impresora en Horizontal";
    |SINO;
        |SI #0#35 = "T";
            informe   = inform2;
            |SI #0#36 = 1;
                eaMes1 = "     ENERO";
                eaMes2 = "   FEBRERO";
                eaMes3 = "     MARZO";
                nDPeriodo = 01; nHPeriodo = 03;
            |FINSI;
            |SI #0#36 = 2;
                eaMes1 = "     ABRIL";
                eaMes2 = "      MAYO";
                eaMes3 = "     JUNIO";
                nDPeriodo = 04; nHPeriodo = 06;
            |FINSI;
            |SI #0#36 = 3;
                eaMes1 = "     JULIO";
                eaMes2 = "    AGOSTO";
                eaMes3 = "SEPTIEMBRE";
                nDPeriodo = 07; nHPeriodo = 09;
            |FINSI;
            |SI #0#36 = 4;
                eaMes1 = "   OCTUBRE";
                eaMes2 = " NOVIEMBRE";
                eaMes3 = " DICIEMBRE";
                nDPeriodo = 10; nHPeriodo = 12;
            |FINSI;
        |SINO;
            informe   = inform3;
            |SI #0#36 = 1;  |O #0#36 = 2;  |O #0#36 = 3;  nHPeriodo = 3;  |FINSI;
            |SI #0#36 = 4;  |O #0#36 = 5;  |O #0#36 = 6;  nHPeriodo = 6;  |FINSI;
            |SI #0#36 = 7;  |O #0#36 = 8;  |O #0#36 = 9;  nHPeriodo = 9;  |FINSI;
            |SI #0#36 = 10; |O #0#36 = 11; |O #0#36 = 12; nHPeriodo = 12; |FINSI;
            nDPeriodo = nHPeriodo - 3;
        |FINSI;
    |FINSI;
    eaMes0 = #0#37; |QBF eaMes0;
    eaMes0 = eaMes0 > " ";
    |SI #0#35 = "T"; eaMes0 = ("            " + eaMes0) % -112; |FINSI;

    |SI #0#23 ] "            ";
        aDNif = #0#23; aHNif = #0#24;
    |SINO;
        aDNif  = "            ";
        aHNif  = "zzzzzzzzzzzz";
    |FINSI;

    aFichero = ("w8" + Usuario) % -108;
  ||  |NOME_DAT #999 aFichero;

    |IMPRE 0;
    |SI FSalida ! 0;  |ACABA;  |FINSI;

    |INFOR informe;
    |SI FSalida ! 0;  |FINIMP; |ACABA;  |FINSI;

    |ABRE #4;
    |ABRE #15;
    |SI #0#1 ! 0;
        nDEmpresa = #0#1;
        nHEmpresa = #0#2;
        |BUCLE agifigen;
    |SINO;
        |PARA nPara1 = 3;  |SI nPara1 [ 22;  |HACIENDO nPara1 = nPara1 + 1;
              |SI #0nPara1 ! 0;
                  nDEmpresa = #0nPara1;
                  nHEmpresa = #0nPara1;
                  |BUCLE agifigen;
              |FINSI;
        |SIGUE;
    |FINSI;
    |CIERRA #15;
    |CIERRA #4;

    |FININF;
    |FINIMP;
|FCAL;
