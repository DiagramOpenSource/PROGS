|FICHEROS;
     dsmoy000 #0;
     dsmom001 #1;
     dsmom004 #4;
     dsmom107 #107;

     dsm180ca #180;
     dsm180li #181;

     dsmow014 #999;
     dsmow015 #998;
     dsmow016 #997;

     dsmow522 #522;
     dsmow523;
     dsmow524;
     dsmow525;
     dsmow611 #611;

     :/basica/def/agicen17 #17;
     :/basica/def/agim0024 #24;
     :/basica/def/agim0026 #26;

     &regisnif@ #709;
     &clientes@ #715;
|FIN;

|VARIABLES;
|FIN;

|INCLUYE i_varemi;

|PROCESO ComparaSiglas;
    |QBF aAlfa;
    |SI aAlfa = "AL";  aAlfa = "ALAM ";  |FINSI;
    |SI aAlfa = "AD";  aAlfa = "ALDEA";  |FINSI;
    |SI aAlfa = "AP";  aAlfa = "APTOS";  |FINSI;
    |SI aAlfa = "AR";  aAlfa = "ARRAL";  |FINSI;
    |SI aAlfa = "AY";  aAlfa = "ARRY ";  |FINSI;
    |SI aAlfa = "AV";  aAlfa = "AVDA ";  |FINSI;
    |SI aAlfa = "BJ";  aAlfa = "BJADA";  |FINSI;
    |SI aAlfa = "BR";  aAlfa = "BRANC";  |FINSI;
    |SI aAlfa = "BO";  aAlfa = "BARRO";  |FINSI;
    |SI aAlfa = "BL";  aAlfa = "BLQUE";  |FINSI;
    |SI aAlfa = "CL";  aAlfa = "CALLE";  |FINSI;
    |SI aAlfa = "CJ";  aAlfa = "CLLJA";  |FINSI;
    |SI aAlfa = "CM";  aAlfa = "CMNO ";  |FINSI;
    |SI aAlfa = "CR";  aAlfa = "CTRA ";  |FINSI;
    |SI aAlfa = "CS";  aAlfa = "CSRIO";  |FINSI;
    |SI aAlfa = "CO";  aAlfa = "COL  ";  |FINSI;
    |SI aAlfa = "CN";  aAlfa = "CJTO ";  |FINSI;
    |SI aAlfa = "CT";  aAlfa = "CUSTA";  |FINSI;
    |SI aAlfa = "CH";  aAlfa = "CHLET";  |FINSI;
    |SI aAlfa = "ED";  aAlfa = "EDIFC";  |FINSI;
    |SI aAlfa = "EN";  aAlfa = "ENTD ";  |FINSI;
    |SI aAlfa = "ES";  aAlfa = "ESCAL";  |FINSI;
    |SI aAlfa = "EX";  aAlfa = "EXPLA";  |FINSI;
    |SI aAlfa = "EM";  aAlfa = "EXTRM";  |FINSI;
    |SI aAlfa = "ER";  aAlfa = "EXTRR";  |FINSI;
    |SI aAlfa = "GL";  aAlfa = "GTA  ";  |FINSI;
    |SI aAlfa = "GV";  aAlfa = "G.V. ";  |FINSI;
    |SI aAlfa = "GR";  aAlfa = "GRUPO";  |FINSI;
    |SI aAlfa = "JR";  aAlfa = "JDIN ";  |FINSI;
    |SI aAlfa = "LG";  aAlfa = "LUGAR";  |FINSI;
    |SI aAlfa = "MS";  aAlfa = "MASIA";  |FINSI;
    |SI aAlfa = "MC";  aAlfa = "MERC ";  |FINSI;
    |SI aAlfa = "MT";  aAlfa = "MONTE";  |FINSI;
    |SI aAlfa = "ML";  aAlfa = "MUELL";  |FINSI;
    |SI aAlfa = "PQ";  aAlfa = "PQUE ";  |FINSI;
    |SI aAlfa = "PQ";  aAlfa = "PQUE ";  |FINSI;
    |SI aAlfa = "PD";  aAlfa = "PTDA ";  |FINSI;
    |SI aAlfa = "PJ";  aAlfa = "PSAJE";  |FINSI;
    |SI aAlfa = "PS";  aAlfa = "PASEO";  |FINSI;
    |SI aAlfa = "PZ";  aAlfa = "PLAZA";  |FINSI;
    |SI aAlfa = "PB";  aAlfa = "PBDO ";  |FINSI;
    |SI aAlfa = "PG";  aAlfa = "POLIG";  |FINSI;
    |SI aAlfa = "PR";  aAlfa = "PROL ";  |FINSI;
    |SI aAlfa = "PT";  aAlfa = "PNTE ";  |FINSI;
    |SI aAlfa = "PU";  aAlfa = "PTA  ";  |FINSI;
    |SI aAlfa = "RM";  aAlfa = "RAMAL";  |FINSI;
    |SI aAlfa = "RB";  aAlfa = "RBLA ";  |FINSI;
    |SI aAlfa = "RP";  aAlfa = "RAMPA";  |FINSI;
    |SI aAlfa = "RR";  aAlfa = "RIERA";  |FINSI;
    |SI aAlfa = "RC";  aAlfa = "RCON ";  |FINSI;
    |SI aAlfa = "RD";  aAlfa = "RONDA";  |FINSI;
    |SI aAlfa = "RU";  aAlfa = "RUA  ";  |FINSI;
    |SI aAlfa = "SC";  aAlfa = "SECT ";  |FINSI;
    |SI aAlfa = "SD";  aAlfa = "SENDA";  |FINSI;
    |SI aAlfa = "SB";  aAlfa = "SBIDA";  |FINSI;
    |SI aAlfa = "TO";  aAlfa = "TRRNT";  |FINSI;
    |SI aAlfa = "TR";  aAlfa = "TRVA ";  |FINSI;
    |SI aAlfa = "UR";  aAlfa = "URB  ";  |FINSI;
    |SI aAlfa = "VI";  aAlfa = "VIA  ";  |FINSI;
    |SI aAlfa = "VP";  aAlfa = "VIA  ";  |FINSI;
|FPRC;

|PROCESO Registro180_0;
     |DDEFECTO #522;

     #522#0  = "0";

     #522#1  = "180";

     #522#2  = #0#6;

     eaVarDni = #997#0;  |HAZ CalculameDNI;
     #522#3  = eaVarDni;

     eaAlfa  = #997#1;  |HAZ QuitaRaros;
     #522#4  = eaAlfa;

     #522#5  = #997#2;

     eaAlfa  = #997#3;  |HAZ QuitaRaros;
     #522#6  = eaAlfa;

     nNume   = #997#4;
     #522#7  = (("00000" + nNume) % -105):

     #522#8  = #997#5;

     #522#9  = #997#6;

     #522#10 = #997#7;

     #522#11 = (("00" + #997#8) % -102) + (("000" + #997#9) % -103);

     eaAlfa  = #997#10;  |HAZ QuitaRaros;
     #522#12 = eaAlfa;

     #522#13 = (("00" + #997#8) % -102);

     #522#14 = (("00000" + #997#17) % -105);

     #522#15 = (("000000000" + #997#18) % -109);

     #522#16 = "D";

     eaAlfa  = #997#14;  |HAZ QuitaRarosTfno;
     #522#17 = eaAlfa;

     eaAlfa  = #997#13;  |HAZ QuitaRaros;
     #522#18 = eaAlfa;

     #522#20 = &13 + &10;

     |SI nTecla ! 2;  |Y nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 20;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #522nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |FINSI;
|FPRC;

|PROCESO Registro180_1;
     enCodCli = #180#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow523;

     #dsmow523#0  = "1";

     #dsmow523#1  = "180";

     #dsmow523#2  = #180#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #dsmow523#3   = eaVarDni;

         eaAlfa   = #715#1;  |HAZ QuitaRaros;
         #dsmow523#4   = eaAlfa;

         eaAlfa   = #715#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #715#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #dsmow523#6   = eaAlfa;

         eaAlfa   = #715#53;  |HAZ QuitaRaros;
         #dsmow523#7   = eaAlfa;

         eaDeleg     = #715#17;
         eaAdmin     = #715#18;
         eaProvincia = #715#38;
     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #dsmow523#3   = eaVarDni;

         eaAlfa   = #715#1;   |HAZ QuitaRaros;
         #dsmow523#4   = eaAlfa;

         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;
         #dsmow523#6   = eaAlfa;

         eaAlfa   = #715#96;  |HAZ QuitaRaros;
         #dsmow523#7   = eaAlfa;

         eaDeleg     = #715#91;
         eaAdmin     = #715#92;
         eaProvincia = #715#12;
     |FINSI;

     |SI #0#6 [ 2005;
         #dsmow523#5  = "D";
     |SINO;
         #dsmow523#5  = "T";
     |FINSI;

     |SI #0#6 < 2014;
         #dsmow523#8 = "1670000000000";
     |SINO;
         #dsmow523#8 = "1800000000000";
     |FINSI;

     |SI enDirecta = 1;
         |HAZ CalcJustificante;
         #dsmow523#8 = eaJusti;
     |FINSI;

     nNume   = #180#6;
     #dsmow523#12 = ("000000000" + nNume) % -109;

     enNume  = #180#7;  |HAZ Conver15Signo;
     #dsmow523#13 = eaSigno;
     #dsmow523#14 = eaAlfa;

     enNume  = #180#8;  |HAZ Conver15Signo;
     #dsmow523#15 = eaAlfa;

     |SI #180#10 = "C";  #dsmow523#9  = "C";  |FINSI;

     |SI #180#10 = "S";
         #dsmow523#10 = "S";
         #dsmow523#11 = #180#9;
     |FINSI;

     #dsmow523#17 = &13 + &10;

     nHCampo = 17;
     |SI #dsmoy000#6 ] 2012;   |Y eaOpcion ! "3";
         nHCampo = 16;
     |FINSI;

     |SI nTecla ! 2;  |Y nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #dsmow523#nCampo#;
               |XGRABA nHandle2, aAlfa;

               |SI #0#6 ] 2014; |Y nCampo = 16;
                  aAlfa = " " * 250;
                  |XGRABA nHandle2, aAlfa;
               |FINSI;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |FINSI;
|FPRC;

|PROCESO Registro180_2;
     enCodCli = #180#0;
     |HAZ LeePersona;

     |SI #0#6 ] 2014; |Y nTecla ! 5;
         |HAZ Registro180_2_14;
         |ACABA;
     |FINSI;

     |DDEFECTO #dsmow524;

     #dsmow524#0  = "2";

     #dsmow524#1  = "180";

     #dsmow524#2  = #180#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #dsmow524#3   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #dsmow524#3   = eaVarDni;
     |FINSI;

     eaVarDni = #181#6;  |HAZ CalculameDNI;
     |SI #181#9 = "N";
         #dsmow524#4 = eaVarDni;
     |SINO;
         #dsmow524#5 = eaVarDni;
     |FINSI;

     eaAlfa = #181#10;  |HAZ QuitaRaros;
     #dsmow524#6 = eaAlfa;

     #dsmow524#7  = ("00" + #181#14) % -102;
     #dsmow524#8  = #181#7;

     enNume  = #181#11;  |HAZ Conver13Signo;
     #dsmow524#9  = eaSigno;
     #dsmow524#10 = eaAlfa;

     |SI #0#6 < 2015;
         |SI #0#6 [ 2006;
             |SI #181#12 ! 15;  |Y #181#12 ! 7.5;  |Y #181#12 > 0;
                 |SI #181#12 > 10;  #181#12 = 15;   |FINSI;
                 |SI #181#12 [ 10;  #181#12 = 7.5;  |FINSI;
             |FINSI;
         |SINO;
             |SI #0#6 [ 2009;
                 |SI #181#12 ! 18;  |Y #181#12 ! 9;  |Y #181#12 > 0;
                     |SI #181#12 > 10;  #181#12 = 18;   |FINSI;
                     |SI #181#12 [ 10;  #181#12 = 9;    |FINSI;
                 |FINSI;
             |FINSI;

             |SI #0#6 ] 2010;
                 |SI #181#12 ! 19;  |Y #181#12 ! 9;  |Y #181#12 > 0;
                     |SI #181#12 > 10;  #181#12 = 19;   |FINSI;
                     |SI #181#12 [ 10;  #181#12 = 9;    |FINSI;
                 |FINSI;
             |FINSI;

             |SI #0#6 ] 2012;
                 |SI #181#12 ! 21;  |Y #181#12 ! 10.5;  |Y #181#12 > 0;
                     |SI #181#12 ] 11;  #181#12 = 21;    |FINSI;
                     |SI #181#12 < 11;  #181#12 = 10.5;  |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     nNume   = #181#12 * 100;
     #dsmow524#11 = ("0000" + nNume) % -104;

     enNume  = #181#13;  |HAZ Conver13Signo;
     #dsmow524#12 = eaAlfa;

     #dsmow524#13 = ("0000" + #181#8) % -104;

     #dsmow524#15 = &13 + &10;

     nHCampo = 15;
     |SI #dsmoy000#6 ] 2012;   |Y eaOpcion ! "3";
         nHCampo = 14;
     |FINSI;

     |SI nTecla ! 2;  |Y nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #dsmow524#nCampo#;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |SINO;
         |SI nTecla ! 5;
             nContador = nContador + 1;
             nSwPrint = 1;
             |SI nContador > 5;  nContador = 1;  |PIEINF;  |FINSI;
         |SINO;
             nSwPrint = 1;  ||ABDON 11/01/2006   Tiquet 3184/249
         |FINSI;

         |PRINT;
     |FINSI;
|FPRC;

|PROCESO Registro180_2_14;
     |DDEFECTO #611;

     #611#0  = "2";

     #611#1  = "180";

     #611#2  = #180#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #611#3   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #611#3   = eaVarDni;
     |FINSI;

     eaVarDni = #181#6;  |HAZ CalculameDNI;
     |SI #181#9 = "N";
         #611#4 = eaVarDni;
     |SINO;
         #611#5 = eaVarDni;
     |FINSI;

     eaAlfa = #181#10;
     #611#6 = eaAlfa;

     #611#7  = ("00" + #181#14) % -102;
     #611#8  = #181#7;

     enNume  = #181#11;  |HAZ Conver13Signo;
     #611#9  = eaSigno;
     #611#10 = eaAlfa;

     |SI #0#6 [ 2014;
         |SI #181#12 ! 21;  |Y #181#12 ! 10.5;  |Y #181#12 > 0;
             |SI #181#12 ] 11;  #181#12 = 21;    |FINSI;
             |SI #181#12 < 11;  #181#12 = 10.5;  |FINSI;
         |FINSI;
     |FINSI;

     |SI #0#6 = 2015;
         |SI #181#12 ! 20;    |Y #181#12 ! 19.5;
          |Y #181#12 ! 10;    |Y #181#12 ! 9.75;
          |Y #181#12 > 0;
             |SI #181#12 < 20;  #181#12 = 19.5;  |FINSI;
             |SI #181#12 < 12;  #181#12 = 10;    |FINSI;
             |SI #181#12 < 10;  #181#12 = 9.75;  |FINSI;
             |SI #181#12 ] 20;  #181#12 = 20;    |FINSI;
         |FINSI;
     |FINSI;

     nNume   = #181#12 * 100;
     #611#11 = ("0000" + nNume) % -104;

     enNume  = #181#13;  |HAZ Conver13Signo;
     #611#12 = eaAlfa;

     #611#13 = ("0000" + #181#8) % -104;

     #611#14 = #181#27;   || Situacion Inmueble

     eaAlfa  = #181#16;  #611#15 = eaAlfa;   || Ref. Catastral

     aAlfa   = #181#21;  |HAZ ComparaSiglas;  #611#16 = aAlfa;    || SG

     eaAlfa  = #181#22;  #611#17 = eaAlfa;
     |SI #181#23 ! "    "; #611#18 = "NUM"; |FINSI;

     nNume = #181#23;
     #611#19 = ( "00000" + nNume) % -105; || Numero Casa

     #611#23 = #181#24; || Escalera
     #611#24 = #181#25; || Piso
     #611#25 = #181#26; || Puerta

     eaAlfa = #181#19;   #611#28 = eaAlfa; || Municipio
     #611#29 = #181#28;  || Codigo Municipio

     #611#30 = ("00" + #181#17) % -102;
     #611#31 = (("00" + #181#17) % -102) + (("000" + #181#18) % -103);

     #611#33 = &13 + &10;

     nHCampo = 33;
     |SI eaOpcion ! "3";
         nHCampo = 32;
     |FINSI;

     |SI nTecla ! 2;  |Y nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               eaAlfa = #611nCampo;
               |SI nCampo ! 33;  |HAZ QuitaRaros; |FINSI;
               |XGRABA nHandle2, eaAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |SINO;
         |SI nTecla ! 5;
             nContador = nContador + 1;
             nSwPrint = 1;
             |SI nContador > 5;  nContador = 1;  |PIEINF;  |FINSI;
         |SINO;
             nSwPrint = 1;
         |FINSI;

         |PRINT;
     |FINSI;
|FPRC;

|PROCESO BuscaCargo180;
     eaAlfa  = #26#4;  |HAZ QuitaRaros;
     #dsmow525#13 = eaAlfa;

     eaAlfa  = #26#17;  |HAZ QuitaRaros;
     #dsmow525#14 = eaAlfa;
|FPRC;

|DEFBUCLE agim0026;
     #26#1;
     16;
     #180#0, 01, 01, 3;
     #180#0, 99, 99, 3;
     ;
     NULL, BuscaCargo180;
|FIN;

|PROCESO BuscaCargo180R;
     |SI #24#15 ! "A";
         eaAlfa  = #24#4;  |HAZ QuitaRaros;
         #dsmow525#13 = eaAlfa;

         eaAlfa  = "REPRESENTANTE";  |HAZ QuitaRaros;
         #dsmow525#14 = eaAlfa;

         nHayRepre = 1;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE agim0024;
     #24#2;
     ;
     #180#0, 99, 01;
     #180#0, 01, 99;
     ;
     NULL, BuscaCargo180R;
|FIN;

|PROCESO BuscaComuneros180;
     aAlfa = "31.12." + #180#1;
     |SI #1#8 > aAlfa;  |ACABA;  |FINSI;

     aAlfa = "01.01." + #180#1;
     |SI #1#9 > "01.01.0000";
         |SI #1#9 < aAlfa;  |ACABA;  |FINSI;
     |FINSI;

     nHayRepre = 1;

     enCodCli = #1#3;
     |HAZ LeePersona;

     eaAlfa  = #715#1;           |HAZ QuitaRaros;   #dsmow525#13 = eaAlfa;
     eaAlfa  = "REPRESENTANTE";  |HAZ QuitaRaros;   #dsmow525#14 = eaAlfa;

     |ERROR10;
|FPRC;

|DEFBUCLE dsmom001;
     #1#1;
     ;
     #180#0, 01, 0001;
     #180#0, 99, 9999;
     ;
     NULL, BuscaComuneros180;
|FIN;

|PROCESO Registro180_Auxiliar0;
     |DDEFECTO #dsmow525;

     #dsmow525#0  = "0";

     #dsmow525#1  = "180";

     #dsmow525#2  = #180#1;

     eaVarDni = #997#0;  |HAZ CalculameDNI;
     #dsmow525#3   = eaVarDni;

     #dsmow525#4   = ("00" + #997#11) % -102;

     #dsmow525#5   = ("000" + #997#12) % -103;

     #dsmow525#6   = #997#2;

     eaAlfa   = #997#3;  |HAZ QuitaRaros;
     #dsmow525#7   = eaAlfa;

     nNume    = #997#4;
     #dsmow525#8   = ("00000" + nNume) % -105;

     eaAlfa   = #997#10;  |HAZ QuitaRaros;
     #dsmow525#9   = eaAlfa;

     #dsmow525#10  = ("00" + #997#8) % -102;

     #dsmow525#11  = (("00" + #997#8) % -102) + (("000" + #997#9) % -103);

     #dsmow525#12  = (#0#7 % -104) + (#0#7 % 402) + (#0#7 % 102);

     eaAlfa   = #997#15;  |HAZ QuitaRaros;
     #dsmow525#13  = eaAlfa;

     eaAlfa   = #997#16;  |HAZ QuitaRaros;
     #dsmow525#14  = eaAlfa;

     #dsmow525#16  = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 0;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |SI #0#6 = 2001;
                   |SI nCampo ! 15;
                       aAlfa = #dsmow525#nCampo#;
                       |XGRABA nHandle3, aAlfa;
                   |FINSI;
               |SINO;
                   aAlfa = #dsmow525#nCampo#;
                   |XGRABA nHandle3, aAlfa;
               |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Registro180_Auxiliar1;
     enCodCli = #180#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow525;

     #dsmow525#0  = "1";

     #dsmow525#1  = "180";

     #dsmow525#2  = #180#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #dsmow525#3   = eaVarDni;

         #dsmow525#4   = ("00" + #715#15) % -102;

         #dsmow525#5   = ("000" + #715#16) % -103;

         #dsmow525#6   = #715#29;

         eaAlfa   = #715#30;  |HAZ QuitaRaros;
         #dsmow525#7   = eaAlfa;

         nNume    = #715#31;
         #dsmow525#8   = ("00000" + nNume) % -105;

         #dsmow525#9   = #715#37;

         #dsmow525#10  = ("00" + #715#35) % -102;

         #dsmow525#11  = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #dsmow525#3   = eaVarDni;

         #dsmow525#4   = ("00" + #715#63) % -102;

         #dsmow525#5   = ("000" + #715#64) % -103;

         #dsmow525#6   = #715#3;

         eaAlfa   = #715#4;  |HAZ QuitaRaros;
         #dsmow525#7   = eaAlfa;

         nNume    = #715#5;
         #dsmow525#8   = ("00000" + nNume) % -105;

         #dsmow525#9   = #715#11;

         #dsmow525#10  = ("00" + #715#9) % -102;

         #dsmow525#11  = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
     |FINSI;

     #dsmow525#12  = (#0#7 % -104) + (#0#7 % 402) + (#0#7 % 102);

     |SI nTecla ! 4;
         |SI #107#1 = "S";
             |BUCLE agim0026;
         |SINO;
             nHayRepre = 0;
             |BUCLE agim0024;
             |SI nHayRepre = 0;
                 |BUCLE dsmom001;
                 |SI nHayRepre = 0;
                     eaAlfa  = #dsmow014#3;  |HAZ QuitaRaros;
                     #dsmow525#13 = eaAlfa;

                     eaAlfa  = "TITULAR";  |HAZ QuitaRaros;
                     #dsmow525#14 = eaAlfa;
                 |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         |SI #107#2 = "P";
             eaAlfa   = #997#15;  |HAZ QuitaRaros;
             #dsmow525#13  = eaAlfa;

             eaAlfa   = #997#16;  |HAZ QuitaRaros;
             #dsmow525#14  = eaAlfa;
         |SINO;
             nHayRepre = 0;
             |BUCLE agim0024;
             |SI nHayRepre = 0;
                 |BUCLE dsmom001;
                 |SI nHayRepre = 0;
                     eaAlfa  = #dsmow014#3;  |HAZ QuitaRaros;
                     #dsmow525#13 = eaAlfa;

                     eaAlfa  = "TITULAR";  |HAZ QuitaRaros;
                     #dsmow525#14 = eaAlfa;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     #dsmow525#15 = ("00000" + #dsmow014#0) % -105;
     #dsmow525#16 = &13 + &10;

     |SI nTecla ! 2;  |Y nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               |SI #0#6 = 2001;
                   |SI nCampo ! 15;
                       aAlfa = #dsmow525#nCampo#;
                       |XGRABA nHandle3, aAlfa;
                   |FINSI;
               |SINO;
                   aAlfa = #dsmow525#nCampo#;
                   |XGRABA nHandle3, aAlfa;
               |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|DEFBUCLE dsm180li;
     #181#1;
     ;
     #180#0, #180#1, #180#2, #180#3, #180#4, #180#5, "            ", 1, 0000, 01;
     #180#0, #180#1, #180#2, #180#3, #180#4, #180#5, "zzzzzzzzzzzz", 2, 9999, 99;
     ;
     NULL, Registro180_2;
|FIN;

|PROCESO Lee1800;       || Calculo Total de Declarantes y Declarados
     |ABRE #4;
     #4#0  = #dsmow014#0;
     #4#1  = #dsmow014#1;
     #4#2  = #dsmow014#2;
     #4#3  = #dsmow014#5;
     #4#4  = #dsmow014#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #180;
     #180#0  = #dsmow014#0;
     #180#1  = #dsmow014#1;
     #180#2  = #dsmow014#2;
     #180#3  = #dsmow014#5;
     #180#4  = #dsmow014#7;
     #180#5  = 0;
     |LEE 040#180=;
     |SI FSalida = 0;
         #997#17 = #997#17 + 1;
         #997#18 = #997#18 + #180#6;
     |FINSI;
     |CIERRA #180;
|FPRC;

|PROCESO Lee1801;        || Creacion de Ficheros
     |ABRE #4;
     #4#0  = #dsmow014#0;
     #4#1  = #dsmow014#1;
     #4#2  = #dsmow014#2;
     #4#3  = #dsmow014#5;
     #4#4  = #dsmow014#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #180;
     #180#0  = #dsmow014#0;
     #180#1  = #dsmow014#1;
     #180#2  = #dsmow014#2;
     #180#3  = #dsmow014#5;
     #180#4  = #dsmow014#7;
     #180#5  = 0;
     |LEE 040#180=;
     |SI FSalida = 0;
         |SI nTecla = 1;
             |SI #0#6 ] 2006;
                 |SI #180#6 > 15;
                     aAlfa = "0000 Empresa " + (("00000" + #180#0) % -105) + " mas de 15 Perceptores, emitir por Internet";
                     |MENAV aAlfa;
                     |ACABA;
                 |FINSI;
             |FINSI;

             aAbre = eaPathEmision + "RTA" + (("00000" + #dsmow014#0) % -105) + ".TXT";
             |XABRE "BW", aAbre, nHandle2;

             aAbre = eaPathEmision + "RTB" + (("00000" + #dsmow014#0) % -105) + ".TXT";
             |XABRE "BW", aAbre, nHandle3;
         |FINSI;

         |HAZ Registro180_1;

         |BUCLE dsm180li;

         |HAZ Registro180_Auxiliar1;

         |SI nTecla = 1;
             |XCIERRA nHandle2;
             |XCIERRA nHandle3;

             eaFOrigen  = eaPathEmision + "RTA" + (("00000" + #dsmow014#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza + "RTA" + (("00000" + #dsmow014#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             eaFOrigen  = eaPathEmision + "RTB" + (("00000" + #dsmow014#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza + "RTB" + (("00000" + #dsmow014#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             |SI #0#6 [ 2005;
                 aAlfa = "wait 180pdf /E:RTA" + (("00000" + #dsmow014#0) % -105) + ".TXT ";
                 aAlfa = aAlfa + "/R:RTC" + (("00000" + #dsmow014#0) % -105) + ".TXT ";
                 aAlfa = aAlfa + "/I: ";
                 aAlfa = aAlfa + "/C:" + aTercera + " ";
                 aAlfa = aAlfa + "/F:FLAG.TXT ";
                 aAlfa = aAlfa + "/A:RTB" + (("00000" + #dsmow014#0) % -105) + ".TXT ";
                 aAlfa = aAlfa + &13 + &10;
                 |XGRABA nHandle1, aAlfa;
             |SINO;
                 eaTipoE =  "RTA" + (("00000" + #dsmow014#0) % -105) + ".TXT";
                 eaTipoR =  "RTC" + (("00000" + #dsmow014#0) % -105) + ".TXT";
                 eaTipoP =  "PDF" + (("00000" + #dsmow014#0) % -105) + ".PDF";

                 |SI nTecla = 1;
                     eaTipoC =  aTercera;
                     eaTipoA =  "RTB" + (("00000" + #dsmow014#0) % -105) + ".TXT";
                     eaTipoV =  "N";
                 |SINO;
                     eaTipoV =  "S";
                 |FINSI;

                 |HAZ LineaShellJava;
             |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #180;
|FPRC;

|PROCESO Lee180P;       || Emision Papel
     |ABRE #4;
     #4#0  = #dsmow014#0;
     #4#1  = #dsmow014#1;
     #4#2  = #dsmow014#2;
     #4#3  = #dsmow014#5;
     #4#4  = #dsmow014#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #180;
     #180#0  = #dsmow014#0;
     #180#1  = #dsmow014#1;
     #180#2  = #dsmow014#2;
     #180#3  = #dsmow014#5;
     #180#4  = #dsmow014#7;
     #180#5  = 0;
     |LEE 040#180=;
     |SI FSalida = 0;
         |SI nTecla = 5;
             |HAZ Registro180_1;
             |HAZ Registro180_Auxiliar1;
             enSwImpre = 1;  |BUCLE dsm180li;
             |SI nSwPrint = 0;
                 |DDEFECTO #181;
                 |PRINT;
             |FINSI;
             |PIEINF;
             |CIERRA #180;
             |ACABA;
         |FINSI;

         nHojas   = #180#6;
         enTHojas = (((nHojas / 8) + .49) ! 0);

         |SI nTeclaPapel = 1;
             |HAZ Registro180_1;
             |HAZ Registro180_Auxiliar1;

             eaAlfa = #0#7;    |HAZ FechaBonito;

             |PRINT;
             |PIEINF;

             |HAZ GrabaImpreso;
         |FINSI;

         |SI nTeclaPapel = 2;
             nContador = 0;
             enNHojas  = 1;
             nSwPrint  = 0;
             |BUCLE dsm180li;
             |SI nSwPrint = 1;  |PIEINF;  |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #180;
|FPRC;

|PROCESO QueHacemos180;
     |SI nTeclaPapel ! 0;  |O nTecla = 5;   || En Papel Continuo
         |HAZ Lee180P;
         |ACABA;
     |FINSI;

     |SI nSwLee = 1;        || Lectura para Colectivos para Totales Hoja
         |HAZ Lee1800;
         |ACABA;
     |FINSI;

     |HAZ DesGrabaImpreso;
     |HAZ Lee1801;          || Creacion de los Ficheros Planos.
     |SI nTecla = 4; |HAZ GrabaImpreso; |FINSI;
|FPRC;

|DEFBUCLE dsmow014C180;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos180;
|FIN;

|DEFBUCLE dsmow014N180;
     #dsmow014#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos180;
|FIN;

|PROCESO Boton1801;
     |PTEC 824;
|FPRC;

|PROCESO Boton1802;
     |PTEC 825;
|FPRC;

|PROCESO Boton1803;
     |PTEC 826;
|FPRC;

|PROCESO Boton1804;
     |PTEC 827;
|FPRC;

|PROCESO Boton1805;
     |PTEC 828;
|FPRC;

|PROCESO Boton1806;
     |PTEC 829;
|FPRC;

|PROCESO Boton1807;
     |PTEC 806;
|FPRC;

|PROCESO AbreImprime180;
     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "CD " + eaPathLanza + &13 + &10;    |XGRABA nHandle1, aAlfa;

     |SI #0#6 = 2001;
         |SI nTecla = 1;
             aAlfa = "ZLS01180.EXE -y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
         |SINO;
             aAlfa = "ZPR01180.EXE -Y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
         |FINSI;
     |FINSI;

     |SI #0#6 = 2002;
         |SI nTecla = 1;
             aAlfa = "ZLS02180.EXE -y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
         |SINO;
             aAlfa = "ZPR02180.EXE -Y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
         |FINSI;
     |FINSI;

     |SI #0#6 = 2003;
         |SI nTecla = 1;
             aAlfa = "ZLS03180.EXE -y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
         |SINO;
             aAlfa = "ZPR03180.EXE -Y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
         |FINSI;
     |FINSI;

     |SI #0#6 = 2004;
         |SI nTecla = 1;
             aAlfa = "ZLS04180.EXE -y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
         |SINO;
             aAlfa = "ZPR04180.EXE -Y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
         |FINSI;
     |FINSI;

     |SI #0#6 = 2005;
         |SI nTecla = 1;
             aAlfa = "ZLS05180.EXE -y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
         |SINO;
             aAlfa = "ZPR05180.EXE -Y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO ImpEtiqueta180;
     |SI nTecla = 3;
         #998#0  = "Delegacion .........: " + #dsmow525#4 + #dsmow525#5;
         #998#1  = "Ejercicio ..........: " + #dsmow525#2;
         #998#2  = "Modelo .............: 180";
         #998#3  = "Numero Justificante : ";
         #998#4  = "N.I.F. .............: " + #dsmow523#3;
         #998#5  = "Nombre : " + #dsmow523#4;
         #998#6  = #dsmow525#6 + " " + #dsmow525#7 + " " + #dsmow525#8 + " " + #dsmow525#11 + " " + #dsmow525#9;
         #998#7  = "P.Cont.: " + #dsmow523#7;
         #998#8  = "Telefono ...........: " + #dsmow523#6;
         #998#9  = "Numero total Registros ..: " + nTRegistro;
         #998#10 = "Densidad soporte : 1,44 MB en Diskettes de 3 1/2";
         #998#11 = "";
         #998#12 = "";
         |C_M #998#11, 1, "N";
         |C_M #998#12, 1, "N";
     |SINO;
         #998#0  = "Delegacion .........: " + (("00" + #997#11) % -102) + (("000" + #997#12) % -103);
         #998#1  = "Ejercicio ..........: " + #522#2;
         #998#2  = "Modelo .............: 180";
         #998#3  = "Numero Justificante : ";
         #998#4  = "N.I.F. .............: " + #522#3;
         #998#5  = "Nombre : " + #522#4;
         #998#6  = #522#5 + " " + #522#6 + " " + #522#7 + " " + #522#11 + " " + #522#12;
         #998#7  = "P.Cont.: " + #522#18;
         #998#8  = "Telefono ...........: " + #522#17;
         #998#9  = "Numero total Registros ..: " + nTRegistro;
         #998#10 = "Densidad soporte : 1,44 MB en Diskettes de 3 1/2";
         #998#11 = "";
         #998#12 = "";
         |C_M #998#11, 1, "S";
         |C_M #998#12, 1, "S";
         #998#11 = "Numero total Declarantes : " + #997#17;
         #998#12 = "Numero total Declarados .: " + #997#18;
     |FINSI;

     |PINPA #0#998;
     |PINDA #0#998;
     |ENDATOS #1#998;
     |SI FSalida = 0;
         |PINPA #0#998;
         |PINDA #0#998;

         |CONFI "2400SRealizar Impresion de la Etiqueta : ";
         |SI FSalida ! 0; |ACABA; |FINSI;

         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |INFOR "dsmow015";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

         |PRINT; |PIEINF; |FININF; |FINIMP;
     |FINSI;
|FPRC;

|PROCESO CopiaDiskette180;
     |ATRI I;
     |PINTA 0715, "Introduzca un Diskette Formateado en D.O.S. en su PC,";
     |PINTA 0815, "y pulse en el Boton de Iniciar Copia.                ";
     |ATRI i;
     |LEETECLA aTecla;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "CD " + eaPathLanza + &13 + &10;    |XGRABA nHandle1, aAlfa;
     aAlfa = "COPY RTPA" + #0#6 + ".TXT A:" + &13 + &10;    |XGRABA nHandle1, aAlfa;
     aAlfa = "COPY AUXILIAR.TXT" + " A:" + &13 + &10; |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL RTPA" + #0#6 + ".TXT" + &13 + &10;    |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL AUXILIAR.TXT" + &13 + &10; |XGRABA nHandle1, aAlfa;

     |XCIERRA nHandle1;

     aAlfa = eaPathLanza + "IMPRIME";
     |RSYSTEM aAlfa;

     |RFBORRA aAbre;

     |PINTA 0715, "                                                     ";
     |PINTA 0815, "                                                     ";

     |CONTROL_SIMPLE 0, " BOTON,EMITIR LA ETIQUETA", 1130, 1250, Boton1801;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, " BOTON,CANCELAR      ", 1430, 1545, Boton1802;
     nBoton2 = FSalida;

     |PARA; |SI;  |HACIENDO;
            |LEETECLA aTecla;
            |SI aTecla = aF2;  |SAL;  |FINSI;
            |SI aTecla = aF3;  |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;

     |PULSATECLA;

     |SI aTecla = aF3;  |ACABA;  |FINSI;

     |HAZ ImpEtiqueta180;
|FPRC;

|PROCESO CopiaInternet180;
     |SI nTecla = 3;
         eaFOrigen  = eaPathLanza + "RTPA" + #0#6 + ".TXT";
         eaFDestino = eaPathInternet + "RTP" + (("00000" + #180#0) % -105) + ".TXT";
         |RCOPIA_FICHERO eaFOrigen, eaFDestino;
         |RFBORRA eaFOrigen;
     |SINO;
         eaFOrigen  = eaPathLanza + "RTPA" + #0#6 + ".TXT";
         eaFDestino = eaPathInternet + "RTPA" + #0#6 + ".TXT";
         |RCOPIA_FICHERO eaFOrigen, eaFDestino;
         |RFBORRA eaFOrigen;
     |FINSI;

     aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
     |MENAV aAlfa;
|FPRC;

|PROCESO EmiteEsto180;
     aAlfa = "DEL *.DLL" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL *.TAB" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL *.WMF" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL ERROR180.TXT"     + &13 + &10;
     |XGRABA nHandle1, aAlfa;

||     aAlfa = "DEL *.EXE"         + &13 + &10;
||     |XGRABA nHandle1, aAlfa;

     |XCIERRA nHandle1;

     |DBASS aModelos;  |QBT aModelos;
     aModelos = aModelos + "basica/";

     |SI #0#6 = 2001;
         |SI nTecla = 1;
             eaFOrigen  = aModelos + "patrones/zls01180.exe";
             eaFDestino = eaPathLanza + "zls01180.exe";
             |HAZ CopiaFichero;
         |SINO;
             eaFOrigen  = aModelos + "patrones/zpr01180.exe";
             eaFDestino = eaPathLanza + "zpr01180.exe";
             |HAZ CopiaFichero;
         |FINSI;
     |FINSI;

     |SI #0#6 = 2002;
         |SI nTecla = 1;
             eaFOrigen  = aModelos + "patrones/zls02180.exe";
             eaFDestino = eaPathLanza + "zls02180.exe";
             |HAZ CopiaFichero;
         |SINO;
             eaFOrigen  = aModelos + "patrones/zpr02180.exe";
             eaFDestino = eaPathLanza + "zpr02180.exe";
             |HAZ CopiaFichero;
         |FINSI;
     |FINSI;

     |SI #0#6 = 2003;
         |SI nTecla = 1;
             eaFOrigen  = aModelos + "patrones/zls03180.exe";
             eaFDestino = eaPathLanza + "zls03180.exe";
             |HAZ CopiaFichero;
         |SINO;
             eaFOrigen  = aModelos + "patrones/zpr03180.exe";
             eaFDestino = eaPathLanza + "zpr03180.exe";
             |HAZ CopiaFichero;
         |FINSI;
     |FINSI;

     |SI #0#6 = 2004;
         |SI nTecla = 1;
             eaFOrigen  = aModelos + "patrones/zls04180.exe";
             eaFDestino = eaPathLanza + "zls04180.exe";
             |HAZ CopiaFichero;
         |SINO;
             eaFOrigen  = aModelos + "patrones/zpr04180.exe";
             eaFDestino = eaPathLanza  + "zpr04180.exe";
             |HAZ CopiaFichero;
         |FINSI;
     |FINSI;

     |SI #0#6 = 2005;
         |SI nTecla = 1;
             eaFOrigen  = aModelos + "patrones/zls05180.exe";
             eaFDestino = eaPathLanza + "zls05180.exe";
             |HAZ CopiaFichero;
         |SINO;
             eaFOrigen  = aModelos + "patrones/zpr05180.exe";
             eaFDestino = eaPathLanza + "zpr05180.exe";
             |HAZ CopiaFichero;
         |FINSI;
     |FINSI;

     aAlfa = eaPathLanza + "IMPRIME";

     |SI nTecla = 1;
         |RSYSTEM aAlfa;
         eaFichError  = "rtc";
         eaFichDatos  = "rta";
         eaFichAuxil  = "rtb";
         enValidacion = 0;

         |HAZ BuscaErroresL;
     |SINO;
         |RSYSTEM aAlfa;
         eaFichError = "rtc";
         eaFichDatos = "rtpa" + #0#6 + ".TXT";
         eaFichAuxil = "AUXILIAR.TXT";
         enValidacion = 0;

         |HAZ BuscaErroresL;

         |SI enError ! 0;
             |MENAV "      Ha habido Errores, arreglelos y vuelva a emitir.";
             |ACABA;
         |FINSI;

         |HAZ CopiaInternet180;
         |ACABA;

|| Quitado para el 2005

         |CONTROL_SIMPLE 0, " BOTON, COPIAR A DISKETTE ", 1130, 1260, Boton1801;
         nBoton1 = FSalida;

         |CONTROL_SIMPLE 0, " BOTON, COPIAR DIRECTORIO INTERNET", 1330, 1460, Boton1802;
         nBoton2 = FSalida;

         |CONTROL_SIMPLE 0, " BOTON,   CANCELAR    ", 1530, 1660, Boton1803;
         nBoton3 = FSalida;

         |PARA; |SI;  |HACIENDO;
                |LEETECLA aTecla;
                |SI aTecla = aF2;  nBoton = 1;  |SAL;  |FINSI;
                |SI aTecla = aF3;  nBoton = 2;  |SAL;  |FINSI;
                |SI aTecla = aF4;  |SAL;  |FINSI;
         |SIGUE;

         |FIN_CONTROL_WINDOWS nBoton1;
         |FIN_CONTROL_WINDOWS nBoton2;
         |FIN_CONTROL_WINDOWS nBoton3;

         |PULSATECLA;

         |SI aTecla = aF4;  |ACABA;  |FINSI;

         |SI nBoton = 1;  |HAZ CopiaDiskette180;  |FINSI;
         |SI nBoton = 2;  |HAZ CopiaInternet180;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO PapelContinuo180;
     Impresora = "CrystalReports";
     |IMPRE -1;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI nTeclaPapel = 0;
         |INFOR "m180co01";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI nTeclaPapel = 1;
         |INFOR "m180ch01";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI nTeclaPapel = 2;
         |INFOR "m180ch02";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#8 = "C";
         |BUCLE dsmow014C180;
     |SINO;
         |BUCLE dsmow014N180;
     |FINSI;

     |FININF;
     |FINIMP;
|FPRC;

|PROCESO PapelOficial180;
     |SI nTecla = 5;
         nTeclaPapel = 0;
         |HAZ PapelContinuo180;
         |ACABA;
     |FINSI;

     |CONTROL_SIMPLE 0, "LBOTON,F2 Emision Portada                       ", 0623, 0864, Boton1801;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3 Emision Hojas Relacion de Declarados  ", 1023, 1264, Boton1802;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Salir   ", 2265, 2278, Boton1804;
     nBoton3 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTeclaPapel = 1;  |HAZ PapelContinuo180;   |FINSI;
         |SI aTecla = aF3;  nTeclaPapel = 2;  |HAZ PapelContinuo180;   |FINSI;
         |SI aTecla = aF4;  nTeclaPapel = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;

     |PULSATECLA;
|FPRC;

|PROCESO Botones180_2004;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision Papel Oficial Laser          ", 0513, 0754, Boton1801;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Presentacion Internet Individual", 0913, 1154, Boton1802;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Presentacion Internet Colectivo", 1313, 1554, Boton1803;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Informe de Comprobacion              ", 1713, 1954, Boton1804;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton1807;
     nBoton5 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "828";
     aF7 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTecla = 1;   |SAL;  |FINSI;
         |SI aTecla = aF3;
             |SI enSwHay = 1;
                 nTecla = 3;
                 |SAL;
             |SINO;
                 |MENAV "      Se debera seleccionar una unica Empresa.";
             |FINSI;
         |FINSI;

         |SI aTecla = aF4;  nTecla = 4;   |SAL;  |FINSI;

         |SI aTecla = aF5;
             nTecla = 5;
             |HAZ PapelOficial180;
         |FINSI;

         |SI aTecla = aF7;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;

     |PULSATECLA;
|FPRC;

|PROCESO Botones180_2006;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision Papel Oficial Laser (Directo por impresora) ", 0513, 0654, Boton1801;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Emision Papel Oficial Laser (Vista previa por el Acrobat) ", 0813, 0954, Boton1802;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Presentacion Telematica Individual (Con validacion)", 1113, 1254, Boton1803;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Presentacion Telematica Colectiva (Sin validacion)", 1413, 1554, Boton1804;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F6> Informe de Comprobacion              ", 1713, 1854, Boton1805;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F7> Directorio Acrobat  ", 2013, 2154, Boton1806;
     nBoton6 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton1807;
     nBoton7 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "828";
     aF7 = &255 + "829";
     aF8 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;

         |SI aTecla = aF4;
             |SI enSwHay = 1;
                 nTecla = 3;
                 |SAL;
             |SINO;
                 |MENAV "      Se debera seleccionar una unica Empresa.";
             |FINSI;
         |FINSI;

         |SI aTecla = aF2;  nTecla = 1; eaModoImpre = "I";    |SAL;  |FINSI;
         |SI aTecla = aF3;  nTecla = 1; eaModoImpre = "P";    |SAL;  |FINSI;
         |SI aTecla = aF5;  nTecla = 4;                       |SAL;  |FINSI;
         |SI aTecla = aF6;  nTecla = 5; |HAZ PapelOficial180;        |FINSI;
         |SI aTecla = aF7;  |HAZ Acrobat;                            |FINSI;
         |SI aTecla = aF8;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |FIN_CONTROL_WINDOWS nBoton7;

     |PULSATECLA;
|FPRC;

|PROCESO Bloque2011;
     |SI nTecla ! 5;
         |SI #0#6 [ 2005;  |HAZ Botones180_2004; |FINSI;
         |SI #0#6 ] 2006;  |HAZ Botones180_2006; |FINSI;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1;  |ACABA;  |FINSI;
     |SI nTecla = 5;  enInfComp = 1;  |FINSI;

     |SI nTecla = 3; |O nTecla = 4;
         enInternet = 1;
     |SINO;
         enInternet = 0;
     |FINSI;

     |SI nTecla = 2;  |O nTecla = 5;
         |SI nTecla = 2;
             |MENAV "     Opcion no instalada";
             |ACABA;
         |FINSI;
         |HAZ PapelOficial180;
         |ACABA;
     |FINSI;

     |SI nTecla = 1;
         |SI #107#6 = "S";
             aTercera = "N";
             aAlfa    = "0000" + #107#5 + "Desea la impresion de la tercera copia  ";
             |CONFI aAlfa;
             |SI FSalida = 0;  aTercera = "S";  |FINSI;
         |SINO;
             aTercera = #107#5;
         |FINSI;
     |FINSI;

     |SI nTecla ! 4;
         |SI #0#6 [ 2005;
             |HAZ AbreImprime180;
         |FINSI;
     |FINSI;

     |SI nTecla = 3;  |O nTecla = 4;
         aAbre = eaPathEmision + "RTPA" + #0#6 + ".TXT";
         |XABRE "BW", aAbre, nHandle2;

         aAbre = eaPathEmision + "AUXILIAR.TXT";
         |XABRE "BW", aAbre, nHandle3;
     |FINSI;

     |SI nTecla = 4;
         nSwLee = 1;
         |BUCLE dsmow014C180;

         |SI #0#6 [ 2007;
             |PUSHV 0501 2380;
             |PINPA #0#997;
             |PINDA #0#997;
             |C_M #997#19, 1, "N";
             |C_V #997#19, 1, "N";
             |ENDATOS #1#997;
             |SI FSalida ! 0; |POPV;  |ACABA;  |FINSI;
             |POPV;

             |HAZ Registro180_0;
         |FINSI;
         |HAZ Registro180_Auxiliar0;
     |FINSI;

     nSwLee = 0;
     |SI #0#8 = "C";
         |BUCLE dsmow014C180;
     |SINO;
         |BUCLE dsmow014N180;
     |FINSI;

     |SI nTecla = 3;  |O nTecla = 4;
         |XCIERRA nHandle2;
         |XCIERRA nHandle3;

         eaFOrigen  = eaPathEmision + "RTPA" + #0#6  + ".TXT";
         eaFDestino = eaPathLanza + "RTPA" + #0#6 + ".TXT";
         |HAZ CopiaFichero;

         |FBORRA eaFOrigen;

         eaFOrigen  = eaPathEmision + "AUXILIAR.TXT";
         eaFDestino = eaPathLanza + "AUXILIAR.TXT";
         |HAZ CopiaFichero;

         |FBORRA eaFOrigen;
     |FINSI;

     |SI #0#6 [ 2005;
         |SI nTecla = 3;
             |SI #107#6 = "S";
                 aTercera = "N";
                 aAlfa    = "0000" + #107#5 + "Desea la impresion de la tercera copia  ";
                 |CONFI aAlfa;
                 |SI FSalida = 0;  aTercera = "S";  |FINSI;
             |SINO;
                 aTercera = #107#5;
             |FINSI;

             aAlfa = "wait vs180 /E:RTPA" + #0#6 + ".TXT";
             aAlfa = aAlfa + " /R:RTC" + #0#6 + ".TXT ";
             aAlfa = aAlfa + "/I: ";
             aAlfa = aAlfa + "/C:" + aTercera + " ";
             aAlfa = aAlfa + "/F:FLAG.TXT ";
             aAlfa = aAlfa + "/A:AUXILIAR.TXT";
             aAlfa = aAlfa + &13 + &10;
             |XGRABA nHandle1, aAlfa;
         |FINSI;

         |SI nTecla = 4;
             |HAZ CopiaInternet180;
         |SINO;
             |HAZ EmiteEsto180;
         |FINSI;
     |FINSI;

     |SI #0#6 ] 2006;
         |SI nTecla = 3;
             eaTipoE =  "RTPA" + #0#6 + ".TXT";
             eaTipoR =  "RTC"  + #0#6 + ".TXT";
             eaTipoP =  "PDF"  + #0#6 + ".PDF";
             eaTipoA =  "AUXILIAR.TXT";
             eaTipoV =  "S";

            |HAZ LineaShellJava;
         |FINSI;

         |SI nTecla ! 4;
             |SI eaTipoV ! "S";
                 eaFichError = "rtc";
                 eaFichDatos = "rta";
                 eaFichAuxil = "rtb";
                 enValidacion = 0;

                 |HAZ BuscaErroresL;
             |SINO;
                 eaFichError = "rtc";
                 eaFichDatos = "rtpa" + #0#6 + ".TXT";
                 eaFichAuxil = "AUXILIAR.TXT";

                 |HAZ BuscaErroresL;
                 |SI enError ! 0;
                     |MENAV "      Ha habido Errores, arreglelos y vuelva a emitir.";
                     |ACABA;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nTecla ! 1;
             |HAZ CopiaInternet180;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Portal180_2012;
     #180#0  = #dsmow014#0;
     #180#1  = #dsmow014#1;
     #180#2  = #dsmow014#2;
     #180#3  = #dsmow014#5;
     #180#4  = #dsmow014#7;
     #180#5  = 0;
     |LEE 040#180=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #4#0  = #dsmow014#0;
     #4#1  = #dsmow014#1;
     #4#2  = #dsmow014#2;
     #4#3  = #dsmow014#5;
     #4#4  = #dsmow014#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     eaFicheroPlano = "180" + (("00000" + #dsmow014#0) % -105) + ".txt";
     eaFicheroImpre = "180" + (("00000" + #dsmow014#0) % -105) + ".imp";
     eaFicheroSalid = "180" + (("00000" + #dsmow014#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #dsmow014#0) % -105) + ".txt";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Registro180_1;

     |BUCLE dsm180li;

     |XCIERRA nHandle2;

     enEmpresa    = #dsmow014#0;
     enComple     = #dsmow014#7;
     eaNomEmpresa = #dsmow014#3;

     eaX002_10    = #dsmow523#3;
     eaX002_11    = #dsmow523#4;
     eaX002_12    = #dsmoy000#0;
     eaX002_13    = #dsmoy000#6;
     eaX002_14    = 99;

     |SI #dsmow523#9 ! " ";
         eaX002_15 = #dsmow523#9;
     |FINSI;

     |SI #dsmow523#10 ! " ";
         eaX002_15 = #dsmow523#10;
         eaX002_16 = #dsmow523#11;
     |FINSI;

     eaX002_20 = #dsmow523#12;
     eaX002_21 = #dsm180ca#7;
     eaX002_22 = #dsm180ca#8;

     |HAZ PresentaPortal;
|FPRC;

|DEFBUCLE dsmow014C180_2012;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, Portal180_2012;
|FIN;

|DEFBUCLE dsmow014N180_2012;
     #dsmow014#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, Portal180_2012;
|FIN;

|PROCESO Bloque2012;
     |HAZ BtnAnuales2012;

     |SI eaOpcion = "0";  enInfComp = 1;  |ACABA;  |FINSI;

     nTecla = 1;

     |ABRE #180;
     |ABRE #4;
     |SI #0#8 = "C";
         |BUCLE dsmow014C180_2012;
     |SINO;
         |BUCLE dsmow014N180_2012;
     |FINSI;
     |CIERRA #180;
     |CIERRA #4;

     |SI eaOpcion = "3";
         |HAZ SacaErrorPtl;

         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Bloque2015;
     |HAZ BtnAnuales2015;

     |SI eaOpcion = "0";  enInfComp = 1;  |ACABA;  |FINSI;

     nTecla = 1;

     |ABRE #180;
     |ABRE #4;
     |SI #0#8 = "C";
         |BUCLE dsmow014C180_2012;
     |SINO;
         |BUCLE dsmow014N180_2012;
     |FINSI;
     |CIERRA #180;
     |CIERRA #4;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;

     |SI enDirecta = 1;  |Y enMsv = 1;  |Y enParar = 0;
         |SUB_EJECUTA "|dsmox007";
     |FINSI;
|FPRC;

|PROCESO Bloque;
     |SI #dsmoy000#6 [ 2011;  |HAZ Bloque2011;  |ACABA;  |FINSI;
     |SI #dsmoy000#6 [ 2014;  |HAZ Bloque2012;  |ACABA;  |FINSI;
     |SI #dsmoy000#6 ] 2015;  |HAZ Bloque2015;  |ACABA;  |FINSI;
|FPRC;

|PROGRAMA;
     aFichero = ("000" + Usuario) % 108;
     |NOME_DAT #0 aFichero;

     aFichero = ("imp" + Usuario) % 108;
     |NOME_DAT #dsmow014#aFichero#;

     |ABRE #dsmoy000;
     |LEE 000#dsmoy000.p;
     |CIERRA #dsmoy000;

     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |SI eaParametro = "180C";
         enInfComp = 1;
         nTecla    = 5;
         |HAZ Bloque2011;
         |ACABA;
     |FINSI;

     |HAZ Bloque;
|FPRO;
