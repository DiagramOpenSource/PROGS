|FICHEROS;
     dsmoz025;

     dsmow166 #182;
     dsm182li;
     dsmow165,MANTE;

    :/basica/def/agifigen;
|FIN;

|VARIABLES;
     &enBoton1 = 0;
     &enBoton2 = 0;
     &enBoton3 = 0;

     aAlfa1      = "";
     nBoton1     = 0;
     nBoton2     = 0;
     nBoton3     = 0;
     nTecla      = 0;

     nEmpresa    = 0;
     nEstado     = 0;
     nSwError    = 0;
     nEmpAnt     = 0;
     nEjerAnt    = 0;
     nEjer       = 0;
     &enDesdeAlta = 0;
     &eaNomOrigen = "";
     &enSw999     = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROCESO Boton2;
     |PTEC 825;
|FPRC;

|PROCESO Boton3;
     |PTEC 826;
|FPRC;

|PROCESO Tipo0;  |TIPO 0;
     |C_M #dsmow165#Campo#, 0, aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |PULSATECLA;
|FPRC;

|CALCULO LeelaEmpresa;
  || Lee Empresa
    nSwError = 0;
    |ABRE #agifigen;
    #agifigen#0 = enEmpresa;
    |LEE 041#agifigen.=;
    |SI FSalida ! 0;
        |MENAV "     Empresa Inexistente";
        |CIERRA #agifigen;
        nSwError = 1;
    |SINO;
        #dsmow165#2 = #agifigen#1;
    |FINSI;
    |CIERRA #agifigen;
|FCAL;

|| ////////////////////////////////////
|PROCESO Borrolin182l
   |BORRA 020#dsm182li.a;
   |LIBERA #dsm182li;
|FPRC;

|DEFBUCLE borrarLineas182l;
    #dsm182li#1;
    ;
    #182#0, #182#1, #182#2, #182#3, #182#4, "            ", 001;
    #182#0, #182#1, #182#2, #182#3, #182#4, "zzzzzzzzzzzz", 999;
    be;
    NULL, Borrolin182l;
|FIN;

|PROCESO BorraElemento;
   |BUCLE borrarLineas182l;
   |BORRA 020#dsmow166.a;
   |LIBERA #dsmow166;
|FPRC;

|DEFBUCLE borrarElementos;
    #dsmow166#1;
    ;
    #dsmow165#0, #dsmow165#1, enPeriodo, enModelo, 00;
    #dsmow165#0, #dsmow165#1, enPeriodo, enModelo, 99;
    be;
    NULL, BorraElemento;
|FIN;
|| ////////////////////////////////////

|| **********************************************************************
|RUTINA ClaveBaja182;
     #dsmow166#0 = #dsmow165#0;
     #dsmow166#1 = #dsmow165#1;
     #dsmow166#2 = enPeriodo;
     #dsmow166#3 = enModelo;
     #dsmow166#4 = 00;
|FRUT;

|RUTINA ClaveAlta182;
     #dsmow166#0 = #dsmow165#0;
     #dsmow166#1 = #dsmow165#1;
     #dsmow166#2 = enPeriodo;
     #dsmow166#3 = enModelo;
     #dsmow166#4 = 99;
|FRUT;

|PROCESO Tipo7;  |TIPO 7;
     |C_M #dsmow165#Campo#, 0, aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |PINTA 0714, #dsmow165#0;
     |PINTA 0814, #dsmow165#1; |PINTA #dsmow165#2;
     eaNomOrigen = #dsmow165#2;

     |ENTLINEAL #1#dsmow166, -5, 7, 22, 0, ClaveBaja182, ClaveAlta182;

     |BLIN 04;

     |SI #dsmoz025#19 = 1;
         aAlfa1= "LBOTON,F2 Seleccionar Empresa ";
     |SINO;
         aAlfa1= "LBOTON,F2 Seleccionar Ejercicio ";
     |FINSI;
     |CONTROL_SIMPLE 0, aAlfa1, 1045, 1070, Boton1;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3 Entrada al Lineal", 1145, 1170, Boton2;
     nBoton2 = FSalida;

     |SI #dsmoz025#19 = 1;
         aAlfa1 = "LBOTON,F4 Baja Empresa-Modelo";
     |SINO;
         aAlfa1 = "LBOTON,F4 Baja Ejercicio-Modelo";
     |FINSI;
     |CONTROL_SIMPLE 0, aAlfa1, 1245, 1270, Boton3;
     nBoton3 = FSalida;
|FPRC;

|PROCESO VerPrimero;
    enDesdeAlta = 0;
    |ABRE #dsmow166;
    #dsmow166#0 = #dsmow165#0;
    #dsmow166#1 = #dsmow165#1;
    #dsmow166#2 = enPeriodo;
    #dsmow166#3 = enModelo;
    #dsmow166#4 = 00;
    #dsmow166#5 = 00;
    |LEE 041#dsmow166.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsmow166;
        #dsmow166#0 = #dsmow165#0;
        #dsmow166#1 = #dsmow165#1;
        #dsmow166#2 = enPeriodo;
        #dsmow166#3 = enModelo;
        #dsmow166#4 = 00;
        #dsmow166#5 = 00;
        |GRABA 020#dsmow166.n;
        enDesdeAlta = 1;
    |FINSI;
    |LIBERA #dsmow166;
    |CIERRA #dsmow166;
    |SI enDesdeAlta = 1;
        |PTEC 829;
    |FINSI;
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
     nTecla = FSalida;
     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |PULSATECLA;

     |SI nTecla =  11;
         enEmpresa = #dsmow165#0;
         |HAZ MiraBloqueo;
         |SI eaBloqueo = "3";
             |ACABA;
         |FINSI;

         enEjer      = #dsmow165#1;
         eaNomOrigen = #dsmow165#2;
         |HAZ VerPrimero;
         |ENTLINEAL #1#dsmow166, -5, 4, 22, 0, ClaveBaja182, ClaveAlta182;
     |FINSI;

     |SI nTecla = 12;
         |CONFI "    NEsta Seguro de Borrar todos los Modelos 182 de esta Empresa y Ejercicio ";
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         enEmpresa = #dsmow165#0;
         enEjer    = #dsmow165#1;
         |BUCLE borrarElementos;
         |BORRA 020#dsmow165.a;

         |PTEC 809;
         |PTEC 808;
         |PONCONTROL  23, "SI";
     |FINSI;

     |SI nTecla = 10; |Y Campo = 0;

         nEmpAnt = #dsmow165#0;

         FSalida = 10;
         eaElProm = "dsmow165";
         |HAZ ConsuCliente9;
         nEmpresa = #dsmow165#0;
         eaElProm = "";

         #dsmow165#0    = nEmpresa;
         #dsmow165#1    = #dsmoz025#0;
         enEmpresa = #dsmow165#0;
         |LEE 040#dsmow165.=;
         nEstado = FSalida;

         |HAZ LeelaEmpresa;
         |SI nSwError = 0;
             |SI nEstado ! 0;
                |PINTA 0714, #dsmow165#0;
                |PINTA 0814, #dsmow165#1; |PINTA #dsmow165#2;
                |CONFI "    SDesea dar de Alta el Modelo 182";
                |SI FSalida = 0;
                    |GRABA 020#dsmow165.n;
                |SINO;
                    #dsmow165#0 = nEmpAnt;
                    #dsmow165#1 = #dsmoz025#0;
                    |LEE 040#dsmow165.=;
                    nSwError = 1;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nSwError = 0;
             |PTEC 825;
         |FINSI;

         |PONCONTROL  23, "SI";
     |FINSI;

     |SI nTecla = 10; |Y Campo = 1;

        nEjerAnt = #dsmow165#1;
        |PUSHV 1013 1231;
        |CUADRO 1013 1231;
        |ATRI I;
        |PINTA 1114, " Ejercicio:      ";
        E_inf  = 2000;
        E_sup  = 2099;
        nEjer = enEjer;
        nEjer = 1126 ? 1;
        |POPV;

         #dsmow165#0 = #dsmoz025#1;
         #dsmow165#1 = nEjer;
         |LEE 040#dsmow165.=;
         nEstado = FSalida;

         |SI nEstado ! 0;
            |PINTA 0714, #dsmow165#0;
            |PINTA 0814, #dsmow165#1; |PINTA #dsmow165#2;
            |CONFI "    SDesea dar de Alta el Modelo 182";
            |SI FSalida = 0;
                |GRABA 020#dsmow165.n;
            |SINO;
                #dsmow165#0 = #dsmoz025#1;
                #dsmow165#1 = nEjerAnt;
                |LEE 040#dsmow165.=;
                nSwError = 1;
            |FINSI;
         |FINSI;

         |SI nSwError = 0;
             |PTEC 825;
         |FINSI;

         |PONCONTROL  23, "SI";
     |FINSI;
|FPRC;
