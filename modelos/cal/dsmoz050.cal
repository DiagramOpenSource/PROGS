|FICHEROS;
     dsmoz050 #0;
     dsmom050 #50;  || Tabla cuentas
     dsmom051 #51;  || Mant. Valores por Empresas
     dsmom052 #52;  || Socios
     dsmom053 #53;  || Comuneros
     dsmom110 #110; || Control

     dsmow060 #99,MANTE;  ||Temporal V.Empresas Pantalla
     dsmow061 #61;        ||Temporal Cuentas

     dsmom001 #1;   ||Comuneros
     :/integral/def/dsam0000 #2;   ||Clientes

     :/contagen/def/cacuenta #300;
     :/contagen/def/canempre #330;

     :/basica/def/agifigen #100;
     :/basica/def/agim0002 #102;
     :/basica/def/agicen14 #114;
     :/basica/def/agim0019 #119;  || Registro de Sociedades
     :/basica/def/agim0025 #125;  || Socios

     :/contasoc/def/xxx00001 #203;     || Impuesto Sociedades 1990
     :/contasoc/def/xxx00011 #204;     || Impuesto Sociedades 1991
     :/contasoc/def/isocie01 #205;     || Impuesto Sociedades 1992
     :/contasoc/def/isocie32 #206;     || Impuesto Sociedades 1993
     :/contasoc/def/isocie44 #207;     || Impuesto Sociedades 1994 y 1995
     :/contasoc/def/isocie57 #209;     || Impuesto Sociedades 1996
     :/contasoc/def/isocie65 #219;     || Impuesto Sociedades 1997
     :/contasoc/def/isom0002 #222;     || Impuesto Sociedades 2008
     :/contasoc/def/sodacoli #223;     || Balance Sumas y Saldos del Impuesto
|FIN;

|VARIABLES;
     nEstado   = 0;
     nCampo    = 0;
     nDEmpresa = 0;
     nHEmpresa = 0;
     nPeriodo  = 0;
     nAnyo     = 0;
     nEjer     = 0;
     nEjerSoc  = 0;
     nEjerEos  = 0;

     aAlfa1    = "";
     aAlfa2    = "";
     aFichero  = "";
     aPath     = "";

     aDni  = "";
     nPin0 = 0;
     nPin1 = "";
     nSPin1= 0;
     aPin1 = "";
     nPin2 = "";
     aPin2 = "";
     nPin3 = "";
     aPin3 = "";
     fPn10 = @;
     fPn11 = @;
     swExiste = 0;
     swSocie  = 0;
     &nEmpres  = 0;
     &nRegis   = 0;
     nSaldo    = 0;
     nSaldo6y7 = 0;
     nSuma     = 0;
     nPvp     = 0;
     nTAccion = 0;
     nCapzac  = 0;
     nImpCap  = 0;
     &eaRelCta  = "";
     nTiPatr    = 0;
     fFecha     = @;
     fFechaH    = @;
     fFechaSoc  = @;
     fFechaEos  = @;
     fLaFecha   = @;
     &swUnoSolo = 0;

     nNume1  = 0;
     nNume2  = 0;
     nNume5  = 0;
     nValor  = 0;
     nValor1 = 0;
     nValor2 = 0;
     nValor3 = 0;
     nNumAct = 0;
     nTpCap  = 0;
     nVal1   = 0;
     nVal2   = 0;
     nVal3   = 0;
     nSwConta = 0;
     nSwAny1  = 0;
     nSwAny2  = 0;
     nSwAny3  = 0;
     nAny     = 0;
    &eaPathContasoc = "";
    aBase  = "";
    aAlfa  = "";
    nCanal = 0;
    nExis  = 0;
    nHay   = 0;
    nImporte1 = 0;
    nImporte2 = 0;
    nOpera    = 0;
    aDCta     = "";
    aHCta     = "";

|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\
|PROCESO Tipo7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#0 = enEmpresa;  |PINTA #0#0;
         #0#1 = enEmpresa;  |PINTA #0#1;

         |C_M #0#0, 1, "N";
         |C_M #0#1, 1, "N";
     |FINSI;
     fLaFecha = ~;
     aAlfa1 = fLaFecha; aAlfa1 = aAlfa1 % -104;
     #0#14 = aAlfa1;
     |PINTA #0#14;
|FPRC;

|PROCESO Parrilla;
     |SI #0#0 = 0;
         #0#0 = 0;  |PINTA #0#0;
         #0#1 = 0;  |PINTA #0#1;  |C_M #0#1, 1, "N";
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#0, 1, "S";
             |C_M #0#1, 1, "S";
         |FINSI;

         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|CALCULO YaSeCual; |TIPO 7;
 |SI enEmpresa ! 0;
     #0#29 = "S"; |PINTA #0#29;
     #0#16 = "S"; |PINTA #0#16;
     #0#17 = 00;  |PINTA #0#17;
     #0#18 = 99;  |PINTA #0#18;
     |C_M #0#16, 1, "N";
     |C_M #0#17, 1, "N";
     |C_M #0#18, 1, "N";
     |C_M #0#29, 1, "N";
 |FINSI;
|FCAL;

|CALCULO SelTipo0; |TIPO 0;
 |SI #0#29 = "N";
     #0#17 = 0;   |PINTA #0#17;  |C_M #0#17, 1, "N";
     #0#18 = 99;  |PINTA #0#18;  |C_M #0#18, 1, "N";
     |PARA nCampo = 19;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "S";
     |SIGUE;
 |SINO;
     |SI enEmpresa = 0;
         |C_M #0#17, 1, "S";
         |C_M #0#18, 1, "S";
     |FINSI;
     |PARA nCampo = 19;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "N";
           #0nCampo = 0;  |PINTA #0nCampo;
     |SIGUE;
 |FINSI;
|FCAL;

|CALCULO SelTipo1;
 |SI #0Campo = 0;
     |PARA nCampo = Campo + 1;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
           #0nCampo = 0;  |C_M #0nCampo, 1, "N";
     |SIGUE;
 |SINO;
     |PARA nCampo = Campo + 1;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "S";
     |SIGUE;
 |FINSI;
|FCAL;

|| /////////////////////// //////////////////////////////////////////////////
|| /////////////////////// PROCESOS CALCULO VALORACION  \\\\\\\\\\\\\\\\\\\\\
|PROCESO RelComuneros0;
     |SI #1#8 > "01.01.0000";
         |SI #1#8 > fFecha;  |ACABA;  |FINSI;
     |FINSI;

     |SI #1#9 > "01.01.0000";
         |SI #1#9 < fFecha;  |ACABA;  |FINSI;
     |FINSI;

     |ABRE #2;
     #2#0 = #1#3;
     |LEE 040#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

 |DDEFECTO #53;
 #53#0 = nEmpres;
 #53#1 = enEjer;
 #53#2 = nPin0; || ...#1#1;
 #53#3 = #1#3;
 |LEE 101#53=;
 |SI FSalida ! 0;
     |DDEFECTO #53;
     #53#0 = nEmpres;
     #53#1 = enEjer;
     #53#2 = nPin0; || ...#1#1;
     #53#3 = #1#3;
     |GRABA 020#53b;
 |FINSI;

 #53#4 = #1#5;   || Nombre
 #53#5 = #2#3;   || NIF
 #53#6 = #1#7;   || % Participacion
 |SI nNumAct > 1;
     #53#9  = #53#9 + #1#7;
     nNume1 = (#53#9  / nNumAct) ! 2;
     #53#6  = nNume1;
 |FINSI;

 |SI #51#33 = 1;
     #53#7 = #53#7 + (nValor1 * #1#7 / 100) ! EURODBMOD;
     #53#8 = #53#8 + (nValor2 * #1#7 / 100) ! EURODBMOD;
 |SINO;
     #53#7 = #53#7 + (nValor3 * #1#7 / 100) ! EURODBMOD;
     #53#8 = 0;
 |FINSI;

 |GRABA 040#53a;
 |LIBERA #53;
|FPRC;

|DEFBUCLE RelComuneros;
  #1#1;
  ;
  nEmpres, 00, 0001;
  nEmpres, 99, 9999;
  e;
  NULL, RelComuneros0;
|FIN;

||....................................
|PROCESO RelSocios0;
  |SI #125#18 > "01.01.0000";
      |SI #125#18 > fFechaH;  |ACABA;  |FINSI;
  |FINSI;

  |SI #125#19 > "01.01.0000";
      |SI #125#19 < fFecha;  |ACABA;  |FINSI;
  |FINSI;

  #52#0 = nEmpres;
  #52#1 = enEjer;
  #52#2 = #125#2;
  |LEE 101#52=;
  |SI FSalida ! 0;
      #52#0 = nEmpres;
      #52#1 = enEjer;
      #52#2 = #125#2;
      |GRABA 020#52b;
  |FINSI;

  #52#3 = #125#4;   || Nombre
  #52#4 = #125#3;   || NIF
  #52#10= #125#13;  || % Participacion
  #52#5 = #125#14;  || Acciones

  #52#6 = #52#5 * nPvp;
  #52#7 = #52#5 * #51#24;
  #52#8 = #52#5 * nCapzac;

  #52#9 = #52#6; |SI #52#9 < #52#7; #52#9 = #52#7; |FINSI;
                 |SI #52#9 < #52#8; #52#9 = #52#8; |FINSI;

  |GRABA 040#52a;
  |LIBERA #52;
|FPRC;

|DEFBUCLE RelSocios;
  #125#1;
  ;
  nEmpres, nRegis, 001;
  nEmpres, nRegis, 999;
  e;
  NULL, RelSocios0;
|FIN;

|| .................................................
|PROCESO AnysAntes0;
  swSocie = 1;
  nValor = nValor + #agim0002#14;
|FPRC;

|DEFBUCLE AnysAntes;
 #agim0002#1;
 ;
 nEmpres, 00, nAny;
 nEmpres, 99, nAny;
 e;
 NULL, AnysAntes0;
|FIN;

|| .................................................
|PROCESO Grabo2210_SI;
    |ABRE #cacuenta;
    nSaldo      = 0;
    |SI enEjer < 2008;
        #cacuenta#0 = "2210";
        |LEE 001#cacuenta.=;
        |SI FSalida = 0;
             nSaldo = ((#cacuenta#53 - #cacuenta#50) / enConversor) ! EURODBMOD;
                                       || Saldo Total - Saldo Ejercicio
             |HAZ Grabo2210;
        |FINSI;
    |FINSI;
    |SI enEjer ] 2008;
        nNume5 = 0;
        |DDEFECTO #cacuenta;
        #cacuenta#0 = "2110";
        |LEE 001#cacuenta.=;
        |SI FSalida = 0;
            nSaldo = ((#cacuenta#53 - #cacuenta#50) / enConversor) ! EURODBMOD;
                                             || Saldo Total - Saldo Ejercicio
               |HAZ Grabo2210;
           nNume5 = nSaldo;
        |FINSI;
        #cacuenta#0 = "2811";
        |LEE 001#cacuenta.=;
        |SI FSalida = 0;
             nSaldo = ((#cacuenta#53 - #cacuenta#50) / enConversor) ! EURODBMOD;
                                             || Saldo Total - Saldo Ejercicio
             |HAZ Grabo2210;
             nNume5 = nNume5 + nSaldo;
        |FINSI;
        nSaldo = nNume5;
    |FINSI;

    |CIERRA #cacuenta;
|FPRC;

|PROCESO Grabo2210;
  |SI nSaldo ! 0;
       |ABRE #61;
       #61#0 = nEmpres;
       #61#1 = enEjer;
       #61#2 = #cacuenta#0;
       |LEE 101#61=;
       |SI FSalida ! 0;
           #61#0 = nEmpres;
           #61#1 = enEjer;
           #61#2 = #cacuenta#0;
           |GRABA 020#61b;
       |FINSI;
       #61#3 = #cacuenta#2;
       #61#4 = "-";
       #61#5 = nSaldo; || Saldo Total - Saldo Ejercicio
       |GRABA 020#61a;
       |LIBERA #61;
       |CIERRA #61;

       |SI #61#4 = "+";
           #51#12 = #51#12 + #61#5;
       |SINO;
           #51#12 = #51#12 - #61#5;
       |FINSI;
  |FINSI;
|FPRC;

|PROCESO CtasImpuesto;
 nSaldo = nSaldo + #223#8;
|FPRC;

|DEFBUCLE CtasImpuesto;
 #223#2;
 ;
 #51#0, #51#15, aDCta;
 #51#0, #51#15, aHCta;
 ;
 NULL, CtasImpuesto;
|FIN;

|PROCESO Leocacuenta;
   nSaldo = ((#cacuenta#53 - #cacuenta#50) / enConversor) ! EURODBMOD;
   nSaldo6y7 = nSaldo6y7 + nSaldo;
|FPRC;

|DEFBUCLE Leocacuenta;
  #cacuenta#1;
  3;
  "6           ", "S";
  "799999999999", "S";
  e;
  NULL, Leocacuenta;
|FIN;

|PROCESO LasCuentas0;

  |SI nOpera = 0;
      #cacuenta#0 = #50#0;
      |LEE 001#cacuenta.=;
      |SI FSalida ! 0; |ACABA; |FINSI;

      nSaldo = ((#cacuenta#53 - #cacuenta#50) / enConversor) ! EURODBMOD;
                                          || Saldo Total - Saldo Ejercicio

      |SI #50#0 = "1290";   ||Especial
||        nSaldo = ( - #cacuenta#49 / enConversor) EUROBMOD; ||Solo Haber
          nSaldo = nSaldo6y7;
      |FINSI;
  |SINO;
      nSaldo = 0;
      aDCta  = #50#0 + "        ";
      aHCta  = #50#0 + "zzzzzzzz";
      |BUCLE CtasImpuesto;
  |FINSI;

  |SI nSaldo ! 0;
       #61#0 = nEmpres;
       #61#1 = enEjer;
       #61#2 = #50#0;
       |LEE 101#61=;
       |SI FSalida ! 0;
           #61#0 = nEmpres;
           #61#1 = enEjer;
           #61#2 = #50#0;
           |GRABA 020#61b;
       |FINSI;
       #61#3 = #50#1;
       #61#4 = #50#2;
       #61#5 = nSaldo; || Saldo Total - Saldo Ejercicio
       |GRABA 020#61a;
       |LIBERA #61;
       |SI #61#4 = "+";
           #51#12 = #51#12 + #61#5;
       |SINO;
           #51#12 = #51#12 - #61#5;
       |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE LasCuentas;
 #50#1;
 ;
 enPlan, "    ";
 enPlan, "zzzz";
 e;
 NULL, LasCuentas0;
|FIN;

|| .....................................................................
|PROCESO CreaValor0;
  enEmpresa  = #canempre#2;
  enPerConta = #canempre#3;
  eaLaMonEmp = #canempre#28;
  |HAZ EnConversor;

  nTiPatr = 0;
  || .... Datos de la Empresa
  #51#0 = #canempre#2;
  #51#1 = enEjer;
  |LEE 101#51=;
  nEstado = FSalida;
  |SI nEstado = 0;  nTiPatr = #51#33; |FINSI;

  nHay = 0;
  |SI nEstado = 0; |Y #0#15 = "N";
      |SI #51#12 ! 0; |O #51#16 ! 0; |O #51#17 ! 0; |O #51#18 ! 0;
          |O #51#19 ! 0; |O #51#23 ! 0; |O #51#25 ! 0; |O #51#27 ! 0;
          |O #51#29 ! 0; |O #51#30 ! 0; |O #51#31 ! 0; |O #51#32 ! 0;
          |O #51#33 ! 0;
             nHay = 1;
      |FINSI;
  |FINSI;

  |SI nHay = 0;
      |DDEFECTO #51;
  |FINSI;
  #51#0 = #canempre#2; || Num. Empresa
  #51#1 = enEjer;      || A¤o
  #51#2 = 00;          || Actividad
  #51#3 = #canempre#1; || Nombre Empresa

  |SI enEjerBajaM > 0; |Y enEjerBajaM [ #0#14;
                       || a¤o disolucion menor o igual Garcia Minguez 09.05.08
      |SI nEstado = 0;
          |SI #0#15 = "N";
              |HAZ Borrar0;
          |FINSI;
          |BORRA 020#51a;
      |FINSI;
      |LIBERA #51;
      |ACABA;
  |FINSI; ||esta ya disuelta

  #51#4  = nPin1;      || Tipo Empresa
  #51#5  = aPin1;
  #51#6  = nPin2;      || Tipo Tributacion
  #51#7  = aPin2;
  #51#8  = nPin3;      || Tipo Actividad Principal
  #51#9  = aPin3;
  #51#10 = fPn10;      || Fecha Alta
  #51#11 = fPn11;      || Fecha Baja
  #51#34 = aDni;

|| ... Relacion de Cuentas que determinan el Valor
  #51#15 = enEjer - 1;

  |SI nHay = 0;  #51#12 = 0; |FINSI;

  nOpera = 0;
  |SI nSwConta = 0;   ||si existe contabilidad
      aAlfa1 = #canempre#2;  aAlfa1 = ("00000" + aAlfa1) % -105;
      aAlfa2 = #canempre#3;  aAlfa2 = ("0" + aAlfa2) % -101;
      |DBASS aPath; |QBT aPath;
      aPathConta = aPath + "contagen/fich/" + aAlfa1 + aAlfa2 + "/";
      |PATH_DAT #300 aPathConta;

      nSaldo6y7 = 0;
      |BUCLE Leocacuenta;

      |ABRE #cacuenta;
      |ABRE #61;
      #51#12 = 0;
      |BUCLE LasCuentas;
      |CIERRA #61;
      |CIERRA #cacuenta;
  |SINO;
      |SI eaPathContasoc ! "";
          |SI #51#6 = 2;  |O nRegis ! 0; ||Una Sociedad
              nOpera = 1;
              |ABRE #61;
              #51#12 = 0;
              |BUCLE LasCuentas;
              |CIERRA #61;
          |FINSI;
      |FINSI;
  |FINSI;

 |SI nHay = 1;
    |SI nSwConta = 0;   ||si existe contabilidad
        |SI #51#6 = 2;  |O nRegis ! 0; ||Una Sociedad 17.09.2010
            || es una sociedad y no recogemos los datos de inmuebles
        |SINO;
            |HAZ Grabo2210_SI;
        |FINSI;
    |FINSI;
    |VETE GraboTemporal;
 |FINSI;

|| ........ Datos Ejercicios Anteriores
  #51#13 = enEjer - 3;
  #51#14 = enEjer - 2;
  #51#15 = enEjer - 1;

  |SI #51#6 = 2;  |O nRegis ! 0; ||Una Sociedad
      |HAZ RecogeImpuesto;
  |SINO;
       nSwAny1 = 0; nSwAny2 = 0; nSwAny3 = 0;
       |HAZ PorRendim;
  |FINSI;

|| ... Albaproa 21.06.2006
  nVal1 = #51#16;
  nVal2 = #51#17;
  nVal3 = #51#18;
  |SI #51#16 < 0; nVal1 = 0; |FINSI;
  |SI #51#17 < 0; nVal2 = 0; |FINSI;
  |SI #51#18 < 0; nVal3 = 0; |FINSI;

  #51#19 = nVal1 + nVal2 + nVal3;

|| ........ Proceso de Acciones y Relacion de Socios
   |SI #51#28 = 0; #51#28 = nTpCap; |FINSI;

   nCapzac   = 0;
   nImpCap   = #51#19 / 3;
   nImpCap   = nImpCap * 100;
   nImpCap   = nImpCap / #51#28;

   |SI nTAccion ! 0; nCapzac = nImpCap / nTAccion; |FINSI;

   |SI nSuma = 1; #51#20 = "Acciones Nominativas"; |FINSI;
   |SI nSuma = 2; #51#20 = "Acciones al portador"; |FINSI;
   |SI nSuma = 3; #51#20 = "Participaciones socios"; |FINSI;

   #51#21 =  nTAccion;         ||Numero Acciones
   #51#22 =  nPvp;             ||Valor Nominal
   #51#23 =  #51#21 * #51#22;
   #51#24 =  #51#12 / #51#21;  ||Valor Teorico
   #51#25 =  #51#12;
   #51#26 =  nCapzac;          ||Valor Capitalizacion
   #51#27 =  nImpCap;

   #51#29 = #51#23; |SI #51#29 < #51#25; #51#29 = #51#25; |FINSI;
                    |SI #51#29 < #51#27; #51#29 = #51#27; |FINSI;

   #51#33 = 0; #51#30 = 0;
   #51#31 = 0; #51#32 = 0;

|SI #51#6 = 2;  |O nRegis ! 0; ||Una Sociedad
    |ABRE #52;
    |BUCLE RelSocios;
    |CIERRA #52;
|SINO;
    |PDEFECTO #51,20,28;
    #51#28 = 0;
    #51#29 = #51#12;
    #51#33 = nTiPatr; |SI #51#33 = 0; #51#33 = 2; |FINSI;

    nSaldo = 0;
    |SI nSwConta = 0;
        |HAZ Grabo2210_SI;
    |FINSI;
    #51#30 = #51#29 - nSaldo;
    #51#31 = nSaldo;
    #51#32 = #51#29;

    |SI #51#6 ] 8; |Y #51#6 [ 12;

        |HAZ CuentoAct;

        nValor1 = #51#30; nValor2 = #51#31; nValor3 = #51#32;
        |SI nNumAct > 1;
            nValor1 = (#51#30 / nNumAct) ! EURODBMOD;
            nValor2 = (#51#31 / nNumAct) ! EURODBMOD;
            nValor3 = (#51#32 / nNumAct) ! EURODBMOD;
        |FINSI;

        |ABRE #53;
        |BUCLE RelComuneros;
        |CIERRA #53;
    |FINSI;
|FINSI;

|| ..... Grabar Registro
   |SI nEstado = 0; |GRABA 020#51a; |FINSI;
   |SI nEstado ! 0; |GRABA 020#51b; |FINSI;

|ET GraboTemporal;
   |LIBERA #51;
|| ..... Grabar Temporal
   #99#0 = #51#0;
   #99#1 = #51#1;
   |LEE 101#99=;
   |SI FSalida ! 0;
       |DDEFECTO #99;
       #99#0 = #51#0;
       #99#1 = #51#1;
       |GRABA 020#99b;
   |FINSI;
   #99#2 = #51#2;
   #99#3 = #51#3;
   #99#4 = #51#12;
   #99#5 = #51#21;
   #99#6 = #51#23;
   #99#7 = #51#25;
   #99#8 = #51#27;
   #99#9 = #51#29;
   |GRABA 020#99a;
   |LIBERA #99;
|FPRC;

|PROCESO CreaValor;

    nEmpres = #agifigen#0;
    |HAZ VerTipo;
    |SI enSwSelEmp = 1; |ACABA; |FINSI;

    nEmpres = #agifigen#0;
    |HAZ LosDatosEmpresa;
    |SI nPin2 = 2;
        nEjer  = nEjerSoc;
        fFecha = fFechaSoc;
    |SINO;
        nEjer  = nEjerEos;
        fFecha = fFechaEos;
    |FINSI;
    nNume1 = 2000 + nEjer;
    aAlfa = nNume1; aAlfa = "31.12." + aAlfa; fFechaH = aAlfa;

    |SI enEjer = 2008;
        |SI nPin2 ! 2;
            enEjer = #0#14;         || A¤o Calculo
        |SINO;
            enEjer = #0#14 - 1;
        |FINSI;
        eaPlanilla = "dsmom050";
        |HAZ PlanDePlanillas;
    |FINSI;

    enEjer = #0#14;        || A¤o Calculo

    nSwConta = 0;
    |ABRE #canempre;
    |DDEFECTO #canempre;
    |SELECT #4#canempre;
    #canempre#2  = nEmpres;
    #canempre#26 = nEjer;
    |LEE 041#canempre.=;
    |SI FSalida ! 0;
       nSwConta = 1;
       #canempre#2  = nEmpres;
       #canempre#3  = 0;
       #canempre#28 = "E";
       #canempre#1  = #agifigen#1; || Nombre Empresa
    |FINSI;

    |HAZ CreaValor0;
    |SELECT #1#canempre;
    |CIERRA #canempre;
|FPRC;

|DEFBUCLE CreaValor;
    #agifigen#1;
    ;
    nDEmpresa;
    nHEmpresa;
    e;
    NULL, CreaValor;
|FIN;

|| .....................................................................
|PROCESO VerTipo;
|| ... Seleccion de Tipo de Empresa
  nSPin1 = #agifigen#87;
  enSwSelEmp = 1;
  |SI #0#29 = "S";
      |SI nSPin1 ] #0#17; |Y nSPin1 [ #0#18;
          enSwSelEmp = 0;
      |FINSI;
  |SINO;
      |SI nSPin1 = #0#19;
          enSwSelEmp = 0;
      |SINO;
          |PARA nCampo = 20;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
                |SI nSPin1 = #0nCampo; |Y nSPin1 ! 0;
                    enSwSelEmp = 0;
                    |SAL;
                |FINSI;
          |SIGUE;
      |FINSI;
  |FINSI;
|FPRC;

|| ------------------------------------------------------------------------
|| .....................................................................
|PROCESO BorraComun0;
  |BORRA 020#53a;
  |LIBERA #53;
|FPRC;

|DEFBUCLE BorraComun;
    #53#1;
    ;
    #51#0, #51#1, 01, 00001;
    #51#0, #51#1, 99, 99999;
    be;
    NULL, BorraComun0;
|FIN;

|PROCESO BorraSocio0;
  |PDEFECTO #52, 5,11;
  |GRABA 020#52a;
  |LIBERA #52;
|FPRC;

|DEFBUCLE BorraSocio;
    #52#1;
    ;
    #51#0, #51#1, 001;
    #51#0, #51#1, 999;
    be;
    NULL, BorraSocio0;
|FIN;

|PROCESO Borrar0;
  |BUCLE BorraSocio;
  |BUCLE BorraComun;
  |PDEFECTO #51, 12, 33;
  |GRABA 020#51a;
  |LIBERA #51;
|FPRC;

|PROCESO Borrar;
 |ABRE #agifigen;
 |DDEFECTO #agifigen;
 #agifigen#0 = #51#0;
 |LEE 041#agifigen.=;
 |CIERRA #agifigen;

 |HAZ VerTipo;
 |SI enSwSelEmp = 0;
     |HAZ Borrar0;
 |SINO;
     |LIBERA #51;
 |FINSI;
|FPRC;

|DEFBUCLE BCalculoAnt;    || Borrado Calculo Anterior
    #51#1;
    ;
    nDEmpresa, enEjer;
    nHEmpresa, enEjer;
    be;
    NULL, Borrar;
|FIN;
|| .....................................................................

|PROCESO Calcular;

  |SI #0#15 = "S";
      |BUCLE BCalculoAnt;    || Borrado Calculo Anterior
  |FINSI;

  |ABRE #99;
  |ABRE #51;
  |BUCLE CreaValor;
  |CIERRA #51;
  |CIERRA #99;
|FPRC;

|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
|RUTINA ClaveBaja99;
 #99#0 = 00001;
 #99#1 = enEjer;
|FRUT;

|RUTINA ClaveAlta99;
 #99#0 = 99999;
 #99#1 = enEjer;
|FRUT;

|PROCESO Tipo3;  |TIPO 3;
     |HAZ BusquedaSocie;

     aFichero = ("60" + Usuario) % 108;
     |NOME_DAT #99 aFichero;
     |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

     aFichero = ("61" + Usuario) % 108;
     |NOME_DAT #61 aFichero;
     |ABRE #61;  |CIERRA #61;  |DELINDEX #61;
     eaRelCta    = aFichero;

|SI enEjer ! 2008;|| ... no tenemos problema con la tablas
     enEjer      = #0#14;        || A¤o Calculo
     eaPlanilla = "dsmom050";
     |HAZ PlanDePlanillas;
|FINSI;

    || ... Albaproa 23.06.2006        || Ejercicio Contable a consultar
     nNume1      = #0#14;             || Paco Hellin 1243-1461
     aAlfa1      = nNume1;            || el mismo a¤o para las Estimaciones
     aAlfa1      = aAlfa1 % -102;
     nEjerEos    = aAlfa1;

     nNume1      = #0#14 - 1;         || El a¤o anterior para Sociedad
     aAlfa1      = nNume1;
     aAlfa1      = aAlfa1 % -102;
     nEjer       = aAlfa1;
     nEjerSoc    = nEjer;

     |ABRE #110;
     #110#0 = #0#14;
     |LEE 001#110=;
     |SI FSalida ! 0;
         |DDEFECTO #110;
         #110#0 = #0#14;
         |GRABA 020#110n;
     |FINSI;
     |CIERRA #110;
     nTpCap = #110#1;

     aAlfa1      = #0#14;
     aAlfa2      = "01.01."+ aAlfa1;
     fFecha      = aAlfa2;
     fFechaSoc   = aAlfa2;   ||Paco Hellin 1243_1461

     nNume1      = #0#14 + 1;
     aAlfa1      = nNume1;
     aAlfa2      = "01.01."+ aAlfa1;
     fFechaEos   = aAlfa2;   ||Paco Hellin 1243_1461

     |SI #0#0 ! 0;
         nDEmpresa = #0#0;
         nHEmpresa = #0#1;
         |HAZ Calcular;
     |SINO;
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo ! 0;
                   nDEmpresa = #0nCampo;
                   nHEmpresa = #0nCampo;
                   |HAZ Calcular;         || Calcular Valor
               |FINSI;
         |SIGUE;
     |FINSI;
     |SI swUnoSolo = 0;
         |ENTLINEAL #1#99, -1, 4, 22, 1, ClaveBaja99, ClaveAlta99;
     |SINO;
          |PINPA #0#51;
          |ENTLINEAL #1#99, -1, 4, 22, 0, ClaveBaja99, ClaveAlta99;
     |FINSI;
     |DELINDEX #99;
     |DELINDEX #61;
|FPRC;

|| =========================================================================
|PROCESO CuentoA;

 |SI #agicen14#5 > "01.01.0000";
     |SI #agicen14#5 > fFecha;  |ACABA;  |FINSI;
 |FINSI;
 |SI #agicen14#6 > "01.01.0000";
     |SI #agicen14#6 < fFecha;  |ACABA;  |FINSI;
 |FINSI;
 |SI #agicen14#9 ] 8; |Y #agicen14#9 [ 12;
     nNumAct = nNumAct + 1;
 |FINSI;
|FPRC;

|DEFBUCLE CuentoA;
 #114#1;
 ;
 enEmpresa,00;
 enEmpresa,99;
 e;
 NULL, CuentoA;
|FIN;

|PROCESO CuentoAct;
  nNumAct = 0;
  |BUCLE CuentoA;
  |SI nNumAct = 0;
      nNumAct = 1;
  |FINSI;
|FPRC;

|PROCESO PrimeraAct;
        nPin0 = #agicen14#1;
        nPin2 = #agicen14#9;
        aPin2 = #agicen14#10;
        nPin3 = #agicen14#16;
        aPin3 = #agicen14#17;
        fPn10 = #agicen14#5;
        fPn11 = #agicen14#6;

    |SI #agicen14#6 [ "01.01.0000"; |O #agicen14#6 ] fFecha;
        |ERROR10;
    |FINSI;
|FPRC;

|DEFBUCLE PrimeraAct;
    #agicen14#1;
    ;
    nEmpres, 01;
    nEmpres, 99;
    ;
    NULL, PrimeraAct;
|FIN;

|PROCESO LosDatosEmpresa;
  enEjerBajaM = 0;
  nPin1 = "";
  aPin1 = "";
  nPin2 = "";
  aPin2 = "";
  nPin3 = "";
  aPin3 = "";
  fPn10 = "01.01.0000";
  fPn11 = "01.01.0000";
  nSuma = 0;
  nPvp  = 0;
  nTAccion = 0;
  fFecha = "31.12.2999";
  |SI enEjer ! 0;
      aAlfa1 = enEjer;
      aAlfa1 = "01.01."+ aAlfa1;
      fFecha = aAlfa1;
  |FINSI;

 || Lee Actividad
    |BUCLE PrimeraAct;

 || Lee Ficha Sociedades
    swExiste = 0;
    nRegis   = 0;
    |ABRE #agim0019;
    #agim0019#0 = nEmpres; || Empresa
    #agim0019#1 = 99;
    |LEE 041#agim0019.];
    |SI FSalida = 0;
        |LEE 041#agim0019.a;
    |SINO;
        |LEE 041#agim0019.u;
    |FINSI;
    |SI FSalida = 0; |Y #agim0019#0 = nEmpres;
        swExiste = 1;
    |FINSI;
    |SI swExiste = 1;
        nRegis = #agim0019#1;  ||Registre
        nPin1 = #agim0019#4;
        aPin1 = #agim0019#5;
        fPn10 = #agim0019#7;      || Fecha Activa
        fPn11 = #agim0019#55;     || Fecha Inactiva
        nSuma = 0;
        |SI #agim0019#15 ! 0; nTAccion = #agim0019#15; nPvp = #agim0019#16; nSuma = 1; |FINSI;
        |SI #agim0019#19 ! 0; nTAccion = #agim0019#19; nPvp = #agim0019#20; nSuma = 2; |FINSI;
        |SI #agim0019#23 ! 0; nTAccion = #agim0019#23; nPvp = #agim0019#24; nSuma = 3; |FINSI;
        |SI #agim0019#12 > "01.01.1000";
            aAlfa1 = #agim0019#12; aAlfa1 = aAlfa1 % -104; enEjerBajaM = aAlfa1;
        |FINSI;
    |FINSI;
    |CIERRA #agim0019;

    aDni  = #agifigen#13;
    nPin1 = #agifigen#87;
    aPin1 = #agifigen#88;
    fPn10 = #agifigen#93;
    fPn11 = #agifigen#94;
|FPRC;

|PROGRAMA;
  |SI enEmpresa ! 0;
      |CLS;
      #0#0 = enEmpresa;
      #0#1 = enEmpresa;
      #0#14 = enEjer;
      swUnoSolo = 1;
      |HAZ Tipo3;
  |SINO;
      |MANTE #0;
  |FINSI;
|FPRO;


|| ::::: Datos del Impuesto
|PROCESO PorRendim;

 swSocie = 1;
 |SI nSwAny1 = 0;
     nAny   = #51#13;
     nValor = 0;
     |BUCLE AnysAntes;
     #51#16 = nValor;
 |FINSI;
 |SI nSwAny2 = 0;
     nAny   = #51#14;
     nValor = 0;
     |BUCLE AnysAntes;
     #51#17 = nValor;
 |FINSI;
 |SI nSwAny3 = 0;
     nAny   = #51#15;
     nValor = 0;
     |BUCLE AnysAntes;
     #51#18 = nValor;
 |FINSI;
|FPRC;


|PROCESO RecogeImpuesto;

     nSwAny1 = 0; nSwAny2 = 0; nSwAny3 = 0;
     |SI eaPathContasoc = "";
         |HAZ PorRendim;
         |ACABA;
     |FINSI;
     nSwAny1 = 1; nSwAny2 = 1; nSwAny3 = 1;

     |SI #51#13 = 1990; |O #51#14 = 1990; |O #51#15 = 1990;
         nExis = 0;
         |ABRE #203;
         #203#0  = #51#0;
         #203#34 = 1990;
         |LEE 040#203=;
         |SI FSalida ! 0;
             |DDEFECTO #203;
             |SI #51#13 = 1990; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 1990; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 1990; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #203;
         |SI nExis = 0;
             |SI #51#13 = 1990; #51#16 = #203#21; |FINSI;
             |SI #51#14 = 1990; #51#17 = #203#21; |FINSI;
             |SI #51#15 = 1990; #51#18 = #203#21; |FINSI;
         |FINSI;
      |FINSI;

      |SI #51#13 = 1991; |O #51#14 = 1991; |O #51#15 = 1991;
          nExis = 0;
          |ABRE #204;
          #204#0  = #51#0;
          #204#1  = 1991;
          |LEE 040#204=;
          |SI FSalida ! 0;
              |DDEFECTO #204;
              |SI #51#13 = 1991; nSwAny1 = 0; |FINSI;
              |SI #51#14 = 1991; nSwAny2 = 0; |FINSI;
              |SI #51#15 = 1991; nSwAny3 = 0; |FINSI;
              nExis = 1;
          |FINSI;
          |CIERRA #204;
          |SI nExis = 0;
              |SI #51#13 = 1991; #51#16 = #204#22; |FINSI;
              |SI #51#14 = 1991; #51#17 = #204#22; |FINSI;
              |SI #51#15 = 1991; #51#18 = #204#22; |FINSI;
          |FINSI;
     |FINSI;

     |SI #51#13 = 1992; |O #51#14 = 1992; |O #51#15 = 1992;
         nExis = 0;
         |ABRE #205;
         #205#0  = #51#0;
         #205#1  = 1992;
         |LEE 040#205=;
         |SI FSalida ! 0;
             |DDEFECTO #205;
              |SI #51#13 = 1992; nSwAny1 = 0; |FINSI;
              |SI #51#14 = 1992; nSwAny2 = 0; |FINSI;
              |SI #51#15 = 1992; nSwAny3 = 0; |FINSI;
              nExis = 1;
         |FINSI;
         |CIERRA #205;
         |SI nExis = 0;
             |SI #51#13 = 1992; #51#16 = #205#88; |FINSI;
             |SI #51#14 = 1992; #51#17 = #205#88; |FINSI;
             |SI #51#15 = 1992;
                 || ... |SI nSwConta = 1; #51#12 = #205#93; |FINSI;
                 #51#12 = #205#93;
                 #51#18 = #205#88;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #51#13 = 1993; |O #51#14 = 1993; |O #51#15 = 1993;
         nExis = 0;
         |ABRE #206;
         #206#0  = #51#0;
         #206#1  = 1993;
         |LEE 040#206=;
         |SI FSalida ! 0;
             |DDEFECTO #206;
             |SI #51#13 = 1993; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 1993; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 1993; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #206;
         |SI nExis = 0;
             |SI #51#13 = 1993; #51#16 = #206#89; |FINSI;
             |SI #51#14 = 1993; #51#17 = #206#89; |FINSI;
             |SI #51#15 = 1993;
                 || .. |SI nSwConta = 1; #51#12 = #206#94; |FINSI;
                 #51#12 = #206#94;
                 #51#18 = #206#89;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #51#13 = 1994; |O #51#14 = 1994; |O #51#15 = 1994;
          nExis = 0;
         |ABRE #207;
         #207#0  = #51#0;
         #207#1  = 1994;
         |LEE 040#207=;
         |SI FSalida ! 0;
             |DDEFECTO #207;
             |SI #51#13 = 1994; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 1994; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 1994; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #207;
         |SI nExis = 0;
             |SI #51#13 = 1994; #51#16 = #207#92; |FINSI;
             |SI #51#14 = 1994; #51#17 = #207#92; |FINSI;
             |SI #51#15 = 1994;
                 || ... |SI nSwConta = 1; #51#12 = #207#97; |FINSI;
                 #51#12 = #207#97;
                 #51#18 = #207#92;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #51#13 = 1995; |O #51#14 = 1995; |O #51#15 = 1995;
         nExis = 0;
         |ABRE #207;
         #207#0  = #51#0;
         #207#1  = 1995;
         |LEE 040#207=;
         |SI FSalida ! 0;
             |DDEFECTO #207;
             |SI #51#13 = 1995; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 1995; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 1995; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #207;
         |SI nExis = 0;
             |SI #51#13 = 1995; #51#16 = #207#92; |FINSI;
             |SI #51#14 = 1995; #51#17 = #207#92; |FINSI;
             |SI #51#15 = 1995;
                 || ... |SI nSwConta = 1; #51#12 = #207#97; |FINSI;
                 #51#12 = #207#97;
                 #51#18 = #207#92;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #51#13 = 1996; |O #51#14 = 1996; |O #51#15 = 1996;
         nExis = 0;
         |ABRE #209;
         #209#0  = #51#0;
         #209#1  = 1996;
         |LEE 040#209=;
         |SI FSalida ! 0;
             |DDEFECTO #209;
             |SI #51#13 = 1996; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 1996; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 1996; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #209;

         |SI nExis = 0;
             |SI #51#13 = 1996; #51#16 = #209#95; |FINSI;
             |SI #51#14 = 1996; #51#17 = #209#95; |FINSI;
             |SI #51#15 = 1996;
                 || ... |SI nSwConta = 1; #51#12 = #209#100; |FINSI;
                 #51#12 = #209#100;
                 #51#18 = #209#95;
             |FINSI;
          |FINSI;
     |FINSI;

     |SI #51#13 = 1997; |O #51#14 = 1997; |O #51#15 = 1997;
         nExis = 0;
         |ABRE #219;
         #219#0  = #51#0;
         #219#1  = 1997;
         |LEE 040#219=;
         |SI FSalida ! 0;
             |DDEFECTO #219;
             |SI #51#13 = 1997; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 1997; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 1997; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #219;
         |SI nExis = 0;
             |SI #51#13 = 1997; #51#16 = #219#77; |FINSI;
             |SI #51#14 = 1997; #51#17 = #219#77; |FINSI;
             |SI #51#15 = 1997;
                 || ... |SI nSwConta = 1; #51#12 = #219#80; |FINSI;
                 #51#12 = #219#80;
                 #51#18 = #219#77;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #51#13 = 1998; |O #51#14 = 1998; |O #51#15 = 1998;
         nExis = 0;
         |ABRE #219;
         #219#0  = #51#0;
         #219#1  = 1998;
         |LEE 040#219=;
         |SI FSalida ! 0;
            |DDEFECTO #219;
            |SI #51#13 = 1998; nSwAny1 = 0; |FINSI;
            |SI #51#14 = 1998; nSwAny2 = 0; |FINSI;
            |SI #51#15 = 1998; nSwAny3 = 0; |FINSI;
            nExis = 1;
         |FINSI;
         |CIERRA #219;
         |SI nExis = 0;
             |SI #51#13 = 1998; #51#16 = #219#77; |FINSI;
             |SI #51#14 = 1998; #51#17 = #219#77; |FINSI;
             |SI #51#15 = 1998;
                 || ... |SI nSwConta = 1; #51#12 = #219#80; |FINSI;
                 #51#12 = #219#80;
                 #51#18 = #219#77;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #51#13 = 1999; |O #51#14 = 1999; |O #51#15 = 1999;
          nExis = 0;
         |ABRE #219;
         #219#0  = #51#0;
         #219#1  = 1999;
         |LEE 040#219=;
         |SI FSalida ! 0;
             |DDEFECTO #219;
             |SI #51#13 = 1999; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 1999; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 1999; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #219;

         |SI nExis = 0;
             |SI #51#13 = 1999; #51#16 = #219#77; |FINSI;
             |SI #51#14 = 1999; #51#17 = #219#77; |FINSI;
             |SI #51#15 = 1999;
                 || ... |SI nSwConta = 1; #51#12 = #219#80; |FINSI;
                 #51#12 = #219#80;
                 #51#18 = #219#77;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #51#13 = 2000; |O #51#14 = 2000; |O #51#15 = 2000;
         nExis = 0;
         |ABRE #219;
         #219#0  = #51#0;
         #219#1  = 2000;
         |LEE 040#219=;
         |SI FSalida ! 0;
             |DDEFECTO #219;
             |SI #51#13 = 2000; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 2000; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 2000; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #219;

         |SI nExis = 0;
             |SI #51#13 = 2000; #51#16 = #219#77; |FINSI;
             |SI #51#14 = 2000; #51#17 = #219#77; |FINSI;
             |SI #51#15 = 2000;
                 || ... |SI nSwConta = 1; #51#12 = #219#80; |FINSI;
                 #51#12 = #219#80;
                 #51#18 = #219#77;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #51#13 = 2001; |O #51#14 = 2001; |O #51#15 = 2001;
         nExis = 0;
         |ABRE #219;
         #219#0  = #51#0;
         #219#1  = 2001;
         |LEE 040#219=;
         |SI FSalida ! 0;
             |DDEFECTO #219;
             |SI #51#13 = 2001; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 2001; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 2001; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #219;

         |SI nExis = 0;
             |SI #51#13 = 2001; #51#16 = #219#77; |FINSI;
             |SI #51#14 = 2001; #51#17 = #219#77; |FINSI;
             |SI #51#15 = 2001;
                 || ... |SI nSwConta = 1; #51#12 = #219#80; |FINSI;
                 #51#12 = #219#80;
                 #51#18 = #219#77;
             |FINSI;
          |FINSI;
     |FINSI;

     |SI #51#13 = 2002; |O #51#14 = 2002; |O #51#15 = 2002;
         nExis = 0;
         |ABRE #219;
         #219#0  = #51#0;
         #219#1  = 2002;
         |LEE 040#219=;
         |SI FSalida ! 0;
             |DDEFECTO #219;
             |SI #51#13 = 2002; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 2002; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 2002; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #219;

         |SI nExis = 0;
             |SI #51#13 = 2002; #51#16 = #219#77; |FINSI;
             |SI #51#14 = 2002; #51#17 = #219#77; |FINSI;
             |SI #51#15 = 2002;
                 || .. |SI nSwConta = 1; #51#12 = #219#80; |FINSI;
                 #51#12 = #219#80;
                 #51#18 = #219#77;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #51#13 = 2003; |O #51#14 = 2003; |O #51#15 = 2003;
         nExis = 0;
         |ABRE #219;
         #219#0  = #51#0;
         #219#1  = 2003;
         |LEE 040#219=;
         |SI FSalida ! 0;
             |DDEFECTO #219;
             |SI #51#13 = 2003; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 2003; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 2003; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #219;

         |SI nExis = 0;
             |SI #51#13 = 2003; #51#16 = #219#77; |FINSI;
             |SI #51#14 = 2003; #51#17 = #219#77; |FINSI;
             |SI #51#15 = 2003;
                 || ... |SI nSwConta = 1; #51#12 = #219#80; |FINSI;
                 #51#12 = #219#80;
                 #51#18 = #219#77;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #51#13 = 2004; |O #51#14 = 2004; |O #51#15 = 2004;
         nExis = 0;
         |ABRE #219;
         #219#0  = #51#0;
         #219#1  = 2004;
         |LEE 040#219=;
         |SI FSalida ! 0;
             |DDEFECTO #219;
             |SI #51#13 = 2004; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 2004; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 2004; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #219;

         |SI nExis = 0;
             |SI #51#13 = 2004; #51#16 = #219#77; |FINSI;
             |SI #51#14 = 2004; #51#17 = #219#77; |FINSI;
             |SI #51#15 = 2004;
                 || ... |SI nSwConta = 1; #51#12 = #219#80; |FINSI;
                 #51#12 = #219#80;
                 #51#18 = #219#77;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #51#13 = 2005; |O #51#14 = 2005; |O #51#15 = 2005;
         nExis = 0;
         |ABRE #219;
         #219#0  = #51#0;
         #219#1  = 2005;
         |LEE 040#219=;
         |SI FSalida ! 0;
             |DDEFECTO #219;
             |SI #51#13 = 2005; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 2005; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 2005; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #219;

         |SI nExis = 0;
             |SI #51#13 = 2005; #51#16 = #219#77; |FINSI;
             |SI #51#14 = 2005; #51#17 = #219#77; |FINSI;
             |SI #51#15 = 2005;
                 || ... |SI nSwConta = 1; #51#12 = #219#80; |FINSI;
                 #51#12 = #219#80;
                 #51#18 = #219#77;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #51#13 = 2006; |O #51#14 = 2006; |O #51#15 = 2006;
         nExis = 0;
         |ABRE #219;
         #219#0  = #51#0;
         #219#1  = 2006;
         |LEE 040#219=;
         |SI FSalida ! 0;
             |DDEFECTO #219;
             |SI #51#13 = 2006; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 2006; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 2006; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #219;

         |SI nExis = 0;
             |SI #51#13 = 2006; #51#16 = #219#77; |FINSI;
             |SI #51#14 = 2006; #51#17 = #219#77; |FINSI;
             |SI #51#15 = 2006;
                 || ... |SI nSwConta = 1; #51#12 = #219#80; |FINSI;
                 #51#12 = #219#80;
                 #51#18 = #219#77;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #51#13 = 2007; |O #51#14 = 2007; |O #51#15 = 2007;
         nExis = 0;
         |ABRE #219;
         #219#0  = #51#0;
         #219#1  = 2007;
         |LEE 040#219=;
         |SI FSalida ! 0;
             |DDEFECTO #219;
             |SI #51#13 = 2007; nSwAny1 = 0; |FINSI;
             |SI #51#14 = 2007; nSwAny2 = 0; |FINSI;
             |SI #51#15 = 2007; nSwAny3 = 0; |FINSI;
             nExis = 1;
         |FINSI;
         |CIERRA #219;

         |SI nExis = 0;
             |SI #51#13 = 2007; #51#16 = #219#77; |FINSI;
             |SI #51#14 = 2007; #51#17 = #219#77; |FINSI;
             |SI #51#15 = 2007;
                 || ... |SI nSwConta = 1; #51#12 = #219#80; |FINSI;
                 #51#12 = #219#80;
                 #51#18 = #219#77;
             |FINSI;
         |FINSI;
     |FINSI;

     |ABRE #222;
     |SELECT #2#222;
     |PARA nAnyo = 2008;  |SI nAnyo [ #0#14;  |HACIENDO nAnyo = nAnyo + 1;
          |SI #51#13 = nAnyo; |O #51#14 = nAnyo; |O #51#15 = nAnyo;
              nImporte1 = 0;
              nImporte2 = 0;
              nExis = 1;
              #222#0  = #51#0;
              #222#1  = nAnyo;
              #222#3  = "186";
              |LEE 040#222=;
              |SI FSalida ! 0;
                  |DDEFECTO #222;
                  |SI #51#13 = nAnyo; nSwAny1 = 0; |FINSI;
                  |SI #51#14 = nAnyo; nSwAny2 = 0; |FINSI;
                  |SI #51#15 = nAnyo; nSwAny3 = 0; |FINSI;
              |SINO;
                  nExis = 0;
                  nImporte1 = #222#5;
              |FINSI;

              #222#0  = #51#0;
              #222#1  = nAnyo;
              #222#3  = "199";
              |LEE 040#222=;
              |SI FSalida ! 0;
                  |DDEFECTO #222;
                  |SI #51#13 = nAnyo; nSwAny1 = 0; |FINSI;
                  |SI #51#14 = nAnyo; nSwAny2 = 0; |FINSI;
                  |SI #51#15 = nAnyo; nSwAny3 = 0; |FINSI;
              |SINO;
                  nExis = 0;
                  nImporte2 = #222#5;
              |FINSI;

              |SI nExis = 0;
                  |SI #51#13 = nAnyo; #51#16 = nImporte2; |FINSI;
                  |SI #51#14 = nAnyo; #51#17 = nImporte2; |FINSI;
                  |SI #51#15 = nAnyo;
                      || ... |SI nSwConta = 1; #51#12 = #219#80; |FINSI;
                      #51#12 = nImporte1;
                      #51#18 = nImporte2;
                  |FINSI;
              |FINSI;
          |FINSI;
     |SIGUE;
     |SELECT #1#222;
     |CIERRA #222;

     |SI nSwAny1 = 0; |O nSwAny2 = 0; |O nSwAny3 = 0;
         |HAZ PorRendim;
     |FINSI;
|FPRC;

|PROCESO BusquedaSocie;
     eaPathContasoc  = "";
     |DBASS aBase;   |QBF aBase;

     aAlfa = aBase + "contasoc/def/maempr10.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathContasoc = aBase + "contasoc/";
         aPath  = eaPathContasoc + "fich/";
         |PATH_DAT #222 aPath;
         |PATH_DAT #223 aPath;
     |FINSI;
|FPRC;
