|FICHEROS;
     dsmoy000 #0;
     dsmom001 #1;
     dsmom004 #4;
     dsmom107 #107;
     dsmom025 #25;

     dsmo1347 #347;
     dsmo2347 #348;
     dsmo3347 #351;
     dsmo4347 #352;

     dsmow014 #999;
     dsmow015 #998;
     dsmow016 #997;
     dsmow500 #500;
     dsmow501 #501;
     dsmow502 #502;
     dsmow503 #503;
     dsmow504 #504;
     dsmow589 #589;
     dsmow590 #590;
     dsmow591 #591;

     dsmow653 #653;

     dsmow654 #654;
     dsmow655 #655;

     :/basica/def/agicen15 #1015;
     :/basica/def/agicen17 #17;
     :/basica/def/agim0024 #24;
     :/basica/def/agim0026 #26;

     &regisnif@ #709;
     &clientes@ #715;
|FIN;

|VARIABLES;
     nEmpresa  = 0;
     aAnyo     = "";

     aO1        = "";
     aO2        = "";
     aO3        = "";
     aO4        = "";
     aO5        = "";

     &eaTfno    = "";
     &enSwLinea = 0;
     &enCobro   = 0;
     &enEjer    = 0;
     &enPeriodo = 0;
     &enComplem = 0;
     &enTipoEntrada = 0;
|FIN;

|INCLUYE i_varemi;

|PROCESO Registro0;
     |DDEFECTO #500;

     #500#0  = "0";

     #500#1  = "347";

     #500#2  = #0#6;

     eaVarDni = #997#0;  |HAZ CalculameDNI;
     #500#3  = eaVarDni;

     eaAlfa  = #997#1;  |HAZ QuitaRaros;
     #500#4  = eaAlfa;

     #500#5  = #997#2;

     eaAlfa  = #997#3;  |HAZ QuitaRaros;
     #500#6  = eaAlfa;

     nNume   = #997#4;
     #500#7  = (("00000" + nNume) % -105):

     #500#8  = #997#5;

     #500#9  = #997#6;

     #500#10 = #997#7;

     #500#11 = (("00" + #997#8) % -102) + (("000" + #997#9) % -103);

     eaAlfa  = #997#10;  |HAZ QuitaRaros;
     #500#12 = eaAlfa;

     #500#13 = (("00" + #997#8) % -102);

     #500#14 = (("00000" + #997#17) % -105);

     #500#15 = (("000000000" + #997#18) % -109);

     #500#16 = "D";

     eaAlfa  = #997#14;  |HAZ QuitaRarosTfno;
     #500#17 = eaAlfa;

     eaAlfa  = #997#13;  |HAZ QuitaRaros;
     #500#18 = eaAlfa;

     #500#20 = &13 + &10;

     |SI nTecla ! 2;  |Y nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 20;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #500nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |FINSI;
|FPRC;

|PROCESO Registro1;
     enCodCli = #347#0;
     |HAZ LeePersona;

     |DDEFECTO #501;

     #501#0  = "1";

     #501#1  = "347";

     #501#2  = #347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #501#3   = eaVarDni;

         eaAlfa   = #715#1;  |HAZ QuitaRaros;
         #501#4   = eaAlfa;

         eaAlfa   = #715#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #715#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #501#6   = eaAlfa;

         eaAlfa   = #715#53;  |HAZ QuitaRaros;
         #501#7   = eaAlfa;

         eaDeleg     = #715#17;
         eaAdmin     = #715#18;
         eaProvincia = #715#38;
     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #501#3   = eaVarDni;

         eaAlfa   = #715#1;   |HAZ QuitaRaros;
         #501#4   = eaAlfa;

         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;
         |QBF eaAlfa;
         |SI eaAlfa = "";  eaAlfa = "000000000";  |FINSI;
         #501#6   = eaAlfa;

         eaAlfa   = #715#96;  |HAZ QuitaRaros;
         #501#7   = eaAlfa;

         eaDeleg     = #715#91;
         eaAdmin     = #715#92;
         eaProvincia = #715#12;
     |FINSI;

     #501#5  = "D";
     |SI #0#6 ] 2006;  #501#5  = "T";  |FINSI;

     |SI eaMoneda = "PESETAS";
         #501#8 = "3470000000000";
     |SINO;
         #501#8 = "3480000000000";
     |FINSI;

     nNume   = #347#6 + #347#8 + #347#10 + #347#12 + #347#14 + #347#20 + #347#22;
     #501#12 = ("000000000" + nNume) % -109;

     enNume  = #347#7 + #347#9 + #347#11 + #347#13 + #347#15 + #347#21 + #347#23;  |HAZ Conver15;
     #501#13 = eaAlfa;

     #501#14 = ("000000000" + #347#16) % -109;

     enNume  = #347#17;   |HAZ Conver15;  #501#15 = eaAlfa;

     |SI #347#19 = "C";  #501#9  = "C";  |FINSI;

     |SI #347#19 = "S";
         #501#10 = "S";
         #501#11 = #347#18;
     |FINSI;

     #501#17 = &13 + &10;

     |SI nTecla ! 2;  |Y nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #501nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |FINSI;
|FPRC;

|PROCESO Registro1_2008;
     enCodCli = #347#0;
     |HAZ LeePersona;

     |DDEFECTO #589;

     #589#0  = "1";

     #589#1  = "347";

     #589#2  = #347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #589#3   = eaVarDni;

         eaAlfa   = #715#1;  |HAZ QuitaRaros;
         #589#4   = eaAlfa;

         eaAlfa   = #715#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #715#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #589#6   = eaAlfa;

         eaAlfa   = #715#53;  |HAZ QuitaRaros;
         #589#7   = eaAlfa;

         eaDeleg     = #715#17;
         eaAdmin     = #715#18;
         eaProvincia = #715#38;
     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #589#3   = eaVarDni;

         eaAlfa   = #715#1;   |HAZ QuitaRaros;
         #589#4   = eaAlfa;

         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;
         |QBF eaAlfa;
         |SI eaAlfa = "";  eaAlfa = "000000000";  |FINSI;
         #589#6   = eaAlfa;

         eaAlfa   = #715#96;  |HAZ QuitaRaros;
         #589#7   = eaAlfa;

         eaDeleg     = #715#91;
         eaAdmin     = #715#92;
         eaProvincia = #715#12;
     |FINSI;

     #589#5  = "D";
     |SI #0#6 ] 2006;  #589#5  = "T";  |FINSI;

     #589#8 = "3470000000000";

     nNume   = #347#6 + #347#8 + #347#10 + #347#12 + #347#14 + #347#20 + #347#22;
     #589#12 = ("000000000" + nNume) % -109;

     enNume  = #347#7 + #347#9 + #347#11 + #347#13 + #347#15 + #347#21 + #347#23;  |HAZ Conver15;
     #589#13 = eaAlfa;

     #589#14 = ("000000000" + #347#16) % -109;

     enNume  = #347#17;   |HAZ Conver15;  #589#15 = eaAlfa;

     |SI #347#19 = "C";
         #589#9  = "C";
         #589#11 = #347#18;
     |FINSI;

     |SI #347#19 = "S";
         #589#10 = "S";
         #589#11 = #347#18;
     |FINSI;

     #589#19 = &13 + &10;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #589nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |FINSI;
|FPRC;

|PROCESO Registro1_2011;
     enCodCli = #347#0;
     |HAZ LeePersona;

     |DDEFECTO #654;

     #654#0  = "1";

     #654#1  = "347";

     #654#2  = #347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #654#3   = eaVarDni;

         eaAlfa   = #715#1;  |HAZ QuitaRaros;
         #654#4   = eaAlfa;

         eaAlfa   = #715#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #715#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #654#6   = eaAlfa;

         eaAlfa   = #715#53;  |HAZ QuitaRaros;
         #654#7   = eaAlfa;

         eaDeleg     = #715#17;
         eaAdmin     = #715#18;
         eaAlfa      = #715#38;  |HAZ QuitaRaros;
         eaProvincia = eaAlfa;
     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #654#3   = eaVarDni;

         eaAlfa   = #715#1;   |HAZ QuitaRaros;
         #654#4   = eaAlfa;

         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;
         |QBF eaAlfa;
         |SI eaAlfa = "";  eaAlfa = "000000000";  |FINSI;
         #654#6   = eaAlfa;

         eaAlfa   = #715#96;  |HAZ QuitaRaros;
         #654#7   = eaAlfa;

         eaDeleg     = #715#91;
         eaAdmin     = #715#92;
         eaAlfa      = #715#12;  |HAZ QuitaRaros;
         eaProvincia = eaAlfa;
     |FINSI;

     #654#5  = "D";
     #654#5  = "T";
     #654#8 = "3470000000000";

     nNume   = #347#6 + #347#8 + #347#10 + #347#12 + #347#14 + #347#20 + #347#22;
     #654#12 = ("000000000" + nNume) % -109;

     enNume  = #347#7 + #347#9 + #347#11 + #347#13 + #347#15 + #347#21 + #347#23;
     |HAZ Conver16Signo;
     #654#13 = eaAlfa;

     #654#14 = ("000000000" + #347#16) % -109;

     enNume  = #347#17;   |HAZ Conver15;  #654#15 = eaAlfa;

     |SI #347#19 = "C";
         #654#9  = "C";
         #654#11 = #347#18;
     |FINSI;

     |SI #347#19 = "S";
         #654#10 = "S";
         #654#11 = #347#18;
     |FINSI;

     #654#19 = &13 + &10;

     nHCampo = 19;
     |SI #dsmoy000#6 ] 2012;  |Y eaOpcion ! "3";
         nHCampo = 18;
     |FINSI;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #654nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |FINSI;
|FPRC;

|PROCESO Registro2;
     enCodCli = #347#0;
     |HAZ LeePersona;

     |DDEFECTO #502;

     #502#0  = "2";

     #502#1  = "347";

     #502#2  = #347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #502#3   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #502#3   = eaVarDni;
     |FINSI;

     |ABRE #25;
     #25#0 = #348#7;
     |LEE 040#25=;
     |SI FSalida = 0;
         #502#4 = #25#2;

         |SI #0#6 ] 2007;  #502#4 = "";  |FINSI;
     |SINO;
         eaVarDni = #348#7;  |HAZ CalculameDNI;
         |SI #348#10 = "N";
             #502#4 = eaVarDni;
         |SINO;
             #502#5 = eaVarDni;
         |FINSI;
     |FINSI;
     |CIERRA #25;

     eaAlfa   = #348#11;  |HAZ QuitaRaros;
     #502#6 = eaAlfa;

     #502#7  = "D";

     eaCodNif = #348#7;
     |HAZ LeeNifs;

     eaAlfa = #709#8;
     |HAZ QuitaRarosTfno;
     eaTfno = eaAlfa;

     #502#8   = ("00" + #709#4) % -102;

     |SI #0#6 [ 2003;
         #502#9   = "000";
         |SI #709#4 = 99;  #502#9 = ("000" + #709#5) % -103;  |FINSI;
     |FINSI;

     |SI #0#6 ] 2004;
         #502#9   = "   ";
         |SI #709#4 = 99;  #502#9 = #709#12;  |FINSI;
     |FINSI;

     #502#10  = #348#6;

     enNume = #348#12;  |HAZ Conver15;  #502#11 = eaAlfa;

     |SI #348#8 = "S";  #502#12 = "X";  |FINSI;

     |SI #348#9 = "S";  #502#13 = "X";  |FINSI;

     #502#15 = &13 + &10;

     |SI nTecla ! 2;  |Y nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 15;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #502nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |SINO;
         |SI nTecla ! 5;
             nContador = nContador + 1;
             nSwPrint = 1;
             |SI nContador > 5;  nContador = 1;  |PIEINF;  |FINSI;
         |FINSI;

         |PRINT;
     |FINSI;
|FPRC;

|PROCESO Registro2_2008;
     enCodCli = #347#0;
     |HAZ LeePersona;

     |DDEFECTO #590;

     #590#0  = "2";

     #590#1  = "347";

     #590#2  = #347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #590#3   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #590#3   = eaVarDni;
     |FINSI;

     |ABRE #25;
     #25#0 = #348#7;
     |LEE 040#25=;
     |SI FSalida = 0;
         #590#4 = "";
     |SINO;
         eaVarDni = #348#7;  |HAZ CalculameDNI;
         |SI #348#10 = "N";
             #590#4 = eaVarDni;
         |SINO;
             #590#5 = eaVarDni;
         |FINSI;
     |FINSI;
     |CIERRA #25;

     eaAlfa   = #348#11;  |HAZ QuitaRaros;
     #590#6 = eaAlfa;

     #590#7  = "D";

     eaCodNif = #348#7;
     |HAZ LeeNifs;

     eaAlfa = #709#8;
     |HAZ QuitaRarosTfno;
     eaTfno = eaAlfa;

     #590#8   = ("00" + #709#4) % -102;

     #590#9   = "   ";
     |SI #709#4 = 99;  #590#9 = #709#12;  |FINSI;

     #590#10  = #348#6;

     enNume = #348#12;  |HAZ Conver15;  #590#11 = eaAlfa;

     |SI #348#8 = "S";  #590#12 = "X";  |FINSI;

     |SI #348#9 = "S";  #590#13 = "X";  |FINSI;

     enNume = #348#13;  |HAZ Conver15;  #590#14 = eaAlfa;
     enNume = #348#14;  |HAZ Conver15;  #590#15 = eaAlfa;

     #590#18 = &13 + &10;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #590nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |SINO;
         |PRINT;
     |FINSI;
|FPRC;

|PROCESO Registro2_2010R;
         |SI nTecla ! 5;
             aAlfa = "";
             |PARA nCampo = 0;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
                   aAlfa = #653nCampo;
                   |XGRABA nHandle2, aAlfa;
             |SIGUE;
             nTRegistro = nTRegistro + 1;
         |SINO;
             |PRINT;
         |FINSI;
         enSwLinea = 1;
|FPRC;

|PROCESO Registro2_2011R;
     nHCampo = 27;
     |SI #dsmoy000#6 ] 2012;  |Y eaOpcion ! "3";
         nHCampo = 26;
     |FINSI;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #655nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |SINO;
         |PRINT;
     |FINSI;
     enSwLinea = 1;
|FPRC;

|PROCESO Registro4_2010;
     enCobro = #352#11;
     |SI #352#11 ! 0;
         enNume  = #352#11;  |HAZ Conver15;  #653#14 = eaAlfa;
         #653#16 = #352#10;  || ejercicio del cobro
         |SI enSwLinea ! 0;
             enNume = 0;  |HAZ Conver15;  #653#11 = eaAlfa;
             enNume = 0;  |HAZ Conver15;  #653#15 = eaAlfa;
         |FINSI;
         |HAZ Registro2_2010R;
     |FINSI;
|FPRC;

|DEFBUCLE Registro4_2010;
    #352#1;
    ;
    #348#0, #348#1, #348#2, #348#3, #348#4, #348#5, #348#6, #348#7, aO1, aO2, aO3, aO4, aO5, 2990;
    #348#0, #348#1, #348#2, #348#3, #348#4, #348#5, #348#6, #348#7, aO1, aO2, aO3, aO4, aO5, 2008;
    e;
    NULL, Registro4_2010;
|FIN;

|PROCESO Registro4_2011;
     enCobro = #352#11;
     |SI #352#11 ! 0;
         enNume  = #352#11;  |HAZ Conver15;  #655#15 = eaAlfa;
         #655#17 = #352#10;  || ejercicio del cobro
         |SI enSwLinea ! 0;
             enNume = 0;  |HAZ Conver16Signo;  #655#12 = eaAlfa;
                                               #655#16 = eaAlfa;
                                               #655#18 = eaAlfa;
                                               #655#19 = eaAlfa;
                                               #655#20 = eaAlfa;
                                               #655#21 = eaAlfa;
                                               #655#22 = eaAlfa;
                                               #655#23 = eaAlfa;
                                               #655#24 = eaAlfa;
                                               #655#25 = eaAlfa;
         |FINSI;
         |HAZ Registro2_2011R;
     |FINSI;
|FPRC;

 || #348#0, #348#1, #348#2, #348#3, #348#4, #348#5, #348#6, #348#7, #348#25, #348#26, #348#8, #348#9, #348#27, 2008;

|DEFBUCLE Registro4_2011;
    #352#1;
    ;
    #348#0, #348#1, #348#2, #348#3, #348#4, #348#5, #348#6, #348#7, aO1, aO2, aO3, aO4, aO5, 2990;
    #348#0, #348#1, #348#2, #348#3, #348#4, #348#5, #348#6, #348#7, aO1, aO2, aO3, aO4, aO5, 2008;
    e;
    NULL, Registro4_2011;
|FIN;

|PROCESO Registro2_2010;
     enCodCli = #347#0;
     |HAZ LeePersona;

     |DDEFECTO #653;      || falta comprobar que es bueno 590

     #653#0  = "2";

     #653#1  = "347";

     #653#2  = #347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #653#3   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #653#3   = eaVarDni;
     |FINSI;

     |ABRE #25;
     #25#0 = #348#7;
     |LEE 040#25=;
     |SI FSalida = 0;
         #653#4 = "";
     |SINO;
         eaVarDni = #348#7;  |HAZ CalculameDNI;
         |SI #348#10 = "N";
             #653#4 = eaVarDni;
         |SINO;
             #653#5 = eaVarDni;
         |FINSI;
     |FINSI;
     |CIERRA #25;

     eaAlfa   = #348#11;  |HAZ QuitaRaros;
     #653#6 = eaAlfa;

     #653#7  = "D";

     eaCodNif = #348#7;
     |HAZ LeeNifs;

     eaAlfa = #709#8;
     |HAZ QuitaRarosTfno;
     eaTfno = eaAlfa;

     #653#8   = ("00" + #709#4) % -102;

     #653#9   = "   ";
     |SI #709#4 = 99;  #653#9 = #709#12;  |FINSI;

     #653#10  = #348#6;

     enNume = #348#12;  |HAZ Conver15;  #653#11 = eaAlfa;

     |SI #348#8 = "S";  #653#12 = "X";  |FINSI;

     |SI #348#9 = "S";  #653#13 = "X";  |FINSI;

     enCobro = #348#13;
     |SI #348#13 ! 0;
         enNume = #348#13;  |HAZ Conver15;  #653#14 = eaAlfa;
         #653#16 = #0#6;
     |FINSI;
     enNume = #348#14;  |HAZ Conver15;  #653#15 = eaAlfa;

     #653#19 = &13 + &10;

     enSwLinea = 0;
     |SI #348#6 = "A"; |O #348#6 = "B";
         |SI #0#6 ] 2010;
             |SI #348#12 ! 0;  |HAZ Registro2_2010R; |FINSI;
             aO1 = #348#25;
             aO2 = #348#26;
             aO3 = #348#8;
             aO4 = #348#9;
             aO5 = #348#27;
             |BUCLE Registro4_2010;
         |FINSI;
         |SI enSwLinea = 0;  |HAZ Registro2_2010R; |FINSI;  || no habia cobro alguno
     |SINO;
         |HAZ Registro2_2010R;
     |FINSI;
|FPRC;

|PROCESO Registro2_2011;
     enCodCli = #347#0;
     |HAZ LeePersona;

     |DDEFECTO #655;

     #655#0  = "2";

     #655#1  = "347";

     #655#2  = #347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #655#3   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #655#3   = eaVarDni;
     |FINSI;

     |ABRE #25;
     #25#0 = #348#7;
     |LEE 040#25=;
     |SI FSalida = 0;
         #655#4 = "";
     |SINO;
         eaVarDni = #348#7;  |HAZ CalculameDNI;
         |SI #348#10 = "N";
             #655#4 = eaVarDni;
         |SINO;
             #655#5 = eaVarDni;
         |FINSI;
     |FINSI;
     |CIERRA #25;

     eaAlfa   = #348#11;  |HAZ QuitaRaros;
     #655#6 = eaAlfa;

     #655#7  = "D";

     eaCodNif = #348#7;
     |HAZ LeeNifs;

     eaAlfa = #709#8;
     |HAZ QuitaRarosTfno;
     eaTfno = eaAlfa;

     #655#8   = ("00" + #709#4) % -102;

     #655#9   = "   ";
     |SI #709#4 = 99;  #655#4 = ""; #655#9 = #709#12;  |FINSI; || es extranjero
                                                               || tique 4655_87
     #655#10  = "";
     #655#11  = #348#6;

     enNume = #348#12;  |HAZ Conver16Signo;  #655#12 = eaAlfa;

     |SI #348#8 = "S";  #655#13 = "X";  |FINSI;

     |SI #348#9 = "S";  #655#14 = "X";  |FINSI;

     enCobro = #348#13;
     |SI #348#13 ! 0;
         enNume = #348#13;  |HAZ Conver15;  #655#15 = eaAlfa;
         #655#17 = #0#6;
     |FINSI;

     enNume = #348#14;  |HAZ Conver16Signo;  #655#16 = eaAlfa;
     enNume = #348#16;  |HAZ Conver16Signo;  #655#18 = eaAlfa;
     enNume = #348#20;  |HAZ Conver16Signo;  #655#19 = eaAlfa;
     enNume = #348#17;  |HAZ Conver16Signo;  #655#20 = eaAlfa;
     enNume = #348#21;  |HAZ Conver16Signo;  #655#21 = eaAlfa;
     enNume = #348#18;  |HAZ Conver16Signo;  #655#22 = eaAlfa;
     enNume = #348#22;  |HAZ Conver16Signo;  #655#23 = eaAlfa;
     enNume = #348#19;  |HAZ Conver16Signo;  #655#24 = eaAlfa;
     enNume = #348#23;  |HAZ Conver16Signo;  #655#25 = eaAlfa;

     #655#27 = &13 + &10;

     nHCampo = 27;
     |SI #dsmoy000#6 ] 2012;  |Y eaOpcion ! "3";
         nHCampo = 26;
     |FINSI;

     enSwLinea = 0;
     |SI #348#6 = "A"; |O #348#6 = "B";
         |SI #0#6 ] 2011;
             |SI #348#12 ! 0;  |HAZ Registro2_2011R; |FINSI;
             aO1 = #348#25;
             aO2 = #348#26;
             aO3 = #348#8;
             aO4 = #348#9;
             aO5 = #348#27;

             |BUCLE Registro4_2011;
         |FINSI;

         |SI enSwLinea = 0;  |HAZ Registro2_2011R; |FINSI;  || no habia cobro alguno
     |SINO;
         |HAZ Registro2_2011R;
     |FINSI;
|FPRC;

|DEFBUCLE dsmo2347_2011;
     #348#1;
     ;
     #347#0, #347#1, #347#2, #347#3, #347#4, #347#5, " ", "            ", " ", " ", " ", " ", " ";
     #347#0, #347#1, #347#2, #347#3, #347#4, #347#5, "z", "zzzzzzzzzzzz", "z", "z", "z", "z", "z";
     ;
     NULL, Registro2_2011;
|FIN;

|PROCESO Registro2I;
     enCodCli = #347#0;
     |HAZ LeePersona;

     |ABRE #17;
     #17#0 = #351#0;
     #17#1 = #351#5;
     #17#2 = #351#6;
     |LEE 040#17=;
     |SI FSalida ! 0;  |DDEFECTO #17;  |FINSI;
     |CIERRA #17;

     |DDEFECTO #503;

     #503#0  = "2";

     #503#1  = "347";

     #503#2  = #347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #503#3   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #503#3   = eaVarDni;
     |FINSI;

     |ABRE #25;
     #25#0 = #351#7;
     |LEE 040#25=;
     |SI FSalida = 0;
         #503#4 = #25#2;

         |SI #0#6 ] 2007;  #502#4 = "";  |FINSI;
     |SINO;
         eaVarDni = #351#7;  |HAZ CalculameDNI;
         |SI #351#11 = "N";
             #503#4 = eaVarDni;
         |SINO;
             #503#5 = eaVarDni;
         |FINSI;
     |FINSI;
     |CIERRA #25;

     eaAlfa   = #351#8;  |HAZ QuitaRaros;
     #503#6 = eaAlfa;

     #503#7  = "I";

     enNume = #351#10;  |HAZ Conver15;  #503#9 = eaAlfa;

     #503#10 = #351#9;

     #503#11 = ("00" + #17#6) % -102;

     #503#12 = #17#8;

     #503#13 = #17#10;

     #503#14 = #17#11;

     nNume   = #17#12;
     #503#15 = ("00000" + nNume) % -105;

     #503#16 = #17#13;

     #503#17 = #17#14;

     #503#18 = #17#15;

     #503#20 = &13 + &10;

     |SI nTecla ! 2;  |Y nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 20;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #503nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |SINO;
         |SI nTecla ! 5;
             nContador = nContador + 1;
             nSwPrint = 1;
             |SI nContador > 5;  nContador = 1;  |PIEINF;  |FINSI;
         |FINSI;

         |SI nTecla = 5;
             eaCodNif = #351#7;
             |HAZ LeeNifs;
             eaAlfa = #709#8;
             |HAZ QuitaRarosTfno;
             eaTfno = eaAlfa;
         |FINSI;

         |PRINT;

     |FINSI;
|FPRC;

|PROCESO ComparaSiglas;
    |QBF aAlfa;
    |SI aAlfa = "AL";  aAlfa = "ALAM ";  |FINSI;
    |SI aAlfa = "AD";  aAlfa = "ALDEA";  |FINSI;
    |SI aAlfa = "AP";  aAlfa = "APTOS";  |FINSI;
    |SI aAlfa = "AR";  aAlfa = "ARRAL";  |FINSI;
    |SI aAlfa = "AY";  aAlfa = "ARRY ";  |FINSI;
    |SI aAlfa = "AV";  aAlfa = "AVDA ";  |FINSI;
    |SI aAlfa = "BJ";  aAlfa = "BJADA";  |FINSI;
    |SI aAlfa = "BR";  aAlfa = "BRANC";  |FINSI;
    |SI aAlfa = "BO";  aAlfa = "BARRO";  |FINSI;
    |SI aAlfa = "BL";  aAlfa = "BLQUE";  |FINSI;
    |SI aAlfa = "CL";  aAlfa = "CALLE";  |FINSI;
    |SI aAlfa = "CJ";  aAlfa = "CLLJA";  |FINSI;
    |SI aAlfa = "CM";  aAlfa = "CMNO ";  |FINSI;
    |SI aAlfa = "CR";  aAlfa = "CTRA ";  |FINSI;
    |SI aAlfa = "CS";  aAlfa = "CSRIO";  |FINSI;
    |SI aAlfa = "CO";  aAlfa = "COL  ";  |FINSI;
    |SI aAlfa = "CN";  aAlfa = "CJTO ";  |FINSI;
    |SI aAlfa = "CT";  aAlfa = "CUSTA";  |FINSI;
    |SI aAlfa = "CH";  aAlfa = "CHLET";  |FINSI;
    |SI aAlfa = "ED";  aAlfa = "EDIFC";  |FINSI;
    |SI aAlfa = "EN";  aAlfa = "ENTD ";  |FINSI;
    |SI aAlfa = "ES";  aAlfa = "ESCAL";  |FINSI;
    |SI aAlfa = "EX";  aAlfa = "EXPLA";  |FINSI;
    |SI aAlfa = "EM";  aAlfa = "EXTRM";  |FINSI;
    |SI aAlfa = "ER";  aAlfa = "EXTRR";  |FINSI;
    |SI aAlfa = "GL";  aAlfa = "GTA  ";  |FINSI;
    |SI aAlfa = "GV";  aAlfa = "G.V. ";  |FINSI;
    |SI aAlfa = "GR";  aAlfa = "GRUPO";  |FINSI;
    |SI aAlfa = "JR";  aAlfa = "JDIN ";  |FINSI;
    |SI aAlfa = "LG";  aAlfa = "LUGAR";  |FINSI;
    |SI aAlfa = "MS";  aAlfa = "MASIA";  |FINSI;
    |SI aAlfa = "MC";  aAlfa = "MERC ";  |FINSI;
    |SI aAlfa = "MT";  aAlfa = "MONTE";  |FINSI;
    |SI aAlfa = "ML";  aAlfa = "MUELL";  |FINSI;
    |SI aAlfa = "PQ";  aAlfa = "PQUE ";  |FINSI;
    |SI aAlfa = "PQ";  aAlfa = "PQUE ";  |FINSI;
    |SI aAlfa = "PD";  aAlfa = "PTDA ";  |FINSI;
    |SI aAlfa = "PJ";  aAlfa = "PSAJE";  |FINSI;
    |SI aAlfa = "PS";  aAlfa = "PASEO";  |FINSI;
    |SI aAlfa = "PZ";  aAlfa = "PLAZA";  |FINSI;
    |SI aAlfa = "PB";  aAlfa = "PBDO ";  |FINSI;
    |SI aAlfa = "PG";  aAlfa = "POLIG";  |FINSI;
    |SI aAlfa = "PR";  aAlfa = "PROL ";  |FINSI;
    |SI aAlfa = "PT";  aAlfa = "PNTE ";  |FINSI;
    |SI aAlfa = "PU";  aAlfa = "PTA  ";  |FINSI;
    |SI aAlfa = "RM";  aAlfa = "RAMAL";  |FINSI;
    |SI aAlfa = "RB";  aAlfa = "RBLA ";  |FINSI;
    |SI aAlfa = "RP";  aAlfa = "RAMPA";  |FINSI;
    |SI aAlfa = "RR";  aAlfa = "RIERA";  |FINSI;
    |SI aAlfa = "RC";  aAlfa = "RCON ";  |FINSI;
    |SI aAlfa = "RD";  aAlfa = "RONDA";  |FINSI;
    |SI aAlfa = "RU";  aAlfa = "RUA  ";  |FINSI;
    |SI aAlfa = "SC";  aAlfa = "SECT ";  |FINSI;
    |SI aAlfa = "SD";  aAlfa = "SENDA";  |FINSI;
    |SI aAlfa = "SB";  aAlfa = "SBIDA";  |FINSI;
    |SI aAlfa = "TO";  aAlfa = "TRRNT";  |FINSI;
    |SI aAlfa = "TR";  aAlfa = "TRVA ";  |FINSI;
    |SI aAlfa = "UR";  aAlfa = "URB  ";  |FINSI;
    |SI aAlfa = "VI";  aAlfa = "VIA  ";  |FINSI;
    |SI aAlfa = "VP";  aAlfa = "VIA  ";  |FINSI;
|FPRC;

|PROCESO Registro2I_2008;
     enCodCli = #347#0;
     |HAZ LeePersona;

     |ABRE #17;
     #17#0 = #351#0;
     #17#1 = #351#5;
     #17#2 = #351#6;
     |LEE 040#17=;
     |SI FSalida ! 0;  |DDEFECTO #17;  |FINSI;
     |CIERRA #17;

     |DDEFECTO #591;

     #591#0  = "2";

     #591#1  = "347";

     #591#2  = #347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #591#3   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #591#3   = eaVarDni;
     |FINSI;

     |ABRE #25;
     #25#0 = #351#7;
     |LEE 040#25=;
     |SI FSalida = 0;
         #502#4 = "";
     |SINO;
         eaVarDni = #351#7;  |HAZ CalculameDNI;
         |SI #351#11 = "N";
             #591#4 = eaVarDni;
         |SINO;
             #591#5 = eaVarDni;
         |FINSI;
     |FINSI;
     |CIERRA #25;

     eaAlfa   = #351#8;  |HAZ QuitaRaros;
     #591#6 = eaAlfa;

     #591#7  = "I";

     enNume = #351#10;  |HAZ Conver15;  #591#9 = eaAlfa;


     #591#10 = #17#17;
     #591#11 = #351#9;
     aAlfa   = #17#10;  |HAZ ComparaSiglas;  #591#12 = aAlfa;

     eaAlfa  = #17#11;  |HAZ QuitaRaros;
     #591#13 = eaAlfa;

     #591#14 = "NUM";
     nNume   = #17#12;
     #591#15 = ("00000" + nNume) % -105;
     #591#19 = #17#13;
     #591#20 = #17#14;
     #591#21 = #17#15;

     eaAlfa  = #17#8;  |HAZ QuitaRaros;
     #591#24 = eaAlfa;

||     #591#25 = "00000";
     #591#25 = #17#18;
     #591#26 = ("00" + #17#6) % -102;
     #591#27 = (("00" + #17#6) % -102) + (("000" + #17#7) % -103);
     #591#29 = &13 + &10;

     nHCampo = 29;
     |SI #dsmoy000#6 ] 2012;  |Y eaOpcion ! "3";
         nHCampo = 28;
     |FINSI;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #591nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |SINO;
         eaCodNif = #351#7;
         |HAZ LeeNifs;
         eaAlfa = #709#8;
         |HAZ QuitaRarosTfno;
         eaTfno = eaAlfa;

         |PRINT;
     |FINSI;
|FPRC;

|PROCESO BuscaCargo;
     eaAlfa  = #26#4;  |HAZ QuitaRaros;
     #504#13 = eaAlfa;

     eaAlfa  = #26#17;  |HAZ QuitaRaros;
     #504#14 = eaAlfa;
|FPRC;

|DEFBUCLE agim0026;
     #26#1;
     16;
     #347#0, 01, 01, 3;
     #347#0, 99, 99, 3;
     ;
     NULL, BuscaCargo;
|FIN;

|PROCESO BuscaCargo347R;
     |SI #24#15 ! "A";
         eaAlfa  = #24#4;  |HAZ QuitaRaros;
         #504#13 = eaAlfa;

         eaAlfa  = "REPRESENTANTE";  |HAZ QuitaRaros;
         #504#14 = eaAlfa;

         nHayRepre = 1;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE agim0024;
     #24#2;
     ;
     #347#0, 99, 01;
     #347#0, 01, 99;
     ;
     NULL, BuscaCargo347R;
|FIN;

|PROCESO BuscaComuneros347;
     aAlfa = "31.12." + #347#1;
     |SI #1#8 > aAlfa;  |ACABA;  |FINSI;

     aAlfa = "01.01." + #347#1;
     |SI #1#9 > "01.01.0000";
         |SI #1#9 < aAlfa;  |ACABA;  |FINSI;
     |FINSI;

     nHayRepre = 1;

     enCodCli = #1#3;
     |HAZ LeePersona;

     eaAlfa  = #715#1;           |HAZ QuitaRaros;   #504#13 = eaAlfa;
     eaAlfa  = "REPRESENTANTE";  |HAZ QuitaRaros;   #504#14 = eaAlfa;

     |ERROR10;
|FPRC;

|DEFBUCLE dsmom001;
     #1#1;
     ;
     #347#0, 01, 0001;
     #347#0, 99, 9999;
     ;
     NULL, BuscaComuneros347;
|FIN;

|PROCESO Registro0Auxiliar;
     |DDEFECTO #504;

     #504#0  = "0";

     #504#1  = "347";

     #504#2  = #347#1;

     eaVarDni = #997#0;  |HAZ CalculameDNI;
     #504#3   = eaVarDni;

     #504#4   = ("00" + #997#11) % -102;

     #504#5   = ("000" + #997#12) % -103;

     #504#6   = #997#2;

     eaAlfa   = #997#3;  |HAZ QuitaRaros;
     #504#7   = eaAlfa;

     nNume    = #997#4;
     #504#8   = ("00000" + nNume) % -105;

     eaAlfa   = #997#10;  |HAZ QuitaRaros;
     #504#9   = eaAlfa;

     #504#10  = ("00" + #997#8) % -102;

     #504#11  = (("00" + #997#8) % -102) + (("000" + #997#9) % -103);

     #504#12  = (#0#7 % -104) + (#0#7 % 402) + (#0#7 % 102);

     eaAlfa   = #997#15;  |HAZ QuitaRaros;
     #504#13  = eaAlfa;

     eaAlfa   = #997#16;  |HAZ QuitaRaros;
     #504#14  = eaAlfa;

     #504#16  = ("00000" + #999#0) % -105;
     #504#17  = &13 + &10;

     |SI #0#6 = 2000;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |SI nCampo ! 16;
                   aAlfa = #504nCampo;
                   |XGRABA nHandle3, aAlfa;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI #0#6 = 2001;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |SI nCampo ! 15; |Y nCampo ! 16;
                    aAlfa = #504nCampo;
                    |XGRABA nHandle3, aAlfa;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI #0#6 ] 2002;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |SI nCampo ! 15;
                   aAlfa = #504nCampo;
                   |XGRABA nHandle3, aAlfa;
               |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Registro1Auxiliar;
     enCodCli = #347#0;
     |HAZ LeePersona;

     |DDEFECTO #504;

     #504#0  = "1";

     #504#1  = "347";

     #504#2  = #347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #504#3   = eaVarDni;

         #504#4   = ("00" + #715#15) % -102;

         #504#5   = ("000" + #715#16) % -103;

         #504#6   = #715#29;

         eaAlfa   = #715#30;  |HAZ QuitaRaros;
         #504#7   = eaAlfa;

         nNume    = #715#31;
         #504#8   = ("00000" + nNume) % -105;

         eaAlfa   = #715#37;  |HAZ QuitaRaros;
         #504#9   = eaAlfa;

         #504#10  = ("00" + #715#35) % -102;

         #504#11  = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #504#3   = eaVarDni;

         #504#4   = ("00" + #715#63) % -102;

         #504#5   = ("000" + #715#64) % -103;

         #504#6   = #715#3;

         eaAlfa   = #715#4;  |HAZ QuitaRaros;
         #504#7   = eaAlfa;

         nNume    = #715#5;
         #504#8   = ("00000" + nNume) % -105;

         #504#9   = #715#11;

         #504#10  = ("00" + #715#9) % -102;

         #504#11  = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
     |FINSI;

     #504#12  = (#0#7 % -104) + (#0#7 % 402) + (#0#7 % 102);

     |SI nTecla ! 4;
         |SI #107#1 = "S";
             |BUCLE agim0026;
         |SINO;
             nHayRepre = 0;
             |BUCLE agim0024;
             |SI nHayRepre = 0;
                 |BUCLE dsmom001;
                 |SI nHayRepre = 0;
                     |ABRE #1015;
                     #1015#0 = #347#0;
                     |LEE 000#1015=;
                     |SI FSalida ! 0; |DDEFECTO #1015; |FINSI;
                     |CIERRA #1015;
                     |SI #1015#0 =  "            ";
                         eaAlfa  = #999#3;  |HAZ QuitaRaros;
                         #504#13 = eaAlfa;

                         eaAlfa  = "TITULAR";  |HAZ QuitaRaros;
                         #504#14 = eaAlfa;
                     |SINO;
                         eaAlfa  = #1015#5;  |HAZ QuitaRaros;
                         #504#13 = eaAlfa;

                         eaAlfa  = #1015#7;  |HAZ QuitaRaros;
                         #504#14 = eaAlfa;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         |SI #107#2 = "P";
             eaAlfa   = #997#15;  |HAZ QuitaRaros;
             #504#13  = eaAlfa;

             eaAlfa   = #997#16;  |HAZ QuitaRaros;
             #504#14  = eaAlfa;
         |SINO;
             nHayRepre = 0;
             |BUCLE agim0024;
             |SI nHayRepre = 0;
                 |BUCLE dsmom001;
                 |SI nHayRepre = 0;
                     eaAlfa  = #999#3;  |HAZ QuitaRaros;
                     #504#13 = eaAlfa;

                     eaAlfa  = "TITULAR";  |HAZ QuitaRaros;
                     #504#14 = eaAlfa;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     #504#16  = ("00000" + #999#0) % -105;
     #504#17 = &13 + &10;

     |SI nTecla ! 2;  |Y nTecla ! 5;
         |SI #0#6 = 2000;
             aAlfa = "";
             |PARA nCampo = 0;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
                   |SI nCampo ! 15;
                       aAlfa = #504nCampo;
                       |XGRABA nHandle3, aAlfa;
                   |SINO;
                       |SI nTecla = 4;
                           aAlfa = #504nCampo;
                           |XGRABA nHandle3, aAlfa;
                       |FINSI;
                   |FINSI;
             |SIGUE;
         |FINSI;

         |SI #0#6 = 2001;
             aAlfa = "";
             |PARA nCampo = 0;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
                   |SI nCampo ! 15;  |Y nCampo ! 16;
                       aAlfa = #504nCampo;
                       |XGRABA nHandle3, aAlfa;
                   |FINSI;
             |SIGUE;
         |FINSI;

         |SI #0#6 ] 2002;
             aAlfa = "";
             |PARA nCampo = 0;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
                   |SI nCampo ! 15;
                       aAlfa = #504nCampo;
                       |XGRABA nHandle3, aAlfa;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO RegistroAuxiliar2008;
     enCodCli = #347#0;
     |HAZ LeePersona;

     |DDEFECTO #504;

     #504#0  = "1";

     #504#1  = "347";

     #504#2  = #347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #504#3   = eaVarDni;

         #504#4   = ("00" + #715#15) % -102;

         #504#5   = ("000" + #715#16) % -103;

         #504#6   = #715#29;

         eaAlfa   = #715#30;  |HAZ QuitaRaros;
         #504#7   = eaAlfa;

         nNume    = #715#31;
         #504#8   = ("00000" + nNume) % -105;

         eaAlfa   = #715#37;  |HAZ QuitaRaros;
         #504#9   = eaAlfa;

         #504#10  = ("00" + #715#35) % -102;

         #504#11  = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #504#3   = eaVarDni;

         #504#4   = ("00" + #715#63) % -102;

         #504#5   = ("000" + #715#64) % -103;

         #504#6   = #715#3;

         eaAlfa   = #715#4;  |HAZ QuitaRaros;
         #504#7   = eaAlfa;

         nNume    = #715#5;
         #504#8   = ("00000" + nNume) % -105;

         #504#9   = #715#11;

         #504#10  = ("00" + #715#9) % -102;

         #504#11  = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
     |FINSI;

     #504#12  = (#0#7 % -104) + (#0#7 % 402) + (#0#7 % 102);

     |SI #107#1 = "S";
         |BUCLE agim0026;
     |SINO;
         nHayRepre = 0;
         |BUCLE agim0024;
         |SI nHayRepre = 0;
             |BUCLE dsmom001;
             |SI nHayRepre = 0;
                 |ABRE #1015;
                 #1015#0 = #347#0;
                 |LEE 000#1015=;
                 |SI FSalida ! 0; |DDEFECTO #1015; |FINSI;
                 |CIERRA #1015;
                 |SI #1015#0 =  "            ";
                     eaAlfa  = #999#3;  |HAZ QuitaRaros;
                     #504#13 = eaAlfa;

                     eaAlfa  = "TITULAR";  |HAZ QuitaRaros;
                     #504#14 = eaAlfa;
                 |SINO;
                     eaAlfa  = #1015#5;  |HAZ QuitaRaros;
                     #504#13 = eaAlfa;

                     eaAlfa  = #1015#7;  |HAZ QuitaRaros;
                     #504#14 = eaAlfa;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     #504#16  = ("00000" + #999#0) % -105;
     #504#17 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 0;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
           |SI nCampo ! 15; |Y nCampo ! 4; |Y nCampo ! 5; |Y nCampo ! 6;
            |Y nCampo ! 7;  |Y nCampo ! 8; |Y nCampo ! 9; |Y nCampo ! 10;
            |Y nCampo ! 11;
               aAlfa = #504nCampo;
               |XGRABA nHandle3, aAlfa;
            |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmo2347;
     #348#1;
     ;
     #347#0, #347#1, #347#2, #347#3, #347#4, #347#5, " ", "            ", " ", " ", " ", " ", " ";
     #347#0, #347#1, #347#2, #347#3, #347#4, #347#5, "z", "zzzzzzzzzzzz", "z", "z", "z", "z", "z";
     ;
     NULL, Registro2;
|FIN;

|DEFBUCLE dsmo3347;
     #351#1;
     ;
     #347#0, #347#1, #347#2, #347#3, #347#4, 00, 01;
     #347#0, #347#1, #347#2, #347#3, #347#4, 99, 99;
     ;
     NULL, Registro2I;
|FIN;

|DEFBUCLE dsmo2347_2008;
     #348#1;
     ;
     #347#0, #347#1, #347#2, #347#3, #347#4, #347#5, " ", "            ", " ", " ", " ", " ", " ";
     #347#0, #347#1, #347#2, #347#3, #347#4, #347#5, "z", "zzzzzzzzzzzz", "z", "z", "z", "z", "z";
     ;
     NULL, Registro2_2008;
|FIN;

|DEFBUCLE dsmo2347_2010;
     #348#1;
     ;
     #347#0, #347#1, #347#2, #347#3, #347#4, #347#5, " ", "            ", " ", " ", " ", " ", " ";
     #347#0, #347#1, #347#2, #347#3, #347#4, #347#5, "z", "zzzzzzzzzzzz", "z", "z", "z", "z", "z";
     ;
     NULL, Registro2_2010;
|FIN;

|DEFBUCLE dsmo3347_2008;
     #351#1;
     ;
     #347#0, #347#1, #347#2, #347#3, #347#4, 00, 01;
     #347#0, #347#1, #347#2, #347#3, #347#4, 99, 99;
     ;
     NULL, Registro2I_2008;
|FIN;

|PROCESO Lee3470;       || Calculo Total de Declarantes y Declarados
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #347;
     #347#0  = #999#0;
     #347#1  = #999#1;
     #347#2  = #999#2;
     #347#3  = #999#5;
     #347#4  = #999#7;
     #347#5  = 0;
     |LEE 040#347=;
     |SI FSalida = 0;
         #997#17 = #997#17 + 1;
         #997#18 = #997#18 + (#347#6 + #347#8 + #347#10 + #347#12 + #347#14 + #347#16 + #347#20 + #347#22);
     |FINSI;
     |CIERRA #347;
|FPRC;

|PROCESO Lee3471;        || Creacion de Ficheros
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #347;
     #347#0  = #999#0;
     #347#1  = #999#1;
     #347#2  = #999#2;
     #347#3  = #999#5;
     #347#4  = #999#7;
     #347#5  = 0;
     |LEE 040#347=;
     |SI FSalida = 0;
         |SI nTecla = 1;  |O nTecla = 3;
             aAbre = eaPathEmision + "OPA" + (("00000" + #999#0) % -105) + ".TXT";
             |XABRE "BW", aAbre, nHandle2;

             aAbre = eaPathEmision + "OPB" + (("00000" + #999#0) % -105) + ".TXT";
             |XABRE "BW", aAbre, nHandle3;
         |FINSI;

         |HAZ Registro1;

         |BUCLE dsmo2347;
         |BUCLE dsmo3347;

         |HAZ Registro1Auxiliar;

         |SI nTecla = 1;
             |XCIERRA nHandle2;
             |XCIERRA nHandle3;

             eaFOrigen  = eaPathEmision + "OPA" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza   + "OPA" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             eaFOrigen  = eaPathEmision + "OPB" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza   + "OPB" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             |SI #0#6 = 2000;
                 aAlfa = "wait pdf347 /E:OPA" + (("00000" + #999#0) % -105) + ".TXT ";
             |FINSI;

             |SI #0#6 ] 2001;
                 aAlfa = "wait 347pdf /E:OPA" + (("00000" + #999#0) % -105) + ".TXT ";
             |FINSI;

             aAlfa = aAlfa + "/R:OPC" + (("00000" + #999#0) % -105) + ".TXT ";
             aAlfa = aAlfa + "/I: ";
             aAlfa = aAlfa + "/C:" + aTercera + " ";
             aAlfa = aAlfa + "/F:FLAG.TXT ";
             aAlfa = aAlfa + "/A:OPB" + (("00000" + #999#0) % -105) + ".TXT ";

             |SI #0#6 = 2000;
                 |SI eaMoneda = "PESETAS";
                     aAlfa = aAlfa + "/M:P";
                 |SINO;
                     aAlfa = aAlfa + "/M:E";
                 |FINSI;
             |FINSI;
             aAlfa = aAlfa + &13 + &10;

             |XGRABA nHandle1, aAlfa;
         |FINSI;

         |SI nTecla = 3;  |Y #0#6 ] 2005;
             |XCIERRA nHandle2;
             |XCIERRA nHandle3;

             eaFOrigen  = eaPathEmision + "OPA" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza   + "OPA" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             eaFOrigen  = eaPathEmision + "OPB" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza   + "OPB" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             aAlfa = "wait VI347 /E:OPA" + (("00000" + #999#0) % -105) + ".TXT ";
             aAlfa = aAlfa + "/R:OPC" + (("00000" + #999#0) % -105) + ".TXT ";
             aAlfa = aAlfa + "/F:FLAG.TXT ";
             aAlfa = aAlfa + &13 + &10;

             |XGRABA nHandle1, aAlfa;
         |FINSI;
     |FINSI;
     |CIERRA #347;

     |SI nInternet = 1;
         |HAZ GrabaImpreso;
     |FINSI;

     |SI nTecla = 4;  |Y #0#6 ] 2005;
         |HAZ GrabaImpreso;
     |FINSI;
|FPRC;

|PROCESO Lee3471_2006;        || Creacion de Ficheros
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #347;
     #347#0  = #999#0;
     #347#1  = #999#1;
     #347#2  = #999#2;
     #347#3  = #999#5;
     #347#4  = #999#7;
     #347#5  = 0;
     |LEE 040#347=;
     |SI FSalida = 0;
         |SI nTecla ! 4;
             aAbre = eaPathEmision + "OPA" + (("00000" + #999#0) % -105) + ".TXT";
             |XABRE "BW", aAbre, nHandle2;

             aAbre = eaPathEmision + "OPB" + (("00000" + #999#0) % -105) + ".TXT";
             |XABRE "BW", aAbre, nHandle3;
         |FINSI;

         |HAZ Registro1;

         |BUCLE dsmo2347;
         |BUCLE dsmo3347;

         |HAZ Registro1Auxiliar;

         |SI nTecla ! 4;
             |XCIERRA nHandle2;
             |XCIERRA nHandle3;

             eaFOrigen  = eaPathEmision + "OPA" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza   + "OPA" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             eaFOrigen  = eaPathEmision + "OPB" + (("00000" + #999#0) % -105) + ".TXT";
             eaFDestino = eaPathLanza   + "OPB" + (("00000" + #999#0) % -105) + ".TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;
         |FINSI;

         eaTipoE =  "OPA" + (("00000" + #999#0) % -105) + ".TXT";
         eaTipoR =  "OPC" + (("00000" + #999#0) % -105) + ".TXT";
         eaTipoP =  "PDF" + (("00000" + #999#0) % -105) + ".PDF";

         |SI nTecla = 1;
             eaTipoC =  aTercera;
             eaTipoA =  "OPB" + (("00000" + #999#0) % -105) + ".TXT";
             eaTipoV =  "N";
         |SINO;
             eaTipoV =  "S";
         |FINSI;

         |SI nTecla ! 4;
             |HAZ LineaShellJava;
             |HAZ GrabaImpreso;
         |FINSI;

         |SI nTecla = 4;  |HAZ GrabaImpreso;   |FINSI;
     |FINSI;
     |CIERRA #347;
|FPRC;

|PROCESO Lee3471_2008;        || Creacion de Ficheros
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     enEmpresa = #999#0;
     enEjer    = #999#1;
     enPeriodo = #999#2;
     enModelo  = #999#5;
     enComplem = #999#7;
     enTipoEntrada = 92;
     |SUB_EJECUTA_NP "dsmo1347";

     |ABRE #347;
     #347#0  = #999#0;
     #347#1  = #999#1;
     #347#2  = #999#2;
     #347#3  = #999#5;
     #347#4  = #999#7;
     #347#5  = 0;
     |LEE 040#347=;
     |SI FSalida = 0;
         aAbre = eaPathEmision + "OPA" + (("00000" + #999#0) % -105) + ".TXT";
         |XABRE "BW", aAbre, nHandle2;

         aAbre = eaPathEmision + "OPB" + (("00000" + #999#0) % -105) + ".TXT";
         |XABRE "BW", aAbre, nHandle3;

         |SI #0#6 ] 2011;
             |HAZ Registro1_2011;
             |BUCLE dsmo2347_2011;
         |FINSI;

         |SI #0#6 = 2010;
             |HAZ Registro1_2008;
             |BUCLE dsmo2347_2010;
         |FINSI;

         |SI #0#6 [ 2009;
             |HAZ Registro1_2008;
             |BUCLE dsmo2347_2008;
         |FINSI;

         |BUCLE dsmo3347_2008;

         |HAZ RegistroAuxiliar2008;

         |XCIERRA nHandle2;
         |XCIERRA nHandle3;

         eaFOrigen  = eaPathEmision + "OPA" + (("00000" + #999#0) % -105) + ".TXT";
         eaFDestino = eaPathLanza   + "OPA" + (("00000" + #999#0) % -105) + ".TXT";
         |HAZ CopiaFichero;

         |FBORRA eaFOrigen;

         eaFOrigen  = eaPathEmision + "OPB" + (("00000" + #999#0) % -105) + ".TXT";
         eaFDestino = eaPathLanza   + "OPB" + (("00000" + #999#0) % -105) + ".TXT";
         |HAZ CopiaFichero;

         |FBORRA eaFOrigen;
     |FINSI;

     eaTipoE =  "OPA" + (("00000" + #999#0) % -105) + ".TXT";
     eaTipoR =  "OPC" + (("00000" + #999#0) % -105) + ".TXT";
     eaTipoP =  "PDF" + (("00000" + #999#0) % -105) + ".PDF";

     |SI nTecla = 1;
         eaTipoC =  aTercera;
         eaTipoA =  "OPB" + (("00000" + #999#0) % -105) + ".TXT";
         eaTipoV =  "N";
     |SINO;
         eaTipoV =  "S";
     |FINSI;

     |HAZ LineaShellJava;
     |HAZ GrabaImpreso;

     |CIERRA #347;
|FPRC;

|PROCESO Lee347P;       || Emision Papel
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #347;
     #347#0  = #999#0;
     #347#1  = #999#1;
     #347#2  = #999#2;
     #347#3  = #999#5;
     #347#4  = #999#7;
     #347#5  = 0;
     |LEE 040#347=;
     |SI FSalida = 0;
         |SI nTecla = 5;
             |SI #0#6 < 2008;
                 |HAZ Registro1;
                 |HAZ Registro1Auxiliar;
                 enSwImpre = 1;  |BUCLE dsmo2347;
                 enSwImpre = 2;  |BUCLE dsmo3347;
             |SINO;
                 |SI #0#6 ] 2011;
                     |HAZ Registro1_2011;
                     |HAZ RegistroAuxiliar2008;
                     enSwImpre = 1;  |BUCLE dsmo2347_2011;
                 |FINSI;

                 |SI #0#6 = 2010;
                     |HAZ Registro1_2008;
                     |HAZ RegistroAuxiliar2008;
                     enSwImpre = 1;  |BUCLE dsmo2347_2010;
                 |FINSI;

                 |SI #0#6 [ 2009;
                     |HAZ Registro1_2008;
                     |HAZ RegistroAuxiliar2008;
                     enSwImpre = 1;  |BUCLE dsmo2347_2008;
                 |FINSI;

                 enSwImpre = 2;  |BUCLE dsmo3347_2008;
             |FINSI;
             |PIEINF;
             |CIERRA #347;
             |ACABA;
         |FINSI;

         nHojas   = #347#6 + #347#8 + #347#10 + #347#12 + #347#14 + #347#20 + #347#22;
         enTHojas = (((nHojas / 5) + .49) ! 0);
         nHojas   = (((#347#16 / 5) + .49) ! 0);
         enTHojas = enTHojas + nHojas;

         |SI nTeclaPapel = 1;
             |HAZ Registro1;
             |HAZ Registro1Auxiliar;

             eaAlfa = #0#7;    |HAZ FechaBonito;

             |PRINT;
             |PIEINF;

             |HAZ GrabaImpreso;
         |FINSI;

         |SI nTeclaPapel = 2;
             nContador = 0;
             enNHojas  = 1;
             nSwPrint  = 0;
             |BUCLE dsmo2347;
             |SI nSwPrint = 1;  |PIEINF;  |FINSI;
         |FINSI;

         |SI nTeclaPapel = 3;
             nContador = 0;
             enNHojas  = (enTHojas - (((#347#16 / 5) + .49) ! 0)) + 1;
             nSwPrint  = 0;
             |BUCLE dsmo3347;
             |SI nSwPrint = 1;  |PIEINF;  |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #347;
|FPRC;

|PROCESO QueHacemos347;
     |SI nTeclaPapel ! 0;  |O nTecla = 5;   || En Papel Continuo
         |HAZ Lee347P;
         |ACABA;
     |FINSI;

     |SI nSwLee = 1;        || Lectura para Colectivos para Totales Hoja
         |HAZ Lee3470;
         |ACABA;
     |FINSI;

     |SI #0#6 [ 2005;   |HAZ Lee3471;       |FINSI;
     |SI #0#6 = 2006;   |HAZ Lee3471_2006;  |FINSI;
     |SI #0#6 = 2007;   |HAZ Lee3471_2006;  |FINSI;
     |SI #0#6 ] 2008;   |HAZ Lee3471_2008;  |FINSI;
|FPRC;

|DEFBUCLE dsmow014C347;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos347;
|FIN;

|DEFBUCLE dsmow014N347;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos347;
|FIN;

|PROCESO Boton3471;
     |PTEC 824;
|FPRC;

|PROCESO Boton3472;
     |PTEC 825;
|FPRC;

|PROCESO Boton3473;
     |PTEC 826;
|FPRC;

|PROCESO Boton3474;
     |PTEC 827;
|FPRC;

|PROCESO Boton3475;
     |PTEC 828;
|FPRC;

|PROCESO Boton3476;
     |PTEC 829;
|FPRC;

|PROCESO Boton347Esc;
     |PTEC 806;
|FPRC;

|PROCESO AbreImprime347;
     |SI #0#6 = 2000;
         aAbre = eaPathLanza + "imprime.bat";
         |XABRE "CBW", aAbre, nHandle1;

         aAlfa = "CD " + eaPathLanza + &13 + &10;    |XGRABA nHandle1, aAlfa;
         |SI nTecla = 1;
             aAlfa = "ZLS00347.EXE -y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
         |SINO;
             aAlfa = "COPY OPA" + #0#6 + " A:" + &13 + &10;    |XGRABA nHandle1, aAlfa;
             aAlfa = "COPY AUXILIAR.TXT" + " A:" + &13 + &10; |XGRABA nHandle1, aAlfa;
             aAlfa = "ZPR00347.EXE -Y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
             aAlfa = "WAIT VSU347.EXE" + &13 + &10;  |XGRABA nHandle1, aAlfa;
         |FINSI;

         |ACABA;
     |FINSI;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "CD " + eaPathLanza + &13 + &10;    |XGRABA nHandle1, aAlfa;

     |SI nTecla = 1;
         aAlfa = "ZLS" + aAnyo + "347.EXE -y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
     |SINO;
         aAlfa = "ZPR" + aAnyo + "347.EXE -Y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
     |FINSI;
|FPRC;

|PROCESO ImpEtiqueta347;
     |SI nTecla = 3;
         #998#0  = "Delegacion .........: " + #504#4 + #504#5;
         #998#1  = "Ejercicio ..........: " + #504#2;
         #998#2  = "Modelo .............: 347";
         #998#3  = "Numero Justificante : ";
         #998#4  = "N.I.F. .............: " + #501#3;
         #998#5  = "Nombre : " + #501#4;
         #998#6  = #504#6 + " " + #504#7 + " " + #504#8 + " " + #504#11 + " " + #504#9;
         #998#7  = "P.Cont.: " + #501#7;
         #998#8  = "Telefono ...........: " + #501#6;
         #998#9  = "Numero total Registros ..: " + nTRegistro;
         #998#10 = "Densidad soporte : 1,44 MB en Diskettes de 3 1/2";
         #998#11 = "";
         #998#12 = "";
         |C_M #998#11, 1, "N";
         |C_M #998#12, 1, "N";
     |SINO;
         #998#0  = "Delegacion .........: " + (("00" + #997#11) % -102) + (("000" + #997#12) % -103);
         #998#1  = "Ejercicio ..........: " + #500#2;
         #998#2  = "Modelo .............: 347";
         #998#3  = "Numero Justificante : ";
         #998#4  = "N.I.F. .............: " + #500#3;
         #998#5  = "Nombre : " + #500#4;
         #998#6  = #500#5 + " " + #500#6 + " " + #500#7 + " " + #500#11 + " " + #500#12;
         #998#7  = "P.Cont.: " + #500#18;
         #998#8  = "Telefono ...........: " + #500#17;
         #998#9  = "Numero total Registros ..: " + nTRegistro;
         #998#10 = "Densidad soporte : 1,44 MB en Diskettes de 3 1/2";
         #998#11 = "";
         #998#12 = "";
         |C_M #998#11, 1, "S";
         |C_M #998#12, 1, "S";
         #998#11 = "Numero total Declarantes : " + #997#17;
         #998#12 = "Numero total Declarados .: " + #997#18;
     |FINSI;

     |PINPA #0#998;
     |PINDA #0#998;
     |ENDATOS #1#998;
     |SI FSalida = 0;
         |PINPA #0#998;
         |PINDA #0#998;

         |CONFI "2400SRealizar Impresion de la Etiqueta : ";
         |SI FSalida ! 0; |ACABA; |FINSI;

         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |INFOR "dsmow015";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

         |PRINT; |PIEINF; |FININF; |FINIMP;
     |FINSI;
|FPRC;

|PROCESO EmiteEsto2000;
     |SI nTecla = 1;
         aAlfa =  eaPathLanza + "IMPRIME";
         |RSYSTEM aAlfa;
         eaFichError = "opc";
         eaFichDatos = "opa";
         eaFichAuxil = "opb";

         |HAZ BuscaErroresL;
     |SINO;
         |SI nInternet = 1;  |ACABA;  |FINSI;

         |ATRI I;
         |PINTA 0715, "Introduzca un Diskette Formateado en D.O.S. en su PC,";
         |PINTA 0815, "y pulse en el Boton de Iniciar Copia.                ";
         |ATRI i;

         |CONTROL_SIMPLE 0, " BOTON, INICIAR COPIA ", 1130, 1245, Boton3471;
         nBoton1 = FSalida;

         |CONTROL_SIMPLE 0, " BOTON,   CANCELAR    ", 1430, 1545, Boton3472;
         nBoton2 = FSalida;

         |PARA; |SI;  |HACIENDO;
                |LEETECLA aTecla;
                |SI aTecla = aF2;  |SAL;  |FINSI;
                |SI aTecla = aF3;  |SAL;  |FINSI;
         |SIGUE;

         |FIN_CONTROL_WINDOWS nBoton1;
         |FIN_CONTROL_WINDOWS nBoton2;

         |PULSATECLA;

         |SI aTecla = aF3;  |ACABA;  |FINSI;

         aAlfa =  eaPathLanza + "IMPRIME";
         |RSYSTEM aAlfa;

         |HAZ BuscaErroresS;

         |SI enError = 0;
             |PINTA 0715, "                                                     ";
             |PINTA 0815, "                                                     ";

             |CONTROL_SIMPLE 0, " BOTON,EMITIR LA ETIQUETA", 1130, 1250, Boton3471;
             nBoton1 = FSalida;

             |CONTROL_SIMPLE 0, " BOTON,CANCELAR      ", 1430, 1545, Boton3472;
             nBoton2 = FSalida;

             |PARA; |SI;  |HACIENDO;
                    |LEETECLA aTecla;
                    |SI aTecla = aF2;  |SAL;  |FINSI;
                    |SI aTecla = aF3;  |SAL;  |FINSI;
             |SIGUE;

             |FIN_CONTROL_WINDOWS nBoton1;
             |FIN_CONTROL_WINDOWS nBoton2;

             |PULSATECLA;

             |SI aTecla = aF3;  |ACABA;  |FINSI;

             |HAZ ImpEtiqueta347;
         |SINO;
             |MENAV "      Ha habido Errores, arreglelos y vuelva a emitir.";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO EmiteEsto2001;
     |SI nTecla = 1;
         aAlfa =  eaPathLanza + "IMPRIME";
         |RSYSTEM aAlfa;
         eaFichError = "opc";
         eaFichDatos = "opa";
         eaFichAuxil = "opb";
         enInternet  = 0;

         |HAZ BuscaErroresL;
     |FINSI;

     |SI #0#6 ] 2005;
         |SI nTecla = 3;
             aAlfa =  eaPathLanza + "IMPRIME";
              |RSYSTEM aAlfa;
              eaFichError = "opc";
              eaFichDatos = "opa";
              eaFichAuxil = "opb";
              enInternet  = 1;

              |HAZ BuscaErroresL;
         |FINSI;

         |SI nTecla = 4;
             |HAZ BuscaErroresL;
         |FINSI;
     |FINSI;

     |SI #0#6 [ 2004;
         |SI nTecla ! 1;
             aAlfa =  eaPathLanza + "IMPRIME";
             |RSYSTEM aAlfa;
             eaFichError = "opc";
             eaFichDatos = "opa" + #0#6;
             eaFichAuxil = "AUXILIAR.TXT";

             |HAZ BuscaErroresL;

             |SI enError ! 0;
                 |MENAV "      Ha habido Errores, arreglelos y vuelva a emitir.";
                 |ACABA;
             |FINSI;

             |ATRI I;
             |PINTA 0715, "Introduzca un Diskette Formateado en D.O.S. en su PC,";
             |PINTA 0815, "y pulse en el Boton de Iniciar Copia.                ";
             |ATRI i;

             |CONTROL_SIMPLE 0, " BOTON, INICIAR COPIA ", 1130, 1245, Boton3471;
             nBoton1 = FSalida;

             |CONTROL_SIMPLE 0, " BOTON,   CANCELAR    ", 1430, 1545, Boton3472;
             nBoton2 = FSalida;

             |PARA; |SI;  |HACIENDO;
                    |LEETECLA aTecla;
                    |SI aTecla = aF2;  |SAL;  |FINSI;
                    |SI aTecla = aF3;  |SAL;  |FINSI;
             |SIGUE;

             |FIN_CONTROL_WINDOWS nBoton1;
             |FIN_CONTROL_WINDOWS nBoton2;

             |PULSATECLA;

             |SI aTecla = aF3;  |ACABA;  |FINSI;

             aAbre = eaPathLanza + "imprime.bat";
             |XABRE "CBW", aAbre, nHandle1;

             aAlfa = "CD " + eaPathLanza + &13 + &10;    |XGRABA nHandle1, aAlfa;
             aAlfa = "COPY OPA" + #0#6 + " A:OP" + #0#6 + &13 + &10;    |XGRABA nHandle1, aAlfa;
             aAlfa = "COPY AUXILIAR.TXT" + " A:" + &13 + &10; |XGRABA nHandle1, aAlfa;
             aAlfa = "DEL OPA" + #0#6 + &13 + &10;    |XGRABA nHandle1, aAlfa;
             aAlfa = "DEL AUXILIAR.TXT" + &13 + &10; |XGRABA nHandle1, aAlfa;

             |XCIERRA nHandle1;

             aAlfa = eaPathLanza + "IMPRIME";
             |RSYSTEM aAlfa;

             |RFBORRA aAbre;

             |SI enError = 0;
                 |PINTA 0715, "                                                     ";
                 |PINTA 0815, "                                                     ";

                 |CONTROL_SIMPLE 0, " BOTON,EMITIR LA ETIQUETA", 1130, 1250, Boton3471;
                 nBoton1 = FSalida;

                 |CONTROL_SIMPLE 0, " BOTON,CANCELAR      ", 1430, 1545, Boton3472;
                 nBoton2 = FSalida;

                 |PARA; |SI;  |HACIENDO;
                        |LEETECLA aTecla;
                        |SI aTecla = aF2;  |SAL;  |FINSI;
                        |SI aTecla = aF3;  |SAL;  |FINSI;
                 |SIGUE;

                 |FIN_CONTROL_WINDOWS nBoton1;
                 |FIN_CONTROL_WINDOWS nBoton2;

                 |PULSATECLA;

                 |SI aTecla = aF3;  |ACABA;  |FINSI;

                 |HAZ ImpEtiqueta347;
             |SINO;
                 |MENAV "      Ha habido Errores, arreglelos y vuelva a emitir.";
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO EmiteEsto;
     aAlfa = "DEL *.DLL" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL DELEG.TXT"     + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL PAISES.TXT"    + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL PROVINCI.TXT"  + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL SIGLAS.TXT"    + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL SIGLA347.TXT"    + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL ADMON.TXT"     + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL *.EXE"         + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     |XCIERRA nHandle1;

     |DBASS aModelos;  |QBT aModelos;
     aModelos = aModelos + "basica/";
     |SI nTecla = 1;
         eaFOrigen  = aModelos + "patrones/zls" + aAnyo + "347.exe";
         eaFDestino = eaPathLanza + "zls" + aAnyo + "347.exe";
         |HAZ CopiaFichero;
     |SINO;
         eaFOrigen  = aModelos + "patrones/zpr" + aAnyo + "347.exe";
         eaFDestino = eaPathLanza + "zpr" + aAnyo + "347.exe";
         |HAZ CopiaFichero;
     |FINSI;

     |SI #0#6 = 2000;
         |HAZ EmiteEsto2000;
     |FINSI;

     |SI #0#6 ] 2001;
         |HAZ EmiteEsto2001;
     |FINSI;
|FPRC;


|PROCESO PapelContinuo;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI nTeclaPapel = 0;
         |SI #0#6 ] 2011;
             |CONFI "    SImprimir Detalle de Importes por Trimestre";
             |SI FSalida = 0;
                 |MENAV "0000 Recuerde seleccionar el papel de la impresora en Horizontal";
                 |INFOR "m347co05";
             |SINO;
                 |INFOR "m347co04";
             |FINSI;
         |FINSI;

         |SI #0#6 = 2010;
             |INFOR "m347co03";
         |FINSI;

         |SI #0#6 [ 2009;
             |SI #0#6 ] 2008;
                 |INFOR "m347co02";
             |SINO;
                 |INFOR "m347co01";
             |FINSI;
         |FINSI;
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI nTeclaPapel = 1;
         |INFOR "m347ch01";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI nTeclaPapel = 2;
         |INFOR "m347ch02";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI nTeclaPapel = 3;
         |INFOR "m347ch03";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#8 = "C";
         |BUCLE dsmow014C347;
     |SINO;
         |BUCLE dsmow014N347;
     |FINSI;

     |FININF;
     |FINIMP;
|FPRC;

|PROCESO PapelOficial;
     |SI nTecla = 5;
         nTeclaPapel = 0;
         |HAZ PapelContinuo;
         |ACABA;
     |FINSI;

     |CONTROL_SIMPLE 0, "LBOTON,F2 Emision Portada                       ", 0623, 0864, Boton3471;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3 Emision Hojas Relacion de Declarados  ", 1023, 1264, Boton3472;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F4 Emision Hojas Inmuebles               ", 1423, 1664, Boton3473;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Salir   ", 2265, 2278, Boton3475;
     nBoton4 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTeclaPapel = 1;  |HAZ PapelContinuo;   |FINSI;
         |SI aTecla = aF3;  nTeclaPapel = 2;  |HAZ PapelContinuo;   |FINSI;
         |SI aTecla = aF4;  nTeclaPapel = 3;  |HAZ PapelContinuo;   |FINSI;
         |SI aTecla = aF5;  nTeclaPapel = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;

     |PULSATECLA;
|FPRC;

|PROCESO Botones347;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision Papel Oficial Laser          ", 0513, 0754, Boton3471;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Emision Papel Oficial Continuo       ", 0913, 1154, Boton3472;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Emision Soporte Magnetico o Internet Individual ", 1313, 1554, Boton3473;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Emision Soporte Magnetico o Internet Colectivo  ", 1713, 1954, Boton3474;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F6> Informe de Comprobacion              ", 2113, 2354, Boton3475;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton347Esc;
     nBoton6 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "828";
     aF7 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTecla = 1;   |SAL;  |FINSI;
         |SI aTecla = aF3;  nTecla = 2;   |SAL;  |FINSI;
         |SI aTecla = aF4;
             |SI enSwHay = 1;
                 nTecla = 3;
                 |SAL;
             |SINO;
                 |MENAV "      Se debera seleccionar una unica Empresa.";
             |FINSI;
         |FINSI;
         |SI aTecla = aF5;  nTecla = 4;   |SAL;  |FINSI;
         |SI aTecla = aF6;
             nTecla = 5;
             |HAZ PapelOficial;
         |FINSI;
         |SI aTecla = aF7;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;

     |PULSATECLA;
|FPRC;

|PROCESO BotonSoporte;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision en Diskette                  ", 0513, 0754, Boton3471;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Emision en Internet                  ", 0913, 1154, Boton3472;
     nBoton2 = FSalida;

     nInternet = 0;
     aF2 = &255 + "824";
     aF3 = &255 + "825";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;                  |SAL;  |FINSI;
         |SI aTecla = aF3;  nInternet = 1;  |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;

     |PULSATECLA;
|FPRC;

|PROCESO ComoEl2004;
     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |SI eaParametro ! "347C";
         |HAZ Botones347;
     |SINO;
         nTecla = 5;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1;  |ACABA;  |FINSI;
     |SI nTecla = 5;  enInfComp = 1;  |FINSI;

     |SI nTecla = 2;  |O nTecla = 5;
         |HAZ PapelOficial;
         |ACABA;
     |FINSI;

     |SI nTecla = 1;
         |SI #107#6 = "S";
             aTercera = "N";
             aAlfa    = "0000" + #107#5 + "Desea la impresion de la tercera copia  ";
             |CONFI aAlfa;
             |SI FSalida = 0;  aTercera = "S";  |FINSI;
         |SINO;
             aTercera = #107#5;
         |FINSI;
     |FINSI;

     nInternet = 0;
     |SI nTecla = 3;  |O nTecla = 4;
         |HAZ BotonSoporte;
     |FINSI;

     |SI nInternet = 0;
         |HAZ AbreImprime347;
     |FINSI;

     |SI nTecla = 3;  |O nTecla = 4;
         |SI nInternet = 0;
             aAbre = eaPathEmision + "OPA" + #0#6;
             |XABRE "BW", aAbre, nHandle2;

             aAbre = eaPathEmision + "AUXILIAR.TXT";
             |XABRE "BW", aAbre, nHandle3;
         |SINO;
             |SI nTecla = 3;
                 |ABRE #999;
                 nEmpresa = 0;
                 |LEE 000#999p;
                 |PARA;  |SI FSalida = 0;;  |HACIENDO;
                      |SI #999#6 = "S";
                          nEmpresa = #999#0;
                          |SAL;
                      |FINSI;
                      |LEE 000#999s;
                 |SIGUE;
                 |CIERRA #999;
             |FINSI;

             |SI nTecla = 3;
                 aAbre = eaPathEmision + "OPA" + (("00000" + nEmpresa) % -105);
             |SINO;
                 aAbre = eaPathEmision + "OPA" + #0#6;
             |FINSI;
             |XABRE "BW", aAbre, nHandle2;

             |SI nTecla = 3;
                 aAbre = eaPathEmision + "OPX" + (("00000" + nEmpresa) % -105);
             |SINO;
                 aAbre = eaPathEmision + "OPX" + #0#6;
             |FINSI;
             |XABRE "BW", aAbre, nHandle2;
         |FINSI;
     |FINSI;

     |SI nTecla = 4;
         nSwLee = 1;
         |BUCLE dsmow014C347;

         |PUSHV 0501 2380;
         |PINPA #0#997;
         |PINDA #0#997;
         |C_M #997#19, 1, "N";
         |C_V #997#19, 1, "N";
         |ENDATOS #1#997;
         |POPV;

         |HAZ Registro0;
         |HAZ Registro0Auxiliar;
     |FINSI;

     nSwLee = 0;
     |SI #0#8 = "C";
         |BUCLE dsmow014C347;
     |SINO;
         |BUCLE dsmow014N347;
     |FINSI;

     |SI nTecla = 3;  |O nTecla = 4;
         |SI nInternet = 0;
             |SI #0#6 ] 2001;
                 |SI #107#6 = "S";
                     aTercera = "N";
                     aAlfa    = "0000" + #107#5 + "Desea la impresion de la tercera copia  ";
                     |CONFI aAlfa;
                     |SI FSalida = 0;  aTercera = "S";  |FINSI;
                 |SINO;
                     aTercera = #107#5;
                 |FINSI;

                 aAlfa = "wait vs347 /E:OPA" + #0#6;
                 aAlfa = aAlfa + " /R:OPC" + #0#6 + ".TXT ";
                 aAlfa = aAlfa + "/I: ";
                 aAlfa = aAlfa + "/C:" + aTercera + " ";
                 aAlfa = aAlfa + "/F:FLAG.TXT ";
                 aAlfa = aAlfa + "/A:AUXILIAR.TXT";
                 aAlfa = aAlfa + &13 + &10;
                 |XGRABA nHandle1, aAlfa;
             |FINSI;
         |FINSI;

         |XCIERRA nHandle2;
         |XCIERRA nHandle3;

         |SI nInternet = 0;
             eaFOrigen  = eaPathEmision + "OPA" + #0#6;
             eaFDestino = eaPathLanza   + "OPA" + #0#6;
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;

             eaFOrigen  = eaPathEmision + "AUXILIAR.TXT";
             eaFDestino = eaPathLanza   + "AUXILIAR.TXT";
             |HAZ CopiaFichero;

             |FBORRA eaFOrigen;
         |SINO;
             |SI nTecla = 3;
                 eaFOrigen  = eaPathEmision  + "OPA" + (("00000" + nEmpresa) % -105);
                 eaFDestino = eaPathInternet + "OPA" + (("00000" + nEmpresa) % -105);
                 |HAZ CopiaFichero;

                 |FBORRA eaFOrigen;

                 eaFOrigen  = eaPathEmision  + "OPX" + (("00000" + nEmpresa) % -105);
                 eaFDestino = eaPathInternet + "OPX" + (("00000" + nEmpresa) % -105);
                 |HAZ CopiaFichero;
                 |FBORRA eaFOrigen;
             |SINO;
                 eaFOrigen  = eaPathEmision  + "OPA" + #0#6;
                 eaFDestino = eaPathInternet + "OPA" + #0#6;
                 |HAZ CopiaFichero;

                 |FBORRA eaFOrigen;

                 eaFOrigen  = eaPathEmision  + "OPX" + #0#6;
                 eaFDestino = eaPathInternet + "OPX" + #0#6;
                 |HAZ CopiaFichero;

                 |FBORRA eaFOrigen;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nInternet = 0;
         |HAZ EmiteEsto;
     |SINO;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Botones347_2005;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision Papel Oficial Laser          ", 0513, 0754, Boton3471;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Emision Papel Oficial Continuo       ", 0913, 1154, Boton3472;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Internet Individual ", 1313, 1554, Boton3473;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Internet Colectivo  ", 1713, 1954, Boton3474;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F6> Informe de Comprobacion              ", 2113, 2354, Boton3475;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton347Esc;
     nBoton6 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "828";
     aF7 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTecla = 1;   |SAL;  |FINSI;
         |SI aTecla = aF3;  nTecla = 2;   |SAL;  |FINSI;
         |SI aTecla = aF4;  nTecla = 3;   |SAL;  |FINSI;
         |SI aTecla = aF5;  nTecla = 4;   |SAL;  |FINSI;
         |SI aTecla = aF6;
             nTecla = 5;
             |HAZ PapelOficial;
         |FINSI;
         |SI aTecla = aF7;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;

     |PULSATECLA;
|FPRC;

|PROCESO Botones347_2006;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision Papel Oficial Laser (Directo por impresora) ", 0513, 0654, Boton3471;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Emision Papel Oficial Laser (Vista previa por el Acrobat) ", 0813, 0954, Boton3472;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Presentacion Telematica Individual (Con validacion)", 1113, 1254, Boton3473;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Presentacion Telematica Colectiva (Sin validacion)", 1413, 1554, Boton3474;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F6> Informe de Comprobacion              ", 1713, 1854, Boton3475;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F7> Directorio Acrobat  ", 2013, 2154, Boton3476;
     nBoton6 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton347Esc;
     nBoton7 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "828";
     aF7 = &255 + "829";
     aF8 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;

         |SI aTecla = aF2;  nTecla = 1; eaModoImpre = "I";    |SAL;  |FINSI;
         |SI aTecla = aF3;  nTecla = 1; eaModoImpre = "P";    |SAL;  |FINSI;
         |SI aTecla = aF4;  nTecla = 3;                       |SAL;  |FINSI;
         |SI aTecla = aF5;  nTecla = 4;                       |SAL;  |FINSI;
         |SI aTecla = aF6;  nTecla = 5;                       |SAL;  |FINSI;
         |SI aTecla = aF7;  |HAZ Acrobat;                            |FINSI;
         |SI aTecla = aF8;  nTecla = 0;                       |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |FIN_CONTROL_WINDOWS nBoton7;

     |PULSATECLA;
|FPRC;

|PROCESO Botones347_2008;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision Papel Oficial Laser (Directo por impresora) ", 0813, 0954, Boton3471;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Emision Papel Oficial Laser (Vista previa por el Acrobat) ", 1113, 1254, Boton3472;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Presentacion Telematica Individual (Con validacion)", 1413, 1554, Boton3473;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Informe de Comprobacion              ", 1713, 1854, Boton3474;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F6> Directorio Acrobat  ", 2013, 2154, Boton3475;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton347Esc;
     nBoton6 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "828";
     aF8 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;

         |SI aTecla = aF2;  nTecla = 1; eaModoImpre = "I";    |SAL;  |FINSI;
         |SI aTecla = aF3;  nTecla = 1; eaModoImpre = "P";    |SAL;  |FINSI;
         |SI aTecla = aF4;  nTecla = 3;                       |SAL;  |FINSI;
         |SI aTecla = aF5;  nTecla = 5;                       |SAL;  |FINSI;
         |SI aTecla = aF6;  |HAZ Acrobat;                            |FINSI;
         |SI aTecla = aF8;  nTecla = 0;                       |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;

     |PULSATECLA;
|FPRC;

|PROCESO ComoEl2005;
     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |SI eaParametro ! "347C";
         |HAZ Botones347_2005;
     |SINO;
         nTecla = 5;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1;  |ACABA;  |FINSI;
     |SI nTecla = 5;  enInfComp = 1;  |FINSI;

     |SI nTecla = 2;  |O nTecla = 5;
         |HAZ PapelOficial;
         |ACABA;
     |FINSI;

     |SI nTecla = 1;
         |SI #107#6 = "S";
             aTercera = "N";
             aAlfa    = "0000" + #107#5 + "Desea la impresion de la tercera copia  ";
             |CONFI aAlfa;
             |SI FSalida = 0;  aTercera = "S";  |FINSI;
         |SINO;
             aTercera = #107#5;
         |FINSI;
     |FINSI;

     |SI nTecla = 4;
         |MENAV "0000 Hacienda no proporciona validacion de soporte colectivo.";
         |MENAV "0000 Para asegurarse de los datos emitirlos primero individualmente";
         |CONFI "0000NDesea continuar";
         |SI FSalida ! 0;  |ACABA;  |FINSI;
     |FINSI;

     |HAZ AbreImprime347;

     |SI nTecla = 4;
         aAbre = eaPathEmision + "OPA" + #0#6 + ".TXT";
         |XABRE "BW", aAbre, nHandle2;

         aAbre = eaPathEmision + "AUXILIAR.TXT";
         |XABRE "BW", aAbre, nHandle3;

         nSwLee = 1;
         |BUCLE dsmow014C347;

         |PUSHV 0501 2380;
         |PINPA #0#997;
         |PINDA #0#997;
         |C_M #997#19, 1, "N";
         |C_V #997#19, 1, "N";
         |ENDATOS #1#997;
         |POPV;

         |HAZ Registro0;
         |HAZ Registro0Auxiliar;
     |FINSI;

     nSwLee = 0;
     |SI #0#8 = "C";
         |BUCLE dsmow014C347;
     |SINO;
         |BUCLE dsmow014N347;
     |FINSI;

     |SI nTecla = 4;
         |XCIERRA nHandle2;
         |XCIERRA nHandle3;

          eaFOrigen  = eaPathEmision  + "OPA" + #0#6 + ".TXT";
          eaFDestino = eaPathInternet + "OPA" + #0#6 + ".TXT";
          |HAZ CopiaFichero;

          |FBORRA eaFOrigen;

          eaFOrigen  = eaPathEmision  + "AUXILIAR.TXT";
          |FBORRA eaFOrigen;

          |HAZ BorraDirectorio;
     |SINO;
         |HAZ EmiteEsto;
     |FINSI;

     |SI nTecla = 3;  |O nTecla = 4;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO ComoEl2006;
     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |SI eaParametro ! "347C";
         |HAZ Botones347_2006;
     |SINO;
         nTecla = 5;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1;  |ACABA;  |FINSI;
     |SI nTecla = 5;  enInfComp = 1;  |FINSI;

     |SI nTecla = 5;
         |HAZ PapelOficial;
         |ACABA;
     |FINSI;

     enInternet = 1;

     |SI nTecla = 1;
         |SI #107#6 = "S";
             aTercera = "N";
             aAlfa    = "0000" + #107#5 + "Desea la impresion de la tercera copia  ";
             |CONFI aAlfa;
             |SI FSalida = 0;  aTercera = "S";  |FINSI;
         |SINO;
             aTercera = #107#5;
         |FINSI;

         enInternet = 0;
     |FINSI;

     |SI nTecla = 4;
         |MENAV "0000 Hacienda no proporciona validacion de soporte colectivo.";
         |MENAV "0000 Para asegurarse de los datos emitirlos primero individualmente";
         |CONFI "0000NDesea continuar";
         |SI FSalida ! 0;  |ACABA;  |FINSI;
         enInternet = 2;

         aAbre = eaPathEmision + "OPA" + #0#6 + ".TXT";
         |XABRE "BW", aAbre, nHandle2;

         aAbre = eaPathEmision + "AUXILIAR.TXT";
         |XABRE "BW", aAbre, nHandle3;

         nSwLee = 1;
         |BUCLE dsmow014C347;

         |PUSHV 0501 2380;
         |PINPA #0#997;
         |PINDA #0#997;
         |C_M #997#19, 1, "N";
         |C_V #997#19, 1, "N";
         |ENDATOS #1#997;
         |POPV;

         |HAZ Registro0;
         |HAZ Registro0Auxiliar;
     |FINSI;

     nSwLee = 0;
     |SI #0#8 = "C";
         |BUCLE dsmow014C347;
     |SINO;
         |BUCLE dsmow014N347;
     |FINSI;

     |SI nTecla = 4;
         |XCIERRA nHandle2;
         |XCIERRA nHandle3;

         eaFOrigen  = eaPathEmision  + "OPA" + #0#6 + ".TXT";
         eaFDestino = eaPathInternet + "OPA" + #0#6 + ".TXT";
         |HAZ CopiaFichero;

         |FBORRA eaFOrigen;

         eaFOrigen  = eaPathEmision + "AUXILIAR.TXT";
         |FBORRA eaFOrigen;
     |SINO;
                          enInternet  = 0;
         |SI nTecla ! 1;  enInternet  = 1;  |FINSI;

         eaFichError = "opc";
         eaFichDatos = "opa";
         eaFichAuxil = "opb";

         |HAZ BuscaErroresL;
     |FINSI;

     |HAZ BorraDirectorio;

     |SI nTecla = 3;  |O nTecla = 4;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO ComoEl2008;
     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |SI eaParametro ! "347C";
         |HAZ Botones347_2008;
     |SINO;
         nTecla = 5;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1;  |ACABA;  |FINSI;
     |SI nTecla = 5;  enInfComp = 1;  |FINSI;

/*
     |SI #0#6 = 2011; |Y nTecla ! 5;
         |MENAV "    No disponible la Emision del Modelo 347 - Ejercicio 2011";
         |ACABA;
     |FINSI;
*/

     |SI nTecla = 5;
         |HAZ PapelOficial;
         |ACABA;
     |FINSI;

     enInternet = 1;

     |SI nTecla = 1;
         |SI #107#6 = "S";
             aTercera = "N";
             aAlfa    = "0000" + #107#5 + "Desea la impresion de la tercera copia  ";
             |CONFI aAlfa;
             |SI FSalida = 0;  aTercera = "S";  |FINSI;
         |SINO;
             aTercera = #107#5;
         |FINSI;

         enInternet = 0;
     |FINSI;

     nSwLee = 0;
     |SI #0#8 = "C";
         |BUCLE dsmow014C347;
     |SINO;
         |BUCLE dsmow014N347;
     |FINSI;

                      enInternet  = 0;
     |SI nTecla ! 1;  enInternet  = 1;  |FINSI;

     eaFichError = "opc";
     eaFichDatos = "opa";
     eaFichAuxil = "opb";

     |HAZ BuscaErroresL;

     |HAZ BorraDirectorio;

     |SI nTecla = 3;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Portal347_2012;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;


     enEmpresa = #999#0;
     enEjer    = #999#1;
     enPeriodo = #999#2;
     enModelo  = #999#5;
     enComplem = #999#7;
     enTipoEntrada = 92;
     |SUB_EJECUTA_NP "dsmo1347";

     |ABRE #347;
     #347#0  = #999#0;
     #347#1  = #999#1;
     #347#2  = #999#2;
     #347#3  = #999#5;
     #347#4  = #999#7;
     #347#5  = 0;
     |LEE 040#347=;
     |SI FSalida ! 0;  |CIERRA #347;  |ACABA;  |FINSI;
     |CIERRA #347;

     eaFicheroPlano = "347" + (("00000" + #999#0) % -105) + ".txt";
     eaFicheroImpre = "347" + (("00000" + #999#0) % -105) + ".imp";
     eaFicheroSalid = "347" + (("00000" + #999#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #999#0) % -105) + ".txt";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Registro1_2011;
     |BUCLE dsmo2347_2011;
     |BUCLE dsmo3347_2008;

     |XCIERRA nHandle2;

     enEmpresa    = #dsmow014#0;
     enComple     = #dsmow014#7;
     eaNomEmpresa = #dsmow014#3;

     |HAZ PresentaPortal;
|FPRC;

|DEFBUCLE dsmow014C347_2012;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, Portal347_2012;
|FIN;

|DEFBUCLE dsmow014N347_2012;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, Portal347_2012;
|FIN;

|PROCESO ComoEl2012;
     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |HAZ BtnAnuales2012;

     |ABRE #4;
     |ABRE #347;
     |SI #0#8 = "C";
         |BUCLE dsmow014C347_2012;
     |SINO;
         |BUCLE dsmow014N347_2012;
     |FINSI;
     |CIERRA #4;
     |CIERRA #347;

     |SI eaOpcion = "3";
         |HAZ SacaErrorPtl;

         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO moy34701;
     aAnyo    = #0#6;
     aAnyo    = aAnyo % -102;
     enModelo = 347;

     |SI #0#6 [ 2004;  |HAZ ComoEl2004;  |FINSI;
     |SI #0#6 = 2005;  |HAZ ComoEl2005;  |FINSI;
     |SI #0#6 = 2006;  |HAZ ComoEl2006;  |FINSI;
     |SI #0#6 = 2007;  |HAZ ComoEl2006;  |FINSI;

     |SI #0#6 ] 2008;  |Y  #0#6 [ 2011;
         |HAZ ComoEl2008;
     |FINSI;

     |SI #0#6 ] 2012;
         |SI eaParametro = "347C";
             |HAZ ComoEl2008;
             |ACABA;
         |FINSI;

         |HAZ ComoEl2012;
     |FINSI;
|FPRC;
