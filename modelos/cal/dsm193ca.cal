|FICHEROS;
     dsmom004;
     dsmom038;

     dsm193ca #193;
     dsm193li #2;
     dsm193ga;

     &regisnif@;

     ds193ca@ #194;
     ds193li@;
     ds193ga@;
|FIN;

|VARIABLES;
     nSwChequea1 = 0;
     nSwChequea2 = 0;
     nSwComplem  = 0;
     nSw         = 0;
     nBorra      = 0;
     nComp       = 0;
     nSuma       = 0;
     nBoton1     = 0;
     nBoton2     = 0;
     nBoton3     = -1;

     nPara1      = 0;
     nPara2      = 0;
     nPara3      = 0;
     nOpera      = 0;
     aBase       = "";
     aMas        = "";
     aAlfa       = "";
     aTecla      = "";
|FIN;

|INCLUYE i_variar;

|RUTINA ClaveBaja2;
     #dsm193li#0  = #dsm193ca#0;
     #dsm193li#1  = #dsm193ca#1;
     #dsm193li#2  = #dsm193ca#2;
     #dsm193li#3  = #dsm193ca#3;
     #dsm193li#4  = #dsm193ca#4;
     #dsm193li#5  = #dsm193ca#5;
     #dsm193li#6  = "            ";
     #dsm193li#7  = 0000;
     #dsm193li#8  = " ";
     #dsm193li#9  = "  ";
     #dsm193li#10 = 1;
|FRUT;

|RUTINA ClaveAlta2;
     #dsm193li#0  = #dsm193ca#0;
     #dsm193li#1  = #dsm193ca#1;
     #dsm193li#2  = #dsm193ca#2;
     #dsm193li#3  = #dsm193ca#3;
     #dsm193li#4  = #dsm193ca#4;
     #dsm193li#5  = #dsm193ca#5;
     #dsm193li#6  = "zzzzzzzzzzzz";
     #dsm193li#7  = 9999;
     #dsm193li#8  = "z";
     #dsm193li#9  = "zz";
     #dsm193li#10 = 2;
|FRUT;

|RUTINA ClaveBaja3;
     #dsm193ga#0  = #dsm193ca#0;
     #dsm193ga#1  = #dsm193ca#1;
     #dsm193ga#2  = #dsm193ca#2;
     #dsm193ga#3  = #dsm193ca#3;
     #dsm193ga#4  = #dsm193ca#4;
     #dsm193ga#5  = #dsm193ca#5;
     #dsm193ga#6  = "            ";
|FRUT;

|RUTINA ClaveAlta3;
     #dsm193ga#0  = #dsm193ca#0;
     #dsm193ga#1  = #dsm193ca#1;
     #dsm193ga#2  = #dsm193ca#2;
     #dsm193ga#3  = #dsm193ca#3;
     #dsm193ga#4  = #dsm193ca#4;
     #dsm193ga#5  = #dsm193ca#5;
     #dsm193ga#6  = "zzzzzzzzzzzz";
|FRUT;

|PROCESO Version2015;
     |BLANCO 1627 2279;
     |CUADRO 1627 2380;

     |ATRI R;
     |PINTA 1728, "Imp.Percepciones";
     |PINTA 1745, "% Multiplicador";
     |PINTA 1761, "Importe Reducciones";

     |PINTA 1928, "Base Ret.Ing.Cta.";
     |PINTA 1946, "% Reten";
     |PINTA 1954, "Ret.Ing.Cta.";
     |PINTA 1967, "Ret.Ingresada";

     |PINTA 2128, "Ingresos Ejer.Ant.por Periodificacion ";
     |PINTA 2167, "Ret.Ingresada";

     |ATRI 0;

     |C_M #dsm193li#33, 1, "N";
     |C_V #dsm193li#33, 1, "N";

     |C_M #dsm193li#20, 1, "S";
     |C_V #dsm193li#20, 1, "S";
     |C_P #dsm193li#20, 1, 1831;

     |C_M #dsm193li#21, 1, "S";
     |C_V #dsm193li#21, 1, "S";
     |C_P #dsm193li#21, 1, 1851;

     |C_M #dsm193li#22, 1, "S";
     |C_V #dsm193li#22, 1, "S";
     |C_P #dsm193li#22, 1, 1863;

     |C_M #dsm193li#23, 1, "S";
     |C_V #dsm193li#23, 1, "S";
     |C_P #dsm193li#23, 1, 2031;

     |C_M #dsm193li#24, 1, "S";
     |C_V #dsm193li#24, 1, "S";
     |C_P #dsm193li#24, 1, 2047;

     |C_M #dsm193li#25, 1, "S";
     |C_V #dsm193li#25, 1, "S";
     |C_P #dsm193li#25, 1, 2055;

     |C_M #dsm193li#26, 1, "S";
     |C_V #dsm193li#26, 1, "S";
     |C_P #dsm193li#26, 1, 2069;

     |C_M #dsm193li#27, 1, "S";
     |C_V #dsm193li#27, 1, "S";
     |C_P #dsm193li#27, 1, 2241;

     |C_M #dsm193li#28, 1, "S";
     |C_V #dsm193li#28, 1, "S";
     |C_P #dsm193li#28, 1, 2269;
|FPRC;

|PROCESO Version2016;
     |C_M #dsm193li#21, 1, "N";
     |C_V #dsm193li#21, 1, "N";

     |C_M #dsm193li#27, 1, "N";
     |C_V #dsm193li#27, 1, "N";

     |C_M #dsm193li#28, 1, "N";
     |C_V #dsm193li#28, 1, "N";
|FPRC;

|PROCESO Boton1;
     |PUSHV 0501 2380;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "HIDE";  |FINSI;

     |ABRE #dsmom038;
     |LEE 040#dsmom038.p;
     |SI FSalida ! 0;
         eaExtension = "mod";
         eaPrograma  = "dsmom038";
         |SUB_EJECUTA_NP ":basica/dspatron";
     |FINSI;
     |CIERRA #dsmom038;

     |ABRE #dsmom038;
     #dsmom038#0 = "C";
     #dsmom038#1 = "14";
     |LEE 000#dsmom038.=;
     |SI FSalida ! 0;
         |MENAV "0000 Hay una nueva clave IRPF, se va a proceder a instalar el fichero";

         |CIERRA #dsmom038;
         eaExtension = "mod";
         eaPrograma  = "dsmom038";
         |SUB_EJECUTA_NP ":basica/dspatron";

         |ABRE #dsmom038;
         #dsmom038#0 = "C";
         #dsmom038#1 = "14";
         |LEE 000#dsmom038.=;
         |SI FSalida = 0;
             |MENAV "0000 El fichero se ha instalado satisfactoriamente.";
         |SINO;
             |MENAV "0000 El fichero no se ha instalado, por favor instale la aplicacion ipbasica";
         |FINSI;
     |FINSI;
     |CIERRA #dsmom038;

     |PINPA #0#dsm193li;

     |SI #dsm193ca#1 [ 2015;
         |HAZ Version2015;
     |FINSI;

     |SI #dsm193ca#1 ] 2016;
         |HAZ Version2016;
     |FINSI;

     |SI enTipoEntrada = 4;
         |ENTLINEAL #1#dsm193li, -7, 4, 22, 0, ClaveBaja2, ClaveAlta2;
     |SINO;
         |ENTLINEAL #1#dsm193li, -7, 2, 22, 0, ClaveBaja2, ClaveAlta2;
     |FINSI;

     |PULSATECLA;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "SHOW";  |FINSI;
     |POPV;

     |PINTA #dsm193ca#6;
     |PINTA #dsm193ca#7;
     |PINTA #dsm193ca#8;
     |PINTA #dsm193ca#9;
     |PINTA #dsm193ca#10;
     |PINTA #dsm193ca#11;
     |PINTA #dsm193ca#12;
|FPRC;

|PROCESO Boton2;
     |SI #dsm193ca#15 = "S";
         |MENAV "0000No procede introducir Gastos";
         |ACABA;
     |FINSI;

     |PUSHV 0501 2380;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "HIDE";  |FINSI;

     |PINPA #0#dsm193ga;

     |SI enTipoEntrada = 4;
         |ENTLINEAL #1#dsm193ga, -7, 4, 22, 0, ClaveBaja3, ClaveAlta3;
     |SINO;
         |ENTLINEAL #1#dsm193ga, -7, 2, 22, 0, ClaveBaja3, ClaveAlta3;
     |FINSI;

     |PULSATECLA;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "SHOW";  |FINSI;
     |POPV;

     |PINTA #dsm193ca#6;
     |PINTA #dsm193ca#7;
     |PINTA #dsm193ca#8;
     |PINTA #dsm193ca#9;
     |PINTA #dsm193ca#10;
     |PINTA #dsm193ca#11;
     |PINTA #dsm193ca#12;
|FPRC;

|PROCESO EnOtraAnterior;
     nSw = 1;
|FPRC;

|DEFBUCLE EnOtraGastos;
     #ds193ga@#1007;
     ;
     #dsm193ga#0, #dsm193ga#1, #dsm193ga#2, #dsm193ga#3, nPara2, #dsm193ga#5, #dsm193ga#6;
     #dsm193ga#0, #dsm193ga#1, #dsm193ga#2, #dsm193ga#3, nPara3, #dsm193ga#5, #dsm193ga#6;
     e;
     NULL, EnOtraAnterior;
|FIN;

|DEFBUCLE EnOtraLinea;
     #ds193li@#1011;
     ;
     #2#0, #2#1, #2#2, #2#3, nPara2, #2#5, #2#6, #2#7, #2#8, #2#9, #2#10;
     #2#0, #2#1, #2#2, #2#3, nPara3, #2#5, #2#6, #2#7, #2#8, #2#9, #2#10;
     e;
     NULL, EnOtraAnterior;
|FIN;

|PROCESO RecalculaLi;
     |SI nSwComplem = 1;
         nSw = 0;
         |BUCLE EnOtraLinea;
         |SI nSw = 1;
             |BORRA 020#dsm193li.a;
         |FINSI;
         |LIBERA #dsm193li;
         |ACABA;
     |FINSI;

     |SI nBorra = 1;
         |BORRA 020#dsm193li.a;
         |LIBERA #dsm193li;
         |ACABA;
     |FINSI;

     |SI nSwChequea1 = 0;
         nSwChequea1 = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |HAZ Tipo2m193li;

     |GRABA 020#dsm193li.a;
     |LIBERA #dsm193li;
|FPRC;

|DEFBUCLE dsm193li;
     #dsm193li#1;
     ;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,"            ",0000," ","  ", 0;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,"zzzzzzzzzzzz",9999,"z","zz", 3;
     be;
     NULL, RecalculaLi;
|FIN;

|PROCESO RecalculaGa;
     |SI nSwComplem = 1;
         nSw = 0;
         |BUCLE EnOtraGastos;
         |SI nSw = 1;
             |BORRA 020#dsm193ga.a;
         |FINSI;
         |LIBERA #dsm193ga;
         |ACABA;
     |FINSI;

     |SI nBorra = 1;
         |BORRA 020#dsm193ga.a;
         |LIBERA #dsm193ga;
         |ACABA;
     |FINSI;

     |SI nSwChequea2 = 0;
         nSwChequea2 = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |HAZ Tipo2m193ga;
     |LIBERA #dsm193ga;
|FPRC;

|DEFBUCLE dsm193ga;
     #dsm193ga#1;
     ;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,"            ";
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,"zzzzzzzzzzzz";
     be;
     NULL, RecalculaGa;
|FIN;

|PROCESO Recalculo;
     nSwChequea1 = 0;  |BUCLE dsm193li;
     nSwChequea2 = 0;  |BUCLE dsm193ga;

     |SI nSwChequea1 = 0;  |Y nSwChequea2 = 0;
         |ACABA;
     |FINSI;

     #dsm193ca#6  = 0;
     #dsm193ca#7  = 0;
     #dsm193ca#8  = 0;
     #dsm193ca#9  = 0;
     #dsm193ca#10 = 0;
     #dsm193ca#11 = 0;
     #dsm193ca#12 = 0;

     |BUCLE dsm193li;
     |BUCLE dsm193ga;

     |SI #dsm193ca#15 = "S";
         #dsm193ca#9  = 0;
         #dsm193ca#12 = 0;
         nBorra = 1;  |BUCLE dsm193ga;
         nBorra = 0;
     |FINSI;
|FPRC;

|PROCESO BRepComplem;

      |DBASE aBase;  |QBF aBase;
      aMas = aBase + "def/dsm193li.mas";
      |CARGA_DEF aMas, ds193li@;
      |SI FSalida ! 0;  |ACABA;  |FINSI;

      aMas = aBase + "def/dsm193ga.mas";
      |CARGA_DEF aMas, ds193ga@;
      |SI FSalida ! 0;
          |DESCARGA_DEF #ds193li@;
          |ACABA;
      |FINSI;

      aMas = aBase + "def/dsm193ca.mas";
      |CARGA_DEF aMas, ds193ca@;
      |SI FSalida ! 0;
          |DESCARGA_DEF #ds193ga@;
          |DESCARGA_DEF #ds193li@;
          |ACABA;
      |FINSI;

      |ABRE #ds193ca@;
      nPara2 = 0;
      nPara3 = 0;
      nPara1 = #dsm193ca#4 - 1;
      |PARA nComp = 0; |SI nComp [ nPara1; |HACIENDO nComp = nComp + 1;
            #ds193ca@#0 = #dsm193ca#0;
            #ds193ca@#1 = #dsm193ca#1;
            #ds193ca@#2 = #dsm193ca#2;
            #ds193ca@#3 = #dsm193ca#3;
            #ds193ca@#4 = nComp;
            |LEE 041#ds193ca@.=;
            |SI FSalida = 0;
                |SI #ds193ca@#4 = 0; |O #ds193ca@#14 = "S";
                    nPara2 = nComp;
                |FINSI;
                nPara3 = nComp;
            |FINSI;
       |SIGUE;
       |CIERRA #ds193ca@;
       |DESCARGA_DEF #ds193ca@;

       nSwComplem = 1;  |BUCLE dsm193li;
                        |BUCLE dsm193ga;
       nSwComplem = 0;

       |DESCARGA_DEF #ds193ga@;
       |DESCARGA_DEF #ds193li@;
|FPRC;

|PROCESO Traedsm193li;
     #dsm193li#4 = #dsm193ca#4;
     |GRABA 020#dsm193li.n;
     |LIBERA #dsm193li;
|FPRC;

|DEFBUCLE dsm193liT;
     #dsm193li#1;
     ;
     #193#0,#193#1,#193#2,#193#3,nComp,#193#5,"            ",0000," ","  ",0;
     #193#0,#193#1,#193#2,#193#3,nComp,#193#5,"zzzzzzzzzzzz",9999,"z","zz",2;
     be;
     NULL, Traedsm193li;
|FIN;

|PROCESO Traedsm193ga;
     #dsm193ga#4 = #dsm193ca#4;
     |GRABA 020#dsm193ga.n;
     |LIBERA #dsm193ga;
|FPRC;

|DEFBUCLE dsm193gaT;
     #dsm193ga#1;
     ;
     #193#0,#193#1,#193#2,#193#3,nComp,#193#5,"            ";
     #193#0,#193#1,#193#2,#193#3,nComp,#193#5,"zzzzzzzzzzzz";
     be;
     NULL, Traedsm193ga;
|FIN;

|PROCESO Justificante;
     |SI #dsm193ca#4 = 0;  |ACABA;  |FINSI;

     |SI #dsm193ca#14 ! "C";  |Y #dsm193ca#14 ! "S";
         |MENAV "      Introduzca Complementaria o Sustitutoria";
         |ERROR;
     |FINSI;

     |C_M #dsm193ca#13, 1, "N";
     |SI #dsm193ca#14 = "S"; |O #dsm193ca#14 = "C";
         |C_M #dsm193ca#13, 1, "S";

         |SI #dsm193ca#13 = "             ";
             |ABRE #dsmom004;
             #dsmom004#0 = #dsm193ca#0;
             #dsmom004#1 = #dsm193ca#1;
             #dsmom004#2 = #dsm193ca#2;
             #dsmom004#3 = #dsm193ca#3;
             #dsmom004#4 = #dsm193ca#4 - 1;
             |LEE 000#dsmom004.=;
             |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;
             |CIERRA #dsmom004;

             #dsm193ca#13 = #dsmom004#25;  |PINTA #dsm193ca#13;
         |FINSI;
     |SINO;
         #dsm193ca#13 = "";  |PINTA #dsm193ca#13;
     |FINSI;

     |SI #dsm193ca#14 = "S";
         nSuma = 0;
         nSuma = #dsm193ca#6 + #dsm193ca#7 + #dsm193ca#8 + #dsm193ca#9 + #dsm193ca#10 + #dsm193ca#11 + #dsm193ca#12;

         |SI nSuma = 0;
             |DBASE aBase;  |QBF aBase;
             aMas = aBase + "def/dsm193ca.mas";
             |CARGA_DEF aMas, ds193ca@;
             |SI FSalida ! 0;  |ACABA;  |FINSI;

             |ABRE #ds193ca@;

             nPara1 = #dsm193ca#4 - 1;
             |PARA nComp = 0; |SI nComp [ nPara1; |HACIENDO nComp = nComp + 1;

                   #ds193ca@#0 = #dsm193ca#0;
                   #ds193ca@#1 = #dsm193ca#1;
                   #ds193ca@#2 = #dsm193ca#2;
                   #ds193ca@#3 = #dsm193ca#3;
                   #ds193ca@#4 = nComp;
                   |LEE 041#ds193ca@.=;
                   |SI FSalida = 0;
                       |SI #ds193ca@#4 = 0; |O #ds193ca@#14 = "S";
                           nBorra = 1;  |BUCLE dsm193li;
                           nBorra = 1;  |BUCLE dsm193ga;
                           nBorra = 0;
                       |FINSI;

                       |BUCLE dsm193liT;
                       |BUCLE dsm193gaT;
                   |FINSI;
             |SIGUE;
             |CIERRA #ds193ca@;

             |DESCARGA_DEF #ds193ca@;

             |HAZ Recalculo;

             |HAZ LaPantalla;
             |PINDA #0#dsm193ca;
             |HAZ PintaDatos;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo0Natu; |TIPO 0;
   aAlfa = Contenido;
   |SI aAlfa ! #dsm193ca#Campo#;
       |HAZ Recalculo;
       |PINDA #0#dsm193ca;
   |FINSI;
|FPRC;

|PROCESO Boton3;
     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton3, "DISABLE";

     |HAZ Recalculo;
     |PINTA #dsm193ca#6;
     |PINTA #dsm193ca#7;
     |PINTA #dsm193ca#8;
     |PINTA #dsm193ca#9;
     |PINTA #dsm193ca#10;
     |PINTA #dsm193ca#11;
     |PINTA #dsm193ca#12;

     |ESTADO_CONTROL nBoton1, "ENABLE";
     |ESTADO_CONTROL nBoton2, "ENABLE";
     |ESTADO_CONTROL nBoton3, "ENABLE";
|FPRC;

|PROCESO Tipo12moc1193;  |TIPO 12;
|FPRC;

|PROCESO dsmom004;
     enIngresado = enIngresado + #dsmom004#15;
|FPRC;

|DEFBUCLE dsmom004;
     #dsmom004#1;
     ;
     enEmpresa, enEjer, 00, 123, 00;
     enEmpresa, enEjer, 99, 123, 99;
     ;
     NULL, dsmom004;
|FIN;

|PROCESO dsm193ca;
     |SI #dsm193ca#14 = "S";
         enInformado = #dsm193ca#8;
     |SINO;
         enInformado = enInformado + #dsm193ca#8;
     |FINSI;
|FPRC;

|DEFBUCLE dsm193ca;
     #dsm193ca#1;
     ;
     enEmpresa, enEjer, 99, 193, 00, 00;
     enEmpresa, enEjer, 99, 193, 99, 99;
     ;
     NULL, dsm193ca;
|FIN;

|PROCESO Chequeo;
     enIngresado = 0;
     |BUCLE dsmom004;
     enIngresado = enIngresado ! 2;
     enInformado = #dsm193ca#8 ! 2;

     |SI #dsm193ca#4 ! 0;  |Y #dsm193ca#14 = "C";
         enInformado = 0;
         |BUCLE dsm193ca;
         enInformado = enInformado ! 2;
     |FINSI;

     |SI enInformado ! enIngresado;
         aAlfa = "0000Total retenciones del modelo 193: " + enInformado;
         aAlfa = aAlfa + " no coinciden con lo declarado en el modelo 123: " + enIngresado;
         |MENAV aAlfa;
         |MENAV "0000Revise los datos";
     |FINSI;
|FPRC;

|PROCESO VerComplem;
  |SI #dsm193ca#4 > 0;
      |ABRE #dsmom004;
      #dsmom004#0 = #dsm193ca#0;
      #dsmom004#1 = #dsm193ca#1;
      #dsmom004#2 = #dsm193ca#2;
      #dsmom004#3 = #dsm193ca#3;
      #dsmom004#4 = #dsm193ca#4;
      |LEE 101#dsmom004.=;
      |SI FSalida = 0;
          |SI nOpera = 0;
              #dsm193ca#14 = #dsmom004#24;
              #dsm193ca#13  = #dsmom004#21;
          |SINO;
              #dsmom004#24 = #dsm193ca#14;
              #dsmom004#21 = #dsm193ca#13;
              |GRABA 020#dsmom004.a;
          |FINSI;
      |FINSI;
      |LIBERA #dsmom004;
      |CIERRA #dsmom004;
   |FINSI;
|FPRC;

|PROCESO LaPantalla;
     |PINPA #0#dsm193ca;
     |SI enEjer ] 2018; |Y enComplem > 0;
         |CUADRO 1746 2379;
         |ATRI P;
         |PINTA 1847,                        "Las complementarias solo recogen";
         |PINTA 1947,                        "registros no declarados  previa-";
         |PINTA 2047,                        "mente. Si ha modificado importes";
         |PINTA 2147,                        "de  algun  registro  anterior,";
         |PINTA 2247,                        "mejor presentar una sustitutiva ";
         |ATRI 0;
     |FINSI;
|FPRC;

|PROGRAMA;
     |HAZ LeeEURODBMOD;

     eaNomDef    = "dsm193ca";
     enResultado = 0;

|| \\\\\\ Alta del Modelo ////////

     |SI enTipoEntrada = 1;              || Consulta del Modelo
         |CABEZA "Modelo 193";
         |ABRE #dsm193ca;
         #dsm193ca#0 = enEmpresa;
         #dsm193ca#1 = enEjer;
         #dsm193ca#2 = enPeriodo;
         #dsm193ca#3 = enModelo;
         #dsm193ca#4 = enComplem;
         #dsm193ca#5 = enActividad;
         |LEE 040#dsm193ca.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsm193ca;
             #dsm193ca#0 = enEmpresa;
             #dsm193ca#1 = enEjer;
             #dsm193ca#2 = enPeriodo;
             #dsm193ca#3 = enModelo;
             #dsm193ca#4 = enComplem;
             #dsm193ca#5 = enActividad;
             nOpera = 0; |HAZ VerComplem;
             |GRABA 020#dsm193ca.b;
         |FINSI;

         |HAZ LaPantalla;
         |PINDA #0#dsm193ca;
         |HAZ PintaDatos;

         |CONTROL_SIMPLE 0, "BOTON,  Entrada Perceptores  ", 0855, 0979, Boton1;
         nBoton1 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,  Entrada Gastos  ", 1155, 1279, Boton2;
         nBoton2 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,  Recalculo Perceptores ", 1455, 1679, Boton3;
         nBoton3 = FSalida;

         |C_M #dsm193ca#14, 1, "N";
         |SI #dsm193ca#4 ! 0;
             |SI enEjer < 2018;
                 |C_M #dsm193ca#14, 1, "S";
             |FINSI;
         |FINSI;

         |ENDATOS #1#dsm193ca;

         |LEETECLA aTecla;

         |FIN_CONTROL_WINDOWS nBoton1;
         |FIN_CONTROL_WINDOWS nBoton2;
         |FIN_CONTROL_WINDOWS nBoton3;

         |PULSATECLA;

         nSuma = #dsm193ca#6  + #dsm193ca#7  + #dsm193ca#8 + #dsm193ca#9 + #dsm193ca#10 + #dsm193ca#11 + #dsm193ca#12;

         |SI nSuma = 0;
             |CONFI "0000NNo hay perceptores introducidos, quiere emitirlo sin actividad";
             |SI FSalida ! 0;
                 |BORRA 020#dsm193ca.a;
                 enEntrada = 0;
             |SINO;
                 |GRABA 020#dsm193ca.a;
                 enEntrada = 1;
                 nOpera = 1; |HAZ VerComplem;
             |FINSI;
         |SINO;
             |GRABA 020#dsm193ca.a;
             enEntrada = 1;
             nOpera = 1; |HAZ VerComplem;
         |FINSI;
         |LIBERA #dsm193ca;
         |CIERRA #dsm193ca;

         |HAZ Chequeo;

         |ACABA;
     |FINSI;

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
         |CABEZA "Modelo 193";
         |ABRE #dsm193ca;
         #dsm193ca#0 = enEmpresa;
         #dsm193ca#1 = enEjer;
         #dsm193ca#2 = enPeriodo;
         #dsm193ca#3 = enModelo;
         #dsm193ca#4 = enComplem;
         #dsm193ca#5 = enActividad;
         |LEE 040#dsm193ca.=;
         |SI FSalida ! 0;
             |MENAV "      No existe Registro.";
             |CIERRA #dsm193ca;
             |ACABA;
         |FINSI;

         |HAZ LaPantalla;
         |PINDA #0#dsm193ca;
         |HAZ PintaDatos;

         |CONTROL_SIMPLE 0, "BOTON,  Entrada Perceptores  ", 0855, 0979, Boton1;
         nBoton1 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,  Entrada Gastos  ", 1155, 1279, Boton2;
         nBoton2 = FSalida;

         |LEETECLA aTecla;

         |FIN_CONTROL_WINDOWS nBoton1;
         |FIN_CONTROL_WINDOWS nBoton2;
         |PULSATECLA;

         |CIERRA #dsm193ca;

         |HAZ Chequeo;

         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              || Baja del Modelo
         |ABRE #dsm193ca;
         #dsm193ca#0 = enEmpresa;
         #dsm193ca#1 = enEjer;
         #dsm193ca#2 = enPeriodo;
         #dsm193ca#3 = enModelo;
         #dsm193ca#4 = enComplem;
         #dsm193ca#5 = enActividad;
         |LEE 040#dsm193ca.=;
         |SI FSalida ! 0;
             |SI enMensa = 0;
                 |MENAV "      No existe Registro.";
             |FINSI;
             |CIERRA #dsm193ca;
             |ACABA;
         |FINSI;

         nBorra = 1;  |BUCLE dsm193li;
         nBorra = 1;  |BUCLE dsm193ga;
         nBorra = 0;

         |BORRA 020#dsm193ca.a;
         |LIBERA #dsm193ca;

         |CIERRA #dsm193ca;

         |ACABA;
     |FINSI;

|| \\\\\\ Alta desde el Pase del Modelo

     |SI enTipoEntrada = 98;
         |ABRE #dsm193ca;
         #dsm193ca#0 = enEmpresa;
         #dsm193ca#1 = enEjer;
         #dsm193ca#2 = enPeriodo;
         #dsm193ca#3 = enModelo;
         #dsm193ca#4 = enComplem;
         #dsm193ca#5 = enActividad;
         |LEE 040#dsm193ca.=;
         |SI FSalida ! 0;
             #dsm193ca#0  = enEmpresa;
             #dsm193ca#1  = enEjer;
             #dsm193ca#2  = enPeriodo;
             #dsm193ca#3  = enModelo;
             #dsm193ca#4  = enComplem;
             #dsm193ca#5  = enActividad;
             #dsm193ca#15 = "S";
             nOpera = 0; |HAZ VerComplem;
             |GRABA 020#dsm193ca.b;
         |FINSI;

         |SI #dsm193ca#4 > 0; |Y #dsm193ca#14 = "C"; |Y enEjer ] 2018;
             |HAZ BRepComplem;
         |FINSI;

         |HAZ Recalculo;
         |GRABA 020#dsm193ca.a;

         |LIBERA #dsm193ca;
         |CIERRA #dsm193ca;

         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #dsm193ca;
         #dsm193ca#0 = enEmpresa;
         #dsm193ca#1 = enEjer;
         #dsm193ca#2 = enPeriodo;
         #dsm193ca#3 = enModelo;
         #dsm193ca#4 = enComplem;
         #dsm193ca#5 = enActividad;
         |LEE 040#dsm193ca.=;
         |SI FSalida ! 0;  enExistencia = 1;  |FINSI;
         |CIERRA #dsm193ca;

         |SI enActividad = 0;  enResultado = 0;  |FINSI;
     |FINSI;
|FPRO;
