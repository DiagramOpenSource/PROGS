|FICHEROS;
     dsmozpas #0;
     dsmom004 #4;
     dsmom008 #8;
     dsmom107 #7;

     dsmom041 #41;
     dsmom049 #49;

     dsmom087 #87;

     dsmom030 #30;
     dsmom069;
     dsmom095 #95;
     dsmoc322 #300;
     dsmo3402 #342;
     dsmo3403 #343;
     dsmo3404 #344;
     dsmoc349 #349;

     dsmom065 #65;

     :/contagen/def/canempre #101;
     :/contagen/def/camaniva #102;
     :/contagen/def/caivalin #103;
     :/contagen/def/caivaasi #104;
     :/contagen/def/caivam03 #105;
     :/contagen/def/caclipro #106;
     :/contagen/def/calibros #107;
     :/contagen/def/camacc01 #501;
     :/contagen/def/camacc02 #502;
     :/contagen/def/camacc03 #503;
     :/contagen/def/camaasil;
     :/contagen/def/camanefe;
     :/contagen/def/caerpnif;

     :/basica/def/agicen17;
     :/basica/def/agicen14 #214;

     &regisnif@ #709;

     dsmow013 #999;
     dsmow204 #913;
     dsmow135 #935;

     espejo1@ #1300;
     espejo2@ #1387;
|FIN;

|VARIABLES;
     aAlfa1         = "";
     aAlfa2         = "";
     aAlfa          = "";
     aPathModelo    = "";
     aDef           = "";
     aTipo          = "";
     aFichero       = "";
     aClaveOp       = "";
     aNombre        = "";
     aPais          = "";
     aNifAnt        = "";
     aDesConexion349 = "";
     aDFecha         = "";
     aHFecha         = "";
     aSimbolo        = "";

     nEjer          = 0;
     nDPeriodo      = 0;
     nHPeriodo      = 0;
     nDComplem      = 0;
     nHComplem      = 0;
     nCampo         = 0;
     nCampo1        = 0;
     nCampo11       = 0;
     nCampo2        = 0;
     nCampo22       = 0;
     nCampo3        = 0;
     nCampo33       = 0;
     nSwEsta        = 0;
     nGrupo         = 0;
     nSubGrupo      = 0;
     nDepar         = 0;
     nBaseImpo      = 0;
     nPorce         = 0;
     nCuota         = 0;
     nPeriodo       = 0;
     nModelo        = 0;
     nSwPasa        = 0;
     nSwPasaCab     = 0;
     nCompensado    = 0;
     nCompensar     = 0;
     nCompen87      = 0;
     nModBucle      = 0;
     nAnyo          = 0;
     nEl340         = 0;
     nReg           = 0;
     nChequeaNif    = 0;
     nIntra         = 0;
     aEspecial      = "";
     aTriangul      = "";
     nBClaveR       = 0;
     nCClaveR       = 0;
     nBClaveA       = 0;
     nCClaveA       = 0;
     nBClaveI       = 0;
     nCClaveI       = 0;
     nBClaveE       = 0;
     nCClaveE       = 0;
     nBClaveS       = 0;
     nCClaveS       = 0;
     nBClaveA349    = 0;
     nBClaveI349    = 0;
     nBClaveE349    = 0;
     nBClaveS349    = 0;
     nPerIntra1     = 0;
     nPerIntra2     = 0;
     nPerIntra3     = 0;
     nPerIntra4     = 0;
     nPerIntra5     = 0;
     nPerIntra6     = 0;
     nPerIntra7     = 0;
     nPerIntra8     = 0;
     nPerIntra9     = 0;
     nPerIntra10    = 0;
     nPerIntra11    = 0;
     nPerIntra12    = 0;

     nVarios1       = 0;
     nVarios2       = 0;
     nImprime       = 0;
     nMes           = 0;
     nMesGuarda     = 0;
     nDevengo       = 0;

     nSwSi  = 0;
     nNume  = 0;
     nNume1 = 0;
     nNume2 = 0;
     nCanti = 0;
     nDepartamento = 0;

     nError     = 0;
     nBaffer    = 0;
     nTotalLinea= 0;
     nConta     = 0;
     nOpcion    = 0;

     aTabla     = "";
     aDestino   = "";
     aClvPais   = "";

     &eaAlfa       = "";
     &eaLibro      = "";
     &eaReg        = "";
     &eaLib340     = "";
     &eaReg340     = "";
     &eaError      = "";
     nSwCuotaNeg   = 0;

     &enEmpresaA   = 0;
     &enAnyo       = 0;
     &enEmpAmor    = 0;
     &enEjeAmor    = 0;
     &enDActAmor   = 0;
     &enHActAmor   = 0;
     &enImpRegul   = 0;

     &enProAct = 0;
     &enProCom = 0;
     nSwOp     = 0;
     nVale     = 0;

     nSwISP    = 0;
     aISP      = "";
     nSw       = 0;
     nSw105    = 0;
     nConcepto = 0;
     aISPAnt   = "";

     nHayCaja   = 0
     enSwCaja   = 0
     nBaseCaja  = 0;
     nCuotaCaja = 0;
     nBaseCajD  = 0;
     nCuotaCajD = 0;
     nOpCaja    = 0;
     nSwUno     = 0;
     nEjerCobro = 0;

   &eDevenCaja  = 0;
   &ePathCaja   = "";
   &ePerioCaja  = 0;

|FIN;

|INCLUYE i_variar;

|PROCESO LeoCobro;
    |ABRE #502;
    |DDEFECTO #502;
    #502#17 = nEjerCobro;
    #502#0 = #102#0;
    #502#1 = #102#1;
    #502#2 = #935#9;
    |LEE 041#502=;
    |CIERRA #502;
|FPRC;

|PROCESO FacturasInversion;
     |SI #41#48 = "X";  |ACABA;  |FINSI;

     aClvPais = "";
     |ABRE #caerpnif;
     #caerpnif#0 = #camaniva#0;
     #caerpnif#1 = #camaniva#1;
     |LEE 000#caerpnif.=;
     |SI FSalida = 0;
         aClvPais = #caerpnif#4;
     |FINSI;
     |CIERRA #caerpnif;

     |ABRE #344;
     |SELECT #1#344;
     #344#0  = enEmpresa;
     #344#1  = enEjer;
     #344#2  = enPeriodo;
     #344#3  = 340;
     #344#4  = enComplem;
     #344#5  = enActividad;
     #344#6  = 999999;
     |LEE 000#344];
     |SI FSalida = 0;
         |LEE 000#344a;
     |SINO;
         |LEE 000#344u;
     |FINSI;

     nReg = 1;
     |SI FSalida = 0;  |Y #344#0  = enEmpresa; |Y #344#1  = enEjer;
                       |Y #344#2  = enPeriodo; |Y #344#3  = 340;
                       |Y #344#4  = enComplem; |Y #344#5  = enActividad;
         nReg = #344#6 + 1;
     |FINSI;

     eaCodNif  = #41#47; |QBF eaCodNif;
     enCalcCif = 1;
     |HAZ LeeNifs;
     |QBF eaCodNif;

     |SI eaCodNif = "";
         aPais   = "";
         aNombre = #41#8;  |QBF aNombre;
     |SINO;
         aPais   = #709#12;
         aNombre = #709#1;  |QBF aNombre;
     |FINSI;

     |DDEFECTO #344;
     #344#0  = enEmpresa;
     #344#1  = enEjer;
     #344#2  = enPeriodo;
     #344#3  = 340;
     #344#4  = enComplem;
     #344#5  = enActividad;
     #344#6  = nReg;
     #344#7  = eaVarDni;

     |SI aNombre = "";  aNombre = #41#8;  |FINSI;

     #344#9  = aNombre;
     #344#10 = aPais;
     |SI #344#10 = "   ";
         #344#10 = "ES";
     |FINSI;

     #344#13 = #41#48;  ||clave operacion compra
     #344#14 = #41#27;  ||fecha expedicion
     #344#15 = "01.01.0000"; ||
     #344#16 = #41#46;  || % de IVA
     #344#17 = #41#10;  || base imponible
     #344#18 = (#41#10 % #41#46) ! EURODBMOD;   ||cuota iva
     #344#19 = #344#17 + #344#18;
     #344#21 = #41#49;  || identificacion de compra
     #344#22 = #49#9;   ||% Prorrata del ejercicio

     |SI #41#26 > "01.01.0001";
         #344#24 = #41#50;
         #344#25 = #49#10;
     |SINO;
         #344#23 = #49#10;
     |FINSI;
     #344#26 = #41#9;
     #344#27 = #41#4;
     #344#28 = #41#53;

     nChequeaNif = 1;
     |SI #344#10 ! "ES ";
         aAlfa     = #344#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #344#12 = aAlfa + #41#47;

                            #344#11 = "3";
         |SI aAlfa = "DE";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "AT";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "BE";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "BG";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "CY";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "DK";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "SI";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "EE";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "FI";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "FR";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "EL";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "GB";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "NL";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "HU";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "IT";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "IE";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "LV";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "LT";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "LU";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "MT";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "PL";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "PT";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "CZ";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "SK";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "RO";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "SE";  #344#11 = "2";  |FINSI;
         |SI aAlfa = "HR";  #344#11 = "2";  |FINSI;

         nChequeaNif = 0;
     |FINSI;

     |SI #344#13 = "P";
         aAlfa     = #344#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #344#12 = aAlfa + #41#47;
         #344#11 = "2";
         nChequeaNif = 0;
     |FINSI;

     aClaveOp    = #344#13;
     aNombre     = #344#9;

     |SI aClaveOp = "A";  |O aClaveOp = "B";  |O aClaveOp = "J";
      |O aClaveOp = "P";
         nChequeaNif = 0;
     |FINSI;

     |HAZ Errores340;

     #344#7  = eaVarDni;

     aAlfa = #344#7 % 101;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         #344#11 = "4";
     |FINSI;

     |SI aClvPais ! "";
         #344#11 = aClvPais;
     |FINSI;

     |GRABA 020#344n;
     |LIBERA #344;

     |CIERRA #344;
|FPRC;

|PROCESO LeoBienesInversion;
 |DDEFECTO #49;
 #49#0  = #41#0;
 #49#2  = #41#2;
 #49#3  = #41#3;
 #49#5  = enEjer;
 #49#11 = "R";
 |LEE 041#49=;
 |SI #49#10 ! 0;
     |DDEFECTO #102;
     |DDEFECTO #103;
     #102#0  = #41#49 % 0102;
     #102#1  = #41#49 % 0410;
     #102#14 = #41#47;
     #935#0  = "0";
     #935#2  = #41#10;
     |HAZ FacturasInversion;
 |FINSI;
|FPRC;

|DEFBUCLE LeoBienesInversion;
 #41#1;
 1,41;
 enEmpresa, "        ", 00, enActividad, "S";
 enEmpresa, "zzzzzzzz", 99, enActividad, "S";
 e;
 NULL, LeoBienesInversion;
|FIN;

|PROCESO PasarBienesInver;
  |ABRE #49;
  |SELECT #2#49;
  |BUCLE LeoBienesInversion;
  |SELECT #1#49;
  |CIERRA #49;
|FPRC;

|PROCESO Errores340;
     eaLibro = (("00" + #102#0) % -102);
     eaReg   = (("0000000000" + #102#1) % -110);

     |SI #935#0 = "0";  eaLib340 = "INVERSION";  |FINSI;
     |SI #935#0 = "1";  eaLib340 = "EXPEDIDAS";  |FINSI;
     |SI #935#0 = "3";  eaLib340 = "EXPEDIDAS";  |FINSI;
     |SI #935#0 = "2";  eaLib340 = "RECIBIDAS";  |FINSI;

     eaReg340 = (("000000" + nReg) % -106);

     |SI nChequeaNif = 1;
         eaVarDni  = #102#14;  |HAZ DNISinChequeo;
         aAlfa1    = #102#14;  |QBF aAlfa1;
         aAlfa2    = eaVarDni; |QBF aAlfa2;

         |SI aAlfa1 ! aAlfa2;  |O eaAlfa ! "";  |O aAlfa1 = "";
             eaError = eaAlfa;

             |SI aAlfa1 = "";
                 eaError = "El NIF/CIF Sin contenido";
                 |PRINT;
             |SINO;
                 |SI aAlfa1 ! aAlfa2;
                     eaError = "El NIF/CIF puede ser erroneo";
                     |PRINT;
                 |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         eaVarDni = "";
     |FINSI;

     |SI #935#2 = 0;
         eaError = "Sin contenido en Base Imponible";
         |PRINT;
     |FINSI;

     aAlfa = aNombre;  |QBF aAlfa;
     |SI aAlfa = "";
         eaError = "Sin contenido en Apellidos y Nombre";
         |PRINT;
     |SINO;
         aAlfa = eaVarDni % 101;
         |SI aAlfa = "0"; |O aAlfa = "1"; |O aAlfa = "2"; |O aAlfa = "3";
          |O aAlfa = "4"; |O aAlfa = "5"; |O aAlfa = "6"; |O aAlfa = "7";
          |O aAlfa = "8"; |O aAlfa = "9"; |O aAlfa = "X"; |O aAlfa = "Y";
          |O aAlfa = "Z";
              aAlfa = aNombre;  |QBF aAlfa;
              aAlfa1 = aAlfa - " ";
              |SI aAlfa1 = aAlfa;
                  eaError =  "Formato del Apellidos y Nombre puede ser erroneo";
                  |PRINT;
              |FINSI;
         |FINSI;
     |FINSI;

     |SI aClaveOp = "A";  |O aClaveOp = "B";
         aAlfa = #102#43;  |QBF aAlfa;
         |SI aAlfa = "";
             eaError = "Factura resumen sin contenido Primer Numero";
             |PRINT;
         |FINSI;

         aAlfa = #102#44;  |QBF aAlfa;
         |SI aAlfa = "";
             eaError = "Factura resumen sin contenido Ultimo Numero";
             |PRINT;
         |FINSI;
     |FINSI;

     |DFICE aTabla;  |QBF aTabla;

     aTabla      = aTabla + "ztabla05.txt";
     nOpcion     = 1;
     nTotalLinea = 0;
     nConta      = -1;
     nBaffer     = 0;

     |LEESECUENCIAL aTabla, nBaffer, nTotalLinea, 0, 0;

     nError = 1;
     |PARA nConta = 0;  |SI nConta [ nTotalLinea;  |HACIENDO nConta = nConta + 1;
         |DEL_BUF nBaffer, nConta, aDestino;
         aAlfa = aDestino % 102;

         |QBF aAlfa;
         |QBF aPais;

         |SI aAlfa = aPais;  nError = 0;  |SAL;  |FINSI;
     |SIGUE;

     |SI nError = 1;
         eaError =  "Contenido incorrecto en el codigo del Pais: " + aPais;
         |PRINT;
     |FINSI;

     |FINDIM nBaffer;
|FPRC;

|PROCESO FacturasExpedidas;
     |SI #30#91 = "X"; |Y #935#9 = 0;   || Transmisiones inmuebles.
         #913#0 = #102#14;
         #913#1 = enEjer;
         |LEE 101#913=;
         |SI FSalida ! 0;
             |DDEFECTO #913;
             #913#0 = #102#14;
             #913#1 = enEjer;
             #913#4 = #102#13;
             |GRABA 020#913b;
         |FINSI;

         #913#2 = #913#2 + ((((#935#2 + #935#3 + #935#5) / enConversor)) ! EURODBMOD);
         #913#3 = "S";
         #913#5 = #102#4;
         #913#6 = #caerpnif#4;

         |GRABA 020#913a;
         |LIBERA #913;
     |FINSI;

                         aSimbolo = "*";
     |SI enEjer < 2012;  aSimbolo = "X";  |FINSI;

     |SI #102#42 = aSimbolo;  |ACABA;  |FINSI;

     |ABRE #342;
     |SELECT #1#342;
     #342#0  = enEmpresa;
     #342#1  = enEjer;
     #342#2  = enPeriodo;
     #342#3  = 340;
     #342#4  = enComplem;
     #342#5  = enActividad;
     #342#6  = 999999;
     |LEE 000#342];
     |SI FSalida = 0;
         |LEE 000#342a;
     |SINO;
         |LEE 000#342u;
     |FINSI;

     nReg = 1;
     |SI FSalida = 0;  |Y #342#0  = enEmpresa; |Y #342#1  = enEjer;
                       |Y #342#2  = enPeriodo; |Y #342#3  = 340;
                       |Y #342#4  = enComplem; |Y #342#5  = enActividad;
         nReg = #342#6 + 1;
     |FINSI;

     eaCodNif  = #102#14;   |QBF eaCodNif;
     enCalcCif = 1;
     |HAZ LeeNifs;
     |QBF eaCodNif;

     |SI eaCodNif = "";
         |ABRE #106;
         |SI #102#36 = "R";  #106#23 = "C";  |FINSI;
         |SI #102#36 = "S";  #106#23 = "P";  |FINSI;
                             #106#10 = #102#12;
         |LEE 000#106=;
         |SI FSalida ! 0;  |DDEFECTO #106;  |FINSI;
         |CIERRA #106;

         aPais   = #106#24;
         aNombre = #106#1;  |QBF aNombre;
     |SINO;
         aPais   = #709#12;
         aNombre = #709#1;  |QBF aNombre;
     |FINSI;

     |SI aNombre = "";  aNombre = #102#13;  |FINSI;

     |DDEFECTO #342;
     #342#0  = enEmpresa;
     #342#1  = enEjer;
     #342#2  = enPeriodo;
     #342#3  = 340;
     #342#4  = enComplem;
     #342#5  = enActividad;
     #342#6  = nReg;
     #342#9 = aNombre;
     #342#10 = aPais;
     |SI #342#10 = "   ";
         #342#10 = "ES";
     |FINSI;

     #342#13 = #102#42; |SI enSwCaja = 1; |Y #935#9 = 0; #342#13 = " "; |FINSI;
     #342#14 = #102#4;
     #342#15 = #102#41;
     #342#16 = #935#1;
     #342#17 = #935#2;
     #342#18 = #935#3;
     #342#27 = #935#4;
     #342#28 = #935#5;
     #342#19 = #342#17 + #342#18 + #342#28;
     #342#22 = #102#38;
     |SI #342#22 = 0;  #342#22 = 1;  |FINSI;

     |SI nVarios1 > 1;  |Y #342#13 = " "; |Y #935#8 = " ";
         #342#13 = "C";
         #342#23 = nVarios1;
     |FINSI;

     |SI #342#13 = " "; |Y #935#8 = "S";
         #342#13 = "I";
     |FINSI;

     aAlfa = "";
     |SI #7#26 = "S";
         aAlfa   = #102#22;  |QBF aAlfa;
     |FINSI;

     |SI aAlfa = "";
         aAlfa   = (("00" + #102#0) % -102) + "-" + (("0000000000" + #102#1) % -110) + " / ";

         |SI #102#2 ! "     ";
             aAlfa   = aAlfa + #102#2 + "-" + (("000000" + #102#3) % -106);
         |SINO;
             aAlfa   = aAlfa + (("000000" + #102#3) % -106);
         |FINSI;
     |FINSI;

     #342#21 = aAlfa;

     |SI #342#13 = "I"; |Y #102#36 = "S";  || No lo quito, pero no sera = I > 2011
         aNifAnt   = #102#14;              || las de ISP no se pasan como emitidas
         #102#14   = #101#8;
         eaVarDni  = #101#8;
         eaCodNif  = #101#8;  |QBF eaCodNif;
         enCalcCif = 1;
         |HAZ LeeNifs;
         |QBF eaCodNif;

         aPais   = #709#12;
         aNombre = #709#1;  |QBF aNombre;

         #342#7  = #101#8;

         |SI aNombre = "";  aNombre = #101#1;  |FINSI;

         #342#9  = aNombre;
         #342#10 = aPais;
         |SI #342#10 = "   ";
             #342#10 = "ES";
         |FINSI;
     |FINSI;

     |SI #342#13 = " ";
         |SI #30#26 = 6;  #342#13 = "I";  |FINSI;
     |FINSI;

     |SI #102#42 = "A";  |O #102#42 = "B";
         #342#24 = #102#43;
         #342#25 = #102#44;
     |FINSI;

     nChequeaNif = 1;

     |SI #342#10 ! "ES ";
         aAlfa   = #342#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

                            #342#11 = "6";
         |SI aAlfa = "DE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "AT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "BE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "BG";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "CY";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "DK";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SI";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "EE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "FI";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "FR";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "EL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "GB";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "NL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "HU";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "IT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "IE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LV";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LU";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "MT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "PL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "PT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "CZ";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SK";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "RO";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "HR";  #342#11 = "2";  |FINSI;

         #342#12 = aAlfa + #102#14;
         nChequeaNif = 0;
     |FINSI;

     |SI #935#0 = "3";  |Y #935#7 = 9;
         aAlfa   = #342#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #342#12 = aAlfa + #102#14;
         #342#11 = "2";
         nChequeaNif = 0;
     |FINSI;

     |SI #935#0 = "3";  |Y #935#7 = 10;
         aAlfa   = #342#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #342#12 = aAlfa + #102#14;

         #342#11 = "4";
         aAlfa   = #102#14;   |QBF aAlfa;
         |SI aAlfa = "";  #342#11 = "6";  |FINSI;
         nChequeaNif = 0;
     |FINSI;


     aAlfa = #102#14; |QBF aAlfa;
     |SI aAlfa = ""; #342#12 = ""; |FINSI;

     aClaveOp = #342#13;
     aNombre  = #342#9;

     |SI aClaveOp = "A";  |O aClaveOp = "B";  |O aClaveOp = "J";
      |O aClaveOp = "P";
         nChequeaNif = 0;
     |FINSI;

     |SI aClaveOp = "D";
         #342#26 = #102#45;
     |FINSI;

     |SI aClaveOp = "R";
         |ABRE #agicen17;
         #agicen17#0 = enEmpresa;
         #agicen17#1 = #102#10;
         #agicen17#2 = #102#11;
         |LEE 040#agicen17.=;
         |SI FSalida ! 0;  |DDEFECTO #agicen17;  |FINSI;
         |CIERRA #agicen17;

         #342#30 = #agicen17#17;
         #342#31 = #agicen17#3;
     |FINSI;

     |HAZ Errores340;

     #342#7  = eaVarDni;
     #342#29 = #107#7;

     aAlfa = #342#7 % 101;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         #342#11 = "4";
     |FINSI;

     |SI #342#13 = "S";  |O #342#13 = "T";  |O #342#13 = "W";  |O #342#13 = "U";
         #342#16 = 0;
         #342#17 = 0;
         #342#18 = 0;
         #342#27 = 0;
         #342#28 = 0;
     |FINSI;

     |SI #935#9 ! 0;
         |HAZ LeoCobro;
         #342#35 = #502#4;
         #342#36 = #935#10;
         #342#37 = #502#14;
         #342#38 = #502#15;
     |FINSI;

     |SI aClvPais ! "";
         #342#11 = aClvPais;
     |FINSI;

     |GRABA 020#342n;
     |LIBERA #342;

     |SI #342#13 = "I"; |Y enEjer [ 2010; |Y #102#36 = "S";
         #102#14 = aNifAnt;
     |FINSI;

     |CIERRA #342;
|FPRC;

|PROCESO SoloBase;             || ya no se hace este registro 700000_6232
     |ABRE #343;               || ... . ... ... 15.02.2011 ... ... ... .
     |SELECT #1#343;
     #343#0  = enEmpresa;
     #343#1  = enEjer;
     #343#2  = enPeriodo;
     #343#3  = 340;
     #343#4  = enComplem;
     #343#5  = enActividad;
     #343#6  = 999999;
     |LEE 000#343];
     |SI FSalida = 0;
         |LEE 000#343a;
     |SINO;
         |LEE 000#343u;
     |FINSI;

     nReg = 1;
     |SI FSalida = 0;  |Y #343#0  = enEmpresa; |Y #343#1  = enEjer;
                       |Y #343#2  = enPeriodo; |Y #343#3  = 340;
                       |Y #343#4  = enComplem; |Y #343#5  = enActividad;
         nReg = #343#6 + 1;
     |FINSI;

     eaVarDni  = #102#14;
     eaCodNif  = #102#14;  |QBF eaCodNif;
     enCalcCif = 1;
     |HAZ LeeNifs;
     |QBF eaCodNif;

     |SI eaCodNif = "";
         |ABRE #106;
         |SI #102#36 = "R";  #106#23 = "C";  |FINSI;
         |SI #102#36 = "S";  #106#23 = "P";  |FINSI;
                             #106#10 = #102#12;
         |LEE 000#106=;
         |SI FSalida ! 0;  |DDEFECTO #106;  |FINSI;
         |CIERRA #106;

         aPais   = #106#24;
         aNombre = #106#1;  |QBF aNombre;
     |SINO;
         aPais   = #709#12;
         aNombre = #709#1;  |QBF aNombre;
     |FINSI;

     |DDEFECTO #343;
     #343#0  = enEmpresa;
     #343#1  = enEjer;
     #343#2  = enPeriodo;
     #343#3  = 340;
     #343#4  = enComplem;
     #343#5  = enActividad;
     #343#6  = nReg;
     #343#7  = eaVarDni;

     |SI aNombre = "";  aNombre = #102#13;  |FINSI;

     #343#9  = aNombre;
     #343#10 = aPais;
     |SI #343#10 = "   ";
         #343#10 = "ES";
     |FINSI;

     #343#13 = #102#42; |SI enSwCaja = 1; |Y #935#9 = 0; #343#13 = " "; |FINSI;
     #343#14 = #102#4;
     #343#15 = #102#41;
     #343#16 = 0;
     #343#17 = #935#2;
     #343#18 = 0;
     #343#19 = #343#17;
     #343#26 = #935#6;
     #343#22 = #102#38;
     |SI #343#22 = 0;  #343#22 = 1;  |FINSI;

     aAlfa = "";
     |SI #7#26 = "S";
         aAlfa   = #102#22;  |QBF aAlfa;
     |FINSI;

     |SI aAlfa = "";
         aAlfa   = (("00" + #102#0) % -102) + "-" + (("0000000000" + #102#1) % -110) + " / ";

         |SI #102#2 ! "     ";
             aAlfa   = aAlfa + #102#2 + "-" + (("000000" + #102#3) % -106);
         |SINO;
             aAlfa   = aAlfa + (("000000" + #102#3) % -106);
         |FINSI;
     |FINSI;

     #343#21 = aAlfa;

     |SI #102#42 = "A";  |O #102#42 = "B";
         #343#24 = #102#43;
         #343#25 = #102#44;
     |FINSI;

     nChequeaNif = 1;

     |SI #343#10 ! "ES ";
         aAlfa     = #343#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #343#12 = aAlfa + #102#14;

                            #343#11 = "6";
         |SI aAlfa = "DE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "AT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "BE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "BG";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "CY";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "DK";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "SI";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "EE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "FI";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "FR";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "EL";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "GB";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "NL";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "HU";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "IT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "IE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "LV";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "LT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "LU";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "MT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "PL";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "PT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "CZ";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "SK";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "RO";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "SE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "HR";  #343#11 = "2";  |FINSI;

         nChequeaNif = 0;
     |FINSI;


     aClaveOp    = #343#13;
     aNombre     = #343#9;

     |SI aClaveOp = "A";  |O aClaveOp = "B";  |O aClaveOp = "J";
      |O aClaveOp = "P";
         nChequeaNif = 0;
     |FINSI;

     |HAZ Errores340;

     #343#7  = eaVarDni;
     #343#27 = #107#7;

     aAlfa = #343#7 % 101;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         #343#11 = "4";
     |FINSI;

     |SI #343#13 = "S";  |O #343#13 = "W";
         #343#16 = 0;
         #343#17 = 0;
         #343#18 = 0;
         #343#26 = 0;
     |FINSI;

     |SI #343#13 = "X";
         || #343#17 = #343#19;  ||tique 3218_2066 Consultar con Carlos
         #343#16 = 0;
     |FINSI;

     |SI aClvPais ! "";
         #343#11 = aClvPais;
     |FINSI;

     |GRABA 020#343n;
     |LIBERA #343;
|FPRC;

|PROCESO FacturasRecibidas;
                         aSimbolo = "*";
     |SI enEjer < 2012;  aSimbolo = "X";  |FINSI;

     |SI #102#42 = aSimbolo;  |ACABA;  |FINSI;

     |ABRE #343;
     |SELECT #1#343;
     #343#0  = enEmpresa;
     #343#1  = enEjer;
     #343#2  = enPeriodo;
     #343#3  = 340;
     #343#4  = enComplem;
     #343#5  = enActividad;
     #343#6  = 999999;
     |LEE 000#343];
     |SI FSalida = 0;
         |LEE 000#343a;
     |SINO;
         |LEE 000#343u;
     |FINSI;

     nReg = 1;
     |SI FSalida = 0;  |Y #343#0  = enEmpresa; |Y #343#1  = enEjer;
                       |Y #343#2  = enPeriodo; |Y #343#3  = 340;
                       |Y #343#4  = enComplem; |Y #343#5  = enActividad;
         nReg = #343#6 + 1;
     |FINSI;

     eaCodNif  = #102#14;  |QBF eaCodNif;
     enCalcCif = 1;
     |HAZ LeeNifs;
     |QBF eaCodNif;

     |SI eaCodNif = "";
         |ABRE #106;
         |SI #102#36 = "R";  #106#23 = "C";  |FINSI;
         |SI #102#36 = "S";  #106#23 = "P";  |FINSI;
                             #106#10 = #102#12;
         |LEE 000#106=;
         |SI FSalida ! 0;  |DDEFECTO #106;  |FINSI;
         |CIERRA #106;

         aPais   = #106#24;
         aNombre = #106#1;  |QBF aNombre;
     |SINO;
         aPais   = #709#12;
         aNombre = #709#1;  |QBF aNombre;
     |FINSI;

     |DDEFECTO #343;
     #343#0  = enEmpresa;
     #343#1  = enEjer;
     #343#2  = enPeriodo;
     #343#3  = 340;
     #343#4  = enComplem;
     #343#5  = enActividad;
     #343#6  = nReg;
     #343#7  = eaVarDni;

     |SI aNombre = "";  aNombre = #102#13;  |FINSI;

     #343#9  = aNombre;
     #343#10 = aPais;
     |SI #343#10 = "   ";
         #343#10 = "ES";
     |FINSI;

     #343#13 = #102#42; |SI enSwCaja = 1; |Y #935#9 = 0; #343#13 = " "; |FINSI;
     #343#14 = #102#4;
     #343#15 = #102#41;
     #343#16 = #935#1;
     #343#17 = #935#2;
     #343#18 = #935#3;
     #343#19 = #343#17 + #343#18;
     #343#26 = #935#6;
     #343#22 = #102#38;
     |SI #343#22 = 0;  #343#22 = 1;  |FINSI;

     |SI nVarios2 > 1;  |Y #343#13 = " "; |Y #935#8 = " ";
         #343#13 = "C";
         #343#23 = nVarios2;
     |FINSI;

     |SI #343#13 = " "; |Y #935#8 = "S";
         #343#13 = "I";
     |FINSI;

     |SI enEjer [ 2010;
          |SI #343#13 = "I";                  || los iSP solo un registro
              aNifAnt   = #102#14;            || de recibidas, con el DNI
              #102#14   = #101#8;             || la base y cuota. > 2011
              eaVarDni  = #101#8;
              eaCodNif  = #101#8;  |QBF eaCodNif;
              enCalcCif = 1;
              |HAZ LeeNifs;
              |QBF eaCodNif;

              aPais   = #709#12;
              aNombre = #709#1;  |QBF aNombre;

              #343#7  = #101#8;

              |SI aNombre = "";  aNombre = #101#1;  |FINSI;

              #343#9  = aNombre;
              #343#10 = aPais;
              |SI #343#10 = "   ";
                  #343#10 = "ES";
              |FINSI;
          |FINSI;
     |FINSI;

     aAlfa = "";
     |SI #7#26 = "S";
         aAlfa   = #102#22;  |QBF aAlfa;
     |FINSI;

     |SI aAlfa = "";
         aAlfa   = (("00" + #102#0) % -102) + "-" + (("0000000000" + #102#1) % -110) + " / ";

         |SI #102#2 ! "     ";
             aAlfa   = aAlfa + #102#2 + "-" + (("000000" + #102#3) % -106);
         |SINO;
             aAlfa   = aAlfa + (("000000" + #102#3) % -106);
         |FINSI;
     |FINSI;

     #343#21 = aAlfa;

     |SI #343#13 = " ";
         |SI #30#28 = 5;  #343#13 = "P";  |FINSI;
     |FINSI;

     |SI #102#42 = "A";  |O #102#42 = "B";
         #343#24 = #102#43;
         #343#25 = #102#44;
     |FINSI;

     nChequeaNif = 1;

     |SI #343#10 ! "ES ";
         aAlfa     = #343#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #343#12 = aAlfa + #102#14;

                            #343#11 = "3";
         |SI aAlfa = "DE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "AT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "BE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "BG";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "CY";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "DK";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "SI";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "EE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "FI";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "FR";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "EL";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "GB";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "NL";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "HU";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "IT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "IE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "LV";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "LT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "LU";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "MT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "PL";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "PT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "CZ";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "SK";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "RO";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "SE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "HR";  #343#11 = "2";  |FINSI;

         nChequeaNif = 0;
     |FINSI;

     |SI #343#13 = "P";
         aAlfa     = #343#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #343#12 = aAlfa + #102#14;
         #343#11 = "2";
         nChequeaNif = 0;
     |FINSI;


     aClaveOp    = #343#13;
     aNombre     = #343#9;

     |SI aClaveOp = "A";  |O aClaveOp = "B";  |O aClaveOp = "J";
      |O aClaveOp = "P";
         nChequeaNif = 0;
     |FINSI;

     |HAZ Errores340;

     #343#7  = eaVarDni;
     #343#27 = #107#7;

     aAlfa = #343#7 % 101;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         #343#11 = "4";
     |FINSI;

     |SI #343#13 = "S";  |O #343#13 = "W";
         #343#16 = 0;
         #343#17 = 0;
         #343#18 = 0;
         #343#26 = 0;
     |FINSI;

     |SI #343#13 = "X";
         #343#16 = 0;
     |FINSI;

     |SI #343#13 = "X";   ||Tique 3218_2066 consultar con paco
        ||   #343#17 = #343#19;
        ||   #343#16 = 0;
     |FINSI;

     |SI #935#9 ! 0;
         |HAZ LeoCobro;
         #343#28 = #502#4;
         #343#29 = #935#10;
         #343#30 = #502#14;
         #343#31 = #502#15;
     |FINSI;

     |SI aClvPais ! "";
         #343#11 = aClvPais;
     |FINSI;

     |GRABA 020#343n;
     |LIBERA #343;

     |SI enEjer [ 2010;
          |SI #343#13 = "I";        || ya no realizamos otro registro 2011
              #102#14 = aNifAnt;    || operaciones ISP  70000_6232
              |HAZ SoloBase;        || 15.02.2011
          |FINSI;
     |FINSI;

     |CIERRA #343;
|FPRC;

|PROCESO dsmow135;
     |SI #102#42 = "S";  |HAZ FacturasExpedidas;  |FINSI;
     |SI #935#0  = "1";  |HAZ FacturasExpedidas;  |FINSI;
     |SI #935#0  = "2";  |HAZ FacturasRecibidas;  |FINSI;
     |SI #935#0  = "3"; |Y #102#42 ! "S"; |HAZ FacturasExpedidas;  |FINSI;
|FPRC;

|DEFBUCLE dsmow135;
     #935#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsmow135;
|FIN;

|PROCESO Graba340;
     |SI #102#42 = "A";  |O #102#42 = "B";
         |SI nVarios1 > 1;   |O nVarios2 > 1;
             eaLibro = (("00" + #102#0) % -102);
             eaReg   = (("0000000000" + #102#1) % -110);

             |SI nVarios1 > 1;  eaLib340 = "EXPEDIDAS";  |FINSI;
             |SI nVarios2 > 2;  eaLib340 = "RECIBIDAS";  |FINSI;

             eaReg340 = "------";
             eaError  = "Factura resumen con varios tipos de iva. No se pasa el registro al 340";

             |PRINT;
             |ACABA;
          |FINSI;
     |FINSI;

     |BUCLE dsmow135;
|FPRC;
|| ////////////////////////////////////////////////////
|PROCESO GrabaTempo340_Caja;
     |SI nGrupo = 1;
         |SI #30#26 = 5; |O #30#26 = 6;
             |ACABA;
         |FINSI;
     |FINSI;

     #935#0 = nGrupo;
     #935#1 = #103#7;
     #935#8 = aISP;
     #935#9 = #502#2;
     |LEE 101#935=;
     |SI FSalida ! 0;
         |DDEFECTO #935;
         #935#0 = nGrupo;
         #935#1 = #103#7;
         #935#7 = nSubGrupo;
         #935#8 = aISP;
         #935#9 = #502#2;
         |GRABA 020#935b;
     |FINSI;

     |SI nGrupo = 1;
         |SI #103#5 = "S";
             |SI nSubGrupo = 10;
                 #935#4 = nPorce;
                 #935#5 = #935#5 + #503#6;
             |SINO;
                 #935#2 = #935#2 + #503#5;
                 #935#3 = #935#3 + #503#6;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nGrupo = 2;
         #935#2 = #935#2 + #503#5;
         #935#3 = #935#3 + #503#6;

         |SI #103#5 = "S";
             #935#6 = #935#6 + #503#6;
         |FINSI;
     |FINSI;

     #935#10 = #935#10 + #503#4;

     |GRABA 020#935a;
     |LIBERA #935;
|FPRC;

|PROCESO LosCobros;

     |SI nEjerCobro ! 0;
         |SI #502#9 ! 0; |Y #502#9 ! enEjer;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI nOpCaja = 2;
         |SI #502#8 = 0;
             #502#8 = nHPeriodo;
             #502#9 = enEjer;
             nHayCaja = 1;
             |GRABA 020#502a;
         |FINSI;
         |LIBERA #502;
         |ACABA;
     |FINSI;

     |DDEFECTO #503;
     |LIBERA #503;
     #503#7 = #502#17;
     #503#0 = #502#0;
     #503#1 = #502#1;
     #503#2 = #502#2;
     #503#3 = #103#2;
     |LEE 041#503=;
     |SI FSalida = 0;

         |SI nOpCaja = 0;
             nBaseCaja  = (nBaseCaja  + #503#5) ! EURODBMOD;
             nCuotaCaja = (nCuotaCaja + #503#6) ! EURODBMOD;

             |SI #502#8 = #102#40; |Y #502#17 = 0;
                 nBaseCajD  = (nBaseCajD  + #503#5) ! EURODBMOD;
                 nCuotaCajD = (nCuotaCajD + #503#6) ! EURODBMOD;
             |FINSI;
         |FINSI;

         |SI nOpCaja = 1;
             |SI #502#8 = nHPeriodo; |O #502#8 = 0;
                 |SI #503#5 ! 0; |O #503#6 ! 0;
                     |HAZ GrabaTempo340_Caja;
                 |FINSI;
             |FINSI;
         |FINSI;
    |FINSI;
    |LIBERA #502;
|FPRC;

|DEFBUCLE LosCobros;
     #502#1;
     7;
     nEjerCobro, #102#0, #102#1, 01, nDPeriodo;
     nEjerCobro, #102#0, #102#1, 99, nHPeriodo;
     be;
     NULL, LosCobros;
|FIN;

|PROCESO GrabaTempo340;

     |SI nGrupo = 1;  |Y #30#26 = 5;
         |ACABA;
     |FINSI;

     |SI enEjer > 2010;
          |SI nGrupo = 1; |Y #30#26 = 6;  || tique 60000_ 6232  15.02.2011
              |ACABA;                     || ISP no pasan como Emitidas
          |FINSI;
     |FINSI;

     |SI nGrupo > 3;  |ACABA;  |FINSI;

     |SI nGrupo = 3;

/*                                 Tique 1105_210
         |SI nSubGrupo = 11;  |ACABA;  |FINSI;
         |SI nSubGrupo < 9;  |O nSubGrupo > 12;
             |ACABA;
         |FINSI;
*/

         |SI nSubGrupo ! 4; |Y nSubGrupo ! 16;
            |Y nSubGrupo ! 9; |Y nSubGrupo ! 10;
              |Y nSubGrupo ! 11; |Y nSubGrupo ! 12;
              |ACABA;
         |FINSI;
     |FINSI;

     |SI enSwCaja = 1;
         |SI nGrupo = 1; |O nGrupo = 2;
             nNume1    = nBaseImpo;
             nNume2    = nCuota;
             nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
             nCuota    = (#103#8 / enConversor) ! EURODBMOD;
         |FINSI;
     |FINSI;

     #935#0 = nGrupo;
     #935#1 = #103#7;
     #935#8 = aISP;
     #935#9 = 00;                || no cobro/pago
     |LEE 101#935=;
     |SI FSalida ! 0;
         |DDEFECTO #935;
         #935#0 = nGrupo;
         #935#1 = #103#7;
         #935#7 = nSubGrupo;
         #935#8 = aISP;
         #935#9 = 00;
         |GRABA 020#935b;

         |SI aISP = " ";
             |SI nGrupo = 1;  nVarios1 = nVarios1 + 1;  |FINSI;
             |SI nGrupo = 3;  nVarios1 = nVarios1 + 1;  |FINSI;
             |SI nGrupo = 2;  nVarios2 = nVarios2 + 1;  |FINSI;
         |FINSI;
     |FINSI;

     |SI nGrupo = 0;
         |SI #103#5 = "S";
             #935#2 = #935#2 + nBaseImpo;
             #935#3 = #935#3 + nCuota;
         |FINSI;
     |FINSI;

     |SI nGrupo = 1;
         |SI #103#5 = "S";
             |SI nSubGrupo = 10;
                 #935#4 = nPorce;
                 #935#5 = #935#5 + nCuota;
             |SINO;
                 #935#2 = #935#2 + nBaseImpo;
                 #935#3 = #935#3 + nCuota;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nGrupo = 3;
         |SI #103#5 = "S";
             #935#2 = #935#2 + nBaseImpo;
             #935#3 = #935#3 + nCuota;
         |FINSI;
     |FINSI;

     |SI nGrupo = 2;
         #935#2 = #935#2 + nBaseImpo;
         #935#3 = #935#3 + nCuota;

         |SI #103#5 = "S";
             #935#6 = #935#6 + nCuota;
         |FINSI;
     |FINSI;

     |GRABA 020#935a;
     |LIBERA #935;

     |SI enSwCaja = 1;
         |SI nGrupo = 1; |O nGrupo = 2;
             nBaseImpo = nNume1;
             nCuota    = nNume2;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tratadsmom087_pase;
  |SI nCompensar = 0;
     |DDEFECTO #300;
     #300#0 = #87#0;
     #300#1 = #87#1;
     #300#2 = #87#2;
     #300#3 = #87#3;
     #300#4 = #87#4;
     #300#5 = #87#5;
     #300#6 = #87#6;
     #300#7 = #87#7;
     |LEE 041#300=;

     |PDEFECTO #87, 8, 54;
      #87#16 = #300#16;  #87#19 = #300#19;
      #87#22 = #300#22;  #87#25 = #300#25;
      #87#28 = #300#28;  #87#31 = #300#31;
      #87#34 = #300#34;
  |FINSI;

  #87#11 = enProAct;
  #87#15 = #300#15; #87#17 = (#87#16 % #87#11) ! 2;
  #87#18 = #300#18; #87#20 = (#87#19 % #87#11) ! 2;
  #87#21 = #300#21; #87#23 = (#87#22 % #87#11) ! 2;
  #87#24 = #300#24; #87#26 = (#87#25 % #87#11) ! 2;
  #87#27 = #300#27; #87#29 = (#87#28 % #87#11) ! 2;
  #87#30 = #300#30; #87#32 = (#87#31 % #87#11) ! 2;
  #87#33 = #300#33; #87#35 = (#87#34 % #87#11) ! 2;
  #87#12 = #87#16 + #87#19 + #87#22 + #87#25 + #87#28 + #87#31 + #87#34;
  #87#13 = #87#17 + #87#20 + #87#23 + #87#26 + #87#29 + #87#32 + #87#35;
  #87#14 = #87#12 - #87#13;

  #87#36 = enProCom;
  #87#41 = (#87#40 % #87#36) ! 2;
  #87#43 = (#87#42 % #87#36) ! 2;
  #87#45 = (#87#44 % #87#36) ! 2;
  #87#47 = (#87#46 % #87#36) ! 2;
  #87#49 = (#87#48 % #87#36) ! 2;
  #87#51 = (#87#50 % #87#36) ! 2;
  #87#53 = (#87#52 % #87#36) ! 2;
  #87#37 = #87#40 + #87#42 + #87#44 + #87#46 + #87#48 + #87#50 + #87#52;
  #87#38 = #87#41 + #87#43 + #87#45 + #87#47 + #87#49 + #87#51 + #87#53;
  #87#39 = #87#37 - #87#38;

  #87#8  = #87#12 + #87#37;
  #87#9  = #87#13 + #87#38;
  #87#10 = #87#8  - #87#9;
  |GRABA 020#87a;
  |LIBERA #87;
|FPRC;

|DEFBUCLE TrataTotal87;
 #87#1;
 ;
 #999#0, #999#2, #999#3, enModelo, enComplem, #999#1, 1, 00;
 #999#0, #999#2, #999#3, enModelo, enComplem, #999#1, 9, 99;
 be;
 NULL,Tratadsmom087_pase;
|FIN;

|PROCESO Trata87_pase;
  |SI #300#7 = 0; |ACABA; |FINSI;
  |SI #300#7 > 7;  |Y #300#7 < 13; |ACABA; |FINSI;

  |DDEFECTO #87;
  #87#0 = #300#0;
  #87#1 = #300#1;
  #87#2 = #300#2;
  #87#3 = #300#3;
  #87#4 = #300#4;
  #87#5 = #300#5;
  #87#6 = #300#6;
  #87#7 = #300#7;
  |LEE 141#87=;
  |SI FSalida ! 0;
      |DDEFECTO #87;
      #87#0 = #300#0;
      #87#1 = #300#1;
      #87#2 = #300#2;
      #87#3 = #300#3;
      #87#4 = #300#4;
      #87#5 = #300#5;
      #87#6 = #300#6;
      #87#7 = #300#7;
      |GRABA 020#87b;
  |FINSI;

  #87nCampo2 = #300nCampo2;
  |SI #103#29 = "N";
      #87nCampo3 = #87nCampo3 + nCuota;
  |SINO;
      nCompensar = 1;
      nNume1 = ((nCampo3 - 16) / 3) * 2 + 40;
      #87nNume1 = #87nNume1 + nCuota;
  |FINSI;
  |GRABA 020#87a;
  |LIBERA #87;
|FPRC;

|PROCESO GrabaIvaF2;
     nSwEsta = 0;
     |PARA nCampo2 = 15;  |SI nCampo2 [ 33;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #300nCampo2 = nPorce;
               #300nCampo1 = #300nCampo1 + nBaseImpo;
               #300nCampo2 = nPorce;
               #300nCampo3 = #300nCampo3 + nCuota;
               nSwEsta = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwEsta = 0;
         |PARA nCampo2 = 15;  |SI nCampo2 [ 33;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #300nCampo2 = 0; |Y #300nCampo1 = 0;  |Y #300nCampo3 = 0;
                   #300nCampo1 = #300nCampo1 + nBaseImpo;
                   #300nCampo2 = nPorce;
                   #300nCampo3 = #300nCampo3 + nCuota;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;
         #300#32 = #300#32 + nBaseImpo; nCampo1 = 32;
         #300#33 = 0;                   nCampo2 = 33;
         #300#34 = #300#34 + nCuota;    nCampo3 = 34;
     |FINSI;

     |SI nGrupo = 2;
         |SI enEjer > 2010;
             |HAZ Trata87_pase;
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO GrabaIvaF3;
     nSwEsta = 0;
     |PARA nCampo2 = 36;  |SI nCampo2 [ 54;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #300nCampo2 = nPorce;
               #300nCampo1 = #300nCampo1 + nBaseImpo;
               #300nCampo2 = nPorce;
               #300nCampo3 = #300nCampo3 + nCuota;
               nSwEsta = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwEsta = 0;
         |PARA nCampo2 = 36;  |SI nCampo2 [ 54;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #300nCampo2 = 0; |Y #300nCampo1 = 0;  |Y #300nCampo3 = 0;
                   #300nCampo1 = #300nCampo1 + nBaseImpo;
                   #300nCampo2 = nPorce;
                   #300nCampo3 = #300nCampo3 + nCuota;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;
         #300#53 = #300#53 + nBaseImpo;
         #300#54 = 0;
         #300#55 = #300#55 + nCuota;
     |FINSI;
|FPRC;

|PROCESO PonCasilla;

     nDepartamento = nDepar;
     |SI #999#1 ! nDepar;
         |SI #103#29 = "N";  || no es iva comun
             |ACABA;
         |FINSI;
         |SI enActividad ! enActPrinci;  || si no es la principal, nada
             |ACABA;
         |FINSI;
         nNume = enActividad;
         enActividad = nDepar;
         |HAZ eTipoEmpModelo;
         enActividad = nNume;
         |SI enSwTipoAct = 1;
             |ACABA;            || se pasa en la actividad correspondiente
         |FINSI;
         nDepartamento = enActividad;
     |FINSI;

     |SI nEjerCobro = 0;
         |SI #102#40 = nHPeriodo;  |O #102#40 = 0;  ||graba como hasta ahora fra.
             |SI nEl340 = 1;
                 |HAZ GrabaTempo340;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI enSwCaja = 1; |Y nEl340 = 1;
         |SI nGrupo = 1; |O nGrupo = 2;
             nOpCaja = 1;
             |ABRE #503;
             |BUCLE LosCobros;
             |CIERRA #503;
         |FINSI;
     |FINSI;

     |SI #107#7 = "S";  nGrupo = 0; |FINSI;  ||tique 3955_180
     |SI #103#5 = "N";  |ACABA;  |FINSI;
     |SI nGrupo = 0;    |ACABA;  |FINSI;
     |SI nBaseImpo = 0; |Y nCuota = 0; |ACABA; |FINSI;

     |SI enSwCaja = 1;
         |SI nGrupo = 1;  nSubGrupo = 16; |FINSI;
         |SI nGrupo = 3;  nSubGrupo = 17; |FINSI;
     |FINSI;

     |SI enEjer ] 2015;
         |SI nGrupo = 1;  |Y nSubGrupo = 5; |Y nSw105 = 1;
             nSubGrupo = 19;
         |FINSI;
         |SI nGrupo = 1;  |Y nSubGrupo = 15; |Y nSw105 = 1;
             nSubGrupo = 19;
         |FINSI;
         |SI nGrupo = 2;  |Y nSubGrupo = 5; |Y nSw105 = 1;
             nSubGrupo = 17;
         |FINSI;
         |SI nGrupo = 2;  |Y nSubGrupo = 6; |Y nSw105 = 1;
             nSubGrupo = 17;
         |FINSI;
         |SI nGrupo = 2;  |Y nSubGrupo = 13; |Y nSw105 = 1;
             nSubGrupo = 17;
         |FINSI;
     |FINSI;

     #300#0  = enEmpresa;
     #300#1  = enEjer;
     #300#2  = enPeriodo;
     #300#3  = enModelo;
     #300#4  = enComplem;
     #300#5  = enActividad;
     #300#6  = nGrupo;
     #300#7  = nSubGrupo;
     |LEE 101#300=;
     |SI FSalida = 0;

         |SI nGrupo = 3; |Y nSubGrupo = 4;

            |SI enEjer ] 2012; |Y enEjer [ 2013;
                |SI #30#72 = "S";
                     #300#35 = #300#35 + nBaseImpo;
                |SINO;
                     #300#14 = #300#14 + nBaseImpo;
                |FINSI;
             |SINO;
                 #300#14 = #300#14 + nBaseImpo;
             |FINSI;
             #300#12 = #300#14 + #300#35;

         |SINO;

             |SI #300#11 = 0;
                 nVale = 0;
                 |SI nGrupo = 1;
                     |SI nSubGrupo = 2; |O nSubGrupo = 3; nVale = 1; |FINSI;
                 |FINSI;
                 |SI nVale = 0;
                     |SI nPorce = 0;  |Y nCuota = 0; |ACABA; |FINSI;
                 |FINSI;

                 |SI nGrupo = 1;  |Y nSubGrupo = 6;
                     |SI #30#72 = "N";
                         |HAZ GrabaIvaF2;
                     |SINO;
                         |SI enEjer < 2014;
                             |HAZ GrabaIvaF3;
                         |FINSI;
                     |FINSI;
                 |SINO;
                     |HAZ GrabaIvaF2;
                 |FINSI;

                 #300#12 = #300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32;
                 #300#12 = #300#12 + #300#35 + #300#38 + #300#41 + #300#44 + #300#47 + #300#50 + #300#53;
                 #300#13 = #300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34;
                 #300#13 = #300#13 + #300#37 + #300#40 + #300#43 + #300#46 + #300#49 + #300#52 + #300#55;
             |SINO;
                  #300#12 = #300#12 + nBaseImpo;
             |FINSI;
         |FINSI;

|| Para controlar Intracomunitarios
         nIntra = 0;
         |SI nGrupo = 1;  |Y nSubGrupo = 5;
             nBClaveA = #300#12;
             nCClaveA = #300#13;
             nIntra   = 1;
         |FINSI;

         |SI nGrupo = 1;  |Y nSubGrupo = 6; |Y enEjer < 2014;
             |SI #30#72 = "S";
                 nBClaveI = #300#35 + #300#38 + #300#41 + #300#44 + #300#47 + #300#50 + #300#53;
                 nCClaveI = #300#37 + #300#40 + #300#43 + #300#46 + #300#49 + #300#52 + #300#55;
                 nIntra   = 1;
             |FINSI;
         |FINSI;

         |SI nGrupo = 1;  |Y nSubGrupo = 15; |Y enEjer ] 2014;
             nBClaveI = #300#12;
             nCClaveI = #300#13;
             nIntra   = 1;
         |FINSI;

         |SI nGrupo = 1;  |Y nSubGrupo = 19; |Y enEjer ] 2015;
             nBClaveR = #300#12;
             nCClaveR = #300#13;
             nIntra   = 1;
         |FINSI;

         |SI nGrupo = 3;  |Y nSubGrupo = 9;
             nBClaveE = #300#12;
             nCClaveE = #300#13;
             nIntra   = 1;
         |FINSI;

         |SI nGrupo = 3;  |Y nSubGrupo = 4; |Y enEjer < 2014;
             |SI enEjer < 2012;
                 nBClaveS = #300#12;
                 nCClaveS = #300#13;
                 nIntra   = 1;
             |SINO;
                 |SI #30#72 = "S";
                     nBClaveS = #300#35;
                     nCClaveS = #300#37;
                     nIntra   = 1;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nGrupo = 3;  |Y nSubGrupo = 16;
             nBClaveS = #300#12;
             nCClaveS = #300#13;
             nIntra   = 1;
         |FINSI;

         |SI nIntra   = 1;
             |SI #102#5 = 1;  nPerIntra1  = 1;  |FINSI;
             |SI #102#5 = 2;  nPerIntra2  = 1;  |FINSI;
             |SI #102#5 = 3;  nPerIntra3  = 1;  |FINSI;
             |SI #102#5 = 4;  nPerIntra4  = 1;  |FINSI;
             |SI #102#5 = 5;  nPerIntra5  = 1;  |FINSI;
             |SI #102#5 = 6;  nPerIntra6  = 1;  |FINSI;
             |SI #102#5 = 7;  nPerIntra7  = 1;  |FINSI;
             |SI #102#5 = 8;  nPerIntra8  = 1;  |FINSI;
             |SI #102#5 = 9;  nPerIntra9  = 1;  |FINSI;
             |SI #102#5 = 10; nPerIntra10 = 1;  |FINSI;
             |SI #102#5 = 11; nPerIntra11 = 1;  |FINSI;
             |SI #102#5 = 12; nPerIntra12 = 1;  |FINSI;
         |FINSI;

         |GRABA 020#300a;
         |LIBERA #300;
     |FINSI;
|FPRC;

|PROCESO GrupoSubvencion;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #30#75;
     nCuota    = (nBaseImpo % #30#75) ! EURODBMOD;
     nBaseImpo = 0;

     aAlfa = #103#5;
     #103#5 = "S";
     nGrupo    = 2;
     |SI #30#28 = 0; |O #30#28 = 11;
         nSubGrupo = 11;
         |HAZ PonCasilla;
     |SINO;
         nBaseImpo = 0;
         nCuota    = - nCuota;
         nSubGrupo = #30#28;
         |HAZ PonCasilla;
     |FINSI;
     #103#5 = aAlfa;

     nCampo = 0;
     |SI nSubGrupo = 1;   nCampo = 7;   |FINSI;
     |SI nSubGrupo = 2;   nCampo = 8;   |FINSI;
     |SI nSubGrupo = 3;   nCampo = 9;   |FINSI;
     |SI nSubGrupo = 4;   nCampo = 10;  |FINSI;
     |SI nSubGrupo = 5;   nCampo = 11;  |FINSI;
     |SI nSubGrupo = 6;   nCampo = 12;  |FINSI;
     |SI nSubGrupo = 7;   nCampo = 13;  |FINSI;

     |SI #30#26 ! 0; nSwPasa = 1;  |HAZ Grupo1;  |FINSI;
     |SI #30#30 ! 0; nSwPasa = 1;  |HAZ Grupo3;  |FINSI;
     |SI #30#32 ! 0; nSwPasa = 1;  |HAZ Grupo4;  |FINSI;
     |SI #30#34 ! 0; nSwPasa = 1;  |HAZ Grupo5;  |FINSI;
     |SI #30#36 ! 0; nSwPasa = 1;  |HAZ Grupo6;  |FINSI;
|FPRC;

|PROCESO Grupo1;

     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 1;
     nSubGrupo = #30#26;
     |SI enEjer ] 2014; |Y nSubGrupo = 6;
         |SI #30#72 = "S"; nSubGrupo = 15; |FINSI;
     |FINSI;

     |SI enSwCaja = 1;
         nBaseImpo = nBaseCaja;
         nCuota    = nCuotaCaja;
     |FINSI;

     |HAZ PonCasilla;

     |SI #103#10 ! 0;
         nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
         nPorce    = #103#9;
         nCuota    = (#103#10 / enConversor) ! EURODBMOD;
         nGrupo    = 1;
         nSubGrupo = 10;
         |SI #30#26 = 7;  nSubGrupo = 11; |FINSI;
         |SI #30#26 = 8;  nSubGrupo = 12; |FINSI;
         |SI #30#26 = 17; nSubGrupo = 11; |FINSI;
         |SI #30#26 = 19; nSubGrupo = 11; |FINSI;
         |SI #30#26 = 18; nSubGrupo = 20; |FINSI;
         |HAZ PonCasilla;
     |FINSI;
|FPRC;

|PROCESO Grupo2;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 2;
     nSubGrupo = #30#28;

     |SI enSwCaja = 1;
         nBaseImpo = nBaseCaja;
         nCuota    = nCuotaCaja;
     |FINSI;

     |HAZ PonCasilla;

     nCampo = 0;

     |SI nSubGrupo = 1;   nCampo = 7;   |FINSI;
     |SI nSubGrupo = 2;   nCampo = 8;   |FINSI;
     |SI nSubGrupo = 3;   nCampo = 9;   |FINSI;
     |SI nSubGrupo = 4;   nCampo = 10;  |FINSI;
     |SI nSubGrupo = 5;   nCampo = 11;  |FINSI;
     |SI nSubGrupo = 6;   nCampo = 12;  |FINSI;
     |SI nSubGrupo = 7;   nCampo = 13;  |FINSI;

|FPRC;

|PROCESO Grupo3;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 8;
     nSubGrupo = #30#30;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo4;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 9;
     nSubGrupo = #30#32;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo5;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 3;
     nSubGrupo = #30#34;
     |SI #30#34 = 4; |Y #30#72 = "S"; |Y enEjer ] 2014;
         nSubGrupo = 16;
     |FINSI;
     |SI #30#34 = 16; |Y enEjer < 2014;
         nSubGrupo = 4;
         #30#72    = "S";
     |FINSI;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo6;
     nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
     nPorce    = #103#7;
     nCuota    = (#103#8 / enConversor) ! EURODBMOD;
     nGrupo    = 4;
     nSubGrupo = #30#36;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo9_R;
         nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
         nPorce    = #103#7;
         nCuota    = (#103#8 / enConversor) ! EURODBMOD;
         nGrupo    = 4;
         nSubGrupo = 17;
         |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo9_S;
         nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
         nPorce    = #103#7;
         nCuota    = (#103#8 / enConversor) ! EURODBMOD;
         nGrupo    = 4;
         nSubGrupo = 18;
         |HAZ PonCasilla;
|FPRC;

|PROCESO VariosCon;
     #30#0 = #103#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |SI #30#4 = "N";  |ACABA;  |FINSI;

     aISP = " ";
     |SI #102#36 = "R"; |Y  #30#26 = 0; |Y #30#34 = 4;  aISP = "S"; |FINSI;
     |SI #102#36 = "R"; |Y  #30#26 = 0; |Y #30#34 = 16; aISP = "S"; |FINSI;
     |SI #102#36 = "S"; |Y  #30#26 = 6; |Y #30#36 = 16; aISP = "S"; |FINSI;

     |SI nSw = 0;
         nSw = 1;
         nConcepto = #103#3;
         aISPAnt   = aISP;
     |FINSI;

     |SI nConcepto ! #103#3;
         |SI aISPAnt ! aISP;
             nSwISP = 1;
             |ERROR10;
         |FINSI;
         nConcepto = #103#3;
         aISPAnt   = aISP;
     |FINSI;
|FPRC;

|DEFBUCLE VariosCon;
     #103#1;
     ;
     #102#0, #102#1, 01;
     #102#0, #102#1, 99;
     ;
     NULL, VariosCon;
|FIN;

|PROCESO LeeConcepto349;
 aEspecial = "";
 aTriangul = "";
 #dsmom069#0 = #dsmom030#0;
 |LEE 041#dsmom069.=;
 |SI FSalida = 0;
     |SI #dsmom069#2 = "A"; #dsmom030#26 =  5; |FINSI;
     |SI #dsmom069#2 = "I"; #dsmom030#26 =  6; |FINSI;
     |SI #dsmom069#2 = "E"; #dsmom030#34 =  9; |FINSI;
     |SI #dsmom069#2 = "S"; #dsmom030#34 = 16; |FINSI;
     |SI #dsmom069#2 = "M"; #dsmom030#34 =  9; aEspecial = "M"; |FINSI;
     |SI #dsmom069#2 = "H"; #dsmom030#34 =  9; aEspecial = "H"; |FINSI;
     |SI #dsmom069#2 = "T"; #dsmom030#34 =  9; aEspecial = "T"; aTriangul = "X"; |FINSI;
     || aTriangul = #dsmom069#3;
     #dsmom030#72 = #dsmom069#4;
     |SI enEjer < 2018;
         |SI aEspecial = "T"; aEspecial = "E"; aTriangul = "X"; |FINSI;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO LeeLinea;
     aAlfa1 = #103#30; |QBF aAlfa1; |SI aAlfa1 = ""; #103#30 = #102#10; |FINSI;
     |SI aMulDep = "S";
        nDepar = #103#30;
        |SI nDepar = 0;  nDepar = 1;   |FINSI;
        |ABRE #214;
        #214#0 = #999#0;
        #214#1 = nDepar;
        |LEE 040#214=;
        |SI FSalida ! 0;  nDepar = 1;  |FINSI;
        |CIERRA #214;
        nDepartamento = nDepar;
     |FINSI;

     nSwPasa = 0;
     #30#0 = #103#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #30#4 = "N";  |ACABA;  |FINSI;

     |HAZ LeeConcepto349;

     nBaseCaja  = 0; nBaseCajD  = 0;
     nCuotaCaja = 0; nCuotaCajD = 0;
     |SI enSwCaja = 1;    || suma el importe de lo cobrado
         nOpCaja = 0;
         |ABRE #503;
         |BUCLE LosCobros;
         |CIERRA #503;

         |SI nEjerCobro ! 0;
             |SI nBaseCaja = 0; |Y nCuotaCaja = 0;
                 |ACABA;
             |FINSI;
         |FINSI;

     |FINSI;

     aISP = " ";
     |SI nSwISP = 1;
         |SI #102#36 = "R";  || Ventas
             |SI #30#26 = 0; |Y #30#34 = 4;  aISP = "S"; |FINSI;
             |SI #30#26 = 0; |Y #30#34 = 16; aISP = "S"; |FINSI;
         |FINSI;
         |SI #102#36 = "S";  || Compras
             |SI #30#26 = 6; |Y #30#36 = 16; aISP = "S"; |FINSI;
         |FINSI;
     |FINSI;

     |SI #30#74 = "N";

         |SI #30#26 ! 0; nSwPasa = 1;  |HAZ Grupo1;  |FINSI;
         |SI #30#28 ! 0; nSwPasa = 1;  |HAZ Grupo2;  |FINSI;
         |SI nEjerCobro = 0;
             |SI #30#30 ! 0; nSwPasa = 1;  |HAZ Grupo3;  |FINSI;
             |SI #30#32 ! 0; nSwPasa = 1;  |HAZ Grupo4;  |FINSI;
             |SI #30#34 ! 0; nSwPasa = 1;  |HAZ Grupo5;  |FINSI;
             |SI #30#36 ! 0; nSwPasa = 1;  |HAZ Grupo6;  |FINSI;
         |FINSI;
         |SI enSwCaja = 1; |Y nEjerCobro = 0;
             |SI #102#36 = "R"; nSwPasa = 1; |HAZ Grupo9_R; |FINSI;
             |SI #102#36 = "S"; nSwPasa = 1; |HAZ Grupo9_S; |FINSI;
         |FINSI;

         |SI nSwPasa = 0; |Y nEjerCobro = 0;
             |SI #102#42 = "S";
                 nBaseImpo = (#103#6 / enConversor) ! EURODBMOD;
                 nPorce    = #103#7;
                 nCuota    = (#103#8 / enConversor) ! EURODBMOD;
                 nGrupo    = 0;
                 nSubGrupo = 0;
                 nSwPasa   = 1;
                 |HAZ PonCasilla;
             |FINSI;
         |FINSI;
     |SINO;
         |SI #30#0 > 800; |Y #30#0 < 900; |Y nEjerCobro = 0;
             nSwPasa = 1; |HAZ GrupoSubvencion;
         |FINSI;
     |FINSI;

     |SI nSwPasa = 1;
         nSwPasaCab = 1;
     |FINSI;
|FPRC;

|DEFBUCLE caivalin;
     #103#1;
     ;
     #102#0, #102#1, 01;
     #102#0, #102#1, 99;
     ;
     NULL, LeeLinea;
|FIN;

|PROCESO LeeCabecera;
     #107#0 = #102#0;
     |LEE 000#107=;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;

     nDepar = #102#10;
     |SI aMulDep ! "S";
         |SI nDepar = 0;  nDepar = 1;   |FINSI;
     |FINSI;

     |ABRE #214;
     #214#0 = #999#0;
     #214#1 = nDepar;
     |LEE 040#214=;
     |SI FSalida ! 0;  nDepar = 1;  |FINSI;
     |CIERRA #214;

     aClvPais = "";

     |ABRE #caerpnif;
     #caerpnif#0 = #camaniva#0;
     #caerpnif#1 = #camaniva#1;
     |LEE 000#caerpnif.=;
     |SI FSalida = 0;
         aClvPais = #caerpnif#4;
     |FINSI;
     |CIERRA #caerpnif;

     nSw105 = 0;
     |ABRE #105;
     |DDEFECTO #105;
     #105#0 = #102#0;
     #105#1 = #102#1;
     |LEE 040#105=;
     |SI FSalida = 0;
         nSw105 = 1;
         |SI #105#8 = 1; nSw105 = 0; |FINSI;
     |FINSI;
     |CIERRA #105;

|SI nEjerCobro = 0;
     enSwCaja = 0
     nHayCaja = 0
     |SI enEjer ] 2014; |Y #102#36 ! "N";

         |SI #102#42 = "Z"; |O #102#42 = "1"; |O #102#42 = "2";
             |O #102#42 = "3"; |O #102#42 = "4"; |O #102#42 = "5";
             |O #102#42 = "6"; |O #102#42 = "7"; |O #102#42 = "8";
                enSwCaja = 1;
         |FINSI;

         |SI enSwCaja = 1;
             |ABRE #501;
             |DDEFECTO #501;
             #501#17 = nEjerCobro;
             #501#0  = #102#0;
             #501#1  = #102#1;
             |LEE 040#501=;
             |SI FSalida ! 0;  enSwCaja = 0;  |FINSI;
             |CIERRA #501;
         |FINSI;
    |FINSI;
|FINSI;

     nSwISP = 0;
     nDepartamento = nDepar;

     |SI #102#40 = nHPeriodo;  |O #102#40 = 0;  |O enSwCaja = 1;
         |SI nEl340 = 1;
             aFichero = ("35" + Usuario + "zzzzzzzz") % 108;
             |NOME_DAT #935 aFichero;
             |ABRE #935;  |CIERRA #935;  |DELINDEX #935;

             |ABRE #935;

             nSw = 0; |BUCLE VariosCon;
         |FINSI;
     |FINSI;

     nSwPasaCab = 0;
     nVarios1 = 0;
     nVarios2 = 0;
     |BUCLE caivalin;
     |SI nSwPasaCab = 1; nSwPasa = 1; |FINSI;

     |SI #102#40 = nHPeriodo;  |O #102#40 = 0; |O enSwCaja = 1;
         |SI nEl340 = 1;
             |CIERRA #935;
         |FINSI;
     |FINSI;

     |SI #999#1 ! nDepartamento;
         |SI nEl340 = 1;  |DELINDEX #935;  |FINSI;

         |ACABA;
     |FINSI;

     |SI nSwPasa = 0;
         |SI nEl340 = 1;  |DELINDEX #935;  |FINSI;

         |ACABA;
     |FINSI;

     |SI #102#40 = nHPeriodo;  |O #102#40 = 0;  |O enSwCaja = 1;
         |SI nEl340 = 1;
             |HAZ Graba340;
         |FINSI;
     |FINSI;

     |SI #102#40 = 0;
         #102#40 = nHPeriodo;
     |FINSI;

     |SI nEl340 = 1;  |DELINDEX #935;  |FINSI;

     |SI nEjerCobro = 0;
        |GRABA 020#102a;
     |FINSI;
     |LIBERA #102;

     |SI enSwCaja = 1;

         nOpCaja = 2;  |BUCLE LosCobros;

         |ABRE #501;
         |DDEFECTO #501;
         #501#17 = nEjerCobro;
         #501#0 = #102#0;
         #501#1 = #102#1;
         |LEE 040#501=;
         |SI FSalida = 0;
             |SI #501#8 = 0; |Y nEl340 = 1;
                 #501#8 = nHPeriodo;
                 #501#9 = enEjer;
             |FINSI;
             |SI nHayCaja = 1;
                 |SI #501#11 < enEjer;
                     #501#10 = nHPeriodo;
                     #501#11 = enEjer;
                 |SINO;
                     |SI #501#11 = enEjer; |Y #501#10 < nHPeriodo;
                         #501#10 = nHPeriodo;
                         #501#11 = enEjer;
                     |FINSI;
                 |FINSI;
             |FINSI;
             |GRABA 020#501a;
         |FINSI;
         |CIERRA #501;
     |FINSI;
|FPRC;

|DEFBUCLE camaniva;
     #102#1;
     5;
     00, 0000000000, nDPeriodo;
     99, 9999999999, nHPeriodo;
     be;
     NULL, LeeCabecera;
|FIN;

|PROCESO Lee501_2014;
   ePerioCaja = #501#18;
   |HAZ ePathCaja;
   |PATH_DAT #102 ePathCaja;
   |PATH_DAT #103 ePathCaja;
   |PATH_DAT #104 ePathCaja;
   |PATH_DAT #105 ePathCaja;
   |PATH_DAT #106 ePathCaja;
   |PATH_DAT #107 ePathCaja;
   |PATH_DAT #caerpnif#ePathCaja#;

   nHayCaja   = 1;
   enSwCaja   = 1;
   eDevenCaja = #501#17;

   |ABRE #102;
   #102#0 = #501#0;
   #102#1 = #501#1;
   |LEE 041#102=;
   |SI FSalida = 0;
       |HAZ LeeCabecera;
   |FINSI;

   |CIERRA #102;
|FPRC;

|DEFBUCLE Lee501_2014;
   #501#1;
   ;
   nEjerCobro, 01, 0000000001;
   nEjerCobro, 99, 9999999999;
   e;
   NULL, Lee501_2014;
|FIN;

|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
|PROCESO dsmom065;

  |SI #65#11 ! 0;

     nDepar = #65#4;  ||Actividad

     |ABRE #214;
     #214#0 = #999#0;
     #214#1 = nDepar;
     |LEE 040#214=;
     |SI FSalida ! 0;  nDepar = 1;  |FINSI;
     |CIERRA #214;

     |DDEFECTO #107;
     |DDEFECTO #105;
     |DDEFECTO #102;  ||para utilizar los mismos ficheros que en contabilidad
     |DDEFECTO #103;

     #103#3  = #65#11; ||Concepto
     #103#4  = #65#12; ||Descripcion concepto
     #103#6  = #65#8;  ||Base de la Factura;
     #103#7  = #65#9;  ||% de IVA
     #103#8  = #65#10; ||Cuota IVA
     #103#9  = #65#14; ||Recargo
     #103#10 = #65#15; ||Cuota Rec
     nDepartamento = nDepar;

     nVarios1 = 0;
     nVarios2 = 0;

     nSwPasa = 0;
     #30#0 = #103#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #30#4 = "N";  |ACABA;  |FINSI;

     |SI #30#74 = "N";
         |SI #30#26 ! 0; nSwPasa = 1;  |HAZ Grupo1;  |FINSI;
         |SI #30#28 ! 0; nSwPasa = 1;  |HAZ Grupo2;  |FINSI;
         |SI #30#30 ! 0; nSwPasa = 1;  |HAZ Grupo3;  |FINSI;
         |SI #30#32 ! 0; nSwPasa = 1;  |HAZ Grupo4;  |FINSI;
         |SI #30#34 ! 0; nSwPasa = 1;  |HAZ Grupo5;  |FINSI;
         |SI #30#36 ! 0; nSwPasa = 1;  |HAZ Grupo6;  |FINSI;
     |SINO;
         |SI #30#0 > 800; |Y #30#0 < 900;
             nSwPasa = 1; |HAZ GrupoSubvencion;
         |FINSI;
     |FINSI;

  |FINSI;
  |LIBERA #65;
|FPRC;

|DEFBUCLE dsmom065;
     #65#1;
     ;
     #999#0, #999#2, nDPeriodo, #999#9, #999#1, 0001;
     #999#0, #999#2, nDPeriodo, #999#9, #999#1, 9999;
     be;
     NULL, dsmom065;
|FIN;

|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

|| /////////////////////////////////////////////////////////////////////
|PROCESO Compensa87;
  |SI #1300#7 = 0; |ACABA; |FINSI;
  |SI #1300#7 > 7;  |Y #1300#7 < 13; |ACABA; |FINSI;
  |SI #1300#7 ] 16; |Y #1300#7 [ 17; |ACABA; |FINSI;

  |SI nSwOp = 1;
      #1387#0 = #1300#0;
      #1387#1 = #1300#1;
      #1387#2 = #1300#2;
      #1387#3 = #1300#3;
      #1387#4 = #1300#4;
      #1387#5 = #1300#5;
      #1387#6 = #1300#6;
      #1387#7 = #1300#7;
      |LEE 000#1387=;
      |SI FSalida ! 0;
          |DDEFECTO #1387;
      |FINSI;

      #87#0 = #300#0;
      #87#1 = #300#1;
      #87#2 = #300#2;
      #87#3 = #300#3;
      #87#4 = #300#4;
      #87#5 = #300#5;
      #87#6 = #300#6;
      #87#7 = #300#7;
      |LEE 141#87=;
      |SI FSalida ! 0;
          |DDEFECTO #87;
          #87#0 = #300#0;
          #87#1 = #300#1;
          #87#2 = #300#2;
          #87#3 = #300#3;
          #87#4 = #300#4;
          #87#5 = #300#5;
          #87#6 = #300#6;
          #87#7 = #300#7;
          |GRABA 020#87b;
      |FINSI;
  |FINSI;

  |SI nSwOp = 2;
      nNume1 = ((nCampo33 - 16) / 3) * 2 + 40;
      nNume2 = ((nCampo3 - 16) / 3) * 2 + 40;
      #87nCampo33 = #87nCampo33 - #1387nCampo3;  ||de la actividad
      #87nNume1   = #87nNume1   - #1387nNume2;   ||comun
  |FINSI;
  |SI nSwOp = 3;
      |GRABA 020#87a;
      |LIBERA #87;
  |FINSI;
|FPRC;

|PROCESO Compensa300;
     |SI #1300#6 = 5;  |ACABA;  |FINSI;

     #300#0 = #1300#0;
     #300#1 = #1300#1;
     #300#2 = #1300#2;
     #300#3 = #1300#3;
     #300#4 = #1300#4 + 1;
     #300#5 = #1300#5;
     #300#6 = #1300#6;
     #300#7 = #1300#7;
     |LEE 000#300=;
     |SI FSalida = 0; |ACABA;  |FINSI;

     |SI #1300#6 = 3; |Y #1300#7 = 4; |Y #1300#1 = 2014;
         |SI #1300#12 ! 0; |Y #1300#14 = 0;
             #1300#14 = #1300#12;
         |FINSI;
     |FINSI;

     |DDEFECTO #300;

     #300#0 = #1300#0;
     #300#1 = #999#2;
     #300#2 = #999#3;
     #300#3 = #999#7;
     #300#4 = #999#9;
     #300#5 = #1300#5;
     #300#6 = #1300#6;
     #300#7 = #1300#7;
     |LEE 101#300=;
     |SI FSalida = 0;
||         |SI #1300#6 = 2; |HAZ Cal_dsmocivp; |FINSI;
         |SI nCompensar = 1; |Y #1300#6 = 2;
             nSwOp = 1; |HAZ Compensa87;
         |FINSI;

         |SI #300#15 = 0;  |Y #300#18 = 0;  |Y #300#21 = 0;  |Y #300#24 = 0;
          |Y #300#27 = 0;  |Y #300#30 = 0;  |Y #300#33 = 0;
             #300#15 = #1300#15;
             #300#18 = #1300#18;
             #300#21 = #1300#21;
             #300#24 = #1300#24;
             #300#27 = #1300#27;
             #300#30 = #1300#30;
             #300#33 = #1300#33;
         |FINSI;

         |SI #300#36 = 0;  |Y #300#39 = 0;  |Y #300#42 = 0;  |Y #300#45 = 0;
          |Y #300#48 = 0;  |Y #300#51 = 0;  |Y #300#54 = 0;
             #300#36 = #1300#36;
             #300#39 = #1300#39;
             #300#42 = #1300#42;
             #300#45 = #1300#45;
             #300#48 = #1300#48;
             #300#51 = #1300#51;
             #300#54 = #1300#54;
         |FINSI;

         nSwUno = 0;
         |SI #1300#12 ! 0;  |Y #1300#14 = 0;  |Y #1300#17 = 0;  |Y #1300#20 = 0;  |Y #1300#23 = 0;
          |Y #1300#26 = 0;  |Y #1300#29 = 0;  |Y #1300#32 = 0;
          |Y #1300#35 = 0;  |Y #1300#38 = 0;  |Y #1300#41 = 0;  |Y #1300#44 = 0;
          |Y #1300#47 = 0;  |Y #1300#50 = 0;  |Y #1300#53 = 0;
             nSwUno = 1;
         |FINSI;
         |SI #300#12 ! 0;  |Y #300#14 = 0;  |Y #300#17 = 0;  |Y #300#20 = 0;  |Y #1300#23 = 0;
          |Y #300#26 = 0;  |Y #300#29 = 0;  |Y #300#32 = 0;
          |Y #300#35 = 0;  |Y #300#38 = 0;  |Y #300#41 = 0;  |Y #300#44 = 0;
          |Y #300#47 = 0;  |Y #300#50 = 0;  |Y #300#53 = 0;
             nSwUno = 1;
         |FINSI;

         |SI nSwUno = 1;
             #300#12 = #300#12 - #1300#12;
         |SINO;
             |PARA nCampo2 = 15;  |SI nCampo2 [ 33;  |HACIENDO nCampo2 = nCampo2 + 3;
                   nCampo1     = nCampo2 - 1;
                   nCampo3     = nCampo2 + 1;
                   nCompensado = 0;
                   |PARA nCampo22 = 15;  |SI nCampo22 [ 33;  |HACIENDO nCampo22 = nCampo22 + 3;
                         nCampo11 = nCampo22 - 1;
                         nCampo33 = nCampo22 + 1;
                         |SI #300nCampo22 = #1300nCampo2;
                             #300nCampo11 = #300nCampo11 - #1300nCampo1;
                             #300nCampo33 = #300nCampo33 - #1300nCampo3;
                             nCompensado = 1;
                             |SAL;
                         |FINSI;
                    |SIGUE;

                    |SI nCompensado = 0;
                        |SI #300#14 = 0;  |Y #300#15 = 0;  |Y #300#16 = 0;
                            #300#14     = #300#14 - #1300nCampo1;
                            #300#15     = #1300nCampo2;
                            #300#16     = #300#16 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 16;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#17 = 0;  |Y #300#18 = 0;  |Y #300#19 = 0;
                            #300#17     = #300#17 - #1300nCampo1;
                            #300#18     = #1300nCampo2;
                            #300#19     = #300#19 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 19;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#20 = 0;  |Y #300#21 = 0;  |Y #300#22 = 0;
                            #300#20     = #300#20 - #1300nCampo1;
                            #300#21     = #1300nCampo2;
                            #300#22     = #300#22 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 22;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#23 = 0;  |Y #300#24 = 0;  |Y #300#25 = 0;
                            #300#23     = #300#23 - #1300nCampo1;
                            #300#24     = #1300nCampo2;
                            #300#25     = #300#25 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 25;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#26 = 0;  |Y #300#27 = 0;  |Y #300#28 = 0;
                            #300#26     = #300#26 - #1300nCampo1;
                            #300#27     = #1300nCampo2;
                            #300#28     = #300#28 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 28;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#29 = 0;  |Y #300#30 = 0;  |Y #300#31 = 0;
                            #300#29     = #300#29 - #1300nCampo1;
                            #300#30     = #1300nCampo2;
                            #300#31     = #300#31 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 31;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#32 = 0;  |Y #300#33 = 0;  |Y #300#34 = 0;
                            #300#32     = #300#32 - #1300nCampo1;
                            #300#33     = #1300nCampo2;
                            #300#34     = #300#34 - #1300nCampo3;
                            nCompensado = 1; nCampo33 = 34;
                        |FINSI;
                    |FINSI;
                    |SI nCompensar = 1; |Y #1300#6 = 2;
                        nSwOp = 2; |HAZ Compensa87;
                    |FINSI;
             |SIGUE;
             |SI nCompensar = 1; |Y #1300#6 = 2;
                  nSwOp = 3; |HAZ Compensa87;
             |FINSI;

             |PARA nCampo2 = 36;  |SI nCampo2 [ 54;  |HACIENDO nCampo2 = nCampo2 + 3;
                   nCampo1     = nCampo2 - 1;
                   nCampo3     = nCampo2 + 1;
                   nCompensado = 0;
                   |PARA nCampo22 = 36;  |SI nCampo22 [ 54;  |HACIENDO nCampo22 = nCampo22 + 3;
                         nCampo11 = nCampo22 - 1;
                         nCampo33 = nCampo22 + 1;
                         |SI #300nCampo22 = #1300nCampo2;
                             #300nCampo11 = #300nCampo11 - #1300nCampo1;
                             #300nCampo33 = #300nCampo33 - #1300nCampo3;
                             nCompensado = 1;
                             |SAL;
                         |FINSI;
                    |SIGUE;

                    |SI nCompensado = 0;
                        |SI #300#35 = 0;  |Y #300#36 = 0;  |Y #300#37 = 0;
                            #300#35     = #300#35 - #1300nCampo1;
                            #300#36     = #1300nCampo2;
                            #300#37     = #300#37 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#38 = 0;  |Y #300#39 = 0;  |Y #300#40 = 0;
                            #300#38     = #300#38 - #1300nCampo1;
                            #300#39     = #1300nCampo2;
                            #300#40     = #300#40 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#41 = 0;  |Y #300#42 = 0;  |Y #300#43 = 0;
                            #300#41     = #300#41 - #1300nCampo1;
                            #300#42     = #1300nCampo2;
                            #300#43     = #300#43 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#44 = 0;  |Y #300#45 = 0;  |Y #300#46 = 0;
                            #300#44     = #300#44 - #1300nCampo1;
                            #300#45     = #1300nCampo2;
                            #300#46     = #300#46 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#47 = 0;  |Y #300#48 = 0;  |Y #300#49 = 0;
                            #300#47     = #300#47 - #1300nCampo1;
                            #300#48     = #1300nCampo2;
                            #300#49     = #300#49 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#50 = 0;  |Y #300#51 = 0;  |Y #300#52 = 0;
                            #300#50     = #300#50 - #1300nCampo1;
                            #300#51     = #1300nCampo2;
                            #300#52     = #300#52 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;

                    |SI nCompensado = 0;
                        |SI #300#53 = 0;  |Y #300#54 = 0;  |Y #300#55 = 0;
                            #300#53     = #300#53 - #1300nCampo1;
                            #300#54     = #1300nCampo2;
                            #300#55     = #300#55 - #1300nCampo3;
                            nCompensado = 1;
                        |FINSI;
                    |FINSI;
             |SIGUE;

             #300#12 = #300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32;
             #300#12 = #300#12 + #300#35 + #300#38 + #300#41 + #300#44 + #300#47 + #300#50 + #300#53;
             #300#13 = #300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34;
             #300#13 = #300#13 + #300#37 + #300#40 + #300#43 + #300#46 + #300#49 + #300#52 + #300#55;
         |FINSI;

         |SI #300#6 = 1;  |Y #300#7 = 5;
             nBClaveA = (nBClaveA) - #1300#12;
             nCClaveA = (nCClaveA) - #1300#13;
         |FINSI;

         |SI #300#6 = 1;  |Y #300#7 = 6; |Y #300#1 < 2014;
             nBClaveI = nBClaveI - (#1300#35 + #1300#38 + #1300#41 + #1300#44 + #1300#47 + #1300#50 + #1300#53);
             nCClaveI = nCClaveI - (#1300#37 + #1300#40 + #1300#43 + #1300#46 + #1300#49 + #1300#52 + #1300#55);
         |FINSI;

         |SI #300#6 = 1;  |Y #300#7 = 15; |Y #300#1 ] 2014;
             nBClaveI = nBClaveI - #1300#12;
             nCClaveI = nCClaveI - #1300#13;
         |FINSI;

         |SI #300#6 = 1;  |Y #300#7 = 19; |Y #300#1 ] 2015;
             nBClaveR = nBClaveR - #1300#12;
             nCClaveR = nCClaveR - #1300#13;
         |FINSI;

         |SI #300#6 = 3;  |Y #300#7 = 9;
             nBClaveE = nBClaveE - #1300#12;
             nCClaveE = nCClaveE - #1300#13;
         |FINSI;

         |SI #300#6 = 3;  |Y #300#7 = 4;
             |SI enEjer < 2012;
                 nBClaveS = nBClaveS - #1300#12;
                 nCClaveS = nCClaveS - #1300#13;
             |SINO;
                 |SI #300#1 < 2014;
                     nBClaveS = nBClaveS - #1300#35;
                     nCClaveS = nCClaveS - #1300#37;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI #300#6 = 3;  |Y #300#7 = 16;
             nBClaveS = nBClaveS - #1300#12;
             nCClaveS = nCClaveS - #1300#13;
         |FINSI;

         |GRABA 020#300a;
         |LIBERA #300;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc322;
     #1300#1008;
     ;
     #999#0, #999#2, nPeriodo, nModBucle, 00, #999#1, 1, 00;
     #999#0, #999#2, nPeriodo, nModBucle, 99, #999#1, 9, 99;
     ;
     NULL, Compensa300;
|FIN;

|PROCESO camaasil340;
     nDepar = #camaasil#21;
     |SI nDepar = 0;  nDepar = 1;  |FINSI;

     |SI nDepar ! enActividad;  |ACABA;  |FINSI;

     #30#0 = #camaasil#6;
     |LEE 000#30=;
     |SI FSalida ! 0;   |ACABA;  |FINSI;
     |SI #30#7  ! "S";  |ACABA;  |FINSI;
     |SI #30#51 = "X";  |ACABA;  |FINSI;

     #106#23 = "C";
     #106#10 = #camaasil#4;
     |LEE 000#106=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nDevengo    = #0#3;

     #camanefe#0 = #camaasil#0;
     #camanefe#1 = #camaasil#1;
     #camanefe#2 = #camaasil#2;
     #camanefe#3 = #camaasil#3;
     |LEE 000#camanefe.=;
     |SI FSalida = 0;
         nDevengo    = #camanefe#4;
     |FINSI;

     #913#0 = #106#9;
     #913#1 = nDevengo;
     |LEE 101#913=;
     |SI FSalida ! 0;
         |DDEFECTO #913;
         #913#0 = #106#9;
         #913#1 = nDevengo;
         #913#4 = #106#1;
         |GRABA 020#913b;
     |FINSI;

     |SI #camaasil#8 = "D";
         #913#2 = #913#2 - #camaasil#9;
     |SINO;
         #913#2 = #913#2 + #camaasil#9;
     |FINSI;

     |SI #camaasil#1 ] aDFecha;
         #913#3 = "S";
     |FINSI;

     #913#6 = #caerpnif#4;

     |GRABA 020#913a;
     |LIBERA #913;
|FPRC;

|DEFBUCLE camaasil340;
     #camaasil#1;
     ;
     01, "01.01.0000",  000001, 0001;
     98,      aHFecha,  999999, 9999;
     ;
     NULL, camaasil340;
|FIN;

|PROCESO dsmow204Cobros;
 || Habr un cambio a raiz de esto para una vez que el pase del 347 del 2012
 || est realizado ya que para el 2013 un cobro devengado en el 2012 se le
 || tendr de informar de todos los cobros del 2012. Ahora en el 2012 no pasa
 || nada ya que no se puede devengar nada del ao anterior.

     |SI #913#1 < 2012;  |ACABA;  |FINSI;
     |SI #913#1 > #0#3;  |ACABA;  |FINSI;
     |SI #913#3 = "N";   |ACABA;  |FINSI;
     |SI #913#2 < 6000;  |ACABA;  |FINSI;

     |ABRE #342;
     |SELECT #1#342;
     #342#0  = enEmpresa;
     #342#1  = enEjer;
     #342#2  = enPeriodo;
     #342#3  = 340;
     #342#4  = enComplem;
     #342#5  = enActividad;
     #342#6  = 999999;
     |LEE 000#342];
     |SI FSalida = 0;
         |LEE 000#342a;
     |SINO;
         |LEE 000#342u;
     |FINSI;

     nReg = 1;
     |SI FSalida = 0;  |Y #342#0  = enEmpresa; |Y #342#1  = enEjer;
                       |Y #342#2  = enPeriodo; |Y #342#3  = 340;
                       |Y #342#4  = enComplem; |Y #342#5  = enActividad;
         nReg = #342#6 + 1;
     |FINSI;

     eaCodNif  = #913#0;   |QBF eaCodNif;
     enCalcCif = 1;
     |HAZ LeeNifs;
     |QBF eaCodNif;

     |SI eaCodNif = "";
         |ABRE #106;
         #106#23 = "C";
         #106#10 = #913#0;
         |LEE 000#106=;
         |SI FSalida ! 0;  |DDEFECTO #106;  |FINSI;
         |CIERRA #106;

         aPais   = #106#24;
         aNombre = #106#1;  |QBF aNombre;
     |SINO;
         aPais   = #709#12;
         aNombre = #709#1;  |QBF aNombre;
     |FINSI;

     |SI aNombre = "";  aNombre = #913#4;  |FINSI;

     |DDEFECTO #342;
     #342#0  = enEmpresa;
     #342#1  = enEjer;
     #342#2  = enPeriodo;
     #342#3  = 340;
     #342#4  = enComplem;
     #342#5  = enActividad;
     #342#6  = nReg;
     #342#9 = aNombre;
     #342#10 = aPais;
     |SI #342#10 = "   ";
         #342#10 = "ES";
     |FINSI;

     #342#13 = "";
     #342#14 = aHFecha;
     #342#15 = "01.01.0000";

     nChequeaNif = 1;

     |SI #342#10 ! "ES ";
         aAlfa   = #342#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

                            #342#11 = "6";
         |SI aAlfa = "DE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "AT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "BE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "BG";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "CY";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "DK";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SI";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "EE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "FI";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "FR";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "EL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "GB";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "NL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "HU";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "IT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "IE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LV";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LU";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "MT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "PL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "PT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "CZ";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SK";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "RO";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "HR";  #342#11 = "2";  |FINSI;

         #342#12 = aAlfa + #913#0;
         nChequeaNif = 0;
     |FINSI;

     |SI #935#0 = "3";  |Y #935#7 = 9;
         aAlfa   = #342#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #342#12 = aAlfa + #913#0;
         #342#11 = "2";
         nChequeaNif = 0;
     |FINSI;

     |SI #935#0 = "3";  |Y #935#7 = 10;
         aAlfa   = #342#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #342#12 = aAlfa + #913#0;

                          #342#11 = "4";
         aAlfa   = #913#0;   |QBF aAlfa;
         |SI aAlfa = "";  #342#11 = "6";  |FINSI;
         nChequeaNif = 0;
     |FINSI;

     aAlfa   = #913#0;   |QBF aAlfa;
     |SI aAlfa = ""; #342#12 = ""; |FINSI;

     aClaveOp = #342#13;
     aNombre  = #342#9;

     #342#32  = #913#2;
     #342#33  = #913#1;

     |HAZ Errores340;

     #342#7  = eaVarDni;

     aAlfa = #342#7 % 101;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         #342#11 = "4";
     |FINSI;

     |SI #913#6 ! " ";
         #342#11 = #913#6;
     |FINSI;

     |GRABA 020#342n;
     |LIBERA #342;

     |CIERRA #342;
|FPRC;

|DEFBUCLE dsmow204Cobros;
     #913#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsmow204Cobros;
|FIN;

|PROCESO Cobros;
     |PATH_DAT #camaasil#aPathConta#;
     |PATH_DAT #camanefe#aPathConta#;

     |SI #4#22 = "T";
         |SI #0#1 = 1;   aDFecha = "01.01." + #0#3;  aHFecha = "31.03." + #0#3;  |FINSI;
         |SI #0#1 = 2;   aDFecha = "01.01." + #0#3;  aHFecha = "31.03." + #0#3;  |FINSI;
         |SI #0#1 = 3;   aDFecha = "01.01." + #0#3;  aHFecha = "31.03." + #0#3;  |FINSI;
         |SI #0#1 = 4;   aDFecha = "01.04." + #0#3;  aHFecha = "30.06." + #0#3;  |FINSI;
         |SI #0#1 = 5;   aDFecha = "01.04." + #0#3;  aHFecha = "30.06." + #0#3;  |FINSI;
         |SI #0#1 = 6;   aDFecha = "01.04." + #0#3;  aHFecha = "30.06." + #0#3;  |FINSI;
         |SI #0#1 = 7;   aDFecha = "01.07." + #0#3;  aHFecha = "30.09." + #0#3;  |FINSI;
         |SI #0#1 = 8;   aDFecha = "01.07." + #0#3;  aHFecha = "30.09." + #0#3;  |FINSI;
         |SI #0#1 = 9;   aDFecha = "01.07." + #0#3;  aHFecha = "30.09." + #0#3;  |FINSI;
         |SI #0#1 = 10;  aDFecha = "01.10." + #0#3;  aHFecha = "31.12." + #0#3;  |FINSI;
         |SI #0#1 = 11;  aDFecha = "01.10." + #0#3;  aHFecha = "31.12." + #0#3;  |FINSI;
         |SI #0#1 = 12;  aDFecha = "01.10." + #0#3;  aHFecha = "31.12." + #0#3;  |FINSI;
     |SINO;
         |SI #0#1 = 1;   aDFecha = "01.01." + #0#3;  aHFecha = "31.01." + #0#3;  |FINSI;
         |SI #0#1 = 2;   aDFecha = "01.02." + #0#3;  aHFecha = "29.02." + #0#3;  |FINSI;
         |SI #0#1 = 3;   aDFecha = "01.03." + #0#3;  aHFecha = "31.03." + #0#3;  |FINSI;
         |SI #0#1 = 4;   aDFecha = "01.04." + #0#3;  aHFecha = "30.04." + #0#3;  |FINSI;
         |SI #0#1 = 5;   aDFecha = "01.05." + #0#3;  aHFecha = "31.05." + #0#3;  |FINSI;
         |SI #0#1 = 6;   aDFecha = "01.06." + #0#3;  aHFecha = "30.06." + #0#3;  |FINSI;
         |SI #0#1 = 7;   aDFecha = "01.07." + #0#3;  aHFecha = "31.07." + #0#3;  |FINSI;
         |SI #0#1 = 8;   aDFecha = "01.08." + #0#3;  aHFecha = "31.08." + #0#3;  |FINSI;
         |SI #0#1 = 9;   aDFecha = "01.09." + #0#3;  aHFecha = "30.09." + #0#3;  |FINSI;
         |SI #0#1 = 10;  aDFecha = "01.10." + #0#3;  aHFecha = "31.10." + #0#3;  |FINSI;
         |SI #0#1 = 11;  aDFecha = "01.11." + #0#3;  aHFecha = "30.11." + #0#3;  |FINSI;
         |SI #0#1 = 12;  aDFecha = "01.12." + #0#3;  aHFecha = "31.12." + #0#3;  |FINSI;
     |FINSI;

     aFichero = ("47" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #913 aFichero;
     |ABRE #913;  |CIERRA #913;  |DELINDEX #913;

     |ABRE #30;
     |ABRE #dsmom069;
     |ABRE #106;
     |ABRE #913;
     |ABRE #camanefe;

     |BUCLE camaasil340;

     |CIERRA #camanefe;
     |CIERRA #106;
     |CIERRA #30;
     |CIERRA #dsmom069;
     |CIERRA #913;

     |BUCLE dsmow204Cobros;

     |DELINDEX #913;
|FPRC;

|PROCESO dsmow204Trans;   || Transmisiones inmuebles
     |SI #913#3 = "N";   |ACABA;  |FINSI;

     |ABRE #342;
     |SELECT #1#342;
     #342#0  = enEmpresa;
     #342#1  = enEjer;
     #342#2  = enPeriodo;
     #342#3  = 340;
     #342#4  = enComplem;
     #342#5  = enActividad;
     #342#6  = 999999;
     |LEE 000#342];
     |SI FSalida = 0;
         |LEE 000#342a;
     |SINO;
         |LEE 000#342u;
     |FINSI;

     nReg = 1;
     |SI FSalida = 0;  |Y #342#0  = enEmpresa; |Y #342#1  = enEjer;
                       |Y #342#2  = enPeriodo; |Y #342#3  = 340;
                       |Y #342#4  = enComplem; |Y #342#5  = enActividad;
         nReg = #342#6 + 1;
     |FINSI;

     eaCodNif  = #913#0;   |QBF eaCodNif;
     enCalcCif = 1;
     |HAZ LeeNifs;
     |QBF eaCodNif;

     |SI eaCodNif = "";
         |ABRE #106;
         #106#23 = "C";
         #106#10 = #913#0;
         |LEE 000#106=;
         |SI FSalida ! 0;  |DDEFECTO #106;  |FINSI;
         |CIERRA #106;

         aPais   = #106#24;
         aNombre = #106#1;  |QBF aNombre;
     |SINO;
         aPais   = #709#12;
         aNombre = #709#1;  |QBF aNombre;
     |FINSI;

     |SI aNombre = "";  aNombre = #913#4;  |FINSI;

     |DDEFECTO #342;
     #342#0  = enEmpresa;
     #342#1  = enEjer;
     #342#2  = enPeriodo;
     #342#3  = 340;
     #342#4  = enComplem;
     #342#5  = enActividad;
     #342#6  = nReg;
     #342#9 = aNombre;
     #342#10 = aPais;
     |SI #342#10 = "   ";
         #342#10 = "ES";
     |FINSI;

     #342#13 = "";
     #342#14 = #913#5;
     #342#15 = "01.01.0000";

     nChequeaNif = 1;

     |SI #342#10 ! "ES ";
         aAlfa   = #342#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

                            #342#11 = "6";
         |SI aAlfa = "DE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "AT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "BE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "BG";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "CY";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "DK";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SI";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "EE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "FI";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "FR";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "EL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "GB";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "NL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "HU";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "IT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "IE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LV";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LU";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "MT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "PL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "PT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "CZ";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SK";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "RO";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "HR";  #342#11 = "2";  |FINSI;

         #342#12 = aAlfa + #913#0;
         nChequeaNif = 0;

         aAlfa = #913#0; |QBF aAlfa;
         |SI aAlfa = ""; #342#12 = ""; |FINSI;
     |FINSI;

     aClaveOp = #342#13;
     aNombre  = #342#9;

     #342#34  = #913#2;

     |HAZ Errores340;

     #342#7  = eaVarDni;

     aAlfa = #342#7 % 101;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         #342#11 = "4";
     |FINSI;

     |SI #913#6 ! " ";
         #342#11 = #913#6;
     |FINSI;

     |GRABA 020#342n;
     |LIBERA #342;

     |CIERRA #342;
|FPRC;

|DEFBUCLE dsmow204Trans;
     #913#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsmow204Trans;
|FIN;

|PROCESO Contabilidad;
     |SI enPlanillas ! 0;
         |HAZ Pasem065;
         |ACABA;
     |FINSI;

     enEmpresa   = #999#0;
     enEjer      = #999#2;
     enSwOpPar   = 0;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         aAlfa = #999#2;
         aAlfa = aAlfa % -102;
         nEjer = aAlfa;

         |ABRE #101;
         |SELECT #4#101;
         #101#2  = #999#0;
         #101#26 = nEjer;
         |LEE 040#101=;
         |SI FSalida ! 0;  |CIERRA #101;  |ACABA;   |FINSI;
         |CIERRA #101;

         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #101#2) % -105) + #101#3 + "/";

         enEmpresa  = #101#2;
         enPerConta = #101#3;
         eaLaMonEmp = #101#28;
     |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
     |FINSI;
     |HAZ EnConversor;

     |SI enPeriodo = 12; |Y enEjer ] 2015;
         |SI enSwPartido = 0;
             enPeriodo = enPerConta;
             aAlfa     = (("00000" + enEmpresa) + enPerConta ) % -106;
             aAlfa     = ":contagen/camaccz4 canempr1 " + aAlfa + ";Pase";
             |SUB_EJECUTA_NP aAlfa;
             enPeriodo = #999#3;
         |SINO;
            |MENAV "    Ejercicio Partido en Contabilidad. Fras. RECC deben estar Liquidadas";
         |FINSI;
     |FINSI;

     |PATH_DAT #102 aPathConta;
     |PATH_DAT #103 aPathConta;
     |PATH_DAT #104 aPathConta;
     |PATH_DAT #105 aPathConta;
     |PATH_DAT #106 aPathConta;
     |PATH_DAT #107 aPathConta;
     |PATH_DAT #501 aPathConta;
     |PATH_DAT #502 aPathConta;
     |PATH_DAT #503 aPathConta;
     |PATH_DAT #caerpnif#aPathConta#;

     |ABRE #104;
     |LEE 040#104p;
     |SI FSalida ! 0;  |DDEFECTO #104;  |FINSI;
     |CIERRA #104;
     aMulDep = #104#132;

     |SI enEjer [ 2009;
         |SI #104#46 = "T";
             |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
         |SINO;
             |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
             |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
             |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
             |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
             |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
             |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
         |FINSI;
     |SINO;
         |SI #4#22 = "T";
             |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
             |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
             |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
         |SINO;
             |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 1;   |FINSI;
             |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 2;   |FINSI;
             |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
             |SI #0#1 = 4;   nDPeriodo = 1;  nHPeriodo = 4;   |FINSI;
             |SI #0#1 = 5;   nDPeriodo = 1;  nHPeriodo = 5;   |FINSI;
             |SI #0#1 = 6;   nDPeriodo = 1;  nHPeriodo = 6;   |FINSI;
             |SI #0#1 = 7;   nDPeriodo = 1;  nHPeriodo = 7;   |FINSI;
             |SI #0#1 = 8;   nDPeriodo = 1;  nHPeriodo = 8;   |FINSI;
             |SI #0#1 = 9;   nDPeriodo = 1;  nHPeriodo = 9;   |FINSI;
             |SI #0#1 = 10;  nDPeriodo = 1;  nHPeriodo = 10;  |FINSI;
             |SI #0#1 = 11;  nDPeriodo = 1;  nHPeriodo = 11;  |FINSI;
             |SI #0#1 = 12;  nDPeriodo = 1;  nHPeriodo = 12;  |FINSI;
         |FINSI;
     |FINSI;

     nBClaveR    = 0;
     nCClaveR    = 0;
     nBClaveA    = 0;
     nCClaveA    = 0;
     nBClaveI    = 0;
     nCClaveI    = 0;
     nBClaveE    = 0;
     nCClaveE    = 0;
     nBClaveS    = 0;
     nCClaveS    = 0;
     nPerIntra1  = 0;
     nPerIntra2  = 0;
     nPerIntra3  = 0;
     nPerIntra4  = 0;
     nPerIntra5  = 0;
     nPerIntra6  = 0;
     nPerIntra7  = 0;
     nPerIntra8  = 0;
     nPerIntra9  = 0;
     nPerIntra10 = 0;
     nPerIntra11 = 0;
     nPerIntra12 = 0;

     aFichero = ("47" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #913 aFichero;
     |ABRE #913;  |CIERRA #913;  |DELINDEX #913;

     nEjerCobro = 0;
     nCompensar = 0;
     |ABRE #87;
     |ABRE #30;
     |ABRE #dsmom069;
     |ABRE #107;
     |ABRE #913;
     |BUCLE camaniva;
     |CIERRA #107;

     |SI enEjer ] 2015;
         nEjerCobro = enEjer - 1;
         |BUCLE Lee501_2014;
     |FINSI;

     |CIERRA #dsmom069;
     |CIERRA #913;
     |CIERRA #30;
     |CIERRA #87;


     |BUCLE dsmow204Trans;

     |DELINDEX #913;

     |SI nEl340 = 1;
         |HAZ Cobros;
     |FINSI;

     |SI enSwPartido = 1;
         enSwOpPar   = 1;
         |HAZ FinalPartido;
     |FINSI;

     enSwCaja = 0;
     |SI #0#1 = 12;
         enEmpAmor = #999#0;
         enEjeAmor = #999#2;
         enDActAmor = #999#1;
         enHActAmor = #999#1;
         enImpRegul = 0;
         |SUB_EJECUTA_NP "dsmozp41;Calculo";
         |SI enImpRegul ! 0;
             nBaseImpo = 0;
             nPorce    = 0;
             nCuota    = enImpRegul;
             nGrupo    = 2;
             nSubGrupo = 9;
             #103#5    = "S";
             #102#40   = -1; || para que no pase 340
             nDepar    = #999#1;
             |HAZ PonCasilla;
         |FINSI;

         |SI nEl340 = 1;
             |HAZ PasarBienesInver;
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO Pasem065; ||nuevo pase apuntes datos agrupados
     enSwCaja    = 0;
     enConversor = 1;
     aMulDep     = "N";

     |SI #4#22 = "T";
         |SI #0#1 = 1;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #0#1 = 2;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #0#1 = 3;   nDPeriodo = 1;  nHPeriodo = 3;   |FINSI;
         |SI #0#1 = 4;   nDPeriodo = 4;  nHPeriodo = 6;   |FINSI;
         |SI #0#1 = 5;   nDPeriodo = 4;  nHPeriodo = 6;   |FINSI;
         |SI #0#1 = 6;   nDPeriodo = 4;  nHPeriodo = 6;   |FINSI;
         |SI #0#1 = 7;   nDPeriodo = 7;  nHPeriodo = 9;   |FINSI;
         |SI #0#1 = 8;   nDPeriodo = 7;  nHPeriodo = 9;   |FINSI;
         |SI #0#1 = 9;   nDPeriodo = 7;  nHPeriodo = 9;   |FINSI;
         |SI #0#1 = 10;  nDPeriodo = 10; nHPeriodo = 12;  |FINSI;
         |SI #0#1 = 11;  nDPeriodo = 10; nHPeriodo = 12;  |FINSI;
         |SI #0#1 = 12;  nDPeriodo = 10; nHPeriodo = 12;  |FINSI;
     |SINO;
         nDPeriodo = #0#1;  nHPeriodo = #0#1;
     |FINSI;

     nBClaveR    = 0;
     nCClaveR    = 0;
     nBClaveA    = 0;
     nCClaveA    = 0;
     nBClaveI    = 0;
     nCClaveI    = 0;
     nBClaveE    = 0;
     nCClaveE    = 0;
     nBClaveS    = 0;
     nCClaveS    = 0;
     nPerIntra1  = 0;
     nPerIntra2  = 0;
     nPerIntra3  = 0;
     nPerIntra4  = 0;
     nPerIntra5  = 0;
     nPerIntra6  = 0;
     nPerIntra7  = 0;
     nPerIntra8  = 0;
     nPerIntra9  = 0;
     nPerIntra10 = 0;
     nPerIntra11 = 0;
     nPerIntra12 = 0;

     |ABRE #87;
     |ABRE #30;
     |BUCLE dsmom065;
     |CIERRA #30;
     |CIERRA #87;

     |SI #0#1 = 12;
         enEmpAmor = #999#0;
         enEjeAmor = #999#2;
         enDActAmor = #999#1;
         enHActAmor = #999#1;
         enImpRegul = 0;
         |SUB_EJECUTA_NP "dsmozp41;Calculo";
         |SI enImpRegul ! 0;
             nBaseImpo = 0;
             nPorce    = 0;
             nCuota    = enImpRegul;
             nGrupo    = 2;
             nSubGrupo = 9;
             #103#5    = "S";
             #102#40   = -1; || para que no pase 340
             nDepar    = #999#1;
             |HAZ PonCasilla;
         |FINSI;
         |SI nEl340 = 1;
             |HAZ PasarBienesInver;
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO Anterior300;
     #300#0 = #1300#0;
     #300#1 = #1300#1;
     #300#2 = #1300#2;
     #300#3 = #1300#3;
     #300#4 = #1300#4 + 1;
     #300#5 = #1300#5;
     #300#6 = #1300#6;
     #300#7 = #1300#7;
     |LEE 000#300=;
     |SI FSalida = 0; |ACABA;  |FINSI;

     |DDEFECTO #300;

     #300#0 = #1300#0;
     #300#1 = #999#2;
     #300#2 = #999#3;
     #300#3 = #999#7;
     #300#4 = #999#9;
     #300#5 = #1300#5;
     #300#6 = #1300#6;
     #300#7 = #1300#7;
     |LEE 101#300=;
     |SI FSalida ! 0;
         |DDEFECTO #300;
         #300#0 = #1300#0;
         #300#1 = #999#2;
         #300#2 = #999#3;
         #300#3 = #999#7;
         #300#4 = #1300#4;
         #300#5 = #1300#5;
         #300#6 = #1300#6;
         #300#7 = #1300#7;
         |GRABA 020#300b;
     |FINSI;

     |PARA nCampo = 8;  |SI nCampo [ 55;  |HACIENDO nCampo = nCampo + 1;
           #300nCampo = #1300nCampo;
     |SIGUE;

     |GRABA 020#300a;
     |LIBERA #300;
|FPRC;

|DEFBUCLE dsmoc322300;
     #1300#1008;
     ;
     #999#0, nAnyo, nPeriodo, 300, 00, #999#1, 1, 00;
     #999#0, nAnyo, nPeriodo, 300, 99, #999#1, 9, 99;
     ;
     NULL, Anterior300;
|FIN;

|PROCESO PaseAnterior300;
     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/dsmoc322.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nAnyo = #999#2;
     |SI #999#3 = 3;
         nAnyo = #999#2 - 1;
         nPeriodo = 12;
     |SINO;
         nPeriodo = #999#3 - 3;
     |FINSI;

     |ABRE #300;
     |BUCLE dsmoc322300;
     |CIERRA #300;

     |DESCARGA_DEF #espejo1@;
|FPRC;

|PROCESO Anterior87;

     |SI enAnterior = 1;
         #87#0 = #1387#0;
         #87#1 = #1387#1;
         #87#2 = #1387#2;
         #87#3 = #1387#3;
         #87#4 = #1387#4 + 1;
         #87#5 = #1387#5;
         #87#6 = #1387#6;
         #87#7 = #1387#7;
         |LEE 000#87=;
         |SI FSalida = 0;  |ACABA; |FINSI;
     |FINSI;

     |DDEFECTO #87;
     #87#0 = #1387#0;
     #87#1 = #999#2;
     #87#2 = #999#3;
     #87#3 = #999#7;
     #87#4 = #999#9;
     #87#5 = #1387#5;
     #87#6 = #1387#6;
     #87#7 = #1387#7;
     |LEE 141#87=;
     |SI FSalida ! 0;
         |DDEFECTO #87;
         #87#0 = #1387#0;
         #87#1 = #999#2;
         #87#2 = #999#3;
         #87#3 = #999#7;
         #87#4 = #999#9;
         #87#5 = #1387#5;
         #87#6 = #1387#6;
         #87#7 = #1387#7;
         |GRABA 020#87b;
     |FINSI;

     |PARA nCampo = 8;  |SI nCampo [ 53;  |HACIENDO nCampo = nCampo + 1;
           #87nCampo = #1387nCampo;
     |SIGUE;

     |GRABA 020#87a;
     |LIBERA #87;
|FPRC;

|DEFBUCLE dsmoc32287;
     #1387#1008;
     ;
     #999#0, nAnyo, nPeriodo, 303, nDComplem, #999#1, 1, 00;
     #999#0, nAnyo, nPeriodo, 303, nHComplem, #999#1, 9, 99;
     ;
     NULL, Anterior87;
|FIN;

|PROCESO Anterior303;

     |SI enAnterior = 1;
         #300#0 = #1300#0;
         #300#1 = #1300#1;
         #300#2 = #1300#2;
         #300#3 = #1300#3;
         #300#4 = #1300#4 + 1;
         #300#5 = #1300#5;
         #300#6 = #1300#6;
         #300#7 = #1300#7;
         |LEE 000#300=;
         |SI FSalida = 0;  |ACABA; |FINSI;
     |FINSI;

     #300#0 = #1300#0;
     #300#1 = #999#2;
     #300#2 = #999#3;
     #300#3 = #999#7;
     #300#4 = #999#9;
     #300#5 = #1300#5;
     #300#6 = #1300#6;
     #300#7 = #1300#7;
     |LEE 101#300=;
     |SI FSalida ! 0;
         |DDEFECTO #300;
         #300#0 = #1300#0;
         #300#1 = #999#2;
         #300#2 = #999#3;
         #300#3 = #999#7;
         #300#4 = #999#9;
         #300#5 = #1300#5;
         #300#6 = #1300#6;
         #300#7 = #1300#7;
         |GRABA 020#300b;
     |FINSI;

     |PARA nCampo = 8;  |SI nCampo [ 55;  |HACIENDO nCampo = nCampo + 1;
           #300nCampo = #1300nCampo;
     |SIGUE;

     |GRABA 020#300a;
     |LIBERA #300;
|FPRC;

|DEFBUCLE dsmoc322303;
     #1300#1008;
     ;
     #999#0, nAnyo, nPeriodo, 303, nDComplem, #999#1, 1, 00;
     #999#0, nAnyo, nPeriodo, 303, nHComplem, #999#1, 9, 99;
     ;
     NULL, Anterior303;
|FIN;

|PROCESO PaseAnterior303;
     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/dsmoc322.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nAnyo = #999#2;

     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = 0;
     |LEE 101#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;

     |SI enAnterior = 1;
         nDComplem = 00;
         nHComplem = 99;
         |SI #4#22 = "T";
             |SI #999#3 = 3;
                 nAnyo = #999#2 - 1;
                 nPeriodo = 12;
             |SINO;
                 nPeriodo = #999#3 - 3;
             |FINSI;
         |SINO;
             |SI #999#3 = 1;
                 nAnyo = #999#2 - 1;
                 nPeriodo = 12;
             |SINO;
                 nPeriodo = #999#3 - 1;
             |FINSI;
         |FINSI;
     |SINO;
          nAnyo     = #999#2;
          nPeriodo  = #999#3;
          nDComplem = #999#9 - 1;
          nHComplem = nDComplem;
          |SI nDComplem < 0;
              |DESCARGA_DEF #espejo1@;
              |ACABA;
          |FINSI;
     |FINSI;

     |ABRE #300;
     |BUCLE dsmoc322303;
     |CIERRA #300;

     |DESCARGA_DEF #espejo1@;

     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/dsmom087.mas";
     |CARGA_DEF aDef, espejo2@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #87;
     |BUCLE dsmoc32287;
     |CIERRA #87;

     |DESCARGA_DEF #espejo2@;
|FPRC;

|PROCESO PaseContabilidad;
     |SI enActividad ! 99;
         |HAZ Contabilidad;
     |FINSI;

     |SI #999#3 ! 1; |Y enPlanillas = 0;

         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmoc322.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida = 0;

             |SI nCompensar = 1;
                 aDef = aPathModelo + "def/dsmom087.mas";
                 |CARGA_DEF aDef, espejo2@;
                 |SI FSalida ! 0; nCompensar = 0; |FINSI;
             |FINSI;
             |SI nCompensar = 1; |ABRE #espejo2@; |ABRE #87; |FINSI;

             |PARA nPeriodo = 1;  |SI nPeriodo < #999#3;  |HACIENDO nPeriodo = nPeriodo + 1;
                   enPerPro = -1;
                   |SI #999#7 = "300";  |O #999#7 = "303";  |O #999#7 = 370;
                       nModBucle = 300;  |BUCLE dsmoc322;
                       nModBucle = 303;  |BUCLE dsmoc322;
                       nModBucle = 370;  |BUCLE dsmoc322;
                   |SINO;
                       nModBucle = #999#7;  |BUCLE dsmoc322;
                   |FINSI;
             |SIGUE;

             |SI nCompensar = 1; |CIERRA #87; |CIERRA #espejo2@; |DESCARGA_DEF #espejo2@; |FINSI;

         |FINSI;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     |SI enEjer > 2010;
         |ABRE #300;
         |BUCLE TrataTotal87;
         |CIERRA #300;
     |FINSI;
|FPRC;

|PROCESO Calcu349_303;
     |SI #349#6 = "A ";
         nBClaveA349 = nBClaveA349 + #349#22;
     |FINSI;

     |SI #349#6 = "AR";
         nBClaveA349 = nBClaveA349 + #349#22;

         |SI #349#24 = "-";
             nBClaveA349 = nBClaveA349 - #349#27;
         |SINO;
             nBClaveA349 = nBClaveA349 + #349#27;
         |FINSI;
     |FINSI;

     |SI #349#6 = "I ";
         nBClaveI349 = nBClaveI349 + #349#22;
     |FINSI;

     |SI #349#6 = "IR";
         nBClaveI349 = nBClaveI349 + #349#22;

         |SI #349#24 = "-";
             nBClaveI349 = nBClaveI349 - #349#27;
         |SINO;
             nBClaveI349 = nBClaveI349 + #349#27;
         |FINSI;
     |FINSI;

     |SI #349#6 = "E ";
        |O #349#6 = "H ";
        |O #349#6 = "M ";
        |O #349#6 = "T ";
         nBClaveE349 = nBClaveE349 + #349#22;
     |FINSI;

     |SI #349#6 = "ER";
        |O #349#6 = "HR";
        |O #349#6 = "MR";
        |O #349#6 = "TR";
         nBClaveE349 = nBClaveE349 + #349#22;

         |SI #349#24 = "-";
             nBClaveE349 = nBClaveE349 - #349#27;
         |SINO;
             nBClaveE349 = nBClaveE349 + #349#27;
         |FINSI;
     |FINSI;

     |SI #349#6 = "S ";
         nBClaveS349 = nBClaveS349 + #349#22;
     |FINSI;

     |SI #349#6 = "SR";
         nBClaveS349 = nBClaveS349 + #349#22;

         |SI #349#24 = "-";
             nBClaveS349 = nBClaveS349 - #349#27;
         |SINO;
             nBClaveS349 = nBClaveS349 + #349#27;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc349_303;
     #349#1;
     ;
     #4#0, #4#1, nDPeriodo, 349, #4#4, enActividad, "A ", 0000, 00, "            ";
     #4#0, #4#1, nHPeriodo, 349, #4#4, enActividad, "zz", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Calcu349_303;
|FIN;

|PROCESO Mira349_303;
     |SI #95#2 ! "A";
         |SI nMes = 1;  |Y nPerIntra1  = 0;  |ACABA;  |FINSI;
         |SI nMes = 2;  |Y nPerIntra2  = 0;  |ACABA;  |FINSI;
         |SI nMes = 3;  |Y nPerIntra3  = 0;  |ACABA;  |FINSI;
         |SI nMes = 4;  |Y nPerIntra4  = 0;  |ACABA;  |FINSI;
         |SI nMes = 5;  |Y nPerIntra5  = 0;  |ACABA;  |FINSI;
         |SI nMes = 6;  |Y nPerIntra6  = 0;  |ACABA;  |FINSI;
         |SI nMes = 7;  |Y nPerIntra7  = 0;  |ACABA;  |FINSI;
         |SI nMes = 8;  |Y nPerIntra8  = 0;  |ACABA;  |FINSI;
         |SI nMes = 9;  |Y nPerIntra9  = 0;  |ACABA;  |FINSI;
         |SI nMes = 10; |Y nPerIntra10 = 0;  |ACABA;  |FINSI;
         |SI nMes = 11; |Y nPerIntra11 = 0;  |ACABA;  |FINSI;
         |SI nMes = 12; |Y nPerIntra12 = 0;  |ACABA;  |FINSI;

         nMesGuarda = nMes;
         |SI #95#2 = "T";
             |SI nMes = 1;  |O nMes = 2;  |O nMes = 3;
                 nMes = 3;
             |FINSI;

             |SI nMes = 4;  |O nMes = 5;  |O nMes = 6;
                 nMes = 6;
             |FINSI;

             |SI nMes = 7;  |O nMes = 8;  |O nMes = 9;
                 nMes = 9;
             |FINSI;

             |SI nMes = 10;  |O nMes = 11;  |O nMes = 12;
                 nMes = 12;
             |FINSI;
         |FINSI;

         nPeriodo = nMes + (nMes + 1);

         |SI #95nPeriodo = "X";  |ACABA;  |FINSI;

         |SI #95nPeriodo = "N";
             #95#0 = enEmpresa;
             #95#1 = enEjer;
             |LEE 101#95=;
             |SI FSalida = 0;
                 #95nPeriodo = "S";
                 nPeriodo    = nPeriodo + 1;
                 #95nPeriodo = #95#2;
                 |GRABA 020#95a;
                 |LIBERA #95;
             |FINSI;

             enEmpresaA = #95#0;
             enAnyo     = #95#1;
             |SUB_EJECUTA_NP "dsmoz001";
         |FINSI;

         nMes = nMesGuarda;
     |FINSI;

     nModelo  = enModelo;
     nPeriodo = enPeriodo;

     |SALVA_DATOS #4;

     #999#0  = enEmpresa;
     #999#1  = enActividad;
     #999#2  = enEjer;
     #999#3  = nMes;
     #999#6  = eaNombreAct;
     #999#7  = 349;
     #999#8  = "S";
     #999#9  = enComplem;
     #999#10 = 303;
     |HAZ Pase349;

     enModelo  = nModelo;
     enPeriodo = nPeriodo;

     |REPON_DATOS #4;
|FPRC;

|PROCESO Chequea349_303;
     |SI enEjer [ 2009;  |ACABA;  |FINSI;

     |SI nBClaveA = 0;  |Y nBClaveI = 0;  |Y nBClaveE = 0;  |Y nBClaveS = 0;
      |Y nCClaveA = 0;  |Y nCClaveI = 0;  |Y nCClaveE = 0;  |Y nCClaveS = 0;
         |Y nBClaveR = 0; |Y nCClaveR = 0;
         |ACABA;
     |FINSI;

     |ABRE #95;
     #95#0 = enEmpresa;
     #95#1 = enEjer;
     |LEE 000#95=;
     |SI FSalida ! 0;
         |CIERRA #95;

         eaTipo349     = "A";
         enTipoEntrada = 96;
         enModelo349   = 303;
         |SUB_EJECUTA_NP "dsmoc349";
         eaTipo349     = "";
     |FINSI;
     |CIERRA #95;

     |ABRE #95;
     #95#0 = enEmpresa;
     #95#1 = enEjer;
     |LEE 000#95=;
     |SI FSalida ! 0;  |CIERRA #95;  |ACABA;  |FINSI;

     |SI #4#22 = "T";
         |SI enPeriodo = 3;
             nMes = 1;  |HAZ Mira349_303;
             nMes = 2;  |HAZ Mira349_303;
             nMes = 3;  |HAZ Mira349_303;

             nDPeriodo = 1;
             nHPeriodo = 3;
         |FINSI;

         |SI enPeriodo = 6;
             nMes = 4;  |HAZ Mira349_303;
             nMes = 5;  |HAZ Mira349_303;
             nMes = 6;  |HAZ Mira349_303;

             nDPeriodo = 4;
             nHPeriodo = 6;
         |FINSI;

         |SI enPeriodo = 9;
             nMes = 7;  |HAZ Mira349_303;
             nMes = 8;  |HAZ Mira349_303;
             nMes = 9;  |HAZ Mira349_303;

             nDPeriodo = 7;
             nHPeriodo = 9;
         |FINSI;

         |SI enPeriodo = 12;
             nMes = 10;  |HAZ Mira349_303;
             nMes = 11;  |HAZ Mira349_303;
             nMes = 12;  |HAZ Mira349_303;

             nDPeriodo = 10;
             nHPeriodo = 12;
         |FINSI;
     |FINSI;

     |SI #4#22 = "M";
         nMes = enPeriodo;  |HAZ Mira349_303;

         nDPeriodo = nMes;
         nHPeriodo = nMes;
     |FINSI;

     |CIERRA #95;

     nBClaveA349 = 0;
     nBClaveI349 = 0;
     nBClaveE349 = 0;
     nBClaveS349 = 0;

     |BUCLE dsmoc349_303;

     nBClaveA = nBClaveA ! 2;
     nBClaveI = nBClaveI ! 2;
     nBClaveE = nBClaveE ! 2;
     nBClaveS = nBClaveS ! 2;
     nBClaveR = nBClaveR ! 2;

     nBClaveA349 = nBClaveA349 ! 2;
     nBClaveI349 = nBClaveI349 ! 2;
     nBClaveE349 = nBClaveE349 ! 2;
     nBClaveS349 = nBClaveS349 ! 2;

     |SI enEjer ] 2015;
         |SI nBClaveR ! 0; |O nCClaveR ! 0;
             nBClaveA = nBClaveA + nBClaveI + nBClaveR;   nBClaveI = 0;
             nBClaveA349 = nBClaveA349 + nBClaveI349;  nBClaveI349 = 0;
         |FINSI;
     |FINSI;
     |SI nBClaveA ! nBClaveA349;   |O  nBClaveI ! nBClaveI349;
      |O  nBClaveE ! nBClaveE349;  |O  nBClaveS ! nBClaveS349;
          aAlfa = "0000Empresa " + #4#0 + " Periodo " + #4#2 + " Ejercicio "+ #4#1;
          |MENAV aAlfa;

          |MENAV "0000No coinciden los datos del modelo 303 con el modelo 349. Revise los datos.";
     |FINSI;
|FPRC;

|PROCESO Pase300;
     |ABRE #7;
     |LEE 000#7p;
     |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;
     |CIERRA #7;

     enEmpresa = #999#0;
     enEjer    = #999#2;
     |HAZ eLaActivPrin;
     enActividad = #999#1;

     nEl340 = 0;
     |SI #999#7 = 303; |O #999#7 = 370;
         |ABRE #8;
         #8#0 = #999#0;
         #8#1 = #999#2;
         #8#2 = #999#3;
         #8#3 = 340;
         #8#4 = #999#9;
         #8#5 = #999#1;
         |LEE 000#8=;
         |SI FSalida = 0;
             nEl340 = 1;
             |SI enPlanillas ! 0; nEl340 = 0; |FINSI; ||desde planillas no puedo parsarlos
         |FINSI;
         |CIERRA #8;

         |SI nEl340 = 1;
             enEmpresa     = #999#0;
             enEjer        = #999#2;
             enPeriodo     = #999#3;
             enModelo      = 340;
             enComplem     = #999#9;
             enActividad   = #999#1;
             enTipoEntrada = 3;
             |SUB_EJECUTA_NP "dsmo3401";

             |IMPRE 0;
             |SI FSalida ! 0;  |ACABA;  |FINSI;

             |INFOR "dspas340";
             |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
         |FINSI;
     |FINSI;

     nSwSi = 0;
     |DDEFECTO #8;
     |ABRE #8;
     #8#0 = #999#0;
     #8#1 = #999#2;
     #8#2 = #999#3;
     #8#3 = #999#7;
     #8#4 = #999#9;
     #8#5 = #999#1;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS";
         |GRABA 020#8a;

         enEmpresa     = #8#0;
         enEjer        = #8#1;
         enPeriodo     = #8#2;
         enModelo      = #8#3;
         enComplem     = #8#4;
         enActividad   = #8#5;
         enTipoEntrada = 97;
         |SUB_EJECUTA_NP "dsmoc322;NOMEQUITESQUETECORTOLOSHUEVOS";
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;

     enEmpresa     = #999#0;
     enEjer        = #999#2;

     |ABRE #95;
     #95#0 = enEmpresa;
     #95#1 = enEjer;
     |LEE 000#95=;
     |SI FSalida ! 0;  |DDEFECTO #95;  |FINSI;
     |CIERRA #95;

     nCampo          = 30 + enPeriodo;
     aDesConexion349 = #95nCampo;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #999#9;
     enActividad   = #999#1;
     enTipoEntrada = 90;
     |SUB_EJECUTA_NP "dsmoc322;NOMEQUITESQUETECORTOLOSHUEVOS";

     enNPro1 = nProrrata;
     |ABRE #300;
     |SI enAnterior ! 0;         || Recogida de un Periodo Anterior
         |SI enModelo = 300;
             |HAZ PaseAnterior300;
         |SINO;
             |SI #999#2 = 2009;
                 |SI #999#3 = 1;  |O #999#3 = 3;
                     |HAZ PaseAnterior300;
                 |SINO;
                     |HAZ PaseAnterior303;
                 |FINSI;
             |SINO;
                 |HAZ PaseAnterior303;
             |FINSI;
         |FINSI;
     |SINO;
         |HAZ PaseContabilidad;
     |FINSI;
     |CIERRA #300;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #999#9;
     enActividad   = #999#1;
     enTipoEntrada = 95;
     |SUB_EJECUTA_NP "dsmoc322;NOMEQUITESQUETECORTOLOSHUEVOS";

     |SI #999#3 = 12; |Y enSwProrr ! 2; |Y enEjer > 2010; |Y enPlanillas = 0;
         enSinPantalla = 4;
         |SUB_EJECUTA_NP "dsmozp02";
         enSinPantalla = 0;
     |FINSI;

     enEmpresa     = #999#0;
     enEjer        = #999#2;
     enPeriodo     = #999#3;
     enModelo      = #999#7;
     enComplem     = #999#9;
     enActividad   = #999#1;
     enTipoEntrada = 91;
     |SUB_EJECUTA_NP "dsmoc322;NOMEQUITESQUETECORTOLOSHUEVOS";

     |ABRE #4;
     #4#0 = #999#0;
     #4#1 = #999#2;
     #4#2 = #999#3;
     #4#3 = #999#7;
     #4#4 = #999#9;
     |LEE 101#4=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;  || Esta en el PLB

         #4#9 = " ";
         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;

     |SI #4#7 = "X"; |Y enSwCheqPase = 1;
         enSaldo1Ch = 0;
         enSaldo2Ch = 0;
         |ABRE #300;
         #300#0  = enEmpresa;
         #300#1  = enEjer;
         #300#2  = enPeriodo;
         #300#3  = enModelo;
         #300#4  = enComplem;
         #300#5  = enActividad;
         #300#6  = 2;
         #300#7  = 12;
         |LEE 101#300=;
         |SI FSalida = 0;
             enSaldo1Ch = #300#13;
         |FINSI;
         #300#0  = enEmpresa;
         #300#1  = enEjer;
         #300#2  = enPeriodo;
         #300#3  = enModelo;
         #300#4  = enComplem;
         #300#5  = enActividad;
         #300#6  = 1;
         #300#7  = 13;
         |LEE 101#300=;
         |SI FSalida = 0;
             enSaldo2Ch = #300#13;
         |FINSI;
         |CIERRA #300;
         enOperaCh  = 1;
         |HAZ GrabaAux151;
     |FINSI;

     |SI nSwSi = 0;
         |ABRE #8;
         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = enPeriodo;
         #8#3 = enModelo;
         #8#4 = enComplem;
         #8#5 = enActividad;
         |LEE 101#8=;
         |SI FSalida = 0;
             #8#13 = "N";
             |GRABA 020#8a;
         |FINSI;
         |LIBERA #8;
         |CIERRA #8;
     |SINO;
         |HAZ GraboRestoPror;
     |FINSI;

     |SI nEl340 = 1;
         enEmpresa     = #999#0;
         enEjer        = #999#2;
         enPeriodo     = #999#3;
         enModelo      = 340;
         enComplem     = #999#9;
         enActividad   = #999#1;
         enTipoEntrada = 98;
         |SUB_EJECUTA_NP "dsmo3401";

         |PIEINF;
         |FININF;
         |FINIMP;
     |FINSI;

     |SI aDesConexion349 = "N";
         |HAZ Chequea349_303;
     |FINSI;
|FPRC;
