|FICHEROS;
     dsmod110;
     dsmoc111;
     dsmom002;
     dsmom004;
     dsmom008;
     dsmom073;
     dsmom107;
     dsmow104;
     dsmow162;

     dsmow139,MANTE;

     :/basica/def/agidanif;

     dsmoc111@;

     &regisnif@;
|FIN;

|VARIABLES;
     nGrupo        = 0;
     i             = 0;
     nMod          = 110;
     aDn           = "            ";
     aHn           = "zzzzzzzzzzzz";
     nDd           = 0;
     nHd           = 9999;
     aTipoCaptura  ="";
     nSwEsta       = 0;
     nEjerAnt      = 0;
     nPer          = 0;
     nSwGraba      = 0;
     nTipo         = 0;
     nGrupoAnt     = 0;
     nDMes         = 0;
     nHMes         = 0;
     nBoton        = 0;
     nBoton4       = 0;

     aPathModelo   = "";
     aDef          = "";
     fFecha        = @;
     fDFecha       = @;
     fHFecha       = @;
     aAlfa         = "";
     aAlfa1        = "";
     aAlfa2        = "";
     aPeriodicidad = "";
     aDNIAnt       = "";
     aNuevoTipo    = "";

     nNume         = 0;
     nNume1        = 0;
     nNume2        = 0;
     nSwAux        = 0;
     aFichero      = "";
     nSwOp         = 0;
     nImpAnt       = 0;

     nCampo92_21   = 0;
     nCampo92_22   = 0;
     nCampo92_23   = 0;

     aMas          = "";
     aBase         = "";
     nPara1        = 0;
     nModo         = 0;
     aNegativo     = "";
     nCampo1       = 0;
     nError        = 0;
     nSw           = 0;
     aCero         = "";

     &enCalculado  = 0;
     &enDEmpresa   = 0;
     &enHEmpresa   = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Tipo0C8;
     |SI #dsmoc111#7 !  0; |ACABA;  |FINSI;

     |SI #dsmoc111#8 > nHMes;
         aAlfa = "0000Periodo erroneo. Debe ser de " + nDMes + " hasta " + nHMes;
         |MENAV aAlfa;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Baja73;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = "";
     #dsmom073#2 = "";
|FPRC;

|PROCESO Alta73;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = "z";
     #dsmom073#2 = "zz";
|FPRC;

|PROCESO T66C9Fmoc111; |TIPO 66;
     enEjerIRPF = #dsmoc111#1;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #dsmoc111#9;
     #dsmom073#2 = #dsmoc111#10;
     |LEE 000#dsmom073.];

     |CONSULTA_F_CLAVE #1#dsmom073, Baja73, Alta73;
     |SI FSalida = 0;
          #dsmoc111#9  = #dsmom073#1;    |PINTA #dsmoc111#9;
          #dsmoc111#10 = #dsmom073#2;    |PINTA #dsmoc111#10;
     |FINSI;
     |CIERRA #dsmom073;

     |ERROR;
|FPRC;

|PROCESO T0C10Fmoc111; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     enEjerIRPF = #dsmoc111#1;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #dsmoc111#9;
     #dsmom073#2 = #dsmoc111#10;
     |LEE 000#dsmom073.=;
     |SI FSalida ! 0;
         aAlfa = "0000Clave no correcta en el ejercicio " + enEjerIRPF;
         |MENAV aAlfa;
         |SI nModo = 1;  |ERROR;  |FINSI;
     |FINSI;
     |CIERRA #dsmom073;
|FPRC;

|PROCESO Tipo7C11;  |TIPO 7;
     |C_M #dsmoc111#11, 1, "S";
     |SI #dsmoc111#9 ! "A";
         |C_M #dsmoc111#11, 1, "N";
         #dsmoc111#11 = 0;  |PINTA #dsmoc111#11;
         |ACABA;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI #dsmoc111#11 ! 0; |Y nModo ! 1; |ACABA;  |FINSI;

     |ABRE #agidanif;
     #agidanif#0  = #dsmoc111#6;
     #agidanif#1  = 1;
     |LEE 040#agidanif.=;
     |SI FSalida ! 0;  |DDEFECTO #agidanif; |FINSI;
     |CIERRA #agidanif;

     |SI nModo = 1;
        #dsmoc111#11 = #agidanif#36;
        |PINTA #agidanif#10;
     |FINSI;
|FPRC;

|PROCESO Tipo0C11;  |TIPO 0;
     |SI #dsmoc111#9 = "A";  |Y #dsmoc111#11 = 0;
         |MENAV "     Introduzca Tipo de Relacion.";
         |ERROR;
         |ACABA;
     |FINSI;

     |C_M #dsmoc111#24, 1, "S";
     |SI #dsmoc111#11 ! 1;
         |C_M #dsmoc111#24, 1, "N";  #dsmoc111#24 = "N";
     |FINSI;

     |PINTA #dsmoc111#24;
|FPRC;

|CALCULO GastoSS; |TIPO 0;
    |SI #dsmom107#21 ! "S";
        |SI #dsmoc111#Campo# ! 0;
        |FINSI;
   |FINSI;
|FCAL;

|PROCESO dsmom002;              || Comprobamos todas las fechas

     aAlfa   = "31.12." + enEjer;  fHFecha = aAlfa;
     aAlfa   = "01.01." + enEjer;  fDFecha = aAlfa;

     aAlfa   = #dsmom002#8 % -104;
     |SI aAlfa ! "0000";
         nNume = aAlfa;
         |SI nNume > enEjer; |ACABA; |FINSI;

         |SI #dsmom002#8 > fDFecha; fDFecha = #dsmom002#8; |FINSI;
     |FINSI;

     aAlfa   = #dsmom002#9 % -104;
     |SI aAlfa ! "0000";
         nNume   = aAlfa;
         |SI nNume < enEjer;  |ACABA;  |FINSI;

         |SI #dsmom002#9 < fHFecha;  fHFecha = #dsmom002#9;  |FINSI;
     |FINSI;

     aAlfa2 = enPeriodo;
     aAlfa2 = ("00" + aAlfa2) % -102;
     aAlfa  = "31.";

     |SI enPeriodo = 4; |O enPeriodo = 6; |O enPeriodo = 9; |O enPeriodo = 11;
         aAlfa = "30.";
     |FINSI;

     |SI enPeriodo = 2;
         aAlfa = "28."; |SI enEjer = 2000; |O enEjer = 2004; |O enEjer = 2008;
                         |O enEjer = 2012; |O enEjer = 2016; |O enEjer = 2020;
                         |O enEjer = 2024; |O enEjer = 2028; |O enEjer = 2032;
                            aAlfa = "29.";
                        |FINSI;
     |FINSI;
     aAlfa2 = aAlfa + aAlfa2 + "." + enEjer;

     |SI #dsmom002#7 = "TRIMESTRAL";
         |SI enPeriodo = 3;  aAlfa1 = "01.01." + enEjer;  |FINSI;
         |SI enPeriodo = 6;  aAlfa1 = "01.04." + enEjer;  |FINSI;
         |SI enPeriodo = 9;  aAlfa1 = "01.07." + enEjer;  |FINSI;
         |SI enPeriodo = 12; aAlfa1 = "01.10." + enEjer;  |FINSI;
     |FINSI;

     |SI #dsmom002#7 = "MENSUAL   ";
         aAlfa1 = enPeriodo;  aAlfa1 = ("00" + aAlfa1) % -102;
         aAlfa1 = "01." + aAlfa1 + "." + enEjer;
     |FINSI;

     |SI #dsmom002#7 = "ANUAL     ";
         aAlfa1 = "01.01." + enEjer;
         aAlfa2 = "31.12." + enEjer;
     |FINSI;

     fFecha = aAlfa1;
     |SI fHFecha < fFecha;  |ACABA;  |FINSI;

     fFecha = aAlfa2;
     |SI fDFecha > fFecha;  |ACABA;  |FINSI;

     aPeriodicidad = #dsmom002#7; |QBF aPeriodicidad;
     |ERROR10;
|FPRC;

|DEFBUCLE dsmom002;
     #dsmom002#1;
     ;
     enEmpresa, 01, enModelo;
     enEmpresa, 98, enModelo;
     ;
     NULL, dsmom002;
|FIN;

|PROCESO Modificables; |TIPO 7;
     |SI #dsmoc111#6 ! "PASEANTERIOR";  |Y #dsmoc111#6 ! "MANUAL      ";
         |C_M #dsmoc111#22, 1, "N";  |C_V #dsmoc111#22, 1, "N";
         |C_M #dsmoc111#23, 1, "N";  |C_V #dsmoc111#23, 1, "N";
     |SINO;
         |C_M #dsmoc111#22, 1, "S";  |C_V #dsmoc111#22, 1, "S";
         |C_M #dsmoc111#23, 1, "S";  |C_V #dsmoc111#23, 1, "S";
     |FINSI;

     |PINTA #dsmoc111#22;
     |PINTA #dsmoc111#23;
|FPRC;

|PROCESO Tipo7;  |TIPO 7;
     |ESTADO_CONTROL nBoton,  "DISABLE";
     |ESTADO_CONTROL nBoton4, "DISABLE";

     |SI #dsmoc111#6 ! "PASEANTERIOR";  |Y #dsmoc111#6 ! "MANUAL      ";
         |C_M #dsmoc111#22, 1, "N";  |C_V #dsmoc111#22, 1, "N";
         |C_M #dsmoc111#23, 1, "N";  |C_V #dsmoc111#23, 1, "N";
     |SINO;
         |C_M #dsmoc111#22, 1, "S";  |C_V #dsmoc111#22, 1, "S";
         |C_M #dsmoc111#23, 1, "S";  |C_V #dsmoc111#23, 1, "S";
     |FINSI;


     |PINTA #dsmoc111#22;
     |PINTA #dsmoc111#23;

     nCampo92_21 = 0;
     nCampo92_22 = 0;
     nCampo92_23 = 0;
|FPRC;

|PROCESO PonNombre;  |TIPO 7;
     |ESTADO_CONTROL nBoton, "ENABLE";
     |ESTADO_CONTROL nBoton4, "ENABLE";

     aAlfa = #dsmoc111#21;  |QBF aAlfa;
     |SI aAlfa = "";
         eaCodNif = #dsmoc111#6;
         |HAZ LeeNifs;
         #dsmoc111#21 = #regisnif@#1;
         |PINTA #dsmoc111#21;
     |FINSI;

     |C_M #dsmoc111#24, 1, "S";
     |SI #dsmoc111#11 ! 1;
         |C_M #dsmoc111#24, 1, "N";  #dsmoc111#24 = "N";
     |FINSI;
     |PINTA #dsmoc111#24;
|FPRC;

|PROCESO CambioRelacion;
         |PUSHV 08102379;
         |ATRI S;
         |PINTA 0911, " Cambiar Tipo Relacion: <1> Contrato; <2> Contrato < 1 a¤o  ";
         |PINTA 1011, "                        <3> Especial; <4> Esporadica        ";
         |ATRI I;
         |PINTA 1111, " N.I.F.         DEV  MES  Clave  SubClave                   ";
         |PINTA 1211, "                                                            ";
         |PINTA 1212, #dsmoc111#6; |PINTA 1226, #dsmoc111#7; |PINTA 1232, #dsmoc111#8;
         |PINTA 1237, #dsmoc111#9; |PINTA 1244, #dsmoc111#10;
         |ATRI I;
         |PINTA 1311, " Tipo de Relacion:        Nuevo Tipo de Relacion:           ";
         |PINTA 1330, #dsmoc111#11;
         |ATRI 0;
         |CUADRO 08 10 14 70;
         E_sup  = 1;
         E_inf  = "1234";
         aNuevoTipo = 1361 ? 0;

         |POPV;
         |SI #dsmoc111#11 = aNuevoTipo; |ACABA; |FINSI;
         aAlfa1 = "    SEs correcto el Tipo de Relacion " + aNuevoTipo + "?";
         |CONFI aAlfa1;
         |SI FSalida = 0;

             |DBASE aBase;  |QBF aBase;
             aMas = aBase + "def/dsmoc111.mas";
             |CARGA_DEF aMas, dsmoc111@;

             |ABRE #dsmoc111@;
             |DDEFECTO #dsmoc111@;
             #dsmoc111@#0 = #dsmoc111#0;
             #dsmoc111@#1 = #dsmoc111#1;
             #dsmoc111@#2 = #dsmoc111#2;
             #dsmoc111@#3 = #dsmoc111#3;
             #dsmoc111@#4 = #dsmoc111#4;
             #dsmoc111@#5 = #dsmoc111#5;
             #dsmoc111@#6 = #dsmoc111#6;
             #dsmoc111@#7 = #dsmoc111#7;
             #dsmoc111@#8  = #dsmoc111#8;
             #dsmoc111@#9  = #dsmoc111#9;
             #dsmoc111@#10 = #dsmoc111#10;
             #dsmoc111@#11 = aNuevoTipo;
             |LEE 141#dsmoc111@.=;
             |SI FSalida = 0;
                 |MENAV "    Ya existe el Registro con el Tipo de Relacion informado.";
             |SINO;

                 |DDEFECTO #dsmoc111@;
                 |PARA nPara1 = 0; |SI nPara1 [ 24; |HACIENDO nPara1 = nPara1 + 1;
                       #dsmoc111@#nPara1# = #dsmoc111#nPara1#;
                 |SIGUE;
                 #dsmoc111@#11 = aNuevoTipo;
                 |GRABA 020#dsmoc111@.n;

                 |BORRA 020#dsmoc111.a;
                 |LIBERA #dsmoc111;

                 |PONCONTROL 23, "SI";
                 |PTEC 806;
             |FINSI;
             |LIBERA #dsmoc111@;
             |DESCARGA_DEF #dsmoc111@;
         |FINSI;
|FPRC;

|PROCESO Dnimoc111;  |TIPO 11;
     |SI FSalida = 10;
         eaVarDni  = #dsmoc111#Campo#;
         enCalcCif = 1;
         |HAZ CalculameDNI;
         #dsmoc111#Campo# = eaVarDni;
         |PINTA #dsmoc111#Campo#;
         |ERROR;
     |FINSI;

     |SI FSalida = 14;
         |CONFI "    NCambiar el Tipo Relacion de este Registro";
         |SI FSalida = 0;
             |HAZ CambioRelacion;
             |ERROR;
         |SINO;
             |ERROR;
         |FINSI;
    |FINSI;

|FPRC;

|PROCESO MiraDnimoc111;  |TIPO 6;
     eaVarDni  = #dsmoc111#Campo#;
     enCalcCif = 0;
     |HAZ CalculameDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #dsmoc111#Campo# ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #dsmoc111#Campo# = eaVarDni;  |PINTA #dsmoc111#Campo#;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     nError = 1;
     aAlfa = #dsmoc111#Campo# % 101;
     |SI aAlfa = "0";  nError = 0; |FINSI;
     |SI aAlfa = "1";  nError = 0; |FINSI;
     |SI aAlfa = "2";  nError = 0; |FINSI;
     |SI aAlfa = "3";  nError = 0; |FINSI;
     |SI aAlfa = "4";  nError = 0; |FINSI;
     |SI aAlfa = "5";  nError = 0; |FINSI;
     |SI aAlfa = "6";  nError = 0; |FINSI;
     |SI aAlfa = "7";  nError = 0; |FINSI;
     |SI aAlfa = "8";  nError = 0; |FINSI;
     |SI aAlfa = "9";  nError = 0; |FINSI;
     |SI aAlfa = "E";  |O aAlfa = "e"; nError = 0; |FINSI;
     |SI aAlfa = "J";  |O aAlfa = "j"; nError = 0; |FINSI;
     |SI aAlfa = "X";  |O aAlfa = "x"; nError = 0; |FINSI;
     |SI aAlfa = "Y";  |O aAlfa = "y"; nError = 0; |FINSI;
     |SI aAlfa = "Z";  |O aAlfa = "z"; nError = 0; |FINSI;

     |SI nError = 1;
         |CONFI "0000NEste CIF es de una sociedad y no debe declarase en el Modelo. Continuar S/N";
         |SI FSalida ! 0;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaAuxiliar;
     |ABRE #dsmow104;
     #dsmow104#0 = #dsmoc111#6;
     #dsmow104#1 = nGrupo;
     |LEE 101#dsmow104.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow104;
         #dsmow104#0 = #dsmoc111#6;
         #dsmow104#1 = nGrupo;
         |GRABA 020#dsmow104.b;
     |FINSI;

     #dsmow104#2 = #dsmow104#2  + #dsmoc111#12;
     #dsmow104#3 = #dsmow104#3  + #dsmoc111#13;
     #dsmow104#4 = #dsmow104#4  + #dsmoc111#14;
     #dsmow104#5 = #dsmow104#5  + #dsmoc111#15 + #dsmoc111#16;
     nSwAux = 1;

     |SI #dsmoc111#6 = "MANUAL      ";
         #dsmow104#7 = #dsmow104#7 + #dsmoc111#22;
         #dsmow104#8 = #dsmow104#8 + #dsmoc111#23;
     |FINSI;
     |GRABA 020#dsmow104.a;
     |LIBERA #dsmow104;
     |CIERRA #dsmow104;
|FPRC;

|PROCESO NegativosClaveA;
    aCero = "S";
    |DDEFECTO #dsmow162;
    #dsmow162#0 = #dsmoc111#0;
    #dsmow162#1 = #dsmoc111#1;
    #dsmow162#2 = #dsmoc111#2;
    #dsmow162#3 = #dsmoc111#3;
    #dsmow162#4 = #dsmoc111#4;
    #dsmow162#5 = #dsmoc111#5;
    #dsmow162#6 = #dsmoc111#6;
    #dsmow162#7 = #dsmoc111#7;
    #dsmow162#8 = #dsmoc111#8;
    #dsmow162#9 = #dsmoc111#9;
    #dsmow162#10 = "  ";
    #dsmow162#11 = #dsmoc111#11;
    |LEE 041#dsmow162.=;
    |SI FSalida = 0;
        |PARA nCampo1 = 12;  |SI nCampo1 [ 20;  |HACIENDO nCampo1 = nCampo1 + 1;
              |SI #dsmow162#nCampo1# < 0;
                  aNegativo = "S";
              |FINSI;
              |SI #dsmow162#nCampo1# ! 0; |Y nCampo1 < 17;
                  aCero = "N";
              |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO VerNegA15_1;
    #dsmow162#0 = #dsmoc111#0;
    #dsmow162#1 = #dsmoc111#1;
    #dsmow162#2 = #dsmoc111#2;
    #dsmow162#3 = #dsmoc111#3;
    #dsmow162#4 = #dsmoc111#4;
    #dsmow162#5 = #dsmoc111#5;
    #dsmow162#6 = #dsmoc111#6;
    #dsmow162#7 = #dsmoc111#7;
    #dsmow162#8 = #dsmoc111#8;
    #dsmow162#9 = #dsmoc111#9;
    #dsmow162#10 = "  ";
    #dsmow162#11 = #dsmoc111#11;
    |LEE 041#dsmow162.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsmow162;
        #dsmow162#0 = #dsmoc111#0;
        #dsmow162#1 = #dsmoc111#1;
        #dsmow162#2 = #dsmoc111#2;
        #dsmow162#3 = #dsmoc111#3;
        #dsmow162#4 = #dsmoc111#4;
        #dsmow162#5 = #dsmoc111#5;
        #dsmow162#6 = #dsmoc111#6;
        #dsmow162#7 = #dsmoc111#7;
        #dsmow162#8 = #dsmoc111#8;
        #dsmow162#9 = #dsmoc111#9;
        #dsmow162#10 = "  ";
        #dsmow162#11 = #dsmoc111#11;
        |GRABA 020#dsmow162.c;
    |FINSI;
    #dsmow162#12 = #dsmow162#12 + #dsmoc111#12;
    #dsmow162#13 = #dsmow162#13 + #dsmoc111#13;
    #dsmow162#14 = #dsmow162#14 + #dsmoc111#14;
    #dsmow162#15 = #dsmow162#15 + #dsmoc111#15;
    #dsmow162#16 = #dsmow162#16 + #dsmoc111#16;
    #dsmow162#17 = #dsmow162#17 + #dsmoc111#17;
    #dsmow162#18 = #dsmow162#18 + #dsmoc111#18;
    #dsmow162#19 = #dsmow162#19 + #dsmoc111#19;
    #dsmow162#20 = #dsmow162#20 + #dsmoc111#20;
    |GRABA 020#dsmow162.a;
|FPRC;

|DEFBUCLE VerNegA15_1;
     #dsmoc111#1;
     ;
     enEmpresa,enEjer,enPeriodo,nMod,enComplem,01,aDn,nDd,00,"A","  ",0;
     enEmpresa,enEjer,enPeriodo,nMod,enComplem,99,aHn,nHd,99,"A","zz",9;
     ;
     NULL, VerNegA15_1;
|FIN;

|PROCESO VerNegA15;
     aFichero = ("2x" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dsmow162#aFichero#;
     |DELINDEX #dsmow162;
     |ABRE #dsmow162;
     |BUCLE VerNegA15_1;
     |CIERRA #dsmow162;
|FPRC;

|PROCESO MiraCampos111N;

 |SI #dsmoc111#1 = 2015; |Y #dsmoc111#2 ] 11; |Y #dsmoc111#9 = "A";
     |HAZ NegativosClaveA;
 |SINO;
     |PARA nCampo1 = 12;  |SI nCampo1 [ 20;  |HACIENDO nCampo1 = nCampo1 + 1;
          |SI #dsmoc111#nCampo1# < 0;
              aNegativo = "S";
              |SAL;
          |FINSI;
     |SIGUE;
  |FINSI;
|FPRC;

|PROCESO LeeGrupo;
     enEjerIRPF = #dsmoc111#1;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #dsmoc111#9;
     #dsmom073#2 = #dsmoc111#10;
     |LEE 000#dsmom073.=;
     |SI FSalida=0;
          nGrupo = #dsmom073#4;
     |FINSI;
     |CIERRA #dsmom073;
|FPRC;

|PROCESO GrabaModelo;
     aCero = "N";

     |SI aNegativo ! "S";
         |HAZ MiraCampos111N;
     |FINSI;
     |SI aNegativo = "S"; |Y #dsmoc111#9 = "A"; |Y #dsmoc111#1 ] 2015;
         |HAZ MiraCampos111N;
     |FINSI;

     |SI #dsmoc111#9 = "L";  |ACABA;  |FINSI;

     nGrupoAnt = nGrupo;
     |HAZ LeeGrupo;
     |SI nGrupoAnt ! nGrupo;
         aDNIAnt = "";
     |FINSI;

     |SI nGrupo = 0;  |ACABA;  |FINSI;


  |SI aCero = "N"; |O #dsmoc111#9 ! "A";
     nSwGraba = 1;
     |SI nGrupo = 1;
          |SI aDNIAnt ! #dsmoc111#6;  |Y #dsmoc111#6 ! "PASEANTERIOR";  |Y #dsmoc111#6 ! "MANUAL      ";
              |SI #dsmoc111#12 ! 0; |O #dsmoc111#13 ! 0;
                  #dsmod110#6 = #dsmod110#6 + 1;
              |FINSI;
          |FINSI;

          |SI aDNIAnt ! #dsmoc111#6;  |Y #dsmoc111#6 ! "PASEANTERIOR";  |Y #dsmoc111#6 ! "MANUAL      ";
              |SI #dsmoc111#14 ! 0; |O #dsmoc111#15 ! 0; |O #dsmoc111#16 ! 0;
                  #dsmod110#9 = #dsmod110#9 + 1;
              |FINSI;
          |FINSI;

          |SI #dsmoc111#6 = "PASEANTERIOR";  |O #dsmoc111#6 = "MANUAL      ";
              |SI #dsmoc111#22 ! 0;  #dsmod110#6 = #dsmoc111#22;  |FINSI;
              |SI #dsmoc111#23 ! 0;  #dsmod110#9 = #dsmoc111#23;  |FINSI;
          |FINSI;

          #dsmod110#7  = #dsmod110#7  + #dsmoc111#12;
          #dsmod110#8  = #dsmod110#8  + #dsmoc111#13;
          #dsmod110#10 = #dsmod110#10 + #dsmoc111#14;
          #dsmod110#11 = #dsmod110#11 + #dsmoc111#15 + #dsmoc111#16;
     |FINSI;

     |SI nGrupo = 2;
          |SI aDNIAnt ! #dsmoc111#6;  |Y #dsmoc111#6 ! "PASEANTERIOR";  |Y #dsmoc111#6 ! "MANUAL      ";
              |SI #dsmoc111#12 ! 0; |O #dsmoc111#13 ! 0;
                  #dsmod110#12 = #dsmod110#12 + 1;
              |FINSI;
          |FINSI;

          |SI aDNIAnt ! #dsmoc111#6;  |Y #dsmoc111#6 ! "PASEANTERIOR";  |Y #dsmoc111#6 ! "MANUAL      ";
              |SI #dsmoc111#14 ! 0; |O #dsmoc111#15 ! 0; |O #dsmoc111#16 ! 0;
                  #dsmod110#15 = #dsmod110#15 + 1;
              |FINSI;
          |FINSI;

          |SI #dsmoc111#6 = "PASEANTERIOR";  |O #dsmoc111#6 = "MANUAL      ";
              |SI #dsmoc111#22 ! 0;  #dsmod110#12 = #dsmoc111#22;  |FINSI;
              |SI #dsmoc111#23 ! 0;  #dsmod110#15 = #dsmoc111#23;  |FINSI;
          |FINSI;

          #dsmod110#13 = #dsmod110#13 + #dsmoc111#12;
          #dsmod110#14 = #dsmod110#14 + #dsmoc111#13;
          #dsmod110#16 = #dsmod110#16 + #dsmoc111#14;
          #dsmod110#17 = #dsmod110#17 + #dsmoc111#15 + #dsmoc111#16;
     |FINSI;

     |SI nGrupo = 3;
          |SI aDNIAnt ! #dsmoc111#6;  |Y #dsmoc111#6 ! "PASEANTERIOR";  |Y #dsmoc111#6 ! "MANUAL      ";
              |SI #dsmoc111#12 ! 0; |O #dsmoc111#13 ! 0;
                  #dsmod110#18 = #dsmod110#18 + 1;
              |FINSI;
          |FINSI;

          |SI aDNIAnt ! #dsmoc111#6;  |Y #dsmoc111#6 ! "PASEANTERIOR";  |Y #dsmoc111#6 ! "MANUAL      ";
              |SI #dsmoc111#14 ! 0; |O #dsmoc111#15 ! 0; |O #dsmoc111#16 ! 0;
                  #dsmod110#21 = #dsmod110#21 + 1;
              |FINSI;
          |FINSI;

          |SI #dsmoc111#6 = "PASEANTERIOR";  |O #dsmoc111#6 = "MANUAL      ";
              |SI #dsmoc111#22 ! 0;  #dsmod110#18 = #dsmoc111#22;  |FINSI;
              |SI #dsmoc111#23 ! 0;  #dsmod110#21 = #dsmoc111#23;  |FINSI;
          |FINSI;

          #dsmod110#19 = #dsmod110#19 + #dsmoc111#12;
          #dsmod110#20 = #dsmod110#20 + #dsmoc111#13;
          #dsmod110#22 = #dsmod110#22 + #dsmoc111#14;
          #dsmod110#23 = #dsmod110#23 + #dsmoc111#15 + #dsmoc111#16;
     |FINSI;

     |SI nGrupo = 4;
          |SI aDNIAnt ! #dsmoc111#6;  |Y #dsmoc111#6 ! "PASEANTERIOR";  |Y #dsmoc111#6 ! "MANUAL      ";
              #dsmod110#24 = #dsmod110#24 + 1;
          |FINSI;

          |SI #dsmoc111#6 = "PASEANTERIOR";  |O #dsmoc111#6 = "MANUAL      ";
              |SI #dsmoc111#22 ! 0;  #dsmod110#24 = #dsmoc111#22;  |FINSI;
          |FINSI;

          #dsmod110#25 = #dsmod110#25 + #dsmoc111#12 + #dsmoc111#14;
          #dsmod110#26 = #dsmod110#26 + #dsmoc111#13 + #dsmoc111#15 + #dsmoc111#16;
     |FINSI;

     |SI nGrupo = 5;
          |SI aDNIAnt ! #dsmoc111#6;  |Y #dsmoc111#6 ! "PASEANTERIOR";  |Y #dsmoc111#6 ! "MANUAL      ";
              |SI #dsmoc111#12 ! 0; |O #dsmoc111#13 ! 0;
                  #dsmod110#31 = #dsmod110#31 + 1;
              |FINSI;
          |FINSI;

          |SI aDNIAnt ! #dsmoc111#6;  |Y #dsmoc111#6 ! "PASEANTERIOR";  |Y #dsmoc111#6 ! "MANUAL      ";
              |SI #dsmoc111#14 ! 0; |O #dsmoc111#15 ! 0; |O #dsmoc111#16 ! 0;
                  #dsmod110#34 = #dsmod110#34 + 1;
              |FINSI;
          |FINSI;

          |SI #dsmoc111#6 = "PASEANTERIOR";  |O #dsmoc111#6 = "MANUAL      ";
              |SI #dsmoc111#22 ! 0;  #dsmod110#31 = #dsmoc111#22;  |FINSI;
              |SI #dsmoc111#23 ! 0;  #dsmod110#34 = #dsmoc111#23;  |FINSI;
          |FINSI;

          #dsmod110#32 = #dsmod110#32 + #dsmoc111#12;
          #dsmod110#33 = #dsmod110#33 + #dsmoc111#13;
          #dsmod110#35 = #dsmod110#35 + #dsmoc111#14;
          #dsmod110#36 = #dsmod110#36 + #dsmoc111#15 + #dsmoc111#16;
     |FINSI;
  |FINSI;

     #dsmod110#27 = #dsmod110#8 + #dsmod110#11 + #dsmod110#14 + #dsmod110#17 + #dsmod110#20 + #dsmod110#23 + #dsmod110#26 + #dsmod110#33 + #dsmod110#36;
     #dsmod110#28 = nImpAnt;
     #dsmod110#29 = #dsmod110#27 - #dsmod110#28;

     |SI aDNIAnt ! #dsmoc111#6;  aDNIAnt = #dsmoc111#6;  |FINSI;

     |SI #dsmoc111#6 ! "PASEANTERIOR";
         |HAZ GrabaAuxiliar;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc111;
     #dsmoc111#1;
     ;
     enEmpresa,enEjer,enPeriodo,nMod,enComplem,01,aDn,nDd,00," ","  ",0;
     enEmpresa,enEjer,enPeriodo,nMod,enComplem,99,aHn,nHd,99,"z","zz",9;
     be;
     NULL, GrabaModelo;
|FIN;

|PROCESO GrabaRegistro0;
     |SI enModelo = 110;
         |ABRE #dsmod110;
         #dsmod110#0 = enEmpresa;
         #dsmod110#1 = enEjer;
         #dsmod110#2 = enPeriodo;
         #dsmod110#3 = enModelo;
         #dsmod110#4 = enComplem;
         #dsmod110#5 = 0;
         |LEE 101#dsmod110.=;
         |SI FSalida = 0;
             |BORRA 020#dsmod110.a;
         |FINSI;
         |LIBERA #dsmod110;
     |FINSI;

     |ABRE #dsmom008;
     #dsmom008#0 = enEmpresa;
     #dsmom008#1 = enEjer;
     #dsmom008#2 = enPeriodo;
     #dsmom008#3 = enModelo;
     #dsmom008#4 = enComplem;
     #dsmom008#5 = 0;
     |LEE 101#dsmom008.=;
     |SI FSalida = 0;
         #dsmom008#11 = "SIN DATOS ";
         |GRABA 020#dsmom008.a;
     |FINSI;
     |LIBERA #dsmom008;
     |CIERRA #dsmom008;
|FPRC;

|PROCESO BajaModelo;
     |BORRA 020#dsmoc111.a;
     |LIBERA #dsmoc111;
|FPRC;

|DEFBUCLE dsmoc111B;
     #dsmoc111#1;
     ;
     enEmpresa,enEjer,enPeriodo,nMod,enComplem,enActividad,aDn,nDd,00," ","  ",0;
     enEmpresa,enEjer,enPeriodo,nMod,enComplem,enActividad,aHn,nHd,99,"z","zz",9;
     be;
     NULL, BajaModelo;
|FIN;

|PROCESO BorraRegistros;
     |BUCLE dsmoc111B;
     |HAZ GrabaRegistro0;

     |ABRE #dsmom008;
     #dsmom008#0 = enEmpresa;
     #dsmom008#1 = enEjer;
     #dsmom008#2 = nPer;
     #dsmom008#3 = 110;
     #dsmom008#4 = enComplem;
     #dsmom008#5 = enActividad;
     |LEE 101#dsmom008.=;
     |SI FSalida = 0;
         #dsmom008#11 = "SIN DATOS";
         |GRABA 020#dsmom008.a;
     |FINSI;
     |LIBERA #dsmom008;
     |CIERRA #dsmom008;
|FPRC;

|PROCESO RepasoAuxiliar;
     |SI #dsmow104#2 = 0; |Y #dsmow104#3 = 0; |Y #dsmow104#4 = 0; |Y #dsmow104#5 = 0;
         |ACABA;
     |FINSI;

     |SI #dsmow104#1 = 1; nNume1 = 6;  nNume2 = 9;  |FINSI;
     |SI #dsmow104#1 = 2; nNume1 = 12; nNume2 = 15; |FINSI;
     |SI #dsmow104#1 = 3; nNume1 = 18; nNume2 = 21; |FINSI;
     |SI #dsmow104#1 = 4; nNume1 = 31; nNume2 = 34; |FINSI;
     |SI #dsmow104#1 = 5; nNume1 = 25; nNume2 = 0;  |FINSI;

     |SI #dsmow104#2 ! 0; |O #dsmow104#3 ! 0;
         |SI nSwOp = 0;
             |SI #dsmow104#0 = "MANUAL      ";
                 #dsmod110#nNume1# = #dsmod110#nNume1# + #dsmow104#7;
             |SINO;
                 #dsmod110#nNume1# = #dsmod110#nNume1# + 1;
             |FINSI;
         |SINO;
             #dsmod110#nNume1# = 0;
         |FINSI;
     |FINSI;

     |SI #dsmow104#4 ! 0; |O #dsmow104#5 ! 0;
         |SI nSwOp = 0;
             |SI nNume2 ! 0;
                 |SI #dsmow104#0 = "MANUAL      ";
                     #dsmod110#nNume2# = #dsmod110#nNume2# + #dsmow104#8;
                 |SINO;
                     #dsmod110#nNume2# = #dsmod110#nNume2# + 1;
                 |FINSI;
             |FINSI;
         |SINO;
             |SI nNume2 ! 0; #dsmod110#nNume2# = 0; |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE RepasoAuxiliar;
     #dsmow104#1;
     ;
     "            ", 1;
     "zzzzzzzzzzzz", 5;
     ;
     NULL, RepasoAuxiliar;
|FIN;

|PROCESO RepasoAux;
     nSwOp = 1; |BUCLE RepasoAuxiliar;
     nSwOp = 0; |BUCLE RepasoAuxiliar;
|FPRC;

|PROCESO GrabaTodo;
     aFichero = ("x1" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dsmow104#aFichero#;
     |ABRE #dsmow104;  |CIERRA #dsmow104;  |DELINDEX #dsmow104;

     |ABRE #dsmod110;
     nImpAnt = 0;
     |SI enComplem > 0;
         #dsmod110#0 = enEmpresa;
         #dsmod110#1 = enEjer;
         #dsmod110#2 = enPeriodo;
         #dsmod110#3 = enModelo;
         #dsmod110#4 = enComplem - 1;
         #dsmod110#5 = 0;
         |LEE 101#dsmod110.=;
         |SI FSalida = 0;
             nImpAnt = #dsmod110#29 + #dsmod110#28;
             |SI nImpAnt < 0; nImpAnt = 0; |FINSI;
         |FINSI;
     |FINSI;

     #dsmod110#0 = enEmpresa;
     #dsmod110#1 = enEjer;
     #dsmod110#2 = enPeriodo;
     #dsmod110#3 = enModelo;
     #dsmod110#4 = enComplem;
     #dsmod110#5 = 0;
     |LEE 101#dsmod110.=;
     |SI FSalida = 0;
          |BORRA 020#dsmod110.a;
     |FINSI;

     |DDEFECTO #dsmod110;
     #dsmod110#0 = enEmpresa;
     #dsmod110#1 = enEjer;
     #dsmod110#2 = enPeriodo;
     #dsmod110#3 = enModelo;
     #dsmod110#4 = enComplem;
     #dsmod110#5 = 0;

     aNegativo = "N";
     |SI enEjer = 2015; |Y enPeriodo ] 11;
         |HAZ VerNegA15;
     |FINSI;

     |ABRE #dsmow162;
     nSwGraba = 0;
     nSwAux   = 0;
     |BUCLE dsmoc111;
     |CIERRA #dsmow162;
     |SI nSwGraba = 0;
         FSalida = 0;
         |SI enDesdePase = 0;
             |SI enMasivo = 1;
                 aAlfa = ("00000" + enEmpresa) % -105;
                 aAlfa = aAlfa + " " + eaNombreEmp; |QBF aAlfa;
                 aAlfa = "0000N"+ aAlfa + ". No hay registros NIF desea Impreso SIN Actividad ";
             |SINO;
                 aAlfa = "0000NNo hay registros de NIF desea Impreso SIN Actividad ";
             |FINSI;
             nNume = 1;
             |SI enNoPregunta = 0;
                 |CONFI aAlfa;
                 nNume = FSalida;
             |FINSI;
             |SI enMasivo = 1; |Y enFichW103 ! 0;
                 eaCa8103 = "S"; |SI nNume ! 0; eaCa8103 = "N"; |FINSI;
                 |HAZ eGrabaW103;
             |FINSI;
             FSalida = nNume;
         |FINSI;

         |SI FSalida = 0;
             #dsmoc111#0  = enEmpresa;
             #dsmoc111#1  = enEjer;
             #dsmoc111#2  = enPeriodo;
             #dsmoc111#3  = enModelo;
             #dsmoc111#4  = enComplem;
             #dsmoc111#5  = enActividad;
             #dsmoc111#6  = "            ";
             #dsmoc111#7  = 0000;
             #dsmoc111#8  = 0;
             #dsmoc111#9  = " ";
             #dsmoc111#10 = "  ";
             #dsmoc111#11 = 0;
             |LEE 101#dsmoc111.=;
             |SI FSalida ! 0;
                 |DDEFECTO #dsmoc111;
                 #dsmoc111#0  = enEmpresa;
                 #dsmoc111#1  = enEjer;
                 #dsmoc111#2  = enPeriodo;
                 #dsmoc111#3  = enModelo;
                 #dsmoc111#4  = enComplem;
                 #dsmoc111#5  = enActividad;
                 #dsmoc111#6  = "            ";
                 #dsmoc111#7  = 0000;
                 #dsmoc111#8  = 0;
                 #dsmoc111#9  = " ";
                 #dsmoc111#10 = "  ";
                 #dsmoc111#11 = 0;

                 |GRABA 020#dsmoc111.n;
             |FINSI;
             |LIBERA #dsmoc111;
             nSwGraba = 1;
         |FINSI;
     |SINO;
         |SI enDesdePase = 0; |Y aNegativo = "S";
             |SI enMasivo ! 1;
                 aAlfa = "0000Existen Registros de NIF con importes NEGATIVOS. Repase los datos";
                 |MENAV aAlfa;
             |FINSI;
             |SI enMasivo = 1; |Y enFichW103 ! 0;
                 eaCa8103 = "X";
                 |HAZ eGrabaW103;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSwGraba ! 0;
         |SI nSwAux = 1; |HAZ RepasoAux; |FINSI;

         |SI #dsmod110#4 ! 0;  |Y #dsmod110#30 = "             ";
             |ABRE #dsmom004;
             #dsmom004#0 = #dsmod110#0;
             #dsmom004#1 = #dsmod110#1;
             #dsmom004#2 = #dsmod110#2;
             #dsmom004#3 = #dsmod110#3;
             #dsmom004#4 = #dsmod110#4 - 1;
             |LEE 000#dsmom004.=;
             |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;
             |CIERRA #dsmom004;

             #dsmod110#30 = #dsmom004#25;
         |FINSI;

         |GRABA 020#dsmod110.n;
         |LIBERA #dsmod110;

         |ABRE #dsmom008;
         #dsmom008#0 = enEmpresa;
         #dsmom008#1 = enEjer;
         #dsmom008#2 = enPeriodo;
         #dsmom008#3 = enModelo;
         #dsmom008#4 = enComplem;
         #dsmom008#5 = enActividad;
         |LEE 101#dsmom008.=;
         |SI FSalida = 0;
             #dsmom008#11 = "COMPLETADO";
             |GRABA 020#dsmom008.a;
         |FINSI;
         |LIBERA #dsmom008;

         #dsmom008#0 = enEmpresa;
         #dsmom008#1 = enEjer;
         #dsmom008#2 = enPeriodo;
         #dsmom008#3 = enModelo;
         #dsmom008#4 = enComplem;
         #dsmom008#5 = 0;
         |LEE 101#dsmom008.=;
         |SI FSalida = 0;
             #dsmom008#11 = "EXISTENTE";
             |GRABA 020#dsmom008.a;
         |FINSI;
         |LIBERA #dsmom008;
         |CIERRA #dsmom008;
     |FINSI;
     |CIERRA #dsmod110;

     enSaldo1Ch = #dsmod110#27;

     |DELINDEX #dsmow104;
|FPRC;

|PROCESO Boton;
     |PTEC 827;
|FPRC;

|PROCESO Boton4;
     |PTEC 826;
|FPRC;

|PROCESO Tipo0Fc111;  |TIPO 0;
     |SI FSalida ! 13; |Y FSalida ! 12;  |ACABA;  |FINSI;

     |SI FSalida = 13; |Y  Campo [ 20;
         enCalculado = #dsmoc111#Campo#;
         |HAZ Calculadora;
         #dsmoc111#Campo# = enCalculado;
         |PINTA #dsmoc111#Campo#;
     |FINSI;

     |SI FSalida = 12;
         |PUSHV 0501 2379;

         |DDEFECTO #dsmow139;

         #dsmow139#0  = #dsmoc111#12;
         #dsmow139#1  = (#dsmoc111#13 / #dsmoc111#12) * 100;
         #dsmow139#2  = #dsmoc111#13;

         #dsmow139#3  = #dsmoc111#14;
         #dsmow139#4  = (#dsmoc111#15 / #dsmoc111#14) * 100;
         #dsmow139#5  = #dsmoc111#15;
         |SI #dsmoc111#16 ! 0;  #dsmow139#6 = "S";  |FINSI;

         #dsmow139#7  = #dsmoc111#18;

         |PINPA #0#dsmow139;
         |PINDA #0#dsmow139;

         |ENDATOS #1#dsmow139;
         |SI FSalida = 0;
             #dsmoc111#12 = #dsmow139#0 + #dsmow139#8  + #dsmow139#16 + #dsmow139#24 + #dsmow139#32 + #dsmow139#40;
             #dsmoc111#13 = #dsmow139#2 + #dsmow139#10 + #dsmow139#18 + #dsmow139#26 + #dsmow139#34 + #dsmow139#42;
             #dsmoc111#14 = #dsmow139#3 + #dsmow139#11 + #dsmow139#19 + #dsmow139#27 + #dsmow139#35 + #dsmow139#43;
             #dsmoc111#15 = #dsmow139#5 + #dsmow139#13 + #dsmow139#21 + #dsmow139#29 + #dsmow139#37 + #dsmow139#45;
             #dsmoc111#16 = 0;
             |SI #dsmow139#6  = "S";  #dsmoc111#16 = #dsmoc111#16 + #dsmow139#5;  |FINSI;
             |SI #dsmow139#14 = "S";  #dsmoc111#16 = #dsmoc111#16 + #dsmow139#13; |FINSI;
             |SI #dsmow139#22 = "S";  #dsmoc111#16 = #dsmoc111#16 + #dsmow139#21; |FINSI;
             |SI #dsmow139#30 = "S";  #dsmoc111#16 = #dsmoc111#16 + #dsmow139#29; |FINSI;
             |SI #dsmow139#38 = "S";  #dsmoc111#16 = #dsmoc111#16 + #dsmow139#37; |FINSI;
             |SI #dsmow139#46 = "S";  #dsmoc111#16 = #dsmoc111#16 + #dsmow139#45; |FINSI;

             #dsmoc111#18 = #dsmow139#7 + #dsmow139#15 + #dsmow139#23 + #dsmow139#31 + #dsmow139#39 + #dsmow139#47;
        |FINSI;

        |POPV;

        |PINTA #dsmoc111#12;  |PINTA #dsmoc111#13;
        |PINTA #dsmoc111#14;  |PINTA #dsmoc111#15;  |PINTA #dsmoc111#16;
        |PINTA #dsmoc111#18;
   |FINSI;
|FPRC;

|PROCESO AltaModelo;
     |ABRET #dsmoc111;
     |HAZ PintaDatos;

     enEntrada = 1;
     |PINPA #0#dsmoc111;

     |CONTROL_SIMPLE 0, "LBOTON,F5 Suma Importes", 0566, 0578, Boton;
     nBoton = FSalida;
     |CONTROL_SIMPLE 0, "LBOTON,F4 Calculadora/Desglose", 0544, 0564, Boton4;
     nBoton4 = FSalida;

     |ESTADO_CONTROL nBoton, "DISABLE";
     |ESTADO_CONTROL nBoton4, "DISABLE";

     |ENTLINEAL #1#dsmoc111, -7, 2, 22, 0, ClaveBaja0, ClaveAlta0;

     |FIN_CONTROL_WINDOWS nBoton;
     |FIN_CONTROL_WINDOWS nBoton4;

     |HAZ GrabaTodo;
     |CIERRAT #dsmoc111;
|FPRC;

|RUTINA ClaveBaja0;
     #dsmoc111#0  = enEmpresa;
     #dsmoc111#1  = enEjer;
     #dsmoc111#2  = enPeriodo;
     #dsmoc111#3  = enModelo;
     #dsmoc111#4  = enComplem;
     #dsmoc111#5  = enActividad;
     #dsmoc111#6  = "            ";
     #dsmoc111#7  = 0000;
     #dsmoc111#8  = nDMes;
     #dsmoc111#9  = " ";
     #dsmoc111#10 = "  ";
     #dsmoc111#11 = 0;
|FRUT;

|RUTINA ClaveAlta0;
     #dsmoc111#0  = enEmpresa;
     #dsmoc111#1  = enEjer;
     #dsmoc111#2  = enPeriodo;
     #dsmoc111#3  = enModelo;
     #dsmoc111#4  = enComplem;
     #dsmoc111#5  = enActividad;
     #dsmoc111#6  = "zzzzzzzzzzzz";
     #dsmoc111#7  = 9999;
     #dsmoc111#8  = 12;     || nHMes; tique 5006 _ 8
     #dsmoc111#9  = "z";
     #dsmoc111#10 = "zz";
     #dsmoc111#11 = 4;
|FRUT;

|PROCESO TipoCaptura;
     |ABRE #dsmom008;
     #dsmom008#0 = enEmpresa;
     #dsmom008#1 = enEjer;
     #dsmom008#2 = enPeriodo;
     #dsmom008#3 = enModelo;
     #dsmom008#4 = enComplem;
     #dsmom008#5 = enActividad;
     |LEE 101#dsmom008.=;
     |SI FSalida = 0;
          aTipoCaptura = #dsmom008#7;
          |QBF aTipoCaptura;
     |FINSI;
     |CIERRA #dsmom008;
|FPRC;

|PROGRAMA;
     |HAZ PatronM073;

     |ABRE #dsmom107;
     |DDEFECTO #dsmom107;
     |LEE 001#dsmom107.p;
     |CIERRA #dsmom107;

     nDMes = 1;
     nHMes = enPeriodo;

     aPeriodicidad = "TRIMESTRAL";
     |BUCLE dsmom002;

     eaNoVisu = "";
     eaNomDef = "dsmoc111";

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
          |HAZ PintaDatos;
          |ENTLINEAL #1#dsmoc111, -10, 4, 22, 1, ClaveBaja0, ClaveAlta0;
          |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              ||Baja del Modelo
         |HAZ BorraRegistros;
         |ABRET #dsmoc111;
         |HAZ GrabaTodo;
         |CIERRAT #dsmoc111;
         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo desde Modulo////////

     |SI enTipoEntrada = 97;              ||Baja del Modelo
         |HAZ BorraRegistros;
         |ACABA;
     |FINSI;

|| \\\\\\ Alta o Modificacion del Modelo ////////

     |SI enTipoEntrada = 1;              || Alta del Modelo
         |CABEZA "Modelo Trabajo 111";

         |ABRE #dsmom004;
         #dsmom004#0 = enEmpresa;
         #dsmom004#1 = enEjer;
         #dsmom004#2 = 99;
         #dsmom004#3 = 190;
         #dsmom004#4 = 99;
         |LEE 000#dsmom004.];
         |SI FSalida = 0;
             |LEE 000#dsmom004.a;
         |SINO;
             |LEE 000#dsmom004.u;
         |FINSI;

         |SI FSalida = 0;  |Y #dsmom004#0 = enEmpresa;  |Y #dsmom004#1 = enEjer;
          |Y #dsmom004#3 = 190;  |Y #dsmom004#7 = "X";
             |MENAV "0000El modelo anual 190 ya esta confeccionado, debera de recoger datos de nuevo.";
         |FINSI;
         |CIERRA #dsmom004;

         |HAZ AltaModelo;
         |ACABA;
     |FINSI;

|| \\\\\\ Grabacion del Modelo desde el Exterior

     |SI enTipoEntrada = 98;
         |ABRET #dsmoc111;
         |HAZ GrabaTodo;
         |CIERRAT #dsmoc111;
         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #dsmoc111;
         #dsmoc111#0  = enEmpresa;
         #dsmoc111#1  = enEjer;
         #dsmoc111#2  = enPeriodo;
         #dsmoc111#3  = enModelo;
         #dsmoc111#4  = enComplem;
         #dsmoc111#5  = enActividad;
         #dsmoc111#6  = "            ";
         #dsmoc111#7  = 0;
         #dsmoc111#8  = 0;
         #dsmoc111#9  = " ";
         #dsmoc111#10 = "  ";
         #dsmoc111#11 = 0;
         |LEE 040#dsmoc111.];
         |SI FSalida ! 0;  |O #dsmoc111#0 ! enEmpresa;  |O #dsmoc111#1 ! enEjer; |O #dsmoc111#2 ! enPeriodo;
          |O #dsmoc111#3 ! enModelo;  |O #dsmoc111#4 ! enComplem; |O #dsmoc111#5 ! enActividad;
             enExistencia = 1;
         |FINSI;
         |CIERRA #dsmoc111;
     |FINSI;
|FPRO;

|PROCESO Tipo88;  |TIPO 88;
     |HAZ Relaciones;
|FPRC;
