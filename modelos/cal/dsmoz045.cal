|FICHEROS;
    dsmoz045 #0;
    dsmom041 #41;
    dsmom042 #42;
    dsmom044 #44;
    dsmom045 #45;
    dsmom046 #46;
    dsmom049 #49;
|FIN;

|VARIABLES;
  nDEmpresa   = 0;
  nHEmpresa   = 0;
  nDActividad = 0;
  nHActividad = 0;
  nCampo      = 0;

  num   = 0;
  alfa1 = "";
  cfecha = @;
  vfecha = @;
  afiscal = 0;
  acontab = 0;
  importe = 0;
  sw = 0;
  ele1 = "";
  ele2 = "";
  nnum1 = 0;
  nnum2 = 0;
  Dtipo = "A";
  Htipo = "A";
  &nCamSel = 27;
  &nCamTip = 44;
  nLaEmpresa = -1;
  swBueno = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;
|INCLUYE i_numamo;
|INCLUYE i_selcon;

|| //////////////////// Calculos de Pantalla \\\\\\\\\\\\\\\\\\\\\\\\\\
|CALCULO Tipo7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#12 = enEmpresa; |PINTA #0#12;
         #0#13 = enEmpresa; |PINTA #0#13;

         |C_M #0#12, 1, "N";
         |C_M #0#13, 1, "N";
     |FINSI;
|FCAL;

|CALCULO Parrilla;
     |SI #0#12 = 0;
         #0#12 = 0;  |PINTA #0#12;
         #0#13 = 0;  |PINTA #0#13;  |C_M #0#13, 1, "N";
         |PARA nCampo = 14;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#12, 1, "S";
             |C_M #0#13, 1, "S";
         |FINSI;

         |PARA nCampo = 14;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO Todos; |TIPO 0;
 |SI #0Campo = "S";
     |PDEFECTO #0, 2,5;
     |C_M #0#2,1,"N"; |PINTA #0#2;
     |C_M #0#3,1,"N"; |PINTA #0#3;
     |C_M #0#4,1,"N"; |PINTA #0#4;
     |C_M #0#8,1,"S"; |C_M #0#9,1,"S"; |C_M #0#10,1,"S"; |C_M #0#11,1,"S";
     |C_M #0#26,1,"S";
 |SINO;
     |PDEFECTO #0, 8,12; #0#26 = "N";
     |C_M #0#8,1,"N"; |PINTA #0#8;
     |C_M #0#9,1,"N"; |PINTA #0#9;
     |C_M #0#10,1,"N"; |PINTA #0#10;
     |C_M #0#11,1,"N"; |PINTA #0#11;
     |C_M #0#26,1,"N"; |PINTA #0#26;
     |C_M #0#2,1,"S"; |C_M #0#3,1,"S"; |C_M #0#4,1,"S";
 |FINSI;
|FCAL;

|CALCULO vendo; |TIPO 0;
 |SI #0Campo = "S";
     |C_M #0#10,1,"S";
     |C_M #0#11,1,"S";
 |SINO;
     |PDEFECTO #0, 10,12;
     |C_M #0#10,1,"N"; |PINTA #0#10;
     |C_M #0#11,1,"N"; |PINTA #0#11;
 |FINSI;
|FCAL;

|CALCULO numamo; |TIPO 0;
   x_alfa1 = #0Campo;
   |HAZ x_punto;
   #0Campo = x_alfa1;
   |PINTA #0Campo;
|FCAL;

|CALCULO hasfec; |TIPO 0;
 |C_M #0Campo, 0, alfa1;
 |SI alfa1 = "N"; |ACABA; |FINSI;
 num = Campo - 1;
 |SI #0Campo < #0num;
      |MENAV "    ERROR !.  Fecha incorrecta !";
      |ERROR;
   |FINSI;
|FCAL;

|CALCULO ElModulo; |TIPO 0;
 |SI #0#42 = "S";
     |C_M #0#43, 1, "S";
 |SINO;
     |C_M #0#43, 1, "N";
     #0#43 = "0"; |PINTA #0#43;
 |FINSI;
|FCAL;

|| /////////////////////////// Procesos \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
|PROCESO L_Amortiza2;
   |SI #0#4 ! "A";   ||Seleccion Contabilizada S/N
      |SI #42#8 ! #0#4; |ACABA; |FINSI;
   |FINSI;

   #41#15 = #41#15 - #42#7;
   #41#21 = #41#21 - #42#11;
   #41#16 = #41#16 + #42#7;
   #41#22 = #41#22 + #42#11;
   |SI #41#26 > "01.01.1900";
       |SI #42#9 ] #41#26;
           #41#16 = #41#10 - #41#14;
           #41#22 = #41#10 - #41#21;
       |FINSI;
   |FINSI;

  |BORRA 020#42a;
  |LIBERA #42;
|FPRC;

|DEFBUCLE lineas;
   #42#1;
   6,9;                                      || Amorti. y Fecha Amortizacion
   #41#0,#41#2,#41#3, 000, Dtipo,#0#2;
   #41#0,#41#2,#41#3, 999, Htipo,#0#3;
   e;
   NULL, L_Amortiza2;
|FIN;

|| ---------------------------------------------------

|PROCESO BorraLineas46;
     |BORRA 140#46a;
     |LIBERA #46;
|FPRC;

|DEFBUCLE BorroLineas46;
     #46#1;
     ;
     #41#0, #41#2, #41#3, 00, "   ";
     #41#0, #41#2, #41#3, 99, "zzz";
     be;
     NULL, BorraLineas46;
|FIN;

|PROCESO BorraLineas49;
     |BORRA 140#49a;
     |LIBERA #49;
|FPRC;

|DEFBUCLE BorroLineas49;
     #49#1;
     ;
     #41#0, #41#2, #41#3, 00;
     #41#0, #41#2, #41#3, 99;
     be;
     NULL, BorraLineas49;
|FIN;

|PROCESO L_Amortiza1;
 |BORRA 020#42a;
 |LIBERA #42;
|FPRC;

|DEFBUCLE borrotodos;
   #42#1;
   ;
   #41#0,#41#2,#41#3, 000;
   #41#0,#41#2,#41#3, 999;
   e;
   NULL, L_Amortiza1;
|FIN;

|PROCESO BorroTodos;

     |ABRE #44;
     #44#0 = #41#0;
     #44#2 = #41#2;
     #44#3 = #41#3;
     |LEE 041#44=;
     |SI FSalida = 0;
         |BORRA 020#44a;
     |FINSI;
     |CIERRA #44;

     |ABRE #45;
     #45#0 = #41#0;
     #45#2 = #41#2;
     #45#3 = #41#3;
     |LEE 041#45=;
     |SI FSalida = 0;
         |BORRA 020#45a;
     |FINSI;
     |CIERRA #45;

     |BUCLE borrotodos;
     |BUCLE BorroLineas46;
     |BUCLE BorroLineas49;
|FPRC;

|PROCESO C_Amortiza;

   |SI nLaEmpresa ! #41#0;
       nLaEmpresa = #41#0;
       enEmpresa  = #41#0;
       swBueno = 0;
       |HAZ LaSelEmpresa;
       |SI enSwSelEmp = 1; swBueno = 1;  |FINSI;
   |FINSI;
   |SI swBueno = 1; |ACABA; |FINSI;

   |SI #0#6 ! "X";   ||Seleccion Anual / Periodica
      |SI #41#24 ! #0#6; |ACABA; |FINSI;
   |FINSI;

   |SI #0#42 = "N";
       |SI #41#28 ! 0;  |ACABA; |FINSI;
   |FINSI;
   |SI #0#42 = "S";
       |SI #41#28 = 0;  |ACABA; |FINSI;
       |SI #0#43 ! "T";
           |SI #41#28 ! #0#43; |ACABA; |FINSI;
       |FINSI;
   |FINSI;


   |SI #0#5 = "S";    || Borramos elemento Entero
       |SI #41#27 < #0#8; |O #41#27 > #0#9; |ACABA; |FINSI;
       |SI #0#26 = "S";
           |SI #41#26 < #0#10; |O #41#26 > #0#11; |ACABA; |FINSI;
       |SINO;
           |SI #41#26 > "01.01.1900"; |ACABA; |FINSI;
       |FINSI;
       |HAZ BorroTodos;
       |BORRA 020#41a;
   |SINO;
       |BUCLE lineas;
       |GRABA 020#41a;
   |FINSI;
   |LIBERA #41;
|FPRC;

|DEFBUCLE dsmoz045;
   #41#1;
   1;
   nDEmpresa, ele1, nnum1, nDActividad;
   nHEmpresa, ele2, nnum2, nHActividad;
   e;
   NULL, C_Amortiza;
|FIN;


|CALCULO Tipo3;  |TIPO 3;

  |SI #0#7 = "NO"; |ACABA; |FINSI;
  efFecTope = ~;
  nDActividad = 00;
  nHActividad = 99;
  ele1  = #0#0;
  ele2  = #0#1;
  nnum1 = #0#40;
  nnum2 = #0#41;
  |SI #0#12 ! 0;
         nDEmpresa = #0#12;
         nHEmpresa = #0#13;
         nLaEmpresa = -1;
         swBueno = 0;
         |BUCLE dsmoz045;
     |SINO;
         |PARA nCampo = 14; |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
               nDEmpresa = #0nCampo;
               nHEmpresa = #0nCampo;
               nLaEmpresa = -1;
               swBueno = 0;
               |BUCLE dsmoz045;
         |SIGUE;
     |FINSI;
|FCAL;
