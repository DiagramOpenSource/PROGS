|FICHEROS;
     dsmom002;
     dsmom004;
     dsmom016;
     dsmom017;
     dsmom019;
     dsmom030;
     dsmom033;
     dsmom047;
     dsmom080;
     dsmom081;
     dsmom085;
     dsmom086;
     dsmom087;

     dsmod300;
     dsmod330;
     dsmod370;
     dsmod310;
     dsmod303;
     dsmoc311;
     dsmoc310;
     dsm30301;
     dsm30302;
     dsm30303;

     dsm39001;
     dsm39002;
     dsm39003;
     dsm39004;
     dsm39006;
     dsm39005;

     dsmociva;
     dsmocivp;

     :/contagen/def/canempre;
     :/contagen/def/camaniva;
     :/contagen/def/caivalin;
     :/contagen/def/caivaasi;

     :/basica/def/agicen14;

     dsmow013;
     dsm3902@;
|FIN;

|VARIABLES;
     aAlfa1       = "";
     nSwHayPro    = 0;
     nSwHay300    = 0;
     nSwHay310    = 0;
     nCampo1      = 0;
     nCampo2      = 0;
     nCampo3      = 0;
     nCampo4      = 0;
     nCampo5      = 0;
     nCampo6      = 0;
     nCampo11     = 0;
     nCampo22     = 0;
     nCampo33     = 0;
     nCampo12     = 0;
     nCampo13     = 0;
     nCampo14     = 0;
     nCampo15     = 0;
     nCampo16     = 0;
     nCampo21     = 0;
     nCampo23     = 0;
     nCampo24     = 0;
     nCampo25     = 0;
     nCampo26     = 0;
     aCampo98     = "";
     nCasilla01   = 0;
     nSwAcum      = 0;
     nAtri        = 0;
     nContAtri    = 0;
     nError       = 0;
     nLinea       = 0;
     nPeriodo     = 0;
     nCampo       = 0;
     nCodigo      = 0;
     nCultivo     = 0;
     nDepar       = 0;
     nDPeriodo    = 0;
     nHPeriodo    = 0;
     nEjer        = 0;
     nUni1        = 0;
     nUni2        = 0;
     nUni3        = 0;
     nUni4        = 0;
     nUni5        = 0;
     nUni6        = 0;
     nUni7        = 0;
     nUni8        = 0;
     nUni9        = 0;
     nFactor      = 0;
     nTotal       = 0;
     nNume        = 0;
     nResta       = 0;
     nT300C       = 0;
     nT300C1      = 0;
     nT300C2      = 0;
     nT300C3      = 0;
     nT300C4      = 0;
     nT300C5      = 0;
     nT300C6      = 0;
     nT300C7      = 0;
     nT300C8      = 0;
     nT300C9      = 0;
     nT300C13     = 0;
     nT300C14     = 0;
     nT300C15     = 0;
     nPasa        = 0;
     nImpor       = 0;
     nOk          = 0;
     nModelo      = 0;
     aAlfa        = "";
     nBaseMas     = 0;
     nCuotaMas    = 0;
     nLaPro       = 0;
     nProrraDif   = 0;
     nPro         = 0;
     nSwP0 = 0; nSwP1 = 0; nSwP2 = 0; nSwP3 = 0;
     nSwP4 = 0; nSwP5 = 0; nSwP6 = 0; nSwP7 = 0; nSwP8 = 0;
     nM = 0;
     n49          = 0;
     n50          = 0;
     nHay12       = 0;
     nHay2_18     = 0;

     aCNAE   = "";
     nSwEsta = 0;
     nPara1  = 0;
     nQuants = 0;
     nPrim   = 0;
     nT7     = 0;
     nT9     = 0;
     nSwLimpio = 0;
     nErrorSinImporte = 0;
     aSubde   = "";

     nTPro     = 0;
     nTPro1    = 0;
     nTPro2    = 0;
     nTPro3    = 0;
     nTPro4    = 0;
     nTPro5    = 0;
     nTPro6    = 0;
     nTPro7    = 0;
     nImporte  = 0;
     nUltimo   = 0;
     nSwContar = 0;
     nImport1  = 0;
     nImport2  = 0;
     nTanto    = 0;
     nCampo165 = 0;

     nValor1   = 0;
     nValor2   = 0;
     nComplem  = 0;
     nTpComun  = 0;
     nTp100a   = 0;
     nSector   = 0;
     nVale     = 0;
     nNume1    = 0;
     nSubGrupo = 0;
     aBase     = "";
     aMas      = "";
|FIN;

|INCLUYE i_variar;

|PROCESO GrabaIVAEsp;
     nSwAcum = 0;
     |PARA nCampo11  = 12;  |SI nCampo11 [ 32;  |HACIENDO nCampo11 = nCampo11 + 3;
           nCampo22 = nCampo11 + 1;
           nCampo33 = nCampo11 + 2;

           |SI #dsm3902@#nCampo22# = #dsmociva#nCampo2#;
               #dsm3902@#nCampo11# = #dsm3902@#nCampo11# + #dsmociva#nCampo1#;
               #dsm3902@#nCampo33# = #dsm3902@#nCampo33# + ((#dsmociva#nCampo3# % nProrrata) ! 2) + nCampo165;
               nSwAcum = 1;
               |SAL;
           |FINSI;
           |SI nCampo11 = 21; nCampo11 = 23; |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo11  = 12;  |SI nCampo11 [ 32;  |HACIENDO nCampo11 = nCampo11 + 3;
               nCampo22 = nCampo11 + 1;
               nCampo33 = nCampo11 + 2;
               |SI #dsm3902@#nCampo22# = 0;
                   #dsm3902@#nCampo11# = #dsmociva#nCampo1#;
                   #dsm3902@#nCampo22# = #dsmociva#nCampo2#;
                   #dsm3902@#nCampo33# = ((#dsmociva#nCampo3# % nProrrata) ! 2) + nCampo165;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
               |SI nCampo11 = 21; nCampo11 = 23; |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         #dsm3902@#32 = #dsm3902@#32 + #dsmociva#nCampo1#;
         #dsm3902@#33 = -1;
         #dsm3902@#34 = #dsm3902@#34 + ((#dsmociva#nCampo3# % nProrrata) ! 2) + nCampo165;
     |FINSI;

     nProrraDif = nProrrata;
     nProrrata  = nLaPro;
     #dsm3902@#10 = #dsm3902@#12 + #dsm3902@#15 + #dsm3902@#18 + #dsm3902@#21;
     #dsm3902@#10 = #dsm3902@#10 + #dsm3902@#26 + #dsm3902@#29 + #dsm3902@#32;
     #dsm3902@#10 = #dsm3902@#10 + #dsm3902@#35 + #dsm3902@#38 + #dsm3902@#41;
     #dsm3902@#10 = #dsm3902@#10 + #dsm3902@#44 + #dsm3902@#47 + #dsm3902@#50;
     #dsm3902@#10 = #dsm3902@#10 + #dsm3902@#53;

     #dsm3902@#11 = #dsm3902@#14 + #dsm3902@#17 + #dsm3902@#20 + #dsm3902@#23;
     #dsm3902@#11 = #dsm3902@#11 + #dsm3902@#28 + #dsm3902@#31 + #dsm3902@#34;
     #dsm3902@#11 = #dsm3902@#11 + #dsm3902@#37 + #dsm3902@#40 + #dsm3902@#43;
     #dsm3902@#11 = #dsm3902@#11 + #dsm3902@#46 + #dsm3902@#49 + #dsm3902@#52;
     #dsm3902@#11 = #dsm3902@#11 + #dsm3902@#55;
|FPRC;

|PROCESO MiroVigentes;
     nHay2_18 = 0;
     nOk      = 0;
     |SI #dsmociva#7 = 7;  nOk = 1; |FINSI;
     |SI #dsmociva#7 = 8;  nOk = 1; |FINSI;
     |SI #dsmociva#7 = 9;  nOk = 1; |FINSI;
     |SI #dsmociva#7 = 10; nOk = 1; |FINSI;
     |SI #dsmociva#7 = 16; nOk = 1; |FINSI;
     |SI #dsmociva#7 = 17; nOk = 1; |FINSI;
     |SI nOk = 1; |ACABA; |FINSI;

     |SI #dsmociva#nCampo2# ! 0; |Y #dsmociva#nCampo2# ! 4;
         |Y #dsmociva#nCampo2# ! 10; |Y #dsmociva#nCampo2# ! 21;

             nHay2_18 = 1;
             #dsm3902@#0 = #dsm39001#0;
             #dsm3902@#1 = #dsm39001#1;
             #dsm3902@#2 = #dsm39001#2;
             #dsm3902@#3 = #dsm39001#3;
             #dsm3902@#4 = 2;
             #dsm3902@#5 = 18;
             |LEE 101#dsm3902@.=;
             |SI FSalida = 0;
                 |HAZ GrabaIVAEsp;
                 |GRABA 020#dsm3902@.a;
                 #dsmociva#12 = #dsmociva#12 - #dsmociva#nCampo1#;
                 #dsmociva#13 = #dsmociva#13 - #dsmociva#nCampo3#;
                 #dsmociva#nCampo1# = 0;
                 #dsmociva#nCampo2# = 0;
                 #dsmociva#nCampo3# = 0;
             |FINSI;
             |LIBERA #dsm3902@;
     |FINSI;
|FPRC;

|PROCESO GrabaIVA;
     nLaPro    = nProrrata;
     nProrrata = 100;

     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 < 8;
         |SI enEjer ] enEjerPro;
             nProrrata = nLaPro;
         |SINO;
              |SI #dsmociva#3 = 303;
                  |ABRE #dsmod303;
                  #dsmod303#0 = #dsmociva#0;
                  #dsmod303#1 = #dsmociva#1;
                  #dsmod303#2 = #dsmociva#2;
                  #dsmod303#3 = #dsmociva#3;
                  #dsmod303#4 = #dsmociva#4;
                  #dsmod303#5 = 0;
                  |LEE 040#dsmod303.=;
                  |SI FSalida ! 0;  |DDEFECTO #dsmod303;  |FINSI;
                  |CIERRA #dsmod303;

                  nProrrata = #dsmod303#64;
              |FINSI;

              |SI #dsmociva#3 = 300;
                   |ABRE #dsmod300;
                   #dsmod300#0 = #dsmociva#0;
                   #dsmod300#1 = #dsmociva#1;
                   #dsmod300#2 = #dsmociva#2;
                   #dsmod300#3 = #dsmociva#3;
                   #dsmod300#4 = #dsmociva#4;
                   #dsmod300#5 = 0;
                   |LEE 040#dsmod300.=;
                   |SI FSalida ! 0;  |DDEFECTO #dsmod300;  |FINSI;
                   |CIERRA #dsmod300;

                   nProrrata = #dsmod300#66;
              |FINSI;

              |SI #dsmociva#3 = 330;
                   |ABRE #dsmod330;
                   #dsmod330#0 = #dsmociva#0;
                   #dsmod330#1 = #dsmociva#1;
                   #dsmod330#2 = #dsmociva#2;
                   #dsmod330#3 = #dsmociva#3;
                   #dsmod330#4 = #dsmociva#4;
                   #dsmod330#5 = 0;
                   |LEE 040#dsmod330.=;
                   |SI FSalida ! 0;  |DDEFECTO #dsmod330;  |FINSI;
                   |CIERRA #dsmod330;

                   nProrrata = #dsmod330#70;
              |FINSI;

              |SI #dsmociva#3 = 370;
                   |ABRE #dsmod370;
                   #dsmod370#0 = #dsmociva#0;
                   #dsmod370#1 = #dsmociva#1;
                   #dsmod370#2 = #dsmociva#2;
                   #dsmod370#3 = #dsmociva#3;
                   #dsmod370#4 = #dsmociva#4;
                   #dsmod370#5 = 0;
                   |LEE 040#dsmod370.=;
                   |SI FSalida ! 0;  |DDEFECTO #dsmod370;  |FINSI;
                   |CIERRA #dsmod370;

                   nProrrata = #dsmod370#87;
              |FINSI;
         |FINSI;
     |FINSI;

     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 5;   nProrrata = 100;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 6;   nProrrata = 100;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 ] 9;   nProrrata = 100;  |FINSI;

     nCampo165 = 0; |SI nCampo5 > 0;  nCampo165 = #dsmocivp#nCampo5#; |FINSI;

     |SI #dsmociva#nCampo2# = 0;
         |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo3# ! 0;
             nVale = 0;
             |SI #dsmociva#6 = 1;
                 |SI #dsmociva#7 = 2; |O #dsmociva#7 = 3; nVale = 1; |FINSI;
             |FINSI;
             |SI nVale = 0;
                 |SI enEjer ] 2010;
                     #dsm39002#32 = #dsm39002#32 + #dsmociva#nCampo1#;
                     #dsm39002#33 = -1;
                     #dsm39002#34 = #dsm39002#34 + ((#dsmociva#nCampo3# % nProrrata) ! 2) + nCampo165;
                 |SINO;
                     #dsm39002#21 = #dsm39002#21 + #dsmociva#nCampo1#;
                     #dsm39002#22 = -1;
                     #dsm39002#23 = #dsm39002#23 + ((#dsmociva#nCampo3# % nProrrata) ! 2) + nCampo165;
                 |FINSI;
             |FINSI;
             nProrraDif = nProrrata;
             nProrrata  = nLaPro;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #dsmociva#6 = 2; |Y enEjer ] 2018;
         |HAZ MiroVigentes;
         |SI nHay2_18 = 1; |ACABA; |FINSI;
     |FINSI;

     nSwAcum = 0;
     |PARA nCampo11  = 12;  |SI nCampo11 [ 32;  |HACIENDO nCampo11 = nCampo11 + 3;
           nCampo22 = nCampo11 + 1;
           nCampo33 = nCampo11 + 2;

           |SI #dsm39002#nCampo22# = #dsmociva#nCampo2#;
               #dsm39002#nCampo11# = #dsm39002#nCampo11# + #dsmociva#nCampo1#;
               #dsm39002#nCampo33# = #dsm39002#nCampo33# + ((#dsmociva#nCampo3# % nProrrata) ! 2) + nCampo165;
               nSwAcum = 1;
               |SAL;
           |FINSI;
           |SI nCampo11 = 21; nCampo11 = 23; |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo11  = 12;  |SI nCampo11 [ 32;  |HACIENDO nCampo11 = nCampo11 + 3;
               nCampo22 = nCampo11 + 1;
               nCampo33 = nCampo11 + 2;
               |SI #dsm39002#nCampo22# = 0;
                   |SI #dsmociva#6 = 1; |Y #dsmociva#1 ] 2012;
                       |SI #dsmociva#7 = 1; |O #dsmociva#7 = 2; |O #dsmociva#7 = 3; |O #dsmociva#7 = 5;
                        |O #dsmociva#7 = 6; |O #dsmociva#7 = 14;
                            |SI #dsmociva#nCampo2# = 7; |O #dsmociva#nCampo2# = 16;
                                aAlfa = #dsmociva#nCampo2#;
                                aAlfa = "    Detectadas Bases al " + aAlfa + "%" + ", tipo no vigente. Modifique desglose";
                                |MENAV aAlfa;
                            |FINSI;
                       |FINSI;
                   |FINSI;

                   #dsm39002#nCampo11# = #dsmociva#nCampo1#;
                   #dsm39002#nCampo22#  = #dsmociva#nCampo2#;
                   #dsm39002#nCampo33# = ((#dsmociva#nCampo3# % nProrrata) ! 2) + nCampo165;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
               |SI nCampo11 = 21; nCampo11 = 23; |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         |SI enEjer ] 2010;
             #dsm39002#32 = #dsm39002#32 + #dsmociva#nCampo1#;
             #dsm39002#33 = -1;
             #dsm39002#34 = #dsm39002#34 + ((#dsmociva#nCampo3# % nProrrata) ! 2) + nCampo165;
         |SINO;
             #dsm39002#21 = #dsm39002#21 + #dsmociva#nCampo1#;
             #dsm39002#22 = -1;
             #dsm39002#23 = #dsm39002#23 + ((#dsmociva#nCampo3# % nProrrata) ! 2) + nCampo165;
         |FINSI;
     |FINSI;

     nProrraDif = nProrrata;
     nProrrata  = nLaPro;
|FPRC;

|PROCESO GrabaIVA_F3;
     nCampo165 = 0;

     |SI #dsmociva#nCampo2# = 0;
         |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo3# ! 0;
             #dsm39002#53 = #dsm39002#53 + #dsmociva#nCampo1#;
             #dsm39002#54 = -1;
             #dsm39002#55 = #dsm39002#55 + #dsmociva#nCampo3#;
             |ACABA;
         |FINSI;
     |FINSI;

     nSwAcum = 0;
     |PARA nCampo11  = 35;  |SI nCampo11 [ 53;  |HACIENDO nCampo11 = nCampo11 + 3;
           nCampo22 = nCampo11 + 1;
           nCampo33 = nCampo11 + 2;

           |SI #dsm39002#nCampo22# = #dsmociva#nCampo2#;
               #dsm39002#nCampo11# = #dsm39002#nCampo11# + #dsmociva#nCampo1#;
               #dsm39002#nCampo33# = #dsm39002#nCampo33# + #dsmociva#nCampo3#;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo11  = 35;  |SI nCampo11 [ 53;  |HACIENDO nCampo11 = nCampo11 + 3;
               nCampo22 = nCampo11 + 1;
               nCampo33 = nCampo11 + 2;
               |SI #dsm39002#nCampo22# = 0;
                   #dsm39002#nCampo11# = #dsmociva#nCampo1#;
                   #dsm39002#nCampo22# = #dsmociva#nCampo2#;
                   #dsm39002#nCampo33# = #dsmociva#nCampo3#;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         #dsm39002#53 = #dsm39002#53 + #dsmociva#nCampo1#;
         #dsm39002#54 = -1;
         #dsm39002#55 = #dsm39002#55 + #dsmociva#nCampo3#;
     |FINSI;
|FPRC;

|PROCESO LeeRestoPror;
      nBaseMas = 0;
      nCuotaMas = 0;

      |DDEFECTO #dsmocivp;

      |SI #dsmociva#7 ! 5; |Y #dsmociva#7 ! 6;
          |ABRE #dsmocivp;
          |DDEFECTO #dsmocivp;
          #dsmocivp#0 = #dsmociva#0;
          #dsmocivp#1 = #dsmociva#1;
          #dsmocivp#2 = #dsmociva#2;
          #dsmocivp#3 = #dsmociva#3;
          #dsmocivp#4 = #dsmociva#4;
          #dsmocivp#5 = #dsmociva#5;
          #dsmocivp#6 = #dsmociva#6;
          #dsmocivp#7 = #dsmociva#7;
          |LEE 001#dsmocivp.=;
          |SI FSalida = 0;
              nBaseMas  = #dsmocivp#10 + #dsmocivp#13 + #dsmocivp#16 + #dsmocivp#19;
              nCuotaMas = #dsmocivp#12 + #dsmocivp#15 + #dsmocivp#18 + #dsmocivp#21;
          |FINSI;
          |CIERRA #dsmocivp;
      |FINSI;

      |SI enEjer ] enEjerPro;

          nCuotaMas = 0;
          |SI eaDesg109 = "S";
              |SI #dsmociva#7 = 1; |Y nSwP1 = 0; nCuotaMas = - enImpProrrat1; nSwP1 = 1; |FINSI;
              |SI #dsmociva#7 = 2; |Y nSwP2 = 0; nCuotaMas = - enImpProrrat2; nSwP2 = 1; |FINSI;
              |SI #dsmociva#7 = 3; |Y nSwP3 = 0; nCuotaMas = - enImpProrrat3; nSwP3 = 1; |FINSI;
              |SI #dsmociva#7 = 4; |Y nSwP4 = 0; nCuotaMas = - enImpProrrat4; nSwP4 = 1; |FINSI;
              |SI #dsmociva#7 = 5; |Y nSwP5 = 0; nCuotaMas = - enImpProrrat5; nSwP5 = 1; |FINSI;
              |SI #dsmociva#7 = 6; |Y nSwP6 = 0; nCuotaMas = - enImpProrrat6; nSwP6 = 1; |FINSI;
              |SI #dsmociva#7 = 7; |Y nSwP7 = 0; nCuotaMas = - enImpProrrat7; nSwP7 = 1; |FINSI;
          |SINO;
              |SI #dsmociva#7 = 1; |Y nSwP0 = 0; nCuotaMas = - enImpProrrata; nSwP0 = 1; |FINSI;
          |FINSI;
          |SI enEjer ] 2009;
              |SI #dsmociva#7 = 10; |Y #dsmociva#2 =12; |Y nSwP8 = 0;
                  nCuotaMas = enImpProrrat36; nSwP8 = 1;
              |FINSI;
          |FINSI;
          #dsmocivp#9  = 0;
          #dsmocivp#12 = nCuotaMas;
          |SI nCuotaMas ! 0;  #dsmocivp#9 = nCuotaMas; |FINSI;

          |SI enEjer ] 2010;      || apartir del 2010, resto al final
              |SI #dsmociva#7 ! 10;
                  #dsmocivp#9  = 0;
                  #dsmocivp#12 = 0;
                  nCuotaMas = 0;
              |FINSI;
          |FINSI;

      |FINSI;

      |SI enEjer ] 2011; |Y enSwProrr ! 2;
          |SI #dsmociva#7 = 0; |ACABA; |FINSI;
          |SI #dsmociva#7 > 7; |Y #dsmociva#7 < 13; |ACABA; |FINSI;

         |ABRE #dsmom087;
         #dsmom087#0 = #dsmociva#0;
         #dsmom087#1 = #dsmociva#1;
         #dsmom087#2 = #dsmociva#2;
         #dsmom087#3 = #dsmociva#3;
         #dsmom087#4 = #dsmociva#4;
         #dsmom087#5 = #dsmociva#5;
         #dsmom087#6 = #dsmociva#6;
         #dsmom087#7 = #dsmociva#7;
         |LEE 141#dsmom087.=;
         |SI FSalida = 0;
             #dsmociva#13 = #dsmom087#9;
             #dsmociva#16 = #dsmom087#17 + #dsmom087#41;
             #dsmociva#19 = #dsmom087#20 + #dsmom087#43;
             #dsmociva#22 = #dsmom087#23 + #dsmom087#45;
             #dsmociva#25 = #dsmom087#26 + #dsmom087#47;
             #dsmociva#28 = #dsmom087#29 + #dsmom087#49;
             #dsmociva#31 = #dsmom087#32 + #dsmom087#51;
             #dsmociva#34 = #dsmom087#35 + #dsmom087#53;
        |FINSI;
        |CIERRA #dsmom087;
      |FINSI;
|FPRC;

|PROCESO LeeEl47;
     |ABRE #dsmom047;
     #dsmom047#0 = enEmpresa;
     #dsmom047#1 = enEjer;
     #dsmom047#2 = nPeriodo;
     #dsmom047#3 = nM;
     #dsmom047#4 = #dsmom004#4;
     #dsmom047#5 = 0;
     |LEE 040#dsmom047.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom047;
     |SINO;
         nSwHayPro = 1;
     |FINSI;
     |CIERRA #dsmom047;

     enImpProrrat1 = enImpProrrat1 + #dsmom047#6;
     enImpProrrat2 = enImpProrrat2 + #dsmom047#7;
     enImpProrrat3 = enImpProrrat3 + #dsmom047#8;
     enImpProrrat4 = enImpProrrat4 + #dsmom047#9;
     enImpProrrat5 = enImpProrrat5 + #dsmom047#10;
     enImpProrrat6 = enImpProrrat6 + #dsmom047#11;
     enImpProrrat7 = enImpProrrat7 + #dsmom047#12;
     enImpProrrata = enImpProrrata + (#dsmom047#6 + #dsmom047#7 + #dsmom047#8 + #dsmom047#9 + #dsmom047#10 + #dsmom047#11 + #dsmom047#12);

     nTPro  = nTPro  + enImpProrrata;
     nTPro1 = nTPro1 + enImpProrrat1;
     nTPro2 = nTPro2 + enImpProrrat2;
     nTPro3 = nTPro3 + enImpProrrat3;
     nTPro4 = nTPro4 + enImpProrrat4;
     nTPro5 = nTPro5 + enImpProrrat5;
     nTPro6 = nTPro6 + enImpProrrat6;
     nTPro7 = nTPro7 + enImpProrrat7;
|FPRC;

|PROCESO EspecialVolGral09;
         #dsm39002#0 = #dsm39001#0;
         #dsm39002#1 = #dsm39001#1;
         #dsm39002#2 = #dsm39001#2;
         #dsm39002#3 = #dsm39001#3;
         #dsm39002#4 = 3;
         #dsm39002#5 = 1;
         |LEE 101#dsm39002.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |PARA nCampo1 = 14;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               nCampo4 = nCampo1 - 4;
               nCampo5 = nCampo3 - 4;
               |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                   |O #dsmocivp#nCampo5# ! 0;
                   |HAZ GrabaIVA;
               |FINSI;
        |SIGUE;

        |PARA nCampo1 = 13;  |SI nCampo1 [ 22;  |HACIENDO nCampo1 = nCampo1 + 3;
              |SI #dsm39002#nCampo1# = -1;  #dsm39002#nCampo1# = 0;  |FINSI;
        |SIGUE;

        |SI #dsm39002#12 ! 0;  |O #dsm39002#15 ! 0;  |O #dsm39002#18 ! 0;  |O #dsm39002#21 ! 0;
              |O #dsm39002#28 ! 0; |O #dsm39002#31 ! 0; |O #dsm39002#34 ! 0;

            #dsm39002#10 = #dsm39002#12 + #dsm39002#15 + #dsm39002#18 + #dsm39002#21;
            #dsm39002#10 = #dsm39002#10 + #dsm39002#26 + #dsm39002#29 + #dsm39002#32;

            #dsm39002#11 = #dsm39002#14 + #dsm39002#17 + #dsm39002#20 + #dsm39002#23;
            #dsm39002#11 = #dsm39002#11 + #dsm39002#28 + #dsm39002#31 + #dsm39002#34;
        |SINO;
            #dsm39002#10 = #dsm39002#10 + #dsmociva#12;
            #dsm39002#11 = #dsm39002#11 + #dsmociva#13;
        |FINSI;
        |GRABA 020#dsm39002.a;
        |LIBERA #dsm39002;
        nSwHay300 = 1;
|FPRC;

|PROCESO Graba390_2;
     |SI #dsmociva#1 = 2009;  || Solucionar fallo del dsmociva;
         |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 1;
             nCasilla01 = #dsmociva#12;
         |FINSI;

         |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 4;
             |SI #dsmociva#12 = nCasilla01;
                  #dsmociva#12 = 0;
                  |GRABA 020#dsmociva.a;
                  |LIBERA #dsmociva;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #dsmociva#1 = 2014;
         |SI #dsmociva#6 = 3; |Y #dsmociva#7 = 4;
             |SI #dsmociva#12 ! 0; |Y #dsmociva#14 = 0;
                 #dsmociva#14 = #dsmociva#12;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 10;  |Y #dsm39001#1 ] 2008;
         |SI #dsmociva#12 ! 0;  |O #dsmociva#13 ! 0;
             |SI #dsmociva#16 = 0;  |Y #dsmociva#19 = 0;  |Y #dsmociva#22 = 0;  |Y #dsmociva#25 = 0; |Y #dsmociva#28 = 0; |Y #dsmociva#31 = 0; |Y #dsmociva#34 = 0;
                 #dsmociva#12 = 0;
                 #dsmociva#13 = 0;
                 |GRABA 020#dsmociva.a;
                 |LIBERA #dsmociva;
                 |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 11;  |Y #dsm39001#1 ] 2008;
         |ACABA;
     |FINSI;

     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 12;  |Y #dsm39001#1 ] 2008;
         |ACABA;
     |FINSI;

     nBaseMas = 0;
     nCuotaMas = 0;
     |DDEFECTO #dsmocivp;
     |SI #dsmociva#6 = 2;  |HAZ LeeRestoPror;  |FINSI;

     |SI #dsmociva#12 ! 0;  |O #dsmociva#13 ! 0; |O nCuotaMas ! 0;
         #dsm39002#0 = #dsm39001#0;
         #dsm39002#1 = #dsm39001#1;
         #dsm39002#2 = #dsm39001#2;
         #dsm39002#3 = #dsm39001#3;
         #dsm39002#4 = #dsmociva#6;
         #dsm39002#5 = #dsmociva#7;
         |SI #dsmociva#1 ] 2010;  |Y #dsmociva#1 [ 2013;
             |SI #dsmociva#6 = 3;
                 |SI #dsmociva#7 = 4; #dsm39002#4 = 4; #dsm39002#5 = 9; |FINSI;
                 |SI #dsmociva#7 = 7; #dsm39002#4 = 4; #dsm39002#5 = 7; |FINSI;
             |FINSI;

             |SI #dsmociva#6 = 2;
                 |SI #dsmociva#7 = 14; #dsm39002#5 = 11; |FINSI;
                 |SI #dsmociva#7 = 15; #dsm39002#5 = 12; |FINSI;
             |FINSI;
         |FINSI;

         |LEE 101#dsm39002.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |SI #dsm39002#4 = 5;  |Y #dsm39002#5 = 1;
             nAtri     = nAtri     + #dsm39002#10;
             nContAtri = nContAtri + 1;
             #dsm39002#10   = nAtri / nContAtri;
             |SI #dsm39002#10 ! 100;
                 #dsm39001#55 = #dsm39002#10;
             |FINSI;
         |SINO;

              |PARA nCampo1 = 14;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
                   nCampo2 = nCampo1 + 1;
                   nCampo3 = nCampo1 + 2;
                   nCampo4 = nCampo1 - 4;
                   nCampo5 = nCampo3 - 4;
                   |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                       |O #dsmocivp#nCampo5# ! 0;
                       |HAZ GrabaIVA;
                   |FINSI;
              |SIGUE;

              |SI enEjer ] 2010;
                  |SI #dsmociva#6 = 1; |Y #dsmociva#7 = 6;
                      |PARA nCampo1 = 26;  |SI nCampo1 [ 34;  |HACIENDO nCampo1 = nCampo1 + 3;
                            nCampo2 = nCampo1 + 1;
                            nCampo3 = nCampo1 + 2;
                            nCampo5 = -1;
                            |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                                |HAZ GrabaIVA;
                            |FINSI;
                      |SIGUE;
                      |PARA nCampo1 = 35;  |SI nCampo1 [ 55;  |HACIENDO nCampo1 = nCampo1 + 3;
                            nCampo2 = nCampo1 + 1;
                            nCampo3 = nCampo1 + 2;
                            nCampo5 = -1;
                            |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                                |HAZ GrabaIVA_F3;
                            |FINSI;
                      |SIGUE;
                  |SINO;
                      |PARA nCampo1 = 26;  |SI nCampo1 [ 53;  |HACIENDO nCampo1 = nCampo1 + 3;
                            nCampo2 = nCampo1 + 1;
                            nCampo3 = nCampo1 + 2;
                            nCampo5 = -1;
                            |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                                |HAZ GrabaIVA;
                            |FINSI;
                      |SIGUE;
                  |FINSI;
             |FINSI;

             |SI #dsmociva#6 = 2;   |Y #dsmociva#7 ! 9; |Y #dsmociva#7 ! 10;  |Y #dsmociva#7 ! 11;
               |Y #dsmociva#7 ! 12; |Y #dsmociva#7 ! 16; |Y #dsmociva#7 ! 17;

                 |SI #dsmociva#13 ! 0; |Y #dsmociva#12 = 0; |Y #dsmociva#7 < 8;
                     nErrorSinImporte = 1;
                 |FINSI;

                 |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 1;
                     nT300C1 = nT300C1 + (((#dsmociva#13 % nProrraDif) ! 2) + #dsmocivp#9) ! 2;
                 |FINSI;

                 |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 2;
                     nT300C2 = nT300C2 + (((#dsmociva#13 % nProrraDif) ! 2) + #dsmocivp#9) ! 2;
                 |FINSI;

                 |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 3;
                     nT300C3 = nT300C3 + (((#dsmociva#13 % nProrraDif) ! 2) + #dsmocivp#9) ! 2;
                 |FINSI;

                 |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 4;
                     nT300C4 = nT300C4 + (((#dsmociva#13 % nProrraDif) ! 2) + #dsmocivp#9) ! 2;
                 |FINSI;

                 |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 5;
                     nT300C5 = nT300C5 + (((#dsmociva#13 % nProrraDif) ! 2) + #dsmocivp#9) ! 2;
                 |FINSI;

                 |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 6;
                     nT300C6 = nT300C6 + (((#dsmociva#13 % nProrraDif) ! 2) + #dsmocivp#9) ! 2;
                 |FINSI;

                 |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 7;
                     nT300C7 = nT300C7 + (((#dsmociva#13 % nProrraDif) ! 2) + #dsmocivp#9) ! 2;
                 |FINSI;

                 |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 8;
                     nT300C8 = nT300C8 + (((#dsmociva#13 % nProrraDif) ! 2) + #dsmocivp#9) ! 2;
                 |FINSI;

                 |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 9;
                     nT300C9 = nT300C9 + (((#dsmociva#13 % nProrraDif) ! 2) + #dsmocivp#9) ! 2;
                 |FINSI;

                 |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 13;
                     nT300C13 = nT300C13 + (((#dsmociva#13 % nProrraDif) ! 2) + #dsmocivp#9) ! 2;
                 |FINSI;

                 |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 14;
                     nT300C14 = nT300C14 + (((#dsmociva#13 % nProrraDif) ! 2) + #dsmocivp#9) ! 2;
                 |FINSI;

                 |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 15;
                     nT300C15 = nT300C15 + (((#dsmociva#13 % nProrraDif) ! 2) + #dsmocivp#9) ! 2;
                 |FINSI;
                 || #dsm39002#11 = #dsm39002#14 + #dsm39002#17 + #dsm39002#20 + #dsm39002#23;

                 nT300C  = 0;

                 |SI #dsmociva#7 = 1;   nT300C = nT300C1;   |FINSI;
                 |SI #dsmociva#7 = 2;   nT300C = nT300C2;   |FINSI;
                 |SI #dsmociva#7 = 3;   nT300C = nT300C3;   |FINSI;
                 |SI #dsmociva#7 = 4;   nT300C = nT300C4;   |FINSI;
                 |SI #dsmociva#7 = 5;   nT300C = nT300C5;   |FINSI;
                 |SI #dsmociva#7 = 6;   nT300C = nT300C6;   |FINSI;
                 |SI #dsmociva#7 = 7;   nT300C = nT300C7;   |FINSI;
                 |SI #dsmociva#7 = 8;   nT300C = nT300C8;   |FINSI;
                 |SI #dsmociva#7 = 9;   nT300C = nT300C9;   |FINSI;
                 |SI #dsmociva#7 = 13;  nT300C = nT300C13;  |FINSI;
                 |SI #dsmociva#7 = 14;  nT300C = nT300C14;  |FINSI;
                 |SI #dsmociva#7 = 15;  nT300C = nT300C15;  |FINSI;

                 || nResta = nT300C - #dsm39002#11;
                 nResta = (nT300C - (#dsm39002#14 + #dsm39002#17 + #dsm39002#20 + #dsm39002#23 + #dsm39002#28 + #dsm39002#31 + #dsm39002#34)) ! EURODBMOD;
                 |SI nResta ! 0;
                     |PARA nCampo11  = 14;  |SI nCampo11 [ 34;  |HACIENDO nCampo11 = nCampo11 + 3;
                           |SI #dsm39002#nCampo11# ! 0;
                               #dsm39002#nCampo11# = #dsm39002#nCampo11# + nResta;
                               |SAL;
                           |FINSI;
                           |SI nCampo11 = 23; nCampo11 = 25; |FINSI;
                     |SIGUE;
                 |FINSI;
             |FINSI;

             |PARA nCampo1 = 13;  |SI nCampo1 [ 33;  |HACIENDO nCampo1 = nCampo1 + 3;
                   |SI #dsm39002#nCampo1# = -1;  #dsm39002#nCampo1# = 0;  |FINSI;
                   |SI nCampo1 = 22; nCampo1 = 24; |FINSI;
             |SIGUE;

             |SI #dsm39002#12 ! 0; |O #dsm39002#15 ! 0; |O #dsm39002#18 ! 0; |O #dsm39002#21 ! 0;
              |O #dsm39002#28 ! 0; |O #dsm39002#31 ! 0; |O #dsm39002#34 ! 0;
              |O #dsm39002#37 ! 0; |O #dsm39002#40 ! 0; |O #dsm39002#43 ! 0; |O #dsm39002#46 ! 0;
              |O #dsm39002#49 ! 0; |O #dsm39002#52 ! 0; |O #dsm39002#55 ! 0;
                 #dsm39002#10 = #dsm39002#12 + #dsm39002#15 + #dsm39002#18 + #dsm39002#21;
                 #dsm39002#10 = #dsm39002#10 + #dsm39002#26 + #dsm39002#29 + #dsm39002#32;
                 #dsm39002#10 = #dsm39002#10 + #dsm39002#35 + #dsm39002#38 + #dsm39002#41;
                 #dsm39002#10 = #dsm39002#10 + #dsm39002#44 + #dsm39002#47 + #dsm39002#50;
                 #dsm39002#10 = #dsm39002#10 + #dsm39002#53;

                 #dsm39002#11 = #dsm39002#14 + #dsm39002#17 + #dsm39002#20 + #dsm39002#23;
                 #dsm39002#11 = #dsm39002#11 + #dsm39002#28 + #dsm39002#31 + #dsm39002#34;
                 #dsm39002#11 = #dsm39002#11 + #dsm39002#37 + #dsm39002#40 + #dsm39002#43;
                 #dsm39002#11 = #dsm39002#11 + #dsm39002#46 + #dsm39002#49 + #dsm39002#52;
                 #dsm39002#11 = #dsm39002#11 + #dsm39002#55;
             |SINO;
                 #dsm39002#10 = #dsm39002#10 + #dsmociva#12;
                 #dsm39002#11 = #dsm39002#11 + #dsmociva#13;
             |FINSI;

             |SI #dsmociva#6 = 2; |Y #dsmociva#7 = 10; |Y #dsmociva#2 = 12;
                 #dsm39002#11 = #dsm39002#14 + #dsm39002#17 + #dsm39002#20 + #dsm39002#23;
                 #dsm39002#11 = #dsm39002#11 + #dsm39002#28 + #dsm39002#31 + #dsm39002#34;
             |FINSI;
         |FINSI;

         |GRABA 020#dsm39002.a;
         |LIBERA #dsm39002;

         nSwHay300 = 1;

         |SI #dsmociva#6 = 3; |Y #dsmociva#1 = 2009;
             |SI #dsmociva#7 = 5; |O #dsmociva#7 = 6;
                  |PARA nCampo1 = 12;  |SI nCampo1 [ 25;  |HACIENDO nCampo1 = nCampo1 + 1;
                        |SI #dsmociva#nCampo1# ! 0;
                            #dsmociva#nCampo1# = -#dsmociva#nCampo1#;
                        |FINSI;
                        |SI nCampo1 = 14; nCampo1 = 15; |FINSI;
                        |SI nCampo1 = 17; nCampo1 = 18; |FINSI;
                        |SI nCampo1 = 20; nCampo1 = 21; |FINSI;
                        |SI nCampo1 = 23; nCampo1 = 24; |FINSI;
                  |SIGUE;
                  |HAZ EspecialVolGral09;
             |FINSI;
         |FINSI;
     |FINSI;
     |LIBERA #dsmociva;
|FPRC;

|DEFBUCLE dsmociva;
     #dsmociva#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 01, 0,  0;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 99, 9, 99;
     be;
     NULL, Graba390_2;
|FIN;

|PROCESO BorraVarDed;
     nT300C    = 0;
     nT300C1   = 0;
     nT300C2   = 0;
     nT300C3   = 0;
     nT300C4   = 0;
     nT300C5   = 0;
     nT300C6   = 0;
     nT300C7   = 0;
     nT300C8   = 0;
     nT300C9   = 0;
     nT300C13  = 0;
     nT300C14  = 0;
     nT300C15  = 0;

     nTPro  = 0;
     nTPro1 = 0;
     nTPro2 = 0;
     nTPro3 = 0;
     nTPro4 = 0;
     nTPro5 = 0;
     nTPro6 = 0;
     nTPro7 = 0;
|FPRC;

|PROCESO Graba390_3;
     #dsmom017#0 = #dsmom019#0;
     #dsmom017#1 = #dsmom019#1;
     #dsmom017#2 = #dsmom019#2;
     #dsmom017#3 = #dsmom019#3;
     |LEE 040#dsmom017.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsmom016#0  = #dsmom017#4;
     #dsmom016#1  = #dsmom017#5;
     #dsmom016#41 = #dsmom017#6;
     #dsmom016#2  = #dsmom017#1;
     |LEE 040#dsmom016.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom016;  |FINSI;

     |ABRE #dsmom002;
     #dsmom002#0 = #dsmom019#0; || Empresa
     #dsmom002#1 = #dsmom019#3; || Actividad
     #dsmom002#2 = nModelo;
     |LEE 040#dsmom002.=;
     |SI FSalida ! 0;
         #dsmom002#0 = #dsmom019#0;
         #dsmom002#1 = #dsmom019#3;
         #dsmom002#2 = 370;
         |LEE 040#dsmom002.=;
         |SI FSalida ! 0
             |CIERRA #dsmom002;
             |ACABA;
         |FINSI;
     |FINSI;
     |CIERRA #dsmom002;
     |SI #dsmom002#8 > "01.01.1900";
         aAlfa = #dsmom002#8; aAlfa = aAlfa % -104; nNume = aAlfa;
         |SI nNume > #dsmom019#1; |ACABA; |FINSI;
     |FINSI;
     |SI #dsmom002#9 > "01.01.1900";
         aAlfa = #dsmom002#9; aAlfa = aAlfa % -104; nNume = aAlfa;
         |SI nNume < #dsmom019#1; |ACABA; |FINSI;
     |FINSI;

     |PARA nPeriodo = 3; |SI nPeriodo [ 12;  |HACIENDO nPeriodo = nPeriodo + 3;
           nError = 0;
           #dsmom004#0   = #dsm39001#0;
           #dsmom004#1   = #dsm39001#1;
           #dsmom004#2   = nPeriodo;
           #dsmom004#3   = nModelo;
           #dsmom004#4   = 0;
           |LEE 040#dsmom004.=;
           |SI FSalida = 0;
               |SI #dsmom004#7 = "X";  |Y #dsmom004#9 ! "X";  |Y enSwCheq390 = 0;
                   nError = 1;
               |FINSI;
           |SINO;
               nError = 2;
           |FINSI;

           |SI nError > 0; |Y #dsm39001#1 < 2014;
               #dsmom004#0   = #dsm39001#0;
               #dsmom004#1   = #dsm39001#1;
               #dsmom004#2   = nPeriodo;
               #dsmom004#3   = 370;
               #dsmom004#4   = 0;
               |LEE 040#dsmom004.=;
               |SI FSalida = 0;
                   |SI #dsmom004#7 = "X";  |Y #dsmom004#9 ! "X";  |Y enSwCheq390 = 0;
                       nError = 1;
                   |SINO;
                       nError  = 0;
                   |FINSI;
               |SINO;
                   |SI nError = 2; nError = 0;  |FINSI;
              |FINSI;
           |FINSI;

           |SI nError = 1;
               aAlfa = "    Modelos sin Imprimir, Empresa = " + #dsmom004#0 + ", Pase Abortado";
               |MENAV aAlfa;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     nLinea = nLinea + 1;
     #dsm39003#0 = #dsm39001#0;
     #dsm39003#1 = #dsm39001#1;
     #dsm39003#2 = #dsm39001#2;
     #dsm39003#3 = #dsm39001#3;
     #dsm39003#4 = nLinea;
     #dsm39003#5 = #dsmom017#5;

     nUni1    = #dsmom019#48;
     nTotal   = #dsmom019#15 * #dsmom019#48;
     |SI nTotal ! #dsmom019#59;  nUni1 = #dsmom019#59 / #dsmom019#15;  |FINSI;

     nUni2   = #dsmom019#49;
     nTotal  = #dsmom019#16 * #dsmom019#49;
     |SI nTotal ! #dsmom019#60;  nUni2 = #dsmom019#60 / #dsmom019#16;  |FINSI;

     nUni3   = #dsmom019#50;
     nTotal  = #dsmom019#17 * #dsmom019#50;
     |SI nTotal ! #dsmom019#61;  nUni3 = #dsmom019#61 / #dsmom019#17;  |FINSI;

     nUni4   = #dsmom019#51;
     nTotal  = #dsmom019#18 * #dsmom019#51;
     |SI nTotal ! #dsmom019#62;  nUni4 = #dsmom019#62 / #dsmom019#18;  |FINSI;

     nUni5   = #dsmom019#52;
     nTotal  = #dsmom019#19 * #dsmom019#52;
     |SI nTotal ! #dsmom019#63;  nUni5 = #dsmom019#63 / #dsmom019#19;  |FINSI;

     nUni6   = #dsmom019#53;
     nTotal  = #dsmom019#20 * #dsmom019#53;
     |SI nTotal ! #dsmom019#64;  nUni6 = #dsmom019#64 / #dsmom019#20;  |FINSI;

     nUni7   = #dsmom019#54;
     nTotal  = #dsmom019#21 * #dsmom019#54;
     |SI nTotal ! #dsmom019#65;  nUni7 = #dsmom019#65 / #dsmom019#21;  |FINSI;

     nUni8   = #dsmom019#55;
     nTotal  = #dsmom019#22 * #dsmom019#55;
     |SI nTotal ! #dsmom019#66;  nUni8 = #dsmom019#66 / #dsmom019#22;  |FINSI;

     nUni9   = #dsmom019#56;
     nTotal  = #dsmom019#23 * #dsmom019#56;
     |SI nTotal ! #dsmom019#67;  nUni9 = #dsmom019#67 / #dsmom019#23;  |FINSI;

     |SI #dsmom019#132 ! 0;
         |PARA nCampo = 15;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
               |SI #dsmom019#nCampo# = 0;
                   |SI nCampo = 15;
                       nUni1  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#59 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 16;
                       nUni2  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#60 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 17;
                       nUni3  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#61 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 18;
                       nUni4  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#62 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 19;
                       nUni5  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#63 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 20;
                       nUni6  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#64 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 21;
                       nUni7  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#65 = #dsmom019#132;
                   |FINSI;
                   |SI nCampo = 22;
                       nUni8  = #dsmom019#124 + #dsmom019#126 + #dsmom019#128 + #dsmom019#130;
                       #dsmom019#66 = #dsmom019#132;
                   |FINSI;

                   |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;

     |PARA nCampo = 4;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 4;
           nNume = #dsmom016#nCampo#;
           |SI nNume = 3;  |O nNume = 28;  |O nNume = 10;
               nFactor = 100;
               |SI nNume = 10;  nFactor = 1000;  |FINSI;

               |SI nCampo = 4;   nUni1 = nUni1 / nFactor;  |FINSI;
               |SI nCampo = 8;   nUni2 = nUni2 / nFactor;  |FINSI;
               |SI nCampo = 12;  nUni3 = nUni3 / nFactor;  |FINSI;
               |SI nCampo = 16;  nUni4 = nUni4 / nFactor;  |FINSI;
               |SI nCampo = 20;  nUni5 = nUni5 / nFactor;  |FINSI;
               |SI nCampo = 24;  nUni6 = nUni6 / nFactor;  |FINSI;
               |SI nCampo = 28;  nUni7 = nUni7 / nFactor;  |FINSI;
               |SI nCampo = 32;  nUni8 = nUni8 / nFactor;  |FINSI;
               |SI nCampo = 36;  nUni9 = nUni9 / nFactor;  |FINSI;
           |FINSI;
     |SIGUE;

     |SI #dsm39003#5 = "6441"; |O #dsm39003#5 = "6442"; |O #dsm39003#5 = "6443"; |O #dsm39003#5 = "6446";
         #dsm39003#6  = nUni1 + nUni2 + nUni3;
         #dsm39003#7  = #dsmom019#59 + #dsmom019#60 + #dsmom019#61;

         #dsm39003#8  = nUni4 + nUni5 + nUni6;
         #dsm39003#9  = #dsmom019#62 + #dsmom019#63 + #dsmom019#64;

         #dsm39003#10 = nUni7;
         #dsm39003#11 = #dsmom019#65;

         #dsm39003#12 = nUni8;
         #dsm39003#13 = #dsmom019#66;

         #dsm39003#14 = nUni9;
         #dsm39003#15 = #dsmom019#67;
     |SINO;
         #dsm39003#6  = nUni1 + nUni2;
         #dsm39003#7  = #dsmom019#59 + #dsmom019#60

         #dsm39003#8  = nUni3;
         #dsm39003#9  = #dsmom019#61;

         #dsm39003#10 = nUni4;
         #dsm39003#11 = #dsmom019#62;

         #dsm39003#12 = nUni5;
         #dsm39003#13 = #dsmom019#63;

         #dsm39003#14 = nUni6;
         #dsm39003#15 = #dsmom019#64;

         #dsm39003#16 = nUni7;
         #dsm39003#17 = #dsmom019#65;

         #dsm39003#18 = nUni8;
         #dsm39003#19 = #dsmom019#66;
     |FINSI;

     #dsm39003#20 = #dsmom019#118;
     #dsm39003#21 = #dsmom019#135;
     #dsm39003#22 = #dsmom019#120;
     #dsm39003#23 = #dsmom019#136;

     #dsm39003#24 = 0;
     |SI #dsm39003#6  ! 0;  |O #dsm39003#8  ! 0;  |O #dsm39003#10 ! 0;
     |O  #dsm39003#12 ! 0;  |O #dsm39003#14 ! 0;  |O #dsm39003#16 ! 0;  |O #dsm39003#18 ! 0;
         #dsm39003#24 = #dsmom019#122;
     |FINSI;

     #dsm39003#25 = #dsmom019#147;
     #dsm39003#26 = #dsmom019#137;
     #dsm39003#27 = #dsmom019#138;

     |SI #dsmom019#115 = 0;
         #dsm39003#29 = "S";
     |FINSI;

     |SI #dsmom019#162 = "S";
         |SI enEjer [ 2012;
             |MENAV "    Modulo con Reduccion de Lorca. Informe en el Apartado correspondiente";
         |FINSI;
         #dsm39003#31 = "1";
         #dsm39003#20 = #dsm39003#20 + #dsmom019#163;
         #dsm39003#33 = #dsmom019#163;

         |SI enEjer [ 2012;
             nNume1 = (#dsm39003#20 % 35) ! 2;
             |SI #dsmom019#163 > nNume1;
                 #dsm39003#33 = nNume1;
                 #dsm39003#32 = "2";
                 #dsm39003#34 = (#dsmom019#163 - nNume1);
                 nNume1 = #dsm39003#33 + #dsm39003#34;
                 |SI nNume1 = #dsm39003#20;
                     #dsm39003#32 = "1";
                 |FINSI;
            |FINSI;
         |FINSI;
     |FINSI;

     |GRABA 020#dsm39003.n;
     |LIBERA #dsm39003;

     nSwHay310 = 1;
|FPRC;

|DEFBUCLE dsmom019;
     #dsmom019#1;
     ;
     #dsm39001#0, #dsm39001#1, 00, 00;
     #dsm39001#0, #dsm39001#1, 99, 99;
     ;
     NULL, Graba390_3;
|FIN;

|PROCESO Errores;
     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmom004#4;
     enTipoEntrada = 3;
     enMensa       = 1;
     |SUB_EJECUTA_NP "dsm39001";

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#7  = " ";
         #dsmom004#8  = ~;
         #dsmom004#9  = " ";
         #dsmom004#15 = 0;
         #dsmom004#17 = "SIN DATOS";

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROCESO Grupo3_390;
     |SI #dsmom030#30 ! 1;   |ACABA;  |FINSI;

     #dsmom033#0 = aSubde;
     |LEE 001#dsmom033.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |SI #dsmom033#6   = 0;  |ACABA;  |FINSI;

     #dsm39001#nCampo2# = #dsm39001#nCampo2# + ((#caivalin#6 / enConversor) ! EURODBMOD);
     #dsm39001#nCampo3# = #dsmom033#6;
     #dsm39001#nCampo4# = #dsm39001#nCampo2# * #dsmom033#6;
     nPasa       = 1;

     |SI #dsm39001#1 = 2010;
         |SI #camaniva#4 [ "30.06.2010";
             #dsm39006#nCampo12# = #dsm39006#nCampo12# + ((#caivalin#6 / enConversor) ! EURODBMOD);
             #dsm39006#nCampo13# = #dsmom033#6;
             #dsm39006#nCampo14# = #dsm39006#nCampo12# * #dsmom033#6;
         |SINO;
             #dsm39006#nCampo22# = #dsm39006#nCampo22# + ((#caivalin#6 / enConversor) ! EURODBMOD);
             #dsm39006#nCampo23# = #dsmom033#6;
             #dsm39006#nCampo24# = #dsm39006#nCampo22# * #dsmom033#6;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Grupo4_390;
     |SI #dsmom030#32 = 2;
         #dsm39001#nCampo5# = #dsm39001#nCampo5# + ((#caivalin#8 / enConversor) ! EURODBMOD);
         nPasa       = 1;

         |SI #dsm39001#1 = 2010;
             |SI #camaniva#4 [ "30.06.2010";
                 #dsm39006#nCampo15# = #dsm39006#nCampo15# + ((#caivalin#8 / enConversor) ! EURODBMOD);
             |SINO;
                 #dsm39006#nCampo25# = #dsm39006#nCampo25# + ((#caivalin#8 / enConversor) ! EURODBMOD);
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PonCodigoCultivo;
     |SI #dsmom004#1 [ 2008;
         |SI nCultivo = 11;   nCodigo = 8;  |FINSI;
         |SI nCultivo = 12;   nCodigo = 9;  |FINSI;
         |SI nCultivo = 38;   nCodigo = 4;  |FINSI;
         |SI nCultivo = 39;   nCodigo = 4;  |FINSI;
         |SI nCultivo = 72;   nCodigo = 1;  |FINSI;
         |SI nCultivo = 73;   nCodigo = 1;  |FINSI;
         |SI nCultivo = 74;   nCodigo = 3;  |FINSI;
         |SI nCultivo = 76;   nCodigo = 4;  |FINSI;
         |SI nCultivo = 77;   nCodigo = 4;  |FINSI;
         |SI nCultivo = 78;   nCodigo = 8;  |FINSI;
         |SI nCultivo = 79;   nCodigo = 8;  |FINSI;
         |SI nCultivo = 80;   nCodigo = 1;  |FINSI;
         |SI nCultivo = 81;   nCodigo = 1;  |FINSI;
         |SI nCultivo = 116;  nCodigo = 4;  |FINSI;
         |SI nCultivo = 117;  nCodigo = 4;  |FINSI;
         |SI nCultivo = 120;  nCodigo = 1;  |FINSI;
         |SI nCultivo = 121;  nCodigo = 1;  |FINSI;
         |SI nCultivo = 122;  nCodigo = 4;  |FINSI;
         |SI nCultivo = 123;  nCodigo = 4;  |FINSI;
         |SI nCultivo = 124;  nCodigo = 3;  |FINSI;
         |SI nCultivo = 125;  nCodigo = 3;  |FINSI;
         |SI nCultivo = 130;  nCodigo = 8;  |FINSI;
         |SI nCultivo = 131;  nCodigo = 8;  |FINSI;
         |SI nCultivo = 186;  nCodigo = 2;  |FINSI;
         |SI nCultivo = 193;  nCodigo = 2;  |FINSI;
         |SI nCultivo = 194;  nCodigo = 14; |FINSI;
         |SI nCultivo = 195;  nCodigo = 2;  |FINSI;
         |SI nCultivo = 196;  nCodigo = 14; |FINSI;
         |SI nCultivo = 197;  nCodigo = 2;  |FINSI;
         |SI nCultivo = 198;  nCodigo = 14; |FINSI;
         |SI nCultivo = 326;  nCodigo = 8;  |FINSI;
         |SI nCultivo = 327;  nCodigo = 8;  |FINSI;
     |SINO;
         |SI nCultivo = 11;   nCodigo = 8;  |FINSI;
         |SI nCultivo = 12;   nCodigo = 8;  |FINSI;
         |SI nCultivo = 38;   nCodigo = 4;  |FINSI;
         |SI nCultivo = 39;   nCodigo = 4;  |FINSI;
         |SI nCultivo = 72;   nCodigo = 1;  |FINSI;
         |SI nCultivo = 73;   nCodigo = 1;  |FINSI;
         |SI nCultivo = 74;   nCodigo = 3;  |FINSI;
         |SI nCultivo = 75;   nCodigo = 3;  |FINSI;
         |SI nCultivo = 76;   nCodigo = 5;  |FINSI;
         |SI nCultivo = 77;   nCodigo = 5;  |FINSI;
         |SI nCultivo = 78;   nCodigo = 5;  |FINSI;
         |SI nCultivo = 79;   nCodigo = 5;  |FINSI;
         |SI nCultivo = 80;   nCodigo = 1;  |FINSI;
         |SI nCultivo = 81;   nCodigo = 1;  |FINSI;
         |SI nCultivo = 116;  nCodigo = 7;  |FINSI;
         |SI nCultivo = 117;  nCodigo = 7;  |FINSI;
         |SI nCultivo = 120;  nCodigo = 4;  |FINSI;
         |SI nCultivo = 121;  nCodigo = 4;  |FINSI;
         |SI nCultivo = 122;  nCodigo = 4;  |FINSI;
         |SI nCultivo = 123;  nCodigo = 4;  |FINSI;
         |SI nCultivo = 124;  nCodigo = 3;  |FINSI;
         |SI nCultivo = 125;  nCodigo = 3;  |FINSI;
         |SI nCultivo = 130;  nCodigo = 4;  |FINSI;
         |SI nCultivo = 131;  nCodigo = 4;  |FINSI;
         |SI nCultivo = 186;  nCodigo = 2;  |FINSI;
         |SI nCultivo = 193;  nCodigo = 2;  |FINSI;
         |SI nCultivo = 194;  nCodigo = 14; |FINSI;
         |SI nCultivo = 195;  nCodigo = 2;  |FINSI;
         |SI nCultivo = 196;  nCodigo = 14; |FINSI;
         |SI nCultivo = 197;  nCodigo = 2;  |FINSI;
         |SI nCultivo = 198;  nCodigo = 14; |FINSI;
         |SI nCultivo = 284;  nCodigo = 8;  |FINSI;
         |SI nCultivo = 285;  nCodigo = 8;  |FINSI;
         |SI nCultivo = 326;  nCodigo = 6;  |FINSI;
         |SI nCultivo = 327;  nCodigo = 8;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO PonCampos2010;
         |SI nCampo1 = 14; nCampo11 = 4;  |FINSI;
         |SI nCampo1 = 20; nCampo11 = 9;  |FINSI;
         |SI nCampo1 = 26; nCampo11 = 14; |FINSI;
         |SI nCampo1 = 32; nCampo11 = 19; |FINSI;
         |SI nCampo1 = 38; nCampo11 = 24; |FINSI;

         nCampo12 = nCampo11;
         nCampo13 = nCampo11 + 1;
         nCampo14 = nCampo11 + 2;
         nCampo15 = nCampo11 + 3;
         nCampo16 = nCampo11 + 4;

         nCampo21 = nCampo11 + 25;
         nCampo22 = nCampo21;
         nCampo23 = nCampo21 + 1;
         nCampo24 = nCampo21 + 2;
         nCampo25 = nCampo21 + 3;
         nCampo26 = nCampo21 + 4;
|FPRC;

|PROCESO LeeLineaGanadera;
     aAlfa1 = #caivalin#30; |QBF aAlfa1;
     |SI aAlfa1 = "";
         #caivalin#30 = #camaniva#10;
         aAlfa1 = #caivalin#31; |QBF aAlfa1; |SI aAlfa1 = ""; #caivalin#31 = #camaniva#11; |FINSI;
     |FINSI;
     |SI aMulDep = "S";
         aSubde = #caivalin#31;
         nDepar = #caivalin#30;
         |SI nDepar = 0;  nDepar = 1;   |FINSI;

         |ABRE #agicen14;
         #agicen14#0 = #dsmow013#0;
         #agicen14#1 = nDepar;
         |LEE 040#agicen14.=;
         |SI FSalida ! 0;  nDepar = 1;  |FINSI;
         |CIERRA #agicen14;

         |SI #agicen14#9 ! 6;  |Y #agicen14#9 ! 7; |Y #agicen14#9 ! 11; |Y #agicen14#9 ! 12;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI aSubde  = "   ";  |ACABA;  |FINSI;
     |SI #caivalin#5  = "N";    |ACABA;  |FINSI;

     #dsmom030#0 = #caivalin#3;
     |LEE 040#dsmom030.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #dsmom030#4 = "N";  |ACABA;  |FINSI;

     nCodigo  = 0;
     nCultivo = aSubde;

     |HAZ PonCodigoCultivo;

     |SI nCodigo  = 0;  |ACABA;  |FINSI;

     nCampo1 = 0;
     |PARA nCampo = 14;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 6;
           |SI #dsm39001#nCampo# = nCodigo;
               nCampo1 = nCampo;
               |SAL;
           |FINSI;
           |SI #dsm39001#nCampo# = 0;
               nCampo1 = nCampo;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nCampo1 = 0;  |ACABA;  |FINSI;

     nCampo2 = nCampo1 + 1;
     nCampo3 = nCampo1 + 2;
     nCampo4 = nCampo1 + 3;
     nCampo5 = nCampo1 + 4;
     nCampo6 = nCampo1 + 5;

     |SI #dsm39001#1 = 2010;
         |HAZ PonCampos2010;
     |FINSI;

     #dsm39001#nCampo1# = nCodigo;

     |SI #dsmom030#30 ! 0; |HAZ Grupo3_390;  |FINSI;
     |SI #dsmom030#32 ! 0; |HAZ Grupo4_390;  |FINSI;
|FPRC;

|DEFBUCLE caivalin390;
     #caivalin#1;
     ;
     #camaniva#0, #camaniva#1, 01;
     #camaniva#0, #camaniva#1, 99;
     ;
     NULL, LeeLineaGanadera;
|FIN;

|PROCESO LeeGanadera;
     nDepar = #camaniva#10;
     aSubde = #camaniva#11;
     |SI aMulDep ! "S";
         |SI nDepar = 0;  nDepar = 1;   |FINSI;

         |ABRE #agicen14;
         #agicen14#0 = #dsmow013#0;
         #agicen14#1 = nDepar;
         |LEE 040#agicen14.=;
         |SI FSalida ! 0;  nDepar = 1;  |FINSI;
         |CIERRA #agicen14;

         |SI #agicen14#9 ! 6;  |Y #agicen14#9 ! 7; |Y #agicen14#9 ! 11; |Y #agicen14#9 ! 12;
             |LIBERA #camaniva;
             |ACABA;
         |FINSI;
     |FINSI;

     |BUCLE caivalin390;
     |LIBERA #camaniva;
|FPRC;

|DEFBUCLE camaniva390;
     #camaniva#1;
     5;
     00, 0000000000, nDPeriodo;
     99, 9999999999, nHPeriodo;
     be;
     NULL, LeeGanadera;
|FIN;

|PROCESO AcumulaAgricultura;
     nCultivo = #dsmoc311#6;

     |HAZ PonCodigoCultivo;

     |SI nCodigo  = 0;    nCodigo = 1;  |FINSI;

     nCampo1 = 0;
     |PARA nCampo = 14;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 6;
           |SI #dsm39001#nCampo# = nCodigo;
               nCampo1 = nCampo;
               |SAL;
           |FINSI;
           |SI #dsm39001#nCampo# = 0;
               nCampo1 = nCampo;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nCampo1 = 0;  |ACABA;  |FINSI;

     nCampo2 = nCampo1 + 1;
     nCampo3 = nCampo1 + 2;
     nCampo4 = nCampo1 + 3;
     nCampo5 = nCampo1 + 4;
     nCampo6 = nCampo1 + 5;

     #dsm39001#nCampo1# = nCodigo;

     |SI #dsm39001#1 ! 2010; |Y #dsm39001#1 ! 2012;

         #dsm39001#nCampo2# = #dsm39001#nCampo2# + #dsmoc311#8;
         #dsm39001#nCampo3# = #dsmoc311#9;
         #dsm39001#nCampo4# = #dsm39001#nCampo2# * #dsm39001#nCampo3#;
         #dsm39001#nCampo5# = #dsm39001#nCampo5# + #dsmoc311#11;
         #dsm39001#nCampo6# = #dsm39001#nCampo4# - ((#dsm39001#nCampo4# % 1) + #dsm39001#nCampo5#);

     |SINO;

         |HAZ PonCampos2010;

         #dsm39006#nCampo12# = #dsm39006#nCampo12# + #dsmoc311#13;
         #dsm39006#nCampo13# = #dsmoc311#14;
         #dsm39006#nCampo14# = #dsm39006#nCampo12# * #dsm39006#nCampo13#;
         #dsm39006#nCampo15# = #dsm39006#nCampo15# + #dsmoc311#16;
         #dsm39006#nCampo16# = #dsm39006#nCampo14# - ((#dsm39006#nCampo14# % 1) + #dsm39006#nCampo15#);

         #dsm39006#nCampo22# = #dsm39006#nCampo22# + #dsmoc311#18;
         #dsm39006#nCampo23# = #dsmoc311#19;
         #dsm39006#nCampo24# = #dsm39006#nCampo22# * #dsm39006#nCampo23#;
         #dsm39006#nCampo25# = #dsm39006#nCampo25# + #dsmoc311#21;
         #dsm39006#nCampo26# = #dsm39006#nCampo24# - ((#dsm39006#nCampo24# % 1) + #dsm39006#nCampo25#);

         #dsm39001#nCampo2# = #dsm39001#nCampo2# + #dsmoc311#8;
         #dsm39001#nCampo4# = #dsm39006#nCampo14# + #dsm39006#nCampo24#;
         #dsm39001#nCampo5# = #dsm39006#nCampo15# + #dsm39006#nCampo25#;
         #dsm39001#nCampo6# = #dsm39006#nCampo16# + #dsm39006#nCampo26#;

         #dsm39001#nCampo3# = (#dsm39001#nCampo4# / #dsm39001#nCampo2# ) ! 5;

     |FINSI;

     nSwHay310 = 1;
     nPasa     = 1;
|FPRC;

|DEFBUCLE dsmoc311;
     #dsmoc311#1;
     ;
     #dsm39001#0, #dsm39001#1, 12, nModelo, nComplem, 00, 001;
     #dsm39001#0, #dsm39001#1, 12, nModelo, nComplem, 99, 999;
     ;
     NULL, AcumulaAgricultura;
|FIN;

|PROCESO PasaContabilidad;
     aAlfa = #dsm39001#1;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     enEmpresa   = #dsm39001#0;
     enEjer      = #dsm39001#1;
     enSwOpPar   = 0;
     |HAZ SituaEmpresa;
     |SI enSwPartido = 0;
         aAlfa = #dsm39001#1;
         aAlfa = aAlfa % -102;
         nEjer = aAlfa;

         |ABRE #canempre;
         |SELECT #4#canempre;
         #canempre#2  = #dsm39001#0;
         #canempre#26 = nEjer;
         |LEE 040#canempre.=;
         |SI FSalida ! 0;  |CIERRA #canempre;  |ACABA;   |FINSI;
         |CIERRA #canempre;

         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";

         enEmpresa  = #canempre#2;
         enPerConta = #canempre#3;
         eaLaMonEmp = #canempre#28;
     |SINO;
         enPerConta = enPeriodoPar;
         eaLaMonEmp = "E";
     |FINSI;
     |HAZ EnConversor;

     |PATH_DAT #camaniva#aPathConta#;
     |PATH_DAT #caivalin#aPathConta#;
     |PATH_DAT #caivaasi#aPathConta#;

     |ABRE #caivaasi;
     |LEE 040#caivaasi.p;
     |SI FSalida ! 0;  |DDEFECTO #caivaasi;  |FINSI;
     |CIERRA #caivaasi;
     aMulDep = #caivaasi#132;

     |SI #caivaasi#46 = "T"; |Y #dsm39001#1 [ 2009;
          nDPeriodo = 1;  nHPeriodo = 4;
     |SINO;
          nDPeriodo = 1;  nHPeriodo = 12;
     |FINSI;

     |ABRE #dsmom030;
     |ABRE #dsmom033;

     |BUCLE camaniva390;

     |CIERRA #dsmom030;
     |CIERRA #dsmom033;

     |SI enSwPartido = 1;
         enSwOpPar   = 2;
         |HAZ FinalPartido;
     |FINSI;

     |PARA nCampo = 14;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 6;
           |SI #dsm39001#nCampo# ! 0;
               nCampo1 = nCampo;
               nCampo2 = nCampo + 1;
               nCampo3 = nCampo + 2;
               nCampo4 = nCampo + 3;
               nCampo5 = nCampo + 4;
               nCampo6 = nCampo + 5;

               |SI #dsm39001#1 ! 2010; |O #dsm39001#1 ! 2012;
                   #dsm39001#nCampo4#   = #dsm39001#nCampo2# * #dsm39001#nCampo3#;
                   #dsm39001#nCampo6#   = #dsm39001#nCampo4# - ((#dsm39001#nCampo4# % 1) + #dsm39001#nCampo5#);
                   nSwHay310 = 1;
               |SINO;
                   |HAZ PonCampos2010;
                   #dsm39006#nCampo14# = #dsm39006#nCampo12# * #dsm39006#nCampo13#;
                   #dsm39006#nCampo16# = #dsm39006#nCampo14# - ((#dsm39006#nCampo14# % 1) + #dsm39006#nCampo15#);

                   #dsm39006#nCampo24# = #dsm39006#nCampo22# * #dsm39006#nCampo23#;
                   #dsm39006#nCampo26# = #dsm39006#nCampo24# - ((#dsm39006#nCampo24# % 1) + #dsm39006#nCampo25#);

                   #dsm39001#nCampo2# = #dsm39006#nCampo12# + #dsm39006#nCampo22#;
                   #dsm39001#nCampo4# = #dsm39006#nCampo14# + #dsm39006#nCampo24#;
                   #dsm39001#nCampo5# = #dsm39006#nCampo15# + #dsm39006#nCampo25#;
                   #dsm39001#nCampo6# = #dsm39006#nCampo16# + #dsm39006#nCampo26#;

                   #dsm39001#nCampo3# = (#dsm39001#nCampo4# / #dsm39001#nCampo2# ) ! 5;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO dsmod303;
     |SI #dsmod303#4 = 0;                     ||tique 135_2194
         #dsm39001#8  = #dsm39001#8 + #dsmod303#63;
     |SINO;
         |SI #dsmod303#58 > 0;
             #dsm39001#8  = #dsm39001#8 + #dsmod303#58;
         |FINSI;
     |FINSI;

     |SI #dsm39001#98 = "S";
         #dsm39001#9  = #dsm39001#9 + #dsmod303#62;
     |FINSI;

     n49     = #dsmod303#61;
     n50     = #dsmod303#62;
     |SI #dsm39001#98 = "S";
         n50 = 0;
     |FINSI;

     |SI #dsmod303#2 = 12;
         |SI #dsm39001#98 = "S"; #dsmod303#62 = 0; |FINSI;  || no suma el 303
         nHay12  = 1;
         #dsm39001#10 = #dsm39001#10 + #dsmod303#61;
         #dsm39001#11 = #dsm39001#11 + #dsmod303#62;
     |FINSI;
|FPRC;

|DEFBUCLE dsmod303;
     #dsmod303#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 00;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 99;
     ;
     NULL, dsmod303;
|FIN;

|PROCESO dsm30301;
     |SI #dsm39001#55 = 0;
         #dsm39001#109 = #dsm39001#109 + #dsm30301#94;
         #dsm39001#110 = #dsm39001#110 + #dsm30301#95;
     |SINO;
         #dsm39001#111 = #dsm39001#111 + #dsm30301#94;
         #dsm39001#112 = #dsm39001#112 + #dsm30301#95;
     |FINSI;

     |SI #dsm39001#98 = "S";
         |SI #dsm30301#4 = 0;
             #dsm39001#8  = #dsm39001#8 + #dsm30301#91;
             #dsm39001#9  = #dsm39001#9 + #dsm30301#90;
         |SINO;
             |SI #dsm30301#88 > 0;
                 |SI #dsm30301#87 < 0;
                     nImpor = #dsm30301#88;
                     |SI nImpor < 0; nImpor = -nImpor;  |FINSI;
                     #dsm39001#8  = #dsm39001#8 + nImpor;

                     nImpor = #dsm30301#87;
                     |SI nImpor < 0; nImpor = -nImpor;  |FINSI;
                     #dsm39001#9  = #dsm39001#9 + nImpor;
                 |FINSI;

                 |SI #dsm30301#87 ] 0;
                     nImpor = #dsm30301#86;
                     |SI nImpor < 0; nImpor = -nImpor;  |FINSI;
                     #dsm39001#8  = #dsm39001#8 + nImpor;
                 |FINSI;
             |FINSI;

             |SI #dsm30301#88 < 0;
                 |SI #dsm30301#87 > 0;
                     nImpor = #dsm30301#87;
                     |SI nImpor < 0; nImpor = -nImpor;  |FINSI;
                     #dsm39001#8  = #dsm39001#8 + nImpor;

                     nImpor = #dsm30301#88;
                     |SI nImpor < 0; nImpor = -nImpor;  |FINSI;
                     #dsm39001#9  = #dsm39001#9 + nImpor;
                 |FINSI;

                 |SI #dsm30301#87 [ 0;
                     nImpor = #dsm30301#86;
                     |SI nImpor < 0; nImpor = -nImpor;  |FINSI;
                     #dsm39001#9  = #dsm39001#9 + nImpor;
                 |FINSI;
            |FINSI;
         |FINSI;
     |SINO;
         |SI #dsm30301#4 = 0;                     ||tique 135_2194
             #dsm39001#8  = #dsm39001#8 + #dsm30301#91;
         |SINO;
             |SI #dsm30301#86 > 0;
                 #dsm39001#8  = #dsm39001#8 + #dsm30301#86;
             |FINSI;
         |FINSI;
     |FINSI;

     n49     = #dsm30301#89;
     n50     = #dsm30301#90;
     |SI #dsm39001#98 = "S";
         n50 = 0;
     |FINSI;

     |SI #dsm30301#2 = 12;
         |SI #dsm39001#98 = "S";
             #dsm30301#90 = 0;
         |FINSI;  || no suma el 303

         nHay12  = 1;
         #dsm39001#10 = #dsm39001#10 + #dsm30301#89;
         #dsm39001#11 = #dsm39001#11 + #dsm30301#90;
     |FINSI;
|FPRC;

|DEFBUCLE dsm30301;
     #dsm30301#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 00;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 99;
     ;
     NULL, dsm30301;
|FIN;

|PROCESO dsmod300;
     #dsm39001#8  = #dsm39001#8 + #dsmod300#65;

     |SI #dsmod300#2 = 12;
         #dsm39001#10 = #dsm39001#10 + #dsmod300#63;
         #dsm39001#11 = #dsm39001#11 + #dsmod300#64;
     |FINSI;
|FPRC;

|DEFBUCLE dsmod300;
     #dsmod300#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, 00, 0;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, 99, 9;
     ;
     NULL, dsmod300;
|FIN;

|PROCESO dsmod330;
     #dsm39001#8  = #dsm39001#8 + #dsmod330#69;
     #dsm39001#9  = #dsm39001#9 + #dsmod330#68;

     |SI #dsmod330#2 = 12;
         #dsm39001#10 = #dsm39001#10 + #dsmod330#67;
         #dsm39001#11 = #dsm39001#11 + #dsmod330#68;
     |FINSI;
|FPRC;

|DEFBUCLE dsmod330;
     #dsmod330#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, 00, 0;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, 99, 9;
     ;
     NULL, dsmod330;
|FIN;

|PROCESO dsmod370;
     |ABRE #dsmod370;
     #dsmod370#0 = #dsmom004#0;
     #dsmod370#1 = #dsmom004#1;
     #dsmod370#2 = #dsmom004#2;
     #dsmod370#3 = #dsmom004#3;
     #dsmod370#4 = #dsmom004#4;
     #dsmod370#5 = 0;
     |LEE 040#dsmod370.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmod370;  |FINSI;
     |CIERRA #dsmod370;

     #dsmom004#0   = #dsmod370#0;
     #dsmom004#1   = #dsmod370#1;
     #dsmom004#2   = #dsmod370#2;
     #dsmom004#3   = 370;
     #dsmom004#4   = #dsmod370#4 + 1;
     |LEE 040#dsmom004.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #dsm39001#46 = #dsm39001#46 + #dsmod370#72;
     #dsm39001#47 = #dsm39001#47 + #dsmod370#74;
     #dsm39001#48 = #dsm39001#48 + #dsmod370#73;
     #dsm39001#50 = #dsm39001#50 + #dsmod370#76;
     #dsm39001#51 = #dsm39001#51 + #dsmod370#77;

     #dsm39001#8  = #dsm39001#8  + #dsmod370#86;

     n49     = #dsmod370#84;
     n50     = #dsmod370#85;

     |SI #dsmod370#2 = 12;
         nHay12  = 1;
         #dsm39001#10 = #dsm39001#10 + #dsmod370#84;
         #dsm39001#11 = #dsm39001#11 + #dsmod370#85;
     |FINSI;
|FPRC;

|DEFBUCLE dsmod370;
     #dsmod370#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, 00, 0;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, 99, 9;
     ;
     NULL, dsmod370;
|FIN;

|PROCESO ControlaRegGeneral2008;
     |HAZ BorraVarDed;

     |ABRE #dsm39002;
     |PARA nPeriodo = 1; |SI nPeriodo [ 12;  |HACIENDO nPeriodo = nPeriodo + 1;
           |SI nPeriodo = 3;  |O nPeriodo = 6;  |O nPeriodo = 9;  |O nPeriodo = 12;
               nError = 0;
               nErrorSinImporte = 0;
               #dsmom004#0   = #dsm39001#0;
               #dsmom004#1   = #dsm39001#1;
               #dsmom004#2   = nPeriodo;
               #dsmom004#3   = 300;
               #dsmom004#4   = 0;
               |LEE 040#dsmom004.=;
               |SI FSalida = 0;
                   |SI #dsmom004#7 = "X";  |Y #dsmom004#9 ! "X";  |Y enSwCheq390 = 0;
                       nError = 1;
                   |SINO;
                       enPeriodo = nPeriodo;
                       |HAZ  eLeeLaPro390;
                       nPro = nProrrata; |SI enEjer ] enEjerPro; nProrrata = 100; |FINSI;
                       nSwP0 = 0;
                       nSwP1 = 0;
                       nSwP2 = 0;
                       nSwP3 = 0;
                       nSwP4 = 0;
                       nSwP5 = 0;
                       nSwP6 = 0;
                       nSwP7 = 0;
                       nSwP8 = 0;
                       nM = 300;
                       |HAZ LeeEl47;
                       |BUCLE dsmociva;
                       |BUCLE dsmod300;
                   |FINSI;
               |SINO;
                   nError = 2;
               |FINSI;

               |SI nError > 0;
                   #dsmom004#0   = #dsm39001#0;
                   #dsmom004#1   = #dsm39001#1;
                   #dsmom004#2   = nPeriodo;
                   #dsmom004#3   = 370;
                   #dsmom004#4   = 0;
                   |LEE 040#dsmom004.=;
                   |SI FSalida = 0;
                       |SI #dsmom004#7 = "X";  |Y #dsmom004#9 ! "X";  |Y enSwCheq390 = 0;
                           nError = 1;
                       |SINO;
                           nError  = 0;
                           enPeriodo = nPeriodo;
                           |HAZ  eLeeLaPro390;
                           nPro = nProrrata; |SI enEjer ] enEjerPro; nProrrata = 100; |FINSI;
                           nSwP0 = 0;
                           nSwP1 = 0;
                           nSwP2 = 0;
                           nSwP3 = 0;
                           nSwP4 = 0;
                           nSwP5 = 0;
                           nSwP6 = 0;
                           nSwP7 = 0;
                           nSwP8 = 0;
                           nM = 370;
                           |HAZ LeeEl47;
                           |BUCLE dsmociva;
                           |BUCLE dsmod370;
                       |FINSI;
                   |SINO;
                       |SI nError = 2; nError = 0;  |FINSI;
                   |FINSI;
               |FINSI;

               |SI nError = 1;
                   aAlfa = "    Modelos sin Imprimir, Empresa = " + #dsmom004#0 + ", Pase Abortado";
                   |MENAV aAlfa;
                   |SAL;
               |FINSI;
               |SI nErrorSinImporte = 1;
                   aAlfa = "    Atencion. Faltan bases de IVA Soportado en el Periodo = " + nPeriodo + " de la Empresa = " + #dsmom004#0;
                   |MENAV aAlfa;
               |FINSI;
           |FINSI;

           nError = 0;
           #dsmom004#0   = #dsm39001#0;
           #dsmom004#1   = #dsm39001#1;
           #dsmom004#2   = nPeriodo;
           #dsmom004#3   = 330;
           #dsmom004#4   = 0;
           |LEE 040#dsmom004.=;
           |SI FSalida = 0;
               |SI #dsmom004#7 = "X";  |Y #dsmom004#9 ! "X";  |Y enSwCheq390 = 0;
                   nError = 1;
               |SINO;
                   enPeriodo = nPeriodo;
                   |HAZ  eLeeLaPro390;
                   nPro = nProrrata; |SI enEjer ] enEjerPro; nProrrata = 100; |FINSI;
                   nSwP0 = 0; nSwP1 = 0; nSwP2 = 0; nSwP3 = 0;
                   nSwP4 = 0; nSwP5 = 0; nSwP6 = 0; nSwP7 = 0; nSwP8 = 0;
                   nM = 330; |HAZ LeeEl47;
                   |BUCLE dsmociva;
                   |BUCLE dsmod330;
               |FINSI;
           |FINSI;

           |SI nError = 1;
               aAlfa = "    Modelos sin Imprimir, Empresa = " + #dsmom004#0 + ", Pase Abortado";
               |MENAV aAlfa;
               |SAL;
           |FINSI;
     |SIGUE;
     |CIERRA #dsm39002;
|FPRC;

|PROCESO ActProrrata;
  |SI #dsm39002#5 = 1; nImporte = nTPro1; |FINSI;
  |SI #dsm39002#5 = 2; nImporte = nTPro2; |FINSI;
  |SI #dsm39002#5 = 3; nImporte = nTPro3; |FINSI;
  |SI #dsm39002#5 = 4; nImporte = nTPro4; |FINSI;
  |SI #dsm39002#5 = 5; nImporte = nTPro5; |FINSI;
  |SI #dsm39002#5 = 6; nImporte = nTPro6; |FINSI;
  |SI #dsm39002#5 = 7; nImporte = nTPro7; |FINSI;

  |SI nImporte = 0;  |LIBERA #dsm39002; |ACABA; |FINSI;   ||no hay prorrata

  nUltimo   = 14;
  nSwContar = 0;
  |PARA nCampo11  = 14;  |SI nCampo11 [ 34;  |HACIENDO nCampo11 = nCampo11 + 3;
        |SI #dsm39002#nCampo11# ! 0;
            nUltimo   = nCampo11;
            nSwContar = nSwContar + 1;
        |FINSI;
        |SI nCampo11 = 23; nCampo11 = 25; |FINSI;
  |SIGUE;

  |SI nSwContar [ 1;
      #dsm39002#nUltimo# = #dsm39002#nUltimo# - nImporte;
  |SINO;
      nImport2 = nImporte;
      |PARA nCampo11  = 14;  |SI nCampo11 [ 34;  |HACIENDO nCampo11 = nCampo11 + 3;
            |SI #dsm39002#nCampo11# ! 0;
                nTanto       = (#dsm39002#nCampo11# * 100) / #dsm39002#11;
                nImport1     = (nImporte % nTanto) ! EURODBMOD;
                #dsm39002#nCampo11# = #dsm39002#nCampo11# - nImport1;
                nImport2     = (nImport2 - nImport1) ! EURODBMOD;
            |FINSI;
            |SI nCampo11 = 23; nCampo11 = 25; |FINSI;
      |SIGUE;
      |SI nImport2 ! 0;
          |PARA nCampo11  = 14;  |SI nCampo11 [ 34;  |HACIENDO nCampo11 = nCampo11 + 3;
                |SI #dsm39002#nCampo11# ! 0;
                    #dsm39002#nCampo11# = #dsm39002#nCampo11# - nImport2;
                    |SAL;
                |FINSI;
                |SI nCampo11 = 23; nCampo11 = 25; |FINSI;
          |SIGUE;
      |FINSI;
  |FINSI;
  #dsm39002#11 = #dsm39002#14 + #dsm39002#17 + #dsm39002#20 + #dsm39002#23;
  #dsm39002#11 = #dsm39002#11 + #dsm39002#28 + #dsm39002#31 + #dsm39002#34;

  |GRABA 020#dsm39002.a;
  |LIBERA #dsm39002;
|FPRC;

|DEFBUCLE ActProrrata;
  #dsm39002#1;
  ;
  #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 2, 01;
  #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 2, 07;
  be;
  NULL, ActProrrata;
|FIN;

|PROCESO CargaEspejo;
     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsm39002.mas";
     |CARGA_DEF aMas, dsm3902@;
     |ABRE #dsm3902@;
|FPRC;

|PROCESO DescargaEspejo;
     |CIERRA #dsm3902@;
     |DESCARGA_DEF #dsm3902@;
|FPRC;

|PROCESO ControlaRegGeneral2009;
     |HAZ BorraVarDed;
     nHay12   = 0;
     nHay2_18 = 0;
     n49      = 0;
     n50      = 0;
     aCampo98 = #dsm39001#98;

     |HAZ CargaEspejo;
     nSwHayPro = 0;
     |ABRE #dsm39002;
     |PARA nPeriodo = 1; |SI nPeriodo [ 12;  |HACIENDO nPeriodo = nPeriodo + 1;
           nError           = 0;
           nErrorSinImporte = 0;

           #dsmom004#0   = #dsm39001#0;
           #dsmom004#1   = #dsm39001#1;
           #dsmom004#2   = nPeriodo;
           #dsmom004#3   = 303;
           #dsmom004#4   = 99;
           |LEE 000#dsmom004.];
           |SI FSalida = 0;
               |LEE 000#dsmom004.a;
           |SINO;
               |LEE 000#dsmom004.u;
           |FINSI;

           |SI FSalida = 0;  |Y #dsmom004#0 = #dsm39001#0;      |Y #dsmom004#1 = #dsm39001#1;
                             |Y #dsmom004#2   = nPeriodo;  |Y #dsmom004#3 = 303;
               |SI enModAux ! 0; |Y #dsmom004#2 = 12; |Y enSwCheq390 = 0;
                   #dsmom004#9 = "X";   || Tique 70000_6888, pasa como impreso
               |FINSI;

               |SI #dsmom004#7 = "X";  |Y #dsmom004#9 ! "X";  |Y enSwCheq390 = 0;
                   nError = 1;
               |SINO;
                   enPeriodo = nPeriodo;
                   |HAZ eLeeLaPro390;
                   nPro = nProrrata;
                   |SI enEjer ] enEjerPro; nProrrata = 100; |FINSI;

                   nSwP0 = 0;
                   nSwP1 = 0;
                   nSwP2 = 0;
                   nSwP3 = 0;
                   nSwP4 = 0;
                   nSwP5 = 0;
                   nSwP6 = 0;
                   nSwP7 = 0;
                   nSwP8 = 0;
                   nM = 303;
                   |HAZ LeeEl47;
                   |BUCLE dsmociva;
                   |SI #dsm39001#1 < 2014;
                       |BUCLE dsmod303;
                   |SINO;
                       #dsm39001#98 = #dsmom004#23;
                       |BUCLE dsm30301;
                   |FINSI;
               |FINSI;
           |SINO;
               nError = 2;
           |FINSI;

           |SI nError > 0; |Y #dsm39001#1 < 2014;  ||  370 solo hasta 2013
               |SI nError = 2; nError = 0;  |FINSI;

               |SI nPeriodo = 3;  |O nPeriodo = 6;  |O nPeriodo = 9;  |O nPeriodo = 12;
                   #dsmom004#0   = #dsm39001#0;
                   #dsmom004#1   = #dsm39001#1;
                   #dsmom004#2   = nPeriodo;
                   #dsmom004#3   = 370;
                   #dsmom004#4   = 0;
                   |LEE 040#dsmom004.=;
                   |SI FSalida = 0;

                       |SI enModAux ! 0; |Y #dsmom004#2 = 12; |Y enSwCheq390 = 0;
                           #dsmom004#9 = "X";   || Tique 70000_6888, pasa como impreso
                       |FINSI;

                       |SI #dsmom004#7 = "X";  |Y #dsmom004#9 ! "X";  |Y enSwCheq390 = 0;
                           nError = 1;
                       |SINO;
                           nError  = 0;
                           enPeriodo = nPeriodo;
                           |HAZ eLeeLaPro390;

                           nPro = nProrrata;
                           |SI enEjer ] enEjerPro; nProrrata = 100; |FINSI;
                           nSwP0 = 0;
                           nSwP1 = 0;
                           nSwP2 = 0;
                           nSwP3 = 0;
                           nSwP4 = 0;
                           nSwP5 = 0;
                           nSwP6 = 0;
                           nSwP7 = 0;
                           nSwP8 = 0;
                           nM = 370;
                           |HAZ LeeEl47;
                           |BUCLE dsmociva;
                           |BUCLE dsmod370;
                       |FINSI;
                   |FINSI;
               |FINSI;
           |FINSI;

           |SI nError = 1;
               aAlfa = "    Modelos sin Imprimir, Empresa = " + #dsmom004#0 + ", Pase Abortado";
               |MENAV aAlfa;
               |SAL;
           |FINSI;

           |SI nErrorSinImporte = 1;
               aAlfa = "    Atencion. Faltan bases de IVA Soportado en el Periodo = " + nPeriodo + " de la Empresa = " + #dsmom004#0;
               |MENAV aAlfa;
           |FINSI;
     |SIGUE;
     #dsm39001#98 = aCampo98;

     |SI nHay12 = 0;
         #dsm39001#10 = #dsm39001#10 + n49;
         #dsm39001#11 = #dsm39001#11 + n50;
     |FINSI;

     |CIERRA #dsm39002;

     |SI enEjer ] 2010; |Y nSwHayPro = 1;
         |SI eaDesg109 ! "S";
             nTPro1 = nTPro;
             nTPro2 = 0;
             nTPro3 = 0;
             nTPro4 = 0;
             nTPro5 = 0;
             nTPro6 = 0;
             nTPro7 = 0;
         |FINSI;
         |BUCLE ActProrrata;
     |FINSI;

     |HAZ DescargaEspejo;
|FPRC;

|PROCESO CargaEntregas;
    |ABRE #dsm39002;
    #dsm39002#0 = #dsm39001#0;
    #dsm39002#1 = #dsm39001#1;
    #dsm39002#2 = #dsm39001#2;
    #dsm39002#3 = #dsm39001#3;
    #dsm39002#4 = 3;
    #dsm39002#5 = 9;
    |LEE 101#dsm39002.=;
    |SI FSalida = 0;
        #dsm39002#10 = #dsm39002#10 + nImporte;
        |GRABA 020#dsm39002.a;
    |FINSI;
    |LIBERA #dsm39002;
    |CIERRA #dsm39002;
|FPRC;

|PROCESO CargaSimplificado;
    |ABRE #dsm39002;
    #dsm39002#0 = #dsm39001#0;
    #dsm39002#1 = #dsm39001#1;
    #dsm39002#2 = #dsm39001#2;
    #dsm39002#3 = #dsm39001#3;
    #dsm39002#4 = 3;
    #dsm39002#5 = 2;
    |LEE 101#dsm39002.=;
    |SI FSalida = 0;
        #dsm39002#10 = #dsm39002#10 + #dsmoc310#19;
        |GRABA 020#dsm39002.a;
    |FINSI;
    |LIBERA #dsm39002;
    |CIERRA #dsm39002;
|FPRC;

|PROCESO dsmoc310;
     |SI #dsmoc310#8 = "S";
         |SI #dsmoc310#2 = 12;
             |HAZ CargaSimplificado;
         |FINSI;
     |SINO;
         |HAZ CargaSimplificado;
     |FINSI;
     nSwHay310 = 1;
|FPRC;

|DEFBUCLE dsmoc310;
   #dsmoc310#1;
   ;
   #dsmod310#0, #dsmod310#1, #dsmod310#2, #dsmod310#3, #dsmod310#4, 00;
   #dsmod310#0, #dsmod310#1, #dsmod310#2, #dsmod310#3, #dsmod310#4, 99;
   ;
   NULL, dsmoc310;
|FIN;

|DEFBUCLE dsmoc310S;
   #dsmoc310#1;
   ;
   #dsm30301#0, #dsm30301#1, #dsm30301#2, #dsm30301#3, #dsm30301#4, 00;
   #dsm30301#0, #dsm30301#1, #dsm30301#2, #dsm30301#3, #dsm30301#4, 99;
   ;
   NULL, dsmoc310;
|FIN;

|PROCESO CargaDevengado;
     #dsmom004#0   = #dsmod310#0;
     #dsmom004#1   = #dsmod310#1;
     #dsmom004#2   = #dsmod310#2;
     #dsmom004#3   = nModelo;
     #dsmom004#4   = 0;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;
         |BORRA 020#dsmod310.a;
         |LIBERA #dsmod310;

         |ACABA;
     |FINSI;

     #dsmom004#0   = #dsmod310#0;
     #dsmom004#1   = #dsmod310#1;
     #dsmom004#2   = #dsmod310#2;
     #dsmom004#3   = nModelo;
     #dsmom004#4   = #dsmod310#4 + 1;
     |LEE 040#dsmom004.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #dsm39001#46 = #dsm39001#46 + #dsmod310#27;
     #dsm39001#47 = #dsm39001#47 + #dsmod310#29;
     #dsm39001#48 = #dsm39001#48 + #dsmod310#28;
     #dsm39001#50 = #dsm39001#50 + #dsmod310#31;
     #dsm39001#51 = #dsm39001#51 + #dsmod310#32;

     #dsm39001#8  = #dsm39001#8 + #dsmod310#40 + #dsmod310#41;

     |SI #dsmod310#2 = 12;
         #dsm39001#10 = #dsm39001#10 + #dsmod310#38;
         #dsm39001#11 = #dsm39001#11 + #dsmod310#39;
     |FINSI;
     |LIBERA #dsmod310;

     |SI #dsmod310#37 ! 0;
         nImporte = #dsmod310#37;
         |HAZ CargaEntregas;
     |FINSI;

     |BUCLE dsmoc310;
     nSwHay310 = 1;
|FPRC;

|DEFBUCLE dsmod310;
     #dsmod310#1;
     ;
     #dsm39001#0, #dsm39001#1, 01, nModelo, 00, 00;
     #dsm39001#0, #dsm39001#1, 12, nModelo, 99, 00;
     be;
     NULL, CargaDevengado;
|FIN;

|PROCESO dsm30301S;
     #dsmom004#0   = #dsm30301#0;
     #dsmom004#1   = #dsm30301#1;
     #dsmom004#2   = #dsm30301#2;
     #dsmom004#3   = nModelo;
     #dsmom004#4   = 0;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     #dsmom004#0   = #dsm30301#0;
     #dsmom004#1   = #dsm30301#1;
     #dsmom004#2   = #dsm30301#2;
     #dsmom004#3   = nModelo;
     #dsmom004#4   = #dsm30301#4 + 1;
     |LEE 040#dsmom004.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #dsm39001#46 = #dsm39001#46 + #dsm30301#66;
     #dsm39001#47 = #dsm39001#47 + #dsm30301#68;
     #dsm39001#48 = #dsm39001#48 + #dsm30301#67;
     #dsm39001#50 = #dsm39001#50 + #dsm30301#70;
     #dsm39001#51 = #dsm39001#51 + #dsm30301#71;

     |LIBERA #dsm30301;

     |BUCLE dsmoc310S;
|FPRC;

|DEFBUCLE dsm30301S;
     #dsm30301#1;
     ;
     #dsm39001#0, #dsm39001#1, 01, nModelo, 00, 00;
     #dsm39001#0, #dsm39001#1, 12, nModelo, 99, 00;
     ;
     NULL, dsm30301S;
|FIN;

|PROCESO ControlaRegSimplificado;
     nModelo = 310;

     nSwHay310 = 0;
     nLinea    = 0;
     |ABRE #dsm39003;
     |ABRE #dsmom017;
     |ABRE #dsmom016;
     |ABRE #dsmom004;
     |BUCLE dsmom019;
     |CIERRA #dsmom016;
     |CIERRA #dsmom017;
     |CIERRA #dsm39003;
     |SI nError = 1; |ACABA;  |FINSI;

     |SI #dsm39001#1 = 2010; |O #dsm39001#1 = 2012;
         |ABRE #dsm39006;
         #dsm39006#0 = #dsm39001#0;
         #dsm39006#1 = #dsm39001#1;
         #dsm39006#2 = #dsm39001#2;
         #dsm39006#3 = #dsm39001#3;
         |LEE 141#dsm39006.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsm39006;
             #dsm39006#0 = #dsm39001#0;
             #dsm39006#1 = #dsm39001#1;
             #dsm39006#2 = #dsm39001#2;
             #dsm39006#3 = #dsm39001#3;
             |GRABA 020#dsm39006.b;
         |FINSI;
     |FINSI;

     nPasa = 0;

|| .................      |HAZ PasaContabilidad;  || Modelo Ganaderas
|| .................      |SI nPasa = 0;
         nComplem = -1;
         |ABRE #dsmoc311;
         #dsmoc311#0 = #dsm39001#0;
         #dsmoc311#1 = #dsm39001#1;
         #dsmoc311#2 = 12;
         #dsmoc311#3 = nModelo;
         #dsmoc311#4 = 99;
         #dsmoc311#5 = 0;
         #dsmoc311#6 = 1;
         |LEE 041#dsmoc311.];
         |SI FSalida = 0;
             |LEE 041#dsmoc311.a;
         |SINO;
             |LEE 041#dsmoc311.u;
         |FINSI;
         |SI FSalida = 0; |Y #dsmoc311#0 = #dsm39001#0; |Y #dsmoc311#1 = #dsm39001#1;
             |Y #dsmoc311#2 = 12; |Y #dsmoc311#3 = nModelo;
                nComplem = #dsmoc311#4;
         |FINSI;
         |CIERRA #dsmoc311;
         |SI nComplem ! -1;
             |BUCLE dsmoc311;
         |FINSI;
|| .............                |FINSI;

     |SI nPasa = 0;              || Cambio orden, primero 311 luego contabilidad
         |HAZ PasaContabilidad;  || Modelo Ganaderas
     |FINSI;

     |SI #dsm39001#1 = 2010; |O #dsm39001#1 = 2012;
         |GRABA 020#dsm39006.a;
         |LIBERA #dsm39006;
         |CIERRA #dsm39006;
     |FINSI;

|SI #dsm39001#1 < 2014;   ||este chequeo ya no es necesario
     |PARA nPeriodo = 3; |SI nPeriodo [ 12;  |HACIENDO nPeriodo = nPeriodo + 3;
           nError = 0;
           #dsmom004#0   = #dsm39001#0;
           #dsmom004#1   = #dsm39001#1;
           #dsmom004#2   = nPeriodo;
           #dsmom004#3   = 310;
           #dsmom004#4   = 0;
           |LEE 040#dsmom004.=;
           |SI FSalida = 0;
               |SI #dsmom004#7 = "X";  |Y #dsmom004#9 ! "X";  |Y enSwCheq390 = 0;
                   nError = 1;
               |FINSI;
           |SINO;
               nError = 2;
           |FINSI;

           |SI nError > 0;
               #dsmom004#0   = #dsm39001#0;
               #dsmom004#1   = #dsm39001#1;
               #dsmom004#2   = nPeriodo;
               #dsmom004#3   = 370;
               #dsmom004#4   = 0;
               |LEE 040#dsmom004.=;
               |SI FSalida = 0;
                   |SI #dsmom004#7 = "X";  |Y #dsmom004#9 ! "X";  |Y enSwCheq390 = 0;
                       nError = 1;
                   |SINO;
                       nError  = 0;
                   |FINSI;
               |SINO;
                   |SI nError = 2; nError = 0;  |FINSI;
              |FINSI;
           |FINSI;

           |SI nError = 1;
               nError = 1;
               |SAL;
           |FINSI;
     |SIGUE;
|SINO;
     nError = 0;
|FINSI;

     |SI nError = 1;
         aAlfa = "    Modelos sin Imprimir, Empresa = " + #dsmom004#0 + ", Pase Abortado";
         |MENAV aAlfa;
     |SINO;
         |SI #dsm39001#1 < 2014;
             |BUCLE dsmod310;
         |SINO;
             |BUCLE dsm30301S;
         |FINSI;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|| ..........Todo Lineal de Prorratas y grupos

|PROCESO grupos123;
     |SI #dsmociva#7 = 0; |O #dsmociva#7 = 12; |ACABA; |FINSI;

     nSector = 1;
     nTp100a  = 100;
     #dsmom086#0 = #dsmociva#0;
     #dsmom086#1 = #dsmociva#1;
     #dsmom086#2 = #dsmociva#5;  ||Actividad
     |LEE 041#dsmom086.=;
     |SI FSalida = 0;
         nSector = #dsmom086#15;
         nTp100a = #dsmom086#6;
     |FINSI;
     |SI nSector > 3; nSector = 3; |FINSI;

     #dsmom087#0 = #dsmociva#0;
     #dsmom087#1 = #dsmociva#1;
     #dsmom087#2 = #dsmociva#2;
     #dsmom087#3 = #dsmociva#3;
     #dsmom087#4 = #dsmociva#4;
     #dsmom087#5 = #dsmociva#5;
     #dsmom087#6 = #dsmociva#6;
     #dsmom087#7 = #dsmociva#7;
     |LEE 041#dsmom087.=;
     |SI FSalida = 0;
         #dsmociva#13 = (#dsmom087#12 % nTp100a) ! 2 + (#dsmom087#37 % nTpComun) ! 2;  ||la actividad
     |FINSI;

     |SI #dsmociva#12 ! 0;  |O #dsmociva#13 ! 0;
         nQuants = 1;
         #dsm39005#0 = #dsm39001#0;
         #dsm39005#1 = #dsm39001#1;
         #dsm39005#2 = #dsm39001#2;
         #dsm39005#3 = #dsm39001#3;
         #dsm39005#4 = nSector;
         |LEE 101#dsm39005.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsm39005;
             #dsm39005#0 = #dsm39001#0;
             #dsm39005#1 = #dsm39001#1;
             #dsm39005#2 = #dsm39001#2;
             #dsm39005#3 = #dsm39001#3;
             #dsm39005#4 = nSector;
             |GRABA 020#dsm39005.b;
         |FINSI;
         nCampo1 = 0;
         |SI #dsmociva#7 = 1;  nCampo1 =  5; |FINSI;
         |SI #dsmociva#7 = 2;  nCampo1 =  7; |FINSI;
         |SI #dsmociva#7 = 3;  nCampo1 =  9; |FINSI;
         |SI #dsmociva#7 = 4;  nCampo1 = 11; |FINSI;
         |SI #dsmociva#7 = 5;  nCampo1 = 13; |FINSI;
         |SI #dsmociva#7 = 6;  nCampo1 = 15; |FINSI;
         |SI #dsmociva#7 = 7;  nCampo1 = 17; |FINSI;
         |SI #dsmociva#7 = 8;  nCampo1 = 22; nCampo2 = 19; |FINSI;
         |SI #dsmociva#7 = 9;  nCampo1 = -1; nCampo2 = 20; |FINSI;
         |SI #dsmociva#7 = 11; nCampo1 =  5; |FINSI;
         |SI #dsmociva#7 = 13; nCampo1 =  5; |FINSI;
         |SI #dsmociva#7 = 14; nCampo1 =  5; |FINSI;
         |SI #dsmociva#7 = 15; nCampo1 =  7; |FINSI;

         |SI nCampo1 ! 0;
             |SI nCampo1 ! -1;
                 |SI nCampo1 ! 22; nCampo2 = nCampo1 + 1; |FINSI;
                 #dsm39005#nCampo1# = #dsm39005#nCampo1# + #dsmociva#12;
             |FINSI;
             #dsm39005#nCampo2# = #dsm39005#nCampo2# + #dsmociva#13;
             nT300C1 = (nT300C1 + #dsmociva#13) ! 2;
         |FINSI;

         #dsm39005#21 = #dsm39005#6  + #dsm39005#8  + #dsm39005#10 + #dsm39005#12 + #dsm39005#14 + #dsm39005#16;
         #dsm39005#21 = #dsm39005#21 + #dsm39005#18 + #dsm39005#19 + #dsm39005#20;

         |GRABA 020#dsm39005.a;
         |LIBERA #dsm39005;
     |FINSI;
     |LIBERA #dsmociva;
|FPRC;

|DEFBUCLE dsmociva_grupo;
     #dsmociva#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 01, 2,  0;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 98, 2, 99;
     be;
     NULL, grupos123;
|FIN;

|PROCESO LeeM490;
  nT300C2 = (nT300C2 + #dsm39002#11) ! 2;
|FPRC;

|DEFBUCLE LeeM490;
  #dsm39002#1;
  ;
  #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39002#3, 2,  1;
  #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39002#3, 2, 13;
  e;
  NULL, LeeM490;
|FIN;

|PROCESO PaseGrupos123;
     nQuants = 0;
     |HAZ BorraVarDed;

     |ABRE #dsm39005;
     |ABRE #dsmom086;
     |ABRE #dsmom087;
     |PARA nPeriodo = 1; |SI nPeriodo [ 12;  |HACIENDO nPeriodo = nPeriodo + 1;
           #dsmom004#0   = #dsm39001#0;
           #dsmom004#1   = #dsm39001#1;
           #dsmom004#2   = nPeriodo;
           #dsmom004#3   = 303;
           #dsmom004#4   = 99;
           |LEE 000#dsmom004.];
           |SI FSalida = 0;
               |LEE 000#dsmom004.a;
           |SINO;
               |LEE 000#dsmom004.u;
           |FINSI;

           |SI FSalida = 0;  |Y #dsmom004#0 = #dsm39001#0;      |Y #dsmom004#1 = #dsm39001#1;
                             |Y #dsmom004#2   = nPeriodo;  |Y #dsmom004#3 = 303;
                   nM = 303;
                   |BUCLE dsmociva_grupo;
           |SINO;
               nError = 2;
           |FINSI;

           |SI nError > 0;
               |SI nError = 2; nError = 0;  |FINSI;

               |SI nPeriodo = 3;  |O nPeriodo = 6;  |O nPeriodo = 9;  |O nPeriodo = 12;
                   #dsmom004#0   = #dsm39001#0;
                   #dsmom004#1   = #dsm39001#1;
                   #dsmom004#2   = nPeriodo;
                   #dsmom004#3   = 370;
                   #dsmom004#4   = 0;
                   |LEE 040#dsmom004.=;
                   |SI FSalida = 0;
                       nError  = 0;
                       |BUCLE dsmociva_grupo;
                   |FINSI;
               |FINSI;
           |FINSI;
     |SIGUE;

     |CIERRA #dsmom087;
     |CIERRA #dsmom086;

     |SI nQuants = 1;
         nT300C2 = 0;
         |BUCLE LeeM490;
         |SI nT300C1 ! nT300C2;
             nT300C1 = (nT300C2 - nT300C1) ! 2;
             #dsm39005#0 = #dsm39001#0;
             #dsm39005#1 = #dsm39001#1;
             #dsm39005#2 = #dsm39001#2;
             #dsm39005#3 = #dsm39001#3;
             #dsm39005#4 = 1;
             |LEE 141#dsm39005.=;
             |SI FSalida = 0;
                 |SI #dsm39005#5  ! 0; #dsm39005#6  = #dsm39005#6  + nT300C1; nT300C1 = 0; |FINSI;
                 |SI #dsm39005#7  ! 0; |Y nT300C1 ! 0; #dsm39005#8   = #dsm39005#8  + nT300C1; nT300C1 = 0; |FINSI;
                 |SI #dsm39005#9  ! 0; |Y nT300C1 ! 0; #dsm39005#10  = #dsm39005#10 + nT300C1; nT300C1 = 0; |FINSI;
                 |SI #dsm39005#11 ! 0; |Y nT300C1 ! 0; #dsm39005#12  = #dsm39005#12 + nT300C1; nT300C1 = 0; |FINSI;
                 |SI #dsm39005#13 ! 0; |Y nT300C1 ! 0; #dsm39005#14  = #dsm39005#14 + nT300C1; nT300C1 = 0; |FINSI;
                 |SI #dsm39005#15 ! 0; |Y nT300C1 ! 0; #dsm39005#16  = #dsm39005#16 + nT300C1; nT300C1 = 0; |FINSI;
                 |SI #dsm39005#17 ! 0; |Y nT300C1 ! 0; #dsm39005#18  = #dsm39005#18 + nT300C1; nT300C1 = 0; |FINSI;
                 |SI nT300C1 ! 0; #dsm39005#19  = #dsm39005#19 + nT300C1; nT300C1 = 0; |FINSI;
                 #dsm39005#21 = #dsm39005#6  + #dsm39005#8  + #dsm39005#10 + #dsm39005#12 + #dsm39005#14 + #dsm39005#16;
                 #dsm39005#21 = #dsm39005#21 + #dsm39005#18 + #dsm39005#19 + #dsm39005#20;
                 |GRABA 020#dsm39005.a;
             |FINSI;
             |LIBERA #dsm39005;
         |FINSI;
     |FINSI;
     |CIERRA #dsm39005;
|FPRC;

|PROCESO Resto690;
 |SI nSwLimpio = 0;
     |SI nPrim ! #dsm39004#4;
         nT9 = (nT9 - #dsm39004#7) ! EURODBMOD;
         nT7 = (nT7 - #dsm39004#8) ! EURODBMOD;
     |FINSI;
 |SINO;
     |SI #dsm39004#10 = 100;
         |BORRA 020#dsm39004.a;
     |FINSI;
 |FINSI;
 |LIBERA #dsm39004;
|FPRC;

|DEFBUCLE Resto690;
 #dsm39004#1;
 ;
 enEmpresa, enEjer, #dsm39001#2, #dsm39001#3, 01;
 enEmpresa, enEjer, #dsm39001#2, #dsm39001#3, 98;
 be;
 NULL, Resto690;
|FIN;

|PROCESO GraboUna;

 |ABRE #dsm39004;
 |DDEFECTO #dsm39004;
 #dsm39004#0 = enEmpresa;
 #dsm39004#1 = enEjer;
 #dsm39004#2 = #dsm39001#2;
 #dsm39004#3 = #dsm39001#3;
 #dsm39004#4 = nPrim;
 |LEE 101#dsm39004.=;
 |SI FSalida ! 0;
     |DDEFECTO #dsm39004;
     #dsm39004#0 = enEmpresa;
     #dsm39004#1 = enEjer;
     #dsm39004#2 = #dsm39001#2;
     #dsm39004#3 = #dsm39001#3;
     #dsm39004#4 = nPrim;
     |GRABA 020#dsm39004.b;
 |FINSI;

 |SI aCNAE ! ""; |Y #dsm39004##6 = "     "; #dsm39004#6 = aCNAE; |FINSI;
 |SI nT9 ! #dsm39004#7; |O nT7 ! #dsm39004#8;
     #dsm39004#10 = nTpComun;
 |FINSI;
 #dsm39004#7  = nT9;     || Totales
 #dsm39004#8  = nT7;     || Con derecho a deducir

 |GRABA 020#dsm39004.a;
 |CIERRA #dsm39004;
|FPRC;

|PROCESO ComprueboEsta;
  nSwEsta = 0;
  |PARA nPara1 = 63;  |SI nPara1 [ 83;  |HACIENDO nPara1 = nPara1 + 4;
        |SI #dsm39001#nPara1# = nDepar;
            nSwEsta = 1;
            |SAL;
        |FINSI;
  |SIGUE;
|FPRC;

|PROCESO Leem081;
 nDepar = #dsmom081#2;

 |DDEFECTO #agicen14;
 #agicen14#0 = #dsmom081#0;
 #agicen14#1 = #dsmom081#2;
 |LEE 040#agicen14.=;
 |SI FSalida = 0;
     |SI #dsmom081#1 ] 2009;
         #dsmom081#4 = #agicen14#20;
         |GRABA 020#dsmom081.a;
     |FINSI;
 |SINO;
     |SI #dsmom081#2 = 99; |Y aCNAE ! "";
         #dsmom081#4 = aCNAE;
         |GRABA 020#dsmom081.a;
     |FINSI;
 |FINSI;
 |LIBERA #dsmom081;

 |DDEFECTO #dsm39004;
 #dsm39004#0 = enEmpresa;
 #dsm39004#1 = enEjer;
 #dsm39004#2 = #dsm39001#2;
 #dsm39004#3 = #dsm39001#3;
 #dsm39004#4 = #dsmom081#2;
 |LEE 101#dsm39004.=;
 |SI FSalida ! 0;
     |DDEFECTO #dsm39004;
     #dsm39004#0 = enEmpresa;
     #dsm39004#1 = enEjer;
     #dsm39004#2 = #dsm39001#2;
     #dsm39004#3 = #dsm39001#3;
     #dsm39004#4 = #dsmom081#2;
     #dsm39004#5 = #dsmom081#3;
     #dsm39004#6 = #dsmom081#4;
     |GRABA 020#dsm39004.b;
 |FINSI;
 |SI aCNAE = ""; |Y #dsmom081#4 ! "     ";
     aCNAE = #dsmom081#4;
 |FINSI;
 |SI aCNAE ! ""; |Y #dsmom081#4 = "     ";
     #dsmom081#4 = aCNAE;
 |FINSI;

 #dsm39004#7  = #dsmom081#9;  || Totales
 #dsm39004#8  = #dsmom081#7;  || Con derecho a deducir
 #dsm39004#9  = #dsmom080#4;  || tipo prorrata
 #dsm39004#10 = #dsmom081#6;  || % prorrata

 |SI #dsmom081#2 = 0;
     |BORRA 020#dsm39004.a;
     |LIBERA #dsm39004;
     |ACABA;
 |FINSI;

 |SI #dsmom081#2 = 99;
     |SI #dsm39004#7 = 0; |Y #dsm39004#8 = 0;
         |BORRA 020#dsm39004.a;
     |SINO;
         |GRABA 020#dsm39004.a;
     |FINSI;
     |LIBERA #dsm39004;
     |ACABA;
 |FINSI;

 |HAZ ComprueboEsta;
 |SI enAdTodas = 1;
     |SI nSwEsta = 0;
         |BORRA 020#dsm39004.a;
         |LIBERA #dsm39004;
         |ACABA;
     |FINSI;
 |FINSI;

 |GRABA 020#dsm39004.a;
 |LIBERA #dsm39004;

 nQuants = nQuants + 1;
 |SI nPrim = 0; nPrim = #dsmom081#2; |FINSI;
|FPRC;

|DEFBUCLE Leem081;
 #dsmom081#1;
 ;
 #dsmom080#0, #dsmom080#1, 00;
 #dsmom080#0, #dsmom080#1, 99;
 be;
 NULL, Leem081;
|FINSI;

|PROCESO Leem086;
       nDepar = #dsmom086#2;

       |SI enAdTodas = 1; |Y #dsmom086#6 = 100; |ACABA; |FINSI;

       |DDEFECTO #dsm39004;
       #dsm39004#0 = enEmpresa;
       #dsm39004#1 = enEjer;
       #dsm39004#2 = #dsm39001#2;
       #dsm39004#3 = #dsm39001#3;
       #dsm39004#4 = nDepar;
       |LEE 101#dsm39004.=;
       |SI FSalida ! 0;
           |DDEFECTO #dsm39004;
           #dsm39004#0 = enEmpresa;
           #dsm39004#1 = enEjer;
           #dsm39004#2 = #dsm39001#2;
           #dsm39004#3 = #dsm39001#3;
           #dsm39004#4 = nDepar;
           #dsm39004#5 = #dsmom086#3;
           #dsm39004#6 = #dsmom086#4;
           |GRABA 020#dsm39004.b;
       |FINSI;
       |SI aCNAE = ""; |Y #dsmom086#4 ! "     ";
           aCNAE = #dsmom086#4;
       |FINSI;
       |SI aCNAE ! ""; |Y #dsmom086#4 = "     ";
           #dsmom086#4 = aCNAE;
       |FINSI;

       #dsm39004#7  = #dsmom086#9;  || Totales
       #dsm39004#8  = #dsmom086#7;  || Con derecho a deducir
       #dsm39004#9  = #dsmom085#4;  || tipo prorrata
       #dsm39004#10 = #dsmom086#6;  || % prorrata

       |GRABA 020#dsm39004.a;
       |LIBERA #dsm39004;

       nQuants = nQuants + 1;
       |SI nPrim = 0; nPrim = #dsmom086#2; |FINSI;
|FPRC;

|DEFBUCLE Leem086;
   #dsmom086#1;
   ;
   #dsmom085#0, #dsmom085#1, 01;
   #dsmom085#0, #dsmom085#1, 98;
   e;
   NULL, Leem086;
|FINSI;

|PROCESO CreaLinProrrata;
   aCNAE = "";
   |SI enEjer [ 2010;
       |ABRE #dsmom080;
       #dsmom080#0 = enEmpresa;
       #dsmom080#1 = enEjer;
       |LEE 040#dsmom080.=;
       |SI FSalida ! 0;
           |CIERRA #dsmom080;
           |ACABA;
      |FINSI;
      |CIERRA #dsmom080;
      |SI #dsmom080#4 = "N"; |ACABA; |FINSI;
      |SI #dsmom080#4 = "G"; |Y #dsmom080#5 = 100; |ACABA; |FINSI;

      nTpComun = #dsmom080#32;
      nQuants = 0;
      nPrim   = 0;
      |ABRE #agicen14;
      |ABRE #dsm39004;
      |BUCLE Leem081;
      |CIERRA #dsm39004;
      |CIERRA #agicen14;

      |SI #dsmom080#4 = "E"; |Y nQuants ! 0;
          nT7 = #dsmom080#6;
          nT9 = #dsmom080#8;
          |SI nQuants = 1;
              |HAZ GraboUna;
          |SINO;
              |BUCLE Resto690;
              |HAZ GraboUna;
          |FINSI;
          |SI enAdTodas = 1;
              nSwLimpio = 1;
              |BUCLE Resto690;
              nSwLimpio = 0;
          |FINSI;
      |FINSI;

   |SINO;

       |ABRE #dsmom085;
       #dsmom085#0 = enEmpresa;
       #dsmom085#1 = enEjer;
       |LEE 040#dsmom085.=;
       |SI FSalida ! 0;
           |CIERRA #dsmom085;
           |ACABA;
       |FINSI;
       |CIERRA #dsmom085;
       |SI #dsmom085#4 = "N"; |ACABA; |FINSI;
       |SI #dsmom085#4 = "G"; |Y #dsmom085#5 = 100; |ACABA; |FINSI;

       nTpComun = #dsmom085#17;
       nQuants = 0;
       nPrim   = 0;
       |ABRE #dsm39004;
       |BUCLE Leem086;
       |CIERRA #dsm39004;

       |SI nQuants ! 0;
           |HAZ PaseGrupos123;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO Chequeo_Adq;
  nSubGrupo = 6;
  |SI enEjer ] 2014; nSubGrupo = 15; |FINSI;
  |ABRE #dsm39002;
  |DDEFECTO #dsm39002;
  #dsm39002#0  = enEmpresa;
  #dsm39002#1  = enEjer;
  #dsm39002#2  = enModelo;
  #dsm39002#3  = enComplem;
  #dsm39002#4  = 1;
  #dsm39002#5  = nSubGrupo;
  |LEE 040#dsm39002.=;

  nValor1   = 0;
  |SI enEjer ] 2014;
      |SI #dsm39002#14 ! 0; |O #dsm39002#17 ! 0; |O #dsm39002#20 ! 0;
          |O #dsm39002#23 ! 0; |O #dsm39002#28 ! 0; |O #dsm39002#31 ! 0;
             |O #dsm39002#34 ! 0;
                nValor1 = 1;
      |FINSI;
  |SINO;
      |SI #dsm39002#37 ! 0; |O #dsm39002#40 ! 0; |O #dsm39002#43 ! 0;
         |O #dsm39002#46 ! 0; |O #dsm39002#49 ! 0; |O #dsm39002#52 ! 0;
           |O #dsm39002#55 ! 0;
              nValor1 = 1;
      |FINSI;
  |FINSI;

  |DDEFECTO #dsm39002;
  #dsm39002#0  = enEmpresa;
  #dsm39002#1  = enEjer;
  #dsm39002#2  = enModelo;
  #dsm39002#3  = enComplem;
  #dsm39002#4  = 2;
  #dsm39002#5  = 13;
  |LEE 040#dsm39002.=;

  nValor2   = 0;
  |SI #dsm39002#14 ! 0; |O #dsm39002#17 ! 0; |O #dsm39002#20 ! 0;
      |O #dsm39002#23 ! 0; |O #dsm39002#28 ! 0; |O #dsm39002#31 ! 0;
         |O #dsm39002#34 ! 0;
            nValor2 = 1;
  |FINSI;
  |CIERRA #dsm39002;

  |SI nValor1 = nValor2;  || Si en los dos hay importes
      |ACABA;             || o son los dos 0.
  |FINSI;
  |SI nValor1 = 1;
      aAlfa = "Hay IVA DEVENGADO por Adq.Intr.Serv. y no hay IVA Deducible por dichas operaciones.";
  |FINSI;
  |SI nValor2 = 1;
      aAlfa = "Hay IVA DEDUCIBLE por Adq.Intr.Serv. y no hay IVA Devengado por dichas operaciones.";
  |FINSI;
  aAlfa = "1234" + aAlfa + ". Revisar.";
  |MENAV aAlfa;
|FPRC;

|PROCESO ControlaNoMod390;
     nError = 0;

     |SI enEjer [ 2013;  |ACABA;  |FINSI;

     |ABRE #dsm30301;
     #dsm30301#0  = #dsmom004#0
     #dsm30301#1  = #dsmom004#1
     #dsm30301#2  = 12;
     #dsm30301#3  = 303;
     #dsm30301#4  = 99;
     #dsm30301#5  = 9;
     |LEE 000#dsm30301.];
     |SI FSalida = 0;
         |LEE 000#dsm30301.a;
     |SINO;
         |LEE 000#dsm30301.u;
     |FINSI;

     |SI FSalida = 0;  |Y  #dsm30301#0  = #dsmom004#0;
                       |Y  #dsm30301#1  = #dsmom004#1;
                       |Y  #dsm30301#2  = 12;
                       |Y  #dsm30301#3  = 303;

         |SI #dsm30301#96  ! 0;  nError = 1;  |FINSI;
         |SI #dsm30301#100 ! 0;  nError = 1;  |FINSI;
         |SI #dsm30301#104 ! 0;  nError = 1;  |FINSI;
         |SI #dsm30301#108 ! 0;  nError = 1;  |FINSI;
         |SI #dsm30301#112 ! 0;  nError = 1;  |FINSI;
         |SI #dsm30301#116 ! 0;  nError = 1;  |FINSI;

         |SI #dsm30301#129 ! 0;  nError = 1;  |FINSI;
     |FINSI;
     |CIERRA #dsm30301;

     |SI nError = 1;
         |CONFI "0000NLa empresa no esta obligada a presentar el 390, quiere presentarlo de todas formas";
         |SI FSalida = 0;
             nError = 0;
             |ACABA;
         |FINSI;
     |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#7  = "";
         #dsmom004#8  = "01.01.0000";
         #dsmom004#9  = " ";
         #dsmom004#15 = 0;
         #dsmom004#17 = "SIN DATOS";

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROCESO Pase390;

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |CIERRA #dsmom004; |ACABA;   |FINSI;
     |CIERRA #dsmom004;

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmom004#4;
     enTipoEntrada = 3;
     enMensa       = 1;
     |SUB_EJECUTA_NP "dsm39001";

     nError = 0;
     |HAZ ControlaNoMod390;
     |SI nError = 1;  |ACABA;  |FINSI;

     enTipoEntrada = 95;
     |SUB_EJECUTA_NP "dsm39001";

     |ABRE #dsm39001;
     #dsm39001#0  = enEmpresa;
     #dsm39001#1  = enEjer;
     #dsm39001#2  = enModelo;
     #dsm39001#3  = enComplem;
     |LEE 101#dsm39001.=;
     |SI FSalida ! 0;  |CIERRA #dsm39001;  |ACABA;  |FINSI;

     |ABRE #dsmom004;

     nError    = 0;
     nAtri     = 0;
     nContAtri = 0;

     |SI enEjer [ 2008;
         |HAZ ControlaRegGeneral2008;
     |SINO;
         |HAZ ControlaRegGeneral2009;
     |FINSI;

     |SI nError = 1;  |LIBERA #dsm39001; |HAZ Errores;  |ACABA;  |FINSI;

     |HAZ ControlaRegSimplificado;
     |SI nError = 1;  |LIBERA #dsm39001; |HAZ Errores;  |ACABA;  |FINSI;

     |SI nSwHay300 = 0;  |Y nSwHay310 = 0;
         |LIBERA #dsm39001;
         |CIERRA #dsm39001;
         |HAZ Errores;
         |MENAV "      Seleccion Vacia";
         |ACABA;
     |FINSI;

     || .. No era correcto, Tarea 12729
     ||    #dsm39001#114 = #dsm39001#10;

     |GRABA 020#dsm39001.a;
     |LIBERA #dsm39001;
     |CIERRA #dsm39001;

     |HAZ CreaLinProrrata;

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |CIERRA #dsmom004; |ACABA;   |FINSI;
     |CIERRA #dsmom004;

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmom004#4;
     enTipoEntrada = 95;
     enMensa       = 1;
     |SUB_EJECUTA_NP "dsm39001";

     |SI enEjer ] 2010;
         |HAZ Chequeo_Adq;
     |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#7  = "X";
         #dsmom004#8  = ~;
         #dsmom004#9  = " ";
         #dsmom004#15 = 0;
         #dsmom004#17 = "COMPLETADO";

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;
