|FICHEROS;
     dsmoy000;
     dsmom001;
     dsmom004;
     dsmom107;

     dsm193ca #193;
     dsm193li;
     dsm193ga;

     dsmow014;

     dsmow525;
     dsmow562;
     dsmow563;
     dsmow564;

     dsmow603;
     dsmow604;
     dsmow605;

     :/basica/def/agim0024;
     :/basica/def/agim0026;

     &clientes@;
|FIN;

|VARIABLES;
     aNombre     = "";
     aPathAfegir = "";
     aIPRemoto   = "";
     aBue        = "";
|FIN;

|INCLUYE i_varemi;

|PROCESO Registro193_1_2010;
     enCodCli = #dsm193ca#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow562;

     #dsmow562#0  = "1";

     #dsmow562#1  = "193";

     #dsmow562#2  = #dsm193ca#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #dsmow562#3   = eaVarDni;

         eaAlfa   = #clientes@#1;  |HAZ QuitaRaros;
         #dsmow562#4   = eaAlfa;

         eaAlfa   = #clientes@#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #clientes@#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #dsmow562#6   = eaAlfa;

         eaAlfa   = #clientes@#53;  |HAZ QuitaRaros;
         #dsmow562#7   = eaAlfa;

         eaDeleg     = #clientes@#17;
         eaAdmin     = #clientes@#18;
         eaProvincia = #clientes@#38;
     |SINO;
         aAlfa = #clientes@#96; |QBF aAlfa; |SI aAlfa = ""; #clientes@#96 = #clientes@#2; |FINSI;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #dsmow562#3   = eaVarDni;

         eaAlfa   = #clientes@#1;   |HAZ QuitaRaros;
         #dsmow562#4   = eaAlfa;

         eaAlfa   = #clientes@#14;  |HAZ QuitaRarosTfno;
         #dsmow562#6   = eaAlfa;

         eaAlfa   = #clientes@#96;  |HAZ QuitaRaros;
         #dsmow562#7   = eaAlfa;

         eaDeleg     = #clientes@#91;
         eaAdmin     = #clientes@#92;
         eaProvincia = #clientes@#12;
     |FINSI;

     #dsmow562#5  = "T";

     #dsmow562#8 = "1730000000000";

     nNume   = #dsm193ca#6;
     #dsmow562#12 = ("000000000" + nNume) % -109;

     enNume  = #dsm193ca#7;  |HAZ Conver15Signo;
     #dsmow562#13 = eaAlfa;

     enNume  = #dsm193ca#8;  |HAZ Conver15Signo;
     #dsmow562#14 = eaAlfa;

     enNume  = #dsm193ca#9;  |HAZ Conver15Signo;
     #dsmow562#15 = eaAlfa;

     enNume  = #dsm193ca#10; |HAZ Conver15Signo;
     #dsmow562#16 = eaAlfa;

     enNume  = #dsm193ca#11; |HAZ Conver15Signo;
     #dsmow562#17 = eaAlfa;

     enNume  = #dsm193ca#12; |HAZ Conver15Signo;
     #dsmow562#18 = eaAlfa;

     |SI #dsm193ca#15 = "S";  #dsmow562#19 = "S";  |FINSI;

     |SI #dsm193ca#14 = "C";  #dsmow562#9  = "C";  |FINSI;

     |SI #dsm193ca#14 = "S";
         #dsmow562#10 = "S";
         #dsmow562#11 = #dsm193ca#13;
     |FINSI;

     #dsmow562#21 = &13 + &10;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 21;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #dsmow562#nCampo#;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Registro193_1_2011;
     enCodCli = #dsm193ca#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow603;

     #dsmow603#0  = "1";

     #dsmow603#1  = "193";

     #dsmow603#2  = #dsm193ca#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #dsmow603#3   = eaVarDni;

         eaAlfa   = #clientes@#1;  |HAZ QuitaRaros;
         #dsmow603#4   = eaAlfa;

         eaAlfa   = #clientes@#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #clientes@#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #dsmow603#6   = eaAlfa;

         eaAlfa   = #clientes@#53;  |HAZ QuitaRaros;
         #dsmow603#7   = eaAlfa;

         eaDeleg     = #clientes@#17;
         eaAdmin     = #clientes@#18;
         eaProvincia = #clientes@#38;
     |SINO;
         aAlfa = #clientes@#96; |QBF aAlfa; |SI aAlfa = ""; #clientes@#96 = #clientes@#2; |FINSI;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #dsmow603#3   = eaVarDni;

         eaAlfa   = #clientes@#1;   |HAZ QuitaRaros;
         #dsmow603#4   = eaAlfa;

         eaAlfa   = #clientes@#14;  |HAZ QuitaRarosTfno;
         #dsmow603#6   = eaAlfa;

         eaAlfa   = #clientes@#96;  |HAZ QuitaRaros;
         #dsmow603#7   = eaAlfa;

         eaDeleg     = #clientes@#91;
         eaAdmin     = #clientes@#92;
         eaProvincia = #clientes@#12;
     |FINSI;

     #dsmow603#5  = "T";

     #dsmow603#8 = "1930000000000";

     nNume   = #dsm193ca#6;
     #dsmow603#12 = ("000000000" + nNume) % -109;

     enNume  = #dsm193ca#7;  |HAZ Conver15Signo;
     #dsmow603#13 = eaAlfa;

     enNume  = #dsm193ca#8;  |HAZ Conver15Signo;
     #dsmow603#14 = eaAlfa;

     enNume  = #dsm193ca#9;  |HAZ Conver15Signo;
     #dsmow603#15 = eaAlfa;

     enNume  = #dsm193ca#12; |HAZ Conver15Signo;
     #dsmow603#18 = eaAlfa;

     |SI #dsm193ca#15 = "S";  #dsmow603#19 = "S";  |FINSI;

     |SI #dsm193ca#14 = "C";  #dsmow603#9  = "C";  |FINSI;

     |SI #dsm193ca#14 = "S";
         #dsmow603#10 = "S";
         #dsmow603#11 = #dsm193ca#13;
     |FINSI;

     |SI #dsm193ca#14 = "C";
         #dsmow603#11 = #dsm193ca#13;
     |FINSI;

     #dsmow603#22 = &13 + &10;

     nHCampo = 22;
     |SI #dsmoy000#6 ] 2012;  |Y eaOpcion ! "3";
         nHCampo = 21;
     |FINSI;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #dsmow603#nCampo#;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO dsm193ca;
     |SI #dsmoy000#6 [ 2010;  |HAZ Registro193_1_2010;  |FINSI;
     |SI #dsmoy000#6 ] 2011;  |HAZ Registro193_1_2011;  |FINSI;
|FPRC;

|PROCESO Registro193_2_2010;
     enCodCli = #dsm193ca#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow563;

     #dsmow563#0  = "2";

     #dsmow563#1  = "193";

     #dsmow563#2  = #dsm193ca#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #dsmow563#3   = eaVarDni;
     |SINO;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #dsmow563#3   = eaVarDni;
     |FINSI;

     eaVarDni = #dsm193li#6;  |HAZ CalculameDNI;
     |SI #dsm193li#11 = "N";
         #dsmow563#4 = eaVarDni;
     |SINO;
         #dsmow563#5 = eaVarDni;
     |FINSI;

     |SI #dsm193li#6  = "999999999999";
         #dsmow563#4  = "999999999";
         #dsmow563#5  = "999999999";
         #dsmow563#16 = "X";
     |FINSI;

     eaAlfa = #dsm193li#12;  |HAZ QuitaRaros;
     #dsmow563#6 = eaAlfa;

     |SI #dsm193li#13 = "S";  #dsmow563#7 = "X";  |FINSI;

     #dsmow563#8  = ("00" + #dsm193li#14) % -102;
     #dsmow563#9  = #dsm193li#15;
     #dsmow563#10 = #dsm193li#16;
     #dsmow563#11 = #dsm193li#8;
     #dsmow563#12 = #dsm193li#9;
     #dsmow563#13 = #dsm193li#17;
     #dsmow563#14 = #dsm193li#18;
     #dsmow563#15 = #dsm193li#19;
     #dsmow563#17 = ("0000" + #dsm193li#7) % -104;
     #dsmow563#18 = #dsm193li#10;

     enNume  = #dsm193li#20;  |HAZ Conver13Signo;
     #dsmow563#19 = eaAlfa;

     #dsmow563#20 = ("000" + #dsm193li#21) % -103;

     enNume  = #dsm193li#22;  |HAZ Conver13Signo;
     #dsmow563#21 = eaAlfa;

     enNume  = #dsm193li#23;  |HAZ Conver13Signo;
     #dsmow563#22 = eaAlfa;

     nNume   = #dsm193li#24 * 100;
     #dsmow563#23 = ("0000" + nNume) % -104;

     enNume  = #dsm193li#25;  |HAZ Conver13Signo;
     #dsmow563#24 = eaAlfa;

     enNume  = #dsm193li#27;  |HAZ Conver13Signo;
     #dsmow563#25 = eaAlfa;

     |SI #dsm193ca#15 = "S";  #dsmow563#27 = "S";  |FINSI;

     |SI #dsmoy000#6 [ 2003;
         #dsmow563#28 = "";
     |SINO;
         |SI #dsm193li#18 ! "P";
             #dsmow563#28 = "0000000000000000000000000000000000000000";
         |SINO;
             aAlfa1 = (#dsm193li#29 % -104) + (#dsm193li#29 % 0402) + (#dsm193li#29 % 102);
             aAlfa2 = (#dsm193li#30 % -104) + (#dsm193li#30 % 0402) + (#dsm193li#30 % 102);

             enNume = #dsm193li#31;  |HAZ Conver12Signo;
             aAlfa3 = eaAlfa;

             enNume = #dsm193li#32;  |HAZ Conver12Signo;
             aAlfa4 = eaAlfa;

             #dsmow563#28 = aAlfa1 + aAlfa2 + aAlfa3 + aAlfa4;
         |FINSI;
     |FINSI;

     #dsmow563#29 = &13 + &10;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 29;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #dsmow563#nCampo#;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |SINO;
         |PRINT;
         nSwPrint = 1;
     |FINSI;
|FPRC;

|PROCESO Registro193_2_2011;
     enCodCli = #dsm193ca#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow604;

     #dsmow604#0  = "2";

     #dsmow604#1  = "193";

     #dsmow604#2  = #dsm193ca#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #dsmow604#3   = eaVarDni;
     |SINO;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #dsmow604#3   = eaVarDni;
     |FINSI;

     eaVarDni = #dsm193li#6;  |HAZ CalculameDNI;
     |SI #dsm193li#11 = "N";
         #dsmow604#4 = eaVarDni;
     |SINO;
         #dsmow604#5 = eaVarDni;
     |FINSI;

     |SI #dsm193li#6  = "999999999999";
         #dsmow604#4  = "999999999";
         #dsmow604#5  = "999999999";
         #dsmow604#16 = "X";
     |FINSI;

     eaAlfa = #dsm193li#12;  |HAZ QuitaRaros;
     #dsmow604#6 = eaAlfa;

     |SI #dsm193li#13 = "S";  #dsmow604#7 = "X";  |FINSI;

     #dsmow604#8  = ("00" + #dsm193li#14) % -102;
     #dsmow604#9  = #dsm193li#15;
     #dsmow604#10 = #dsm193li#16;
     #dsmow604#11 = #dsm193li#8;
     #dsmow604#12 = #dsm193li#9;
     #dsmow604#13 = #dsm193li#17;
     #dsmow604#14 = #dsm193li#18;
     #dsmow604#15 = #dsm193li#19;
     #dsmow604#17 = ("0000" + #dsm193li#7) % -104;
     #dsmow604#18 = #dsm193li#10;

     enNume  = #dsm193li#20;  |HAZ Conver13Signo;
     #dsmow604#19 = eaAlfa;

     enNume  = #dsm193li#22;  |HAZ Conver13Signo;
     #dsmow604#21 = eaAlfa;

     enNume  = #dsm193li#23;  |HAZ Conver13Signo;
     #dsmow604#22 = eaAlfa;

     |SI #dsmoy000#6 = 2015;
         |SI #dsm193li#8 = "C"; |Y #dsm193li#9 = "08";
             #dsm193li#24 = 24;
         |SINO;
             |SI #dsm193li#8 ! "B"; |O #dsm193li#9 ! "04";
                 |SI #dsm193li#24 ! 20;    |Y #dsm193li#24 ! 19.5;
                    |Y #dsm193li#24 ! 10;    |Y #dsm193li#24 ! 9.75;
                      |Y #dsm193li#24 > 0;
                    |SI #dsm193li#24 < 20;  #dsm193li#24 = 19.5;  |FINSI;
                    |SI #dsm193li#24 < 12;  #dsm193li#24 = 10;    |FINSI;
                    |SI #dsm193li#24 < 10;  #dsm193li#24 = 9.75;  |FINSI;
                    |SI #dsm193li#24 ] 20;  #dsm193li#24 = 20;    |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     nNume   = #dsm193li#24 * 100;
     #dsmow604#23 = ("0000" + nNume) % -104;

     enNume  = #dsm193li#25;  |HAZ Conver13Signo;
     #dsmow604#24 = eaAlfa;

     |SI #dsm193ca#15 = "S";  #dsmow604#27 = "S";  |FINSI;

     |SI #dsm193li#18 ! "P";
         #dsmow604#28 = "00000000";
         #dsmow604#29 = "00000000";
         #dsmow604#30 = "000000000000";
         #dsmow604#31 = "000000000000";
     |SINO;
         #dsmow604#28 = (#dsm193li#29 % -104) + (#dsm193li#29 % 0402) + (#dsm193li#29 % 102);
         #dsmow604#29 = (#dsm193li#30 % -104) + (#dsm193li#30 % 0402) + (#dsm193li#30 % 102);

         enNume  = #dsm193li#31;  |HAZ Conver12Signo;  #dsmow604#30 = eaAlfa;
         enNume  = #dsm193li#32;  |HAZ Conver12Signo;  #dsmow604#31 = eaAlfa;
     |FINSI;

     #dsmow604#34 = &13 + &10;

     nHCampo = 34;
     |SI #dsmoy000#6 ] 2012;  |Y eaOpcion ! "3";
         nHCampo = 33;
     |FINSI;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #dsmow604#nCampo#;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
    |SINO;
         |PRINT;
         nSwPrint = 1;
    |FINSI;
|FPRC;

|PROCESO dsm193li;
     |SI #dsmoy000#6 [ 2010;  |HAZ Registro193_2_2010;  |FINSI;
     |SI #dsmoy000#6 ] 2011;  |HAZ Registro193_2_2011;  |FINSI;
|FPRC;

|DEFBUCLE dsm193li;
     #dsm193li#1;
     ;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,"            ",0000," ","  ",1;
     #193#0,#193#1,#193#2,#193#3,#193#4,#193#5,"zzzzzzzzzzzz",9999,"z","zz",2;
     ;
     NULL, dsm193li;
|FIN;

|PROCESO Registro193_3_2010;
     enCodCli = #dsm193ca#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow564;

     #dsmow564#0  = "2";

     #dsmow564#1  = "193";

     #dsmow564#2  = #dsm193ca#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #dsmow564#3   = eaVarDni;
     |SINO;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #dsmow564#3   = eaVarDni;
     |FINSI;

     eaVarDni = #dsm193ga#6;  |HAZ CalculameDNI;
     |SI #dsm193ga#7 = "N";
         #dsmow564#4 = eaVarDni;
     |SINO;
         #dsmow564#5 = eaVarDni;
     |FINSI;

     eaAlfa = #dsm193ga#8;   |HAZ QuitaRaros;
     #dsmow564#6 = eaAlfa;

     enNume  = #dsm193ga#9;  |HAZ Conver13Signo;
     #dsmow564#8  = eaAlfa;

     #dsmow564#10 = &13 + &10;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 10;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #dsmow564#nCampo#;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |SINO;
         |PRINT;
         nSwPrint = 1;
     |FINSI;
|FPRC;

|PROCESO Registro193_3_2011;
     enCodCli = #dsm193ca#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow605;

     #dsmow605#0  = "2";

     #dsmow605#1  = "193";

     #dsmow605#2  = #dsm193ca#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #dsmow605#3   = eaVarDni;
     |SINO;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #dsmow605#3   = eaVarDni;
     |FINSI;

     eaVarDni = #dsm193ga#6;  |HAZ CalculameDNI;
     |SI #dsm193ga#7 = "N";
         #dsmow605#4 = eaVarDni;
     |SINO;
         #dsmow605#5 = eaVarDni;
     |FINSI;

     eaAlfa = #dsm193ga#8;   |HAZ QuitaRaros;
     #dsmow605#6 = eaAlfa;

     enNume  = #dsm193ga#9;  |HAZ Conver13Signo;
     #dsmow605#8  = eaAlfa;

     #dsmow605#11 = &13 + &10;

     nHCampo = 11;
     |SI #dsmoy000#6 ] 2012;  |Y eaOpcion ! "3";
         nHCampo = 10;
     |FINSI;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #dsmow605#nCampo#;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |SINO;
         |PRINT;
         nSwPrint = 1;
     |FINSI;
|FPRC;

|PROCESO dsm193ga;
     |SI #dsmoy000#6 [ 2010;  |HAZ Registro193_3_2010;  |FINSI;
     |SI #dsmoy000#6 ] 2011;  |HAZ Registro193_3_2011;  |FINSI;
|FPRC;

|DEFBUCLE dsm193ga;
     #dsm193ga#1;
     ;
     #dsm193ca#0,#dsm193ca#1,#dsm193ca#2,#dsm193ca#3,#dsm193ca#4,#dsm193ca#5,"            ";
     #dsm193ca#0,#dsm193ca#1,#dsm193ca#2,#dsm193ca#3,#dsm193ca#4,#dsm193ca#5,"zzzzzzzzzzzz";
     ;
     NULL, dsm193ga
|FIN;

|PROCESO BuscaCargo193;
     eaAlfa  = #agim0026#4;  |HAZ QuitaRaros;
     #dsmow525#13 = eaAlfa;

     eaAlfa  = #agim0026#17;  |HAZ QuitaRaros;
     #dsmow525#14 = eaAlfa;
|FPRC;

|DEFBUCLE agim0026;
     #agim0026#1;
     16;
     #dsm193ca#0, 01, 01, 3;
     #dsm193ca#0, 99, 99, 3;
     ;
     NULL, BuscaCargo193;
|FIN;

|PROCESO BuscaCargo193R;
     |SI #agim0024#15 ! "A";
         eaAlfa  = #agim0024#4;  |HAZ QuitaRaros;
         #dsmow525#13 = eaAlfa;

         eaAlfa  = "REPRESENTANTE";  |HAZ QuitaRaros;
         #dsmow525#14 = eaAlfa;

         nHayRepre = 1;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE agim0024;
     #agim0024#2;
     ;
     #dsm193ca#0, 99, 01;
     #dsm193ca#0, 01, 99;
     ;
     NULL, BuscaCargo193R;
|FIN;

|PROCESO BuscaComuneros193;
     aAlfa = "31.12." + #dsm193ca#1;
     |SI #dsmom001#8 > aAlfa;  |ACABA;  |FINSI;

     aAlfa = "01.01." + #dsm193ca#1;
     |SI #dsmom001#9 > "01.01.0000";
         |SI #dsmom001#9 < aAlfa;  |ACABA;  |FINSI;
     |FINSI;

     nHayRepre = 1;

     enCodCli = #dsmom001#3;
     |HAZ LeePersona;

     eaAlfa  = #clientes@#1;           |HAZ QuitaRaros;   #dsmow525#13 = eaAlfa;
     eaAlfa  = "REPRESENTANTE";  |HAZ QuitaRaros;   #dsmow525#14 = eaAlfa;

     |ERROR10;
|FPRC;

|DEFBUCLE dsmom001;
     #dsmom001#1;
     ;
     #dsm193ca#0, 01, 0001;
     #dsm193ca#0, 99, 9999;
     ;
     NULL, BuscaComuneros193;
|FIN;

|PROCESO Lee1931;        || Creacion de Ficheros
     |ABRE #dsmom004;
     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = #dsmow014#5;
     #dsmom004#4  = #dsmow014#7;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #dsmom004;

     |ABRE #dsm193ca;
     #dsm193ca#0  = #dsmow014#0;
     #dsm193ca#1  = #dsmow014#1;
     #dsm193ca#2  = #dsmow014#2;
     #dsm193ca#3  = #dsmow014#5;
     #dsm193ca#4  = #dsmow014#7;
     #dsm193ca#5  = 0;
     |LEE 040#dsm193ca.=;
     |SI FSalida = 0;
         |SI #dsmoy000#6 [ 2003;
             aAbre = eaPathEmision + "RC" + (("00000" + #dsmow014#0) % -105) + ".TXT";
         |SINO;
             aAbre = eaPathEmision + "RCA" + (("00000" + #dsmow014#0) % -105) + ".TXT";
         |FINSI;
         |XABRE "BW", aAbre, nHandle2;
     |FINSI;

     |HAZ dsm193ca;
     |BUCLE dsm193li;
     |BUCLE dsm193ga;

     |XCIERRA nHandle2;

     |SI #dsmoy000#6 [ 2003;
         eaFOrigen  = eaPathEmision + "RC" + (("00000" + #dsmow014#0) % -105) + ".TXT";
         eaFDestino = eaPathLanza   +  "RC" + (("00000" + #dsmow014#0) % -105) + ".TXT";
     |SINO;
         eaFOrigen  = eaPathEmision + "RCA" + (("00000" + #dsmow014#0) % -105) + ".TXT";
         eaFDestino = eaPathLanza   + "RCA" + (("00000" + #dsmow014#0) % -105) + ".TXT";
     |FINSI;

     |HAZ CopiaFichero;
     |FBORRA eaFOrigen;

     |SI #dsmoy000#6 [ 2005;
         aAlfa = "wait VI193 /E:RCA" + (("00000" + #dsmow014#0) % -105) + ".TXT ";
         aAlfa = aAlfa + "/R:RCC" + (("00000" + #dsmow014#0) % -105) + ".TXT ";
         aAlfa = aAlfa + &13 + &10;
         |XGRABA nHandle1, aAlfa;
     |SINO;
         eaTipoE =  "RCA" + (("00000" + #dsmow014#0) % -105) + ".TXT";
         eaTipoR =  "RCC" + (("00000" + #dsmow014#0) % -105) + ".TXT";
         eaTipoV =  "S";

         |HAZ LineaShellJava;
     |FINSI;
     |CIERRA #dsm193ca;
|FPRC;

|PROCESO Auxiliar193;
     enCodCli = #dsm193ca#0;
     |HAZ LeePersona;

     |DDEFECTO #dsmow525;

     #dsmow525#0  = "1";

     #dsmow525#1  = "193";

     #dsmow525#2  = #dsm193ca#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #dsmow525#3   = eaVarDni;

         #dsmow525#4   = ("00" + #clientes@#15) % -102;

         #dsmow525#5   = ("000" + #clientes@#16) % -103;

         #dsmow525#6   = #clientes@#29;

         eaAlfa   = #clientes@#30;  |HAZ QuitaRaros;
         #dsmow525#7   = eaAlfa;

         nNume    = #clientes@#31;
         #dsmow525#8   = ("00000" + nNume) % -105;

         #dsmow525#9   = #clientes@#37;

         #dsmow525#10  = ("00" + #clientes@#35) % -102;

         #dsmow525#11  = (("00" + #clientes@#35) % -102) + (("000" + #clientes@#36) % -103);
     |SINO;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #dsmow525#3   = eaVarDni;

         #dsmow525#4   = ("00" + #clientes@#63) % -102;

         #dsmow525#5   = ("000" + #clientes@#64) % -103;

         #dsmow525#6   = #clientes@#3;

         eaAlfa   = #clientes@#4;  |HAZ QuitaRaros;
         #dsmow525#7   = eaAlfa;

         nNume    = #clientes@#5;
         #dsmow525#8   = ("00000" + nNume) % -105;

         #dsmow525#9   = #clientes@#11;

         #dsmow525#10  = ("00" + #clientes@#9) % -102;

         #dsmow525#11  = (("00" + #clientes@#9) % -102) + (("000" + #clientes@#10) % -103);
     |FINSI;

     #dsmow525#12  = (#dsmoy000#7 % -104) + (#dsmoy000#7 % 402) + (#dsmoy000#7 % 102);

     |SI #dsmom107#1 = "S";
         |BUCLE agim0026;
     |SINO;
         nHayRepre = 0;
         |BUCLE agim0024;
         |SI nHayRepre = 0;
             |BUCLE dsmom001;
             |SI nHayRepre = 0;
                 eaAlfa  = #dsmow014#3;  |HAZ QuitaRaros;
                 #dsmow525#13 = eaAlfa;

                 eaAlfa  = "TITULAR";  |HAZ QuitaRaros;
                 #dsmow525#14 = eaAlfa;
             |FINSI;
         |FINSI;
     |FINSI;

     #dsmow525#15 = ("00000" + #dsmow014#0) % -105;
|FPRC;

|PROCESO Lee193P;       || Emision Papel
     |ABRE #dsmom004;
     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = #dsmow014#5;
     #dsmom004#4  = #dsmow014#7;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #dsmom004;

     |ABRE #dsm193ca;
     #dsm193ca#0  = #dsmow014#0;
     #dsm193ca#1  = #dsmow014#1;
     #dsm193ca#2  = #dsmow014#2;
     #dsm193ca#3  = #dsmow014#5;
     #dsm193ca#4  = #dsmow014#7;
     #dsm193ca#5  = 0;
     |LEE 040#dsm193ca.=;
     |SI FSalida = 0;
         nSwPrint  = 0;
         enSwImpre = 0;
         |HAZ Auxiliar193;
         |HAZ dsm193ca;
         enSwImpre = 1;  |BUCLE dsm193li;
         enSwImpre = 2;  |BUCLE dsm193ga;
         |SI nSwPrint = 0;
             enSwImpre = 0;
             |DDEFECTO #dsm193li;
             |DDEFECTO #dsm193ga;
             |PRINT;
         |FINSI;
         |PIEINF;
     |FINSI;
     |CIERRA #dsm193ca;
|FPRC;

|PROCESO QueHacemos193;
     |SI nTeclaPapel ! 0;  |O nTecla = 5;   || En Papel Continuo
         |HAZ Lee193P;
         |ACABA;
     |FINSI;

     |HAZ Lee1931;          || Creacion de los Ficheros Planos.
|FPRC;

|DEFBUCLE dsmow014C193;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos193;
|FIN;

|DEFBUCLE dsmow014N193;
     #dsmow014#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos193;
|FIN;

|PROCESO Boton1931;
     |PTEC 824;
|FPRC;

|PROCESO Boton1932;
     |PTEC 825;
|FPRC;

|PROCESO Boton1933;
     |PTEC 826;
|FPRC;

|PROCESO Boton1934;
     |PTEC 827;
|FPRC;

|PROCESO Boton1935;
     |PTEC 828;
|FPRC;

|PROCESO Boton1936;
     |PTEC 806;
|FPRC;

|PROCESO PapelContinuo193;
     Impresora = "CrystalReports";
     |IMPRE -1;
     |SI FSalida ! 0;
         |MENAV "    Error en Impresora";
         |ACABA;
     |FINSI;

     |SI nTeclaPapel = 0;
         |SI #dsmoy000#6 ] 2011;
             |INFOR "m193co01";
         |SINO;
             |INFOR "m193co02";
         |FINSI;
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dsmoy000#8 = "C";
         |BUCLE dsmow014C193;
     |SINO;
         |BUCLE dsmow014N193;
     |FINSI;

     |FININF;
     |FINIMP;
|FPRC;

|PROCESO PapelOficial193;
     nTeclaPapel = 0;
     |HAZ PapelContinuo193;
|FPRC;

|PROCESO Botones193_2003;
     |BLANCO 0501 2380;
     |CUADRO 0501 2380;

     |ATRI I;
     |PINTA 0602, "Hacienda no ha proporcionado un programa para la emision en laser o";
     |PINTA 0702, "prevalidacion del modelo 193.";

     |PINTA 0902, "Para poder emitir o prevalidar deberemos bajarnos el programa que nos";
     |PINTA 1002, "proporciona Hacienda en su pagina web (www.aeat.es) en el apartado de";
     |PINTA 1102, "Descarga de Programas/Declaraciones Informativas/Modelo 193-2003 y ";
     |PINTA 1202, "con los ficheros generados en nuestro programa, importar los ficheros";
     |PINTA 1302, "desde el programa de Hacienda, para su emision o prevalidacion.";

     |PINTA 1502, "Emitiendo el informe de comprobacion podemos obtener los datos que nos";
     |PINTA 1602, "pudieran hacer falta.                                                 ";

     |ATRI i;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Generacion Fichero ", 1813, 1954, Boton1931;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Informe de Comprobacion              ", 2013, 2154, Boton1934;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2165, 2178, Boton1936;
     nBoton3 = FSalida;

     aF2 = &255 + "824";
     aF5 = &255 + "827";
     aF7 = &255 + "806";

     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTecla = 1;   |SAL;  |FINSI;
         |SI aTecla = aF5;
             nTecla = 5;
             |HAZ PapelOficial193;
         |FINSI;
         |SI aTecla = aF7;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;

     |PULSATECLA;
|FPRC;

|PROCESO Botones193_2004;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Generacion Fichero para Internet", 0513, 0754, Boton1931;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Informe de Comprobacion              ", 0913, 1154, Boton1934;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2165, 2178, Boton1936;
     nBoton3 = FSalida;

     aF2 = &255 + "824";
     aF5 = &255 + "827";
     aF7 = &255 + "806";

     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTecla = 1;   |SAL;  |FINSI;
         |SI aTecla = aF5;
             nTecla = 5;
             |HAZ PapelOficial193;
         |FINSI;
         |SI aTecla = aF7;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;

     |PULSATECLA;
|FPRC;

|PROCESO Proceso193_2003;
     |SI #dsmoy000#8 = "C";
         |BUCLE dsmow014C193;
     |SINO;
         |BUCLE dsmow014N193;
     |FINSI;

     |SI nTecla = 1;
         aAlfa = "0000 Los fichero generados esta en el Directorio " + eaPathLanza + " de su PC.";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO CreaVarios;
     aIPRemoto   = "";
     |IP_REMOTO aIPRemoto;

     aPathInter  = eaPathLanza + "AInternet";
     aPathInter  = aPathInter + "/";
     aFichero    = aPathInter + "*.bue";
     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            aBue     = aFichero - aPathInter;
            aDestino = eaPathInternet + "193" + (aBue % 405) + ".txt";

            |RCOPIA_FICHERO aFichero, aDestino;

            |RFBORRA aFichero;

            |R_SDIR aFichero;
     |SIGUE;

     aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
     |MENAV aAlfa;
|FPRC;

|PROCESO Internet2004;
     eaFichError  = "rcc";
     eaFichDatos  = "rca";
     eaFichAuxil  = "";
     enValidacion = 1;

     |HAZ BuscaErroresL;

     |SI enBuenos = 0;
         |MENAV "      Ha habido Errores, arreglelos y vuelva a emitir.";
         |ACABA;
     |FINSI;

     |HAZ CreaVarios;
|FPRC;

|PROCESO EmiteEsto193;
     aAlfa = "DEL *.DLL" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL *.TAB" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL *.WMF" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL ERROR193.TXT"     + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL *.EXE"         + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     |XCIERRA nHandle1;

     |DBASS aModelos;  |QBT aModelos;
     aModelos = aModelos + "basica/";

     |SI #dsmoy000#6 = 2004;
         eaFOrigen  = aModelos + "patrones/zpr04193.exe";
         eaFDestino = eaPathLanza + "zpr04193.exe";
         |HAZ CopiaFichero;
     |FINSI;

     aAlfa = eaPathLanza + "IMPRIME";

     |RSYSTEM aAlfa;

     |HAZ Internet2004;
|FPRC;

|PROCESO AbreImprime193;
     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "CD " + eaPathLanza + &13 + &10;    |XGRABA nHandle1, aAlfa;

     |SI #dsmoy000#6 = 2004;
         aAlfa = "ZPR04193.EXE -Y" + &13 + &10;  |XGRABA nHandle1, aAlfa;
     |FINSI;
|FPRC;

|PROCESO Proceso193_2004;
     |HAZ AbreImprime193;

     |SI #dsmoy000#8 = "C";
         |BUCLE dsmow014C193;
     |SINO;
         |BUCLE dsmow014N193;
     |FINSI;

     |SI #dsmoy000#6 [ 2005;
         |HAZ EmiteEsto193;
     |SINO;
         |XCIERRA nHandle1;

         |SI eaTipoV ! "S";
             eaFichError  = "rcc";
             eaFichDatos  = "rca";
             eaFichAuxil  = "rcb";
             enValidacion = 0;

             |HAZ BuscaErroresL;
         |SINO;
             |HAZ Internet2004;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Bloque2011;
     |SI nTecla ! 5;
         |SI #dsmoy000#6 [ 2003;  |HAZ Botones193_2003;  |FINSI;
         |SI #dsmoy000#6 ] 2004;  |HAZ Botones193_2004;  |FINSI;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1;  |ACABA;  |FINSI;
     |SI nTecla = 5;  enInfComp = 1;  |FINSI;

     |SI nTecla = 5;
         |HAZ PapelOficial193;
         |ACABA;
     |FINSI;

     |SI #dsmoy000#6 [ 2003;
         |HAZ Proceso193_2003;
     |SINO;
         |HAZ Proceso193_2004;
     |FINSI;
|FPRC;

|PROCESO Portal193_2012;
     #dsm193ca#0  = #dsmow014#0;
     #dsm193ca#1  = #dsmow014#1;
     #dsm193ca#2  = #dsmow014#2;
     #dsm193ca#3  = #dsmow014#5;
     #dsm193ca#4  = #dsmow014#7;
     #dsm193ca#5  = 0;
     |LEE 040#dsm193ca.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = #dsmow014#5;
     #dsmom004#4  = #dsmow014#7;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     eaFicheroPlano = "193" + (("00000" + #dsmow014#0) % -105) + ".txt";
     eaFicheroImpre = "193" + (("00000" + #dsmow014#0) % -105) + ".imp";
     eaFicheroSalid = "193" + (("00000" + #dsmow014#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #dsmow014#0) % -105) + ".txt";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ dsm193ca;
     |BUCLE dsm193li;
     |BUCLE dsm193ga;

     |XCIERRA nHandle2;


     enEmpresa    = #dsmow014#0;
     eaNomEmpresa = #dsmow014#3;

     |HAZ PresentaPortal;
|FPRC;

|DEFBUCLE dsmow014C193_2012;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, Portal193_2012;
|FIN;

|DEFBUCLE dsmow014N193_2012;
     #dsmow014#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, Portal193_2012;
|FIN;

|PROCESO Bloque2012;
     |HAZ BtnAnuales2012;

     |SI eaOpcion = "0";  enInfComp = 1;  |ACABA;  |FINSI;

     nTecla = 1;

     |ABRE #dsm193ca;
     |ABRE #dsmom004;
     |SI #dsmoy000#8 = "C";
         |BUCLE dsmow014C193_2012;
     |SINO;
         |BUCLE dsmow014N193_2012;
     |FINSI;
     |CIERRA #dsm193ca;
     |CIERRA #dsmom004;

     |SI eaOpcion = "3";
         |HAZ SacaErrorPtl;

         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Bloque2015;
     |HAZ BtnAnuales2015;

     |SI eaOpcion = "0";  enInfComp = 1;  |ACABA;  |FINSI;

     nTecla = 1;

     |ABRE #dsm193ca;
     |ABRE #dsmom004;
     |SI #dsmoy000#8 = "C";
         |BUCLE dsmow014C193_2012;
     |SINO;
         |BUCLE dsmow014N193_2012;
     |FINSI;
     |CIERRA #dsm193ca;
     |CIERRA #dsmom004;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Bloque;
     |SI #dsmoy000#6 [ 2011;  |HAZ Bloque2011;  |ACABA;  |FINSI;
     |SI #dsmoy000#6 [ 2014;  |HAZ Bloque2012;  |ACABA;  |FINSI;
     |SI #dsmoy000#6 = 2015;  |HAZ Bloque2015;  |ACABA;  |FINSI;
     |SI #dsmoy000#6 ] 2016;  |HAZ Bloque2016;  |ACABA;  |FINSI;
|FPRC;

|PROGRAMA;
     aFichero = ("000" + Usuario) % 108;
     |NOME_DAT #dsmoy000#aFichero#;

     aFichero = ("imp" + Usuario) % 108;
     |NOME_DAT #dsmow014#aFichero#;

     |ABRE #dsmoy000;
     |LEE 000#dsmoy000.p;
     |CIERRA #dsmoy000;

     |ABRE #dsmom107;
     |LEE 040#dsmom107.p;
     |SI FSalida ! 0;
         |CIERRA #dsmom107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #dsmom107;
     |FINSI;

     |LEE 040#dsmom107.p;
     |SI FSalida ! 0;  |DDEFECTO #dsmom107;  |FINSI;
     |CIERRA #dsmom107;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |SI eaParametro = "193C";
         enInfComp = 1;
         nTecla    = 5;
         |HAZ Bloque2011;
         |ACABA;
     |FINSI;

     |HAZ Bloque;
|FPRO;
