|FICHEROS;
     dsmociva #0;
     dsmom007 #7;
     dsmom117 #117;
     dsmom004 #4;
     dsmom008 #8;
     dsmom047 #47;
     dsmom048 #148;

     dsmom087 #87;
     dsmom095 #95;

     dsmom103 #103;
     dsmom109 #109;

     dsmoc349 #349;
     dsmod300 #300;
     dsmod303 #303;
     dsmod310 #310;
     dsmod320 #320;
     dsmod330 #330;
     dsmod332 #332;
     dsmod349 #350;
     dsmow002 #99;
     dsmow119 #119;

     dsmocivp #165;

     :/contagen/def/canempre #400;
     :/contagen/def/camaniva #401;
     :/contagen/def/camacc01 #501;
     :/contagen/def/camacc02 #502;
     :/basica/def/agicen14 #402;

     dsmociva@ #999;
|FIN;

|VARIABLES;
     nPer1   = 0;
     nPer2   = 0;
     swerror = 0;
     fDFecha = @;
     fHFecha = @;
     nCampo68      = 0;
     nCampo        = 0;
     nCampo1       = 0;
     nCampo2       = 0;
     nCampo3       = 0;
     nCampo11      = 0;
     nCampo22      = 0;
     nCampo33      = 0;
     nValor1       = 0;
     nValor2       = 0;
     nGrupo        = 0;
     nSubGrupo     = 0;
     nPeriodoMin   = 0;
     nEjerAnt      = 0;
     nSwAcum       = 0;
     nDesde        = 0;
     nHasta        = 0;
     nContador     = 0;
     nResult       = 0;
     nSwGraba      = 0;
     nSwMira       = 0;
     nSwModi       = 0;
     aPeriodo303   = "";
     aPeriodo349   = "";
     nMes1         = 0;
     nMes2         = 0;
     nMes3         = 0;
     nDComM1       = 0;
     nHComM1       = 0;
     nDComM2       = 0;
     nHComM2       = 0;
     nDComM3       = 0;
     nHComM3       = 0;

     nAnyo         = 0;
     nPer          = 0;
     nTipo         = 0;
     nPeriodo      = 0;
     nDepar        = 0;
     nEjer         = 0;
     nModBucle     = 0;
     nPorCalculado = 0;
     nPon          = 0;
     nEl62         = 0;
     nHComple      = 0;
     nModAnter     = 0;
     nTotal303     = 0;
     nDPer349      = 0;
     nHPer349      = 0;
     nNegativo     = 0;
     nNegativoC    = 0;
     nNegativoD    = 0;
     nIVA          = 0;
     nCuotasAnterior = 0;
     nIVA7           = 0;
     nIVA10          = 0;
     nIVA13          = 0;
     nIVA16          = 0;
     nIVA19          = 0;
     nIVA22          = 0;
     nIVA25          = 0;
     nIVA28          = 0;
     nIVA31          = 0;
     nSubeIVA        = 0;
     nError          = 0;

     aClave          = "";
     aAlfa           = "";
     aAlfa1          = "";
     aTecla          = "";
     aBase           = "";
     aMas            = "";
     aDesConexion349 = "";

     &EURODB     = 0;
     &enPregunta = 0;

    nSwOpe29     = 0;
    aPerNom      = "";
    nCuotaMas    = 0;
    nBaseMas     = 0;
    nDPer        = 0;
    nHPer        = 0;

    nNume1 = 0;
    nNume2 = 0;
    swpase = 0;
    nPro   = 0;
    nAlgun = 0;
    nInkey = 0;
    nEntro = 0;

    &enEmpAmor  = 0;
    &enEjeAmor  = 0;
    &enDActAmor = 0;
    &enHActAmor = 0;
    &enImpRegul = 0;
    &enModoAmor = 0;

    aModo       = "";
    &enProAct   = 0;
    &enProCom   = 0;
    nComun      = 0;
    nSwHay      = 0;
    nEjerCarga  = 0;
    &eMensa     = 0;
    nSuma       = 0;
    nDImporte   = 0;
    nHImporte   = 0;
    nSwCaja     = 0;
    nNoCal      = 0;

    &eDevenCaja  = 0;
    &ePathCaja   = "";
    &ePerioCaja  = 0;
    nEjerCobro   = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO LeeCasilla;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = nGrupo;
     #0#7  = nSubGrupo;
     |LEE 040#0=;
     |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
|FPRC;

|| __________________________________________________________________________


|| ///////////////// Procesos del Entlineal \\\\\\\\\\\\\\\\\\\\

|PROCESO Total1_9;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 1;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 2;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 3;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 4;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 5;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 6;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 7;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 8;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 14;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     |SI #0#1 ] 2014;
         nGrupo    = 1;  nSubGrupo = 15;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;

         nGrupo    = 1;  nSubGrupo = 16;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;

         nGrupo    = 1;  nSubGrupo = 17;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;
     |FINSI;

     |SI #0#1 ] 2015;
         nGrupo    = 1;  nSubGrupo = 18;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;

         nGrupo    = 1;  nSubGrupo = 19;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;
     |FINSI;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 1;
     #0#7  = 9;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         #0#13 = nValor2;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total1_13;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 10;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 11;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 1;  nSubGrupo = 12;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     |SI #0#1 ] 2015;
         nGrupo    = 1;  nSubGrupo = 20;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;
     |FINSI;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 1;
     #0#7  = 13;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         #0#13 = nValor2;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_1;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     |SI enEjer ] 2011;
         nGrupo    = 1;  nSubGrupo = 14;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
     |FINSI;

     |SI enEjer ] 2015;
         nGrupo    = 1;  nSubGrupo = 18;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
     |FINSI;

/*
     |SI enEjer ] 2014;
         |ABRE #402;
         |DDEFECTO #402;
         #402#0 = enEmpresa;
         #402#1 = enActividad;
         |LEE 040#402=;
         |CIERRA #402;
         |SI #402#7 = 14;  |O #402#7 = 15;
             |ACABA;
         |FINSI;
     |FINSI;
*/

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 1;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_4;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 4;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_5;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 5;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_6;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 6;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_7;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 7;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total2_10;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 2;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 5;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 6;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 7;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 8;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     nGrupo    = 2;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;
     nValor2   = nValor2 + #0#13;

     |SI enEjer [ 2007;
         #0#0  = enEmpresa;
         #0#1  = enEjer;
         #0#2  = enPeriodo;
         #0#3  = enModelo;
         #0#4  = enComplem;
         #0#5  = enActividad;
         #0#6  = 2;
         #0#7  = 10;
         |LEE 101#0=;
         |SI FSalida = 0;
             #0#12 = nValor1;
             #0#13 = nValor2;
             |GRABA 020#0a;
             |LIBERA #0;
         |FINSI;
         |ACABA;
     |FINSI;

     |SI enEjer ] 2008;
         nGrupo    = 2;  nSubGrupo = 10;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;
     |FINSI;

     |SI enEjer [ 2010;
         nGrupo    = 2;  nSubGrupo = 11;   |HAZ LeeCasilla;
         nValor1   = nValor1 - #0#12;
         nValor2   = nValor2 - #0#13;
     |FINSI;

     |SI enEjer ] 2011;
         nGrupo    = 2;  nSubGrupo = 13;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;

         nGrupo    = 2;  nSubGrupo = 14;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;

         nGrupo    = 2;  nSubGrupo = 15;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;
     |FINSI;

     |SI enEjer ] 2014;
         nGrupo    = 2;  nSubGrupo = 16;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;
     |FINSI;

     |SI enEjer ] 2015;
         nGrupo    = 2;  nSubGrupo = 17;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
         nValor2   = nValor2 + #0#13;
     |FINSI;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 2;
     #0#7  = 12;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         #0#13 = nValor2;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Total3_15;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 3;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 5;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 6;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 7;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 8;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     |SI enEjer ] 2014;
         nGrupo    = 3;  nSubGrupo = 16;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;

         nGrupo    = 3;  nSubGrupo = 17;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #0#12;
     |FINSI;

     nGrupo    = 3;  nSubGrupo = 10;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 11;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 12;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #0#12;

     nGrupo    = 3;  nSubGrupo = 13;   |HAZ LeeCasilla;
     nValor1   = nValor1 - #0#12;

     nGrupo    = 3;  nSubGrupo = 14;   |HAZ LeeCasilla;
     nValor1   = nValor1 - #0#12;

     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 3;
     #0#7  = 15;
     |LEE 101#0=;
     |SI FSalida = 0;
         #0#12 = nValor1;
         |GRABA 020#0a;
         |LIBERA #0;
    |FINSI;
|FPRC;

|PROCESO Totales;
     |SI enEjer > 2010;  |SELECT #1#0;  |FINSI;

     |HAZ Total1_9;   || Total Bases y Cuotas I.V.A.
     |HAZ Total1_13;  || Total Bases y Cuotas I.V.A. y Recargo

     |SI enModelo = 300;  |O enModelo = 330;  |O enModelo = 370;
         |HAZ Total3_1;   || Operaciones en Regimen General
     |FINSI;

     |SI enModelo = 320;  |O enModelo = 332;
         |HAZ Total3_4;   || Operaciones en Regimen Ordinario
         |HAZ Total3_5;   || Operaciones en Regimen especial bienes usados etc.
         |HAZ Total3_6;   || Operaciones en Regimen especial Agencias Viajes
         |HAZ Total3_7;   || Operaciones en Determinacion Proporcional
     |FINSI;

     |SI enModelo = 303;
         |HAZ Total3_1;   || Operaciones en Regimen General
         |HAZ Total3_5;   || Operaciones en Regimen especial bienes usados etc.
         |HAZ Total3_6;   || Operaciones en Regimen especial Agencias Viajes
     |FINSI;

     |HAZ Total2_10;  || Suma de Deducciones
     |HAZ Total3_15;  || Total Volumen de Operaciones

     |SI enEjer > 2010;  |SELECT #2#0;  |FINSI;

     |SI enTipoEntrada ! 95;
         |HAZ Refresco;
     |FINSI;
|FPRC;

|PROCESO Tipo7;  |TIPO 7;
     |PINTA #0#12;
     |PINTA #0#13;

     |SI #0#6 = 2; |Y #0#7 = 9; |Y enPeriodo = 12;
         |MENSA "    Importe: F2-Manual, F3-Calcular y Recoger, F4-Consultar y Modificar";
         |ACABA;
     |FINSI;

     |SI #0#6 = 1; |Y #0#7 = 6;  |Y #0#1 [ 2013;
         |MENSA "0000<F2> Introd. Bases y Cuotas, <F3> Introd. Bases y Cuotas intracomunit.";
         |ACABA;
     |FINSI;

     |SI #0#6 = 1; |Y #0#7 = 19;  |Y #0#1 ] 2015;
         |SI aDesConexion349 = "N";
             |MENSA "0000Introd. Ret. Adq.intracomunitarias <F2> de bienes, <F3> de servicios";
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #0#6 = 3; |Y #0#7 = 4; |Y #0#1 ] 2012; |Y #0#1 [ 2013;
         |MENSA "0000<F2> Introducir Importe, <F3> Introducir Importe Intracomunitario.";
         |ACABA;
     |FINSI;

     |SI #0#6 = 3; |Y #0#7 = 9; |Y #0#1 ] 2014;
         |SI #0#1 ] 2018;
             |MENSA "0000Introducir Importe: <F2> Clave E, <F3> Claves H/M/T; <F4> Consulta";
         |SINO;
             |MENSA "0000<F2> Introducir Intracomunitarias Importe bienes";
         |FINSI;
         |ACABA;
     |FINSI;

     |SI #0#6 = 3; |Y #0#7 = 16; |Y #0#1 ] 2014;
         |MENSA "0000<F2> Introducir Intracomunitarias Importe servicios";
         |ACABA;
     |FINSI;

     |SI eaCaptura = "REGISTROS "; |Y enActividad ! 99;
         |SI #0#11 = 2;
             |MENSA "     ";
         |FINSI;
         |SI #0#11 = 0;
             |MENSA "     Pulse <F2> para Introduccion de Bases y Cuotas";
         |FINSI;
         |SI #0#11 = 1;
             |MENSA "     Pulse <F2> para Introduccion del Importe";
         |FINSI;
    |SINO;
         |SI #0#6 = 1; |O #0#6 = 3; |Y enEjer [ 2010;
             |SI #0#11 = 2;
                 |MENSA "    Pulse <F5> para Introducir Datos Subvenciones";
             |FINSI;
             |SI #0#11 = 0;
                 |MENSA "     <F2> Introd. de Bases y Cuotas, <F5> Introd. de Subvenciones";
             |FINSI;
             |SI #0#11 = 1;
                 |MENSA "     <F2> para Introd. del Importe, <F5> Introd. de Subvenciones";
             |FINSI;
         |SINO;
             |SI #0#11 = 2;
                 |MENSA "     ";
             |FINSI;
             |SI #0#11 = 0;
                 |MENSA "     Pulse <F2> para Introduccion de Bases y Cuotas";
             |FINSI;
             |SI #0#11 = 1;
                 |MENSA "     Pulse <F2> para Introduccion del Importe";
             |FINSI;
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO dsmod349;
     |ABRE #4;
     #4#0 = #350#0;
     #4#1 = #350#1;
     #4#2 = #350#2;
     #4#3 = #350#3;
     #4#4 = #350#4;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;
     aPeriodo349 = #4#22;

 |SI #350#4 ! 0;
     nSwMira = 0;
     |SI aPeriodo349 = aPeriodo303;
         nSwMira = 1;
     |SINO;
         |SI aPeriodo349 = "T"; |Y aPeriodo303 ! "T";
             nSwMira = 1;
         |FINSI;
     |FINSI;

     |SI nSwMira = 1;
         |SI #350#12 = "C";
             enHComple = #350#4;
         |SINO;
             enDComple = #350#4;
             enHComple = #350#4;
         |FINSI;

     |SINO;

  || ... El 349 es Mensual, pero el 303 es Trimestral
  || ... puede haber complementarias en los meses del 349

         |SI nMes1 = #350#2; nHComM1 = #350#4; |FINSI;
         |SI nMes2 = #350#2; nHComM2 = #350#4; |FINSI;
         |SI nMes3 = #350#2; nHComM3 = #350#4; |FINSI;
         |SI enHComple < #350#4;
             enHComple = #350#4;
         |FINSI;
     || SI es Sustitutiva no puedo mostrar el Linea
          |SI #350#12 ! "C";
              nSwModi = 1;
              |SI nMes1 = #350#2; nDComM1 = #350#4; |FINSI;
              |SI nMes2 = #350#2; nDComM2 = #350#4; |FINSI;
              |SI nMes3 = #350#2; nDComM3 = #350#4; |FINSI;
          |FINSI;
     |FINSI;
 |SINO;
     |SI aPeriodo349 = aPeriodo303; |Y #350#2 = #0#2;
         enDComple = #0#4;
         enHComple = #0#4;
     |FINSI;
 |FINSI;
|FPRC;

|DEFBUCLE dsmod349;
    #350#1;
    ;
    #0#0, #0#1, nDPer349, 349, 00, 00;
    #0#0, #0#1, nHPer349, 349, 99, 00;
    ;
    NULL, dsmod349;
|FIN;

|PROCESO dsmod349_MT;
     |ABRE #4;
     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = enPeriodo;
     #4#3 = enModelo;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;
     aPeriodo303 = #4#22;

     nDComM1 = 0; nHComM1 = 0;
     nDComM2 = 0; nHComM2 = 0;
     nDComM3 = 0; nHComM3 = 0;

     nMes1 = 1; nMes2 = 2; nMes3 = 3;
     |SI enPeriodo [ 3;
         nDPer349 = 1;   nHPer349 = 3;
     |FINSI;
     |SI enPeriodo > 3; |Y enPeriodo [ 6;
         nDPer349 = 4;   nHPer349 = 6;
         nMes1 = 4; nMes2 = 5; nMes3 = 6;
     |FINSI;
     |SI enPeriodo > 6; |Y enPeriodo [ 9;
         nDPer349 = 7;   nHPer349 = 9;
         nMes1 = 7; nMes2 = 8; nMes3 = 9;
     |FINSI;
     |SI enPeriodo > 9;
         nDPer349 = 10;  nHPer349 = 12;
         nMes1 = 10; nMes2 = 11; nMes3 = 12;
     |FINSI;

     nSwModi = 0;
     |BUCLE dsmod349;
     |SI nSwModi = 1;
         |MENAV "0000Detectados Modelos 349 Sustitutivos, con periodicidad diferente al Modelo 303";
         |MENAV "0000La modificacion de los Importes debe hacerse por el Mantenimiento del Modelo 349";
     |FINSI;

|FPRC;

|PROCESO PonIvasF2;
     nSwAcum = 0;
     |PARA nCampo2 = 15;  |SI nCampo2 [ 33;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #0nCampo2 = #349nCampo22;
               |SI nCuotasAnterior = 0;
                   #0nCampo1 = #0nCampo1 + #349nCampo11;
                   #0nCampo3 = #0nCampo3 + #349nCampo33;
               |SINO;
                   |SI #349#24 = "-";
                       #0nCampo1 = #0nCampo1 - #349nCampo11;
                       #0nCampo3 = #0nCampo3 - #349nCampo33;
                   |SINO;
                       #0nCampo1 = #0nCampo1 + #349nCampo11;
                       #0nCampo3 = #0nCampo3 + #349nCampo33;
                   |FINSI;
               |FINSI;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 1;  |ACABA;  |FINSI;

     |PARA nCampo2 = 15;  |SI nCampo2 [ 33;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #0nCampo2 = 0;
               |SI nCuotasAnterior = 0;
                   #0nCampo1 = #0nCampo1 + #349nCampo11;
                   #0nCampo2 = #349nCampo22;
                   #0nCampo3 = #0nCampo3 + #349nCampo33;
               |SINO;
                   |SI #349#24 = "-";
                       #0nCampo1 = #0nCampo1 - #349nCampo11;
                       #0nCampo3 = #0nCampo3 - #349nCampo33;
                   |SINO;
                       #0nCampo1 = #0nCampo1 + #349nCampo11;
                       #0nCampo3 = #0nCampo3 + #349nCampo33;
                   |FINSI;
               |FINSI;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 1;  |ACABA;  |FINSI;

     #0#33 = -1;
     |SI nCuotasAnterior = 0;
         #0#32 = #0#32 + #349nCampo11;
         #0#34 = #0#34 + #349nCampo33;
     |SINO;
         |SI #349#24 = "-";
             #0#32 = #0#32 - #349nCampo11;
             #0#34 = #0#34 - #349nCampo33;
         |SINO;
             #0#32 = #0#32 + #349nCampo11;
             #0#34 = #0#34 + #349nCampo33;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PonIvasF3;
     nSwAcum = 0;
     |PARA nCampo2 = 36;  |SI nCampo2 [ 54;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #0nCampo2 = #349nCampo22;
               |SI nCuotasAnterior = 0;
                   #0nCampo1 = #0nCampo1 + #349nCampo11;
                   #0nCampo3 = #0nCampo3 + #349nCampo33;
               |SINO;
                   |SI #349#24 = "-";
                       #0nCampo1 = #0nCampo1 - #349nCampo11;
                       #0nCampo3 = #0nCampo3 - #349nCampo33;
                   |SINO;
                       #0nCampo1 = #0nCampo1 + #349nCampo11;
                       #0nCampo3 = #0nCampo3 + #349nCampo33;
                   |FINSI;
               |FINSI;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 1;  |ACABA;  |FINSI;

     |PARA nCampo2 = 36;  |SI nCampo2 [ 54;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
           |SI #0nCampo2 = 0;
               |SI nCuotasAnterior = 0;
                   #0nCampo1 = #0nCampo1 + #349nCampo11;
                   #0nCampo2 = #349nCampo22;
                   #0nCampo3 = #0nCampo3 + #349nCampo33;
               |SINO;
                   |SI #349#24 = "-";
                       #0nCampo1 = #0nCampo1 - #349nCampo11;
                       #0nCampo3 = #0nCampo3 - #349nCampo33;
                   |SINO;
                       #0nCampo1 = #0nCampo1 + #349nCampo11;
                       #0nCampo3 = #0nCampo3 + #349nCampo33;
                   |FINSI;
               |FINSI;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 1;  |ACABA;  |FINSI;

     #0#54 = -1;
     |SI nCuotasAnterior = 0;
         #0#53 = #0#32 + #349nCampo11;
         #0#55 = #0#34 + #349nCampo33;
     |SINO;
         |SI #349#24 = "-";
             #0#53 = #0#53 - #349nCampo11;
             #0#55 = #0#55 - #349nCampo33;
         |SINO;
             #0#53 = #0#53 + #349nCampo11;
             #0#55 = #0#55 + #349nCampo33;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Calcu349;
    |SI nSwModi = 1;
        |SI nMes1 = #349#2;
            |SI #349#4 < nDComM1; |O #349#4 > nHComM1; |ACABA; |FINSI;
        |FINSI;
        |SI nMes2 = #349#2;
            |SI #349#4 < nDComM2; |O #349#4 > nHComM2; |ACABA; |FINSI;
        |FINSI;
        |SI nMes3 = #349#2;
            |SI #349#4 < nDComM3; |O #349#4 > nHComM3; |ACABA; |FINSI;
        |FINSI;
    |FINSI;

    |SI aClave ! "";
        aAlfa = #349#6 % 101;
        |SI aAlfa ! "E"; |Y aAlfa ! "M";
           |Y aAlfa ! "H"; |Y aAlfa ! "T";
             |ACABA;
        |FINSI;
    |FINSI;

    |SI #0#1 ] 2015;
        |SI  eaTipo349 = "A";
             |SI #349#6 = "AR"; |ACABA; |FINSI;
        |FINSI;
        |SI  eaTipo349 = "I";
             |SI #349#6 = "IR"; |ACABA; |FINSI;
        |FINSI;
        |SI  eaTipo349 = "R";
             |SI #349#6 ! "IR"; |Y #349#6 ! "AR"; |ACABA; |FINSI;
        |FINSI;
    |FINSI;

    |SI #349#6 = "A ";  |O #349#6 = "AR";
         nCuotasAnterior = 0;

         |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo11 ! 0;  |O #349nCampo33 ! 0; |O #349nCampo22 ! 0;
                   |HAZ PonIvasF2;
               |FINSI;
         |SIGUE;

         |PARA nCampo22 = 29;  |SI nCampo22 [ 35;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo11 ! 0;  |O #349nCampo33 ! 0; |O #349nCampo22 ! 0;
                   |HAZ PonIvasF2;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI #349#6 = "AR";
         nCuotasAnterior = 1;
         nPon            = 0;
         |PARA nCampo22 = 38;  |SI nCampo22 [ 56;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo11 ! 0;  |O #349nCampo33 ! 0; |O #349nCampo22 ! 0;
                   |HAZ PonIvasF2;
                   nPon = 1;
               |FINSI;
         |SIGUE;

         |SI nPon = 0;  |Y #349#27 ! 0;
             nCampo22 = 38;
             nCampo11 = nCampo22 - 1;
             nCampo33 = nCampo22 + 1;
             |HAZ PonIvasF2;
         |FINSI;
     |FINSI;

     |SI #349#6 = "I ";  |O #349#6 = "IR";
         nCuotasAnterior = 0;
         |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo11 ! 0;  |O #349nCampo33 ! 0; |O #349nCampo22 ! 0;
                   |SI enEjer < 2014;
                       |HAZ PonIvasF3;
                   |SINO;
                       |HAZ PonIvasF2;
                   |FINSI;
               |FINSI;
         |SIGUE;

         |PARA nCampo22 = 29;  |SI nCampo22 [ 35;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo11 ! 0;  |O #349nCampo33 ! 0; |O #349nCampo22 ! 0;
                   |SI enEjer < 2014;
                       |HAZ PonIvasF3;
                   |SINO;
                       |HAZ PonIvasF2;
                   |FINSI;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI #349#6 = "IR";
         nPon            = 0;
         nCuotasAnterior = 1;
         |PARA nCampo22 = 38;  |SI nCampo22 [ 56;  |HACIENDO nCampo22 = nCampo22 + 3;
               nCampo11 = nCampo22 - 1;
               nCampo33 = nCampo22 + 1;
               |SI #349nCampo11 ! 0;  |O #349nCampo33 ! 0; |O #349nCampo22 ! 0;
                   |SI enEjer < 2014;
                       |HAZ PonIvasF3;
                   |SINO;
                       |HAZ PonIvasF2;
                   |FINSI;
                   nPon = 1;
               |FINSI;
         |SIGUE;

         |SI nPon = 0;  |Y #349#27 ! 0;
             nCampo22 = 38;
             nCampo11 = nCampo22 - 1;
             nCampo33 = nCampo22 + 1;
             |SI enEjer < 2014;
                 |HAZ PonIvasF3;
             |SINO;
                 |HAZ PonIvasF2;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #349#6 = "E ";  |O #349#6 = "S ";
       |O #349#6 = "M ";  |O #349#6 = "H ";
       |O #349#6 = "T ";

         nCampo = 12;
         |SI #349#6 = "S "; |Y #0#1 ] 2012; |Y #0#1 [ 2013; nCampo = 35; |FINSI;

         #0nCampo = #0nCampo + #349#22;
     |FINSI;

     |SI #349#6 = "ER";  |O #349#6 = "SR";
        |O #349#6 = "MR";  |O #349#6 = "HR";
        |O #349#6 = "TR";
         nCampo = 12;
         |SI #349#6 = "SR"; |Y #0#1 ] 2012; |Y #0#1 [ 2013; nCampo = 35; |FINSI;
         #0nCampo = #0nCampo + #349#22;
         |SI #349#24 = "-";
             #0nCampo = #0nCampo - #349#27;
         |SINO;
             #0nCampo = #0nCampo + #349#27;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc349A;
     #349#1;
     ;
     #0#0, #0#1, nDPer349, 349, enDComple, #0#5, "A ", 0000, 00, "            ";
     #0#0, #0#1, nHPer349, 349, enHComple, #0#5, "Az", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Calcu349;
|FIN;

|PROCESO ClaveA_349;
     |ABRE #8;
     #8#0 = #0#0;
     #8#1 = #0#1;
     #8#2 = #0#2;
     #8#3 = #0#3;
     #8#4 = #0#4;
     #8#5 = #0#5;
     |LEE 040#8=;
     |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
     |CIERRA #8;

     nSwModi = 0;
     |SI #0#4 = 0;
         enDComple = 0;
         enHComple = 0;
         |HAZ dsmod349_MT;
         || ... |BUCLE dsmod349;
     |SINO;
         enDComple = #0#4;
         enHComple = #0#4;
     |FINSI;

     nTipo         = enTipoEntrada;
     enEmpresa     = #0#0;
     enEjer        = #0#1;
     enPeriodo     = #0#2;
     enComplem     = #0#4;
     enActividad   = #0#5;
     eaTipo349     = "A";
     eaNombreAct   = #8#6;
     eaCaptura     = #8#7;
     eaComunidad   = #8#9;
     eaComunero    = #8#10;
     enTipoEntrada = 1;
     enModelo349   = #0#3;
     |SI nSwModi = 0; |SUB_EJECUTA_NP "dsmoc349"; |FINSI;
     enTipoEntrada = nTipo;

     |PDEFECTO #0, 12, 34;

     |ABRE #4;
     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = enPeriodo;
     #4#3 = enModelo;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;
     aPeriodo303 = #4#22;

     |SI #4#22 = "M";
         nDPer349 = enPeriodo;
         nHPer349 = enPeriodo;
     |FINSI;

     |SI #4#22 = "T";
         |SI enPeriodo = 3;    nDPer349 = 1;   nHPer349 = 3;   |FINSI;
         |SI enPeriodo = 6;    nDPer349 = 4;   nHPer349 = 6;   |FINSI;
         |SI enPeriodo = 9;    nDPer349 = 7;   nHPer349 = 9;   |FINSI;
         |SI enPeriodo = 12;   nDPer349 = 10;  nHPer349 = 12;  |FINSI;
     |FINSI;

     |BUCLE dsmoc349A;

     #0#12 = #0#14 + #0#17 + #0#20 + #0#23 + #0#26 + #0#29 + #0#32;
     #0#13 = #0#16 + #0#19 + #0#22 + #0#25 + #0#28 + #0#31 + #0#34;

     |SI #0#7 = 5;
         |CONFI "0000SLo Computamos al IVA DEDUCIBLE";
         |SI FSalida = 0;
             |DBASE aBase;  |QBF aBase;
             aMas = aBase + "def/dsmociva.mas";
             |CARGA_DEF aMas, dsmociva@;
             |SI FSalida = 0;
                 |ABRE #999;
                 #999#0 = #0#0;
                 #999#1 = #0#1;
                 #999#2 = #0#2;
                 #999#3 = #0#3;
                 #999#4 = #0#4;
                 #999#5 = #0#5;
                 #999#6 = 2;
                 #999#7 = 5;
                 |LEE 101#999=;
                 |SI FSalida = 0;
                     |PARA nCampo1 = 12;  |SI nCampo1 [ 34;  |HACIENDO nCampo1 = nCampo1 + 1;
                           #999nCampo1 = #0nCampo1;
                     |SIGUE;
                     |GRABA 020#999a;
                     |LIBERA #999;
                     |SI #0#1 ] 2011; |HAZ Tratadsmom087_Adq; |FINSI;
                 |FINSI;
                 |CIERRA #999;
                 |DESCARGA_DEF #dsmociva@;
             |FINSI;
         |FINSI;
     |FINSI;

     enEmpresa     = #0#0;
     enEjer        = #0#1;
     enPeriodo     = #0#2;
     enComplem     = #0#4;
     enActividad   = #0#5;
     eaTipo349     = "";
|FPRC;

|DEFBUCLE dsmoc349R;
     #349#1;
     ;
     #0#0, #0#1, nDPer349, 349, enDComple, #0#5, "AR", 0000, 00, "            ";
     #0#0, #0#1, nHPer349, 349, enHComple, #0#5, "IR", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Calcu349;
|FIN;

|PROCESO ClaveR_349;

     |ABRE #8;
     #8#0 = #0#0;
     #8#1 = #0#1;
     #8#2 = #0#2;
     #8#3 = #0#3;
     #8#4 = #0#4;
     #8#5 = #0#5;
     |LEE 040#8=;
     |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
     |CIERRA #8;

     nSwModi = 0;
     |SI #0#4 = 0;
         enDComple = 0;
         enHComple = 0;
         |HAZ dsmod349_MT;
         || ... |BUCLE dsmod349;
     |SINO;
         enDComple = #0#4;
         enHComple = #0#4;
     |FINSI;

     nTipo         = enTipoEntrada;
     enEmpresa     = #0#0;
     enEjer        = #0#1;
     enPeriodo     = #0#2;
     enComplem     = #0#4;
     enActividad   = #0#5;
     eaNombreAct   = #8#6;
     eaCaptura     = #8#7;
     eaComunidad   = #8#9;
     eaComunero    = #8#10;
     enTipoEntrada = 1;
     enModelo349   = #0#3;
     |SI nInkey = 10;
         eaTipo349 = "AR";
     |SINO;
         eaTipo349 = "IR";
     |FINSI;
     |SI nSwModi = 0; |SUB_EJECUTA_NP "dsmoc349"; |FINSI;
     enTipoEntrada = nTipo;
     eaTipo349     = "R";

     |PDEFECTO #0, 12, 34;

     |ABRE #4;
     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = enPeriodo;
     #4#3 = enModelo;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;
     aPeriodo303 = #4#22;

     |SI #4#22 = "M";
         nDPer349 = enPeriodo;
         nHPer349 = enPeriodo;
     |FINSI;

     |SI #4#22 = "T";
         |SI enPeriodo = 3;    nDPer349 = 1;   nHPer349 = 3;   |FINSI;
         |SI enPeriodo = 6;    nDPer349 = 4;   nHPer349 = 6;   |FINSI;
         |SI enPeriodo = 9;    nDPer349 = 7;   nHPer349 = 9;   |FINSI;
         |SI enPeriodo = 12;   nDPer349 = 10;  nHPer349 = 12;  |FINSI;
     |FINSI;

     |BUCLE dsmoc349R;

     #0#12 = #0#14 + #0#17 + #0#20 + #0#23 + #0#26 + #0#29 + #0#32;
     #0#13 = #0#16 + #0#19 + #0#22 + #0#25 + #0#28 + #0#31 + #0#34;

     |SI #0#7 = 19;
         |CONFI "0000SLo Computamos al IVA DEDUCIBLE";
         |SI FSalida = 0;
             |DBASE aBase;  |QBF aBase;
             aMas = aBase + "def/dsmociva.mas";
             |CARGA_DEF aMas, dsmociva@;
             |SI FSalida = 0;
                 |ABRE #999;
                 #999#0 = #0#0;
                 #999#1 = #0#1;
                 #999#2 = #0#2;
                 #999#3 = #0#3;
                 #999#4 = #0#4;
                 #999#5 = #0#5;
                 #999#6 = 2;
                 #999#7 = 17;
                 |LEE 101#999=;
                 |SI FSalida = 0;
                     |PARA nCampo1 = 12;  |SI nCampo1 [ 34;  |HACIENDO nCampo1 = nCampo1 + 1;
                           #999nCampo1 = #0nCampo1;
                     |SIGUE;
                     |GRABA 020#999a;
                     |LIBERA #999;
                     |SI #0#1 ] 2011; |HAZ Tratadsmom087_Adq; |FINSI;
                 |FINSI;
                 |CIERRA #999;
                 |DESCARGA_DEF #dsmociva@;
             |FINSI;
         |FINSI;
     |FINSI;

     enEmpresa     = #0#0;
     enEjer        = #0#1;
     enPeriodo     = #0#2;
     enComplem     = #0#4;
     enActividad   = #0#5;
     eaTipo349     = "";
|FPRC;

|DEFBUCLE dsmoc349I;
     #349#1;
     ;
     #0#0, #0#1, nDPer349, 349, enDComple, #0#5, "I ", 0000, 00, "            ";
     #0#0, #0#1, nHPer349, 349, enHComple, #0#5, "Iz", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Calcu349;
|FIN;

|PROCESO ClaveI_349;
     |ABRE #8;
     #8#0 = #0#0;
     #8#1 = #0#1;
     #8#2 = #0#2;
     #8#3 = #0#3;
     #8#4 = #0#4;
     #8#5 = #0#5;
     |LEE 040#8=;
     |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
     |CIERRA #8;

     nSwModi = 0;
     |SI #0#4 = 0;
         enDComple = 0;
         enHComple = 0;
         |HAZ dsmod349_MT;
         || ... |BUCLE dsmod349;
     |SINO;
         enDComple = #0#4;
         enHComple = #0#4;
     |FINSI;

     nTipo         = enTipoEntrada;
     enEmpresa     = #0#0;
     enEjer        = #0#1;
     enPeriodo     = #0#2;
     enComplem     = #0#4;
     enActividad   = #0#5;
     eaTipo349     = "I";
     eaNombreAct   = #8#6;
     eaCaptura     = #8#7;
     eaComunidad   = #8#9;
     eaComunero    = #8#10;
     enTipoEntrada = 1;
     enModelo349   = #0#3;
     |SI nSwModi = 0; |SUB_EJECUTA_NP "dsmoc349"; |FINSI;
     enTipoEntrada = nTipo;

     #0#12 = 0;
     #0#13 = 0;
     |SI #0#1 < 2014;
         |PDEFECTO #0, 35, 56;
     |SINO;
         |PDEFECTO #0, 14, 56;
     |FINSI;

     |ABRE #4;
     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = enPeriodo;
     #4#3 = enModelo;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;
     aPeriodo303 = #4#22;

     |SI #4#22 = "M";
         nDPer349 = enPeriodo;
         nHPer349 = enPeriodo;
     |FINSI;

     |SI #4#22 = "T";
         |SI enPeriodo = 3;    nDPer349 = 1;   nHPer349 = 3;   |FINSI;
         |SI enPeriodo = 6;    nDPer349 = 4;   nHPer349 = 6;   |FINSI;
         |SI enPeriodo = 9;    nDPer349 = 7;   nHPer349 = 9;   |FINSI;
         |SI enPeriodo = 12;   nDPer349 = 10;  nHPer349 = 12;  |FINSI;
     |FINSI;

     |BUCLE dsmoc349I;

     #0#12 = #0#14 + #0#17 + #0#20 + #0#23 + #0#26 + #0#29 + #0#32;
     #0#12 = #0#12 + #0#35 + #0#38 + #0#41 + #0#44 + #0#47 + #0#50 + #0#53;
     #0#13 = #0#16 + #0#19 + #0#22 + #0#25 + #0#28 + #0#31 + #0#34;
     #0#13 = #0#13 + #0#37 + #0#40 + #0#43 + #0#46 + #0#49 + #0#52 + #0#55;

     |SI #0#7 = 6; |Y #0#1 ] 2011;  |Y #0#1 [ 2013;
         |CONFI "0000SLo Computamos al IVA DEDUCIBLE";
         |SI FSalida = 0;
             |DBASE aBase;  |QBF aBase;
             aMas = aBase + "def/dsmociva.mas";
             |CARGA_DEF aMas, dsmociva@;
             |SI FSalida = 0;
                 |ABRE #999;
                 #999#0 = #0#0;
                 #999#1 = #0#1;
                 #999#2 = #0#2;
                 #999#3 = #0#3;
                 #999#4 = #0#4;
                 #999#5 = #0#5;
                 #999#6 = 2;
                 #999#7 = 13;
                 |LEE 101#999=;
                 |SI FSalida = 0;
                     |PARA nCampo1 = 14;  |SI nCampo1 [ 34;  |HACIENDO nCampo1 = nCampo1 + 1;
                           nCampo2 = nCampo1 + 21;
                           #999nCampo1 = #0nCampo2;
                     |SIGUE;
                     #999#12 = #999#14 + #999#17 + #999#20 + #999#23 + #999#26 + #999#29 + #999#32;
                     #999#13 = #999#16 + #999#19 + #999#22 + #999#25 + #999#28 + #999#31 + #999#34;
                     |GRABA 020#999a;
                     |LIBERA #999;
                     |HAZ Tratadsmom087_Adq;
                 |FINSI;
                 |CIERRA #999;
                 |DESCARGA_DEF #dsmociva@;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #0#7 = 15; |Y #0#1 ] 2014;
         |CONFI "0000SLo Computamos al IVA DEDUCIBLE";
         |SI FSalida = 0;
             |DBASE aBase;  |QBF aBase;
             aMas = aBase + "def/dsmociva.mas";
             |CARGA_DEF aMas, dsmociva@;
             |SI FSalida = 0;
                 |ABRE #999;
                 #999#0 = #0#0;
                 #999#1 = #0#1;
                 #999#2 = #0#2;
                 #999#3 = #0#3;
                 #999#4 = #0#4;
                 #999#5 = #0#5;
                 #999#6 = 2;
                 #999#7 = 13;
                 |LEE 101#999=;
                 |SI FSalida = 0;
                     |PARA nCampo1 = 14;  |SI nCampo1 [ 34;  |HACIENDO nCampo1 = nCampo1 + 1;
                           nCampo2 = nCampo1 + 21;
                           #999nCampo1 = #0nCampo1;
                     |SIGUE;
                     #999#12 = #999#14 + #999#17 + #999#20 + #999#23 + #999#26 + #999#29 + #999#32;
                     #999#13 = #999#16 + #999#19 + #999#22 + #999#25 + #999#28 + #999#31 + #999#34;
                     |GRABA 020#999a;
                     |LIBERA #999;
                     |HAZ Tratadsmom087_Adq;
                 |FINSI;
                 |CIERRA #999;
                 |DESCARGA_DEF #dsmociva@;
             |FINSI;
         |FINSI;
     |FINSI;

     enEmpresa     = #0#0;
     enEjer        = #0#1;
     enPeriodo     = #0#2;
     enComplem     = #0#4;
     enActividad   = #0#5;
     eaTipo349     = "";
|FPRC;

|DEFBUCLE dsmoc349E;
     #349#1;
     ;
     #0#0, #0#1, nDPer349, 349, enDComple, #0#5, "E ", 0000, 00, "            ";
     #0#0, #0#1, nHPer349, 349, enHComple, #0#5, "Tz", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Calcu349;
|FIN;

|PROCESO PreguntaMHT;
     aClave = "T";
     |PUSHV  1428 1658;
     |BLANCO 1428 1658;
     |CUADRO 1428 1658;
     |ATRI S;
     |PINTA 1529, " CLAVE A INTRODUCIR H/M/T:   ";
     |PINTA 1556, aClave;
     E_sup  = 1;
     E_inf  = "MHTmht";
     aClave = 1556 ? 0; aClave = aClave > ""; |PINTA 1556, aClave;
     |POPV;
|FPRC;

|PROCESO ClaveE_349;
     aClave = "E";
     |SI nInkey = 11; |Y enEjer ] 2018;
         |HAZ PreguntaMHT;
     |FINSI;

     |ABRE #8;
     #8#0 = #0#0;
     #8#1 = #0#1;
     #8#2 = #0#2;
     #8#3 = #0#3;
     #8#4 = #0#4;
     #8#5 = #0#5;
     |LEE 040#8=;
     |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
     |CIERRA #8;

     nSwModi = 0;
     |SI #0#4 = 0;
         enDComple = 0;
         enHComple = 0;
         |HAZ dsmod349_MT;
     |SINO;
         enDComple = #0#4;
         enHComple = #0#4;
     |FINSI;

     nTipo         = enTipoEntrada;
     eaTipo349     = aClave;
     eaNombreAct   = #8#6;
     eaCaptura     = #8#7;
     eaComunidad   = #8#9;
     eaComunero    = #8#10;
     enTipoEntrada = 1;
     |SI nInkey = 12; enTipoEntrada = 14; |FINSI;
     enModelo349   = #0#3;
     |SI nSwModi = 0; |SUB_EJECUTA_NP "dsmoc349"; |FINSI;
     enTipoEntrada = nTipo;

     |ABRE #4;
     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = enPeriodo;
     #4#3 = enModelo;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;
     aPeriodo303 = #4#22;

     |SI #4#22 = "M";
         nDPer349 = enPeriodo;
         nHPer349 = enPeriodo;
     |FINSI;

     |SI #4#22 = "T";
         |SI enPeriodo = 3;    nDPer349 = 1;   nHPer349 = 3;   |FINSI;
         |SI enPeriodo = 6;    nDPer349 = 4;   nHPer349 = 6;   |FINSI;
         |SI enPeriodo = 9;    nDPer349 = 7;   nHPer349 = 9;   |FINSI;
         |SI enPeriodo = 12;   nDPer349 = 10;  nHPer349 = 12;  |FINSI;
     |FINSI;

     #0#12 = 0;
     |BUCLE dsmoc349E;

     enEmpresa     = #0#0;
     enEjer        = #0#1;
     enPeriodo     = #0#2;
     enComplem     = #0#4;
     enActividad   = #0#5;
     eaTipo349     = "";
     aClave        = "";
|FPRC;

|DEFBUCLE dsmoc349S;
     #349#1;
     ;
     #0#0, #0#1, nDPer349, 349, enDComple, #0#5, "S ", 0000, 00, "            ";
     #0#0, #0#1, nHPer349, 349, enHComple, #0#5, "Sz", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Calcu349;
|FIN;

|PROCESO ClaveS_349;
     |ABRE #8;
     #8#0 = #0#0;
     #8#1 = #0#1;
     #8#2 = #0#2;
     #8#3 = #0#3;
     #8#4 = #0#4;
     #8#5 = #0#5;
     |LEE 040#8=;
     |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
     |CIERRA #8;

     nSwModi = 0;
     |SI #0#4 = 0;
         enDComple = 0;
         enHComple = 0;
         |HAZ dsmod349_MT;
         || ... |BUCLE dsmod349;
     |SINO;
         enDComple = #0#4;
         enHComple = #0#4;
     |FINSI;

     nTipo         = enTipoEntrada;
     eaTipo349     = "S";
     eaNombreAct   = #8#6;
     eaCaptura     = #8#7;
     eaComunidad   = #8#9;
     eaComunero    = #8#10;
     enTipoEntrada = 1;
     enModelo349   = #0#3;
     |SI nSwModi = 0; |SUB_EJECUTA_NP "dsmoc349"; |FINSI;
     enTipoEntrada = nTipo;

     |ABRE #4;
     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = enPeriodo;
     #4#3 = enModelo;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;
     aPeriodo303 = #4#22;

     |SI #4#22 = "M";
         nDPer349 = enPeriodo;
         nHPer349 = enPeriodo;
     |FINSI;

     |SI #4#22 = "T";
         |SI enPeriodo = 3;    nDPer349 = 1;   nHPer349 = 3;   |FINSI;
         |SI enPeriodo = 6;    nDPer349 = 4;   nHPer349 = 6;   |FINSI;
         |SI enPeriodo = 9;    nDPer349 = 7;   nHPer349 = 9;   |FINSI;
         |SI enPeriodo = 12;   nDPer349 = 10;  nHPer349 = 12;  |FINSI;
     |FINSI;

     #0#12 = 0;
     |PDEFECTO #0, 35, 56;
     |SI enEjer ] 2014; |PDEFECTO #0, 14, 56; |FINSI;

     |BUCLE dsmoc349S;
     |SI enEjer < 2014;
         #0#12 = #0#14 + #0#35;
     |FINSI;

     enEmpresa     = #0#0;
     enEjer        = #0#1;
     enPeriodo     = #0#2;
     enComplem     = #0#4;
     enActividad   = #0#5;
     eaTipo349     = "";
|FPRC;

|PROCESO InfSubvencion;
  |SI eaCaptura = "REGISTROS "; |Y enActividad ! 99; |ACABA;  |FINSI;
  |SI enEjer [ 2010;
      |SUB_EJECUTA_NP "dsmom048";
      nAlgun = 1;
  |FINSI;
|FPRC;

|PROCESO EntraDatosNormalF2;
     #99#0 = #0#8;
     |PARA nCampo1 = 14;  |SI nCampo1 [ 34;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 - 10;
           #99nCampo2 = #0nCampo1;
     |SIGUE;
     aAlfa = "Operaciones Intracomunitarias";

     |PUSHV 0501 2380;
     |SI #0#11 = 0;
         |PINPA #0#99;
         |PINDA #0#99;
     |SINO;
         |BLANCO 07201380;
         |CUADRO 07201380;
         |ATRI R; |PINTA 1126, " Importe: "; |ATRI 0;
         |ATRI S; |PINTA 0826, #99#0; |ATRI 0;
         |PINTA 1136, #99#4;
         |ATRI S; |PINTA 0926, aAlfa; |ATRI 0;
     |FINSI;

     |SI #0#11 = 0;
         |ENDATOS #1#99;
     |SINO;
         |ENCAMPO #4#99;
     |FINSI;
     |SI FSalida = 0;
         |PARA nCampo1 = 14;  |SI nCampo1 [ 34;  |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2 = nCampo1 - 10;
               #0nCampo1 = #99nCampo2;
         |SIGUE;
     |FINSI;

     |POPV;

     nSuma = 0;
     #0#12 = #0#14 + #0#17 + #0#20 + #0#23 + #0#26 + #0#29 + #0#32;
     #0#12 = #0#12 + #0#35 + #0#38 + #0#41 + #0#44 + #0#47 + #0#50 + #0#53;
     #0#13 = #0#16 + #0#19 + #0#22 + #0#25 + #0#28 + #0#31 + #0#34;
     #0#13 = #0#13 + #0#37 + #0#40 + #0#43 + #0#46 + #0#49 + #0#52 + #0#55;
|FPRC;

|PROCESO EntraDatosNormalF3;
     #99#0 = #0#8;
     |PARA nCampo1 = 35;  |SI nCampo1 [ 55;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 - 31;
           #99nCampo2 = #0nCampo1;
     |SIGUE;

     |SI #0#6 = 3; |Y #0#7 = 16;
         aAlfa = "Servicios Intracomunitarios";
     |SINO;
         aAlfa = "Operaciones Intracomunitarias";
     |FINSI;

     |PUSHV 0501 2380;
     |SI #0#11 = 0;
         |PINPA #0#99;
         |PINDA #0#99;
     |SINO;
         |BLANCO 07201380;
         |CUADRO 07201380;
         |ATRI R; |PINTA 1126, " Importe: "; |ATRI 0;
         |ATRI S; |PINTA 0826, #99#0; |ATRI 0;
         |PINTA 1136, #99#4;
         |ATRI S; |PINTA 0926, aAlfa; |ATRI 0;
     |FINSI;

     |SI #0#11 = 0;
         |ENDATOS #1#99;
     |SINO;
         |ENCAMPO #4#99;
     |FINSI;
     |SI FSalida = 0;
         |PARA nCampo1 = 35;  |SI nCampo1 [ 55;  |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2 = nCampo1 - 31;
               #0nCampo1 = #99nCampo2;
         |SIGUE;
     |FINSI;

     |POPV;

     nSuma = 0;
     #0#12 = #0#14 + #0#17 + #0#20 + #0#23 + #0#26 + #0#29 + #0#32;
     #0#12 = #0#12 + #0#35 + #0#38 + #0#41 + #0#44 + #0#47 + #0#50 + #0#53;
     #0#13 = #0#16 + #0#19 + #0#22 + #0#25 + #0#28 + #0#31 + #0#34;
     #0#13 = #0#13 + #0#37 + #0#40 + #0#43 + #0#46 + #0#49 + #0#52 + #0#55;
|FPRC;

|PROCESO Introduccion;  |TIPO 11;
     nInkey = FSalida;

     |SI nInkey ! 10;  |Y nInkey ! 11; |Y nInkey ! 12; |Y nInkey ! 13;
         |ACABA;
     |FINSI;

     |SI nInkey = 13;
         |HAZ InfSubvencion;
         |ERROR;
         |ACABA;
     |FINSI;

     |SI nInkey = 11; |O nInkey = 12;

         |SI nInkey = 12;
             |SI #0#6 ! 3; |O #0#7 ! 9; |O #0#1 < 2018;
                 |SI enTipoEntrada = 4; |ACABA; |FINSI;
             |FINSI;
         |FINSI;

         |SI #0#6 = 1;
             |SI #0#7 ! 6;  |Y #0#7 !  19;  |ACABA;  |FINSI;

             |SI #0#1 = 2014;               |ACABA;  |FINSI;
             |SI #0#7 = 6;  |Y #0#1 ] 2014; |ACABA;  |FINSI;
             |SI #0#7 = 19; |Y #0#1 < 2015; |ACABA;  |FINSI;
             |SI #0#7 = 19; |Y nInkey = 12; |ACABA;  |FINSI;
         |FINSI;

         |SI #0#6 = 2;
              |SI #0#2 ! 12; |ACABA; |FINSI;
              |SI #0#7 ! 9;  |ACABA; |FINSI;
         |FINSI;

         |SI #0#6 > 2;
             |SI #0#6 ! 3; |O #0#1 < 2012; |ACABA; |FINSI;
             |SI #0#7 ! 4; |Y #0#7 ! 9; |ACABA; |FINSI;
             |SI #0#7 = 4; |Y #0#1 ] 2014; |ACABA; |FINSI;
             |SI #0#7 = 9; |Y #0#1 < 2018; |ACABA; |FINSI;
         |FINSI;
     |FINSI;

     |SI enTipoEntrada = 4;
         |SI #0#11 ! 0;
             |SI #0#6 ! 3; |O #0#1 < 2012; |ACABA; |FINSI;
             |SI #0#7 ! 4;                 |ACABA; |FINSI;
             |SI #0#1 ] 2014;              |ACABA; |FINSI;
         |FINSI;

         |PUSHV 0501 2380;
         aAlfa = "";
         |SI nInkey = 10;
             #99#0 = #0#8;
             |PARA nCampo1 = 14;  |SI nCampo1 [ 34;  |HACIENDO nCampo1 = nCampo1 + 1;
                   nCampo2 = nCampo1 - 10;
                   #99nCampo2 = #0nCampo1;
             |SIGUE;
             aAlfa = "Operaciones Nacionales";
         |FINSI;

         |SI nInkey = 11;
             |SI #0#6 = 1;  |Y #0#7 = 6; |Y enEjer < 2014;
                 #99#0 = #0#8;
                 |PARA nCampo1 = 35;  |SI nCampo1 [ 55;  |HACIENDO nCampo1 = nCampo1 + 1;
                       nCampo2 = nCampo1 - 31;
                       #99nCampo2 = #0nCampo1;
                 |SIGUE;
             |FINSI;
             |SI #0#6 = 3;  |Y #0#7 = 4; |Y enEjer < 2014;
                 #99#0 = #0#8;
                 |PARA nCampo1 = 35;  |SI nCampo1 [ 55;  |HACIENDO nCampo1 = nCampo1 + 1;
                       nCampo2 = nCampo1 - 31;
                       #99nCampo2 = #0nCampo1;
                 |SIGUE;
              |FINSI;
              aAlfa = "Operaciones Intracomunitarias";
          |FINSI;

          |SI #0#11 = 0;
              |PINPA #0#99;
              |SI enEjer < 2014;
                  |ATRI S; |PINTA 0926, aAlfa; |ATRI 0;
              |FINSI;
              |PINDA #0#99;
          |SINO;
              |BLANCO 07201380;
              |CUADRO 07201380;
              |ATRI R; |PINTA 1126, " Importe: "; |ATRI 0;
              |SI enEjer < 2014;
                  |ATRI S; |PINTA 0826, #99#0; |ATRI 0;
              |FINSI;
              |PINTA 1136, #99#4;
              |ATRI S; |PINTA 0926, aAlfa; |ATRI 0;
          |FINSI;
          |LEETECLA aTecla;

          |POPV;

          |ACABA;
     |FINSI;

     |LEE 101#0=;

     nEntro = 0;
     |SI nInkey = 11; |O nInkey = 12;
         |SI #0#1 [ 2013;
            |SI #0#6 = 1;  |Y nInkey = 11;
                |SI #0#7 = 6;
                    |SI aDesConexion349 = "N";
                        nEntro = 1;
                        |HAZ ClaveI_349;
                    |SINO;
                        |HAZ EntraDatosNormalF3;
                    |FINSI;
                |FINSI;
            |FINSI;
         |FINSI;

         |SI #0#1 ] 2015;
            |SI #0#6 = 1;  |Y nInkey = 11;
                |SI #0#7 = 19;
                    |SI aDesConexion349 = "N";
                        nEntro = 1;
                        |HAZ ClaveR_349;
                    |SINO;
                        |HAZ EntraDatosNormalF2;
                    |FINSI;
                |FINSI;
            |FINSI;
         |FINSI;

         |SI #0#6 = 2;
             |SI #0#7 = 9; |HAZ LeoAmortizacion; |FINSI;
         |FINSI;

         |SI #0#6 = 3; |Y nInkey = 11;
             |SI #0#7 = 4; |Y #0#1 ] 2012; |Y #0#1 [ 2013;
                 |SI aDesConexion349 = "N";
                     |HAZ ClaveS_349;
                 |SINO;
                     |HAZ EntraDatosNormalF3;
                 |FINSI;
             |FINSI;

             |SI #0#7 = 9; |Y #0#1 ] 2018;
                 |SI aDesConexion349 = "N";
                     |HAZ ClaveE_349;
                 |SINO;
                     |ENCAMPO #12#0;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI #0#6 = 3; |Y #0#7 = 9; |Y nInkey = 12; |Y #0#1 ] 2018;
             |SI aDesConexion349 = "N";
                 |HAZ ClaveE_349;
             |FINSI;
          |FINSI;
     |FINSI;

     |SI nInkey = 10;
         |SI #0#11 = 0;
             |SI #0#1 ] 2014;
                 |SI #0#6 = 1;  |Y #0#7 = 15;
                     |SI aDesConexion349 = "N";
                         nEntro = 1;
                         |HAZ ClaveI_349;
                     |FINSI;
                 |FINSI;
             |FINSI;

             |SI #0#6 = 1;  |Y #0#7 = 5;
                 |SI aDesConexion349 = "N";
                     nEntro = 1;
                     |HAZ ClaveA_349;
                 |FINSI;
             |FINSI;

             |SI #0#1 ] 2015;
                 |SI #0#6 = 1;  |Y #0#7 = 19;
                     |SI aDesConexion349 = "N";
                         nEntro = 1;
                         |HAZ ClaveR_349;
                     |FINSI;
                 |FINSI;
             |FINSI;

             |SI nEntro = 0;
                 |HAZ EntraDatosNormalF2;
             |FINSI;
         |FINSI;

         |SI #0#11 = 1;
              |SI #0#6 = 3;  |Y #0#7 = 9;
                  |SI aDesConexion349 = "N";
                      |HAZ ClaveE_349;
                  |SINO;
                      |ENCAMPO #12#0;
                  |FINSI;
              |SINO;
                  |SI #0#6 = 3; |Y #0#7 = 16; |Y #0#1 ] 2014;
                       |SI aDesConexion349 = "N";
                            |HAZ ClaveS_349;
                       |SINO;
                            |ENCAMPO #12#0;
                       |FINSI;
                  |SINO;
                       |SI #0#6 = 3;  |Y #0#7 = 4;
                           |SI #0#1 < 2012;
                               |SI aDesConexion349 = "N";
                                  |HAZ ClaveS_349;
                               |SINO;
                                   |ENCAMPO #12#0;
                               |FINSI;
                           |SINO;
                               |HAZ EntraDatosNormalF2;
                           |FINSI;
                       |SINO;
                           |ENCAMPO #12#0;
                       |FINSI;
                  |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #0#6 = 3; |Y #0#7 = 17;
         |DBASE aBase;  |QBF aBase;
         aMas = aBase + "def/dsmociva.mas";
         |CARGA_DEF aMas, dsmociva@;
         |SI FSalida = 0;
             |ABRE #999;
             |DDEFECTO #999;
             #999#0 = #0#0;
             #999#1 = #0#1;
             #999#2 = #0#2;
             #999#3 = #0#3;
             #999#4 = #0#4;
             #999#5 = #0#5;
             #999#6 = 4;
             #999#7 = 17;
             |LEE 101#999=;
             #0#12 = #999#12;
             |CIERRA #999;
             |DESCARGA_DEF #dsmociva@;
         |FINSI;
     |FINSI;

     |PINTA #0#12;
     |PINTA #0#13;

     |GRABA 020#0a;
     |LIBERA #0;
     |SI #0#6 = 2; |Y #0#1 > 2010;
         aModo = "+"; |HAZ Tratadsmom087;
     |FINSI;

     |SI #0#6 = 4; |Y #0#7 = 17;
         |DBASE aBase;  |QBF aBase;
         aMas = aBase + "def/dsmociva.mas";
         |CARGA_DEF aMas, dsmociva@;
         |SI FSalida = 0;
             |ABRE #999;
             |DDEFECTO #999;
             #999#0 = #0#0;
             #999#1 = #0#1;
             #999#2 = #0#2;
             #999#3 = #0#3;
             #999#4 = #0#4;
             #999#5 = #0#5;
             #999#6 = 3;
             #999#7 = 17;
             |LEE 101#999=;
             |SI FSalida = 0;
                 #999#12 = #0#12;
                 |GRABA 020#999a;
             |FINSI;
             |CIERRA #999;
             |DESCARGA_DEF #dsmociva@;
         |FINSI;
     |FINSI;

     |SALVA_DATOS #0;

     |HAZ Totales;

     |REPON_DATOS #0;

     |LEE 040#0=;

     |SI #0#1 < 2011;
         nAlgun = 1;
     |SINO;
         |SI #0#6 = 1; |O #0#6 = 3;
             nAlgun = 1;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PedirComun;

  #119#0 = #0#8;
  |PARA nCampo1 = 14;  |SI nCampo1 [ 34;  |HACIENDO nCampo1 = nCampo1 + 1;
        nCampo2 = nCampo1 - 13;
        #119nCampo2 = #0nCampo1;
  |SIGUE;

  #119#22 = #87#16;
  #119#23 = #87#19;
  #119#24 = #87#22;
  #119#25 = #87#25;
  #119#26 = #87#28;
  #119#27 = #87#31;
  #119#28 = #87#34;

  #119#29 = #87#40;
  #119#30 = #87#42;
  #119#31 = #87#44;
  #119#32 = #87#46;
  #119#33 = #87#48;
  #119#34 = #87#50;
  #119#35 = #87#52;

  aAlfa1 = "N";
  |SI #119#3 ! 0;
      #119#37 = ((#119#22 * 100) / #119#3) ! 2;
      #119#44 = ((#119#29 * 100) / #119#3) ! 2;
      aAlfa1 = "S";
  |FINSI;
  |SI #119#22 ! 0; |O #119#29 ! 0; aAlfa1 = "S"; |FINSI;
  |C_M #119#22, 1, aAlfa1; |C_M #119#29, 1, aAlfa1;

  aAlfa1 = "N";
  |SI #119#6 ! 0;
      #119#38 = ((#119#23 * 100) / #119#6) ! 2;
      #119#45 = ((#119#30 * 100) / #119#6) ! 2;
      aAlfa1 = "S";
  |FINSI;
  |SI #119#23 ! 0; |O #119#30 ! 0; aAlfa1 = "S"; |FINSI;
  |C_M #119#23, 1, aAlfa1; |C_M #119#30, 1, aAlfa1;

  aAlfa1 = "N";
  |SI #119#9 ! 0;
      #119#39 = ((#119#24 * 100) / #119#9) ! 2;
      #119#46 = ((#119#31 * 100) / #119#9) ! 2;
      aAlfa1 = "S";
  |FINSI;
  |SI #119#24 ! 0; |O #119#31 ! 0; aAlfa1 = "S"; |FINSI;
  |C_M #119#24, 1, aAlfa1; |C_M #119#31, 1, aAlfa1;

  aAlfa1 = "N";
  |SI #119#12 ! 0;
      #119#40 = ((#119#25 * 100) / #119#12) ! 2;
      #119#47 = ((#119#32 * 100) / #119#12) ! 2;
      aAlfa1 = "S";
  |FINSI;
  |SI #119#25 ! 0; |O #119#32 ! 0; aAlfa1 = "S"; |FINSI;
  |C_M #119#25, 1, aAlfa1; |C_M #119#32, 1, aAlfa1;

  aAlfa1 = "N";
  |SI #119#15 ! 0;
      #119#41 = ((#119#26 * 100) / #119#15) ! 2;
      #119#48 = ((#119#33 * 100) / #119#15) ! 2;
      aAlfa1 = "S";
  |FINSI;
  |SI #119#26 ! 0; |O #119#33 ! 0; aAlfa1 = "S"; |FINSI;
  |C_M #119#26, 1, aAlfa1; |C_M #119#33, 1, aAlfa1;

  aAlfa1 = "N";
  |SI #119#18 ! 0;
      #119#42 = ((#119#27 * 100) / #119#18) ! 2;
      #119#49 = ((#119#34 * 100) / #119#18) ! 2;
      aAlfa1 = "S";
  |FINSI;
  |SI #119#27 ! 0; |O #119#34 ! 0; aAlfa1 = "S"; |FINSI;
  |C_M #119#27, 1, aAlfa1; |C_M #119#34, 1, aAlfa1;

  aAlfa1 = "N";
  |SI #119#21 ! 0;
      #119#43 = ((#119#28 * 100) / #119#21) ! 2;
      #119#50 = ((#119#35 * 100) / #119#21) ! 2;
      aAlfa1 = "S";
  |FINSI;
  |SI #119#28 ! 0; |O #119#35 ! 0; aAlfa1 = "S"; |FINSI;
  |C_M #119#28, 1, aAlfa1; |C_M #119#35, 1, aAlfa1;

  |PUSHV 0501 2380;

  |PINPA #0#119;
  |PINDA #0#119;
  |ENDATOS #2#119;
  |SI FSalida = 0;
      |POPV;
      #87#16 = #119#22;
      #87#19 = #119#23;
      #87#22 = #119#24;
      #87#25 = #119#25;
      #87#28 = #119#26;
      #87#31 = #119#27;
      #87#34 = #119#28;

      #87#40 = #119#29;
      #87#42 = #119#30;
      #87#44 = #119#31;
      #87#46 = #119#32;
      #87#48 = #119#33;
      #87#50 = #119#34;
      #87#52 = #119#35;

      #87#41 = (#87#40 % #87#36) ! 2;
      #87#43 = (#87#42 % #87#36) ! 2;
      #87#45 = (#87#44 % #87#36) ! 2;
      #87#47 = (#87#46 % #87#36) ! 2;
      #87#49 = (#87#48 % #87#36) ! 2;
      #87#51 = (#87#50 % #87#36) ! 2;
      #87#53 = (#87#52 % #87#36) ! 2;

      #87#37 = #87#40 + #87#42 + #87#44 + #87#46 + #87#48 + #87#50 + #87#52;
      #87#38 = #87#41 + #87#43 + #87#45 + #87#47 + #87#49 + #87#51 + #87#53;
      #87#39 = #87#37 - #87#38;
  |FINSI;
|FPRC;

|PROCESO Tratadsmom087;
  |SI #0#6 ! 2; |ACABA; |FINSI;
  |SI #0#7 = 0; |ACABA; |FINSI;
  |SI #0#7 > 7; |Y #0#7 < 13; |ACABA; |FINSI;
  |SI #0#1 [ 2010; |ACABA; |FINSI;

  |ABRE #87;
  |DDEFECTO #87;
  #87#0 = #0#0;
  #87#1 = #0#1;
  #87#2 = #0#2;
  #87#3 = #0#3;
  #87#4 = #0#4;
  #87#5 = #0#5;
  #87#6 = #0#6;
  #87#7 = #0#7;
  |LEE 141#87=;
  |SI FSalida ! 0;
      |SI aModo = "B";
          |CIERRA #87;
          |ACABA;
      |FINSI;

      |DDEFECTO #87;
      #87#0 = #0#0;
      #87#1 = #0#1;
      #87#2 = #0#2;
      #87#3 = #0#3;
      #87#4 = #0#4;
      #87#5 = #0#5;
      #87#6 = #0#6;
      #87#7 = #0#7;
      |GRABA 020#87b;

      |SI aModo = "C";
          |CIERRA #87;
          |ACABA;
      |FINSI;
  |SINO;
      |SI aModo = "B";
          |BORRA 020#87a;
          |CIERRA #87;
          |ACABA;
      |FINSI;
  |FINSI;

  #87#11 = enProAct;
  #87#36 = enProCom;
  |SI aModo = "C";
      |PDEFECTO #87, 8, 54;
  |FINSI;

  |SI aModo ! "C";
      nComun = 0;
      |SI eaCaptura = "REGISTROS ";
          |SI #87#40 ! 0; |O #87#42 ! 0; |O #87#44 ! 0;
             |O #87#46 ! 0; |O #87#48 ! 0; |O #87#50 ! 0; |O #87#52 ! 0;
                |SI enSwProrr !  2;
                    |HAZ PedirComun;
                    nComun = 1;
                |SINO;
                    |PDEFECTO #87, 37, 54;
                |FINSI;
          |FINSI;
      |FINSI;
      |SI nComun = 0;
          #87#16 = #0#16;  #87#19 = #0#19;
          #87#22 = #0#22;  #87#25 = #0#25;
          #87#28 = #0#28;  #87#31 = #0#31;
          #87#34 = #0#34;
      |FINSI;
      #87#15 = #0#15; #87#17 = (#87#16 % #87#11) ! 2;
      #87#18 = #0#18; #87#20 = (#87#19 % #87#11) ! 2;
      #87#21 = #0#21; #87#23 = (#87#22 % #87#11) ! 2;
      #87#24 = #0#24; #87#26 = (#87#25 % #87#11) ! 2;
      #87#27 = #0#27; #87#29 = (#87#28 % #87#11) ! 2;
      #87#30 = #0#30; #87#32 = (#87#31 % #87#11) ! 2;
      #87#33 = #0#33; #87#35 = (#87#34 % #87#11) ! 2;

      #87#12 = #87#16 + #87#19 + #87#22 + #87#25 + #87#28 + #87#31 + #87#34;
      #87#13 = #87#17 + #87#20 + #87#23 + #87#26 + #87#29 + #87#32 + #87#35;
      #87#14 = #87#12 - #87#13;

      #87#8  = #87#12 + #87#37;
      #87#9  = #87#13 + #87#38;
      #87#10 = #87#8  - #87#9;
  |FINSI;
  |GRABA 020#87a;
  |LIBERA #87;
  |CIERRA #87;
|FPRC;

|PROCESO Tratadsmom087_Adq;
  |ABRE #87;
  |DDEFECTO #87;
  #87#0 = #999#0;
  #87#1 = #999#1;
  #87#2 = #999#2;
  #87#3 = #999#3;
  #87#4 = #999#4;
  #87#5 = #999#5;
  #87#6 = #999#6;
  #87#7 = #999#7;
  |LEE 141#87=;
  |SI FSalida ! 0;
      |DDEFECTO #87;
      #87#0 = #999#0;
      #87#1 = #999#1;
      #87#2 = #999#2;
      #87#3 = #999#3;
      #87#4 = #999#4;
      #87#5 = #999#5;
      #87#6 = #999#6;
      #87#7 = #999#7;
      |GRABA 020#87b;
  |FINSI;

  |PDEFECTO #87, 8, 54;
  #87#11 = enProAct;
  #87#36 = enProCom;
  #87#16 = #999#16;  #87#19 = #999#19;
  #87#22 = #999#22;  #87#25 = #999#25;
  #87#28 = #999#28;  #87#31 = #999#31;
  #87#34 = #999#34;
  #87#15 = #999#15; #87#17 = (#87#16 % #87#11) ! 2;
  #87#18 = #999#18; #87#20 = (#87#19 % #87#11) ! 2;
  #87#21 = #999#21; #87#23 = (#87#22 % #87#11) ! 2;
  #87#24 = #999#24; #87#26 = (#87#25 % #87#11) ! 2;
  #87#27 = #999#27; #87#29 = (#87#28 % #87#11) ! 2;
  #87#30 = #999#30; #87#32 = (#87#31 % #87#11) ! 2;
  #87#33 = #999#33; #87#35 = (#87#34 % #87#11) ! 2;

  #87#12 = #87#16 + #87#19 + #87#22 + #87#25 + #87#28 + #87#31 + #87#34;
  #87#13 = #87#17 + #87#20 + #87#23 + #87#26 + #87#29 + #87#32 + #87#35;
  #87#14 = #87#12 - #87#13;

  #87#8  = #87#12 + #87#37;
  #87#9  = #87#13 + #87#38;
  #87#10 = #87#8  - #87#9;
  |GRABA 020#87a;
  |LIBERA #87;
  |CIERRA #87;
|FPRC;

|PROCESO Tipo5;  |TIPO 5;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 1;
     #0#7  = 0;
     #0#56 = 1;
     |LEE 040#0=;

     |LINEAS_BI_ATRI #0#9, S, I, -1;
|FPRC;

|PROCESO GrabaRegistros;
     |SI enModelo ! 303;
         |SI enModelo = 300;  |O enModelo = 330;  |O enModelo = 370;
             |SI #7#4 = 2;  |ACABA;  |FINSI;
         |SINO;
             |SI #7#4 = 1;  |ACABA;  |FINSI;
         |FINSI;
     |FINSI;

     |SI #7#0 = 2;  |Y #7#1 = 10;
         |SI #0#1 [ 2007;
             #7#2 = "      Suma de deducciones ........................";
             #7#3 = "T";
             #7#4 = 0;
             #7#5 = 2;
             #7#6 = 0;
             #7#7 = 0;
         |SINO;
             #7#2 = "Regularizacion aplicacion porcentaje def.prorrata";
             #7#3 = "D";
             #7#4 = 0;
             #7#5 = 0;
             #7#6 = 0;
             #7#7 = 0;
         |FINSI;
     |FINSI;

     |SI #7#0 = 3;  |Y #7#1 = 4; |Y enEjer ] 2009;
         #7#2 = "Op.no sujeta por regla localiz. o con inv.suj.pas.";
     |FINSI;

     |SI enEjer ] 2010;
         |SI #7#0 = 1;  |Y #7#1 = 4;
             |ACABA;
         |FINSI;

         |SI #7#0 = 3;  |Y #7#1 = 7;
             #7#2 = "Entregas bienes obj.de inst.o mont.en otros E.M. .";
         |FINSI;

         |SI #7#0 = 4;  |Y #7#1 = 5;
             |ACABA;
         |FINSI;

         |SI #7#0 = 4;  |Y #7#1 = 7;
             |ACABA;
         |FINSI;
     |FINSI;

     |DDEFECTO #0;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = #7#0;
     #0#7  = #7#1;
     #0#8  = #7#2;
     #0#9  = #7#3;
     #0#11 = #7#5;

     |SI #7#0 = 5;  |Y #7#1 = 1;
         #0#12 = 100;
     |FINSI;

     |GRABA 020#0n;
     |LIBERA #0;
|FPRC;

|DEFBUCLE dsmom007;
     #7#1;
     ;
     0, 00;
     5, 99;
     ;
     NULL, GrabaRegistros;
|FIN;

|PROCESO GrabaRegistros117;
     |SI #117#7 = 0;
         |ACABA;
     |FINSI;
     |SI #117#4 = 3; |ACABA; |FINSI;

     |DDEFECTO #0;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = #117#0;
     #0#7  = #117#1;
     |LEE 000#dsmociva.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |DDEFECTO #0;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = #117#0;
     #0#7  = #117#1;
     #0#8  = #117#2;
     #0#9  = #117#3;
     #0#11 = #117#5;
     #0#56 = #117#7;

     |SI #117#0 = 5;  |Y #117#1 = 1;
         #0#12 = 100;
     |FINSI;

     |GRABA 020#0n;
     |LIBERA #0;

     |SI #0#6 = 2; |Y enEjer > 2010;
         aModo = "C"; |HAZ Tratadsmom087;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom117;
     #117#1;
     ;
     nEjerCarga, 0, 00;
     nEjerCarga, 6, 99;
     ;
     NULL, GrabaRegistros117;
|FIN;

|RUTINA ClaveBaja0;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 0;
     #0#7  = 0;

     #0#56 = 0001;
|FRUT;

|RUTINA ClaveAlta0;
     #0#0  = enEmpresa;
     #0#1  = enEjer;
     #0#2  = enPeriodo;
     #0#3  = enModelo;
     #0#4  = enComplem;
     #0#5  = enActividad;
     #0#6  = 9;
     #0#7  = 99;

     #0#56 = 9999;
|FRUT;

|PROCESO BajaMod048;
     |BORRA 020#148a;
     |LIBERA #148;
|FPRC;

|DEFBUCLE dsmom048B;
     #148#1;
     ;
     enEmpresa, enEjer, enPeriodo, 000, enComplem, enActividad;
     enEmpresa, enEjer, enPeriodo, 999, enComplem, enActividad;
     be;
     NULL, BajaMod048;
|FIN;

|PROCESO BajaModeloPro;
     |BORRA 020#165a;
     |LIBERA #165;
|FPRC;

|DEFBUCLE dsmocivpB;
     #165#1;
     ;
     enEmpresa, enEjer, enPeriodo, 000, enComplem, enActividad, 0,  0;
     enEmpresa, enEjer, enPeriodo, 999, enComplem, enActividad, 9, 99;
     be;
     NULL, BajaModeloPro;
|FIN;

|PROCESO BajaModelo;
     |BORRA 020#0a;
     |LIBERA #0;
     |SI #0#6 = 2; |Y enEjer > 2010;
         aModo = "B"; |HAZ Tratadsmom087;
     |FINSI;
|FPRC;

|DEFBUCLE dsmocivaB;
     #0#1;
     ;
     enEmpresa, enEjer, enPeriodo, 000, enComplem, enActividad, 0,  0;
     enEmpresa, enEjer, enPeriodo, 999, enComplem, enActividad, 9, 99;
     be;
     NULL, BajaModelo;
|FIN;

|PROCESO EsCaja;
     nSwCaja = 0
     |SI #401#4 ] "01.01.2014";
         |SI #401#42 = "Z"; |O #401#42 = "1"; |O #401#42 = "2";
             |O #401#42 = "3"; |O #401#42 = "4"; |O #401#42 = "5";
             |O #401#42 = "6"; |O #401#42 = "7"; |O #401#42 = "8";
                nSwCaja = 1;
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO LeeCabecera;
     nDepar = #401#10;
     |SI nDepar = 0;  nDepar = 1;   |FINSI;

     #402#0 = enEmpresa;
     #402#1 = nDepar;
     |LEE 040#402=;
     |SI FSalida ! 0;  nDepar = 1;  |FINSI;

     |SI enActividad ! nDepar;  |ACABA;  |FINSI;

     #401#40 = 0;
     |GRABA 020#401a;

     |HAZ EsCaja;
     |SI nSwCaja = 1;
         |ABRE #501;
         |DDEFECTO #501;
         #501#17 = nEjerCobro;
         #501#0 = #401#0;
         #501#1 = #401#1;
         |LEE 141#501=;
         |SI FSalida = 0;
             #501#8  = 0;
             #501#9  = 0;
             #501#10 = 0;
             #501#11 = 0;
             |GRABA 020#501a;
         |FINSI;
         |LIBERA #501;
         |CIERRA #501;
    |FINSI;
|FPRC;

|DEFBUCLE camaniva;
     #401#1;
     40,4;
     00, 0000000000, nPeriodo, fDFecha;
     99, 9999999999, nPeriodo, fHFecha;
     be;
     NULL, LeeCabecera;
|FIN;

|PROCESO LeeCamacc02;

     |SI nEjerCobro ! 0;
         |SI #502#9 ! 0; |Y #502#9 ! enEjer;
             |ACABA;
         |FINSI;
     |FINSI;

     |DDEFECTO #401;
     #401#0 = #502#0;
     #401#1 = #502#1;
     |LEE 041#401=;
     nDepar = #401#10;
     |SI nDepar = 0;  nDepar = 1;   |FINSI;

     #402#0 = enEmpresa;
     #402#1 = nDepar;
     |LEE 040#402=;
     |SI FSalida ! 0;  nDepar = 1;  |FINSI;

     |SI enActividad ! nDepar;  |ACABA;  |FINSI;

     #502#8 = 0;
     #502#9 = 0;
     |GRABA 020#502a;
     |LIBERA #502;
|FPRC;

|DEFBUCLE camacc02;
     #502#1;
     8,4;
     nEjerCobro, 01, 0000000001, 01, nPeriodo, fDFecha;
     nEjerCobro, 99, 9999999999, 99, nPeriodo, fHFecha;
     be;
     NULL, LeeCamacc02;
|FIN;

|DEFBUCLE camacc02_2014;
     #502#1;
     8,4;
     #501#17, #501#0, #501#1, 01, nPeriodo, fDFecha;
     #501#17, #501#0, #501#1, 99, nPeriodo, fHFecha;
     be;
     NULL, LeeCamacc02;
|FIN;

|PROCESO LeeCamacc02Per;
     |SI #501#11 < #502#9;
         #501#10 = #502#8;
         #501#11 = #502#9;
     |SINO;
         |SI #501#11 = #502#9; |Y #501#10 < #502#8;
             #501#10 = #502#8;
             #501#11 = #502#9;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE camacc02_Per;
     #502#1;
     ;
     #501#17, #501#0, #501#1, 01;
     #501#17, #501#0, #501#1, 99;
     e;
     NULL, LeeCamacc02Per;
|FIN;

|PROCESO camacc01;

   ePerioCaja = #501#18;
   |HAZ ePathCaja;
   |CIERRA #401; |PATH_DAT #401 ePathCaja;

   eDevenCaja = #501#17;

   |ABRE #401;
   |BUCLE camacc02_2014;
   |CIERRA #401;

   #501#10 = 0;
   #501#11 = 0;
   |BUCLE camacc02_Per;
   |GRABA 020#501a;
   |LIBERA #501;
|FPRC;

|DEFBUCLE camacc01;
   #501#1;
   ;
   nEjerCobro, 01, 0000000001;
   nEjerCobro, 99, 9999999999;
   be;
   NULL, camacc01;
|FIN;

|PROCESO BajaRegistros;
     |SI eaCaptura ! "REGISTROS ";  |ACABA;  |FINSI;

     |SI enModelo = 300;
         |SI enPeriodo = 3;   nPeriodo = 1;  |FINSI;
         |SI enPeriodo = 6;   nPeriodo = 2;  |FINSI;
         |SI enPeriodo = 9;   nPeriodo = 3;  |FINSI;
         |SI enPeriodo = 12;  nPeriodo = 4;  |FINSI;
     |SINO;
         nPeriodo = enPeriodo;
     |FINSI;

     |SI enModelo = 303;
         |ABRE #4;
         #4#0 = enEmpresa;
         #4#1 = enEjer;
         #4#2 = enPeriodo;
         #4#3 = enModelo;
         #4#4 = enComplem;
         |LEE 040#4=;
         |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;

         |SI #4#22 = "M";
             nPeriodo = enPeriodo;
         |SINO;
             |SI enPeriodo = 3;   nPeriodo = 1;  |FINSI;
             |SI enPeriodo = 6;   nPeriodo = 2;  |FINSI;
             |SI enPeriodo = 9;   nPeriodo = 3;  |FINSI;
             |SI enPeriodo = 12;  nPeriodo = 4;  |FINSI;
             |SI enEjer ] 2010; nPeriodo = enPeriodo; |FINSI;
         |FINSI;
         |CIERRA #4;
     |FINSI;

     aAlfa = enEjer; aAlfa1 = "01.01." + aAlfa; fDFecha = aAlfa1;
                     aAlfa1 = "31.12." + aAlfa; fHFecha = aAlfa1;
     aAlfa = aAlfa % -102;
     nEjer = aAlfa;

     nPer1   = -1;
     nPer2   = -1;
     swerror = 0;
     enSwPartido = 0;
     |ABRE #400;
     |SELECT #4#400;
     #400#2  = enEmpresa;
     #400#26 = nEjer;
     |LEE 040#400=;
     |SI FSalida = 0;
         nPer1 = #400#3;
         |SI #400#11 ! 1;
              enSwPartido = 1;
         |FINSI;
     |SINO;
         swerror = 1;
     |FINSI;
     |SI enSwPartido = 1; |O swerror = 1;
         #400#2  = enEmpresa;
         #400#26 = nEjer - 1; |SI #400#26 < 0; #400#26 = 99; |FINSI;
         |LEE 040#400=;
         |SI FSalida = 0;
             |SI #400#11 ! 1;
                 nPer2 = #400#3;
                 enSwPartido = 1;
                 swerror     = 0;
             |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #400;
     |SI swerror = 1; |ACABA; |FINSI;
     |SI enSwPartido = 0;
         fDFecha = "01.01.1900";
         fHFecha = "31.12.2099";
     |FINSI;

     |SI nPer1 ! -1;
         nEjerCobro = 0;
         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #400#2) % -105) + nPer1 + "/";

         |PATH_DAT #401 aPathConta;
         |PATH_DAT #501 aPathConta;
         |PATH_DAT #502 aPathConta;

         |ABRE #402;
         |BUCLE camaniva;

         |ABRE #401;
         |BUCLE camacc02;
         |CIERRA #401;

         |SI enEjer ] 2015;
             nEjerCobro = enEjer - 1;
             |BUCLE camacc01;
         |FINSI;
         |CIERRA #402;

     |FINSI;

     |SI nPer2 ! -1;
         nEjerCobro = 0;
         |DBASS aPathConta;   |QBT aPathConta;
         aPathConta = aPathConta + "contagen/fich/" + (("00000" + #400#2) % -105) + nPer2 + "/";

         |PATH_DAT #401 aPathConta;
         |PATH_DAT #501 aPathConta;
         |PATH_DAT #502 aPathConta;

         |ABRE #402;
         |BUCLE camaniva;

         |ABRE #401;
         |BUCLE camacc02;
         |CIERRA #401;
         |CIERRA #402;
     |FINSI;
|FPRC;

|PROCESO Baja349;
     |SI enComplem ! 0;
         |ABRE #47;
         #47#0 = enEmpresa;
         #47#1 = enEjer;
         #47#2 = enPeriodo;
         #47#3 = enModelo;
         #47#4 = enComplem;
         #47#5 = 0;
         |LEE 141#47=;
         |SI FSalida = 0;
             |BORRA 020#47a;
         |FINSI;
         |LIBERA #47;
         |CIERRA #47;
    |FINSI;
|FPRC;

|PROCESO Grabamom008;
     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = enPeriodo;
     #8#3 = enModelo;
     #8#4 = enComplem;
     #8#5 = enActividad;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "COMPLETADO";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;
|FPRC;

|PROCESO LeoAmortizacion;
    enEmpAmor  = #0#0;
    enEjeAmor  = #0#1;
    enDActAmor = #0#5;
    enHActAmor = #0#5;
    |SI nInkey = 11;
        enModoAmor = 0;
        |SUB_EJECUTA "dsmozp41;Calculo";
    |SINO;
        enModoAmor = 1;
        |SUB_EJECUTA "dsmozp41";
    |FINSI;

    #0#16 = enImpRegul;
    #0#12 = #0#14 + #0#17 + #0#20 + #0#23 + #0#26 + #0#29 + #0#32;
    #0#13 = #0#16 + #0#19 + #0#22 + #0#25 + #0#28 + #0#31 + #0#34;
|FPRC;

|| ...Proceso para grabar linea de orden
|PROCESO GrabaCarga2011;
     #117#8 = 2011;
     #117#0 = nGrupo;
     #117#1 = nSubGrupo;
     |LEE 041#117=;
     |SI FSalida = 0;
         #999#0 = #0#0;
         #999#1 = #0#1;
         #999#2 = #0#2;
         #999#3 = #0#3;
         #999#4 = #0#4;
         #999#5 = #0#5;
         #999#6 = nGrupo;
         #999#7 = nSubGrupo;
         |LEE 041#999=;
         |SI FSalida ! 0;
             |DDEFECTO #999;
             #999#0 = #0#0;
             #999#1 = #0#1;
             #999#2 = #0#2;
             #999#3 = #0#3;
             #999#4 = #0#4;
             #999#5 = #0#5;
             #999#6 = nGrupo;
             #999#7 = nSubGrupo;
             |GRABA 020#999b;
         |FINSI;
         #999#8  = #117#2;
         #999#9  = #117#3;
         #999#11 = #117#5;
         #999#56 = #117#7;
         |GRABA 020#999a;
         |LIBERA #999;
     |FINSI;
|FPRC;

|PROCESO Ctrl_Cabecera;

     |SI #0#6 = 2; |Y #0#7 = 11;
         |BORRA 020#0a;
         |LIBERA #0;
         |ACABA;
     |FINSI;

     #117#8 = 2011;
     #117#0 = #0#6;
     #117#1 = #0#7;
     |LEE 041#117=;
     |SI FSalida = 0;
         #0#8  = #117#2;
         #0#56 = #117#7;
         |GRABA 020#0a;
     |FINSI;
     |LIBERA #0;
     |SI #0#6 = 1; |Y #0#7 = 13;
         nGrupo = 1; nSubGrupo = 14; |HAZ GrabaCarga2011;
     |FINSI;
     |SI #0#6 = 2; |Y #0#7 = 12;
         nGrupo = 2; nSubGrupo = 13; |HAZ GrabaCarga2011;
         nGrupo = 2; nSubGrupo = 14; |HAZ GrabaCarga2011;
         nGrupo = 2; nSubGrupo = 15; |HAZ GrabaCarga2011;
     |FINSI;
|FPRC;

|DEFBUCLE Ctrl_Cabecera;
     #0#1;
     ;
     00000, 2011, 01, enModelo, 00, 00, 0, 00;
     99999, 2011, 12, enModelo, 99, 99, 9, 99;
     be;
     NULL, Ctrl_Cabecera;
|FIN;

|PROCESO Ctrl_Lineas;
     nSwHay = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE Ctrl_Lineas;
     #0#1;
     56;
     00000, 2011, 01, 303, 00, 00, 1, 02, 0001;
     99999, 2011, 12, 303, 99, 99, 1, 02, 0001;
     e;
     NULL, Ctrl_Lineas;
|FIN;

|PROCESO Controla2011;
     nSwHay = 0;
     |BUCLE Ctrl_Lineas;
     |SI nSwHay = 1;
        |DBASE aBase;  |QBF aBase;
        aMas = aBase + "def/dsmociva.mas";
        |CARGA_DEF aMas, dsmociva@;
        |SI FSalida = 0;
            |ABRE #117;
            |ABRE #999;
            |BUCLE Ctrl_Cabecera;
            |CIERRA #999;
            |CIERRA #117;
            |DESCARGA_DEF #dsmociva@;
        |FINSI;
     |FINSI;
|FPRC;

|| ..Proceso para grabar 2012  #0#6 = 3 y #0#7 = 4 nacional e intracomunitario
|PROCESO Ctrl_Graba2012;
    #0#35 = #0#12 - #0#14;
    #0#12 = #0#14 + #0#35;
    |GRABA 020#0a;
    |LIBERA #0;
|FPRC;

|DEFBUCLE Ctrl_Graba2012;
     #0#1;
     ;
     00000, 2012, 01, enModelo, 00, 00, 3, 04;
     99999, 2012, 12, enModelo, 99, 99, 3, 04;
     be;
     NULL, Ctrl_Graba2012;
|FIN;

|PROCESO Ctrl_Lineas12;
     nSwHay = 1;
     |SI #0#12 ! 0;
         |SI #0#14 ! 0; |O #0#35 ! 0;
             nSwHay = 2;
             |ERROR10;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Ctrl_Lineas12;
     #0#1;
     12;
     00000, 2012, 01, 303, 00, 00, 3, 04, nDImporte;
     99999, 2012, 12, 303, 99, 99, 3, 04, nHImporte;
     e;
     NULL, Ctrl_Lineas12;
|FIN;

|PROCESO Controla2012;
     nSwHay = 0;
     nDImporte = 0.01; nHImporte = 9999999999.99;
     |BUCLE Ctrl_Lineas12;
     |SI nSwHay = 0;
         nDImporte = -999999999.99; nHImporte = -0.01
         |BUCLE Ctrl_Lineas12;
     |FINSI;
     |SI nSwHay = 1;
         |BUCLE Ctrl_Graba2012;
     |FINSI;
|FPRC;
|| //////////////// Proceso de ejercicio 2014 incorporar casilla 3-16
|PROCESO Leo117_2014;
   |DDEFECTO #117;
   #117#8 = 2014;
   #117#0 = nGrupo;
   #117#1 = nSubGrupo;
   |LEE 041#117=;
|FPRC;

|PROCESO Ctrl_Cabecera14;

     |SI #0#6 = 1;
         |SI #0#7 = 6;
             |PDEFECTO #0, 35, 56;
             |GRABA 020#0a;
         |FINSI;
         |SI #0#7 = 15;
             #0#12 = 0; #0#13 = 0;
             |PARA nCampo1 = 14; |SI nCampo1 [ 34; |HACIENDO nCampo1 = nCampo1 + 1;
                   nCampo2 = nCampo1 + 21;
                   #0nCampo1 = #0nCampo1 + #0nCampo2;
                   #0nCampo2 = 0;
             |SIGUE;
             |GRABA 020#0a;
         |FINSI;
     |FINSI;

     |SI #0#6 = 3;
         nGrupo = 3;

         |SI #0#7 = 9;
             nSubGrupo = 9;
             |HAZ Leo117_2014;
             #0#8  = #117#2;
             #0#14 = #0#12;
             |GRABA 020#0a;
         |FINSI;

         |SI #0#7 = 4;
             nSubGrupo = 16;
             |HAZ Leo117_2014;

             #999#0 = #0#0;
             #999#1 = #0#1;
             #999#2 = #0#2;
             #999#3 = #0#3;
             #999#4 = #0#4;
             #999#5 = #0#5;
             #999#6 = nGrupo;
             #999#7 = nSubGrupo;
             |LEE 041#999=;
             |SI FSalida ! 0;
                 |DDEFECTO #999;
                 #999#0 = #0#0;
                 #999#1 = #0#1;
                 #999#2 = #0#2;
                 #999#3 = #0#3;
                 #999#4 = #0#4;
                 #999#5 = #0#5;
                 #999#6 = nGrupo;
                 #999#7 = nSubGrupo;
                 |GRABA 020#999b;
             |FINSI;
             #999#8  = #117#2;
             #999#9  = #117#3;
             #999#11 = #117#5;
             #999#56 = #117#7;
             #999#12 = 0;
             #999#13 = 0;
             |PARA nCampo1 = 35; |SI nCampo1 [ 55; |HACIENDO nCampo1 = nCampo1 + 1;
                   nCampo2 = nCampo1 - 21;
                   #999nCampo2 = #0nCampo1;
             |SIGUE;
             #999#12 = #999#14 + #999#17 + #999#20 + #999#23 + #999#26 + #999#29 + #999#32;
             #999#13 = #999#16 + #999#19 + #999#22 + #999#25 + #999#28 + #999#31 + #999#34;
             |GRABA 020#999a;
             |LIBERA #999;

             |PDEFECTO #0, 35, 56;
             #0#12 = #0#14 + #0#17 + #0#20 + #0#23 + #0#26 + #0#29 + #0#32;
             #0#13 = #0#16 + #0#19 + #0#22 + #0#25 + #0#28 + #0#31 + #0#34;
             |GRABA 020#0a;
         |FINSI;
     |FINSI;
     |LIBERA #0;
|FPRC;

|DEFBUCLE Ctrl_Cabecera14;
     #0#1;
     ;
     00000, 2014, 01, enModelo, 00, 00, 1, 4;
     99999, 2014, 12, enModelo, 99, 99, 3, 16;
     be;
     NULL, Ctrl_Cabecera14;
|FIN;

|DEFBUCLE Ctrl_Lineas14;
     #0#1;
     ;
     00000, 2014, 01, 303, 00, 00, 3, 16;
     99999, 2014, 12, 303, 99, 99, 3, 16;
     e;
     NULL, Ctrl_Lineas;
|FIN;

|PROCESO Ctrl_LineasCaja;
     |SI #dsmociva#7 = 0;
         |BORRA 020#dsmociva.a;
         |LIBERA #dsmociva;
         |ACABA;
     |FINSI;

     |SI #dsmociva#7 = 1;  nSubGrupo = 17;  |FINSI;
     |SI #dsmociva#7 = 2;  nSubGrupo = 18;  |FINSI;

     #dsmociva@#0  = #dsmociva#0;
     #dsmociva@#1  = #dsmociva#1;
     #dsmociva@#2  = #dsmociva#2;
     #dsmociva@#3  = #dsmociva#3;
     #dsmociva@#4  = #dsmociva#4;
     #dsmociva@#5  = #dsmociva#5;
     #dsmociva@#6  = 4;
     #dsmociva@#7  = nSubGrupo;
     |LEE 101#dsmociva@.=;
     |SI FSalida ! 0;
         #dsmom117#0 = 4;
         #dsmom117#1 = nSubGrupo;
         |LEE 000#dsmom117.=;
         |SI FSalida ! 0;  |DDEFECTO #dsmom117;  |FINSI;

         #dsmociva@#6  = 4;
         #dsmociva@#7  = nSubGrupo;
         #dsmociva@#8  = #dsmom117#2;
         #dsmociva@#9  = #dsmom117#3;
         #dsmociva@#11 = #dsmom117#5;
         #dsmociva@#56 = #dsmom117#7;
         |GRABA 020#dsmociva@.b;
     |FINSI;

     #dsmociva@#10 = #dsmociva#10;
     |PARA nCampo1 = 12;  |SI nCampo1 [ 55; |HACIENDO nCampo1 = nCampo1 + 1;
           #dsmociva@#nCampo1# = #dsmociva#nCampo1#;
     |SIGUE;

     |GRABA 020#dsmociva@.a;
     |LIBERA #dsmociva@;

     |BORRA 020#dsmociva.a;
     |LIBERA #dsmociva;
|FPRC;

|DEFBUCLE Ctrl_LineasCaja;
     #dsmociva#1;
     ;
     00000, 2014, 01, 303, 00, 00, 6, 0;
     99999, 2014, 12, 303, 99, 99, 6, 2;
     e;
     NULL, Ctrl_LineasCaja;
|FIN;

|PROCESO Controla2014;
     nSwHay = 0;
     |BUCLE Ctrl_Lineas14;
     |SI nSwHay = 0;
        |DBASE aBase;  |QBF aBase;
        aMas = aBase + "def/dsmociva.mas";
        |CARGA_DEF aMas, dsmociva@;
        |SI FSalida = 0;
            |ABRE #117;
            |ABRE #999;
            |BUCLE Ctrl_Cabecera14;
            |CIERRA #999;
            |CIERRA #117;
            |DESCARGA_DEF #dsmociva@;
        |FINSI;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsmociva.mas";
     |CARGA_DEF aMas, dsmociva@;
     |SI FSalida = 0;
        |ABRE #dsmociva@;
        |ABRE #dsmom117;
        |BUCLE Ctrl_LineasCaja;
        |CIERRA #dsmom117;
        |CIERRA #dsmociva@;
        |DESCARGA_DEF #dsmociva@;
     |FINSI;
|FPRC;

|PROCESO EjerCarga;
    nEjerCarga = #117#8;
|FPRC;

|DEFBUCLE EjerCarga;
  #117#1;
  ;
  2011,   1, 00;
  enEjer, 1, 01;
  ;
  NULL, EjerCarga;
|FIN;

|PROCESO CtrlFichCarga;
     nError = 0;

     |ABRE #117;
     #117#8 = 2018;
     #117#0 = 1;
     #117#1 = 0;
     |LEE 040#117=;
     |SI FSalida ! 0;
         |CIERRA #117;

         eaExtension = "mod";
         eaPrograma  = "dsmom117";
         |SUB_EJECUTA_NP ":basica/dspatron";

         |ABRE #117;
         #117#8 = 2018;
         #117#0 = 1;
         #117#1 = 0;
         |LEE 040#117=;
         |SI FSalida ! 0;
             |MENAV "0000Ficheros patrones del IVA incorrectos. Consulte con su administrador";
             nError = 1;
         |FINSI;
     |FINSI;
     |CIERRA #117;

     |SI nError = 1;  |ACABA;  |FINSI;

     nEjerCarga = 2010;
     |SI enEjer ] 2011;
         |BUCLE EjerCarga;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #95;
     #95#0 = enEmpresa;
     #95#1 = enEjer;
     |LEE 000#95=;
     |SI FSalida ! 0;  |DDEFECTO #95;  |FINSI;
     |CIERRA #95;

     nCampo          = 30 + enPeriodo;
     aDesConexion349 = #95nCampo;

     eaNomDef = "dsmociva";

     |HAZ CtrlFichCarga;
     |SI nError = 1;   |ACABA;  |FINSI;

     |SI enEjer = 2011;
         |HAZ Controla2011;
     |FINSI;

     |SI enEjer = 2012;
         |HAZ Controla2012;
     |FINSI;

     |SI enEjer = 2014;
         |HAZ Controla2014;
     |FINSI;

|| \\\\\\ Consulta del Modelo

    |SI enTipoEntrada = 4;              || Existencia del Modelo ????
         |CABEZA "Trabajo Modelo IVA";
         |ABRE #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         #0#6 = 0;
         #0#7 = 0;
         |LEE 040#0];
         |SI FSalida ! 0;  |O #0#0 ! enEmpresa;  |O #0#1 ! enEjer;
                           |O #0#2 ! enPeriodo;  |O #0#3 ! enModelo;
                           |O #0#4 ! enComplem;  |O #0#5 ! enActividad;
             |MENAV "     No existe el Registro.";
             |CIERRA #0;
             |ACABA;
         |FINSI;
         |CIERRA #0;

         |HAZ PintaDatos;

         |SI enEjer [ 2010;
             |ENTLINEAL #1#0, -8, 4, 22, 1, ClaveBaja0, ClaveAlta0;
         |SINO;
             |ENTLINEAL #2#0, -9, 4, 22, 1, ClaveBaja0, ClaveAlta0;
         |FINSI;
         |ACABA;
     |FINSI;

     |HAZ LeeCtrlProrr;
     enProAct = 100; enProCom = 100;
     |SI enEjer > 2010; |Y enSwProrr ! 2;
         |HAZ eNuevoPro;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              ||Baja del Modelo
         |BUCLE dsmocivpB;
         |BUCLE dsmocivaB;
         |BUCLE dsmom048B;
         |HAZ BajaRegistros;
         |HAZ eBajaProrrata;
         |HAZ Baja349;
         |HAZ Registro0;
         |ACABA;
     |FINSI;

|| Creacion unicamente del Modelo

     |SI enTipoEntrada = 90;              || Creacion Solamente
         |ABRE #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         #0#6 = 0;
         #0#7 = 0;
         |LEE 040#0];
         |SI FSalida ! 0;  |O #0#0 ! enEmpresa;  |O #0#1 ! enEjer;
                           |O #0#2 ! enPeriodo;  |O #0#3 ! enModelo;
                           |O #0#4 ! enComplem;  |O #0#5 ! enActividad;
             |SI enEjer [ 2010;
                 |BUCLE dsmom007;
             |SINO;
                 |BUCLE dsmom117;
             |FINSI;
         |FINSI;
         |CIERRA #0;

         |ACABA;
     |FINSI;

|| Creacion unicamente del Modelo de Impresion

     |SI enTipoEntrada = 91;
         |HAZ Grabamom008;
         |HAZ Registro0;
         |ACABA;
     |FINSI;

|| Calcula unicamente del Modelo de Trabajo

     |SI enTipoEntrada = 95;              || Calculo del dsmociva
         |ABRE #0;
         |HAZ Totales;
         |CIERRA #0;

         |HAZ Grabamom008;
         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo desde planillas ////////

     |SI enTipoEntrada = 97;              ||Baja del Modelo
         |BUCLE dsmocivpB;
         |BUCLE dsmocivaB;
         |BUCLE dsmom048B;
         |HAZ eBajaProrrata;
         |HAZ Baja349;
         |HAZ Registro0;
         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         #0#6 = 0;
         #0#7 = 0;
         |LEE 040#0];
         |SI FSalida ! 0;  |O #0#0 ! enEmpresa;  |O #0#1 ! enEjer;
                           |O #0#2 ! enPeriodo;  |O #0#3 ! enModelo;
                           |O #0#4 ! enComplem;  |O #0#5 ! enActividad;
             enExistencia = 1;
         |FINSI;
         |CIERRA #0;

         |ACABA;
     |FINSI;


|| \\\\\\ Modificacion y Alta del Modelo de Trabajo

     |CABEZA "Trabajo Modelo IVA";

     |ABRE #0;
     |SI enEjer [ 2010;
          |BUCLE dsmom007;
     |SINO;
         |BUCLE dsmom117;
     |FINSI;
     |CIERRA #0;

     |HAZ PintaDatos;
     nAlgun = 0;
     |SI enEjer [ 2010;
         |ENTLINEAL #1#0, -8, 4, 22, 1, ClaveBaja0, ClaveAlta0;
     |SINO;
         |ENTLINEAL #2#0, -9, 4, 22, 1, ClaveBaja0, ClaveAlta0;
     |FINSI;
     enEntrada = 1;

     |SI #0#2 = 12; |Y nAlgun = 1; |Y enSwProrr ! 2;
         nNoCal = 0;
         |ABRE #4;
         #4#0 = enEmpresa;
         #4#1 = enEjer;
         #4#2 = enPeriodo;
         #4#3 = enModelo;
         #4#4 = enComplem + 1;
         |LEE 040#4];
         |SI FSalida = 0; |Y #4#0 = enEmpresa; |Y #4#1 = enEjer;
             |Y #4#2 = enPeriodo; |Y #4#3 = enModelo;
                 nNoCal = 1;
         |FINSI;
         |CIERRA #4;

         |SI enEjer [ 2010;   || a partir del 2011 no pregunto, siempre calcula
                              || el importe de la Prorrata definitiva
             |CONFI "    NCalcular la Prorrata Definitiva de Esta Empresa S/N";
         |SINO;
             FSalida = 0;
         |FINSI;
         |SI FSalida = 0; |Y nNoCal = 0;
             |SI enEjer [ 2010;
                 enSinPantalla = 4;
                 |SUB_EJECUTA_NP "dsmozp80";
                 enSinPantalla = 0;
             |SINO;
                 enSinPantalla = 4;
                 |SUB_EJECUTA_NP "dsmozp02";
                 enSinPantalla = 0;
             |FINSI;
         |SINO;
             |SI nNoCal = 0;
                 |MENAV "    Recuerde, es conveniente volver a Entrar al calculo de este modelo";
             |FINSI;
         |FINSI;
     |FINSI;
     |HAZ Registro0;

     |SI enPlanillas = 1;
         |HAZ Grabamom008;
     |FINSI;
|FPRO;
