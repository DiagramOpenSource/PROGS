|FICHEROS;
     dsmom073;
     dsm190li;
     dsmoc111;
     dsm11101;
     dsmom030;

    :/laboral/def/nomconli;
|FIN;

|VARIABLES;
     nSw          = 0;
     nConcepto    = 0;
     nEjer        = 0;
     nHayIRPF     = 0;

     aPathLaboral = "";
     aBase        = "";
     aAlfa        = "";
     nHandle      = 0;

     &enPlan      = 0;
     &enDesde     = 0;
     &enHasta     = 0;
     &eaPrograma  = "";
     &eaExtension = "";
     &enEjerIRPF  = 0;
|FIN;

|PROCESO nomconli;
    |SI #nomconli#13 = "25";
        #nomconli#13 = "28";
        |GRABA 020#nomconli.a;
    |FINSI;

    |LIBERA #nomconli;
|FPRC;

|DEFBUCLE nomconli;
    #nomconli#1;
    ;
    001,001;
    999,999;
    be;
    NULL, nomconli;
|FIN;

|PROCESO PatronM073;
     nSw = 0;
     |ABRE #dsmom073;
     #dsmom073#0 = 2018;
     #dsmom073#1 = "A";
     #dsmom073#2 = " ";
     |LEE 000#dsmom073.=;
     |SI FSalida ! 0;
         nSw = 1;
     |FINSI;
     |CIERRA #dsmom073;

     |SI nSw ! 0;
         eaExtension = "mod";
         eaPrograma  = "dsmom073";
         |SUB_EJECUTA_NP ":basica/dspatron";

         |ABRE #dsmom073;
         #dsmom073#0 = 2018;
         #dsmom073#1 = "A";
         #dsmom073#2 = "  ";
         |LEE 000#dsmom073.=;
         |SI FSalida ! 0;
             |MENAV "0000 El fichero de Claves IRPF no se ha instalado, por favor instale la aplicacion ipbasica";
             nSw = 0;
         |FINSI;
         |CIERRA #dsmom073;
     |FINSI;

     |SI nSw = 1;
         || ... Procedemos a hacer el cambio de Claves.

         |SUB_EJECUTA_NP ":modelos/dsmoz067;ES2018";

         aPathLaboral = "";
         |DBASS aBase;   |QBF aBase;
         aAlfa = aBase + "laboral/def/labempre.mas";
         |XABRE "E", aAlfa, nHandle;
         |SI FSalida ] 0;
             aPathLaboral = aBase + "laboral/fich/";
         |FINSI;
         |SI aPathLaboral ! "";
             |PATH_DAT #nomconli#aPathLaboral#;
             |BUCLE nomconli;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaEjerIRPF;
     nEjer       = enEjerIRPF;
     enEjerIRPF  = 0;

     |ABRE #dsmom073;
     #dsmom073#0 = nEjer;
     #dsmom073#1 = "";
     #dsmom073#2 = "";
     |LEE 000#dsmom073.];
     |SI FSalida = 0;
         |SI #dsmom073#0 > nEjer;
             |LEE 000#dsmom073.a;
             |SI FSalida = 0;
                 |SI #dsmom073#0 < nEjer;
                     enEjerIRPF = #dsmom073#0;
                 |FINSI;
             |FINSI;
         |SINO;
             enEjerIRPF = #dsmom073#0;
         |FINSI;
     |SINO;
         |LEE 000#dsmom073.a;
         |SI FSalida = 0;
             enEjerIRPF = #dsmom073#0;
         |FINSI;
     |FINSI;
     |CIERRA #dsmom073;
|FPRC;
