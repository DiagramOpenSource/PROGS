|FICHEROS;
     dsmom018 #18;
     dsmom019 #19;
     dsmom020 #20;
     dsmom068 #68;

     dsmom20@ #920;
|FIN;

|VARIABLES;
     aDesde    = "";
     aHasta    = "";
     aAlfa     = "";
     aAlfa1    = "";
     aAlfa2    = "";
     nNume1    = 0;
     nSalida18 = 0;
     nSalida68 = 0;
     nSalida19 = 0;

     nSw18P = 0;
     nSw18D = 0;
     nSw19P = 0;
     nSw19D = 0;

     nOk    = 0;
     aBase  = "";
     aMas   = "";
     nTecla = 0;
     nDRef  = 0;
     nHRef  = 0;

     nDesde       = 0;
     fFecha1      = @;
     fFecha2      = @;
     fDFecha      = @;
     fHFecha      = @;
     &enMasTrIRPF = 0;
     &enMasTrIVA  = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Informa;

     |PUSHV 0501 2380;
     |SI #20#1 [ 2010;
          |BLANCO 0854 2280;
          |CUADRO 0753 2380;
          |ATRI I;

          |PINTA 0854, "   DESGLOSE DE TIPOS      ";
          |SI #20#1 ] 2000;
              |PINTA 1054, "  -01- <19 a¤os/Min.33%";
          |SINO;
              |PINTA 1054, "  -01- Menores 19 a¤os ";
          |FINSI;
          |PINTA 1154, "  -02- Aprendices      ";
          |PINTA 1254, "  -03- F.Academica     ";
          |PINTA 1354, "  -04- Resto personal  ";

          |SI #20#1 ] 2000;
              |PINTA 1554, "  -05- <19 a¤os/Dis.33%";
          |SINO;
              |PINTA 1554, "  -05- Menores 19 a¤os ";
          |FINSI;
          |PINTA 1654, "  -06- Aprendices      ";
          |PINTA 1754, "  -07- F.Academica     ";
          |PINTA 1854, "  -08- Resto personal  ";
          |PINTA 2054, "  -09- Titular         ";
          |PINTA 2154, "  -10- Conyuge         ";
          |PINTA 2254, "  -11- Hijos           ";

          |ATRI R;

          |PINTA 0954, " Personal Asalariado      ";
          |PINTA 1454, " Resto Personal Asalar.   ";
          |PINTA 1954, " Personal No Asalariado   ";

          |ATRI 0;
     |SINO;

          |BLANCO 0654 2280;
          |CUADRO 0553 2380;
          |ATRI I;

          |PINTA 0654, "   DESGLOSE DE TIPOS      ";
          |PINTA 0854, "  -01- Menores 19 a¤os ";
          |PINTA 0954, "  -12- Discapacit.> 33%";
          |PINTA 1054, "  -02- Aprendices      ";
          |PINTA 1154, "  -03- F.Academica     ";
          |PINTA 1254, "  -04- Resto personal  ";

          |PINTA 1454, "  -05- Menores 19 a¤os ";
          |PINTA 1554, "  -13- Discapacit.> 33%";
          |PINTA 1654, "  -06- Aprendices      ";
          |PINTA 1754, "  -07- F.Academica     ";
          |PINTA 1854, "  -08- Resto personal  ";

          |PINTA 2054, "  -09- Titular         ";
          |PINTA 2154, "  -10- Conyuge         ";
          |PINTA 2254, "  -11- Hijos           ";

          |ATRI R;

          |PINTA 0754, " Personal Asalariado      ";
          |PINTA 1354, " Resto Personal Asalar.   ";
          |PINTA 1954, " Personal No Asalariado   ";

          |ATRI 0;
     |FINSI;

     |PAUSA;
     |POPV;
|FPRC;

|PROCESO PintaTipo;
     |SI FSalida = 10;

         |HAZ Informa;
         |ERROR;
     |SINO;
         |SI #20#1 [ 2010;
             |SI #20Campo > 11;
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;
     |HAZ PintaMinus;
|FPRC;

|PROCESO PintaMinus; |TIPO 7;
     |SI #20#5 ] 09; |Y #20#5 [ 11; |Y #20#1 ] 2011;
         aAlfa1 = "Discap.:  ";
         aAlfa2 = "S";
     |SINO;
         aAlfa1 = "          ";
         aAlfa2 = "N";
         #20#20 = " ";
         #20#21 = " ";
     |FINSI;

     |C_M #20#20,1,aAlfa2; |C_V #20#20,1,aAlfa2;
     |C_M #20#21,1,aAlfa2; |C_V #20#21,1,aAlfa2;

     |PINTA 0870, aAlfa1;  |PINTA #20#20;
     |PINTA 1470, aAlfa1;  |PINTA #20#21;
|FPRC;

|PROCESO AntesMinus; |TIPO 7;
     |C_M #20Campo, 0, aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |SI #20Campo = " ";
         #20Campo = "N"; |PINTA #20Campo;
     |FINSI;
|FPRC;

|PROCESO Tipo0C21; |TIPO 0;
    |SI Campo = 21;
        nTecla  = FSalida;
    |FINSI;
    |SI nTecla = 13;
        #20#13 = #20#8;  |PINTA #20#13;
        #20#14 = #20#9;  |PINTA #20#14;
        #20#15 = #20#10; |PINTA #20#15;
        #20#16 = #20#11; |PINTA #20#16;
        #20#17 = #20#12; |PINTA #20#17;
        #20#21 = #20#20; |PINTA #20#21;
    |FINSI;
|FPRC;

|PROCESO ParaCopiar;
    #920#13 = #920#8;
    #920#14 = #920#9;
    #920#15 = #920#10;
    #920#16 = #920#11;
    #920#17 = #920#12;
    #920#21 = #920#20;

    |GRABA 020#920a;
    |LIBERA #920;
|FPRC;

|DEFBUCLE ParaCopiar;
     #920#1005;
     ;
     #20#0, #20#1, #20#2, #20#3, nDRef;
     #20#0, #20#1, #20#2, #20#3, nHRef;
     be;
     NULL, ParaCopiar;
|FIN;

|PROCESO CopiaProv;
     |SI nTecla = 14;
         |CONFI "0000SCopiar Todos los datos Provisionales a datos Definitivos";
     |SINO;
         FSalida = 0;
     |FINSI;
     |SI FSalida = 0;
         nDRef = 001;
         nHRef = 999;
         |SI nTecla = 13;
             nDRef = #20#4;
             nDRef = #20#4;
         |FINSI;

         |BUCLE ParaCopiar;

         |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;

|PROCESO Tipo11m020;  |TIPO 11;
     nTecla = FSalida;

     |SI nTecla = 10;
         |HAZ Informa;
         |ERROR;
     |FINSI;

     |SI nTecla = 13; |O nTecla = 14;
         |HAZ CopiaProv;
     |FINSI;
|FPRC;

|PROCESO HorasTP;  |TIPO 0;
     #20#10  = #20#8 * #20#9;
     #20#12 = #20#10 / #20#11;
     |SI #20#12 > 1;  #20#12 = 1;  |FINSI;

     |PINTA #20#10;
     |PINTA #20#12;
|FPRC;

|PROCESO HorasTD;  |TIPO 0;
     nTecla = FSalida;
     |SI Campo = 13; |Y nTecla = 13;
         |HAZ Tipo0C21;
     |FINSI;

     #20#15 = #20#13 * #20#14;
     #20#17 = #20#15 / #20#16;
     |SI #20#17 > 1;  #20#17 = 1;  |FINSI;

     |PINTA #20#15;
     |PINTA #20#17;
|FPRC;

|RUTINA ClaveBaja20;
     #20#0 = enEmpresa;
     #20#1 = enEjer;
     #20#2 = enComplem;
     #20#3 = enActividad;
     #20#4 = 1;
|FRUT;

|RUTINA ClaveAlta20;
     #20#0 = enEmpresa;
     #20#1 = enEjer;
     #20#2 = enComplem;
     #20#3 = enActividad;
     #20#4 = 999;
|FRUT;

|PROCESO CalculaTrab;
     |SI #20#6 = "R";  |O #20#6 = "A";
         |SI #20#5 [ 8; |O #20#5 = 12; |O #20#5 = 13;
             |SI #20#12 ! 0;
                 #18#254 = #18#254 + 1;
             |FINSI;

             aAlfa2 = #20#7;
             |SI aAlfa2 ! aAlfa1;
                 |SI #20#5 [ 4; |O #20#5 = 12;
                     |SI #20#12 ! 0;  #18#97 = #18#97 + 1;  |FINSI;
                     |SI #20#17 ! 0;  #18#98 = #18#98 + 1;  |FINSI;
                 |FINSI;

                 |SI #20#5 > 4; |Y #20#5 ! 12;
                     |SI #20#12 ! 0;  #18#99  = #18#99  + 1;  |FINSI;
                     |SI #20#17 ! 0;  #18#100 = #18#100 + 1;  |FINSI;
                 |FINSI;

                 aAlfa1  = aAlfa2;
             |FINSI;
         |FINSI;

         |SI #20#5 = 01;  #18#81  = #18#81  + #20#12;  |FINSI;
         |SI #20#5 = 02;  #18#85  = #18#85  + #20#12;  |FINSI;
         |SI #20#5 = 03;  #18#89  = #18#89  + #20#12;  |FINSI;
         |SI #20#5 = 04;  #18#93  = #18#93  + #20#12;  |FINSI;
         |SI #20#5 = 12;  #68#4   = #68#4   + #20#12;  |FINSI;

         |SI #20#5 = 01;  #18#82  = #18#82  + #20#17;  |FINSI;
         |SI #20#5 = 02;  #18#86  = #18#86  + #20#17;  |FINSI;
         |SI #20#5 = 03;  #18#90  = #18#90  + #20#17;  |FINSI;
         |SI #20#5 = 04;  #18#94  = #18#94  + #20#17;  |FINSI;
         |SI #20#5 = 12;  #68#5   = #68#5   + #20#17;  |FINSI;

         |SI #20#5 = 05;  #18#83  = #18#83  + #20#12;  |FINSI;
         |SI #20#5 = 06;  #18#87  = #18#87  + #20#12;  |FINSI;
         |SI #20#5 = 07;  #18#91  = #18#91  + #20#12;  |FINSI;
         |SI #20#5 = 08;  #18#95  = #18#95  + #20#12;  |FINSI;
         |SI #20#5 = 13;  #68#6   = #68#6   + #20#12;  |FINSI;

         |SI #20#5 = 05;  #18#84  = #18#84  + #20#17;  |FINSI;
         |SI #20#5 = 06;  #18#88  = #18#88  + #20#17;  |FINSI;
         |SI #20#5 = 07;  #18#92  = #18#92  + #20#17;  |FINSI;
         |SI #20#5 = 08;  #18#96  = #18#96  + #20#17;  |FINSI;
         |SI #20#5 = 13;  #68#7   = #68#7   + #20#17;  |FINSI;

         |SI #20#5 = 09; ||Tique 2329_984
             nNume1 = #20#12;
             |SI #20#12 ! 0;
                 |SI nSw18P ! 0;
                     |SI #68#8 = "S"; |Y nSw18P = 1;
                         #18#101 = #18#101 % 75;
                     |FINSI;
                     |SI #20#20 = "S";   #20#12 = #20#12 % 75; |FINSI;
                 |FINSI;
                 nSw18P = nSw18P + 1;
             |FINSI;
             #18#101 =#18#101 + #20#12;
             #20#12 = nNume1;
         |FINSI;

         |SI #20#5 = 10;  #18#103 = #18#103 + #20#12;  |FINSI;
         |SI #20#5 = 11;
             |SI #20#20 = "N"; #18#105 = #18#105 + #20#12;  |FINSI;
             |SI #20#20 = "S"; #68#16  = #68#16  + #20#12;  |FINSI;
         |FINSI;
         |SI #20#5 = 09;
             nNume1 = #20#17;
             |SI #20#17 ! 0;
                 |SI nSw18D ! 0;
                     |SI #68#9  = "S"; |Y nSw18D = 1;
                         #18#102 = #18#102 % 75;
                     |FINSI;
                     |SI #20#21 = "S";   #20#17 = #20#17 % 75; |FINSI;
                 |FINSI;
                 nSw18D = nSw18D + 1;
             |FINSI;
             #18#102 = #18#102 + #20#17;
             #20#17  = nNume1;
         |FINSI;
         |SI #20#5 = 10;  #18#104 = #18#104 + #20#17;  |FINSI;
         |SI #20#5 = 11;
             |SI #20#21 = "N"; #18#106 = #18#106 + #20#17;  |FINSI;
             |SI #20#21 = "S"; #68#17  = #68#17  + #20#17;  |FINSI;
         |FINSI;
         |SI #20#5 = 09;  #68#8  = #20#20; #68#9  = #20#21; |FINSI;
         |SI #20#5 = 10;  #68#14 = #20#20; #68#15 = #20#21; |FINSI;
         |SI nSw18P > 1; #68#8 = "N"; |FINSI;
         |SI nSw18D > 1; #68#9 = "N"; |FINSI;
     |FINSI;

     |SI #20#6 = "I";  |O #20#6 = "A";
         |SI #20#5 = 01;  #19#81  = #19#81  + #20#12;  |FINSI;
         |SI #20#5 = 02;  #19#85  = #19#85  + #20#12;  |FINSI;
         |SI #20#5 = 03;  #19#89  = #19#89  + #20#12;  |FINSI;
         |SI #20#5 = 04;  #19#93  = #19#93  + #20#12;  |FINSI;
         |SI #20#5 = 12;  #19#154 = #19#154 + #20#12;  |FINSI;

         |SI #20#5 = 01;  #19#82  = #19#82  + #20#17;  |FINSI;
         |SI #20#5 = 02;  #19#86  = #19#86  + #20#17;  |FINSI;
         |SI #20#5 = 03;  #19#90  = #19#90  + #20#17;  |FINSI;
         |SI #20#5 = 04;  #19#94  = #19#94  + #20#17;  |FINSI;
         |SI #20#5 = 12;  #19#155 = #19#155 + #20#17;  |FINSI;

         |SI #20#5 = 05;  #19#83  = #19#83  + #20#12;  |FINSI;
         |SI #20#5 = 06;  #19#87  = #19#87  + #20#12;  |FINSI;
         |SI #20#5 = 07;  #19#91  = #19#91  + #20#12;  |FINSI;
         |SI #20#5 = 08;  #19#95  = #19#95  + #20#12;  |FINSI;
         |SI #20#5 = 13;  #19#156 = #19#156 + #20#12;  |FINSI;

         |SI #20#5 = 05;  #19#84  = #19#84  + #20#17;  |FINSI;
         |SI #20#5 = 06;  #19#88  = #19#88  + #20#17;  |FINSI;
         |SI #20#5 = 07;  #19#92  = #19#92  + #20#17;  |FINSI;
         |SI #20#5 = 08;  #19#96  = #19#96  + #20#17;  |FINSI;
         |SI #20#5 = 13;  #19#157 = #19#157 + #20#17;  |FINSI;

         |SI #20#5 = 09; ||Tique 2329_984
             nNume1 = #20#12;
             |SI #20#12 ! 0;
                 |SI nSw19P ! 0;
                     |SI #19#158 = "S"; |Y nSw19P = 1;
                         #19#101 = #19#101 % 75;
                     |FINSI;
                     |SI #20#20 = "S"; #20#12 = #20#12 % 75; |FINSI;
                 |FINSI;
                 nSw19P = nSw19P + 1;
             |FINSI;
             #19#101 = #19#101 + #20#12;
             #20#12  = nNume1;
         |FINSI;

         |SI #20#5 = 10;  #19#103 = #19#103 + #20#12;  |FINSI;
         |SI #20#5 = 11;
             |SI #20#20 = "N";  #19#105 = #19#105 + #20#12;  |FINSI;
             |SI #20#20 = "S";  #19#172 = #19#172 + #20#12;  |FINSI;
         |FINSI;
         |SI #20#5 = 09;
             nNume1 = #20#17;
             |SI #20#17 ! 0;
                 |SI nSw19D ! 0;
                     |SI #19#159 = "S"; |Y nSw19D = 1;
                         #19#102 = #19#102 % 75;
                     |FINSI;
                     |SI #20#21 = "S"; #20#17 = #20#17 % 75; |FINSI;
                 |FINSI;
                 nSw19D = nSw19D + 1;
             |FINSI;
             #19#102 = #19#102 + #20#17;
             #20#17  = nNume1;
         |FINSI;
         |SI #20#5 = 10;  #19#104 = #19#104 + #20#17;  |FINSI;
         |SI #20#5 = 11;
             |SI #20#20 = "N";  #19#106 = #19#106 + #20#17;  |FINSI;
             |SI #20#21 = "S";  #19#173 = #19#173 + #20#17;  |FINSI;
         |FINSI;

         |SI #20#5 = 09;  #19#158 = #20#20; #19#159 = #20#21; |FINSI;
         |SI #20#5 = 10;  #19#170 = #20#20; #19#171 = #20#21; |FINSI;
         |SI nSw19P > 1; #19#158 = "N"; |FINSI;
         |SI nSw19D > 1; #19#159 = "N"; |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom020;
  #20#2;
  ;
  enEmpresa, enEjer, enComplem, enActividad, aDesde, 000;
  enEmpresa, enEjer, enComplem, enActividad, aHasta, 999;
  ;
  NULL, CalculaTrab;
|FIN;
|| ///////////////////////////////

|PROCESO LeoEspejo;
  |SI #dsmom20@#5 ! 9; |Y #dsmom20@#5 ! 10; |Y #dsmom20@#5 ! 11;

      |SI #dsmom20@#18 < fFecha1; #dsmom20@#18 = fFecha1; |FINSI;
      |SI #dsmom20@#19 < "01.01.1900"; |O #dsmom20@#19 > fFecha2;
          #dsmom20@#19 = fFecha2;
      |FINSI;

      |SI #dsmom20@#18 > fHFecha;  |ACABA;  |FINSI;
      |SI #dsmom20@#19 < fDFecha;  |ACABA;  |FINSI;

      |SI #dsmom20@#6 = "R";  |O #dsmom20@#6 = "A";
          enMasTrIRPF = 1;
      |FINSI;
      |SI #dsmom20@#6 = "I";  |O #dsmom20@#6 = "A";
          enMasTrIVA  = 1;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE LeoEspejo;
  #dsmom20@#1005;
  ;
  enEmpresa, enEjer, enComplem, enActividad, nDesde;
  enEmpresa, enEjer, enComplem, enActividad, 999;
  ;
  NULL, LeoEspejo;
|FIN;

|PROCESO CalculaTrab_Mas;

  |SI #20#5 ! 9; |Y #20#5 ! 10; |Y #20#5 ! 11;

      nDesde  = #20#4 + 1;

      fDFecha = #20#18;
      |SI fDFecha < fFecha1;  fDFecha = fFecha1; |FINSI;
      |SI fDFecha > fFecha2;  |ACABA;            |FINSI;

      fHFecha = #20#19;
      |SI fHFecha < "01.01.1900"; fHFecha = fFecha2; |FINSI;
      |SI fHFecha < fFecha1;      |ACABA;            |FINSI;

      |BUCLE LeoEspejo;

      |SI enMasTrIRPF = 1; |Y enMasTrIVA  = 1;
          |ERROR10;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE dsmom020_Mas;
  #20#1;
  ;
  enEmpresa, enEjer, enComplem, enActividad, 000;
  enEmpresa, enEjer, enComplem, enActividad, 999;
  ;
  NULL, CalculaTrab_Mas;
|FIN;

|PROCESO NContarTraba;
     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsmom020.mas";
     |CARGA_DEF aMas, dsmom20@;
     |SI FSalida ! 0;
         |MENAV "0000Error Cargando Def dsmom020";
         |ACABA;
     |FINSI;

     aAlfa = enEjer; aAlfa = "01.01." + aAlfa; fFecha1 = aAlfa;
     aAlfa = enEjer; aAlfa = "31.12." + aAlfa; fFecha2 = aAlfa;
     enMasTrIRPF = 0;
     enMasTrIVA  = 0;
     |BUCLE dsmom020_Mas;

     |DESCARGA_DEF #dsmom20@;
|FPRC;

|PROGRAMA;
      |SI eaDesTrab = "N";  |ACABA;  |FINSI;

      |SI enNoLineal = 0;

          |DBASE aBase;  |QBF aBase;
          aMas = aBase + "def/dsmom020.mas";
          |CARGA_DEF aMas, dsmom20@;
          |SI FSalida ! 0;
              |MENAV "0000Error Cargando Def dsmom020";
              |ACABA;
          |FINSI;

          |ENTLINEAL #1#20, -5, 2, 22, 1, ClaveBaja20, ClaveAlta20;

          |DESCARGA_DEF #dsmom20@;
      |FINSI;

      |HAZ NContarTraba;
      |SI enNoLineal = 2; |ACABA; |FINSI;

      aDesde = " " * 40;
      aHasta = "z" * 40;

      enEntradaMod = 2;
      |SUB_EJECUTA "dsmom018";
      |SUB_EJECUTA "dsmom019";

      |ABRE #18;
      #18#0 = enEmpresa;
      #18#1 = enEjer;
      #18#2 = enComplem;
      #18#3 = enActividad;
      |LEE 101#18=;
      nSalida18 = FSalida;

      |ABRE #68;
      |SI enEjer ] 2011;
          #68#0 = enEmpresa;
          #68#1 = enEjer;
          #68#2 = enComplem;
          #68#3 = enActividad;
          |LEE 101#68=;
          nSalida68 = FSalida;
      |FINSI;

      |ABRE #19;
      #19#0 = enEmpresa;
      #19#1 = enEjer;
      #19#2 = enComplem;
      #19#3 = enActividad;
      |LEE 101#19=;
      nSalida19 = FSalida;

      |PDEFECTO #18,  81, 107;
      |PDEFECTO #68,   4,  10;
      |PDEFECTO #68,  14,  18;
      |PDEFECTO #19,  81, 107;
      |PDEFECTO #19, 154, 160;
      |PDEFECTO #19, 170, 174;
      #18#254 = 0;

      aAlfa1  = "";
      aAlfa2  = "";
      nSw18P = 0; nSw18D = 0;
      nSw19P = 0; nSw19D = 0;
      |BUCLE dsmom020;

      |SI nSalida18 = 0;  |GRABA 020#18a;  |FINSI;
      |SI nSalida19 = 0;  |GRABA 020#19a;  |FINSI;
      |SI enEjer ] 2011;
          |SI nSalida18 = 0;
              |SI nSalida68 = 0;  |GRABA 020#68a;  |FINSI;
              |SI nSalida68 ! 0;
                  |GRABA 020#68n;
              |FINSI;
          |FINSI;
      |FINSI;

      |LIBERA #18;
      |CIERRA #18;

      |LIBERA #19;
      |CIERRA #19;

      |LIBERA #68;
      |CIERRA #68;

      enEntradaMod = 1;
      |SUB_EJECUTA "dsmom018";
      |SUB_EJECUTA "dsmom019";

      enEntradaMod = 0;
|FPRO;
