|FICHEROS;
     dsmom023 #23;
     dsmom024 #24,MANTE;

     dsmom003 #3;
     dsmom004 #4;
     :/basica/def/agitab99 #99;
     dsmor023 #223;
|FIN;

|VARIABLES;
     &enAnyPase  = 0;
     &enTodo     = 0;
     aEsc         = "";
     nTecla       = 0;
     nSalir       = 0;
     nAlta        = 0;
     nEntrada     = 0;
     nModoEntrada = 0;
     aAlfa        = "";
     aAlfa1       = "";
     aPathModelo  = "";
     aDef         = "";
     nSwAnual     = 0;
     nAny         = 0;

     nImporte     = 0;
     nImpBueno    = 0;
     nNume1       = 0;
     fFecha       = @;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_modhis;

|| *************************************************************************
|| ************ PROCESOS DEL M24
|| *************************************************************************
|CALCULO Tipo3m024; |TIPO 3;

  aAlfa1 = #24#3; |QBF aAlfa1;
  aAlfa1 = aAlfa1 % 101;
  |SI #24#9 ! 0;
      #24#8 = #24#9;
  |SINO;
      #24#8 = -(#24#10 + #24#11);
  |FINSI;
  |SI aAlfa1 ! "3";
      #24#13 = #24#8;
      #24#14 = 0;
      #24#15 = 0;
      #24#16 = 0;
      #24#17 = 0;
  |FINSI;
|FCAL;

|CALCULO Tipo0m024; |TIPO 0;
  nSwAnual = 0;
  |SI #24#3 ] 100; |Y #24#3 [ 105;
       nSwAnual = 1;
  |FINSI;
  |SI #24#3 ] 200; |Y #24#3 [ 201;
       nSwAnual = 1;
  |FINSI;
  |SI nSwAnual = 1;
      |SI #24#2 ! 99; |ERROR; |ACABA; |FINSI;
  |SINO;
      |SI #24#2 < 1; |O #24#2 > 12; |ERROR; |ACABA; |FINSI;
  |FINSI;

  |SI #24#2 = 1;   #24#12 = "ENERO     ";  |FINSI;
  |SI #24#2 = 2;   #24#12 = "FEBRERO   ";  |FINSI;
  |SI #24#2 = 3;   #24#12 = "MARZO     ";  |FINSI;
  |SI #24#2 = 4;   #24#12 = "ABRIL     ";  |FINSI;
  |SI #24#2 = 5;   #24#12 = "MAYO      ";  |FINSI;
  |SI #24#2 = 6;   #24#12 = "JUNIO     ";  |FINSI;
  |SI #24#2 = 7;   #24#12 = "JULIO     ";  |FINSI;
  |SI #24#2 = 8;   #24#12 = "AGOSTO    ";  |FINSI;
  |SI #24#2 = 9;   #24#12 = "SEPTIEMBRE";  |FINSI;
  |SI #24#2 = 10;  #24#12 = "OCTUBRE   ";  |FINSI;
  |SI #24#2 = 11;  #24#12 = "NOVIEMBRE ";  |FINSI;
  |SI #24#2 = 12;  #24#12 = "DICIEMBRE ";  |FINSI;
  |SI #24#2 = 99;  #24#12 = "ANUAL     ";  |FINSI;

  |PINTA #24#12;
|FCAL;

|CALCULO Tipo7m024; |TIPO 7;
 aAlfa1 = #24#3; |QBF aAlfa1;
 aAlfa1 = aAlfa1 % 101;
 |SI aAlfa1 ! "3";
     |C_M #24#11,1,"N";
     |HAZ PintaNo3;
 |SINO;
     |C_M #24#11,1,"S";
     |C_M #24#13,1,"S"; |C_V #24#13,1,"S";
     |C_M #24#14,1,"S"; |C_V #24#14,1,"S";
     |C_M #24#15,1,"S"; |C_V #24#15,1,"S";
     |C_M #24#16,1,"S"; |C_V #24#16,1,"S";
     |C_M #24#17,1,"S"; |C_V #24#17,1,"S";

     |CUADRO 0556 1080;
     |ATRI P;
     |PINTA 0557, "Devengado  ";
     |PINTA 0657, "Deducible  ";
     |PINTA 0757, "Diferencia ";
     |PINTA 0857, "Compensado ";
     |PINTA 0957, "General    ";
     |ATRI 0;
     |PINTA #24#14;
     |PINTA #24#15;
     |PINTA #24#13;
     |PINTA #24#16;
     |PINTA #24#17;
     |ATRI R; |PINTA 1056, "e"; |ATRI 0;
 |FINSI;
|FCAL;

|PROCESO PintaNo3;
     |C_M #24#13,1,"N";|C_V #24#13,1,"N";
     |C_M #24#14,1,"N";|C_V #24#14,1,"N";
     |C_M #24#15,1,"N";|C_V #24#15,1,"N";
     |C_M #24#16,1,"N";|C_V #24#16,1,"N";
     |C_M #24#17,1,"N";|C_V #24#17,1,"N";
     |PINTA 0
     |PINTA 0556, "                          ";
     |PINTA 0656, "                          ";
     |PINTA 0756, "                          ";
     |PINTA 0856, "                          ";
     |PINTA 0956, "                          ";
     |PINTA 1056, "                          ";
     |PINTA #23#3;
     |ATRI R; |PINTA 0958, "RESULTADO"; |ATRI 0;
     |ATRI R; |PINTA 1055, "ver  A Compensar  "; |ATRI 0;
     aAlfa1 = &179; |PINTA 1059, aAlfa1;
     aAlfa1 = &187; |PINTA 1072, aAlfa1;
|FPRC;

|CALCULO Tipo1m024; |TIPO 1;
 nEntrada = (FEntrada / 100)! 0;
 || ... |SI nEntrada ! 2; |ERROR; |FINSI;
|FCAL;

|CALCULO Tipo2m024; |TIPO 2;
 #23#4 = #23#4 +. #24#9;
 #23#5 = #23#5 +. #24#10;
 #23#6 = #23#4 - #23#5;

 |PINTA #23#4;
 |PINTA #23#5;
 |PINTA #23#6;
|FCAL;

|CALCULO ingresar; |TIPO 0;
|FCAL;

|CALCULO devolver; |TIPO 0;
 |SI #24#9 ! 0;
     #24#10 = 0; |PINTA #24#10;
 |FINSI;
|FCAL;

|CALCULO compensar; |TIPO 0;
 |SI #24#9 ! 0; |O #24#10 ! 0;
     #24#11 = 0; |PINTA #24#11;
 |FINSI;
|FCAL;

|CALCULO ElReal; |TIPO 7;
 |C_M #24#13,0,aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;
 #24#13 = #24#14 - #24#15; |PINTA #24#13;
 #24#17 = #24#13 - #24#16; |PINTA #24#17;
 |HAZ el34_0;
|FCAL;

|CALCULO ElReal_0; |TIPO 0;
 |C_M #24#13,0,aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;
 #24#17 = #24#13 - #24#16; |PINTA #24#17;
 |HAZ el34_0;
|FCAL;

|CALCULO el34_0; |TIPO 0;
 |C_M #24#17,0,aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;
 |SI #24#17 < 0;
     #24#9  = 0;
     #24#10 = 0;
     #24#11 = -#24#17;
 |SINO;
     #24#9  = #24#17;
     #24#10 = 0;
     #24#11 = 0;
 |FINSI;
 |PINTA #24#9;
 |PINTA #24#10;
 |PINTA #24#11;
|FCAL;

|| =========================================================================
|| =========================================================================
|| =========================================================================
|| ... Crear
|PROCESO Crear24;
    enModelo = #4#3;

    #3#0 = #4#0;
    #3#1 = #4#1;
    #3#2 = #4#2;
    |LEE 001#3=;
    |SI FSalida ! 0;    |DDEFECTO #3;  |FINSI;

     #24#0 = #4#0;
     #24#1 = #4#1;
     #24#2 = #4#2;
     #24#3 = #4#3;
     #24#4 = #4#4;
     |LEE 141#24=;
     |SI FSalida ! 0;
         |DDEFECTO #24;
         #24#0  = #4#0;
         #24#1  = #4#1;
         #24#2  = #4#2;
         #24#3  = #4#3;
         #24#4  = #4#4;
         #24#12 = #3#3;
         |GRABA 020#24b;
     |FINSI;

     #24#6 = #4#7;   ||Entrada
     #24#7 = #4#8;   ||Fecha Entrada
     #24#8 = #4#15;  ||Resultado
     |SI #24#8 ] 0;
         #24#9 = #24#8;
         #24#10 = 0;
         #24#11 = 0;
     |SINO;
         #24#9  = 0;
         aAlfa = #4#16; |QBF aAlfa;
         |SI aAlfa ! "";
             #24#11 = - #24#8;
             #24#10 = 0;
         |SINO;
             #24#10 = - #24#8;
             #24#11 = 0;
         |FINSI;
     |FINSI;
     #24#13 = #24#8;
     aAlfa = #24#3; aAlfa = aAlfa % 101;
     |SI aAlfa = 3;
         enEmpresa = #24#0;
         enEjer    = #24#1;
         enPeriodo = #24#2;
         enComplem = #24#4;
         |HAZ eLeoImpReal;
         #24#9  = enIngresar;
         #24#10 = enDevolver;
         #24#11 = enCompensar;
         #24#13 = enImpReal;
         #24#14 = enCas21;
         #24#15 = enCas27;
         #24#16 = enCas31;
         #24#17 = enCas34;
     |FINSI;
     |GRABA 020#24a;
     |LIBERA #24;
     #23#4 = #23#4 + #24#9;
     #23#5 = #23#5 + #24#10;
     #23#6 = #23#4 - #23#5;
|FPRC;

|DEFBUCLE dsmom004;
 #4#1;
 ;
 #23#0, #23#1, 00, #23#2, 00;
 #23#0, #23#1, 99, #23#2, 99;
 e;
 NULL, Crear24;
|FIN;

|| ... Borrar
|PROCESO Borra24;
 |BORRA 020#24a;
|FPRC;

|DEFBUCLE Borra24;
 #24#1;
 ;
 #23#0, #23#1, 00, #23#2, 00;
 #23#0, #23#1, 99, #23#2, 99;
 e;
 NULL, Borra24;
|FIN;


|| ////////////////////////////////////////////////////////
|CALCULO Tipo11m023;  |TIPO 11;
 nTecla = FSalida;
 |SI nTecla = 10;
     nAny = #23#1;
     |HAZ PantallaTotal;
     |ERROR;
 |FINSI;
|FCAL;

|CALCULO LaClave1;
 #23#0 = enEmpresa;
|FCAL;

|CALCULO LaClave2;
   nModoEntrada = (FEntrada / 100) ! 0;

   enModelo = #23#2;
   |ABRE #99;
   #99#0 = #23#2;
   |LEE 040#99=;
   |SI FSalida ! 0;
       |MENAV "    No existe Modelo ";
       |ERROR;
       |CIERRA #99;
       |ACABA;
   |FINSI;
   |CIERRA #99;

   |HAZ SelModelo;
   |SI nSwModHis = 0;
       |MENAV "    Modelo no Correcto ";
       |ERROR;
       |ACABA;
   |FINSI;

   #23#3 = #99#1;
   |SI nModoEntrada = 1;

       #23#4 = 0;
       #23#5 = 0;
       #23#6 = 0;
       |BUCLE Borra24;

       nSwAnual = 0;
       |SI #23#2 ] 100; |Y #23#2 [ 105;
           nSwAnual = 1;
       |FINSI;
       |SI #23#2 ] 200; |Y #23#2 [ 201;
           nSwAnual = 1;
       |FINSI;
       |SI #23#2 = 225;
           nSwAnual = 1;
       |FINSI;


       |SI nSwAnual = 0;
           |ABRE #24;
           |ABRE #3;
           |BUCLE dsmom004;
           |CIERRA #3;
           |CIERRA #24;
       |SINO;
           |ABRE #24;
           |DDEFECTO #24;
           #24#0 = #23#0;
           #24#1 = #23#1;
           #24#2 = 99;
           #24#3 = #23#2;
           #24#4 = 0;
           #24#12 = "ANUAL";
           |GRABA 020#24c;
           |CIERRA #24;
       |FINSI;
       |SI #23#2 ] 200; |Y #23#2 [ 225;
           enTodo = 5;
           |SI #23#2 = 202;
               enTodo = 6;
           |FINSI;
           enEmpresa = #23#0;
           enAnyPase = #23#1;
           |SUB_EJECUTA_NP "dsmoz008";
       |FINSI;
   |FINSI;
|FCAL;


|CALCULO Tipo1m023;  |TIPO 1;

  nModoEntrada = (FEntrada / 100) ! 0;
  |SI nModoEntrada =  3;
      |CONFI "    NConfirmacion Baja (S/N)";
      |SI FSalida = 0;
          |BUCLE Borra24;
      |SINO;
          |ERROR;
      |FINSI;
  |FINSI;
|FCAL;

|RUTINA ClaveBaja24;
     #24#0 = #23#0;
     #24#1 = #23#1;
     #24#2 = 00;
     #24#3 = #23#2;
     #24#4 = 00;
|FRUT;

|RUTINA ClaveAlta24;
     #24#0 = #23#0;
     #24#1 = #23#1;
     #24#2 = 99;
     #24#3 = #23#2;
     #24#4 = 99;
|FRUT;

|PROCESO Tipo3m023;  |TIPO 3;
     |ENTLINEAL #1#24, -3, 2, 20, 0, ClaveBaja24, ClaveAlta24;
     |HAZ PintaNo3;
|FPRC;

|PROCESO Tipo7m023;  |TIPO 7;

     |ENTLINEAL #1#24, -3, 7, 20, 0, ClaveBaja24, ClaveAlta24;

|FPRC;

|RUTINA ClaveBaja23;
     |SI FSalida = "POSICION";
         #23#1 = nNume1;
     |SINO;
         #23#0 = enEmpresa;
         #23#1 = 9999;
         #23#2 = 000;
     |FINSI;
|FRUT;

|RUTINA ClaveAlta23;
     #23#0 = enEmpresa;
     #23#1 = 0000;
     #23#2 = 999;
|FRUT;


|PROGRAMA;
     fFecha = ~;
     aAlfa1 = fFecha; aAlfa1 = aAlfa1 % -104;
     nNume1 = aAlfa1; nNume1 = nNume1 - 1;
     |ENTLINEAL #3#23, -2, 2, 22, 1, ClaveBaja23, ClaveAlta23;
|FPRO;

|| *************************************************************************
|| ************ Proceso Pantalla de Total
|| *************************************************************************
|PROCESO SumoTotal;
 nImporte = nImporte + #223#6;
|FPRC;

|DEFBUCLE SumoImporte;
 #223#1;
 ;
 enEmpresa, nAny, 000;
 enEmpresa, nAny, 999;
 ;
 NULL, SumoTotal;
|FIN;

|RUTINA ClaveBaja223;
     #223#0 = enEmpresa;
     #223#1 = nAny;
     #223#2 = 000;
|FRUT;

|RUTINA ClaveAlta223;
     #223#0 = enEmpresa;
     #223#1 = nAny;
     #223#2 = 999;
|FRUT;

|PROCESO PantallaTotal;
  nImporte = 0;
  |BUCLE SumoImporte;
  nImpBueno = #23#6;
  #23#6 = nImporte;
  |C_P #23#6,1,2267;

  |PUSHV 0914 2480;
  |PINPA #0#223;
  |PINTA #23#6;
  |ENTLINEAL #1#223, -3, 4, 20, 0, ClaveBaja223, ClaveAlta223;
  |POPV;
  #23#6 = nImpBueno;
  |C_P #23#6,1,2360;
|FPRC;
