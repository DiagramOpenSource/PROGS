|FICHEROS;
     dsmoz021 #0;
     dsmom004 #4;
     dsmom101 #101;
     dsmom102 #102;
     dsmod309 #309;
     :/contasoc/def/isacceso #200;
     :/contasoc/def/isom9000 #202;

     :/basica/def/agitab99 #99;

     dsmow137 #999;

     &clientes@ #715;
|FIN;

|VARIABLES;
     aRuta      = "";
     aFicRes    = "";
     aCR        = "";
     aLF        = "";
     aBusco     = "";
     aEjercicio = "";
     aDni       = "";
     aJusti     = "";
     aElect     = "";
     aPathBase  = "";
     aIPRemoto  = "";
     aNumeros   = "";
     aCarac    = "";

     nChequeo   = 0;
     nAnyo      = 0;
     nMes       = 0;
     nCarac     = 0;
     nModelo    = 0;
     nHandle    = 0;
     nEjercicio = 0;
     nPeriodo   = 0;
     nJusti     = 0;

     &enPeriodo = 0;
     &enEjer    = 0;
|FIN;

|INCLUYE i_varemi;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO Modelo;
     |SI eaParametro = "311";  |O eaParametro = "311C";
      |O eaParametro = "371";  |O eaParametro = "371C";
         |ACABA;
     |FINSI;

     |ABRE #99;
     #99#0 = #0#0;
     |LEE 040#99=;
     |SI FSalida ! 0;  |DDEFECTO #99;  |FINSI;
     |CIERRA #99;

     |SI #99#4 = "N";
         |SI #99#0 ! 180;  |Y #99#0 ! 190;  |Y #99#0 ! 390;  |Y #99#0 ! 193;
          |Y #99#0 ! 184;  |Y #99#0 ! 296;  |Y #99#0 ! 187;
          |Y #99#0 ! 200;  |Y #99#0 ! 202;
             |MENAV "     Modelo sin Activar.";
             |ERROR;
         |FINSI;
     |FINSI;

     #0#4 = 0;
     |SI #0#0 = 180;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 184;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 187;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 190;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 193;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 296;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 390;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 392;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 347;  #0#4 = 99;  |FINSI;
     |SI #0#0 = 200;  #0#4 = 99;  |FINSI;

     |SI #0#4 = 99;
         |C_M #0#4, 1, "N";
         |PINTA #0#4;
         |HAZ Periodo;
     |SINO;
         fFecha = ~;
         aAlfa  = fFecha % 402;   nMes  = aAlfa;
         aAlfa  = fFecha % -104;  nAnyo = aAlfa;

         |SI #0#0 = 202;
             #0#4 = 1;
             #0#6 = nAnyo - 1;
             |HAZ Periodo;
             |PINTA #0#4;
             |PINTA #0#6;
             |ACABA;
         |FINSI;

         |SI #99#5 = "T";  |O #99#5 = "C";
             |SI nMes [ 3;
                 #0#4 = 4;
                 #0#6 = nAnyo - 1;
                 |HAZ Periodo;
                 |PINTA #0#4;
                 |PINTA #0#6;
                 |ACABA;
             |FINSI;

             |SI nMes [ 6;
                 #0#4 = 3;
                 #0#6 = nAnyo;
                 |HAZ Periodo;
                 |PINTA #0#4;
                 |PINTA #0#6;
                 |ACABA;
             |FINSI;

             |SI nMes [ 9;
                 #0#4 = 6;
                 #0#6 = nAnyo;
                 |HAZ Periodo;
                 |PINTA #0#4;
                 |PINTA #0#6;
                 |ACABA;
             |FINSI;

             |SI nMes [ 12;
                 #0#4 = 9;
                 #0#6 = nAnyo;
                 |HAZ Periodo;
                 |PINTA #0#4;
                 |PINTA #0#6;
                 |ACABA;
             |FINSI;
         |FINSI;

         |SI #99#5 = "A";
             #0#4 = 99;
             #0#6 = nAnyo - 1;
             |HAZ Periodo;
             |PINTA #0#4;
             |PINTA #0#6;
         |FINSI;

         |SI #99#5 = "M";
             |SI nMes = 1;
                 #0#4 = 12;
                 #0#6 = nAnyo - 1;
                 |HAZ Periodo;
             |SINO;
                 #0#4 = nMes - 1;
                 #0#6 = nAnyo;
                 |HAZ Periodo;
             |FINSI;
             |PINTA #0#4;
             |PINTA #0#6;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Periodo;
     |SI #0#4 = 1;   #0#5 = "ENERO     ";  |FINSI;
     |SI #0#4 = 2;   #0#5 = "FEBRERO   ";  |FINSI;
     |SI #0#4 = 3;   #0#5 = "MARZO     ";  |FINSI;
     |SI #0#4 = 4;   #0#5 = "ABRIL     ";  |FINSI;
     |SI #0#4 = 5;   #0#5 = "MAYO      ";  |FINSI;
     |SI #0#4 = 6;   #0#5 = "JUNIO     ";  |FINSI;
     |SI #0#4 = 7;   #0#5 = "JULIO     ";  |FINSI;
     |SI #0#4 = 8;   #0#5 = "AGOSTO    ";  |FINSI;
     |SI #0#4 = 9;   #0#5 = "SEPTIEMBRE";  |FINSI;
     |SI #0#4 = 10;  #0#5 = "OCTUBRE   ";  |FINSI;
     |SI #0#4 = 11;  #0#5 = "NOVIEMBRE ";  |FINSI;
     |SI #0#4 = 12;  #0#5 = "DICIEMBRE ";  |FINSI;
     |SI #0#4 = 99;  #0#5 = "ANUAL     ";  |FINSI;

     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#6   = aAlfa;

     |SI #0#0 = 202;
         |SI #0#4 = 1;   #0#5 = "1-PERIODO ";  |FINSI;
         |SI #0#4 = 2;   #0#5 = "2-PERIODO ";  |FINSI;
         |SI #0#4 = 3;   #0#5 = "3-PERIODO ";  |FINSI;
         |SI #0#4 ] 4;
             |MENAV "0000Periodo incorrecto. Del 1 al 3";
             |ERROR;
         |FINSI;
     |FINSI;

     |PINTA #0#5;
     |PINTA #0#6;
|FPRC;

|PROCESO Planillas;
     |C_M #0#36, 1, "S";

     #0#10 = 1;      |PINTA #0#10;  |C_M #0#10, 1, "N";
     #0#11 = 99999;  |PINTA #0#11;  |C_M #0#11, 1, "N";
     |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
          |C_M #0nCampo, 1, "N";
     |SIGUE;
|FPRC;

|PROCESO Parrilla;
     #0#10 = 1;      |PINTA #0#10;  |C_M #0#10, 1, "N";
     #0#11 = 99999;  |PINTA #0#11;  |C_M #0#11, 1, "N";
     #0#36 = 0;  |PINTA #0#36;  |C_M #0#36, 1, "N";
     |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
          |C_M #0nCampo, 1, "S";
     |SIGUE;
|FPRC;

|PROCESO DesdeHasta;
     |C_M #0#10, 1, "S";
     |C_M #0#11, 1, "S";
     #0#36 = 0;  |PINTA #0#36;  |C_M #0#36, 1, "N";

     |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "N";
           #0nCampo = 0;  |PINTA #0nCampo;
     |SIGUE;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO BotonParrilla;
     |SI #0#0 = 202;
         |SI #0#6 [ 2009;
             |MENAV "0000Este modelo a partir del 2010.";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |CONTROL_SIMPLE 0, "LBOTON,F2 Seleccion Empresas Desde-Hasta", 2007, 2039, Boton1;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3 Seleccion Empresas Parrilla   ", 2107, 2139, Boton2;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F4 Seleccion por Planillas       ", 2207, 2239, Boton3;
     nBoton3 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  |HAZ DesdeHasta;  |SAL;  |FINSI;
         |SI aTecla = aF3;  |HAZ Parrilla;    |SAL;  |FINSI;
         |SI aTecla = aF4;  |HAZ Planillas;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;

     |PULSATECLA;
|FPRC;

|PROCESO MiraPlanilla;  |TIPO 0;
     |SI #0#36 = 0;  |ACABA;  |FINSI;

     |ABRE #101;
     #101#0 = #0#36;
     |LEE 040#101=;
     |SI FSalida ! 0;
         |MENAV "     Registro de Planilla Inexistente.";
         |ERROR;
     |FINSI;
     |CIERRA #101;
|FPRC;

|PROCESO GrabaTempo;
     nSwEsta = 1;

     |SI #0#36 ! 0;
         nSwEsta = 0;
         |ABRE #102;
         #102#0 = #0#36;
         #102#1 = #4#0;
         |LEE 040#102=;
         |SI FSalida = 0;
             nSwEsta = 1;
         |FINSI;
         |CIERRA #102;
     |FINSI;

     |SI #0#12 ! 0;
         nSwEsta = 0;
         |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo = #4#0;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;  |ACABA;  |FINSI;

     enCodCli = #4#0;
     |HAZ LeePersona;

     #999#0  = #4#0;
     #999#1  = #4#1;
     #999#2  = #4#2;
     #999#3  = #4#3;
     #999#4  = #4#4;
     #999#5  = 0;
     #999#6  = 0;
     #999#7  = #715#1;
     #999#8  = #4#19;
     #999#19 = #4#25;

     |SI enSwDeDonde = 1;
         #999#9  = #715#3;
     |SINO;
         #999#9  = #715#13;
     |FINSI;

     |GRABA 020#999n;
     |LIBERA #999;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE dsmom004;
     #4#1;
     7, 9;
     #0#10, #0#6, #0#4, #0#0, 00, "X", "X";
     #0#11, #0#6, #0#4, #0#0, 99, "X", "X";
     ;
     NULL, GrabaTempo;
|FIN;

|PROCESO GrabaTempo309;
     nSwEsta = 1;

     |SI #0#36 ! 0;
         nSwEsta = 0;
         |ABRE #102;
         #102#0 = #0#36;
         #102#1 = #309#0;
         |LEE 040#102=;
         |SI FSalida = 0;
             nSwEsta = 1;
         |FINSI;
         |CIERRA #102;
     |FINSI;

     |SI #0#12 ! 0;
         nSwEsta = 0;
         |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo = #309#0;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;  |ACABA;  |FINSI;

     enCodCli = #309#0;
     |HAZ LeePersona;

     #999#0  = #309#0;
     #999#1  = #309#2;
     #999#2  = #309#3;
     #999#3  = 309;
     #999#4  = #309#4;
     #999#5  = #309#1;
     #999#6  = #309#5;
     #999#7  = #715#1;
     #999#8  = #309#73;

     |SI enSwDeDonde = 1;
         #999#9  = #715#3;
     |SINO;
         #999#9  = #715#13;
     |FINSI;

     |GRABA 020#999n;
     |LIBERA #999;

     nSwGraba = 1;

     |LIBERA #309;
|FPRC;

|DEFBUCLE dsmod309;
     #309#1;
     9, 11;
     #0#10, 01, #0#6, #0#4, 00, 01, "X", "X";
     #0#11, 98, #0#6, #0#4, 99, 99, "X", "X";
     be;
     NULL, GrabaTempo309;
|FIN;

|PROCESO GrabaTempo200;
     nSwEsta = 1;

     |SI #0#36 ! 0;
         nSwEsta = 0;
         |ABRE #102;
         #102#0 = #0#36;
         #102#1 = #200#0;
         |LEE 040#102=;
         |SI FSalida = 0;
             nSwEsta = 1;
         |FINSI;
         |CIERRA #102;
     |FINSI;

     |SI #0#12 ! 0;
         nSwEsta = 0;
         |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo = #200#0;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;  |ACABA;  |FINSI;

     enCodCli = #200#0;
     |HAZ LeePersona;

     #999#0  = #200#0;
     #999#1  = #200#1;
     #999#2  = 99;
     #999#3  = 200;
     #999#4  = 0;
     #999#5  = 0;
     #999#6  = 0;
     #999#7  = #715#1;
     #999#8  = #200#7;

     |SI enSwDeDonde = 1;
         #999#9  = #715#3;
     |SINO;
         #999#9  = #715#13;
     |FINSI;

     |GRABA 020#999n;
     |LIBERA #999;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE isacceso;
     #200#1;
     6;
     #0#6, #0#10, "S";
     #0#6, #0#11, "S";
     ;
     NULL, GrabaTempo200;
|FIN;

|PROCESO GrabaTempo202;
     nSwEsta = 1;

     |SI #0#36 ! 0;
         nSwEsta = 0;
         |ABRE #102;
         #102#0 = #0#36;
         #102#1 = #202#0;
         |LEE 040#102=;
         |SI FSalida = 0;
             nSwEsta = 1;
         |FINSI;
         |CIERRA #102;
     |FINSI;

     |SI #0#12 ! 0;
         nSwEsta = 0;
         |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               |SI #0nCampo = #202#0;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwEsta = 0;  |ACABA;  |FINSI;

     enCodCli = #202#0;
     |HAZ LeePersona;

     #999#0  = #202#0;
     #999#1  = #202#1;
     #999#2  = #0#4;
     #999#3  = 202;
     #999#4  = #202#3;
     #999#5  = 0;
     #999#6  = 0;
     #999#7  = #715#1;
     #999#8  = #202#9;

     |SI enSwDeDonde = 1;
         #999#9  = #715#3;
     |SINO;
         #999#9  = #715#13;
     |FINSI;

     |GRABA 020#999n;
     |LIBERA #999;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE isom9000;
     #202#1;
     8;
     #0#10, #0#6, aPeriodo, 00, "S";
     #0#11, #0#6, aPeriodo, 99, "S";
     ;
     NULL, GrabaTempo202;
|FIN;

|RUTINA ClaveBaja999;
     #999#0 = 1;
     #999#1 = 0;
     #999#2 = 0;
     #999#3 = 0;
     #999#4 = 0;
     #999#5 = 0;
     #999#6 = 0;
|FRUT;

|RUTINA ClaveAlta999;
     #999#0 = 99999;
     #999#1 = 9999;
     #999#2 = 99;
     #999#3 = 999;
     #999#4 = 99;
     #999#5 = 99;
     #999#6 = 99;
|FRUT;

|PROCESO CargaPeriodo;
     aBusco = aCadena - "1T";  |SI FSalida ! 0;  aPeriodo = "03";  |ACABA;  |FINSI;
     aBusco = aCadena - "2T";  |SI FSalida ! 0;  aPeriodo = "06";  |ACABA;  |FINSI;
     aBusco = aCadena - "3T";  |SI FSalida ! 0;  aPeriodo = "09";  |ACABA;  |FINSI;
     aBusco = aCadena - "4T";  |SI FSalida ! 0;  aPeriodo = "12";  |ACABA;  |FINSI;
     aBusco = aCadena - "01";  |SI FSalida ! 0;  aPeriodo = "01";  |ACABA;  |FINSI;
     aBusco = aCadena - "02";  |SI FSalida ! 0;  aPeriodo = "02";  |ACABA;  |FINSI;
     aBusco = aCadena - "03";  |SI FSalida ! 0;  aPeriodo = "03";  |ACABA;  |FINSI;
     aBusco = aCadena - "04";  |SI FSalida ! 0;  aPeriodo = "04";  |ACABA;  |FINSI;
     aBusco = aCadena - "05";  |SI FSalida ! 0;  aPeriodo = "05";  |ACABA;  |FINSI;
     aBusco = aCadena - "06";  |SI FSalida ! 0;  aPeriodo = "06";  |ACABA;  |FINSI;
     aBusco = aCadena - "07";  |SI FSalida ! 0;  aPeriodo = "07";  |ACABA;  |FINSI;
     aBusco = aCadena - "08";  |SI FSalida ! 0;  aPeriodo = "08";  |ACABA;  |FINSI;
     aBusco = aCadena - "09";  |SI FSalida ! 0;  aPeriodo = "09";  |ACABA;  |FINSI;
     aBusco = aCadena - "10";  |SI FSalida ! 0;  aPeriodo = "10";  |ACABA;  |FINSI;
     aBusco = aCadena - "11";  |SI FSalida ! 0;  aPeriodo = "11";  |ACABA;  |FINSI;
     aBusco = aCadena - "12";  |SI FSalida ! 0;  aPeriodo = "12";  |ACABA;  |FINSI;
     aBusco = aCadena - "1P";  |SI FSalida ! 0;  aPeriodo = "1P";  |ACABA;  |FINSI;
     aBusco = aCadena - "2P";  |SI FSalida ! 0;  aPeriodo = "2P";  |ACABA;  |FINSI;
     aBusco = aCadena - "3P";  |SI FSalida ! 0;  aPeriodo = "3P";  |ACABA;  |FINSI;
|FPRC;

|PROCESO BuscaJustificante;
     aAlfa    = aCadena;   |QBT aAlfa;
     aLong    = aAlfa % 0;
     nLong    = aLong;
     aNumeros = "";
     |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos   = (nCarac * 100) + 1;
           aCarac =  aAlfa % nPos;
           |SI aCarac ! "0";  |Y aCarac ! "1";  |Y aCarac ! "2"; |Y aCarac ! "3";
            |Y aCarac ! "4";  |Y aCarac ! "5";  |Y aCarac ! "6"; |Y aCarac ! "7";
            |Y aCarac ! "8";  |Y aCarac ! "9";
               aLong    = aNumeros % 0;
               |SI aLong = 13;  |SAL;  |FINSI;

               aNumeros = "";
           |SINO;
               aNumeros = aNumeros + aCarac;
           |FINSI;
     |SIGUE;

     |SI aNumeros ! "";
         aJusti = aNumeros;
         nJusti = 0;
     |FINSI;
|FPRC;

|PROCESO BuscaCadena;
     aCadena = aCadena > "";

     |SI nJusti = 1;
         |HAZ BuscaJustificante;
     |FINSI;

     |SI aJusti = "";
         aBusco = aCadena - "JUSTIFICANTE";
         |SI FSalida ! 0;
             nJusti = 1;
             |HAZ BuscaJustificante;
         |FINSI;
     |FINSI;

     |SI aEjercicio = "";
         aBusco = aCadena - "EJERCICIO";
         |SI FSalida ! 0;
             aAlfa  = #0#6;
             aBusco = aCadena - #0#6;
             |SI FSalida ! 0;
                 aEjercicio = #0#6;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI aPeriodo ! "";  |ACABA;  |FINSI;

     aBusco = aCadena - "PERÌODO";
     |SI FSalida ! 0;
         |HAZ CargaPeriodo;
         |SI aPeriodo ! "";  |ACABA;  |FINSI;
     |FINSI;

     aBusco = aCadena - "PERÕODO";
     |SI FSalida ! 0;
         |HAZ CargaPeriodo;
         |SI aPeriodo ! "";  |ACABA;  |FINSI;
     |FINSI;

     aBusco = aCadena - "PERIODO";
     |SI FSalida ! 0;
         |HAZ CargaPeriodo;
         |SI aPeriodo ! "";  |ACABA;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsmow137;
     #999#8  = aElect;
     #999#19 = aJusti;
     |GRABA 020#999a;
     |LIBERA #999;

     |HAZ Actualiza;

     |ERROR10;
|FPRC;

|DEFBUCLE dsmow137;
     #999#2;
     8;
     aDni, 0000, 00, 000, 00, 00, 00, "                ";
     aDni, 9999, 99, 999, 99, 99, 99, "                ";
     be;
     NULL, dsmow137;
|FIN;

|PROCESO LeeFichero;
     aAlfa = aFicRes % 101;
     |SI aAlfa ! "A";  |ACABA;  |FINSI;

     aAlfa   = aFicRes % 1303;
     nModelo = aAlfa;
     |SI nModelo = 111;  nModelo = 110;  |FINSI;

     |SI nModelo ! #0#0;  |ACABA; |FINSI;

     |DBASE aPathBase;
     |QBF aPathBase;

     aDestino = aFichero;
     aOrigen  = aPathBase + "tmp";  |MKDIR aOrigen;
     aOrigen  = aOrigen + "/tempo.html";
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;
     |SI aIPRemoto ! "";
         |RECIBE_FICHERO aDestino, aOrigen;
     |SINO;
         |COPIA_FICHERO aDestino, aOrigen;
     |FINSI;

     aAbre = aOrigen;

     |XABRE "BU", aAbre, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |PINTA 1230, "Leyendo ficheros ...";
     |PINTA 1510, "                                         ";
     |PINTA 1510, aFicRes;

     aCR               = &10;
     aLF               = &13;
     aJusti            = "";
     aElect            = "";
     aCadena           = "";
     aEjercicio        = "";
     aPeriodo          = "";
     |SI #0#4 = 99;  aPeriodo = "99";  |FINSI;

     |XLEE nHandle, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            |SI aAlfa = aCR;
                |HAZ BuscaCadena;
                aCadena = "";
                |SI aEjercicio ! "";  |Y aPeriodo ! "";
                     |SAL;
                |FINSI;
            |SINO;
                |SI aAlfa ! aLF;
                    aCadena = aCadena + aAlfa;
                |FINSI;
            |FINSI;
            |XLEE nHandle, 1, aAlfa;
     |SIGUE;
     |XCIERRA nHandle;

     nEjercicio = aEjercicio;

     |SI #0#0 = 202;
         aPeriodo = aPeriodo % 101;
         nPeriodo = aPeriodo;
     |SINO;
         nPeriodo = aPeriodo;
     |FINSI;

     aAlfa = aPathBase + "tmp/tempo.html";  |FBORRA aAlfa;

     |SI #0#6 ! nEjercicio;  |O #0#4 ! nPeriodo;
         |ACABA;
     |FINSI;

     aAlfa        = aFicRes > "";
     aAlfa        = aAlfa - ".HTML";

     aDni         = aAlfa % 309;
     aElect       = aAlfa % -116;

     |BUCLE dsmow137;
|FPRC;

|PROCESO Importar;
     |MENAV "0000 Seleccione a continuacion el directorio donde tenemos los ficheros de respuestas de hacienda";

     aRuta = "D";
     |BROWSE aRuta;

     |PUSHV 0501 2380;
     |BLANCO 0401 2380;
     |CUADRO 0501 2380;

     |PINTA 1230, "Leyendo ficheros ...";

     aAlfa = aRuta;
     aRuta = "";
     aLong = aAlfa % 0;
     nLong = aLong;
     |PARA nCarac = 2;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos = (nCarac * 100) + 1;
           aRuta = aRuta + (aAlfa % nPos);
     |SIGUE;

     aFichero    = aRuta + "\*.html";

     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
         |SI FSalida ! 0; |SAL; |FINSI;

         aFicRes = (aFichero - aRuta) > "";  |QBT aFicRes;
         aFicRes = aFicRes % 299;

         |HAZ LeeFichero;
         |PULSATECLA;

         |R_SDIR aFichero;
     |SIGUE;

     |POPV;

     |PTEC 812;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     aFichero = ("el" + Usuario) % 108;
     |NOME_DAT #999 aFichero;
     |ABRE #999;  |CIERRA #999;  |DELINDEX #999;

     nSwGraba = 0;

     |ABRE #999;
     |SI #0#0 ! 309;  |Y #0#0 ! 200;  |Y #0#0 ! 202;
         |BUCLE dsmom004;
     |SINO;
         |SI #0#0 = 309; nChequeo = 0;  |BUCLE dsmod309; |FINSI;
         |SI #0#0 = 200; nChequeo = 0;  |BUCLE isacceso; |FINSI;
         |SI #0#0 = 202;
             |SI #0#4 = 1;  aPeriodo = "1P";  |FINSI;
             |SI #0#4 = 2;  aPeriodo = "2P";  |FINSI;
             |SI #0#4 = 3;  aPeriodo = "3P";  |FINSI;
             nChequeo = 0;
             |BUCLE isom9000;
         |FINSI;
     |FINSI;
     |CIERRA #999;

     |SI nSwGraba = 1;
         |PINPA #0#999;

         |PINTA 0620, #0#1;
         |PINTA 0720, #0#5;

         |CONTROL_SIMPLE 0, "BOTON,Importar codigos de los ficheros de hacienda", 0562, 0780, Importar;
         nBoton = FSalida;

         |SI #0#0 = 200;  |O #0#0 = 202;
             |PINTA 1067, "             ";
             |C_V #999#19, 1, "N";
         |FINSI;

         |ENTLINEAL #1#999, -1, 4, 22, 0, ClaveBaja999, ClaveAlta999;

         |FIN_CONTROL_WINDOWS nBoton;
     |SINO;
         |MENAV "     Seleccion Vacia.";
     |FINSI;

     |DELINDEX #999;
|FPRC;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROCESO Boton2;
     |PTEC 825;
|FPRC;

|PROCESO Boton3;
     |PTEC 826;
|FPRC;
