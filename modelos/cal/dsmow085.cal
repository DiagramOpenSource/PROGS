|FICHEROS;
     dsmow085 #85,MANTE;

     dsm190li,MANTE;
     dsm19001,MANTE;
     dsm190ca #190;

     dsmom026;

     :/basica/def/agidanif;

     :/laboral/def/labtraba;
     :/laboral/def/nomhicca;
     :/laboral/def/nomhicli;
     :/laboral/def/labempre;
     :/laboral/def/nomconli;
     :/laboral/def/nomhiatr;
     :/laboral/def/nomconca;
     :/laboral/def/nomcorli;
     :/laboral/def/nomnotay;
     :/laboral/def/nomir003;

     dsmow185;
     dsmow014;
     dsmow134;
|FIN;

|VARIABLES;
     FEstado           = 0;
     nCampo            = 0;
     nHandle           = 0;
     nDevengo          = 0;
     nImport1          = 0;
     nImport2          = 0;
     nImport3          = 0;
     nImporteBaseI     = 0;
     nImporteRetencion = 0;
     nImporteSSTrabaja = 0;
     ded_not           = 0;
     nEmpresa          = 0;
     nCentro           = 0;
     notaria           = 0;
     nAtrasos          = 0;
     nEjer             = 0;
     nEjerAt           = 0;
     nHay              = 0;
     nGraba            = 0;
     nBoton5           = 0;
     nEl20             = 0;
     nEl25             = 0;
     nDifer            = 0;

     nEmpAnt           = 0;
     nComAnt           = 0;
     nDCompl           = 0;
     nHCompl           = 0;
     nDActiv           = 0;
     nHActiv           = 0;

     nIRPFMayo         = 0;
     nBaseJunio        = 0;
     nRetJunio         = 0;
     nIRPFJunio        = 0;
     nIRPFJulio        = 0;
     nDifJunio         = 0;
     nAntEmp           = 0;
     nAntTra           = 0;
     swSigue           = 0;

     aBase             = "";
     aFichero          = "";
     aPathLaboral      = "";
     aClave            = "";
     aDni              = "";
     aSubClave         = "";
     aNombreTrabajador = "";
     aEspecie          = "";
     aRepercute        = "";
     aAlfa             = "";
     aClaveDia         = "";

     &nTipoRel         = 0;
     &nDiferencias     = 0;
     &nVEmp            = 0;
     &aVDNI            = "";
     &nVAny            = 0;
     &nCuotNueva       = 0;
     &nBaseHist        = 0;
     &nSSHist          = 0;
     &nGasto1          = 0;
     &nGasto3          = 0;
     &nGasto4          = 0;

     &nSwMasivo        = 0;
     &swCabecera       = 0;
     &nCuotaMin        = 0;
     &nCuotaMax        = 0;
     &nVivienda        = 0;
     &swVivienda       = 0;
     &nElAnyIRPF       = 0;
|FIN;

|PROCESO Vivienda; |TIPO 7;
     |SI #dsmow085#22 ! 0;
          || he tenido deduccion vivienda durante el a¤o
          |COLOR 0,7; |ATRI R;
          |PINTA 2029, "DED.";
          |PINTA 2129, "VIV.";
          |ATRI 0;

          |PINTA 2044, ":";
          |ATRI R;
          |PINTA 2045, "Min           ";
          |PINTA 2061, "M x           ";
          |ATRI 0;

          |CAMPO_VISUAL #dsmow085#18, 1, "N";
          |CAMPO_VISUAL #dsmow085#23, 1, "S";
          |CAMPO_VISUAL #dsmow085#24, 1, "S";
          |CAMPO_POSICION #dsmow085#23, 1, 2049;
          |CAMPO_POSICION #dsmow085#24, 1, 2065;
          |PINTA #dsmow085#23;
          |PINTA #dsmow085#24;

          |SI #dsmow085#19 ! 0;    || o no llegamos al minimo o nos pasamos del maximo
               |SI #dsmow085#19 < 0;
                    |COLOR 0,7; |ATRI R;
                    |PINTA 2135, "Retenci¢n inferior al m¡nimo:";
                    |ATRI 0;
               |FINSI;
               |SI #dsmow085#19 > 0;
                    |COLOR 0,7; |ATRI R;
                    |PINTA 2135, "Retenci¢n superior al m ximo:";
                    |ATRI 0;
               |FINSI;
               |CAMPO_VISUAL #dsmow085#19, 1, "S";
               |SI #dsmow085#19 < 0;
                    |CAMPO_ATRIBUTO #dsmow085#19, N, 1, 7;
               |FINSI;
               |SI #dsmow085#19 > 0;
                    |CAMPO_ATRIBUTO #dsmow085#19, N, 4, 7;
               |FINSI;
               |PINTA #dsmow085#19;
               |CAMPO_ATRIBUTO #dsmow085#19, N, 0, 7;
          |SINO;
               |CAMPO_VISUAL #dsmow085#19, 1, "N";
               |PINTA 2135, "Retenci¢n IRPF declarada entre los l¡mites";
          |FINSI;
     |SINO;
          |PINTA 2029, "    ";
          |PINTA 2129, "    ";

          |PINTA 2035, "Retenci¢n ..................:";
          |CAMPO_VISUAL #dsmow085#18, 1, "S";
          |CAMPO_VISUAL #dsmow085#19, 1, "S";
          |CAMPO_VISUAL #dsmow085#23, 1, "N";
          |CAMPO_VISUAL #dsmow085#24, 1, "N";
          |CAMPO_POSICION #dsmow085#23, 1, 2235;
          |CAMPO_POSICION #dsmow085#24, 1, 2247;
          |PINTA #dsmow085#18;
          |PINTA 2135, "Diferencia con lo declarado :               ";
          |SI #dsmow085#19 < 0;
               |CAMPO_ATRIBUTO #dsmow085#19, N, 1, 7;
          |FINSI;
          |SI #dsmow085#19 > 0;
               |CAMPO_ATRIBUTO #dsmow085#19, N, 4, 7;
          |FINSI;
          |PINTA #dsmow085#19;
          |CAMPO_ATRIBUTO #dsmow085#19, N, 0, 7;
     |FINSI;

     |SI #dsmow085#12 ! #dsmow085#15;
          |CAMPO_ATRIBUTO #dsmow085#15, N, 1, 7;
          |PINTA #dsmow085#15;
     |FINSI;
     |SI #dsmow085#13 ! #dsmow085#16;
         |CAMPO_ATRIBUTO #dsmow085#16, N, 1, 7;
         |PINTA #dsmow085#16;
     |FINSI;
     |SI #dsmow085#14 ! #dsmow085#17;
         |CAMPO_ATRIBUTO #dsmow085#17, N, 1, 7;
         |PINTA #dsmow085#17;
     |FINSI;
     |SI #dsmow085#25 ! #dsmow085#26;
         |CAMPO_ATRIBUTO #dsmow085#26, N, 1, 7;
         |PINTA #dsmow085#26;
     |FINSI;

     |CAMPO_ATRIBUTO #dsmow085#15, N, 0, 7;
     |CAMPO_ATRIBUTO #dsmow085#16, N, 0, 7;
     |CAMPO_ATRIBUTO #dsmow085#17, N, 0, 7;
     |CAMPO_ATRIBUTO #dsmow085#26, N, 0, 7;
|FPRC;

|RUTINA Baja085;
     #dsmow085#0  = #dsm190ca#0;
     #dsmow085#1  = #dsm190ca#1;
     #dsmow085#2  = #dsm190ca#2;
     #dsmow085#3  = #dsm190ca#3;
     #dsmow085#4  = #dsm190ca#4;
     #dsmow085#5  = #dsm190ca#5;
     #dsmow085#6  = "            ";
     #dsmow085#7  = 0000;
     #dsmow085#8  = " ";
     #dsmow085#9  = "  ";
     #dsmow085#10 = 0;
|FRUT;

|RUTINA Alta085;
     #dsmow085#0  = #dsm190ca#0;
     #dsmow085#1  = #dsm190ca#1;
     #dsmow085#2  = #dsm190ca#2;
     #dsmow085#3  = #dsm190ca#3;
     #dsmow085#4  = #dsm190ca#4;
     #dsmow085#5  = #dsm190ca#5;
     #dsmow085#6  = "zzzzzzzzzzzz";
     #dsmow085#7  = 9999;
     #dsmow085#8  = "z";
     #dsmow085#9  = "zz";
     #dsmow085#10 = 4;
|FRUT;

|| Carga del Modelo

|PROCESO dsm190liD;
     |DDEFECTO #dsmow085;
     |PARA nCampo = 0;  |SI nCampo [ 10;  |HACIENDO nCampo = nCampo + 1;
           #dsmow085#nCampo# = #dsm190li#nCampo#;
     |SIGUE;

     #dsmow085#9 = "  ";
     |LEE 101#dsmow085.=;
     FEstado = FSalida;

     #dsmow085#11 = #dsm190li#12;
     #dsmow085#15 = #dsmow085#15 + #dsm190li#16 + #dsm190li#18;
     #dsmow085#16 = #dsmow085#16 + #dsm190li#17 + #dsm190li#19;
     |SI FEstado ! 0;
          #dsmow085#17 = #dsm190li#22;
          #dsmow085#26 = #dsm190li#21 + #dsm190li#23 + #dsm190li#24;
          #dsmow085#27 = #dsm190li#21;
          #dsmow085#28 = #dsm190li#23;
          #dsmow085#29 = #dsm190li#24;
     |FINSI;
     #dsmow085#22 = #dsm190li#64;  || deduccion vivienda S/N (1/0)

     |SI FEstado = 0;
           |GRABA 020#dsmow085.a;
     |SINO;
           |GRABA 020#dsmow085.n;
     |FINSI;
     |LIBERA #dsmow085;
|FPRC;

|DEFBUCLE dsm190liD;
     #dsm190li#1;
     ;
     #190#0,#190#1,#190#2,#190#3,nDCompl,nDActiv,"            ",0000,"A","  ", 0;
     #190#0,#190#1,#190#2,#190#3,nHCompl,nHActiv,"zzzzzzzzzzzz",9999,"A","zz", 9;
     ;
     NULL, dsm190liD;
|FIN;

|PROCESO dsm19001D;
     |DDEFECTO #dsmow085;
     |PARA nCampo = 0;  |SI nCampo [ 10;  |HACIENDO nCampo = nCampo + 1;
           #dsmow085#nCampo# = #dsm19001#nCampo#;
     |SIGUE;

     #dsmow085#9 = "  ";
     |LEE 101#dsmow085.=;
     FEstado = FSalida;

     #dsmow085#11 = #dsm19001#12;
     #dsmow085#15 = #dsmow085#15 + #dsm19001#16 + #dsm19001#18;
     #dsmow085#15 = #dsmow085#15 + #dsm19001#65 + #dsm19001#67;
     #dsmow085#16 = #dsmow085#16 + #dsm19001#17 + #dsm19001#19;
     #dsmow085#16 = #dsmow085#16 + #dsm19001#66 + #dsm19001#68;
     |SI FEstado ! 0;
          #dsmow085#17 = #dsm19001#22;
          #dsmow085#26 = #dsm19001#21 + #dsm19001#23 + #dsm19001#24;
          #dsmow085#27 = #dsm19001#21;
          #dsmow085#28 = #dsm19001#23;
          #dsmow085#29 = #dsm19001#24;
     |FINSI;
     #dsmow085#22 = #dsm19001#64;  || deduccion vivienda S/N (1/0)

     |SI FEstado = 0;
           |GRABA 020#dsmow085.a;
     |SINO;
           |GRABA 020#dsmow085.n;
     |FINSI;
     |LIBERA #dsmow085;
|FPRC;

|DEFBUCLE dsm19001D;
     #dsm19001#1;
     ;
     #190#0,#190#1,#190#2,#190#3,nDCompl,nDActiv,"            ",0000,"A","  ", 0;
     #190#0,#190#1,#190#2,#190#3,nHCompl,nHActiv,"zzzzzzzzzzzz",9999,"A","zz", 9;
     ;
     NULL, dsm19001D;
|FIN;

|| Carga del Historico

|PROCESO TipoRel;
     nTipoRel = "0";
     |SI aClave ! "A";
         nTipoRel = 0;
         |ACABA;
     |FINSI;

     |ABRE #agidanif;
     #agidanif#0  = aDni;
     #agidanif#1  = 1;
     |LEE 040#agidanif.=;
     |SI FSalida ! 0;  |DDEFECTO #agidanif; |FINSI;
     |CIERRA #agidanif;

     nTipoRel = #agidanif#36;
|FPRC;

|PROCESO GrabaTemporal1;
     |SI aClave = " ";  |Y aSubClave = "  ";  |ACABA;  |FINSI;
     |SI aClave ! "A";                        |ACABA;  |FINSI;

     |SI aClave = "A";           || Tique 700000_9602
         aSubClave = "  ";
     |FINSI;

     #dsmow085#0     = #dsm190ca#0;
     #dsmow085#1     = #dsm190ca#1;
     #dsmow085#2     = #dsm190ca#2;
     #dsmow085#3     = #dsm190ca#3;
     #dsmow085#4     = #dsm190ca#4;
     #dsmow085#5     = #dsm190ca#5;
     #dsmow085#6     = aDni;
     #dsmow085#7     = nDevengo;
     #dsmow085#8     = aClave;
     #dsmow085#9     = aSubClave;
     #dsmow085#10    = nTipoRel;
     |LEE 101#dsmow085.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow085;
         #dsmow085#0     = #dsm190ca#0;
         #dsmow085#1     = #dsm190ca#1;
         #dsmow085#2     = #dsm190ca#2;
         #dsmow085#3     = #dsm190ca#3;
         #dsmow085#4     = #dsm190ca#4;
         #dsmow085#5     = #dsm190ca#5;
         #dsmow085#6     = aDni;
         #dsmow085#7     = nDevengo;
         #dsmow085#8     = aClave;
         #dsmow085#9     = aSubClave;
         #dsmow085#10    = nTipoRel;
         #dsmow085#11    = aNombreTrabajador;

         |GRABA 020#dsmow085.b;
     |FINSI;

     #dsmow085#12 = #dsmow085#12 + nImporteBaseI;
     #dsmow085#13 = #dsmow085#13 + nImporteRetencion;
     #dsmow085#14 = #dsmow085#14 + nImporteSSTrabaja;

     |SI nTipoRel = 2; |O nTipoRel = 3;
          |SI #nomhicca#2 = 7; |Y #nomhicca#3 = 0;
               #dsmow085#18 = #dsmow085#18 - nDifJunio;
          |FINSI;
     |FINSI;

     #dsmow085#20 = nEl20;
     #dsmow085#21 = aClaveDia;
     #dsmow085#25 = nEl25;

     |GRABA 020#dsmow085.a;
     |LIBERA #dsmow085;

     |SELECT #1#dsmow185;
     #dsmow185#0     = nEmpresa;
     #dsmow185#1     = #dsmow085#1;
     #dsmow185#2     = #dsmow085#2;
     #dsmow185#3     = #dsmow085#3;
     #dsmow185#4     = #dsmow085#4;
     #dsmow185#5     = #dsmow085#5;
     #dsmow185#6     = #dsmow085#6;
     #dsmow185#7     = #dsmow085#7;
     #dsmow185#8     = #dsmow085#8;
     #dsmow185#9     = #dsmow085#9;
     #dsmow185#10    = #dsmow085#10;
     |LEE 101#dsmow185.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow185;
         #dsmow185#0     = nEmpresa;
         #dsmow185#1     = #dsmow085#1;
         #dsmow185#2     = #dsmow085#2;
         #dsmow185#3     = #dsmow085#3;
         #dsmow185#4     = #dsmow085#4;
         #dsmow185#5     = #dsmow085#5;
         #dsmow185#6     = #dsmow085#6;
         #dsmow185#7     = #dsmow085#7;
         #dsmow185#8     = #dsmow085#8;
         #dsmow185#9     = #dsmow085#9;
         #dsmow185#10    = #dsmow085#10;
         #dsmow185#11    = #dsmow085#0;

         |GRABA 020#dsmow185.n;
     |FINSI;
     |LIBERA #dsmow185;

     nImporteBaseI     = 0;
     nImporteRetencion = 0;
     nImporteSSTrabaja = 0;
     ded_not           = 0;
|FPRC;

|PROCESO SSTrabaja;
     |ABRE #nomnotay;
     #nomnotay#0 = nEmpresa;
     #nomnotay#1 = nCentro;
     |LEE 000#nomnotay.=;
     |SI FSalida ! 0;
         #nomnotay#2 = 0;       || (%) a cero
     |FINSI;
     notaria = #nomnotay#2;
     |CIERRA #nomnotay;

     ded_not           = (#nomhicca#48 < notaria) ! 2;
     nImporteSSTrabaja = (ded_not+#nomhicca#49+#nomhicca#50+#nomhicca#51);           || deduc.S.S.
|FPRC;

|PROCESO nomhicli;
     #nomconli#0 = #labtraba#87;
     #nomconli#2 = #nomhicli#4;
     |LEE 101#nomconli.=;
     |SI FSalida = 0;
         |SI #nomconli#8 = 0;  |ACABA;  |FINSI;

         |SI #nomconli#13 = "  ";
             #nomconli#13 = "01";
             |GRABA 020#nomconli.a;
         |FINSI;

         aClave            = "L";
         aSubClave         = #nomconli#13;
         aEspecie          = "N";
         aRepercute        = "N";
         nImporteBaseI     = #nomhicli#11 * #nomhicli#10;
         nImporteRetencion = 0;
         |HAZ GrabaTemporal1;
     |FINSI;

     |LIBERA #nomconli;
|FPRC;

|DEFBUCLE nomhicli;
     #nomhicli#1;
     ;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 411;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 499;
     ;
     NULL, nomhicli;
|FIN;

|PROCESO IniJun2008;
     nIRPFMayo = 0;
     nBaseJunio = 0;
     nRetJunio = 0;
     nIRPFJunio = 0;
     nIRPFJulio = 0;
     nDifJunio = 0;
|FPRC;

|PROCESO Jun2008;
     |SI nAntEmp ! #nomhicca#0; |O nAntTra ! #nomhicca#1;
          |HAZ IniJun2008;
     |FINSI;
     |SI #nomhicca#66 ! 08; |O #nomhicca#3 ! 0;
          |ACABA;
     |FINSI;
     |SI #nomhicca#2 = 5;
          nIRPFMayo = #nomhicca#13;
     |FINSI;
     |SI #nomhicca#2 = 6;
          nBaseJunio = #nomhicca#14 + #nomhicca#16;
          nRetJunio = #nomhicca#15 + #nomhicca#17;
          nIRPFJunio = #nomhicca#13;
     |FINSI;
     |SI #nomhicca#2 = 7;
          nIRPFJulio = #nomhicca#13;
          |HAZ TipoRel;
          swSigue = 0;
          |SI #agidanif#36 = 2; |O #agidanif#36 = 3;
               swSigue = 1;
          |FINSI;
          |SI nIRPFMayo = 2; |Y nIRPFJulio = 2;
               swSigue = swSigue + 1;
          |FINSI;
          |SI nIRPFMayo = 15; |Y nIRPFJulio = 15;
               swSigue = swSigue + 1;
          |FINSI;
          |SI nIRPFJunio < nIRPFMayo;
               swSigue = swSigue + 1;
          |FINSI;
          |SI swSigue ] 3;
               nDifJunio = ((nBaseJunio) % (nIRPFMayo - nIRPFJunio)) ! 2;
          |FINSI;
     |FINSI;
     nAntEmp = #nomhicca#0;
     nAntTra = #nomhicca#1;
|FPRC;

|PROCESO ImporteIT;
     #nomcorli#0 = #labtraba#87;
     #nomcorli#2 = #nomhicli#4;
     |LEE 041#nomcorli.=;
     |SI FSalida = 0;
         |SI #nomcorli#5 = 55; |O #nomcorli#5 = 56;
              nImport1 = nImport1 + (#nomhicli#11 * #nomhicli#10) ! 2;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE ImporteIT;
     #nomhicli#1;
     ;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 401;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 410;
     ;
     NULL, ImporteIT;
|FIN;

|PROCESO nomhicca;
     nDevengo = 0;

     |SI nAtrasos = 1;
         |SI #nomhiatr#1 ! #nomhiatr#3;
              nDevengo = #nomhiatr#3;
         |FINSI;
     |FINSI;

     |HAZ Jun2008;

     #labempre#0 = #nomhicca#0;
     |LEE 000#labempre.=;
     |SI FSalida ! 0;  |DDEFECTO #labempre; |FINSI;

     #labtraba#0 = #nomhicca#0;
     #labtraba#1 = #nomhicca#1;
     |LEE 000#labtraba.=;
     |SI FSalida ! 0;  |DDEFECTO #labtraba; |FINSI;
     nCentro = #labtraba#77;

     nEl20     = 0;
     nEl25     = 0;
     aClaveDia = "";
     |ABRE #nomir003;
     #nomir003#0  = #labtraba#7;
     #nomir003#40 = #dsm190ca#1;
     #nomir003#41 = #labtraba#0;
     |LEE 040#nomir003.=;
     |SI FSalida = 0;
         nEl20     = #nomir003#11;
         nEl25     = #nomir003#10 + #nomir003#12 + #nomir003#13;
         aClaveDia = #labtraba#42;
     |FINSI;
     |CIERRA #nomir003;
     aNombreTrabajador = #labtraba#2;
     aDni              = #labtraba#7;
     nTipoRel          = #labtraba#111;

     aClave            = #labtraba#99;
     aSubClave         = #labtraba#102;
     |SI aClave = "A"; |Y aSubClave ! "  "; aSubClave = "  "; |FINSI;

     aEspecie          = #labtraba#105;
     aRepercute        = #labtraba#108;
     nImporteBaseI     = #nomhicca#14 + #nomhicca#16;
     nImporteRetencion = #nomhicca#15 + #nomhicca#17;
     |HAZ SSTrabaja;

     |SI aClave = "A";  |Y #dsm190ca#1 ] 2015;
         nImport1 = 0;
         |ABRE #nomcorli;
         |BUCLE ImporteIT;
         |CIERRA #nomcorli;

         |SI #nomhicca#57 ! 0; |O #nomhicca#58 ! 0;
           |O #nomhicca#59 ! 0; |O #nomhicca#60 ! 0;
            |O #nomhicca#112 ! 0; |O nImport1 ! 0;
             nImport1 = nImport1 + #nomhicca#57 + #nomhicca#58 + #nomhicca#59 + #nomhicca#60 + #nomhicca#112;
             nImport2 = (nImport1 % #nomhicca#13) ! 2;

             |SI #dsm190ca#1 = 2015;
                 nImporteBaseI     = nImporteBaseI - nImport1;
                 nImporteRetencion = nImporteRetencion - nImport2;
                 aSubClave = "01";
                 |SI nImporteBaseI ! 0; |O nImporteRetencion ! 0;
                     |HAZ GrabaTemporal1;
                 |FINSI;

                 nImporteBaseI     = nImport1;
                 nImporteRetencion = nImport2;
                 aSubClave         = "02";
             |FINSI;

             |SI #dsm190ca#1 ] 2016;
                 nImporteBaseI     = nImporteBaseI - nImport1;
                 nImporteRetencion = nImporteRetencion - nImport2;
                 aSubClave = "";
                 |SI nImporteBaseI ! 0; |O nImporteRetencion ! 0;
                     |HAZ GrabaTemporal1;
                 |FINSI;

                 nImporteBaseI     = nImport1;
                 nImporteRetencion = nImport2;
                 aSubClave         = "";
             |FINSI;
         |SINO;
             aSubClave = "";
             |SI #dsm190ca#1 = 2015;
                 aSubClave = "01";
             |FINSI;
         |FINSI;
     |FINSI;

     |HAZ GrabaTemporal1;

     aClave            = #labtraba#100;
     aSubClave         = #labtraba#103;
     |SI aClave = "A"; |Y aSubClave ! "  "; aSubClave = "  "; |FINSI;

     aEspecie          = #labtraba#106;
     aRepercute        = #labtraba#109;
     nImporteBaseI     = #nomhicca#108;
     nImporteRetencion = #nomhicca#110;
     |HAZ GrabaTemporal1;

     aClave            = #labtraba#101;
     aSubClave         = #labtraba#104;
     |SI aClave = "A"; |Y aSubClave ! "  "; aSubClave = "  "; |FINSI;

     aEspecie          = #labtraba#107;
     aRepercute        = #labtraba#110;
     nImporteBaseI     = #nomhicca#109;
     nImporteRetencion = #nomhicca#111;
     |HAZ GrabaTemporal1;

     |SI #nomhicca#18 ! 0;
         |SI #labtraba#99 ! " "; |O #labtraba#100 ! " ";|O #labtraba#101 ! " ";
             |BUCLE nomhicli;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     ;
     nEmpresa, 00001, nEjer, 01, 0;
     nEmpresa, 99999, nEjer, 99, 4;
     ;
     NULL, nomhicca;
|FIN;

|DEFBUCLE nomhiccaA;
     #nomhicca#1;
     ;
     #nomhiatr#0, 00001, nEjerAt, 01, #nomhiatr#2;
     #nomhiatr#0, 99999, nEjerAt, 12, #nomhiatr#2;
     ;
     NULL, nomhicca;
|FIN;

|PROCESO nomhiatr;
     |SI #nomhiatr#4 = 0;  |ACABA;  |FINSI;

     aAlfa   = #nomhiatr#3;
     aAlfa   = aAlfa % -102;
     nEjerAt = aAlfa;
     |BUCLE nomhiccaA;
|FPRC;

|DEFBUCLE nomhiatr;
     #nomhiatr#1;
     ;
     nEmpresa, #dsm190ca#1,  5, 0000;
     nEmpresa, #dsm190ca#1, 20, 9999;
     ;
     NULL, nomhiatr;
|FIN;

|PROCESO dsmom026;
     nEmpresa = #dsmom026#1;
     nAtrasos = 0;  |BUCLE nomhicca;
     nAtrasos = 1;  |BUCLE nomhiatr;
|FPRC;

|DEFBUCLE dsmom026;
     #dsmom026#1;
     ;
     #dsm190ca#0, 00001;
     #dsm190ca#0, 99999;
     ;
     NULL, dsmom026;
|FIN;

|PROCESO Historico;
     |ABRE #labtraba;
     |ABRE #labempre;
     |ABRE #nomconli;
     |ABRE #nomconca;

     aAlfa   = #dsm190ca#1;
     aAlfa   = aAlfa % -102;
     nEjer   = aAlfa;

     |SELECT #1#dsmom026;
     #dsmom026#0 = #dsm190ca#0;
     #dsmom026#1 = 0;
     |LEE 040#dsmom026.];
     |SI FSalida = 0;  |Y #dsmom026#0 = #dsm190ca#0;
         |BUCLE dsmom026;
         |ACABA;
     |FINSI;

     |SELECT #3#dsmom026;
     #dsmom026#1 = #dsm190ca#0;
     |LEE 040#dsmom026.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     nEmpresa = #dsm190ca#0;
     nAtrasos = 0;  |BUCLE nomhicca;
     nAtrasos = 1;  |BUCLE nomhiatr;

     |CIERRA #labtraba;
     |CIERRA #labempre;
     |CIERRA #nomconli;
     |CIERRA #nomconca;
|FPRC;

|PROCESO dsmow185;
     nCuotNueva       = 0;
     nDiferencias     = 1;
     nVEmp            = #dsmow185#0;
     aVDNI            = #dsmow185#6;
     nVAny            = #dsmow185#1;
     nBaseHist        = #dsmow085#15;
     nSSHist          = #dsmow085#17;
     nGasto1          = #dsmow085#27;
     nGasto3          = #dsmow085#29;
     nGasto4          = #dsmow085#28;
     nTipoRel         = #dsmow085#10;   || el tipo de relacion se lee despues
                                        || en el nomir001, pero si es igual a
                                        || cero alli, por ser el ultimo tipo
     || de relacion actualizado ese (como los trabajadores que tienen un clave A
     || y un E04 por ejemplo), pongo esto aqui paa que por defecto vaya el de la
     || linea del 190, que es lo mas logico
     || Ejemplo en 002884.03569
     |PULSATECLA;
     |SUB_EJECUTA_NP ":laboral/nomir011";

     ||... No acumulamos proque ya en el w085 van los totales por DNI
     ||... #dsmow085#18 = #dsmow085#18 + nCuotNueva; Tique 3638 _ 828

     #dsmow085#18 = nCuotNueva;
|FPRC;

|DEFBUCLE dsmow185;
     #dsmow185#2;
     ;
     #85#0,#85#1,#85#2,#85#3,#85#4,#85#5,#85#6,#85#7,#85#8,#85#9,#85#10;
     #85#0,#85#1,#85#2,#85#3,#85#4,#85#5,#85#6,#85#7,#85#8,#85#9,#85#10;
     ;
     NULL, dsmow185;
|FIN;

|PROCESO dsmow085;
     nBaseHist        = #dsmow085#15;
     nSSHist          = #dsmow085#17;
     nGasto1          = #dsmow085#27;
     nGasto3          = #dsmow085#28;
     nGasto4          = #dsmow085#29;
     nCuotaMax        = 0;
     nCuotaMin        = 0;
     nVivienda        = 0;
     swVivienda       = #dsmow085#22;   || aqui me viene cargado si tengo vivienda
                                        || o no del #dsm190li#64
     nElAnyIRPF       = #dsmow085#1;

     #dsmow085#18 = 0;
     |BUCLE dsmow185;

     nGraba  = 0;
     #dsmow085#19 = #dsmow085#16 - #dsmow085#18;

     |SI nVivienda ! 0;
          #dsmow085#19 = 0;
          #dsmow085#22 = nVivienda;
          #dsmow085#23 = nCuotaMin;
          #dsmow085#24 = nCuotaMax;
          |SI #dsmow085#16 < nCuotaMin;
               #dsmow085#19 = #dsmow085#16 - nCuotaMin;
          |FINSI;
          |SI #dsmow085#16 > nCuotaMax;
               #dsmow085#19 = #dsmow085#16 - nCuotaMax;
          |FINSI;
     |SINO;
          #dsmow085#22 = 0;
     |FINSI;

     |SI #dsmow085#14 = 0;  |Y #dsmow085#21 = "H";
         #dsmow085#14 = #dsmow085#20;
     |FINSI;

     |SI #dsmow085#12 ! #dsmow085#15;  nGraba = 1;  nHay = 1;  |FINSI;
     |SI #dsmow085#13 ! #dsmow085#16;  nGraba = 1;  nHay = 1;  |FINSI;
     |SI #dsmow085#14 ! #dsmow085#17;  nGraba = 1;  nHay = 1;  |FINSI;
     |SI #dsmow085#25 ! #dsmow085#26;  nGraba = 1;  nHay = 1;  |FINSI;
     |SI #dsmow085#19 ! 0;        nGraba = 1;  nHay = 1;  |FINSI;
     |SI #dsmow085#22 ! 0;        nGraba = 1;  nHay = 1;  |FINSI;

     |SI nGraba = 1;
         |GRABA 020#dsmow085.a;
     |SINO;
         |BORRA 020#dsmow085.a;
     |FINSI;
     |LIBERA #dsmow085;
|FPRC;

|DEFBUCLE dsmow085;
     #dsmow085#1;
     ;
     #190#0,#190#1,#190#2,#190#3,nDCompl,nDActiv,"            ",0000,"A","  ", 0;
     #190#0,#190#1,#190#2,#190#3,nHCompl,nHActiv,"zzzzzzzzzzzz",9999,"A","zz", 9;
     be;
     NULL, dsmow085;
|FIN;

|PROCESO dsmow085I;
     nDifer = (#dsmow085#12 + #dsmow085#13 + #dsmow085#14 + #dsmow085#25) - (#dsmow085#15 + #dsmow085#16 + #dsmow085#17 + #dsmow085#26);

     |SI #dsmow085#19 [ #dsmow134#0; |O #dsmow085#19 ] #dsmow134#1; |O nDifer ! 0;
         |SI #dsmow085#0 ! nEmpAnt; |O #dsmow085#4 ! nComAnt; |O nEmpAnt = 0;
              |SI nEmpAnt ! 0;
                  |PIEINF;
              |FINSI;
              swCabecera = 1;
         |SINO;
              swCabecera = 0;
         |FINSI;

         #dsmow085#14 = #dsmow085#14 + #dsmow085#25;
         #dsmow085#17 = #dsmow085#17 + #dsmow085#26;
         |PRINT;
         nEmpAnt = #dsmow085#0;
         nComAnt = #dsmow085#4;
     |FINSI;

|FPRC;

|DEFBUCLE dsmow085I;
     #dsmow085#1;
     ;
     #190#0,#190#1,#190#2,#190#3,nDCompl,nDActiv,"            ",0000,"A","  ", 0;
     #190#0,#190#1,#190#2,#190#3,nHCompl,nHActiv,"zzzzzzzzzzzz",9999,"A","zz", 9;
     be;
     NULL, dsmow085I;
|FIN;

|PROCESO dsmow014I;
     #dsm190ca#0 = #dsmow014#0;
     #dsm190ca#1 = #dsmow014#1;
     #dsm190ca#2 = #dsmow014#2;
     #dsm190ca#3 = 190;
     nDCompl = 00;
     nHCompl = 99;
     nDActiv = 00;
     nHActiv = 99;

     |BUCLE dsmow085I;
|FPRC;

|DEFBUCLE dsmow014I;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, dsmow014I;
|FIN;

|PROCESO Boton5;
     |PUSHV 16272280;
     |PINPA #0#dsmow134;
     |PINDA #0#dsmow134;
     |ENDATOS #1#dsmow134;
     |SI FSalida ! 0;
          |POPV;
          |ACABA;
     |FINSI;
     |POPV;

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI nSwMasivo = 0;
          |INFOR "dsmow08m";
          ||   ... ... |INFOR "dsmow085";
     |SINO;
          |INFOR "dsmow08m";
     |FINSI;

     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |SI nSwMasivo = 0;
          nDCompl = #dsm190ca#4;
          nHCompl = #dsm190ca#4;
          nDActiv = #dsm190ca#5;
          nHActiv = #dsm190ca#5;

          |BUCLE dsmow085I;
     |SINO;
          |BUCLE dsmow014I;
     |FINSI;

     |PIEINF;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO dsmow014;
     #dsm190ca#0 = #dsmow014#0;
     #dsm190ca#1 = #dsmow014#1;
     #dsm190ca#2 = #dsmow014#2;
     #dsm190ca#3 = 190;

     nDCompl = 00;
     nHCompl = 99;
     nDActiv = 00;
     nHActiv = 99;

     |ABRE #dsmow085;
     |ABRE #dsmow185;

     |SI #dsm190ca#1 [ 2015;  |BUCLE dsm190liD;  |FINSI;
     |SI #dsm190ca#1 ] 2016;  |BUCLE dsm19001D;  |FINSI;

     |ABRET #dsmom026;
     |HAZ Historico;
     |CIERRAT #dsmom026;

     |CIERRA #dsmow185;
     |CIERRA #dsmow085;

     nHay = 0;

     nDCompl = 00;
     nHCompl = 99;
     nDActiv = 00;
     nHActiv = 99;

     |BUCLE dsmow085;
|FPRC;

|DEFBUCLE dsmow014;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, dsmow014;
|FIN;

|PROCESO Diferencias;
     |DBASS aBase;  |QBF aBase;
     aPathLaboral = aBase + "laboral/def/nomhicca.mas";
     |XABRE "E", aPathLaboral, nHandle;
     |SI FSalida < 0;
         |MENAV "    No existe la Gestion Laboral. ....";
         |ACABA;
     |FINSI;

     aPathLaboral = aBase + "laboral/fich/";
     |PATH_DAT #nomhicca#aPathLaboral#;
     |PATH_DAT #nomhicli#aPathLaboral#;
     |PATH_DAT #nomconli#aPathLaboral#;
     |PATH_DAT #nomconca#aPathLaboral#;
     |PATH_DAT #nomcorli#aPathLaboral#;
     |PATH_DAT #nomnotay#aPathLaboral#;

     aFichero = ("85" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dsmow085#aFichero#;
     |ABRE #dsmow085;  |CIERRA #dsmow085;  |DELINDEX #dsmow085;

     aFichero = ("86" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dsmow185#aFichero#;
     |ABRE #dsmow185;  |CIERRA #dsmow185;  |DELINDEX #dsmow185;

     |SI nSwMasivo = 0;
          |ABRE #dsmow185;
          |ABRE #dsmow085;

          nDCompl = #dsm190ca#4;
          nHCompl = #dsm190ca#4;

          nDActiv = #dsm190ca#5;
          nHActiv = #dsm190ca#5;

          |SI #dsm190ca#1 [ 2015;  |BUCLE dsm190liD;  |FINSI;
          |SI #dsm190ca#1 ] 2016;  |BUCLE dsm19001D;  |FINSI;

          |ABRET #dsmom026;
          |HAZ Historico;
          |CIERRAT #dsmom026;

          |CIERRA #dsmow085;
          |CIERRA #dsmow185;

          nHay = 0;
          nDCompl = #dsm190ca#4;
          nHCompl = #dsm190ca#4;
          nDActiv = #dsm190ca#5;
          nHActiv = #dsm190ca#5;

          |BUCLE dsmow085;

          |SI nHay = 0;
              |MENAV "0000 No existen diferencias entre el Historico y el Modelo.";
              |DELINDEX #dsmow185;
              |DELINDEX #dsmow085;
              |ACABA;
          |FINSI;

          |PUSHV 0501 2380;

          |PINPA #0#dsmow085;

          |CONTROL_SIMPLE 0, "BOTON,  Imprimir Diferencias ", 2235, 2265, Boton5;
          nBoton5 = FSalida;

          |ENTLINEAL #1#dsmow085, -7, 4, 22, 0, Baja085, Alta085;

          |FIN_CONTROL_WINDOWS nBoton5;

          |POPV;

          |DELINDEX #dsmow085;
          |DELINDEX #dsmow185;
     |SINO;
          aFichero = ("imp" + Usuario) % 108;
          |NOME_DAT #dsmow014#aFichero#;

          |BUCLE dsmow014;

          |HAZ Boton5;
          |DELINDEX #dsmow085;
          |DELINDEX #dsmow185;
     |FINSI;
|FPRC;
