|FICHEROS;
     dsmoz071 #0;

     dsmom080 #80;
     dsmom081 #81;
     dsmom082 #82;
     dsmom083 #83;

     dsmom085 #85;
     dsmom087 #87;
|FIN;

|VARIABLES;
   nSwEx80 = 0;
   nSwEx82 = 0;
   enSwError = 0;
   nInkey = 0;
   aCam10 = "";
   aAlfa  = "";
   &aCm9  = "";
   &aCm11 = "";
   &aCm13 = "";
   nNume1 = 0;
   nPregunta  = 0;
   nSwComplem = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Nosi; |TIPO 12;
|FPRC;

|PROCESO AntesFuncion; |TIPO 7;
 aAlfa = "    <F2> Consultar acumulados";
 |SI enEjer [ 2010;
     aAlfa = "    <F2> Consultar acumulados, <F3> volver a calcular IMPORTE de prorrata";
 |FINSI;
 |MENSA aAlfa;
|FPRC;

|PROCESO LaFuncion;
  nInkey = FSalida;

 |BLIN 4;
 |SI nInkey = 10; |O nInkey = 11;

     |PUSHV 0924 2380;
     |SI nInkey = 10;
         |SI enEjer [ 2010;
             |SUB_EJECUTA_NP "dsmom080";
         |SINO;
             |SUB_EJECUTA_NP "dsmom085";
         |FINSI;
     |FINSI;
     |POPV;

     |SI nInkey = 11; |Y enEjer > 2010;
         |ERROR;
         |ACABA;
     |FINSI;

     |SI nInkey = 11;
         |SI aCm11 = "X";
             |MENAV "     Modelo ya Remesado. No se puede calcular Importe Prorrata";
             |ACABA;
         |FINSI;

         |SI aCm13 = "X";
             |MENAV "     Modelo ya Archivado. No se puede calcular Importe Prorrata";
             |ACABA;
        |FINSI;

         aAlfa = "Desea volver a Calcular el Importe Prorrata ?";
         |SI aCm9 = "X";
             aAlfa = "Modelo ya Impreso. " + aAlfa;
         |FINSI;
         aAlfa = "0000N" + aAlfa;

         |CONFI aAlfa;
         |SI FSalida = 0;
             |HAZ GrabaNoEl82;
             |MENAV "0000RECUERDE QUE DEBE VOLVER A CALCULAR EL MODELO";
             enSwError = 0;
             |SUB_EJECUTA_NP "dsmozp81";
             |SI enSwError = 1;
                 |MENAV "    EMPRESA SIN PRORRATA";
             |SINO;
                  |HAZ LeeEl82;
                  |HAZ PintaDatos;
             |FINSI;
         |SINO;
             nInkey = 0;
         |FINSI;
     |FINSI;
     |ERROR;
 |FINSI;
|FPRC;

|PROCESO Leemom087;
 |SI #87#4 = enComplem;
     #0#6  = #0#6  + #87#8;
     #0#12 = #0#12 + #87#9;
     #0#9  = #0#6 - #0#12;
 |SINO;
     nSwComplem = 1;
 |FINSI;
|FPRC;

|DEFBUCLE Leemom087;
 #87#1;
 ;
 enEmpresa, enEjer, enPeriodo, enModelo, 00, 00, 0, 00;
 enEmpresa, enEjer, enPeriodo, enModelo, 99, 99, 9, 99;
 e;
 NULL, Leemom087;
|FIN;

|PROCESO PintaDatos;
    nSwComplem = 0;
    |SI enEjer [ 2010;
         #0#3 = #82#7;
         |SI enPeriodo = 12;
             #0#4 = #80#4;
         |SINO;
             #0#4 = #80#2;
         |FINSI;
         #0#7  = #82#8;

         #0#5  = #82#4;
         #0#6  = #82#3;
         #0#8  = #82#5;
         #0#9  = #82#6;
         #0#12 = #82#39;
         #0#10 = #82#30;
         aCam10 = #0#10;
    |SINO;
         |HAZ PerLiteral;
         |BUCLE Leemom087;
         |SI #0#2 = 12;
             #0#4 = #85#4;
             #0#5 = #85#5;
         |SINO;
             #0#4 = #85#2;
             #0#5 = #85#3;
         |FINSI;
    |FINSI;

    |SI enPeriodo = 12; |Y enEjer ] 2009;
         |SI enEjer [ 2010;
             #0#13 = #80#45;
             #0#14 = #80#13;
         |SINO;
             #0#13 = #85#12;
             #0#14 = #85#13;
         |FINSI;
         |C_V #0#13,1,"S"; |C_V #0#14,1,"S";
         |ATRI S; |PINTA 1927, "Regul.aplicacion % def. pror.: ";
         |PINTA 2027, "Perdida total aplicac. pror. : "; |ATRI 0;
    |SINO;
         #0#13 = 0;
         #0#14 = 0;
         |C_V #0#13,1,"N";
         |C_V #0#14,1,"N";
    |FINSI;

    |SI enEjer ] 2011; |Y nSwComplem = 1;
        |SI enComplem > 0; aAlfa = "Datos Complementaria " + ("00" + enComplem) % -102; |FINSI;
        |SI enComplem = 0; aAlfa = "Datos Primera Declaracion "; |FINSI;
        |ATRI P; |PINTA 2250, aAlfa; |ATRI 0;
    |FINSI;

    |PINDA #0#0;
|FPRC;

|PROCESO LeeEl80;
   nSwEx80 = 0;

   |SI enEjer [ 2010;
       |ABRE #80;
       #80#0 = enEmpresa;
       #80#1 = enEjer;
       |LEE 001#80=;
       |SI FSalida ! 0;
           nSwEx80 = 1;
       |FINSI;
       |CIERRA #80;
   |SINO;
       |ABRE #85;
       #85#0 = enEmpresa;
       #85#1 = enEjer;
       |LEE 001#85=;
       |SI FSalida ! 0;
           nSwEx80 = 1;
       |FINSI;
       |CIERRA #85;
   |FINSI;
|FPRC;

|PROCESO LeeEl82;
   nSwEx82 = 0;
   |SI enEjer [ 2010;
       |ABRE #82;
       #82#0 = enEmpresa;
       #82#1 = enEjer;
       #82#2 = enPeriodo;
       |LEE 001#82=;
       |SI FSalida ! 0;
           nSwEx82 = 1;
       |FINSI;
       |CIERRA #82;
  |FINSI;
|FPRC;

|PROCESO GrabaNoEl82;
   |ABRE #82;
   #82#0 = enEmpresa;
   #82#1 = enEjer;
   #82#2 = enPeriodo;
   |LEE 101#82=;
   |SI FSalida = 0;
       #82#61 = "S";
       |GRABA 020#82a;
   |FINSI;
   |LIBERA #82;
   |CIERRA #82;
|FPRC;

|PROCESO PerLiteral;
      |SI #0#2 = 1;   #0#3 = "ENERO     ";  |FINSI;
      |SI #0#2 = 2;   #0#3 = "FEBRERO   ";  |FINSI;
      |SI #0#2 = 3;   #0#3 = "MARZO     ";  |FINSI;
      |SI #0#2 = 4;   #0#3 = "ABRIL     ";  |FINSI;
      |SI #0#2 = 5;   #0#3 = "MAYO      ";  |FINSI;
      |SI #0#2 = 6;   #0#3 = "JUNIO     ";  |FINSI;
      |SI #0#2 = 7;   #0#3 = "JULIO     ";  |FINSI;
      |SI #0#2 = 8;   #0#3 = "AGOSTO    ";  |FINSI;
      |SI #0#2 = 9;   #0#3 = "SEPTIEMBRE";  |FINSI;
      |SI #0#2 = 10;  #0#3 = "OCTUBRE   ";  |FINSI;
      |SI #0#2 = 11;  #0#3 = "NOVIEMBRE ";  |FINSI;
      |SI #0#2 = 12;  #0#3 = "DICIEMBRE ";  |FINSI;
      |SI #0#2 = 99;  #0#3 = "ANUAL     ";  |FINSI;
|FPRC;

|PROGRAMA;
|| texto para la Pantalla:
|| (Para no aplicar, dar alta en Empresas sin Prorrata)

     #0#0 = enEmpresa;
     #0#1 = enEjer;
     #0#2 = enPeriodo;

     |SI enTipoEntrada = 4;              || Consulta del Modelo

         |HAZ LeeEl80;
         |SI nSwEx80 = 1;
             |MENAV "    EMPRESA SIN PRORRATA";
             |ACABA;
         |FINSI;

         |HAZ LeeEl82;
         |SI nSwEx82 = 1;
             nPregunta = 1;
             |SI enEjer [ 2010;  nPregunta = 0;  |FINSI;
             |SI nPregunta = 0;
                 |CONFI "    SImporte de Prorrata No Calculado. Desea Calcular ahora S/N";
                 |SI FSalida = 0;
                     enSwError = 0;
                     |SUB_EJECUTA_NP "dsmozp81";
                     |SI enSwError = 1;
                         |MENAV "    EMPRESA SIN PRORRATA";
                         |ACABA;
                     |SINO;
                         |HAZ LeeEl82;
                         |SI nSwEx82 = 1; |ACABA; |FINSI;
                     |FINSI;
                 |SINO;
                     |ACABA;
                 |FINSI;
             |SINO;
                 |MENAV "    Importe de Prorrata No Calculado. ";
                 |ACABA;
             |FINSI;
         |FINSI;

         |PINPA #0#0;
         |HAZ PintaDatos;
         |ENDATOS #1#0;
   |FINSI;
|FPRO;
