|FICHEROS;
     dsmoy000;
     dsmom004;
     dsmom107;
     dsmom025;

     dsmo1347 #347;
     dsmo2347 #348;
     dsmo3347;
     dsmo4347;

     dsmow014;

     t1434701;
     t1434702;
     t1434703;

     :/basica/def/agicen17;

     &regisnif@;
     &clientes@;
|FIN;

|VARIABLES;
     nEmpresa   = 0;
     aAnyo      = "";

     aO1        = "";
     aO2        = "";
     aO3        = "";
     aO4        = "";
     aO5        = "";

     &eaTfno    = "";
     &enSwLinea = 0;
     &enCobro   = 0;
     &enEjer    = 0;
     &enPeriodo = 0;
     &enComplem = 0;
     &enTipoEntrada = 0;
|FIN;

|INCLUYE i_varemi;

|PROCESO ComparaSiglas_02;
    |QBF aAlfa;
    |SI aAlfa = "AL";  aAlfa = "ALAM ";  |FINSI;
    |SI aAlfa = "AD";  aAlfa = "ALDEA";  |FINSI;
    |SI aAlfa = "AP";  aAlfa = "APTOS";  |FINSI;
    |SI aAlfa = "AR";  aAlfa = "ARRAL";  |FINSI;
    |SI aAlfa = "AY";  aAlfa = "ARRY ";  |FINSI;
    |SI aAlfa = "AV";  aAlfa = "AVDA ";  |FINSI;
    |SI aAlfa = "BJ";  aAlfa = "BJADA";  |FINSI;
    |SI aAlfa = "BR";  aAlfa = "BRANC";  |FINSI;
    |SI aAlfa = "BO";  aAlfa = "BARRO";  |FINSI;
    |SI aAlfa = "BL";  aAlfa = "BLQUE";  |FINSI;
    |SI aAlfa = "CL";  aAlfa = "CALLE";  |FINSI;
    |SI aAlfa = "CJ";  aAlfa = "CLLJA";  |FINSI;
    |SI aAlfa = "CM";  aAlfa = "CMNO ";  |FINSI;
    |SI aAlfa = "CR";  aAlfa = "CTRA ";  |FINSI;
    |SI aAlfa = "CS";  aAlfa = "CSRIO";  |FINSI;
    |SI aAlfa = "CO";  aAlfa = "COL  ";  |FINSI;
    |SI aAlfa = "CN";  aAlfa = "CJTO ";  |FINSI;
    |SI aAlfa = "CT";  aAlfa = "CUSTA";  |FINSI;
    |SI aAlfa = "CH";  aAlfa = "CHLET";  |FINSI;
    |SI aAlfa = "ED";  aAlfa = "EDIFC";  |FINSI;
    |SI aAlfa = "EN";  aAlfa = "ENTD ";  |FINSI;
    |SI aAlfa = "ES";  aAlfa = "ESCAL";  |FINSI;
    |SI aAlfa = "EX";  aAlfa = "EXPLA";  |FINSI;
    |SI aAlfa = "EM";  aAlfa = "EXTRM";  |FINSI;
    |SI aAlfa = "ER";  aAlfa = "EXTRR";  |FINSI;
    |SI aAlfa = "GL";  aAlfa = "GTA  ";  |FINSI;
    |SI aAlfa = "GV";  aAlfa = "G.V. ";  |FINSI;
    |SI aAlfa = "GR";  aAlfa = "GRUPO";  |FINSI;
    |SI aAlfa = "JR";  aAlfa = "JDIN ";  |FINSI;
    |SI aAlfa = "LG";  aAlfa = "LUGAR";  |FINSI;
    |SI aAlfa = "MS";  aAlfa = "MASIA";  |FINSI;
    |SI aAlfa = "MC";  aAlfa = "MERC ";  |FINSI;
    |SI aAlfa = "MT";  aAlfa = "MONTE";  |FINSI;
    |SI aAlfa = "ML";  aAlfa = "MUELL";  |FINSI;
    |SI aAlfa = "PQ";  aAlfa = "PQUE ";  |FINSI;
    |SI aAlfa = "PQ";  aAlfa = "PQUE ";  |FINSI;
    |SI aAlfa = "PD";  aAlfa = "PTDA ";  |FINSI;
    |SI aAlfa = "PJ";  aAlfa = "PSAJE";  |FINSI;
    |SI aAlfa = "PS";  aAlfa = "PASEO";  |FINSI;
    |SI aAlfa = "PZ";  aAlfa = "PLAZA";  |FINSI;
    |SI aAlfa = "PB";  aAlfa = "PBDO ";  |FINSI;
    |SI aAlfa = "PG";  aAlfa = "POLIG";  |FINSI;
    |SI aAlfa = "PR";  aAlfa = "PROL ";  |FINSI;
    |SI aAlfa = "PT";  aAlfa = "PNTE ";  |FINSI;
    |SI aAlfa = "PU";  aAlfa = "PTA  ";  |FINSI;
    |SI aAlfa = "RM";  aAlfa = "RAMAL";  |FINSI;
    |SI aAlfa = "RB";  aAlfa = "RBLA ";  |FINSI;
    |SI aAlfa = "RP";  aAlfa = "RAMPA";  |FINSI;
    |SI aAlfa = "RR";  aAlfa = "RIERA";  |FINSI;
    |SI aAlfa = "RC";  aAlfa = "RCON ";  |FINSI;
    |SI aAlfa = "RD";  aAlfa = "RONDA";  |FINSI;
    |SI aAlfa = "RU";  aAlfa = "RUA  ";  |FINSI;
    |SI aAlfa = "SC";  aAlfa = "SECT ";  |FINSI;
    |SI aAlfa = "SD";  aAlfa = "SENDA";  |FINSI;
    |SI aAlfa = "SB";  aAlfa = "SBIDA";  |FINSI;
    |SI aAlfa = "TO";  aAlfa = "TRRNT";  |FINSI;
    |SI aAlfa = "TR";  aAlfa = "TRVA ";  |FINSI;
    |SI aAlfa = "UR";  aAlfa = "URB  ";  |FINSI;
    |SI aAlfa = "VI";  aAlfa = "VIA  ";  |FINSI;
    |SI aAlfa = "VP";  aAlfa = "VIA  ";  |FINSI;
|FPRC;

|PROCESO Cargat1434701;
     enCodCli = #dsmo1347#0;
     |HAZ LeePersona;

     |DDEFECTO #t1434701;

     #t1434701#0  = "1";

     #t1434701#1  = "347";

     #t1434701#2  = #dsmo1347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #t1434701#3   = eaVarDni;

         eaAlfa   = #clientes@#1;  |HAZ QuitaRaros;
         #t1434701#4   = eaAlfa;

         eaAlfa   = #clientes@#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #clientes@#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #t1434701#6   = eaAlfa;

         eaAlfa   = #clientes@#53;  |HAZ QuitaRaros;
         #t1434701#7   = eaAlfa;

         eaDeleg     = #clientes@#17;
         eaAdmin     = #clientes@#18;
         eaAlfa      = #clientes@#38;  |HAZ QuitaRaros;
         eaProvincia = eaAlfa;
     |SINO;
         aAlfa = #clientes@#96; |QBF aAlfa; |SI aAlfa = ""; #clientes@#96 = #clientes@#2; |FINSI;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #t1434701#3   = eaVarDni;

         eaAlfa   = #clientes@#1;   |HAZ QuitaRaros;
         #t1434701#4   = eaAlfa;

         eaAlfa   = #clientes@#14;  |HAZ QuitaRarosTfno;
         |QBF eaAlfa;
         |SI eaAlfa = "";  eaAlfa = "000000000";  |FINSI;
         #t1434701#6   = eaAlfa;

         eaAlfa   = #clientes@#96;  |HAZ QuitaRaros;
         #t1434701#7   = eaAlfa;

         eaDeleg     = #clientes@#91;
         eaAdmin     = #clientes@#92;
         eaAlfa      = #clientes@#12;  |HAZ QuitaRaros;
         eaProvincia = eaAlfa;
     |FINSI;

     #t1434701#5  = "D";
     #t1434701#5  = "T";
     #t1434701#8 = "3470000000000";

     |SI enDirecta = 1;
         |HAZ CalcJustificante;
         #t1434701#8 = eaJusti;
     |FINSI;

     nNume   = #dsmo1347#6 + #dsmo1347#8 + #dsmo1347#10 + #dsmo1347#12 + #dsmo1347#14 + #dsmo1347#20 + #dsmo1347#22;
     #t1434701#12 = ("000000000" + nNume) % -109;

     enNume  = #dsmo1347#7 + #dsmo1347#9 + #dsmo1347#11 + #dsmo1347#13 + #dsmo1347#15 + #dsmo1347#21 + #dsmo1347#23;
     |HAZ Conver16Signo;
     #t1434701#13 = eaAlfa;

     #t1434701#14 = ("000000000" + #dsmo1347#16) % -109;

     enNume  = #dsmo1347#17;   |HAZ Conver16Signo;  #t1434701#15 = eaAlfa;

     |SI #dsmo1347#19 = "C";
         #t1434701#9  = "C";
         #t1434701#11 = #dsmo1347#18;
     |FINSI;

     |SI #dsmo1347#19 = "S";
         #t1434701#10 = "S";
         #t1434701#11 = #dsmo1347#18;
     |FINSI;

     #t1434701#19 = &13 + &10;

     nHCampo = 19;
     |SI eaOpcion ! "3";  nHCampo = 18;  |FINSI;

     aAlfa = "";
     |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #t1434701#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;

     nTRegistro = nTRegistro + 1;
|FPRC;

|PROCESO Registro2R_02;
                          nHCampo = 32;
     |SI eaOpcion ! "3";  nHCampo = 31;  |FINSI;

     aAlfa = "";
     |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #t1434702#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     nTRegistro = nTRegistro + 1;
     enSwLinea  = 1;
|FPRC;

|PROCESO dsmo4347_02;
     enCobro = #dsmo4347#11;
     |SI #dsmo4347#11 = 0;  |ACABA;  |FINSI;

     enNume  = #dsmo4347#11;  |HAZ Conver15;  #t1434702#15 = eaAlfa;

     #t1434702#17 = #dsmo4347#10;

     |SI enSwLinea ! 0;
         enNume = 0;  |HAZ Conver16Signo;
         #t1434702#12 = eaAlfa;
         #t1434702#16 = eaAlfa;
         #t1434702#18 = eaAlfa;
         #t1434702#19 = eaAlfa;
         #t1434702#20 = eaAlfa;
         #t1434702#21 = eaAlfa;
         #t1434702#22 = eaAlfa;
         #t1434702#23 = eaAlfa;
         #t1434702#24 = eaAlfa;
         #t1434702#25 = eaAlfa;
     |FINSI;

     |HAZ Registro2R_02;
|FPRC;

|DEFBUCLE dsmo4347_02;
    #dsmo4347#1;
    ;
    #348#0, #348#1, #348#2, #348#3, #348#4, #348#5, #348#6, #348#7, aO1, aO2, aO3, aO4, aO5, 2990;
    #348#0, #348#1, #348#2, #348#3, #348#4, #348#5, #348#6, #348#7, aO1, aO2, aO3, aO4, aO5, 2008;
    ;
    NULL, dsmo4347_02;
|FIN;

|PROCESO Cargat1434702;           || Registro 02
     enCodCli = #dsmo1347#0;
     |HAZ LeePersona;

     |DDEFECTO #t1434702;

     #t1434702#0  = "2";

     #t1434702#1  = "347";

     #t1434702#2  = #dsmo1347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #t1434702#3   = eaVarDni;
     |SINO;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #t1434702#3   = eaVarDni;
     |FINSI;

     |ABRE #dsmom025;
     #dsmom025#0 = #dsmo2347#7;
     |LEE 040#dsmom025.=;
     |SI FSalida = 0;
         #t1434702#4 = "";
     |SINO;
         eaVarDni = #dsmo2347#7;  |HAZ CalculameDNI;
         |SI #dsmo2347#10 = "N";
             #t1434702#4 = eaVarDni;
         |SINO;
             #t1434702#5 = eaVarDni;
         |FINSI;
     |FINSI;
     |CIERRA #dsmom025;

     eaAlfa   = #dsmo2347#11;  |HAZ QuitaRaros;
     #t1434702#6 = eaAlfa;

     #t1434702#7  = "D";

     eaCodNif = #dsmo2347#7;
     |HAZ LeeNifs;

     eaAlfa = #regisnif@#8;
     |HAZ QuitaRarosTfno;
     eaTfno = eaAlfa;

     #t1434702#8   = ("00" + #regisnif@#4) % -102;

     #t1434702#9   = "   ";
     |SI #regisnif@#4 = 99;
         #t1434702#4  = "";
         #t1434702#9  = #regisnif@#12;

         eaPaisCCE    = #regisnif@#12; |HAZ PaisCCE;
         |SI eSwPaisCCE = 1;
             aAlfa        = #t1434702#9 + #regisnif@#0;  |QBT aAlfa;
             #t1434702#26 = aAlfa;
         |FINSI;
     |FINSI;

     #t1434702#10  = "";
     #t1434702#11  = #dsmo2347#6;

     enNume = #dsmo2347#12;  |HAZ Conver16Signo;  #t1434702#12 = eaAlfa;

     |SI #dsmo2347#8 = "S";  #t1434702#13 = "X";  |FINSI;

     |SI #dsmo2347#9 = "S";  #t1434702#14 = "X";  |FINSI;

     enCobro = #dsmo2347#13;
     |SI #dsmo2347#13 ! 0;
         enNume = #dsmo2347#13;  |HAZ Conver15;  #t1434702#15 = eaAlfa;
         #t1434702#17 = #dsmoy000#6;
     |FINSI;

     enNume = #dsmo2347#14;  |HAZ Conver16Signo;  #t1434702#16 = eaAlfa;
     enNume = #dsmo2347#16;  |HAZ Conver16Signo;  #t1434702#18 = eaAlfa;
     enNume = #dsmo2347#20;  |HAZ Conver16Signo;  #t1434702#19 = eaAlfa;
     enNume = #dsmo2347#17;  |HAZ Conver16Signo;  #t1434702#20 = eaAlfa;
     enNume = #dsmo2347#21;  |HAZ Conver16Signo;  #t1434702#21 = eaAlfa;
     enNume = #dsmo2347#18;  |HAZ Conver16Signo;  #t1434702#22 = eaAlfa;
     enNume = #dsmo2347#22;  |HAZ Conver16Signo;  #t1434702#23 = eaAlfa;
     enNume = #dsmo2347#19;  |HAZ Conver16Signo;  #t1434702#24 = eaAlfa;
     enNume = #dsmo2347#23;  |HAZ Conver16Signo;  #t1434702#25 = eaAlfa;

     |SI #dsmo2347#27 = "S";  #t1434702#27 = "X";  |FINSI;
     |SI #dsmo2347#25 = "S";  #t1434702#28 = "X";  |FINSI;
     |SI #dsmo2347#26 = "S";  #t1434702#29 = "X";  |FINSI;

     enNume = (#dsmo2347#28 + #dsmo2347#30);  |HAZ Conver16Signo;  #t1434702#30 = eaAlfa;

     #t1434702#32 = &13 + &10;

                          nHCampo = 32;
     |SI eaOpcion ! "3";  nHCampo = 31;  |FINSI;

     enSwLinea = 0;
     |SI #dsmo2347#6 = "A"; |O #dsmo2347#6 = "B";
         |SI #dsmo2347#12 ! 0;
             |HAZ Registro2R_02;
         |FINSI;

         aO1 = #dsmo2347#25;
         aO2 = #dsmo2347#26;
         aO3 = #dsmo2347#8;
         aO4 = #dsmo2347#9;
         aO5 = #dsmo2347#27;

         |BUCLE dsmo4347_02;

         |SI enSwLinea = 0;
            |HAZ Registro2R_02;
         |FINSI;
     |SINO;
         |HAZ Registro2R_02;
     |FINSI;
|FPRC;

|DEFBUCLE dsmo2347_02;
     #dsmo2347#1;
     ;
     #347#0, #347#1, #347#2, #347#3, #347#4, #347#5, " ", "            ", " ", " ", " ", " ", " ";
     #347#0, #347#1, #347#2, #347#3, #347#4, #347#5, "z", "zzzzzzzzzzzz", "z", "z", "z", "z", "z";
     ;
     NULL, Cargat1434702;
|FIN;

|PROCESO Cargat1434703;           || Registro 02 I
     enCodCli = #dsmo1347#0;
     |HAZ LeePersona;

     |ABRE #agicen17;
     #agicen17#0 = #dsmo3347#0;
     #agicen17#1 = #dsmo3347#5;
     #agicen17#2 = #dsmo3347#6;
     |LEE 040#agicen17.=;
     |SI FSalida ! 0;  |DDEFECTO #agicen17;  |FINSI;
     |CIERRA #agicen17;

     |DDEFECTO #t1434703;

     #t1434703#0  = "2";

     #t1434703#1  = "347";

     #t1434703#2  = #dsmo1347#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #clientes@#3;  |HAZ CalculameDNI;
         #t1434703#3   = eaVarDni;
     |SINO;
         eaVarDni = #clientes@#13;  |HAZ CalculameDNI;
         #t1434703#3   = eaVarDni;
     |FINSI;

     |ABRE #dsmom025;
     #dsmom025#0 = #dsmo3347#7;
     |LEE 040#dsmom025.=;
     |SI FSalida ! 0;
         eaVarDni = #dsmo3347#7;  |HAZ CalculameDNI;
         |SI #dsmo3347#11 = "N";
             #t1434703#4 = eaVarDni;
         |SINO;
             #t1434703#5 = eaVarDni;
         |FINSI;
     |FINSI;
     |CIERRA #dsmom025;

     eaCodNif = #dsmo3347#7;   ||Tique 27_2159
     |HAZ LeeNifs;
     |SI #regisnif@#4 = 99;
         #t1434703#4  = "";
     |FINSI;

     eaAlfa   = #dsmo3347#8;  |HAZ QuitaRaros;
     #t1434703#6 = eaAlfa;

     #t1434703#7  = "I";

     enNume = #dsmo3347#10;  |HAZ Conver15;  #t1434703#9 = eaAlfa;


     #t1434703#10 = #agicen17#17;
     #t1434703#11 = #dsmo3347#9;
     aAlfa   = #agicen17#10;  |HAZ ComparaSiglas_02;  #t1434703#12 = aAlfa;

     eaAlfa  = #agicen17#11;  |HAZ QuitaRaros;
     #t1434703#13 = eaAlfa;

     #t1434703#14 = "NUM";
     nNume   = #agicen17#12;
     #t1434703#15 = ("00000" + nNume) % -105;
     #t1434703#19 = #agicen17#13;
     #t1434703#20 = #agicen17#14;
     #t1434703#21 = #agicen17#15;

     eaAlfa  = #agicen17#8;  |HAZ QuitaRaros;
     #t1434703#24 = eaAlfa;

     #t1434703#25 = #agicen17#18;
     #t1434703#26 = ("00" + #agicen17#6) % -102;
     #t1434703#27 = (("00" + #agicen17#6) % -102) + (("000" + #agicen17#7) % -103);
     #t1434703#29 = &13 + &10;

                          nHCampo = 29;
     |SI eaOpcion ! "3";  nHCampo = 28;  |FINSI;

     aAlfa = "";
     |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #t1434703#nCampo#;
          |XGRABA nHandle2, aAlfa;
     |SIGUE;
     nTRegistro = nTRegistro + 1;
|FPRC;

|DEFBUCLE dsmo3347_02;
  #dsmo3347#1;
  ;
  #dsmo1347#0, #dsmo1347#1, #dsmo1347#2, #dsmo1347#3, #dsmo1347#4, 00, 01;
  #dsmo1347#0, #dsmo1347#1, #dsmo1347#2, #dsmo1347#3, #dsmo1347#4, 99, 99;
  ;
  NULL, Cargat1434703;
|FIN;

|PROCESO Portal347_02;
     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = #dsmow014#5;
     #dsmom004#4  = #dsmow014#7;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     enEmpresa = #dsmow014#0;
     enEjer    = #dsmow014#1;
     enPeriodo = #dsmow014#2;
     enModelo  = #dsmow014#5;
     enComplem = #dsmow014#7;
     enTipoEntrada = 92;
     |SUB_EJECUTA_NP "dsmo1347";

     |ABRE #dsmo1347;
     #dsmo1347#0  = #dsmow014#0;
     #dsmo1347#1  = #dsmow014#1;
     #dsmo1347#2  = #dsmow014#2;
     #dsmo1347#3  = #dsmow014#5;
     #dsmo1347#4  = #dsmow014#7;
     #dsmo1347#5  = 0;
     |LEE 040#dsmo1347.=;
     |SI FSalida ! 0;  |CIERRA #dsmo1347;  |ACABA;  |FINSI;
     |CIERRA #dsmo1347;

     eaFicheroPlano = "347" + (("00000" + #dsmow014#0) % -105) + ".txt";
     eaFicheroImpre = "347" + (("00000" + #dsmow014#0) % -105) + ".imp";
     eaFicheroSalid = "347" + (("00000" + #dsmow014#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #dsmow014#0) % -105) + ".txt";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Cargat1434701;
     |BUCLE dsmo2347_02;
     |BUCLE dsmo3347_02;

     |XCIERRA nHandle2;

     enEmpresa    = #dsmow014#0;
     enComple     = #dsmow014#7;
     eaNomEmpresa = #dsmow014#3;

     eaX002_10    = #t1434701#3;
     eaX002_11    = #t1434701#4;
     eaX002_12    = #dsmoy000#0;
     eaX002_13    = #dsmoy000#6;
     eaX002_14    = 99;

     |SI #t1434701#9 ! " ";
         eaX002_15 = #t1434701#9;
     |FINSI;

     |SI #t1434701#10 ! " ";
         eaX002_15 = #t1434701#10;
         eaX002_16 = #t1434701#11;
     |FINSI;

     eaX002_31 = #t1434701#12;
     enNume    = #dsmo1347#7 + #dsmo1347#9 + #dsmo1347#11 + #dsmo1347#13 + #dsmo1347#15 + #dsmo1347#21 + #dsmo1347#23;
     eaX002_32 = enNume;
     eaX002_33 = #t1434701#14;
     eaX002_34 = #dsmo1347#17;

     |HAZ PresentaPortal;
|FPRC;

|DEFBUCLE dsmow014C_02;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, Portal347_02;
|FIN;

|DEFBUCLE dsmow014N_02;
     #dsmow014#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, Portal347_02;
|FIN;

|PROCESO Bloque2014;
     |ABRE #dsmom107;
     |LEE 040#dsmom107.p;
     |SI FSalida ! 0;
         |CIERRA #dsmom107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #dsmom107;
     |FINSI;

     |LEE 040#dsmom107.p;
     |SI FSalida ! 0;  |DDEFECTO #dsmom107;  |FINSI;
     |CIERRA #dsmom107;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |HAZ BtnAnuales2012;

     |ABRE #dsmom004;
     |ABRE #dsmo1347;
     |SI #dsmoy000#8 = "C";
         |BUCLE dsmow014C_02;
     |SINO;
         |BUCLE dsmow014N_02;
     |FINSI;
     |CIERRA #dsmom004;
     |CIERRA #dsmo1347;

     |SI eaOpcion = "3";
         |HAZ SacaErrorPtl;

         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Bloque2015;
     |ABRE #dsmom107;
     |LEE 040#dsmom107.p;
     |SI FSalida ! 0;
         |CIERRA #dsmom107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #dsmom107;
     |FINSI;

     |LEE 040#dsmom107.p;
     |SI FSalida ! 0;  |DDEFECTO #dsmom107;  |FINSI;
     |CIERRA #dsmom107;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |HAZ BtnAnuales2015;

     |ABRE #dsmom004;
     |ABRE #dsmo1347;
     |SI #dsmoy000#8 = "C";
         |BUCLE dsmow014C_02;
     |SINO;
         |BUCLE dsmow014N_02;
     |FINSI;
     |CIERRA #dsmom004;
     |CIERRA #dsmo1347;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;

     |SI enDirecta = 1;  |Y enMsv = 1;  |Y enParar = 0;
         |SUB_EJECUTA "|dsmox007";
     |FINSI;
|FPRC;

|PROCESO moy34702;
     aAnyo    = #dsmoy000#6;
     aAnyo    = aAnyo % -102;
     enModelo = 347;

     |SI #dsmoy000#6 = 2014;  |HAZ Bloque2014;  |FINSI;
     |SI #dsmoy000#6 ] 2015;  |HAZ Bloque2015;  |FINSI;
|FPRC;
