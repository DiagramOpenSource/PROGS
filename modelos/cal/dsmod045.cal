|FICHEROS;
     dsmod045 #45,MANTE;

     dsmom090 #90;
     dsmom091 #91;
     dsmom092 #92;

     dsmow098 #956,MANTE;
     dsmow099 #957,MANTE;
     dsmow100 #958,MANTE;
     dsmow097 #999,MANTE;
     dsmow518 #518;

     &clientes@ #715;
     &datosper@ #718;
     &regisnif@ #709;

     referen@   #800;
|FIN;

|VARIABLES;
     &nCambio          = 0;
     nX                = 0;
     &nAnterior        = 0;
     &nEjer            = 0;
     &nPeriodo         = 0;
     &aCampo1          = "";
     &aCampo2          = "";
     &aCampo3          = "";
     &aCampo4          = "";
     &nImp22           = 0;
     &nImp23           = 0;
     &nImp24           = 0;
     &nImp25           = 0;
     &nImp26           = 0;
     &nImp27           = 0;
     &nImp27N          = 0;
     &aa1              = "";
     &aa2              = "";
     &aa3              = "";
     &aa4              = "";
     &aa5              = "";
     nForma            = 0;
     nModo             = 0;
     nCampo1           = 0;
     nCampo2           = 0;
     nCampo3           = 0;

     aJustif           = "";
     aBase             = "";
     aMas              = "";
     aPathConta        = "";

     fFechaEmi         = @;

     &enConversor      = 0;
     &enPerConta       = 0;
     &eaLaMonEmp       = 0;
     &enControla       = 0;

     &enEjer           = 0;
     &enSwOpPar        = 0;
     &enPeriodoPar     = 0;
     &enSwPartido      = 0;
     &swerror          = 0;

     &nPer349        = 0;
     nBaseImpo349    = 0;
     nCuota349       = 0;
     &enPeriodo      = 0;
     &enActividad    = 0;
     &enTipoEntrada  = 0;
     nModelo         = 0;
     &eaNombreAct    = 0;
     &enModelo349    = 0;
     &enComplem      = 0;
     nEntrada        = 0;
     &eaCaptura      = "";
     &eaComunidad    = "";
     &eaComunero     = "";
     nCompl          = 0;
|FIN;

|INCLUYE i_varemi;

|PROCESO Periodo;
     |SI #999#5 = "T";
         |SI #45#3 ! 3;  |Y #45#3 ! 6;  |Y #45#3 ! 9; |Y #45#3 ! 12;
             |MENAV "     El Modelo lo tiene configurado Trimestral debe ser debe 3, 6, 9 o 12";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI #999#5 = "A";
         |SI #45#3 ! 99;
             |MENAV "     El Modelo lo tiene configurado Anual debe ser debe 99";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo1_045; |TIPO 1;
 nEntrada = (FEntrada / 100) ! 0;
|FPRC;

|PROCESO Grabo045;

     #45#0 = #90#0;
     #45#1 = #90#1;
     #45#2 = nEjer;
     #45#3 = nPeriodo;
     #45#4 = 0;
     #45#5 = #90#22;
     #45#7 = #90#19;
     #45#8 = #90#2;

     |PDEFECTO #45, 19, 28;
     #45nAnterior = "X";
     #45#28 = "X"; #45#29 = " ";
     |SI #90#3 = "C"; #45#28 = " "; #45#29 = "X"; |FINSI;
     #45#30 = #90#4;
     #45#31 = #90#5;
     #45#32 = #90#6;
     #45#33 = #90#7;
     #45#34 = #90#8;
     #45#35 = #90#11; |SI #90#11  [ "01.01.0000"; #45#35 = #90#10; |FINSI;
     |SI nAnterior = 21; |O nAnterior = 26;
         #45#36 = aCampo1;
         #45#37 = aCampo2;
         #45#38 = aCampo3;
         #45#39 = aCampo4;
     |FINSI;
     #45#40 = #90#12;
     #45#41 = #90#13;
     #45#42 = #90#14;
     #45#43 = #90#15;
     #45#44 = #90#16;
     #45#45 = nImp22;
     #45#46 = nImp23;
     #45#47 = nImp24;
     #45#48 = nImp25;
     #45#49 = nImp26;
     #45#51 = nImp27N;
     #45#50 = nImp24 + nImp25;
     #45#18 = #45#50;
     #45#52 = #90#24;
     #45#53 = #90#25;
     #45#54 = #90#26;
     |GRABA 020#45a;
     |LIBERA #45;
|FPRC;

|PROCESO SoloX; |TIPO 0;
  |C_M #957#0,1,"S";
  |C_M #957#1,1,"S";
  |SI FSalida = 2; |ACABA; |FINSI;

  |SI Campo = 0;
      |SI #957Campo = "X";
          #957#1 = " "; |PINTA #957#1; |C_M #957#1,1,"N";
      |FINSI;
  |FINSI;
  |SI Campo = 1;
      |SI #957Campo = "X";
          #957#0 = " "; |PINTA #957#0; |C_M #957#0,1,"N";
      |SINO;
          #957#0 = "X"; |PINTA #957#0;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO SoloUnaX; |TIPO 0;
  |SI #956Campo = "X";
      |PARA nCampo1 = 0; |SI nCampo1 [ 8; |HACIENDO nCampo1 = nCampo1 + 1;
            |SI Campo ! nCampo1;
                #956nCampo1 = " "; |PINTA #956nCampo1;
            |FINSI;
      |SIGUE;
  |FINSI;
  |SI Campo = 8;
      nX = 0;
      |PARA nCampo1 = 0; |SI nCampo1 [ 8; |HACIENDO nCampo1 = nCampo1 + 1;
            |SI #956nCampo1 = "X";
                 nX = 1;
            |FINSI;
      |SIGUE;
      |SI nX = 0; #956nAnterior = "X"; |PINTA #956nAnterior; |FINSI;
  |FINSI;
|FPRC;

|PROCESO Boton1;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton6, "HIDE";
     |ESTADO_CONTROL nBoton7, "HIDE";

     |PUSHV 0501 2380;
     #956#0 = #45#19;
     #956#1 = #45#20;
     #956#2 = #45#21;
     #956#3 = #45#22;
     #956#4 = #45#23;
     #956#5 = #45#24;
     #956#6 = #45#25;
     #956#7 = #45#26;
     #956#8 = #45#27;
     #956#9 = #45#55;
     #956#10 = #45#56;
     #956#11 = #45#57;

     nX = 0; nAnterior = 0;
     |PARA nCampo1 = 0; |SI nCampo1 [ 8; |HACIENDO nCampo1 = nCampo1 + 1;
           |SI #956nCampo1 = "X";
                 nX = 1;
                 nAnterior = nCampo1;
            |FINSI;
     |SIGUE;
     |SI nX = 0; nAnterior = 0; #956#0 = "X"; |FINSI;

     |PINPA #0#956;
     |PINDA #0#956;
     |ENDATOS #1#956;
     |SI FSalida = 0;
         #45#19 = #956#0;
         #45#20 = #956#1;
         #45#21 = #956#2;
         #45#22 = #956#3;
         #45#23 = #956#4;
         #45#24 = #956#5;
         #45#25 = #956#6;
         #45#26 = #956#7;
         #45#27 = #956#8;
         #45#55 = #956#9;
         #45#56 = #956#10;
         #45#57 = #956#11;
     |FINSI;
     |POPV;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton6, "SHOW";
     |ESTADO_CONTROL nBoton7, "SHOW";
|FPRC;

|PROCESO Boton2;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton6, "HIDE";
     |ESTADO_CONTROL nBoton7, "HIDE";

     |PUSHV 0501 2380;
     |PARA nCampo1 = 0; |SI nCampo1 [ 16; |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 + 28;
           #957nCampo1 = #45nCampo2;
     |SIGUE;
     #957#17 = #45#52;
     #957#18 = #45#53;
     #957#19 = #45#54;

     aAlfa1 = "N";
     |SI #45#22 = "X"; |O #45#26 = "X";
         aAlfa1 = "S";
     |FINSI;
     |C_M #957#8, 1, aAlfa1; |C_M #957#9,  1, aAlfa1;
     |C_M #957#10,1, aAlfa1; |C_M #957#11, 1, aAlfa1;

     |PINPA #0#957;
     |PINDA #0#957;
     |ENDATOS #1#957;
     |SI FSalida = 0;
         |PARA nCampo1 = 0; |SI nCampo1 [ 16; |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2 = nCampo1 + 28;
               #45nCampo2 = #957nCampo1;
         |SIGUE;
          #45#52 = #957#17;
          #45#53 = #957#18;
          #45#54 = #957#19;
     |FINSI;
     |POPV;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton6, "SHOW";
     |ESTADO_CONTROL nBoton7, "SHOW";
|FPRC;

|PROCESO Boton3;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton6, "HIDE";
     |ESTADO_CONTROL nBoton7, "HIDE";

     |PUSHV 0501 2380;
     #958#0 = #45#45;
     #958#1 = #45#46;
     #958#2 = #45#47;
     #958#3 = #45#48;
     #958#4 = #45#49;
     #958#5 = #45#50;
     #958#6 = #45#51;
     |PINPA #0#958;
     |PINDA #0#958;
     |ENDATOS #1#958;
     |SI FSalida = 0;
         #45#45 = #958#0;
         #45#46 = #958#1;
         #45#47 = #958#2;
         #45#48 = #958#3;
         #45#49 = #958#4;
         #45#50 = #958#5;
         #45#51 = #958#6;
     |FINSI;
     |POPV;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton6, "SHOW";
     |ESTADO_CONTROL nBoton7, "SHOW";
|FPRC;

|PROCESO Boton6;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton6, "HIDE";
     |ESTADO_CONTROL nBoton7, "HIDE";

     |IMPRE 0;
     |SI FSalida = 0;
         |INFOR "m045ch01";
         |SI FSalida = 0;
             |HAZ CargaEmpresa;

             |MENAV "      Coloque Impreso 045 y pulse una tecla para continuar";

             |PRINT;
             |PIEINF;
             |FININF;

             #45#11 = "X";
             #45#12 = fFechaEmi;
         |FINSI;
         |FINIMP;
     |FINSI;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton6, "SHOW";
     |ESTADO_CONTROL nBoton7, "SHOW";
|FPRC;

|PROCESO CargaEmpresa;
     enCodCli = #45#0;
     |HAZ LeePersona;

     |DDEFECTO #518;

     enCalcCif = 0;

     |SI enSwDeDonde = 1;
         #518#4   = (("00" + #715#15) % -102) + (("000" + #715#16) % -103);
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #518#5   = eaVarDni;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = #718#2;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #518#6 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #518#7 = eaAlfa;
         |SINO;
             eaAlfa = #715#1;  |HAZ QuitaRaros;  #518#6  = eaAlfa;
             #518#7  = ".";
         |FINSI;
         #518#8  = #715#29;
         eaAlfa  = #715#30;  |HAZ QuitaRaros;  #518#9 = eaAlfa;
         #518#10 = #715#31 % 104;
         #518#11 = #715#32;
         #518#12 = #715#33;
         #518#13 = #715#34;
         #518#14 = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
         eaAlfa  = #715#37;  |HAZ QuitaRaros;      #518#15 = eaAlfa;
         eaAlfa  = #715#38;  |HAZ QuitaRaros;      #518#16 = eaAlfa;
         eaAlfa  = #715#54;  |HAZ QuitaRarosTfno;   #518#17 = eaAlfa;

         eaDeleg     = #715#17;
         eaAdmin     = #715#18;
     |SINO;
         #518#4   = (("00" + #715#63) % -102) + (("000" + #715#64) % -103);
         eaVarDni = #715#13;  |HAZ CalculameDNI;    #518#5   = eaVarDni;
         eaAlfa   = #715#1;  |HAZ QuitaRaros;      #518#6  = eaAlfa;
         #518#7   = ".";
         #518#8   = #715#3;
         eaAlfa   = #715#4;  |HAZ QuitaRaros;      #518#9 = eaAlfa;
         #518#10 = #715#5 % 104;
         #518#11 = #715#6;
         #518#12 = #715#7;
         #518#13 = #715#8;
         #518#14 = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
         eaAlfa  = #715#11;  |HAZ QuitaRaros;     #518#15 = eaAlfa;
         eaAlfa  = #715#12;  |HAZ QuitaRaros;     #518#16 = eaAlfa;
         eaAlfa  = #715#14;  |HAZ QuitaRarosTfno; #518#17 = eaAlfa;

         eaDeleg     = #715#91;
         eaAdmin     = #715#92;
     |FINSI;

     #518#18  = #45#2;
     aAlfa1 = #45#2;
     aa1    = aAlfa1 % 101;
     aa2    = aAlfa1 % 201;
     aa3    = aAlfa1 % 301;
     aa4    = aAlfa1 % 401;

     |SI #45#3 = 3;   #518#19 = "1T";  |FINSI;
     |SI #45#3 = 6;   #518#19 = "2T";  |FINSI;
     |SI #45#3 = 9;   #518#19 = "3T";  |FINSI;
     |SI #45#3 = 12;  #518#19 = "4T";  |FINSI;
     |SI #45#3 = 99;  #518#19 = "OA";  |FINSI;

     aa5 = #518#19 % 201;
     |PUSHV 0501 2380;

     |BLANCO 0923 2380;
     |CUADRO 0923 2380;

     E_inf   = "";
     E_sup   = "10";

     |PINTA 1525, "Introduzca la Fecha de Emision del Modelo";
     fFechaEmi = ~;
     fFechaEmi = 1745 ? 1;

     eaAlfa  = fFechaEmi;  |HAZ FechaBonito;
     #518#31 = eaDiaB;
     #518#32 = eaMesB;
     #518#33 = eaAnyoB;

     |POPV;
|FPRC;

|PROCESO Boton7;
     |PTEC  806;
|FPRC;

|PROCESO CargaComple;
     |ABRE #800;
     |PARA nCompl = #45#4 - 1;  |SI nCompl ] 0;  |HACIENDO nCompl = nCompl - 1;
           #800#0 = #45#0;
           #800#1 = #45#1;
           #800#2 = #45#2;
           #800#3 = #45#3;
           #800#4 = nCompl;
           |LEE 040#800=;
           |SI FSalida = 0;
               |PARA nCampo1 = 5;  |SI nCampo1 [ 50;  |HACIENDO nCampo1 = nCampo1 + 1;
                     #45nCampo1 = #800nCampo1;
               |SIGUE;
               |SAL;
           |FINSI;
     |SIGUE;
     |CIERRA #800;
|FPRC;

|PROCESO Tipo2;  |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
         |SI #45#13 = "X";  |O #45#16 = "X";
             |MENAV "     Modelo Remesado o Archivado. No se puede dar de baja.";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     nForma = 0 +. 1;
     |SI nForma < 0;  |ACABA;  |FINSI;

     |PUSHV 0501 2380;

     |BLANCO 0923 2380;
     |CUADRO 0923 2380;
nCambio = 0;
     |SI #45#4 ! 0;
         |SI #45#9 = " ";
             |DBASE aBase;  |QBF aBase;
             aMas = aBase + "def/dsmod045.mas";
             |CARGA_DEF aMas, referen@;
             |SI FSalida = 0;
                 |HAZ CargaComple;
                 |DESCARGA_DEF #referen@;
             |FINSI;
         |FINSI;

         |SI #45#6 = "             ";
             |PINTA 1525, "Introduzca numero justificante declaracion anterior";

             E_inf   = "";
             E_sup   = "13";

             aJustif = "";
             aJustif = 1745 ? 1;
             #45#6 = aJustif;

             |BLANCO 0923 2380;
             |CUADRO 0923 2380;
         |FINSI;
     |FINSI;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Caracter declaracion ", 1024, 1279, Boton1;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Datos Maquina", 1324, 1579, Boton2;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Liquidacion", 1624, 1879, Boton3;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F7> Emision Modelo ", 1924, 2179, Boton6;
     nBoton6 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Salir", 2224, 2279, Boton7;
     nBoton7 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF7 = &255 + "829";
     aF8 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  |HAZ Boton1;  |FINSI;
         |SI aTecla = aF3;  |HAZ Boton2;  |FINSI;
         |SI aTecla = aF4;  |HAZ Boton3;  |FINSI;
         |SI aTecla = aF7;  |HAZ Boton6;  |FINSI;
         |SI aTecla = aF8;  |SAL;         |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton6;
     |FIN_CONTROL_WINDOWS nBoton7;

     |PULSATECLA;

     |POPV;

     #45#7  = #999#3;
     #45#8  = #999#4;
     #45#9  = "X";
     #45#10 = ~;
     #45#18 = #45#50;

     |PINTA #45#6;
     |PINTA #45#9;
     |PINTA #45#8;

     |SI nCambio = 1;  |HAZ ActualResto; |FINSI;
|FPRC;

|PROCESO HastaFin;
 |SI #45#3 = #800#3;
     nImp23 = #45#46 + #45#50;
 |SINO;
     #800#32 = #45#32;
     #800#33 = #45#33;
     #800#34 = #45#34;
     #800#35 = #45#35;
     #800#40 = #45#40;
     #800#41 = #45#41;
     #800#42 = #45#42;
     #800#43 = #45#43;
     #800#44 = #45#44;

     #800#46 = nImp23;
     nImp23  = nImp23 + #800#50;
     |SI #800#11 ! "S";
         |GRABA 020#800a;
     |FINSI;
 |FINSI;
 |LIBERA #800;
|FPRC;

|DEFBUCLE HastaFin;
 #800#1005;
 ;
 #45#0, #45#1, #45#2, #45#3, #45#4;
 #45#0, #45#1, #45#2,    99, #45#4;
 be;
 NULL, HastaFin;
|FIN;

|PROCESO ActualResto;
    |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsmod045.mas";
     |CARGA_DEF aMas, referen@;
     |SI FSalida = 0;

         |BUCLE HastaFin;
         |DESCARGA_DEF #referen@;
     |FINSI;

     |ABRE #90;
     #90#0 = #45#0;
     #90#1 = #45#1;
     |LEE 101#90=;
     |SI FSalida = 0;
         |SI #45#28 = "X"; #90#3 = "B"; |FINSI;
         |SI #45#29 = "X"; #90#3 = "C"; |FINSI;
         #90#4 = #45#30;
         #90#5 = #45#31;
         #90#6 = #45#32;
         #90#6 = #45#32;
         #90#7 = #45#33;
         #90#8 = #45#34;
         #90#11 = #45#35;

         #90#23 = #45#45;

         #90#12 = #45#40;
         #90#13 = #45#41;
         #90#14 = #45#42;
         #90#15 = #45#43;
         |GRABA 020#90a;
     |FINSI;
     |LIBERA #90;
     |CIERRA #90;
|FPRC;
