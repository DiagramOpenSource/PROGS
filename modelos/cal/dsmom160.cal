|FICHEROS;
  dsmom160,MANTE;
  dsmom161,MANTE;

  dsmom61@ #61;
  dsmom060;
|FIN;

|VARIABLES;
  inkey     = 0;
  esalta    = 0;
  esaltaL   = 0;
  nSwSal    = 0;
  nInkey    = 0;
  aAlfa1    = "";
  aAlfa2    = "";
  aAlfa3    = "";
  nNume1    = 0;
  nNume2    = 0;
  nNume3    = 0;
  swError   = 0;
  aClave    = "";
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

**************************************************************************
|CALCULO Lacolumna; |TIPO 7;
 |C_M #dsmom160#6, 0, aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;

 aAlfa1 = #dsmom160#6; |QBF aAlfa1;
 |SI aAlfa1 = "";
     #dsmom160#6 = #dsmom160#5; |PINTA #dsmom160#6;
 |FINSI;
|FCAL;

|RUTINA ClaveBajaL;
     #dsmom161#0  = #dsmom160#0;
     #dsmom161#1  = #dsmom160#1;
     #dsmom161#2  = #dsmom160#2;
     #dsmom161#3  = #dsmom160#3;
     #dsmom161#4  = 001;
|FRUT;

|RUTINA ClaveAltaL;
     #dsmom161#0  = #dsmom160#0;
     #dsmom161#1  = #dsmom160#1;
     #dsmom161#2  = #dsmom160#2;
     #dsmom161#3  = #dsmom160#3;
     #dsmom161#4  = 999;
|FRUT;

|PROCESO BorraLineas;
     |BORRA 140#dsmom161.a;
     |LIBERA #dsmom161;
|FPRC;

|DEFBUCLE dsmom161;
     #dsmom161#1;
     ;
     #dsmom160#0, #dsmom160#1, #dsmom160#2, #dsmom160#3, 001;
     #dsmom160#0, #dsmom160#1, #dsmom160#2, #dsmom160#3, 999;
     be;
     NULL, BorraLineas;
|FIN;

|CALCULO Tipo2_1;  |TIPO 2;
     esalta  = (FEntrada / 100) ! 0;
     |SI esalta ! 3;  |ACABA;  |FINSI;
     |BUCLE dsmom161;
|FCAL;

|PROCESO LeoM060;
     |ABRE #dsmom060;
     |SELECT #2#dsmom060;
     #dsmom060#6 = #dsmom160#0;
     #dsmom060#0 = #dsmom160#1;
     #dsmom060#1 = #dsmom160#2;
     #dsmom060#7 = #dsmom160#4;
     |LEE 041#dsmom060.=;
     |SI FSalida = 0;
         #dsmom160#5 = #dsmom060#3; |PINTA #dsmom160#5;
         #dsmom160#6 = #dsmom060#4; |PINTA #dsmom160#6;
         #dsmom160#7 = #dsmom060#5; |PINTA #dsmom160#7;
     |FINSI;
     |SELECT #1#dsmom060;
     |CIERRA #dsmom060;
|FPRC;

|CALCULO Tipo0; |TIPO 0;
     aAlfa1 = Contenido;
     esalta = (FEntrada / 100) ! 0;
     aClave = #dsmom160#4;
     |HAZ VerClave;
     |SI swError = 1;
         |ERROR;
     |SINO;
         |SI esalta = 1; |O aAlfa1 ! aClave;
             |HAZ LeoM060;
         |FINSI;
     |FINSI;
|FCAL;
||************************************************************************

|CALCULO elTipo3; |TIPO 3;
    esalta  = (FEntrada / 100) ! 0;
    nSwSal = 0;
    |ENTLINEAL #1#dsmom161, -5, 2, 21, 0, ClaveBajaL, ClaveAltaL;
|FCAL;

|CALCULO PresentaLinea;  |TIPO 7;
    nSwSal = 1;
    |ENTLINEAL #1#dsmom161, -5, 7, 21, 0, ClaveBajaL, ClaveAltaL;
|FCAL;

|| ************************************************************************
|CALCULO SalgoYa;  |TIPO 7;
     |SI nSwSal = 1;  |PTEC 807;  |FINSI;
|FCAL;

|PROCESO VerEspejo0;
  |SI #dsmom161#5 = #61#5;
      |SI #dsmom161#0 = #61#0; |Y #dsmom161#1 = #61#1; |Y #dsmom161#2 = #61#2; |Y #dsmom161#3 = #61#3;  |Y #dsmom161#4 = #61#4;
          || ... Es la misma linea
      |SINO;
          swError = 1;
          |ERROR10;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE VerEspejo;
  #dsmom61@#1005;
  ;
  #dsmom160#0, #dsmom160#1, #dsmom160#2, 01, 001;
  #dsmom160#0, #dsmom160#1, #dsmom160#2, 99, 999;
  be;
  NULL, VerEspejo0;
|FIN;

|RUTINA inf2;
   #dsmom060#6 = #dsmom161#0;
   #dsmom060#0 = #dsmom161#1;
   #dsmom060#1 = #dsmom161#2;
   #dsmom060#7 = "   ";
|FRUT;

|RUTINA sup2;
   #dsmom060#6 = #dsmom161#0;
   #dsmom060#0 = #dsmom161#1;
   #dsmom060#1 = #dsmom161#2;
   #dsmom060#7 = "zzz";
|FRUT;

|CALCULO FiltraClave; |TIPO 6;

     nInkey = FSalida;
     |SI nInkey = 10;
        |ABRE #dsmom060;
        #dsmom060#6 = #dsmom161#0;
        #dsmom060#0 = #dsmom161#1;
        #dsmom060#1 = #dsmom161#2;
        #dsmom060#7 = #dsmom160#4;
        |CONSULTA_F_CLAVE #2#dsmom060,inf2,sup2;
        #dsmom161#5 = #dsmom060#7; |PINTA #dsmom161#5;
        |CIERRA #dsmom060;
        |ERROR;
        |ACABA;
     |FINSI;

     |SI #dsmom160#4 = #dsmom161#5;
         |MENAV "    Error. Ha introducido la clave de la Linea";
         |ERROR;
         |ACABA;
     |FINSI;

     aClave = #dsmom161#5;
     |HAZ VerClave;
     |SI swError = 1;
         |ERROR;
         |ACABA;
     |FINSI;

     |DBASE aAlfa1; |QBF aAlfa1;
     aAlfa2 = aAlfa1 + "def/dsmom161.mas";
     |CARGA_DEF aAlfa2, dsmom61@;
     |SI FSalida = 0;
         swError = 0;
         |BUCLE VerEspejo;
         |DESCARGA_DEF #dsmom61@;
         |SI swError = 1;
             |MENAV "    Error Clave Ya Introducida en la Planilla";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

|FCAL;

|PROCESO VerClave;
     swError = 0;

     aAlfa1  = aClave; |QBF aAlfa1;
     |SI aAlfa1 = "";
         |MENAV "    Error. Clave en Blanco";
         swError = 1;
         |ACABA;
     |FINSI;

     aAlfa2 = aAlfa1 % 0;
     nNume1 = aAlfa2;
     |SI nNume1 ! 3;
         |MENAV "0000Error. Longitud de la Clave erronea";
         swError = 1;
         |ACABA;
     |FINSI;

    aAlfa1 = aClave % 101;
    aAlfa2 = aClave % 201;
    aAlfa3 = aClave % 301;

    |SI aAlfa1 ! #dsmom160#2; swError = 1; |FINSI;

    |SI aAlfa2 ! "Y"; |Y aAlfa2 ! "X";
        |SI aAlfa2 < "0"; |O aAlfa2 > "9";
            swError = 1;
        |FINSI;
    |FINSI;

    |SI aAlfa3 < "0"; |O aAlfa3 > "9";
        swError = 1;
    |FINSI;

    |SI swError = 1;
        |MENAV "    Clave Erronea ... ";
    |FINSI;
|FPRC;
