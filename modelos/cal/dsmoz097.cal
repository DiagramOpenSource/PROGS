|FICHEROS;
     dsmoz097 #0;
     dsmod005 #5,MANTE;

    :/basica/def/agicen14 #114;
    :/basica/def/agifigen #1000;

    dsmow041 #999,MANTE;
|FIN;

|VARIABLES;
     aFichero  = "";

     nCampo    = 0;
     nDEmpresa = 0;
     nHEmpresa = 0;
     enGraba   = 0;
     nSwExiste = 0;
     nEmpresa  = 0;
     nExiste   = 0;
     &nNingunaMas = 0;
     &nLaPrimera  = 0;

     aAlfa1 = "";
     aAlfa2 = "";
     nInkey = 0;
     esalta = 0;
     nume1  = 0;
     &enDMedio = 0;
     &enHMedio = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|CALCULO LeelaEmpresa; |TIPO 0;

  || Lee Empresa
    |ABRE #1000;
    #1000#0 = #999#0;
    |LEE 041#1000=;
    |SI FSalida ! 0;
        |MENAV "     Empresa Inexistente";
        |CIERRA #1000;
        |ERROR;
        |ACABA;
    |FINSI;
    |CIERRA #1000;
    #999#1 = #1000#1; |PINTA #999#1;

    |LEE 010#999.=;
    |SI FSalida ! 0;
        #999#0 = #1000#0;
        #999#1 = #1000#1;
        |GRABA 000#999b;
        |ERROR;
        |PTEC 824;
    |FINSI;
|FCAL;

|PROCESO BorraTransportes;
 |BORRA 020#5a;
 |LIBERA #5;
|FPRC;

|DEFBUCLE borrarTransportes;
 #5#1;
 ;
 #999#0, 00001;
 #999#0, 99999;
 be;
 NULL, BorraTransportes;
|FIN;

|PROCESO Tipo1; |TIPO 1;
 esalta = (FEntrada / 100) ! 0;
 |SI esalta = 2;
    |ERROR;
    |PTEC 824;
 |FINSI;
 |SI esalta = 3;
     |CONFI "    NEsta Seguro de Borrar todos los Transportes de esta Empresa ";
     |SI FSalida ! 0;
         |ERROR;
         |ACABA;
     |FINSI;
     |BUCLE borrarTransportes;
 |FINSI;
|FPRC;

|PROCESO leeTransporte;
 nume1 = 1;
 |ERROR10;
|FPRC;

|DEFBUCLE LeeTransportes;
 #5#1;
 ;
 #999#0, 00001;
 #999#0, 99999;
 ;
 NULL, leeTransporte;
|FIN;

|PROCESO ComprueboLinea;
 nume1 = 0;
 |BUCLE LeeTransportes;
 |SI nume1 = 0;
     |BORRA 041#999c;
 |FINSI;
 |LIBERA #999;
|FPRC;

|| **********************************************************************
|RUTINA ClaveBaja5;
     #5#0 = #999#0;
     #5#1 = 00001;
|FRUT;

|RUTINA ClaveAlta5;
     #5#0 = #999#0;
     #5#1 = 99999;
|FRUT;

|PROCESO Tipo7;  |TIPO 7;
     |SI nNingunaMas = 1;
         |SI nLaPrimera  = 0;
             |PTEC 806;
             |ACABA;
         |FINSI;
     |FINSI;
     |MENSA "    <F2> Entrar Transportes,<F4> Imprimir Informe Transportes";
     |PINTA  #999#0; |PINTA  #999#1;
     enModo = 7;
     enEmpresa   = #999#0;
     |ENTLINEAL #1#5, -2, 7, 22, 0, ClaveBaja5, ClaveAlta5;
     nLaPrimera  = 0;
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
    nInkey = FSalida;
    |SI nInkey =  10;
         enModo = 2;
         enEmpresa   = #999#0;
         |ENTLINEAL #1#5, -2, 2, 22, 0, ClaveBaja5, ClaveAlta5;
         |HAZ ComprueboLinea;
   |FINSI;

    |SI nInkey = 12;
         enEmpresa = #999#0;
         enEjer    = 0;
         enDMedio  = 1;
         enHMedio  = 99999;
         |SUB_EJECUTA_NP "dsmoy091;I";
         |ERROR;
    |FINSI;

|FPRC;
|| **********************************************************************
|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|PROCESO LeoNombre;
    nExiste = 0;
    |ABRE #1000;
    |DDEFECTO #1000;
    #1000#0 = nEmpresa;
    |LEE 041#1000=;
    |SI FSalida ! 0; nExiste = 1; |FINSI;
    |CIERRA #1000;
|FPRC;

|CALCULO PeroLaCreo;
    nEmpresa = #0#1;
    |HAZ LeoNombre;
    |SI nExiste = 1; |ACABA; |FINSI;

    #999#0 = #1000#0;
    |LEE 101#999=;
    |SI FSalida ! 0;
        #999#0 = #1000#0;
        #999#1 = #1000#1;
        |GRABA 000#999b;
    |FINSI;
    |LIBERA #999;
|FCAL;

|PROCESO GrabaTempo;
     |SI nEmpresa ! #5#0;
         nEmpresa = #5#0;
         |HAZ LeoNombre;

         #999#0 = #5#0;
         |LEE 101#999=;
         |SI FSalida ! 0;
             #999#0 = #5#0;
             #999#1 = #1000#1;
             |GRABA 020#999n;
             enGraba = 1;
             |SI #5#0 = #0#1; nSwExiste = 1; |FINSI;
         |FINSI;
         |LIBERA #999;
    |FINSI;
|FPRC;

|DEFBUCLE dsmod005;
     #5#1;
     ;
     nDEmpresa, 00001;
     nHEmpresa, 99999;
     ;
     NULL, GrabaTempo;
|FIN;

|RUTINA ClaveBaja999;
  |SI FSalida = "POSICION";
      #999#0 = #0#1;
  |SINO;
      #999#0 = 1;
  |FINSI;
|FRUT;

|RUTINA ClaveAlta999;
     #999#0 = 99999;
|FRUT;

|PROCESO Tipo3;  |TIPO 3;
     aFichero = ("9w" + Usuario) % 108;
     |NOME_DAT #999 aFichero;
     |DELINDEX #999;

     nSwExiste = 0;
     nDEmpresa = 00000;
     nHEmpresa = 99999;
     |SI nNingunaMas = 1;
         nDEmpresa = #0#1;
         nHEmpresa = #0#1;
     |FINSI;

     nEmpresa = -1;
     |ABRE #999;
     |BUCLE dsmod005;
     |SI nSwExiste = 0;
         |HAZ PeroLaCreo;
     |FINSI;
     |CIERRA #999;

     |PINPA #0#5;
     |C_A #999#1, 1, 80;
     nLaPrimera = 1;
     |PTEC 824;
     |ENTLINEAL #1#999, -1, 2, 5, 0, ClaveBaja999, ClaveAlta999;
     |DELINDEX #999;
|FPRC;

|PROGRAMA;
     |SI enEmpresa ! 0;
         nNingunaMas = 1;
         #0#1 = enEmpresa;
         |HAZ Tipo3;
     |SINO;
         |CLS;
         |CABEZA "Entrada de Transportes Modelo 05";
         |DDEFECTO #0;
         |PINPA #0#0;
         |PINDA #0#0;
         |ENDATOS #1#0;
     |FINSI;
|FPRO;

|PROCESO Tipo88;  |TIPO 88;
     |HAZ Relaciones;
|FPRC;
