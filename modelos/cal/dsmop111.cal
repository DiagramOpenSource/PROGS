|FICHEROS;
     dsmom002;
     dsmom004;
     dsmom006;
     dsmom026;

     :/basica/def/agifigen;
     :/basica/def/agitab99;

     dsmozpas;
     dsmow013;
|FIN;

|VARIABLES;
     nCampo          = 0;
     nDEmpresa       = 0;
     nHEmpresa       = 0;
     nMes            = 0;
     nAnyo           = 0;
     nSw110          = 0;
     nSw             = 0;
     nPorGrupos      = 0;
     nHandle         = 0;

     aAlfa           = "";
     aAlfa1          = "";
     aAlfa2          = "";
     aError          = "";
     aPeriodicidad   = "";
     aPathLaboral    = "";
     aBase           = "";
     aFicTmp         = "";

     fFecha          = @;
     fFecha1         = @;
     fFecha2         = @;

     &eaParametro    = "";
     &enSwNuevo110   = 0;
     &eaError        = "";
     &eaCampo22      = "";
     &eaCampo25      = "";
     &enNumError     = 0;
     &swerror        = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO dsmow013;
      aAlfa1 = #dsmozpas#3;
      aAlfa1 = "01.01." + aAlfa1; efFecIni = aAlfa1;
      aAlfa1 = #dsmozpas#3;
      aAlfa1 = "31.12." + aAlfa1; efFecFin = aAlfa1;
      eaNombreEmp = #dsmow013#4;
      eaNomPer    = #dsmozpas#2;
      eaNombreAct = #dsmow013#6;

      |SI eaParametro = "labornet"; |Y #dsmozpas#3 < 2016; |ACABA; |FINSI;

      enEmpresa     = #dsmow013#0;
      enEjer        = #dsmow013#2;
      enModelo      = #dsmozpas#0;
      |HAZ eOrganizaMod111;

      swerror = 0;
      |SI #agitab99#8 ! "G"; |Y eaParametro ! "labornet";
          |HAZ eCtrlActuaFras;
          |SI swerror = 1; |ACABA; |FINSI;
      |FINSI;

      |SI enSwCheqPase = 1; |Y eaParametro ! "labornet";
          enEmpresa     = #dsmow013#0;
          enEjer        = #dsmow013#2;
          enPeriodo     = #dsmow013#3;
          enModelo      = #dsmozpas#0;
          enComplem     = #dsmow013#9;
          enActividad   = #dsmow013#1;
          |HAZ BuscarSaldos;
      |FINSI;

      |SI #dsmozpas#3 [ 2010;  |HAZ Pase111_01;  |FINSI;
      |SI #dsmozpas#3 = 2011;  |HAZ Pase111_02;  |FINSI;
      |SI #dsmozpas#3 = 2012;  |HAZ Pase111_02;  |FINSI;
      |SI #dsmozpas#3 = 2013;  |HAZ Pase111_02;  |FINSI;
      |SI #dsmozpas#3 = 2014;  |HAZ Pase111_02;  |FINSI;
      |SI #dsmozpas#3 = 2015;  |HAZ Pase111_02;  |FINSI;
      |SI #dsmozpas#3 ] 2016;  |HAZ Pase111_03;  |FINSI;

      |HAZ ChequeoAnual;

      |SI enSwCheqPase = 1; |Y eaParametro ! "labornet";
          enEmpresa     = #dsmow013#0;
          enEjer        = #dsmow013#2;
          enPeriodo     = #dsmow013#3;
          enModelo      = #dsmozpas#0;
          enComplem     = #dsmow013#9;
          enActividad   = #dsmow013#1;
          |HAZ VerChequeoDatos;
      |FINSI;
|FPRC;

|DEFBUCLE dsmow013;
     #dsmow013#1;
     8;
     00001, 00, "S";
     99999, 99, "S";
     ;
     NULL, dsmow013;
|FIN;

|PROCESO Chequeo110;
     enSwNuevo110 = 0;
     |SI #dsmozpas#3 [ 2010;  |HAZ MiroChequeoNuevo;      |FINSI;
     |SI #dsmozpas#3 > 2010;  |HAZ MiroChequeoNuevo_111;  |FINSI;

     |SI enSwNuevo110 = 1;
         |SI nSw110 = 0;
             nSw110 = 1;

             |SI #dsmozpas#24 = "S";
                 |IMPRE 0;
                 |SI FSalida ! 0;
                     nSw110 = 2; |ERROR10;
                     |MENAV "    Proceso Interrumpido";
                     |ACABA;
                 |FINSI;
                 |INFOR "dspas110";
                 |SI FSalida ! 0;
                     |FINIMP;
                     nSw110 = 2; |ERROR10;
                     |MENAV "    No existe informe. Proceso Interrumpido";
                     |ACABA;
                 |FINSI;
                 |PRINT; nSw = 1;
             |SINO;
                 aError = "    N" + aError + ".Continuar";
                 |CONFI aError;
                 |SI FSalida ! 0;
                     nSw110 = 2;
                     |ERROR10;
                 |FINSI;
             |FINSI;
         |SINO;
             |SI #dsmozpas#24 = "S";
                 |PRINT; nSw = 1;
             |SINO;
                 aError = "    " + aError;
                 |MENAV aError;
             |FINSI;
             nSw110 = 1;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsmom002Cheq;
     aPeriodicidad = "T";
     |SI #dsmom002#7 = "MENSUAL   ";  aPeriodicidad = "M";  |FINSI;
|FPRC;

|DEFBUCLE dsmom002Cheq;
     #dsmom002#1;
     ;
     #agifigen#0, 00, 110;
     #agifigen#0, 99, 110;
     ;
     NULL, dsmom002Cheq;
|FIN;

|PROCESO agifigen_lab;
     nPorGrupos = 0;
     |ABRE #dsmom026;
     |SELECT #2#dsmom026;
     #dsmom026#1 = #agifigen#0;
     #dsmom026#0 = 0;
     |LEE 040#dsmom026.];
     |SI FSalida = 0;  |Y #dsmom026#1 = #agifigen#0;
         |SI #dsmom026#0 ! #dsmom026#1;      || si es la madre e hija si que hace chequeo
             nPorGrupos = 1;
         |FINSI;
     |FINSI;
     |SELECT #1#dsmom026;
     |CIERRA #dsmom026;
     |SI nPorGrupos = 1; |ACABA; |FINSI;

     aPeriodicidad = " ";
     |BUCLE dsmom002Cheq;
     |SI aPeriodicidad = "T";
         |SI #dsmozpas#1 ! 3; |Y #dsmozpas#1 ! 6; |Y #dsmozpas#1 ! 9; |Y #dsmozpas#1 ! 12;
             |ACABA;
         |FINSI;
     |FINSI;

     #dsmom004#0 = #agifigen#0;
     #dsmom004#1 = #dsmozpas#3;
     #dsmom004#2 = #dsmozpas#1;
     #dsmom004#3 = #dsmozpas#0;
     #dsmom004#4 = 0;
     |LEE 001#dsmom004.];
     |SI FSalida ! 0; |O #dsmom004#0 ! #agifigen#0; |O #dsmom004#1 ! #dsmozpas#3;
                      |O #dsmom004#2 ! #dsmozpas#1; |O #dsmom004#3 ! #dsmozpas#0;
         #dsmom006#0 = #agifigen#0;
         #dsmom006#1 = 110;
         |LEE 041#dsmom006.=;
         |SI FSalida = 0;
             |SI #dsmom006#13 = "X";  |ACABA;  |FINSI;
         |FINSI;

         aAlfa1 = #agifigen#0;
         aAlfa1 = ("00000"+ aAlfa1) % -105;
         aAlfa1 = aAlfa1 + " " + (#agifigen#1 % 130); |QBF aAlfa1;
         |SI aPeriodicidad = " ";
             aError = "Empresa: " + aAlfa1 + ", sin Modelo ";
             eaError = "en la Empresa";
         |SINO;
             aError = "Empresa: " + aAlfa1 + ", sin Modelo en el Planing";
             |SI aPeriodicidad = "T";
                 eaError = "en el Planing -Periodo Trimestral";
             |SINO;
                 eaError = "en el Planing -Periodo Mensual";
             |FINSI;
         |FINSI;

         #dsmow013#0  = #agifigen#0;
         #dsmow013#1  = 0;
         #dsmow013#2  = #dsmozpas#3;
         #dsmow013#3  = #dsmozpas#1;
         #dsmow013#4  = #agifigen#1;
         #dsmow013#5  = #dsmozpas#2;
         #dsmow013#6  = #agifigen#1;
         #dsmow013#7  = #dsmozpas#0;
         #dsmow013#8  = "N";
         #dsmow013#9  = 0;
         #dsmow013#10 = #dsmozpas#0;

         |HAZ Chequeo110;
    |FINSI;
|FPRC;

|DEFBUCLE agifigen_lab;
     #agifigen#1;
     ;
     nDEmpresa;
     nHEmpresa;
     ;
     NULL, agifigen_lab;
|FIN;

|PROCESO NuevoChequeo;
     nSw110 = 0;
     aPathLaboral = "";
     |DBASS aBase;   |QBF aBase;
     aAlfa = aBase + "laboral/def/labempre.mas";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida ] 0;
         aPathLaboral = aBase + "laboral/fich/";
     |FINSI;
     |SI aPathLaboral = ""; |ACABA; |FINSI;

     nSw = 0;
     |ABRE #dsmom004;
     |ABRE #dsmom006;
     |SI #dsmozpas#4 ! 0;
         nDEmpresa = #dsmozpas#4;
         nHEmpresa = #dsmozpas#5;
         |BUCLE agifigen_lab;
     |SINO;
         |PARA nCampo = 6;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |SI #dsmozpas#nCampo# ! 0;
                   nDEmpresa = #dsmozpas#nCampo#;
                   nHEmpresa = #dsmozpas#nCampo#;
                   |BUCLE agifigen_lab;
               |FINSI;
         |SIGUE;
     |FINSI;
     |CIERRA #dsmom006;
     |CIERRA #dsmom004;

     |SI #dsmozpas#24 = "S"; |Y nSw = 1;
         |PIEINF;
         |FININF;
         |FINIMP;
         |CONFI "    NContinuar con el Pase del Modelo 110";
         |SI FSalida ! 0;
             nSw110 = 2;
         |FINSI;
     |FINSI;
|FPRC;

|PROGRAMA;
     |SI #dsmozpas#23 = "S";
         |HAZ NuevoChequeo;
         |SI nSw110 = 2; |ACABA; |FINSI;
     |FINSI;

     |BUCLE dsmow013;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;

     eaParametro = PARAMETRO; |QBF eaParametro;
     aFicTmp = "dsmozpas" + Usuario;
     |NOME_DAT #dsmozpas#aFicTmp#;

     aFicTmp = ("pas" + Usuario) % 108;
     |NOME_DAT #dsmow013#aFicTmp#;

     |ABRE #dsmozpas;
     |LEE 000#dsmozpas.p;
     |CIERRA #dsmozpas;

     |SI eaParametro = "labornet";
         |PDEFECTO #dsmozpas, 21,27;
     |FINSI;

     |SI #dsmozpas#22 = "S"; |O #dsmozpas#25 = "S";
         |HAZ eIniciW103;
     |FINSI;

     |SI #dsmozpas#0  = 190;
      |O #dsmozpas#0  = 110;
         |HAZ eIniciW156;
     |FINSI;

     |SI eaParametro ! "labornet";
         enModelo  = #dsmozpas#0;
         enPeriodo = #dsmozpas#1;
         |HAZ VerCheqPase;
     |FINSI;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |SI #dsmozpas#22 = "S"; |O #dsmozpas#25 = "S";
         |SI enFichW103 = 1;
             eaCampo22 = #dsmozpas#22;
             eaCampo25 = #dsmozpas#25;
             |HAZ eListaW103;
         |FINSI;
     |FINSI;

     |SI enFichW156 = 1;
         |MENAV "0000Han habido errores en el pase laboral.";
         |MENAV "0000A continuacion saldra un informe en crystal reflejando los errores.";

         |HAZ eListaW156;
     |FINSI;

     |SI #dsmozpas#0 = 193;  |O #dsmozpas#0 = 296;
         |MENAV "0000Revisar los importes de Percepciones, Reducciones y Datos Valores";
     |FINSI;

     |SI enSwCheqPase = 1;
         |HAZ eListaW151;
     |FINSI;
|FPRC;
