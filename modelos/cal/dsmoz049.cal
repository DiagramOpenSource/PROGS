|FICHEROS;
   dsmoz049 #0;
   dsmow047 #1,MANTE;
   dsmom040 #40;

   :/basica/def/agifigen #1000;
|FIN;

|VARIABLES;
  nOperar     = 0;
  nCampo      = 0;
  nLaEmp      = 0;
  nPara1      = 0;
  swSi        = 0;
  swHay       = 0;
  dirfich0    = "";
  aNombre     = "";
  &swUno      = 0;
  &enEmpreOri = 0;
  &enEmpreDes = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|| =====================================================================
|CALCULO Parrilla;
     |SI #0#2 = 0;
         #0#2 = 0;  |PINTA #0#2;
         #0#3 = 0;  |PINTA #0#3;  |C_M #0#3, 1, "N";
         |PARA nCampo = 4;  |SI nCampo [ 15;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#2, 1, "S";
             |C_M #0#3, 1, "S";
         |FINSI;

         |PARA nCampo = 4;  |SI nCampo [ 15;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;
               |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 15;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 15;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|| //////////////////////////////////////////////////////////////////////////
|CALCULO estaonoW; |TIPO 0;
   nOperar = 0;
   |ABRE #1000;
   nLaEmp = #1#0;
   |HAZ LeeFichaGral;
   |SI swSi = 0;
       |MENAV "      No existe Empresa ORIGEN";
       |ERROR;
   |SINO;
      #1#1 = #1000#1; |PINTA #1#1;
      |HAZ VeoSiHay;
      |SI swHay = 0;
          |MENAV "      No existen Grupos de Amortizacion de esta Empresa";
          |ERROR;
      |FINSI;
   |FINSI;
   |CIERRA #1000;
|FCAL;

|CALCULO noestaW; |TIPO 0;
   |SI FSalida = 2; |ACABA; |FINSI;
   nOperar = 0;
   |SI #1#0 = #1#2;
       |MENAV "    ERROR. Esta introducciendo el mismo Codigo de Empresa";
       |ERROR;
       |ACABA;
   |FINSI;
   |SI #1#2 = 0;
       |ERROR; |ACABA;
   |FINSI;
   |ABRE #1000;
   nLaEmp = #1#2;
   |HAZ LeeFichaGral;
   |SI swSi = 0;
       |MENAV "      No existe Empresa Destino";
       |ERROR;
   |SINO;
       #1#3 = #1000#1; |PINTA #1#3;
       |HAZ VeoSiHay;
       |SI swHay = 1;
           |CONFI  "    NYa Existen Grupos de Amortizaciones. Continuar S/N ";
           |SI FSalida ! 0;
              |ERROR;
           |FINSI;
       |FINSI;
   |FINSI;
   |CIERRA #1000;
|FCAL;
|| //////////////////////////////////////////////////////////////////////////
|CALCULO estaono; |TIPO 0;
   nOperar = 0;
   |ABRE #1000;
   nLaEmp = #0#0;
   |HAZ LeeFichaGral;
   |SI swSi = 0;
       |MENAV "      No existe Empresa ORIGEN";
       |ERROR;
   |SINO;
      #0#1 = #1000#1; |PINTA #0#1;
      |HAZ VeoSiHay;
      |SI swHay = 0;
          |MENAV "      No existen Grupos de Amortizacion de esta Empresa";
          |ERROR;
      |FINSI;
   |FINSI;
   |CIERRA #1000;
|FCAL;

|| ////////////////////////////////////////////////////////////////////
|| ////////////////////////////////////////////////////////////////////
|PROCESO LeeFichaGral;
  swSi = 0;
  #1000#0 = nLaEmp;
  |LEE 040#1000=;
  |SI FSalida ! 0;
      |ACABA;
  |FINSI;
|| ....   |SI #1000#23 = "S"; |O nLaEmp ] 99990;  || Dejar pasar sin conta
      swSi = 1;
      aNombre = #1000#1;
|| ....   |FINSI;
|FPRC;

|PROCESO BuscoGrupos;
 swHay = 1;
 |SI nOperar = 0;
     |ERROR10;
 |SINO;
     |BORRA 020#dsmom040.a;
 |FINSI;
 |LIBERA #dsmom040;
|FPRC;

|DEFBUCLE BuscoGrupos;
 #dsmom040#1;
 ;
 nLaEmp, 0001;
 nLaEmp, 9999;
 be;
 NULL, BuscoGrupos;
|FIN;

|PROCESO VeoSiHay;
 swHay = 0;
 |BUCLE BuscoGrupos;
|FPRC;

|| ////////////////////////////////////////////////////////////////////
|PROCESO Seleccion;
  swSi = 0;
  |SI nLaEmp = #0#0; |ACABA; |FINSI;
  |HAZ LeeFichaGral;
|FPRC;


|CALCULO pasalo; |TIPO 3;
  |ABRE #1000;
  |SI #0#2 ! 0;
      |PARA nLaEmp = #0#2; |SI nLaEmp [ #0#3; |HACIENDO nLaEmp = nLaEmp + 1;
            |HAZ Seleccion;
            |SI swSi = 1;
                |HAZ locreo;
            |FINSI;
       |SIGUE;
  |SINO;
       |PARA nPara1 = 4; |SI nPara1 [ 15; |HACIENDO nPara1 = nPara1 + 1;
            nLaEmp = #0nPara1;  || Numero de Empresa
            |HAZ Seleccion;
            |SI swSi = 1;
                |HAZ locreo;
            |FINSI;
       |SIGUE;
  |FINSI;
  |CIERRA #1000;
|FCAL;

|| ////////////////////////////////////////////////////////////////////
|| ////////////////////////////////////////////////////////////////////
|PROCESO GrupsAmor0;
   #dsmom040#0 = enEmpreDes;
   #dsmom040#8 = aNombre;
   |GRABA 040#dsmom040.n;
   |LIBERA #dsmom040;
|FPRC;

|DEFBUCLE GrupsAmor;
 #dsmom040#1;
 ;
 enEmpreOri, 0001;
 enEmpreOri, 9999;
 e;
 NULL, GrupsAmor0;
|FIN;

|PROCESO locreo;
   enEmpreOri = #0#0;
   enEmpreDes = nLaEmp;

   nOperar = 1;       || Para Borrar si existen antes
   |HAZ VeoSiHay;

   |BUCLE GrupsAmor;  || grupos amortizacion
|FPRC;
|| **************************************************************************
|| **************************************************************************
|| **************************************************************************
|PROGRAMA;
 |SI swUno = 0;
     |CLS;
     |MANTE #0;
 |SINO;
     |PINPA #0#1;
     #1#0 = enEmpreOri;
     #1#2 = enEmpreDes;
     enEmpresa = enEmpreDes;
     |PINDA #0#1;
     |ENDATOS #1#1;
     |SI FSalida = 0;
         |DDEFECTO #0;
         #0#0  = #1#0;
         #0#1  = #1#1;
         #0#2  = #1#2;
         #0#3  = #1#2;
         |HAZ pasalo;
     |FINSI;
 |FINSI;
|FPRO;
