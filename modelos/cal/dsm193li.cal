|FICHEROS;
     dsm193ca;
     dsm193li,MANTE;
     dsm193ga,MANTE;

     &regisnif@;
|FIN;

|VARIABLES;
     nCampo      = 0;
     nPtec       = 0;
     nCampoD     = 0;
     nCampoO     = 0;
     nForma      = 0;
     nModo       = 0;

     nImporte    = 0;
     aMenav      = "";
     aPathModelo = "";
     aDef        = "";
     aAlfa       = "";
     aTecla      = "";

     &enError    = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Tipo88;  |TIPO 88;
     |HAZ Relaciones;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
|FPRC;

|PROCESO PonDatosNif;  |TIPO 7;
     |SI #dsm193li#6 ! "999999999999";
         eaCodNif  = #dsm193li#6;
         |HAZ LeeNifs;

         |C_M #dsm193li#12, 1, "S";
         |C_M #dsm193li#14, 1, "S";

         #dsm193li#12 = #regisnif@#1;   |PINTA #dsm193li#12;
         #dsm193li#14 = #regisnif@#4;   |PINTA #dsm193li#14;
     |SINO;
         |C_M #dsm193li#12, 1, "N";
         |C_M #dsm193li#14, 1, "N";

         #dsm193li#12 = "VALORES PENDIENTES DE ABONO";   |PINTA #dsm193li#12;
         #dsm193li#14 = 0;                               |PINTA #dsm193li#14;
     |FINSI;

     |C_M #dsm193li#13, 1, "S";
     |C_M #dsm193li#15, 1, "S";
     |C_M #dsm193li#16, 1, "S";
     |C_M #dsm193li#17, 1, "S";
     |C_M #dsm193li#18, 1, "S";
     |C_M #dsm193li#19, 1, "S";
     |SI #dsm193li#8 ! "A";  |Y #dsm193li#8 ! "B";  |Y #dsm193li#8 ! "D";
         |C_M #dsm193li#13, 1, "N";  #dsm193li#13 = "N";  |PINTA #dsm193li#13;
         |C_M #dsm193li#15, 1, "N";  #dsm193li#15 = "0";  |PINTA #dsm193li#15;
         |C_M #dsm193li#16, 1, "N";  #dsm193li#16 = "";   |PINTA #dsm193li#16;
         |C_M #dsm193li#17, 1, "N";  #dsm193li#17 = "0";  |PINTA #dsm193li#17;
         |C_M #dsm193li#18, 1, "N";  #dsm193li#18 = "";   |PINTA #dsm193li#18;
         |C_M #dsm193li#19, 1, "N";  #dsm193li#19 = "";   |PINTA #dsm193li#19;
     |FINSI;

     |SI #dsm193li#1 [ 2015;
         |C_M #dsm193li#21, 1, "S";
         |SI #dsm193li#8 ! "A";
             |C_M #dsm193li#21, 1, "N";  #dsm193li#21 = 0;    |PINTA #dsm193li#21;
         |FINSI;

         |C_M #dsm193li#27, 1, "S";
         |C_M #dsm193li#28, 1, "S";

         |SI #dsm193li#8 ! "B";  |Y #dsm193li#8 ! "D";
             |C_M #dsm193li#27, 1, "N";  #dsm193li#27 = 0;    |PINTA #dsm193li#27;
             |C_M #dsm193li#28, 1, "N";  #dsm193li#28 = 0;    |PINTA #dsm193li#28;
         |FINSI;
     |FINSI;

     |SI #dsm193li#1 ] 2016;
         #dsm193li#21 = 0;
         #dsm193li#27 = 0;
         #dsm193li#28 = 0;
     |FINSI;

     |SI #dsm193ca#15 = "S";
         |C_M #dsm193li#15, 1, "N";  #dsm193li#15 = "0";  |PINTA #dsm193li#15;
         |C_M #dsm193li#16, 1, "N";  #dsm193li#16 = "";   |PINTA #dsm193li#16;
         |C_M #dsm193li#17, 1, "N";  #dsm193li#17 = "0";  |PINTA #dsm193li#17;
         |C_M #dsm193li#18, 1, "N";  #dsm193li#18 = "";   |PINTA #dsm193li#18;
         |C_M #dsm193li#19, 1, "N";  #dsm193li#19 = "";   |PINTA #dsm193li#19;
     |FINSI;

     |SI #dsm193li#6 = "999999999999";
         ||C_M #dsm193li#18, 1, "N";  #dsm193li#18 = "";   |PINTA #dsm193li#18;
         ||C_M #dsm193li#19, 1, "N";  #dsm193li#19 = "";   |PINTA #dsm193li#19;
     |FINSI;
|FPRC;

|PROCESO Tipo7C17;  |TIPO 7;
      |C_M #dsm193li#Campo#,0,aAlfa;
      |SI aAlfa = "N"; |ACABA; |FINSI;

      |PUSHV 1330 2080;
      |BLANCO 1330 1870;
      |CUADRO 1330 1870;
      |ATRI R;
      |PINTA 1431, " 1- Emisor                             ";
      |PINTA 1531, " 2- Como Mediador valor nacional       ";
      |PINTA 1631, " 3- Como Mediador valor extranjero     ";
      |PINTA 1731, " 4- Como M. v. extranjero no retenedor ";
      |ATRI 0;
|FPRC;

|PROCESO Tipo0C17;  |TIPO 0;
      |C_M #dsm193li#Campo#,0,aAlfa;
      |SI aAlfa = "N"; |ACABA; |FINSI;

      |POPV;
      |SI #dsm193li#8 ! "C"; |Y #dsm193ca#15 = "N";
          |SI #dsm193li#Campo# = "0";
              |MENAV "0000Valor no valido";
              |ERROR;
          |FINSI;
      |FINSI;
|FPRC;

|PROCESO TipoCod;  |TIPO 0;
     |C_M #dsm193li#29, 1, "S";
     |C_M #dsm193li#30, 1, "S";
     |C_M #dsm193li#31, 1, "S";
     |C_M #dsm193li#32, 1, "S";

     |SI #dsm193li#8 ! "C"; |Y #dsm193ca#15 = "N";
         |SI #dsm193li#Campo# = " ";
             |MENAV "0000Valor no valido";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI #dsm193li#18 ! "P";
         |C_M #dsm193li#29, 1, "N";   #dsm193li#29 = "00.00.0000";  |PINTA #dsm193li#29;
         |C_M #dsm193li#30, 1, "N";   #dsm193li#30 = "00.00.0000";  |PINTA #dsm193li#30;
         |C_M #dsm193li#31, 1, "N";   #dsm193li#31 = 0;             |PINTA #dsm193li#31;
         |C_M #dsm193li#32, 1, "N";   #dsm193li#32 = 0;             |PINTA #dsm193li#32;

         |ACABA;
     |FINSI;

     |SI #dsm193li#17 ! 2;
         |MENAV "0000 El Tipo P no procede.";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #dsm193li#8 ! "A";  |Y #dsm193li#8 ! "B";  |Y #dsm193li#8 ! "D";
         |MENAV "0000 El Tipo P no procede.";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Tipo7C19; |TIPO 7;
     aAlfa = "    Formato : EEEESSSSDDCCCCCCCCCCC  Entidad + Sucursal + DC + Numero Cuenta";
     |SI #dsm193li#18 = "P"; aAlfa = "    Numero de prestamo"; |FINSI;
     |SI #dsm193li#18 = "O"; aAlfa = "    Identificacion operacion"; |FINSI;
     |MENSA aAlfa;
|FPRC;

|PROCESO Tipo0C19; |TIPO 0;
     |BLIN 4;
     |C_M #dsm193li#Campo#,0,aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     |SI #dsm193li#8 ! "C"; |Y #dsm193ca#15 = "N";
         aAlfa = #dsm193li#Campo#; |QBF aAlfa;
         |SI aAlfa = "";
             |MENAV "0000Valor no valido";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo2m193li;  |TIPO 2;
     #dsm193ca#6  = #dsm193ca#6  +. 1;
     #dsm193ca#7  = #dsm193ca#7  +. #dsm193li#23;
     #dsm193ca#8  = #dsm193ca#8  +. #dsm193li#25;

     nImporte = 0;
     |SI #dsm193ca#15 = "N";
         |SI #dsm193li#8 = "C"; nImporte = #dsm193li#25; |FINSI;
         |SI #dsm193li#8 = "A"; |O #dsm193li#8 = "B"; |O #dsm193li#8 = "D";
             |SI #dsm193li#17 = "1"; |O #dsm193li#17 = "3";
                 nImporte = #dsm193li#25;
             |FINSI;
         |FINSI;
     |FINSI;
     #dsm193li#26 = nImporte;
     #dsm193ca#9  = #dsm193ca#9  +. nImporte;
     #dsm193ca#10 = #dsm193ca#10 +. #dsm193li#27;
     #dsm193ca#11 = #dsm193ca#11 +. #dsm193li#28;
|FPRC;

|PROCESO Tipo11m193li;  |TIPO 11;
     |SI FSalida = 10;
         |SI #dsm193li#Campo# = "999999999999";  |ACABA;  |FINSI;
         eaVarDni  = #dsm193li#Campo#;
         enCalcCif = 1;
         |HAZ CalculameDNI;
         #dsm193li#Campo# = eaVarDni;
         |PINTA #dsm193li#Campo#;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO MiraDni193li;  |TIPO 6;
     |SI #dsm193li#6 = "999999999999";
         |ABRE #regisnif@;
         #regisnif@#0 = "999999999999";
         |LEE 101#regisnif@.=;
         |SI FSalida ! 0;
             |DDEFECTO #regisnif@;
              #regisnif@#0 = "999999999999";
              |GRABA 020#regisnif@.n;
         |FINSI;
         |LIBERA #regisnif@;
         |CIERRA #regisnif@;
         |ACABA;
     |FINSI;

     eaVarDni  = #dsm193li#Campo#;
     enCalcCif = 0;
     |HAZ CalculameDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #dsm193li#Campo# ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #dsm193li#Campo# = eaVarDni;  |PINTA #dsm193li#Campo#;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO T0C9;  |TIPO 0;
     |SI #dsm193ca#1 [ 2016;
         |SI #dsm193li#8 = "C";  |Y #dsm193li#9 ] 12;
             |MENAV "0000Naturaleza a partir del 2017";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo0C20;  |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |SI nModo ! 1;  |ACABA;  |FINSI;

     |SI #dsm193li#23 = 0;
         #dsm193li#23 = #dsm193li#20;   |PINTA #dsm193li#23;
     |FINSI;
|FPRC;

|PROCESO Tipo0C23;  |TIPO 0;
     |SI #dsm193li#23 ! 0;  |ACABA;  |FINSI;

     |MENAV "0000La base de retenciones es igual a cero. Revise el dato";
|FPRC;

|PROCESO Totales;
     #dsm193li#25 =  #dsm193li#23 % #dsm193li#24;

     |PINTA #dsm193li#23;
     |PINTA #dsm193li#25;
|FPRC;
