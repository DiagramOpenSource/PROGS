|FICHEROS;
     dsmoy072 #0;

     :/basica/def/agifigen #100;
     :/contasoc/def/isacceso #200;
     :/contasoc/def/isom0001 #201;
     :/contasoc/def/isocie29 #202;
     :/contasoc/def/isom9000 #302;
     :/contasoc/def/isocie59 #259;
     :/contasoc/def/isocie91 #291;
|FIN;

|VARIABLES;
     nBanco    = 0;
     nLinea    = 0;
     nChequeo  = 0;
     nMes      = 0;
     nAnyo     = 0;
     nImpor    = 0;
     nAnyoAnt  = 0;
     informe   = "";

     nDEmpresa = 0;
     nHEmpresa = 0;
     aDNombre  = "";
     aHNombre  = "";
     nSw       = 0;
     aFichero  = "";
     aAlfa     = "";
     aAlfa1    = "";
     aAlfa2    = "";
     aPathSoc  = "";
     aPer      = "";
     nEstado   = 0;

     fFecha    = @;
     aBase     = "";
     nCanal    = 0;

     nSwObligado    = 0;
     &enError       = 0;
     &fFechaDisol   = @;
     &fFechaChequeo = @;
     &fFechaChequeoF= @;
     &enRegistro    = 0;
     &enTipo202     = 0;

     &nSwLinea      = 0;
     &eSwSin        = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Tipo8y072; |TIPO 8;
      |DBASS aBase; |QBT aBase;
      aAlfa = aBase + "contasoc/def/isacceso.mas";
      |XABRE "E", aAlfa, nCanal;
      |SI FSalida < 0;
          |XCIERRA nCanal;
          |MENAV "      Sociedades No Instaldo.";
          |PTEC 807;
          |ACABA;
      |FINSI;
      |XCIERRA nCanal;
|FPRC;

|PROCESO Periodo; |TIPO 0;
     |SI #0#0 = 1;   #0#1 = "1 - PAGO  ";  |FINSI;
     |SI #0#0 = 2;   #0#1 = "2 - PAGO  ";  |FINSI;
     |SI #0#0 = 3;   #0#1 = "3 - PAGO  ";  |FINSI;

     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#2   = aAlfa;

     |PINTA #0#0;
     |PINTA #0#1;
     |PINTA #0#2;
|FPRC;

|PROCESO Cambiotitulo;
     |SI #0#20 = "S";
         #0#21 = "CON OBLIGACION DE PRESENTAR PAGOS A CUENTA EN EL MODELO 202";
     |SINO;
         #0#21 = "CHEQUEO DE SITUACION DEL MODELO 200 Y MODELO 202";
     |FINSI;
     |PINTA #0#21;
|FPRC;

|| ************************************* PROCESOS
/*
|PROCESO isacceso;
     |PDEFECTO #0, 3, 12;
     |SI #200#1 < 2008;
          |SI #200#5 = "225";
              #291#0 = #200#0;
              #291#1 = #200#1;
              |LEE 000#291=;
              |SI FSalida ! 0;  |DDEFECTO  #291;  |FINSI;

              #0#9 = #291#103;
          |SINO;
              #259#0 = #200#0;
              #259#1 = #200#1;
              |LEE 000#259=;
              |SI FSalida ! 0;  |DDEFECTO  #259;  |FINSI;

              #0#9 = #259#83;
          |FINSI;
     |SINO;
          #0#9 = #200#8;
     |FINSI;
     #0#3  = #200#0;

     enCodCli = #200#0;
     |HAZ LeePersona;
     |SI enSwDeDonde = 1;
         #0#4  = #715#3;
         #0#5  = #715#1;
         #0#6  = #715#5;
         #0#7  = #715#6;
         #0#8  = #715#7;
     |SINO;
         #0#4  = #715#13;
         #0#5  = #715#1;
         #0#6  = "";
         #0#7  = #715#93;
         #0#8  = #715#94;
     |FINSI;

     |SI #0#2 [ 2009;  |HAZ isocie29;  |FINSI;
     |SI #0#2 ] 2010;  |HAZ isom9000;  |FINSI;

     |PRINT;
|FPRC;

|DEFBUCLE isacceso;
     #200#1;
     ;
     nAnyoAnt, 00001;
     nAnyoAnt, 99999;
     ;
     NULL, isacceso;
|FIN;
*/

|PROCESO isocie29;
     #202#0 = #100#0;
     #202#1 = #0#2;
     |LEE 000#202=;
     |SI FSalida ! 0;
         #0#11 = "SIN ELABORAR";
         eSwSin = 1;
     |SINO;

         |SI #0#0 = 1;
             fFecha = #202#9;
             |SI fFecha [ "01.01.1900";
                 #0#11 = "SIN IMPRIMIR";
             |SINO;
                 #0#11 = "IMPRESO";
             |FINSI;

             #0#10 = #202#6 + #202#24;
             #0#13 = #202#3 + #202#12;
         |FINSI;

         |SI #0#0 = 2;
             fFecha = #202#10;
             |SI fFecha [ "01.01.1900";
                 #0#11 = "SIN IMPRIMIR";
             |SINO;
                 #0#11 = "IMPRESO";
             |FINSI;

             #0#10 = #202#7 + #202#25;
             #0#13 = #202#4 + #202#13;
         |FINSI;

         |SI #0#0 = 3;
             fFecha = #202#11;
             |SI fFecha [ "01.01.1900";
                 #0#11 = "SIN IMPRIMIR";
             |SINO;
                 #0#11 = "IMPRESO";
             |FINSI;

             #0#10 = #202#8 + #202#26;
             #0#13 = #202#5 + #202#14;
         |FINSI;
     |FINSI;

||     |SI #0#10 = 0;  #0#11 = "SIN ELABORAR"; eSwSin = 1; |FINSI;
     |SI #0#13 > 0; nSwObligado = 0; |FINSI;
|FPRC;

|PROCESO isom9000;
     aPer   = #0#0 + "P";

     #302#0 = #100#0;
     #302#1 = #0#2;
     #302#2 = aPer;
     #302#3 = 99;
     |LEE 000#302];
     |SI FSalida = 0;
         |LEE 000#302a;
     |SINO;
         |LEE 000#302u;
     |FINSI;

     |SI FSalida ! 0;  |O #302#0 ! #100#0;  |O #302#1 ! #0#2;  |O #302#2 ! aPer;
         #0#11 = "SIN ELABORAR";
         eSwSin = 1;
     |SINO;
         |SI #302#8 = "N";
             #0#11 = "SIN IMPRIMIR";
         |SINO;
             #0#11 = "IMPRESO";
         |FINSI;

         #0#10 = #302#14 + #302#34;
         #0#13 = #302#10 + #302#18 + #302#21;
     |FINSI;
||      |SI #0#10 = 0;  #0#11 = "SIN ELABORAR"; eSwSin = 1; |FINSI;
     |SI #0#13 > 0;  nSwObligado = 0; |FINSI;
|FPRC;

|PROCESO Sociedades;

     |PDEFECTO #0, 3, 18;
     nSwObligado = 0;
     nSwLinea    = 0;
     eSwSin      = 0;

     enEmpresa = #100#0;
     |HAZ ChequeaSociedad;    || No existe ficha de sociedades
                              || o esta disuelta o Inactiva
     |SI enError ! 0; |ACABA; |FINSI;

     #0#3  = #100#0;
     #0#4  = #100#13;
     #0#5  = #100#1;
     #0#7  = #100#93;
     #0#8  = #100#94;
     #0#6  = "ACTIVA";  |SI #0#8 > "01.01.1900"; #0#6 = "INACTIVA"; |FINSI;
     #0#15 = nAnyoAnt;

     #200#0 = #100#0;
     #200#1 = nAnyoAnt;
     |LEE 040#200=;
     nEstado = FSalida;
     |SI FSalida ! 0; |DDEFECTO #200; |FINSI;

     |SI nAnyoAnt < 2008;
         |SI #200#5 = "225";
             #291#0 = #100#0;
             #291#1 = nAnyoAnt;
             |LEE 000#291=;
             |SI FSalida ! 0;  |DDEFECTO  #291;  |FINSI;

              #0#09 = #291#103;
              #0#12 = #291#123;  || Resultado Liquidacion
          |SINO;
              #259#0 = #100#0;
              #259#1 = nAnyoAnt;
              |LEE 000#259=;
              |SI FSalida ! 0;  |DDEFECTO  #259;  |FINSI;

              #0#09 = #259#83;
              #0#12 = #259#105;  ||Resultado Liquidacion
          |FINSI;
     |SINO;
          #201#0 = #100#0;
          #201#1 = nAnyoAnt;
          #201#3 = "599";
          |LEE 040#201=;
          |SI FSalida ! 0;  |DDEFECTO #201;  |FINSI;
          #0#9  = #201#5;
          #0#12 = #200#8;  ||Resultado Liquidacion
     |FINSI;

     |SI nEstado ! 0;
         #0#14 = "SIN IMPUESTO ";
         #0#17 = " " * 20;
         nSwObligado = 1;
         nSwLinea    = 1;
     |SINO;
         #0#14 = "ELABORADO";
         |SI #200#6 = "S";  #0#14 = "IMPRESO"; |FINSI;
     |FINSI;

     |SI #0#9 [ 0; nSwObligado = 1; |FINSI;
     |SI enTipo202 > 1; |Y nEstado = 0;
          #0#9 = 0;
          nSwLinea = 1;
          |SI enTipo202 = 2; #0#17 = "Art.45.3 Lis (Gral)"; |FINSI;
          |SI enTipo202 = 3; #0#17 = "Art.45.3 Lis (Esp.)"; |FINSI;
          nSwObligado = 0;
     |FINSI;

     |SI #0#2 [ 2009;  |HAZ isocie29;  |FINSI;
     |SI #0#2 ] 2010;  |HAZ isom9000;  |FINSI;

     |SI nSwObligado = 0; |O #0#20 ! "S";
         |PRINT;
         nSw = 1;
     |FINSI;
|FPRC;

|DEFBUCLE agifigen;
     #100#1;
     ;
     nDEmpresa;
     nHEmpresa;
     ;
     NULL, Sociedades;
|FIN;

|DEFBUCLE agifigen_n;
     #100#2;
     ;
     aDNombre;
     aHNombre;
     ;
     NULL, Sociedades;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     informe = "dsmoy072";
     |SI #0#23 = "D";
         |MENAV "0000 Recuerde seleccionar el papel de la impresora en Horizontal";
         informe = "dsmoyh72";
     |FINSI;

     |INFOR informe;
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |DBASS aPathSoc;  |QBF aPathSoc;
     aPathSoc = aPathSoc + "contasoc/fich/";

     |PATH_DAT #200 aPathSoc;
     |PATH_DAT #201 aPathSoc;
     |PATH_DAT #202 aPathSoc;
     |PATH_DAT #259 aPathSoc;
     |PATH_DAT #291 aPathSoc;

     nDEmpresa = #0#18;    nHEmpresa = #0#19;
     aDNombre  = " " * 40; aHNombre  = "z" * 40;

     |SI #0#0 = 1;
         nAnyoAnt = #0#2 - 2;
     |SINO;
         nAnyoAnt = #0#2 - 1;
     |FINSI;
     #0#15 = nAnyoAnt;

|| Revisar esta fecha de Chequeo
     aAlfa = #0#2;
     |SI #0#0 = 1;  aAlfa1 = "01.04.";  |FINSI;
     |SI #0#0 = 2;  aAlfa1 = "01.10.";  |FINSI;
     |SI #0#0 = 3;  aAlfa1 = "01.12.";  |FINSI;
     aAlfa1 = aAlfa1 + aAlfa; fFechaChequeo  = aAlfa1;
     |SI #0#0 = 1;  aAlfa1 = "30.03.";  |FINSI;
     |SI #0#0 = 2;  aAlfa1 = "30.09.";  |FINSI;
     |SI #0#0 = 3;  aAlfa1 = "30.11.";  |FINSI;
     aAlfa1 = aAlfa1 + aAlfa; fFechaChequeoF = aAlfa1;

     nSw = 0;
     |ABRE #200;
     |ABRE #201;
     |SELECT #2#201;
     |ABRE #202;
     |ABRE #302;
     |ABRE #259;
     |ABRE #291;
     |SI #0#22 = 2;
         |BUCLE agifigen;
     |SINO;
         |BUCLE agifigen_n;
     |FINSI;
     |CIERRA #291;
     |CIERRA #259;
     |CIERRA #302;
     |CIERRA #202;
     |SELECT #1#201;
     |CIERRA #201;
     |CIERRA #200;

     |SI nSw = 1;
         |PIEINF;
     |SINO;
         |MENAV "    Seleccion vacia";
     |FINSI;
     |FININF;
     |FINIMP;
|FPRC;
