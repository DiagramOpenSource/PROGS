|FICHEROS;
     dsmoy000 #0;
     dsmom004 #4;
     dsmom107 #107;
     dsmow600 #600;
     dsmow601 #601,MANTE;

     dsmociva #300;
     dsmow142 #110;

     dsmod303 #303;
     dsmow014 #999;
     dsmow583 #583;

     &regisnif@ #709;
     &clientes@ #715;
     &datosper@ #718;
|FIN;

|VARIABLES;
     aIPRemoto     = "";
     aBue          = "";

     nSwCara    = 0;
     &enSwLinea = 0;
     &enBase    = 0;
     &enCuota   = 0;
     &enPorce   = 0;
     &aText     = "";
     &aTexr     = "";
     &aDescr    = "";
     &enBaseI   = 0;
     &enCuotaI  = 0;
     &enPorceI  = 0;
     nIVA7      = 0;
     nIVA10     = 0;
     nIVA13     = 0;
     nIVA16     = 0;
     nIVA19     = 0;
     nIVA22     = 0;
     nIVA25     = 0;
     nIVA28     = 0;
     nIVA31     = 0;
     nSubeIVA   = 0;
     nGrupo     = 0;
     nSubGrupo  = 0;
     nMas       = 0;
     nPara1     = 0;
     nPara2     = 0;
     nPara3     = 0;
     nCampo1    = 0;
     nCampo2    = 0;
     nCampo3    = 0;
     nPrimero   = 0;
     nBaseImpo  = 0;
     nPorce     = 0;
     nCuota     = 0;
     nCasilla   = 0;
|FIN;

|INCLUYE i_varemi;

|PROCESO VarVacia_01;
     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + aTipo + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;
|FPRC;

|PROCESO Portal303_2013;
     |PUSHV 0501 2380;
     |BLANCO 0501 2380;
     |CUADRO 0501 2380;

     aAlfa = "Conectandose a la pagina de la aeat";
     |PINTA 1210, aAlfa;

     aAbrePortal = eaPathEmision + "portal303.html";
     |XABRE "WB", aAbrePortal, enHandlePortal;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + "https://www2.agenciatributaria.gob.es/es13/l/zi21zilk0021" + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + "IE13030B" + &34 + " />";
     |HAZ GrabaPortal;

     aTipo = "N";
     |SI #dsmow583#69 ! "00000000000000000";
         aTipo = "I";
     |SINO;
         |SI #dsmow583#61 ! "00000000000000000";
             aTipo = "C";
         |SINO;
             |SI #dsmow583#63 ! "00000000000000000";
                 aTipo = "D";
             |FINSI;
         |FINSI;
     |FINSI;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "TIA" + &34 + " value=" + &34 + aTipo + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "NDC" + &34 + " value=" + &34 + #dsmow583#7 + &34 + " />";
     |HAZ GrabaPortal;

     aTipo = "NRC";  |HAZ VarVacia_01;
     aTipo = "ING";  |HAZ VarVacia_01;
     aTipo = "NRR";  |HAZ VarVacia_01;
     aTipo = "ICO";  |HAZ VarVacia_01;
     aTipo = "NR1";  |HAZ VarVacia_01;
     aTipo = "IN1";  |HAZ VarVacia_01;
     aTipo = "NR2";  |HAZ VarVacia_01;
     aTipo = "IN2";  |HAZ VarVacia_01;
     aTipo = "NR3";  |HAZ VarVacia_01;
     aTipo = "IN3";  |HAZ VarVacia_01;
     aTipo = "NR4";  |HAZ VarVacia_01;
     aTipo = "IN4";  |HAZ VarVacia_01;
     aTipo = "NR5";  |HAZ VarVacia_01;
     aTipo = "IN5";  |HAZ VarVacia_01;
     aTipo = "NR6";  |HAZ VarVacia_01;
     aTipo = "IN6";  |HAZ VarVacia_01;
     aTipo = "NR7";  |HAZ VarVacia_01;
     aTipo = "IN7";  |HAZ VarVacia_01;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + "ES" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "F01" + &34 + " value=" + &34 + "<T3030" + #dsmow583#11 + "0A0000><AUX>";
     |HAZ GrabaPortalSin;

     eaAlfa = " " * 150;
     |HAZ GrabaPortalSin;
     |HAZ GrabaPortalSin;

     eaAlfa = "</AUX><VECTOR>001FIN";
     |HAZ GrabaPortalSin;

     eaAlfa = " " * 200;
     |HAZ GrabaPortalSin;

     eaAlfa = " " * 94;
     |HAZ GrabaPortalSin;

     eaAlfa = "</VECTOR>";
     |HAZ GrabaPortalSin;

     |SI #dsmow583#68 = "3";  #dsmow583#68 = "2";   #dsmow583#6 = "I";  |FINSI;

     |PARA nCampo = 1;  |SI nCampo [ 82;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #dsmow583#nCampo#;
           |XGRABA enHandlePortal, eaAlfa;
     |SIGUE;

     eaAlfa = "</T3030" + #dsmow583#11 + "0A0000>" + &34 + " />";
     |HAZ GrabaPortal;

     aTipo = "TXT";  |HAZ VarVacia_01;
     aTipo = "FIR";  |HAZ VarVacia_01;

     aTipo = "F";
     |SI #dsmow583#70 ! "    ";
         aTipo = #dsmow583#70;
     |SINO;
         |SI #dsmow583#64 ! "    ";
             aTipo = #dsmow583#64;
         |FINSI;
     |FINSI;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + aTipo + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + #dsmow583#11 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + "303" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + "EWLINKPS" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     eaFOrigen  = aAbrePortal;
     eaFDestino = eaPathLanza + "portal303.html";
     |HAZ CopiaFichero;

     eaForzExplorador = "N";
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + eaFDestino;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaFDestino + &34;
     |FINSI;
     |RSYSTEM aAlfa;

     |FBORRA eaFOrigen;
     |RFBORRA eaFDestino;

     |POPV;
|FPRC;

|PROCESO PresentaModelo_01;
     |SI #dsmoy000#6 [ 2013;
         enErrorPortal = 0;
         |HAZ ValidaMPF;
         |SI enErrorPortal = 1;  |ACABA;  |FINSI;
     |FINSI;

     |SI eaOpcion = "1";
         |HAZ Portal303_2013;
     |FINSI;

     |SI eaOpcion = "3";
         eaFOrigen  = eaPathEmision  + eaFicheroPlano;
         eaFDestino = eaPathInternet + eaFicheroPlano;
         |HAZ CopiaFichero;
     |FINSI;

     |HAZ GrabaImpreso;
|FPRC;

|PROCESO Suma0;
   |SI nPrimero = 0;
       |PARA nCampo1 = 14; |SI nCampo1 [ 55; |HACIENDO nCampo1 = nCampo1 + 1;
             nCampo2   = nCampo1 + 2;
             #110nCampo2 = #300nCampo1 + #110nCampo2;
       |SIGUE;
       nPrimero = 1;
   |SINO;
      |PARA nPara1 = 14; |SI nPara1 [ 53; |HACIENDO nPara1 = nPara1 + 3;
            nPara2 = nPara1 + 1;
            nPara3 = nPara1 + 2;
            nBaseImpo = #300nPara1;
            nPorce    = #300nPara2;
            nCuota    = #300nPara3;

         |SI nBaseImpo ! 0; |O nCuota ! 0;
            nSwEsta = 0;
            |PARA nCampo2 = 17;  |SI nCampo2 [ 56;  |HACIENDO nCampo2 = nCampo2 + 3;
                  nCampo1 = nCampo2 - 1;
                  nCampo3 = nCampo2 + 1;
                  |SI #110nCampo2 = nPorce;
                      #110nCampo1 = #110nCampo1 + nBaseImpo;
                      #110nCampo2 = nPorce;
                      #110nCampo3 = #110nCampo3 + nCuota;
                      nSwEsta = 1;
                      |SAL;
                  |FINSI;
            |SIGUE;

            |SI nSwEsta = 0;
               |PARA nCampo2 = 17;  |SI nCampo2 [ 56;  |HACIENDO nCampo2 = nCampo2 + 3;
                    nCampo1 = nCampo2 - 1;
                    nCampo3 = nCampo2 + 1;
                    |SI #110nCampo2 = 0; |Y #110nCampo1 = 0;  |Y #110nCampo3 = 0;
                        #110nCampo1 = #110nCampo1 + nBaseImpo;
                        #110nCampo2 = nPorce;
                        #110nCampo3 = #110nCampo3 + nCuota;
                        nSwEsta = 1;
                        |SAL;
                    |FINSI;
               |SIGUE;
            |FINSI;

            |SI nSwEsta = 0;
                #110#55 = #110#55 + nBaseImpo;
                #110#56 = 0;
                #110#57 = #110#57 + nCuota;
            |FINSI;

        |FINSI;
     |SIGUE;
  |FINSI;
|FPRC;

|DEFBUCLE LeeCasilla;
 #300#1;
 ;
 #303#0, #303#1, #303#2, #303#3, #303#4, 00, nGrupo, nSubGrupo;
 #303#0, #303#1, #303#2, #303#3, #303#4, 99, nGrupo, nSubGrupo;
 e;
 NULL, Suma0;
|FIN;

|PROCESO HazCasilla;

    |PDEFECTO #110, 16, 58;
    nCasilla = nSubGrupo;

    nPrimero = 0;
    |BUCLE LeeCasilla;

    |SI nMas = 1;
        |SI nCasilla = 1;
            nSubGrupo = 13; |BUCLE LeeCasilla;
            nSubGrupo = 14; |BUCLE LeeCasilla;
        |FINSI;

        |SI nCasilla = 2;
            nSubGrupo = 15; |BUCLE LeeCasilla;
        |FINSI;
    |FINSI;
    |SI nMas = 2;
        nSubGrupo = 2; |BUCLE LeeCasilla;
        nSubGrupo = 3; |BUCLE LeeCasilla;
        nSubGrupo = 6; |BUCLE LeeCasilla;
        nSubGrupo = 7; |BUCLE LeeCasilla;
        nSubGrupo = 8; |BUCLE LeeCasilla;
        nSubGrupo = 14; |BUCLE LeeCasilla;
    |FINSI;
    |SI nMas = 3;
        nSubGrupo = 11; |BUCLE LeeCasilla;
        nSubGrupo = 12; |BUCLE LeeCasilla;
    |FINSI;

    |PARA nCampo1 = 14; |SI nCampo1 [ 55; |HACIENDO nCampo1 = nCampo1 + 1;
          nCampo2   = nCampo1 + 2;
          #300nCampo1 = #110nCampo2;
    |SIGUE;
|FPRC;

|PROCESO MiroCiva;
     nMas = 0;
     |SI nGrupo = 2;
        |SI nSubGrupo = 1; |O nSubGrupo = 2;  nMas = 1; |FINSI;
     |FINSI;
     |SI nGrupo = 1; |Y nSubGrupo = 1;
         nMas = 2;
     |FINSI;
     |SI nGrupo = 1; |Y nSubGrupo = 10;
         nMas = 3;
     |FINSI;
     |HAZ HazCasilla;

     |PARA nCampo1 = 14; |SI nCampo1 [ 53; |HACIENDO nCampo1 = nCampo1 + 3;

           nCampo2 = nCampo1 + 1;
           nCampo3 = nCampo1 + 2;
           |SI #300nCampo1 ! 0; |O #300nCampo3 ! 0;
               enBaseI  = #300nCampo1;
               enPorceI = #300nCampo2;
               enCuotaI = #300nCampo3;

               |SI nGrupo = 1;
                   |SI enPorceI = enPorce; |O enPorce = 0;
                       enSwLinea = 6; |PRINT;
                       aTexr = "";
                   |SINO;
                       |SI enPorceI = 16; |O enPorceI = 18; |O enPorceI = 21;
                           |SI enPorce ] 15; |Y enPorce < 22;
                               enSwLinea = 6; |PRINT;
                               aTexr = "";
                          |FINSI;
                       |SINO;
                          |SI enPorceI = 7; |O enPorceI = 8; |O enPorceI = 10;
                              |SI enPorce ] 6; |Y enPorce < 11;
                                  enSwLinea = 6; |PRINT;
                                  aTexr = "";
                               |FINSI;
                          |SINO;
                                |SI enPorceI = 4; |O enPorceI = 5.20;
                                    |SI enPorce ] 3; |Y enPorce < 5.50;
                                        enSwLinea = 6; |PRINT;
                                        aTexr = "";
                                    |FINSI;
                                |SINO;
                                    |SI enPorceI = 1; |O enPorceI = 1.40;
                                        |SI enPorce ] 0.80; |Y enPorce < 1.60;
                                            enSwLinea = 6; |PRINT;
                                            aTexr = "";
                                        |FINSI;
                                    |FINSI;
                                |FINSI;
                          |FINSI;
                      |FINSI;
                   |FINSI;
               |SINO;
                   enSwLinea = 6; |PRINT;
                   aTexr = "";
               |FINSI;
          |FINSI;

     |SIGUE;
|FPRC;

|PROCESO ImprDetalle;
    nIVA7     = 0; nIVA10    = 0;
    nIVA13    = 0; nIVA25    = 0;
    nIVA16    = 0; nIVA19    = 0;
    nIVA22    = 0;
    nIVA28    = 0; nIVA31    = 0;
    nSubeIVA  = 0;
    |SI #303#1 = 2010; |Y #303#2 ] 7; nSubeIVA = 1; |FINSI;
    |SI #303#1 ] 2011; nSubeIVA = 1;                |FINSI;
    |SI #303#1 = 2012; |Y #303#2 ] 9; nSubeIVA = 2; |FINSI;
    |SI #303#1 ] 2013; nSubeIVA = 2;                |FINSI;
    |SI nSubeIVA = 1;
        |SI #303#7  ! 18; |Y #303#7  ! 8; |Y #303#7  ! 4; |Y #303#7  ! 0; nIVA7  = 1; |FINSI;
        |SI #303#10 ! 18; |Y #303#10 ! 8; |Y #303#10 ! 4; |Y #303#10 ! 0; nIVA10 = 1; |FINSI;
        |SI #303#13 ! 18; |Y #303#13 ! 8; |Y #303#13 ! 4; |Y #303#13 ! 0; nIVA13 = 1; |FINSI;
        |SI #303#25 ! 18; |Y #303#25 ! 8; |Y #303#25 ! 4; |Y #303#25 ! 0; nIVA25 = 1; |FINSI;
        |SI #303#28 ! 18; |Y #303#28 ! 8; |Y #303#28 ! 4; |Y #303#28 ! 0; nIVA28 = 1; |FINSI;
        |SI #303#31 ! 18; |Y #303#31 ! 8; |Y #303#31 ! 4; |Y #303#31 ! 0; nIVA31 = 1; |FINSI;
    |FINSI;
    |SI nSubeIVA = 2;
        |SI #303#7  ! 21; |Y #303#7  ! 10; |Y #303#7  ! 4; |Y #303#7  ! 0; nIVA7  = 1; |FINSI;
        |SI #303#10 ! 21; |Y #303#10 ! 10; |Y #303#10 ! 4; |Y #303#10 ! 0; nIVA10 = 1; |FINSI;
        |SI #303#13 ! 21; |Y #303#13 ! 10; |Y #303#13 ! 4; |Y #303#13 ! 0; nIVA13 = 1; |FINSI;
        |SI #303#25 ! 21; |Y #303#25 ! 10; |Y #303#25 ! 4; |Y #303#25 ! 0; nIVA25 = 1; |FINSI;
        |SI #303#28 ! 21; |Y #303#28 ! 10; |Y #303#28 ! 4; |Y #303#28 ! 0; nIVA28 = 1; |FINSI;
        |SI #303#31 ! 21; |Y #303#31 ! 10; |Y #303#31 ! 4; |Y #303#31 ! 0; nIVA31 = 1; |FINSI;

        |SI #303#16 ! 5.20; |Y #303#16 ! 1.40; |Y #303#16 ! 0.50; |Y #303#16 ! 0; nIVA16  = 1; |FINSI;
        |SI #303#19 ! 5.20; |Y #303#19 ! 1.40; |Y #303#19 ! 0.50; |Y #303#19 ! 0; nIVA19  = 1; |FINSI;
        |SI #303#22 ! 5.20; |Y #303#22 ! 1.40; |Y #303#22 ! 0.50; |Y #303#22 ! 0; nIVA22  = 1; |FINSI;
    |FINSI;

|| imprimir detalle
    nGrupo = 1;
    aText = "I.V.A. DEVENGADO";
    aTexr = "----------------";
    enSwLinea = 0; |PRINT;
    enSwLinea = 1; |PRINT;

    aDescr = "Regimen General 1 ..........";
    enBase = #303#6; enPorce = #303#7; enCuota = #303#8;
    enSwLinea = 2; |PRINT;
    |SI nIVA7  = 1;
        aTexr = "Desglose Tipos IVA";
        nSubGrupo = 1; |HAZ MiroCiva;
    |FINSI;

    aDescr = "Regimen General 2 ........";
    enBase = #303#9; enPorce = #303#10; enCuota = #303#11;
    enSwLinea = 2; |PRINT;
    |SI nIVA10  = 1;
        aTexr = "Desglose Tipos IVA";
        nSubGrupo = 1; |HAZ MiroCiva;
    |FINSI;

    aDescr = "Regimen General 3 ........";
    enBase = #303#12; enPorce = #303#13; enCuota = #303#14;
    enSwLinea = 2; |PRINT;
    |SI nIVA13  = 1;
        aTexr = "Desglose Tipos IVA";
        nSubGrupo = 1; |HAZ MiroCiva;
    |FINSI;

    enSwLinea = 9; |PRINT;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Recargo Equivalencia 1 ...";
    enBase = #303#15; enPorce = #303#16; enCuota = #303#17;
    enSwLinea = 2; |PRINT;
    |SI nIVA16  = 1;
        aTexr = "Desglose Tipos Recargo";
        nSubGrupo = 10; |HAZ MiroCiva;
    |FINSI;

    aDescr = "Recargo Equivalencia 2 ...";
    enBase = #303#18; enPorce = #303#19; enCuota = #303#20;
    enSwLinea = 2; |PRINT;
    |SI nIVA19  = 1;
        aTexr = "Desglose Tipos Recargo";
        nSubGrupo = 10; |HAZ MiroCiva;
    |FINSI;

    aDescr = "Recargo Equivalencia 3 ...";
    enBase = #303#21; enPorce = #303#22; enCuota = #303#23;
    enSwLinea = 2; |PRINT;
    |SI nIVA22  = 1;
        aTexr = "Desglose Tipos Recargo";
        nSubGrupo = 10; |HAZ MiroCiva;
    |FINSI;

    enSwLinea = 9; |PRINT;

    aDescr  = "Adq.Intracomunitarias ....";
    enBase  = #303#24 + #303#27 + #303#30;
    enPorce = 0
    enCuota = #303#26 + #303#29 + #303#32;
    enSwLinea = 2; |PRINT;
    |SI #303#25 ! 0;
        |SI nIVA25 = 1;
            enPorce = #303#25;
            aTexr = "Desglose Tipos IVA";
            nSubGrupo = 5; |HAZ MiroCiva;
        |SINO;
            enBaseI = #303#24; enPorceI = #303#25; enCuotaI = #303#26;
            enSwLinea = 6; |PRINT;
        |FINSI;
    |FINSI;
    |SI #303#28 ! 0;
        |SI nIVA28 = 1;
            enPorce = #303#28;
            aTexr = "Desglose Tipos IVA";
            nSubGrupo = 5; |HAZ MiroCiva;
        |SINO;
            enBaseI = #303#27; enPorceI = #303#28; enCuotaI = #303#29;
            enSwLinea = 6; |PRINT;
        |FINSI;
    |FINSI;
    |SI #303#31 ! 0;
        |SI nIVA31 = 1;
            enPorce = #303#31;
            aTexr = "Desglose Tipos IVA";
            nSubGrupo = 5; |HAZ MiroCiva;
        |SINO;
            enBaseI = #303#27; enPorceI = #303#28; enCuotaI = #303#29;
            enSwLinea = 6; |PRINT;
        |FINSI;
    |FINSI;
    enSwLinea = 3; |PRINT;

    enSwLinea = 9; |PRINT;

    || IVA SOPORTADO
      nGrupo = 2;
      aText = "I.V.A. DEDUCIBLE";
      aTexr = "----------------";
      enSwLinea = 0; |PRINT;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Op.interiores corrientes ................";
      enBase = #303#34; enCuota = #303#35; enSwLinea = 4; |PRINT;
      |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 1; |HAZ MiroCiva;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Op.interiores bienes inversion ..........";
      enBase = #303#36; enCuota = #303#37; enSwLinea = 4; |PRINT;
      |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 2; |HAZ MiroCiva;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Importaciones bienes corrientes .........";
      enBase = #303#38; enCuota = #303#39; enSwLinea = 4; |PRINT;
      |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 3; |HAZ MiroCiva;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Importaciones bienes inversion ..........";
      enBase = #303#40; enCuota = #303#41; enSwLinea = 4; |PRINT;
      |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 4; |HAZ MiroCiva;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Adq.intracomunitarias bienes corrientes..";
      enBase = #303#42; enCuota = #303#43; enSwLinea = 4; |PRINT;
      |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 5; |HAZ MiroCiva;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Adq.intracomunitarias bienes inversion ..";
      enBase = #303#44; enCuota = #303#45; enSwLinea = 4; |PRINT;
      |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 6; |HAZ MiroCiva;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Compensaciones Regimen Especial A.G.P. ...................";
      enCuota = #303#46; enSwLinea = 5; |PRINT;
      |SI enCuota ! 0;  nSubGrupo = 7; |HAZ MiroCiva;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Regularizacion inversiones ..............................";
      enCuota = #303#47; enSwLinea = 5; |PRINT;
      |SI enCuota ! 0;  nSubGrupo = 8; |HAZ MiroCiva;  |FINSI;

      aTexr = "Desglose Tipos IVA";
      aDescr = "Regularizacion aplicacion porcentaje def. prorrata ......";
      enCuota = #303#48; enSwLinea = 5; |PRINT;
      |SI enCuota ! 0;  nSubGrupo = 10; |HAZ MiroCiva;  |FINSI;

|FPRC;

|PROCESO CargaImprime303;
     aAlfa = "del err" + (("00000" + #999#0) % -105) + ".TXT" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "wait mipf32 ";
     aAlfa = aAlfa + "/E:303" + (("00000" + #999#0) % -105) + ".TXT ";
     aAlfa = aAlfa + "/R:err" + (("00000" + #999#0) % -105) + ".TXT ";
     |SI eaImpresora ! "";
         aAlfa = aAlfa + "/I:" + &34 + eaImpresora + &34;
     |FINSI;
     aAlfa = aAlfa + " /C:" + #601#0;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO TDeclaracion303;
     |SI #303#62 ! 0;
         enModelo = 303;  enForzar = 1;  |HAZ CogeDatosBancos;

         #583#64 = eaEntidad;
         #583#65 = eaOficina;
         #583#66 = eaDC;
         #583#67 = eaCuenta;
     |FINSI;

     |SI #303#63 ! 0;
         enModelo = 303;  enForzar = 0;  |HAZ CogeDatosBancos;

                                 aAlfa  = "0";
         |SI eaFormaPago = "1";  aAlfa  = "1";  |FINSI;
         |SI eaFormaPago = "2";  aAlfa  = "2";  |FINSI;
         |SI eaFormaPago = "3";  aAlfa  = "3";  |FINSI;
||         |SI eaFormaPago = "4";  aAlfa  = "4";  |FINSI;
||         |SI eaFormaPago = "5";  aAlfa  = "5";  |FINSI;

         #583#68 = aAlfa;
         #583#70 = eaEntidad;
         #583#71 = eaOficina;
         #583#72 = eaDC;
         #583#73 = eaCuenta;
     |FINSI;

     #583#6  = "";

     |SI #303#61 ! 0;  #583#6 = "C";  |FINSI;
     |SI #303#62 ! 0;
                                 #583#6 = "D";
         |SI eaFormaPago = "6";  #583#6 = "V";  |FINSI;
     |FINSI;
     |SI #303#63 ! 0;
                                                 #583#6 = "I";
         |SI eaFormaPago = "3";                  #583#6 = "U";  |FINSI;
         |SI eaFormaPago = "4";  |Y #0#6 < 2013; #583#6 = "A";  |FINSI;
         |SI eaFormaPago = "5";  |Y #0#6 < 2013; #583#6 = "E";  |FINSI;
         |SI eaFormaPago = "6";                  #583#6 = "G";  |FINSI;
     |FINSI;

     |SI #303#61 = 0; |Y #303#62 = 0;  |Y #303#63 = 0;
         #583#6 = "N";
     |FINSI;
|FPRC;

|PROCESO PersonaFisica;
     aAlfa = eaVarDni % 101;
     |SI aAlfa = "0"; |O aAlfa = "1"; |O aAlfa = "2"; |O aAlfa = "3";
      |O aAlfa = "4"; |O aAlfa = "5"; |O aAlfa = "6"; |O aAlfa = "7";
      |O aAlfa = "8"; |O aAlfa = "9"; |O aAlfa = "X"; |O aAlfa = "Y";
      |O aAlfa = "Z";
         eaAlfa = #715#1;     |HAZ BuscaNombre;
         eaAlfa = eaAlfa1;    |HAZ QuitaRaros;     #583#8   = eaAlfa;
         eaAlfa = eaAlfa2;    |HAZ QuitaRaros;     #583#9   = eaAlfa;
      |SINO;
         eaAlfa   = #715#1;    |HAZ QuitaRaros;    #583#8   = eaAlfa;
                                                   #583#9   = " ";
      |FINSI;
|FPRC;

|PROCESO Carga303;
     |SI nTecla = 1;  |O nTecla = 3;
         aAbre = eaPathEmision + "303" + (("00000" + #999#0) % -105) + ".TXT";
         |XABRE "BW", aAbre, nHandle2;
     |FINSI;

     |ABRE #303;
     #303#0 = #4#0;
     #303#1 = #4#1;
     #303#2 = #4#2;
     #303#3 = #4#3;
     #303#4 = #4#4;
     #303#5 = 0;
     |LEE 040#303=;
     |SI FSalida ! 0;  |CIERRA #303;  |ACABA;  |FINSI;
     |CIERRA #303;

     enCodCli = #303#0;
     |HAZ LeePersona;

     |DDEFECTO #583;

     #583#0 = #303#0;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #583#7  = eaVarDni;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = #718#2;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #583#8 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #583#9 = eaAlfa;
         |SINO;
             |HAZ PersonaFisica;
         |FINSI;

         eaAlfa  = #715#37;  |HAZ QuitaRaros;      #583#78 = eaAlfa;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #583#7   = eaVarDni;
         |HAZ PersonaFisica;

         eaAlfa   = #715#11;  |HAZ QuitaRaros;     #583#78 = eaAlfa;
     |FINSI;

     |SI #4#23 = "N";  #583#10 = "2";  |FINSI;
     |SI #4#23 = "S";  #583#10 = "1";  |FINSI;

     #583#11  = #303#1;

     |SI #4#22 = "T";
         |SI #303#2 = 3;   #583#12 = "1T";  |FINSI;
         |SI #303#2 = 6;   #583#12 = "2T";  |FINSI;
         |SI #303#2 = 9;   #583#12 = "3T";  |FINSI;
         |SI #303#2 = 12;  #583#12 = "4T";  |FINSI;
     |SINO;
         #583#12 = ("00" + #303#2) % -102;
     |FINSI;

     enNume = #303#6;   |HAZ Conver17;   #583#13 = eaAlfa;
     enNume = #303#7 * 100;              #583#14 = ("00000" + enNume) % -105;
     enNume = #303#8;   |HAZ Conver17;   #583#15 = eaAlfa;

     enNume = #303#9;   |HAZ Conver17;   #583#16 = eaAlfa;
     enNume = #303#10 * 100;             #583#17 = ("00000" + enNume) % -105;
     enNume = #303#11;  |HAZ Conver17;   #583#18 = eaAlfa;

     enNume = #303#12;  |HAZ Conver17;   #583#19 = eaAlfa;
     enNume = #303#13 * 100;             #583#20 = ("00000" + enNume) % -105;
     enNume = #303#14;  |HAZ Conver17;   #583#21 = eaAlfa;

     enNume = #303#15;  |HAZ Conver17;   #583#22 = eaAlfa;
     enNume = #303#16 * 100;             #583#23 = ("00000" + enNume) % -105;
     enNume = #303#17;  |HAZ Conver17;   #583#24 = eaAlfa;

     enNume = #303#18;  |HAZ Conver17;   #583#25 = eaAlfa;
     enNume = #303#19 * 100;             #583#26 = ("00000" + enNume) % -105;
     enNume = #303#20;  |HAZ Conver17;   #583#27 = eaAlfa;

     enNume = #303#21;  |HAZ Conver17;   #583#28 = eaAlfa;
     enNume = #303#22 * 100;             #583#29 = ("00000" + enNume) % -105;
     enNume = #303#23;  |HAZ Conver17;   #583#30 = eaAlfa;

     enNume = #303#24 + #303#27 + #303#30;  |HAZ Conver17;  #583#31 = eaAlfa;
     enNume = #303#26 + #303#29 + #303#32;  |HAZ Conver17;  #583#32 = eaAlfa;

     enNume = #303#33;  |HAZ Conver17;  #583#33 = eaAlfa;

     enNume = #303#34;  |HAZ Conver17;  #583#34 = eaAlfa;
     enNume = #303#35;  |HAZ Conver17;  #583#35 = eaAlfa;
     enNume = #303#36;  |HAZ Conver17;  #583#36 = eaAlfa;
     enNume = #303#37;  |HAZ Conver17;  #583#37 = eaAlfa;
     enNume = #303#38;  |HAZ Conver17;  #583#38 = eaAlfa;
     enNume = #303#39;  |HAZ Conver17;  #583#39 = eaAlfa;
     enNume = #303#40;  |HAZ Conver17;  #583#40 = eaAlfa;
     enNume = #303#41;  |HAZ Conver17;  #583#41 = eaAlfa;
     enNume = #303#42;  |HAZ Conver17;  #583#42 = eaAlfa;
     enNume = #303#43;  |HAZ Conver17;  #583#43 = eaAlfa;
     enNume = #303#44;  |HAZ Conver17;  #583#44 = eaAlfa;
     enNume = #303#45;  |HAZ Conver17;  #583#45 = eaAlfa;
     enNume = #303#46;  |HAZ Conver17;  #583#46 = eaAlfa;
     enNume = #303#47;  |HAZ Conver17;  #583#47 = eaAlfa;
     enNume = #303#48;  |HAZ Conver17;  #583#48 = eaAlfa;
     enNume = #303#49;  |HAZ Conver17;  #583#49 = eaAlfa;
     enNume = #303#50;  |HAZ Conver17;  #583#50 = eaAlfa;

     nNume  = #303#51 * 100;            #583#51 = ("00000" + nNume) % -105;
     enNume = #303#52;  |HAZ Conver17;  #583#52 = eaAlfa;
     enNume = #303#53;  |HAZ Conver17;  #583#53 = eaAlfa;
     enNume = #303#54;  |HAZ Conver17;  #583#54 = eaAlfa;
     enNume = #303#55;  |HAZ Conver17;  #583#55 = eaAlfa;
     enNume = #303#56;  |HAZ Conver17;  #583#56 = eaAlfa;
     enNume = #303#57;  |HAZ Conver17;  #583#57 = eaAlfa;
     enNume = #303#58;  |HAZ Conver17;  #583#58 = eaAlfa;
     enNume = #303#59;  |HAZ Conver17;  #583#59 = eaAlfa;
     enNume = #303#60;  |HAZ Conver17;  #583#60 = eaAlfa;

     enNume = #303#61;  |HAZ Conver17;  #583#61 = eaAlfa;

     #583#62 = "0";

     |SI #303#61 = 0; |Y #303#62 = 0;  |Y #303#63 = 0;
         #583#62 = "1";
     |FINSI;

     enNume = #303#62;  |HAZ Conver17;  #583#63 = eaAlfa;
     enNume = #303#63;  |HAZ Conver17;  #583#69 = eaAlfa;

     |HAZ TDeclaracion303;

     #583#74 = "0";

     |SI #303#4 > 0;
         #583#74 = "1";
         #583#75 = #4#21;
     |FINSI;

     eaAlfa  = #0#7;  |HAZ FechaBonito;

     #583#79 = eaDiaB;
     #583#80 = eaMesB;
     #583#81 = eaAnyoB;
     #583#83 = &13 + &10;

     |SI nTecla ! 4;
         |GRABA 020#583n;
     |FINSI;
     |LIBERA #583;

     nTCampo = 83;

     |SI nTecla = 1;  |O nTecla = 3;
         aAlfa = "";
         |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #583nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         |XCIERRA nHandle2;

         eaFOrigen  = eaPathEmision + "303" + (("00000" + #999#0) % -105) + ".TXT";
         eaFDestino = eaPathLanza + "303" + (("00000" + #999#0) % -105) + ".TXT";
         |HAZ CopiaFichero;

         |FBORRA eaFOrigen;

         |HAZ CargaImprime303;

         enImpReal  = #303#50;  ||Casilla 28
         enCas21    = #303#33;
         enCas27    = #303#49;
         enCas31    = #303#53;
         enCas34    = #303#60;
         enIngresar = #303#63;
         enDevolver = #303#62;
         enCompensar= #303#61;
     |SINO;
         |SI nSwCara = 0;
             |PRINT;
         |SINO;
             |HAZ ImprDetalle;
         |FINSI;
         |PIEINF;
     |FINSI;
|FPRC;

|PROCESO QueHacemos303;
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |HAZ Carga303;
|FPRC;

|DEFBUCLE dsmow014C303;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos303;
|FIN;

|DEFBUCLE dsmow014N303;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos303;
|FIN;

|PROCESO AbreImprime303;
     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = eaUnidadBasico + &13 + &10;         |XGRABA nHandle1, aAlfa;
     aAlfa = "CD " + eaPathLanza + &13 + &10;    |XGRABA nHandle1, aAlfa;

     aAlfa    = #0#6;
     aAlfa    = aAlfa % -102;
     aVersion = "01";

     aAlfa1 = "DEL ERRORES.RST" + &13 + &10;      |XGRABA nHandle1, aAlfa1;

     aAlfa = "Z" + aAlfa + aVersion + "MPF.EXE /T:" + eaPathLanza + &13 + &10;
     |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO CreaVarios;
     aIPRemoto   = "";
     |IP_REMOTO aIPRemoto;

     aPathInter  = eaPathLanza + "AInternet";
     aPathInter  = aPathInter + "/";
     aFichero    = aPathInter + "*.bue";
     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
          |SI FSalida ! 0; |SAL; |FINSI;

           aBue     = aFichero - aPathInter;
          |SI nTecla = 3;
               aDestino = eaPathInternet + "303" + (aBue % 405) + ".txt";
               |RCOPIA_FICHERO aFichero, aDestino;
          |FINSI;

          |RFBORRA aFichero;

          |R_SDIR aFichero;
     |SIGUE;

     |SI nTecla = 3;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO EmiteEsto303;
     aAlfa = "DEL *.wmf" + &13 + &10;             |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.tab"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.dll"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errorm~1.txt" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errormipf.txt"  + &13 + &10;    |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errmipf.txt"  + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL mipf32.exe"  + &13 + &10;       |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL wait.exe"  + &13 + &10;         |XGRABA nHandle1, aAlfa;
     |XCIERRA nHandle1;

     |HAZ Copiampf;

     aAlfa = eaPathLanza + "IMPRIME";
     |RSYSTEM aAlfa;

     eaFichError = "err";
     eaFichDatos = #0#0;
     eaFichAuxil = "";

     |SI nTecla = 1;  |O nTecla = 3;
          enValidacion = 1;
          |HAZ BuscaErroresL;

          |SI enBuenos = 0;
             |MENAV "      Ha habido Errores, arreglelos y vuelva a emitir.";
             |ACABA;
          |FINSI;

          |HAZ CreaVarios;
     |FINSI;
|FPRC;

|PROCESO Boton3031;
     |PTEC 824;
|FPRC;

|PROCESO Boton3032;
     |PTEC 825;
|FPRC;

|PROCESO Boton3033;
     |PTEC 826;
|FPRC;

|PROCESO Boton3034;
     |PTEC 806;
|FPRC;

|PROCESO Boton3035;
     |PTEC 827;
|FPRC;

|PROCESO Botones303;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision PDF pagina hacienda          ", 0513, 0754, Boton3031;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Presentacion Telematica              ", 0913, 1154, Boton3032;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Informe de Comprobacion              ", 1313, 1554, Boton3033;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton3034;
     nBoton5 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTecla = 1;   |SAL;  |FINSI;
         |SI aTecla = aF3;  nTecla = 3;   |SAL;  |FINSI;
         |SI aTecla = aF4;  nTecla = 4;   |SAL;  |FINSI;
         |SI aTecla = aF6;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;

     |PULSATECLA;
|FPRC;

|PROCESO Bloque2012;
     |SI eaParametro ! "303C";
         |HAZ Botones303;
     |SINO;
         nTecla = 4;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1;  |ACABA;  |FINSI;
     |SI nTecla = 4;  enInfComp = 1;  |FINSI;

     |SI nTecla = 1;  |O nTecla = 3;
         |HAZ CompruebaEjecutable;
         |SI enError = 1;  |ACABA;  |FINSI;

         |DDEFECTO #601;

         |HAZ AbreImprime303;
     |FINSI;

     |SI nTecla = 4;
         nSwCara = 0;
         |CONFI "    NImprimir Detalle de Tipos de IVA";
         |SI FSalida = 0;
             nSwCara = 1;
         |FINSI;

         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |SI nSwCara = 0;
             |INFOR "m303co01";
         |SINO;
             |INFOR "m303co02";
         |FINSI;

         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     aFichero = ("33" + Usuario) % 108;
     |NOME_DAT #583 aFichero;
     |ABRE #583;  |CIERRA #583;  |DELINDEX #583;

     |ABRE #583;
     nSwLee = 0;
     |SI #0#8 = "C";
         |BUCLE dsmow014C303;
     |SINO;
         |BUCLE dsmow014N303;
     |FINSI;

     |SI nTecla = 1;  |O nTecla = 3;
         |HAZ EmiteEsto303;
     |FINSI;
     |CIERRA #583;
     |DELINDEX #583;

     |SI nTecla = 4;
         |FININF;
         |FINIMP;
     |FINSI;
|FPRC;

|| ---------------------------------------------------------------------------
|PROCESO Carga303_2013;
     enCodCli = #303#0;
     |HAZ LeePersona;

     |DDEFECTO #583;

     #583#0 = #303#0;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;   #583#7  = eaVarDni;

         aAlfa1   = #718#2;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             eaAlfa = #718#2;  |HAZ QuitaRaros;  aAlfa1 = eaAlfa;
             eaAlfa = #718#3;  |HAZ QuitaRaros;  aAlfa2 = eaAlfa;
             #583#8 = aAlfa1 + " " + aAlfa2;
             eaAlfa = #718#4;  |HAZ QuitaRaros;  #583#9 = eaAlfa;
         |SINO;
             |HAZ PersonaFisica;
         |FINSI;

         eaAlfa  = #715#37;  |HAZ QuitaRaros;      #583#78 = eaAlfa;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;   #583#7   = eaVarDni;
         |HAZ PersonaFisica;

         eaAlfa   = #715#11;  |HAZ QuitaRaros;     #583#78 = eaAlfa;
     |FINSI;

     |SI #4#23 = "N";  #583#10 = "2";  |FINSI;
     |SI #4#23 = "S";  #583#10 = "1";  |FINSI;

     #583#11  = #303#1;

     |SI #4#22 = "T";
         |SI #303#2 = 3;   #583#12 = "1T";  |FINSI;
         |SI #303#2 = 6;   #583#12 = "2T";  |FINSI;
         |SI #303#2 = 9;   #583#12 = "3T";  |FINSI;
         |SI #303#2 = 12;  #583#12 = "4T";  |FINSI;
     |SINO;
         #583#12 = ("00" + #303#2) % -102;
     |FINSI;

     enNume = #303#6;   |HAZ Conver17;   #583#13 = eaAlfa;
     enNume = #303#7 * 100;              #583#14 = ("00000" + enNume) % -105;
     enNume = #303#8;   |HAZ Conver17;   #583#15 = eaAlfa;

     enNume = #303#9;   |HAZ Conver17;   #583#16 = eaAlfa;
     enNume = #303#10 * 100;             #583#17 = ("00000" + enNume) % -105;
     enNume = #303#11;  |HAZ Conver17;   #583#18 = eaAlfa;

     enNume = #303#12;  |HAZ Conver17;   #583#19 = eaAlfa;
     enNume = #303#13 * 100;             #583#20 = ("00000" + enNume) % -105;
     enNume = #303#14;  |HAZ Conver17;   #583#21 = eaAlfa;

     enNume = #303#15;  |HAZ Conver17;   #583#22 = eaAlfa;
     enNume = #303#16 * 100;             #583#23 = ("00000" + enNume) % -105;
     enNume = #303#17;  |HAZ Conver17;   #583#24 = eaAlfa;

     enNume = #303#18;  |HAZ Conver17;   #583#25 = eaAlfa;
     enNume = #303#19 * 100;             #583#26 = ("00000" + enNume) % -105;
     enNume = #303#20;  |HAZ Conver17;   #583#27 = eaAlfa;

     enNume = #303#21;  |HAZ Conver17;   #583#28 = eaAlfa;
     enNume = #303#22 * 100;             #583#29 = ("00000" + enNume) % -105;
     enNume = #303#23;  |HAZ Conver17;   #583#30 = eaAlfa;

     enNume = #303#24 + #303#27 + #303#30;  |HAZ Conver17;  #583#31 = eaAlfa;
     enNume = #303#26 + #303#29 + #303#32;  |HAZ Conver17;  #583#32 = eaAlfa;

     enNume = #303#33;  |HAZ Conver17;  #583#33 = eaAlfa;

     enNume = #303#34;  |HAZ Conver17;  #583#34 = eaAlfa;
     enNume = #303#35;  |HAZ Conver17;  #583#35 = eaAlfa;
     enNume = #303#36;  |HAZ Conver17;  #583#36 = eaAlfa;
     enNume = #303#37;  |HAZ Conver17;  #583#37 = eaAlfa;
     enNume = #303#38;  |HAZ Conver17;  #583#38 = eaAlfa;
     enNume = #303#39;  |HAZ Conver17;  #583#39 = eaAlfa;
     enNume = #303#40;  |HAZ Conver17;  #583#40 = eaAlfa;
     enNume = #303#41;  |HAZ Conver17;  #583#41 = eaAlfa;
     enNume = #303#42;  |HAZ Conver17;  #583#42 = eaAlfa;
     enNume = #303#43;  |HAZ Conver17;  #583#43 = eaAlfa;
     enNume = #303#44;  |HAZ Conver17;  #583#44 = eaAlfa;
     enNume = #303#45;  |HAZ Conver17;  #583#45 = eaAlfa;
     enNume = #303#46;  |HAZ Conver17;  #583#46 = eaAlfa;
     enNume = #303#47;  |HAZ Conver17;  #583#47 = eaAlfa;
     enNume = #303#48;  |HAZ Conver17;  #583#48 = eaAlfa;
     enNume = #303#49;  |HAZ Conver17;  #583#49 = eaAlfa;
     enNume = #303#50;  |HAZ Conver17;  #583#50 = eaAlfa;

     nNume  = #303#51 * 100;            #583#51 = ("00000" + nNume) % -105;
     enNume = #303#52;  |HAZ Conver17;  #583#52 = eaAlfa;
     enNume = #303#53;  |HAZ Conver17;  #583#53 = eaAlfa;
     enNume = #303#54;  |HAZ Conver17;  #583#54 = eaAlfa;
     enNume = #303#55;  |HAZ Conver17;  #583#55 = eaAlfa;
     enNume = #303#56;  |HAZ Conver17;  #583#56 = eaAlfa;
     enNume = #303#57;  |HAZ Conver17;  #583#57 = eaAlfa;
     enNume = #303#58;  |HAZ Conver17;  #583#58 = eaAlfa;
     enNume = #303#59;  |HAZ Conver17;  #583#59 = eaAlfa;
     enNume = #303#60;  |HAZ Conver17;  #583#60 = eaAlfa;

     enNume = #303#61;  |HAZ Conver17;  #583#61 = eaAlfa;

     #583#62 = "0";

     |SI #303#61 = 0; |Y #303#62 = 0;  |Y #303#63 = 0;
         #583#62 = "1";
     |FINSI;

     enNume = #303#62;  |HAZ Conver17;  #583#63 = eaAlfa;
     enNume = #303#63;  |HAZ Conver17;  #583#69 = eaAlfa;

     |HAZ TDeclaracion303;

     #583#74 = "0";

     |SI #303#4 > 0;
         #583#74 = "1";
         #583#75 = #4#21;
     |FINSI;

     eaAlfa  = #0#7;  |HAZ FechaBonito;

     #583#79 = eaDiaB;
     #583#80 = eaMesB;
     #583#81 = eaAnyoB;
     #583#83 = &13 + &10;

     nTCampo = 83;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #583nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;

     enImpReal  = #303#50;  ||Casilla 28
     enCas21    = #303#33;
     enCas27    = #303#49;
     enCas31    = #303#53;
     enCas34    = #303#60;
     enIngresar = #303#63;
     enDevolver = #303#62;
     enCompensar= #303#61;
|FPRC;

|PROCESO dsmow014_2013;
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #303;
     #303#0 = #4#0;
     #303#1 = #4#1;
     #303#2 = #4#2;
     #303#3 = #4#3;
     #303#4 = #4#4;
     #303#5 = 0;
     |LEE 040#303=;
     |SI FSalida ! 0;  |CIERRA #303;  |ACABA;  |FINSI;
     |CIERRA #303;

     eaFicheroPlano = "303" + (("00000" + #999#0) % -105) + ".txt";
     eaFicheroImpre = "303" + (("00000" + #999#0) % -105) + ".pdf";
     eaFicheroError = "err" + (("00000" + #999#0) % -105) + ".txt";

     aAlfa = eaPathLanza + eaFicheroPlano;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroImpre;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroError;  |RFBORRA aAlfa;

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Carga303_2013;

     |XCIERRA nHandle2;

     enEmpresa    = #999#0;
     eaNomEmpresa = #999#3;

     |HAZ PresentaModelo_01;
|FPRC;

|DEFBUCLE dsmow014C_2013;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, dsmow014_2013;
|FIN;

|DEFBUCLE dsmow014N_2013;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, dsmow014_2013;
|FIN;

|PROCESO Bloque2013;
     |HAZ BotonesMPFPortal;
     nTecla = enTecla;

     |SI nTecla = 0;  |ACABA;  |FINSI;

     nSwLee = 0;
     |SI #0#8 = "C";
         |BUCLE dsmow014C_2013;
     |SINO;
         |BUCLE dsmow014N_2013;
     |FINSI;

     |HAZ SacaErrorPtl;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO moy30301;
     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     enSwTrata      = 0;
     enCambiaMoneda = 1;

     |SI #0#6 [ 2012;  |O eaParametro = "303C";
         |HAZ Bloque2012;
         |ACABA;
     |FINSI;

     |SI #0#6 = 2013;
         |HAZ Bloque2013;
     |FINSI;
|FPRC;
