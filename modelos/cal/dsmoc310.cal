|FICHEROS;
     dsmoc310 #0;
     dsmoc311 #1,MANTE;
     dsmoc349 #349;
     dsmod300 #300;
     dsmod303 #303;
     dsmod310 #310;
     dsmod320 #320;
     dsmod330 #330;
     dsmod332 #332;
     dsmod370 #370;
     dsmom004 #4;
     dsmom008 #8;
     dsmom017 #17;
     dsmom028 #28;
     dsmom030 #30;
     dsmom047 #47;
     dsmom103 #103;

     dsmociva;
     dsmom033;
     dsmom133;

     dsmom087  #87;

     dsmod310@ #1310;

     :/basica/def/agicen14 #114;
     :/contagen/def/camaniva #802;
     :/contagen/def/caivalin #803;
     :/contagen/def/caivaasi #804;

     dsmow120 #99,MANTE;
     espejo1@ #100;
|FIN;

|VARIABLES;
     aModo       = "";
     nInkey      = 0;
     nSwEsta     = 0;
     nEjerAnt    = 0;
     nPer        = 0;
     nSwGraba    = 0;
     nTipo       = 0;
     nCompensar  = 0;
     nDPeriodo   = 0;
     nHPeriodo   = 0;
     nCuotaSopor = 0;
     nTotal      = 0;
     nTanto      = 0;
     nHComple    = 0;
     nEl36       = 0;
     nModAnter   = 0;
     nAnyo       = 0;
     nDPer349    = 0;
     nHPer349    = 0;
     nComplem    = 0;
     nParaBorra  = 0;
     aPathModelo = "";
     aDef        = "";
     aAlfa       = "";
     aAlfa1      = "";
     aBase       = "";
     aMas        = "";
     aParametro  = "";
     aClave      = "";
     nDepar      = 0;
     nCtVolumen  = 0;
     nAntes1     = 0;
     nTrim       = 0;
     nHasta      = 0;
     nCampo1     = 0;
     nCampo2     = 0;
     nCampo3     = 0;
     nCampo4     = 0;
     nCampo5     = 0;

     &enProAct   = 0;
     &enProCom   = 0;
     &EURODB     = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|| --------------------------------------------------------------------------
|| Calculos del proceso dsmoc311
|| --------------------------------------------------------------------------
|PROCESO Tipo12W120; |TIPO 12;
|FPRC;

|PROCESO Tipo7C7; |TIPO 7;
     |ABRE #dsmom033;
     #dsmom033#0 = #dsmoc311#6;
     |LEE 000#dsmom033.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom033;  |FINSI;
     |CIERRA #dsmom033;

     |ABRE #dsmom133;
     #dsmom133#0 = #dsmoc311#6;
     #dsmom133#1 = #dsmoc311#1;
     |LEE 000#dsmom133.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom133;  |FINSI;
     |CIERRA #dsmom133;

     #dsmoc311#9  = #dsmom133#3;
     #dsmoc311#10 = #dsmom133#4;

     |PINTA #dsmoc311#9;
     |PINTA #dsmoc311#10;
|FPRC;

|PROCESO Derivada_Aux;
     |SI Campo = 3; |O Campo = 4; |O Campo = 5; |O Campo = 6;
         |O Campo = 7; |O Campo = 13;

         nCampo1 = 3;
         nCampo2 = 4;
         nCampo3 = 6;
         nCampo4 = 7;
         nCampo5 = 13;
     |SINO;
         nCampo1 = 8;
         nCampo2 = 9;
         nCampo3 = 11;
         nCampo4 = 12;
         nCampo5 = 14;
     |FINSI;

     nTotal      = #99nCampo1 * #99nCampo2;
     nCuotaSopor = #99nCampo3 + (nTotal % 1);

     #99nCampo5 = nTotal;
     #99nCampo4 = nTotal - nCuotaSopor;

     |PINTA #99nCampo4;
     |PINTA #99nCampo5;
|FPRC;


|PROCESO AntesCultivo2010; |TIPO 7;
   aAlfa1 = "    <F11> Consulta de los Cultivos."
   |SI #1#2 = 12;
       |SI #1#1 = 2010; |O #1#1 = 2012;
           aAlfa1 = aAlfa1 + " <F2> Consulta Desglose Importe por periodos";
       |FINSI;
   |FINSI;
   |MENSA aAlfa1;
|FPRC;

|PROCESO DesCultivo; |TIPO 0;
   |BLIN 4;
|FPRC;

|PROCESO Cultivo2010; |TIPO 11;
   |SI FSalida = 10;
       |SI #1#2 = 12;
           |SI #1#1 = 2010; |O #1#1 = 2012;
               |LEE 041#1=;
               |SI FSalida = 0;
                   #99#0 = "DESGLOSE CULTIVO ULTIMO PERIODO MODELO 310";
                   #99#1 = #1#6;
                   #99#2 = #1#7;
                   |PARA nCampo1 = 13; |SI nCampo1 [ 22;  |HACIENDO nCampo1 = nCampo1 + 1;
                         nCampo2 = nCampo1 - 10;
                         #99nCampo2 = #1nCampo1;
                   |SIGUE;

                   |PUSHV 0501 2380;
                   |PINPA #0#99;
                   |SI #1#1 = 2010;
                       |ATRI R; |PINTA 1131, "30.06.2010";
                       |PINTA 1164, "01.07.2010"; |ATRI 0;
                   |FINSI;
                   |PINDA #0#99;
                   |PAUSA;
                   |POPV;
               |FINSI;
           |FINSI;
       |FINSI;
       |ERROR;
   |FINSI;
|FPRC;

|PROCESO Calculo2010; |TIPO 7;
   |SI #1#2 = 12;
       |SI #1#1 = 2010; |O #1#1 = 2012;
           #99#0 = "DESGLOSE CULTIVO ULTIMO PERIODO MODELO 310";
           #99#1 = #1#6;
           #99#2 = #1#7;
           |PARA nCampo1 = 13; |SI nCampo1 [ 22;  |HACIENDO nCampo1 = nCampo1 + 1;
                 nCampo2 = nCampo1 - 10;
                 #99nCampo2 = #1nCampo1;
           |SIGUE;
           |SI #1#14 = 0; #99#4  = #1#9;  |FINSI;
           |SI #1#19 = 0; #99#9  = #1#9;  |FINSI;
           |SI #1#15 = 0; #99#5  = #1#10; |FINSI;
           |SI #1#20 = 0; #99#10 = #1#10; |FINSI;

           |PUSHV 0501 2380;
           |PINPA #0#99;
           |SI #1#1 = 2010;
               |ATRI R; |PINTA 1131, "30.06.2010";
               |PINTA 1164, "01.07.2010"; |ATRI 0;
           |FINSI;
           |PINDA #0#99;
           |ENDATOS #1#99;
           |SI FSalida = 0;
               |PARA nCampo1 = 13;  |SI nCampo1 [ 22;  |HACIENDO nCampo1 = nCampo1 + 1;
                     nCampo2 = nCampo1 - 10;
                     #1nCampo1 = #99nCampo2;
               |SIGUE;
           |FINSI;
           |POPV;
           |PTEC 802;
           |HAZ Derivada;
           |PINTA #1#8;
           |PINTA #1#9;
           |PINTA #1#10;
           |PINTA #1#11;
       |FINSI;
 |FINSI;
|FPRC;

|PROCESO Derivada;

     #1#23 = 1;
     |SI #1#2 = 12;
         |SI #1#1 = 2010; |O #1#1 = 2012;
             #1#8 = #1#13 + #1#18;
             nTotal = (#1#13 * #1#14) + (#1#18 * #1#19);
             nTanto = (nTotal / #1#8) ! 5;
             #1#9 = nTanto;
             #1#10 = ((#1#15 + #1#20) / 2) ! 2;
             #1#11 = #1#16 + #1#21;
             #1#12 = #1#17 + #1#22;
             |PINTA #1#12;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #1#2 ! 12;
         nTotal      = (#1#8 * #1#9) ! EURODB;
         nTotal      = ((nTotal * #1#10) / 100) ! EURODB;
         nCuotaSopor = 0;
     |SINO;
         nTotal      = (#1#8 * #1#9) ! EURODB;
         nCuotaSopor = (#1#11 + (nTotal % 1)) ! EURODB;
     |FINSI;

     #1#12 = nTotal - nCuotaSopor;
     |PINTA #1#12;
|FPRC;

|| --------------------------------------------------------------------------
|| Calculos del proceso dsmoc310
|| --------------------------------------------------------------------------

|RUTINA Baja1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = #0#2;
     #1#3 = #0#3;
     #1#4 = #0#4;
     #1#5 = #0#5;
     #1#6 = 1;
|FRUT;

|RUTINA Alta1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = #0#2;
     #1#3 = #0#3;
     #1#4 = #0#4;
     #1#5 = #0#5;
     #1#6 = 999;
|FRUT;

|PROCESO dsmoc311;
     #0#9 = #0#9 + #1#12;
     |SI #0#2 = 12;  #0#19 = #0#19 + #1#8; |FINSI;
|FPRC;

|DEFBUCLE dsmoc311;
     #1#1;
     ;
     #0#0, #0#1, #0#2, #0#3, #0#4, #0#5, 001;
     #0#0, #0#1, #0#2, #0#3, #0#4, #0#5, 999;
     ;
     NULL, dsmoc311;
|FIN;

|PROCESO Cultivos;  |TIPO 0;
     |SI #0#8 ! "S";  |ACABA;  |FINSI;

     |SI FSalida = 10;
         |PUSHV 0501 2380;

                         |C_M #1#11, 1, "S";
         |SI #0#2 ! 12;  |C_M #1#11, 1, "N";  |FINSI;
         |SI #0#2 = 12;
             |SI #0#1 = 2010; |O #0#1 = 2012;
                 |C_M #1#9,  1, "N";
                 |C_M #1#10, 1, "N";
             |FINSI;
         |FINSI;

         |ENTLINEAL #1#1, -7, 2, 22, 1, Baja1, Alta1;
         |POPV;
     |FINSI;

     |SI #0#1 ] 2014;
         #0#9  = 0;
         #0#19 = 0;
     |FINSI;

     |ABRE #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = #0#2;
     #1#3 = #0#3;
     #1#4 = #0#4;
     #1#5 = #0#5;
     #1#6 = 1;
     |LEE 000#1];
     |SI FSalida = 0;  |Y #1#0 = #0#0; |Y #1#1 = #0#1; |Y #1#2 = #0#2;
                       |Y #1#3 = #0#3; |Y #1#4 = #0#4; |Y #1#5 = #0#5;
         |CIERRA #1;
         #0#9 = 0;
         |SI #0#2 = 12;  #0#19 = 0; |FINSI;

         |BUCLE dsmoc311;
     |SINO;
         |SI #0#2 = 12;
             |SI #0#1 = 2010; |O #0#1 = 2012;
                 |CONFI "1234NNo hay Informados Cultivos, dejar a 0 la Cuota Derivada y Vol.Operaciones";
                 |SI FSalida = 0;
                     #0#9  = 0;
                     #0#19 = 0;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #1;

     |PINTA #0#9;
     |PINTA #0#19;
|FPRC;

|PROCESO dsmom004R;
     |SI #4#7 = " ";  |ACABA;  |FINSI;

     nCompensar = 0;
     |SI #4#15 < 0;  nCompensar = #4#15;  |FINSI;
|FPRC;

|DEFBUCLE dsmom004R;
     #4#1;
     ;
     enEmpresa, enEjer, nDPeriodo, enModelo, 00;
     enEmpresa, enEjer, nHPeriodo, enModelo, 99;
     ;
     NULL, dsmom004R;
|FINSI;

|PROCESO LeeComplem;
  |SI nModAnter = 332; nEjerAnt = #332#67; |FINSI;
  |SI nModAnter = 330; nEjerAnt = #330#67; |FINSI;
  |SI nModAnter = 320; nEjerAnt = #320#65; |FINSI;
  |SI nModAnter = 300; nEjerAnt = #300#63; |FINSI;
  |SI nModAnter = 303; nEjerAnt = #303#61; |FINSI;
  |SI nModAnter = 310; nEjerAnt = #310#38; |FINSI;
  |SI nModAnter = 370; nEjerAnt = #370#84; |FINSI;
|FPRC;

|DEFBUCLE LeeCompl332;
  #332#1;
  ;
  enEmpresa, #4#1, #4#2, nModAnter, 00, 00;
  enEmpresa, #4#1, #4#2, nModAnter, 99, 00;
  ;
  NULL, LeeComplem;
|FIN;

|DEFBUCLE LeeCompl330;
  #330#1;
  ;
  enEmpresa, #4#1, #4#2, nModAnter, 00, 00;
  enEmpresa, #4#1, #4#2, nModAnter, 99, 00;
  ;
  NULL, LeeComplem;
|FIN;

|DEFBUCLE LeeCompl320;
  #320#1;
  ;
  enEmpresa, #4#1, #4#2, nModAnter, 00, 00;
  enEmpresa, #4#1, #4#2, nModAnter, 99, 00;
  ;
  NULL, LeeComplem;
|FIN;

|DEFBUCLE LeeCompl300;
  #300#1;
  ;
  enEmpresa, #4#1, #4#2, nModAnter, 00, 00;
  enEmpresa, #4#1, #4#2, nModAnter, 99, 00;
  ;
  NULL, LeeComplem;
|FIN;

|DEFBUCLE LeeCompl303;
  #303#1;
  ;
  enEmpresa, #4#1, #4#2, nModAnter, 00, 00;
  enEmpresa, #4#1, #4#2, nModAnter, 99, 00;
  ;
  NULL, LeeComplem;
|FIN;

|DEFBUCLE LeeCompl310;
  #310#1;
  ;
  enEmpresa, #4#1, #4#2, nModAnter, 00, 00;
  enEmpresa, #4#1, #4#2, nModAnter, 99, 00;
  ;
  NULL, LeeComplem;
|FIN;

|DEFBUCLE LeeCompl370;
  #370#1;
  ;
  enEmpresa, #4#1, #4#2, nModAnter, 00, 00;
  enEmpresa, #4#1, #4#2, nModAnter, 99, 00;
  ;
  NULL, LeeComplem;
|FIN;

|PROCESO EjerAnt;
      nEjerAnt = nEjerAnt + #103#5;
|FPRC;

|DEFBUCLE dsmom103;
     #103#1;
     ;
     enModelo, enEmpresa, 00, nAnyo, nPer;
     enModelo, enEmpresa, 99, nAnyo, nPer;
     ;
     NULL, EjerAnt;
|FIN;

|PROCESO RecogeAnter;
     |ABRE #4;
     |SI enPeriodo = 3;
         nAnyo     = enEjer - 1;
         nPer      = 12;
         nModAnter = 0;
     |SINO;
         nAnyo     = enEjer;
         nPer      = enPeriodo - 3;
         nModAnter = 310;
     |FINSI;

     |SI nModAnter = 0;
         #4#0 = enEmpresa;
         #4#1 = nAnyo;
         #4#2 = nPer;
         #4#3 = 310;
         #4#4 = enComplem;
         |LEE 040#4=;
         |SI FSalida = 0;  nModAnter = #4#3;  |FINSI;
     |FINSI;

     |SI nModAnter = 0;
         #4#0 = enEmpresa;
         #4#1 = nAnyo;
         #4#2 = nPer;
         #4#3 = 303;
         #4#4 = enComplem;
         |LEE 040#4=;
         |SI FSalida = 0;  nModAnter = #4#3;  |FINSI;
     |FINSI;

     |SI nModAnter = 0;
         #4#0 = enEmpresa;
         #4#1 = nAnyo;
         #4#2 = nPer;
         #4#3 = 300;
         #4#4 = enComplem;
         |LEE 040#4=;
         |SI FSalida = 0;  nModAnter = #4#3;  |FINSI;
     |FINSI;

     |SI nModAnter = 0;
         #4#0 = enEmpresa;
         #4#1 = nAnyo;
         #4#2 = nPer;
         #4#3 = 320;
         #4#4 = enComplem;
         |LEE 040#4=;
         |SI FSalida = 0;  nModAnter = #4#3;  |FINSI;
     |FINSI;

     |SI nModAnter = 0;
         #4#0 = enEmpresa;
         #4#1 = nAnyo;
         #4#2 = nPer;
         #4#3 = 332;
         #4#4 = enComplem;
         |LEE 040#4=;
         |SI FSalida = 0;  nModAnter = #4#3;  |FINSI;
     |FINSI;

     |SI nModAnter = 0;
         #4#0 = enEmpresa;
         #4#1 = nAnyo;
         #4#2 = nPer;
         #4#3 = 330;
         #4#4 = enComplem;
         |LEE 040#4=;
         |SI FSalida = 0;  nModAnter = #4#3;  |FINSI;
     |FINSI;

     |SI nModAnter = 0;
         #4#0 = enEmpresa;
         #4#1 = nAnyo;
         #4#2 = nPer;
         #4#3 = 370;
         #4#4 = enComplem;
         |LEE 040#4=;
         |SI FSalida = 0;  nModAnter = #4#3;  |FINSI;
     |FINSI;

     #4#0 = enEmpresa;
     #4#1 = nAnyo;
     #4#2 = nPer;
     #4#3 = nModAnter;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;

     |CIERRA #4;

     nEjerAnt = 0;
     |SI nModAnter = 310;  |BUCLE LeeCompl310;  |FINSI;
     |SI nModAnter = 303;  |BUCLE LeeCompl303;  |FINSI;
     |SI nModAnter = 300;  |BUCLE LeeCompl300;  |FINSI;
     |SI nModAnter = 320;  |BUCLE LeeCompl320;  |FINSI;
     |SI nModAnter = 330;  |BUCLE LeeCompl330;  |FINSI;
     |SI nModAnter = 332;  |BUCLE LeeCompl332;  |FINSI;
     |SI nModAnter = 370;  |BUCLE LeeCompl370;  |FINSI;
     |SI nEjerAnt  = 0;    |BUCLE dsmom103;     |FINSI;

     |ABRE #47;
     #47#0 = enEmpresa;
     #47#1 = enEjer;
     #47#2 = enPeriodo;
     #47#3 = enModelo;
     #47#4 = enComplem;
     #47#5 = 0;
     |LEE 040#47=;
     |SI FSalida ! 0;  |DDEFECTO #47;  |FINSI;
     |CIERRA #47;

     |ABRE #28;
     #28#0 = enEmpresa;
     #28#1 = enEjer;
     #28#2 = enPeriodo;
     #28#3 = enModelo;
     #28#4 = enComplem;
     #28#5 = 0;
     |LEE 040#28=;
     |SI FSalida ! 0;  |DDEFECTO #28;  |FINSI;
     |CIERRA #28;

     |SI #28#7 = "N";  |ACABA;  |FINSI;

     nEjerAnt = nEjerAnt - #28#6;
     |SI nEjerAnt < 0;  nEjerAnt = 0;  |FINSI;
|FPRC;

|PROCESO GrabaModelo;

     nSwGraba = 1;
     #310#27 = #310#27 + #0#10;
     #310#28 = #310#28 + #0#11;
     #310#29 = #310#29 + #0#12 + #0#17;

     #310#31 = #310#31 + #0#13;
     #310#32 = #310#32 + #0#14;

     #310#37 = #310#37 + #0#15;

     |SI #0#16 ! 0;  #310#35 = #0#16;  |FINSI;

     |SI #0#8 = "N";
         |SI #310#6 = "    ";  |Y #310#7 = 0;
             #310#6 = #0#6;
             #310#7 = #0#9;
             |ACABA;
         |FINSI;

         |SI #310#8 = "    ";  |Y #310#9 = 0;
             #310#8 = #0#6;
             #310#9 = #0#9;
             |ACABA;
         |FINSI;

         |SI #310#10 = "    ";  |Y #310#11 = 0;
             #310#10 = #0#6;
             #310#11 = #0#9;
             |ACABA;
         |FINSI;

         |SI #310#12 = "    ";  |Y #310#13 = 0;
             #310#12 = #0#6;
             #310#13 = #0#9;
             |ACABA;
         |FINSI;

         |SI #310#14 = "    ";  |Y #310#15 = 0;
             #310#14 = #0#6;
             #310#15 = #0#9;
             |ACABA;
         |FINSI;

         #310#14 = "";
         #310#15 = #310#15 + #0#9;
     |FINSI;

     |SI #0#8 = "S";
         |SI #310#16 = "                                        ";  |Y #310#17 = 0;
             #310#16 = #0#7;
             #310#17 = #0#9;
             |ACABA;
         |FINSI;

         |SI #310#18 = "                                        ";  |Y #310#19 = 0;
             #310#18 = #0#7;
             #310#19 = #0#9;
             |ACABA;
         |FINSI;

         |SI #310#20 = "                                        ";  |Y #310#21 = 0;
             #310#20 = #0#7;
             #310#21 = #0#9;
             |ACABA;
         |FINSI;

         |SI #310#22 = "                                        ";  |Y #310#23 = 0;
             #310#22 = #0#7;
             #310#23 = #0#9;
             |ACABA;
         |FINSI;

         #310#22 = "";
         #310#23 = #310#23 + #0#9;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc310;
     #0#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 01;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 99;
     e;
     NULL, GrabaModelo;
|FIN;

|PROCESO IngreRealizados;
     #4#0   = #0#0;
     #4#1   = #0#1;
     #4#2   = #0#2;
     #4#3   = 310;
     #4#4   = #0#4 + 1;
     |LEE 040#4=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #310#25 = #310#25 + #0#9;
|FPRC;

|DEFBUCLE dsmoc310R;
     #0#1;
     ;
     enEmpresa, enEjer, 3, 000,  0, 01;
     enEmpresa, enEjer, 9, 999, 99, 99;
     e;
     NULL, IngreRealizados;
|FIN;

|PROCESO dsmod310;
     #310#41 = #310#41 + #1310#40;
|FPRC;

|DEFBUCLE dsmod310;
     #1310#1006;
     ;
     #310#0, #310#1, #310#2, #310#3,        0, #310#5;
     #310#0, #310#1, #310#2, #310#3, nHComple, #310#5;
     ;
     NULL, dsmod310;
|FIN;

|PROCESO CapturaOtros310;
     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsmod310.mas";
     |CARGA_DEF aMas, dsmod310@;

     nHComple = #310#4 - 1;
     #310#41  = 0;

     |BUCLE dsmod310;

     |DESCARGA_DEF #dsmod310@;
|FPRC;

|PROCESO Totales310;
     |SI #310#2 = 12;
         #310#25 = 0;
         |ABRE #4;
         |BUCLE dsmoc310R;
         |CIERRA #4;
     |FINSI;
     #310#13 = #310#13 - #47#13;  ||regularizacion Manual

     #310#24 = #310#7  + #310#9  + #310#11 + #310#13 + #310#15;
     #310#24 = #310#24 + #310#17 + #310#19 + #310#21 + #310#23;
     #310#26 = #310#24 - #310#25;
     #310#30 = #310#26 + #310#27 + #310#28 + #310#29;
     #310#33 = #310#31 + #310#32;
     #310#34 = #310#30 - #310#33;
     #310#36 = #310#34 - #310#35;
     nEl36   = #310#36;

     |SI #310#4 > 0;
         |HAZ CapturaOtros310;
         nEl36 = nEl36 - #310#41;
         |SI nEl36 < 0;
             |MENAV "    RECUERDE. Si el resultado NO es a INGRESAR, NO procede declaracion complementaria";
         |FINSI;
     |FINSI;

     |SI nEl36 ] 0;
         #310#40 = nEl36;
     |SINO;
         |SI #310#2 = 12;
             |HAZ UltimoPeriodo;
             |SI eaUltimoPer = "COMPENSAR";
                 #310#38 = -nEl36;
                 #310#39 = 0;
                 #310#40 = 0;
             |SINO;
                 #310#39 = -nEl36;
                 #310#38 = 0;
                 #310#40 = 0;
             |FINSI;
         |SINO;
             #310#38 = -nEl36;
             #310#39 = 0;
             #310#40 = 0;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaRegistro0;
     |SI enModelo = 310;
         |ABRE #310;
         #310#0 = enEmpresa;
         #310#1 = enEjer;
         #310#2 = enPeriodo;
         #310#3 = enModelo;
         #310#4 = enComplem;
         #310#5 = 0;
         |LEE 101#310=;
         |SI FSalida = 0;
             |BORRA 020#310a;
         |FINSI;
         |LIBERA #310;
     |FINSI;

     |SI enModelo = 370;
         |ABRE #370;
         #370#0 = enEmpresa;
         #370#1 = enEjer;
         #370#2 = enPeriodo;
         #370#3 = enModelo;
         #370#4 = enComplem;
         #370#5 = 0;
         |LEE 101#370=;
         |SI FSalida = 0;
             |BORRA 020#370a;
         |FINSI;
         |LIBERA #370;
     |FINSI;

     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = enPeriodo;
     #8#3 = enModelo;
     #8#4 = enComplem;
     #8#5 = 0;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS ";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;

     |SI enEjer [ 2013;
         |SI enModelo = 310;
             |HAZ RecogeAnter;

             #310#0 = enEmpresa;
             #310#1 = enEjer;
             #310#2 = enPeriodo;
             #310#3 = enModelo;
             #310#4 = enComplem;
             #310#5 = 0;
             |LEE 101#310=;
             |SI FSalida ! 0;
                 |DDEFECTO #310;
                 #310#0 = enEmpresa;
                 #310#1 = enEjer;
                 #310#2 = enPeriodo;
                 #310#3 = enModelo;
                 #310#4 = enComplem;
                 #310#5 = 0;
                 |GRABA 020#310b;
             |FINSI;

             #310#35 = nEjerAnt;

             nSwGraba = 0;
             |BUCLE dsmoc310;

             |SI nSwGraba = 0;
                 |BORRA 020#310c;
                 |LIBERA #310;
                 |CIERRA #310;
                 |ACABA;
             |FINSI;

             |HAZ Totales310;

             |GRABA 020#310a;
             |LIBERA #310;
             |CIERRA #310;
         |FINSI;

         |SI enModelo = 370;
             nTipo         = enTipoEntrada;
             enTipoEntrada = 98;
             |SUB_EJECUTA_NP "dsmod370;NOMEQUITES";
             enTipoEntrada = nTipo;
             nSwGraba      = enExistencia;
         |FINSI;
     |FINSI;

     |SI enEjer ] 2014;
         nTipo         = enTipoEntrada;
         enTipoEntrada = 98;

         aParametro = ("00000" + enEmpresa) % -105;
         aParametro = aParametro + ("0000" + enEjer) % -104;
         aParametro = aParametro + ("00" + enPeriodo) % -102;
         aParametro = aParametro + ("000" + enModelo) % -103;
         aParametro = aParametro + ("00" + enComplem) % -102;
         aParametro = aParametro + ("00" + enActividad) % -102;
         aParametro = aParametro + ("00" + enTipoEntrada) % -102;
         aParametro = aParametro + ("0" + enExistencia) % -101;

         aAlfa = "dsm30301;" + aParametro;
         |SUB_EJECUTA_NP aAlfa;
         enTipoEntrada = nTipo;
         nSwGraba      = enExistencia;
     |FINSI;

     |ABRE #8;
     #0#0 = enEmpresa;
     #0#1 = enEjer;
     #0#2 = enPeriodo;
     #0#3 = enModelo;
     #0#4 = enComplem;
     #0#5 = enActividad;
     |LEE 040#0=;
     |SI FSalida = 0;
         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = enPeriodo;
         #8#3 = enModelo;
         #8#4 = enComplem;
         #8#5 = enActividad;
         |LEE 101#8=;
         |SI FSalida = 0;
             #8#11 = "COMPLETADO";
             |GRABA 020#8a;
         |FINSI;
         |LIBERA #8;
     |FINSI;

     |SI nSwGraba = 1;
         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = enPeriodo;
         #8#3 = enModelo;
         #8#4 = enComplem;
         #8#5 = 0;
         |LEE 101#8=;
         |SI FSalida = 0;
             #8#11 = "EXISTENTE";
             |GRABA 020#8a;
         |FINSI;
         |LIBERA #8;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO dsmoc311B;
     |BORRA 020#dsmoc311.a;
     |LIBERA #dsmoc311;
|FPRC;

|DEFBUCLE dsmoc311B;
     #dsmoc311#1;
     ;
     #dsmoc310#0, #dsmoc310#1, #dsmoc310#2, #dsmoc310#3, #dsmoc310#4, #dsmoc310#5, 001;
     #dsmoc310#0, #dsmoc310#1, #dsmoc310#2, #dsmoc310#3, #dsmoc310#4, #dsmoc310#5, 999;
     be;
     NULL, dsmoc311B;
|FIN;

|PROCESO BajaModelo;
     |SI enTipoEntrada = 97;
         |SI #0#10 = 0; |Y  #0#11 = 0; |Y  #0#12 = 0;  |Y #0#17 = 0;
          |Y #0#13 = 0; |Y  #0#14 = 0; |Y  #0#15 = 0;  |Y #0#16 = 0;
          |Y #0#18 = 0;
             |BUCLE dsmoc311B;

             |BORRA 020#0a;
             |LIBERA #0;
             |SI enEjer > 2010;
                 aModo = "B"; |HAZ Tratadsmom087_s;
             |FINSI;
         |SINO;
             #0#9 = 0;
             |GRABA 020#0a;
             |LIBERA #0;
             |ACABA;
         |FINSI;
     |SINO;
         |SI #0#10 ! 0;  |O #0#15 ! 0;
             |MENAV "     Entre y borre las Adquisiciones y Entregas.";
             |ERROR;
             |ACABA;
         |SINO;
             |BORRA 020#0a;
             |LIBERA #0;
             |SI enEjer > 2010;
                 aModo = "B"; |HAZ Tratadsmom087_s;
             |FINSI;
         |FINSI;
     |FINSI;

     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = enEjer;
     #8#2 = enPeriodo;
     #8#3 = enModelo;
     #8#4 = enComplem;
     #8#5 = enActividad;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "SIN DATOS ";
         |GRABA 020#8a;
     |FINSI;
     |LIBERA #8;
     |CIERRA #8;
|FPRC;

|DEFBUCLE dsmoc310B;
     #0#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, enActividad;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, enActividad;
     be;
     NULL, BajaModelo;
|FIN;

|PROCESO BajaModeloCiva;
     |BORRA 020#dsmociva.a;
     |LIBERA #dsmociva;
|FPRC;

|DEFBUCLE dsmociva310;
     #dsmociva#1;
     ;
     enEmpresa, enEjer, enPeriodo, 000, enComplem, enActividad, 0,  0;
     enEmpresa, enEjer, enPeriodo, 999, enComplem, enActividad, 9, 99;
     be;
     NULL, BajaModeloCiva;
|FIN;

|PROCESO BajaF87Modelo310;
     |BORRA 020#dsmom087.a;
     |LIBERA #dsmom087;
|FPRC;

|DEFBUCLE dsmom087310;
     #dsmom087#1;
     ;
     enEmpresa, enEjer, enPeriodo, 000, enComplem, enActividad, 0,  0;
     enEmpresa, enEjer, enPeriodo, 999, enComplem, enActividad, 9, 99;
     be;
     NULL, BajaF87Modelo310;
|FIN;

|PROCESO Tipo12moc310;  |TIPO 12;
|FPRC;

|PROCESO ChequeaGraba;
     |SI #0#9  = 0; |Y  #0#10 = 0; |Y  #0#11 = 0; |Y  #0#12 = 0;
      |Y #0#13 = 0; |Y  #0#14 = 0; |Y  #0#15 = 0; |Y  #0#16 = 0;
      |Y #0#17 = 0; |Y  #0#18 = 0;
         |ABRE #17;
         #17#0 = #0#0;
         #17#1 = #0#1;
         #17#2 = 0;             ||   ... #0#4; Modulo siempre 0
         #17#3 = #0#5;
         |LEE 040#17=;
         |SI FSalida ! 0;  |DDEFECTO #17;  |FINSI;
         |CIERRA #17;

         nParaBorra = 0;
         |SI #0#2 = 3;  |Y #17#15 = 0; nParaBorra = 1;  |FINSI;
         |SI #0#2 = 6;  |Y #17#16 = 0; nParaBorra = 1;  |FINSI;
         |SI #0#2 = 9;  |Y #17#17 = 0; nParaBorra = 1;  |FINSI;
         |SI #0#2 = 12; |Y #17#18 = 0; nParaBorra = 1;  |FINSI;
         |SI nParaBorra = 1;
            |CONFI "0000NEl Importe es igual a Cero, desea Impreso SIN Actividad ";
            |SI FSalida = 0;
                |GRABA 020#0a;
                |ACABA;
            |FINSI;
         |FINSI;

         |SI #0#2 = 3;  |Y #17#15 = 0;
             enEntrada = 0;
             |BORRA 020#0a;
             |ACABA;
         |FINSI;

         |SI #0#2 = 6;  |Y #17#16 = 0;
             enEntrada = 0;
             |BORRA 020#0a;
             |ACABA;
         |FINSI;

         |SI #0#2 = 9;  |Y #17#17 = 0;
             enEntrada = 0;
             |BORRA 020#0a;
             |ACABA;
         |FINSI;

         |SI #0#2 = 12; |Y #17#24 = 0;
             enEntrada = 0;
             |BORRA 020#0a;
             |ACABA;
         |FINSI;
     |FINSI;

     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|PROCESO Calcu349;
     |SI #349#6 = "A ";
         #0#10 = #0#10 + #349#12 + #349#15 + #349#18 + #349#21 + #349#30 + #349#33 + #349#36;
     |FINSI;

     |SI #349#6 = "I ";
         #0#17 = #0#17 + #349#12 + #349#15 + #349#18 + #349#21 + #349#30 + #349#33 + #349#36;
     |FINSI;

     |SI #349#6 = "E "; |O #349#6 = "M ";
          |O #349#6 = "H "; |O #349#6 = "T ";
         #0#15 = #0#15 + #349#22;
     |FINSI;

     |SI #349#6 = "S ";
         #0#18 = #0#18 + #349#22;
     |FINSI;

     |SI #349#6 = "AR";
         #0#10 = #0#10 + (#349#12 + #349#15 + #349#18 + #349#21 + #349#30 + #349#33 + #349#36);
         |SI #349#24 = "-";
             #0#10 = #0#10 - (#349#39 + #349#42 + #349#45 + #349#48 + #349#51 + #349#54 + #349#57);
         |SINO;
             #0#10 = #0#10 + (#349#39 + #349#42 + #349#45 + #349#48 + #349#51 + #349#54 + #349#57);
         |FINSI;
     |FINSI;

     |SI #349#6 = "IR";
         #0#17 = #0#17 + (#349#12 + #349#15 + #349#18 + #349#21 + #349#30 + #349#33 + #349#36);
         |SI #349#24 = "-";
             #0#17 = #0#17 - (#349#39 + #349#42 + #349#45 + #349#48 + #349#51 + #349#54 + #349#57);
         |SINO;
             #0#17 = #0#17 + (#349#39 + #349#42 + #349#45 + #349#48 + #349#51 + #349#54 + #349#57);
         |FINSI;
     |FINSI;

     |SI #349#6 = "ER"; |O #349#6 = "MR";
          |O #349#6 = "HR"; |O #349#6 = "TR";
         #0#15 = #0#15 + #349#22;
         |SI #349#24 = "-";
              #0#15 = #0#15 - #349#27;
         |SINO;
              #0#15 = #0#15 + #349#27;
         |FINSI;
     |FINSI;

     |SI #349#6 = "SR";
         #0#18 = #0#18 + #349#22;
         |SI #349#24 = "-";
              #0#18 = #0#18 - #349#27;
         |SINO;
              #0#18 = #0#18 + #349#27;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc349;
     #349#1;
     ;
     #0#0, #0#1, nDPer349, 349, 00, #0#5, "  ", 0000, 00, "            ";
     #0#0, #0#1, nHPer349, 349, 99, #0#5, "zz", 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Calcu349;
|FIN;

|PROCESO Calcula349;
     |ABRE #4;
     #4#0 = enEmpresa;
     #4#1 = enEjer;
     #4#2 = enPeriodo;
     #4#3 = enModelo;
     #4#4 = enComplem;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;

     |SI #4#22 = "M";
         nDPer349 = enPeriodo;
         nHPer349 = enPeriodo;
     |FINSI;

     |SI #4#22 = "T";
         |SI enPeriodo = 3;    nDPer349 = 1;   nHPer349 = 3;   |FINSI;
         |SI enPeriodo = 6;    nDPer349 = 4;   nHPer349 = 6;   |FINSI;
         |SI enPeriodo = 9;    nDPer349 = 7;   nHPer349 = 9;   |FINSI;
         |SI enPeriodo = 12;   nDPer349 = 10;  nHPer349 = 12;  |FINSI;
     |FINSI;

     #0#10 = 0;
     #0#15 = 0;
     #0#17 = 0;
     #0#18 = 0;
     |BUCLE dsmoc349;
     |PINTA #0#10;
     |PINTA #0#15;
     |PINTA #0#17;
     |PINTA #0#18;
|FPRC;

|PROCESO ClaveA;
     |SI FSalida = 10;
         |ABRE #8;
         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = enPeriodo;
         #8#3 = enModelo;
         #8#4 = enComplem;
         #8#5 = enActividad;
         |LEE 040#8=;
         |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
         |CIERRA #8;

         nTipo         = enTipoEntrada;
         enEmpresa     = #0#0;
         enEjer        = #0#1;
         enPeriodo     = #0#2;
         enComplem     = #0#4;
         enActividad   = #0#5;
         eaTipo349     = "A";
         eaNombreAct   = #8#6;
         eaCaptura     = #8#7;
         eaComunidad   = #8#9;
         eaComunero    = #8#10;
         enTipoEntrada = 1;
         enModelo349   = 310;
         |SUB_EJECUTA_NP "dsmoc349";
         enTipoEntrada = nTipo;
         eaTipo349     = "";
     |FINSI;

     |HAZ Calcula349;
|FPRC;

|PROCESO AntesClaveE; |TIPO 7;
     |SI enEjer ] 2018;
         |MENSA "0000Introducir Entregase: <F2> Clave E, <F3> Claves H/M/T; <F4> Consulta";
     |SINO;
         |MENSA "0000Pulse <F2> para introducir las Entregas.";
     |FINSI;
|FPRC;

|PROCESO PreguntaMHT;
     aClave = "T";
     |PUSHV  1428 1658;
     |BLANCO 1428 1658;
     |CUADRO 1428 1658;
     |ATRI S;
     |PINTA 1529, " CLAVE A INTRODUCIR H/M/T:   ";
     |PINTA 1556, aClave;
     E_sup  = 1;
     E_inf  = "MHTmht";
     aClave = 1556 ? 0; aClave = aClave > ""; |PINTA 1556, aClave;
     |POPV;
|FPRC;

|PROCESO ClaveE;
     nInkey = FSalida;

     |SI nInkey ] 10; |Y nInkey [ 12;

         |SI nInkey ! 10; |Y enEjer < 2018;
             |ERROR;
             |ACABA;
         |FINSI;

         aClave = "E";
         |SI nInkey = 11; |Y enEjer ] 2018;
             |HAZ PreguntaMHT;
         |FINSI;

         |ABRE #8;
         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = enPeriodo;
         #8#3 = enModelo;
         #8#4 = enComplem;
         #8#5 = enActividad;
         |LEE 040#8=;
         |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
         |CIERRA #8;

         nTipo         = enTipoEntrada;
         enEmpresa     = #0#0;
         enEjer        = #0#1;
         enPeriodo     = #0#2;
         enComplem     = #0#4;
         enActividad   = #0#5;
         eaTipo349     = aClave;
         eaNombreAct   = #8#6;
         eaCaptura     = #8#7;
         eaComunidad   = #8#9;
         eaComunero    = #8#10;
         enTipoEntrada = 1;
         |SI nInkey = 12; enTipoEntrada = 14; |FINSI;
         enModelo349   = 310;
         |SUB_EJECUTA_NP "dsmoc349";
         enTipoEntrada = nTipo;
         eaTipo349     = "";
         aClave        = "";
     |FINSI;

     |HAZ Calcula349;
|FPRC;

|PROCESO ClaveI;
     |SI FSalida = 10;
         |ABRE #8;
         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = enPeriodo;
         #8#3 = enModelo;
         #8#4 = enComplem;
         #8#5 = enActividad;
         |LEE 040#8=;
         |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
         |CIERRA #8;

         nTipo         = enTipoEntrada;
         enEmpresa     = #0#0;
         enEjer        = #0#1;
         enPeriodo     = #0#2;
         enComplem     = #0#4;
         enActividad   = #0#5;
         eaTipo349     = "I";
         eaNombreAct   = #8#6;
         eaCaptura     = #8#7;
         eaComunidad   = #8#9;
         eaComunero    = #8#10;
         enTipoEntrada = 1;
         enModelo349   = 310;
         |SUB_EJECUTA_NP "dsmoc349";
         enTipoEntrada = nTipo;
         eaTipo349     = "";
     |FINSI;

     |HAZ Calcula349;
|FPRC;

|PROCESO ClaveS;
     |SI FSalida = 10;
         |ABRE #8;
         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = enPeriodo;
         #8#3 = enModelo;
         #8#4 = enComplem;
         #8#5 = enActividad;
         |LEE 040#8=;
         |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
         |CIERRA #8;

         nTipo         = enTipoEntrada;
         enEmpresa     = #0#0;
         enEjer        = #0#1;
         enPeriodo     = #0#2;
         enComplem     = #0#4;
         enActividad   = #0#5;
         eaTipo349     = "S";
         eaNombreAct   = #8#6;
         eaCaptura     = #8#7;
         eaComunidad   = #8#9;
         eaComunero    = #8#10;
         enTipoEntrada = 1;
         enModelo349   = 310;
         |SUB_EJECUTA_NP "dsmoc349";
         enTipoEntrada = nTipo;
         eaTipo349     = "";
     |FINSI;

     |HAZ Calcula349;
|FPRC;

|| Nuevo Proceso para recoger Volumen Operaciones
|PROCESO Tratadsmom087_s;

  |SI enModelo = 370;
      |ABRE #87;
      |DDEFECTO #87;
      #87#0 = #0#0;
      #87#1 = #0#1;
      #87#2 = #0#2;
      #87#3 = enModelo;
      #87#4 = #0#4;
      #87#5 = #0#5;
      #87#6 = 2;
      #87#7 = 1;
      |LEE 141#87=;
      |SI FSalida ! 0;
          |SI aModo = "B";
              |CIERRA #87;
              |ACABA;
          |FINSI;

          |DDEFECTO #87;
          #87#0 = #0#0;
          #87#1 = #0#1;
          #87#2 = #0#2;
          #87#3 = enModelo;
          #87#4 = #0#4;
          #87#5 = #0#5;
          #87#6 = 2;
          #87#7 = 1;
          |GRABA 020#87b;

          |SI aModo = "C";
              |CIERRA #87;
              |ACABA;
          |FINSI;
      |SINO;
          |SI aModo = "B";
              |BORRA 020#87a;
              |CIERRA #87;
              |ACABA;
          |FINSI;
      |FINSI;

      #87#11 = enProAct;
      #87#36 = enProCom;
      |SI aModo = "C";
          |PDEFECTO #87, 8, 54;
      |FINSI;

      |SI aModo ! "C";
          #87#16 = #0#13;  #87#17 = (#87#16 % #87#11) ! 2;
          #87#12 = #87#16;
          #87#13 = #87#17;
          #87#14 = #87#12  - #87#13;
          #87#8  = #87#12;
          #87#9  = #87#13;
          #87#10 = #87#8  - #87#9;
      |FINSI;
      |GRABA 020#87a;
      |LIBERA #87;
      |CIERRA #87;
  |FINSI;
|FPRC;

|PROCESO AActivosFijos; |TIPO 7;
  |SI enSwProrr ! 2; |Y enEjer > 2010; |Y enModelo = 370; |Y enProAct ! 100;
      aAlfa1 = enProAct;
      aAlfa1 = "    Introduzca Total Iva Deducible, se aplicara el "+ aAlfa1 + "% de prorrata";
      |MENSA aAlfa1;
      || |MENSA "    Introduzca el Total Iva Deducible, luego se aplica Prorrata";
  |FINSI;
|FPRC;

|PROCESO CActivosFijos; |TIPO 0;
  |BLIN 04;
  |SI enSwProrr ! 2; |Y enEjer > 2010; |Y enModelo = 370;
      aModo = "+"; |HAZ Tratadsmom087_s;
  |FINSI;
|FPRC;

|PROCESO AVolumen310; |TIPO 7;
  |SI swerror = 0; |Y #0#8 ! "S";
      |MENSA "    Pulse <F5> Recoger Datos Contabilidad";
  |FINSI;
|FPRC;

|PROCESO LeeLinea310;
     |SI #803#5 = "N"; |ACABA;  |FINSI;
     aAlfa1 = #803#30; |QBF aAlfa1; |SI aAlfa1 = ""; #803#30 = #802#10; |FINSI;
     |SI aMulDep = "S";
         nDepar = #803#30;
         |SI nDepar = 0;  nDepar = 1;   |FINSI;
         |SI nDepar ! enActividad; |ACABA; |FINSI;
     |FINSI;

     #30#0 = #803#3;
     |LEE 040#30=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #30#4 = "N";  |ACABA;  |FINSI;

     |SI #30#34 = 02;
         |SI #30#24 = 10; |O #30#78 = 10; |O #30#79 = 10; |O #30#80 = 10; |O #30#81 = 10;
            |O #30#82 = 10; |O #30#83 = 10; |O #30#84 = 10; |O #30#85 = 10;
              |O #30#86 = 10; |O #30#87 = 10; |O #30#88 = 10; |O #30#89 = 10;
                |O #30#94 = 10; |O #30#95 = 10; |O #30#100 = 10; |O #30#101 = 10;
                 nCtVolumen = nCtVolumen + #803#6;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE caivalin310;
     #803#1;
     ;
     #802#0, #802#1, 01;
     #802#0, #802#1, 99;
     ;
     NULL, LeeLinea310;
|FIN;

|PROCESO LeeCabecera310;
     |SI aMulDep ! "S";
         nDepar = #802#10;
         |SI nDepar = 0;  nDepar = 1;   |FINSI;
         |SI nDepar ! enActividad; |ACABA; |FINSI;
     |FINSI;

     |BUCLE caivalin310;
|FPRC;

|DEFBUCLE camaniva;
     #802#1;
     5;
     00, 0000000000, nDPeriodo;
     99, 9999999999, nHPeriodo;
     e;
     NULL, LeeCabecera310;
|FIN;

|PROCESO DVolumen310; |TIPO 0;
 |C_M #0Campo, 0, aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;

 |BLIN 04;
 |SI FSalida = 13; |Y swerror = 0; |Y #0#8 ! "S";
     nCtVolumen = 0;
     |ABRE #30;
     |BUCLE camaniva;
     |HAZ RecogeAnterior;
     |CIERRA #30;
     #0Campo = nCtVolumen;
     |PINTA #0Campo;
     aAlfa1 = "    Importe Volumen de Operaciones del Trimestre recogidas de Contabilidad: " + nCtVolumen + " euros";
     |MENAV aAlfa1;
 |FINSI;
|FPRC;

|PROCESO RecogeAnterior;
     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/" + eaNomDef + ".mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + eaNomDef;
         |MENAV aAlfa;
         |ERROR;
     |FINSI;
     nHasta  = enPeriodo - 3;
     nAntes1 = 0;
     |ABRE #100;
     |PARA nTrim = 3;  |SI nTrim [ nHasta;  |HACIENDO nTrim = nTrim + 3;
           nComplem = -1;
           #100#0 = #0#0;
           #100#1 = #0#1;
           #100#2 = nTrim;
           #100#3 = #0#3;
           #100#4 = 99;
           #100#5 = 0;
           |LEE 041#100];
           |SI FSalida = 0;
               |LEE 040#100a;
           |SINO;
               |LEE 040#100u;
           |FINSI;
           |SI FSalida = 0; |Y #100#0 = #0#0; |Y #100#1 = #0#1;
               |Y #100#2 = nTrim; |Y #100#3 = #0#3;
                  nComplem = #100#4;
           |FINSI;
           |SI nComplem ! -1;
               #100#0 = #0#0;
               #100#1 = #0#1;
               #100#2 = nTrim;
               #100#3 = #0#3;
               #100#4 = nComplem;
               #100#5 = #0#5;
               |LEE 101#100=;
               |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;

               nAntes1 = nAntes1 + #100#19;
           |FINSI;
     |SIGUE;
     |CIERRA #100;
     nCtVolumen = (nCtVolumen - nAntes1) ! EURODBMOD;

     |DESCARGA_DEF #espejo1@;
|FPRC;

|PROCESO PathContab310; || Proceso  para Recoger los Datos Contables
  enSwOpPar  = 0;
  swerror    =  0;
  enPerConta = -1;      || No sabemos el Periodo Contable
  enSwSinMen = 1;
  |HAZ SituaEmpresa;
  |SI swerror = 1;
      || ... |MENAV "    Error. No existen Datos Contables de esta Empresa ";
      |ACABA;
  |FINSI;
  |HAZ EnConversor;
  |SI enPeriodo = 3;  nDPeriodo = 1; nHPeriodo = 3;  |FINSI;
  |SI enPeriodo = 6;  nDPeriodo = 1; nHPeriodo = 6;  |FINSI;
  |SI enPeriodo = 9;  nDPeriodo = 1; nHPeriodo = 9;  |FINSI;
  |SI enPeriodo = 12; nDPeriodo = 1; nHPeriodo = 12; |FINSI;

  |PATH_DAT #802 aPathConta;
  |PATH_DAT #803 aPathConta;
  |PATH_DAT #804 aPathConta;
  |ABRE #804;
  |LEE 040#804p;
  |SI FSalida ! 0;  |DDEFECTO #804;  |FINSI;
  |CIERRA #804;
  aMulDep = #804#132;
|FPRC;

|PROCESO AltaModelo;
     nSwEsta   = 0;
     enEntrada = 1;

     |ABRE #0;
     #0#0 = enEmpresa;
     #0#1 = enEjer;
     #0#2 = enPeriodo;
     #0#3 = enModelo;
     #0#4 = enComplem;
     #0#5 = enActividad;
     |LEE 101#0=;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         nSwEsta = 1;

         |GRABA 020#0b;
     |FINSI;

     |ABRE #114;
     #114#0 = enEmpresa;
     #114#1 = enActividad;
     |LEE 040#114=;
     |SI FSalida ! 0;  |DDEFECTO #114;  |FINSI;
     |CIERRA #114;

     #0#6  = #114#3;
     #0#7  = #114#4;
     #0#8  = "N";

     |SI #114#11 = 100;
         #0#8 = "S";
     |FINSI;

     |SI #114#9 = 6;  |O #114#9 = 7;  |O #114#9 = 11;  |O #114#9 = 12;
         #0#8 = "S";
     |FINSI;

     |SI #0#4 > 0; |Y #0#1 ] 2014;
         |ABRE #17;
         #17#0 = #0#0;
         #17#1 = #0#1;
         #17#2 = 0;
         #17#3 = #0#5;
         |LEE 040#17=;
         |SI FSalida = 0;
             enModi310 = 1;
         |FINSI;
         |CIERRA #17;
     |FINSI;

     |C_M #0#9, 1, "S";
     |SI enModi310 = 1;  |C_M #0#9, 1, "N"; |FINSI;

     |HAZ PathContab310;

     |PINPA #0#0;
     |PINDA #0#0;
     |HAZ PintaDatos;
     |ENDATOS #1#0;
     |SI FSalida = 0;
         |HAZ ChequeaGraba;

         |ABRE #8;
         #8#0 = enEmpresa;
         #8#1 = enEjer;
         #8#2 = enPeriodo;
         #8#3 = enModelo;
         #8#4 = enComplem;
         #8#5 = enActividad;
         |LEE 101#8=;
         |SI FSalida = 0;
             #8#11 = "SIN DATOS ";
             |GRABA 020#8a;
         |FINSI;
         |LIBERA #8;
         |CIERRA #8;
     |SINO;
         |SI nSwEsta = 1;
             enEntrada = 0;
             |BORRA 020#0a;
         |FINSI;
     |FINSI;
     |LIBERA #0;
     |CIERRA #0;

     |HAZ GrabaRegistro0;

     |SI enSwPartido = 1;
         enSwOpPar   = 1;
         |HAZ FinalPartido;
     |FINSI;
|FPRC;

|PROCESO dsmoc311_1;
     |SI #1#13 = 0; |Y #1#14 = 0; |Y #1#15 = 0;
        |Y #1#16 = 0; |Y #1#17 = 0; |Y #1#18 = 0;
           |Y #1#19 = 0; |Y #1#20 = 0; |Y #1#21 = 0;
              |Y #1#22 = 0;

         #1#18 = #1#8;
         #1#19 = #1#9;
         #1#20 = #1#10;
         #1#21 = #1#11;
         #1#22 = #1#12;
     |FINSI;
     #1#23 = 1;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE dsmoc311_1;
     #1#1;
     23;
     00001, 2010, 12, enModelo, 00, 00, 001, 0;
     99999, 2010, 12, enModelo, 99, 99, 999, 0;
     be;
     NULL, dsmoc311_1;
|FIN;

|PROCESO CtraVersion310;
    |BUCLE dsmoc311_1;
|FPRC;

|PROCESO FichPatron;
     |ABRE #dsmom133;
     #dsmom133#0 = 011;
     #dsmom133#1 = 2020;
     |LEE 000#dsmom133.=;
     |SI FSalida ! 0;
         |CIERRA #dsmom133;

         eaExtension = "mod";
         eaPrograma  = "dsmom033";
         |SUB_EJECUTA_NP ":basica/dspatron";

         eaExtension = "mod";
         eaPrograma  = "dsmom133";
         |SUB_EJECUTA_NP ":basica/dspatron";
     |FINSI;
     |CIERRA #dsmom133;
|FPRC;

|PROGRAMA;
     eaNoVisu = "";
     eaNomDef = "dsmoc310";

     |SI enEjer = 2010;
         |HAZ CtraVersion310;
     |FINSI;

     |HAZ FichPatron;
|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
         |HAZ SacaPantallas;
         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              ||Baja del Modelo
         |BUCLE dsmociva310;
         |BUCLE dsmom087310;
         |BUCLE dsmoc310B;
         |HAZ GrabaRegistro0;
         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo desde Modulo////////

     |SI enTipoEntrada = 97;              ||Baja del Modelo
         |BUCLE dsmoc310B;
         |HAZ GrabaRegistro0;
         |ACABA;
     |FINSI;

|| \\\\\\ Alta o Modificacion del Modelo ////////
     |SI enModelo = 370;   ||solo para el Modelo 370
         |HAZ LeeCtrlProrr;
         enProAct = 100; enProCom = 100;
         |SI enEjer > 2010; |Y enSwProrr ! 2;
             |HAZ eNuevoPro;
         |FINSI;
     |FINSI;

     |SI enTipoEntrada = 1;              || Alta del Modelo
         |CABEZA "Modelo Trabajo 310";
         |HAZ AltaModelo;
     |FINSI;

|| \\\\\\ Grabacion del Modelo desde el Exterior

     |SI enTipoEntrada = 98;  |O enTipoEntrada = 91;
         |ABRE #0;
         |HAZ GrabaRegistro0;
         |CIERRA #0;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #0;
         #0#0 = enEmpresa;
         #0#1 = enEjer;
         #0#2 = enPeriodo;
         #0#3 = enModelo;
         #0#4 = enComplem;
         #0#5 = enActividad;
         |LEE 040#0=;
         |SI FSalida ! 0;  enExistencia = 1;  |FINSI;
         |CIERRA #0;
     |FINSI;
|FPRO;
