|FICHEROS;
     dsmo1347 #1;
     dsmo2347 #2,MANTE;
     dsmo3347 #3,MANTE;

     :/basica/def/agicen17 #117;
     :/basica/def/agicen14 #114;

     &regisnif@ #709;
     reflejo@ #33;
|FIN;

|VARIABLES;
     aPathModelo  = "";
     aDef         = "";
     aAlfa        = "";
     nForma       = 0;
     nCampo0      = 0;
     nCampo1      = 0;
     nCampo2      = 0;
     nCampo3      = 0;
     nCampo4      = 0;
     nCampo5      = 0;
     aCampo6      = "";
     nCampo7      = 0;
     nModo        = 0;
     &enEjerCob   = 0;
     &enImpoCob   = 0;
     &eaClCobro   = "";
     &eaNifCobro  = "";
     &eaSeguro    = "";
     &eaArrenda   = "";
     &eaOp1       = "";
     &eaOp2       = "";
     &eaOp5       = "";
     &enLinInm    = 0;
     &enDesModelo = 0;
     &eSwDniH     = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO PintaClave2;
     |ATRI S;
     |PINTA 0839, #1#16;   |PINTA 0845, #1#17;
     |ATRI s;
|FPRC;

|PROCESO Tipo2mo3347;  |TIPO 2;
     #1#16 = #1#16 +. 1;
     #1#17 = #1#17 +. #3#10;

     |HAZ PintaClave2;
|FPRC;

|RUTINA ClaveBaja117;
     #117#0 = #3#0;
     #117#1 = 01;
     #117#2 = 01;
|FRUT;

|RUTINA ClaveAlta117;
     #117#0 = #3#0;
     #117#1 = 99;
     #117#2 = 99;
|FRUT;

|RUTINA ClaveBaja114;
     #114#0 = #3#0;
     #114#1 = 01;
|FRUT;

|RUTINA ClaveAlta114;
     #114#0 = #3#0;
     #114#1 = 99;
|FRUT;

|RUTINA ClaveBaja331;
     #33#0 = #1#0;
     #33#1 = #1#1;
     #33#2 = #1#2;
     #33#3 = #1#3;
     #33#4 = #1#4;
     #33#7 = "            ";
|FRUT;

|RUTINA ClaveAlta331;
     #33#0 = #1#0;
     #33#1 = #1#1;
     #33#2 = #1#2;
     #33#3 = #1#3;
     #33#4 = #1#4;
     #33#7 = "zzzzzzzzzzzz";
|FRUT;

|RUTINA ClaveBaja332;
     #33#0 = #1#0;
     #33#1 = #1#1;
     #33#2 = #1#2;
     #33#3 = #1#3;
     #33#4 = #1#4;
     #33#8 = "                                        ";
|FRUT;

|RUTINA ClaveAlta332;
     #33#0 = #1#0;
     #33#1 = #1#1;
     #33#2 = #1#2;
     #33#3 = #1#3;
     #33#4 = #1#4;
     #33#8 = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
|FRUT;

|PROCESO MiraDnimo3347;  |TIPO 6;
     nModo    = (FEntrada / 100) ! 0;
     eaVarDni  = #3Campo;
     enCalcCif = 0;
     |HAZ CalculameDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #3Campo ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #3Campo = eaVarDni;  |PINTA #3Campo;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |QBF eaVarDni; |QBF eaCliNif;
     |SI eaVarDni = eaCliNif;
         |CONFI "    NIntroducido NIF de la Empresa Actual. Continuar";
         |SI FSalida ! 0;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PonDatosNif3;  |TIPO 7;
     eaCodNif  = #3#7;
     |HAZ LeeNifs;

     #3#8 = #709#1;   |PINTA #3#8;
|FPRC;

|PROCESO Tipo11mo3347;  |TIPO 11;
     |SI FSalida = 10;
         |ABRE #117;
         #117#0 = #3#0;
         #117#1 = 0;
         #117#2 = 0;
         |LEE 040#117];
         |SI FSalida = 0;  |Y #117#0 = #3#0;
             |C_M #117#2, 1, "S";
             |CONSULTA_F_CLAVE #1#117, ClaveBaja117, ClaveAlta117;

             #3#5 = #117#1;   |PINTA #3#5;
             #3#6 = #117#2;   |PINTA #3#6;
             #3#7 = #117#4;   |PINTA #3#7;
             #3#8 = #117#5;   |PINTA #3#8;
             #3#9 = #117#3;   |PINTA #3#9;
         |SINO;
             |MENAV "     No existen Referencias Catastrales en la Empresa.";
         |FINSI;
         |CIERRA #117;
         |ERROR;
     |FINSI;

     |SI FSalida = 11; |Y Campo = 5;
         |ABRE #114;
         #114#0 = #3#0;
         #114#1 = 0;
         |LEE 040#114];
         |SI FSalida = 0;  |Y #114#0 = #3#0;
             |CONSULTA_F_CLAVE #1#114, ClaveBaja114, ClaveAlta114;

             #3#5 = #114#1;   |PINTA #3#5;
         |SINO;
             |MENAV "     No existen Actividades en la Empresa.";
         |FINSI;
         |CIERRA #114;
         |ERROR;
     |FINSI;

     |SI FSalida = 12; |Y Campo = 5;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmo3347.mas";
         |CARGA_DEF aDef, reflejo@;
         |SI FSalida ! 0;
             aAlfa = "     Error en cargar el Def dsmo3347.mas";
             |MENAV aAlfa;
             |ERROR;
         |FINSI;

         |ABRE #33;
         |CONSULTA_F_CLAVE #2#33, ClaveBaja331, ClaveAlta331;
         |SI FSalida = 0;
             #3#0 = #33#0;
             #3#1 = #33#1;
             #3#2 = #33#2;
             #3#3 = #33#3;
             #3#4 = #33#4;
             #3#5 = #33#5;
             #3#6 = #33#6;
             #3#7 = #33#7;
             |LEE 000#3=;
         |FINSI;
         |CIERRA #33;

         |DESCARGA_DEF #reflejo@;

         |PTEC 809;
         |PTEC 808;
         |PONCONTROL  23, "SI";
     |FINSI;

     |SI FSalida = 13; |Y Campo = 5;
         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmo3347.mas";
         |CARGA_DEF aDef, reflejo@;
         |SI FSalida ! 0;
             aAlfa = "     Error en cargar el Def dsmo3347.mas";
             |MENAV aAlfa;
             |ERROR;
         |FINSI;

         |PUSHV 0501 2380;
         |ATRI P;
         |PINTA 0703, "MODO CONSULTA  <ORDENADO POR NOMBRE>";
         |ATRI p;
         |ENTLINEAL #3#33, -6, 4, 22, 0, ClaveBaja332, ClaveAlta332;
         |POPV;

         |DESCARGA_DEF #reflejo@;

         |ERROR;
     |FINSI;

     |SI FSalida = 14; |Y Campo = 5;
         |SI #3#1 > 2010;
             |HAZ PanTrimes;
         |SINO;
             |PUSHV 1325 1680;
             |BLANCO 1325 1580;
             |CUADRO 1325 1580;

             |PINTA 1426, "Percibido en metalico ...................:            ";

             |PINTA 1469, #3#12;
         |FINSI;
         |PAUSA;

         |POPV;

         |ERROR;
     |FINSI;

     |SI FSalida = 15;
         enEmpresa   = #3#0;
         enActividad = #3#5;
         enLinInm    = #3#6;
         enDesModelo = 1;
         |SUB_EJECUTA ":basica/agicen17";
         enDesModelo = 0;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Actividad;
     |ABRE #114;
     #114#0 = #3#0;
     #114#1 = #3#5;
     |LEE 040#114=;
     |SI FSalida ! 0;
         |MENAV "     No existe la Actividad en la Empresa.";
         |ERROR;
     |FINSI;
     |CIERRA #114;
|FPRC;

|PROCESO PonDatos;  |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |ABRE #117;
     #117#0 = #3#0;
     #117#1 = #3#5;
     #117#2 = #3#6;
     |LEE 040#117=;
     |SI FSalida = 0;
         |SI nModo = 1;
             #3#7 = #117#4;   |PINTA #3#7;
             #3#8 = #117#5;   |PINTA #3#8;
             #3#9 = #117#3;   |PINTA #3#9;
         |FINSI;
     |SINO;
         |CONFI "     No existe la Referencia Catastral en la Actividad. Desea darla de Alta : ";
         |SI FSalida = 0;
             enEmpresa   = #3#0;
             enActividad = #3#5;
             enLinInm    = 0;
             |SUB_EJECUTA ":basica/agicen17";
         |FINSI;
         |ERROR;
     |FINSI;
     |CIERRA #117;
|FPRC;

|PROCESO Tipo7C10;  |TIPO 7;
     nModo = (FEntrada / 100) ! 0;

     |SI nModo = 1;
         |ABRE #117;
         #117#0 = #3#0;
         #117#1 = #3#5;
         #117#2 = #3#6;
         |LEE 040#117=;
         |SI FSalida = 0;
             #3#7 = #117#4;   |PINTA #3#7;
             #3#8 = #117#5;   |PINTA #3#8;
             #3#9 = #117#3;   |PINTA #3#9;
         |FINSI;
         |CIERRA #117;
     |FINSI;
|FPRC;

|PROCESO PanTrimes;
          |PUSHV 1236 2180;
          |BLANCO 1236 2174;
          |CUADRO 1236 2174;

          |C_V #3#17,1,"N";
          |PINTA 1338, "Importe:                           ";
          |PINTA 1438, "1§ Trimestre .........:            ";
          |PINTA 1538, "2§ Trimestre .........:            ";
          |PINTA 1638, "3§ Trimestre .........:            ";
          |PINTA 1738, "4§ Trimestre .........:            ";
          |SI #3#1 ] 2014;
              |C_V #3#17,1,"S";
              |PINTA 1838, "Op. IVA de Caja ..:                ";
              |PINTA 1858, #3#17;
              |PINTA 1862, #3#18;
          |FINSI;
          |PINTA 2038, "Percibido en metalico :            ";

          |PINTA 1362, #3#10;
          |PINTA 1462, #3#13;
          |PINTA 1562, #3#14;
          |PINTA 1662, #3#15;
          |PINTA 1762, #3#16;
          |PINTA 2062, #3#12;
|FPRC;

|PROCESO Totales;
         #3#13 = nCampo1;
         #3#14 = nCampo2;
         #3#15 = nCampo3;
         #3#16 = nCampo4;
         |SI eSwDniH = 0;
             nCampo0 = #3#13 + #3#14 + #3#15 + #3#16;
         |FINSI;
         #3#10 = nCampo0;
         |PINTA 1362, #3#10;
         #3#12 = nCampo5;
         #3#17 = aCampo6;
         #3#18 = nCampo7;
|FPRC;

|PROCESO AntesCobro;
    enEjerCob  = enEjer;
    eaClCobro  = "B";
    eaNifCobro = #3#7;
    eaSeguro   = "N";
    eaArrenda  = "S";
    eaOp1      = "N";
    eaOp2      = "N";
    eaOp5      = #3#17;
    |HAZ eImporteCobro;
    enImpoCob = enImpoCob - #3#12;
|FPRC;

|PROCESO DespuesCobro;
    enImpoCob = enImpoCob + #3#12;
    enEjerCob  = enEjer;
    eaClCobro  = "B";
    eaNifCobro = #3#7;
    eaSeguro   = "N";
    eaArrenda  = "S";
    eaOp1      = "N";
    eaOp2      = "N";
    eaOp5      = #3#17;
    |HAZ eActCobro;
|FPRC;

|PROCESO Tipo0C10; |TIPO 0;
     |SI #3#1 [ 2010;
          |PUSHV 1325 1680;
          |BLANCO 1325 1580;
          |CUADRO 1325 1580;

          |PINTA 1426, "Percibido en metalico ...................:            ";

          E_inf = "-999999999.?EURO";
          E_sup = "9999999999";

          nCampo1  = #3#12;   |PINTA 1469, #3#12;

          nCampo1 = 1469 ? 1;
          #3#12 = nCampo1;
     |SINO;
         |HAZ PanTrimes;

         |SI eSwDniH = 1;
             #3#13 = 0;
             #3#14 = 0;
             #3#15 = 0;
             #3#16 = 0;
         |FINSI;
         nCampo0 = #3#10;
         nCampo1 = #3#13; nCampo2 = #3#14;
         nCampo3 = #3#15; nCampo4 = #3#16;
         nCampo5 = #3#12; aCampo6 = #3#17;
         nCampo7 = #3#18;

         E_inf = "-999999999.?EURO";
         E_sup = "9999999999";

         |ET nCampo0_3;
         |SI eSwDniH = 1;
             E_inf = "-999999999.?EURO";
             E_sup = "9999999999";
             nCampo0 = 1362 ? 1;
             |SI FSalida = 1;  |VETE Abajo_3;    |FINSI;
             |SI FSalida = 7;  |VETE Abajo_3;    |FINSI;
             |HAZ Totales;
             |VETE aCampo6_3;
         |FINSI;

         |ET nCampo1_3;
             E_inf = "-999999999.?EURO";
             E_sup = "9999999999";
             nCampo1 = 1462 ? 1;
             |SI FSalida = 1;  |VETE Abajo_3;    |FINSI;
             |SI FSalida = 7;  |VETE Abajo_3;    |FINSI;
             |HAZ Totales;

         |ET nCampo2_3;
             E_inf = "-999999999.?EURO";
             E_sup = "9999999999";
             nCampo2 = 1562 ? 1;
             |SI FSalida = 1;  |VETE Abajo_3;    |FINSI;
             |SI FSalida = 2;  |VETE nCampo1_3;  |FINSI;
             |SI FSalida = 7;  |VETE Abajo_3;    |FINSI;
             |HAZ Totales;

         |ET nCampo3_3;
             E_inf = "-999999999.?EURO";
             E_sup = "9999999999";
             nCampo3 = 1662 ? 1;
             |SI FSalida = 1;  |VETE Abajo_3;    |FINSI;
             |SI FSalida = 2;  |VETE nCampo2_3;  |FINSI;
             |SI FSalida = 7;  |VETE Abajo_3;    |FINSI;
             |HAZ Totales;

         |ET nCampo4_3;
             E_inf = "-999999999.?EURO";
             E_sup = "9999999999";
             nCampo4 = 1762 ? 1;
             |SI FSalida = 1;  |VETE Abajo_3;    |FINSI;
             |SI FSalida = 2;  |VETE nCampo3_3;  |FINSI;
             |SI FSalida = 7;  |VETE Abajo_3;    |FINSI;
             |HAZ Totales;

         |ET aCampo6_3;
         |SI #3#1 ] 2014;
             E_inf = "SNsn";
             E_sup = 1;
             aCampo6 = 1858 ? 1; aCampo6 = aCampo6 > " ";
             #3#17 = aCampo6;
             |PINTA 1858, #3#17;
             |SI FSalida = 1;  |VETE Abajo_3;    |FINSI;
             |SI FSalida = 2;
                 |SI eSwDniH = 1; |VETE nCampo0_3; |FINSI;
                 |SI eSwDniH = 0; |VETE nCampo4_3; |FINSI;
             |FINSI;
             |SI FSalida = 7;  |VETE Abajo_3;    |FINSI;

             |SI aCampo6 = "N";
                 nCampo7 = 0; #3#18 = 0; |PINTA 1862, #3#18;
            |SINO;
                 E_inf = "-999999999.?EURO";
                 E_sup = "9999999999";
                 nCampo7 = 1862 ? 1;
                 |SI FSalida = 10;
                     nCampo7 = #3#10;
                     #3#18 = nCampo7;
                     |PINTA 1862, #3#18;
                 |FINSI;
                 |SI FSalida = 1;  |VETE Abajo_3;    |FINSI;
                 |SI FSalida = 2;  |VETE aCampo6_3;  |FINSI;
                 |SI FSalida = 7;  |VETE Abajo_3;    |FINSI;
             |FINSI;
             |HAZ Totales;
         |FINSI;

         |ET nCampo5_3;
             |HAZ AntesCobro;

             E_inf = "-999999999.?EURO";
             E_sup = "9999999999";
             nCampo5 = 2062 ? 1;
             |SI FSalida = 2;
                 |SI #3#1 < 2014;
                     |SI eSwDniH = 1; |VETE nCampo0_3; |FINSI;
                     |SI eSwDniH = 0; |VETE nCampo4_3; |FINSI;
                 |FINSI;
                 |SI #3#1 ] 2014; |VETE aCampo6_3;  |FINSI;
             |FINSI;

             |HAZ Totales;
             |HAZ DespuesCobro;

         |ET Abajo_3;
             |HAZ Totales;

     |FINSI;

     |POPV;
|FPRC;
