|FICHEROS;
   dsmoradj #0;
   dsmoradl #1;

   dsm210dp #10;
   dsm210tr #11;
   dsm210hi #12;
   dsm210h3 #13;

   dsm211hi #20;
   dsm213hi #30;

   dsmorrem #50;
   dsmorrel #51;

   dsmow350 #100;
   dsmow351 #101;
   RefLin@  #102;
|FIN;

|VARIABLES;
   aAlfa    = "";
   aAlfa1   = "";
   Comodin  = "";
   aMarca   = "";

   nCalc    = 0;
   nCalc1   = 0;
   nCalc2   = 0;
   nCalc3   = 0;
   nCalc5   = 0;
   nCalc7   = 0;
   nCalc8   = 0;
   nCalc9   = 0;

   nBotonBaja = 0;
   nBotonObs  = 0;
   nBotonComp = 0;
   nBotonF1   = 0;
   nBotonF2   = 0;
   nBotonF3   = 0;
   nBotonF4   = 0;
   nBotonF5   = 0;
   nBotonF6   = 0;

   nRemesa  = 0;
   Linea    = 0;
   nLinea   = 0;
   nLinRem  = 0;
   FSestado = 0;

   nRefer = 0;
   nCliente   = 0;
   nEjercicio = 0;
   nPeriodo   = 0;

   nVent      = 0;
   nPant      = 0;
   nPant0     = 0;
   nGrid0     = 0;
   nGrid1     = 0;

   nRango     = 0;
   nPos1      = 0;
   nPos2      = 0;

   aEsc1      = "";
   aEsc2      = "";
   aRetu      = "";
   aTecla     = "";

   nRefLin    = 0;

   nAntSel    = 0;
   nSelec     = 0;
{-1}aVent      = "";
    aVent1     = 0;
    aVent2     = 0;
    aVent3     = 0;
    aVent4     = 0;
    aVent5     = "";
|FIN;

|PROCESO Final;
   |PTEC 801;
|FPRC;

|PROCESO Tipo12Adj; |TIPO 12;
|FPRC;

|PROCESO Modelo210;
   |SI nCliente ! #dsm210h3#0; |O nEjercicio ! #dsm210h3#1; |O nPeriodo ! #dsm210h3#2;
      nRefer = 0;
      nCliente   = #dsm210h3#0;
      nEjercicio = #dsm210h3#1;
      nPeriodo   = #dsm210h3#2;
   |FINSI;

   #dsm210hi#0 = #dsm210h3#0;
   #dsm210hi#1 = #dsm210h3#1;
   #dsm210hi#2 = #dsm210h3#2;
   #dsm210hi#3 = #dsm210h3#3;
   #dsm210hi#4 = #dsm210h3#4;
   |LEE 000#dsm210hi.=;
   |SI FSalida ! 0; |DDEFECTO #dsm210hi; |FINSI;

   #dsm210dp#0 = #dsm210h3#0;
   |LEE 000#dsm210dp.=;
   |SI FSalida ! 0; |DDEFECTO #dsm210dp; |FINSI;

   nRefer = nRefer + 1;
   |DDEFECTO #dsmow350;
   #dsmow350#0 = #dsm210h3#0;
   #dsmow350#1 = #dsm210h3#1;
   #dsmow350#2 = #dsm210h3#2;
   #dsmow350#3 = #dsm210h3#3;
   #dsmow350#4 = nRefer;
   #dsmow350#5 = #dsm210h3#4;
   #dsmow350#6 = #dsm210h3#5;
   #dsmow350#7 = #dsm210h3#6;
   #dsmow350#8 = #dsm210h3#7;
   #dsmow350#9 = #dsm210h3#8;
   #dsmow350#12 = #dsm210hi#5;
   #dsmow350#14 = 210;
   #dsmow350#15 = "0,0,0;206,245,246";
   #dsmow350#17 = #dsm210hi#11;
   #dsmow350#18 = #dsm210h3#7;
   #dsmow350#19 = #dsm210dp#1;
   #dsmow350#20 = #dsm210h3#35;
   #dsmow350#21 = #dsm210h3#36;

   |SI #dsmow350#17 < "01.01.0020";
      aAlfa = #dsmow350#17; |QBF aAlfa;
      aAlfa1 = aAlfa % -104; nCalc = aAlfa1; nCalc = nCalc + 2000;
      aAlfa1 = nCalc; aAlfa = (aAlfa % 106) + aAlfa1;
      #dsmow350#17 = aAlfa;
   |FINSI;
   |SI #dsmow350#18 < "01.01.0020";
      aAlfa = #dsmow350#18; |QBF aAlfa;
      aAlfa1 = aAlfa % -104; nCalc = aAlfa1; nCalc = nCalc + 2000;
      aAlfa1 = nCalc; aAlfa = (aAlfa % 106) + aAlfa1;
      #dsmow350#18 = aAlfa;
   |FINSI;

   #dsm210tr#0 = #dsm210h3#4;
   #dsm210tr#6 = #dsm210h3#1;
   |LEE 040#dsm210tr.=;
   |SI FSalida ! 0; |DDEFECTO #dsm210tr; |FINSI;

   |SI #dsm210tr#4 = "I"; |O #dsm210tr#4 = "G"; |O #dsm210tr#4 = "H";
      nCalc3 = #dsm210h3#10 % #dsm210h3#39;
      nCalc7 = 0;
   |FINSI;

   |SI #dsm210tr#4 = "R";
      nCalc3 = #dsm210h3#10 % #dsm210h3#39;
      nCalc7 = #dsm210h3#11 % #dsm210h3#42;
   |FINSI;

   |SI nCalc3 < 0; nCalc3 = 0; |FINSI;
   nCalc5 = nCalc3 - #dsm210h3#30;
   |SI nCalc7 < nCalc5; |Y nCalc7 > 0;
      nCalc8 = nCalc5 - nCalc7;
   |SINO;
      nCalc8 = 0;
   |FINSI;
   nCalc9 = nCalc5 - nCalc8;
   #dsmow350#13 = nCalc9 - #dsm210h3#31 + #dsm210h3#34;

   #dsmow350#13 = #dsm210h3#38;
   |GRABA 020#dsmow350.n;
|FPRC;

|DEFBUCLE Modelo210;
#dsm210h3#1;
37;
00000, 0000, 00, 00, 00, "               ", 000, "01.01.0000", 000, 00000;
99999, 9999, 12, 99, 99, "zzzzzzzzzzzzzzz", 999, "31.12.9999", 999, 00000;
;
NULL, Modelo210;
|FIN;

|PROCESO Modelo211;
   nRefer = nRefer + 1;

   #dsm210dp#0 = #dsm211hi#0;
   |LEE 000#dsm210dp.=;
   |SI FSalida ! 0; |DDEFECTO #dsm210dp; |FINSI;

   |DDEFECTO #dsmow350;
   #dsmow350#0 = #dsm211hi#0;
   #dsmow350#1 = #dsm211hi#1;
   #dsmow350#2 = 0;
   #dsmow350#3 = #dsm211hi#2;
   #dsmow350#4 = nRefer;
   #dsmow350#10 = #dsm211hi#3;
   #dsmow350#12 = #dsm211hi#4;
   #dsmow350#14 = 211;
   #dsmow350#15 = "0,0,0;232,206,246";
   #dsmow350#17 = #dsm211hi#5;  ||!!!!!!!!
   #dsmow350#18 = #dsm211hi#5;
   #dsmow350#19 = #dsm210dp#1;
   #dsmow350#20 = 100;
   #dsmow350#21 = 0;

   |SI #dsmow350#17 < "01.01.0020";
      aAlfa = #dsmow350#17; |QBF aAlfa;
      aAlfa1 = aAlfa % -104; nCalc = aAlfa1; nCalc = nCalc + 2000;
      aAlfa1 = nCalc; aAlfa = (aAlfa % 106) + aAlfa1;
      #dsmow350#17 = aAlfa;
   |FINSI;
   |SI #dsmow350#18 < "01.01.0020";
      aAlfa = #dsmow350#18; |QBF aAlfa;
      aAlfa1 = aAlfa % -104; nCalc = aAlfa1; nCalc = nCalc + 2000;
      aAlfa1 = nCalc; aAlfa = (aAlfa % 106) + aAlfa1;
      #dsmow350#18 = aAlfa;
   |FINSI;
   #dsmow350#13 = #dsm211hi#62;
   |GRABA 020#dsmow350.n;
|FPRC;

|DEFBUCLE Modelo211;
#dsm211hi#1;
72;
00000, 0000, 00, 000, 00000;
99999, 9999, 99, 999, 00000;
;
NULL, Modelo211;
|FIN;

|PROCESO Modelo213;
   nRefer = nRefer + 1;

   #dsm210dp#0 = #dsm213hi#0;
   |LEE 000#dsm210dp.=;
   |SI FSalida ! 0; |DDEFECTO #dsm210dp; |FINSI;

   |DDEFECTO #dsmow350;
   #dsmow350#0 = #dsm213hi#0;
   #dsmow350#1 = #dsm213hi#1;
   #dsmow350#2 = #dsm213hi#2;
   #dsmow350#3 = #dsm213hi#4;
   #dsmow350#4 = nRefer;
   #dsmow350#11 = #dsm213hi#3;
   aAlfa = #dsm213hi#5; |QBF aAlfa; aAlfa = aAlfa + "/" + #dsm213hi#6;
   #dsmow350#12 = aAlfa;
   #dsmow350#13 = #dsm213hi#16;
   #dsmow350#14 = 213;
   #dsmow350#15 = "0,0,0;245,233,175";
   #dsmow350#17 = #dsm213hi#27;
   #dsmow350#18 = #dsm213hi#27;
   #dsmow350#19 = #dsm210dp#1;
   #dsmow350#20 = 100;
   #dsmow350#21 = 0;
   |GRABA 020#dsmow350.n;
|FPRC;

|DEFBUCLE Modelo213;
#dsm213hi#1;
29;
00000, 0000, 00, 00000, 00, 00000;
99999, 9999, 12, 99999, 99, 00000;
;
NULL, Modelo213;
|FIN;

|PROCESO Marca;
   |SI aMarca = "*";
      |SI #dsmow350#16 = " ";
         nSelec = nSelec + 1;
         ||#dsmow350#15 = "103,131,224;240,253,246";
         #dsmow350#15 = "255,255,255;8,119,80";
         #dsmow350#16 = "*";
         |GRABA 020#dsmow350.a;
      |FINSI;
   |SINO;
      |SI #dsmow350#16 = "*";
         nSelec = nSelec - 1;
         |SI #dsmow350#14 = 210; #dsmow350#15 = "0,0,0;206,245,246"; |FINSI;
         |SI #dsmow350#14 = 211; #dsmow350#15 = "0,0,0;232,206,246"; |FINSI;
         |SI #dsmow350#14 = 213; #dsmow350#15 = "0,0,0;245,233,175"; |FINSI;
         #dsmow350#16 = " ";
         |GRABA 020#dsmow350.a;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Marca;
#dsmow350#1;
;
INICIO;
FINAL;
;
NULL, Marca;
|FIN;

|PROCESO MarcaRefLin;
   #dsmow350#0 = #RefLin@#0;
   #dsmow350#1 = #RefLin@#1;
   #dsmow350#2 = #RefLin@#2;
   #dsmow350#3 = #RefLin@#3;
   #dsmow350#14 = #RefLin@#14;
   #dsmow350#4 = #RefLin@#4;
   |LEE 000#dsmow350.=;

   |SI aMarca = "*";
      |SI #RefLin@#16 = " ";
         nSelec = nSelec + 1;
         ||#RefLin@#15 = "103,131,224;240,253,246";
         #RefLin@#15 = "255,255,255;8,119,80";
         #RefLin@#16 = "*";
         |GRABA 020#RefLin@.a;

         #dsmow350#15 = #RefLin@#15;
         #dsmow350#16 = #RefLin@#16;
         |GRABA 020#dsmow350.a;
      |FINSI;
   |SINO;
      |SI #RefLin@#16 = "*";
         nSelec = nSelec - 1;
         |SI #RefLin@#14 = 210; #RefLin@#15 = "0,0,0;206,245,246"; |FINSI;
         |SI #RefLin@#14 = 211; #RefLin@#15 = "0,0,0;232,206,246"; |FINSI;
         |SI #RefLin@#14 = 213; #RefLin@#15 = "0,0,0;245,233,175"; |FINSI;
         #RefLin@#16 = " ";
         |GRABA 020#RefLin@.a;

         #dsmow350#15 = #RefLin@#15;
         #dsmow350#16 = #RefLin@#16;
         |GRABA 020#dsmow350.a;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE MarcaRefLin;
#RefLin@#1006;
;
00000, 0000, 00, 00, 000, 00000;
99999, 9999, 12, 99, 999, 99999;
;
NULL, MarcaRefLin;
|FIN;

|PROCESO MarcarTodos;
   |SI nRefLin = 1;
      |SALVA_FICHA #RefLin@;
      aMarca = "*"; |BUCLE MarcaRefLin;
      |REPON_FICHA #RefLin@;
   |SINO;
      |SALVA_FICHA #dsmow350;
      aMarca = "*"; |BUCLE Marca;
      |REPON_FICHA #dsmow350;
   |FINSI;
   |REFRESCACONTROL nGrid1;
|FPRC;

|PROCESO DesmarcarTodos;
   |SI nRefLin = 1;
      |SALVA_FICHA #RefLin@;
      aMarca = " "; |BUCLE MarcaRefLin;
      |REPON_FICHA #RefLin@;
   |SINO;
      |SALVA_FICHA #dsmow350;
      aMarca = " "; |BUCLE Marca;
      |REPON_FICHA #dsmow350;
   |FINSI;
   |REFRESCACONTROL nGrid1;
|FPRC;

|PROCESO EvtoGrid1;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsmow350.c;
   |FINSI;
   |SI FSalida = 4;
      |SI #dsmow350#16 = " ";
         ||#dsmow350#15 = "103,131,224;240,253,246";
         #dsmow350#15 = "255,255,255;8,119,80";
         #dsmow350#16 = "*";
         nSelec = nSelec + 1;
      |SINO;
         |SI #dsmow350#14 = 210; #dsmow350#15 = "0,0,0;206,245,246"; |FINSI;
         |SI #dsmow350#14 = 211; #dsmow350#15 = "0,0,0;232,206,246"; |FINSI;
         |SI #dsmow350#14 = 213; #dsmow350#15 = "0,0,0;245,233,175"; |FINSI;
         #dsmow350#16 = " ";
         nSelec = nSelec - 1;
      |FINSI;
      |GRABA 020#dsmow350.a;
      |REFRESCACONTROL nGrid1;
   |FINSI;
|FPRC;

|PROCESO EvtoRefLin;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#RefLin@.c;

      #dsmow350#0 = #RefLin@#0;
      #dsmow350#1 = #RefLin@#1;
      #dsmow350#2 = #RefLin@#2;
      #dsmow350#3 = #RefLin@#3;
      #dsmow350#14 = #RefLin@#14;
      #dsmow350#4 = #RefLin@#4;
      |LEE 000#dsmow350.=;
   |FINSI;
   |SI FSalida = 4;
      #dsmow350#0 = #RefLin@#0;
      #dsmow350#1 = #RefLin@#1;
      #dsmow350#2 = #RefLin@#2;
      #dsmow350#3 = #RefLin@#3;
      #dsmow350#14 = #RefLin@#14;
      #dsmow350#4 = #RefLin@#4;
      |LEE 000#dsmow350.=;

      |SI #RefLin@#16 = " ";
         ||#RefLin@#15 = "103,131,224;240,253,246";
         #RefLin@#15 = "255,255,255;8,119,80";
         #RefLin@#16 = "*";
         nSelec = nSelec + 1;
         #dsmow350#15 = "255,255,255;8,119,80";
         #dsmow350#16 = "*";
      |SINO;
         |SI #RefLin@#14 = 210; #RefLin@#15 = "0,0,0;206,245,246"; |FINSI;
         |SI #RefLin@#14 = 211; #RefLin@#15 = "0,0,0;232,206,246"; |FINSI;
         |SI #RefLin@#14 = 213; #RefLin@#15 = "0,0,0;245,233,175"; |FINSI;
         #RefLin@#16 = " ";
         nSelec = nSelec - 1;

         #dsmow350#15 = #RefLin@#15;
         #dsmow350#16 = " ";
      |FINSI;
      |GRABA 020#RefLin@.a;
      |GRABA 020#dsmow350.a;
      |REFRESCACONTROL nGrid1;
   |FINSI;
|FPRC;

|PROCESO FiltroLineal;
   |SI #dsmow351#0 = 0; |Y #dsmow351#1 = "01.01.2000"; |Y #dsmow351#3 = "01.01.2000";
                        |Y #dsmow351#2 = "31.12.2099"; |Y #dsmow351#4 = "31.12.2099";
      |DESTRUYECONTROL nGrid1;

      nPos1 = 0802; nPos2 = 1778;
      |LINEAL_SIMPLE #2#dsmow350, nRango, nPos1, nPos2, Infw350, Supw350, EvtoGrid1;
      nGrid1 = FSalida;
      nRefLin = 0;
   |SINO;
      |CIERRA #RefLin@;
      aAlfa = "SELECT * FROM dsmow350 INTO tfm" + Usuario + " WHERE ";
      |SI #dsmow351#0 ! 0;
         aAlfa = aAlfa + "14 == " + #dsmow351#0 + " AND ";
      |FINSI;
      aAlfa = aAlfa + "18 BETWEEN " + #dsmow351#1 + "," + #dsmow351#2;
      aAlfa = aAlfa + " AND 17 BETWEEN " + #dsmow351#3 + "," + #dsmow351#4;

      |SQL aAlfa;
      |SI FSalida = 0;
         |ABRE #RefLin@;
         |DESTRUYECONTROL nGrid1;

         nPos1 = 0802; nPos2 = 1778;
         |LINEAL_SIMPLE #1#RefLin@, nRango, nPos1, nPos2, InfRefLin, SupRefLin, EvtoRefLin;
         nGrid1 = FSalida;
         nRefLin = 1;
      |SINO;
         |ABRE #RefLin@;
         |DESTRUYECONTROL nGrid1;

         nPos1 = 0802; nPos2 = 1778;
         |LINEAL_SIMPLE #2#dsmow350, nRango, nPos1, nPos2, Infw350, Supw350, EvtoGrid1;
         nGrid1 = FSalida;
         nRefLin = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO FiltroModelo;
   |ESTADO_CONTROL nGrid1, "DISABLE";
   |ESTADO_CONTROL nBotonF1, "DISABLE";
   |ESTADO_CONTROL nBotonF2, "DISABLE";
   |ESTADO_CONTROL nBotonF3, "DISABLE";
   |ESTADO_CONTROL nBotonF4, "DISABLE";
   |ESTADO_CONTROL nBotonF5, "DISABLE";
   |ESTADO_CONTROL nBotonF6, "DISABLE";

   |C_M #dsmow351#0, 1, "S";

   |ENCAMPO #0#dsmow351;
   |SI FSalida = 0;
      |HAZ FiltroLineal;
   |FINSI;

   |C_M #dsmow351#0, 1, "N";
   |ESTADO_CONTROL nGrid1, "ENABLE";
   |ESTADO_CONTROL nBotonF1, "ENABLE";
   |ESTADO_CONTROL nBotonF2, "ENABLE";
   |ESTADO_CONTROL nBotonF3, "ENABLE";
   |ESTADO_CONTROL nBotonF4, "ENABLE";
   |ESTADO_CONTROL nBotonF5, "ENABLE";
   |ESTADO_CONTROL nBotonF6, "ENABLE";
|FPRC;

|PROCESO FiltroFDevengo;
   |ESTADO_CONTROL nGrid1, "DISABLE";
   |ESTADO_CONTROL nBotonF1, "DISABLE";
   |ESTADO_CONTROL nBotonF2, "DISABLE";
   |ESTADO_CONTROL nBotonF3, "DISABLE";
   |ESTADO_CONTROL nBotonF4, "DISABLE";
   |ESTADO_CONTROL nBotonF5, "DISABLE";
   |ESTADO_CONTROL nBotonF6, "DISABLE";

   |C_M #dsmow351#1, 1, "S"; |C_M #dsmow351#2, 1, "S";

|ET Otra1;
   |ENCAMPO #1#dsmow351;
   |SI FSalida = 0;
      |ENCAMPO #2#dsmow351;
      |SI FSalida = 0;
         |HAZ FiltroLineal;
      |SINO;
         |SI FSalida = 2; |VETE Otra1; |FINSI;
      |FINSI;
   |FINSI;

   |C_M #dsmow351#1, 1, "N"; |C_M #dsmow351#2, 1, "N";
   |ESTADO_CONTROL nGrid1, "ENABLE";
   |ESTADO_CONTROL nBotonF1, "ENABLE";
   |ESTADO_CONTROL nBotonF2, "ENABLE";
   |ESTADO_CONTROL nBotonF3, "ENABLE";
   |ESTADO_CONTROL nBotonF4, "ENABLE";
   |ESTADO_CONTROL nBotonF5, "ENABLE";
   |ESTADO_CONTROL nBotonF6, "ENABLE";
|FPRC;

|PROCESO FiltroFPresent;
   |ESTADO_CONTROL nGrid1, "DISABLE";
   |ESTADO_CONTROL nBotonF1, "DISABLE";
   |ESTADO_CONTROL nBotonF2, "DISABLE";
   |ESTADO_CONTROL nBotonF3, "DISABLE";
   |ESTADO_CONTROL nBotonF4, "DISABLE";
   |ESTADO_CONTROL nBotonF5, "DISABLE";
   |ESTADO_CONTROL nBotonF6, "DISABLE";

   |C_M #dsmow351#3, 1, "S"; |C_M #dsmow351#4, 1, "S";

|ET Otra2;
   |ENCAMPO #3#dsmow351;
   |SI FSalida = 0;
      |ENCAMPO #4#dsmow351;
      |SI FSalida = 0;
         |HAZ FiltroLineal;
      |SINO;
         |SI FSalida = 2; |VETE Otra2; |FINSI;
      |FINSI;
   |FINSI;

   |C_M #dsmow351#3, 1, "N"; |C_M #dsmow351#4, 1, "N";
   |ESTADO_CONTROL nGrid1, "ENABLE";
   |ESTADO_CONTROL nBotonF1, "ENABLE";
   |ESTADO_CONTROL nBotonF2, "ENABLE";
   |ESTADO_CONTROL nBotonF3, "ENABLE";
   |ESTADO_CONTROL nBotonF4, "ENABLE";
   |ESTADO_CONTROL nBotonF5, "ENABLE";
   |ESTADO_CONTROL nBotonF6, "ENABLE";
|FPRC;

|PROCESO Salir;
   |PTEC 807;
|FPRC;

|PROCESO Infw350;
   #dsmow350#0 = 00000;
   #dsmow350#1 = 00000;
   #dsmow350#2 = 00;
   #dsmow350#3 = 00;
   #dsmow350#4 = 00000;
   |SI #dsmow351#0 ! 0;
      #dsmow350#14 = #dsmow351#0;
   |SINO;
      #dsmow350#14 = 0;
   |FINSI;
   #dsmow350#18 = #dsmow351#1;
   #dsmow350#17 = #dsmow351#3;
|FPRC;

|PROCESO Supw350;
   #dsmow350#0 = 99999;
   #dsmow350#1 = 99999;
   #dsmow350#2 = 12;
   #dsmow350#3 = 99;
   #dsmow350#4 = 99999;
   |SI #dsmow351#0 ! 0;
      #dsmow350#14 = #dsmow351#0;
   |SINO;
      #dsmow350#14 = 999;
   |FINSI;
   #dsmow350#18 = #dsmow351#2;
   #dsmow350#17 = #dsmow351#4;
|FPRC;

|PROCESO InfRefLin;
   #RefLin@#0 = 00000;
   #RefLin@#1 = 00000;
   #RefLin@#2 = 00;
   #RefLin@#3 = 00;
   #RefLin@#4 = 00000;
   #RefLin@#14 = 000;
   #RefLin@#18 = "01.01.2000";
   #RefLin@#17 = "01.01.2000";
|FPRC;

|PROCESO SupRefLin;
   #RefLin@#0 = 99999;
   #RefLin@#1 = 99999;
   #RefLin@#2 = 99;
   #RefLin@#3 = 99;
   #RefLin@#4 = 99999;
   #RefLin@#14 = 999;
   #RefLin@#18 = "31.12.2099";
   #RefLin@#17 = "31.12.2099";
|FPRC;

|PROCESO SelecModelos;
   nSelec     = 0;
   aAlfa = "tmm" + Usuario; |NOME_DAT #dsmow350#aAlfa#;
   |DELINDEX #dsmow350;

   |ABRE #dsmow350;
   |DDEFECTO #dsmow351;

   |ABRE #dsm210hi;
   |ABRE #dsm210tr;
   |ABRE #dsm210dp;
   nCliente = 0; nEjercicio = 0; nPeriodo   = 0; |BUCLE Modelo210;
   nCliente = 0; nEjercicio = 0; nPeriodo   = 0; |BUCLE Modelo211;
   nCliente = 0; nEjercicio = 0; nPeriodo   = 0; |BUCLE Modelo213;
   |CIERRA #dsm210dp;
   |CIERRA #dsm210tr;
   |CIERRA #dsm210hi;

   |DDEF aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "dsmow350.mas";
   |CARGA_DEF aAlfa, RefLin@;
   |SI FSalida = 0;
      aAlfa = "tfm" + Usuario; |NOME_DAT #RefLin@#aAlfa#;
      |ABRE #RefLin@;
   |FINSI;

   |HAZ Selecciona;
|FPRC;

|PROCESO Selecciona;
   |VENTANA 1001, 2379, -1, 17, "Seleccione con doble click los modelos a remesar"; nVent = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PINPA #0#dsmow351; nPant0 = FSalida;
   |PINDA #0#dsmow351;

   nPos1 = 0507; nPos2 = 0520;
   |CONTROL_SIMPLE nPant0, "BOTON,{{197}}Modelo", nPos1, nPos2, FiltroModelo;
   nBotonF1 = FSalida;

   nPos1 = 0523; nPos2 = 0543;
   |CONTROL_SIMPLE nPant0, "BOTON,{{197}}Fecha devengo", nPos1, nPos2, FiltroFDevengo;
   nBotonF2 = FSalida;

   nPos1 = 0546; nPos2 = 0567;
   |CONTROL_SIMPLE nPant0, "BOTON,{{197}}Fecha presentacion", nPos1, nPos2, FiltroFPresent;
   nBotonF3 = FSalida;

   nPos1 = 1935; nPos2 = 1948;
   |CONTROL_SIMPLE nPant0, "BOTON,{{197}}Marcar todos", nPos1, nPos2, MarcarTodos;
   nBotonF5 = FSalida;

   nPos1 = 1950; nPos2 = 1966;
   |CONTROL_SIMPLE nPant0, "BOTON,{{197}}Desmarcar todos", nPos1, nPos2, DesmarcarTodos;
   nBotonF6 = FSalida;

   nPos1 = 1968; nPos2 = 1978;
   |CONTROL_SIMPLE nPant0, "BOTON,{{206}}Validar", nPos1, nPos2, Salir;
   nBotonF4 = FSalida;

   nPos1 = 0802; nPos2 = 1778;
   |LINEAL_SIMPLE #2#dsmow350, nRango, nPos1, nPos2, Infw350, Supw350, EvtoGrid1;
   nGrid1 = FSalida;
   nRefLin = 0;

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Salir," + nGrid1;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
   |SIGUE;
   |DESTRUYECONTROL nGrid1;

   aVent4 = nVent;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent;
|FPRC;

|PROCESO InfAdl;
   #dsmoradl#0 = 1;
|FPRC;

|PROCESO SupAdl;
   #dsmoradl#0 = 99;
|FPRC;

|PROCESO EvtoGrid0;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#dsmoradl.c;

      #dsmoradj#5 = #dsmoradl#3; |PINTA #dsmoradj#5;
      #dsmoradj#6 = #dsmoradl#8; |PINTA #dsmoradj#6;

      |FIN_CONTROL_WINDOWS nBotonBaja;
      nPos1 = 2358; nPos2 = 2374;
      |SI #dsmoradl#7 = "N";
         |CONTROL_SIMPLE nPant, "BOTON,{{197}}Adjudicar modelo", nPos1, nPos2, CambiaModelo;
      |SINO;
         |CONTROL_SIMPLE nPant, "BOTON,{{197}}Desmarcar modelo", nPos1, nPos2, CambiaModelo;
      |FINSI;
      nBotonBaja = FSalida;
   |FINSI;
|FPRC;

|PROCESO VuelcaSeleccion;
   #dsm210dp#0 = #dsmow350#0;
   |LEE 000#dsm210dp.=;
   |SI FSalida ! 0; |DDEFECTO #dsm210dp; |FINSI;

   |DDEFECTO #dsmoradl;

   |SI #dsmow350#20 ! 100; |Y #dsmow350#21 ! 100;
      nCalc1 = #dsmow350#13 % #dsmow350#20;
      nCalc2 = #dsmow350#13 - nCalc1;
   |SINO;
      |SI #dsmow350#20 = 100; nCalc1 = #dsmow350#13; nCalc2 = 0; |FINSI;
      |SI #dsmow350#21 = 100; nCalc2 = #dsmow350#13; nCalc1 = 0; |FINSI;
   |FINSI;

   |SI nCalc1 ! 0;
      #dsmoradl#0 = nLinea; nLinea = nLinea + 1;
      #dsmoradl#1 = "T"; #dsmoradl#2 = "TITULAR";
      #dsmoradl#3 = #dsm210dp#1;
      #dsmoradl#5 = #dsmow350#12;
      #dsmoradl#6 = nCalc1;
      #dsmoradl#7 = "S";
      #dsmoradl#11 = "0,0,0;255,255,255";
      #dsmoradl#12 = #dsmow350#14;
      #dsmoradl#13 = #dsmow350#18;
      #dsmoradl#14 = #dsmow350#0;

      #dsmoradl#15 = #dsmow350#1;
      #dsmoradl#16 = #dsmow350#2;
      #dsmoradl#17 = #dsmow350#3;

      #dsmoradl#18 = #dsmow350#5;
      #dsmoradl#19 = #dsmow350#6;
      #dsmoradl#20 = #dsmow350#7;
      #dsmoradl#21 = #dsmow350#8;
      #dsmoradl#22 = #dsmow350#9;

      #dsmoradl#23 = #dsmow350#10;

      #dsmoradl#24 = #dsmow350#11;
      |GRABA 020#dsmoradl.n;
   |FINSI;
   |SI nCalc2 ! 0;
      #dsmoradl#0 = nLinea; nLinea = nLinea + 1;
      #dsmoradl#1 = "C"; #dsmoradl#2 = "CONYUGE";
      #dsmoradl#3 = #dsm210dp#64;
      #dsmoradl#5 = #dsmow350#12;
      #dsmoradl#6 = nCalc2;
      #dsmoradl#7 = "S";
      #dsmoradl#11 = "0,0,0;255,255,255";
      #dsmoradl#12 = #dsmow350#14;
      #dsmoradl#13 = #dsmow350#18;
      #dsmoradl#14 = #dsmow350#0;

      #dsmoradl#15 = #dsmow350#1;
      #dsmoradl#16 = #dsmow350#2;
      #dsmoradl#17 = #dsmow350#3;

      #dsmoradl#18 = #dsmow350#5;
      #dsmoradl#19 = #dsmow350#6;
      #dsmoradl#20 = #dsmow350#7;
      #dsmoradl#21 = #dsmow350#8;
      #dsmoradl#22 = #dsmow350#9;

      #dsmoradl#23 = #dsmow350#10;

      #dsmoradl#24 = #dsmow350#11;
      |GRABA 020#dsmoradl.n;
   |FINSI;

   |BORRA 020#dsmow350.a;
|FPRC;

|DEFBUCLE VuelcaSeleccion;
#dsmow350#1;
16;
00000, 0000, 00, 00, 000, 00000, "*";
99999, 9999, 12, 99, 999, 99999, "*";
;
NULL, VuelcaSeleccion;
|FIN;

|PROCESO CambiaModelo;
   |SI #dsmoradl#7 = "S";
      #dsmoradl#7 = "N";
      #dsmoradl#11 = "0,0,0;249,167,113";
      nSelec = nSelec - 1;
   |SINO;
      #dsmoradl#7 = "S";
      #dsmoradl#11 = "0,0,0;255,255,255";
      nSelec = nSelec + 1;
   |FINSI;
   |GRABA 020#dsmoradl.a;

   |REFRESCACONTROL nGrid0;
|FPRC;

|PROCESO Observac;
   |C_M #dsmoradj#6, 1, "S";
   |ENCAMPO #6#dsmoradj;
   |SI FSalida = 0;
      |C_M #dsmoradj#6, 1, "N";

      #dsmoradl#8 = #dsmoradj#6;
      |GRABA 020#dsmoradl.a;
      |REFRESCACONTROL nGrid0;
   |SINO;
      |C_M #dsmoradj#6, 1, "N";
   |FINSI;
|FPRC;

|PROCESO AnyadeModelos;
   nAntSel = nSelec;
   |HAZ Selecciona;
   |SI nSelec > nAntSel;
     |LEE 000#dsmoradl.u;
     |SI FSalida ! 0;
        nLinea = 1;
     |SINO;
        nLinea = #dsmoradl#0 + 1;
     |FINSI;
     |ABRE #dsm210dp;
     |BUCLE VuelcaSeleccion;
     |CIERRA #dsm210dp;
  |FINSI;

  |REFRESCACONTROL nGrid0;
|FPRC;

|PROCESO GrabaLineas;
   |SI #dsmoradl#7 = "N"; |ACABA; |FINSI;

   |DDEFECTO #dsmorrel;

   #dsmorrel#0 = #dsmorrem#0;
   #dsmorrel#1 = nLinRem; nLinRem = nLinRem + 1;
   #dsmorrel#2 = #dsmoradl#14;
   #dsmorrel#3 = #dsmoradl#3;
   #dsmorrel#4 = #dsmoradl#12;
   #dsmorrel#5 = #dsmoradl#5;
   #dsmorrel#6 = #dsmoradl#6;
   #dsmorrel#7 = #dsmoradl#8;
   #dsmorrel#8 = #dsmoradl#13;
   #dsmorrel#9  = #dsmoradl#1;
   #dsmorrel#10 = #dsmoradl#2;

   |SI #dsmoradl#12 = 210;
      #dsmorrel#11 = #dsmoradl#14;
      #dsmorrel#12 = #dsmoradl#15;
      #dsmorrel#13 = #dsmoradl#16;
      #dsmorrel#14 = #dsmoradl#17;
      #dsmorrel#15 = #dsmoradl#18;
      #dsmorrel#16 = #dsmoradl#19;
      #dsmorrel#17 = #dsmoradl#20;
      #dsmorrel#18 = #dsmoradl#21;
      #dsmorrel#19 = #dsmoradl#22;
   |FINSI;
   |SI #dsmoradl#12 = 211;
      #dsmorrel#20 = #dsmoradl#14;
      #dsmorrel#21 = #dsmoradl#15;
      #dsmorrel#22 = #dsmoradl#17;
      #dsmorrel#23 = #dsmoradl#23;
   |FINSI;
   |SI #dsmoradl#12 = 213;
      #dsmorrel#24 = #dsmoradl#14;
      #dsmorrel#25 = #dsmoradl#15;
      #dsmorrel#26 = #dsmoradl#16;
      #dsmorrel#27 = #dsmoradl#24;
      #dsmorrel#28 = #dsmoradl#17;
   |FINSI;
   |GRABA 020#dsmorrel.n;

   #dsmorrem#4 = #dsmorrem#4 + #dsmoradl#6;

   |SI #dsmoradl#12 = 210;
      |ABRE #dsm210h3;
      #dsm210h3#0 = #dsmoradl#14;
      #dsm210h3#1 = #dsmoradl#15;
      #dsm210h3#2 = #dsmoradl#16;
      #dsm210h3#3 = #dsmoradl#17;
      #dsm210h3#4 = #dsmoradl#18;
      #dsm210h3#5 = #dsmoradl#19;
      #dsm210h3#6 = #dsmoradl#20;
      #dsm210h3#7 = #dsmoradl#21;
      #dsm210h3#8 = #dsmoradl#22;
      |LEE 101#dsm210h3.=;
      |SI FSalida = 0;
         #dsm210h3#37 = #dsmorrem#0;
         |GRABA 020#dsm210h3.a; |LIBERA #dsm210h3;
      |FINSI;
      |CIERRA #dsm210h3;
   |FINSI;
   |SI #dsmoradl#12 = 211;
      |ABRE #dsm211hi;
      #dsm211hi#0 = #dsmoradl#14;
      #dsm211hi#1 = #dsmoradl#15;
      #dsm211hi#2 = #dsmoradl#17;
      #dsm211hi#3 = #dsmoradl#23;
      |LEE 101#dsm211hi.=;
      |SI FSalida = 0;
         #dsm211hi#72 = #dsmorrem#0;
         |GRABA 020#dsm211hi.a; |LIBERA #dsm211hi;
      |FINSI;
      |CIERRA #dsm211hi;
   |FINSI;
   |SI #dsmoradl#12 = 213;
      |ABRE #dsm213hi;
      #dsm213hi#0 = #dsmoradl#14;
      #dsm213hi#1 = #dsmoradl#15;
      #dsm213hi#2 = #dsmoradl#16;
      #dsm213hi#3 = #dsmoradl#24;
      #dsm213hi#4 = #dsmoradl#17;
      |LEE 101#dsm213hi.=;
      |SI FSalida = 0;
         #dsm213hi#29 = #dsmorrem#0;
         |GRABA 020#dsm213hi.a; |LIBERA #dsm213hi;
      |FINSI;
      |CIERRA #dsm213hi;
   |FINSI;
|FPRC;

|DEFBUCLE GrabaLineas;
#dsmoradl#1;
;
INICIO;
FINAL;
;
NULL, GrabaLineas;
|FIN;

|PROCESO CreaRemesa;
  |ABRE #dsmorrem; |ABRE #dsmorrel;
  |LEE 000#dsmorrem.u;
  |SI FSalida ! 0; |DDEFECTO #dsmorrem; #dsmorrem#0 = 0; |FINSI;

  nRemesa = #dsmorrem#0 + 1;
  |DDEFECTO #dsmorrem;
  #dsmorrem#0 = nRemesa;
  #dsmorrem#1 = #dsmoradj#0;
  #dsmorrem#2 = #dsmoradj#1;
  #dsmorrem#3 = #dsmoradj#2;
  |GRABA 020#dsmorrem.c;

  nLinRem = 1; |BUCLE GrabaLineas;
  |GRABA 020#dsmorrem.a;

  |CIERRA #dsmorrem; |CIERRA #dsmorrel;
|FPRC;

|PROGRAMA;
  |CLS;
  |CABEZA "Adjudicacion de Remesas";
  |PINPA #0#0; nPant = FSalida;

  aAlfa = "tml" + Usuario; |NOME_DAT #dsmoradl#aAlfa#;
  |DELINDEX #dsmoradl; |ABRE #dsmoradl;
  aAlfa = "tmm" + Usuario; |NOME_DAT #dsmow350#aAlfa#;
  |DELINDEX #dsmow350;

  nPos1 = 2358; nPos2 = 2374;
  |CONTROL_SIMPLE nPant, "BOTON,{{197}}Adjudicar modelo", nPos1, nPos2, CambiaModelo;
  nBotonBaja = FSalida;
  |ESTADO_CONTROL nBotonBaja, "HIDE";

  nPos1 = 2341; nPos2 = 2356;
  |CONTROL_SIMPLE nPant, "BOTON,{{197}}Observaciones", nPos1, nPos2, Observac;
  nBotonObs = FSalida;
  |ESTADO_CONTROL nBotonObs, "HIDE";

  nPos1 = 2324; nPos2 = 2339;
  |CONTROL_SIMPLE nPant, "BOTON,{{197}}A¤adir modelos", nPos1, nPos2, AnyadeModelos;
  nBotonComp = FSalida;
  |ESTADO_CONTROL nBotonComp, "HIDE";

  nRango = 4 + 8 + 16 + 32;
  nPos1 = 1306; nPos2 = 2274;
  |LINEAL_SIMPLE #1#dsmoradl, nRango, nPos1, nPos2, InfAdl ,SupAdl, EvtoGrid0;
  nGrid0 = FSalida;
  |ESTADO_CONTROL nGrid0, "DISABLE";
  |PULSATECLA;

  |ABRE #dsmow350;
  |PINTA #0#0; |PINTA #0#1; |PINTA #0#2;
  ||PINTA #0#3; |PINTA #0#4;
  |ENDATOS #1#0;

  |C_M #0#0, 1, "N"; |C_M #0#2, 1, "N";

  FSestado = FSalida;

  |SI FSalida = 0;
     |HAZ SelecModelos;

     |SI nSelec > 0;
        |LEE 000#dsmoradl.u;
        |SI FSalida ! 0;
           nLinea = 1;
        |SINO;
           nLinea = #dsmoradl#0 + 1;
        |FINSI;
        |ABRE #dsm210dp;
        |BUCLE VuelcaSeleccion;
        |CIERRA #dsm210dp;

        |ESTADO_CONTROL nBotonBaja, "SHOW";
        |ESTADO_CONTROL nBotonObs,  "SHOW";
        |ESTADO_CONTROL nBotonComp, "SHOW";
        |ESTADO_CONTROL nGrid0, "ENABLE";
        |REFRESCACONTROL nGrid0;

        |CIERRA #RefLin@; |DESCARGA_DEF #RefLin@;

        aEsc1  = &255 + "806";
        aEsc2  = &255 + "807";
        aRetu  = &255 + "802";
        |PARA; |SI;  |HACIENDO;
           FSalida = "::{{001}}Salir," + nGrid1;
           |LEETECLA aTecla;
           |SI aTecla = aEsc1; |SAL; |FINSI;
           |SI aTecla = aEsc2; |SAL; |FINSI;
           |SI aTecla = aRetu; |SAL; |FINSI;
        |SIGUE;
        |ESTADO_CONTROL nGrid0, "DISABLE";
        |ESTADO_CONTROL nBotonBaja, "HIDE";
        |ESTADO_CONTROL nBotonObs,  "HIDE";
        |ESTADO_CONTROL nBotonComp, "HIDE";

        |SI nSelec > 0;
           aAlfa = "    " + &191 + " Crear la remesa ? ";
           |CONFI aAlfa;
           |SI FSalida = 0;
              |HAZ CreaRemesa;
           |FINSI;
        |FINSI;
     |SINO;
        |MENAV "    No se han marcado registros. Proceso cancelado.";
     |FINSI;

     |CIERRA #dsmoradl; |DELINDEX #dsmoradl; |ABRE #dsmoradl;
     |REFRESCACONTROL nGrid0;
  |FINSI;
  |CIERRA #dsmow350; |DELINDEX #dsmow350;

  |DESTRUYECONTROL nGrid0;
  |FIN_CONTROL_WINDOWS nBotonBaja;
  |FIN_CONTROL_WINDOWS nBotonObs;
  |FIN_CONTROL_WINDOWS nBotonComp;
|FPRO;
