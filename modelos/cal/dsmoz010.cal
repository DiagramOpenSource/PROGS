|FICHEROS;
     dsmoz010 #0;

     :/basica/def/dspase00 #10;

     dsmom003 #3;
     dsmom004 #4;
     dsmom023 #23;
     dsmom024 #24;
     :/basica/def/agitab99 #99;
     :/basica/def/agifigen #118;

     refer00@ #900;
     refer01@ #901;
     refer02@ #902;
     refer03@ #903;
|FIN;

|VARIABLES;
     nDEmpresa = 0;
     nHEmpresa = 0;
     nDEjercic = 0;
     nHEjercic = 0;
     nDEjerB   = 0;
     nHEjerB   = 0;
     nDEjerL   = 0;
     nHEjerL   = 0;

     nCampo    = 0;
     fFecha    = @;
     aDescrip  = "";
     nCanti    = 0;
     aTPeriodo = "";

     nSwBueno   = 0;
     nCodigoNue = 0;
     nCodigo    = 0;
     aNom       = "";
     aNif       = "";

     aBase            = "";
     aPath            = "";
     aPathAnterior    = "";
     aPathDefFiscal   = "";
     aPathFichFiscal  = "";
     aPathDefAgicont  = "";
     aPathFichAgicont = "";
     aPathDefLaboral  = "";
     aPathFichLaboral = "";
     aPathDefSociedad = "";
     aPathFichSociedad= "";

     aPathDestino     = "";
     aDef03           = "";
     aDef             = "";
     aNomDef          = "";
     nSwError         = 0;
     aDirEmpresa      = "";
     aDirFichDestino  = "";
     aDirFichOrigen   = "";
     aFichero         = "";
     nCanal           = 0;
     aAlfa            = "";
     aAlfa1           = "";
     aAlfa2           = "";
     aAlfa3           = "";
     aAlfa4           = "";

     &eaPathBasica   = "";
     nSwHayRegistro  = 0;
     nSwPrimero      = 0;
     nLaEmpresa      = 0;

     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     nNume4 = 0;


     &enTodo = 0;
     &enAnyPaseD = 0;
     &enAnyPaseH = 0;
     &enTipPase  = 0;

     aQueQuiero = "";
     aNumCampos = "";
     nNumCampos = 0;
     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDEjer    = 0;
     &enHEjer    = 0;
     &enDModelo  = 0;
     &enHModelo  = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;
|INCLUYE i_modhis;

|| ***********************************************************************
|| //////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO Tipo7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#0 = enEmpresa;  |PINTA #0#0;
         #0#1 = enEmpresa;  |PINTA #0#1;

         |C_M #0#0, 1, "N";
         |C_M #0#1, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Parrilla;
     |SI #0#0 = 0;
         #0#0 = 0;  |PINTA #0#0;
         #0#1 = 0;  |PINTA #0#1;  |C_M #0#1, 1, "N";
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#0, 1, "S";
             |C_M #0#1, 1, "S";
         |FINSI;

         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|| **************************************************************************
|| /////////////////////// PROCESOS CALCULO DEL Resumen \\\\\\\\\\\\\\\\\\\\\
|PROCESO Borra024;
   #23#0 = #24#0;
   #23#1 = #24#1;
   #23#2 = #24#3;
   |LEE 001#23=;
   |SI FSalida = 0;
       |BORRA 020#23a;
       |LIBERA #23;
   |FINSI;
   |BORRA 020#24a;
   |LIBERA #24;
|FPRC;

|DEFBUCLE dsmom024;
     #24#1;
     ;
     enEmpresa, nDEjerB, 00, enModelo, 00;
     enEmpresa, nHEjerB, 99, enModelo, 99;
     be;
     NULL, Borra024;
|FIN;

|PROCESO BorraAntes;
  nDEjerB = enEjer;
  nHEjerB = enEjer;
  |CIERRA #24;
  |BUCLE dsmom024;
  |ABRE #24;
|FPRC;

|PROCESO BorraAntesEOS;
    |SI nSwPrimero = 0; |O enEmpresa ! nLaEmpresa;
        nSwPrimero = 1;
        nLaEmpresa = enEmpresa;
        nSwHayRegistro = 0;
    |FINSI;

    |SI nSwHayRegistro  = 0;
        nSwHayRegistro  = 1;
        nDEjerB = nDEjercic;
        nHEjerB = nHEjercic;
        |CIERRA #24;
        |BUCLE dsmom024;
        |ABRE #24;

        |SI enModelo = 110; |O enModelo = 115;
            aTPeriodo = "T";
            #901#0 = enEmpresa;
            |LEE 000#901=;
            |SI FSalida = 0;
                aTPeriodo = #901#2;
            |FINSI;
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO BorraAntesLaboral;
   nDEjerB = nDEjercic;
   nHEjerB = nHEjercic;
   |CIERRA #24;
   |BUCLE dsmom024;
   |ABRE #24;
|FPRC;

|| //////////////////////////////////////////////////////////////////////
|PROCESO GrabaResumen;
     |HAZ SelModelo;
     |SI nSwModHis = 0; |ACABA; |FINSI;

     #23#0 = enEmpresa;
     #23#1 = enEjer;
     #23#2 = enModelo;
     |LEE 101#23=;
     |SI FSalida ! 0;
         |DDEFECTO #23;
         #23#0 = enEmpresa;
         #23#1 = enEjer;
         #23#2 = enModelo;
         |HAZ LeoModelo;
         #23#3 = #99#1;
         |GRABA 020#23b;
     |FINSI;

     #24#0 = enEmpresa;
     #24#1 = enEjer;
     #24#2 = enPeriodo;
     #24#3 = enModelo;
     #24#4 = enComplem;
     |LEE 141#24=;
     |SI FSalida ! 0;
         |DDEFECTO #24;
         #24#0  = enEmpresa;
         #24#1  = enEjer;
         #24#2  = enPeriodo;
         #24#3  = enModelo;
         #24#4  = enComplem;
         |HAZ descripPer;
         #24#12 = aDescrip;
         |GRABA 020#24b;
     |FINSI;

     #24#7  = fFecha;                ||Fecha Entrada
     #24#8  = #24#8  + enResultado;  ||Resultado
     #24#9  = #24#9  + enIngresar;
     #24#10 = #24#10 + enDevolver;
     #24#11 = #24#11 + enCompensar;
     #24#13 = #24#13 + enImpReal;

     aAlfa1 = enModelo; aAlfa1 = aAlfa1 % 101;
     |SI aAlfa1 = "3";
         #24#14 = #24#14 + enCas21;
         #24#15 = #24#15 + enCas27;
         #24#16 = #24#16 + enCas31;
         #24#17 = #24#17 + enCas34;
     |FINSI;

     |GRABA 020#24a;
     |LIBERA #24;

     #23#4 = #23#4 + #24#9;
     #23#5 = #23#5 + #24#10;
     #23#6 = #23#4 - #23#5;
     |GRABA 020#23a;
     |LIBERA #23;

     |ATRI I;
     |PINTA 2303, "Modelo: ";
     |PINTA 2316, "Empresa: ";
     |PINTA 2333, "Ejercicio: ";
     |PINTA 2350, "Periodo: ";
     |ATRI 0;
     |PINTA 2311, #24#3;
     |PINTA 2325, #24#0;
     |PINTA 2344, #24#1;
     |PINTA 2359, #24#2;
|FPRC;

|| //////////////////////////////////////////////////////////////////////
|PROCESO descripPer;
 |SI enPeriodo = 1;   aDescrip = "ENERO     ";  |FINSI;
 |SI enPeriodo = 2;   aDescrip = "FEBRERO   ";  |FINSI;
 |SI enPeriodo = 3;   aDescrip = "MARZO     ";  |FINSI;
 |SI enPeriodo = 4;   aDescrip = "ABRIL     ";  |FINSI;
 |SI enPeriodo = 5;   aDescrip = "MAYO      ";  |FINSI;
 |SI enPeriodo = 6;   aDescrip = "JUNIO     ";  |FINSI;
 |SI enPeriodo = 7;   aDescrip = "JULIO     ";  |FINSI;
 |SI enPeriodo = 8;   aDescrip = "AGOSTO    ";  |FINSI;
 |SI enPeriodo = 9;   aDescrip = "SEPTIEMBRE";  |FINSI;
 |SI enPeriodo = 10;  aDescrip = "OCTUBRE   ";  |FINSI;
 |SI enPeriodo = 11;  aDescrip = "NOVIEMBRE ";  |FINSI;
 |SI enPeriodo = 12;  aDescrip = "DICIEMBRE ";  |FINSI;
 |SI enPeriodo = 99;  aDescrip = "ANUAL     ";  |FINSI;
|FPRC;

|PROCESO calculoFecha;
       aAlfa1 = "31";
       |SI enPeriodo = 4; |O enPeriodo = 6; |O enPeriodo = 9; |O enPeriodo = 11;
           aAlfa1 = "30";
       |FINSI;
       |SI enPeriodo = 2;
           aAlfa1 = "28";
           nNume4 = (enEjer $ 4);
           |SI nNume4 = 0; aAlfa1 = "29"; |FINSI;
       |FINSI;
       |SI enPeriodo ! 99;
           aAlfa2 = enPeriodo; |QBF aAlfa2;
           aAlfa2 = ("00" + aAlfa2) % -102;
       |SINO;
           aAlfa2 = "12";
       |FINSI;
       aAlfa3 = enEjer;

       aAlfa4 = aAlfa1 + "." + aAlfa2 + "." + aAlfa3;
       fFecha = aAlfa4;      ||Fecha Impresion
|FPRC;

|| //////////////////////////////////////////////////////////////////////
|PROCESO SituaAplicacion;
     eaPathBasica    = "";
     |DBASS aBase;   |QBF aBase;
     aAlfa = aBase + "basica/def/agifigen.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathBasica = aBase + "basica/";
     |FINSI;
|FPRC;

|| //////////////////////////////////////////////////////////////////////
|| ---------------- Cambio de Codigos
|PROCESO CogeCodigo;
 |ABRE #118;
 #118#0 = nCodigo;
 |LEE 041#118=;
 |SI FSalida = 0;
     aAlfa1 = #118#13; |QBF aAlfa1;
     |SI aAlfa1 = aNif; |Y aNif ! "";
         nCodigoNue = #118#0;
     |SINO;
         aAlfa1 = #118#2; |QBT aAlfa1;
         |SI aAlfa1 = aNom; |Y aNom ! "";
             nCodigoNue = #118#0;
         |FINSI;
     |FINSI;
 |FINSI;
 |CIERRA #118;
 |SI nCodigoNue = 0;
     |SI aNif ! "";
         |ABRE #118;
         |SELECT #4#118;
         #118#13 = aNif;
         |LEE 041#118=;
         |SI FSalida = 0;
             nCodigoNue = #118#0;
         |FINSI;
         |SELECT #1#118;
         |CIERRA #118;
     |FINSI;
 |FINSI;
 |SI nCodigoNue ! 0;
     nSwBueno = 0;
     |SI #0#0 ! 0;
         |SI nCodigoNue ] #0#0; |Y nCodigoNue [ #0#1;
             nSwBueno = 1;
         |FINSI;
     |SINO;
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |SI nCodigoNue =  #0nCampo;
                   nSwBueno = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;
     |SI nSwBueno = 0; nCodigoNue = 0; |FINSI;
 |FINSI;

|FPRC;

|PROCESO CogeCodEos;

 nCodigoNue = 0;

 |DDEFECTO #902;
 #902#0 = nCodigo;
 |LEE 041#902=;
 aNom = #902#2; |QBT aNom;
 aNif = #902#1; |QBF aNif;
 |HAZ CogeCodigo;
|FPRC;

|| //////////////////////////////////////////////////////////////////////
|| //////////////////////////////////////////////////////////////////////
|PROCESO PasaModelo11VEOS;
    enEjer = #900#1;

    nCodigoNue = 0;
    nCodigo    = #900#0;
    |HAZ CogeCodEos;
    |SI nCodigoNue = 0;  |ACABA;  |FINSI;

    enEmpresa = nCodigoNue;
    enComplem = #900#4;

    |HAZ BorraAntesEOS;

    enPeriodo = #900#3;
    |SI aTPeriodo = "T";
        |SI #900#3 = 1; enPeriodo = 3; |FINSI;
        |SI #900#3 = 2; enPeriodo = 6; |FINSI;
        |SI #900#3 = 3; enPeriodo = 9; |FINSI;
        |SI #900#3 = 4; enPeriodo = 12; |FINSI;
    |FINSI;
    |HAZ calculoFecha;

    |SI enModelo = 110;
        enResultado = (#900#29 / enConversor) ! EURODBMOD;
    |SINO;
        enResultado = (#900#12 / enConversor) ! EURODBMOD;
    |FINSI;
    enImpReal   = enResultado;
    enIngresar  = enResultado;
    enDevolver  = 0;
    enCompensar = 0;
    |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE eosma11V;
     #900#1005;
     ;
     nDEmpresa, nDEjercic, "   ", 00, 00;
     nHEmpresa, nHEjercic, "zzz", 99, 99;
     ;
     NULL, PasaModelo11VEOS;
|FIN;

|PROCESO Paso11VE;
   aDef = aPathDefFiscal + "eosm0028.mas";   ||para saber Trim. o Mes.
   |CARGA_DEF aDef, refer01@;
   |SI FSalida ! 0;
       |MENAV "     Error en Cargar el Def eosm0028.mas";
   |FINSI;
   |PATH_DAT #901 aPathFichFiscal;

   aNomDef = "eosm0033.mas";
   |HAZ Carga_Eos;  |SI nSwError = 1; |DESCARGA_DEF #refer01@; |ACABA; |FINSI;

   |ABRE #901;
   nSwPrimero = 0;
   enModelo = 110;
   |BUCLE eosma11V;
   |CIERRA #901;

   |DESCARGA_DEF #refer00@;
   |DESCARGA_DEF #refer01@;

|| ..... Paso115E;
   aDef = aPathDefFiscal + "eosm0046.mas";   ||para saber Trim. o Mes.
   |CARGA_DEF aDef, refer01@;
   |SI FSalida ! 0;
       |MENAV "     Error en Cargar el Def eosm0046.mas";
   |FINSI;
   |PATH_DAT #901 aPathFichFiscal;

   aNomDef = "eosm0043.mas";
   |HAZ Carga_Eos;  |SI nSwError = 1; |DESCARGA_DEF #refer01@; |ACABA; |FINSI;

   |ABRE #901;
   nSwPrimero = 0;
   enModelo = 115;
   |BUCLE eosma11V;
   |CIERRA #901;

   |DESCARGA_DEF #refer00@;
   |DESCARGA_DEF #refer01@;
|FPRC;


|PROCESO PasaModelo131EOS;
    |SI #900#1 < 80;
        enEjer = 2000 + #900#1;
    |SINO;
        enEjer = 1900 + #900#1;
    |FINSI;
    |SI enEjer < nDEjercic; |O enEjer > nHEjercic;  |ACABA;  |FINSI;

    nCodigoNue = 0;
    nCodigo    = #900#0;
    |HAZ CogeCodEos;
    |SI nCodigoNue = 0;  |ACABA;  |FINSI;

    enEmpresa = nCodigoNue;
    enModelo  = 131;
    enComplem = 00;

    |HAZ BorraAntesEOS;

    |SI #900#2 = 1;  enPeriodo = 3; |FINSI;
    |SI #900#2 = 2;  enPeriodo = 6; |FINSI;
    |SI #900#2 = 3;  enPeriodo = 9; |FINSI;
    |SI #900#2 = 4;  enPeriodo = 12;|FINSI;

    fFecha      = #900#3;       ||Fecha Impresion
    enResultado = (#900#47 / enConversor) ! EURODBMOD;
    enImpReal   = (#900#47 / enConversor) ! EURODBMOD;
    enCompensar = 0;
    |SI enResultado < 0;
        enDevolver = -enResultado;
        enIngresar = 0;
    |SINO;
        enDevolver = 0;
        enIngresar = enResultado;
    |FINSI;
    |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE eosm0020;
     #900#1003;
     ;
     nDEmpresa, 00, 00;
     nHEmpresa, 99, 99;
     ;
     NULL, PasaModelo131EOS;
|FIN;

|PROCESO Paso131E;

   aNomDef = "eosm0020.mas";
   |HAZ Carga_Eos;  |SI nSwError = 1; |ACABA; |FINSI;

   nSwPrimero = 0;
   |BUCLE eosm0020;

   |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO PasaModelo3VVEOS;
    |SI #900#4 < 80;
        enEjer = 2000 + #900#4;
    |SINO;
        enEjer = 1900 + #900#4;
    |FINSI;
    |SI enEjer < nDEjercic; |O enEjer > nHEjercic;  |ACABA;  |FINSI;

    nCodigoNue = 0;
    nCodigo    = #900#0;
    |HAZ CogeCodEos;
    |SI nCodigoNue = 0;  |ACABA;  |FINSI;

    enEmpresa = nCodigoNue;
    enComplem = 00;

    |HAZ BorraAntesEOS;

    enPeriodo = #900#2;
    |SI #900#3 = "T";
        |SI #900#2 = 1; enPeriodo = 3; |FINSI;
        |SI #900#2 = 2; enPeriodo = 6; |FINSI;
        |SI #900#2 = 3; enPeriodo = 9; |FINSI;
        |SI #900#2 = 4; enPeriodo = 12; |FINSI;
    |SINO;
        |SI #900#3 = "A";  enPeriodo = 99; |FINSI;
    |FINSI;

    fFecha      = #900#5;        ||Fecha Impresion
    enIngresar  = (#900#53 / enConversor) ! EURODBMOD;
    enCompensar = (#900#52 / enConversor) ! EURODBMOD;
    enDevolver  = (#900#51 / enConversor) ! EURODBMOD;
    |SI enIngresar ! 0;
        enResultado = enIngresar;
    |SINO;
       |SI enDevolver ! 0;
           enResultado = -enDevolver;
       |SINO;
           enResultado = -enCompensar;
       |FINSI;
   |FINSI;
   enImpReal = (#900#41 / enConversor) ! EURODBMOD;   || Antes de Compensar
   enCas21   = (#900#27 / enConversor) ! EURODBMOD;
   enCas27   = (#900#40 / enConversor) ! EURODBMOD;
   enCas31   = (#900#44 / enConversor) ! EURODBMOD;
   enCas34   = (#900#50 / enConversor) ! EURODBMOD;
   |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE eosma3VV;
     #900#1005;
     ;
     nDEmpresa, 1, 00, " ", 00;
     nHEmpresa, 9, 99, "z", 99;
     ;
     NULL, PasaModelo3VVEOS;
|FIN;

|PROCESO Paso3VVE;

   aNomDef = "eosma320.mas";
   |HAZ Carga_Eos;  |SI nSwError = 1; |ACABA; |FINSI;

   nSwPrimero = 0;
   enModelo = 320;
   |BUCLE eosma3VV;

   |DESCARGA_DEF #refer00@;

|| .....  Paso330E;
   aNomDef = "eosma330.mas";
   |HAZ Carga_Eos;  |SI nSwError = 1; |ACABA; |FINSI;

   nSwPrimero = 0;
   enModelo = 330;
   |BUCLE eosma3VV;

   |DESCARGA_DEF #refer00@;

|| .....  Paso332E;
   aNomDef = "eosma332.mas";
   |HAZ Carga_Eos;  |SI nSwError = 1; |ACABA; |FINSI;

   nSwPrimero = 0;
   enModelo = 332;
   |BUCLE eosma3VV;

   |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO PasaModelo309EOS;
    |SI #900#2 < 80;
        enEjer = 2000 + #900#2;
    |SINO;
        enEjer = 1900 + #900#2;
    |FINSI;
    |SI enEjer < nDEjercic; |O enEjer > nHEjercic;  |ACABA;  |FINSI;

    nCodigoNue = 0;
    nCodigo    = #900#0;
    |HAZ CogeCodEos;
    |SI nCodigoNue = 0;  |ACABA;  |FINSI;

    enEmpresa = nCodigoNue;
    enModelo  = 309;
    enComplem = 00;

    |HAZ BorraAntesEOS;

    |SI #900#3 = 1;  enPeriodo = 3; |FINSI;
    |SI #900#3 = 2;  enPeriodo = 6; |FINSI;
    |SI #900#3 = 3;  enPeriodo = 9; |FINSI;
    |SI #900#3 = 4;  enPeriodo = 12;|FINSI;

    fFecha      = #900#4;       ||Fecha Impresion

    enCas21     = (#900#50 / enConversor) ! EURODBMOD;
|SI nNumCampos > 51;
    enCas27     = (#900#55 / enConversor) ! EURODBMOD;
    enCas31     = 0;
    enCas34     = (#900#56 / enConversor) ! EURODBMOD;
    enResultado = (#900#56 / enConversor) ! EURODBMOD;
    enImpReal   = (#900#56 / enConversor) ! EURODBMOD;
|SINO;
    enCas27     = 0;
    enCas31     = 0;
    enCas34     = (#900#50 / enConversor) ! EURODBMOD;
    enResultado = (#900#50 / enConversor) ! EURODBMOD;
    enImpReal   = (#900#50 / enConversor) ! EURODBMOD;
|FINSI;

    enCompensar = 0;
    |SI enResultado < 0;
        enDevolver = -enResultado;
        enIngresar = 0;
    |SINO;
        enDevolver = 0;
        enIngresar = enResultado;
    |FINSI;
    |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE eosm0015;
     #900#1005;
     ;
     nDEmpresa, 1, 00, 00," ";
     nHEmpresa, 9, 99, 99,"z";
     ;
     NULL, PasaModelo309EOS;
|FIN;

|PROCESO Paso309E;

   aNomDef = "eosm0015.mas";
   |HAZ Carga_Eos;  |SI nSwError = 1; |ACABA; |FINSI;

   nSwPrimero = 0;
   |BUCLE eosm0015;

   |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO PasaModelo123EOS;
    enEjer = #900#1;

    nCodigoNue = 0;
    nCodigo    = #900#0;
    |HAZ CogeCodEos;
    |SI nCodigoNue = 0;  |ACABA;  |FINSI;

    enEmpresa = nCodigoNue;
    enModelo  = 123;
    enComplem = 00;

    |HAZ BorraAntesEOS;

    enPeriodo = #900#2;

    fFecha      = #900#28;       ||Fecha Impresion
    enResultado = (#900#26 / enConversor) ! EURODBMOD;
    enImpReal   = (#900#26 / enConversor) ! EURODBMOD;
    enCompensar  = 0;
    |SI enResultado < 0;
        enDevolver = -enResultado;
        enIngresar = 0;
    |SINO;
        enDevolver = 0;
        enIngresar = enResultado;
    |FINSI;
    |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE eosma123;
     #900#1003;
     ;
     nDEmpresa, nDEjercic, 00;
     nHEmpresa, nHEjercic, 99;
     ;
     NULL, PasaModelo123EOS;
|FIN;

|PROCESO Paso123E;

   aNomDef = "eosma123.mas";
   |HAZ Carga_Eos;  |SI nSwError = 1; |ACABA; |FINSI;

   nSwPrimero = 0;
   |BUCLE eosma123;

   |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO PasaModelo130EOS;
    |SI #900#3 < 80;
        enEjer = 2000 + #900#3;
    |SINO;
        enEjer = 1900 + #900#3;
    |FINSI;
    |SI enEjer < nDEjercic; |O enEjer > nHEjercic;  |ACABA;  |FINSI;

    nCodigoNue = 0;
    nCodigo    = #900#0;
    |HAZ CogeCodEos;
    |SI nCodigoNue = 0;  |ACABA;  |FINSI;

    enEmpresa = nCodigoNue;
    enModelo  = 130;
    enComplem = 00;

    |HAZ BorraAntesEOS;

    |SI #900#2 = 1;  enPeriodo = 3; |FINSI;
    |SI #900#2 = 2;  enPeriodo = 6; |FINSI;
    |SI #900#2 = 3;  enPeriodo = 9; |FINSI;
    |SI #900#2 = 4;  enPeriodo = 12;|FINSI;

    fFecha      = #900#4;       ||Fecha Impresion
    |SI enEjer < 2008;
        enResultado = (#900#29 / enConversor) ! EURODBMOD;
        enImpReal   = (#900#29 / enConversor) ! EURODBMOD;
    |SINO;
        |SI enEjer = 2008; |Y #900#2 = 1;
            enResultado = (#900#29 / enConversor) ! EURODBMOD;
            enImpReal   = (#900#29 / enConversor) ! EURODBMOD;
        |SINO;
            enResultado = (#900#46 / enConversor) ! EURODBMOD;
            enImpReal   = (#900#46 / enConversor) ! EURODBMOD;
        |FINSI;
    |FINSI;

    enCompensar = 0;
    |SI enResultado < 0;
        enDevolver = -enResultado;
        enIngresar = 0;
    |SINO;
        enDevolver = 0;
        enIngresar = enResultado;
    |FINSI;
    |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE eosm3130;
     #900#1004;
     ;
     nDEmpresa, 1, 00, 00;
     nHEmpresa, 9, 99, 99;
     ;
     NULL, PasaModelo130EOS;
|FIN;

|PROCESO Paso130E;

   aNomDef = "eosm3130.mas";
   |HAZ Carga_Eos;  |SI nSwError = 1; |ACABA; |FINSI;

   nSwPrimero = 0;
   |BUCLE eosm3130;

   |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO PasaModelo303EOS;
    |SI #900#2 < 80;
        enEjer = 2000 + #900#2;
    |SINO;
        enEjer = 1900 + #900#2;
    |FINSI;
    |SI enEjer < nDEjercic; |O enEjer > nHEjercic;  |ACABA;  |FINSI;

    nCodigoNue = 0;
    nCodigo    = #900#0;
    |HAZ CogeCodEos;
    |SI nCodigoNue = 0;  |ACABA;  |FINSI;

    enEmpresa = nCodigoNue;
    enModelo  = 303;
    enComplem = 00;

    |HAZ BorraAntesEOS;

    |DDEFECTO #903;
    #903#0 = #900#0;
    #903#1 = #900#45;  || Actividad
    #903#2 = #900#2;   || Ejercicio
    |LEE 041#903=;

    |SI #903#26 = "D"; |O #903#26 = "M";
        enPeriodo = #900#1;
    |SINO;
        |SI #900#1 = 1;  enPeriodo = 3; |FINSI;
        |SI #900#1 = 2;  enPeriodo = 6; |FINSI;
        |SI #900#1 = 3;  enPeriodo = 9; |FINSI;
        |SI #900#1 = 4;  enPeriodo = 12;|FINSI;
    |FINSI;

    fFecha      = #900#3;        ||Fecha Impresion

    enIngresar  = (#900#33 / enConversor) ! EURODBMOD;
    enCompensar = (#900#32 / enConversor) ! EURODBMOD;
    enDevolver  = (#900#31 / enConversor) ! EURODBMOD;
    |SI enIngresar ! 0;
        enResultado = enIngresar;
    |SINO;
       |SI enDevolver ! 0;
           enResultado = -enDevolver;
       |SINO;
           enResultado = -enCompensar;
       |FINSI;
   |FINSI;

   enImpReal = (#900#26 / enConversor) ! EURODBMOD;   || Antes de Compensar
   enCas21   = (#900#20 / enConversor) ! EURODBMOD;
   enCas27   = (#900#25 / enConversor) ! EURODBMOD;
   enCas31   = (#900#29 / enConversor) ! EURODBMOD;
   enCas34   = enResultado;

   |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE eosm1303;
     #900#1004;
     ;
     nDEmpresa, 1, 00, 00;
     nHEmpresa, 9, 99, 99;
     ;
     NULL, PasaModelo303EOS;
|FIN;

|PROCESO Paso303E;

   aNomDef = "eosm1303.mas";
   |HAZ Carga_Eos;  |SI nSwError = 1; |ACABA; |FINSI;

   nSwPrimero = 0;
   |BUCLE eosm1303;

   |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO PasaModelo300EOS;
    |SI #900#2 < 80;
        enEjer = 2000 + #900#2;
    |SINO;
        enEjer = 1900 + #900#2;
    |FINSI;
    |SI enEjer < nDEjercic; |O enEjer > nHEjercic;  |ACABA;  |FINSI;

    nCodigoNue = 0;
    nCodigo    = #900#0;
    |HAZ CogeCodEos;
    |SI nCodigoNue = 0;  |ACABA;  |FINSI;

    enEmpresa = nCodigoNue;
    enModelo  = 300;
    enComplem = 00;

    |HAZ BorraAntesEOS;

    |SI #900#1 = 1;  enPeriodo = 3; |FINSI;
    |SI #900#1 = 2;  enPeriodo = 6; |FINSI;
    |SI #900#1 = 3;  enPeriodo = 9; |FINSI;
    |SI #900#1 = 4;  enPeriodo = 12;|FINSI;

    fFecha      = #900#3;        ||Fecha Impresion

    enIngresar  = (#900#33 / enConversor) ! EURODBMOD;
    enCompensar = (#900#32 / enConversor) ! EURODBMOD;
    enDevolver  = (#900#31 / enConversor) ! EURODBMOD;
    |SI enIngresar ! 0;
        enResultado = enIngresar;
    |SINO;
       |SI enDevolver ! 0;
           enResultado = -enDevolver;
       |SINO;
           enResultado = -enCompensar;
       |FINSI;
   |FINSI;

   enImpReal = (#900#26 / enConversor) ! EURODBMOD;   || Antes de Compensar
   enCas21   = (#900#20 / enConversor) ! EURODBMOD;
   enCas27   = (#900#25 / enConversor) ! EURODBMOD;
   enCas31   = (#900#29 / enConversor) ! EURODBMOD;
   enCas34   = enResultado;

   |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE eosm1300;
     #900#1004;
     ;
     nDEmpresa, 1, 00, 00;
     nHEmpresa, 9, 99, 99;
     ;
     NULL, PasaModelo300EOS;
|FIN;

|PROCESO PasaModelo310EOS;
    |SI #900#1 < 80;
        enEjer = 2000 + #900#1;
    |SINO;
        enEjer = 1900 + #900#1;
    |FINSI;
    |SI enEjer < nDEjercic; |O enEjer > nHEjercic;  |ACABA;  |FINSI;

    nCodigoNue = 0;
    nCodigo    = #900#0;
    |HAZ CogeCodEos;
    |SI nCodigoNue = 0;  |ACABA;  |FINSI;

    enEmpresa = nCodigoNue;
    enModelo  = 310;
    enComplem = 00;

    |HAZ BorraAntesEOS;

    |SI #900#2 = 1;  enPeriodo = 3; |FINSI;
    |SI #900#2 = 2;  enPeriodo = 6; |FINSI;
    |SI #900#2 = 3;  enPeriodo = 9; |FINSI;
    |SI #900#2 = 4;  enPeriodo = 12;|FINSI;

    fFecha      = #900#3;        ||Fecha Impresion
    enIngresar  = (#900#40 / enConversor) ! EURODBMOD;
    enCompensar = (#900#41 / enConversor) ! EURODBMOD;
    enDevolver  = (#900#42 / enConversor) ! EURODBMOD;
    |SI enIngresar ! 0;
        enResultado = enIngresar;
    |SINO;
       |SI enDevolver ! 0;
           enResultado = -enDevolver;
       |SINO;
           enResultado = -enCompensar;
       |FINSI;
   |FINSI;
   enImpReal   = (#900#36 / enConversor) ! EURODBMOD;   || Antes de Compensar
   enCas21     = (#900#30 / enConversor) ! EURODBMOD;
   enCas27     = (#900#46 / enConversor) ! EURODBMOD;
   enCas31     = (#900#37 / enConversor) ! EURODBMOD;
   enCas34     = (#900#38 / enConversor) ! EURODBMOD;
   |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE eosm0019;
     #900#1003;
     ;
     nDEmpresa, 00, 00;
     nHEmpresa, 99, 99;
     ;
     NULL, PasaModelo310EOS;
|FIN;

|PROCESO Paso300E;

   aNomDef = "eosm1300.mas";
   |HAZ Carga_Eos;  |SI nSwError = 1; |ACABA; |FINSI;

   nSwPrimero = 0;
   |BUCLE eosm1300;

   |DESCARGA_DEF #refer00@;

|| --------------------------------------------- Modelo 310/311
   aNomDef = "eosm0019.mas";
   |HAZ Carga_Eos;  |SI nSwError = 1; |ACABA; |FINSI;

   nSwPrimero = 0;
   |BUCLE eosm0019;

   |DESCARGA_DEF #refer00@;
|FPRC;


|PROCESO PaseREOS;
   |ATRI P;
   |PINTA 2203, "REALIZANDO PASE DESDE REOS ... ";
   |ATRI 0;

   |DBASS aDef;  |QBF aDef;                  ||Lee la moneda para
   aDef = aDef + "agitool/def/zmonedas.mas"; ||todos los modelos.
   |CARGA_DEF aDef, refer00@;
   |SI FSalida ! 0;
       eaMonedaOtra = "E";
   |SINO;
       |PATH_DAT #900 aPathFichFiscal;
       |ABRE #900;
       |LEE 040#900p;
       |SI FSalida ! 0;  |DDEFECTO #900; #900#1 = "E";  |FINSI;
       |CIERRA #900;

       eaMonedaOtra = #900#1;
       |DESCARGA_DEF #refer00@;
   |FINSI;

   enLeerCamoneda = 1;
   |HAZ EnConversor;

   aDef = aPathDefFiscal + "eosclien.mas";
   |CARGA_DEF aDef, refer02@;
   |SI FSalida ! 0;
       aAlfa1 = "     Error en Cargar el Def fichero de Empresas";
       |MENAV aAlfa1;
       |ACABA;
   |SINO;
       |PATH_DAT #902 aPathFichFiscal;
       aDef = aPathDefFiscal + "eosactiv.mas";
       |CARGA_DEF aDef, refer03@;
       |SI FSalida ! 0;
           aAlfa1 = "     Error en Cargar el Def fichero de Actividades";
           |MENAV aAlfa1;
           |DESCARGA_DEF #refer02@;
           |ACABA;
       |SINO;
           |PATH_DAT #903 aPathFichFiscal;
      |FINSI;
  |FINSI;

  |ABRE #902;
  |ABRE #903;
  nDEmpresa = 00001;
  nHEmpresa = 99999;
  |HAZ Paso300E;
  |HAZ Paso303E;
  |HAZ Paso130E;
  |HAZ Paso123E;
  |HAZ Paso309E;
  |HAZ Paso3VVE;  || 320, 330, 332
  |HAZ Paso131E;
  |HAZ Paso11VE;  || 110, 115

  |CIERRA #903;
  |CIERRA #902;
  |DESCARGA_DEF #903;
  |DESCARGA_DEF #902;
|FPRC;

|| -------------------------------------------------------
|PROCESO Carga_Eos;
   nSwError = 0;
   aDef = aPathDefFiscal + aNomDef;
   |CARGA_DEF aDef, refer00@;
   |SI FSalida ! 0;
       aAlfa1 = "     Error en Cargar el Def " + aNomDef;
       |MENAV aAlfa1;
       nSwError = 1;
   |SINO;
       |PATH_DAT #900 aPathFichFiscal;

       aQueQuiero = "|NC";
       aNumCampos = #refer00@#aQueQuiero#;
       nNumCampos = aNumCampos;
       nNumCampos = nNumCampos - 1;
   |FINSI;
|FPRC;

|| //////////////////////////////////////////////////////////////////////
|| //////////////////////////////////////////////////////////////////////
|PROCESO m110C;
 |SI nSwHayRegistro  = 0;
     nSwHayRegistro  = 1;
     |SI #0#16 ! 5; |HAZ BorraAntes; |FINSI;
 |FINSI;

 |PARA enPeriodo = 1; |SI enPeriodo [ 12; |HACIENDO enPeriodo = enPeriodo + 1;

       |HAZ calculoFecha;

       nNume1 = 35 + enPeriodo;
       nNume2 = 61 + enPeriodo;
       nNume3 = 87 + enPeriodo;

       enResultado = ((#901nNume1 / enConversor) ! EURODBMOD) + ((#901nNume2 / enConversor) ! EURODBMOD) + ((#901nNume3 / enConversor) ! EURODBMOD);
       enImpReal   = enResultado;
       enIngresar  = enResultado;
       enCompensar = 0;
       enDevolver  = 0;
       |HAZ GrabaResumen;
 |SIGUE;
|FPRC;

|DEFBUCLE m110C;
 #901#1003;
 ;
 nCodigo, 00001, #900#26;
 nCodigo, 99999, #900#26;
 ;
 NULL, m110C;
|FIN;

|PROCESO Paso110C;
 aDef = aPathDefAgicont + "caman110.mas";  ||Si no existe Resumen no se ha impreso
 |CARGA_DEF aDef, refer01@;
 |SI FSalida ! 0;
     |ACABA;
 |FINSI;

 nSwHayRegistro = 0;
 |PATH_DAT #901 aPathFichAgicont;
 |BUCLE m110C;

 |DESCARGA_DEF #refer01@;
|FPRC;


|PROCESO m115C;
 |SI nSwHayRegistro  = 0;
     nSwHayRegistro  = 1;
     |SI #0#16 ! 5; |HAZ BorraAntes; |FINSI;
 |FINSI;

 |PARA enPeriodo = 1; |SI enPeriodo [ 12; |HACIENDO enPeriodo = enPeriodo + 1;

       nNume1 = 75 + enPeriodo;
       fFecha = #901nNume1;      ||Fecha Impresion

       nNume1 = 27 + enPeriodo;
       nNume2 = 63 + enPeriodo;

       enResultado = ((#901nNume1 / enConversor) ! EURODBMOD) + ((#901nNume2 / enConversor) ! EURODBMOD);
       enImpReal   = enResultado;
       enIngresar  = enResultado;
       enCompensar = 0;
       enDevolver  = 0;
       |HAZ GrabaResumen;
 |SIGUE;

|FPRC;

|PROCESO Paso115C;
 aDef = aPathDefAgicont + "camar115.mas";  ||Si no existe Resumen no se ha impreso
 |CARGA_DEF aDef, refer01@;
 |SI FSalida ! 0;
     |ACABA;
 |FINSI;

 nSwHayRegistro = 0;
 |PATH_DAT #901 aPathFichAgicont;
 |ABRE #901;
 #901#0 = nCodigo;
 #901#2 = #900#26;
 |LEE 001#901=;
 |SI FSalida = 0;
     |HAZ m115C;
 |FINSI;
 |CIERRA #901;

 |DESCARGA_DEF #refer01@;
|FPRC;

|PROCESO m300C;
 |SI nSwHayRegistro  = 0;
     nSwHayRegistro  = 1;
     |SI #0#16 ! 5; |HAZ BorraAntes; |FINSI;
 |FINSI;

 |SI #901#45 = "T";
     |SI #901#1 = 1; enPeriodo = 3; |FINSI;
     |SI #901#1 = 2; enPeriodo = 6; |FINSI;
     |SI #901#1 = 3; enPeriodo = 9; |FINSI;
     |SI #901#1 = 4; enPeriodo = 12; |FINSI;
 |SINO;
     |SI #901#45 = "A";
         enPeriodo = 99;
     |SINO;
         enPeriodo = #901#1;
     |FINSI;
 |FINSI;

 fFecha = #901#3;        ||Fecha Impresion
 enIngresar  = (#901#33 / enConversor) ! EURODBMOD;
 enDevolver  = (#901#31 / enConversor) ! EURODBMOD;
 enCompensar = (#901#32 / enConversor) ! EURODBMOD;
 |SI enIngresar ! 0;
     enResultado = enIngresar;
 |SINO;
     |SI enDevolver ! 0;
         enResultado = -enDevolver;
     |SINO;
         enResultado = -enCompensar;
     |FINSI;
 |FINSI;
 enImpReal   = (#901#26 / enConversor) ! EURODBMOD;   || Antes de Compensar
   enCas21   = (#901#20 / enConversor) ! EURODBMOD;
   enCas27   = (#901#25 / enConversor) ! EURODBMOD;
   enCas31   = (#901#29 / enConversor) ! EURODBMOD;
   enCas34   = enResultado;
 |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE m300C;
 #901#1003;
 ;
 " ",00,#900#26;
 "z",99,#900#26;
 ;
 NULL, m300C;
|FIN;

|PROCESO Paso300C;
 aDef = aPathDefAgicont + "caman300.mas";
 |CARGA_DEF aDef, refer01@;
 |SI FSalida ! 0;
     |ACABA;
 |FINSI;

 nSwHayRegistro = 0;
 |PATH_DAT #901 aPathFichAgicont;
 |BUCLE m300C;

 |DESCARGA_DEF #refer01@;
|FPRC;

|PROCESO m303C;
 |SI nSwHayRegistro  = 0;
     nSwHayRegistro  = 1;
     |SI #0#16 ! 5; |HAZ BorraAntes; |FINSI;
 |FINSI;

 |SI #901#45 = "T";
     |SI #901#1 = 1; enPeriodo = 3; |FINSI;
     |SI #901#1 = 2; enPeriodo = 6; |FINSI;
     |SI #901#1 = 3; enPeriodo = 9; |FINSI;
     |SI #901#1 = 4; enPeriodo = 12; |FINSI;
 |SINO;
     |SI #901#45 = "A";
         enPeriodo = 99;
     |SINO;
         enPeriodo = #901#1;
     |FINSI;
 |FINSI;

 fFecha = #901#3;        ||Fecha Impresion
 enIngresar  = (#901#33 / enConversor) ! EURODBMOD;
 enDevolver  = (#901#31 / enConversor) ! EURODBMOD;
 enCompensar = (#901#32 / enConversor) ! EURODBMOD;
 |SI enIngresar ! 0;
     enResultado = enIngresar;
 |SINO;
     |SI enDevolver ! 0;
         enResultado = -enDevolver;
     |SINO;
         enResultado = -enCompensar;
     |FINSI;
 |FINSI;
 enImpReal   = (#901#26 / enConversor) ! EURODBMOD;   || Antes de Compensar
   enCas21   = (#901#20 / enConversor) ! EURODBMOD;
   enCas27   = (#901#25 / enConversor) ! EURODBMOD;
   enCas31   = (#901#29 / enConversor) ! EURODBMOD;
   enCas34   = enResultado;
 |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE m303C;
 #901#1003;
 ;
 " ",00,#900#26;
 "z",99,#900#26;
 ;
 NULL, m300C;
|FIN;

|PROCESO Paso303C;
 aDef = aPathDefAgicont + "caman303.mas";
 |CARGA_DEF aDef, refer01@;
 |SI FSalida ! 0;
     |ACABA;
 |FINSI;

 nSwHayRegistro = 0;
 |PATH_DAT #901 aPathFichAgicont;
 |BUCLE m303C;

 |DESCARGA_DEF #refer01@;
|FPRC;


|PROCESO m130C;
 |SI nSwHayRegistro  = 0;
     nSwHayRegistro  = 1;
     |SI #0#16 ! 5; |HAZ BorraAntes; |FINSI;
 |FINSI;

 |SI #901#2 = 1; enPeriodo = 3; |FINSI;
 |SI #901#2 = 2; enPeriodo = 6; |FINSI;
 |SI #901#2 = 3; enPeriodo = 9; |FINSI;
 |SI #901#2 = 4; enPeriodo = 12; |FINSI;

 fFecha = #901#4;        ||Fecha Impresion
 |SI enEjer < 2008;
     enResultado = (#901#29 / enConversor) ! EURODBMOD;
     enImpReal   = (#901#29 / enConversor) ! EURODBMOD;
 |SINO;
     |SI enEjer = 2008; |Y #901#2 = 1;
         enResultado = (#901#29 / enConversor) ! EURODBMOD;
         enImpReal   = (#901#29 / enConversor) ! EURODBMOD;
     |SINO;
         enResultado = (#901#46 / enConversor) ! EURODBMOD;
         enImpReal   = (#901#46 / enConversor) ! EURODBMOD;
     |FINSI;
 |FINSI;
 enCompensar = 0;
 |SI enResultado < 0;
     enDevolver = -enResultado;
     enIngresar = 0;
 |SINO;
     enDevolver = 0;
     enIngresar = enResultado;
 |FINSI;
 |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE m130C;
 #901#1004;
 ;
 00000,0,01,00;
 99999,9,04,99;
 ;
 NULL, m130C;
|FIN;

|PROCESO Paso130C;
 aDef = aPathDefAgicont + "caman130.mas";
 |CARGA_DEF aDef, refer01@;
 |SI FSalida ! 0;
     |ACABA;
 |FINSI;

 nSwHayRegistro = 0;
 |PATH_DAT #901 aPathFichAgicont;
 |BUCLE m130C;

 |DESCARGA_DEF #refer01@;
|FPRC;

|PROCESO ModelosConta;
    |SI #900#26 < 80;
        enEjer = 2000 + #900#26;
    |SINO;
        enEjer = 1900 + #900#26;
    |FINSI;
    |SI enEjer < nDEjercic; |O enEjer > nHEjercic;  |ACABA;  |FINSI;

    nCodigoNue = 0;
    nCodigo = #900#2;
    aNom    = #900#1; |QBT aNom;
    aNif    = #900#8; |QBF aNif;
    |HAZ CogeCodigo;
    |SI nCodigoNue = 0;  |ACABA;  |FINSI;

    eaMonedaOtra = "E";
    |SI aDef03 ! "";
        #903#0 = #900#2;
        #903#1 = #900#3;
        |LEE 040#903=;
        |SI FSalida ! 0;
            #903#2 = "E";
        |FINSI;
        eaMonedaOtra = #903#2;
   |FINSI;

    aPathFichAgicont = aPathAnterior + "agicont/fich/" + (("00000" + #900#2) % -105) + #900#3 + "/";

    enLeerCamoneda = 1;
    |HAZ EnConversor;

    enEmpresa = nCodigoNue;
    enComplem = 00;

    enModelo  = 130; |HAZ Paso130C;
    enModelo  = 300; |HAZ Paso300C;
    enModelo  = 115; |HAZ Paso115C;
    enModelo  = 110; |HAZ Paso110C;
    enModelo  = 303; |HAZ Paso303C;
|FPRC;

|DEFBUCLE canempre;
     #900#1002;
     ;
     nDEmpresa, 0;
     nHEmpresa, 9;
     ;
     NULL, ModelosConta;
|FIN;

|PROCESO PaseConta;
   |ATRI P;
   |PINTA 2203, "REALIZANDO PASE DESDE CONTABILIDAD ... ";
   |ATRI 0;

  aDef = aPathDefAgicont + "canempre.mas";
  |CARGA_DEF aDef, refer00@;
  |SI FSalida ! 0;
      |MENAV "     Error en Cargar el Def canempre.mas";
      |ACABA;
  |FINSI;

  aDef03 = aPathDefAgicont + "camoneda.mas";
  |CARGA_DEF aDef03, refer03@;
  |SI FSalida ! 0;
      aDef03 = "";
  |SINO;
      aPath = aPathAnterior + "agicont/fich/000000/";
      |PATH_DAT #903 aPath;
      |ABRE #903;
  |FINSI;

  |PATH_DAT #900 aPathFichAgicont;

  nDEmpresa = 00001;
  nHEmpresa = 99999;
  |BUCLE canempre;

  |SI aDef03 ! ""; |CIERRA #903; |DESCARGA_DEF #refer03@; aDef03 = ""; |FINSI;
  |DESCARGA_DEF #refer00@;
|FPRC;

||///////////////////////////////////////////////////////////////////////
|| //////////////////////////////////////////////////////////////////////

|PROCESO PasaMod98VLab;
    enEjer = #901#1;

    |SI nSwHayRegistro  = 0;
        nSwHayRegistro  = 1;
        |SI #0#16 ! 5; |HAZ BorraAntesLaboral; |FINSI;
    |FINSI;

    enComplem = 00;
    |PARA nNume4 = 1; |SI nNume1 [ 12; |HACIENDO nNume4 = nNume4 + 1;
          enPeriodo = nNume4;
          |SI aTPeriodo = "T";
              |SI nNume4 [ 3;                enPeriodo = 3;  |FINSI;
              |SI nNume4 ] 4; |Y nNume4 [ 6; enPeriodo = 6;  |FINSI;
              |SI nNume4 ] 7; |Y nNume4 [ 9; enPeriodo = 9;  |FINSI;
              |SI nNume4 ] 10;               enPeriodo = 12; |FINSI;
          |FINSI;
          |HAZ calculoFecha;
          nNume1 = nNume4 + 113;
          enResultado = (#901nNume1 / enConversor) ! EURODBMOD;
          enImpReal   = enResultado;
          enIngresar  = enResultado;
          enDevolver  = 0;
          enCompensar = 0;
          |HAZ GrabaResumen;
    |SIGUE;

|FPRC;

|DEFBUCLE nomhempr;
     #901#1002;
     ;
     nCodigo, nDEjerL;
     nCodigo, nHEjerL;
     ;
     NULL, PasaMod98VLab;
|FIN;

|PROCESO PasaModelo11VLab;
    enEjer = #901#1;

    |SI nSwHayRegistro  = 0;
        nSwHayRegistro  = 1;
        |SI #0#16 ! 5; |HAZ BorraAntesLaboral; |FINSI;
    |FINSI;

    enComplem = #901#4;
    enPeriodo = #901#3;

    |SI aTPeriodo = "T";
        |SI #901#3 = 1; enPeriodo = 3; |FINSI;
        |SI #901#3 = 2; enPeriodo = 6; |FINSI;
        |SI #901#3 = 3; enPeriodo = 9; |FINSI;
        |SI #901#3 = 4; enPeriodo = 12; |FINSI;
    |FINSI;
    |HAZ calculoFecha;

    |SI aNomDef = "eosm0033.mas";
        enResultado = (#901#29 / enConversor) ! EURODBMOD;
    |SINO;
        enResultado = (#901#28 / enConversor) ! EURODBMOD;
    |FINSI;
    enImpReal   = enResultado;
    enIngresar  = enResultado;
    enDevolver  = 0;
    enCompensar = 0;
    |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE eosm011VL;
     #901#1005;
     ;
     nCodigo, nDEjerL, "   ", 00, 00;
     nCodigo, nHEjerL, "zzz", 99, 99;
     ;
     NULL, PasaModelo11VLab;
|FIN;

|PROCESO ModelosLaboral;
   |SI #900#28 = 0; |ACABA; |FINSI;
   |SI #900#28 = 3; aTPeriodo = "T"; |FINSI;
   |SI #900#28 = 4; aTPeriodo = "M"; |FINSI;

    nCodigoNue = 0;
    nCodigo = #900#0;
    aNom    = #900#2;  |QBT aNom;
    aNif    = #900#10; |QBF aNif;
    |HAZ CogeCodigo;
    |SI nCodigoNue = 0;  |ACABA;  |FINSI;

    enEmpresa = nCodigoNue;

    nSwHayRegistro = 0;
    enModelo = 110;


|SI nDEjercic < 1999;
    aNomDef = "nomhempr.mas";           || ... hasta 1998
    |HAZ Carga_Laboral;  |SI nSwError = 1; |ACABA; |FINSI;

    nDEjerL = nDEjercic;
    nHEjerL = 1998; |SI nHEjercic < nHEjerL; nHEjerL = nHEjercic; |FINSI;

    |BUCLE nomhempr;

    |DESCARGA_DEF #refer01@;
|FINSI;

    aNomDef = "eosm0033.mas";           || ... Desde 1999 a 2000
    |HAZ Carga_Laboral;  |SI nSwError = 1; |ACABA; |FINSI;

    nDEjerL = nDEjercic;
    nDEjerL = 1998; |SI nDEjercic > nDEjerL; nDEjerL = nDEjercic; |FINSI;
    nHEjerL = 2000; |SI nHEjercic < nHEjerL; nHEjerL = nHEjercic; |FINSI;

    |BUCLE eosm011VL;

    |DESCARGA_DEF #refer01@;

    aNomDef = "eosm0133.mas";           || ... Desde 2001
    |HAZ Carga_Laboral;  |SI nSwError = 1; |ACABA; |FINSI;

    nDEjerL = 2001; |SI nDEjercic > nDEjerL; nDEjerL = nDEjercic; |FINSI;
    nHEjerL = nHEjercic;

    |BUCLE eosm011VL;

    |DESCARGA_DEF #refer01@;
|FPRC;

|DEFBUCLE labempre;
     #900#1001;
     ;
     nDEmpresa;
     nHEmpresa;
     ;
     NULL, ModelosLaboral;
|FIN;

|PROCESO PaseLabor;
   |ATRI P;
   |PINTA 2203, "REALIZANDO PASE DESDE LABORAL ... ";
   |ATRI 0;

   |DBASS aDef;  |QBF aDef;                  ||Lee la moneda para
   aDef = aDef + "agitool/def/zmonedas.mas"; ||todos los modelos.
   |CARGA_DEF aDef, refer00@;
   |SI FSalida ! 0;
       eaMonedaOtra = "P";
   |SINO;
       |PATH_DAT #900 aPathFichLaboral;
       |ABRE #900;
       |LEE 040#900p;
       |SI FSalida ! 0;  |DDEFECTO #900;  #900#1 = "P"; |FINSI;
       |CIERRA #900;

       eaMonedaOtra = #900#1;
       |DESCARGA_DEF #refer00@;
   |FINSI;

   enLeerCamoneda = 1;
   |HAZ EnConversor;

   aDef = aPathDefLaboral + "labempre.mas";
   |CARGA_DEF aDef, refer00@;
   |SI FSalida ! 0;
       |MENAV "     Error en Cargar el Def labempre.mas";
       |ACABA;
   |FINSI;

   |PATH_DAT #900 aPathFichLaboral;
   nDEmpresa = 00001;
   nHEmpresa = 99999;
   |BUCLE labempre;
   |DESCARGA_DEF #refer00@;
|FPRC;

|| -------------------------------------------------------
|PROCESO Carga_Laboral;
   nSwError = 0;
   aDef = aPathDefLaboral + aNomDef;
   |CARGA_DEF aDef, refer01@;
   |SI FSalida ! 0;
       aAlfa1 = "     Error en Cargar el Def " + aNomDef;
||        |MENAV aAlfa1;
       nSwError = 1;
   |SINO;
       |PATH_DAT #901 aPathFichLaboral;
   |FINSI;
|FPRC;

||///////////////////////////////////////////////////////////////////////
|| //////////////////////////////////////////////////////////////////////
|PROCESO PasaModelo202S;
    enComplem = 00;

    enPeriodo = "03";
    |HAZ calculoFecha;
    enResultado = ( (#901#6 + #901#24) / enConversor) ! EURODBMOD;
    enImpReal   = enResultado;
    enIngresar  = enResultado;
    enDevolver  = 0;
    enCompensar = 0;
    |HAZ GrabaResumen;

    enPeriodo = "09";
    |HAZ calculoFecha;
    enResultado = ( (#901#7 + #901#25) / enConversor) ! EURODBMOD;
    enImpReal   = enResultado;
    enIngresar  = enResultado;
    enDevolver  = 0;
    enCompensar = 0;
    |HAZ GrabaResumen;

    enPeriodo = "12";
    |HAZ calculoFecha;
    enResultado = ( (#901#8 + #901#26) / enConversor) ! EURODBMOD;
    enImpReal   = enResultado;
    enIngresar  = enResultado;
    enDevolver  = 0;
    enCompensar = 0;
    |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE isocie29S;
     #901#1002;
     ;
     nCodigo, enEjer;
     nCodigo, enEjer;
     ;
     NULL, PasaModelo202S;
|FIN;

|PROCESO Pasaisacceso;
    enComplem = 00;
    enPeriodo = "99";
    |HAZ calculoFecha;
    |ABRE #901;
    #901#0 = nCodigo;
    #901#1 = enEjer;
    |LEE 001#901=;
    |SI FSalida = 0;
        enResultado = 0;
        enImpReal   = 0;
        enIngresar  = 0;
        enDevolver  = 0;
        enCompensar = 0;
        |SI #901#8 > 0;
            enResultado = (#901#8 / enConversor) ! EURODBMOD;
            enIngresar  = enResultado;
            enDevolver  = 0;
       |SINO;
           |SI #901#8 < 0;
               enResultado = (#901#8 / enConversor) ! EURODBMOD;
               enDevolver  = - enResultado;
               enIngresar  = 0;
           |FINSI;
       |FINSI;
       enImpReal = enResultado;
       |HAZ GrabaResumen;
   |FINSI;
   |CIERRA #901;
|FPRC;

|PROCESO PasaModelo200S;
    enComplem = 00;
    enPeriodo = "99";
    |HAZ calculoFecha;

    enResultado = 0;
    enImpReal   = 0;
    enIngresar  = 0;
    enDevolver  = 0;
    enCompensar = 0;
    |SI #901#105 > 0;
        enResultado = (#901#105 / enConversor) ! EURODBMOD;
        enIngresar  = enResultado;
        enDevolver  = 0;
    |SINO;
        |SI #901#105 < 0;
            enResultado = (#901#105 / enConversor) ! EURODBMOD;
            enDevolver  = - enResultado;
            enIngresar  = 0;
        |FINSI;
    |FINSI;
    |SI #901#106 ! 0;
        enResultado = (#901#106 / enConversor) ! EURODBMOD;
        enDevolver  = enResultado;
        enIngresar  = 0;
        enResultado = - enResultado;
    |FINSI;
    enImpReal = enResultado;
    |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE isocie59S;
     #901#1002;
     ;
     nCodigo, enEjer;
     nCodigo, enEjer;
     ;
     NULL, PasaModelo200S;
|FIN;

|PROCESO ModelosSociedad;

    nCodigoNue = 0;
    nCodigo = #900#0;
    aNom    = #900#2; |QBT aNom;
    aNif    = #900#3; |QBF aNif;
    |HAZ CogeCodigo;
    |SI nCodigoNue = 0;  |ACABA;  |FINSI;

    enEmpresa = nCodigoNue;
    enEjer    = #900#1;
    enModelo = 200; || Esperar modelo 201 |SI #900#18 = "A"; enModelo = 201; |FINSI;
    |SI #0#16 ! 5; |HAZ BorraAntes; |FINSI;

    |SI enEjer < 2008;
        aNomDef = "isocie59.mas";
        |HAZ Carga_Sociedad;  |SI nSwError = 1; |ACABA; |FINSI;

        |BUCLE isocie59S;
        |DESCARGA_DEF #refer01@;
    |SINO;
        aNomDef = "isacceso.mas";
        |HAZ Carga_Sociedad;  |SI nSwError = 1; |ACABA; |FINSI;
        |HAZ Pasaisacceso;
        |DESCARGA_DEF #refer01@;
    |FINSI;


    enEmpresa = nCodigoNue;
    enEjer    = #900#1;
    enModelo = 202; || Esperar modelo 201 |SI #900#18 = "A"; enModelo = 201; |FINSI;
    |SI #0#16 ! 5; |HAZ BorraAntes; |FINSI;

    aNomDef = "isocie29.mas";
    |HAZ Carga_Sociedad;  |SI nSwError = 1; |ACABA; |FINSI;

    |BUCLE isocie29S;

    |DESCARGA_DEF #refer01@;
|FPRC;

|DEFBUCLE maacceso;
     #900#1002;
     ;
     nDEmpresa, nDEjercic;
     nHEmpresa, nHEjercic;
     ;
     NULL, ModelosSociedad;
|FIN;

|PROCESO PaseSocie;
   |ATRI P;
   |PINTA 2203, "REALIZANDO PASE DESDE SOCIEDADES ... ";
   |ATRI 0;

   |DBASS aDef;  |QBF aDef;                  ||Lee la moneda para
   aDef = aDef + "agitool/def/zmonedas.mas"; ||todos los modelos.
   |CARGA_DEF aDef, refer00@;
   |SI FSalida ! 0;
       eaMonedaOtra = "P";
   |SINO;
       |PATH_DAT #900 aPathFichSociedad;
       |ABRE #900;
       |LEE 040#900p;
       |SI FSalida ! 0;  |DDEFECTO #900;  #900#1 = "P"; |FINSI;
       |CIERRA #900;

       eaMonedaOtra = #900#1;
       |DESCARGA_DEF #refer00@;
   |FINSI;

   enLeerCamoneda = 1;
   |HAZ EnConversor;

   aDef = aPathDefSociedad + "maempr01.mas";
   |CARGA_DEF aDef, refer00@;
   |SI FSalida ! 0;
       |MENAV "     Error en Cargar el Def maacceso.mas";
       |ACABA;
   |FINSI;

   |PATH_DAT #900 aPathFichSociedad;
    nSwPrimero = 0;
    nDEmpresa = 00001;
    nHEmpresa = 99999;
    |BUCLE maacceso;
    |DESCARGA_DEF #refer00@;
|FPRC;

|| -------------------------------------------------------
|PROCESO Carga_Sociedad;
   nSwError = 0;
   aDef = aPathDefSociedad + aNomDef;
   |CARGA_DEF aDef, refer01@;
   |SI FSalida ! 0;
       aAlfa1 = "     Error en Cargar el Def " + aNomDef;
||        |MENAV aAlfa1;
       nSwError = 1;
   |SINO;
       |PATH_DAT #901 aPathFichSociedad;
   |FINSI;
|FPRC;

|| --------------------------------------------------------------------------
|| --------------------------------------------------------------------------
|CALCULO Tipo3;  |TIPO 3;

  |SI #0#14 < 80;
      nDEjercic = 2000 + #0#14;
  |SINO;
      nDEjercic = 1900 + #0#14;
  |FINSI;
  |SI #0#15 < 80;
      nHEjercic = 2000 + #0#15;
  |SINO;
      nHEjercic = 1900 + #0#15;
  |FINSI;


  |ABRE #24;
  |ABRE #23;
  |SI #0#16 = 1; |O #0#16 = 5; |HAZ PaseREOS;  |FINSI;
  |SI #0#16 = 2; |O #0#16 = 5; |HAZ PaseConta; |FINSI;
  |SI #0#16 = 3; |O #0#16 = 5; |HAZ PaseLabor; |FINSI;
  |SI #0#16 = 4; |O #0#16 = 5; |HAZ PaseSocie; |FINSI;
  |CIERRA #23;
  |CIERRA #24;

  |SI #0#0 ! 0;
      enDEmpresa = #0#0;      enHEmpresa = #0#1;
      enDEjer    = nDEjercic; enHEjer    = nHEjercic;
      enDModelo  = 000;       enHModelo  = 999;
      |HAZ ReCalculaHis;
  |SINO;
      |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
            enDEmpresa = #0nCampo; enHEmpresa = #0nCampo;
            enDEjer    = nDEjercic; enHEjer    = nHEjercic;
            enDModelo  = 000;      enHModelo  = 999;
            |HAZ ReCalculaHis;
      |SIGUE;
  |FINSI;
|FCAL;

|| **************************************************************************
|PROGRAMA;
   |CLS;
   |HAZ SituaAplicacion;
   |SI eaPathBasica   = "";
       |MENAV "    NO EXISTE APLICACION BASICA ";
       enTodo = 0;
       |ACABA;
   |FINSI;

   aAlfa1 = eaPathBasica + "fich/";
   |PATH_DAT #10 aAlfa1;

   |ABRE #10;
   |LEE 040#10p;
   |SI FSalida ! 0;
       |MENAV "     Pase de Ficheros Generales no Realizado";
       |CIERRA #10;
       enTodo = 0;
       |ACABA;
   |FINSI;
   |CIERRA #10;


   aPathAnterior = #10#0;  |QBT aPathAnterior;
   aPathDefFiscal   = aPathAnterior + "agieos/def/";
   aPathFichFiscal  = aPathAnterior + "agieos/fich/";

   aPathDefAgicont  = aPathAnterior + "agicont/def/";
   aPathFichAgicont = aPathAnterior + "agicont/fich/";

   aPathDefLaboral  = aPathAnterior + "aginom/def/";
   aPathFichLaboral = aPathAnterior + "aginom/fich/";

   aPathDefSociedad = aPathAnterior + "sociedad/def/";
   aPathFichSociedad= aPathAnterior + "sociedad/fich/";


   |SI enTodo = 0;
       |PINPA #0#0;
       |PINDA #0#0;
       |ENDATOS #1#0;
   |SINO;
       |DDEFECTO #0;
       #0#16 = enTipPase;
       #0#14 = enAnyPaseD;
       #0#15 = enAnyPaseH;
       |HAZ Tipo3;
   |FINSI;
|FPRO;
