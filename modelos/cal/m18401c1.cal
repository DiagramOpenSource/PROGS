|FICHEROS;
     dsm18401;   || DEF general del modelo

     dsm18406,MANTE;
     dsm18430,MANTE;
     dsm18431,MANTE;

     dsmom004;
     dsmom001;
     dsmom107;
     dsmoc130;
     dsmoc131;
     dsmom018;
     dsmom012;
     dsmom013;
     dsmom014;
     dsmom022;
     dsmom033;

     dsmom061;

     :/integral/def/dsam0000;

     :/basica/def/agifigen;
     :/basica/def/agicen14;
     :/basica/def/agicen15;
     :/basica/def/agicen30;

     :/contagen/def/cacuenta;
     :/contagen/def/camaasil;
     :/contagen/def/caexistl;

     dsm18401@;
     dsmoc130@;

     dsmow163;
|FIN;

|VARIABLES;
   aTipo = "";
|FIN;

|INCLUYE m18401va;
|INCLUYE i_variar;

|PROCESO NoSirvePaNa;
     |HAZ ChequeaSituacion;
|FPRC;

|PROCESO DestruyeFicheros;
     |DELINDEX #dsmow163;

     |SELECT #1#dsmom061;
     |CIERRA #dsmom061;

     |SI #dsm18401#57 ! "C";  |ACABA;  |FINSI;

     |ABRE #dsmoc130;  |CIERRA #dsmoc130;  |DELINDEX #dsmoc130;
|FPRC;

|PROCESO BuscoM061;
    |QBF aDCta; aDCta = aDCta + "    ";
    aDCta = aDCta % 0104;

    #dsmom061#6 = enPlan60;
    #dsmom061#0 = "N";
    #dsmom061#1 = aTipo;
    #dsmom061#4 = aDCta;
    #dsmom061#2 = 00;
    |LEE 041#dsmom061.];
    |SI FSalida = 0; |Y #dsmom061#6 = 2008; |Y #dsmom061#0 = "N";
        |Y #dsmom061#4 = aDCta; |Y #dsmom061#1 = "G";

        |SI #dsmom061#2 = 2; |O #dsmom061#2 = 3; |O #dsmom061#2 = 4;
            nSw963 = 4;
        |FINSI;
        |SI #dsmom061#2 = 1;   nSw963 = 5;  |FINSI;
        |SI #dsmom061#2 = 10;  nSw963 = 6;  |FINSI;
        |SI #dsmom061#2 = 9; |O #dsmom061#2 = 14; |O #dsmom061#2 = 15;
           |O #dsmom061#2 = 16; |O #dsmom061#2 = 17; |O #dsmom061#2 = 18;
             nSw963 = 7;
        |FINSI;
        |SI #dsmom061#2 = 5;  nSw963 = 9;   |FINSI;
        |SI #dsmom061#2 = 6;  nSw963 = 10;  |FINSI;
        |SI #dsmom061#2 = 7;  nSw963 = 11;  |FINSI;
        |SI #dsmom061#2 = 8;  nSw963 = 12;  |FINSI;
        |SI #dsmom061#2 = 11; nSw963 = 13;  |FINSI;
        |SI #dsmom061#2 = 12; nSw963 = 14;  |FINSI;
        |SI #dsmom061#2 = 13; nSw963 = 15;  |FINSI;

        SwEsta = 1;
   |FINSI;
|FPRC;

|PROCESO BuscoEnM061;
    SwEsta = 0;
    aAlfa = aCta; |QBF aAlfa; aAlfa = aAlfa + "    ";
    aDCta = aAlfa % 104;
    aTipo = "G";  |HAZ BuscoM061;
    |SI SwEsta = 1; |ACABA; |FINSI;

    aDCta = aAlfa % 103;
    aTipo = "G";  |HAZ BuscoM061;
    |SI SwEsta = 1; |ACABA; |FINSI;

    aDCta = aAlfa % 102;
    aTipo = "G";  |HAZ BuscoM061;
|FPRC;

|PROCESO NuevoAuxiliar;
     nSw963 = 0;
     aAlfa1 = aCta % 101;
     aAlfa2 = aCta % 102;
     aAlfa3 = aCta % 103;

     |SI aAlfa2 = "70"; nSw963 = 8; |FINSI;

     |SI aAlfa2 = "64"; nSw963 = 4; |FINSI;

     |SI aAlfa2 = "60"; |O aAlfa2 = "61"; |O aAlfa2 = "71";
        |O aAlfa3 = "621"; |O aAlfa3 = "622";
          |O aAlfa3 = "623"; |O aAlfa3 = "629";
                        nSw963 = 5;
     |FINSI;
     |SI aAlfa2 = "63"; |O aAlfa2 = "66"; nSw963 = 6; |FINSI;

     |SI aAlfa3 = "620"; |O aAlfa3 = "624";
        |O aAlfa3 = "625"; |O aAlfa3 = "626";
          |O aAlfa3 = "627"; |O aAlfa3 = "628";
            |O aAlfa2 = "65";
            |O aAlfa2 = "67"; |O aAlfa2 = "68";
            |O aAlfa2 = "69";
                        nSw963 = 7;
     |FINSI;

     |SI #dsm18401#1 ] 2019;
         |HAZ BuscoEnM061;
     |FINSI;

     |SI nSw963 = 0; |ACABA; |FINSI;

     #dsmow163#0 = #dsm18401#0;
     #dsmow163#1 = #dsm18401#1;
     #dsmow163#2 = nActividad;
     |LEE 141#dsmow163.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow163;
         #dsmow163#0 = #dsm18401#0;
         #dsmow163#1 = #dsm18401#1;
         #dsmow163#2 = nActividad;
         |GRABA 020#dsmow163.b;
     |FINSI;

     |SI #dsmom014#3 = "-";
         #dsmow163#nSw963# = #dsmow163#nSw963# - nSumaCtas;
     |SINO;
         #dsmow163#nSw963# = #dsmow163#nSw963# + nSumaCtas;
     |FINSI;

     #dsmow163#3 = #dsmow163#4 + #dsmow163#5  + #dsmow163#6  + #dsmow163#7;
     #dsmow163#3 = #dsmow163#3 + #dsmow163#9  + #dsmow163#10 + #dsmow163#11;
     #dsmow163#3 = #dsmow163#3 + #dsmow163#12 + #dsmow163#13 + #dsmow163#14;
     #dsmow163#3 = #dsmow163#3 + #dsmow163#15;
     |GRABA 020#dsmow163.a;
     |LIBERA #dsmow163;
|FPRC;

|PROCESO LeoDsmom012;
     #dsmom004#0 = #dsmom012#0;
     #dsmom004#1 = #dsmom012#1;
     #dsmom004#2 = #dsmom012#2;
     #dsmom004#3 = 130;
     #dsmom004#4 = #dsmom012#3 + 1;
     |LEE 000#dsmom004.=;
     |SI FSalida = 0;    |ACABA;  |FINSI;

     aCta        = #dsmom012#5;
     nActividad  = #dsmom012#4;
     #dsmom014#3 = #dsmom012#7;
     nSumaCtas   = #dsmom012#8;
     |HAZ NuevoAuxiliar;
|FPRC;

|DEFBUCLE LeoDsmom012;
     #dsmom012#1;
     ;
     #dsm18401#0, #dsm18401#1, nDPer, 00, #agicen14#1, "    ";
     #dsm18401#0, #dsm18401#1, nHPer, 99, #agicen14#1, "zzzz";
     b;
     NULL, LeoDsmom012;
|FIN;

|PROCESO LeoDsmom013;
      #dsmom004#0 = #dsmom013#0;
      #dsmom004#1 = #dsmom013#1;
      #dsmom004#2 = #dsmom013#2;
      #dsmom004#3 = 130;
      #dsmom004#4 = #dsmom013#3 + 1;
      |LEE 000#dsmom004.=;
      |SI FSalida = 0;    |ACABA;  |FINSI;

      aCta        = #dsmom013#5;
      nActividad  = #dsmom013#4;
      #dsmom014#3 = #dsmom013#7;
      nSumaCtas   = #dsmom013#8;
      |HAZ NuevoAuxiliar;
|FPRC;

|DEFBUCLE LeoDsmom013;
     #dsmom013#1;
     ;
     #dsm18401#0, #dsm18401#1, nDPer, 00, #agicen14#1, "    ";
     #dsm18401#0, #dsm18401#1, nHPer, 99, #agicen14#1, "zzzz";
     e;
     NULL, LeoDsmom013;
|FIN;

|PROCESO LeoActivCtas;
     |SI #agicen14#5 > "01.01.0000";
         |SI #agicen14#5 > fHFecha;  |ACABA;  |FINSI;
     |FINSI;

     |SI #agicen14#6 > "01.01.0000";
         |SI #agicen14#6 < fDFecha;  |ACABA; |FINSI; || Baja
     |FINSI;

     nDPer = nPer130;
     nHPer = nPer130;
     |SI #agicen14#15 = "PLANILLAS ";  nDPer = 1;  |FINSI;

     |ABRE #dsmom004;
     |ABRE #dsmow163;
     |BUCLE LeoDsmom012;
     |BUCLE LeoDsmom013;
     |CIERRA #dsmow163;
     |CIERRA #dsmom004;
|FPRC;

|DEFBUCLE LeoActivCtas;
     #agicen14#1;
     ;
     #dsm18401#0, 01;
     #dsm18401#0, 99;
     ;
     NULL, LeoActivCtas;
|FIN;

|PROCESO EspAgricultura;
     |SI nNume1 = 0; |ACABA; |FINSI;
     nNume2    = nSumaCtas;
     nSumaCtas = nNume1;
     |SI #camaasil#28 > "   ";
        |ABRE #dsmom033;
        #dsmom033#0 = #camaasil#28;
        |LEE 041#dsmom033.=;
        |SI FSalida = 0;
            nSumaCtas = (nSumaCtas * #dsmom033#5) ! 2;
        |FINSI;
        |CIERRA #dsmom033;
     |FINSI;
     aCta       = "70";
     nActividad = #dsmoc130#5;
     |HAZ NuevoAuxiliar;

     nSumaCtas = nNume2;
|FPRC;

|PROCESO camaasil;
     |SI nSwRetencion = 1;  |Y #camaasil#0 = 0;
         |ACABA;
     |FINSI;

     nDepar = #camaasil#21;
     |SI nDepar = 0;  nDepar = 1;   |FINSI;
     |SI nDepar ! #dsmoc130#5;
         |ACABA;
     |FINSI;

     nNume3 = 1;
     |SI #dsmom014#2 = "I";
         |SI #camaasil#8 = "D"; nNume3 = -1; |FINSI;
     |SINO;
         |SI #camaasil#8 = "H"; nNume3 = -1; |FINSI;
     |FINSI;

     |SI nSwRetencion = 1;
         nNume3 = 1; |SI #camaasil#8 = "H"; #camaasil#9 = 0; |FINSI;
     |FINSI;

     nNume1 = ((#camaasil#9 * nNume3) / enConversor) ! EURODBMOD;

     nSumaCtas = nSumaCtas + nNume1;

     |SI #dsm18401#1 ] 2018; |Y aTipCta = "I";
         |Y #dsm18406#4 = 3; |Y #dsm18406#5 = 2;
         |HAZ EspAgricultura;
     |FINSI;
|FPRC;

|DEFBUCLE camaasil;
     #camaasil#3;
     0;
     aUno, fFechaIni, 000001, 0001, 00;
     aDos, fFechaFin, 999999, 9999, 98;
     ;
     NULL, camaasil;
|FIN;

|PROCESO caexistl;
     |SI nPasada = 1;
         aUno     = #caexistl#5;
         aUno     = aUno % 104;
         |SI aUno = #dsmom014#0;
             nError = 1;
             |ERROR10;
             |ACABA;
         |FINSI;

         aUno     = #caexistl#8;
         aUno     = aUno % 104;
         |SI aUno = #dsmom014#0;
             nError = 1;
             |ERROR10;
             |ACABA;
         |FINSI;

         |ACABA;
     |FINSI;

     aUno     = #caexistl#2;      ||Planilla Cuentas
     aUno     = aUno % 104;
     #dsmom014#10 = enPlan14;
     #dsmom014#0  = aUno;
     |LEE 000#dsmom014.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;  || Si no existe en la Planilla, sale

     nExisInicio = (#caexistl#11 / enConversor) ! EURODBMOD;
     nExisFinal  = (#caexistl#23 / enConversor) ! EURODBMOD;

     nExini      = nExini + nExisInicio;
     nExfin      = nExfin + nExisFinal;
     nCtExisten  = nExini - nExfin;
     |SI #dsm18401#1 ] 2015;
         aCta       = #dsmom014#5;
         nActividad = #dsmoc130#5;
         nSumaCtas  = nExisInicio - nExisFinal;
         |HAZ NuevoAuxiliar;
    |FINSI;
|FPRC;

|DEFBUCLE caexistl;
     #caexistl#1;
     ;
     #dsmoc130#5, 01;
     #dsmoc130#5, 99;
     ;
     NULL, caexistl;
|FIN;

|PROCESO dsmom014;
     nPasada = 1;
     nError  = 0;
     |BUCLE caexistl;
     |SI nError = 1;  |ACABA;  |FINSI;

     |SI nSwRetencion = 1;
         nSumaCtas = 0;
         aUno = #dsmom022#0;
         aDos = #dsmom022#0;
         |BUCLE camaasil;
         |SI #dsmom022#3 = "-";
             #dsmoc130@#31 = #dsmoc130@#31 - nSumaCtas;
         |SINO;
             #dsmoc130@#31 = #dsmoc130@#31 + nSumaCtas;
         |FINSI;
     |SINO;
         nSumaCtas = 0;
         aUno = #dsmom014#0; |QBF aUno;
         aDos = aUno + "999999999999"; aDos = aDos % A112;
         aUno = aUno + "            "; aUno = aUno % A112;
         |BUCLE camaasil;
         |SI aTipCta = "I";
             |SI #dsmom014#3 = "-";
                 #dsmoc130@#8 = #dsmoc130@#8 - nSumaCtas;
             |SINO;
                 #dsmoc130@#8 = #dsmoc130@#8 + nSumaCtas;
             |FINSI;
         |FINSI;

         |SI aTipCta = "C";
             |SI #dsmom014#3 = "-";
                 #dsmoc130@#11 = #dsmoc130@#11 - nSumaCtas;
             |SINO;
                 #dsmoc130@#11 = #dsmoc130@#11 + nSumaCtas;
             |FINSI;
         |FINSI;

         |SI aTipCta = "G";
             |SI #dsmom014#3 = "-";
                 #dsmoc130@#14 = #dsmoc130@#14 - nSumaCtas;
             |SINO;
                 #dsmoc130@#14 = #dsmoc130@#14 + nSumaCtas;
             |FINSI;
        |FINSI;

        |SI #dsm18401#1 ] 2015;
            |SI aTipCta = "G"; |O aTipCta = "C";
                aCta       = #dsmom014#0;
                nActividad = #dsmoc130#5;
                |HAZ NuevoAuxiliar;
            |FINSI;
        |FINSI;

     |FINSI;
|FPRC;

|DEFBUCLE dsmom014;
     #dsmom014#1;
     2;
     enPlan14, "    ", aTipCta;
     enPlan14, "zzzz", aTipCta;
     ;
     NULL, dsmom014;
|FIN;

|DEFBUCLE dsmom022;
     #dsmom022#1;
     ;
     "            ";
     "zzzzzzzzzzzz";
     ;
     NULL, dsmom014;
|FIN;

|PROCESO dsmom001A;
     |SI #dsmom001#8 > "01.01.0000";
         |SI #dsmom001#8 > fHFecha; |ACABA;  |FINSI;
     |FINSI;

     |SI #dsmom001#9 > "01.01.0000";
         |SI #dsmom001#9 < fDFecha;  |ACABA;  |FINSI;
     |FINSI;

     fFec1 = fDFecha;
     |SI #dsmom001#8 > fDFecha; |Y #dsmom001#8 > "01.01.0000"; fFec1 = #dsmom001#8; |FINSI;

     fFec2 = fHFecha;
     |SI #dsmom001#9 < fHFecha; |Y #dsmom001#9 > "01.01.0000"; fFec2 = #dsmom001#9; |FINSI;
     nDias = (fFec2 - fFec1) + 1;

     aLaX  = "X";
     aAlfa = fFec2; aAlfa = aAlfa % 105;
     |SI aAlfa ! "31.12"; aLaX = " "; |FINSI;

     #agifigen#0 = #dsmom001#3;
     |LEE 000#agifigen.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     #dsmoc130@#0 = #dsmom001#3;
     #dsmoc130@#1 = #dsmoc130#1;
     #dsmoc130@#2 = #dsmoc130#2;
     #dsmoc130@#3 = #dsmoc130#3;
     #dsmoc130@#4 = #dsmoc130#4;
     #dsmoc130@#5 = #dsmom001#4;
     |LEE 101#dsmoc130@.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc130@;
         #dsmoc130@#0 = #dsmom001#3;
         #dsmoc130@#1 = #dsmoc130#1;
         #dsmoc130@#2 = #dsmoc130#2;
         #dsmoc130@#3 = #dsmoc130#3;
         #dsmoc130@#4 = #dsmoc130#4;
         #dsmoc130@#5 = #dsmom001#4;
         |GRABA 020#dsmoc130@.b;
     |FINSI;

     #dsmoc130@#8  = nEl8  % #dsmom001#7;
     #dsmoc130@#11 = nEl11 % #dsmom001#7;
     #dsmoc130@#47 = nEl47 % #dsmom001#7;
     #dsmoc130@#14 = nEl14 % #dsmom001#7;
     #dsmoc130@#21 = nEl21 % #dsmom001#7;
     #dsmoc130@#31 = nEl31 % #dsmom001#7;
     |GRABA 020#dsmoc130@.a;
     |LIBERA #dsmoc130@;
|FPRC;

|DEFBUCLE dsmom001A;
     #dsmom001#1;
     ;
     #dsmoc130#0, #dsmoc130#5, 0001;
     #dsmoc130#0, #dsmoc130#5, 9999;
     ;
     NULL, dsmom001A;
|FIN;

|PROCESO dsmoc130A;
     nHay = 1;

     |ABRE #dsmom004;
     |SI nFicticio = 0;
         #dsmom004#0 = #dsmoc130#0;
         #dsmom004#1 = #dsmoc130#1;
         #dsmom004#2 = #dsmoc130#2;
         #dsmom004#3 = #dsmoc130#3;
         #dsmom004#4 = #dsmoc130#4;
         |LEE 000#dsmom004.=;
         |SI FSalida ! 0;  |CIERRA #dsmom004;   |ACABA;  |FINSI;
     |FINSI;

     #dsmom004#0 = #dsmoc130#0;
     #dsmom004#1 = #dsmoc130#1;
     #dsmom004#2 = #dsmoc130#2;
     #dsmom004#3 = #dsmoc130#3;
     #dsmom004#4 = #dsmoc130#4 + 1;
     |LEE 000#dsmom004.=;
     |SI FSalida = 0;  |CIERRA #dsmom004;  |ACABA;  |FINSI;
     |CIERRA #dsmom004;

     #dsmoc130@#0 = #dsmoc130#0;
     #dsmoc130@#1 = #dsmoc130#1;
     #dsmoc130@#2 = #dsmoc130#2;
     #dsmoc130@#3 = #dsmoc130#3;
     #dsmoc130@#4 = #dsmoc130#4;
     #dsmoc130@#5 = #dsmoc130#5;
     |LEE 101#dsmoc130@.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc130@;
         #dsmoc130@#0  = #dsmoc130#0;
         #dsmoc130@#1  = #dsmoc130#1;
         #dsmoc130@#2  = #dsmoc130#2;
         #dsmoc130@#3  = #dsmoc130#3;
         #dsmoc130@#4  = #dsmoc130#4;
         #dsmoc130@#5  = #dsmoc130#5;
         #dsmoc130@#18 = #dsmoc130#18;

         |GRABA 020#dsmoc130@.b;
     |FINSI;

     |ABRE #dsmom014;
     nCtExisten = 0;
     nExini     = 0;
     nExfin     = 0;
     nPasada    = 0;
     |BUCLE caexistl;
     #dsmoc130@#47 = nCtExisten;
     |CIERRA #dsmom014;

     aTipCta = "I";   |BUCLE dsmom014;
     aTipCta = "C";   |BUCLE dsmom014;
     aTipCta = "G";   |BUCLE dsmom014;

     nSwRetencion = 1;
     |BUCLE dsmom022;
     nSwRetencion = 0;

     #dsmoc130@#17 = #dsmoc130@#8  - (#dsmoc130@#11 + #dsmoc130@#47) - #dsmoc130@#14;
     |SI #dsmoc130@#17 ! 0;
         #dsmoc130@#21 = #dsmoc130@#17 % #dsmoc130@#18;

         |SI #dsmoc130@#21 < 0;  #dsmoc130@#21 = 0;  |FINSI;

         |SI #dsmoc130@#8 = 0;  |Y #dsmoc130@#11 = 0;  |Y #dsmoc130@#47 = 0;
              #dsmoc130@#21 = #dsmoc130@#14 % #dsmoc130@#18;
         |FINSI;

         |SI #dsm18401#1 = 2015; |Y #dsmoc130@#21 ] 2000;
             #dsmoc130@#21 = 2000;
         |FINSI;
     |FINSI;

     |GRABA 020#dsmoc130@.a;
     |LIBERA #dsmoc130@;

     nEl8  = #dsmoc130@#8;
     nEl11 = #dsmoc130@#11;
     nEl47 = #dsmoc130@#47;
     nEl14 = #dsmoc130@#14;
     nEl21 = #dsmoc130@#21;
     nEl31 = #dsmoc130@#31;

     |BUCLE dsmom001A;
|FPRC;

|DEFBUCLE dsmoc130A;
     #dsmoc130#1;
     ;
     #dsm18401#0, #dsm18401#1, nPer130, 130, 01, #agicen14#1;
     #dsm18401#0, #dsm18401#1, nPer130, 130, 99, #agicen14#1;
     ;
     NULL, dsmoc130A;
|FIN;

|PROCESO agicen14;

     |SI #agicen14#5 > "01.01.0000";
         |SI #agicen14#5 > fFechaFin;  |ACABA;  |FINSI;
     |FINSI;

     |SI #agicen14#6 > "01.01.0000";
         |SI #agicen14#6 < fFechaIni;  |ACABA; |FINSI; || Baja
     |FINSI;

     |HAZ LeeHistorico;
                            #dsm18406#4 = 0;
     |SI #agicen30#8 = 3;   #dsm18406#4 = 1;  |FINSI;
     |SI #agicen30#8 = 8;   #dsm18406#4 = 1;  |FINSI;
     |SI #agicen30#8 = 4;   #dsm18406#4 = 2;  |FINSI;
     |SI #agicen30#8 = 9;   #dsm18406#4 = 2;  |FINSI;
     |SI #agicen30#8 = 5;   #dsm18406#4 = 3;  |FINSI;
     |SI #agicen30#8 = 6;   #dsm18406#4 = 3;  |FINSI;
     |SI #agicen30#8 = 10;  #dsm18406#4 = 3;  |FINSI;
     |SI #agicen30#8 = 11;  #dsm18406#4 = 3;  |FINSI;
     |SI #agicen30#8 = 12;  #dsm18406#4 = 3;  |FINSI;
                            #dsm18406#5 = 0;
     |SI #agicen30#12 = 1;  #dsm18406#5 = 1;  |FINSI;
     |SI #agicen30#12 = 2;  #dsm18406#5 = 3;  |FINSI;
     |SI #agicen30#12 = 3;  #dsm18406#5 = 2;  |FINSI;
     |SI #agicen30#12 = 4;  #dsm18406#5 = 5;  |FINSI;
     |SI #agicen30#12 = 5;  #dsm18406#5 = 4;  |FINSI;

     nHay      = 0;
     nFicticio = 0;
     |BUCLE dsmoc130A;

     |SI nHay = 0;
         nPer130 = 12;
         #dsmoc130#0  = #dsm18401#0;
         #dsmoc130#1  = #dsm18401#1;
         #dsmoc130#2  = 12;
         #dsmoc130#3  = 130;
         #dsmoc130#4  = 0;
         #dsmoc130#5  = #agicen14#1;
         #dsmoc130#45 = #agicen14#9;
         #dsmoc130#52 = #agicen14#16;

         |SI #dsmoc130#45 = 3;  |O #dsmoc130#45 = 8;  |O #dsmoc130#45 = 13;
             #dsmoc130#18 = 0;
             #dsmoc130#19 = 0;
             #dsmoc130#20 = 0;
             #dsmoc130#21 = 0;
         |SINO;
             |SI #dsmoc130#18 = 0;  #dsmoc130#18 = 5;  |FINSI;
         |FINSI;

         nFicticio = 1;
         |HAZ dsmoc130A;
     |FINSI;
|FPRC;

|DEFBUCLE agicen14;
     #agicen14#1;
     ;
     #dsm18401#0, 01;
     #dsm18401#0, 99;
     ;
     NULL, agicen14;
|FIN;

|PROCESO ModelosFicticios;
     enSwOpPar  =  0;
     swerror    =  0;
     enPerConta = -1;      || No sabemos el Periodo Contable
     |HAZ SituaEmpresa;
     |SI swerror = 1;
         |MENAV "    Error. No existen Datos Contables de esta Empresa ";
         |ACABA;
     |FINSI;

     |HAZ EnConversor;

     aAlfa1    = #dsm18401#1;
     aAlfa2    = "01.01." + #dsm18401#1;
     aAlfa3    = "31.12." + #dsm18401#1;
     fFechaIni = aAlfa2;
     fFechaFin = aAlfa3;

     |PATH_DAT #cacuenta#aPathConta#;
     |PATH_DAT #camaasil#aPathConta#;
     |PATH_DAT #caexistl#aPathConta#;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsmoc130.mas";
     |CARGA_DEF aMas, dsmoc130@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aFichero = ("C0" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dsmoc130@#aFichero#;
     |ABRE #dsmoc130@;  |CIERRA #dsmoc130@;  |DELINDEX #dsmoc130@;

     |ABRE #dsmow163;
     |ABRE #dsmoc130@;
     |BUCLE agicen14;
     |CIERRA #dsmoc130@;
     |CIERRA #dsmow163;

     |DESCARGA_DEF #dsmoc130@;

     |SI enSwPartido = 1;
         enSwOpPar   = 1;
         |HAZ FinalPartido;
     |FINSI;
|FPRC;

|PROCESO LeeHistorico;
     |ABRE #agicen30;
     #agicen30#0 = #agicen14#0;
     #agicen30#1 = #agicen14#1;
     #agicen30#2 = #dsm18401#1;
     |LEE 101#agicen30.=;
     |SI FSalida ! 0;
         |DDEFECTO #agicen30;
         #agicen30#0  = #agicen14#0;
         #agicen30#1  = #agicen14#1;
         #agicen30#2  = #dsm18401#1;
         #agicen30#3  = #agicen14#2;
         #agicen30#4  = #agicen14#3;
         #agicen30#5  = #agicen14#4;
         #agicen30#6  = #agicen14#7;
         #agicen30#7  = #agicen14#8;
         #agicen30#8  = #agicen14#9;
         #agicen30#9  = #agicen14#10;
         #agicen30#10 = #agicen14#11;
         #agicen30#11 = #agicen14#12;
         #agicen30#12 = #agicen14#16;
         #agicen30#13 = #agicen14#17;
         #agicen30#14 = #agicen14#18;
         #agicen30#15 = #agicen14#19;
         #agicen30#16 = #agicen14#15;
         |GRABA 020#agicen30.n;
     |FINSI;
     |LIBERA #agicen30;
     |CIERRA #agicen30;
|FPRC;

|PROCESO dsmoc130;
     #dsmom004#0 = #dsmoc130#0;
     #dsmom004#1 = #dsmoc130#1;
     #dsmom004#2 = #dsmoc130#2;
     #dsmom004#3 = #dsmoc130#3;
     #dsmom004#4 = #dsmoc130#4 + 1;
     |LEE 000#dsmom004.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     nSw = 1;
     |SI nSwOp = 1;  |ACABA;  |FINSI;

     nSw963   = 0;
     nIngAgri = 0;
     |DDEFECTO #dsmow163;
     #dsmow163#0 = #dsmoc130#0;
     #dsmow163#1 = #dsmoc130#1;
     #dsmow163#2 = #dsmoc130#5;
     |LEE 040#dsmow163.=;
     |SI FSalida = 0;
         nGastos130A = #dsmow163#4;
         nGastos130B = #dsmow163#5;
         nGastos130C = #dsmow163#6;
         nGastos130D = #dsmow163#7;
         nGastos130E = #dsmow163#9;
         nGastos130F = #dsmow163#10;
         nGastos130G = #dsmow163#11;
         nGastos130H = #dsmow163#12;
         nGastos130I = #dsmow163#13;
         nGastos130J = #dsmow163#14;
         nGastos130K = #dsmow163#15;
         nIngAgri    = #dsmow163#8;
     |SINO;
         nGastos130A = 0;
         nGastos130B = #dsmoc130#11;
         nGastos130C = 0;
         nGastos130D = (#dsmoc130#47 + #dsmoc130#14);
         nGastos130E = 0;
         nGastos130F = 0;
         nGastos130G = 0;
         nGastos130H = 0;
         nGastos130I = 0;
         nGastos130J = 0;
         nGastos130K = 0;
         nIngAgri    = #dsmoc130#8;
     |FINSI;

     nIngreso130   = nIngreso130   + #dsmoc130#8;
     |SI #dsm18401#1 ] 2016;    || tique 70000 _ 9852 sin 5% gastos
         nGastos130    = nGastos130    + #dsmoc130#11 + #dsmoc130#47 + #dsmoc130#14;
     |SINO;
         nGastos130    = nGastos130    + #dsmoc130#11 + #dsmoc130#47 + #dsmoc130#14 + #dsmoc130#21;
         nGastos130D   = nGastos130D   + #dsmoc130#21;
     |FINSI;
     nRdtos130     = nIngreso130   - nGastos130;
     nRetencion130 = nRetencion130 + #dsmoc130#31;

     |SI nDActiv = nHActiv;  |ACABA;  |FINSI;

     #agicen14#0  = #dsmoc130#0;
     #agicen14#1  = #dsmoc130#5;
     |LEE 000#agicen14.=;
     |SI FSalida ! 0;  |DDEFECTO #agicen14;  |FINSI;

     |HAZ LeeHistorico;

     nLinea = #dsmoc130#5;

     #dsm18406#0 = #dsm18401#0;
     #dsm18406#1 = #dsm18401#1;
     #dsm18406#2 = #dsm18401#3;
     #dsm18406#3 = nLinea;
     |LEE 101#dsm18406.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm18406;
         #dsm18406#0 = #dsm18401#0;
         #dsm18406#1 = #dsm18401#1;
         #dsm18406#2 = #dsm18401#3;
         #dsm18406#3 = nLinea;

         |SI #agicen30#8 = 3;   #dsm18406#4 = 1;  |FINSI;
         |SI #agicen30#8 = 8;   #dsm18406#4 = 1;  |FINSI;

         |SI #agicen30#8 = 4;   #dsm18406#4 = 2;  |FINSI;
         |SI #agicen30#8 = 9;   #dsm18406#4 = 2;  |FINSI;

         |SI #agicen30#8 = 5;   #dsm18406#4 = 3;  |FINSI;
         |SI #agicen30#8 = 6;   #dsm18406#4 = 3;  |FINSI;
         |SI #agicen30#8 = 10;  #dsm18406#4 = 3;  |FINSI;
         |SI #agicen30#8 = 11;  #dsm18406#4 = 3;  |FINSI;
         |SI #agicen30#8 = 12;  #dsm18406#4 = 3;  |FINSI;

                                 #dsm18406#5 = 0;
         |SI #agicen30#12  = 1;  #dsm18406#5 = 1; |FINSI;
         |SI #agicen30#12  = 2;  #dsm18406#5 = 3; |FINSI;
         |SI #agicen30#12  = 3;  #dsm18406#5 = 2; |FINSI;
         |SI #agicen30#12  = 4;  #dsm18406#5 = 5; |FINSI;
         |SI #agicen30#12  = 5;  #dsm18406#5 = 4; |FINSI;

         |SI #dsm18406#4 = 1; #dsm18406#14 = "Regimen de estimacion directa normal";       |FINSI;
         |SI #dsm18406#4 = 2; #dsm18406#14 = "Regimen de estimacion directa simplificada"; |FINSI;
         |SI #dsm18406#4 = 3; #dsm18406#14 = "Regimen de estimacion objetiva";             |FINSI;

         #dsm18406#6 = #agicen30#4;
         |SI #dsm18406#6 = 9999;  #dsm18406#6 = 0;  |FINSI;

         #dsm18406#7 = #dsmoc130#8;
         |SI #dsm18406#4 = 3; |Y #dsm18406#5 = 2; |Y #dsm18401#57 = "C";
             #dsm18406#7 = nIngAgri;
         |FINSI;

         |SI #dsm18406#4 = 2; nGastos130K = 0; |FINSI;
         #dsm18406#17 = nGastos130A;
         #dsm18406#18 = nGastos130B;
         #dsm18406#19 = nGastos130C;
         #dsm18406#20 = nGastos130D;
         #dsm18406#27 = nGastos130E;
         #dsm18406#28 = nGastos130F;
         #dsm18406#29 = nGastos130G;
         #dsm18406#30 = nGastos130H;
         #dsm18406#31 = nGastos130I;
         #dsm18406#32 = nGastos130J;
         #dsm18406#33 = nGastos130K;

         |SI #dsm18401#1 ] 2016;
             |SI #dsm18401#1 < 2019;
                 #dsm18406#8 = #dsmoc130#11 + #dsmoc130#47 + #dsmoc130#14;
             |SINO;
                 #dsm18406#8 = #dsm18406#17 + #dsm18406#18 + #dsm18406#19 + #dsm18406#20;
                 #dsm18406#8 = #dsm18406#8  + #dsm18406#27 + #dsm18406#28 + #dsm18406#29;
                 #dsm18406#8 = #dsm18406#8  + #dsm18406#30 + #dsm18406#31 + #dsm18406#32;
                 #dsm18406#8 = #dsm18406#8  + #dsm18406#33;
             |FINSI;
         |SINO;
             #dsm18406#8 = #dsmoc130#11 + #dsmoc130#47 + #dsmoc130#14 + #dsmoc130#21;
         |FINSI;

         #dsm18406#9 = #dsm18406#7 - #dsm18406#8;

         eaTabla = "ztabla01.txt";
         |HAZ CargaTabla;
         enComp = 1;
         eaAlfa = #dsm18406#5;
         |HAZ CompruebaTabla;
         #dsm18406#15 = eaDestino % 360;

                        eaTabla = "ztabla02.txt";
         |SI #dsm18406#5 = 4; eaTabla = "ztabla04.txt"; |FINSI;
         |SI #dsm18406#5 = 5; eaTabla = "ztabla03.txt"; |FINSI;

         |HAZ CargaTabla;
         enComp = 4;
         eaAlfa = ("0000" + #dsm18406#6) % -104;

         |HAZ CompruebaTabla;
         #dsm18406#16 = eaDestino % 660;

         |GRABA 020#dsm18406.n;
         |LIBERA #dsm18406;

         |DDEFECTO #dsm18431;
         #dsm18431#0 = #dsm18406#0;
         #dsm18431#1 = #dsm18406#1;
         #dsm18431#2 = #dsm18406#2;
         #dsm18431#3 = #dsm18406#3;
         #dsm18431#4 = "ES";
         #dsm18431#9 = "N";
         |LEE 101#dsm18431.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsm18431;
             #dsm18431#0 = #dsm18406#0;
             #dsm18431#1 = #dsm18406#1;
             #dsm18431#2 = #dsm18406#2;
             #dsm18431#3 = #dsm18406#3;
             #dsm18431#4 = "ES";
             #dsm18431#5 = "ESPA베";
             #dsm18431#6 = #dsm18406#7;
             #dsm18431#7 = #dsm18406#8;
             #dsm18431#8 = #dsm18406#9;
             #dsm18431#9 = "N";
             #dsm18431#11 = nGastos130A;
             #dsm18431#12 = nGastos130B;
             #dsm18431#13 = nGastos130C;
             #dsm18431#14 = nGastos130D;
             #dsm18431#16 = nGastos130E;
             #dsm18431#17 = nGastos130F;
             #dsm18431#18 = nGastos130G;
             #dsm18431#19 = nGastos130H;
             #dsm18431#20 = nGastos130I;
             #dsm18431#21 = nGastos130J;
             #dsm18431#22 = nGastos130K;
             |GRABA 020#dsm18431.n;
         |FINSI;
         |LIBERA #dsm18431;
     |SINO;
         |SI #dsm18406#4 = 2; nGastos130K = 0; |FINSI;

         #dsm18406#7 = #dsm18406#7 + #dsmoc130#8;
         #dsm18406#17 = #dsm18406#17 + nGastos130A;
         #dsm18406#18 = #dsm18406#18 + nGastos130B;
         #dsm18406#19 = #dsm18406#19 + nGastos130C;
         #dsm18406#20 = #dsm18406#20 + nGastos130D;
         #dsm18406#27 = #dsm18406#27 + nGastos130E;
         #dsm18406#28 = #dsm18406#28 + nGastos130F;
         #dsm18406#29 = #dsm18406#29 + nGastos130G;
         #dsm18406#30 = #dsm18406#30 + nGastos130H;
         #dsm18406#31 = #dsm18406#31 + nGastos130I;
         #dsm18406#32 = #dsm18406#32 + nGastos130J;
         #dsm18406#33 = #dsm18406#33 + nGastos130K;

         |SI #dsm18401#1 ] 2016;
             |SI #dsm18401#1 < 2019;
                 #dsm18406#8 = #dsm18406#8 + (#dsmoc130#11 + #dsmoc130#47 + #dsmoc130#14);
             |SINO;
                 #dsm18406#8 = #dsm18406#8  + #dsm18406#17 + #dsm18406#18 + #dsm18406#19 + #dsm18406#20;
                 #dsm18406#8 = #dsm18406#8  + #dsm18406#27 + #dsm18406#28 + #dsm18406#29;
                 #dsm18406#8 = #dsm18406#8  + #dsm18406#30 + #dsm18406#31 + #dsm18406#32;
                 #dsm18406#8 = #dsm18406#8  + #dsm18406#33;
             |FINSI;
         |SINO;
             #dsm18406#8 = #dsm18406#8 + (#dsmoc130#11 + #dsmoc130#47 + #dsmoc130#14 + #dsmoc130#21);
         |FINSI;
         #dsm18406#9 = #dsm18406#7 - #dsm18406#8;
         |GRABA 020#dsm18406.a;
         |LIBERA #dsm18406;

         #dsm18431#0 = #dsm18406#0;
         #dsm18431#1 = #dsm18406#1;
         #dsm18431#2 = #dsm18406#2;
         #dsm18431#3 = #dsm18406#3;
         #dsm18431#4 = "ES";
         #dsm18431#9 = "N";
         |LEE 101#dsm18431.=;
         |SI FSalida = 0;
             #dsm18431#5 = "ESPA베";
             #dsm18431#6 = #dsm18406#7;
             #dsm18431#7 = #dsm18406#8;
             #dsm18431#8 = #dsm18406#9;
             #dsm18431#11 = #dsm18406#17;
             #dsm18431#12 = #dsm18406#18;
             #dsm18431#13 = #dsm18406#19;
             #dsm18431#14 = #dsm18406#20;
             #dsm18431#16 = #dsm18406#27;
             #dsm18431#17 = #dsm18406#28;
             #dsm18431#18 = #dsm18406#29;
             #dsm18431#19 = #dsm18406#30;
             #dsm18431#20 = #dsm18406#31;
             #dsm18431#21 = #dsm18406#32;
             #dsm18431#22 = #dsm18406#33;
             |GRABA 020#dsm18431.a;
             |LIBERA #dsm18431;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc130;
     #dsmoc130#1;
     ;
     nEmpresa, #dsm18401#1, nPer130, 130, 00, nDActiv;
     nEmpresa, #dsm18401#1, nPer130, 130, 99, nHActiv;
     ;
     NULL, dsmoc130;
|FIN;

|PROCESO dsmoc131;
     #dsmom004#0 = #dsmoc131#0;
     #dsmom004#1 = #dsmoc131#1;
     #dsmom004#2 = #dsmoc131#2;
     #dsmom004#3 = #dsmoc131#3;
     #dsmom004#4 = #dsmoc131#4 + 1;
     |LEE 000#dsmom004.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     nSw = 1; |SI nSwOp = 1; |ACABA; |FINSI;

     |SI #dsmoc131#2 = nPer131;
         |ABRE #dsmom018;
         |SI nDActiv ! nHActiv;
             #dsmom018#0 = #dsmoc131#0;
             #dsmom018#1 = #dsmoc131#1;
             #dsmom018#2 = 0;
             #dsmom018#3 = #dsmoc131#5;
             nPorce = 100;
         |SINO;
             #dsmom018#0 = #dsmom001#0;
             #dsmom018#1 = #dsmoc131#1;
             #dsmom018#2 = 0;
             #dsmom018#3 = #dsmom001#1;
             nPorce = #dsmom001#7;
         |FINSI;

         |LEE 000#dsmom018.=;
         |SI FSalida ! 0;  |DDEFECTO #dsmom018;  |FINSI;
         |CIERRA #dsmom018;

         nRdtos131 = nRdtos131 + ((#dsmom018#123 % nPorce) ! 2);
     |FINSI;

     nVentas131    = nVentas131    + #dsmoc131#13;
     nRetencion131 = nRetencion131 + #dsmoc131#12 + #dsmoc131#15;

     |SI #dsmoc131#2  ! nPer131;  |ACABA;  |FINSI;
     |SI nDActiv = nHActiv;  |ACABA;  |FINSI;

     #agicen14#0  = #dsmoc131#0;
     #agicen14#1  = #dsmoc131#5;
     |LEE 000#agicen14.=;
     |SI FSalida ! 0;  |DDEFECTO #agicen14;  |FINSI;

     |HAZ LeeHistorico;

     nLinea = #dsmoc131#5;

     #dsm18406#0 = #dsm18401#0;
     #dsm18406#1 = #dsm18401#1;
     #dsm18406#2 = #dsm18401#3;
     #dsm18406#3 = nLinea;
     |LEE 101#dsm18406.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm18406;
         #dsm18406#0 = #dsm18401#0;
         #dsm18406#1 = #dsm18401#1;
         #dsm18406#2 = #dsm18401#3;
         #dsm18406#3 = nLinea;

         |SI #agicen30#8 = 3;   #dsm18406#4 = 1;  |FINSI;
         |SI #agicen30#8 = 4;   #dsm18406#4 = 2;  |FINSI;
         |SI #agicen30#8 = 5;   #dsm18406#4 = 3;  |FINSI;
         |SI #agicen30#8 = 6;   #dsm18406#4 = 3;  |FINSI;
         |SI #agicen30#8 = 8;   #dsm18406#4 = 1;  |FINSI;
         |SI #agicen30#8 = 9;   #dsm18406#4 = 2;  |FINSI;
         |SI #agicen30#8 = 10;  #dsm18406#4 = 3;  |FINSI;
         |SI #agicen30#8 = 11;  #dsm18406#4 = 3;  |FINSI;
         |SI #agicen30#8 = 12;  #dsm18406#4 = 3;  |FINSI;

                            #dsm18406#5 = 0;
         |SI #agicen30#12  = 1;  #dsm18406#5 = 1; |FINSI;
         |SI #agicen30#12  = 2;  #dsm18406#5 = 3; |FINSI;
         |SI #agicen30#12  = 3;  #dsm18406#5 = 2; |FINSI;
         |SI #agicen30#12  = 4;  #dsm18406#5 = 5; |FINSI;
         |SI #agicen30#12  = 5;  #dsm18406#5 = 4; |FINSI;

         |SI #dsm18406#4 = 1; #dsm18406#14 = "Regimen de estimacion directa normal";       |FINSI;
         |SI #dsm18406#4 = 2; #dsm18406#14 = "Regimen de estimacion directa simplificada"; |FINSI;
         |SI #dsm18406#4 = 3; #dsm18406#14 = "Regimen de estimacion objetiva";             |FINSI;

         #dsm18406#6 = #agicen30#4;
         |SI #dsm18406#6 = 9999;  #dsm18406#6 = 0;  |FINSI;

         #dsm18406#9 = #dsmom018#123 + nVentas131;

         eaTabla = "ztabla01.txt";
         |HAZ CargaTabla;
         enComp = 1;
         eaAlfa = #dsm18406#5;
         |HAZ CompruebaTabla;
         #dsm18406#15 = eaDestino % 360;

                              eaTabla = "ztabla02.txt";
         |SI #dsm18406#5 = 4; eaTabla = "ztabla04.txt"; |FINSI;
         |SI #dsm18406#5 = 5; eaTabla = "ztabla03.txt"; |FINSI;

         |HAZ CargaTabla;
         enComp = 4;
         eaAlfa = ("0000" + #dsm18406#6) % -104;

         |HAZ CompruebaTabla;
         #dsm18406#16 = eaDestino % 660;

         |GRABA 020#dsm18406.n;
         |LIBERA #dsm18406;

         |DDEFECTO #dsm18431;
         #dsm18431#0 = #dsm18406#0;
         #dsm18431#1 = #dsm18406#1;
         #dsm18431#2 = #dsm18406#2;
         #dsm18431#3 = #dsm18406#3;
         #dsm18431#4 = "ES";
         #dsm18431#5 = "ESPA베";
         #dsm18431#6 = #dsm18406#7;
         #dsm18431#7 = #dsm18406#8;
         #dsm18431#8 = #dsm18406#9;
         #dsm18431#9 = "N";
         |GRABA 020#dsm18431.n;
         |LIBERA #dsm18431;
     |SINO;
         #dsm18406#9 = #dsm18406#9 + (#dsmom018#123 + nVentas131);
         |GRABA 020#dsm18406.a;
         |LIBERA #dsm18406;

         #dsm18431#0 = #dsm18406#0;
         #dsm18431#1 = #dsm18406#1;
         #dsm18431#2 = #dsm18406#2;
         #dsm18431#3 = #dsm18406#3;
         #dsm18431#4 = "ES";
         #dsm18431#9 = "N";
         |LEE 101#dsm18431.=;
         |SI FSalida = 0;
             #dsm18431#5 = "ESPA베";
             #dsm18431#6 = #dsm18406#7;
             #dsm18431#7 = #dsm18406#8;
             #dsm18431#8 = #dsm18406#9;
             |GRABA 020#dsm18431.a;
             |LIBERA #dsm18431;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc131;
     #dsmoc131#1;
     ;
     nEmpresa, #dsm18401#1, 00, 131, 00, nDActiv;
     nEmpresa, #dsm18401#1, 99, 131, 99, nHActiv;
     ;
     NULL, dsmoc131;
|FIN;

|PROCESO dsmom004;
     |SI #dsmom004#3 = 130;  nPer130 = #dsmom004#2;  |FINSI;
     |SI #dsmom004#3 = 131;  nPer131 = #dsmom004#2;  |FINSI;
|FPRC;

|DEFBUCLE dsmom004;
     #dsmom004#1;
     ;
     #dsm18401#0, #dsm18401#1, 01, 130, 00;
     #dsm18401#0, #dsm18401#1, 12, 131, 00;
     ;
     NULL, dsmom004;
|FIN;

|PROCESO dsmom001;
     aComunidad = "S";

     #agicen14#0  = #dsmom001#0;
     #agicen14#1  = #dsmom001#1;
     |LEE 000#agicen14.=;
     |SI FSalida ! 0;  |DDEFECTO #agicen14;  |FINSI;

     |HAZ LeeHistorico;

     nTipoAct = #agicen30#12;

     |ERROR10;
|FPRC;

|DEFBUCLE dsmom001;
     #dsmom001#1;
     ;
     #dsm18401#0, 0, 0001;
     #dsm18401#0, 9, 9999;
     ;
     NULL, dsmom001;
|FIN;

|PROCESO dsm18430B;
     #dsm18430#16 = 0;
     #dsm18430#46 = 0;

     |GRABA 020#dsm18430.a;
     |LIBERA #dsm18430;
|FPRC;

|DEFBUCLE dsm18430B;
     #dsm18430#1;
     2;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 001, aDNif;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 999, aHNif;
     be;
     NULL, dsm18430B;
|FIN;

|PROCESO VuelcaSocios;
     |SI nSocio < 0;  nSocio = 0; |FINSI;  || Hay datos de socios

     |SI #dsmom001#8 > "01.01.0000";
         |SI #dsmom001#8 > fHFecha; |ACABA;  |FINSI;
     |FINSI;

     |SI #dsmom001#9 > "01.01.0000";
         |SI #dsmom001#9 < fDFecha;  |ACABA;  |FINSI;
     |FINSI;

     #agicen14#0  = #dsmom001#3;  ||Compruebo si esta la actividad de alta
     #agicen14#1  = #dsmom001#4;
     |LEE 000#agicen14.=;
     |SI FSalida ! 0;  |DDEFECTO #agicen14;  |FINSI;
     |SI #agicen14#5 > "01.01.0000";
         |SI #agicen14#5 > fHFecha;  |ACABA;  |FINSI;
     |FINSI;

     |SI #agicen14#6 > "01.01.0000";
         |SI #agicen14#6 < fDFecha;  |ACABA; |FINSI; || Baja
     |FINSI;
     fec1  = #agicen14#5;
     fec2  = #agicen14#6;

     #agicen14#0  = #dsmom001#0;  ||Compruebo si esta la actividad de alta
     #agicen14#1  = #dsmom001#1;
     |LEE 000#agicen14.=;
     |SI FSalida ! 0;  |DDEFECTO #agicen14;  |FINSI;
     |SI #agicen14#5 > "01.01.0000";
         |SI #agicen14#5 > fHFecha;  |ACABA;  |FINSI;
     |FINSI;

     |SI #agicen14#6 > "01.01.0000";
         |SI #agicen14#6 < fDFecha;  |ACABA; |FINSI; || Baja
     |FINSI;

|| ... Aqui tique  4887_34
     fFec1 = fDFecha;
     |SI #agicen14#5 > fDFecha; fFec1 = #agicen14#5; |FINSI;
     |SI fec1   > fFec1;   |Y fec1 > "01.01.0000"; fFec1 = fec1; |FINSI;

     fFec2 = fHFecha;
     |SI #agicen14#6 < fHFecha; |Y #agicen14#6 > "01.01.0000"; fFec2 = #agicen14#6; |FINSI;
     |SI fec2   < fFec2;   |Y fec2 > "01.01.0000";   fFec2 = fec2; |FINSI;
     nDias = (fFec2 - fFec1) + 1;

     aLaX  = "X";
     aAlfa = fFec2; aAlfa = aAlfa % 105;
     |SI aAlfa ! "31.12"; aLaX = " "; |FINSI;

     #agifigen#0 = #dsmom001#3;
     |LEE 000#agifigen.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nEmpresa      = #dsmom001#3;
     nDActiv       = #dsmom001#4;
     nHActiv       = #dsmom001#4;

     |SI nSwOp = 1;
         nSw    = 0;
         aDNif = #agifigen#13;
         aHNif = #agifigen#13 + "   ";
         |ABRE #dsmom004;
         |BUCLE dsmoc130;
         |BUCLE dsmoc131;
         |CIERRA #dsmom004;
         |SI nSw = 1;
             |BUCLE dsm18430B;
         |FINSI;
         |ACABA;
     |FINSI;

     nIngreso130   = 0;
     nGastos130    = 0;
     nRdtos130     = 0;
     nRetencion130 = 0;
     nRdtos131     = 0;
     nVentas131    = 0;
     nRetencion131 = 0;

     |SELECT #1#dsm18430;
     #dsm18430#0  = #dsm18401#0;
     #dsm18430#1  = #dsm18401#1;
     #dsm18430#33 = #dsm18401#3;
     #dsm18430#34 = 999;
     |LEE 000#dsm18430.];
     |SI FSalida = 0;
         |LEE 000#dsm18430.a;
     |SINO;
         |LEE 000#dsm18430.u;
     |FINSI;

     nLinea30 = 1;
     |SI FSalida = 0;  |Y #dsm18430#0  = #dsm18401#0;  |Y #dsm18430#1  = #dsm18401#1;  |Y #dsm18430#33 = #dsm18401#3;
         nLinea30 = #dsm18430#34 + 1;
     |FINSI;

     |ABRE #dsmom004;
     |BUCLE dsmoc130;
     |BUCLE dsmoc131;
     |CIERRA #dsmom004;

     |SELECT #2#dsm18430;
     #dsm18430#0  = #dsm18401#0;
     #dsm18430#1  = #dsm18401#1;
     #dsm18430#33 = #dsm18401#3;
     #dsm18430#2  = #agifigen#13;
     |LEE 000#dsm18430.=;
     |SI FSalida = 0;
         nLin = #dsm18430#34;
     |SINO;
         nLin = nLinea30;
     |FINSI;

     |SELECT #1#dsm18430;
     #dsm18430#0  = #dsm18401#0;
     #dsm18430#1  = #dsm18401#1;
     #dsm18430#33 = #dsm18401#3;
     #dsm18430#34 = nLin;
     |LEE 101#dsm18430.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm18430;
         #dsm18430#0  = #dsm18401#0;
         #dsm18430#1  = #dsm18401#1;
         #dsm18430#33 = #dsm18401#3;
         #dsm18430#34 = nLin;
         #dsm18430#2  = #agifigen#13;
         #dsm18430#3  = "";
         #dsm18430#4  = #agifigen#1;
         #dsm18430#36 = #agifigen#3;
         #dsm18430#5  = #agifigen#4;
         #dsm18430#37 = #agifigen#5;
         #dsm18430#38 = #agifigen#6;
         #dsm18430#39 = #agifigen#7;
         #dsm18430#40 = #agifigen#8;
         #dsm18430#41 = #agifigen#10;
         #dsm18430#42 = #agifigen#11;
         #dsm18430#6  = #agifigen#9;
         #dsm18430#9  = aLaX;
         #dsm18430#10 = nDias;

         enComp  = 2;
         eaTabla = "ztabla05.txt"; |HAZ CargaTabla;
         eaAlfa  = #dsm18430#7; |HAZ CompruebaTabla;

         #dsm18430#11  = #dsmom001#7;
         #dsm18430#35  = eaDestino % 430;
         nPorc   = nPorc + #dsmom001#7;

         |HAZ FinTabla;
         |GRABA 020#dsm18430.b;
     |SINO;
         |SI #dsm18430#41 = 0;
            #dsm18430#36 = #agifigen#3;
            #dsm18430#5  = #agifigen#4;
            #dsm18430#37 = #agifigen#5;
            #dsm18430#38 = #agifigen#6;
            #dsm18430#39 = #agifigen#7;
            #dsm18430#40 = #agifigen#8;
            #dsm18430#41 = #agifigen#10;
            #dsm18430#42 = #agifigen#11;
         |FINSI;

         |SI #dsm18430#11 ! #dsmom001#7;
             nSwError = 1;
         |FINSI;
     |FINSI;

     #dsm18430#16 = #dsm18430#16 + nRdtos130     + nRdtos131 + nVentas131;
     #dsm18430#46 = #dsm18430#46 + nRetencion130 + nRetencion131;

     |GRABA 020#dsm18430.a;
     |LIBERA #dsm18430;

     |SI nSocio = 0; |O nActi ! #dsmom001#1;
         nCActiv = nCActiv + 1;
         nActi   = #dsmom001#1;
     |FINSI;

     nSocio = nSocio + 1;

     aAlfa  = #dsm18401#25;  |QBF aAlfa;
     |SI aAlfa = ""; |Y nSocio = 1;
         #dsm18401#25 = #agifigen#13;
         #dsm18401#26 = #agifigen#1;
         #dsm18401#27 = #agifigen#4;
         #dsm18401#28 = #agifigen#5;
         #dsm18401#29 = #agifigen#9;
         #dsm18401#30 = #agifigen#10;
         #dsm18401#31 = #agifigen#11;
         #dsm18401#32 = #agifigen#12;
     |FINSI;
|FPRC;

|DEFBUCLE VuelcaSocios;
     #dsmom001#1;
     ;
     #dsm18401#0, 0, 0001;
     #dsm18401#0, 9, 9999;
     ;
     NULL,VuelcaSocios;
|FIN;

|PROCESO dsm18406B;
     |BORRA 020#dsm18406.a;
|FPRC;

|DEFBUCLE dsm18406B;
     #dsm18406#1;
     ;
     #dsm18401#0, #dsm18401#1, nComp, 001;
     #dsm18401#0, #dsm18401#1, nComp, 999;
     be;
     NULL, dsm18406B;
|FIN;

|PROCESO dsm18431B;
     |BORRA 020#dsm18431.a;
|FPRC;

|DEFBUCLE dsm18431B;
     #dsm18431#1;
     ;
     #dsm18401#0, #dsm18401#1, nComp, 001, "  ", " ";
     #dsm18401#0, #dsm18401#1, nComp, 999, "zz", "z";
     be;
     NULL, dsm18431B;
|FIN;

|PROCESO dsm18430Cop;
     |SALVA_FICHA #dsm18430;
     #dsm18430#1 = #dsm18401#1;
     |LEE 000#dsm18430.=;
     |SI FSalida ! 0;
        |PDEFECTO #dsm18430, 12, 33;
        |GRABA 020#dsm18430.n;
     |FINSI;
     |REPON_FICHA #dsm18430;
|FPRC;

|DEFBUCLE dsm18430Cop;
     #dsm18430#1;
     ;
     #dsm18401#0, enAnyo, #dsm18401#3, 001;
     #dsm18401#0, enAnyo, #dsm18401#3, 999;
     ;
     NULL, dsm18430Cop;
|FIN;

|PROCESO CopiaSocAnt;
     |BUCLE dsm18430Cop;
|FPRC;

|PROCESO RecogeDatos;
     aFichero = ("6x" + Usuario) % -108;
     |NOME_DAT #dsmow163#aFichero#;
     |DELINDEX #dsmow163;

     enEjer = #dsm18401#1;
     |HAZ Verm014Plan;
     |SI enPlan14 = 0; |ACABA; |FINSI;

     |HAZ Verm060Plan;
     |SI enPlan60 = 0; |ACABA; |FINSI;
     |SI enEjer = 2019; enPlan60 = 2008; |FINSI;

     |ABRE #dsmom107;
     |LEE 040#dsmom107.p;
     |SI FSalida ! 0;
         |CIERRA #dsmom107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #dsmom107;
     |FINSI;

     |LEE 040#dsmom107.p;
     |SI FSalida ! 0;  |DDEFECTO #dsmom107;  |FINSI;
     |CIERRA #dsmom107;

     |DBASS aBase;  |QBF aBase;
     aAlfa = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         |ABRE #dsam0000;
         #dsam0000#0 = #dsm18401#0;
         |LEE 000#dsam0000.=;
         |SI FSalida ! 0;  |DDEFECTO #dsam0000;  |FINSI;

         aAlfa = #dsm18401#55;  |QBF aAlfa;
         |SI aAlfa = "";
             #dsm18401#55 = #dsam0000#53;
         |FINSI;

         |CIERRA #dsam0000;
     |FINSI;

     nSwBorra = 1;
     |BUCLE dsm18406B;
     |BUCLE dsm18431B;

     |ABRE #agifigen;
     #agifigen#0 = #dsm18401#0;
     |LEE 000#agifigen.=;
     |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;

     #dsm18401#4  = #agifigen#2;    ||tique 1222_1187
     #dsm18401#8  = #agifigen#13;
     #dsm18401#9  = #agifigen#2;
     #dsm18401#10 = #agifigen#4;
     #dsm18401#11 = #agifigen#5;
     #dsm18401#12 = #agifigen#9;
     #dsm18401#13 = #agifigen#10;
     #dsm18401#14 = #agifigen#11;
     #dsm18401#15 = #agifigen#12;
     #dsm18401#16 = #agifigen#61;
     |SI #dsm18401#16 = "            ";
         #dsm18401#16 = #agifigen#14;
     |FINSI;

     |SI #dsm18401#17 = " ";
         #dsm18401#17 = "A";
         #dsm18401#33 = "Entidades en Reg.atrib.rentas constituidas en Espa바";

         aComunidad = "";
         nTipoAct   = 0;

         |ABRE #agicen14;
         |BUCLE dsmom001;
         |CIERRA #agicen14;

         |SI aComunidad = "S";
             #dsm18401#18 = 2;
             |SI nTipoAct = 1;  |O nTipoAct = 2;  |O nTipoAct = 3;
                 #dsm18401#19 = 1;
             |FINSI;

             |SI nTipoAct = 4;  |O nTipoAct = 5;
                 #dsm18401#19 = 2;
             |FINSI;

             |SI #agicen30#4 = "8611";  |O  #agicen30#4 = "8612"; |O  #agicen30#4 = "862 ";
                 #dsm18401#19 = 3;
             |FINSI;
         |FINSI;
     |FINSI;

     nPer130 = 12;
     |BUCLE dsmom004;

     aAlfa = #agifigen#3; |QBF aAlfa;
     aAlfa = aAlfa + " " + #agifigen#4; |QBF aAlfa;
     #dsm18401#10 = aAlfa;

     nLin    = 1;
     nPorc   = 0;
     aAlfa2  = #dsm18401#1;
     aAlfa1  = "01.01." + aAlfa2;
     aAlfa2  = "31.12." + aAlfa2;
     fDFecha = aAlfa1;
     fHFecha = aAlfa2;

     |ABRE #dsmom061;
     |SELECT #2#dsmom061;
     |SI #dsm18401#57 = "C";
         |HAZ ModelosFicticios;

         aFichero = ("C0" + Usuario + "zzzzzzzz") % 108;
         |NOME_DAT #dsmoc130#aFichero#;
     |SINO;
         |SI #dsm18401#1 ] 2015;
             |BUCLE LeoActivCtas;
         |FINSI;
     |FINSI;

     |ABRE #agicen15;
     #agicen15#0 = #dsm18401#0;
     |LEE 001#agicen15.=;
     |SI FSalida = 0;
         aAlfa = #agicen15#4; |QBF aAlfa;
         |SI aAlfa ! "";
             #dsm18401#25 = #agicen15#4;  || .. dni
             #dsm18401#26 = #agicen15#5;  || .. nombre
             aAlfa = #agicen15#8; |QBF aAlfa;
             |SI aAlfa ! "" ; aAlfa = aAlfa + " "; |FINSI;
             #dsm18401#27 = aAlfa + #agicen15#9;  || .. domicilio
             #dsm18401#28 = #agicen15#10;  || .. numero
             #dsm18401#29 = #agicen15#15;  || .. CP 1
             #dsm18401#30 = #agicen15#16; || .. CP 2
             #dsm18401#31 = #agicen15#17; || .. Municipio
             #dsm18401#32 = #agicen15#18; || .. Provincia
         |FINSI;
     |FINSI;
     |CIERRA #agicen15;

     |ABRE #agicen14;
     nSocio = -1;
     nSwOp  = 1;
     |BUCLE VuelcaSocios;

     nSwError = 0;  || = 1 error, algun socio con dif. en %
     nActi    = 0;  || actividad
     nCActiv  = 0;  || contador de actividades

     nSocio  = -1;
     nSwOp   = 0;
     |ABRE #dsm18430;
     |BUCLE VuelcaSocios;
     |CIERRA #dsm18430;
     |CIERRA #agicen14;
     nPorc = nPorc ! 0;

     |SI nSocio < 0;
        enAnyo = -1;
        |ABRE #dsm18430;
        #dsm18430#0 = #dsm18401#0;
        #dsm18430#1 = 0;
        #dsm18430#33 = 0;
        |LEE 000#dsm18430.];
        |PARA; |SI FSalida = 0; |Y #dsm18430#0 = #dsm18401#0; |Y #dsm18430#1 < #dsm18401#1; |HACIENDO;
           |SI #dsm18401#33 = 0; enAnyo = #dsm18430#1; |FINSI;
           |LEE 000#dsm18430.s;
        |SIGUE;

        |SI enAnyo ! -1;
           |DDEFECTO #dsm18430;
           #dsm18430#0 = #dsm18401#0;
           #dsm18430#1 = enAnyo;
           #dsm18430#33 = 0;
           |LEE 000#dsm18430.];
           |SI FSalida = 0; |Y #dsm18430#0 = #dsm18401#0; |Y #dsm18430#1 = enAnyo;
              |DBASE aBase;  |QBF aBase;
              aMas = aBase + "def/dsm18401.mas";
              |CARGA_DEF aMas, dsm18401@;
              |SI FSalida ! 0;
                  |MENAV "0000 Problemas en Crear Copia.";
                  |HAZ DestruyeFicheros;
                  |ACABA;
              |FINSI;

              |ABRE #dsm18401@;
              #dsm18401@#0 = #dsm18401#0;
              #dsm18401@#1 = enAnyo;
              #dsm18401@#2 = #dsm18401#2;
              #dsm18401@#3 = #dsm18401#3;
              |LEE 000#dsm18401@.=;
              |SI FSalida = 0;
                  |PARA nCampo = 8;  |SI nCampo [ 33;  |HACIENDO nCampo = nCampo + 1;
                         #dsm18401#nCampo# = #dsm18401@#nCampo#;
                  |SIGUE;

                  #dsm18401#24 = 0;
                  #dsm18401#55 = #dsm18401@#55;
                  #dsm18401#56 = #dsm18401@#56;
              |FINSI;
              |CIERRA #dsm18401@;

              |DESCARGA_DEF #dsm18401@;

              |HAZ CopiaSocAnt;
           |FINSI;
           |CIERRA #dsm18430;
        |FINSI;

        |SI enTipoEntrada = 1;              || Alta del Modelo
            |DBASE aBase;  |QBF aBase;
            aMas = aBase + "def/dsm18401.mas";
            |CARGA_DEF aMas, dsm18401@;
            |SI FSalida ! 0;
                |MENAV "0000 Problemas en Crear Copia.";
                |HAZ DestruyeFicheros;
                |ACABA;
            |FINSI;

            |ABRE #dsm18401@;
            #dsm18401@#0 = #dsm18401#0;
            #dsm18401@#1 = #dsm18401#1 - 1;
            #dsm18401@#2 = #dsm18401#2;
            #dsm18401@#3 = #dsm18401#3;
            |LEE 000#dsm18401@.=;
            |SI FSalida = 0;
                |PARA nCampo = 8;  |SI nCampo [ 33;  |HACIENDO nCampo = nCampo + 1;
                      #dsm18401#nCampo# = #dsm18401@#nCampo#;
                |SIGUE;
                #dsm18401#24 = 0;
                #dsm18401#55 = #dsm18401@#55;
                #dsm18401#56 = #dsm18401@#56;
            |FINSI;
            |CIERRA #dsm18401@;

            |DESCARGA_DEF #dsm18401@;
        |FINSI;

        |DBASS aBase;  |QBF aBase;
        aAlfa = aBase + "integral/def/dsam0000.mas";
        |XABRE "E", aAlfa, nCanal;
        |SI FSalida ] 0;
             |ABRE #dsam0000;
             #dsam0000#0 = #dsm18401#0;
             |LEE 000#dsam0000.=;
             |SI FSalida ! 0;  |DDEFECTO #dsam0000;  |FINSI;

             #dsm18401#55 = #dsam0000#53;

             |CIERRA #dsam0000;
         |FINSI;

         |ABRE #agifigen;
         #agifigen#0 = #dsm18401#0;
         |LEE 000#agifigen.=;
         |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;

         #dsm18401#4  = #agifigen#2;   ||Tique 1222_1187
         #dsm18401#8  = #agifigen#13;
         #dsm18401#9  = #agifigen#2;
         #dsm18401#10 = #agifigen#4;
         #dsm18401#11 = #agifigen#5;
         #dsm18401#12 = #agifigen#9;
         #dsm18401#13 = #agifigen#10;
         #dsm18401#14 = #agifigen#11;
         #dsm18401#15 = #agifigen#12;
         #dsm18401#16 = #agifigen#61;
         |SI #dsm18401#16 = "            ";
             #dsm18401#16 = #agifigen#14;
         |FINSI;
     |FINSI;

     |SI nPorc ! 100; |Y nPorc ! 0;
         |MENAV "    Atencion. La suma de los porcentajes de los comuneros de esta comunidad no es del 100%";
         |SI nCActiv > 1;
             aAlfa = nCActiv;
             |SI nSwError = 1;
                 aAlfa =  "0000Hay "+ nCActiv + " Actividades y no coinciden los porcentajes de socios. Reviselos";
             |SINO;
                 aAlfa =  "0000Hay "+ nCActiv + " Actividades y diferentes comuneros";
             |FINSI;
             |MENAV aAlfa;
         |FINSI;
     |FINSI;

     nEmpresa      = #dsm18401#0;
     nIngreso130   = 0;
     nGastos130    = 0;
     nGastos130A   = 0;
     nGastos130B   = 0;
     nGastos130C   = 0;
     nGastos130D   = 0;
     nGastos130E   = 0;
     nGastos130F   = 0;
     nGastos130G   = 0;
     nGastos130H   = 0;
     nGastos130I   = 0;
     nGastos130J   = 0;
     nGastos130K   = 0;
     nRdtos130     = 0;
     nRetencion130 = 0;
     nRdtos131     = 0;
     nVentas131    = 0;
     nRetencion131 = 0;
     nDActiv       = 01;
     nHActiv       = 99;
     nLinea        = 0;
     nLinea30      = 0;

     |ABRE #dsmow163;
     |ABRE #dsm18406;
     |ABRE #dsm18431;
     |ABRE #agicen14;
     |BUCLE dsmoc130;
     |BUCLE dsmoc131;
     |CIERRA #dsm18406;
     |CIERRA #dsm18431;
     |CIERRA #agicen14;
     |CIERRA #dsmow163;

     |SI nIngreso130 ! 0;  |O nRdtos131 ! 0;  |O nVentas131 ! 0;
         #dsm18401#24 = nIngreso130 + nVentas131;
     |FINSI;

     |SI nRetencion130 ! 0;  |O nRetencion131 ! 0;
         #dsm18401#52 = nRetencion130 + nRetencion131;
     |FINSI;

     |CIERRA #agifigen;

     |HAZ DestruyeFicheros;
|FPRC;
