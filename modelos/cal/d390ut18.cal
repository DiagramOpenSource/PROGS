|FICHEROS;
     dsmoy000;
     dsm39001;
     dsmow014;

     t1839001;
|FIN;

|VARIABLES;
     nHandleError   = 0;
     nReg           = 0;
     nError         = 0;
     nCodError      = 0;
     nCaracter      = 0;
     nConta         = 0;
     nErrorCC       = 0;
     nErrorEE       = 0;
     nCopiado       = 0;
     nNoLoHago      = 0;
     nHandle        = 0;

     aFicPortal     = "";
     aFicError      = "";
     aPathPatrones  = "";
     aPatron        = "";
     aEjecutable    = "";
     aCadena1       = "";
     aCadena2       = "";
     aCadena3       = "";
     aCadena4       = "";
     aRegistro      = "";
     aNif           = "";
     aNombre        = "";
     aDescri        = "";
     aValidar       = "";
     aEnsobrar      = "";
     aEjecu         = "";
     aNum           = "";
     aPrgJava       = "";
     aPathLocal     = "";
     aPathPlugins   = "";
     aDocRemoto     = "";
     aDocServidor   = "";
     aIPRemoto      = "";
     aDIR           = "";

     {1}aContiene   = "";

     {99}aCodEE     = "";
     {99}aCodDCC    = "";
     {99}aCodPCC    = "";
|FIN;

|INCLUYE i_varemi;

|PROCESO PortalBorrador2018;
     aDIR = "https://www6.aeat.es/wlpl/PFTW-PICW/ServVali";
     aHID = "";
     aPRG = "";

     aFicPortal = "Portal" + #dsmoy000#0 + ".html";
     aAbre      = eaPathEmision + aFicPortal;
     |XABRE "WB", aAbre, enHandlePortal;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + aDIR + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + "ES" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIC" + &34 + " value=" + &34;
     |HAZ GrabaPortalSin;
     |XCIERRA enHandlePortal;

     aDestino   = eaPathEmision + aFicPortal;
     aOrigen    = eaPathEmision + eaFicheroPlano;
     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre      = eaPathEmision + aFicPortal;
     |XABRE "AB", aAbre, enHandlePortal;

     eaAlfa = &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "RUT" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + aPRG + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + #dsmoy000#6 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + #dsmoy000#0 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     eaFOrigen  = eaPathEmision + aFicPortal;
     eaFDestino = eaPathLanza   + aFicPortal;
     |HAZ CopiaFichero;

     eaForzExplorador = "N";
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + eaPathLanza + aFicPortal;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaPathLanza + aFicPortal + &34;
     |FINSI;

     |RSYSTEM aAlfa;

     aAlfa = eaPathEmision + aFicPortal;      |FBORRA aAlfa;
     aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;
|FPRC;

|PROCESO PortalPDF2018;
     |HAZ TraeSoloWait;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathInternet + eaFicheroPlano;
     |HAZ CopiaFichero;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     eaAlfa = eaPathLanza + "wait ";                      |HAZ GrabaPortalSin;
     eaAlfa = eaPathExplorador + " " + &34;               |HAZ GrabaPortalSin;
     eaAlfa = "https://www2.agenciatributaria.gob.es/";   |HAZ GrabaPortalSin;
     aAlfa = #dsm39001#1; aAlfa = aAlfa % -102;
     eaAlfa = "wlpl/PAIV-IW" + aAlfa + "/CONT/index.zul?EDFI";       |HAZ GrabaPortalSin;

     |XCIERRA enHandlePortal;

     |RSYSTEM aAbre;

     aAlfa = eaPathEmision + aFicPortal;      |FBORRA aAlfa;
     aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;

     eaJusti = "";
     |HAZ GrabaImpresoPortal;
|FPRC;

|PROCESO PortalInternet2018;
     |SI enPresentar = 0;
         eaFOrigen  = eaPathEmision  + eaFicheroPlano;
         eaFDestino = eaPathInternet + eaFicheroPlano;
         |HAZ CopiaFichero;

         aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;

         eaJusti = "";
         |HAZ GrabaImpresoPortal;

         |ACABA;
     |FINSI;

     |HAZ TraeSoloWait;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathInternet + eaFicheroPlano;
     |HAZ CopiaFichero;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     eaAlfa = eaPathLanza + "wait ";                          |HAZ GrabaPortalSin;
     eaAlfa = eaPathExplorador + " " + &34;                   |HAZ GrabaPortalSin;
     eaAlfa = "https://www1.agenciatributaria.gob.es/";       |HAZ GrabaPortalSin;
     aAlfa = #dsm39001#1; aAlfa = aAlfa % -102;
     eaAlfa = "wlpl/PAIV-IW"+ aAlfa + "/CONT/index.zul?EDFI"; |HAZ GrabaPortalSin;

     |XCIERRA enHandlePortal;

     |RSYSTEM aAbre;

     aAlfa = eaPathEmision + aFicPortal;      |FBORRA aAlfa;
     aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;

     eaJusti = "";
     |HAZ GrabaImpresoPortal;
|FPRC;

|PROCESO PresentaPortal390;
     |SI eaOpcion = "1";  |HAZ PortalBorrador2018;  |FINSI;
     |SI eaOpcion = "2";  |HAZ PortalPDF2018;       |FINSI;
     |SI eaOpcion = "3";  |HAZ PortalInternet2018;  |FINSI;

     |SI eaOpcion = "6";
         enEmpresa    = #dsm39001#0;
         enComple     = #dsm39001#3;
         eaNomEmpresa = #dsmow014#3;

         eaX002_10    = #t1839001#7;
         eaX002_11    = #t1839001#8;
         eaX002_12    = #dsmoy000#0;
         eaX002_13    = #dsmoy000#6;
         eaX002_14    = 99;

         |SI enComple ] 1;
             eaX002_15 = "C";
             eaX002_16 = #t1839001#24;
             |SI #t1839001#23 = "1";
                 eaX002_15 = "S";
             |FINSI;
         |FINSI;

         eaX002_43 = #dsm39001#6;
         eaX002_44 = #dsm39001#10;
         eaX002_45 = #dsm39001#11;
         eaX002_46 = #dsm39001#12;

         |HAZ PresentaPortal;
     |FINSI;
|FPRC;

|PROCESO Botones2018;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Borrador con validacion ", 0631, 0749, BotonF2;
     nBtnF2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Formulario PDF", 0931, 1049, BotonF3;
     nBtnF3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Presentacion Telematica MANUAL", 1231, 1349, BotonF4;
     nBtnF4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F6> Presentacion Telematica DIRECTA", 1531, 1649, BotonF6;
     nBtnF6 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 1831, 1949, BotonEsc;
     nBtnEs = FSalida;

     eaForzExplorador = "S";

     aF2  = &255 + "824";
     aF3  = &255 + "825";
     aF4  = &255 + "826";
     aF6  = &255 + "828";
     aEsc = &255 + "806";

     eaOpcion = "0";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;

         |SI aTecla = aF2;  eaOpcion = "1"; |SAL;  |FINSI;

         |SI aTecla = aF3;  eaOpcion = "2"; |SAL;  |FINSI;

         |SI aTecla = aF4;
             enPresentar = 0;
             |SI #dsmoy000#6 < 2019;
                 |CONFI "0000SPresentamos la declaracion en el momento de crearlas";
                 |SI FSalida = 0;
                     enPresentar = 1;
                 |FINSI;
             |FINSI;
             eaOpcion   = "3";
             |SAL;
         |FINSI;

         |SI aTecla = aF6;
             |HAZ PermisoPortal;
             |SI enPortal = 1;
                 enDirecta = 1;
                 eaOpcion = "6";
                 |SAL;
             |FINSI;
         |FINSI;

         |SI aTecla = aEsc;                 |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBtnF2;
     |FIN_CONTROL_WINDOWS nBtnF3;
     |FIN_CONTROL_WINDOWS nBtnF4;
     |FIN_CONTROL_WINDOWS nBtnF6;
     |FIN_CONTROL_WINDOWS nBtnEs;

     |PULSATECLA;
|FPRC;
