|FICHEROS;
     dsmoy720 #0;
     dsmoy000 #1;

     :/basica/def/agicen14 #114;
     :/basica/def/agitab99 #99;

     dsmo7201 #720;
     dsmo7202 #721;

     dsmow606 #606;
     dsmow607 #607;

     dsmow014 #999;
     dsmom107 #107;

     &regisnif@ #709;
     &clientes@ #715;
     &datosper@ #718;
|FIN;

|VARIABLES;
     aIPRemoto     = "";
     aBue          = "";

      nAnyo     = 0;
      nSwIm     = 0;
      nDComple  = 0;
      nHComple  = 0;
      nSwUno    = 0;
      nModelo   = 0;
      aComproba = "";
      aContinua = "";
      nDEmpresa = 0;
      nHEmpresa = 0;
      aJusti    = "";
      nHandleEjec = 0;
      nPara1    = 0;
      nHandle   = 0;
     &enPeriodo = 0;
     &enEjer    = 0;
     &eaElProm  = "dsmoy720";
     &enComplem = 0;
     &enSwLinea = 0;
     nPresentar = 0;
|FIN;

|INCLUYE i_varemi;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\

|PROCESO MiraVarMoneda;
     nTecla = FSalida;
     |HAZ PintaMoneda;

     #0#37 = eaMoneda;
     |PINTA #0#37;
     FSalida =  nTecla;
|FPRC;

|PROCESO Modelo;
     |ABRE #99;
     #99#0 = #0#0;
     |LEE 040#99=;
     |SI FSalida ! 0;  |DDEFECTO #99;  |FINSI;
     |CIERRA #99;

     |SI #99#4 = "N";
         |MENAV "     Modelo sin Activar.";
         |ERROR;
     |FINSI;

|ET ElDefecto;
     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#6   = aAlfa;
     |PINTA #0#6;
|FPRC;

|PROCESO Parrilla;
     |SI #0#10 = 0;
         |C_M #0#11, 1, "N"; #0#11 = 0; |PINTA #0#11;
         |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
              |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
          |C_M #0#10, 1, "S";
          |C_M #0#11, 1, "S";

          |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0; |PINTA #0nCampo;
               |C_M #0nCampo, 1, "N";
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO DesdeHasta;
     |C_M #0#10, 1, "S";
     |C_M #0#11, 1, "S";
     #0#36 = 0;  |PINTA #0#36;  |C_M #0#36, 1, "N";

     |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "N";
           #0nCampo = 0;  |PINTA #0nCampo;
     |SIGUE;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|| -----------------------------------------------------------------
|| -----------------------------------------------------------------

|PROCESO GrabaImpreso720;
     |SI enInternet ! 0;
         aAlfa = aDirSesion + "AUXILIAR.TXT";
         |RFBORRA aAlfa;

         aAlfa = aDirSesion + "jus" + (("00000" + #999#0) % -105) + ".xml";
         |RFBORRA aAlfa;

         aAlfa = aDirSesion + eaFichError + #0#6 + ".RST";
         |RFBORRA aAlfa;

         aAlfa = aDirSesion + eaFichError + (("00000" + #999#0) % -105) + ".RST";
         |RFBORRA aAlfa;
     |FINSI;

     aJusti  = "";

     |SI enInternet = 0;
         aAbre   = aDirSesion + "jus" + (("00000" + #999#0) % -105) + ".xml";
         |XABRE "C", aAbre, nHandleEjec;
         |SI FSalida ] 0;
             |PARA;  |SI FSalida ] 0;  |HACIENDO;
                  |XLEE nHandleEjec, 250, aAlfa;

                  aAlfa = aAlfa - "<Justif>";
                  |SI FSalida ! 0;
                      aAlfa  = aAlfa - "</Justif>";  |QBT aAlfa;
                      aAlfa  = aAlfa - "<RST>";      |QBT aAlfa;
                      aAlfa  = aAlfa - "</RST>";     |QBT aAlfa;
                      aJusti = aAlfa % -113;
                      |SAL;
                  |FINSI;
              |SIGUE;
         |FINSI;
         |XCIERRA nHandleEjec;

         |RFBORRA aAbre;

         |SI aJusti = "";
             aAbre   = aDirSesion + eaFichError + (("00000" + #999#0) % -105) + ".RST";
             |XABRE "C", aAbre, nHandleEjec;
             |SI FSalida ] 0;
                 |XLEE nHandleEjec, 250, aJusti;
             |FINSI;
             |XCIERRA nHandleEjec;

             |RFBORRA aAbre;
         |FINSI;
     |FINSI;

     #720#11  = "X";
     #720#12 = #0#7;

     |QBF aJusti;
     aAlfa = aJusti % 0;
     nNume = aAlfa;

     |SI nNume [ 13;
         #720#18 = aJusti;
     |SINO;
         #720#20 = aJusti;
     |FINSI;

     |SI #107#15 = "S";
         #720#16 = "X";
         #720#17 = #0#7;
     |FINSI;

     |SI eaJusti ! "";
         #720#18 = eaJusti;
     |FINSI;

     |GRABA 020#720a;
     |LIBERA #720;
|FPRC;

|| -----------------------------------------------------------------

|PROCESO Boton7201;
     |PTEC 824;
|FPRC;

|PROCESO Boton7202;
     |PTEC 825;
|FPRC;

|PROCESO Boton7203;
     |PTEC 826;
|FPRC;

|PROCESO BtnEsc;
     |PTEC 806;
|FPRC;

|PROCESO Botones720;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Presentacion Telematica      ", 0513, 0754, Boton7202;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, BtnEsc;
     nBoton5 = FSalida;

     aF2  = &255 + "824";
     aF3  = &255 + "825";
     aF4  = &255 + "826";
     aF5  = &255 + "827";
     aF6  = &255 + "828";
     aEsc = &255 + "806";

     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;

         |SI aTecla = aF3; nTecla = 3; |SAL;  |FINSI;
         |SI aTecla = aEsc; nTecla = 0; |SAL; |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton5;

     |PULSATECLA;

|FPRC;

|| //////////////////////////////////
|PROCESO IrPagina;
     |HAZ TraeSoloWait;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "WBC", aAbre, nHandle;

     aAlfa = eaPathLanza + "wait ";

     |SI enEjer < 2014;
         aAlfa = aAlfa + eaPathExplorador + " " + &34 + "https://www1.agenciatributaria.gob.es/wlpl/PAMW-M720/index.zul";
     |SINO;
         aAlfa1 = enEjer; aAlfa1 = aAlfa1 % -102;
         aAlfa = aAlfa + eaPathExplorador + " " + &34 + "https://www1.agenciatributaria.gob.es/wlpl/PA"+ aAlfa1+ "-M720/index.zul";
     |FINSI;

     eaAlfa  = aAlfa;
     eaAlfa = eaAlfa + &13 + &10;
     |XGRABA nHandle, eaAlfa;

     |XCIERRA nHandle;

     |RSYSTEM aAbre;

     aAlfa = eaPathLanza + "imprime.bat";  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + "wait.exe";     |RFBORRA aAlfa;
|FPRC;

|PROCESO Registro1;
     enCodCli = #720#0;
     |HAZ LeePersona;

     |DDEFECTO #606;

     #606#0  = "1";

     #606#1  = "720";

     #606#2  = #720#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #606#3   = eaVarDni;

         eaAlfa   = #715#1;  |HAZ QuitaRaros;
         #606#4   = eaAlfa;

         eaAlfa   = #715#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #715#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #606#6   = eaAlfa;

         eaAlfa   = #715#53;  |HAZ QuitaRaros;
         #606#7   = eaAlfa;

     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #606#3   = eaVarDni;

         eaAlfa   = #715#1;   |HAZ QuitaRaros;
         #606#4   = eaAlfa;

         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;
         |QBF eaAlfa;
         |SI eaAlfa = "";  eaAlfa = "000000000";  |FINSI;
         #606#6   = eaAlfa;

         eaAlfa   = #715#96;  |HAZ QuitaRaros;
         #606#7   = eaAlfa;

     |FINSI;

     #606#5  = "T";
     #606#8 = "0000000000000";

     |SI enDirecta = 1;
         |HAZ CalcJustificante;
         #dsmow606#8 = eaJusti;
     |FINSI;

     |SI #720#19 = "C";
         #606#9  = "C";
         #606#11 = #720#22;
     |FINSI;

     |SI #720#19 = "S";
         #606#10 = "S";
         #606#11 = #720#22;
     |FINSI;

     nNume   = #720#8;
     #606#12 = ("000000000" + nNume) % -109;

     enNume  = #720#6;
     |HAZ Conver17Signo;
     #606#13 = eaSigno + eaAlfa;

     enNume  = #720#7;
     |HAZ Conver17Signo;
     #606#14 = eaSigno + eaAlfa;

     #606#19 = &13 + &10;

     nHCampo = 19;
     |SI nTecla ! "3";
         nHCampo = 18;
     |FINSI;

     |SI nTecla ! 4;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #606nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |FINSI;
     nTRegistro = nTRegistro + 1;
|FPRC;

|PROCESO Registro2;

     enCodCli = #720#0;
     |HAZ LeePersona;

     |DDEFECTO #607;

     #607#0  = "2";

     #607#1  = "720";

     #607#2  = #720#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #607#3   = eaVarDni;
         #607#4   = eaVarDni;

         eaAlfa   = #715#1;  |HAZ QuitaRaros;
         #607#6   = eaAlfa;

     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #607#3   = eaVarDni;
         #607#4   = eaVarDni;

         eaAlfa   = #715#1;   |HAZ QuitaRaros;
         #607#6   = eaAlfa;

     |FINSI;

     |SI #721#9 = "S";
         eaVarDni = #721#8;  |HAZ CalculameDNI;
         #607#6 = eaVarDni;
     |FINSI;

     #607#7  = #721#11;
     |SI #721#11 = 8;
         eaAlfa  = #721#12; |HAZ QuitaRaros;
         #607#8 = eaAlfa;
     |FINSI;

     #607#9   = #721#13;
     #607#10  = #721#14;

     |SI #721#13 = "B"; |Y #721#14 = 5;
         eaAlfa  = #721#15; |HAZ QuitaRaros;
         #607#11 = eaAlfa;
     |FINSI;

     #607#12  = #721#16;
     #607#13  = #721#17;

     |SI #721#13 = "V"; |O  #721#13 = "I";
         eaAlfa  = #721#18; |HAZ QuitaRaros;
         #607#14 = eaAlfa;
     |FINSI;

     #607#15  = #721#19;
     #607#16  = #721#20;
     #607#17  = #721#21;

     |SI #721#13 ! "B";
         eaAlfa  = #721#22; |HAZ QuitaRaros;
         #607#18 = eaAlfa;
         #607#19 = #721#23;
     |FINSI;

     #607#20 = #721#24;
     #607#21 = #721#25;
     #607#22 = #721#26;
     #607#23 = #721#27;
     #607#24 = #721#28;
     #607#25 = #721#29;

     aAlfa = "00000000";
     |SI #721#30 > "01.01.0000";
         aAlfa = #721#30;
         aAlfa = (aAlfa % -104) + (aAlfa % 402) + (aAlfa % 102);
     |FINSI;
     #607#26 = aAlfa;

     #607#27 = #721#31;

     aAlfa = "00000000";
     |SI #721#32 > "01.01.0000"; |Y #721#31 = "C";
         aAlfa = #721#32;
         aAlfa = (aAlfa % -104) + (aAlfa % 402) + (aAlfa % 102);
     |FINSI;
     #607#28 = aAlfa;

     enNume  = #721#33;
     |HAZ Conver14Signo;
     #607#29 = eaSigno + eaAlfa;

     enNume  = #721#34;
     |HAZ Conver14Signo;
     #607#30 = eaSigno + eaAlfa;

     |SI #721#13 = "V"; |O #721#13 = "I";
         #607#31 = #721#35;

         enNume = #721#36;
         |HAZ Conver12;
         #607#32 = eaAlfa;
     |FINSI;

     |SI #721#13 = "B";
         #607#33 = #721#37;
     |FINSI;

     enNume = #721#38;
     |SI enCambiaMoneda = 1;
         |HAZ ConverMoneda;
     |FINSI;
     eaAlfa = ("00000" + enNume) % -105;
     #607#34 = eaAlfa;

     #607#36 = &13 + &10;

     nHCampo = 36;
     |SI nTecla ! "3";
         nHCampo = 35;
     |FINSI;

     |SI nTecla ! 4;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #607nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |SINO;
         |PRINT;
     |FINSI;
     nTRegistro = nTRegistro + 1;
|FPRC;

|DEFBUCLE Carga7202;
     #721#1;
     39;
     #720#0, #720#1, #720#2, #720#3, #720#4, #720#5, 001, "S";
     #720#0, #720#1, #720#2, #720#3, #720#4, #720#5, 999, "S";
     e;
     NULL, Registro2;
|FIN;

|PROCESO dsmow014M720;
     #720#0  = #999#0;
     #720#1  = #999#1;
     #720#2  = #999#2;
     #720#3  = #999#5;
     #720#4  = #999#7;
     #720#5  = 0;
     |LEE 040#720=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     eaFicheroPlano = "720" + (("00000" + #999#0) % -105) + ".txt";
     eaFicheroImpre = "720" + (("00000" + #999#0) % -105) + ".pdf";
     eaFicheroSalid = "720" + (("00000" + #999#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #999#0) % -105) + ".txt";

     aAlfa = eaPathLanza + eaFicheroPlano;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroImpre;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroError;  |RFBORRA aAlfa;

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     nTRegistro = 0;
     |HAZ Registro1;
     |BUCLE Carga7202;

     |XCIERRA nHandle2;

     enEmpresa    = #dsmow014#0;
     enComple     = #dsmow014#7;
     eaNomEmpresa = #dsmow014#3;

     |SI nTecla = 4;
         |SI nTRegistro ! 0;
             |PIEINF;
         |FINSI;

         |ACABA;
     |FINSI;

     |SI enEjer < 2018;
         eaFOrigen  = eaPathEmision  + eaFicheroPlano;
         eaFDestino = eaPathInternet + eaFicheroPlano;
         |HAZ CopiaFichero;

         |HAZ GrabaImpreso720;

         enSwHay = enSwHay + 1;

         |ACABA;
     |FINSI;

     #dsmoy000#0 = 720;
     #dsmoy000#6 = enEjer;

     |SI enDirecta = 0;
         |HAZ GrabaImpreso720;
         enSwHay = enSwHay + 1;
         |HAZ PresentaPortal;
     |FINSI;

     |SI enDirecta = 1;
         enEmpresa    = #dsmow014#0;
         enComple     = #dsmow014#7;
         eaNomEmpresa = #dsmow014#3;

         eaX002_10    = #dsmow606#3;
         eaX002_11    = #dsmow606#4;
         eaX002_12    = #dsmoy000#0;
         eaX002_13    = #dsmoy000#6;
         eaX002_14    = 99;

         |SI #dsmow606#9 ! " ";
             eaX002_15 = #dsmow606#9;
         |FINSI;

         |SI #dsmow606#10 ! " ";
             eaX002_15 = #dsmow606#10;
             eaX002_16 = #dsmow606#11;
         |FINSI;

         eaX002_35 = #dsmo7201#6;
         eaX002_36 = #dsmo7201#7;
         |HAZ PresentaPortal;
         |SI enOK = 1;
             eaJusti = "";
             |HAZ GrabaImpreso720;
             enSwHay = enSwHay + 1;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmow014C720;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, dsmow014M720;
|FIN;

|DEFBUCLE dsmow014N720;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, dsmow014M720;
|FIN;


|PROCESO Bloque2013;
     |SI aComproba ! "C";
         |SI enEjer [ 2017;
             |HAZ Botones720;
         |SINO;
             |HAZ BtnAnuales2015;
             nTecla = eaOpcion;
             |SI nTecla = 4;
                 nTecla = 3;
             |FINSI;
         |FINSI;
     |SINO;
          nTecla = 4;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1;  |ACABA;  |FINSI;
     |SI nTecla = 4;  enInfComp = 1;  |FINSI;

     |SI nTecla = 4;
         Impresora = "CrystalReport";
         |IMPRE -1;
         |SI FSalida ! 0;
             |MENAV "0000 No tiene instalada Impresora CrystalReport, pongase en contacto con su Administrador";
             |ACABA;
         |FINSI;

         |SI #0#39 = "D";
             |INFOR "m720co01";
         |SINO;
             |INFOR "m720co02";
         |FINSI;
         |SI FSalida ! 0;
             |MENAV "    Error en el Informe";
             |FINIMP;
             |ACABA;
         |FINSI;
     |FINSI;

     enSwHay = 0;
     |ABRE #720;
     |SI #0#8 = "C";
         |BUCLE dsmow014C720;
     |SINO;
         |BUCLE dsmow014N720;
     |FINSI;
     |CIERRA #720;

     |SI nTecla = 3; |Y enSwHay ! 0;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;

/*
         nPresentar = 0;
         |CONFI "0000NDesea presentar en estos momentos la declaracion";
         |SI FSalida = 0;
             nPresentar = 1;
         |FINSI;

         |SI nPresentar = 1; |HAZ IrPagina; |FINSI;
*/
     |FINSI;

     |SI enDirecta = 1;  |Y enMsv = 1;  |Y enParar = 0;
         |SUB_EJECUTA "|dsmox007";
     |FINSI;

     |SI nTecla = 4;
         |FININF;
         |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Prdsmoy720;

     enSwTrata      = 0;
     enCambiaMoneda = 1;

     |HAZ Bloque2013;
|FPRC;

|| -----------------------------------------------------------------
|PROCESO GrabaTempo;
     enEmpresaPINET = #720#0;
     |HAZ RestriccionPINET;
     |SI enErrorPINET = 1;  |ACABA;  |FINSI;

     |SI #0#9 = "N";
         |SI #720#11 = "X";   |ACABA;  |FINSI;
     |SINO;
         |SI #0#9 = "S";  |Y aComproba ! "C";
             |SI #720#16 = "X";  |ACABA;  |FINSI;
         |FINSI;
     |FINSI;

     enCodCli = #720#0;
     |HAZ LeePersona;

     #999#0  = #720#0;
     #999#1  = #720#1;
     #999#2  = #720#2;
     |LEE 101#999=;
     |SI FSalida ! 0;
         |DDEFECTO #999;
         #999#0  = #720#0;
         #999#1  = #720#1;
         #999#2  = #720#2;
         |GRABA 020#999b;
     |FINSI;

     #999#3  = #715#1;
     #999#4  = #0#5;
     #999#5  = #0#0;
     #999#6  = "S";
     #999#7  = #720#4;
     |GRABA 020#999a;
     |LIBERA #999;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE dsmo7201;
     #720#1;
     9;
     nDEmpresa, #0#6, 99, #0#0, nDComple, 00, "X";
     nHEmpresa, #0#6, 99, #0#0, nHComple, 99, "X";
     ;
     NULL, GrabaTempo;
|FIN;

|RUTINA ClaveBaja999;
     #999#0 = 1;
     #999#1 = 0000;
     #999#2 = 00;
|FRUT;

|RUTINA ClaveAlta999;
     #999#0 = 99999;
     #999#1 = 9999;
     #999#2 = 99;
|FRUT;

|PROCESO MiraCuantos;
     enSwHay = enSwHay + 1;
|FPRC;

|DEFBUCLE dsmow014M;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, MiraCuantos;
|FIN;

|PROCESO Tipo3;  |TIPO 3;

     |DDEFECTO #1;   || para las subrutinas de impresion necesita el dsmoy000
     |PARA nPara1 = 0; |SI nPara1 [ 38; |HACIENDO nPara1 = nPara1 + 1;
           #1nPara1 = #0nPara1;
     |SIGUE;
     eaMoneda = #0#37;

     nDComple = 0; nHComple = 99;
     |SI eaParametro = "PLANING"; |O nSwUno = 1;
         nDComple = enComplem;
         nHComple = enComplem;
     |FINSI;

     aFichero = ("imp" + Usuario) % 108;
     |NOME_DAT #999 aFichero;
     |DELINDEX #999;

     nSwGraba = 0;

    |ABRE #999;
    |SI #0#10 ! 0;
        nDEmpresa = #0#10;
        nHEmpresa = #0#11;
        |BUCLE dsmo7201;
    |SINO;
        |PARA nCampo = 12;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
              |SI #0nCampo ! 0;
                  nDEmpresa = #0nCampo;
                  nHEmpresa = #0nCampo;
                  |BUCLE dsmo7201;
              |FINSI;
        |SIGUE;
    |FINSI;
    |CIERRA #999;

    |SI nSwGraba = 1;
        |SI #0#39 ! "R";
            |PINPA #0#999;
            |HAZ PonBoton;
            |ENTLINEAL #1#999, -1, 4, 21, 0, ClaveBaja999, ClaveAlta999;
            |HAZ QuitaBoton;
        |FINSI;
        enSwHay = 0;
        |BUCLE dsmow014M;
    |SINO;
        |MENAV "     Seleccion Vacia.";
        |DELINDEX #999;
        |ACABA;
    |FINSI;

     eaPathLanza = eaUnidadBasico + "\AEAT";   |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + #0#0;   |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + #0#6;   |RMKDIR eaPathLanza;
     |SI #0#4 ! 99;
         eaPathLanza = eaPathLanza + "\" + (("00" + #0#4) % -102);  |RMKDIR eaPathLanza;
     |FINSI;
     eaPathLanza = eaPathLanza + "\";

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";                     |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + #0#0;                      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + #0#6;                      |MKDIR eaPathEmision;
     |SI #0#4 ! 99;
         eaPathEmision = eaPathEmision + "/" + (("00" + #0#4) % -102);    |MKDIR eaPathEmision;
     |FINSI;
     eaPathEmision = eaPathEmision + "/";

     |HAZ LeeUnidad;
     eaPathInternet = eaUnidad + "/AEAT";                             |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";                   |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + #0#0;                    |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + #0#6;                    |RMKDIR eaPathInternet;
     |SI #0#4 ! 99;
         eaPathInternet = eaPathInternet + "/" + (("00" + #0#4) % -102);  |RMKDIR eaPathInternet;
     |FINSI;
     eaPathInternet = eaPathInternet + "/";

     |SI enSwHay = 0;
         |MENAV "      Seleccion Vacia";
     |SINO;
         |HAZ Prdsmoy720;
     |FINSI;

     |DELINDEX #999;
|FPRC;

|PROGRAMA;
     |HAZ LeeUnidad;

     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     nSwUno      = 0;
     enCalcCif   = 0;
     eaParametro = PARAMETRO;  |QBF eaParametro;
     aComproba   = eaParametro % -101;
     |SI eaParametro = "PLANING"; |O eaParametro = "INFC";
         |DDEFECTO #0;
         #0#0  = enModelo;
         #0#4  = 99;
         #0#6  = enEjer;
         #0#9  = "X";
         #0#10 = enEmpresa;
         #0#11 = enEmpresa;

         |HAZ PintaMoneda;
         #0#37 = eaMoneda;

         |PUSHV 0501 2380;
         |BLANCO 1025 1244;
         |CUADRO 0925 1244;
         |ATRI R;
         |SI eaParametro = "INFC";
             |PINTA 1026, "  FECHA INFORME   ";
             aAlfa       = enModelo;
             eaParametro = aAlfa + "C";
             nSwUno      = 1;
         |SINO;
             |PINTA 1026, "FECHA PRESENTACION";
         |FINSI;
         |ATRI r;

         fFecha = ~;
         fFecha = 1130 ? 1;

         #0#7 = fFecha;

         |POPV;

         |HAZ Tipo3;

         |ACABA;
     |FINSI;

     |ABRE #99;
     #99#0 = 720;
     |LEE 040#99=;
     |SI FSalida ! 0;  |DDEFECTO #99;  |FINSI;
     |CIERRA #99;

     |DDEFECTO #0;

     #0#0  = 720;
     |PINPA #0#0;
     |SI aComproba = "C";
         aAlfa = " Informe de Comprobacion Modelo Oficial 720 ";
         |ATRI R; |PINTA 0602, aAlfa; |ATRI 0;
         |C_V #0#39, 1, "S"; |C_M #0#39, 1, "S";
         |PINTA 1805,"쿔nf. Detallado/Resumido. :            ";
         |PINTA 1905,"읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸";
     |FINSI;
     |PINDA #0#0;
     |ENDATOS #1#0;

     |HAZ FinalizaEnX;

     |PULSATECLA;
|FPRO;
