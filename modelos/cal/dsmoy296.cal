|FICHEROS;
     dsmoy000 #0;
     dsmom004 #4;
     dsmom107 #107;

     dsm296ca #296;
     dsm296li #297;

     dsmow014 #999;

     dsmow579 #579;
     dsmow580 #580;
     dsmow581 #581;
     dsmow582 #582;

     &regisnif@ #709;
     &clientes@ #715;
|FIN;

|VARIABLES;
     aNombre     = "";
     aPathAfegir = "";
     aIPRemoto   = "";
     aBue        = "";

     fDd         = @;
     fHd         = @;
|FIN;

|INCLUYE i_varemi;

|PROCESO Registro1_2007;
     enCodCli = #296#0;
     |HAZ LeePersona;

     |DDEFECTO #579;

     #579#0  = "1";

     #579#1  = "296";

     #579#2  = #296#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #579#3   = eaVarDni;

         eaAlfa   = #715#1;  |HAZ QuitaRaros;
         #579#4   = eaAlfa;

         eaAlfa   = #715#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #715#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #579#6   = eaAlfa;

         eaAlfa   = #715#53;  |HAZ QuitaRaros;
         #579#7   = eaAlfa;

         eaDeleg     = #715#17;
         eaAdmin     = #715#18;
         eaProvincia = #715#38;
     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #579#3   = eaVarDni;

         eaAlfa   = #715#1;   |HAZ QuitaRaros;
         #579#4   = eaAlfa;

         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;
         #579#6   = eaAlfa;

         eaAlfa   = #715#96;  |HAZ QuitaRaros;
         #579#7   = eaAlfa;

         eaDeleg     = #715#91;
         eaAdmin     = #715#92;
         eaProvincia = #715#12;
     |FINSI;

     #579#5  = "T";

     #579#8 = "2970000000000";

     |SI #296#11 = "C";  #579#9  = "C";  |FINSI;

     |SI #296#11 = "S";
         #579#10 = "S";
         #579#11 = #296#10;
     |FINSI;

     nNume   = #296#6;
     #579#12 = ("000000000" + nNume) % -109;

     enNume  = #296#7;  |HAZ Conver15Signo;
     #579#13 = eaSigno + (eaAlfa % -114);

     enNume  = #296#8;  |HAZ Conver15;
     #579#14 = eaAlfa;

     enNume  = #296#9;  |HAZ Conver15;
     #579#15 = eaAlfa;

     #579#17 = &13 + &10;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #579nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Registro1_2008;
     enCodCli = #296#0;
     |HAZ LeePersona;

     |DDEFECTO #581;

     #581#0  = "1";

     #581#1  = "296";

     #581#2  = #296#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #581#3   = eaVarDni;

         eaAlfa   = #715#1;  |HAZ QuitaRaros;
         #581#4   = eaAlfa;

         eaAlfa   = #715#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #715#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #581#6   = eaAlfa;

         eaAlfa   = #715#53;  |HAZ QuitaRaros;
         #581#7   = eaAlfa;

         eaDeleg     = #715#17;
         eaAdmin     = #715#18;
         eaProvincia = #715#38;
     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #581#3   = eaVarDni;

         eaAlfa   = #715#1;   |HAZ QuitaRaros;
         #581#4   = eaAlfa;

         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;
         #581#6   = eaAlfa;

         eaAlfa   = #715#96;  |HAZ QuitaRaros;
         #581#7   = eaAlfa;

         eaDeleg     = #715#91;
         eaAdmin     = #715#92;
         eaProvincia = #715#12;
     |FINSI;

     #581#5  = "T";

     #581#8 = "2960000000000";

     |SI enDirecta = 1;
         |HAZ CalcJustificante;
         #dsmow581#8 = eaJusti;
     |FINSI;

     |SI #296#11 = "C";  #581#9  = "C";  |FINSI;

     |SI #296#11 = "S";
         #581#10 = "S";
         #581#11 = #296#10;
     |FINSI;

     nNume   = #296#6;
     #581#12 = ("000000000" + nNume) % -109;

     enNume  = #296#7;  |HAZ Conver15Signo;
     #581#13 = eaSigno + (eaAlfa % -114);

     enNume  = #296#8;  |HAZ Conver15;
     #581#14 = eaAlfa;

     enNume  = #296#9;  |HAZ Conver15;
     #581#15 = eaAlfa;

     #581#19 = &13 + &10;

     nHCampo = 19;
     |SI #dsmoy000#6 ] 2012; |Y eaOpcion ! "3";
         nHCampo = 18;
     |FINSI;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #581nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Registro296_1;
     |SI #0#6 [ 2007;
         |HAZ Registro1_2007;
     |SINO;
         |HAZ Registro1_2008;
     |FINSI;
|FPRC;

|PROCESO Registro2_2007;
     enCodCli = #296#0;
     |HAZ LeePersona;

     |DDEFECTO #580;

     #580#0  = "2";

     #580#1  = "296";

     #580#2  = #296#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #580#3   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #580#3   = eaVarDni;
     |FINSI;

     eaVarDni = #297#6;  |HAZ CalculameDNI;
     |SI #297#16 = "N";
         #580#4 = eaVarDni;
     |SINO;
         #580#5 = eaVarDni;
     |FINSI;

     |SI #297#6  = "999999999999";
         #580#4  = "999999999";
         #580#5  = "999999999";
         #580#23 = "X";
     |FINSI;

     #580#6 = #297#17;

     eaAlfa  = #297#15;  |HAZ QuitaRaros;
     #580#7  = eaAlfa;
     #580#8  = #297#19;
     #580#9  = #297#18;
     #580#10 = (#297#7 % 102) + (#297#7 % 402) + (#297#7 % 704);

     |SI #297#8 = 1;  #580#11 = "D";  |FINSI;
     |SI #297#8 = 2;  #580#11 = "E";  |FINSI;

     #580#12 = #297#9;
     #580#13 = ("00" + #297#10) % -102;

     enNume  = #297#11;  |HAZ Conver13Signo;
     #580#14 = eaSigno + (eaAlfa % -112);

     nNume   = #297#12 * 100;
     #580#15 = ("0000" + nNume) % -104;

     enNume  = #297#13;  |HAZ Conver13Signo;
     #580#16 = eaAlfa;

     |SI #297#20 = "S";  #580#17 = "X";  |FINSI;

     #580#18 = #297#21;
     #580#19 = #297#22;
     #580#20 = #297#23;
     #580#21 = #297#24;
     #580#22 = #297#25;
     #580#24 = ("0000" + #297#27) % -104;
     #580#25 = (#297#27 % 704) + (#297#27 % 402) + (#297#27 % 102);
     #580#26 = (#297#28 % 704) + (#297#28 % 402) + (#297#28 % 102);

     |SI #297#27 [ "01.01.0000";   #580#25 = "00000000";  |FINSI;
     |SI #297#28 [ "01.01.0000";   #580#26 = "00000000";  |FINSI;

     enNume  = #297#29;  |HAZ Conver12;
     #580#27 = eaAlfa;

     enNume  = #297#30;  |HAZ Conver12;
     #580#28 = eaAlfa;

     enNume  = #297#31;  |HAZ Conver12;
     #580#29 = eaAlfa;

     #580#31 = &13 + &10;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #580nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |SINO;
         |PRINT;
         nSwPrint = 1;
     |FINSI;
|FPRC;

|PROCESO Registro2_2008;
     enCodCli = #296#0;
     |HAZ LeePersona;

     |DDEFECTO #582;

     #582#0  = "2";

     #582#1  = "296";

     #582#2  = #296#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #582#3   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #582#3   = eaVarDni;
     |FINSI;

     eaVarDni = #297#6;  |HAZ CalculameDNI;
     |SI #297#16 = "N";
         #582#4 = eaVarDni;
     |SINO;
         #582#5 = eaVarDni;
     |FINSI;

     |SI #297#6  = "999999999999";
         #582#4  = "999999999";
         #582#5  = "999999999";
         #582#23 = "X";
     |FINSI;

     #582#6  = #297#17;

     eaAlfa  = #297#15;  |HAZ QuitaRaros;
     #582#7  = eaAlfa;
     #582#8  = "";
     #582#9  = "";
     #582#10 = (#297#7 % 102) + (#297#7 % 402) + (#297#7 % 704);

     |SI #297#7 [ "01.01.0000";   #582#10 = "00000000";  |FINSI;

     |SI #297#8 = 1;  #582#11 = "D";  |FINSI;
     |SI #297#8 = 2;  #582#11 = "E";  |FINSI;

     |SI #297#9 = "A";  #582#12 = "01";  |FINSI;
     |SI #297#9 = "B";  #582#12 = "02";  |FINSI;
     |SI #297#9 = "C";  #582#12 = "03";  |FINSI;
     |SI #297#9 = "D";  #582#12 = "04";  |FINSI;
     |SI #297#9 = "E";  #582#12 = "05";  |FINSI;
     |SI #297#9 = "F";  #582#12 = "06";  |FINSI;
     |SI #297#9 = "G";  #582#12 = "07";  |FINSI;
     |SI #297#9 = "H";  #582#12 = "08";  |FINSI;
     |SI #297#9 = "I";  #582#12 = "09";  |FINSI;
     |SI #297#9 = "J";  #582#12 = "10";  |FINSI;
     |SI #297#9 = "K";  #582#12 = "11";  |FINSI;
     |SI #297#9 = "L";  #582#12 = "12";  |FINSI;
     |SI #297#9 = "M";  #582#12 = "13";  |FINSI;
     |SI #297#9 = "N";  #582#12 = "14";  |FINSI;
     |SI #297#9 = "O";  #582#12 = "15";  |FINSI;
     |SI #297#9 = "P";  #582#12 = "16";  |FINSI;
     |SI #297#9 = "Q";  #582#12 = "17";  |FINSI;
     |SI #297#9 = "R";  #582#12 = "18";  |FINSI;
     |SI #297#9 = "S";  #582#12 = "19";  |FINSI;
     |SI #297#9 = "T";  #582#12 = "20";  |FINSI;
     |SI #297#9 = "U";  #582#12 = "21";  |FINSI;
     |SI #297#9 = "V";  #582#12 = "22";  |FINSI;
     |SI #297#9 = "W";  #582#12 = "23";  |FINSI;
     |SI #297#9 = "X";  #582#12 = "24";  |FINSI;
     |SI #297#9 = "Y";  #582#12 = "25";  |FINSI;

     #582#13 = ("00" + #297#10) % -102;

     enNume  = #297#11;  |HAZ Conver13Signo;
     #582#14 = eaSigno + (eaAlfa % -112);

     nNume   = #297#12 * 100;
     #582#15 = ("0000" + nNume) % -104;

     enNume  = #297#13;  |HAZ Conver13Signo;
     #582#16 = eaAlfa;

     |SI #297#20 = "S";  #582#17 = "X";  |FINSI;

     #582#18 = #297#21;
     #582#19 = #297#22;
     #582#20 = #297#23;
     #582#21 = #297#24;
     #582#22 = #297#25;
     #582#24 = ("0000" + #297#27) % -104;
     #582#25 = (#297#27 % 704) + (#297#27 % 402) + (#297#27 % 102);
     #582#26 = (#297#28 % 704) + (#297#28 % 402) + (#297#28 % 102);

     |SI #297#27 [ "01.01.0000";   #582#25 = "00000000";  |FINSI;
     |SI #297#28 [ "01.01.0000";   #582#26 = "00000000";  |FINSI;

     enNume  = #297#29;  |HAZ Conver12;
     #582#27 = eaAlfa;

     enNume  = #297#30;  |HAZ Conver12;
     #582#28 = eaAlfa;

     enNume  = #297#31;  |HAZ Conver12;
     #582#29 = eaAlfa;

     eaAlfa   = #297#32;  |HAZ QuitaRaros;  #582#30  = eaAlfa;
     eaAlfa   = #297#33;  |HAZ QuitaRaros;  #582#31  = eaAlfa;
     eaAlfa   = #297#34;  |HAZ QuitaRaros;  #582#32  = eaAlfa;
     eaAlfa   = #297#35;  |HAZ QuitaRaros;  #582#33  = eaAlfa;
     eaAlfa   = #297#36;  |HAZ QuitaRaros;  #582#34  = eaAlfa;
                                            #582#35  = #297#18;
     eaAlfa   = #297#37;  |HAZ QuitaRaros;  #582#37  = eaAlfa;
     eaAlfa   = #297#39;  |HAZ QuitaRaros;  #582#39  = eaAlfa;
     eaAlfa   = #297#40;  |HAZ QuitaRaros;  #582#40  = eaAlfa;
     eaAlfa   = #297#41;  |HAZ QuitaRaros;  #582#41  = eaAlfa;

     #582#38 = (#297#38 % 102) + (#297#38 % 402) + (#297#38 % 704);

     |SI #297#38 [ "01.01.0000";   #582#38 = "00000000";  |FINSI;

     #582#43 = &13 + &10;

     nHCampo = 43;
     |SI #dsmoy000#6 ] 2012; |Y eaOpcion ! "3";
         nHCampo = 42;
     |FINSI;

     |SI nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #582nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |SINO;
         |PRINT;
         nSwPrint = 1;
     |FINSI;
|FPRC;

|PROCESO Registro296_2;
     |SI #0#6 [ 2007;
         |HAZ Registro2_2007;
     |SINO;
         |HAZ Registro2_2008;
     |FINSI;
|FPRC;

|DEFBUCLE dsm296li;
     #297#1;
     ;
     #296#0,#296#1,#296#2,#296#3,#296#4,#296#5,"            ",fDd,1," ",00;
     #296#0,#296#1,#296#2,#296#3,#296#4,#296#5,"zzzzzzzzzzzz",fHd,2,"z",99;
     ;
     NULL, Registro296_2;
|FIN;

|PROCESO Lee2961;        || Creacion de Ficheros
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #296;
     #296#0  = #999#0;
     #296#1  = #999#1;
     #296#2  = #999#2;
     #296#3  = #999#5;
     #296#4  = #999#7;
     #296#5  = 0;
     |LEE 040#296=;
     |SI FSalida = 0;
         aAbre = eaPathEmision + "296" + (("00000" + #999#0) % -105) + ".TXT";
         |XABRE "BW", aAbre, nHandle2;
     |FINSI;

     |HAZ Registro296_1;

     |BUCLE dsm296li;

     |XCIERRA nHandle2;

     eaFOrigen  = eaPathEmision  + "296" + (("00000" + #999#0) % -105) + ".TXT";
     eaFDestino = eaPathLanza    + "296" + (("00000" + #999#0) % -105) + ".TXT";

     |HAZ CopiaFichero;
     |FBORRA eaFOrigen;

     eaTipoE =  "296" + (("00000" + #999#0) % -105) + ".TXT";
     eaTipoR =  "RCC" + (("00000" + #999#0) % -105) + ".TXT";
     eaTipoV =  "S";

     |HAZ LineaShellJava;

     |CIERRA #296;
|FPRC;

|PROCESO Lee296P;       || Emision Papel
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #296;
     #296#0  = #999#0;
     #296#1  = #999#1;
     #296#2  = #999#2;
     #296#3  = #999#5;
     #296#4  = #999#7;
     #296#5  = 0;
     |LEE 040#296=;
     |SI FSalida = 0;
         |HAZ Registro296_1;
         |BUCLE dsm296li;
         |SI nSwPrint = 0;
             |DDEFECTO #297;
             |PRINT;
         |FINSI;
         |PIEINF;
     |FINSI;
     |CIERRA #296;
|FPRC;

|PROCESO QueHacemos296;
     |SI nTecla = 5;
         |HAZ Lee296P;
         |ACABA;
     |FINSI;

     |HAZ Lee2961;          || Creacion de los Ficheros Planos.
|FPRC;

|DEFBUCLE dsmow014C296;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos296;
|FIN;

|DEFBUCLE dsmow014N296;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos296;
|FIN;

|PROCESO Boton2961;
     |PTEC 824;
|FPRC;

|PROCESO Boton2962;
     |PTEC 825;
|FPRC;

|PROCESO Boton2963;
     |PTEC 826;
|FPRC;

|PROCESO Boton2964;
     |PTEC 827;
|FPRC;

|PROCESO Boton2965;
     |PTEC 828;
|FPRC;

|PROCESO Boton2966;
     |PTEC 806;
|FPRC;

|PROCESO PapelContinuo296;
     Impresora = "CrystalReports";
     |IMPRE -1;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI nTeclaPapel = 0;
         |SI #0#6 [ 2007;
             |INFOR "m296co01";
         |SINO;
             |INFOR "m296co02";
         |FINSI;
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#8 = "C";
         |BUCLE dsmow014C296;
     |SINO;
         |BUCLE dsmow014N296;
     |FINSI;

     |FININF;
     |FINIMP;
|FPRC;

|PROCESO PapelOficial296;
     nTeclaPapel = 0;
     |HAZ PapelContinuo296;
|FPRC;

|PROCESO Botones296;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Generacion Fichero para Internet", 0513, 0754, Boton2961;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Informe de Comprobacion              ", 0913, 1154, Boton2964;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2165, 2178, Boton2966;
     nBoton3 = FSalida;

     aF2 = &255 + "824";
     aF5 = &255 + "827";
     aF7 = &255 + "806";

     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTecla = 1;   |SAL;  |FINSI;
         |SI aTecla = aF5;
             nTecla = 5;
             |HAZ PapelOficial296;
         |FINSI;
         |SI aTecla = aF7;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;

     |PULSATECLA;
|FPRC;

|PROCESO CreaVarios;
     aIPRemoto   = "";
     |IP_REMOTO aIPRemoto;

     aPathInter  = eaPathLanza + "AInternet";
     aPathInter  = aPathInter + "/";
     aFichero    = aPathInter + "*.bue";
     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            aBue     = aFichero - aPathInter;
            aDestino = eaPathInternet + "296" + (aBue % 405) + ".txt";

            |RCOPIA_FICHERO aFichero, aDestino;

            |RFBORRA aFichero;

            |R_SDIR aFichero;
     |SIGUE;

     aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
     |MENAV aAlfa;
|FPRC;

|PROCESO Internet;
     eaFichError  = "rcc";
     eaFichDatos  = "296";
     eaFichAuxil  = "";
     enValidacion = 1;

     |HAZ BuscaErroresL;

     |SI enBuenos = 0;
         |MENAV "      Ha habido Errores, arreglelos y vuelva a emitir.";
         |ACABA;
     |FINSI;

     |HAZ CreaVarios;
|FPRC;

|PROCESO Proceso296;
     |SI #0#8 = "C";
         |BUCLE dsmow014C296;
     |SINO;
         |BUCLE dsmow014N296;
     |FINSI;

     |HAZ Internet;
|FPRC;

|PROCESO Bloque2011;
     |SI nTecla = 5;
         enInfComp = 1;
         |HAZ PapelOficial296;
         |ACABA;
     |FINSI;

     |HAZ Botones296;

     |SI nTecla = 0;  enInfComp = 1;  |ACABA;  |FINSI;

     |HAZ Proceso296;
|FPRC;

|PROCESO Portal296_2012;
     #296#0  = #999#0;
     #296#1  = #999#1;
     #296#2  = #999#2;
     #296#3  = #999#5;
     #296#4  = #999#7;
     #296#5  = 0;
     |LEE 040#296=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     eaFicheroPlano = "296" + (("00000" + #999#0) % -105) + ".txt";
     eaFicheroImpre = "296" + (("00000" + #999#0) % -105) + ".imp";
     eaFicheroSalid = "296" + (("00000" + #999#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #999#0) % -105) + ".txt";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Registro296_1;

     |BUCLE dsm296li;

     |XCIERRA nHandle2;

     enEmpresa    = #dsmow014#0;
     enComple     = #dsmow014#7;
     eaNomEmpresa = #dsmow014#3;

     eaX002_10    = #dsmow581#3;
     eaX002_11    = #dsmow581#4;
     eaX002_12    = #dsmoy000#0;
     eaX002_13    = #dsmoy000#6;
     eaX002_14    = 99;

     |SI #dsmow581#9 ! " ";
         eaX002_15 = #dsmow581#9;
     |FINSI;

     |SI #dsmow581#10 ! " ";
         eaX002_15 = #dsmow581#10;
         eaX002_16 = #dsmow581#11;
     |FINSI;

     eaX002_20 = #dsmow581#12;
     eaX002_21 = #dsm296ca#7;
     eaX002_22 = #dsm296ca#8;

     |HAZ PresentaPortal;
|FPRC;

|DEFBUCLE dsmow014C296_2012;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, Portal296_2012;
|FIN;

|DEFBUCLE dsmow014N296_2012;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, Portal296_2012;
|FIN;

|PROCESO Bloque2012;
     |HAZ BtnAnuales2012;

     |SI eaOpcion = "0";  enInfComp = 1;  |ACABA;  |FINSI;

     nTecla = 1;

     |ABRE #296;
     |ABRE #4;
     |SI #0#8 = "C";
         |BUCLE dsmow014C296_2012;
     |SINO;
         |BUCLE dsmow014N296_2012;
     |FINSI;
     |CIERRA #296;
     |CIERRA #4;

     |SI eaOpcion = "3";
         |HAZ SacaErrorPtl;

         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Bloque2015;
     |HAZ BtnAnuales2015;

     |SI eaOpcion = "0";  enInfComp = 1;  |ACABA;  |FINSI;

     nTecla = 1;

     |ABRE #296;
     |ABRE #4;
     |SI #0#8 = "C";
         |BUCLE dsmow014C296_2012;
     |SINO;
         |BUCLE dsmow014N296_2012;
     |FINSI;
     |CIERRA #296;
     |CIERRA #4;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;

     |SI enDirecta = 1;  |Y enMsv = 1;  |Y enParar = 0;
         |SUB_EJECUTA "|dsmox007";
     |FINSI;
|FPRC;

|PROCESO Bloque;
     |SI #dsmoy000#6 [ 2011;  |HAZ Bloque2011;  |ACABA;  |FINSI;
     |SI #dsmoy000#6 [ 2014;  |HAZ Bloque2012;  |ACABA;  |FINSI;
     |SI #dsmoy000#6 ] 2015;  |HAZ Bloque2015;  |FINSI;
|FPRC;

|PROGRAMA;
     fDd  = "01.01.0000";
     fHd  = "31.12.2999";

     aFichero = ("000" + Usuario) % 108;
     |NOME_DAT #0 aFichero;

     aFichero = ("imp" + Usuario) % 108;
     |NOME_DAT #999 aFichero;

     |ABRE #0;
     |LEE 000#0p;
     |CIERRA #0;

     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |SI eaParametro = "296C";
         enInfComp = 1;
         nTecla    = 5;
         |HAZ Bloque2011;
         |ACABA;
     |FINSI;

     |HAZ Bloque;
|FPRO;
