|FICHEROS;
   dsmow670;
   dsmow671;
|FIN;

|VARIABLES;
   &eaImpresora = "";

   nCalc  = 0;
   nCalc1 = 0;
   nDato  = 0;

   nHandTxt = 0;
   aIP    = "";
{1}aContiene = "";

   aAlfa0  = "";
   aAlfaX  = "";
   aAlfaX1 = "";
   aAlfaX2 = "";
|FIN;

|PROCESO RecogeDato;
   nCalc = nDato - 1;
   aAlfaX1 = aAlfaX;
   |PARA; |SI nCalc > 0; |HACIENDO;
      aAlfaX2 = aAlfaX1 - &9;
      |SI FSalida ! 0;
         nCalc1 = ((FSalida / 100) ! 0) + 99;
         aAlfaX2 = aAlfaX1 % nCalc1;
         aAlfaX1 = aAlfaX1 - aAlfaX2;
         aAlfaX1 = aAlfaX1 - &9;
      |FINSI;
      nCalc = nCalc - 1;
   |SIGUE;
   aAlfaX2 = aAlfaX1 - &9;
   |SI FSalida ! 0;
      nCalc1 = ((FSalida / 100) ! 0) + 99;
      aAlfaX1 = aAlfaX1 % nCalc1;
   |FINSI;
|FPRC;

|PROCESO PortadaCrystal;
   aAlfaX = "pr" + Usuario; |NOME_DAT #dsmow671#aAlfaX#;
   |DELINDEX #dsmow671; |ABRE #dsmow671;

   |DBASS aAlfaX; |QBF aAlfaX;
   aAlfaX = aAlfaX + "basica/fich/port" + Usuario + ".txt";
   |XABRE "", aAlfaX, nHandTxt;
   |PARA; |SI FSalida ] 0; |HACIENDO;
      |XLEE nHandTxt, 250, aAlfaX;
      |SI FSalida ] 0;
         nDato = 1; |HAZ RecogeDato;
         |SI aAlfaX1 = "0";
            |DDEFECTO #dsmow670;
            nDato = 2; |HAZ RecogeDato; #dsmow670#0 = aAlfaX1;
            nDato = 3; |HAZ RecogeDato; #dsmow670#1 = aAlfaX1;
         |FINSI;
         |SI aAlfaX1 = "1";
            nDato = 2; |HAZ RecogeDato; #dsmow670#2 = aAlfaX1;
            nDato = 3; |HAZ RecogeDato; #dsmow670#3 = aAlfaX1;
            nDato = 4; |HAZ RecogeDato; #dsmow670#4 = aAlfaX1;
            nDato = 5; |HAZ RecogeDato; #dsmow670#5 = aAlfaX1;
            nDato = 6; |HAZ RecogeDato; #dsmow670#6 = aAlfaX1;
            nDato = 7; |HAZ RecogeDato; #dsmow670#7 = aAlfaX1;
            nDato = 8; |HAZ RecogeDato; #dsmow670#8 = aAlfaX1;
            nDato = 9; |HAZ RecogeDato; #dsmow670#9 = aAlfaX1;
            nDato = 10; |HAZ RecogeDato; #dsmow670#10 = aAlfaX1;
            nDato = 11; |HAZ RecogeDato; #dsmow670#11 = aAlfaX1;
            nDato = 12; |HAZ RecogeDato; #dsmow670#12 = aAlfaX1;
            nDato = 13; |HAZ RecogeDato; #dsmow670#13 = aAlfaX1;
            nDato = 14; |HAZ RecogeDato; #dsmow670#14 = aAlfaX1;
            aAlfaX1 = "";
         |FINSI;
         |SI aAlfaX1 = "2";
            |DDEFECTO #dsmow671;
            #dsmow671#0  = #dsmow670#3;
            #dsmow671#10 = "A";
            nDato = 2; |HAZ RecogeDato; #dsmow671#1  = aAlfaX1;
            nDato = 3; |HAZ RecogeDato; #dsmow671#2 = aAlfaX1;
            nDato = 4; |HAZ RecogeDato; #dsmow671#3 = aAlfaX1;
            nDato = 5; |HAZ RecogeDato; #dsmow671#4 = aAlfaX1;
            nDato = 6; |HAZ RecogeDato; #dsmow671#5 = aAlfaX1;
            nDato = 7; |HAZ RecogeDato; #dsmow671#6 = aAlfaX1;
            nDato = 8; |HAZ RecogeDato; #dsmow671#7 = aAlfaX1;
            |GRABA 020#dsmow671.n;
            aAlfaX1 = "";
         |FINSI;
         |SI aAlfaX1 = "3";
            |DDEFECTO #dsmow671;
            #dsmow671#0  = #dsmow670#3;
            #dsmow671#10 = "R";
            nDato = 2; |HAZ RecogeDato; #dsmow671#1 = aAlfaX1;
            nDato = 3; |HAZ RecogeDato; #dsmow671#8 = aAlfaX1;
            nDato = 4; |HAZ RecogeDato; #dsmow671#9 = aAlfaX1;
            nDato = 5; |HAZ RecogeDato; #dsmow671#5 = aAlfaX1;
            nDato = 6; |HAZ RecogeDato; #dsmow671#6 = aAlfaX1;
            |GRABA 020#dsmow671.n;
            aAlfaX1 = "";
         |FINSI;
      |FINSI;
   |SIGUE;

   |CIERRA #dsmow671;
   |DFICE aAlfaX; |QBF aAlfaX;
   aAlfaX1 = aAlfaX + "pr" + Usuario + ".dbf";

   aIP = ""; |IP_REMOTO aIP;

   aContiene = "";
   |ESPECIFICA "RBASS", aContiene;
   aAlfaX2 = aContiene1;

   aAlfaX2 = aAlfaX2 + "crystal";
   |SI aIP ! ""; |RMKDIR aAlfaX2; |SINO; |MKDIR aAlfaX2; |FINSI;
   aAlfaX2 = aAlfaX2 + "/detporta.dbf"; |QBF aAlfaX2;
   |SI aIP ! ""; |ENVIA_FICHERO aAlfaX1, aAlfaX2; |SINO; |COPIA_FICHERO aAlfaX1, aAlfaX2; |FINSI;

   |DELINDEX #dsmow671;
|FPRC;
