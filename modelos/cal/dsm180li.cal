|FICHEROS;
     dsm180ca #1;
     dsm180li #2,MANTE;

     :/basica/def/agicen14 #114;
     :/basica/def/agicen17 #117;
     :/basica/def/agimunic #100;

     &regisnif@ #709;
     &ds180li@  #900;
|FIN;

|VARIABLES;
     aMenav      = "";
     aPathModelo = "";
     aDef        = "";
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     nNumero     = 0;
     nContenido  = 0;
     nModo       = 0;
     nInkey      = 0;

     &enLinInm    = 0;
     &enDesModelo = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO Tipo88;  |TIPO 88;
     |HAZ Relaciones;
|FPRC;

|PROCESO PonDatosNif;  |TIPO 7;
     eaCodNif  = #2#6;
     |HAZ LeeNifs;

     #2#10 = #709#1;   |PINTA #2#10;
     #2#14 = #709#4;   |PINTA #2#14;
|FPRC;

|PROCESO T7Importe;  |TIPO 7;
     nContenido = #dsm180li#Campo#;
|FPRC;

|PROCESO Importe;
     |SI nContenido = #dsm180li#Campo#;
         |ACABA;
     |FINSI;

     #2#13 = #2#11 % #2#12;
     |PINTA #2#13;
|FPRC;

|PROCESO Tipo2m180li;  |TIPO 2;
     #1#6 = #1#6 +. 1;
     #1#7 = #1#7 +. #2#11;
     #1#8 = #1#8 +. #2#13;
|FPRC;

|PROCESO Tipo11m180li;  |TIPO 11;
     |SI FSalida = 10;
         eaVarDni  = #2Campo;
         enCalcCif = 1;
         |HAZ CalculameDNI;
         #2Campo = eaVarDni;
         |PINTA #2Campo;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo7C15; |TIPO 7;

     |SI #2#1 < 2014; |ACABA; |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1;   |ACABA; |FINSI;

     |ABRE #900;
     #900#0 = #2#0;
     #900#1 = #2#1;
     #900#2 = #2#2;
     #900#3 = #2#3;
     #900#4 = #2#4;
     #900#5 = #2#5;
     #900#6 = #2#6;
     #900#7 = #2#7;
     #900#8 = #2#8;
     #900#15 = 99;
     |LEE 041#900];
     |SI FSalida = 0;
         |LEE 041#900a;
     |SINO;
         |LEE 041#900u;
     |FINSI;
     nNumero = 0;
     |SI #900#0 = #2#0; |Y #900#1 = #2#1; |Y #900#2 = #2#2;
        |Y #900#3 = #2#3; |Y #900#4 = #2#4; |Y #900#5 = #2#5;
          |Y #900#6 = #2#6; |Y #900#7 = #2#7; |Y #900#8 = #2#8;
             nNumero = #900#15;
     |FINSI;
     #2#15 = nNumero + 1; |PINTA #2#15;
     |CIERRA #900;
|FPRC;

|PROCESO MiraDni180li;  |TIPO 6;
     eaVarDni  = #2Campo;
     enCalcCif = 0;
     |HAZ CalculameDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #2Campo ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #2Campo = eaVarDni;  |PINTA #2Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|| //////////////////////////////////////////////
|PROCESOIgualaCampos;
       #2#30 = #117#1;
       #2#29 = #117#2;
       #2#16 = #117#3;   |PINTA #2#16;
       #2#17 = #117#6;   |PINTA #2#17;
       #2#18 = #117#7;   |PINTA #2#18;
       #2#19 = #117#8;   |PINTA #2#19;
       #2#20 = #117#9;   |PINTA #2#20;
       #2#21 = #117#10;  |PINTA #2#21;
       #2#22 = #117#11;  |PINTA #2#22;
       #2#23 = #117#12;  |PINTA #2#23;
       #2#24 = #117#13;  |PINTA #2#24;
       #2#25 = #117#14;  |PINTA #2#25;
       #2#26 = #117#15;  |PINTA #2#26;
       #2#27 = #117#17;  |PINTA #2#27;
       #2#28 = #117#18;  |PINTA #2#28;
|FPRC;

|RUTINA ClaveBaja114;
     #114#0 = #2#0;
     #114#1 = 01;
|FRUT;

|RUTINA ClaveAlta114;
     #114#0 = #2#0;
     #114#1 = 99;
|FRUT;

|PROCESO PideActividad;
     |SI FSalida = 10;
         |ABRE #114;
         #114#0 = #2#0;
         #114#1 = 0;
         |LEE 040#114];
         |SI FSalida = 0;  |Y #114#0 = #2#0;
             #114#1 = #2#30;
             |CONSULTA_F_CLAVE #1#114, ClaveBaja114, ClaveAlta114;

             #2#30 = #114#1;
         |SINO;
             |MENAV "     No existen Actividades en la Empresa.";
         |FINSI;
         |CIERRA #114;
     |FINSI;

     |SI #2#30 ! 0;
        |ABRE #114;
        #114#0 = #2#0;
        #114#1 = #2#30;
        |LEE 040#114=;
        |SI FSalida ! 0;
            |MENAV "     No existe la Actividad en la Empresa.";
            |ERROR;
       |FINSI;
       |CIERRA #114;
    |FINSI;
|FPRC;

|PROCESO PreguntaAct;
   |C_V #2#30,1,"S";
   |C_M #2#30,1,"S";
   |PINTA 1663, "Actividad:    "; |PINTA #2#30;
   |ENCAMPO #30#2;
   |C_M #2#30,1,"N";
   |C_V #2#30,1,"N";
   |PINTA 1663, "              ";
|FPRC;

|PROCESO Tipo7C16; |TIPO 7;
     |SI #2#1 ] 2014;
         |MENSA "0000Pulse F2-Consulta Ref.Catastrales, F3-Modificar Ref. Catastral";
     |FINSI;
|FPRC;

|RUTINA ClaveBaja117;
     #117#0 = #2#0;
     #117#1 = 00;
     #117#2 = 01;
|FRUT;

|RUTINA ClaveAlta117;
     #117#0 = #2#0;
     #117#1 = 99;
     #117#2 = 99;
|FRUT;

|PROCESO VerReferencia;
     |SI nInkey = 10;
         |ABRE #117;
         #117#0 = #2#0;
         #117#1 = #2#5;
         #117#2 = 00;
         |LEE 040#117];
         |SI FSalida = 0;  |Y #117#0 = #2#0;
             |C_M #117#2, 1, "S";

             #117#1 = #2#30;
             #117#2 = #2#29;
             |CONSULTA_F_CLAVE #1#117, ClaveBaja117, ClaveAlta117;

             |HAZ IgualaCampos;
         |SINO;
             |MENAV "     No existen Referencias Catastrales en la Empresa.";
         |FINSI;
         |CIERRA #117;
         |ERROR;
     |FINSI;

     |SI nInkey  = 11;
         |HAZ PreguntaAct;
         |SI #2#30 ! 0;
             enEmpresa   = #2#0;
             enActividad = #2#30;
             enLinInm    = #2#29;
             enDesModelo = 1;
             |SUB_EJECUTA ":basica/agicen17";
             enDesModelo = 0;
             #2#29 = enLinInm;
             |HAZ PonDatos;
         |FINSI;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO PonDatos;
     |ABRE #117;
     #117#0 = #2#0;
     #117#1 = #2#30;
     #117#2 = #2#29;
     |LEE 040#117=;
     |SI FSalida = 0;
         |HAZ IgualaCampos;
     |FINSI;
     |CIERRA #117;
|FPRC;

|PROCESO Catastral;
     |C_M #2Campo, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     |BLIN 4;
     nInkey = FSalida;
     |SI nInkey = 10; |O nInkey = 11;
         |HAZ VerReferencia;
         |ACABA;
     |FINSI;

     aAlfa = #2#16;  |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     aAlfa = aAlfa % 0;
     |SI aAlfa ! "20";
         |MENAV "0000 La longitud de la Referencia Catastral deberia ser de 20 Caracteres.";
     |FINSI;
|FPRC;

|PROCESO Localidad;
   |C_M #2Campo, 0, aAlfa;
   |SI aAlfa = "N"; |ACABA; |FINSI;

   enCodProv = #2#17;
   enCodPobl = #2#18;
   |HAZ LeeLocalidad;
   #2#19 = eaPoblacion; |PINTA #2#19;
   #2#20 = eaProvincia; |PINTA #2#20;
|FPRC;

|PROCESO Infmunic;
    #100#0 = "00000";
    #100#1 = "00000";
|FPRC;

|PROCESO Supmunic;
    #100#0 = "99999";
    #100#1 = "99999";
|FPRC;

|PROCESO Tipo66C18; |TIPO 66;

    |ABRE #100;
    aAlfa1 = #2#17; aAlfa1 = ( "00"  + aAlfa1) % -102;
    aAlfa2 = #2#18; aAlfa2 = ( "000" + aAlfa2) % -103;
    aAlfa1 = aAlfa1 + aAlfa2;
    #100#0 = aAlfa1;
    #100#1 = #2#28;

    |CONSULTA_F_CLAVE #1#100, Infmunic, Supmunic;

    aAlfa1 = #100#0; |QBF aAlfa1;
    aAlfa1 = ("00000" + aAlfa1) % -105;
    aAlfa2 = aAlfa1 % 102; #2#17  = aAlfa2; |PINTA #2#17;
    aAlfa2 = aAlfa1 % 303; #2#18  = aAlfa2; |PINTA #2#18;

    #2#28 = #100#1; |PINTA #2#28;
    |CIERRA #100;
|FPRC;
