|FICHEROS;
     dsmoy000 #0;
     dsmom001 #1;
     dsmom004 #4;
     dsmom095 #95;
     dsmom107 #107;

     dsmow014 #999;
     dsmow015 #998;
     dsmow016 #997;
     espejo@  #97;

     dsmow513 #513;   || 2001
     dsmow514 #514;
     dsmow515 #515;

     dsmow535 #535;   || 2002
     dsmow536 #536;
     dsmow537 #537;
     dsmow504 #504;   || Auxiliar

     dsmow538 #538;   || 2010
     dsmow539 #539;

     dsmod349 #100;
     dsmoc349 #101;

     :/basica/def/agim0024 #24;
     :/basica/def/agim0026 #26;

     &clientes@ #715;
     &dsmod349@ #349;
     &dsmoc349@ #350;
|FIN;

|VARIABLES;
     nDPeriodo = 0;
     nHPeriodo = 0;
     nCampo1  = 0;
     nCampo2  = 0;
     nCampo3  = 0;
     nCampo11 = 0;
     nCampo22 = 0;
     nCampo33 = 0;
     nHandle  = 0;

     aEjer       = "";
     aPathAfegir = "";
     aNombre     = "";
     aIPRemoto   = "";
     aBue        = "";

    ndecontar = 0;
    contador = 0;
    &hojas   = 0;
    resto    = 0;
    &eaPRec  = "";
    &numhoja = 0;
    nNume1   = 0;
    nNume2   = 0;

    nSwBoton1 = 0;
    nSwBoton2 = 0;
    nSwBoton3 = 0;

|FIN;

|INCLUYE i_varemi;

|| --------------------------------------------------------------------------
|| Recalculo del Modelo segun los Periodos
|| --------------------------------------------------------------------------

|PROCESO GrabaTempo1;
     |SI #101#2 = 99;
         |PARA nCampo = 0;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
               #350nCampo = #101nCampo;
         |SIGUE;
         |GRABA 020#350n;
         |ACABA;
     |FINSI;

     #350#0  = #101#0;
     #350#1  = #101#1;
     #350#2  = #999#2;
     #350#3  = #101#3;
     #350#4  = #101#4;
     #350#5  = #101#5;
     #350#6  = #101#6;
     #350#7  = #101#7;
     #350#25 = #101#25;
     #350#26 = #101#26;
     |LEE 101#350=;
     |SI FSalida ! 0;
         |DDEFECTO #350;
         #350#0  = #101#0;
         #350#1  = #101#1;
         #350#2  = #999#2;
         #350#3  = #101#3;
         #350#4  = #101#4;
         #350#5  = #101#5;
         #350#6  = #101#6;
         #350#7  = #101#7;
         #350#8  = #101#8;
         #350#9  = #101#9;
         #350#23 = #101#23;
         #350#24 = #101#24;
         #350#25 = #101#25;
         #350#26 = #101#26;
         |GRABA 020#350b;
     |FINSI;

     #350#22 = #350#22 + #101#22;
     #350#27 = #350#27 + #101#27;

     |PARA nCampo2 = 11;  |SI nCampo2 [ 20;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
            |PARA nCampo22 = 11;  |SI nCampo22 [ 20;  |HACIENDO nCampo22 = nCampo22 + 3;
                  nCampo11 = nCampo22 - 1;
                  nCampo33 = nCampo22 + 1;
                  |SI #350nCampo22 = #101nCampo2;
                      #350nCampo11 = #350nCampo11 + #101nCampo1;
                      #350nCampo33 = #350nCampo33 + #101nCampo3;
                      |SAL;
                  |FINSI;
            |SIGUE;
     |SIGUE;

     |PARA nCampo2 = 29;  |SI nCampo2 [ 35;  |HACIENDO nCampo2 = nCampo2 + 3;
           nCampo1 = nCampo2 - 1;
           nCampo3 = nCampo2 + 1;
            |PARA nCampo22 = 29;  |SI nCampo22 [ 35;  |HACIENDO nCampo22 = nCampo22 + 3;
                  nCampo11 = nCampo22 - 1;
                  nCampo33 = nCampo22 + 1;
                  |SI #350nCampo22 = #101nCampo2;
                      #350nCampo11 = #350nCampo11 + #101nCampo1;
                      #350nCampo33 = #350nCampo33 + #101nCampo3;
                      |SAL;
                  |FINSI;
            |SIGUE;
     |SIGUE;

     |GRABA 020#350a;
     |LIBERA #350;
|FPRC;

|DEFBUCLE dsmoc349R;
     #101#1;
     ;
     #100#0, #100#1, nDPeriodo, #100#3, #100#4, 01, aDTipo, 0000, 00, "            ";
     #100#0, #100#1, nHPeriodo, #100#3, #100#4, 99, aHTipo, 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, GrabaTempo1;
|FIN;

|PROCESO RecalculaCabecera;
     |SI #350#6 = "E ";  |O #350#6 = "M "; |O #350#6 = "H "; |O #350#6 = "S ";
         #349#6 = #349#6 + 1;
         #349#7 = #349#7 + #350#22;
     |FINSI;

     |SI #350#6 = "A ";  |O #350#6 = "I ";
         #349#8 = #349#8 + 1;
         #349#9 = #349#9 + #350#22;
     |FINSI;

     |SI #350#6 = "AR";  |O #350#6 = "ER";
      |O #350#6 = "SR";  |O #350#6 = "IR";
      |O #350#6 = "MR";  |O #350#6 = "HR";
         #349#10 = #349#10 + 1;
         #349#11 = #349#11 + #350#22;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc349Tempo;
     #350#1010;
     ;
     #349#0, #349#1, #349#2, #349#3, #349#4, 01, aDTipo, 0000, 00, "            ";
     #349#0, #349#1, #349#2, #349#3, #349#4, 99, aHTipo, 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, RecalculaCabecera;
|FIN;

|PROCESO Recalcula349;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;

     nDPeriodo = #0#4;
     nHPeriodo = #0#4;

     |SI #4#22 = "M";
         nDPeriodo = #0#4;
         nHPeriodo = #0#4;

         |SI #4#1 ] 2010;
             |ABRE #95;
             #95#0 = #4#0;
             #95#1 = #4#1;
             |LEE 000#95=;
             |SI FSalida ! 0;  |DDEFECTO #95;  |FINSI;
             |CIERRA #95;

             |SI #0#4 = 2;   |Y #95#27 = "S";  nDPeriodo = 1;   |FINSI;
             |SI #0#4 = 5;   |Y #95#28 = "S";  nDPeriodo = 4;   |FINSI;
             |SI #0#4 = 8;   |Y #95#29 = "S";  nDPeriodo = 7;   |FINSI;
             |SI #0#4 = 11;  |Y #95#30 = "S";  nDPeriodo = 10;  |FINSI;
         |FINSI;
     |FINSI;

     |SI #4#22 = "T";
         |SI #0#4 = 3;   nDPeriodo = 1;   nHPeriodo = 3;  |FINSI;
         |SI #0#4 = 6;   nDPeriodo = 4;   nHPeriodo = 6;  |FINSI;
         |SI #0#4 = 9;   nDPeriodo = 7;   nHPeriodo = 9;  |FINSI;
         |SI #0#4 = 12;  nDPeriodo = 10;  nHPeriodo = 12; |FINSI;
     |FINSI;

     #100#0  = #999#0;
     #100#1  = #999#1;
     #100#2  = #999#2;
     #100#3  = #999#5;
     #100#4  = #999#7;
     #100#5  = 0;
     |LEE 040#100=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #349#0  = #999#0;
     #349#1  = #999#1;
     #349#2  = #999#2;
     #349#3  = #999#5;
     #349#4  = #999#7;
     #349#5  = 0;
     |LEE 040#349=;
     |SI FSalida ! 0;
         |DDEFECTO #349;
         #349#0  = #999#0;
         #349#1  = #999#1;
         #349#2  = #999#2;
         #349#3  = #999#5;
         #349#4  = #999#7;
         #349#5  = 0;
         #349#6  = 0;
         #349#7  = 0;
         #349#8  = 0;
         #349#9  = 0;
         #349#10 = 0;
         #349#11 = 0;
         #349#12 = #100#12;
         #349#13 = #100#13;
         |GRABA 020#349b;
     |FINSI;

     |BUCLE dsmoc349R;
     |BUCLE dsmoc349Tempo;

     |GRABA 020#349a;
     |LIBERA #349;
|FPRC;

|DEFBUCLE dsmow014R349;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, Recalcula349;
|FIN;

|| *************************************************************************

|PROCESO Boton3491;
     |PTEC 824;
|FPRC;

|PROCESO Boton3492;
     |PTEC 825;
|FPRC;

|PROCESO Boton3493;
     |PTEC 826;
|FPRC;

|PROCESO Boton3494;
     |PTEC 827;
|FPRC;

|PROCESO Boton3495;
     |PTEC 828;
|FPRC;

|PROCESO Boton3496;
     |PTEC 806;
|FPRC;

|| **************************************************************************
|| PROCESOS DE LAS EMISIONES DEL 349 DEL 2009 PA BAJO
|| **************************************************************************

|| Proceso de Bats;

|PROCESO Valida349_2007;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton4, "HIDE";
     |ESTADO_CONTROL nBoton5, "HIDE";

     eaTipoE =  "CE"   + #0#6 + ".TXT";
     eaTipoR =  "CCC"  + #0#6 + ".TXT";
     eaTipoV =  "S";
     |HAZ LineaShellJava;

     eaFichError = "ccc";
     eaFichDatos = "ce" + #0#6 + ".TXT";
     eaFichAuxil = "cb" + #0#6 + ".TXT";
     enInternet  = 1;

     |HAZ BuscaErroresL;
     |SI enError = 1;
         |MENAV "      Ha habido Errores, arreglelos y vuelva a emitir.";
     |SINO;
         |HAZ GrabaImpreso;
     |FINSI;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton4, "SHOW";
     |ESTADO_CONTROL nBoton5, "SHOW";
|FPRC;

|PROCESO Valida349;
     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton4, "HIDE";
     |ESTADO_CONTROL nBoton5, "HIDE";

     |SI #0#6 [ 2005;
         |SI #107#6 = "S";
             aTercera = "N";
             aAlfa    = "0000" + #107#5 + "Desea la impresion de la tercera copia  ";
             |CONFI aAlfa;
             |SI FSalida = 0;  aTercera = "S";  |FINSI;
         |SINO;
             aTercera = #107#5;
         |FINSI;
     |SINO;
         aTercera = "N";
     |FINSI;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle4;

     aAlfa = "CD " + eaPathLanza + &13 + &10;               |XGRABA nHandle4, aAlfa;
     aAlfa = "ZPR" + aEjer + "349.EXE -Y" + &13 + &10;      |XGRABA nHandle4, aAlfa;

     |SI #0#6 [ 2005;
         aAlfa = "wait vs349 /E:CE" + #0#6 + ".TXT";
         aAlfa = aAlfa + " /R:CCC" + #0#6 + ".TXT ";
         aAlfa = aAlfa + "/I: ";
         aAlfa = aAlfa + "/C:" + aTercera + " ";
         aAlfa = aAlfa + "/F:FLAG.TXT ";
         aAlfa = aAlfa + "/A:CB" + #0#6 + ".TXT";
         aAlfa = aAlfa + &13 + &10;
     |SINO;
         aAlfa = "wait vi349 /E:CE" + #0#6 + ".TXT";
         aAlfa = aAlfa + " /R:CCC" + #0#6 + ".TXT ";
         aAlfa = aAlfa + "/F:FLAG.TXT ";
         aAlfa = aAlfa + &13 + &10;
     |FINSI;
     |XGRABA nHandle4, aAlfa;

     aAlfa = "DEL *.DLL" + &13 + &10;
     |XGRABA nHandle4, aAlfa;

     aAlfa = "DEL *.TAB" + &13 + &10;
     |XGRABA nHandle4, aAlfa;

     aAlfa = "DEL *.WMF" + &13 + &10;
     |XGRABA nHandle4, aAlfa;

     aAlfa = "DEL *.EXE" + &13 + &10;
     |XGRABA nHandle4, aAlfa;

     aAlfa = "DEL ERROR349.TXT" + &13 + &10;
     |XGRABA nHandle4, aAlfa;

     |XCIERRA nHandle4;

     |DBASS aModelos;  |QBT aModelos;
     aModelos = aModelos + "basica/";

     eaFOrigen  = aModelos + "patrones/zpr" + aEjer + "349.exe";
     eaFDestino = eaPathLanza + "zpr" + aEjer + "349.exe";

     |HAZ CopiaFichero;

     aAlfa =  eaPathLanza + "IMPRIME";
     |RSYSTEM aAlfa;
     eaFichError = "ccc";
     eaFichDatos = "ce" + #0#6 + ".TXT";
     eaFichAuxil = "cb" + #0#6 + ".TXT";
     enInternet  = 1;

     |HAZ BuscaErroresL;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton4, "SHOW";
     |ESTADO_CONTROL nBoton5, "SHOW";
|FPRC;

|PROCESO Copiaa;
     aAbre = eaPathLanza + "copiaa.bat";
     |XABRE "CBW", aAbre, nHandle4;

     aAlfa = "CD " + eaPathLanza + &13 + &10;             |XGRABA nHandle4, aAlfa;
     aAlfa = "COPY CE" + #0#6 + ".TXT A:" + &13 + &10;    |XGRABA nHandle4, aAlfa;
     |SI #0#6 ] 2003;
         aAlfa = "COPY CB" + #0#6 + ".TXT A:" + &13 + &10;    |XGRABA nHandle4, aAlfa;
     |FINSI;
     |XCIERRA nHandle4;

     |RSYSTEM aAbre;

     |RFBORRA aAbre;
|FPRC;

|PROCESO CopiaInternet;
     eaFOrigen  = eaPathLanza + "CE" + #0#6 + ".TXT";
     |XABRE "EC", eaFOrigen, nHandle;
     |SI FSalida < 0;
         |MENAV "0000 Han habido errores, arreglelos y vuelva a emitir.";
         |ACABA;
     |FINSI;

     eaFOrigen  = eaPathLanza + "CE" + #0#6 + ".TXT";

     |SI nTecla = 3;
         eaFDestino = eaPathInternet + "349" + (("00000" + #999#0) % -105) + ".txt";
     |FINSI;

     |SI nTecla = 4;
         eaFDestino = eaPathInternet + "34900000.txt";
     |FINSI;

     |RCOPIA_FICHERO eaFOrigen, eaFDestino;
     |RFBORRA eaFOrigen;

     eaFOrigen  = eaPathLanza + "CB" + #0#6 + ".TXT";
     |RFBORRA eaFOrigen;

     aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
     |MENAV aAlfa;
|FPRC;

|| --------------------------------------------------------------------------
|| Emision para el A¤o 2001
|| --------------------------------------------------------------------------

|PROCESO Portada349I_2001;
     |DDEFECTO #997;

     enCodCli = #349#0;
     |HAZ LeePersona;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #997#0 = eaVarDni;

         eaAlfa = #715#1;  |HAZ QuitaRaros;
         #997#1 = eaAlfa;

         #997#2  = #715#29;
         #997#3  = #715#30;
         #997#4  = #715#31;
         #997#5  = #715#32;
         #997#6  = #715#33;
         #997#7  = #715#34;
         #997#8  = #715#35;
         #997#9  = #715#36;
         #997#10 = #715#37;
         #997#11 = #715#15;
         #997#12 = #715#16;

         eaAlfa   = #715#53;  |HAZ QuitaRaros;
         #997#13  = eaAlfa;

         eaAlfa   = #715#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #715#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #997#14  = eaAlfa;

         #997#15  = #997#13;
         #997#16  = "SECRETARIO";

         #997#20  = #715#17;
         #997#21  = #715#18;
         #997#22  = #715#38;
     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #997#0 = eaVarDni;

         eaAlfa = #715#1;  |HAZ QuitaRaros;
         #997#1 = eaAlfa;

         #997#2  = #715#3;
         #997#3  = #715#4;
         #997#4  = #715#5;
         #997#5  = #715#6;
         #997#6  = #715#7;
         #997#7  = #715#8;
         #997#8  = #715#9;
         #997#9  = #715#10;
         #997#10 = #715#11;
         #997#11 = #715#15;
         #997#12 = #715#16;

         eaAlfa   = #715#96;  |HAZ QuitaRaros;
         #997#13  = eaAlfa;

         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;
         #997#14  = eaAlfa;

         #997#15  = #997#13;
         #997#16  = "SECRETARIO";

         #997#20  = #715#91;
         #997#21  = #715#92;
         #997#22  = #715#12;
     |FINSI;

     #997#23 = #349#1;
     |SI #349#2 ! 99;
         |SI #349#2 = 3;   #997#24 = "1T";  |FINSI;
         |SI #349#2 = 6;   #997#24 = "2T";  |FINSI;
         |SI #349#2 = 9;   #997#24 = "3T";  |FINSI;
         |SI #349#2 = 12;  #997#24 = "4T";  |FINSI;
     |SINO;
         #997#24 = "0A";
     |FINSI;

     |SI nTecla = 1;  #997#25 = "X";  |FINSI;
     |SI nTecla = 2;  #997#25 = "X";  |FINSI;
     |SI nTecla = 3;  #997#26 = "X";  |FINSI;
     |SI nTecla = 3;  #997#29 = "X";  |FINSI;
     |SI nTecla = 4;  #997#27 = "X";  |FINSI;
     |SI nTecla = 4;  #997#29 = "X";  |FINSI;

     #997#30 = #349#6;
     #997#31 = #349#7;
     #997#32 = #349#8;
     #997#33 = #349#9;
     #997#34 = #349#10;
     |SI nTecla = 4;
         #997#37 = #97#19;
         #997#39 = #97#15;
         #997#40 = #97#16;
     |SINO;
         #997#37 = "";
         #997#39 = #997#15;
         #997#40 = #997#16;
     |FINSI;
     #997#41 = #349#0;
     eaAlfa  = #0#7;  |HAZ FechaBonito;  #997#38 = eaFechaB;
|FPRC;

|PROCESO Registro0_349_2001;
     |PARA nCampo = 0;  |SI nCampo [ 41;  |HACIENDO nCampo = nCampo + 1;
           #997nCampo = #97nCampo;
     |SIGUE;

     #997#23 = #349#1;
     |SI #349#2 ! 99;
         |SI #349#2 = 3;   #997#24 = "1T";  |FINSI;
         |SI #349#2 = 6;   #997#24 = "2T";  |FINSI;
         |SI #349#2 = 9;   #997#24 = "3T";  |FINSI;
         |SI #349#2 = 12;  #997#24 = "4T";  |FINSI;
     |SINO;
         #997#24 = "0A";
     |FINSI;

     #997#27 = "X";
     #997#29 = "X";

     #997#37 = "";
     #997#38 = #97#15;
     #997#39 = #97#16;
     #997#41 = 0;
     eaAlfa  = #0#7;  |HAZ FechaBonito;  #997#38 = eaFechaB;

     |DDEFECTO #513;

     #513#0  = "0";

     #513#1  = "349";

     #513#2  = #0#6;

     #513#3  = "";

     #513#4  = ("00" + #997#11) % -102;

     eaVarDni = #997#0;  |HAZ CalculameDNI;
     #513#5  = eaVarDni;

     eaAlfa  = #997#1;  |HAZ QuitaRaros;
     #513#6  = eaAlfa;

     #513#7  = #997#2;

     eaAlfa  = #997#3;  |HAZ QuitaRaros;
     #513#8  = eaAlfa;

     nNume   = #997#4;
     #513#9  = (("00000" + nNume) % -105);

     #513#10 = #997#5;

     #513#11 = #997#6;

     #513#12 = #997#7;

     #513#13 = (("00" + #997#8) % -102) + (("000" + #997#9) % -103);

     eaAlfa  = #997#10;  |HAZ QuitaRaros;
     #513#14 = eaAlfa;

     #513#15 = (("00000" + #997#17) % -105);

     #513#16 = (("000000000" + #997#18) % -109);

     #513#17 = "D";

     eaAlfa  = #997#14;  |HAZ QuitaRarosTfno;
     #513#18 = eaAlfa;

     eaAlfa  = #997#13;  |HAZ QuitaRaros;
     #513#19 = eaAlfa;

     |SI eaMoneda = "PESETAS";
         #513#20 = "349" + #997#19;
     |SINO;
         #513#20 = "343" + #997#19;
     |FINSI;

     #513#22 = &13 + &10;

     |SI nTecla = 3;  |O nTecla = 4;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #513nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |FINSI;

     |PARA nCampo = 0;  |SI nCampo [ 41;  |HACIENDO nCampo = nCampo + 1;
           #97nCampo = #997nCampo;
     |SIGUE;
|FPRC;

|PROCESO Registro1_349_2001;
     enCodCli = #349#0;
     |HAZ LeePersona;

     |DDEFECTO #514;

     #514#0  = "1";

     #514#1  = "349";

     #514#2  = #997#23;

     #514#3  = #997#24;

     #514#4  = ("00" + #997#11) % -102;

     eaVarDni = #997#0;  |HAZ CalculameDNI;
     #514#5   = eaVarDni;

     eaAlfa   = #997#1;  |HAZ QuitaRaros;
     #514#6   = eaAlfa;

     eaAlfa   = #997#14;  |HAZ QuitaRarosTfno;
     #514#13  = eaAlfa;

     eaAlfa   = #997#13;  |HAZ QuitaRaros;
     #514#14  = eaAlfa;

     #514#12 = "D";

     |SI eaMoneda = "PESETAS";
         |SI nTecla = 4;
             #514#15 = "349" + #997#37;
         |SINO;
             #514#15 = "349" + #997#19;
         |FINSI;
     |SINO;
         |SI nTecla = 4;
             #514#15 = "343" + #997#37;
         |SINO;
             #514#15 = "343" + #997#19;
         |FINSI;
     |FINSI;

     #514#7  = ("000000000" + #349#6) % -109;
     enNume  = #349#7;  |HAZ Conver13;  #514#8  = eaAlfa;
     #514#9  = ("000000000" + #349#8) % -109;
     enNume  = #349#9;  |HAZ Conver13;  #514#10 = eaAlfa;
     #514#11 = ("000000000" + #349#10) % -109;

     #514#12 = "D";

     #514#17 = &13 + &10;

     |SI nTecla = 3;  |O nTecla = 4;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #514nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |FINSI;
|FPRC;

|PROCESO Registro2_349_2001;
     enCodCli = #349#0;
     |HAZ LeePersona;

     |DDEFECTO #515;

     #515#0  = "2";

     #515#1  = "349";

     #515#2  = #349#1;

     |SI #349#2 ! 99;
         |SI #349#2 = 3;   #515#3 = "1T";  |FINSI;
         |SI #349#2 = 6;   #515#3 = "2T";  |FINSI;
         |SI #349#2 = 9;   #515#3 = "3T";  |FINSI;
         |SI #349#2 = 12;  #515#3 = "4T";  |FINSI;
     |SINO;
         #515#3 = "0A";
     |FINSI;

     #515#4  = ("00" + #997#11) % -102;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #515#5   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #515#5   = eaVarDni;
     |FINSI;

     #515#6 = "1";
     |SI #350#6 = "A ";  #515#6 = "2";  |FINSI;
     |SI #350#6 = "ER";  #515#6 = "3";  |FINSI;
     |SI #350#6 = "AR";  #515#6 = "4";  |FINSI;

     #515#7  = #350#8;
     #515#8  = #350#7;
     #515#9  = #350#9;

     enNume = #350#22;  |HAZ Conver13;  #515#10 = eaAlfa;

     #515#11 = #350#23;
     #515#12 = #350#24;

     #515#13 = "";
     #515#14 = "";
     |SI #350#6 = "AR";  |O #350#6 = "ER";
         #515#13 = #350#25;

         |SI #350#26 ! 0;
             |SI #350#26 = 1;   #515#14 = "1T";  |FINSI;
             |SI #350#26 = 2;   #515#14 = "2T";  |FINSI;
             |SI #350#26 = 3;   #515#14 = "3T";  |FINSI;
             |SI #350#26 = 4;   #515#14 = "4T";  |FINSI;
         |SINO;
             #515#14 = "0A";
         |FINSI;
     |FINSI;

     #515#16 = &13 + &10;

     |SI nTecla = 3;  |O nTecla = 4;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #515nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |SINO;
         |SI nTecla ! 5;
             nContador = nContador + 1;
             nSwPrint = 1;
             |SI nContador > 5;  nContador = 1;  |PIEINF;  |FINSI;
         |FINSI;

         |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc349_2001;
     #350#1010;
     ;
     #349#0, #349#1, #349#2, #349#3, #349#4, 01, aDTipo, 0000, 00, "            ";
     #349#0, #349#1, #349#2, #349#3, #349#4, 99, aHTipo, 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Registro2_349_2001;
|FIN;

|PROCESO Lee3490_2001;       || Calculo Total de Declarantes y Declarados
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #349;
     #349#0  = #999#0;
     #349#1  = #999#1;
     #349#2  = #999#2;
     #349#3  = #999#5;
     #349#4  = #999#7;
     #349#5  = 0;
     |LEE 040#349=;
     |SI FSalida = 0;
         #997#17 = #997#17 + 1;
         #997#18 = #997#18 + (#349#6 + #349#8 + #349#10);
         #997#30 = #997#30 + #349#6;
         #997#31 = #997#31 + #349#7;
         #997#32 = #997#32 + #349#8;
         #997#33 = #997#33 + #349#9;
         #997#34 = #997#34 + #349#10;
         #997#35 = #997#17;
         #997#36 = #997#18;
     |FINSI;
     |CIERRA #349;
|FPRC;

|PROCESO Lee3491_2001;        || Creacion de Ficheros
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |CIERRA #4;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #349;
     #349#0  = #999#0;
     #349#1  = #999#1;
     #349#2  = #999#2;
     #349#3  = #999#5;
     #349#4  = #999#7;
     #349#5  = 0;
     |LEE 040#349=;
     |SI FSalida = 0;
         |HAZ Portada349I_2001;

         |SI nTecla = 3;
             |PUSHV 0501 2380;
             |PINPA #0#997;
             |PINDA #0#997;
             |ENDATOS #4#997;
             |POPV;
         |FINSI;

         |HAZ Registro1_349_2001;

         aDTipo = "  ";
         aHTipo = "zz";

         |BUCLE dsmoc349_2001;

         |SI nTecla = 4;
             |HAZ GrabaImpreso;
         |FINSI;
     |FINSI;
     |CIERRA #349;
|FPRC;

|PROCESO Lee349P_2001;       || Emision Papel
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #349;
     #349#0  = #999#0;
     #349#1  = #999#1;
     #349#2  = #999#2;
     #349#3  = #999#5;
     #349#4  = #999#7;
     #349#5  = 0;
     |LEE 040#349=;
     |SI FSalida = 0;
         |SI nTecla = 3;  |O nTecla = 4;
             |HAZ Portada349I_2001;
             |PRINT;
             |PIEINF;
             |CIERRA #349;
             |ACABA;
         |FINSI;

         |SI nTecla = 5;
             |HAZ Portada349I_2001;
             |HAZ Registro1_349_2001;
             aDTipo    = "  ";
             aHTipo    = "zz";

             enSwImpre = 1;  |BUCLE dsmoc349_2001;
             |PIEINF;
             |CIERRA #349;
             |ACABA;
         |FINSI;
     |FINSI;
     |CIERRA #349;
|FPRC;

|PROCESO QueHacemos349_2001;
     |SI nTeclaPapel ! 0;  |O nTecla = 5;   || En Papel Continuo
         |HAZ Lee349P_2001;
         |ACABA;
     |FINSI;

     |SI nSwLee = 1;        || Lectura para Colectivos para Totales Hoja
         |HAZ Lee3490_2001;
         |ACABA;
     |FINSI;

     |HAZ Lee3491_2001;          || Creacion de los Ficheros Planos.
|FPRC;

|DEFBUCLE dsmow014C349_2001;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos349_2001;
|FIN;

|DEFBUCLE dsmow014N349_2001;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos349_2001;
|FIN;

|PROCESO ImprimeEtiq349_2001;
     |SI nTecla = 3;
         #998#0  = "Delegacion .........: " + #997#20;
         #998#1  = "Ejercicio ..........: " + #514#2 + " " + #514#3;
         #998#2  = "Modelo .............: 349";
         #998#3  = "Numero Justificante : " + #514#15;
         #998#4  = "N.I.F. .............: " + #514#5;
         #998#5  = "Nombre : " + #514#6;
         #998#6  = #997#2 + " " + #997#3 + " " + #997#4 + " " + #997#6 + " " + #997#7;
         #998#7  = "P.Cont.: " + #997#13;
         #998#8  = "Telefono ...........: " + #997#14;
         #998#9  = "Numero total Registros ..: " + nTRegistro;
         #998#10 = "Densidad soporte : 1,44 MB en Diskettes de 3 1/2";
         #998#11 = "";
         #998#12 = "";
         |C_M #998#11, 1, "N";
         |C_M #998#12, 1, "N";
     |SINO;
         |PARA nCampo = 0;  |SI nCampo [ 41;  |HACIENDO nCampo = nCampo + 1;
               #997nCampo = #97nCampo;
         |SIGUE;

         #998#0  = "Delegacion .........: " + #997#20;
         #998#1  = "Ejercicio ..........: " + #513#2;
         #998#2  = "Modelo .............: 349";
         #998#3  = "Numero Justificante : " + #513#20;
         #998#4  = "N.I.F. .............: " + #513#5;
         #998#5  = "Nombre : " + #513#6;
         #998#6  = #513#7 + " " + #513#8 + " " + #513#9 + " " + #513#11 + " " + #513#12;
         #998#7  = "P.Cont.: " + #513#19;
         #998#8  = "Telefono ...........: " + #513#18;
         #998#9  = "Numero total Registros ..: " + nTRegistro;
         #998#10 = "Densidad soporte : 1,44 MB en Diskettes de 3 1/2";
         #998#11 = "";
         #998#12 = "";
         |C_M #998#11, 1, "S";
         |C_M #998#12, 1, "S";
         #998#11 = "Numero total Declarantes : " + #997#17;
         #998#12 = "Numero total Declarados .: " + #997#18;
     |FINSI;

     |PINPA #0#998;
     |PINDA #0#998;
     |ENDATOS #1#998;
     |SI FSalida = 0;
         |PINPA #0#998;
         |PINDA #0#998;

         |CONFI "2400SRealizar Impresion de la Etiqueta : ";
         |SI FSalida ! 0; |ACABA; |FINSI;

         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |INFOR "dsmow015";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

         |PRINT; |PIEINF; |FININF; |FINIMP;
     |FINSI;
|FPRC;

|PROCESO EmiteEsto349_2001;
     |XCIERRA nHandle1;

     |CONTROL_SIMPLE 0, " BOTON, IMPRIMIR PORTADAS ", 0830, 0950, Boton3491;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, " BOTON, COPIAR DISKETTE   ", 1130, 1250, Boton3492;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, " BOTON,EMITIR LA ETIQUETA", 1430, 1550, Boton3493;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, " BOTON,   SALIR           ", 1730, 1850, Boton3496;
     nBoton4 = FSalida;

     |PARA; |SI;  |HACIENDO;
            |LEETECLA aTecla;

            |SI aTecla = aF2;
                |IMPRE 0;
                |SI FSalida = 0;
                    |INFOR "m349ch01";
                    |SI FSalida = 0;
                        nTeclaPapel = 1;
                        |SI nTecla = 3;
                            |HAZ QueHacemos349_2001;
                        |SINO;
                            |PARA nCampo = 0;  |SI nCampo [ 41;  |HACIENDO nCampo = nCampo + 1;
                                   #997nCampo = #97nCampo;
                            |SIGUE;
                            |PRINT;  |PIEINF;

                            nSwLee = 0;
                            |SI #0#8 = "C";
                                |BUCLE dsmow014C349_2001;
                            |SINO;
                                |BUCLE dsmow014N349_2001;
                            |FINSI;
                        |FINSI;

                        |FININF;
                    |FINSI;
                    |FINIMP;
                |FINSI;
            |FINSI;

            |SI aTecla = aF3;
                |ESTADO_CONTROL nBoton1, "HIDE";
                |ESTADO_CONTROL nBoton2, "HIDE";
                |ESTADO_CONTROL nBoton3, "HIDE";
                |ESTADO_CONTROL nBoton4, "HIDE";
                |ATRI I;
                |PINTA 0715, "Introduzca un Diskette Formateado en D.O.S. en su PC,";
                |PINTA 0815, "y pulse una Tecla para iniciar la copia.             ";
                |ATRI i;
                |LEETECLA aTecla;
                |HAZ Copiaa;
                |PINTA 0715, "                                                     ";
                |PINTA 0815, "                                                     ";
                |ESTADO_CONTROL nBoton1, "SHOW";
                |ESTADO_CONTROL nBoton2, "SHOW";
                |ESTADO_CONTROL nBoton3, "SHOW";
                |ESTADO_CONTROL nBoton4, "SHOW";
            |FINSI;

            |SI aTecla = aF4;
                |ESTADO_CONTROL nBoton1, "HIDE";
                |ESTADO_CONTROL nBoton2, "HIDE";
                |ESTADO_CONTROL nBoton3, "HIDE";
                |ESTADO_CONTROL nBoton4, "HIDE";
                |PUSHV 0501 2380;
                |HAZ ImprimeEtiq349_2001;
                |POPV;
                |ESTADO_CONTROL nBoton1, "SHOW";
                |ESTADO_CONTROL nBoton2, "SHOW";
                |ESTADO_CONTROL nBoton3, "SHOW";
                |ESTADO_CONTROL nBoton4, "SHOW";
            |FINSI;

            |SI aTecla = aF6;  |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4

     aAlfa = eaPathLanza + "CE" + #0#6 + ".TXT";
     |RFBORRA aAlfa;

     aAlfa = eaPathLanza + "CB" + #0#6 + ".TXT";
     |RFBORRA aAlfa;
|FPRC;

|PROCESO PapelCont349_2001;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI nTeclaPapel = 0;
         |INFOR "m349co01";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#8 = "C";
         |BUCLE dsmow014C349_2001;
     |SINO;
         |BUCLE dsmow014N349_2001;
     |FINSI;

     |FININF;
     |FINIMP;
|FPRC;

|PROCESO PapelOficial349_2001;
     |SI nTecla = 5;
         nTeclaPapel = 0;
         |HAZ PapelCont349_2001;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Botones349_2001;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision Papel Oficial Hoja a Hoja    ", 0513, 0754, Boton3491;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Emision Papel Oficial Continuo       ", 0913, 1154, Boton3492;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Emision Soporte Magnetico Individual ", 1313, 1554, Boton3493;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Emision Soporte Magnetico Colectivo  ", 1713, 1954, Boton3494;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F6> Informe de Comprobacion              ", 2113, 2354, Boton3495;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton3496;
     nBoton6 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "828";
     aF7 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;
             |MENAV "     Opcion no instalada";
             nTecla = 1;
         |FINSI;

         |SI aTecla = aF3;
             |MENAV "     Opcion no instalada";
             nTecla = 2;
         |FINSI;

         |SI aTecla = aF4;
             |SI enSwHay = 1;
                 nTecla = 3;
                 |SAL;
             |SINO;
                 |MENAV "      Se debera seleccionar una unica Empresa.";
             |FINSI;
         |FINSI;
         |SI aTecla = aF5;  nTecla = 4;   |SAL;  |FINSI;
         |SI aTecla = aF6;
             nTecla = 5;
             |HAZ PapelOficial349_2001;
         |FINSI;
         |SI aTecla = aF7;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;

     |PULSATECLA;
|FPRC;

|PROCESO Modelo349_2001;
     |SI eaParametro ! "349C";
         |HAZ Botones349_2001;
     |SINO;
         nTecla = 5;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1; |ACABA;  |FINSI;
     |SI nTecla = 5;  enInfComp = 1; |FINSI;

     |SI nTecla = 1;  |O nTecla = 2;
         |MENAV "     Opcion no instalada";
         |ACABA;
     |FINSI;

     |SI nTecla = 5;
         |HAZ PapelOficial349_2001;
         |ACABA;
     |FINSI;

     |SI nTecla = 3;  |O nTecla = 4;
         aAbre = eaPathEmision + "CE" + #0#6 + ".TXT";
         |XABRE "BW", aAbre, nHandle2;
     |FINSI;

     |SI nTecla = 4;
         nSwLee = 1;
         |BUCLE dsmow014C349_2001;

         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmow016.mas";
         |CARGA_DEF aDef, espejo@;
         |SI FSalida ! 0;
             aAlfa = "     Error en cargar el Def  dsmow016";
             |MENAV aAlfa;
             |ACABA;
         |FINSI;

         |PUSHV 0501 2380;
         |PINPA #0#997;
         |PINDA #0#997;
         |ENDATOS #1#997;
         |POPV;

         |PARA nCampo = 0;  |SI nCampo [ 41;  |HACIENDO nCampo = nCampo + 1;
               #97nCampo = #997nCampo;
         |SIGUE;

         |HAZ Registro0_349_2001;
     |FINSI;

     nSwLee = 0;
     |SI #0#8 = "C";
         |BUCLE dsmow014C349_2001;
     |SINO;
         |BUCLE dsmow014N349_2001;
     |FINSI;

     |SI nTecla = 3;  |O nTecla = 4;
         |XCIERRA nHandle2;

         eaFOrigen  = eaPathEmision + "CE" + #0#6 + ".TXT";
         eaFDestino = eaPathLanza   + "CE" + #0#6 + ".TXT";
         |HAZ CopiaFichero;

         |FBORRA eaFOrigen;
     |FINSI;

     |HAZ EmiteEsto349_2001;

     |SI nTecla = 4;
         |DESCARGA_DEF #espejo@;
     |FINSI;
|FPRC;

|| --------------------------------------------------------------------------
|| Emision para el A¤o 2002
|| --------------------------------------------------------------------------

|PROCESO Portada349I_2002;
     |DDEFECTO #997;

     enCodCli = #349#0;
     |HAZ LeePersona;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #997#0 = eaVarDni;

         eaAlfa = #715#1;  |HAZ QuitaRaros;
         #997#1 = eaAlfa;

         #997#2  = #715#29;
         #997#3  = #715#30;
         #997#4  = #715#31;
         #997#5  = #715#32;
         #997#6  = #715#33;
         #997#7  = #715#34;
         #997#8  = #715#35;
         #997#9  = #715#36;
         #997#10 = #715#37;
         #997#11 = #715#15;
         #997#12 = #715#16;

         eaAlfa   = #715#53;  |HAZ QuitaRaros;
         #997#13  = eaAlfa;

         eaAlfa   = #715#1;  enLinea = 2;  |HAZ LeeTelefono;  |QBF eaAlfa;
         |SI eaAlfa = "";
             eaAlfa   = #715#1;  enLinea = 1;  |HAZ LeeTelefono;
         |FINSI;
         |HAZ QuitaRarosTfno;
         #997#14  = eaAlfa;

         #997#15  = #997#13;
         #997#16  = "SECRETARIO";

         #997#20  = #715#17;
         #997#21  = #715#18;
         #997#22  = #715#38;
     |SINO;
         aAlfa = #715#96; |QBF aAlfa; |SI aAlfa = ""; #715#96 = #715#2; |FINSI;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #997#0 = eaVarDni;

         eaAlfa = #715#1;  |HAZ QuitaRaros;
         #997#1 = eaAlfa;

         #997#2  = #715#3;
         #997#3  = #715#4;
         #997#4  = #715#5;
         #997#5  = #715#6;
         #997#6  = #715#7;
         #997#7  = #715#8;
         #997#8  = #715#9;
         #997#9  = #715#10;
         #997#10 = #715#11;
         #997#11 = #715#15;
         #997#12 = #715#16;

         eaAlfa   = #715#96;  |HAZ QuitaRaros;
         #997#13  = eaAlfa;

         eaAlfa   = #715#14;  |HAZ QuitaRarosTfno;
         #997#14  = eaAlfa;

         #997#15  = #997#13;
         #997#16  = "SECRETARIO";

         #997#20  = #715#91;
         #997#21  = #715#92;
         #997#22  = #715#12;
     |FINSI;

     #997#23 = #349#1;
     |SI #349#2 ! 99;
         |SI #349#2 = 3;   #997#24 = "1T";  |FINSI;
         |SI #349#2 = 6;   #997#24 = "2T";  |FINSI;
         |SI #349#2 = 9;   #997#24 = "3T";  |FINSI;
         |SI #349#2 = 12;  #997#24 = "4T";  |FINSI;
     |SINO;
         #997#24 = "0A";
     |FINSI;

     |SI #997#23 ] 2010; |Y #4#22 = "M";
         #997#24 = ("00" + #349#2) % -102;
     |FINSI;

     |SI nTecla = 1;  #997#25 = "X";  |FINSI;
     |SI nTecla = 2;  #997#25 = "X";  |FINSI;
     |SI nTecla = 3;  #997#26 = "X";  |FINSI;
     |SI nTecla = 4;  #997#29 = "X";  |FINSI;

     #997#30 = #349#6;
     #997#31 = #349#7;
     #997#32 = #349#8;
     #997#33 = #349#9;
     #997#34 = #349#10;
     #997#42 = #349#11;
     |SI nTecla = 4;
         #997#37 = #97#19;
         #997#39 = #97#15;
         #997#40 = #97#16;
     |SINO;
         #997#37 = "";
         #997#39 = #997#15;
         #997#40 = #997#16;
     |FINSI;
     #997#41 = #349#0;
     eaAlfa  = #0#7;  |HAZ FechaBonito;  #997#38 = eaFechaB;
|FPRC;

|PROCESO Registro0_349_2002;
     |PARA nCampo = 0;  |SI nCampo [ 42;  |HACIENDO nCampo = nCampo + 1;
           #997nCampo = #97nCampo;
     |SIGUE;

     #997#23 = #349#1;
     |SI #349#2 ! 99;
         |SI #349#2 = 3;   #997#24 = "1T";  |FINSI;
         |SI #349#2 = 6;   #997#24 = "2T";  |FINSI;
         |SI #349#2 = 9;   #997#24 = "3T";  |FINSI;
         |SI #349#2 = 12;  #997#24 = "4T";  |FINSI;
     |SINO;
         #997#24 = "0A";
     |FINSI;

     |SI #997#23 ] 2010; |Y #4#22 = "M";
         #997#24 = ("00" + #349#2) % -102;
     |FINSI;

     #997#27 = "X";

     #997#37 = "";
     #997#38 = #97#15;
     #997#39 = #97#16;
     #997#41 = 0;
     eaAlfa  = #0#7;  |HAZ FechaBonito;  #997#38 = eaFechaB;

     |DDEFECTO #535;

     #535#0  = "0";

     #535#1  = "349";

     #535#2  = #0#6;

     eaVarDni = #997#0;  |HAZ CalculameDNI;
     #535#3  = eaVarDni;

     eaAlfa  = #997#1;  |HAZ QuitaRaros;
     #535#4  = eaAlfa;

     #535#5  = #997#2;

     eaAlfa  = #997#3;  |HAZ QuitaRaros;
     #535#6  = eaAlfa;

     nNume   = #997#4;
     #535#7  = (("00000" + nNume) % -105);

     #535#8  = #997#5;

     #535#9  = #997#6;

     #535#10 = #997#7;

     #535#11 = (("00" + #997#8) % -102) + (("000" + #997#9) % -103);

     eaAlfa  = #997#10;  |HAZ QuitaRaros;
     #535#12 = eaAlfa;

     #535#13 = (("00" + #997#8) % -102);

     #535#14 = (("00000" + #997#17) % -105);

     #535#15 = (("000000000" + #997#18) % -109);

     |SI #0#6 [ 2006;
         #535#16 = "D";
     |SINO;
         #535#16 = "T";
     |FINSI;

     eaAlfa  = #997#14;  |HAZ QuitaRarosTfno;
     #535#17 = eaAlfa;

     eaAlfa  = #997#13;  |HAZ QuitaRaros;
     #535#18 = eaAlfa;

     #535#19 = #997#24;

     #535#21 = &13 + &10;

     |SI nTecla = 3;  |O nTecla = 4;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 21;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #535nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |FINSI;

     |PARA nCampo = 0;  |SI nCampo [ 42;  |HACIENDO nCampo = nCampo + 1;
           #97nCampo = #997nCampo;
     |SIGUE;
|FPRC;

|PROCESO Registro1_349_2002;
     enCodCli = #349#0;
     |HAZ LeePersona;

     |DDEFECTO #536;

     #536#0  = "1";

     #536#1  = "349";

     #536#2  = #997#23;

     eaVarDni = #997#0;  |HAZ CalculameDNI;
     #536#3   = eaVarDni;

     eaAlfa   = #997#1;  |HAZ QuitaRaros;
     #536#4   = eaAlfa;

     |SI #0#6 [ 2006;
         #536#5   = "D";
     |SINO;
         #536#5   = "T";
     |FINSI;

     eaAlfa   = #997#14;  |HAZ QuitaRarosTfno;
     #536#6   = eaAlfa;

     eaAlfa   = #997#13;  |HAZ QuitaRaros;
     #536#7   = eaAlfa;

     |SI nTecla = 4;
         #536#8  = "343" + #997#37;
     |SINO;
         #536#8  = "343" + #997#19;
     |FINSI;

     |SI #349#12 = "C";
         #536#9 = "C";
     |FINSI;

     |SI #349#12 = "S";
         #536#10 = "S";
         #536#11 = #349#13;
     |FINSI;

     #536#12  = #997#24;

     enNume   = #349#6 + #349#8;
     #536#13  = ("000000000" + enNume) % -109;

     enNume  = #349#7 + #349#9;  |HAZ Conver15;
     #536#14  = eaAlfa;

     #536#15  = ("000000000" + #349#10) % -109;

     enNume  = #349#11;  |HAZ Conver15;
     #536#16  = eaAlfa;

     #536#18 = &13 + &10;

     |SI nTecla = 3;  |O nTecla = 4;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #536nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |FINSI;
|FPRC;

|PROCESO Registro2_349_2002;
     |SI nTecla = 1; |O nTecla = 2;
         |SI nTeclaPapel = 2;
             |SI #350#6 ! "A "; |Y #350#6 ! "E ";  |ACABA;  |FINSI;
         |FINSI;
         |SI nTeclaPapel = 3;
             |SI #350#6 ! "AR"; |Y #350#6 ! "ER";  |ACABA;  |FINSI;
         |FINSI;
     |FINSI;

     contador = contador + 1;
     |SI ndecontar = 1; |ACABA; |FINSI;

     |SI nTecla = 1;
         |SI contador = nNume2;
             |MENAV "     PULSE <INTRO> PARA IMPRIMIR HOJA";
             contador = 0;
         |FINSI;
     |FINSI;

     enCodCli = #349#0;
     |HAZ LeePersona;

     |DDEFECTO #537;
     eaPRec  = "";

     #537#0  = "2";

     #537#1  = "349";

     #537#2  = #349#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #537#3   = eaVarDni;
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #537#3   = eaVarDni;
     |FINSI;

     #537#4  = "";

     #537#5  = #350#8;
     |SI #350#8 = "GR ";  #537#5 = "EL";  |FINSI;

     #537#6  = #350#7;

     #537#7  = #350#9;

     #537#8 = "E";
     |SI #350#6  = "A ";  #537#8 = "A";  |FINSI;
     |SI #350#6  = "S ";  #537#8 = "S";  |FINSI;
     |SI #350#6  = "I ";  #537#8 = "I";  |FINSI;
     |SI #350#6  = "ER";  #537#8 = "E";  |FINSI;
     |SI #350#6  = "AR";  #537#8 = "A";  |FINSI;
     |SI #350#6  = "SR";  #537#8 = "S";  |FINSI;
     |SI #350#6  = "IR";  #537#8 = "I";  |FINSI;
     |SI #350#23 = "X";   #537#8 = "T";  |FINSI;

     |SI #350#6 = "A ";  |O #350#6 = "E ";
         enNume = #350#22;  |HAZ Conver13;
         #537#9  = eaAlfa;

         #537#10 = "";

         #537#11 = "";

         #537#12 = "";

         #537#13 = "";
     |SINO;
         #537#9  = "";

         #537#10 = #350#25;
         #537#11 = "";

         |SI #350#26 ! 0;
             |SI #350#26 = 1;   #537#11 = "1T";  |FINSI;
             |SI #350#26 = 2;   #537#11 = "2T";  |FINSI;
             |SI #350#26 = 3;   #537#11 = "3T";  |FINSI;
             |SI #350#26 = 4;   #537#11 = "4T";  |FINSI;

             |SI #350#26 = 11;  #537#11 = "01"; |FINSI;
             |SI #350#26 = 12;  #537#11 = "02"; |FINSI;
             |SI #350#26 = 13;  #537#11 = "03"; |FINSI;
             |SI #350#26 = 14;  #537#11 = "04"; |FINSI;
             |SI #350#26 = 15;  #537#11 = "05"; |FINSI;
             |SI #350#26 = 16;  #537#11 = "06"; |FINSI;
             |SI #350#26 = 17;  #537#11 = "07"; |FINSI;
             |SI #350#26 = 18;  #537#11 = "08"; |FINSI;
             |SI #350#26 = 19;  #537#11 = "09"; |FINSI;
             |SI #350#26 = 20;  #537#11 = "10"; |FINSI;
             |SI #350#26 = 21;  #537#11 = "11"; |FINSI;
             |SI #350#26 = 22;  #537#11 = "12"; |FINSI;

         |SINO;
             |SI #350#25 ! 0; #537#11 = "0A"; |FINSI;
         |FINSI;

         eaPRec  = #537#11;

         enNume = #350#22;  |HAZ Conver13;
         #537#12  = eaAlfa;

         enNume = #350#27;  |HAZ Conver13;
         #537#13  = eaAlfa;
     |FINSI;

     #537#15 = &13 + &10;

     |SI nTecla = 3;  |O nTecla = 4;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 15;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #537nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
         nTRegistro = nTRegistro + 1;
     |SINO;
         |SI nTecla ! 5;
             nContador = nContador + 1;
             nSwPrint = 1;
             |SI nContador ] nNume2;  nContador = 1;
                 |PIEINF;
                 hojas = hojas + 1;
             |FINSI;
         |FINSI;

         |PARA nCampo = 0;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
               #101nCampo = #350nCampo;
         |SIGUE;
         |PRINT;
     |FINSI;
|FPRC;

|PROCESO BuscaCargo349;
     eaAlfa  = #26#4;  |HAZ QuitaRaros;
     #504#13 = eaAlfa;

     eaAlfa  = #26#17;  |HAZ QuitaRaros;
     #504#14 = eaAlfa;
|FPRC;

|DEFBUCLE agim0026;
     #26#1;
     16;
     #999#0, 01, 01, 3;
     #999#0, 99, 99, 3;
     ;
     NULL, BuscaCargo349;
|FIN;

|PROCESO BuscaCargo349R;
     |SI #24#15 ! "A";
         eaAlfa  = #24#4;  |HAZ QuitaRaros;
         #504#13 = eaAlfa;

         eaAlfa  = "REPRESENTANTE";  |HAZ QuitaRaros;
         #504#14 = eaAlfa;

         nHayRepre = 1;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE agim0024;
     #24#2;
     ;
     #999#0, 99, 01;
     #999#0, 01, 99;
     ;
     NULL, BuscaCargo349R;
|FIN;

|PROCESO BuscaComuneros349;
     aAlfa = "31.12." + #349#1;
     |SI #1#8 > aAlfa;  |ACABA;  |FINSI;

     aAlfa = "01.01." + #349#1;
     |SI #1#9 > "01.01.0000";
         |SI #1#9 < aAlfa;  |ACABA;  |FINSI;
     |FINSI;

     nHayRepre = 1;

     enCodCli = #1#3;
     |HAZ LeePersona;

     eaAlfa  = #715#1;           |HAZ QuitaRaros;   #504#13 = eaAlfa;
     eaAlfa  = "REPRESENTANTE";  |HAZ QuitaRaros;   #504#14 = eaAlfa;

     |ERROR10;
|FPRC;

|DEFBUCLE dsmom001;
     #1#1;
     ;
     #999#0, 01, 0001;
     #999#0, 99, 9999;
     ;
     NULL, BuscaComuneros349;
|FIN;

|PROCESO Registro0_349_Auxiliar;
     |DDEFECTO #504;

     #504#0  = "0";

     #504#1  = "349";

     #504#2  = #349#1;

     eaVarDni = #997#0;  |HAZ CalculameDNI;
     #504#3   = eaVarDni;

     #504#4   = ("00" + #997#11) % -102;

     #504#5   = ("000" + #997#12) % -103;

     #504#6   = #997#2;

     eaAlfa   = #997#3;  |HAZ QuitaRaros;
     #504#7   = eaAlfa;

     nNume    = #997#4;
     #504#8   = ("00000" + nNume) % -105;

     eaAlfa   = #997#10;  |HAZ QuitaRaros;
     #504#9   = eaAlfa;

     #504#10  = ("00" + #997#8) % -102;

     #504#11  = (("00" + #997#8) % -102) + (("000" + #997#9) % -103);

     #504#12  = (#0#7 % -104) + (#0#7 % 402) + (#0#7 % 102);

     eaAlfa   = #997#15;  |HAZ QuitaRaros;
     #504#13  = eaAlfa;

     eaAlfa   = #997#16;  |HAZ QuitaRaros;
     #504#14  = eaAlfa;

     #504#16  = ("00000" + #999#0) % -105;
     #504#17  = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 0;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
           |SI nCampo ! 15;
               aAlfa = #504nCampo;
               |XGRABA nHandle3, aAlfa;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Registro1_349_Auxiliar;
     enCodCli = #349#0;
     |HAZ LeePersona;

     |DDEFECTO #504;

     #504#0  = "1";

     #504#1  = "349";

     #504#2  = #349#1;

     |SI enSwDeDonde = 1;
         eaVarDni = #715#3;  |HAZ CalculameDNI;
         #504#3   = eaVarDni;

         #504#4   = ("00" + #715#15) % -102;

         #504#5   = ("000" + #715#16) % -103;

         #504#6   = #715#29;

         eaAlfa   = #715#30;  |HAZ QuitaRaros;
         #504#7   = eaAlfa;

         nNume    = #715#31;
         #504#8   = ("00000" + nNume) % -105;

         #504#9   = #715#37;

         #504#10  = ("00" + #715#35) % -102;

         #504#11  = (("00" + #715#35) % -102) + (("000" + #715#36) % -103);
     |SINO;
         eaVarDni = #715#13;  |HAZ CalculameDNI;
         #504#3   = eaVarDni;

         #504#4   = ("00" + #715#63) % -102;

         #504#5   = ("000" + #715#64) % -103;

         #504#6   = #715#3;

         eaAlfa   = #715#4;  |HAZ QuitaRaros;
         #504#7   = eaAlfa;

         nNume    = #715#5;
         #504#8   = ("00000" + nNume) % -105;

         #504#9   = #715#11;

         #504#10  = ("00" + #715#9) % -102;

         #504#11  = (("00" + #715#9) % -102) + (("000" + #715#10) % -103);
     |FINSI;

     #504#12  = (#0#7 % -104) + (#0#7 % 402) + (#0#7 % 102);

     |SI nTecla ! 4;
         |SI #107#1 = "S";
             |BUCLE agim0026;
         |SINO;
             nHayRepre = 0;
             |BUCLE agim0024;
             |SI nHayRepre = 0;
                 |BUCLE dsmom001;
                 |SI nHayRepre = 0;
                     eaAlfa  = #999#3;  |HAZ QuitaRaros;
                     #504#13 = eaAlfa;

                     eaAlfa  = "TITULAR";  |HAZ QuitaRaros;
                     #504#14 = eaAlfa;
                 |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         |SI #107#2 = "P";
             eaAlfa   = #997#15;  |HAZ QuitaRaros;
             #504#13  = eaAlfa;

             eaAlfa   = #997#16;  |HAZ QuitaRaros;
             #504#14  = eaAlfa;
         |SINO;
             nHayRepre = 0;
             |BUCLE agim0024;
             |SI nHayRepre = 0;
                 |BUCLE dsmom001;
                 |SI nHayRepre = 0;
                     eaAlfa  = #999#3;  |HAZ QuitaRaros;
                     #504#13 = eaAlfa;

                     eaAlfa  = "TITULAR";  |HAZ QuitaRaros;
                     #504#14 = eaAlfa;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     #504#16  = ("00000" + #999#0) % -105;
     #504#17 = &13 + &10;

     |SI nTecla ! 2;  |Y nTecla ! 5;
         aAlfa = "";
         |PARA nCampo = 0;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |SI nCampo ! 15;
                   aAlfa = #504nCampo;
                   |XGRABA nHandle3, aAlfa;
               |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc349_2002;
     #350#1010;
     ;
     #349#0, #349#1, #349#2, #349#3, #349#4, 01, aDTipo, 0000, 00, "            ";
     #349#0, #349#1, #349#2, #349#3, #349#4, 99, aHTipo, 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Registro2_349_2002;
|FIN;

|PROCESO Lee3490_2002;       || Calculo Total de Declarantes y Declarados
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #349;
     #349#0  = #999#0;
     #349#1  = #999#1;
     #349#2  = #999#2;
     #349#3  = #999#5;
     #349#4  = #999#7;
     #349#5  = 0;
     |LEE 040#349=;
     |SI FSalida = 0;
         #997#17 = #997#17 + 1;
         #997#18 = #997#18 + (#349#6 + #349#8 + #349#10);
         #997#30 = #997#30 + #349#6;
         #997#31 = #997#31 + #349#7;
         #997#32 = #997#32 + #349#8;
         #997#33 = #997#33 + #349#9;
         #997#34 = #997#34 + #349#10;
         #997#42 = #997#42 + #349#11;
         #997#35 = #997#17;
         #997#36 = #997#18;
     |FINSI;
     |CIERRA #349;
|FPRC;

|PROCESO Lee3491_2002;        || Creacion de Ficheros
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |CIERRA #4;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #349;
     #349#0  = #999#0;
     #349#1  = #999#1;
     #349#2  = #999#2;
     #349#3  = #999#5;
     #349#4  = #999#7;
     #349#5  = 0;
     |LEE 040#349=;
     |SI FSalida = 0;
         |HAZ Portada349I_2002;

         |SI nTecla = 3;
             |PUSHV 0501 2380;
             |PINPA #0#997;
             |PINDA #0#997;
             |ENDATOS #4#997;
             |POPV;
         |FINSI;

         |HAZ Registro1_349_2002;

         aDTipo    = "  ";
         aHTipo    = "zz";

         |BUCLE dsmoc349_2002;

         |SI #0#6 ] 2003;
             |HAZ Registro1_349_Auxiliar;
         |FINSI;

         |SI nTecla = 4;
             |HAZ GrabaImpreso;
         |FINSI;
     |FINSI;
     |CIERRA #349;
|FPRC;

|PROCESO Lee349P_2002;       || Emision Papel
     |ABRE #4;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #4;

     |ABRE #349;
     #349#0  = #999#0;
     #349#1  = #999#1;
     #349#2  = #999#2;
     #349#3  = #999#5;
     #349#4  = #999#7;
     #349#5  = 0;
     |LEE 040#349=;
     |SI FSalida = 0;
         |SI nTecla = 1; |O nTecla = 2;
             |SI nTeclaPapel = 1;
                 |HAZ Portada349I_2002;
                 |SI nTecla = 1; |MENAV "     PULSE <INTRO> PARA IMPRIMIR HOJA"; |FINSI;
                 |PRINT;
                 |PIEINF;
                 |CIERRA #349;
                 |HAZ GrabaImpreso;
                 |ACABA;
             |FINSI;
             |SI nTeclaPapel > 1;
                 |HAZ Registro1_349_2002;
                 |SI nTeclaPapel = 2; aDTipo = "A "; aHTipo = "R "; nNume2 = 16; |FINSI;
                 |SI nTeclaPapel = 3; aDTipo = "AR"; aHTipo = "ER"; nNume2 = 11; |FINSI;

                 contador = 0;
                 ndecontar = 1;
                 enSwImpre = 1;  |BUCLE dsmoc349_2002;
                 ndecontar = 0;
                 nNume1 = 10;
                 |SI nTeclaPapel = 2; nNume1 = 15; |FINSI;
                 hojas = contador / nNume1;
                 resto = contador $ nNume1;
                 |SI resto ! 0; hojas = (hojas + 0.5) ! 0; |FINSI;
                 numhoja = hojas;

                 contador  = 0;
                 nContador = 0;
                 hojas     = 1;
                 |SI nTecla = 1; |MENAV "     PULSE <INTRO> PARA IMPRIMIR HOJA"; |FINSI;

                 enSwImpre = 1;  |BUCLE dsmoc349_2002;
                 |PIEINF;
                 |CIERRA #349;
                 |ACABA;
             |FINSI;
         |FINSI;

         |SI nTecla = 3;  |O nTecla = 4;
             |HAZ Portada349I_2002;
             |PRINT;
             |PIEINF;
             |CIERRA #349;
             |ACABA;
         |FINSI;

         |SI nTecla = 5;
             |HAZ Portada349I_2002;
             |HAZ Registro1_349_2002;
             aDTipo    = "  ";
             aHTipo    = "zz";

             enSwImpre = 1;  |BUCLE dsmoc349_2002;
             |PIEINF;
             |CIERRA #349;
             |ACABA;
         |FINSI;
     |FINSI;
     |CIERRA #349;
|FPRC;

|PROCESO QueHacemos349_2002;
     |SI nTeclaPapel ! 0;  |O nTecla = 5;   || En Papel Continuo
         |HAZ Lee349P_2002;
         |ACABA;
     |FINSI;

     |SI nSwLee = 1;        || Lectura para Colectivos para Totales Hoja
         |HAZ Lee3490_2002;
         |ACABA;
     |FINSI;

     |HAZ Lee3491_2002;          || Creacion de los Ficheros Planos.
|FPRC;

|DEFBUCLE dsmow014C349_2002;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos349_2002;
|FIN;

|DEFBUCLE dsmow014N349_2002;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos349_2002;
|FIN;

|PROCESO ImprimeEtiq349_2002;
     |SI nTecla = 3;
         #998#0  = "Delegacion .........: " + #997#20;
         #998#1  = "Ejercicio ..........: " + #536#2 + " " + #536#12;
         #998#2  = "Modelo .............: 349";
         #998#3  = "Numero Justificante : " + #536#8;
         #998#4  = "N.I.F. .............: " + #536#3;
         #998#5  = "Nombre : " + #536#4;
         #998#6  = #997#2 + " " + #997#3 + " " + #997#4 + " " + #997#6 + " " + #997#7;
         #998#7  = "P.Cont.: " + #997#13;
         #998#8  = "Telefono ...........: " + #997#14;
         #998#9  = "Numero total Registros ..: " + nTRegistro;
         #998#10 = "Densidad soporte : 1,44 MB en Diskettes de 3 1/2";
         #998#11 = "";
         #998#12 = "";
         |C_M #998#11, 1, "N";
         |C_M #998#12, 1, "N";
     |SINO;
         |PARA nCampo = 0;  |SI nCampo [ 42;  |HACIENDO nCampo = nCampo + 1;
               #997nCampo = #97nCampo;
         |SIGUE;

         #998#0  = "Delegacion .........: " + #997#20;
         #998#1  = "Ejercicio ..........: " + #535#2;
         #998#2  = "Modelo .............: 349";
         #998#3  = "Numero Justificante : " + #997#19;
         #998#4  = "N.I.F. .............: " + #535#3;
         #998#5  = "Nombre : " + #535#4;
         #998#6  = #535#5 + " " + #535#6 + " " + #535#7 + " " + #535#9 + " " + #535#10;
         #998#7  = "P.Cont.: " + #535#18;
         #998#8  = "Telefono ...........: " + #535#17;
         #998#9  = "Numero total Registros ..: " + nTRegistro;
         #998#10 = "Densidad soporte : 1,44 MB en Diskettes de 3 1/2";
         #998#11 = "";
         #998#12 = "";
         |C_M #998#11, 1, "S";
         |C_M #998#12, 1, "S";
         #998#11 = "Numero total Declarantes : " + #997#17;
         #998#12 = "Numero total Declarados .: " + #997#18;
     |FINSI;

     |PINPA #0#998;
     |PINDA #0#998;
     |ENDATOS #1#998;
     |SI FSalida = 0;
         |PINPA #0#998;
         |PINDA #0#998;

         |CONFI "2400SRealizar Impresion de la Etiqueta : ";
         |SI FSalida ! 0; |ACABA; |FINSI;

         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |INFOR "dsmow015";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

         |PRINT; |PIEINF; |FININF; |FINIMP;
     |FINSI;
|FPRC;

|PROCESO EmitePortada;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "m349ch02";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     nTeclaPapel = 1;
     |SI nTecla = 3;
         |HAZ QueHacemos349_2002;
     |SINO;
         |PARA nCampo = 0;  |SI nCampo [ 42;  |HACIENDO nCampo = nCampo + 1;
               #997nCampo = #97nCampo;
         |SIGUE;
         |PRINT;  |PIEINF;

         nSwLee = 0;
         |SI #0#8 = "C";
             |BUCLE dsmow014C349_2002;
         |SINO;
             |BUCLE dsmow014N349_2002;
         |FINSI;
     |FINSI;

     |FININF;
     |FINIMP;
|FPRC;


|PROCESO EmiteEsto349_2002;
     |XCIERRA nHandle1;

     FSalida = 0;
     |SI #0#6 [ 2002;
         |CONTROL_SIMPLE 0, " BOTON, IMPRIMIR PORTADAS ", 0830, 0950, Boton3491;
     |SINO;
         |SI nTecla = 3;
             |CONTROL_SIMPLE 0, " BOTON, <F2> VALIDACION        ", 0825, 0955, Boton3491;
         |FINSI;
     |FINSI;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, " BOTON, <F3> COPIAR DISKETTE   ", 1125, 1255, Boton3492;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, " BOTON, <F4> EMITIR LA ETIQUETA", 1425, 1555, Boton3493;
     nBoton3 = FSalida;

     |SI #0#6 ] 2007; |Y nTecla = 3;
         |CONTROL_SIMPLE 0, " BOTON, <F5> VALIDACION Y PRESENTACION TELEMATICA", 1725, 1855, Boton3494;
     |SINO;
         |CONTROL_SIMPLE 0, " BOTON, <F5> PRESENTACION TELEMATICA", 1725, 1855, Boton3494;
     |FINSI;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, " BOTON, <ESC> SALIR           ", 2025, 2155, Boton3496;
     nBoton5 = FSalida;

     |ESTADO_CONTROL nBoton1,  "ENABLE";  nSwBoton1 = 1
     |ESTADO_CONTROL nBoton2,  "ENABLE";  nSwBoton2 = 1
     |ESTADO_CONTROL nBoton3,  "ENABLE";  nSwBoton3 = 1

     |SI #0#6 ] 2007; |Y nTecla = 3;
         |ESTADO_CONTROL nBoton1,  "DISABLE";  nSwBoton2  = 0;
         |ESTADO_CONTROL nBoton2,  "DISABLE";  nSwBoton2  = 0;
         |ESTADO_CONTROL nBoton3,  "DISABLE";  nSwBoton3  = 0;
     |FINSI;

     |PARA; |SI;  |HACIENDO;
            |LEETECLA aTecla;

            |SI aTecla = aF2;
                |SI #0#6 [ 2002;
                    |HAZ EmitePortada;
                |FINSI;

                |SI #0#6 ] 2003;  |Y #0#6 [ 2006;
                    |HAZ Valida349;
                |FINSI;

                |SI #0#6 ] 2007; |Y nSwBoton1 = 1;
                    |HAZ Valida349_2007;
                    |SI enError = 1;  |SAL;  |FINSI;
                |FINSI;
            |FINSI;

            |SI aTecla = aF3; |Y nSwBoton2 = 1;
                |ESTADO_CONTROL nBoton1, "HIDE";
                |ESTADO_CONTROL nBoton2, "HIDE";
                |ESTADO_CONTROL nBoton3, "HIDE";
                |ESTADO_CONTROL nBoton4, "HIDE";
                |ESTADO_CONTROL nBoton5, "HIDE";
                |ATRI I;
                |PINTA 0715, "Introduzca un Diskette Formateado en D.O.S. en su PC,";
                |PINTA 0815, "y pulse una Tecla para iniciar la copia.             ";
                |ATRI i;
                |LEETECLA aTecla;
                |HAZ Copiaa;
                |PINTA 0715, "                                                     ";
                |PINTA 0815, "                                                     ";
                |ESTADO_CONTROL nBoton1, "SHOW";
                |ESTADO_CONTROL nBoton2, "SHOW";
                |ESTADO_CONTROL nBoton3, "SHOW";
                |ESTADO_CONTROL nBoton4, "SHOW";
                |ESTADO_CONTROL nBoton5, "SHOW";
            |FINSI;

            |SI aTecla = aF4; |Y nSwBoton3 = 1;
                |ESTADO_CONTROL nBoton1, "HIDE";
                |ESTADO_CONTROL nBoton2, "HIDE";
                |ESTADO_CONTROL nBoton3, "HIDE";
                |ESTADO_CONTROL nBoton4, "HIDE";
                |ESTADO_CONTROL nBoton5, "HIDE";
                |PUSHV 0501 2380;
                |HAZ ImprimeEtiq349_2002;
                |POPV;
                |ESTADO_CONTROL nBoton1, "SHOW";
                |ESTADO_CONTROL nBoton2, "SHOW";
                |ESTADO_CONTROL nBoton3, "SHOW";
                |ESTADO_CONTROL nBoton4, "SHOW";
                |ESTADO_CONTROL nBoton5, "SHOW";
            |FINSI;

            |SI aTecla = aF5;
                |SI #0#6 ] 2007;
                    |SI nTecla = 3;
                        |HAZ Valida349_2007;
                        |SI enError = 1;  |SAL;  |FINSI;
                    |FINSI;
                |FINSI;
                |HAZ CopiaInternet;
                |SAL;
            |FINSI;

            |SI aTecla = aF7;  |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;

     aAlfa = eaPathLanza + "CE" + #0#6 + ".TXT";
     |RFBORRA aAlfa;

     aAlfa = eaPathLanza + "CB" + #0#6 + ".TXT";
     |RFBORRA aAlfa;
|FPRC;

|PROCESO PapelCont349_2002;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI nTeclaPapel = 0;
         |INFOR "m349co01";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI nTeclaPapel = 1;   || Portada
         |INFOR "m349ch03";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI nTeclaPapel = 2;   || Entregas y Adquisciones
         |INFOR "m349ch12";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI nTeclaPapel = 3;   || Rectificaciones
         |INFOR "m349ch13";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#8 = "C";
         |BUCLE dsmow014C349_2002;
     |SINO;
         |BUCLE dsmow014N349_2002;
     |FINSI;

     |FININF;
     |FINIMP;
|FPRC;

|PROCESO PapelOficial349_2002;
     |SI nTecla = 5;
         nTeclaPapel = 0;
         |HAZ PapelCont349_2002;
         |ACABA;
     |FINSI;

     |CONTROL_SIMPLE 0, "LBOTON,F2 Emision Portada                            ", 0623, 0864, Boton3491;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3 Emision Hojas de Entregas y Adquisiciones  ", 1023, 1264, Boton3492;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F4 Emision Hojas de Rectificaciones           ", 1423, 1664, Boton3493;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Salir   ", 2165, 2178, Boton3496;
     nBoton6 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "828";
     aF7 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTeclaPapel = 1;  |HAZ PapelCont349_2002;   |FINSI;
         |SI aTecla = aF3;  nTeclaPapel = 2;  |HAZ PapelCont349_2002;   |FINSI;
         |SI aTecla = aF4;  nTeclaPapel = 3;  |HAZ PapelCont349_2002;   |FINSI;
         |SI aTecla = aF7;  nTeclaPapel = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton6;

|FPRC;

|PROCESO Botones349_2002;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision Papel Oficial Hoja a Hoja    ", 0513, 0754, Boton3491;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Emision Papel Oficial Continuo       ", 0913, 1154, Boton3492;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Emision Soporte Magnetico o Telematica Individual ", 1313, 1554, Boton3493;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Emision Soporte Magnetico o Telematica Colectivo  ", 1713, 1954, Boton3494;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F6> Informe de Comprobacion              ", 2113, 2354, Boton3495;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton3496;
     nBoton6 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "828";
     aF7 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;
             nTecla = 1;
             |SAL;
         |FINSI;

         |SI aTecla = aF3;
             nTecla = 2;
             |SAL;
         |FINSI;

         |SI aTecla = aF4;
             |SI enSwHay = 1;
                 nTecla = 3;
                 |SAL;
             |SINO;
                 |MENAV "      Se debera seleccionar una unica Empresa.";
             |FINSI;
         |FINSI;

         |SI aTecla = aF5;  nTecla = 4;   |SAL;  |FINSI;

         |SI aTecla = aF6;
             nTecla = 5;
             |HAZ PapelOficial349_2002;
         |FINSI;
         |SI aTecla = aF7;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;

     |PULSATECLA;
|FPRC;

|PROCESO Modelo349_2002;
     |SI eaParametro ! "349C";
         |HAZ Botones349_2002;
     |SINO;
         nTecla = 5;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1; |ACABA;  |FINSI;
     |SI nTecla = 5;  enInfComp = 1; |FINSI;

     |SI nTecla = 1;  |O nTecla = 2;
         || ... |MENAV "     Opcion no instalada";
         |HAZ PapelOficial349_2002;
         |ACABA;
     |FINSI;

     |SI nTecla = 5;
         |HAZ PapelOficial349_2002;
         |ACABA;
     |FINSI;

     |SI nTecla = 3;  |O nTecla = 4;
         aAbre = eaPathEmision + "CE" + #0#6 + ".TXT";
         |XABRE "BW", aAbre, nHandle2;

         |SI #0#6 ] 2003;
             aAbre = eaPathEmision + "CB" + #0#6 + ".TXT";
             |XABRE "BW", aAbre, nHandle3;
         |FINSI;
     |FINSI;

     |SI nTecla = 4;
         nSwLee = 1;
         |BUCLE dsmow014C349_2002;

         |DBASE aPathModelo;  |QBT aPathModelo;
         aDef = aPathModelo + "def/dsmow016.mas";
         |CARGA_DEF aDef, espejo@;
         |SI FSalida ! 0;
             aAlfa = "     Error en cargar el Def  dsmow016";
             |MENAV aAlfa;
             |ACABA;
         |FINSI;

         |PUSHV 0501 2380;
         |PINPA #0#997;
         |PINDA #0#997;
         |ENDATOS #1#997;
         |POPV;

         |PARA nCampo = 0;  |SI nCampo [ 42;  |HACIENDO nCampo = nCampo + 1;
               #97nCampo = #997nCampo;
         |SIGUE;

         |HAZ Registro0_349_2002;
         |SI #0#6 ] 2003;
             |HAZ Registro0_349_Auxiliar;
         |FINSI;
     |FINSI;

     nSwLee = 0;
     |SI #0#8 = "C";
         |BUCLE dsmow014C349_2002;
     |SINO;
         |BUCLE dsmow014N349_2002;
     |FINSI;

     |SI nTecla = 3;  |O nTecla = 4;
         |XCIERRA nHandle2;
         |XCIERRA nHandle3;

         eaFOrigen  = eaPathEmision + "CE" + #0#6 + ".TXT";
         eaFDestino = eaPathLanza   + "CE" + #0#6 + ".TXT";
         |HAZ CopiaFichero;

         |FBORRA eaFOrigen;

         eaFOrigen  = eaPathEmision + "CB" + #0#6 + ".TXT";
         eaFDestino = eaPathLanza   + "CB" + #0#6 + ".TXT";
         |HAZ CopiaFichero;

         |FBORRA eaFOrigen;
     |FINSI;

     |HAZ EmiteEsto349_2002;

     |SI nTecla = 4;
         |DESCARGA_DEF #espejo@;
     |FINSI;
|FPRC;

|PROCESO Del2009PaBajo;
     |ABRE #4;
     |ABRE #100;
     |ABRE #349;
     |ABRE #350;
     |BUCLE dsmow014R349;
     |CIERRA #4;
     |CIERRA #100;
     |CIERRA #349;
     |CIERRA #350;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |SI #0#6 [ 2001;  |HAZ Modelo349_2001;  |FINSI;
     |SI #0#6 ] 2002;  |HAZ Modelo349_2002;  |FINSI;
|FPRC;

|| **************************************************************************
|| PROCESOS DE LAS EMISIONES DEL 349 DEL 2010 PA RIBA
|| **************************************************************************

|PROCESO Registro1_349_2010;
     enCodCli = #349#0;
     |HAZ LeePersona;

     |HAZ Portada349I_2001;

     |DDEFECTO #538;

     #538#0   = "1";

     #538#1   = "349";

     #538#2   = #349#1;

     eaVarDni = #997#0;  |HAZ CalculameDNI;
     #538#3   = eaVarDni;

     eaAlfa   = #997#1;  |HAZ QuitaRaros;
     #538#4   = eaAlfa;

     #538#5   = "T";

     eaAlfa   = #997#14;  |HAZ QuitaRarosTfno;
     #538#6   = eaAlfa;

     eaAlfa   = #997#13;  |HAZ QuitaRaros;
     #538#7   = eaAlfa;

     #538#8   = "3490000000000";

     |SI #349#12 = "C";
         #538#9 = "C";
         #538#11 = #349#13;
     |FINSI;

     |SI #349#12 = "S";
         #538#10 = "S";
         #538#11 = #349#13;
     |FINSI;

     |SI #4#22 = "M";
         |ABRE #95;
         #95#0 = #349#0;
         #95#1 = #349#1;
         |LEE 000#95=;
         |SI FSalida ! 0;  |DDEFECTO #95;  |FINSI;
         |CIERRA #95;

         #538#12 = (("00" + #349#2) % -102);

                           nCampo = 0;
         |SI #349#2 = 2;   nCampo = 27;  |FINSI;
         |SI #349#2 = 5;   nCampo = 28;  |FINSI;
         |SI #349#2 = 8;   nCampo = 29;  |FINSI;
         |SI #349#2 = 11;  nCampo = 30;  |FINSI;

         |SI nCampo ! 0;
             |SI #95nCampo = "S";  #538#17 = "X";  |FINSI;
         |FINSI;
     |FINSI;

     |SI #4#22 = "T";
         |SI #349#2 = 3;   #538#12 = "1T";  |FINSI;
         |SI #349#2 = 6;   #538#12 = "2T";  |FINSI;
         |SI #349#2 = 9;   #538#12 = "3T";  |FINSI;
         |SI #349#2 = 12;  #538#12 = "4T";  |FINSI;
     |FINSI;

     |SI #4#22 = "A";
         #538#12 = "0A";
     |FINSI;

     enNume   = #349#6 + #349#8;
     #538#13  = ("000000000" + enNume) % -109;

     enNume   = #349#7 + #349#9;  |HAZ Conver15;
     #538#14  = eaAlfa;

     #538#15  = ("000000000" + #349#10) % -109;

     enNume   = #349#11;  |HAZ Conver15;
     #538#16  = eaAlfa;

     #538#21  = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 0;  |SI nCampo [ 21;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #538nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|PROCESO Registro2_349_2010;
     |DDEFECTO #539;

     #539#0  = "2";

     #539#1  = "349";

     #539#2  = #349#1;
     #539#3  = #538#3;
     #539#4  = "";

     #539#5  = #350#8;
     |SI #350#8 = "GR ";  #539#5 = "EL";  |FINSI;

     #539#6  = #350#7;

     #539#7  = #350#9;

                          #539#8 = "E";
     |SI #350#6  = "M ";  #539#8 = "M";  |FINSI;
     |SI #350#6  = "H ";  #539#8 = "H";  |FINSI;  ||tique 70000_6570
     |SI #350#6  = "A ";  #539#8 = "A";  |FINSI;
     |SI #350#6  = "S ";  #539#8 = "S";  |FINSI;
     |SI #350#6  = "I ";  #539#8 = "I";  |FINSI;
     |SI #350#6  = "ER";  #539#8 = "E";  |FINSI;
     |SI #350#6  = "MR";  #539#8 = "M";  |FINSI;
     |SI #350#6  = "HR";  #539#8 = "H";  |FINSI;
     |SI #350#6  = "AR";  #539#8 = "A";  |FINSI;
     |SI #350#6  = "SR";  #539#8 = "S";  |FINSI;
     |SI #350#6  = "IR";  #539#8 = "I";  |FINSI;
     |SI #350#23 = "X";   #539#8 = "T";  |FINSI;

     |SI #350#6 = "A ";  |O #350#6 = "E ";  |O #350#6 = "S ";
      |O #350#6 = "I ";  |O #350#6 = "M ";  |O #350#6 = "H ";
         enNume = #350#22;  |HAZ Conver13;
         #539#9  = eaAlfa;

         #539#10 = "";

         #539#11 = "";

         #539#12 = "";

         #539#13 = "";
     |SINO;
         #539#9  = "";

         #539#10 = #350#25;

         |SI #350#26 = 0;   #539#11 = "0A";   |FINSI;
         |SI #350#26 = 1;   #539#11 = "1T";   |FINSI;
         |SI #350#26 = 2;   #539#11 = "2T";   |FINSI;
         |SI #350#26 = 3;   #539#11 = "3T";   |FINSI;
         |SI #350#26 = 4;   #539#11 = "4T";   |FINSI;
         |SI #350#26 = 11;  #539#11 = "01";   |FINSI;
         |SI #350#26 = 12;  #539#11 = "02";   |FINSI;
         |SI #350#26 = 13;  #539#11 = "03";   |FINSI;
         |SI #350#26 = 14;  #539#11 = "04";   |FINSI;
         |SI #350#26 = 15;  #539#11 = "05";   |FINSI;
         |SI #350#26 = 16;  #539#11 = "06";   |FINSI;
         |SI #350#26 = 17;  #539#11 = "07";   |FINSI;
         |SI #350#26 = 18;  #539#11 = "08";   |FINSI;
         |SI #350#26 = 19;  #539#11 = "09";   |FINSI;
         |SI #350#26 = 20;  #539#11 = "10";   |FINSI;
         |SI #350#26 = 21;  #539#11 = "11";   |FINSI;
         |SI #350#26 = 22;  #539#11 = "12";   |FINSI;

         enNume = #350#22;  |HAZ Conver13;
         #539#12  = eaAlfa;

         enNume = #350#27;  |HAZ Conver13;
         #539#13  = eaAlfa;
     |FINSI;

     #539#16 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 0;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #539nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmoc349_2010;
     #350#1010;
     ;
     #349#0, #349#1, #349#2, #349#3, #349#4, 01, aDTipo, 0000, 00, "            ";
     #349#0, #349#1, #349#2, #349#3, #349#4, 99, aHTipo, 9999, 99, "zzzzzzzzzzzz";
     ;
     NULL, Registro2_349_2010;
|FIN;

|PROCESO LeeModelo_2010;
     #4#0  = #999#0;
     #4#1  = #999#1;
     #4#2  = #999#2;
     #4#3  = #999#5;
     #4#4  = #999#7;
     |LEE 040#4=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #349#0  = #999#0;
     #349#1  = #999#1;
     #349#2  = #999#2;
     #349#3  = #999#5;
     #349#4  = #999#7;
     #349#5  = 0;
     |LEE 040#349=;
     |SI FSalida ! 0;  |ACABA;   |FINSI;

     |HAZ Registro1_349_2010;

     |BUCLE dsmoc349_2010;
|FPRC;

|PROCESO QueHacemos349_2010;
     aAbre = eaPathEmision + "349" + (("00000" + #999#0) % -105) + ".TXT";
     |XABRE "BW", aAbre, nHandle2;

     |HAZ LeeModelo_2010;

     |XCIERRA nHandle2;

     eaFOrigen  = eaPathEmision + "349" + (("00000" + #999#0) % -105) + ".TXT";
     eaFDestino = eaPathLanza   + "349" + (("00000" + #999#0) % -105) + ".TXT";
     |HAZ CopiaFichero;

     |FBORRA eaFOrigen;

     eaTipoE =  "349" + (("00000" + #999#0) % -105) + ".TXT";
     eaTipoR =  "CCC" + (("00000" + #999#0) % -105) + ".TXT";
     eaTipoV =  "S";
     |HAZ LineaShellJava;
|FPRC;

|DEFBUCLE dsmow014C349_2010;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos349_2010;
|FIN;

|DEFBUCLE dsmow014N349_2010;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos349_2010;
|FIN;

|PROCESO Botones349_2010;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Generacion fichero para internet ", 0513, 0754, Boton3491;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Informe de Comprobacion              ", 1013, 1254, Boton3492;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton3496;
     nBoton3 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF7 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  nTecla = 3;  |SAL;  |FINSI;
         |SI aTecla = aF3;  nTecla = 5;  |SAL;  |FINSI;
         |SI aTecla = aF7;  nTecla = 0;  |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;

     |PULSATECLA;
|FPRC;

|PROCESO CreaUnico;
     |DBASE aPathAfegir;  |QBF aPathAfegir;
     aPathAfegir = aPathAfegir + "basura";      |MKDIR aPathAfegir;
     aPathAfegir = aPathAfegir + "/tmp";        |MKDIR aPathAfegir;
     aPathAfegir = aPathAfegir + "/";

     aNombre = "34900000.txt";
     |PINTA 1320, "Nombre Fichero: ";
     |PINTA 1346, ".TXT";

     E_inf   = "";
     E_sup   = "8";
     |PARA;  |SI;  |HACIENDO;
             aNombre = 1336 ? 1;  |QBF aNombre;

             aAbre = eaPathInternet + aNombre + ".txt";
             |XABRE "EC", aAbre, nHandle1;
             |SI FSalida ] 0;
                 |CONFI "0000NEl Fichero ya existe, desea reemplazarlo.";
                 |SI FSalida = 0;  |SAL;  |FINSI;
             |SINO;
                 |SAL;
             |FINSI;
     |SIGUE;

     aDestino = eaPathInternet + aNombre + ".txt";
     |RFBORRA aDestino;

     aFichero    = aPathAfegir + "*.*";
     |_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;
            |FBORRA aFichero;
            |_SDIR aFichero;
     |SIGUE;

     aIPRemoto   = "";
     |IP_REMOTO aIPRemoto;

     aPathInter  = eaPathLanza + "AInternet";
     aPathInter  = aPathInter + "/";
     aFichero    = aPathInter + "*.bue";
     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            aBue     = aFichero - aPathInter;
            aDestino = aPathAfegir + aBue;

            |SI aIPRemoto = "";
                |COPIA_FICHERO aFichero, aDestino;
            |SINO;
                |RECIBE_FICHERO aFichero, aDestino;
            |FINSI;

            |RFBORRA aFichero

            aOrigen  = aDestino;
            aDestino = aPathAfegir + aNombre + ".txt";
            |AFEGIR_FICHERO aOrigen, aDestino;

            |FBORRA aOrigen

            |ABRE #999;
            aAlfa = aBue % 405;
            #999#0 = aAlfa;
            #999#1 = #0#6;
            #999#2 = #0#4;
            |LEE 000#999=;
            |SI FSalida = 0;
                enInternet = 1;
                |HAZ GrabaImpreso;
            |FINSI;
            |CIERRA #999;

            |R_SDIR aFichero;
     |SIGUE;

     aOrigen  = aDestino;
     aDestino = eaPathInternet  + aNombre + ".txt";
     |SI aIPRemoto = "";
         |COPIA_FICHERO aOrigen, aDestino;
     |SINO;
         |ENVIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |FBORRA aOrigen;

     aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
     |MENAV aAlfa;
|FPRC;

|PROCESO CreaVarios;
     aIPRemoto   = "";
     |IP_REMOTO aIPRemoto;

     aPathInter  = eaPathLanza +  "AInternet/";
     aFichero    = aPathInter + "*.bue";
     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            aBue     = aFichero - aPathInter;
            aDestino = eaPathInternet + "349" + (aBue % 405) + ".txt";

            |RCOPIA_FICHERO aFichero, aDestino;

            |RFBORRA aFichero;

            |ABRE #999;
            aAlfa = aBue % 405;
            #999#0 = aAlfa;
            #999#1 = #0#6;
            #999#2 = #0#4;
            |LEE 000#999=;
            |SI FSalida = 0;
                enInternet = 1;
                |HAZ GrabaImpreso;
            |FINSI;
            |CIERRA #999;

            |R_SDIR aFichero;
     |SIGUE;

     aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
     |MENAV aAlfa;
|FPRC;

|PROCESO Internet2010;
     eaFichError  = "ccc";
     eaFichDatos  = "349";
     eaFichAuxil  = "";
     enValidacion = 1;

     |HAZ BuscaErroresL;

     |SI enBuenos = 0;
         |MENAV "      Ha habido Errores, arreglelos y vuelva a emitir.";
         |ACABA;
     |FINSI;

     aAlfa = "EMPRESAS VALIDADAS  ...: " + enBuenos;
     |PINTA 0630, aAlfa;

     aAlfa = "EMPRESAS NO VALIDADAS .: " + enMalos;
     |PINTA 0730, aAlfa;

     |CONTROL_SIMPLE 0, " BOTON, CREAR UN UNICO FICHERO CON LAS EMPRESAS VALIDADAS ", 1120, 1265, Boton3491;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, " BOTON, FICHERO POR CADA UNA DE LAS EMPRESAS VALIDADAS", 1320, 1465, Boton3492;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, " BOTON,   CANCELAR    ", 1520, 1665, Boton3496;
     nBoton3 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
            |LEETECLA aTecla;
            |SI aTecla = aF2;  nBoton = 1;  |SAL;  |FINSI;
            |SI aTecla = aF3;  nBoton = 2;  |SAL;  |FINSI;
            |SI aTecla = aF4;  |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;

     |PULSATECLA;

     |SI aTecla = aF4;  |ACABA;  |FINSI;

     |SI nBoton = 1;  |HAZ CreaUnico;   |FINSI;
     |SI nBoton = 2;  |HAZ CreaVarios;  |FINSI;
|FPRC;

|PROCESO Modelo349_2010;
     |SI eaParametro ! "349C";
         |HAZ Botones349_2010;
     |SINO;
         nTecla = 5;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1; |ACABA;  |FINSI;
     |SI nTecla = 5;  enInfComp = 1; |FINSI;

     |SI nTecla = 5;
         |HAZ PapelOficial349_2002;
         |ACABA;
     |FINSI;

     aDTipo    = "  ";
     aHTipo    = "zz";

     |ABRE #4;
     |ABRE #349;
     |SI #0#8 = "C";
         |BUCLE dsmow014C349_2010;
     |SINO;
         |BUCLE dsmow014N349_2010;
     |FINSI;
     |CIERRA #4;
     |CIERRA #349;

     |HAZ Internet2010;
|FPRC;

|PROCESO Del2010PaRiba;
     |ABRE #4;
     |ABRE #100;
     |ABRE #349;
     |ABRE #350;
     |BUCLE dsmow014R349;
     |CIERRA #4;
     |CIERRA #100;
     |CIERRA #349;
     |CIERRA #350;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |HAZ Modelo349_2010;
|FPRC;

|PROCESO QueHacemos349_2013;
     eaFicheroPlano = "349" + (("00000" + #999#0) % -105) + ".txt";
     eaFicheroImpre = "349" + (("00000" + #999#0) % -105) + ".imp";
     eaFicheroSalid = "349" + (("00000" + #999#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #999#0) % -105) + ".txt";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ LeeModelo_2010;

     |XCIERRA nHandle2;

     enEmpresa    = #999#0;
     eaNomEmpresa = #999#3;
     eaOpcion     = "3";

     |HAZ PresentaPortal;
|FPRC;

|DEFBUCLE dsmow014C349_2013;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos349_2013;
|FIN;

|DEFBUCLE dsmow014N349_2013;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos349_2013;
|FIN;

|PROCESO Modelo349_2013;
     |SI eaParametro ! "349C";
         |HAZ Botones349_2010;
     |SINO;
         nTecla = 5;
     |FINSI;

     |SI nTecla = 0;  enInfComp = 1; |ACABA;  |FINSI;
     |SI nTecla = 5;  enInfComp = 1; |FINSI;

     |SI nTecla = 5;
         |HAZ PapelOficial349_2002;
         |ACABA;
     |FINSI;

     |HAZ PreguntaPresentacion;

     |HAZ TraeTgzCobol;

     aDTipo    = "  ";
     aHTipo    = "zz";

     |ABRE #4;
     |ABRE #349;
     |SI #0#8 = "C";
         |BUCLE dsmow014C349_2013;
     |SINO;
         |BUCLE dsmow014N349_2013;
     |FINSI;
     |CIERRA #4;
     |CIERRA #349;

     |HAZ SacaErrorPtl;

     |SI enPresentar = 0;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Del2013PaRiba;
     |ABRE #4;
     |ABRE #100;
     |ABRE #349;
     |ABRE #350;
     |BUCLE dsmow014R349;
     |CIERRA #4;
     |CIERRA #100;
     |CIERRA #349;
     |CIERRA #350;

     enCambiaMoneda = 1;
     enSwTrata      = 0;

     |HAZ Modelo349_2013;
|FPRC;

|| --------------------------------------------------------------------------
|| Emision Modelo 349
|| --------------------------------------------------------------------------

|PROGRAMA;
     aFichero = ("000" + Usuario) % 108;
     |NOME_DAT #0 aFichero;

     aFichero = ("imp" + Usuario) % 108;
     |NOME_DAT #999 aFichero;

     |ABRE #107;
     |LEE 040#107p;
     |SI FSalida ! 0;
         |CIERRA #107;
         |SUB_EJECUTA_NP "dsmom107";
         |ABRE #107;
     |FINSI;

     |LEE 040#107p;
     |SI FSalida ! 0;  |DDEFECTO #107;  |FINSI;
     |CIERRA #107;

     |ABRE #0;
     |LEE 000#0p;
     |CIERRA #0;

     aEjer      = #0#6;
     aEjer      = aEjer % -102;

     aDTipo = "  ";
     aHTipo = "zz";

     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/dsmoc349.mas";
     |CARGA_DEF aDef, dsmoc349@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def  dsmoc349";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/dsmod349.mas";
     |CARGA_DEF aDef, dsmod349@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def  dsmod349";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     aFichero = ("im1" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #349 aFichero;

     aFichero = ("im2" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #350 aFichero;

     |SI #0#6 [ 2009;  |HAZ Del2009PaBajo;  |FINSI;
     |SI #0#6 = 2010;  |HAZ Del2010PaRiba;  |FINSI;
     |SI #0#6 = 2011;  |HAZ Del2010PaRiba;  |FINSI;
     |SI #0#6 = 2012;  |HAZ Del2010PaRiba;  |FINSI;
     |SI #0#6 = 2013;  |HAZ Del2013PaRiba;  |FINSI;
     |SI #0#6 = 2014;  |HAZ Del2013PaRiba;  |FINSI;
     |SI #0#6 = 2015;  |HAZ Del2013PaRiba;  |FINSI;
     |SI #0#6 = 2016;  |HAZ Del2013PaRiba;  |FINSI;
     |SI #0#6 = 2017;  |HAZ Del2013PaRiba;  |FINSI;
     |SI #0#6 ] 2018;  |HAZ moy34901;       |FINSI;

     |ABRE #349;  |CIERRA #349;  |DELINDEX #349;
     |ABRE #350;  |CIERRA #350;  |DELINDEX #350;

     |DESCARGA_DEF #dsmod349@;
     |DESCARGA_DEF #dsmoc349@;
|FPRO;
