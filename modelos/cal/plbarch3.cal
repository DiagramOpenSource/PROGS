|FICHEROS;
     dsmom004;

     :integral/dsam0000;
     :dsarchi/prtlm002;
|FIN;

|VARIABLES;
     aBass               = "";
     aMas                = "";
     aComp               = "";
     aConf               = "";
     aHora               = "";

     &eaBloq             = "";
|FIN;

|PROCESO prtlm002;
     aConf = #prtlm002#7;
|FPRC;

|DEFBUCLE prtlm002;
     #prtlm002#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, aComp, "01.01.0000", "        ";
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, aComp, "31.12.2999", "zzzzzzzz";
     ;
     NULL, prtlm002;
|FIN;

|PROCESO BloqueoEmision;
     eaBloq = " ";

     |DBASS aBass;

     aMas = aBass + "dsarchi/def/ptrlm001.mas";
     |XABRE "E", aMas, 0;
     |SI FSalida < 0;
         |ACABA;
     |FINSI;

     aMas = aBass + "integral/def/dsam0000.mas";
     |XABRE "E", aMas, 0;
     |SI FSalida < 0;
         |ACABA;
     |FINSI;

     |ABRE #dsam0000;
     #dsam0000#0 = #dsmom004#0;
     |LEE 000#dsam0000.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0000;  |FINSI;
     |CIERRA #dsam0000;

     |SI #dsam0000#120 = "N";
         |ACABA;
     |FINSI;

     aComp = ("00" + #dsmom004#4) % -102;
     aConf = "";
     |BUCLE prtlm002;
     |SI aConf = "";
         |HORA aHora;
         #prtlm002#0 = #dsmom004#0;
         #prtlm002#1 = #dsmom004#1;
         #prtlm002#2 = #dsmom004#2;
         #prtlm002#3 = #dsmom004#3;
         #prtlm002#4 = aComp;
         #prtlm002#5 = ~;
         #prtlm002#6 = aHora;
         #prtlm002#7 = "N";
         #prtlm002#8 = Usuario % 810;

         |GRABA 020#prtlm002.n;
         |LIBERA #prtlm002;

         aConf = #prtlm002#7;
     |FINSI;

     |SI aConf = "N";  eaBloq = "P";  |FINSI;
     |SI aConf = "S";  eaBloq = " ";  |FINSI;
|FPRC;
