|FICHEROS;
     dsmoz041 #0;
     dsmom040 #40;
     dsmom041 #41;
     dsmom042 #42;
     dsmom044 #44;
     dsmom045 #45;
     dsmom046 #46;
     dsmom049 #49;
     dsmom107 #107;

     dsmow041 #999,MANTE;

    :/basica/def/agicen14 #114;
    :/basica/def/agifigen #1000;
|FIN;

|VARIABLES;
 &errconta = 0;
 &esalta = 0;
 alfa1 = "";
 nume1 = 0;
 nInkey = 0;

 &eaDElem  = "";
 &eaHElem  = "";
 &enDNEle  = 0;
 &enHNEle  = 0;
 &nNingunaMas = 0;
 &nLaPrimera  = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;

|PROCESO EsoNoAna;

     |HAZ Analitica;
     |SI enSwAna = 1;
         |C_V #dsmom040#9,1,"S";
         |C_V #dsmom041#34,1,"S";
         |C_M #dsmom041#34,1,"S";
         |ATRI P; |PINTA 1460, "        Ana: "; |ATRI 0;
     |SINO;
         |C_V #dsmom040#9,1,"N";
         |C_V #dsmom041#34,1,"N";
         |C_M #dsmom041#34,1,"N";
         |ATRI P; |PINTA 1460, "Cta Ac.:              "; |ATRI 0;
    |FINSI;

    |SI #107#28 = "S";
        |HAZ eBuscoSubdep;
        |SI eaSubdeT = "S";
            |PINTA 0765, "Subd.:     ";
            |C_V #41#54,1,"S";
            |C_M #41#54,1,"S";
        |SINO;
            |PINTA 0765, "           ";
            |C_V #41#54,1,"N";
            |C_M #41#54,1,"N";
        |FINSI;
    |FINSI;
|FPRC;

|CALCULO LeelaEmpresa; |TIPO 0;
   errconta = 0;
   enEmpresa = #999#0;
   enTpEm = 0;
   |HAZ HayCambio2008;
   |HAZ EsoNoAna;
  || Lee Empresa
    |ABRE #1000;
    #1000#0 = enEmpresa;
    |LEE 041#1000=;
    |SI FSalida ! 0;
        |MENAV "     Empresa Inexistente";
        errconta = 1;
        |CIERRA #1000;
        |ERROR;
        |ACABA;
    |SINO;
         enTpEm = #1000#87;
         |SI #1000#23 = "N";
            || .. errconta = 1;
            || .. |MENAV "     Empresa Sin Contabilidad";
        |FINSI;
    |FINSI;
    #dsmow041#1 = #1000#1; |PINTA #dsmow041#1;
    |CIERRA #1000;

    |LEE 010#dsmow041.=;
    |SI FSalida ! 0;
        #999#0 = enEmpresa;
        #999#1 = #1000#1;
        |GRABA 000#dsmow041.b;
        |ERROR;
        |PTEC 825;
    |FINSI;
|FCAL;

|PROCESO BorroHist46;
 |BORRA 020#dsmom046.a;
 |LIBERA #dsmom046;
|FPRC;

|DEFBUCLE borrarHist46;
 #dsmom046#1;
 ;
 #999#0, "        ", 00, 00, "   ";
 #999#0, "zzzzzzzz", 99, 99, "zzz";
 be;
 NULL, BorroHist46;
|FIN;

|PROCESO BorroHist45;
 |BORRA 020#dsmom045.a;
 |LIBERA #dsmom045;
|FPRC;

|DEFBUCLE borrarHist45;
 #dsmom045#1;
 ;
 #999#0, "        ", 00;
 #999#0, "zzzzzzzz", 99;
 be;
 NULL, BorroHist45;
|FIN;

|PROCESO BorroHistorico;
 |BORRA 020#dsmom044.a;
 |LIBERA #dsmom044;
|FPRC;

|DEFBUCLE borrarHistorico;
 #dsmom044#1;
 ;
 #999#0, "        ", 00;
 #999#0, "zzzzzzzz", 99;
 be;
 NULL, BorroHistorico;
|FIN;

|PROCESO Borrolin;
 |BORRA 020#dsmom042.a;
 |LIBERA #dsmom042;
|FPRC;

|DEFBUCLE borrarLineas;
 #dsmom042#1;
 ;
 #999#0,"        ", 00,000;
 #999#0,"zzzzzzzz", 99,999;
 be;
 NULL, Borrolin;
|FIN;

|PROCESO Borrolin49;
 |BORRA 020#dsmom049.a;
 |LIBERA #dsmom049;
|FPRC;

|DEFBUCLE borrarLineas49;
 #dsmom049#1;
 ;
 #999#0,"        ", 00,000;
 #999#0,"zzzzzzzz", 99,999;
 be;
 NULL, Borrolin49;
|FIN;

|PROCESO BorraElemento;
 |BORRA 020#dsmom041.a;
 |LIBERA #dsmom041;
|FPRC;

|DEFBUCLE borrarElementos;
 #dsmom041#1;
 ;
 #999#0,"        ", 00;
 #999#0,"zzzzzzzz", 99;
 be;
 NULL, BorraElemento;
|FIN;

|PROCESO Tipo1; |TIPO 1;
 esalta = (FEntrada / 100) ! 0;
 |SI esalta = 2;
    |ERROR;
    |PTEC 825;
 |FINSI;
 |SI esalta = 3;
     |CONFI "    NEsta Seguro de Borrar todos los Elementos de Amortizacion de esta Empresa ";
     |SI FSalida ! 0;
         |ERROR;
         |ACABA;
     |FINSI;
     |BUCLE borrarElementos;
     |BUCLE borrarLineas;
     |BUCLE borrarLineas49;
     |BUCLE borrarHistorico;
     |BUCLE borrarHist45;
     |BUCLE borrarHist46;
 |FINSI;
|FPRC;

|PROCESO leeElemento;
 nume1 = 1;
 |ERROR10;
|FPRC;

|DEFBUCLE LeeElementos;
 #dsmom041#1;
 ;
 #999#0,"        ", 00;
 #999#0,"zzzzzzzz", 99;
 ;
 NULL, leeElemento;
|FIN;

|PROCESO ComprueboLinea;
 nume1 = 0;
 |BUCLE LeeElementos;
 |SI nume1 = 0;
     |BORRA 041#dsmow041.c;
 |FINSI;
 |LIBERA #dsmow041;
|FPRC;

|| **********************************************************************
|RUTINA ClaveBaja41;
     #41#0 = #999#0;
     #41#2 = "        ";
     #41#3 = 00;
|FRUT;

|RUTINA ClaveAlta41;
     #41#0 = #999#0;
     #41#2 = "zzzzzzzz";
     #41#3 = 99;
|FRUT;

|PROCESO Tipo7;  |TIPO 7;
     |SI nNingunaMas = 1;
         |SI nLaPrimera  = 0;
             |PTEC 806;
             |ACABA;
         |FINSI;
     |FINSI;
     |MENSA "    <F2> Consulta Cliente, <F3> Entrar Elementos, <F4> Imprimir Fichas"
     |PINTA  #dsmow041#0; |PINTA  #dsmow041#1;
     enModo = 7;
     enEmpresa   = #999#0;
     enPerConta  = -1;
     enEjer      = 0;
     |HAZ EsoNoAna;
     |HAZ HayCambio2008;
     |ENTLINEAL #1#41, -2, 7, 16, 0, ClaveBaja41, ClaveAlta41;
     nLaPrimera  = 0;
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
   nInkey = FSalida;
   |SI nInkey =  11;
         errconta = 0;
         enModo = 2;
         enEmpresa   = #999#0;
         enPerConta  = -1;
         |ENTLINEAL #1#41, -2, 2, 16, 0, ClaveBaja41, ClaveAlta41;
         |HAZ ComprueboLinea;
   |FINSI;

   |SI nInkey = 10;         || F2
         |ERROR;
         eaElProm = "dsmow041";
         |HAZ ConsuCliente;
         #0#0 = #999#0;
         eaElProm = "";
         |PTEC 802;
    |FINSI;

    |SI nInkey = 12;
         enEmpresa = #999#0;
         eaDElem   = "        ";
         eaHElem   = "zzzzzzzz";
         enDNEle   = 00;
         enHNEle   = 99;
         |SUB_EJECUTA_NP "dsmoy041";
         |ERROR;
    |FINSI;

|FPRC;
|| **********************************************************************
